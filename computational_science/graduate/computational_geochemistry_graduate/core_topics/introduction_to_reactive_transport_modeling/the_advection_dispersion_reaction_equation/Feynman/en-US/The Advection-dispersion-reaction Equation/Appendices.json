{
    "hands_on_practices": [
        {
            "introduction": "Before building complex numerical models, it is essential to develop a physical intuition for the system's behavior. This exercise uses the powerful technique of nondimensionalization to distill the Advection-Dispersion-Reaction (ADR) equation into its fundamental components. By deriving and calculating the Péclet ($Pe$) and Damköhler ($Da$) numbers, you will learn to quantitatively assess the balance between transport processes and chemical reactions, allowing for a robust classification of a system as either transport-limited or reaction-limited .",
            "id": "4088608",
            "problem": "Aqueous species $A$ undergoes transport and reaction in a saturated, homogeneous porous medium. Assume constant porosity $\\phi$ and a uniform mean porewater velocity field $\\mathbf{u}$ with magnitude $U$, and model dispersion using Fickian hydrodynamic dispersion with an effective scalar coefficient $D$. The reaction is first-order with rate constant $k$ (units of $\\mathrm{s}^{-1}$), removing $A$ from solution. Consider a one-dimensional flow along $x$ with a characteristic length scale $L$ over which concentration gradients develop. Begin from the principle of conservation of mass for $A$, which states that the rate of accumulation within a representative elementary volume plus the net efflux by transport equals the net removal by reaction. Use this to write the governing advection–dispersion–reaction balance for $A$ and perform a rigorous nondimensionalization with the scalings $x = L \\hat{x}$ and $t = \\frac{L}{U} \\hat{t}$, and $C = C_{0} \\hat{C}$, where $C$ is the aqueous concentration of $A$ and $C_{0}$ is a characteristic concentration scale. Identify, from first principles, the dimensionless groups that compare the relative strengths of advection to dispersion and reaction to advection.\n\nThen, for the following scientifically realistic parameter set representative of a fast reactive solute in an aquifer segment:\n- Mean porewater velocity $U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$,\n- Length scale $L = 10\\ \\mathrm{m}$,\n- Effective hydrodynamic dispersion coefficient $D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- First-order reaction rate constant $k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$,\n\ncompute the Péclet number (Pe) and the Damköhler number (Da). Using the physically motivated criterion based on timescales (reaction-limited if reaction is slower than advection, transport-limited if reaction is faster than advection), classify the regime. To make the classification part of the numerical output, define a binary classification variable $c$ by\n$$\nc = \\begin{cases}\n0, & \\text{reaction-limited}\\\\\n1, & \\text{transport-limited}\n\\end{cases}\n$$\nReport your final numerical result as the ordered triple $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$ with no units. If rounding were needed, you would round to four significant figures, but for the given parameters exact arithmetic suffices.",
            "solution": "The problem requires the derivation and nondimensionalization of the one-dimensional advection-dispersion-reaction (ADR) equation for an aqueous species $A$, followed by the calculation of the Péclet and Damköhler numbers for a given set of parameters and classification of the transport regime.\n\nFirst, we derive the governing partial differential equation from the principle of mass conservation. Consider a one-dimensional representative elementary volume (REV) of the porous medium, extending from $x$ to $x + \\Delta x$ with a unit cross-sectional area. The volume of pore water in this REV is $\\phi \\Delta x$. The mass of species $A$ within this volume is $M = (\\phi \\Delta x) C$, where $C(x, t)$ is the concentration of $A$ per unit volume of porewater.\n\nThe principle of conservation of mass states that the rate of accumulation of mass within the REV is equal to the net rate of mass flux into the REV minus the net rate of mass loss due to reactions.\n$$\n\\frac{\\partial M}{\\partial t} = (\\text{Mass Flux In}) - (\\text{Mass Flux Out}) - (\\text{Rate of Removal by Reaction})\n$$\nThe rate of accumulation of mass is:\n$$\n\\frac{\\partial M}{\\partial t} = \\frac{\\partial}{\\partial t}(\\phi C \\Delta x) = \\phi \\Delta x \\frac{\\partial C}{\\partial t}\n$$\nassuming the porosity $\\phi$ is constant.\n\nThe mass flux, $J(x,t)$, has two components: advection and dispersion. The advective flux is due to the bulk motion of the fluid, and the dispersive flux is due to mechanical mixing and molecular diffusion, modeled here by a Fickian law. The total flux per unit area of the porous medium is:\n$$\nJ(x,t) = \\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\n$$\nwhere $U$ is the mean porewater velocity, and $D$ is the effective hydrodynamic dispersion coefficient. The problem states that $\\mathbf{u}$ is the porewater velocity, and it is standard to write the transport equation in terms of $C$ as concentration within the fluid phase. The flux across the pore area is $J' = UC - D \\frac{\\partial C}{\\partial x}$ and the flux across the total area of the medium is $J = \\phi J'$.\n\nThe net rate of mass flux into the REV is the flux in at $x$ minus the flux out at $x + \\Delta x$:\n$$\n\\text{Net Flux In} = J(x) - J(x+\\Delta x) \\approx -\\frac{\\partial J}{\\partial x} \\Delta x\n$$\nSubstituting the expression for $J$ and assuming $\\phi$, $U$, and $D$ are constant:\n$$\n\\text{Net Flux In} = -\\frac{\\partial}{\\partial x}\\left(\\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\\right)\\Delta x = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x\n$$\nThe reaction is a first-order removal process, so the rate of mass removal per unit volume of porewater is $kC$. The total rate of removal within the REV is:\n$$\n\\text{Rate of Removal} = kC (\\phi \\Delta x)\n$$\nAssembling the mass balance equation:\n$$\n\\phi \\Delta x \\frac{\\partial C}{\\partial t} = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x - kC \\phi \\Delta x\n$$\nDividing by the constant term $\\phi \\Delta x$ yields the one-dimensional advection-dispersion-reaction equation:\n$$\n\\frac{\\partial C}{\\partial t} = -U \\frac{\\partial C}{\\partial x} + D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\nThis is commonly rearranged as:\n$$\n\\frac{\\partial C}{\\partial t} + U \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\nNext, we nondimensionalize this equation using the given scaling variables: $\\hat{x} = x/L$, $\\hat{t} = t / (L/U)$, and $\\hat{C} = C/C_0$. We express the derivatives in the dimensional equation in terms of the dimensionless variables using the chain rule:\n$$\n\\frac{\\partial}{\\partial t} = \\frac{\\partial \\hat{t}}{\\partial t} \\frac{\\partial}{\\partial \\hat{t}} = \\frac{U}{L} \\frac{\\partial}{\\partial \\hat{t}}\n$$\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial \\hat{x}}{\\partial x} \\frac{\\partial}{\\partial \\hat{x}} = \\frac{1}{L} \\frac{\\partial}{\\partial \\hat{x}}\n$$\n$$\n\\frac{\\partial^2}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(\\frac{1}{L}\\frac{\\partial}{\\partial \\hat{x}}\\right) = \\frac{1}{L^2}\\frac{\\partial^2}{\\partial \\hat{x}^2}\n$$\nSubstituting these expressions and $C = C_0 \\hat{C}$ into the ADR equation:\n$$\n\\frac{U}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{t}} + U \\left(\\frac{1}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{x}}\\right) = D \\left(\\frac{1}{L^2} \\frac{\\partial^2 (C_0 \\hat{C})}{\\partial \\hat{x}^2}\\right) - k(C_0 \\hat{C})\n$$\nSince $C_0$ is a constant characteristic concentration, we can divide the entire equation by $C_0$ (assuming $C_0 \\neq 0$):\n$$\n\\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C}\n$$\nTo obtain the canonical dimensionless form, we multiply the equation by the characteristic advection time, $L/U$:\n$$\n\\frac{L}{U} \\left( \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} \\right) = \\frac{L}{U} \\left( \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C} \\right)\n$$\n$$\n\\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\left(\\frac{D}{UL}\\right) \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - \\left(\\frac{kL}{U}\\right) \\hat{C}\n$$\nFrom this dimensionless equation, we identify the dimensionless groups from first principles as the coefficients of the dispersion and reaction terms.\n\nThe term comparing advection to dispersion is the coefficient of the second derivative (dispersion) term. The Péclet number, $\\mathrm{Pe}$, is defined as the ratio of the rate of advective transport to the rate of dispersive transport. The characteristic time for advection over a length $L$ is $\\tau_{adv} = L/U$. The characteristic time for dispersion over the same length is $\\tau_{disp} = L^2/D$. The ratio of these timescales gives $\\tau_{disp}/\\tau_{adv} = (L^2/D)/(L/U) = UL/D$. This dimensionless group is the Péclet number:\n$$\n\\mathrm{Pe} = \\frac{UL}{D}\n$$\nThe coefficient in the dimensionless equation is $D/(UL)$, which is $1/\\mathrm{Pe}$. A large $\\mathrm{Pe}$ indicates that advection dominates over dispersion.\n\nThe term comparing reaction to advection is the coefficient of the reaction term. The Damköhler number, $\\mathrm{Da}$, is defined as the ratio of the rate of advective transport to the rate of reaction. Using the associated timescales, the characteristic time for reaction is $\\tau_{react} = 1/k$. The Damköhler number is the ratio of the advective timescale to the reactive timescale:\n$$\n\\mathrm{Da} = \\frac{\\tau_{adv}}{\\tau_{react}} = \\frac{L/U}{1/k} = \\frac{kL}{U}\n$$\nThis is precisely the coefficient of the reaction term in the dimensionless equation. A large $\\mathrm{Da}$ indicates that reaction is fast compared to advection.\n\nNow, we compute the numerical values for $\\mathrm{Pe}$ and $\\mathrm{Da}$ using the provided parameters:\n$U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$\n$L = 10\\ \\mathrm{m}$\n$D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n$k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$\n\n$$\n\\mathrm{Pe} = \\frac{UL}{D} = \\frac{(5.0 \\times 10^{-5}) \\times 10}{1.0 \\times 10^{-6}} = \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-6}} = 500\n$$\n$$\n\\mathrm{Da} = \\frac{kL}{U} = \\frac{(1.0 \\times 10^{-4}) \\times 10}{5.0 \\times 10^{-5}} = \\frac{1.0 \\times 10^{-3}}{5.0 \\times 10^{-5}} = \\frac{100}{5.0} = 20\n$$\nThe value $\\mathrm{Pe}=500$ indicates an advection-dominated transport regime. The value $\\mathrm{Da}=20$ indicates that the reaction rate is significantly faster than the advection rate over the length scale $L$.\n\nFinally, we classify the regime based on the provided criterion. The criterion is to classify the system as \"reaction-limited if reaction is slower than advection, transport-limited if reaction is faster than advection\". This comparison is precisely what the Damköhler number quantifies.\nThe advection timescale is $\\tau_{adv} = L/U = 10 / (5.0 \\times 10^{-5}) = 2.0 \\times 10^5\\ \\mathrm{s}$.\nThe reaction timescale is $\\tau_{react} = 1/k = 1 / (1.0 \\times 10^{-4}) = 1.0 \\times 10^4\\ \\mathrm{s}$.\nSince $\\tau_{react} < \\tau_{adv}$, the reaction is faster than advection. Therefore, the overall process is limited by the rate at which the species can be transported to the reaction sites. The system is transport-limited. This conclusion is also directly supported by the fact that $\\mathrm{Da} = \\tau_{adv}/\\tau_{react} = 20 > 1$.\n\nThe binary classification variable $c$ is defined as $c=0$ for reaction-limited and $c=1$ for transport-limited. Since the system is transport-limited, we have $c = 1$.\n\nThe final result is the ordered triple $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$.\n$$\n(\\mathrm{Pe},\\,\\mathrm{Da},\\,c) = (500, 20, 1)\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n500 & 20 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A cornerstone of computational science is ensuring the correctness of the code. The Method of Manufactured Solutions (MMS) is a rigorous and indispensable technique for code verification, where a known analytical solution is used to test a numerical solver's accuracy. This practice guides you through deriving the necessary source term for a chosen manufactured solution and implementing a finite difference model to numerically verify that your code achieves the expected convergence rate, a critical skill for developing trustworthy scientific software .",
            "id": "4079440",
            "problem": "Consider one-dimensional solute transport in a saturated geochemical column modeled by the Advection–Diffusion–Reaction (ADR) Partial Differential Equation (PDE). Let $u(x,t)$ denote aqueous concentration in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$, with spatial coordinate $x \\in [0,L]$ in $\\mathrm{m}$ and time $t \\in [0,T]$ in $\\mathrm{s}$. The ADR PDE is\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t),\n$$\nwhere $a$ is the advective velocity in $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D$ is the diffusion (hydrodynamic dispersion) coefficient in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k$ is a first-order reaction rate constant in $\\mathrm{s}^{-1}$, and $s(x,t)$ is a source term in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$ representing external inputs.\n\nUsing the method of manufactured solutions, define the exact concentration field\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\big(2\\pi x/L\\big)\\,\\mathrm{e}^{-t} \\;+\\; \\tfrac{1}{2}\\,x\\,(L-x),\n$$\nwith domain length $L = 1$ $\\mathrm{m}$ and final time $T = 0.1$ $\\mathrm{s}$. Impose Dirichlet boundary conditions that match the manufactured solution, so that $u(0,t) = u_{\\mathrm{m}}(0,t)$ and $u(L,t) = u_{\\mathrm{m}}(L,t)$ for all $t \\in [0,T]$, and an initial condition $u(x,0) = u_{\\mathrm{m}}(x,0)$ for all $x \\in [0,L]$. Starting from the ADR definition above, derive the source term $s(x,t)$ that makes $u_{\\mathrm{m}}(x,t)$ an exact solution of the continuous ADR PDE for arbitrary constants $a$, $D$, and $k$.\n\nDiscretize the spatial domain by a uniform grid with $N$ interior points (so there are $N+2$ nodes including the boundaries), spacing $h = L/(N+1)$. Use an upwind finite difference for the first derivative $\\partial u/\\partial x$, a second-order central difference for the second derivative $\\partial^2 u/\\partial x^2$, and a forward Euler time integrator for $\\partial u/\\partial t$. Specifically, for a given sign of $a$, use the appropriate upwind one-sided difference. Let the time step $\\Delta t$ satisfy explicit stability conditions, taking\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right),\n$$\nwith the convention that terms with zero denominator are treated as $+\\infty$ in the minimum. Integrate from $t=0$ to $t=T$ by forward Euler using the manufactured source term $s(x,t)$ evaluated at the current time level, and enforce Dirichlet boundary values from $u_{\\mathrm{m}}(x,t)$ at every time step. After reaching $t=T$, compute the relative discrete $L^2$ error\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}},\n$$\nwhich is dimensionless. Using mesh refinements $N \\in \\{40, 80, 160\\}$, estimate the observed convergence rate\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)},\n$$\nwhere $h_j = L/(N_j+1)$ and $N_2=80$, $N_3=160$.\n\nTest Suite:\n- Set $\\mathrm{A}$ (diffusion-dominated): $a = 0.05$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-3}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{B}$ (advection-dominated, positive velocity): $a = 1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{C}$ (advection-dominated, negative velocity): $a = -1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{D}$ (reaction-dominated): $a = 0.01$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 5.0$ $\\mathrm{s}^{-1}$.\n\nYour program must:\n- Derive and implement the manufactured source $s(x,t)$ from the ADR PDE and $u_{\\mathrm{m}}(x,t)$.\n- For each parameter set $\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$, and $\\mathrm{D}$, compute the relative discrete $L^2$ errors $E_{h}$ for $N \\in \\{40,80,160\\}$ and then compute $p$ using the formula above.\n- Produce a single line of output containing the observed convergence rates for the four sets as a comma-separated list enclosed in square brackets, in the order $\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$, $\\mathrm{D}$, with each float rounded to three decimal places, for example $[p_A,p_B,p_C,p_D]$.\n\nAll outputs are dimensionless and must be reported as floats. Angles are not involved. No percentages are involved.",
            "solution": "The user-provided problem is a well-posed exercise in computational science, specifically the numerical solution of a partial differential equation (PDE) using the method of manufactured solutions for code verification. The problem is scientifically grounded, self-contained, and all parameters and methods are clearly defined. It will be solved by first deriving the necessary source term, then developing a numerical model based on the specified finite difference scheme, and finally using this model to compute the empirical convergence rate for several physical scenarios.\n\n### 1. Derivation of the Manufactured Source Term\n\nThe problem is governed by the Advection–Diffusion–Reaction (ADR) equation:\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t)\n$$\nThe source term $s(x,t)$ must be chosen such that the manufactured solution, $u_{\\mathrm{m}}(x,t)$, is an exact solution to this PDE. We can find $s(x,t)$ by rearranging the ADR equation and substituting $u_{\\mathrm{m}}(x,t)$:\n$$\ns(x,t) = \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} + a\\,\\frac{\\partial u_{\\mathrm{m}}}{\\partial x} - D\\,\\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} + k\\,u_{\\mathrm{m}}\n$$\nThe manufactured solution is given as:\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} \\;+\\; \\frac{1}{2}\\,x\\,(L-x)\n$$\nTo find $s(x,t)$, we first compute the necessary partial derivatives of $u_{\\mathrm{m}}(x,t)$:\n\\begin{itemize}\n    \\item Time derivative:\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} = -\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\n    $$\n    \\item First spatial derivative:\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial x} = \\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\n    $$\n    \\item Second spatial derivative:\n    $$\n    \\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} = -\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\n    $$\n\\end{itemize}\nSubstituting these expressions into the equation for $s(x,t)$:\n$$\ns(x,t) = \\left[-\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\\right] + a\\left[\\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\\right] - D\\left[-\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\\right] + k\\left[\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{1}{2}\\,x\\,(L-x)\\right]\n$$\nGrouping terms by their functional dependence on $x$ and $t$:\n$$\ns(x,t) = \\left(k - 1 + D\\left(\\frac{2\\pi}{L}\\right)^2\\right)\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + \\left(\\frac{2\\pi a}{L}\\right)\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + a\\left(\\frac{L}{2} - x\\right) + D + \\frac{k}{2}x(L-x)\n$$\nThis is the analytical expression for the source term that will be implemented in the numerical model.\n\n### 2. Numerical Discretization\n\nThe PDE is discretized on a uniform spatial grid $x_i = i h$ for $i \\in \\{0, 1, \\dots, N+1\\}$, where $h = L/(N+1)$ is the grid spacing. Time is discretized as $t_n = n \\Delta t$. We denote the numerical approximation of $u(x_i, t_n)$ as $u_i^n$.\n\nThe specified numerical scheme is:\n\\begin{itemize}\n    \\item **Time Derivative**: Forward Euler, $\\frac{\\partial u}{\\partial t} \\approx \\frac{u_i^{n+1} - u_i^n}{\\Delta t}$.\n    \\item **Diffusion Term**: Second-order central difference, $\\frac{\\partial^2 u}{\\partial x^2} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2}$.\n    \\item **Advection Term**: First-order upwind difference. The form depends on the sign of the velocity $a$:\n    \\begin{itemize}\n        \\item If $a \\ge 0$ (flow to the right), a backward difference is used: $\\frac{\\partial u}{\\partial x} \\approx \\frac{u_i^n - u_{i-1}^n}{h}$.\n        \\item If $a < 0$ (flow to the left), a forward difference is used: $\\frac{\\partial u}{\\partial x} \\approx \\frac{u_{i+1}^n - u_i^n}{h}$.\n    \\end{itemize}\n\\end{itemize}\n\nRearranging the PDE as $\\frac{\\partial u}{\\partial t} = \\dots$ and substituting the discrete approximations gives the update rule $u_i^{n+1} = u_i^n + \\Delta t (\\dots)$.\n\nFor $a \\ge 0$:\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_i^n - u_{i-1}^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\nFor $a < 0$:\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_{i+1}^n - u_i^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\nThese equations are applied to all interior grid points $i \\in \\{1, 2, \\dots, N\\}$. The boundary values are fixed by the Dirichlet conditions: $u_0^{n+1} = u_{\\mathrm{m}}(0, t_{n+1}) = 0$ and $u_{N+1}^{n+1} = u_{\\mathrm{m}}(L, t_{n+1}) = 0$.\n\n### 3. Time Step and Convergence Analysis\n\nThe time step $\\Delta t$ is chosen to satisfy the explicit stability conditions for the forward Euler scheme:\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right)\n$$\nThe factor $0.4$ is a safety factor ensuring that the Courant–Friedrichs–Lewy (CFL) conditions for advection and diffusion, as well as a stability condition for the reaction term, are all met.\n\nThe simulation starts from the initial condition $u_i^0 = u_{\\mathrm{m}}(x_i, 0)$ and proceeds until the final time $T$. The accuracy of the numerical solution $u_i(T)$ is quantified by the relative discrete $L^2$ error:\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}\n$$\nThe observed order of convergence, $p$, is estimated by computing the error for two different grid resolutions, $h_2$ (with $N_2=80$) and $h_3$ (with $N_3=160$):\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)}\n$$\nThe numerical scheme employs first-order methods for time integration (Forward Euler) and advection (upwinding), and a second-order method for diffusion. The overall accuracy is limited by the lowest order term, so the theoretical convergence rate is expected to be $p \\approx 1$.\n\n### 4. Implementation\n\nThe algorithm is implemented in Python using the `numpy` library for efficient vectorized operations. A function is defined to run the simulation for a given set of parameters $(a, D, k)$ and grid size $N$. This function initializes the grid and the solution vector, calculates the stable time step, and iteratively updates the solution in a time loop. Within the loop, the source term is evaluated at the current time, and the appropriate upwind scheme is chosen based on the sign of $a$. After reaching the final time $T$, the function computes and returns the relative $L^2$ error. The main part of the script loops through the four test suites, calls the simulation function for $N=80$ and $N=160$, calculates the convergence rate $p$ for each suite, and prints the results in the specified format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the observed convergence rates for the ADR equation\n    solution for four different parameter sets.\n    \"\"\"\n\n    def u_manufactured(x: np.ndarray, t: float, L: float) -> np.ndarray:\n        \"\"\"\n        Calculates the manufactured solution u_m(x, t).\n        \"\"\"\n        term1 = np.sin(2 * np.pi * x / L) * np.exp(-t)\n        term2 = 0.5 * x * (L - x)\n        return term1 + term2\n\n    def source_manufactured(x: np.ndarray, t: float, a: float, D: float, k: float, L: float) -> np.ndarray:\n        \"\"\"\n        Calculates the manufactured source term s(x, t).\n        \"\"\"\n        pi_term = 2 * np.pi / L\n        exp_t = np.exp(-t)\n        \n        sin_term = np.sin(pi_term * x)\n        cos_term = np.cos(pi_term * x)\n        \n        # Grouping terms as derived in the solution\n        term1 = (k - 1 + D * pi_term**2) * sin_term * exp_t\n        term2 = a * pi_term * cos_term * exp_t\n        term3 = a * (L/2 - x)\n        term4 = D\n        term5 = k * 0.5 * x * (L - x)\n\n        return term1 + term2 + term3 + term4 + term5\n\n    def run_simulation(N: int, a: float, D: float, k: float, L: float, T: float) -> float:\n        \"\"\"\n        Runs one simulation for a given grid size and parameter set.\n        \n        Returns:\n            The relative discrete L2 error.\n        \"\"\"\n        # Grid setup\n        h = L / (N + 1)\n        x = np.linspace(0, L, N + 2)\n\n        # Time step calculation based on stability criteria\n        # Handle cases where denominators might be zero\n        dt_adv = h / abs(a) if a != 0 else np.inf\n        dt_diff = h**2 / (2 * D) if D != 0 else np.inf\n        dt_react = 1 / k if k != 0 else np.inf\n        \n        dt = 0.4 * min(dt_adv, dt_diff, dt_react)\n        \n        num_steps = int(np.ceil(T / dt))\n        dt = T / num_steps  # Adjust dt to hit T exactly\n\n        # Initial condition\n        u = u_manufactured(x, 0, L)\n        \n        # Time-stepping loop\n        t = 0\n        for n in range(num_steps):\n            t = n * dt\n            u_n = u.copy()\n            \n            # Evaluate source term for interior points at current time t\n            s = source_manufactured(x[1:-1], t, a, D, k, L)\n\n            # Slicing for vectorized update\n            u_interior = u_n[1:-1]\n            u_left = u_n[0:-2]\n            u_right = u_n[2:]\n\n            # Diffusion and reaction terms\n            diffusion_term = D * (u_left - 2 * u_interior + u_right) / h**2\n            reaction_term = -k * u_interior\n\n            # Advection term (upwinding)\n            if a >= 0:\n                advection_term = -a * (u_interior - u_left) / h\n            else: # a < 0\n                advection_term = -a * (u_right - u_interior) / h\n\n            # Update interior points\n            u[1:-1] = u_interior + dt * (diffusion_term + advection_term + reaction_term + s)\n\n            # Boundary conditions for the next step (t + dt) are u_m(0, t+dt) and u_m(L, t+dt)\n            # which are both 0 for all t > 0.\n            u[0] = u_manufactured(x[0], t + dt, L)\n            u[-1] = u_manufactured(x[-1], t + dt, L)\n\n        # Final time reached\n        t_final = T\n        u_exact_T = u_manufactured(x, t_final, L)\n\n        # Compute relative discrete L2 error\n        err_numerator_sq = h * np.sum((u - u_exact_T)**2)\n        err_denominator_sq = h * np.sum(u_exact_T**2)\n        \n        if err_denominator_sq == 0:\n            return 0.0 if err_numerator_sq == 0 else np.inf\n            \n        error = np.sqrt(err_numerator_sq) / np.sqrt(err_denominator_sq)\n        \n        return error\n\n    def calculate_convergence_rate(params: tuple) -> float:\n        \"\"\"\n        Calculates the convergence rate for a given parameter set.\n        \"\"\"\n        a, D, k = params\n        L, T = 1.0, 0.1\n        N_vals = {'N2': 80, 'N3': 160}\n\n        h2 = L / (N_vals['N2'] + 1)\n        h3 = L / (N_vals['N3'] + 1)\n        \n        E_h2 = run_simulation(N_vals['N2'], a, D, k, L, T)\n        E_h3 = run_simulation(N_vals['N3'], a, D, k, L, T)\n        \n        # Handle cases where error might be zero\n        if E_h2 == 0 or E_h3 == 0:\n            return np.nan # Or some other indicator of non-standard convergence\n            \n        p = np.log(E_h2 / E_h3) / np.log(h2 / h3)\n        return p\n\n    # Test suite from the problem statement\n    test_cases = [\n        (0.05, 1.0e-3, 0.1),    # Set A: diffusion-dominated\n        (1.0, 1.0e-4, 0.1),     # Set B: advection-dominated, positive a\n        (-1.0, 1.0e-4, 0.1),    # Set C: advection-dominated, negative a\n        (0.01, 1.0e-4, 5.0),    # Set D: reaction-dominated\n    ]\n\n    results = []\n    for case in test_cases:\n        p = calculate_convergence_rate(case)\n        results.append(p)\n\n    # Format output as specified: [p_A,p_B,p_C,p_D] rounded to 3 decimal places.\n    print(f\"[{','.join([f'{r:.3f}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world geochemical systems often involve multiple processes that are best handled by different numerical methods. Operator splitting is a powerful and flexible strategy for coupling distinct physical and chemical processes, such as transport and reaction, in a modular way. In this exercise, you will implement and compare a fully-coupled (monolithic) solver with two widely used operator splitting schemes, providing practical experience in evaluating the trade-offs between accuracy and implementation simplicity in advanced reactive transport modeling .",
            "id": "4102942",
            "problem": "Consider the one-dimensional transport of a dissolved aqueous species in a saturated porous medium governed by the Advection-Dispersion-Reaction (ADR) equation, where Advection-Dispersion-Reaction (ADR) denotes advection, Fickian dispersion, and first-order reaction. The species concentration is denoted by $c(x,t)$, the spatial coordinate by $x$ in meters, and time by $t$ in seconds. The governing partial differential equation is a conservation statement for $c(x,t)$ under the combined effects of advective flux, dispersive flux, and a first-order decay process. Assume a constant Darcy velocity $v \\ge 0$ in $\\mathrm{m}\\,\\mathrm{s}^{-1}$, a constant hydrodynamic dispersion coefficient $D$ in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, and a first-order decay rate constant $k$ in $\\mathrm{s}^{-1}$. The spatial domain is $x \\in [0,L]$ with $L$ in meters. The boundary conditions are a Dirichlet condition $c(0,t) = c_{\\text{left}}$ at the left boundary and a zero-gradient (Neumann) condition $\\partial c/\\partial x\\,(L,t) = 0$ at the right boundary. The initial condition at $t=0$ is a Gaussian plume centered at $x=x_0$ with width parameter $\\sigma$ and peak amplitude $c_0$, given by $c(x,0) = c_0 \\exp\\!\\left(-\\dfrac{(x-x_0)^2}{2\\sigma^2}\\right)$.\n\nStarting from the local mass conservation principle and constitutive flux laws appropriate for saturated porous media, derive a robust, unconditionally stable time-integration strategy to advance $c(x,t)$ over uniform time steps of size $\\Delta t$ using a uniform grid of $N$ nodes with spacing $\\Delta x = L/(N-1)$. Your implementation must be based on first principles and must not assume any pre-derived discrete formulas. The numerical design must satisfy the following requirements:\n\n- The advective and dispersive transport contributions must be treated implicitly in time in a manner that respects the upwind direction for $v \\ge 0$ and uses a central approximation for the second spatial derivative associated with dispersion.\n- The first-order reaction must be coupled to transport via two operator splitting strategies:\n  1. A first-order sequential splitting where transport is advanced over a full step $\\Delta t$ and reaction is advanced over the same full step $\\Delta t$ via a backward Euler update applied pointwise.\n  2. A Strang-type symmetric splitting where reaction is advanced by a half step $\\Delta t/2$, transport by a full step $\\Delta t$, and reaction by a final half step $\\Delta t/2$, all using backward Euler updates for the reaction part applied pointwise.\n- As a reference, implement a monolithic backward Euler scheme where transport and reaction are treated together in a single implicit linear system per time step on the uniform grid.\n- All three schemes must enforce the boundary conditions consistently at each time step. For the Dirichlet boundary at $x=0$, the concentration must be held at $c_{\\text{left}}$ throughout time integration. For the Neumann boundary at $x=L$, the zero-gradient condition must be respected in the discrete operator design.\n\nFor scientific realism, use the following initial condition parameters in their specified units: $c_0 = 1\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$, $x_0 = 1\\,\\mathrm{m}$, and $\\sigma = 0.2\\,\\mathrm{m}$. Use $c_{\\text{left}} = 0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$. The angle unit does not apply. All physical quantities must be treated in their specified units.\n\nYour program must simulate the evolution to a final time $T$ by iterating $t$ in steps of $\\Delta t$ for each test case. For each test case, compute two scalar quality measures: the relative $\\ell_2$-norm error of the sequential splitting solution with respect to the monolithic solution, and the relative $\\ell_2$-norm error of the Strang splitting solution with respect to the monolithic solution, both evaluated at $t=T$. The relative $\\ell_2$-norm error is defined as $\\left\\|c_{\\text{split}} - c_{\\text{mono}}\\right\\|_2 / \\left\\|c_{\\text{mono}}\\right\\|_2$, which is dimensionless and must be reported as a float.\n\nTest Suite and Coverage. Implement the following three scientifically plausible parameter sets that provide coverage of a general case, a boundary case, and an advection-dominated edge case:\n\n- Test Case $1$ (general case): $L = 10\\,\\mathrm{m}$, $N = 201$, $v = 1\\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1\\times 10^{-6}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 2\\times 10^{-5}\\,\\mathrm{s}^{-1}$, $T = 10{,}000\\,\\mathrm{s}$, $\\Delta t = 100\\,\\mathrm{s}$.\n- Test Case $2$ (boundary condition and stiff reaction): $L = 5\\,\\mathrm{m}$, $N = 101$, $v = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 5\\times 10^{-6}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1\\times 10^{-3}\\,\\mathrm{s}^{-1}$, $T = 1{,}000\\,\\mathrm{s}$, $\\Delta t = 10\\,\\mathrm{s}$.\n- Test Case $3$ (advection-dominated edge case): $L = 10\\,\\mathrm{m}$, $N = 401$, $v = 2\\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1\\times 10^{-9}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1\\times 10^{-6}\\,\\mathrm{s}^{-1}$, $T = 5{,}000\\,\\mathrm{s}$, $\\Delta t = 50\\,\\mathrm{s}$.\n\nAnswer Specification. Your program must produce a single line of output containing the six floating-point results aggregated across all test cases in the order indicated below, as a comma-separated list enclosed in square brackets. The order is:\n$[$error$_{\\text{seq},1}$, error$_{\\text{strang},1}$, error$_{\\text{seq},2}$, error$_{\\text{strang},2}$, error$_{\\text{seq},3}$, error$_{\\text{strang},3}]$.\nEach error must be reported as a float. No other text may be printed.",
            "solution": "The problem requires the implementation and comparison of three numerical schemes for solving the one-dimensional Advection-Dispersion-Reaction (ADR) equation, a fundamental model in computational geochemistry for simulating solute transport in porous media. The three schemes are a monolithic fully-implicit backward Euler method, a first-order sequential operator splitting method, and a second-order Strang-type symmetric operator splitting method.\n\nThe governing ADR equation is:\n$$\n\\frac{\\partial c}{\\partial t} = -v \\frac{\\partial c}{\\partial x} + D \\frac{\\partial^2 c}{\\partial x^2} - k c\n$$\nwhere $c(x,t)$ is the concentration, $v$ is the Darcy velocity, $D$ is the hydrodynamic dispersion coefficient, and $k$ is the first-order reaction rate constant. The problem is posed on a spatial domain $x \\in [0, L]$ with a Dirichlet boundary condition $c(0,t) = c_{\\text{left}}$ and a zero-gradient Neumann boundary condition $\\frac{\\partial c}{\\partial x}(L,t) = 0$.\n\nFirst, we discretize the spatial domain into $N$ nodes with spacing $\\Delta x = L/(N-1)$, such that $x_i = i\\Delta x$ for $i=0, \\dots, N-1$. Time is discretized into uniform steps of size $\\Delta t$. Let $c_i^n$ denote the concentration at node $i$ and time $n$. The backward Euler method requires evaluating all spatial derivatives at the future time level $n+1$.\n\nThe spatial derivatives are approximated using finite differences as specified:\n- Advection term (first-order upwind for $v \\ge 0$): $\\frac{\\partial c}{\\partial x} \\approx \\frac{c_i^{n+1} - c_{i-1}^{n+1}}{\\Delta x}$\n- Dispersion term (second-order central): $\\frac{\\partial^2 c}{\\partial x^2} \\approx \\frac{c_{i+1}^{n+1} - 2c_i^{n+1} + c_{i-1}^{n+1}}{\\Delta x^2}$\n\nThe zero-gradient Neumann boundary condition at $x=L$ ($i=N-1$) is handled using a ghost-node approach. A central difference for the first derivative at $x_{N-1}$ involving a ghost node at $x_N$ gives $\\frac{c_N-c_{N-2}}{2\\Delta x} = 0$, implying $c_N = c_{N-2}$. This allows us to approximate the dispersion term at $i=N-1$ as $\\frac{\\partial^2 c}{\\partial x^2} \\approx \\frac{2c_{N-2} - 2c_{N-1}}{\\Delta x^2}$.\n\n**1. Monolithic Backward Euler Scheme**\nAll terms (advection, dispersion, reaction) are treated implicitly in a single system. Substituting the discrete approximations into the ADR equation yields for an interior node $i \\in [1, N-2]$:\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} = -v \\frac{c_i^{n+1} - c_{i-1}^{n+1}}{\\Delta x} + D \\frac{c_{i+1}^{n+1} - 2c_i^{n+1} + c_{i-1}^{n+1}}{\\Delta x^2} - k c_i^{n+1}\n$$\nRearranging terms to form a linear system $\\mathbf{A} \\mathbf{c}^{n+1} = \\mathbf{b}^n$ for the unknown concentrations at interior nodes $\\mathbf{u}^{n+1} = [c_1^{n+1}, \\dots, c_{N-1}^{n+1}]^T$:\n$$\n-\\left(\\frac{D \\Delta t}{\\Delta x^2} + \\frac{v \\Delta t}{\\Delta x}\\right) c_{i-1}^{n+1} + \\left(1 + \\frac{2D \\Delta t}{\\Delta x^2} + \\frac{v \\Delta t}{\\Delta x} + k \\Delta t\\right) c_i^{n+1} - \\left(\\frac{D \\Delta t}{\\Delta x^2}\\right) c_{i+1}^{n+1} = c_i^n\n$$\nThe equations for the first ($i=1$) and last ($i=N-1$) unknown nodes are adjusted to incorporate the boundary conditions. This results in a tridiagonal system of size $(N-1) \\times (N-1)$ which is solved at each time step.\n\n**2. Sequential Operator Splitting**\nThis method splits the ADR equation into a transport part and a reaction part, solving them sequentially.\na. **Transport Step:** Solve $\\frac{\\partial c}{\\partial t} = -v \\frac{\\partial c}{\\partial x} + D \\frac{\\partial^2 c}{\\partial x^2}$ over a full time step $\\Delta t$ using the backward Euler method. This is equivalent to the monolithic system with $k=0$, yielding an intermediate solution $c^*$.\nb. **Reaction Step:** Solve $\\frac{\\partial c}{\\partial t} = -k c$ over the same step $\\Delta t$, starting from $c^*$. The backward Euler discretization is $\\frac{c_i^{n+1} - c_i^*}{\\Delta t} = -k c_i^{n+1}$, which gives the pointwise analytical solution $c_i^{n+1} = c_i^* / (1 + k \\Delta t)$.\n\n**3. Strang Operator Splitting**\nThis is a more accurate, second-order symmetric splitting scheme.\na. **First Reaction Half-Step:** Solve the reaction equation over $\\Delta t/2$ starting from $c^n$. This gives $c_i^{n+1/2} = c_i^n / (1 + k \\Delta t/2)$.\nb. **Full Transport Step:** Solve the transport equation over a full step $\\Delta t$ starting from $c^{n+1/2}$ to get an intermediate solution $c^*$. This is the same linear system as in the sequential splitting transport step, but with a different right-hand side.\nc. **Second Reaction Half-Step:** Solve the reaction equation over the final $\\Delta t/2$ starting from $c^*$. This gives $c_i^{n+1} = c_i^* / (1 + k \\Delta t/2)$.\n\nFor all three schemes, the initial condition is a Gaussian plume, and the solution is advanced in time until the final time $T$. The error of the splitting schemes is evaluated against the monolithic solution, which serves as a reference. The relative $\\ell_2$-norm error, defined as $\\|c_{\\text{split}} - c_{\\text{mono}}\\|_2 / \\|c_{\\text{mono}}\\|_2$, is computed at the final time $T$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef run_simulation(params, scheme_type):\n    \"\"\"\n    Runs the ADR simulation for a given set of parameters and a specified scheme.\n\n    Args:\n        params (dict): Dictionary of physical and numerical parameters.\n        scheme_type (str): one of 'monolithic', 'sequential', or 'strang'.\n\n    Returns:\n        np.ndarray: The concentration profile at the final time T.\n    \"\"\"\n    L = params['L']\n    N = params['N']\n    v = params['v']\n    D = params['D']\n    k = params['k']\n    T = params['T']\n    dt = params['dt']\n    c0 = params['c0']\n    x0_plume = params['x0_plume']\n    sigma_plume = params['sigma_plume']\n    c_left = params['c_left']\n\n    dx = L / (N - 1)\n    x = np.linspace(0, L, N)\n    num_steps = int(T / dt)\n\n    # Initial condition\n    c = c0 * np.exp(-(x - x0_plume)**2 / (2 * sigma_plume**2))\n    c[0] = c_left # Enforce Dirichlet BC at t=0\n\n    # System size for unknowns c_1, ..., c_{N-1}\n    M = N - 1\n\n    # Coefficients for the linear system\n    alpha = D * dt / dx**2\n    beta = v * dt / dx\n\n    # --- Setup transport matrix (used by all schemes) ---\n    A_transport = np.zeros((3, M))\n    # Upper diagonal\n    A_transport[0, 1:] = -alpha\n    # Main diagonal\n    A_transport[1, :] = 1.0 + 2.0 * alpha + beta\n    # Lower diagonal\n    if M > 1:\n        A_transport[2, :-1] = -(alpha + beta)\n        # Modify for Neumann BC at the right end (i=N-1, or index M-1 in unknowns)\n        A_transport[2, M - 2] = -(2.0 * alpha + beta)\n    \n    A_mono = None\n    if scheme_type == 'monolithic':\n        gamma = k * dt\n        A_mono = A_transport.copy()\n        A_mono[1, :] += gamma\n\n    for _ in range(num_steps):\n        if scheme_type == 'monolithic':\n            # RHS vector for unknowns u = c[1:]\n            b = c[1:].copy()\n            # Account for Dirichlet BC at c[0]\n            b[0] += (alpha + beta) * c_left\n            c[1:] = solve_banded((1, 1), A_mono, b)\n\n        elif scheme_type == 'sequential':\n            # 1. Transport step\n            b_trans = c[1:].copy()\n            b_trans[0] += (alpha + beta) * c_left\n            c_star_internal = solve_banded((1, 1), A_transport, b_trans)\n            c[1:] = c_star_internal\n            \n            # 2. Reaction step (pointwise backward Euler)\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt)\n\n        elif scheme_type == 'strang':\n            # 1. First reaction half-step\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt / 2.0)\n            \n            # 2. Full transport step\n            b_trans = c[1:].copy()\n            b_trans[0] += (alpha + beta) * c_left\n            c_star_internal = solve_banded((1, 1), A_transport, b_trans)\n            c[1:] = c_star_internal\n\n            # 3. Second reaction half-step\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt / 2.0)\n                \n    return c\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute errors.\n    \"\"\"\n    ic_params = {\n        'c0': 1.0, \n        'x0_plume': 1.0, \n        'sigma_plume': 0.2, \n        'c_left': 0.0\n    }\n\n    test_cases = [\n        {'L': 10.0, 'N': 201, 'v': 1e-5, 'D': 1e-6, 'k': 2e-5, 'T': 10000.0, 'dt': 100.0},\n        {'L': 5.0, 'N': 101, 'v': 0.0, 'D': 5e-6, 'k': 1e-3, 'T': 1000.0, 'dt': 10.0},\n        {'L': 10.0, 'N': 401, 'v': 2e-5, 'D': 1e-9, 'k': 1e-6, 'T': 5000.0, 'dt': 50.0},\n    ]\n\n    all_results = []\n    \n    for case_params in test_cases:\n        params = {**case_params, **ic_params}\n\n        c_mono = run_simulation(params, 'monolithic')\n        c_seq = run_simulation(params, 'sequential')\n        c_strang = run_simulation(params, 'strang')\n\n        norm_mono = np.linalg.norm(c_mono)\n        \n        if norm_mono == 0:\n            error_seq = np.linalg.norm(c_seq - c_mono)\n            error_strang = np.linalg.norm(c_strang - c_mono)\n        else:\n            error_seq = np.linalg.norm(c_seq - c_mono) / norm_mono\n            error_strang = np.linalg.norm(c_strang - c_mono) / norm_mono\n\n        all_results.append(error_seq)\n        all_results.append(error_strang)\n    \n    # Use 'g' format for robust scientific notation\n    print_str = \",\".join([f\"{r:.15g}\" for r in all_results])\n    print(f\"[{print_str}]\")\n\nsolve()\n```"
        }
    ]
}