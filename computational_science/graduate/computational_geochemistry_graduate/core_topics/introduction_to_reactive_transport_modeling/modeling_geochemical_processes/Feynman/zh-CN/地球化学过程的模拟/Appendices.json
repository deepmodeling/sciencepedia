{
    "hands_on_practices": [
        {
            "introduction": "任何地球化学系统的建模都始于一个关键步骤：将潜在的化学原理转化为一个精确的数学框架。本练习将以无处不在的海洋碳酸盐体系为例，引导你完成这一基础过程。通过推导一个描述系统平衡状态的单一残差函数，你将掌握构建可进行数值求解问题的核心技能，这是所有形态模拟的基石。",
            "id": "4086594",
            "problem": "分析一份在恒定温度和盐度下封闭、等温的海水样品中的溶解无机碳（DIC）和总碱度。设测得的溶解无机碳（DIC）为 $C_{\\mathrm{T}}$，测得的总碱度为 $A_{\\mathrm{T}}$。酸度标度由氢离子活度定义，其中自由氢标度下的 $\\mathrm{pH}$ 定义为 $\\mathrm{pH} = -\\log_{10}(a_{\\mathrm{H^+}})$，其中 $a_{\\mathrm{H^+}}$ 是氢离子 $\\mathrm{H^+}$ 的活度。活度 $a_i$ 和摩尔浓度 $[i]$ 通过 $a_i = \\gamma_i [i]$ 相关联，其中 $\\gamma_i$ 是在由盐度设定的给定离子强度下特定物质的活度系数。假设系统在以下约束和定义下，关于碳酸盐和硼酸盐的酸碱反应以及水的自递质子作用已达到平衡：\n\n- 碳酸盐平衡由基于活度的酸解离常数 $K_1$ 和 $K_2$ 控制，定义为 $K_1 = \\dfrac{a_{\\mathrm{HCO_3^-}} a_{\\mathrm{H^+}}}{a_{\\mathrm{CO_2^*}}}$ 和 $K_2 = \\dfrac{a_{\\mathrm{CO_3^{2-}}} a_{\\mathrm{H^+}}}{a_{\\mathrm{HCO_3^-}}}$，其中 $\\mathrm{CO_2^*}$ 表示 $\\mathrm{CO_2(aq)} + \\mathrm{H_2CO_3}$ 的总和。\n- 硼酸盐平衡由基于活度的酸解离常数 $K_{\\mathrm{B}} = \\dfrac{a_{\\mathrm{B(OH)_4^-}} a_{\\mathrm{H^+}}}{a_{\\mathrm{B(OH)_3}}}$ 控制，其中总硼 $B_{\\mathrm{T}}$ 通过一个已知的经验关系（此处视为给定参数）由盐度决定。\n- 水的自递质子作用由热力学常数 $K_{\\mathrm{w}} = a_{\\mathrm{H^+}} a_{\\mathrm{OH^-}}$ 描述。\n\n假设磷酸盐、硅酸盐、有机酸/碱以及次要的酸碱体系可以忽略不计，并且强离子背景由盐度固定，因此总碱度 $A_{\\mathrm{T}}$ 的定义简化为标准的碳酸盐-硼酸盐-水形式。在此假设下，总碱度可以表示为相对于参考酸的净碱过量，具体为\n$$\nA_{\\mathrm{T}} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{B(OH)_4^-}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}] \\, .\n$$\n\n质量平衡定义为\n$$\nC_{\\mathrm{T}} = [\\mathrm{CO_2^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\n\\quad\\text{和}\\quad\nB_{\\mathrm{T}} = [\\mathrm{B(OH)_3}] + [\\mathrm{B(OH)_4^-}] \\, .\n$$\n\n严格从上述基于活度的平衡定义、质量平衡以及通过 $A_{\\mathrm{T}}$ 形式化的电中性出发，推导一个关于氢离子活度的单一标量残差函数 $R(a_{\\mathrm{H^+}})$。当 $a_{\\mathrm{H^+}}$ 与在给定温度和盐度下测得的 $C_{\\mathrm{T}}$ 和 $A_{\\mathrm{T}}$ 一致时，该函数在平衡时为零。您的推导必须：\n\n- 仅使用基于活度的常数 $K_1$、$K_2$、$K_{\\mathrm{B}}$ 和 $K_{\\mathrm{w}}$ 以及活度系数 $\\gamma_i$。\n- 消除所有未知的中间活度和浓度 $\\mathrm{CO_2^*}$、$\\mathrm{HCO_3^-}$、$\\mathrm{CO_3^{2-}}$、$\\mathrm{B(OH)_3}$、$\\mathrm{B(OH)_4^-}$ 和 $\\mathrm{OH^-}$，用 $a_{\\mathrm{H^+}}$、$C_{\\mathrm{T}}$、$B_{\\mathrm{T}}$ 和常数来表示。\n- 得到一个封闭形式的解析表达式 $R(a_{\\mathrm{H^+}})$，该表达式仅依赖于 $a_{\\mathrm{H^+}}$、$C_{\\mathrm{T}}$、$A_{\\mathrm{T}}$、$B_{\\mathrm{T}}$、$K_1$、$K_2$、$K_{\\mathrm{B}}$、$K_{\\mathrm{w}}$ 以及相关的 $\\gamma_i$，且适用于数值求根。\n\n将最终残差 $R(a_{\\mathrm{H^+}})$ 显式地表示为 $a_{\\mathrm{H^+}}$ 的函数，不引入除指定变量外的任何额外变量。最终答案必须是单一的封闭形式解析表达式，而不是一个方程。不需要进行数值计算，也不适用四舍五入。",
            "solution": "问题要求推导一个单一标量残差函数 $R(a_{\\mathrm{H^+}})$，当氢离子活度 $a_{\\mathrm{H^+}}$ 与测得的溶解无机碳 $C_{\\mathrm{T}}$ 和总碱度 $A_{\\mathrm{T}}$ 一致时，该函数等于零。该函数必须用给定的参数表示：$a_{\\mathrm{H^+}}$、$C_{\\mathrm{T}}$、$A_{\\mathrm{T}}$、$B_{\\mathrm{T}}$、基于活度的平衡常数 $K_1$、$K_2$、$K_{\\mathrm{B}}$、$K_{\\mathrm{w}}$ 以及相关的活度系数 $\\gamma_i$。\n\n一个合适的残差函数可以定义为由系统状态（由 $a_{\\mathrm{H^+}}$、$C_{\\mathrm{T}}$ 和 $B_{\\mathrm{T}}$ 定义）计算出的碱度与测得的碱度 $A_{\\mathrm{T}}$ 之间的差值。让我们将计算出的碱度表示为 $A_{\\mathrm{T,calc}}$。那么残差函数为：\n$$\nR(a_{\\mathrm{H^+}}) = A_{\\mathrm{T,calc}}(a_{\\mathrm{H^+}}, C_{\\mathrm{T}}, B_{\\mathrm{T}}) - A_{\\mathrm{T}}\n$$\n问题以摩尔浓度形式给出了总碱度的定义：\n$$\nA_{\\mathrm{T}} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{B(OH)_4^-}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]\n$$\n我们的任务是将右侧的每一种浓度表示为 $a_{\\mathrm{H^+}}$、总浓度 $C_{\\mathrm{T}}$ 和 $B_{\\mathrm{T}}$ 以及基本常数的函数。\n\n为了便于推导，首先定义化学计量平衡常数是方便的，这些常数是关联某些物种（此处为 $\\mathrm{H^+}$）的活度与其他物种浓度的“混合”常数。这些在化学海洋学中是标准做法，并将在最后被替换掉以满足问题的约束条件。\n\n基于活度的常数 $K_1$ 是 $K_1 = \\frac{a_{\\mathrm{HCO_3^-}} a_{\\mathrm{H^+}}}{a_{\\mathrm{CO_2^*}}}$。使用关系 $a_i = \\gamma_i [i]$，我们有 $K_1 = \\frac{\\gamma_{\\mathrm{HCO_3^-}}[\\mathrm{HCO_3^-}] a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{CO_2^*}}[\\mathrm{CO_2^*}]}$。我们将化学计量常数 $K'_1$ 定义为：\n$$\nK'_1 = \\frac{[\\mathrm{HCO_3^-}] a_{\\mathrm{H^+}}}{[\\mathrm{CO_2^*}]} = K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\n$$\n类似地，对于第二个碳酸盐平衡和硼酸盐平衡：\n$$\nK'_2 = \\frac{[\\mathrm{CO_3^{2-}}] a_{\\mathrm{H^+}}}{[\\mathrm{HCO_3^-}]} = K_2 \\frac{\\gamma_{\\mathrm{HCO_3^-}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\n$$\n$$\nK'_{\\mathrm{B}} = \\frac{[\\mathrm{B(OH)_4^-}] a_{\\mathrm{H^+}}}{[\\mathrm{B(OH)_3}]} = K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}\n$$\n\n现在，我们逐项推导对 $A_{\\mathrm{T,calc}}$ 的贡献。\n\n**1. 碳酸盐体系的贡献 ($A_{\\mathrm{C}}$)**\n\n总溶解无机碳为 $C_{\\mathrm{T}} = [\\mathrm{CO_2^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$。\n使用 $K'_1$ 和 $K'_2$ 的定义，我们将 $[\\mathrm{CO_2^*}]$ 和 $[\\mathrm{CO_3^{2-}}]$ 表示为 $[\\mathrm{HCO_3^-}]$ 和 $a_{\\mathrm{H^+}}$ 的函数：\n$$\n[\\mathrm{CO_2^*}] = \\frac{[\\mathrm{HCO_3^-}] a_{\\mathrm{H^+}}}{K'_1}, \\quad [\\mathrm{CO_3^{2-}}] = \\frac{K'_2 [\\mathrm{HCO_3^-}]}{a_{\\mathrm{H^+}}}\n$$\n代入 $C_{\\mathrm{T}}$ 方程：\n$$\nC_{\\mathrm{T}} = [\\mathrm{HCO_3^-}] \\left( \\frac{a_{\\mathrm{H^+}}}{K'_1} + 1 + \\frac{K'_2}{a_{\\mathrm{H^+}}} \\right) = [\\mathrm{HCO_3^-}] \\frac{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2}{K'_1 a_{\\mathrm{H^+}}}\n$$\n求解碳酸氢根和碳酸根的浓度：\n$$\n[\\mathrm{HCO_3^-}] = C_{\\mathrm{T}} \\frac{K'_1 a_{\\mathrm{H^+}}}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2}\n$$\n$$\n[\\mathrm{CO_3^{2-}}] = \\frac{K'_2}{a_{\\mathrm{H^+}}} [\\mathrm{HCO_3^-}] = C_{\\mathrm{T}} \\frac{K'_1 K'_2}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2}\n$$\n碳酸盐对碱度的贡献是 $A_{\\mathrm{C}} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}]$：\n$$\nA_{\\mathrm{C}} = C_{\\mathrm{T}} \\left( \\frac{K'_1 a_{\\mathrm{H^+}}}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2} + \\frac{2K'_1 K'_2}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2} \\right) = C_{\\mathrm{T}} \\frac{K'_1 a_{\\mathrm{H^+}} + 2K'_1 K'_2}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2}\n$$\n\n**2. 硼酸盐体系的贡献 ($A_{\\mathrm{B}}$)**\n\n总硼为 $B_{\\mathrm{T}} = [\\mathrm{B(OH)_3}] + [\\mathrm{B(OH)_4^-}]$。\n根据 $K'_{\\mathrm{B}}$ 的定义，我们有 $[\\mathrm{B(OH)_3}] = \\frac{[\\mathrm{B(OH)_4^-}] a_{\\mathrm{H^+}}}{K'_{\\mathrm{B}}}$。\n代入 $B_{\\mathrm{T}}$ 方程：\n$$\nB_{\\mathrm{T}} = [\\mathrm{B(OH)_4^-}] \\left( \\frac{a_{\\mathrm{H^+}}}{K'_{\\mathrm{B}}} + 1 \\right) = [\\mathrm{B(OH)_4^-}] \\frac{a_{\\mathrm{H^+}} + K'_{\\mathrm{B}}}{K'_{\\mathrm{B}}}\n$$\n硼酸盐对碱度的贡献是 $A_{\\mathrm{B}} = [\\mathrm{B(OH)_4^-}]$：\n$$\nA_{\\mathrm{B}} = B_{\\mathrm{T}} \\frac{K'_{\\mathrm{B}}}{a_{\\mathrm{H^+}} + K'_{\\mathrm{B}}}\n$$\n\n**3. 水的自递质子作用的贡献 ($A_{\\mathrm{W}}$)**\n\n剩下的项是 $[\\mathrm{OH^-}]$ 和 $[\\mathrm{H^+}]$。\n从 $K_{\\mathrm{w}} = a_{\\mathrm{H^+}} a_{\\mathrm{OH^-}}$，我们得到 $a_{\\mathrm{OH^-}} = K_{\\mathrm{w}} / a_{\\mathrm{H^+}}$。浓度为 $[\\mathrm{OH^-}] = a_{\\mathrm{OH^-}} / \\gamma_{\\mathrm{OH^-}} = \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}}$。\n氢离子浓度为 $[\\mathrm{H^+}] = a_{\\mathrm{H^+}} / \\gamma_{\\mathrm{H^+}}$。\n来自水和氢离子的贡献是 $A_{\\mathrm{W}} = [\\mathrm{OH^-}] - [\\mathrm{H^+}]$：\n$$\nA_{\\mathrm{W}} = \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}} - \\frac{a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{H^+}}}\n$$\n\n**4. 组合残差函数**\n\n结合所有贡献，计算出的总碱度为：\n$$\nA_{\\mathrm{T,calc}} = A_{\\mathrm{C}} + A_{\\mathrm{B}} + A_{\\mathrm{W}} = C_{\\mathrm{T}} \\frac{K'_1 a_{\\mathrm{H^+}} + 2K'_1 K'_2}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2} + B_{\\mathrm{T}} \\frac{K'_{\\mathrm{B}}}{a_{\\mathrm{H^+}} + K'_{\\mathrm{B}}} + \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}} - \\frac{a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{H^+}}}\n$$\n因此，残差函数 $R(a_{\\mathrm{H^+}}) = A_{\\mathrm{T,calc}} - A_{\\mathrm{T}}$ 为：\n$$\nR(a_{\\mathrm{H^+}}) = C_{\\mathrm{T}} \\frac{K'_1 a_{\\mathrm{H^+}} + 2K'_1 K'_2}{(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2} + B_{\\mathrm{T}} \\frac{K'_{\\mathrm{B}}}{a_{\\mathrm{H^+}} + K'_{\\mathrm{B}}} + \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}} - \\frac{a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{H^+}}} - A_{\\mathrm{T}}\n$$\n\n**5. 用基本常数表示的最终表达式**\n\n最后，我们将化学计量常数（$K'_1, K'_2, K'_{\\mathrm{B}}$）的定义代回到 $R(a_{\\mathrm{H^+}})$ 的表达式中，以满足题目陈述的明确要求。\n\n对于碳酸盐项的分子：$K'_1 a_{\\mathrm{H^+}} + 2K'_1 K'_2 = \\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + 2\\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)$。\n对于碳酸盐项的分母：$(a_{\\mathrm{H^+}})^2 + K'_1 a_{\\mathrm{H^+}} + K'_1 K'_2 = (a_{\\mathrm{H^+}})^2 + \\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + \\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)$。\n对于硼酸盐项：$K'_{\\mathrm{B}} = K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}$。\n\n代入这些即可得到残差函数 $R(a_{\\mathrm{H^+}})$ 的最终完整表达式。该表达式仅依赖于 $a_{\\mathrm{H^+}}$ 和指定的已知参数。\n$$\nR(a_{\\mathrm{H^+}}) = C_{\\mathrm{T}} \\frac{\\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + 2\\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)}{(a_{\\mathrm{H^+}})^2 + \\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + \\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)} + B_{\\mathrm{T}} \\frac{K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}}{a_{\\mathrm{H^+}} + K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}} + \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}} - \\frac{a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{H^+}}} - A_{\\mathrm{T}}\n$$\n这就是所需的封闭形式解析表达式，适用于通过数值求根来确定海水样品的平衡 $a_{\\mathrm{H^+}}$。",
            "answer": "$$\\boxed{C_{\\mathrm{T}} \\frac{\\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + 2\\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)}{(a_{\\mathrm{H^+}})^2 + \\left(K_1 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{HCO_3^-}}}\\right) a_{\\mathrm{H^+}} + \\left(K_1 K_2 \\frac{\\gamma_{\\mathrm{CO_2^*}}}{\\gamma_{\\mathrm{CO_3^{2-}}}}\\right)} + B_{\\mathrm{T}} \\frac{K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}}{a_{\\mathrm{H^+}} + K_{\\mathrm{B}} \\frac{\\gamma_{\\mathrm{B(OH)_3}}}{\\gamma_{\\mathrm{B(OH)_4^-}}}} + \\frac{K_{\\mathrm{w}}}{a_{\\mathrm{H^+}} \\gamma_{\\mathrm{OH^-}}} - \\frac{a_{\\mathrm{H^+}}}{\\gamma_{\\mathrm{H^+}}} - A_{\\mathrm{T}}}$$"
        },
        {
            "introduction": "地球化学模型建立后，下一步通常是理解哪些过程和参数对系统行为的控制最强。这个动手编程练习介绍了灵敏度分析这一强大技术，让你能够量化特定化学反应对整体平衡的影响。通过学习计算自由金属浓度如何响应配合物稳定常数的变化，你将获得批判性评估和简化模型的能力，这是任何高级建模者必备的关键技能。",
            "id": "4086518",
            "problem": "考虑一个水溶液体系，其中含有一种金属物种 $M$ 和一组单齿配体 $\\{L_i\\}_{i=1}^N$，它们只形成 $1{:}1$ 的配合物 $ML_i$。假设为理想行为，即活度等于浓度。令 $K_i$ 表示配合物 $ML_i$ 的条件形成常数，$C_{\\mathrm{M}}^{\\mathrm{T}}$ 表示 $M$ 的总分析浓度，$C_i^{\\mathrm{T}}$ 表示配体 $L_i$ 的总分析浓度。目标是通过量化自由金属活度对单个稳定常数 $K_j$ 微小扰动的局部灵敏度，来分析简化假设（例如忽略次要配合物）在何种条件下有效。从基本定律出发，利用 $ML_i$ 形成的质量作用定律以及 $M$ 和每种 $L_i$ 的质量平衡关系，推导出计算自由金属活度 $a_{\\mathrm{M}}$ 及其相对于 $K_j$ 的局部灵敏度所需的方程。\n\n您必须实现一个算法，该算法根据质量平衡和质量作用关系求解 $a_{\\mathrm{M}}$，而不依赖于任何简化公式，然后使用基于这些定律的适当微分法来评估局部对数灵敏度 $S_j = \\dfrac{\\partial \\ln a_{\\mathrm{M}}}{\\partial \\ln K_j}$。\n\n您的程序必须：\n- 将活度表示为无量纲量，并在固定条件下将所有 $K_i$ 视为无量纲的条件形成常数。\n- 求解由 $M$ 的质量平衡与配合物的质量作用关系耦合所构成的标量非线性方程，以获得 $a_{\\mathrm{M}}$。\n- 对于指定的索引 $j$，通过对控制方程进行隐式微分来计算局部对数灵敏度 $S_j = \\dfrac{\\partial \\ln a_{\\mathrm{M}}}{\\partial \\ln K_j}$。程序不应假定任何预先推导的灵敏度公式；它必须在程序逻辑中从第一性原理出发进行推导和实现。\n- 将每个最终灵敏度结果表示为不带单位的小数。\n\n测试套件规范：\n给定三个测试用例，它们涵盖了不同的地球化学过程背景（类滴定终点状态、蒸发和混合）。对于每个用例，使用指定的参数计算用于平衡计算的最终总浓度，然后计算给定 $j$ 的灵敏度 $S_j$。\n\n案例 $\\mathbf{1}$（类滴定终点状态）：\n- 配体数量 $N$：$3$。\n- 金属总浓度 $C_{\\mathrm{M}}^{\\mathrm{T}}$：$10^{-6}$。\n- 配体总浓度 $(C_1^{\\mathrm{T}}, C_2^{\\mathrm{T}}, C_3^{\\mathrm{T}})$：$(5 \\times 10^{-6}, 10^{-6}, 10^{-8})$。\n- 形成常数 $(K_1, K_2, K_3)$：$(10^{6}, 10^{4}, 10^{2})$。\n- 灵敏度指数 $j$：$3$。\n\n案例 $\\mathbf{2}$（蒸发）：\n- 配体数量 $N$：$3$。\n- 初始金属总浓度 $C_{\\mathrm{M},0}^{\\mathrm{T}}$：$10^{-9}$。\n- 初始配体总浓度 $(C_{1,0}^{\\mathrm{T}}, C_{2,0}^{\\mathrm{T}}, C_{3,0}^{\\mathrm{T}})$：$(10^{-9}, 10^{-10}, 10^{-12})$。\n- 体积收缩比 $\\phi$：$0.1$（最终体积等于初始体积乘以 $\\phi$）。\n- 通过将所有初始总浓度乘以 $1/\\phi$ 来计算最终分析总浓度。\n- 形成常数 $(K_1, K_2, K_3)$：$(10^{7}, 10^{5}, 10^{1})$。\n- 灵敏度指数 $j$：$3$。\n\n案例 $\\mathbf{3}$（混合）：\n- 配体数量 $N$：$3$。\n- 溶液 $\\mathrm{A}$ 的总浓度 $(C_{\\mathrm{M},\\mathrm{A}}^{\\mathrm{T}}, C_{1,\\mathrm{A}}^{\\mathrm{T}}, C_{2,\\mathrm{A}}^{\\mathrm{T}}, C_{3,\\mathrm{A}}^{\\mathrm{T}})$：$(10^{-5}, 10^{-6}, 0, 10^{-9})$。\n- 溶液 $\\mathrm{B}$ 的总浓度 $(C_{\\mathrm{M},\\mathrm{B}}^{\\mathrm{T}}, C_{1,\\mathrm{B}}^{\\mathrm{T}}, C_{2,\\mathrm{B}}^{\\mathrm{T}}, C_{3,\\mathrm{B}}^{\\mathrm{T}})$：$(10^{-7}, 0, 10^{-6}, 10^{-8})$。\n- 混合分数 $p$：$0.3$（最终混合物是 $p$ 份溶液 $\\mathrm{A}$ 和 $(1-p)$ 份溶液 $\\mathrm{B}$）。\n- 通过 $C_{\\mathrm{M}}^{\\mathrm{T}} = p\\,C_{\\mathrm{M},\\mathrm{A}}^{\\mathrm{T}} + (1-p)\\,C_{\\mathrm{M},\\mathrm{B}}^{\\mathrm{T}}$ 计算最终分析总浓度，并对每种配体的总浓度 $C_i^{\\mathrm{T}}$ 进行类似计算。\n- 形成常数 $(K_1, K_2, K_3)$：$(10^{5}, 10^{8}, 10^{2})$。\n- 灵敏度指数 $j$：$3$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，即 $[S_1,S_2,S_3]$，其中每个 $S_k$ 是为案例 $k$ 计算出的十进制灵敏度。将每个 $S_k$ 表示为不带单位的小数。不应打印任何其他文本。",
            "solution": "该问题要求推导并实现一种方法，用于计算水溶液体系中自由金属活度及其相对于给定形成常数的局部对数灵敏度。该分析将基于化学平衡的基本原理，即质量作用定律和质量守恒原理。\n\n令 $a_{\\mathrm{M}}$ 表示自由金属 $M$ 的活度（浓度），$a_i$ 表示自由配体 $L_i$ 的活度。该体系包含 $N$ 种此类配体。我们假设理想行为，即活度等于浓度。\n\n$1{:}1$ 配合物 $ML_i$ 的形成受反应 $M + L_i \\rightleftharpoons ML_i$ 控制。此平衡的质量作用定律由条件形成常数 $K_i$ 给出：\n$$K_i = \\frac{[ML_i]}{[M] [L_i]} = \\frac{a_{ML_i}}{a_{\\mathrm{M}} a_i}$$\n其中 $a_{ML_i}$ 是配合物的活度。可将其重新整理以表示配合物浓度为：\n$$a_{ML_i} = K_i a_{\\mathrm{M}} a_i$$\n\n质量平衡方程表示总分析浓度的守恒，金属的总分析浓度记为 $C_{\\mathrm{M}}^{\\mathrm{T}}$，每种配体 $L_i$ 的总分析浓度记为 $C_i^{\\mathrm{T}}$。\n总金属浓度是自由金属和所有配合物形态的总和：\n$$C_{\\mathrm{M}}^{\\mathrm{T}} = [M] + \\sum_{i=1}^{N} [ML_i] = a_{\\mathrm{M}} + \\sum_{i=1}^{N} K_i a_{\\mathrm{M}} a_i$$\n每种配体 $L_i$ 的总浓度是其自由形态和配合物形态的总和：\n$$C_i^{\\mathrm{T}} = [L_i] + [ML_i] = a_i + K_i a_{\\mathrm{M}} a_i = a_i (1 + K_i a_{\\mathrm{M}})$$\n从配体的质量平衡中，我们可以用 $a_{\\mathrm{M}}$ 和已知的总浓度来表示自由配体活度 $a_i$：\n$$a_i = \\frac{C_i^{\\mathrm{T}}}{1 + K_i a_{\\mathrm{M}}}$$\n\n为获得自由金属活度 $a_{\\mathrm{M}}$ 的单一控制方程，我们将 $a_i$ 的表达式代入金属质量平衡方程：\n$$C_{\\mathrm{M}}^{\\mathrm{T}} = a_{\\mathrm{M}} + \\sum_{i=1}^{N} K_i a_{\\mathrm{M}} \\left( \\frac{C_i^{\\mathrm{T}}}{1 + K_i a_{\\mathrm{M}}} \\right) = a_{\\mathrm{M}} \\left( 1 + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}}}{1 + K_i a_{\\mathrm{M}}} \\right)$$\n这是一个关于单一未知数 $a_{\\mathrm{M}}$ 的标量非线性方程。为了对其进行数值求解，我们定义一个残差函数 $f(a_{\\mathrm{M}})$ 并求其根：\n$$f(a_{\\mathrm{M}}) = a_{\\mathrm{M}} \\left( 1 + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}}}{1 + K_i a_{\\mathrm{M}}} \\right) - C_{\\mathrm{M}}^{\\mathrm{T}} = 0$$\n$f(a_{\\mathrm{M}}) = 0$ 的解必须位于物理上有意义的区间 $(0, C_{\\mathrm{M}}^{\\mathrm{T}}]$ 内。可以使用诸如 Brent 法之类的数值求根算法在该区间内找到 $a_{\\mathrm{M}}$。\n\n问题的第二部分是计算局部对数灵敏度 $S_j$，其定义为：\n$$S_j = \\frac{\\partial \\ln a_{\\mathrm{M}}}{\\partial \\ln K_j}$$\n使用链式法则进行微分，可将其重写为：\n$$S_j = \\frac{\\partial \\ln a_{\\mathrm{M}}}{\\partial a_{\\mathrm{M}}} \\cdot \\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j} \\cdot \\frac{\\partial K_j}{\\partial \\ln K_j} = \\frac{1}{a_{\\mathrm{M}}} \\cdot \\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j} \\cdot K_j = \\frac{K_j}{a_{\\mathrm{M}}} \\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j}$$\n为了求导数 $\\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j}$，我们对控制方程 $f(a_{\\mathrm{M}}, \\{K_i\\}_{i=1}^N) = 0$ 应用隐式微分。$f$ 的全微分为零：\n$$df = \\frac{\\partial f}{\\partial a_{\\mathrm{M}}} da_{\\mathrm{M}} + \\sum_{i=1}^{N} \\frac{\\partial f}{\\partial K_i} dK_i = 0$$\n考虑到仅对 $K_j$ 进行扰动，同时保持其他常数不变（即，对于 $i \\neq j$，$dK_i=0$），该式简化为：\n$$\\frac{\\partial f}{\\partial a_{\\mathrm{M}}} \\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j} + \\frac{\\partial f}{\\partial K_j} = 0 \\implies \\frac{\\partial a_{\\mathrm{M}}}{\\partial K_j} = - \\frac{\\partial f / \\partial K_j}{\\partial f / \\partial a_{\\mathrm{M}}}$$\n现在我们必须从 $f$ 的表达式中计算这两个偏导数。\n关于 $a_{\\mathrm{M}}$ 的偏导数为：\n$$\\frac{\\partial f}{\\partial a_{\\mathrm{M}}} = \\frac{\\partial}{\\partial a_{\\mathrm{M}}} \\left[ a_{\\mathrm{M}} + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}} a_{\\mathrm{M}}}{1 + K_i a_{\\mathrm{M}}} - C_{\\mathrm{M}}^{\\mathrm{T}} \\right] = 1 + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}}}{(1 + K_i a_{\\mathrm{M}})^2}$$\n关于特定形成常数 $K_j$ 的偏导数仅影响求和中的第 $j$ 项：\n$$\\frac{\\partial f}{\\partial K_j} = \\frac{\\partial}{\\partial K_j} \\left[ \\frac{K_j C_j^{\\mathrm{T}} a_{\\mathrm{M}}}{1 + K_j a_{\\mathrm{M}}} \\right] = \\frac{C_j^{\\mathrm{T}} a_{\\mathrm{M}}}{(1 + K_j a_{\\mathrm{M}})^2}$$\n将这些导数代回 $S_j$ 的表达式中：\n$$S_j = \\frac{K_j}{a_{\\mathrm{M}}} \\left( - \\frac{\\frac{C_j^{\\mathrm{T}} a_{\\mathrm{M}}}{(1 + K_j a_{\\mathrm{M}})^2}}{1 + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}}}{(1 + K_i a_{\\mathrm{M}})^2}} \\right)$$\n简化此表达式可得出灵敏度的最终公式：\n$$S_j = - \\frac{\\frac{K_j C_j^{\\mathrm{T}}}{(1 + K_j a_{\\mathrm{M}})^2}}{1 + \\sum_{i=1}^{N} \\frac{K_i C_i^{\\mathrm{T}}}{(1 + K_i a_{\\mathrm{M}})^2}}$$\n因此，算法如下：\n1. 对于每个测试用例，计算最终的总浓度 $C_{\\mathrm{M}}^{\\mathrm{T}}$ 和 $\\{C_i^{\\mathrm{T}}\\}$。\n2. 求解非线性方程 $f(a_{\\mathrm{M}}) = 0$ 以找到平衡状态下的自由金属活度 $a_{\\mathrm{M}}$。\n3. 将获得的 $a_{\\mathrm{M}}$ 值以及问题参数代入推导出的 $S_j$ 表达式中，以计算指定索引 $j$ 的灵敏度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Computes local logarithmic sensitivities for three geochemical scenarios.\n    \"\"\"\n\n    def calculate_sensitivity_for_case(C_M_T, C_L_T, K, j_idx):\n        \"\"\"\n        Calculates the equilibrium and sensitivity for a single case.\n\n        Args:\n            C_M_T (float): Total analytical concentration of the metal.\n            C_L_T (np.ndarray): Array of total analytical concentrations of ligands.\n            K (np.ndarray): Array of conditional formation constants.\n            j_idx (int): 0-based index of the ligand for sensitivity analysis.\n\n        Returns:\n            float: The calculated logarithmic sensitivity S_j.\n        \"\"\"\n        # 1. Define the residual function f(a_M) whose root is the equilibrium\n        #    free metal activity a_M.\n        #    f(a_M) = a_M * (1 + sum(K_i * C_i_T / (1 + K_i * a_M))) - C_M_T\n        def residual_f(a_M, C_M_T_arg, C_L_T_arg, K_arg):\n            sum_term = np.sum(K_arg * C_L_T_arg / (1.0 + K_arg * a_M))\n            return a_M * (1.0 + sum_term) - C_M_T_arg\n\n        # 2. Numerically solve for a_M using Brent's method.\n        # The physically valid search interval for a_M is (0, C_M_T]. We use a small\n        # positive value as the lower bound for numerical stability.\n        try:\n            a_M = optimize.brentq(\n                residual_f,\n                1e-30,\n                C_M_T,\n                args=(C_M_T, C_L_T, K)\n            )\n        except ValueError:\n            # This should not occur for the given well-posed problems.\n            return np.nan\n\n        # 3. Compute the local logarithmic sensitivity S_j from the derived formula:\n        #    S_j = - (numerator_j) / (denominator)\n        #    where numerator_j = (K_j * C_j_T) / (1 + K_j * a_M)^2\n        #    and denominator = 1 + sum_i [ (K_i * C_i_T) / (1 + K_i * a_M)^2 ]\n\n        # Calculate the numerator term for the specified index j\n        numerator_j = (K[j_idx] * C_L_T[j_idx]) / (1.0 + K[j_idx] * a_M)**2\n\n        # Calculate the denominator\n        all_terms_denom = (K * C_L_T) / (1.0 + K * a_M)**2\n        denominator = 1.0 + np.sum(all_terms_denom)\n\n        # Calculate the final sensitivity\n        S_j = -numerator_j / denominator\n        \n        return S_j\n\n    # --- Test Case 1: Titration-like end state ---\n    C_M_T1 = 1e-6\n    C_L_T1 = np.array([5e-6, 1e-6, 1e-8])\n    K1 = np.array([1e6, 1e4, 1e2])\n    j1 = 3  # 1-based index from problem statement\n\n    # --- Test Case 2: Evaporation ---\n    C_M0_2 = 1e-9\n    C_L0_T2 = np.array([1e-9, 1e-10, 1e-12])\n    phi2 = 0.1\n    K2 = np.array([1e7, 1e5, 1e1])\n    j2 = 3  # 1-based index\n\n    C_M_T2 = C_M0_2 / phi2\n    C_L_T2 = C_L0_T2 / phi2\n\n    # --- Test Case 3: Mixing ---\n    C_A = {'M': 1e-5, 'L1': 1e-6, 'L2': 0.0, 'L3': 1e-9}\n    C_B = {'M': 1e-7, 'L1': 0.0, 'L2': 1e-6, 'L3': 1e-8}\n    p3 = 0.3\n    K3 = np.array([1e5, 1e8, 1e2])\n    j3 = 3  # 1-based index\n\n    C_M_T3 = p3 * C_A['M'] + (1.0 - p3) * C_B['M']\n    C_L_T3 = np.array([\n        p3 * C_A['L1'] + (1.0 - p3) * C_B['L1'],\n        p3 * C_A['L2'] + (1.0 - p3) * C_B['L2'],\n        p3 * C_A['L3'] + (1.0 - p3) * C_B['L3']\n    ])\n\n    test_cases_params = [\n        {'C_M_T': C_M_T1, 'C_L_T': C_L_T1, 'K': K1, 'j_idx': j1 - 1},\n        {'C_M_T': C_M_T2, 'C_L_T': C_L_T2, 'K': K2, 'j_idx': j2 - 1},\n        {'C_M_T': C_M_T3, 'C_L_T': C_L_T3, 'K': K3, 'j_idx': j3 - 1}\n    ]\n\n    results = []\n    for params in test_cases_params:\n        s_j = calculate_sensitivity_for_case(**params)\n        results.append(s_j)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最复杂的地球化学模型，其可靠性也取决于输入的初始数据。本练习将直面一个在实际建模中常见且关键的挑战：如何协调来自不同来源、参考框架不一致的分析数据。通过诊断因单位和定义混用导致的电荷不平衡问题，你将学到数据验证的至关重要性，以及如何构建一个自洽的质量平衡，从而确保模型预测的完整性。",
            "id": "4086586",
            "problem": "一个环境地球化学实验室正在通过计算混合两个水样数据集，来模拟一个半咸水河口在同时混合和蒸发作用下的地球化学演化。该实验室收到了淡水样本A和盐水样本B的分析报告。分析员在无意中将来自不一致参考系的数据字段合并在一起。您的任务是论证电荷平衡闭合如何失效，然后提出一个协调的质量平衡重建方案以恢复电中性。\n\n使用的基本原理：\n\n- 电中性：任何溶液中正电荷当量之和等于负电荷当量之和，即 $$\\sum_i z_i c_i^{+} = \\sum_j |z_j| c_j^{-}.$$ 此处 $z_i$ 是离子电荷，$c$ 是基于共同基准的浓度。\n- 质量守恒：当混合等质量的水时，混合物中每种物质的质量摩尔浓度（毫摩尔/千克水）是各端元质量摩尔浓度的算术平均值。\n- 总碱度 (TA) 的定义：在天然水体中，$$\\mathrm{TA} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{B(OH)_4^-}] + \\dots + [\\mathrm{OH^-}] - [\\mathrm{H^+}],$$ 其中方括号表示质量摩尔浓度，省略号表示对碱度有贡献的其他弱碱（例如，磷酸盐和硅酸盐）。\n- 单位换算：$1$ 毫当量 (meq) 的一价电荷等于 $1$ 毫摩尔 (mmol) 的该离子；以 $\\mathrm{mg/L}$（作为 $\\mathrm{CaCO_3}$）报告的碱度，通过除以 $50\\ \\mathrm{mg/meq}$ 换算为 meq/L；体积摩尔浓度 (mmol/L) 通过除以溶液密度 (kg/L) 换算为质量摩尔浓度 (mmol/kg水)。\n\n端元数据集如下：\n\n- 淡水A（温度 $25\\ ^\\circ \\mathrm{C}$，基于质量摩尔浓度，即每千克水）：\n  - $[\\mathrm{Na^+}] = 2.50\\ \\mathrm{mmol/kgw}$，\n  - $[\\mathrm{Cl^-}] = 2.30\\ \\mathrm{mmol/kgw}$，\n  - $[\\mathrm{HCO_3^-}] = 0.20\\ \\mathrm{mmol/kgw}$，\n  - $[\\mathrm{CO_3^{2-}}] \\approx 0.00\\ \\mathrm{mmol/kgw}$ (与近中性相符)，\n  - $\\mathrm{TA}_A \\approx 0.20\\ \\mathrm{meq/kgw}$，\n  - $\\mathrm{pH}_{\\mathrm{free}} = 7.80$ (自由氢离子标度)。\n  这些值满足电中性：$$2.50 = 2.30 + 0.20.$$\n\n- 盐水B（温度 $25\\ ^\\circ \\mathrm{C}$，基于体积浓度报告，强离子和碱度分开报告）：\n  - $[\\mathrm{Na^+}] = 400.0\\ \\mathrm{mmol/L}$，\n  - $[\\mathrm{Cl^-}] = 397.7\\ \\mathrm{mmol/L}$，\n  - $\\mathrm{TA}_B = 115\\ \\mathrm{mg/L}$ as $\\mathrm{CaCO_3}$，\n  - $\\rho_B = 1.023\\ \\mathrm{kg/L}$ (溶液密度)，\n  - $\\mathrm{pH}_{\\mathrm{total}} = 8.10$ (总氢离子标度，包括硫酸氢根和氟离子的缔合)。\n  假设在电荷计算中，碳酸盐物质未单独提供，$\\mathrm{TA}_B$ 代表包括碳酸盐和硼酸盐在内的弱碱库。\n\n分析员混合了等质量的水（1千克水A和1千克水B），但错误地：\n(i) 将B的体积摩尔浓度当作质量摩尔浓度处理，\n(ii) 将 $115\\ \\mathrm{mg/L}$（作为 $\\mathrm{CaCO_3}$）直接解释为 $115\\ \\mathrm{meq/kgw}$ 的负电荷，\n(iii) 将 $\\mathrm{pH}_{\\mathrm{total}}$ 设为 $\\mathrm{pH}_{\\mathrm{free}}$，并在物种形成计算中忽略了硼酸盐碱度。\n\n第1部分。仅使用上述基本原理，在所描述的错误混合条件下，计算混合水中每千克的表观电荷不平衡，定义为 $$\\Delta q = \\sum z_i c_i^{+} - \\sum |z_j| c_j^{-},$$ 单位为 $\\mathrm{meq/kg}$（混合物）。将A的电荷视为完全平衡，对于B，仅包括 $\\mathrm{Na^+}$ 作为阳离子，$\\mathrm{Cl^-}$ 作为强阴离子，并将被错误解释的 $\\mathrm{TA}_B$ 完全计为负电荷当量。\n\n第2部分。选择最能正确陈述一个协调的质量平衡重建方案的选项，该方案可以恢复混合溶液的电中性，以便后续进行滴定、蒸发和混合的模拟。\n\nA. 表观不平衡约为混合物的 $-56.4\\ \\mathrm{meq/kg}$。为恢复电中性，应使用 $\\rho_B$ 将B的体积摩尔浓度重新换算为质量摩尔浓度，将 $\\mathrm{TA}_B$ 从 $\\mathrm{mg/L}$（作为 $\\mathrm{CaCO_3}$）换算为 $\\mathrm{meq/kgw}$，通过将 $\\mathrm{pH}_{\\mathrm{total}}$ 转换为自由标度或明确考虑硫酸盐和氟化物的络合来协调酸度，对于海水，应包括硼酸盐碱度，然后根据一致的 $\\mathrm{TA}$ 和 $\\mathrm{pH}$ 重新计算碳酸盐物种形成，最后在每千克水的基础上对所有物种进行质量平均。\n\nB. 表观不平衡约为混合物的 $-9.0\\ \\mathrm{meq/kg}$（由密度不匹配引起）。为恢复电中性，应从混合物中的 $[\\mathrm{Cl^-}]$ 和 $[\\mathrm{SO_4^{2-}}]$ 中均匀减去亏损部分，而不改变 $\\mathrm{TA}$ 或 $\\mathrm{pH}$。\n\nC. 表观不平衡约为混合物的 $-112.7\\ \\mathrm{meq/kg}$。为恢复电中性，应增加 $[\\mathrm{Na^+}]$ 直到阳离子电荷等于阴离子电荷，并保持所有其他物种不变，因为钠在混合中是保守的。\n\nD. 表观不平衡约为混合物的 $+56.4\\ \\mathrm{meq/kg}$。为恢复电中性，应假设活度系数恒定，将所有浓度按混合物的总离子强度进行归一化，这可以保证闭合。\n\n选择最佳选项。",
            "solution": "该问题要求完成两项任务。首先，在给定分析员做出的一系列特定错误假设下，计算计算混合水溶液中的表观电荷不平衡。其次，确定用于协调数据以恢复电中性的正确程序。\n\n### 步骤 1：问题验证\n\n**1. 提取已知条件：**\n- **基本原理**：\n  - 电中性：$\\sum_i z_i c_i^{+} = \\sum_j |z_j| c_j^{-}$\n  - 质量守恒：当混合等质量的水时，混合物中每种物质的质量摩尔浓度是各端元质量摩尔浓度的算术平均值。\n  - 总碱度 (TA) 定义：$\\mathrm{TA} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{B(OH)_4^-}] + \\dots + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$\n  - 单位换算：\n    - $1\\ \\mathrm{meq} = 1\\ \\mathrm{mmol}$（对于一价离子）。\n    - $\\mathrm{TA\\ (meq/L)} = \\mathrm{TA\\ (mg/L\\ as\\ CaCO_3)} / 50$。\n    - $c_{\\mathrm{molal}} \\approx c_{\\mathrm{molar}} / \\rho$，其中 $\\rho$ 是以 $\\mathrm{kg/L}$ 为单位的密度。\n- **淡水A（质量摩尔浓度基准，mmol/kgw）**：\n  - $[\\mathrm{Na^+}]_A = 2.50$, $[\\mathrm{Cl^-}]_A = 2.30$, $[\\mathrm{HCO_3^-}]_A = 0.20$, $[\\mathrm{CO_3^{2-}}]_A \\approx 0.00$。\n  - 电荷平衡：$2.50 = 2.30 + 0.20$。\n- **盐水B（体积摩尔浓度基准，mmol/L）**：\n  - $[\\mathrm{Na^+}]_B = 400.0$, $[\\mathrm{Cl^-}]_B = 397.7$。\n  - $\\mathrm{TA}_B = 115\\ \\mathrm{mg/L}$ as $\\mathrm{CaCO_3}$。\n  - $\\rho_B = 1.023\\ \\mathrm{kg/L}$。\n  - $\\mathrm{pH}_{\\mathrm{total}, B} = 8.10$。\n- **分析员的错误混合步骤**：\n  - 混合来自A的1千克水和来自B的1千克水。\n  - (i) 将B的体积摩尔浓度当作质量摩尔浓度处理（$c_M \\rightarrow c_m$）。\n  - (ii) 将 $115\\ \\mathrm{mg/L}$（作为 $\\mathrm{CaCO_3}$）当作 $115\\ \\mathrm{meq/kgw}$ 的负电荷。\n  - (iii) 假设 $\\mathrm{pH}_{\\mathrm{total}} = \\mathrm{pH}_{\\mathrm{free}}$。\n\n**2. 使用提取的已知条件进行验证：**\n- **科学依据**：该问题基于水地球化学的核心原理，包括质量平衡、电荷平衡（电中性）以及浓度单位和碱度的标准定义。这些都是基础且成熟的原理。\n- **问题的适定性**：问题定义清晰。它要求基于一套特定（错误）的规则进行计算，然后评估修正程序。完成这些任务所需的所有数据均已提供。\n- **客观性**：问题以精确、客观和定量的方式陈述。数据处理错误的场景是计算科学中一个现实的挑战。\n- **一致性与完整性**：问题是自洽的。它描述了一个数据处理不一致的场景，但要求对该不一致性进行量化并提出解决方案，这是一个一致的任务。\n- **结论**：该问题在科学上是合理的，适定的，客观的，并且不包含其他使其无效的缺陷。\n\n**判定**：问题陈述有效。\n\n### 步骤 2：解题推导\n\n**第1部分：计算表观电荷不平衡**\n\n目标是计算混合物中每千克的电荷不平衡 $\\Delta q = \\sum z_i c_i^{+} - \\sum |z_j| c_j^{-}$。混合物包含来自A的1千克水和来自B的1千克水，总共2千克水（$2\\ \\mathrm{kgw}$）。所有浓度都以每千克水为基础（质量摩尔浓度）进行评估。\n\n我们首先根据分析员的错误假设来确定混合物中的浓度。混合物中任何物质的质量摩尔浓度 $c_{\\mathrm{mix}}$ 是端元质量摩尔浓度的算术平均值：$c_{\\mathrm{mix}} = (c_A + c_B)/2$。\n\n- **端元A的浓度（质量摩尔，meq/kgw 用于电荷计算）**：\n  - 阳离子：$[\\mathrm{Na^+}]_A = 2.50\\ \\mathrm{meq/kgw}$。\n  - 阴离子：$[\\mathrm{Cl^-}]_A + [\\mathrm{HCO_3^-}]_A = 2.30 + 0.20 = 2.50\\ \\mathrm{meq/kgw}$。\n  - 溶液A是电荷平衡的。\n\n- **端元B的浓度（根据分析员的错误解释）**：\n  - 错误(i)：体积摩尔浓度被当作质量摩尔浓度处理。\n    - 表观 $[\\mathrm{Na^+}]_B = 400.0\\ \\mathrm{mmol/kgw} = 400.0\\ \\mathrm{meq/kgw}$。\n    - 表观 $[\\mathrm{Cl^-}]_B = 397.7\\ \\mathrm{mmol/kgw} = 397.7\\ \\mathrm{meq/kgw}$。\n  - 错误(ii)：$\\mathrm{TA}_B$ 被错误解释。\n    - 表观 $\\mathrm{TA}_B = 115\\ \\mathrm{meq/kgw}$。这被视为一个负电荷贡献。\n\n- **混合物浓度（错误的，每千克水）**：\n  混合物总共含有 $2\\ \\mathrm{kgw}$。每种物质的总电荷是其在1千克水A和1千克水B中贡献的总和。\n  - 总正电荷（来自 $\\mathrm{Na^+}$）：\n    $$Q^+_{\\text{total}} = ([\\mathrm{Na^+}]_A \\times 1\\ \\mathrm{kgw}) + (\\text{Apparent }[\\mathrm{Na^+}]_B \\times 1\\ \\mathrm{kgw})$$\n    $$Q^+_{\\text{total}} = (2.50\\ \\mathrm{meq}) + (400.0\\ \\mathrm{meq}) = 402.5\\ \\mathrm{meq}$$\n  - 总负电荷（来自 $\\mathrm{Cl^-}$ 和所有碱度形式）：问题陈述“对于B，仅包括 $\\mathrm{Na^+}$ 作为阳离子，$\\mathrm{Cl^-}$ 作为强阴离子，并将被错误解释的 $\\mathrm{TA}_B$ 完全计为负电荷当量。”对于溶液A，阴离子的负电荷为 $2.50\\ \\mathrm{meq/kgw}$。因此，在混合物中：\n    $$Q^-_{\\text{total}} = (\\text{Anions}_A \\times 1\\ \\mathrm{kgw}) + ((\\text{Apparent }[\\mathrm{Cl^-}]_B + \\text{Apparent }\\mathrm{TA}_B) \\times 1\\ \\mathrm{kgw})$$\n    $$Q^-_{\\text{total}} = (2.50\\ \\mathrm{meq}) + ((397.7 + 115)\\ \\mathrm{meq}) = 2.50 + 512.7 = 515.2\\ \\mathrm{meq}$$\n    或者，我们可以对混合物中的每种物质求和。总Cl电荷 = $(2.30 + 397.7)\\ \\mathrm{meq} = 400.0\\ \\mathrm{meq}$。总TA电荷 = $(0.20 + 115)\\ \\mathrm{meq} = 115.2\\ \\mathrm{meq}$。总负电荷 = $400.0 + 115.2 = 515.2\\ \\mathrm{meq}$。这是一致的。\n\n- **电荷不平衡计算**：\n  $2\\ \\mathrm{kgw}$ 混合物中的总电荷不平衡为：\n  $$\\Delta Q_{\\text{total}} = Q^+_{\\text{total}} - Q^-_{\\text{total}} = 402.5 - 515.2 = -112.7\\ \\mathrm{meq}$$\n  问题要求的是混合水中*每千克*的电荷不平衡，这是一个强度性质。我们将总不平衡量除以水的总质量：\n  $$\\Delta q = \\frac{\\Delta Q_{\\text{total}}}{2\\ \\mathrm{kgw}} = \\frac{-112.7\\ \\mathrm{meq}}{2\\ \\mathrm{kgw}} = -56.35\\ \\mathrm{meq/kgw}$$\n  这个值约等于 $-56.4\\ \\mathrm{meq/kgw}$。负号表示负电荷过量。\n\n**第2部分：选项评估**\n\n现在我们根据计算出的不平衡量和所提出的协调方案的科学有效性来评估每个选项。\n\n**A. 表观不平衡约为混合物的 $-56.4\\ \\mathrm{meq/kg}$。为恢复电中性，应使用 $\\rho_B$ 将B的体积摩尔浓度重新换算为质量摩尔浓度，将 $\\mathrm{TA}_B$ 从 $\\mathrm{mg/L}$（作为 $\\mathrm{CaCO_3}$）换算为 $\\mathrm{meq/kgw}$，通过将 $\\mathrm{pH}_{\\mathrm{total}}$ 转换为自由标度或明确考虑硫酸盐和氟化物的络合来协调酸度，对于海水，应包括硼酸盐碱度，然后根据一致的 $\\mathrm{TA}$ 和 $\\mathrm{pH}$ 重新计算碳酸盐物种形成，最后在每千克水的基础上对所有物种进行质量平均。**\n\n- **不平衡计算**：值 $-56.4\\ \\mathrm{meq/kg}$ 与我们推导出的值 $-56.35\\ \\mathrm{meq/kgw}$ 相符。\n- **协调程序**：\n  - `使用 ρ_B 将B的体积摩尔浓度重新换算为质量摩尔浓度`：正确。这修正了错误(i)。\n  - `将 TA_B 从 mg/L (作为 CaCO3) 换算为 meq/kgw`：正确。这修正了错误(ii)。正确的换算是 $\\mathrm{TA (meq/kgw)} = (\\frac{115\\ \\mathrm{mg/L}}{50\\ \\mathrm{mg/meq}}) / 1.023\\ \\mathrm{kg/L} = 2.25\\ \\mathrm{meq/kgw}$，这与分析员的 $115\\ \\mathrm{meq/kgw}$ 相差甚远。\n  - `协调酸度...将 pH_total 转换为自由标度`：正确。这修正了错误(iii)，并且是一致的物种形成计算所必需的。\n  - `对于海水，应包括硼酸盐碱度`：正确。硼酸盐是盐水中碱度的重要组成部分，必须加以考虑。\n  - `重新计算碳酸盐物种形成...`：正确。这是在修正了输入参数TA和pH之后的一个必要步骤。\n  - `在每千克水的基础上对所有物种进行质量平均`：正确。这是正确的混合计算方法。\n- **判定**：**正确**。此选项准确地计算了不平衡量，并提供了一个全面、科学严谨的程序来纠正所有已识别的错误。\n\n**B. 表观不平衡约为混合物的 $-9.0\\ \\mathrm{meq/kg}$（由密度不匹配引起）。为恢复电中性，应从混合物中的 $[\\mathrm{Cl^-}]$ 和 $[\\mathrm{SO_4^{2-}}]$ 中均匀减去亏损部分，而不改变 $\\mathrm{TA}$ 或 $\\mathrm{pH}$。**\n\n- **不平衡计算**：值 $-9.0\\ \\mathrm{meq/kg}$ 不正确。这个值似乎源于单一离子因密度错误引起的浓度差异（例如，对于 $\\mathrm{Na^+}$，$400.0\\ \\mathrm{mmol/L} - (400.0/1.023)\\ \\mathrm{mmol/kgw} \\approx 9.0\\ \\mathrm{mmol/kgw}$），但这并非电荷不平衡。\n- **协调程序**：所提议的修复方案是武断且不科学的。它建议通过改变主要阴离子的浓度来强制平衡，而没有解决单位换算和碱度解释中已知的根本性错误。\n- **判定**：**不正确**。\n\n**C. 表观不平衡约为混合物的 $-112.7\\ \\mathrm{meq/kg}$。为恢复电中性，应增加 $[\\mathrm{Na^+}]$ 直到阳离子电荷等于阴离子电荷，并保持所有其他物种不变，因为钠在混合中是保守的。**\n\n- **不平衡计算**：值 $-112.7\\ \\mathrm{meq/kg}$ 是 $2\\ \\mathrm{kgw}$ 系统的总不平衡量，而不是混合物每千克的不平衡量。它也可能被解释为仅B端元每千克的不平衡量。无论哪种情况，它都不代表混合物*每千克*的不平衡量。\n- **协调程序**：这是一种武断的“凑数”方法。调整单一离子是最后的手段，而非主要方法，尤其是在已知存在明确的程序性错误时。它忽略了TA值和单位不匹配的主要错误。\n- **判定**：**不正确**。\n\n**D. 表观不平衡约为混合物的 $+56.4\\ \\mathrm{meq/kg}$。为恢复电中性，应假设活度系数恒定，将所有浓度按混合物的总离子强度进行归一化，这可以保证闭合。**\n\n- **不平衡计算**：符号错误。我们的计算明确显示负电荷过量，导致负的不平衡。\n- **协调程序**：所提议的方法在科学上是荒谬的。通过离子强度（$I = \\frac{1}{2} \\sum c_i z_i^2$）对浓度进行归一化，并没有强制电荷平衡（$\\sum c_i z_i = 0$）的理论基础。这不是一个有效的地球化学程序。\n- **判定**：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}