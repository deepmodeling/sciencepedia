{
    "hands_on_practices": [
        {
            "introduction": "部分平衡假设的核心在于时间尺度的分离：系统的内部反应比外部扰动或我们感兴趣的其它过程要快得多。本练习旨在将这一概念数学化。通过一个一级线性弛豫模型，你将推导出部分平衡假设的近似误差，并看到它如何直接与系统的内在弛豫时间尺度和外部扰动时间尺度的比率相关联。这个练习将帮助你建立一个量化框架，用以判断在何种条件下可以安全地使用部分平衡假设。",
            "id": "4104718",
            "problem": "一个与气体混合物处于平衡状态的含水溶液包裹，经历着二氧化碳分压 (pCO$_2$) 的缓慢变化，这扰动了碳酸盐的形态分布。碳酸盐系统受制于质量作用定律，涉及反应 $\\mathrm{CO_2(aq)} \\rightleftharpoons \\mathrm{H_2CO_3}$、$\\mathrm{H_2CO_3} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{HCO_3^-}$ 和 $\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}$，并需满足电荷平衡和质量守恒。在由当前 pCO$_2$ 决定的瞬时热力学平衡点附近，一个碳酸盐形态描述符 $x(t)$（例如，溶解无机碳中 $\\mathrm{HCO_3^-}$ 的摩尔分数）向其瞬时平衡值 $x_{\\mathrm{eq}}(t)$ 的调整过程，可以通过一个由线性化动力学导出的一阶线性弛豫模型来描述：\n$$\n\\frac{d x}{d t} \\;=\\; -\\frac{x - x_{\\mathrm{eq}}(t)}{\\tau_{\\mathrm{eq}}},\n$$\n其中 $\\tau_{\\mathrm{eq}}$ 是特征弛豫时间，它包含了耦合的酸碱水合-脱水网络中最慢的本征模。\n\n假设来自 pCO$_2$ 变化的外部强迫导致 $x_{\\mathrm{eq}}(t)$ 在一个特征扰动时间尺度 $\\tau_{\\mathrm{pert}}$ 上平滑变化，这意味着 $x_{\\mathrm{eq}}$ 的一个典型变化 $\\Delta x_{\\mathrm{eq}}$ 发生在一个量级为 $\\tau_{\\mathrm{pert}}$ 的时间间隔内。将部分平衡假设（即设 $x(t) \\approx x_{\\mathrm{eq}}(t)$）的分数误差定义为，由 pCO$_2$ 扰动引起的偏差 $|x(t) - x_{\\mathrm{eq}}(t)|$ 与特征变化幅度 $|\\Delta x_{\\mathrm{eq}}|$ 的主阶比值。\n\n严格地从上述弛豫模型和扰动时间尺度的定义出发，推导这个主阶分数误差关于无量纲比率 $\\epsilon = \\tau_{\\mathrm{eq}} / \\tau_{\\mathrm{pert}}$ 的解析表达式。然后，对于 $\\tau_{\\mathrm{eq}}/\\tau_{\\mathrm{pert}} = 0.05$ 的情况，评估分数误差。将最终答案表示为一个无量纲数。如果需要四舍五入，请将答案保留到四位有效数字。",
            "solution": "问题要求推导部分平衡假设的主阶分数误差。该假设假定系统的状态变量 $x(t)$ 紧密跟随其随时间变化的平衡值 $x_{\\mathrm{eq}}(t)$。\n\n出发点是给定的一阶线性弛豫模型：\n$$\n\\frac{d x}{d t} \\;=\\; -\\frac{x(t) - x_{\\mathrm{eq}}(t)}{\\tau_{\\mathrm{eq}}}\n$$\n其中 $x(t)$ 是状态变量，$x_{\\mathrm{eq}}(t)$ 是其瞬时平衡值，$\\tau_{\\mathrm{eq}}$ 是特征弛豫时间。\n\n我们关心的是系统偏离平衡的程度，即量 $x(t) - x_{\\mathrm{eq}}(t)$。我们可以重新整理模型方程来直接表示这个偏差：\n$$\nx(t) - x_{\\mathrm{eq}}(t) = -\\tau_{\\mathrm{eq}} \\frac{dx}{dt}\n$$\n问题的核心在于将 $\\frac{dx}{dt}$ 与由 $\\frac{dx_{\\mathrm{eq}}}{dt}$ 表示的外部施加的平衡状态变化联系起来。部分平衡假设 $x(t) \\approx x_{\\mathrm{eq}}(t)$ 在外部扰动相对于系统内部弛豫较慢时成立。这个条件可以正式表述为 $\\tau_{\\mathrm{pert}} \\gg \\tau_{\\mathrm{eq}}$，其中 $\\tau_{\\mathrm{pert}}$ 是扰动的特征时间尺度。这对应于无量纲比率 $\\epsilon = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}$ 远小于 $1$。\n\n为了形式化这个近似，我们定义偏差变量 $y(t) = x(t) - x_{\\mathrm{eq}}(t)$。对这个定义关于时间 $t$ 求导，得到 $\\frac{dy}{dt} = \\frac{dx}{dt} - \\frac{dx_{\\mathrm{eq}}}{dt}$。\n将 $x(t) = y(t) + x_{\\mathrm{eq}}(t)$ 和 $\\frac{dx}{dt} = \\frac{dy}{dt} + \\frac{dx_{\\mathrm{eq}}}{dt}$ 代入原始弛豫模型，得到一个关于偏差 $y(t)$ 的方程：\n$$\n\\frac{dy}{dt} + \\frac{dx_{\\mathrm{eq}}}{dt} = -\\frac{y(t)}{\\tau_{\\mathrm{eq}}}\n$$\n整理后得到一个关于 $y(t)$ 的标准一阶线性常微分方程：\n$$\n\\frac{dy}{dt} + \\frac{1}{\\tau_{\\mathrm{eq}}} y(t) = -\\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n这个方程描述了偏差 $y(t)$ 是如何被平衡状态的变化率驱动的。我们可以在 $\\epsilon \\ll 1$ 的极限下，使用时间尺度分析来分析这个方程的行为。\n\n问题指出 $x_{\\mathrm{eq}}(t)$ 在时间尺度 $\\tau_{\\mathrm{pert}}$ 上平滑变化。这意味着项 $-\\frac{dx_{\\mathrm{eq}}}{dt}$ 也在这个时间尺度上变化。因此，$y(t)$ 的受迫响应也将主要在时间尺度 $\\tau_{\\mathrm{pert}}$ 上变化。这使我们能够估计导数 $\\frac{dy}{dt}$ 的数量级：\n$$\n\\left| \\frac{dy}{dt} \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{pert}}}\n$$\n其中 $|Y|$ 是偏差 $y(t)$ 的特征幅度。\n\n现在，我们比较关于 $y(t)$ 的常微分方程左侧两项的量级：\n$$\n\\left| \\frac{dy}{dt} \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{pert}}} \\quad \\text{and} \\quad \\left| \\frac{1}{\\tau_{\\mathrm{eq}}} y(t) \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{eq}}}\n$$\n第一项的量级与第二项的量级之比为：\n$$\n\\frac{|Y|/\\tau_{\\mathrm{pert}}}{|Y|/\\tau_{\\mathrm{eq}}} = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}} = \\epsilon\n$$\n由于我们处于部分平衡假设适用的区域，即 $\\epsilon \\ll 1$。这意味着与项 $\\frac{y(t)}{\\tau_{\\mathrm{eq}}}$ 相比，项 $\\frac{dy}{dt}$ 是可以忽略的。这被称为准稳态近似。通过忽略较小的项，关于 $y(t)$ 的常微分方程简化为：\n$$\n\\frac{1}{\\tau_{\\mathrm{eq}}} y(t) \\approx -\\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n这给出了偏差 $y(t)$ 的主阶表达式：\n$$\ny(t) = x(t) - x_{\\mathrm{eq}}(t) \\approx -\\tau_{\\mathrm{eq}} \\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n因此，偏差的幅度为：\n$$\n|x(t) - x_{\\mathrm{eq}}(t)| \\approx \\tau_{\\mathrm{eq}} \\left| \\frac{dx_{\\mathrm{eq}}}{dt} \\right|\n$$\n问题将扰动时间尺度 $\\tau_{\\mathrm{pert}}$ 定义为，一个典型变化 $|\\Delta x_{\\mathrm{eq}}|$ 发生在一个量级为 $\\tau_{\\mathrm{pert}}$ 的时间间隔内。这为 $x_{\\mathrm{eq}}(t)$ 的导数提供了一个数量级估计：\n$$\n\\left| \\frac{dx_{\\mathrm{eq}}}{dt} \\right| \\sim \\frac{|\\Delta x_{\\mathrm{eq}}|}{\\tau_{\\mathrm{pert}}}\n$$\n将此估计代入我们关于偏差幅度的表达式中，我们得到：\n$$\n|x(t) - x_{\\mathrm{eq}}(t)| \\sim \\tau_{\\mathrm{eq}} \\frac{|\\Delta x_{\\mathrm{eq}}|}{\\tau_{\\mathrm{pert}}}\n$$\n问题将分数误差定义为偏差幅度 $|x(t) - x_{\\mathrm{eq}}(t)|$ 与特征变化幅度 $|\\Delta x_{\\mathrm{eq}}|$ 的主阶比值。将上述关系式除以 $|\\Delta x_{\\mathrm{eq}}|$ 即可得到此分数误差：\n$$\n\\text{Fractional Error} = \\frac{|x(t) - x_{\\mathrm{eq}}(t)|}{|\\Delta x_{\\mathrm{eq}}|} \\sim \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}\n$$\n使用定义 $\\epsilon = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}$，主阶分数误差的解析表达式就是 $\\epsilon$。\n\n问题接着要求在 $\\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}} = 0.05$ 的情况下评估此分数误差。\n在这种情况下，$\\epsilon = 0.05$。\n因此，分数误差为 $0.05$。这个值是精确的，不需要四舍五入。",
            "answer": "$$\\boxed{0.05}$$"
        },
        {
            "introduction": "理论是灰色的，而生命之树常青。将抽象的理论应用于具体的地球化学情景是理解其精髓的关键。在本练习中，你将亲手为磷酸钙沉淀过程建立两种模型：一种是基于部分平衡假设的代数模型，另一种是完全动力学模型。通过编程实现并在不同参数（如反应速率、模拟时间）下对比它们的预测结果，你将直观地观察到动力学模型在何种条件下会收敛于平衡模型的解，从而获得关于PEA适用范围的宝贵实践经验。",
            "id": "4104715",
            "problem": "你的任务是在一个封闭的生物地球化学反应器中，实现并分析磷酸盐沉淀的部分平衡假设 (PEA)，并将其与一个全动力学模型进行比较。磷酸盐沉淀由微溶固体反应 $3\\,\\mathrm{Ca^{2+}} + 2\\,\\mathrm{PO_4^{3-}} \\rightleftharpoons \\mathrm{Ca_3(PO_4)_2(s)}$ 表示。离子活度积 (IAP) 为 $IAP = a_{\\mathrm{Ca^{2+}}}^3\\,a_{\\mathrm{PO_4^{3-}}}^2$。假设活度等于浓度，因此 $IAP = [\\mathrm{Ca^{2+}}]^3\\,[\\mathrm{PO_4^{3-}}]^2$。溶度积 $K_{\\mathrm{sp}}$ 在平衡时满足 $K_{\\mathrm{sp}} = [\\mathrm{Ca^{2+}}]^3\\,[\\mathrm{PO_4^{3-}}]^2$。\n\n部分平衡假设 (PEA) 假定，相对于较慢的过程，快速反应能瞬时达到平衡。在本问题中，将沉淀视为相对于观测时间是快速的，并通过施加平衡约束和质量平衡来计算 PEA 预测的最终浓度。在全动力学模型中，使用基于质量作用定律的速率方程来处理沉淀，并在有限的时间范围内求解相应的常微分方程 (ODEs)。\n\n模型假设与定义：\n- 反应器是封闭、恒温且混合均匀的，没有物质流入或流出。\n- 活度等于浓度，即 $a_i = [i]$。\n- 设 $[\\mathrm{Ca^{2+}}](t)$ 和 $[\\mathrm{PO_4^{3-}}](t)$ 为摩尔浓度，单位为 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$)。\n- 设 $x(t)$ 为固体沉淀的反应程度，单位为 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$)，因此质量平衡为 $[\\mathrm{Ca^{2+}}](t) = [\\mathrm{Ca^{2+}}]_0 - 3\\,x(t)$ 和 $[\\mathrm{PO_4^{3-}}](t) = [\\mathrm{PO_4^{3-}}]_0 - 2\\,x(t)$，并带有非负约束。\n- 溶度积 $K_{\\mathrm{sp}}$ 的单位是 $\\mathrm{M^5}$，因为 $IAP = [\\mathrm{Ca^{2+}}]^3[\\mathrm{PO_4^{3-}}]^2$。\n- 在动力学模型中，沉淀速率为 $r(t) = k\\,\\max\\!\\left(0, [\\mathrm{Ca^{2+}}](t)^3\\,[\\mathrm{PO_4^{3-}}](t)^2 - K_{\\mathrm{sp}}\\right)$，其中 $k$ 的单位为 $\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，因此 $r$ 的单位为 $\\mathrm{M\\,s^{-1}}$。常微分方程为 $\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\,r(t)$ 和 $\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\,r(t)$。\n\n你的程序必须：\n1. 实现一个 PEA 求解器，通过在区间 $x \\in [0, \\min([\\mathrm{Ca^{2+}}]_0/3, [\\mathrm{PO_4^{3-}}]_0/2)]$ 上求解非线性方程 $$\\left([\\mathrm{Ca^{2+}}]_0 - 3x\\right)^3\\left([\\mathrm{PO_4^{3-}}]_0 - 2x\\right)^2 - K_{\\mathrm{sp}} = 0$$ 来计算最终浓度 $[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}$ 和 $[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}$，条件是如果初始状态是未饱和的，即 $[\\mathrm{Ca^{2+}}]_0^3[\\mathrm{PO_4^{3-}}]_0^2 \\le K_{\\mathrm{sp}}$，则 $x = 0$。\n2. 实现一个动力学 ODE 求解器，使用指定的速率定律，在有限的时间范围 $T$ 内计算 $[\\mathrm{Ca^{2+}}](T)$ 和 $[\\mathrm{PO_4^{3-}}](T)$。\n3. 对于每个测试用例，比较 PEA 和动力学模型的预测结果，并通过检查两种物质来确定它们是否在指定的浓度容差 $\\epsilon$ 内一致：$$\\left|[\\mathrm{Ca^{2+}}](T) - [\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon \\quad \\text{and} \\quad \\left|[\\mathrm{PO_4^{3-}}](T) - [\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon.$$\n4. 所有浓度以 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$) 表示，时间以 $\\mathrm{s}$ 表示，$K_{\\mathrm{sp}}$ 以 $\\mathrm{M^5}$ 表示。\n\n测试套件：\n- 案例1（一般过饱和，中等时间内动力学足够快）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$, $[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$, $K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$, $k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$, $T = 5\\times 10^{3}\\,\\mathrm{s}$, $\\epsilon = 1\\times 10^{-4}\\,\\mathrm{M}$。\n- 案例2（未饱和边界）：$[\\mathrm{Ca^{2+}}]_0 = 1\\times 10^{-4}\\,\\mathrm{M}$, $[\\mathrm{PO_4^{3-}}]_0 = 1\\times 10^{-4}\\,\\mathrm{M}$, $K_{\\mathrm{sp}} = 1\\times 10^{-8}\\,\\mathrm{M^5}$, $k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$, $T = 1\\times 10^{4}\\,\\mathrm{s}$, $\\epsilon = 1\\times 10^{-6}\\,\\mathrm{M}$。\n- 案例3（动力学缓慢，在有限时间内与 PEA 有显著差异）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$, $[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$, $K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$, $k = 1\\times 10^{-2}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$, $T = 1\\times 10^{4}\\,\\mathrm{s}$, $\\epsilon = 1\\times 10^{-4}\\,\\mathrm{M}$。\n- 案例4（时间受限，速率常数高但时间范围太短）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$, $[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$, $K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$, $k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$, $T = 1\\,\\mathrm{s}$, $\\epsilon = 1\\times 10^{-5}\\,\\mathrm{M}$。\n- 案例5（化学计量限制，含痕量磷酸盐，长时间和高速率）：$[\\mathrm{Ca^{2+}}]_0 = 1\\times 10^{-2}\\,\\mathrm{M}$, $[\\mathrm{PO_4^{3-}}]_0 = 1\\times 10^{-5}\\,\\mathrm{M}$, $K_{\\mathrm{sp}} = 1\\times 10^{-18}\\,\\mathrm{M^5}$, $k = 1\\times 10^{5}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$, $T = 1\\times 10^{6}\\,\\mathrm{s}$, $\\epsilon = 1\\times 10^{-5}\\,\\mathrm{M}$。\n\n最终输出格式：\n- 你的程序应该生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，按给定顺序为每个测试用例提供一个布尔值，例如 $[\\mathrm{result_1},\\mathrm{result_2},\\mathrm{result_3},\\mathrm{result_4},\\mathrm{result_5}]$，其中每个条目为 $\\mathrm{True}$ 或 $\\mathrm{False}$。",
            "solution": "用户提供的问题是有效的。它在科学上基于化学动力学和平衡原理，特别是在计算地球化学的背景下。该问题是适定的，提供了所有必要的数据、方程和约束，可以为每个测试用例得出一个唯一的、可计算的解。问题是客观且无歧义的。因此，将提供一个合理的解决方案。\n\n### 基于原理的解决方案设计\n\n问题要求对水相体系中化学反应的两种常见建模方法进行比较：部分平衡假设 (PEA) 和全动力学模型。分析的重点是磷酸钙 $\\mathrm{Ca_3(PO_4)_2(s)}$ 的沉淀，这是一个由其溶度积 $K_{\\mathrm{sp}}$ 控制的反应。\n\n#### 1. 部分平衡假设 (PEA) 模型\n\nPEA 假设某些反应相对于所关心的时间尺度而言非常快，因此可以假设它们始终处于平衡状态。对于沉淀反应，这意味着如果系统是饱和的，离子活度积 ($IAP$) 总是等于溶度积 ($K_{\\mathrm{sp}}$)。\n\n**算法实现：**\n\n1.  **初始状态检查**：首先，我们评估系统的初始状态。初始离子活度积计算为 $IAP_0 = [\\mathrm{Ca^{2+}}]_0^3\\,[\\mathrm{PO_4^{3-}}]_0^2$，其中 $[\\cdot]_0$ 表示初始浓度。\n    -   如果 $IAP_0 \\le K_{\\mathrm{sp}}$，溶液是未饱和的或处于平衡状态。不发生净沉淀。反应程度 $x$ 为 $0$。最终浓度即为初始浓度。\n    -   如果 $IAP_0 > K_{\\mathrm{sp}}$，溶液是过饱和的，沉淀将进行直到建立平衡。\n\n2.  **平衡计算**：对于过饱和系统，我们必须找到使系统达到平衡的反应程度 $x$ (单位为 $\\mathrm{mol\\,L^{-1}}$)。质量平衡方程如下：\n    $$[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}} = [\\mathrm{Ca^{2+}}]_0 - 3x$$\n    $$[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}} = [\\mathrm{PO_4^{3-}}]_0 - 2x$$\n    在平衡时，这些浓度必须满足溶度积关系：\n    $$K_{\\mathrm{sp}} = ([\\mathrm{Ca^{2+}}]_0 - 3x)^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x)^2$$\n    这可以重排为一个需求解 $x$ 的非线性代数方程：\n    $$f(x) = ([\\mathrm{Ca^{2+}}]_0 - 3x)^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x)^2 - K_{\\mathrm{sp}} = 0$$\n\n3.  **数值求根**：$x$ 的物理上有意义的范围是 $x \\in [0, x_{\\max}]$，其中 $x_{\\max} = \\min\\left(\\frac{[\\mathrm{Ca^{2+}}]_0}{3}, \\frac{[\\mathrm{PO_4^{3-}}]_0}{2}\\right)$ 确保了浓度保持非负。\n    -   在 $x=0$ 时，对于过饱和系统，$f(0) = IAP_0 - K_{\\mathrm{sp}} > 0$。\n    -   在 $x=x_{\\max}$ 时，至少有一种反应物的浓度为零，使得 $IAP$ 项为零。因此，$f(x_{\\max}) = -K_{\\mathrm{sp}}  0$。\n    由于 $f(x)$ 是连续的，且 $f(0)$ 和 $f(x_{\\max})$ 的符号相反，因此可以保证在区间 $(0, x_{\\max})$ 中存在唯一的根。这个根可以通过使用数值求根算法（如 `scipy.optimize.brentq` 中实现的 Brent-Dekker 方法）高效地找到。一旦求得平衡反应程度 $x_{\\mathrm{PEA}}$，就可以使用质量平衡方程计算出最终的 PEA 浓度。\n\n#### 2. 动力学模型\n\n动力学模型通过求解基于指定反应速率定律的常微分方程组 (ODEs) 来描述浓度随时间的演变。\n\n**算法实现：**\n\n1.  **速率定律和 ODE 构建**：沉淀速率 $r(t)$ 由下式给出：\n    $$r(t) = k\\,\\max\\!\\left(0, [\\mathrm{Ca^{2+}}](t)^3\\,[\\mathrm{PO_4^{3-}}](t)^2 - K_{\\mathrm{sp}}\\right)$$\n    对应的浓度常微分方程为：\n    $$\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\,r(t)$$\n    $$\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\,r(t)$$\n    由于化学计量关系是固定的，这个系统可以通过用反应程度 $x(t)$ 来表示两种浓度而得到简化。对质量平衡方程关于时间求导可得 $\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\frac{dx}{dt}$ 和 $\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\frac{dx}{dt}$。将这些与基于速率的 ODEs 比较可以发现 $\\frac{dx}{dt} = r(t)$。这将问题简化为求解关于 $x(t)$ 的单个 ODE：\n    $$\\frac{dx}{dt} = k\\,\\max\\!\\left(0, ([\\mathrm{Ca^{2+}}]_0 - 3x(t))^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x(t))^2 - K_{\\mathrm{sp}}\\right)$$\n    初始条件是 $x(0) = 0$。\n\n2.  **数值积分**：这个初值问题从 $t=0$ 到指定的最终时间 $T$ 进行数值求解。`scipy.integrate.solve_ivp` 函数用于此目的。\n    -   **求解器选择**：地球化学反应系统可能是“刚性”的，尤其是在速率常数 ($k$) 较大或系统接近平衡时。选择为刚性问题设计的求解器（如 'Radau'）以确保稳定性和效率。\n    -   **事件检测**：为保持物理真实性，当任何一种反应物完全耗尽时，积分必须停止。定义一个“事件函数”来监测浓度，并在 $\\min([\\mathrm{Ca^{2+}}], [\\mathrm{PO_4^{3-}}])$ 接近零时终止求解器。这可以防止模型产生不符合物理意义的负浓度。\n    -   最终值 $x(T)$ 从求解器的输出中获得。然后使用质量平衡方程和 $x=x(T)$ 来计算最终的动力学浓度 $[\\mathrm{Ca^{2+}}](T)$ 和 $[\\mathrm{PO_4^{3-}}](T)$。\n\n#### 3. 模型比较\n\n对于每个测试用例，程序首先计算由 PEA 模型 ($[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}$, $[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}$) 和时间 $T$ 的动力学模型 ($[\\mathrm{Ca^{2+}}](T)$, $[\\mathrm{PO_4^{3-}}](T)$) 预测的最终浓度。如果两种物质浓度的绝对差值都在指定的容差 $\\epsilon$ 内，则认为模型一致：\n$$\\left|[\\mathrm{Ca^{2+}}](T) - [\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon \\quad \\text{and} \\quad \\left|[\\mathrm{PO_4^{3-}}](T) - [\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon$$\n每个测试用例的比较结果（一个布尔值 `True` 或 `False`）都会被记录下来。最终输出是按照指定格式化的这些布尔值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Implements and compares Partial Equilibrium Assumption (PEA) and kinetic models\n    for phosphate precipitation, determining if their predictions coincide for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General supersaturation, fast kinetics, moderate time\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e6, 'T': 5e3, 'epsilon': 1e-4},\n        # Case 2: Undersaturated boundary\n        {'Ca0': 1e-4, 'PO40': 1e-4, 'Ksp': 1e-8, 'k': 1e6, 'T': 1e4, 'epsilon': 1e-6},\n        # Case 3: Slow kinetics\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e-2, 'T': 1e4, 'epsilon': 1e-4},\n        # Case 4: Time-limited, high rate but short horizon\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e6, 'T': 1.0, 'epsilon': 1e-5},\n        # Case 5: Stoichiometric limitation, long time, high rate\n        {'Ca0': 1e-2, 'PO40': 1e-5, 'Ksp': 1e-18, 'k': 1e5, 'T': 1e6, 'epsilon': 1e-5},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Ca0, PO40, Ksp, k, T, epsilon = case.values()\n\n        # Step 1: Calculate PEA solution\n        #--------------------------------\n        IAP0 = Ca0**3 * PO40**2\n        x_pea = 0.0\n\n        if IAP0 > Ksp:\n            def f_pea(x):\n                # Concentrations must remain non-negative\n                ca = max(0.0, Ca0 - 3.0 * x)\n                po4 = max(0.0, PO40 - 2.0 * x)\n                return ca**3 * po4**2 - Ksp\n            \n            # The extent of reaction x cannot exceed the amount of the limiting reactant\n            x_max = min(Ca0 / 3.0, PO40 / 2.0)\n            \n            # Use Brent's method to find the root x that satisfies the equilibrium\n            try:\n                x_pea = brentq(f_pea, 0.0, x_max_buffered) if (x_max_buffered:=x_max*(1-1e-12)) > 0 else 0.0\n            except ValueError:\n                # This can happen if f(0) and f(x_max) do not have opposite signs,\n                # which shouldn't occur in the supersaturated case.\n                # It can also occur if the root is at an endpoint, which brentq may miss.\n                # Here we assume if error, reaction goes to completion w.r.t limiting reactant.\n                if f_pea(x_max) > 0: # Still supersaturated at x_max\n                    x_pea = x_max\n                else: # Should not happen based on logic, but as a fallback\n                    x_pea = 0.0\n\n        Ca_pea = Ca0 - 3.0 * x_pea\n        PO4_pea = PO40 - 2.0 * x_pea\n\n        # Step 2: Calculate kinetic solution\n        #------------------------------------\n        x_kin_T = 0.0\n        \n        if IAP0 > Ksp:\n            def ode_model(t, x):\n                x_val = x[0]\n                Ca = Ca0 - 3.0 * x_val\n                PO4 = PO40 - 2.0 * x_val\n                \n                # Concentrations are kept non-negative by the event handler,\n                # but an extra check is harmless.\n                if Ca = 0 or PO4 = 0:\n                    return [0.0]\n                \n                IAP = Ca**3 * PO4**2\n                rate_term = max(0.0, IAP - Ksp)\n                dxdt = k * rate_term\n                return [dxdt]\n\n            # Event to stop integration when a reactant is depleted\n            def depletion_event(t, x):\n                return min(Ca0 - 3.0 * x[0], PO40 - 2.0 * x[0])\n            depletion_event.terminal = True\n            depletion_event.direction = -1\n\n            # Solve the ODE for the reaction extent x(t)\n            sol = solve_ivp(ode_model, [0, T], [0], method='Radau', events=depletion_event, atol=1e-12, rtol=1e-9)\n            x_kin_T = sol.y[0][-1]\n\n        Ca_kin = Ca0 - 3.0 * x_kin_T\n        PO4_kin = PO40 - 2.0 * x_kin_T\n\n        # Step 3: Compare results\n        #---------------------------\n        diff_Ca = abs(Ca_kin - Ca_pea)\n        diff_PO4 = abs(PO4_kin - PO4_pea)\n        is_coincident = (diff_Ca = epsilon) and (diff_PO4 = epsilon)\n        results.append(is_coincident)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实地球化学系统的复杂性远超均相溶液，常常涉及矿物的沉淀与溶解。当一个固相可能出现或消失时，模型的控制方程组会发生根本性改变，这对数值求解的稳健性提出了巨大挑战。本练习旨在探讨如何在部分平衡框架下，严谨地处理这种相变问题。通过分析不同的数值策略，你将理解为什么“互补条件”是处理这类问题的标准且强大的数学工具，它能确保质量守恒和热力学约束在任何情况下都得到满足。",
            "id": "4104733",
            "problem": "一个计算地球化学模型考虑了一个水相网络，其中快速的酸碱形态反应在部分平衡假设下被视为已达到平衡，同时还有一个微溶矿物相的沉淀。该矿物由一个化学计量向量 $\\boldsymbol{\\nu}_{M}$（将元素映射到矿物化学式）和一个溶度积 $K_{\\mathrm{sp}}$ 来表征，该溶度积通过 $K_{\\mathrm{sp}} = \\exp\\!\\left(-\\Delta G^{\\circ}/RT\\right)$ 从标准反应吉布斯自由能推导得出。设 $\\boldsymbol{T}$ 表示守恒元素总量的向量，$\\boldsymbol{n}_{\\mathrm{aq}}$ 表示水相物质的量的向量，$n_{M} \\ge 0$ 表示矿物相的量。从水相物质到元素的化学计量映射由矩阵 $\\boldsymbol{A}$ 给出，因此质量守恒表示为 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$。水相物质的活度进入矿物溶解/沉淀反应的反应商 $Q_{M}$，例如对于碳酸钙，$Q_{M} = a_{\\mathrm{Ca}^{2+}}\\,a_{\\mathrm{CO}_{3}^{2-}}$，其中 $a_{i}$ 是从 $\\boldsymbol{n}_{\\mathrm{aq}}$ 和活度模型计算出的活度。假设快速水相反应在平衡时满足质量作用定律，这可以表示为所选集合的反应亲和势为零或等效的质量作用关系；慢反应则进行动力学处理。\n\n在部分平衡条件下，处理沉淀过程时不要求所有反应都达到全局平衡。模型必须以一种能保持质量平衡并避免不一致或超定的代数集的方式来强制执行相的出现/消失约束，尤其是在矿物进入或离开其组合的阈值附近。矿物的热力学驱动力（反应亲和势）为 $A_{M} = -RT \\ln(Q_{M}/K_{\\mathrm{sp}})$。当 $n_{M}  0$ 时，溶解/沉淀反应的平衡意味着 $A_{M} = 0$（等效于 $Q_{M} = K_{\\mathrm{sp}}$）。当 $n_{M} = 0$ 时，系统可能处于未饱和状态（$Q_{M}  K_{\\mathrm{sp}}$）而不违反热力学，而过饱和状态（$Q_{M}  K_{\\mathrm{sp}}$）则预示着可能出现新相。\n\n在部分平衡假设下，哪种数学表述能正确处理矿物相的出现/消失，同时确保质量平衡和一致的代数集？\n\nA. 对每种潜在的沉淀物，无论 $n_{M}$ 为何值，始终强制 $Q_{M} = K_{\\mathrm{sp}}$，如果在求解过程中 $n_{M}$ 变为负数，则将其截断为 0，并在该步骤后重新归一化水相浓度以恢复元素总量。\n\nB. 使用元素总量 $\\boldsymbol{T}$ 作为主要守恒变量，并通过质量作用关系强制实现快速水相平衡。引入矿物量 $n_{M} \\ge 0$，并强制执行饱和度不等式 $Q_{M} \\le K_{\\mathrm{sp}}$ 以及互补条件 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。将此耦合系统作为一个非线性互补问题求解，并在质量平衡 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$ 中明确包含 $\\boldsymbol{\\nu}_{M}\\,n_{M}$。\n\nC. 选择水相物质浓度作为主要变量，并在 $Q_{M} \\ge K_{\\mathrm{sp}}$ 时强制实现快速水相平衡和 $Q_{M} = K_{\\mathrm{sp}}$。此外，在 $Q_{M}  K_{\\mathrm{sp}}$ 时施加约束 $n_{M} = 0$，随着饱和状态的改变切换方程，而不使用互补性。\n\nD. 首先，仅在满足 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} = \\boldsymbol{T}$ 和快速平衡的条件下，最小化水相物质的吉布斯自由能，忽略矿物。然后，在后处理步骤中，检查矿物饱和度，如果 $Q_{M}  K_{\\mathrm{sp}}$，则减少水相元素总量以沉淀矿物，直到 $Q_{M} = K_{\\mathrm{sp}}$，而不重新求解已平衡的水相形态问题。",
            "solution": "任务是在一个计算地球化学模型中，找出在部分平衡假设下处理矿物沉淀和溶解的正确数学及数值表述。这需要一种能够一致地强制执行质量守恒、热力学约束，并为数值求解器构建为一个适定代数问题的方法。\n\n首先，让我们将问题陈述中描述的物理和化学约束形式化。\n1.  **质量守恒：** 一种元素在系统中的总量是守恒的。该总量由向量 $\\boldsymbol{T}$ 表示，是其分布在所有水相物质中的量与其在矿物相中的量之和。这表示为：\n    $$\n    \\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}\n    $$\n    其中 $\\boldsymbol{n}_{\\mathrm{aq}}$ 是水相物质摩尔量的向量，$n_{M}$ 是矿物的摩尔量，$\\boldsymbol{A}$ 是水相物质的化学计量矩阵，$\\boldsymbol{\\nu}_{M}$ 是矿物的化学计量向量。\n\n2.  **快速水相平衡：** 假设水相中的一组快速反应处于平衡状态。这些反应由质量作用定律控制，构成一个非线性代数方程组。我们可以将这个系统抽象地表示为一组关于水相物质浓度（或活度）的函数，这些函数必须等于零。\n\n3.  **对矿物量的物理约束：** 矿物相的量不能为负。\n    $$\n    n_{M} \\ge 0\n    $$\n\n4.  **对矿物平衡的热力学约束：** 矿物的溶解/沉淀由其反应商 $Q_{M}$ 和溶度积 $K_{\\mathrm{sp}}$ 控制。这些量之间的关系取决于矿物相是否存在。\n    - 如果矿物存在（$n_{M}  0$），反应必须处于平衡状态，这意味着组成离子的活度满足溶度积常数：\n      $$\n      Q_{M} = K_{\\mathrm{sp}}\n      $$\n    - 如果矿物不存在（$n_{M} = 0$），则不要求溶液饱和。从热力学角度看，溶液必须要么恰好饱和，要么未饱和，因为过饱和溶液（$Q_{M}  K_{\\mathrm{sp}}$）会有沉淀矿物的热力学驱动力。因此，对于 $n_{M} = 0$：\n      $$\n      Q_{M} \\le K_{\\mathrm{sp}}\n      $$\n\n一个稳健的数学表述必须将这些条件组合成一个单一、一致的系统。核心挑战在于处理矿物平衡约束的“切换”逻辑。让我们组合这些条件：\n我们有两个不等式：\n- $n_{M} \\ge 0$\n- $K_{\\mathrm{sp}} - Q_{M} \\ge 0$ (等效于 $Q_{M} \\le K_{\\mathrm{sp}}$)\n\n现在，考虑两种情况：\n- 如果 $n_{M}  0$，第一个不等式是严格的。为使系统有效，热力学条件必须是 $Q_{M} = K_{\\mathrm{sp}}$，这意味着 $K_{\\mathrm{sp}} - Q_{M} = 0$。\n- 如果 $Q_{M}  K_{\\mathrm{sp}}$，第二个不等式是严格的（$K_{\\mathrm{sp}} - Q_{M}  0$）。为使系统有效，热力学条件是矿物必须不存在，即 $n_{M} = 0$。\n\n这种行为，即两个非负量（$n_{M}$ 和 $K_{\\mathrm{sp}} - Q_{M}$）中至少有一个必须为零，是一个经典的互补条件。它可以简洁地表示为：\n$$\nn_{M} \\ge 0, \\quad K_{\\mathrm{sp}} - Q_{M} \\ge 0, \\quad \\text{以及} \\quad (K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0\n$$\n这组条件优雅而严谨地将矿物相存在与否的约束合并到了一个单一的数学表述中。包含此类条件的代数方程组被称为非线性互补问题（NCP）。这是为数值求解表述相出现/消失问题的一种标准而强大的方法。\n\n因此，完整的适定问题是求解快速水相平衡系统和质量平衡方程，同时满足矿物相的互补条件。\n\n现在我们根据这个参考表述来评估每个选项。\n\n**A. 对每种潜在的沉淀物，无论 $n_{M}$ 为何值，始终强制 $Q_{M} = K_{\\mathrm{sp}}$，如果在求解过程中 $n_{M}$ 变为负数，则将其截断为 0，并在该步骤后重新归一化水相浓度以恢复元素总量。**\n这种方法存在根本性缺陷。\n- 首先，它甚至在系统应为未饱和状态时也强制 $Q_{M} = K_{\\mathrm{sp}}$，这在热力学上是不正确的，并且会过度约束代数系统。\n- 其次，发现负的 $n_{M}$ 表明初始假设（$Q_{M} = K_{\\mathrm{sp}}$）在该步骤中是错误的。所提议的“修复”——将 $n_{M}$ 截断为 0 并重新归一化——是一种临时的、事后的修正，它破坏了已求解代数系统的完整性。这个过程会破坏质量平衡，直到人为地恢复，并且可能导致严重的数值不稳定和收敛失败，尤其是在有竞争性矿物的系统中。\n结论：**不正确**。\n\n**B. 使用元素总量 $\\boldsymbol{T}$ 作为主要守恒变量，并通过质量作用关系强制实现快速水相平衡。引入矿物量 $n_{M} \\ge 0$，并强制执行饱和度不等式 $Q_{M} \\le K_{\\mathrm{sp}}$ 以及互补条件 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。将此耦合系统作为一个非线性互补问题求解，并在质量平衡 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$ 中明确包含 $\\boldsymbol{\\nu}_{M}\\,n_{M}$。**\n该选项与我们推导出的数学表述完全匹配。\n- 它正确地使用元素总量 $\\boldsymbol{T}$ 作为守恒系统的基础。\n- 它正确地将矿物相的热力学约束识别为一个互补条件：$n_{M} \\ge 0$，$Q_{M} \\le K_{\\mathrm{sp}}$，以及 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。\n- 它正确地将产生的数学结构识别为非线性互补问题（NCP）。\n- 它在任何时候都正确地将矿物的贡献包含在总质量平衡方程中。\n这种表述在热力学上是一致的，在数学上是严谨的，并为数值求解器提供了坚实的基础。\n结论：**正确**。\n\n**C. 选择水相物质浓度作为主要变量，并在 $Q_{M} \\ge K_{\\mathrm{sp}}$ 时强制实现快速水相平衡和 $Q_{M} = K_{\\mathrm{sp}}$。此外，在 $Q_{M}  K_{\\mathrm{sp}}$ 时施加约束 $n_{M} = 0$，随着饱和状态的改变切换方程，而不使用互补性。**\n该选项描述了一种直接的“方程切换”逻辑。虽然在概念上抓住了这两种情况，但它是一种糟糕的数值策略。使用 `if/else` 逻辑实现这一点会在控制方程及其导数（雅可比矩阵）中产生不连续性。用于求解此类刚性、非线性系统的标准牛顿类型求解器，在存在此类不连续性的情况下表现不佳或完全失效。选项 B 中的互补表述正是为了通过创建一个单一但更复杂的系统来规避这个问题，该系统对数值算法表现更好。“不使用互补性”这一短语明确拒绝了针对此问题的稳健数学工具。\n结论：**不正确**。\n\n**D. 首先，仅在满足 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} = \\boldsymbol{T}$ 和快速平衡的条件下，最小化水相物质的吉布斯自由能，忽略矿物。然后，在后处理步骤中，检查矿物饱和度，如果 $Q_{M}  K_{\\mathrm{sp}}$，则减少水相元素总量以沉淀矿物，直到 $Q_{M} = K_{\\mathrm{sp}}$，而不重新求解已平衡的水相形态问题。**\n这是一种顺序非迭代的算子分裂方法，并且它是有缺陷的。当矿物沉淀时，它会改变其构成元素在水相中的总浓度。例如，沉淀 $\\text{CaCO}_3$ 会减少溶解的总钙和总碳。水相总量的这种变化将导致快速水相平衡（例如，$\\text{CO}_3^{2-}$、$\\text{HCO}_3^{-}$ 和 $\\text{H}_2\\text{CO}_3$ 之间的平衡）发生移动。最后的条款，“而不重新求解已平衡的水相形态问题”，意味着沉淀后的模型状态是不一致的：相对于快速反应，水相不再处于平衡状态。这违反了核心的部分平衡假设。一个正确的算法将需要在形态计算和沉淀步骤之间进行迭代，直到达到一致性。\n结论：**不正确**。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}