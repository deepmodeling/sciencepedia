{
    "hands_on_practices": [
        {
            "introduction": "在地球化学模型中，我们经常使用包含 $(1-\\Omega)$ 项的速率定律来描述矿物溶解和沉淀。这个练习将揭示，这一形式并非经验性的随意假设，而是可以从过渡态理论 (Transition State Theory, TST) 的基本原理中推导出来。通过这个实践，你将亲手推导净反应速率如何依赖于正向和反向通量之差，并理解忽略热力力驱动力（即饱和度 $\\Omega$ 的影响）会在接近平衡时导致多大的预测偏差 。",
            "id": "4068507",
            "problem": "方解石的水相溶解通常使用包含饱和状态的热力学驱动力的速率定律来建模。考虑在标准温度下，方解石在水溶液中的溶解反应 $\\mathrm{CaCO_{3}(s) \\rightarrow Ca^{2+} + CO_{3}^{2-}}$。设反应商为 $Q$，平衡常数为 $K$，则饱和状态定义为 $\\Omega = Q/K$，饱和指数 (SI) 定义为 $\\mathrm{SI} = \\log_{10}(\\Omega)$。化学一致的溶解反应自由能为 $\\Delta G_{r} = R T \\ln(\\Omega)$，反应亲和势定义为 $A = -\\Delta G_{r}$，其中 $R$ 是普适气体常数，$T$ 是绝对温度。\n\n从以下适合该情境的基本原理出发：\n- 质量作用定律以及通过 $\\Omega = Q/K$ 和 $\\mathrm{SI} = \\log_{10}(\\Omega)$ 定义的饱和状态 $\\Omega$。\n- 反应自由能与饱和状态之间的关系 $\\Delta G_{r} = R T \\ln(\\Omega)$，以及反应亲和势 $A = -\\Delta G_{r}$。\n- 过渡态理论 (TST) 的原理，即在接近平衡时，反向微观通量与正向微观通量之比为 $\\exp(-A/(R T))$。\n\n推导方解石净溶解速率的近平衡抑制因子（仅用 $\\Omega$ 表示），并用它来获得以下两者之间的乘性差异因子：\n1. 忽略饱和效应并使用恒定正向速率系数的经典速率定律（即，预测净溶解速率与一个不依赖于 $\\Omega$ 的常数 $k_{+}$ 成正比），以及\n2. 考虑了热力学驱动力导致的近平衡抑制，并对亲和势敏感的速率定律。\n\n然后，对于 $\\mathrm{SI} = -0.05$ 时的方解石，计算这个乘性高估因子。将最终答案表示为一个无单位的纯数，并四舍五入到四位有效数字。",
            "solution": "该问题要求推导两种方解石溶解速率模型之间的乘性差异因子，并在特定饱和状态下进行计算。推导必须从所提供的基本原理出发。\n\n首先，我们建立考虑亲和势的速率定律的形式。净反应速率 $R_{net}$ 是正向通量 $F_{+}$ 与反向通量 $F_{-}$ 之差：\n$$R_{net} = F_{+} - F_{-}$$\n问题中提供了来自过渡态理论（TST）的一个关键原理：反向微观通量与正向微观通量之比由 $\\exp(-A/(RT))$ 给出，其中 $A$ 是反应亲和势，$R$ 是普适气体常数，$T$ 是绝对温度。\n$$\\frac{F_{-}}{F_{+}} = \\exp\\left(-\\frac{A}{RT}\\right)$$\n根据这个关系，我们可以用正向通量表示反向通量：\n$$F_{-} = F_{+} \\exp\\left(-\\frac{A}{RT}\\right)$$\n将此代入净速率的表达式中，得到：\n$$R_{net} = F_{+} - F_{+} \\exp\\left(-\\frac{A}{RT}\\right) = F_{+} \\left(1 - \\exp\\left(-\\frac{A}{RT}\\right)\\right)$$\n项 $\\left(1 - \\exp\\left(-\\frac{A}{RT}\\right)\\right)$ 代表了由于接近平衡而对正向速率产生的热力学抑制。为了用饱和状态 $\\Omega$ 来表示这个因子，我们使用已知的亲和势 $A$ 和反应吉布斯自由能 $\\Delta G_r$ 的定义。\n亲和势定义为 $A = -\\Delta G_r$。\n反应自由能由 $\\Delta G_r = RT \\ln(\\Omega)$ 给出，其中 $\\Omega = Q/K$ 是饱和状态。\n将这些代入指数项的参数中：\n$$-\\frac{A}{RT} = -\\frac{(-\\Delta G_r)}{RT} = \\frac{\\Delta G_r}{RT} = \\frac{RT \\ln(\\Omega)}{RT} = \\ln(\\Omega)$$\n因此，指数项变为：\n$$\\exp\\left(-\\frac{A}{RT}\\right) = \\exp(\\ln(\\Omega)) = \\Omega$$\n将此代回净速率的表达式中，我们得到考虑亲和势的速率定律：\n$$R_{net} = F_{+} (1 - \\Omega)$$\n项 $(1 - \\Omega)$ 是用 $\\Omega$ 表示的近平衡抑制因子。\n\n接下来，我们定义要比较的两种速率定律。\n1. 经典速率定律，它忽略了饱和效应，预测的净溶解速率（我们称之为 $R_{classical}$）与一个恒定的正向速率系数 $k_{+}$ 成正比。这意味着该速率与热力学驱动力无关。我们可以将此速率等同于总正向通量 $F_{+}$。因此，$R_{classical} = F_{+}$。\n2. 考虑亲和势的速率定律，我们称之为 $R_{affinity}$，是上面推导出的净速率，它包含了热力学抑制。因此，$R_{affinity} = R_{net} = F_{+}(1 - \\Omega)$。\n\n问题要求的是经典定律相对于考虑亲和势的定律的“乘性高估因子”。这个因子是经典定律预测的速率与考虑亲和势的定律预测的速率之比。\n$$\\text{高估因子} = \\frac{R_{classical}}{R_{affinity}} = \\frac{F_{+}}{F_{+}(1 - \\Omega)} = \\frac{1}{1 - \\Omega}$$\n这就是所求的乘性差异因子，仅用 $\\Omega$ 表示。\n\n最后，我们必须计算方解石在饱和指数（SI）为 $\\mathrm{SI} = -0.05$ 时该因子的数值。SI 与 $\\Omega$ 之间的关系由 $\\mathrm{SI} = \\log_{10}(\\Omega)$ 给出。\n我们可以解出 $\\Omega$：\n$$\\Omega = 10^{\\mathrm{SI}}$$\n代入给定值 $\\mathrm{SI} = -0.05$：\n$$\\Omega = 10^{-0.05}$$\n现在，我们将这个 $\\Omega$ 的值代入高估因子的表达式中：\n$$\\text{高估因子} = \\frac{1}{1 - 10^{-0.05}}$$\n我们计算其数值：\n$$10^{-0.05} \\approx 0.891250938...$$\n$$\\text{高估因子} = \\frac{1}{1 - 0.891250938...} = \\frac{1}{0.108749061...} \\approx 9.1954707...$$\n按要求将结果四舍五入到四位有效数字，得到 $9.195$。\n这意味着在饱和指数为 $-0.05$ 时，忽略热力学逆反应的经典速率定律会高估净溶解速率约 $9.195$ 倍。",
            "answer": "$$\\boxed{9.195}$$"
        },
        {
            "introduction": "理论推导为我们提供了速率定律的基本形式，例如 $r = k(1-\\Omega)^n$。然而，反应级数 $n$ 等关键参数通常需要通过实验数据来确定。这个计算练习将带你进入模型选择的实际挑战，即如何从一系列候选模型中挑选出最合适的一个 。你将学习使用残差分析、赤池信息准则 (AICc) 等统计工具，来评估不同 $n$ 值下的模型拟合优度，并最终选择一个既能准确描述数据又符合简约性原则的模型。",
            "id": "4068493",
            "problem": "给定一组实验测量的单一矿物表面在远离平衡状态下的溶解速率，其中饱和比满足 $0 \\le \\Omega \\le 0.5$。在基于亲和势的动力学框架中，热力学驱动力由一个无量纲的偏离平衡量来表征，该量在 $\\Omega=1$ 时为零，在 $\\Omega  1$ 时为正。根据非平衡热力学和质量作用定律，速率对此驱动力具有单调依赖关系。您的任务是确定线性依赖关系（由指数 $n=1$ 索引）是否足以解释测量的速率，或者更高的曲率（由 $n>1$ 索引）是否能以统计上和物理上合理的方式改善拟合效果。您必须基于残差分析和合理的模型选择标准进行选择。\n\n从以下基本要素开始：\n- 溶解反应的化学亲和势 $A$ 与吉布斯自由能变和温度的关系为 $A=-\\Delta G_{r}/(RT)$，其中 $R$ 是普适气体常数，$T$ 是绝对温度。\n- 饱和比 $\\Omega$ 定义为 $\\Omega=Q/K_{\\mathrm{eq}}$，其中 $Q$ 是离子活度积，$K_{\\mathrm{eq}}$ 是平衡常数，因此 $\\Omega  1$ 表示欠饱和，$\\Omega=1$ 表示平衡。\n- 在远离平衡（$\\Omega \\le 0.5$）时，观测到的溶解速率随偏离平衡程度的增加而增加，为非负值，并且在平衡时必须为零。\n\n为了本次计算评估，请将注意力限制在一个由整数 $n\\in\\{1,2,3,4\\}$ 索引的单参数模型族上，该整数控制速率对无量纲驱动力依赖关系的曲率。并假设比例常数 $k$ 严格为正，其物理单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。您必须：\n1. 对于每个候选整数 $n$，在速率于 $\\Omega=1$ 时为零的约束下，通过最小二乘法估计比例常数 $k$。\n2. 计算每个候选 $n$ 模型的残差。\n3. 使用残差诊断评估模型的充分性，诊断包括：\n   - 基于独立同分布高斯误差的假设，由残差平方和计算得出的校正的赤池信息准则 (AICc)。在计算 AICc 时，对比例常数 $k$ 使用估计参数数量 $p=1$。\n   - 对按 $\\Omega$ 递增顺序排列的残差计算 Durbin–Watson 统计量以检验残差自相关性，充分性标准为值在区间 $[1.5,2.5]$ 内表示没有显著的自相关。\n   - 残差与 $\\Omega$ 之间的 Pearson 相关系数，充分性标准为其绝对值至多为 $0.2$ 表示系统性曲率可忽略不计。\n4. 选择满足残差自相关和系统性曲率充分性标准，并且其 AICc 值与候选 $n\\in\\{1,2,3,4\\}$ 中的最小 AICc 值相差不超过 $2$ 个单位的最小整数 $n$。如果没有 $n$ 满足这两个充分性标准，则选择使 AICc 最小的 $n$。\n\n给定四个测试用例。每个测试用例提供 $(\\Omega_{i},r_{i})$ 对，其中 $\\Omega_{i}$ 是无量纲的，$r_{i}$ 是测量的溶解速率，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。程序必须独立处理每个测试用例。\n\n测试套件：\n- 用例 1 (标称线性行为)：$\\Omega=\\{0.05,0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45\\}$, $r=\\{1.93\\times 10^{-9},1.76\\times 10^{-9},1.71\\times 10^{-9},1.58\\times 10^{-9},1.50\\times 10^{-9},1.42\\times 10^{-9},1.29\\times 10^{-9},1.17\\times 10^{-9},1.14\\times 10^{-9}\\}$。\n- 用例 2 (类二次曲率)：$\\Omega=\\{0.05,0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45\\}$, $r=\\{1.825\\times 10^{-9},1.59\\times 10^{-9},1.465\\times 10^{-9},1.27\\times 10^{-9},1.125\\times 10^{-9},0.99\\times 10^{-9},0.825\\times 10^{-9},0.70\\times 10^{-9},0.635\\times 10^{-9}\\}$。\n- 用例 3 (类三次曲率)：$\\Omega=\\{0.05,0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45\\}$, $r=\\{1.73475\\times 10^{-9},1.438\\times 10^{-9},1.23825\\times 10^{-9},1.014\\times 10^{-9},0.84375\\times 10^{-9},0.706\\times 10^{-9},0.53925\\times 10^{-9},0.412\\times 10^{-9},0.35275\\times 10^{-9}\\}$。\n- 用例 4 (点数较少时的简约选择)：$\\Omega=\\{0.05,0.20,0.35,0.45\\}$, $r=\\{1.425\\times 10^{-9},1.22\\times 10^{-9},0.955\\times 10^{-9},0.835\\times 10^{-9}\\}$。\n\n要求：\n- 所有计算必须将 $r$ 的单位视为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，$\\Omega$ 视为无量纲。最终输出仅包含为每个用例选择的整数 $n$，且无单位。\n- 您的程序必须生成单行输出，其中包含为四个用例按顺序选择的整数，形式为逗号分隔的列表并用方括号括起（例如，$\\left[\\text{n}_1,\\text{n}_2,\\text{n}_3,\\text{n}_4\\right]$）。\n- 不允许用户输入或外部文件。代码必须是自包含的，并且可以按原样运行。\n\n目标：\n实现上述基于残差的选择策略，并按照指定的输出格式返回每个测试用例选择的指数 $n$。通过遵守上述概述的诊断方法，从所述的热力学和动力学基础出发，证明模型选择的合理性。每个测试用例的最终答案必须是整数，并以确切要求的格式打印。",
            "solution": "所提出的问题是有效的，因为它在科学上基于化学动力学和热力学原理，在数学上是适定的，并包含了唯一、可验证解所需的所有数据和定义。任务是执行统计模型选择，以确定描述矿物溶解的动力学速率定律的最佳拟合指数。\n\n基本原理是化学反应速率 $r$ 是化学亲和势 $A$ 的函数。亲和势是热力学驱动力的量度，通过 $A = -\\frac{\\Delta G_r}{RT}$ 与反应的吉布斯自由能 $\\Delta G_r$、普适气体常数 $R$ 和绝对温度 $T$ 相关。反应接近平衡的程度由饱和比 $\\Omega = \\frac{Q}{K_{\\mathrm{eq}}}$ 给出，其中 $Q$ 是离子活度积，$K_{\\mathrm{eq}}$ 是平衡常数。一个基本的热力学关系将亲和势和饱和比联系起来：$A/RT = -\\ln \\Omega$。这意味着在平衡状态（$\\Omega=1$）时，亲和势为零（$A=0$）；在有利于溶解的欠饱和条件（$\\Omega  1$）下，亲和势为正（$A > 0$）。\n\n溶解速率 $r$ 在平衡时必须为零，并随着偏离平衡程度的增加（即随着 $\\Omega$ 的减小）而增加。该问题建议评估一个由整数指数 $n \\in \\{1, 2, 3, 4\\}$ 索引的模型族。一个满足这些约束的传统且物理上一致的模型形式是：\n$$ r = k(1 - \\Omega)^n $$\n这里，$k$ 是一个正速率常数，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。对于每个整数 $n$，我们的任务是基于对实验数据 $(\\Omega_i, r_i)$ 的系统分析，找到最佳拟合模型。\n\n每个测试用例的模型选择过程如下：\n\n1.  **参数估计**：对于每个候选指数 $n$，估计相应的速率常数 $k_n$。模型为 $r_i = k_n (1-\\Omega_i)^n + \\epsilon_i$，其中 $\\epsilon_i$ 代表实验噪声。我们通过最小化残差平方和 $SSR_n = \\sum_{i=1}^{N} (r_i - k_n(1-\\Omega_i)^n)^2$ 来估计 $k_n$，其中 $N$ 是数据点的数量。这是一个通过原点的线性最小二乘回归。通过定义 $y_i = r_i$ 和 $x_{i,n} = (1-\\Omega_i)^n$，模型简化为 $y = k_n x$。常数 $k_n$ 的最小二乘估计为：\n    $$ \\hat{k}_n = \\frac{\\sum_{i=1}^{N} y_i x_{i,n}}{\\sum_{i=1}^{N} x_{i,n}^2} = \\frac{\\sum_{i=1}^{N} r_i (1-\\Omega_i)^n}{\\sum_{i=1}^{N} (1-\\Omega_i)^{2n}} $$\n\n2.  **残差计算**：使用估计的常数 $\\hat{k}_n$，预测速率为 $\\hat{r}_{i,n} = \\hat{k}_n (1-\\Omega_i)^n$。残差计算为 $e_{i,n} = r_i - \\hat{r}_{i,n}$。残差平方和为 $SSR_n = \\sum_{i=1}^{N} e_{i,n}^2$。\n\n3.  **模型充分性诊断**：每个模型的有效性通过对其残差进行的三项统计诊断来评估。\n    - **校正的赤池信息准则 (AICc)**：AICc 提供了当使用给定模型来表示生成数据的过程时所损失信息的相对估计。它在拟合优度和模型复杂性之间取得平衡。对于一个具有 $p$ 个估计参数的模型，公式为：\n      $$ AICc_n = N \\ln\\left(\\frac{SSR_n}{N}\\right) + 2p + \\frac{2p(p+1)}{N-p-1} $$\n      在这个问题中，只估计了一个参数 $k_n$，所以 $p=1$。公式简化为：\n      $$ AICc_n = N \\ln\\left(\\frac{SSR_n}{N}\\right) + 2 + \\frac{4}{N-2} $$\n      较低的 AICc 值表示模型更优。\n    - **Durbin-Watson (DW) 统计量**：此诊断检验残差中的一阶自相关。残差必须按自变量 $\\Omega$ 排序。该统计量计算如下：\n      $$ DW_n = \\frac{\\sum_{i=2}^{N} (e_{i,n} - e_{i-1,n})^2}{\\sum_{i=1}^{N} e_{i,n}^2} $$\n      如果 $DW_n$ 落在区间 $[1.5, 2.5]$ 内，则认为模型在此标准下是充分的，表明没有显著的自相关。\n    - **Pearson 相关系数 ($\\rho$)**：这衡量了残差 $e_n$ 和饱和比 $\\Omega$ 之间的线性相关性。非零相关性表明模型未能捕捉数据中的系统性趋势。充分性要求系数的绝对值 $|\\rho_n|$ 不大于 $0.2$。\n\n4.  **模型选择规则**：一个分层规则决定了 $n$ 的最终选择：\n    a. 首先，我们确定“充分”模型的集合，其中 $n$ 满足 Durbin-Watson 和 Pearson 相关性标准：$1.5 \\le DW_n \\le 2.5$ 且 $|\\rho_n| \\le 0.2$。\n    b. 如果这个集合非空，我们进行基于 AICc 的选择。我们在所有四个候选模型（$n \\in \\{1,2,3,4\\}$）中找到最小 AICc 值 $AICc_{min}$。然后，我们从充分模型中形成一个合理子集，该子集只包含那些满足 $AICc_n \\le AICc_{min} + 2$ 的模型。最终选择是这个合理子集中的最小整数 $n$，从而偏好最简约的模型。\n    c. 如果没有模型被认为是充分的（步骤 a 中的集合为空），则选择默认回到具有绝对最小 AICc 值的模型：$n = \\arg\\min_{n \\in \\{1,2,3,4\\}} AICc_n$。\n\n这个严谨、多方面的程序将被实施并应用于四个提供的测试用例中的每一个，以确定最合适的整数指数 $n$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef analyze_case(omega, rates):\n    \"\"\"\n    Analyzes a single case of (Omega, rates) data to select the best model exponent n.\n\n    The function iterates through integer exponents n from 1 to 4, fits the model\n    rate = k * (1 - Omega)^n, and evaluates each model using AICc, Durbin-Watson,\n    and Pearson correlation diagnostics. It then selects the best n based on the\n    rules specified in the problem statement.\n    \"\"\"\n    N = len(omega)\n    p = 1  # Number of estimated parameters (the rate constant k)\n    candidate_results = []\n\n    # The problem data is already sorted by Omega, which is required for the\n    # Durbin-Watson statistic. An explicit sort is included for robustness.\n    sort_indices = np.argsort(omega)\n    omega_sorted = omega[sort_indices]\n    rates_sorted = rates[sort_indices]\n\n    for n in range(1, 5):\n        # Step 1: Parameter Estimation (Least Squares for k_n)\n        # The model is r = k * (1-Omega)^n. This is a linear regression through\n        # the origin if we let x = (1-Omega)^n and y = r.\n        x_model = (1 - omega_sorted)**n\n        \n        # The least-squares solution for k is sum(x*y) / sum(x^2).\n        k_n = np.sum(x_model * rates_sorted) / np.sum(x_model**2)\n\n        # Step 2: Residual Calculation\n        rates_pred = k_n * x_model\n        residuals = rates_sorted - rates_pred\n        ssr = np.sum(residuals**2)\n\n        # Step 3: Model Adequacy Diagnostics\n        \n        # Corrected Akaike Information Criterion (AICc)\n        # AICc = N*ln(SSR/N) + 2p + 2p(p+1)/(N-p-1)\n        if N - p - 1 = 0:  # Avoid division by zero or negative number\n            aicc = np.inf\n        else:\n            aicc = N * np.log(ssr / N) + 2 * p + (2 * p * (p + 1)) / (N - p - 1)\n\n        # Durbin-Watson (DW) Statistic for autocorrelation\n        # DW = sum((e_i - e_{i-1})^2) / sum(e_i^2)\n        dw_numerator = np.sum(np.diff(residuals)**2)\n        # Avoid division by zero if residuals are all zero (perfect fit).\n        dw = dw_numerator / ssr if ssr > 0 else 2.0\n\n        # Pearson Correlation Coefficient (rho) between residuals and Omega\n        # np.corrcoef returns a 2x2 correlation matrix. [0, 1] is the off-diagonal.\n        if np.std(residuals) == 0: # Handle perfect fit where correlation is undefined\n            pearson_r = 0.0\n        else:\n            pearson_r = np.corrcoef(residuals, omega_sorted)[0, 1]\n\n        candidate_results.append({\n            'n': n,\n            'aicc': aicc,\n            'dw': dw,\n            'rho': pearson_r\n        })\n\n    # Step 4: Model Selection\n    \n    # Identify models that are \"adequate\" based on DW and rho criteria.\n    adequate_models = []\n    for res in candidate_results:\n        is_dw_adequate = 1.5 = res['dw'] = 2.5\n        is_rho_adequate = abs(res['rho']) = 0.2\n        if is_dw_adequate and is_rho_adequate:\n            adequate_models.append(res)\n    \n    if adequate_models:\n        # If adequate models exist, select among them using AICc and parsimony.\n        all_aicc = [res['aicc'] for res in candidate_results]\n        aicc_min = np.min(all_aicc)\n        \n        # Filter for plausible models (AICc within 2 units of the minimum).\n        plausible_models = []\n        for model in adequate_models:\n            if model['aicc'] = aicc_min + 2:\n                plausible_models.append(model)\n        \n        # Select the most parsimonious model (smallest n) from the plausible set.\n        selected_n = min(model['n'] for model in plausible_models)\n    else:\n        # If no model is adequate, fall back to selecting the one that minimizes AICc.\n        aicc_values = [res['aicc'] for res in candidate_results]\n        best_n_index = np.argmin(aicc_values)\n        selected_n = candidate_results[best_n_index]['n']\n        \n    return selected_n\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (nominal linear behavior)\n        (np.array([0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45]),\n         np.array([1.93e-9, 1.76e-9, 1.71e-9, 1.58e-9, 1.50e-9, 1.42e-9, 1.29e-9, 1.17e-9, 1.14e-9])),\n        # Case 2 (quadratic-like curvature)\n        (np.array([0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45]),\n         np.array([1.825e-9, 1.59e-9, 1.465e-9, 1.27e-9, 1.125e-9, 0.99e-9, 0.825e-9, 0.70e-9, 0.635e-9])),\n        # Case 3 (cubic-like curvature)\n        (np.array([0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45]),\n         np.array([1.73475e-9, 1.438e-9, 1.23825e-9, 1.014e-9, 0.84375e-9, 0.706e-9, 0.53925e-9, 0.412e-9, 0.35275e-9])),\n        # Case 4 (parsimonious selection with few points)\n        (np.array([0.05, 0.20, 0.35, 0.45]),\n         np.array([1.425e-9, 1.22e-9, 0.955e-9, 0.835e-9]))\n    ]\n\n    results = []\n    for omega, rates in test_cases:\n        selected_n = analyze_case(omega, rates)\n        results.append(selected_n)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "掌握了速率定律的理论基础和参数化方法后，最终目标是利用这些模型来预测复杂地球化学系统的动态演化。本练习是一个综合性的模拟挑战，要求你将亲和力驱动的动力学与质量平衡及水溶液化学平衡相结合，来模拟一个封闭批式反应器中矿物溶解的全过程 。通过构建并求解常微分方程组 (ODEs)，你将观察到溶液化学成分如何随时间变化，并逐渐趋近化学平衡，从而深刻体验到动力学模型在定量预测中的强大作用。",
            "id": "4068596",
            "problem": "考虑一个封闭、恒温、固定体积为 $V$ 的间歇式反应器，其中包含与反应性矿物表面（面积为 $S$）接触的初始未饱和水溶液。一种微溶碳酸盐矿物的溶解为溶液提供了水相 $\\mathrm{Ca}^{2+}$ 和无机碳，从而改变了反应商 $Q$ 和饱和指数 $\\Omega$，进而通过一个基于亲和度的动力学定律来调节溶解速率。设 $C_{\\mathrm{Ca}}(t)$ 表示水相 $\\mathrm{Ca}^{2+}$ 的摩尔浓度，设 $C_T(t)$ 表示总无机碳的摩尔浓度，定义为所有溶解的无机碳物种之和。假设离子强度较低，因此活度可以用浓度近似。液体体积是恒定的，反应器是充分混合的。由于强缓冲剂的存在，系统在固定的 $\\mathrm{pH}$ 值下受到酸碱形态的约束，工作温度下碳酸的第一和第二解离常数分别为 $K_1$ 和 $K_2$。矿物的溶度积 $K_{sp}$ 已给出。溶解反应是化学计量的，即每溶解一摩尔矿物，就会向溶液中释放一摩尔 $\\mathrm{Ca}^{2+}$ 和一摩尔无机碳。反应商为 $Q(t) = a_{\\mathrm{Ca}^{2+}}(t)\\, a_{\\mathrm{CO}_3^{2-}}(t)$，饱和指数为 $\\Omega(t) = Q(t)/K_{sp}$。物种形态意味着 $C_T(t) = [\\mathrm{CO}_2(\\mathrm{aq})](t) + [\\mathrm{HCO}_3^{-}](t) + [\\mathrm{CO}_3^{2-}](t)$，其中 $[\\mathrm{CO}_3^{2-}](t)$ 由 $K_1$、$K_2$ 和固定的 $\\mathrm{pH}$ 值决定。在低离子强度下，将 $Q(t)$ 近似为 $Q(t) \\approx C_{\\mathrm{Ca}}(t)\\, [\\mathrm{CO}_3^{2-}](t)$，且 $\\Omega(t) = Q(t)/K_{sp}$。\n\n从 $Q$ 和 $\\Omega$ 的定义、溶解的化学计量关系以及酸碱质量作用定律出发，推导间歇式反应器中 $C_{\\mathrm{Ca}}(t)$ 和 $C_T(t)$ 演化的常微分方程 (ODE)，其中溶解速率通过基于亲和度的动力学速率定律依赖于热力学驱动力。将亲和度表述为一个与偏离平衡程度的度量相符的、关于 $\\Omega(t)$ 的无量纲函数，并构建一个使用速率系数和反应级数的经验速率表达式，该表达式在 $\\Omega(t) \\geq 1$ 时为零，在 $\\Omega(t)  1$ 时产生正的溶解速率，并与物理预期相符。\n\n实现一个程序，该程序：\n- 强制执行固定 $\\mathrm{pH}$ 下的物种形态约束，以将 $[\\mathrm{CO}_3^{2-}](t)$ 表示为 $C_T(t)$、$K_1$、$K_2$ 和 $\\mathrm{pH}$ 的函数，并在 $Q(t)$ 和 $\\Omega(t)$ 中使用此 $[\\mathrm{CO}_3^{2-}](t)$。\n- 使用数值方法，应用您推导的基于亲和度的动力学速率定律，对所得的耦合 ODE 进行时间积分。\n- 对每个测试案例，返回最终值 $C_{\\mathrm{Ca}}(t_{\\mathrm{final}})$。\n\n使用以下科学上一致的参数集作为测试套件。在所有情况下，将活度视为浓度，假设 $\\mathrm{pH}$ 恒定，并从初始时间 $t=0$ 求解到 $t=t_{\\mathrm{final}}$。\n\n测试案例 A（一般未饱和情况）：\n- $V = 1.0$ $\\mathrm{L}$，$S = 0.1$ $\\mathrm{m}^2$，$K_{sp} = 3.31 \\times 10^{-9}$，$K_1 = 4.47 \\times 10^{-7}$，$K_2 = 4.68 \\times 10^{-11}$，$\\mathrm{pH} = 8.30$，速率系数 $k = 1.0 \\times 10^{-6}$ $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，反应级数 $n = 1.0$，初始 $C_{\\mathrm{Ca}}(0) = 0.0$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，初始 $C_T(0) = 2.0 \\times 10^{-3}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，以及 $t_{\\mathrm{final}} = 72000.0$ $\\mathrm{s}$。\n\n测试案例 B（初始过饱和边界；溶解必须为零）：\n- $V = 1.0$ $\\mathrm{L}$，$S = 0.1$ $\\mathrm{m}^2$，$K_{sp} = 3.31 \\times 10^{-9}$，$K_1 = 4.47 \\times 10^{-7}$，$K_2 = 4.68 \\times 10^{-11}$，$\\mathrm{pH} = 8.30$，$k = 1.0 \\times 10^{-6}$ $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，$n = 1.0$，$C_{\\mathrm{Ca}}(0) = 5.0 \\times 10^{-4}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，$C_T(0) = 2.0 \\times 10^{-3}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，以及 $t_{\\mathrm{final}} = 3600.0$ $\\mathrm{s}$。\n\n测试案例 C（低 $\\mathrm{pH}$ 边缘；碳酸盐形态弱有利）：\n- $V = 1.0$ $\\mathrm{L}$，$S = 0.1$ $\\mathrm{m}^2$，$K_{sp} = 3.31 \\times 10^{-9}$，$K_1 = 4.47 \\times 10^{-7}$，$K_2 = 4.68 \\times 10^{-11}$，$\\mathrm{pH} = 6.50$，$k = 1.0 \\times 10^{-6}$ $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，$n = 1.0$，$C_{\\mathrm{Ca}}(0) = 0.0$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，$C_T(0) = 2.0 \\times 10^{-3}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，以及 $t_{\\mathrm{final}} = 86400.0$ $\\mathrm{s}$。\n\n测试案例 D（零表面积边界；无反应）：\n- $V = 1.0$ $\\mathrm{L}$，$S = 0.0$ $\\mathrm{m}^2$，$K_{sp} = 3.31 \\times 10^{-9}$，$K_1 = 4.47 \\times 10^{-7}$，$K_2 = 4.68 \\times 10^{-11}$，$\\mathrm{pH} = 8.30$，$k = 1.0 \\times 10^{-6}$ $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，$n = 2.0$，$C_{\\mathrm{Ca}}(0) = 1.0 \\times 10^{-4}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，$C_T(0) = 1.0 \\times 10^{-3}$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，以及 $t_{\\mathrm{final}} = 43200.0$ $\\mathrm{s}$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，顺序与测试案例 A、B、C、D 一致。每个条目必须是最终值 $C_{\\mathrm{Ca}}(t_{\\mathrm{final}})$，单位为 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$，表示为浮点数。例如，输出格式应为 $[x_1,x_2,x_3,x_4]$，其中 $x_i$ 是单位为 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$ 的浮点数。",
            "solution": "该问题要求推导并数值求解一个常微分方程 (ODE) 系统，该系统描述了间歇式反应器中矿物的溶解过程。此过程由水相碳酸盐形态和基于亲和度的动力学速率定律控制。\n\n**1. 碳酸盐形态**\n系统在恒定 pH 值下被缓冲，因此氢离子浓度 $[\\mathrm{H}^+] = 10^{-\\mathrm{pH}}$ 是恒定的。总溶解无机碳 $C_T$ 是三种物种的总和：\n$$C_T(t) = [\\mathrm{CO}_2(\\mathrm{aq})](t) + [\\mathrm{HCO}_3^{-}](t) + [\\mathrm{CO}_3^{2-}](t)$$\n酸碱平衡由解离常数 $K_1$ 和 $K_2$ 定义：\n$$K_1 = \\frac{[\\mathrm{H}^+][\\mathrm{HCO}_3^{-}]}{[\\mathrm{CO}_2(\\mathrm{aq})]}$$\n$$K_2 = \\frac{[\\mathrm{H}^+][\\mathrm{CO}_3^{2-}]}{[\\mathrm{HCO}_3^{-}]}$$\n我们将 $[\\mathrm{CO}_2(\\mathrm{aq})]$ 和 $[\\mathrm{HCO}_3^{-}]$ 用 $[\\mathrm{CO}_3^{2-}]$ 表示：\n$$[\\mathrm{HCO}_3^{-}] = \\frac{[\\mathrm{H}^+]}{K_2}[\\mathrm{CO}_3^{2-}]$$\n$$[\\mathrm{CO}_2(\\mathrm{aq})] = \\frac{[\\mathrm{H}^+]}{K_1}[\\mathrm{HCO}_3^{-}] = \\frac{[\\mathrm{H}^+]^2}{K_1 K_2}[\\mathrm{CO}_3^{2-}]$$\n将这些代入 $C_T(t)$ 的表达式中：\n$$C_T(t) = \\left( \\frac{[\\mathrm{H}^+]^2}{K_1 K_2} + \\frac{[\\mathrm{H}^+]}{K_2} + 1 \\right) [\\mathrm{CO}_3^{2-}](t)$$\n这使我们能够将碳酸根离子浓度 $[\\mathrm{CO}_3^{2-}]$ 写为总无机碳的一部分，即 $[\\mathrm{CO}_3^{2-}](t) = \\alpha_2 C_T(t)$，其中 $\\alpha_2$ 是碳酸盐的形态分数。由于 $\\mathrm{pH}$ 是恒定的，$\\alpha_2$ 是一个常数，由下式给出：\n$$\\alpha_2 = \\left( \\frac{[\\mathrm{H}^+]^2}{K_1 K_2} + \\frac{[\\mathrm{H}^+]}{K_2} + 1 \\right)^{-1} = \\frac{K_1 K_2}{[\\mathrm{H}^+]^2 + K_1[\\mathrm{H}^+] + K_1 K_2}$$\n\n**2. 动力学速率定律与驱动力**\n溶解的热力学驱动力与饱和指数 $\\Omega$ 相关。使用低离子强度假设 ($a_i \\approx C_i$)，反应商 $Q(t)$ 和饱和指数 $\\Omega(t)$ 为：\n$$Q(t) = C_{\\mathrm{Ca}}(t)[\\mathrm{CO}_3^{2-}](t) = C_{\\mathrm{Ca}}(t) \\alpha_2 C_T(t)$$\n$$\\Omega(t) = \\frac{Q(t)}{K_{sp}} = \\frac{C_{\\mathrm{Ca}}(t) \\alpha_2 C_T(t)}{K_{sp}}$$\n一个与过渡态理论一致的、基于亲和度的经验动力学速率定律的常见形式是：\n$$r(t) = k(1 - \\Omega(t))^n, \\quad \\text{对于 } \\Omega(t)  1$$\n$$r(t) = 0, \\quad \\text{对于 } \\Omega(t) \\ge 1$$\n其中 $r(t)$ 是溶解速率，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$，$k$ 是速率系数，$n$ 是反应级数。这可以用一个最大值函数紧凑地表示：\n$$r(t) = k \\left( \\max\\left(0, 1 - \\Omega(t)\\right) \\right)^n$$\n\n**3. 控制常微分方程 (ODE)**\n对于一个体积恒定为 $V$ 的充分混合的间歇式反应器，浓度为 $C_i$ 的物种的质量平衡由下式给出：\n$$\\frac{dC_i}{dt} = \\frac{S}{V} \\nu_i r(t)$$\n其中 $S$ 是反应表面积，$\\nu_i$ 是物种 $i$ 在溶解反应中的化学计量系数。根据问题的化学计量关系，溶解 1 摩尔矿物会释放 1 摩尔 $\\mathrm{Ca}^{2+}$ 和 1 摩尔总无机碳。因此，$\\nu_{\\mathrm{Ca}} = 1$ 且 $\\nu_{T} = 1$。ODE 系统为：\n$$\\frac{dC_{\\mathrm{Ca}}}{dt} = \\frac{S}{V} r(t)$$\n$$\\frac{dC_T}{dt} = \\frac{S}{V} r(t)$$\n由于等式右侧相同，它们的变化率也相等。我们可以对这个关系从 $t=0$ 到 $t$ 进行积分：\n$$C_{\\mathrm{Ca}}(t) - C_{\\mathrm{Ca}}(0) = C_T(t) - C_T(0)$$\n这在两个浓度之间产生了一个代数约束：\n$$C_T(t) = C_{\\mathrm{Ca}}(t) + (C_T(0) - C_{\\mathrm{Ca}}(0)) = C_{\\mathrm{Ca}}(t) + \\Delta_0$$\n其中 $\\Delta_0 = C_T(0) - C_{\\mathrm{Ca}}(0)$ 是一个常数。我们现在可以将此代入 $\\Omega(t)$ 的表达式中，将系统简化为关于 $C_{\\mathrm{Ca}}(t)$ 的单个 ODE：\n$$\\frac{dC_{\\mathrm{Ca}}}{dt} = \\frac{S}{V} k \\left( \\max\\left(0, 1 - \\frac{C_{\\mathrm{Ca}}(t) \\alpha_2 (C_{\\mathrm{Ca}}(t) + \\Delta_0)}{K_{sp}}\\right) \\right)^n$$\n这个一阶 ODE 可以用初始条件 $C_{\\mathrm{Ca}}(0)$ 进行数值求解。\n\n**4. 数值实现**\n推导出的 ODE 将使用数值积分程序 (`scipy.integrate.solve_ivp`) 对每个测试案例进行求解。对于每个案例，我们首先计算常数 $\\alpha_2$ 和 $\\Delta_0$。然后，我们定义 ODE 函数，并从 $C_{\\mathrm{Ca}}(0)$ 开始，在区间 $[0, t_{\\mathrm{final}}]$ 上对其进行积分。最终值 $C_{\\mathrm{Ca}}(t_{\\mathrm{final}})$ 就是结果。\n\n特殊情况提供了有用的验证：\n- 当初始状态是过饱和的 ($\\Omega(0) > 1$) 时，速率必须为零，因此 $C_{\\mathrm{Ca}}(t)$ 保持不变。\n- 当表面积 $S$ 为零时，速率也必须为零，且 $C_{\\mathrm{Ca}}(t)$ 保持不变。\n这些条件都由推导出的 ODE 正确处理。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves for the final calcium concentration in a series of batch reactor\n    simulations based on an affinity-based kinetic rate law for mineral dissolution.\n    \"\"\"\n\n    test_cases = [\n        # Test Case A\n        {\n            'V': 1.0, 'S': 0.1, 'Ksp': 3.31e-9, 'K1': 4.47e-7, 'K2': 4.68e-11,\n            'pH': 8.30, 'k': 1.0e-6, 'n': 1.0,\n            'cca0': 0.0, 'ct0': 2.0e-3, 't_final': 72000.0\n        },\n        # Test Case B\n        {\n            'V': 1.0, 'S': 0.1, 'Ksp': 3.31e-9, 'K1': 4.47e-7, 'K2': 4.68e-11,\n            'pH': 8.30, 'k': 1.0e-6, 'n': 1.0,\n            'cca0': 5.0e-4, 'ct0': 2.0e-3, 't_final': 3600.0\n        },\n        # Test Case C\n        {\n            'V': 1.0, 'S': 0.1, 'Ksp': 3.31e-9, 'K1': 4.47e-7, 'K2': 4.68e-11,\n            'pH': 6.50, 'k': 1.0e-6, 'n': 1.0,\n            'cca0': 0.0, 'ct0': 2.0e-3, 't_final': 86400.0\n        },\n        # Test Case D\n        {\n            'V': 1.0, 'S': 0.0, 'Ksp': 3.31e-9, 'K1': 4.47e-7, 'K2': 4.68e-11,\n            'pH': 8.30, 'k': 1.0e-6, 'n': 2.0,\n            'cca0': 1.0e-4, 'ct0': 1.0e-3, 't_final': 43200.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        V = params['V']\n        S = params['S']\n        Ksp = params['Ksp']\n        K1 = params['K1']\n        K2 = params['K2']\n        pH = params['pH']\n        k_rate = params['k']\n        n_order = params['n']\n        cca0 = params['cca0']\n        ct0 = params['ct0']\n        t_final = params['t_final']\n\n        # Calculate constants for the given case\n        H_plus = 10**(-pH)\n        alpha2_denom = H_plus**2 + K1 * H_plus + K1 * K2\n        alpha2 = (K1 * K2) / alpha2_denom\n        \n        delta0 = ct0 - cca0\n\n        def ode_system(t, c_ca):\n            \"\"\"\n            Defines the ODE for the change in Ca2+ concentration.\n            `c_ca` is a 1-element array containing the current C_Ca concentration.\n            \"\"\"\n            c_ca_val = c_ca[0]\n            \n            # Ensure concentration is non-negative\n            if c_ca_val  0:\n                c_ca_val = 0\n            \n            c_t = c_ca_val + delta0\n            \n            # Calculate saturation index Omega\n            omega = (c_ca_val * alpha2 * c_t) / Ksp\n            \n            # Affinity term: (1 - Omega)\n            affinity = 1.0 - omega\n            \n            # Rate is non-zero only if undersaturated (affinity > 0)\n            if affinity = 0:\n                rate_term = 0.0\n            else:\n                rate_term = affinity**n_order\n                \n            dCca_dt = (S / V) * k_rate * rate_term\n            \n            return [dCca_dt]\n\n        # Set up and run the ODE solver\n        t_span = [0, t_final]\n        y0 = [cca0]\n        \n        # Method 'Radau' is robust for potentially stiff problems\n        sol = solve_ivp(ode_system, t_span, y0, method='Radau', dense_output=True)\n        \n        final_cca = sol.y[0, -1]\n        results.append(final_cca)\n\n    # Format the final output as specified\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}