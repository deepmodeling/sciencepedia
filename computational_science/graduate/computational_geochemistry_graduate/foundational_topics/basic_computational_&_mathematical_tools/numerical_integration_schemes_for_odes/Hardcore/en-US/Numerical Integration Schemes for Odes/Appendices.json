{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical schemes, it is crucial to understand *why* they are needed. This first exercise  provides a foundational look at the concept of stiffness, a ubiquitous challenge in geochemical reaction modeling. By analyzing the simple explicit forward Euler method, you will derive its stability function $R(z)$ and discover the severe time step limitations it faces when applied to systems with fast-decaying modes, providing a clear motivation for the implicit and specialized methods explored next.",
            "id": "4093770",
            "problem": "In computational geochemistry, stiff ordinary differential equations (ODEs) arise when multiple coupled aqueous reactions relax toward equilibrium on widely separated time scales. Consider a local linearization of a reactive transport source term at a fixed state, represented by the Jacobian matrix of the reaction terms, whose spectrum contains negative real eigenvalues due to dissipative chemistry. Let the governing scalar test equation be the Dahlquist test ODE $y'(t) = \\lambda y(t)$ with $\\lambda \\in \\mathbb{C}$ and the explicit forward Euler time discretization. \n\nStarting from the test equation and the forward Euler update, derive the one-step amplification (stability) function $R(z)$ as a function of the dimensionless step $z = h \\lambda$, where $h$ is the time step. Using the definition of absolute stability and the concept of $A$-stability, determine whether the forward Euler method is $A$-stable. Then, specialize to the case of purely real, negative eigenvalues as encountered in strongly damped geochemical reaction networks and deduce the condition on $h$ needed for linear stability of the forward Euler method for each eigenvalue.\n\nNow consider a chemically realistic stiff Jacobian with real negative eigenvalues typical of rapid acid-base neutralization and sorption in brines at elevated temperature:\n$$\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}, \\quad \\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}, \\quad \\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}.$$\nAssuming forward Euler is applied to this linearized system, compute the largest time step $h_{\\text{max}}$ (in seconds) that guarantees linear stability across all three modes. Round your numerical answer to four significant figures and express the final time step in seconds.",
            "solution": "The problem asks for a multi-part analysis of the forward Euler method's stability, first in general and then applied to a specific stiff system from computational geochemistry.\n\nFirst, we validate the problem statement.\n**Step 1: Extract Givens**\n- Governing scalar test equation: $y'(t) = \\lambda y(t)$, with $\\lambda \\in \\mathbb{C}$.\n- Time discretization: Explicit forward Euler method.\n- Dimensionless step variable: $z = h \\lambda$, where $h$ is the time step.\n- Task 1: Derive the one-step amplification (stability) function $R(z)$.\n- Task 2: Determine if the forward Euler method is $A$-stable, using the definitions of absolute stability and $A$-stability.\n- Task 3: For purely real, negative eigenvalues, deduce the condition on $h$ for linear stability.\n- Stiff Jacobian eigenvalues: $\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}$, $\\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}$, $\\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}$.\n- Task 4: Compute the largest stable time step $h_{\\text{max}}$ for the given system.\n- Formatting: Round the final numerical answer to four significant figures and express it in seconds.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It is a standard exercise in numerical analysis for ordinary differential equations (ODEs), using the Dahlquist test equation to analyze the stability of the forward Euler method. The context provided (computational geochemistry, stiff systems) is a realistic application where such analysis is critical. The given eigenvalues are representative of a stiff system, having large negative real parts and spanning several orders of magnitude. The problem statement is self-contained, with all necessary information provided to proceed with a logical derivation and calculation. There are no contradictions, ambiguities, or invalid scientific premises.\n\n**Step 3: Verdict and Action**\nThe problem is valid. We proceed to the solution.\n\nThe solution is developed in four parts as requested.\n\n**Part 1: Derivation of the Amplification Function $R(z)$**\nWe begin with the Dahlquist test equation:\n$$y'(t) = \\lambda y(t)$$\nThe explicit forward Euler method discretizes a general ODE $y'(t) = f(t, y(t))$ as:\n$$y_{n+1} = y_n + h f(t_n, y_n)$$\nwhere $y_n$ is the numerical approximation of $y(t_n)$ and $h$ is the time step. For our test equation, $f(t,y) = \\lambda y$, so the scheme becomes:\n$$y_{n+1} = y_n + h (\\lambda y_n)$$\nFactoring out $y_n$, we get the one-step update rule:\n$$y_{n+1} = (1 + h \\lambda) y_n$$\nThe amplification factor is the ratio $\\frac{y_{n+1}}{y_n}$, which determines how the solution's magnitude changes from one step to the next.\n$$\\frac{y_{n+1}}{y_n} = 1 + h \\lambda$$\nThe stability function, denoted by $R(z)$, is this amplification factor expressed as a function of the dimensionless step $z = h \\lambda$.\n$$R(z) = 1 + z$$\n\n**Part 2: Assessment of $A$-stability**\nFor a numerical method to be considered stable, the magnitude of the amplification factor must not exceed $1$. This condition, $|R(z)| \\le 1$, prevents the growth of numerical errors and ensures that the numerical solution decays if the true solution does. The region of absolute stability, $S$, is the set of all $z \\in \\mathbb{C}$ for which this condition holds:\n$$S = \\{z \\in \\mathbb{C} : |R(z)| \\le 1\\}$$\nFor the forward Euler method, this is:\n$$S = \\{z \\in \\mathbb{C} : |1 + z| \\le 1\\}$$\nLet $z = x + iy$, where $x, y \\in \\mathbb{R}$. The inequality becomes $|(1+x) + iy| \\le 1$. The magnitude is $\\sqrt{(1+x)^2 + y^2}$, so we have:\n$$\\sqrt{(1+x)^2 + y^2} \\le 1 \\implies (1+x)^2 + y^2 \\le 1$$\nThis inequality describes a closed disk in the complex plane centered at $(-1, 0)$ with a radius of $1$.\n\nA method is defined as $A$-stable if its region of absolute stability contains the entire open left half-plane, i.e., $\\{z \\in \\mathbb{C} : \\text{Re}(z) < 0\\} \\subseteq S$. This property is desirable for solving stiff equations, as their eigenvalues typically have large negative real parts.\nThe stability region for forward Euler is a bounded disk. The left half-plane is an unbounded region. Clearly, the disk does not contain the entire left half-plane. For instance, the point $z = -3$, which is in the left half-plane, is not in the stability region because $|R(-3)| = |1 - 3| = |-2| = 2 > 1$. Therefore, the forward Euler method is not $A$-stable.\n\n**Part 3: Stability Condition for Real Negative Eigenvalues**\nFor dissipative chemical reactions, the eigenvalues are often real and negative. Let $\\lambda = -k$ where $k$ is a positive real number, $k > 0$. Then the dimensionless step $z = h \\lambda = -hk$ is also a real, negative number. The stability condition $|R(z)| \\le 1$ becomes:\n$$|1 - hk| \\le 1$$\nThis absolute value inequality is equivalent to:\n$$-1 \\le 1 - hk \\le 1$$\nWe analyze the two parts of the inequality:\n1. $1 - hk \\le 1 \\implies -hk \\le 0 \\implies hk \\ge 0$. This is always true since $h > 0$ and $k > 0$.\n2. $-1 \\le 1 - hk \\implies hk \\le 2$.\n\nCombining these, the condition for linear stability with a real, negative eigenvalue $\\lambda$ is $h|\\lambda| \\le 2$. This can be expressed as a constraint on the time step $h$:\n$$h \\le \\frac{2}{|\\lambda|}$$\n\n**Part 4: Calculation of the Maximum Stable Time Step $h_{\\text{max}}$**\nFor a system of ODEs, the numerical method must be stable for every mode associated with each eigenvalue $\\lambda_i$ of the system's Jacobian. The stability condition must hold for all eigenvalues simultaneously. This means the time step $h$ must satisfy:\n$$h \\le \\frac{2}{|\\lambda_i|} \\quad \\text{for all } i$$\nTo satisfy this set of inequalities, $h$ must be less than or equal to the minimum of all the individual upper bounds:\n$$h \\le \\min_{i} \\left(\\frac{2}{|\\lambda_i|}\\right) = \\frac{2}{\\max_{i} |\\lambda_i|}$$\nThe eigenvalue with the largest magnitude (the \"fastest\" mode) dictates the stability limit for the entire system.\nThe given eigenvalues are:\n$\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}$\n$\\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}$\n$\\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}$\nTheir magnitudes are:\n$|\\lambda_{1}| = 6.3 \\times 10^{5} \\,\\text{s}^{-1}$\n$|\\lambda_{2}| = 4.1 \\times 10^{6} \\,\\text{s}^{-1}$\n$|\\lambda_{3}| = 1.2 \\times 10^{5} \\,\\text{s}^{-1}$\nThe maximum magnitude is:\n$$\\max_{i} |\\lambda_i| = |\\lambda_2| = 4.1 \\times 10^{6} \\,\\text{s}^{-1}$$\nThe largest permissible time step, $h_{\\text{max}}$, is therefore:\n$$h_{\\text{max}} = \\frac{2}{\\max_{i} |\\lambda_i|} = \\frac{2}{4.1 \\times 10^{6} \\,\\text{s}^{-1}}$$\nNow, we compute the numerical value:\n$$h_{\\text{max}} = \\frac{2}{4.1} \\times 10^{-6} \\,\\text{s} \\approx 0.487804878... \\times 10^{-6} \\,\\text{s}$$\n$$h_{\\text{max}} \\approx 4.87804878... \\times 10^{-7} \\,\\text{s}$$\nRounding to four significant figures as required:\n$$h_{\\text{max}} \\approx 4.878 \\times 10^{-7} \\,\\text{s}$$\nThis extremely small time step highlights the severe limitation of the explicit forward Euler method for stiff problems, which is why implicit or specialized stiff solvers are generally required in computational geochemistry.",
            "answer": "$$\\boxed{4.878 \\times 10^{-7}}$$"
        },
        {
            "introduction": "Having established the limitations of explicit methods for stiff systems, we now turn to implicit solvers that offer a solution. This practice  explores the critical differences between two A-stable methods: the backward Euler and trapezoidal rules. You will investigate the concept of L-stability and quantify how the trapezoidal rule's failure to damp high-frequency modes can lead to non-physical overshoots, a crucial consideration when modeling transient phenomena in stiff geochemical kinetics.",
            "id": "4093758",
            "problem": "Consider a stiff linearized geochemical kinetic relaxation that models the return of a dissolved species concentration to equilibrium after a perturbation. Let the concentration be denoted by $c(t)$, the equilibrium concentration by $c_{\\mathrm{eq}}$, and the kinetic rate constant by $k>0$. Near equilibrium, mass-action kinetics and linearization give the relaxation ordinary differential equation (ODE)\n$$\n\\frac{dc}{dt} = -k(c - c_{\\mathrm{eq}}),\n$$\nwhich is the shifted form of the Dahlquist test equation when written for the error $e(t) = c(t)-c_{\\mathrm{eq}}$:\n$$\n\\frac{de}{dt} = \\lambda e, \\quad \\lambda = -k < 0.\n$$\nTwo classical $A$-stable implicit one-step methods for stiff initial value problems in Ordinary Differential Equations (ODEs) are the backward Euler method and the trapezoidal rule (also called the Crank–Nicolson method). Define the dimensionless step parameter $z = h\\,\\lambda$, where $h>0$ is the time step. For each method, one can write a recurrence for the discrete error $e_n = c_n - c_{\\mathrm{eq}}$ of the form $e_{n+1} = R(z)\\,e_n$, where $R(z)$ is the method’s stability function.\n\nYour tasks are:\n1) Starting from the definitions of the backward Euler method and the trapezoidal rule as implicit one-step methods applied to $dc/dt = -k(c-c_{\\mathrm{eq}})$, derive, in terms of $e_n$, the corresponding one-step recurrences and identify the stability function $R(z)$ for each method in the Dahlquist test form $de/dt = \\lambda e$.\n2) Using first principles about sign changes in the discrete error $e_n$, determine the condition on real $z<0$ under which the trapezoidal rule produces a first-step overshoot past equilibrium when the initial condition starts below equilibrium (i.e., $e_0<0$ implies $e_1>0$). Define the overshoot ratio\n$$\nS(z) = \\frac{c_1 - c_{\\mathrm{eq}}}{c_{\\mathrm{eq}} - c_0} = \\frac{e_1}{-e_0},\n$$\nand express $S(z)$ in closed form in terms of $z$.\n3) In a geochemically plausible kinetic scenario with $k = 200\\,\\mathrm{s}^{-1}$, $c_{\\mathrm{eq}} = 1.0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$, $c_0 = 0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$, and a time step $h = 0.020\\,\\mathrm{s}$, evaluate the trapezoidal-rule overshoot ratio $S$ numerically. Report this single dimensionless number rounded to four significant figures.\n4) Using the limiting behavior of the stability functions as $z \\to -\\infty$, explain, in the context of multi-timescale geochemical kinetics with very fast relaxation modes (large $k$), why the property of $L$-stability (the combination of $A$-stability and $\\lim_{z\\to -\\infty} R(z)=0$) makes the backward Euler method preferable for suppressing spurious transient features, whereas the trapezoidal rule can retain and reflect high-frequency modes.\n\nOnly the numerical value requested in item $3)$ should be reported as your final answer. No units are required for the final answer because $S$ is dimensionless. Round your answer to four significant figures.",
            "solution": "We begin from the linear relaxation model\n$$\n\\frac{dc}{dt} = -k(c - c_{\\mathrm{eq}}),\n$$\nand introduce the error variable $e(t) = c(t) - c_{\\mathrm{eq}}$. Because $c_{\\mathrm{eq}}$ is constant, we obtain the Dahlquist test equation\n$$\n\\frac{de}{dt} = \\lambda e, \\qquad \\lambda = -k  0.\n$$\nLet $h>0$ denote a fixed time step and define $z = h\\lambda$.\n\nBackward Euler method. The backward Euler update for the original $c$-equation is\n$$\nc_{n+1} = c_n + h(-k(c_{n+1} - c_{\\mathrm{eq}})).\n$$\nSubtracting $c_{\\mathrm{eq}}$ from both sides and using $e_n = c_n - c_{\\mathrm{eq}}$, we get\n$$\ne_{n+1} = e_n - h k e_{n+1}.\n$$\nRearranging yields\n$$\n(1 - z)e_{n+1} = e_n \\quad \\implies \\quad e_{n+1} = R_{\\mathrm{BE}}(z)e_n, \\quad \\text{where} \\quad R_{\\mathrm{BE}}(z) = \\frac{1}{1 - z}.\n$$\n\nTrapezoidal rule (Crank–Nicolson). The trapezoidal update applied to $c$ is\n$$\nc_{n+1} = c_n + \\frac{h}{2}\\Big[ -k(c_n - c_{\\mathrm{eq}}) - k(c_{n+1} - c_{\\mathrm{eq}}) \\Big].\n$$\nSubtract $c_{\\mathrm{eq}}$ from both sides:\n$$\ne_{n+1} = e_n - \\frac{hk}{2}(e_n + e_{n+1}).\n$$\nRearrange to isolate $e_{n+1}$:\n$$\n\\Big(1 - \\frac{z}{2}\\Big)e_{n+1} = \\Big(1 + \\frac{z}{2}\\Big)e_n \\quad \\implies \\quad e_{n+1} = R_{\\mathrm{TR}}(z)e_n, \\quad \\text{where} \\quad R_{\\mathrm{TR}}(z) = \\frac{1 + z/2}{1 - z/2}.\n$$\n\nOvershoot condition and overshoot ratio for the trapezoidal rule. Suppose the initial condition starts below equilibrium so that $e_0 = c_0 - c_{\\mathrm{eq}}  0$. An overshoot past equilibrium at the first step means $e_1 > 0$. From $e_{1} = R_{\\mathrm{TR}}(z)e_0$, this occurs if and only if $R_{\\mathrm{TR}}(z)  0$. For real $z0$, the denominator $1 - z/2$ is positive for all $z2$, while the numerator $1 + z/2$ is negative if and only if $z  -2$. Therefore,\n$$\nR_{\\mathrm{TR}}(z)  0 \\quad \\Longleftrightarrow \\quad z  -2.\n$$\nThe overshoot ratio is defined by\n$$\nS(z) = \\frac{c_1 - c_{\\mathrm{eq}}}{c_{\\mathrm{eq}} - c_0} = \\frac{e_1}{-e_0}.\n$$\nUsing $e_1 = R_{\\mathrm{TR}}(z)e_0$, we obtain the closed-form expression\n$$\nS(z) = -R_{\\mathrm{TR}}(z) = -\\frac{1 + z/2}{1 - z/2}, \\quad \\text{valid in particular when } z-2 \\text{ so that } S(z)>0.\n$$\n\nNumerical evaluation for the given scenario. With $k = 200\\,\\mathrm{s}^{-1}$ and $h = 0.020\\,\\mathrm{s}$, we have\n$$\n\\lambda = -k = -200\\,\\mathrm{s}^{-1}, \\qquad z = h\\lambda = (0.020)\\times(-200) = -4.\n$$\nBecause $z=-4-2$, the trapezoidal rule will overshoot on the first step. The overshoot ratio is\n$$\nS = S(-4) = -\\frac{1 + (-4)/2}{1 - (-4)/2} = -\\frac{1 - 2}{1 + 2} = -\\frac{-1}{3} = \\frac{1}{3}.\n$$\nRounded to four significant figures, this is\n$$\nS = 0.3333.\n$$\n\nPreference for $L$-stability in stiff geochemical kinetics. A method is $L$-stable if it is $A$-stable and its stability function satisfies $\\lim_{z\\to -\\infty} R(z) = 0$. For backward Euler, $R_{\\mathrm{BE}}(z) = 1/(1 - z)$ is $A$-stable, and\n$$\n\\lim_{z\\to -\\infty} R_{\\mathrm{BE}}(z) = 0,\n$$\nso backward Euler is $L$-stable. For the trapezoidal rule, $R_{\\mathrm{TR}}(z) = (1 + z/2)/(1 - z/2)$ is $A$-stable, but\n$$\n\\lim_{z\\to -\\infty} R_{\\mathrm{TR}}(z) = -1,\n$$\nso it is not $L$-stable. In multi-timescale geochemical systems, very fast modes (large $k$) correspond to very negative $z$ for any practical $h$. An $L$-stable method like backward Euler damps these modes in a single step, eliminating spurious high-frequency transients and preventing nonphysical reflections or overshoots that can pollute the slow manifold. In contrast, the trapezoidal rule transmits these fast modes with near-unit magnitude and alternating sign when $z \\ll -1$, leading to slowly decaying, oscillatory numerical artifacts (including the quantified first-step overshoot) that can degrade accuracy and robustness in reactive transport and coupled kinetic–equilibrium simulations. Thus, when unresolved fast kinetics are present, $L$-stability makes backward Euler preferable.",
            "answer": "$$\\boxed{0.3333}$$"
        },
        {
            "introduction": "Our focus now expands from well-mixed systems to the more complex domain of reactive transport, where spatial variations and sharp fronts introduce new numerical challenges. This exercise  tasks you with implementing and comparing two Runge-Kutta schemes for an advection-reaction problem. By analyzing a Strong Stability Preserving (SSP) method against a classical non-SSP integrator, you will gain hands-on experience with techniques designed to prevent spurious oscillations and maintain the physical shape of reactive interfaces, a vital skill for building robust transport models.",
            "id": "4093712",
            "problem": "Consider a one-dimensional, dimensionless advection-reaction model for a reactive solute concentration $C(x,t)$ in a porous medium, representative of a geochemical transport scenario with a reactive interface. The governing partial differential equation (PDE) is the mass conservation law with a source term,\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = R(C),\n$$\nwhere $u$ is the constant dimensionless advection velocity and $R(C)$ is the dimensionless reaction rate. Let $R(C) = k\\,C(1-C)$ with reaction rate coefficient $k > 0$, which in the absence of transport bounds $C$ in $[0,1]$ for typical initial conditions. The domain is $x \\in [0,1]$, inflow boundary condition is $C(0,t) = 1$ for all $t \\ge 0$, and the outflow boundary condition is $C(1,t)$ free (advective outflow). The initial condition is a sharp front:\n$$\nC(x,0) = \\begin{cases}\n1,  0 \\le x  x_f, \\\\\n0,  x_f \\le x \\le 1,\n\\end{cases}\n$$\nwith $x_f = 0.2$.\n\nUsing a first-order upwind finite-volume (or equivalently finite-difference) discretization for the advective flux, construct a semi-discrete ordinary differential equation (ODE) system on a uniform mesh $x_i = i\\Delta x$ with $\\Delta x = 1/N$, where $N$ is the number of intervals and $i \\in \\{0,1,\\ldots,N\\}$. Enforce the inflow boundary by $C_0(t) = 1$ for all $t$, and evolve only the interior nodes $i \\ge 1$. The semi-discrete ODE for interior nodes is\n$$\n\\frac{d C_i}{dt} = -\\frac{u}{\\Delta x} \\left( C_i - C_{i-1} \\right) + k \\, C_i (1 - C_i), \\quad i = 1,2,\\ldots,N.\n$$\n\nThe Strong Stability Preserving (SSP) property refers to time integration schemes that can be written as convex combinations of forward Euler steps and, under the same time-step restriction that ensures forward Euler monotonicity for a given spatial discretization, inherit nonlinear stability properties such as boundedness and total variation non-increase. The classical four-stage Runge–Kutta method (RK4) is not Strong Stability Preserving (SSP) in the nonlinear, non-dissipative sense for general monotone operators, whereas the three-stage, third-order SSP Runge–Kutta method (SSPRK(3,3)) is SSP under the forward Euler time-step restriction.\n\nYour task is to implement two explicit time integration schemes for the semi-discrete ODE system:\n- A Strong Stability Preserving Runge–Kutta with three stages and third order (SSPRK(3,3)).\n- The classical four-stage Runge–Kutta method (RK4), which is non-SSP.\n\nUse the following setup for all runs:\n- Dimensionless advection speed $u = 1$.\n- Reaction rate coefficient $k = 25$.\n- Uniform mesh with $N = 400$ (so $\\Delta x = 1/N$).\n- Final time $T = 0.2$.\n- Dirichlet inflow boundary enforced as $C_0(t) = 1$ at all intermediate stages and time levels.\n- Time step defined by a Courant number $\\nu$ according to $\\Delta t = \\nu \\, \\Delta x / u$.\n\nFor each prescribed Courant number $\\nu$, start from the given initial condition and advance the numerical solution to time $T$ using each integrator separately. For each final numerical solution $C^n$ (where $n$ indexes the final time level), compute the following diagnostics that quantify spurious oscillations near the reactive interface:\n1. Overshoot magnitude beyond physical bounds $[0,1]$,\n$$\n\\mathrm{OV} = \\max\\left( \\max_i \\left( C_i^n - 1 \\right), \\, \\max_i \\left( - C_i^n \\right), \\, 0 \\right).\n$$\n2. Total variation increase relative to the initial total variation,\n$$\n\\mathrm{TV}(C) = \\sum_{i=1}^{N} \\left| C_i - C_{i-1} \\right|, \\quad \\Delta \\mathrm{TV} = \\mathrm{TV}\\left( C^n \\right) - \\mathrm{TV}\\left( C^0 \\right).\n$$\n\nRun the following test suite of Courant numbers to assess both the \"happy path,\" the boundary of monotonicity, and a supercritical case:\n- $\\nu = 0.9$ (well within the forward Euler stability bound),\n- $\\nu = 1.0$ (at the nominal forward Euler stability bound for first-order upwinding),\n- $\\nu = 1.2$ (above the forward Euler stability bound).\n\nFor each test case, report the following five values in order:\n- The Courant number $\\nu$,\n- The overshoot magnitude $\\mathrm{OV}$ for SSPRK(3,3),\n- The overshoot magnitude $\\mathrm{OV}$ for RK4,\n- The total variation increase $\\Delta \\mathrm{TV}$ for SSPRK(3,3),\n- The total variation increase $\\Delta \\mathrm{TV}$ for RK4.\n\nAll variables are dimensionless; no physical units are required. Angles are not involved. Percentages must not be used.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, flattening the five values per test case in sequence. For example,\n\"[nu1,ssp_OV1,rk4_OV1,ssp_dTV1,rk4_dTV1,nu2,ssp_OV2,rk4_OV2,ssp_dTV2,rk4_dTV2,nu3,ssp_OV3,rk4_OV3,ssp_dTV3,rk4_dTV3]\".",
            "solution": "The present problem requires the numerical solution of a one-dimensional advection-reaction partial differential equation (PDE) and a comparative analysis of two different time integration schemes. The core of the task is to observe and quantify the numerical stability properties of a Strong Stability Preserving (SSP) method versus a classical, non-SSP method when applied to a semi-discretized system that models sharp concentration fronts.\n\nThe governing PDE is given by:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = k\\,C(1-C)\n$$\nwhere $C(x,t)$ is the solute concentration, $u$ is a constant advection velocity, and $k$ is a reaction rate coefficient. The problem is solved on the domain $x \\in [0,1]$ with a fixed inflow concentration $C(0,t)=1$ and an initial condition representing a sharp front at $x_f=0.2$.\n\nThe first step in the solution process is the spatial discretization of the PDE to obtain a system of ordinary differential equations (ODEs), a technique known as the method of lines. The problem specifies a first-order upwind finite difference scheme on a uniform grid $x_i = i\\Delta x$ for $i \\in \\{0, 1, \\ldots, N\\}$ with $\\Delta x = 1/N$. The upwind scheme for the advective term $u \\frac{\\partial C}{\\partial x}$ at node $i$ (with $u > 0$) is approximated by $u \\frac{C_i - C_{i-1}}{\\Delta x}$. Combining this with the reaction term and applying it to each interior node $i \\in \\{1, 2, \\ldots, N\\}$ yields the semi-discrete ODE system:\n$$\n\\frac{d C_i}{dt} = -\\frac{u}{\\Delta x} \\left( C_i(t) - C_{i-1}(t) \\right) + k \\, C_i(t) (1 - C_i(t))\n$$\nThis system can be written abstractly as $\\frac{d\\boldsymbol{C}}{dt} = \\mathcal{L}(\\boldsymbol{C})$, where $\\boldsymbol{C}(t) = [C_1(t), \\ldots, C_N(t)]^T$ is the vector of concentrations at the interior nodes, and $\\mathcal{L}$ is the spatial operator representing the right-hand side. The boundary condition $C(0,t)=1$ is enforced by setting $C_0(t)=1$ for all time, including within the intermediate stages of the time-stepping algorithms.\n\nThe initial condition for the discrete system is derived from the continuous initial condition $C(x,0)$. For each internal node $x_i$ ($i \\ge 1$), $C_i(0)=1$ if $x_i  x_f$ and $C_i(0)=0$ if $x_i \\ge x_f$. With $N=400$ and $x_f=0.2$, this means $x_i = i/400  0.2 \\implies i  80$. Thus, $C_i(0)=1$ for $i \\in \\{1, \\ldots, 79\\}$ and $C_i(0)=0$ for $i \\in \\{80, \\ldots, 400\\}$.\n\nThe central task is to integrate this ODE system from $t=0$ to $t=T$ using two explicit Runge-Kutta methods. The time step $\\Delta t$ is determined by the Courant-Friedrichs-Lewy (CFL) number $\\nu$ via the relation $\\Delta t = \\nu \\frac{\\Delta x}{u}$. For the first-order upwind scheme, the forward Euler method is stable and preserves monotonicity (i.e., does not introduce new oscillations) for the pure advection equation if $\\nu \\le 1$.\n\nThe first integrator is the third-order, three-stage Strong Stability Preserving Runge-Kutta method (SSPRK(3,3)). SSP methods are designed to preserve the stability properties (like monotonicity) of the forward Euler step. An SSP integrator can be written as a convex combination of forward Euler steps. For a Courant number $\\nu$ where forward Euler is stable, the SSPRK method will also be stable in the same sense. The stages for SSPRK(3,3) are:\n\\begin{align*}\n\\boldsymbol{C}^{(1)} = \\boldsymbol{C}^n + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^n) \\\\\n\\boldsymbol{C}^{(2)} = \\frac{3}{4} \\boldsymbol{C}^n + \\frac{1}{4} \\left( \\boldsymbol{C}^{(1)} + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^{(1)}) \\right) \\\\\n\\boldsymbol{C}^{n+1} = \\frac{1}{3} \\boldsymbol{C}^n + \\frac{2}{3} \\left( \\boldsymbol{C}^{(2)} + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^{(2)}) \\right)\n\\end{align*}\n\nThe second integrator is the classical fourth-order, four-stage Runge-Kutta method (RK4), which is not an SSP method. While highly accurate for smooth problems, it is known to introduce spurious oscillations near sharp gradients or discontinuities, even with time steps that are stable in the energy sense. Its stages are:\n\\begin{align*}\n\\boldsymbol{k}_1 = \\mathcal{L}(\\boldsymbol{C}^n) \\\\\n\\boldsymbol{k}_2 = \\mathcal{L}(\\boldsymbol{C}^n + \\frac{\\Delta t}{2} \\boldsymbol{k}_1) \\\\\n\\boldsymbol{k}_3 = \\mathcal{L}(\\boldsymbol{C}^n + \\frac{\\Delta t}{2} \\boldsymbol{k}_2) \\\\\n\\boldsymbol{k}_4 = \\mathcal{L}(\\boldsymbol{C}^n + \\Delta t \\, \\boldsymbol{k}_3) \\\\\n\\boldsymbol{C}^{n+1} = \\boldsymbol{C}^n + \\frac{\\Delta t}{6} (\\boldsymbol{k}_1 + 2\\boldsymbol{k}_2 + 2\\boldsymbol{k}_3 + \\boldsymbol{k}_4)\n\\end{align*}\n\nTo evaluate the performance of these integrators, two diagnostic measures are computed from the final numerical solution $\\boldsymbol{C}^n$ at time $T$. The first is the overshoot, $\\mathrm{OV}$, which quantifies the violation of the physical bounds $[0,1]$:\n$$\n\\mathrm{OV} = \\max\\left( \\max_i \\left( C_i^n - 1 \\right), \\, \\max_i \\left( - C_i^n \\right), \\, 0 \\right)\n$$\nAn ideal, non-oscillatory scheme should produce $\\mathrm{OV}=0$. The second is the change in total variation, $\\Delta \\mathrm{TV}$, which measures the creation of new oscillations. The total variation (TV) is defined as:\n$$\n\\mathrm{TV}(\\boldsymbol{C}) = \\sum_{i=1}^{N} \\left| C_i - C_{i-1} \\right|\n$$\nwhere $C_0$ is the boundary value. A non-oscillatory (or monotone) scheme for a scalar conservation law ensures that $\\mathrm{TV}(\\boldsymbol{C}^{n+1}) \\le \\mathrm{TV}(\\boldsymbol{C}^n)$, meaning $\\Delta \\mathrm{TV} \\le 0$ over the full integration. The analysis requires computing $\\Delta \\mathrm{TV} = \\mathrm{TV}(\\boldsymbol{C}^n) - \\mathrm{TV}(\\boldsymbol{C}^0)$. The initial total variation for the sharp front is $\\mathrm{TV}(\\boldsymbol{C}^0) = |C^0_1 - C_0| + \\sum_{i=2}^{N} |C_i^0-C_{i-1}^0| = |1-1| + |C^0_{80}-C^0_{79}| = |0-1| = 1$.\n\nThe implementation will proceed by setting up the initial state vector, defining a function for the spatial operator $\\mathcal{L}$, and then, for each test case $\\nu \\in \\{0.9, 1.0, 1.2\\}$, stepping the solution forward in time using both SSPRK(3,3) and RK4. After reaching the final time $T=0.2$, the diagnostics $\\mathrm{OV}$ and $\\Delta \\mathrm{TV}$ will be calculated for each method and reported.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the advection-reaction problem using SSPRK(3,3) and RK4 methods\n    and computes stability diagnostics.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    u = 1.0        # Advection speed\n    k = 25.0       # Reaction rate coefficient\n    N = 400        # Number of spatial intervals\n    T = 0.2        # Final time\n    x_f = 0.2      # Initial front position\n    C0 = 1.0       # Inflow boundary condition C(0, t)\n\n    dx = 1.0 / N\n    x_nodes = np.linspace(0, 1, N + 1)\n    \n    # --- Test Cases ---\n    test_cases = [0.9, 1.0, 1.2]\n    \n    all_results = []\n\n    # --- Right-Hand Side (RHS) Function ---\n    def rhs(C, u_param, k_param, dx_param, C0_param):\n        \"\"\"Computes the semi-discrete spatial operator L(C).\"\"\"\n        # C is the vector of interior nodes [C_1, ..., C_N]\n        C_padded = np.concatenate(([C0_param], C))\n        C_left = C_padded[:-1]\n        \n        advection = -u_param / dx_param * (C - C_left)\n        reaction = k_param * C * (1.0 - C)\n        \n        return advection + reaction\n\n    # --- Diagnostics Calculation Function ---\n    def calculate_diagnostics(C_final, TV0, C0_param):\n        \"\"\"Computes overshoot (OV) and total variation change (dTV).\"\"\"\n        # Overshoot\n        overshoot_pos = np.max(C_final - 1.0)\n        overshoot_neg = np.max(-C_final)\n        ov = np.max([overshoot_pos, overshoot_neg, 0.0])\n        \n        # Total Variation\n        C_padded_final = np.concatenate(([C0_param], C_final))\n        tv_final = np.sum(np.abs(np.diff(C_padded_final)))\n        dtv = tv_final - TV0\n        \n        return ov, dtv\n\n    # --- Main Loop over Test Cases ---\n    for nu in test_cases:\n        dt = nu * dx / u\n        num_steps = int(np.ceil(T / dt))\n\n        # --- Initial Condition ---\n        C_initial = np.zeros(N)\n        # Using x_nodes[1:] for interior nodes x_1, ..., x_N\n        C_initial[x_nodes[1:]  x_f] = 1.0\n        \n        # Calculate initial Total Variation (TV0)\n        C_padded_initial = np.concatenate(([C0], C_initial))\n        TV0 = np.sum(np.abs(np.diff(C_padded_initial)))\n\n        # --- SSPRK(3,3) Integration ---\n        C_ssp = C_initial.copy()\n        for _ in range(num_steps):\n            # Stage 1\n            L_C = rhs(C_ssp, u, k, dx, C0)\n            C1 = C_ssp + dt * L_C\n            # Stage 2\n            L_C1 = rhs(C1, u, k, dx, C0)\n            C2 = 0.75 * C_ssp + 0.25 * (C1 + dt * L_C1)\n            # Stage 3\n            L_C2 = rhs(C2, u, k, dx, C0)\n            C_ssp = (1.0/3.0) * C_ssp + (2.0/3.0) * (C2 + dt * L_C2)\n\n        ov_ssp, dtv_ssp = calculate_diagnostics(C_ssp, TV0, C0)\n\n        # --- RK4 Integration ---\n        C_rk4 = C_initial.copy()\n        for _ in range(num_steps):\n            k1 = rhs(C_rk4, u, k, dx, C0)\n            k2 = rhs(C_rk4 + 0.5 * dt * k1, u, k, dx, C0)\n            k3 = rhs(C_rk4 + 0.5 * dt * k2, u, k, dx, C0)\n            k4 = rhs(C_rk4 + dt * k3, u, k, dx, C0)\n            C_rk4 += (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\n        ov_rk4, dtv_rk4 = calculate_diagnostics(C_rk4, TV0, C0)\n        \n        all_results.extend([nu, ov_ssp, ov_rk4, dtv_ssp, dtv_rk4])\n\n    print(f\"[{','.join(f'{val:.12g}' for val in all_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}