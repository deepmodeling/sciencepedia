{
    "hands_on_practices": [
        {
            "introduction": "Geochemical models rely on a set of \"basis\" or \"master\" species to define a system's chemical state. This practice exercise focuses on the fundamental algebraic technique of basis pivoting, where you will manually change the basis for the aqueous carbonate system . Understanding how to transform the governing chemical reactions and their equilibrium constants when the basis is changed is a core skill for interpreting and manipulating geochemical models.",
            "id": "4073620",
            "problem": "Consider an aqueous carbonate system at temperature $T=25\\,^{\\circ}\\mathrm{C}$ and sufficiently low ionic strength such that activity coefficients are approximately unity. The initial primary basis set for the aqueous speciation model is $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$, and the initial secondary species of interest are $\\{\\mathrm{HCO_3^-},\\,\\mathrm{CO_3^{2-}}\\}$. Equilibrium constants are defined by the law of mass action using activities. The carbonic acid dissociation reactions are defined as\n$$\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-},\\quad K_1,$$\n$$\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}},\\quad K_2,$$\nwith $pK_1=6.35$ and $pK_2=10.33$, where $pK_i=-\\log_{10}(K_i)$.\n\nUsing only the law of mass action and reaction algebra (including the rules that reversing a reaction inverts its equilibrium constant and adding reactions multiplies their equilibrium constants), perform a basis pivot that replaces $\\mathrm{CO_2(aq)}$ with $\\mathrm{HCO_3^-}$ to obtain the new primary basis set $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$. Write the new formation reactions for the remaining carbonate aqueous species $\\mathrm{CO_2(aq)}$ and $\\mathrm{CO_3^{2-}}$ explicitly in terms of the new basis, and express their new formation equilibrium constants symbolically in terms of $K_1$ and $K_2$.\n\nFinally, compute the numerical value of the new formation equilibrium constant for $\\mathrm{CO_3^{2-}}$ under this pivot, denoted $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$, at $25\\,^{\\circ}\\mathrm{C}$. Round your answer to four significant figures. Express the final equilibrium constant as a unitless number.",
            "solution": "The user wants me to critically validate the problem statement.\n\n### Step 1: Extract Givens\n- **System:** Aqueous carbonate system.\n- **Conditions:** Temperature $T=25\\,^{\\circ}\\mathrm{C}$, low ionic strength, activity coefficients are approximately unity.\n- **Initial Primary Basis Set:** $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$.\n- **Initial Secondary Species:** $\\{\\mathrm{HCO_3^-},\\,\\mathrm{CO_3^{2-}}\\}$.\n- **Reactions and Equilibrium Constants:**\n  1. $\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-}$, with equilibrium constant $K_1$.\n  2. $\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}}$, with equilibrium constant $K_2$.\n- **Given Values:** $pK_1 = -\\log_{10}(K_1) = 6.35$ and $pK_2 = -\\log_{10}(K_2) = 10.33$.\n- **Task:**\n  1. Perform a basis pivot to obtain the new primary basis set $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$.\n  2. Write the new formation reactions for the species $\\mathrm{CO_2(aq)}$ and $\\mathrm{CO_3^{2-}}$ in terms of the new basis.\n  3. Express the new formation equilibrium constants symbolically in terms of $K_1$ and $K_2$.\n  4. Compute the numerical value of the new formation equilibrium constant for $\\mathrm{CO_3^{2-}}$, denoted $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding:** The problem is firmly grounded in the principles of aqueous geochemistry and chemical equilibrium. The carbonate system is a fundamental topic, and the concept of basis pivoting is a standard and essential technique in computational geochemistry software (e.g., PHREEQC, Geochemist's Workbench). The provided $pK_a$ values are standard textbook values for the specified temperature.\n- **Well-Posedness:** The problem is well-posed. It provides all necessary information and clear instructions to perform the algebraic manipulation of chemical reactions and their equilibrium constants. The goal is specific, and a unique, stable solution exists.\n- **Objectivity:** The problem is stated in precise, objective, and unbiased scientific language. There are no subjective or opinion-based statements.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is scientifically sound, well-posed, objective, and contains all necessary information for a complete solution. I will proceed to solve it.\n\nThe initial state of the system is defined by the primary basis set $B_0 = \\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$. The secondary aqueous species are formed from reactions involving only these basis species. The problem provides the standard dissociation reactions for carbonic acid:\n$$\n\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-} \\quad (R_1)\n$$\nwith equilibrium constant $K_1$, and\n$$\n\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}} \\quad (R_2)\n$$\nwith equilibrium constant $K_2$.\n\nThe law of mass action for these reactions, assuming unit activity for water ($a_{\\mathrm{H_2O}}=1$) and for other species activities equal to their molal concentrations, states:\n$$\nK_1 = \\frac{a_{\\mathrm{H^+}} a_{\\mathrm{HCO_3^-}}}{a_{\\mathrm{CO_2(aq)}}}\n$$\n$$\nK_2 = \\frac{a_{\\mathrm{H^+}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{HCO_3^-}}}\n$$\nThe task is to perform a basis pivot, replacing $\\mathrm{CO_2(aq)}$ with $\\mathrm{HCO_3^-}$. The new primary basis set is $B_1 = \\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$. The species that were part of the old basis or were secondary species, and are not in the new basis, become the new set of secondary species. In this case, the new secondary species are $\\{\\mathrm{CO_2(aq)},\\,\\mathrm{CO_3^{2-}}\\}$.\n\nWe must now write the formation reactions for these new secondary species explicitly in terms of the new basis components $B_1$, and determine their corresponding equilibrium constants.\n\n**1. Formation of $\\mathrm{CO_2(aq)}$ in the new basis:**\nWe need to find a reaction that forms $\\mathrm{CO_2(aq)}$ from the species in $B_1$. We can use reaction $(R_1)$ and algebraically rearrange it to isolate $\\mathrm{CO_2(aq)}$. The initial reaction is:\n$$\n\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-}\n$$\nReversing this reaction gives the formation reaction for $\\mathrm{CO_2(aq)}$ from the new basis components $\\mathrm{H^+}$ and $\\mathrm{HCO_3^-}$. The species $\\mathrm{H_2O}$ is also a basis component.\n$$\n\\mathrm{H^+} + \\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{CO_2(aq)} + \\mathrm{H_2O}\n$$\nAccording to the rules of reaction algebra, reversing a reaction inverts its equilibrium constant. Therefore, the new formation constant for $\\mathrm{CO_2(aq)}$, denoted $K_{f,\\mathrm{new}}(\\mathrm{CO_2(aq)})$, is:\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_2(aq)}) = \\frac{1}{K_1}\n$$\n\n**2. Formation of $\\mathrm{CO_3^{2-}}$ in the new basis:**\nNext, we derive the formation reaction for $\\mathrm{CO_3^{2-}}$ from the new basis $B_1$. We can use reaction $(R_2)$:\n$$\n\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}\n$$\nIn this reaction, the reactant $\\mathrm{HCO_3^-}$ is a component of the new basis $B_1$. The products are the secondary species $\\mathrm{CO_3^{2-}}$ and another basis component, $\\mathrm{H^+}$. This reaction already expresses the formation of $\\mathrm{CO_3^{2-}}$ in terms of the new basis. Therefore, this is the required formation reaction. The equilibrium constant for this reaction is given as $K_2$. So, the new formation constant for $\\mathrm{CO_3^{2-}}$ is:\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) = K_2\n$$\n\n**3. Numerical Calculation:**\nThe problem asks for the numerical value of $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$. We have established that $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) = K_2$. We are given $pK_2 = 10.33$.\nBy definition, $pK_2 = -\\log_{10}(K_2)$. Thus, we can calculate $K_2$:\n$$\nK_2 = 10^{-pK_2} = 10^{-10.33}\n$$\nCalculating the numerical value:\n$$\nK_2 = 10^{-10.33} = 10^{0.67} \\times 10^{-11} \\approx 4.67735 \\times 10^{-11}\n$$\nRounding to four significant figures, as requested:\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) \\approx 4.677 \\times 10^{-11}\n$$\nThis quantity is dimensionless as it is an equilibrium constant based on activities.",
            "answer": "$$\n\\boxed{4.677 \\times 10^{-11}}\n$$"
        },
        {
            "introduction": "While the selection of a basis is a critical step in formulating a geochemical problem, the final equilibrium state must be independent of this choice. This hands-on exercise is designed to computationally verify the principle of basis invariance by calculating the full aqueous speciation for a complex system using two different basesâ€”one built from the fully protonated acids and another from the fully deprotonated bases . Successfully completing this will build your confidence that the choice of components is a mathematical tool, not a physical constraint on the outcome.",
            "id": "4073635",
            "problem": "You are to implement a computational test of component and basis selection invariance for acid-base speciation in geochemical modeling under the assumption of ideal solution behavior. The system models three independent acid families: inorganic carbon, boron, and phosphate. You will compute species concentrations at fixed potential of hydrogen (pH), using two different selections of independent components (two bases), and verify that observable quantities are invariant to this choice.\n\nThe fundamental laws and core definitions to be used are:\n\n- Law of Mass Action: For any chemical equilibrium written as $a A + b B \\rightleftharpoons c C + d D$, at constant temperature, the equilibrium constant $K$ satisfies $K = \\frac{a_C^c a_D^d}{a_A^a a_B^b}$ and is a function of temperature. In ideal solutions, activities equal molar concentrations.\n\n- Mass Balance: For a set of species derived from a single element pool, the total concentration equals the sum of constituent species concentrations.\n\n- Definitions of stepwise acid dissociation constants in water (ideal solution) at standard temperature: For a polyprotic acid $H_nA$, the stepwise dissociation constants are $K_1, K_2, \\dots, K_n$, with $K_i = \\frac{[H^+][H_{n-i}A^{i-}]}{[H_{n-(i-1)}A^{(i-1)-}]}$.\n\nAssume ideal solution conditions (activity coefficients equal to $1$) at standard temperature. Use the following dissociation constants at $25\\,^\\circ\\mathrm{C}$:\n\n- Carbonate system (two-step acid): $K_1^\\mathrm{carb} = 10^{-6.35}$, $K_2^\\mathrm{carb} = 10^{-10.33}$.\n- Borate system (single-step acid viewed as $B(OH)_3 \\rightleftharpoons B(OH)_4^- + H^+$): $K^\\mathrm{bor} = 10^{-9.24}$.\n- Phosphate system (three-step acid): $K_1^\\mathrm{phos} = 10^{-2.15}$, $K_2^\\mathrm{phos} = 10^{-7.20}$, $K_3^\\mathrm{phos} = 10^{-12.35}$.\n- Water autoprotolysis: $K_w = 10^{-14.00}$.\n\nDefine the following:\n\n- For inorganic carbon, the species are $H_2CO_3^*$ (collective of dissolved carbon dioxide and carbonic acid), $HCO_3^-$, and $CO_3^{2-}$, and the total inorganic carbon $C_T = [H_2CO_3^*] + [HCO_3^-] + [CO_3^{2-}]$.\n\n- For boron, the species are $B(OH)_3$ and $B(OH)_4^-$, and the total boron $B_T = [B(OH)_3] + [B(OH)_4^-]$.\n\n- For phosphate, the species are $H_3PO_4$, $H_2PO_4^-$, $HPO_4^{2-}$, $PO_4^{3-}$, and the total phosphate $P_T = [H_3PO_4] + [H_2PO_4^-] + [HPO_4^{2-}] + [PO_4^{3-}]$.\n\nThe two component bases to be tested are:\n\n- Basis A (acid components): $\\{H_2CO_3^*, B(OH)_3, H_3PO_4\\}$.\n- Basis B (base components): $\\{CO_3^{2-}, B(OH)_4^{-}, PO_4^{3-}\\}$.\n\nAt fixed potential of hydrogen (pH), the hydrogen ion concentration is $[H^+] = H = 10^{-\\mathrm{pH}}$. Under ideal solution behavior, the species distributions for each acid family must be consistent across both bases due to the Law of Mass Action and Mass Balance. You must compute speciation using both bases independently and verify that observable quantities (species concentrations and the sum of charge equivalents contributed by these acid families) are invariant to the choice of basis.\n\nStarting from the Law of Mass Action and Mass Balance, derive algorithmic expressions to compute, for a given $H$ and totals $C_T$, $B_T$, $P_T$, the species concentrations for both bases:\n\n- For Basis A (acid components), express the fractional distributions $\\alpha_i$ for each acid family in terms of $H$ and the appropriate $K_i$, and compute species concentrations by multiplying these fractions with the respective totals.\n\n- For Basis B (base components), express the fractional distributions in terms of cumulative protonation of the base forms with $H$ and $K_i$ for the reverse reactions, and compute species concentrations accordingly.\n\nDefine the observable charge equivalents contributed by these families as\n$$Q = [HCO_3^-] + 2[CO_3^{2-}] + [B(OH)_4^-] + [H_2PO_4^-] + 2[HPO_4^{2-}] + 3[PO_4^{3-}]$$\nand verify that $Q$ computed from Basis A and Basis B are equal within a specified numerical tolerance.\n\nYour program must:\n\n1. For each test case, compute species concentrations using Basis A and Basis B independently from first principles, as derived above.\n\n2. Compare corresponding species concentrations across bases, compute the maximum absolute deviation across all species and the absolute deviation in $Q$, and declare the test case invariant if both deviations are less than or equal to $\\tau = 10^{-12}\\,\\mathrm{mol/L}$.\n\n3. Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is a boolean indicating whether invariance is verified for that test case (e.g., $[True,False,True]$).\n\nUnits: All concentrations must be computed and compared in $\\mathrm{mol/L}$, and angles are not applicable. Booleans have no units.\n\nTest Suite (provide these test cases exactly):\n\n- Case $1$: $\\mathrm{pH} = 8.30$, $C_T = 2.000\\times 10^{-3}\\,\\mathrm{mol/L}$, $B_T = 4.700\\times 10^{-4}\\,\\mathrm{mol/L}$, $P_T = 2.000\\times 10^{-6}\\,\\mathrm{mol/L}$.\n- Case $2$: $\\mathrm{pH} = 5.50$, $C_T = 1.000\\times 10^{-3}\\,\\mathrm{mol/L}$, $B_T = 1.000\\times 10^{-4}\\,\\mathrm{mol/L}$, $P_T = 1.000\\times 10^{-6}\\,\\mathrm{mol/L}$.\n- Case $3$: $\\mathrm{pH} = 12.00$, $C_T = 1.000\\times 10^{-3}\\,\\mathrm{mol/L}$, $B_T = 4.000\\times 10^{-4}\\,\\mathrm{mol/L}$, $P_T = 1.000\\times 10^{-6}\\,\\mathrm{mol/L}$.\n- Case $4$: $\\mathrm{pH} = 7.00$, $C_T = 1.500\\times 10^{-3}\\,\\mathrm{mol/L}$, $B_T = 3.000\\times 10^{-4}\\,\\mathrm{mol/L}$, $P_T = 0\\,\\mathrm{mol/L}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[True,True,True,True]$). No other text should be printed.",
            "solution": "The problem statement is scientifically sound, self-contained, and well-posed. It presents a standard exercise in computational aqueous geochemistry: demonstrating the invariance of a system's calculated equilibrium state with respect to the choice of basis components. All necessary constants, definitions, and constraints are provided, and they are consistent with established chemical principles. The problem is valid.\n\nThe solution proceeds by deriving the expressions for the concentrations of all aqueous species from first principles for two different sets of basis components: Basis A (fully protonated acids) and Basis B (fully deprotonated bases). The hydrogen ion concentration, $[H^+]$, is fixed and denoted by $H = 10^{-\\text{pH}}$. All calculations assume ideal solution behavior where activities are equal to molar concentrations.\n\nThe given dissociation constants are:\n- Carbonate system: $K_1^\\mathrm{carb} = 10^{-6.35}$, $K_2^\\mathrm{carb} = 10^{-10.33}$\n- Borate system: $K^\\mathrm{bor} = 10^{-9.24}$\n- Phosphate system: $K_1^\\mathrm{phos} = 10^{-2.15}$, $K_2^\\mathrm{phos} = 10^{-7.20}$, $K_3^\\mathrm{phos} = 10^{-12.35}$\n\n**1. Derivation for Basis A: Acid Components $\\{H_2CO_3^*, B(OH)_3, H_3PO_4\\}$**\n\nFor each acid family, we express the concentration of each species in terms of the fully protonated acid component, $[H^+]$, and the relevant equilibrium constants. The sum of these species must equal the total concentration ($C_T$, $B_T$, or $P_T$), which allows for the calculation of fractional abundances ($\\alpha_i$).\n\n**Carbonate System ($C_T = [H_2CO_3^*] + [HCO_3^-] + [CO_3^{2-}]$)**\nThe dissociation equilibria are:\n$H_2CO_3^* \\rightleftharpoons H^+ + HCO_3^- \\implies K_1^\\mathrm{carb} = \\frac{H[HCO_3^-]}{[H_2CO_3^*]}$\n$HCO_3^- \\rightleftharpoons H^+ + CO_3^{2-} \\implies K_2^\\mathrm{carb} = \\frac{H[CO_3^{2-}]}{[HCO_3^-]}$\nFrom these, we express $[HCO_3^-]$ and $[CO_3^{2-}]$ in terms of $[H_2CO_3^*]$:\n$[HCO_3^-] = \\frac{K_1^\\mathrm{carb}}{H}[H_2CO_3^*]$\n$[CO_3^{2-}] = \\frac{K_2^\\mathrm{carb}}{H}[HCO_3^-] = \\frac{K_1^\\mathrm{carb} K_2^\\mathrm{carb}}{H^2}[H_2CO_3^*]$\nThe mass balance equation is $C_T = [H_2CO_3^*]\\left(1 + \\frac{K_1^\\mathrm{carb}}{H} + \\frac{K_1^\\mathrm{carb} K_2^\\mathrm{carb}}{H^2}\\right)$.\nLet the denominator be $D_{carb} = H^2 + K_1^\\mathrm{carb}H + K_1^\\mathrm{carb}K_2^\\mathrm{carb}$. The fractional abundances are:\n$\\alpha_0^\\mathrm{carb} = \\frac{[H_2CO_3^*]}{C_T} = \\frac{H^2}{D_{carb}}$\n$\\alpha_1^\\mathrm{carb} = \\frac{[HCO_3^-]}{C_T} = \\frac{K_1^\\mathrm{carb}H}{D_{carb}}$\n$\\alpha_2^\\mathrm{carb} = \\frac{[CO_3^{2-}]}{C_T} = \\frac{K_1^\\mathrm{carb}K_2^\\mathrm{carb}}{D_{carb}}$\nThe concentrations are found by multiplying each $\\alpha_i$ by $C_T$.\n\n**Borate System ($B_T = [B(OH)_3] + [B(OH)_4^-]$)**\nThe equilibrium is $B(OH)_3 + H_2O \\rightleftharpoons H^+ + B(OH)_4^- \\implies K^\\mathrm{bor} = \\frac{H[B(OH)_4^-]}{[B(OH)_3]}$.\nFrom this, $[B(OH)_4^-] = \\frac{K^\\mathrm{bor}}{H}[B(OH)_3]$.\nThe mass balance is $B_T = [B(OH)_3]\\left(1 + \\frac{K^\\mathrm{bor}}{H}\\right)$.\nLet the denominator be $D_{bor} = H + K^\\mathrm{bor}$. The fractional abundances are:\n$\\alpha_0^\\mathrm{bor} = \\frac{[B(OH)_3]}{B_T} = \\frac{H}{D_{bor}}$\n$\\alpha_1^\\mathrm{bor} = \\frac{[B(OH)_4^-]}{B_T} = \\frac{K^\\mathrm{bor}}{D_{bor}}$\nThe concentrations are found by multiplying each $\\alpha_i$ by $B_T$.\n\n**Phosphate System ($P_T = [H_3PO_4] + [H_2PO_4^-] + [HPO_4^{2-}] + [PO_4^{3-}]$)**\nFollowing a similar procedure for the three dissociation steps:\n$H_3PO_4 \\rightleftharpoons H^+ + H_2PO_4^- \\quad (K_1^\\mathrm{phos})$\n$H_2PO_4^- \\rightleftharpoons H^+ + HPO_4^{2-} \\quad (K_2^\\mathrm{phos})$\n$HPO_4^{2-} \\rightleftharpoons H^+ + PO_4^{3-} \\quad (K_3^\\mathrm{phos})$\nLet the denominator be $D_{phos} = H^3 + K_1^\\mathrm{phos}H^2 + K_1^\\mathrm{phos}K_2^\\mathrm{phos}H + K_1^\\mathrm{phos}K_2^\\mathrm{phos}K_3^\\mathrm{phos}$. The fractional abundances are:\n$\\alpha_0^\\mathrm{phos} = \\frac{[H_3PO_4]}{P_T} = \\frac{H^3}{D_{phos}}$\n$\\alpha_1^\\mathrm{phos} = \\frac{[H_2PO_4^-]}{P_T} = \\frac{K_1^\\mathrm{phos}H^2}{D_{phos}}$\n$\\alpha_2^\\mathrm{phos} = \\frac{[HPO_4^{2-}]}{P_T} = \\frac{K_1^\\mathrm{phos}K_2^\\mathrm{phos}H}{D_{phos}}$\n$\\alpha_3^\\mathrm{phos} = \\frac{[PO_4^{3-}]}{P_T} = \\frac{K_1^\\mathrm{phos}K_2^\\mathrm{phos}K_3^\\mathrm{phos}}{D_{phos}}$\nThe concentrations are found by multiplying each $\\alpha_i$ by $P_T$.\n\n**2. Derivation for Basis B: Base Components $\\{CO_3^{2-}, B(OH)_4^{-}, PO_4^{3-}\\}$**\n\nHere, we express the concentration of each species in terms of the fully deprotonated base component. This involves considering the reverse (protonation) reactions.\n\n**Carbonate System**\nThe protonation equilibria are:\n$CO_3^{2-} + H^+ \\rightleftharpoons HCO_3^- \\implies K_{p1} = \\frac{[HCO_3^-]}{H[CO_3^{2-}]} = \\frac{1}{K_2^\\mathrm{carb}}$\n$HCO_3^- + H^+ \\rightleftharpoons H_2CO_3^* \\implies K_{p2} = \\frac{[H_2CO_3^*]}{H[HCO_3^-]} = \\frac{1}{K_1^\\mathrm{carb}}$\nExpressing species in terms of $[CO_3^{2-}]$:\n$[HCO_3^-] = \\frac{H}{K_2^\\mathrm{carb}}[CO_3^{2-}]$\n$[H_2CO_3^*] = \\frac{H}{K_1^\\mathrm{carb}}[HCO_3^-] = \\frac{H^2}{K_1^\\mathrm{carb}K_2^\\mathrm{carb}}[CO_3^{2-}]$\nThe mass balance equation is $C_T = [CO_3^{2-}]\\left(1 + \\frac{H}{K_2^\\mathrm{carb}} + \\frac{H^2}{K_1^\\mathrm{carb}K_2^\\mathrm{carb}}\\right)$.\nThe fractional abundance of $[CO_3^{2-}]$ is:\n$\\beta_2^\\mathrm{carb} = \\frac{[CO_3^{2-}]}{C_T} = \\frac{1}{1 + \\frac{H}{K_2^\\mathrm{carb}} + \\frac{H^2}{K_1^\\mathrm{carb}K_2^\\mathrm{carb}}} = \\frac{K_1^\\mathrm{carb}K_2^\\mathrm{carb}}{K_1^\\mathrm{carb}K_2^\\mathrm{carb} + K_1^\\mathrm{carb}H + H^2} = \\alpha_2^\\mathrm{carb}$\nBy substituting this back, we find that the expressions for the other fractional abundances, $\\beta_1^\\mathrm{carb}$ and $\\beta_0^\\mathrm{carb}$, are identical to $\\alpha_1^\\mathrm{carb}$ and $\\alpha_0^\\mathrm{carb}$, respectively.\n\nThis algebraic identity holds for all three systems. The choice of basis components is a mathematical convenience for setting up the problem; it does not alter the physical reality of the equilibrium state. The final speciation is independent of the basis choice.\n\n**3. Computational Verification**\n\nThe algorithm will implement the two approaches separately.\n- **Basis A Calculation**: Uses the formulas with denominators like $D = H^n + K_1H^{n-1} + \\dots + K_1 \\dots K_n$.\n- **Basis B Calculation**: Uses the formulas derived from the protonation sequence. For example, for the carbonate system, it calculates $[CO_3^{2-}]$ first using $C_T / (1 + H/K_2^\\mathrm{carb} + H^2/(K_1^\\mathrm{carb}K_2^\\mathrm{carb}))$ and then finds the other species concentrations from it: $[HCO_3^-] = [CO_3^{2-}] \\times H/K_2^\\mathrm{carb}$, and so on.\n\nWhile algebraically equivalent, these two evaluation paths involve different sequences of floating-point operations. The problem requires verifying that they produce the same numerical results within a specified tolerance, $\\tau = 10^{-12}\\,\\mathrm{mol/L}$.\n\nThe quantities to be compared are the concentrations of all $9$ species:\n$[H_2CO_3^*], [HCO_3^-], [CO_3^{2-}]$,\n$[B(OH)_3], [B(OH)_4^-]$,\n$[H_3PO_4], [H_2PO_4^-], [HPO_4^{2-}], [PO_4^{3-}]$.\n\nAdditionally, the derived quantity for charge equivalence, $Q$, must be compared:\n$$Q = [HCO_3^-] + 2[CO_3^{2-}] + [B(OH)_4^-] + [H_2PO_4^-] + 2[HPO_4^{2-}] + 3[PO_4^{3-}]$$\nInvariance is confirmed if the maximum absolute deviation across all $9$ species concentrations and the absolute deviation in $Q$ are both less than or equal to $\\tau$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the component and basis selection invariance test.\n    \"\"\"\n    \n    # Dissociation constants at 25 C\n    K_CARB = (10**-6.35, 10**-10.33)\n    K_BOR = (10**-9.24,)\n    K_PHOS = (10**-2.15, 10**-7.20, 10**-12.35)\n    \n    # Numerical tolerance for comparison\n    TOLERANCE = 1e-12\n\n    def calculate_speciation(pH, C_T, B_T, P_T, basis):\n        \"\"\"\n        Calculates species concentrations for the carbonate, borate, and phosphate systems\n        using either Basis A (acid components) or Basis B (base components).\n\n        Args:\n            pH (float): The potential of hydrogen.\n            C_T (float): Total inorganic carbon concentration (mol/L).\n            B_T (float): Total boron concentration (mol/L).\n            P_T (float): Total phosphate concentration (mol/L).\n            basis (str): 'A' for acid basis, 'B' for base basis.\n\n        Returns:\n            list: A list of 9 species concentrations in mol/L, in a fixed order.\n        \"\"\"\n        H = 10**-pH\n        \n        species = [0.0] * 9\n        # Order: [H2CO3, HCO3, CO3], [B(OH)3, B(OH)4], [H3PO4, H2PO4, HPO4, PO4]\n        \n        if basis == 'A':\n            # --- Basis A: Acid Components ---\n\n            # Carbonate system\n            if C_T > 0:\n                k1, k2 = K_CARB\n                denom = H**2 + k1*H + k1*k2\n                species[0] = C_T * (H**2) / denom\n                species[1] = C_T * (k1*H) / denom\n                species[2] = C_T * (k1*k2) / denom\n\n            # Borate system\n            if B_T > 0:\n                k1, = K_BOR\n                denom = H + k1\n                species[3] = B_T * H / denom\n                species[4] = B_T * k1 / denom\n\n            # Phosphate system\n            if P_T > 0:\n                k1, k2, k3 = K_PHOS\n                denom = H**3 + k1*H**2 + k1*k2*H + k1*k2*k3\n                species[5] = P_T * (H**3) / denom\n                species[6] = P_T * (k1*H**2) / denom\n                species[7] = P_T * (k1*k2*H) / denom\n                species[8] = P_T * (k1*k2*k3) / denom\n\n        elif basis == 'B':\n            # --- Basis B: Base Components ---\n            \n            # Carbonate system\n            if C_T > 0:\n                k1, k2 = K_CARB\n                denom = 1.0 + H/k2 + H**2/(k1*k2)\n                conc_co3 = C_T / denom\n                conc_hco3 = conc_co3 * H / k2\n                conc_h2co3 = conc_hco3 * H / k1\n                species[0] = conc_h2co3\n                species[1] = conc_hco3\n                species[2] = conc_co3\n\n            # Borate system\n            if B_T > 0:\n                k1, = K_BOR\n                denom = 1.0 + H/k1\n                conc_boh4 = B_T / denom\n                conc_boh3 = conc_boh4 * H / k1\n                species[3] = conc_boh3\n                species[4] = conc_boh4\n            \n            # Phosphate system\n            if P_T > 0:\n                k1, k2, k3 = K_PHOS\n                denom = 1.0 + H/k3 + H**2/(k2*k3) + H**3/(k1*k2*k3)\n                conc_po4 = P_T / denom\n                conc_hpo4 = conc_po4 * H / k3\n                conc_h2po4 = conc_hpo4 * H / k2\n                conc_h3po4 = conc_h2po4 * H / k1\n                species[5] = conc_h3po4\n                species[6] = conc_h2po4\n                species[7] = conc_hpo4\n                species[8] = conc_po4\n        \n        return species\n\n    def calculate_q(species):\n        \"\"\"Calculates the charge equivalent Q from a list of species.\"\"\"\n        # species[1]: HCO3-, species[2]: CO3--\n        # species[4]: B(OH)4-\n        # species[6]: H2PO4-, species[7]: HPO4--, species[8]: PO4---\n        q = (species[1] + 2*species[2] + \n             species[4] + \n             species[6] + 2*species[7] + 3*species[8])\n        return q\n\n    # Definition of test cases from the problem statement\n    test_cases = [\n        # (pH, C_T, B_T, P_T)\n        (8.30, 2.000e-3, 4.700e-4, 2.000e-6),\n        (5.50, 1.000e-3, 1.000e-4, 1.000e-6),\n        (12.00, 1.000e-3, 4.000e-4, 1.000e-6),\n        (7.00, 1.500e-3, 3.000e-4, 0.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        pH, C_T, B_T, P_T = case\n        \n        # Calculate speciation using both bases\n        species_A = calculate_speciation(pH, C_T, B_T, P_T, 'A')\n        species_B = calculate_speciation(pH, C_T, B_T, P_T, 'B')\n        \n        # Calculate charge equivalents\n        Q_A = calculate_q(species_A)\n        Q_B = calculate_q(species_B)\n\n        # Compute deviations\n        species_devs = [abs(a - b) for a, b in zip(species_A, species_B)]\n        max_species_dev = max(species_devs) if species_devs else 0.0\n        q_dev = abs(Q_A - Q_B)\n        \n        # Check for invariance\n        is_invariant = (max_species_dev = TOLERANCE) and (q_dev = TOLERANCE)\n        results.append(is_invariant)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A well-posed geochemical problem must simultaneously honor the conservation of mass for every component and the principle of electroneutrality. This exercise simulates a common modeling pitfall where a system is overconstrained, leading to a physical inconsistency that a solver detects as a non-zero residual . By calculating the mass and charge balance residuals for a system with a fixed pH, you will gain practical insight into how geochemical codes diagnose improperly formulated problems.",
            "id": "4073632",
            "problem": "Aqueous speciation models in computational geochemistry enforce both mass conservation and electroneutrality, and require a physically consistent choice of basis species. Consider an isothermal, isobaric closed aqueous system at $25\\,\\mathrm{^\\circ C}$ and $1\\,\\mathrm{bar}$ with ideal activities (activity coefficients equal to $1$), containing the aqueous species $\\mathrm{H^+}$, $\\mathrm{OH^-}$, $\\mathrm{Na^+}$, $\\mathrm{Cl^-}$, $\\mathrm{H_2CO_3^*}$, $\\mathrm{HCO_3^-}$, and $\\mathrm{CO_3^{2-}}$. The system is constrained by the following measured totals per kilogram of water: total sodium $T_{\\mathrm{Na}} = 1.0 \\times 10^{-2}\\,\\mathrm{mol\\,kg^{-1}}$, total chloride $T_{\\mathrm{Cl}} = 9.5 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$, and total inorganic carbon $T_{\\mathrm{C}} = 2.0 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$. A proposed basis selects $\\mathrm{H^+}$, $\\mathrm{Na^+}$, $\\mathrm{Cl^-}$, $\\mathrm{HCO_3^-}$, and $\\mathrm{H_2O}$ as primary master species, and it imposes a fixed acidity constraint $pH = 8.50$.\n\nTake the dissociation equilibria of carbonic acid to be governed by the mass action laws with equilibrium constants at $25\\,\\mathrm{^\\circ C}$ given by $K_1 = 10^{-6.3}$ for $\\mathrm{H_2CO_3^*} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{HCO_3^-}$ and $K_2 = 10^{-10.3}$ for $\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}$, and take water autoprotolysis to obey $K_{\\mathrm{w}} = 10^{-14} = [\\mathrm{H^+}][\\mathrm{OH^-}]$. Assume no other complexation occurs and all activities equal molalities.\n\nStarting from the fundamental laws of mass conservation and electroneutrality, and the mass action relations for the stated equilibria, compute the mass balance residuals $R_{\\mathrm{Na}}$, $R_{\\mathrm{Cl}}$, $R_{\\mathrm{C}}$ and the charge balance residual $R_{\\mathrm{charge}}$ under the proposed basis with the fixed $pH$. Use the definitions\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}],\\quad\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}],\\quad\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right),\n$$\nand\n$$\nR_{\\mathrm{charge}} = \\sum_i z_i[\\mathrm{i}] = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}],\n$$\nwhere $z_i$ is the electric charge of species $i$ and $[\\mathrm{i}]$ is its molal concentration. In a consistent and resolvable speciation calculation, all four residuals must be identically $0$; any nonzero $R_{\\mathrm{charge}}$ under fixed $pH$ manifests an inconsistency stemming from the basis and constraints.\n\nExpress the final residual vector $\\left(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}}\\right)$ in $\\mathrm{mol\\,kg^{-1}}$ (for mass residuals) and in $\\mathrm{mol\\,kg^{-1}}$ of charge (for the charge residual). Round your answer to four significant figures.",
            "solution": "The problem statement has been validated and is deemed scientifically sound, well-posed, objective, and complete. It presents a standard exercise in computational geochemistry, requiring the evaluation of mass and charge balance residuals for a proposed, but physically overconstrained, aqueous speciation model.\n\nThe objective is to compute the residual vector $(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}})$ for the given aqueous system under a fixed $pH$ constraint. The residuals are defined as:\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}]\n$$\n$$\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}]\n$$\n$$\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right)\n$$\n$$\nR_{\\mathrm{charge}} = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}]\n$$\nThe calculation proceeds by first determining the molal concentration of every aqueous species based on the given constraints and basis set, and then substituting these concentrations into the residual equations. The proposed basis of master species ($\\mathrm{H^+}$, $\\mathrm{Na^+}$, $\\mathrm{Cl^-}$, $\\mathrm{HCO_3^-}$) combined with the fixed $pH$ constraint dictates the computational path. In such a setup, mass balance equations are typically used to determine species concentrations, leaving the charge balance equation as a check for self-consistency.\n\nFirst, we establish the concentrations of species that are directly fixed by the problem's constraints. The fixed $pH$ of $8.50$ determines the hydrogen ion concentration:\n$$\npH = -\\log_{10}([\\mathrm{H^+}]) = 8.50 \\implies [\\mathrm{H^+}] = 10^{-8.50}\\,\\mathrm{mol\\,kg^{-1}}\n$$\nUsing the ion product of water, $K_{\\mathrm{w}} = 10^{-14}$, the hydroxide concentration is:\n$$\n[\\mathrm{OH^-}] = \\frac{K_{\\mathrm{w}}}{[\\mathrm{H^+}]} = \\frac{10^{-14}}{10^{-8.50}} = 10^{-5.50}\\,\\mathrm{mol\\,kg^{-1}}\n$$\nWith $\\mathrm{Na^+}$ and $\\mathrm{Cl^-}$ as the basis species for the sodium and chloride components, and in the absence of any other sodium or chloride species (complexes or solids), their concentrations are taken to be equal to their total concentrations to satisfy their respective mass balance equations:\n$$\n[\\mathrm{Na^+}] = T_{\\mathrm{Na}} = 1.0 \\times 10^{-2}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\n[\\mathrm{Cl^-}] = T_{\\mathrm{Cl}} = 9.5 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}\n$$\nBy this construction, the residuals for sodium and chloride are identically zero:\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}] = (1.0 \\times 10^{-2}) - (1.0 \\times 10^{-2}) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}] = (9.5 \\times 10^{-3}) - (9.5 \\times 10^{-3}) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\nNext, we determine the concentrations of the carbonate species. The secondary species $\\mathrm{H_2CO_3^*}$ and $\\mathrm{CO_3^{2-}}$ are related to the master species $\\mathrm{HCO_3^-}$ and $\\mathrm{H^+}$ through the mass action laws:\n$$\nK_1 = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{H_2CO_3^*}]} \\implies [\\mathrm{H_2CO_3^*}] = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{K_1}\n$$\n$$\nK_2 = \\frac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]} \\implies [\\mathrm{CO_3^{2-}}] = \\frac{K_2[\\mathrm{HCO_3^-}]}{[\\mathrm{H^+}]}\n$$\nThe concentration of the master species $\\mathrm{HCO_3^-}$ is found by satisfying the total carbon mass balance equation:\n$$\nT_{\\mathrm{C}} = [\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\n$$\nSubstituting the expressions for the secondary species:\n$$\nT_{\\mathrm{C}} = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{K_1} + [\\mathrm{HCO_3^-}] + \\frac{K_2[\\mathrm{HCO_3^-}]}{[\\mathrm{H^+}]} = [\\mathrm{HCO_3^-}]\\left(\\frac{[\\mathrm{H^+}]}{K_1} + 1 + \\frac{K_2}{[\\mathrm{H^+}]}\\right)\n$$\nWe solve for $[\\mathrm{HCO_3^-}]$:\n$$\n[\\mathrm{HCO_3^-}] = \\frac{T_{\\mathrm{C}}}{\\left(\\frac{[\\mathrm{H^+}]}{K_1} + 1 + \\frac{K_2}{[\\mathrm{H^+}]}\\right)}\n$$\nSubstituting the numerical values $T_{\\mathrm{C}} = 2.0 \\times 10^{-3}$, $[\\mathrm{H^+}] = 10^{-8.50}$, $K_1 = 10^{-6.3}$, and $K_2 = 10^{-10.3}$:\n$$\n[\\mathrm{HCO_3^-}] = \\frac{2.0 \\times 10^{-3}}{\\left(\\frac{10^{-8.50}}{10^{-6.3}} + 1 + \\frac{10^{-10.3}}{10^{-8.50}}\\right)} = \\frac{2.0 \\times 10^{-3}}{10^{-2.2} + 1 + 10^{-1.8}}\n$$\n$$\n[\\mathrm{HCO_3^-}] \\approx \\frac{2.0 \\times 10^{-3}}{0.0063096 + 1 + 0.015849} \\approx \\frac{2.0 \\times 10^{-3}}{1.0221586} \\approx 1.9566 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}\n$$\nNow we find the concentrations of the other carbonate species:\n$$\n[\\mathrm{H_2CO_3^*}] = [\\mathrm{HCO_3^-}]\\frac{10^{-8.50}}{10^{-6.3}} \\approx (1.9566 \\times 10^{-3})(10^{-2.2}) \\approx 1.235 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\n[\\mathrm{CO_3^{2-}}] = [\\mathrm{HCO_3^-}]\\frac{10^{-10.3}}{10^{-8.50}} \\approx (1.9566 \\times 10^{-3})(10^{-1.8}) \\approx 3.101 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}\n$$\nAs the concentrations of the carbon species were determined by enforcing the total carbon constraint, the carbon residual $R_{\\mathrm{C}}$ is also zero by construction:\n$$\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\nFinally, we compute the charge balance residual $R_{\\mathrm{charge}}$. Since the charge balance equation was not used to determine any of the concentrations, its residual will quantify the inconsistency of this overconstrained computational setup.\n$$\nR_{\\mathrm{charge}} = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}]\n$$\nSubstituting the calculated concentrations:\n$$\nR_{\\mathrm{charge}} \\approx (1.0 \\times 10^{-2}) + (10^{-8.50}) - (9.5 \\times 10^{-3}) - (1.9566 \\times 10^{-3}) - 2(3.101 \\times 10^{-5}) - (10^{-5.50})\n$$\n$$\nR_{\\mathrm{charge}} \\approx 0.01 + (3.162 \\times 10^{-9}) - 0.0095 - 0.0019566 - (6.202 \\times 10^{-5}) - (3.162 \\times 10^{-6})\n$$\nThe contribution from $[\\mathrm{H^+}]$ is negligible. Summing the terms:\n$$\nR_{\\mathrm{charge}} \\approx 0.01 - 0.0095 - 0.0019566 - 0.00006202 - 0.000003162\n$$\n$$\nR_{\\mathrm{charge}} \\approx 0.01 - 0.011521782 \\approx -0.001521782\\,\\mathrm{mol\\,kg^{-1}}\n$$\nRounding to four significant figures, the charge residual is $-1.522 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$.\n\nThe final residual vector $(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}})$ is therefore $(0, 0, 0, -1.522 \\times 10^{-3})$. The non-zero charge residual demonstrates that it is not possible to simultaneously satisfy all mass balance laws and the charge balance principle for this closed system when the $pH$ is externally fixed.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0  -1.522 \\times 10^{-3}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}