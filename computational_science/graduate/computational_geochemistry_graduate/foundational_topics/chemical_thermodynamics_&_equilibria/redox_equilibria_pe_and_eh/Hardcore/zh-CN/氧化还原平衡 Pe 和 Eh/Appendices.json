{
    "hands_on_practices": [
        {
            "introduction": "这项基础练习旨在建立一个重要的概念桥梁：从实测的物种浓度推算溶液的整体氧化还原电位 ($Eh$)。通过本练习 ，你将实践如何应用能斯特方程 (Nernst equation)，并掌握地球化学定量分析中的一项核心技能——计算活度系数以校正溶液的非理想行为。这项练习将为你理解和量化水体中的氧化还原过程奠定坚实的基础。",
            "id": "4098238",
            "problem": "酸性硫酸盐介质中的水溶液氧化还原形态受守恒关系和电化学平衡控制。考虑一个 $25\\,^{\\circ}\\mathrm{C}$ 的溶液，其离子强度 $I=0.10$（由惰性支持电解质维持），其中含有以 $\\mathrm{Fe^{2+}}$ 和 $\\mathrm{Fe^{3+}}$ 形式存在的铁，以及以硫酸盐物种 $\\mathrm{HSO_4^-}$ 和 $\\mathrm{SO_4^{2-}}$ 形式存在的硫，酸性由氢离子 $\\mathrm{H^+}$ 提供。总质量摩尔浓度分别为 $m_{\\mathrm{Fe,T}}=1.000\\times 10^{-3}$、$m_{\\mathrm{S,T}}=1.000\\times 10^{-2}$ 和 $m_{\\mathrm{H,T}}=1.000\\times 10^{-1}$，测得的铁氧化还原电对的质量摩尔浓度为 $m_{\\mathrm{Fe^{2+}}}=6.000\\times 10^{-4}$ 和 $m_{\\mathrm{Fe^{3+}}}=4.000\\times 10^{-4}$。假设在这些条件下，铁不与硫酸盐形成络合物，并且在给定的酸度下铁的水解可以忽略不计；硫仅以 $\\mathrm{HSO_4^-}$ 和 $\\mathrm{SO_4^{2-}}$ 的形式存在，其行为受硫酸的二级解离控制，热力学平衡常数 $K_{a2}=1.02\\times 10^{-2}$，该常数定义在质量摩尔浓度标度上，标准态为单位质量摩尔浓度。在 $25\\,^{\\circ}\\mathrm{C}$ 时，相对于标准氢电极，氧化还原电对 $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ 的标准电极电位为 $E^{\\circ}=0.771$。所有离子的活度系数均使用 Davies 方程进行估算，其中 $25\\,^{\\circ}\\mathrm{C}$ 时的 Debye–Hückel 常数 $A=0.509$。\n\n任务：\n1. 从物质守恒、电荷守恒和电子等效物守恒出发，写出总铁和总硫的质量平衡方程、溶液的电荷平衡方程，以及适用于 $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ 半反应的以活度和电子活度表示的电子平衡表达式。\n2. 使用所述的热力学框架和提供的数据，根据观测到的铁活度计算溶液的氧化还原电位 $E\\mathrm{h}$（氧化还原电位）。使用 Davies 方程在离子强度 $I=0.10$ 时获取 $\\mathrm{Fe^{2+}}$ 和 $\\mathrm{Fe^{3+}}$ 的活度系数，根据质量摩尔浓度和活度系数构建活度，然后在 $25\\,^{\\circ}\\mathrm{C}$ 时应用适当的电化学平衡关系。将最终数值结果四舍五入至四位有效数字，并以伏特为单位表示 $E\\mathrm{h}$。",
            "solution": "该问题经验证是自洽的、有科学依据且良定的。所有必要数据均已提供，所需任务可使用地球化学和电化学的标准原​​理完成。\n\n### 任务 1：守恒与平衡方程\n\n系统由一组守恒和平衡关系描述。\n\n**质量平衡方程**\n\n总铁（$m_{\\mathrm{Fe,T}}$）的守恒表示为所有含铁物种的质量摩尔浓度之和。鉴于铁仅以 $\\mathrm{Fe^{2+}}$ 和 $\\mathrm{Fe^{3+}}$ 的形式存在，铁的质量平衡方程为：\n$$m_{\\mathrm{Fe,T}} = m_{\\mathrm{Fe^{2+}}} + m_{\\mathrm{Fe^{3+}}}$$\n使用提供的数据，我们可以验证这一点：$1.000 \\times 10^{-3} = 6.000 \\times 10^{-4} + 4.000 \\times 10^{-4}$。\n\n类似地，总硫（$m_{\\mathrm{S,T}}$）的守恒是硫酸氢根（$\\mathrm{HSO_4^-}$）和硫酸根（$\\mathrm{SO_4^{2-}}$）的质量摩尔浓度之和：\n$$m_{\\mathrm{S,T}} = m_{\\mathrm{HSO_4^{-}}} + m_{\\mathrm{SO_4^{2-}}}$$\n\n**电荷平衡方程**\n\n电中性原理要求总正电荷浓度等于总负电荷浓度。贡献电荷的主要物种是 $\\mathrm{H^+}$、$\\mathrm{Fe^{2+}}$、$\\mathrm{Fe^{3+}}$、$\\mathrm{HSO_4^-}$ 和 $\\mathrm{SO_4^{2-}}$。此外，存在一种惰性支持电解质以维持离子强度，其贡献的离子必须包含在内以实现完整的电荷平衡。设惰性电解质的电荷贡献总和由 $\\sum z_j m_j$ 表示，则电荷平衡方程为：\n$$m_{\\mathrm{H^+}} + 2m_{\\mathrm{Fe^{2+}}} + 3m_{\\mathrm{Fe^{3+}}} = m_{\\mathrm{HSO_4^{-}}} + 2m_{\\mathrm{SO_4^{2-}}} - \\sum z_j m_j$$\n这可以改写为：\n$$\\sum z_i m_i = m_{\\mathrm{H^+}} + 2m_{\\mathrm{Fe^{2+}}} + 3m_{\\mathrm{Fe^{3+}}} - m_{\\mathrm{HSO_4^{-}}} - 2m_{\\mathrm{SO_4^{2-}}} + \\sum z_j m_j = 0$$\n其中最后的求和是对来自支持电解质的所有离子进行的。\n\n**电子平衡表达式**\n\n系统的氧化还原状态由 $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ 半反应的平衡控制：\n$$\\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}}$$\n该反应的质量作用定律给出了平衡表达式。问题要求用活度（$a_i$）和电子活度（$a_{e^-}$）来表示此表达式。平衡常数 $K_{\\mathrm{redox}}$ 由下式给出：\n$$K_{\\mathrm{redox}} = \\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}} a_{e^-}}$$\n该方程表示指定氧化还原电对在平衡时的电子平衡。\n\n### 任务 2：氧化还原电位（$E\\mathrm{h}$）的计算\n\n氧化还原电位 $E\\mathrm{h}$ 使用 Nernst 方程计算 $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ 电对。离子 $i$ 的活度 $a_i$ 是其质量摩尔浓度 $m_i$ 和其活度系数 $\\gamma_i$ 的乘积：$a_i = \\gamma_i m_i$。\n\n**步骤 1：计算活度系数**\n\n活度系数使用 Davies 方程估算：\n$$\\log_{10}(\\gamma_i) = -A z_i^2 \\left( \\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3 I \\right)$$\n给定值为 Debye–Hückel 常数 $A=0.509$ 和离子强度 $I=0.10$。\n首先，我们计算与离子强度相关的项：\n$$\\frac{\\sqrt{0.10}}{1+\\sqrt{0.10}} - 0.3(0.10) = \\frac{0.316228}{1+0.316228} - 0.03 = 0.24025 - 0.03 = 0.21025$$\n现在，我们计算 $\\mathrm{Fe^{2+}}$（电荷 $z=2$）的活度系数：\n$$\\log_{10}(\\gamma_{\\mathrm{Fe^{2+}}}) = -0.509 \\times (2)^2 \\times (0.21025) = -0.509 \\times 4 \\times 0.21025 = -0.42807$$\n$$\\gamma_{\\mathrm{Fe^{2+}}} = 10^{-0.42807} = 0.37319$$\n接下来，对于 $\\mathrm{Fe^{3+}}$（电荷 $z=3$）：\n$$\\log_{10}(\\gamma_{\\mathrm{Fe^{3+}}}) = -0.509 \\times (3)^2 \\times (0.21025) = -0.509 \\times 9 \\times 0.21025 = -0.96316$$\n$$\\gamma_{\\mathrm{Fe^{3+}}} = 10^{-0.96316} = 0.10885$$\n\n**步骤 2：计算活度**\n\n使用给定的质量摩尔浓度和计算出的活度系数：\n$$a_{\\mathrm{Fe^{2+}}} = \\gamma_{\\mathrm{Fe^{2+}}} \\times m_{\\mathrm{Fe^{2+}}} = 0.37319 \\times (6.000 \\times 10^{-4}) = 2.2391 \\times 10^{-4}$$\n$$a_{\\mathrm{Fe^{3+}}} = \\gamma_{\\mathrm{Fe^{3+}}} \\times m_{\\mathrm{Fe^{3+}}} = 0.10885 \\times (4.000 \\times 10^{-4}) = 4.3540 \\times 10^{-5}$$\n\n**步骤 3：使用 Nernst 方程计算 $E\\mathrm{h}$**\n\nNernst 方程将氧化还原电位 $E\\mathrm{h}$ 与标准电极电位 $E^{\\circ}$ 及氧化还原物种的活度联系起来。对于半反应 $\\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}}$，转移的电子数为 $n=1$：\n$$E\\mathrm{h} = E^{\\circ} + \\frac{2.303RT}{nF} \\log_{10}\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right)$$\n在 $T=25\\,^{\\circ}\\mathrm{C}$ ($298.15\\,\\mathrm{K}$) 时，项 $\\frac{2.303RT}{F}$ 等于 $0.05916\\,\\mathrm{V}$。给定的标准电位为 $E^{\\circ}=0.771\\,\\mathrm{V}$。\n代入数值：\n$$E\\mathrm{h} = 0.771 + \\frac{0.05916}{1} \\log_{10}\\left(\\frac{4.3540 \\times 10^{-5}}{2.2391 \\times 10^{-4}}\\right)$$\n$$E\\mathrm{h} = 0.771 + 0.05916 \\log_{10}(0.19445)$$\n$$E\\mathrm{h} = 0.771 + 0.05916 \\times (-0.71126)$$\n$$E\\mathrm{h} = 0.771 - 0.042079$$\n$$E\\mathrm{h} = 0.728921\\,\\mathrm{V}$$\n根据要求四舍五入到四位有效数字，我们得到：\n$$E\\mathrm{h} = 0.7289\\,\\mathrm{V}$$",
            "answer": "$$\\boxed{0.7289}$$"
        },
        {
            "introduction": "在掌握了 $Eh$ 的基本计算之后，本练习将理论与计算应用联系起来。你将学习如何在广泛使用的地球化学模拟软件 PHREEQC 中，将 $pe$ 或 $Eh$ 作为主控变量来设定氧化还原约束 。这项实践对于模拟天然水体中氧化还原敏感元素的行为至关重要，并为构建稳健的地球化学模型提供了实用指南。",
            "id": "4098173",
            "problem": "要求您形式化描述氧化还原电位变量如何用作主控约束，并将这些约束转化为能够为美国地质调查局 (USGS) 的代码 PHREEQC 生成一致输入规范的算法程序，同时对氧化还原关系进行数值验证。从热力学第一性原理和核心定义出发，推导一个通用的计算方法，用于在不同温度下相互转换电子活度形式和电极电位形式，并将其与铁氧化还原电对的平衡比率联系起来。然后，阐述如何将这些约束应用到一个结构化的、可由机器生成的 PHREEQC 输入块集合中，用于处理含有铁 ($\\mathrm{Fe}$)、硫 ($\\mathrm{S}$) 和碳 ($\\mathrm{C}$) 物种的溶液，确保电子活度 ($pe$) 或电极电位 ($Eh$) 作为主控变量。\n\n您必须使用以下基本数据（以指定的物理单位表示）进行推导和后续计算：普适气体常数 $R$ 为 $8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，法拉第常数 $F$ 为 $96485.33212\\,\\mathrm{C\\,mol^{-1}}$，铁 $\\mathrm{Fe^{3+}/Fe^{2+}}$ 氧化还原电对在 $25\\,^{\\circ}\\mathrm{C}$ 时的标准电位为 $E^{0}_{\\mathrm{Fe^{3+}/Fe^{2+}}} = 0.771\\,\\mathrm{V}$，转移电子数 $n=1$。在本问题中，为计算铁物种的活度比，将活度视为等于质量摩尔浓度。\n\n您推导的算法必须能够为测试套件中的每个场景完成以下任务：\n- 给定绝对温度 $T$（单位为 $\\mathrm{K}$）下的 $pe$ 或 $Eh$，仅使用您推导的基本关系式一致地计算另一个变量，并以 $\\mathrm{V}$ 为单位表示 $Eh$。\n- 使用推导出的铁 $\\mathrm{Fe^{3+}/Fe^{2+}}$ 半反应的 Nernst 关系式，计算在给定 $T$ 和 $Eh$ 下的平衡活度比 $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$。\n- 根据实际模型的适用性，使用以下整数代码推荐一个 PHREEQC 数据库：$0$ 代表 $\\texttt{phreeqc.dat}$，$1$ 代表 $\\texttt{wateq4f.dat}$，$2$ 代表 $\\texttt{llnl.dat}$，$3$ 代表 $\\texttt{pitzer.dat}$。如果离子强度 $I \\ge 0.3\\,\\mathrm{mol\\,kg^{-1}}$，则选择 $3$；否则，如果 $T \\ge 373.15\\,\\mathrm{K}$，则选择 $2$；否则，如果 $I \\le 0.01\\,\\mathrm{mol\\,kg^{-1}}$ 且 $T \\le 298.15\\,\\mathrm{K}$，则选择 $1$；否则选择 $0$。\n- 报告计算出的 $Eh$ 是否位于此处定义的常见天然水地球化学氧化还原范围内（$-0.8\\,\\mathrm{V} \\le Eh \\le 1.2\\,\\mathrm{V}$），结果为一个布尔值。\n- 在您的推导中，清楚阐明如何构建 PHREEQC 输入块，在 $\\texttt{SOLUTION}$ 块内将 $pe$ 或 $Eh$ 设置为主控变量，以及如何使用适当的部分（例如用于矿物的 $\\texttt{EQUILIBRIUM_PHASES}$（如赤铁矿和黄铁矿）、用于气体的 $\\texttt{GAS_PHASE}$（如 $\\mathrm{CO_{2}(g)}$ 和 $\\mathrm{CH_{4}(g)}$））来包含对 $\\mathrm{Fe}$、$\\mathrm{S}$ 和 $\\mathrm{C}$ 物种的约束，以及 $\\mathrm{C}$ 和 $\\mathrm{S}$ 氧化还原对的元素总浓度。您的程序不需要打印这些文本块，但您给出的规则必须是可实现的，以便生成有效的 PHREEQC 输入。\n\n关于数值报告：\n- 以 $\\mathrm{V}$ 为单位表示 $Eh$，四舍五入到六位小数。\n- 以无单位小数表示 $pe$，四舍五入到六位小数。\n- 以无单位小数表示 $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$，四舍五入到六位小数。\n\n测试套件：\n- 场景 1：$T = 298.15\\,\\mathrm{K}$，输入类型 $pe$，$pe = 12.0$，$I = 0.01\\,\\mathrm{mol\\,kg^{-1}}$，$\\mathrm{pH} = 7.0$。\n- 场景 2：$T = 298.15\\,\\mathrm{K}$，输入类型 $Eh$，$Eh = -0.200\\,\\mathrm{V}$，$I = 0.05\\,\\mathrm{mol\\,kg^{-1}}$，$\\mathrm{pH} = 7.0$。\n- 场景 3：$T = 353.15\\,\\mathrm{K}$，输入类型 $pe$，$pe = 4.0$，$I = 0.5\\,\\mathrm{mol\\,kg^{-1}}$，$\\mathrm{pH} = 8.0$。\n- 场景 4：$T = 273.15\\,\\mathrm{K}$，输入类型 $Eh$，$Eh = 1.000\\,\\mathrm{V}$，$I = 0.001\\,\\mathrm{mol\\,kg^{-1}}$，$\\mathrm{pH} = 6.5$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含按顺序排列的每个场景的结果列表，每个列表包含五个条目 $[Eh\\_\\mathrm{V},pe,\\mathrm{Fe3Fe2Ratio},\\mathrm{DB\\_code},Eh\\_\\mathrm{in\\_window}]$，其中前三个条目是四舍五入到六位小数的浮点数，第四个条目是整数数据库代码，第五个条目是布尔值。将所有场景聚合到一个外部列表中，以单行、逗号分隔、并用方括号括起来的形式打印，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$。",
            "solution": "问题陈述已经过严格验证，并被认为是有效的。它在科学上基于化学热力学和电化学原理，问题设定良好，给出的条件完整且一致，并且其表述是客观的。这些任务是可形式化的，并且与计算地球化学领域相关。\n\n### **1. 理论推导**\n\n本节推导了相互转换氧化还原电位标度以及计算依赖于氧化还原的物种比率所需的基本关系。推导从热力学第一性原理开始。\n\n#### **1.1. $pe$ 与 $Eh$ 的相互转换**\n\n水溶液的氧化还原状态可以通过电极电位 $Eh$ 或电子活度 $pe$ 来描述。电位 $Eh$（单位为伏特）与氧化还原半反应的吉布斯自由能变 $\\Delta_r G$ 通过以下方程相关：\n$$ \\Delta_r G = -nFEh $$\n其中 $n$ 是反应中转移的电子的摩尔数，$F$ 是法拉第常数，$F = 96485.33212\\,\\mathrm{C\\,mol^{-1}}$。\n\n电子活度 $a_{e^-}$ 是一个概念性构造，用于将质量作用定律应用于氧化还原反应。其负十进对数定义为 $pe$：\n$$ pe = -\\log_{10}(a_{e^-}) $$\n这类似于通过氢离子活度定义 $\\mathrm{pH}$。\n\n$Eh$ 和 $pe$ 之间的联系是通过考虑电子的热力学势建立的。与一摩尔电子转移相关的自由能变与其活度的关系为：\n$$ \\Delta_r G_{e^-} = RT \\ln(a_{e^-}) $$\n其中 $R$ 是普适气体常数，$R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$T$ 是绝对温度（单位为开尔文）。这适用于电子作为产物的过程。对于一个写成消耗电子的氧化半反应，能量由 $\\Delta_r G = -FEh$（对于 $n=1$）给出。将单个电子 ($n=1$) 的化学势和电化学势相等，我们得到：\n$$ -FEh = RT \\ln(a_{e^-}) $$\n使用关系式 $\\ln(x) = \\ln(10) \\log_{10}(x)$：\n$$ -FEh = RT \\ln(10) \\log_{10}(a_{e^-}) $$\n代入定义 $pe = -\\log_{10}(a_{e^-})$：\n$$ -FEh = RT \\ln(10) (-pe) $$\n这简化为 $Eh$ 和 $pe$ 之间的直接转换公式：\n$$ Eh = \\frac{RT \\ln(10)}{F} pe $$\n项 $\\frac{RT \\ln(10)}{F}$ 是一个与温度相关的因子。在标准温度 $T = 298.15\\,\\mathrm{K}$ 下，该因子约为 $0.05916\\,\\mathrm{V}$。\n\n逆关系是：\n$$ pe = \\frac{F}{RT \\ln(10)} Eh $$\n这些方程构成了在任何给定温度 $T$ 下相互转换两个主要氧化还原主控变量的基础。\n\n#### **1.2. $\\mathrm{Fe^{3+}/Fe^{2+}}$ 电对的 Nernst 关系式**\n\n三价铁 ($\\mathrm{Fe^{3+}}$) 和二价铁 ($\\mathrm{Fe^{2+}}$) 之间的平衡由以下半反应描述：\n$$ \\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}} $$\n对于该反应，转移的电子数为 $n=1$。Nernst 方程将溶液的电位 $Eh$ 与电对的标准电位 $E^0$ 以及氧化态和还原态物种的活度联系起来：\n$$ Eh = E^0_{\\mathrm{Fe^{3+}/Fe^{2+}}} - \\frac{RT}{nF} \\ln(Q) $$\n其中 $Q$ 是反应商，$Q = \\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}}}$。问题给出了在 $T_{ref} = 298.15\\,\\mathrm{K}$ 时的标准电位为 $E^0_{\\mathrm{Fe^{3+}/Fe^{2+}}} = 0.771\\,\\mathrm{V}$。就本问题而言，在没有用于温度校正的焓数据的情况下，假定 $E^0$ 在测试的温度范围内是恒定的。\n\n代入 $n=1$ 和 $Q$ 的表达式，我们得到：\n$$ Eh = E^0 - \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}}}\\right) $$\n为了求得平衡活度比 $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$，我们重新排列方程。使用 $\\ln(1/x) = -\\ln(x)$：\n$$ Eh = E^0 + \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) $$\n$$ Eh - E^0 = \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) $$\n解出对数项：\n$$ \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) = \\frac{F(Eh - E^0)}{RT} $$\n最后，对两边取指数，得到所需的活度比计算公式：\n$$ \\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}} = \\exp\\left(\\frac{F(Eh - E^0)}{RT}\\right) $$\n鉴于问题陈述要求将活度视为等于质量摩尔浓度，这也代表了质量摩尔浓度之比。\n\n### **2. 算法程序和 PHREEQC 规范**\n\n推导出的公式以分步计算的方式实现。\n\n#### **2.1. 计算算法**\n\n对于每个给定的场景，其输入包括温度 $T$、离子强度 $I$ 和一个定义氧化还原的参数（$pe$ 或 $Eh$）：\n1.  **氧化还原变量相互转换：**\n    - 计算与温度相关的转换因子 $\\kappa = \\frac{RT \\ln(10)}{F}$。\n    - 如果给定 $pe$，则计算 $Eh = \\kappa \\times pe$。\n    - 如果给定 $Eh$，则计算 $pe = Eh / \\kappa$。\n2.  **铁物种比率计算：**\n    - 使用步骤 1 中计算出的 $Eh$、给定的温度 $T$ 以及标准常数 $R$、$F$ 和 $E^0 = 0.771\\,\\mathrm{V}$，使用推导出的 Nernst 关系式计算活度比：\n      $$ \\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}} = \\exp\\left(\\frac{F(Eh - E^0)}{RT}\\right) $$\n3.  **PHREEQC 数据库推荐：**\n    - 根据一组关于离子强度 $I$ 和温度 $T$ 的优先规则选择合适的热力学数据库：\n        - 如果离子强度 $I \\ge 0.3\\,\\mathrm{mol\\,kg^{-1}}$，推荐 `pitzer.dat`（代码 $3$），该数据库设计用于高盐度卤水。\n        - 否则，如果温度 $T \\ge 373.15\\,\\mathrm{K}$（$100\\,^{\\circ}\\mathrm{C}$），推荐 `llnl.dat`（代码 $2$），该数据库具有更好的高温数据覆盖范围。\n        - 否则，如果 $I \\le 0.01\\,\\mathrm{mol\\,kg^{-1}}$ 且 $T \\le 298.15\\,\\mathrm{K}$，推荐 `wateq4f.dat`（代码 $1$），该数据库适用于稀释的低温淡水。\n        - 否则，推荐通用型 `phreeqc.dat`（代码 $0$）。\n4.  **地球化学窗口验证：**\n    - 将计算出的 $Eh$ 与常见天然水环境的定义范围 $-0.8\\,\\mathrm{V} \\le Eh \\le 1.2\\,\\mathrm{V}$ 进行比较。结果报告为布尔值（`True` 或 `False`）。\n\n#### **2.2. PHREEQC 输入块规范**\n\n为了在 PHREEQC 模拟中实施这些约束，需要构建特定的输入块。该问题涉及一个含有 $\\mathrm{Fe}$、$\\mathrm{S}$ 和 $\\mathrm{C}$ 的溶液。\n\n-   **`SOLUTION` 块：** 此块定义初始溶液组成和主控变量。使用 `pe` 或 `Eh` 关键字将氧化还原电位设置为主控变量。\n    ```\n    SOLUTION 1\n        temp      25.0              # Temperature in Celsius\n        pH        7.0               # pH\n        pe        12.0              # specified master pe\n        # OR, alternatively:\n        # Eh        0.71              # Specified master Eh in Volts\n        units     mol/kgw           # Defines concentration units\n        Fe        1e-5              # Total dissolved iron concentration\n        S         1e-4              # Total dissolved sulfur concentration\n        C         1e-3              # Total dissolved carbon concentration\n    ```\n\n-   **`EQUILIBRIUM_PHASES` 块：** 为通过与固相（矿物）平衡来约束溶液，使用此块。饱和指数 ($SI$) 为 $0.0$ 表示强制达到平衡。\n    ```\n    EQUILIBRIUM_PHASES 1\n        Hematite  0.0  10.0         # Equilibrate with Hematite (Fe2O3)\n        Pyrite    0.0  10.0         # Equilibrate with Pyrite (FeS2)\n    ```\n\n-   **`GAS_PHASE` 块：** 为通过与气体混合物平衡来约束溶液，使用此块。可以固定相关气体（如 $\\mathrm{CO_{2}(g)}$ 和 $\\mathrm{CH_{4}(g)}$）的分压。\n    ```\n    GAS_PHASE 1\n        -fixed_pressure\n        -pressure    1.0            # Total pressure in atm\n        -temperature 25.0            # Temperature in Celsius\n        CO2(g)       -3.5           # log10(partial pressure of CO2)\n        CH4(g)       -6.0           # log10(partial pressure of CH4)\n    ```\n通过组合这些块，PHREEQC 可以模拟一个复杂的地球化学系统，其中由主控变量 $pe$ 或 $Eh$ 决定的整体氧化还原状态，控制着像 $\\mathrm{Fe}$、$\\mathrm{S}$ 和 $\\mathrm{C}$ 这样的氧化还原敏感元素的形态分布，以及它们在水相、固相和气相之间的分配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the computational geochemistry problem for a given test suite.\n    Derives redox variables and equilibrium ratios based on thermodynamic principles.\n    \"\"\"\n\n    # Define fundamental constants as specified in the problem statement.\n    R = 8.314462618  # J mol^-1 K^-1\n    F = 96485.33212  # C mol^-1\n    E0_Fe = 0.771    # V, standard potential of Fe3+/Fe2+ at 298.15 K\n\n    # Define the test suite from the problem statement.\n    # Each entry is a tuple: (T_K, input_type, input_val, I_mol_kgw, pH)\n    test_cases = [\n        (298.15, 'pe', 12.0, 0.01, 7.0),\n        (298.15, 'Eh', -0.200, 0.05, 7.0),\n        (353.15, 'pe', 4.0, 0.5, 8.0),\n        (273.15, 'Eh', 1.000, 0.001, 6.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T_K, input_type, input_val, I_mol_kgw, _ = case\n\n        # 1. Interconvert pe and Eh\n        # The conversion factor is (R*T*ln(10))/F\n        conversion_factor = (R * T_K * np.log(10)) / F\n\n        if input_type == 'pe':\n            pe = float(input_val)\n            Eh_V = pe * conversion_factor\n        elif input_type == 'Eh':\n            Eh_V = float(input_val)\n            pe = Eh_V / conversion_factor\n        else:\n            # This case should not be reached with the given test suite.\n            raise ValueError(\"Invalid input type provided.\")\n\n        # 2. Compute the equilibrium activity ratio a(Fe3+)/a(Fe2+)\n        # The formula derived is exp((F * (Eh - E0)) / (R * T))\n        exponent = (F * (Eh_V - E0_Fe)) / (R * T_K)\n        # Prevent overflow for very large exponents if necessary, though numpy handles it.\n        try:\n            Fe3Fe2Ratio = math.exp(exponent)\n        except OverflowError:\n            Fe3Fe2Ratio = float('inf')\n\n        # 3. Recommend a PHREEQC database based on the rules\n        # DB codes: 0:phreeqc.dat, 1:wateq4f.dat, 2:llnl.dat, 3:pitzer.dat\n        T_C = T_K - 273.15\n        if I_mol_kgw >= 0.3:\n            DB_code = 3  # pitzer.dat\n        elif T_K >= 373.15: # 100 C\n            DB_code = 2  # llnl.dat\n        elif I_mol_kgw = 0.01 and T_K = 298.15:\n            DB_code = 1  # wateq4f.dat\n        else:\n            DB_code = 0  # phreeqc.dat\n\n        # 4. Check if Eh lies within the common geochemical redox window [-0.8 V, 1.2 V]\n        Eh_in_window = -0.8 = Eh_V = 1.2\n\n        # 5. Collate and format results for the current scenario\n        # Round floats to six decimal places as requested.\n        current_result = [\n            round(Eh_V, 6),\n            round(pe, 6),\n            round(Fe3Fe2Ratio, 6),\n            DB_code,\n            Eh_in_window,\n        ]\n        results.append(current_result)\n\n    # Final print statement in the exact required format.\n    # The format is a single line string representation of a list of lists.\n    # Example: [[...],[...],[...],[...]]\n    # Using python's string conversion of list automatically formats it this way.\n    print(results)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "天然水体系统非常复杂，通常不处于完全的热力学平衡状态，这导致从不同氧化还原电对测得的电位值可能相互矛盾。这项高级实践直面这一现实挑战，介绍了一种从一组测量数据中估算单一“最佳拟合”系统 $pe$ 的方法 。通过应用加权最小二乘法，你将构建一个稳健的数据分析流程，从而能够从复杂且不确定的现场数据中推导出最具代表性的系统氧化还原状态。",
            "id": "4098224",
            "problem": "您的任务是构建一个完整、可运行的程序，用于根据一系列测量的氧化还原电对，估算最佳拟合的电子活度（表示为以 10 为底的负对数 $pe$）。该程序必须为每个测试用例求解一个单一的 $pe$ 值，该值能够最小化由 $pe$ 隐含的电子电势与由各氧化还原电对隐含的电子电势之间的加权残差平方和，同时考虑形式电位的不确定度。所需的推导和计算步骤必须基于以下基本原理：电子活度的定义及其与电子电势的关系，以及从化学势推导出的半反应平衡条件。\n\n请使用以下背景、定义和要求：\n- 电子活度定义为 $pe = -\\log_{10}\\left(a_{e^-}\\right)$，其中 $a_{e^-}$ 是电子的活度。\n- 电子化学势 $\\mu_{e^-}$ 通过 $\\mu_{e^-} = -F \\, Eh$ 与电子电势 $Eh$ 相关，其中 $F$ 是法拉第常数。\n- 对于一个写为 $\\sum_j \\nu_{ij} A_j + n_i e^- \\rightleftharpoons \\sum_j \\nu'_{ij} B_j$ 的通用氧化还原半反应，从化学势和能斯特方程推导出的平衡条件意味着形式电位 $E_{0,i}'$、化学计量以及物种 $\\{A_j\\}$、$\\{B_j\\}$ 的活度之间存在一个关系，该关系为每个电对导出一个隐含的电子电势 $Eh_i$。\n- 在每个测试用例中，假设不确定度仅存在于形式电位 $E_{0,i}'$ 中（由标准差 $\\sigma_i$ 表示），并将物种活度视为没有不确定度的已知量。\n\n对于测试用例中的每个氧化还原电对 $i$：\n1. 化学计量由整数 $n_i$（电子）、反应物指数 $\\{\\nu_{ij}\\}$ 和产物指数 $\\{\\nu'_{ij}\\}$ 给出。\n2. 活度比（不包括电子的反应商）为 $Q_i = \\prod_j a_{B_j}^{\\nu'_{ij}} \\Big/ \\prod_j a_{A_j}^{\\nu_{ij}}$。\n3. 隐含的电子电势为 $Eh_i = E_{0,i}' - \\dfrac{R T}{n_i F} \\ln(Q_i)$，其中 $R$ 是气体常数，$T$ 是绝对温度，$F$ 是法拉第常数。\n4. 由单一未知量 $pe$ 隐含的电子电势为 $Eh(pe) = \\dfrac{R T}{F} \\ln(10) \\, pe$。\n\n您必须找到每个测试用例中能使加权残差平方和 $\\sum_i w_i \\left(Eh(pe) - Eh_i\\right)^2$ 最小化的单一 $pe$ 值，权重为 $w_i = 1/\\sigma_i^2$。同时报告每个测试用例的 $Eh^\\ast = Eh(pe^\\ast)$。将 $Eh$ 以伏特表示，$pe$ 为无量纲量。将每个报告值四舍五入到小数点后六位。\n\n所有计算中使用的常数：\n- $R = 8.314462618 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$\n- $F = 96485.33212 \\ \\mathrm{C \\ mol^{-1}}$\n\n测试套件规范：\n每个测试用例由开尔文温度 $T$ 以及一个氧化还原电对列表指定，该列表包含它们的化学计量、物种活度、形式电位均值和不确定度。物种活度是无量纲的，固体的活度为 $1$。\n\n测试用例 1（正常情况，具有中等不确定度的多个电对）：\n- $T = 298.15$\n- 电对：\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - 反应物：Fe$^{3+}$，$\\nu_{1,\\mathrm{Fe}^{3+}} = 1$，$a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - 产物：Fe$^{2+}$，$\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$，$a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$，$\\sigma_1 = 0.020$\n    2. MnO$_4^-$ + $8$ H$^+$ + $5 e^-$ $\\rightleftharpoons$ Mn$^{2+}$ + $4$ H$_2$O:\n        - $n_2 = 5$\n        - 反应物：MnO$_4^-$，$\\nu_{2,\\mathrm{MnO}_4^-} = 1$，$a_{\\mathrm{MnO}_4^-} = 10^{-6}$；H$^+$，$\\nu_{2,\\mathrm{H}^+} = 8$，$a_{\\mathrm{H}^+} = 10^{-5}$\n        - 产物：Mn$^{2+}$，$\\nu'_{2,\\mathrm{Mn}^{2+}} = 1$，$a_{\\mathrm{Mn}^{2+}} = 10^{-7}$；H$_2$O，$\\nu'_{2,\\mathrm{H_2O}} = 4$，$a_{\\mathrm{H_2O}} = 1$\n        - $E_{0,2}' = 1.510$，$\\sigma_2 = 0.030$\n    3. NO$_3^-$ + $2$ H$^+$ + $e^-$ $\\rightleftharpoons$ NO$_2^-$ + H$_2$O:\n        - $n_3 = 1$\n        - 反应物：NO$_3^-$，$\\nu_{3,\\mathrm{NO}_3^-} = 1$，$a_{\\mathrm{NO}_3^-} = 10^{-4}$；H$^+$，$\\nu_{3,\\mathrm{H}^+} = 2$，$a_{\\mathrm{H}^+} = 10^{-7}$\n        - 产物：NO$_2^-$，$\\nu'_{3,\\mathrm{NO}_2^-} = 1$，$a_{\\mathrm{NO}_2^-} = 10^{-6}$；H$_2$O，$\\nu'_{3,\\mathrm{H_2O}} = 1$，$a_{\\mathrm{H_2O}} = 1$\n        - $E_{0,3}' = 0.800$，$\\sigma_3 = 0.050$\n\n测试用例 2（边界情况：一个具有非常高不确定度的电对降低了其影响）：\n- $T = 298.15$\n- 电对：与测试用例 1 相同，但将硝酸盐/亚硝酸盐电对的 $\\sigma_3$ 设置为 $0.500$。\n\n测试用例 3（温度敏感性和混合化学计量）：\n- $T = 323.15$\n- 电对：\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - 反应物：Fe$^{3+}$，$\\nu_{1,\\mathrm{Fe}^{3+}} = 1$，$a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - 产物：Fe$^{2+}$，$\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$，$a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$，$\\sigma_1 = 0.020$\n    2. Cu$^{2+}$ + $e^-$ $\\rightleftharpoons$ Cu$^{+}$:\n        - $n_2 = 1$\n        - 反应物：Cu$^{2+}$，$\\nu_{2,\\mathrm{Cu}^{2+}} = 1$，$a_{\\mathrm{Cu}^{2+}} = 10^{-6}$\n        - 产物：Cu$^{+}$，$\\nu'_{2,\\mathrm{Cu}^{+}} = 1$，$a_{\\mathrm{Cu}^{+}} = 10^{-5}$\n        - $E_{0,2}' = 0.153$，$\\sigma_2 = 0.030$\n    3. S$_4$O$_6^{2-}$ + $2 e^-$ $\\rightleftharpoons$ $2$ S$_2$O$_3^{2-}$:\n        - $n_3 = 2$\n        - 反应物：S$_4$O$_6^{2-}$，$\\nu_{3,\\mathrm{S}_4\\mathrm{O}_6^{2-}} = 1$，$a_{\\mathrm{S}_4\\mathrm{O}_6^{2-}} = 10^{-4}$\n        - 产物：S$_2$O$_3^{2-}$，$\\nu'_{3,\\mathrm{S}_2\\mathrm{O}_3^{2-}} = 2$，$a_{\\mathrm{S}_2\\mathrm{O}_3^{2-}} = 10^{-3}$\n        - $E_{0,3}' = 0.120$，$\\sigma_3 = 0.030$\n\n测试用例 4（边界条件：单电对拟合）：\n- $T = 298.15$\n- 电对：\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - 反应物：Fe$^{3+}$，$\\nu_{1,\\mathrm{Fe}^{3+}} = 1$，$a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - 产物：Fe$^{2+}$，$\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$，$a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$，$\\sigma_1 = 0.020$\n\n程序输出规范：\n- 对于每个测试用例，计算最佳拟合的 $pe^\\ast$ 和相应的 $Eh^\\ast$（单位：伏特）。\n- 将 $pe^\\ast$ 和 $Eh^\\ast$ 均四舍五入到小数点后六位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果本身是一个双元素列表，顺序为 $[pe^\\ast, Eh^\\ast]$。例如：$[[pe_1,Eh_1],[pe_2,Eh_2],[pe_3,Eh_3],[pe_4,Eh_4]]$。",
            "solution": "所述问题在科学上是合理的，在数学上是适定的，并为唯一解提供了所有必要信息。其定义和关系与热力学和电化学的基本原理一致。因此，该问题被认为是有效的。我们继续进行求解推导。\n\n核心任务是找到以 $pe$ 表示的电子活度，该活度能够最好地代表一个包含多个氧化还原电对的体系。这被构建为一个最小化问题。我们寻求一个值 $pe = pe^\\ast$，它能最小化加权残差平方和 $S(pe)$，即体系整体 $pe$ 所隐含的电子电势与每个氧化还原电对所隐含的单个电子电势之间的加权残差平方和。\n\n需要最小化的目标函数如下：\n$$S(pe) = \\sum_i w_i \\left(Eh(pe) - Eh_i\\right)^2$$\n其中求和遍及给定测试用例中的所有 $i$ 个氧化还原电对。\n\n此方程中的各项定义如下：\n1. $Eh_i$：由单个氧化还原半反应 $i$ 隐含的电子电势（单位：伏特）。它使用能斯特方程计算：\n    $$Eh_i = E_{0,i}' - \\frac{R T}{n_i F} \\ln(Q_i)$$\n    此处，$E_{0,i}'$ 是形式电位，$R$ 是理想气体常数，$T$ 是绝对温度（开尔文），$n_i$ 是转移的电子数，$F$ 是法拉第常数，$Q_i$ 是半反应的反应商，定义为：\n    $$Q_i = \\frac{\\prod_j a_{B_j}^{\\nu'_{ij}}}{\\prod_j a_{A_j}^{\\nu_{ij}}}$$\n    其中 $\\{A_j\\}$ 是反应物，其化学计量指数为 $\\{\\nu_{ij}\\}$，活度为 $\\{a_{A_j}\\}$；$\\{B_j\\}$ 是产物，其指数为 $\\{\\nu'_{ij}\\}$，活度为 $\\{a_{B_j}\\}$。\n\n2. $Eh(pe)$：对应于给定全体系 $pe$ 值的电子电势（单位：伏特）。这个关系在地球化学中是基础性的，由以下公式给出：\n    $$Eh(pe) = \\frac{R T \\ln(10)}{F} pe$$\n    为简洁起见，我们可以定义一个与温度相关的常数 $C_T = \\frac{R T \\ln(10)}{F}$。因此，$Eh(pe) = C_T \\cdot pe$。\n\n3. $w_i$：分配给每个氧化还原电对 $i$ 的权重。问题指定不确定度仅存在于形式电位 $E_{0,i}'$ 中，由标准差 $\\sigma_i$ 给出。在加权最小二乘法中，最佳权重是测量值方差的倒数。由于 $Eh_i$ 线性依赖于 $E_{0,i}'$，因此 $Eh_i$ 的方差是 $\\sigma_i^2$。因此，适当的权重为：\n    $$w_i = \\frac{1}{\\sigma_i^2}$$\n\n根据这些定义，目标函数变为：\n$$S(pe) = \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right)^2$$\n\n为了找到使该函数最小化的值 $pe^\\ast$，我们对 $S(pe)$ 关于 $pe$ 求导，并令其为零。由于 $S(pe)$ 是 $pe$ 的二次函数，其图像是开口向上的抛物线，这保证了存在唯一的全局最小值。\n$$ \\frac{dS}{d(pe)} = \\frac{d}{d(pe)} \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right)^2 = 0 $$\n利用导数的线性和链式法则：\n$$ \\sum_i \\frac{1}{\\sigma_i^2} \\cdot 2 \\left(C_T \\cdot pe - Eh_i\\right) \\cdot \\frac{d}{d(pe)}(C_T \\cdot pe - Eh_i) = 0 $$\n$$ \\sum_i \\frac{2}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right) \\cdot C_T = 0 $$\n由于当 $T  0$ 时，$2$ 和 $C_T$ 是非零常数，我们可以将它们约去：\n$$ \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right) = 0 $$\n令满足此条件的 $pe$ 值为 $pe = pe^\\ast$，我们可以重新整理这个和式：\n$$ \\sum_i \\frac{1}{\\sigma_i^2} (C_T \\cdot pe^\\ast) - \\sum_i \\frac{1}{\\sigma_i^2} Eh_i = 0 $$\n$$ C_T \\cdot pe^\\ast \\sum_i \\frac{1}{\\sigma_i^2} = \\sum_i \\frac{1}{\\sigma_i^2} Eh_i $$\n项 $C_T \\cdot pe^\\ast$ 正是最佳拟合的体系电势 $Eh^\\ast$。求解 $Eh^\\ast$：\n$$ Eh^\\ast = \\frac{\\sum_i \\frac{1}{\\sigma_i^2} Eh_i}{\\sum_i \\frac{1}{\\sigma_i^2}} = \\frac{\\sum_i w_i Eh_i}{\\sum_i w_i} $$\n这表明最优电子电势 $Eh^\\ast$ 是从每个电对导出的单个电势 $Eh_i$ 的加权平均值，其权重为其方差的倒数。\n\n最后，我们可以利用 $pe^\\ast$ 与 $Eh^\\ast$ 的关系来求解 $pe^\\ast$：\n$$ pe^\\ast = \\frac{Eh^\\ast}{C_T} = \\frac{F}{R T \\ln(10)} Eh^\\ast $$\n代入 $Eh^\\ast$ 的表达式：\n$$ pe^\\ast = \\frac{F}{R T \\ln(10)} \\left( \\frac{\\sum_i w_i Eh_i}{\\sum_i w_i} \\right) $$\n\n每个测试用例的计算流程如下：\n1. 确定物理常数 $R$ 和 $F$。\n2. 对于给定的温度 $T$，遍历 $N$ 个氧化还原电对中的每一个。\n3. 对于每个电对 $i$：\n   a. 计算反应商的对数 $\\ln(Q_i)$，以避免因极大或极小的活度值而可能导致的数值不稳定性。\n      $$\\ln(Q_i) = \\sum_j \\nu'_{ij} \\ln(a_{B_j}) - \\sum_j \\nu_{ij} \\ln(a_{A_j})$$\n   b. 计算隐含电势 $Eh_i = E_{0,i}' - \\frac{R T}{n_i F} \\ln(Q_i)$。\n   c. 计算权重 $w_i = 1/\\sigma_i^2$。\n4. 计算总的电势加权和 $\\sum_i w_i Eh_i$ 以及权重之和 $\\sum_i w_i$。\n5. 计算最佳拟合电势 $Eh^\\ast = (\\sum_i w_i Eh_i) / (\\sum_i w_i)$。\n6. 计算最佳拟合的 $pe^\\ast = Eh^\\ast \\left/ \\left( \\frac{R T \\ln(10)}{F} \\right) \\right.$。\n7. 按要求将 $pe^\\ast$ 和 $Eh^\\ast$ 均四舍五入到小数点后六位。\n该算法在下面的 Python 程序中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the best-fit pe and Eh for redox systems based on weighted least squares minimization.\n    \"\"\"\n\n    # Physical constants\n    R = 8.314462618  # Ideal gas constant in J mol^-1 K^-1\n    F = 96485.33212  # Faraday constant in C mol^-1\n\n    # Test suite specification\n    test_cases = [\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],  # Fe3+\n                    \"products\": [(1, 1e-6)],   # Fe2+\n                },\n                {\n                    \"n\": 5, \"E0_prime\": 1.510, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6), (8, 1e-5)],  # MnO4-, H+\n                    \"products\": [(1, 1e-7), (4, 1.0)],    # Mn2+, H2O\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.800, \"sigma\": 0.050,\n                    \"reactants\": [(1, 1e-4), (2, 1e-7)],  # NO3-, H+\n                    \"products\": [(1, 1e-6), (1, 1.0)],    # NO2-, H2O\n                },\n            ],\n        },\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],\n                    \"products\": [(1, 1e-6)],\n                },\n                {\n                    \"n\": 5, \"E0_prime\": 1.510, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6), (8, 1e-5)],\n                    \"products\": [(1, 1e-7), (4, 1.0)],\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.800, \"sigma\": 0.500, # Changed sigma\n                    \"reactants\": [(1, 1e-4), (2, 1e-7)],\n                    \"products\": [(1, 1e-6), (1, 1.0)],\n                },\n            ],\n        },\n        {\n            \"T\": 323.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)], # Fe3+\n                    \"products\": [(1, 1e-6)],   # Fe2+\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.153, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6)], # Cu2+\n                    \"products\": [(1, 1e-5)],   # Cu+\n                },\n                {\n                    \"n\": 2, \"E0_prime\": 0.120, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-4)], # S4O6^2-\n                    \"products\": [(2, 1e-3)],   # S2O3^2-\n                },\n            ],\n        },\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],\n                    \"products\": [(1, 1e-6)],\n                },\n            ],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        T = case[\"T\"]\n        couples = case[\"couples\"]\n\n        sum_w_Eh = 0.0\n        sum_w = 0.0\n\n        for couple in couples:\n            n = couple[\"n\"]\n            E0_prime = couple[\"E0_prime\"]\n            sigma = couple[\"sigma\"]\n            \n            # Calculate log of reaction quotient Q\n            log_Q = 0.0\n            for nu, activity in couple[\"products\"]:\n                log_Q += nu * np.log(activity)\n            for nu, activity in couple[\"reactants\"]:\n                log_Q -= nu * np.log(activity)\n\n            # Calculate implied potential Eh_i for the couple\n            Eh_i = E0_prime - (R * T) / (n * F) * log_Q\n\n            # Calculate weight w_i\n            w_i = 1.0 / (sigma**2)\n\n            # Accumulate weighted sums\n            sum_w_Eh += w_i * Eh_i\n            sum_w += w_i\n\n        # Calculate best-fit Eh* (weighted average of Eh_i)\n        Eh_star = sum_w_Eh / sum_w\n\n        # Calculate best-fit pe*\n        pe_conversion_factor = (R * T * np.log(10)) / F\n        pe_star = Eh_star / pe_conversion_factor\n        \n        # Round results and append\n        pe_star_rounded = round(pe_star, 6)\n        Eh_star_rounded = round(Eh_star, 6)\n        results.append([pe_star_rounded, Eh_star_rounded])\n\n    # Format and print the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}