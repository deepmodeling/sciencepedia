{
    "hands_on_practices": [
        {
            "introduction": "统计力学的基本目标之一是将微观世界的构型与宏观世界的热力学性质联系起来。本练习通过一个在矿物学中常见的具体例子——计算晶格中点缺陷（空位）的构型熵和自由能，来阐释这一核心思想。通过解决这个问题，您将巩固对玻尔兹曼熵公式的理解，并学会如何应用它来推导热力学势。",
            "id": "4100029",
            "problem": "考虑一个用于计算地球化学模拟的矿物晶格，该晶格具有固定数量的 $M$ 个可区分的晶格位置和 $n$ 个点空位，这些空位可以占据这些位置的任意子集。假设空位是不可区分的，晶格位置是可区分的，并且除了位点排斥（每个位置最多一个空位）外，空位之间没有相互作用。系统维持在绝对温度 $T$ 下，并且只考虑对亥姆霍兹自由能的构型贡献。\n\n从 Boltzmann 的熵定义 $S = k_{B} \\ln \\Omega$ 出发，其中 $k_{B}$ 是 Boltzmann 常数，$\\Omega$ 是微观态的数量，执行以下操作：\n\n1. 构建将 $n$ 个不可区分的空位分配到 $M$ 个可区分位置上所对应的微观态的组合计数 $\\Omega(M,n)$。\n2. 使用亥姆霍兹自由能 $F = U - T S$ 并在保持 $M$ 和 $T$ 固定的情况下，推导每增加一个空位所对应的增量空位形成自由能的构型贡献，该贡献定义为构型自由能对 $n$ 的导数。清楚地说明您使用的任何渐近近似，并证明其合理性。\n3. 提供此构型贡献关于 $M$、$n$、$k_{B}$ 和 $T$ 的闭合形式解析表达式。\n\n将最终答案表示为单个闭合形式的解析表达式。不要进行数值计算。无需四舍五入。如果需要进行数值计算，能量应以焦耳表示。",
            "solution": "在进行求解之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n- 系统由一个具有 $M$ 个可区分位置和 $n$ 个点空位的矿物晶格组成。\n- 空位是不可区分的。\n- 晶格位置是可区分的。\n- 相互作用模型：除了位点排斥（每个位置最多一个空位）外，空位之间没有相互作用。\n- 热力学条件：系统处于固定的绝对温度 $T$。晶格位置的数量 $M$ 是固定的。\n- 熵定义：将使用 Boltzmann 熵定义 $S = k_{B} \\ln \\Omega$，其中 $k_{B}$ 是 Boltzmann 常数，$\\Omega$ 是微观态的数量。\n- 自由能定义：亥姆霍兹自由能，$F = U - T S$。\n- 目标 1：构建微观态的组合计数 $\\Omega(M,n)$。\n- 目标 2：推导每增加一个空位所对应的增量空位形成自由能的构型贡献，定义为构型自由能对 $n$ 的导数，$\\frac{\\partial F_{conf}}{\\partial n}$。\n- 目标 3：提供此量关于 $M$、$n$、$k_{B}$ 和 $T$ 的闭合形式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是统计力学在固态物理学或地球化学中的一个标准练习，特别是对晶格中的点缺陷进行建模。\n\n- **科学依据：** 该问题基于统计力学的基本原理，包括 Boltzmann 熵定义和亥姆霍兹自由能的概念。晶格上无相互作用的点缺陷模型是一种广泛使用且科学上合理的近似（Bragg-Williams 近似）。\n- **提法恰当：** 该问题对物理系统和待推导的量提供了清晰完整的描述。目标是顺序的，并导向一个唯一、有意义的解析解。\n- **客观性：** 语言形式化、精确，没有任何主观或基于观点的陈述。\n\n\"只考虑对亥姆霍兹自由能的构型贡献\" 这句话意味着我们关注由空位排列产生的自由能分量，即 $F_{conf} = -T S_{conf}$，其中 $S_{conf}$ 是构型熵。然后问题要求 \"增量空位形成自由能的构型贡献\"，这是要求对这一特定项求导的标准方式，即 $\\frac{\\partial}{\\partial n}(-TS_{conf})$，将其与空位形成的非构型能（在此模型中为一个常数 $\\epsilon_v$）分离开。在此标准解释下，该问题是自洽的。提及 \"渐近近似\" 正确地预示了将使用 Stirling 近似来对阶乘函数求导，这对于具有大量位置和空位的系统是合适的。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n\n**1. 构建组合计数 $\\Omega(M,n)$**\n\n问题要求计算将 $n$ 个不可区分的空位分配到 $M$ 个可区分的晶格位置上的方式数量，其约束条件为每个位置最多只能容纳一个空位。这是一个经典的组合问题，即从 $M$ 个不同对象集合中选择 $n$ 个对象，且选择顺序无关紧要。这种微观态的数量 $\\Omega(M,n)$ 由二项式系数“M 选 n”给出。\n\n$$\n\\Omega(M,n) = \\binom{M}{n} = \\frac{M!}{n!(M-n)!}\n$$\n\n**2. 推导增量自由能的构型贡献**\n\n构型熵 $S$ 由 Boltzmann 公式给出：\n$$\nS(n) = k_{B} \\ln \\Omega(M,n) = k_{B} \\ln \\left( \\frac{M!}{n!(M-n)!} \\right)\n$$\n利用对数的性质，可以将其写为：\n$$\nS(n) = k_{B} \\left[ \\ln(M!) - \\ln(n!) - \\ln((M-n)!) \\right]\n$$\n问题指明只考虑对亥姆霍兹自由能的构型贡献。该贡献为 $F_{conf} = -T S(n)$。我们被要求求出每增加一个空位的增量自由能，即 $F_{conf}$ 对 $n$ 的导数，同时保持 $M$ 和 $T$ 不变。\n$$\n\\frac{\\partial F_{conf}}{\\partial n} = \\frac{\\partial}{\\partial n} [-T S(n)] = -T \\frac{\\partial S(n)}{\\partial n}\n$$\n为了对熵表达式关于 $n$ 求导，我们必须将 $n$ 视为一个连续变量。由于在宏观晶体中 $n$、$M$ 和 $(M-n)$ 预计都是非常大的数，我们可以使用 Stirling 近似来处理阶乘的自然对数：对于大的 $x$，有 $\\ln(x!) \\approx x \\ln x - x$。这就是问题陈述中提到的渐近近似。\n\n将 Stirling 近似应用于熵表达式中的各项：\n$$\n\\ln(n!) \\approx n \\ln n - n\n$$\n$$\n\\ln((M-n)!) \\approx (M-n) \\ln(M-n) - (M-n)\n$$\n将这些代入 $S(n)$ 的表达式中：\n$$\nS(n) \\approx k_{B} \\left[ \\ln(M!) - (n \\ln n - n) - ((M-n) \\ln(M-n) - (M-n)) \\right]\n$$\n$$\nS(n) \\approx k_{B} \\left[ \\ln(M!) - n \\ln n + n - (M-n) \\ln(M-n) + M - n \\right]\n$$\n简化表达式：\n$$\nS(n) \\approx k_{B} \\left[ \\ln(M!) + M - n \\ln n - (M-n) \\ln(M-n) \\right]\n$$\n现在，我们对 $S(n)$ 关于 $n$ 求导。项 $\\ln(M!)$ 和 $M$ 相对于 $n$ 是常数。\n$$\n\\frac{\\partial S(n)}{\\partial n} \\approx \\frac{\\partial}{\\partial n} \\left[ k_{B} \\left( - n \\ln n - (M-n) \\ln(M-n) \\right) \\right]\n$$\n我们使用乘法法则求导，$\\frac{d}{dx}(uv) = u'v + uv'$。\n对于第一项，$-n \\ln n$：\n$$\n\\frac{\\partial}{\\partial n}(-n \\ln n) = -\\left( \\frac{\\partial(n)}{\\partial n} \\ln n + n \\frac{\\partial(\\ln n)}{\\partial n} \\right) = - \\left( 1 \\cdot \\ln n + n \\cdot \\frac{1}{n} \\right) = -(\\ln n + 1)\n$$\n对于第二项，$-(M-n) \\ln(M-n)$：\n$$\n\\frac{\\partial}{\\partial n} (-(M-n) \\ln(M-n)) = -\\left( \\frac{\\partial(M-n)}{\\partial n} \\ln(M-n) + (M-n) \\frac{\\partial(\\ln(M-n))}{\\partial n} \\right)\n$$\n$$\n= -\\left( (-1) \\ln(M-n) + (M-n) \\frac{1}{M-n}(-1) \\right) = -\\left( -\\ln(M-n) - 1 \\right) = \\ln(M-n) + 1\n$$\n结合这些结果：\n$$\n\\frac{\\partial S(n)}{\\partial n} \\approx k_{B} [ -(\\ln n + 1) + (\\ln(M-n) + 1) ] = k_{B} [ -\\ln n - 1 + \\ln(M-n) + 1 ]\n$$\n$$\n\\frac{\\partial S(n)}{\\partial n} = k_{B} [ \\ln(M-n) - \\ln n ] = k_{B} \\ln\\left(\\frac{M-n}{n}\\right)\n$$\n\n**3. 最终的闭合形式解析表达式**\n\n每增加一个空位所对应的增量空位形成自由能的构型贡献为 $-T \\frac{\\partial S(n)}{\\partial n}$。\n$$\n\\frac{\\partial F_{conf}}{\\partial n} = -T \\left[ k_{B} \\ln\\left(\\frac{M-n}{n}\\right) \\right] = -k_{B}T \\ln\\left(\\frac{M-n}{n}\\right)\n$$\n通过对对数的参数取倒数，该表达式可以等价地写为：\n$$\n\\frac{\\partial F_{conf}}{\\partial n} = k_{B}T \\ln\\left(\\left(\\frac{M-n}{n}\\right)^{-1}\\right) = k_{B}T \\ln\\left(\\frac{n}{M-n}\\right)\n$$\n这就是所求量的最终闭合形式解析表达式。",
            "answer": "$$\n\\boxed{k_{B} T \\ln\\left(\\frac{n}{M-n}\\right)}\n$$"
        },
        {
            "introduction": "在上一练习的基础上，本实践将引入外部压力这一在地球化学系统中至关重要的变量。我们将从正则系综转向与地球化学问题更相关的等温等压（$NPT$）系综。通过为一个简单的分子吸附和膨胀模型计算吉布斯自由能，您将学习如何构建和求解$NPT$系综的配分函数，并分析系统的热力学行为如何随压力和温度变化。",
            "id": "4100034",
            "problem": "考虑一个用于水合粘土基质中分子吸附和溶胀的地球化学晶格模型。该基质包含固定数量的等效吸附位点，记为 $M$，嵌入在主框架中。每个位点可以为空，也可以被一个水分子占据。如果一个位点被占据，基质会获得大小为 $\\epsilon$ 的内聚能贡献（降低内能），并且基质的宏观体积会增加一个偏摩尔增量 $v$。当所有位点都为空时，基线体积为 $V_0$。该系统与温度为 $T$、外部压力为 $p$ 的热和机械储层接触，并由等温等压系综 (NPT) 描述。假设如下：\n- 位点是独立且不可区分的，除了上述加和性的体积变化外，被占据的位点之间没有相互作用。\n- 内能仅通过 $U(n) = -\\epsilon n$ 依赖于被占据位点的数量 $n$，体积通过 $V(n) = V_0 + v n$ 依赖于 $n$。\n- 对于此晶格描述，分子的平动动能贡献被忽略，重点关注与基质吸附和溶胀热力学相关的构型贡献。\n\n从等温等压系综和微观态的 Boltzmann 权重的基本统计力学定义出发，推导该系统吉布斯自由能的精确、闭合形式的解析表达式，该表达式是 $p$ 和 $T$ 的函数，并用符号 $k_B$、$T$、$p$、$M$、$\\epsilon$、$v$ 和 $V_0$ 表示，其中 $k_B$ 是 Boltzmann 常数。然后，在您推导的表达式的基础上，定性分析吉布斯自由能如何随 $p$ 和 $T$ 变化，包括当 $p \\to \\infty$ 和 $T \\to \\infty$ 时的极限行为。\n\n用给定的符号将最终答案表示为单个解析表达式。不需要数值计算，最终表达式后也不应附加单位。",
            "solution": "所述问题具有科学依据，内容自洽，且提法明确。所有提供的信息都是一致且足以推导出唯一解的。因此，我们可以开始推导。\n\n该系统由等温等压 ($NPT$) 系综描述，因为它与温度为 $T$ 的热储层和压力为 $p$ 的机械储层接触。此系综中的基本量是等温等压配分函数 $\\Delta$，其定义为对系统所有可能的微观态 $j$ 的求和：\n$$ \\Delta(T, p) = \\sum_{j} \\exp\\left(-\\frac{E_j + pV_j}{k_B T}\\right) $$\n其中 $E_j$ 和 $V_j$ 是系统在微观态 $j$ 时的能量和体积，$k_B$ 是 Boltzmann 常数。为方便起见，定义逆温度 $\\beta = \\frac{1}{k_B T}$。则配分函数为：\n$$ \\Delta(T, p) = \\sum_{j} \\exp(-\\beta(E_j + pV_j)) $$\n该系统的一个微观态由被占据和未被占据的吸附位点的具体构型定义。令 $n$ 为被占据位点的数量，其中 $n$ 的取值范围可以从 $0$ 到总位点数 $M$。\n\n对于任何恰好有 $n$ 个位点被占据的微观态，其内能 $U(n)$ 和体积 $V(n)$ 由下式给出：\n$$ U(n) = -\\epsilon n $$\n$$ V(n) = V_0 + v n $$\nBoltzmann 权重中的项 $E_j + pV_j$ 是焓 $H_j$。对于任何有 $n$ 个位点被占据的微观态，其焓值是相同的：\n$$ H(n) = U(n) + pV(n) = -\\epsilon n + p(V_0 + vn) = pV_0 + n(pv - \\epsilon) $$\n问题指出位点是等效的。在总共 $M$ 个位点中有 $n$ 个被占据的状态所对应的不同微观态的数量（简并度）由二项式系数 $\\binom{M}{n}$ 给出。\n\n现在我们可以通过对被占据位点的数量 $n$ 从 $0$到 $M$ 求和，并将每个 $n$ 的 Boltzmann 权重乘以其简并度来重写配分函数：\n$$ \\Delta(T, p) = \\sum_{n=0}^{M} \\binom{M}{n} \\exp(-\\beta H(n)) $$\n代入 $H(n)$ 的表达式：\n$$ \\Delta(T, p) = \\sum_{n=0}^{M} \\binom{M}{n} \\exp(-\\beta (pV_0 + n(pv - \\epsilon))) $$\n我们可以分离指数项：\n$$ \\Delta(T, p) = \\sum_{n=0}^{M} \\binom{M}{n} \\exp(-\\beta pV_0) \\exp(-\\beta n(pv - \\epsilon)) $$\n项 $\\exp(-\\beta pV_0)$ 与求和指数 $n$ 无关，可以被提出来：\n$$ \\Delta(T, p) = \\exp(-\\beta pV_0) \\sum_{n=0}^{M} \\binom{M}{n} \\left[\\exp(-\\beta (pv - \\epsilon))\\right]^n $$\n该求和现在是二项式定理的形式，$\\sum_{n=0}^{k} \\binom{k}{n} x^n = (1+x)^k$。在这里，我们的 $k$ 是 $M$，我们的 $x$ 是 $\\exp(-\\beta (pv - \\epsilon))$。应用该定理，我们得到配分函数的闭合形式表达式：\n$$ \\Delta(T, p) = \\exp(-\\beta pV_0) \\left[1 + \\exp(-\\beta (pv - \\epsilon))\\right]^M $$\n吉布斯自由能 $G$ 通过基本关系式与等温等压配分函数 $\\Delta$ 相关联：\n$$ G(T, p) = -k_B T \\ln(\\Delta) $$\n代入我们得到的 $\\Delta$ 的表达式：\n$$ G(T, p) = -k_B T \\ln\\left(\\exp(-\\beta pV_0) \\left[1 + \\exp(-\\beta (pv - \\epsilon))\\right]^M\\right) $$\n使用对数的性质 $\\ln(ab) = \\ln(a) + \\ln(b)$ 和 $\\ln(a^b) = b\\ln(a)$：\n$$ G(T, p) = -k_B T \\left[ \\ln(\\exp(-\\beta pV_0)) + \\ln\\left(\\left[1 + \\exp(-\\beta (pv - \\epsilon))\\right]^M\\right) \\right] $$\n$$ G(T, p) = -k_B T \\left[ -\\beta pV_0 + M \\ln\\left(1 + \\exp(-\\beta (pv - \\epsilon))\\right) \\right] $$\n将 $\\beta = 1/(k_B T)$ 代回表达式中：\n$$ G(T, p) = -k_B T \\left[ -\\frac{pV_0}{k_B T} + M \\ln\\left(1 + \\exp\\left(-\\frac{pv - \\epsilon}{k_B T}\\right)\\right) \\right] $$\n分配 $-k_B T$ 项，将表达式简化为其最终形式：\n$$ G(T, p) = pV_0 - M k_B T \\ln\\left(1 + \\exp\\left(\\frac{\\epsilon - pv}{k_B T}\\right)\\right) $$\n\n为了进行定性分析，我们考察 $G(T, p)$ 相对于 $p$ 和 $T$ 的行为。\n\n对压力 $p$ 的依赖性：\n当 $p \\to \\infty$ 时，假设偏摩尔体积增量 $v  0$，则项 $pv$ 远大于 $\\epsilon$。指数的自变量变得非常大且为负：\n$$ \\frac{\\epsilon - pv}{k_B T} \\to -\\infty $$\n这导致指数项趋近于零：\n$$ \\exp\\left(\\frac{\\epsilon - pv}{k_B T}\\right) \\to 0 $$\n对数项则变为 $\\ln(1+0) = 0$。在此极限下，吉布斯自由能趋近于：\n$$ \\lim_{p\\to\\infty} G(T,p) = pV_0 $$\n这个结果在物理上是直观的。在无限高的压力下，系统被压缩到其可能的最小体积，这对应于零占据位点 ($n=0$) 和体积为 $V_0$ 的状态。对于这个基态，吉布斯能变成了机械功项 $pV_0$，因为来自位点占据的熵和内能贡献被抑制了。\n\n对温度 $T$ 的依赖性：\n当 $T \\to \\infty$ 时，逆温度 $\\beta \\to 0$。指数项的自变量趋近于零：\n$$ \\frac{\\epsilon - pv}{k_B T} \\to 0 $$\n这导致指数项趋近于 $\\exp(0) = 1$：\n$$ \\exp\\left(\\frac{\\epsilon - pv}{k_B T}\\right) \\to 1 $$\n对数项则变为 $\\ln(1+1) = \\ln(2)$。在此极限下，吉布斯自由能变为：\n$$ \\lim_{T\\to\\infty} G(T,p) \\approx pV_0 - M k_B T \\ln(2) $$\n吉布斯能成为温度的线性递减函数。这在物理上也是合理的。在无限高的温度下，热能远大于状态之间的能量差（$\\epsilon$ 和 $pv$）。每个 $M$ 位点被占据或为空的可能性变得相等，且彼此独立。这导致了 $2^M$ 个等概率的微观态，以及最大构型熵 $S = k_B \\ln(2^M) = M k_B \\ln(2)$。吉布斯能由熵项 $-TS$ 主导，导致其与 $-T$呈线性关系。",
            "answer": "$$ \\boxed{pV_0 - M k_B T \\ln\\left(1 + \\exp\\left(\\frac{\\epsilon - pv}{k_B T}\\right)\\right)} $$"
        },
        {
            "introduction": "最后的这个实践将从解析推导转向计算实现，旨在探讨统计系综等价性这一微妙而重要的概念。您将通过编程，为一个模拟气体在狭窄孔隙中吸附的实际模型，定量比较正则系综（固定粒子数）和巨正则系综（固定化学势）的差异。本练习不仅将教您如何用计算方法处理复杂的组合计数问题，还将让您深入理解不同统计系综在何种情况下会给出等价的宏观预测——这对于像纳米多孔地质介质这样的有限体系是一个关键考量。",
            "id": "4100028",
            "problem": "考虑中性分子在一个长度为 $M$ 个晶格点的一维窄孔中的吸附，该窄孔代表一种微孔地球化学介质。每个格点最多只能容纳一个吸附物，并且由于窄通道中的空间位阻，任何两个相邻的格点不能同时被占据。每个被占据的格点贡献 $-\\epsilon$ 每摩尔的结合能，该能量与位置无关。该系统在温度 $T$（单位为开尔文）下进行研究，化学势以每摩尔为单位表示。\n\n使用以下统计力学的基础知识：\n\n- 能量为 $E$ 的微观态的玻尔兹曼权重为 $\\exp(-\\beta E)$，其中 $\\beta = 1/(R T)$，$R$ 是理想气体常数，单位为 $\\mathrm{kJ/(mol\\cdot K)}$。\n- 在正则系综 (CE) 中，固定粒子数 $N$ 的配分函数为 $Z_N = \\sum_{\\text{microstates with } N} \\exp(-\\beta E)$，亥姆霍兹自由能为 $F_N = - R T \\ln Z_N$。\n- 在巨正则系综 (GCE) 中，配分函数为 $\\Xi(\\mu) = \\sum_{N=0}^{N_{\\max}} Z_N \\exp(\\beta \\mu N)$，其中 $\\mu$ 是化学势，系综平均满足 $\\langle N \\rangle = \\sum_{N=0}^{N_{\\max}} N \\, Z_N \\exp(\\beta \\mu N) / \\Xi(\\mu)$。\n\n在这个物理现实模型中，由于无相邻占据约束消除了任何对相互作用能，一个构型的能量 $E$ 仅通过 $E(N) = -\\epsilon N$ 依赖于占据的格点数 $N$。在固定的 $M$ 和 $N$ 下，微观态的计数并非易事，因为存在任何两个被占据的格点都不能相邻的约束。\n\n你的任务是：\n\n1. 从上述定义出发，并且不假设任何闭合形式的计数捷径，推导出一个精确的计数方法，用于计算在无相邻占据约束下，$M$ 个格点上有 $N$ 个被占据格点的允许微观态数量。仔细论证你选择实现的递推或构造性计数方法。将这个计数表示为 $g(M,N)$，并注意最大允许占据数为 $N_{\\max} = \\lfloor (M+1)/2 \\rfloor$。\n2. 使用 $g(M,N)$ 和能量 $E(N) = -\\epsilon N$，构造 $Z_N$ 和正则亥姆霍兹自由能 $F_N = -R T \\ln Z_N$。定义增加一个粒子的离散正则化学势为 $\\mu_C(N) = F_N - F_{N-1}$（对于 $N \\geq 1$），并定义 $\\mu_C(0) = F_1 - F_0$。\n3. 使用上述定义构造巨正则配分函数 $\\Xi(\\mu) = \\sum_{N=0}^{N_{\\max}} Z_N \\exp(\\beta \\mu N)$ 和巨正则平均占据数 $\\langle N \\rangle(\\mu)$。使用数值稳定的计算策略，以防极大或极小的指数导致上溢或下溢。\n4. 在给定的 $\\mu$ 下，定义一个系综非等价性的量化度量为 $\\Delta_{\\mu} = |\\mu - \\mu_C(N^{*})|$，其中 $N^{*} = \\operatorname{round}(\\langle N \\rangle(\\mu))$ 是由巨正则系综所暗示的最邻近整数占据数。以 $\\mathrm{kJ/mol}$ 为单位表示 $\\Delta_{\\mu}$。\n5. 实现一个完整的程序，对于下面测试套件中的每一组参数，精确计算所述模型下的 $\\Delta_{\\mu}$。所有能量，包括 $\\epsilon$ 和 $\\mu$，必须以 $\\mathrm{kJ/mol}$ 为单位处理，$T$ 以 $\\mathrm{K}$ 为单位，$R$ 以 $\\mathrm{kJ/(mol\\cdot K)}$ 为单位。\n\n确保覆盖范围的测试套件：\n\n- 情况 1 (正常情况，中等孔径): $M = 50$, $T = 300\\,\\mathrm{K}$, $\\epsilon = 10\\,\\mathrm{kJ/mol}$, $\\mu = 0\\,\\mathrm{kJ/mol}$。\n- 情况 2 (低化学势边界): $M = 50$, $T = 300\\,\\mathrm{K}$, $\\epsilon = 10\\,\\mathrm{kJ/mol}$, $\\mu = -20\\,\\mathrm{kJ/mol}$。\n- 情况 3 (高化学势边界): $M = 50$, $T = 300\\,\\mathrm{K}$, $\\epsilon = 10\\,\\mathrm{kJ/mol}$, $\\mu = 20\\,\\mathrm{kJ/mol}$。\n- 情况 4 (小孔，离散占据边缘效应): $M = 5$, $T = 300\\,\\mathrm{K}$, $\\epsilon = 15\\,\\mathrm{kJ/mol}$, $\\mu = 5\\,\\mathrm{kJ/mol}$。\n\n最终输出格式规范：\n\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述情况的顺序列出结果，例如 $[\\Delta_{\\mu,1},\\Delta_{\\mu,2},\\Delta_{\\mu,3},\\Delta_{\\mu,4}]$，其中每个 $\\Delta_{\\mu,i}$ 是一个以 $\\mathrm{kJ/mol}$ 为单位的浮点数。",
            "solution": "该问题经评估有效，因为它科学地基于已确立的统计力学原理，问题提法清晰，且内部一致。它提出了一个具有最近邻排斥的一维晶格气体标准模型，可以为其构建严谨的解。我们按步骤进行推导和实施计划。\n\n物理系统是一个由 $M$ 个格点组成的一维晶格。吸附的分子被视为占据这些格点的粒子。系统的构型受两条规则约束：每个格点最多一个粒子，且任意两个粒子不能位于相邻格点上。一个微观态的能量完全由被占据的格点数 $N$ 决定，即 $E(N) = -\\epsilon N$，其中 $-\\epsilon$ 是每摩尔的结合能。我们在恒定温度 $T$ 下操作。理想气体常数 $R \\approx 8.31446 \\times 10^{-3} \\, \\mathrm{kJ/(mol\\cdot K)}$，逆热能为 $\\beta = 1/(RT)$。\n\n**1. 微观态的组合计数，$g(M,N)$**\n\n第一个任务是确定将 $N$ 个不可区分的粒子放置在 $M$ 个可区分的晶格点上，且任意两个粒子不相邻的方法数 $g(M,N)$。这是一个经典的组合问题。\n\n考虑 $M$ 个格点上 $N$ 个粒子的一个构型。这留下了 $M-N$ 个空格点。设 $N$ 个粒子的位置由整数 $x_1, x_2, \\ldots, x_N$ 表示，其中 $1 \\le x_1  x_2  \\ldots  x_N \\le M$。无相邻占据约束意味着对所有 $i \\in \\{1, \\ldots, N-1\\}$，都有 $x_{i+1} - x_i \\ge 2$。\n\n为了对这类序列进行计数，我们进行一次变量变换。定义一组新的整数位置 $y_1, y_2, \\ldots, y_N$ 如下：\n$y_i = x_i - (i-1)$，对于 $i \\in \\{1, \\ldots, N\\}$。\n\n我们来检验这个新序列的性质。条件 $x_{i+1}  x_i$ 是不够的，我们必须使用 $x_{i+1} - x_i \\ge 2$。代入新变量：\n$[y_{i+1} + i] - [y_i + (i-1)] \\ge 2$\n$y_{i+1} - y_i + 1 \\ge 2$\n$y_{i+1} - y_i \\ge 1$\n\n这意味着 $y_{i+1}  y_i$。$y_i$ 值的序列是严格递增的。现在，我们来确定 $y_i$ 序列的界限。\n下界是 $y_1 = x_1 - (1-1) = x_1$。由于 $x_1 \\ge 1$，我们有 $y_1 \\ge 1$。\n上界是 $y_N = x_N - (N-1)$。由于 $x_N \\le M$，我们有 $y_N \\le M - (N-1)$。\n\n从一个有效的序列 $\\{x_i\\}$ 到一个序列 $\\{y_i\\}$ 的映射是双射。因此，问题转化为从集合 $\\{1, 2, \\ldots, M - N + 1\\}$ 中选择 $N$ 个不同整数的方法数。这是一个标准的组合问题，其解由二项式系数给出：\n$$g(M,N) = \\binom{M - N + 1}{N}$$\n该公式在 $N \\le M-N+1$ 或 $2N-1 \\le M$ 时有效。如果 $N$ 太大，构型数为零。最大粒子数为 $N_{\\max} = \\lfloor(M+1)/2\\rfloor$。对于 $N  N_{\\max}$，二项式系数的上项变得比下项小，$M-N+1  N$，系数正确地计算为 $0$。\n\n**2. 正则系综物理量**\n\n在正则系综 (CE) 中，对于固定的粒子数 $N$，所有 $g(M,N)$ 个微观态的能量都是简并的，其能量为 $E(N) = -\\epsilon N$。\n\n正则配分函数 $Z_N$ 是对所有具有 $N$ 个粒子的微观态的玻尔兹曼权重求和：\n$$Z_N = \\sum_{\\text{microstates with } N} \\exp(-\\beta E) = g(M,N) \\exp(-\\beta(-\\epsilon N)) = \\binom{M-N+1}{N} \\exp(\\beta \\epsilon N)$$\n对于 $N=0$，我们有一个微观态（空格点）能量为 $E=0$。我们的公式给出 $Z_0 = \\binom{M+1}{0}\\exp(0) = 1$，这是正确的。\n\n亥姆霍兹自由能 $F_N$ 由 $F_N = -RT \\ln Z_N$ 给出：\n$$F_N = -RT \\ln\\left(\\binom{M-N+1}{N} \\exp(\\beta \\epsilon N)\\right) = -RT \\ln\\left(\\binom{M-N+1}{N}\\right) - RT(\\beta \\epsilon N)$$\n由于 $\\beta = 1/(RT)$，这可以简化为：\n$$F_N = -RT \\ln\\left(\\binom{M-N+1}{N}\\right) - \\epsilon N$$\n为了在 $M$ 和 $N$ 很大时保持数值稳定性，项 $\\ln\\binom{n}{k}$ 将使用对数伽马函数 $\\ln(\\Gamma(z))$ 计算，即 $\\ln(n!) - \\ln(k!) - \\ln((n-k)!) = \\ln(\\Gamma(n+1)) - \\ln(\\Gamma(k+1)) - \\ln(\\Gamma(n-k+1))$。\n\n增加第 $N$ 个粒子的离散正则化学势 $\\mu_C(N)$ 定义为亥姆霍兹自由能的变化量：$\\mu_C(N) = F_N - F_{N-1}$（对于 $N \\ge 1$）。对于 $N=0$，问题指定了定义 $\\mu_C(0) = F_1 - F_0$，这与 $\\mu_C(1)$ 等价。\n使用 $F_N$ 的表达式，我们可以为每个所需的 $N$ 计算 $\\mu_C(N)$。\n$F_0 = -RT \\ln\\binom{M+1}{0} - 0 = 0$。\n$F_1 = -RT \\ln\\binom{M}{1} - \\epsilon = -RT \\ln(M) - \\epsilon$。\n因此，$\\mu_C(1) = F_1 - F_0 = -RT \\ln(M) - \\epsilon$。这个值也将是 $\\mu_C(0)$ 的值。\n对于一般情况，为所有 $N \\in [0, N_{\\max}]$ 计算 $F_N$，然后取差值是数值上最稳健的方法。\n\n**3. 巨正则系综物理量**\n\n巨正则 (GCE) 配分函数 $\\Xi(\\mu)$ 是对所有可能的粒子数 $N$ 的求和：\n$$\\Xi(\\mu) = \\sum_{N=0}^{N_{\\max}} Z_N \\exp(\\beta \\mu N) = \\sum_{N=0}^{N_{\\max}} \\binom{M-N+1}{N} \\exp(\\beta \\epsilon N) \\exp(\\beta \\mu N)$$\n$$\\Xi(\\mu) = \\sum_{N=0}^{N_{\\max}} \\binom{M-N+1}{N} \\exp(\\beta (\\mu + \\epsilon) N)$$\n设求和中的项为 $T_N = \\binom{M-N+1}{N} \\exp(\\beta (\\mu + \\epsilon) N)$。这些项可能跨越许多数量级。为避免数值上溢或下溢，我们使用 log-sum-exp 策略。设 $L_N = \\ln(T_N) = \\ln(g(M,N)) + \\beta(\\mu+\\epsilon)N$。设 $L_{\\max} = \\max_{N} \\{L_N\\}$。\n那么 $\\Xi(\\mu) = \\sum_N \\exp(L_N) = \\exp(L_{\\max}) \\sum_N \\exp(L_N - L_{\\max})$。现在这个和是数值稳定的。\n\nGCE 中的平均占据数 $\\langle N \\rangle$ 是：\n$$\\langle N \\rangle(\\mu) = \\frac{\\sum_{N=0}^{N_{\\max}} N Z_N \\exp(\\beta \\mu N)}{\\Xi(\\mu)} = \\frac{\\sum_N N T_N}{\\sum_N T_N}$$\n使用相同的稳定化技术：\n$$\\langle N \\rangle(\\mu) = \\frac{\\sum_N N \\exp(L_N)}{\\sum_N \\exp(L_N)} = \\frac{\\exp(L_{\\max}) \\sum_N N \\exp(L_N - L_{\\max})}{\\exp(L_{\\max}) \\sum_N \\exp(L_N - L_{\\max})} = \\frac{\\sum_N N \\exp(L_N - L_{\\max})}{\\sum_N \\exp(L_N - L_{\\max})}$$\n这提供了一种数值稳定的方法来计算平均占据数。\n\n**4. 系综非等价性度量 $\\Delta_{\\mu}$**\n\n度量 $\\Delta_{\\mu}$ 量化了 GCE 化学势 $\\mu$ 与对应于最可能整数占据数的 CE 离散化学势之间的差异。\n首先，我们计算 GCE 平均占据数 $\\langle N \\rangle(\\mu)$。接下来，我们找到最邻近的整数占据数 $N^{*} = \\operatorname{round}(\\langle N \\rangle(\\mu))$。这代表了由 GCE 描述的有限系统中最可能的粒子数。\n然后，我们检索相应的正则化学势 $\\mu_C(N^*)$，这是在正则系综中添加第 $N^*$ 个粒子所需的自由能成本。\n最后，非等价性计算为绝对差值：\n$$\\Delta_{\\mu} = |\\mu - \\mu_C(N^{*})|$$\n这个度量在有限系统中非零，因为 GCE 代表了对不同 $N$ 值的状态的平均，而 CE 则固定在单个整数 $N$ 上。在热力学极限 ($M \\to \\infty$)下，这种差异将消失。\n\n**5. 测试用例的实现**\n\n对于每个测试用例 $(M, T, \\epsilon, \\mu)$，总体算法如下进行：\n1. 设置常数 $R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ/(mol\\cdot K)}$ 并计算 $\\beta = 1/(RT)$。\n2. 确定 $N_{\\max} = \\lfloor(M+1)/2\\rfloor$ 并创建一个从 $0$到 $N_{\\max}$ 的整数向量 $N$。\n3. 使用 `scipy.special.gammaln` 计算一个 $\\ln(g(M,N))$ 值的数组。\n4. 为所有 $N \\in [0, N_{\\max}]$ 计算一个亥姆霍兹自由能 $F_N$ 的数组。\n5. 通过对 $F_N$ 数组取差值来计算一个正则化学势 $\\mu_C(N)$ 的数组，并按规定处理 $N=0$ 的情况。\n6. 计算 GCE 的对数项 $L_N$ 并使用 log-sum-exp 方法求得 $\\langle N \\rangle(\\mu)$。\n7. 确定 $N^{*} = \\operatorname{round}(\\langle N \\rangle(\\mu))$。\n8. 从预先计算的数组中提取 $\\mu_C(N^{*})$。\n9. 计算并存储 $\\Delta_{\\mu} = |\\mu - \\mu_C(N^{*})|$。\n此过程将应用于所有指定的测试用例以生成最终输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Computes the ensemble non-equivalence measure for adsorption in a 1D pore.\n    \"\"\"\n    # Define physical constant\n    R = 8.314462618e-3  # Ideal gas constant in kJ/(mol*K)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (M, T, epsilon, mu)\n        (50, 300, 10, 0),\n        # Case 2\n        (50, 300, 10, -20),\n        # Case 3\n        (50, 300, 10, 20),\n        # Case 4\n        (5, 300, 15, 5),\n    ]\n\n    results = []\n    for case in test_cases:\n        M, T, epsilon, mu = case\n        \n        # Calculate inverse thermal energy beta\n        beta = 1.0 / (R * T)\n\n        # Maximum number of particles\n        N_max = int(np.floor((M + 1) / 2))\n        N_vals = np.arange(0, N_max + 1, dtype=np.float64)\n\n        # Tasks 1  2: Calculate canonical quantities (F_N and mu_C(N))\n        \n        # Calculate log of combinatorial factor g(M,N) using log-gamma for stability\n        log_g_vals = gammaln(M - N_vals + 2) - gammaln(N_vals + 1) - gammaln(M - 2 * N_vals + 2)\n\n        # Calculate Helmholtz free energy F_N = -RT*ln(Z_N) = -RT*ln(g(M,N)) - epsilon*N\n        F_N_vals = -(1.0 / beta) * log_g_vals - epsilon * N_vals\n\n        # Calculate canonical chemical potential mu_C(N) = F_N - F_{N-1}\n        mu_C_vals = np.zeros(N_max + 1)\n        if N_max > 0:\n            # For N >= 1\n            mu_C_vals[1:] = F_N_vals[1:] - F_N_vals[:-1]\n            # For N = 0, mu_C(0) is defined as F_1 - F_0, same as mu_C(1)\n            mu_C_vals[0] = mu_C_vals[1]\n\n        # Task 3: Calculate grand canonical average occupancy\n        # Using log-sum-exp for numerical stability\n        log_T_N_vals = log_g_vals + beta * (mu + epsilon) * N_vals\n        log_T_max = np.max(log_T_N_vals)\n        norm_T_vals = np.exp(log_T_N_vals - log_T_max)\n        \n        sum_norm_T = np.sum(norm_T_vals)\n        sum_N_norm_T = np.sum(N_vals * norm_T_vals)\n\n        avg_N = sum_N_norm_T / sum_norm_T\n\n        # Task 4  5: Calculate non-equivalence measure Delta_mu\n        N_star = int(np.round(avg_N))\n        \n        # Clamp N_star to be a valid index\n        if N_star > N_max:\n            N_star = N_max\n        if N_star  0:\n            N_star = 0\n            \n        mu_C_N_star = mu_C_vals[N_star]\n        delta_mu = np.abs(mu - mu_C_N_star)\n        results.append(delta_mu)\n\n    # Final output as specified in the problem.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}