{
    "hands_on_practices": [
        {
            "introduction": "在构建热力学数据库时，一个常见的基础性挑战是处理来自不同实验来源（如量热法和平衡研究）的数据，这些数据往往存在不一致性。本练习将介绍一种强大的统计方法——加权最小二乘法（WLS），用于调和这些数据。你将通过施加吉布斯自由能定义（$\\Delta G = \\Delta H - T\\Delta S$）这一基本热力学约束，找到一组在统计意义上最可靠且内部一致的反应性质，从而掌握处理和融合真实世界实验数据的核心技能。",
            "id": "4074686",
            "problem": "您的任务是通过协调两种数据来源（反应焓的量热测量值和反应常数的平衡测量值），为固定压力下的单个矿物反应构建一个最小的、内部一致的热力学数据库片段。该协调过程必须强制满足赫斯定律的一致性，并在加权最小二乘 (WLS) 框架下量化残差。\n\n基本原理：\n- 赫斯定律和状态函数性质意味着，对于在给定温度下的反应，反应吉布斯自由能等于反应焓减去温度乘以反应熵，即 $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\, \\Delta S_{\\mathrm{rxn}} $。\n- 平衡常数与吉布斯自由能之间的关系由 $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $ 给出，其中 $R$ 是理想气体常数。\n- 我们假设参与物种的标准摩尔熵已知，反应熵是它们的化学计量总和，$ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $。在本练习中，反应熵以焦耳/摩尔/开尔文为单位直接给出。\n\n目标：\n- 设 $ \\Delta H_m $ 为测得的反应焓（单位 $\\mathrm{kJ \\, mol^{-1}}$），其标准差为 $ \\sigma_H $；设 $ K_m $ 为在温度 $ T $（单位 $\\mathrm{K}$）下测得的平衡常数，其 $ \\ln K $ 的标准差为 $ \\sigma_{\\ln K} $。使用公式 $ \\Delta G_m = - R T \\ln K_m $ 和 $ \\sigma_G = R T \\sigma_{\\ln K} $，将平衡测量值转换为吉布斯自由能测量值 $ \\Delta G_m $（单位 $\\mathrm{kJ \\, mol^{-1}}$）及其标准差 $ \\sigma_G $，其中 $R$ 以 $\\mathrm{kJ \\, mol^{-1} \\, K^{-1}}$ 表示。\n- 将反应层面的赫斯定律一致性定义为 $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $，其中 $ \\Delta S_{\\mathrm{rxn}} $ 的单位是 $\\mathrm{J \\, mol^{-1} \\, K^{-1}}$，除以 $1000$ 是为了确保单位与 $\\mathrm{kJ \\, mol^{-1}}$ 一致。\n- 通过找到使 WLS 目标函数 $ J = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2 $ 最小化的 $ \\Delta H^\\ast $ 和 $ \\Delta G^\\ast $ 来执行协调，并满足赫斯定律等式约束 $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $，其中权重 $ w_H = 1 / \\sigma_H^2 $ 且 $ w_G = 1 / \\sigma_G^2 $。\n\n每个测试用例的必需输出：\n- 协调后的反应焓 $ \\Delta H^\\ast $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 协调后的反应吉布斯自由能 $ \\Delta G^\\ast $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 焓残差 $ r_H = \\Delta H^\\ast - \\Delta H_m $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 吉布斯自由能残差 $ r_G = \\Delta G^\\ast - \\Delta G_m $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- WLS 范数 $ \\sqrt{ w_H r_H^2 + w_G r_G^2 } $，该值为无量纲，因为每一项都已通过逆方差进行了缩放。\n\n单位与常数：\n- 焓和吉布斯自由能使用 $ \\mathrm{kJ \\, mol^{-1}} $，熵使用 $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $，温度使用 $ \\mathrm{K} $。\n- 使用 $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $。\n\n测试套件：\n为以下参数集提供解决方案，每个参数集以元组 $(\\Delta H_m, \\sigma_H, K_m, \\sigma_{\\ln K}, T, \\Delta S_{\\mathrm{rxn}})$ 的形式表示，并使用指定单位：\n- 情况A（室温下权重均衡）： $( -1.000, 0.300, 2.000, 0.100, 298.150, 3.000 )$。\n- 情况B（焓信息占主导）： $( -1.000, 0.050, 2.000, 0.500, 298.150, 3.000 )$。\n- 情况C（平衡信息占主导）： $( -1.000, 1.000, 2.000, 0.050, 298.150, 3.000 )$。\n- 情况D（与中性平衡冲突）： $( -1.000, 0.200, 1.000, 0.100, 298.150, 2.000 )$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是一个由方括号括起来的、包含五个浮点数的逗号分隔列表，顺序为 $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\sqrt{ w_H r_H^2 + w_G r_G^2 } ]$，每个浮点数格式化为恰好六位小数。例如，输出应类似于 $[[h_A,g_A,rh_A,rg_A,n_A],[h_B,g_B,rh_B,rg_B,n_B],[h_C,g_C,rh_C,rg_C,n_C],[h_D,g_D,rh_D,rg_D,n_D]]$，并用适当的数值替换。",
            "solution": "目标是通过使用加权最小二乘 (WLS) 度量，在赫斯定律的约束下协调量热数据和平衡数据，从而为单个矿物反应构建一个一致的热力学数据库片段。\n\n原理：\n1. 赫斯定律和状态函数性质：对于在温度 $ T $ 下的任何反应，反应吉布斯自由能 $ \\Delta G_{\\mathrm{rxn}} $ 与反应焓 $ \\Delta H_{\\mathrm{rxn}} $ 和反应熵 $ \\Delta S_{\\mathrm{rxn}} $ 的关系为 $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\Delta S_{\\mathrm{rxn}} $。这源于热力学定义 $ \\Delta G = \\Delta H - T \\Delta S $ 以及状态函数在化学计量上的可加性。\n2. 平衡常数关系：实验平衡数据提供 $ K $，它通过 $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $ 与吉布斯自由能相关联。这由基本关系式 $ K = \\exp( - \\Delta G_{\\mathrm{rxn}} / (R T) ) $ 推导而来。\n3. 反应熵：当物种 $ i $ 的标准摩尔熵 $ S_i^\\circ $ 已知时，反应熵是化学计量总和 $ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $。在此问题中，$ \\Delta S_{\\mathrm{rxn}} $ 以 $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $ 为单位直接给出，并通过乘以 $ T $ 再除以 $ 1000 $ 转换为 $ \\mathrm{kJ \\, mol^{-1}} $。\n\n给定测量值：\n- 量热焓 $ \\Delta H_m $ 及其标准差 $ \\sigma_H $。\n- 平衡常数 $ K_m $ 及其在 $ \\ln K $ 上的不确定度 $ \\sigma_{\\ln K} $。转换为 $ \\Delta G_m = - R T \\ln K_m $ 和 $ \\sigma_G = R T \\sigma_{\\ln K} $，单位统一为 $ \\mathrm{kJ \\, mol^{-1}} $。\n\n我们寻求协调后的值 $ \\Delta H^\\ast $ 和 $ \\Delta G^\\ast $，它们使 WLS 目标函数\n$$\nJ = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2,\n$$\n最小化，同时满足赫斯定律等式约束\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - \\frac{T \\, \\Delta S_{\\mathrm{rxn}}}{1000}.\n$$\n此处，权重为 $ w_H = 1 / \\sigma_H^2 $ 和 $ w_G = 1 / \\sigma_G^2 $，确保每个残差都按其逆方差进行缩放。\n\n算法推导：\n- 定义 $ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $，单位为 $ \\mathrm{kJ \\, mol^{-1}} $。约束变为 $ \\Delta G^\\ast = \\Delta H^\\ast - c $。\n- 将约束代入目标函数以消除 $ \\Delta G^\\ast $。我们得到一个关于 $ \\Delta H^\\ast $ 的单变量目标函数：\n$$\nJ( \\Delta H^\\ast ) = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right)^2.\n$$\n- 对 $ \\Delta H^\\ast $ 求导并令其为零，以找到最小值点：\n$$\n\\frac{dJ}{d \\Delta H^\\ast} = 2 w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right) + 2 w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right) = 0.\n$$\n- 求解 $ \\Delta H^\\ast $：\n$$\n\\Delta H^\\ast \\left( w_H + w_G \\right) = w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right),\n$$\n$$\n\\Delta H^\\ast = \\frac{ w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right) }{ w_H + w_G }.\n$$\n- 从约束中恢复 $ \\Delta G^\\ast $：\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - c.\n$$\n- 残差：\n$$\nr_H = \\Delta H^\\ast - \\Delta H_m, \\quad r_G = \\Delta G^\\ast - \\Delta G_m.\n$$\n- WLS 范数（无量纲，因为每一项都已通过逆方差进行缩放）：\n$$\n\\| r \\|_{\\mathrm{WLS}} = \\sqrt{ w_H r_H^2 + w_G r_G^2 }.\n$$\n\n实现细节：\n- 使用 $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $。\n- 对每个测试用例，计算 $ \\Delta G_m = - R T \\ln K_m $、$ \\sigma_G = R T \\sigma_{\\ln K} $、权重 $ w_H $ 和 $ w_G $、$ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $，然后应用上述封闭解。\n- 为每个案例输出列表 $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\| r \\|_{\\mathrm{WLS}} ]$，其中每个值都格式化为恰好六位小数，并将所有案例的列表清单放在单行中输出。\n\n科学真实性：\n- 所选测试用例探讨了信息内容均衡、焓主导和平衡主导的情形，以及一个 $ K_m = 1 $（即 $ \\ln K_m = 0 $）与非零焓值相冲突的场景，为热力学数据库构建中遇到的协调挑战提供了现实的光谱。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K):\n    \"\"\"\n    Perform weighted least squares reconciliation of reaction enthalpy and Gibbs free energy\n    under Hess's law constraint: G* = H* - T*S_rxn/1000.\n\n    Parameters\n    ----------\n    H_meas : float\n        Measured reaction enthalpy (kJ/mol).\n    sigma_H : float\n        Standard deviation of enthalpy measurement (kJ/mol).\n    K_meas : float\n        Measured equilibrium constant (dimensionless).\n    sigma_lnK : float\n        Standard deviation of ln(K) measurement (dimensionless).\n    T : float\n        Temperature (K).\n    S_rxn_J_per_mol_K : float\n        Reaction entropy (J/mol/K).\n\n    Returns\n    -------\n    tuple\n        (H_star, G_star, r_H, r_G, wls_norm)\n        H_star: reconciled enthalpy (kJ/mol)\n        G_star: reconciled Gibbs energy (kJ/mol)\n        r_H: enthalpy residual (kJ/mol)\n        r_G: Gibbs energy residual (kJ/mol)\n        wls_norm: sqrt(w_H*r_H^2 + w_G*r_G^2) (dimensionless)\n    \"\"\"\n    # Ideal Gas Constant in kJ/mol/K\n    R_kJ_per_mol_K = 8.314462618e-3\n\n    # Convert equilibrium measurement to Gibbs energy (kJ/mol)\n    lnK = np.log(K_meas)\n    G_meas = -R_kJ_per_mol_K * T * lnK\n\n    # Propagate uncertainty: sigma_G = R*T*sigma_lnK (kJ/mol)\n    sigma_G = R_kJ_per_mol_K * T * sigma_lnK\n\n    # Weights\n    w_H = 1.0 / (sigma_H ** 2)\n    w_G = 1.0 / (sigma_G ** 2)\n\n    # Hess's law constant term c = T * S_rxn / 1000 (kJ/mol)\n    c = T * S_rxn_J_per_mol_K / 1000.0\n\n    # Closed-form solution for H* and G*\n    numerator = w_H * H_meas + w_G * (G_meas + c)\n    denominator = w_H + w_G\n    H_star = numerator / denominator\n    G_star = H_star - c\n\n    # Residuals\n    r_H = H_star - H_meas\n    r_G = G_star - G_meas\n\n    # Weighted least squares norm (dimensionless)\n    wls_norm = np.sqrt(w_H * (r_H ** 2) + w_G * (r_G ** 2))\n\n    return H_star, G_star, r_H, r_G, wls_norm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K)\n    test_cases = [\n        (-1.000, 0.300, 2.000, 0.100, 298.150, 3.000),  # Case A\n        (-1.000, 0.050, 2.000, 0.500, 298.150, 3.000),  # Case B\n        (-1.000, 1.000, 2.000, 0.050, 298.150, 3.000),  # Case C\n        (-1.000, 0.200, 1.000, 0.100, 298.150, 2.000),  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn = case\n        H_star, G_star, r_H, r_G, norm = reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn)\n        results.append([H_star, G_star, r_H, r_G, norm])\n\n    # Format each float to exactly six decimal places\n    formatted_cases = []\n    for res in results:\n        formatted = \"[\" + \",\".join(f\"{x:.6f}\" for x in res) + \"]\"\n        formatted_cases.append(formatted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个实用的热力学数据库必须能够准确描述反应性质如何随温度变化。本练习将聚焦于一项核心任务：基于反应焓的量热数据来预测平衡常数在不同温度下的值。你将通过对van't Hoff方程进行积分，将离散的焓变（$\\Delta H^\\circ$）测量值转化为连续的平衡常数（$K$）温度依赖模型，从而锻炼你的数值拟合与运用热力学基本定律解决实际问题的能力。",
            "id": "4074687",
            "problem": "您正在为一项将要纳入地球化学热力学数据库的反应构建随温度变化的平衡常数数据。此任务的基本依据是标准吉布斯自由能与平衡常数之间的标准关系、吉布斯-亥姆霍兹关系以及标准反应焓的量热定义。您必须从第一性原理出发，不得假定任何简化公式。从关联平衡常数与标准吉布斯自由能的定义，以及连接吉布斯自由能的温度导数与标准反应焓的基本恒等式出发，推导出一个关于平衡常数自然对数随温度和标准反应焓变化的表达式。使用此表达式，在给定参考温度、参考平衡常数以及标准反应焓随温度变化的量热测量值的情况下，计算目标温度下的平衡常数。假设压力恒定，并采用适用于水地球化学的标准态条件。\n\n您必须实现以下算法步骤：\n- 将量热法得到的标准反应焓数据拟合为温度的 $n=2$ 次多项式，即使用所提供的数据通过最小二乘法将 $\\Delta H_r^\\circ(T)$ 建模为 $\\Delta H_r^\\circ(T) \\approx a_0 + a_1 T + a_2 T^2$。\n- 使用您推导的关系式，将温度导数从已知 $K(T_0)$ 的参考温度 $T_0$ 积分到目标温度 $T$，并通过您的多项式拟合来考虑 $\\Delta H_r^\\circ(T)$ 的温度依赖性。\n- 计算 $K(T)$ 并将其作为实数返回。\n\n物理和数值单位：\n- 温度 $T$ 以 $\\mathrm{K}$ 为单位，并且必须被视为严格的正实数。\n- 标准反应焓 $\\Delta H_r^\\circ$ 以 $\\mathrm{J\\,mol^{-1}}$ 为单位。\n- 普适气体常数 $R$ 必须取值为 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n- 平衡常数 $K$ 是无量纲的。\n\n角度单位与本任务无关。\n\n您的程序应处理以下测试套件，每个测试用例指定为 $\\left(T_0, K(T_0), T, \\{(T_i, \\Delta H_r^\\circ(T_i))\\}_{i=1}^m\\right)$，并产生 $K(T)$ 的值：\n- 测试用例 1 (一般情况，放热且具有温和的温度依赖性): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 100.0$, $T = 450.0\\,\\mathrm{K}$, 数据点 $\\{(298.15, -45000.0), (350.0, -44000.0), (400.0, -43000.0), (500.0, -41000.0)\\}$，单位为 $\\mathrm{J\\,mol^{-1}}$。\n- 测试用例 2 (接近零的焓作为边界条件): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 10.0$, $T = 400.0\\,\\mathrm{K}$, 数据点 $\\{(298.15, 1000.0), (350.0, 500.0), (400.0, 0.0), (500.0, -500.0)\\}$，单位为 $\\mathrm{J\\,mol^{-1}}$。\n- 测试用例 3 (吸热且在高温下具有更强的温度依赖性): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 0.001$, $T = 700.0\\,\\mathrm{K}$, 数据点 $\\{(298.15, 25000.0), (350.0, 26000.0), (400.0, 27000.0), (500.0, 29000.0), (700.0, 32000.0)\\}$，单位为 $\\mathrm{J\\,mol^{-1}}$。\n\n您的程序必须：\n- 对每个测试用例，使用上述数据将 $\\Delta H_r^\\circ(T)$ 拟合为关于 $T$ 的二次多项式。\n- 对每个测试用例，通过将适当的温度导数从 $T_0$ 积分到 $T$ 来计算 $K(T)$。\n- 输出一行，包含一个由逗号分隔的三个 $K(T)$ 值的列表，并用方括号括起来，每个值四舍五入到恰好 $6$ 位小数，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3]$。\n\n需遵守的科学真实性和假设：\n- 根据标准态约定（单位活度）处理活度，该约定与 $1\\,\\mathrm{bar}$ 下的水溶液标准态一致，通过适当选择标准态使平衡常数 $K$ 无量纲。\n- 假设压力恒定，并且 $\\Delta H_r^\\circ(T)$ 代表了与 $K$ 相同的压力和标准态下的标准反应焓。\n- 确保温度保持严格为正，以避免积分中出现奇点。\n\n最终输出格式严格为如上所述的单行，不含任何额外文本。",
            "solution": "该问题要求在给定参考温度 $T_0$ 下的平衡常数值、以及标准反应焓 $\\Delta H_r^\\circ$ 随温度变化的量热数据的情况下，计算目标温度 $T$ 下的平衡常数 $K$。这将通过从化学热力学的第一性原理推导关系式，然后实现推导出的公式来完成。\n\n推导过程始于两个基本的热力学关系。首先，标准反应吉布斯自由能 $\\Delta G_r^\\circ$ 与平衡常数 $K$ 之间的关系为：\n$$ \\Delta G_r^\\circ = -RT \\ln K $$\n其中 $R$ 是普适气体常数，$T$ 是绝对温度。该方程可整理为 $\\ln K$ 或 $\\Delta G_r^\\circ/T$ 的表达式：\n$$ \\frac{\\Delta G_r^\\circ}{T} = -R \\ln K $$\n\n其次，吉布斯-亥姆霍兹方程描述了在恒定压力下吉布斯自由能的温度依赖性：\n$$ \\left( \\frac{\\partial (\\Delta G_r^\\circ / T)}{\\partial T} \\right)_p = -\\frac{\\Delta H_r^\\circ}{T^2} $$\n其中 $\\Delta H_r^\\circ$ 是标准反应焓。\n\n通过将第一个关系式代入吉布斯-亥姆霍兹方程，我们可以找到平衡常数的温度依赖性。按照题目要求假设压力恒定：\n$$ \\frac{d (-R \\ln K)}{dT} = -\\frac{\\Delta H_r^\\circ}{T^2} $$\n由于 $R$ 是一个常数，可以将其移到导数符号之外：\n$$ -R \\frac{d (\\ln K)}{dT} = -\\frac{\\Delta H_r^\\circ}{T^2} $$\n这可以简化为著名的范特霍夫方程：\n$$ \\frac{d (\\ln K)}{dT} = \\frac{\\Delta H_r^\\circ(T)}{RT^2} $$\n\n为了确定在目标温度 $T$ 下的 $K$ 值，我们将此微分方程从参考温度 $T_0$ 积分到 $T$。分离变量可得：\n$$ d(\\ln K) = \\frac{\\Delta H_r^\\circ(T)}{RT^2} dT $$\n将两边从初始状态 $(T_0, K(T_0))$ 积分到最终状态 $(T, K(T))$：\n$$ \\int_{\\ln K(T_0)}^{\\ln K(T)} d(\\ln K') = \\int_{T_0}^{T} \\frac{\\Delta H_r^\\circ(T')}{RT'^2} dT' $$\n方程左边的计算结果为 $\\ln K(T) - \\ln K(T_0)$。整理后得到 $\\ln K(T)$ 的表达式，即范特霍夫方程的积分形式：\n$$ \\ln K(T) = \\ln K(T_0) + \\frac{1}{R} \\int_{T_0}^{T} \\frac{\\Delta H_r^\\circ(T')}{T'^2} dT' $$\n\n问题指定标准反应焓 $\\Delta H_r^\\circ(T)$ 的温度依赖性需通过将给定的量热数据拟合为以下形式的二次多项式来建模：\n$$ \\Delta H_r^\\circ(T) \\approx a_2 T^2 + a_1 T + a_0 $$\n系数 $a_2$、$a_1$ 和 $a_0$ 通过对所提供的数据点 $\\{(T_i, \\Delta H_r^\\circ(T_i))\\}$ 进行线性最小二乘拟合来确定。\n\n将此多项式表达式代入积分中可得：\n$$ \\int_{T_0}^{T} \\frac{a_2 T'^2 + a_1 T' + a_0}{T'^2} dT' = \\int_{T_0}^{T} \\left( a_2 + \\frac{a_1}{T'} + a_0 T'^{-2} \\right) dT' $$\n通过逐项积分可以找到其原函数：\n$$ \\left[ a_2 T' + a_1 \\ln(T') - \\frac{a_0}{T'} \\right] $$\n计算从 $T_0$ 到 $T$ 的定积分，得到一个闭式表达式：\n$$ \\left( a_2 T + a_1 \\ln(T) - \\frac{a_0}{T} \\right) - \\left( a_2 T_0 + a_1 \\ln(T_0) - \\frac{a_0}{T_0} \\right) $$\n$$ = a_2(T - T_0) + a_1(\\ln(T) - \\ln(T_0)) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) $$\n$$ = a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) $$\n\n最后，我们将此结果代回 $\\ln K(T)$ 的方程中：\n$$ \\ln K(T) = \\ln K(T_0) + \\frac{1}{R} \\left[ a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) \\right] $$\n对两边取指数，得到 $K(T)$ 的最终表达式：\n$$ K(T) = \\exp \\left( \\ln K(T) \\right) = K(T_0) \\exp\\left( \\frac{1}{R} \\left[ a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) \\right] \\right) $$\n\n每个测试用例的算法流程如下：\n$1$. 使用提供的温度和焓数据点进行 $n=2$ 次的最小二乘多项式拟合。这确定了系数 $a_2$、$a_1$ 和 $a_0$。\n$2$. 使用这些系数以及参考温度 $T_0$ 和目标温度 $T$ 来计算定积分的解析解。\n$3$. 使用推导出的公式、参考平衡常数 $K(T_0)$ 以及指定的气体常数值 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，计算目标温度下的平衡常数最终值 $K(T)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves for the equilibrium constant K(T) at a target temperature T based on\n    thermodynamic first principles.\n    \"\"\"\n\n    # Universal gas constant in J mol^-1 K^-1\n    R = 8.31446261815324\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: General case, exothermic\n        (298.15, 100.0, 450.0, [\n            (298.15, -45000.0), (350.0, -44000.0), (400.0, -43000.0), (500.0, -41000.0)\n        ]),\n        # Test Case 2: Near-zero enthalpy\n        (298.15, 10.0, 400.0, [\n            (298.15, 1000.0), (350.0, 500.0), (400.0, 0.0), (500.0, -500.0)\n        ]),\n        # Test Case 3: Endothermic with stronger temperature dependence\n        (298.15, 0.001, 700.0, [\n            (298.15, 25000.0), (350.0, 26000.0), (400.0, 27000.0), (500.0, 29000.0), (700.0, 32000.0)\n        ]),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T0, K_T0, T_target, data_points = case\n\n        # Unpack data for polynomial fitting\n        temps = np.array([p[0] for p in data_points])\n        enthalpies = np.array([p[1] for p in data_points])\n\n        # Step 1: Fit delta H_r(T) as a quadratic polynomial\n        # H(T) = a2*T^2 + a1*T + a0\n        # np.polyfit returns coefficients in descending order of power: [a2, a1, a0]\n        coeffs = np.polyfit(temps, enthalpies, 2)\n        a2, a1, a0 = coeffs[0], coeffs[1], coeffs[2]\n\n        # Step 2: Calculate the value of the definite integral part of the equation\n        # Integral = a2*(T - T0) + a1*ln(T/T0) + a0*(1/T0 - 1/T)\n        integral_val = (a2 * (T_target - T0) +\n                        a1 * np.log(T_target / T0) +\n                        a0 * (1.0 / T0 - 1.0 / T_target))\n\n        # Step 3: Compute K(T) using the final derived formula\n        # ln(K(T)) = ln(K(T0)) + (1/R) * integral_val\n        ln_K_T_target = np.log(K_T0) + integral_val / R\n        \n        K_T_target = np.exp(ln_K_T_target)\n        results.append(K_T_target)\n\n    # Format the results to 6 decimal places as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "此最终实践将所有先前概念整合到一个全面而真实的挑战中：构建一个小型但内部完全一致的多物种、多反应体系数据库。你将不再孤立地优化单个反应的性质，而是通过一个多响应、非线性拟合过程，直接确定构成这些反应的*各个物种*的基本热力学参数。这种方法确保了任何涉及这些物种的反应性质都自动满足热力学一致性，是现代热力学数据库构建的基石。",
            "id": "4074664",
            "problem": "要求您在计算地球化学领域为热力学数据库实现一个多响应最小二乘拟合，其中化学物种的拟合参数在不同反应和温度间共享。该拟合必须同时匹配一组反应在不同温度下的平衡常数函数 $K(T)$ 和标准反应焓函数 $\\Delta H^\\circ(T)$，并确保物种参数在整个数据库中保持全局一致性。\n\n从以下基本原理开始：\n- 标准反应吉布斯能与平衡常数的关系为 $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$，其中 $R$ 是普适气体常数。\n- 标准热力学函数之间的关系为 $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$，对于一个反应，$\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T)$ 和 $\\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$，其中 $\\nu_i$ 是物种 $i$ 的化学计量系数（产物为正，反应物为负）。\n- 每个物种依赖于温度的标准焓 $h_i^\\circ(T)$ 和熵 $s_i^\\circ(T)$ 是通过热力学积分，从热容模型 $c_{p,i}(T)$ 和在 $T_{\\text{ref}}$ 处的参考值得出的。\n\n对每个物种 $i$ 采用 Maier–Kelley 热容模型：\n$$c_{p,i}(T) = A_i + B_i T + \\frac{C_i}{T^2},$$\n其中 $A_i$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_i$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_i$ 的单位是 $\\mathrm{J\\,K\\,mol^{-1}}$。设参考温度为 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$。\n\n通过热力学积分，\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i (T - T_{\\text{ref}}) + \\frac{1}{2} B_i (T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right),$$\n其中 $h_i^\\circ(T_{\\text{ref}})$ 的单位是 $\\mathrm{kJ\\,mol^{-1}}$，在计算中需要转换为 $\\mathrm{J\\,mol^{-1}}$。对于熵，\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i (T - T_{\\text{ref}}) - \\frac{1}{2} C_i\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right),$$\n其中 $s_i^\\circ(T_{\\text{ref}})$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。物种的标准吉布斯能为 $g_i^\\circ(T) = h_i^\\circ(T) - T s_i^\\circ(T)$，因此反应的标准吉布斯能为 $\\Delta G^\\circ(T) = \\sum_i \\nu_i g_i^\\circ(T)$ 且 $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$。\n\n您的程序必须构建一个物种参数数据库 $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$，该数据库能同时拟合一组反应在指定温度下的观测值 $K(T)$ 和 $\\Delta H^\\circ(T)$。这是通过最小化跨越两种响应和所有反应的残差加权平方和来实现的。共享的物种参数必须在拟合中跨所有反应和温度保持一致使用。通过除以 $R T$ 将焓残差归一化为无量纲形式，使得两种残差类型都是无量纲的：对每个数据点，组合残差\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T), \\quad r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T},$$\n并在目标函数中对它们的平方求和。使用普适气体常数 $R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。所有内部能量计算必须单位一致；在需要时，以 $\\mathrm{kJ\\,mol^{-1}}$ 报告反应焓。\n\n测试套件的数据由一组已知的“真实”参数生成。您必须使用这些真实参数为每个测试用例生成合成观测数据，然后通过拟合恢复这些参数。使用以下物种和在 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$ 时的真实参数：\n- 物种 $A$：$h_A^\\circ(T_{\\text{ref}}) = -10.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_A^\\circ(T_{\\text{ref}}) = 80.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_A = 30.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_A = 0.020\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_A = 2000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 $B$：$h_B^\\circ(T_{\\text{ref}}) = -20.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_B^\\circ(T_{\\text{ref}}) = 100.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_B = 50.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_B = 0.010\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_B = 1000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 $C$：$h_C^\\circ(T_{\\text{ref}}) = -35.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_C^\\circ(T_{\\text{ref}}) = 150.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_C = 70.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_C = 0.015\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_C = 1500.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 $D$：$h_D^\\circ(T_{\\text{ref}}) = -60.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_D^\\circ(T_{\\text{ref}}) = 180.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_D = 90.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_D = 0.012\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_D = 1800.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n\n使用化学计量系数 $\\nu_i$（产物为正，反应物为负）定义反应：\n- 反应 $\\mathrm{R1}$：$A + B \\rightarrow C$，其中 $\\nu_A = -1$, $\\nu_B = -1$, $\\nu_C = +1$。\n- 反应 $\\mathrm{R2}$：$2 C \\rightarrow D + A$，其中 $\\nu_C = -2$, $\\nu_D = +1$, $\\nu_A = +1$。\n- 反应 $\\mathrm{R3}$：$B + C \\rightarrow D$，其中 $\\nu_B = -1$, $\\nu_C = -1$, $\\nu_D = +1$。\n\n通过使用给定的“真实”参数评估上述热力学模型，为测试套件中的每个反应和每个温度构建合成观测数据 $\\ln K_{\\text{obs}}(T)$ 和 $\\Delta H^\\circ_{\\text{obs}}(T)$。不应添加随机噪声。\n\n使用非线性最小二乘法对全局物种参数矢量实现多响应拟合，并带有边界约束以确保物理合理性：\n- $h_i^\\circ(T_{\\text{ref}})$ 边界，单位 $\\mathrm{kJ\\,mol^{-1}}$：$[-200.0, 50.0]$。\n- $s_i^\\circ(T_{\\text{ref}})$ 边界，单位 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$：$[0.0, 300.0]$。\n- $A_i$ 边界，单位 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$：$[1.0, 200.0]$。\n- $B_i$ 边界，单位 $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$：$[-0.100, 0.100]$。\n- $C_i$ 边界，单位 $\\mathrm{J\\,K\\,mol^{-1}}$：$[-10000.0, 10000.0]$。\n\n使用一个偏离真实参数的初始猜测值，方法是将每个真实参数乘以因子 $1.05$，以测试收敛性和鲁棒性。\n\n测试套件：\n- 案例 1（理想路径）：温度 $[298.15, 600.0, 1000.0, 1200.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}$, $\\mathrm{R2}$, $\\mathrm{R3}$。\n- 案例 2（参考温度下的边界条件）：温度 $[298.15, 310.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}$, $\\mathrm{R3}$。\n- 案例 3（高温边缘）：温度 $[800.0, 1500.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}$, $\\mathrm{R2}$, $\\mathrm{R3}$。\n\n对于每个测试用例，在拟合后计算两个指标：\n- 在该案例中所有反应和温度下 $\\ln K$ 的均方根误差 (RMSE)（无量纲）。\n- 在该案例中所有反应和温度下 $\\Delta H^\\circ$ 的均方根误差 (RMSE)，以 $\\mathrm{kJ\\,mol^{-1}}$ 表示。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个方括号括起来的逗号分隔列表，每个元素是按案例 1、2、3 顺序排列的测试用例的双元素列表。每个内部列表必须是 $[\\mathrm{RMSE}_{\\ln K}, \\mathrm{RMSE}_{\\Delta H^\\circ \\mathrm{(kJ/mol)}}]$。例如，输出必须具有形式 $[[x_1,y_1],[x_2,y_2],[x_3,y_3]]$，其中 $x_i$ 和 $y_i$ 是浮点数。",
            "solution": "该问题要求实现一个多响应、非线性最小二乘拟合程序，以确定跨越多个化学反应和温度的多个化学物种的一组一致的热力学参数。解决方案按几个逻辑上独立的步骤进行：定义热力学正向模型，构建全局参数优化结构，生成合成数据，为每个测试用例执行优化，最后计算所需的误差指标。\n\n首先，我们建立数学框架。问题的核心在于每个物种 $i$ 依赖于温度的热力学性质。标准焓 $h_i^\\circ(T)$ 和标准熵 $s_i^\\circ(T)$ 由 Maier-Kelley 热容模型 $c_{p,i}(T) = A_i + B_i T + C_i/T^2$ 导出。通过从参考温度 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$ 进行热力学积分，我们得到 $h_i^\\circ(T)$ 和 $s_i^\\circ(T)$ 的表达式：\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i(T - T_{\\text{ref}}) + \\frac{B_i}{2}(T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right)$$\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i(T - T_{\\text{ref}}) - \\frac{C_i}{2}\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right)$$\n在这里，待拟合的物种参数集为 $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$。请注意，为了内部一致性，需要将 $h_i^\\circ(T_{\\text{ref}})$ 的单位从 $\\mathrm{kJ\\,mol^{-1}}$ 转换为 $\\mathrm{J\\,mol^{-1}}$。\n\n对于任何给定的反应，标准焓变 $\\Delta H^\\circ(T)$ 和熵变 $\\Delta S^\\circ(T)$ 是通过将物种性质乘以其化学计量系数 $\\nu_i$ 后求和计算的：\n$$\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T) \\quad \\text{和} \\quad \\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$$\n由此，可以找到标准吉布斯能变 $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$，它直接与平衡常数 $K(T)$ 及其对数相关：\n$$\\ln K(T) = -\\frac{\\Delta G^\\circ(T)}{RT}$$\n其中 $R$ 是普适气体常数。这些方程构成了我们的“正向模型”，它从一组给定的物种参数预测可观测量 $\\ln K(T)$ 和 $\\Delta H^\\circ(T)$。\n\n优化的目标是找到能最好地再现“观测”数据的参数集。由于给定物种（例如，物种 'A'）的参数必须相同，无论它参与哪个反应，我们定义一个单一的全局参数矢量 $\\mathbf{P}$。该矢量连接了四个物种（$A$、$B$、$C$、$D$）中每个物种的五个参数，从而形成一个 $20$ 维的优化问题。\n$$\\mathbf{P} = [h_{A}^{\\circ,\\text{ref}}, s_{A}^{\\circ,\\text{ref}}, A_A, B_A, C_A, \\dots, h_{D}^{\\circ,\\text{ref}}, s_{D}^{\\circ,\\text{ref}}, A_D, B_D, C_D]^T$$\n优化过程最小化残差的平方和。对于每个数据点（特定温度下的特定反应），我们有两种类型的残差，它们被归一化为无量纲：\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T)$$\n$$r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T}$$\n`scipy.optimize.least_squares` 例程的目标函数将是一个接受全局参数矢量 $\\mathbf{P}$ 并返回一个包含给定测试用例中所有反应和温度的所有 $r_K$ 和 $r_H$ 残差的单一扁平数组的函数。\n\n总体算法如下：\n1.  对于每个测试用例，定义要拟合的反应和温度集。这构成了一个（反应，温度）对的列表。\n2.  使用以所提供的“真实”物种参数评估的正向模型，为每对生成合成的“观测”数据（$\\ln K_{\\text{obs}}$ 和 $\\Delta H^\\circ_{\\text{obs}}$）。\n3.  通过将真实参数乘以因子 $1.05$ 来建立优化的初始猜测值。为 $\\mathbf{P}$ 构建相应的下界和上界矢量。\n4.  调用 `scipy.optimize.least_squares`，传入目标函数、初始猜测值、边界以及必要的数据（反应-温度对和观测数据）。信赖域反射算法（`trf`）适用于这个有界约束的问题。\n5.  一旦优化收敛，得到的优化参数矢量 $\\mathbf{P}_{\\text{fit}}$ 用于重新计算模型预测值 $\\ln K_{\\text{fit}}$ 和 $\\Delta H^\\circ_{\\text{fit}}$。\n6.  拟合的性能通过两个指标来量化：$\\ln K$ 的均方根误差（RMSE）和 $\\Delta H^\\circ$ 的均方根误差。对于后者，残差（$\\Delta H^\\circ_{\\text{fit}} - \\Delta H^\\circ_{\\text{obs}}$）的单位是 $\\mathrm{J\\,mol^{-1}}$，在计算 RMSE 之前必须转换为 $\\mathrm{kJ\\,mol^{-1}}$。\n7.  计算出的每个测试用例的 RMSE 值被收集并格式化为指定的最终输出字符串。\n由于合成数据不含噪声，成功的实现应该能够恢复真实参数，从而得到接近于零的 RMSE 值，其精度仅受优化器的数值精度和容差设置的限制。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\n# Define constants and reference values as specified in the problem\nR_GAS = 8.314462618  # Universal gas constant in J mol^-1 K^-1\nT_REF = 298.15      # Reference temperature in K\n\n# Define species and their \"true\" thermodynamic parameters\nSPECIES_NAMES = ['A', 'B', 'C', 'D']\n# Parameters are: h_ref (kJ/mol), s_ref (J/mol/K), A (J/mol/K), B (J/mol/K^2), C (J*K/mol)\nTRUE_PARAMS_DICT = {\n    'A': np.array([-10.0, 80.0, 30.0, 0.020, 2000.0]),\n    'B': np.array([-20.0, 100.0, 50.0, 0.010, 1000.0]),\n    'C': np.array([-35.0, 150.0, 70.0, 0.015, 1500.0]),\n    'D': np.array([-60.0, 180.0, 90.0, 0.012, 1800.0]),\n}\n# Flatten the parameters into a single global vector P\nTRUE_PARAMS_FLAT = np.concatenate([TRUE_PARAMS_DICT[name] for name in SPECIES_NAMES])\n\n# Define reaction stoichiometries\nREACTIONS = {\n    'R1': {'A': -1, 'B': -1, 'C': 1, 'D': 0},  # A + B -> C\n    'R2': {'A': 1, 'B': 0, 'C': -2, 'D': 1},  # 2C -> D + A\n    'R3': {'A': 0, 'B': -1, 'C': -1, 'D': 1},  # B + C -> D\n}\n\n# Define parameter bounds for the optimization\nBOUNDS_MIN_PER_SPECIES = np.array([-200.0, 0.0, 1.0, -0.100, -10000.0])\nBOUNDS_MAX_PER_SPECIES = np.array([50.0, 300.0, 200.0, 0.100, 10000.0])\nLOWER_BOUNDS = np.tile(BOUNDS_MIN_PER_SPECIES, len(SPECIES_NAMES))\nUPPER_BOUNDS = np.tile(BOUNDS_MAX_PER_SPECIES, len(SPECIES_NAMES))\nOPTIMIZATION_BOUNDS = (LOWER_BOUNDS, UPPER_BOUNDS)\n\ndef _unpack_params(p_flat):\n    \"\"\"Unpacks the flat global parameter vector into a dictionary.\"\"\"\n    params = {}\n    for i, name in enumerate(SPECIES_NAMES):\n        params[name] = p_flat[i*5 : (i+1)*5]\n    return params\n\ndef _calculate_properties_for_case(p_flat, rxn_T_pairs):\n    \"\"\"\n    The forward model: calculates ln(K) and dH for a set of reaction-temperature pairs.\n    \"\"\"\n    species_params = _unpack_params(p_flat)\n    \n    num_points = len(rxn_T_pairs)\n    lnK_model = np.zeros(num_points)\n    dH_model_J_mol = np.zeros(num_points)\n\n    # Pre-calculate species properties at all unique temperatures to avoid redundant computations\n    unique_temps = sorted(list(set(T for _, T in rxn_T_pairs)))\n    h_species_cache = {name: {} for name in SPECIES_NAMES}\n    s_species_cache = {name: {} for name in SPECIES_NAMES}\n\n    for name in SPECIES_NAMES:\n        h_ref_kJ, s_ref, A, B, C = species_params[name]\n        h_ref_J = h_ref_kJ * 1000.0  # Convert enthalpy from kJ/mol to J/mol\n\n        for T in unique_temps:\n            # Enthalpy (J/mol)\n            h_T = (h_ref_J + A * (T - T_REF) + 0.5 * B * (T**2 - T_REF**2)\n                   - C * (1.0/T - 1.0/T_REF))\n            h_species_cache[name][T] = h_T\n            \n            # Entropy (J/mol/K)\n            s_T = (s_ref + A * np.log(T / T_REF) + B * (T - T_REF)\n                   - 0.5 * C * (1.0/T**2 - 1.0/T_REF**2))\n            s_species_cache[name][T] = s_T\n    \n    for i, (rxn_name, T) in enumerate(rxn_T_pairs):\n        reaction_stoich = REACTIONS[rxn_name]\n        \n        dH_rxn = 0.0\n        dS_rxn = 0.0\n        \n        for species_name, nu in reaction_stoich.items():\n            if nu != 0:\n                dH_rxn += nu * h_species_cache[species_name][T]\n                dS_rxn += nu * s_species_cache[species_name][T]\n        \n        dG_rxn = dH_rxn - T * dS_rxn\n        lnK_calc = -dG_rxn / (R_GAS * T)\n        \n        lnK_model[i] = lnK_calc\n        dH_model_J_mol[i] = dH_rxn\n        \n    return lnK_model, dH_model_J_mol\n\ndef _residuals_fn(p_flat, rxn_T_pairs, obs_lnK, obs_dH):\n    \"\"\"\n    Objective function for least_squares, returning a flattened array of residuals.\n    \"\"\"\n    T_vals = np.array([T for _, T in rxn_T_pairs])\n    model_lnK, model_dH = _calculate_properties_for_case(p_flat, rxn_T_pairs)\n    \n    r_K = model_lnK - obs_lnK\n    r_H = (model_dH - obs_dH) / (R_GAS * T_vals)\n    \n    return np.concatenate((r_K, r_H))\n\ndef solve():\n    \"\"\"Main function to run the test suite and produce the final output.\"\"\"\n    test_cases = [\n        ({'temps': [298.15, 600.0, 1000.0, 1200.0], 'reactions': ['R1', 'R2', 'R3']}),\n        ({'temps': [298.15, 310.0], 'reactions': ['R1', 'R3']}),\n        ({'temps': [800.0, 1500.0], 'reactions': ['R1', 'R2', 'R3']}),\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        temps = case['temps']\n        rxns = case['reactions']\n        \n        # 1. Generate synthetic \"observed\" data using the true parameters\n        rxn_T_pairs = sorted([(r, T) for r in rxns for T in temps]) # Sort for consistent ordering\n        obs_lnK, obs_dH = _calculate_properties_for_case(TRUE_PARAMS_FLAT, rxn_T_pairs)\n        \n        # 2. Set up initial guess (offset from true values) and bounds\n        p0 = TRUE_PARAMS_FLAT * 1.05\n        \n        # 3. Perform the non-linear least-squares fit\n        result = least_squares(\n            _residuals_fn,\n            p0,\n            bounds=OPTIMIZATION_BOUNDS,\n            args=(rxn_T_pairs, obs_lnK, obs_dH),\n            method='trf',\n            ftol=1e-15,\n            xtol=1e-15,\n            gtol=1e-15\n        )\n        p_fit = result.x\n        \n        # 4. Calculate final model predictions with the fitted parameters\n        fit_lnK, fit_dH_J = _calculate_properties_for_case(p_fit, rxn_T_pairs)\n        \n        # 5. Calculate Root Mean Square Error (RMSE) metrics\n        # RMSE for ln(K) (dimensionless)\n        rmse_lnK = np.sqrt(np.mean((fit_lnK - obs_lnK)**2))\n        \n        # RMSE for dH (in kJ/mol)\n        dH_residuals_kJ = (fit_dH_J - obs_dH) / 1000.0\n        rmse_dH = np.sqrt(np.mean(dH_residuals_kJ**2))\n        \n        final_results.append([rmse_lnK, rmse_dH])\n\n    # 6. Format the final output string exactly as required\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}