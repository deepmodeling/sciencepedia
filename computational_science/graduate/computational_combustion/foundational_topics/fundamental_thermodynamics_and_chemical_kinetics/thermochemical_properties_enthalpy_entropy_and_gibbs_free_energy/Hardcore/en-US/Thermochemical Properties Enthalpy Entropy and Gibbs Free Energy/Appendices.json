{
    "hands_on_practices": [
        {
            "introduction": "In computational combustion, accurately representing the thermochemical state of a gas mixture is the first and most fundamental step. This practice provides hands-on experience with the cornerstone of this process: using the widely adopted NASA 7-coefficient polynomials to calculate the molar heat capacity ($c_p$), enthalpy ($h$), and entropy ($s$) for individual species and ideal-gas mixtures. Mastering this foundational skill is essential, as these properties are the inputs for virtually all subsequent calculations, from chemical kinetics to energy conservation .",
            "id": "4071841",
            "problem": "Consider an ideal-gas methane–air mixture at temperature $T = 1000\\,\\mathrm{K}$ and pressure $p = 1\\,\\mathrm{bar}$. The mixture contains species methane $\\mathrm{CH_4}$, oxygen $\\mathrm{O_2}$, and nitrogen $\\mathrm{N_2}$ with given mole fractions $x_i$. Use the National Aeronautics and Space Administration (NASA) seven-coefficient polynomial representation for ideal-gas species thermochemical properties in the high-temperature range (valid for $1000\\,\\mathrm{K} \\le T \\le 6000\\,\\mathrm{K}$), summarized as follows for a species with coefficients $\\{a_1,a_2,a_3,a_4,a_5,a_6,a_7\\}$:\n- Heat capacity at constant pressure per mole: $$\\frac{c_{p,i}(T)}{R} = a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4.$$\n- Enthalpy per mole: $$\\frac{h_i(T)}{R\\,T} = a_1 + a_2 \\frac{T}{2} + a_3 \\frac{T^2}{3} + a_4 \\frac{T^3}{4} + a_5 \\frac{T^4}{5} + a_6 \\frac{1}{T}.$$\n- Standard molar entropy at the standard pressure $p_0 = 1\\,\\mathrm{bar}$: $$\\frac{s_i^0(T)}{R} = a_1 \\ln T + a_2 T + a_3 \\frac{T^2}{2} + a_4 \\frac{T^3}{3} + a_5 \\frac{T^4}{4} + a_7.$$\nHere $R$ is the universal gas constant.\n\nFor an ideal-gas mixture, the mixture properties at $(T,p)$ are defined by the classical ideal-mixture rules consistent with Statistical Thermodynamics and the concept of partial pressures. The mixture molar heat capacity at constant pressure $c_{p,\\mathrm{mix}}(T)$ and the mixture molar enthalpy $h_{\\mathrm{mix}}(T)$ are mole-fraction-weighted sums of species properties. The mixture molar entropy $s_{\\mathrm{mix}}(T,p,\\{x_i\\})$ includes the ideal mixing contribution derived from the species partial pressures. You must express $c_{p,\\mathrm{mix}}$ in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $h_{\\mathrm{mix}}$ in $\\mathrm{kJ\\,mol^{-1}}$, and $s_{\\mathrm{mix}}$ in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$. Use $R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ and $p_0 = 1\\,\\mathrm{bar}$. Assume $p = p_0$.\n\nUse the following high-temperature NASA polynomial coefficients (valid for $1000\\,\\mathrm{K} \\le T \\le 6000\\,\\mathrm{K}$):\n- $\\mathrm{CH_4}$: $a_1 = 7.48514950\\times 10^{-2}$, $a_2 = 1.33909467\\times 10^{-2}$, $a_3 = -5.73285829\\times 10^{-6}$, $a_4 = 1.22292535\\times 10^{-9}$, $a_5 = -1.01815230\\times 10^{-13}$, $a_6 = -1.00099753\\times 10^{4}$, $a_7 = 1.84373180\\times 10^{1}$.\n- $\\mathrm{O_2}$: $a_1 = 3.28253784$, $a_2 = 1.48308754\\times 10^{-3}$, $a_3 = -7.57966669\\times 10^{-7}$, $a_4 = 2.09470555\\times 10^{-10}$, $a_5 = -2.16717794\\times 10^{-14}$, $a_6 = -1.08845772\\times 10^{3}$, $a_7 = 5.45323129$.\n- $\\mathrm{N_2}$: $a_1 = 2.95257626$, $a_2 = 1.39690040\\times 10^{-3}$, $a_3 = -4.92631603\\times 10^{-7}$, $a_4 = 7.86010367\\times 10^{-11}$, $a_5 = -4.60700342\\times 10^{-15}$, $a_6 = -9.23948688\\times 10^{2}$, $a_7 = 5.87188762$.\n\nInstruction on mixture entropy: For $p = p_0$, the mixture molar entropy is the sum of species standard entropies at $T$ minus the ideal mixing term based on mole fractions, consistent with the definition from partial pressures. Treat the mathematical limit $x_i \\ln x_i$ as $0$ when $x_i = 0$.\n\nYour program must compute, for each specified test case, the triple $\\left[c_{p,\\mathrm{mix}}(T), h_{\\mathrm{mix}}(T), s_{\\mathrm{mix}}(T,p)\\right]$ using the above principles and coefficients. The temperature and pressure are fixed at $T = 1000\\,\\mathrm{K}$ and $p = 1\\,\\mathrm{bar}$ for all tests.\n\nTest suite (each item is $(x_{\\mathrm{CH_4}}, x_{\\mathrm{O_2}}, x_{\\mathrm{N_2}})$):\n- Case $1$ (stoichiometric methane–air reactant mixture at $T=1000\\,\\mathrm{K}$): $x_{\\mathrm{CH_4}} = \\frac{1}{10.5238095238} \\approx 0.0950$, $x_{\\mathrm{O_2}} = \\frac{2}{10.5238095238} \\approx 0.1900$, $x_{\\mathrm{N_2}} = \\frac{7.5238095238}{10.5238095238} \\approx 0.7150$.\n- Case $2$ (pure methane): $x_{\\mathrm{CH_4}} = 1.0$, $x_{\\mathrm{O_2}} = 0.0$, $x_{\\mathrm{N_2}} = 0.0$.\n- Case $3$ (dry air baseline): $x_{\\mathrm{CH_4}} = 0.0$, $x_{\\mathrm{O_2}} = 0.21$, $x_{\\mathrm{N_2}} = 0.79$.\n- Case $4$ (lean methane in air): $x_{\\mathrm{CH_4}} = 0.02$, $x_{\\mathrm{O_2}} = 0.2058$, $x_{\\mathrm{N_2}} = 0.7742$.\n- Case $5$ (pure oxygen): $x_{\\mathrm{CH_4}} = 0.0$, $x_{\\mathrm{O_2}} = 1.0$, $x_{\\mathrm{N_2}} = 0.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a comma-separated list of three floats in the order $\\left[c_{p,\\mathrm{mix}}\\,(\\mathrm{J\\,mol^{-1}\\,K^{-1}}), h_{\\mathrm{mix}}\\,(\\mathrm{kJ\\,mol^{-1}}), s_{\\mathrm{mix}}\\,(\\mathrm{J\\,mol^{-1}\\,K^{-1}})\\right]$. For example, the final line must look like $\\left[\\left[c_1,h_1,s_1\\right],\\left[c_2,h_2,s_2\\right],\\dots\\right]$.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be valid. It is scientifically grounded in the principles of chemical thermodynamics, is well-posed, and contains all necessary information to compute a unique and verifiable solution. The data provided, including the NASA polynomial coefficients and the composition of the test mixtures, is consistent with established standards in the field of combustion.\n\nThe solution to this problem involves a two-stage computational process. First, the molar thermochemical properties—specifically, the constant-pressure heat capacity ($c_{p,i}$), enthalpy ($h_i$), and standard-state entropy ($s_i^0$)—of each individual gas species ($i$) are calculated at the specified temperature $T = 1000\\,\\mathrm{K}$. Second, these species-specific properties are combined using ideal-gas mixture rules to determine the corresponding properties of the mixture ($c_{p,\\mathrm{mix}}$, $h_{\\mathrm{mix}}$, $s_{\\mathrm{mix}}$) for each set of given mole fractions $\\{x_i\\}$.\n\nThe foundational constants and parameters for this analysis are:\n- Universal gas constant, $R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n- Temperature, $T = 1000\\,\\mathrm{K}$.\n- System pressure, $p = 1\\,\\mathrm{bar}$.\n- Standard-state pressure, $p_0 = 1\\,\\mathrm{bar}$.\n\n**Part 1: Calculation of Species-Specific Thermochemical Properties**\n\nThe properties for each species $i \\in \\{\\mathrm{CH_4}, \\mathrm{O_2}, \\mathrm{N_2}\\}$ are calculated using the provided seven-coefficient NASA polynomial expressions. These polynomials give dimensionless forms of the properties, which are then converted to their final dimensional values. The temperature $T = 1000\\,\\mathrm{K}$ falls within the specified high-temperature validity range for the given coefficients.\n\nThe molar heat capacity at constant pressure, $c_{p,i}(T)$, is computed as:\n$$\nc_{p,i}(T) = R \\left( a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4 \\right)\n$$\nThe resulting unit is $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n\nThe molar enthalpy, $h_i(T)$, is computed as:\n$$\nh_i(T) = R T \\left( a_1 + a_2 \\frac{T}{2} + a_3 \\frac{T^2}{3} + a_4 \\frac{T^3}{4} + a_5 \\frac{T^4}{5} + a_6 \\frac{1}{T} \\right)\n$$\nThe resulting unit is $\\mathrm{J\\,mol^{-1}}$. This value represents the sum of the standard-state enthalpy of formation at the reference temperature ($298.15\\,\\mathrm{K}$) and the sensible enthalpy change from the reference temperature to the system temperature $T$.\n\nThe standard molar entropy, $s_i^0(T)$, which is the entropy at the standard pressure $p_0=1\\,\\mathrm{bar}$, is computed as:\n$$\ns_i^0(T) = R \\left( a_1 \\ln T + a_2 T + a_3 \\frac{T^2}{2} + a_4 \\frac{T^3}{3} + a_5 \\frac{T^4}{4} + a_7 \\right)\n$$\nThe resulting unit is $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n\n**Part 2: Calculation of Mixture Properties**\n\nFor an ideal-gas mixture, the extensive properties are mole-fraction-weighted sums of the species properties.\n\nThe mixture molar heat capacity at constant pressure, $c_{p,\\mathrm{mix}}(T)$, is given by:\n$$\nc_{p,\\mathrm{mix}}(T) = \\sum_{i} x_i c_{p,i}(T)\n$$\nwhere $x_i$ is the mole fraction of species $i$. The unit is $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n\nThe mixture molar enthalpy, $h_{\\mathrm{mix}}(T)$, is similarly given by:\n$$\nh_{\\mathrm{mix}}(T) = \\sum_{i} x_i h_i(T)\n$$\nThe result is calculated in $\\mathrm{J\\,mol^{-1}}$ and subsequently converted to $\\mathrm{kJ\\,mol^{-1}}$ by dividing by $1000$ to meet the output requirement.\n\nThe mixture molar entropy, $s_{\\mathrm{mix}}(T, p, \\{x_i\\})$, for an ideal-gas mixture is given by the sum of the partial entropies:\n$$\ns_{\\mathrm{mix}}(T, p, \\{x_i\\}) = \\sum_{i} x_i s_i(T, p_i)\n$$\nwhere $p_i = x_i p$ is the partial pressure of species $i$. The entropy of a single ideal gas species $i$ at pressure $p_i$ is related to its standard-state entropy $s_i^0(T)$ by:\n$$\ns_i(T, p_i) = s_i^0(T) - R \\ln\\left(\\frac{p_i}{p_0}\\right)\n$$\nSubstituting $p_i = x_i p$ and combining these gives the full expression for the mixture entropy:\n$$\ns_{\\mathrm{mix}}(T, p, \\{x_i\\}) = \\sum_{i} x_i \\left( s_i^0(T) - R \\ln\\left(\\frac{x_i p}{p_0}\\right) \\right) = \\sum_{i} x_i s_i^0(T) - R \\sum_{i} x_i \\ln x_i - R \\ln\\left(\\frac{p}{p_0}\\right)\n$$\nThe problem specifies that the system pressure $p$ is equal to the standard pressure $p_0$, i.e., $p = p_0 = 1\\,\\mathrm{bar}$. This simplifies the final term, as $\\ln(p/p_0) = \\ln(1) = 0$. Therefore, the required mixture entropy is:\n$$\ns_{\\mathrm{mix}}(T, p_0, \\{x_i\\}) = \\sum_{i} x_i s_i^0(T) - R \\sum_{i} x_i \\ln x_i\n$$\nThe term $- R \\sum_{i} x_i \\ln x_i$ is the ideal entropy of mixing. For computational purposes, when a mole fraction $x_i = 0$, the term $x_i \\ln x_i$ is taken to be its mathematical limit, which is $0$. The final unit for $s_{\\mathrm{mix}}$ is $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n\nThe computational algorithm proceeds by first calculating and storing the properties $(c_{p,i}, h_i, s_i^0)$ for $\\mathrm{CH_4}$, $\\mathrm{O_2}$, and $\\mathrm{N_2}$ at $T = 1000\\,\\mathrm{K}$. Then, for each of the five test cases, it applies the mole-fraction-weighted summation rules described above to compute the final mixture properties $[c_{p,\\mathrm{mix}}, h_{\\mathrm{mix}}, s_{\\mathrm{mix}}]$, ensuring the final enthalpy is in the correct units.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes thermochemical properties for methane-air mixtures using NASA polynomials.\n    \"\"\"\n\n    # Universal gas constant in J mol-1 K-1\n    UNIVERSAL_GAS_CONSTANT = 8.314462618\n\n    # Fixed temperature for all calculations\n    TEMPERATURE = 1000.0  # in K\n\n    # NASA 7-coefficient polynomial data for high-temperature range (1000 K = T = 6000 K)\n    # The species are CH4, O2, N2\n    # Coefficients are {a1, a2, a3, a4, a5, a6, a7}\n    NASA_COEFFICIENTS = {\n        'CH4': [\n            7.48514950e-02, 1.33909467e-02, -5.73285829e-06, 1.22292535e-09,\n            -1.01815230e-13, -1.00099753e+04, 1.84373180e+01\n        ],\n        'O2': [\n            3.28253784e+00, 1.48308754e-03, -7.57966669e-07, 2.09470555e-10,\n            -2.16717794e-14, -1.08845772e+03, 5.45323129e+00\n        ],\n        'N2': [\n            2.95257626e+00, 1.39690040e-03, -4.92631603e-07, 7.86010367e-11,\n            -4.60700342e-15, -9.23948688e+02, 5.87188762e+00\n        ]\n    }\n\n    # Test suite: mole fractions (x_CH4, x_O2, x_N2)\n    # Using exact fractions where available for precision\n    test_cases = [\n        # Case 1: Stoichiometric methane–air\n        (21.0/221.0, 42.0/221.0, 158.0/221.0),\n        # Case 2: Pure methane\n        (1.0, 0.0, 0.0),\n        # Case 3: Dry air\n        (0.0, 0.21, 0.79),\n        # Case 4: Lean methane in air\n        (0.02, 0.2058, 0.7742),\n        # Case 5: Pure oxygen\n        (0.0, 1.0, 0.0),\n    ]\n\n    species_list = ['CH4', 'O2', 'N2']\n    \n    # Pre-calculate powers of T for efficiency\n    T = TEMPERATURE\n    T_powers = np.array([T, T**2, T**3, T**4])\n    ln_T = np.log(T)\n    R = UNIVERSAL_GAS_CONSTANT\n\n    # Calculate and store individual species properties at T=1000 K\n    species_properties = {}\n    for species, coeffs in NASA_COEFFICIENTS.items():\n        a = np.array(coeffs)\n        \n        # Molar heat capacity: cp = R * (a1 + a2*T + a3*T^2 + a4*T^3 + a5*T^4)\n        cp_over_R = a[0] + np.dot(a[1:5], T_powers)\n        cp_i = cp_over_R * R\n\n        # Molar enthalpy: h = R*T * (a1 + a2*T/2 + a3*T^2/3 + a4*T^3/4 + a5*T^4/5 + a6/T)\n        h_over_RT = a[0] + np.dot(a[1:5], T_powers / np.arange(2, 6)) + a[5] / T\n        h_i = h_over_RT * R * T\n\n        # Standard molar entropy: s0 = R * (a1*ln(T) + a2*T + a3*T^2/2 + a4*T^3/3 + a5*T^4/4 + a7)\n        s0_over_R = a[0] * ln_T + np.dot(a[1:5], T_powers / np.arange(1, 5)) + a[6]\n        s0_i = s0_over_R * R\n\n        species_properties[species] = {'cp': cp_i, 'h': h_i, 's0': s0_i}\n\n    results = []\n    for mole_fraction_tuple in test_cases:\n        mole_fractions = dict(zip(species_list, mole_fraction_tuple))\n\n        cp_mix = 0.0\n        h_mix = 0.0\n        s0_mix_sum = 0.0\n        entropy_of_mixing_term = 0.0\n\n        for species, x_i in mole_fractions.items():\n            if x_i > 0:\n                props = species_properties[species]\n                cp_mix += x_i * props['cp']\n                h_mix += x_i * props['h']\n                s0_mix_sum += x_i * props['s0']\n                entropy_of_mixing_term += x_i * np.log(x_i)\n\n        # Final mixture entropy: s_mix = sum(xi*s0_i) - R*sum(xi*ln(xi))\n        s_mix = s0_mix_sum - R * entropy_of_mixing_term\n        \n        # Convert molar enthalpy to kJ/mol for the final output\n        h_mix_kJ_per_mol = h_mix / 1000.0\n\n        results.append([cp_mix, h_mix_kJ_per_mol, s_mix])\n\n    # Format the output as a single line string: [[c1,h1,s1],[c2,h2,s2],...]\n    formatted_results = [f\"[{','.join(map(str, res))}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While calculating enthalpy is a core skill, understanding its underlying definition is critical for building robust computational models. This exercise delves into the subtle but crucial concept of reference enthalpy conventions, a common source of error when coupling different thermochemical libraries or codes. By quantifying the spurious energy residual created by a reference mismatch, you will develop a deeper appreciation for the importance of consistency in thermochemical data to ensure the fundamental law of energy conservation is upheld in your simulations .",
            "id": "4071810",
            "problem": "A computational combustion solver couples two thermochemistry libraries that use different reference enthalpy conventions. Consider a steady, adiabatic, perfectly stirred reactor (no shaft work, negligible kinetic and potential energy changes) processing a stoichiometric methane–oxygen mixture with the reaction $\\mathrm{CH}_{4} + 2\\,\\mathrm{O}_{2} \\rightarrow \\mathrm{CO}_{2} + 2\\,\\mathrm{H}_{2}\\mathrm{O}$. The reactants enter at $T_{\\mathrm{in}} = 298.15\\,\\mathrm{K}$ and the products leave at $T = 1500\\,\\mathrm{K}$; assume complete conversion with no dissociation.\n\nLibrary $\\mathcal{R}$ uses the convention that the species enthalpy is decomposed as $h_{k}(T) = h_{f,k}^{\\circ}(298.15\\,\\mathrm{K}) + h_{s,k}(T;298.15\\,\\mathrm{K})$, where $h_{f,k}^{\\circ}(298.15\\,\\mathrm{K})$ is the standard molar enthalpy of formation at $298.15\\,\\mathrm{K}$ and $h_{s,k}(T;298.15\\,\\mathrm{K})$ is the sensible enthalpy relative to $298.15\\,\\mathrm{K}$ with $h_{s,k}(298.15\\,\\mathrm{K};298.15\\,\\mathrm{K})=0$. Library $\\mathcal{A}$ uses the convention $h_{k}(T) = h_{\\mathrm{abs},k}(T)$, the absolute molar enthalpy defined by $h_{\\mathrm{abs},k}(0\\,\\mathrm{K}) = 0$ and $h_{\\mathrm{abs},k}(T) = \\int_{0}^{T} c_{p,k}(T')\\,\\mathrm{d}T'$. In a flawed coupling, the inlet enthalpies are evaluated using library $\\mathcal{R}$ while the outlet enthalpies are evaluated using library $\\mathcal{A}$, with no reference-offset reconciliation.\n\nYou are given the following data at $298.15\\,\\mathrm{K}$ for the gas-phase species:\n- Absolute sensible enthalpy offsets $h_{\\mathrm{abs},k}(298.15\\,\\mathrm{K})$ (in $\\mathrm{kJ/mol}$): $\\mathrm{CH}_{4}$: $9.378$, $\\mathrm{O}_{2}$: $8.484$, $\\mathrm{CO}_{2}$: $10.950$, $\\mathrm{H_{2}O}$ (vapor): $9.780$.\n- Standard molar enthalpies of formation $h_{f,k}^{\\circ}(298.15\\,\\mathrm{K})$ (in $\\mathrm{kJ/mol}$): $\\mathrm{CH}_{4}$: $-74.85$, $\\mathrm{O}_{2}$: $0$, $\\mathrm{CO}_{2}$: $-393.52$, $\\mathrm{H_{2}O}$ (vapor): $-241.826$.\n\nStarting from the steady, adiabatic energy conservation for reacting ideal-gas mixtures and the definitions above, derive the expression for the spurious energy-residual introduced by this reference mismatch and compute its value per $\\mathrm{kmol}$ of $\\mathrm{CH}_{4}$ reacted. Round your final numerical answer to four significant figures and express it in $\\mathrm{kJ/kmol}$.",
            "solution": "The problem is first validated. The statement is scientifically grounded in the principles of chemical thermodynamics. It is well-posed, with all necessary data and definitions provided to calculate a unique answer. The language is objective and precise. The scenario describes a plausible error in computational simulations. Therefore, the problem is deemed valid and a solution will be provided.\n\nThe fundamental principle governing the reactor is the first law of thermodynamics for a steady-flow open system. For a steady, adiabatic reactor with no shaft work and negligible changes in kinetic and potential energy, the total enthalpy of the inlet streams must equal the total enthalpy of the outlet streams.\n$$\n\\sum_{k} \\dot{n}_{k, \\text{in}} h_k(T_{\\text{in}}) = \\sum_{k} \\dot{n}_{k, \\text{out}} h_k(T_{\\text{out}})\n$$\nwhere $\\dot{n}_k$ is the molar flow rate of species $k$ and $h_k$ is the molar enthalpy of species $k$. For a basis of $1\\,\\mathrm{kmol}$ of $\\mathrm{CH}_{4}$ reacted, this can be written in terms of moles $N_k$ as:\n$$\nH_{\\text{in}} = H_{\\text{out}} \\implies \\sum_{\\text{reactants}} N_k h_k(T_{\\text{in}}) = \\sum_{\\text{products}} N_k h_k(T_{\\text{out}})\n$$\nA correct calculation, using a single consistent thermochemical library, must satisfy this energy balance, meaning the residual energy $H_{\\text{out}} - H_{\\text{in}}$ must be zero.\n\nThe problem states that a flawed coupling of two libraries is used. The inlet enthalpy, $H_{\\text{in}}$, is calculated using library $\\mathcal{R}$, while the outlet enthalpy, $H_{\\text{out}}$, is calculated using library $\\mathcal{A}$. The spurious energy residual, $\\mathcal{E}$, is the value computed for $H_{\\text{out}} - H_{\\text{in}}$ in this flawed scheme.\n$$\n\\mathcal{E} = \\left(\\sum_{\\text{products}} N_k h_{k, \\mathcal{A}}(T_{\\text{out}})\\right) - \\left(\\sum_{\\text{reactants}} N_k h_{k, \\mathcal{R}}(T_{\\text{in}})\\right)\n$$\nHere, $h_{k, \\mathcal{A}}$ and $h_{k, \\mathcal{R}}$ denote molar enthalpies from library $\\mathcal{A}$ and $\\mathcal{R}$, respectively. The temperatures are $T_{\\text{in}} = 298.15\\,\\mathrm{K}$ and $T_{\\text{out}} = 1500\\,\\mathrm{K}$.\n\nTo derive the residual, we must relate the two enthalpy conventions. Let $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$.\nLibrary $\\mathcal{R}$ uses the standard enthalpy of formation reference:\n$$\nh_{k, \\mathcal{R}}(T) = h_{f,k}^{\\circ}(T_{\\text{ref}}) + h_{s,k}(T; T_{\\text{ref}})\n$$\nwhere $h_{f,k}^{\\circ}(T_{\\text{ref}})$ is the standard molar enthalpy of formation at $T_{\\text{ref}}$ and $h_{s,k}(T; T_{\\text{ref}})$ is the sensible enthalpy change from $T_{\\text{ref}}$ to $T$. By definition, $h_{s,k}(T; T_{\\text{ref}}) = \\int_{T_{\\text{ref}}}^{T} c_{p,k}(T')\\,\\mathrm{d}T'$.\n\nLibrary $\\mathcal{A}$ uses the absolute enthalpy reference:\n$$\nh_{k, \\mathcal{A}}(T) = h_{\\mathrm{abs},k}(T) = \\int_{0}^{T} c_{p,k}(T')\\,\\mathrm{d}T'\n$$\nWe can express $h_{\\mathrm{abs},k}(T)$ by splitting the integral at $T_{\\text{ref}}$:\n$$\nh_{\\mathrm{abs},k}(T) = \\int_{0}^{T_{\\text{ref}}} c_{p,k}(T')\\,\\mathrm{d}T' + \\int_{T_{\\text{ref}}}^{T} c_{p,k}(T')\\,\\mathrm{d}T' = h_{\\mathrm{abs},k}(T_{\\text{ref}}) + h_{s,k}(T; T_{\\text{ref}})\n$$\nBy comparing the expressions for $h_{k, \\mathcal{R}}(T)$ and $h_{k, \\mathcal{A}}(T)$, we see that the sensible enthalpy term $h_{s,k}(T; T_{\\text{ref}})$ is common to both after relating $h_{k, \\mathcal{A}}(T)$ to its value at $T_{\\text{ref}}$. The difference between the two conventions for a given species $k$ is a constant offset, independent of temperature $T$:\n$$\nh_{k, \\mathcal{A}}(T) - h_{k, \\mathcal{R}}(T) = (h_{\\mathrm{abs},k}(T_{\\text{ref}}) + h_{s,k}(T; T_{\\text{ref}})) - (h_{f,k}^{\\circ}(T_{\\text{ref}}) + h_{s,k}(T; T_{\\text{ref}}))\n$$\n$$\nh_{k, \\mathcal{A}}(T) - h_{k, \\mathcal{R}}(T) = h_{\\mathrm{abs},k}(T_{\\text{ref}}) - h_{f,k}^{\\circ}(T_{\\text{ref}})\n$$\nThis constant offset is the key to calculating the residual.\n\nFor an adiabatic reactor, the true energy balance is zero. Let's express this using the $\\mathcal{R}$ convention consistently:\n$$\n\\sum_{\\text{products}} N_k h_{k, \\mathcal{R}}(T_{\\text{out}}) - \\sum_{\\text{reactants}} N_k h_{k, \\mathcal{R}}(T_{\\text{in}}) = 0\n$$\nThis means $\\sum_{\\text{reactants}} N_k h_{k, \\mathcal{R}}(T_{\\text{in}}) = \\sum_{\\text{products}} N_k h_{k, \\mathcal{R}}(T_{\\text{out}})$.\nWe can substitute this into our expression for the spurious residual $\\mathcal{E}$:\n$$\n\\mathcal{E} = \\sum_{\\text{products}} N_k h_{k, \\mathcal{A}}(T_{\\text{out}}) - \\sum_{\\text{products}} N_k h_{k, \\mathcal{R}}(T_{\\text{out}})\n$$\n$$\n\\mathcal{E} = \\sum_{\\text{products}} N_k \\left[h_{k, \\mathcal{A}}(T_{\\text{out}}) - h_{k, \\mathcal{R}}(T_{\\text{out}})\\right]\n$$\nUsing the temperature-independent offset we derived:\n$$\n\\mathcal{E} = \\sum_{\\text{products}} N_k \\left[h_{\\mathrm{abs},k}(T_{\\text{ref}}) - h_{f,k}^{\\circ}(T_{\\text{ref}})\\right]\n$$\nThis elegant result shows that the residual is solely determined by the reference enthalpy offsets of the product species, weighted by their stoichiometric amounts. The inlet and outlet temperatures, $T_{\\text{in}}$ and $T_{\\text{out}}$, do not appear in the final expression for the residual, other than $T_{\\text{in}}$ being the reference temperature $T_{\\text{ref}}$.\n\nNow, we compute the numerical value for the reaction $\\mathrm{CH}_{4} + 2\\,\\mathrm{O}_{2} \\rightarrow \\mathrm{CO}_{2} + 2\\,\\mathrm{H}_{2}\\mathrm{O}$ on a basis of $1\\,\\mathrm{kmol}$ of $\\mathrm{CH}_{4}$.\nThe products are $1\\,\\mathrm{kmol}$ of $\\mathrm{CO}_{2}$ ($N_{\\mathrm{CO}_{2}}=1$) and $2\\,\\mathrm{kmol}$ of $\\mathrm{H}_{2}\\mathrm{O}$ ($N_{\\mathrm{H}_{2}\\mathrm{O}}=2$).\nThe given data are in $\\mathrm{kJ/mol}$. To obtain a result in $\\mathrm{kJ/kmol}$, we must multiply these values by $1000\\,\\mathrm{mol/kmol}$. Let $H_k = h_k \\times 1000$ be the molar enthalpy in $\\mathrm{kJ/kmol}$.\n\nFor $\\mathrm{CO}_{2}$:\n$H_{\\mathrm{abs},\\mathrm{CO}_{2}}(T_{\\text{ref}}) = 10.950\\,\\mathrm{kJ/mol} \\times 1000 = 10950\\,\\mathrm{kJ/kmol}$\n$H_{f,\\mathrm{CO}_{2}}^{\\circ}(T_{\\text{ref}}) = -393.52\\,\\mathrm{kJ/mol} \\times 1000 = -393520\\,\\mathrm{kJ/kmol}$\n\nFor $\\mathrm{H}_{2}\\mathrm{O}$ (gas):\n$H_{\\mathrm{abs},\\mathrm{H}_{2}\\mathrm{O}}(T_{\\text{ref}}) = 9.780\\,\\mathrm{kJ/mol} \\times 1000 = 9780\\,\\mathrm{kJ/kmol}$\n$H_{f,\\mathrm{H}_{2}\\mathrm{O}}^{\\circ}(T_{\\text{ref}}) = -241.826\\,\\mathrm{kJ/mol} \\times 1000 = -241826\\,\\mathrm{kJ/kmol}$\n\nThe residual $\\mathcal{E}$ is:\n$$\n\\mathcal{E} = N_{\\mathrm{CO}_{2}}\\left[H_{\\mathrm{abs},\\mathrm{CO}_{2}}(T_{\\text{ref}}) - H_{f,\\mathrm{CO}_{2}}^{\\circ}(T_{\\text{ref}})\\right] + N_{\\mathrm{H}_{2}\\mathrm{O}}\\left[H_{\\mathrm{abs},\\mathrm{H}_{2}\\mathrm{O}}(T_{\\text{ref}}) - H_{f,\\mathrm{H}_{2}\\mathrm{O}}^{\\circ}(T_{\\text{ref}})\\right]\n$$\n$$\n\\mathcal{E} = 1 \\times [10950 - (-393520)] + 2 \\times [9780 - (-241826)]\n$$\n$$\n\\mathcal{E} = 1 \\times [404470] + 2 \\times [251606]\n$$\n$$\n\\mathcal{E} = 404470 + 503212\n$$\n$$\n\\mathcal{E} = 907682\\,\\mathrm{kJ/kmol}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\mathcal{E} \\approx 907700\\,\\mathrm{kJ/kmol} = 9.077 \\times 10^{5}\\,\\mathrm{kJ/kmol}\n$$",
            "answer": "$$\\boxed{9.077 \\times 10^{5}}$$"
        },
        {
            "introduction": "This advanced practice moves from calculating properties for a given state to predicting the final equilibrium state of a reacting system from first principles. You will formulate and implement a numerical solver to find the chemical composition that minimizes the total Gibbs free energy, subject to elemental conservation. This exercise represents a capstone in computational thermochemistry, integrating thermodynamic theory with nonlinear numerical methods to create a powerful tool for predicting the outcome of chemical reactions at high temperatures .",
            "id": "4071838",
            "problem": "Consider an ideal-gas mixture at specified temperature $T$ and pressure $p$ that can contain the species $\\mathrm{H_2}$, $\\mathrm{O_2}$, $\\mathrm{H}$, $\\mathrm{O}$, $\\mathrm{OH}$, and $\\mathrm{H_2O}$. The mixture is closed and its atomic composition is fixed by the number of atoms of hydrogen and oxygen, denoted by the vector $\\boldsymbol{b} = (b_{\\mathrm{H}}, b_{\\mathrm{O}})$. At equilibrium, the mixture minimizes its total Gibbs free energy subject to atomic conservation and nonnegativity of species amounts. Your task is to formulate the nonlinear system that characterizes the equilibrium composition via total Gibbs free energy minimization and to implement a Newton–Lagrange solver that enforces the atomic balance constraints and nonnegativity.\n\nBase your derivation on the following foundational facts:\n- The Second Law of Thermodynamics implies that at fixed temperature $T$ and pressure $p$, the equilibrium state of a closed system minimizes its total Gibbs free energy $G$.\n- For an ideal-gas mixture, the chemical potential is determined by the standard-state thermochemical functions and the mixing contribution.\n- The equality constraints are the atomic conservation laws, and the inequality constraints are the nonnegativity of species amounts.\n\nSpecies set and data (all values are on the ideal-gas standard state at $p^0 = 100000\\,\\mathrm{Pa}$, referenced at $T_{\\mathrm{ref}} = 298.15\\,\\mathrm{K}$):\n- Species order: $\\mathrm{H_2}$, $\\mathrm{O_2}$, $\\mathrm{H}$, $\\mathrm{O}$, $\\mathrm{OH}$, $\\mathrm{H_2O}$.\n- Atomic composition matrix $\\boldsymbol{A}$ (rows are elements $\\mathrm{H}$ and $\\mathrm{O}$, columns follow the species order above):\n  $\\boldsymbol{A} = \\begin{bmatrix}\n  2  0  1  0  1  2 \\\\\n  0  2  0  1  1  1\n  \\end{bmatrix}$.\n- Constant heat capacities at constant pressure $\\boldsymbol{c}_p$ (in $\\mathrm{J\\ mol^{-1}\\ K^{-1}}$):\n  $\\mathrm{H_2}$: $28.836$, $\\mathrm{O_2}$: $29.355$, $\\mathrm{H}$: $20.786$, $\\mathrm{O}$: $20.786$, $\\mathrm{OH}$: $29.100$, $\\mathrm{H_2O}$: $33.600$.\n- Standard formation enthalpies at $T_{\\mathrm{ref}}$ (in $\\mathrm{J\\ mol^{-1}}$):\n  $\\mathrm{H_2}$: $0$, $\\mathrm{O_2}$: $0$, $\\mathrm{H}$: $218000$, $\\mathrm{O}$: $249000$, $\\mathrm{OH}$: $39000$, $\\mathrm{H_2O}$: $-241826$.\n- Standard absolute entropies at $T_{\\mathrm{ref}}$ and $p^0$ (in $\\mathrm{J\\ mol^{-1}\\ K^{-1}}$):\n  $\\mathrm{H_2}$: $130.680$, $\\mathrm{O_2}$: $205.000$, $\\mathrm{H}$: $114.600$, $\\mathrm{O}$: $161.060$, $\\mathrm{OH}$: $183.700$, $\\mathrm{H_2O}$: $188.840$.\n- Universal gas constant: $R = 8.314462618\\,\\mathrm{J\\ mol^{-1}\\ K^{-1}}$.\n\nUsing these data, define the standard-state molar Gibbs free energy $g_i^0(T)$ of each species $i$ at temperature $T$ by combining the constant-$c_p$ approximation for enthalpy and entropy relative to $T_{\\mathrm{ref}}$, and then formulate the equilibrium conditions by minimizing the total Gibbs free energy $G(T,p,\\boldsymbol{n})$ of the mixture with respect to the species amounts $\\boldsymbol{n}$, subject to the atomic conservation constraints $\\boldsymbol{A}\\boldsymbol{n} = \\boldsymbol{b}$ and $n_i \\ge 0$ for all species.\n\nYou must:\n1. Derive a square system of nonlinear equations for unknowns that include the species amounts (represented in a way that enforces $n_i \\ge 0$), Lagrange multipliers for the element conservation constraints, and any auxiliary variables necessary to render the system well-posed.\n2. Construct a Newton–Lagrange iteration to solve this system and implement sufficient globalization to achieve convergence for the provided test cases.\n3. Return the equilibrium mole fractions of all six species, in the specified order, as the final result of your program.\n\nPhysical units and computational rules:\n- Temperatures $T$ are in $\\mathrm{K}$, pressures $p$ are in $\\mathrm{Pa}$, and the standard pressure is $p^0 = 100000\\,\\mathrm{Pa}$.\n- All thermochemical inputs ($\\boldsymbol{c}_p$, formation enthalpies, entropies) are used in $\\mathrm{SI}$ units as listed above.\n- Express the final equilibrium compositions as dimensionless mole fractions rounded to six decimal places.\n\nTest suite:\n- Case $1$ (general case): $T = 3000$, $p = 101325$, $\\boldsymbol{b} = (2.0, 1.0)$.\n- Case $2$ (lower temperature boundary): $T = 1000$, $p = 101325$, $\\boldsymbol{b} = (2.0, 1.0)$.\n- Case $3$ (rich mixture, higher pressure): $T = 3500$, $p = 1013250$, $\\boldsymbol{b} = (2.0, 0.8)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must itself be a bracketed comma-separated list of six floats ordered by the species list above. For example, the output format must be:\n$\\texttt{[[y1\\_case1,y2\\_case1,y3\\_case1,y4\\_case1,y5\\_case1,y6\\_case1],[y1\\_case2,\\dots,y6\\_case2],[y1\\_case3,\\dots,y6\\_case3]]}$.",
            "solution": "The problem requires the calculation of the equilibrium composition of an ideal-gas mixture containing the species $\\mathrm{H_2}$, $\\mathrm{O_2}$, $\\mathrm{H}$, $\\mathrm{O}$, $\\mathrm{OH}$, and $\\mathrm{H_2O}$ at a given temperature $T$ and pressure $p$, for a fixed elemental composition. The problem is a classic application of the Second Law of Thermodynamics, which states that a closed system at constant $T$ and $p$ will reach an equilibrium state that minimizes its total Gibbs free energy, $G$. The minimization is subject to the constraints of atom conservation.\n\nFirst, we define the necessary thermochemical properties for each species $i$. The standard-state molar Gibbs free energy of species $i$, denoted $g_i^0(T)$, is a function of temperature and is calculated from its standard-state molar enthalpy $h_i^0(T)$ and entropy $s_i^0(T, p^0)$ as $g_i^0(T) = h_i^0(T) - T s_i^0(T, p^0)$. The problem specifies using a constant heat capacity, $c_{p,i}^0$, approximation.\n\nThe standard-state molar enthalpy at temperature $T$ is found by integrating the heat capacity from a reference temperature $T_{\\mathrm{ref}}$:\n$$h_i^0(T) = \\Delta h_{f,i}^0(T_{\\mathrm{ref}}) + \\int_{T_{\\mathrm{ref}}}^T c_{p,i}^0 dT' = \\Delta h_{f,i}^0(T_{\\mathrm{ref}}) + c_{p,i}^0(T - T_{\\mathrm{ref}})$$\nwhere $\\Delta h_{f,i}^0(T_{\\mathrm{ref}})$ is the standard enthalpy of formation of species $i$ at $T_{\\mathrm{ref}} = 298.15\\,\\mathrm{K}$.\n\nSimilarly, the standard-state molar entropy at temperature $T$ and standard pressure $p^0$ is:\n$$s_i^0(T, p^0) = s_i^0(T_{\\mathrm{ref}}, p^0) + \\int_{T_{\\mathrm{ref}}}^T \\frac{c_{p,i}^0}{T'} dT' = s_i^0(T_{\\mathrm{ref}}, p^0) + c_{p,i}^0\\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right)$$\nwhere $s_i^0(T_{\\mathrm{ref}}, p^0)$ is the standard absolute entropy of species $i$ at $T_{\\mathrm{ref}}$ and $p^0$.\n\nCombining these, the standard-state molar Gibbs free energy for each species $i$ is:\n$$g_i^0(T) = \\left[ \\Delta h_{f,i}^0(T_{\\mathrm{ref}}) + c_{p,i}^0(T - T_{\\mathrm{ref}}) \\right] - T \\left[ s_i^0(T_{\\mathrm{ref}}, p^0) + c_{p,i}^0\\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) \\right]$$\n\nThe total Gibbs free energy of the $N_s$-species ideal-gas mixture is $G = \\sum_{i=1}^{N_s} n_i \\mu_i$, where $n_i$ is the number of moles of species $i$ and $\\mu_i$ is its chemical potential. The chemical potential is given by:\n$$\\mu_i(T, p, \\boldsymbol{y}) = g_i^0(T) + RT\\ln\\left(\\frac{p_i}{p^0}\\right) = g_i^0(T) + RT\\ln\\left(\\frac{y_i p}{p^0}\\right)$$\nHere, $R$ is the universal gas constant, $y_i = n_i/n_{tot}$ is the mole fraction of species $i$, $n_{tot} = \\sum_i n_i$ is the total number of moles in the mixture, and $p_i = y_i p$ is the partial pressure.\n\nThe equilibrium state is found by minimizing $G$ with respect to the mole numbers $\\boldsymbol{n} = (n_1, \\dots, n_{N_s})$ subject to the element conservation constraints:\n$$\\sum_{i=1}^{N_s} a_{ji} n_i = b_j \\quad \\text{for each element } j=1, \\dots, N_e$$\nand the nonnegativity constraints $n_i \\ge 0$. In this problem, we have $N_s=6$ species and $N_e=2$ elements (H and O), with the elemental abundances given by the vector $\\boldsymbol{b} = (b_H, b_O)$ and the atomic composition matrix $\\boldsymbol{A}$ where $a_{ji}$ is the number of atoms of element $j$ in a molecule of species $i$.\n\nTo solve this constrained optimization problem, we use the method of Lagrange multipliers. The Lagrangian function $\\mathcal{L}$ is:\n$$\\mathcal{L}(\\boldsymbol{n}, \\boldsymbol{\\lambda}) = G(\\boldsymbol{n}) - \\sum_{j=1}^{N_e} \\lambda_j \\left( \\sum_{i=1}^{N_s} a_{ji} n_i - b_j \\right)$$\nAt the minimum, the gradient of the Lagrangian with respect to each $n_i$ must be zero, which yields the condition:\n$$\\frac{\\partial \\mathcal{L}}{\\partial n_i} = \\mu_i - \\sum_{j=1}^{N_e} \\lambda_j a_{ji} = 0$$\nThis implies that at equilibrium, the chemical potential of each species is a linear combination of the Lagrange multipliers $\\lambda_j$, which can be interpreted as element potentials:\n$$\\mu_i = \\sum_{j=1}^{N_e} a_{ji} \\lambda_j$$\nSubstituting the expression for $\\mu_i$ and dividing by $RT$, we introduce the dimensionless element potentials $\\pi_j = \\lambda_j / (RT)$:\n$$\\frac{g_i^0(T)}{RT} + \\ln\\left(\\frac{n_i}{n_{tot}}\\right) + \\ln\\left(\\frac{p}{p^0}\\right) = \\sum_{j=1}^{N_e} a_{ji} \\pi_j$$\n\nTo formulate a well-posed system for a numerical solver, we select a set of independent variables and construct a square system of nonlinear equations. A robust choice of variables, following the formulation used in established codes like NASA CEA, is the set of element potentials $\\pi_j$ and the natural logarithm of the total moles, $\\ln n_{tot}$. For our system, the vector of unknowns is $\\boldsymbol{v} = (\\pi_H, \\pi_O, \\ln n_{tot})^T$.\n\nRearranging the equilibrium condition provides an explicit expression for each $n_i$ as a function of $\\boldsymbol{v}$:\n$$\\ln n_i = \\ln n_{tot} + \\sum_{j=1}^{N_e} a_{ji}\\pi_j - \\frac{g_i^0(T)}{RT} - \\ln\\left(\\frac{p}{p^0}\\right)$$\n$$n_i(\\boldsymbol{v}) = \\exp\\left( (\\ln n_{tot}) + a_{H,i}\\pi_H + a_{O,i}\\pi_O - \\frac{g_i^0(T)}{RT} - \\ln\\left(\\frac{p}{p^0}\\right) \\right)$$\nThis formulation elegantly enforces the nonnegativity constraint $n_i > 0$.\n\nWe can now define a system of $N_e + 1 = 3$ residual equations, $\\boldsymbol{F}(\\boldsymbol{v})=\\boldsymbol{0}$, corresponding to the two element conservation laws and one closure equation for the total number of moles.\n$$F_1(\\boldsymbol{v}) = \\sum_{i=1}^{N_s} a_{H,i} n_i(\\boldsymbol{v}) - b_H = 0 \\quad (\\text{H-atom balance})$$\n$$F_2(\\boldsymbol{v}) = \\sum_{i=1}^{N_s} a_{O,i} n_i(\\boldsymbol{v}) - b_O = 0 \\quad (\\text{O-atom balance})$$\n$$F_3(\\boldsymbol{v}) = \\sum_{i=1}^{N_s} n_i(\\boldsymbol{v}) - \\exp(\\ln n_{tot}) = 0 \\quad (\\text{Mole number closure})$$\nThis is a square system of $3$ nonlinear equations in the $3$ unknowns $\\boldsymbol{v} = (v_1, v_2, v_3)^T = (\\pi_H, \\pi_O, \\ln n_{tot})^T$.\n\nWe solve this system using Newton's method. The iterative update rule is $\\boldsymbol{v}^{(k+1)} = \\boldsymbol{v}^{(k)} + \\alpha \\Delta \\boldsymbol{v}^{(k)}$, where the correction vector $\\Delta \\boldsymbol{v}^{(k)}$ is the solution to the linear system $\\boldsymbol{J}^{(k)} \\Delta \\boldsymbol{v}^{(k)} = -\\boldsymbol{F}^{(k)}$. Here, $\\boldsymbol{F}^{(k)}$ is the residual vector and $\\boldsymbol{J}^{(k)}$ is the Jacobian matrix evaluated at the $k$-th iteration. The parameter $\\alpha \\in (0, 1]$ is a damping factor determined by a line search algorithm to ensure robust convergence (globalization).\n\nThe elements of the Jacobian matrix, $J_{jk} = \\partial F_j / \\partial v_k$, are derived by differentiating the residual equations. The required partial derivatives of $n_i(\\boldsymbol{v})$ are:\n$$\\frac{\\partial n_i}{\\partial \\pi_H} = n_i a_{H,i}, \\quad \\frac{\\partial n_i}{\\partial \\pi_O} = n_i a_{O,i}, \\quad \\frac{\\partial n_i}{\\partial (\\ln n_{tot})} = n_i$$\nThe resulting $3 \\times 3$ Jacobian matrix $\\boldsymbol{J}$ is:\n$$ \\boldsymbol{J} =\n\\begin{pmatrix}\n\\sum_{i} n_i a_{H,i}^2  \\sum_{i} n_i a_{H,i} a_{O,i}  \\sum_{i} n_i a_{H,i} \\\\\n\\sum_{i} n_i a_{O,i} a_{H,i}  \\sum_{i} n_i a_{O,i}^2  \\sum_{i} n_i a_{O,i} \\\\\n\\sum_{i} n_i a_{H,i}  \\sum_{i} n_i a_{O,i}  \\sum_{i} n_i - \\exp(\\ln n_{tot})\n\\end{pmatrix}\n$$\nThe summation is over all species $i=1, \\dots, N_s$.\n\nThe solution algorithm is as follows:\n$1$. Initialize the unknown vector $\\boldsymbol{v}^{(0)}$. A safe choice is one that yields small initial mole numbers.\n$2$. For each iteration $k$:\n    a. Compute $n_i^{(k)}$ for all species using $\\boldsymbol{v}^{(k)}$.\n    b. Compute the residual vector $\\boldsymbol{F}^{(k)}$ and the Jacobian matrix $\\boldsymbol{J}^{(k)}$.\n    c. Check for convergence (e.g., $||\\boldsymbol{F}^{(k)}||_2  \\mathrm{tolerance}$). If converged, exit the loop.\n    d. Solve the linear system $\\boldsymbol{J}^{(k)} \\Delta \\boldsymbol{v}^{(k)} = -\\boldsymbol{F}^{(k)}$ for $\\Delta \\boldsymbol{v}^{(k)}$.\n    e. Perform a line search to find a damping factor $\\alpha$ that ensures a sufficient decrease in the residual norm.\n    f. Update the solution: $\\boldsymbol{v}^{(k+1)} = \\boldsymbol{v}^{(k)} + \\alpha \\Delta \\boldsymbol{v}^{(k)}$.\n$3$. Once converged to $\\boldsymbol{v}^*$, compute the final mole numbers $\\boldsymbol{n}^*$, the total moles $n_{tot}^* = \\sum n_i^*$, and the equilibrium mole fractions $y_i^* = n_i^*/n_{tot}^*$.\nThis procedure provides a robust and efficient method for finding the chemical equilibrium state.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the chemical equilibrium problem for the given test cases.\n    \"\"\"\n\n    # --- Problem Data ---\n    # Species order: H2, O2, H, O, OH, H2O\n    SPECIES = ['H2', 'O2', 'H', 'O', 'OH', 'H2O']\n    NUM_SPECIES = 6\n    NUM_ELEMENTS = 2\n\n    # Universal Gas Constant (J / mol K)\n    R = 8.314462618\n\n    # Reference State\n    T_REF = 298.15  # K\n    P_0 = 100000.0   # Pa\n\n    # Atomic composition matrix A (rows: H, O; cols: species)\n    A = np.array([\n        [2., 0., 1., 0., 1., 2.],  # H atoms\n        [0., 2., 0., 1., 1., 1.]   # O atoms\n    ])\n\n    # Standard formation enthalpies at T_ref (J/mol)\n    H_F_REF = np.array([0., 0., 218000., 249000., 39000., -241826.])\n\n    # Standard absolute entropies at T_ref, P_0 (J/mol K)\n    S_REF = np.array([130.680, 205.000, 114.600, 161.060, 183.700, 188.840])\n\n    # Constant heat capacities at constant pressure (J/mol K)\n    CP = np.array([28.836, 29.355, 20.786, 20.786, 29.100, 33.600])\n\n    def get_g0_over_RT(T):\n        \"\"\"\n        Calculates the standard-state Gibbs free energy for each species at temperature T,\n        normalized by RT.\n        \"\"\"\n        h0 = H_F_REF + CP * (T - T_REF)\n        s0 = S_REF + CP * np.log(T / T_REF)\n        g0 = h0 - T * s0\n        return g0 / (R * T)\n\n    def equilibrium_solver(T, p, b):\n        \"\"\"\n        Solves for the equilibrium composition using a Newton-Lagrange method.\n        \n        Args:\n            T (float): Temperature in Kelvin.\n            p (float): Pressure in Pascals.\n            b (np.array): Vector of elemental abundances (b_H, b_O).\n\n        Returns:\n            np.array: Vector of equilibrium mole fractions.\n        \"\"\"\n        g0_over_RT = get_g0_over_RT(T)\n        log_p_over_p0 = np.log(p / P_0)\n\n        # Unknowns vector v = [pi_H, pi_O, log_n_tot]\n        v = np.array([-20.0, -20.0, 0.0])  # Initial guess\n\n        # Newton solver parameters\n        max_iter = 100\n        tolerance = 1e-10\n        max_step_norm = 2.0\n        \n        for k in range(max_iter):\n            pi_H, pi_O, log_n_tot = v\n            \n            # Calculate mole numbers n_i from current variables v\n            exponent = log_n_tot + A[0] * pi_H + A[1] * pi_O - g0_over_RT - log_p_over_p0\n            n = np.exp(exponent)\n            \n            # Calculate residual vector F\n            F = np.zeros(NUM_ELEMENTS + 1)\n            F[0] = np.dot(A[0], n) - b[0]\n            F[1] = np.dot(A[1], n) - b[1]\n            F[2] = np.sum(n) - np.exp(log_n_tot)\n            \n            # Check for convergence\n            norm_F = np.linalg.norm(F)\n            if norm_F  tolerance:\n                break\n            \n            # Calculate Jacobian matrix J\n            J = np.zeros((NUM_ELEMENTS + 1, NUM_ELEMENTS + 1))\n            # Top-left block: d(element balance)/d(pi)\n            J[0, 0] = np.dot(n, A[0]**2)\n            J[0, 1] = np.dot(n, A[0] * A[1])\n            J[1, 0] = J[0, 1]\n            J[1, 1] = np.dot(n, A[1]**2)\n            \n            # Right column: d(element balance)/d(log_n_tot)\n            b_current = A @ n\n            J[0, 2] = b_current[0]\n            J[1, 2] = b_current[1]\n            \n            # Bottom row: d(mole balance)/d(v)\n            J[2, 0] = b_current[0]\n            J[2, 1] = b_current[1]\n            J[2, 2] = np.sum(n) - np.exp(log_n_tot) # This is F[2]\n            \n            # Solve the linear system J * dv = -F\n            try:\n                dv = np.linalg.solve(J, -F)\n            except np.linalg.LinAlgError:\n                # Use pseudo-inverse if Jacobian is singular\n                dv = np.linalg.pinv(J) @ -F\n\n            # Globalization: Step size control and backtracking line search\n            dv_norm = np.linalg.norm(dv)\n            if dv_norm > max_step_norm:\n                dv = dv * (max_step_norm / dv_norm)\n            \n            alpha = 1.0\n            for _ in range(10): # Max 10 line search steps\n                v_next = v + alpha * dv\n                pi_H_next, pi_O_next, log_n_tot_next = v_next\n                exp_next = log_n_tot_next + A[0] * pi_H_next + A[1] * pi_O_next - g0_over_RT - log_p_over_p0\n                n_next = np.exp(exp_next)\n\n                F_next = np.zeros(NUM_ELEMENTS + 1)\n                F_next[0] = np.dot(A[0], n_next) - b[0]\n                F_next[1] = np.dot(A[1], n_next) - b[1]\n                F_next[2] = np.sum(n_next) - np.exp(log_n_tot_next)\n                \n                if np.linalg.norm(F_next)  norm_F:\n                    v = v_next\n                    break\n                alpha /= 2.0\n            else: # If line search fails, break main loop\n                break\n\n        # Post-processing: calculate final mole fractions\n        pi_H, pi_O, log_n_tot = v\n        exponent = log_n_tot + A[0] * pi_H + A[1] * pi_O - g0_over_RT - log_p_over_p0\n        n_final = np.exp(exponent)\n        n_tot_final = np.sum(n_final)\n        y_final = n_final / n_tot_final\n\n        return y_final\n\n    # --- Test Suite ---\n    test_cases = [\n        # T (K), p (Pa), b (H, O)\n        (3000.0, 101325.0, np.array([2.0, 1.0])),\n        (1000.0, 101325.0, np.array([2.0, 1.0])),\n        (3500.0, 1013250.0, np.array([2.0, 0.8])),\n    ]\n\n    all_results = []\n    for T, p, b in test_cases:\n        y = equilibrium_solver(T, p, b)\n        y_rounded = np.round(y, 6)\n        all_results.append(f\"[{','.join(f'{val:.6f}' for val in y_rounded)}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}