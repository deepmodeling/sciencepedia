{
    "hands_on_practices": [
        {
            "introduction": "精确的化学动力学模型要求正向和逆向反应速率常数之比等于由热力学推导出的平衡常数。这个实践练习将向您展示如何利用标准热化学数据（即NASA多项式）计算该平衡常数 ，从而将基础的统计力学原理与实际的工程计算联系起来。这项技能是构建热力学一致的反应机理的基础。",
            "id": "4039337",
            "problem": "给定理想气体物质的美国国家航空航天局 (NASA) 七系数多项式热化学表示法，该表示法在两个温度子区间内有效。您的任务是，从基于统计力学的第一性原理出发，推导如何计算在标准态压力 $p^\\circ$ 下气相反应的标准吉布斯自由能变 $\\Delta G^\\circ(T)$，然后推导与微观可逆性和细致平衡原理一致的平衡常数 $K_{\\mathrm{eq}}(T)$ 的形式。该推导必须明确考虑平动、转动、振动和电子对分子配分函数的贡献，并且必须将这些贡献与计算中使用的热力学函数联系起来。\n\n您编写的程序必须实现以下计算规范：\n\n1. 使用 NASA 七系数多项式，对每种物质 $i$ 计算无量纲函数 $c_p/R$、$h/(RT)$ 和 $s/R$，其中 $R$ 是普适气体常数。多项式适用于以开尔文为单位的温度 $T$：\n   - 低温范围：$T \\in [200,1000]$，\n   - 高温范围：$T \\in (1000,6000]$。\n2. 对于每种物质，都提供了低温范围系数 $\\{a_1,\\dots,a_7\\}$ 和高温范围系数 $\\{a_1,\\dots,a_7\\}$。应使用标准 NASA 函数形式计算这些无量纲函数：\n   - $c_p/R = a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4$，\n   - $h/(RT) = a_1 + a_2 \\dfrac{T}{2} + a_3 \\dfrac{T^2}{3} + a_4 \\dfrac{T^3}{4} + a_5 \\dfrac{T^4}{5} + a_6 \\dfrac{1}{T}$，\n   - $s/R = a_1 \\ln T + a_2 T + a_3 \\dfrac{T^2}{2} + a_4 \\dfrac{T^3}{3} + a_5 \\dfrac{T^4}{4} + a_7$。\n3. 普适气体常数为 $R = 8.31446261815324$ 焦耳每摩尔每开尔文，即 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。标准态压力为 $p^\\circ = 1.0\\times10^5\\,\\mathrm{Pa}$。\n4. 物质 $i$ 的标准摩尔吉布斯自由能为 $G_i^\\circ(T) = H_i^\\circ(T) - T S_i^\\circ(T)$，其中 $H_i^\\circ(T) = R T \\, h_i/(RT)$ 且 $S_i^\\circ(T) = R \\, s_i/R$。对于一个化学计量系数为 $\\nu_i$（产物为正，反应物为负）的反应，标准吉布斯自由能变为 $\\Delta G^\\circ(T) = \\sum_i \\nu_i G_i^\\circ(T)$。\n5. 为确保在宽温度范围内的数值稳定性，您的程序必须计算并输出平衡常数的自然对数 $\\ln K_{\\mathrm{eq}}(T)$，而不是 $K_{\\mathrm{eq}}(T)$ 本身。在理想气体标准态假设下，$\\ln K_{\\mathrm{eq}}(T) = -\\Delta G^\\circ(T)/(R T)$。\n6. 实现反应 $ \\mathrm{H_2} + \\tfrac{1}{2}\\mathrm{O_2} \\rightarrow \\mathrm{H_2O} $，其化学计量系数为 $\\nu_{\\mathrm{H_2O}} = +1$，$\\nu_{\\mathrm{H_2}} = -1$，$\\nu_{\\mathrm{O_2}} = -\\tfrac{1}{2}$。\n7. 对以下物质使用以下 NASA 七系数多项式（在 $T \\in [200,6000]$ K 内有效）：\n\n   对于 $\\mathrm{H_2}$：\n   - 低温范围 ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [2.34433112\\times 10^{0},\\,7.98052075\\times 10^{-3},\\,-1.94781510\\times 10^{-5},\\,2.01572094\\times 10^{-8},\\,-7.37611761\\times 10^{-12},\\,-9.17935173\\times 10^{2},\\,6.83010238\\times 10^{0}]$,\n   - 高温范围 ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.33727920\\times 10^{0},\\,-4.94024731\\times 10^{-5},\\,4.99456778\\times 10^{-7},\\,-1.79566394\\times 10^{-10},\\,2.00255376\\times 10^{-14},\\,-9.50158922\\times 10^{2},\\,-3.20502331\\times 10^{0}]$。\n\n   对于 $\\mathrm{O_2}$：\n   - 低温范围 ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [3.78245636\\times 10^{0},\\,-2.99673416\\times 10^{-3},\\,9.84730201\\times 10^{-6},\\,-9.68129509\\times 10^{-9},\\,3.24372837\\times 10^{-12},\\,-1.06394356\\times 10^{3},\\,3.65767573\\times 10^{0}]$,\n   - 高温范围 ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.28253784\\times 10^{0},\\,1.48308754\\times 10^{-3},\\,-7.57966669\\times 10^{-7},\\,2.09470555\\times 10^{-10},\\,-2.16717794\\times 10^{-14},\\,-1.08845772\\times 10^{3},\\,5.45323129\\times 10^{0}]$。\n\n   对于 $\\mathrm{H_2O}$：\n   - 低温范围 ($T \\in [200,1000]$): $[a_1,\\dots,a_7] = [4.19864056\\times 10^{0},\\,-2.03643410\\times 10^{-3},\\,6.52040211\\times 10^{-6},\\,-5.48797062\\times 10^{-9},\\,1.77197817\\times 10^{-12},\\,-3.02937267\\times 10^{4},\\,-8.49032208\\times 10^{-1}]$,\n   - 高温范围 ($T \\in (1000,6000]$): $[a_1,\\dots,a_7] = [3.03399249\\times 10^{0},\\,2.17691804\\times 10^{-3},\\,-1.64072518\\times 10^{-7},\\,-9.70419870\\times 10^{-11},\\,1.68200992\\times 10^{-14},\\,-3.00042971\\times 10^{4},\\,4.96677010\\times 10^{0}]$。\n\n8. 测试套件包含三个用于评估 $\\ln K_{\\mathrm{eq}}(T)$ 的温度：\n   - A 情况：$T = 298.15$ 开尔文，\n   - B 情况（边界）：$T = 1000.00$ 开尔文，\n   - C 情况：$T = 2500.00$ 开尔文。\n9. 输出规范：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个结果都必须是对应测试情况（按 A, B, C 顺序）的 $\\ln K_{\\mathrm{eq}}(T)$ 值的浮点数。例如，输出格式为 $[\\ell_A,\\ell_B,\\ell_C]$。不应打印任何其他文本。\n\n所有物理量必须以科学上一致的方式，并基于理想气体假设进行处理。不涉及角度。平衡常数必须以其自然对数（无量纲）的形式报告。请确保解答中的推导从统计力学的定义开始，并与 NASA 热化学表示法建立联系，而不是依赖于标准、经过充分验证的关系之外的快捷公式。",
            "solution": "该问题是有效的，因为它具有科学依据、问题适定、客观，并且包含获得唯一解所需的所有信息。它提出了计算热化学中的一个标准任务，该任务将统计力学的基本原理与实用的工程模型联系起来。\n\n任务是从第一性原理出发，推导计算气相反应平衡常数 $K_{\\mathrm{eq}}(T)$ 的方法，然后使用 NASA 七系数多项式表示法实现热力学性质的计算。该推导必须建立统计力学、热力学和细致平衡原理之间的联系。\n\n### 1. 热力学性质的统计力学基础\n\n我们从统计力学所描述的系统微观状态与其宏观热力学性质之间的基本联系开始。对于一个由正则系综（粒子数 $N$、体积 $V$ 和温度 $T$ 恒定）中无相互作用、不可区分的粒子组成的系统，其正则配分函数 $Q$ 与分子配分函数 $q$ 的关系如下：\n$$\nQ = \\frac{q^N}{N!}\n$$\n分子配分函数 $q$ 是对单个分子的所有可能能态 $\\epsilon_j$ 的求和：\n$$\nq = \\sum_j g_j e^{-\\epsilon_j / (k_B T)}\n$$\n其中 $k_B$ 是玻尔兹曼常数，$g_j$ 是能级 $\\epsilon_j$ 的简并度。在 Born-Oppenheimer 近似下，分子能量可以分离为平动、转动、振动和电子贡献。因此，分子配分函数可以分解为：\n$$\nq = q_{\\text{trans}} q_{\\text{rot}} q_{\\text{vib}} q_{\\text{elec}}\n$$\n关键的热力学性质可以从 $Q$ 推导出来。我们主要关心的是摩尔吉布斯自由能 $G_m(T,p)$。它通常由亥姆霍兹自由能 $A = -k_B T \\ln Q$ 推导得出。对于像一摩尔这样的大量粒子（$N=N_A$，阿伏伽德罗常数），使用 Stirling 近似 $\\ln N! \\approx N \\ln N - N$，以及理想气体定律 $pV_m=RT$（其中 $R=N_A k_B$）：\n$$\nG_m^\\circ(T) = H_m^\\circ(T) - T S_m^\\circ(T)\n$$\n理想气体的标准摩尔焓 $H_m^\\circ(T)$ 和标准摩尔熵 $S_m^\\circ(T)$ 本身可以用分子配分函数 $q$ 表示。配分函数通常是使用相对于基态能量 $\\epsilon_0$ 的能量 $\\epsilon_j$ 来计算的。通过引入 0 K 时的标准摩尔生成焓 $\\Delta_f H_m^\\circ(0)$ 来建立绝对能量标度。完整的统计力学表达式为：\n$$\nH_m^\\circ(T) = \\Delta_f H_m^\\circ(0) + RT^2 \\frac{d \\ln q}{dT} + RT\n$$\n$$\nS_m^\\circ(T) = R \\left( \\ln\\left(\\frac{q^\\circ}{N_A}\\right) + T \\frac{d \\ln q}{dT} + 1 \\right)\n$$\n这里，$q^\\circ$ 表示配分函数的平动部分是在标准态压力 $p^\\circ$ 下通过将体积设为 $V_m = RT/p^\\circ$ 计算的。\n\n于是，物质 $i$ 的标准摩尔吉布斯自由能为：\n$$\nG_{i,m}^\\circ(T) = H_{i,m}^\\circ(T) - T S_{i,m}^\\circ(T)\n$$\n这个框架提供了一条从分子的量子力学能级到其宏观热力学性质的严谨路径。\n\n### 2. NASA 多项式表示法\n\n在很宽的温度范围内直接计算配分函数及其导数，计算量非常大。NASA 七系数多项式为从这些基本原理或实验测量中获得的热力学数据提供了一种准确而高效的经验拟合。对于给定的物质 $i$ 和温度 $T$，这些多项式表示无量纲定压比热容 $c_{p,i}/R$、无量纲比焓 $h_i/(RT)$ 和无量纲比熵 $s_i/R$。\n\n标准摩尔焓 $H_i^\\circ(T)$ 和熵 $S_i^\\circ(T)$ 可恢复如下：\n$$\nH_i^\\circ(T) = R T \\left( \\frac{h_i}{RT} \\right)\n$$\n$$\nS_i^\\circ(T) = R \\left( \\frac{s_i}{R} \\right)\n$$\n$h_i/(RT)$ 和 $s_i/R$ 的函数形式由以下公式给出：\n$$\n\\frac{h_i}{RT} = a_{i,1} + a_{i,2} \\frac{T}{2} + a_{i,3} \\frac{T^2}{3} + a_{i,4} \\frac{T^3}{4} + a_{i,5} \\frac{T^4}{5} + \\frac{a_{i,6}}{T}\n$$\n$$\n\\frac{s_i}{R} = a_{i,1} \\ln T + a_{i,2} T + a_{i,3} \\frac{T^2}{2} + a_{i,4} \\frac{T^3}{3} + a_{i,5} \\frac{T^4}{4} + a_{i,7}\n$$\n系数集 $\\{a_{i,1}, \\dots, a_{i,7}\\}$ 对于每种物质 $i$ 和特定的温度范围都是特定的。\n\n### 3. 反应吉布斯自由能和平衡常数\n\n对于一个由 $\\sum_i \\nu_i M_i = 0$ 表示的化学反应，其中 $\\nu_i$ 是化学计量系数（产物为正，反应物为负），$M_i$ 是化学物质，反应的标准吉布斯自由能变 $\\Delta_r G^\\circ(T)$ 是产物的标准吉布斯自由能之和减去反应物的标准吉布斯自由能之和，并按其化学计量加权：\n$$\n\\Delta_r G^\\circ(T) = \\sum_i \\nu_i G_i^\\circ(T)\n$$\n标准吉布斯自由能变与热力学平衡常数 $K_{\\mathrm{eq}}(T)$ 之间的关系是化学热力学的基石：\n$$\n\\Delta_r G^\\circ(T) = -RT \\ln K_{\\mathrm{eq}}(T)\n$$\n对于气相反应，$K_{\\mathrm{eq}}(T)$ 等同于 $K_p(T)$，即用相对于标准态压力 $p^\\circ$ 的分压表示的平衡常数。\n\n为确保数值稳定性和计算方便，我们使用平衡常数的自然对数：\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\frac{\\Delta_r G^\\circ(T)}{RT}\n$$\n代入 $G_i^\\circ(T)$、$H_i^\\circ(T)$ 和 $S_i^\\circ(T)$ 的表达式：\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\frac{1}{RT} \\sum_i \\nu_i \\left[ H_i^\\circ(T) - T S_i^\\circ(T) \\right] = -\\sum_i \\nu_i \\left[ \\frac{H_i^\\circ(T)}{RT} - \\frac{S_i^\\circ(T)}{R} \\right]\n$$\n使用 NASA 多项式的无量纲形式：\n$$\n\\ln K_{\\mathrm{eq}}(T) = -\\sum_i \\nu_i \\left( \\frac{h_i}{RT} - \\frac{s_i}{R} \\right) = \\sum_i \\nu_i \\left( \\frac{s_i}{R} - \\frac{h_i}{RT} \\right)\n$$\n\n### 4. 与微观可逆性和细致平衡的联系\n\n微观可逆性原理指出，在分子层面上，任何基元过程及其逆过程都以相等的概率发生，并遵循时间反演的路径。在平衡状态下，细致平衡原理作为其结果出现：每个基元正向反应的速率与相应的逆向反应的速率完全相等。\n\n对于基元反应 $A \\rightleftharpoons B$，细致平衡意味着 $k_f [A]_{\\text{eq}} = k_r [B]_{\\text{eq}}$，其中 $k_f$ 和 $k_r$ 分别是正向和逆向速率常数。这可以重新整理为：\n$$\n\\frac{k_f}{k_r} = \\frac{[B]_{\\text{eq}}}{[A]_{\\text{eq}}} = K_c(T)\n$$\n其中 $K_c(T)$ 是用浓度表示的平衡常数。基于浓度的常数 $K_c$ 与基于压力的常数 $K_p$（我们记为 $K_{\\mathrm{eq}}$）通过 $K_p = K_c (RT/p^\\circ)^{\\Delta\\nu}$ 相关联，其中 $\\Delta\\nu = \\sum_i \\nu_i$。\n\n从热力学数据（其本身源于统计力学的 NASA 多项式）推导出的 $K_{\\mathrm{eq}}(T)$ 值，对动力学速率常数的比率施加了严格的约束。任何有效的化学动力学机理的速率常数都必须满足机理中每个基元反应的这一热力学约束。因此，我们从第一性原理推导 $\\ln K_{\\mathrm{eq}}(T)$ 的过程，提供了必要的联系，以确保动力学模型与热力学第二定律和细致平衡原理相一致。\n\n### 5. 计算算法\n\n计算反应 $\\mathrm{H_2} + \\frac{1}{2}\\mathrm{O_2} \\rightarrow \\mathrm{H_2O}$ 的 $\\ln K_{\\mathrm{eq}}(T)$ 的最终算法如下：\n\n1.  对于给定的温度 $T$，根据 $T$ 是落在低温范围（$T \\le 1000\\,\\mathrm{K}$）还是高温范围（$T  1000\\,\\mathrm{K}$），为每种物质（$\\mathrm{H_2}$、$\\mathrm{O_2}$、$\\mathrm{H_2O}$）选择合适的七系数集 $\\{a_1, \\dots, a_7\\}$。\n\n2.  对于每种物质 $i$，使用 NASA 公式计算无量纲量 $h_i/(RT)$ 和 $s_i/R$。\n\n3.  计算反应的无量纲熵和焓的变化：\n    $$ \\Delta \\left(\\frac{s}{R}\\right) = \\sum_i \\nu_i \\frac{s_i}{R} = (1)\\frac{s_{\\mathrm{H_2O}}}{R} - (1)\\frac{s_{\\mathrm{H_2}}}{R} - (\\tfrac{1}{2})\\frac{s_{\\mathrm{O_2}}}{R} $$\n    $$ \\Delta \\left(\\frac{h}{RT}\\right) = \\sum_i \\nu_i \\frac{h_i}{RT} = (1)\\frac{h_{\\mathrm{H_2O}}}{RT} - (1)\\frac{h_{\\mathrm{H_2}}}{RT} - (\\tfrac{1}{2})\\frac{h_{\\mathrm{O_2}}}{RT} $$\n\n4.  使用推导出的关系计算平衡常数的自然对数：\n    $$ \\ln K_{\\mathrm{eq}}(T) = \\Delta \\left(\\frac{s}{R}\\right) - \\Delta \\left(\\frac{h}{RT}\\right) $$\n该过程将针对指定的测试温度实施。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the equilibrium constant for the H2/O2 reaction\n    using NASA seven-coefficient polynomials.\n    \"\"\"\n\n    # Define constants\n    R = 8.31446261815324  # J/mol/K\n\n    # Stoichiometric coefficients\n    stoich_coeffs = {\n        \"H2\": -1.0,\n        \"O2\": -0.5,\n        \"H2O\": 1.0,\n    }\n\n    # NASA 7-coefficient polynomial data for the species\n    nasa_data = {\n        \"H2\": {\n            \"low_coeffs\": np.array([\n                2.34433112e+00, 7.98052075e-03, -1.94781510e-05,\n                2.01572094e-08, -7.37611761e-12, -9.17935173e+02,\n                6.83010238e+00\n            ]),\n            \"high_coeffs\": np.array([\n                3.33727920e+00, -4.94024731e-05, 4.99456778e-07,\n                -1.79566394e-10, 2.00255376e-14, -9.50158922e+02,\n                -3.20502331e+00\n            ]),\n        },\n        \"O2\": {\n            \"low_coeffs\": np.array([\n                3.78245636e+00, -2.99673416e-03, 9.84730201e-06,\n                -9.68129509e-09, 3.24372837e-12, -1.06394356e+03,\n                3.65767573e+00\n            ]),\n            \"high_coeffs\": np.array([\n                3.28253784e+00, 1.48308754e-03, -7.57966669e-07,\n                2.09470555e-10, -2.16717794e-14, -1.08845772e+03,\n                5.45323129e+00\n            ]),\n        },\n        \"H2O\": {\n            \"low_coeffs\": np.array([\n                4.19864056e+00, -2.03643410e-03, 6.52040211e-06,\n                -5.48797062e-09, 1.77197817e-12, -3.02937267e+04,\n                -8.49032208e-01\n            ]),\n            \"high_coeffs\": np.array([\n                3.03399249e+00, 2.17691804e-03, -1.64072518e-07,\n                -9.70419870e-11, 1.68200992e-14, -3.00042971e+04,\n                4.96677010e+00\n            ]),\n        },\n    }\n\n    def get_thermo_properties(T, a):\n        \"\"\"\n        Calculates h/(RT) and s/R for a species at temperature T using its\n        7 coefficients.\n\n        Args:\n            T (float): Temperature in Kelvin.\n            a (np.ndarray): Array of 7 NASA coefficients.\n\n        Returns:\n            tuple: A tuple containing (h_over_RT, s_over_R).\n        \"\"\"\n        # h/(RT) = a1 + a2*T/2 + a3*T^2/3 + a4*T^3/4 + a5*T^4/5 + a6/T\n        h_over_RT = (\n            a[0] +\n            a[1] * T / 2.0 +\n            a[2] * T**2 / 3.0 +\n            a[3] * T**3 / 4.0 +\n            a[4] * T**4 / 5.0 +\n            a[5] / T\n        )\n\n        # s/R = a1*ln(T) + a2*T + a3*T^2/2 + a4*T^3/3 + a5*T^4/4 + a7\n        s_over_R = (\n            a[0] * np.log(T) +\n            a[1] * T +\n            a[2] * T**2 / 2.0 +\n            a[3] * T**3 / 3.0 +\n            a[4] * T**4 / 4.0 +\n            a[6]\n        )\n        \n        return h_over_RT, s_over_R\n\n    def calculate_ln_K_eq(T):\n        \"\"\"\n        Calculates the natural logarithm of the equilibrium constant at a\n        given temperature T.\n        \"\"\"\n        delta_h_over_RT = 0.0\n        delta_s_over_R = 0.0\n\n        for species, nu in stoich_coeffs.items():\n            species_data = nasa_data[species]\n            \n            # Select coefficients based on temperature range\n            # Low range: [200, 1000], High range: (1000, 6000]\n            if T = 1000.0:\n                coeffs = species_data[\"low_coeffs\"]\n            else:\n                coeffs = species_data[\"high_coeffs\"]\n\n            h_over_RT, s_over_R = get_thermo_properties(T, coeffs)\n\n            delta_h_over_RT += nu * h_over_RT\n            delta_s_over_R += nu * s_over_R\n\n        # ln(K_eq) = - (delta_G_circ / RT)\n        # delta_G_circ / RT = delta_H_circ / RT - delta_S_circ / R\n        delta_g_over_RT = delta_h_over_RT - delta_s_over_R\n        \n        ln_K_eq = -delta_g_over_RT\n        return ln_K_eq\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        298.15,   # Case A\n        1000.00,  # Case B (boundary)\n        2500.00   # Case C\n    ]\n\n    results = []\n    for T in test_cases:\n        result = calculate_ln_K_eq(T)\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "详细平衡原理不仅仅是一个理论上的概念，它对于化学动力学数值模拟的稳定性至关重要。本练习提供了一个极具说服力的数值证明 ：您将把一个系统设置在其热力学平衡点，并观察到只有当动力学速率常数满足详细平衡时，系统才能保持稳定。这个练习突显了违反该原则将如何导致非物理性的漂移，即使是从一个完美的平衡态开始。",
            "id": "4039319",
            "problem": "考虑一个与计算燃烧学相关的最小可逆反应机理，该机理表现出微观可逆性和细致平衡原理。该机理包含三种物质 $A$、$B$ 和 $C$，以及两个基元可逆反应：\n- 异构化：$A \\rightleftharpoons B$，\n- 二聚化：$A + B \\rightleftharpoons C$。\n\n假设一个等温、等容、充分混合的理想溶液。使用活度，其值等于由标准态 $1\\,\\mathrm{mol/L}$ 标度的无量纲浓度 $c_A$、$c_B$ 和 $c_C$，因此物质 $i$ 的活度为 $a_i = c_i$（无量纲）。设标准化学势为 $\\mu_A^\\circ$、$\\mu_B^\\circ$ 和 $\\mu_C^\\circ$（单位 $\\mathrm{J/mol}$）。绝对温度为 $T$（单位 $\\mathrm{K}$），普适气体常数为 $R = 8.314\\,\\mathrm{J/(mol\\,K)}$。\n\n基本原理：\n- 对于理想混合物，化学势为 $\\mu_i = \\mu_i^\\circ + RT \\ln c_i$。\n- 平衡源于在化学计量元素守恒约束下最小化总吉布斯自由能，从而为每个基元步骤产生与化学计量相符的化学势相等关系。\n- 细致平衡原理指出，在平衡组分 $c^\\star = (c_A^\\star, c_B^\\star, c_C^\\star)$ 下，每个基元反应的正向和逆向速率相等：$r_{f,i}(c^\\star) = r_{r,i}(c^\\star)$。\n- 基元反应的质量作用定律给出正向和逆向速率，对于 $A+B \\rightleftharpoons C$，$r_{f,1} = k_{1f} c_A c_B$，$r_{r,1} = k_{1r} c_C$；对于 $A \\rightleftharpoons B$，$r_{f,2} = k_{2f} c_A$，$r_{r,2} = k_{2r} c_B$。其中 $k_{1f}$、$k_{1r}$、$k_{2f}$ 和 $k_{2r}$ 是在所选的无量纲活度约定下，单位为 $\\mathrm{s^{-1}}$ 的速率常数。\n\n推导要求：\n1. 从理想混合物的化学势和化学计量关系出发，推导浓度之间的平衡关系：\n   - 对于异构化反应，证明平衡时 $\\mu_A = \\mu_B$ 意味着 $c_B^\\star = K_1 c_A^\\star$，其中 $K_1 = \\exp\\!\\big(-(\\mu_B^\\circ - \\mu_A^\\circ)/(RT)\\big)$。\n   - 对于二聚化反应，证明平衡时 $\\mu_C = \\mu_A + \\mu_B$ 意味着 $c_C^\\star = K_2 c_A^\\star c_B^\\star$，其中 $K_2 = \\exp\\!\\big(-(\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ)/(RT)\\big)$。\n2. 施加与化学计量一致的元素守恒约束：物质 $A$ 和 $B$ 各包含一个单位的守恒组分向量，物质 $C$ 包含两个单位。因此，标量守恒总量为 $N = c_A + c_B + 2 c_C$（无量纲）。利用平衡关系得到关于 $c_A^\\star$ 的二次方程，并求解其正根，然后计算 $c_B^\\star$ 和 $c_C^\\star$。\n3. 根据化学计量和质量作用定律推导物质浓度的常微分方程（ODEs）：\n   $$\\frac{dc_A}{dt} = -r_{f,1} + r_{r,1} - r_{f,2} + r_{r,2},\\quad \\frac{dc_B}{dt} = -r_{f,1} + r_{r,1} + r_{f,2} - r_{r,2},\\quad \\frac{dc_C}{dt} = r_{f,1} - r_{r,1}.$$\n4. 构建两种动力学参数化方案：\n   - 强制满足细致平衡：选择 $k_{2f}$ 和 $k_{2r}$ 使得 $k_{2f}/k_{2r} = K_1$，并选择 $k_{1f}$ 和 $k_{1r}$ 使得 $k_{1f}/k_{1r} = K_2$。\n   - 破坏细致平衡：对异构化反应的正向速率常数乘以因子 $(1+\\delta_2)$，对二聚化反应的正向速率常数乘以因子 $(1-\\delta_1)$ 进行扰动，使得 $k_{2f}/k_{2r} \\neq K_1$ 且 $k_{1f}/k_{1r} \\neq K_2$。\n5. 将机理初始化于步骤2中推导出的热力学平衡组分 $c^\\star$，然后在指定有限时间范围内积分常微分方程。计算与平衡态的最大絕對偏差：\n   $$\\Delta_{\\max} = \\max_{t \\in [0,t_{\\mathrm{end}}]} \\left\\|c(t) - c^\\star\\right\\|_{\\infty} = \\max_{t \\in [0,t_{\\mathrm{end}}]} \\max\\left\\{\\,|c_A(t)-c_A^\\star|,\\,|c_B(t)-c_B^\\star|,\\,|c_C(t)-c_C^\\star|\\,\\right\\}.$$\n6. 通过数值方法证明，当强制满足细致平衡时，$\\Delta_{\\max}$ 保持在一个严格的容差之下；而当细致平衡被破坏时，由于偏离平衡，$\\Delta_{\\max}$ 会超过一个较宽松的容差。\n\n单位：\n- $\\mu_i^\\circ$ 必须以 $\\mathrm{J/mol}$ 为单位提供。\n- $T$ 必须以 $\\mathrm{K}$ 为单位提供。\n- 时间必须以 $\\mathrm{s}$ 为单位。\n- 浓度 $c_i$ 是相对于标准态 $1\\,\\mathrm{mol/L}$ 的无量纲活度。\n\n测试套件与要求输出：\n实现一个程序，对下方的每个测试用例，执行步骤 1–5 中的计算，并返回一个布尔值。当且仅当以下两个条件同时成立时，该值为真：（i）强制满足细致平衡时，$\\Delta_{\\max} \\leq \\text{tol}_{\\mathrm{DB}}$；以及（ii）破坏细致平衡时，$\\Delta_{\\max}  \\text{tol}_{\\mathrm{nonDB}}$。\n\n提供以下测试用例，每个用例为一组参数：\n- 用例1（正常路径，中等动力学）：\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$，$\\mu_B^\\circ = 2965\\,\\mathrm{J/mol}$，$\\mu_C^\\circ = 16356\\,\\mathrm{J/mol}$，\n  - $T = 1000\\,\\mathrm{K}$，\n  - $N = 2.0$（无量纲），\n  - $k_{2r} = 0.5\\,\\mathrm{s^{-1}}$，$k_{1r} = 0.2\\,\\mathrm{s^{-1}}$，\n  - $\\delta_2 = 0.3$，$\\delta_1 = 0.3$，\n  - $t_{\\mathrm{end}} = 40\\,\\mathrm{s}$，\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$，$\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-6}$。\n- 用例2（边缘情况，近简并异构化和慢动力学）：\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$，$\\mu_B^\\circ = 341\\,\\mathrm{J/mol}$，$\\mu_C^\\circ = 46313\\,\\mathrm{J/mol}$，\n  - $T = 800\\,\\mathrm{K}$，\n  - $N = 1.0$（无量纲），\n  - $k_{2r} = 5\\times 10^{-4}\\,\\mathrm{s^{-1}}$，$k_{1r} = 1\\times 10^{-4}\\,\\mathrm{s^{-1}}$，\n  - $\\delta_2 = 0.5$，$\\delta_1 = 0.5$，\n  - $t_{\\mathrm{end}} = 20000\\,\\mathrm{s}$，\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$，$\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-7}$。\n- 用例3（边缘情况，强二聚化）：\n  - $\\mu_A^\\circ = 0\\,\\mathrm{J/mol}$，$\\mu_B^\\circ = 9160\\,\\mathrm{J/mol}$，$\\mu_C^\\circ = -13829\\,\\mathrm{J/mol}$，\n  - $T = 1200\\,\\mathrm{K}$，\n  - $N = 2.0$（无量纲），\n  - $k_{2r} = 0.8\\,\\mathrm{s^{-1}}$，$k_{1r} = 0.4\\,\\mathrm{s^{-1}}$，\n  - $\\delta_2 = 0.25$，$\\delta_1 = 0.25$，\n  - $t_{\\mathrm{end}} = 30\\,\\mathrm{s}$，\n  - $\\text{tol}_{\\mathrm{DB}} = 1\\times 10^{-9}$，$\\text{tol}_{\\mathrm{nonDB}} = 1\\times 10^{-6}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3]”），其中每个结果是对应测试用例的布尔值。不应打印任何其他文本。",
            "solution": "问题陈述在科学上是合理的、定义明确的，并提供了一套完整的参数和指令，用于数值化地演示化学反应系统中的细致平衡原理。该问题是有效的。\n\n此问题的核心在于证明：对于一个基元化学反应体系，由化学势相等定义的热力学平衡态，当且仅当动力学速率常数满足细致平衡原理时，它也是动力学速率方程的一个驻点。\n\n**1. 平衡关系的推导**\n\n对于一个恒温恒容的封闭系统，当总吉布斯自由能在元素守恒的约束下达到最小时，系统达到热力学平衡。对于一个基元反应，这种最小化意味着反应物和产物的化学势 $\\mu_i$ 之间存在特定关系。在理想混合物中，物质 $i$ 的化学势由 $\\mu_i = \\mu_i^\\circ + RT \\ln c_i$ 给出，其中 $\\mu_i^\\circ$ 是标准化学势，$R$ 是普适气体常数，$T$ 是绝对温度，$c_i$ 是无量纲浓度（活度）。\n\n对于异构化反应 $A \\rightleftharpoons B$，平衡条件是 $\\mu_A = \\mu_B$。\n$$ \\mu_A^\\circ + RT \\ln c_A^\\star = \\mu_B^\\circ + RT \\ln c_B^\\star $$\n重排各项以求解平衡浓度之比 $c_B^\\star/c_A^\\star$：\n$$ RT \\ln\\left(\\frac{c_B^\\star}{c_A^\\star}\\right) = \\mu_A^\\circ - \\mu_B^\\circ = -(\\mu_B^\\circ - \\mu_A^\\circ) $$\n$$ \\frac{c_B^\\star}{c_A^\\star} = \\exp\\left(-\\frac{\\mu_B^\\circ - \\mu_A^\\circ}{RT}\\right) $$\n这定义了第一个反应的平衡常数 $K_1$。因此，在平衡时，$c_B^\\star = K_1 c_A^\\star$。\n\n对于二聚化反应 $A + B \\rightleftharpoons C$，平衡条件是 $\\mu_A + \\mu_B = \\mu_C$。\n$$ (\\mu_A^\\circ + RT \\ln c_A^\\star) + (\\mu_B^\\circ + RT \\ln c_B^\\star) = \\mu_C^\\circ + RT \\ln c_C^\\star $$\n重排各项：\n$$ RT \\ln c_C^\\star - RT \\ln c_A^\\star - RT \\ln c_B^\\star = \\mu_A^\\circ + \\mu_B^\\circ - \\mu_C^\\circ $$\n$$ RT \\ln\\left(\\frac{c_C^\\star}{c_A^\\star c_B^\\star}\\right) = -(\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ) $$\n$$ \\frac{c_C^\\star}{c_A^\\star c_B^\\star} = \\exp\\left(-\\frac{\\mu_C^\\circ - \\mu_A^\\circ - \\mu_B^\\circ}{RT}\\right) $$\n这定义了第二个反应的平衡常数 $K_2$。因此，在平衡时，$c_C^\\star = K_2 c_A^\\star c_B^\\star$。\n\n**2. 平衡组分的计算**\n\n平衡浓度，记为 $c^\\star = (c_A^\\star, c_B^\\star, c_C^\\star)$，必须满足上面推导的两个平衡关系以及元素守恒约束。问题指定了一个守恒量 $N = c_A + c_B + 2 c_C$。在平衡时，这变为：\n$$ N = c_A^\\star + c_B^\\star + 2 c_C^\\star $$\n我们将平衡关系 $c_B^\\star = K_1 c_A^\\star$ 和 $c_C^\\star = K_2 c_A^\\star c_B^\\star = K_2 c_A^\\star (K_1 c_A^\\star) = K_1 K_2 (c_A^\\star)^2$ 代入守恒方程：\n$$ N = c_A^\\star + (K_1 c_A^\\star) + 2(K_1 K_2 (c_A^\\star)^2) $$\n重排此式可得到一个关于 $c_A^\\star$ 的二次方程：\n$$ (2 K_1 K_2) (c_A^\\star)^2 + (1 + K_1) c_A^\\star - N = 0 $$\n这是一个标准形式为 $ax^2 + bx + c = 0$ 的二次方程，其中 $x = c_A^\\star$，$a = 2 K_1 K_2$，$b = 1 + K_1$，$c = -N$。解由二次公式给出。由于浓度必须为非负量，且 $K_1$、$K_2$ 和 $N$ 均为正值，我们必须选择正根：\n$$ c_A^\\star = \\frac{-(1+K_1) + \\sqrt{(1+K_1)^2 - 4(2 K_1 K_2)(-N)}}{2(2 K_1 K_2)} = \\frac{-(1+K_1) + \\sqrt{(1+K_1)^2 + 8 K_1 K_2 N}}{4 K_1 K_2} $$\n一旦计算出 $c_A^\\star$，其他平衡浓度就可以直接得出：\n$$ c_B^\\star = K_1 c_A^\\star $$\n$$ c_C^\\star = K_1 K_2 (c_A^\\star)^2 $$\n\n**3. 动力学速率方程 (ODEs)**\n\n根据基元反应的质量作用定律，正向和逆向速率为：\n- $A+B \\rightleftharpoons C$：$r_{f,1} = k_{1f} c_A c_B$，$r_{r,1} = k_{1r} c_C$\n- $A \\rightleftharpoons B$：$r_{f,2} = k_{2f} c_A$，$r_{r,2} = k_{2r} c_B$\n\n每种物质的净变化速率是产生它的反应速率之和减去消耗它的反应速率之和。这得到以下常微分方程（ODEs）组：\n$$ \\frac{dc_A}{dt} = (r_{r,1} + r_{r,2}) - (r_{f,1} + r_{f,2}) = -k_{1f}c_A c_B + k_{1r}c_C - k_{2f}c_A + k_{2r}c_B $$\n$$ \\frac{dc_B}{dt} = (r_{r,1} + r_{f,2}) - (r_{f,1} + r_{r,2}) = -k_{1f}c_A c_B + k_{1r}c_C + k_{2f}c_A - k_{2r}c_B $$\n$$ \\frac{dc_C}{dt} = r_{f,1} - r_{r,1} = k_{1f}c_A c_B - k_{1r}c_C $$\n该方程组描述了物质浓度随时间的演变。\n\n**4. 强制满足和破坏细致平衡**\n\n细致平衡原理指出，在平衡时，*每个基元反应* 的正向和逆向速率相等。\n- 对于 $A \\rightleftharpoons B$：$k_{2f}c_A^\\star = k_{2r}c_B^\\star \\implies \\frac{k_{2f}}{k_{2r}} = \\frac{c_B^\\star}{c_A^\\star} = K_1$。\n- 对于 $A+B \\rightleftharpoons C$：$k_{1f}c_A^\\star c_B^\\star = k_{1r}c_C^\\star \\implies \\frac{k_{1f}}{k_{1r}} = \\frac{c_C^\\star}{c_A^\\star c_B^\\star} = K_2$。\n\n为了构建两种动力学参数化方案：\n- **强制满足细致平衡 (DB)：** 我们使用热力学平衡常数和给定的逆向速率常数来定义正向速率常数：\n  $k_{2f} = K_1 k_{2r}$ 和 $k_{1f} = K_2 k_{1r}$。使用这组常数，动力学系统是热力学一致的。\n- **破坏细致平衡 (non-DB)：** 我们对正向速率常数引入扰动 $\\delta_1$ 和 $\\delta_2$，从而违反热力学约束：\n  $k_{2f} = K_1 (1+\\delta_2) k_{2r}$ 和 $k_{1f} = K_2 (1-\\delta_1) k_{1r}$。速率常数之比不再等于平衡常数。\n\n**5.  6. 数值验证**\n\n关键的测试是将常微分方程系统精确地初始化在热力学平衡点 $c^\\star$。\n- 如果强制满足细致平衡，那么对于每个反应 $i$，$r_{f,i}(c^\\star) = r_{r,i}(c^\\star)$。每种物质的净变化速率将为零：$\\frac{dc_A}{dt} = \\frac{dc_B}{dt} = \\frac{dc_C}{dt} = 0$。系统处于一个驻点，不应发生演变。在数值积分过程中，任何偏离 $c^\\star$ 的情况都将完全归因于机器精度和求解器误差，因此 $\\Delta_{\\max}$ 应该非常小。\n- 如果细致平衡被破坏，那么至少对于一个反应，$r_{f,i}(c^\\star) \\neq r_{r,i}(c^\\star)$。净变化速率将不为零，导致系统立即从热力学平衡点 $c^\\star$ 漂移。这种漂移会随时间累积，导致一个显著的 $\\Delta_{\\max}$。\n\n程序将对每个测试用例执行这些步骤。它将计算 $c^\\star$，设置满足细致平衡（DB）和不满足细致平衡（non-DB）的动力学参数，从 $c(0)=c^\\star$ 开始积分常微分方程，计算两种情况下的最大偏差 $\\Delta_{\\max}$，并验证是否满足 $\\Delta_{\\max, \\mathrm{DB}} \\le \\text{tol}_{\\mathrm{DB}}$ 和 $\\Delta_{\\max, \\mathrm{nonDB}}  \\text{tol}_{\\mathrm{nonDB}}$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It demonstrates the principle of detailed balance in a chemical reaction system.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, moderate kinetics)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 2965.0, \"mu_C_circ\": 16356.0, \"T\": 1000.0,\n            \"N\": 2.0, \"k2r\": 0.5, \"k1r\": 0.2, \"delta2\": 0.3, \"delta1\": 0.3,\n            \"t_end\": 40.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-6\n        },\n        # Case 2 (edge case, near-degenerate isomerization and slow kinetics)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 341.0, \"mu_C_circ\": 46313.0, \"T\": 800.0,\n            \"N\": 1.0, \"k2r\": 5e-4, \"k1r\": 1e-4, \"delta2\": 0.5, \"delta1\": 0.5,\n            \"t_end\": 20000.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-7\n        },\n        # Case 3 (edge case, strong dimerization)\n        {\n            \"mu_A_circ\": 0.0, \"mu_B_circ\": 9160.0, \"mu_C_circ\": -13829.0, \"T\": 1200.0,\n            \"N\": 2.0, \"k2r\": 0.8, \"k1r\": 0.4, \"delta2\": 0.25, \"delta1\": 0.25,\n            \"t_end\": 30.0, \"tol_db\": 1e-9, \"tol_nondb\": 1e-6\n        }\n    ]\n\n    R = 8.314  # J/(mol K)\n    results = []\n\n    for case in test_cases:\n        # Unpack parameters\n        mu_A_circ, mu_B_circ, mu_C_circ = case[\"mu_A_circ\"], case[\"mu_B_circ\"], case[\"mu_C_circ\"]\n        T, N = case[\"T\"], case[\"N\"]\n        k1r, k2r = case[\"k1r\"], case[\"k2r\"]\n        delta1, delta2 = case[\"delta1\"], case[\"delta2\"]\n        t_end, tol_db, tol_nondb = case[\"t_end\"], case[\"tol_db\"], case[\"tol_nondb\"]\n\n        # Step 1: Calculate thermodynamic equilibrium constants\n        K1 = np.exp(-(mu_B_circ - mu_A_circ) / (R * T))\n        K2 = np.exp(-(mu_C_circ - mu_A_circ - mu_B_circ) / (R * T))\n\n        # Step 2: Solve for equilibrium concentrations\n        a_quad = 2 * K1 * K2\n        b_quad = 1 + K1\n        c_quad = -N\n\n        if np.abs(a_quad)  1e-15:\n            # Linear case, though not expected for the given test cases\n            c_A_star = -c_quad / b_quad\n        else:\n            # Quadratic case\n            discriminant = b_quad**2 - 4 * a_quad * c_quad\n            c_A_star = (-b_quad + np.sqrt(discriminant)) / (2 * a_quad)\n        \n        c_B_star = K1 * c_A_star\n        c_C_star = K1 * K2 * c_A_star**2\n        c_star = np.array([c_A_star, c_B_star, c_C_star])\n\n        # Step 3: Define the ODE system\n        def dcdt(t, c, k1f, k1r, k2f, k2r):\n            cA, cB, cC = c\n            r_f1 = k1f * cA * cB\n            r_r1 = k1r * cC\n            r_f2 = k2f * cA\n            r_r2 = k2r * cB\n            \n            dcA_dt = -r_f1 + r_r1 - r_f2 + r_r2\n            dcB_dt = -r_f1 + r_r1 + r_f2 - r_r2\n            dcC_dt =  r_f1 - r_r1\n            return [dcA_dt, dcB_dt, dcC_dt]\n\n        # Integration settings\n        t_span = [0, t_end]\n        t_eval = np.linspace(t_span[0], t_span[1], 500)\n\n        # === Detailed Balance Enforced Run ===\n        # Step 4 (DB): Set kinetically consistent rate constants\n        k1f_db = K2 * k1r\n        k2f_db = K1 * k2r\n        # Step 5 (DB): Integrate and compute deviation\n        ode_db_func = lambda t, c: dcdt(t, c, k1f_db, k1r, k2f_db, k2r)\n        sol_db = solve_ivp(ode_db_func, t_span, c_star, t_eval=t_eval, method='LSODA', rtol=1e-12, atol=1e-14)\n        deviation_db = np.abs(sol_db.y - c_star[:, np.newaxis])\n        delta_max_db = np.max(deviation_db)\n\n        # === Detailed Balance Broken Run ===\n        # Step 4 (non-DB): Set kinetically *inconsistent* rate constants\n        k1f_nondb = K2 * (1 - delta1) * k1r\n        k2f_nondb = K1 * (1 + delta2) * k2r\n        # Step 5 (non-DB): Integrate and compute deviation\n        ode_nondb_func = lambda t, c: dcdt(t, c, k1f_nondb, k1r, k2f_nondb, k2r)\n        sol_nondb = solve_ivp(ode_nondb_func, t_span, c_star, t_eval=t_eval, method='LSODA', rtol=1e-12, atol=1e-14)\n        deviation_nondb = np.abs(sol_nondb.y - c_star[:, np.newaxis])\n        delta_max_nondb = np.max(deviation_nondb)\n\n        # Step 6: Check conditions and record result\n        success_db = delta_max_db = tol_db\n        success_nondb = delta_max_nondb > tol_nondb\n        result = success_db and success_nondb\n        results.append(str(result))\n\n    # Format the final output string as required\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "对于包含多个反应路径并形成循环的复杂反应网络，仅确保每个反应的局部详细平衡是不够的，整个网络必须内部自洽。本练习将介绍韦格沙伊德条件，它是一个用于验证整个反应机理热力学完整性的强大工具 。通过实现一个基于图论的算法，您将学习如何自动检测反应循环中的不一致性，这是开发和验证大规模动力学模型的关键步骤。",
            "id": "4039343",
            "problem": "考虑一个在质量作用动力学框架下的、与计算燃烧学相关的可逆基元反应有限网络。设物种集合由 $i \\in \\{1,\\dots,N\\}$ 索引，可逆反应集合由 $j \\in \\{1,\\dots,M\\}$ 索引。每个反应 $j$ 都有一个正向速率常数 $k_j^+  0$ 和一个逆向速率常数 $k_j^-  0$，二者均以适合反应级数的、一致的物理单位表示。对于本问题中考虑的单分子互变网络，所有速率常数 $k_j^+$ 和 $k_j^-$ 的单位均取为 $\\mathrm{s^{-1}}$，因此比率 $K_j = k_j^+ / k_j^-$ 是无量纲的。\n\n微观可逆性原理意味着在热力学平衡状态下，反应层面满足细致平衡。Wegscheider 条件是代数约束，它指出在任何闭合反应环路中，平衡常数的乘积等于 $1$。等价地，沿任何循环，取带有适当方向的平衡常数的对数之和为 $0$。\n\n您的任务是设计并实现一个网络级别的测试，用于检测违反 Wegscheider 条件的循环，并使用此测试来说明这些代数约束与在闭合反应环路中强制实现细致平衡之间的等价性。将注意力限制在单分子互变网络上，其中反应形式为 $X_u \\rightleftharpoons X_v$，只有一个反应物和一个产物，因此正向反应的化学计量变化向量为 $-\\mathbf{e}_u + \\mathbf{e}_v$，其中 $\\mathbf{e}_u$ 是第 $u$ 个规范基向量。\n\n用作基本依据的定义：\n- 质量作用动力学：对于物种 $u$ 和 $v$ 之间的可逆反应 $j$，正向和逆向速率分别为 $r_j^+ = k_j^+ c_u$ 和 $r_j^- = k_j^- c_v$，其中 $c_u$ 和 $c_v$ 是摩尔浓度，单位为 $\\mathrm{mol/m^3}$。\n- 细致平衡：在平衡状态下，对于每个反应 $j$，$r_j^+ = r_j^-$。\n- 单分子基元互变的平衡常数：$K_j = \\dfrac{k_j^+}{k_j^-}$，当两个速率常数的单位均为 $\\mathrm{s^{-1}}$ 时，该常数是无量纲的。\n\n网络表示和循环测试：\n- 将物种表示为无向图中的节点，每个可逆反应 $j$ 表示为一条无向边 $\\{u,v\\}$，并存储其正向方向 $(u \\to v)$ 及相关的 $K_j = k_j^+ / k_j^-$。\n- 使用任何正确的生成树方法（例如广度优先搜索 (BFS)）提取图的基本循环基，以生成一组循环。这些循环是通过将每条非树边（弦）添加到其端点在生成树中的唯一路径上而形成的。\n- 对于每个循环，固定环路周围的一个方向，并计算平衡常数对数的带符号和，\n$$\n\\Delta = \\sum_{j \\in \\text{cycle}} \\sigma_j \\ln K_j,\n$$\n其中，如果边的遍历方向与其存储的正向方向一致，则 $\\sigma_j = +1$；如果遍历方向相反，则 $\\sigma_j = -1$。\n- 如果 $|\\Delta|$ 超过指定的容差 $\\tau  0$（无量纲），则该循环违反 Wegscheider 条件；等价地，$\\left|\\prod_{j \\in \\text{cycle}} K_j^{\\sigma_j} - 1\\right|$ 在数值容差之外不为零。\n\n实现一个程序，对于给定的网络测试套件，计算最大绝对循环对数和 $E = \\max_{\\text{cycles}} |\\Delta|$，并为每个网络返回一个布尔值，指示是否有任何循环违反 Wegscheider 条件，即 $E  \\tau$ 是否成立。\n\n角度单位不适用。所有速率常数必须以 $\\mathrm{s^{-1}}$ 为单位提供。所有对数均为自然对数。容差 $\\tau$ 是无量纲的。\n\n测试套件：\n- 案例 1（正常路径，单个三角形循环，无违反）：$N = 3$，边为 $(0,1)$、$(1,2)$、$(2,0)$，速率常数为\n  - $(0,1)$: $k^+ = 2.0\\,\\mathrm{s^{-1}}$, $k^- = 1.0\\,\\mathrm{s^{-1}}$，因此 $K = 2$；\n  - $(1,2)$: $k^+ = 3.0\\,\\mathrm{s^{-1}}$, $k^- = 1.0\\,\\mathrm{s^{-1}}$，因此 $K = 3$；\n  - $(2,0)$: $k^+ = 1.0\\,\\mathrm{s^{-1}}$, $k^- = 6.0\\,\\mathrm{s^{-1}}$，因此 $K = \\dfrac{1}{6}$；\n  使用 $\\tau = 10^{-9}$。\n- 案例 2（单个三角形循环，有违反）：$N = 3$，边为 $(0,1)$、$(1,2)$、$(2,0)$，速率常数为\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$，因此 $K = 2$；\n  - $(1,2)$: $k^+ = 3.0$, $k^- = 1.0$，因此 $K = 3$；\n  - $(2,0)$: $k^+ = 1.0$, $k^- = 4.0$，因此 $K = \\dfrac{1}{4}$；\n  使用 $\\tau = 10^{-9}$。\n- 案例 3（单个三角形循环，因容差而处于边界条件的未违反情况）：$N = 3$，边为 $(0,1)$、$(1,2)$、$(2,0)$，速率常数为\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$，因此 $K = 2$；\n  - $(1,2)$: $k^+ = 3.0$, $k^- = 1.0$，因此 $K = 3$；\n  - $(2,0)$: $k^+ = 1.0$, $k^- = \\dfrac{6.0}{1+10^{-10}}$，因此 $K = \\dfrac{1+10^{-10}}{6}$；\n  使用 $\\tau = 10^{-9}$。\n- 案例 4（无循环）：$N = 2$，有一条边 $(0,1)$，速率常数为\n  - $(0,1)$: $k^+ = 5.0$, $k^- = 2.5$，因此 $K = 2$；\n  使用 $\\tau = 10^{-9}$。\n- 案例 5（多个循环，其中一个违反）：$N = 4$，边为 $(0,1)$、$(1,2)$、$(2,3)$、$(3,0)$、$(0,2)$，速率常数为\n  - $(0,1)$: $k^+ = 2.0$, $k^- = 1.0$，因此 $K = 2$；\n  - $(1,2)$: $k^+ = 2.0$, $k^- = 1.0$，因此 $K = 2$；\n  - $(2,3)$: $k^+ = 0.5$, $k^- = 1.0$，因此 $K = \\dfrac{1}{2}$；\n  - $(3,0)$: $k^+ = 0.5$, $k^- = 1.0$，因此 $K = \\dfrac{1}{2}$；\n  - $(0,2)$: $k^+ = 3.0$, $k^- = 1.0$，因此 $K = 3$；\n  使用 $\\tau = 10^{-9}$。\n\n要求的最终输出格式：\n- 您的程序应生成一行输出，其中包含以上五个案例的结果，结果为逗号分隔的列表，并用方括号括起来，顺序与案例一致。每个条目必须是一个布尔值，指示该案例中是否有任何循环违反 Wegscheider 条件，即 $E  \\tau$ 是否成立。例如，一个有效的输出看起来像 $[{\\texttt{False}},{\\texttt{True}},\\dots]$。",
            "solution": "该问题要求设计并实现一个计算测试，以验证可逆单分子反应网络的热力学一致性。此性质体现在 Wegscheider 条件中，是微观可逆性原理以及由此产生的、在热力学平衡时必须满足的细致平衡的直接结果。\n\n基本原理是，对于一个处于平衡状态的系统，每个基元过程都必须与其逆过程处于平衡状态。这就是细致平衡原理。对于单分子反应 $X_u \\rightleftharpoons X_v$，其正向速率常数为 $k_{uv}^+$，逆向速率常数为 $k_{vu}^-$，则正向速率为 $r^+ = k_{uv}^+ c_u$，逆向速率为 $r^- = k_{vu}^- c_v$，其中 $c_u$ 和 $c_v$ 分别是物种 $X_u$ 和 $X_v$ 的浓度。在平衡时，浓度为 $c_u^{\\mathrm{eq}}$ 和 $c_v^{\\mathrm{eq}}$，细致平衡要求 $r^+ = r^-$。这得到 $k_{uv}^+ c_u^{\\mathrm{eq}} = k_{vu}^- c_v^{\\mathrm{eq}}$。因此，平衡浓度的比率通过平衡常数 $K_{uv}$ 与速率常数相关联：\n$$\n\\frac{c_v^{\\mathrm{eq}}}{c_u^{\\mathrm{eq}}} = \\frac{k_{uv}^+}{k_{vu}^-} = K_{uv}\n$$\n其中，对于所考虑的单分子反应，当速率常数单位为 $\\mathrm{s}^{-1}$ 时，$K_{uv}$ 是无量纲的。\n\n现在，考虑一个闭合的反应循环，例如 $X_1 \\rightleftharpoons X_2 \\rightleftharpoons \\dots \\rightleftharpoons X_L \\rightleftharpoons X_1$。在平衡时，必须同时满足以下关系：\n$$\n\\frac{c_2^{\\mathrm{eq}}}{c_1^{\\mathrm{eq}}} = K_{12}, \\quad \\frac{c_3^{\\mathrm{eq}}}{c_2^{\\mathrm{eq}}} = K_{23}, \\quad \\dots, \\quad \\frac{c_1^{\\mathrm{eq}}}{c_L^{\\mathrm{eq}}} = K_{L1}\n$$\n将这些方程相乘得到：\n$$\n\\left(\\frac{c_2^{\\mathrm{eq}}}{c_1^{\\mathrm{eq}}}\\right) \\left(\\frac{c_3^{\\mathrm{eq}}}{c_2^{\\mathrm{eq}}}\\right) \\dots \\left(\\frac{c_1^{\\mathrm{eq}}}{c_L^{\\mathrm{eq}}}\\right) = K_{12} K_{23} \\dots K_{L1}\n$$\n左侧恒等于 $1$。因此，沿任何闭合环路的平衡常数之积也必须等于 $1$。这就是 Wegscheider 条件。对该乘积取自然对数，得到等价的加法形式：\n$$\n\\sum_{j \\in \\text{cycle}} \\sigma_j \\ln K_j = 0\n$$\n其中 $\\sigma_j = +1$ 或 $\\sigma_j = -1$ 取决于反应 $j$ 的遍历方向相对于其定义的正向方向。一个对所有可能的循环都满足此条件的网络是热力学一致的。\n\n为了实现对该条件的测试，我们可以将反应网络建模为一个图，其中物种是节点，反应是边。检查所有循环的问题可以通过认识到图中的任何循环都可以由一组基本循环的线性组合（对称差）构造出来而得以简化。因此，只需对一个基本循环基验证 Wegscheider 条件即可。\n\n算法流程如下：\n\n$1$. **图表示**：将 $N$ 个物种表示为节点 $\\{0, 1, \\dots, N-1\\}$。物种 $u$ 和 $v$ 之间的每个可逆反应是一条边。我们存储一个已定义正向（例如 $u \\to v$）的平衡常数的自然对数，即 $\\ln K_{uv}$。为了连通性目的，该图被视为无向图，但平衡常数的方向信息被保留。\n\n$2$. **分解与生成树构建**：一个反应网络可能包含多个不连通的组件。算法必须独立分析每个组件。对于每个连通组件，我们使用图遍历算法（如广度优先搜索，BFS）构建一个生成树。这将组件的边划分为树边和非树边（也称为弦）。\n\n$3$. **基本循环识别**：每条弦添加到生成树中时，都会形成唯一一个基本循环。该循环由弦本身以及连接弦端点的在生成树中的唯一路径组成。\n\n$4$. **热力学势计算**：为每个基本循环计算对数和 $\\Delta$ 的一种高效方法是为每个节点 $i$ 定义一个“热力学势” $\\phi_i$。在一个连通组件内，我们可以任意地将一个参考节点（BFS 树的根节点）的势设为零：$\\phi_{\\text{root}} = 0$。然后，任何其他节点 $u$ 的势定义为从根节点到 $u$ 的生成树唯一路径上带符号的 $\\ln K_j$ 值的总和：\n$$\n\\phi_u = \\sum_{j \\in \\text{path}(\\text{root} \\to u)} \\sigma_j \\ln K_j\n$$\n在构建生成树的 BFS 遍历过程中，可以在一次遍历中计算出所有节点的这些势。如果节点 $v$ 的父节点是 $u$，那么假设正向是 $u \\to v$，则有 $\\phi_v = \\phi_u + \\ln K_{uv}$。\n\n$5$. **循环违规测试**：对于连接节点 $u$ 和 $v$ 的每条弦（其正向平衡常数为 $K_{uv}$），相应基本循环的对数和由下式给出：\n$$\n\\Delta = \\ln K_{uv} - (\\phi_v - \\phi_u)\n$$\n在这里，$(\\phi_v - \\phi_u)$ 表示沿从 $u$ 到 $v$ 的树路径的对数常数之和。因此，该方程计算了由弦 $(u,v)$ 闭合的循环的对数和。Wegscheider 条件要求 $\\Delta = 0$。我们通过检查 $|\\Delta|  \\tau$ 来进行数值检验，其中 $\\tau$ 是一个小的正容差。\n\n$6$. **最终判定**：该算法计算图中每个基本循环的 $|\\Delta|$。确定最大绝对值 $E = \\max_{\\text{cycles}} |\\Delta|$。如果 $E  \\tau$，则判定该网络违反 Wegscheider 条件。对于没有循环的网络（树或森林），$E$ 显然为 $0$。\n\n该过程提供了一种严谨且计算高效的方法，用于测试任何反应网络的热力学一致性，将抽象的代数条件建立在具体的图论算法之上。实现将根据此逻辑处理所提供的测试案例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Solves the problem by testing a series of reaction networks for violations\n    of the Wegscheider conditions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Happy path, single triangle cycle, no violation\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 3.0, 1.0),  # K = 3.0\n                (2, 0, 1.0, 6.0),  # K = 1/6\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 2: Single triangle cycle, violation\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 3.0, 1.0),  # K = 3.0\n                (2, 0, 1.0, 4.0),  # K = 1/4\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 3: Near-boundary non-violation due to tolerance\n        {\n            \"N\": 3,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),             # K = 2.0\n                (1, 2, 3.0, 1.0),             # K = 3.0\n                (2, 0, 1.0, 6.0 / (1 + 1e-10)), # K = (1+1e-10)/6\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 4: No cycles\n        {\n            \"N\": 2,\n            \"edges\": [\n                (0, 1, 5.0, 2.5),  # K = 2.0\n            ],\n            \"tau\": 1e-9,\n        },\n        # Case 5: Multiple cycles, one violating\n        {\n            \"N\": 4,\n            \"edges\": [\n                (0, 1, 2.0, 1.0),  # K = 2.0\n                (1, 2, 2.0, 1.0),  # K = 2.0\n                (2, 3, 0.5, 1.0),  # K = 0.5\n                (3, 0, 0.5, 1.0),  # K = 0.5\n                (0, 2, 3.0, 1.0),  # K = 3.0\n            ],\n            \"tau\": 1e-9,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case[\"N\"]\n        edges = case[\"edges\"]\n        tau = case[\"tau\"]\n\n        # Build graph representation\n        adj = {i: [] for i in range(N)}\n        log_K_map = {}\n        for u, v, k_plus, k_minus in edges:\n            adj[u].append(v)\n            adj[v].append(u)\n            log_K_map[(u, v)] = np.log(k_plus / k_minus)\n\n        visited = [False] * N\n        max_abs_delta = 0.0\n\n        # Iterate through all nodes to handle disconnected components\n        for i in range(N):\n            if not visited[i]:\n                # New connected component found\n                root = i\n                potentials = {}\n                parent = {}\n                \n                visited[root] = True\n                potentials[root] = 0.0\n                parent[root] = None\n                \n                # BFS to build spanning tree and find non-tree edges (chords)\n                bfs_q = deque([root])\n                chords = []\n\n                while bfs_q:\n                    u = bfs_q.popleft()\n                    for v in adj[u]:\n                        if v == parent.get(u):\n                            continue # Skip edge leading back to parent in the tree\n                        \n                        if not visited[v]: # Tree edge\n                            visited[v] = True\n                            parent[v] = u\n                            bfs_q.append(v)\n\n                            # Calculate potential of v\n                            if (u, v) in log_K_map:\n                                logK_uv = log_K_map[(u, v)]\n                            else: # The edge must be stored in reverse\n                                logK_uv = -log_K_map.get((v, u), 0.0)\n                            potentials[v] = potentials[u] + logK_uv\n                        else: # Non-tree edge (chord)\n                            # Ensure we only add each chord once\n                            if u  v:\n                                chords.append((u, v))\n                \n                # Calculate cycle log-sums for this component\n                for u, v in chords:\n                    if (u, v) in log_K_map:\n                        logK_uv = log_K_map[(u, v)]\n                    else:\n                        logK_uv = -log_K_map.get((v, u), 0.0)\n                    \n                    # Cycle sum is based on potentials derived from the spanning tree\n                    delta = logK_uv - (potentials[v] - potentials[u])\n                    max_abs_delta = max(max_abs_delta, abs(delta))\n\n        # Check if the max violation exceeds the tolerance\n        results.append(str(max_abs_delta > tau).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}