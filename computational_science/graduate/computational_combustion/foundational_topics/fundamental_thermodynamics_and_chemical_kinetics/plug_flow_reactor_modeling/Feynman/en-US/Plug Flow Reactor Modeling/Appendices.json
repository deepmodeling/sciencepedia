{
    "hands_on_practices": [
        {
            "introduction": "Understanding the relationship between reactor size, reaction kinetics, and desired conversion is the foundation of chemical reactor design. This first practice guides you through the derivation of the essential Plug Flow Reactor (PFR) design equation from a fundamental mole balance. By applying this equation to both first-order and second-order irreversible reactions, you will gain a hands-on appreciation for how reaction kinetics directly influence the required reactor volume, a critical skill for process design and optimization .",
            "id": "3872934",
            "problem": "A liquid-phase, isothermal, irreversible isomerization of species $A$ to $B$ is carried out in a Plug Flow Reactor (PFR). The feed contains only $A$ at a molar flow rate $F_{A0}$ and concentration $C_{A0}$. The density is constant, volumetric flow is constant, there are no side reactions, and axial dispersion is negligible. Depending on the candidate microkinetic mechanism, the rate-of-disappearance of $A$ may be first-order or second-order in $A$:\n- First-order hypothesis: $-r_{A} = k_{1} C_{A}$ with $k_{1}$ a constant.\n- Second-order hypothesis: $-r_{A} = k_{2} C_{A}^{2}$ with $k_{2}$ a constant.\n\nStarting from the steady-state mole balance on a differential reactor slice and the definition of conversion, derive the PFR design equation $\\mathrm{d}X/\\mathrm{d}V = -r_{A}/F_{A0}$. Then, using the liquid-phase, constant-density relation $C_{A} = C_{A0}(1-X)$, integrate to obtain the reactor volume $V$ as a function of conversion $X$ under each kinetic hypothesis. For a target conversion $X = 0.85$ at $T$ constant, feed molar flow $F_{A0} = 10\\ \\mathrm{kmol}/\\mathrm{h}$, feed concentration $C_{A0} = 1.0\\ \\mathrm{kmol}/\\mathrm{m}^{3}$, first-order rate constant $k_{1} = 0.75\\ \\mathrm{h}^{-1}$, and second-order rate constant $k_{2} = 1.6\\ \\mathrm{m}^{3}/(\\mathrm{kmol}\\cdot\\mathrm{h})$, compute the dimensionless ratio of reactor volumes $V_{\\text{second}}/V_{\\text{first}}$ required to achieve $X = 0.85$ under the two kinetic hypotheses. Round your final ratio to four significant figures and report it as a pure number with no units.",
            "solution": "The problem statement is evaluated to be scientifically grounded, well-posed, objective, complete, and consistent. It represents a standard problem in chemical reactor design. Therefore, a full solution is warranted.\n\nThe solution proceeds in three stages as requested: first, the derivation of the Plug Flow Reactor (PFR) design equation in terms of conversion; second, the integration of this equation for first-order and second-order kinetics to find the required reactor volume $V$ as a function of conversion $X$; and third, the calculation of the numerical ratio of the volumes for the two kinetic models under the specified conditions.\n\n**1. Derivation of the PFR Design Equation**\n\nWe begin with a mole balance on species $A$ over a differential volume element $\\mathrm{d}V$ of the PFR operating at steady state. The general mole balance equation is:\n$$\n\\text{Flow in} - \\text{Flow out} + \\text{Generation} = \\text{Accumulation}\n$$\nFor a differential slice from volume $V$ to $V + \\mathrm{d}V$, and for species $A$, this translates to:\n$$\nF_{A}|_{V} - F_{A}|_{V+\\mathrm{d}V} + r_{A} \\mathrm{d}V = 0\n$$\nwhere $F_A$ is the molar flow rate of $A$ and $r_A$ is the rate of formation of $A$ per unit volume. The accumulation term is zero due to the steady-state assumption.\nThe term $F_{A}|_{V+\\mathrm{d}V}$ can be expressed as a Taylor series expansion around $V$: $F_{A}|_{V+\\mathrm{d}V} = F_{A}|_{V} + \\frac{\\mathrm{d}F_A}{\\mathrm{d}V}\\mathrm{d}V + \\dots$. Neglecting higher-order terms, the balance becomes:\n$$\nF_{A}|_{V} - \\left( F_{A}|_{V} + \\frac{\\mathrm{d}F_A}{\\mathrm{d}V}\\mathrm{d}V \\right) + r_{A} \\mathrm{d}V = 0\n$$\n$$\n-\\frac{\\mathrm{d}F_A}{\\mathrm{d}V}\\mathrm{d}V + r_{A} \\mathrm{d}V = 0\n$$\nDividing by $\\mathrm{d}V$ gives the PFR design equation in terms of molar flow rate:\n$$\n\\frac{\\mathrm{d}F_A}{\\mathrm{d}V} = r_A\n$$\nThe fractional conversion $X$ of reactant $A$ is defined as the fraction of the initial moles of $A$ that have reacted:\n$$\nX = \\frac{F_{A0} - F_A}{F_{A0}}\n$$\nwhere $F_{A0}$ is the molar feed rate of $A$ at the reactor inlet ($V=0$). Rearranging for $F_A$ gives:\n$$\nF_A = F_{A0}(1-X)\n$$\nSince $F_{A0}$ is a constant, differentiating $F_A$ with respect to the reactor volume $V$ yields:\n$$\n\\frac{\\mathrm{d}F_A}{\\mathrm{d}V} = \\frac{\\mathrm{d}}{\\mathrm{d}V}[F_{A0}(1-X)] = -F_{A0}\\frac{\\mathrm{d}X}{\\mathrm{d}V}\n$$\nSubstituting this result into the mole balance $\\frac{\\mathrm{d}F_A}{\\mathrm{d}V} = r_A$ gives:\n$$\n-F_{A0}\\frac{\\mathrm{d}X}{\\mathrm{d}V} = r_A\n$$\nFinally, we rearrange to obtain the requested form of the PFR design equation in terms of conversion $X$ and the rate of disappearance of $A$, $-r_A = -r_{A, \\text{formation}} = r_{A, \\text{disappearance}}$:\n$$\n\\frac{\\mathrm{d}X}{\\mathrm{d}V} = \\frac{-r_A}{F_{A0}}\n$$\nThis completes the first part of the derivation.\n\n**2. Reactor Volume as a Function of Conversion**\n\nFor a liquid-phase reaction with constant density, the volumetric flow rate $v$ is constant. The concentration of species $A$, $C_A$, is related to its molar flow rate $F_A$ by $C_A = F_A/v$. At the inlet, $C_{A0} = F_{A0}/v_{0}$. Since $v=v_0$, we can write:\n$$\nC_A = \\frac{F_A}{v_0} = \\frac{F_{A0}(1-X)}{v_0} = C_{A0}(1-X)\n$$\nThis confirms the relation provided in the problem statement. Now we integrate the design equation for each kinetic hypothesis.\n\nThe design equation can be separated and integrated to find the volume $V$ required to achieve a conversion $X$:\n$$\nV = F_{A0} \\int_{0}^{X} \\frac{1}{-r_A} \\mathrm{d}X'\n$$\n\n**First-Order Hypothesis:**\nThe rate law is $-r_A = k_1 C_A$. Substituting the concentration expression, we get:\n$$\n-r_A = k_1 C_{A0}(1-X)\n$$\nSubstituting this into the integral form of the design equation:\n$$\nV_{\\text{first}} = F_{A0} \\int_{0}^{X} \\frac{1}{k_1 C_{A0}(1-X')} \\mathrm{d}X'\n$$\nSince $F_{A0}$, $k_1$, and $C_{A0}$ are constants, we can take them out of the integral:\n$$\nV_{\\text{first}} = \\frac{F_{A0}}{k_1 C_{A0}} \\int_{0}^{X} \\frac{1}{1-X'} \\mathrm{d}X' = \\frac{F_{A0}}{k_1 C_{A0}} [-\\ln(1-X')]_{0}^{X}\n$$\n$$\nV_{\\text{first}} = \\frac{F_{A0}}{k_1 C_{A0}} [-\\ln(1-X) - (-\\ln(1-0))] = -\\frac{F_{A0}}{k_1 C_{A0}} \\ln(1-X) = \\frac{F_{A0}}{k_1 C_{A0}} \\ln\\left(\\frac{1}{1-X}\\right)\n$$\n\n**Second-Order Hypothesis:**\nThe rate law is $-r_A = k_2 C_A^2$. Substituting the concentration expression:\n$$\n-r_A = k_2 (C_{A0}(1-X))^2 = k_2 C_{A0}^2 (1-X)^2\n$$\nSubstituting this into the integral design equation:\n$$\nV_{\\text{second}} = F_{A0} \\int_{0}^{X} \\frac{1}{k_2 C_{A0}^2 (1-X')^2} \\mathrm{d}X'\n$$\nTaking the constants out of the integral:\n$$\nV_{\\text{second}} = \\frac{F_{A0}}{k_2 C_{A0}^2} \\int_{0}^{X} (1-X')^{-2} \\mathrm{d}X' = \\frac{F_{A0}}{k_2 C_{A0}^2} \\left[\\frac{1}{1-X'}\\right]_{0}^{X}\n$$\n$$\nV_{\\text{second}} = \\frac{F_{A0}}{k_2 C_{A0}^2} \\left(\\frac{1}{1-X} - \\frac{1}{1-0}\\right) = \\frac{F_{A0}}{k_2 C_{A0}^2} \\left(\\frac{1 - (1-X)}{1-X}\\right)\n$$\n$$\nV_{\\text{second}} = \\frac{F_{A0}}{k_2 C_{A0}^2} \\left(\\frac{X}{1-X}\\right)\n$$\n\n**3. Calculation of the Ratio of Reactor Volumes**\n\nWe now compute the ratio $V_{\\text{second}}/V_{\\text{first}}$ using the derived expressions:\n$$\n\\frac{V_{\\text{second}}}{V_{\\text{first}}} = \\frac{\\frac{F_{A0}}{k_2 C_{A0}^2} \\left(\\frac{X}{1-X}\\right)}{\\frac{F_{A0}}{k_1 C_{A0}} \\ln\\left(\\frac{1}{1-X}\\right)}\n$$\nSimplifying the expression by canceling terms ($F_{A0}$ and one factor of $C_{A0}$):\n$$\n\\frac{V_{\\text{second}}}{V_{\\text{first}}} = \\frac{k_1}{k_2 C_{A0}} \\frac{\\left(\\frac{X}{1-X}\\right)}{\\ln\\left(\\frac{1}{1-X}\\right)}\n$$\nThis is the final symbolic expression for the ratio. Now, we substitute the given numerical values:\n- Target conversion $X = 0.85$.\n- First-order rate constant $k_1 = 0.75\\ \\mathrm{h}^{-1}$.\n- Second-order rate constant $k_2 = 1.6\\ \\mathrm{m}^{3}/(\\mathrm{kmol}\\cdot\\mathrm{h})$.\n- Feed concentration $C_{A0} = 1.0\\ \\mathrm{kmol}/\\mathrm{m}^{3}$.\n\nFirst, calculate the intermediate terms:\n$$\n1 - X = 1 - 0.85 = 0.15\n$$\n$$\n\\frac{X}{1-X} = \\frac{0.85}{0.15} = \\frac{17}{3}\n$$\n$$\n\\frac{1}{1-X} = \\frac{1}{0.15} = \\frac{20}{3}\n$$\n$$\n\\ln\\left(\\frac{1}{1-X}\\right) = \\ln\\left(\\frac{20}{3}\\right)\n$$\nNow, substitute these into the ratio expression along with the constants:\n$$\n\\frac{V_{\\text{second}}}{V_{\\text{first}}} = \\frac{0.75\\ \\mathrm{h}^{-1}}{(1.6\\ \\mathrm{m}^{3}/(\\mathrm{kmol}\\cdot\\mathrm{h})) (1.0\\ \\mathrm{kmol}/\\mathrm{m}^{3})} \\frac{\\frac{17}{3}}{\\ln\\left(\\frac{20}{3}\\right)}\n$$\nThe units in the first term cancel out, as expected for a dimensionless ratio:\n$$\n\\frac{V_{\\text{second}}}{V_{\\text{first}}} = \\frac{0.75}{1.6} \\frac{\\frac{17}{3}}{\\ln\\left(\\frac{20}{3}\\right)} = 0.46875 \\times \\frac{5.666...}{1.8971199...}\n$$\n$$\n\\frac{V_{\\text{second}}}{V_{\\text{first}}} = 0.46875 \\times 2.986980... \\approx 1.399678...\n$$\nRounding the final result to four significant figures gives $1.400$.",
            "answer": "$$\n\\boxed{1.400}\n$$"
        },
        {
            "introduction": "Building upon the isothermal case, we now address the more realistic scenario where temperature changes along the reactor due to the heat of reaction. This practice challenges you to model an adiabatic PFR, coupling the mole balance with the energy balance to track both composition and temperature profiles simultaneously. You will explore how an endothermic, reversible reaction approaches a temperature-dependent equilibrium, a classic case where thermodynamic limitations, not just kinetic rates, can \"stall\" the reactor's progress and dictate its ultimate performance .",
            "id": "3894917",
            "problem": "Consider a steady-state, adiabatic Plug Flow Reactor (PFR) performing a single, elementary, reversible, endothermic reaction between two gas-phase species, where $A \\rightleftharpoons B$. The reactor has constant cross-sectional area and operates at constant pressure. The feed may contain an inert species $I$. The total molar flow $F_{\\text{tot}}$ is the sum of the molar flows of $A$, $B$, and $I$. The following fundamental bases must be used to derive the model:\n- The one-dimensional, steady-state molar balance for species $i$ in a PFR is $dF_i/dz = \\nu_i r V'$ where $z$ is the axial coordinate in $\\text{m}$, $\\nu_i$ is the stoichiometric coefficient of species $i$, $r$ is the rate of progress of reaction in $\\text{mol}/(\\text{m}^3\\cdot\\text{s})$, and $V' = A_c$ is the reactor cross-sectional area in $\\text{m}^2$.\n- The one-dimensional, steady-state energy balance for an adiabatic PFR is $dT/dz = -\\Delta H_{\\text{rxn}}\\, r\\, A_c / \\left(\\sum_j F_j C_{p,j}\\right)$, where $T$ is temperature in $\\text{K}$, $\\Delta H_{\\text{rxn}} > 0$ is the endothermic reaction enthalpy in $\\text{J}/\\text{mol}$, $C_{p,j}$ is the constant-pressure molar heat capacity of species $j$ in $\\text{J}/(\\text{mol}\\cdot\\text{K})$, and the sum runs over all species present.\n- The ideal gas law implies $C_{\\text{tot}} = P/(R T)$ for the total molar concentration in $\\text{mol}/\\text{m}^3$, with $P$ in $\\text{Pa}$ and the universal gas constant $R$ in $\\text{J}/(\\text{mol}\\cdot\\text{K})$. The partial concentrations are $C_i = y_i C_{\\text{tot}}$ with $y_i = F_i/F_{\\text{tot}}$.\n- The rate law for an elementary reversible reaction is $r = k_f(T) C_A - k_r(T) C_B$ with Arrhenius kinetics $k_f(T) = k_{0,f} \\exp\\!\\left(-E_f/(R T)\\right)$, where $k_{0,f}$ is a pre-exponential factor in $\\text{s}^{-1}$ and $E_f$ is the forward activation energy in $\\text{J}/\\text{mol}$. Thermodynamic consistency requires $k_r(T) = k_f(T)/K_{\\text{eq}}(T)$.\n- The van't Hoff relation for the equilibrium constant $K_{\\text{eq}}(T)$ is $d\\ln K_{\\text{eq}}/dT = \\Delta H_{\\text{rxn}}/(R T^2)$, which integrates to $\\ln K_{\\text{eq}}(T) = \\ln K_{\\text{ref}} + \\Delta H_{\\text{rxn}}/R \\left(1/T_{\\text{ref}} - 1/T\\right)$ when $K_{\\text{eq}}(T_{\\text{ref}}) = K_{\\text{ref}}$ is known at a reference temperature $T_{\\text{ref}}$.\n- The reaction quotient under the ideal gas approximation is $Q = y_B/y_A$.\n\nDefine a \"near-equilibrium stall\" position $z^\\star$ as the smallest axial position where the dimensionless closeness metric satisfies $\\left|\\ln\\!\\left(Q/K_{\\text{eq}}(T)\\right)\\right| \\le \\tau$, with a prescribed tolerance $\\tau > 0$. If no such position occurs within the reactor length, report $z^\\star = -1.0$.\n\nYour task is to:\n1. Derive the coupled differential equations from these bases for $F_A(z)$, $F_B(z)$, and $T(z)$ in terms of the parameters, and articulate how the temperature-dependent equilibrium impacts the reverse rate through $k_r(T) = k_f(T)/K_{\\text{eq}}(T)$.\n2. Implement a robust numerical solver that integrates the coupled system along $z$ from the inlet to a specified maximum length, detecting the first axial position $z^\\star$ where $\\left|\\ln\\!\\left(Q/K_{\\text{eq}}(T)\\right)\\right| \\le \\tau$. Use an event detection strategy that is numerically well-posed when $y_A$ or $y_B$ are very small.\n3. For each test case below, compute $z^\\star$ in $\\text{m}$, rounded to six decimal places. If no stall is detected within the reactor length, return $-1.000000$.\n\nUse the universal gas constant $R = 8.31446261815324\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$.\n\nTest Suite:\n- Case 1 (endothermic with inert, strong temperature drop):\n  - $A_c = 0.01\\,\\text{m}^2$\n  - $P = 2.0\\times 10^5\\,\\text{Pa}$\n  - $T_{\\text{in}} = 800.0\\,\\text{K}$\n  - $F_{A,0} = 1.0\\,\\text{mol}/\\text{s}$, $F_{B,0} = 0.0\\,\\text{mol}/\\text{s}$, $F_{I,0} = 2.0\\,\\text{mol}/\\text{s}$\n  - $C_{p,A} = 35.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,B} = 35.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,I} = 30.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$\n  - $\\Delta H_{\\text{rxn}} = 5.0\\times 10^4\\,\\text{J}/\\text{mol}$\n  - $k_{0,f} = 2.0\\times 10^5\\,\\text{s}^{-1}$, $E_f = 8.0\\times 10^4\\,\\text{J}/\\text{mol}$\n  - $K_{\\text{ref}} = 3.0$ at $T_{\\text{ref}} = 800.0\\,\\text{K}$\n  - $\\tau = 0.02$\n  - $z_{\\max} = 5.0\\,\\text{m}$\n- Case 2 (endothermic but mild temperature dependence, no inert):\n  - $A_c = 0.02\\,\\text{m}^2$\n  - $P = 1.5\\times 10^5\\,\\text{Pa}$\n  - $T_{\\text{in}} = 700.0\\,\\text{K}$\n  - $F_{A,0} = 2.0\\,\\text{mol}/\\text{s}$, $F_{B,0} = 0.5\\,\\text{mol}/\\text{s}$, $F_{I,0} = 0.0\\,\\text{mol}/\\text{s}$\n  - $C_{p,A} = 33.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,B} = 33.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,I} = 0.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$\n  - $\\Delta H_{\\text{rxn}} = 8.0\\times 10^3\\,\\text{J}/\\text{mol}$\n  - $k_{0,f} = 1.0\\times 10^5\\,\\text{s}^{-1}$, $E_f = 7.0\\times 10^4\\,\\text{J}/\\text{mol}$\n  - $K_{\\text{ref}} = 2.0$ at $T_{\\text{ref}} = 700.0\\,\\text{K}$\n  - $\\tau = 0.02$\n  - $z_{\\max} = 10.0\\,\\text{m}$\n- Case 3 (same as Case 1 but stringent stall tolerance):\n  - $A_c = 0.01\\,\\text{m}^2$\n  - $P = 2.0\\times 10^5\\,\\text{Pa}$\n  - $T_{\\text{in}} = 800.0\\,\\text{K}$\n  - $F_{A,0} = 1.0\\,\\text{mol}/\\text{s}$, $F_{B,0} = 0.0\\,\\text{mol}/\\text{s}$, $F_{I,0} = 2.0\\,\\text{mol}/\\text{s}$\n  - $C_{p,A} = 35.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,B} = 35.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$, $C_{p,I} = 30.0\\,\\text{J}/(\\text{mol}\\cdot\\text{K})$\n  - $\\Delta H_{\\text{rxn}} = 5.0\\times 10^4\\,\\text{J}/\\text{mol}$\n  - $k_{0,f} = 2.0\\times 10^5\\,\\text{s}^{-1}$, $E_f = 8.0\\times 10^4\\,\\text{J}/\\text{mol}$\n  - $K_{\\text{ref}} = 3.0$ at $T_{\\text{ref}} = 800.0\\,\\text{K}$\n  - $\\tau = 1.0\\times 10^{-4}$\n  - $z_{\\max} = 5.0\\,\\text{m}$\n\nYour program should produce a single line of output containing the three computed stall positions in $\\text{m}$ as a comma-separated list enclosed in square brackets (e.g., \"[z1,z2,z3]\"), with each number rounded to six decimal places and expressed in $\\text{m}$. The output must be exactly in this format.",
            "solution": "The user has requested the derivation and implementation of a numerical model for a steady-state, adiabatic plug flow reactor (PFR) to determine a \"near-equilibrium stall\" position, $z^\\star$.\n\n### Step 1: Problem Validation\n\nThe problem statement has been critically evaluated against the specified criteria.\n\n-   **Givens Extraction**: All data, variables, and governing equations have been extracted verbatim from the problem description. These include the molar balance, energy balance, ideal gas law, rate law, Arrhenius kinetics, van't Hoff relation, and the definition of the stall condition. All parameters for three distinct test cases are provided.\n-   **Validation**:\n    1.  **Scientific Grounding**: The problem is based on fundamental and universally accepted principles of chemical reaction engineering. The PFR model equations, kinetic expressions (Arrhenius), and thermodynamic relationships (van't Hoff) are standard and correctly stated. The problem is scientifically sound.\n    2.  **Well-Posedness**: The problem describes a system of coupled, first-order ordinary differential equations (ODEs) with well-defined initial conditions. This constitutes a standard initial value problem (IVP). The functions defining the ODEs are continuous, ensuring that a unique solution exists. The \"stall\" condition is defined as a precise event for the ODE solver, making the overall problem well-posed.\n    3.  **Objectivity**: The problem is formulated using precise, unambiguous mathematical and scientific language. It is free from subjective claims.\n    4.  **Completeness and Consistency**: The problem is self-contained. All necessary parameters, constants, and initial conditions for each test case are provided. There are no contradictions in the provided information.\n    5.  **Numerical Considerations**: The problem correctly anticipates a potential numerical issue with the event function $\\left|\\ln(Q/K_{\\text{eq}})\\right|$ when a species concentration is zero (e.g., at the inlet). It specifically requests a \"numerically well-posed\" strategy. This is a standard challenge in reactor modeling, and handling it is part of a robust solution.\n\n-   **Verdict**: The problem is **valid**. It is a well-formulated, non-trivial problem in computational chemical engineering that requires the application of established principles and numerical methods.\n\n### Step 2: Derivation of the Governing Equations\n\nThe state of the system along the axial coordinate $z$ can be described by the molar flow rates $F_i(z)$ and the temperature $T(z)$. For the reaction $A \\rightleftharpoons B$, the stoichiometric coefficients are $\\nu_A = -1$ and $\\nu_B = +1$. The inert species $I$ has $\\nu_I = 0$.\n\n1.  **Molar Balances and Stoichiometry**:\n    The molar balance for species $i$ is $dF_i/dz = \\nu_i r A_c$.\n    -   For species A: $dF_A/dz = (-1) r A_c$\n    -   For species B: $dF_B/dz = (+1) r A_c$\n    -   For species I: $dF_I/dz = (0) r A_c = 0$, which implies $F_I(z) = F_{I,0}$ (constant).\n\n    Summing the balances for $A$ and $B$ gives $d(F_A + F_B)/dz = 0$. Integrating yields $F_A(z) + F_B(z) = F_{A,0} + F_{B,0}$, a constant. This allows us to express $F_B$ algebraically in terms of $F_A$:\n    $$F_B(z) = F_{A,0} + F_{B,0} - F_A(z)$$\n    The total molar flow rate is also constant: $F_{\\text{tot}} = F_A(z) + F_B(z) + F_I(z) = F_{A,0} + F_{B,0} + F_{I,0}$.\n\n    Therefore, we only need to solve one ODE for the molar flows, for instance, for $F_A$:\n    $$ \\frac{dF_A}{dz} = -r A_c $$\n\n2.  **Reaction Rate ($r$) Expression**:\n    The rate law is $r = k_f(T) C_A - k_r(T) C_B$. Using thermodynamic consistency, $k_r(T) = k_f(T)/K_{\\text{eq}}(T)$, the rate becomes:\n    $$ r = k_f(T) \\left( C_A - \\frac{C_B}{K_{\\text{eq}}(T)} \\right) $$\n    Under the ideal gas law, the concentration of species $j$ is $C_j = y_j C_{\\text{tot}} = \\frac{F_j}{F_{\\text{tot}}} \\frac{P}{RT}$. Substituting this into the rate expression:\n    $$ r = k_f(T) \\frac{P}{RT F_{\\text{tot}}} \\left( F_A - \\frac{F_B}{K_{\\text{eq}}(T)} \\right) $$\n    where:\n    -   The forward rate constant $k_f(T)$ is given by the Arrhenius equation: $k_f(T) = k_{0,f} \\exp\\left(-\\frac{E_f}{RT}\\right)$.\n    -   The equilibrium constant $K_{\\text{eq}}(T)$ is given by the integrated van't Hoff equation: $K_{\\text{eq}}(T) = \\exp\\left( \\ln K_{\\text{ref}} + \\frac{\\Delta H_{\\text{rxn}}}{R} \\left(\\frac{1}{T_{\\text{ref}}} - \\frac{1}{T}\\right) \\right)$.\n\n3.  **Energy Balance**:\n    The energy balance for an adiabatic PFR is given as:\n    $$ \\frac{dT}{dz} = -\\frac{\\Delta H_{\\text{rxn}}\\, r\\, A_c}{\\sum_j F_j C_{p,j}} $$\n    The denominator is the total heat capacity flow rate: $\\sum_j F_j C_{p,j} = F_A C_{p,A} + F_B C_{p,B} + F_I C_{p,I}$. This term depends on the state variables $F_A$ (since $F_B$ depends on $F_A$).\n\n4.  **Final System of ODEs**:\n    We have a system of two coupled first-order ODEs for the state vector $\\mathbf{y}(z) = [F_A(z), T(z)]^T$:\n    $$ \\frac{dF_A}{dz} = -r A_c $$\n    $$ \\frac{dT}{dz} = -\\frac{\\Delta H_{\\text{rxn}}\\, r\\, A_c}{F_A C_{p,A} + (F_{A,0} + F_{B,0} - F_A) C_{p,B} + F_{I,0} C_{p,I}} $$\n    where $r$ is a function of $F_A$ and $T$ as defined above. The initial conditions are $F_A(0) = F_{A,0}$ and $T(0) = T_{\\text{in}}$.\n\n### Step 3: Numerical Implementation Strategy\n\n1.  **ODE Solver**: The problem will be solved by numerically integrating the system of ODEs using `scipy.integrate.solve_ivp`. This function is well-suited for this task as it is robust and provides a mechanism for event detection.\n\n2.  **State Vector**: The state vector used by the solver will be `y = [F_A, T]`.\n\n3.  **Event Detection for Stall Condition**: The stall position $z^\\star$ is defined by the condition $|\\ln(Q/K_{\\text{eq}})| \\le \\tau$, where $Q = y_B/y_A = F_B/F_A$. This is equivalent to finding the smallest root $z > 0$ of the event function:\n    $$ g(z, \\mathbf{y}) = \\left|\\ln\\left(\\frac{F_B(z)}{F_A(z)} / K_{\\text{eq}}(T(z))\\right)\\right| - \\tau = 0 $$\n    -   **Numerical Stability**: At the reactor inlet ($z=0$), if $F_{B,0}=0$, then $Q=0$ and $\\ln(Q)$ is undefined. The event function must be implemented to handle this case gracefully. A simple guard, checking if $F_B$ is effectively zero and, if so, returning a large positive value, prevents the function from being triggered at the start.\n    -   **Event Direction**: As the reaction proceeds from an initial state far from equilibrium, the term $|\\ln(Q/K_{\\text{eq}})|$ decreases from a large value. The event occurs when this value crosses $\\tau$ from above. Therefore, the solver should look for a zero-crossing in the negative direction (`direction = -1`).\n    -   **Terminal Event**: Once the stall condition is met, the integration should stop. This is accomplished by setting the `terminal` attribute of the event function to `True`.\n\n4.  **Algorithm**:\n    -   For each test case, all parameters are collected.\n    -   An ODE function `dydz(z, y, params)` is defined to compute the derivatives $[dF_A/dz, dT/dz]$.\n    -   An event function `event_stall(z, y, params)` is defined to compute $g(z, \\mathbf{y})$.\n    -   `solve_ivp` is called with the initial conditions `y0 = [F_A0, T_in]`, integration span `[0, z_max]`, the ODE and event functions, and appropriate numerical tolerances.\n    -   If the solver successfully finds an event, the first event time `sol.t_events[0][0]` is taken as $z^\\star$.\n    -   If no event is found within $[0, z_{\\max}]$, $z^\\star$ is assigned the value $-1.0$.\n    -   The result is rounded to six decimal places and stored.\n\nThe final Python implementation encapsulates this logic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves for the near-equilibrium stall position in a PFR for given test cases.\n    \"\"\"\n    R_GAS = 8.31446261815324\n\n    test_cases = [\n        # Case 1 (endothermic with inert, strong temperature drop):\n        {\n            \"Ac\": 0.01, \"P\": 2.0e5, \"T_in\": 800.0,\n            \"F_A0\": 1.0, \"F_B0\": 0.0, \"F_I0\": 2.0,\n            \"CpA\": 35.0, \"CpB\": 35.0, \"CpI\": 30.0,\n            \"dH_rxn\": 5.0e4, \"k0f\": 2.0e5, \"Ef\": 8.0e4,\n            \"K_ref\": 3.0, \"T_ref\": 800.0,\n            \"tau\": 0.02, \"z_max\": 5.0\n        },\n        # Case 2 (endothermic but mild temperature dependence, no inert):\n        {\n            \"Ac\": 0.02, \"P\": 1.5e5, \"T_in\": 700.0,\n            \"F_A0\": 2.0, \"F_B0\": 0.5, \"F_I0\": 0.0,\n            \"CpA\": 33.0, \"CpB\": 33.0, \"CpI\": 0.0,\n            \"dH_rxn\": 8.0e3, \"k0f\": 1.0e5, \"Ef\": 7.0e4,\n            \"K_ref\": 2.0, \"T_ref\": 700.0,\n            \"tau\": 0.02, \"z_max\": 10.0\n        },\n        # Case 3 (same as Case 1 but stringent stall tolerance):\n        {\n            \"Ac\": 0.01, \"P\": 2.0e5, \"T_in\": 800.0,\n            \"F_A0\": 1.0, \"F_B0\": 0.0, \"F_I0\": 2.0,\n            \"CpA\": 35.0, \"CpB\": 35.0, \"CpI\": 30.0,\n            \"dH_rxn\": 5.0e4, \"k0f\": 2.0e5, \"Ef\": 8.0e4,\n            \"K_ref\": 3.0, \"T_ref\": 800.0,\n            \"tau\": 1.0e-4, \"z_max\": 5.0\n        }\n    ]\n\n    def dydz(z, y, p):\n        \"\"\"\n        Defines the system of ordinary differential equations for the PFR model.\n        y = [F_A, T]\n        \"\"\"\n        F_A, T = y\n\n        # State variable protection\n        if T <= 0: return [0.0, 0.0]\n        F_A = max(0.0, F_A)\n        \n        # Algebraic relations\n        F_B = p[\"F_A0\"] + p[\"F_B0\"] - F_A\n        F_B = max(0.0, F_B)\n        F_tot = p[\"F_A0\"] + p[\"F_B0\"] + p[\"F_I0\"]\n\n        # Temperature-dependent parameters\n        k_f = p[\"k0f\"] * np.exp(-p[\"Ef\"] / (R_GAS * T))\n        \n        log_K_ref = np.log(p[\"K_ref\"])\n        ln_K_eq = log_K_ref + (p[\"dH_rxn\"] / R_GAS) * (1.0 / p[\"T_ref\"] - 1.0 / T)\n        K_eq = np.exp(ln_K_eq)\n\n        # Rate of reaction\n        r = k_f * (p[\"P\"] / (R_GAS * T * F_tot)) * (F_A - F_B / K_eq)\n\n        # Derivatives\n        dFA_dz = -r * p[\"Ac\"]\n        \n        sum_FCp = F_A * p[\"CpA\"] + F_B * p[\"CpB\"] + p[\"F_I0\"] * p[\"CpI\"]\n        if abs(sum_FCp) < 1e-12:\n            dT_dz = 0.0\n        else:\n            dT_dz = -p[\"dH_rxn\"] * r * p[\"Ac\"] / sum_FCp\n        \n        return [dFA_dz, dT_dz]\n\n    def event_stall(z, y, p):\n        \"\"\"\n        Event function to detect near-equilibrium stall.\n        Triggers when |ln(Q/K_eq)| - tau = 0.\n        \"\"\"\n        F_A, T = y\n        \n        # Guard against undefined logs at z=0 or due to numerical error\n        if F_A <= 1e-20 or T <= 0: return 1.0\n        \n        F_B = p[\"F_A0\"] + p[\"F_B0\"] - F_A\n        if F_B <= 1e-20: return 1.0\n        \n        # Reaction quotient\n        Q = F_B / F_A\n        \n        # Equilibrium constant\n        log_K_ref = np.log(p[\"K_ref\"])\n        ln_K_eq = log_K_ref + (p[\"dH_rxn\"] / R_GAS) * (1.0 / p[\"T_ref\"] - 1.0 / T)\n        K_eq = np.exp(ln_K_eq)\n\n        # Event function value\n        value = np.abs(np.log(Q / K_eq)) - p[\"tau\"]\n        return value\n\n    event_stall.terminal = True\n    event_stall.direction = -1\n\n    results = []\n    for params in test_cases:\n        y0 = [params[\"F_A0\"], params[\"T_in\"]]\n        z_span = [0, params[\"z_max\"]]\n        \n        # Use tighter tolerances for higher accuracy, especially for Case 3\n        rtol = 1e-9\n        atol = 1e-12\n\n        sol = solve_ivp(\n            dydz, \n            z_span, \n            y0, \n            args=(params,),\n            method='RK45', \n            events=event_stall, \n            dense_output=True,\n            rtol=rtol,\n            atol=atol\n        )\n\n        if sol.status == 1 and len(sol.t_events[0]) > 0:\n            z_star = sol.t_events[0][0]\n        else:\n            z_star = -1.0\n            \n        results.append(f\"{z_star:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A robust model is one whose sensitivities are well understood. This final practice introduces the crucial concept of sensitivity analysis, a technique to quantify how the model's output—in this case, nitric oxide formation—is affected by uncertainties in its input parameters, such as a reaction's pre-exponential factor. You will implement both the forward and adjoint sensitivity methods, two powerful computational approaches that provide deep insight into your model's behavior and are essential for parameter estimation, optimization, and uncertainty quantification .",
            "id": "4051613",
            "problem": "Consider an isothermal, constant-pressure, ideal-gas Plug Flow Reactor (PFR) in the context of computational combustion. The reactor processes a ternary mixture containing nitrogen $\\mathrm{N_2}$, oxygen $\\mathrm{O_2}$, and nitric oxide $\\mathrm{NO}$, with a single effective global reaction representing nitric oxide formation: $\\mathrm{N_2} + \\mathrm{O_2} \\rightarrow 2\\,\\mathrm{NO}$. The reaction rate is modeled by an Arrhenius law applied to a bimolecular rate expression, $r = A \\exp\\!\\left(-\\dfrac{E_a}{R T}\\right) C_{\\mathrm{N_2}} C_{\\mathrm{O_2}}$, where $A$ is the pre-exponential factor, $E_a$ is the activation energy, $R$ is the universal gas constant, $T$ is the absolute temperature, and $C_i$ denotes the molar concentration of species $i$. The units are as follows: $A$ in $\\mathrm{m^3/(mol \\cdot s)}$, $E_a$ in $\\mathrm{J/mol}$, $R$ in $\\mathrm{J/(mol \\cdot K)}$, $T$ in $\\mathrm{K}$, and $C_i$ in $\\mathrm{mol/m^3}$.\n\nUnder the plug flow assumption and constant total molar concentration, introduce the residence-time coordinate $s$ with units of seconds and write the molar continuity equations for the species $\\mathrm{N_2}$, $\\mathrm{O_2}$, and $\\mathrm{NO}$ in terms of $s$, the reaction rate $r$, and the stoichiometric coefficients implied by the reaction. Use the Ideal Gas Law to obtain the constant total molar concentration $C_{\\mathrm{tot}} = \\dfrac{p}{R T}$ from the specified pressure $p$ and temperature $T$, and initialize the species concentrations via $C_i(0) = y_{i,0} C_{\\mathrm{tot}}$, where $y_{i,0}$ are the inlet mole fractions.\n\nDefine the scalar output of interest as the outlet mole fraction of nitric oxide, $y_{\\mathrm{NO,out}} = \\dfrac{C_{\\mathrm{NO}}(s_{\\mathrm{out}})}{C_{\\mathrm{tot}}}$, at a specified outlet residence time $s_{\\mathrm{out}}$. Your task is to compute the sensitivity $\\dfrac{\\partial y_{\\mathrm{NO,out}}}{\\partial A}$ using either a forward sensitivity method or an adjoint sensitivity method. Base your derivation and algorithm only on fundamental laws and core definitions (species continuity in a Plug Flow Reactor, Ideal Gas Law, Arrhenius kinetics) and well-tested facts, without invoking shortcut formulas.\n\nImplement a complete, runnable program that, for each test case specified below, integrates the reactor model and computes $\\dfrac{\\partial y_{\\mathrm{NO,out}}}{\\partial A}$ using the indicated method. The program must use robust numerical integration and produce the requested outputs with scientific consistency.\n\nPhysical units and output specification:\n- Express each sensitivity $\\dfrac{\\partial y_{\\mathrm{NO,out}}}{\\partial A}$ in $\\mathrm{mol \\cdot s \\cdot m^{-3}}$, which equals the reciprocal of the units of $A$.\n- All angles, if any appear, must be in radians, although this problem does not involve angles.\n- The final program output shall be a single line containing a comma-separated list enclosed in square brackets, for example, $\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$, where each $\\text{result}_k$ is a floating point number representing $\\dfrac{\\partial y_{\\mathrm{NO,out}}}{\\partial A}$ for test case $k$.\n\nTest suite (each test case is a tuple with parameters and a method label):\n- Case $1$: Method $=$ \"forward\"; $T = 2200\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.5\\,\\mathrm{s}$; $A = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 3.8 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.79$; $y_{\\mathrm{O_2},0} = 0.21$; $y_{\\mathrm{NO},0} = 0.0$.\n- Case $2$: Method $=$ \"adjoint\"; $T = 2200\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.5\\,\\mathrm{s}$; $A = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 3.8 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.79$; $y_{\\mathrm{O_2},0} = 0.21$; $y_{\\mathrm{NO},0} = 0.0$.\n- Case $3$: Method $=$ \"adjoint\"; $T = 2200\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.5\\,\\mathrm{s}$; $A = 0.0\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 3.8 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.79$; $y_{\\mathrm{O_2},0} = 0.21$; $y_{\\mathrm{NO},0} = 0.0$.\n- Case $4$: Method $=$ \"forward\"; $T = 2200\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.001\\,\\mathrm{s}$; $A = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 3.8 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.79$; $y_{\\mathrm{O_2},0} = 0.21$; $y_{\\mathrm{NO},0} = 0.0$.\n- Case $5$: Method $=$ \"forward\"; $T = 1800\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.5\\,\\mathrm{s}$; $A = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 8.0 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.79$; $y_{\\mathrm{O_2},0} = 0.21$; $y_{\\mathrm{NO},0} = 0.0$.\n- Case $6$: Method $=$ \"adjoint\"; $T = 2200\\,\\mathrm{K}$; $p = 101325\\,\\mathrm{Pa}$; $s_{\\mathrm{out}} = 0.5\\,\\mathrm{s}$; $A = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol \\cdot s)}$; $E_a = 3.8 \\times 10^5\\,\\mathrm{J/mol}$; $y_{\\mathrm{N_2},0} = 0.95$; $y_{\\mathrm{O_2},0} = 0.04$; $y_{\\mathrm{NO},0} = 0.01$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5,\\text{result}_6\\right]$), where the entries correspond in order to Cases $1$ through $6$.",
            "solution": "The user-provided problem is a valid and well-posed exercise in computational chemical kinetics, specifically focusing on sensitivity analysis of a Plug Flow Reactor (PFR) model. The following solution provides a step-by-step derivation of the necessary equations for both forward and adjoint sensitivity analysis, followed by an implementation in Python.\n\n### 1. Fundamental Model Equations\n\nThe problem describes an isothermal, constant-pressure PFR. For an ideal gas mixture under these conditions, the total molar concentration $C_{\\mathrm{tot}}$ is constant. The governing equation for the evolution of the molar concentration $C_i$ of species $i$ with respect to residence time $s$ is:\n$$\n\\frac{dC_i}{ds} = R_i(\\mathbf{C})\n$$\nwhere $R_i$ is the net rate of production of species $i$ in $\\mathrm{mol \\cdot m^{-3} \\cdot s^{-1}}$. The state of the system is described by the vector of concentrations $\\mathbf{C}(s) = [C_{\\mathrm{N_2}}(s), C_{\\mathrm{O_2}}(s), C_{\\mathrm{NO}}(s)]^T$.\n\nThe single reaction is $\\mathrm{N_2} + \\mathrm{O_2} \\rightarrow 2\\,\\mathrm{NO}$. The stoichiometric coefficients for the species $(\\mathrm{N_2}, \\mathrm{O_2}, \\mathrm{NO})$ are $\\nu = (-1, -1, 2)$. The reaction rate is given by the bimolecular Arrhenius expression:\n$$\nr = k C_{\\mathrm{N_2}} C_{\\mathrm{O_2}}\n$$\nwhere the rate constant $k$ is $k = A \\exp(-E_a / (RT))$. The individual species production rates are $R_i = \\nu_i r$. This gives the system of ordinary differential equations (ODEs):\n$$\n\\frac{d}{ds}\n\\begin{pmatrix} C_{\\mathrm{N_2}} \\\\ C_{\\mathrm{O_2}} \\\\ C_{\\mathrm{NO}} \\end{pmatrix}\n=\n\\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix}\nr(\\mathbf{C}, A)\n= \\mathbf{f}(\\mathbf{C}, A)\n$$\nThe initial conditions at $s=0$ are given by the inlet mole fractions $y_{i,0}$:\n$$\nC_i(0) = y_{i,0} C_{\\mathrm{tot}} \\quad \\text{where} \\quad C_{\\mathrm{tot}} = \\frac{p}{RT}\n$$\nThe quantity of interest (QoI) is the outlet mole fraction of $\\mathrm{NO}$, $G = y_{\\mathrm{NO,out}} = C_{\\mathrm{NO}}(s_{\\mathrm{out}}) / C_{\\mathrm{tot}}$. The objective is to compute its sensitivity with respect to the pre-exponential factor $A$, i.e., $\\frac{dG}{dA}$.\n\n### 2. Forward Sensitivity Analysis\n\nIn the forward method, we derive and solve a set of ODEs for the sensitivities of the state variables with respect to the parameter $A$. Let the sensitivity vector be $\\mathbf{S}(s) = \\frac{\\partial \\mathbf{C}(s)}{\\partial A}$. Differentiating the governing ODE system with respect to $A$ yields:\n$$\n\\frac{d\\mathbf{S}}{ds} = \\frac{d}{ds}\\left(\\frac{\\partial \\mathbf{C}}{\\partial A}\\right) = \\frac{\\partial}{\\partial A}\\left(\\frac{d\\mathbf{C}}{ds}\\right) = \\frac{\\partial \\mathbf{f}}{\\partial A}\n$$\nApplying the chain rule, we get the linear ODE system for the sensitivities:\n$$\n\\frac{d\\mathbf{S}}{ds} = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{C}} \\frac{\\partial \\mathbf{C}}{\\partial A} + \\frac{\\partial \\mathbf{f}}{\\partial A}\\bigg|_{\\mathbf{C}} = \\mathbf{J}(s) \\mathbf{S}(s) + \\mathbf{g}(s)\n$$\nwhere $\\mathbf{J}$ is the Jacobian matrix of the rate vector $\\mathbf{f}$ and $\\mathbf{g}$ is the vector of partial derivatives of $\\mathbf{f}$ with respect to $A$.\n\nThe Jacobian matrix $\\mathbf{J}$ has elements $J_{ij} = \\frac{\\partial f_i}{\\partial C_j}$:\n$$\n\\mathbf{J} = \\frac{\\partial (\\nu r)}{\\partial \\mathbf{C}} = \\nu \\otimes \\frac{\\partial r}{\\partial \\mathbf{C}} = \\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial r}{\\partial C_{\\mathrm{N_2}}} & \\frac{\\partial r}{\\partial C_{\\mathrm{O_2}}} & \\frac{\\partial r}{\\partial C_{\\mathrm{NO}}} \\end{pmatrix} = k \\begin{pmatrix} -C_{\\mathrm{O_2}} & -C_{\\mathrm{N_2}} & 0 \\\\ -C_{\\mathrm{O_2}} & -C_{\\mathrm{N_2}} & 0 \\\\ 2C_{\\mathrm{O_2}} & 2C_{\\mathrm{N_2}} & 0 \\end{pmatrix}\n$$\nThe forcing term $\\mathbf{g}$ is derived as:\n$$\n\\mathbf{g} = \\frac{\\partial \\mathbf{f}}{\\partial A} = \\nu \\frac{\\partial r}{\\partial A} = \\nu \\frac{\\partial (k C_{\\mathrm{N_2}} C_{\\mathrm{O_2}})}{\\partial A} = \\nu C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} \\frac{\\partial k}{\\partial A}\n$$\nSince $k = A \\exp(-E_a/(RT))$, we have $\\frac{\\partial k}{\\partial A} = \\exp(-E_a/(RT))$. This formulation holds even when $A=0$.\n$$\n\\mathbf{g} = \\exp(-E_a/(RT)) C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} \\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix}\n$$\nThe initial conditions for the sensitivities are $\\mathbf{S}(0) = \\frac{\\partial \\mathbf{C}(0)}{\\partial A} = \\mathbf{0}$, as the initial concentrations do not depend on $A$.\nThe forward method involves solving an augmented system of $2 \\times 3 = 6$ ODEs for the state vector and the sensitivity vector, $[\\mathbf{C}(s), \\mathbf{S}(s)]^T$, from $s=0$ to $s=s_{\\mathrm{out}}$. The desired sensitivity is then:\n$$\n\\frac{dG}{dA} = \\frac{\\partial}{\\partial A} \\left( \\frac{C_{\\mathrm{NO}}(s_{\\mathrm{out}})}{C_{\\mathrm{tot}}} \\right) = \\frac{1}{C_{\\mathrm{tot}}} \\frac{\\partial C_{\\mathrm{NO}}(s_{\\mathrm{out}})}{\\partial A} = \\frac{S_{\\mathrm{NO}}(s_{\\mathrm{out}})}{C_{\\mathrm{tot}}}\n$$\n\n### 3. Adjoint Sensitivity Analysis\n\nThe adjoint method is an alternative, often more efficient for problems with many parameters and few outputs. It involves solving an auxiliary system of \"adjoint\" equations backward in time. The sensitivity is then computed by an integral. The adjoint equations for a system $\\frac{d\\mathbf{C}}{ds}=\\mathbf{f}$ are:\n$$\n\\frac{d\\boldsymbol{\\lambda}}{ds} = - \\mathbf{J}^T \\boldsymbol{\\lambda}\n$$\nwhere $\\boldsymbol{\\lambda}(s)$ is the adjoint vector. This is a linear ODE system that must be integrated backward in time, requiring a terminal condition at $s=s_{\\mathrm{out}}$. The terminal condition is given by the derivative of the QoI with respect to the final state:\n$$\n\\boldsymbol{\\lambda}(s_{\\mathrm{out}}) = \\left(\\frac{\\partial G}{\\partial \\mathbf{C}(s_{\\mathrm{out}})}\\right)^T = \\left(\\frac{\\partial}{\\partial \\mathbf{C}(s_{\\mathrm{out}})} \\frac{C_{\\mathrm{NO}}(s_{\\mathrm{out}})}{C_{\\mathrm{tot}}}\\right)^T = \\frac{1}{C_{\\mathrm{tot}}} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\nOnce the adjoint variables $\\boldsymbol{\\lambda}(s)$ are known along the trajectory, the sensitivity of $G$ with respect to $A$ is given by the integral:\n$$\n\\frac{dG}{dA} = \\int_0^{s_{\\mathrm{out}}} \\boldsymbol{\\lambda}^T(s) \\frac{\\partial \\mathbf{f}}{\\partial A}(\\mathbf{C}(s), A) ds = \\int_0^{s_{\\mathrm{out}}} \\boldsymbol{\\lambda}^T(s) \\mathbf{g}(s) ds\n$$\nThe algorithmic procedure is:\n1.  Solve the forward problem for $\\mathbf{C}(s)$ from $s=0$ to $s=s_{\\mathrm{out}}$ and store the solution trajectory.\n2.  Solve the adjoint problem for $\\boldsymbol{\\lambda}(s)$ backward from $s=s_{\\mathrm{out}}$ to $s=0$, using the stored $\\mathbf{C}(s)$ to evaluate the Jacobian $\\mathbf{J}(s)$.\n3.  As the adjoint system is solved, compute the sensitivity integral.\n\nTo implement this with a standard forward integrator, a change of variables $\\tau = s_{\\mathrm{out}} - s$ is used. The adjoint system becomes $\\frac{d\\boldsymbol{\\lambda}}{d\\tau} = \\mathbf{J}^T(\\tau) \\boldsymbol{\\lambda}(\\tau)$, integrated forward from $\\tau=0$ to $\\tau=s_{\\mathrm{out}}$. The sensitivity is computed by augmenting the state with a variable $Z(\\tau)$ such that $\\frac{dZ}{d\\tau} = \\boldsymbol{\\lambda}^T(\\tau)\\mathbf{g}(\\tau)$ with $Z(0)=0$. The final sensitivity is $Z(s_{\\mathrm{out}})$.\n\n### 4. Implementation Details\n\nBoth methods are implemented. For numerical integration, `scipy.integrate.solve_ivp` is used.\n- For the forward method, a single system of 6 ODEs is solved.\n- For the adjoint method, the forward concentration ODEs are solved first, with `dense_output=True` to create an interpolation function for the state trajectory. Then, an augmented system of 4 ODEs for the adjoint variables and the sensitivity integral is solved backward in time (using the time transformation $\\tau = s_{\\mathrm{out}}-s$).\nAs confirmed during validation, Cases 1 and 2 have identical parameters but different methods, providing a cross-check on the correctness of the implementation. They are expected to yield the same numerical result.\nThe expression for the forcing term $\\mathbf{g}$ is carefully implemented as $\\mathbf{g} = \\exp(-E_a/(RT)) C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} \\nu$ to ensure numerical stability and correctness for the case where $A=0$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the sensitivity of the outlet NO mole fraction with respect to the \n    pre-exponential factor A in an isothermal PFR.\n    \"\"\"\n\n    # Universal gas constant in J/(mol.K)\n    R_GAS = 8.31446261815324\n\n    test_cases = [\n        {\"method\": \"forward\", \"T\": 2200, \"p\": 101325, \"s_out\": 0.5, \"A\": 1.0e5, \"Ea\": 3.8e5, \"yN20\": 0.79, \"yO20\": 0.21, \"yNO0\": 0.0},\n        {\"method\": \"adjoint\", \"T\": 2200, \"p\": 101325, \"s_out\": 0.5, \"A\": 1.0e5, \"Ea\": 3.8e5, \"yN20\": 0.79, \"yO20\": 0.21, \"yNO0\": 0.0},\n        {\"method\": \"adjoint\", \"T\": 2200, \"p\": 101325, \"s_out\": 0.5, \"A\": 0.0, \"Ea\": 3.8e5, \"yN20\": 0.79, \"yO20\": 0.21, \"yNO0\": 0.0},\n        {\"method\": \"forward\", \"T\": 2200, \"p\": 101325, \"s_out\": 0.001, \"A\": 1.0e5, \"Ea\": 3.8e5, \"yN20\": 0.79, \"yO20\": 0.21, \"yNO0\": 0.0},\n        {\"method\": \"forward\", \"T\": 1800, \"p\": 101325, \"s_out\": 0.5, \"A\": 1.0e5, \"Ea\": 8.0e5, \"yN20\": 0.79, \"yO20\": 0.21, \"yNO0\": 0.0},\n        {\"method\": \"adjoint\", \"T\": 2200, \"p\": 101325, \"s_out\": 0.5, \"A\": 1.0e5, \"Ea\": 3.8e5, \"yN20\": 0.95, \"yO20\": 0.04, \"yNO0\": 0.01},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p = case[\"p\"]\n        T = case[\"T\"]\n        A = case[\"A\"]\n        Ea = case[\"Ea\"]\n        s_out = case[\"s_out\"]\n        \n        # Stoichiometric coefficients for N2, O2, NO\n        nu = np.array([-1.0, -1.0, 2.0])\n\n        # Constant total molar concentration\n        C_tot = p / (R_GAS * T)\n        \n        # Initial concentrations\n        C0 = np.array([case[\"yN20\"], case[\"yO20\"], case[\"yNO0\"]]) * C_tot\n        \n        # Rate constant partial derivative w.r.t A\n        dk_dA = np.exp(-Ea / (R_GAS * T))\n\n        if case[\"method\"] == \"forward\":\n            # State vector: [C_N2, C_O2, C_NO, S_N2, S_O2, S_NO]\n            # S_i = dC_i/dA\n            def forward_odes(s, y):\n                C = y[:3]\n                S = y[3:]\n                \n                C_N2, C_O2, C_NO = C[0], C[1], C[2]\n                \n                k = A * dk_dA\n                r = k * C_N2 * C_O2\n                \n                # Governing equations for concentrations\n                dC_dt = nu * r\n                \n                # Jacobian matrix J = df/dC\n                J = k * np.array([\n                    [-C_O2, -C_N2, 0.0],\n                    [-C_O2, -C_N2, 0.0],\n                    [2 * C_O2, 2 * C_N2, 0.0]\n                ])\n                \n                # Forcing term g = df/dA\n                g = dk_dA * C_N2 * C_O2 * nu\n                \n                # Sensitivity equations dS/dt = J*S + g\n                dS_dt = J @ S + g\n                \n                return np.concatenate((dC_dt, dS_dt))\n\n            y0 = np.zeros(6)\n            y0[:3] = C0\n            \n            sol = solve_ivp(forward_odes, [0, s_out], y0, dense_output=True, rtol=1e-8, atol=1e-12)\n            \n            S_NO_out = sol.y[5, -1]\n            sensitivity = S_NO_out / C_tot\n            results.append(sensitivity)\n\n        elif case[\"method\"] == \"adjoint\":\n            # Step 1: Solve forward problem for concentrations\n            def forward_odes_C(s, C):\n                k = A * dk_dA\n                r = k * C[0] * C[1]\n                return nu * r\n            \n            forward_sol = solve_ivp(forward_odes_C, [0, s_out], C0, dense_output=True, rtol=1e-8, atol=1e-12)\n\n            # Step 2: Solve backward problem for adjoints and sensitivity integral\n            # State vector: [lambda_N2, lambda_O2, lambda_NO, Z]\n            # where Z is the sensitivity integral.\n            # We use time transformation tau = s_out - s\n            def adjoint_odes(tau, y):\n                # y = [lambda_N2, lambda_O2, lambda_NO, Z]\n                lam = y[:3]\n                \n                # Get concentrations at s = s_out - tau\n                C = forward_sol.sol(s_out - tau)\n                C_N2, C_O2 = C[0], C[1]\n                \n                k = A * dk_dA\n                \n                # Transposed Jacobian J^T\n                J_T = k * np.array([\n                    [-C_O2, -C_O2, 2 * C_O2],\n                    [-C_N2, -C_N2, 2 * C_N2],\n                    [0.0, 0.0, 0.0]\n                ])\n\n                # Adjoint equation: d(lambda)/d(tau) = J^T * lambda\n                dlam_dtau = J_T @ lam\n                \n                # Forcing term g = df/dA\n                g = dk_dA * C_N2 * C_O2 * nu\n                \n                # Sensitivity integrand\n                integrand = lam @ g\n\n                # dZ/d(tau) = integrand\n                dZ_dtau = integrand\n                \n                return np.concatenate((dlam_dtau, [dZ_dtau]))\n\n            # Initial conditions for backward integration at tau=0 (s=s_out)\n            # lambda(s_out)=[0, 0, 1/C_tot], Z(s_out)=0\n            lamZ0 = np.zeros(4)\n            lamZ0[2] = 1.0 / C_tot\n\n            adjoint_sol = solve_ivp(adjoint_odes, [0, s_out], lamZ0, rtol=1e-8, atol=1e-12)\n            \n            sensitivity = adjoint_sol.y[3, -1]\n            results.append(sensitivity)\n\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}