{
    "hands_on_practices": [
        {
            "introduction": "To design accurate numerical methods, we must first master the tools for their construction and analysis. This exercise  provides foundational practice in deriving a high-order numerical scheme from first principles. By systematically applying Taylor series expansions, you will determine the coefficients of a fourth-order compact finite-difference operator and quantify its intrinsic accuracy by calculating its leading-order truncation error constant. This practice also critically highlights a common and severe pitfall: the loss of accuracy when a high-order scheme is applied improperly to variable-coefficient problems, a crucial lesson for modeling the heterogeneous transport properties found in flames.",
            "id": "4074154",
            "problem": "Consider one-dimensional diffusive transport of a scalar field $u(x)$ representative of a mixture fraction or temperature in computational combustion, where the governing diffusion operator in conservative form is $\\partial_{x}\\!\\left(a(x)\\,\\partial_{x} u\\right)$ and the constant-coefficient Laplacian reduces to $u_{xx}$ when $a(x)$ is uniform. You will construct a compact finite-difference scheme on a uniform grid $x_{i} = x_{0} + i h$ with grid spacing $h$ to approximate $u_{xx}$ at interior points to fourth-order accuracy. Use the following implicit tridiagonal compact form for the second derivative:\n$$\n\\alpha\\,u''_{i-1} + u''_{i} + \\alpha\\,u''_{i+1}\n= \\frac{1}{h^{2}}\\left[ c_{1}\\left(u_{i-1} - 2 u_{i} + u_{i+1}\\right) + c_{2}\\left(u_{i-2} - 2 u_{i} + u_{i+2}\\right)\\right],\n$$\nwhere $\\alpha$, $c_{1}$, and $c_{2}$ are constant coefficients to be determined by enforcing fourth-order accuracy via Taylor-series consistency conditions about $x_{i}$, and $u''_{i}$ denotes the discrete approximation to $u_{xx}(x_{i})$ produced by solving the above linear system.\n\nTasks:\n- Starting from Taylor expansions of $u$ about $x_{i}$ and the definition of the second derivative, derive algebraic equations for $\\alpha$, $c_{1}$, and $c_{2}$ that enforce fourth-order consistency for the constant-coefficient operator $u_{xx}$. Select a particular $\\alpha$ that yields a minimal-right-hand-side stencil, and determine $c_{1}$ and $c_{2}$ accordingly.\n- Define the truncation error constant $K$ by the leading-order local truncation error of the discrete second derivative:\n$$\nu''_{i} - u_{xx}(x_{i}) = K\\,h^{4}\\,u^{(6)}(x_{i}) + \\mathcal{O}(h^{6}),\n$$\nand compute $K$ for your chosen coefficients in exact rational form.\n- Briefly, using the product rule and binomial expansion for derivatives, discuss analytically how the leading-order truncation error changes when the same compact operator is applied to the variable-coefficient conservative diffusion operator $L[u] = \\partial_{x}\\!\\left(a(x)\\,\\partial_{x} u\\right)$ if one discretizes it in the nonconservative substitution $L[u] \\approx a(x)\\,u''_{i}$ with the same compact $u''$ operator. Your discussion should be rooted in the structure of $(a\\,u)^{(6)}$ and identify which derivatives of $a(x)$ enter the leading error term, explaining sensitivity to rapidly varying $a(x)$ typical in combustion where $a(x)$ may depend strongly on temperature and composition.\n\nFor grading, report only the truncation error constant $K$ as a single exact rational number. No rounding is required, and no physical units are attached to $K$.",
            "solution": "### Part 1: Derivation of Scheme Coefficients\n\nThe given implicit compact finite-difference scheme is:\n$$\n\\alpha\\,u''_{i-1} + u''_{i} + \\alpha\\,u''_{i+1}\n= \\frac{1}{h^{2}}\\left[ c_{1}\\left(u_{i-1} - 2 u_{i} + u_{i+1}\\right) + c_{2}\\left(u_{i-2} - 2 u_{i} + u_{i+2}\\right)\\right]\n$$\nTo determine the coefficients $\\alpha$, $c_1$, and $c_2$, we analyze the local truncation error of this relation. This is done by substituting the exact solution $u(x)$ into the scheme, replacing the discrete approximations $u''_{j}$ with the exact second derivatives $u_{xx}(x_j)$, and expanding all terms in a Taylor series about the point $x_i$. Let $u^{(n)}_i$ denote $\\frac{d^n u}{dx^n}$ at $x=x_i$.\n\nThe left-hand side (LHS) of the relation becomes:\n$$\n\\text{LHS} = \\alpha\\,u_{xx}(x_{i-1}) + u_{xx}(x_i) + \\alpha\\,u_{xx}(x_{i+1})\n$$\nWe expand $u_{xx}(x_{i\\pm1})$ about $x_i$:\n$$\nu_{xx}(x_{i\\pm1}) = u_{xx}(x_i \\pm h) = u^{(2)}_i \\pm h u^{(3)}_i + \\frac{h^2}{2} u^{(4)}_i \\pm \\frac{h^3}{6} u^{(5)}_i + \\frac{h^4}{24} u^{(6)}_i \\pm \\frac{h^5}{120} u^{(7)}_i + \\frac{h^6}{720} u^{(8)}_i + \\mathcal{O}(h^7)\n$$\nSubstituting these into the LHS expression and simplifying yields:\n$$\n\\text{LHS} = (1+2\\alpha)u^{(2)}_i + \\alpha h^2 u^{(4)}_i + \\frac{\\alpha h^4}{12} u^{(6)}_i + \\frac{\\alpha h^6}{360} u^{(8)}_i + \\mathcal{O}(h^8)\n$$\nThe right-hand side (RHS) of the relation involves central difference operators. Their Taylor expansions are:\n$$\nu_{i-1} - 2u_i + u_{i+1} = h^2 u^{(2)}_i + \\frac{h^4}{12} u^{(4)}_i + \\frac{h^6}{360} u^{(6)}_i + \\mathcal{O}(h^8)\n$$\n$$\nu_{i-2} - 2u_i + u_{i+2} = 4h^2 u^{(2)}_i + \\frac{4h^4}{3} u^{(4)}_i + \\frac{8h^6}{45} u^{(6)}_i + \\mathcal{O}(h^8)\n$$\nSubstituting these into the RHS expression:\n$$\n\\text{RHS} = \\frac{1}{h^2} \\left[ c_1 \\left(h^2 u^{(2)}_i + \\frac{h^4}{12} u^{(4)}_i + \\dots \\right) + c_2 \\left(4h^2 u^{(2)}_i + \\frac{4h^4}{3} u^{(4)}_i + \\dots\\right) \\right]\n$$\n$$\n\\text{RHS} = (c_1 + 4c_2)u^{(2)}_i + \\left(\\frac{c_1}{12} + \\frac{4c_2}{3}\\right)h^2 u^{(4)}_i + \\left(\\frac{c_1}{360} + \\frac{8c_2}{45}\\right)h^4 u^{(6)}_i + \\mathcal{O}(h^6)\n$$\nTo achieve fourth-order accuracy, we equate the coefficients of $u^{(2)}_i$ and $u^{(4)}_i$ from the LHS and RHS expansions.\n1.  Equating coefficients of $u^{(2)}_i$: $1+2\\alpha = c_1 + 4c_2$\n2.  Equating coefficients of $h^2 u^{(4)}_i$: $\\alpha = \\frac{c_1}{12} + \\frac{4c_2}{3} \\implies 12\\alpha = c_1 + 16c_2$\n\nThis is an underdetermined system, representing a family of fourth-order schemes parameterized by $\\alpha$. A minimal stencil width is achieved by setting $c_2=0$. With $c_2=0$, the system of equations simplifies to:\n1.  $1+2\\alpha = c_1$\n2.  $12\\alpha = c_1$\n\nEquating the two expressions for $c_1$ gives $1+2\\alpha = 12\\alpha$, which yields $10\\alpha=1$, so $\\alpha = \\frac{1}{10}$.\nSubstituting this value back gives $c_1 = 12(\\frac{1}{10}) = \\frac{12}{10} = \\frac{6}{5}$.\nThus, the coefficients are: $\\alpha = \\frac{1}{10}, \\quad c_1 = \\frac{6}{5}, \\quad c_2 = 0$.\n\n### Part 2: Truncation Error Constant\n\nThe truncation error of the approximation $u''_i$ for $u_{xx}(x_i)$ is defined by the relation $\\tau_i = u''_{i} - u_{xx}(x_{i}) = K\\,h^{4}\\,u^{(6)}(x_{i}) + \\mathcal{O}(h^{6})$. To find $K$, we analyze the local truncation error of the relation itself, $\\tau_{\\text{rel},i}$, which is the residual obtained by substituting the exact solution into the numerical scheme. To leading order, $(1+2\\alpha)\\tau_i \\approx -\\tau_{\\text{rel},i}$. The leading term of $\\tau_{\\text{rel},i} = \\text{LHS} - \\text{RHS}$ is the term proportional to $h^4 u^{(6)}_i$:\n$$\n\\tau_{\\text{rel},i} = \\left(\\frac{\\alpha}{12} - \\left(\\frac{c_1}{360} + \\frac{8c_2}{45}\\right)\\right)h^4 u^{(6)}_i + \\mathcal{O}(h^6)\n$$\nSubstituting our coefficients $\\alpha=1/10$, $c_1=6/5$, and $c_2=0$:\n$$\n\\tau_{\\text{rel},i} = \\left(\\frac{1/10}{12} - \\frac{6/5}{360}\\right)h^4 u^{(6)}_i + \\mathcal{O}(h^6) = \\left(\\frac{1}{120} - \\frac{1}{300}\\right)h^4 u^{(6)}_i\n$$\n$$\n\\tau_{\\text{rel},i} = \\left(\\frac{5-2}{600}\\right)h^4 u^{(6)}_i = \\frac{3}{600}h^4 u^{(6)}_i = \\frac{1}{200}h^4 u^{(6)}_i\n$$\nNow we solve for $\\tau_i$:\n$$\n(1+2\\alpha)\\tau_i \\approx -\\tau_{\\text{rel},i} = -\\frac{1}{200}h^4 u^{(6)}_i\n$$\nWith $\\alpha=1/10$, we have $1+2\\alpha = 1+1/5 = 6/5$.\n$$\n\\frac{6}{5}\\tau_i \\approx -\\frac{1}{200}h^4 u^{(6)}_i\n$$\n$$\n\\tau_i \\approx -\\frac{5}{6} \\cdot \\frac{1}{200}h^4 u^{(6)}_i = -\\frac{5}{1200}h^4 u^{(6)}_i = -\\frac{1}{240}h^4 u^{(6)}_i\n$$\nBy comparing this with the definition $\\tau_i = K h^4 u^{(6)}_i$, we identify the truncation error constant:\n$$\nK = -\\frac{1}{240}\n$$\n\n### Part 3: Discussion for Variable-Coefficient Operator\n\nThe variable-coefficient conservative diffusion operator is $L[u] = \\partial_{x}(a(x)\\,\\partial_{x} u)$. Using the product rule, this expands to the non-conservative form:\n$$\nL[u] = a(x) u_{xx} + a_x(x) u_x\n$$\nThe problem proposes to discretize this operator at a grid point $x_i$ using the nonconservative substitution $L[u](x_i) \\approx a(x_i) u''_i$.\n\nThe local truncation error $\\tau_{L,i}$ of this discretization is the difference between the discrete and continuous operators:\n$$\n\\tau_{L,i} = a(x_i) u''_i - L[u](x_i) = a_i u''_i - (a_i u_{xx,i} + a_{x,i} u_{x,i})\n$$\n$$\n\\tau_{L,i} = a_i (u''_i - u_{xx,i}) - a_{x,i} u_{x,i}\n$$\nFrom Part 2, we know that $u''_i - u_{xx,i} = K h^4 u^{(6)}_i + \\mathcal{O}(h^6)$. Substituting this into the expression for $\\tau_{L,i}$:\n$$\n\\tau_{L,i} = a_i (K h^4 u^{(6)}_i + \\mathcal{O}(h^6)) - a_{x,i} u_{x,i} = -a_{x,i} u_{x,i} + \\mathcal{O}(h^4)\n$$\nThe leading-order term in this expression is $-a_{x,i} u_{x,i}$. This term is of order $\\mathcal{O}(1)$, as it does not depend on the grid spacing $h$. Consequently, the truncation error does not vanish as $h \\to 0$. This means the proposed discretization is **inconsistent**. Its formal order of accuracy is zero, not fourth order.\n\nThe high-order accuracy of the compact scheme for $u''$ is completely undermined by this nonconservative discretization. The error term $-a_x u_x$ arises from neglecting the spatial variation of the coefficient $a(x)$. In computational combustion, where transport properties like diffusivity $a(x)$ can vary by orders of magnitude across thin flame fronts, the derivative $a_x = da/dx$ is very large, leading to a massive truncation error that renders the simulation physically meaningless. This approach fails to preserve the conservative nature of the underlying physical law, which is a critical failure. The structure of $(a u)^{(6)}$ is irrelevant here because the zeroth-order error dominates entirely.",
            "answer": "$$\n\\boxed{-\\frac{1}{240}}\n$$"
        },
        {
            "introduction": "Theoretical analysis must be complemented by practical verification to ensure that a numerical code performs as designed. This hands-on coding practice  guides you through a complete code verification workflow using the Method of Manufactured Solutions. You will implement a finite volume solver for a representative combustion model and then apply Richardson extrapolation—a powerful technique for estimating the order of accuracy and error constants from a series of grid refinement studies. This exercise bridges the gap between theory and application, equipping you with the essential skills to build confidence in your own computational tools.",
            "id": "4074120",
            "problem": "Consider a one-dimensional, steady advection–diffusion–reaction model representative of scalar transport in computational combustion. On the spatial domain $x \\in [0,1]$, the unknown scalar field $u(x)$ satisfies the boundary value problem\n$$\n- \\frac{d}{dx} \\left( D \\frac{d u}{dx} \\right) + v \\frac{d u}{dx} + k u = s(x),\n$$\nwith Dirichlet boundary conditions $u(0) = u_0$ and $u(1) = u_1$. Here, $D$ is the diffusion coefficient, $v$ is the advection velocity (assume $v \\ge 0$), $k$ is a linear reaction rate, and $s(x)$ is a manufactured source defined so that a chosen smooth function $u_{\\mathrm{exact}}(x)$ is the exact solution to the continuous equation: \n$$\ns(x) = - D \\frac{d^2 u_{\\mathrm{exact}}}{dx^2}(x) + v \\frac{d u_{\\mathrm{exact}}}{dx}(x) + k\\, u_{\\mathrm{exact}}(x).\n$$\nThe Finite Volume Method (FVM) on a uniform grid with $N$ cells and mesh spacing $h = 1/N$ is used to discretize the governing equation at cell centers aligned with nodes $x_i = i h$ for $i = 0,1,\\dots,N$. Assuming constant $D$, $v$, and $k$, and using a second-order central approximation for the diffusion term, a first-order upwind approximation for the advection term (valid for $v > 0$), and a pointwise reaction term at the nodes, the discrete interior equations for $i = 1,2,\\dots,N-1$ take the form\n$$\n- D \\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2} + v \\frac{u_i - u_{i-1}}{h} + k u_i = s(x_i),\n$$\nwith $u_0 = u_{\\mathrm{exact}}(0)$ and $u_N = u_{\\mathrm{exact}}(1)$ prescribed at the boundaries.\n\nLet the grid be refined by an integer ratio $r \\ge 2$, producing three nested grids with $N_1$, $N_2 = r N_1$, and $N_3 = r N_2$ cells, corresponding to mesh sizes $h_1$, $h_2 = h_1/r$, and $h_3 = h_2/r$. On each grid, after solving the discrete system, define a scalar Quantity of Interest (QoI) $Q(h)$ as the discrete solution value at the midpoint $x = 0.5$, which is a grid node when $N$ is even. Suppose the discrete QoI admits an asymptotic error expansion\n$$\nQ(h) = Q^\\star + C h^p + \\mathcal{O}(h^{p+1}),\n$$\nwhere $Q^\\star$ is the grid-independent limit, $p > 0$ is the order of accuracy, and $C$ is the asymptotic error constant. The goal is to construct a Richardson extrapolation framework using the three nested grids to estimate $p$ and $C$.\n\nYour task is to:\n- Implement the FVM discretization described above to solve for $u(x)$ on three nested grids for each test case.\n- Using only the three discrete QoIs $Q(h_1)$, $Q(h_2)$, and $Q(h_3)$ and the refinement ratio $r$, derive and implement a procedure that estimates $p$ and $C$ based on the asymptotic error model and algebraic elimination of the unknown $Q^\\star$.\n- Ensure that the algorithm is robust to moderate pre-asymptotic effects by using the information from all three grids in your estimates.\n\nAll variables in your derivation must be treated mathematically, with explicit use of the asymptotic error definition and standard properties of logarithms as needed, without using any shortcut formulas provided by the problem statement.\n\nThe program must execute the following test suite, solving the above problem for each case and outputting the estimated order $p$ and constant $C$ for each case:\n\n- Test Case 1 (diffusion–reaction, second-order expected):\n    - $D = 0.1$, $v = 0$, $k = 1$, $u_{\\mathrm{exact}}(x) = \\sin(\\pi x)$, $N_1 = 16$, $r = 2$.\n- Test Case 2 (advection-dominated, first-order upwind expected):\n    - $D = 0.005$, $v = 3$, $k = 0.5$, $u_{\\mathrm{exact}}(x) = \\sin(2\\pi x)$, $N_1 = 32$, $r = 2$.\n- Test Case 3 (diffusion–reaction with nonbinary refinement):\n    - $D = 0.01$, $v = 0$, $k = 2$, $u_{\\mathrm{exact}}(x) = e^{x}$, $N_1 = 12$, $r = 3$.\n- Test Case 4 (mixed regime with significant reaction, upwind advection):\n    - $D = 0.02$, $v = 1$, $k = 10$, $u_{\\mathrm{exact}}(x) = \\cosh(2(x - 0.5))$, $N_1 = 18$, $r = 2$.\n\nFor each test case, $u_0$ and $u_1$ must be set to $u_{\\mathrm{exact}}(0)$ and $u_{\\mathrm{exact}}(1)$, respectively. Angles used in trigonometric functions must be in radians. No physical units are required because the problem is posed in nondimensional form.\n\nFinal Output Format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a two-element list $[p, C]$ with floating-point values for the corresponding test case. For example, a valid output format is:\n$$\n[[p_1,C_1],[p_2,C_2],[p_3,C_3],[p_4,C_4]].\n$$",
            "solution": "### 1. Finite Volume Discretization and Linear System Formulation\n\nThe discrete equation for the interior nodes $i=1, 2, \\dots, N-1$ is:\n$$\n- D \\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2} + v \\frac{u_i - u_{i-1}}{h} + k u_i = s(x_i)\n$$\nRearranging the equation to group terms by their spatial index gives:\n$$\n\\left(-\\frac{D}{h^2} - \\frac{v}{h}\\right) u_{i-1} + \\left(\\frac{2D}{h^2} + \\frac{v}{h} + k\\right) u_i + \\left(-\\frac{D}{h^2}\\right) u_{i+1} = s(x_i)\n$$\nThis defines a tridiagonal linear system $A \\mathbf{u} = \\mathbf{b}$, where $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$. For a general row $i$, the non-zero matrix entries are:\n- Lower diagonal, $A_{i, i-1} = -\\frac{D}{h^2} - \\frac{v}{h}$\n- Main diagonal, $A_{i, i} = \\frac{2D}{h^2} + \\frac{v}{h} + k$\n- Upper diagonal, $A_{i, i+1} = -\\frac{D}{h^2}$\n\nThe Dirichlet boundary conditions $u_0$ and $u_N$ are incorporated into the right-hand side vector $\\mathbf{b}$.\n\n### 2. Derivation of Estimators for Order of Accuracy $(p)$ and Error Constant $(C)$\n\nThe asymptotic error expansion for the Quantity of Interest (QoI), $Q(h)$, is:\n$$\nQ(h) = Q^\\star + C h^p + \\mathcal{O}(h^{p+1})\n$$\nWe have three solutions on nested grids with sizes $h_1$, $h_2 = h_1/r$, and $h_3 = h_2/r = h_1/r^2$. Let the corresponding QoI values be $Q_1$, $Q_2$, and $Q_3$. Neglecting higher-order terms:\n$$\n\\begin{align}\nQ_1 & \\approx Q^\\star + C h_1^p \\quad &(1) \\\\\nQ_2 & \\approx Q^\\star + C h_2^p = Q^\\star + C \\frac{h_1^p}{r^p} \\quad &(2) \\\\\nQ_3 & \\approx Q^\\star + C h_3^p = Q^\\star + C \\frac{h_1^p}{r^{2p}} \\quad &(3)\n\\end{align}\n$$\nWe eliminate the unknown exact value $Q^\\star$ by subtracting the equations.\nSubtracting equation (2) from (1):\n$$\nQ_1 - Q_2 \\approx C h_1^p \\left(1 - \\frac{1}{r^p}\\right) \\quad (4)\n$$\nSubtracting equation (3) from (2):\n$$\nQ_2 - Q_3 \\approx C \\frac{h_1^p}{r^p} \\left(1 - \\frac{1}{r^p}\\right) \\quad (5)\n$$\nTaking the ratio of equation (4) to equation (5) eliminates $C$ and $h_1$:\n$$\n\\frac{Q_1 - Q_2}{Q_2 - Q_3} \\approx \\frac{C h_1^p \\left(1 - \\frac{1}{r^p}\\right)}{C \\frac{h_1^p}{r^p} \\left(1 - \\frac{1}{r^p}\\right)} = r^p\n$$\nSolving for $p$ by taking the natural logarithm of both sides gives the estimator for the order of accuracy:\n$$\np \\approx \\frac{\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right)}{\\ln(r)}\n$$\nTo estimate $C$, we rearrange equation (4):\n$$\nC \\approx \\frac{Q_1 - Q_2}{h_1^p - h_2^p}\n$$\nwhere $p$ in the denominator is the value estimated in the previous step.\n\n### 3. Algorithm for Test Case Execution\n\nFor each test case:\n1. Define the physical parameters, refinement ratio, and initial grid count.\n2. Define the manufactured solution and its derivatives to compute the source term $s(x)$.\n3. Calculate the grid sizes $N_1, N_2, N_3$.\n4. For each grid size $N_j$, construct and solve the linear system $A\\mathbf{u}=\\mathbf{b}$ to find the solution vector $\\mathbf{u}$.\n5. Extract the QoI, $Q_j = u(x=0.5)$, from the solution.\n6. Use the collected QoIs ($Q_1, Q_2, Q_3$) and the refinement ratio $r$ to compute the estimated order $p$ and constant $C$ using the derived formulas.\n7. Format the results as specified.",
            "answer": "```python\nimport numpy as np\n\ndef solve_fvm(params, N):\n    \"\"\"\n    Solves the 1D advection-diffusion-reaction BVP using the specified FVM.\n\n    Args:\n        params (dict): A dictionary containing D, v, k, and functions for\n                       u_exact, u_exact_deriv1, u_exact_deriv2.\n        N (int): The number of cells in the grid.\n\n    Returns:\n        float: The discrete solution value at x = 0.5 (the QoI).\n    \"\"\"\n    D = params['D']\n    v = params['v']\n    k = params['k']\n    u_exact_func = params['u_exact_func']\n    u_exact_deriv1 = params['u_exact_deriv1']\n    u_exact_deriv2 = params['u_exact_deriv2']\n\n    h = 1.0 / N\n    x_nodes = np.linspace(0.0, 1.0, N + 1)\n    \n    # Manufactured source term\n    s_func = lambda x: -D * u_exact_deriv2(x) + v * u_exact_deriv1(x) + k * u_exact_func(x)\n    \n    dim = N - 1\n    if dim = 0:\n        return np.nan\n\n    # Setup the linear system Au = b for interior nodes u_1, ..., u_{N-1}\n    A = np.zeros((dim, dim))\n    b = np.zeros(dim)\n    \n    # Coefficients from the discrete equation\n    coeff_im1 = -D / h**2 - v / h\n    coeff_i   = 2 * D / h**2 + v / h + k\n    coeff_ip1 = -D / h**2\n    \n    # Fill the tridiagonal matrix A\n    np.fill_diagonal(A, coeff_i)\n    if dim > 1:\n        np.fill_diagonal(A[1:], coeff_im1)\n        np.fill_diagonal(A[:, 1:], coeff_ip1)\n\n    # Fill the RHS vector b, including source term and BCs\n    for i in range(1, N):\n        idx = i - 1\n        b[idx] = s_func(x_nodes[i])\n        \n    u0 = u_exact_func(0.0)\n    uN = u_exact_func(1.0)\n    \n    b[0] -= coeff_im1 * u0\n    if dim > 1:\n        b[dim - 1] -= coeff_ip1 * uN\n\n    # Solve the system\n    u_internal = np.linalg.solve(A, b)\n    \n    # Extract the Quantity of Interest (QoI), u(x=0.5)\n    # The index for x=0.5 is i = 0.5 / h = N/2.\n    # The unknowns u_internal are u_1, ..., u_{N-1}.\n    # The index in u_internal for u_i is i-1.\n    qoi_node_idx = N // 2\n    qoi_vec_idx = qoi_node_idx - 1\n    \n    qoi = u_internal[qoi_vec_idx]\n    \n    return qoi\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test Case 1\n        {\n            'D': 0.1, 'v': 0.0, 'k': 1.0, 'r': 2, 'N1': 16,\n            'u_exact_func': lambda x: np.sin(np.pi * x),\n            'u_exact_deriv1': lambda x: np.pi * np.cos(np.pi * x),\n            'u_exact_deriv2': lambda x: -np.pi**2 * np.sin(np.pi * x),\n        },\n        # Test Case 2\n        {\n            'D': 0.005, 'v': 3.0, 'k': 0.5, 'r': 2, 'N1': 32,\n            'u_exact_func': lambda x: np.sin(2 * np.pi * x),\n            'u_exact_deriv1': lambda x: 2 * np.pi * np.cos(2 * np.pi * x),\n            'u_exact_deriv2': lambda x: -4 * np.pi**2 * np.sin(2 * np.pi * x),\n        },\n        # Test Case 3\n        {\n            'D': 0.01, 'v': 0.0, 'k': 2.0, 'r': 3, 'N1': 12,\n            'u_exact_func': lambda x: np.exp(x),\n            'u_exact_deriv1': lambda x: np.exp(x),\n            'u_exact_deriv2': lambda x: np.exp(x),\n        },\n        # Test Case 4\n        {\n            'D': 0.02, 'v': 1.0, 'k': 10.0, 'r': 2, 'N1': 18,\n            'u_exact_func': lambda x: np.cosh(2 * (x - 0.5)),\n            'u_exact_deriv1': lambda x: 2 * np.sinh(2 * (x - 0.5)),\n            'u_exact_deriv2': lambda x: 4 * np.cosh(2 * (x - 0.5)),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        N1 = case['N1']\n        r = case['r']\n        N2 = r * N1\n        N3 = r * N2\n\n        # Solve on the three nested grids\n        Q1 = solve_fvm(case, N1)\n        Q2 = solve_fvm(case, N2)\n        Q3 = solve_fvm(case, N3)\n\n        # Estimate order of accuracy p\n        # p = ln((Q1-Q2)/(Q2-Q3)) / ln(r)\n        ratio_of_diffs = (Q1 - Q2) / (Q2 - Q3)\n        # Handle cases where differences might be zero or negative, returning NaN\n        if ratio_of_diffs = 0:\n            p_est = np.nan\n        else:\n            p_est = np.log(ratio_of_diffs) / np.log(r)\n        \n        # Estimate leading error constant C\n        # C = (Q1 - Q2) / (h1^p - h2^p)\n        h1 = 1.0 / N1\n        h2 = 1.0 / N2\n        \n        if np.isnan(p_est) or (Q1 - Q2) == 0:\n            C_est = np.nan\n        else:\n            C_est = (Q1 - Q2) / (h1**p_est - h2**p_est)\n\n        results.append([p_est, C_est])\n\n    # Format the final output string\n    output_str = f\"[{','.join(f'[{p},{c}]' for p, c in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "In practice, numerical verification studies rarely yield the perfect integer-valued convergence rates predicted by theory, especially when simulating complex phenomena like flames with sharp internal layers. This exercise  challenges you to move beyond textbook examples and develop the critical skills needed to interpret real-world convergence data. By analyzing a set of simulated error measurements, you will learn to diagnose pre-asymptotic behavior, understand why different error norms such as $L_2$ and $L_\\infty$ can tell different stories about accuracy, and recognize the signatures of unresolved physical features in your numerical solutions.",
            "id": "4074168",
            "problem": "Consider a one-dimensional planar premixed flame modeled, at leading order, by the steady advection–diffusion–reaction balance for a progress variable $c(x)$ on a domain $x \\in [0,L]$,\n$$\nu\\,\\frac{\\mathrm{d} c}{\\mathrm{d} x} \\;=\\; D\\,\\frac{\\mathrm{d}^2 c}{\\mathrm{d} x^2} \\;+\\; \\omega(c),\n$$\nwhere $u$ is the streamwise velocity, $D$ is the molecular diffusivity, and $\\omega(c)$ is the chemical source term. In the reaction zone, a distinguished internal-layer length scale emerges from diffusion–reaction balance, given by $\\delta \\sim \\sqrt{D/k}$ when $\\omega(c)$ is locally characterized by a rate constant $k$ and a normalized reaction function. This internal layer sets the spatial scale of large gradients, and hence it controls the magnitude of truncation error coefficients that depend on higher spatial derivatives.\n\nA second-order finite-volume spatial discretization (nominal order $p=2$) is used to solve for $c(x)$ on a sequence of uniform grids with spacing $h$, while time discretization is absent (steady problem) and boundary conditions anchor the flame location. The discretization error is measured against a highly resolved reference solution obtained on a grid with spacing $h_{\\mathrm{ref}}$ such that $h_{\\mathrm{ref}}/\\delta = 1/128$, and reported in the discrete $L_2$ and $L_\\infty$ norms as functions of $h$. Three grids are considered, with $h/\\delta \\in \\{0.25,\\,0.125,\\,0.0625\\}$, corresponding respectively to $h_0$, $h_1$, and $h_2$. The observed errors are:\n- $L_2$ norm: $E_{L_2}(h_0) = 1.6\\times 10^{-2}$, $E_{L_2}(h_1) = 6.97\\times 10^{-3}$, $E_{L_2}(h_2) = 1.868\\times 10^{-3}$.\n- $L_\\infty$ norm: $E_{L_\\infty}(h_0) = 5.0\\times 10^{-2}$, $E_{L_\\infty}(h_1) = 2.6\\times 10^{-2}$, $E_{L_\\infty}(h_2) = 1.4\\times 10^{-2}$.\n\nWithin the framework of truncation error analysis, asymptotic order studies assume that for sufficiently small $h$, the discretization error behaves like $E(h)\\approx \\alpha\\,h^p$, where $\\alpha$ is a coefficient determined by the solution’s regularity and local derivatives, and $p$ is the nominal order of the scheme. In reacting flows, pre-asymptotic behavior can persist if $h$ is not small relative to the smallest physical length scales (e.g., $\\delta$), or if other effects (e.g., grid-alignment errors of an internal layer) dominate some error norms.\n\nBased on the data above and first-principles reasoning about truncation error in internal layers in reacting flows, which of the following statements are mathematically justified for detecting pre-asymptotic behavior and for identifying pitfalls in order studies?\n\nA. The non-integer apparent order inferred from successive halving of $h$ in the $L_2$ norm increases from approximately $1.2$ to approximately $1.9$ as $h/\\delta$ decreases from $0.25$ to $0.0625$. This monotonic increase toward the nominal order $p=2$ indicates pre-asymptotic contamination at coarser grids, hence the two coarser grids are pre-asymptotic.\n\nB. Because the errors decrease monotonically with refinement in both $L_2$ and $L_\\infty$, the study is already in the asymptotic regime; monotone decrease is sufficient to certify asymptotic order behavior.\n\nC. Using the internal-layer scale $\\delta=\\sqrt{D/k}$ as the controlling feature, a practical grid-resolution criterion for asymptotics is $h/\\delta \\ll 1$. With $h/\\delta = 0.25,\\,0.125,\\,0.0625$, only the finest grid plausibly satisfies this, warning of pre-asymptotic behavior on the two coarser grids.\n\nD. The discrepancy between apparent orders extracted from $L_2$ and $L_\\infty$ (about $1.9$ versus about $0.9$ on the finest pair) is consistent with grid-alignment errors of the flame location dominating the $L_\\infty$ norm; this norm sensitivity is a robust diagnostic of pre-asymptotic behavior in internal-layer problems.\n\nE. Performing two-grid Richardson extrapolation on the two finest grids removes pre-asymptotic effects and guarantees an exact asymptotic order, regardless of internal layers; therefore it is sufficient to certify second-order accuracy.\n\nSelect all that apply.",
            "solution": "To evaluate the statements, we must first compute the apparent order of accuracy, $p_{\\text{app}}$, from the provided error data. For a sequence of grids where the spacing is halved ($r=2$), $p_{\\text{app}}$ between two grids is calculated as:\n$$\np_{\\text{app}} = \\log_2\\left(\\frac{E_{\\text{coarse}}}{E_{\\text{fine}}}\\right)\n$$\n\n**Calculations for the $L_2$ norm:**\n- Between grids $h_0$ ($h/\\delta=0.25$) and $h_1$ ($h/\\delta=0.125$):\n  $p_{\\text{app}, L_2, 01} = \\log_2\\left(\\frac{1.6 \\times 10^{-2}}{6.97 \\times 10^{-3}}\\right) \\approx \\log_2(2.2955) \\approx 1.20$\n- Between grids $h_1$ ($h/\\delta=0.125$) and $h_2$ ($h/\\delta=0.0625$):\n  $p_{\\text{app}, L_2, 12} = \\log_2\\left(\\frac{6.97 \\times 10^{-3}}{1.868 \\times 10^{-3}}\\right) \\approx \\log_2(3.7313) \\approx 1.90$\n\n**Calculations for the $L_\\infty$ norm:**\n- Between grids $h_0$ and $h_1$:\n  $p_{\\text{app}, L_\\infty, 01} = \\log_2\\left(\\frac{5.0 \\times 10^{-2}}{2.6 \\times 10^{-2}}\\right) \\approx \\log_2(1.9231) \\approx 0.94$\n- Between grids $h_1$ and $h_2$:\n  $p_{\\text{app}, L_\\infty, 12} = \\log_2\\left(\\frac{2.6 \\times 10^{-2}}{1.4 \\times 10^{-2}}\\right) \\approx \\log_2(1.8571) \\approx 0.89$\n\nNow we analyze each statement based on these results and numerical analysis principles.\n\n**A. Correct.** Our calculations confirm that the apparent order for the $L_2$ norm increases from $\\approx 1.2$ to $\\approx 1.9$. The nominal order of the scheme is $p=2$. An apparent order that is lower than the nominal order but increases toward it upon grid refinement is the classic signature of pre-asymptotic behavior. This indicates that the grids are not yet fine enough for the leading-order error term to dominate. The logic and conclusion are sound.\n\n**B. Incorrect.** The error data does show a monotonic decrease, which is a necessary condition for convergence. However, it is not a sufficient condition for being in the *asymptotic* regime. The asymptotic regime requires the error to decrease at a specific rate, i.e., $E(h) \\approx \\alpha h^p$. Our calculations show that the convergence rate (the apparent order) is not constant and is not equal to the nominal order of $p=2$. Therefore, the study is demonstrably not in the asymptotic regime.\n\n**C. Correct.** This statement presents a first-principles argument. To accurately capture a physical feature, the grid resolution $h$ must be significantly smaller than the feature's characteristic length scale $\\delta$. The criterion $h/\\delta \\ll 1$ is a standard rule of thumb for ensuring the grid is fine enough to expect asymptotic convergence. The given resolutions $h/\\delta = 1/4$, $1/8$, and $1/16$ represent 4, 8, and 16 cells per flame thickness, respectively. The first two are widely considered too coarse for asymptotic behavior in sharp-layer problems. The reasoning that these grids are likely pre-asymptotic is a sound and practical judgment, which is confirmed by the error data.\n\n**D. Correct.** Our calculations for the finest grid pair ($h_1, h_2$) show $p_{\\text{app}, L_2} \\approx 1.90$ and $p_{\\text{app}, L_\\infty} \\approx 0.89$. This confirms the numerical discrepancy. The theoretical explanation is also correct. The $L_\\infty$ norm measures the maximum pointwise error. For problems with sharp moving fronts or internal layers, a small misalignment (phase error) between the numerical and exact solutions can create a large local error that dominates the $L_\\infty$ norm. This phase error often scales as $\\mathcal{O}(h)$, leading to an apparent order of $\\approx 1$, masking the higher formal order of the scheme. The $L_2$ norm, being an integral measure of error, is less sensitive to such localized phase errors and thus often shows a convergence rate closer to the nominal one. The observed difference is a robust indicator of an unresolved internal layer.\n\n**E. Incorrect.** Richardson extrapolation is a technique for accelerating convergence or estimating errors, but its validity rests on the assumption that the error is already in the asymptotic regime, i.e., dominated by the leading term $E(h) \\approx \\alpha h^p$. If the problem is pre-asymptotic, as is the case here, the method's assumptions are violated. It cannot \"remove\" pre-asymptotic effects or \"guarantee\" an exact asymptotic order. Applying it under these conditions will yield inaccurate results.\n\nTherefore, the justified statements are A, C, and D.",
            "answer": "$$\\boxed{ACD}$$"
        }
    ]
}