{
    "hands_on_practices": [
        {
            "introduction": "This first practice serves as a cornerstone for understanding Stefan-Maxwell diffusion. By analyzing the classic case of binary equimolar counterdiffusion , you will derive species fluxes and velocities from first principles. This exercise reinforces the fundamental relationships between mole fraction gradients, fluxes, and velocities, and provides a concrete verification of key constraints such as zero net molar flux and zero molar-average velocity.",
            "id": "4067774",
            "problem": "Consider a steady, one-dimensional (1D) equimolar counterdiffusion of oxygen $\\mathrm{O}_2$ and nitrogen $\\mathrm{N}_2$ between two large, isothermal, isobaric reservoirs connected by a planar channel of length $L$. The gas mixture is ideal and at constant temperature $T=900\\,\\mathrm{K}$ and pressure $p=1.01325\\times 10^5\\,\\mathrm{Pa}$. The binary Stefan-Maxwell (S-M) diffusion coefficient for $\\mathrm{O}_2$–$\\mathrm{N}_2$ at these conditions is $D_{\\mathrm{O}_2\\mathrm{N}_2}=1.30\\times 10^{-4}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$. At $z=0$ the mole fraction is $x_{\\mathrm{O}_2}(0)=0.80$, and at $z=L=0.020\\,\\mathrm{m}$ the mole fraction is $x_{\\mathrm{O}_2}(L)=0.20$. Assume no chemical reaction, negligible thermal diffusion (Soret) and barodiffusion, and neglect any externally imposed bulk flow.\n\nUsing Stefan-Maxwell diffusion modeling and first principles (ideal gas law, species flux definitions, and species continuity), derive the species molar diffusive fluxes $J_{\\mathrm{O}_2}$ and $J_{\\mathrm{N}_2}$ and the species velocities $v_{\\mathrm{O}_2}(z)$ and $v_{\\mathrm{N}_2}(z)$ relative to a stationary laboratory frame. Explicitly verify that the molar-average mixture velocity $\\mathbf{v}$ is zero everywhere and that $\\sum_i \\mathbf{J}_i=\\mathbf{0}$. Compute the species velocities at the mid-plane $z=L/2$.\n\nFinally, report the magnitude of the $\\mathrm{O}_2$ molar diffusive flux $J_{\\mathrm{O}_2}$ in $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$. Round your final numerical answer to four significant figures.",
            "solution": "The problem is first validated against the specified criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **Process:** Steady, one-dimensional (1D) equimolar counterdiffusion.\n-   **Species:** Oxygen ($\\mathrm{O}_2$) and Nitrogen ($\\mathrm{N}_2$).\n-   **Geometry:** Planar channel of length $L = 0.020\\,\\mathrm{m}$.\n-   **Thermodynamic State:** Ideal gas mixture, constant temperature $T=900\\,\\mathrm{K}$, constant pressure $p=1.01325\\times 10^5\\,\\mathrm{Pa}$.\n-   **Transport Property:** Binary Stefan-Maxwell diffusion coefficient $D_{\\mathrm{O}_2\\mathrm{N}_2}=1.30\\times 10^{-4}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$.\n-   **Boundary Conditions:**\n    -   At $z=0$: mole fraction $x_{\\mathrm{O}_2}(0)=0.80$.\n    -   At $z=L$: mole fraction $x_{\\mathrm{O}_2}(L)=0.20$.\n-   **Assumptions:**\n    -   No chemical reaction.\n    -   Negligible thermal diffusion (Soret effect).\n    -   Negligible barodiffusion.\n    -   Negligible externally imposed bulk flow.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is a classic example of binary gas diffusion, firmly rooted in the principles of continuum mechanics and transport phenomena. The governing Stefan-Maxwell equations are fundamental in this field.\n-   **Well-Posed:** The problem is a steady-state, one-dimensional boundary value problem with well-defined conditions (constant temperature, pressure, and species mole fractions at the boundaries). This structure ensures a unique, stable solution.\n-   **Objective:** The problem is stated using precise, quantitative, and unbiased language.\n-   **Completeness and Consistency:** The problem provides all necessary data (T, p, L, D, boundary conditions) to determine the requested quantities. The assumption of \"equimolar counterdiffusion\" is consistent with an isobaric, isothermal binary system with no net molar flux.\n-   **Realism and Feasibility:** The given physical parameters ($T$, $p$, $L$, $D_{\\mathrm{O}_2\\mathrm{N}_2}}$) are realistic for gas-phase diffusion studies.\n-   **Overall Structure:** The problem is well-structured and does not contain any of the listed flaws. It is a canonical problem in chemical engineering and combustion science.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. The solution process will now proceed.\n\n### Solution\n\nThe system is described by the steady-state, one-dimensional species continuity equation with no chemical reactions, which is given by:\n$$\n\\frac{d N_i}{dz} = 0\n$$\nwhere $N_i$ is the molar flux of species $i$ relative to a stationary coordinate system. This equation implies that $N_i$ is constant for each species along the channel length $z$. The problem involves two species: oxygen ($\\mathrm{O}_2$) and nitrogen ($\\mathrm{N}_2$).\n\nThe Stefan-Maxwell equation for a binary mixture in one dimension ($z$-direction) relates the gradient of mole fraction to the species molar fluxes:\n$$\n\\frac{dx_{\\mathrm{O}_2}}{dz} = \\frac{x_{\\mathrm{O}_2} N_{\\mathrm{N}_2} - x_{\\mathrm{N}_2} N_{\\mathrm{O}_2}}{c D_{\\mathrm{O}_2\\mathrm{N}_2}}}\n$$\nwhere $c$ is the total molar concentration, $x_i$ is the mole fraction of species $i$, and $D_{\\mathrm{O}_2\\mathrm{N}_2}}$ is the binary diffusion coefficient. Since the gas mixture is ideal and at constant temperature $T$ and pressure $p$, the total molar concentration $c$ is also constant, as given by the ideal gas law:\n$$\nc = \\frac{p}{RT}\n$$\nwhere $R$ is the universal gas constant.\n\nThe problem specifies \"equimolar counterdiffusion,\" which means that the net molar flux is zero:\n$$\nN = N_{\\mathrm{O}_2} + N_{\\mathrm{N}_2} = 0\n$$\nThis implies that the molar fluxes of the two species are equal in magnitude and opposite in direction: $N_{\\mathrm{N}_2} = -N_{\\mathrm{O}_2}$.\n\nSubstituting $N_{\\mathrm{N}_2} = -N_{\\mathrm{O}_2}$ and $x_{\\mathrm{N}_2} = 1 - x_{\\mathrm{O}_2}$ into the Stefan-Maxwell equation:\n$$\n\\frac{dx_{\\mathrm{O}_2}}{dz} = \\frac{x_{\\mathrm{O}_2} (-N_{\\mathrm{O}_2}) - (1 - x_{\\mathrm{O}_2}) N_{\\mathrm{O}_2}}{c D_{\\mathrm{O}_2\\mathrm{N}_2}}} = \\frac{-x_{\\mathrm{O}_2} N_{\\mathrm{O}_2} - N_{\\mathrm{O}_2} + x_{\\mathrm{O}_2} N_{\\mathrm{O}_2}}{c D_{\\mathrm{O}_2\\mathrm{N}_2}}} = \\frac{-N_{\\mathrm{O}_2}}{c D_{\\mathrm{O}_2\\mathrm{N}_2}}}\n$$\nThis is the equivalent of Fick's first law for this specific case. We can rearrange to solve for the constant molar flux $N_{\\mathrm{O}_2}$:\n$$\nN_{\\mathrm{O}_2} = -c D_{\\mathrm{O}_2\\mathrm{N}_2} \\frac{dx_{\\mathrm{O}_2}}{dz}\n$$\nSince $N_{\\mathrm{O}_2}$, $c$, and $D_{\\mathrm{O}_2\\mathrm{N}_2}$ are all constants, the mole fraction gradient $dx_{\\mathrm{O}_2}/dz$ must also be constant. We can integrate this equation over the length of the channel from $z=0$ to $z=L$:\n$$\n\\int_0^L N_{\\mathrm{O}_2} dz = \\int_{x_{\\mathrm{O}_2}(0)}^{x_{\\mathrm{O}_2}(L)} -c D_{\\mathrm{O}_2\\mathrm{N}_2} dx_{\\mathrm{O}_2}\n$$\n$$\nN_{\\mathrm{O}_2} L = -c D_{\\mathrm{O}_2\\mathrm{N}_2} [x_{\\mathrm{O}_2}(L) - x_{\\mathrm{O}_2}(0)]\n$$\n$$\nN_{\\mathrm{O}_2} = \\frac{c D_{\\mathrm{O}_2\\mathrm{N}_2}}{L} [x_{\\mathrm{O}_2}(0) - x_{\\mathrm{O}_2}(L)]\n$$\nThe total molar flux $N_i$ is the sum of the diffusive flux $J_i$ (relative to the molar-average velocity) and the convective flux: $N_i = J_i + x_i N$. Since $N=0$ for equimolar counterdiffusion, the total flux is equal to the diffusive flux: $N_i = J_i$.\nTherefore, the species molar diffusive fluxes are:\n$$\nJ_{\\mathrm{O}_2} = \\frac{c D_{\\mathrm{O}_2\\mathrm{N}_2}}{L} [x_{\\mathrm{O}_2}(0) - x_{\\mathrm{O}_2}(L)]\n$$\n$$\nJ_{\\mathrm{N}_2} = N_{\\mathrm{N}_2} = -N_{\\mathrm{O}_2} = -J_{\\mathrm{O}_2}\n$$\nWe can immediately verify that $\\sum_i \\mathbf{J}_i = J_{\\mathrm{O}_2} + J_{\\mathrm{N}_2} = J_{\\mathrm{O}_2} - J_{\\mathrm{O}_2} = \\mathbf{0}$.\n\nThe species velocity $v_i(z)$ is related to the molar flux $N_i$ by $N_i = c_i v_i = c x_i v_i$. Thus:\n$$\nv_i(z) = \\frac{N_i}{c x_i(z)} = \\frac{J_i}{c x_i(z)}\n$$\nThe mole fraction profile $x_{\\mathrm{O}_2}(z)$ is linear because its gradient is constant:\n$$\nx_{\\mathrm{O}_2}(z) = x_{\\mathrm{O}_2}(0) + \\frac{x_{\\mathrm{O}_2}(L) - x_{\\mathrm{O}_2}(0)}{L} z\n$$\nAnd $x_{\\mathrm{N}_2}(z) = 1 - x_{\\mathrm{O}_2}(z)$.\nThe species velocities are therefore:\n$$\nv_{\\mathrm{O}_2}(z) = \\frac{J_{\\mathrm{O}_2}} {c \\left( x_{\\mathrm{O}_2}(0) + \\frac{z}{L}(x_{\\mathrm{O}_2}(L) - x_{\\mathrm{O}_2}(0)) \\right)}\n$$\n$$\nv_{\\mathrm{N}_2}(z) = \\frac{J_{\\mathrm{N}_2}} {c \\left( 1 - \\left( x_{\\mathrm{O}_2}(0) + \\frac{z}{L}(x_{\\mathrm{O}_2}(L) - x_{\\mathrm{O}_2}(0)) \\right) \\right)}\n$$\nThe molar-average mixture velocity $\\mathbf{v}$ is defined as $\\mathbf{v} = \\sum_i x_i \\mathbf{v}_i$. In 1D:\n$$\nv(z) = x_{\\mathrm{O}_2}(z) v_{\\mathrm{O}_2}(z) + x_{\\mathrm{N}_2}(z) v_{\\mathrm{N}_2}(z) = x_{\\mathrm{O}_2}(z) \\frac{N_{\\mathrm{O}_2}}{c x_{\\mathrm{O}_2}(z)} + x_{\\mathrm{N}_2}(z) \\frac{N_{\\mathrm{N}_2}}{c x_{\\mathrm{N}_2}(z)} = \\frac{N_{\\mathrm{O}_2} + N_{\\mathrm{N}_2}}{c} = \\frac{N}{c}\n$$\nSince $N=0$ for equimolar counterdiffusion, the molar-average velocity $v(z)=0$ everywhere, as required.\n\nNow we compute the numerical values. The universal gas constant is $R \\approx 8.31446\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\nTotal molar concentration:\n$$\nc = \\frac{p}{RT} = \\frac{1.01325 \\times 10^5\\,\\mathrm{Pa}}{(8.31446\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1})(900\\,\\mathrm{K})} \\approx 13.5407\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\nMolar flux of oxygen:\n$$\nJ_{\\mathrm{O}_2} = \\frac{(13.5407\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(1.30\\times 10^{-4}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1})}{0.020\\,\\mathrm{m}} (0.80 - 0.20)\n$$\n$$\nJ_{\\mathrm{O}_2} = (0.08801455\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1})(0.60) \\approx 0.0528087\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}\n$$\nThe magnitude is $|J_{\\mathrm{O}_2}}| \\approx 0.0528087\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$. Rounding to four significant figures gives $5.281 \\times 10^{-2}\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\nAlso, $J_{\\mathrm{N}_2} = -J_{\\mathrm{O}_2} \\approx -0.0528087\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n\nTo find velocities at the mid-plane, $z = L/2 = 0.010\\,\\mathrm{m}$. First, find mole fractions at this point:\n$$\nx_{\\mathrm{O}_2}(L/2) = 0.80 + \\frac{0.010}{0.020}(0.20 - 0.80) = 0.80 + 0.5(-0.60) = 0.80 - 0.30 = 0.50\n$$\n$$\nx_{\\mathrm{N}_2}(L/2) = 1 - x_{\\mathrm{O}_2}(L/2) = 1 - 0.50 = 0.50\n$$\nNow compute the species velocities at $z=L/2$:\n$$\nv_{\\mathrm{O}_2}(L/2) = \\frac{J_{\\mathrm{O}_2}}{c x_{\\mathrm{O}_2}(L/2)} = \\frac{0.0528087\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}}{(13.5407\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(0.50)} \\approx 0.0077999\\,\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\n$$\nv_{\\mathrm{N}_2}(L/2) = \\frac{J_{\\mathrm{N}_2}}{c x_{\\mathrm{N}_2}(L/2)} = \\frac{-0.0528087\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}}{(13.5407\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(0.50)} \\approx -0.0077999\\,\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\nThe derivations and verifications are complete. The final required answer is the magnitude of the $\\mathrm{O}_2$ molar diffusive flux.\n$|J_{\\mathrm{O}_2}}| \\approx 5.281 \\times 10^{-2}\\,\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.",
            "answer": "$$\\boxed{5.281 \\times 10^{-2}}$$"
        },
        {
            "introduction": "Building on the binary system, this exercise explores a crucial and often misunderstood physical detail: the effect of pressure on diffusion rates . By examining diffusion through a nozzle with a strong pressure gradient, you will derive how the flux magnitude behaves in a non-isobaric system. This practice is designed to reveal the important cancellation effect between molar concentration $c$ and the diffusion coefficient $D_{ij}$ for ideal gases, and to quantify the error made when this pressure dependence is neglected.",
            "id": "4067754",
            "problem": "Consider a steady, one-dimensional flow of a binary ideal-gas mixture of hydrogen $\\mathrm{H_2}$ (species $1$) and water vapor $\\mathrm{H_2O}$ (species $2$) through a converging nozzle. The mixture is isothermal at temperature $T$ and body forces and thermal diffusion are negligible. The diffusive molar flux is measured relative to the molar-average velocity so that $\\sum_{i=1}^{2} \\mathbf{N}_{i} = \\mathbf{0}$. The binary diffusion coefficient at fixed temperature follows a well-tested kinetic-theory scaling with pressure, namely $D_{12}(p) = D_{12,\\mathrm{ref}} \\, p_{\\mathrm{ref}}/p$, and the ideal-gas total molar concentration is $c = p/(R T)$, where $R$ is the universal gas constant.\n\nIn the throat region, the axial mole-fraction gradient of $\\mathrm{H_2}$ is approximately uniform and equal to $\\nabla x_{1} = \\frac{d x_{1}}{d x} = 0.040 \\,\\mathrm{m}^{-1}$. The reference diffusion coefficient and reference pressure are $D_{12,\\mathrm{ref}} = 1.50 \\times 10^{-4} \\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$ at $p_{\\mathrm{ref}} = 5.00 \\times 10^{5} \\,\\mathrm{Pa}$. The local throat pressure is $p_{\\mathrm{t}} = 1.00 \\times 10^{5} \\,\\mathrm{Pa}$. The temperature is $T = 1100 \\,\\mathrm{K}$.\n\nStarting from the Stefan-Maxwell diffusion formulation for a binary mixture, derive the expression for the $\\mathrm{H_2}$ molar diffusive flux $\\mathbf{N}_{1}$ in terms of $p$, $T$, $D_{12}(p)$, and $\\nabla x_{1}$, and explain how the pressure dependence of $D_{12}(p)$ alters flux magnitudes across the nozzle when the pressure gradient $\\nabla p$ is strong. Then, using the derived expressions, compute the signed relative error at the throat if one instead treats $D_{12}$ as a constant equal to $D_{12,\\mathrm{ref}}$ while using the local ideal-gas $c(p)$. Define the signed relative error as\n$$\n\\varepsilon \\equiv \\frac{|\\mathbf{N}_{1}|_{\\text{const } D} - |\\mathbf{N}_{1}|_{\\text{variable } D}}{|\\mathbf{N}_{1}|_{\\text{variable } D}}.\n$$\nExpress your final answer for $\\varepsilon$ as a decimal number and round your answer to four significant figures. No units are required for $\\varepsilon$.",
            "solution": "The problem is first validated for scientific soundness, consistency, and completeness. The givens are extracted and examined. The problem setup is a standard scenario in transport phenomena and combustion science involving Stefan-Maxwell diffusion in a binary ideal gas mixture. The provided physical relations, such as the pressure dependence of the binary diffusion coefficient ($D_{12} \\propto 1/p$) and the ideal gas law ($c = p/(RT)$), are fundamentally correct and well-established by kinetic theory. The numerical values are physically plausible for a high-temperature gas flow system. The problem is well-posed, with sufficient information to derive the required expressions and compute the specified error. Therefore, the problem is deemed valid and a full solution is warranted.\n\nThe solution is developed in three parts as requested by the problem: first, the derivation of the molar diffusive flux expression; second, an explanation of the role of pressure-dependent diffusivity; and third, the computation of the specified relative error.\n\n**Part 1: Derivation of the Molar Diffusive Flux Expression**\n\nThe Stefan-Maxwell diffusion equation for a general multicomponent mixture under isothermal conditions and in the absence of body forces is given by\n$$\n\\nabla x_i = \\sum_{j=1, j \\neq i}^{N_s} \\frac{x_i \\mathbf{N}_j - x_j \\mathbf{N}_i}{c D_{ij}}\n$$\nwhere $x_i$ is the mole fraction of species $i$, $\\mathbf{N}_i$ is the molar diffusive flux of species $i$ relative to the molar-average velocity, $c$ is the total molar concentration, and $D_{ij}$ is the binary diffusion coefficient for the pair $i-j$.\n\nFor the binary mixture of $\\mathrm{H_2}$ (species $1$) and $\\mathrm{H_2O}$ (species $2$), the equation for species $1$ is:\n$$\n\\nabla x_1 = \\frac{x_1 \\mathbf{N}_2 - x_2 \\mathbf{N}_1}{c D_{12}}\n$$\nThe problem states that the diffusive fluxes are defined such that their sum is zero: $\\sum_{i=1}^{2} \\mathbf{N}_{i} = \\mathbf{0}$. This implies $\\mathbf{N}_2 = -\\mathbf{N}_1$. Substituting this relation into the Stefan-Maxwell equation yields:\n$$\n\\nabla x_1 = \\frac{x_1 (-\\mathbf{N}_1) - x_2 \\mathbf{N}_1}{c D_{12}} = \\frac{-\\mathbf{N}_1(x_1 + x_2)}{c D_{12}}\n$$\nFor a binary mixture, the sum of mole fractions is unity, $x_1 + x_2 = 1$. The equation simplifies to:\n$$\n\\nabla x_1 = -\\frac{\\mathbf{N}_1}{c D_{12}}\n$$\nThis is the Fickian form for diffusion in a binary mixture. Rearranging for the molar diffusive flux of $\\mathrm{H_2}$, $\\mathbf{N}_1$, we get:\n$$\n\\mathbf{N}_1 = -c D_{12} \\nabla x_1\n$$\nThe problem provides the ideal-gas relation for total molar concentration, $c = p/(RT)$, where $p$ is the pressure, $T$ is the temperature, and $R$ is the universal gas constant. Substituting this into the expression for $\\mathbf{N}_1$ gives the final form in terms of the specified variables:\n$$\n\\mathbf{N}_1 = -\\frac{p}{RT} D_{12}(p) \\nabla x_1\n$$\n\n**Part 2: Influence of the Pressure-Dependent Diffusion Coefficient**\n\nTo understand how the pressure dependence of $D_{12}$ affects the flux magnitude, we substitute the given scaling, $D_{12}(p) = D_{12, \\mathrm{ref}} \\, p_{\\mathrm{ref}}/p$, into the magnitude of the flux expression derived above:\n$$\n|\\mathbf{N}_1| = \\left| -\\frac{p}{RT} D_{12}(p) \\nabla x_1 \\right| = \\frac{p}{RT} \\left( D_{12, \\mathrm{ref}} \\frac{p_{\\mathrm{ref}}}{p} \\right) |\\nabla x_1|\n$$\nThe local pressure $p$ cancels out, leading to a remarkable result:\n$$\n|\\mathbf{N}_1| = \\frac{p_{\\mathrm{ref}} D_{12, \\mathrm{ref}}}{RT} |\\nabla x_1|\n$$\nThis demonstrates that for an isothermal ideal-gas mixture, the magnitude of the molar diffusive flux is independent of the local pressure. The product of molar concentration and diffusion coefficient, $c D_{12}$, is constant with respect to pressure:\n$$\nc D_{12} = \\left(\\frac{p}{RT}\\right) \\left(D_{12, \\mathrm{ref}} \\frac{p_{\\mathrm{ref}}}{p}\\right) = \\frac{p_{\\mathrm{ref}} D_{12, \\mathrm{ref}}}{RT} = \\text{constant}\n$$\nIn a converging nozzle, the pressure $p$ decreases significantly as the gas flows towards the throat. If one were to incorrectly assume that $D_{12}$ is a constant (e.g., $D_{12} = D_{12, \\mathrm{ref}}$), the flux magnitude model would be $|\\mathbf{N}_1|_{\\text{const } D} = \\frac{p}{RT} D_{12, \\mathrm{ref}} |\\nabla x_1|$. This incorrect model would predict that the flux magnitude is directly proportional to pressure and would therefore decrease substantially along the nozzle. The correct model, incorporating the $D_{12} \\propto 1/p$ dependence, reveals that the decrease in molar concentration $c$ due to falling pressure is exactly compensated by an increase in the diffusion coefficient $D_{12}$. Consequently, in regions of strong pressure gradient $\\nabla p$, the correct model predicts a nearly constant flux magnitude (assuming constant $T$ and $\\nabla x_1$), whereas the incorrect constant-$D_{12}$ model would predict a rapidly varying flux that follows the pressure profile.\n\n**Part 3: Computation of the Signed Relative Error**\n\nThe signed relative error $\\varepsilon$ is defined as:\n$$\n\\varepsilon \\equiv \\frac{|\\mathbf{N}_{1}|_{\\text{const } D} - |\\mathbf{N}_{1}|_{\\text{variable } D}}{|\\mathbf{N}_{1}|_{\\text{variable } D}}\n$$\nWe evaluate the two flux magnitudes at the throat, where the pressure is $p_t = 1.00 \\times 10^5 \\, \\mathrm{Pa}$ and the mole fraction gradient is $|\\nabla x_1| = 0.040 \\, \\mathrm{m}^{-1}$.\n\nThe correct flux magnitude, using the variable diffusion coefficient $D_{12}(p_t) = D_{12, \\mathrm{ref}} \\, p_{\\mathrm{ref}}/p_t$, is:\n$$\n|\\mathbf{N}_{1}|_{\\text{variable } D} = c(p_t) D_{12}(p_t) |\\nabla x_1| = \\left(\\frac{p_t}{RT}\\right) \\left(D_{12, \\mathrm{ref}} \\frac{p_{\\mathrm{ref}}}{p_t}\\right) |\\nabla x_1| = \\frac{p_{\\mathrm{ref}} D_{12, \\mathrm{ref}}}{RT} |\\nabla x_1|\n$$\nThe incorrect flux magnitude, assuming a constant diffusion coefficient $D_{12} = D_{12, \\mathrm{ref}}$, is:\n$$\n|\\mathbf{N}_{1}|_{\\text{const } D} = c(p_t) D_{12, \\mathrm{ref}} |\\nabla x_1| = \\frac{p_t}{RT} D_{12, \\mathrm{ref}} |\\nabla x_1|\n$$\nSubstituting these expressions into the definition of $\\varepsilon$:\n$$\n\\varepsilon = \\frac{\\frac{p_t}{RT} D_{12, \\mathrm{ref}} |\\nabla x_1| - \\frac{p_{\\mathrm{ref}} D_{12, \\mathrm{ref}}}{RT} |\\nabla x_1|}{\\frac{p_{\\mathrm{ref}} D_{12, \\mathrm{ref}}}{RT} |\\nabla x_1|}\n$$\nThe common factor $\\frac{D_{12, \\mathrm{ref}}}{RT} |\\nabla x_1|$ cancels from the numerator and denominator:\n$$\n\\varepsilon = \\frac{p_t - p_{\\mathrm{ref}}}{p_{\\mathrm{ref}}} = \\frac{p_t}{p_{\\mathrm{ref}}} - 1\n$$\nThis simplified expression shows that the relative error depends only on the ratio of the local pressure to the reference pressure at which the diffusion coefficient was defined. Using the given values:\n$p_t = 1.00 \\times 10^{5} \\, \\mathrm{Pa}$\n$p_{\\mathrm{ref}} = 5.00 \\times 10^{5} \\, \\mathrm{Pa}$\n\nThe numerical value of the error is:\n$$\n\\varepsilon = \\frac{1.00 \\times 10^{5}}{5.00 \\times 10^{5}} - 1 = 0.200 - 1 = -0.800\n$$\nThe assumption of a constant diffusion coefficient (evaluated at $p_{\\mathrm{ref}}$) leads to an underprediction of the diffusion flux magnitude by $80\\%$ at the throat pressure $p_t$. Expressing the final answer as a decimal number rounded to four significant figures gives $-0.8000$.",
            "answer": "$$\\boxed{-0.8000}$$"
        },
        {
            "introduction": "This capstone practice moves from analytical derivations to a full computational implementation for a realistic engineering scenario . You are tasked with modeling a high-pressure, multicomponent syngas mixture, which requires accounting for thermodynamic non-idealities through a thermodynamic factor matrix $\\Gamma$. This exercise will challenge you to construct and solve the complete Stefan-Maxwell linear system, developing a robust numerical algorithm capable of handling the complexities of multicomponent interactions and ensuring a physically meaningful solution.",
            "id": "4067788",
            "problem": "You are tasked with designing and implementing a computational procedure to calculate one-dimensional steady molar diffusive fluxes for a multicomponent syngas mixture at high pressure using the Stefan-Maxwell framework with non-ideal thermodynamic driving forces, and to compare these fluxes with those obtained under the ideal-gas assumption. Begin from a valid and fundamental base for multicomponent diffusion in computational combustion: the species-level momentum balance that underpins the Stefan-Maxwell (SM) relations, the Gibbs–Duhem identity for chemical potentials, and standard thermodynamic consistency constraints. Your procedure must enforce the no-net-molar-flow constraint and must clearly separate the roles of kinematic resistance (binary SM diffusivities) and thermodynamic driving forces (thermodynamic factor matrix). Avoid shortcut formulas in the problem statement; your implementation must follow from first principles and a derived algorithm.\n\nPhysical setting and assumptions: consider a one-dimensional, steady, isothermal, isobaric plane slab with species indexed by $i \\in \\{1,\\dots,n\\}$, where $n$ is the number of species in the syngas. Let $x_i$ denote the mole fraction of species $i$, let $D_{ij}$ denote the binary Stefan-Maxwell diffusivity between species $i$ and $j$ with $i \\neq j$, and let $N_i$ denote the molar diffusive flux of species $i$ expressed in $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$. Let $P$ denote the pressure in $\\mathrm{Pa}$, $T$ the temperature in $\\mathrm{K}$, $R$ the universal gas constant in $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, $Z$ the compressibility factor (from an Equation of State (EOS)), and $\\Gamma$ the thermodynamic factor matrix that maps the gradient of the mole fraction vector to the corrected driving forces. Use the species mole fraction gradient vector $g$ with components $g_i = \\mathrm{d}x_i/\\mathrm{d}z$ in $\\mathrm{m}^{-1}$, and enforce $\\sum_{i=1}^{n} x_i = 1$ and $\\sum_{i=1}^{n} g_i = 0$. The no-net-molar-flow constraint is $\\sum_{i=1}^{n} N_i = 0$. For the ideal-gas Stefan-Maxwell comparison, use $\\Gamma = I$ (the identity matrix) and $Z = 1$. For the non-ideal calculation, use the provided $Z$ and $\\Gamma$ values.\n\nDerivation targets and algorithm specification: starting from the multicomponent species momentum balance and the Gibbs–Duhem identity, derive how the Stefan-Maxwell kinematic resistance couples to thermodynamic driving forces to form a linear system for the flux vector $N$. Show how to construct the coefficient matrix from $\\{x_i\\}$ and $\\{D_{ij}\\}$, how to form the right-hand side from the corrected driving forces $-c\\,\\Gamma\\,g$ where $c$ is the molar concentration, and how to impose $\\sum_i N_i = 0$ to remove the null mode. Your final program must implement this derived algorithm to compute $N$ for both the non-ideal and ideal cases and then quantify the discrepancy using the relative $L^2$ error defined as $\\|N_{\\mathrm{nonideal}} - N_{\\mathrm{ideal}}\\|_2 / \\|N_{\\mathrm{ideal}}\\|_2$, which is dimensionless. The molar concentration for the non-ideal case is $c = P / (Z R T)$, and for the ideal case is $c_{\\mathrm{ideal}} = P / (R T)$.\n\nUnits and output requirements: compute fluxes $N_i$ in $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$. The error metric is dimensionless. Your program must produce a single line of output containing the error metrics for the provided test suite as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3]$, where each $r_k$ is a floating-point number.\n\nTest suite: implement three test cases that exercise typical syngas conditions, a hydrogen-rich boundary condition, and a carbon-dioxide-rich boundary condition. In each case, use the species set $\\{\\mathrm{H}_2,\\mathrm{CO},\\mathrm{CO}_2,\\mathrm{CH}_4,\\mathrm{N}_2\\}$, so $n = 5$. All binary Stefan-Maxwell diffusivities $D_{ij}$ are in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$ and symmetric in $i,j$, with $D_{ii}$ unused. All gradients $g_i$ are in $\\mathrm{m}^{-1}$. All pressures $P$ are in $\\mathrm{Pa}$, all temperatures $T$ are in $\\mathrm{K}$, and all compressibility factors $Z$ are dimensionless.\n\n- Test case $1$ (typical syngas, high pressure):\n  - Mole fractions $x = [0.35, 0.40, 0.10, 0.05, 0.10]$.\n  - Gradient $g = [-0.20, 0.12, 0.04, 0.02, 0.02]$.\n  - Pressure $P = 3.0 \\times 10^{6}\\ \\mathrm{Pa}$.\n  - Temperature $T = 900\\ \\mathrm{K}$.\n  - Compressibility factor $Z = 0.92$.\n  - Binary diffusivity matrix $D$ off-diagonal entries (symmetric):\n    - $D_{\\mathrm{H}_2,\\mathrm{CO}} = 1.8 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CO}_2} = 1.5 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CH}_4} = 2.2 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{N}_2} = 1.9 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CO}_2} = 0.9 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CH}_4} = 1.1 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{N}_2} = 1.0 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{CH}_4} = 0.8 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{N}_2} = 0.7 \\times 10^{-5}$,\n      $D_{\\mathrm{CH}_4,\\mathrm{N}_2} = 1.0 \\times 10^{-5}$.\n  - Thermodynamic factor matrix $\\Gamma$ entries:\n    - $\\Gamma = \\begin{bmatrix}\n      1.12  -0.01  -0.02  -0.01  -0.08 \\\\\n      -0.02  1.08  0.01  -0.01  -0.06 \\\\\n      -0.01  0.01  1.18  -0.02  -0.16 \\\\\n      -0.01  -0.02  -0.03  1.10  -0.04 \\\\\n      -0.08  -0.03  -0.09  -0.03  1.25\n    \\end{bmatrix}$.\n\n- Test case $2$ (hydrogen-rich, higher pressure):\n  - Mole fractions $x = [0.70, 0.15, 0.05, 0.05, 0.05]$.\n  - Gradient $g = [-0.25, 0.15, 0.05, 0.03, 0.02]$.\n  - Pressure $P = 5.0 \\times 10^{6}\\ \\mathrm{Pa}$.\n  - Temperature $T = 1000\\ \\mathrm{K}$.\n  - Compressibility factor $Z = 0.88$.\n  - Binary diffusivity matrix $D$ off-diagonal entries (symmetric):\n    - $D_{\\mathrm{H}_2,\\mathrm{CO}} = 1.3 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CO}_2} = 1.1 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CH}_4} = 1.6 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{N}_2} = 1.4 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CO}_2} = 0.65 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CH}_4} = 0.80 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{N}_2} = 0.75 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{CH}_4} = 0.60 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{N}_2} = 0.55 \\times 10^{-5}$,\n      $D_{\\mathrm{CH}_4,\\mathrm{N}_2} = 0.75 \\times 10^{-5}$.\n  - Thermodynamic factor matrix $\\Gamma$ entries:\n    - $\\Gamma = \\begin{bmatrix}\n      1.20  -0.02  -0.03  -0.01  -0.14 \\\\\n      -0.03  1.12  0.02  -0.01  -0.10 \\\\\n      -0.02  0.02  1.22  -0.03  -0.19 \\\\\n      -0.01  -0.02  -0.03  1.15  -0.08 \\\\\n      -0.14  -0.07  -0.12  -0.05  1.30\n    \\end{bmatrix}$.\n\n- Test case $3$ (carbon-dioxide-rich, very high pressure):\n  - Mole fractions $x = [0.10, 0.30, 0.40, 0.10, 0.10]$.\n  - Gradient $g = [-0.05, -0.05, 0.08, 0.01, 0.01]$.\n  - Pressure $P = 8.0 \\times 10^{6}\\ \\mathrm{Pa}$.\n  - Temperature $T = 1200\\ \\mathrm{K}$.\n  - Compressibility factor $Z = 0.85$.\n  - Binary diffusivity matrix $D$ off-diagonal entries (symmetric):\n    - $D_{\\mathrm{H}_2,\\mathrm{CO}} = 0.9 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CO}_2} = 0.8 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{CH}_4} = 1.2 \\times 10^{-5}$,\n      $D_{\\mathrm{H}_2,\\mathrm{N}_2} = 1.0 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CO}_2} = 0.50 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{CH}_4} = 0.70 \\times 10^{-5}$,\n      $D_{\\mathrm{CO},\\mathrm{N}_2} = 0.65 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{CH}_4} = 0.45 \\times 10^{-5}$,\n      $D_{\\mathrm{CO}_2,\\mathrm{N}_2} = 0.40 \\times 10^{-5}$,\n      $D_{\\mathrm{CH}_4,\\mathrm{N}_2} = 0.60 \\times 10^{-5}$.\n  - Thermodynamic factor matrix $\\Gamma$ entries:\n    - $\\Gamma = \\begin{bmatrix}\n      1.26  -0.03  -0.04  -0.02  -0.17 \\\\\n      -0.04  1.15  0.03  -0.02  -0.12 \\\\\n      -0.03  0.03  1.30  -0.04  -0.22 \\\\\n      -0.02  -0.03  -0.04  1.18  -0.09 \\\\\n      -0.17  -0.09  -0.15  -0.06  1.35\n    \\end{bmatrix}$.\n\nAnswer specification: For each of the three test cases, compute $N_{\\mathrm{ideal}}$ and $N_{\\mathrm{nonideal}}$, then compute the relative $L^2$ error $r = \\|N_{\\mathrm{nonideal}} - N_{\\mathrm{ideal}}\\|_2 / \\|N_{\\mathrm{ideal}}\\|_2$ as a floating-point number. Your program should produce a single line of output containing the three errors as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3]$, with each $r_k$ expressed as a decimal number.",
            "solution": "The problem is subjected to validation against the established criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Species**: A 1D, steady, isothermal, isobaric system with $n=5$ species, indexed $i \\in \\{1,\\dots,5\\}$ corresponding to $\\{\\mathrm{H}_2,\\mathrm{CO},\\mathrm{CO}_2,\\mathrm{CH}_4,\\mathrm{N}_2\\}$.\n- **Variables**: $x_i$ (mole fraction), $D_{ij}$ (binary Stefan-Maxwell diffusivity, $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$), $N_i$ (molar diffusive flux, $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$), $P$ (pressure, Pa), $T$ (temperature, K), $R$ (universal gas constant, $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$), $Z$ (compressibility factor), $\\Gamma$ (thermodynamic factor matrix), $g$ (mole fraction gradient vector, $\\mathrm{m}^{-1}$), $c$ (molar concentration, $\\mathrm{mol}\\,\\mathrm{m}^{-3}$).\n- **Constraints and Definitions**:\n  - $\\sum_{i=1}^{n} x_i = 1$\n  - $\\sum_{i=1}^{n} g_i = 0$\n  - $\\sum_{i=1}^{n} N_i = 0$ (no-net-molar-flow)\n  - $D_{ij}$ is symmetric ($D_{ij}=D_{ji}$), $D_{ii}$ is unused.\n  - Non-ideal concentration: $c = P / (Z R T)$\n  - Ideal concentration: $c_{\\mathrm{ideal}} = P / (R T)$\n  - Ideal case assumptions: $\\Gamma = I$ (identity matrix), $Z = 1$.\n- **Derivation Goal**: Derive a linear system for the flux vector $N$ from multicomponent species momentum balance and the Gibbs-Duhem identity, then implement an algorithm to solve it.\n- **Output Metric**: Relative $L^2$ error: $\\|N_{\\mathrm{nonideal}} - N_{\\mathrm{ideal}}\\|_2 / \\|N_{\\mathrm{ideal}}\\|_2$.\n- **Test Cases**: Three complete test cases are provided, each specifying values for $x$, $g$, $P$, $T$, $Z$, the off-diagonal elements of $D$, and the full matrix $\\Gamma$. The constraints $\\sum x_i = 1$ and $\\sum g_i = 0$ are verified to hold for all three cases.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is scientifically grounded, well-posed, and objective. It is based on the fundamental Stefan-Maxwell equations for multicomponent diffusion, a cornerstone of transport phenomena. The inclusion of thermodynamic non-idealities through a compressibility factor $Z$ and a thermodynamic factor matrix $\\Gamma$ is a standard, advanced treatment for high-pressure systems. The problem is formalizable and directly relevant to computational combustion. All necessary data are provided, and the constraints are internally consistent. The physical values are realistic for the specified conditions.\n\nA critical point of validation concerns the thermodynamic consistency of the provided data, specifically the thermodynamic factor matrix $\\Gamma$. The Gibbs-Duhem equation, a fundamental thermodynamic law, imposes a constraint on the chemical potentials $\\mu_i$: $\\sum_{i=1}^n x_i \\mathrm{d}\\mu_i = 0$ at constant $T$ and $P$. The chemical potential gradient is related to the mole fraction gradient via the matrix $\\Gamma$: $\\nabla \\mu_i = (RT/x_i) \\sum_j \\Gamma_{ij} \\nabla x_j$. Applying the Gibbs-Duhem relation leads to the constraint $\\sum_j \\left(\\sum_i \\Gamma_{ij}\\right) g_j = 0$ for any valid gradient vector $g$ (where $\\sum_j g_j = 0$). This can only be true if the column sums of $\\Gamma$ are all equal to a constant, i.e., $\\sum_i \\Gamma_{ij} = C$ for all $j$.\n\nLet us examine the provided $\\Gamma$ matrices:\n- **Test Case 1**: Column sums are $[1.00, 1.03, 1.05, 1.03, 0.91]$. These are not equal. This matrix is thermodynamically inconsistent and violates the Gibbs-Duhem equation.\n- **Test Case 2**: Column sums are $[1.00, 1.00, 1.01, 1.00, 1.00]$. These are nearly equal, suggesting possible rounding in the problem statement.\n- **Test Case 3**: Column sums are $[1.00, 1.00, 1.00, 1.00, 1.00]$. This matrix is thermodynamically consistent.\n\nThe inconsistency in Test Case 1 means that the driving forces derived from it will not sum to zero in the manner required by fundamental physics. A numerical procedure must be robust enough to handle such data, which can arise in practical computations due to modeling or data-fitting errors. The problem remains valid as a computational task, provided a suitable robust algorithm is derived and implemented. The existence of inconsistent data does not render the problem invalid but rather imposes a stricter requirement on the solution methodology.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. The core task is to derive and implement a robust numerical algorithm for solving the Stefan-Maxwell equations. The inconsistency in one of the test cases is a feature that a robust algorithm must handle, and the derivation must justify the choice of such an algorithm.\n\n### Derivation and Solution Methodology\n\nThe Stefan-Maxwell equations arise from a momentum balance on each species, equating the driving force on species $i$ to the frictional drag from all other species $j$. For a one-dimensional system, the equations are:\n$$\n\\frac{x_i}{RT} \\frac{\\mathrm{d}\\mu_i}{\\mathrm{d}z} = \\sum_{j=1, j\\neq i}^n \\frac{x_j N_i - x_i N_j}{c D_{ij}}\n$$\nwhere $\\mathrm{d}\\mu_i/\\mathrm{d}z$ is the gradient of the chemical potential of species $i$, which constitutes the driving force for diffusion.\n\nFor non-ideal mixtures, the chemical potential gradient is related to the mole fraction gradients $g_j = \\mathrm{d}x_j/\\mathrm{d}z$ via the thermodynamic factor matrix $\\Gamma$:\n$$\n\\frac{x_i}{RT} \\frac{\\mathrm{d}\\mu_i}{\\mathrm{d}z} = \\sum_{j=1}^n \\Gamma_{ij} g_j\n$$\nSubstituting this into the Stefan-Maxwell equation yields:\n$$\n\\sum_{j=1}^n \\Gamma_{ij} g_j = \\sum_{j=1, j\\neq i}^n \\frac{x_j N_i - x_i N_j}{c D_{ij}}\n$$\nLet us define a vector of generalized driving forces $F_k = -c \\sum_{j=1}^n \\Gamma_{kj} g_j$. The negative sign is conventional, indicating that flux occurs down a gradient. In vector form, $F = -c\\Gamma g$. Rearranging the Stefan-Maxwell equation for species $i$:\n$$\n-F_i = \\sum_{j=1, j\\neq i}^n \\left( \\frac{x_j}{D_{ij}} N_i - \\frac{x_i}{D_{ij}} N_j \\right) = N_i \\left( \\sum_{j=1, j\\neq i}^n \\frac{x_j}{D_{ij}} \\right) - \\sum_{j=1, j\\neq i}^n \\frac{x_i}{D_{ij}} N_j\n$$\nThis can be written as a linear system of $n$ equations for the $n$ unknown fluxes $N_i$:\n$$\n[B]\\{N\\} = \\{F\\}\n$$\nwhere $\\{N\\}$ is the column vector of fluxes, $\\{F\\}$ is the column vector of driving forces, and $[B]$ is an $n \\times n$ matrix with elements:\n$$\nB_{ii} = \\sum_{k=1, k\\neq i}^n \\frac{x_k}{D_{ik}}\n$$\n$$\nB_{ij} = -\\frac{x_i}{D_{ij}} \\quad \\text{for } i \\neq j\n$$\nThis system of equations is singular. The matrix $[B]$ has a null space spanned by the mole fraction vector $\\{x\\}$, i.e., $[B]\\{x\\} = \\{0\\}$. This can be verified by substitution:\n$$\n([B]\\{x\\})_i = \\sum_{j=1}^n B_{ij} x_j = B_{ii}x_i + \\sum_{j=1, j\\neq i}^n B_{ij} x_j = \\left(\\sum_{k=1, k\\neq i}^n \\frac{x_k}{D_{ik}}\\right) x_i - \\sum_{j=1, j\\neq i}^n \\frac{x_i}{D_{ij}} x_j = 0\n$$\nA singular system $[B]\\{N\\} = \\{F\\}$ has solutions only if the right-hand side $\\{F\\}$ is orthogonal to the left null space of $[B]$. The left null vector of $[B]$ is $\\{u\\} = [1, 1, \\dots, 1]^T$, which can be shown as a consequence of the Gibbs-Duhem equation. This implies a solvability condition: $\\sum_{i=1}^n F_i = 0$. As discussed during validation, this condition is not met for Test Case 1 due to the properties of its $\\Gamma$ matrix.\n\nTo obtain a unique solution and handle potential inconsistencies, we must incorporate the no-net-molar-flow constraint, $\\sum_{i=1}^n N_i = 0$. This gives an overdetermined system of $n+1$ equations for $n$ unknowns:\n$$\n\\begin{cases}\n[B]\\{N\\} = \\{F\\} \\\\\n\\mathbf{1}^T \\{N\\} = 0\n\\end{cases}\n$$\nwhere $\\mathbf{1}^T$ is a row vector of ones. This system can be written as $[A]\\{N\\} = \\{b\\}$, where $[A]$ is an $(n+1) \\times n$ matrix and $\\{b\\}$ is an $(n+1) \\times 1$ vector:\n$$\n[A] = \\begin{bmatrix} B \\\\ \\mathbf{1}^T \\end{bmatrix}, \\quad \\{b\\} = \\begin{bmatrix} F \\\\ 0 \\end{bmatrix}\n$$\nThe most robust method for solving such a system, especially when the original equations $[B]\\{N\\} = \\{F\\}$ may be inconsistent, is the method of least squares. This method finds the vector $\\{N\\}$ that minimizes the Euclidean norm of the residual, $\\|[A]\\{N\\} - \\{b\\}\\|_2$. The solution to this least-squares problem is given by the normal equations:\n$$\n([A]^T [A]) \\{N\\} = [A]^T \\{b\\}\n$$\nLet's compute the terms:\n$$\n[A]^T [A] = \\begin{bmatrix} B^T  \\mathbf{1} \\end{bmatrix} \\begin{bmatrix} B \\\\ \\mathbf{1}^T \\end{bmatrix} = [B]^T[B] + \\mathbf{1}\\mathbf{1}^T\n$$\n$$\n[A]^T \\{b\\} = \\begin{bmatrix} B^T  \\mathbf{1} \\end{bmatrix} \\begin{bmatrix} F \\\\ 0 \\end{bmatrix} = [B]^T\\{F\\}\n$$\nThis gives the final, well-posed $n \\times n$ linear system to be solved for the fluxes $\\{N\\}$:\n$$\n([B]^T[B] + \\mathbf{1}\\mathbf{1}^T) \\{N\\} = [B]^T \\{F\\}\n$$\nThe matrix $([B]^T[B] + \\mathbf{1}\\mathbf{1}^T)$ is invertible, thus guaranteeing a unique solution. This method correctly determines the fluxes for thermodynamically consistent data and provides a physically meaningful \"best fit\" solution for inconsistent data by finding a flux vector that sums to zero while minimally violating the Stefan-Maxwell relations.\n\n**Algorithmic Procedure:**\n1.  For a given test case (non-ideal or ideal), obtain the inputs: $\\{x_i\\}$, $\\{g_i\\}$, $P$, $T$, $Z$, $[D_{ij}]$, $[\\Gamma_{ij}]$, and $R$. For the ideal case, set $Z=1$ and $\\Gamma=I$.\n2.  Calculate the molar concentration: $c = P / (Z R T)$.\n3.  Construct the $n \\times n$ matrix $[B]$ using the mole fractions $\\{x_i\\}$ and diffusivities $[D_{ij}]$.\n4.  Calculate the $n \\times 1$ driving force vector $\\{F\\} = -c[\\Gamma]\\{g\\}$.\n5.  Construct the matrix for the normal equations: $[C] = [B]^T[B] + \\mathbf{1}\\mathbf{1}^T$, where $\\mathbf{1}\\mathbf{1}^T$ is an $n \\times n$ matrix of ones.\n6.  Construct the right-hand side vector for the normal equations: $\\{h\\} = [B]^T\\{F\\}$.\n7.  Solve the linear system $[C]\\{N\\} = \\{h\\}$ to find the molar diffusive flux vector $\\{N\\}$.\n8.  After computing $\\{N_{\\mathrm{nonideal}}\\}$ and $\\{N_{\\mathrm{ideal}}\\}$, calculate the relative error: $r = \\|N_{\\mathrm{nonideal}} - N_{\\mathrm{ideal}}\\|_2 / \\|N_{\\mathrm{ideal}}\\|_2$.\n\nThis procedure is implemented for each of the three test cases specified.",
            "answer": "```python\nimport numpy as np\n\ndef solve_fluxes(x, g, D, P, T, Z, Gamma, R):\n    \"\"\"\n    Solves for the molar diffusive fluxes using the Stefan-Maxwell equations.\n\n    This function implements a robust least-squares method to solve the\n    overdetermined system comprising the n Stefan-Maxwell equations and the\n    no-net-molar-flow constraint.\n\n    Args:\n        x (np.ndarray): Mole fraction vector.\n        g (np.ndarray): Mole fraction gradient vector.\n        D (np.ndarray): Matrix of binary Maxwell-Stefan diffusivities.\n        P (float): Pressure in Pa.\n        T (float): Temperature in K.\n        Z (float): Compressibility factor.\n        Gamma (np.ndarray): Thermodynamic factor matrix.\n        R (float): Universal gas constant.\n\n    Returns:\n        np.ndarray: The molar diffusive flux vector N.\n    \"\"\"\n    n = len(x)\n\n    # 1. Calculate molar concentration\n    c = P / (Z * R * T)\n\n    # 2. Construct the B matrix\n    B = np.zeros((n, n))\n    for i in range(n):\n        sum_term = 0\n        for k in range(n):\n            if i == k:\n                continue\n            sum_term += x[k] / D[i, k]\n        B[i, i] = sum_term\n\n        for j in range(n):\n            if i == j:\n                continue\n            B[i, j] = -x[i] / D[i, j]\n\n    # 3. Calculate driving force vector F = -c*Gamma*g\n    F = -c * (Gamma @ g)\n\n    # 4. Formulate and solve the normal equations for the least-squares problem\n    # System: (B^T*B + 11^T) * N = B^T * F\n    C = (B.T @ B) + np.ones((n, n))\n    h = B.T @ F\n    \n    # 5. Solve the linear system C * N = h for N\n    N = np.linalg.solve(C, h)\n\n    return N\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and compute the relative errors.\n    \"\"\"\n    # Universal gas constant in J/(mol K)\n    R = 8.314462618\n\n    # Species indexing: 0:H2, 1:CO, 2:CO2, 3:CH4, 4:N2\n    \n    # Test cases data structure:\n    # (x, g, P, T, Z, D_values, Gamma)\n    # D_values are the 10 off-diagonal elements in the specified order.\n    test_cases = [\n        # Test case 1\n        (\n            np.array([0.35, 0.40, 0.10, 0.05, 0.10]),\n            np.array([-0.20, 0.12, 0.04, 0.02, 0.02]),\n            3.0e6, 900.0, 0.92,\n            [1.8e-5, 1.5e-5, 2.2e-5, 1.9e-5, 0.9e-5, 1.1e-5, 1.0e-5, 0.8e-5, 0.7e-5, 1.0e-5],\n            np.array([\n                [1.12, -0.01, -0.02, -0.01, -0.08],\n                [-0.02, 1.08, 0.01, -0.01, -0.06],\n                [-0.01, 0.01, 1.18, -0.02, -0.16],\n                [-0.01, -0.02, -0.03, 1.10, -0.04],\n                [-0.08, -0.03, -0.09, -0.03, 1.25]\n            ])\n        ),\n        # Test case 2\n        (\n            np.array([0.70, 0.15, 0.05, 0.05, 0.05]),\n            np.array([-0.25, 0.15, 0.05, 0.03, 0.02]),\n            5.0e6, 1000.0, 0.88,\n            [1.3e-5, 1.1e-5, 1.6e-5, 1.4e-5, 0.65e-5, 0.80e-5, 0.75e-5, 0.60e-5, 0.55e-5, 0.75e-5],\n            np.array([\n                [1.20, -0.02, -0.03, -0.01, -0.14],\n                [-0.03, 1.12, 0.02, -0.01, -0.10],\n                [-0.02, 0.02, 1.22, -0.03, -0.19],\n                [-0.01, -0.02, -0.03, 1.15, -0.08],\n                [-0.14, -0.07, -0.12, -0.05, 1.30]\n            ])\n        ),\n        # Test case 3\n        (\n            np.array([0.10, 0.30, 0.40, 0.10, 0.10]),\n            np.array([-0.05, -0.05, 0.08, 0.01, 0.01]),\n            8.0e6, 1200.0, 0.85,\n            [0.9e-5, 0.8e-5, 1.2e-5, 1.0e-5, 0.50e-5, 0.70e-5, 0.65e-5, 0.45e-5, 0.40e-5, 0.60e-5],\n            np.array([\n                [1.26, -0.03, -0.04, -0.02, -0.17],\n                [-0.04, 1.15, 0.03, -0.02, -0.12],\n                [-0.03, 0.03, 1.30, -0.04, -0.22],\n                [-0.02, -0.03, -0.04, 1.18, -0.09],\n                [-0.17, -0.09, -0.15, -0.06, 1.35]\n            ])\n        )\n    ]\n\n    results = []\n    n_species = 5\n\n    for case in test_cases:\n        x, g, P, T, Z, D_values, Gamma = case\n        \n        # Build the symmetric diffusivity matrix D\n        D = np.zeros((n_species, n_species))\n        indices = [(0, 1), (0, 2), (0, 3), (0, 4), (1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)]\n        for (i, j), val in zip(indices, D_values):\n            D[i, j] = D[j, i] = val\n\n        # Calculate non-ideal fluxes\n        N_nonideal = solve_fluxes(x, g, D, P, T, Z, Gamma, R)\n\n        # Calculate ideal fluxes (Z=1, Gamma=I)\n        Z_ideal = 1.0\n        Gamma_ideal = np.identity(n_species)\n        N_ideal = solve_fluxes(x, g, D, P, T, Z_ideal, Gamma_ideal, R)\n\n        # Compute relative L2 error\n        error_norm = np.linalg.norm(N_nonideal - N_ideal)\n        ideal_norm = np.linalg.norm(N_ideal)\n        \n        if ideal_norm == 0:\n            relative_error = 0.0 # Or handle as an undefined case if appropriate\n        else:\n            relative_error = error_norm / ideal_norm\n            \n        results.append(relative_error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}