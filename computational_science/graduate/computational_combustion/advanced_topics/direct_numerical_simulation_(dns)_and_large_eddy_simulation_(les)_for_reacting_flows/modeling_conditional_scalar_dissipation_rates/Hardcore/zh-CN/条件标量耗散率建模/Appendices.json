{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习将提供一个基础的动手实践，即直接从给定的标量场计算标量耗散率。你将通过数值方法验证一个基本的平衡方程，该方程将空间平均的标量耗散率与标量方差的衰减率联系起来。这项实践对于建立关于标量耗散率物理意义的直觉，以及培养分析湍流中标量混合所需的核心计算技能至关重要。",
            "id": "4041978",
            "problem": "给定一个三维周期性域，其中被动标量场 $ \\phi(\\mathbf{x}, t) $ 根据一个只有扩散的模型演化，其分子扩散系数 $ D_\\phi $ 为常数。标量输运方程是无平流、无源项的扩散方程。标量耗散率基于脉动场 $ \\phi'(\\mathbf{x}, t) $ 建模，其定义为与瞬时空间平均值的偏差。您的任务是计算空间平均的标量耗散率，从时间序列数据中估计标量方差的衰减率，并通过对标量场值进行分箱来检验条件公式。\n\n使用的基本原理：\n- 具有恒定扩散系数的被动标量的扩散方程：在周期性边界条件且无源项的情况下，标量的时间变化率取决于标量的拉普拉斯算子。\n- 脉动场为 $ \\phi'(\\mathbf{x}, t) = \\phi(\\mathbf{x}, t) - \\langle \\phi(\\cdot, t) \\rangle $，其中 $ \\langle \\cdot \\rangle $ 表示在固定时间对整个域进行空间平均。\n- 与脉动相关的标量耗散率定义为 $ \\chi_\\phi(\\mathbf{x}, t) = 2 D_\\phi \\left\\|\\nabla \\phi'(\\mathbf{x}, t)\\right\\|^2 $。\n- 给定标量值的条件标量耗散率是条件期望 $ \\langle \\chi_\\phi \\mid \\phi' \\in \\mathcal{B}_i \\rangle $，其中 $ \\mathcal{B}_i $ 是 $ \\phi' $ 值域中的一个分箱，无条件平均值通过对条件期望关于 $ \\phi' $ 的概率密度（离散化为分箱上的概率质量）进行积分来恢复。\n\n计算要求：\n- 在所有三个方向上使用具有周期性边界条件的均匀笛卡尔网格。\n- 使用带周期性环绕的中心有限差分来近似空间梯度。\n- 对方差时间序列使用时间上的中心差分来估计中间时刻的瞬时衰减率。\n- 对于条件建模，将中间时刻 $ \\phi'(\\mathbf{x}, t) $ 的范围划分为 $ 8 $ 个等宽分箱，并计算 $ \\chi_\\phi $ 的条件平均值，然后计算这些条件平均值的概率加权积分（离散和）。\n\n单位和报告：\n- 扩散系数 $ D_\\phi $ 的单位是 $ \\mathrm{m}^2/\\mathrm{s} $，距离单位是 $ \\mathrm{m} $，时间单位是 $ \\mathrm{s} $。标量耗散率 $ \\chi_\\phi $ 及其空间平均的单位是 $ \\mathrm{s}^{-1} $。\n- 您的输出必须以 $ \\mathrm{s}^{-1} $ 为单位报告。\n- 程序必须生成单行输出，格式为逗号分隔的类Python列表，其中每个测试用例对应一个子列表。每个子列表必须按以下顺序包含五个浮点数：中间时刻的空间平均耗散率、根据时间序列在中间时刻估计的方差衰减率、这两个量之间的绝对差、条件积分估计值（条件耗散的概率加权积分），以及条件积分估计值与无条件平均值之间的绝对差。最终输出必须是形如 $ [ [r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}, r_{1,5}], [r_{2,1}, \\dots], \\dots ] $ 的单行字符串，不含空格。\n\n测试套件和域/模型规范：\n对于每个案例，定义一个长度为 $ (L_x, L_y, L_z) $ 的周期性域，由 $ (N_x, N_y, N_z) $ 个网格点离散化，一个恒定的扩散系数 $ D_\\phi $，一个时间步长 $ \\Delta t $，以及一个由余弦模态之和加一个偏移量构成的标量场。每个余弦模态的形式为 $ A \\cos(\\mathbf{k} \\cdot \\mathbf{x}) $，其中 $ \\mathbf{k} = \\left( \\frac{2\\pi n_x}{L_x}, \\frac{2\\pi n_y}{L_y}, \\frac{2\\pi n_z}{L_z} \\right) $，并在扩散作用下演化，使得在时间 $ t $ 时每个模态的振幅乘以 $ \\exp\\left( - D_\\phi \\|\\mathbf{k}\\|^2 t \\right) $。偏移量是一个加到场上的常数，在扩散作用下不会衰减。对于每个案例，使用此演化定律在时间 $ t = 0 $、$ t = \\Delta t $ 和 $ t = 2 \\Delta t $ 构造标量场 $ \\phi(\\mathbf{x}, t) $。计算在 $ t = \\Delta t $ 时的空间平均耗散，并使用应用于三个时间层级的中心时间差分来估计在 $ t = \\Delta t $ 时标量方差的衰减率。\n\n提供以下四个测试用例：\n- 案例 $ 1 $ (单波数分量)：\n  - 域长度：$ (L_x, L_y, L_z) = (1.0, 1.0, 1.0) $ $ \\mathrm{m} $。\n  - 网格点数：$ (N_x, N_y, N_z) = (32, 32, 32) $。\n  - 扩散系数：$ D_\\phi = 1.0 \\times 10^{-4} $ $ \\mathrm{m}^2/\\mathrm{s} $。\n  - 时间步长：$ \\Delta t = 0.05 $ $ \\mathrm{s} $。\n  - 偏移量：$ 0.0 $。\n  - 模态：$ A = 1.0 $，$ (n_x, n_y, n_z) \\in \\{ (1, 0, 0), (0, 1, 0), (0, 0, 1) \\} $。\n- 案例 $ 2 $ (具有非零均值的多波数分量)：\n  - 域长度：$ (L_x, L_y, L_z) = (2.0, 2.0, 2.0) $ $ \\mathrm{m} $。\n  - 网格点数：$ (N_x, N_y, N_z) = (40, 40, 40) $。\n  - 扩散系数：$ D_\\phi = 5.0 \\times 10^{-4} $ $ \\mathrm{m}^2/\\mathrm{s} $。\n  - 时间步长：$ \\Delta t = 0.02 $ $ \\mathrm{s} $。\n  - 偏移量：$ 0.5 $。\n  - 模态：$ (A, n_x, n_y, n_z) \\in \\{ (0.7, 1, 2, 0), (0.3, 0, 1, 3) \\} $。\n- 案例 $ 3 $ (均匀场)：\n  - 域长度：$ (L_x, L_y, L_z) = (1.0, 1.0, 1.0) $ $ \\mathrm{m} $。\n  - 网格点数：$ (N_x, N_y, N_z) = (16, 16, 16) $。\n  - 扩散系数：$ D_\\phi = 1.0 \\times 10^{-3} $ $ \\mathrm{m}^2/\\mathrm{s} $。\n  - 时间步长：$ \\Delta t = 0.1 $ $ \\mathrm{s} $。\n  - 偏移量：$ 2.0 $。\n  - 模态：无。\n- 案例 $ 4 $ (各向异性域和混合模态)：\n  - 域长度：$ (L_x, L_y, L_z) = (1.0, 1.5, 0.5) $ $ \\mathrm{m} $。\n  - 网格点数：$ (N_x, N_y, N_z) = (24, 36, 12) $。\n  - 扩散系数：$ D_\\phi = 2.0 \\times 10^{-4} $ $ \\mathrm{m}^2/\\mathrm{s} $。\n  - 时间步长：$ \\Delta t = 0.03 $ $ \\mathrm{s} $。\n  - 偏移量：$ 0.1 $。\n  - 模态：$ (A, n_x, n_y, n_z) \\in \\{ (0.8, 2, 1, 0), (0.5, 0, 3, 2) \\} $。\n\n为每个案例实现的算法步骤：\n- 使用上述模态演化在指定网格上构造时间 $ t = 0 $、$ t = \\Delta t $、$ t = 2 \\Delta t $ 的标量场 $ \\phi(\\mathbf{x}, t) $。\n- 通过减去 $ t = \\Delta t $ 时的空间平均值来计算脉动场 $ \\phi'(\\mathbf{x}, \\Delta t) $。\n- 使用带周期性环绕的中心有限差分和网格间距 $ \\Delta x = L_x/N_x $、$ \\Delta y = L_y/N_y $、$ \\Delta z = L_z/N_z $ 来近似 $ \\nabla \\phi'(\\mathbf{x}, \\Delta t) $。\n- 计算逐点的 $ \\chi_\\phi(\\mathbf{x}, \\Delta t) = 2 D_\\phi \\left( \\left( \\partial \\phi'/\\partial x \\right)^2 + \\left( \\partial \\phi'/\\partial y \\right)^2 + \\left( \\partial \\phi'/\\partial z \\right)^2 \\right) $，然后通过在网格上求平均来计算空间平均值 $ \\langle \\chi_\\phi \\rangle $。\n- 计算在 $ t = 0 $、$ t = \\Delta t $ 和 $ t = 2 \\Delta t $ 时的标量方差 $ \\langle \\phi'^2 \\rangle(t) $，然后使用中心差分 $ - \\left( \\langle \\phi'^2 \\rangle(2\\Delta t) - \\langle \\phi'^2 \\rangle(0) \\right) / (2 \\Delta t) $ 来估计在 $ t = \\Delta t $ 时的瞬时衰减率。\n- 构建 $ 8 $ 个等宽分箱，覆盖 $ [ \\min \\phi'(\\mathbf{x}, \\Delta t), \\max \\phi'(\\mathbf{x}, \\Delta t) ] $ 的范围。对于每个分箱 $ \\mathcal{B}_i $，计算条件平均值 $ \\langle \\chi_\\phi \\mid \\phi' \\in \\mathcal{B}_i \\rangle $ 和分箱概率 $ p_i $。形成概率加权积分（离散和） $ \\sum_i p_i \\langle \\chi_\\phi \\mid \\phi' \\in \\mathcal{B}_i \\rangle $，并报告它及其与无条件平均值的绝对差。\n- 将所有报告的速率以 $ \\mathrm{s}^{-1} $ 为单位表示为浮点数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个包含五个浮点数的子列表，顺序如上所述。例如，输出应类似于 $ [[r_{1,1},r_{1,2},r_{1,3},r_{1,4},r_{1,5}],[r_{2,1},r_{2,2},r_{2,3},r_{2,4},r_{2,5}],\\dots] $，不含空格。",
            "solution": "用户希望解决一个计算物理问题，该问题涉及三维周期性域中被动标量的扩散。该问题需要实现输运现象和数据分析中的几个数值和解析概念。\n\n### I. 问题验证\n\n问题陈述已根据指定标准进行评估，并确定为**有效**。\n\n1.  **科学基础**：该问题基于基本的热/扩散方程 $ \\partial_t \\phi = D_\\phi \\nabla^2 \\phi $，这是输运现象的基石。诸如标量脉动场 $ \\phi' $、标量耗散率 $ \\chi_\\phi $ 以及标量方差衰减与平均耗散率之间的关系 $ d\\langle \\phi'^2 \\rangle/dt = -\\langle \\chi_\\phi \\rangle $ 等关键概念在此框架内是标准且正确的。使用傅里叶级数表示初始标量场及其解析时间演化是处理周期性域问题的可靠且标准的方法。\n\n2.  **适定性与完整性**：该问题是适定的。初始条件由解析函数（余弦函数之和）给出，具有周期性边界条件的偏微分控制方程具有唯一、稳定的解。四个测试用例的所有必要参数——域几何形状、网格分辨率、物理常数（$D_\\phi$）、时间步长（$ \\Delta t $）和场分量（模态和偏移量）——都已明确提供。空间和时间导数以及条件平均的数值方法也已明确定义。该问题是自洽的，没有矛盾之处。\n\n3.  **客观性与可行性**：该问题以精确、客观的数学语言陈述。任务是算法性的，不允许主观解释。计算负荷（最大网格为 $40 \\times 40 \\times 40$）在标准科学计算环境的能力范围之内，不存在任何可行性问题。\n\n总而言之，该问题是一项有效且结构良好的计算物理练习，要求实现数值导数、从谱数据生成场以及统计分析，所有这些都基于已建立的科学原理。\n\n### II. 求解方法\n\n将按照问题陈述中为每个测试用例概述的算法步骤来实施解决方案。\n\n1.  **网格和场生成**：对于每个测试用例，将构建一个具有坐标 $(x, y, z)$ 的均匀三维笛卡尔网格。标量场 $\\phi(\\mathbf{x}, t)$ 将在三个时间实例 $t=0$、$t=\\Delta t$ 和 $t=2\\Delta t$ 生成，方法是将在指定余弦模态的贡献求和。每个模态的振幅 $A_m$ 根据扩散方程的解析解随时间衰减，乘以一个因子 $\\exp(-D_\\phi \\|\\mathbf{k}_m\\|^2 t)$，其中 $\\mathbf{k}_m$ 是模态的波矢量。\n    $$ \\phi(\\mathbf{x}, t) = \\text{offset} + \\sum_{m} A_m \\exp\\left(-D_\\phi \\left\\| \\mathbf{k}_m \\right\\|^2 t\\right) \\cos(\\mathbf{k}_m \\cdot \\mathbf{x}) $$\n    其中 $\\mathbf{k}_m = \\left( \\frac{2\\pi n_{m,x}}{L_x}, \\frac{2\\pi n_{m,y}}{L_y}, \\frac{2\\pi n_{m,z}}{L_z} \\right)$。\n\n2.  **脉动和方差计算**：在三个时间步的每一步，计算空间平均值 $\\langle\\phi\\rangle(t)$，并从场中减去它以获得脉动场 $\\phi'(\\mathbf{x}, t) = \\phi(\\mathbf{x}, t) - \\langle\\phi\\rangle(t)$。然后，标量方差计算为脉动场平方的空间平均值，即 $\\langle\\phi'^2\\rangle(t) = \\langle (\\phi'(\\mathbf{x}, t))^2 \\rangle$。\n\n3.  **方差衰减率估计**：在中间时间步 $t=\\Delta t$ 的标量方差瞬时衰减率，使用应用于方差时间序列的二阶中心差分公式进行估计：\n    $$ R_{\\text{decay}} = - \\frac{d\\langle\\phi'^2\\rangle}{dt}\\bigg|_{t=\\Delta t} \\approx - \\frac{\\langle\\phi'^2\\rangle(2\\Delta t) - \\langle\\phi'^2\\rangle(0)}{2\\Delta t} $$\n\n4.  **空间平均标量耗散率**：此值在 $t = \\Delta t$ 计算。首先，使用带有周期性边界条件的二阶中心差分格式数值计算脉动场的梯度 $\\nabla\\phi'(\\mathbf{x}, \\Delta t)$。例如，在 $x$ 方向上，网格点 $i$ 处的导数为：\n    $$ \\frac{\\partial \\phi'}{\\partial x}\\bigg|_i \\approx \\frac{\\phi'_{i+1} - \\phi'_{i-1}}{2\\Delta x} $$\n    然后，计算逐点标量耗散率：\n    $$ \\chi_\\phi(\\mathbf{x}, \\Delta t) = 2 D_\\phi \\left\\| \\nabla\\phi'(\\mathbf{x}, \\Delta t) \\right\\|^2 = 2 D_\\phi \\left[ \\left(\\frac{\\partial \\phi'}{\\partial x}\\right)^2 + \\left(\\frac{\\partial \\phi'}{\\partial y}\\right)^2 + \\left(\\frac{\\partial \\phi'}{\\partial z}\\right)^2 \\right] $$\n    最后，计算其空间平均值 $\\langle\\chi_\\phi\\rangle(\\Delta t)$。将此结果与 $R_{\\text{decay}}$ 进行比较，计算它们的绝对差。\n\n5.  **条件标量耗散率**：在 $t = \\Delta t$ 时，将脉动场的范围 $[\\min(\\phi'), \\max(\\phi')]$ 分为 $8$ 个等宽的分箱 $\\mathcal{B}_i$（$i=1, \\dots, 8$）。对于每个网格点，我们确定其 $\\phi'$ 值属于哪个分箱。然后，对于每个分箱 $\\mathcal{B}_i$，我们计算两个量：\n    - 一个点落入该分箱的概率，$p_i = N_i / N_{\\text{total}}$，其中 $N_i$ 是分箱 $i$ 中的点数。\n    - 耗散率的条件平均值，$\\langle\\chi_\\phi | \\phi' \\in \\mathcal{B}_i\\rangle$，通过对分箱 $i$ 中的所有点的 $\\chi_\\phi$ 进行平均得到。\n\n    然后，通过对由各自概率加权的条件平均值求和，构建平均耗散率的另一种估计，这是全期望定律的离散表示：\n    $$ \\langle\\chi_\\phi\\rangle_{\\text{cond-int}} = \\sum_{i=1}^8 p_i \\langle\\chi_\\phi | \\phi' \\in \\mathcal{B}_i\\rangle $$\n    该值预计在数值上非常接近直接的空间平均值 $\\langle\\chi_\\phi\\rangle(\\Delta t)$。计算这两个估计值之间的绝对差。\n\n这五个浮点数值——$\\langle\\chi_\\phi\\rangle(\\Delta t)$、$R_{\\text{decay}}$、它们的绝对差、$\\langle\\chi_\\phi\\rangle_{\\text{cond-int}}$ 及其与 $\\langle\\chi_\\phi\\rangle(\\Delta t)$ 的绝对差——为每个测试用例计算，并按要求格式化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for scalar dissipation rate calculations.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Case 1 (single-wavenumber)\",\n            \"domain_lengths\": (1.0, 1.0, 1.0),\n            \"grid_points\": (32, 32, 32),\n            \"diffusivity\": 1.0e-4,\n            \"time_step\": 0.05,\n            \"offset\": 0.0,\n            \"modes\": [\n                (1.0, (1, 0, 0)),\n                (1.0, (0, 1, 0)),\n                (1.0, (0, 0, 1))\n            ]\n        },\n        {\n            \"name\": \"Case 2 (multi-wavenumber)\",\n            \"domain_lengths\": (2.0, 2.0, 2.0),\n            \"grid_points\": (40, 40, 40),\n            \"diffusivity\": 5.0e-4,\n            \"time_step\": 0.02,\n            \"offset\": 0.5,\n            \"modes\": [\n                (0.7, (1, 2, 0)),\n                (0.3, (0, 1, 3))\n            ]\n        },\n        {\n            \"name\": \"Case 3 (uniform field)\",\n            \"domain_lengths\": (1.0, 1.0, 1.0),\n            \"grid_points\": (16, 16, 16),\n            \"diffusivity\": 1.0e-3,\n            \"time_step\": 0.1,\n            \"offset\": 2.0,\n            \"modes\": []\n        },\n        {\n            \"name\": \"Case 4 (anisotropic)\",\n            \"domain_lengths\": (1.0, 1.5, 0.5),\n            \"grid_points\": (24, 36, 12),\n            \"diffusivity\": 2.0e-4,\n            \"time_step\": 0.03,\n            \"offset\": 0.1,\n            \"modes\": [\n                (0.8, (2, 1, 0)),\n                (0.5, (0, 3, 2))\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Ls = np.array(case[\"domain_lengths\"])\n        Ns = np.array(case[\"grid_points\"])\n        D_phi = case[\"diffusivity\"]\n        dt = case[\"time_step\"]\n        offset = case[\"offset\"]\n        modes = case[\"modes\"]\n        \n        deltas = Ls / Ns\n        \n        coords = [np.arange(N) * d for N, d in zip(Ns, deltas)]\n        X, Y, Z = np.meshgrid(coords[0], coords[1], coords[2], indexing='ij')\n\n        def generate_phi(t):\n            field = np.full(Ns, offset, dtype=float)\n            if not modes:\n                return field\n            \n            for A, n in modes:\n                n = np.array(n)\n                k = 2. * np.pi * n / Ls\n                k_norm_sq = np.sum(k**2)\n                decay = np.exp(-D_phi * k_norm_sq * t)\n                kx_x = k[0] * X\n                ky_y = k[1] * Y\n                kz_z = k[2] * Z\n                field += A * decay * np.cos(kx_x + ky_y + kz_z)\n            return field\n\n        phi_0 = generate_phi(0)\n        phi_1 = generate_phi(dt)\n        phi_2 = generate_phi(2 * dt)\n        \n        # Fluctuation fields and variances\n        phi_prime_0 = phi_0 - phi_0.mean()\n        phi_prime_1 = phi_1 - phi_1.mean()\n        phi_prime_2 = phi_2 - phi_2.mean()\n        \n        var_0 = np.mean(phi_prime_0**2)\n        var_1 = np.mean(phi_prime_1**2)\n        var_2 = np.mean(phi_prime_2**2)\n        \n        # Result 2: Estimated decay rate of variance\n        rate_decay_var = -(var_2 - var_0) / (2 * dt)\n\n        # Gradients of phi_prime at t=dt for dissipation calculation\n        grad_x = (np.roll(phi_prime_1, -1, axis=0) - np.roll(phi_prime_1, 1, axis=0)) / (2 * deltas[0])\n        grad_y = (np.roll(phi_prime_1, -1, axis=1) - np.roll(phi_prime_1, 1, axis=1)) / (2 * deltas[1])\n        grad_z = (np.roll(phi_prime_1, -1, axis=2) - np.roll(phi_prime_1, 1, axis=2)) / (2 * deltas[2])\n        \n        grad_phi_prime_norm_sq = grad_x**2 + grad_y**2 + grad_z**2\n        \n        chi_phi_1 = 2 * D_phi * grad_phi_prime_norm_sq\n        \n        # Result 1: Spatially averaged dissipation rate\n        avg_chi_phi = np.mean(chi_phi_1)\n        \n        # Result 3: Absolute difference between dissipation and variance decay rate\n        abs_diff_rates = np.abs(avg_chi_phi - rate_decay_var)\n\n        # Conditional analysis\n        phi_prime_1_flat = phi_prime_1.flatten()\n        chi_phi_1_flat = chi_phi_1.flatten()\n        \n        min_phi_p = phi_prime_1_flat.min()\n        max_phi_p = phi_prime_1_flat.max()\n        \n        num_bins = 8\n        cond_integral_est = 0.0\n        \n        if np.isclose(min_phi_p, max_phi_p):\n            # Uniform field, dissipation is zero everywhere\n            cond_integral_est = 0.0\n        else:\n            bin_edges = np.linspace(min_phi_p, max_phi_p, num_bins + 1)\n            # Ensure the max value is included in the last bin\n            bin_edges[-1] += 1e-9 * (max_phi_p - min_phi_p) if (max_phi_p - min_phi_p) > 0 else 1e-9\n            \n            digitized = np.digitize(phi_prime_1_flat, bin_edges)\n            \n            for i in range(1, num_bins + 1):\n                indices = np.where(digitized == i)[0]\n                count = len(indices)\n                if count > 0:\n                    p_i = count / phi_prime_1_flat.size\n                    cond_avg_chi = np.mean(chi_phi_1_flat[indices])\n                    cond_integral_est += p_i * cond_avg_chi\n        \n        # Result 4: Conditional-integral estimate\n        # This is already captured in cond_integral_est\n        \n        # Result 5: Absolute difference between conditional and unconditional averages\n        abs_diff_cond_uncond = np.abs(cond_integral_est - avg_chi_phi)\n        \n        results.append([\n            avg_chi_phi,\n            rate_decay_var,\n            abs_diff_rates,\n            cond_integral_est,\n            abs_diff_cond_uncond\n        ])\n        \n    # Format the final output string exactly as specified\n    output_str = repr(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在许多实际情况中，例如分析来自直接数值模拟（DNS）或实验的数据时，我们得到的不是连续的场，而是一组离散的数据点。本练习旨在解决从这类数据集中使用分箱（binning）方法估计条件平均值（如 $\\langle \\chi_Z | Z=z \\rangle$）的挑战。你将探索如何构建这些估计，并重要地，学习如何评估由有限采样和分箱宽度引入的内在偏差，这是处理模拟或实验数据的研究人员必须具备的一项关键技能。",
            "id": "4041886",
            "problem": "给定混合分数、一个标量和一个密度的独立同分布样本，表示为三元组 $\\{(Z_i, A_i, \\rho_i)\\}_{i=1}^N$，其中 $Z_i \\in [0,1]$ 是混合分数，$A_i$ 是无量纲标量耗散率，$\\rho_i$ 是无量纲密度。目标是使用分箱策略，在离散化的 $z$-网格上计算条件期望 $\\langle A \\mid Z = z \\rangle$ 和条件Favre平均 $\\tilde{A}(z)$ 的估计值，并评估估计偏差。条件Favre平均定义为 $\\tilde{A}(z) = \\dfrac{\\langle \\rho A \\mid Z = z \\rangle}{\\langle \\rho \\mid Z = z \\rangle}$，其中 $\\langle \\cdot \\mid Z = z \\rangle$ 表示给定 $Z = z$ 时的条件期望。该评估必须量化由分箱宽度和有限采样引起的偏差。\n\n本问题的基本基础包括：\n- 条件期望 $\\langle A \\mid Z = z \\rangle$ 的定义，即在混合分数 $Z$ 等于 $z$ 的所有实现上对 $A$ 求期望。\n- 条件Favre平均 $\\tilde{A}(z)$ 的定义，即密度加权的条件平均值，$\\tilde{A}(z) = \\dfrac{\\langle \\rho A \\mid Z = z \\rangle}{\\langle \\rho \\mid Z = z \\rangle}$。\n- 使用直方图分箱（一种矩形核）在有限的 $z$-网格上近似条件期望，同时认识到分箱会引入一个取决于分箱宽度的确定性偏差，以及一个由有限采样引起的随机误差。\n\n您必须设计并实现一个满足以下所有要求的算法：\n- 通过将区间 $[0,1]$ 划分为 $K$ 个宽度为 $h = 1/K$ 的等宽分箱来构建一个离散化的 $z$-网格，并在分箱中心定义估计量的位置。\n- 对每个估计量位置（每个分箱），计算：\n  1. 使用落入该分箱的数据，对 $\\langle A \\mid Z = z \\rangle$ 进行估计。\n  2. 使用落入该分箱的数据，对 $\\tilde{A}(z)$ 进行估计。\n- 提供一种鲁棒的方法来处理零样本分箱，即定义一个确定性的插值或外推程序，从而为所有分箱产生有限的估计量。\n- 通过将估计量与下文定义的基准真值条件函数进行比较，量化每个网格位置的估计偏差。根据这些偏差，计算：\n  - 条件期望估计量在所有分箱上的最大绝对偏差。\n  - 条件Favre平均估计量在所有分箱上的最大绝对偏差。\n- 使用矩形核的主阶确定性分箱偏差，对分箱引入的偏差进行评估。对于一个平滑的目标函数 $f(z)$ 和对称分箱，主阶分箱偏差与 $h^2$ 成比例，并与二阶导数 $f''(z)$ 成正比，因此在网格点上由分箱引入的偏差大小约为 $\\left|\\dfrac{h^2}{24} f''(z)\\right|$。对于条件Favre平均，将其真实条件函数（下文记为 $g(z)$）应用相同的主阶评估。\n- 对每个测试用例，按顺序报告四个浮点数：$\\text{max\\_abs\\_bias\\_unweighted}$、$\\text{max\\_abs\\_bias\\_favre}$、$\\text{predicted\\_bin\\_bias\\_max\\_unweighted}$、$\\text{predicted\\_bin\\_bias\\_max\\_favre}$。\n\n使用以下生成模型和测试套件进行评估：\n- 基准真值函数为\n  $$ f(z) = 0.4 + 0.5 z + 0.15 \\sin(2\\pi z), \\quad r(z) = 1.0 + 0.4 \\cos(2\\pi z), $$\n  对于所有 $z \\in [0,1]$，$r(z) > 0$。\n- 抽样模型为\n  $$ Z_i \\sim \\operatorname{Beta}(\\alpha, \\beta), $$\n  $$ \\begin{pmatrix} \\eta_i \\\\ \\xi_i \\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} \\sigma_A^2  c\\,\\sigma_A \\sigma_\\rho \\\\ c\\,\\sigma_A \\sigma_\\rho  \\sigma_\\rho^2 \\end{pmatrix} \\right), $$\n  $$ A_i = f(Z_i) + \\eta_i, \\quad \\rho_i = r(Z_i) + \\xi_i, $$\n  其中 $\\eta_i$ 和 $\\xi_i$ 是联合高斯分布，相关系数为 $c \\in [-1,1]$，$\\sigma_A > 0$ 和 $\\sigma_\\rho > 0$ 是标准差。真实的条件期望是 $\\langle A \\mid Z = z \\rangle = f(z)$。真实的条件Favre函数是\n  $$ g(z) = \\frac{\\langle \\rho A \\mid Z = z \\rangle}{\\langle \\rho \\mid Z = z \\rangle} = f(z) + \\frac{\\operatorname{Cov}(\\eta,\\xi)}{r(z)} = f(z) + \\frac{c\\,\\sigma_A \\sigma_\\rho}{r(z)}. $$\n\n实现以下参数值的测试套件。对于每个用例，设置随机数生成器种子以确保可复现性，然后对 $\\{(Z_i,A_i,\\rho_i)\\}_{i=1}^N$ 进行抽样，并按规定执行估计和偏差评估：\n- 用例1（通用情况）：$N = 12000$, $K = 60$, $(\\alpha,\\beta) = (2,5)$, $\\sigma_A = 0.08$, $\\sigma_\\rho = 0.06$, $c = 0.5$, 种子 $= 12345$。\n- 用例2（$Z$ 值集中在边界且噪声不相关）：$N = 1000$, $K = 40$, $(\\alpha,\\beta) = (0.5,0.5)$, $\\sigma_A = 0.15$, $\\sigma_\\rho = 0.10$, $c = 0.0$, 种子 $= 23456$。\n- 用例3（窄分箱，中等 $N$，相关噪声）：$N = 6000$, $K = 200$, $(\\alpha,\\beta) = (3,3)$, $\\sigma_A = 0.04$, $\\sigma_\\rho = 0.04$, $c = 0.7$, 种子 $= 34567$。\n- 用例4（小 $N$，强偏斜 $Z$）：$N = 300$, $K = 30$, $(\\alpha,\\beta) = (5,1)$, $\\sigma_A = 0.12$, $\\sigma_\\rho = 0.08$, $c = 0.3$, 种子 $= 45678$。\n\n算法要求和输出：\n- 在 $[0,1]$ 上构建 $K$ 个等宽分箱，计算分箱中心的估计值，并使用来自相邻非空分箱的插值确定性地处理空分箱。\n- 通过从相应的估计量中减去基准真值条件函数 $f(z)$ 和 $g(z)$ 来计算每个分箱的偏差。\n- 按上述顺序计算每个用例的四个浮点数。\n- 您的程序应生成单行输出，其中包含结果，格式为一个由用例结果组成的逗号分隔列表，每个用例结果是四个浮点数的逗号分隔列表，全部用方括号括起来，且不含空格。例如：\"[[c1_1,c1_2,c1_3,c1_4],[c2_1,c2_2,c2_3,c2_4],[c3_1,c3_2,c3_3,c3_4],[c4_1,c4_2,c4_3,c4_4]]\"。\n本问题中的所有量都是无量纲的，因此不需要物理单位。三角函数中出现的角度，根据构造是以弧度为单位的。",
            "solution": "该问题要求针对一组离散数据样本，实施并评估一种基于分箱的估计策略，用于计算条件期望和条件Favre平均。验证确认了该问题是适定的，在统计估计理论和计算燃烧模型方面具有科学依据，并为可复现的数值实验提供了完整的规范。因此，我们可以着手提供解决方案。\n\n问题的核心是从一个包含 $N$ 个数据三元组 $\\{(Z_i, A_i, \\rho_i)\\}_{i=1}^N$ 的有限集合中，估计标量 $A$ 的条件期望（记为 $\\langle A \\mid Z=z \\rangle$）及其密度加权对应项——条件Favre平均 $\\tilde{A}(z)$。在这里，$Z$ 是条件变量（混合分数），$A$ 是一个标量，$\\rho$ 是密度。\n\n### 基准真值模型\n数据由一个已知的底层模型生成，该模型为我们的评估提供了基准真值。真实的条件均值由以下公式给出：\n- $\\langle A \\mid Z=z \\rangle = f(z) = 0.4 + 0.5z + 0.15\\sin(2\\pi z)$\n- $\\langle \\rho \\mid Z=z \\rangle = r(z) = 1.0 + 0.4\\cos(2\\pi z)$\n\n样本本身是通过向这些函数添加相关的零均值高斯噪声生成的：\n$A_i = f(Z_i) + \\eta_i$\n$\\rho_i = r(Z_i) + \\xi_i$\n其中 $(\\eta_i, \\xi_i)$ 从一个协方差为 $c\\sigma_A\\sigma_\\rho$ 的二元正态分布中抽取。混合分数样本 $Z_i$ 从一个贝塔分布中抽取，$Z_i \\sim \\operatorname{Beta}(\\alpha, \\beta)$。\n\n根据这些定义，真实的条件Favre平均 $\\tilde{A}(z)$ 可以推导如下：\n$$\n\\tilde{A}(z) = \\frac{\\langle \\rho A \\mid Z=z \\rangle}{\\langle \\rho \\mid Z=z \\rangle} = \\frac{\\langle (r(z) + \\xi)(f(z) + \\eta) \\mid Z=z \\rangle}{r(z)}\n$$\n展开分子，并利用噪声项 $(\\eta, \\xi)$ 与 $Z$ 的统计独立性及其零均值特性（$\\langle\\eta\\rangle = \\langle\\xi\\rangle = 0$），我们得到：\n$$\n\\langle \\rho A \\mid Z=z \\rangle = r(z)f(z) + \\langle \\eta\\xi \\rangle = r(z)f(z) + \\mathrm{Cov}(\\eta, \\xi)\n$$\n协方差给定为 $\\mathrm{Cov}(\\eta, \\xi) = c\\sigma_A\\sigma_\\rho$。因此，真实的条件Favre平均（我们记为 $g(z)$）是：\n$$\ng(z) = \\tilde{A}(z) = f(z) + \\frac{c\\sigma_A\\sigma_\\rho}{r(z)}\n$$\n由于 $r(z) = 1.0 + 0.4\\cos(2\\pi z) \\ge 1.0 - 0.4 = 0.6 > 0$，函数 $g(z)$ 对于所有 $z \\in [0,1]$ 都是良定义的。\n\n### 估计算法\n估计过程在均匀网格上使用基于直方图（分箱）的方法。\n\n1.  **网格构建**：将条件变量的定义域 $[0,1]$ 划分为 $K$ 个等宽的分箱 $\\{B_k\\}_{k=1}^K$，宽度为 $h = 1/K$。第 $k$ 个分箱定义为 $B_k = [ (k-1)h, kh )$（对于 $k=1, \\dots, K-1$），以及 $B_K = [(K-1)h, Kh]$。估计量在每个分箱的中心 $z_k = (k-0.5)h$ 处进行评估。\n\n2.  **分箱估计量**：对于每个分箱 $B_k$，我们找到数据样本的子集 $S_k = \\{i \\mid Z_i \\in B_k\\}$ 及其大小 $N_k = |S_k|$。\n    - 条件期望 $\\langle A \\mid Z=z_k \\rangle$ 的估计量是分箱内各点 $A_i$ 的样本均值：\n      $$ \\hat{A}_k = \\frac{1}{N_k} \\sum_{i \\in S_k} A_i $$\n    - 条件Favre平均 $\\tilde{A}(z_k)$ 的估计量是 $\\rho A$ 的样本均值与 $\\rho$ 的样本均值之比：\n      $$ \\hat{\\tilde{A}}_k = \\frac{\\frac{1}{N_k} \\sum_{i \\in S_k} \\rho_i A_i}{\\frac{1}{N_k} \\sum_{i \\in S_k} \\rho_i} = \\frac{\\sum_{i \\in S_k} \\rho_i A_i}{\\sum_{i \\in S_k} \\rho_i} $$\n    如果一个分箱 $B_k$ 为空（$N_k=0$），这些估计量是未定义的。\n\n3.  **处理空分箱**：当 $N_k=0$ 时，直接估计会导致不定形式。需要一个确定性的程序。我们首先为所有非空分箱计算估计值。然后，对于任何空分箱，其值通过在最近的非空相邻分箱的值之间进行线性插值来估计。对于位于定义域边界的空分箱（即在第一个非空分箱之前或最后一个非空分箱之后），使用最近的非空分箱的值进行外推。\n\n### 偏差评估\n在每个网格点 $z_k$ 处，估计量的总误差是确定性偏差（由分箱宽度 $h$ 引起）和随机误差（由有限样本量 $N$ 引起）之和。总偏差通过将最终估计值（插值后）与在分箱中心评估的真实函数进行比较来计算：\n- 非加权平均的偏差：$\\mathcal{B}_A(z_k) = \\hat{A}_k - f(z_k)$\n- Favre平均的偏差：$\\mathcal{B}_{\\tilde{A}}(z_k) = \\hat{\\tilde{A}}_k - g(z_k)$\n\n问题要求报告这些偏差在所有分箱（$k=1, \\dots, K$）上的最大绝对值。\n\n此外，还需要对主阶确定性分箱偏差进行理论预测。对于一个足够平滑的函数和一个对称的分箱核，在点 $z$ 处的此偏差约为 $\\frac{h^2}{24} \\ddot{F}(z)$，其中 $\\ddot{F}$ 是真实条件函数的二阶导数。\n- 对于非加权平均，预测的偏差大小为 $\\left|\\frac{h^2}{24} f''(z)\\right|$。\n- 对于Favre平均，预测的偏差大小为 $\\left|\\frac{h^2}{24} g''(z)\\right|$。\n\n所需的二阶导数为：\n- $f''(z) = \\frac{d^2}{dz^2} (0.4 + 0.5z + 0.15\\sin(2\\pi z)) = -0.15(2\\pi)^2\\sin(2\\pi z) = -0.6\\pi^2\\sin(2\\pi z)$\n- 为了找到 $g''(z)$，我们对 $g(z) = f(z) + C r(z)^{-1}$ 进行微分，其中 $C=c\\sigma_A\\sigma_\\rho$。\n  $$ g''(z) = f''(z) + C \\frac{d^2}{dz^2}(r(z)^{-1}) = f''(z) + C \\left[ 2 \\frac{(r'(z))^2}{r(z)^3} - \\frac{r''(z)}{r(z)^2} \\right] $$\n  其中 $r(z) = 1.0 + 0.4\\cos(2\\pi z)$，$r'(z) = -0.8\\pi\\sin(2\\pi z)$，以及 $r''(z) = -1.6\\pi^2\\cos(2\\pi z)$。\n\n算法计算这些预测偏差大小在网格点 $z_k$ 上的最大值。这为可归因于网格粗糙度的部分误差提供了一个理论基线，与统计抽样误差分开。\n\n### 实现摘要\n该解决方案使用 `numpy` 和 `scipy` 库在Python中实现。对于每个测试用例：\n1.  为可复现性设置随机数生成器种子。\n2.  根据指定的模型生成 $N$ 个 $(Z_i, A_i, \\rho_i)$ 样本。\n3.  使用 `scipy.stats.binned_statistic` 函数高效地计算每个 $K$ 分箱中的 $A_i$、$\\rho_i$ 和 $\\rho_i A_i$ 的总和，以及样本数 $N_k$。\n4.  计算估计值 $\\hat{A}_k$ 和 $\\hat{\\tilde{A}}_k$。这将为空分箱产生 `NaN` 值。\n5.  使用 `numpy.interp` 通过线性插值和常数外推来填充 `NaN` 值。\n6.  在分箱中心评估真实函数 $f(z)$ 和 $g(z)$，以计算实际的估计偏差。\n7.  使用解析二阶导数 $f''(z)$ 和 $g''(z)$ 计算理论分箱偏差。\n8.  确定实际偏差和预测偏差的最大绝对值并存储。\n最后，所有测试用例的结果按照规定格式化为单个字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import binned_statistic\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: general case\n        {'N': 12000, 'K': 60, 'alpha': 2, 'beta': 5, 'sigma_A': 0.08, 'sigma_rho': 0.06, 'c': 0.5, 'seed': 12345},\n        # Case 2: boundary-heavy Z and uncorrelated noise\n        {'N': 1000, 'K': 40, 'alpha': 0.5, 'beta': 0.5, 'sigma_A': 0.15, 'sigma_rho': 0.10, 'c': 0.0, 'seed': 23456},\n        # Case 3: narrow bins, moderate N, correlated noise\n        {'N': 6000, 'K': 200, 'alpha': 3, 'beta': 3, 'sigma_A': 0.04, 'sigma_rho': 0.04, 'c': 0.7, 'seed': 34567},\n        # Case 4: small N, strongly skewed Z\n        {'N': 300, 'K': 30, 'alpha': 5, 'beta': 1, 'sigma_A': 0.12, 'sigma_rho': 0.08, 'c': 0.3, 'seed': 45678},\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_case(**params)\n        all_results.append(result)\n\n    # Format the final output string as a list of lists, with no spaces.\n    results_str = str(all_results).replace(\" \", \"\")\n    print(results_str)\n\ndef run_case(N, K, alpha, beta, sigma_A, sigma_rho, c, seed):\n    \"\"\"\n    Performs the full simulation and analysis for a single test case.\n    \"\"\"\n    # 1. Setup and Ground Truth Functions\n    rng = np.random.default_rng(seed)\n    h = 1.0 / K\n    \n    # Ground-truth function for"
        },
        {
            "introduction": "建立条件标量耗散率模型 $\\langle \\chi_Z | z \\rangle$ 后，下一步是在更大的模拟框架（如条件矩封闭，CMC）中使用它。本实践旨在通过分析CMC混合算子的稳定性，弥合模型与其数值实现之间的鸿沟。通过推导离散算子对时间步长的限制，你将具体理解你的 $\\langle \\chi_Z | z \\rangle$ 模型的特性——特别是其最大值——如何直接影响模拟的计算成本和可行性。",
            "id": "4041965",
            "problem": "考虑在混合分数空间中条件矩封闭（CMC）混合算子的一维公式。令 $z \\in [0,1]$ 表示混合分数坐标，$\\langle \\phi | z \\rangle$ 表示一个通用反应标量的条件平均值。$z$ 空间中的分子混合算子以守恒形式建模，其形式为一个依赖于 $z$ 的扩散系数所产生的扩散通量的散度。假设扩散系数与条件标量耗散率的关系为 $D(z) = \\frac{1}{2} \\langle \\chi_{Z} | z \\rangle$，其中 $\\langle \\chi_{Z} | z \\rangle$ 是混合分数空间中的条件标量耗散率。控制混合算子为\n$$\n\\mathcal{M}\\left[\\langle \\phi | z \\rangle\\right] = \\frac{\\partial}{\\partial z} \\left( D(z)\\, \\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z} \\right).\n$$\n该区域具有齐次诺伊曼边界条件，即 $\\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z}\\big|_{z=0} = 0$ 和 $\\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z}\\big|_{z=1} = 0$。\n\n要求您对该算子进行离散化，并推导出一个显式时间步长的稳定性判据。\n\n(i) 从以网格点 $z_i$ 为中心的控制体中的扩散通量守恒出发，在具有 $N$ 个节点的均匀网格上（$z_i = i\\,\\Delta z$，其中 $i = 0,1,\\dots,N$ 且 $\\Delta z = 1/N$），为空间算子推导一个二阶精确的守恒有限差分格式。使用中点扩散系数 $D_{i+\\frac{1}{2}}$ 和 $D_{i-\\frac{1}{2}}$，其定义为 $D_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(D_{i+1}+D_i\\right)$ 和 $D_{i-\\frac{1}{2}} = \\frac{1}{2}\\left(D_i+D_{i-1}\\right)$，其中 $D_i = D(z_i)$。通过虚拟点的镜像值来施加齐次诺伊曼边界条件。\n\n(ii) 考虑将显式前向欧拉时间积分应用于半离散方程\n$$\n\\frac{d}{dt}\\langle \\phi \\rangle_i(t) = \\mathcal{M}_i\\left[\\langle \\phi \\rangle(t)\\right],\n$$\n其中 $\\mathcal{M}_i$ 是您在节点 $i$ 处的离散算子。以 $\\langle \\chi_Z | z \\rangle$ 的最大值（记为 $\\langle \\chi_Z | z \\rangle_{\\max}$）和网格间距 $\\Delta z$ 来表示该显式格式的一个充分稳定性条件。您的推导应基于使用标准矩阵分析（例如，盖尔什戈林圆盘）或离散能量估计来限定离散扩散算子的谱半径，且不假设扩散系数为常数。\n\n(iii) 对于 $[0,1]$ 上具有 $N = 200$ 个区间（即 $N+1 = 201$ 个节点）的网格，以及最大条件标量耗散率 $\\langle \\chi_Z | z \\rangle_{\\max} = 3.6$（单位为 $\\text{s}^{-1}$），根据您在第 (ii) 部分得到的判据，计算允许的最大显式时间步长 $\\Delta t_{\\max}$（以秒为单位）。将您的答案四舍五入至四位有效数字，并以秒表示。",
            "solution": "该问题提法恰当，有科学依据，并包含唯一解所需的所有信息。我们开始进行推导。\n\n令 $\\langle \\phi_i \\rangle(t)$ 表示 $\\langle \\phi | z \\rangle(t)$ 在网格点 $z_i$ 处的值。条件平均值 $\\langle \\phi | z \\rangle$ 的时间演化的控制偏微分方程为：\n$$\n\\frac{\\partial \\langle \\phi | z \\rangle}{\\partial t} = \\mathcal{M}\\left[\\langle \\phi | z \\rangle\\right] = \\frac{\\partial}{\\partial z} \\left( D(z)\\, \\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z} \\right)\n$$\n\n### 第 (i) 部分：空间离散化\n\n我们使用守恒的有限体积法推导有限差分格式。考虑一个以内部节点 $z_i$ 为中心的控制体（CV），其范围从 $z_{i-\\frac{1}{2}}$ 到 $z_{i+\\frac{1}{2}}$，其中 $z_{i \\pm \\frac{1}{2}} = z_i \\pm \\frac{\\Delta z}{2}$。该控制体的宽度为 $\\Delta z$。将控制方程在该体积上积分，得到：\n$$\n\\int_{z_{i-\\frac{1}{2}}}^{z_{i+\\frac{1}{2}}} \\frac{\\partial \\langle \\phi | z \\rangle}{\\partial t} dz = \\int_{z_{i-\\frac{1}{2}}}^{z_{i+\\frac{1}{2}}} \\frac{\\partial}{\\partial z} \\left( D(z)\\, \\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z} \\right) dz\n$$\n对左侧进行近似，并对右侧应用微积分基本定理，我们得到：\n$$\n\\Delta z \\frac{d\\langle \\phi_i \\rangle}{dt} \\approx \\left[ D(z)\\, \\frac{\\partial \\langle \\phi | z \\rangle}{\\partial z} \\right]_{z_{i-\\frac{1}{2}}}^{z_{i+\\frac{1}{2}}} = \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{i+\\frac{1}{2}} - \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{i-\\frac{1}{2}}\n$$\n单元格界面上的扩散通量使用二阶中心差分格式进行离散化：\n$$\n\\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{i+\\frac{1}{2}} \\approx D_{i+\\frac{1}{2}} \\frac{\\langle \\phi_{i+1} \\rangle - \\langle \\phi_i \\rangle}{\\Delta z}\n$$\n$$\n\\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{i-\\frac{1}{2}} \\approx D_{i-\\frac{1}{2}} \\frac{\\langle \\phi_i \\rangle - \\langle \\phi_{i-1} \\rangle}{\\Delta z}\n$$\n其中 $D_{i \\pm \\frac{1}{2}}$ 是单元格界面处的扩散系数。问题指定了算术平均值：$D_{i+\\frac{1}{2}} = \\frac{1}{2}(D_{i+1}+D_i)$ 和 $D_{i-\\frac{1}{2}} = \\frac{1}{2}(D_i+D_{i-1})$。\n\n结合这些表达式，对于内部节点 $i \\in \\{1, \\dots, N-1\\}$ 的半离散方程为：\n$$\n\\mathcal{M}_i[\\langle \\phi \\rangle] = \\frac{d\\langle \\phi_i \\rangle}{dt} = \\frac{1}{(\\Delta z)^2} \\left[ D_{i+\\frac{1}{2}} (\\langle \\phi_{i+1} \\rangle - \\langle \\phi_i \\rangle) - D_{i-\\frac{1}{2}} (\\langle \\phi_i \\rangle - \\langle \\phi_{i-1} \\rangle) \\right]\n$$\n这可以重排为：\n$$\n\\mathcal{M}_i[\\langle \\phi \\rangle] = \\frac{1}{(\\Delta z)^2} \\left[ D_{i-\\frac{1}{2}} \\langle \\phi_{i-1} \\rangle - (D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}})\\langle \\phi_i \\rangle + D_{i+\\frac{1}{2}} \\langle \\phi_{i+1} \\rangle \\right]\n$$\n\n对于边界节点，我们在 $z=0$ 和 $z=1$ 处施加齐次诺伊曼条件 $\\frac{\\partial \\langle \\phi \\rangle}{\\partial z} = 0$。这等价于声明边界上的扩散通量为零。\n\n在 $z=z_0=0$ 处：控制体为 $[0, z_{\\frac{1}{2}}]$，宽度为 $\\frac{\\Delta z}{2}$。\n$$\n\\frac{\\Delta z}{2} \\frac{d\\langle \\phi_0 \\rangle}{dt} = \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{\\frac{1}{2}} - \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{0}\n$$\n边界条件意味着在 $z=0$ 处的通量为零。因此，\n$$\n\\frac{d\\langle \\phi_0 \\rangle}{dt} = \\frac{2}{\\Delta z} \\left( D_{\\frac{1}{2}} \\frac{\\langle \\phi_1 \\rangle - \\langle \\phi_0 \\rangle}{\\Delta z} \\right) = \\frac{2 D_{\\frac{1}{2}}}{(\\Delta z)^2} (\\langle \\phi_1 \\rangle - \\langle \\phi_0 \\rangle)\n$$\n\n在 $z=z_N=1$ 处：控制体为 $[z_{N-\\frac{1}{2}}, 1]$，宽度为 $\\frac{\\Delta z}{2}$。\n$$\n\\frac{\\Delta z}{2} \\frac{d\\langle \\phi_N \\rangle}{dt} = \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{N} - \\left( D\\, \\frac{\\partial \\langle \\phi \\rangle}{\\partial z} \\right)_{N-\\frac{1}{2}}\n$$\n在 $z=1$ 处的通量为零。因此，\n$$\n\\frac{d\\langle \\phi_N \\rangle}{dt} = -\\frac{2}{\\Delta z} \\left( D_{N-\\frac{1}{2}} \\frac{\\langle \\phi_N \\rangle - \\langle \\phi_{N-1} \\rangle}{\\Delta z} \\right) = \\frac{2 D_{N-\\frac{1}{2}}}{(\\Delta z)^2} (\\langle \\phi_{N-1} \\rangle - \\langle \\phi_N \\rangle)\n$$\n这些差分格式与题目所要求的，使用虚拟点和镜像值的方法是一致的。\n\n### 第 (ii) 部分：稳定性分析\n\n半离散系统可以写成矩阵形式 $\\frac{d\\vec{\\phi}}{dt} = \\mathbf{M}\\vec{\\phi}$，其中 $\\vec{\\phi} = [\\langle \\phi_0 \\rangle, \\dots, \\langle \\phi_N \\rangle]^T$ 且 $\\mathbf{M}$ 是一个表示离散算子 $\\mathcal{M}$ 的 $(N+1) \\times (N+1)$ 矩阵。$\\mathbf{M}$ 的非零元素为：\n对于 $i \\in \\{1, \\dots, N-1\\}$：\n$$\nM_{i, i-1} = \\frac{D_{i-\\frac{1}{2}}}{(\\Delta z)^2}, \\quad M_{i, i} = -\\frac{D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}}}{(\\Delta z)^2}, \\quad M_{i, i+1} = \\frac{D_{i+\\frac{1}{2}}}{(\\Delta z)^2}\n$$\n对于边界行：\n$$\nM_{0,0} = -\\frac{2D_{\\frac{1}{2}}}{(\\Delta z)^2}, \\quad M_{0,1} = \\frac{2D_{\\frac{1}{2}}}{(\\Delta z)^2}\n$$\n$$\nM_{N,N-1} = \\frac{2D_{N-\\frac{1}{2}}}{(\\Delta z)^2}, \\quad M_{N,N} = -\\frac{2D_{N-\\frac{1}{2}}}{(\\Delta z)^2}\n$$\n显式前向欧拉格式为 $\\vec{\\phi}^{n+1} = \\vec{\\phi}^n + \\Delta t \\, \\mathbf{M} \\vec{\\phi}^n = (\\mathbf{I} + \\Delta t \\, \\mathbf{M}) \\vec{\\phi}^n$。为了保证稳定性，放大矩阵 $\\mathbf{G} = \\mathbf{I} + \\Delta t \\, \\mathbf{M}$ 的谱半径必须满足 $\\rho(\\mathbf{G}) \\le 1$。如果 $\\lambda_k$ 是 $\\mathbf{M}$ 的特征值，那么 $\\mathbf{G}$ 的特征值为 $\\mu_k = 1 + \\Delta t \\lambda_k$。稳定性条件为对所有 $k$ 都有 $|1 + \\Delta t \\lambda_k| \\le 1$。\n\n我们使用盖尔什戈林圆盘定理来限定 $\\mathbf{M}$ 的特征值。由于 $D(z) \\ge 0$，$\\mathbf{M}$ 的非对角元素为非负值，对角元素为非正值。对于任意行 $i$，非对角元素之和等于对角元素的相反数：$\\sum_{j \\ne i} M_{i,j} = -M_{i,i}$。因此，所有的盖尔什戈林圆盘都以非正实轴上的点为中心，并与原点相切。这意味着所有特征值 $\\lambda_k$ 都是实数且非正，即 $\\lambda_k \\le 0$。\n\n对于实数 $\\lambda_k \\le 0$，稳定性条件 $|1 + \\Delta t \\lambda_k| \\le 1$ 可简化为 $1 + \\Delta t \\lambda_k \\ge -1$，即 $\\Delta t \\lambda_k \\ge -2$，或 $\\Delta t \\le -2/\\lambda_k$。为使所有特征值都满足此条件，我们需要 $\\Delta t \\le -2/\\lambda_{\\min}$，其中 $\\lambda_{\\min}$ 是最负的特征值。\n\n盖尔什戈林定理也提供了特征值的界：$\\lambda_k \\in \\bigcup_i [M_{i,i} - R_i, M_{i,i} + R_i]$，其中 $R_i = \\sum_{j \\ne i} |M_{i,j}|$。由于 $R_i = -M_{i,i}$，圆盘为 $[2M_{i,i}, 0]$。我们需要 $\\lambda_{\\min}$ 的一个下界。\n$$\n\\lambda_{\\min} \\ge \\min_i(M_{i,i} - R_i) = \\min_i(2M_{i,i})\n$$\n对角元素为：\n$$\nM_{0,0} = -\\frac{2D_{\\frac{1}{2}}}{(\\Delta z)^2} \\quad \\implies \\quad 2M_{0,0} = -\\frac{4D_{\\frac{1}{2}}}{(\\Delta z)^2}\n$$\n$$\nM_{i,i} = -\\frac{D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}}}{(\\Delta z)^2} \\quad \\implies \\quad 2M_{i,i} = -\\frac{2(D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}})}{(\\Delta z)^2} \\quad \\text{对于 } i \\in \\{1,\\dots,N-1\\}\n$$\n$$\nM_{N,N} = -\\frac{2D_{N-\\frac{1}{2}}}{(\\Delta z)^2} \\quad \\implies \\quad 2M_{N,N} = -\\frac{4D_{N-\\frac{1}{2}}}{(\\Delta z)^2}\n$$\n令 $D_{\\max} = \\max_{z \\in [0,1]} D(z)$。根据定义 $D_{i \\pm \\frac{1}{2}} = \\frac{1}{2}(D_{i \\pm 1} + D_i)$，我们有 $D_{i \\pm \\frac{1}{2}} \\le D_{\\max}$。\n因此，我们可以限定特征值的估计：\n$$\n|\\lambda_{\\min}| \\le \\max_i(-2M_{i,i}) = \\frac{1}{(\\Delta z)^2} \\max\\left(4D_{\\frac{1}{2}}, \\dots, 2(D_{i-\\frac{1}{2}} + D_{i+\\frac{1}{2}}), \\dots, 4D_{N-\\frac{1}{2}}\\right) \\le \\frac{4D_{\\max}}{(\\Delta z)^2}\n$$\n因此，一个充分的稳定性条件是：\n$$\n\\Delta t \\le \\frac{2}{|\\lambda_{\\min}|} \\implies \\Delta t \\le \\frac{2}{4D_{\\max}/(\\Delta z)^2} = \\frac{(\\Delta z)^2}{2D_{\\max}}\n$$\n已知 $D(z) = \\frac{1}{2} \\langle \\chi_{Z} | z \\rangle$，我们有 $D_{\\max} = \\frac{1}{2} \\langle \\chi_{Z} | z \\rangle_{\\max}$。将此代入稳定性判据：\n$$\n\\Delta t \\le \\frac{(\\Delta z)^2}{2 \\left( \\frac{1}{2} \\langle \\chi_Z | z \\rangle_{\\max} \\right)} = \\frac{(\\Delta z)^2}{\\langle \\chi_Z | z \\rangle_{\\max}}\n$$\n这就是充分稳定性条件。\n\n### 第 (iii) 部分：最大时间步长的计算\n\n我们已知以下值：\n- 区间数：$N = 200$。\n- 网格间距：$\\Delta z = \\frac{1}{N} = \\frac{1}{200}$。\n- 最大条件标量耗散率：$\\langle \\chi_Z | z \\rangle_{\\max} = 3.6 \\, \\text{s}^{-1}$。\n\n允许的最大显式时间步长 $\\Delta t_{\\max}$ 由稳定性判据中的等式给出：\n$$\n\\Delta t_{\\max} = \\frac{(\\Delta z)^2}{\\langle \\chi_Z | z \\rangle_{\\max}}\n$$\n代入数值：\n$$\n\\Delta t_{\\max} = \\frac{\\left(\\frac{1}{200}\\right)^2}{3.6} = \\frac{\\frac{1}{40000}}{3.6} = \\frac{1}{40000 \\times 3.6} \\, \\text{s}\n$$\n$$\n\\Delta t_{\\max} = \\frac{1}{144000} \\, \\text{s}\n$$\n为了用小数形式表示，我们进行除法运算：\n$$\n\\Delta t_{\\max} = 0.0000069444... \\, \\text{s} = 6.9444... \\times 10^{-6} \\, \\text{s}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n\\Delta t_{\\max} \\approx 6.944 \\times 10^{-6} \\, \\text{s}\n$$",
            "answer": "$$\\boxed{6.944 \\times 10^{-6}}$$"
        }
    ]
}