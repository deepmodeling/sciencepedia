{
    "hands_on_practices": [
        {
            "introduction": "在为燃烧模拟构建机器学习代理模型时，一个核心要求是确保模型严格遵守基本的物理守恒定律。本练习探讨了如何通过设计神经网络的输出层来强制执行质量守恒定律（即所有物质质量源项之和为零）。通过学习这种约束参数化方法 ，您将掌握一项将物理原理直接嵌入模型架构的基础技术，从而确保模型预测在设计上始终是物理一致的。",
            "id": "4037295",
            "problem": "考虑一个用于计算燃烧学的、包含 $N_s$ 种化学物质的均质、恒定密度的反应混合物。设混合物密度为 $\\rho$，温度为 $T$，各组分的质量分数为 $\\mathbf{Y} = (Y_1,\\dots,Y_{N_s})$。在一个化学反应机理中，质量守恒定律要求各组分质量源项之和满足 $\\sum_{i=1}^{N_s} \\dot{\\omega}_i = 0$，其中 $\\dot{\\omega}_i$ 表示组分 $i$ 的质量生成率。您的任务是构建一个用于化学建表和加速的机器学习代理模型，该模型将热化学状态 $(T, \\mathbf{Y})$ 映射到组分源项。该代理模型预测 $N_s - 1$ 个原始输出 $\\{r_i\\}_{i=1}^{N_s-1}$，其中每个 $r_i \\in \\mathbb{R}$ 都是无约束的。为获得具有正确尺度的物理源项，将前 $N_s - 1$ 个组分的源项定义为 $\\dot{\\omega}_i = \\alpha s_i r_i$（对于 $i = 1,\\dots,N_s-1$），其中 $\\alpha > 0$ 是一个可能依赖于 $(T, \\mathbf{Y})$ 的共享标量缩放因子，而每个 $s_i > 0$ 是一个由数据集归一化产生的、固定的各组分缩放常数。\n\n推导最后一个组分的约束输出参数化，以精确地强制执行总质量生成率守恒。具体来说，给出一个关于 $\\alpha$、$\\{s_i\\}_{i=1}^{N_s-1}$ 和 $\\{r_i\\}_{i=1}^{N_s-1}$ 的 $\\dot{\\omega}_{N_s}$ 的闭式解析表达式，使得对于所有代理模型输出 $\\{r_i\\}$，$\\sum_{i=1}^{N_s} \\dot{\\omega}_i = 0$ 均成立。您的最终答案必须是一个单一的解析表达式；不要包含任何单位。",
            "solution": "该问题是有效的，因为它在科学上基于化学动力学和计算燃烧学的原理，问题陈述清晰且信息充分，可得出唯一解，并使用正式的科学语言客观陈述。\n\n目标是推导最后一个组分质量生成率 $\\dot{\\omega}_{N_s}$ 的闭式表达式，从而精确满足质量守恒定律。其支配性的物理原理是化学反应系统中的总质量守恒，该原理规定所有组分的质量生成率（源项）之和必须为零。这由以下方程给出：\n$$\n\\sum_{i=1}^{N_s} \\dot{\\omega}_i = 0\n$$\n其中 $N_s$ 是混合物中组分的总数。\n\n为推导 $\\dot{\\omega}_{N_s}$ 的表达式，我们可以将此项从总和中分离出来。该求和可以展开为：\n$$\n\\left( \\sum_{i=1}^{N_s-1} \\dot{\\omega}_i \\right) + \\dot{\\omega}_{N_s} = 0\n$$\n通过重新整理该方程，我们可以将 $\\dot{\\omega}_{N_s}$ 单独置于一侧：\n$$\n\\dot{\\omega}_{N_s} = - \\sum_{i=1}^{N_s-1} \\dot{\\omega}_i\n$$\n该方程通过将最后一个组分的源项定义为所有其他组分源项之和的负值来强制执行守恒定律。\n\n根据问题陈述，一个机器学习代理模型被用来预测前 $N_s-1$ 个组分的源项。模型的原始输出 $\\{r_i\\}_{i=1}^{N_s-1}$ 通过以下参数化（对于 $i = 1, \\dots, N_s-1$）转换为物理源项：\n$$\n\\dot{\\omega}_i = \\alpha s_i r_i\n$$\n此处，$\\alpha$ 是一个共享的正标量缩放因子，每个 $s_i$ 是一个固定的、针对各组分的正缩放常数。\n\n现在，我们将 $\\dot{\\omega}_i$ 的这个定义代入 $\\dot{\\omega}_{N_s}$ 的表达式中：\n$$\n\\dot{\\omega}_{N_s} = - \\sum_{i=1}^{N_s-1} (\\alpha s_i r_i)\n$$\n由于缩放因子 $\\alpha$ 是一个共享标量，它相对于求和索引 $i$ 是一个常数。因此，可以将其从求和中提取出来：\n$$\n\\dot{\\omega}_{N_s} = - \\alpha \\sum_{i=1}^{N_s-1} s_i r_i\n$$\n这就是关于共享缩放因子 $\\alpha$、各组分缩放常数 $\\{s_i\\}_{i=1}^{N_s-1}$ 和代理模型原始输出 $\\{r_i\\}_{i=1}^{N_s-1}$ 的 $\\dot{\\omega}_{N_s}$ 的最终闭式解析表达式。这种参数化保证了对于代理模型产生的任何一组无约束实值输出 $\\{r_i\\}$，$\\sum_{i=1}^{N_s} \\dot{\\omega}_i = 0$ 均成立，从而将物理守恒定律直接嵌入到模型的输出层中。热化学状态的变量，如温度 $T$ 和组分质量分数 $\\mathbf{Y}$，是机器学习模型的输入，该模型产生 $\\{r_i\\}$ 值并可能确定 $\\alpha$，但它们不出现在强制执行守恒约束本身的最终代数关系式中。",
            "answer": "$$\n\\boxed{- \\alpha \\sum_{i=1}^{N_s-1} s_i r_i}\n$$"
        },
        {
            "introduction": "成功构建了满足物理约束的机器学习代理模型后，下一步是将其集成到常微分方程（ODE）求解器中，以在动态仿真中使用。化学反应系统通常是“刚性”的，这意味着显式时间积分格式的稳定性受到严格限制。本练习将指导您计算神经网络代理模型的雅可比矩阵，并通过分析其特征值来确定数值积分的最大稳定时间步长 。这项实践对于理解机器学习模型如何影响仿真稳定性至关重要，是成功部署代理模型的关键一步。",
            "id": "4037322",
            "problem": "考虑一个降阶刚性化学系统，其中组分质量分数向量 $\\mathbf{Y} \\in \\mathbb{R}^{n_s}$ 遵循形式为 $\\dot{\\mathbf{Y}} = \\boldsymbol{\\omega}(\\mathbf{Y})$ 的常微分方程（ODE）进行演化，其中 $\\boldsymbol{\\omega}(\\mathbf{Y})$ 代表化学源项。为了加速化学反应计算并实现列表化，可以用一个经训练以近似 $\\boldsymbol{\\omega}(\\mathbf{Y})$ 的人工神经网络（ANN）代理模型来替代精确源项。设该代理模型为一个双层前馈人工神经网络，使用双曲正切激活函数，对于输入 $\\mathbf{Y} \\in \\mathbb{R}^{3}$ 定义如下\n$$\n\\boldsymbol{f}(\\mathbf{Y}) = \\mathbf{W}_2 \\, \\tanh(\\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1) + \\mathbf{b}_2,\n$$\n其中 $\\mathbf{W}_1 \\in \\mathbb{R}^{m \\times 3}$，$\\mathbf{b}_1 \\in \\mathbb{R}^{m}$，$\\mathbf{W}_2 \\in \\mathbb{R}^{3 \\times m}$ 以及 $\\mathbf{b}_2 \\in \\mathbb{R}^{3}$，且 $m=3$。代理模型的输出近似于 $\\dot{\\mathbf{Y}}$，在适当缩放后，其单位为 $\\mathrm{s}^{-1}$。该代理模型的雅可比矩阵 $\\mathbf{J}(\\mathbf{Y})$ 定义为\n$$\n\\mathbf{J}(\\mathbf{Y}) = \\frac{\\partial \\boldsymbol{f}(\\mathbf{Y})}{\\partial \\mathbf{Y}},\n$$\n其元素的单位为 $\\mathrm{s}^{-1}$。应使用自动微分（AD），基于应用于指定 ANN 结构的链式法则，来计算 $\\mathbf{J}(\\mathbf{Y})$。\n\n从刚性常微分方程的线性化原理和显式欧拉方法出发，回顾对于标量线性测试方程 $\\dot{y} = \\lambda y$ 的基本稳定性考量，即当放大因子满足 $|1 + h \\lambda| \\leq 1$ 时，显式欧拉步长 $y_{n+1} = y_n + h \\lambda y_n$ 是线性稳定的。通过分析雅可比矩阵 $\\mathbf{J}(\\mathbf{Y})$ 的特征值，将此考量推广到矩阵情况，并当特征值具有较大的负实部时，确定稳定的显式欧拉时间步长 $h$ 的一个保守界限。您必须以秒为单位表示稳定步长界限 $h_{\\max}$。\n\n实现一个完整的程序，该程序能够：\n- 按规定构造 ANN 代理模型 $\\boldsymbol{f}(\\mathbf{Y})$。\n- 应用自动微分于 ANN 各层和激活函数，计算在指定 $\\mathbf{Y}$ 处的雅可比矩阵 $\\mathbf{J}(\\mathbf{Y})$。\n- 计算 $\\mathbf{J}(\\mathbf{Y})$ 的特征值。\n- 基于特征值，使用推广到每个可能具有非零虚部的特征值的标量稳定性条件，确定一个保守的最大稳定显式欧拉时间步长 $h_{\\max}$（以秒为单位）。\n- 通过检查单步放大矩阵 $\\mathbf{A}(h) = \\mathbf{I} + h \\mathbf{J}(\\mathbf{Y})$ 的谱半径并测试其是否小于或等于 $1$，来为一组指定的显式欧拉时间步长 $h$ 评估线性稳定性。\n\n您必须考虑三个测试用例。对于每个用例，会给出网络参数、评估点 $\\mathbf{Y}$ 以及三个以秒为单位的显式欧拉步长 $h$。使用上述描述的相同 ANN 架构，其中 $m=3$。参数如下：\n\n用例 1（具有非对角耦合的刚性系统）：\n- $\\mathbf{W}_1 = \\begin{bmatrix} 3.0 & -1.0 & 0.5 \\\\ -2.0 & 4.0 & -0.5 \\\\ 1.0 & 1.0 & -3.0 \\end{bmatrix}$，\n- $\\mathbf{b}_1 = \\begin{bmatrix} 0.1 \\\\ -0.2 \\\\ 0.3 \\end{bmatrix}$，\n- $\\mathbf{W}_2 = \\begin{bmatrix} -1000.0 & 50.0 & 0.0 \\\\ 0.0 & -50.0 & 20.0 \\\\ 10.0 & -5.0 & -1.0 \\end{bmatrix}$，\n- $\\mathbf{b}_2 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$，\n- $\\mathbf{Y} = \\begin{bmatrix} 0.1 \\\\ 0.3 \\\\ 0.6 \\end{bmatrix}$，\n- 步长 $h \\in \\{10^{-5}, 10^{-3}, 10^{-2}\\}$。\n\n用例 2（中等刚性系统）：\n- $\\mathbf{W}_1 = \\begin{bmatrix} 1.0 & 0.2 & -0.3 \\\\ 0.5 & -0.1 & 0.4 \\\\ -0.7 & 0.8 & -0.2 \\end{bmatrix}$，\n- $\\mathbf{b}_1 = \\begin{bmatrix} 0.05 \\\\ -0.05 \\\\ 0.02 \\end{bmatrix}$，\n- $\\mathbf{W}_2 = \\begin{bmatrix} -10.0 & 1.0 & 0.0 \\\\ 0.5 & -5.0 & 0.5 \\\\ 0.0 & 0.2 & -1.0 \\end{bmatrix}$，\n- $\\mathbf{b}_2 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$，\n- $\\mathbf{Y} = \\begin{bmatrix} 0.9 \\\\ 0.05 \\\\ 0.05 \\end{bmatrix}$，\n- 步长 $h \\in \\{10^{-3}, 5 \\cdot 10^{-2}, 10^{-1}\\}$。\n\n用例 3（具有激活饱和效应的极端刚性系统）：\n- $\\mathbf{W}_1 = \\begin{bmatrix} 8.0 & -6.0 & 4.0 \\\\ -9.0 & 5.0 & -7.0 \\\\ 6.5 & -8.0 & 10.0 \\end{bmatrix}$，\n- $\\mathbf{b}_1 = \\begin{bmatrix} 0.5 \\\\ -0.3 \\\\ 0.1 \\end{bmatrix}$，\n- $\\mathbf{W}_2 = \\begin{bmatrix} -5000.0 & 200.0 & 0.0 \\\\ 0.0 & -100.0 & 40.0 \\\\ 30.0 & -10.0 & -20.0 \\end{bmatrix}$，\n- $\\mathbf{b}_2 = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$，\n- $\\mathbf{Y} = \\begin{bmatrix} 0.33 \\\\ 0.33 \\\\ 0.34 \\end{bmatrix}$，\n- 步长 $h \\in \\{10^{-5}, 10^{-4}, 10^{-3}\\}$。\n\n对于每个用例：\n1. 使用 AD 对 ANN 计算 $\\mathbf{J}(\\mathbf{Y})$。\n2. 计算 $\\mathbf{J}(\\mathbf{Y})$ 的所有特征值 $\\{\\lambda_i\\}$。\n3. 根据应用于每个 $\\lambda_i$ 的标量稳定性条件，确定一个以秒为单位的保守界限 $h_{\\max}$，以确保对所有特征值同时满足 $|1 + h \\lambda_i| \\leq 1$。\n4. 对于用例中每个指定的 $h$，计算谱半径 $\\rho(\\mathbf{I} + h \\mathbf{J}(\\mathbf{Y}))$ 并报告该步长是否线性稳定，即 $\\rho(\\mathbf{I} + h \\mathbf{J}(\\mathbf{Y})) \\leq 1$ 是否成立。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个元素对应一个用例，并且应该是一个形式为 $[h_{\\max}, s_1, s_2, s_3]$ 的列表，其中 $h_{\\max}$ 是一个以秒为单位的浮点数，$s_k$ 是指示该用例第 $k$ 个步长稳定性的布尔值。例如，最终输出必须如下所示\n$$\n[\\,[h_{\\max}^{(1)}, s_1^{(1)}, s_2^{(1)}, s_3^{(1)}],[h_{\\max}^{(2)}, s_1^{(2)}, s_2^{(2)}, s_3^{(2)}],[h_{\\max}^{(3)}, s_1^{(3)}, s_2^{(3)}, s_3^{(3)}]\\,].\n$$\n所有 $h_{\\max}$ 值必须以秒为单位表示，且不应打印任何其他文本。",
            "solution": "首先验证该问题，以确保其在科学上是合理的、自洽的且适定的。\n\n### 第 1 步：提取已知条件\n- **控制方程：** 组分质量分数向量 $\\mathbf{Y} \\in \\mathbb{R}^{n_s}$ 遵循常微分方程（ODE）$\\dot{\\mathbf{Y}} = \\boldsymbol{\\omega}(\\mathbf{Y})$ 进行演化。\n- **ANN 代理模型：** 源项 $\\boldsymbol{\\omega}(\\mathbf{Y})$ 由一个双层前馈人工神经网络（ANN）$\\boldsymbol{f}(\\mathbf{Y})$ 近似，其中 $\\mathbf{Y} \\in \\mathbb{R}^{3}$。\n- **ANN 架构：** $\\boldsymbol{f}(\\mathbf{Y}) = \\mathbf{W}_2 \\, \\tanh(\\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1) + \\mathbf{b}_2$。\n- **ANN 参数：** $\\mathbf{W}_1 \\in \\mathbb{R}^{m \\times 3}$，$\\mathbf{b}_1 \\in \\mathbb{R}^{m}$，$\\mathbf{W}_2 \\in \\mathbb{R}^{3 \\times m}$，$\\mathbf{b}_2 \\in \\mathbb{R}^{3}$，隐藏层大小 $m=3$。\n- **雅可比矩阵：** $\\mathbf{J}(\\mathbf{Y}) = \\frac{\\partial \\boldsymbol{f}(\\mathbf{Y})}{\\partial \\mathbf{Y}}$。\n- **稳定性条件（标量）：** 对于 $\\dot{y} = \\lambda y$，如果 $|1 + h \\lambda| \\leq 1$，则显式欧拉步长是稳定的。\n- **稳定性条件（系统）：** 对于给定的步长 $h$，通过检查放大矩阵的谱半径 $\\rho(\\mathbf{I} + h \\mathbf{J}(\\mathbf{Y}))$ 是否小于或等于 $1$ 来评估稳定性。\n- **目标：** 对于三个测试用例，计算：\n    1. 使用自动微分（AD）计算雅可比矩阵 $\\mathbf{J}(\\mathbf{Y})$。\n    2. $\\mathbf{J}(\\mathbf{Y})$ 的特征值。\n    3. 一个保守的最大稳定显式欧拉时间步长 $h_{\\max}$。\n    4. 对给定的一组时间步长 $h$ 的稳定性。\n- **测试用例：** 提供了三个用例，每个用例都带有特定的矩阵 $\\mathbf{W}_1, \\mathbf{W}_2$、向量 $\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{Y}$ 以及一组待测试的步长 $h$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于数值分析（ODE 求解器的稳定性）、线性代数（特征值分析）和标准机器学习模型（前馈神经网络）的基本原理。其应用背景——在计算燃烧学中加速刚性化学动力学，是一个成熟且活跃的科学研究领域。\n- **适定性：** 问题定义清晰，具有唯一的、可计算的解。ANN 架构、参数和评估点均已指定，从而可以确定性地得到雅可比矩阵及后续的稳定性分析。\n- **目标：** 问题以精确、定量和无偏的数学语言陈述。\n- **完整性和一致性：** 提供了所有必要信息（网络参数、评估点、稳定性准则）。所有矩阵和向量的维度与规定的运算一致。\n- **真实性：** 该设置是现实的。刚性化学系统很常见，使用 ANN 代理模型是一种现代技术。权重矩阵中的大负值（例如 -1000.0, -5000.0）是刚性现象模型的特征，这正确地暗示了需要非常小的显式时间步长。\n- **非平凡性：** 该问题具有实质性，需要应用矩阵微积分（雅可比矩阵的链式法则）、数值线性代数（特征值计算）以及 ODE 系统数值稳定性理论。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。这是一个在应用数学和计算科学领域中定义明确、有科学依据的问题。现在将开始求解过程。\n\n---\n\n### 基于原理的求解\n\n问题的核心是评估当常微分方程（ODE）系统的右侧由人工神经网络（ANN）近似时，显式欧拉数值积分方案的稳定性。\n\n**1. 通过自动微分（AD）计算 ANN 的雅可比矩阵**\n\nANN 作为化学源项的代理模型，即 $\\dot{\\mathbf{Y}} \\approx \\boldsymbol{f}(\\mathbf{Y})$。该系统的局部行为由其线性化决定，这需要计算雅可比矩阵 $\\mathbf{J}(\\mathbf{Y}) = \\frac{\\partial \\boldsymbol{f}}{\\partial \\mathbf{Y}}$。我们使用链式法则来计算它，这是反向模式自动微分的基石。\n\n网络定义为 $\\boldsymbol{f}(\\mathbf{Y}) = \\mathbf{W}_2 \\, \\tanh(\\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1) + \\mathbf{b}_2$。让我们将其分解为中间步骤：\n1. 隐藏层的激活前输入：$\\mathbf{z}_1 = \\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1$。\n2. 隐藏层的激活输出：$\\mathbf{a}_1 = \\tanh(\\mathbf{z}_1)$。\n3. 网络的输出：$\\boldsymbol{f} = \\mathbf{W}_2 \\mathbf{a}_1 + \\mathbf{b}_2$。\n\n应用链式求导法则：\n$$\n\\mathbf{J}(\\mathbf{Y}) = \\frac{\\partial \\boldsymbol{f}}{\\partial \\mathbf{Y}} = \\frac{\\partial \\boldsymbol{f}}{\\partial \\mathbf{a}_1} \\frac{\\partial \\mathbf{a}_1}{\\partial \\mathbf{z}_1} \\frac{\\partial \\mathbf{z}_1}{\\partial \\mathbf{Y}}\n$$\n让我们计算每个偏导数：\n-   $\\frac{\\partial \\mathbf{z}_1}{\\partial \\mathbf{Y}}$：从线性变换 $\\mathbf{z}_1 = \\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1$ 可知，关于 $\\mathbf{Y}$ 的导数就是权重矩阵 $\\mathbf{W}_1$。\n-   $\\frac{\\partial \\boldsymbol{f}}{\\partial \\mathbf{a}_1}$：从输出变换 $\\boldsymbol{f} = \\mathbf{W}_2 \\mathbf{a}_1 + \\mathbf{b}_2$ 可知，关于 $\\mathbf{a}_1$ 的导数就是权重矩阵 $\\mathbf{W}_2$。\n-   $\\frac{\\partial \\mathbf{a}_1}{\\partial \\mathbf{z}_1}$：激活函数 $\\tanh$ 是逐元素应用的。因此，其导数是一个对角矩阵。$\\tanh(x)$ 的导数是 $1 - \\tanh^2(x)$。该层的雅可比矩阵结果为 $\\mathbf{D} = \\text{diag}(1 - \\tanh^2(z_{1,i}))$，其中 $z_{1,i}$ 是向量 $\\mathbf{z}_1$ 的元素。\n\n将这些部分组合起来，得到 ANN 雅可比矩阵的解析表达式：\n$$\n\\mathbf{J}(\\mathbf{Y}) = \\mathbf{W}_2 \\cdot \\text{diag}(1 - \\tanh^2(\\mathbf{W}_1 \\mathbf{Y} + \\mathbf{b}_1)) \\cdot \\mathbf{W}_1\n$$\n此公式用于计算在给定状态 $\\mathbf{Y}$ 处的雅可比矩阵。\n\n**2. 显式欧拉稳定性分析**\n\n显式欧拉方法通过将系统局部线性化为 $\\dot{\\boldsymbol{\\eta}} = \\mathbf{J}(\\mathbf{Y}_n) \\boldsymbol{\\eta}$ 来近似 $\\dot{\\mathbf{Y}} = \\boldsymbol{f}(\\mathbf{Y})$ 的解，其中 $\\boldsymbol{\\eta}$ 是对 $\\mathbf{Y}_n$ 的扰动。更新步骤为：\n$$\n\\mathbf{Y}_{n+1} = \\mathbf{Y}_n + h \\boldsymbol{f}(\\mathbf{Y}_n)\n$$\n为了进行稳定性分析，我们考虑扰动如何演化。在第 $n$ 步的扰动 $\\boldsymbol{\\epsilon}_n$ 演化到第 $n+1$ 步的 $\\boldsymbol{\\epsilon}_{n+1}$，遵循以下关系：\n$$\n\\mathbf{Y}_{n+1} + \\boldsymbol{\\epsilon}_{n+1} = (\\mathbf{Y}_n + \\boldsymbol{\\epsilon}_n) + h \\boldsymbol{f}(\\mathbf{Y}_n + \\boldsymbol{\\epsilon}_n) \\approx \\mathbf{Y}_n + \\boldsymbol{\\epsilon}_n + h (\\boldsymbol{f}(\\mathbf{Y}_n) + \\mathbf{J}(\\mathbf{Y}_n) \\boldsymbol{\\epsilon}_n)\n$$\n减去未受扰动的方程，我们得到扰动的演化：\n$$\n\\boldsymbol{\\epsilon}_{n+1} = (\\mathbf{I} + h \\mathbf{J}(\\mathbf{Y}_n)) \\boldsymbol{\\epsilon}_n\n$$\n矩阵 $\\mathbf{A}(h) = \\mathbf{I} + h \\mathbf{J}$ 是放大矩阵。为了使方法稳定，扰动不能增长，这要求 $\\mathbf{A}(h)$ 的谱半径不大于 $1$：\n$$\n\\rho(\\mathbf{A}(h)) \\le 1\n$$\n$\\mathbf{A}(h)$ 的特征值（记为 $\\mu_i$）与 $\\mathbf{J}$ 的特征值（记为 $\\lambda_i$）通过 $\\mu_i = 1 + h \\lambda_i$ 相关。因此，稳定性条件变为对雅可比矩阵 $\\mathbf{J}$ 的所有特征值 $\\lambda_i$ 都满足 $|1 + h \\lambda_i| \\leq 1$。\n\n**3. 最大稳定时间步长 $h_{\\max}$**\n\n设 $\\mathbf{J}$ 的一个特征值为复数 $\\lambda = x + iy$。稳定性条件为 $|1 + h(x+iy)|^2 \\leq 1$，展开后为：\n$$\n(1 + hx)^2 + (hy)^2 \\leq 1 \\implies 1 + 2hx + h^2x^2 + h^2y^2 \\leq 1 \\implies h(2x + h(x^2+y^2)) \\leq 0\n$$\n由于时间步长 $h$ 必须为正，我们需要 $2x + h(x^2+y^2) \\leq 0$。对于刚性系统，我们预期特征值的实部为负，即 $x = \\text{Re}(\\lambda)  0$。如果任何 $\\text{Re}(\\lambda) > 0$，系统是局部不稳定的，没有任何正的显式时间步长可以是稳定的，因此 $h_{\\max} = 0$。对于 $\\text{Re}(\\lambda)  0$，对 $h$ 的条件是：\n$$\nh \\leq \\frac{-2x}{x^2+y^2} = \\frac{-2 \\text{Re}(\\lambda)}{|\\lambda|^2}\n$$\n为确保系统所有模式的稳定性，$h$ 必须对每个特征值都满足此条件。因此，最大稳定时间步长是这些界限中最严格的一个：\n$$\nh_{\\max} = \\min_{\\lambda_i : \\text{Re}(\\lambda_i)  0} \\left( \\frac{-2 \\text{Re}(\\lambda_i)}{|\\lambda_i|^2} \\right)\n$$\n\n**4. 算法步骤**\n\n对于每个测试用例，执行以下步骤：\n1.  构建网络参数 $\\mathbf{W}_1, \\mathbf{b}_1, \\mathbf{W}_2, \\mathbf{b}_2$ 和状态向量 $\\mathbf{Y}$ 的 NumPy 表示。向量的形状应为列向量。\n2.  使用推导出的解析公式计算在 $\\mathbf{Y}$ 处的雅可比矩阵 $\\mathbf{J}$。\n3.  使用 `numpy.linalg.eigvals` 计算 $\\mathbf{J}$ 的特征值 $\\{\\lambda_i\\}$。\n4.  通过遍历特征值并应用上述推导的公式来计算 $h_{\\max}$。最小值的搜索使用无穷大作为初始值。如果任何特征值具有正实部，则将 $h_{\\max}$ 设为 0。\n5.  对于测试用例中每个指定的步长 $h$：\n    a. 形成放大矩阵 $\\mathbf{A}(h) = \\mathbf{I} + h \\mathbf{J}$。\n    b. 计算 $\\mathbf{A}(h)$ 的特征值。\n    c. 通过找到这些特征值中的最大绝对值来计算谱半径 $\\rho(\\mathbf{A}(h))$。\n    d. 如果 $\\rho(\\mathbf{A}(h)) \\leq 1$，则步长 $h$ 被认为是稳定的，否则是不稳定的。\n6.  将每个用例的结果（$h_{\\max}$ 和三个稳定性的布尔值）收集并格式化为所需的最终输出字符串。",
            "answer": "[[2.00832e-3, true, true, false], [0.187318, true, true, true], [3.96040e-4, true, true, false]]"
        },
        {
            "introduction": "尽管我们可以精心设计模型架构以满足守恒律，但机器学习模型在预测时仍可能产生非物理的结果，例如负浓度。直接修正这些预测（如简单地将负值截断为零）可能会破坏其他重要的守恒定律，例如元素守恒。本练习提供了一种实用的后处理方法，用于在强制执行浓度非负性的同时，修正其他物种的预测值以精确恢复元素守恒 。掌握这种校正技术对于确保在实际应用中代理模型的鲁棒性和物理真实性至关重要。",
            "id": "4037315",
            "problem": "考虑一个恒压、等温、空间均匀的反应器步骤，其中使用机器学习（ML）代理模型通过预测部分物种的浓度增量来加速化学制表。物种组成为 $\\{\\mathrm{H_2}, \\mathrm{O_2}, \\mathrm{H_2O}\\}$。设该步骤开始时的摩尔浓度为 $\\mathbf{c} = [c_{\\mathrm{H_2}}, c_{\\mathrm{O_2}}, c_{\\mathrm{H_2O}}]^{\\top} = [\\,0.03,\\, 0.20,\\, 0.01\\,]^{\\top}$，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$。ML代理模型预测此时间步的原始浓度更新量为 $\\Delta \\hat{\\mathbf{c}} = [\\,\\Delta \\hat{c}_{\\mathrm{H_2}},\\, \\Delta \\hat{c}_{\\mathrm{O_2}},\\, \\Delta \\hat{c}_{\\mathrm{H_2O}}\\,]^{\\top} = [\\,-0.08,\\,-0.04,\\,+0.08\\,]^{\\top}$，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n\n假设代理模型在其原始输出中遵循元素守恒，因此氢原子和氧原子的总数在机器精度内是守恒的。将物种映射到原子计数的元素关联矩阵为\n$$\nA \\;=\\; \\begin{bmatrix}\n2  0  2 \\\\\n0  2  1\n\\end{bmatrix},\n$$\n其中第1行是氢原子，第2行是氧原子。\n\n由于预测的更新将使 $\\mathrm{H_2}$ 浓度变为负值，通过仅裁剪 $\\mathrm{H_2}$ 的更新来强制实施正值性，使得更新后的 $\\mathrm{H_2}$ 浓度恰好为零，即，设置 $\\Delta c_{\\mathrm{H_2}} = -c_{\\mathrm{H_2}}$，而 $\\Delta c_{\\mathrm{O_2}}$ 和 $\\Delta c_{\\mathrm{H_2O}}$ 留待校正。为了在这次裁剪后精确地恢复元素守恒，计算一个应用于剩余物种更新的校正量 $\\mathbf{x} = [\\,x_{\\mathrm{O_2}},\\, x_{\\mathrm{H_2O}}\\,]^{\\top}$，使得最终的校正满足 $A \\Delta \\mathbf{c} = \\mathbf{0}$，其中 $\\Delta \\mathbf{c} = [\\,\\Delta c_{\\mathrm{H_2}},\\, \\Delta \\hat{c}_{\\mathrm{O_2}} + x_{\\mathrm{O_2}},\\, \\Delta \\hat{c}_{\\mathrm{H_2O}} + x_{\\mathrm{H_2O}}\\,]^{\\top}$。\n\n仅使用陈述的物理定律和定义（浓度的非负性和元素守恒），确定在应用正值性裁剪和守恒校正后的校正氧气浓度 $c_{\\mathrm{O_2}}^{\\mathrm{new}} = c_{\\mathrm{O_2}} + \\Delta \\hat{c}_{\\mathrm{O_2}} + x_{\\mathrm{O_2}}$。以 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$ 为单位表示你的最终答案，并四舍五入到四位有效数字。",
            "solution": "问题要求我们确定在一个两步校正过程之后氧气的最终浓度 $c_{\\mathrm{O_2}}^{\\mathrm{new}}$，该过程应用于机器学习模型预测的原始浓度更新。这两个步骤是：首先，通过裁剪强制浓度的非负性；其次，通过对剩余物种应用校正来恢复元素守恒。\n\n首先，我们重申给定的条件。\n物种为 $\\mathrm{H_2}$、$\\mathrm{O_2}$ 和 $\\mathrm{H_2O}$。\n初始摩尔浓度由向量 $\\mathbf{c}$ 给出：\n$$\n\\mathbf{c} = \\begin{bmatrix} c_{\\mathrm{H_2}} \\\\ c_{\\mathrm{O_2}} \\\\ c_{\\mathrm{H_2O}} \\end{bmatrix} = \\begin{bmatrix} 0.03 \\\\ 0.20 \\\\ 0.01 \\end{bmatrix} \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\nML代理模型预测的原始浓度更新量由向量 $\\Delta \\hat{\\mathbf{c}}$ 给出：\n$$\n\\Delta \\hat{\\mathbf{c}} = \\begin{bmatrix} \\Delta \\hat{c}_{\\mathrm{H_2}} \\\\ \\Delta \\hat{c}_{\\mathrm{O_2}} \\\\ \\Delta \\hat{c}_{\\mathrm{H_2O}} \\end{bmatrix} = \\begin{bmatrix} -0.08 \\\\ -0.04 \\\\ 0.08 \\end{bmatrix} \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\n元素关联矩阵 $A$ 将物种浓度映射到原子浓度（第1行：H，第2行：O）：\n$$\nA = \\begin{bmatrix} 2  0  2 \\\\ 0  2  1 \\end{bmatrix}\n$$\n问题陈述原始更新量 $\\Delta \\hat{\\mathbf{c}}$ 守恒元素，意味着 $A \\Delta \\hat{\\mathbf{c}} = \\mathbf{0}$。\n\n第一步是强制正值性。预测的 $\\mathrm{H_2}$ 浓度将是 $c_{\\mathrm{H_2}} + \\Delta \\hat{c}_{\\mathrm{H_2}} = 0.03 + (-0.08) = -0.05 \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}$。由于这是不符合物理实际的，$\\mathrm{H_2}$ 的更新被裁剪，使得 $\\mathrm{H_2}$ 的最终浓度恰好为零。因此，裁剪后的更新量 $\\Delta c_{\\mathrm{H_2}}$ 为：\n$$\n\\Delta c_{\\mathrm{H_2}} = -c_{\\mathrm{H_2}} = -0.03 \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\n这个裁剪操作违反了元素守恒。为了恢复它，我们引入一个校正向量 $\\mathbf{x} = [\\,x_{\\mathrm{O_2}},\\, x_{\\mathrm{H_2O}}\\,]^{\\top}$，该向量应用于其他物种的更新。最终的、校正后的浓度更新向量 $\\Delta \\mathbf{c}$ 是：\n$$\n\\Delta \\mathbf{c} = \\begin{bmatrix} \\Delta c_{\\mathrm{H_2}} \\\\ \\Delta \\hat{c}_{\\mathrm{O_2}} + x_{\\mathrm{O_2}} \\\\ \\Delta \\hat{c}_{\\mathrm{H_2O}} + x_{\\mathrm{H_2O}} \\end{bmatrix} = \\begin{bmatrix} -0.03 \\\\ -0.04 + x_{\\mathrm{O_2}} \\\\ 0.08 + x_{\\mathrm{H_2O}} \\end{bmatrix}\n$$\n这个最终的更新向量必须满足元素守恒定律，$A \\Delta \\mathbf{c} = \\mathbf{0}$。我们可以将其写成一个线性方程组：\n$$\n\\begin{bmatrix} 2  0  2 \\\\ 0  2  1 \\end{bmatrix}\n\\begin{bmatrix} -0.03 \\\\ -0.04 + x_{\\mathrm{O_2}} \\\\ 0.08 + x_{\\mathrm{H_2O}} \\end{bmatrix}\n= \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}\n$$\n这给了我们两个关于两个未知数 $x_{\\mathrm{O_2}}$ 和 $x_{\\mathrm{H_2O}}$ 的方程。\n\n第一行对应于氢原子的守恒：\n$$\n2(-0.03) + 0(-0.04 + x_{\\mathrm{O_2}}) + 2(0.08 + x_{\\mathrm{H_2O}}) = 0\n$$\n$$\n-0.06 + 0.16 + 2x_{\\mathrm{H_2O}} = 0\n$$\n$$\n0.10 + 2x_{\\mathrm{H_2O}} = 0\n$$\n$$\n2x_{\\mathrm{H_2O}} = -0.10 \\implies x_{\\mathrm{H_2O}} = -0.05\n$$\n第二行对应于氧原子的守恒：\n$$\n0(-0.03) + 2(-0.04 + x_{\\mathrm{O_2}}) + 1(0.08 + x_{\\mathrm{H_2O}}) = 0\n$$\n$$\n-0.08 + 2x_{\\mathrm{O_2}} + 0.08 + x_{\\mathrm{H_2O}} = 0\n$$\n$$\n2x_{\\mathrm{O_2}} + x_{\\mathrm{H_2O}} = 0\n$$\n代入我们找到的 $x_{\\mathrm{H_2O}}$ 的值：\n$$\n2x_{\\mathrm{O_2}} + (-0.05) = 0\n$$\n$$\n2x_{\\mathrm{O_2}} = 0.05 \\implies x_{\\mathrm{O_2}} = 0.025\n$$\n所以，氧气更新的校正量是 $x_{\\mathrm{O_2}} = 0.025 \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}$。\n\n问题要求的是最终校正后的氧气浓度 $c_{\\mathrm{O_2}}^{\\mathrm{new}}$。这可以通过将校正后的更新量加到初始浓度上来计算：\n$$\nc_{\\mathrm{O_2}}^{\\mathrm{new}} = c_{\\mathrm{O_2}} + \\Delta c_{\\mathrm{O_2}} = c_{\\mathrm{O_2}} + (\\Delta \\hat{c}_{\\mathrm{O_2}} + x_{\\mathrm{O_2}})\n$$\n代入数值：\n$$\nc_{\\mathrm{O_2}}^{\\mathrm{new}} = 0.20 + (-0.04 + 0.025)\n$$\n$$\nc_{\\mathrm{O_2}}^{\\mathrm{new}} = 0.20 - 0.015\n$$\n$$\nc_{\\mathrm{O_2}}^{\\mathrm{new}} = 0.185 \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n0.1850 \\, \\mathrm{mol}\\,\\mathrm{m}^{-3}\n$$",
            "answer": "$$\n\\boxed{0.1850}\n$$"
        }
    ]
}