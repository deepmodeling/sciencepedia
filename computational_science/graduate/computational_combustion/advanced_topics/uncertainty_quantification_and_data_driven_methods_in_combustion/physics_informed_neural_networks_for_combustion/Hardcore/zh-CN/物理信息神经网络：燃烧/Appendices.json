{
    "hands_on_practices": [
        {
            "introduction": "物理信息神经网络（PINN）的核心是一个深度神经网络。在为复杂的燃烧问题设计PINN时，选择合适的网络架构至关重要。本练习  旨在通过一个实际的燃烧应用场景，帮助您掌握计算PINN模型参数量的基本技能，从而更好地理解模型容量、计算成本和架构设计之间的权衡。",
            "id": "4049974",
            "problem": "考虑一个物理信息神经网络（Physics-Informed Neural Network, PINN），用于在低马赫数、恒定压力假设下，近似计算燃烧学中的反应流场。该网络接收空间坐标、时间、压力和当量比作为输入，这些输入组合成维度为 $d_{\\mathrm{in}} = 6$ 的特征向量 $\\mathbf{x} = (x, y, z, t, p, \\phi)$。输出是温度场 $T(\\mathbf{x})$ 和 $N_s = 9$ 种化学组分的质量分数 $\\{Y_i(\\mathbf{x})\\}_{i=1}^{N_s}$。该网络使用一个共享主干，以及用于各组分的特定头和用于温度的单独的头。其架构具体如下：\n\n- 共享主干：一个全连接多层感知机（Multi-Layer Perceptron, MLP），拥有三个宽度分别为 $64$、$64$ 和 $64$ 的隐藏层，之后是一个宽度为 $128$ 的潜输出层。因此，该主干依次由线性映射 $6 \\to 64$、$64 \\to 64$、$64 \\to 64$ 和 $64 \\to 128$ 组成。所有线性层都包含偏置，且激活函数是无参数的。\n- 温度头：一个全连接头，将宽度为 $128$ 的主干潜向量映射到标量 $T$。它有两个宽度分别为 $64$ 和 $32$ 的隐藏层，之后是一个输出层。因此，温度头由线性映射 $128 \\to 64$、$64 \\to 32$ 和 $32 \\to 1$ 组成，每个线性层都带有偏置。\n- 组分头：有 $N_s = 9$ 个组分特定的头，每个头都将宽度为 $128$ 的主干潜向量映射到标量 $Y_i$。每个头有一个宽度为 $32$ 的隐藏层，之后是一个输出层。每个组分头由线性映射 $128 \\to 32$ 和 $32 \\to 1$ 组成，每个线性层都带有偏置。所有 $N_s$ 个头具有相同的架构，但参数不同。\n\n假设没有额外的参数化层（例如，没有批归一化或残差参数化），并且激活函数以及损失函数中使用的任何物理算子（控制方程残差、边界条件和积分约束）都不引入可训练参数。计算该 PINN 中可训练参数的总数，包括共享主干和所有头中的所有权重和偏置。\n\n将最终答案表示为单个整数。无需四舍五入，也无物理单位。",
            "solution": "问题要求计算一个指定的物理信息神经网络（PINN）中可训练参数的总数。在一个标准的多层感知机（MLP）中，可训练参数由权重和偏置组成。对于一个将维度为 $n_{\\text{in}}$ 的输入映射到维度为 $n_{\\text{out}}$ 的输出的全连接线性层，其权重数量由乘积 $n_{\\text{in}} \\times n_{\\text{out}}$ 给出，偏置数量为 $n_{\\text{out}}$，因为每个输出神经元都有一个偏置项。因此，这样一个层的总参数数量为 $(n_{\\text{in}} \\times n_{\\text{out}}) + n_{\\text{out}}$。\n\n该网络架构由三个不同的部分组成：一个共享主干、一个单独的温度头和 $N_s = 9$ 个组分特定的头。我们将依次计算每个部分的参数数量，然后将它们相加得到总数。\n\n令 $N_{\\text{params}}$ 表示可训练参数的数量。\n\n1.  **共享主干参数**\n    共享主干处理维度为 $d_{\\text{in}} = 6$ 的输入向量 $\\mathbf{x}$。它由四个连续的全连接层组成。\n    -   第 $1$ 层：将输入维度 $n_{\\text{in}} = 6$ 映射到输出维度 $n_{\\text{out}} = 64$。\n        $N_{\\text{trunk},1} = (6 \\times 64) + 64 = 384 + 64 = 448$。\n    -   第 $2$ 层：将输入维度 $n_{\\text{in}} = 64$ 映射到输出维度 $n_{\\text{out}} = 64$。\n        $N_{\\text{trunk},2} = (64 \\times 64) + 64 = 4096 + 64 = 4160$。\n    -   第 $3$ 层：将输入维度 $n_{\\text{in}} = 64$ 映射到输出维度 $n_{\\text{out}} = 64$。\n        $N_{\\text{trunk},3} = (64 \\times 64) + 64 = 4096 + 64 = 4160$。\n    -   第 $4$ 层（潜输出层）：将输入维度 $n_{\\text{in}} = 64$ 映射到输出维度 $n_{\\text{out}} = 128$。\n        $N_{\\text{trunk},4} = (64 \\times 128) + 128 = 8192 + 128 = 8320$。\n\n    共享主干中的总参数数量 $N_{\\text{trunk}}$ 是其各层参数的总和：\n    $$N_{\\text{trunk}} = N_{\\text{trunk},1} + N_{\\text{trunk},2} + N_{\\text{trunk},3} + N_{\\text{trunk},4} = 448 + 4160 + 4160 + 8320 = 17088$$\n\n2.  **温度头参数**\n    温度头将来自主干的 $128$ 维潜向量作为其输入。它有三个全连接层。\n    -   第 $1$ 层：将输入维度 $n_{\\text{in}} = 128$ 映射到输出维度 $n_{\\text{out}} = 64$。\n        $N_{T,1} = (128 \\times 64) + 64 = 8192 + 64 = 8256$。\n    -   第 $2$ 层：将输入维度 $n_{\\text{in}} = 64$ 映射到输出维度 $n_{\\text{out}} = 32$。\n        $N_{T,2} = (64 \\times 32) + 32 = 2048 + 32 = 2080$。\n    -   第 $3$ 层（输出层）：将输入维度 $n_{\\text{in}} = 32$ 映射到维度为 $n_{\\text{out}} = 1$ 的标量输出。\n        $N_{T,3} = (32 \\times 1) + 1 = 32 + 1 = 33$。\n\n    温度头中的总参数数量 $N_{T}$ 是其各层参数的总和：\n    $$N_{T} = N_{T,1} + N_{T,2} + N_{T,3} = 8256 + 2080 + 33 = 10369$$\n\n3.  **组分头参数**\n    有 $N_s = 9$ 个组分特定的头。每个头具有相同的架构但参数不同。每个头将来自主干的 $128$ 维潜向量作为输入，并由两个全连接层组成。我们首先计算单个组分头 $N_{Y_i}$ 的参数。\n    -   第 $1$ 层：将输入维度 $n_{\\text{in}} = 128$ 映射到输出维度 $n_{\\text{out}} = 32$。\n        $N_{Y_i,1} = (128 \\times 32) + 32 = 4096 + 32 = 4128$。\n    -   第 $2$ 层（输出层）：将输入维度 $n_{\\text{in}} = 32$ 映射到维度为 $n_{\\text{out}} = 1$ 的标量输出。\n        $N_{Y_i,2} = (32 \\times 1) + 1 = 32 + 1 = 33$。\n\n    单个组分头的总参数数量为：\n    $$N_{Y_i} = N_{Y_i,1} + N_{Y_i,2} = 4128 + 33 = 4161$$\n    由于有 $N_s = 9$ 个这样的头，所有组分头的总参数数量 $N_{\\text{species}}$ 为：\n    $$N_{\\text{species}} = N_s \\times N_{Y_i} = 9 \\times 4161 = 37449$$\n\n4.  **网络总参数**\n    整个 PINN 中可训练参数的总数 $N_{\\text{total}}$ 是主干、温度头和所有组分头参数的总和。\n    $$N_{\\text{total}} = N_{\\text{trunk}} + N_{T} + N_{\\text{species}}$$\n    $$N_{\\text{total}} = 17088 + 10369 + 37449$$\n    $$N_{\\text{total}} = 64906$$",
            "answer": "$$\\boxed{64906}$$"
        },
        {
            "introduction": "PINN的“物理信息”来源于其需要遵守的控制方程和物理定律。本练习  将引导您应用热力学中的理想气体状态方程来分析一个一维预混火焰模型。通过这个练习，您将深入理解如何将基本的物理原理（如状态方程和组分性质）整合到燃烧问题的分析中，这是构建和验证PINN物理约束的关键一步。",
            "id": "4049991",
            "problem": "一个物理信息神经网络 (PINN) 被训练来近似一维、稳态、化学计量、预混甲烷-空气火焰在低马赫数、等压状态下的热化学场。空间坐标为 $x \\in [0,L]$，其中 $L = 5.0 \\times 10^{-3}\\ \\mathrm{m}$。PINN 预测温度场 $T(x)$ 和组分集合 $\\mathcal{S} = \\{\\mathrm{CH_4}, \\mathrm{O_2}, \\mathrm{N_2}, \\mathrm{CO_2}, \\mathrm{H_2O}\\}$ 的组分质量分数 $Y_k(x)$，并在其损失函数中将理想气体混合物状态方程 $p(x) = \\rho(x)\\,R(x)\\,T(x)$ 以及等压约束 $\\partial p/\\partial x = 0$ 作为软物理约束强制执行。普适气体常数为 $R_u = 8.314462618\\ \\mathrm{J}\\ \\mathrm{mol}^{-1}\\ \\mathrm{K}^{-1}$，各组分的摩尔质量（单位为 $\\mathrm{kg}\\ \\mathrm{mol}^{-1}$）为 $W_{\\mathrm{CH_4}} = 0.01604276$，$W_{\\mathrm{O_2}} = 0.0319988$，$W_{\\mathrm{N_2}} = 0.0280134$，$W_{\\mathrm{CO_2}} = 0.0440098$ 以及 $W_{\\mathrm{H_2O}} = 0.01801528$。PINN 预测的温度被建模为 $T(x) = T_u + \\left(T_b - T_u\\right)s(x)$，其中 $T_u = 300\\ \\mathrm{K}$，$T_b = 2200\\ \\mathrm{K}$，平滑反应进程变量为 $s(x) = \\tfrac{1}{2}\\left(1 + \\tanh\\left((x - x_f)/\\delta\\right)\\right)$，其中 $x_f = 2.5 \\times 10^{-3}\\ \\mathrm{m}$ 且 $\\delta = 5.0 \\times 10^{-4}\\ \\mathrm{m}$。组分质量分数为\n$$\nY_{\\mathrm{N_2}}(x) = Y_{\\mathrm{N_2},u},\\quad\nY_{\\mathrm{CH_4}}(x) = Y_{\\mathrm{CH_4},u}\\left(1 - s(x)\\right),\\quad\nY_{\\mathrm{O_2}}(x) = Y_{\\mathrm{O_2},u}\\left(1 - s(x)\\right),\n$$\n$$\nY_{\\mathrm{CO_2}}(x) = Y_{\\mathrm{CO_2},b}\\,s(x),\\quad\nY_{\\mathrm{H_2O}}(x) = Y_{\\mathrm{H_2O},b}\\,s(x),\n$$\n其中化学计量的甲烷-空气值为\n$$\nY_{\\mathrm{CH_4},u} = \\frac{16.04276}{290.70116},\\quad\nY_{\\mathrm{O_2},u} = \\frac{63.9976}{290.70116},\\quad\nY_{\\mathrm{N_2},u} = \\frac{210.6608}{290.70116},\n$$\n$$\nY_{\\mathrm{CO_2},b} = \\frac{44.0098}{290.70116},\\quad\nY_{\\mathrm{H_2O},b} = \\frac{36.03056}{290.70116}.\n$$\n这些选择确保对于所有 $x$，都有 $Y_{\\mathrm{CH_4}}(x) + Y_{\\mathrm{O_2}}(x) + Y_{\\mathrm{CO_2}}(x) + Y_{\\mathrm{H_2O}}(x) + Y_{\\mathrm{N_2}}(x) = 1$。局部混合气体常数由理想气体混合物关系 $R(x) = \\sum_{k \\in \\mathcal{S}} Y_k(x)\\,R_k$ 定义，其中 $R_k = R_u/W_k$。\n\n在冷态流入边界 $x = 0$ 处，一次独立测量提供了密度 $ \\rho(0) = 1.122\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。仅使用基本理想气体混合物定律、以组分质量分数表示的混合气体常数定义以及等压约束，推导出 $R(x)$ 关于 $\\{Y_k\\}$ 和 $\\{R_k\\}$ 的表达式，证明为什么 $p(x)$ 必须在空间上是均匀的，并计算该均匀压力 $p$。以 $\\mathrm{kPa}$ 为单位表示最终压力，并将您的答案四舍五入到四位有效数字。最终答案必须是一个实数。",
            "solution": "该问题要求做三件事：首先，推导混合气体常数 $R(x)$ 的表达式；其次，证明压力 $p(x)$ 在空间上是均匀的；第三，计算这个均匀压力。\n\n首先，混合气体常数 $R(x)$ 是局部组分的函数，其定义为 $R(x) = \\sum_{k \\in \\mathcal{S}} Y_k(x) R_k$，其中 $Y_k(x)$ 是组分 $k$ 的质量分数，$R_k = R_u/W_k$ 是其比气体常数。这与基于平均摩尔质量 $W_{\\text{mix}}(x)$ 的基本定义 $R(x) = R_u/W_{\\text{mix}}(x)$ 是一致的，因为平均摩尔质量由 $1/W_{\\text{mix}}(x) = \\sum_k Y_k(x)/W_k$ 定义。因此，我们可以写出：\n$$\n\\sum_{k \\in \\mathcal{S}} Y_k(x) R_k = \\sum_{k \\in \\mathcal{S}} Y_k(x) \\frac{R_u}{W_k} = R_u \\sum_{k \\in \\mathcal{S}} \\frac{Y_k(x)}{W_k} = R_u \\left(\\frac{1}{W_{\\text{mix}}(x)}\\right) = R(x)\n$$\n这证实了所提供的表达式的有效性。\n\n其次，问题陈述该系统在“等压状态”下建模，并且施加了软约束 $\\partial p/\\partial x = 0$。在其定义域上导数为零的函数必定是常数。将此条件对空间坐标 $x$ 从一个参考点（例如，$x=0$）到一个任意点 $x$ 进行积分，得到：\n$$\n\\int_0^x \\frac{\\mathrm{d}p}{\\mathrm{d}x'} \\mathrm{d}x' = \\int_0^x 0 \\, \\mathrm{d}x' \\implies p(x) - p(0) = 0 \\implies p(x) = p(0)\n$$\n这证明了压力 $p$ 在空间上是均匀的，即 $p(x) = p = \\text{const}$。对于低速、非封闭的燃烧现象，这是一个标准且高度准确的近似，其中由流体运动引起的压力变化与绝对热力学压力相比可以忽略不计。\n\n第三，我们计算这个均匀压力的值。根据理想气体混合物状态方程，$p = \\rho(x) R(x) T(x)$。由于 $p$ 是常数，我们可以在任何方便的点上计算它。问题提供了冷态边界处的密度，$\\rho(0) = 1.122\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，因此我们将在 $x=0$ 处计算所有量。\n$$\np = \\rho(0) R(0) T(0)\n$$\n我们需要计算混合气体常数 $R(0)$ 和温度 $T(0)$。\n在 $x=0$ 处的混合气体常数，记作 $R(0)$，取决于局部的质量分数 $Y_k(0)$。质量分数是反应进程变量 $s(x)$ 在 $x=0$ 处求值的结果。\n$s(0) = \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{0 - x_f}{\\delta}\\right)\\right) = \\frac{1}{2}\\left(1 - \\tanh\\left(\\frac{x_f}{\\delta}\\right)\\right)$。\n其中 $x_f = 2.5 \\times 10^{-3}\\ \\mathrm{m}$ 且 $\\delta = 5.0 \\times 10^{-4}\\ \\mathrm{m}$，比值为 $x_f/\\delta = 5$。\n$s(0) = \\frac{1}{2}\\left(1 - \\tanh(5)\\right)$。\n\n气体常数为 $R(x) = R_u / W_{\\text{mix}}(x)$，其中 $1/W_{\\text{mix}}(x) = \\sum_k Y_k(x)/W_k$。让我们分析这一项：\n$$\n\\frac{1}{W_{\\text{mix}}(x)} = \\frac{Y_{\\mathrm{N_2}}(x)}{W_{\\mathrm{N_2}}} + \\frac{Y_{\\mathrm{CH_4}}(x)}{W_{\\mathrm{CH_4}}} + \\frac{Y_{\\mathrm{O_2}}(x)}{W_{\\mathrm{O_2}}} + \\frac{Y_{\\mathrm{CO_2}}(x)}{W_{\\mathrm{CO_2}}} + \\frac{Y_{\\mathrm{H_2O}}(x)}{W_{\\mathrm{H_2O}}}\n$$\n代入给定的 $Y_k(x)$ 表达式：\n$$\n\\frac{1}{W_{\\text{mix}}(x)} = \\frac{Y_{\\mathrm{N_2},u}}{W_{\\mathrm{N_2}}} + (1-s(x))\\frac{Y_{\\mathrm{CH_4},u}}{W_{\\mathrm{CH_4}}} + (1-s(x))\\frac{Y_{\\mathrm{O_2},u}}{W_{\\mathrm{O_2}}} + s(x)\\frac{Y_{\\mathrm{CO_2},b}}{W_{\\mathrm{CO_2}}} + s(x)\\frac{Y_{\\mathrm{H_2O},b}}{W_{\\mathrm{H_2O}}}\n$$\n让我们计算这些项 $Y_k/W_k$：\n$Y_{\\mathrm{CH_4},u}/W_{\\mathrm{CH_4}} = \\frac{16.04276/290.70116}{0.01604276} = \\frac{1000}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}$\n$Y_{\\mathrm{O_2},u}/W_{\\mathrm{O_2}} = \\frac{63.9976/290.70116}{0.0319988} = \\frac{2000}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}$\n$Y_{\\mathrm{N_2},u}/W_{\\mathrm{N_2}} = \\frac{210.6608/290.70116}{0.0280134} = \\frac{7520}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}$\n$Y_{\\mathrm{CO_2},b}/W_{\\mathrm{CO_2}} = \\frac{44.0098/290.70116}{0.0440098} = \\frac{1000}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}$\n$Y_{\\mathrm{H_2O},b}/W_{\\mathrm{H_2O}} = \\frac{36.03056/290.70116}{0.01801528} = \\frac{2000}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}$\n未燃侧反应物种项之和为 $\\frac{1000+2000}{290.70116} = \\frac{3000}{290.70116}$。已燃侧之和为 $\\frac{1000+2000}{290.70116} = \\frac{3000}{290.70116}$。由于该特定化学计量的总摩尔数守恒，这两者相等。设 $S_{\\text{react}} = \\frac{3000}{290.70116}$。\n那么，\n$$\n\\frac{1}{W_{\\text{mix}}(x)} = \\frac{Y_{\\mathrm{N_2},u}}{W_{\\mathrm{N_2}}} + (1-s(x))S_{\\text{react}} + s(x)S_{\\text{react}} = \\frac{Y_{\\mathrm{N_2},u}}{W_{\\mathrm{N_2}}} + S_{\\text{react}}\n$$\n这证明了 $W_{\\text{mix}}$ 以及因此的 $R = R_u/W_{\\text{mix}}$ 在整个火焰中是常数，与 $x$ 无关。我们可以计算 $R$ 的值：\n$$\n\\frac{1}{W_{\\text{mix}}} = \\frac{7520}{290.70116} + \\frac{3000}{290.70116} = \\frac{10520}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}\n$$\n$$\nR = R_u \\left(\\frac{10520}{290.70116}\\right) = (8.314462618\\ \\mathrm{J}\\ \\mathrm{mol}^{-1}\\ \\mathrm{K}^{-1}) \\left(\\frac{10520}{290.70116}\\ \\mathrm{mol}\\ \\mathrm{kg}^{-1}\\right) \\approx 300.933\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}\n$$\n接下来，我们计算在 $x=0$ 处的温度：\n$$\nT(0) = T_u + (T_b - T_u)s(0) = 300\\ \\mathrm{K} + (2200 - 300)\\ \\mathrm{K} \\cdot \\frac{1}{2}\\left(1 - \\tanh(5)\\right)\n$$\n$$\nT(0) = 300 + 1900 \\cdot \\frac{1}{2}\\left(1 - \\tanh(5)\\right) = 300 + 950 \\left(1 - \\frac{\\exp(10)-1}{\\exp(10)+1}\\right) = 300 + 950 \\left(\\frac{2}{\\exp(10)+1}\\right)\n$$\n使用计算器，$\\tanh(5) \\approx 0.999909204$。\n$T(0) \\approx 300 + 950(1 - 0.999909204) \\approx 300 + 950(0.000090796) \\approx 300 + 0.086256 \\approx 300.086\\ \\mathrm{K}$。\n\n最后，我们计算压力 $p$：\n$$\np = \\rho(0) R T(0)\n$$\n$$\np = (1.122\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}) \\times \\left(8.314462618 \\cdot \\frac{10520}{290.70116}\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}\\right) \\times \\left(300 + 950(1 - \\tanh(5))\\ \\mathrm{K}\\right)\n$$\n进行数值计算：\n$R \\approx 300.93297\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n$T(0) \\approx 300.08626\\ \\mathrm{K}$\n$p \\approx 1.122 \\times 300.93297 \\times 300.08626 \\approx 101324.9\\ \\mathrm{Pa}$\n\n为了用千帕（kPa）表示，我们除以 $1000$：\n$p \\approx 101.3249\\ \\mathrm{kPa}$\n四舍五入到四位有效数字得到 $101.3\\ \\mathrm{kPa}$。",
            "answer": "$$\\boxed{101.3}$$"
        },
        {
            "introduction": "在实际应用中，测量数据和物理模型都可能存在误差和不确定性。因此，如何明智地平衡PINN损失函数中的数据项和物理项，是一个核心挑战。本练习  通过一个简化的偏置-方差分析模型，从理论上探讨了这一问题。您将推导出最小化总预测误差的最佳权重比，这对于在数据同化和混合建模中实现稳健和准确的预测至关重要。",
            "id": "4050006",
            "problem": "考虑在燃烧模拟中为单个时空配置点训练一个物理信息神经网络（PINN, Physics-Informed Neural Network），其中目标标量状态表示为 $u^{\\ast}$。训练损失结合了数据失配项和物理残差项。假设物理残差在最优点附近的局部线性化产生一个斜率为 $c \\gt 0$ 的线性残差，并假设数据和物理信息都带有噪声且可能存在偏差。\n\n数据和物理信息建模如下：\n- 数据测量值为 $y_{d} = u^{\\ast} + \\varepsilon_{d}$，其中 $\\mathbb{E}[\\varepsilon_{d}] = 0$ 且 $\\operatorname{Var}(\\varepsilon_{d}) = \\sigma_{d}^{2}$。\n- 物理锚点为 $y_{p} = u^{\\ast} + b_{p} + \\varepsilon_{p}$，其中 $\\mathbb{E}[\\varepsilon_{p}] = 0$，$\\operatorname{Var}(\\varepsilon_{p}) = \\sigma_{p}^{2}$，以及确定性偏差 $b_{p} \\in \\mathbb{R}$，该偏差量化了燃烧物理中可能的模型形式误差（例如，由于不完美的封闭项）。\n\n该点的标量训练损失为\n$$\nL(u) = w_{d}\\,(u - y_{d})^{2} + w_{p}\\,\\big(r(u)\\big)^{2}, \\quad r(u) = c\\,(u - y_{p}),\n$$\n其中权重 $w_{d} \\ge 0$ 和 $w_{p} \\ge 0$ 控制数据和物理之间的平衡。所有量纲均为一。$L(u)$ 的最小化子 $u^{\\star}$ 是该点的 PINN 估计量。\n\n任务：\n1. 从偏差 $\\operatorname{Bias}(u^{\\star}) = \\mathbb{E}[u^{\\star}] - u^{\\ast}$ 和方差 $\\operatorname{Var}(u^{\\star})$ 的定义出发，推导出期望均方误差 $\\operatorname{MSE}(u^{\\star}) = \\operatorname{Bias}(u^{\\star})^{2} + \\operatorname{Var}(u^{\\star})$，使其成为 $w_{d}$、$w_{p}$、$c$、$\\sigma_{d}^{2}$、$\\sigma_{p}^{2}$ 和 $b_{p}$ 的函数。证明对于固定的 $c \\gt 0$，最小化 $\\operatorname{MSE}(u^{\\star})$ 的最优比率\n$$\nr_{\\text{opt}} = \\frac{w_{d}}{w_{p}\\,c^{2}}\n$$\n满足\n$$\nr_{\\text{opt}} = \\frac{b_{p}^{2} + \\sigma_{p}^{2}}{\\sigma_{d}^{2}},\n$$\n并以闭合形式推导出相应的最小化期望均方误差 $\\operatorname{MSE}_{\\min}$。\n\n2. 实现一个程序，给定一组测试用例，计算 $r_{\\text{opt}}$ 和 $\\operatorname{MSE}_{\\min}$。仅使用上述假设，不要引入额外的建模捷径。\n\n使用以下测试套件，其中每个测试用例是一个元组 $(\\sigma_{d}^{2}, \\sigma_{p}^{2}, b_{p}, c)$：\n- 测试用例 1 (一般情况): $(0.01, 0.02, 0.05, 1.3)$。\n- 测试用例 2 (低数据噪声，中等物理偏差/噪声): $(10^{-4}, 0.02, 0.05, 0.7)$。\n- 测试用例 3 (高数据噪声，无偏物理): $(1.0, 0.01, 0.0, 2.0)$。\n- 测试用例 4 (完美物理，中等数据噪声): $(0.5, 0.0, 0.0, 1.0)$。\n\n所有量纲均为一。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，列表必须按顺序首先包含 $r_{\\text{opt}}$，然后是 $\\operatorname{MSE}_{\\min}$。例如，格式应为\n$$\n[ r_{\\text{opt},1},\\, \\operatorname{MSE}_{\\min,1},\\, r_{\\text{opt},2},\\, \\operatorname{MSE}_{\\min,2},\\, r_{\\text{opt},3},\\, \\operatorname{MSE}_{\\min,3},\\, r_{\\text{opt},4},\\, \\operatorname{MSE}_{\\min,4} ].\n$$",
            "solution": "该问题要求为一个简化的物理信息神经网络（PINN）估计量推导最优权重比和最小均方误差，然后进行数值实现。\n\n第一步是通过最小化损失函数 $L(u)$ 来确定 PINN 估计量 $u^{\\star}$。损失函数由以下公式给出：\n$$\nL(u) = w_{d}\\,(u - y_{d})^{2} + w_{p}\\,\\big(r(u)\\big)^{2}\n$$\n代入线性化残差 $r(u) = c\\,(u - y_{p})$，损失函数变为：\n$$\nL(u) = w_{d}\\,(u - y_{d})^{2} + w_{p}\\,c^{2}\\,(u - y_{p})^{2}\n$$\n其中 $w_{d} \\ge 0$，$w_{p} \\ge 0$，且 $c > 0$。为了存在唯一最小值，我们必须有 $w_{d} + w_{p}c^2 > 0$。函数 $L(u)$ 是关于 $u$ 的二次函数，因此有唯一的最小值。我们通过将 $L(u)$ 对 $u$ 的导数设为零来找到最小化子 $u^{\\star}$：\n$$\n\\frac{dL}{du} = 2\\,w_{d}\\,(u - y_{d}) + 2\\,w_{p}\\,c^{2}\\,(u - y_{p}) = 0\n$$\n在最小值 $u=u^{\\star}$ 处求解 $u$：\n$$\nw_{d}\\,(u^{\\star} - y_{d}) + w_{p}\\,c^{2}\\,(u^{\\star} - y_{p}) = 0\n$$\n$$\nu^{\\star}(w_{d} + w_{p}\\,c^{2}) = w_{d}\\,y_{d} + w_{p}\\,c^{2}\\,y_{p}\n$$\n$$\nu^{\\star} = \\frac{w_{d}\\,y_{d} + w_{p}\\,c^{2}\\,y_{p}}{w_{d} + w_{p}\\,c^{2}}\n$$\n为了简化此表达式，我们引入比率 $r = \\frac{w_{d}}{w_{p}\\,c^{2}}$，该比率在 $w_{p}>0$ 时有定义。将分子和分母同除以 $w_{p}\\,c^{2}$：\n$$\nu^{\\star} = \\frac{r\\,y_{d} + y_{p}}{r + 1}\n$$\n这表明估计量 $u^{\\star}$ 是数据测量值 $y_{d}$ 和物理锚点 $y_{p}$ 的加权平均值。\n\n接下来，我们推导 $u^{\\star}$ 的统计特性。给定 $y_{d} = u^{\\ast} + \\varepsilon_{d}$ 和 $y_{p} = u^{\\ast} + b_{p} + \\varepsilon_{p}$，其中 $\\mathbb{E}[\\varepsilon_{d}] = 0$，$\\operatorname{Var}(\\varepsilon_{d}) = \\sigma_{d}^{2}$，$\\mathbb{E}[\\varepsilon_{p}] = 0$，以及 $\\operatorname{Var}(\\varepsilon_{p}) = \\sigma_{p}^{2}$。真实状态 $u^{\\ast}$ 和物理偏差 $b_{p}$ 是确定性的。\n\n$u^{\\star}$ 的期望值为：\n$$\n\\mathbb{E}[u^{\\star}] = \\mathbb{E}\\left[\\frac{r\\,y_{d} + y_{p}}{r + 1}\\right] = \\frac{1}{r+1} \\left( r\\,\\mathbb{E}[y_{d}] + \\mathbb{E}[y_{p}] \\right)\n$$\n$y_{d}$ 和 $y_{p}$ 的期望为：\n$$\n\\mathbb{E}[y_{d}] = \\mathbb{E}[u^{\\ast} + \\varepsilon_{d}] = u^{\\ast} + \\mathbb{E}[\\varepsilon_{d}] = u^{\\ast}\n$$\n$$\n\\mathbb{E}[y_{p}] = \\mathbb{E}[u^{\\ast} + b_{p} + \\varepsilon_{p}] = u^{\\ast} + b_{p} + \\mathbb{E}[\\varepsilon_{p}] = u^{\\ast} + b_{p}\n$$\n将这些代入 $\\mathbb{E}[u^{\\star}]$ 的表达式中：\n$$\n\\mathbb{E}[u^{\\star}] = \\frac{1}{r+1} \\left( r\\,u^{\\ast} + (u^{\\ast} + b_{p}) \\right) = \\frac{(r+1)u^{\\ast} + b_{p}}{r+1} = u^{\\ast} + \\frac{b_{p}}{r+1}\n$$\n估计量的偏差为 $\\operatorname{Bias}(u^{\\star}) = \\mathbb{E}[u^{\\star}] - u^{\\ast}$：\n$$\n\\operatorname{Bias}(u^{\\star}) = \\left(u^{\\ast} + \\frac{b_{p}}{r+1}\\right) - u^{\\ast} = \\frac{b_{p}}{r+1}\n$$\n偏差的平方为：\n$$\n\\operatorname{Bias}(u^{\\star})^{2} = \\frac{b_{p}^{2}}{(r+1)^{2}}\n$$\n估计量的方差为 $\\operatorname{Var}(u^{\\star}) = \\mathbb{E}[(u^{\\star} - \\mathbb{E}[u^{\\star}])^{2}]$。假设噪声项 $\\varepsilon_{d}$ 和 $\\varepsilon_{p}$ 在统计上是独立的，那么 $y_{d}$ 和 $y_{p}$ 也是独立的。\n$$\n\\operatorname{Var}(u^{\\star}) = \\operatorname{Var}\\left(\\frac{r\\,y_{d} + y_{p}}{r + 1}\\right) = \\frac{1}{(r+1)^{2}} \\operatorname{Var}(r\\,y_{d} + y_{p})\n$$\n$$\n\\operatorname{Var}(u^{\\star}) = \\frac{1}{(r+1)^{2}} \\left( r^{2}\\operatorname{Var}(y_{d}) + \\operatorname{Var}(y_{p}) \\right)\n$$\n$y_{d}$ 和 $y_{p}$ 的方差为：\n$$\n\\operatorname{Var}(y_{d}) = \\operatorname{Var}(u^{\\ast} + \\varepsilon_{d}) = \\operatorname{Var}(\\varepsilon_{d}) = \\sigma_{d}^{2}\n$$\n$$\n\\operatorname{Var}(y_{p}) = \\operatorname{Var}(u^{\\ast} + b_{p} + \\varepsilon_{p}) = \\operatorname{Var}(\\varepsilon_{p}) = \\sigma_{p}^{2}\n$$\n将这些代入 $\\operatorname{Var}(u^{\\star})$ 的表达式中：\n$$\n\\operatorname{Var}(u^{\\star}) = \\frac{r^{2}\\sigma_{d}^{2} + \\sigma_{p}^{2}}{(r+1)^{2}}\n$$\n期望均方误差（$\\operatorname{MSE}$）是偏差平方和方差之和：\n$$\n\\operatorname{MSE}(u^{\\star}) = \\operatorname{Bias}(u^{\\star})^{2} + \\operatorname{Var}(u^{\\star}) = \\frac{b_{p}^{2}}{(r+1)^{2}} + \\frac{r^{2}\\sigma_{d}^{2} + \\sigma_{p}^{2}}{(r+1)^{2}}\n$$\n$$\n\\operatorname{MSE}(u^{\\star}) = \\frac{r^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2}}{(r+1)^{2}}\n$$\n为了找到最小化 $\\operatorname{MSE}$ 的最优比率 $r_{\\text{opt}}$，我们将 $\\operatorname{MSE}(u^{\\star})$ 对 $r$ 求导，并将结果设为零。我们假设 $r \\ge 0$。\n$$\n\\frac{d}{dr}\\operatorname{MSE}(u^{\\star}) = \\frac{ (2r\\sigma_{d}^{2})(r+1)^{2} - (r^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2})(2(r+1)) }{((r+1)^{2})^{2}} = 0\n$$\n假设 $r+1 \\neq 0$，我们可以简化分子：\n$$\n(2r\\sigma_{d}^{2})(r+1) - 2(r^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2}) = 0\n$$\n$$\nr\\sigma_{d}^{2}(r+1) - (r^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2}) = 0\n$$\n$$\nr^{2}\\sigma_{d}^{2} + r\\sigma_{d}^{2} - r^{2}\\sigma_{d}^{2} - b_{p}^{2} - \\sigma_{p}^{2} = 0\n$$\n$$\nr\\sigma_{d}^{2} = b_{p}^{2} + \\sigma_{p}^{2}\n$$\n求解 $r$ 得到最优比率 $r_{\\text{opt}}$，假设 $\\sigma_{d}^{2} > 0$：\n$$\nr_{\\text{opt}} = \\frac{b_{p}^{2} + \\sigma_{p}^{2}}{\\sigma_{d}^{2}}\n$$\n这证实了问题陈述中提供的表达式。\n\n最后，我们将 $r_{\\text{opt}}$ 代入 $\\operatorname{MSE}(u^{\\star})$ 公式，推导出最小化期望均方误差 $\\operatorname{MSE}_{\\min}$。\n$$\n\\operatorname{MSE}_{\\min} = \\frac{r_{\\text{opt}}^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2}}{(r_{\\text{opt}}+1)^{2}}\n$$\n根据最优性条件，我们有 $b_{p}^{2} + \\sigma_{p}^{2} = r_{\\text{opt}}\\sigma_{d}^{2}$。将其代入分子：\n$$\nr_{\\text{opt}}^{2}\\sigma_{d}^{2} + b_{p}^{2} + \\sigma_{p}^{2} = r_{\\text{opt}}^{2}\\sigma_{d}^{2} + r_{\\text{opt}}\\sigma_{d}^{2} = r_{\\text{opt}}\\sigma_{d}^{2}(r_{\\text{opt}} + 1)\n$$\n所以，$\\operatorname{MSE}_{\\min}$ 变为：\n$$\n\\operatorname{MSE}_{\\min} = \\frac{r_{\\text{opt}}\\sigma_{d}^{2}(r_{\\text{opt}} + 1)}{(r_{\\text{opt}}+1)^{2}} = \\frac{r_{\\text{opt}}\\sigma_{d}^{2}}{r_{\\text{opt}}+1}\n$$\n为了获得以原始参数表示的闭合形式表达式，我们代入 $r_{\\text{opt}}$ 的表达式：\n$$\n\\operatorname{MSE}_{\\min} = \\frac{\\left(\\frac{b_{p}^{2} + \\sigma_{p}^{2}}{\\sigma_{d}^{2}}\\right)\\sigma_{d}^{2}}{\\frac{b_{p}^{2} + \\sigma_{p}^{2}}{\\sigma_{d}^{2}}+1} = \\frac{b_{p}^{2} + \\sigma_{p}^{2}}{\\frac{b_{p}^{2} + \\sigma_{p}^{2} + \\sigma_{d}^{2}}{\\sigma_{d}^{2}}}\n$$\n$$\n\\operatorname{MSE}_{\\min} = \\frac{(b_{p}^{2} + \\sigma_{p}^{2})\\sigma_{d}^{2}}{b_{p}^{2} + \\sigma_{p}^{2} + \\sigma_{d}^{2}}\n$$\n这些推导出的 $r_{\\text{opt}}$ 和 $\\operatorname{MSE}_{\\min}$ 公式将用于实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal weight ratio and minimum MSE for given PINN parameters.\n    \"\"\"\n    # The test suite, where each tuple is (sigma_d^2, sigma_p^2, b_p, c).\n    # The parameter c is not needed for the final computation but is part of the problem definition.\n    test_cases = [\n        (0.01, 0.02, 0.05, 1.3),\n        (1e-4, 0.02, 0.05, 0.7),\n        (1.0, 0.01, 0.0, 2.0),\n        (0.5, 0.0, 0.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_d_sq, sigma_p_sq, b_p, c = case\n\n        # The sum of squared physics bias and physics variance. This term represents the\n        # total squared error contribution from the physics model.\n        phys_error_sq_sum = b_p**2 + sigma_p_sq\n\n        # 1. Calculate the optimal ratio r_opt.\n        # This ratio balances the data misfit against the physics residual.\n        # It is derived by minimizing the Mean Squared Error (MSE) of the estimator.\n        # r_opt = (b_p^2 + sigma_p^2) / sigma_d^2\n        # The derivation assumes sigma_d_sq > 0, which holds for all test cases.\n        r_opt = phys_error_sq_sum / sigma_d_sq\n\n        # 2. Calculate the corresponding minimized expected mean squared error MSE_min.\n        # This is the minimum achievable MSE for the estimator u_star when the\n        # weights are chosen optimally according to r_opt.\n        # MSE_min = ((b_p^2 + sigma_p^2) * sigma_d^2) / (b_p^2 + sigma_p^2 + sigma_d^2)\n        denominator = phys_error_sq_sum + sigma_d_sq\n        \n        # This condition handles the case where both data and physics are perfect,\n        # resulting in zero error.\n        if denominator == 0:\n            mse_min = 0.0\n        else:\n            mse_min = phys_error_sq_sum * sigma_d_sq / denominator\n\n        results.append(r_opt)\n        results.append(mse_min)\n\n    # Print the final results in the specified single-line format.\n    # The output is a flat list of [r_opt_1, mse_min_1, r_opt_2, mse_min_2, ...].\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function.\nsolve()\n```"
        }
    ]
}