{
    "hands_on_practices": [
        {
            "introduction": "在可压缩反应流的数值模拟中，求解器直接推进的是守恒变量，如密度、动量和总能量。然而，为了计算化学反应速率和状态方程（EOS）中的压力，我们必须从这些守恒量中恢复出温度等热力学状态量。这个练习将指导你推导并应用一个量热非完全气体混合物的热力学关系，这是任何高保真度燃烧模拟中都不可或缺的基础步骤，它可以帮助你掌握如何处理复杂的状态方程，这是连接流体动力学和化学反应的桥梁 。",
            "id": "4077046",
            "problem": "考虑一个使用加权基本无振荡 (WENO) 有限体积格式进行时间推进的一维可压缩反应流。守恒更新需要一个与量热非完美理想气体混合物一致的热力学封闭。该混合物由氮气和氧气两种组分组成，组分质量分数分别为 $Y_{\\mathrm{N_2}} = 0.76$ 和 $Y_{\\mathrm{O_2}} = 0.24$。这些组分被建模为理想气体，其定压比热随温度变化，形式为 $c_{p,k}(T) = a_k + b_k T$，其中 $k \\in \\{\\mathrm{N_2}, \\mathrm{O_2}\\}$。参考温度为 $T_{\\mathrm{ref}} = 298 \\ \\mathrm{K}$，在 $T_{\\mathrm{ref}}$ 下的标准生成焓取为 $h_{f,\\mathrm{N_2}}(T_{\\mathrm{ref}}) = 0$ 和 $h_{f,\\mathrm{O_2}}(T_{\\mathrm{ref}}) = 0$。组分性质如下：\n- $a_{\\mathrm{N_2}} = 1000 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$，$b_{\\mathrm{N_2}} = 0.10 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$，\n- $a_{\\mathrm{O_2}} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$，$b_{\\mathrm{O_2}} = 0.15 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$，\n- $M_{\\mathrm{N_2}} = 0.0280134 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$，$M_{\\mathrm{O_2}} = 0.031998 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$，\n- $R_u = 8.314462618 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$。\n\n测得混合物的总比焓为 $h = 1.200 \\times 10^{6} \\ \\mathrm{J} \\ \\mathrm{kg}^{-1}$，混合物质量密度为 $\\rho = 0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$。\n\n从适用于理想气体燃烧模拟的组分级热力学定义和混合法则出发，完成以下任务：\n1. 对于量热非完美理想气体混合物，推导其混合物比焓 $h(T, Y_k)$ 的通用关系式，该关系式用温度 $T$、组分质量分数 $Y_k$、组分函数 $c_{p,k}(T)$、参考温度 $T_{\\mathrm{ref}}$ 和生成焓 $h_{f,k}(T_{\\mathrm{ref}})$ 表示。您的推导必须从组分焓定义和混合平均出发。\n2. 将您的结果特化到给定的线性 $c_{p,k}(T)$ 模型，并推导混合物温度 $T$ 的显式闭合形式表达式，该表达式用 $h$、$Y_k$、$a_k$、$b_k$ 和 $T_{\\mathrm{ref}}$ 表示。\n3. 从组分性质推导混合物的状态方程 (EOS) 为 $p = \\rho R_{\\mathrm{mix}}(T) T$，其中 $R_{\\mathrm{mix}}(T) = \\sum_{k} Y_k R_k$ 且 $R_k = R_u / M_k$，并对给定混合物的 $R_{\\mathrm{mix}}$ 进行数值评估。使用此 $R_{\\mathrm{mix}}$ 计算混合物压力 $p$。\n\n最终温度以 $\\mathrm{K}$ 为单位， $R_{\\mathrm{mix}}$ 以 $\\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$ 为单位， $p$ 以 $\\mathrm{Pa}$ 为单位表示。将您的数值答案四舍五入到四位有效数字。将您的最终结果报告为一个单行矩阵，按顺序包含混合物温度 $T$、混合物气体常数 $R_{\\mathrm{mix}}$ 和压力 $p$。",
            "solution": "用户提供了一个在热力学和计算燃烧模拟领域中定义明确且具有科学依据的问题。该问题经过验证，因为它包含一套完整且一致的给定条件，基于已建立的物理化学原理，并且其结构保证了唯一且有意义的解。我们按要求分三部分进行求解。\n\n### 第1部分：混合物比焓的通用关系式\n\n单一组分 $k$ 在温度 $T$ 下的绝对比焓是相对于其在参考温度 $T_{\\mathrm{ref}}$ 下的标准态来定义的。它是在 $T_{\\mathrm{ref}}$ 下的标准生成焓 $h_{f,k}(T_{\\mathrm{ref}})$ 与从 $T_{\\mathrm{ref}}$ 到 $T$ 的显焓变化之和。显焓通过对组分的定压比热 $c_{p,k}(T)$ 在温度范围内积分计算得出。\n组分 $k$ 的比焓定义为：\n$$\nh_k(T) = h_{f,k}(T_{\\mathrm{ref}}) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT'\n$$\n对于理想气体混合物，混合物的总比焓 $h$ 是各组分比焓的质量加权平均。权重因子是组分质量分数 $Y_k$。\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k h_k(T)\n$$\n其中 $N_s$ 是混合物中的组分数量。\n\n结合这两个定义，我们得到混合物比焓作为温度和组分质量分数的函数的一般关系式：\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k \\left[ h_{f,k}(T_{\\mathrm{ref}}) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT' \\right]\n$$\n该表达式可以通过分离生成焓和显焓贡献来重新排列：\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k h_{f,k}(T_{\\mathrm{ref}}) + \\sum_{k=1}^{N_s} Y_k \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT'\n$$\n这就是混合物比焓的通用关系式。\n\n### 第2部分：温度 $T$ 的表达式\n\n给定一个量热非完美模型，其中组分比热是温度的线性函数：\n$$\nc_{p,k}(T) = a_k + b_k T\n$$\n我们还得知两种组分的标准生成焓均为零，即 $h_{f,\\mathrm{N_2}}(T_{\\mathrm{ref}}) = 0$ 和 $h_{f,\\mathrm{O_2}}(T_{\\mathrm{ref}}) = 0$。因此，通用焓关系式中的第一项为零：$\\sum_k Y_k h_{f,k}(T_{\\mathrm{ref}}) = 0$。\n\n首先，我们计算组分 $k$ 的显焓积分：\n$$\n\\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT' = \\int_{T_{\\mathrm{ref}}}^{T} (a_k + b_k T') \\, dT' = \\left[ a_k T' + \\frac{1}{2} b_k (T')^2 \\right]_{T_{\\mathrm{ref}}}^{T}\n$$\n$$\n= (a_k T + \\frac{1}{2} b_k T^2) - (a_k T_{\\mathrm{ref}} + \\frac{1}{2} b_k T_{\\mathrm{ref}}^2) = a_k(T - T_{\\mathrm{ref}}) + \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2)\n$$\n将此结果代入混合物焓方程（生成焓为零）：\n$$\nh = \\sum_k Y_k \\left[ a_k(T - T_{\\mathrm{ref}}) + \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2) \\right]\n$$\n我们可以定义混合物平均比热系数：\n$$\nA = \\sum_k Y_k a_k\n$$\n$$\nB = \\sum_k Y_k b_k\n$$\n混合物的定压比热则为 $c_p(T) = A + BT$。将这些定义代入焓方程：\n$$\nh = \\sum_k Y_k a_k (T - T_{\\mathrm{ref}}) + \\sum_k Y_k \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2)\n$$\n$$\nh = A(T - T_{\\mathrm{ref}}) + \\frac{1}{2} B(T^2 - T_{\\mathrm{ref}}^2)\n$$\n为了找到 $T$ 的显式表达式，我们将此方程重新排列成标准二次方程形式 $c_2 T^2 + c_1 T + c_0 = 0$：\n$$\nh = AT - A T_{\\mathrm{ref}} + \\frac{1}{2} B T^2 - \\frac{1}{2} B T_{\\mathrm{ref}}^2\n$$\n$$\n\\left(\\frac{1}{2} B\\right) T^2 + (A) T + \\left(-h - A T_{\\mathrm{ref}} - \\frac{1}{2} B T_{\\mathrm{ref}}^2\\right) = 0\n$$\n应用二次公式 $T = \\frac{-c_1 \\pm \\sqrt{c_1^2 - 4 c_2 c_0}}{2 c_2}$，我们得到：\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 - 4(\\frac{1}{2} B)(-h - A T_{\\mathrm{ref}} - \\frac{1}{2} B T_{\\mathrm{ref}}^2)}}{2(\\frac{1}{2} B)}\n$$\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 + 2B(h + A T_{\\mathrm{ref}} + \\frac{1}{2} B T_{\\mathrm{ref}}^2)}}{B}\n$$\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 + 2Bh + 2AB T_{\\mathrm{ref}} + B^2 T_{\\mathrm{ref}}^2}}{B}\n$$\n平方根下的项可以被识别为 $(A^2 + 2ABT_{\\mathrm{ref}} + B^2 T_{\\mathrm{ref}}^2) + 2Bh = (A + B T_{\\mathrm{ref}})^2 + 2Bh$。所以，$T$ 的表达式是：\n$$\nT = \\frac{-A \\pm \\sqrt{(A + B T_{\\mathrm{ref}})^2 + 2Bh}}{B}\n$$\n由于温度必须是正的物理量，并且对于正的 $c_p$，焓是温度的单调递增函数，我们必须选择能够产生物理上真实温度的根。对于给定的正系数 $a_k$ 和 $b_k$，A 和 B 都是正的。平方根下的项是正的。由于平方根项将大于 A，我们必须选择正号以确保 $T > 0$。\n$$\nT = \\frac{-A + \\sqrt{(A + B T_{\\mathrm{ref}})^2 + 2Bh}}{B}\n$$\n这是所要求的混合物温度的闭合形式表达式。\n\n### 第3部分：状态方程和压力计算\n\n对于理想气体混合物，状态方程由道尔顿分压定律给出。总压力 $p$ 是分压 $p_k$ 的总和，其中 $p_k = \\rho_k R_k T$。这里，$\\rho_k = \\rho Y_k$ 是组分 $k$ 的分密度，而 $R_k = R_u / M_k$ 是组分 $k$ 的特定气体常数。\n$$\np = \\sum_k p_k = \\sum_k \\rho_k R_k T = T \\sum_k (\\rho Y_k) R_k = \\rho T \\sum_k Y_k R_k\n$$\n将混合物气体常数 $R_{\\mathrm{mix}}$ 定义为组分气体常数的质量加权平均：\n$$\nR_{\\mathrm{mix}} = \\sum_k Y_k R_k = \\sum_k Y_k \\frac{R_u}{M_k}\n$$\n混合物的状态方程则为：\n$$\np = \\rho R_{\\mathrm{mix}} T\n$$\n我们现在进行数值计算。\n**给定数据：**\n$Y_{\\mathrm{N_2}} = 0.76$, $Y_{\\mathrm{O_2}} = 0.24$\n$a_{\\mathrm{N_2}} = 1000 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$，$b_{\\mathrm{N_2}} = 0.10 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n$a_{\\mathrm{O_2}} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$，$b_{\\mathrm{O_2}} = 0.15 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n$M_{\\mathrm{N_2}} = 0.0280134 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$，$M_{\\mathrm{O_2}} = 0.031998 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$\n$R_u = 8.314462618 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$\n$T_{\\mathrm{ref}} = 298 \\ \\mathrm{K}$, $h = 1.200 \\times 10^{6} \\ \\mathrm{J} \\ \\mathrm{kg}^{-1}$, $\\rho = 0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$。\n\n**计算混合物系数 $A$ 和 $B$：**\n$A = Y_{\\mathrm{N_2}} a_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} a_{\\mathrm{O_2}} = (0.76)(1000) + (0.24)(900) = 760 + 216 = 976 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n$B = Y_{\\mathrm{N_2}} b_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} b_{\\mathrm{O_2}} = (0.76)(0.10) + (0.24)(0.15) = 0.076 + 0.036 = 0.112 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n\n**计算温度 $T$：**\n我们使用推导出的 $T$ 的公式：\n$T = \\frac{-976 + \\sqrt{(976 + (0.112)(298))^2 + 2(0.112)(1.200 \\times 10^{6})}}{0.112}$\n$T = \\frac{-976 + \\sqrt{(976 + 33.376)^2 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{(1009.376)^2 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{1018840.0156 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{1287640.0156}}{0.112} = \\frac{-976 + 1134.74227}{0.112} = \\frac{158.74227}{0.112} = 1417.3417 \\ \\mathrm{K}$\n四舍五入到四位有效数字，$T = 1417 \\ \\mathrm{K}$。\n\n**计算混合物气体常数 $R_{\\mathrm{mix}}$：**\n首先，计算组分气体常数：\n$R_{\\mathrm{N_2}} = \\frac{R_u}{M_{\\mathrm{N_2}}} = \\frac{8.314462618}{0.0280134} \\approx 296.793 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n$R_{\\mathrm{O_2}} = \\frac{R_u}{M_{\\mathrm{O_2}}} = \\frac{8.314462618}{0.031998} \\approx 259.842 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n现在计算混合物气体常数：\n$R_{\\mathrm{mix}} = Y_{\\mathrm{N_2}} R_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} R_{\\mathrm{O_2}} = (0.76)(296.793) + (0.24)(259.842) = 225.563 + 62.362 = 287.925 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n四舍五入到四位有效数字，$R_{\\mathrm{mix}} = 287.9 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$。\n\n**计算压力 $p$：**\n使用混合物状态方程 $p = \\rho R_{\\mathrm{mix}} T$，并使用未四舍五入的中间值以获得更高精度：\n$p = (0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3})(287.925 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1})(1417.3417 \\ \\mathrm{K}) = 204001.9 \\ \\mathrm{Pa}$\n四舍五入到四位有效数字，$p = 204000 \\ \\mathrm{Pa}$，或 $2.040 \\times 10^{5} \\ \\mathrm{Pa}$。\n\n最终结果是混合物温度 $T$、混合物气体常数 $R_{\\mathrm{mix}}$ 和压力 $p$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1417 & 287.9 & 2.040 \\times 10^5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "WENO格式的“魔力”在于它能够根据数据的局部光滑度动态分配权重，从而在光滑区域实现高阶精度，并在间断附近抑制振荡。本练习将深入探讨这一机制的数学核心——Jiang-Shu光滑度指示器。通过对一个简单的正弦波进行解析研究，你将深刻理解WENO是如何区分光滑区域与潜在间断的，并为你在更复杂问题中的应用建立直观认识 。",
            "id": "4077058",
            "problem": "用于可压缩反应流的一维有限体积求解器在 Jiang–Shu 格式 (WENO-JS) 中使用五阶加权基本无振荡 (WENO) 重构，来近似带有组分输运的可压缩欧拉方程在单元界面处的数值通量。考虑一个光滑标量场 $q(x)$（例如，组分质量分数或焓的特征变量投影）在正特征速度下，在界面 $x_{i+\\frac{1}{2}}$ 处的重构，该重构在间距为 $\\Delta x$、节点为 $x_i = i \\,\\Delta x$ 的均匀网格上进行。设 $q(x) = \\sin(k x)$，其中波数为 $k$，并定义无量纲波数 $\\kappa = k \\,\\Delta x$ 和相位 $\\varphi = k x_i$。\n\n对于正波速下 $x_{i+\\frac{1}{2}}$ 处的 WENO-JS，三个二次候选模板使用 Jiang–Shu 光滑度指示子\n$$\n\\beta_0 = \\frac{13}{12}\\left(q_{i-2}-2 q_{i-1}+q_i\\right)^{2} + \\frac{1}{4}\\left(q_{i-2}-4 q_{i-1}+3 q_i\\right)^{2},\n$$\n$$\n\\beta_1 = \\frac{13}{12}\\left(q_{i-1}-2 q_i+q_{i+1}\\right)^{2} + \\frac{1}{4}\\left(q_{i-1}-q_{i+1}\\right)^{2},\n$$\n$$\n\\beta_2 = \\frac{13}{12}\\left(q_{i}-2 q_{i+1}+q_{i+2}\\right)^{2} + \\frac{1}{4}\\left(3 q_{i}-4 q_{i+1}+q_{i+2}\\right)^{2},\n$$\n其中 $q_{i+m} = q(x_{i+m})$。将一个空间周期上的相位平均定义为\n$$\n\\langle \\beta_r \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\beta_r(\\varphi;\\kappa)\\, d\\varphi, \\quad r \\in \\{0,1,2\\}.\n$$\n\n仅从这些定义、三角恒等式和均匀网格结构出发，推导比率\n$$\nR(\\kappa) \\equiv \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle}\n$$\n的闭式解析表达式，该表达式仅用 $\\kappa$ 表示。将最终结果表示为一个简化的、仅与 $\\kappa$ 有关而不再依赖于 $\\varphi$ 的解析函数。无需进行数值评估，最终答案中也无需报告单位。",
            "solution": "所述问题具有科学依据，是适定的、客观且自洽的。它构成了计算流体力学领域内关于加权基本无振荡 (WENO) 格式性质的标准理论分析。所有必要的定义均已给出，不存在矛盾或歧义。因此，该问题被认为是有效的，并将推导其解。\n\n目标是求出比率 $R(\\kappa) = \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle}$，其中 $\\langle \\beta_r \\rangle$ 是 Jiang-Shu 光滑度指示子 $\\beta_r$ 的相位平均值。标量场给定为 $q(x) = \\sin(k x)$。在均匀网格 $x_i = i\\,\\Delta x$ 上，点值 $q_{i+m} = q(x_{i+m})$ 可以用相位 $\\varphi = k x_i$ 和无量纲波数 $\\kappa = k\\,\\Delta x$ 表示：\n$$\nq_{i+m} = q(x_i + m\\,\\Delta x) = \\sin(k(x_i + m\\,\\Delta x)) = \\sin(k x_i + m k\\,\\Delta x) = \\sin(\\varphi + m\\kappa).\n$$\n函数 $f(\\varphi)$ 的相位平均定义为 $\\langle f \\rangle = \\frac{1}{2\\pi} \\int_0^{2\\pi} f(\\varphi)\\,d\\varphi$。我们将利用以下标准积分结果：\n$$\n\\langle \\sin^2(\\varphi + c) \\rangle = \\frac{1}{2}, \\quad \\langle \\cos^2(\\varphi + c) \\rangle = \\frac{1}{2}, \\quad \\langle \\sin(\\varphi + c)\\cos(\\varphi + c) \\rangle = 0\n$$\n对于任意常数 $c$，因为积分是覆盖一个完整周期的。\n\n首先，我们分析光滑度指示子 $\\beta_1$：\n$$\n\\beta_1 = \\frac{13}{12}\\left(q_{i-1}-2 q_i+q_{i+1}\\right)^{2} + \\frac{1}{4}\\left(q_{i-1}-q_{i+1}\\right)^{2}.\n$$\n括号内的项是中心有限差分。我们使用三角恒等式来表示它们。\n二阶差分项为：\n\\begin{align*}\nq_{i-1} - 2q_i + q_{i+1} &= \\sin(\\varphi-\\kappa) - 2\\sin(\\varphi) + \\sin(\\varphi+\\kappa) \\\\\n&= [\\sin(\\varphi-\\kappa) + \\sin(\\varphi+\\kappa)] - 2\\sin(\\varphi) \\\\\n&= [2\\sin(\\varphi)\\cos(\\kappa)] - 2\\sin(\\varphi) \\\\\n&= 2\\sin(\\varphi)(\\cos(\\kappa) - 1) \\\\\n&= 2\\sin(\\varphi)(-2\\sin^2(\\frac{\\kappa}{2})) \\\\\n&= -4\\sin(\\varphi)\\sin^2(\\frac{\\kappa}{2}).\n\\end{align*}\n一阶差分项为：\n\\begin{align*}\nq_{i-1} - q_{i+1} &= \\sin(\\varphi-\\kappa) - \\sin(\\varphi+\\kappa) \\\\\n&= 2\\cos(\\varphi)\\sin(-\\kappa) \\\\\n&= -2\\cos(\\varphi)\\sin(\\kappa).\n\\end{align*}\n将这些代入 $\\beta_1$ 的表达式中：\n\\begin{align*}\n\\beta_1 &= \\frac{13}{12}\\left(-4\\sin(\\varphi)\\sin^2(\\frac{\\kappa}{2})\\right)^2 + \\frac{1}{4}\\left(-2\\cos(\\varphi)\\sin(\\kappa)\\right)^2 \\\\\n&= \\frac{13}{12}\\left(16\\sin^2(\\varphi)\\sin^4(\\frac{\\kappa}{2})\\right) + \\frac{1}{4}\\left(4\\cos^2(\\varphi)\\sin^2(\\kappa)\\right) \\\\\n&= \\frac{52}{3}\\sin^2(\\varphi)\\sin^4(\\frac{\\kappa}{2}) + \\cos^2(\\varphi)\\sin^2(\\kappa).\n\\end{align*}\n现在，我们通过应用平均算子来计算相位平均 $\\langle\\beta_1\\rangle$：\n\\begin{align*}\n\\langle \\beta_1 \\rangle &= \\frac{52}{3}\\langle\\sin^2(\\varphi)\\rangle\\sin^4(\\frac{\\kappa}{2}) + \\langle\\cos^2(\\varphi)\\rangle\\sin^2(\\kappa) \\\\\n&= \\frac{52}{3}\\left(\\frac{1}{2}\\right)\\sin^4(\\frac{\\kappa}{2}) + \\left(\\frac{1}{2}\\right)\\sin^2(\\kappa) \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + \\frac{1}{2}(2\\sin(\\frac{\\kappa}{2})\\cos(\\frac{\\kappa}{2}))^2 \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2})\\cos^2(\\frac{\\kappa}{2}) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{26}{3}\\sin^2(\\frac{\\kappa}{2}) + 2\\cos^2(\\frac{\\kappa}{2}) \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{26}{3}\\sin^2(\\frac{\\kappa}{2}) + 2(1-\\sin^2(\\frac{\\kappa}{2})) \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\left(\\frac{26}{3} - 2\\right)\\sin^2(\\frac{\\kappa}{2}) + 2 \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{20}{3}\\sin^2(\\frac{\\kappa}{2}) + 2 \\right) = 2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2}) \\right).\n\\end{align*}\n\n接下来，我们分析光滑度指示子 $\\beta_0$：\n$$\n\\beta_0 = \\frac{13}{12}\\left(q_{i-2}-2 q_{i-1}+q_i\\right)^{2} + \\frac{1}{4}\\left(q_{i-2}-4 q_{i-1}+3 q_i\\right)^{2}.\n$$\n我们将括号中的两项分别记为 $A = q_{i-2}-2 q_{i-1}+q_i$ 和 $B = q_{i-2}-4 q_{i-1}+3 q_i$。\n对于项 $A$：\n\\begin{align*}\nA &= \\sin(\\varphi-2\\kappa) - 2\\sin(\\varphi-\\kappa) + \\sin(\\varphi) \\\\\n&= [\\sin(\\varphi-2\\kappa) + \\sin(\\varphi)] - 2\\sin(\\varphi-\\kappa) \\\\\n&= 2\\sin(\\varphi-\\kappa)\\cos(\\kappa) - 2\\sin(\\varphi-\\kappa) \\\\\n&= 2\\sin(\\varphi-\\kappa)(\\cos(\\kappa)-1) \\\\\n&= -4\\sin(\\varphi-\\kappa)\\sin^2(\\frac{\\kappa}{2}).\n\\end{align*}\n$A^2$ 的相位平均为：\n$$\n\\langle A^2 \\rangle = \\left\\langle \\left(-4\\sin(\\varphi-\\kappa)\\sin^2(\\frac{\\kappa}{2})\\right)^2 \\right\\rangle = 16\\sin^4(\\frac{\\kappa}{2})\\langle \\sin^2(\\varphi-\\kappa) \\rangle = 16\\sin^4(\\frac{\\kappa}{2})\\left(\\frac{1}{2}\\right) = 8\\sin^4(\\frac{\\kappa}{2}).\n$$\n对于项 $B$，直接简化不那么明显。我们用 $\\sin(\\varphi)$ 和 $\\cos(\\varphi)$ 将其展开：\n\\begin{align*}\nB &= \\sin(\\varphi-2\\kappa) - 4\\sin(\\varphi-\\kappa) + 3\\sin(\\varphi) \\\\\n&= [\\sin(\\varphi)\\cos(2\\kappa)-\\cos(\\varphi)\\sin(2\\kappa)] - 4[\\sin(\\varphi)\\cos(\\kappa)-\\cos(\\varphi)\\sin(\\kappa)] + 3\\sin(\\varphi) \\\\\n&= \\sin(\\varphi)[\\cos(2\\kappa) - 4\\cos(\\kappa) + 3] + \\cos(\\varphi)[-\\sin(2\\kappa) + 4\\sin(\\kappa)].\n\\end{align*}\n设 $C_1(\\kappa) = \\cos(2\\kappa) - 4\\cos(\\kappa) + 3$ 和 $C_2(\\kappa) = 4\\sin(\\kappa) - \\sin(2\\kappa)$。那么 $B = C_1\\sin(\\varphi) + C_2\\cos(\\varphi)$。\n$B^2$ 的相位平均为：\n$$\n\\langle B^2 \\rangle = \\langle (C_1\\sin(\\varphi) + C_2\\cos(\\varphi))^2 \\rangle = C_1^2\\langle\\sin^2(\\varphi)\\rangle + C_2^2\\langle\\cos^2(\\varphi)\\rangle + 2C_1C_2\\langle\\sin(\\varphi)\\cos(\\varphi)\\rangle = \\frac{1}{2}(C_1^2 + C_2^2).\n$$\n我们计算 $C_1^2 + C_2^2$：\n\\begin{align*}\nC_1^2 + C_2^2 &= (\\cos(2\\kappa) - 4\\cos(\\kappa) + 3)^2 + (4\\sin(\\kappa) - \\sin(2\\kappa))^2 \\\\\n&= [\\cos^2(2\\kappa) + 16\\cos^2(\\kappa) + 9 - 8\\cos(2\\kappa)\\cos(\\kappa) + 6\\cos(2\\kappa) - 24\\cos(\\kappa)] \\\\\n&\\quad + [16\\sin^2(\\kappa) + \\sin^2(2\\kappa) - 8\\sin(\\kappa)\\sin(2\\kappa)] \\\\\n&= (\\cos^2(2\\kappa) + \\sin^2(2\\kappa)) + 16(\\cos^2(\\kappa) + \\sin^2(\\kappa)) + 9 + 6\\cos(2\\kappa) - 24\\cos(\\kappa) \\\\\n&\\quad - 8(\\cos(2\\kappa)\\cos(\\kappa) + \\sin(2\\kappa)\\sin(\\kappa)) \\\\\n&= 1 + 16 + 9 + 6\\cos(2\\kappa) - 24\\cos(\\kappa) - 8\\cos(2\\kappa-\\kappa) \\\\\n&= 26 + 6\\cos(2\\kappa) - 32\\cos(\\kappa) \\\\\n&= 26 + 6(2\\cos^2(\\kappa)-1) - 32\\cos(\\kappa) \\\\\n&= 12\\cos^2(\\kappa) - 32\\cos(\\kappa) + 20 \\\\\n&= 4(3\\cos^2(\\kappa) - 8\\cos(\\kappa) + 5) \\\\\n&= 4(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5).\n\\end{align*}\n因此，$\\langle B^2 \\rangle = \\frac{1}{2} \\cdot 4(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5) = 2(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5)$。\n使用半角恒等式：\n$\\cos(\\kappa)-1 = -2\\sin^2(\\frac{\\kappa}{2})$\n$3\\cos(\\kappa)-5 = 3(1-2\\sin^2(\\frac{\\kappa}{2}))-5 = -2-6\\sin^2(\\frac{\\kappa}{2}) = -2(1+3\\sin^2(\\frac{\\kappa}{2}))$.\n所以，$\\langle B^2 \\rangle = 2(-2\\sin^2(\\frac{\\kappa}{2}))(-2(1+3\\sin^2(\\frac{\\kappa}{2}))) = 8\\sin^2(\\frac{\\kappa}{2})(1+3\\sin^2(\\frac{\\kappa}{2}))$。\n\n现在我们组装 $\\langle\\beta_0\\rangle$：\n\\begin{align*}\n\\langle \\beta_0 \\rangle &= \\frac{13}{12}\\langle A^2 \\rangle + \\frac{1}{4}\\langle B^2 \\rangle \\\\\n&= \\frac{13}{12}(8\\sin^4(\\frac{\\kappa}{2})) + \\frac{1}{4}(8\\sin^2(\\frac{\\kappa}{2})(1+3\\sin^2(\\frac{\\kappa}{2}))) \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) + 6\\sin^4(\\frac{\\kappa}{2}) \\\\\n&= \\left(\\frac{26}{3} + 6\\right)\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) \\\\\n&= \\frac{44}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) \\\\\n&= 2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2}) \\right).\n\\end{align*}\n\n最后，我们计算比率 $R(\\kappa)$：\n$$\nR(\\kappa) = \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle} = \\frac{2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2}) \\right)}{2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2}) \\right)}.\n$$\n对于离散模拟中任何物理相关的波数，当 $n$ 为整数时，$\\kappa \\neq 2n\\pi$，因此 $\\sin(\\frac{\\kappa}{2}) \\neq 0$。我们可以消去公因子 $2\\sin^2(\\frac{\\kappa}{2})$：\n$$\nR(\\kappa) = \\frac{1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2})}{1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2})}.\n$$\n将分子和分母同乘以 $3$ 得到简化的最终表达式：\n$$\nR(\\kappa) = \\frac{3 + 10\\sin^2(\\frac{\\kappa}{2})}{3 + 22\\sin^2(\\frac{\\kappa}{2})}.\n$$",
            "answer": "$$\n\\boxed{\\frac{3 + 10\\sin^{2}\\left(\\frac{\\kappa}{2}\\right)}{3 + 22\\sin^{2}\\left(\\frac{\\kappa}{2}\\right)}}\n$$"
        },
        {
            "introduction": "将WENO格式应用于像欧拉方程这样的方程组时，我们面临一个关键的设计选择：是直接对守恒变量（$\\rho$, $\\rho u$, $E$）进行重构，还是对物理上更直观的原始变量（$\\rho$, $u$, $p$）进行重构？本编程练习让你亲手实现这两种方法并量化其精度差异。这个过程将揭示这一选择的微妙但重要的后果，尤其是在热力学关系（状态方程）为非线性时 。",
            "id": "4077033",
            "problem": "考虑在一维周期性域 $x \\in [0,1]$ 上，一种反应性可压缩混合物的光滑场。设原始变量为密度 $\\rho(x)$（单位：千克/立方米，kg/m$^3$），速度 $u(x)$（单位：米/秒，m/s），压力 $p(x)$（单位：帕斯卡，Pa），以及代表反应进程的光滑无量纲进程变量 $c(x)$。该混合物具有空间变化的特定热容比 $\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$，以及均匀的单位质量热释放 $q$（单位：焦耳/千克，J/kg）。状态方程由比内能定义\n$$ e(x) = \\frac{p(x)}{(\\gamma(x)-1)\\,\\rho(x)} + q\\,c(x), $$\n总能量密度为\n$$ E(x) = \\rho(x)\\,e(x) + \\frac{1}{2}\\,\\rho(x)\\,u(x)^2 = \\frac{p(x)}{\\gamma(x)-1} + \\rho(x)\\,q\\,c(x) + \\frac{1}{2}\\,\\rho(x)\\,u(x)^2. $$\n定义守恒变量为 $U(x) = [\\rho(x),\\;\\rho(x)u(x),\\;E(x)]$。\n\n您将分析在具有可变 $\\gamma$ 和热释放 $q$ 的光滑测试案例中，对两种不同变量集执行加权基本不振荡 (WENO) 重构时产生的重构误差：\n- 方法 P：重构原始变量 $[\\rho, u, p, c]$ 以获得界面值，然后通过上述热力学关系在界面处映射到守恒变量 $[\\rho,\\rho u, E]$。\n- 方法 C：直接重构守恒变量 $[\\rho,\\rho u, E]$ 以获得界面守恒值。\n\n使用具有 $N$ 个均匀单元和周期性边界条件的有限体积离散化。对于每个单元，通过对单元上的精确场进行数值积分，计算原始变量和守恒变量的单元平均值。实施一个五阶有限体积WENO-JS (Jiang–Shu) 重构，该重构从单元平均值在每个单元面 $x_{i+\\frac{1}{2}}$ 处产生左偏界面值。不假设原始变量到守恒变量映射的任何线性化；在方法 P 中，于界面处逐点应用非线性映射。对于方法 C，独立重构每个守恒分量。\n\n所有测试案例均采用以下光滑精确场：\n- $\\rho(x) = 1 + 0.2\\,\\cos(2\\pi x)$ 单位：kg/m$^3$,\n- $u(x) = 50 + 10\\,\\sin(2\\pi x + 0.1)$ 单位：m/s,\n- $p(x) = 10^5 + 5\\times 10^3\\,\\cos(2\\pi x + 0.3)$ 单位：Pa,\n- $c(x) = 0.5 + 0.1\\,\\sin(2\\pi x - 0.2)$ (无量纲),\n- $\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$ (无量纲), 且处处满足 $\\gamma(x) > 1$。\n\n对于每个面 $x_{i+\\frac{1}{2}}$，通过在 $x_{i+\\frac{1}{2}}$ 处计算精确原始场并应用状态方程，来计算精确守恒变量 $U^{\\mathrm{exact}}(x_{i+\\frac{1}{2}})$。使用方法 P 计算重构的界面守恒变量 $U^{\\mathrm{P}}(x_{i+\\frac{1}{2}})$，使用方法 C 计算 $U^{\\mathrm{C}}(x_{i+\\frac{1}{2}})$。通过聚合所有界面和分量的相对 $L^2$ 误差来量化每种方法的重构误差：\n$$ \\varepsilon_{\\mathrm{P}} = \\frac{\\left(\\sum_{i} \\sum_{k=1}^{3} \\left(U^{\\mathrm{P}}_k(x_{i+\\frac{1}{2}}) - U^{\\mathrm{exact}}_k(x_{i+\\frac{1}{2}})\\right)^2\\right)^{1/2}}{\\left(\\sum_{i} \\sum_{k=1}^{3} \\left(U^{\\mathrm{exact}}_k(x_{i+\\frac{1}{2}})\\right)^2\\right)^{1/2}} $$\n$$ \\varepsilon_{\\mathrm{C}} = \\frac{\\left(\\sum_{i} \\sum_{k=1}^{3} \\left(U^{\\mathrm{C}}_k(x_{i+\\frac{1}{2}}) - U^{\\mathrm{exact}}_k(x_{i+\\frac{1}{2}})\\right)^2\\right)^{1/2}}{\\left(\\sum_{i} \\sum_{k=1}^{3} \\left(U^{\\mathrm{exact}}_k(x_{i+\\frac{1}{2}})\\right)^2\\right)^{1/2}} $$\n为每个测试案例报告元组 $[\\varepsilon_{\\mathrm{P}},\\;\\varepsilon_{\\mathrm{C}},\\;\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}]$，其中包含三个十进制浮点数。\n\n用于单元平均值的数值积分必须达到与重构阶数一致的精度；每个单元使用至少五点的高斯求积。在为WENO模板访问相邻单元时，将域视为周期性的。\n\n测试套件：\n- 案例1（理想情况）：$N=80$, $\\gamma_0=1.4$, $\\Delta\\gamma=0.2$, $q=3\\times 10^4$ J/kg。\n- 案例2（基准情况）：$N=80$, $\\gamma_0=1.4$, $\\Delta\\gamma=0$, $q=0$ J/kg。\n- 案例3（强变化情况）：$N=160$, $\\gamma_0=1.3$, $\\Delta\\gamma=0.25$, $q=8\\times 10^4$ J/kg。\n- 案例4（粗网格）：$N=40$, $\\gamma_0=1.4$, $\\Delta\\gamma=0.2$, $q=3\\times 10^4$ J/kg。\n\n所有量均使用上述单位进行计算；最终报告的误差是无量纲的。您的程序应产生单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个测试案例的结果是一个子列表 $[\\varepsilon_{\\mathrm{P}},\\varepsilon_{\\mathrm{C}},\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}]$；例如，一个有效的输出格式为 $[[a,b,c],[d,e,f],[g,h,i],[j,k,l]]$。",
            "solution": "该问题要求对应用于反应性可压缩流模型的有限体积格式，比较两种方法的重构误差。这两种方法涉及在原始变量（方法 P）或守恒变量（方法 C）上执行五阶加权基本不振荡 (WENO) 重构。该分析是针对一个光滑的一维周期性问题进行的，该问题具有一个包含可变比热比 $\\gamma(x)$ 和热释放项 $q$ 的特定状态方程。\n\n解决方案通过以下步骤实施：\n1.  定义计算网格和所有流动变量的精确解析解。\n2.  通过在每个单元上对精确解进行数值积分，计算所需变量（方法 P 的原始变量，方法 C 的守恒变量）的单元平均值。\n3.  实现五阶WENO-JS重构算法，以从单元平均值获得单元界面处的左偏值。\n4.  应用两种方法计算每个单元界面处的守恒状态向量。\n5.  计算每个界面处的精确守恒状态向量以供比较。\n6.  计算每种方法的聚合相对 $L^2$ 误差，以量化其准确性。\n7.  对所有指定的测试案例重复此过程。\n\n**1. 网格、精确解和状态变量**\n\n一维周期性域 $x \\in [0,1]$ 被离散化为 $N$ 个均匀单元，$C_i = [x_{i-1/2}, x_{i+1/2}]$，其中 $i=0, 1, \\dots, N-1$。单元宽度为 $\\Delta x = 1/N$，单元中心为 $x_i = (i+0.5)\\Delta x$，单元界面位于 $x_{i+1/2} = (i+1)\\Delta x$。\n\n问题为原始变量提供了精确、光滑的解析函数：密度 $\\rho(x)$、速度 $u(x)$、压力 $p(x)$ 和反应进程 $c(x)$。\n比热比 $\\gamma(x)$ 是进程变量的函数：$\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$。\n守恒变量 $U(x) = [\\rho(x), \\rho(x)u(x), E(x)]^T$ 使用热力学关系定义。总能量密度 $E(x)$ 由下式给出：\n$$\nE(x) = \\frac{p(x)}{\\gamma(x)-1} + \\rho(x) q c(x) + \\frac{1}{2}\\rho(x) u(x)^2\n$$\n\n**2. 单元平均值的计算**\n\n对于一个通用函数 $f(x)$，其在单元 $C_i$ 上的单元平均值定义为 $\\bar{f}_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} f(x) dx$。为达到与五阶重构格式一致的精度，此积分使用一个$5$点高斯求积法则进行数值计算。对每个单元 $C_i$，计算积分值，然后除以单元宽度 $\\Delta x$。此过程用于计算方法 P 的原始变量单元平均值 $\\{\\bar{\\rho}_i, \\bar{u}_i, \\bar{p}_i, \\bar{c}_i\\}$，以及方法 C 的守恒变量单元平均值 $\\{\\bar{\\rho}_i, \\overline{\\rho u}_i, \\bar{E}_i\\}$。\n\n**3. 五阶WENO-JS重构**\n\n该数值方法的核心是五阶有限体积WENO-JS格式。从一组给定的单元平均值 $\\bar{v}_i$，我们在界面 $x_{i+1/2}$ 处重构左偏值 $v_{i+1/2}^L$。此重构使用一个围绕单元 $i$ 的 $5$ 个单元的模板：$\\{C_{i-2}, C_{i-1}, C_{i}, C_{i+1}, C_{i+2}\\}$。由于是周期性域，索引按 $N$ 取模处理。\n\nWENO重构是三个三阶重构的非线性组合，每个重构都基于一个包含 $3$ 个单元的子模板。对于界面 $x_{i+1/2}$，候选值为：\n\\begin{align*}\nv_{i+1/2}^{(0)} = \\frac{1}{3}\\bar{v}_{i-2} - \\frac{7}{6}\\bar{v}_{i-1} + \\frac{11}{6}\\bar{v}_{i} \\\\\nv_{i+1/2}^{(1)} = -\\frac{1}{6}\\bar{v}_{i-1} + \\frac{5}{6}\\bar{v}_{i} + \\frac{1}{3}\\bar{v}_{i+1} \\\\\nv_{i+1/2}^{(2)} = \\frac{1}{3}\\bar{v}_{i} + \\frac{5}{6}\\bar{v}_{i+1} - \\frac{1}{6}\\bar{v}_{i+2}\n\\end{align*}\n每个子模板上解的光滑度通过光滑度指示器 $IS_k$ 来衡量：\n\\begin{align*}\nIS_0 = \\frac{13}{12}(\\bar{v}_{i-2} - 2\\bar{v}_{i-1} + \\bar{v}_i)^2 + \\frac{1}{4}(\\bar{v}_{i-2} - 4\\bar{v}_{i-1} + 3\\bar{v}_i)^2 \\\\\nIS_1 = \\frac{13}{12}(\\bar{v}_{i-1} - 2\\bar{v}_i + \\bar{v}_{i+1})^2 + \\frac{1}{4}(\\bar{v}_{i-1} - \\bar{v}_{i+1})^2 \\\\\nIS_2 = \\frac{13}{12}(\\bar{v}_i - 2\\bar{v}_{i+1} + \\bar{v}_{i+2})^2 + \\frac{1}{4}(3\\bar{v}_i - 4\\bar{v}_{i+1} + \\bar{v}_{i+2})^2\n\\end{align*}\n这些指示器用于计算非线性权重 $\\omega_k$。首先，使用最优线性权重（$d_0=0.1, d_1=0.6, d_2=0.3$）计算未归一化的权重 $\\alpha_k$：\n$$\n\\alpha_k = \\frac{d_k}{(\\varepsilon + IS_k)^2}, \\quad k = 0, 1, 2\n$$\n其中 $\\varepsilon$ 是一个小的正数（例如 $10^{-40}$），以防止在光滑区域除以零。最终的权重被归一化：$\\omega_k = \\alpha_k / \\sum_{j=0}^{2} \\alpha_j$。重构值是候选值的加权和：\n$$\nv_{i+1/2}^L = \\sum_{k=0}^{2} \\omega_k v_{i+1/2}^{(k)}\n$$\n\n**4. 重构方法**\n\n- **方法 P：** WENO-JS重构被独立应用于每组原始变量的单元平均值：$\\{\\bar{\\rho}_i\\}, \\{\\bar{u}_i\\}, \\{\\bar{p}_i\\}, \\{\\bar{c}_i\\}$。这会产生界面值 $\\rho^L_{i+1/2}, u^L_{i+1/2}, p^L_{i+1/2}, c^L_{i+1/2}$。然后通过在每个界面处对这些重构的原始值应用非线性状态方程，来计算守恒状态向量 $U^{\\mathrm{P}}(x_{i+1/2})$。\n\n- **方法 C：** WENO-JS重构被独立应用于每组守恒变量的单元平均值：$\\{\\bar{\\rho}_i\\}, \\{\\overline{\\rho u}_i\\}, \\{\\bar{E}_i\\}$。这直接得出守恒变量的界面值，构成状态向量 $U^{\\mathrm{C}}(x_{i+1/2})$。\n\n**5. 误差计算**\n\n对于每种方法，重构误差通过将界面处的重构守恒状态向量 $U^{\\mathrm{P}}$ 或 $U^{\\mathrm{C}}$ 与精确状态向量 $U^{\\mathrm{exact}}$ 进行比较来量化。每个界面 $x_{i+1/2}$ 处的精确向量是通过在 $x_{i+1/2}$ 处计算解析函数 $\\rho(x), u(x), p(x), c(x)$ 并应用状态方程来找到的。误差使用聚合相对 $L^2$ 范数来衡量，定义为：\n$$\n\\varepsilon = \\frac{\\left( \\sum_{i=0}^{N-1} \\sum_{k=1}^{3} (U_k(x_{i+1/2}) - U^{\\mathrm{exact}}_k(x_{i+1/2}))^2 \\right)^{1/2}}{\\left( \\sum_{i=0}^{N-1} \\sum_{k=1}^{3} (U^{\\mathrm{exact}}_k(x_{i+1/2}))^2 \\right)^{1/2}}\n$$\n此公式用于计算 $\\varepsilon_{\\mathrm{P}}$（方法 P）和 $\\varepsilon_{\\mathrm{C}}$（方法 C）。同时计算差值 $\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}$ 以直接比较两种方法。对于光滑流，通常预期 $\\varepsilon_{\\mathrm{P}} < \\varepsilon_{\\mathrm{C}}$，因为原始变量通常更光滑，且重构算子与到守恒变量的非线性变换不可交换。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import fixed_quad\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the execution for all test cases.\n    \"\"\"\n\n    def weno5js_recon(v_bar):\n        \"\"\"\n        Performs 5th-order WENO-JS reconstruction for a 1D periodic domain.\n        Computes left-biased values at interfaces v_{i+1/2}^L.\n        This is a vectorized implementation for efficiency.\n        \"\"\"\n        eps = 1e-40\n        d0, d1, d2 = 0.1, 0.6, 0.3\n\n        # Stencil values shifted periodically\n        vm2 = np.roll(v_bar, 2)\n        vm1 = np.roll(v_bar, 1)\n        v0 = v_bar\n        vp1 = np.roll(v_bar, -1)\n        vp2 = np.roll(v_bar, -2)\n\n        # 3rd-order candidate reconstructions at i+1/2\n        v_rec0 = (1/3) * vm2 - (7/6) * vm1 + (11/6) * v0\n        v_rec1 = (-1/6) * vm1 + (5/6) * v0 + (1/3) * vp1\n        v_rec2 = (1/3) * v0 + (5/6) * vp1 - (1/6) * vp2\n\n        # Smoothness indicators\n        is0 = (13/12) * (vm2 - 2*vm1 + v0)**2 + (1/4) * (vm2 - 4*vm1 + 3*v0)**2\n        is1 = (13/12) * (vm1 - 2*v0 + vp1)**2 + (1/4) * (vm1 - vp1)**2\n        is2 = (13/12) * (v0 - 2*vp1 + vp2)**2 + (1/4) * (3*v0 - 4*vp1 + vp2)**2\n        \n        # Nonlinear weights\n        alpha0 = d0 / (eps + is0)**2\n        alpha1 = d1 / (eps + is1)**2\n        alpha2 = d2 / (eps + is2)**2\n        \n        sum_alpha = alpha0 + alpha1 + alpha2\n        \n        w0 = alpha0 / sum_alpha\n        w1 = alpha1 / sum_alpha\n        w2 = alpha2 / sum_alpha\n        \n        # Final reconstructed value\n        v_L = w0 * v_rec0 + w1 * v_rec1 + w2 * v_rec2\n        \n        return v_L\n\n    def compute_cell_avg(func, N):\n        \"\"\"\n        Computes cell averages of a function `func` over N uniform cells in [0,1]\n        using 5-point Gaussian quadrature for integration.\n        \"\"\"\n        dx = 1.0 / N\n        avg = np.zeros(N)\n        for i in range(N):\n            integral_val, _ = fixed_quad(func, i * dx, (i + 1) * dx, n=5)\n            avg[i] = integral_val / dx\n        return avg\n\n    def solve_case(N, gamma0, d_gamma, q):\n        \"\"\"\n        Solves the problem for a single test case.\n        \"\"\"\n        # 1. Setup Grid and Exact Functions\n        dx = 1.0 / N\n        x_interfaces = (np.arange(N) + 1.0) * dx\n        \n        # Exact primitive fields\n        rho_func = lambda x: 1.0 + 0.2 * np.cos(2 * np.pi * x)\n        u_func = lambda x: 50.0 + 10.0 * np.sin(2 * np.pi * x + 0.1)\n        p_func = lambda x: 1e5 + 5e3 * np.cos(2 * np.pi * x + 0.3)\n        c_func = lambda x: 0.5 + 0.1 * np.sin(2 * np.pi * x - 0.2)\n        gamma_func = lambda x: gamma0 - d_gamma * c_func(x)\n\n        # Exact conservative fields\n        rhou_func = lambda x: rho_func(x) * u_func(x)\n        E_func = lambda x: (p_func(x) / (gamma_func(x) - 1.0)\n                            + rho_func(x) * q * c_func(x)\n                            + 0.5 * rho_func(x) * u_func(x)**2)\n        \n        # 2. Compute Exact Interface Values\n        rho_exact_int = rho_func(x_interfaces)\n        u_exact_int = u_func(x_interfaces)\n        p_exact_int = p_func(x_interfaces)\n        c_exact_int = c_func(x_interfaces)\n        gamma_exact_int = gamma_func(x_interfaces)\n\n        U_exact_int = np.zeros((N, 3))\n        U_exact_int[:, 0] = rho_exact_int\n        U_exact_int[:, 1] = rho_exact_int * u_exact_int\n        U_exact_int[:, 2] = (p_exact_int / (gamma_exact_int - 1.0)\n                             + rho_exact_int * q * c_exact_int\n                             + 0.5 * rho_exact_int * u_exact_int**2)\n\n        # 3. Method P: Reconstruct primitives\n        rho_bar = compute_cell_avg(rho_func, N)\n        u_bar = compute_cell_avg(u_func, N)\n        p_bar = compute_cell_avg(p_func, N)\n        c_bar = compute_cell_avg(c_func, N)\n        \n        rho_L_p = weno5js_recon(rho_bar)\n        u_L_p = weno5js_recon(u_bar)\n        p_L_p = weno5js_recon(p_bar)\n        c_L_p = weno5js_recon(c_bar)\n        \n        gamma_L_p = gamma0 - d_gamma * c_L_p\n        \n        U_P_recon = np.zeros((N, 3))\n        U_P_recon[:, 0] = rho_L_p\n        U_P_recon[:, 1] = rho_L_p * u_L_p\n        U_P_recon[:, 2] = (p_L_p / (gamma_L_p - 1.0)\n                           + rho_L_p * q * c_L_p\n                           + 0.5 * rho_L_p * u_L_p**2)\n\n        # 4. Method C: Reconstruct conservatives\n        rhou_bar = compute_cell_avg(rhou_func, N)\n        E_bar = compute_cell_avg(E_func, N)\n        \n        U_C_recon = np.zeros((N, 3))\n        U_C_recon[:, 0] = weno5js_recon(rho_bar) # rho_bar is already computed\n        U_C_recon[:, 1] = weno5js_recon(rhou_bar)\n        U_C_recon[:, 2] = weno5js_recon(E_bar)\n        \n        # 5. Compute Errors\n        norm_exact_sq = np.sum(U_exact_int**2)\n        \n        err_P_sq = np.sum((U_P_recon - U_exact_int)**2)\n        eps_P = np.sqrt(err_P_sq / norm_exact_sq)\n        \n        err_C_sq = np.sum((U_C_recon - U_exact_int)**2)\n        eps_C = np.sqrt(err_C_sq / norm_exact_sq)\n\n        return [eps_P, eps_C, eps_P - eps_C]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, gamma0, d_gamma, q)\n        (80, 1.4, 0.2, 3e4),    # Case 1\n        (80, 1.4, 0.0, 0.0),    # Case 2\n        (160, 1.3, 0.25, 8e4),  # Case 3\n        (40, 1.4, 0.2, 3e4),     # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        N, gamma0, d_gamma, q = case\n        result = solve_case(N, gamma0, d_gamma, q)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}