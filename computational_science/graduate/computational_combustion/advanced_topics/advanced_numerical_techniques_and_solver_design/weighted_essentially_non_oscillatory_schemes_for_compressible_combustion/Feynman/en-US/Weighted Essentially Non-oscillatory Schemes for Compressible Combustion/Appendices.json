{
    "hands_on_practices": [
        {
            "introduction": "A robust compressible flow solver must accurately relate the conservative variables it evolves, such as total energy, to the primitive variables like temperature and pressure. This is especially critical in combustion, where gas properties are strongly temperature-dependent. This first practice challenges you to derive and apply the fundamental thermodynamic closure for a calorically imperfect gas mixture, a crucial skill for bridging the gap between the solver's state vector and the physical equation of state .",
            "id": "4077046",
            "problem": "Consider a one-dimensional compressible reacting flow advanced in time with a Weighted Essentially Non-Oscillatory (WENO) finite-volume scheme. The conservative update requires a thermodynamic closure consistent with a calorically imperfect ideal-gas mixture. The mixture is composed of two species, nitrogen and oxygen, with species mass fractions $Y_{\\mathrm{N_2}} = 0.76$ and $Y_{\\mathrm{O_2}} = 0.24$. The species are modeled as ideal gases with temperature-dependent specific heats at constant pressure of the form $c_{p,k}(T) = a_k + b_k T$ for $k \\in \\{\\mathrm{N_2}, \\mathrm{O_2}\\}$. The reference temperature is $T_{\\mathrm{ref}} = 298 \\ \\mathrm{K}$, and the standard formation enthalpies at $T_{\\mathrm{ref}}$ are taken as $h_{f,\\mathrm{N_2}}(T_{\\mathrm{ref}}) = 0$ and $h_{f,\\mathrm{O_2}}(T_{\\mathrm{ref}}) = 0$. The species properties are:\n- $a_{\\mathrm{N_2}} = 1000 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, $b_{\\mathrm{N_2}} = 0.10 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$,\n- $a_{\\mathrm{O_2}} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, $b_{\\mathrm{O_2}} = 0.15 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$,\n- $M_{\\mathrm{N_2}} = 0.0280134 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$, $M_{\\mathrm{O_2}} = 0.031998 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$,\n- $R_u = 8.314462618 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$.\n\nThe mixture total specific enthalpy is measured as $h = 1.200 \\times 10^{6} \\ \\mathrm{J} \\ \\mathrm{kg}^{-1}$, and the mixture mass density is $\\rho = 0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$.\n\nStarting from the species-level thermodynamic definitions and mixture rules appropriate for ideal-gas combustion modeling, do the following:\n1. Derive the general relation for the mixture specific enthalpy $h(T, Y_k)$ of a calorically imperfect ideal-gas mixture in terms of temperature $T$, species mass fractions $Y_k$, and species functions $c_{p,k}(T)$, with the reference temperature $T_{\\mathrm{ref}}$ and formation enthalpies $h_{f,k}(T_{\\mathrm{ref}})$. Your derivation must proceed from the species enthalpy definition and mixture averaging.\n2. Specialize your result to the given linear $c_{p,k}(T)$ model and derive an explicit closed-form expression for the mixture temperature $T$ in terms of $h$, $Y_k$, $a_k$, $b_k$, and $T_{\\mathrm{ref}}$.\n3. Derive the Equation of State (EOS) for the mixture as $p = \\rho R_{\\mathrm{mix}}(T) T$ from species properties, with $R_{\\mathrm{mix}}(T) = \\sum_{k} Y_k R_k$ and $R_k = R_u / M_k$, and evaluate $R_{\\mathrm{mix}}$ numerically for the given mixture. Using this $R_{\\mathrm{mix}}$, compute the mixture pressure $p$.\n\nExpress the final temperature in $\\mathrm{K}$, $R_{\\mathrm{mix}}$ in $\\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, and $p$ in $\\mathrm{Pa}$. Round your numerical answers to four significant figures. Report your final results as a single row matrix containing, in order, the mixture temperature $T$, the mixture gas constant $R_{\\mathrm{mix}}$, and the pressure $p$.",
            "solution": "The user has provided a well-posed and scientifically grounded problem in thermodynamics and computational combustion modeling. The problem is validated as it contains a complete and consistent set of givens, is based on established physical-chemical principles, and is structured to have a unique and meaningful solution. We proceed with the solution in three parts as requested.\n\n### Part 1: General Relation for Mixture Specific Enthalpy\n\nThe absolute specific enthalpy of a single species, $k$, at a temperature $T$ is defined relative to its standard state at a reference temperature $T_{\\mathrm{ref}}$. It is the sum of the standard enthalpy of formation at $T_{\\mathrm{ref}}$, $h_{f,k}(T_{\\mathrm{ref}})$, and the sensible enthalpy change from $T_{\\mathrm{ref}}$ to $T$. The sensible enthalpy is calculated by integrating the species specific heat at constant pressure, $c_{p,k}(T)$, over the temperature range.\nThe definition for the specific enthalpy of species $k$ is:\n$$\nh_k(T) = h_{f,k}(T_{\\mathrm{ref}}) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT'\n$$\nFor an ideal-gas mixture, the total specific enthalpy of the mixture, $h$, is the mass-weighted average of the individual species' specific enthalpies. The weighting factors are the species mass fractions, $Y_k$.\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k h_k(T)\n$$\nwhere $N_s$ is the number of species in the mixture.\n\nCombining these two definitions, we arrive at the general relation for the mixture specific enthalpy as a function of temperature and species mass fractions:\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k \\left[ h_{f,k}(T_{\\mathrm{ref}}) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT' \\right]\n$$\nThis expression can be rearranged by separating the formation enthalpy and sensible enthalpy contributions:\n$$\nh(T, \\{Y_k\\}) = \\sum_{k=1}^{N_s} Y_k h_{f,k}(T_{\\mathrm{ref}}) + \\sum_{k=1}^{N_s} Y_k \\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT'\n$$\nThis is the general relation for the mixture specific enthalpy.\n\n### Part 2: Expression for Temperature $T$\n\nWe are given a calorically imperfect model where the species specific heats are linear functions of temperature:\n$$\nc_{p,k}(T) = a_k + b_k T\n$$\nWe are also given that the standard formation enthalpies are zero for both species, $h_{f,\\mathrm{N_2}}(T_{\\mathrm{ref}}) = 0$ and $h_{f,\\mathrm{O_2}}(T_{\\mathrm{ref}}) = 0$. Therefore, the first term in the general enthalpy relation is zero: $\\sum_k Y_k h_{f,k}(T_{\\mathrm{ref}}) = 0$.\n\nFirst, we evaluate the integral for the sensible enthalpy of species $k$:\n$$\n\\int_{T_{\\mathrm{ref}}}^{T} c_{p,k}(T') \\, dT' = \\int_{T_{\\mathrm{ref}}}^{T} (a_k + b_k T') \\, dT' = \\left[ a_k T' + \\frac{1}{2} b_k (T')^2 \\right]_{T_{\\mathrm{ref}}}^{T}\n$$\n$$\n= (a_k T + \\frac{1}{2} b_k T^2) - (a_k T_{\\mathrm{ref}} + \\frac{1}{2} b_k T_{\\mathrm{ref}}^2) = a_k(T - T_{\\mathrm{ref}}) + \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2)\n$$\nSubstituting this result into the mixture enthalpy equation (with zero formation enthalpies):\n$$\nh = \\sum_k Y_k \\left[ a_k(T - T_{\\mathrm{ref}}) + \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2) \\right]\n$$\nWe can define mixture-averaged specific heat coefficients:\n$$\nA = \\sum_k Y_k a_k\n$$\n$$\nB = \\sum_k Y_k b_k\n$$\nThe mixture specific heat at constant pressure is then $c_p(T) = A + BT$. Substituting these definitions into the enthalpy equation:\n$$\nh = \\sum_k Y_k a_k (T - T_{\\mathrm{ref}}) + \\sum_k Y_k \\frac{1}{2} b_k (T^2 - T_{\\mathrm{ref}}^2)\n$$\n$$\nh = A(T - T_{\\mathrm{ref}}) + \\frac{1}{2} B(T^2 - T_{\\mathrm{ref}}^2)\n$$\nTo find an explicit expression for $T$, we rearrange this equation into a standard quadratic form, $c_2 T^2 + c_1 T + c_0 = 0$:\n$$\nh = AT - A T_{\\mathrm{ref}} + \\frac{1}{2} B T^2 - \\frac{1}{2} B T_{\\mathrm{ref}}^2\n$$\n$$\n\\left(\\frac{1}{2} B\\right) T^2 + (A) T + \\left(-h - A T_{\\mathrm{ref}} - \\frac{1}{2} B T_{\\mathrm{ref}}^2\\right) = 0\n$$\nApplying the quadratic formula, $T = \\frac{-c_1 \\pm \\sqrt{c_1^2 - 4 c_2 c_0}}{2 c_2}$, we get:\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 - 4(\\frac{1}{2} B)(-h - A T_{\\mathrm{ref}} - \\frac{1}{2} B T_{\\mathrm{ref}}^2)}}{2(\\frac{1}{2} B)}\n$$\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 + 2B(h + A T_{\\mathrm{ref}} + \\frac{1}{2} B T_{\\mathrm{ref}}^2)}}{B}\n$$\n$$\nT = \\frac{-A \\pm \\sqrt{A^2 + 2Bh + 2AB T_{\\mathrm{ref}} + B^2 T_{\\mathrm{ref}}^2}}{B}\n$$\nThe term under the square root can be recognized as $(A^2 + 2ABT_{\\mathrm{ref}} + B^2 T_{\\mathrm{ref}}^2) + 2Bh = (A + B T_{\\mathrm{ref}})^2 + 2Bh$. So, the expression for $T$ is:\n$$\nT = \\frac{-A \\pm \\sqrt{(A + B T_{\\mathrm{ref}})^2 + 2Bh}}{B}\n$$\nSince temperature must be a positive physical quantity, and for positive $c_p$, enthalpy is a monotonically increasing function of temperature, we must select the root that yields a physically realistic temperature. For the given positive coefficients $a_k$ and $b_k$, both $A$ and $B$ are positive. The term under the square root is positive. Since the square root term will be larger than $A$, we must choose the positive sign to ensure $T > 0$.\n$$\nT = \\frac{-A + \\sqrt{(A + B T_{\\mathrm{ref}})^2 + 2Bh}}{B}\n$$\nThis is the required closed-form expression for the mixture temperature.\n\n### Part 3: Equation of State and Pressure Calculation\n\nFor an ideal-gas mixture, the equation of state is given by Dalton's Law. The total pressure $p$ is the sum of partial pressures $p_k$, where $p_k = \\rho_k R_k T$. Here, $\\rho_k = \\rho Y_k$ is the partial density of species $k$, and $R_k = R_u / M_k$ is the specific gas constant of species $k$.\n$$\np = \\sum_k p_k = \\sum_k \\rho_k R_k T = T \\sum_k (\\rho Y_k) R_k = \\rho T \\sum_k Y_k R_k\n$$\nDefining the mixture gas constant $R_{\\mathrm{mix}}$ as the mass-weighted average of species gas constants:\n$$\nR_{\\mathrm{mix}} = \\sum_k Y_k R_k = \\sum_k Y_k \\frac{R_u}{M_k}\n$$\nThe mixture equation of state is then:\n$$\np = \\rho R_{\\mathrm{mix}} T\n$$\nWe now proceed with the numerical evaluation.\n**Given data:**\n$Y_{\\mathrm{N_2}} = 0.76$, $Y_{\\mathrm{O_2}} = 0.24$\n$a_{\\mathrm{N_2}} = 1000 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, $b_{\\mathrm{N_2}} = 0.10 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n$a_{\\mathrm{O_2}} = 900 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$, $b_{\\mathrm{O_2}} = 0.15 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n$M_{\\mathrm{N_2}} = 0.0280134 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$, $M_{\\mathrm{O_2}} = 0.031998 \\ \\mathrm{kg} \\ \\mathrm{mol}^{-1}$\n$R_u = 8.314462618 \\ \\mathrm{J} \\ \\mathrm{mol}^{-1} \\ \\mathrm{K}^{-1}$\n$T_{\\mathrm{ref}} = 298 \\ \\mathrm{K}$, $h = 1.200 \\times 10^{6} \\ \\mathrm{J} \\ \\mathrm{kg}^{-1}$, $\\rho = 0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3}$.\n\n**Calculate mixture coefficients $A$ and $B$:**\n$A = Y_{\\mathrm{N_2}} a_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} a_{\\mathrm{O_2}} = (0.76)(1000) + (0.24)(900) = 760 + 216 = 976 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n$B = Y_{\\mathrm{N_2}} b_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} b_{\\mathrm{O_2}} = (0.76)(0.10) + (0.24)(0.15) = 0.076 + 0.036 = 0.112 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-2}$\n\n**Calculate temperature $T$:**\nWe use the derived formula for $T$:\n$T = \\frac{-976 + \\sqrt{(976 + (0.112)(298))^2 + 2(0.112)(1.200 \\times 10^{6})}}{0.112}$\n$T = \\frac{-976 + \\sqrt{(976 + 33.376)^2 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{(1009.376)^2 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{1018840.0156 + 268800}}{0.112}$\n$T = \\frac{-976 + \\sqrt{1287640.0156}}{0.112} = \\frac{-976 + 1134.74227}{0.112} = \\frac{158.74227}{0.112} = 1417.3417 \\ \\mathrm{K}$\nRounding to four significant figures, $T = 1417 \\ \\mathrm{K}$.\n\n**Calculate mixture gas constant $R_{\\mathrm{mix}}$:**\nFirst, calculate the species gas constants:\n$R_{\\mathrm{N_2}} = \\frac{R_u}{M_{\\mathrm{N_2}}} = \\frac{8.314462618}{0.0280134} \\approx 296.793 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\n$R_{\\mathrm{O_2}} = \\frac{R_u}{M_{\\mathrm{O_2}}} = \\frac{8.314462618}{0.031998} \\approx 259.842 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\nNow calculate the mixture gas constant:\n$R_{\\mathrm{mix}} = Y_{\\mathrm{N_2}} R_{\\mathrm{N_2}} + Y_{\\mathrm{O_2}} R_{\\mathrm{O_2}} = (0.76)(296.793) + (0.24)(259.842) = 225.563 + 62.362 = 287.925 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$\nRounding to four significant figures, $R_{\\mathrm{mix}} = 287.9 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1}$.\n\n**Calculate pressure $p$:**\nUsing the mixture equation of state $p = \\rho R_{\\mathrm{mix}} T$ with the unrounded intermediate values for higher precision:\n$p = (0.50 \\ \\mathrm{kg} \\ \\mathrm{m}^{-3})(287.925 \\ \\mathrm{J} \\ \\mathrm{kg}^{-1} \\ \\mathrm{K}^{-1})(1417.3417 \\ \\mathrm{K}) = 204001.9 \\ \\mathrm{Pa}$\nRounding to four significant figures, $p = 204000 \\ \\mathrm{Pa}$, or $2.040 \\times 10^{5} \\ \\mathrm{Pa}$.\n\nThe final results are the mixture temperature $T$, the mixture gas constant $R_{\\mathrm{mix}}$, and the pressure $p$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1417 & 287.9 & 2.040 \\times 10^5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The defining feature of a WENO scheme is its ability to automatically switch between a high-order method in smooth regions and a robust, non-oscillatory one near discontinuities. This intelligence resides in the smoothness indicators, which measure the local regularity of the solution. Through this analytical exercise, you will explore how these indicators behave for a simple sinusoidal function, providing deep insight into the mechanism that allows WENO to achieve its remarkable performance and adapt to different length scales in the flow .",
            "id": "4077058",
            "problem": "A one-dimensional finite-volume solver for compressible reacting flow uses a fifth-order Weighted Essentially Non-Oscillatory (WENO) reconstruction in the Jiang–Shu formulation (WENO-JS) to approximate numerical fluxes at cell interfaces for the compressible Euler equations with species transport. Consider reconstruction of a smooth scalar field $q(x)$ (e.g., a characteristic-variable projection of a species mass fraction or enthalpy) at the interface $x_{i+\\frac{1}{2}}$ for positive characteristic speed, on a uniform grid with spacing $\\Delta x$ and nodes $x_i = i \\,\\Delta x$. Let $q(x) = \\sin(k x)$ with wavenumber $k$, and define the nondimensional wavenumber $\\kappa = k \\,\\Delta x$ and the phase $\\varphi = k x_i$.\n\nFor WENO-JS at $x_{i+\\frac{1}{2}}$ with positive wave speed, the three quadratic candidate stencils use the Jiang–Shu smoothness indicators\n$$\n\\beta_0 = \\frac{13}{12}\\left(q_{i-2}-2 q_{i-1}+q_i\\right)^{2} + \\frac{1}{4}\\left(q_{i-2}-4 q_{i-1}+3 q_i\\right)^{2},\n$$\n$$\n\\beta_1 = \\frac{13}{12}\\left(q_{i-1}-2 q_i+q_{i+1}\\right)^{2} + \\frac{1}{4}\\left(q_{i-1}-q_{i+1}\\right)^{2},\n$$\n$$\n\\beta_2 = \\frac{13}{12}\\left(q_{i}-2 q_{i+1}+q_{i+2}\\right)^{2} + \\frac{1}{4}\\left(3 q_{i}-4 q_{i+1}+q_{i+2}\\right)^{2},\n$$\nwhere $q_{i+m} = q(x_{i+m})$. Define the phase-average over one spatial period as\n$$\n\\langle \\beta_r \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\beta_r(\\varphi;\\kappa)\\, d\\varphi, \\quad r \\in \\{0,1,2\\}.\n$$\n\nStarting only from these definitions, trigonometric identities, and the uniform grid structure, derive a closed-form analytic expression for the ratio\n$$\nR(\\kappa) \\equiv \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle}\n$$\nin terms of $\\kappa$ only. Express your final result as a simplified analytic function of $\\kappa$ with no remaining dependence on $\\varphi$. No numerical evaluation is required, and no units are to be reported in the final answer.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and self-contained. It constitutes a standard theoretical analysis within the field of computational fluid dynamics concerning the properties of a Weighted Essentially Non-Oscillatory (WENO) scheme. All necessary definitions are provided, and there are no contradictions or ambiguities. The problem is therefore deemed valid and a solution will be derived.\n\nThe objective is to find the ratio $R(\\kappa) = \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle}$, where $\\langle \\beta_r \\rangle$ is the phase-average of the Jiang-Shu smoothness indicator $\\beta_r$. The scalar field is given as $q(x) = \\sin(k x)$. On a uniform grid $x_i = i\\,\\Delta x$, the point values $q_{i+m} = q(x_{i+m})$ can be expressed in terms of the phase $\\varphi = k x_i$ and the non-dimensional wavenumber $\\kappa = k\\,\\Delta x$:\n$$\nq_{i+m} = q(x_i + m\\,\\Delta x) = \\sin(k(x_i + m\\,\\Delta x)) = \\sin(k x_i + m k\\,\\Delta x) = \\sin(\\varphi + m\\kappa).\n$$\nThe phase-average of a function $f(\\varphi)$ is defined as $\\langle f \\rangle = \\frac{1}{2\\pi} \\int_0^{2\\pi} f(\\varphi)\\,d\\varphi$. We will utilize the following standard integral results:\n$$\n\\langle \\sin^2(\\varphi + c) \\rangle = \\frac{1}{2}, \\quad \\langle \\cos^2(\\varphi + c) \\rangle = \\frac{1}{2}, \\quad \\langle \\sin(\\varphi + c)\\cos(\\varphi + c) \\rangle = 0\n$$\nfor any constant $c$, as the integration is over a full period.\n\nFirst, we analyze the smoothness indicator $\\beta_1$:\n$$\n\\beta_1 = \\frac{13}{12}\\left(q_{i-1}-2 q_i+q_{i+1}\\right)^{2} + \\frac{1}{4}\\left(q_{i-1}-q_{i+1}\\right)^{2}.\n$$\nThe terms inside the parentheses are central finite differences. We express them using trigonometric identities.\nThe second-difference term is:\n\\begin{align*}\nq_{i-1} - 2q_i + q_{i+1} &= \\sin(\\varphi-\\kappa) - 2\\sin(\\varphi) + \\sin(\\varphi+\\kappa) \\\\\n&= [\\sin(\\varphi-\\kappa) + \\sin(\\varphi+\\kappa)] - 2\\sin(\\varphi) \\\\\n&= [2\\sin(\\varphi)\\cos(\\kappa)] - 2\\sin(\\varphi) \\\\\n&= 2\\sin(\\varphi)(\\cos(\\kappa) - 1) \\\\\n&= 2\\sin(\\varphi)(-2\\sin^2(\\frac{\\kappa}{2})) \\\\\n&= -4\\sin(\\varphi)\\sin^2(\\frac{\\kappa}{2}).\n\\end{align*}\nThe first-difference term is:\n\\begin{align*}\nq_{i-1} - q_{i+1} &= \\sin(\\varphi-\\kappa) - \\sin(\\varphi+\\kappa) \\\\\n&= 2\\cos(\\varphi)\\sin(-\\kappa) \\\\\n&= -2\\cos(\\varphi)\\sin(\\kappa).\n\\end{align*}\nSubstituting these into the expression for $\\beta_1$:\n\\begin{align*}\n\\beta_1 &= \\frac{13}{12}\\left(-4\\sin(\\varphi)\\sin^2(\\frac{\\kappa}{2})\\right)^2 + \\frac{1}{4}\\left(-2\\cos(\\varphi)\\sin(\\kappa)\\right)^2 \\\\\n&= \\frac{13}{12}\\left(16\\sin^2(\\varphi)\\sin^4(\\frac{\\kappa}{2})\\right) + \\frac{1}{4}\\left(4\\cos^2(\\varphi)\\sin^2(\\kappa)\\right) \\\\\n&= \\frac{52}{3}\\sin^2(\\varphi)\\sin^4(\\frac{\\kappa}{2}) + \\cos^2(\\varphi)\\sin^2(\\kappa).\n\\end{align*}\nNow, we compute the phase-average $\\langle\\beta_1\\rangle$ by applying the averaging operator:\n\\begin{align*}\n\\langle \\beta_1 \\rangle &= \\frac{52}{3}\\langle\\sin^2(\\varphi)\\rangle\\sin^4(\\frac{\\kappa}{2}) + \\langle\\cos^2(\\varphi)\\rangle\\sin^2(\\kappa) \\\\\n&= \\frac{52}{3}\\left(\\frac{1}{2}\\right)\\sin^4(\\frac{\\kappa}{2}) + \\left(\\frac{1}{2}\\right)\\sin^2(\\kappa) \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + \\frac{1}{2}(2\\sin(\\frac{\\kappa}{2})\\cos(\\frac{\\kappa}{2}))^2 \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2})\\cos^2(\\frac{\\kappa}{2}) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{26}{3}\\sin^2(\\frac{\\kappa}{2}) + 2\\cos^2(\\frac{\\kappa}{2}) \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{26}{3}\\sin^2(\\frac{\\kappa}{2}) + 2(1-\\sin^2(\\frac{\\kappa}{2})) \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\left(\\frac{26}{3} - 2\\right)\\sin^2(\\frac{\\kappa}{2}) + 2 \\right) \\\\\n&= \\sin^2(\\frac{\\kappa}{2}) \\left( \\frac{20}{3}\\sin^2(\\frac{\\kappa}{2}) + 2 \\right) = 2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2}) \\right).\n\\end{align*}\n\nNext, we analyze the smoothness indicator $\\beta_0$:\n$$\n\\beta_0 = \\frac{13}{12}\\left(q_{i-2}-2 q_{i-1}+q_i\\right)^{2} + \\frac{1}{4}\\left(q_{i-2}-4 q_{i-1}+3 q_i\\right)^{2}.\n$$\nLet's denote the two terms in parentheses as $A = q_{i-2}-2 q_{i-1}+q_i$ and $B = q_{i-2}-4 q_{i-1}+3 q_i$.\nFor term $A$:\n\\begin{align*}\nA &= \\sin(\\varphi-2\\kappa) - 2\\sin(\\varphi-\\kappa) + \\sin(\\varphi) \\\\\n&= [\\sin(\\varphi-2\\kappa) + \\sin(\\varphi)] - 2\\sin(\\varphi-\\kappa) \\\\\n&= 2\\sin(\\varphi-\\kappa)\\cos(\\kappa) - 2\\sin(\\varphi-\\kappa) \\\\\n&= 2\\sin(\\varphi-\\kappa)(\\cos(\\kappa)-1) \\\\\n&= -4\\sin(\\varphi-\\kappa)\\sin^2(\\frac{\\kappa}{2}).\n\\end{align*}\nThe phase-average of $A^2$ is:\n$$\n\\langle A^2 \\rangle = \\left\\langle \\left(-4\\sin(\\varphi-\\kappa)\\sin^2(\\frac{\\kappa}{2})\\right)^2 \\right\\rangle = 16\\sin^4(\\frac{\\kappa}{2})\\langle \\sin^2(\\varphi-\\kappa) \\rangle = 16\\sin^4(\\frac{\\kappa}{2})\\left(\\frac{1}{2}\\right) = 8\\sin^4(\\frac{\\kappa}{2}).\n$$\nFor term $B$, direct simplification is less obvious. We expand it in terms of $\\sin(\\varphi)$ and $\\cos(\\varphi)$:\n\\begin{align*}\nB &= \\sin(\\varphi-2\\kappa) - 4\\sin(\\varphi-\\kappa) + 3\\sin(\\varphi) \\\\\n&= [\\sin(\\varphi)\\cos(2\\kappa)-\\cos(\\varphi)\\sin(2\\kappa)] - 4[\\sin(\\varphi)\\cos(\\kappa)-\\cos(\\varphi)\\sin(\\kappa)] + 3\\sin(\\varphi) \\\\\n&= \\sin(\\varphi)[\\cos(2\\kappa) - 4\\cos(\\kappa) + 3] + \\cos(\\varphi)[-\\sin(2\\kappa) + 4\\sin(\\kappa)].\n\\end{align*}\nLet $C_1(\\kappa) = \\cos(2\\kappa) - 4\\cos(\\kappa) + 3$ and $C_2(\\kappa) = 4\\sin(\\kappa) - \\sin(2\\kappa)$. Then $B = C_1\\sin(\\varphi) + C_2\\cos(\\varphi)$.\nThe phase-average of $B^2$ is:\n$$\n\\langle B^2 \\rangle = \\langle (C_1\\sin(\\varphi) + C_2\\cos(\\varphi))^2 \\rangle = C_1^2\\langle\\sin^2(\\varphi)\\rangle + C_2^2\\langle\\cos^2(\\varphi)\\rangle + 2C_1C_2\\langle\\sin(\\varphi)\\cos(\\varphi)\\rangle = \\frac{1}{2}(C_1^2 + C_2^2).\n$$\nWe compute $C_1^2 + C_2^2$:\n\\begin{align*}\nC_1^2 + C_2^2 &= (\\cos(2\\kappa) - 4\\cos(\\kappa) + 3)^2 + (4\\sin(\\kappa) - \\sin(2\\kappa))^2 \\\\\n&= [\\cos^2(2\\kappa) + 16\\cos^2(\\kappa) + 9 - 8\\cos(2\\kappa)\\cos(\\kappa) + 6\\cos(2\\kappa) - 24\\cos(\\kappa)] \\\\\n&\\quad + [16\\sin^2(\\kappa) + \\sin^2(2\\kappa) - 8\\sin(\\kappa)\\sin(2\\kappa)] \\\\\n&= (\\cos^2(2\\kappa) + \\sin^2(2\\kappa)) + 16(\\cos^2(\\kappa) + \\sin^2(\\kappa)) + 9 + 6\\cos(2\\kappa) - 24\\cos(\\kappa) \\\\\n&\\quad - 8(\\cos(2\\kappa)\\cos(\\kappa) + \\sin(2\\kappa)\\sin(\\kappa)) \\\\\n&= 1 + 16 + 9 + 6\\cos(2\\kappa) - 24\\cos(\\kappa) - 8\\cos(2\\kappa-\\kappa) \\\\\n&= 26 + 6\\cos(2\\kappa) - 32\\cos(\\kappa) \\\\\n&= 26 + 6(2\\cos^2(\\kappa)-1) - 32\\cos(\\kappa) \\\\\n&= 12\\cos^2(\\kappa) - 32\\cos(\\kappa) + 20 \\\\\n&= 4(3\\cos^2(\\kappa) - 8\\cos(\\kappa) + 5) \\\\\n&= 4(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5).\n\\end{align*}\nThus, $\\langle B^2 \\rangle = \\frac{1}{2} \\cdot 4(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5) = 2(\\cos(\\kappa)-1)(3\\cos(\\kappa)-5)$.\nUsing half-angle identities:\n$\\cos(\\kappa)-1 = -2\\sin^2(\\frac{\\kappa}{2})$\n$3\\cos(\\kappa)-5 = 3(1-2\\sin^2(\\frac{\\kappa}{2}))-5 = -2-6\\sin^2(\\frac{\\kappa}{2}) = -2(1+3\\sin^2(\\frac{\\kappa}{2}))$.\nSo, $\\langle B^2 \\rangle = 2(-2\\sin^2(\\frac{\\kappa}{2}))(-2(1+3\\sin^2(\\frac{\\kappa}{2}))) = 8\\sin^2(\\frac{\\kappa}{2})(1+3\\sin^2(\\frac{\\kappa}{2}))$.\n\nNow we assemble $\\langle\\beta_0\\rangle$:\n\\begin{align*}\n\\langle \\beta_0 \\rangle &= \\frac{13}{12}\\langle A^2 \\rangle + \\frac{1}{4}\\langle B^2 \\rangle \\\\\n&= \\frac{13}{12}(8\\sin^4(\\frac{\\kappa}{2})) + \\frac{1}{4}(8\\sin^2(\\frac{\\kappa}{2})(1+3\\sin^2(\\frac{\\kappa}{2}))) \\\\\n&= \\frac{26}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) + 6\\sin^4(\\frac{\\kappa}{2}) \\\\\n&= \\left(\\frac{26}{3} + 6\\right)\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) \\\\\n&= \\frac{44}{3}\\sin^4(\\frac{\\kappa}{2}) + 2\\sin^2(\\frac{\\kappa}{2}) \\\\\n&= 2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2}) \\right).\n\\end{align*}\n\nFinally, we compute the ratio $R(\\kappa)$:\n$$\nR(\\kappa) = \\frac{\\langle \\beta_1 \\rangle}{\\langle \\beta_0 \\rangle} = \\frac{2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2}) \\right)}{2\\sin^2(\\frac{\\kappa}{2}) \\left( 1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2}) \\right)}.\n$$\nFor any physically relevant wavenumber in a discrete simulation, $\\kappa \\neq 2n\\pi$ for integer $n$, so $\\sin(\\frac{\\kappa}{2}) \\neq 0$. We can cancel the common factor $2\\sin^2(\\frac{\\kappa}{2})$:\n$$\nR(\\kappa) = \\frac{1 + \\frac{10}{3}\\sin^2(\\frac{\\kappa}{2})}{1 + \\frac{22}{3}\\sin^2(\\frac{\\kappa}{2})}.\n$$\nMultiplying the numerator and denominator by $3$ gives the simplified final expression:\n$$\nR(\\kappa) = \\frac{3 + 10\\sin^2(\\frac{\\kappa}{2})}{3 + 22\\sin^2(\\frac{\\kappa}{2})}.\n$$",
            "answer": "$$\n\\boxed{\\frac{3 + 10\\sin^{2}\\left(\\frac{\\kappa}{2}\\right)}{3 + 22\\sin^{2}\\left(\\frac{\\kappa}{2}\\right)}}\n$$"
        },
        {
            "introduction": "Moving from theory to a functional code involves making critical implementation choices. One of the most debated topics for high-order schemes is whether to reconstruct the primitive variables (e.g., $\\rho, u, p$) or the conservative variables (e.g., $\\rho, \\rho u, E$). This hands-on coding challenge tasks you with implementing a WENO scheme to directly compare these two approaches, quantifying their impact on accuracy in a flow with complex, nonlinear thermodynamics .",
            "id": "4077033",
            "problem": "Consider one-dimensional smooth fields for a reactive compressible mixture on a periodic domain $x \\in [0,1]$. Let the primitive variables be density $\\rho(x)$ in kilograms per cubic meter (kg/m$^3$), velocity $u(x)$ in meters per second (m/s), pressure $p(x)$ in Pascals (Pa), and a smooth progress variable $c(x)$ (dimensionless) representing reaction progress. The mixture has a spatially varying specific heat ratio $\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$, and a uniform specific heat release $q$ in Joules per kilogram (J/kg). The equation of state is defined by the specific internal energy\n$$ e(x) = \\frac{p(x)}{(\\gamma(x)-1)\\,\\rho(x)} + q\\,c(x), $$\nand the total energy density\n$$ E(x) = \\rho(x)\\,e(x) + \\tfrac{1}{2}\\,\\rho(x)\\,u(x)^2 = \\frac{p(x)}{\\gamma(x)-1} + \\rho(x)\\,q\\,c(x) + \\tfrac{1}{2}\\,\\rho(x)\\,u(x)^2. $$\nDefine the conservative variables as $U(x) = [\\rho(x),\\;\\rho(x)u(x),\\;E(x)]$.\n\nYou will analyze reconstruction error arising from performing Weighted Essentially Non-Oscillatory (WENO) reconstruction in two different variable sets for smooth test cases with variable $\\gamma$ and heat release $q$:\n- Method P: reconstruct primitive variables $[\\rho, u, p, c]$ to obtain interface values and then map to conservative variables $[\\rho,\\rho u, E]$ via the above thermodynamic relations at the interface.\n- Method C: reconstruct conservative variables $[\\rho,\\rho u, E]$ directly to obtain interface conservative values.\n\nUse a finite-volume discretization with $N$ uniform cells and periodic boundary conditions. For each cell, compute cell averages of both primitive and conservative variables by numerically integrating the exact fields over the cell. Implement a fifth-order finite-volume WENO-JS (Jiang–Shu) reconstruction that produces left-biased interface values at each cell face $x_{i+1/2}$ from cell averages. Do not assume any linearization of the primitive-to-conservative mapping; apply the nonlinear mapping pointwise at interfaces in Method P. For Method C, reconstruct each conservative component independently.\n\nAdopt the following smooth exact fields for all test cases:\n- $\\rho(x) = 1 + 0.2\\,\\cos(2\\pi x)$ in kg/m$^3$,\n- $u(x) = 50 + 10\\,\\sin(2\\pi x + 0.1)$ in m/s,\n- $p(x) = 10^5 + 5\\times 10^3\\,\\cos(2\\pi x + 0.3)$ in Pa,\n- $c(x) = 0.5 + 0.1\\,\\sin(2\\pi x - 0.2)$ (dimensionless),\n- $\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$ (dimensionless), with $\\gamma(x) > 1$ everywhere.\n\nFor each face $x_{i+1/2}$, compute the exact conservative variables $U^{\\mathrm{exact}}(x_{i+1/2})$ by evaluating the exact primitive fields at $x_{i+1/2}$ and applying the equation of state. Compute the reconstructed interface conservative variables $U^{\\mathrm{P}}(x_{i+1/2})$ using Method P and $U^{\\mathrm{C}}(x_{i+1/2})$ using Method C. Quantify the reconstruction error for each method by the aggregated relative $L^2$ error over all interfaces and components:\n$$ \\varepsilon_{\\mathrm{P}} = \\frac{\\left(\\sum\\limits_{i} \\sum\\limits_{k=1}^{3} \\left(U^{\\mathrm{P}}_k(x_{i+1/2}) - U^{\\mathrm{exact}}_k(x_{i+1/2})\\right)^2\\right)^{1/2}}{\\left(\\sum\\limits_{i} \\sum\\limits_{k=1}^{3} \\left(U^{\\mathrm{exact}}_k(x_{i+1/2})\\right)^2\\right)^{1/2}}, \\quad\n\\varepsilon_{\\mathrm{C}} = \\frac{\\left(\\sum\\limits_{i} \\sum\\limits_{k=1}^{3} \\left(U^{\\mathrm{C}}_k(x_{i+1/2}) - U^{\\mathrm{exact}}_k(x_{i+1/2})\\right)^2\\right)^{1/2}}{\\left(\\sum\\limits_{i} \\sum\\limits_{k=1}^{3} \\left(U^{\\mathrm{exact}}_k(x_{i+1/2})\\right)^2\\right)^{1/2}}. $$\nReport, for each test case, the tuple $[\\varepsilon_{\\mathrm{P}},\\;\\varepsilon_{\\mathrm{C}},\\;\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}]$ as three decimal floats.\n\nNumerical integration for cell averages must achieve accuracy consistent with the reconstruction order; use Gaussian quadrature with at least five points per cell. Treat the domain as periodic when accessing neighbor cells for WENO stencils.\n\nTest suite:\n- Case 1 (happy path): $N=80$, $\\gamma_0=1.4$, $\\Delta\\gamma=0.2$, $q=3\\times 10^4$ J/kg.\n- Case 2 (baseline): $N=80$, $\\gamma_0=1.4$, $\\Delta\\gamma=0$, $q=0$ J/kg.\n- Case 3 (strong variation): $N=160$, $\\gamma_0=1.3$, $\\Delta\\gamma=0.25$, $q=8\\times 10^4$ J/kg.\n- Case 4 (coarse grid): $N=40$, $\\gamma_0=1.4$, $\\Delta\\gamma=0.2$, $q=3\\times 10^4$ J/kg.\n\nAll quantities are to be computed using the units specified above; the final reported errors are dimensionless. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is a sublist $[\\varepsilon_{\\mathrm{P}},\\varepsilon_{\\mathrm{C}},\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}]$; for example, a valid output format is `[[a,b,c],[d,e,f],[g,h,i],[j,k,l]]`.",
            "solution": "The problem requires a comparison of reconstruction errors between two approaches for a finite-volume scheme applied to a reactive compressible flow model. The two methods involve performing a fifth-order Weighted Essentially Non-Oscillatory (WENO) reconstruction on either the primitive variables (Method P) or the conservative variables (Method C). The analysis is performed for a smooth, one-dimensional periodic problem with a specified equation of state that includes a variable specific heat ratio $\\gamma(x)$ and a heat release term $q$.\n\nThe solution is implemented by following these steps:\n1.  Define the computational grid and the exact analytical solution for all flow variables.\n2.  Compute the cell averages of the required variables (primitive for Method P, conservative for Method C) by numerically integrating the exact solution over each cell.\n3.  Implement the fifth-order WENO-JS reconstruction algorithm to obtain left-biased values at cell interfaces from the cell averages.\n4.  Apply the two methods to compute the conservative state vector at each cell interface.\n5.  Calculate the exact conservative state vector at each interface for comparison.\n6.  Compute the aggregated relative $L^2$ error for each method to quantify their accuracy.\n7.  Repeat the process for all specified test cases.\n\n**1. Grid, Exact Solution, and State Variables**\n\nThe one-dimensional periodic domain $x \\in [0,1]$ is discretized into $N$ uniform cells, $C_i = [x_{i-1/2}, x_{i+1/2}]$, for $i=0, 1, \\dots, N-1$. The cell width is $\\Delta x = 1/N$, cell centers are $x_i = (i+0.5)\\Delta x$, and cell interfaces are at $x_{i+1/2} = (i+1)\\Delta x$.\n\nThe problem provides exact, smooth analytical functions for the primitive variables: density $\\rho(x)$, velocity $u(x)$, pressure $p(x)$, and reaction progress $c(x)$.\nThe specific heat ratio $\\gamma(x)$ is a function of the progress variable: $\\gamma(x) = \\gamma_0 - \\Delta\\gamma\\,c(x)$.\nThe conservative variables $U(x) = [\\rho(x), \\rho(x)u(x), E(x)]^T$ are defined using the thermodynamic relations. The total energy density $E(x)$ is given by:\n$$\nE(x) = \\frac{p(x)}{\\gamma(x)-1} + \\rho(x) q c(x) + \\frac{1}{2}\\rho(x) u(x)^2\n$$\n\n**2. Computation of Cell Averages**\n\nFor a generic function $f(x)$, its cell average over cell $C_i$ is defined as $\\bar{f}_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} f(x) dx$. To achieve an accuracy consistent with the fifth-order reconstruction scheme, this integral is computed numerically using a $5$-point Gaussian quadrature rule. For each cell $C_i$, the integral is calculated and then divided by the cell width $\\Delta x$. This procedure is applied to compute the cell averages of the primitive variables $\\{\\bar{\\rho}_i, \\bar{u}_i, \\bar{p}_i, \\bar{c}_i\\}$ for Method P, and the conservative variables $\\{\\bar{\\rho}_i, \\overline{\\rho u}_i, \\bar{E}_i\\}$ for Method C.\n\n**3. Fifth-Order WENO-JS Reconstruction**\n\nThe core of the numerical method is the fifth-order finite-volume WENO-JS scheme. From a given set of cell averages $\\bar{v}_i$, we reconstruct the left-biased value $v_{i+1/2}^L$ at the interface $x_{i+1/2}$. This reconstruction uses a stencil of $5$ cells centered around cell $i$: $\\{C_{i-2}, C_{i-1}, C_{i}, C_{i+1}, C_{i+2}\\}$. Due to the periodic domain, indices are handled modulo $N$.\n\nThe WENO reconstruction is a nonlinear combination of three $3$rd-order reconstructions, each based on a $3$-cell sub-stencil. For the interface $x_{i+1/2}$, the candidate values are:\n\\begin{align*}\nv_{i+1/2}^{(0)} &= \\frac{1}{3}\\bar{v}_{i-2} - \\frac{7}{6}\\bar{v}_{i-1} + \\frac{11}{6}\\bar{v}_{i} \\\\\nv_{i+1/2}^{(1)} &= -\\frac{1}{6}\\bar{v}_{i-1} + \\frac{5}{6}\\bar{v}_{i} + \\frac{1}{3}\\bar{v}_{i+1} \\\\\nv_{i+1/2}^{(2)} &= \\frac{1}{3}\\bar{v}_{i} + \\frac{5}{6}\\bar{v}_{i+1} - \\frac{1}{6}\\bar{v}_{i+2}\n\\end{align*}\nThe smoothness of the solution on each sub-stencil is measured by smoothness indicators $IS_k$:\n\\begin{align*}\nIS_0 &= \\frac{13}{12}(\\bar{v}_{i-2} - 2\\bar{v}_{i-1} + \\bar{v}_i)^2 + \\frac{1}{4}(\\bar{v}_{i-2} - 4\\bar{v}_{i-1} + 3\\bar{v}_i)^2 \\\\\nIS_1 &= \\frac{13}{12}(\\bar{v}_{i-1} - 2\\bar{v}_i + \\bar{v}_{i+1})^2 + \\frac{1}{4}(\\bar{v}_{i-1} - \\bar{v}_{i+1})^2 \\\\\nIS_2 &= \\frac{13}{12}(\\bar{v}_i - 2\\bar{v}_{i+1} + \\bar{v}_{i+2})^2 + \\frac{1}{4}(3\\bar{v}_i - 4\\bar{v}_{i+1} + \\bar{v}_{i+2})^2\n\\end{align*}\nThese indicators are used to compute the nonlinear weights $\\omega_k$. First, unnormalized weights $\\alpha_k$ are calculated using the optimal linear weights ($d_0=0.1, d_1=0.6, d_2=0.3$):\n$$\n\\alpha_k = \\frac{d_k}{(\\varepsilon + IS_k)^2}, \\quad k = 0, 1, 2\n$$\nwhere $\\varepsilon$ is a small positive number (e.g., $10^{-40}$) to prevent division by zero in smooth regions. The final weights are normalized: $\\omega_k = \\alpha_k / \\sum_{j=0}^{2} \\alpha_j$. The reconstructed value is the weighted sum of the candidates:\n$$\nv_{i+1/2}^L = \\sum_{k=0}^{2} \\omega_k v_{i+1/2}^{(k)}\n$$\n\n**4. Reconstruction Methodologies**\n\n- **Method P:** The WENO-JS reconstruction is applied independently to each set of primitive variable cell averages: $\\{\\bar{\\rho}_i\\}, \\{\\bar{u}_i\\}, \\{\\bar{p}_i\\}, \\{\\bar{c}_i\\}$. This yields interface values $\\rho^L_{i+1/2}, u^L_{i+1/2}, p^L_{i+1/2}, c^L_{i+1/2}$. The conservative state vector $U^{\\mathrm{P}}(x_{i+1/2})$ is then computed by applying the nonlinear equation of state to these reconstructed primitive values at each interface.\n\n- **Method C:** The WENO-JS reconstruction is applied independently to each set of conservative variable cell averages: $\\{\\bar{\\rho}_i\\}, \\{\\overline{\\rho u}_i\\}, \\{\\bar{E}_i\\}$. This directly yields the interface values of the conservative variables, forming the state vector $U^{\\mathrm{C}}(x_{i+1/2})$.\n\n**5. Error Calculation**\n\nFor each method, the reconstruction error is quantified by comparing the reconstructed conservative state vector at the interfaces, $U^{\\mathrm{P}}$ or $U^{\\mathrm{C}}$, against the exact state vector $U^{\\mathrm{exact}}$. The exact vector at each interface $x_{i+1/2}$ is found by evaluating the analytical functions $\\rho(x), u(x), p(x), c(x)$ at $x_{i+1/2}$ and applying the equation of state. The error is measured using the aggregated relative $L^2$ norm, defined as:\n$$\n\\varepsilon = \\frac{\\left( \\sum_{i=0}^{N-1} \\sum_{k=1}^{3} (U_k(x_{i+1/2}) - U^{\\mathrm{exact}}_k(x_{i+1/2}))^2 \\right)^{1/2}}{\\left( \\sum_{i=0}^{N-1} \\sum_{k=1}^{3} (U^{\\mathrm{exact}}_k(x_{i+1/2}))^2 \\right)^{1/2}}\n$$\nThis formula is used to compute both $\\varepsilon_{\\mathrm{P}}$ (for Method P) and $\\varepsilon_{\\mathrm{C}}$ (for Method C). The difference $\\varepsilon_{\\mathrm{P}} - \\varepsilon_{\\mathrm{C}}$ is also computed to directly compare the two methods. For smooth flows, it is generally anticipated that $\\varepsilon_{\\mathrm{P}} < \\varepsilon_{\\mathrm{C}}$ because primitive variables are often smoother and the reconstruction operator does not commute with the nonlinear transformation to conservative variables.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import fixed_quad\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the execution for all test cases.\n    \"\"\"\n\n    def weno5js_recon(v_bar):\n        \"\"\"\n        Performs 5th-order WENO-JS reconstruction for a 1D periodic domain.\n        Computes left-biased values at interfaces v_{i+1/2}^L.\n        This is a vectorized implementation for efficiency.\n        \"\"\"\n        eps = 1e-40\n        d0, d1, d2 = 0.1, 0.6, 0.3\n\n        # Stencil values shifted periodically\n        vm2 = np.roll(v_bar, 2)\n        vm1 = np.roll(v_bar, 1)\n        v0 = v_bar\n        vp1 = np.roll(v_bar, -1)\n        vp2 = np.roll(v_bar, -2)\n\n        # 3rd-order candidate reconstructions at i+1/2\n        v_rec0 = (1/3) * vm2 - (7/6) * vm1 + (11/6) * v0\n        v_rec1 = (-1/6) * vm1 + (5/6) * v0 + (1/3) * vp1\n        v_rec2 = (1/3) * v0 + (5/6) * vp1 - (1/6) * vp2\n\n        # Smoothness indicators\n        is0 = (13/12) * (vm2 - 2*vm1 + v0)**2 + (1/4) * (vm2 - 4*vm1 + 3*v0)**2\n        is1 = (13/12) * (vm1 - 2*v0 + vp1)**2 + (1/4) * (vm1 - vp1)**2\n        is2 = (13/12) * (v0 - 2*vp1 + vp2)**2 + (1/4) * (3*v0 - 4*vp1 + vp2)**2\n        \n        # Nonlinear weights\n        alpha0 = d0 / (eps + is0)**2\n        alpha1 = d1 / (eps + is1)**2\n        alpha2 = d2 / (eps + is2)**2\n        \n        sum_alpha = alpha0 + alpha1 + alpha2\n        \n        w0 = alpha0 / sum_alpha\n        w1 = alpha1 / sum_alpha\n        w2 = alpha2 / sum_alpha\n        \n        # Final reconstructed value\n        v_L = w0 * v_rec0 + w1 * v_rec1 + w2 * v_rec2\n        \n        return v_L\n\n    def compute_cell_avg(func, N):\n        \"\"\"\n        Computes cell averages of a function `func` over N uniform cells in [0,1]\n        using 5-point Gaussian quadrature for integration.\n        \"\"\"\n        dx = 1.0 / N\n        avg = np.zeros(N)\n        for i in range(N):\n            integral_val, _ = fixed_quad(func, i * dx, (i + 1) * dx, n=5)\n            avg[i] = integral_val / dx\n        return avg\n\n    def solve_case(N, gamma0, d_gamma, q):\n        \"\"\"\n        Solves the problem for a single test case.\n        \"\"\"\n        # 1. Setup Grid and Exact Functions\n        dx = 1.0 / N\n        x_interfaces = (np.arange(N) + 1.0) * dx\n        \n        # Exact primitive fields\n        rho_func = lambda x: 1.0 + 0.2 * np.cos(2 * np.pi * x)\n        u_func = lambda x: 50.0 + 10.0 * np.sin(2 * np.pi * x + 0.1)\n        p_func = lambda x: 1e5 + 5e3 * np.cos(2 * np.pi * x + 0.3)\n        c_func = lambda x: 0.5 + 0.1 * np.sin(2 * np.pi * x - 0.2)\n        gamma_func = lambda x: gamma0 - d_gamma * c_func(x)\n\n        # Exact conservative fields\n        rhou_func = lambda x: rho_func(x) * u_func(x)\n        E_func = lambda x: (p_func(x) / (gamma_func(x) - 1.0)\n                            + rho_func(x) * q * c_func(x)\n                            + 0.5 * rho_func(x) * u_func(x)**2)\n        \n        # 2. Compute Exact Interface Values\n        rho_exact_int = rho_func(x_interfaces)\n        u_exact_int = u_func(x_interfaces)\n        p_exact_int = p_func(x_interfaces)\n        c_exact_int = c_func(x_interfaces)\n        gamma_exact_int = gamma_func(x_interfaces)\n\n        U_exact_int = np.zeros((N, 3))\n        U_exact_int[:, 0] = rho_exact_int\n        U_exact_int[:, 1] = rho_exact_int * u_exact_int\n        U_exact_int[:, 2] = (p_exact_int / (gamma_exact_int - 1.0)\n                             + rho_exact_int * q * c_exact_int\n                             + 0.5 * rho_exact_int * u_exact_int**2)\n\n        # 3. Method P: Reconstruct primitives\n        rho_bar = compute_cell_avg(rho_func, N)\n        u_bar = compute_cell_avg(u_func, N)\n        p_bar = compute_cell_avg(p_func, N)\n        c_bar = compute_cell_avg(c_func, N)\n        \n        rho_L_p = weno5js_recon(rho_bar)\n        u_L_p = weno5js_recon(u_bar)\n        p_L_p = weno5js_recon(p_bar)\n        c_L_p = weno5js_recon(c_bar)\n        \n        gamma_L_p = gamma0 - d_gamma * c_L_p\n        \n        U_P_recon = np.zeros((N, 3))\n        U_P_recon[:, 0] = rho_L_p\n        U_P_recon[:, 1] = rho_L_p * u_L_p\n        U_P_recon[:, 2] = (p_L_p / (gamma_L_p - 1.0)\n                           + rho_L_p * q * c_L_p\n                           + 0.5 * rho_L_p * u_L_p**2)\n\n        # 4. Method C: Reconstruct conservatives\n        rhou_bar = compute_cell_avg(rhou_func, N)\n        E_bar = compute_cell_avg(E_func, N)\n        \n        U_C_recon = np.zeros((N, 3))\n        U_C_recon[:, 0] = weno5js_recon(rho_bar) # rho_bar is already computed\n        U_C_recon[:, 1] = weno5js_recon(rhou_bar)\n        U_C_recon[:, 2] = weno5js_recon(E_bar)\n        \n        # 5. Compute Errors\n        norm_exact_sq = np.sum(U_exact_int**2)\n        \n        err_P_sq = np.sum((U_P_recon - U_exact_int)**2)\n        eps_P = np.sqrt(err_P_sq / norm_exact_sq)\n        \n        err_C_sq = np.sum((U_C_recon - U_exact_int)**2)\n        eps_C = np.sqrt(err_C_sq / norm_exact_sq)\n\n        return [eps_P, eps_C, eps_P - eps_C]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, gamma0, d_gamma, q)\n        (80, 1.4, 0.2, 3e4),    # Case 1\n        (80, 1.4, 0.0, 0.0),    # Case 2\n        (160, 1.3, 0.25, 8e4),  # Case 3\n        (40, 1.4, 0.2, 3e4),     # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        N, gamma0, d_gamma, q = case\n        result = solve_case(N, gamma0, d_gamma, q)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}