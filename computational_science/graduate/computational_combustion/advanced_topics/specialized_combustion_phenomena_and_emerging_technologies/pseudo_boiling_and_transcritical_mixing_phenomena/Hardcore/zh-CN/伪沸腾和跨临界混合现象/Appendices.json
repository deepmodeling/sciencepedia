{
    "hands_on_practices": [
        {
            "introduction": "在计算流体动力学（CFD）中，为了提高计算效率，我们常常需要将复杂的流体热力学物性预先计算并存储在表中，构建所谓的“状态关系”。本练习将指导你完成这一基本实践：利用一个简化的比热容（$c_p$）模型来捕捉伪沸腾的核心特征，并由此为跨临界混合过程创建一个从守恒标量（混合分数 $Z$）到热力学变量（温度 $T$）的映射表 $T(Z, p)$。这个练习是连接热力学理论与实用CFD技术的桥梁 ()。",
            "id": "4055428",
            "problem": "您需要为无反应、单组分跨临界射流形式化混合分数定义，并构建一个数值可逆的热化学状态关系，该关系将混合分数映射到指定压力下的温度。然后，您必须在一个完全确定性的程序中实现该计算，该程序为一个预设的测试套件评估此状态关系。\n\n考虑一股流体注入到更热环境中的无反应、单组分跨临界射流。假设恒压混合，并忽略混合热和压缩功。设压力用 $p$ 表示，温度用 $T$ 表示，定压比热容用 $c_{p}$ 表示，比焓用 $h$ 表示。\n\n使用的基本依据：\n- 两股流混合的质量守恒意味着对于任何被动输运的量都存在一个守恒标量。定义两股流混合分数 $Z$，使得任何守恒标量 $\\phi$ 都满足 $\\phi(Z)=Z\\,\\phi_{\\mathrm{jet}}+\\left(1-Z\\right)\\phi_{\\mathrm{env}}$，其中下标分别表示射流和环境流中的值。\n- 在恒定压力下，比焓满足 $h(T,p)=h(T_{\\mathrm{ref}},p)+\\int_{T_{\\mathrm{ref}}}^{T} c_{p}(T',p)\\,dT'$，其中 $T_{\\mathrm{ref}}$ 是任意参考温度，且 $c_{p}(T,p)>0$。\n- 拟沸腾表现为在临界点之上的类 Widom 线 $T_{\\mathrm{w}}(p)$ 附近，$c_{p}(T,p)$ 出现一个峰值，导致 $h(T,p)$ 在 $T_{\\mathrm{w}}(p)$ 附近随 $T$ 急剧变化，同时在 $T$ 上保持严格单调。\n\n用于实际流体表的模型和数值构造：\n- 使用比热容的解析模型，该模型在一个基线上叠加一个高斯峰，\n$$\nc_{p}(T,p)=c_{p,0}+A(p)\\,\\exp\\!\\left(-\\dfrac{\\left(T-T_{\\mathrm{w}}(p)\\right)^{2}}{2\\,\\sigma^{2}}\\right),\n$$\n其中 $c_{p,0}>0$，峰值振幅 $A(p)>0$，宽度 $\\sigma>0$，以及类 Widom 温度 $T_{\\mathrm{w}}(p)$ 由下式给出：\n$$\nT_{\\mathrm{w}}(p)=T_{\\mathrm{c}}+a\\,\\ln\\!\\left(\\dfrac{p}{p_{\\mathrm{c}}}\\right),\n\\quad\nA(p)=A_{0}\\,\\exp\\!\\left(-\\left(\\dfrac{\\ln\\!\\left(p/p_{\\mathrm{c}}\\right)}{b}\\right)^{2}\\right).\n$$\n- 使用以下常数（代表类氧流体）：\n$T_{\\mathrm{c}}=154.6\\,\\mathrm{K}$，$p_{\\mathrm{c}}=5.043\\times 10^{6}\\,\\mathrm{Pa}$，$c_{p,0}=1200\\,\\mathrm{J}\\cdot\\mathrm{kg}^{-1}\\cdot\\mathrm{K}^{-1}$，$A_{0}=20000\\,\\mathrm{J}\\cdot\\mathrm{kg}^{-1}\\cdot\\mathrm{K}^{-1}$，$\\sigma=6\\,\\mathrm{K}$，$a=35\\,\\mathrm{K}$，$b=1.0$。\n- 在从 $T_{\\min}=80\\,\\mathrm{K}$ 到 $T_{\\max}=400\\,\\mathrm{K}$ 的均匀网格上建立一个温度表 $T_{i}$，并使用数值积分从 $h(T_{\\min},p)=0$ 开始制表 $h(T_{i},p)$。\n\n混合分数的定义和状态关系：\n- 将两股流混合分数 $Z$ 定义为恒定压力下比焓的守恒标量插值，\n$$\nh_{\\mathrm{mix}}(Z,p)=Z\\,h\\!\\left(T_{\\mathrm{jet}},p\\right)+\\left(1-Z\\right)\\,h\\!\\left(T_{\\mathrm{env}},p\\right).\n$$\n- 将热化学状态关系 $T(Z,p)$ 定义为求解下式的唯一温度\n$$\nh\\!\\left(T(Z,p),p\\right)=h_{\\mathrm{mix}}(Z,p),\n$$\n其中 $T(Z,p)\\in[T_{\\min},T_{\\max}]$。因为 $c_{p}(T,p)>0$，所以 $h(T,p)$ 关于 $T$ 严格递增，因此对于 $h_{\\mathrm{mix}}(Z,p)\\in[h(T_{\\min},p),h(T_{\\max},p)]$，$T(Z,p)$ 存在且唯一。\n\n程序要求：\n- 实现 $c_{p}(T,p)$ 模型的构建、通过数值积分构建焓表 $h(T,p)$，以及通过表格反查从 $h_{\\mathrm{mix}}(Z,p)$ 获得 $T(Z,p)$ 的反演程序。\n- 使用 $T_{\\mathrm{jet}}=120\\,\\mathrm{K}$ 和 $T_{\\mathrm{env}}=300\\,\\mathrm{K}$。所有温度必须以开尔文表示和返回。所有压力必须以帕斯卡为单位。\n- 最终答案必须是温度 $T(Z,p)$，单位为开尔文，四舍五入到一位小数。\n\n测试套件：\n为以下有序案例列表评估 $T(Z,p)$，每个案例指定为 $(p,Z)$，其中 $p$ 的单位是帕斯卡，$Z$ 是无量纲的：\n$1.$ $(5.5\\times 10^{6},\\,0.0)$，\n$2.$ $(5.5\\times 10^{6},\\,1.0)$，\n$3.$ $(5.5\\times 10^{6},\\,0.5)$，\n$4.$ $(1.0\\times 10^{7},\\,0.5)$，\n$5.$ $(2.0\\times 10^{7},\\,0.5)$，\n$6.$ $(5.5\\times 10^{6},\\,0.2)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其顺序与测试套件相同，例如格式为 $[T_{1},T_{2},T_{3},T_{4},T_{5},T_{6}]$，其中每个 $T_{k}$ 是一个以开尔文为单位的浮点数，四舍五入到一位小数。",
            "solution": "该问题是有效的，因为它在热力学和流体力学方面具有科学依据，提法恰当，客观，并为形式化求解提供了一套完整的定义、模型和数据。任务是计算无反应、单组分跨临界射流中温度 $T$ 作为混合分数 $Z$ 和压力 $p$ 的函数。这种关系 $T(Z,p)$ 被称为热化学状态关系。\n\n解决方案通过遵循问题陈述中概述的步骤构建，这涉及对流体的热物理性质进行建模，然后使用守恒原理来确定混合物状态。\n\n首先，我们使用所提供的解析模型定义组分的定压比热容 $c_p(T,p)$：\n$$\nc_{p}(T,p) = c_{p,0} + A(p)\\,\\exp\\!\\left(-\\dfrac{\\left(T-T_{\\mathrm{w}}(p)\\right)^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n该模型由一个恒定的基线比热容 $c_{p,0}$ 和一个高斯函数组成，用于表示超临界流体中靠近 Widom 线的热容急剧增加，这是一种典型的拟沸腾现象。依赖于压力的峰值振幅 $A(p)$ 和峰值温度 $T_{\\mathrm{w}}(p)$ 由以下公式给出：\n$$\nA(p) = A_{0}\\,\\exp\\!\\left(-\\left(\\dfrac{\\ln\\!\\left(p/p_{\\mathrm{c}}\\right)}{b}\\right)^{2}\\right)\n$$\n$$\nT_{\\mathrm{w}}(p) = T_{\\mathrm{c}} + a\\,\\ln\\!\\left(\\dfrac{p}{p_{\\mathrm{c}}}\\right)\n$$\n所有常数（$T_{\\mathrm{c}}$、$p_{\\mathrm{c}}$、$c_{p,0}$、$A_{0}$、$\\sigma$、$a$、$b$）均已提供。\n\n其次，我们从比热容确定比焓 $h(T,p)$。对于恒压过程，比焓的变化是比热容的积分：\n$$\nh(T,p) = h(T_{\\mathrm{ref}},p) + \\int_{T_{\\mathrm{ref}}}^{T} c_{p}(T',p)\\,dT'\n$$\n问题指定参考状态为 $h(T_{\\min},p)=0$，其中 $T_{\\min}=80\\,\\mathrm{K}$。因此，我们有 $T_{\\mathrm{ref}}=T_{\\min}$ 并且：\n$$\nh(T,p) = \\int_{T_{\\min}}^{T} c_{p}(T',p)\\,dT'\n$$\n该积分是数值计算的。我们在区间 $[T_{\\min}, T_{\\max}] = [80\\,\\mathrm{K}, 400\\,\\mathrm{K}]$ 上建立一个精细的、均匀的温度网格。对于给定的压力 $p$，在该网格的每个点上计算函数 $c_p(T,p)$。然后使用数值积分方法，特别是累积实现的梯形法则，在每个网格点上计算焓 $h(T,p)$。这样就在恒定 $p$ 下创建了一个关于 $T$ 的离散的 $h$ 表。对于此实现，`scipy.integrate.cumulative_trapezoid` 函数非常适合。\n\n第三，我们使用混合分数 $Z$ 的定义。问题指出 $Z$ 是一个守恒标量，并且在给定假设下，对于两股流混合，比焓也是一个守恒标量。因此，混合物的比焓 $h_{\\mathrm{mix}}$ 是两股流（射流和环境）焓的线性插值：\n$$\nh_{\\mathrm{mix}}(Z,p) = Z\\,h_{\\mathrm{jet}} + \\left(1-Z\\right)\\,h_{\\mathrm{env}}\n$$\n其中 $h_{\\mathrm{jet}} = h(T_{\\mathrm{jet}}, p)$ 和 $h_{\\mathrm{env}} = h(T_{\\mathrm{env}}, p)$，且 $T_{\\mathrm{jet}}=120\\,\\mathrm{K}$ 和 $T_{\\mathrm{env}}=300\\,\\mathrm{K}$。$h_{\\mathrm{jet}}$ 和 $h_{\\mathrm{env}}$ 的值是通过在预先计算的焓表上对其各自的温度进行插值得到的。\n\n最后，通过反演函数 $h(T,p)$ 来找到状态关系 $T(Z,p)$。我们寻求满足方程的温度 $T$：\n$$\nh(T, p) = h_{\\mathrm{mix}}(Z,p)\n$$\n由于对于所有 $T$ 和 $p$，比热容 $c_p(T,p)$ 严格为正，比焓 $h(T,p)$ 是 $T$ 的严格单调递增函数。这保证了唯一的反函数 $T(h,p)$ 存在。在计算上，这个反演是通过反向查表来执行的。我们对生成的表使用线性插值，但以焓为自变量，温度为因变量，来找到与计算出的 $h_{\\mathrm{mix}}(Z,p)$ 对应的温度。\n\n对于每个测试案例 $(p, Z)$ 的总体算法如下：\n1.  对于给定的压力 $p$，在一个精细的温度网格 $T_i \\in [80\\,\\mathrm{K}, 400\\,\\mathrm{K}]$ 上生成一个 $c_{p}(T_i, p)$ 表。\n2.  对 $c_p$ 表进行数值积分，以生成一个相应的焓表 $h(T_i, p)$。\n3.  在 $h(T_i, p)$ 表上使用线性插值来找到比焓 $h(T_{\\mathrm{jet}}, p)$ 和 $h(T_{\\mathrm{env}}, p)$。\n4.  使用混合分数法则计算混合焓 $h_{\\mathrm{mix}}(Z, p)$。\n5.  通过在制表数据上使用线性插值来反演函数 $h(T,p)$，以找到对应于 $h_{\\mathrm{mix}}(Z,p)$ 的温度 $T$。\n6.  按要求将所得温度四舍五入到一位小数。\n\n此过程是确定性的，并直接实现了问题陈述中指定的物理过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the temperature T(Z, p) for a transcritical jet\n    based on a thermochemical state relation.\n    \"\"\"\n    \n    # Define physical and model constants\n    T_c = 154.6  # K\n    p_c = 5.043e6  # Pa\n    c_p0 = 1200.0  # J/kg/K\n    A0 = 20000.0  # J/kg/K\n    sigma = 6.0  # K\n    a = 35.0  # K\n    b = 1.0\n\n    # Define problem conditions\n    T_min = 80.0  # K\n    T_max = 400.0  # K\n    T_jet = 120.0  # K\n    T_env = 300.0  # K\n    N_points = 10001 # Number of points for numerical tables\n\n    # Define the temperature grid for tabulation\n    T_grid = np.linspace(T_min, T_max, N_points)\n\n    def get_T_from_Z_p(p, Z):\n        \"\"\"\n        Calculates T(Z,p) by building and inverting the state relation.\n        \n        Args:\n            p (float): Pressure in Pascal.\n            Z (float): Mixture fraction (dimensionless).\n        \n        Returns:\n            float: Temperature in Kelvin.\n        \"\"\"\n        # 1. Calculate pressure-dependent model parameters\n        log_pr = np.log(p / p_c)\n        T_w = T_c + a * log_pr\n        A = A0 * np.exp(-((log_pr / b)**2))\n\n        # 2. Build the specific heat capacity table c_p(T) at pressure p\n        cp_table = c_p0 + A * np.exp(-((T_grid - T_w)**2) / (2 * sigma**2))\n\n        # 3. Build the enthalpy table h(T) by numerical quadrature\n        # h(T) = integral from T_min to T of cp(T') dT'\n        # The reference enthalpy h(T_min, p) is 0.\n        h_integral = cumulative_trapezoid(cp_table, T_grid, initial=0.0)\n        h_table = h_integral\n\n        # 4. Calculate enthalpies of jet and environment streams\n        # Use linear interpolation on the generated tables\n        h_jet = np.interp(T_jet, T_grid, h_table)\n        h_env = np.interp(T_env, T_grid, h_table)\n\n        # 5. Calculate mixture enthalpy using the mixture fraction definition\n        h_mix = Z * h_jet + (1.0 - Z) * h_env\n\n        # 6. Invert the h(T) relation to find T(h_mix)\n        # Use linear interpolation with h as x-axis and T as y-axis\n        T_result = np.interp(h_mix, h_table, T_grid)\n        \n        return T_result\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (5.5e6, 0.0),\n        (5.5e6, 1.0),\n        (5.5e6, 0.5),\n        (1.0e7, 0.5),\n        (2.0e7, 0.5),\n        (5.5e6, 0.2),\n    ]\n\n    results = []\n    for p_case, Z_case in test_cases:\n        temp_result = get_T_from_Z_p(p_case, Z_case)\n        # Format to one decimal place\n        results.append(f\"{temp_result:.1f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在上一练习的基础上，我们将探索伪沸腾现象带来的一个奇特且重要的物理结果。一个有趣的发现是，在跨临界混合过程中，混合物的温度随混合分数的增加并非总是单调变化的。本练习将通过构建一个流体物性依赖于组分的模型，来演示这种有悖于直觉的非单调温度分布现象，揭示跨临界系统中焓和温度之间复杂的相互作用 ()。",
            "id": "4055425",
            "problem": "要求您使用表格化的真实流体热力学性质表示，实现一个基于混合分数的恒压跨临界混合模型，并通过计算证明拟沸腾如何引起温度对混合分数的非单调依赖性。目标是计算混合物温度作为混合分数的函数，并证明即使混合物焓值随混合分数线性增加，温度也可能在混合分数的某个范围内下降后再次升高。所有温度必须以开尔文（K）为单位表示，并四舍五入到三位小数。\n\n基本原理如下。在恒定压力且无化学反应的情况下，两股流体的稳定混合遵循能量守恒，这导致混合物的比焓由混合分数线性插值得到。设混合分数为 $Z \\in [0,1]$，其中 $Z=1$ 代表热流体，$Z=0$ 代表冷流体。设 $T$ 表示温度，$h(T;Z)$ 表示在组分参数为 $Z$ 时的混合物比焓。那么，对于给定的入口流体温度 $T_{\\mathrm{hot}}$ 和 $T_{\\mathrm{cold}}$，混合物焓值为\n$$\nh_{\\mathrm{mix}}(Z) = Z\\,h\\big(T_{\\mathrm{hot}};Z=1\\big) + (1-Z)\\,h\\big(T_{\\mathrm{cold}};Z=0\\big).\n$$\n在组分为 $Z$ 时的混合物温度由下式隐式定义\n$$\nh\\big(T(Z);Z\\big) = h_{\\mathrm{mix}}(Z).\n$$\n比焓满足\n$$\n\\frac{\\partial h}{\\partial T}(T;Z) = c_p(T;Z),\n$$\n其中 $c_p(T;Z)$ 是恒压比热，沿等压线的拟沸腾由 $c_p(T;Z)$ 相对于 $T$ 的极大值轨迹来表征，在超临界区通常被称为 Widom 线的一种形式。在跨临界混合中，$c_p(T;Z)$ 可能会有一个随组分 $Z$ 变化的尖锐峰值；因此，$h(T;Z)$ 不仅通过混合流体焓 $h_{\\mathrm{mix}}(Z)$ 依赖于 $Z$，还通过用于在恒压下反演求解 $T(Z)$ 的、依赖于 $Z$ 的被积函数 $c_p(T;Z)$ 来依赖于 $Z$。当 $h(T;Z)$ 在拟沸腾附近的 $Z$ 敏感性与 $h_{\\mathrm{mix}}(Z)$ 的线性增长相抵消时，$T(Z)$ 的数学行为可能变得非单调。\n\n构建一个恒压混合模型，该模型在固定压力下使用表格化的真实流体性质表示，对每个组分 $Z$ 执行比焓到温度的反演。您不能使用任何外部文件；相反，应在温度网格上以编程方式构建性质表。使用以下 $c_p(T;Z)$ 的参数化表示，该表示旨在模拟超临界拟沸腾行为，同时保持科学上的合理性：\n$$\nc_p(T;Z) = c_0 + \\frac{A(Z)}{1 + \\left(\\frac{T - T_{\\mathrm{pb}}(Z)}{w(Z)}\\right)^2},\n$$\n其中\n$$\nA(Z) = A_0 \\left[1 - \\gamma \\left(2Z - 1\\right)^2\\right], \\quad w(Z) = w_0 \\left[1 + \\frac{1}{2}\\left(Z - \\frac{1}{2}\\right)^2\\right],\n$$\n以及\n$$\nT_{\\mathrm{pb}}(Z) = T_{\\mathrm{pb,base}} + s_1\\left(Z - \\frac{1}{2}\\right) + s_2\\,Z\\left(1 - Z\\right).\n$$\n此处，$c_0$ 是远离拟沸腾区域的基准恒压比热，$A_0$ 设定峰值振幅的大小，$\\gamma$ 调节振幅随 $Z$ 变化的方式，$w_0$ 设定名义上的峰值半宽，$T_{\\mathrm{pb,base}}$ 是基准拟沸腾温度，$s_1$ 和 $s_2$ 控制拟沸腾温度对组分的依赖性。该表示是真实流体表的简化参数化代理；您必须在网格上离散化温度 $T$，并通过数值积分 $c_p(T;Z)$ 来构建每个 $Z$ 对应的 $h(T;Z)$ 表：\n$$\nh(T_i;Z) \\approx h(T_{i-1};Z) + \\frac{1}{2}\\left[c_p(T_{i-1};Z) + c_p(T_i;Z)\\right]\\left(T_i - T_{i-1}\\right),\n$$\n其中对于选定的参考温度 $T_{\\mathrm{ref}}$，$h(T_{\\mathrm{ref}};Z) = 0$。使用 $T_{\\mathrm{ref}} = 250$ K。\n\n对于下面的每个测试用例，按以下步骤操作：\n- 构建温度网格 $T \\in [250,900]$ K，单位间距，即 $T_i = 250 + i$ K。\n- 对于流体焓，通过在给定温度下插值 $h(T;Z)$ 表来计算 $h\\big(T_{\\mathrm{cold}};Z=0\\big)$ 和 $h\\big(T_{\\mathrm{hot}};Z=1\\big)$。\n- 对于混合物温度，对测试套件中指定的每个 $Z$，计算 $h_{\\mathrm{mix}}(Z)$，然后通过查表（单调插值）在相同的 $Z$ 值下反演 $h(T;Z)$ 以获得 $T(Z)$。\n\n目标是生成并汇总一组测试用例在选定混合分数 $Z$ 下的混合物温度，并在至少一个案例中观察到非单调性。\n\n测试套件。使用以下参数值，在 $8$ 兆帕斯卡（MPa）的固定压力下，对三个科学上不同的案例进行模型评估：\n- 案例 1（由于显著的拟沸腾，预期 $T(Z)$ 呈非单调性）：$T_{\\mathrm{cold}} = 300$ K, $T_{\\mathrm{hot}} = 900$ K, $c_0 = 1200$ J/kg-K, $A_0 = 8000$ J/kg-K, $\\gamma = 0.2$, $w_0 = 15$ K, $T_{\\mathrm{pb,base}} = 500$ K, $s_1 = 100$ K, $s_2 = -60$ K。\n- 案例 2（无拟沸腾的边界条件，单调混合）：$T_{\\mathrm{cold}} = 300$ K, $T_{\\mathrm{hot}} = 900$ K, $c_0 = 1200$ J/kg-K, $A_0 = 0$ J/kg-K, $\\gamma = 0.0$, $w_0 = 15$ K, $T_{\\mathrm{pb,base}} = 500$ K, $s_1 = 100$ K, $s_2 = -60$ K。\n- 案例 3（两股流体均低于拟沸腾区域的边缘情况，单调混合）：$T_{\\mathrm{cold}} = 360$ K, $T_{\\mathrm{hot}} = 420$ K, $c_0 = 1200$ J/kg-K, $A_0 = 8000$ J/kg-K, $\\gamma = 0.2$, $w_0 = 15$ K, $T_{\\mathrm{pb,base}} = 500$ K, $s_1 = 100$ K, $s_2 = -60$ K。\n\n对于每个案例，计算在混合分数值 $Z \\in \\{0.0, 0.2, 0.4, 0.6, 0.8, 1.0\\}$ 处的 $T(Z)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内无空格。列表中的每个项目本身也是一个用方括号括起来的逗号分隔列表，包含对应测试案例（按案例1、案例2、案例3的顺序）的六个温度值，单位为开尔文（K），四舍五入到三位小数。例如，外层列表应类似于 $[[\\ldots],[\\ldots],[\\ldots]]$，并且打印的字符串中任何地方都没有空格。",
            "solution": "该问题是有效的，因为它具有科学依据、问题明确且目标客观。它基于热力学和计算建模的既定原则，勾勒出一个清晰的计算任务。所有必要的参数和方法都已提供。\n\n目标是计算恒压跨临界混合过程中混合物温度 $T$ 作为混合分数 $Z$ 的函数。这需要一个使用真实流体热力学性质参数化表示的数值模型。核心任务是证明在涉及拟沸腾的特定条件下，即使混合物的比焓随 $Z$ 线性增加，混合温度 $T(Z)$ 仍可能表现出非单调行为，特别是在 $Z$ 的某个范围内下降。\n\n### 控制原理和方程\n\n控制两种非反应流体稳定、绝热、等压混合的基本原理是能量守恒。设两股流体为冷流（性质在 $Z=0$ 处表示）和热流（在 $Z=1$ 处）。混合分数 $Z$ 的范围从 0 到 1。所得混合物的比焓 $h_{\\mathrm{mix}}$ 是两个初始流焓的线性插值：\n$$\nh_{\\mathrm{mix}}(Z) = (1-Z)h(T_{\\mathrm{cold}}; Z=0) + Z h(T_{\\mathrm{hot}}; Z=1)\n$$\n此处，$h(T_{\\mathrm{cold}}; Z=0)$ 是冷流在其入口温度 $T_{\\mathrm{cold}}$ 时的比焓，而 $h(T_{\\mathrm{hot}}; Z=1)$ 是热流在其入口温度 $T_{\\mathrm{hot}}$ 时的比焓。\n\n虽然混合焓是 $Z$ 的线性函数，但混合温度 $T(Z)$ 不必如此。温度由热力学状态原理隐式定义，该原理关联了焓、温度和组分。对于给定的混合分数 $Z$，温度 $T(Z)$ 必须满足：\n$$\nh(T(Z); Z) = h_{\\mathrm{mix}}(Z)\n$$\n函数 $h(T; Z)$ 表示在温度 $T$ 下组分为 $Z$ 的均质流体的比焓。在恒定压力下，焓和温度之间的关系由等压比热容 $c_p(T;Z)$ 给出：\n$$\n\\left(\\frac{\\partial h}{\\partial T}\\right)_{p,Z} = c_p(T;Z)\n$$\n在跨临界混合中，一个或两个流体是超临界的，但混合路径可能穿过拟沸腾线（$c_p$ 极大值的轨迹）。在这条线附近，$c_p(T;Z)$ 表现出一个尖锐的峰值，这使得焓函数 $h(T;Z)$ 对于 $T$ 和 $Z$ 都具有高度非线性。$T(Z)$ 的非单调行为源于这种强烈的耦合依赖性。\n\n### 代理性质模型\n\n为了模拟这种现象，提供了一个比热 $c_p(T;Z)$ 的参数化代理模型。该模型捕捉了拟沸腾的基本特征——$c_p$ 中的一个峰值，其特性取决于混合物组分 $Z$。$c_p(T;Z)$ 的方程是一个基线常数加上一个洛伦兹函数：\n$$\nc_p(T;Z) = c_0 + \\frac{A(Z)}{1 + \\left(\\frac{T - T_{\\mathrm{pb}}(Z)}{w(Z)}\\right)^2}\n$$\n洛伦兹峰的参数本身是混合分数 $Z$ 的函数：\n- 振幅 $A(Z)$，决定峰高：\n  $$\n  A(Z) = A_0 \\left[1 - \\gamma \\left(2Z - 1\\right)^2\\right]\n  $$\n- 半宽 $w(Z)$，决定峰的锐度：\n  $$\n  w(Z) = w_0 \\left[1 + \\frac{1}{2}\\left(Z - \\frac{1}{2}\\right)^2\\right]\n  $$\n- 峰值温度 $T_{\\mathrm{pb}}(Z)$，即对于给定 $Z$，$c_p$ 达到最大值时的温度：\n  $$\n  T_{\\mathrm{pb}}(Z) = T_{\\mathrm{pb,base}} + s_1\\left(Z - \\frac{1}{2}\\right) + s_2\\,Z\\left(1 - Z\\right)\n  $$\n常数 $c_0, A_0, \\gamma, w_0, T_{\\mathrm{pb,base}}, s_1,$ 和 $s_2$ 在每个测试用例中给出。\n\n### 数值程序\n\n对每个测试用例，问题通过一系列数值步骤来解决。\n\n1.  **表格生成**：必须在计算网格上对性质的连续函数进行离散化。\n    - 从 $T=250$ K 到 $T=900$ K 建立一个间距为 $1$ K 的均匀温度网格 $T_i$。\n    - 对于给定的组分 $Z$，在每个网格点上计算比热 $c_p(T_i; Z)$。\n    - 从参考状态 $h(T_{\\mathrm{ref}};Z) = 0$（其中 $T_{\\mathrm{ref}} = 250$ K）开始，使用梯形法则对 $c_p(T;Z)$ 关于 $T$ 进行数值积分，构建比焓表 $h(T_i; Z)$：\n      $$\n      h(T_i;Z) = h(T_{i-1};Z) + \\frac{1}{2}\\left[c_p(T_{i-1};Z) + c_p(T_i;Z)\\right]\\left(T_i - T_{i-1}\\right)\n      $$\n\n2.  **流焓计算**：确定纯冷流（$Z=0$）和纯热流（$Z=1$）的焓。\n    - 如上所述生成焓表 $h(T;Z=0)$。通过在该表上对 $T = T_{\\mathrm{cold}}$ 进行线性插值，找到冷流的比焓 $h_{\\mathrm{cold}}$。\n    - 同样，生成焓表 $h(T;Z=1)$，并通过在该表上对 $T = T_{\\mathrm{hot}}$ 进行线性插值，找到热流的比焓 $h_{\\mathrm{hot}}$。\n\n3.  **混合温度计算**：对于每个指定的样本混合分数 $Z_k \\in \\{0.0, 0.2, 0.4, 0.6, 0.8, 1.0\\}$，计算相应的混合温度 $T(Z_k)$。\n    - 使用线性混合法则计算目标混合焓：$h_{\\mathrm{mix}}(Z_k) = (1-Z_k)h_{\\mathrm{cold}} + Z_k h_{\\mathrm{hot}}$。\n    - 为此特定混合分数 $Z_k$ 生成一个焓表 $h(T;Z_k)$。\n    - 反演函数 $h(T;Z_k)$ 以找到与 $h_{\\mathrm{mix}}(Z_k)$ 对应的温度 $T(Z_k)$。由于 $c_p(T;Z)$ 总是正的，对于任何固定的 $Z$，$h(T;Z)$ 在 $T$ 上是严格单调的。这保证了 $T(Z_k)$ 的唯一解，可以通过对从 $h(T_i; Z_k)$ 到 $T_i$ 的离散映射进行线性插值来找到该解。\n\n将此程序应用于所有三个测试用例，并收集和格式化每组 $Z_k$ 值的所得温度。在案例1中，混合路径从 $T_{\\mathrm{cold}}=300$ K 到 $T_{\\mathrm{hot}}=900$ K 穿过随 $Z$ 移动的拟沸腾区域，预期会出现非单调温度分布。案例2（$A_0=0$）代表具有恒定 $c_p$ 的理想混合，产生线性温度分布。案例3的入口温度范围很窄（$360$ K 到 $420$ K），完全位于拟沸腾区域以下，预期将导致单调混合。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Solves the transcritical mixing problem for three test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: Expected nonmonotonic T(Z) due to pronounced pseudo-boiling\n        {'T_cold': 300.0, 'T_hot': 900.0, 'c0': 1200.0, 'A0': 8000.0, 'gamma': 0.2, 'w0': 15.0, 'T_pb_base': 500.0, 's1': 100.0, 's2': -60.0},\n        # Case 2: Boundary condition with no pseudo-boiling (A0=0)\n        {'T_cold': 300.0, 'T_hot': 900.0, 'c0': 1200.0, 'A0': 0.0, 'gamma': 0.0, 'w0': 15.0, 'T_pb_base': 500.0, 's1': 100.0, 's2': -60.0},\n        # Case 3: Edge case with both streams below pseudo-boiling region\n        {'T_cold': 360.0, 'T_hot': 420.0, 'c0': 1200.0, 'A0': 8000.0, 'gamma': 0.2, 'w0': 15.0, 'T_pb_base': 500.0, 's1': 100.0, 's2': -60.0},\n    ]\n\n    Z_samples = [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]\n    T_ref = 250.0\n    T_grid = np.arange(T_ref, 901.0, 1.0)\n\n    all_results = []\n\n    for case in test_cases:\n        # Unpack parameters for clarity\n        T_cold, T_hot = case['T_cold'], case['T_hot']\n        c0, A0, gamma = case['c0'], case['A0'], case['gamma']\n        w0, T_pb_base = case['w0'], case['T_pb_base']\n        s1, s2 = case['s1'], case['s2']\n\n        # Define the parametric functions for cp(T, Z)\n        def A_func(Z):\n            return A0 * (1.0 - gamma * (2.0 * Z - 1.0)**2)\n\n        def w_func(Z):\n            return w0 * (1.0 + 0.5 * (Z - 0.5)**2)\n\n        def T_pb_func(Z):\n            return T_pb_base + s1 * (Z - 0.5) + s2 * Z * (1.0 - Z)\n\n        def cp_func(T, Z):\n            A = A_func(Z)\n            if A == 0:\n                # np.full is slightly more efficient than broadcasting a scalar\n                return np.full_like(T, c0)\n            \n            w = w_func(Z)\n            T_pb = T_pb_func(Z)\n            lorentzian = A / (1.0 + ((T - T_pb) / w)**2)\n            return c0 + lorentzian\n\n        memo_h_tables = {}\n        def get_h_table(Z):\n            # Memoization to avoid recomputing enthalpy tables for the same Z\n            if Z in memo_h_tables:\n                return memo_h_tables[Z]\n            \n            cp_vals = cp_func(T_grid, Z)\n            # Integrate cp to get h, with h(T_ref) = 0\n            h_table = cumulative_trapezoid(cp_vals, T_grid, initial=0.0)\n            memo_h_tables[Z] = h_table\n            return h_table\n\n        # Step 1: Calculate stream enthalpies\n        h_table_cold = get_h_table(0.0)\n        h_cold = np.interp(T_cold, T_grid, h_table_cold)\n\n        h_table_hot = get_h_table(1.0)\n        h_hot = np.interp(T_hot, T_grid, h_table_hot)\n        \n        case_temperatures = []\n        # Step 2: Calculate mixture temperature for each Z sample\n        for Z in Z_samples:\n            if Z == 0.0:\n                T_mix = T_cold\n            elif Z == 1.0:\n                T_mix = T_hot\n            else:\n                # Calculate target mixture enthalpy\n                h_mix_target = (1.0 - Z) * h_cold + Z * h_hot\n                \n                # Get the enthalpy table for the current mixture fraction Z\n                h_table_mix = get_h_table(Z)\n                \n                # Invert h(T;Z) by interpolating T as a function of h\n                # np.interp(x, xp, fp) where we want T(h) so x=h_mix_target, xp=h_table_mix, fp=T_grid\n                T_mix = np.interp(h_mix_target, h_table_mix, T_grid)\n            \n            case_temperatures.append(round(T_mix, 3))\n        \n        all_results.append(case_temperatures)\n\n    # Format the final output string according to the specification\n    inner_strings = []\n    for res in all_results:\n        # Format each number to 3 decimal places, handling cases like 300.0 -> 300.000\n        formatted_res = [f\"{t:.3f}\" for t in res]\n        inner_strings.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_string = f\"[{','.join(inner_strings)}]\"\n    print(final_string)\n\nsolve()\n```"
        },
        {
            "introduction": "现在，我们将从简化的参数模型转向更为严谨的物理建模方法，即直接使用真实流体状态方程（EoS），如 Peng-Robinson EoS。本练习要求你从第一性原理出发，通过实现状态方程来计算热力学性质，确定伪沸腾状态，并预测其在混合层中的物理位置 ()。这项练习代表了本领域的一项高级综合技能，它将基础热力学与流体动力学结构的分析直接联系起来。",
            "id": "4055399",
            "problem": "考虑一个在均匀超临界压力下的两个平行流之间的单组分、稳态、一维平面剪切层。一股由甲烷组成的冷的、稠密的射流与一股热的、较轻的伴流混合，两者均为甲烷，且压力相同。令坐标 $y \\in [0,L]$ 表示横向流向，其中 $y=0$ 位于射流侧，$y=L$ 位于环境侧。目标是利用守恒原理和真实流体状态方程（EoS），预测剪切层内局部温度等于伪沸腾温度 $T_{pb}$ 的位置 $y_{pb}$。\n\n假设和基本依据：\n- 流动是稳态、一维的，压力 $P$ 在 $y$ 方向上是均匀且恒定的。\n- 无化学反应，无体积热源。流动是单组分甲烷，所有输运在 $y$ 方向上纯粹是扩散性的。\n- 由于流体是单组分，各处的组分质量分数均为1，但温度和焓由于热扩散和混合而变化。\n- 混合分数 $\\,\\xi(y)\\,$ 是一个守恒标量，满足具有恒定扩散系数的稳态扩散方程：$\\dfrac{d}{dy}\\left( \\Gamma \\dfrac{d\\xi}{dy} \\right) = 0$，边界条件为 $\\xi(0)=1$ 和 $\\xi(L)=0$，这意味着一个线性剖面 $\\xi(y) = 1 - y/L$。\n- 在 Lewis 数为 1 且显焓和混合分数的扩散系数相等的情况下，比焓（以摩尔为基准）是混合分数的线性函数：$h(y) = \\xi(y)\\, h_j + [1 - \\xi(y)]\\, h_a$，其中 $h_j = h(T_j,P)$ 是射流侧的摩尔焓，$h_a = h(T_a,P)$ 是环境侧的摩尔焓。\n- 摩尔焓被建模为 $h(T,P) = h^{\\mathrm{ideal}}(T) + h^{\\mathrm{res}}(T,P)$，其中 $h^{\\mathrm{ideal}}(T)$ 是理想气体焓，$h^{\\mathrm{res}}(T,P)$ 是由立方体真实流体状态方程引起的非理想效应导致的剩余焓。\n- 理想气体焓被建模为 $h^{\\mathrm{ideal}}(T) = c_{p,\\mathrm{ideal}}\\, T$，其中 $c_{p,\\mathrm{ideal}}$ 是恒定的摩尔热容，参考零点在 $T=0\\,\\mathrm{K}$。在线性混合假设下，这种选择一致地保持了焓差。\n- 真实流体状态方程是 Peng–Robinson 状态方程 (PR EoS)。对于纯流体，PR EoS 的参数为\n  $$ a = 0.45724 \\dfrac{R^2 T_c^2}{P_c} \\,\\alpha(T), \\quad b = 0.07780 \\dfrac{R T_c}{P_c}, $$\n  $$ \\alpha(T) = \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right]^2, \\quad \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2, $$\n  其中 $R$ 是普适气体常数，$T_c$ 是临界温度，$P_c$ 是临界压力，$\\omega$ 是偏心因子。定义\n  $$ A = \\dfrac{a P}{R^2 T^2}, \\quad B = \\dfrac{b P}{R T}, $$\n  压缩因子 $Z$ 是以下方程的实根\n  $$ Z^3 - (1 - B) Z^2 + (A - 3 B^2 - 2 B) Z - (A B - B^2 - B^3) = 0. $$\n  对于超临界单相条件，选择最大的实根来代表类气相。摩尔密度通过以下关系式给出\n  $$ \\rho_{\\mathrm{mol}}(T,P) = \\dfrac{P}{Z R T}, \\quad \\rho_{\\mathrm{mass}}(T,P) = \\dfrac{M P}{Z R T}, $$\n  其中 $M$ 是摩尔质量。\n- Peng–Robinson 方程的剩余焓为\n  $$ h^{\\mathrm{res}}(T,P) = R T (Z - 1) + \\dfrac{T \\dfrac{da}{dT} - a}{2 \\sqrt{2}\\, b} \\,\\ln\\!\\left( \\dfrac{Z + (1 + \\sqrt{2}) B}{Z + (1 - \\sqrt{2}) B} \\right), $$\n  其中\n  $$ \\dfrac{da}{dT} = 0.45724 \\dfrac{R^2 T_c^2}{P_c}\\, \\dfrac{d\\alpha}{dT}, \\quad \\dfrac{d\\alpha}{dT} = - \\dfrac{\\kappa}{T_c} \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right] \\dfrac{1}{\\sqrt{\\dfrac{T}{T_c}}}. $$\n- 沿等压线，伪沸腾温度 $T_{pb}$ 在此定义为质量密度的等压温度导数的绝对值达到最大时的温度：\n  $$ T_{pb}(P) = \\underset{T}{\\mathrm{argmax}}\\;\\left| \\left(\\dfrac{\\partial \\rho_{\\mathrm{mass}}}{\\partial T}\\right)_{P} \\right|. $$\n  这个定义与 Widom 线的概念一致，即超临界流体中响应函数极大值的轨迹。\n\n计算任务：\n- 对于甲烷，使用以下常数：$T_c = 190.564\\,\\mathrm{K}$，$P_c = 4.5992\\times 10^{6}\\,\\mathrm{Pa}$，$\\omega = 0.01142$，$M = 0.016043\\,\\mathrm{kg/mol}$，$R = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$，以及 $c_{p,\\mathrm{ideal}} = 35.0\\,\\mathrm{J/(mol\\cdot K)}$。\n- 对于下面的每个测试用例，通过在区间 $[0.7 T_c, 3.0 T_c]$ 内扫描温度 $T$ 并在均匀网格上使用中心有限差分近似来定位 $\\left|\\partial \\rho_{\\mathrm{mass}}/\\partial T\\right|_{P}$ 的最大值，从而计算 $T_{pb}(P)$。使用 $1\\,\\mathrm{K}$ 的温度步长。\n- 计算 $h_j = h(T_j,P)$、$h_a = h(T_a,P)$ 和 $h_{pb} = h(T_{pb},P)$。在线性焓混合模型下，温度为 $T=T_{pb}$ 时的混合分数为\n  $$ \\xi_{pb} = \\dfrac{h_{pb} - h_a}{h_j - h_a}, $$\n  位置为\n  $$ y_{pb} = L\\,(1 - \\xi_{pb}). $$\n- 如果 $T_{pb}$ 不在温度区间 $[\\min(T_j,T_a),\\, \\max(T_j,T_a)]$ 内，则输出 $y_{pb} = -1.0$，因为在剪切层内未达到伪沸腾状态。\n- 如果 $h_j \\approx h_a$（在一个小的数值容差内，表示没有焓梯度），则输出 $y_{pb} = -1.0$。\n\n答案单位和输出格式：\n- 将 $y_{pb}$ 以米为单位表示，为浮点数并四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2,result3]”）。\n\n测试套件：\n- 案例 1（具有宽温度范围的典型跨临界混合）：$P = 8.0\\times 10^{6}\\,\\mathrm{Pa}$，$T_j = 140\\,\\mathrm{K}$，$T_a = 340\\,\\mathrm{K}$，$L = 3.0\\times 10^{-3}\\,\\mathrm{m}$。\n- 案例 2（窄的暖混合范围，可能高于伪沸腾温度）：$P = 8.0\\times 10^{6}\\,\\mathrm{Pa}$，$T_j = 240\\,\\mathrm{K}$，$T_a = 260\\,\\mathrm{K}$，$L = 2.0\\times 10^{-3}\\,\\mathrm{m}$。\n- 案例 3（近临界压力带，具有中等温度范围）：$P = 4.6\\times 10^{6}\\,\\mathrm{Pa}$，$T_j = 150\\,\\mathrm{K}$，$T_a = 220\\,\\mathrm{K}$，$L = 4.0\\times 10^{-3}\\,\\mathrm{m}$。\n- 案例 4（冷混合范围，可能低于伪沸腾温度）：$P = 1.2\\times 10^{7}\\,\\mathrm{Pa}$，$T_j = 130\\,\\mathrm{K}$，$T_a = 160\\,\\mathrm{K}$，$L = 1.5\\times 10^{-3}\\,\\mathrm{m}$。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据、提法恰当且客观。所提供的物理模型基于 Peng-Robinson 状态方程 (PR EoS) 和标准输运现象假设，是一致且完整的。计算任务定义清晰，包含了所有必要的常数、方程和边界条件，从而可以得到一个唯一且可验证的解。\n\n求解过程首先基于甲烷的 PR EoS 实现热力学性质计算。随后，进行数值搜索以确定伪沸腾温度。最后，使用线性焓混合法则，为每个测试用例确定剪切层内与此温度对应的空间位置。\n\n整体算法结构如下：\n\n1.  **Peng-Robinson EoS 和热力学性质：** 开发一组函数来计算作为温度 $T$ 和压力 $P$ 的函数的热力学性质。\n    - 参数 $\\kappa$、$b$ 以及与温度相关的项 $\\alpha(T)$ 是根据给定的流体性质计算得出：临界温度 $T_c$、临界压力 $P_c$ 和偏心因子 $\\omega$。\n    $$ \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2 $$\n    $$ b = 0.07780 \\dfrac{R T_c}{P_c} $$\n    $$ \\alpha(T) = \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right]^2 $$\n    - 然后计算参数 $a(T)$：\n    $$ a(T) = 0.45724 \\dfrac{R^2 T_c^2}{P_c} \\,\\alpha(T) $$\n    - 利用 $a(T)$ 和 $b$，确定无量纲参数 $A$ 和 $B$：\n    $$ A = \\dfrac{a(T) P}{R^2 T^2}, \\quad B = \\dfrac{b P}{R T} $$\n    - 通过求解三次 PR EoS 找到压缩因子 $Z$。该方程被重排为标准多项式形式，$Z^3 + c_2 Z^2 + c_1 Z + c_0 = 0$，其中：\n    $$ c_2 = -(1 - B) $$\n    $$ c_1 = A - 3 B^2 - 2 B $$\n    $$ c_0 = -(A B - B^2 - B^3) $$\n    求解该多项式的根。根据对超临界单相条件的规定，选择最大的实根作为有效的压缩因子 $Z$。\n    - 使用确定的 $Z$ 值计算质量密度 $\\rho_{\\mathrm{mass}}(T,P)$：\n    $$ \\rho_{\\mathrm{mass}}(T,P) = \\dfrac{M P}{Z R T} $$\n    - 摩尔焓 $h(T,P)$ 计算为理想气体部分 $h^{\\mathrm{ideal}}(T)$ 和剩余部分 $h^{\\mathrm{res}}(T,P)$ 的和。\n    $$ h^{\\mathrm{ideal}}(T) = c_{p,\\mathrm{ideal}}\\, T $$\n    剩余焓由 PR EoS 公式给出：\n    $$ h^{\\mathrm{res}}(T,P) = R T (Z - 1) + \\dfrac{T \\dfrac{da}{dT} - a}{2 \\sqrt{2}\\, b} \\,\\ln\\!\\left( \\dfrac{Z + (1 + \\sqrt{2}) B}{Z + (1 - \\sqrt{2}) B} \\right) $$\n    导数 $\\dfrac{da}{dT}$ 通过解析方式计算：\n    $$ \\dfrac{d\\alpha}{dT} = - \\dfrac{\\kappa}{T_c} \\left[1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}}\\right)\\right] \\dfrac{1}{\\sqrt{\\dfrac{T}{T_c}}} $$\n    $$ \\dfrac{da}{dT} = 0.45724 \\dfrac{R^2 T_c^2}{P_c}\\, \\dfrac{d\\alpha}{dT} $$\n\n2.  **伪沸腾温度 $T_{pb}$ 计算：** 对于给定的压力 $P$，通过找到质量密度的等压温度导数绝对值最大时的温度来确定伪沸腾温度 $T_{pb}$。\n    - 在区间 $[0.7 T_c, 3.0 T_c]$ 上创建一个离散温度网格，步长为 $\\Delta T = 1\\,\\mathrm{K}$。\n    - 在此网格上的每个温度点计算质量密度 $\\rho_{\\mathrm{mass}}(T,P)$。\n    - 在每个网格点 $T_i$（不包括边界），使用二阶中心有限差分格式近似计算导数 $(\\partial \\rho_{\\mathrm{mass}} / \\partial T)_P$：\n    $$ \\left(\\dfrac{\\partial \\rho_{\\mathrm{mass}}}{\\partial T}\\right)_{P, T=T_i} \\approx \\dfrac{\\rho_{\\mathrm{mass}}(T_{i+1}, P) - \\rho_{\\mathrm{mass}}(T_{i-1}, P)}{2 \\Delta T} $$\n    - 将对应于 $|\\partial \\rho_{\\mathrm{mass}} / \\partial T|_P$ 最大值的温度确定为 $T_{pb}$。\n\n3.  **剪切层位置 $y_{pb}$ 计算：** 为每个测试用例计算位置 $y_{pb}$。\n    - 首先为给定的系统压力 $P$ 确定伪沸腾温度 $T_{pb}$。\n    - 检查 $T_{pb}$ 是否落在剪切层的温度范围 $[\\min(T_j,T_a), \\max(T_j,T_a)]$ 内。如果不在此范围内，则伪沸腾状态在混合层内物理上无法实现，位置设为 $y_{pb} = -1.0$。\n    - 如果 $T_{pb}$ 在有效范围内，则使用步骤 1 中的热力学函数计算射流边界的摩尔焓 $h_j = h(T_j, P)$、环境边界的摩尔焓 $h_a = h(T_a, P)$ 以及伪沸腾温度下的摩尔焓 $h_{pb} = h(T_{pb}, P)$。\n    - 检查焓梯度。如果 $h_j$ 和 $h_a$ 几乎相等（即 $|h_j - h_a|  10^{-9}$），则混合分数计算中的分母会变得不适定，我们将 $y_{pb}$ 设为 -1.0。\n    - 温度为 $T_{pb}$ 时的混合分数 $\\xi_{pb}$ 使用线性焓混合法则找到：\n    $$ \\xi_{pb} = \\dfrac{h_{pb} - h_a}{h_j - h_a} $$\n    - 最后，根据线性混合分数剖面 $\\xi(y) = 1 - y/L$ 计算空间位置 $y_{pb}$：\n    $$ y_{pb} = L\\,(1 - \\xi_{pb}) $$\n    结果按要求四舍五入到六位小数。整个过程被封装到一个程序中，用于处理给定的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the pseudo-boiling position in a transcritical shear layer.\n    \"\"\"\n    \n    # Constants for Methane\n    METHANE_CONSTANTS = {\n        'Tc': 190.564,          # K\n        'Pc': 4.5992e6,         # Pa\n        'omega': 0.01142,       # acentric factor\n        'M': 0.016043,          # kg/mol\n        'R': 8.314462618,       # J/(mol.K)\n        'cp_ideal': 35.0,       # J/(mol.K)\n    }\n\n    class ThermodynamicCalculator:\n        \"\"\"\n        A class to calculate thermodynamic properties based on the Peng-Robinson EoS.\n        \"\"\"\n        def __init__(self, constants):\n            self.const = constants\n            # Pre-calculate constant parts of PR EoS parameters\n            self.kappa = (0.37464 + 1.54226 * self.const['omega'] \n                          - 0.26992 * self.const['omega']**2)\n            self.b = 0.07780 * self.const['R'] * self.const['Tc'] / self.const['Pc']\n            self.ac_factor = 0.45724 * self.const['R']**2 * self.const['Tc']**2 / self.const['Pc']\n            self.sqrt2 = np.sqrt(2)\n\n        def get_properties_at_T_P(self, T, P):\n            \"\"\"\n            Computes a full set of thermodynamic properties at a given T and P.\n            \"\"\"\n            # Calculate alpha(T) and its derivative\n            Tr = T / self.const['Tc']\n            sqrt_Tr = np.sqrt(Tr)\n            alpha_term = 1 + self.kappa * (1 - sqrt_Tr)\n            alpha = alpha_term**2\n            \n            dalpha_dT_term = 1 + self.kappa * (1 - sqrt_Tr)\n            dalpha_dT = - (self.kappa / (self.const['Tc'] * sqrt_Tr)) * dalpha_dT_term\n\n            # Calculate a(T) and its derivative\n            a = self.ac_factor * alpha\n            da_dT = self.ac_factor * dalpha_dT\n\n            # Calculate dimensionless groups A and B\n            A = a * P / (self.const['R']**2 * T**2)\n            B = self.b * P / (self.const['R'] * T)\n\n            # Solve cubic equation for Z\n            coeffs = [\n                1,\n                -(1 - B),\n                A - 3 * B**2 - 2 * B,\n                -(A * B - B**2 - B**3)\n            ]\n            roots = np.roots(coeffs)\n            real_roots = roots[np.isreal(roots)].real\n            if not real_roots.any():\n                # Should not happen in supercritical state, but as a fallback\n                raise ValueError(f\"No real roots for Z at T={T} K, P={P} Pa\")\n            Z = np.max(real_roots)\n            \n            return Z, a, A, B, da_dT\n\n        def get_rho_mass(self, T, P):\n            \"\"\"Calculates mass density.\"\"\"\n            Z, _, _, _, _ = self.get_properties_at_T_P(T, P)\n            rho_mass = self.const['M'] * P / (Z * self.const['R'] * T)\n            return rho_mass\n\n        def get_h(self, T, P):\n            \"\"\"Calculates molar enthalpy.\"\"\"\n            Z, a, _, B, da_dT = self.get_properties_at_T_P(T, P)\n            \n            # Ideal gas enthalpy\n            h_ideal = self.const['cp_ideal'] * T\n            \n            # Residual enthalpy\n            ln_term_num = Z + (1 + self.sqrt2) * B\n            ln_term_den = Z + (1 - self.sqrt2) * B\n            \n            if ln_term_num = 0 or ln_term_den = 0:\n                # Fallback if log argument becomes non-positive\n                h_res = self.const['R'] * T * (Z - 1)\n            else:\n                log_term = np.log(ln_term_num / ln_term_den)\n                h_res = (self.const['R'] * T * (Z - 1) + \n                         (T * da_dT - a) / (2 * self.sqrt2 * self.b) * log_term)\n            \n            return h_ideal + h_res\n\n    def find_Tpb(P, calculator):\n        \"\"\"\n        Finds the pseudo-boiling temperature by finding the max of |d(rho)/dT|_P.\n        \"\"\"\n        Tc = calculator.const['Tc']\n        T_min_scan, T_max_scan = 0.7 * Tc, 3.0 * Tc\n        T_step = 1.0\n        \n        T_range = np.arange(T_min_scan, T_max_scan + T_step, T_step)\n        \n        try:\n            rho_values = np.array([calculator.get_rho_mass(T, P) for T in T_range])\n        except ValueError:\n            return -1 # Indicate failure if Z calculation fails in the range\n\n        # Central difference for derivative\n        d_rho_dT = (rho_values[2:] - rho_values[:-2]) / (2 * T_step)\n        \n        if len(d_rho_dT) == 0:\n            return -1 # Not enough points\n            \n        # Find T corresponding to max |d(rho)/dT|\n        max_idx = np.argmax(np.abs(d_rho_dT))\n        Tpb = T_range[max_idx + 1] # +1 because derivative array is offset\n        \n        return Tpb\n\n    # Initialize calculator\n    calc = ThermodynamicCalculator(METHANE_CONSTANTS)\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (P in Pa, Tj in K, Ta in K, L in m)\n        (8.0e6, 140.0, 340.0, 3.0e-3), # Case 1\n        (8.0e6, 240.0, 260.0, 2.0e-3), # Case 2\n        (4.6e6, 150.0, 220.0, 4.0e-3), # Case 3\n        (1.2e7, 130.0, 160.0, 1.5e-3), # Case 4\n    ]\n\n    results = []\n    TOLERANCE = 1e-9\n\n    for P, Tj, Ta, L in test_cases:\n        Tpb = find_Tpb(P, calc)\n        \n        T_mix_min = min(Tj, Ta)\n        T_mix_max = max(Tj, Ta)\n        \n        if Tpb  T_mix_min or Tpb > T_mix_max:\n            results.append(-1.0)\n            continue\n            \n        try:\n            hj = calc.get_h(Tj, P)\n            ha = calc.get_h(Ta, P)\n            hpb = calc.get_h(Tpb, P)\n        except ValueError:\n            results.append(-1.0) # Calculation failed\n            continue\n\n        if abs(hj - ha)  TOLERANCE:\n            results.append(-1.0)\n            continue\n            \n        xi_pb = (hpb - ha) / (hj - ha)\n        \n        # Check if xi_pb is physically meaningful (between 0 and 1)\n        if not (0.0 = xi_pb = 1.0):\n             # This can happen if T-h relation is non-monotonic or Tpb is outside T range\n            results.append(-1.0)\n            continue\n\n        y_pb = L * (1.0 - xi_pb)\n        \n        results.append(round(y_pb, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}