{
    "hands_on_practices": [
        {
            "introduction": "Before delving into the complex internal structure of a detonation, it is crucial to understand the macroscopic principles that govern its stable propagation. This first exercise guides you through the classic analytical derivation of the Chapman-Jouguet (CJ) detonation speed, $D_{CJ}$. By skillfully combining the fundamental conservation laws of mass, momentum, and energy with the critical CJ condition of sonic flow at the end of the reaction zone, you will derive the cornerstone equation of detonation theory .",
            "id": "4078265",
            "problem": "A planar, steady detonation in the Zel'dovich–von Neumann–Döring (ZND) model of ideal-gas combustion propagates into a quiescent premixed gas with known initial pressure $p_1$, density $\\rho_1$, and constant specific heat ratio $\\gamma$. The Chapman–Jouguet (CJ) state is defined by the condition that the post-reaction flow is sonic relative to the detonation front. Assume the ideal gas law holds throughout, with the speed of sound $a$ satisfying $a^2 = \\gamma p / \\rho$, and that the chemical energy release per unit mass across the reaction zone is a positive constant $q$. In the detonation-fixed frame, the upstream gas has speed $u_1 = D$, where $D$ is the detonation speed.\n\nStarting from one-dimensional steady conservation of mass, momentum, and energy across the detonation (including the heat release $q$), and the ideal-gas thermodynamic relations, combine the reactive Hugoniot, the Rayleigh line, and the CJ sonic condition $u_2 = a_2$ at the downstream state to eliminate all downstream state variables and obtain a single algebraic equation for the CJ detonation speed $D_{CJ}$. Clearly state the set of unknowns you introduce and eliminate in your derivation.\n\nExpress your final answer as a closed-form analytic expression for $D_{CJ}^{2}$ in terms of $a_1^{2}$, $\\gamma$, and $q$, where $a_1^{2} = \\gamma p_1 / \\rho_1$. If numerically evaluated, express $D_{CJ}^{2}$ in SI units of $\\mathrm{m}^2/\\mathrm{s}^2$ and $q$ in $\\mathrm{J}/\\mathrm{kg}$. No numerical substitution is required; report only the symbolic expression. No rounding is needed.",
            "solution": "The problem requires the derivation of an expression for the square of the Chapman-Jouguet (CJ) detonation speed, denoted as $D_{CJ}^2$, based on fundamental conservation principles for a planar, steady, one-dimensional detonation in an ideal gas.\n\nWe begin by stating the governing Rankine-Hugoniot equations, which express the conservation of mass, momentum, and energy across the detonation wave, relating the upstream state (index $1$) to the downstream state (index $2$). The frame of reference is fixed to the detonation front, so the upstream gas velocity is $u_1 = D$, where $D$ is the detonation speed. The downstream velocity is $u_2$.\n\nThe conservation equations are:\n1.  Mass conservation:\n    $$ \\rho_1 u_1 = \\rho_2 u_2 $$\n    Substituting $u_1 = D$, we have:\n    $$ \\rho_1 D = \\rho_2 u_2 \\quad (1) $$\n2.  Momentum conservation:\n    $$ p_1 + \\rho_1 u_1^2 = p_2 + \\rho_2 u_2^2 $$\n    Substituting $u_1 = D$, we have:\n    $$ p_1 + \\rho_1 D^2 = p_2 + \\rho_2 u_2^2 \\quad (2) $$\n3.  Energy conservation:\n    $$ h_1 + \\frac{1}{2} u_1^2 + q = h_2 + \\frac{1}{2} u_2^2 $$\n    where $h$ is the specific enthalpy and $q$ is the specific heat release. For an ideal gas with a constant specific heat ratio $\\gamma$, the specific enthalpy is given by $h = \\frac{\\gamma}{\\gamma-1}\\frac{p}{\\rho}$. Substituting this and $u_1=D$:\n    $$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}D^2 + q = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{\\rho_2} + \\frac{1}{2}u_2^2 \\quad (3) $$\n\nThe system is closed by the Chapman-Jouguet condition, which states that the downstream flow is sonic relative to the detonation front. The speed of sound $a$ in an ideal gas is given by $a^2 = \\gamma p / \\rho$. Therefore, the CJ condition is:\n$$ u_2 = a_2 \\implies u_2^2 = a_2^2 = \\frac{\\gamma p_2}{\\rho_2} \\quad (4) $$\n\nThe objective is to find an expression for $D_{CJ}^2$ in terms of the initial state properties $p_1$, $\\rho_1$ (or equivalently $a_1^2 = \\gamma p_1/\\rho_1$), $\\gamma$, and the heat release $q$. To achieve this, we must eliminate the unknown downstream state variables: the pressure $p_2$, the density $\\rho_2$, and the velocity $u_2$.\n\nFirst, we use the CJ condition $(4)$ to simplify the momentum equation $(2)$:\n$$ p_1 + \\rho_1 D^2 = p_2 + \\rho_2 \\left( \\frac{\\gamma p_2}{\\rho_2} \\right) = p_2 + \\gamma p_2 = p_2(1+\\gamma) $$\nFrom this, we can express the downstream pressure $p_2$ in terms of $D$ and upstream properties:\n$$ p_2 = \\frac{p_1 + \\rho_1 D^2}{1+\\gamma} \\quad (5) $$\n\nNext, we use equations $(1)$ and $(4)$ to relate $\\rho_2$ to other variables. Squaring the mass conservation equation $(1)$:\n$$ \\rho_1^2 D^2 = \\rho_2^2 u_2^2 $$\nSubstituting the CJ condition $u_2^2 = \\gamma p_2/\\rho_2$:\n$$ \\rho_1^2 D^2 = \\rho_2^2 \\left( \\frac{\\gamma p_2}{\\rho_2} \\right) = \\gamma p_2 \\rho_2 $$\nThis allows us to express the downstream density $\\rho_2$ as:\n$$ \\rho_2 = \\frac{\\rho_1^2 D^2}{\\gamma p_2} \\quad (6) $$\n\nNow we have expressions for both $p_2$ and $\\rho_2$ in terms of $D$ and each other. We can combine them to find the ratio $p_2/\\rho_2$:\n$$ \\frac{p_2}{\\rho_2} = p_2 \\left( \\frac{1}{\\rho_2} \\right) = p_2 \\left( \\frac{\\gamma p_2}{\\rho_1^2 D^2} \\right) = \\frac{\\gamma p_2^2}{\\rho_1^2 D^2} $$\nSubstituting the expression for $p_2$ from $(5)$:\n$$ \\frac{p_2}{\\rho_2} = \\frac{\\gamma}{\\rho_1^2 D^2} \\left( \\frac{p_1 + \\rho_1 D^2}{1+\\gamma} \\right)^2 = \\frac{\\gamma (p_1 + \\rho_1 D^2)^2}{\\rho_1^2 D^2 (1+\\gamma)^2} \\quad (7) $$\n\nThe final step is to use the energy equation $(3)$. We can simplify its right-hand side using the CJ condition $u_2^2 = \\gamma p_2/\\rho_2$:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{\\rho_2} + \\frac{1}{2}u_2^2 = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{\\rho_2} + \\frac{1}{2}\\gamma\\frac{p_2}{\\rho_2} = \\left( \\frac{\\gamma}{\\gamma-1} + \\frac{\\gamma}{2} \\right) \\frac{p_2}{\\rho_2} $$\n$$ = \\left( \\frac{2\\gamma + \\gamma(\\gamma-1)}{2(\\gamma-1)} \\right) \\frac{p_2}{\\rho_2} = \\frac{\\gamma^2+\\gamma}{2(\\gamma-1)} \\frac{p_2}{\\rho_2} = \\frac{\\gamma(1+\\gamma)}{2(\\gamma-1)} \\frac{p_2}{\\rho_2} $$\nSo the energy equation becomes:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}D^2 + q = \\frac{\\gamma(1+\\gamma)}{2(\\gamma-1)} \\frac{p_2}{\\rho_2} \\quad (8) $$\n\nNow, we substitute the expression for $p_2/\\rho_2$ from $(7)$ into $(8)$:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}D^2 + q = \\frac{\\gamma(1+\\gamma)}{2(\\gamma-1)} \\left[ \\frac{\\gamma (p_1 + \\rho_1 D^2)^2}{\\rho_1^2 D^2 (1+\\gamma)^2} \\right] $$\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}D^2 + q = \\frac{\\gamma^2}{2(\\gamma-1)(1+\\gamma)} \\frac{(p_1 + \\rho_1 D^2)^2}{\\rho_1^2 D^2} $$\nTo simplify, we introduce the upstream speed of sound squared, $a_1^2 = \\gamma p_1/\\rho_1$, which implies $p_1/\\rho_1 = a_1^2/\\gamma$.\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{a_1^2}{\\gamma} + \\frac{1}{2}D^2 + q = \\frac{\\gamma^2}{2(\\gamma^2-1)} \\frac{(\\rho_1 a_1^2/\\gamma + \\rho_1 D^2)^2}{\\rho_1^2 D^2} $$\n$$ \\frac{a_1^2}{\\gamma-1} + \\frac{1}{2}D^2 + q = \\frac{\\gamma^2}{2(\\gamma^2-1)} \\frac{\\rho_1^2 (a_1^2/\\gamma + D^2)^2}{\\rho_1^2 D^2} = \\frac{1}{2(\\gamma^2-1)} \\frac{(a_1^2 + \\gamma D^2)^2}{D^2} $$\nThis is a single algebraic equation for $D$, which is what the problem asks to be obtained. From now on, $D$ is specifically the CJ speed, $D_{CJ}$. Let $X = D_{CJ}^2$.\n$$ \\frac{a_1^2}{\\gamma-1} + \\frac{X}{2} + q = \\frac{(a_1^2 + \\gamma X)^2}{2(\\gamma^2-1)X} $$\nTo solve for $X$, we clear the denominator by multiplying by $2(\\gamma^2-1)X$:\n$$ 2(\\gamma+1)X a_1^2 + (\\gamma^2-1)X^2 + 2(\\gamma^2-1)q X = (a_1^2 + \\gamma X)^2 $$\n$$ 2(\\gamma+1)X a_1^2 + (\\gamma^2-1)X^2 + 2(\\gamma^2-1)q X = (a_1^2)^2 + 2\\gamma a_1^2 X + \\gamma^2 X^2 $$\nCollecting terms for the quadratic equation in $X$:\n$$ X^2(\\gamma^2-1-\\gamma^2) + X(2(\\gamma+1)a_1^2 + 2(\\gamma^2-1)q - 2\\gamma a_1^2) - a_1^4 = 0 $$\n$$ -X^2 + X(2\\gamma a_1^2 + 2a_1^2 + 2(\\gamma^2-1)q - 2\\gamma a_1^2) - a_1^4 = 0 $$\n$$ -X^2 + 2(a_1^2 + (\\gamma^2-1)q)X - a_1^4 = 0 $$\n$$ X^2 - 2[a_1^2 + (\\gamma^2-1)q]X + a_1^4 = 0 $$\nThis is the desired quadratic equation for $X = D_{CJ}^2$. We solve it using the quadratic formula $X = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$:\n$$ D_{CJ}^2 = \\frac{2[a_1^2 + (\\gamma^2-1)q] \\pm \\sqrt{4[a_1^2 + (\\gamma^2-1)q]^2 - 4a_1^4}}{2} $$\n$$ D_{CJ}^2 = [a_1^2 + (\\gamma^2-1)q] \\pm \\sqrt{[a_1^2 + (\\gamma^2-1)q]^2 - a_1^4} $$\nExpanding the term under the square root:\n$$ \\sqrt{(a_1^4 + 2a_1^2(\\gamma^2-1)q + ((\\gamma^2-1)q)^2) - a_1^4} = \\sqrt{2a_1^2(\\gamma^2-1)q + ((\\gamma^2-1)q)^2} $$\n$$ = \\sqrt{(\\gamma^2-1)q [2a_1^2 + (\\gamma^2-1)q]} $$\nThis gives two possible solutions for $D_{CJ}^2$:\n$$ D_{CJ}^2 = a_1^2 + (\\gamma^2-1)q \\pm \\sqrt{(\\gamma^2-1)q [2a_1^2 + (\\gamma^2-1)q]} $$\nThe two solutions correspond to the \"strong\" and \"weak\" (or pathological) CJ detonation branches. The physically realized, self-sustaining detonation corresponds to the higher velocity, which is given by the positive sign. The solution with the negative sign leads to an unphysical result in the limit of large heat release ($q \\to \\infty$). Therefore, we select the positive root.\n\nThe final closed-form expression for the square of the Chapman-Jouguet detonation speed is:\n$$ D_{CJ}^2 = a_1^2 + (\\gamma^2-1)q + \\sqrt{(\\gamma^2-1)q [2a_1^2 + (\\gamma^2-1)q]} $$",
            "answer": "$$\\boxed{a_1^2 + (\\gamma^2-1)q + \\sqrt{(\\gamma^2-1)q [2a_1^2 + (\\gamma^2-1)q]}}$$"
        },
        {
            "introduction": "While CJ theory provides the overall jump conditions, the Zel'dovich–von Neumann–Döring (ZND) model reveals the wave's internal structure: a non-reactive shock followed by a finite-rate reaction zone. This practice challenges you to model this structure by deriving the governing ordinary differential equations (ODEs) for the flow evolution within the reaction zone. Successfully integrating this stiff system to find the sonic CJ point is a core skill in the numerical analysis of detonations .",
            "id": "4078305",
            "problem": "Consider a steady one-dimensional reactive flow described by the Zel'dovich–von Neumann–Döring (ZND) model in the wave-fixed frame for a calorically perfect gas with constant specific heat at constant pressure. The flow is governed by the conservation of mass, momentum, and energy, coupled to a single-step Arrhenius reaction for a reactant mass fraction. The goal is to derive the semi-discrete method-of-lines formulation suitable for numerical integration and to implement stiff ordinary differential equation (ODE) integrators with event detection at the Chapman–Jouguet (CJ) sonic point where the Mach number equals unity.\n\nStart from the fundamental steady one-dimensional conservation laws in the shock-attached (wave-fixed) frame, with the spatial coordinate denoted by $x$:\n- Conservation of mass: $d(\\rho u)/dx = 0$, where $\\rho$ is density and $u$ is the flow speed in the wave-fixed frame. This implies a constant mass flux $m$ such that $\\rho u = m$.\n- Conservation of momentum: $d(\\rho u^2 + p)/dx = 0$, where $p$ is pressure. This implies a constant momentum flux $P$ such that $\\rho u^2 + p = P$.\n- The energy relation including chemical potential with total energy conserved: $d\\left(c_p T + \\frac{u^2}{2} + q Y\\right)/dx = 0$, where $c_p$ is the specific heat at constant pressure, $T$ is temperature, $q$ is the chemical energy release per unit mass of reactant, and $Y$ is the reactant mass fraction.\n\nAssume the ideal gas equation of state $p = \\rho R T$, where $R$ is the specific gas constant, and a single-step Arrhenius reaction rate per unit volume $\\dot{\\omega} = -\\rho k Y \\exp\\left(-E/(R T)\\right)$, where $k$ is the pre-exponential factor and $E$ is the activation energy per unit mass. The species transport equation in the steady wave-fixed frame is $\\rho u \\, dY/dx = \\dot{\\omega}$.\n\nDerive the semi-discrete method-of-lines ODE system for the state vector $\\mathbf{y}(x) = [u(x), Y(x)]^\\top$ by:\n1. Eliminating $\\rho$ and $p$ using the mass and momentum invariants to express $T$ as a function of $u$, and obtaining $dT/du$.\n2. Using the energy relation to obtain $du/dx$ in terms of $dY/dx$ and $u$.\n3. Using the species equation to express $dY/dx$ in terms of $u$, $Y$, and $T(u)$.\n\nDefine the Mach number $M(u) = u / a$, where the speed of sound is $a(u) = \\sqrt{\\gamma R T(u)}$ and $\\gamma$ is the ratio of specific heats. The CJ sonic point is defined by the event $M(u) = 1$. Implement stiff ODE integration with event detection for $M(u) - 1 = 0$, and terminate integration at the CJ point or when the reactant is fully consumed $Y = 0$.\n\nYour program must:\n- Implement the derived ODE system and integrate it using a stiff method with event detection at $M = 1$ and at $Y = 0$.\n- For each test case, compute the spatial location $x_{\\text{sonic}}$ in meters at which the event $M = 1$ occurs. If the event does not occur within the integration domain, return $-1.0$.\n- Use the following parameterization for each test case: $(\\gamma, R, p_0, T_0, u_0, q, k, E, x_{\\max})$, where $p_0$ (Pascal), $T_0$ (Kelvin), and $u_0$ (meter per second) are the immediate post-shock properties setting the invariants $m$ and $P$, $q$ (Joule per kilogram) is the heat release, $k$ (inverse second) is the pre-exponential factor, $E$ (Joule per kilogram) is the activation energy, and $x_{\\max}$ (meter) is the maximum integration distance.\n- Use $c_p = \\gamma R / (\\gamma - 1)$ for a calorically perfect gas.\n- For numerical solutions, express the final answers in meters, rounded to six decimal places.\n\nTest Suite:\nProvide the following test cases to evaluate the solver:\n1. General case (event expected): $\\gamma = 1.4$, $R = 287$, $p_0 = 10^6$, $T_0 = 1200$, $u_0 = 1500$, $q = 2.0 \\times 10^6$, $k = 2.0 \\times 10^6$, $E = 1.5 \\times 10^6$, $x_{\\max} = 0.2$.\n2. Boundary case (no heat release, event not expected): $\\gamma = 1.4$, $R = 287$, $p_0 = 10^6$, $T_0 = 1200$, $u_0 = 1500$, $q = 0$, $k = 2.0 \\times 10^6$, $E = 1.5 \\times 10^6$, $x_{\\max} = 0.2$.\n3. Edge case (supersonic post-shock state): $\\gamma = 1.4$, $R = 287$, $p_0 = 10^6$, $T_0 = 1200$, $u_0 = 900$, $q = 2.0 \\times 10^6$, $k = 2.0 \\times 10^6$, $E = 1.5 \\times 10^6$, $x_{\\max} = 0.2$.\n\nRequired Final Output Format:\nYour program should produce a single line of output containing a list of the $x_{\\text{sonic}}$ values for the three test cases, as a comma-separated list enclosed in square brackets, ordered as listed above, rounded to six decimal places. For example, the output should look like $[x_1,x_2,x_3]$ where each $x_i$ is a float in meters with six decimal places, and $-1.0$ indicates that the event $M = 1$ did not occur within the integration domain.",
            "solution": "The problem requires the derivation and numerical solution of the Zel'dovich–von Neumann–Döring (ZND) model for a steady one-dimensional detonation wave. The problem is scientifically sound, well-posed, and all necessary parameters are provided. The solution will proceed based on these values.\n\nThe solution process involves first deriving the system of ordinary differential equations (ODEs) that describes the flow structure behind the leading shock wave, and then numerically integrating this system with event detection to find the location of the Chapman–Jouguet (CJ) sonic point.\n\n### Derivation of the ODE System\n\nThe goal is to derive the semi-discrete method-of-lines formulation for the state vector $\\mathbf{y}(x) = [u(x), Y(x)]^\\top$, which requires finding expressions for $du/dx$ and $dY/dx$.\n\n**1. Algebraic Relations and Invariants**\n\nThe flow is governed by the conservation of mass and momentum in the steady, one-dimensional wave-fixed frame.\nThe mass flux is constant:\n$$ \\rho u = m $$\nThe momentum flux is constant:\n$$ \\rho u^2 + p = P $$\nThe values of the constants $m$ and $P$ are determined by the initial post-shock conditions at $x=0$, denoted with a subscript $0$:\n$$ m = \\rho_0 u_0 $$\n$$ P = \\rho_0 u_0^2 + p_0 = m u_0 + p_0 $$\nwhere $\\rho_0 = p_0 / (R T_0)$ from the ideal gas law $p = \\rho R T$.\n\nUsing these invariants, we can express pressure $p$ and density $\\rho$ as functions of velocity $u$:\n$$ \\rho(u) = \\frac{m}{u} $$\n$$ p(u) = P - \\rho u^2 = P - \\frac{m}{u} u^2 = P - mu $$\nNow, we can express temperature $T$ as a function of $u$ using the ideal gas law:\n$$ T(u) = \\frac{p(u)}{\\rho(u) R} = \\frac{P - mu}{(m/u)R} = \\frac{u}{mR}(P - mu) $$\nThis equation describes the Rayleigh line.\n\n**2. Species Conservation Equation**\n\nThe species transport equation for the reactant mass fraction $Y$ in the steady wave-fixed frame is:\n$$ \\rho u \\frac{dY}{dx} = \\dot{\\omega} $$\nwhere $\\dot{\\omega}$ is the reaction rate per unit volume. With $\\rho u = m$, this becomes:\n$$ m \\frac{dY}{dx} = \\dot{\\omega} $$\nThe reaction rate is given by the single-step Arrhenius law:\n$$ \\dot{\\omega} = -\\rho k Y \\exp\\left(-\\frac{E}{R T}\\right) $$\nSubstituting $\\rho = m/u$, we get:\n$$ \\dot{\\omega} = -\\frac{m}{u} k Y \\exp\\left(-\\frac{E}{R T(u)}\\right) $$\nThus, the ODE for the reactant mass fraction $Y$ is:\n$$ \\frac{dY}{dx} = \\frac{\\dot{\\omega}}{m} = -\\frac{k Y}{u} \\exp\\left(-\\frac{E}{R T(u)}\\right) $$\n\n**3. Energy Conservation and the Velocity Equation**\n\nThe energy conservation equation is:\n$$ \\frac{d}{dx}\\left(c_p T + \\frac{u^2}{2} + q Y\\right) = 0 $$\nApplying the chain rule for differentiation with respect to $x$:\n$$ c_p \\frac{dT}{dx} + u \\frac{du}{dx} + q \\frac{dY}{dx} = 0 $$\nWe also have $\\frac{dT}{dx} = \\frac{dT}{du} \\frac{du}{dx}$. Substituting this into the energy equation gives:\n$$ \\left(c_p \\frac{dT}{du} + u\\right) \\frac{du}{dx} + q \\frac{dY}{dx} = 0 $$\nRearranging for $du/dx$:\n$$ \\frac{du}{dx} = \\frac{-q}{c_p \\frac{dT}{du} + u} \\frac{dY}{dx} $$\nTo simplify the denominator, we first find $dT/du$ from $T(u) = \\frac{Pu}{mR} - \\frac{u^2}{R}$:\n$$ \\frac{dT}{du} = \\frac{P}{mR} - \\frac{2u}{R} = \\frac{1}{R}\\left(\\frac{P}{m} - 2u\\right) $$\nThe speed of sound squared is $a^2 = \\gamma R T$. Substituting $T(u)$ gives:\n$$ a^2(u) = \\gamma R \\left(\\frac{u}{mR}(P-mu)\\right) = \\frac{\\gamma u}{m}(P-mu) $$\nThe denominator term is $c_p \\frac{dT}{du} + u$. Using $c_p = \\frac{\\gamma R}{\\gamma - 1}$:\n$$ c_p \\frac{dT}{du} + u = \\frac{\\gamma R}{\\gamma - 1} \\frac{1}{R}\\left(\\frac{P}{m} - 2u\\right) + u = \\frac{\\gamma(P/m-2u) + (\\gamma-1)u}{\\gamma-1} = \\frac{\\gamma P/m - (\\gamma+1)u}{\\gamma-1} $$\nFrom the expression for $a^2(u)$, we can write $P = \\frac{ma^2}{\\gamma u} + mu$. Substituting this for $P$ into the numerator of the previous expression gives:\n$$ \\gamma \\left(\\frac{a^2}{\\gamma u} + u\\right) - (\\gamma+1)u = \\frac{a^2}{u} + \\gamma u - \\gamma u - u = \\frac{a^2 - u^2}{u} $$\nTherefore, the denominator simplifies to:\n$$ c_p \\frac{dT}{du} + u = \\frac{(a^2-u^2)/u}{\\gamma-1} = \\frac{a^2(u) - u^2}{u(\\gamma-1)} $$\nThis denominator is proportional to $1 - M^2$, where $M=u/a$ is the Mach number. It becomes zero at the sonic point, $M=1$, which is a singularity of the ODE system.\n\nSubstituting this simplified denominator back into the expression for $du/dx$:\n$$ \\frac{du}{dx} = \\frac{-q u(\\gamma-1)}{a^2(u) - u^2} \\frac{dY}{dx} $$\nFinally, we can express $du/dx$ solely in terms of the state variables $(u, Y)$ by substituting the expression for $dY/dx$:\n$$ \\frac{du}{dx} = \\frac{-q u(\\gamma-1)}{a^2(u) - u^2} \\left[ -\\frac{k Y}{u} \\exp\\left(-\\frac{E}{R T(u)}\\right) \\right] = \\frac{q (\\gamma-1) k Y}{a^2(u) - u^2} \\exp\\left(-\\frac{E}{R T(u)}\\right) $$\n\n**4. Final ODE System**\n\nThe state of the system is described by $\\mathbf{y}(x) = [u(x), Y(x)]^\\top$. The governing ODEs are:\n$$ \\frac{du}{dx} = \\frac{q (\\gamma-1) k Y}{a^2(u) - u^2} \\exp\\left(-\\frac{E}{R T(u)}\\right) $$\n$$ \\frac{dY}{dx} = -\\frac{k Y}{u} \\exp\\left(-\\frac{E}{R T(u)}\\right) $$\nwhere $T(u) = \\frac{u}{mR}(P-mu)$ and $a^2(u) = \\gamma R T(u)$. The initial conditions are $u(0)=u_0$ and $Y(0)=1$. This system is numerically stiff, especially near the sonic point where the denominator of $du/dx$ approaches zero. A stiff ODE solver with event detection is required to find the CJ point, defined by the condition $M(u)=1$, or equivalently, $u^2 - a^2(u) = 0$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the ZND problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # (gamma, R, p0, T0, u0, q, k, E, x_max)\n        (1.4, 287.0, 1.0e6, 1200.0, 1500.0, 2.0e6, 2.0e6, 1.5e6, 0.2),\n        (1.4, 287.0, 1.0e6, 1200.0, 1500.0, 0.0, 2.0e6, 1.5e6, 0.2),\n        (1.4, 287.0, 1.0e6, 1200.0, 900.0, 2.0e6, 2.0e6, 1.5e6, 0.2),\n    ]\n\n    results = []\n    for params in test_cases:\n        x_sonic = solve_znd_case(params)\n        if x_sonic != -1.0:\n            results.append(f\"{x_sonic:.6f}\")\n        else:\n            results.append(\"-1.000000\")\n            \n    print(f\"[{','.join(results)}]\")\n\ndef solve_znd_case(params):\n    \"\"\"\n    Solves the ZND ODE system for a single parameter set.\n    \n    Args:\n        params (tuple): A tuple of physical and numerical parameters.\n    \n    Returns:\n        float: The spatial location x_sonic where M=1, or -1.0 if not found.\n    \"\"\"\n    gamma, R, p0, T0, u0, q, k, E, x_max = params\n\n    # Handle the trivial case of no heat release\n    if q == 0.0:\n        return -1.0\n\n    # Calculate flow invariants from post-shock conditions\n    rho0 = p0 / (R * T0)\n    m_flux = rho0 * u0\n    P_flux = m_flux * u0 + p0\n    \n    # Check if the initial state is already sonic\n    # T(u) = u/(m*R) * (P-m*u)\n    T_val_u0 = u0 * (P_flux - m_flux * u0) / (m_flux * R)\n    a_sq_u0 = gamma * R * T_val_u0\n    if np.isclose(u0**2, a_sq_u0):\n        return 0.0\n\n    # Define the ODE system dy/dx = f(x, y)\n    def odefunc(x, y):\n        u, Y = y[0], y[1]\n\n        # Stop integration if state becomes non-physical\n        if Y  0 or u = 0:\n            return [0.0, 0.0]\n        Y = max(Y, 0) # Clip Y to non-negative\n\n        # Algebraic relations for Temperature and speed of sound squared\n        T_val = u * (P_flux - m_flux * u) / (m_flux * R)\n        if T_val = 0:\n            return [0.0, 0.0]\n        \n        a_sq = gamma * R * T_val\n\n        # Reaction rate exponential term\n        # E is in J/kg, R is in J/kg-K, so E/(R*T) is dimensionless.\n        exp_term = np.exp(-E / (R * T_val))\n        \n        # dY/dx\n        dYdx = -k * Y / u * exp_term\n\n        # du/dx\n        denom = a_sq - u**2\n        if np.isclose(denom, 0.0):\n             # This part should not be reached if event detection works correctly.\n             # It's a safeguard against division by zero.\n             return [0.0, 0.0]\n        dudx = (q * (gamma - 1.0) / denom) * (u * dYdx)\n\n        return [dudx, dYdx]\n\n    # Event function for sonic condition (M=1)\n    def sonic_event(x, y):\n        u = y[0]\n        T_val = u * (P_flux - m_flux * u) / (m_flux * R)\n        if T_val = 0:\n             return 1.0 # Return a positive value to not trigger event\n        a_sq = gamma * R * T_val\n        # Event triggers when this function is zero\n        return u**2 - a_sq\n    sonic_event.terminal = True\n    sonic_event.direction = 0  # Find root regardless of crossing direction\n\n    # Event function for fuel depletion (Y=0)\n    def fuel_depletion_event(x, y):\n        return y[1]\n    fuel_depletion_event.terminal = True\n    fuel_depletion_event.direction = -1 # Trigger when Y decreases to 0\n\n    # Initial conditions at x=0\n    y0 = [u0, 1.0]\n    \n    # Solve the ODE system using a stiff integrator\n    sol = solve_ivp(\n        fun=odefunc,\n        t_span=(0, x_max),\n        y0=y0,\n        method='Radau',\n        events=[sonic_event, fuel_depletion_event],\n        atol=1e-9,  # Use tight tolerances for accuracy\n        rtol=1e-9,\n    )\n    \n    # Extract the result from the solver output\n    # `sol.status == 1` indicates a termination event occurred.\n    # `sol.t_events[0]` corresponds to `sonic_event`.\n    if sol.status == 1 and sol.t_events[0].size  0:\n        return sol.t_events[0][0]\n\n    return -1.0\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Bridging the gap from idealized theory to practical engineering requires handling realistic thermochemistry. This final exercise synthesizes the concepts you've practiced by tasking you with building a numerical solver to find the CJ speed for a multicomponent gas mixture. This involves coupling the conservation equations with a chemical equilibrium calculation at the hot downstream state, representing a foundational tool for predicting the behavior of real-world detonations .",
            "id": "4078289",
            "problem": "You are asked to implement a program that computes the Chapman–Jouguet (CJ) detonation speed for a premixed, multicomponent fuel–oxidizer system by solving the Zel'dovich–von Neumann–Döring (ZND) steady, one-dimensional jump conditions coupled to chemical equilibrium at the post–wave state and enforcing the Chapman–Jouguet sonic condition. The implementation must use a simplified but self-consistent thermochemical model and a robust numerical solve.\n\nStart from the following fundamental base and modeling assumptions:\n\n- Ideal gas mixture with frozen specific heats for each species, and mixture properties obtained by mass–fraction averaging.\n- Conservation of mass, momentum, and total enthalpy across a steady, planar control surface attached to the detonation front.\n- Chemical equilibrium at the downstream state determined via the equilibrium constant for a single-step reaction with a standard-state pressure of $1\\ \\mathrm{bar}$.\n- Chapman–Jouguet (CJ) condition implemented as the sonic condition on the downstream flow relative to the wave.\n- Upstream gas is at rest in the laboratory frame; therefore, the detonation speed equals the upstream flow speed in the wave-fixed frame.\n\nMathematical formulation:\n\n1. Let the upstream state be indexed by $1$ and the downstream equilibrium state by $2$. Let the mass flux be $m$ (units $\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$). In the wave-fixed frame, the upstream speed is $u_1 = m/\\rho_1$ and the downstream speed is $u_2 = m/\\rho_2$, where $\\rho$ denotes density.\n\n2. Conservation across the control surface yields:\n   - Mass: $m = \\rho_1 u_1 = \\rho_2 u_2$.\n   - Momentum (Rayleigh line): $p_2 - p_1 = m^2\\left(\\dfrac{1}{\\rho_1} - \\dfrac{1}{\\rho_2}\\right)$.\n   - Total enthalpy: $h_2 - h_1 + \\dfrac{1}{2}\\left(u_2^2 - u_1^2\\right) = 0$.\n\n3. The CJ sonic condition is\n   $$u_2 = a_2,$$\n   where $a_2$ is the frozen speed of sound of the equilibrium product mixture at the downstream state, computed from\n   $$a_2 = \\sqrt{\\gamma_2 R_2 T_2},\\quad \\gamma_2 = \\dfrac{c_{p,2}}{c_{p,2} - R_2},$$\n   with $R_2$ the mixture gas constant and $c_{p,2}$ the mixture specific heat at constant pressure.\n\n4. The species set is limited to $\\{\\text{H}_2, \\text{O}_2, \\text{H}_2\\text{O}, \\text{N}_2\\}$. Chemical equilibrium in state $2$ is determined by the single reversible reaction\n   $$\\text{H}_2 + \\frac{1}{2}\\text{O}_2 \\rightleftharpoons \\text{H}_2\\text{O},$$\n   using the equilibrium constant $K_p(T)$ at standard pressure $p^\\circ = 1\\ \\mathrm{bar}$. Define the extent of reaction $\\xi$ (in moles on a chosen molar basis). Given initial upstream moles $n_k^0$ of each species $k$, the downstream equilibrium moles are\n   $$n_{\\text{H}_2} = n_{\\text{H}_2}^0 - \\xi,\\quad n_{\\text{O}_2} = n_{\\text{O}_2}^0 - \\frac{1}{2}\\xi,\\quad n_{\\text{H}_2\\text{O}} = n_{\\text{H}_2\\text{O}}^0 + \\xi,\\quad n_{\\text{N}_2} = n_{\\text{N}_2}^0,$$\n   with the admissible interval $0 \\le \\xi \\le \\min\\left(n_{\\text{H}_2}^0, 2 n_{\\text{O}_2}^0\\right)$. Let $y_i = n_i / \\sum_j n_j$ be mole fractions and let $p$ be the total pressure. The equilibrium condition is enforced via\n   $$K_p(T) = \\frac{y_{\\text{H}_2\\text{O}}}{y_{\\text{H}_2} y_{\\text{O}_2}^{1/2}} \\left(\\frac{p}{p^\\circ}\\right)^{-1/2}.$$\n\n5. Thermochemical model and constants:\n   - Universal gas constant $R_u = 8.314462618\\ \\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, standard state pressure $p^\\circ = 1.0\\times 10^5\\ \\mathrm{Pa}$.\n   - Molecular weights (in $\\mathrm{kg}\\,\\mathrm{mol}^{-1}$): $W_{\\text{H}_2} = 2.01588\\times 10^{-3}$, $W_{\\text{O}_2} = 3.1998\\times 10^{-2}$, $W_{\\text{H}_2\\text{O}} = 1.8015\\times 10^{-2}$, $W_{\\text{N}_2} = 2.8013\\times 10^{-2}$.\n   - Constant molar heat capacities $c_{p,k}$ (in $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$), assumed temperature independent: $c_{p,\\text{H}_2} = 28.84$, $c_{p,\\text{O}_2} = 29.36$, $c_{p,\\text{H}_2\\text{O}} = 33.58$, $c_{p,\\text{N}_2} = 29.12$.\n   - Standard molar enthalpies of formation at $T^\\circ = 298\\ \\mathrm{K}$ (in $\\mathrm{J}\\,\\mathrm{mol}^{-1}$): $h_{f,\\text{H}_2}^\\circ = 0$, $h_{f,\\text{O}_2}^\\circ = 0$, $h_{f,\\text{H}_2\\text{O}}^\\circ = -2.41826\\times 10^5$, $h_{f,\\text{N}_2}^\\circ = 0$.\n   - Standard absolute molar entropies at $T^\\circ = 298\\ \\mathrm{K}$ and $p^\\circ$ (in $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$): $S^\\circ_{\\text{H}_2} = 130.68$, $S^\\circ_{\\text{O}_2} = 205.152$, $S^\\circ_{\\text{H}_2\\text{O}} = 188.83$.\n   - The equilibrium constant is evaluated via a constant–property van ’t Hoff model, using reaction thermochemistry at $T^\\circ$:\n     $$\\Delta H^\\circ = h_{f,\\text{H}_2\\text{O}}^\\circ - h_{f,\\text{H}_2}^\\circ - \\frac{1}{2}h_{f,\\text{O}_2}^\\circ,$$\n     $$\\Delta S^\\circ = S^\\circ_{\\text{H}_2\\text{O}} - S^\\circ_{\\text{H}_2} - \\frac{1}{2}S^\\circ_{\\text{O}_2},$$\n     $$\\Delta G^\\circ(T) = \\Delta H^\\circ - T\\,\\Delta S^\\circ,\\quad K_p(T) = \\exp\\!\\left(-\\frac{\\Delta G^\\circ(T)}{R_u T}\\right).$$\n   - Species sensible enthalpies are modeled as $h_{s,k}(T) = c_{p,k}\\,(T - T^\\circ)$, leading to a species total specific enthalpy on a mass basis $h_k(T) = \\dfrac{h_{f,k}^\\circ}{W_k} + \\dfrac{c_{p,k}}{W_k}\\,(T - T^\\circ)$. Mixture properties use mass–fraction averages $Y_k$.\n\n6. Mixture thermodynamic relations:\n   - Mixture gas constant $R = \\sum_k Y_k\\,R_k$ with $R_k = R_u/W_k$.\n   - Mixture heat capacity $c_p = \\sum_k Y_k\\,c_{p,k}/W_k$; then $c_v = c_p - R$ and $\\gamma = c_p / c_v$.\n   - Density $\\rho = \\dfrac{p}{R T}$.\n\n7. Upstream mixture specification via equivalence ratio with air: Let the equivalence ratio be $\\phi$. Use a molar basis where $n_{\\text{H}_2}^0 = 1$, $n_{\\text{O}_2}^0 = \\dfrac{1}{2\\phi}$, $n_{\\text{N}_2}^0 = 3.76\\,n_{\\text{O}_2}^0$, and $n_{\\text{H}_2\\text{O}}^0 = 0$. This defines the unreacted upstream composition used to compute upstream mixture properties at the given upstream pressure and temperature.\n\nNumerical task:\n\n- For each test case, treat the unknowns as $(p_2, T_2, m)$ and solve the coupled system consisting of the momentum equation, the energy equation, and the CJ sonic condition. At each evaluation, determine the downstream equilibrium composition at $(p_2, T_2)$ by solving for the extent $\\xi$ that satisfies the equilibrium-constant condition with the given upstream atomic inventory. Use this composition to compute downstream mixture properties and close the conservation relations. The detonation speed is $D = u_1 = m/\\rho_1$ in $\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nTest suite:\n\nProvide code that computes $D$ for the following upstream conditions, using the modeling and constants above. Each case specifies $(p_1,\\ T_1,\\ \\phi)$.\n\n- Case A (stoichiometric hydrogen–air): $p_1 = 1.01325\\times 10^5\\ \\mathrm{Pa}$, $T_1 = 300\\ \\mathrm{K}$, $\\phi = 1.0$.\n- Case B (lean, hydrogen–air): $p_1 = 1.01325\\times 10^5\\ \\mathrm{Pa}$, $T_1 = 300\\ \\mathrm{K}$, $\\phi = 0.5$.\n- Case C (rich, hydrogen–air): $p_1 = 1.01325\\times 10^5\\ \\mathrm{Pa}$, $T_1 = 300\\ \\mathrm{K}$, $\\phi = 1.5$.\n- Case D (stoichiometric, colder): $p_1 = 1.01325\\times 10^5\\ \\mathrm{Pa}$, $T_1 = 250\\ \\mathrm{K}$, $\\phi = 1.0$.\n\nRequired output:\n\n- For each case, return the CJ detonation speed $D$ in $\\mathrm{m}\\,\\mathrm{s}^{-1}$, rounded to one decimal place.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C, Case D], for example, \"[2000.0,1800.5,1900.2,1950.1]\".",
            "solution": "The problem requires the computation of the Chapman–Jouguet (CJ) detonation speed for a premixed hydrogen–air system. This is achieved by solving the steady, one-dimensional Zel'dovich–von Neumann–Döring (ZND) conservation equations, augmented with the conditions of chemical equilibrium at the downstream state and the CJ sonic-flow criterion. The thermochemical model is simplified, assuming ideal gases with constant specific heats.\n\nFirst, the given data and constants are collated.\n- **Universal Gas Constant**: $R_u = 8.314462618\\ \\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$\n- **Standard State**: $p^\\circ = 1.0\\times 10^5\\ \\mathrm{Pa}$, $T^\\circ = 298\\ \\mathrm{K}$\n- **Species Data**: The set of species is $\\{\\text{H}_2, \\text{O}_2, \\text{H}_2\\text{O}, \\text{N}_2\\}$. Their molecular weights ($W_k$), constant molar heat capacities ($c_{p,k}$), standard molar enthalpies of formation ($h_{f,k}^\\circ$), and standard absolute molar entropies ($S_k^\\circ$) are provided.\n\nThe problem is valid as it is scientifically grounded in established combustion theory, is well-posed with a sufficient number of equations for the unknowns, and is objectively defined with all necessary data.\n\nThe solution methodology involves formulating a system of non-linear equations for the post-detonation state and solving it numerically.\n\n**1. Formulation of Governing Equations**\nLet state $1$ represent the unreacted upstream gas and state $2$ be the reacted downstream gas at equilibrium. The conservation of mass, momentum, and energy across the stationary detonation wave are given by the Rankine–Hugoniot jump conditions:\n- **Mass conservation**: The mass flux $m$ is constant.\n$$m = \\rho_1 u_1 = \\rho_2 u_2$$\nwhere $\\rho$ is the density and $u$ is the flow speed in the wave-fixed frame.\n- **Momentum conservation** (Rayleigh Line):\n$$p_2 - p_1 = m (u_1 - u_2)$$\n- **Total enthalpy conservation** (Hugoniot Relation):\n$$h_1 + \\frac{1}{2}u_1^2 = h_2 + \\frac{1}{2}u_2^2$$\nwhere $p$ is the pressure and $h$ is the specific enthalpy (on a mass basis).\n\nThe system is closed by the **Chapman–Jouguet (CJ) condition**, which posits that the flow at the downstream state is sonic relative to the wave:\n$$u_2 = a_2$$\nwhere $a_2$ is the frozen speed of sound in the product mixture, defined as:\n$$a_2 = \\sqrt{\\gamma_2 R_2 T_2}$$\nHere, $T_2$ is the downstream temperature, $R_2$ is the mixture-specific gas constant, and $\\gamma_2$ is the ratio of specific heats of the mixture at state $2$.\n\nThe detonation speed in the laboratory frame, $D$, is equal to the upstream flow speed in the wave-fixed frame, $u_1$, since the upstream gas is quiescent.\n$$D = u_1 = \\frac{m}{\\rho_1}$$\n\n**2. Thermochemical State and Equilibrium**\n\nThe properties of the gas mixture at any state (e.g., density $\\rho$, specific enthalpy $h$, gas constant $R$, specific heat ratio $\\gamma$) depend on its composition, temperature, and pressure.\n\n**Upstream State (1)**: The composition is determined by the equivalence ratio $\\phi$ for the reaction $\\text{H}_2 + \\frac{1}{2}\\text{O}_2 \\to \\text{H}_2\\text{O}$ in air (approximated as $1\\,\\text{O}_2 : 3.76\\,\\text{N}_2$). On a molar basis normalized by fuel, the initial mole numbers $n_k^0$ are:\n$$n_{\\text{H}_2}^0 = 1, \\quad n_{\\text{O}_2}^0 = \\frac{1}{2\\phi}, \\quad n_{\\text{N}_2}^0 = 3.76 \\times n_{\\text{O}_2}^0 = \\frac{1.88}{\\phi}, \\quad n_{\\text{H}_2\\text{O}}^0 = 0$$\nGiven the upstream pressure $p_1$ and temperature $T_1$, all thermodynamic properties of the unreacted mixture (e.g., $\\rho_1, h_1$) can be calculated directly.\n\n**Downstream State (2)**: The composition at state $2$ is determined by chemical equilibrium of the single reaction $\\text{H}_2 + \\frac{1}{2}\\text{O}_2 \\rightleftharpoons \\text{H}_2\\text{O}$. We define the extent of reaction, $\\xi$, as the number of moles of $\\text{H}_2$ reacted on the initial molar basis. The equilibrium mole numbers are:\n$$n_{\\text{H}_2} = n_{\\text{H}_2}^0 - \\xi, \\quad n_{\\text{O}_2} = n_{\\text{O}_2}^0 - \\frac{1}{2}\\xi, \\quad n_{\\text{H}_2\\text{O}} = n_{\\text{H}_2\\text{O}}^0 + \\xi, \\quad n_{\\text{N}_2} = n_{\\text{N}_2}^0$$\nThe total number of moles at equilibrium is $N_2 = \\sum n_k = N_1 - \\frac{1}{2}\\xi$, where $N_1 = \\sum n_k^0$. The mole fractions are $y_k = n_k/N_2$.\nThe equilibrium condition relates the mole fractions to the equilibrium constant $K_p(T_2)$:\n$$K_p(T_2) = \\frac{y_{\\text{H}_2\\text{O}}}{y_{\\text{H}_2} y_{\\text{O}_2}^{1/2}} \\left(\\frac{p_2}{p^\\circ}\\right)^{-1/2}$$\nThe equilibrium constant is modeled via the van 't Hoff equation with constant specific heats:\n$$K_p(T) = \\exp\\left(-\\frac{\\Delta G^\\circ(T)}{R_u T}\\right) = \\exp\\left(-\\frac{\\Delta H^\\circ - T\\Delta S^\\circ}{R_u T}\\right)$$\nwhere $\\Delta H^\\circ$ and $\\Delta S^\\circ$ are the standard enthalpy and entropy of reaction, respectively, calculated from the given standard-state properties of the species. For a given pair of $(p_2, T_2)$, the mole fractions $y_k$ depend on the unknown $\\xi$. Thus, the equilibrium equation becomes a single non-linear equation for $\\xi$, which must be solved numerically.\n\n**3. Numerical Solution Algorithm**\n\nThe problem reduces to finding the state $(p_2, T_2)$ and the mass flux $m$ that simultaneously satisfy the conservation equations and the CJ condition. We establish a system of three non-linear equations for three unknowns $\\mathbf{x} = [p_2, T_2, m]^T$.\n\nThe system of residual equations to be solved is $\\mathbf{F}(\\mathbf{x}) = \\mathbf{0}$:\n$$F_1(p_2, T_2, m) = p_2 - p_1 - m^2\\left(\\frac{1}{\\rho_1} - \\frac{1}{\\rho_2}\\right) = 0$$\n$$F_2(p_2, T_2, m) = h_2 - h_1 + \\frac{1}{2}\\left(\\left(\\frac{m}{\\rho_2}\\right)^2 - \\left(\\frac{m}{\\rho_1}\\right)^2\\right) = 0$$\n$$F_3(p_2, T_2, m) = \\frac{m}{\\rho_2} - a_2 = 0$$\n\nThe numerical procedure for each test case $(p_1, T_1, \\phi)$ is as follows:\n1.  **Initialization**: Calculate all properties of the upstream state $1$ (e.g., composition, $\\rho_1, h_1$) based on the initial conditions.\n2.  **Define the System**: Formulate the residual function $\\mathbf{F}(\\mathbf{x})$. The evaluation of this function at a trial state $\\mathbf{x} = [p_2, T_2, m]^T$ requires an internal calculation:\n    a.  **Equilibrium Sub-problem**: Given the trial $(p_2, T_2)$, solve the non-linear equilibrium equation for the extent of reaction $\\xi$. This is done using a robust root-finding method like Brent's method (`scipy.optimize.brentq`) on the interval $0 \\le \\xi \\le \\min(n_{\\text{H}_2}^0, 2n_{\\text{O}_2}^0)$.\n    b.  **Downstream Properties**: Using the determined value of $\\xi$, calculate the equilibrium composition (mole and mass fractions) and subsequently all required thermodynamic properties of the downstream state $2$ ($\\rho_2, h_2, a_2$, etc.).\n    c.  **Residual Calculation**: Substitute the calculated downstream properties into the three equations $F_1, F_2, F_3$ to obtain the residual vector.\n3.  **Root Finding**: Use a multi-variable non-linear solver (e.g., `scipy.optimize.root`) to find the root $\\mathbf{x}^* = [p_2^*, T_2^*, m^*]^T$ that nullifies the residual vector $\\mathbf{F}(\\mathbf{x})$. An appropriate initial guess for the solver is crucial for convergence (e.g., $p_2 \\approx 20 p_1$, $T_2 \\approx 3000\\ \\mathrm{K}$, $m \\approx 2000\\ \\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$).\n4.  **Final Calculation**: Once the solver converges to $m^*$, calculate the CJ detonation speed using the mass flux and upstream density:\n    $$D = \\frac{m^*}{\\rho_1}$$\nThe following code implements this algorithm to solve for the four specified test cases.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root, brentq\n\ndef solve():\n    \"\"\"\n    Main function to compute CJ detonation speeds for the specified test cases.\n    \"\"\"\n\n    # --- Thermochemical Constants and Species Data ---\n    CONST = {\n        'R_u': 8.314462618,  # J/mol/K, Universal gas constant\n        'p_std': 1.0e5,      # Pa, Standard pressure\n        'T_std': 298.0,      # K, Standard temperature\n    }\n\n    SPECIES_DATA = {\n        # W: kg/mol, cp_mol: J/mol/K, h_f_mol: J/mol, S_std_mol: J/mol/K\n        'H2':  {'W': 2.01588e-3, 'cp_mol': 28.84, 'h_f_mol': 0.0,       'S_std_mol': 130.68},\n        'O2':  {'W': 3.1998e-2,  'cp_mol': 29.36, 'h_f_mol': 0.0,       'S_std_mol': 205.152},\n        'H2O': {'W': 1.8015e-2,  'cp_mol': 33.58, 'h_f_mol': -2.41826e5,'S_std_mol': 188.83},\n        'N2':  {'W': 2.8013e-2,  'cp_mol': 29.12, 'h_f_mol': 0.0,       'S_std_mol': 0.0},\n    }\n    \n    # Pre-calculate standard reaction enthalpy and entropy for H2 + 0.5 O2 = H2O\n    h_f, S_std = SPECIES_DATA['H2O']['h_f_mol'], SPECIES_DATA['H2O']['S_std_mol']\n    h_f -= SPECIES_DATA['H2']['h_f_mol'] + 0.5 * SPECIES_DATA['O2']['h_f_mol']\n    S_std -= SPECIES_DATA['H2']['S_std_mol'] + 0.5 * SPECIES_DATA['O2']['S_std_mol']\n    CONST['delta_H_rxn_std'] = h_f\n    CONST['delta_S_rxn_std'] = S_std\n\n    species_list = ['H2', 'O2', 'H2O', 'N2']\n\n    def get_mixture_properties(p, T, moles, species_data, constants):\n        \"\"\"Calculates thermodynamic properties for a given mixture composition.\"\"\"\n        if np.sum(moles) = 0:\n            raise ValueError(\"Total moles must be positive.\")\n        \n        mole_fracs = moles / np.sum(moles)\n        \n        W_mix = np.sum(mole_fracs * np.array([species_data[k]['W'] for k in species_list]))\n        mass_fracs = mole_fracs * np.array([species_data[k]['W'] for k in species_list]) / W_mix\n        \n        R_mix = constants['R_u'] / W_mix\n        \n        cp_mix_mass = np.sum(mass_fracs * np.array([species_data[k]['cp_mol'] / species_data[k]['W'] for k in species_list]))\n        cv_mix_mass = cp_mix_mass - R_mix\n        gamma = cp_mix_mass / cv_mix_mass if cv_mix_mass > 0 else np.inf\n        \n        h_mix = 0.0\n        for i, sp in enumerate(species_list):\n            sd = species_data[sp]\n            h_k = sd['h_f_mol'] / sd['W'] + (sd['cp_mol'] / sd['W']) * (T - constants['T_std'])\n            h_mix += mass_fracs[i] * h_k\n            \n        rho = p / (R_mix * T)\n        sound_speed = np.sqrt(gamma * R_mix * T)\n        \n        return {\n            'rho': rho, 'h_mass': h_mix, 'a': sound_speed, 'R': R_mix, 'gamma': gamma,\n            'moles': moles, 'mole_fracs': mole_fracs, 'mass_fracs': mass_fracs, 'W_mix': W_mix\n        }\n\n    def compute_detonation(p1, T1, phi):\n        \"\"\"Computes the CJ detonation properties for a given upstream state.\"\"\"\n        \n        # 1. Upstream State Calculation\n        n0_H2 = 1.0\n        n0_O2 = 1.0 / (2.0 * phi)\n        n0_N2 = 3.76 * n0_O2\n        n0_H2O = 0.0\n        initial_moles = np.array([n0_H2, n0_O2, n0_H2O, n0_N2])\n        \n        upstream_state = get_mixture_properties(p1, T1, initial_moles, SPECIES_DATA, CONST)\n\n        def get_downstream_state(p2, T2):\n            \"\"\"Solves for equilibrium composition and properties at the downstream state.\"\"\"\n            # Define residual for equilibrium calculation\n            def equil_residual(xi):\n                # Calculate moles at extent of reaction xi\n                moles_eq = np.array([initial_moles[0] - xi, \n                                     initial_moles[1] - 0.5 * xi, \n                                     initial_moles[2] + xi, \n                                     initial_moles[3]])\n                \n                if np.any(moles_eq  0): return 1e9 # Penalize non-physical xi\n\n                total_moles_eq = np.sum(moles_eq)\n                y = moles_eq / total_moles_eq if total_moles_eq  0 else np.zeros(4)\n\n                # Avoid division by zero\n                if y[0] = 0 or y[1] = 0: return -1e9\n\n                # Kp from partial pressures\n                kp_mole_fracs = (y[2]) / (y[0] * np.sqrt(y[1]))\n                kp_calc = kp_mole_fracs * (p2 / CONST['p_std'])**(-0.5)\n                \n                # Kp from van't Hoff\n                delta_g = CONST['delta_H_rxn_std'] - T2 * CONST['delta_S_rxn_std']\n                kp_thermo = np.exp(-delta_g / (CONST['R_u'] * T2))\n                \n                return kp_thermo - kp_calc\n\n            # Solve for equilibrium extent of reaction xi\n            xi_max = min(initial_moles[0], 2 * initial_moles[1])\n            # Use a small epsilon to avoid issues at bounds\n            try:\n                xi_eq = brentq(equil_residual, 1e-12, xi_max - 1e-12, xtol=1e-12, rtol=1e-12)\n            except ValueError:\n                # If root is not bracketed, solver might fail. Return error state.\n                raise RuntimeError(\"Equilibrium solver failed to bracket the root.\")\n\n            moles_eq = np.array([initial_moles[0] - xi_eq, \n                                 initial_moles[1] - 0.5 * xi_eq, \n                                 initial_moles[2] + xi_eq, \n                                 initial_moles[3]])\n            \n            return get_mixture_properties(p2, T2, moles_eq, SPECIES_DATA, CONST)\n\n        # 2. Define residual function for the main CJ solver\n        def cj_residual(x):\n            p2, T2, m = x\n\n            if T2 = 0 or p2 = 0 or m = 0:\n                return [1e9, 1e9, 1e9]\n            \n            try:\n                downstream_state = get_downstream_state(p2, T2)\n            except (ValueError, RuntimeError, OverflowError):\n                return [1e9, 1e9, 1e9]\n                \n            rho1, h1 = upstream_state['rho'], upstream_state['h_mass']\n            rho2, h2, a2 = downstream_state['rho'], downstream_state['h_mass'], downstream_state['a']\n\n            u1 = m / rho1\n            u2 = m / rho2\n\n            # Conservation equations and CJ condition\n            res1 = p2 - p1 - m * (u1 - u2)\n            res2 = h2 - h1 + 0.5 * (u2**2 - u1**2)\n            res3 = u2 - a2\n            \n            return [res1, res2, res3]\n\n        # 3. Solve the system\n        # Initial guess: [p2 (Pa), T2 (K), m (kg/m^2/s)]\n        p2_guess = 18 * p1\n        T2_guess = 3000.0\n        m_guess = 2000.0 * upstream_state['rho']\n        initial_guess = [p2_guess, T2_guess, m_guess]\n        \n        sol = root(cj_residual, initial_guess, method='hybr', tol=1e-9)\n\n        if not sol.success:\n            raise RuntimeError(f\"CJ solver failed for p1={p1}, T1={T1}, phi={phi}: {sol.message}\")\n\n        # 4. Calculate detonation speed D\n        m_sol = sol.x[2]\n        D = m_sol / upstream_state['rho']\n        \n        return D\n\n    # --- Test Cases ---\n    test_cases = [\n        # (p1, T1, phi)\n        (1.01325e5, 300.0, 1.0), # Case A\n        (1.01325e5, 300.0, 0.5), # Case B\n        (1.01325e5, 300.0, 1.5), # Case C\n        (1.01325e5, 250.0, 1.0), # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        p1_case, T1_case, phi_case = case\n        D_cj = compute_detonation(p1_case, T1_case, phi_case)\n        results.append(f\"{D_cj:.1f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}