{
    "hands_on_practices": [
        {
            "introduction": "在密度变化的流动（如火焰）中，平均方法的选择至关重要。本练习通过一个简化的双组分混合物模型，量化了在计算平均标量输运时，错误地使用基于体积的雷诺平均（Reynolds averaging）而非基于质量的法福平均（Favre averaging）所引入的偏差。通过这个计算 ，你将具体理解为何在模拟密度与标量场存在波动的燃烧过程中，法福平均是保证精度的基础。",
            "id": "4073892",
            "problem": "考虑一个统计上均匀的预混火焰，其被建模为具有不同密度的两态混合物，分别代表反应物和产物。所关注的标量是一个进度变量 $\\phi$，在产物状态下其值为 $\\phi_{1}=1$，在反应物状态下其值为 $\\phi_{2}=0$。这两种状态分别以体积加权概率 $p$ 和 $1-p$ 出现。产物和反应物状态的密度分别为 $\\rho_{1}$ 和 $\\rho_{2}$。混合物被假定为定常的，$\\phi$ 的输运仅由对流引起；为了评估平均输运，可以忽略扩散和反应。\n\n在可压缩流中反应标量的输运概率密度函数 (PDF) 框架中，区分 Reynolds PDF $P(\\phi)$（体积加权）和 Favre PDF $\\tilde{P}(\\phi)$（质量加权）是至关重要的，其定义关系为 $\\tilde{P}(\\phi)=\\rho(\\phi)P(\\phi)/\\bar{\\rho}$，其中 $\\bar{\\rho}$ 是 Reynolds 平均密度。标量的 Reynolds 平均值为 $\\overline{\\phi}=\\int \\phi\\,P(\\phi)\\,\\mathrm{d}\\phi$，Favre 平均值为 $\\tilde{\\phi}=\\int \\phi\\,\\tilde{P}(\\phi)\\,\\mathrm{d}\\phi$。\n\n仅使用这些基本定义，推导当使用 Reynolds PDF $P$ 代替 Favre PDF $\\tilde{P}$ 时，在平均标量输运中产生的偏差误差的表达式，该误差量化为两态混合物的差值 $E=\\overline{\\phi}-\\tilde{\\phi}$。然后，对以下科学上合理的预混火焰参数计算 $E$ 的值：\n- $p=0.40$，\n- $\\rho_{1}=0.30\\,\\mathrm{kg\\,m^{-3}}$，\n- $\\rho_{2}=1.20\\,\\mathrm{kg\\,m^{-3}}$。\n\n请以精确分数形式提供最终答案。误差 $E$ 是无量纲的，不需要单位。",
            "solution": "合适的基本基础是在可压缩湍流燃烧中 Reynolds 平均（体积加权）和 Favre 平均（质量加权）之间的区别，以及相关的概率密度函数（PDF）表示。对于具有 Reynolds PDF $P(\\phi)$ 的标量 $\\phi$，Reynolds 平均值定义为\n$$\n\\overline{\\phi}=\\int_{-\\infty}^{\\infty} \\phi\\,P(\\phi)\\,\\mathrm{d}\\phi,\n$$\n而 Favre 平均值通过 Favre PDF $\\tilde{P}(\\phi)$ 定义为\n$$\n\\tilde{\\phi}=\\int_{-\\infty}^{\\infty} \\phi\\,\\tilde{P}(\\phi)\\,\\mathrm{d}\\phi.\n$$\n在可压缩流中，Favre PDF 通过质量加权关系与 Reynolds PDF 相关联\n$$\n\\tilde{P}(\\phi)=\\frac{\\rho(\\phi)}{\\bar{\\rho}}\\,P(\\phi),\n$$\n其中 $\\rho(\\phi)$ 是与状态 $\\phi$ 相关联的密度，而 $\\bar{\\rho}$ 是 Reynolds 平均密度，\n$$\n\\bar{\\rho}=\\int_{-\\infty}^{\\infty} \\rho(\\phi)\\,P(\\phi)\\,\\mathrm{d}\\phi.\n$$\n\n我们将预混火焰建模为两态混合物。标量取两个离散值：产物状态下为 $\\phi_{1}=1$，密度为 $\\rho_{1}$；反应物状态下为 $\\phi_{2}=0$，密度为 $\\rho_{2}$。因此，Reynolds PDF 为\n$$\nP(\\phi)=p\\,\\delta(\\phi-\\phi_{1})+(1-p)\\,\\delta(\\phi-\\phi_{2}),\n$$\n其中 $p$ 是产物状态的体积分数，$1-p$ 是反应物状态的体积分数。使用这个离散 PDF，$\\phi$ 的 Reynolds 平均值为\n$$\n\\overline{\\phi}=\\int \\phi\\,P(\\phi)\\,\\mathrm{d}\\phi=p\\,\\phi_{1}+(1-p)\\,\\phi_{2}.\n$$\n当 $\\phi_{1}=1$ 和 $\\phi_{2}=0$ 时，这简化为\n$$\n\\overline{\\phi}=p.\n$$\n\nReynolds 平均密度为\n$$\n\\bar{\\rho}=\\int \\rho(\\phi)\\,P(\\phi)\\,\\mathrm{d}\\phi=p\\,\\rho_{1}+(1-p)\\,\\rho_{2}.\n$$\n两态混合物的 Favre PDF 为\n$$\n\\tilde{P}(\\phi)=\\frac{\\rho(\\phi)}{\\bar{\\rho}}\\,P(\\phi)=\\frac{p\\,\\rho_{1}}{\\bar{\\rho}}\\,\\delta(\\phi-\\phi_{1})+\\frac{(1-p)\\,\\rho_{2}}{\\bar{\\rho}}\\,\\delta(\\phi-\\phi_{2}).\n$$\n因此，Favre 平均值为\n$$\n\\tilde{\\phi}=\\int \\phi\\,\\tilde{P}(\\phi)\\,\\mathrm{d}\\phi=\\frac{p\\,\\rho_{1}}{\\bar{\\rho}}\\,\\phi_{1}+\\frac{(1-p)\\,\\rho_{2}}{\\bar{\\rho}}\\,\\phi_{2}.\n$$\n当 $\\phi_{1}=1$ 和 $\\phi_{2}=0$ 时，这变为\n$$\n\\tilde{\\phi}=\\frac{p\\,\\rho_{1}}{p\\,\\rho_{1}+(1-p)\\,\\rho_{2}}.\n$$\n\n当使用 Reynolds PDF 代替 Favre PDF 时，在平均标量输运中产生的偏差误差 $E$ 定义为\n$$\nE=\\overline{\\phi}-\\tilde{\\phi}=p-\\frac{p\\,\\rho_{1}}{p\\,\\rho_{1}+(1-p)\\,\\rho_{2}}.\n$$\n\n现在我们对给定的参数 $p=0.40$，$\\rho_{1}=0.30\\,\\mathrm{kg\\,m^{-3}}$ 和 $\\rho_{2}=1.20\\,\\mathrm{kg\\,m^{-3}}$ 计算 $E$ 的值。首先计算 Reynolds 平均密度：\n$$\n\\bar{\\rho}=p\\,\\rho_{1}+(1-p)\\,\\rho_{2}=(0.40)\\,(0.30)+(0.60)\\,(1.20)=0.12+0.72=0.84.\n$$\n计算 Favre 平均值：\n$$\n\\tilde{\\phi}=\\frac{p\\,\\rho_{1}}{\\bar{\\rho}}=\\frac{(0.40)\\,(0.30)}{0.84}=\\frac{0.12}{0.84}=\\frac{12}{84}=\\frac{1}{7}.\n$$\n计算 Reynolds 平均值：\n$$\n\\overline{\\phi}=p=0.40=\\frac{2}{5}.\n$$\n因此误差为\n$$\nE=\\overline{\\phi}-\\tilde{\\phi}=\\frac{2}{5}-\\frac{1}{7}=\\frac{14-5}{35}=\\frac{9}{35}.\n$$\n这符合要求，是一个精确分数且无量纲。",
            "answer": "$$\\boxed{\\frac{9}{35}}$$"
        },
        {
            "introduction": "输运PDF方法虽然精确但计算成本高昂，因此常使用“假定PDF”方法作为替代。本练习  探讨了这类简化模型的局限性，特别是在处理具有多峰分布的层状火焰等复杂情况时。此练习旨在培养对模型选择的批判性思维，展示如何利用高阶矩（如偏度和峰度）作为诊断工具，以判断何时必须采用更精确的输运PDF方法。",
            "id": "4073895",
            "problem": "在湍流反应流的大涡模拟 (LES) 中，对混合分数 $Z$ 的亚格子统计量的一个常用封闭模型是假定概率密度函数 (PDF)。混合分数 $Z$ 是一个有界标量，满足 $Z \\in [0,1]$，在没有差异扩散和源项的情况下，它遵循一个包含平流和分子扩散的守恒标量输运方程。在分层火焰（多个不同的入口组分进行平流和混合）中，由于不完全或局部的微观混合，亚格子 $Z$ PDF会变为多峰形态。输运Z PDF方程在组分空间和物理空间中演化 $P(Z,\\mathbf{x},t)$，原则上可以表示由平流和微观混合产生的非高斯、偏斜和多峰形状，而假定贝塔族封闭模型仅使用由低阶矩决定的双参数族。\n\n考虑分层火焰中的一个过滤网格，其中亚格子 $Z$ 的直接数值模拟 (DNS) 采样得到经验矩：均值 $\\,\\mu = 0.5\\,$，方差 $\\,\\sigma^2 = 0.04\\,$，偏度 $\\,\\gamma_1 = 0\\,$，以及超额峰度 $\\,\\gamma_2 = 1\\,$。请你根据标量输运的第一性原理和统计矩约束，解释为何假定贝塔PDF可能无法表示多峰 $Z$ 分布，并提出科学合理的、基于矩的准则，用于从假定贝塔封闭模型切换到输运Z PDF模型。\n\n选择所有正确的陈述。\n\nA. 由$\\,\\mu\\,$和$\\,\\sigma^2\\,$决定的双参数贝塔族，无法再现由不同流股的平流和不完全微观混合产生的多个内部峰。一个稳健的准则是进行矩一致性检查：根据$\\,\\mu\\,$和$\\,\\sigma^2\\,$计算贝塔参数$\\,a\\,$和$\\,b\\,$，然后预测贝塔族的$\\,\\gamma_1\\,$和$\\,\\gamma_2\\,$。如果对于指定的容差$\\,\\varepsilon_1\\,$和$\\,\\varepsilon_2\\,$，有$\\,|\\gamma_1 - \\gamma_{1,\\mathrm{beta}}| > \\varepsilon_1\\,$或$\\,|\\gamma_2 - \\gamma_{2,\\mathrm{beta}}| > \\varepsilon_2\\,$，则切换到输运Z PDF模型。\n\nB. 每当 `a ≤ 1` 或 `b ≤ 1` 时触发切换，因为此时贝塔PDF是无效的，无法表示具有物理意义的$Z$分布。\n\nC. 仅使用偏度作为指标：如果对于一个小的阈值 `δ`，有 `|γ₁| > δ`，则保留假定贝塔PDF；否则，切换到输运Z PDF模型。\n\nD. 使用结合了偏度和峰度的双峰诊断方法，例如Sarle双峰系数$\\,B = \\dfrac{\\gamma_1^2 + 1}{\\gamma_2 + 3}\\,$。如果$\\,B > 5/9\\,$且$\\,\\mu\\,$不接近$\\,0\\,$或$\\,1\\,$（表明峰值位于内部而不是严格在边界上），那么假定贝塔PDF可能是不充分的，应使用输运Z PDF模型。\n\nE. 输运Z PDF方程在微观混合作用下单调地松弛至单峰PDF，因此多峰Z PDF无法持续存在；所以，假定贝塔PDF是充分的，不需要切换。",
            "solution": "问题陈述具有科学依据，提法恰当且客观。所有给定的数据和定义在计算燃烧学和湍流模拟领域都是标准的。其物理前提——分层火焰可导致混合分数$Z$出现多峰亚格子分布——是正确的。所提供的统计矩是一致的，因为方差$\\sigma^2 = 0.04$小于一个在$[0,1]$内有界且均值为$\\mu=0.5$的标量可能的最大方差，即$\\mu(1-\\mu) = 0.25$。因此，该问题是有效的，并且可以推导出解。\n\n问题的核心是确定有效的准则，以便在需要时从计算成本较低的假定贝塔概率密度函数 (PDF) 模型切换到更准确但计算成本更高的混合分数$Z$的输运PDF模型。假定贝塔PDF的主要局限性在于其缺乏形状灵活性。贝塔分布 $f(Z; a, b)$ 由两个正参数$a$和$b$定义。其形状受到以下约束：\n- 如果$a > 1$且$b > 1$，PDF是单峰的，在区间$(0,1)$内有一个峰值。\n- 如果$a \\le 1$或$b \\le 1$，PDF可以是J形的、U形的（在$0$和$1$处有峰的双峰分布）或均匀的。\n关键在于，贝塔分布无法表示具有多个*内部*峰（即严格介于$0$和$1$之间的峰）的PDF，而这种情况在物理上可能由计算网格内几个不同流股的不完全混合引起。\n\n假定贝塔PDF的参数$a$和$b$由过滤后的均值$\\mu$和方差$\\sigma^2$确定：\n$$ a = \\mu \\left( \\frac{\\mu(1-\\mu)}{\\sigma^2} - 1 \\right) $$\n$$ b = (1-\\mu) \\left( \\frac{\\mu(1-\\mu)}{\\sigma^2} - 1 \\right) $$\n使用给定的DNS数据，$\\mu = 0.5$和$\\sigma^2 = 0.04$：\n$$ a+b = \\frac{\\mu(1-\\mu)}{\\sigma^2} - 1 = \\frac{0.5(0.5)}{0.04} - 1 = \\frac{0.25}{0.04} - 1 = 6.25 - 1 = 5.25 $$\n$$ a = \\mu(a+b) = 0.5(5.25) = 2.625 $$\n$$ b = (1-\\mu)(a+b) = 0.5(5.25) = 2.625 $$\n由于$a > 1$且$b > 1$，与给定$\\mu$和$\\sigma^2$一致的贝塔PDF是一个对称的单峰分布。\n\n现在我们来评估每个选项。\n\n**A. 由$\\,\\mu\\,$和$\\,\\sigma^2\\,$决定的双参数贝塔族，无法再现由不同流股的平流和不完全微观混合产生的多个内部峰。一个稳健的准则是进行矩一致性检查：根据$\\,\\mu\\,$和$\\,\\sigma^2\\,$计算贝塔参数$\\,a\\,$和$\\,b\\,$，然后预测贝塔族的$\\,\\gamma_1\\,$和$\\,\\gamma_2\\,$。如果对于指定的容差$\\,\\varepsilon_1\\,$和$\\,\\varepsilon_2\\,$，有$\\,|\\gamma_1 - \\gamma_{1,\\mathrm{beta}}| > \\varepsilon_1\\,$或$\\,|\\gamma_2 - \\gamma_{2,\\mathrm{beta}}| > \\varepsilon_2\\,$，则切换到输运Z PDF模型。**\n\n这个陈述是正确的。第一句话准确地指出了贝塔PDF的主要弱点。第二句话提出了一个合理且通用的方法来检测假定PDF假设的失效。对于任何双参数分布，指定两个矩（如$\\mu$和$\\sigma^2$）就决定了整个分布，从而也决定了所有更高阶的矩。如果系统的实际高阶矩（从DNS或实验中测量）与假定PDF预测的值有显著差异，那么该假设就无效了。\n让我们进行这个检查。贝塔分布的偏度$\\gamma_1$和超额峰度$\\gamma_2$为：\n$$ \\gamma_{1,\\mathrm{beta}} = \\frac{2(b-a)\\sqrt{a+b+1}}{(a+b+2)\\sqrt{ab}} $$\n$$ \\gamma_{2,\\mathrm{beta}} = \\frac{6[ (a-b)^2(a+b+1) - ab(a+b+2) ]}{ab(a+b+2)(a+b+3)} $$\n对于我们计算出的参数$a = b = 2.625$：\n$$ \\gamma_{1,\\mathrm{beta}} = \\frac{2(2.625-2.625)\\sqrt{...}}{...} = 0 $$\n这与给定的DNS偏度$\\gamma_1=0$相匹配。\n对于超额峰度，当$a=b$时，公式简化为：\n$$ \\gamma_{2,\\mathrm{beta}} = \\frac{6[ - a^2(2a+2) ]}{a^2(2a+2)(2a+3)} = \\frac{-6}{2a+3} $$\n$$ \\gamma_{2,\\mathrm{beta}} = \\frac{-6}{2(2.625)+3} = \\frac{-6}{5.25+3} = \\frac{-6}{8.25} \\approx -0.727 $$\nDNS数据给出的超额峰度为$\\gamma_2 = 1$。差异为$|\\gamma_2 - \\gamma_{2,\\mathrm{beta}}| = |1 - (-0.727)| = 1.727$，这是一个非常大的差异。这表明，真实的分布虽然是对称的，但其形状（尖峰态，$\\gamma_2 > 0$）与具有相同均值和方差的贝塔PDF（平峰态，$\\gamma_2  0$）有显著不同。这种矩一致性检查是一个稳健且有效的准则。\n结论：**正确**。\n\n**B. 每当$\\,a \\le 1\\,$或$\\,b \\le 1\\,$时触发切换，因为此时贝塔PDF是无效的，无法表示具有物理意义的$Z$分布。**\n\n这个陈述是错误的。对于任何$a  0$和$b  0$，贝塔PDF在数学上都是有效的。当$a \\le 1$或$b \\le 1$时，PDF在边界（分别为$Z=0$或$Z=1$）处变得奇异，形成J形或U形分布。这些形状在湍流混合中具有物理意义。J形分布表示网格中的流体主要接近于一种未混合状态（例如，靠近入口）。U形分布（$a \\le 1$且$b \\le 1$）表示混合不良的状态，大部分流体接近纯燃料或纯氧化剂。这些并非无效或非物理的场景。因此，触发切换的前提是错误的。\n结论：**错误**。\n\n**C. 仅使用偏度作为指标：如果对于一个小的阈值$\\,\\delta\\,$，有$\\,|\\gamma_1| > \\delta\\,$，则保留假定贝塔PDF；否则，切换到输运Z PDF模型。**\n\n这个陈述是错误的。仅凭偏度不足以衡量PDF的形状。一个分布可以是完全对称的（$\\gamma_1 = 0$），但仍然是多峰的，因此无法被单峰的贝塔PDF很好地表示。例如，一个在$Z=0.2$和$Z=0.8$处有峰的对称双峰分布，其$\\gamma_1=0$。所提供的DNS数据（$\\gamma_1=0, \\gamma_2=1$）就是一个例子，其中偏度与假定贝塔PDF（$\\gamma_{1,\\mathrm{beta}}=0$）相匹配，但峰度不匹配，这表明贝塔假设的失效，而这个准则会错过这种情况。\n结论：**错误**。\n\n**D. 使用结合了偏度和峰度的双峰诊断方法，例如Sarle双峰系数$\\,B = \\dfrac{\\gamma_1^2 + 1}{\\gamma_2 + 3}\\,$。如果$\\,B  5/9\\,$且$\\,\\mu\\,$不接近$\\,0\\,$或$\\,1\\,$（表明峰值位于内部而不是严格在边界上），那么假定贝塔PDF可能是不充分的，应使用输运Z PDF模型。**\n\n这个陈述是正确的。它提出了一个科学合理的、基于矩的准则，用于检测贝塔PDF的一种特定失效模式：内部双峰性。Sarle的双峰系数$B$是一种已知的统计启发式方法，当其值大于$5/9$时，表明分布是双峰的。由于标准的贝塔PDF无法表示内部双峰性，检测到这一特征是切换到像输运PDF这样更通用模型的正当理由。关于$\\mu$的附加条件是一个合理的改进，用于区分内部双峰性与贝塔PDF可以表示的U形分布（在$0$和$1$处有峰）。虽然给定的DNS数据不满足此准则（$B = (0^2+1)/(1+3) = 1/4 = 0.25$，小于$5/9 \\approx 0.556$），但所提出的准则本身是在预期出现双峰性的情况下进行模型选择的有效且合乎逻辑的策略。该陈述正确地提出了一个合理的科学原则。\n结论：**正确**。\n\n**E. 输运Z PDF方程在微观混合作用下单调地松弛至单峰PDF，因此多峰Z PDF无法持续存在；所以，假定贝塔PDF是充分的，不需要切换。**\n\n这个陈述是错误的。它包含了对输运PDF方程所描述的物理过程的根本误解。完整的方程描述了由分子混合（微观混合）和空间输运（平流）共同引起的演化。虽然模拟组分空间中扩散的微观混合项确实会减少多峰性并将PDF推向单峰形状，但平流项可以通过将不同组分的流体微团带入同一空间区域来同时产生或维持多峰性。在许多湍流（特别是分层火焰）中，会达到一种统计稳态，此时平流产生的多峰性与混合造成的破坏相平衡。因此，多峰PDF可以并且确实会持续存在，而这正是需要输运PDF方法的确切原因。贝塔PDF是充分的这一结论是错误的。\n结论：**错误**。",
            "answer": "$$\\boxed{AD}$$"
        },
        {
            "introduction": "将理论转化为实践是检验理解的最终标准，本练习  将指导你构建一个简化的输运PDF求解器。练习的核心是“可实现性”（realizability）这一关键概念，即确保模拟过程中的标量（如质量分数 $Y_i$）始终保持在物理边界（$0 \\le Y_i \\le 1$ 且 $\\sum_i Y_i = 1$）内。通过编写能解析地维持这些约束的混合与反应算子，你将掌握PDF求解器的核心机制，并体会到创建稳定且物理意义正确的计算工具所需的严谨性。",
            "id": "4073910",
            "problem": "您的任务是构建和分析一个简化的输运概率密度函数（PDF）求解器，该求解器用于处理代表物种质量分数的反应标量。假设每个计算粒子有 $N_s$ 个化学物种，其质量分数为 $\\{Y_i\\}_{i=1}^{N_s}$，其中每个粒子是质量分数单纯形上联合概率分布的一个样本。质量分数单纯形的约束条件为：对于所有 $i$，有 $0 \\le Y_i \\le 1$，且 $\\sum_{i=1}^{N_s} Y_i = 1$。该求解器随时间演化一个包含 $N_p$ 个粒子的系综，其中每个粒子携带一个质量分数向量 $\\mathbf{Y} \\in \\mathbb{R}^{N_s}$，并受到微观混合和反应的影响。假设系统是统计均匀的（无空间输运），因此输运联合概率密度函数 $p(\\mathbf{Y}, t)$ 服从概率守恒。微观混合应被建模为一个演化过程，该过程以与可实现性一致的方式将粒子组分收缩到系综统计量上；反应应被建模为一个物种间的线性马尔可夫过程，该过程保持总质量分数守恒。\n\n从以下基本原理出发：\n- 概率守恒和质量分数在单纯形上的守恒，这要求在所有时间内不变量 $0 \\le Y_i \\le 1$ 和 $\\sum_{i=1}^{N_s} Y_i = 1$ 恒成立。\n- 一个统计均匀的微观混合算子，其构造能在单个时间增量内将粒子组分映射为与系综统计量的凸组合，从而保持单纯形。\n- 一个由生成元矩阵表示的线性反应算子，该矩阵具有非负的非对角线元素和为零的行和，它定义了物种指数上的连续时间马尔可夫过程，并保持非负性和总和守恒。\n\n您的任务是：\n1. 基于上述基本原理，推导出一个有原则的、基于粒子的时间推进格式，该格式使用一个微观混合步骤后跟一个线性反应步骤，将 $\\mathbf{Y}$ 推进一个时间步 $\\Delta t$。该格式必须解析地保持不变量 $0 \\le Y_i \\le 1$ 和 $\\sum_i Y_i = 1$。\n2. 实现一个程序，模拟系综在指定数量的时间步长内的演化。当系综统计量本身接近边界时，所选的微观混合必须能驱动标量值趋向边界；反应必须由一个能在物种间转移概率质量同时保持守恒的生成元来表示。不允许外部输入；所有参数都在代码中定义。\n3. 设计可实现性测试，以验证在所有模拟时间步中：\n   - 边界 $0 \\le Y_i \\le 1$ 得以维持。\n   - 总和 $\\sum_{i=1}^{N_s} Y_i = 1$ 得以维持。\n   - 当系综统计量接近边界时，微观混合会使粒子标量在总体上更接近边界，这通过一个聚合的边界接近度度量的减小来量化。\n\n定义系综在时间 $t$ 的聚合边界接近度度量如下。对于每个具有组分 $\\mathbf{Y}^{(k)}(t)$ 的粒子 $k$，计算 $m^{(k)}(t) = \\max_i Y^{(k)}_i(t)$，并定义每个粒子到最近上边界的距离为 $d^{(k)}(t) = 1 - m^{(k)}(t)$。系综度量是算术平均值 $\\bar{d}(t) = \\frac{1}{N_p} \\sum_{k=1}^{N_p} d^{(k)}(t)$。如果 $\\bar{d}(t_{\\text{final}}) \\le \\bar{d}(t_{\\text{initial}})$，则称微观混合驱动值趋向边界。\n\n程序必须执行以下测试套件，无需任何外部输入：\n\n- 测试 $1$（一般情况）：$N_s = 3$， $N_p = 1000$， $\\Delta t = 10^{-3}$， $N_{\\text{steps}} = 500$，混合时间尺度 $\\tau_{\\text{mix}} = 5 \\times 10^{-3}$，以及一个优先将概率质量转移到物种 $1$（索引 $i=1,2,3$）的反应生成元。将 $70\\%$ 的粒子初始化在 $\\mathbf{Y} = [1,0,0]$，将 $30\\%$ 的粒子初始化在 $\\mathbf{Y} = [\\frac{1}{3},\\frac{1}{3},\\frac{1}{3}]$。\n- 测试 $2$（边界驱动混合，无反应）：$N_s = 2$， $N_p = 200$， $\\Delta t = 5 \\times 10^{-2}$， $N_{\\text{steps}} = 50$，混合时间尺度 $\\tau_{\\text{mix}} = 5 \\times 10^{-2}$，反应关闭。将 $50\\%$ 的粒子初始化在 $\\mathbf{Y} = [1,0]$，将 $50\\%$ 的粒子初始化在 $\\mathbf{Y} = [0.2,0.8]$。\n- 测试 $3$（快速混合极限）：$N_s = 2$， $N_p = 50$， $\\Delta t = 1$， $N_{\\text{steps}} = 5$，混合时间尺度 $\\tau_{\\text{mix}} = 10^{-6}$，反应关闭。将粒子均匀分配在 $\\mathbf{Y} = [1,0]$ 和 $\\mathbf{Y} = [0,1]$ 之间。\n- 测试 $4$（单粒子边界情况）：$N_s = 3$， $N_p = 1$， $\\Delta t = 10^{-1}$， $N_{\\text{steps}} = 20$，混合时间尺度 $\\tau_{\\text{mix}} = 10^{-1}$，反应关闭。将单个粒子初始化在 $\\mathbf{Y} = [1,0,0]$。\n\n对于每个测试，计算在所有时间步中最大的可实现性违背量级\n$$\n\\varepsilon = \\max\\left\\{ \\max_{k,t}\\left( \\max_i\\{-Y^{(k)}_i(t), \\, Y^{(k)}_i(t)-1\\} \\right), \\; \\max_{k,t} \\left| \\sum_{i=1}^{N_s} Y^{(k)}_i(t) - 1 \\right| \\right\\},\n$$\n并通过检查 $\\bar{d}(t_{\\text{final}}) \\le \\bar{d}(t_{\\text{initial}})$ 来确定微观混合是否驱动值趋向边界。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例产生一个布尔值，当且仅当以下两项同时成立时该值为真：(i) $\\varepsilon \\le 10^{-12}$ 且 (ii) $\\bar{d}(t_{\\text{final}}) \\le \\bar{d}(t_{\\text{initial}}) + 10^{-12}$。因此，最终输出必须是 $[b_1,b_2,b_3,b_4]$ 的形式，其中每个 $b_j$ 根据上述定义为 true 或 false。",
            "solution": "我们从代表物种质量分数 $\\{Y_i\\}_{i=1}^{N_s}$ 的反应标量开始，它们服从 $0 \\le Y_i \\le 1$ 和 $\\sum_{i=1}^{N_s} Y_i = 1$，这定义了质量分数单纯形。在输运概率密度函数方法中，一个包含 $N_p$ 个计算粒子 $\\{\\mathbf{Y}^{(k)}(t)\\}_{k=1}^{N_p}$ 的系综代表了联合概率密度函数 $p(\\mathbf{Y}, t)$ 的样本，它们的演化必须保持可实现性和概率守恒。\n\n微观混合原理。在统计均匀的湍流中，微观混合封闭模型必须保持可实现性，并与向系综统计量的收缩相一致。守恒和凸性是基础：如果从时间 $t$ 到 $t+\\Delta t$ 的更新是粒子与系综统计量 $\\mathbf{M}(t)$ 之间的凸组合，那么对于任何粒子 $k$，\n$$\n\\mathbf{Y}^{(k)}(t+\\Delta t) = \\alpha \\, \\mathbf{Y}^{(k)}(t) + (1-\\alpha)\\, \\mathbf{M}(t),\n$$\n其中 $0 \\le \\alpha \\le 1$，只要初始状态是可实现的且 $\\mathbf{M}(t)$ 位于单纯形上，就能保证 $0 \\le Y^{(k)}_i(t+\\Delta t) \\le 1$ 和 $\\sum_i Y^{(k)}_i(t+\\Delta t) = 1$。一个经过充分测试且与上述一致的均匀微观混合模型是平均值交换相互作用（IEM）模型，它产生一个与到系综平均值 $\\mathbf{\\bar{Y}}(t) = \\frac{1}{N_p}\\sum_k \\mathbf{Y}^{(k)}(t)$ 的差值成正比的漂移，以及一个弛豫时间尺度 $\\tau_{\\text{mix}}$。每个粒子的常微分方程是\n$$\n\\frac{d \\mathbf{Y}^{(k)}}{dt} = -\\frac{1}{\\tau_{\\text{mix}}} \\left( \\mathbf{Y}^{(k)} - \\mathbf{\\bar{Y}} \\right).\n$$\n在一个时间步 $\\Delta t$ 内，若 $\\mathbf{\\bar{Y}}$ 在步内为常数，求解这个线性微分方程得到精确更新\n$$\n\\mathbf{Y}^{(k)}(t+\\Delta t) = \\mathbf{\\bar{Y}}(t) + e^{-\\Delta t/\\tau_{\\text{mix}}} \\left( \\mathbf{Y}^{(k)}(t) - \\mathbf{\\bar{Y}}(t) \\right),\n$$\n这是 $\\mathbf{Y}^{(k)}(t)$ 和 $\\mathbf{\\bar{Y}}(t)$ 之间的凸组合，因为 $e^{-\\Delta t/\\tau_{\\text{mix}}} \\in (0,1]$。此更新解析地保持单纯形：对于每个粒子，\n$$\n\\sum_i Y^{(k)}_i(t+\\Delta t) = \\sum_i \\bar{Y}_i(t) + e^{-\\Delta t/\\tau_{\\text{mix}}}\\left( \\sum_i Y^{(k)}_i(t) - \\sum_i \\bar{Y}_i(t) \\right) = 1 + e^{-\\Delta t/\\tau_{\\text{mix}}}(1-1) = 1,\n$$\n且 $Y^{(k)}_i(t+\\Delta t)$ 位于 $Y^{(k)}_i(t)$ 和 $\\bar{Y}_i(t)$ 之间，两者都在 $[0,1]$ 区间内，因此 $0 \\le Y^{(k)}_i(t+\\Delta t) \\le 1$。\n\n反应原理。在物种间转移质量的反应必须保持可实现性。物种指数上的连续时间马尔可夫链实现了一个线性反应算子，其生成元矩阵为 $\\mathbf{Q} \\in \\mathbb{R}^{N_s \\times N_s}$，该矩阵的非对角线元素非负，且行和为零：\n$$\nQ_{ij} \\ge 0 \\text{ for } i \\neq j, \\qquad \\sum_{j=1}^{N_s} Q_{ij} = 0 \\text{ for all } i.\n$$\n将 $\\mathbf{Y}$ 解释为行向量，反应动力学为\n$$\n\\frac{d \\mathbf{Y}}{dt} = \\mathbf{Y}\\, \\mathbf{Q}.\n$$\n在 $\\Delta t$ 上的精确单步解是\n$$\n\\mathbf{Y}(t+\\Delta t) = \\mathbf{Y}(t)\\, \\exp(\\mathbf{Q}\\Delta t),\n$$\n其中 $\\exp$ 是矩阵指数。对于一个有效的生成元，$\\mathbf{P} = \\exp(\\mathbf{Q}\\Delta t)$ 是一个随机矩阵：它的行是概率分布，元素非负且行和为 1。因此，如果 $\\mathbf{Y}(t)$ 是一个概率向量（分量在 $[0,1]$ 内且和为 1），那么 $\\mathbf{Y}(t+\\Delta t) = \\mathbf{Y}(t)\\mathbf{P}$ 也是一个概率向量，从而保持 $0 \\le Y_i \\le 1$ 和 $\\sum_i Y_i = 1$。\n\n微观混合与反应的组合。在每个时间步中，我们首先使用系综平均值应用微观混合更新来计算 $\\mathbf{Y}^{(k)}_{\\text{mix}}$，然后通过随机矩阵 $\\mathbf{P}$ 应用反应更新来获得 $\\mathbf{Y}^{(k)}_{\\text{new}} = \\mathbf{Y}^{(k)}_{\\text{mix}} \\mathbf{P}$。每个子步骤都将单纯形映射到其自身，因此组合操作也同样如此，从而解析地保持可实现性。\n\n向边界驱动。如果系综平均值接近某个边界（例如，某个物种分量的上界 1），微观混合的收缩作用将粒子拉向该平均值，从而减少系综平均到最近边界的距离。一个严谨的聚合度量是计算每个粒子的最大分量 $m^{(k)}(t) = \\max_i Y^{(k)}_i(t)$ 和平均上界距离 $\\bar{d}(t) = \\frac{1}{N_p}\\sum_k (1 - m^{(k)}(t))$。由于混合是向系综平均值的收缩，且系综平均值本身位于单纯形上，如果平均组分比初始系综平均值更接近上界，重复应用混合将减少 $\\bar{d}(t)$。\n\n算法设计。\n- 根据指定的测试用例，初始化一个包含 $N_p$ 个粒子组分的数组，这些组分位于单纯形上。\n- 对每个时间步：\n  1. 计算系综平均值 $\\mathbf{\\bar{Y}}(t) = \\frac{1}{N_p}\\sum_k \\mathbf{Y}^{(k)}(t)$。\n  2. 应用微观混合（IEM 精确更新）：对每个粒子 $k$，\n     $$\n     \\mathbf{Y}^{(k)}_{\\text{mix}} = \\mathbf{\\bar{Y}}(t) + e^{-\\Delta t/\\tau_{\\text{mix}}} \\left( \\mathbf{Y}^{(k)}(t) - \\mathbf{\\bar{Y}}(t) \\right).\n     $$\n  3. 应用反应：预先计算 $\\mathbf{P} = \\exp(\\mathbf{Q}\\Delta t)$ 并设置 $\\mathbf{Y}^{(k)}(t+\\Delta t) = \\mathbf{Y}^{(k)}_{\\text{mix}} \\mathbf{P}$。\n  4. 跟踪可实现性违背：在每一步，计算\n     $$\n     v_{\\text{bounds}}(t) = \\max_{k,i} \\left\\{ -Y^{(k)}_i(t),\\, Y^{(k)}_i(t)-1 \\right\\}, \\quad v_{\\text{sum}}(t) = \\max_k \\left| \\sum_i Y^{(k)}_i(t) - 1 \\right|.\n     $$\n     累积 $\\varepsilon = \\max_t \\max\\{v_{\\text{bounds}}(t), v_{\\text{sum}}(t)\\}$.\n- 计算初始和最终时间的边界接近度度量，\n  $$\n  \\bar{d}(t_{\\text{initial}}) = \\frac{1}{N_p}\\sum_{k=1}^{N_p} \\left( 1 - \\max_i Y^{(k)}_i(t_{\\text{initial}}) \\right), \\quad\n  \\bar{d}(t_{\\text{final}}) = \\frac{1}{N_p}\\sum_{k=1}^{N_p} \\left( 1 - \\max_i Y^{(k)}_i(t_{\\text{final}}) \\right).\n  $$\n- 对于每个测试，返回一个布尔值，当 $\\varepsilon \\le 10^{-12}$ 和 $\\bar{d}(t_{\\text{final}}) \\le \\bar{d}(t_{\\text{initial}}) + 10^{-12}$ 时为真。\n\n测试套件覆盖范围的基本原理。\n- 测试 1 代表一个典型的输运概率密度函数场景，有三个物种、有限的微观混合和将概率移向主导物种的反应。初始系综包括大部分处于边界的粒子和广泛的混合物，确保向边界的收缩。\n- 测试 2 在一个两物种系统中隔离了微观混合而无反应，明确测试了近边界混合会减少到边界的聚合距离。\n- 测试 3 是一个快速混合极限，其中 $\\Delta t/\\tau_{\\text{mix}} \\gg 1$，驱动立即收缩到系综平均值；它测试了强混合下的稳定性和可实现性。\n- 测试 4 是一个单粒子边界情况，其中系综平均值等于粒子状态；混合是空操作，并且在反应关闭的情况下，不变量和边界接近度度量保持不变。\n\n通过从平均值交换相互作用（IEM）模型推导微观混合更新，并从有效生成元的矩阵指数推导反应更新，该算法解析地保持了可实现性。程序用有限精度算术实现这些步骤，并在定义的场景中用严格的容差验证可实现性，同时确认边界导向行为。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef iem_mixing_step(Y, tau_mix, dt):\n    \"\"\"\n    Apply the exact Interaction by Exchange with the Mean (IEM) mixing step.\n    Y: array of shape (N_p, N_s) with particle mass fractions.\n    tau_mix: mixing timescale (float).\n    dt: timestep (float).\n    Returns updated Y after mixing.\n    \"\"\"\n    Y_mean = Y.mean(axis=0, keepdims=True)  # shape (1, N_s)\n    alpha = np.exp(-dt / tau_mix) if tau_mix > 0.0 else 0.0  # contraction factor\n    # Exact convex update toward mean\n    Y_mix = Y_mean + alpha * (Y - Y_mean)\n    return Y_mix\n\ndef reaction_step(Y, Q, dt):\n    \"\"\"\n    Apply exact linear reaction step using matrix exponential.\n    Y: array of shape (N_p, N_s), row-vector interpretation for each particle.\n    Q: generator matrix of shape (N_s, N_s) with rows summing to zero and nonnegative off-diagonals.\n    dt: timestep (float).\n    Returns updated Y after reaction.\n    \"\"\"\n    if Q is None:\n        return Y\n    P = expm(Q * dt)  # stochastic matrix under valid generator\n    # Row-vector times matrix: (N_p, N_s) @ (N_s, N_s) -> (N_p, N_s)\n    Y_new = Y @ P\n    return Y_new\n\ndef realizability_violations(Y):\n    \"\"\"\n    Compute realizability violations for current Y.\n    Returns tuple (v_bounds, v_sum):\n    - v_bounds = max over particles and species of max(-Y_i, Y_i - 1)\n    - v_sum = max over particles of |sum_i Y_i - 1|\n    \"\"\"\n    v_bounds = max(float(np.max(-Y)), float(np.max(Y - 1.0)))\n    sums = np.sum(Y, axis=1)\n    v_sum = float(np.max(np.abs(sums - 1.0)))\n    return v_bounds, v_s\n\ndef bound_closeness_metric(Y):\n    \"\"\"\n    Compute ensemble average closeness to upper bound:\n    mean over particles of (1 - max_i Y_i).\n    \"\"\"\n    per_particle_max = np.max(Y, axis=1)\n    d = 1.0 - per_particle_max\n    return float(np.mean(d))\n\ndef run_test(Np, Ns, dt, n_steps, tau_mix, Q, initializer):\n    \"\"\"\n    Run a single test with specified parameters.\n    Np: number of particles\n    Ns: number of species\n    dt: timestep\n    n_steps: number of steps\n    tau_mix: mixing timescale\n    Q: reaction generator matrix (Ns x Ns) or None\n    initializer: function(Np, Ns) -> initial Y array\n    Returns boolean result: True iff both realizability and bound-driven conditions hold.\n    \"\"\"\n    Y = initializer(Np, Ns)\n\n    # Initial metrics\n    eps_max = 0.0\n    v_b, v_s = realizability_violations(Y)\n    eps_max = max(eps_max, v_b, v_s)\n    d_initial = bound_closeness_metric(Y)\n\n    # Time stepping\n    for _ in range(n_steps):\n        # Mixing\n        Y = iem_mixing_step(Y, tau_mix, dt)\n        # Reaction\n        Y = reaction_step(Y, Q, dt)\n        # Track violations\n        v_b, v_s = realizability_violations(Y)\n        eps_max = max(eps_max, v_b, v_s)\n\n    d_final = bound_closeness_metric(Y)\n\n    # Conditions\n    tol = 1e-12\n    realizability_ok = eps_max = tol\n    bounds_driven = d_final = d_initial + tol\n\n    return realizability_ok and bounds_driven\n\ndef init_test1(Np, Ns):\n    \"\"\"\n    Test 1 initializer: 70% pure species 1, 30% equimolar.\n    Species index order: [1,2,3]; pure means [1,0,0].\n    \"\"\"\n    assert Ns == 3\n    Y = np.zeros((Np, Ns))\n    n_pure = int(0.7 * Np)\n    # Pure species 1\n    Y[:n_pure, 0] = 1.0\n    # Equimolar for the rest\n    Y[n_pure:, :] = 1.0 / Ns\n    return Y\n\ndef Q_test1(Ns):\n    \"\"\"\n    Reaction generator that preferentially moves probability to species 1.\n    Row-sum zero, nonnegative off-diagonals.\n    Example rates:\n    From species 2 -> 1 rate 2.0; 2 -> 3 rate 0.2\n    From species 3 -> 1 rate 2.0; 3 -> 2 rate 0.2\n    From species 1 -> 2,3 rates 0.05 each (small leakage)\n    \"\"\"\n    assert Ns == 3\n    Q = np.zeros((Ns, Ns))\n    # Row for species 1 (leakage to 2 and 3)\n    Q[0, 1] = 0.05\n    Q[0, 2] = 0.05\n    Q[0, 0] = -(Q[0, 1] + Q[0, 2])\n    # Row for species 2\n    Q[1, 0] = 2.0\n    Q[1, 2] = 0.2\n    Q[1, 1] = -(Q[1, 0] + Q[1, 2])\n    # Row for species 3\n    Q[2, 0] = 2.0\n    Q[2, 1] = 0.2\n    Q[2, 2] = -(Q[2, 0] + Q[2, 1])\n    return Q\n\ndef init_test2(Np, Ns):\n    \"\"\"\n    Test 2 initializer: 50% [1,0], 50% [0.2, 0.8]\n    \"\"\"\n    assert Ns == 2\n    Y = np.zeros((Np, Ns))\n    n_half = Np // 2\n    Y[:n_half, 0] = 1.0\n    Y[:n_half, 1] = 0.0\n    Y[n_half:, 0] = 0.2\n    Y[n_half:, 1] = 0.8\n    return Y\n\ndef init_test3(Np, Ns):\n    \"\"\"\n    Test 3 initializer: evenly split between [1,0] and [0,1]\n    \"\"\"\n    assert Ns == 2\n    Y = np.zeros((Np, Ns))\n    n_half = Np // 2\n    Y[:n_half, 0] = 1.0\n    Y[:n_half, 1] = 0.0\n    Y[n_half:, 0] = 0.0\n    Y[n_half:, 1] = 1.0\n    return Y\n\ndef init_test4(Np, Ns):\n    \"\"\"\n    Test 4 initializer: single particle at [1,0,0]\n    \"\"\"\n    assert Ns == 3\n    assert Np == 1\n    Y = np.zeros((Np, Ns))\n    Y[0, 0] = 1.0\n    return Y\n\ndef solve():\n    tests = []\n\n    # Test 1 parameters\n    Ns1 = 3\n    Np1 = 1000\n    dt1 = 1e-3\n    steps1 = 500\n    tau1 = 5e-3\n    Q1 = Q_test1(Ns1)\n    tests.append((Np1, Ns1, dt1, steps1, tau1, Q1, init_test1))\n\n    # Test 2 parameters (no reaction)\n    Ns2 = 2\n    Np2 = 200\n    dt2 = 5e-2\n    steps2 = 50\n    tau2 = 5e-2\n    Q2 = None\n    tests.append((Np2, Ns2, dt2, steps2, tau2, Q2, init_test2))\n\n    # Test 3 parameters (fast mixing)\n    Ns3 = 2\n    Np3 = 50\n    dt3 = 1.0\n    steps3 = 5\n    tau3 = 1e-6\n    Q3 = None\n    tests.append((Np3, Ns3, dt3, steps3, tau3, Q3, init_test3))\n\n    # Test 4 parameters (single particle, no reaction)\n    Ns4 = 3\n    Np4 = 1\n    dt4 = 1e-1\n    steps4 = 20\n    tau4 = 1e-1\n    Q4 = None\n    tests.append((Np4, Ns4, dt4, steps4, tau4, Q4, init_test4))\n\n    results = []\n    for Np, Ns, dt, steps, tau, Q, init in tests:\n        ok = run_test(Np, Ns, dt, steps, tau, Q, init)\n        results.append(ok)\n\n    # Print single-line output as specified\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}