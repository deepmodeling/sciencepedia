{
    "hands_on_practices": [
        {
            "introduction": "The foundation of two-way coupling lies in quantifying the exchange of momentum, heat, and mass between phases. In the Particle-Source-In-Cell (PSI-CELL) method, the force a particle exerts on the fluid is averaged over a computational cell and treated as a volumetric source term, $\\mathbf{S}_{\\mathbf{u}}$, in the fluid's momentum equations. This first practice provides a concrete, step-by-step exercise in calculating this source term, bridging the gap between the physical drag force on a single particle and its aggregated representation on an Eulerian grid .",
            "id": "4048800",
            "problem": "Consider two-way momentum coupling between a dispersed liquid fuel droplet phase and a gaseous carrier in a single Eulerian control volume, treated by the Particle-Source-In-Cell (PSI-CELL) method, where particle forces are aggregated as a source term in the gas momentum equation. The gaseous carrier has density $\\rho$ and dynamic viscosity $\\mu$, and its local velocity in the cell is uniform and equal to $\\mathbf{u}$. There are $N$ identical spherical droplets of diameter $d_p$ and instantaneous velocity $\\mathbf{v}_p$ inside the cell of volume $V_c$. Assume that gravity, added mass, Basset history, lift, and pressure gradient forces on the droplets are negligible compared to aerodynamic drag, and that the droplets are small enough to be treated as point particles for momentum coupling.\n\nUse the standard steady drag formulation with the drag coefficient correlation for a sphere given by the Schiller–Naumann correlation,\n$$\nC_D(\\mathrm{Re}_p) \\;=\\; \\frac{24}{\\mathrm{Re}_p}\\left(1 + 0.15\\,\\mathrm{Re}_p^{0.687}\\right),\n$$\nwhere the particle Reynolds number is\n$$\n\\mathrm{Re}_p \\;=\\; \\frac{\\rho\\,|\\mathbf{u}-\\mathbf{v}_p|\\,d_p}{\\mu}.\n$$\nThe instantaneous drag force on a droplet is modeled by\n$$\n\\mathbf{F}_d \\;=\\; \\frac{1}{2}\\,\\rho\\,A_p\\,C_D(\\mathrm{Re}_p)\\,|\\mathbf{u}-\\mathbf{v}_p|\\,(\\mathbf{u}-\\mathbf{v}_p),\n$$\nwith $A_p = \\pi d_p^2/4$ the projected area of a sphere. In the PSI-CELL framework, the momentum source added to the gas-phase momentum equation is the sum of the forces exerted by the particles on the fluid, per unit volume. By Newton’s third law, this source equals the negative of the particle drag forces aggregated in the cell and normalized by the cell volume,\n$$\n\\mathbf{S}_{\\mathbf{u}} \\;=\\; -\\frac{1}{V_c}\\sum_{i=1}^{N}\\mathbf{F}_{d,i}.\n$$\n\nGiven the following data, compute the three Cartesian components of the cell momentum source $\\mathbf{S}_{\\mathbf{u}}$:\n- $N = 100$,\n- $d_p = 30\\times 10^{-6}\\;\\mathrm{m}$,\n- $\\rho = 1.2\\;\\mathrm{kg/m^3}$,\n- $\\mu = 1.8\\times 10^{-5}\\;\\mathrm{Pa\\cdot s}$,\n- $\\mathbf{u} = (2.0,\\;0,\\;0)\\;\\mathrm{m/s}$,\n- $\\mathbf{v}_p = (1.0,\\;0,\\;0)\\;\\mathrm{m/s}$,\n- $V_c = 1.0\\times 10^{-6}\\;\\mathrm{m^3}$.\n\nExpress your final answer for $\\mathbf{S}_{\\mathbf{u}}$ in $\\mathrm{N/m^3}$ as a three-component row vector, and round each component to four significant figures.",
            "solution": "The objective is to compute the momentum source term $\\mathbf{S}_{\\mathbf{u}}$ added to the gas-phase momentum equation within a single control volume. The source term is defined as the sum of forces exerted by the particles on the fluid, per unit volume.\n\nThe source term is given by:\n$$\n\\mathbf{S}_{\\mathbf{u}} = -\\frac{1}{V_c}\\sum_{i=1}^{N}\\mathbf{F}_{d,i}\n$$\nThe problem states that there are $N$ identical droplets, all possessing the same instantaneous velocity $\\mathbf{v}_p$. Consequently, the drag force $\\mathbf{F}_{d,i}$ is the same for all $N$ droplets. The summation simplifies to:\n$$\n\\mathbf{S}_{\\mathbf{u}} = -\\frac{N}{V_c}\\mathbf{F}_d\n$$\nThe drag force $\\mathbf{F}_d$ on a single droplet is given by:\n$$\n\\mathbf{F}_d = \\frac{1}{2}\\,\\rho\\,A_p\\,C_D(\\mathrm{Re}_p)\\,|\\mathbf{u}-\\mathbf{v}_p|\\,(\\mathbf{u}-\\mathbf{v}_p)\n$$\nThe calculation proceeds in the following steps:\n\n1.  **Calculate the relative velocity vector and its magnitude.**\n    The gas velocity is $\\mathbf{u} = (2.0, 0, 0)\\;\\mathrm{m/s}$ and the droplet velocity is $\\mathbf{v}_p = (1.0, 0, 0)\\;\\mathrm{m/s}$.\n    The relative velocity vector is:\n    $$\n    \\mathbf{u} - \\mathbf{v}_p = (2.0 - 1.0, 0 - 0, 0 - 0) = (1.0, 0, 0)\\;\\mathrm{m/s}\n    $$\n    The magnitude of the relative velocity is:\n    $$\n    |\\mathbf{u} - \\mathbf{v}_p| = \\sqrt{1.0^2 + 0^2 + 0^2} = 1.0\\;\\mathrm{m/s}\n    $$\n\n2.  **Calculate the particle Reynolds number, $\\mathrm{Re}_p$.**\n    Using the given values $\\rho = 1.2\\;\\mathrm{kg/m^3}$, $d_p = 30 \\times 10^{-6}\\;\\mathrm{m}$, $\\mu = 1.8 \\times 10^{-5}\\;\\mathrm{Pa\\cdot s}$, and $|\\mathbf{u} - \\mathbf{v}_p| = 1.0\\;\\mathrm{m/s}$:\n    $$\n    \\mathrm{Re}_p = \\frac{\\rho\\,|\\mathbf{u}-\\mathbf{v}_p|\\,d_p}{\\mu} = \\frac{(1.2\\;\\mathrm{kg/m^3})(1.0\\;\\mathrm{m/s})(30 \\times 10^{-6}\\;\\mathrm{m})}{1.8 \\times 10^{-5}\\;\\mathrm{Pa\\cdot s}} = \\frac{3.6 \\times 10^{-5}}{1.8 \\times 10^{-5}} = 2.0\n    $$\n    The particle Reynolds number is exactly $2.0$.\n\n3.  **Calculate the drag coefficient, $C_D$.**\n    Using the Schiller–Naumann correlation with $\\mathrm{Re}_p = 2.0$:\n    $$\n    C_D(\\mathrm{Re}_p=2.0) = \\frac{24}{2.0}\\left(1 + 0.15 \\times (2.0)^{0.687}\\right)\n    $$\n    First, evaluate the power term:\n    $$\n    (2.0)^{0.687} \\approx 1.61036\n    $$\n    Now, substitute this into the $C_D$ equation:\n    $$\n    C_D = 12 \\left(1 + 0.15 \\times 1.61036\\right) = 12 \\left(1 + 0.241554\\right) = 12(1.241554) \\approx 14.8986\n    $$\n\n4.  **Calculate the projected area of the droplet, $A_p$.**\n    The droplet is a sphere of diameter $d_p = 30 \\times 10^{-6}\\;\\mathrm{m}$.\n    $$\n    A_p = \\frac{\\pi d_p^2}{4} = \\frac{\\pi (30 \\times 10^{-6}\\;\\mathrm{m})^2}{4} = \\frac{\\pi (900 \\times 10^{-12}\\;\\mathrm{m^2})}{4} = 225\\pi \\times 10^{-12}\\;\\mathrm{m^2}\n    $$\n    $A_p \\approx 7.06858 \\times 10^{-10}\\;\\mathrm{m^2}$.\n\n5.  **Calculate the drag force vector, $\\mathbf{F}_d$.**\n    Substituting the calculated values into the drag force equation:\n    $$\n    \\mathbf{F}_d = \\frac{1}{2}(1.2)(7.06858 \\times 10^{-10})(14.8986)(1.0)(1.0, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{F}_d = (0.6)(7.06858 \\times 10^{-10})(14.8986)(1.0, 0, 0)\\;\\mathrm{N}\n    $$\n    The magnitude of the force is:\n    $$\n    |\\mathbf{F}_d| \\approx 6.31834 \\times 10^{-9}\\;\\mathrm{N}\n    $$\n    The force vector is:\n    $$\n    \\mathbf{F}_d \\approx (6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n\n6.  **Calculate the cell momentum source, $\\mathbf{S}_{\\mathbf{u}}$.**\n    Using $N = 100$ and $V_c = 1.0 \\times 10^{-6}\\;\\mathrm{m^3}$:\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -\\frac{N}{V_c}\\mathbf{F}_d = -\\frac{100}{1.0 \\times 10^{-6}\\;\\mathrm{m^3}} (6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -(10^8\\;\\mathrm{m^{-3}})(6.31834 \\times 10^{-9}, 0, 0)\\;\\mathrm{N}\n    $$\n    $$\n    \\mathbf{S}_{\\mathbf{u}} = -(0.631834, 0, 0)\\;\\mathrm{N/m^3}\n    $$\n\n7.  **Final Answer Formulation.**\n    The problem requires rounding each component of the final answer to four significant figures.\n    -   The x-component is $-0.631834$. The first four significant figures are $6, 3, 1, 8$. The fifth digit is $3$, so we round down. The component becomes $-0.6318$.\n    -   The y- and z-components are exactly $0$. They do not require rounding.\n    The final vector is $\\mathbf{S}_{\\mathbf{u}} = (-0.6318, 0, 0)\\;\\mathrm{N/m^3}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -0.6318 & 0 & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "After calculating a physical source from a particle, the next challenge is to transfer this information from the particle's continuous Lagrangian position to the discrete nodes of the Eulerian grid. A naive assignment to the nearest node would violate fundamental conservation laws. This practice guides you through the rigorous construction of the widely used Cloud-In-Cell (CIC) interpolation scheme, demonstrating how mathematical constraints like conservation of mass and momentum (partition of unity and affine completeness) directly dictate the trilinear weighting functions used for this mapping .",
            "id": "4048825",
            "problem": "In particle–fluid two-way coupling for computational combustion, the Particle-Source-In-Cell (PSI-CELL) method distributes a particle’s source contribution to an Eulerian mesh through a regularized approximation of the Dirac delta distribution using a compact support kernel. Consider a uniform, structured, Cartesian grid with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, and assume a single particle located at position $\\mathbf{x}_{p} = (x_{p}, y_{p}, z_{p})$ inside a grid cell whose lower–back–left vertex has coordinates $(x_{0}, y_{0}, z_{0})$. The distribution is required to satisfy the following fundamental constraints that arise from conservation and consistency: (i) compact support over the $8$ nearest vertices, (ii) positivity, (iii) partition of unity, and (iv) exact reproduction of constant and linear fields (affine completeness) on a uniform mesh.\n\nStarting from these constraints, construct the Cloud-In-Cell (CIC) shape functions (weights) for the $8$ nearest vertices by building the kernel as a tensor product of one-dimensional, piecewise-linear functions along each coordinate direction. Let the local, dimensionless coordinates be defined by $\\xi = (x_{p} - x_{0}) / \\Delta x$, $\\eta = (y_{p} - y_{0}) / \\Delta y$, and $\\zeta = (z_{p} - z_{0}) / \\Delta z$, with $\\xi, \\eta, \\zeta \\in [0,1]$. Express the $8$ vertex weights $\\{w_{mnp}\\}$, where $m, n, p \\in \\{0,1\\}$ index the offset in $x$, $y$, and $z$ from $(x_{0}, y_{0}, z_{0})$, explicitly in terms of $\\xi$, $\\eta$, and $\\zeta$.\n\nThen, for the specific case of $\\Delta x = \\Delta y = \\Delta z = 1$ and a particle located at $(x_{p}, y_{p}, z_{p}) = (x_{0} + 0.3 \\Delta x, y_{0} + 0.7 \\Delta y, z_{0} + 0.4 \\Delta z)$, compute the numerical values of the $8$ weights in the lexicographic order $(m, n, p) = (0,0,0), (1,0,0), (0,1,0), (0,0,1), (1,1,0), (1,0,1), (0,1,1), (1,1,1)$. Round your final numerical values to four significant figures. Report your final answer as a single row matrix containing the eight weights. Because the weights are dimensionless, do not include units.",
            "solution": "The construction begins in one dimension, along the $x$-coordinate. The local coordinate is $\\xi \\in [0,1]$. The two vertices of the one-dimensional cell segment are at local coordinates $0$ and $1$. Let the corresponding weights be $W_{0}(\\xi)$ and $W_{1}(\\xi)$. The constraints, reduced to one dimension, are:\n$1$. Positivity: $W_m(\\xi) \\ge 0$ for $m \\in \\{0,1\\}$ and $\\xi \\in [0,1]$.\n$2$. Partition of unity (zeroth-order moment conservation): $W_{0}(\\xi) + W_{1}(\\xi) = 1$. This ensures that a constant field is reproduced exactly, preserving conserved quantities.\n$3$. Affine completeness (first-order moment conservation): The weighted average of the vertex positions must equal the particle's position. In local coordinates, this is $0 \\cdot W_{0}(\\xi) + 1 \\cdot W_{1}(\\xi) = \\xi$.\n\nFrom the first-order moment condition, we directly obtain $W_{1}(\\xi) = \\xi$.\nSubstituting this into the partition of unity condition gives $W_{0}(\\xi) + \\xi = 1$, which yields $W_{0}(\\xi) = 1 - \\xi$.\nThese functions, $W_{0}(\\xi) = 1 - \\xi$ and $W_{1}(\\xi) = \\xi$, are piecewise-linear and satisfy the positivity constraint for $\\xi \\in [0,1]$.\n\nThe problem states that the three-dimensional kernel is a tensor product of the one-dimensional functions. The weight $w_{mnp}$ at the vertex with local Eucledian coordinate offset $(m, n, p)$ from the cell origin, where $m, n, p \\in \\{0,1\\}$, is given by the product of the corresponding one-dimensional weights for each direction:\n$$w_{mnp}(\\xi, \\eta, \\zeta) = W_m(\\xi) W_n(\\eta) W_p(\\zeta)$$\nAnalogous to the $x$-direction, the one-dimensional weights for the $y$ and $z$ directions are:\n$W_0(\\eta) = 1-\\eta$, $W_1(\\eta) = \\eta$\n$W_0(\\zeta) = 1-\\zeta$, $W_1(\\zeta) = \\zeta$\n\nTherefore, the eight weights for the vertices of the cubic cell are given by the trilinear interpolation functions:\n$w_{000} = W_0(\\xi)W_0(\\eta)W_0(\\zeta) = (1-\\xi)(1-\\eta)(1-\\zeta)$\n$w_{100} = W_1(\\xi)W_0(\\eta)W_0(\\zeta) = \\xi(1-\\eta)(1-\\zeta)$\n$w_{010} = W_0(\\xi)W_1(\\eta)W_0(\\zeta) = (1-\\xi)\\eta(1-\\zeta)$\n$w_{001} = W_0(\\xi)W_0(\\eta)W_1(\\zeta) = (1-\\xi)(1-\\eta)\\zeta$\n$w_{110} = W_1(\\xi)W_1(\\eta)W_0(\\zeta) = \\xi\\eta(1-\\zeta)$\n$w_{101} = W_1(\\xi)W_0(\\eta)W_1(\\zeta) = \\xi(1-\\eta)\\zeta$\n$w_{011} = W_0(\\xi)W_1(\\eta)W_1(\\zeta) = (1-\\xi)\\eta\\zeta$\n$w_{111} = W_1(\\xi)W_1(\\eta)W_1(\\zeta) = \\xi\\eta\\zeta$\n\nThese are the expressions for the eight CIC weights in terms of the local coordinates $\\xi$, $\\eta$, and $\\zeta$.\n\nNext, we compute the numerical values for the specific case provided. The particle position is given as $(x_{p}, y_{p}, z_{p}) = (x_{0} + 0.3 \\Delta x, y_{0} + 0.7 \\Delta y, z_{0} + 0.4 \\Delta z)$. The local coordinates are calculated as:\n$\\xi = \\frac{x_{p} - x_{0}}{\\Delta x} = \\frac{(x_{0} + 0.3 \\Delta x) - x_{0}}{\\Delta x} = 0.3$\n$\\eta = \\frac{y_{p} - y_{0}}{\\Delta y} = \\frac{(y_{0} + 0.7 \\Delta y) - y_{0}}{\\Delta y} = 0.7$\n$\\zeta = \\frac{z_{p} - z_{0}}{\\Delta z} = \\frac{(z_{0} + 0.4 \\Delta z) - z_{0}}{\\Delta z} = 0.4$\n\nWe can also compute the complementary values:\n$1-\\xi = 1 - 0.3 = 0.7$\n$1-\\eta = 1 - 0.7 = 0.3$\n$1-\\zeta = 1 - 0.4 = 0.6$\n\nNow, we substitute these numerical values into the weight expressions. The weights are to be listed in the specific order given in the problem statement:\n$1.$ For $(m,n,p)=(0,0,0)$: $w_{000} = (0.7)(0.3)(0.6) = 0.126$\n$2.$ For $(m,n,p)=(1,0,0)$: $w_{100} = (0.3)(0.3)(0.6) = 0.054$\n$3.$ For $(m,n,p)=(0,1,0)$: $w_{010} = (0.7)(0.7)(0.6) = 0.294$\n$4.$ For $(m,n,p)=(0,0,1)$: $w_{001} = (0.7)(0.3)(0.4) = 0.084$\n$5.$ For $(m,n,p)=(1,1,0)$: $w_{110} = (0.3)(0.7)(0.6) = 0.126$\n$6.$ For $(m,n,p)=(1,0,1)$: $w_{101} = (0.3)(0.3)(0.4) = 0.036$\n$7.$ For $(m,n,p)=(0,1,1)$: $w_{011} = (0.7)(0.7)(0.4) = 0.196$\n$8.$ For $(m,n,p)=(1,1,1)$: $w_{111} = (0.3)(0.7)(0.4) = 0.084$\n\nA verification step is to sum the weights, which must equal $1$ due to the partition of unity constraint:\n$\\sum w = 0.126 + 0.054 + 0.294 + 0.084 + 0.126 + 0.036 + 0.196 + 0.084 = 1.000$. The calculation is correct.\n\nThe problem requires rounding to four significant figures. Since the results are exact with three decimal places, we add trailing zeros to meet this requirement.\n$w_{000} = 0.1260$\n$w_{100} = 0.05400$\n$w_{010} = 0.2940$\n$w_{001} = 0.08400$\n$w_{110} = 0.1260$\n$w_{101} = 0.03600$\n$w_{011} = 0.1960$\n$w_{111} = 0.08400$\n\nThese eight values are assembled into a single row matrix as the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1260 & 0.05400 & 0.2940 & 0.08400 & 0.1260 & 0.03600 & 0.1960 & 0.08400\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "With the tools to calculate and distribute source terms, we can now assemble a complete, time-dependent simulation. This capstone practice demonstrates the versatility of the PSI-CELL framework by shifting from momentum to energy coupling, tasking you with implementing a transient simulation of a particle heating up within a hot gas . By applying the principles of source calculation and distribution at each time step, you will not only model the system's evolution but also perform a critical step in computational science: verifying that your numerical implementation correctly conserves total energy.",
            "id": "4048795",
            "problem": "You are tasked with implementing a one-dimensional Particle-Source-In-Cell (PSI-CELL) coupling for a single char particle undergoing transient heat-up in a gas, consistent with conservation of energy in computational combustion. The governing fundamental base is the energy balance on the particle and on the gas control volumes. Start from the particle energy balance derived from the First Law of Thermodynamics, Newton’s law of cooling, and the definition of temperature as a measure of internal energy:\n- The particle obeys $m_p c_{p,p} \\frac{d T_p}{dt} = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$, where $m_p$ is the particle mass, $c_{p,p}$ is the particle specific heat capacity, $T_p$ is the particle temperature, $h$ is the convective heat transfer coefficient, $A_p$ is the particle surface area, and $T_g(x_p,t)$ is the interpolated gas temperature at the particle location $x_p$.\n- The gas obeys a finite-volume energy balance for each cell $i$ with volume $V_i$, density $\\rho_g$, and specific heat capacity $c_{p,g}$: the particle imposes a distributed power sink $S_h(t) = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$ into surrounding cells. Using Particle-Source-In-Cell (PSI-CELL) with linear shape functions in one spatial dimension, the sink is partitioned by weights $\\{w_i\\}$ that satisfy $\\sum_i w_i = 1$, yielding for cell $i$ a temperature evolution $\\frac{d T_{g,i}}{dt} = -\\frac{w_i S_h(t)}{\\rho_g c_{p,g} V_i}$.\n\nImplement a uniform one-dimensional domain of length $L$ with $N$ equally sized finite-volume cells. Let the cell width be $dx = L/N$, with cell centers located at $x_i = (i+\\frac{1}{2}) dx$ for $i = 0, 1, \\ldots, N-1$. Assume a unit cross-sectional area so that $V_i = dx$. The gas properties $\\rho_g$ and $c_{p,g}$ are constant in space and time. The particle is fixed at position $x_p$, does not move, and exchanges heat only convectively with the gas.\n\nUse explicit first-order time integration over $n_{\\text{steps}}$ time steps of size $\\Delta t$. At each time step:\n- Interpolate the gas temperature at the particle position using linear weights to the two nearest cell centers. Define weights as follows:\n  - If $x_p \\le x_0$, set $w_0 = 1$ and all other weights $w_i = 0$.\n  - If $x_p \\ge x_{N-1}$, set $w_{N-1} = 1$ and all other weights $w_i = 0$.\n  - Otherwise, find $j$ such that $x_j \\le x_p \\le x_{j+1}$ and set\n  $$w_j = \\frac{x_{j+1}-x_p}{x_{j+1}-x_j} \\quad \\text{and} \\quad w_{j+1} = \\frac{x_p - x_j}{x_{j+1}-x_j},$$\n  with all other weights $w_i = 0$.\n- Compute $S_h(t) = h A_p \\left(T_g^{\\text{interp}} - T_p\\right)$ where $T_g^{\\text{interp}} = \\sum_i w_i T_{g,i}$.\n- Update the particle temperature $T_p$ via\n$$ T_p \\leftarrow T_p + \\Delta t \\frac{S_h}{m_p c_{p,p}} $$\n- Update each affected gas cell temperature via\n$$ T_{g,i} \\leftarrow T_{g,i} - \\Delta t \\frac{w_i S_h}{\\rho_g c_{p,g} V_i} $$\n\nAfter all time steps, compute the energy conservation residual\n$$\nE_{\\text{res}} = \\left| m_p c_{p,p} \\left(T_p^{\\text{end}} - T_p^{0}\\right) + \\sum_{i=0}^{N-1} \\rho_g c_{p,g} V_i \\left(T_{g,i}^{\\text{end}} - T_{g,i}^{0}\\right) \\right|,\n$$\nwhich should be close to $0$ if the discretization is consistent and conservative.\n\nYour program must execute the above procedure for the following test suite of parameter sets. All quantities must be treated with the units indicated, and all temperatures must be expressed in Kelvin ($\\mathrm{K}$), lengths in meters ($\\mathrm{m}$), time in seconds ($\\mathrm{s}$), density in kilograms per cubic meter ($\\mathrm{kg}/\\mathrm{m}^3$), specific heat in joules per kilogram per Kelvin ($\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$), area in square meters ($\\mathrm{m}^2$), and the convective coefficient in watts per square meter per Kelvin ($\\mathrm{W}/(\\mathrm{m}^2 \\cdot \\mathrm{K})$).\n\nTest Suite:\n- Case $1$ (general): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 100\\,\\mathrm{W}/(\\mathrm{m}^2 \\cdot \\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 400$, $x_p = 0.045\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- Case $2$ (boundary mapping): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 100\\,\\mathrm{W}/(\\mathrm{m}^2 \\cdot \\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 400$, $x_p = 0.001\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- Case $3$ (zero coupling edge case): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $m_p = 1.0\\times 10^{-6}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 0\\,\\mathrm{W}/(\\mathrm{m}^2 \\cdot \\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-3}\\,\\mathrm{s}$, $n_{\\text{steps}} = 200$, $x_p = 0.055\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1200\\,\\mathrm{K}$ for all $i$.\n- Case $4$ (strong two-way coupling): $N = 10$, $L = 0.1\\,\\mathrm{m}$, $\\rho_g = 1.2\\,\\mathrm{kg}/\\mathrm{m}^3$, $c_{p,g} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $m_p = 5.0\\times 10^{-7}\\,\\mathrm{kg}$, $c_{p,p} = 1000\\,\\mathrm{J}/(\\mathrm{kg} \\cdot \\mathrm{K})$, $A_p = 1.0\\times 10^{-6}\\,\\mathrm{m}^2$, $h = 5000\\,\\mathrm{W}/(\\mathrm{m}^2 \\cdot \\mathrm{K})$, $\\Delta t = 1.0\\times 10^{-4}\\,\\mathrm{s}$, $n_{\\text{steps}} = 5000$, $x_p = 0.049\\,\\mathrm{m}$, $T_p^0 = 300\\,\\mathrm{K}$, $T_{g,i}^0 = 1000\\,\\mathrm{K}$ for all $i$.\n\nFor each case, compute:\n- The final particle temperature $T_p^{\\text{end}}$ in $\\mathrm{K}$, rounded to three decimal places.\n- The energy conservation residual $E_{\\text{res}}$ in $\\mathrm{J}$, rounded to six decimal places.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the sublist $[T_p^{\\text{end}}, E_{\\text{res}}]$ for each case, with no spaces. For example: $[[300.000,0.000000],[\\ldots],[\\ldots],[\\ldots]]$.",
            "solution": "The core of the problem lies in the conservation of energy for a coupled system composed of a single particle and a surrounding gas.\n\n**1. Scientific Principles and Model Formulation**\n\n- **Particle Energy Balance**: The temperature of the particle, $T_p$, evolves according to the first law of thermodynamics, where the change in internal energy is balanced by the heat transfer from the gas. Using Newton's law of cooling for convective heat transfer, this is expressed as:\n$$\nm_p c_{p,p} \\frac{d T_p}{dt} = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)\n$$\nHere, $m_p$ is the particle mass, $c_{p,p}$ is its specific heat, $A_p$ is its surface area, $h$ is the convective heat transfer coefficient, and $T_g(x_p,t)$ is the gas temperature at the particle's position $x_p$. The term on the right, $S_h(t) = h A_p \\left(T_g(x_p,t) - T_p(t)\\right)$, represents the power (heat transfer rate) exchanged.\n\n- **Gas Energy Balance**: The gas phase is discretized into finite volume cells. For each cell $i$, the change in its internal energy is due to the heat it exchanges with the particle. The power $S_h(t)$ from the particle is distributed to the surrounding gas cells as a volumetric source/sink term. The evolution of the temperature $T_{g,i}$ of cell $i$ is given by:\n$$\n\\rho_g c_{p,g} V_i \\frac{d T_{g,i}}{dt} = -w_i S_h(t)\n$$\nwhere $\\rho_g, c_{p,g}$ are the gas density and specific heat, $V_i$ is the cell volume, and $w_i$ is a weighting factor from the PSI-CELL method that partitions the total source term $S_h(t)$ among the cells. The negative sign indicates that if the particle gains energy from the gas ($S_h > 0$), the gas must lose that energy.\n\n**2. Discretization and Numerical Scheme**\n\n- **Spatial Discretization**: The one-dimensional domain of length $L$ is divided into $N$ uniform cells. The width of each cell is $dx = L/N$. The cell centers, which represent the location where the cell's properties (like temperature $T_{g,i}$) are stored, are located at $x_i = (i + 1/2)dx$ for $i=0, \\ldots, N-1$. For a unit cross-sectional area, the volume of each cell is $V_i = dx$.\n\n- **Temporal Discretization**: A first-order explicit (Forward Euler) method is used to integrate the governing ordinary differential equations (ODEs) in time. For a time step $\\Delta t$, the temperatures are updated from time $t^n$ to $t^{n+1} = t^n + \\Delta t$ as follows:\n$$\nT_p^{n+1} = T_p^n + \\Delta t \\frac{S_h^n}{m_p c_{p,p}}\n$$\n$$\nT_{g,i}^{n+1} = T_{g,i}^n - \\Delta t \\frac{w_i S_h^n}{\\rho_g c_{p,g} V_i}\n$$\nwhere $S_h^n$ is the source term calculated using temperatures at time $t^n$.\n\n**3. Particle-Source-In-Cell (PSI-CELL) Coupling**\n\nThe PSI-CELL method provides a conservative way to couple the Lagrangian particle with the Eulerian grid. It consists of two main steps at each time level:\n\n- **Interpolation (Gather)**: The gas temperature at the continuous particle position $x_p$, denoted $T_g^{\\text{interp}}$, is needed to calculate the heat transfer rate. This is obtained by interpolating from the discrete temperatures $T_{g,i}$ at the cell centers using linear shape functions (weights) $\\{w_i\\}$:\n$$\nT_g^{\\text{interp}} = \\sum_{i=0}^{N-1} w_i T_{g,i}\n$$\nThe weights are defined based on the particle's position relative to the two nearest cell centers, say $x_j$ and $x_{j+1}$. If $x_j \\le x_p \\le x_{j+1}$, the weights are:\n$$\nw_j = \\frac{x_{j+1}-x_p}{dx} \\quad \\text{and} \\quad w_{j+1} = \\frac{x_p-x_j}{dx}\n$$\nSpecial handling is defined for particles outside the span of the cell centers. Crucially, this formulation ensures that $\\sum_i w_i = 1$.\n\n- **Distribution (Scatter)**: The calculated point source $S_h = h A_p (T_g^{\\text{interp}} - T_p)$ must be distributed back to the grid. The same weights $\\{w_i\\}$ are used to partition the source, ensuring consistency. The source term for cell $i$ becomes $w_i S_h$.\n\n**4. Energy Conservation**\n\nThe use of the same weights for both interpolation and distribution guarantees that the discrete two-way coupling scheme is conservative. The total energy change in the particle over one time step is:\n$$\n\\Delta E_p = m_p c_{p,p} (T_p^{n+1} - T_p^n) = \\Delta t S_h^n\n$$\nThe total energy change in the gas is:\n$$\n\\Delta E_g = \\sum_i \\rho_g c_{p,g} V_i (T_{g,i}^{n+1} - T_{g,i}^n) = \\sum_i (-\\Delta t w_i S_h^n) = -\\Delta t S_h^n \\sum_i w_i\n$$\nSince $\\sum_i w_i = 1$, the total energy change of the system is $\\Delta E_{\\text{total}} = \\Delta E_p + \\Delta E_g = \\Delta t S_h^n - \\Delta t S_h^n = 0$.\nThe simulation will compute the cumulative energy residual over the entire simulation time:\n$$\nE_{\\text{res}} = \\left| \\Delta E_p^{\\text{total}} + \\Delta E_g^{\\text{total}} \\right| = \\left| m_p c_{p,p} (T_p^{\\text{end}} - T_p^0) + \\sum_{i=0}^{N-1} \\rho_g c_{p,g} V_i (T_{g,i}^{\\text{end}} - T_{g,i}^0) \\right|\n$$\nFor a conservative scheme, this value should be zero, subject to floating-point arithmetic errors.\n\n**5. Algorithm Implementation**\n\nFor each specified test case, the following procedure is executed:\n1.  Initialize all physical and numerical parameters, including the initial temperature arrays for the particle ($T_p$) and the gas grid ($T_g$). Store initial temperatures for the final residual calculation.\n2.  Pre-calculate the grid cell centers ($x_i$) and the constant cell volume ($V_i=dx$).\n3.  Determine the non-zero interpolation weights ($w_i$) and the corresponding cell indices based on the static particle position $x_p$.\n4.  Execute a loop for $n_{\\text{steps}}$ time steps. In each step:\n    a. Calculate the interpolated gas temperature $T_g^{\\text{interp}}$ at the particle position.\n    b. Compute the heat source term $S_h$.\n    c. Update the particle temperature $T_p$ using the Forward Euler step.\n    d. Update the temperatures $T_{g,i}$ of the affected gas cells using the Forward Euler step.\n5.  After the loop terminates, calculate the total change in particle energy and total change in gas energy.\n6.  Compute the absolute value of the sum of these energy changes to find the energy conservation residual $E_{\\text{res}}$.\n7.  Store the final particle temperature $T_p^{\\text{end}}$ and the residual $E_{\\text{res}}$, rounded to the specified precision.\nThe final results for all test cases are then formatted into the required output string.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Executes the Particle-Source-In-Cell (PSI) simulation for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 100.0,\n            \"dt\": 1.0e-3, \"n_steps\": 400, \"xp\": 0.045,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 2 (boundary mapping)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 100.0,\n            \"dt\": 1.0e-3, \"n_steps\": 400, \"xp\": 0.001,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 3 (zero coupling edge case)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 1.0e-6, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 0.0,\n            \"dt\": 1.0e-3, \"n_steps\": 200, \"xp\": 0.055,\n            \"T0_p\": 300.0, \"T0_g\": 1200.0\n        },\n        # Case 4 (strong two-way coupling)\n        {\n            \"N\": 10, \"L\": 0.1, \"rho_g\": 1.2, \"cp_g\": 1000.0,\n            \"m_p\": 5.0e-7, \"cp_p\": 1000.0, \"A_p\": 1.0e-6, \"h\": 5000.0,\n            \"dt\": 1.0e-4, \"n_steps\": 5000, \"xp\": 0.049,\n            \"T0_p\": 300.0, \"T0_g\": 1000.0\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        all_results.append(result)\n\n    # Format the output string as required\n    result_strings = [f\"[{tp_end:.3f},{e_res:.6f}]\" for tp_end, e_res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\n\ndef run_simulation(params):\n    \"\"\"\n    Runs a single particle-gas heat exchange simulation.\n    \n    Args:\n        params (dict): A dictionary containing all parameters for the simulation.\n        \n    Returns:\n        tuple: A tuple containing the final particle temperature and the energy residual.\n    \"\"\"\n    # Unpack parameters\n    N, L, rho_g, cp_g = params[\"N\"], params[\"L\"], params[\"rho_g\"], params[\"cp_g\"]\n    m_p, cp_p, A_p, h = params[\"m_p\"], params[\"cp_p\"], params[\"A_p\"], params[\"h\"]\n    dt, n_steps, xp = params[\"dt\"], params[\"n_steps\"], params[\"xp\"]\n    T0_p, T0_g = params[\"T0_p\"], params[\"T0_g\"]\n\n    # --- Initialization ---\n    dx = L / N\n    V_i = dx  # Cell volume with unit cross-sectional area\n    x_centers = np.array([(i + 0.5) * dx for i in range(N)])\n\n    Tp = T0_p\n    Tg = np.full(N, T0_g, dtype=float)\n    \n    # Store initial state for residual calculation\n    initial_Tp = T0_p\n    initial_Tg = np.copy(Tg)\n\n    # --- Pre-calculate interpolation weights ---\n    indices = []\n    weights = []\n\n    if xp <= x_centers[0]:\n        indices.append(0)\n        weights.append(1.0)\n    elif xp >= x_centers[N - 1]:\n        indices.append(N - 1)\n        weights.append(1.0)\n    else:\n        # Find j such that x_j <= xp <= x_{j+1}\n        found = False\n        for j in range(N - 1):\n            if x_centers[j] <= xp and xp <= x_centers[j+1]:\n                x_j, x_j1 = x_centers[j], x_centers[j + 1]\n                w_j = (x_j1 - xp) / dx\n                w_j1 = (xp - x_j) / dx\n                indices.extend([j, j + 1])\n                weights.extend([w_j, w_j1])\n                found = True\n                break\n        if not found:\n             # Should not happen with the logic above, but for safety\n             raise ValueError(\"Particle position is not within any cell interval.\")\n\n\n    # --- Time-stepping loop ---\n    for _ in range(n_steps):\n        # Interpolate gas temperature at particle location\n        Tg_interp = 0.0\n        for i, idx in enumerate(indices):\n            Tg_interp += weights[i] * Tg[idx]\n\n        # Calculate heat source term\n        S_h = h * A_p * (Tg_interp - Tp)\n\n        # Update particle temperature\n        Tp += dt * S_h / (m_p * cp_p)\n\n        # Update gas cell temperatures\n        for i, idx in enumerate(indices):\n            Tg[idx] -= dt * weights[i] * S_h / (rho_g * cp_g * V_i)\n\n    # --- Post-processing ---\n    # Final particle temperature\n    Tp_end = Tp\n\n    # Calculate energy conservation residual\n    dE_p = m_p * cp_p * (Tp_end - initial_Tp)\n    dE_g_total = np.sum(rho_g * cp_g * V_i * (Tg - initial_Tg))\n    E_res = abs(dE_p + dE_g_total)\n\n    return Tp_end, E_res\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}