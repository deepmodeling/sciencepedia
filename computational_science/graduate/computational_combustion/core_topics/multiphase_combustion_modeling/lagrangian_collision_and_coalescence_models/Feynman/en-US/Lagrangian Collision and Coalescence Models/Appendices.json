{
    "hands_on_practices": [
        {
            "introduction": "At the heart of any stochastic collision model lies the mathematical expression for the probability of an event occurring within a given time step. This first exercise guides you through the fundamental derivation of the collision probability used in many Lagrangian spray simulations . Starting from the physical picture of a dilute Poisson process, you will derive the simplified No-Time-Counter (NTC) model, analyze its limitations, and then develop the exact, physically-consistent probability, providing crucial insight into the assumptions and validity of common numerical schemes.",
            "id": "4034271",
            "problem": "In a Lagrangian spray model for computational combustion, consider two liquid-droplet parcels $i$ and $j$ residing in the same Eulerian computational cell of volume $V_{c}$. Parcel $i$ represents $N_{i}$ identical spherical droplets of diameter $d_{i}$ and parcel $j$ represents $N_{j}$ identical spherical droplets of diameter $d_{j}$. The parcels have a statistically stationary relative speed magnitude $|u_{ij}|$ during a timestep of duration $\\Delta t$, and collisions have a collection efficiency $E_{c} \\in (0,1]$ accounting for hydrodynamic interactions. Assume that collisions between individual droplets can be modeled as a dilute, memoryless Poisson process and that coalescence occurs upon collision.\n\nThe geometric collision kernel per droplet pair is defined by the well-tested Smoluchowski form for rectilinear approach,\n$$\nk_{ij} \\equiv E_{c} \\, \\pi \\left(d_{i} + d_{j}\\right)^{2} \\, |u_{ij}|,\n$$\nwhich has units of volume per time. Let the parcel-pair event-rate coefficient be\n$$\n\\beta_{ij} \\equiv N_{i} N_{j} \\, k_{ij}.\n$$\nStarting from the fundamental definitions of number density, relative flux, and the Poisson assumption for collision events, derive the No-Time-Counter (NTC) expression for the probability of at least one collision between parcels $i$ and $j$ within the timestep,\n$$\nP_{ij} = \\frac{\\beta_{ij} \\, \\Delta t}{V_{c}},\n$$\nas the leading-order approximation. Explicitly identify the modeling assumptions that lead to this linear-in-time form.\n\nThen, analyze the constraint $P_{ij} \\le 1$ that must be satisfied for probabilistic consistency in stochastic sampling. Discuss conditions under which this constraint is violated in practice (for example, large $\\Delta t$, small $V_{c}$, large $N_{i}$, $N_{j}$, or large $|u_{ij}|$), and outline physically consistent remedies that preserve mass and number and avoid biasing the coalescence rate. Your discussion should cover at least one approach that uses substepping and one approach that uses an exact-event probability consistent with a Poisson process.\n\nFinally, provide a single closed-form analytical expression for a corrected collision probability $\\widetilde{P}_{ij}$ that:\n- is valid for arbitrary $\\Delta t$,\n- enforces $\\widetilde{P}_{ij} \\le 1$ automatically,\n- and reduces to the NTC expression $P_{ij} = \\beta_{ij} \\, \\Delta t / V_{c}$ in the limit $\\beta_{ij} \\, \\Delta t / V_{c} \\ll 1$.\n\nExpress the final corrected probability as a single analytical formula. No numerical evaluation is required, and no units should be included in the final boxed expression.",
            "solution": "The problem requires a three-part analysis of a collision model used in computational combustion simulations: first, the derivation of the approximate No-Time-Counter (NTC) collision probability; second, an analysis of its limitations and potential remedies; and third, the derivation of a corrected, physically consistent collision probability. The validation of the problem statement confirms that it is scientifically grounded, well-posed, and based on established principles in multiphase flow modeling. We may therefore proceed with the solution.\n\nFirst, we derive the NTC expression for the collision probability, $P_{ij}$. The fundamental premise is that droplet collisions within the computational cell volume $V_c$ constitute a Poisson process. The rate of this process, $\\lambda_{ij}$, must be determined.\n\nConsider a single droplet from parcel $i$ and a single droplet from parcel $j$. The problem defines the collision kernel per droplet pair, $k_{ij}$, with units of volume per time. This kernel represents the volume swept out per unit time by one droplet relative to the other, corrected for collection efficiency. Assuming the droplets are uniformly distributed throughout the cell volume $V_c$, the probability per unit time of these two specific droplets colliding is the ratio of the swept volume rate to the total volume, which is $\\frac{k_{ij}}{V_c}$. This quantity has units of T$^{-1}$ and represents a frequency, or a rate.\n\nThe model considers $N_i$ droplets in parcel $i$ and $N_j$ droplets in parcel $j$. The total number of distinct interacting pairs between the two parcels is $N_i N_j$. Since the process is assumed to be dilute, the collisions of different pairs are treated as independent events. Therefore, the total rate of collision events between any droplet from parcel $i$ and any droplet from parcel $j$ is the rate per pair multiplied by the total number of pairs:\n$$\n\\lambda_{ij} = N_i N_j \\left( \\frac{k_{ij}}{V_c} \\right)\n$$\nUsing the problem's definition of the parcel-pair event-rate coefficient, $\\beta_{ij} \\equiv N_i N_j k_{ij}$, the total collision rate can be written as:\n$$\n\\lambda_{ij} = \\frac{\\beta_{ij}}{V_c}\n$$\nFor a Poisson process with a constant mean rate $\\lambda_{ij}$, the probability of observing exactly $k$ events in a time interval $\\Delta t$ is given by:\n$$\nP(k; \\lambda_{ij}, \\Delta t) = \\frac{(\\lambda_{ij} \\Delta t)^k \\exp(-\\lambda_{ij} \\Delta t)}{k!}\n$$\nThe probability of at least one collision is $P(k \\ge 1) = 1 - P(k=0)$. The probability of zero collisions is:\n$$\nP(k=0) = \\frac{(\\lambda_{ij} \\Delta t)^0 \\exp(-\\lambda_{ij} \\Delta t)}{0!} = \\exp(-\\lambda_{ij} \\Delta t)\n$$\nThus, the exact probability of at least one collision during $\\Delta t$ is:\n$$\nP_{ij, \\text{exact}} = 1 - \\exp(-\\lambda_{ij} \\Delta t) = 1 - \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_c}\\right)\n$$\nThe NTC expression is a leading-order approximation of this exact probability, valid in the limit where the expected number of events is small. Let $x = \\frac{\\beta_{ij} \\Delta t}{V_c}$. For $x \\ll 1$, we can use the Taylor series expansion of the exponential function, $e^{-x} \\approx 1 - x$. Substituting this into the exact probability expression yields the approximation:\n$$\nP_{ij} \\approx 1 - \\left(1 - \\frac{\\beta_{ij} \\Delta t}{V_c}\\right) = \\frac{\\beta_{ij} \\Delta t}{V_c}\n$$\nThis is the desired NTC expression. The key modeling assumptions that lead to this linear-in-time form are:\n1.  Collisions are modeled as a memoryless Poisson process, implying events are independent and random, which is appropriate for dilute sprays.\n2.  Droplets from both parcels are uniformly distributed throughout the cell volume $V_c$, which justifies the use of macroscopic number densities.\n3.  The collision rate $\\lambda_{ij}$ is constant over the timestep $\\Delta t$. This is supported by the problem statement's condition of a \"statistically stationary relative speed magnitude $|u_{ij}|$\" and implies that $N_i$ and $N_j$ do not change significantly due to collisions within that timestep.\n4.  The expected number of collision events during the timestep is much less than one, i.e., $\\lambda_{ij} \\Delta t = \\frac{\\beta_{ij} \\Delta t}{V_c} \\ll 1$. This is the crucial mathematical assumption that validates the linearization of the exponential function.\n\nNext, we analyze the probabilistic consistency constraint $P_{ij} \\le 1$. The NTC expression $P_{ij} = \\frac{\\beta_{ij} \\Delta t}{V_c}$ is a linear function of its parameters and is unbounded. It can exceed $1$, which is a violation of the definition of probability. This violation occurs in practice when the assumption $\\lambda_{ij} \\Delta t \\ll 1$ is broken. This happens under conditions of:\n-   A large timestep, $\\Delta t$.\n-   A small computational cell volume, $V_c$.\n-   Large droplet numbers in the parcels, $N_i$ and $N_j$.\n-   A large collision kernel, $k_{ij}$, which can result from large droplet diameters ($d_i, d_j$) or high relative speeds ($|u_{ij}|$).\nSuch conditions are common in regions of dense spray, near injectors, or where the computational mesh is highly refined.\n\nPhysically consistent remedies must be employed to handle cases where $P_{ij} > 1$. These remedies should ensure that the collision statistics are handled correctly without introducing bias, and that mass and number are conserved.\n1.  **Substepping:** The most direct way to enforce the condition $\\lambda_{ij} \\Delta t \\ll 1$ is to reduce $\\Delta t$. If the overall fluid-dynamics timestep $\\Delta t$ is too large, it can be divided into $M$ smaller collision substeps of duration $\\Delta t_s = \\Delta t / M$. The number of substeps $M$ is chosen such that the collision probability in a substep, $P_{ij,s} = \\frac{\\beta_{ij} \\Delta t_s}{V_c}$, is well below $1$. After each substep, the parcel populations ($N_i, N_j$) are updated if a collision-coalescence event occurs. This method correctly models the depleting population of reactants (colliding droplets) over the full timestep $\\Delta t$. However, it increases computational cost significantly.\n2.  **Using an Exact-Event Probability:** A more computationally efficient remedy is to abandon the linear NTC approximation and use a more accurate probability expression. The issue with $P_{ij} > 1$ is that it implies an average of more than one collision event in the timestep. Instead of simply capping the probability at $1$ (which would bias the collision rate downwards), one can use a formulation that is inherently bounded. The exact Poisson probability for at least one event, $P_{ij, \\text{exact}} = 1 - \\exp(-\\lambda_{ij} \\Delta t)$, is a natural choice. This expression is always in the range $[0, 1)$ and correctly represents the probability of one or more collisions. If a collision is sampled using this probability, it is typically assumed that a single coalescence event occurs. This is still an approximation, as it doesn't account for the possibility of multiple distinct collision events within $\\Delta t$, but it is a significant improvement over the NTC method and avoids the unphysical $P_{ij} > 1$ issue without the cost of substepping.\n\nFinally, we are asked to provide a single closed-form analytical expression for a corrected collision probability, $\\widetilde{P}_{ij}$, that satisfies three conditions: validity for arbitrary $\\Delta t$, automatic enforcement of $\\widetilde{P}_{ij} \\le 1$, and reduction to the NTC form in the appropriate limit.\n\nAs derived and discussed above, the exact probability for at least one event in a Poisson process meets all these criteria. Let us define the corrected probability $\\widetilde{P}_{ij}$ as this exact probability:\n$$\n\\widetilde{P}_{ij} = 1 - \\exp(-\\lambda_{ij} \\Delta t) = 1 - \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_c}\\right)\n$$\nLet's verify the conditions:\n1.  **Validity for arbitrary $\\Delta t$**: The exponential function is defined for all real arguments. As $\\Delta t \\ge 0$, the argument of the exponential is always non-positive, and the function is well-behaved.\n2.  **Enforces $\\widetilde{P}_{ij} \\le 1$**: Since all physical quantities ($\\beta_{ij}$, $\\Delta t$, $V_c$) are non-negative, the argument of the exponential, $-\\frac{\\beta_{ij} \\Delta t}{V_c}$, is always less than or equal to $0$. Thus, $0  \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_c}\\right) \\le 1$. It follows that $0 \\le 1 - \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_c}\\right)  1$. The condition $\\widetilde{P}_{ij} \\le 1$ is therefore always satisfied.\n3.  **Reduces to NTC expression**: In the limit where $\\frac{\\beta_{ij} \\Delta t}{V_c} \\ll 1$, we use the Taylor expansion $\\exp(-x) \\approx 1-x$ for small $x$.\n    $$\n    \\widetilde{P}_{ij} = 1 - \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_c}\\right) \\approx 1 - \\left(1 - \\frac{\\beta_{ij} \\Delta t}{V_c}\\right) = \\frac{\\beta_{ij} \\Delta t}{V_c}\n    $$\n    This is precisely the NTC expression.\n\nTherefore, the corrected collision probability is the exact Poisson probability for at least one event.",
            "answer": "$$\n\\boxed{1 - \\exp\\left(-\\frac{\\beta_{ij} \\Delta t}{V_{c}}\\right)}\n$$"
        },
        {
            "introduction": "Once a collision has been statistically sampled, the next step is to correctly update the properties of the interacting parcels according to physical conservation laws. This practice explores the dynamics of an inelastic coalescence event, focusing specifically on the conservation of momentum and energy . You will derive the kinetic energy that is dissipated from the mean motion and re-partitioned into internal or surface energy, a critical step for ensuring the simulation remains physically realistic and conserves total energy.",
            "id": "4034296",
            "problem": "Consider two Lagrangian liquid-fuel parcels in a high-pressure combustor. Parcel $1$ has mass $m_1$ and velocity $\\boldsymbol{v}_1$, and parcel $2$ has mass $m_2$ and velocity $\\boldsymbol{v}_2$. They undergo a coalescing collision and are merged into a single parcel of mass $m = m_1 + m_2$. In the Lagrangian collision–coalescence update, linear momentum is conserved, and the merged parcel is advanced with a single mean velocity determined by conservation of momentum. However, because the two incoming parcels have different velocities, there exists relative translational kinetic energy associated with their motion that is generally dissipated during coalescence.\n\nIn a computational combustion model, suppose you wish to maintain the total parcel-ensemble kinetic energy at the discrete level by attributing the dissipated relative translational energy to a stored, isotropic, zero-mean agitation represented by a pseudo-velocity $\\boldsymbol{u}$ associated with the merged parcel. This pseudo-velocity contributes to the parcel’s kinetic energy as $\\tfrac{1}{2} m |\\boldsymbol{u}|^2$ but is not used for momentum update or advection, so it does not alter linear momentum.\n\nStarting only from conservation of linear momentum, the definition of kinetic energy, and vector algebra, derive a closed-form analytic expression for the squared magnitude $|\\boldsymbol{u}|^2$ that is necessary and sufficient to make the merged parcel’s total (mean plus agitation) kinetic energy exactly equal to the sum of the two incoming parcels’ translational kinetic energies. Your derivation should explicitly identify the role of the incoming relative motion and connect the dissipated energy to physically meaningful reservoirs in coalescence, including internal modes (e.g., temperature rise) and surface energy, in terms of fundamental concepts such as surface tension energy.\n\nExpress your final answer as a single analytic expression for $|\\boldsymbol{u}|^2$ in $\\mathrm{m^2/s^2}$ in terms of $m_1$, $m_2$, $\\boldsymbol{v}_1$, and $\\boldsymbol{v}_2$. No numerical evaluation is required.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It describes a physically consistent scenario of an inelastic collision within a clearly defined modeling framework. The necessary information is provided to derive a unique solution based on the principles of conservation of linear momentum and a prescribed form of energy conservation.\n\nThe derivation proceeds from the fundamental principles of conservation of linear momentum and the total energy balance as defined in the problem statement.\n\nFirst, we establish the velocity of the merged parcel. The collision is governed by the conservation of linear momentum. The total momentum before the collision is the sum of the individual momenta of the two parcels:\n$$\n\\boldsymbol{P}_{\\text{initial}} = m_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2\n$$\nAfter the collision, the two parcels merge into a single parcel of mass $m = m_1 + m_2$ moving with a mean velocity $\\boldsymbol{v}$. Its momentum is:\n$$\n\\boldsymbol{P}_{\\text{final}} = (m_1 + m_2) \\boldsymbol{v} = m \\boldsymbol{v}\n$$\nBy conservation of linear momentum, $\\boldsymbol{P}_{\\text{initial}} = \\boldsymbol{P}_{\\text{final}}$. Therefore:\n$$\nm_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2 = (m_1 + m_2) \\boldsymbol{v}\n$$\nSolving for the final mean velocity $\\boldsymbol{v}$ yields:\n$$\n\\boldsymbol{v} = \\frac{m_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2}{m_1 + m_2}\n$$\nThis velocity is the velocity of the center of mass of the two-parcel system, which remains constant throughout the collision process as there are no external forces.\n\nNext, we apply the energy conservation condition stipulated by the problem. The total kinetic energy of the two parcels before the collision is the sum of their individual translational kinetic energies:\n$$\nK_{\\text{initial}} = \\frac{1}{2} m_1 |\\boldsymbol{v}_1|^2 + \\frac{1}{2} m_2 |\\boldsymbol{v}_2|^2\n$$\nAfter the collision, the problem states that the total kinetic energy of the merged parcel is the sum of its mean translational kinetic energy, $\\frac{1}{2} m |\\boldsymbol{v}|^2$, and a stored agitation energy, $\\frac{1}{2} m |\\boldsymbol{u}|^2$.\n$$\nK_{\\text{final}} = \\frac{1}{2} m |\\boldsymbol{v}|^2 + \\frac{1}{2} m |\\boldsymbol{u}|^2\n$$\nThe problem requires that the total energy be conserved, so $K_{\\text{initial}} = K_{\\text{final}}$:\n$$\n\\frac{1}{2} m_1 |\\boldsymbol{v}_1|^2 + \\frac{1}{2} m_2 |\\boldsymbol{v}_2|^2 = \\frac{1}{2} m |\\boldsymbol{v}|^2 + \\frac{1}{2} m |\\boldsymbol{u}|^2\n$$\nWe want to find an expression for $|\\boldsymbol{u}|^2$. Rearranging the equation to solve for the agitation energy term gives:\n$$\n\\frac{1}{2} m |\\boldsymbol{u}|^2 = \\left( \\frac{1}{2} m_1 |\\boldsymbol{v}_1|^2 + \\frac{1}{2} m_2 |\\boldsymbol{v}_2|^2 \\right) - \\frac{1}{2} m |\\boldsymbol{v}|^2\n$$\nThis equation shows that the agitation energy term, $\\frac{1}{2} m |\\boldsymbol{u}|^2$, is precisely the difference between the initial kinetic energy and the final mean kinetic energy of the system. This difference is the kinetic energy that is \"lost\" or dissipated from the bulk translational motion during the inelastic coalescence.\n\nTo find $|\\boldsymbol{u}|^2$, we first solve for the dissipated energy. Let's substitute the expressions for $m$ and $\\boldsymbol{v}$:\n$$\nm |\\boldsymbol{u}|^2 = m_1 |\\boldsymbol{v}_1|^2 + m_2 |\\boldsymbol{v}_2|^2 - (m_1 + m_2) \\left| \\frac{m_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2}{m_1 + m_2} \\right|^2\n$$\nThe last term can be expanded using the property $|\\boldsymbol{a}|^2 = \\boldsymbol{a} \\cdot \\boldsymbol{a}$:\n$$\n(m_1 + m_2) \\frac{(m_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2) \\cdot (m_1 \\boldsymbol{v}_1 + m_2 \\boldsymbol{v}_2)}{(m_1 + m_2)^2} = \\frac{m_1^2 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2 + 2 m_1 m_2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2)}{m_1 + m_2}\n$$\nSubstituting this back into the equation for $m |\\boldsymbol{u}|^2$:\n$$\nm |\\boldsymbol{u}|^2 = m_1 |\\boldsymbol{v}_1|^2 + m_2 |\\boldsymbol{v}_2|^2 - \\frac{m_1^2 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2 + 2 m_1 m_2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2)}{m_1 + m_2}\n$$\nTo simplify, we put all terms over the common denominator $(m_1 + m_2)$:\n$$\nm |\\boldsymbol{u}|^2 = \\frac{(m_1 + m_2)(m_1 |\\boldsymbol{v}_1|^2 + m_2 |\\boldsymbol{v}_2|^2) - (m_1^2 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2 + 2 m_1 m_2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2))}{m_1 + m_2}\n$$\nExpanding the first part of the numerator:\n$$\n(m_1 + m_2)(m_1 |\\boldsymbol{v}_1|^2 + m_2 |\\boldsymbol{v}_2|^2) = m_1^2 |\\boldsymbol{v}_1|^2 + m_1 m_2 |\\boldsymbol{v}_2|^2 + m_2 m_1 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2\n$$\nSubstituting this into the numerator expression and simplifying:\n$$\n\\text{Numerator} = (m_1^2 |\\boldsymbol{v}_1|^2 + m_1 m_2 |\\boldsymbol{v}_2|^2 + m_1 m_2 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2) - (m_1^2 |\\boldsymbol{v}_1|^2 + m_2^2 |\\boldsymbol{v}_2|^2 + 2 m_1 m_2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2))\n$$\n$$\n\\text{Numerator} = m_1 m_2 |\\boldsymbol{v}_1|^2 + m_1 m_2 |\\boldsymbol{v}_2|^2 - 2 m_1 m_2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2)\n$$\nFactoring out the term $m_1 m_2$:\n$$\n\\text{Numerator} = m_1 m_2 (|\\boldsymbol{v}_1|^2 - 2 (\\boldsymbol{v}_1 \\cdot \\boldsymbol{v}_2) + |\\boldsymbol{v}_2|^2)\n$$\nThe expression in the parentheses is the expansion of the squared magnitude of the relative velocity vector, $(\\boldsymbol{v}_1 - \\boldsymbol{v}_2) \\cdot (\\boldsymbol{v}_1 - \\boldsymbol{v}_2) = |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2$.\nThus, the numerator simplifies to:\n$$\n\\text{Numerator} = m_1 m_2 |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2\n$$\nThis result explicitly identifies the central role of the incoming relative motion, as requested. The dissipated energy depends directly on the relative velocity between the parcels.\nSo we have:\n$$\nm |\\boldsymbol{u}|^2 = \\frac{m_1 m_2}{m_1 + m_2} |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2\n$$\nThe term $\\frac{m_1 m_2}{m_1 + m_2}$ is the reduced mass of the system, often denoted by $\\mu$. The dissipated energy is therefore $\\frac{1}{2} \\mu |\\boldsymbol{v}_{\\text{rel}}|^2$, which is the kinetic energy associated with the relative motion of the two parcels in the center-of-mass frame.\n\nFinally, we solve for $|\\boldsymbol{u}|^2$ by dividing by the total mass $m = m_1 + m_2$:\n$$\n|\\boldsymbol{u}|^2 = \\frac{1}{m_1 + m_2} \\left(\\frac{m_1 m_2}{m_1 + m_2}\\right) |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2 = \\frac{m_1 m_2}{(m_1 + m_2)^2} |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2\n$$\nThis is the closed-form analytic expression for the squared magnitude of the pseudo-velocity.\n\nIn a physical coalescence, the dissipated kinetic energy, $\\frac{1}{2} m |\\boldsymbol{u}|^2$, is converted into other energy forms. The pseudo-velocity $\\boldsymbol{u}$ is a modeling construct to track this energy. The primary physical reservoirs for this energy are:\n$1$. Internal Energy: Viscous dissipation during the fluid deformation and merging of the parcels converts kinetic energy into thermal energy, resulting in a temperature rise.\n$2$. Surface Energy: Two spherical parcels have a total surface area $A_i \\propto (m_1^{2/3} + m_2^{2/3})$, while the merged spherical parcel has an area $A_f \\propto (m_1+m_2)^{2/3}$. Since $x^{2/3}$ is a concave function, $A_i > A_f$. This reduction in surface area releases surface energy $\\Delta E_s = \\sigma (A_i - A_f)$, where $\\sigma$ is the surface tension. This energy is also largely converted to internal heat.\n$3$. Vibrational and Rotational Energy: The resulting merged parcel may be left in an oscillating, non-spherical shape or with bulk rotation, representing another temporary energy reservoir.\n\nThe computational model's use of $\\frac{1}{2} m |\\boldsymbol{u}|^2$ lumps these complex physical effects into a single, tractable scalar quantity, ensuring that energy is conserved within the discrete numerical simulation.",
            "answer": "$$\n\\boxed{\\frac{m_1 m_2}{(m_1 + m_2)^2} |\\boldsymbol{v}_1 - \\boldsymbol{v}_2|^2}\n$$"
        },
        {
            "introduction": "Bridging the gap from physical theory to a working simulation requires careful attention to algorithmic details, especially when dealing with complex geometries like periodic domains. This hands-on coding problem addresses the practical challenges of correctly implementing collision detection algorithms, forcing you to confront common pitfalls such as pair double-counting and the proper handling of particle interactions across periodic boundaries . By implementing both a naive and a corrected algorithm, you will gain direct experience in writing robust, unbiased code that is essential for accurate large-scale simulations.",
            "id": "4034236",
            "problem": "Consider a three-dimensional toroidal domain with Periodic Boundary Conditions (PBC) of side length $L$ in each Cartesian direction, populated by a finite set of Lagrangian droplets treated as rigid spheres. Each droplet $i$ has position vector $\\mathbf{x}_i$ in meters, velocity vector $\\mathbf{v}_i$ in meters per second, and radius $r_i$ in meters. Let the domain volume be $V = L^3$ in cubic meters, and consider a fixed time step $\\Delta t$ in seconds. Assume constant velocities over the time step (no external forces, no drag variation), so that each droplet’s trajectory is $\\mathbf{x}_i(t) = \\mathbf{x}_i(0) + \\mathbf{v}_i t$ for $t \\in [0,\\Delta t]$.\n\nWe are interested in algorithmic pair counting for collision-coalescence sampling. The physical model uses the ballistic collision kernel appropriate for rigid spherical droplets: if two droplets $i$ and $j$ move relative to each other with relative speed $|\\mathbf{u}_{ij}| = \\|\\mathbf{v}_j - \\mathbf{v}_i\\|$, then the collision rate per pair is proportional to the geometric cross section area $\\pi (r_i + r_j)^2$ times the relative speed. In a homogeneous volume approximation, the expected number of collisions contributed by unordered pair $(i,j)$ during the time step $\\Delta t$ is\n$$\np_{ij} = \\min\\left(1, \\frac{\\pi (r_i + r_j)^2 \\, |\\mathbf{u}_{ij}| \\, \\Delta t}{V}\\right),\n$$\nwhich is dimensionless. To avoid counting physically impossible collisions, enforce the following kinematic feasibility check derived from constant-velocity motion: define the relative position at $t=0$ as $\\mathbf{r}_{ij}(0) = \\mathbf{x}_j(0) - \\mathbf{x}_i(0)$ and relative velocity $\\mathbf{u}_{ij} = \\mathbf{v}_j - \\mathbf{v}_i$. Over $t \\in [0,\\Delta t]$, the separation evolves as $\\mathbf{r}_{ij}(t) = \\mathbf{r}_{ij}(0) + \\mathbf{u}_{ij} t$. Let $t^\\star = \\operatorname{clamp}\\left(-\\frac{\\mathbf{r}_{ij}(0)\\cdot \\mathbf{u}_{ij}}{\\|\\mathbf{u}_{ij}\\|^2}, 0, \\Delta t\\right)$ be the time of minimum separation within the interval and $d_{\\min} = \\|\\mathbf{r}_{ij}(t^\\star)\\|$. A collision is kinematically feasible in the time step if and only if $d_{\\min} \\le r_i + r_j$.\n\nIn a toroidal domain, the displacement $\\mathbf{r}_{ij}(0)$ must be computed using the minimum-image convention so that each component lies in the interval $[-L/2, L/2)$. For each Cartesian component $k \\in \\{x,y,z\\}$,\n$$\nr_{ij,k}^{\\text{MI}} = \\left(x_{j,k} - x_{i,k}\\right) - L \\cdot \\operatorname{round}\\left(\\frac{x_{j,k} - x_{i,k}}{L}\\right).\n$$\nUsing the minimum-image displacement ensures unbiased treatment of pairs whose geometric separation spans PBC boundaries. Unbiased collision sampling also requires counting unordered pairs exactly once; double counting ordered pairs $(i,j)$ and $(j,i)$ biases the estimator by a factor of two in regions away from boundaries.\n\nYour task is to write a complete program that, for each provided test case, computes two quantities:\n- A naive expected collision count per time step computed by summing $p_{ij}$ over all ordered pairs $i \\ne j$ using the unwrapped displacement $\\mathbf{x}_j - \\mathbf{x}_i$ (no minimum-image correction) in the kinematic feasibility check.\n- A corrected expected collision count per time step computed by summing $p_{ij}$ over all unordered pairs $i  j$ using the minimum-image displacement in the kinematic feasibility check.\n\nFor both counts, include a pair’s contribution $p_{ij}$ if and only if the kinematic feasibility criterion $d_{\\min} \\le r_i + r_j$ is met. All positions must be interpreted modulo $L$ due to PBC (i.e., inputs may lie anywhere in $[0,L)$ per component). Use International System of Units (SI): positions in meters, velocities in meters per second, radii in meters, $L$ in meters, and $\\Delta t$ in seconds. The expected collision count is dimensionless and must be output as decimal floats.\n\nTest suite:\n1. Case A (boundary-spanning approach, $3$-torus of side $L=0.01$ m): two droplets,\n   - Droplet $1$: $\\mathbf{x}_1 = [0.0005, 0.0, 0.0]$ m, $\\mathbf{v}_1 = [-0.5, 0.0, 0.0]$ m/s, $r_1 = 2\\times 10^{-4}$ m.\n   - Droplet $2$: $\\mathbf{x}_2 = [0.0095, 0.0, 0.0]$ m, $\\mathbf{v}_2 = [0.5, 0.0, 0.0]$ m/s, $r_2 = 2\\times 10^{-4}$ m.\n   - $\\Delta t = 0.002$ s.\n2. Case B (interior approach, double-counting check, $3$-torus of side $L=0.01$ m): two droplets,\n   - Droplet $1$: $\\mathbf{x}_1 = [0.004, 0.0, 0.0]$ m, $\\mathbf{v}_1 = [0.5, 0.0, 0.0]$ m/s, $r_1 = 2\\times 10^{-4}$ m.\n   - Droplet $2$: $\\mathbf{x}_2 = [0.006, 0.0, 0.0]$ m, $\\mathbf{v}_2 = [-0.5, 0.0, 0.0]$ m/s, $r_2 = 2\\times 10^{-4}$ m.\n   - $\\Delta t = 0.003$ s.\n3. Case C (mixed three-droplet configuration with one boundary-spanning approach, $3$-torus of side $L=0.02$ m): three droplets,\n   - Droplet $1$: $\\mathbf{x}_1 = [0.0198, 0.001, 0.0]$ m, $\\mathbf{v}_1 = [0.2, 0.0, 0.0]$ m/s, $r_1 = 2\\times 10^{-4}$ m.\n   - Droplet $2$: $\\mathbf{x}_2 = [0.0005, 0.001, 0.0]$ m, $\\mathbf{v}_2 = [-0.2, 0.0, 0.0]$ m/s, $r_2 = 2\\times 10^{-4}$ m.\n   - Droplet $3$: $\\mathbf{x}_3 = [0.010, 0.010, 0.0]$ m, $\\mathbf{v}_3 = [0.0, 0.0, 0.0]$ m/s, $r_3 = 1\\times 10^{-4}$ m.\n   - $\\Delta t = 0.005$ s.\n\nYour program should produce a single line of output containing six decimal floats in a comma-separated list enclosed in square brackets, ordered as\n$$\n[\\text{naive\\_A}, \\text{corrected\\_A}, \\text{naive\\_B}, \\text{corrected\\_B}, \\text{naive\\_C}, \\text{corrected\\_C}],\n$$\nwhere each entry is the expected collision count for the specified case and method. The output must be exactly in the form of a Python list string, such as $[\\text{float1},\\text{float2},\\ldots]$.",
            "solution": "The problem statement has been validated and is found to be scientifically grounded, well-posed, and objective. It presents a clear computational task based on established principles of Lagrangian particle tracking and collision modeling in a periodic domain. All necessary parameters, definitions, and equations are provided, allowing for a unique and verifiable solution.\n\nThe problem requires the computation of an expected collision count for a set of spherical droplets in a three-dimensional toroidal domain over a time step $\\Delta t$. The solution involves implementing two distinct algorithmic approaches: a \"naive\" method and a \"corrected\" method, distinguished by their handling of periodic boundary conditions and pair counting.\n\nThe core of the calculation rests on three concepts: the collision probability, the kinematic feasibility of a collision, and the treatment of periodicity.\n\n1.  **Collision Probability ($p_{ij}$)**: The probability of collision for a droplet pair $(i,j)$ is given by\n    $$p_{ij} = \\min\\left(1, \\frac{\\pi (r_i + r_j)^2 \\, |\\mathbf{u}_{ij}| \\, \\Delta t}{V}\\right)$$\n    This expression represents the volume swept by droplet $j$ relative to droplet $i$ (or vice versa), normalized by the total domain volume $V = L^3$. The term $\\pi (r_i + r_j)^2$ is the collision cross-section for two spheres of radii $r_i$ and $r_j$. The term $|\\mathbf{u}_{ij}| \\Delta t$ is the distance the droplets travel relative to each other during the time step $\\Delta t$, where $\\mathbf{u}_{ij} = \\mathbf{v}_j - \\mathbf{v}_i$ is the relative velocity. The product forms a \"collision volume\". The $\\min(1, \\cdot)$ function ensures the result remains a valid probability.\n\n2.  **Kinematic Feasibility**: The collision probability $p_{ij}$ is only physically relevant if the droplets' trajectories actually intersect. Assuming constant velocity, the relative position vector evolves as $\\mathbf{r}_{ij}(t) = \\mathbf{r}_{ij}(0) + \\mathbf{u}_{ij} t$. The squared separation distance is a quadratic function of time: $d(t)^2 = \\|\\mathbf{r}_{ij}(t)\\|^2 = \\|\\mathbf{r}_{ij}(0) + \\mathbf{u}_{ij} t\\|^2$. The minimum of this function within the interval $t \\in [0, \\Delta t]$ occurs at time $t^\\star$, which is found by setting the derivative $\\frac{d}{dt}d(t)^2 = 0$. This yields an unconstrained minimum at $t = -\\frac{\\mathbf{r}_{ij}(0)\\cdot \\mathbf{u}_{ij}}{\\|\\mathbf{u}_{ij}\\|^2}$. The problem defines $t^\\star$ as this value clamped to the interval $[0, \\Delta t]$:\n    $$t^\\star = \\operatorname{clamp}\\left(-\\frac{\\mathbf{r}_{ij}(0)\\cdot \\mathbf{u}_{ij}}{\\|\\mathbf{u}_{ij}\\|^2}, 0, \\Delta t\\right)$$\n    If $\\|\\mathbf{u}_{ij}\\| = 0$, the droplets do not move relative to each other, so $d_{\\min} = \\|\\mathbf{r}_{ij}(0)\\|$, and the expression for $p_{ij}$ is zero. The minimum separation distance is then $d_{\\min} = \\|\\mathbf{r}_{ij}(t^\\star)\\|$. A collision is possible if and only if this minimum distance is less than or equal to the sum of the radii, $d_{\\min} \\le r_i + r_j$. This criterion must be satisfied to include $p_{ij}$ in the total count.\n\n3.  **Periodic Boundary Conditions (PBC) and Summation Method**:\n    The toroidal domain implies that a droplet exiting one face re-enters through the opposite face. The \"true\" distance between two droplets is the shortest distance, considering all possible periodic images. This is calculated using the minimum-image convention (MIC): for each Cartesian component $k$, the relative displacement $r_{ij,k}$ is wrapped into the interval $[-L/2, L/2)$.\n    $$r_{ij,k}^{\\text{MI}} = \\left(x_{j,k} - x_{i,k}\\right) - L \\cdot \\operatorname{round}\\left(\\frac{x_{j,k} - x_{i,k}}{L}\\right)$$\n    The \"naive\" method incorrectly uses the unwrapped displacement $\\mathbf{r}_{ij}(0) = \\mathbf{x}_j - \\mathbf{x}_i$ for the kinematic check and sums over all ordered pairs ($i \\ne j$), leading to errors from neglecting periodicity and from double-counting.\n    The \"corrected\" method correctly uses the minimum-image displacement $\\mathbf{r}_{ij}^{\\text{MI}}(0)$ for the kinematic check and sums over unique unordered pairs (conventionally, $ij$) to provide an unbiased estimate.\n\nWe now apply these principles to the provided test cases.\n\n**Case A: Boundary-spanning approach**\n- $L=0.01$ m, $V=10^{-6}$ m$^3$, $\\Delta t=0.002$ s.\n- Droplet 1: $\\mathbf{x}_1 = [0.0005, 0, 0]$, $\\mathbf{v}_1 = [-0.5, 0, 0]$, $r_1 = 2 \\times 10^{-4}$ m.\n- Droplet 2: $\\mathbf{x}_2 = [0.0095, 0, 0]$, $\\mathbf{v}_2 = [0.5, 0, 0]$, $r_2 = 2 \\times 10^{-4}$ m.\n- Pair properties: $r_1+r_2 = 4 \\times 10^{-4}$ m; $\\mathbf{u}_{12} = \\mathbf{v}_2-\\mathbf{v}_1 = [1, 0, 0]$ m/s; $|\\mathbf{u}_{12}|=1$ m/s.\n- $p_{12} = \\frac{\\pi (4 \\times 10^{-4})^2 (1) (0.002)}{10^{-6}} \\approx 0.0010053$.\n\n- **Naive Count**: We check ordered pairs $(1,2)$ and $(2,1)$ using unwrapped displacement. For $(1,2)$:\n    $\\mathbf{r}_{12}(0) = \\mathbf{x}_2 - \\mathbf{x}_1 = [0.009, 0, 0]$ m.\n    $t^\\star = \\operatorname{clamp}(-\\frac{[0.009,0,0]\\cdot[1,0,0]}{1^2}, 0, 0.002) = \\operatorname{clamp}(-0.009, 0, 0.002) = 0$.\n    $d_{\\min} = \\|\\mathbf{r}_{12}(0)\\| = 0.009$ m. Since $0.009 > 4 \\times 10^{-4}$, the collision is not feasible. The same holds for pair $(2,1)$.\n    Naive Count = $0.0$.\n\n- **Corrected Count**: We check unordered pair $(1,2)$ using MIC.\n    The unwrapped displacement in $x$ is $0.009$ m. The MIC displacement is $r_{12,x}^{\\text{MI}} = 0.009 - 0.01 \\cdot \\operatorname{round}(0.009/0.01) = -0.001$ m.\n    $\\mathbf{r}_{12}^{\\text{MI}}(0) = [-0.001, 0, 0]$ m.\n    $t^\\star = \\operatorname{clamp}(-\\frac{[-0.001,0,0]\\cdot[1,0,0]}{1^2}, 0, 0.002) = \\operatorname{clamp}(0.001, 0, 0.002) = 0.001$ s.\n    $d_{\\min} = \\|\\mathbf{r}_{12}^{\\text{MI}}(0) + \\mathbf{u}_{12}t^\\star\\| = \\|[-0.001,0,0] + [1,0,0](0.001)\\| = 0$ m. Since $0 \\le 4 \\times 10^{-4}$, the collision is feasible.\n    Corrected Count = $p_{12} \\approx 0.0010053$.\n\n**Case B: Interior approach**\n- $L=0.01$ m, $V=10^{-6}$ m$^3$, $\\Delta t=0.003$ s.\n- Droplet 1: $\\mathbf{x}_1 = [0.004, 0, 0]$, $\\mathbf{v}_1 = [0.5, 0, 0]$, $r_1 = 2 \\times 10^{-4}$ m.\n- Droplet 2: $\\mathbf{x}_2 = [0.006, 0, 0]$, $\\mathbf{v}_2 = [-0.5, 0, 0]$, $r_2 = 2 \\times 10^{-4}$ m.\n- Pair properties: $r_1+r_2 = 4 \\times 10^{-4}$ m; $\\mathbf{u}_{12} = [-1, 0, 0]$ m/s; $|\\mathbf{u}_{12}|=1$ m/s.\n- $p_{12} = \\frac{\\pi (4 \\times 10^{-4})^2 (1) (0.003)}{10^{-6}} \\approx 0.0015080$.\n\n- **Naive Count**: Check ordered pairs $(1,2)$ and $(2,1)$. For $(1,2)$:\n    $\\mathbf{r}_{12}(0) = [0.002, 0, 0]$ m. MIC would yield the same vector as $0.002  L/2$.\n    $t^\\star = \\operatorname{clamp}(-\\frac{[0.002,0,0]\\cdot[-1,0,0]}{(-1)^2}, 0, 0.003) = \\operatorname{clamp}(0.002, 0, 0.003) = 0.002$ s.\n    $d_{\\min} = \\|\\mathbf{r}_{12}(0) + \\mathbf{u}_{12}t^\\star\\| = \\|[0.002,0,0] + [-1,0,0](0.002)\\| = 0$ m. Feasible.\n    Contribution from $(1,2)$ is $p_{12}$.\n    For $(2,1)$: $\\mathbf{r}_{21}(0) = [-0.002, 0, 0]$, $\\mathbf{u}_{21}=[1, 0, 0]$. This also yields $d_{\\min}=0$. Feasible. Contribution is $p_{21}=p_{12}$.\n    Naive Count = $p_{12} + p_{21} = 2 \\cdot p_{12} \\approx 0.0030160$.\n\n- **Corrected Count**: Check unordered pair $(1,2)$.\n    The feasibility is identical to the naive check for $(1,2)$, so the collision is feasible.\n    Corrected Count = $p_{12} \\approx 0.0015080$.\n\n**Case C: Mixed three-droplet configuration**\n- $L=0.02$ m, $V=8 \\times 10^{-6}$ m$^3$, $\\Delta t=0.005$ s.\n- 3 droplets, meaning 3 unordered pairs: $(1,2), (1,3), (2,3)$.\n\n- **Pair (1,2)**: $r_1+r_2=4\\times 10^{-4}$ m. $\\mathbf{u}_{12} = [-0.4, 0, 0]$ m/s. $p_{12} \\approx 0.0001257$.\n  - Naive: $\\mathbf{r}_{12}(0) = [-0.0193, 0, 0]$. $d_{\\min} = 0.0193 > r_1+r_2$. Not feasible. Contribution: $0$.\n  - Corrected: MIC for $x$ component: $-0.0193 - 0.02 \\cdot \\operatorname{round}(-0.0193/0.02) = 0.0007$ m. $\\mathbf{r}_{12}^{\\text{MI}}(0) = [0.0007, 0, 0]$. $d_{\\min}=0$. Feasible. Contribution: $p_{12}$.\n\n- **Pair (1,3)**: $r_1+r_3=3\\times 10^{-4}$ m. $\\mathbf{u}_{13} = [-0.2, 0, 0]$ m/s. $p_{13} \\approx 0.0000353$.\n  - Naive  Corrected: $\\mathbf{r}_{13}(0) = [-0.0098, 0.009, 0]$. MIC does not change this vector as components are within $[-0.01, 0.01)$.\n  - $t^\\star=0$. $d_{\\min} = \\|\\mathbf{r}_{13}(0)\\| \\approx 0.0133 > r_1+r_3$. Not feasible. Contribution: $0$.\n\n- **Pair (2,3)**: $r_2+r_3=3\\times 10^{-4}$ m. $\\mathbf{u}_{23} = [0.2, 0, 0]$ m/s. $p_{23} \\approx 0.0000353$.\n  - Naive  Corrected: $\\mathbf{r}_{23}(0) = [0.0095, 0.009, 0]$. MIC does not change this vector.\n  - $t^\\star=0$. $d_{\\min} = \\|\\mathbf{r}_{23}(0)\\| \\approx 0.0131 > r_2+r_3$. Not feasible. Contribution: $0$.\n\n- **Total Naive Count**: Sum over all 6 ordered pairs. As shown, none are feasible without MIC.\n  Naive Count = $0.0$.\n\n- **Total Corrected Count**: Sum over 3 unordered pairs. Only pair $(1,2)$ is feasible with MIC.\n  Corrected Count = $p_{12} \\approx 0.0001257$.\n\n**Final Numerical Results:**\n- `naive_A`: $0.0$\n- `corrected_A`: $0.0010053096491487338$\n- `naive_B`: $0.0030159289474462015$\n- `corrected_B`: $0.0015079644737231007$\n- `naive_C`: $0.0$\n- `corrected_C`: $0.00012566370614359174`",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation for all test cases.\n    \"\"\"\n    \n    # Define test cases as per the problem statement\n    test_cases = [\n        # Case A\n        {\n            \"L\": 0.01, \"dt\": 0.002, \"droplets\": [\n                {\"x\": np.array([0.0005, 0.0, 0.0]), \"v\": np.array([-0.5, 0.0, 0.0]), \"r\": 2e-4},\n                {\"x\": np.array([0.0095, 0.0, 0.0]), \"v\": np.array([0.5, 0.0, 0.0]), \"r\": 2e-4}\n            ]\n        },\n        # Case B\n        {\n            \"L\": 0.01, \"dt\": 0.003, \"droplets\": [\n                {\"x\": np.array([0.004, 0.0, 0.0]), \"v\": np.array([0.5, 0.0, 0.0]), \"r\": 2e-4},\n                {\"x\": np.array([0.006, 0.0, 0.0]), \"v\": np.array([-0.5, 0.0, 0.0]), \"r\": 2e-4}\n            ]\n        },\n        # Case C\n        {\n            \"L\": 0.02, \"dt\": 0.005, \"droplets\": [\n                {\"x\": np.array([0.0198, 0.001, 0.0]), \"v\": np.array([0.2, 0.0, 0.0]), \"r\": 2e-4},\n                {\"x\": np.array([0.0005, 0.001, 0.0]), \"v\": np.array([-0.2, 0.0, 0.0]), \"r\": 2e-4},\n                {\"x\": np.array([0.010, 0.010, 0.0]), \"v\": np.array([0.0, 0.0, 0.0]), \"r\": 1e-4}\n            ]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        naive_count, corrected_count = compute_collision_counts(\n            case[\"L\"], case[\"dt\"], case[\"droplets\"]\n        )\n        all_results.extend([naive_count, corrected_count])\n        \n    # Format the final output as a Python list string\n    print(f\"[{','.join(f'{r:.17f}' for r in all_results)}]\")\n\ndef minimum_image_displacement(dr, L):\n    \"\"\"\n    Computes the displacement vector according to the minimum-image convention.\n    dr: The unwrapped displacement vector (x_j - x_i).\n    L: The side length of the cubic domain.\n    \"\"\"\n    return dr - L * np.round(dr / L)\n\ndef is_kinematically_feasible(r0, u, dt, r_sum):\n    \"\"\"\n    Checks if a collision is kinematically feasible within the time step.\n    r0: Initial relative position vector.\n    u: Relative velocity vector.\n    dt: Time step.\n    r_sum: Sum of the radii of the two droplets (r_i + r_j).\n    \"\"\"\n    u_norm_sq = np.dot(u, u)\n    \n    # Handle case of zero relative velocity\n    if u_norm_sq == 0.0:\n        d_min = np.linalg.norm(r0)\n    else:\n        # Time of closest approach (unconstrained)\n        t_unclamped = -np.dot(r0, u) / u_norm_sq\n        \n        # Clamp t to the interval [0, dt]\n        t_star = np.clip(t_unclamped, 0.0, dt)\n        \n        # Minimum separation distance within the interval\n        r_at_t_star = r0 + u * t_star\n        d_min = np.linalg.norm(r_at_t_star)\n\n    return d_min = r_sum\n\ndef compute_collision_counts(L, dt, droplets):\n    \"\"\"\n    Computes naive and corrected expected collision counts for a given case.\n    \"\"\"\n    V = L**3\n    num_droplets = len(droplets)\n    \n    naive_total_p = 0.0\n    corrected_total_p = 0.0\n    \n    # --- Naive Calculation (ordered pairs i != j, no MIC) ---\n    for i in range(num_droplets):\n        for j in range(num_droplets):\n            if i == j:\n                continue\n            \n            p_i = droplets[i]\n            p_j = droplets[j]\n            \n            # Unwrapped relative position and velocity\n            r_ij_0_unwrapped = p_j[\"x\"] - p_i[\"x\"]\n            u_ij = p_j[\"v\"] - p_i[\"v\"]\n            r_sum = p_i[\"r\"] + p_j[\"r\"]\n            \n            if is_kinematically_feasible(r_ij_0_unwrapped, u_ij, dt, r_sum):\n                u_norm = np.linalg.norm(u_ij)\n                p = (np.pi * r_sum**2 * u_norm * dt) / V\n                naive_total_p += min(1.0, p)\n                \n    # --- Corrected Calculation (unordered pairs i  j, with MIC) ---\n    for i in range(num_droplets):\n        for j in range(i + 1, num_droplets):\n            p_i = droplets[i]\n            p_j = droplets[j]\n            \n            # Unwrapped relative position (for MIC)\n            r_ij_0_unwrapped = p_j[\"x\"] - p_i[\"x\"]\n            # Corrected relative position using MIC\n            r_ij_0_mic = minimum_image_displacement(r_ij_0_unwrapped, L)\n            \n            u_ij = p_j[\"v\"] - p_i[\"v\"]\n            r_sum = p_i[\"r\"] + p_j[\"r\"]\n\n            if is_kinematically_feasible(r_ij_0_mic, u_ij, dt, r_sum):\n                u_norm = np.linalg.norm(u_ij)\n                p = (np.pi * r_sum**2 * u_norm * dt) / V\n                corrected_total_p += min(1.0, p)\n\n    return naive_total_p, corrected_total_p\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}