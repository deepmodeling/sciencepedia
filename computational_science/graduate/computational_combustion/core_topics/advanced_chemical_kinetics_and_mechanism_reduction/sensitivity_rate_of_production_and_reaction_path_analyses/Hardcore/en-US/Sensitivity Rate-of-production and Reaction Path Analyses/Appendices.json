{
    "hands_on_practices": [
        {
            "introduction": "Before analyzing complex reaction networks, one must master the foundational skill of constructing the rate-of-production (ROP) term for any given species. This exercise provides essential practice in applying the law of mass action and stoichiometric principles to build the ROP expression from the ground up. By correctly identifying the individual formation and consumption terms for a target species within a simple mechanism, you will solidify your understanding of how elementary reaction rates combine to dictate overall species dynamics .",
            "id": "4060890",
            "problem": "Consider an isothermal, isobaric, spatially uniform ideal-gas mixture containing the four species $H$, $O_2$, $HO_2$, and $H_2O_2$. The elementary chemical mechanism is limited to the following two reversible reactions:\n$$\nR_1:\\quad H + O_2 \\rightleftharpoons HO_2, \\qquad R_2:\\quad HO_2 + HO_2 \\rightleftharpoons H_2O_2 + O_2.\n$$\nAssume elementary mass-action kinetics. Denote the forward and reverse rate coefficients by $k_{1f}$, $k_{1r}$ for $R_1$ and $k_{2f}$, $k_{2r}$ for $R_2$, respectively. Let $[X]$ denote the molar concentration of species $X$. Using the standard species rate-of-production definition based on stoichiometry and mass-action kinetics, derive the explicit expression for the Rate of Production (ROP) of $HO_2$, denoted $\\mathrm{ROP}_{HO_2}$, as a function of $k_{1f}$, $k_{1r}$, $k_{2f}$, $k_{2r}$, $[H]$, $[O_2]$, $[HO_2]$, and $[H_2O_2]$. Clearly identify which terms correspond to formation and which to consumption of $HO_2$, and combine them into a single simplified expression for $\\mathrm{ROP}_{HO_2}$.\n\nExpress your final expression symbolically in terms of molar concentrations (e.g., in $\\mathrm{mol}\\,\\mathrm{cm}^{-3}$) and time (e.g., in $\\mathrm{s}$), so that $\\mathrm{ROP}_{HO_2}$ has the dimensions of concentration per time. Do not substitute numerical values and do not perform any unit conversions. Your final answer must be a single closed-form analytic expression (no inequalities or equations to solve). No rounding is required.",
            "solution": "The problem asks for the derivation of the rate of production (ROP) for the species $HO_2$ in a chemical system defined by two reversible elementary reactions. The ROP of a given species is the net rate at which its molar concentration changes due to all chemical reactions in the system. For a species $i$ participating in a set of $N_r$ elementary reactions, its ROP, which we can also denote as its net rate of formation $\\omega_i = \\frac{d[X_i]}{dt}$, is given by the sum of its rates of production in each reaction:\n$$\n\\mathrm{ROP}_{i} = \\sum_{j=1}^{N_r} \\omega_{ij}\n$$\nwhere $\\omega_{ij}$ is the rate of production of species $i$ in reaction $j$. This term can be expressed as:\n$$\n\\omega_{ij} = \\nu_{ij} q_j\n$$\nHere, $q_j$ is the net rate of progress of reaction $j$, and $\\nu_{ij}$ is the net stoichiometric coefficient of species $i$ in reaction $j$. Following the convention in the main text, we define $\\nu_{ij} = \\nu'_{ij} - \\nu''_{ij}$, where $\\nu'_{ij}$ is the product coefficient and $\\nu''_{ij}$ is the reactant coefficient.\n\nFor an elementary reversible reaction, the net rate of progress $q_j$ is the difference between the forward rate and the reverse rate. According to the law of mass action for elementary reactions, these rates are proportional to the product of the concentrations of the reactants, each raised to the power of its stoichiometric coefficient.\nThe total ROP for species $i$ is thus:\n$$\n\\mathrm{ROP}_{i} = \\sum_{j=1}^{N_r} \\nu_{ij} (q_{jf} - q_{jr})\n$$\nwhere $q_{jf}$ and $q_{jr}$ are the forward and reverse rates of progress for reaction $j$, respectively. We apply this formalism to the species $HO_2$ for the two given reactions.\n\n**Reaction 1: $R_1: H + O_2 \\rightleftharpoons HO_2$**\n\nFirst, we analyze the contribution of reaction $R_1$ to the ROP of $HO_2$. The forward reaction is $H + O_2 \\rightarrow HO_2$, and the reverse reaction is $HO_2 \\rightarrow H + O_2$.\n\nThe stoichiometric coefficients for $HO_2$ in $R_1$ are $\\nu''_{HO_2, 1} = 0$ (reactant) and $\\nu'_{HO_2, 1} = 1$ (product). The net stoichiometric coefficient is $\\nu_{HO_2, 1} = \\nu'_{HO_2, 1} - \\nu''_{HO_2, 1} = 1 - 0 = 1$.\n\nThe rates of progress for the forward and reverse steps of $R_1$ are given by mass-action kinetics:\n- Forward rate of progress: $q_{1f} = k_{1f} [H] [O_2]$\n- Reverse rate of progress: $q_{1r} = k_{1r} [HO_2]$\n\nThe net rate of progress for $R_1$ is $q_1 = q_{1f} - q_{1r} = k_{1f} [H] [O_2] - k_{1r} [HO_2]$.\n\nThe contribution of $R_1$ to the ROP of $HO_2$ is:\n$$\n(\\mathrm{ROP}_{HO_2})_1 = \\nu_{HO_2, 1} \\times q_1 = (1) \\times (k_{1f} [H] [O_2] - k_{1r} [HO_2]) = k_{1f} [H] [O_2] - k_{1r} [HO_2]\n$$\n\n**Reaction 2: $R_2: HO_2 + HO_2 \\rightleftharpoons H_2O_2 + O_2$**\n\nNext, we analyze the contribution of reaction $R_2$. The forward reaction is $HO_2 + HO_2 \\rightarrow H_2O_2 + O_2$, and the reverse reaction is $H_2O_2 + O_2 \\rightarrow HO_2 + HO_2$.\n\nThe stoichiometric coefficients for $HO_2$ in $R_2$ are $\\nu''_{HO_2, 2} = 2$ (reactant) and $\\nu'_{HO_2, 2} = 0$ (product). The net stoichiometric coefficient is $\\nu_{HO_2, 2} = \\nu'_{HO_2, 2} - \\nu''_{HO_2, 2} = 0 - 2 = -2$.\n\nThe rates of progress for the forward and reverse steps of $R_2$ are:\n- Forward rate of progress: $q_{2f} = k_{2f} [HO_2] [HO_2] = k_{2f} [HO_2]^2$\n- Reverse rate of progress: $q_{2r} = k_{2r} [H_2O_2] [O_2]$\n\nThe net rate of progress for $R_2$ is $q_2 = q_{2f} - q_{2r} = k_{2f} [HO_2]^2 - k_{2r} [H_2O_2] [O_2]$.\n\nThe contribution of $R_2$ to the ROP of $HO_2$ is:\n$$\n(\\mathrm{ROP}_{HO_2})_2 = \\nu_{HO_2, 2} \\times q_2 = (-2) \\times (k_{2f} [HO_2]^2 - k_{2r} [H_2O_2] [O_2]) = -2 k_{2f} [HO_2]^2 + 2 k_{2r} [H_2O_2] [O_2]\n$$\nThe factor of $2$ arises because two molecules of $HO_2$ are consumed in each forward step of reaction $R_2$, and two are produced in each reverse step.\n\n**Total Rate of Production of $HO_2$**\n\nThe total ROP for $HO_2$ is the sum of the contributions from all reactions:\n$$\n\\mathrm{ROP}_{HO_2} = (\\mathrm{ROP}_{HO_2})_1 + (\\mathrm{ROP}_{HO_2})_2\n$$\n$$\n\\mathrm{ROP}_{HO_2} = (k_{1f} [H] [O_2] - k_{1r} [HO_2]) + (-2 k_{2f} [HO_2]^2 + 2 k_{2r} [H_2O_2] [O_2])\n$$\nCombining these terms into a single expression yields:\n$$\n\\mathrm{ROP}_{HO_2} = k_{1f} [H] [O_2] - k_{1r} [HO_2] - 2 k_{2f} [HO_2]^2 + 2 k_{2r} [H_2O_2] [O_2]\n$$\n\nAs requested, we identify the terms corresponding to formation (positive sign) and consumption (negative sign) of $HO_2$:\n- **Formation of $HO_2$**:\n  - From $R_1$ forward ($H + O_2 \\rightarrow HO_2$): $+ k_{1f} [H] [O_2]$\n  - From $R_2$ reverse ($H_2O_2 + O_2 \\rightarrow 2HO_2$): $+ 2 k_{2r} [H_2O_2] [O_2]$\n- **Consumption of $HO_2$**:\n  - From $R_1$ reverse ($HO_2 \\rightarrow H + O_2$): $- k_{1r} [HO_2]$\n  - From $R_2$ forward ($2HO_2 \\rightarrow H_2O_2 + O_2$): $- 2 k_{2f} [HO_2]^2$\n\nThe final simplified expression is the linear combination of these four terms.",
            "answer": "$$\n\\boxed{k_{1f} [H] [O_2] - k_{1r} [HO_2] - 2 k_{2f} [HO_2]^2 + 2 k_{2r} [H_2O_2] [O_2]}\n$$"
        },
        {
            "introduction": "Computational models of reacting flows are only as reliable as their adherence to fundamental physical laws. This practice demonstrates that the rate-of-production (ROP) terms for all species in a system are not independent but are intrinsically linked by the law of mass conservation. You will derive and apply a powerful diagnostic tool that leverages this principle to check for inconsistencies in a reaction mechanism, a crucial step in model development and debugging .",
            "id": "4060806",
            "problem": "Consider a homogeneous, isothermal reacting mixture at constant volume described by molar species balances. Let $i \\in \\{1,\\dots,N\\}$ index chemical species and $r \\in \\{1,\\dots,R\\}$ index elementary reactions. Denote the molar concentration of species $i$ as $c_i$, its molecular weight as $W_i$ (in $\\mathrm{g/mol}$), the stoichiometric coefficient of species $i$ in reaction $r$ as $\\nu_{i r}$ (positive for products and negative for reactants), and the scalar reaction rate for reaction $r$ as $\\mathcal{R}_r$ (in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$). Define the rate-of-production (ROP) of species $i$ by $ \\mathrm{ROP}_i = \\sum_{r=1}^{R} \\nu_{i r}\\,\\mathcal{R}_r$, so that the species molar balance reads $ \\frac{d c_i}{d t} = \\mathrm{ROP}_i$. A mechanism respects mass conservation if and only if each reaction column is individually mass-balanced, i.e., $ \\sum_{i=1}^{N} W_i \\,\\nu_{i r} = 0$ for all $r$.\n\n(a) Starting strictly from the species molar balance and the stated mass-conservation condition, construct a scalar diagnostic residual for mass conservation in terms of the molecular-weight vector, the stoichiometric coefficients, and the reaction rates. Your expression must be written as a single closed-form analytic scalar in terms of $W_i$, $\\nu_{i r}$, and $\\mathcal{R}_r$ only. Then, explain how this scalar residual connects to per-reaction mass defects and describe a principled strategy to localize violations arising from numerical rounding, inconsistent molecular weights, or erroneous stoichiometry without invoking any pre-given shortcut formulas.\n\n(b) To quantify the severity of any violation in a dimensionless manner, define a normalization based on the sum of absolute species mass-production rates, $ \\sum_{i=1}^{N} | W_i \\,\\mathrm{ROP}_i |$, and form a dimensionless normalized residual by dividing the absolute value of your scalar residual from part (a) by this normalization. For the single-reaction mechanism\n$$ 2\\,\\mathrm{H}_2 + \\mathrm{O}_2 \\longrightarrow 2\\,\\mathrm{H}_2\\mathrm{O}, $$\nuse the following data at a particular state:\n- $W_{\\mathrm{H}_2} = 2.01588$ (in $\\mathrm{g/mol}$), $W_{\\mathrm{O}_2} = 31.9988$ (in $\\mathrm{g/mol}$), $W_{\\mathrm{H}_2\\mathrm{O}} = 18.0000$ (in $\\mathrm{g/mol}$),\n- $\\nu_{\\mathrm{H}_2,1} = -2$, $\\nu_{\\mathrm{O}_2,1} = -1$, $\\nu_{\\mathrm{H}_2\\mathrm{O},1} = +2$,\n- $\\mathcal{R}_1 = 0.75$ (in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$).\n\nCompute the dimensionless normalized residual defined above. Round your answer to four significant figures. Express the final value as a pure decimal number with no units.",
            "solution": "**(a) Derivation of the Mass Conservation Residual and Localization Strategy**\n\nThe analysis begins from the fundamental principle of mass conservation in a closed, homogeneous system at constant volume. The total mass density, $\\rho$, is the sum of the partial mass densities of all species, $\\rho_i$. The partial mass density of species $i$ is the product of its molar concentration, $c_i$, and its molecular weight, $W_i$. Thus, the total mass density is:\n$$ \\rho = \\sum_{i=1}^{N} \\rho_i = \\sum_{i=1}^{N} c_i W_i $$\nFor total mass to be conserved, its rate of change with respect to time, $t$, must be zero.\n$$ \\frac{d\\rho}{dt} = 0 $$\nWe can construct a diagnostic residual, $\\mathcal{D}$, which represents the computed rate of change of total mass density. If the mechanism and associated data are perfectly consistent with mass conservation, this residual will be zero. Any non-zero value indicates a violation. We derive this residual by differentiating the expression for $\\rho$ with respect to time. Since the molecular weights $W_i$ are constant, we have:\n$$ \\frac{d\\rho}{dt} = \\frac{d}{dt} \\left( \\sum_{i=1}^{N} c_i W_i \\right) = \\sum_{i=1}^{N} W_i \\frac{dc_i}{dt} $$\nThe problem provides the species molar balance equation, which equates the rate of change of concentration to the rate-of-production ($\\mathrm{ROP}$) of the species:\n$$ \\frac{dc_i}{dt} = \\mathrm{ROP}_i = \\sum_{r=1}^{R} \\nu_{i r}\\,\\mathcal{R}_r $$\nSubstituting this expression into our equation for $\\frac{d\\rho}{dt}$ yields:\n$$ \\frac{d\\rho}{dt} = \\sum_{i=1}^{N} W_i \\left( \\sum_{r=1}^{R} \\nu_{i r}\\,\\mathcal{R}_r \\right) $$\nThis expression represents the total rate of mass generation in the system. To better understand its structure, we can interchange the order of the summations, as the sums are finite:\n$$ \\frac{d\\rho}{dt} = \\sum_{r=1}^{R} \\sum_{i=1}^{N} W_i \\nu_{i r}\\,\\mathcal{R}_r = \\sum_{r=1}^{R} \\left( \\sum_{i=1}^{N} W_i \\nu_{i r} \\right) \\mathcal{R}_r $$\nThe problem states that a mechanism respects mass conservation if and only if $\\sum_{i=1}^{N} W_i \\,\\nu_{i r} = 0$ for each individual reaction $r$. The term inside the parenthesis, $\\delta_r \\equiv \\sum_{i=1}^{N} W_i \\nu_{i r}$, is the *mass defect* of reaction $r$. It represents the net mass created or destroyed by one mole of reaction $r$ proceeding. If $\\delta_r = 0$ for all $r \\in \\{1,\\dots,R\\}$, then $\\frac{d\\rho}{dt} = \\sum_{r=1}^{R} (0) \\mathcal{R}_r = 0$, and total mass is conserved.\n\nTherefore, the scalar diagnostic residual for mass conservation, expressed as a single closed-form analytic scalar in terms of the given quantities, is:\n$$ \\mathcal{D} = \\sum_{r=1}^{R} \\left( \\sum_{i=1}^{N} W_i \\nu_{i r} \\right) \\mathcal{R}_r $$\nThis residual, $\\mathcal{D}$, is precisely the rate of change of the total mass density, $\\frac{d\\rho}{dt}$.\n\nThis expression directly connects the total mass conservation violation, $\\mathcal{D}$, to the per-reaction mass defects, $\\delta_r$. The total residual is a weighted sum of the individual reaction mass defects, where the weights are the corresponding reaction rates, $\\mathcal{R}_r$.\n\nA principled strategy to localize violations, without invoking any pre-given formulas, arises directly from this structure. Instead of computing only the total residual $\\mathcal{D}$, one must perform the following steps:\n1.  For each elementary reaction $r$ in the mechanism (from $r=1$ to $R$), compute its individual mass defect:\n    $$ \\delta_r = \\sum_{i=1}^{N} W_i \\nu_{i r} $$\n2.  Compare each $\\delta_r$ to zero, within a small numerical tolerance.\n3.  Any reaction $r$ for which $\\delta_r \\neq 0$ is a source of mass imbalance. This localizes the problem to a specific reaction.\n4.  For each violating reaction, inspect the set of species participating in it and their corresponding stoichiometric coefficients, $\\nu_{ir}$, and molecular weights, $W_i$. The error must lie within this small subset of data, which can be due to an erroneous stoichiometric coefficient (e.g., a typo in the mechanism file), an inconsistent molecular weight assignment for a species, or numerical rounding errors if the molecular weights are not specified with sufficient precision and consistency.\n\n**(b) Computation of the Dimensionless Normalized Residual**\n\nThe problem defines a dimensionless normalized residual, $\\mathcal{D}_{norm}$, as:\n$$ \\mathcal{D}_{norm} = \\frac{|\\mathcal{D}|}{\\sum_{i=1}^{N} | W_i \\,\\mathrm{ROP}_i |} $$\nFor the single-reaction mechanism ($R=1$) provided, the scalar residual is $\\mathcal{D} = (\\sum_{i=1}^{N} W_i \\nu_{i,1}) \\mathcal{R}_1$, and the rate-of-production for species $i$ is $\\mathrm{ROP}_i = \\nu_{i,1} \\mathcal{R}_1$.\n\nSubstituting these into the definition of $\\mathcal{D}_{norm}$:\n$$ \\mathcal{D}_{norm} = \\frac{\\left| \\left(\\sum_{i=1}^{N} W_i \\nu_{i,1}\\right) \\mathcal{R}_1 \\right|}{\\sum_{i=1}^{N} | W_i \\nu_{i,1} \\mathcal{R}_1 |} = \\frac{|\\mathcal{R}_1| \\left| \\sum_{i=1}^{N} W_i \\nu_{i,1} \\right|}{|\\mathcal{R}_1| \\sum_{i=1}^{N} | W_i \\nu_{i,1} |} $$\nSince the reaction rate $\\mathcal{R}_1 = 0.75$ is non-zero, it cancels out, yielding a simplified expression that depends only on the stoichiometry and molecular weights:\n$$ \\mathcal{D}_{norm} = \\frac{\\left| \\sum_{i=1}^{N} W_i \\nu_{i,1} \\right|}{\\sum_{i=1}^{N} | W_i \\nu_{i,1} |} $$\nThe species are $\\mathrm{H}_2$, $\\mathrm{O}_2$, and $\\mathrm{H}_2\\mathrm{O}$. We use the provided data:\n- $W_{\\mathrm{H}_2} = 2.01588$\n- $W_{\\mathrm{O}_2} = 31.9988$\n- $W_{\\mathrm{H}_2\\mathrm{O}} = 18.0000$\n- $\\nu_{\\mathrm{H}_2,1} = -2$\n- $\\nu_{\\mathrm{O}_2,1} = -1$\n- $\\nu_{\\mathrm{H}_2\\mathrm{O},1} = +2$\n\nFirst, we compute the numerator, which is the absolute value of the mass defect of the reaction, $|\\delta_1|$:\n$$ \\delta_1 = \\sum_{i=1}^{N} W_i \\nu_{i,1} = W_{\\mathrm{H}_2}\\nu_{\\mathrm{H}_2,1} + W_{\\mathrm{O}_2}\\nu_{\\mathrm{O}_2,1} + W_{\\mathrm{H}_2\\mathrm{O}}\\nu_{\\mathrm{H}_2\\mathrm{O},1} $$\n$$ \\delta_1 = (2.01588)(-2) + (31.9988)(-1) + (18.0000)(+2) $$\n$$ \\delta_1 = -4.03176 - 31.9988 + 36.0000 = -0.03056 $$\nThe numerator is $|\\delta_1| = |-0.03056| = 0.03056$.\n\nNext, we compute the denominator, which is the sum of the absolute values of the mass contributions of each species:\n$$ \\sum_{i=1}^{N} | W_i \\nu_{i,1} | = |W_{\\mathrm{H}_2}\\nu_{\\mathrm{H}_2,1}| + |W_{\\mathrm{O}_2}\\nu_{\\mathrm{O}_2,1}| + |W_{\\mathrm{H}_2\\mathrm{O}}\\nu_{\\mathrm{H}_2\\mathrm{O},1}| $$\n$$ \\sum_{i=1}^{N} | W_i \\nu_{i,1} | = |(2.01588)(-2)| + |(31.9988)(-1)| + |(18.0000)(+2)| $$\n$$ \\sum_{i=1}^{N} | W_i \\nu_{i,1} | = |-4.03176| + |-31.9988| + |36.0000| $$\n$$ \\sum_{i=1}^{N} | W_i \\nu_{i,1} | = 4.03176 + 31.9988 + 36.0000 = 72.03056 $$\n\nFinally, we compute the ratio to find the dimensionless normalized residual:\n$$ \\mathcal{D}_{norm} = \\frac{0.03056}{72.03056} \\approx 0.0004242646... $$\nRounding this value to four significant figures gives $0.0004243$.",
            "answer": "$$\\boxed{0.0004243}$$"
        },
        {
            "introduction": "A key goal of ROP analysis is to identify the dominant reaction pathways that control the formation and consumption of important species. This advanced practice moves beyond a simple deterministic ranking to explore how uncertainties in reaction rate parameters can affect our conclusions . By implementing a Monte Carlo simulation, you will learn to assess the robustness of a reaction path analysis, a critical skill for building truly predictive chemical models in the face of incomplete kinetic knowledge.",
            "id": "4060858",
            "problem": "You are given a single thermochemical state for a homogeneous, constant-pressure reactive system governed by the law of mass action. For a species indexed by $i$, the Rate of Production (ROP) is defined by the fundamental decomposition into per-reaction contributions as \n$$\n\\mathrm{ROP}_i \\;=\\; \\sum_{j=1}^{N_r} \\nu_{i,j}\\,\\omega_j,\n$$\nwhere $N_r$ is the number of reactions, $\\nu_{i,j}$ is the net stoichiometric coefficient of species $i$ in reaction $j$ (positive for formation and negative for consumption), and $\\omega_j$ is the net rate of reaction $j$. The per-reaction contribution to the ROP of species $i$ is \n$$\n\\mathrm{ROP}_{i,j} \\;=\\; \\nu_{i,j}\\,\\omega_j,\n$$\nand a reaction path analysis ranks the reactions contributing most strongly to the change in the concentration of species $i$ via sorting of the magnitudes $|\\mathrm{ROP}_{i,j}|$.\n\nAssume a local parametric uncertainty model for the kinetic rate parameters such that, for each reaction indexed by $j$, the net reaction rate $\\omega_j$ is perturbed multiplicatively as \n$$\n\\omega_j \\;\\mapsto\\; u_j\\,\\omega_j,\n$$\nwith $u_j$ modeled as lognormal and independent across reactions: \n$$\n\\ln(u_j) \\sim \\mathcal{N}\\!\\left(-\\tfrac{1}{2}\\sigma_j^2,\\;\\sigma_j^2\\right).\n$$\nThis choice ensures $\\mathbb{E}[u_j] = 1$ while allowing a controlled spread via the standard deviation $\\sigma_j$ in log-space. Under this uncertainty, the per-reaction ROP contribution perturbs as \n$$\n\\mathrm{ROP}_{i,j} \\;\\mapsto\\; u_j\\,\\mathrm{ROP}_{i,j}.\n$$\n\nYour tasks are:\n- Implement an algorithm that identifies the dominant $k$ reactions contributing to $\\mathrm{ROP}_i$ by sorting the absolute values $|\\mathrm{ROP}_{i,j}|$ in descending order and selecting the top $k$ reactions. Resolve ties by choosing the reaction with the smaller zero-based index first.\n- Assess robustness of this dominance under parameter uncertainty by computing, via Monte Carlo sampling, the probability for each reaction to appear among the top $k$ under the perturbed contributions $|u_j\\,\\mathrm{ROP}_{i,j}|$. Define the robust dominant set as the $k$ reactions with the largest probabilities, resolving ties by smaller zero-based index.\n\nUse the following test suite. Each case defines $N_r$, the vector of stoichiometric coefficients $\\nu_{i,j}$, the vector of base reaction rates $\\omega_j$, the vector of log-space standard deviations $\\sigma_j$, and the integer $k$. All arrays are dimensionless in this problem, and indices are zero-based integers.\n\n- Case A (general, distinct magnitudes):\n  - $N_r = 5$\n  - $\\nu_{i,j} = (\\,1.0,\\,-2.0,\\,1.0,\\,0.0,\\,1.0\\,)$\n  - $\\omega_j = (\\,2.0,\\,0.5,\\,1.5,\\,0.0,\\,-0.2\\,)$\n  - $\\sigma_j = (\\,0.1,\\,0.4,\\,0.2,\\,0.3,\\,0.5\\,)$\n  - $k = 2$\n- Case B (boundary, ties in $|\\mathrm{ROP}_{i,j}|$):\n  - $N_r = 4$\n  - $\\nu_{i,j} = (\\,1.0,\\,1.0,\\,-1.0,\\,1.0\\,)$\n  - $\\omega_j = (\\,1.0,\\,-1.0,\\,1.0,\\,-1.0\\,)$\n  - $\\sigma_j = (\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,)$\n  - $k = 3$\n- Case C (edge, one highly uncertain dominant reaction):\n  - $N_r = 6$\n  - $\\nu_{i,j} = (\\,1.0,\\,1.0,\\,1.0,\\,-1.0,\\,2.0,\\,-3.0\\,)$\n  - $\\omega_j = (\\,0.8,\\,0.7,\\,0.6,\\,0.3,\\,0.2,\\,-0.5\\,)$\n  - $\\sigma_j = (\\,0.15,\\,0.10,\\,0.10,\\,0.20,\\,0.10,\\,0.60\\,)$\n  - $k = 3$\n\nMonte Carlo parameters:\n- Number of samples $N = 10000$ drawn independently for each case.\n- Random seed fixed at $42$ for reproducibility.\n\nFinal output format:\n- Your program should produce a single line containing the results as a comma-separated list enclosed in square brackets.\n- For each test case, output a two-item list: \n  - The first item is the list of the $k$ dominant reaction indices based on sorting $|\\mathrm{ROP}_{i,j}|$ at the base state.\n  - The second item is the list of the $k$ robust dominant reaction indices based on sorting by top-$k$ appearance probabilities computed via Monte Carlo under the uncertainty model.\n- Indices must be zero-based integers.\n- The complete output should look like \n$$\n[\\,[\\text{base\\_top\\_k},\\;\\text{robust\\_top\\_k}],\\,[\\dots],\\,[\\dots]\\,]\n$$\nwhere each placeholder is a list of integers.\n\nYour program must implement the above and produce the single-line output exactly in the specified format.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of chemical kinetics and uncertainty quantification, is well-posed with clear definitions and tie-breaking rules, and is objective and computationally feasible.\n\nThe solution requires implementing two distinct analyses for each test case: a deterministic reaction path analysis and a probabilistic robustness analysis via Monte Carlo simulation. The goal is to compare the set of dominant chemical reactions identified by each method.\n\n### Part 1: Deterministic Dominant Reaction Analysis\n\nThis analysis identifies the most influential reactions based on their contribution to the rate of production (ROP) of a species $i$ at a single, nominal thermochemical state.\n\nThe contribution of reaction $j$ to the ROP of species $i$ is given by\n$$\n\\mathrm{ROP}_{i,j} \\;=\\; \\nu_{i,j}\\,\\omega_j\n$$\nwhere $\\nu_{i,j}$ is the stoichiometric coefficient and $\\omega_j$ is the net reaction rate. The magnitude of this contribution, $|\\mathrm{ROP}_{i,j}|$, quantifies the impact of reaction $j$ on the concentration of species $i$, irrespective of whether it is a production or consumption pathway.\n\nThe algorithm to find the dominant set of $k$ reactions is as follows:\n1.  For each reaction $j \\in \\{0, 1, \\dots, N_r-1\\}$, where $N_r$ is the total number of reactions, compute the base ROP contribution, $\\mathrm{ROP}_{i,j} = \\nu_{i,j}\\omega_j$, using the provided vectors $\\boldsymbol{\\nu}_i$ and $\\boldsymbol{\\omega}$.\n2.  Calculate the absolute magnitude of each contribution, $|\\mathrm{ROP}_{i,j}|$.\n3.  To facilitate sorting, create a list of tuples, where each tuple contains the magnitude and its corresponding reaction index: $(|\\mathrm{ROP}_{i,j}|, j)$.\n4.  Sort this list of tuples. The primary sorting criterion is the magnitude, in descending order. The secondary sorting criterion, used to resolve ties in magnitude, is the reaction index $j$, in ascending order. This adheres to the specified tie-breaking rule.\n5.  The deterministic dominant set is formed by the indices from the first $k$ tuples in the sorted list.\n\n### Part 2: Probabilistic Robustness Analysis\n\nThis analysis assesses the stability of the reaction dominance hierarchy under uncertainty in the kinetic parameters. The uncertainty is modeled by perturbing each reaction rate $\\omega_j$ with an independent, lognormally distributed multiplicative factor $u_j$. The distribution for $\\ln(u_j)$ is given as a normal distribution $\\mathcal{N}(-\\frac{1}{2}\\sigma_j^2, \\sigma_j^2)$, where $\\sigma_j$ is the specified log-space standard deviation for reaction $j$. This formulation ensures that the expected value of the multiplier is $\\mathbb{E}[u_j]=1$.\n\nThe perturbed ROP contribution is $\\mathrm{ROP}_{i,j}^{\\text{pert}} = u_j \\mathrm{ROP}_{i,j}$. The analysis is performed using a Monte Carlo simulation.\n\nThe algorithm is as follows:\n1.  Initialize a frequency counter array, `counts`, of size $N_r$ to all zeros. This array will store the number of times each reaction appears in the top-$k$ set across all Monte Carlo samples.\n2.  Fix the random number generator's seed to $42$ to ensure reproducibility.\n3.  Execute a loop for a total of $N=10000$ samples. In each iteration:\n    a.  For each reaction $j=0, \\dots, N_r-1$, generate a random multiplier $u_j$. This is achieved by first drawing a sample $z_j$ from the standard normal distribution $\\mathcal{N}(0, 1)$, and then computing $u_j = \\exp(-\\frac{1}{2}\\sigma_j^2 + \\sigma_j z_j)$.\n    b.  Calculate the magnitudes of the perturbed ROP contributions for this sample: $|\\mathrm{ROP}_{i,j}^{\\text{pert}}| = |u_j \\mathrm{ROP}_{i,j}| = u_j |\\mathrm{ROP}_{i,j}|$, since $u_j$ is strictly positive.\n    c.  Identify the top $k$ dominant reactions for this perturbed sample by sorting the pairs $(|\\mathrm{ROP}_{i,j}^{\\text{pert}}|, j)$ using the same descending-magnitude, ascending-index rule as in the deterministic case.\n    d.  For each of the $k$ reaction indices identified in the previous step, increment its corresponding counter in the `counts` array.\n4.  After the loop completes, compute the probability $P_j$ for each reaction $j$ to appear in the top-$k$ set by dividing its total count by the number of samples $N$: $P_j = \\text{counts}_j / N$.\n5.  To identify the robust dominant set, sort the reactions based on these probabilities. Create a list of tuples $(P_j, j)$ and sort it with the primary key being the probability $P_j$ in descending order, and the secondary key being the index $j$ in ascending order.\n6.  The robust dominant set consists of the indices from the first $k$ tuples in this sorted probability list.\n\nBy comparing the deterministic and robust dominant sets, one can evaluate the impact of kinetic uncertainties on the conclusions drawn from a standard reaction path analysis. A high-uncertainty reaction that is dominant in the deterministic analysis may have a low probability of being dominant, potentially being replaced in the robust set by a less dominant but more certain reaction.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reaction path robustness problem for the given test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (general, distinct magnitudes)\n        {\n            \"Nr\": 5,\n            \"nu_i\": (1.0, -2.0, 1.0, 0.0, 1.0),\n            \"omega\": (2.0, 0.5, 1.5, 0.0, -0.2),\n            \"sigma\": (0.1, 0.4, 0.2, 0.3, 0.5),\n            \"k\": 2,\n        },\n        # Case B (boundary, ties in |ROP_ij|)\n        {\n            \"Nr\": 4,\n            \"nu_i\": (1.0, 1.0, -1.0, 1.0),\n            \"omega\": (1.0, -1.0, 1.0, -1.0),\n            \"sigma\": (0.0, 0.0, 0.0, 0.0),\n            \"k\": 3,\n        },\n        # Case C (edge, one highly uncertain dominant reaction)\n        {\n            \"Nr\": 6,\n            \"nu_i\": (1.0, 1.0, 1.0, -1.0, 2.0, -3.0),\n            \"omega\": (0.8, 0.7, 0.6, 0.3, 0.2, -0.5),\n            \"sigma\": (0.15, 0.10, 0.10, 0.20, 0.10, 0.60),\n            \"k\": 3,\n        },\n    ]\n\n    mc_samples = 10000\n    seed = 42\n    results = []\n\n    for case in test_cases:\n        Nr = case[\"Nr\"]\n        nu_i = np.array(case[\"nu_i\"])\n        omega = np.array(case[\"omega\"])\n        sigma = np.array(case[\"sigma\"])\n        k = case[\"k\"]\n        \n        indices = np.arange(Nr)\n\n        # --- Task 1: Deterministic Dominant Reaction Analysis ---\n        rop_ij = nu_i * omega\n        abs_rop_ij = np.abs(rop_ij)\n\n        # Sort by magnitude (desc) and then index (asc) for tie-breaking\n        base_sorted_pairs = sorted(zip(abs_rop_ij, indices), key=lambda p: (-p[0], p[1]))\n        base_top_k = [pair[1] for pair in base_sorted_pairs[:k]]\n\n        # --- Task 2: Probabilistic Robustness Analysis ---\n        np.random.seed(seed)\n        top_k_counts = np.zeros(Nr, dtype=int)\n\n        for _ in range(mc_samples):\n            # Generate lognormal multipliers u_j\n            z = np.random.normal(size=Nr)\n            u = np.exp(-0.5 * sigma**2 + sigma * z)\n\n            # Calculate perturbed ROP magnitudes\n            perturbed_abs_rop = u * abs_rop_ij\n            \n            # Identify top k for this sample\n            sample_sorted_pairs = sorted(zip(perturbed_abs_rop, indices), key=lambda p: (-p[0], p[1]))\n            sample_top_k_indices = [pair[1] for pair in sample_sorted_pairs[:k]]\n            \n            # Increment counts for the top k reactions\n            top_k_counts[sample_top_k_indices] += 1\n            \n        # Calculate probabilities\n        probabilities = top_k_counts / mc_samples\n\n        # Determine robust dominant set by sorting probabilities\n        prob_sorted_pairs = sorted(zip(probabilities, indices), key=lambda p: (-p[0], p[1]))\n        robust_top_k = [pair[1] for pair in prob_sorted_pairs[:k]]\n\n        results.append([base_top_k, robust_top_k])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list in Python includes spaces, matching the format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}