{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的动力学减排策略之前，理解$NO$生成的热力学极限至关重要。本练习  将指导您运用基本热力学原理计算$NO$的平衡浓度，从而确立热力型$NO$生成的理论上限。掌握此方法能为您评估任何$NO_x$减排技术的效果提供一个关键的基准。",
            "id": "4045106",
            "problem": "高温下的化学计量甲烷-空气火焰通过扩展的 Zeldovich 机理产生热力型一氧化氮。考虑被称为 Zeldovich 机理的一对可逆基元反应：$\\,\\mathrm{O} + \\mathrm{N_2} \\rightleftharpoons \\mathrm{NO} + \\mathrm{N}\\,$ 和 $\\,\\mathrm{N} + \\mathrm{O_2} \\rightleftharpoons \\mathrm{NO} + \\mathrm{O}\\,$。根据理想气体近似下的质量作用定律，将这两个反应合并得到总可逆反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}\\,$，其在标准状态下定义的平衡常数为 $K_p(T)$。理想气体平衡常数可由热力学得到：$K_p(T) = \\exp\\!\\left(-\\Delta G^\\circ(T)/(R T)\\right)$，其中 $\\Delta G^\\circ(T)$ 是温度 $T$ 下的标准吉布斯自由能变，$R$ 是通用气体常数，$T$ 是绝对温度。在理想气体中，分压为 $p_i = y_i P$，其中 $y_i$ 是摩尔分数，$P$ 是总压力。对于总反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}\\,$，一氧化氮的平衡摩尔分数满足\n$$\\frac{(p_{\\mathrm{NO}})^2}{p_{\\mathrm{N_2}}\\,p_{\\mathrm{O_2}}} = K_p(T),\\quad\\text{即}\\quad y_{\\mathrm{NO}} = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}}.$$\n假设在 $T=2200\\ \\mathrm{K}$ 和 $P=1\\ \\mathrm{atm}$ 条件下，有一个由 $\\mathrm{N_2}$、$\\mathrm{O_2}$、$\\mathrm{H_2O}$ 和 $\\mathrm{CO_2}$ 组成的理想气体火焰后混合物。为计算 $K_p(T)$，请使用标准热化学方法以及用于高温范围物种标准状态性质的 NASA 七系数多项式形式。对于每种物质，其无量纲定压热容、焓和熵由以下公式给出：\n$$\\frac{c_p^\\circ(T)}{R} = a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4,$$\n$$\\frac{h^\\circ(T)}{R T} = a_1 + \\frac{a_2 T}{2} + \\frac{a_3 T^2}{3} + \\frac{a_4 T^3}{4} + \\frac{a_5 T^4}{5} + \\frac{a_6}{T},$$\n$$\\frac{s^\\circ(T)}{R} = a_1 \\ln T + a_2 T + \\frac{a_3 T^2}{2} + \\frac{a_4 T^3}{3} + \\frac{a_5 T^4}{4} + a_7,$$\n无量纲吉布斯自由能为 $g^\\circ(T)/(R T) = h^\\circ(T)/(R T) - s^\\circ(T)/R$。反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\to 2\\,\\mathrm{NO}\\,$ 的标准吉布斯自由能变为\n$$\\frac{\\Delta G^\\circ(T)}{R T} = 2\\,\\frac{g^\\circ_{\\mathrm{NO}}(T)}{R T} - \\frac{g^\\circ_{\\mathrm{N_2}}(T)}{R T} - \\frac{g^\\circ_{\\mathrm{O_2}}(T)}{R T},$$\n从而得到 $K_p(T) = \\exp\\!\\left(-\\Delta G^\\circ(T)/(R T)\\right)$。请使用以下适用于 $T \\in [1000,6000]\\ \\mathrm{K}$ 温度范围的物种高温 NASA 多项式系数 $(a_1,\\ldots,a_7)$：\n- 对于 $\\mathrm{N_2}$：$a_1=2.95257626$, $a_2=1.39690040\\times 10^{-3}$, $a_3=-4.92631603\\times 10^{-7}$, $a_4=7.86010367\\times 10^{-11}$, $a_5=-4.60755321\\times 10^{-15}$, $a_6=-9.23948688\\times 10^{2}$, $a_7=5.87188762$。\n- 对于 $\\mathrm{O_2}$：$a_1=3.28253784$, $a_2=1.48308754\\times 10^{-3}$, $a_3=-7.57966669\\times 10^{-7}$, $a_4=2.09470555\\times 10^{-10}$, $a_5=-2.16717794\\times 10^{-14}$, $a_6=-1.08845772\\times 10^{3}$, $a_7=5.45323129$。\n- 对于 $\\mathrm{NO}$：$a_1=2.26071716$, $a_2=1.19110565\\times 10^{-3}$, $a_3=-4.29170406\\times 10^{-7}$, $a_4=6.94576690\\times 10^{-11}$, $a_5=-4.03223084\\times 10^{-15}$, $a_6=9.84444553\\times 10^{2}$, $a_7=6.33965101$。\n假设再燃通过注入碳氢化合物消耗一部分 $\\mathrm{O_2}$，从而减少了 Zeldovich 机理可用的有效氧化剂。通过有效氧摩尔分数 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 来对此建模，其中 $\\chi \\in [0,1]$ 是再燃强度参数（$\\chi=0$ 表示无再燃，$\\chi$ 接近 $1$ 表示强烈的再燃，几乎消除了可用于热力生成 $\\mathrm{NO}$ 的 $\\mathrm{O_2}$）。在此模型下，一氧化氮的平衡摩尔分数为\n$$y_{\\mathrm{NO}}(T) = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}^{\\mathrm{eff}}}.$$\n所有摩尔分数必须以无单位的小数形式提供；输出也必须是相同的无单位小数形式。对于本问题，取 $T=2200\\ \\mathrm{K}$ 和 $P=1\\ \\mathrm{atm}$，并为以下五个测试案例计算 $y_{\\mathrm{NO}}$，这些案例探究了基线行为、贫氧条件和再燃引起的减少情况：\n- 案例 1（基线燃烧，少量残余 $\\mathrm{O_2}$）：$y_{\\mathrm{N_2}}=0.740$, $y_{\\mathrm{O_2}}=0.010$, $y_{\\mathrm{CO_2}}=0.090$, $y_{\\mathrm{H_2O}}=0.160$, $\\chi=0.000$。\n- 案例 2（近乎无氧，边界条件）：$y_{\\mathrm{N_2}}=0.740$, $y_{\\mathrm{O_2}}=0.000$, $y_{\\mathrm{CO_2}}=0.090$, $y_{\\mathrm{H_2O}}=0.170$, $\\chi=0.000$。\n- 案例 3（贫氧火焰后，$\\mathrm{O_2}$ 含量升高）：$y_{\\mathrm{N_2}}=0.700$, $y_{\\mathrm{O_2}}=0.050$, $y_{\\mathrm{CO_2}}=0.080$, $y_{\\mathrm{H_2O}}=0.170$, $\\chi=0.000$。\n- 案例 4（中等强度再燃）：$y_{\\mathrm{N_2}}=0.740$, $y_{\\mathrm{O_2}}=0.010$, $y_{\\mathrm{CO_2}}=0.090$, $y_{\\mathrm{H_2O}}=0.160$, $\\chi=0.500$。\n- 案例 5（高强度再燃）：$y_{\\mathrm{N_2}}=0.740$, $y_{\\mathrm{O_2}}=0.010$, $y_{\\mathrm{CO_2}}=0.090$, $y_{\\mathrm{H_2O}}=0.160$, $\\chi=0.950$。\n您的程序必须根据提供的 NASA 多项式系数在 $T=2200\\ \\mathrm{K}$ 下计算 $K_p(T)$，然后使用 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 为每个案例计算 $y_{\\mathrm{NO}}$。最终输出必须是单行，包含五个结果，以逗号分隔并用方括号括起，顺序与测试案例一致。每个条目应为 $y_{\\mathrm{NO}}$ 的浮点数值（无单位小数）。例如，输出形式应为 $\\,[\\alpha_1,\\alpha_2,\\alpha_3,\\alpha_4,\\alpha_5]$，其中每个 $\\alpha_i$ 是为案例 $i$ 计算的摩尔分数。",
            "solution": "该问题要求计算在涉及组分和再燃强度变化的五种不同情况下，火焰后气体混合物中一氧化氮的平衡摩尔分数 $y_{\\mathrm{NO}}$。该计算基于化学热力学原理和用于热力型 $\\mathrm{NO}$ 生成的 Zeldovich 机理。整个过程可以分解为一系列步骤，从使用所提供的数据根据第一性原理计算热力学性质开始。\n\n温度固定在 $T=2200\\ \\mathrm{K}$，压力固定在 $P=1\\ \\mathrm{atm}$。计算的基础是总反应 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的平衡。该反应的平衡常数 $K_p(T)$ 与平衡时各物种的摩尔分数相关。问题提供了一个简化的 $\\mathrm{NO}$ 平衡摩尔分数模型：\n$$y_{\\mathrm{NO}}(T) = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}^{\\mathrm{eff}}}$$\n此处，$y_{\\mathrm{N_2}}$ 是氮气的摩尔分数，$y_{\\mathrm{O_2}}^{\\mathrm{eff}}$ 是可用于热力型 $\\mathrm{NO}$ 生成的有效氧摩尔分数，由 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 给出，其中 $\\chi$ 是再燃强度参数。此公式假设 $\\mathrm{NO}$ 是一种痕量物质，其生成不会显著改变主要物质 $\\mathrm{N_2}$ 和 $\\mathrm{O_2}$ 的摩尔分数。\n\n首要任务是先确定在 $T=2200\\ \\mathrm{K}$ 时平衡常数 $K_p(T)$ 的值。根据化学热力学，$K_p(T)$ 通过以下方程与反应的标准吉布斯自由能变 $\\Delta G^\\circ(T)$ 相关：\n$$K_p(T) = \\exp\\left(-\\frac{\\Delta G^\\circ(T)}{R T}\\right)$$\n其中 $R$ 是通用气体常数。无量纲量 $\\Delta G^\\circ(T)/(R T)$ 是根据反应物和生成物的标准状态无量纲吉布斯自由能计算得出的：\n$$\\frac{\\Delta G^\\circ(T)}{R T} = \\sum_i \\nu_i \\frac{g_i^\\circ(T)}{R T} = 2 \\left(\\frac{g^\\circ_{\\mathrm{NO}}(T)}{R T}\\right) - 1 \\left(\\frac{g^\\circ_{\\mathrm{N_2}}(T)}{R T}\\right) - 1 \\left(\\frac{g^\\circ_{\\mathrm{O_2}}(T)}{R T}\\right)$$\n其中 $\\nu_i$ 是反应 $\\mathrm{N_2} + \\mathrm{O_2} - 2\\,\\mathrm{NO} = 0$ 的化学计量系数。\n\n每种物质 $i$ 的无量纲标准状态吉布斯自由能 $g_i^\\circ(T)/(R T)$ 由其标准状态无量纲焓 $h_i^\\circ(T)/(R T)$ 和熵 $s_i^\\circ(T)/R$ 确定：\n$$\\frac{g_i^\\circ(T)}{R T} = \\frac{h_i^\\circ(T)}{R T} - \\frac{s_i^\\circ(T)}{R}$$\n\n问题提供了用于计算这些热力学性质的 NASA 七系数多项式形式。对于给定的温度 $T$ 和一组特定物质的系数 $(a_1, a_2, a_3, a_4, a_5, a_6, a_7)$，焓和熵的计算如下：\n$$\\frac{h^\\circ(T)}{R T} = a_1 + \\frac{a_2 T}{2} + \\frac{a_3 T^2}{3} + \\frac{a_4 T^3}{4} + \\frac{a_5 T^4}{5} + \\frac{a_6}{T}$$\n$$\\frac{s^\\circ(T)}{R} = a_1 \\ln T + a_2 T + \\frac{a_3 T^2}{2} + \\frac{a_4 T^3}{3} + \\frac{a_5 T^4}{4} + a_7$$\n\n算法步骤如下：\n1. 对于反应中涉及的每种物质（$\\mathrm{N_2}$、$\\mathrm{O_2}$、$\\mathrm{NO}$），使用其特定的 NASA 系数组和给定的温度 $T=2200\\ \\mathrm{K}$ 来计算 $h_i^\\circ(T)/(R T)$ 和 $s_i^\\circ(T)/R$。\n2. 对于每种物质，通过从无量纲焓中减去无量纲熵来计算 $g_i^\\circ(T)/(R T)$。\n3. 计算反应的总无量纲吉布斯自由能变 $\\Delta G^\\circ(T)/(R T)$。\n4. 计算平衡常数 $K_p(T) = \\exp(-\\Delta G^\\circ(T)/(R T))$。\n5. 对于五个测试案例中的每一个：\n    a. 使用提供的 $y_{\\mathrm{N_2}}$、$y_{\\mathrm{O_2}}$ 和 $\\chi$ 的值。\n    b. 计算有效氧摩尔分数，$y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$。\n    c. 计算一氧化氮的平衡摩尔分数，$y_{\\mathrm{NO}} = \\sqrt{K_p(T) \\cdot y_{\\mathrm{N_2}} \\cdot y_{\\mathrm{O_2}}^{\\mathrm{eff}}}$。\n6. 收集五个得到的 $y_{\\mathrm{NO}}$ 值，并将它们格式化为方括号内的逗号分隔列表。\n\n实施此计算程序以求解指定的五个案例。对于案例 2，其中 $y_{\\mathrm{O_2}}=0$，由于氧气是必需的反应物，无需任何复杂计算即可立即看出 $y_{\\mathrm{NO}}$ 将为 $0$。其他案例展示了热力型 $\\mathrm{NO}$ 的生成对反应物浓度的依赖性以及再燃作为一种减排策略的有效性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the equilibrium mole fraction of nitric oxide (NO) for several\n    post-flame gas mixture cases based on the Zeldovich mechanism.\n\n    The calculation involves:\n    1. Computing thermodynamic properties (enthalpy, entropy, Gibbs free energy)\n       for N2, O2, and NO using NASA 7-coefficient polynomials.\n    2. Determining the equilibrium constant K_p(T) for the reaction N2 + O2 = 2NO.\n    3. Applying a reburning model to calculate the effective O2 mole fraction.\n    4. Calculating the equilibrium NO mole fraction for each test case.\n    \"\"\"\n    T = 2200.0  # Temperature in Kelvin\n\n    # NASA 7-coefficient polynomial data for the high-temperature range\n    # (a1, a2, a3, a4, a5, a6, a7)\n    nasa_coeffs = {\n        'N2': (2.95257626E+00, 1.39690040E-03, -4.92631603E-07,\n               7.86010367E-11, -4.60755321E-15, -9.23948688E+02,\n               5.87188762E+00),\n        'O2': (3.28253784E+00, 1.48308754E-03, -7.57966669E-07,\n               2.09470555E-10, -2.16717794E-14, -1.08845772E+03,\n               5.45323129E+00),\n        'NO': (2.26071716E+00, 1.19110565E-03, -4.29170406E-07,\n               6.94576690E-11, -4.03223084E-15, 9.84444553E+02,\n               6.33965101E+00)\n    }\n\n    def calculate_g_over_RT(T, coeffs):\n        \"\"\"\n        Calculates the dimensionless standard-state Gibbs free energy g_i/(RT)\n        for a species at temperature T.\n        \"\"\"\n        a1, a2, a3, a4, a5, a6, a7 = coeffs\n        T2 = T * T\n        T3 = T2 * T\n        T4 = T3 * T\n\n        # Dimensionless standard-state enthalpy h/(RT)\n        h_over_RT = (a1 + a2 * T / 2.0 + a3 * T2 / 3.0 + a4 * T3 / 4.0 +\n                     a5 * T4 / 5.0 + a6 / T)\n\n        # Dimensionless standard-state entropy s/R\n        s_over_R = (a1 * np.log(T) + a2 * T + a3 * T2 / 2.0 + a4 * T3 / 3.0 +\n                    a5 * T4 / 4.0 + a7)\n        \n        # Dimensionless standard-state Gibbs free energy g/(RT) = h/(RT) - s/R\n        return h_over_RT - s_over_R\n\n    # Calculate g/(RT) for each species at T = 2200 K\n    g_over_RT_N2 = calculate_g_over_RT(T, nasa_coeffs['N2'])\n    g_over_RT_O2 = calculate_g_over_RT(T, nasa_coeffs['O2'])\n    g_over_RT_NO = calculate_g_over_RT(T, nasa_coeffs['NO'])\n\n    # Calculate dimensionless Gibbs free energy change for N2 + O2 = 2NO\n    # DeltaG/(RT) = sum(nu_i * g_i/(RT))\n    # nu_i are stoichiometric coefficients: 2 for NO, -1 for N2, -1 for O2\n    delta_g_over_RT = 2.0 * g_over_RT_NO - g_over_RT_N2 - g_over_RT_O2\n\n    # Calculate the equilibrium constant K_p\n    # K_p = exp(-DeltaG/(RT))\n    Kp = np.exp(-delta_g_over_RT)\n\n    # Test cases from the problem statement\n    # Each tuple: (y_N2, y_O2, chi)\n    test_cases = [\n        (0.740, 0.010, 0.000),  # Case 1\n        (0.740, 0.000, 0.000),  # Case 2\n        (0.700, 0.050, 0.000),  # Case 3\n        (0.740, 0.010, 0.500),  # Case 4\n        (0.740, 0.010, 0.950),  # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        y_N2, y_O2, chi = case\n        \n        # Calculate effective O2 mole fraction\n        y_O2_eff = (1.0 - chi) * y_O2\n        \n        # Argument for the square root must be non-negative\n        arg = Kp * y_N2 * y_O2_eff\n        if arg  0:\n             # Should not happen with valid inputs but good practice\n             arg = 0.0\n        \n        # Calculate equilibrium NO mole fraction\n        y_NO = np.sqrt(arg)\n        results.append(y_NO)\n\n    # Format and print the final output as a single-line list of floats\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "尽管热力学平衡定义了理论极限，但真实世界的燃烧系统在有限速率的动力学约束下运行。本练习  将平衡状态下的$NO$水平与全混流反应器（PSR）中的稳态浓度进行直接对比，突显了停留时间（$\\tau$）的关键作用。通过这种比较，您将更深刻地理解为何动力学建模对于预测实际设备的排放是必不可少的。",
            "id": "4045120",
            "problem": "考虑一个干空气混合物在温度 $T$ 和总压 $P$ 下进入一个理想搅拌反应器 (PSR)，其入口摩尔分数为 $y_{\\mathrm{N_2,in}} = 0.79$、$y_{\\mathrm{O_2,in}} = 0.21$ 和 $y_{\\mathrm{NO,in}} = 0$。唯一的化学活性反应是氮气和氧气可逆生成一氧化氮 (NO)，表示为 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$。目标是推导并计算一氧化氮的平衡摩尔分数，并将其与 PSR 中有限速率动力学产生的一氧化氮摩尔分数进行比较，其中包括建模为逆向反应速率增强的再燃效应。\n\n基本依据与假设：\n\n- 理想气体：$p_i = y_i P$，且 $C_{\\mathrm{tot}} = P/(R T)$，其中 $R$ 是通用气体常数。\n- 热力学平衡常数：$K_p(T) = \\exp\\!\\left(-\\Delta G^\\circ(T)/(R T)\\right)$，其中 $\\Delta G^\\circ(T)$ 是在温度 $T$ 下反应的标准吉布斯自由能变。\n- 在 $T = 298\\,\\mathrm{K}$ 时的标准摩尔性质以及在所关注温度范围内的恒定热容：\n    - 标准生成焓：$\\Delta H_f^\\circ(\\mathrm{NO},298\\,\\mathrm{K}) = 90250\\,\\mathrm{J/mol}$，$\\Delta H_f^\\circ(\\mathrm{N_2},298\\,\\mathrm{K}) = 0\\,\\mathrm{J/mol}$，$\\Delta H_f^\\circ(\\mathrm{O_2},298\\,\\mathrm{K}) = 0\\,\\mathrm{J/mol}$。\n    - 标准摩尔熵：$s^\\circ(\\mathrm{NO},298\\,\\mathrm{K}) = 210.76\\,\\mathrm{J/(mol\\,K)}$，$s^\\circ(\\mathrm{N_2},298\\,\\mathrm{K}) = 191.61\\,\\mathrm{J/(mol\\,K)}$，$s^\\circ(\\mathrm{O_2},298\\,\\mathrm{K}) = 205.15\\,\\mathrm{J/(mol\\,K)}$。\n    - 恒定等压热容：$c_p(\\mathrm{NO}) = 33.0\\,\\mathrm{J/(mol\\,K)}$，$c_p(\\mathrm{N_2}) = 32.0\\,\\mathrm{J/(mol\\,K)}$，$c_p(\\mathrm{O_2}) = 34.0\\,\\mathrm{J/(mol\\,K)}$。\n- 恒定热容下的热力学函数：\n    - $h^\\circ_i(T) = \\Delta H_f^\\circ(i,298) + c_{p,i}\\,(T - 298)$。\n    - $s^\\circ_i(T) = s^\\circ_i(298) + c_{p,i}\\,\\ln(T/298)$。\n    - $g^\\circ_i(T) = h^\\circ_i(T) - T\\,s^\\circ_i(T)$。\n    - $\\Delta G^\\circ(T) = 2\\,g^\\circ_{\\mathrm{NO}}(T) - g^\\circ_{\\mathrm{N_2}}(T) - g^\\circ_{\\mathrm{O_2}}(T)$。\n- 理想气体条件下 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的平衡约束：\n    - 初始摩尔数为 $n_{\\mathrm{N_2,0}} = 0.79$，$n_{\\mathrm{O_2,0}} = 0.21$，设反应进度为 $\\xi \\ge 0$，则 $n_{\\mathrm{N_2}} = 0.79 - \\xi$，$n_{\\mathrm{O_2}} = 0.21 - \\xi$，$n_{\\mathrm{NO}} = 2\\,\\xi$，总摩尔数 $n_{\\mathrm{tot}} = 1.0$，摩尔分数 $y_i = n_i/n_{\\mathrm{tot}}$。\n    - 平衡条件为 $K_p(T) = \\left(p_{\\mathrm{NO}}\\right)^2/\\left(p_{\\mathrm{N_2}}\\,p_{\\mathrm{O_2}}\\right) = \\left(y_{\\mathrm{NO}}\\right)^2/\\left(y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}\\right)$，由此得到一个关于 $\\xi$ 的标量非线性方程，其解必须满足 $0 \\le \\xi \\le 0.21$。\n- 动力学 PSR 模型（理想搅拌反应器）：\n    - 组分平衡方程：$dC_i/dt = (C_{i,\\mathrm{in}} - C_i)/\\tau + \\omega_i$，其中 $\\tau$ 是停留时间，且 $C_{i,\\mathrm{in}} = y_{i,\\mathrm{in}}\\,C_{\\mathrm{tot}}$，并有 $y_{\\mathrm{NO,in}} = 0$，$y_{\\mathrm{N_2,in}} = 0.79$，$y_{\\mathrm{O_2,in}} = 0.21$。\n    - 与热力学一致的总包反应 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的有限速率可逆动力学：\n        - 正向反应速率：$r_f = k_f\\,C_{\\mathrm{N_2}}\\,C_{\\mathrm{O_2}}$，其中 $k_f(T) = A_f\\,\\exp(-E_f/(R T))$。\n        - 逆向反应速率：$r_b = k_b\\,C_{\\mathrm{NO}}^2$，其中 $k_b(T) = k_f(T)/K_c(T)$ 且 $K_c(T) = K_p(T)$，因为该反应的 $\\Delta \\nu = 0$。\n        - 逆向反应速率的再燃增强：$k_{rb}(T,\\phi) = \\alpha\\,\\phi\\,\\exp(-E_{rb}/(R T))$，其中 $0 \\le \\phi \\le 1$ 表示再燃强度（燃料自由基可用性），有效逆向反应速率为 $r_b^{\\mathrm{eff}} = (k_b + k_{rb})\\,C_{\\mathrm{NO}}^2$。\n        - 净生成速率：$\\omega_{\\mathrm{NO}} = 2\\,r_f - 2\\,r_b^{\\mathrm{eff}}$，$\\omega_{\\mathrm{N_2}} = -r_f + r_b^{\\mathrm{eff}}$，$\\omega_{\\mathrm{O_2}} = -r_f + r_b^{\\mathrm{eff}}$。\n    - 动力学参数（为高温热力型一氧化氮生成和再燃途径选择的科学合理值）：\n        - 正向阿伦尼乌斯指前因子 $A_f = 1.0\\times 10^5\\,\\mathrm{m^3/(mol\\,s)}$，活化能 $E_f = 2.8\\times 10^5\\,\\mathrm{J/mol}$。\n        - 再燃增强因子 $\\alpha = 5.0\\times 10^5\\,\\mathrm{m^3/(mol\\,s)}$，活化能 $E_{rb} = 5.0\\times 10^4\\,\\mathrm{J/mol}$。\n    - 通用气体常数：$R = 8.314462618\\,\\mathrm{J/(mol\\,K)}$。\n\n程序中需要实现的任务：\n\n1. 对于每个测试用例，通过以下步骤计算平衡状态下的一氧化氮摩尔分数 $y_{\\mathrm{NO,eq}}$：\n    - 使用给定的恒定热容模型和标准性质计算 $\\Delta G^\\circ(T)$。\n    - 计算 $K_p(T)$。\n    - 在允许范围 $[0,0.21]$ 内求解反应进度 $\\xi$ 的非线性平衡方程。\n    - 返回 $y_{\\mathrm{NO,eq}} = 2\\,\\xi$。\n2. 对于每个测试用例，通过以下步骤计算 PSR 中一氧化氮的摩尔分数 $y_{\\mathrm{NO,psr}}$：\n    - 建立关于 $C_{\\mathrm{N_2}}(t)$、$C_{\\mathrm{O_2}}(t)$、$C_{\\mathrm{NO}}(t)$ 的常微分方程组，使用给定的入口浓度、停留时间和包括再燃参数 $\\phi$ 在内的随温度变化的速率。\n    - 进行数值积分直到达到稳态的最终时间（例如，$\\tau$ 的数倍），并获得稳态时的一氧化氮浓度 $C_{\\mathrm{NO,ss}}$。\n    - 返回 $y_{\\mathrm{NO,psr}} = C_{\\mathrm{NO,ss}}/C_{\\mathrm{tot}}$。\n\n必须使用的物理单位：\n\n- 温度 $T$ 单位为 $\\mathrm{K}$。\n- 压力 $P$ 单位为 $\\mathrm{Pa}$。\n- 时间 $\\tau$ 单位为 $\\mathrm{s}$。\n- 浓度 $C_i$ 单位为 $\\mathrm{mol/m^3}$。\n- 摩尔分数 $y_i$ 是无单位小数。\n\n测试套件：\n\n- 用例 1：$T = 1800\\,\\mathrm{K}$，$P = 101325\\,\\mathrm{Pa}$，$\\tau = 0.05\\,\\mathrm{s}$，$\\phi = 0.0$。\n- 用例 2：$T = 1800\\,\\mathrm{K}$，$P = 101325\\,\\mathrm{Pa}$，$\\tau = 1.0\\,\\mathrm{s}$，$\\phi = 0.0$。\n- 用例 3：$T = 2200\\,\\mathrm{K}$，$P = 101325\\,\\mathrm{Pa}$，$\\tau = 0.01\\,\\mathrm{s}$，$\\phi = 0.0$。\n- 用例 4：$T = 1800\\,\\mathrm{K}$，$P = 202650\\,\\mathrm{Pa}$，$\\tau = 0.05\\,\\mathrm{s}$，$\\phi = 0.0$。\n- 用例 5：$T = 1800\\,\\mathrm{K}$，$P = 101325\\,\\mathrm{Pa}$，$\\tau = 0.05\\,\\mathrm{s}$，$\\phi = 1.0$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。列表中的每个元素都是一个双元素列表 $[y_{\\mathrm{NO,eq}}, y_{\\mathrm{NO,psr}}]$，对应于上述指定顺序的测试用例。例如：\"$[[0.00123,0.00098],[\\dots,\\dots],\\dots]$\"。",
            "solution": "此问题被评估为有效，因为其科学基础扎根于化学热力学和动力学原理，在数学上是适定的，并且所有必要的参数和条件都已明确给出。我们着手进行求解，求解过程分为两个主要部分：平衡组分的计算，以及在有限速率动力学下，理想搅拌反应器 (PSR) 中稳态组分的计算。\n\n首先，我们定义通用气体常数 $R = 8.314462618\\,\\mathrm{J/(mol\\,K)}$ 和参考温度 $T_{ref} = 298\\,\\mathrm{K}$。\n\n第 1 部分：平衡一氧化氮摩尔分数 ($y_{\\mathrm{NO,eq}}$)\n\n平衡状态由反应 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的热力学平衡常数 $K_p(T)$ 控制。平衡常数通过以下公式与反应的标准吉布斯自由能变 $\\Delta G^\\circ(T)$ 相关：\n$$K_p(T) = \\exp\\left(-\\frac{\\Delta G^\\circ(T)}{R T}\\right)$$\n标准吉布斯自由能变由 $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$ 给出，其中 $\\Delta H^\\circ(T)$ 和 $\\Delta S^\\circ(T)$ 分别是反应的标准焓变和熵变。\n\n给定 $T_{ref} = 298\\,\\mathrm{K}$ 时的热力学数据和恒定的等压热容 $c_{p,i}$。该反应的热容变化为：\n$$\\Delta c_p = 2 c_{p,\\mathrm{NO}} - c_{p,\\mathrm{N_2}} - c_{p,\\mathrm{O_2}} = 2(33.0) - 32.0 - 34.0 = 66.0 - 66.0 = 0\\,\\mathrm{J/(mol\\,K)}$$\n由于 $\\Delta c_p = 0$，标准反应焓和标准反应熵都与温度无关：\n$\\Delta H^\\circ(T) = \\Delta H^\\circ(T_{ref}) + \\int_{T_{ref}}^T \\Delta c_p \\,dT' = \\Delta H^\\circ(T_{ref})$\n$\\Delta S^\\circ(T) = \\Delta S^\\circ(T_{ref}) + \\int_{T_{ref}}^T \\frac{\\Delta c_p}{T'} \\,dT' = \\Delta S^\\circ(T_{ref})$\n\n我们根据给定的 $T_{ref}$ 时的标准性质计算这些常数值：\n$\\Delta H^\\circ(T_{ref}) = 2\\,\\Delta H_f^\\circ(\\mathrm{NO}, T_{ref}) - \\Delta H_f^\\circ(\\mathrm{N_2}, T_{ref}) - \\Delta H_f^\\circ(\\mathrm{O_2}, T_{ref}) = 2(90250) - 0 - 0 = 180500\\,\\mathrm{J/mol}$。\n$\\Delta S^\\circ(T_{ref}) = 2\\,s^\\circ(\\mathrm{NO}, T_{ref}) - s^\\circ(\\mathrm{N_2}, T_{ref}) - s^\\circ(\\mathrm{O_2}, T_{ref}) = 2(210.76) - 191.61 - 205.15 = 421.52 - 396.76 = 24.76\\,\\mathrm{J/(mol\\,K)}$。\n\n因此，在任意温度 $T$ 下的标准吉布斯自由能变为：\n$$\\Delta G^\\circ(T) = 180500 - 24.76\\,T$$\n平衡常数为：\n$$K_p(T) = \\exp\\left(-\\frac{180500 - 24.76\\,T}{R T}\\right)$$\n对于初始摩尔分数为 $y_{\\mathrm{N_2,0}} = 0.79$ 和 $y_{\\mathrm{O_2,0}} = 0.21$ 的混合物，设 $\\xi$ 为以摩尔为基准的反应进度（每摩尔初始混合物）。平衡摩尔分数为 $y_{\\mathrm{N_2}} = 0.79 - \\xi$，$y_{\\mathrm{O_2}} = 0.21 - \\xi$ 和 $y_{\\mathrm{NO}} = 2\\xi$。总摩尔数保持为 1.0 不变。平衡条件表示为：\n$$K_p(T) = \\frac{y_{\\mathrm{NO}}^2}{y_{\\mathrm{N_2}} y_{\\mathrm{O_2}}} = \\frac{(2\\xi)^2}{(0.79 - \\xi)(0.21 - \\xi)}$$\n这产生了一个关于 $\\xi$ 的非线性代数方程：\n$$K_p(T) (\\xi^2 - \\xi + 0.1659) - 4\\xi^2 = 0$$\n或\n$$(K_p(T) - 4)\\xi^2 - K_p(T)\\xi + 0.1659 K_p(T) = 0$$\n我们在物理上允许的范围 $[0, 0.21]$ 内求解该方程以得到 $\\xi$。数值求根算法适合此任务。一旦找到 $\\xi$，平衡状态下的一氧化氮摩尔分数即为 $y_{\\mathrm{NO,eq}} = 2\\xi$。\n\n第 2 部分：有限速率 PSR 中一氧化氮的摩尔分数 ($y_{\\mathrm{NO,psr}}$)\n\nPSR 由一个描述组分浓度 $C_i$ 随时间演变的常微分方程组 (ODEs) 建模：\n$$\\frac{dC_i}{dt} = \\frac{C_{i,\\mathrm{in}} - C_i}{\\tau} + \\omega_i$$\n其中 $\\tau$ 是停留时间，$C_{i,\\mathrm{in}}$ 是入口浓度，$\\omega_i$ 是化学反应的净摩尔生成速率。\n总浓度为 $C_{\\mathrm{tot}} = P/(RT)$。入口浓度为：\n$C_{\\mathrm{N_2,in}} = 0.79\\, C_{\\mathrm{tot}}$，$C_{\\mathrm{O_2,in}} = 0.21\\, C_{\\mathrm{tot}}$，$C_{\\mathrm{NO,in}} = 0$。\n\n参与反应 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的组分的净生成速率为：\n$\\omega_{\\mathrm{NO}} = 2(r_f - r_b^{\\mathrm{eff}})$\n$\\omega_{\\mathrm{N_2}} = -(r_f - r_b^{\\mathrm{eff}})$\n$\\omega_{\\mathrm{O_2}} = -(r_f - r_b^{\\mathrm{eff}})$\n其中 $r_f$ 是正向反应速率，$r_b^{\\mathrm{eff}}$ 是有效逆向反应速率。\n\n正向反应速率为 $r_f = k_f(T) C_{\\mathrm{N_2}} C_{\\mathrm{O_2}}$，其速率常数由阿伦尼乌斯表达式给出：\n$$k_f(T) = A_f \\exp\\left(-\\frac{E_f}{RT}\\right)$$\n其中 $A_f = 1.0 \\times 10^5\\,\\mathrm{m^3/(mol\\,s)}$ 和 $E_f = 2.8 \\times 10^5\\,\\mathrm{J/mol}$。\n\n有效逆向反应速率为 $r_b^{\\mathrm{eff}} = (k_b(T) + k_{rb}(T, \\phi)) C_{\\mathrm{NO}}^2$。热力学一致的逆向反应速率常数为 $k_b(T) = k_f(T)/K_c(T)$。由于反应中摩尔数不变（$\\Delta \\nu = 2 - (1+1) = 0$），基于浓度的平衡常数 $K_c(T)$ 等于基于压力的平衡常数，即 $K_c(T) = K_p(T)$。\n再燃增强速率常数为：\n$$k_{rb}(T, \\phi) = \\alpha \\phi \\exp\\left(-\\frac{E_{rb}}{RT}\\right)$$\n其中 $\\alpha = 5.0 \\times 10^5\\,\\mathrm{m^3/(mol\\,s)}$，$E_{rb} = 5.0 \\times 10^4\\,\\mathrm{J/mol}$，$\\phi$ 是再燃强度。\n\n三个组分浓度的常微分方程组为：\n$$\\frac{dC_{\\mathrm{N_2}}}{dt} = \\frac{C_{\\mathrm{N_2,in}} - C_{\\mathrm{N_2}}}{\\tau} - k_f C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} + (k_b + k_{rb}) C_{\\mathrm{NO}}^2$$\n$$\\frac{dC_{\\mathrm{O_2}}}{dt} = \\frac{C_{\\mathrm{O_2,in}} - C_{\\mathrm{O_2}}}{\\tau} - k_f C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} + (k_b + k_{rb}) C_{\\mathrm{NO}}^2$$\n$$\\frac{dC_{\\mathrm{NO}}}{dt} = \\frac{C_{\\mathrm{NO,in}} - C_{\\mathrm{NO}}}{\\tau} + 2\\left(k_f C_{\\mathrm{N_2}} C_{\\mathrm{O_2}} - (k_b + k_{rb}) C_{\\mathrm{NO}}^2\\right)$$\n我们从入口浓度 $C_i(0) = C_{i,\\mathrm{in}}$ 开始求解这个初值问题，并积分直到浓度达到稳态。通常，$10\\tau$ 的最终积分时间是足够的。稳态浓度 $C_{\\mathrm{NO,ss}}$ 是在最终时间点 $C_{\\mathrm{NO}}(t)$ 的值。\nPSR 中的摩尔分数则为 $y_{\\mathrm{NO,psr}} = C_{\\mathrm{NO,ss}} / C_{\\mathrm{tot,ss}}$。由于反应化学计量意味着 $\\sum \\omega_i = 0$，总浓度 $C_{\\mathrm{tot}} = \\sum C_i$ 的演变遵循 $dC_{\\mathrm{tot}}/dt = (C_{\\mathrm{tot,in}} - C_{\\mathrm{tot}})/\\tau$，这意味着 $C_{\\mathrm{tot,ss}} = C_{\\mathrm{tot,in}} = P/(RT)$。因此，$y_{\\mathrm{NO,psr}} = C_{\\mathrm{NO,ss}} / (P/(RT))$。\n\n实施将通过为每个测试用例计算这些量来进行。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for equilibrium and PSR steady-state NO mole fractions\n    for a series of test cases.\n    \"\"\"\n    \n    # Fundamental constants and standard properties\n    R = 8.314462618  # J/(mol*K)\n    T_REF = 298.0  # K\n\n    # Standard enthalpies of formation at T_REF (J/mol)\n    H_F_NO = 90250.0\n    H_F_N2 = 0.0\n    H_F_O2 = 0.0\n\n    # Standard molar entropies at T_REF (J/(mol*K))\n    S_NO = 210.76\n    S_N2 = 191.61\n    S_O2 = 205.15\n\n    # Constant isobaric heat capacities (J/(mol*K))\n    CP_NO = 33.0\n    CP_N2 = 32.0\n    CP_O2 = 34.0\n\n    # Kinetic parameters\n    A_F = 1.0e5  # m^3/(mol*s)\n    E_F = 2.8e5  # J/mol\n    ALPHA_RB = 5.0e5 # m^3/(mol*s)\n    E_RB = 5.0e4   # J/mol\n\n    # Inlet mole fractions\n    Y_N2_IN = 0.79\n    Y_O2_IN = 0.21\n    Y_NO_IN = 0.0\n\n    # --- Thermodynamic Calculations ---\n    # Change in standard properties for N2 + O2 = 2*NO\n    # Since heat capacities are constant, Delta_H and Delta_S are constant\n    delta_H_0 = 2 * H_F_NO - H_F_N2 - H_F_O2\n    delta_S_0 = 2 * S_NO - S_N2 - S_O2\n    \n    # Delta Cp calculation\n    delta_Cp = 2 * CP_NO - CP_N2 - CP_O2\n    # NOTE: In this problem, delta_Cp happens to be 0, simplifying the thermo model.\n    # The code below is general for constant Cp, even if non-zero.\n    \n    def get_kp(T):\n        \"\"\"Calculates the equilibrium constant Kp at temperature T.\"\"\"\n        delta_H_T = delta_H_0 + delta_Cp * (T - T_REF)\n        delta_S_T = delta_S_0 + delta_Cp * np.log(T / T_REF)\n        delta_G_T = delta_H_T - T * delta_S_T\n        return np.exp(-delta_G_T / (R * T))\n\n    # --- Equilibrium Calculation ---\n    def calculate_y_no_eq(T):\n        \"\"\"Calculates the equilibrium NO mole fraction.\"\"\"\n        kp = get_kp(T)\n        \n        # We need to solve Kp = (2*xi)^2 / ((Y_N2_IN - xi) * (Y_O2_IN - xi)) for xi\n        # (Kp - 4)*xi^2 - Kp*xi + Kp*Y_N2_IN*Y_O2_IN = 0\n        def equilibrium_eqn(xi):\n            y_n2 = Y_N2_IN - xi\n            y_o2 = Y_O2_IN - xi\n            y_no = 2 * xi\n            # Avoid division by zero if xi is at a boundary\n            if y_n2 = 0 or y_o2 = 0:\n                # This case represents full consumption of a reactant, so the\n                # equilibrium term goes to infinity, kp would have to be infinite.\n                # Since Kp is finite, solution is not at boundary.\n                return -1.0 # Or some large residual\n            return y_no**2 / (y_n2 * y_o2) - kp\n            \n        # The physical range for xi is [0, min(Y_N2_IN, Y_O2_IN)]\n        # min(0.79, 0.21) = 0.21\n        xi_max = Y_O2_IN\n        try:\n            # Use a robust root finder\n            xi_eq = brentq(equilibrium_eqn, 0, xi_max * 0.99999)\n        except ValueError:\n            # If Kp is extremely small, the root is very close to 0.\n            # a simple check at the boundaries can tell us where the root must be\n             if equilibrium_eqn(0) * equilibrium_eqn(xi_max * 0.99999) > 0:\n                 # This can happen if the function is monotonic and root is outside bounds, or no root\n                 # For this problem, should be very close to zero\n                 xi_eq = 0.0\n             else: # Should not happen, but for robustness\n                 raise\n                 \n        y_no_eq = 2 * xi_eq\n        return y_no_eq\n\n    # --- PSR Calculation ---\n    def psr_ode_system(t, C, C_in, tau, kf, kb_eff):\n        \"\"\"Defines the ODE system for the PSR.\"\"\"\n        C_N2, C_O2, C_NO = C\n        C_N2_in, C_O2_in, C_NO_in = C_in\n        \n        # Reaction rates\n        r_f = kf * C_N2 * C_O2\n        r_b_eff = kb_eff * C_NO**2\n        \n        # Net production rates\n        omega_N2 = -r_f + r_b_eff\n        omega_O2 = -r_f + r_b_eff\n        omega_NO = 2 * r_f - 2 * r_b_eff\n        \n        # Mass balance ODEs\n        dC_N2_dt = (C_N2_in - C_N2) / tau + omega_N2\n        dC_O2_dt = (C_O2_in - C_O2) / tau + omega_O2\n        dC_NO_dt = (C_NO_in - C_NO) / tau + omega_NO\n        \n        return [dC_N2_dt, dC_O2_dt, dC_NO_dt]\n\n    def calculate_y_no_psr(T, P, tau, phi):\n        \"\"\"Calculates the PSR steady-state NO mole fraction.\"\"\"\n        # Total concentration\n        C_tot = P / (R * T)\n        \n        # Inlet concentrations\n        C_N2_in = Y_N2_IN * C_tot\n        C_O2_in = Y_O2_IN * C_tot\n        C_NO_in = Y_NO_IN * C_tot\n        C_in = np.array([C_N2_in, C_O2_in, C_NO_in])\n        \n        # Rate constants\n        kf = A_F * np.exp(-E_F / (R * T))\n        kp = get_kp(T)\n        kc = kp # Since Delta_nu = 0\n        kb = kf / kc if kc > 0 else float('inf')\n        krb = phi * ALPHA_RB * np.exp(-E_RB / (R * T))\n        kb_eff = kb + krb\n        \n        # Initial conditions for ODE solver (reactor starts empty of products)\n        C0 = np.array([C_N2_in, C_O2_in, C_NO_in])\n\n        # Integrate ODEs until steady state is reached (e.g., 10 * tau)\n        t_final = 10 * tau\n        sol = solve_ivp(\n            fun=psr_ode_system,\n            t_span=[0, t_final],\n            y0=C0,\n            args=(C_in, tau, kf, kb_eff),\n            method='BDF', # Good for stiff problems often found in kinetics\n            atol=1e-12,\n            rtol=1e-9\n        )\n        \n        # Extract steady-state concentration\n        C_NO_ss = sol.y[2, -1]\n        \n        # Convert to mole fraction\n        y_no_psr = C_NO_ss / C_tot\n        \n        return y_no_psr\n\n    test_cases = [\n        # T (K), P (Pa), tau (s), phi\n        (1800.0, 101325.0, 0.05, 0.0),\n        (1800.0, 101325.0, 1.0, 0.0),\n        (2200.0, 101325.0, 0.01, 0.0),\n        (1800.0, 202650.0, 0.05, 0.0),\n        (1800.0, 101325.0, 0.05, 1.0)\n    ]\n    \n    results = []\n    for T, P, tau, phi in test_cases:\n        y_no_eq = calculate_y_no_eq(T)\n        y_no_psr = calculate_y_no_psr(T, P, tau, phi)\n        results.append([y_no_eq, y_no_psr])\n    \n    # Format the final output string exactly as requested\n    formatted_results = ','.join([f\"[{res[0]:.6g},{res[1]:.6g}]\" for res in results])\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这项练习将前面的概念综合到一个实际的工程设计问题中，通过对一个多级再燃过程进行建模来最小化排放。通过构建一个反应器网络并应用优化技术，您将探索在分级燃烧系统中降低$NO$和控制$CO$泄露之间的权衡 。这个综合性练习展示了如何运用计算工具来设计和优化复杂的排放控制策略。",
            "id": "4045182",
            "problem": "要求您使用由三个分别代表富燃再燃区、淬冷混合与反应区和贫燃燃尽区的理想搅拌反应器（PSR）串联模型，构建一个氮氧化物（NOx）空气分级再燃的计算模型。该模型必须捕捉燃料氧化、一氧化碳燃尽以及一氧化氮还原和再生的耦合化学过程，同时在理想气体框架内，在原子守恒的层面上保持热力学一致性。然后，您必须计算最佳的淬冷空气加入量，使得淬冷区的当量比接近指定目标值，同时最小化贫燃区出口的一氧化氮，并使出口一氧化碳低于限定值。最终程序必须按规定格式，以单行列表形式输出每个测试用例的最佳淬冷氧气加入量。\n\n请从以下基础开始。\n\n- 稳态理想搅拌反应器（PSR）的物种物料衡算：\n  $$0 = \\dot{n}_{i,\\mathrm{in}} - \\dot{n}_{i,\\mathrm{out}} + V \\, \\mathcal{R}_i(\\mathbf{C}, T),$$\n  其中 $\\dot{n}_{i,\\mathrm{in}}$ 和 $\\dot{n}_{i,\\mathrm{out}}$ 分别是物种 $i$ 的进口和出口摩尔流率（单位 $\\mathrm{mol/s}$），$V$ 是反应器体积（单位 $\\mathrm{m^3}$），$T$ 是反应器温度（单位 $\\mathrm{K}$），$\\mathbf{C}$ 是出口浓度向量（单位 $\\mathrm{mol/m^3}$），$\\mathcal{R}_i$ 是物种 $i$ 的气相净体积产率（单位 $\\mathrm{mol/(m^3 \\cdot s)}$）。假设为理想气体，因此体积流量为 $\\dot{V} = \\left(\\sum_i \\dot{n}_{i,\\mathrm{out}}\\right) R_u T / P$，其中 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$，$P$ 的单位是 $\\mathrm{Pa}$，且 $C_i = \\dot{n}_{i,\\mathrm{out}} / \\dot{V}$。\n- 空气组分由氧气和氮气指定，其中氧气的摩尔分数为 $0.21$。空气中氮气与氧气的摩尔比取 $3.76$。\n- 定义总包反应集和动力学（Arrhenius 形式）如下（物种集合为 $\\{\\mathrm{CH_4}, \\mathrm{O_2}, \\mathrm{NO}, \\mathrm{CO}, \\mathrm{CO_2}, \\mathrm{H_2O}, \\mathrm{N_2}\\}$）：\n  1. 甲烷对一氧化氮的再燃还原：\n     $$\\mathrm{CH_4} + 4 \\ \\mathrm{NO} \\rightarrow 2 \\ \\mathrm{N_2} + \\mathrm{CO_2} + 2 \\ \\mathrm{H_2O}, \\quad r_1 = A_1 \\exp\\!\\left(-\\dfrac{E_1}{R_u T}\\right) C_{\\mathrm{CH_4}} C_{\\mathrm{NO}}.$$\n  2. 燃料富燃条件下甲烷部分氧化生成一氧化碳：\n     $$\\mathrm{CH_4} + 1.5 \\ \\mathrm{O_2} \\rightarrow \\mathrm{CO} + 2 \\ \\mathrm{H_2O}, \\quad r_2 = A_2 \\exp\\!\\left(-\\dfrac{E_2}{R_u T}\\right) C_{\\mathrm{CH_4}} C_{\\mathrm{O_2}}.$$\n  3. 一氧化碳氧化：\n     $$\\mathrm{CO} + 0.5 \\ \\mathrm{O_2} \\rightarrow \\mathrm{CO_2}, \\quad r_3 = A_3 \\exp\\!\\left(-\\dfrac{E_3}{R_u T}\\right) C_{\\mathrm{CO}} C_{\\mathrm{O_2}}.$$\n  4. 热力型一氧化氮生成（总包形式）：\n     $$\\mathrm{N_2} + \\mathrm{O_2} \\rightarrow 2 \\ \\mathrm{NO}, \\quad r_4 = A_4 \\exp\\!\\left(-\\dfrac{E_4}{R_u T}\\right) C_{\\mathrm{O_2}}^{1/2} C_{\\mathrm{N_2}}^{1/2}.$$\n  净源项通过与上述反应一致的化学计量系数组合而成。所有的 Arrhenius 指前因子和活化能将在下面以数值形式给出。\n\n- 三个串联的 PSR 分别代表：富燃区（$\\mathrm{R}$）、淬冷区（$\\mathrm{Q}$）和贫燃区（$\\mathrm{L}$）。$\\mathrm{R}$ 区的入口包含甲烷燃料、为达到指定富燃当量比而加入的一次空气，以及代表上游排放的给定一氧化氮流入量。$\\mathrm{Q}$ 区的入口是 $\\mathrm{R}$ 区的出口与淬冷空气完全瞬时混合后的气体；$\\mathrm{L}$ 区的入口是 $\\mathrm{Q}$ 区的出口与足量贫燃空气混合后的气体，以使全局总当量比达到指定的贫燃目标。在能量平衡中忽略热量释放，并通过恒定摩尔热容下理想气体气流的焓混合计算淬冷区和贫燃区的温度，采用摩尔加权温度平均法：\n  $$T_{\\mathrm{mix}} = \\dfrac{\\dot{n}_{\\mathrm{hot}} T_{\\mathrm{hot}} + \\dot{n}_{\\mathrm{cold}} T_{\\mathrm{cold}}}{\\dot{n}_{\\mathrm{hot}} + \\dot{n}_{\\mathrm{cold}}},$$\n  其中 $\\dot{n}$ 表示混合气流的总摩尔流率，$T_{\\mathrm{cold}}$ 是空气温度。\n\n- 任意气体混合物的当量比定义为存在的各种可燃物种的化学计量氧化剂需求量与可用氧气量之比：\n  $$\\phi = \\dfrac{2 \\ \\dot{n}_{\\mathrm{CH_4}} + 0.5 \\ \\dot{n}_{\\mathrm{CO}}}{\\dot{n}_{\\mathrm{O_2}}},$$\n  其中所有摩尔流量均为所考虑时刻混合物中的流量。对于富燃区的一次进料，一次氧气流量根据指定的富燃当量比 $\\phi_{\\mathrm{R}}$ 和甲烷的化学计量需求（每摩尔 $\\mathrm{CH_4}$ 需 $2$ 摩尔 $\\mathrm{O_2}$）计算得出： \n  $$\\dot{n}_{\\mathrm{O_2,R}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{F}}}{\\phi_{\\mathrm{R}}}.$$\n  对于全局贫燃目标，所有区域加入的总氧气量为：\n  $$\\dot{n}_{\\mathrm{O_2,total}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{F}}}{\\phi_{\\mathrm{L}}}.$$\n  富燃区后可用于分级的剩余氧气为：\n  $$\\dot{n}_{\\mathrm{O_2,sec}} = \\max\\!\\left(0, \\ \\dot{n}_{\\mathrm{O_2,total}} - \\dot{n}_{\\mathrm{O_2,R}}\\right).$$\n\n- 决策变量与目标函数：选择淬冷氧气加入量 $\\dot{n}_{\\mathrm{O_2,Q}} \\in [0, \\dot{n}_{\\mathrm{O_2,sec}}]$。剩余的二次氧气进入贫燃区，即 $\\dot{n}_{\\mathrm{O_2,L}} = \\dot{n}_{\\mathrm{O_2,sec}} - \\dot{n}_{\\mathrm{O_2,Q}}$，并带入按指定比例伴随的氮气。根据完全混合的淬冷区入口（反应前）计算出的淬冷区当量比为：\n  $$\\phi_{\\mathrm{Q,mix}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{CH_4,Q,in}} + 0.5 \\ \\dot{n}_{\\mathrm{CO,Q,in}}}{\\dot{n}_{\\mathrm{O_2,Q,in}}},$$\n  其中入口流量是富燃区出口流量和淬冷空气加入量之和。优化目标是最小化贫燃区出口的一氧化氮摩尔分数 $\\hat{y}_{\\mathrm{NO,out}}$，同时使 $\\phi_{\\mathrm{Q,mix}}$ 接近目标值 $\\phi_{\\mathrm{Q,target}}$，并强制要求出口一氧化碳摩尔分数不超过指定限值 $\\hat{y}_{\\mathrm{CO,lim}}$。使用可微惩罚函数形式：\n  $$J(\\dot{n}_{\\mathrm{O_2,Q}}) = \\hat{y}_{\\mathrm{NO,out}} + w_{\\phi}\\left(\\phi_{\\mathrm{Q,mix}} - \\phi_{\\mathrm{Q,target}}\\right)^2 + w_{\\mathrm{CO}} \\, \\max\\!\\left(0, \\ \\hat{y}_{\\mathrm{CO,out}} - \\hat{y}_{\\mathrm{CO,lim}}\\right)^2,$$\n  其中权重 $w_{\\phi}$ 和 $w_{\\mathrm{CO}}$ 在下面给出。\n\n实现上述 PSR 串联模型，通过使用指定的动力学来求解每个 PSR 的稳态物种平衡方程，然后对每个测试用例在 $\\dot{n}_{\\mathrm{O_2,Q}}$ 上执行有界标量最小化。所有流量单位为 $\\mathrm{mol/s}$，体积单位为 $\\mathrm{m^3}$，压力单位为 $\\mathrm{Pa}$，温度单位为 $\\mathrm{K}$。所有计算均使用 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。程序必须返回每个测试用例的最佳淬冷氧气加入量 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$，以浮点数形式表示，并四舍五入到六位小数。\n\n所有情况下使用的动力学参数和常数：\n- 普适气体常数：$R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。\n- 压力：$P = 101325 \\ \\mathrm{Pa}$。\n- 空气中氧气摩尔分数：$0.21$；空气中氮气与氧气的摩尔比：$3.76$。\n- 空气温度：$T_{\\mathrm{air}} = 300 \\ \\mathrm{K}$。\n- 反应 $1$（再燃）：$A_1 = 2.0 \\times 10^{6} \\ \\mathrm{m^3/(mol \\cdot s)}$, $E_1 = 8.0 \\times 10^{4} \\ \\mathrm{J/mol}$。\n- 反应 $2$（富燃氧化）：$A_2 = 1.0 \\times 10^{8} \\ \\mathrm{m^3/(mol \\cdot s)}$, $E_2 = 1.25 \\times 10^{5} \\ \\mathrm{J/mol}$。\n- 反应 $3$（CO 氧化）：$A_3 = 5.0 \\times 10^{6} \\ \\mathrm{m^3/(mol \\cdot s)}$, $E_3 = 7.0 \\times 10^{4} \\ \\mathrm{J/mol}$。\n- 反应 $4$（热力型 NO）：$A_4 = 4.0 \\times 10^{3} \\ \\mathrm{s^{-1}}$, $E_4 = 2.8 \\times 10^{5} \\ \\mathrm{J/mol}$。\n- 惩罚权重：$w_{\\phi} = 100.0$, $w_{\\mathrm{CO}} = 10^{6}$。\n\n测试套件。对于以下每个用例，运行优化并报告最佳 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$（单位 $\\mathrm{mol/s}$），四舍五入到六位小数。每个用例定义了燃料流量 $\\dot{n}_{\\mathrm{F}}$（单位 $\\mathrm{mol/s}$）、富燃区当量比 $\\phi_{\\mathrm{R}}$、贫燃全局目标 $\\phi_{\\mathrm{L}}$、淬冷目标 $\\phi_{\\mathrm{Q,target}}$、富燃区温度 $T_{\\mathrm{R}}$（单位 $\\mathrm{K}$）、反应器体积 $V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}$（单位 $\\mathrm{m^3}$）、进入富燃区的入口一氧化氮流量 $\\dot{n}_{\\mathrm{NO,in}}$（单位 $\\mathrm{mol/s}$），以及允许的出口一氧化碳摩尔分数上限 $\\hat{y}_{\\mathrm{CO,lim}}$（无量纲摩尔分数，可表示为小数）。\n\n- 用例 A：\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.2$, $\\phi_{\\mathrm{L}} = 0.85$, $\\phi_{\\mathrm{Q,target}} = 0.98$,\n  - $T_{\\mathrm{R}} = 1900$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.03, 0.05, 0.07)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 5.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.5 \\times 10^{-3}$。\n- 用例 B：\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.2$, $\\phi_{\\mathrm{L}} = 0.85$, $\\phi_{\\mathrm{Q,target}} = 0.98$,\n  - $T_{\\mathrm{R}} = 1900$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.03, 0.05, 0.07)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 5.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 2.0 \\times 10^{-4}$。\n- 用例 C：\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.4$, $\\phi_{\\mathrm{L}} = 0.90$, $\\phi_{\\mathrm{Q,target}} = 1.05$,\n  - $T_{\\mathrm{R}} = 2000$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.02, 0.04, 0.06)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 1.0 \\times 10^{-3}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.0 \\times 10^{-3}$。\n- 用例 D：\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.1$, $\\phi_{\\mathrm{L}} = 0.98$, $\\phi_{\\mathrm{Q,target}} = 0.95$,\n  - $T_{\\mathrm{R}} = 1850$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.025, 0.035, 0.05)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 3.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.0 \\times 10^{-3}$。\n\n实现要求和输出规范：\n\n- 完全按照描述构建三区 PSR 串联模型，使用给定的反应、动力学和混合规则。对于每个区域，通过理想气体关系从出口摩尔流量计算浓度，进而求解 PSR 稳态物种平衡以获得出口摩尔流量。\n- 决策变量是淬冷区氧气加入量 $\\dot{n}_{\\mathrm{O_2,Q}}$（单位 $\\mathrm{mol/s}$）。请遵守边界 $0 \\le \\dot{n}_{\\mathrm{O_2,Q}} \\le \\dot{n}_{\\mathrm{O_2,sec}}$。\n- 计算目标函数 $J(\\dot{n}_{\\mathrm{O_2,Q}})$ 并为每个用例将其最小化。\n- 最终输出必须是包含一个 Python 列表的单行，其中包含分别对应于用例 A、B、C 和 D 的 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$ 的四个浮点数，每个值都四舍五入到六位小数，单位为 $\\mathrm{mol/s}$，例如：\n  $$[\\mathrm{value\\_A},\\mathrm{value\\_B},\\mathrm{value\\_C},\\mathrm{value\\_D}]$$\n  其中每个 $\\mathrm{value}$ 是一个小数点后有六位数字的十进制数，并且在打印行中不含单位。",
            "solution": "用户提供了一个计算燃烧学领域的适定问题。任务是使用一系列理想搅拌反应器（PSR）对一个三级 NOx 再燃过程进行建模，并找到一个最佳的空气分级策略。该问题具有科学依据，无矛盾之处，并包含构建数值解所需的所有必要信息。模型中的简化，例如简化的动力学机理和每个反应器的等温假设（解耦的能量方程），都已明确说明，并且是概念级过程建模的标准做法。\n\n在此，我将通过首先为单个 PSR 建立数学框架，然后构建三反应器链，最后将此模型嵌入优化程序中来求解指定的测试用例，从而形成解决方案。\n\n### 1. 物种与化学计量\n该模型涉及 $N_s=7$ 个物种：$\\mathrm{CH_4}$、$\\mathrm{O_2}$、$\\mathrm{NO}$、$\\mathrm{CO}$、$\\mathrm{CO_2}$、$\\mathrm{H_2O}$ 和 $\\mathrm{N_2}$。为向量表示建立一个一致的顺序：\n$0: \\mathrm{CH_4}$, $1: \\mathrm{O_2}$, $2: \\mathrm{NO}$, $3: \\mathrm{CO}$, $4: \\mathrm{CO_2}$, $5: \\mathrm{H_2O}$, $6: \\mathrm{N_2}$。\n\n问题定义了四个总包反应。物种 $j$ 在反应 $i$ 中的净化学计量系数 $\\nu_{ij}$ 可以组合成一个矩阵。设行代表反应 $1-4$，列代表物种 $0-6$。\n$$\n\\nu = \\begin{pmatrix}\n-1  0  -4  0  1  2  2 \\\\\n-1  -1.5  0  1  0  2  0 \\\\\n0  -0.5  0  -1  1  0  0 \\\\\n0  -1  2  0  0  0  -1\n\\end{pmatrix}\n$$\n\n### 2. 动力学与速率定律\n对于每个反应 $j$，其速率 $r_j$ 由 Arrhenius 表达式乘以浓度项给出。所有浓度 $C_j$ 的单位为 $\\mathrm{mol/m^3}$，温度 $T$ 的单位为 $\\mathrm{K}$。普适气体常数为 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。\n速率常数为 $k_j(T) = A_j \\exp(-E_j / (R_u T))$。反应速率为：\n$$ r_1 = k_1(T) C_{\\mathrm{CH_4}} C_{\\mathrm{NO}} $$\n$$ r_2 = k_2(T) C_{\\mathrm{CH_4}} C_{\\mathrm{O_2}} $$\n$$ r_3 = k_3(T) C_{\\mathrm{CO}} C_{\\mathrm{O_2}} $$\n$$ r_4 = k_4(T) C_{\\mathrm{O_2}}^{1/2} C_{\\mathrm{N_2}}^{1/2} $$\n每个物种 $j$ 的净体积产率 $\\mathcal{R}_j$ 是其在所有反应中产出/消耗的总和：\n$$ \\mathcal{R}_j(\\mathbf{C}, T) = \\sum_{i=1}^{4} \\nu_{ij} r_i(\\mathbf{C}, T) = (\\boldsymbol{\\nu}^T \\mathbf{r})_j $$\n其中 $\\mathbf{r}$ 是反应速率的列向量 $[r_1, r_2, r_3, r_4]^T$。\n\n### 3. 理想搅拌反应器（PSR）模型\nPSR 中物种 $j$ 的稳态物料衡算为：\n$$ 0 = \\dot{n}_{j,\\mathrm{in}} - \\dot{n}_{j,\\mathrm{out}} + V \\, \\mathcal{R}_j(\\mathbf{C}_{\\mathrm{out}}, T) $$\n其中 $\\dot{n}$ 是摩尔流率（单位 $\\mathrm{mol/s}$），$V$ 是反应器体积（单位 $\\mathrm{m^3}$）。\n在理想气体假设下，出口浓度 $\\mathbf{C}_{\\mathrm{out}}$ 与出口摩尔流率 $\\dot{\\mathbf{n}}_{\\mathrm{out}}$ 相关：\n$$ C_{j, \\mathrm{out}} = \\frac{P}{R_u T} \\frac{\\dot{n}_{j, \\mathrm{out}}}{\\sum_{k=1}^{N_s} \\dot{n}_{k, \\mathrm{out}}} = \\frac{P}{R_u T} \\hat{y}_{j, \\mathrm{out}} $$\n其中 $P$ 是压力（单位 $\\mathrm{Pa}$），$\\hat{y}_{j, \\mathrm{out}}$ 是摩尔分数。将此代入速率定律，使得 PSR 方程成为一个关于未知出口摩尔流率 $\\dot{\\mathbf{n}}_{\\mathrm{out}}$ 的 $N_s$ 个耦合非线性代数方程组。\n$$ \\mathbf{F}(\\dot{\\mathbf{n}}_{\\mathrm{out}}) = \\dot{\\mathbf{n}}_{\\mathrm{in}} - \\dot{\\mathbf{n}}_{\\mathrm{out}} + V \\, \\boldsymbol{\\mathcal{R}}(\\dot{\\mathbf{n}}_{\\mathrm{out}}, T) = \\mathbf{0} $$\n该系统必须通过数值方法求解。我们将使用一个求根算法，具体是 `scipy.optimize.root`，并使用入口流率作为出口流率的初始猜测值。为在迭代过程中保持物理有效性，物种浓度和摩尔流率将被截断为一个小的正数（例如 $10^{-30}$）以防止在 `sqrt` 等函数中出现定义域错误。\n\n### 4. 三区反应器链模拟\n对于给定的决策变量 $\\dot{n}_{\\mathrm{O_2,Q}}$，模拟按顺序通过三个反应器进行。\n\n**a. R 区（富燃反应器）：**\n入口摩尔流率 $\\dot{\\mathbf{n}}_{\\mathrm{in,R}}$ 由燃料流率 $\\dot{n}_{\\mathrm{F}}$ 和富燃当量比 $\\phi_{\\mathrm{R}}$ 确定。\n- 燃料：$\\dot{n}_{\\mathrm{CH_4,in,R}} = \\dot{n}_{\\mathrm{F}}$\n- 一次空气：$\\dot{n}_{\\mathrm{O_2,R}} = (2 \\dot{n}_{\\mathrm{F}}) / \\phi_{\\mathrm{R}}$ 和 $\\dot{n}_{\\mathrm{N_2,in,R}} = 3.76 \\cdot \\dot{n}_{\\mathrm{O_2,R}}$\n- 入口 NO：$\\dot{n}_{\\mathrm{NO,in,R}}$ 由用例数据给出。\n- 其他物种：$\\dot{n}_{j, \\mathrm{in,R}} = 0$。\n使用体积 $V_R$ 和温度 $T_R$ 求解 PSR 方程，以找到出口流率 $\\dot{\\mathbf{n}}_{\\mathrm{out,R}}$。\n\n**b. Q 区（淬冷反应器）：**\n该区域的入口 $\\dot{\\mathbf{n}}_{\\mathrm{in,Q}}$ 是富燃区出口 $\\dot{\\mathbf{n}}_{\\mathrm{out,R}}$ 与淬冷空气流的混合物。\n- 淬冷空气：此气流包含 $\\dot{n}_{\\mathrm{O_2,Q}}$（决策变量）和 $\\dot{n}_{\\mathrm{N_2,Q}} = 3.76 \\cdot \\dot{n}_{\\mathrm{O_2,Q}}$。\n- 入口混合物：$\\dot{\\mathbf{n}}_{\\mathrm{in,Q}} = \\dot{\\mathbf{n}}_{\\mathrm{out,R}} + \\dot{\\mathbf{n}}_{\\mathrm{air,Q}}$。\n温度 $T_Q$ 通过绝热混合计算：\n$$ T_Q = \\frac{(\\sum \\dot{n}_{j,\\mathrm{out,R}}) T_R + (\\dot{n}_{\\mathrm{O_2,Q}} + \\dot{n}_{\\mathrm{N_2,Q}}) T_{\\mathrm{air}}}{\\sum \\dot{n}_{j,\\mathrm{out,R}} + \\dot{n}_{\\mathrm{O_2,Q}} + \\dot{n}_{\\mathrm{N_2,Q}}} $$\n然后使用体积 $V_Q$ 和计算出的温度 $T_Q$ 求解 PSR 方程，以找到 $\\dot{\\mathbf{n}}_{\\mathrm{out,Q}}$。\n\n**c. L 区（贫燃反应器）：**\n可用的二次氧气为 $\\dot{n}_{\\mathrm{O_2,sec}} = (2 \\dot{n}_{\\mathrm{F}} / \\phi_{\\mathrm{L}}) - (2 \\dot{n}_{\\mathrm{F}} / \\phi_{\\mathrm{R}})$。\n贫燃空气流包含 $\\dot{n}_{\\mathrm{O_2,L}} = \\dot{n}_{\\mathrm{O_2,sec}} - \\dot{n}_{\\mathrm{O_2,Q}}$ 及相应的氮气。\n贫燃区的入口是淬冷区出口与贫燃空气的混合物：$\\dot{\\mathbf{n}}_{\\mathrm{in,L}} = \\dot{\\mathbf{n}}_{\\mathrm{out,Q}} + \\dot{\\mathbf{n}}_{\\mathrm{air,L}}$。\n温度 $T_L$ 通过类似的混合规则计算：\n$$ T_L = \\frac{(\\sum \\dot{n}_{j,\\mathrm{out,Q}}) T_Q + (\\dot{n}_{\\mathrm{O_2,L}} + \\dot{n}_{\\mathrm{N_2,L}}) T_{\\mathrm{air}}}{\\sum \\dot{n}_{j,\\mathrm{out,Q}} + \\dot{n}_{\\mathrm{O_2,L}} + \\dot{n}_{\\mathrm{N_2,L}}} $$\n使用体积 $V_L$ 和温度 $T_L$ 求解 PSR 方程，以找到最终的出口流率 $\\dot{\\mathbf{n}}_{\\mathrm{out,L}}$。\n\n### 5. 优化\n目标是找到最佳的淬冷氧气流率 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$，以最小化目标函数 $J$。搜索是有界的：$0 \\le \\dot{n}_{\\mathrm{O_2,Q}} \\le \\dot{n}_{\\mathrm{O_2,sec}}$。\n目标函数 $J$ 为：\n$$ J(\\dot{n}_{\\mathrm{O_2,Q}}) = \\hat{y}_{\\mathrm{NO,out,L}} + w_{\\phi}\\left(\\phi_{\\mathrm{Q,mix}} - \\phi_{\\mathrm{Q,target}}\\right)^2 + w_{\\mathrm{CO}} \\, \\max\\!\\left(0, \\ \\hat{y}_{\\mathrm{CO,out,L}} - \\hat{y}_{\\mathrm{CO,lim}}\\right)^2 $$\n- $\\hat{y}_{\\mathrm{NO,out,L}}$ 和 $\\hat{y}_{\\mathrm{CO,out,L}}$ 是贫燃区出口处 NO 和 CO 的摩尔分数。\n- $\\phi_{\\mathrm{Q,mix}}$ 是进入淬冷区的反应前混合物的当量比：\n  $$ \\phi_{\\mathrm{Q,mix}} = \\frac{2 \\ \\dot{n}_{\\mathrm{CH_4,in,Q}} + 0.5 \\ \\dot{n}_{\\mathrm{CO,in,Q}}}{\\dot{n}_{\\mathrm{O_2,in,Q}}} $$\n采用标量有界优化算法 `scipy.optimize.minimize_scalar`（使用 'bounded' 方法）来为每个测试用例找到 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$。如果对于给定的 $\\dot{n}_{\\mathrm{O_2,Q}}$，PSR 求解器失败，目标函数将返回一个很大的值，以引导优化器避开此类不可行区域。\n\n对问题陈述中提供的四个测试用例中的每一个都执行这整个过程。收集得到的最佳淬冷氧气流率并格式化为最终答案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root, minimize_scalar\n\n# Define global constants and structures\nSPECIES_MAP = {'CH4': 0, 'O2': 1, 'NO': 2, 'CO': 3, 'CO2': 4, 'H2O': 5, 'N2': 6}\nNUM_SPECIES = 7\n# Stoichiometric matrix (reactions x species)\n# R1: CH4 + 4NO -> 2N2 + CO2 + 2H2O\n# R2: CH4 + 1.5O2 -> CO + 2H2O\n# R3: CO + 0.5O2 -> CO2\n# R4: N2 + O2 -> 2NO\nNU = np.array([\n    # CH4,   O2,  NO,   CO, CO2, H2O,  N2\n    [-1.0,  0.0, -4.0,  0.0, 1.0, 2.0, 2.0],  # R1\n    [-1.0, -1.5,  0.0,  1.0, 0.0, 2.0, 0.0],  # R2\n    [ 0.0, -0.5,  0.0, -1.0, 1.0, 0.0, 0.0],  # R3\n    [ 0.0, -1.0,  2.0,  0.0, 0.0, 0.0,-1.0],  # R4\n], dtype=np.float64)\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the simulation and optimization for all test cases.\n    \"\"\"\n    # Universal constants and model parameters\n    RU = 8.314  # J/(mol.K)\n    P = 101325.0  # Pa\n    T_AIR = 300.0  # K\n    N2_O2_RATIO = 3.76\n\n    KINETICS = {\n        'A': np.array([2.0e6, 1.0e8, 5.0e6, 4.0e3], dtype=np.float64),\n        'E': np.array([8.0e4, 1.25e5, 7.0e4, 2.8e5], dtype=np.float64)\n    }\n    \n    W_PHI = 100.0\n    W_CO = 1.0e6\n\n    # Test cases defined in the problem\n    test_cases = [\n        {'name': 'A', 'n_f': 1.0, 'phi_r': 1.2, 'phi_l': 0.85, 'phi_q_target': 0.98,\n         'T_r': 1900, 'V': (0.03, 0.05, 0.07),\n         'n_no_in': 5.0e-4, 'y_co_lim': 1.5e-3},\n        {'name': 'B', 'n_f': 1.0, 'phi_r': 1.2, 'phi_l': 0.85, 'phi_q_target': 0.98,\n         'T_r': 1900, 'V': (0.03, 0.05, 0.07),\n         'n_no_in': 5.0e-4, 'y_co_lim': 2.0e-4},\n        {'name': 'C', 'n_f': 1.0, 'phi_r': 1.4, 'phi_l': 0.90, 'phi_q_target': 1.05,\n         'T_r': 2000, 'V': (0.02, 0.04, 0.06),\n         'n_no_in': 1.0e-3, 'y_co_lim': 1.0e-3},\n        {'name': 'D', 'n_f': 1.0, 'phi_r': 1.1, 'phi_l': 0.98, 'phi_q_target': 0.95,\n         'T_r': 1850, 'V': (0.025, 0.035, 0.05),\n         'n_no_in': 3.0e-4, 'y_co_lim': 1.0e-3}\n    ]\n\n    def calculate_rates(C, T):\n        \"\"\"Calculates the reaction rates.\"\"\"\n        C = np.maximum(C, 1e-30) # Floor concentrations to avoid math errors\n        k = KINETICS['A'] * np.exp(-KINETICS['E'] / (RU * T))\n        \n        r1 = k[0] * C[SPECIES_MAP['CH4']] * C[SPECIES_MAP['NO']]\n        r2 = k[1] * C[SPECIES_MAP['CH4']] * C[SPECIES_MAP['O2']]\n        r3 = k[2] * C[SPECIES_MAP['CO']] * C[SPECIES_MAP['O2']]\n        r4 = k[3] * np.sqrt(C[SPECIES_MAP['N2']] * C[SPECIES_MAP['O2']])\n        \n        return np.array([r1, r2, r3, r4])\n\n    def solve_psr(n_dot_in, V, T):\n        \"\"\"Solves the PSR non-linear algebraic equations.\"\"\"\n        def residuals(n_dot_out):\n            n_dot_out_phys = np.maximum(n_dot_out, 0.0)\n            n_dot_total_out = np.sum(n_dot_out_phys)\n            \n            if n_dot_total_out  1e-20:\n                C_out = np.zeros(NUM_SPECIES)\n            else:\n                C_out = (P / (RU * T)) * n_dot_out_phys / n_dot_total_out\n            \n            rates = calculate_rates(C_out, T)\n            R_net = NU.T @ rates\n            \n            return n_dot_in - n_dot_out_phys + V * R_net\n\n        sol = root(residuals, n_dot_in, method='hybr', tol=1e-8)\n        \n        if not sol.success:\n            return None\n        return np.maximum(sol.x, 0.0)\n\n    def objective_function(n_o2_q, params):\n        \"\"\"Simulates the 3-PSR chain and computes the objective function J.\"\"\"\n        n_f = params['n_f']\n        phi_r = params['phi_r']\n        phi_l = params['phi_l']\n        phi_q_target = params['phi_q_target']\n        y_co_lim = params['y_co_lim']\n        T_r = params['T_r']\n        V_r, V_q, V_l = params['V']\n        n_no_in = params['n_no_in']\n\n        # --- Zone R (Rich) ---\n        n_dot_in_r = np.zeros(NUM_SPECIES)\n        n_dot_in_r[SPECIES_MAP['CH4']] = n_f\n        n_o2_r = (2.0 * n_f) / phi_r\n        n_dot_in_r[SPECIES_MAP['O2']] = n_o2_r\n        n_dot_in_r[SPECIES_MAP['N2']] = n_o2_r * N2_O2_RATIO\n        n_dot_in_r[SPECIES_MAP['NO']] = n_no_in\n        \n        n_dot_out_r = solve_psr(n_dot_in_r, V_r, T_r)\n        if n_dot_out_r is None: return 1e12\n\n        # --- Zone Q (Quench) ---\n        n_dot_air_q = np.zeros(NUM_SPECIES)\n        n_dot_air_q[SPECIES_MAP['O2']] = n_o2_q\n        n_dot_air_q[SPECIES_MAP['N2']] = n_o2_q * N2_O2_RATIO\n        \n        n_dot_in_q = n_dot_out_r + n_dot_air_q\n        \n        n_total_out_r = np.sum(n_dot_out_r)\n        n_total_air_q = np.sum(n_dot_air_q)\n        T_q = ((n_total_out_r * T_r) + (n_total_air_q * T_AIR)) / (n_total_out_r + n_total_air_q)\n\n        # Calculate phi_q_mix for penalty term\n        phi_q_num = 2.0 * n_dot_in_q[SPECIES_MAP['CH4']] + 0.5 * n_dot_in_q[SPECIES_MAP['CO']]\n        phi_q_den = n_dot_in_q[SPECIES_MAP['O2']] + 1e-30 # Avoid division by zero\n        phi_q_mix = phi_q_num / phi_q_den\n        \n        n_dot_out_q = solve_psr(n_dot_in_q, V_q, T_q)\n        if n_dot_out_q is None: return 1e12\n\n        # --- Zone L (Lean) ---\n        n_o2_total = (2.0 * n_f) / phi_l\n        n_o2_sec = n_o2_total - n_o2_r\n        n_o2_l = n_o2_sec - n_o2_q\n\n        n_dot_air_l = np.zeros(NUM_SPECIES)\n        if n_o2_l > 0:\n            n_dot_air_l[SPECIES_MAP['O2']] = n_o2_l\n            n_dot_air_l[SPECIES_MAP['N2']] = n_o2_l * N2_O2_RATIO\n\n        n_dot_in_l = n_dot_out_q + n_dot_air_l\n        \n        n_total_out_q = np.sum(n_dot_out_q)\n        n_total_air_l = np.sum(n_dot_air_l)\n        T_l = ((n_total_out_q * T_q) + (n_total_air_l * T_AIR)) / (n_total_out_q + n_total_air_l)\n\n        n_dot_out_l = solve_psr(n_dot_in_l, V_l, T_l)\n        if n_dot_out_l is None: return 1e12\n        \n        # --- Calculate Objective J ---\n        n_dot_total_out_l = np.sum(n_dot_out_l)\n        y_hat_out_l = n_dot_out_l / (n_dot_total_out_l + 1e-30)\n        \n        y_no_out = y_hat_out_l[SPECIES_MAP['NO']]\n        y_co_out = y_hat_out_l[SPECIES_MAP['CO']]\n        \n        penalty_phi = W_PHI * (phi_q_mix - phi_q_target)**2\n        penalty_co = W_CO * (np.maximum(0, y_co_out - y_co_lim))**2\n        \n        J = y_no_out + penalty_phi + penalty_co\n\n        return J\n\n    results = []\n    for case in test_cases:\n        # Calculate optimization bounds\n        n_f = case['n_f']\n        phi_r = case['phi_r']\n        phi_l = case['phi_l']\n        \n        n_o2_r = (2.0 * n_f) / phi_r\n        n_o2_total = (2.0 * n_f) / phi_l\n        n_o2_sec = max(0, n_o2_total - n_o2_r)\n        \n        bounds_n_o2_q = (0, n_o2_sec)\n\n        # Run optimization\n        opt_result = minimize_scalar(\n            objective_function,\n            args=(case,),\n            method='bounded',\n            bounds=bounds_n_o2_q,\n            options={'xatol': 1e-8, 'maxiter': 500}\n        )\n        \n        results.append(opt_result.x)\n\n    # Format and print the final results\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}