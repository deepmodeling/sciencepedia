{
    "hands_on_practices": [
        {
            "introduction": "热力$NO$是高温燃烧过程中$N_2$氧化的主要产物。在设计任何$NO_x$控制策略之前，首要步骤是理解其生成的热力学极限。本练习  旨在通过基本热力学原理和NASA多项式等标准数据格式，计算$NO$的平衡浓度。这项实践为理解温度和氧气浓度等因素如何驱动$NO$生成奠定了基础。",
            "id": "4045106",
            "problem": "高温下的化学计量甲烷-空气火焰通过扩展的Zeldovich机理生成热力型一氧化氮。考虑被称为Zeldovich机理的一对可逆基元反应：$\\,\\mathrm{O} + \\mathrm{N_2} \\rightleftharpoons \\mathrm{NO} + \\mathrm{N}\\,$ 和 $\\,\\mathrm{N} + \\mathrm{O_2} \\rightleftharpoons \\mathrm{NO} + \\mathrm{O}\\,$。根据理想气体近似下的质量作用定律，将这两个反应合并得到总可逆反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}\\,$，其在标准态下定义的平衡常数为 $K_p(T)$。理想气体平衡常数由热力学得到，为 $K_p(T) = \\exp\\!\\left(-\\Delta G^\\circ(T)/(R T)\\right)$，其中 $\\Delta G^\\circ(T)$ 是在温度 $T$ 下的标准吉布斯自由能变，$R$ 是普适气体常数，$T$ 是绝对温度。在理想气体中，分压为 $p_i = y_i P$，其中 $y_i$ 是摩尔分数，$P$ 是总压力。对于总反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}\\,$，一氧化氮的平衡摩尔分数满足\n$$\\frac{(p_{\\mathrm{NO}})^2}{p_{\\mathrm{N_2}}\\,p_{\\mathrm{O_2}}} = K_p(T),\\quad\\text{所以}\\quad y_{\\mathrm{NO}} = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}}.$$\n假设一个由 $\\mathrm{N_2}$、$\\mathrm{O_2}$、$\\mathrm{H_2O}$ 和 $\\mathrm{CO_2}$ 组成的理想气体火焰后混合物，其温度为 $T=2200\\ \\mathrm{K}$，压力为 $P=1\\ \\mathrm{atm}$。为计算 $K_p(T)$，请使用标准热化学方法，并采用NASA七系数多项式形式来表示物种在高温范围内的标准态性质。对于每个物种，无量纲的定压热容、焓和熵由以下公式给出\n$$\\frac{c_p^\\circ(T)}{R} = a_1 + a_2 T + a_3 T^2 + a_4 T^3 + a_5 T^4,$$\n$$\\frac{h^\\circ(T)}{R T} = a_1 + \\frac{a_2 T}{2} + \\frac{a_3 T^2}{3} + \\frac{a_4 T^3}{4} + \\frac{a_5 T^4}{5} + \\frac{a_6}{T},$$\n$$\\frac{s^\\circ(T)}{R} = a_1 \\ln T + a_2 T + \\frac{a_3 T^2}{2} + \\frac{a_4 T^3}{3} + \\frac{a_5 T^4}{4} + a_7,$$\n而无量纲吉布斯自由能为 $g^\\circ(T)/(R T) = h^\\circ(T)/(R T) - s^\\circ(T)/R$。反应 $\\,\\mathrm{N_2} + \\mathrm{O_2} \\to 2\\,\\mathrm{NO}\\,$ 的标准吉布斯自由能变为\n$$\\frac{\\Delta G^\\circ(T)}{R T} = 2\\,\\frac{g^\\circ_{\\mathrm{NO}}(T)}{R T} - \\frac{g^\\circ_{\\mathrm{N_2}}(T)}{R T} - \\frac{g^\\circ_{\\mathrm{O_2}}(T)}{R T},$$\n从而得到 $K_p(T) = \\exp\\!\\left(-\\Delta G^\\circ(T)/(R T)\\right)$。请使用以下适用于物种的高温NASA多项式系数 $(a_1,\\ldots,a_7)$，其有效温度范围为 $T \\in [1000,6000]\\ \\mathrm{K}$：\n- 对于 $\\mathrm{N_2}$：$a_1=2.95257626$，$a_2=1.39690040\\times 10^{-3}$，$a_3=-4.92631603\\times 10^{-7}$，$a_4=7.86010367\\times 10^{-11}$，$a_5=-4.60755321\\times 10^{-15}$，$a_6=-9.23948688\\times 10^{2}$，$a_7=5.87188762$。\n- 对于 $\\mathrm{O_2}$：$a_1=3.28253784$，$a_2=1.48308754\\times 10^{-3}$，$a_3=-7.57966669\\times 10^{-7}$，$a_4=2.09470555\\times 10^{-10}$，$a_5=-2.16717794\\times 10^{-14}$，$a_6=-1.08845772\\times 10^{3}$，$a_7=5.45323129$。\n- 对于 $\\mathrm{NO}$：$a_1=2.26071716$，$a_2=1.19110565\\times 10^{-3}$，$a_3=-4.29170406\\times 10^{-7}$，$a_4=6.94576690\\times 10^{-11}$，$a_5=-4.03223084\\times 10^{-15}$，$a_6=9.84444553\\times 10^{2}$，$a_7=6.33965101$。\n假设再燃通过碳氢化合物喷射消耗一部分 $\\mathrm{O_2}$，从而减少了Zeldovich机理可用的有效氧化剂。通过有效氧气摩尔分数 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 来对此建模，其中 $\\chi \\in [0,1]$ 是再燃强度参数（$\\chi=0$ 表示无再燃，$\\chi$ 接近 $1$ 表示强烈的再燃，几乎消除了可用于热力生成 $\\mathrm{NO}$ 的 $\\mathrm{O_2}$）。在此模型下，一氧化氮的平衡摩尔分数为\n$$y_{\\mathrm{NO}}(T) = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}^{\\mathrm{eff}}}.$$\n所有摩尔分数必须以无单位的小数形式提供；输出也必须是相同的无单位小数形式。对于此问题，取 $T=2200\\ \\mathrm{K}$ 和 $P=1\\ \\mathrm{atm}$，并为以下五个测试案例计算 $y_{\\mathrm{NO}}$，这些案例旨在探究基准行为、稀燃条件以及再燃引起的减少：\n- 案例1（基准燃烧，少量残余 $\\mathrm{O_2}$）：$y_{\\mathrm{N_2}}=0.740$，$y_{\\mathrm{O_2}}=0.010$，$y_{\\mathrm{CO_2}}=0.090$，$y_{\\mathrm{H_2O}}=0.160$，$\\chi=0.000$。\n- 案例2（近乎无氧，边界条件）：$y_{\\mathrm{N_2}}=0.740$，$y_{\\mathrm{O_2}}=0.000$，$y_{\\mathrm{CO_2}}=0.090$，$y_{\\mathrm{H_2O}}=0.170$，$\\chi=0.000$。\n- 案例3（稀燃火焰后，$\\mathrm{O_2}$ 含量升高）：$y_{\\mathrm{N_2}}=0.700$，$y_{\\mathrm{O_2}}=0.050$，$y_{\\mathrm{CO_2}}=0.080$，$y_{\\mathrm{H_2O}}=0.170$，$\\chi=0.000$。\n- 案例4（中等强度再燃）：$y_{\\mathrm{N_2}}=0.740$，$y_{\\mathrm{O_2}}=0.010$，$y_{\\mathrm{CO_2}}=0.090$，$y_{\\mathrm{H_2O}}=0.160$，$\\chi=0.500$。\n- 案例5（强烈再燃）：$y_{\\mathrm{N_2}}=0.740$，$y_{\\mathrm{O_2}}=0.010$，$y_{\\mathrm{CO_2}}=0.090$，$y_{\\mathrm{H_2O}}=0.160$，$\\chi=0.950$。\n您的程序必须在 $T=2200\\ \\mathrm{K}$ 时，根据提供的NASA多项式系数计算 $K_p(T)$，然后使用 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 计算每个案例的 $y_{\\mathrm{NO}}$。最终输出必须是单行文本，包含五个结果，以逗号分隔并用方括号括起，顺序与测试案例一致。每个条目应为 $y_{\\mathrm{NO}}$ 的浮点值（无单位小数）。例如，输出形式应为 $\\,[\\alpha_1,\\alpha_2,\\alpha_3,\\alpha_4,\\alpha_5]$，其中每个 $\\alpha_i$ 是为案例 $i$ 计算出的摩尔分数。",
            "solution": "该问题要求计算在五个涉及组分和再燃强度变化的不同案例中，火焰后气体混合物中一氧化氮的平衡摩尔分数 $y_{\\mathrm{NO}}$。该计算基于化学热力学原理和热力型 $\\mathrm{NO}$ 生成的Zeldovich机理。整个过程可以分解为一系列步骤，从使用所提供的数据根据第一性原理计算热力学性质开始。\n\n温度固定为 $T=2200\\ \\mathrm{K}$，压力固定为 $P=1\\ \\mathrm{atm}$。计算的基础是总反应 $\\mathrm{N_2} + \\mathrm{O_2} \\rightleftharpoons 2\\,\\mathrm{NO}$ 的平衡。该反应的平衡常数 $K_p(T)$ 与平衡时各物种的摩尔分数相关。问题提供了一个简化的 $\\mathrm{NO}$ 平衡摩尔分数模型：\n$$y_{\\mathrm{NO}}(T) = \\sqrt{K_p(T)\\,y_{\\mathrm{N_2}}\\,y_{\\mathrm{O_2}}^{\\mathrm{eff}}}$$\n此处，$y_{\\mathrm{N_2}}$ 是氮气的摩尔分数，$y_{\\mathrm{O_2}}^{\\mathrm{eff}}$ 是可用于热力型 $\\mathrm{NO}$ 生成的有效氧气摩尔分数，由 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$ 给出，其中 $\\chi$ 是再燃强度参数。该公式假设 $\\mathrm{NO}$ 是一种痕量物种，其生成不会显著改变主要物种 $\\mathrm{N_2}$ 和 $\\mathrm{O_2}$ 的摩尔分数。\n\n首要任务是先确定在 $T=2200\\ \\mathrm{K}$ 时平衡常数 $K_p(T)$ 的值。根据化学热力学，$K_p(T)$ 通过以下方程与反应的标准吉布斯自由能变 $\\Delta G^\\circ(T)$ 相关：\n$$K_p(T) = \\exp\\left(-\\frac{\\Delta G^\\circ(T)}{R T}\\right)$$\n其中 $R$ 是普适气体常数。无量纲量 $\\Delta G^\\circ(T)/(R T)$ 由反应物和产物的标准态无量纲吉布斯自由能计算得出：\n$$\\frac{\\Delta G^\\circ(T)}{R T} = \\sum_i \\nu_i \\frac{g_i^\\circ(T)}{R T} = 2 \\left(\\frac{g^\\circ_{\\mathrm{NO}}(T)}{R T}\\right) - 1 \\left(\\frac{g^\\circ_{\\mathrm{N_2}}(T)}{R T}\\right) - 1 \\left(\\frac{g^\\circ_{\\mathrm{O_2}}(T)}{R T}\\right)$$\n其中 $\\nu_i$ 是反应 $\\mathrm{N_2} + \\mathrm{O_2} - 2\\,\\mathrm{NO} = 0$ 的化学计量系数。\n\n每个物种 $i$ 的无量纲标准态吉布斯自由能 $g_i^\\circ(T)/(R T)$ 由其标准态无量纲焓 $h_i^\\circ(T)/(R T)$ 和熵 $s_i^\\circ(T)/R$ 确定：\n$$\\frac{g_i^\\circ(T)}{R T} = \\frac{h_i^\\circ(T)}{R T} - \\frac{s_i^\\circ(T)}{R}$$\n\n问题提供了NASA七系数多项式形式来计算这些热力学性质。对于给定的温度 $T$ 和一组物种特定的系数 $(a_1, a_2, a_3, a_4, a_5, a_6, a_7)$，焓和熵的计算如下：\n$$\\frac{h^\\circ(T)}{R T} = a_1 + \\frac{a_2 T}{2} + \\frac{a_3 T^2}{3} + \\frac{a_4 T^3}{4} + \\frac{a_5 T^4}{5} + \\frac{a_6}{T}$$\n$$\\frac{s^\\circ(T)}{R} = a_1 \\ln T + a_2 T + \\frac{a_3 T^2}{2} + \\frac{a_4 T^3}{3} + \\frac{a_5 T^4}{4} + a_7$$\n\n算法步骤如下：\n1.  对于反应中涉及的每个物种（$\\mathrm{N_2}$、$\\mathrm{O_2}$、$\\mathrm{NO}$），使用其特定的NASA系数集和给定温度 $T=2200\\ \\mathrm{K}$ 来计算 $h_i^\\circ(T)/(R T)$ 和 $s_i^\\circ(T)/R$。\n2.  对于每个物种，通过从无量纲焓中减去无量纲熵来计算 $g_i^\\circ(T)/(R T)$。\n3.  计算反应的总无量纲吉布斯自由能变 $\\Delta G^\\circ(T)/(R T)$。\n4.  计算平衡常数 $K_p(T) = \\exp(-\\Delta G^\\circ(T)/(R T))$。\n5.  对于五个测试案例中的每一个：\n    a. 使用提供的 $y_{\\mathrm{N_2}}$、$y_{\\mathrm{O_2}}$ 和 $\\chi$ 的值。\n    b. 计算有效氧气摩尔分数 $y_{\\mathrm{O_2}}^{\\mathrm{eff}} = (1 - \\chi)\\,y_{\\mathrm{O_2}}$。\n    c. 计算一氧化氮的平衡摩尔分数 $y_{\\mathrm{NO}} = \\sqrt{K_p(T) \\cdot y_{\\mathrm{N_2}} \\cdot y_{\\mathrm{O_2}}^{\\mathrm{eff}}}$。\n6.  收集五个得到的 $y_{\\mathrm{NO}}$ 值，并将它们格式化为方括号内以逗号分隔的列表。\n\n此计算程序被实施以求解五个指定的案例。对于案例2，其中 $y_{\\mathrm{O_2}}=0$，由于氧气是必需的反应物，无需复杂计算即可明显看出 $y_{\\mathrm{NO}}$ 将为 $0$。其他案例展示了热力型 $\\mathrm{NO}$ 的生成对反应物浓度的依赖性，以及再燃作为一种减排策略的有效性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the equilibrium mole fraction of nitric oxide (NO) for several\n    post-flame gas mixture cases based on the Zeldovich mechanism.\n\n    The calculation involves:\n    1. Computing thermodynamic properties (enthalpy, entropy, Gibbs free energy)\n       for N2, O2, and NO using NASA 7-coefficient polynomials.\n    2. Determining the equilibrium constant K_p(T) for the reaction N2 + O2 = 2NO.\n    3. Applying a reburning model to calculate the effective O2 mole fraction.\n    4. Calculating the equilibrium NO mole fraction for each test case.\n    \"\"\"\n    T = 2200.0  # Temperature in Kelvin\n\n    # NASA 7-coefficient polynomial data for the high-temperature range\n    # (a1, a2, a3, a4, a5, a6, a7)\n    nasa_coeffs = {\n        'N2': (2.95257626E+00, 1.39690040E-03, -4.92631603E-07,\n               7.86010367E-11, -4.60755321E-15, -9.23948688E+02,\n               5.87188762E+00),\n        'O2': (3.28253784E+00, 1.48308754E-03, -7.57966669E-07,\n               2.09470555E-10, -2.16717794E-14, -1.08845772E+03,\n               5.45323129E+00),\n        'NO': (2.26071716E+00, 1.19110565E-03, -4.29170406E-07,\n               6.94576690E-11, -4.03223084E-15, 9.84444553E+02,\n               6.33965101E+00)\n    }\n\n    def calculate_g_over_RT(T, coeffs):\n        \"\"\"\n        Calculates the dimensionless standard-state Gibbs free energy g_i/(RT)\n        for a species at temperature T.\n        \"\"\"\n        a1, a2, a3, a4, a5, a6, a7 = coeffs\n        T2 = T * T\n        T3 = T2 * T\n        T4 = T3 * T\n\n        # Dimensionless standard-state enthalpy h/(RT)\n        h_over_RT = (a1 + a2 * T / 2.0 + a3 * T2 / 3.0 + a4 * T3 / 4.0 +\n                     a5 * T4 / 5.0 + a6 / T)\n\n        # Dimensionless standard-state entropy s/R\n        s_over_R = (a1 * np.log(T) + a2 * T + a3 * T2 / 2.0 + a4 * T3 / 3.0 +\n                    a5 * T4 / 4.0 + a7)\n        \n        # Dimensionless standard-state Gibbs free energy g/(RT) = h/(RT) - s/R\n        return h_over_RT - s_over_R\n\n    # Calculate g/(RT) for each species at T = 2200 K\n    g_over_RT_N2 = calculate_g_over_RT(T, nasa_coeffs['N2'])\n    g_over_RT_O2 = calculate_g_over_RT(T, nasa_coeffs['O2'])\n    g_over_RT_NO = calculate_g_over_RT(T, nasa_coeffs['NO'])\n\n    # Calculate dimensionless Gibbs free energy change for N2 + O2 = 2NO\n    # DeltaG/(RT) = sum(nu_i * g_i/(RT))\n    # nu_i are stoichiometric coefficients: 2 for NO, -1 for N2, -1 for O2\n    delta_g_over_RT = 2.0 * g_over_RT_NO - g_over_RT_N2 - g_over_RT_O2\n\n    # Calculate the equilibrium constant K_p\n    # K_p = exp(-DeltaG/(RT))\n    Kp = np.exp(-delta_g_over_RT)\n\n    # Test cases from the problem statement\n    # Each tuple: (y_N2, y_O2, chi)\n    test_cases = [\n        (0.740, 0.010, 0.000),  # Case 1\n        (0.740, 0.000, 0.000),  # Case 2\n        (0.700, 0.050, 0.000),  # Case 3\n        (0.740, 0.010, 0.500),  # Case 4\n        (0.740, 0.010, 0.950),  # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        y_N2, y_O2, chi = case\n        \n        # Calculate effective O2 mole fraction\n        y_O2_eff = (1.0 - chi) * y_O2\n        \n        # Argument for the square root must be non-negative\n        arg = Kp * y_N2 * y_O2_eff\n        if arg  0:\n             # Should not happen with valid inputs but good practice\n             arg = 0.0\n        \n        # Calculate equilibrium NO mole fraction\n        y_NO = np.sqrt(arg)\n        results.append(y_NO)\n\n    # Format and print the final output as a single-line list of floats\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在了解了热力学平衡之后，我们将注意力转向动力学控制的$NO_x$减排技术。选择性非催化还原（SNCR）是一种关键的后燃烧$NO_x$控制方法。本练习  在一个平推流反应器（PFR）中模拟SNCR过程，将重点从静态平衡转向动态的、受速率控制的化学转化。学生将通过求解耦合的常微分方程组，来掌握对反应动力学、流体输运和混合相互作用进行建模的核心技能。",
            "id": "4045109",
            "problem": "考虑一个用于通过注入氨来还原氮氧化物的一维平推流反应器 (PFR)，该过程正式称为选择性非催化还原 (SNCR)。一股含有氮氧化物 (NO) 的流体以恒定的轴向速度 $u$ (单位 $\\mathrm{m}\\,\\mathrm{s}^{-1}$) 流过一个长度为 $L$ (单位 $\\mathrm{m}$) 的反应器，其入口浓度为 $C_{\\mathrm{NO},\\mathrm{in}}$ (单位 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$)。在轴向位置 $x_0$ (单位 $\\mathrm{m}$)，氨 (NH$_3$) 作为点式添加物注入主流中，在每个穿过 $x_0$ 的流体元中建立一个初始未混合的氨浓度 $C_{\\mathrm{NH}_3,\\mathrm{target}}$ (单位 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$)。$x_0$ 下游的湍流微观混合被建模为一个未混合氨池和一个混合反应池之间的一阶交换过程，其特征混合时间为 $t_{\\mathrm{mix}}$ (单位 $\\mathrm{s}$)。气体温度沿反应器呈已知函数 $T(x)$ (单位 $\\mathrm{K}$) 变化。假设压力恒定且轴向扩散可忽略，这与 PFR 近似一致。\n\n在 SNCR 建模中采用以下广泛使用的动力学简化：期望的还原反应对氮氧化物和混合氨是二阶的，并具有 Arrhenius 温度依赖性；一个不期望的混合氨的一阶消耗反应（其自身也遵循 Arrhenius 定律）则概括了净副反应（例如，热氧化或自由基引发的损失）。具体来说，设反应速率为\n$$r_1(T,C_{\\mathrm{NO}},C_{\\mathrm{NH}_3,\\mathrm{m}}) = k_1(T)\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}},\\quad k_1(T) = A_1\\,\\exp\\!\\left(-\\frac{E_1}{R\\,T}\\right),$$\n$$r_2(T,C_{\\mathrm{NH}_3,\\mathrm{m}}) = k_2(T)\\,C_{\\mathrm{NH}_3,\\mathrm{m}},\\quad k_2(T) = A_2\\,\\exp\\!\\left(-\\frac{E_2}{R\\,T}\\right),$$\n其中 $R$ 是普适气体常数 (单位 $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$)，$A_1$ (单位 $\\mathrm{m}^3\\,\\mathrm{mol}^{-1}\\,\\mathrm{s}^{-1}$) 和 $E_1$ (单位 $\\mathrm{J}\\,\\mathrm{mol}^{-1}$) 分别是期望反应的指前因子和活化能，$A_2$ (单位 $\\mathrm{s}^{-1}$) 和 $E_2$ (单位 $\\mathrm{J}\\,\\mathrm{mol}^{-1}$) 是不期望的消耗反应的相应参数。\n\n将轴向坐标 $x$ 通过 $t = x/u$ 映射到拉格朗日停留时间 $t$。对于 $t  t_0 \\equiv x_0/u$，注入的氨浓度为零。在 $t = t_0$ 时，未混合氨的浓度瞬时设置为 $C_{\\mathrm{NH}_3,\\mathrm{u}}(t_0^+) = C_{\\mathrm{NH}_3,\\mathrm{target}}$，而混合氨的浓度为 $C_{\\mathrm{NH}_3,\\mathrm{m}}(t_0^+) = 0$。对于 $t \\ge t_0$，混合和反应根据质量作用定律进行，遵循以下耦合常微分方程，\n$$\\frac{dC_{\\mathrm{NO}}}{dt} = -\\,k_1\\!\\left(T(u\\,t)\\right)\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}},$$\n$$\\frac{dC_{\\mathrm{NH}_3,\\mathrm{m}}}{dt} = \\frac{1}{t_{\\mathrm{mix}}}\\,C_{\\mathrm{NH}_3,\\mathrm{u}} \\,-\\,k_1\\!\\left(T(u\\,t)\\right)\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}} \\,-\\,k_2\\!\\left(T(u\\,t)\\right)\\,C_{\\mathrm{NH}_3,\\mathrm{m}},$$\n$$\\frac{dC_{\\mathrm{NH}_3,\\mathrm{u}}}{dt} = -\\,\\frac{1}{t_{\\mathrm{mix}}}\\,C_{\\mathrm{NH}_3,\\mathrm{u}},$$\n其反应器入口 $t=0$ 处的初始条件为 $C_{\\mathrm{NO}}(0) = C_{\\mathrm{NO},\\mathrm{in}}$，$C_{\\mathrm{NH}_3,\\mathrm{m}}(0) = 0$，$C_{\\mathrm{NH}_3,\\mathrm{u}}(0) = 0$。这些方程符合注入氨在混合和反应汇作用下的守恒定律，以及将轴向位置与时间相关联的 PFR 近似。\n\n将实现的氮氧化物还原定义为无量纲分数\n$$\\phi = \\frac{C_{\\mathrm{NO},\\mathrm{in}} - C_{\\mathrm{NO}}(t_{\\mathrm{final}})}{C_{\\mathrm{NO},\\mathrm{in}}},$$\n其中 $t_{\\mathrm{final}} = L/u$ 是出口停留时间。将出口处的氨逃逸定义为\n$$S_{\\mathrm{NH}_3} = C_{\\mathrm{NH}_3,\\mathrm{m}}(t_{\\mathrm{final}}) + C_{\\mathrm{NH}_3,\\mathrm{u}}(t_{\\mathrm{final}}),$$\n单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$。你的任务是通过使用指定参数对上述系统进行积分，为以下每个测试用例计算 $\\phi$ 和 $S_{\\mathrm{NH}_3}$。使用普适气体常数 $R = 8.314\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$，期望反应参数 $A_1 = 2.0\\times 10^7\\,\\mathrm{m}^3\\,\\mathrm{mol}^{-1}\\,\\mathrm{s}^{-1}$ 和 $E_1 = 6.5\\times 10^4\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}$，以及副反应参数 $A_2 = 1.0\\times 10^5\\,\\mathrm{s}^{-1}$ 和 $E_2 = 9.0\\times 10^4\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}$。对于每个测试用例，将温度指定为二次分布 $T(x) = T_0 + a\\,x - b\\,x^2$，其中 $x$ 的单位是 $\\mathrm{m}$， $T$ 的单位是 $\\mathrm{K}$。目标注入氨浓度相对于入口氮氧化物按化学计量设定为 $C_{\\mathrm{NH}_3,\\mathrm{target}} = \\alpha\\,C_{\\mathrm{NO},\\mathrm{in}}$，其中 $\\alpha$ 为给定值。\n\n测试套件（每行表示 $(L, u, x_0, t_{\\mathrm{mix}}, T_0, a, b, C_{\\mathrm{NO},\\mathrm{in}}, \\alpha)$，使用所述单位）：\n- 用例 1： $(10, 2, 4, 0.5, 950, 60, 4, 0.002, 1.1)$。\n- 用例 2： $(10, 2, 9, 0.5, 950, 60, 4, 0.002, 1.1)$。\n- 用例 3： $(10, 2, 4, 3.0, 950, 60, 4, 0.002, 1.1)$。\n- 用例 4： $(10, 2, 4, 0.5, 900, 20, 2, 0.002, 1.1)$。\n- 用例 5： $(10, 2, 0, 0.5, 950, 60, 4, 0.002, 1.1)$。\n\n你的程序必须：\n- 使用提供的动力学模型和温度分布，实现上述耦合常微分方程。\n- 按照规定，在 $t=t_0$ 时进行瞬时氨注入，并从 $t=0$ 积分到 $t=t_{\\mathrm{final}}$。\n- 对于每个测试用例，计算氮氧化物还原分数 $\\phi$（无量纲，以小数表示）和氨逃逸 $S_{\\mathrm{NH}_3}$（以 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$ 表示）。\n- 生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个测试用例的结果报告为一个双元素列表 $[\\phi, S_{\\mathrm{NH}_3}]$。\n\n科学真实性要求：通过强制当任何反应物浓度因数值误差而将变为负值时其相关反应速率为零，来确保所有计算出的浓度保持非负。\n\n角度单位不适用。必须遵守上述物理单位。",
            "solution": "用户提供了一个有科学依据、适定且客观的问题。它描述了一个标准的化学工程问题，涉及平推流反应器 (PFR) 中用于选择性非催化还原 (SNCR) 氮氧化物的反应动力学和输运过程。该模型基于已建立的质量守恒和 Arrhenius 动力学原理。常微分方程 (ODE) 系统定义清晰，所有必要的参数、初始条件和一个离散事件（氨注入）都已指定。问题是自洽的，没有矛盾或歧义。因此，该问题被认为是有效的，并将提供一个解决方案。\n\n该问题要求计算 PFR 出口处的氮氧化物还原效率 $\\phi$ 和氨逃逸 $S_{\\mathrm{NH}_3}$。这涉及到求解一个耦合 ODE 系统，该系统模拟了氮氧化物 ($C_{\\mathrm{NO}}$)、混合氨 ($C_{\\mathrm{NH}_3,\\mathrm{m}}$) 和未混合氨 ($C_{\\mathrm{NH}_3,\\mathrm{u}}$) 的浓度。\n\n问题给出了流体包裹中浓度随时间演化的控制方程，其中停留时间 $t$ 与轴向位置 $x$ 的关系为 $t = x/u$。该系统是：\n$$\n\\frac{dC_{\\mathrm{NO}}}{dt} = -k_1(T(ut))\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}}\n$$\n$$\n\\frac{dC_{\\mathrm{NH}_3,\\mathrm{m}}}{dt} = \\frac{1}{t_{\\mathrm{mix}}}\\,C_{\\mathrm{NH}_3,\\mathrm{u}} -k_1(T(ut))\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}} - k_2(T(ut))\\,C_{\\mathrm{NH}_3,\\mathrm{m}}\n$$\n$$\n\\frac{dC_{\\mathrm{NH}_3,\\mathrm{u}}}{dt} = -\\frac{1}{t_{\\mathrm{mix}}}\\,C_{\\mathrm{NH}_3,\\mathrm{u}}\n$$\n速率常数 $k_1$ 和 $k_2$ 由 Arrhenius 定律给出：\n$$\nk_1(T) = A_1\\,\\exp\\left(-\\frac{E_1}{R\\,T}\\right) \\quad \\text{和} \\quad k_2(T) = A_2\\,\\exp\\left(-\\frac{E_2}{R\\,T}\\right)\n$$\n温度分布为 $T(x) = T_0 + a\\,x - b\\,x^2$。在拉格朗日框架中，这变为 $T(t) = T_0 + a(ut) - b(ut)^2$。\n\n该过程从 $t=0$ 开始，初始条件为 $C_{\\mathrm{NO}}(0) = C_{\\mathrm{NO},\\mathrm{in}}$，$C_{\\mathrm{NH}_3,\\mathrm{m}}(0) = 0$ 和 $C_{\\mathrm{NH}_3,\\mathrm{u}}(0) = 0$。由于氨物种的源项为零，这些浓度在到达注入点时间 $t_0 = x_0/u$ 之前保持为零。在 $t=t_0$ 时，根据问题描述，系统状态发生不连续变化：\n$C_{\\mathrm{NO}}(t_0^+) = C_{\\mathrm{NO}}(t_0^-) = C_{\\mathrm{NO},\\mathrm{in}}$\n$C_{\\mathrm{NH}_3,\\mathrm{m}}(t_0^+) = 0$\n$C_{\\mathrm{NH}_3,\\mathrm{u}}(t_0^+) = C_{\\mathrm{NH}_3,\\mathrm{target}} = \\alpha \\, C_{\\mathrm{NO},\\mathrm{in}}$\n\n因此，ODE 系统的积分仅需在时间区间 $[t_0, t_{\\mathrm{final}}]$ 上进行，其中 $t_{\\mathrm{final}} = L/u$。\n\n第三个关于未混合氨的 ODE，$\\frac{dC_{\\mathrm{NH}_3,\\mathrm{u}}}{dt} = -\\frac{1}{t_{\\mathrm{mix}}}\\,C_{\\mathrm{NH}_3,\\mathrm{u}}$，是一个可以解析求解的线性一阶方程。在初始条件 $C_{\\mathrm{NH}_3,\\mathrm{u}}(t_0) = C_{\\mathrm{NH}_3,\\mathrm{target}}$ 下，对于 $t \\ge t_0$ 的解是：\n$$\nC_{\\mathrm{NH}_3,\\mathrm{u}}(t) = C_{\\mathrm{NH}_3,\\mathrm{target}} \\exp\\left(-\\frac{t-t_0}{t_{\\mathrm{mix}}}\\right)\n$$\n这个解析解可以代入第二个 ODE，通过将系统从三个耦合 ODE 减少到两个，从而简化了数值计算任务：\n$$\n\\frac{dC_{\\mathrm{NO}}}{dt} = -k_1(T(ut))\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}}\n$$\n$$\n\\frac{dC_{\\mathrm{NH}_3,\\mathrm{m}}}{dt} = \\frac{C_{\\mathrm{NH}_3,\\mathrm{target}}}{t_{\\mathrm{mix}}} \\exp\\left(-\\frac{t-t_0}{t_{\\mathrm{mix}}}\\right) - k_1(T(ut))\\,C_{\\mathrm{NO}}\\,C_{\\mathrm{NH}_3,\\mathrm{m}} - k_2(T(ut))\\,C_{\\mathrm{NH}_3,\\mathrm{m}}\n$$\n这个简化后的系统需求解状态向量 $\\mathbf{y}(t) = [C_{\\mathrm{NO}}(t), C_{\\mathrm{NH}_3,\\mathrm{m}}(t)]^T$，求解区间为 $t \\in [t_0, t_{\\mathrm{final}}]$，在 $t=t_0$ 时的初始条件为：\n$$\n\\mathbf{y}(t_0) = [C_{\\mathrm{NO},\\mathrm{in}}, 0]^T\n$$\n由于化学动力学中典型的时间尺度范围很广，该系统是刚性的，需要一个合适的数值积分器。`scipy.integrate.solve_ivp` 函数使用像 'LSODA' 这样的方法非常适合此目的。根据问题规定，通过确保对每个浓度 $C$ 使用 $\\max(0, C)$ 来计算反应速率项，从而强制浓度的非负性。\n\n对于每个测试用例，算法如下：\n1. 提取参数（$L, u, x_0, t_{\\mathrm{mix}}, T_0, a, b, C_{\\mathrm{NO},\\mathrm{in}}, \\alpha$）和给定常数（$R, A_1, E_1, A_2, E_2$）。\n2. 计算派生参数：$t_0=x_0/u$，$t_{\\mathrm{final}}=L/u$ 和 $C_{\\mathrm{NH}_3,\\mathrm{target}}=\\alpha\\,C_{\\mathrm{NO},\\mathrm{in}}$。\n3. 设置初始条件向量 $\\mathbf{y}(t_0) = [C_{\\mathrm{NO},\\mathrm{in}}, 0]^T$。\n4. 如果 $t_0 \\ge t_{\\mathrm{final}}$，则在反应器内注入后无反应发生。$C_{\\mathrm{NO}}(t_{\\mathrm{final}}) = C_{\\mathrm{NO},\\mathrm{in}}$ 且出口处所有氨浓度均为零。\n5. 如果 $t_0  t_{\\mathrm{final}}$，则从 $t_0$ 到 $t_{\\mathrm{final}}$ 数值积分简化的双变量 ODE 系统。\n6. 从 $t_{\\mathrm{final}}$ 处的数值解中，检索最终浓度 $C_{\\mathrm{NO}}(t_{\\mathrm{final}})$ 和 $C_{\\mathrm{NH}_3,\\mathrm{m}}(t_{\\mathrm{final}})$。\n7. 使用解析解计算最终的未混合氨浓度：$C_{\\mathrm{NH}_3,\\mathrm{u}}(t_{\\mathrm{final}}) = C_{\\mathrm{NH}_3,\\mathrm{target}} \\exp(-(t_{\\mathrm{final}}-t_0)/t_{\\mathrm{mix}})$。\n8. 计算所需的输出指标：\n    - 氮氧化物还原：$\\phi = \\frac{C_{\\mathrm{NO},\\mathrm{in}} - C_{\\mathrm{NO}}(t_{\\mathrm{final}})}{C_{\\mathrm{NO},\\mathrm{in}}}$\n    - 氨逃逸：$S_{\\mathrm{NH}_3} = C_{\\mathrm{NH}_3,\\mathrm{m}}(t_{\\mathrm{final}}) + C_{\\mathrm{NH}_3,\\mathrm{u}}(t_{\\mathrm{final}})$\n9. 存储数据对 $[\\phi, S_{\\mathrm{NH}_3}]$ 并按规定格式化最终输出。\n\n现在将用 Python 实现此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the SNCR problem for a suite of test cases by integrating\n    the governing ODEs.\n    \"\"\"\n    \n    # Universal gas constant and kinetic parameters\n    R = 8.314  # J mol^-1 K^-1\n    A1 = 2.0e7   # m^3 mol^-1 s^-1\n    E1 = 6.5e4   # J mol^-1\n    A2 = 1.0e5   # s^-1\n    E2 = 9.0e4   # J mol^-1\n\n    # Test suite (L, u, x0, t_mix, T0, a, b, C_NO_in, alpha)\n    test_cases = [\n        (10, 2, 4, 0.5, 950, 60, 4, 0.002, 1.1),\n        (10, 2, 9, 0.5, 950, 60, 4, 0.002, 1.1),\n        (10, 2, 4, 3.0, 950, 60, 4, 0.002, 1.1),\n        (10, 2, 4, 0.5, 900, 20, 2, 0.002, 1.1),\n        (10, 2, 0, 0.5, 950, 60, 4, 0.002, 1.1),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, u, x0, t_mix, T0, a, b, C_NO_in, alpha = case\n        \n        # Calculate derived parameters\n        t0 = x0 / u\n        t_final = L / u\n        C_NH3_target = alpha * C_NO_in\n\n        # If injection is at or after the outlet, no reaction occurs\n        if t0 = t_final:\n            phi = 0.0\n            S_NH3 = 0.0\n            results.append([phi, S_NH3])\n            continue\n\n        # Define the system of ODEs for the reduced 2-variable system\n        # This function captures necessary parameters from the current scope\n        def ode_system(t, y):\n            C_NO, C_NH3_m = y\n\n            # Enforce non-negativity as per problem spec\n            C_NO = max(0.0, C_NO)\n            C_NH3_m = max(0.0, C_NH3_m)\n            \n            # Calculate temperature at time t\n            x = u * t\n            T = T0 + a * x - b * x**2\n            \n            # Calculate Arrhenius rate constants\n            k1 = A1 * np.exp(-E1 / (R * T))\n            k2 = A2 * np.exp(-E2 / (R * T))\n            \n            # Source term from unmixed ammonia pool (analytical solution)\n            source_NH3_m = (C_NH3_target / t_mix) * np.exp(-(t - t0) / t_mix)\n            \n            # Reaction rates\n            r1 = k1 * C_NO * C_NH3_m\n            r2 = k2 * C_NH3_m\n            \n            # Derivatives\n            dC_NO_dt = -r1\n            dC_NH3_m_dt = source_NH3_m - r1 - r2\n            \n            return [dC_NO_dt, dC_NH3_m_dt]\n\n        # Initial conditions at injection time t0 for the reduced system\n        y0 = [C_NO_in, 0.0]\n        \n        # Time span for integration\n        t_span = [t0, t_final]\n\n        # Solve the ODE system\n        sol = solve_ivp(\n            ode_system, \n            t_span, \n            y0, \n            method='LSODA', \n            dense_output=True,\n            atol=1e-12, # Absolute tolerance\n            rtol=1e-9   # Relative tolerance\n        )\n        \n        # Extract final concentrations from the solver result\n        C_NO_final = sol.y[0, -1]\n        C_NH3_m_final = sol.y[1, -1]\n        \n        # Calculate final unmixed ammonia concentration from its analytical solution\n        C_NH3_u_final = C_NH3_target * np.exp(-(t_final - t0) / t_mix)\n        \n        # Compute reduction fraction phi\n        phi = (C_NO_in - C_NO_final) / C_NO_in\n        \n        # Compute ammonia slip S_NH3\n        S_NH3 = C_NH3_m_final + C_NH3_u_final\n        \n        results.append([phi, S_NH3])\n\n    # Format the final output string as a list of lists, with no spaces.\n    # e.g., [[val1,val2],[val3,val4]]\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "再燃和空气分级是一种更复杂的系统级$NO_x$减排策略。这项综合性练习  将先前的概念融合成一个系统设计问题，使用一个完美搅拌反应器（PSR）网络来模拟分级燃烧过程。核心任务不仅仅是模拟，而是优化：找到最佳的空气分配方案，以同时最小化$NO$和$CO$的排放。这项实践直接反映了在设计现代低$NO_x$燃烧系统时所面临的多目标工程挑战。",
            "id": "4045182",
            "problem": "您需要使用由三个串联的理想搅拌反应器 (PSR) 构成的链式模型，建立一个氮氧化物 (NOx) 空气分级再燃的计算模型。这三个反应器分别代表富燃再燃区、淬熄混合与反应区以及贫燃燃尽区。该模型必须能捕捉燃料氧化、一氧化碳燃尽以及一氧化氮还原与再生的耦合化学反应，同时在理想气体框架内，在原子守恒的层面上保持热力学一致性。然后，您必须计算最佳的淬熄空气添加量，使淬熄区的当量比接近指定目标值，同时最小化贫燃区出口处的一氧化氮，并使出口处的一氧化碳低于一个限值。最终程序必须按规定的单行列表格式，为每个测试用例输出最佳的淬熄氧气添加量。\n\n请从以下基础开始。\n\n- 稳态理想搅拌反应器 (PSR) 的物种物料衡算：\n$$0 = \\dot{n}_{i,\\mathrm{in}} - \\dot{n}_{i,\\mathrm{out}} + V \\, \\mathcal{R}_i(\\mathbf{C}, T),$$\n其中 $\\dot{n}_{i,\\mathrm{in}}$ 和 $\\dot{n}_{i,\\mathrm{out}}$ 是物种 $i$ 的入口和出口摩尔流率，单位为 $\\mathrm{mol/s}$；$V$ 是反应器体积，单位为 $\\mathrm{m^3}$；$T$ 是反应器温度，单位为 $\\mathrm{K}$；$\\mathbf{C}$ 是出口浓度矢量，单位为 $\\mathrm{mol/m^3}$；$\\mathcal{R}_i$ 是物种 $i$ 的气相净体积生成速率，单位为 $\\mathrm{mol/(m^3 \\cdot s)}$。假设为理想气体，则体积流量为 $\\dot{V} = \\left(\\sum_i \\dot{n}_{i,\\mathrm{out}}\\right) R_u T / P$，其中 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$，压力 $P$ 的单位为 $\\mathrm{Pa}$，且 $C_i = \\dot{n}_{i,\\mathrm{out}} / \\dot{V}$。\n- 空气组分由氧气和氮气指定，氧气的摩尔分数为 $0.21$。空气中氮气与氧气的摩尔比取为 $3.76$。\n- 定义全局反应集和动力学（阿伦尼乌斯形式）如下（物种集合为 $\\{\\mathrm{CH_4}, \\mathrm{O_2}, \\mathrm{NO}, \\mathrm{CO}, \\mathrm{CO_2}, \\mathrm{H_2O}, \\mathrm{N_2}\\}$）：\n  1. 甲烷对一氧化氮的再燃还原反应：\n     $$\\mathrm{CH_4} + 4 \\ \\mathrm{NO} \\rightarrow 2 \\ \\mathrm{N_2} + \\mathrm{CO_2} + 2 \\ \\mathrm{H_2O}, \\quad r_1 = A_1 \\exp\\!\\left(-\\dfrac{E_1}{R_u T}\\right) C_{\\mathrm{CH_4}} C_{\\mathrm{NO}}.$$\n  2. 甲烷在富燃条件下的部分氧化生成一氧化碳：\n     $$\\mathrm{CH_4} + 1.5 \\ \\mathrm{O_2} \\rightarrow \\mathrm{CO} + 2 \\ \\mathrm{H_2O}, \\quad r_2 = A_2 \\exp\\!\\left(-\\dfrac{E_2}{R_u T}\\right) C_{\\mathrm{CH_4}} C_{\\mathrm{O_2}}.$$\n  3. 一氧化碳氧化：\n     $$\\mathrm{CO} + 0.5 \\ \\mathrm{O_2} \\rightarrow \\mathrm{CO_2}, \\quad r_3 = A_3 \\exp\\!\\left(-\\dfrac{E_3}{R_u T}\\right) C_{\\mathrm{CO}} C_{\\mathrm{O_2}}.$$\n  4. 热力型一氧化氮生成（全局化）：\n     $$\\mathrm{N_2} + \\mathrm{O_2} \\rightarrow 2 \\ \\mathrm{NO}, \\quad r_4 = A_4 \\exp\\!\\left(-\\dfrac{E_4}{R_u T}\\right) C_{\\mathrm{O_2}}^{1/2} C_{\\mathrm{N_2}}^{1/2}.$$\n  净源项使用与上述反应一致的化学计量系数进行组合。所有阿伦尼乌斯指前因子和活化能将在下面以数值形式给出。\n\n- 三个串联的 PSR 分别代表：富燃区 ($\\mathrm{R}$)、淬熄区 ($\\mathrm{Q}$) 和贫燃区 ($\\mathrm{L}$)。$\\mathrm{R}$ 区的入口包含甲烷燃料、为达到指定富燃当量比而供给的一次空气，以及代表上游排放的给定一氧化氮流入量。$\\mathrm{Q}$ 区的入口是 $\\mathrm{R}$ 区的出口与淬熄空气理想瞬时混合后的气体；$\\mathrm{L}$ 区的入口是 $\\mathrm{Q}$ 区的出口与足量的贫燃空气混合后的气体，以使全局总当量比达到指定的贫燃目标值。在能量平衡中忽略热量释放，并通过恒定摩尔热容下气流的理想气体焓混合来计算淬熄区和贫燃区的温度，使用摩尔加权温度平均法：\n  $$T_{\\mathrm{mix}} = \\dfrac{\\dot{n}_{\\mathrm{hot}} T_{\\mathrm{hot}} + \\dot{n}_{\\mathrm{cold}} T_{\\mathrm{cold}}}{\\dot{n}_{\\mathrm{hot}} + \\dot{n}_{\\mathrm{cold}}},$$\n  其中 $\\dot{n}$ 表示混合气流的总摩尔流率，$T_{\\mathrm{cold}}$ 是空气温度。\n\n- 对于任意气体混合物，当量比定义为存在的 可燃物种的化学计量氧化剂需求量与可用氧气量之比：\n  $$\\phi = \\dfrac{2 \\ \\dot{n}_{\\mathrm{CH_4}} + 0.5 \\ \\dot{n}_{\\mathrm{CO}}}{\\dot{n}_{\\mathrm{O_2}}},$$\n  其中所有摩尔流量均为所考虑瞬间的混合物流量。对于富燃区的一次进料，一次氧气流量根据指定的富燃当量比 $\\phi_{\\mathrm{R}}$ 和甲烷的化学计量需求（每摩尔 $\\mathrm{CH_4}$ 需 $2$ 摩尔 $\\mathrm{O_2}$）计算：\n  $$\\dot{n}_{\\mathrm{O_2,R}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{F}}}{\\phi_{\\mathrm{R}}}.$$\n  对于全局贫燃目标，所有区域添加的总氧气量为：\n  $$\\dot{n}_{\\mathrm{O_2,total}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{F}}}{\\phi_{\\mathrm{L}}}.$$\n  富燃区之后可用于分级的剩余氧气量为：\n  $$\\dot{n}_{\\mathrm{O_2,sec}} = \\max\\!\\left(0, \\ \\dot{n}_{\\mathrm{O_2,total}} - \\dot{n}_{\\mathrm{O_2,R}}\\right).$$\n\n- 决策变量与目标：选择淬熄氧气添加量 $\\dot{n}_{\\mathrm{O_2,Q}} \\in [0, \\dot{n}_{\\mathrm{O_2,sec}}]$。剩余的二次氧气进入贫燃区，$\\dot{n}_{\\mathrm{O_2,L}} = \\dot{n}_{\\mathrm{O_2,sec}} - \\dot{n}_{\\mathrm{O_2,Q}}$，并伴随有按指定比例的空气中的氮气。根据理想混合的淬熄区入口（反应前）计算出的淬熄区当量比为：\n  $$\\phi_{\\mathrm{Q,mix}} = \\dfrac{2 \\ \\dot{n}_{\\mathrm{CH_4,Q,in}} + 0.5 \\ \\dot{n}_{\\mathrm{CO,Q,in}}}{\\dot{n}_{\\mathrm{O_2,Q,in}}},$$\n  其中入口流量是富燃区出口流量和淬熄空气添加量之和。优化目标是最小化贫燃区出口处的一氧化氮摩尔分数 $\\hat{y}_{\\mathrm{NO,out}}$，同时使 $\\phi_{\\mathrm{Q,mix}}$ 接近目标值 $\\phi_{\\mathrm{Q,target}}$，并强制要求出口一氧化碳摩尔分数不超过指定限值 $\\hat{y}_{\\mathrm{CO,lim}}$。使用可微的惩罚函数形式：\n  $$J(\\dot{n}_{\\mathrm{O_2,Q}}) = \\hat{y}_{\\mathrm{NO,out}} + w_{\\phi}\\left(\\phi_{\\mathrm{Q,mix}} - \\phi_{\\mathrm{Q,target}}\\right)^2 + w_{\\mathrm{CO}} \\, \\max\\!\\left(0, \\ \\hat{y}_{\\mathrm{CO,out}} - \\hat{y}_{\\mathrm{CO,lim}}\\right)^2,$$\n  其中权重 $w_{\\phi}$ 和 $w_{\\mathrm{CO}}$ 在下面给出。\n\n实现上述 PSR 链式模型，通过使用指定的动力学参数满足稳态物种平衡来求解每个 PSR，然后对每个测试用例在 $\\dot{n}_{\\mathrm{O_2,Q}}$ 上执行有界标量最小化。所有流量以 $\\mathrm{mol/s}$ 表示，体积以 $\\mathrm{m^3}$ 表示，压力以 $\\mathrm{Pa}$ 表示，温度以 $\\mathrm{K}$ 表示。所有计算均使用 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。程序必须为每个测试用例返回最佳淬熄氧气添加量 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$，结果为浮点数，四舍五入到六位小数。\n\n所有情况下使用的动力学参数和常数：\n- 通用气体常数：$R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。\n- 压力：$P = 101325 \\ \\mathrm{Pa}$。\n- 空气中氧气摩尔分数：$0.21$；空气中氮氧摩尔比：$3.76$。\n- 空气温度：$T_{\\mathrm{air}} = 300 \\ \\mathrm{K}$。\n- 反应 1 (再燃)：$A_1 = 2.0 \\times 10^{6} \\ \\mathrm{m^3/(mol \\cdot s)}$，$E_1 = 8.0 \\times 10^{4} \\ \\mathrm{J/mol}$。\n- 反应 2 (富燃氧化)：$A_2 = 1.0 \\times 10^{8} \\ \\mathrm{m^3/(mol \\cdot s)}$，$E_2 = 1.25 \\times 10^{5} \\ \\mathrm{J/mol}$。\n- 反应 3 (CO 氧化)：$A_3 = 5.0 \\times 10^{6} \\ \\mathrm{m^3/(mol \\cdot s)}$，$E_3 = 7.0 \\times 10^{4} \\ \\mathrm{J/mol}$。\n- 反应 4 (热力型 NO)：$A_4 = 4.0 \\times 10^{3} \\ \\mathrm{s^{-1}}$，$E_4 = 2.8 \\times 10^{5} \\ \\mathrm{J/mol}$。\n- 惩罚权重：$w_{\\phi} = 100.0$，$w_{\\mathrm{CO}} = 10^{6}$。\n\n测试套件。对于以下每个用例，运行优化并报告最佳 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$ (单位 $\\mathrm{mol/s}$)，四舍五入到六位小数。每个用例定义了燃料流量 $\\dot{n}_{\\mathrm{F}}$ (单位 $\\mathrm{mol/s}$)，富燃区当量比 $\\phi_{\\mathrm{R}}$，贫燃全局目标 $\\phi_{\\mathrm{L}}$，淬熄目标 $\\phi_{\\mathrm{Q,target}}$，富燃区温度 $T_{\\mathrm{R}}$ (单位 $\\mathrm{K}$)，反应器体积 $V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}$ (单位 $\\mathrm{m^3}$)，进入富燃区的入口一氧化氮流量 $\\dot{n}_{\\mathrm{NO,in}}$ (单位 $\\mathrm{mol/s}$)，以及允许的出口一氧化碳摩尔分数限值 $\\hat{y}_{\\mathrm{CO,lim}}$ (无量纲摩尔分数，可表示为小数)。\n\n- 用例 A:\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.2$, $\\phi_{\\mathrm{L}} = 0.85$, $\\phi_{\\mathrm{Q,target}} = 0.98$,\n  - $T_{\\mathrm{R}} = 1900$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.03, 0.05, 0.07)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 5.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.5 \\times 10^{-3}$.\n- 用例 B:\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.2$, $\\phi_{\\mathrm{L}} = 0.85$, $\\phi_{\\mathrm{Q,target}} = 0.98$,\n  - $T_{\\mathrm{R}} = 1900$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.03, 0.05, 0.07)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 5.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 2.0 \\times 10^{-4}$.\n- 用例 C:\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.4$, $\\phi_{\\mathrm{L}} = 0.90$, $\\phi_{\\mathrm{Q,target}} = 1.05$,\n  - $T_{\\mathrm{R}} = 2000$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.02, 0.04, 0.06)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 1.0 \\times 10^{-3}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.0 \\times 10^{-3}$.\n- 用例 D:\n  - $\\dot{n}_{\\mathrm{F}} = 1.0$, $\\phi_{\\mathrm{R}} = 1.1$, $\\phi_{\\mathrm{L}} = 0.98$, $\\phi_{\\mathrm{Q,target}} = 0.95$,\n  - $T_{\\mathrm{R}} = 1850$, $(V_{\\mathrm{R}}, V_{\\mathrm{Q}}, V_{\\mathrm{L}}) = (0.025, 0.035, 0.05)$,\n  - $\\dot{n}_{\\mathrm{NO,in}} = 3.0 \\times 10^{-4}$, $\\hat{y}_{\\mathrm{CO,lim}} = 1.0 \\times 10^{-3}$.\n\n实现要求和输出规范：\n\n- 严格按照描述构建三区 PSR 链式模型，使用给定的反应、动力学和混合规则。对于每个区域，利用理想气体关系式从出口摩尔流量计算浓度，求解 PSR 的稳态物种平衡方程以得到出口摩尔流量。\n- 决策变量是淬熄区的氧气添加量 $\\dot{n}_{\\mathrm{O_2,Q}}$，单位为 $\\mathrm{mol/s}$。遵守边界条件 $0 \\le \\dot{n}_{\\mathrm{O_2,Q}} \\le \\dot{n}_{\\mathrm{O_2,sec}}$。\n- 计算目标函数 $J(\\dot{n}_{\\mathrm{O_2,Q}})$ 并为每个用例将其最小化。\n- 最终输出必须是单行文本，包含一个 Python 列表，其中有四个浮点数，分别对应于用例 A、B、C 和 D 的 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$，每个值都四舍五入到六位小数，单位为 $\\mathrm{mol/s}$，例如：\n  $$[\\mathrm{value\\_A},\\mathrm{value\\_B},\\mathrm{value\\_C},\\mathrm{value\\_D}]$$\n  其中每个 $\\mathrm{value}$ 是一个小数点后有六位数字的十进制数，并且在打印行中不带单位。",
            "solution": "用户提供了一个计算燃烧学中定义明确的适定问题。任务是使用一系列理想搅拌反应器 (PSR) 对三级 NOx 再燃过程进行建模，并找到最佳的空气分级策略。该问题具有科学依据，没有矛盾，并包含了构建数值解所需的所有信息。模型中的简化，例如简化动力学机理和每个反应器的等温假设（解耦的能量方程），都得到了明确说明，并且是概念级过程建模的标准做法。\n\n在此，我将通过首先建立单个 PSR 的数学框架，然后构建三反应器链，最后将此模型嵌入优化程序中以解决指定的测试用例，来开发解决方案。\n\n### 1. 物种与化学计量\n该模型涉及 $N_s=7$ 个物种：$\\mathrm{CH_4}$、$\\mathrm{O_2}$、$\\mathrm{NO}$、$\\mathrm{CO}$、$\\mathrm{CO_2}$、$\\mathrm{H_2O}$ 和 $\\mathrm{N_2}$。为了矢量表示，建立了如下一致的排序：\n$0: \\mathrm{CH_4}$，$1: \\mathrm{O_2}$，$2: \\mathrm{NO}$，$3: \\mathrm{CO}$，$4: \\mathrm{CO_2}$，$5: \\mathrm{H_2O}$，$6: \\mathrm{N_2}$。\n\n问题定义了四个全局反应。物种 $j$ 在反应 $i$ 中的净化学计量系数 $\\nu_{ij}$可以组合成一个矩阵。设行代表反应 1-4，列代表物种 0-6。\n$$\n\\nu = \\begin{pmatrix}\n-1  0  -4  0  1  2  2 \\\\\n-1  -1.5  0  1  0  2  0 \\\\\n0  -0.5  0  -1  1  0  0 \\\\\n0  -1  2  0  0  0  -1\n\\end{pmatrix}\n$$\n\n### 2. 动力学与速率定律\n对于每个反应 $j$，其速率 $r_j$ 由一个阿伦尼乌斯表达式乘以浓度项给出。所有浓度 $C_j$ 的单位是 $\\mathrm{mol/m^3}$，温度 $T$ 的单位是 $\\mathrm{K}$。通用气体常数为 $R_u = 8.314 \\ \\mathrm{J/(mol \\cdot K)}$。\n速率常数为 $k_j(T) = A_j \\exp(-E_j / (R_u T))$。反应速率为：\n$$ r_1 = k_1(T) C_{\\mathrm{CH_4}} C_{\\mathrm{NO}} $$\n$$ r_2 = k_2(T) C_{\\mathrm{CH_4}} C_{\\mathrm{O_2}} $$\n$$ r_3 = k_3(T) C_{\\mathrm{CO}} C_{\\mathrm{O_2}} $$\n$$ r_4 = k_4(T) C_{\\mathrm{O_2}}^{1/2} C_{\\mathrm{N_2}}^{1/2} $$\n每个物种 $j$ 的净体积生成速率 $\\mathcal{R}_j$ 是其在所有反应中生成/消耗的总和：\n$$ \\mathcal{R}_j(\\mathbf{C}, T) = \\sum_{i=1}^{4} \\nu_{ij} r_i(\\mathbf{C}, T) = (\\boldsymbol{\\nu}^T \\mathbf{r})_j $$\n其中 $\\mathbf{r}$ 是反应速率的列向量 $[r_1, r_2, r_3, r_4]^T$。\n\n### 3. 理想搅拌反应器 (PSR) 模型\nPSR 中物种 $j$ 的稳态物料衡算为：\n$$ 0 = \\dot{n}_{j,\\mathrm{in}} - \\dot{n}_{j,\\mathrm{out}} + V \\, \\mathcal{R}_j(\\mathbf{C}_{\\mathrm{out}}, T) $$\n其中 $\\dot{n}$ 是摩尔流率，单位为 $\\mathrm{mol/s}$，$V$ 是反应器体积，单位为 $\\mathrm{m^3}$。\n在理想气体假设下，出口浓度 $\\mathbf{C}_{\\mathrm{out}}$ 与出口摩尔流量 $\\dot{\\mathbf{n}}_{\\mathrm{out}}$ 相关：\n$$ C_{j, \\mathrm{out}} = \\frac{P}{R_u T} \\frac{\\dot{n}_{j, \\mathrm{out}}}{\\sum_{k=1}^{N_s} \\dot{n}_{k, \\mathrm{out}}} = \\frac{P}{R_u T} \\hat{y}_{j, \\mathrm{out}} $$\n其中 $P$ 是压力，单位为 $\\mathrm{Pa}$，$\\hat{y}_{j, \\mathrm{out}}$ 是摩尔分数。将此代入速率定律，使得 PSR 方程成为一个关于未知出口摩尔流量 $\\dot{\\mathbf{n}}_{\\mathrm{out}}$ 的包含 $N_s$ 个耦合非线性代数方程的方程组。\n$$ \\mathbf{F}(\\dot{\\mathbf{n}}_{\\mathrm{out}}) = \\dot{\\mathbf{n}}_{\\mathrm{in}} - \\dot{\\mathbf{n}}_{\\mathrm{out}} + V \\, \\boldsymbol{\\mathcal{R}}(\\dot{\\mathbf{n}}_{\\mathrm{out}}, T) = \\mathbf{0} $$\n该方程组必须数值求解。我们将使用一个求根算法，具体为 `scipy.optimize.root`，并使用入口流率作为出口流率的初始猜测值。为了在迭代过程中保持物理有效性，物种浓度和摩尔流量将被限制在一个小的正数下限（例如 $10^{-30}$），以防止在 `sqrt` 等函数中出现定义域错误。\n\n### 4. 三区反应器链式模拟\n对于给定的决策变量 $\\dot{n}_{\\mathrm{O_2,Q}}$，模拟按顺序通过三个反应器进行。\n\n**a. R 区（富燃反应器）：**\n入口摩尔流量 $\\dot{\\mathbf{n}}_{\\mathrm{in,R}}$ 由燃料流量 $\\dot{n}_{\\mathrm{F}}$ 和富燃当量比 $\\phi_{\\mathrm{R}}$ 确定。\n- 燃料：$\\dot{n}_{\\mathrm{CH_4,in,R}} = \\dot{n}_{\\mathrm{F}}$\n- 一次空气：$\\dot{n}_{\\mathrm{O_2,R}} = (2 \\dot{n}_{\\mathrm{F}}) / \\phi_{\\mathrm{R}}$ 和 $\\dot{n}_{\\mathrm{N_2,in,R}} = 3.76 \\cdot \\dot{n}_{\\mathrm{O_2,R}}$\n- 入口 NO：$\\dot{n}_{\\mathrm{NO,in,R}}$ 由用例数据给出。\n- 其他物种：$\\dot{n}_{j, \\mathrm{in,R}} = 0$。\n使用体积 $V_R$ 和温度 $T_R$ 求解 PSR 方程，以找到出口流量 $\\dot{\\mathbf{n}}_{\\mathrm{out,R}}$。\n\n**b. Q 区（淬熄反应器）：**\n该区域的入口 $\\dot{\\mathbf{n}}_{\\mathrm{in,Q}}$ 是富燃区出口 $\\dot{\\mathbf{n}}_{\\mathrm{out,R}}$ 和淬熄空气流的混合物。\n- 淬熄空气：此气流包含 $\\dot{n}_{\\mathrm{O_2,Q}}$（决策变量）和 $\\dot{n}_{\\mathrm{N_2,Q}} = 3.76 \\cdot \\dot{n}_{\\mathrm{O_2,Q}}$。\n- 入口混合物：$\\dot{\\mathbf{n}}_{\\mathrm{in,Q}} = \\dot{\\mathbf{n}}_{\\mathrm{out,R}} + \\dot{\\mathbf{n}}_{\\mathrm{air,Q}}$。\n温度 $T_Q$ 通过绝热混合计算得出：\n$$ T_Q = \\frac{(\\sum \\dot{n}_{j,\\mathrm{out,R}}) T_R + (\\dot{n}_{\\mathrm{O_2,Q}} + \\dot{n}_{\\mathrm{N_2,Q}}) T_{\\mathrm{air}}}{\\sum \\dot{n}_{j,\\mathrm{out,R}} + \\dot{n}_{\\mathrm{O_2,Q}} + \\dot{n}_{\\mathrm{N_2,Q}}} $$\n然后使用体积 $V_Q$ 和计算出的温度 $T_Q$ 求解 PSR 方程，以找到 $\\dot{\\mathbf{n}}_{\\mathrm{out,Q}}$。\n\n**c. L 区（贫燃反应器）：**\n可用的二次氧气量为 $\\dot{n}_{\\mathrm{O_2,sec}} = (2 \\dot{n}_{\\mathrm{F}} / \\phi_{\\mathrm{L}}) - (2 \\dot{n}_{\\mathrm{F}} / \\phi_{\\mathrm{R}})$。\n贫燃空气流包含 $\\dot{n}_{\\mathrm{O_2,L}} = \\dot{n}_{\\mathrm{O_2,sec}} - \\dot{n}_{\\mathrm{O_2,Q}}$ 以及相应的氮气。\n贫燃区的入口是淬熄区出口和贫燃空气的混合物：$\\dot{\\mathbf{n}}_{\\mathrm{in,L}} = \\dot{\\mathbf{n}}_{\\mathrm{out,Q}} + \\dot{\\mathbf{n}}_{\\mathrm{air,L}}$。\n温度 $T_L$ 通过类似的混合法则计算：\n$$ T_L = \\frac{(\\sum \\dot{n}_{j,\\mathrm{out,Q}}) T_Q + (\\dot{n}_{\\mathrm{O_2,L}} + \\dot{n}_{\\mathrm{N_2,L}}) T_{\\mathrm{air}}}{\\sum \\dot{n}_{j,\\mathrm{out,Q}} + \\dot{n}_{\\mathrm{O_2,L}} + \\dot{n}_{\\mathrm{N_2,L}}} $$\n使用体积 $V_L$ 和温度 $T_L$ 求解 PSR 方程，以找到最终的出口流量 $\\dot{\\mathbf{n}}_{\\mathrm{out,L}}$。\n\n### 5. 优化\n目标是找到使目标函数 $J$ 最小化的最佳淬熄氧气流量 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$。搜索范围是有界的：$0 \\le \\dot{n}_{\\mathrm{O_2,Q}} \\le \\dot{n}_{\\mathrm{O_2,sec}}$。\n目标函数 $J$ 为：\n$$ J(\\dot{n}_{\\mathrm{O_2,Q}}) = \\hat{y}_{\\mathrm{NO,out,L}} + w_{\\phi}\\left(\\phi_{\\mathrm{Q,mix}} - \\phi_{\\mathrm{Q,target}}\\right)^2 + w_{\\mathrm{CO}} \\, \\max\\!\\left(0, \\ \\hat{y}_{\\mathrm{CO,out,L}} - \\hat{y}_{\\mathrm{CO,lim}}\\right)^2 $$\n- $\\hat{y}_{\\mathrm{NO,out,L}}$ 和 $\\hat{y}_{\\mathrm{CO,out,L}}$ 是贫燃区出口处 NO 和 CO 的摩尔分数。\n- $\\phi_{\\mathrm{Q,mix}}$ 是进入淬熄区的反应前混合物的当量比：\n  $$ \\phi_{\\mathrm{Q,mix}} = \\frac{2 \\ \\dot{n}_{\\mathrm{CH_4,in,Q}} + 0.5 \\ \\dot{n}_{\\mathrm{CO,in,Q}}}{\\dot{n}_{\\mathrm{O_2,in,Q}}} $$\n对于每个测试用例，采用标量有界优化算法 `scipy.optimize.minimize_scalar`（使用 'bounded' 方法）来找到 $\\dot{n}_{\\mathrm{O_2,Q}}^{\\star}$。如果 PSR 求解器对于给定的 $\\dot{n}_{\\mathrm{O_2,Q}}$ 求解失败，目标函数将返回一个很大的值，以引导优化器避开此类不可行区域。\n\n整个过程将针对问题陈述中提供的四个测试用例分别实施。得到的最佳淬熄氧气流率将被收集并格式化为最终答案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root, minimize_scalar\n\n# Define global constants and structures\nSPECIES_MAP = {'CH4': 0, 'O2': 1, 'NO': 2, 'CO': 3, 'CO2': 4, 'H2O': 5, 'N2': 6}\nNUM_SPECIES = 7\n# Stoichiometric matrix (reactions x species)\n# R1: CH4 + 4NO - 2N2 + CO2 + 2H2O\n# R2: CH4 + 1.5O2 - CO + 2H2O\n# R3: CO + 0.5O2 - CO2\n# R4: N2 + O2 - 2NO\nNU = np.array([\n    # CH4,   O2,  NO,   CO, CO2, H2O,  N2\n    [-1.0,  0.0, -4.0,  0.0, 1.0, 2.0, 2.0],  # R1\n    [-1.0, -1.5,  0.0,  1.0, 0.0, 2.0, 0.0],  # R2\n    [ 0.0, -0.5,  0.0, -1.0, 1.0, 0.0, 0.0],  # R3\n    [ 0.0, -1.0,  2.0,  0.0, 0.0, 0.0,-1.0],  # R4\n], dtype=np.float64)\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the simulation and optimization for all test cases.\n    \"\"\"\n    # Universal constants and model parameters\n    RU = 8.314  # J/(mol.K)\n    P = 101325.0  # Pa\n    T_AIR = 300.0  # K\n    N2_O2_RATIO = 3.76\n\n    KINETICS = {\n        'A': np.array([2.0e6, 1.0e8, 5.0e6, 4.0e3], dtype=np.float64),\n        'E': np.array([8.0e4, 1.25e5, 7.0e4, 2.8e5], dtype=np.float64)\n    }\n    \n    W_PHI = 100.0\n    W_CO = 1.0e6\n\n    # Test cases defined in the problem\n    test_cases = [\n        {'name': 'A', 'n_f': 1.0, 'phi_r': 1.2, 'phi_l': 0.85, 'phi_q_target': 0.98,\n         'T_r': 1900, 'V': (0.03, 0.05, 0.07),\n         'n_no_in': 5.0e-4, 'y_co_lim': 1.5e-3},\n        {'name': 'B', 'n_f': 1.0, 'phi_r': 1.2, 'phi_l': 0.85, 'phi_q_target': 0.98,\n         'T_r': 1900, 'V': (0.03, 0.05, 0.07),\n         'n_no_in': 5.0e-4, 'y_co_lim': 2.0e-4},\n        {'name': 'C', 'n_f': 1.0, 'phi_r': 1.4, 'phi_l': 0.90, 'phi_q_target': 1.05,\n         'T_r': 2000, 'V': (0.02, 0.04, 0.06),\n         'n_no_in': 1.0e-3, 'y_co_lim': 1.0e-3},\n        {'name': 'D', 'n_f': 1.0, 'phi_r': 1.1, 'phi_l': 0.98, 'phi_q_target': 0.95,\n         'T_r': 1850, 'V': (0.025, 0.035, 0.05),\n         'n_no_in': 3.0e-4, 'y_co_lim': 1.0e-3}\n    ]\n\n    def calculate_rates(C, T):\n        \"\"\"Calculates the reaction rates.\"\"\"\n        C = np.maximum(C, 1e-30) # Floor concentrations to avoid math errors\n        k = KINETICS['A'] * np.exp(-KINETICS['E'] / (RU * T))\n        \n        r1 = k[0] * C[SPECIES_MAP['CH4']] * C[SPECIES_MAP['NO']]\n        r2 = k[1] * C[SPECIES_MAP['CH4']] * C[SPECIES_MAP['O2']]\n        r3 = k[2] * C[SPECIES_MAP['CO']] * C[SPECIES_MAP['O2']]\n        r4 = k[3] * np.sqrt(C[SPECIES_MAP['N2']] * C[SPECIES_MAP['O2']])\n        \n        return np.array([r1, r2, r3, r4])\n\n    def solve_psr(n_dot_in, V, T):\n        \"\"\"Solves the PSR non-linear algebraic equations.\"\"\"\n        def residuals(n_dot_out):\n            n_dot_out_phys = np.maximum(n_dot_out, 0.0)\n            n_dot_total_out = np.sum(n_dot_out_phys)\n            \n            if n_dot_total_out  1e-20:\n                C_out = np.zeros(NUM_SPECIES)\n            else:\n                C_out = (P / (RU * T)) * n_dot_out_phys / n_dot_total_out\n            \n            rates = calculate_rates(C_out, T)\n            R_net = NU.T @ rates\n            \n            return n_dot_in - n_dot_out_phys + V * R_net\n\n        sol = root(residuals, n_dot_in, method='hybr', tol=1e-8)\n        \n        if not sol.success:\n            return None\n        return np.maximum(sol.x, 0.0)\n\n    def objective_function(n_o2_q, params):\n        \"\"\"Simulates the 3-PSR chain and computes the objective function J.\"\"\"\n        n_f = params['n_f']\n        phi_r = params['phi_r']\n        phi_l = params['phi_l']\n        phi_q_target = params['phi_q_target']\n        y_co_lim = params['y_co_lim']\n        T_r = params['T_r']\n        V_r, V_q, V_l = params['V']\n        n_no_in = params['n_no_in']\n\n        # --- Zone R (Rich) ---\n        n_dot_in_r = np.zeros(NUM_SPECIES)\n        n_dot_in_r[SPECIES_MAP['CH4']] = n_f\n        n_o2_r = (2.0 * n_f) / phi_r\n        n_dot_in_r[SPECIES_MAP['O2']] = n_o2_r\n        n_dot_in_r[SPECIES_MAP['N2']] = n_o2_r * N2_O2_RATIO\n        n_dot_in_r[SPECIES_MAP['NO']] = n_no_in\n        \n        n_dot_out_r = solve_psr(n_dot_in_r, V_r, T_r)\n        if n_dot_out_r is None: return 1e12\n\n        # --- Zone Q (Quench) ---\n        n_dot_air_q = np.zeros(NUM_SPECIES)\n        n_dot_air_q[SPECIES_MAP['O2']] = n_o2_q\n        n_dot_air_q[SPECIES_MAP['N2']] = n_o2_q * N2_O2_RATIO\n        \n        n_dot_in_q = n_dot_out_r + n_dot_air_q\n        \n        n_total_out_r = np.sum(n_dot_out_r)\n        n_total_air_q = np.sum(n_dot_air_q)\n        T_q = ((n_total_out_r * T_r) + (n_total_air_q * T_AIR)) / (n_total_out_r + n_total_air_q)\n\n        # Calculate phi_q_mix for penalty term\n        phi_q_num = 2.0 * n_dot_in_q[SPECIES_MAP['CH4']] + 0.5 * n_dot_in_q[SPECIES_MAP['CO']]\n        phi_q_den = n_dot_in_q[SPECIES_MAP['O2']] + 1e-30 # Avoid division by zero\n        phi_q_mix = phi_q_num / phi_q_den\n        \n        n_dot_out_q = solve_psr(n_dot_in_q, V_q, T_q)\n        if n_dot_out_q is None: return 1e12\n\n        # --- Zone L (Lean) ---\n        n_o2_total = (2.0 * n_f) / phi_l\n        n_o2_sec = n_o2_total - n_o2_r\n        n_o2_l = n_o2_sec - n_o2_q\n\n        n_dot_air_l = np.zeros(NUM_SPECIES)\n        if n_o2_l > 0:\n            n_dot_air_l[SPECIES_MAP['O2']] = n_o2_l\n            n_dot_air_l[SPECIES_MAP['N2']] = n_o2_l * N2_O2_RATIO\n\n        n_dot_in_l = n_dot_out_q + n_dot_air_l\n        \n        n_total_out_q = np.sum(n_dot_out_q)\n        n_total_air_l = np.sum(n_dot_air_l)\n        T_l = ((n_total_out_q * T_q) + (n_total_air_l * T_AIR)) / (n_total_out_q + n_total_air_l)\n\n        n_dot_out_l = solve_psr(n_dot_in_l, V_l, T_l)\n        if n_dot_out_l is None: return 1e12\n        \n        # --- Calculate Objective J ---\n        n_dot_total_out_l = np.sum(n_dot_out_l)\n        y_hat_out_l = n_dot_out_l / (n_dot_total_out_l + 1e-30)\n        \n        y_no_out = y_hat_out_l[SPECIES_MAP['NO']]\n        y_co_out = y_hat_out_l[SPECIES_MAP['CO']]\n        \n        penalty_phi = W_PHI * (phi_q_mix - phi_q_target)**2\n        penalty_co = W_CO * (np.maximum(0, y_co_out - y_co_lim))**2\n        \n        J = y_no_out + penalty_phi + penalty_co\n\n        return J\n\n    results = []\n    for case in test_cases:\n        # Calculate optimization bounds\n        n_f = case['n_f']\n        phi_r = case['phi_r']\n        phi_l = case['phi_l']\n        \n        n_o2_r = (2.0 * n_f) / phi_r\n        n_o2_total = (2.0 * n_f) / phi_l\n        n_o2_sec = max(0, n_o2_total - n_o2_r)\n        \n        bounds_n_o2_q = (0, n_o2_sec)\n\n        # Run optimization\n        opt_result = minimize_scalar(\n            objective_function,\n            args=(case,),\n            method='bounded',\n            bounds=bounds_n_o2_q,\n            options={'xatol': 1e-8, 'maxiter': 500}\n        )\n        \n        results.append(opt_result.x)\n\n    # Format and print the final results\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}