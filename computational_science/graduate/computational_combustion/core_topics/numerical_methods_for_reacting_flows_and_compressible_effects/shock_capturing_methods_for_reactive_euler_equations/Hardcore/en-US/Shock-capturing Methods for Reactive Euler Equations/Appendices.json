{
    "hands_on_practices": [
        {
            "introduction": "A robust numerical simulation begins with a clear understanding of the underlying mathematical model. This first practice grounds your work in the fundamental physics by asking you to derive the flux and source vectors for the one-dimensional reactive Euler equations . This exercise is essential for appreciating how the principles of conservation translate into the vector form $\\partial_t U + \\partial_x F(U) = S(U)$, which is the starting point for all finite-volume methods.",
            "id": "4061761",
            "problem": "Consider the one-dimensional reactive Euler equations used in finite-volume shock-capturing for compressible reacting flows in computational combustion. The conservative variables are $U = (\\rho, \\rho u, \\rho E, \\rho Y)^{\\top}$, where $\\rho$ is the density, $u$ is the velocity, $E$ is the total specific energy, and $Y$ is the reactant mass fraction. Assume the mixture is an ideal gas with an Equation of State (EOS) $p = \\rho R(T,Y) T$, where $p$ is the pressure, $T$ is the temperature, and $R(T,Y)$ is the mixture gas constant, which may depend on both $T$ and $Y$. The total specific energy is $E = e(T,Y) + \\frac{1}{2} u^{2}$, where $e(T,Y)$ is the mixture internal energy per unit mass. The chemistry is a one-step irreversible exothermic reaction with Arrhenius rate\n$$\\dot{\\omega} = - A \\rho Y \\exp\\!\\left(-\\frac{E_{a}}{R(T,Y) \\, T}\\right),$$\nwhere $A$ is a positive pre-exponential factor, and $E_{a}$ is the activation energy. Let $Q0$ denote the heat release per unit mass of reactant consumed (i.e., the chemical energy decrease per unit reactant mass consumed is $Q$).\n\nStarting from the integral conservation laws for mass, momentum, energy, and species, derive the inviscid flux vector $F(U)$ and the reaction source vector $S(U)$ for the reactive Euler system under the assumptions stated. Explicitly write each component of $F(U)$ and $S(U)$ in terms of $(\\rho, u, p, E, Y)$ and the given constitutive relations. Then, using the provided reaction rate, express $Q \\dot{\\omega}$ in closed form in terms of $Y$, $T$, and any given constants and functions.\n\nYour final answer must be a single closed-form analytic expression containing all requested components. No numerical evaluation is required. If you introduce additional thermodynamic functions (such as $e(T,Y)$ or $c_{v}(T,Y)$), leave them symbolic. Express the final answer without units.",
            "solution": "The reactive Euler equations model the inviscid dynamics of a compressible reacting mixture. They are derived from the integral forms of the conservation laws applied to a one-dimensional control volume, neglecting viscous stresses and heat conduction. We begin with the fundamental conservation laws:\n\n1. Conservation of mass:\n$$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0.$$\n\n2. Conservation of momentum:\n$$\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^{2} + p)}{\\partial x} = 0.$$\n\n3. Conservation of total energy:\n$$\\frac{\\partial (\\rho E)}{\\partial t} + \\frac{\\partial \\left(u(\\rho E + p)\\right)}{\\partial x} = \\dot{q},$$\nwhere $\\dot{q}$ is the volumetric source of energy due to chemistry. For an exothermic reaction that releases heat $Q0$ per unit mass of reactant consumed, the energetic effect is an increase in sensible/internal energy as reactant is consumed. The species source $\\dot{\\omega}$ is defined for the reactant mass fraction equation (see below), and the energy source is $-Q \\dot{\\omega}$, with the minus sign arising because $\\dot{\\omega}0$ for reactant consumption. Thus,\n$$\\dot{q} = - Q \\dot{\\omega}.$$\n\n4. Conservation of reactant mass fraction:\n$$\\frac{\\partial (\\rho Y)}{\\partial t} + \\frac{\\partial (\\rho Y u)}{\\partial x} = \\dot{\\omega},$$\nwhere $\\dot{\\omega}$ is the net production rate of reactant per unit volume; for a consuming reaction, $\\dot{\\omega}0$.\n\nTo cast the system in compact vector form suitable for shock-capturing methods, we define the conservative state vector\n$$U = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\\\ \\rho Y \\end{pmatrix}.$$\nThe inviscid flux vector $F(U)$ expresses the convective transport of these conserved quantities. From the conservation laws, the corresponding fluxes are:\n\n- Mass flux: $\\rho u$.\n- Momentum flux: $\\rho u^{2} + p$.\n- Energy flux: $u(\\rho E + p)$, which follows from mechanical work term $p u$ and advection of total energy $\\rho E u$.\n- Species flux: $\\rho Y u$.\n\nTherefore,\n$$F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u(\\rho E + p) \\\\ \\rho Y u \\end{pmatrix}.$$\n\nThe source vector $S(U)$ comprises non-convective contributions due to chemistry. From the above balance laws, the sources are:\n\n- Mass source: $0$, because chemical reactions do not change total mass.\n- Momentum source: $0$, neglecting body forces and interphase momentum exchange.\n- Energy source: $-Q \\dot{\\omega}$.\n- Species source: $\\dot{\\omega}$.\n\nHence,\n$$S(U) = \\begin{pmatrix} 0 \\\\ 0 \\\\ -Q \\dot{\\omega} \\\\ \\dot{\\omega} \\end{pmatrix}.$$\n\nWe now incorporate the constitutive relations. The Equation of State (EOS) is\n$$p = \\rho R(T,Y) T,$$\nwhich defines the thermodynamic closure for $p$ in terms of $\\rho$, $T$, and $Y$. The total specific energy $E$ is the sum of internal energy and kinetic energy,\n$$E = e(T,Y) + \\frac{1}{2} u^{2},$$\nwhere $e(T,Y)$ can be left symbolic, consistent with a general calorically imperfect mixture; in a calorically perfect approximation one would take $e(T,Y) = c_{v}(Y) T$, but here we do not impose that restriction.\n\nThe reaction rate is given as\n$$\\dot{\\omega} = - A \\rho Y \\exp\\!\\left(-\\frac{E_{a}}{R(T,Y) \\, T}\\right),$$\nwith $A0$ and $E_{a}0$. The corresponding energy source involves $Q \\dot{\\omega}$; explicitly,\n$$Q \\dot{\\omega} = - Q A \\rho Y \\exp\\!\\left(-\\frac{E_{a}}{R(T,Y) \\, T}\\right).$$\n\nNote the sign conventions:\n- Since $\\dot{\\omega}0$ for reactant consumption, $-Q \\dot{\\omega}  0$, meaning chemical heat release adds to the sensible/thermal energy.\n- The source vector component for energy is $-Q \\dot{\\omega}$ and the species source component is $\\dot{\\omega}$.\n\nCollecting the requested expressions:\n- The flux vector $F(U)$ components are $(\\rho u, \\rho u^{2} + p, u(\\rho E + p), \\rho Y u)$, with $p$ given by the EOS and $E = e(T,Y) + \\frac{1}{2} u^{2}$.\n- The source vector $S(U)$ components are $(0, 0, -Q \\dot{\\omega}, \\dot{\\omega})$.\n- The quantity $Q \\dot{\\omega}$ in terms of $Y$ and $T$ is $- Q A \\rho Y \\exp\\!\\left(-\\frac{E_{a}}{R(T,Y) \\, T}\\right)$.\n\nThese expressions are the required convective fluxes and reaction sources used by shock-capturing methods to form numerical fluxes and residuals in reactive Euler solvers.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\rho u  \\rho u^{2} + p  u(\\rho E + p)  \\rho Y u  0  0  -Q \\dot{\\omega}  \\dot{\\omega}  - Q A \\rho Y \\exp\\!\\left(-\\dfrac{E_{a}}{R(T,Y)\\,T}\\right)\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "Shock-capturing methods update conservative variables like total energy density $(\\rho E)$, but the physics, particularly chemical reaction rates and the equation of state, depend on primitive variables like temperature $(T)$. This exercise  provides hands-on experience with the crucial 'inversion' step: recovering temperature from a given conservative state and a caloric equation of state. Successfully implementing this procedure is fundamental for bridging the gap between the conserved quantities and the thermodynamic state of the reactive mixture.",
            "id": "4061720",
            "problem": "Consider the one-dimensional reactive Euler equations for a calorically imperfect ideal-gas mixture in computational combustion. The total energy density couples to species through the mixture internal energy function, which depends on temperature and composition, and to chemical heat release. Let the total energy density be $E$, the mass density be $\\rho$, the velocity be $u$, and the species mass fractions be $Y_k$, where the species index $k$ runs over a binary mixture with a reactant $R$ and a product $P$. The mixture internal energy per unit mass is $e(T,Y)$, which depends on temperature $T$ and mass fractions $Y = \\{Y_R, Y_P\\}$, with $Y_R + Y_P = 1$ and $Y_k \\in [0,1]$. The total energy density is related to $e(T,Y)$ and kinetic energy via $E = \\rho e(T,Y) + \\tfrac{1}{2}\\rho u^2$. The coupling to species enters through $e(T,Y)$ and the heat release parameter $Q$.\n\nUse the following caloric Equation of State (EOS) closure for internal energy:\n$$e(T,Y) = Y_R\\left(a_R T + \\tfrac{1}{2} b_R T^2\\right) + Y_P\\left(a_P T + \\tfrac{1}{2} b_P T^2\\right) - Q Y_P,$$\nwith species-specific parameters $a_R$, $b_R$, $a_P$, $b_P$, and a constant heat release $Q$ per unit mass of product. The thermodynamic Equation of State (EOS) for pressure is $p = \\rho R_{\\mathrm{mix}} T$ with mixture gas constant $R_{\\mathrm{mix}} = Y_R R_R + Y_P R_P$. Although pressure $p$ is not required as an output in this task, this relation is part of the physically consistent closure used in shock-capturing methods for reactive Euler equations.\n\nStarting from the fundamental conservation relation $E = \\rho e(T,Y) + \\tfrac{1}{2}\\rho u^2$ and the caloric EOS given above, determine the temperature $T$ (in $\\mathrm{K}$) consistent with a given state $(\\rho, E, Y)$ and velocity $u$ by solving for $T$ such that the internal energy matches $e(T,Y) = (E - \\tfrac{1}{2}\\rho u^2)/\\rho$. The computation must ensure $T  0$ for physical admissibility, which is a standard requirement in shock-capturing methods to maintain positivity of thermodynamic variables.\n\nUse the following constant parameters (all numbers are given with units that must be respected):\n- $a_R = 700\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $b_R = 0.05\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-2}$,\n- $a_P = 680\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $b_P = 0.03\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-2}$,\n- $R_R = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $R_P = 289\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $Q = 1{,}000{,}000\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$.\n\nYour task is to implement a program that, for a set of test cases, computes the temperature $T$ in $\\mathrm{K}$ by solving the nonlinear equation\n$$F(T; \\rho, E, u, Y_P) = Y_R\\left(a_R T + \\tfrac{1}{2} b_R T^2\\right) + Y_P\\left(a_P T + \\tfrac{1}{2} b_P T^2\\right) - Q Y_P - \\frac{E - \\tfrac{1}{2}\\rho u^2}{\\rho} = 0,$$\nwhere $Y_R = 1 - Y_P$. The solution must use a robust root-finding method with a positive temperature bracket and must return a positive temperature solution.\n\nScientific realism and units: All inputs and outputs must use the International System of Units. The computed temperature must be expressed in $\\mathrm{K}$ and rounded to $6$ decimal places.\n\nTest suite. Use the following $5$ test cases, each specified as $(\\rho, E, u, Y_P)$:\n- Case $1$: $\\rho = 1.2\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$, $u = 50\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $Y_P = 0.3$, $E = 500{,}700\\ \\mathrm{J}\\,\\mathrm{m}^{-3}$.\n- Case $2$: $\\rho = 1.0\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$, $u = 200\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $Y_P = 0.0$, $E = 232{,}250\\ \\mathrm{J}\\,\\mathrm{m}^{-3}$.\n- Case $3$: $\\rho = 0.8\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$, $u = 20\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $Y_P = 0.95$, $E = 679{,}660\\ \\mathrm{J}\\,\\mathrm{m}^{-3}$.\n- Case $4$: $\\rho = 0.3\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$, $u = 0\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $Y_P = 0.5$, $E = 648{,}000\\ \\mathrm{J}\\,\\mathrm{m}^{-3}$.\n- Case $5$: $\\rho = 2.0\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$, $u = 0\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$, $Y_P = 0.0$, $E = 353{,}125\\ \\mathrm{J}\\,\\mathrm{m}^{-3}$.\n\nEach case is constructed to be physically consistent with the given EOS parameters and represents a mixture state encountered in shock-capturing computations: a typical burned mixture, an unburned mixture, a highly burned high-temperature mixture, a low-density high-temperature mixture, and a near-ambient low-temperature mixture. Your program must find $T$ for each case.\n\nFinal output format. Your program should produce a single line of output containing the temperatures for all test cases as a comma-separated list enclosed in square brackets, with each temperature rounded to $6$ decimal places, for example, $\\left[ T_1, T_2, T_3, T_4, T_5 \\right]$ formatted as $\\left[ \\texttt{float1},\\texttt{float2},\\texttt{float3},\\texttt{float4},\\texttt{float5} \\right]$.",
            "solution": "The problem is valid. It presents a scientifically grounded, well-posed, and objective task rooted in the field of computational thermodynamics and combustion. All necessary data and equations are provided, forming a self-contained and consistent system. The task is to determine the mixture temperature, $T$, from a given thermodynamic state specified by mass density, $\\rho$, total energy density, $E$, velocity, $u$, and species composition, $Y$. This is a standard and fundamental \"inversion\" problem in the implementation of shock-capturing numerical methods for the reactive Euler equations.\n\nThe derivation of the temperature commences from the definition of total energy density, $E$, which is a conserved quantity in the Euler equations. It is the sum of internal and kinetic energy per unit volume:\n$$E = \\rho e(T,Y) + \\frac{1}{2}\\rho u^2$$\nHere, $e(T,Y)$ is the specific internal energy (per unit mass), which depends on temperature $T$ and the set of species mass fractions $Y = \\{Y_R, Y_P\\}$. Given a state $(\\rho, E, u, Y)$, the specific internal energy is determined by rearranging the above relation:\n$$e(T,Y) = \\frac{E - \\frac{1}{2}\\rho u^2}{\\rho}$$\nThis value, which we may denote $e_{\\text{spec}}$, represents the target value that the caloric Equation of State (EOS) must match.\n\nThe problem provides a caloric EOS for the binary mixture of a reactant, $R$, and a product, $P$. The EOS is a quadratic function of temperature:\n$$e(T,Y) = Y_R\\left(a_R T + \\frac{1}{2} b_R T^2\\right) + Y_P\\left(a_P T + \\frac{1}{2} b_P T^2\\right) - Q Y_P$$\nwhere $Y_R$ and $Y_P$ are the mass fractions of the reactant and product, respectively, constrained by $Y_R + Y_P = 1$. The constants $a_R$, $b_R$, $a_P$, and $b_P$ are empirical parameters for the specific heat capacities of the species, and $Q$ is the chemical heat of reaction.\n\nTo find the temperature $T$ for a given state, we equate the two expressions for the specific internal energy:\n$$Y_R\\left(a_R T + \\frac{1}{2} b_R T^2\\right) + Y_P\\left(a_P T + \\frac{1}{2} b_P T^2\\right) - Q Y_P = \\frac{E - \\frac{1}{2}\\rho u^2}{\\rho}$$\nSubstituting $Y_R = 1 - Y_P$ and rearranging the terms to form a standard polynomial in $T$ yields a quadratic equation:\n$$\\left[ \\frac{1}{2}(1 - Y_P)b_R + \\frac{1}{2}Y_P b_P \\right] T^2 + \\left[ (1 - Y_P)a_R + Y_P a_P \\right] T - \\left[ Q Y_P + \\frac{E - \\frac{1}{2}\\rho u^2}{\\rho} \\right] = 0$$\nThis equation is of the general form $AT^2 + BT + C = 0$, where the coefficients are defined as:\n$$A = \\frac{1}{2}\\left((1 - Y_P)b_R + Y_P b_P\\right)$$\n$$B = (1 - Y_P)a_R + Y_P a_P$$\n$$C = -\\left(Q Y_P + \\frac{E - \\frac{1}{2}\\rho u^2}{\\rho}\\right)$$\n\nFor a physically meaningful state, we require $T  0$. We must analyze the coefficients to determine the nature of the roots.\nThe provided constants are $a_R = 700$, $b_R = 0.05$, $a_P = 680$, $b_P = 0.03$, and $Q = 1{,}000{,}000$, all in consistent SI units. All $a_k$ and $b_k$ are positive. Since mass fractions $Y_P$ are constrained to the interval $[0,1]$, the coefficients $A$ and $B$ are convex combinations of positive constants and are therefore strictly positive for any valid composition.\nSpecifically, $A  0$ implies the quadratic function is a parabola opening upwards.\nThe constant term $C$ is comprised of the heat release term $-Q Y_P$ and the specific internal energy term $-e_{\\text{spec}}$. For all given test cases, the specific internal energy $e_{\\text{spec}} = (E - \\frac{1}{2}\\rho u^2)/\\rho$ is positive. Since $Q  0$ and $Y_P \\ge 0$, the entire term $C$ is strictly negative.\n\nThe roots of the quadratic equation $AT^2 + BT + C = 0$ are given by the quadratic formula:\n$$T = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A}$$\nThe discriminant is $\\Delta = B^2 - 4AC$. Since $A0$ and $C0$, the term $-4AC$ is strictly positive. Thus, the discriminant $\\Delta = B^2 - 4AC  B^2  0$, which guarantees two distinct real roots.\nLet's analyze the signs of these roots. Since $\\sqrt{\\Delta} = \\sqrt{B^2 - 4AC}  \\sqrt{B^2} = |B| = B$ (as $B0$), we have:\n- One root $T_1 = \\frac{-B + \\sqrt{\\Delta}}{2A}  0$.\n- The other root $T_2 = \\frac{-B - \\sqrt{\\Delta}}{2A}  0$.\n\nTherefore, there exists a unique, positive, and physically admissible temperature solution for any valid state provided.\nWhile the analytical quadratic formula provides a direct solution, the problem requests a robust root-finding method, which is a more general and extensible approach for complex Equations of State. A bisection-based method such as Brent's method is ideal. This requires finding a bracketing interval $[T_{\\text{low}}, T_{\\text{high}}]$ such that the function $F(T) = AT^2 + BT + C$ has opposite signs at the endpoints.\nAt $T=0$, we have $F(0) = C  0$. Since $A  0$, for a sufficiently large temperature, $F(T)$ will become positive. Thus, a bracket such as $[T_{\\epsilon}, T_{\\max}]$ where $T_{\\epsilon}$ is a small positive temperature (e.g., $1\\ \\mathrm{K}$) and $T_{\\max}$ is a sufficiently high temperature (e.g., $10000\\ \\mathrm{K}$) will reliably bracket the single positive root.\n\nThe computational procedure for each test case is as follows:\n$1$. For a given state $(\\rho, E, u, Y_P)$, calculate the target specific internal energy $e_{\\text{spec}} = (E - \\frac{1}{2}\\rho u^2)/\\rho$.\n$2$. Define the function $F(T) = \\left[ \\frac{1}{2}((1 - Y_P)b_R + Y_P b_P) \\right] T^2 + \\left[ (1 - Y_P)a_R + Y_P a_P \\right] T - (Q Y_P + e_{\\text{spec}})$.\n$3$. Use a numerical root-finding algorithm, such as `scipy.optimize.brentq`, with a suitable positive temperature bracket (e.g., $[1, 10000]$) to solve $F(T) = 0$ for $T$.\n$4$. Round the resulting temperature to $6$ decimal places as required.\nThis procedure will be applied to all provided test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Computes the temperature for a reactive gas mixture given its thermodynamic\n    state and a caloric Equation of State.\n    \"\"\"\n    \n    # Define constant parameters in SI units\n    a_R = 700.0   # J kg^-1 K^-1\n    b_R = 0.05    # J kg^-1 K^-2\n    a_P = 680.0   # J kg^-1 K^-1\n    b_P = 0.03    # J kg^-1 K^-2\n    Q = 1_000_000.0 # J kg^-1\n\n    # Test suite: each case is a tuple of (rho, E, u, Y_P) in SI units\n    # rho: kg m^-3, E: J m^-3, u: m s^-1, Y_P: dimensionless\n    test_cases = [\n        (1.2, 500_700.0, 50.0, 0.3),   # Case 1\n        (1.0, 232_250.0, 200.0, 0.0),   # Case 2\n        (0.8, 679_660.0, 20.0, 0.95),  # Case 3\n        (0.3, 648_000.0, 0.0, 0.5),    # Case 4\n        (2.0, 353_125.0, 0.0, 0.0),    # Case 5\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        rho, E, u, Y_P = case\n        \n        # Calculate the reactant mass fraction\n        Y_R = 1.0 - Y_P\n        \n        # Calculate the specific internal energy from the total energy density\n        e_spec = (E - 0.5 * rho * u**2) / rho\n        \n        # Define the function F(T) = 0 to be solved for temperature T.\n        # This function represents the difference between the caloric EOS\n        # and the target specific internal energy.\n        # F(T) = Y_R * e_R(T) + Y_P * e_P(T) - Q*Y_P - e_spec = 0\n        def temp_eos_function(T):\n            e_R = a_R * T + 0.5 * b_R * T**2\n            e_P = a_P * T + 0.5 * b_P * T**2\n            return Y_R * e_R + Y_P * e_P - Q * Y_P - e_spec\n            \n        # As derived, the equation for T is a quadratic AT^2 + BT + C = 0.\n        # The coefficients A and B are positive, and C is negative, guaranteeing\n        # a single positive root. We use a robust numerical root-finder\n        # as requested, which is good practice for more complex EOS.\n        \n        # A bracketing interval for the root. Since F(0) is negative and\n        # the parabola opens up, a root must exist for T  0.\n        # A bracket of [1 K, 10000 K] is physically plausible and robust.\n        T_low = 1.0\n        T_high = 10000.0\n        \n        try:\n            # Use Brent's method to find the root T\n            temperature = optimize.brentq(temp_eos_function, T_low, T_high)\n            results.append(f\"{temperature:.6f}\")\n        except ValueError:\n            # This block would execute if a root is not bracketed,\n            # which we've proven should not happen for these cases.\n            results.append(\"Error\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "High-order shock-capturing schemes, while accurate, can produce non-physical oscillations near discontinuities, leading to unphysical states like negative mass fractions. This practice  addresses this critical challenge by tasking you with implementing a mathematically rigorous correction procedure that projects unphysical species compositions back onto the valid physical state space (the unit simplex). This exercise not only ensures the robustness of your solver but also forces a critical evaluation of how such corrections can impact local conservation and energy content.",
            "id": "4061710",
            "problem": "Consider the reactive Euler equations for a calorically perfect gas mixture with species mass fractions $Y_k$, where $k$ indexes the chemical species and $Y_k$ must satisfy $Y_k \\in [0,1]$ and $\\sum_k Y_k = 1$. In shock-capturing discretizations of these equations, high-order reconstructions near detonation fronts can produce provisional species mass fractions that violate the physical bounds. To ensure physical realizability without destabilizing the solution, design a post-processing method that enforces $Y_k \\in [0,1]$ and preserves $\\sum_k Y_k = 1$ for each computational cell by making the smallest possible correction in the Euclidean sense. After applying this method, analyze the effect on conservation and accuracy in detonation simulations through quantifiable metrics.\n\nYour task is to implement a program that:\n- Accepts a predefined set of provisional species mass fraction vectors $Y = (Y_1,Y_2,\\dots,Y_N)$ for $N=3$ species (fuel, oxidizer, product), produced by a hypothetical shock-capturing update near a detonation front.\n- Applies a single-cell post-processing method that enforces $Y_k \\ge 0$ for all $k$, and $\\sum_k Y_k = 1$, while minimizing the Euclidean norm of the correction. This method must not require any external data beyond the provided $Y$ values.\n- Uses a fixed specific heat release $q$ for fuel of $q = 4.0\\times 10^6$ Joules per kilogram (J/kg), and evaluates how the correction changes the potential heat release density $q\\,Y_{\\text{fuel}}$.\n- Computes, for each test case, the following outputs:\n    1. A boolean indicating whether the provisional $Y$ satisfies $Y_k \\in [0,1]$ for all $k$.\n    2. A boolean indicating whether the corrected $Y$ satisfies $Y_k \\in [0,1]$ for all $k$.\n    3. The absolute sum error before correction, $|\\sum_k Y_k - 1|$.\n    4. The absolute sum error after correction, $|\\sum_k Y_k^{\\text{corr}} - 1|$.\n    5. The Euclidean norm of the correction, $\\|Y^{\\text{corr}} - Y\\|_2$.\n    6. The change in potential heat release per unit mass, $q\\,(Y_{\\text{fuel}}^{\\text{corr}} - Y_{\\text{fuel}})$, expressed in J/kg.\n\nUse the following test suite of provisional species mass fraction vectors $Y$ (with species order: fuel, oxidizer, product):\n- Test case $1$: $Y = (1.05,\\,-0.02,\\,0.03)$.\n- Test case $2$: $Y = (-0.10,\\,0.80,\\,0.50)$.\n- Test case $3$: $Y = (0.999,\\,0.001,\\,0.0)$.\n- Test case $4$: $Y = (-0.60,\\,1.80,\\,-0.20)$.\n\nDesign for coverage:\n- Test case $1$ explores mild overshoot and undershoot with sum greater than $1$.\n- Test case $2$ includes a negative component and a sum greater than $1$.\n- Test case $3$ is a near-valid boundary case with sum equal to $1$.\n- Test case $4$ exhibits severe oscillations with large violations but sum equal to $1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the metrics for each test case in order and flattened into a single list. For example, the output should be of the form $[r_{1,1},r_{1,2},\\dots,r_{1,6},r_{2,1},\\dots,r_{4,6}]$, where $r_{i,j}$ is the $j$-th metric for the $i$-th test case. Units for the heat release change must be in Joules per kilogram (J/kg), and angles are not applicable in this problem. Percentages are not used; all quantities must be expressed as booleans or floating-point numbers. No external input is permitted.",
            "solution": "The problem requires the design and implementation of a post-processing method to correct unphysical species mass fractions, $Y_k$, that arise from high-order numerical schemes for simulating reactive flows, such as detonations. A provisional state vector $Y = (Y_1, Y_2, \\dots, Y_N)$ may violate the physical constraints $Y_k \\in [0, 1]$ and $\\sum_{k=1}^N Y_k = 1$. The correction must enforce these constraints while minimizing the perturbation to the provisional state in the Euclidean sense. This is a classic constrained optimization problem, specifically, the projection of a point $Y \\in \\mathbb{R}^N$ onto the standard, or probability, simplex $\\Delta^{N-1}$.\n\nThe standard simplex is defined as the set $\\Delta^{N-1} = \\{ y \\in \\mathbb{R}^N \\mid \\sum_{k=1}^N y_k = 1, y_k \\ge 0 \\}$. The problem is to find a corrected vector $Y^{\\text{corr}}$ that solves:\n$$ \\underset{Y^{\\text{corr}}}{\\text{minimize}} \\quad \\frac{1}{2} \\| Y^{\\text{corr}} - Y \\|_2^2 $$\n$$ \\text{subject to} \\quad \\sum_{k=1}^N Y^{\\text{corr}}_k = 1 \\quad \\text{and} \\quad Y^{\\text{corr}}_k \\ge 0 \\quad \\text{for } k=1, \\dots, N $$\nThe objective function is the squared Euclidean norm, which is strictly convex, and the constraint set (the simplex) is closed and convex. Therefore, a unique solution exists for any given vector $Y$.\n\nTo solve this quadratic programming problem, we employ the Karush-Kuhn-Tucker (KKT) conditions. The Lagrangian $L$ for this problem is:\n$$ L(Y^{\\text{corr}}, \\mu, \\lambda) = \\frac{1}{2} \\sum_{k=1}^N (Y^{\\text{corr}}_k - Y_k)^2 - \\sum_{k=1}^N \\mu_k Y^{\\text{corr}}_k - \\lambda \\left( \\sum_{k=1}^N Y^{\\text{corr}}_k - 1 \\right) $$\nHere, $\\mu_k \\ge 0$ are the Lagrange multipliers for the non-negativity constraints $Y^{\\text{corr}}_k \\ge 0$, and $\\lambda$ is the Lagrange multiplier for the equality constraint on the sum.\n\nThe KKT stationarity condition, $\\frac{\\partial L}{\\partial Y^{\\text{corr}}_k} = 0$, gives:\n$$ Y^{\\text{corr}}_k - Y_k - \\mu_k - \\lambda = 0 \\implies Y^{\\text{corr}}_k = Y_k + \\mu_k + \\lambda $$\nThe complementary slackness condition, $\\mu_k Y^{\\text{corr}}_k = 0$, implies that for each species $k$:\n1. If $Y^{\\text{corr}}_k  0$, then $\\mu_k = 0$, which leads to $Y^{\\text{corr}}_k = Y_k + \\lambda$.\n2. If $Y^{\\text{corr}}_k = 0$, then $\\mu_k \\ge 0$. From stationarity, $\\mu_k = -Y_k - \\lambda$. The condition $\\mu_k \\ge 0$ implies $Y_k + \\lambda \\le 0$.\n\nCombining these two cases, we can express the solution for each component $Y^{\\text{corr}}_k$ compactly in terms of the single multiplier $\\lambda$:\n$$ Y^{\\text{corr}}_k = \\max(0, Y_k + \\lambda) $$\nThe value of $\\lambda$ is determined by substituting this expression back into the summation constraint $\\sum_{k=1}^N Y^{\\text{corr}}_k = 1$:\n$$ \\sum_{k=1}^N \\max(0, Y_k + \\lambda) = 1 $$\nThis is a continuous, piecewise-linear, and monotonically increasing equation in $\\lambda$, which can be solved efficiently. An elegant and robust algorithm to find the unique $\\lambda$ proceeds as follows:\n1. Sort the components of the provisional vector $Y$ in descending order: $u_1 \\ge u_2 \\ge \\dots \\ge u_N$.\n2. Find the largest integer index $\\rho \\in \\{1, \\dots, N\\}$ that satisfies:\n$$ u_\\rho + \\frac{1}{\\rho} \\left( 1 - \\sum_{i=1}^\\rho u_i \\right)  0 $$\nThis search can be performed by iterating from $j=1$ to $N$ and retaining the last index $j$ for which the inequality holds.\n3. With this index $\\rho$, the Lagrange multiplier $\\lambda$ is given by:\n$$ \\lambda = \\frac{1}{\\rho} \\left( 1 - \\sum_{i=1}^\\rho u_i \\right) $$\n4. The components of the corrected vector $Y^{\\text{corr}}$ are then computed using the original (unsorted) $Y_k$ values:\n$$ Y^{\\text{corr}}_k = \\max(0, Y_k + \\lambda) $$\nThis algorithm guarantees that the resulting vector $Y^{\\text{corr}}$ lies on the simplex, satisfying both positivity and the sum-to-one constraint, and is the closest point to the original vector $Y$ in the Euclidean sense. The constraint $Y^{\\text{corr}}_k \\le 1$ is automatically satisfied because if $Y^{\\text{corr}}_k  0$, then for all $j \\ne k$, $Y^{\\text{corr}}_j \\ge 0$, which implies $\\sum_{j \\ne k} Y^{\\text{corr}}_j \\ge 0$. From the sum constraint, $Y^{\\text{corr}}_k = 1 - \\sum_{j \\ne k} Y^{\\text{corr}}_j \\le 1$.\n\nThe required metrics serve to analyze the impact of this correction. The booleans for validity and the sum errors before and after correction verify the enforcement of physical constraints and mass conservation. The Euclidean norm of the correction, $\\|Y^{\\text{corr}} - Y\\|_2$, quantifies the magnitude of the non-physicality in the provisional state. The change in potential heat release, $q(Y_{\\text{fuel}}^{\\text{corr}} - Y_{\\text{fuel}})$, measures the non-physical energy introduced or removed by the correction. While minimizing the Euclidean norm is a mathematically sound objective, it does not explicitly conserve energy, and this metric highlights the direct impact on the chemical source terms, a crucial aspect in detonation modeling.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the species mass fraction correction problem for a predefined set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Species order: (fuel, oxidizer, product)\n    test_cases = [\n        (1.05, -0.02, 0.03),\n        (-0.10, 0.80, 0.50),\n        (0.999, 0.001, 0.0),\n        (-0.60, 1.80, -0.20),\n    ]\n\n    # Specific heat release for fuel in J/kg\n    q_fuel = 4.0e6\n\n    def project_to_simplex(y_prov):\n        \"\"\"\n        Projects a vector onto the probability simplex.\n\n        This function finds the vector y_corr on the simplex (sum of components is 1, all components non-negative)\n        that is closest to the provisional vector y_prov in the Euclidean L2 sense.\n\n        The algorithm is based on a fast projection method from Duchi et al. (2008).\n        \"\"\"\n        y_prov_np = np.asarray(y_prov)\n        n = len(y_prov_np)\n\n        # Sort the provisional vector in descending order\n        u = np.sort(y_prov_np)[::-1]\n\n        # Find the index rho\n        s = np.cumsum(u)\n        # The condition is u_j + (1/j) * (1 - s_j)  0\n        # This is equivalent to j * u_j - s_j + 1  0\n        rho_vals = np.where(u + (1.0 / (np.arange(1, n + 1))) * (1 - s)  0)[0]\n        \n        if len(rho_vals) == 0:\n            # This case should not be reached with typical inputs but included for robustness.\n            # It implies all components will be zeroed out and one will be set to 1.\n            # E.g., for very negative inputs.\n            # Setting lambda to make max(y_prov_k + lambda) = 1/n for non-negative results might be one approach,\n            # but a simpler recovery is to find the largest component and set it to 1.\n            y_corr = np.zeros(n)\n            y_corr[np.argmax(y_prov_np)] = 1.0\n            return y_corr\n\n        rho = rho_vals[-1] + 1\n\n        # Calculate the Lagrange multiplier lambda\n        # Our derivation used y_corr_k = max(0, y_k + lambda), so we calculate lambda directly.\n        lambda_val = (1.0 - s[rho - 1]) / rho\n\n        # Compute the corrected vector\n        y_corr = np.maximum(0, y_prov_np + lambda_val)\n\n        return y_corr\n\n    results = []\n    for case in test_cases:\n        y_provisional = np.array(case, dtype=float)\n        \n        # 1. Check if the provisional Y satisfies Y_k in [0,1]\n        provisional_valid = bool(np.all(y_provisional = 0) and np.all(y_provisional = 1))\n        \n        # 3. Absolute sum error before correction\n        sum_err_before = abs(np.sum(y_provisional) - 1.0)\n        \n        # Apply the correction method\n        y_corrected = project_to_simplex(y_provisional)\n        \n        # 2. Check if the corrected Y satisfies Y_k in [0,1]\n        # This should always be true by construction, barring floating point issues.\n        # Adding a small tolerance for the sum check.\n        corrected_valid = bool(np.all(y_corrected = 0) and np.all(y_corrected = 1.0 + 1e-9) and abs(np.sum(y_corrected) - 1.0)  1e-9)\n\n        # 4. Absolute sum error after correction\n        sum_err_after = abs(np.sum(y_corrected) - 1.0)\n        \n        # 5. Euclidean norm of the correction\n        correction_norm = np.linalg.norm(y_corrected - y_provisional)\n        \n        # 6. Change in potential heat release per unit mass (J/kg)\n        # Fuel is the first component (index 0)\n        heat_release_change = q_fuel * (y_corrected[0] - y_provisional[0])\n\n        results.extend([\n            provisional_valid,\n            corrected_valid,\n            sum_err_before,\n            sum_err_after,\n            correction_norm,\n            heat_release_change\n        ])\n\n    # Final print statement in the exact required format.\n    # Format booleans as lowercase 'true'/'false' and floats with sufficient precision.\n    formatted_results = []\n    for r in results:\n        if isinstance(r, bool):\n            formatted_results.append(str(r).lower())\n        else:\n            # Using a general format that avoids scientific notation for smaller numbers\n            formatted_results.append(f'{r:.15g}')\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}