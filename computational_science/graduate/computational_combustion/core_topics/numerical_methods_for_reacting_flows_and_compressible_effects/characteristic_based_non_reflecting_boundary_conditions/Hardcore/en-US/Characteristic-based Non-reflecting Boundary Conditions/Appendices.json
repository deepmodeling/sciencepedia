{
    "hands_on_practices": [
        {
            "introduction": "To truly understand non-reflecting boundary conditions (NRBCs), we must first verify their behavior in a controlled setting. This exercise provides a foundational test case by simulating the interaction of a clean, right-running Gaussian acoustic pulse with an outlet boundary. By implementing a characteristic-based boundary condition with a prescribed reflection coefficient $r$, you will numerically measure the resulting energy reflection and directly verify the theoretical relationship between the boundary implementation and its physical consequence . This practice is essential for building intuition and developing the skills needed to validate numerical methods.",
            "id": "4011716",
            "problem": "Consider one-dimensional small-amplitude acoustics in a uniform medium relevant to computational combustion, modeled by linearized compressible flow about a constant mean state. Let the mean density be $\\rho_0$, the speed of sound be $c_0$, and the mean flow speed be $U_0$. Let the spatial domain be the interval $x \\in [0,L]$ with outward unit normal at $x=L$ aligned with the positive $x$ direction. Let $p'(x,t)$ and $u'(x,t)$ denote, respectively, the pressure and velocity perturbations about the mean state, assumed sufficiently small to justify the linearization. The linearized governing equations imply that acoustic disturbances propagate along characteristics at speeds $U_0 \\pm c_0$, and the instantaneous acoustic energy flux per unit area through a boundary with normal velocity $u_n'$ is given by the product $p' u_n'$.\n\nYou will construct a purely right-running Gaussian acoustic pulse and use a characteristic-based boundary condition to control reflections at the right boundary $x=L$. Your task is to quantify the reflected energy by time-domain integration of $p' u_n'$ at $x=L$, using a characteristic decomposition to isolate incoming and outgoing contributions, and report the energy-reflection ratio.\n\nFundamental base to use:\n- Linearized one-dimensional acoustics about a uniform mean flow: acoustic information travels at speeds $U_0 \\pm c_0$; the right-running and left-running characteristics can be chosen so that one travels with speed $U_0 + c_0$ and the other with speed $U_0 - c_0$.\n- The acoustic energy flux per unit area equals $p' u_n'$.\n- Small amplitude (linear) acoustics: neglect viscosity, heat release, and entropy or vorticity modes.\n\nDesign of the Gaussian acoustic pulse test:\n- Define the right-running characteristic variable (the one that propagates at speed $U_0 + c_0$) and initialize it at time $t=0$ to a Gaussian pulse of amplitude $A$ centered at $x=x_0$ with standard deviation $\\sigma$, while the left-running characteristic variable (the one that propagates at speed $U_0 - c_0$) is initially zero everywhere. This ensures a purely right-running acoustic pulse at $t=0$.\n- Evolve the characteristic variables forward in time by an appropriate stable numerical method that respects the characteristic advection directions. Use a time step consistent with the Courant–Friedrichs–Lewy condition.\n- Impose a characteristic-based boundary condition at $x=L$ such that the incoming characteristic there is proportional to the outgoing characteristic with a prescribed reflection coefficient $r$ (which may be positive or negative). At $x=0$, do not inject waves; ensure no spurious waves enter from $x=0$.\n\nEnergy accounting at the right boundary:\n- At $x=L$, recover $p'(L,t)$ and $u'(L,t)$ from the characteristic variables at each time and compute the instantaneous energy flux $p'(L,t) \\, u_n'(L,t)$, where $u_n'$ is the velocity component normal to the boundary (aligned with $x$).\n- Using the characteristic decomposition, separate the outgoing (right-running) and incoming (left-running) acoustic contributions so that you can compute the incident energy $E_{\\mathrm{inc}}$ carried to the boundary by the right-running wave and the reflected energy $E_{\\mathrm{ref}}$ carried from the boundary into the domain by the left-running wave. Compute these by integrating the appropriate time-resolved contributions over the duration of the interaction. Report the dimensionless energy-reflection ratio $\\mathcal{R}_E = E_{\\mathrm{ref}} / E_{\\mathrm{inc}}$.\n\nUnits and numerical requirements:\n- Use the International System of Units consistently: distances in meters, time in seconds, density in kilograms per cubic meter, and speed in meters per second.\n- The final quantity $\\mathcal{R}_E$ is dimensionless; report it as a floating-point number.\n- Choose the spatial and temporal resolutions to accurately resolve the Gaussian pulse and its interaction with the boundary. The Gaussian amplitude should be sufficiently small to stay within the linear regime.\n\nTest suite:\nFor each parameter set, compute the single scalar output $\\mathcal{R}_E$ as defined above.\n\nCommon parameters for all tests:\n- $\\rho_0 = 1.2$ kilograms per cubic meter.\n- $c_0 = 340$ meters per second.\n- $L = 1.0$ meter.\n- Gaussian parameters: $x_0 = 0.2$ meter, $\\sigma = 0.05$ meter, $A = 1.0 \\times 10^{-3}$ (small amplitude for linearity).\n- Evolve long enough so that the right-running pulse reaches $x=L$ and the reflected signal is fully generated and accounted for at $x=L$.\n\nVarying parameters across tests:\n- Test $1$: Mach number $M = 0.0$ (so $U_0 = M c_0$) and reflection coefficient $r = 0.0$.\n- Test $2$: Mach number $M = 0.4$ and reflection coefficient $r = 0.3$.\n- Test $3$: Mach number $M = 0.8$ and reflection coefficient $r = -0.5$.\n- Test $4$: Mach number $M = 0.2$ and reflection coefficient $r = 0.9$.\n\nYour program should compute $\\mathcal{R}_E$ for each of the four tests in the order listed above and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\mathcal{R}_E^{(1)},\\mathcal{R}_E^{(2)},\\mathcal{R}_E^{(3)},\\mathcal{R}_E^{(4)}]$. Each entry must be a floating-point number rounded to four decimal places. No other text should be printed.",
            "solution": "The problem requires the computation of the energy-reflection ratio, $\\mathcal{R}_E$, for an acoustic pulse interacting with a boundary in a one-dimensional flow. The solution involves a numerical simulation based on the method of characteristics. I will first formalize the physical and mathematical model, then describe the numerical implementation, and finally detail the calculation of the required energy ratio.\n\n### 1. Governing Equations and Characteristic Variables\n\nThe problem is modeled by the 1D linearized Euler equations for a homoentropic flow about a uniform mean state $(\\rho_0, U_0, p_0)$. The governing equations for the pressure perturbation $p'(x,t)$ and velocity perturbation $u'(x,t)$ can be written in matrix form as:\n$$\n\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = \\mathbf{0}\n$$\nwhere $\\mathbf{q} = [p', u']^T$ is the vector of state variables, and the system matrix $\\mathbf{A}$ is:\n$$\n\\mathbf{A} = \\begin{pmatrix} U_0  \\rho_0 c_0^2 \\\\ 1/\\rho_0  U_0 \\end{pmatrix}\n$$\nHere, $\\rho_0$ is the mean density, $c_0$ is the mean speed of sound, and $U_0$ is the mean flow velocity. The use of the isentropic relation $p' = c_0^2 \\rho'$ has been incorporated.\n\nTo solve this hyperbolic system, we transform it into a set of independent advection equations using its characteristic decomposition. The eigenvalues of $\\mathbf{A}$ give the characteristic speeds:\n$$\n\\lambda_{1,2} = U_0 \\pm c_0\n$$\nThe corresponding left eigenvectors, $\\mathbf{l}_{1,2}$, allow us to define the characteristic variables (or Riemann invariants), $\\mathcal{L}_1$ and $\\mathcal{L}_2$:\n$$\n\\mathbf{l}_1 = [1, \\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_1 = p' + \\rho_0 c_0 u' \\quad (\\text{right-running wave})\n$$\n$$\n\\mathbf{l}_2 = [1, -\\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_2 = p' - \\rho_0 c_0 u' \\quad (\\text{left-running wave})\n$$\nThese characteristic variables satisfy the simple advection equations:\n$$\n\\frac{\\partial \\mathcal{L}_1}{\\partial t} + (U_0 + c_0) \\frac{\\partial \\mathcal{L}_1}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial \\mathcal{L}_2}{\\partial t} + (U_0 - c_0) \\frac{\\partial \\mathcal{L}_2}{\\partial x} = 0\n$$\nThe physical variables $p'$ and $u'$ can be recovered from the characteristic variables:\n$$\np' = \\frac{\\mathcal{L}_1 + \\mathcal{L}_2}{2}, \\quad u' = \\frac{\\mathcal{L}_1 - \\mathcal{L}_2}{2 \\rho_0 c_0}\n$$\n\n### 2. Numerical Implementation\n\nWe solve the two uncoupled advection equations numerically on a discrete grid. The spatial domain $x \\in [0, L]$ is discretized into $N_x$ points with spacing $\\Delta x$. Time is advanced with a step $\\Delta t$. A first-order upwind scheme is employed for its simplicity and stability.\n\nFor $\\mathcal{L}_1$, the advection speed is $v_1 = U_0 + c_0$. For all test cases, $M = U_0/c_0  1$, so $v_1 > 0$. The scheme uses information from the left (upwind direction):\n$$\n\\mathcal{L}_{1,i}^{n+1} = \\mathcal{L}_{1,i}^n - \\frac{v_1 \\Delta t}{\\Delta x} (\\mathcal{L}_{1,i}^n - \\mathcal{L}_{1,i-1}^n)\n$$\nFor $\\mathcal{L}_2$, the advection speed is $v_2 = U_0 - c_0  0$. The scheme uses information from the right:\n$$\n\\mathcal{L}_{2,i}^{n+1} = \\mathcal{L}_{2,i}^n - \\frac{v_2 \\Delta t}{\\Delta x} (\\mathcal{L}_{2,i+1}^n - \\mathcal{L}_{2,i}^n)\n$$\nThe time step $\\Delta t$ is chosen to satisfy the Courant-Friedrichs-Lewy (CFL) condition: $\\Delta t \\le \\text{CFL} \\cdot \\frac{\\Delta x}{\\max(|v_1|, |v_2|)}$, where the CFL number is chosen to be less than $1$.\n\n### 3. Initial and Boundary Conditions\n\n**Initial Condition ($t=0$):** A purely right-running Gaussian pulse is initialized. The left-running characteristic is set to zero.\n$$\n\\mathcal{L}_1(x, 0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right), \\quad \\mathcal{L}_2(x, 0) = 0\n$$\nwhere $A$, $x_0$, and $\\sigma$ are the given amplitude, center, and standard deviation of the pulse.\n\n**Boundary Conditions:**\n- At the left boundary ($x=0$), we must specify the characteristic entering the domain, which is $\\mathcal{L}_1$ (since $v_1 > 0$). To prevent wave injection, we set its value to zero for all time: $\\mathcal{L}_1(0, t) = 0$. The outgoing characteristic $\\mathcal{L}_2$ is calculated from the interior using the upwind scheme.\n- At the right boundary ($x=L$), the outgoing characteristic is $\\mathcal{L}_1$, which is computed from the interior. The incoming characteristic is $\\mathcal{L}_2$ (since $v_2  0$). Its value is specified by the problem as being proportional to the outgoing characteristic, with a reflection coefficient $r$:\n$$\n\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)\n$$\n\n### 4. Energy Reflection Ratio\n\nThe problem defines the acoustic energy flux as $I(x, t) = p'(x, t) u'(x, t)$. We evaluate this at the right boundary, $x=L$. To find the incident and reflected energies, we must decompose this flux. Substituting the expressions for $p'$ and $u'$ in terms of $\\mathcal{L}_1$ and $\\mathcal{L}_2$:\n$$\nI(L, t) = \\left(\\frac{\\mathcal{L}_1(L,t) + \\mathcal{L}_2(L,t)}{2}\\right) \\left(\\frac{\\mathcal{L}_1(L,t) - \\mathcal{L}_2(L,t)}{2 \\rho_0 c_0}\\right) = \\frac{1}{4 \\rho_0 c_0} \\left( \\mathcal{L}_1(L,t)^2 - \\mathcal{L}_2(L,t)^2 \\right)\n$$\nThis expression naturally separates into a right-running component and a left-running component. The incident energy flux, carried by the right-running wave $\\mathcal{L}_1$, is identified as:\n$$\nI_{\\mathrm{inc}}(t) = \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0}\n$$\nThe reflected energy flux, carried by the left-running wave $\\mathcal{L}_2$, has magnitude:\n$$\nI_{\\mathrm{ref}}(t) = \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0}\n$$\nThe total incident energy $E_{\\mathrm{inc}}$ and reflected energy $E_{\\mathrm{ref}}$ are found by integrating these fluxes over the duration of the wave interaction at the boundary:\n$$\nE_{\\mathrm{inc}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{inc}}(t) \\, dt, \\quad E_{\\mathrm{ref}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{ref}}(t) \\, dt\n$$\nThe energy-reflection ratio $\\mathcal{R}_E$ is the ratio of these integrated energies:\n$$\n\\mathcal{R}_E = \\frac{E_{\\mathrm{ref}}}{E_{\\mathrm{inc}}} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0} \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0} \\, dt} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_2(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}\n$$\nSubstituting the boundary condition $\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)$:\n$$\n\\mathcal{R}_E = \\frac{\\int_0^{T_{\\mathrm{final}}} [r \\cdot \\mathcal{L}_1(L, t)]^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = \\frac{r^2 \\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = r^2\n$$\nThis analytical result demonstrates that, under the simplified flux definition provided, the energy reflection ratio is simply the square of the characteristic reflection coefficient, independent of the mean flow Mach number $M$. The numerical simulation must computationally verify this finding for the given test cases. Any numerical error, such as diffusion from the first-order scheme, will affect $\\mathcal{L}_1(L,t)$ but will be proportionally transferred to $\\mathcal{L}_2(L,t)$ via the boundary condition, preserving the ratio $r^2$ in the integrated result.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import trapezoid\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It simulates the propagation of a Gaussian acoustic pulse and calculates\n    the energy reflection ratio at the right boundary.\n    \"\"\"\n\n    def solve_case(M, r):\n        \"\"\"\n        Performs the numerical simulation for a single test case.\n\n        Args:\n            M (float): The mean flow Mach number.\n            r (float): The characteristic reflection coefficient at the right boundary.\n\n        Returns:\n            float: The computed energy reflection ratio, R_E.\n        \"\"\"\n        # Common parameters from the problem statement\n        rho0 = 1.2  # kg/m^3\n        c0 = 340.0  # m/s\n        L = 1.0     # m\n        x0 = 0.2    # m\n        sigma = 0.05 # m\n        A = 1.0e-3  # a.u. (small amplitude)\n\n        # Numerical parameters\n        Nx = 801  # Number of grid points for high resolution\n        dx = L / (Nx - 1)\n        x_grid = np.linspace(0, L, Nx)\n        CFL = 0.9\n\n        # Case-specific parameters based on Mach number\n        U0 = M * c0\n        v1 = U0 + c0  # Characteristic speed for L1 (right-running)\n        v2 = U0 - c0  # Characteristic speed for L2 (left-running)\n\n        # Time-stepping setup\n        # The simulation must run long enough to capture the entire pulse interaction at x=L\n        t_final = 0.006  # seconds, empirically chosen to be sufficient for all cases\n        dt = CFL * dx / max(abs(v1), abs(v2))\n        num_steps = int(t_final / dt)\n        \n        # Characteristic variables arrays\n        L1 = A * np.exp(-(x_grid - x0)**2 / (2 * sigma**2))\n        L2 = np.zeros(Nx)\n\n        # Arrays to store the time history of characteristic variables at the right boundary (x=L)\n        L1_boundary_hist = np.zeros(num_steps + 1)\n        L2_boundary_hist = np.zeros(num_steps + 1)\n\n        # Courant numbers for the upwind scheme\n        C1 = v1 * dt / dx\n        C2 = v2 * dt / dx\n\n        # Main time-integration loop\n        for n in range(num_steps):\n            # Store the boundary values at the current time step\n            L1_boundary_hist[n] = L1[-1]\n            L2_boundary_hist[n] = L2[-1]\n\n            # Keep a copy of the arrays from the previous time step\n            L1_old = L1.copy()\n            L2_old = L2.copy()\n            \n            # --- Update interior points using first-order upwind scheme ---\n            \n            # L1 advects to the right (v1 > 0), so upwind from the left\n            L1[1:] = L1_old[1:] - C1 * (L1_old[1:] - L1_old[0:-1])\n            \n            # L2 advects to the left (v2  0 for M  1), so upwind from the right\n            L2[0:-1] = L2_old[0:-1] - C2 * (L2_old[1:] - L2_old[0:-1])\n\n            # --- Apply boundary conditions ---\n            \n            # Left boundary (x=0): non-injecting condition for incoming characteristic L1\n            L1[0] = 0.0\n            # Outgoing characteristic L2[0] is already updated from the interior\n\n            # Right boundary (x=L): reflection condition for incoming characteristic L2\n            # Outgoing characteristic L1[-1] is already updated from the interior\n            L2[-1] = r * L1[-1]\n        \n        # Store the final boundary values at t_final\n        L1_boundary_hist[-1] = L1[-1]\n        L2_boundary_hist[-1] = L2[-1]\n\n        # --- Energy Calculation ---\n        \n        # The energy is proportional to the time integral of the square of the characteristic variable.\n        # The constant of proportionality 1/(4*rho0*c0) cancels out in the ratio.\n        # We use trapezoidal integration for accuracy.\n        \n        # Incident energy corresponds to the right-running wave L1\n        E_inc = trapezoid(L1_boundary_hist**2, dx=dt)\n        \n        # Reflected energy corresponds to the left-running wave L2\n        E_ref = trapezoid(L2_boundary_hist**2, dx=dt)\n\n        # Avoid division by zero if no wave reaches the boundary (not expected here)\n        if E_inc == 0.0:\n            return 0.0\n        \n        # Compute the energy reflection ratio\n        R_E = E_ref / E_inc\n        return R_E\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.0),   # Test 1: M, r\n        (0.4, 0.3),   # Test 2: M, r\n        (0.8, -0.5),  # Test 3: M, r\n        (0.2, 0.9),   # Test 4: M, r\n    ]\n\n    results = []\n    for M_case, r_case in test_cases:\n        R_E_case = solve_case(M_case, r_case)\n        # Append the result rounded to four decimal places as required.\n        results.append(f\"{R_E_case:.4f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world simulations often present challenges not found in idealized test cases, such as intermittent backflow at an outlet, which can lead to catastrophic numerical instability if not handled correctly. This practice moves beyond simple outflow and tasks you with analyzing the stability of a boundary condition using an energy method. You will derive a stability constraint for the boundary condition during backflow events and implement an adaptive \"fix\" that ensures the simulation remains robust and physically sound . This exercise demonstrates the power of characteristic theory not just for minimizing reflections, but for ensuring the fundamental well-posedness of a numerical simulation.",
            "id": "4011771",
            "problem": "Consider a one-dimensional linearized, isentropic model of compressible flow used in computational combustion near a uniform base state. Let the base density be $\\rho_0$, the base speed of sound be $a_0$, and the base normal velocity at the outlet be $u_n$. Small perturbations of velocity and pressure, denoted by $u'$ and $p'$ respectively, satisfy the convected acoustic system obtained by linearizing the compressible Euler equations (with isentropic closure $p' = a_0^2 \\rho'$). The problem concerns a pressure outlet subject to intermittent backflow events, i.e., times when the normal velocity $u_n$ temporarily becomes negative, and the design of characteristic-based non-reflecting boundary conditions that prevent unbounded energy growth of the perturbations.\n\nStarting from the linearized governing equations and the definition of the perturbation energy, your task is to:\n- Derive an energy balance for the perturbations in terms of an energy density and a boundary production term. Express the boundary production term in terms of the characteristic variables and the base flow parameters.\n- Define the characteristic variables $c_+$ and $c_-$ for the one-dimensional convected acoustic system about a uniform base state, and classify their propagation directions by the characteristic speeds in terms of $u_n$ and $a_0$.\n- Propose a single-parameter characteristic-based boundary closure at the outlet of the form “incoming characteristic equals a multiple of outgoing characteristic,” i.e., $c_{\\text{in}} = r\\,c_{\\text{out}}$ with $0 \\le r \\le 1$, that serves as a non-reflecting condition when $u_n \\ge 0$ and as a stabilizing fix when $u_n  0$.\n- From first principles, show how the choice of $r$ affects the boundary energy production. Then, derive a condition on $r$, as a function of $u_n$ and $a_0$, that guarantees the boundary energy production is non-negative, thereby ensuring no instantaneous growth of the perturbation energy due to the boundary, even when $u_n  0$. Propose an implementable adaptive rule $r_{\\text{eff}}(u_n)$ that enforces this condition while respecting $0 \\le r_{\\text{eff}} \\le 1$.\n\nImplementation requirements:\n- Using your derived expressions, write a complete, runnable program that, for each test case, computes the boundary energy production per unit area $B$, in $\\mathrm{W/m^2}$, defined as the outward energy flux associated with the perturbations at the outlet. Assume a unit-amplitude outgoing characteristic perturbation of magnitude $A_c$, specified for each test case (with units of $\\mathrm{m/s}$ since each characteristic variable is the sum or difference of a velocity and an acoustic velocity potential $p' / (\\rho_0 a_0)$). Use your adaptive rule $r_{\\text{eff}}(u_n)$ for the incoming characteristic multiplier.\n- The program must implement the following decision logic for subsonic conditions $|u_n|  a_0$: when $u_n \\ge 0$, use $r_{\\text{eff}} = r_0$; when $u_n  0$, compute $r_{\\text{eff}}$ from your derived bound to ensure non-negative boundary energy production and set $r_{\\text{eff}} = \\min\\!\\big(r_0, r_{\\text{bound}}(u_n,a_0)\\big)$, clipped to $[0,1]$. Use the outward normal convention for $u_n$.\n\nPhysical units and output specification:\n- Express each computed boundary energy production per unit area $B$ in $\\mathrm{W/m^2}$, rounded by the default floating-point representation of the programming language (do not format or annotate with units in the output).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, e.g., $[b_1,b_2,b_3,\\dots]$.\n\nTest suite:\nUse the following parameter sets, each specified as a tuple $(\\rho_0, a_0, u_n, r_0, A_c)$ with $\\rho_0$ in $\\mathrm{kg/m^3}$, $a_0$ and $u_n$ in $\\mathrm{m/s}$, and $A_c$ in $\\mathrm{m/s}$.\n- Case $1$ (subsonic outflow “happy path”): $(1.20, 340.0, 50.0, 0.20, 0.10)$.\n- Case $2$ (mild subsonic backflow): $(1.20, 340.0, -5.0, 0.20, 0.10)$.\n- Case $3$ (moderate subsonic backflow): $(1.20, 340.0, -150.0, 0.50, 0.10)$.\n- Case $4$ (near-sonic subsonic backflow edge): $(1.20, 340.0, -330.0, 0.90, 0.10)$.\n- Case $5$ (zero mean normal velocity boundary): $(1.20, 340.0, 0.0, 0.70, 0.10)$.\n\nYour program must compute and return the list $[B_1,B_2,B_3,B_4,B_5]$, where each $B_i$ is the boundary energy production for the corresponding case in $\\mathrm{W/m^2}$, using your derived adaptive characteristic-based fix. The output must be a single line containing the list exactly as specified.",
            "solution": "The user wants me to solve a problem in computational combustion, specifically about non-reflecting boundary conditions for linearized Euler equations.\n\nHere's my plan:\n1.  **Validate the Problem**: I need to go through the problem statement meticulously, extract all givens, and check for any flaws based on the specified criteria (scientific soundness, well-posedness, clarity, etc.). The problem seems complex and rooted in fluid dynamics and numerical methods, so it's likely valid, but I must be thorough.\n\n2.  **Derive the Solution**: If the problem is valid, I'll need to perform several derivations as requested.\n    *   **Part A: Energy Balance**:\n        *   Start with the 1D linearized compressible Euler equations (convected acoustic system).\n        *   Define the perturbation energy density. This is usually quadratic in the perturbation variables.\n        *   Derive the energy balance equation, which will have the form $\\frac{\\partial E}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$, where $E$ is the energy density and $F$ is the energy flux.\n        *   The boundary production term will be the value of the energy flux $F$ at the boundary. Express this flux in terms of the characteristic variables.\n\n    *   **Part B: Characteristic Variables**:\n        *   Take the linearized Euler equations and diagonalize the system matrix.\n        *   The characteristic variables are the transformed variables that decouple the system. They are typically sums and differences of the primitive variables (or their scaled versions).\n        *   The eigenvalues of the system matrix are the characteristic speeds, which will be in terms of $u_n$ and $a_0$. This will determine the direction of propagation (in/out of the domain).\n\n    *   **Part C: Boundary Condition Closure**:\n        *   Identify the incoming and outgoing characteristics based on the sign of their propagation speeds at the outlet.\n        *   The problem proposes a boundary condition of the form $c_{\\text{in}} = r c_{\\text{out}}$. I need to formalize this based on my classification of characteristics. The value of `r` is a reflection coefficient. $r=0$ would be a perfectly non-reflecting boundary condition.\n\n    *   **Part D: Stability Condition and Adaptive Rule**:\n        *   Substitute the boundary closure ($c_{\\text{in}} = r c_{\\text{out}}$) into the expression for the boundary energy production (the flux $F$) derived in Part A.\n        *   The goal is to find a condition on $r$ that makes the boundary energy production non-negative. This means the boundary does not spontaneously generate energy, which would lead to numerical instability. The problem states this term is the *outward energy flux*, so non-negative means energy is leaving the domain or staying constant at the boundary, not entering.\n        *   This condition will likely depend on $u_n$ and $a_0$.\n        *   Based on this condition, I'll formulate an adaptive rule for $r_{\\text{eff}}(u_n)$ that satisfies $0 \\le r_{\\text{eff}} \\le 1$ and ensures non-negative energy production, especially for the backflow case ($u_n  0$).\n\n3.  **Implement the Code**:\n    *   Write a Python function that takes the test case parameters $(\\rho_0, a_0, u_n, r_0, A_c)$.\n    *   Implement the decision logic for $r_{\\text{eff}}$:\n        *   If $u_n \\ge 0$, $r_{\\text{eff}} = r_0$.\n        *   If $u_n  0$, calculate the bound $r_{\\text{bound}}(u_n,a_0)$ from the stability condition, then set $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}})$, and clip this to $[0, 1]$.\n    *   Use the final value of $r_{\\text{eff}}$ to calculate the boundary energy production per unit area, $B$. This will be the energy flux $F$ evaluated at the boundary. The flux will be a function of the characteristic variables.\n    *   The problem gives an outgoing characteristic amplitude $A_c$. I'll set $c_{\\text{out}} = A_c$. Then, using the boundary condition, I'll find $c_{\\text{in}} = r_{\\text{eff}} A_c$.\n    *   With both $c_{\\text{in}}$ and $c_{\\text{out}}$ known, I can compute the primitive variables $p'$ and $u'$ at the boundary, and then compute the energy flux $F$.\n    *   Run the code for all five test cases and format the output as a list.\n\nLet's start with the detailed derivation.\n\n---\n\n### Step 1: Problem Validation\n\n**Extract Givens:**\n- Model: 1D linearized, isentropic model of compressible flow.\n- Base state: Uniform with density $\\rho_0$, speed of sound $a_0$, normal velocity at outlet $u_n$.\n- Perturbations: Velocity $u'$, pressure $p'$.\n- Isentropic closure: $p' = a_0^2 \\rho'$.\n- Problem context: Pressure outlet with intermittent backflow ($u_n$ can be negative), characteristic-based non-reflecting boundary conditions.\n- Task 1: Derive energy balance for perturbations, find boundary production term in terms of characteristic variables and base flow parameters.\n- Task 2: Define characteristic variables $c_+$ and $c_-$, classify their propagation directions by speeds in terms of $u_n$ and $a_0$.\n- Task 3: Propose boundary closure $c_{\\text{in}} = r c_{\\text{out}}$ with $0 \\le r \\le 1$.\n- Task 4: Derive condition on $r$ for non-negative boundary energy production. Propose an adaptive rule $r_{\\text{eff}}(u_n)$.\n- Implementation: Compute boundary energy production per unit area $B$ (in W/m^2), which is the outward energy flux.\n- Given: Outgoing characteristic perturbation amplitude $A_c$.\n- Adaptive rule logic:\n    - For subsonic flow $|u_n|  a_0$:\n        - If $u_n \\ge 0$, use $r_{\\text{eff}} = r_0$.\n        - If $u_n  0$, compute $r_{\\text{bound}}(u_n, a_0)$, set $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}})$ clipped to $[0,1]$.\n- Outward normal convention for $u_n$.\n- Output format: $[B_1, B_2, B_3, B_4, B_5]$ in W/m^2.\n- Test cases:\n    1. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 50.0, 0.20, 0.10)$\n    2. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -5.0, 0.20, 0.10)$\n    3. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -150.0, 0.50, 0.10)$\n    4. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -330.0, 0.90, 0.10)$\n    5. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 0.0, 0.70, 0.10)$\n\n**Validate Using Extracted Givens:**\n- **Scientifically Grounded**: The problem is based on the linearized Euler equations, a standard model for acoustics and small perturbations in fluid dynamics. The concept of characteristic variables and non-reflecting boundary conditions is a cornerstone of computational fluid dynamics (CFD) and computational aeroacoustics (CAA). The energy method for proving stability is also a standard mathematical technique. The setup is scientifically sound.\n- **Well-Posed**: The problem is well-posed. It asks for the derivation of a condition and an implementation based on that derivation. It provides all necessary parameters and defines a clear objective. The adaptive rule ensures the problem remains stable.\n- **Objective**: The problem is stated in precise, mathematical language. All terms are standard in the field. There are no subjective or opinion-based statements.\n- **Completeness**: The problem provides all necessary base state parameters ($\\rho_0, a_0, u_n$), perturbation information ($A_c$), and boundary condition parameters ($r_0$). The isentropic relation is given. The goal is clearly defined.\n- **Consistency**: The givens are consistent. The physics described (acoustic waves on a mean flow) is internally consistent. The numerical values in the test cases are physically plausible (e.g., air density, speed of sound in air, subsonic velocities).\n- **Feasibility**: The derivations are standard in advanced fluid dynamics courses. The implementation is a straightforward application of the derived formulas.\n- **Clarity**: The terms \"boundary energy production\", \"characteristic variables\", \"incoming/outgoing\" are standard but require derivation within the context of the specific linearized system, which the problem asks for. It is unambiguous.\n- **No other flaws detected**. The problem is a standard, challenging but solvable problem in applied mathematics and engineering.\n\n**Verdict and Action:**\nThe problem is **valid**. I will proceed with the detailed derivation and solution.\n\n---\n### Step 2: Derivations\n\n**A. Linearized Equations and Energy Balance**\n\nThe 1D Euler equations for continuity and momentum are:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0\n$$\nLet $\\rho = \\rho_0 + \\rho'$, $u = u_n + u'$, $p = p_0 + p'$. The base state $(\\rho_0, u_n, p_0)$ is constant. Linearizing around this base state gives:\n$$\n\\frac{\\partial \\rho'}{\\partial t} + u_n \\frac{\\partial \\rho'}{\\partial x} + \\rho_0 \\frac{\\partial u'}{\\partial x} = 0\n$$\n$$\n\\rho_0 \\left( \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} \\right) + \\frac{\\partial p'}{\\partial x} = 0\n$$\nWe are given the isentropic closure $p' = a_0^2 \\rho'$. Substituting $\\rho' = p'/a_0^2$:\n$$\n\\frac{1}{a_0^2} \\left( \\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x} \\right) + \\rho_0 \\frac{\\partial u'}{\\partial x} = 0\n$$\n$$\n\\rho_0 \\left( \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} \\right) + \\frac{\\partial p'}{\\partial x} = 0\n$$\nLet's rewrite this in vector form. Let $\\mathbf{q} = [p', u']^T$.\n$$\n\\frac{\\partial}{\\partial t} \\begin{pmatrix} p' \\\\ u' \\end{pmatrix} + \\begin{pmatrix} u_n  \\rho_0 a_0^2 \\\\ 1/\\rho_0  u_n \\end{pmatrix} \\frac{\\partial}{\\partial x} \\begin{pmatrix} p' \\\\ u' \\end{pmatrix} = 0\n$$\nThis is of the form $\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = 0$.\n\nNow, for the energy balance. The perturbation energy density $E$ is the sum of kinetic and potential energy of the perturbations.\n$$\nE = \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2}\n$$\nThe first term is kinetic energy $\\frac{1}{2}\\rho_0 (u')^2$. The second term is the acoustic potential energy, derived from the work done to compress the fluid, $\\int p' dV/V_0 \\approx \\int p' (d\\rho/\\rho_0) = \\int (p'/\\rho_0) (p'/a_0^2) d p' = \\frac{(p')^2}{2\\rho_0 a_0^2}$.\n\nWe need to find $\\frac{\\partial E}{\\partial t}$.\n$$\n\\frac{\\partial E}{\\partial t} = \\rho_0 u' \\frac{\\partial u'}{\\partial t} + \\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial t}\n$$\nSubstitute $\\frac{\\partial u'}{\\partial t}$ and $\\frac{\\partial p'}{\\partial t}$ from the governing equations:\n$$\n\\frac{\\partial u'}{\\partial t} = -u_n \\frac{\\partial u'}{\\partial x} - \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x}\n$$\n$$\n\\frac{\\partial p'}{\\partial t} = -u_n \\frac{\\partial p'}{\\partial x} - \\rho_0 a_0^2 \\frac{\\partial u'}{\\partial x}\n$$\nSo,\n$$\n\\frac{\\partial E}{\\partial t} = \\rho_0 u' \\left( -u_n \\frac{\\partial u'}{\\partial x} - \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x} \\right) + \\frac{p'}{\\rho_0 a_0^2} \\left( -u_n \\frac{\\partial p'}{\\partial x} - \\rho_0 a_0^2 \\frac{\\partial u'}{\\partial x} \\right)\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\rho_0 u' \\frac{\\partial u'}{\\partial x} - u' \\frac{\\partial p'}{\\partial x} - \\frac{u_n p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} - p' \\frac{\\partial u'}{\\partial x}\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\left( \\rho_0 u' \\frac{\\partial u'}{\\partial x} + \\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} \\right) - \\left( u' \\frac{\\partial p'}{\\partial x} + p' \\frac{\\partial u'}{\\partial x} \\right)\n$$\nRecognize the terms inside the parentheses as derivatives:\n$$\n\\rho_0 u' \\frac{\\partial u'}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\rho_0 (u')^2 \\right)\n$$\n$$\n\\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right)\n$$\n$$\nu' \\frac{\\partial p'}{\\partial x} + p' \\frac{\\partial u'}{\\partial x} = \\frac{\\partial}{\\partial x} (p' u')\n$$\nSubstitute these back:\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right) - \\frac{\\partial}{\\partial x} (p' u')\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\frac{\\partial E}{\\partial x} - \\frac{\\partial (p'u')}{\\partial x}\n$$\n$$\n\\frac{\\partial E}{\\partial t} + \\frac{\\partial}{\\partial x} \\underbrace{(u_n E + p' u')}_{\\text{Energy Flux } F} = 0\n$$\nThe energy balance equation is $\\frac{\\partial E}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$, where the energy flux is $F = u_n E + p'u'$. The problem asks for the boundary energy production, which is the outward flux of energy. With an outward normal, this is simply $F$ evaluated at the boundary. Let's call it $B$.\n$$\nB = F|_{\\text{outlet}} = u_n \\left( \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right) + p' u'\n$$\nThis is the total energy flux. $u_n E$ is the convection of perturbation energy by the mean flow, and $p'u'$ is the acoustic energy flux (work done by pressure perturbations).\n\n**B. Characteristic Variables**\n\nWe need to find the eigenvalues and eigenvectors of the matrix $\\mathbf{A} = \\begin{pmatrix} u_n  \\rho_0 a_0^2 \\\\ 1/\\rho_0  u_n \\end{pmatrix}$.\nThe characteristic equation is $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$.\n$$\n(u_n - \\lambda)^2 - (\\rho_0 a_0^2)(1/\\rho_0) = 0\n$$\n$$\n(u_n - \\lambda)^2 - a_0^2 = 0\n$$\n$$\nu_n - \\lambda = \\pm a_0 \\implies \\lambda = u_n \\pm a_0\n$$\nThe eigenvalues (characteristic speeds) are $\\lambda_+ = u_n + a_0$ and $\\lambda_- = u_n - a_0$.\n\nThe corresponding left eigenvectors $\\mathbf{l}^T$ satisfy $\\mathbf{l}^T \\mathbf{A} = \\lambda \\mathbf{l}^T$.\nFor $\\lambda_+ = u_n + a_0$:\n$$\n[l_1, l_2] \\begin{pmatrix} u_n  \\rho_0 a_0^2 \\\\ 1/\\rho_0  u_n \\end{pmatrix} = (u_n + a_0) [l_1, l_2]\n$$\n$$\nl_1 u_n + l_2/\\rho_0 = (u_n+a_0)l_1 \\implies l_2/\\rho_0 = a_0 l_1 \\implies l_2 = \\rho_0 a_0 l_1\n$$\nChoosing $l_1 = 1$, we get $\\mathbf{l}_+^T = [1, \\rho_0 a_0]$.\n\nFor $\\lambda_- = u_n - a_0$:\n$$\n[l_1, l_2] \\begin{pmatrix} u_n  \\rho_0 a_0^2 \\\\ 1/\\rho_0  u_n \\end{pmatrix} = (u_n - a_0) [l_1, l_2]\n$$\n$$\nl_1 u_n + l_2/\\rho_0 = (u_n-a_0)l_1 \\implies l_2/\\rho_0 = -a_0 l_1 \\implies l_2 = -\\rho_0 a_0 l_1\n$$\nChoosing $l_1 = 1$, we get $\\mathbf{l}_-^T = [1, -\\rho_0 a_0]$.\n\nThe characteristic variables are defined by $d c = \\mathbf{l}^T d\\mathbf{q}$. Integrating, we get:\n$$\nc'_{+} = p' + \\rho_0 a_0 u'\n$$\n$$\nc'_{-} = p' - \\rho_0 a_0 u'\n$$\nThis is a standard definition. However, the problem states that characteristics have units of velocity. Let's rescale. A common convention is to divide by $\\rho_0 a_0$. Let's try that.\nLet $L_1 = \\frac{1}{2}(\\dots)$ and $L_2=\\frac{1}{2}(\\dots)$. Let's see. The problem relates $c$ to velocity and acoustic velocity potential $p'/(\\rho_0 a_0)$. Let's try $c = u' \\pm \\frac{p'}{\\rho_0 a_0}$.\nLet's see if this works.\n$p' = \\frac{\\rho_0 a_0}{2} (c_+ - c_-)$ where this time $c_+ = u' + p'/(\\rho_0 a_0)$ and $c_- = u' - p'/(\\rho_0 a_0)$? No, that's not right.\nThe sum gives $c_+ + c_- = 2u'$. So, $u' = (c_+ + c_-)/2$.\nThe difference gives $c_+ - c_- = 2p'/(\\rho_0 a_0)$. So, $p' = \\frac{\\rho_0 a_0}{2}(c_+ - c_-)$.\nLet's check the governing equations with these new variables.\nTake the original equations:\n$1) \\frac{1}{\\rho_0 a_0} (\\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x}) + a_0 \\frac{\\partial u'}{\\partial x} = 0$\n$2) \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} + \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x} = 0$\nLet's add and subtract them.\n$(2) + (1)/a_0$:\n$$\n\\left(\\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} + \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x}\\right) + \\frac{1}{\\rho_0 a_0^2}\\left(\\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x}\\right) + \\frac{\\partial u'}{\\partial x} = 0\n$$\nThis is not leading to a simple form.\n\nLet's stick to the eigenvector definition first, and then relate to the hint.\n$c'_{+} = p' + \\rho_0 a_0 u'$\n$c'_{-} = p' - \\rho_0 a_0 u'$\nThis leads to the characteristic form of the equations:\n$$\n\\frac{\\partial c'_{+}}{\\partial t} + (u_n+a_0) \\frac{\\partial c'_{+}}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial c'_{-}}{\\partial t} + (u_n-a_0) \\frac{\\partial c'_{-}}{\\partial x} = 0\n$$\nThis confirms that $c'_+$ propagates with speed $\\lambda_+ = u_n+a_0$ and $c'_-$ propagates with speed $\\lambda_- = u_n-a_0$.\n\nNow let's connect to the problem's hint. The hint seems to define the characteristics as having units of velocity. Let's define:\n$$\nc_+ = u' + \\frac{p'}{\\rho_0 a_0}\n$$\n$$\nc_- = -u' + \\frac{p'}{\\rho_0 a_0}\n$$\nThis is another common convention.\nFrom this definition:\n$p' = \\frac{\\rho_0 a_0}{2} (c_+ + c_-)$\n$u' = \\frac{1}{2} (c_+ - c_-)$\n\nWait, let's use the definition given by my eigenvectors, but scaled.\nLet $c_+ = \\frac{c'_+}{\\rho_0 a_0} = \\frac{p'}{\\rho_0 a_0} + u'$\nLet $c_- = \\frac{c'_-}{\\rho_0 a_0} = \\frac{p'}{\\rho_0 a_0} - u'$\nThen:\n$u' = \\frac{1}{2}(c_+ - c_-)$\n$p' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-)$\nThese are the so-called acoustic characteristic variables. Let's verify their propagation speeds.\nLet's substitute $p'$ and $u'$ in the governing equations.\n$\\frac{\\partial u'}{\\partial t} = \\frac{1}{2}(\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t})$\n$\\frac{\\partial p'}{\\partial t} = \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t})$\nSubstitute into momentum equation:\n$\\rho_0 \\frac{1}{2}(\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t}) + \\rho_0 u_n \\frac{1}{2}(\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) + \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) = 0$\n$\\implies (\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t}) + u_n (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) + a_0 (\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) = 0$\n(Eq A) $\\implies \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} - \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0$\n\nSubstitute into continuity equation (divided by $\\rho_0$):\n$\\frac{1}{\\rho_0 a_0^2} \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + \\frac{u_n}{\\rho_0 a_0^2} \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + \\frac{1}{2}(\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\n$\\implies \\frac{1}{a_0}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + \\frac{u_n}{a_0}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\nMultiply by $a_0$:\n$\\implies (\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + u_n (\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + a_0 (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\n(Eq B) $\\implies \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} + \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0$\n\nAdding (Eq A) and (Eq B):\n$2 \\left( \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} \\right) = 0 \\implies \\frac{\\partial c_+}{\\partial t} + \\lambda_+ \\frac{\\partial c_+}{\\partial x} = 0$, with $\\lambda_+ = u_n+a_0$.\nSubtracting (Eq A) from (Eq B):\n$2 \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0 \\implies \\frac{\\partial c_-}{\\partial t} + \\lambda_- \\frac{\\partial c_-}{\\partial x} = 0$, with $\\lambda_- = u_n-a_0$.\nThis confirms my choice of characteristic variables and their propagation speeds.\n$c_+ = \\frac{p'}{\\rho_0 a_0} + u'$, propagates with speed $\\lambda_+ = u_n+a_0$.\n$c_- = \\frac{p'}{\\rho_0 a_0} - u'$, propagates with speed $\\lambda_- = u_n-a_0$.\n\n**C. Boundary Condition and Energy Production in terms of characteristics**\nThe outlet is at the right end of the domain (say $x=L$). The outward normal is in the $+x$ direction.\n- A characteristic is *outgoing* if it propagates out of the domain. At $x=L$, this means its speed must be positive.\n- A characteristic is *incoming* if it propagates into the domain. At $x=L$, this means its speed must be negative.\n\nWe are given subsonic flow, $|u_n|  a_0$.\n- $\\lambda_+ = u_n + a_0$. Since $u_n  -a_0$, $\\lambda_+  0$. So $c_+$ is always outgoing.\n- $\\lambda_- = u_n - a_0$. Since $u_n  a_0$, $\\lambda_-  0$. So $c_-$ is always incoming.\n\nSo, for the subsonic outlet:\n- Outgoing characteristic: $c_{\\text{out}} = c_+ = \\frac{p'}{\\rho_0 a_0} + u'$\n- Incoming characteristic: $c_{\\text{in}} = c_- = \\frac{p'}{\\rho_0 a_0} - u'$\n\nThe proposed boundary condition is $c_{\\text{in}} = r c_{\\text{out}}$, which translates to:\n$c_- = r c_+$\nThis relation determines the state at the boundary once the outgoing characteristic is known.\n\nNow, let's express the boundary energy production $B$ in terms of $c_+$ and $c_-$.\nWe have $B = u_n E + p' u'$.\nAnd $E = \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2}$.\nFrom our characteristic definitions:\n$u' = \\frac{1}{2}(c_+ - c_-)$\n$p' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-)$\nSubstitute these into $E$:\n$E = \\frac{1}{2} \\rho_0 \\left(\\frac{1}{2}(c_+ - c_-)\\right)^2 + \\frac{1}{2} \\frac{1}{\\rho_0 a_0^2} \\left(\\frac{\\rho_0 a_0}{2}(c_+ + c_-)\\right)^2$\n$E = \\frac{1}{8} \\rho_0 (c_+^2 - 2c_+c_- + c_-^2) + \\frac{1}{8} \\frac{\\rho_0^2 a_0^2}{\\rho_0 a_0^2} (c_+^2 + 2c_+c_- + c_-^2)$\n$E = \\frac{\\rho_0}{8} (c_+^2 - 2c_+c_- + c_-^2 + c_+^2 + 2c_+c_- + c_-^2)$\n$E = \\frac{\\rho_0}{8} (2c_+^2 + 2c_-^2) = \\frac{\\rho_0}{4} (c_+^2 + c_-^2)$\n\nNow substitute for $p'u'$:\n$p'u' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-) \\cdot \\frac{1}{2}(c_+ - c_-) = \\frac{\\rho_0 a_0}{4} (c_+^2 - c_-^2)$\n\nNow assemble the total energy flux $B$:\n$B = u_n E + p'u' = u_n \\frac{\\rho_0}{4} (c_+^2 + c_-^2) + \\frac{\\rho_0 a_0}{4} (c_+^2 - c_-^2)$\n$B = \\frac{\\rho_0}{4} \\left[ u_n(c_+^2 + c_-^2) + a_0(c_+^2 - c_-^2) \\right]$\n$B = \\frac{\\rho_0}{4} \\left[ (u_n+a_0)c_+^2 - (a_0-u_n)c_-^2 \\right]$\n\nThis is the boundary production term (outward energy flux) expressed in terms of characteristic variables and base flow parameters.\n\n**D. Stability Condition and Adaptive Rule**\n\nNow apply the boundary condition $c_- = r c_{+}$.\n$B = \\frac{\\rho_0}{4} \\left[ (u_n+a_0)c_+^2 - (a_0-u_n)(r c_+)^2 \\right]$\n$B = \\frac{\\rho_0}{4} c_+^2 \\left[ (u_n+a_0) - (a_0-u_n)r^2 \\right]$\n\nThe problem requires non-negative boundary energy production, $B \\ge 0$. Since $\\frac{\\rho_0}{4} c_+^2 \\ge 0$, this is equivalent to requiring:\n$(u_n+a_0) - (a_0-u_n)r^2 \\ge 0$\n$(u_n+a_0) \\ge (a_0-u_n)r^2$\n$r^2 \\le \\frac{a_0+u_n}{a_0-u_n}$\nSince $r \\ge 0$, the condition on $r$ is:\n$r \\le \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$\n\nLet's check this condition:\n- For outflow, $u_n \\ge 0$. The fraction $\\frac{a_0+u_n}{a_0-u_n} \\ge 1$. So $\\sqrt{\\frac{a_0+u_n}{a_0-u_n}} \\ge 1$.\n  The condition becomes $r \\le (\\text{something} \\ge 1)$. Since the problem states $0 \\le r \\le 1$, this condition is always fulfilled for any valid $r$ when $u_n \\ge 0$. This confirms that standard non-reflecting boundary conditions ($r=0$) or partially reflecting ones ($0  r \\le 1$) are stable for outflow.\n- For backflow, $u_n  0$. Let $u_n = -|u_n|$. The fraction is $\\frac{a_0-|u_n|}{a_0+|u_n|}  1$. This imposes a non-trivial constraint on $r$.\n  For stability during backflow, we need $r$ to be small enough. The maximum allowed value for $r$ is:\n  $r_{\\text{bound}}(u_n, a_0) = \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$\n  This is the condition on $r$ that guarantees $B \\ge 0$.\n\nNow, let's formulate the adaptive rule $r_{\\text{eff}}(u_n)$ as specified.\n- For subsonic flow $|u_n|  a_0$.\n- Given a desired reflection coefficient $r_0$ for the \"happy path\" (outflow).\n- **If $u_n \\ge 0$**: `r_eff = r_0`. This is stable as shown above.\n- **If $u_n  0$**: We must satisfy $r \\le r_{\\text{bound}}$. The problem logic is to use `r_eff = min(r_0, r_bound)`, and then clip to $[0,1]$.\n  $r_{\\text{bound}} = \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$. Since $u_n  0$ and $|u_n|  a_0$, we have $0  a_0+u_n  a_0-u_n$. Thus $0  \\frac{a_0+u_n}{a_0-u_n}  1$, which means $0  r_{\\text{bound}}  1$.\n  So the clipping to $[0,1]$ is automatically satisfied for $r_{\\text{bound}}$ and for $r_{eff} = \\min(r_0, r_{bound})$ given $r_0 \\in [0,1]$. So the clipping is redundant for this part, but good practice.\n  The adaptive rule is:\n  $r_{\\text{eff}} = \\begin{cases} r_0  \\text{if } u_n \\ge 0 \\\\ \\min\\left(r_0, \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}\\right)  \\text{if } u_n  0 \\end{cases}$\n\n**Final formula for implementation**\nThe problem gives us an amplitude for the outgoing characteristic, $A_c$. So, we set $c_{\\text{out}} = c_+ = A_c$.\nThe incoming characteristic is $c_{\\text{in}} = c_- = r_{\\text{eff}} c_+ = r_{\\text{eff}} A_c$.\nThe formula for the boundary energy production per unit area, $B$, is:\n$B = \\frac{\\rho_0}{4} A_c^2 \\left[ (u_n+a_0) - (a_0-u_n)r_{\\text{eff}}^2 \\right]$\nwhere $r_{\\text{eff}}$ is calculated using the adaptive rule above.\n\nLet's double-check the question's definition of B. \"computes the boundary energy production per unit area $B$, in $\\mathrm{W/m^2}$, defined as the outward energy flux associated with the perturbations at the outlet.\" My derivation of $B=F|_{outlet}$ is exactly this.\nUnits check: $\\rho_0$ is kg/m$^3$. $A_c$ is m/s. $(u_n+a_0)$ is m/s.\nSo $[B] = \\frac{\\mathrm{kg}}{\\mathrm{m}^3} (\\frac{\\mathrm{m}}{\\mathrm{s}})^2 \\frac{\\mathrm{m}}{\\mathrm{s}} = \\frac{\\mathrm{kg} \\cdot \\mathrm{m}^2/\\mathrm{s}^2}{\\mathrm{m}^2 \\cdot \\mathrm{s}} = \\frac{\\text{Joule}}{\\mathrm{m}^2 \\cdot \\mathrm{s}} = \\frac{\\text{Watt}}{\\mathrm{m}^2}$. The units are correct.\n\nNow I am ready to implement the calculation for the test cases.\n\n---\n\n### Step 3: Implementation for Test Cases\n\n**Function `calculate_B(rho0, a0, un, r0, Ac)`:**\n1.  Check if $u_n \\ge 0$.\n2.  If yes, `r_eff = r0`.\n3.  If no ($u_n  0$), calculate `r_bound = sqrt((a0 + un) / (a0 - un))`. Then `r_eff = min(r0, r_bound)`. The problem also says clip to $[0,1]$, so `r_eff = max(0, min(1, r_eff))`. As argued, this should be redundant given the constraints, but it's safer to implement it.\n4.  Calculate `B = (rho0 / 4) * Ac**2 * ((a0 + un) - (a0 - un) * r_eff**2)`.\n5.  Return `B`.\n\nLet's walk through one case manually.\n**Case 2 (mild subsonic backflow):**\n- $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -5.0, 0.20, 0.10)$\n- $u_n = -5.0  0$. So we are in the adaptive case.\n- $r_{\\text{bound}} = \\sqrt{\\frac{340.0 - 5.0}{340.0 - (-5.0)}} = \\sqrt{\\frac{335}{345}} = \\sqrt{0.97101...} \\approx 0.9854$.\n- $r_0 = 0.20$.\n- $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}}) = \\min(0.20, 0.9854) = 0.20$.\n- Clipping to $[0,1]$ doesn't change it. So $r_{\\text{eff}}=0.20$.\n- $B = \\frac{1.20}{4} \\cdot (0.10)^2 \\left[ (340.0 - 5.0) - (340.0 + 5.0) \\cdot (0.20)^2 \\right]$\n- $B = 0.3 \\cdot 0.01 \\cdot [335 - 345 \\cdot 0.04]$\n- $B = 0.003 \\cdot [335 - 13.8]$\n- $B = 0.003 \\cdot 321.2 = 0.9636$.\n\n**Case 3 (moderate subsonic backflow):**\n- $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -150.0, 0.50, 0.10)$\n- $u_n = -150.0  0$.\n- $r_{\\text{bound}} = \\sqrt{\\frac{340 - 150}{340 + 150}} = \\sqrt{\\frac{190}{490}} = \\sqrt{0.3877...} \\approx 0.6227$.\n- $r_0 = 0.50$.\n- $r_{\\text{eff}} = \\min(0.50, 0.6227) = 0.50$.\n- $B = \\frac{1.20}{4} \\cdot (0.10)^2 \\left[ (340 - 150) - (340 + 150) \\cdot (0.50)^2 \\right]$\n- $B = 0.003 \\cdot [190 - 490 \\cdot 0.25]$\n- $B = 0.003 \\cdot [190 - 122.5]$\n- $B = 0.003 \\cdot 67.5 = 0.2025$.\n\n**What if $r_0$ was larger than $r_{\\text{bound}}$?** Let's re-run Case 3 with $r_0 = 0.7$.\n- $r_{\\text{eff}} = \\min(0.7, 0.6227) = 0.6227$.\n- $B = 0.003 \\cdot [190 - 490 \\cdot (0.6227...)^2] = 0.003 \\cdot [190 - 490 \\cdot \\frac{190}{490}] = 0.003 \\cdot [190 - 190] = 0$.\n- This is correct. When we choose $r_{\\text{eff}} = r_{\\text{bound}}$, the energy flux becomes exactly zero. This is the stability limit. Using a smaller $r_{\\text{eff}}$ would result in a positive flux ($B0$). The problem's rule `min(r0, r_bound)` ensures we never pick an $r$ that makes the flux negative. This is the essence of the \"stabilizing fix\".\n\nLet me recalculate Case 3 properly with the given $r_0=0.5$. My calculation above was correct. $r_{\\text{eff}}=0.5$. $B = 0.2025$.\n\n**Case 4 (near-sonic subsonic backflow edge):**\n- $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -330.0, 0.90, 0.10)$\n- $u_n = -330.0  0$.\n- $r_{\\text{bound}} = \\sqrt{\\frac{340 - 330}{340 + 330}} = \\sqrt{\\frac{10}{670}} = \\sqrt{0.014925...} \\approx 0.12217$.\n- $r_0 = 0.90$.\n- $r_{\\text{eff}} = \\min(0.90, 0.12217) = 0.12217... = \\sqrt{10/670}$.\n- With $r_{\\text{eff}} = r_{\\text{bound}}$, we expect $B=0$.\n- Let's check: $B = \\frac{\\rho_0}{4} A_c^2 \\left[ (a_0+u_n) - (a_0-u_n)r_{\\text{bound}}^2 \\right]$\n- $B = \\frac{\\rho_0}{4} A_c^2 \\left[ (a_0+u_n) - (a_0-u_n)\\left(\\frac{a_0+u_n}{a_0-u_n}\\right) \\right] = \\frac{\\rho_0}{4} A_c^2 [(a_0+u_n) - (a_0+u_n)] = 0$.\n- So for Case 4, the result should be $0.0$.\n\n**Case 1 (subsonic outflow \"happy path\"):**\n- $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 50.0, 0.20, 0.10)$\n- $u_n = 50.0 \\ge 0$.\n- $r_{\\text{eff}} = r_0 = 0.20$.\n- $B = \\frac{1.20}{4} \\cdot (0.10)^2 \\left[ (340.0 + 50.0) - (340.0 - 50.0) \\cdot (0.20)^2 \\right]$\n- $B = 0.003 \\cdot [390 - 290 \\cdot 0.04]$\n- $B = 0.003 \\cdot [390 - 11.6]$\n- $B = 0.003 \\cdot 378.4 = 1.1352$.\n\n**Case 5 (zero mean normal velocity boundary):**\n- $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 0.0, 0.70, 0.10)$\n- $u_n = 0.0 \\ge 0$.\n- $r_{\\text{eff}} = r_0 = 0.70$.\n- $B = \\frac{1.20}{4} \\cdot (0.10)^2 \\left[ (340.0 + 0.0) - (340.0 - 0.0) \\cdot (0.70)^2 \\right]$\n- $B = 0.003 \\cdot [340 - 340 \\cdot 0.49]$\n- $B = 0.003 \\cdot [340 \\cdot (1 - 0.49)]$\n- $B = 0.003 \\cdot 340 \\cdot 0.51 = 1.02 \\cdot 0.51 = 0.5202$.\n\nOkay, my manual calculations give the following list of results:\n$[1.1352, 0.9636, 0.2025, 0.0, 0.5202]$\n\nNow I'll structure the Python code. I'll need `numpy` for `sqrt` and `min`. The problem statement allows `numpy`. Wait, `math.sqrt` and `min` built-in function are also fine. But `numpy` is listed as an allowed library so I'll use it.\n\nThe logic is:\n```python\nimport numpy as np\n\ndef calculate_B(case):\n    rho0, a0, un, r0, Ac = case\n    \n    if un = 0:\n        r_eff = r0\n    else:\n        # This case is |un|  a0 which is true for all test cases\n        # np.sqrt will raise error for negative argument, but a0+un  0 so it's safe\n        r_bound = np.sqrt((a0 + un) / (a0 - un))\n        r_eff = np.minimum(r0, r_bound)\n        # Clipping is redundant here but good practice\n        r_eff = np.clip(r_eff, 0, 1)\n\n    B = (rho0 / 4.0) * (Ac**2) * ((a0 + un) - (a0 - un) * r_eff**2)\n    return B\n```\nThe logic seems correct. I will put this inside the required `solve` function structure.\nThe problem statement allows `numpy` and `scipy`.\nThe test cases are subsonic, $|u_n|  a_0$. Let's check:\n1. $|50|  340$ (True)\n2. $|-5|  340$ (True)\n3. $|-150|  340$ (True)\n4. $|-330|  340$ (True)\n5. $|0|  340$ (True)\nAll test cases satisfy the subsonic condition. The derived formulas are applicable.\nThe structure of the final output is also clear. I need to generate a comma-separated list inside brackets. The `map(str, results)` and `','.join(...)` idiom is perfect for this.\n\nDouble checking the problem statement for any missed details.\n- \"single-parameter characteristic-based boundary closure... `c_{in} = r c_{out}`\" - done.\n- \"Propose an implementable adaptive rule `r_{eff}(u_n)` that enforces this condition while respecting $0 \\le r_{\\text{eff}} \\le 1$\" - done.\n- \"computes the boundary energy production per unit area $B$, in $\\mathrm{W/m^2}$\" - done.\n- \"adaptive rule $r_{\\text{eff}}(u_n)$ for the incoming characteristic multiplier\" - done.\n- \"decision logic for subsonic conditions $|u_n|  a_0$: when $u_n \\ge 0$, use $r_{\\text{eff}} = r_0$; when $u_n  0$, compute $r_{\\text{eff}}$ from your derived bound... $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}}(u_n,a_0))$, clipped to $[0,1]$\" - implemented this logic.\n- \"outward normal convention for $u_n$\" - assumed in derivation, speed $u_n$ is positive for outflow. Correct.\n\nSeems solid. I will now write the final solution and code.\nThe solution part should contain the theoretical derivation. I'll make sure to follow the structure.\n1.  Start with linearized equations.\n2.  Define energy density and derive energy balance equation to find the flux $F$.\n3.  Diagonalize the system to find characteristic variables and speeds.\n4.  Express the energy flux $F$ in terms of characteristic variables.\n5.  Apply the boundary condition $c_{in} = r c_{out}$ to the flux expression.\n6.  Derive the stability condition on $r$.\n7.  Define the adaptive rule for $r_{eff}$.\n8.  State the final formula for B which is used in the code.\nAll mathematical entities must be in LaTeX. This is a high-priority requirement. I will be careful about this.\nFor example, variables like $\\rho_0, a_0, u_n, p', u', c_+, c_-$ must all be in LaTeX `$...$`. Numbers like $0, 1, 1.20$ must also be in LaTeX. This is an unusual constraint, but I will follow it.\n\nExample of LaTeX usage in text: \"The base density is $\\rho_0$.\" \"The value is $1.20$.\" \"When $u_n \\ge 0$...\"\nThis will be tedious but I must follow the rules.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.20, 340.0, 50.0, 0.20, 0.10),   # Case 1\n        (1.20, 340.0, -5.0, 0.20, 0.10),   # Case 2\n        (1.20, 340.0, -150.0, 0.50, 0.10), # Case 3\n        (1.20, 340.0, -330.0, 0.90, 0.10), # Case 4\n        (1.20, 340.0, 0.0, 0.70, 0.10),    # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        rho0, a0, un, r0, Ac = case\n\n        # Determine the effective reflection coefficient r_eff based on the adaptive rule\n        if un >= 0:\n            # For outflow or zero mean velocity, use the specified reflection coefficient r0\n            r_eff = r0\n        else: # un  0 (backflow)\n            # Ensure the argument of the square root is non-negative.\n            # For backflow (|un|  a0), we have -a0  un  0, so a0 + un > 0 and a0 - un > 0.\n            # Thus, the argument is always positive.\n            r_bound = np.sqrt((a0 + un) / (a0 - un))\n            \n            # Use the smaller of r0 and the stability-derived bound r_bound\n            r_eff = np.minimum(r0, r_bound)\n            \n            # Per problem spec, clip the result to the range [0, 1].\n            # This is technically redundant given the problem constraints (0=r0=1 and r_bound is in [0,1)),\n            # but it is good practice to enforce it explicitly.\n            r_eff = np.clip(r_eff, 0.0, 1.0)\n\n        # Calculate the boundary energy production per unit area, B\n        # This formula was derived from first principles in the solution text.\n        # B = (rho0 / 4) * Ac^2 * [ (a0 + un) - (a0 - un) * r_eff^2 ]\n        \n        term1 = a0 + un\n        term2 = (a0 - un) * r_eff**2\n        \n        B = (rho0 / 4.0) * (Ac**2) * (term1 - term2)\n        \n        results.append(B)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The principles of characteristic-based boundary conditions are not limited to the standard Euler equations but can be adapted to more advanced numerical systems. This exercise explores their application to low-Mach number preconditioned systems, which are critical for efficiently simulating many combustion phenomena. You will learn to perform the characteristic analysis on a modified (preconditioned) flux Jacobian, identify the corresponding characteristic waves, and implement an NRBC by targeting the incoming acoustic modes in this new mathematical framework . Mastering this adaptation is key to applying NRBCs in state-of-the-art computational fluid dynamics codes.",
            "id": "4011719",
            "problem": "Consider the one-dimensional linearized compressible Euler equations in primitive variables for an ideal gas relevant to Computational Combustion, written in terms of small perturbations about a uniform base state. Let the primitive variable vector be $q = [\\rho, u, p]^T$, where $\\rho$ is density, $u$ is velocity, and $p$ is pressure. Linearization about a constant reference state $(\\rho_0, u_0, p_0)$ yields a constant-coefficient hyperbolic system $ \\partial_t q + A \\partial_x q = 0 $, where the flux Jacobian $A$ in primitive variables is given by\n$$\nA = \\begin{bmatrix}\nu_0  \\rho_0  0 \\\\\n0  u_0  \\frac{1}{\\rho_0} \\\\\n0  \\gamma p_0  u_0 \n\\end{bmatrix},\n$$\nwith the ideal-gas sound speed $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$ and constant specific heat ratio $\\gamma$.\n\nAt low Mach number, preconditioning modifies the time operator to alleviate stiffness. Consider a diagonal preconditioner on the primitive variables that scales the pressure equation, defined by\n$$\n\\Pi = \\mathrm{diag}\\left(1,\\,1,\\,\\frac{1}{\\beta^2}\\right),\n$$\nwhere the Turkel-type preconditioning parameter is\n$$\n\\beta(M) = \\max\\left(\\min\\left(M,\\,1\\right),\\,\\beta_{\\min}\\right), \\quad M = \\frac{|u_0|}{a_0}.\n$$\nThe preconditioned characteristic operator is $ \\tilde{J} = \\Pi^{-1} A $.\n\nCharacteristic-Based Non-Reflecting Boundary Conditions (NRBC) are constructed by decomposing the perturbation into characteristic variables with respect to the outward boundary normal. For a right boundary at $x = L$, the outward normal is along $+x$. Define the right eigenvector matrix $\\tilde{R}$ and left eigenvector matrix $\\tilde{L} = \\tilde{R}^{-1}$ of the preconditioned Jacobian $ \\tilde{J} $, and characteristic variables\n$$\nw = \\tilde{L}\\,(q - q_{\\mathrm{ref}}),\n$$\nwhere $q_{\\mathrm{ref}}$ is a known exterior reference state. Classify a characteristic mode as \"acoustic\" if its right eigenvector has nonzero components in the velocity or pressure entries, and as \"entropy/convective\" if the right eigenvector projects only onto density. For the right boundary, an \"incoming\" mode has eigenvalue $\\lambda  0$ and an \"outgoing\" mode has eigenvalue $\\lambda  0$.\n\nDesign a boundary-update that cancels incoming acoustic modes by setting their characteristic amplitudes to zero, leaving outgoing and entropy/convective modes unchanged:\n$$\nw_i^{\\mathrm{new}} =\n\\begin{cases}\n0,  \\text{if mode $i$ is acoustic and incoming (i.e., $\\lambda_i  0$),} \\\\\nw_i,  \\text{otherwise.}\n\\end{cases}\n$$\nReconstruct the corrected boundary perturbation and state by\n$$\n(q - q_{\\mathrm{ref}})^{\\mathrm{new}} = \\tilde{R}\\,w^{\\mathrm{new}}, \\qquad q_{\\mathrm{boundary}} = q_{\\mathrm{ref}} + (q - q_{\\mathrm{ref}})^{\\mathrm{new}}.\n$$\n\nImplement this procedure numerically using the provided parameters and compute, for each test case, the corrected boundary pressure $p_{\\mathrm{boundary}}$ in Pascals. Use the following test suite with scientifically plausible values:\n\n- Test Case $1$ (subsonic outflow): $\\rho_0 = 1.2$ kilograms per cubic meter (kg/m^3), $u_0 = 40$ meters per second (m/s), $p_0 = 101325$ Pascals (Pa), $\\gamma = 1.4$, interior state $q_{\\mathrm{int}} = [1.19, 41.0, 101625]^T$, reference $q_{\\mathrm{ref}} = [1.2, 40.0, 101325]^T$, and $\\beta_{\\min} = 0.05$.\n- Test Case $2$ (supersonic outflow where preconditioning is inactive): $\\rho_0 = 1.0$ kg/m^3, $u_0 = 800.0$ m/s, $p_0 = 100000.0$ Pa, $\\gamma = 1.4$, $q_{\\mathrm{int}} = [1.01, 795.0, 99500.0]^T$, $q_{\\mathrm{ref}} = [1.0, 800.0, 100000.0]^T$, and $\\beta_{\\min} = 0.05$.\n- Test Case $3$ (near-zero Mach outflow): $\\rho_0 = 1.0$ kg/m^3, $u_0 = 5.0$ m/s, $p_0 = 100000.0$ Pa, $\\gamma = 1.4$, $q_{\\mathrm{int}} = [1.02, 6.5, 100250.0]^T$, $q_{\\mathrm{ref}} = [1.0, 5.0, 100000.0]^T$, and $\\beta_{\\min} = 0.05$.\n- Test Case $4$ (inflow with negative velocity): $\\rho_0 = 1.0$ kg/m^3, $u_0 = -20.0$ m/s, $p_0 = 100000.0$ Pa, $\\gamma = 1.4$, $q_{\\mathrm{int}} = [0.98, -18.5, 99800.0]^T$, $q_{\\mathrm{ref}} = [1.0, -20.0, 100000.0]^T$, and $\\beta_{\\min} = 0.05$.\n\nAlgorithmic requirements:\n- Compute $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$, $M = |u_0|/a_0$, and $\\beta = \\max(\\min(M, 1), \\beta_{\\min})$.\n- Form $A$ and $\\Pi^{-1} = \\mathrm{diag}(1, 1, \\beta^2)$, then $\\tilde{J} = \\Pi^{-1} A$.\n- Compute eigenvalues and right eigenvectors of $\\tilde{J}$, form $\\tilde{L} = \\tilde{R}^{-1}$, and characteristic amplitudes $w$ for $\\Delta q = q_{\\mathrm{int}} - q_{\\mathrm{ref}}$.\n- Zero all incoming acoustic components of $w$ and reconstruct $q_{\\mathrm{boundary}}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in Pascals, each value formatted to six decimal places, for example, \"[p1,p2,p3,p4]\".",
            "solution": "The problem requires the implementation of a characteristic-based non-reflecting boundary condition (NRBC) for the one-dimensional linearized compressible Euler equations, incorporating a low-Mach number preconditioner. The objective is to compute the corrected pressure at a boundary based on interior data and a reference state, by selectively eliminating incoming acoustic waves.\n\nThe procedure is grounded in the theory of hyperbolic partial differential equations. The system $\\partial_t q + A \\partial_x q = 0$ can be diagonalized by a change of variables from the primitive variables $q$ to a set of characteristic variables $w$. Each characteristic variable corresponds to a wave that propagates with a speed given by an eigenvalue of the flux Jacobian $A$. At a boundary, some of these waves propagate out of the domain (outgoing waves), while others propagate into the domain (incoming waves). A non-reflecting boundary condition aims to allow outgoing waves to pass through the boundary unimpeded, while preventing spurious, non-physical waves from reflecting or entering from the exterior.\n\nThis is achieved by specifying boundary data for the incoming characteristic variables. A common and effective NRBC, particularly when the exterior state is known or assumed to be quiescent, is to set the amplitudes of incoming characteristic perturbations to zero. The state at the boundary is then reconstructed from the modified set of characteristic variables, which now only contains contributions from outgoing waves originating from within the computational domain and any specified physical incoming information.\n\nIn the context of low-Mach number flows, such as those often encountered in computational combustion, the Euler equations become stiff. This is because the acoustic wave speeds ($u_0 \\pm a_0$) are much larger than the convective speed ($u_0$), leading to a disparate range of eigenvalues in the flux Jacobian. This stiffness imposes a severe time-step restriction on explicit numerical methods. Turkel-type preconditioning addresses this by modifying the time-derivative term, which, for a constant-coefficient system, is equivalent to pre-multiplying the flux Jacobian by a matrix $\\Pi^{-1}$. Here, $\\Pi = \\mathrm{diag}(1, 1, 1/\\beta^2)$ scales the pressure equation, effectively slowing down the acoustic waves in the modified system to be on the same order as the flow velocity at low Mach numbers. The parameter $\\beta$ is a function of the Mach number $M = |u_0|/a_0$, designed to be active ($ \\beta  1 $) only at low Mach numbers and to switch off ($ \\beta = 1 $) for $M \\ge 1$, recovering the original Euler equations.\n\nThe characteristic analysis for the NRBC must therefore be performed on the preconditioned Jacobian, $\\tilde{J} = \\Pi^{-1} A$. The steps to implement the specified boundary condition are as follows:\n\n1.  **Parameter Calculation**: For each test case, the mean flow parameters $(\\rho_0, u_0, p_0)$ and the ratio of specific heats $\\gamma$ are used to compute the speed of sound $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$, the Mach number $M = |u_0|/a_0$, and the preconditioning parameter $\\beta = \\max(\\min(M, 1), \\beta_{\\min})$.\n\n2.  **Matrix Formulation**: The primitive-variable flux Jacobian matrix $A$ and the inverse of the preconditioning matrix $\\Pi^{-1}$ are constructed. The preconditioned Jacobian is then computed as $\\tilde{J} = \\Pi^{-1} A$.\n    $$\n    A = \\begin{bmatrix} u_0  \\rho_0  0 \\\\ 0  u_0  1/\\rho_0 \\\\ 0  \\gamma p_0  u_0 \\end{bmatrix}, \\quad \\Pi^{-1} = \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  \\beta^2 \\end{bmatrix} \\implies \\tilde{J} = \\begin{bmatrix} u_0  \\rho_0  0 \\\\ 0  u_0  1/\\rho_0 \\\\ 0  \\beta^2 \\gamma p_0  u_0 \\end{bmatrix}\n    $$\n\n3.  **Eigen-Decomposition**: The eigenvalues $\\lambda_i$ and the right eigenvectors (columns of matrix $\\tilde{R}$) of $\\tilde{J}$ are calculated. The eigenvalues of $\\tilde{J}$ are $\\lambda_1 = u_0$, $\\lambda_2 = u_0 + \\beta a_0$, and $\\lambda_3 = u_0 - \\beta a_0$. These represent the speeds of the preconditioned characteristic waves. The matrix of left eigenvectors is found by inverting the right eigenvector matrix, $\\tilde{L} = \\tilde{R}^{-1}$.\n\n4.  **Characteristic Decomposition**: The perturbation at the boundary is approximated by the difference between the interior state $q_{\\mathrm{int}}$ and the exterior reference state $q_{\\mathrm{ref}}$, i.e., $\\Delta q = q_{\\mathrm{int}} - q_{\\mathrm{ref}}$. This perturbation is projected onto the characteristic basis by computing the vector of characteristic amplitudes $w = \\tilde{L} \\Delta q$.\n\n5.  **Boundary Condition Application**: The core of the NRBC is to identify and nullify incoming acoustic modes. At a right boundary (outward normal in $+x$), a mode is incoming if its propagation speed (eigenvalue) $\\lambda_i$ is negative. A mode is classified as acoustic if its corresponding right eigenvector has non-zero components for the velocity or pressure variables. The problem specifies that the entropy/convective mode (corresponding to $\\lambda_1 = u_0$) has a right eigenvector proportional to $[1, 0, 0]^T$. The other two modes are acoustic. A new vector of characteristic amplitudes, $w^{\\mathrm{new}}$, is formed by setting $w_i^{\\mathrm{new}} = 0$ for each mode $i$ that is both acoustic and incoming, and $w_i^{\\mathrm{new}} = w_i$ otherwise.\n\n6.  **State Reconstruction**: The corrected perturbation in primitive variables is reconstructed by transforming $w^{\\mathrm{new}}$ back from the characteristic basis: $\\Delta q^{\\mathrm{new}} = \\tilde{R} w^{\\mathrm{new}}$.\n\n7.  **Final Boundary State**: The final state at the boundary is obtained by adding the corrected perturbation to the reference state: $q_{\\mathrm{boundary}} = q_{\\mathrm{ref}} + \\Delta q^{\\mathrm{new}}$. The required output is the pressure component of this vector, $p_{\\mathrm{boundary}}$.\n\nThis procedure is systematically applied to each test case to determine the corrected boundary pressure. Numerical linear algebra routines are used for the eigen-decomposition and matrix inversion. Care must be taken to correctly identify the modes returned by the numerical eigensolver and apply the logic specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the non-reflecting boundary condition problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Subsonic outflow\n        {'rho0': 1.2, 'u0': 40.0, 'p0': 101325.0, 'gamma': 1.4,\n         'q_int': np.array([1.19, 41.0, 101625.0]), 'q_ref': np.array([1.2, 40.0, 101325.0]), 'beta_min': 0.05},\n        # Case 2: Supersonic outflow\n        {'rho0': 1.0, 'u0': 800.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([1.01, 795.0, 99500.0]), 'q_ref': np.array([1.0, 800.0, 100000.0]), 'beta_min': 0.05},\n        # Case 3: Near-zero Mach outflow\n        {'rho0': 1.0, 'u0': 5.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([1.02, 6.5, 100250.0]), 'q_ref': np.array([1.0, 5.0, 100000.0]), 'beta_min': 0.05},\n        # Case 4: Inflow\n        {'rho0': 1.0, 'u0': -20.0, 'p0': 100000.0, 'gamma': 1.4,\n         'q_int': np.array([0.98, -18.5, 99800.0]), 'q_ref': np.array([1.0, -20.0, 100000.0]), 'beta_min': 0.05},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        p_boundary = calculate_boundary_pressure(case)\n        results.append(f\"{p_boundary:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_boundary_pressure(params):\n    \"\"\"\n    Implements the characteristic-based NRBC procedure for a single case.\n    \"\"\"\n    rho0 = params['rho0']\n    u0 = params['u0']\n    p0 = params['p0']\n    gamma = params['gamma']\n    q_int = params['q_int']\n    q_ref = params['q_ref']\n    beta_min = params['beta_min']\n    \n    # 1. Parameter Calculation\n    a0 = np.sqrt(gamma * p0 / rho0)\n    M = np.abs(u0) / a0\n    beta = max(min(M, 1.0), beta_min)\n\n    # 2. Matrix Formulation\n    A = np.array([\n        [u0, rho0, 0],\n        [0, u0, 1/rho0],\n        [0, gamma * p0, u0]\n    ])\n    \n    Pi_inv = np.diag([1.0, 1.0, beta**2])\n    J_tilde = Pi_inv @ A\n\n    # 3. Eigen-Decomposition\n    # eigenvalues and right eigenvectors\n    # W contains eigenvectors as columns\n    eigenvalues, R_tilde = np.linalg.eig(J_tilde)\n    # left eigenvectors are rows of inv(W)\n    L_tilde = np.linalg.inv(R_tilde)\n    \n    # 4. Characteristic Decomposition\n    delta_q = q_int - q_ref\n    w = L_tilde @ delta_q\n\n    # 5. Boundary Condition Application\n    w_new = w.copy()\n    \n    for i in range(len(eigenvalues)):\n        lambda_i = eigenvalues[i]\n        r_i = R_tilde[:, i]\n\n        # Identify mode type: check if velocity or pressure components are non-zero\n        # The entropy mode has an eigenvector proportional to [1, 0, 0]^T\n        is_acoustic = not np.allclose(r_i[1:], [0, 0], atol=1e-9)\n        \n        # Identify incoming modes for a right boundary\n        is_incoming = lambda_i  0\n\n        # Apply NRBC rule\n        if is_acoustic and is_incoming:\n            w_new[i] = 0.0\n\n    # 6. State Reconstruction\n    delta_q_new = R_tilde @ w_new\n    \n    # 7. Final Boundary State\n    q_boundary = q_ref + delta_q_new\n    p_boundary = q_boundary[2]\n    \n    return p_boundary\n\nsolve()\n\n```"
        }
    ]
}