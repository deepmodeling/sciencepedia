{
    "hands_on_practices": [
        {
            "introduction": "The best way to understand how non-reflecting boundary conditions (NRBCs) work is to see them in action. This first practice involves a classic numerical experiment: sending a clean acoustic pulse towards a boundary and measuring how much of it reflects. By implementing a characteristic-based boundary condition with a prescribed reflection coefficient, you will directly quantify the relationship between the boundary formulation and the resulting wave reflection, solidifying your understanding of how these conditions control wave dynamics .",
            "id": "4011716",
            "problem": "Consider one-dimensional small-amplitude acoustics in a uniform medium relevant to computational combustion, modeled by linearized compressible flow about a constant mean state. Let the mean density be $\\rho_0$, the speed of sound be $c_0$, and the mean flow speed be $U_0$. Let the spatial domain be the interval $x \\in [0,L]$ with outward unit normal at $x=L$ aligned with the positive $x$ direction. Let $p'(x,t)$ and $u'(x,t)$ denote, respectively, the pressure and velocity perturbations about the mean state, assumed sufficiently small to justify the linearization. The linearized governing equations imply that acoustic disturbances propagate along characteristics at speeds $U_0 \\pm c_0$, and the instantaneous acoustic energy flux per unit area through a boundary with normal velocity $u_n'$ is given by the product $p' u_n'$.\n\nYou will construct a purely right-running Gaussian acoustic pulse and use a characteristic-based boundary condition to control reflections at the right boundary $x=L$. Your task is to quantify the reflected energy by time-domain integration of $p' u_n'$ at $x=L$, using a characteristic decomposition to isolate incoming and outgoing contributions, and report the energy-reflection ratio.\n\nFundamental base to use:\n- Linearized one-dimensional acoustics about a uniform mean flow: acoustic information travels at speeds $U_0 \\pm c_0$; the right-running and left-running characteristics can be chosen so that one travels with speed $U_0 + c_0$ and the other with speed $U_0 - c_0$.\n- The acoustic energy flux per unit area equals $p' u_n'$.\n- Small amplitude (linear) acoustics: neglect viscosity, heat release, and entropy or vorticity modes.\n\nDesign of the Gaussian acoustic pulse test:\n- Define the right-running characteristic variable (the one that propagates at speed $U_0 + c_0$) and initialize it at time $t=0$ to a Gaussian pulse of amplitude $A$ centered at $x=x_0$ with standard deviation $\\sigma$, while the left-running characteristic variable (the one that propagates at speed $U_0 - c_0$) is initially zero everywhere. This ensures a purely right-running acoustic pulse at $t=0$.\n- Evolve the characteristic variables forward in time by an appropriate stable numerical method that respects the characteristic advection directions. Use a time step consistent with the Courant–Friedrichs–Lewy condition.\n- Impose a characteristic-based boundary condition at $x=L$ such that the incoming characteristic there is proportional to the outgoing characteristic with a prescribed reflection coefficient $r$ (which may be positive or negative). At $x=0$, do not inject waves; ensure no spurious waves enter from $x=0$.\n\nEnergy accounting at the right boundary:\n- At $x=L$, recover $p'(L,t)$ and $u'(L,t)$ from the characteristic variables at each time and compute the instantaneous energy flux $p'(L,t) \\, u_n'(L,t)$, where $u_n'$ is the velocity component normal to the boundary (aligned with $x$).\n- Using the characteristic decomposition, separate the outgoing (right-running) and incoming (left-running) acoustic contributions so that you can compute the incident energy $E_{\\mathrm{inc}}$ carried to the boundary by the right-running wave and the reflected energy $E_{\\mathrm{ref}}$ carried from the boundary into the domain by the left-running wave. Compute these by integrating the appropriate time-resolved contributions over the duration of the interaction. Report the dimensionless energy-reflection ratio $\\mathcal{R}_E = E_{\\mathrm{ref}} / E_{\\mathrm{inc}}$.\n\nUnits and numerical requirements:\n- Use the International System of Units consistently: distances in meters, time in seconds, density in kilograms per cubic meter, and speed in meters per second.\n- The final quantity $\\mathcal{R}_E$ is dimensionless; report it as a floating-point number.\n- Choose the spatial and temporal resolutions to accurately resolve the Gaussian pulse and its interaction with the boundary. The Gaussian amplitude should be sufficiently small to stay within the linear regime.\n\nTest suite:\nFor each parameter set, compute the single scalar output $\\mathcal{R}_E$ as defined above.\n\nCommon parameters for all tests:\n- $\\rho_0 = 1.2$ kilograms per cubic meter.\n- $c_0 = 340$ meters per second.\n- $L = 1.0$ meter.\n- Gaussian parameters: $x_0 = 0.2$ meter, $\\sigma = 0.05$ meter, $A = 1.0 \\times 10^{-3}$ (small amplitude for linearity).\n- Evolve long enough so that the right-running pulse reaches $x=L$ and the reflected signal is fully generated and accounted for at $x=L$.\n\nVarying parameters across tests:\n- Test $1$: Mach number $M = 0.0$ (so $U_0 = M c_0$) and reflection coefficient $r = 0.0$.\n- Test $2$: Mach number $M = 0.4$ and reflection coefficient $r = 0.3$.\n- Test $3$: Mach number $M = 0.8$ and reflection coefficient $r = -0.5$.\n- Test $4$: Mach number $M = 0.2$ and reflection coefficient $r = 0.9$.\n\nYour program should compute $\\mathcal{R}_E$ for each of the four tests in the order listed above and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\mathcal{R}_E^{(1)},\\mathcal{R}_E^{(2)},\\mathcal{R}_E^{(3)},\\mathcal{R}_E^{(4)}]$. Each entry must be a floating-point number rounded to four decimal places. No other text should be printed.",
            "solution": "The problem requires the computation of the energy-reflection ratio, $\\mathcal{R}_E$, for an acoustic pulse interacting with a boundary in a one-dimensional flow. The solution involves a numerical simulation based on the method of characteristics. I will first formalize the physical and mathematical model, then describe the numerical implementation, and finally detail the calculation of the required energy ratio.\n\n### 1. Governing Equations and Characteristic Variables\n\nThe problem is modeled by the 1D linearized Euler equations for a homoentropic flow about a uniform mean state $(\\rho_0, U_0, p_0)$. The governing equations for the pressure perturbation $p'(x,t)$ and velocity perturbation $u'(x,t)$ can be written in matrix form as:\n$$\n\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = \\mathbf{0}\n$$\nwhere $\\mathbf{q} = [p', u']^T$ is the vector of state variables, and the system matrix $\\mathbf{A}$ is:\n$$\n\\mathbf{A} = \\begin{pmatrix} U_0 & \\rho_0 c_0^2 \\\\ 1/\\rho_0 & U_0 \\end{pmatrix}\n$$\nHere, $\\rho_0$ is the mean density, $c_0$ is the mean speed of sound, and $U_0$ is the mean flow velocity. The use of the isentropic relation $p' = c_0^2 \\rho'$ has been incorporated.\n\nTo solve this hyperbolic system, we transform it into a set of independent advection equations using its characteristic decomposition. The eigenvalues of $\\mathbf{A}$ give the characteristic speeds:\n$$\n\\lambda_{1,2} = U_0 \\pm c_0\n$$\nThe corresponding left eigenvectors, $\\mathbf{l}_{1,2}$, allow us to define the characteristic variables (or Riemann invariants), $\\mathcal{L}_1$ and $\\mathcal{L}_2$:\n$$\n\\mathbf{l}_1 = [1, \\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_1 = p' + \\rho_0 c_0 u' \\quad (\\text{right-running wave})\n$$\n$$\n\\mathbf{l}_2 = [1, -\\rho_0 c_0] \\quad \\implies \\quad \\mathcal{L}_2 = p' - \\rho_0 c_0 u' \\quad (\\text{left-running wave})\n$$\nThese characteristic variables satisfy the simple advection equations:\n$$\n\\frac{\\partial \\mathcal{L}_1}{\\partial t} + (U_0 + c_0) \\frac{\\partial \\mathcal{L}_1}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial \\mathcal{L}_2}{\\partial t} + (U_0 - c_0) \\frac{\\partial \\mathcal{L}_2}{\\partial x} = 0\n$$\nThe physical variables $p'$ and $u'$ can be recovered from the characteristic variables:\n$$\np' = \\frac{\\mathcal{L}_1 + \\mathcal{L}_2}{2}, \\quad u' = \\frac{\\mathcal{L}_1 - \\mathcal{L}_2}{2 \\rho_0 c_0}\n$$\n\n### 2. Numerical Implementation\n\nWe solve the two uncoupled advection equations numerically on a discrete grid. The spatial domain $x \\in [0, L]$ is discretized into $N_x$ points with spacing $\\Delta x$. Time is advanced with a step $\\Delta t$. A first-order upwind scheme is employed for its simplicity and stability.\n\nFor $\\mathcal{L}_1$, the advection speed is $v_1 = U_0 + c_0$. For all test cases, $M = U_0/c_0 < 1$, so $v_1 > 0$. The scheme uses information from the left (upwind direction):\n$$\n\\mathcal{L}_{1,i}^{n+1} = \\mathcal{L}_{1,i}^n - \\frac{v_1 \\Delta t}{\\Delta x} (\\mathcal{L}_{1,i}^n - \\mathcal{L}_{1,i-1}^n)\n$$\nFor $\\mathcal{L}_2$, the advection speed is $v_2 = U_0 - c_0 < 0$. The scheme uses information from the right:\n$$\n\\mathcal{L}_{2,i}^{n+1} = \\mathcal{L}_{2,i}^n - \\frac{v_2 \\Delta t}{\\Delta x} (\\mathcal{L}_{2,i+1}^n - \\mathcal{L}_{2,i}^n)\n$$\nThe time step $\\Delta t$ is chosen to satisfy the Courant-Friedrichs-Lewy (CFL) condition: $\\Delta t \\le \\text{CFL} \\cdot \\frac{\\Delta x}{\\max(|v_1|, |v_2|)}$, where the CFL number is chosen to be less than $1$.\n\n### 3. Initial and Boundary Conditions\n\n**Initial Condition ($t=0$):** A purely right-running Gaussian pulse is initialized. The left-running characteristic is set to zero.\n$$\n\\mathcal{L}_1(x, 0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right), \\quad \\mathcal{L}_2(x, 0) = 0\n$$\nwhere $A$, $x_0$, and $\\sigma$ are the given amplitude, center, and standard deviation of the pulse.\n\n**Boundary Conditions:**\n- At the left boundary ($x=0$), we must specify the characteristic entering the domain, which is $\\mathcal{L}_1$ (since $v_1 > 0$). To prevent wave injection, we set its value to zero for all time: $\\mathcal{L}_1(0, t) = 0$. The outgoing characteristic $\\mathcal{L}_2$ is calculated from the interior using the upwind scheme.\n- At the right boundary ($x=L$), the outgoing characteristic is $\\mathcal{L}_1$, which is computed from the interior. The incoming characteristic is $\\mathcal{L}_2$ (since $v_2 < 0$). Its value is specified by the problem as being proportional to the outgoing characteristic, with a reflection coefficient $r$:\n$$\n\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)\n$$\n\n### 4. Energy Reflection Ratio\n\nThe problem defines the acoustic energy flux as $I(x, t) = p'(x, t) u'(x, t)$. We evaluate this at the right boundary, $x=L$. To find the incident and reflected energies, we must decompose this flux. Substituting the expressions for $p'$ and $u'$ in terms of $\\mathcal{L}_1$ and $\\mathcal{L}_2$:\n$$\nI(L, t) = \\left(\\frac{\\mathcal{L}_1(L,t) + \\mathcal{L}_2(L,t)}{2}\\right) \\left(\\frac{\\mathcal{L}_1(L,t) - \\mathcal{L}_2(L,t)}{2 \\rho_0 c_0}\\right) = \\frac{1}{4 \\rho_0 c_0} \\left( \\mathcal{L}_1(L,t)^2 - \\mathcal{L}_2(L,t)^2 \\right)\n$$\nThis expression naturally separates into a right-running component and a left-running component. The incident energy flux, carried by the right-running wave $\\mathcal{L}_1$, is identified as:\n$$\nI_{\\mathrm{inc}}(t) = \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0}\n$$\nThe reflected energy flux, carried by the left-running wave $\\mathcal{L}_2$, has magnitude:\n$$\nI_{\\mathrm{ref}}(t) = \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0}\n$$\nThe total incident energy $E_{\\mathrm{inc}}$ and reflected energy $E_{\\mathrm{ref}}$ are found by integrating these fluxes over the duration of the wave interaction at the boundary:\n$$\nE_{\\mathrm{inc}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{inc}}(t) \\, dt, \\quad E_{\\mathrm{ref}} = \\int_0^{T_{\\mathrm{final}}} I_{\\mathrm{ref}}(t) \\, dt\n$$\nThe energy-reflection ratio $\\mathcal{R}_E$ is the ratio of these integrated energies:\n$$\n\\mathcal{R}_E = \\frac{E_{\\mathrm{ref}}}{E_{\\mathrm{inc}}} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_2(L, t)^2}{4 \\rho_0 c_0} \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\frac{\\mathcal{L}_1(L, t)^2}{4 \\rho_0 c_0} \\, dt} = \\frac{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_2(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}\n$$\nSubstituting the boundary condition $\\mathcal{L}_2(L, t) = r \\cdot \\mathcal{L}_1(L, t)$:\n$$\n\\mathcal{R}_E = \\frac{\\int_0^{T_{\\mathrm{final}}} [r \\cdot \\mathcal{L}_1(L, t)]^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = \\frac{r^2 \\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt}{\\int_0^{T_{\\mathrm{final}}} \\mathcal{L}_1(L, t)^2 \\, dt} = r^2\n$$\nThis analytical result demonstrates that, under the simplified flux definition provided, the energy reflection ratio is simply the square of the characteristic reflection coefficient, independent of the mean flow Mach number $M$. The numerical simulation must computationally verify this finding for the given test cases. Any numerical error, such as diffusion from the first-order scheme, will affect $\\mathcal{L}_1(L,t)$ but will be proportionally transferred to $\\mathcal{L}_2(L,t)$ via the boundary condition, preserving the ratio $r^2$ in the integrated result.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import trapezoid\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It simulates the propagation of a Gaussian acoustic pulse and calculates\n    the energy reflection ratio at the right boundary.\n    \"\"\"\n\n    def solve_case(M, r):\n        \"\"\"\n        Performs the numerical simulation for a single test case.\n\n        Args:\n            M (float): The mean flow Mach number.\n            r (float): The characteristic reflection coefficient at the right boundary.\n\n        Returns:\n            float: The computed energy reflection ratio, R_E.\n        \"\"\"\n        # Common parameters from the problem statement\n        rho0 = 1.2  # kg/m^3\n        c0 = 340.0  # m/s\n        L = 1.0     # m\n        x0 = 0.2    # m\n        sigma = 0.05 # m\n        A = 1.0e-3  # a.u. (small amplitude)\n\n        # Numerical parameters\n        Nx = 801  # Number of grid points for high resolution\n        dx = L / (Nx - 1)\n        x_grid = np.linspace(0, L, Nx)\n        CFL = 0.9\n\n        # Case-specific parameters based on Mach number\n        U0 = M * c0\n        v1 = U0 + c0  # Characteristic speed for L1 (right-running)\n        v2 = U0 - c0  # Characteristic speed for L2 (left-running)\n\n        # Time-stepping setup\n        # The simulation must run long enough to capture the entire pulse interaction at x=L\n        t_final = 0.006  # seconds, empirically chosen to be sufficient for all cases\n        dt = CFL * dx / max(abs(v1), abs(v2))\n        num_steps = int(t_final / dt)\n        \n        # Characteristic variables arrays\n        L1 = A * np.exp(-(x_grid - x0)**2 / (2 * sigma**2))\n        L2 = np.zeros(Nx)\n\n        # Arrays to store the time history of characteristic variables at the right boundary (x=L)\n        L1_boundary_hist = np.zeros(num_steps + 1)\n        L2_boundary_hist = np.zeros(num_steps + 1)\n\n        # Courant numbers for the upwind scheme\n        C1 = v1 * dt / dx\n        C2 = v2 * dt / dx\n\n        # Main time-integration loop\n        for n in range(num_steps):\n            # Store the boundary values at the current time step\n            L1_boundary_hist[n] = L1[-1]\n            L2_boundary_hist[n] = L2[-1]\n\n            # Keep a copy of the arrays from the previous time step\n            L1_old = L1.copy()\n            L2_old = L2.copy()\n            \n            # --- Update interior points using first-order upwind scheme ---\n            \n            # L1 advects to the right (v1 > 0), so upwind from the left\n            L1[1:] = L1_old[1:] - C1 * (L1_old[1:] - L1_old[0:-1])\n            \n            # L2 advects to the left (v2 < 0 for M < 1), so upwind from the right\n            L2[0:-1] = L2_old[0:-1] - C2 * (L2_old[1:] - L2_old[0:-1])\n\n            # --- Apply boundary conditions ---\n            \n            # Left boundary (x=0): non-injecting condition for incoming characteristic L1\n            L1[0] = 0.0\n            # Outgoing characteristic L2[0] is already updated from the interior\n\n            # Right boundary (x=L): reflection condition for incoming characteristic L2\n            # Outgoing characteristic L1[-1] is already updated from the interior\n            L2[-1] = r * L1[-1]\n        \n        # Store the final boundary values at t_final\n        L1_boundary_hist[-1] = L1[-1]\n        L2_boundary_hist[-1] = L2[-1]\n\n        # --- Energy Calculation ---\n        \n        # The energy is proportional to the time integral of the square of the characteristic variable.\n        # The constant of proportionality 1/(4*rho0*c0) cancels out in the ratio.\n        # We use trapezoidal integration for accuracy.\n        \n        # Incident energy corresponds to the right-running wave L1\n        E_inc = trapezoid(L1_boundary_hist**2, dx=dt)\n        \n        # Reflected energy corresponds to the left-running wave L2\n        E_ref = trapezoid(L2_boundary_hist**2, dx=dt)\n\n        # Avoid division by zero if no wave reaches the boundary (not expected here)\n        if E_inc == 0.0:\n            return 0.0\n        \n        # Compute the energy reflection ratio\n        R_E = E_ref / E_inc\n        return R_E\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.0),   # Test 1: M, r\n        (0.4, 0.3),   # Test 2: M, r\n        (0.8, -0.5),  # Test 3: M, r\n        (0.2, 0.9),   # Test 4: M, r\n    ]\n\n    results = []\n    for M_case, r_case in test_cases:\n        R_E_case = solve_case(M_case, r_case)\n        # Append the result rounded to four decimal places as required.\n        results.append(f\"{R_E_case:.4f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While standard NRBCs work well for simple outflows, they can become unstable when the flow temporarily reverses direction at the boundary—a common occurrence in turbulent simulations. This exercise challenges you to move from implementation to analysis by deriving a stability condition based on the system's energy. You will then implement an adaptive boundary condition that dynamically adjusts to prevent non-physical energy growth, a crucial skill for developing robust simulation codes .",
            "id": "4011771",
            "problem": "Consider a one-dimensional linearized, isentropic model of compressible flow used in computational combustion near a uniform base state. Let the base density be $\\,\\rho_0\\,$, the base speed of sound be $\\,a_0\\,$, and the base normal velocity at the outlet be $\\,u_n$. Small perturbations of velocity and pressure, denoted by $\\,u'\\,$ and $\\,p'\\,$ respectively, satisfy the convected acoustic system obtained by linearizing the compressible Euler equations (with isentropic closure $\\,p' = a_0^2 \\rho'$). The problem concerns a pressure outlet subject to intermittent backflow events, i.e., times when the normal velocity $\\,u_n\\,$ temporarily becomes negative, and the design of characteristic-based non-reflecting boundary conditions that prevent unbounded energy growth of the perturbations.\n\nStarting from the linearized governing equations and the definition of the perturbation energy, your task is to:\n- Derive an energy balance for the perturbations in terms of an energy density and a boundary production term. Express the boundary production term in terms of the characteristic variables and the base flow parameters.\n- Define the characteristic variables $\\,c_+\\,$ and $\\,c_-\\,$ for the one-dimensional convected acoustic system about a uniform base state, and classify their propagation directions by the characteristic speeds in terms of $\\,u_n\\,$ and $\\,a_0$.\n- Propose a single-parameter characteristic-based boundary closure at the outlet of the form “incoming characteristic equals a multiple of outgoing characteristic,” i.e., $\\,c_{\\text{in}} = r\\,c_{\\text{out}}\\,$ with $\\,0 \\le r \\le 1\\,$, that serves as a non-reflecting condition when $\\,u_n \\ge 0\\,$ and as a stabilizing fix when $\\,u_n < 0\\,$.\n- From first principles, show how the choice of $\\,r\\,$ affects the boundary energy production. Then, derive a condition on $\\,r\\,$, as a function of $\\,u_n\\,$ and $\\,a_0$, that guarantees the boundary energy production is non-negative, thereby ensuring no instantaneous growth of the perturbation energy due to the boundary, even when $\\,u_n < 0\\,$. Propose an implementable adaptive rule $\\,r_{\\text{eff}}(u_n)\\,$ that enforces this condition while respecting $\\,0 \\le r_{\\text{eff}} \\le 1\\,$.\n\nImplementation requirements:\n- Using your derived expressions, write a complete, runnable program that, for each test case, computes the boundary energy production per unit area $\\,B\\,$, in $\\mathrm{W/m^2}$, defined as the outward energy flux associated with the perturbations at the outlet. Assume a unit-amplitude outgoing characteristic perturbation of magnitude $\\,A_c\\,$, specified for each test case (with units of $\\mathrm{m/s}$ since each characteristic variable is the sum or difference of a velocity and an acoustic velocity potential $\\,p' / (\\rho_0 a_0))$.\n- The program must implement the following decision logic for subsonic conditions $\\,|u_n| < a_0$: when $\\,u_n \\ge 0$, use $\\,r_{\\text{eff}} = r_0$; when $\\,u_n < 0$, compute $\\,r_{\\text{eff}}\\,$ from your derived bound to ensure non-negative boundary energy production and set $\\,r_{\\text{eff}} = \\min\\!\\big(r_0, r_{\\text{bound}}(u_n,a_0)\\big)$, clipped to $\\,[0,1]$. Use the outward normal convention for $\\,u_n$.\n\nPhysical units and output specification:\n- Express each computed boundary energy production per unit area $\\,B\\,$ in $\\mathrm{W/m^2}$, rounded by the default floating-point representation of the programming language (do not format or annotate with units in the output).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, e.g., $[b_1,b_2,b_3,\\dots]$.\n\nTest suite:\nUse the following parameter sets, each specified as a tuple $\\,(\\rho_0, a_0, u_n, r_0, A_c)\\,$ with $\\,\\rho_0\\,$ in $\\mathrm{kg/m^3}$, $\\,a_0\\,$ and $\\,u_n\\,$ in $\\mathrm{m/s}$, and $\\,A_c\\,$ in $\\mathrm{m/s}$.\n- Case $1$ (subsonic outflow “happy path”): $(1.20, 340.0, 50.0, 0.20, 0.10)$.\n- Case $2$ (mild subsonic backflow): $(1.20, 340.0, -5.0, 0.20, 0.10)$.\n- Case $3$ (moderate subsonic backflow): $(1.20, 340.0, -150.0, 0.50, 0.10)$.\n- Case $4$ (near-sonic subsonic backflow edge): $(1.20, 340.0, -330.0, 0.90, 0.10)$.\n- Case $5$ (zero mean normal velocity boundary): $(1.20, 340.0, 0.0, 0.70, 0.10)$.\n\nYour program must compute and return the list $[B_1,B_2,B_3,B_4,B_5]$, where each $\\,B_i\\,$ is the boundary energy production for the corresponding case in $\\mathrm{W/m^2}$, using your derived adaptive characteristic-based fix. The output must be a single line containing the list exactly as specified.",
            "solution": "The user wants me to solve a problem in computational combustion, specifically about non-reflecting boundary conditions for linearized Euler equations.\n\nHere's my plan:\n1.  **Validate the Problem**: I need to go through the problem statement meticulously, extract all givens, and check for any flaws based on the specified criteria (scientific soundness, well-posedness, clarity, etc.). The problem seems complex and rooted in fluid dynamics and numerical methods, so it's likely valid, but I must be thorough.\n\n2.  **Derive the Solution**: If the problem is valid, I'll need to perform several derivations as requested.\n    *   **Part A: Energy Balance**:\n        *   Start with the 1D linearized compressible Euler equations (convected acoustic system).\n        *   Define the perturbation energy density. This is usually quadratic in the perturbation variables.\n        *   Derive the energy balance equation, which will have the form $\\frac{\\partial E}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$, where $E$ is the energy density and $F$ is the energy flux.\n        *   The boundary production term will be the value of the energy flux $F$ at the boundary. Express this flux in terms of the characteristic variables.\n\n    *   **Part B: Characteristic Variables**:\n        *   Take the linearized Euler equations and diagonalize the system matrix.\n        *   The characteristic variables are the transformed variables that decouple the system. They are typically sums and differences of the primitive variables (or their scaled versions).\n        *   The eigenvalues of the system matrix are the characteristic speeds, which will be in terms of $u_n$ and $a_0$. This will determine the direction of propagation (in/out of the domain).\n\n    *   **Part C: Boundary Condition Closure**:\n        *   Identify the incoming and outgoing characteristics based on the sign of their propagation speeds at the outlet.\n        *   The problem proposes a boundary condition of the form $c_{\\text{in}} = r c_{\\text{out}}$. I need to formalize this based on my classification of characteristics. The value of `r` is a reflection coefficient. $r=0$ would be a perfectly non-reflecting boundary condition.\n\n    *   **Part D: Stability Condition and Adaptive Rule**:\n        *   Substitute the boundary closure ($c_{\\text{in}} = r c_{\\text{out}}$) into the expression for the boundary energy production (the flux $F$) derived in Part A.\n        *   The goal is to find a condition on $r$ that makes the boundary energy production non-negative. This means the boundary does not spontaneously generate energy, which would lead to numerical instability. The problem states this term is the *outward energy flux*, so non-negative means energy is leaving the domain or staying constant at the boundary, not entering.\n        *   This condition will likely depend on $u_n$ and $a_0$.\n        *   Based on this condition, I'll formulate an adaptive rule for $r_{\\text{eff}}(u_n)$ that satisfies $0 \\le r_{\\text{eff}} \\le 1$ and ensures non-negative energy production, especially for the backflow case ($u_n < 0$).\n\n3.  **Implement the Code**:\n    *   Write a Python function that takes the test case parameters $(\\rho_0, a_0, u_n, r_0, A_c)$.\n    *   Implement the decision logic for $r_{\\text{eff}}$:\n        *   If $u_n \\ge 0$, $r_{\\text{eff}} = r_0$.\n        *   If $u_n < 0$, calculate the bound $r_{\\text{bound}}(u_n,a_0)$ from the stability condition, then set $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}})$, and clip this to $[0, 1]$.\n    *   Use the final value of $r_{\\text{eff}}$ to calculate the boundary energy production per unit area, $B$. This will be the energy flux $F$ evaluated at the boundary. The flux will be a function of the characteristic variables.\n    *   The problem gives an outgoing characteristic amplitude $A_c$. I'll set $c_{\\text{out}} = A_c$. Then, using the boundary condition, I'll find $c_{\\text{in}} = r_{\\text{eff}} A_c$.\n    *   With both $c_{\\text{in}}$ and $c_{\\text{out}}$ known, I can compute the primitive variables $p'$ and $u'$ at the boundary, and then compute the energy flux $F$.\n    *   Run the code for all five test cases and format the output as a list.\n\nLet's start with the detailed derivation.\n\n---\n\n### Step 1: Problem Validation\n\n**Extract Givens:**\n- Model: 1D linearized, isentropic model of compressible flow.\n- Base state: Uniform with density $\\rho_0$, speed of sound $a_0$, normal velocity at outlet $u_n$.\n- Perturbations: Velocity $u'$, pressure $p'$.\n- Isentropic closure: $p' = a_0^2 \\rho'$.\n- Problem context: Pressure outlet with intermittent backflow ($u_n$ can be negative), characteristic-based non-reflecting boundary conditions.\n- Task 1: Derive energy balance for perturbations, find boundary production term in terms of characteristic variables and base flow parameters.\n- Task 2: Define characteristic variables $c_+$ and $c_-$, classify their propagation directions by speeds in terms of $u_n$ and $a_0$.\n- Task 3: Propose boundary closure $c_{\\text{in}} = r c_{\\text{out}}$ with $0 \\le r \\le 1$.\n- Task 4: Derive condition on $r$ for non-negative boundary energy production. Propose an adaptive rule $r_{\\text{eff}}(u_n)$.\n- Implementation: Compute boundary energy production per unit area $B$ (in W/m^2), which is the outward energy flux.\n- Given: Outgoing characteristic perturbation amplitude $A_c$.\n- Adaptive rule logic:\n    - For subsonic flow $|u_n| < a_0$:\n        - If $u_n \\ge 0$, use $r_{\\text{eff}} = r_0$.\n        - If $u_n < 0$, compute $r_{\\text{bound}}(u_n, a_0)$, set $r_{\\text{eff}} = \\min(r_0, r_{\\text{bound}})$ clipped to $[0,1]$.\n- Outward normal convention for $u_n$.\n- Output format: $[B_1, B_2, B_3, B_4, B_5]$ in W/m^2.\n- Test cases:\n    1. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 50.0, 0.20, 0.10)$\n    2. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -5.0, 0.20, 0.10)$\n    3. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -150.0, 0.50, 0.10)$\n    4. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, -330.0, 0.90, 0.10)$\n    5. $(\\rho_0, a_0, u_n, r_0, A_c) = (1.20, 340.0, 0.0, 0.70, 0.10)$\n\n**Validate Using Extracted Givens:**\n- **Scientifically Grounded**: The problem is based on the linearized Euler equations, a standard model for acoustics and small perturbations in fluid dynamics. The concept of characteristic variables and non-reflecting boundary conditions is a cornerstone of computational fluid dynamics (CFD) and computational aeroacoustics (CAA). The energy method for proving stability is also a standard mathematical technique. The setup is scientifically sound.\n- **Well-Posed**: The problem is well-posed. It asks for the derivation of a condition and an implementation based on that derivation. It provides all necessary parameters and defines a clear objective. The adaptive rule ensures the problem remains stable.\n- **Objective**: The problem is stated in precise, mathematical language. All terms are standard in the field. There are no subjective or opinion-based statements.\n- **Completeness**: The problem provides all necessary base state parameters ($\\rho_0, a_0, u_n$), perturbation information ($A_c$), and boundary condition parameters ($r_0$). The isentropic relation is given. The goal is clearly defined.\n- **Consistency**: The givens are consistent. The physics described (acoustic waves on a mean flow) is internally consistent. The numerical values in the test cases are physically plausible (e.g., air density, speed of sound in air, subsonic velocities).\n- **Feasibility**: The derivations are standard in advanced fluid dynamics courses. The implementation is a straightforward application of the derived formulas.\n- **Clarity**: The terms \"boundary energy production\", \"characteristic variables\", \"incoming/outgoing\" are standard but require derivation within the context of the specific linearized system, which the problem asks for. It is unambiguous.\n- **No other flaws detected**. The problem is a standard, challenging but solvable problem in applied mathematics and engineering.\n\n**Verdict and Action:**\nThe problem is **valid**. I will proceed with the detailed derivation and solution.\n\n---\n### Step 2: Derivations\n\n**A. Linearized Equations and Energy Balance**\n\nThe 1D Euler equations for continuity and momentum are:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0\n$$\nLet $\\rho = \\rho_0 + \\rho'$, $u = u_n + u'$, $p = p_0 + p'$. The base state $(\\rho_0, u_n, p_0)$ is constant. Linearizing around this base state gives:\n$$\n\\frac{\\partial \\rho'}{\\partial t} + u_n \\frac{\\partial \\rho'}{\\partial x} + \\rho_0 \\frac{\\partial u'}{\\partial x} = 0\n$$\n$$\n\\rho_0 \\left( \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} \\right) + \\frac{\\partial p'}{\\partial x} = 0\n$$\nWe are given the isentropic closure $p' = a_0^2 \\rho'$. Substituting $\\rho' = p'/a_0^2$:\n$$\n\\frac{1}{a_0^2} \\left( \\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x} \\right) + \\rho_0 \\frac{\\partial u'}{\\partial x} = 0\n$$\n$$\n\\rho_0 \\left( \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} \\right) + \\frac{\\partial p'}{\\partial x} = 0\n$$\nLet's rewrite this in vector form. Let $\\mathbf{q} = [p', u']^T$.\n$$\n\\frac{\\partial}{\\partial t} \\begin{pmatrix} p' \\\\ u' \\end{pmatrix} + \\begin{pmatrix} u_n & \\rho_0 a_0^2 \\\\ 1/\\rho_0 & u_n \\end{pmatrix} \\frac{\\partial}{\\partial x} \\begin{pmatrix} p' \\\\ u' \\end{pmatrix} = 0\n$$\nThis is of the form $\\frac{\\partial \\mathbf{q}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{q}}{\\partial x} = 0$.\n\nNow, for the energy balance. The perturbation energy density $E$ is the sum of kinetic and potential energy of the perturbations.\n$$\nE = \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2}\n$$\nThe first term is kinetic energy $\\frac{1}{2}\\rho_0 (u')^2$. The second term is the acoustic potential energy, derived from the work done to compress the fluid, $\\int p' dV/V_0 \\approx \\int p' (d\\rho/\\rho_0) = \\int (p'/\\rho_0) (p'/a_0^2) d p' = \\frac{(p')^2}{2\\rho_0 a_0^2}$.\n\nWe need to find $\\frac{\\partial E}{\\partial t}$.\n$$\n\\frac{\\partial E}{\\partial t} = \\rho_0 u' \\frac{\\partial u'}{\\partial t} + \\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial t}\n$$\nSubstitute $\\frac{\\partial u'}{\\partial t}$ and $\\frac{\\partial p'}{\\partial t}$ from the governing equations:\n$$\n\\frac{\\partial u'}{\\partial t} = -u_n \\frac{\\partial u'}{\\partial x} - \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x}\n$$\n$$\n\\frac{\\partial p'}{\\partial t} = -u_n \\frac{\\partial p'}{\\partial x} - \\rho_0 a_0^2 \\frac{\\partial u'}{\\partial x}\n$$\nSo,\n$$\n\\frac{\\partial E}{\\partial t} = \\rho_0 u' \\left( -u_n \\frac{\\partial u'}{\\partial x} - \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x} \\right) + \\frac{p'}{\\rho_0 a_0^2} \\left( -u_n \\frac{\\partial p'}{\\partial x} - \\rho_0 a_0^2 \\frac{\\partial u'}{\\partial x} \\right)\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\rho_0 u' \\frac{\\partial u'}{\\partial x} - u' \\frac{\\partial p'}{\\partial x} - \\frac{u_n p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} - p' \\frac{\\partial u'}{\\partial x}\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\left( \\rho_0 u' \\frac{\\partial u'}{\\partial x} + \\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} \\right) - \\left( u' \\frac{\\partial p'}{\\partial x} + p' \\frac{\\partial u'}{\\partial x} \\right)\n$$\nRecognize the terms inside the parentheses as derivatives:\n$$\n\\rho_0 u' \\frac{\\partial u'}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\rho_0 (u')^2 \\right)\n$$\n$$\n\\frac{p'}{\\rho_0 a_0^2} \\frac{\\partial p'}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right)\n$$\n$$\nu' \\frac{\\partial p'}{\\partial x} + p' \\frac{\\partial u'}{\\partial x} = \\frac{\\partial}{\\partial x} (p' u')\n$$\nSubstitute these back:\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right) - \\frac{\\partial}{\\partial x} (p' u')\n$$\n$$\n\\frac{\\partial E}{\\partial t} = -u_n \\frac{\\partial E}{\\partial x} - \\frac{\\partial (p'u')}{\\partial x}\n$$\n$$\n\\frac{\\partial E}{\\partial t} + \\frac{\\partial}{\\partial x} \\underbrace{(u_n E + p' u')}_{\\text{Energy Flux } F} = 0\n$$\nThe energy balance equation is $\\frac{\\partial E}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0$, where the energy flux is $F = u_n E + p'u'$. The problem asks for the boundary energy production, which is the outward flux of energy. With an outward normal, this is simply $F$ evaluated at the boundary. Let's call it $B$.\n$$\nB = F|_{\\text{outlet}} = u_n \\left( \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2} \\right) + p' u'\n$$\nThis is the total energy flux. $u_n E$ is the convection of perturbation energy by the mean flow, and $p'u'$ is the acoustic energy flux (work done by pressure perturbations).\n\n**B. Characteristic Variables**\n\nWe need to find the eigenvalues and eigenvectors of the matrix $\\mathbf{A} = \\begin{pmatrix} u_n & \\rho_0 a_0^2 \\\\ 1/\\rho_0 & u_n \\end{pmatrix}$.\nThe characteristic equation is $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$.\n$$\n(u_n - \\lambda)^2 - (\\rho_0 a_0^2)(1/\\rho_0) = 0\n$$\n$$\n(u_n - \\lambda)^2 - a_0^2 = 0\n$$\n$$\nu_n - \\lambda = \\pm a_0 \\implies \\lambda = u_n \\pm a_0\n$$\nThe eigenvalues (characteristic speeds) are $\\lambda_+ = u_n + a_0$ and $\\lambda_- = u_n - a_0$.\n\nThe corresponding left eigenvectors $\\mathbf{l}^T$ satisfy $\\mathbf{l}^T \\mathbf{A} = \\lambda \\mathbf{l}^T$.\nFor $\\lambda_+ = u_n + a_0$:\n$$\n[l_1, l_2] \\begin{pmatrix} u_n & \\rho_0 a_0^2 \\\\ 1/\\rho_0 & u_n \\end{pmatrix} = (u_n + a_0) [l_1, l_2]\n$$\n$$\nl_1 u_n + l_2/\\rho_0 = (u_n+a_0)l_1 \\implies l_2/\\rho_0 = a_0 l_1 \\implies l_2 = \\rho_0 a_0 l_1\n$$\nChoosing $l_1 = 1$, we get $\\mathbf{l}_+^T = [1, \\rho_0 a_0]$.\n\nFor $\\lambda_- = u_n - a_0$:\n$$\n[l_1, l_2] \\begin{pmatrix} u_n & \\rho_0 a_0^2 \\\\ 1/\\rho_0 & u_n \\end{pmatrix} = (u_n - a_0) [l_1, l_2]\n$$\n$$\nl_1 u_n + l_2/\\rho_0 = (u_n-a_0)l_1 \\implies l_2/\\rho_0 = -a_0 l_1 \\implies l_2 = -\\rho_0 a_0 l_1\n$$\nChoosing $l_1 = 1$, we get $\\mathbf{l}_-^T = [1, -\\rho_0 a_0]$.\n\nThe characteristic variables are defined by $d c = \\mathbf{l}^T d\\mathbf{q}$. Integrating, we get:\n$$\nc'_{+} = p' + \\rho_0 a_0 u'\n$$\n$$\nc'_{-} = p' - \\rho_0 a_0 u'\n$$\nThis is a standard definition. However, the problem states that characteristics have units of velocity. Let's rescale. A common convention is to divide by $\\rho_0 a_0$. Let's try that.\nLet $L_1 = \\frac{1}{2}(\\dots)$ and $L_2=\\frac{1}{2}(\\dots)$. Let's see. The problem relates $c$ to velocity and acoustic velocity potential $p'/(\\rho_0 a_0)$. Let's try $c = u' \\pm \\frac{p'}{\\rho_0 a_0}$.\nLet's see if this works.\n$p' = \\frac{\\rho_0 a_0}{2} (c_+ - c_-)$ where this time $c_+ = u' + p'/(\\rho_0 a_0)$ and $c_- = u' - p'/(\\rho_0 a_0)$? No, that's not right.\nThe sum gives $c_+ + c_- = 2u'$. So, $u' = (c_+ + c_-)/2$.\nThe difference gives $c_+ - c_- = 2p'/(\\rho_0 a_0)$. So, $p' = \\frac{\\rho_0 a_0}{2}(c_+ - c_-)$.\nLet's check the governing equations with these new variables.\nTake the original equations:\n$1) \\frac{1}{\\rho_0 a_0} (\\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x}) + a_0 \\frac{\\partial u'}{\\partial x} = 0$\n$2) \\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} + \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x} = 0$\nLet's add and subtract them.\n$(2) + (1)/a_0$:\n$$\n\\left(\\frac{\\partial u'}{\\partial t} + u_n \\frac{\\partial u'}{\\partial x} + \\frac{1}{\\rho_0} \\frac{\\partial p'}{\\partial x}\\right) + \\frac{1}{\\rho_0 a_0^2}\\left(\\frac{\\partial p'}{\\partial t} + u_n \\frac{\\partial p'}{\\partial x}\\right) + \\frac{\\partial u'}{\\partial x} = 0\n$$\nThis is not leading to a simple form.\n\nLet's stick to the eigenvector definition first, and then relate to the hint.\n$c'_{+} = p' + \\rho_0 a_0 u'$\n$c'_{-} = p' - \\rho_0 a_0 u'$\nThis leads to the characteristic form of the equations:\n$$\n\\frac{\\partial c'_{+}}{\\partial t} + (u_n+a_0) \\frac{\\partial c'_{+}}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial c'_{-}}{\\partial t} + (u_n-a_0) \\frac{\\partial c'_{-}}{\\partial x} = 0\n$$\nThis confirms that $c'_+$ propagates with speed $\\lambda_+ = u_n+a_0$ and $c'_-$ propagates with speed $\\lambda_- = u_n-a_0$.\n\nNow let's connect to the problem's hint. The hint seems to define the characteristics as having units of velocity. Let's define:\n$$\nc_+ = u' + \\frac{p'}{\\rho_0 a_0}\n$$\n$$\nc_- = -u' + \\frac{p'}{\\rho_0 a_0}\n$$\nThis is another common convention.\nFrom this definition:\n$p' = \\frac{\\rho_0 a_0}{2} (c_+ + c_-)$\n$u' = \\frac{1}{2} (c_+ - c_-)$\n\nWait, let's use the definition given by my eigenvectors, but scaled.\nLet $c_+ = \\frac{c'_+}{\\rho_0 a_0} = \\frac{p'}{\\rho_0 a_0} + u'$\nLet $c_- = \\frac{c'_-}{\\rho_0 a_0} = \\frac{p'}{\\rho_0 a_0} - u'$\nThen:\n$u' = \\frac{1}{2}(c_+ - c_-)$\n$p' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-)$\nThese are the so-called acoustic characteristic variables. Let's verify their propagation speeds.\nLet's substitute $p'$ and $u'$ in the governing equations.\n$\\frac{\\partial u'}{\\partial t} = \\frac{1}{2}(\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t})$\n$\\frac{\\partial p'}{\\partial t} = \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t})$\nSubstitute into momentum equation:\n$\\rho_0 \\frac{1}{2}(\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t}) + \\rho_0 u_n \\frac{1}{2}(\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) + \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) = 0$\n$\\implies (\\frac{\\partial c_+}{\\partial t} - \\frac{\\partial c_-}{\\partial t}) + u_n (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) + a_0 (\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) = 0$\n(Eq A) $\\implies \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} - \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0$\n\nSubstitute into continuity equation (divided by $\\rho_0$):\n$\\frac{1}{\\rho_0 a_0^2} \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + \\frac{u_n}{\\rho_0 a_0^2} \\frac{\\rho_0 a_0}{2}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + \\frac{1}{2}(\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\n$\\implies \\frac{1}{a_0}(\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + \\frac{u_n}{a_0}(\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\nMultiply by $a_0$:\n$\\implies (\\frac{\\partial c_+}{\\partial t} + \\frac{\\partial c_-}{\\partial t}) + u_n (\\frac{\\partial c_+}{\\partial x} + \\frac{\\partial c_-}{\\partial x}) + a_0 (\\frac{\\partial c_+}{\\partial x} - \\frac{\\partial c_-}{\\partial x}) = 0$\n(Eq B) $\\implies \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} + \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0$\n\nAdding (Eq A) and (Eq B):\n$2 \\left( \\frac{\\partial c_+}{\\partial t} + (u_n+a_0)\\frac{\\partial c_+}{\\partial x} \\right) = 0 \\implies \\frac{\\partial c_+}{\\partial t} + \\lambda_+ \\frac{\\partial c_+}{\\partial x} = 0$, with $\\lambda_+ = u_n+a_0$.\nSubtracting (Eq A) from (Eq B):\n$2 \\left( \\frac{\\partial c_-}{\\partial t} + (u_n-a_0)\\frac{\\partial c_-}{\\partial x} \\right) = 0 \\implies \\frac{\\partial c_-}{\\partial t} + \\lambda_- \\frac{\\partial c_-}{\\partial x} = 0$, with $\\lambda_- = u_n-a_0$.\nThis confirms my choice of characteristic variables and their propagation speeds.\n$c_+ = \\frac{p'}{\\rho_0 a_0} + u'$, propagates with speed $\\lambda_+ = u_n+a_0$.\n$c_- = \\frac{p'}{\\rho_0 a_0} - u'$, propagates with speed $\\lambda_- = u_n-a_0$.\n\n**C. Boundary Condition and Energy Production in terms of characteristics**\nThe outlet is at the right end of the domain (say $x=L$). The outward normal is in the $+x$ direction.\n- A characteristic is *outgoing* if it propagates out of the domain. At $x=L$, this means its speed must be positive.\n- A characteristic is *incoming* if it propagates into the domain. At $x=L$, this means its speed must be negative.\n\nWe are given subsonic flow, $|u_n| < a_0$.\n- $\\lambda_+ = u_n + a_0$. Since $u_n > -a_0$, $\\lambda_+ > 0$. So $c_+$ is always outgoing.\n- $\\lambda_- = u_n - a_0$. Since $u_n < a_0$, $\\lambda_- < 0$. So $c_-$ is always incoming.\n\nSo, for the subsonic outlet:\n- Outgoing characteristic: $c_{\\text{out}} = c_+ = \\frac{p'}{\\rho_0 a_0} + u'$\n- Incoming characteristic: $c_{\\text{in}} = c_- = \\frac{p'}{\\rho_0 a_0} - u'$\n\nThe proposed boundary condition is $c_{\\text{in}} = r c_{\\text{out}}$, which translates to:\n$c_- = r c_+$\nThis relation determines the state at the boundary once the outgoing characteristic is known.\n\nNow, let's express the boundary energy production $B$ in terms of $c_+$ and $c_-$.\nWe have $B = u_n E + p' u'$.\nAnd $E = \\frac{1}{2} \\rho_0 (u')^2 + \\frac{1}{2} \\frac{(p')^2}{\\rho_0 a_0^2}$.\nFrom our characteristic definitions:\n$u' = \\frac{1}{2}(c_+ - c_-)$\n$p' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-)$\nSubstitute these into $E$:\n$E = \\frac{1}{2} \\rho_0 \\left(\\frac{1}{2}(c_+ - c_-)\\right)^2 + \\frac{1}{2} \\frac{1}{\\rho_0 a_0^2} \\left(\\frac{\\rho_0 a_0}{2}(c_+ + c_-)\\right)^2$\n$E = \\frac{1}{8} \\rho_0 (c_+^2 - 2c_+c_- + c_-^2) + \\frac{1}{8} \\frac{\\rho_0^2 a_0^2}{\\rho_0 a_0^2} (c_+^2 + 2c_+c_- + c_-^2)$\n$E = \\frac{\\rho_0}{8} (c_+^2 - 2c_+c_- + c_-^2 + c_+^2 + 2c_+c_- + c_-^2)$\n$E = \\frac{\\rho_0}{8} (2c_+^2 + 2c_-^2) = \\frac{\\rho_0}{4} (c_+^2 + c_-^2)$\n\nNow substitute for $p'u'$:\n$p'u' = \\frac{\\rho_0 a_0}{2}(c_+ + c_-) \\cdot \\frac{1}{2}(c_+ - c_-) = \\frac{\\rho_0 a_0}{4} (c_+^2 - c_-^2)$\n\nNow assemble the total energy flux $B$:\n$B = u_n E + p'u' = u_n \\frac{\\rho_0}{4} (c_+^2 + c_-^2) + \\frac{\\rho_0 a_0}{4} (c_+^2 - c_-^2)$\n$B = \\frac{\\rho_0}{4} \\left[ u_n(c_+^2 + c_-^2) + a_0(c_+^2 - c_-^2) \\right]$\n$B = \\frac{\\rho_0}{4} \\left[ (u_n+a_0)c_+^2 - (a_0-u_n)c_-^2 \\right]$\n\nThis is the boundary production term (outward energy flux) expressed in terms of characteristic variables and base flow parameters.\n\n**D. Stability Condition and Adaptive Rule**\n\nNow apply the boundary condition $c_- = r c_{+}$.\n$B = \\frac{\\rho_0}{4} \\left[ (u_n+a_0)c_+^2 - (a_0-u_n)(r c_+)^2 \\right]$\n$B = \\frac{\\rho_0}{4} c_+^2 \\left[ (u_n+a_0) - (a_0-u_n)r^2 \\right]$\n\nThe problem requires non-negative boundary energy production, $B \\ge 0$. Since $\\frac{\\rho_0}{4} c_+^2 \\ge 0$, this is equivalent to requiring:\n$(u_n+a_0) - (a_0-u_n)r^2 \\ge 0$\n$(u_n+a_0) \\ge (a_0-u_n)r^2$\n$r^2 \\le \\frac{a_0+u_n}{a_0-u_n}$\nSince $r \\ge 0$, the condition on $r$ is:\n$r \\le \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$\n\nLet's check this condition:\n- For outflow, $u_n \\ge 0$. The fraction $\\frac{a_0+u_n}{a_0-u_n} \\ge 1$. So $\\sqrt{\\frac{a_0+u_n}{a_0-u_n}} \\ge 1$.\n  The condition becomes $r \\le (\\text{something} \\ge 1)$. Since the problem states $0 \\le r \\le 1$, this condition is always fulfilled for any valid $r$ when $u_n \\ge 0$. This confirms that standard non-reflecting boundary conditions ($r=0$) or partially reflecting ones ($0 < r \\le 1$) are stable for outflow.\n- For backflow, $u_n < 0$. Let $u_n = -|u_n|$. The fraction is $\\frac{a_0-|u_n|}{a_0+|u_n|} < 1$. This imposes a non-trivial constraint on $r$.\n  For stability during backflow, we need $r$ to be small enough. The maximum allowed value for $r$ is:\n  $r_{\\text{bound}}(u_n, a_0) = \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$\n  This is the condition on $r$ that guarantees $B \\ge 0$.\n\nNow, let's formulate the adaptive rule $r_{\\text{eff}}(u_n)$ as specified.\n- For subsonic flow $|u_n| < a_0$.\n- Given a desired reflection coefficient $r_0$ for the \"happy path\" (outflow).\n- **If $u_n \\ge 0$**: `r_eff = r_0`. This is stable as shown above.\n- **If $u_n < 0$**: We must satisfy $r \\le r_{\\text{bound}}$. The problem logic is to use `r_eff = min(r_0, r_bound)`, and then clip to $[0,1]$.\n  $r_{\\text{bound}} = \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}$. Since $u_n < 0$ and $|u_n| < a_0$, we have $0 < a_0+u_n < a_0-u_n$. Thus $0 < \\frac{a_0+u_n}{a_0-u_n} < 1$, which means $0 < r_{\\text{bound}} < 1$.\n  So the clipping to $[0,1]$ is automatically satisfied for $r_{\\text{bound}}$ and for $r_{eff} = \\min(r_0, r_{bound})$ given $r_0 \\in [0,1]$. So the clipping is redundant for this part, but good practice.\n  The adaptive rule is:\n  $r_{\\text{eff}} = \\begin{cases} r_0 & \\text{if } u_n \\ge 0 \\\\ \\min\\left(r_0, \\sqrt{\\frac{a_0+u_n}{a_0-u_n}}\\right) & \\text{if } u_n < 0 \\end{cases}$\n\n**Final formula for implementation**\nThe problem gives us an amplitude for the outgoing characteristic, $A_c$. So, we set $c_{\\text{out}} = c_+ = A_c$.\nThe incoming characteristic is $c_{\\text{in}} = c_- = r_{\\text{eff}} c_+ = r_{\\text{eff}} A_c$.\nThe formula for the boundary energy production per unit area, $B$, is:\n$B = \\frac{\\rho_0}{4} A_c^2 \\left[ (u_n+a_0) - (a_0-u_n)r_{\\text{eff}}^2 \\right]$\nwhere $r_{\\text{eff}}$ is calculated using the adaptive rule above.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.20, 340.0, 50.0, 0.20, 0.10),   # Case 1\n        (1.20, 340.0, -5.0, 0.20, 0.10),   # Case 2\n        (1.20, 340.0, -150.0, 0.50, 0.10), # Case 3\n        (1.20, 340.0, -330.0, 0.90, 0.10), # Case 4\n        (1.20, 340.0, 0.0, 0.70, 0.10),    # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        rho0, a0, un, r0, Ac = case\n\n        # Determine the effective reflection coefficient r_eff based on the adaptive rule\n        if un >= 0:\n            # For outflow or zero mean velocity, use the specified reflection coefficient r0\n            r_eff = r0\n        else: # un < 0 (backflow)\n            # Ensure the argument of the square root is non-negative.\n            # For backflow (|un| < a0), we have -a0 < un < 0, so a0 + un > 0 and a0 - un > 0.\n            # Thus, the argument is always positive.\n            r_bound = np.sqrt((a0 + un) / (a0 - un))\n            \n            # Use the smaller of r0 and the stability-derived bound r_bound\n            r_eff = np.minimum(r0, r_bound)\n            \n            # Per problem spec, clip the result to the range [0, 1].\n            # This is technically redundant given the problem constraints (0<=r0<=1 and r_bound is in [0,1)),\n            # but it is good practice to enforce it explicitly.\n            r_eff = np.clip(r_eff, 0.0, 1.0)\n\n        # Calculate the boundary energy production per unit area, B\n        # This formula was derived from first principles in the solution text.\n        # B = (rho0 / 4) * Ac^2 * [ (a0 + un) - (a0 - un) * r_eff^2 ]\n        \n        term1 = a0 + un\n        term2 = (a0 - un) * r_eff**2\n        \n        B = (rho0 / 4.0) * (Ac**2) * (term1 - term2)\n        \n        results.append(B)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In long-duration simulations like Large Eddy Simulation (LES), even small, persistent errors at the boundaries can accumulate and contaminate the solution. This advanced practice introduces a technique to combat such low-frequency drift. You will implement a control strategy that applies a high-pass filter to the incoming characteristic, effectively zeroing out its local time-average and enhancing the long-term accuracy and stability of the simulation .",
            "id": "4011769",
            "problem": "You are asked to implement and analyze a characteristic-based non-reflecting boundary condition in the context of compressible flow relevant to computational combustion, with an augmented constraint that reduces low-frequency reflection during long Large Eddy Simulation (LES). The setting is a one-dimensional outlet boundary of a compressible flow governed by the linearized form of the compressible Euler equations around a uniform base state. The derivation and implementation must begin from the following well-tested base and definitions:\n\nConsider a uniform base state with constant density $ \\rho_0 $ in $ \\mathrm{kg/m^3} $, sound speed $ c_0 $ in $ \\mathrm{m/s} $, and streamwise mean velocity $ u_0 $ in $ \\mathrm{m/s} $. Define perturbations $ p'(x,t) $ in $ \\mathrm{Pa} $ and $ u'(x,t) $ in $ \\mathrm{m/s} $. For one-dimensional linearized acoustics about the base state, the characteristic variables at the boundary are\n$$\nR^+(t) = \\frac{p'(t)}{\\rho_0 c_0} + u'(t), \\quad\nR^-(t) = \\frac{p'(t)}{\\rho_0 c_0} - u'(t),\n$$\nwhere $ R^+ $ travels with speed $ u_0 + c_0 $ and $ R^- $ travels with speed $ u_0 - c_0 $. For subsonic outflow, i.e., Mach number $ M = \\frac{u_0}{c_0} $ satisfying $ 0 < M < 1 $, the incoming characteristic at the outlet is $ R^- $. For supersonic outflow, i.e., $ M \\ge 1 $, all characteristics are outgoing, and physically, no incoming wave should be imposed.\n\nThe goal is to enforce a zero-mean incoming acoustic amplitude over an averaging window to reduce low-frequency reflection. Formally, given a time series $ R^-_{\\mathrm{raw}}(n) $ with $ n = 0,1,\\dots, N-1 $ representing the nominal incoming characteristic one would otherwise impose, the controlled incoming characteristic $ R^-_{\\mathrm{ctrl}}(n) $ should be defined for subsonic outflow by subtracting the trailing-window mean of length $ W $ from the raw series, i.e.,\n$$\n\\mu(n) = \\frac{1}{m(n)} \\sum_{k=0}^{m(n)-1} R^-_{\\mathrm{raw}}(n-k), \\quad m(n) = \\min(W, n+1),\n$$\n$$\nR^-_{\\mathrm{ctrl}}(n) = R^-_{\\mathrm{raw}}(n) - \\mu(n).\n$$\nFor supersonic outflow, i.e., $ M \\ge 1 $, set $ R^-_{\\mathrm{ctrl}}(n) = 0 $ for all $ n $.\n\nThe outlet perturbation pressure and velocity at each time $ n $ can be reconstructed from $ R^+(n) $ and $ R^-_{\\mathrm{ctrl}}(n) $ by solving the linear system implied by the characteristic definitions:\n$$\np'(n) = \\frac{\\rho_0 c_0}{2} \\left( R^+(n) + R^-_{\\mathrm{ctrl}}(n) \\right), \\quad\nu'(n) = \\frac{1}{2} \\left( R^+(n) - R^-_{\\mathrm{ctrl}}(n) \\right).\n$$\nThese reconstructions are physically consistent and are provided to ensure clarity on units and connections to the characteristic variables. The focus of the test is the enforcement and measurement of the incoming characteristic mean over the window.\n\nYou must implement a program that, for each test case defined below, generates time series $ R^+(n) $ and $ R^-_{\\mathrm{raw}}(n) $ over $ N $ time steps with time step $ \\Delta t $, applies the above control to obtain $ R^-_{\\mathrm{ctrl}}(n) $, and returns the final-window mean of the controlled incoming characteristic, i.e.,\n$$\n\\overline{R^-_{\\mathrm{ctrl}}}\\big|_{\\mathrm{final\\ window}} = \\frac{1}{m_{\\mathrm{final}}} \\sum_{n=N-m_{\\mathrm{final}}}^{N-1} R^-_{\\mathrm{ctrl}}(n), \\quad m_{\\mathrm{final}} = \\min(W, N),\n$$\nexpressed in $ \\mathrm{m/s} $ as a float. The time series $ R^+(n) $ and $ R^-_{\\mathrm{raw}}(n) $ must be generated as specified per test case using combinations of sinusoidal content and constant offsets to emulate acoustic content and low-frequency drift seen in long LES runs.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $ [r_1,r_2,r_3,r_4] $), where each $ r_i $ is the final-window mean of $ R^-_{\\mathrm{ctrl}} $ in $ \\mathrm{m/s} $ for the $ i $-th test case, rounded to six decimal places.\n\nImplement the following test suite. All quantities with physical units are given in International System of Units (SI). Use $ \\rho_0 = 1.2\\ \\mathrm{kg/m^3} $ and $ c_0 = 340\\ \\mathrm{m/s} $ in all cases. The time step is $ \\Delta t = 5 \\times 10^{-4}\\ \\mathrm{s} $ and the number of time steps is $ N = 4096 $ in all cases, so the total simulated time is $ T = N \\Delta t $.\n\n- Test case $ 1 $ (subsonic outflow with slow drift, moderate window):\n  - Mach number $ M = 0.6 $, so $ u_0 = M c_0 $.\n  - Window length $ W = 256 $.\n  - Define $ R^+(n) = A \\sin(2 \\pi f_{\\mathrm{hi}} n \\Delta t) $ with $ A = 1.0\\ \\mathrm{m/s} $ and $ f_{\\mathrm{hi}} = 100\\ \\mathrm{Hz} $.\n  - Define $ R^-_{\\mathrm{raw}}(n) = B + D \\sin(2 \\pi f_{\\mathrm{lo}} n \\Delta t) + \\beta R^+(n) $ with $ B = 0.05\\ \\mathrm{m/s} $, $ D = 0.2\\ \\mathrm{m/s} $, $ f_{\\mathrm{lo}} = 0.2\\ \\mathrm{Hz} $, and $ \\beta = 0.4 $.\n\n- Test case $ 2 $ (subsonic outflow with zero-mean sinusoidal incoming target, larger window):\n  - Mach number $ M = 0.3 $, so $ u_0 = M c_0 $.\n  - Window length $ W = 512 $.\n  - Define $ R^+(n) = A \\sin(2 \\pi f_{\\mathrm{hi}} n \\Delta t) $ with $ A = 0.8\\ \\mathrm{m/s} $ and $ f_{\\mathrm{hi}} = 120\\ \\mathrm{Hz} $.\n  - Define $ R^-_{\\mathrm{raw}}(n) = \\gamma \\sin(2 \\pi f_{\\mathrm{hi}} n \\Delta t) $ with $ \\gamma = 0.5\\ \\mathrm{m/s} $.\n\n- Test case $ 3 $ (supersonic outflow):\n  - Mach number $ M = 1.2 $, so $ u_0 = M c_0 $.\n  - Window length $ W = 512 $.\n  - Define $ R^+(n) = A \\sin(2 \\pi f_{\\mathrm{hi}} n \\Delta t) $ with $ A = 1.0\\ \\mathrm{m/s} $ and $ f_{\\mathrm{hi}} = 80\\ \\mathrm{Hz} $.\n  - Define $ R^-_{\\mathrm{raw}}(n) = B + \\beta R^+(n) $ with $ B = 0.1\\ \\mathrm{m/s} $ and $ \\beta = 0.3 $. Since $ M \\ge 1 $, your implementation must set $ R^-_{\\mathrm{ctrl}}(n) = 0 $.\n\n- Test case $ 4 $ (subsonic outflow with constant offset and small window):\n  - Mach number $ M = 0.9 $, so $ u_0 = M c_0 $.\n  - Window length $ W = 8 $.\n  - Define $ R^+(n) = A \\sin(2 \\pi f_{\\mathrm{hi}} n \\Delta t) $ with $ A = 1.2\\ \\mathrm{m/s} $ and $ f_{\\mathrm{hi}} = 90\\ \\mathrm{Hz} $.\n  - Define $ R^-_{\\mathrm{raw}}(n) = B + \\beta R^+(n) $ with $ B = 0.1\\ \\mathrm{m/s} $ and $ \\beta = 0.3 $.\n\nFor each test case, compute and return the final-window mean $ \\overline{R^-_{\\mathrm{ctrl}}}\\big|_{\\mathrm{final\\ window}} $ in $ \\mathrm{m/s} $ as a float rounded to six decimal places. Your program should produce a single line of output containing these four results as a comma-separated list enclosed in square brackets, with no additional text.",
            "solution": "The problem presented requires the implementation and evaluation of a characteristic-based non-reflecting boundary condition for a one-dimensional compressible flow outlet, augmented with a control mechanism to suppress low-frequency reflections. The solution involves generating time-dependent characteristic variables, applying the specified control law, and calculating a performance metric for four distinct test cases. The entire procedure is predicated on the linearized theory of acoustics superimposed on a uniform mean flow.\n\nThe fundamental quantities are the characteristic variables $R^+(t)$ and $R^-(t)$, representing wave amplitudes propagating with speeds $u_0 + c_0$ and $u_0 - c_0$, respectively. For an outlet boundary, the state is determined by the outgoing characteristic $R^+(n)$ arriving from the interior of the computational domain and the incoming characteristic $R^-(n)$ that must be specified as a boundary condition. The core of the problem lies in the prescription for this incoming characteristic, denoted $R^-_{\\mathrm{ctrl}}(n)$.\n\nThe first step for each test case is to determine the flow regime based on the Mach number $M = u_0/c_0$.\nIf the flow is supersonic ($M \\ge 1$), both characteristic speeds $u_0+c_0$ and $u_0-c_0$ are positive, meaning all waves are outgoing from the domain. Physically, no information should propagate from the boundary into the domain. The problem correctly codifies this by stating that for $M \\ge 1$, the controlled incoming characteristic must be set to zero for all time steps: $R^-_{\\mathrm{ctrl}}(n) = 0$.\n\nIf the flow is subsonic ($0 < M < 1$), the characteristic speed $u_0-c_0$ is negative, indicating that $R^-$ is an incoming wave that propagates information into the domain. The boundary condition must specify its value. The problem defines a raw incoming characteristic, $R^-_{\\mathrm{raw}}(n)$, and applies a control law to produce the value that is actually imposed, $R^-_{\\mathrm{ctrl}}(n)$. This control law is designed to nullify the local time-averaged value of the incoming signal, thereby damping low-frequency oscillations or drift. The control is defined as:\n$$\nR^-_{\\mathrm{ctrl}}(n) = R^-_{\\mathrm{raw}}(n) - \\mu(n)\n$$\nwhere $\\mu(n)$ is the trailing-window mean of $R^-_{\\mathrm{raw}}$:\n$$\n\\mu(n) = \\frac{1}{m(n)} \\sum_{k=0}^{m(n)-1} R^-_{\\mathrm{raw}}(n-k)\n$$\nThe averaging window length, $m(n) = \\min(W, n+1)$, carefully handles the initialization phase of the simulation. For the initial steps where $n < W-1$, the window includes all samples from a time index of $0$ to $n$. For all subsequent steps $n \\ge W-1$, a fixed-size window of length $W$ is used.\n\nThe algorithmic procedure for a given test case is as follows:\n$1$. Initialize constants: density $\\rho_0 = 1.2\\ \\mathrm{kg/m^3}$, sound speed $c_0 = 340\\ \\mathrm{m/s}$, time step $\\Delta t = 5 \\times 10^{-4}\\ \\mathrm{s}$, and number of steps $N = 4096$.\n$2$. For each test case, retrieve the parameters: $M$, $W$, and the coefficients defining the time series.\n$3$. Generate the discrete time array for $n = 0, 1, \\dots, N-1$.\n$4$. Synthesize the time series for the outgoing characteristic $R^+(n)$ and the raw incoming characteristic $R^-_{\\mathrm{raw}}(n)$ according to their specified functional forms.\n$5$. Evaluate the Mach number $M$. If $M \\ge 1$ (supersonic case), create the controlled incoming characteristic array $R^-_{\\mathrm{ctrl}}$ as a sequence of zeros of length $N$.\n$6$. If $M < 1$ (subsonic case), compute the $R^-_{\\mathrm{ctrl}}(n)$ series. This requires computing the trailing-window mean $\\mu(n)$ for each step $n$. An efficient method to calculate the moving average $\\mu(n)$ is to first compute the cumulative sum of $R^-_{\\mathrm{raw}}(n)$. Let $S[i] = \\sum_{j=0}^{i} R^-_{\\mathrm{raw}}(j)$.\n   - For $n < W$, the sum required for the mean is $\\sum_{j=0}^{n} R^-_{\\mathrm{raw}}(j)$, which is simply $S[n]$. The mean is $\\mu(n) = S[n] / (n+1)$.\n   - For $n \\ge W$, the sum over the window of length $W$ ending at $n$ is $\\sum_{j=n-W+1}^{n} R^-_{\\mathrm{raw}}(j)$, which can be computed as $S[n] - S[n-W]$. The mean is $\\mu(n) = (S[n] - S[n-W]) / W$.\nAfter computing the series $\\mu(n)$, $R^-_{\\mathrm{ctrl}}(n)$ is found by element-wise subtraction: $R^-_{\\mathrm{ctrl}}[n] = R^-_{\\mathrm{raw}}[n] - \\mu[n]$.\n$7$. The final step is to calculate the required output metric: the mean of $R^-_{\\mathrm{ctrl}}(n)$ over the final window. The size of this window is $m_{\\mathrm{final}} = \\min(W, N)$. The value is computed by averaging the last $m_{\\mathrm{final}}$ elements of the $R^-_{\\mathrm{ctrl}}$ time series.\n$8$. This process is repeated for each of the four test cases, and the resulting four floating-point numbers are collected, rounded to six decimal places, and formatted as specified.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a characteristic-based non-reflecting boundary condition\n    for four test cases according to the problem specification.\n    \"\"\"\n    # Global constants\n    rho_0 = 1.2  # kg/m^3\n    c_0 = 340.0  # m/s\n    dt = 5e-4  # s\n    N = 4096   # number of time steps\n\n    test_cases = [\n        {\n            \"id\": 1,\n            \"M\": 0.6, \"W\": 256,\n            \"R_plus_params\": {\"A\": 1.0, \"f_hi\": 100.0},\n            \"R_raw_minus_params\": {\"B\": 0.05, \"D\": 0.2, \"f_lo\": 0.2, \"beta\": 0.4}\n        },\n        {\n            \"id\": 2,\n            \"M\": 0.3, \"W\": 512,\n            \"R_plus_params\": {\"A\": 0.8, \"f_hi\": 120.0},\n            \"R_raw_minus_params\": {\"gamma\": 0.5}\n        },\n        {\n            \"id\": 3,\n            \"M\": 1.2, \"W\": 512,\n            \"R_plus_params\": {\"A\": 1.0, \"f_hi\": 80.0},\n            \"R_raw_minus_params\": {\"B\": 0.1, \"beta\": 0.3}\n        },\n        {\n            \"id\": 4,\n            \"M\": 0.9, \"W\": 8,\n            \"R_plus_params\": {\"A\": 1.2, \"f_hi\": 90.0},\n            \"R_raw_minus_params\": {\"B\": 0.1, \"beta\": 0.3}\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        M = case[\"M\"]\n        W = case[\"W\"]\n        \n        n_steps = np.arange(N)\n        t_steps = n_steps * dt\n\n        # Generate R_plus(n)\n        rp_params = case[\"R_plus_params\"]\n        A = rp_params[\"A\"]\n        f_hi = rp_params[\"f_hi\"]\n        R_plus_n = A * np.sin(2 * np.pi * f_hi * t_steps)\n\n        # Generate R_raw_minus(n)\n        rm_params = case[\"R_raw_minus_params\"]\n        if case[\"id\"] == 1:\n            B, D, f_lo, beta = rm_params[\"B\"], rm_params[\"D\"], rm_params[\"f_lo\"], rm_params[\"beta\"]\n            R_raw_minus_n = B + D * np.sin(2 * np.pi * f_lo * t_steps) + beta * R_plus_n\n        elif case[\"id\"] == 2:\n            gamma = rm_params[\"gamma\"]\n            # To generate the required signal correctly, we must use the 'f_hi' from this case's R_plus\n            f_hi_case2 = rp_params[\"f_hi\"]\n            R_raw_minus_n = gamma * np.sin(2 * np.pi * f_hi_case2 * t_steps)\n        elif case[\"id\"] == 3 or case[\"id\"] == 4:\n            B, beta = rm_params[\"B\"], rm_params[\"beta\"]\n            R_raw_minus_n = B + beta * R_plus_n\n\n        # Calculate R_ctrl_minus(n)\n        R_ctrl_minus_n = np.zeros(N)\n        if M < 1:  # Subsonic outflow\n            # Efficiently compute the trailing-window mean mu(n)\n            # using cumulative sums.\n            mu = np.zeros(N)\n            S = np.cumsum(R_raw_minus_n)\n            \n            # For n < W, m(n) = n + 1\n            # For this part, the window grows up to size W\n            num_initial = min(W, N)\n            mu[:num_initial] = S[:num_initial] / np.arange(1, num_initial + 1)\n            \n            # For n >= W, m(n) = W\n            # For this part, the window has a fixed size W\n            if N > W:\n                sum_over_W = S[W:] - S[:-W]\n                mu[W:] = sum_over_W / W\n\n            R_ctrl_minus_n = R_raw_minus_n - mu\n        else:  # Supersonic outflow\n            R_ctrl_minus_n.fill(0.0)\n\n        # Calculate final-window mean\n        m_final = min(W, N)\n        final_window_slice = R_ctrl_minus_n[N - m_final:]\n        final_mean = np.mean(final_window_slice)\n        \n        results.append(round(final_mean, 6))\n\n    # Format output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}