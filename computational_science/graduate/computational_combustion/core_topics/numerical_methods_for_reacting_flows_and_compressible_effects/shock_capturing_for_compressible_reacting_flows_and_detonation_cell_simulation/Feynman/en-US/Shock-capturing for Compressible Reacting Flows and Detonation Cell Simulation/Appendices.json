{
    "hands_on_practices": [
        {
            "introduction": "The first step in any credible simulation is understanding the physical scales of the problem and whether your computational grid can resolve them. In reacting flows, the competition between advection (transport by the flow) and diffusion (molecular transport of heat and mass) is paramount. This exercise  will guide you through a fundamental scale analysis using the Peclet ($Pe$) and Schmidt ($Sc$) numbers to determine if the critical, thin reaction-diffusion layers in a detonation are even visible at the chosen grid resolution.",
            "id": "4061400",
            "problem": "Consider a two-dimensional simulation of detonation cells in a premixed reactive gas under high-temperature conditions. The post-shock, mean-flow properties in the reaction zone are approximately constant over a characteristic cellular length scale $L$. Assume the following typical values representative of strongly compressible reactive flows at detonation conditions: a characteristic convective speed $U = 2000$ $\\mathrm{m/s}$, a cellular length scale $L = 5.0 \\times 10^{-3}$ $\\mathrm{m}$, thermal diffusivity $\\alpha = 3.0 \\times 10^{-4}$ $\\mathrm{m^2/s}$, kinematic viscosity $\\nu = 4.0 \\times 10^{-4}$ $\\mathrm{m^2/s}$, and species mass diffusivity $D = 1.2 \\times 10^{-3}$ $\\mathrm{m^2/s}$. The simulation employs a uniform Cartesian grid with spacing $\\Delta x = 1.0 \\times 10^{-5}$ $\\mathrm{m}$ and a shock-capturing method suitable for compressible reacting flows.\n\nStarting from the species transport equation written as an advection-diffusion-reaction balance and the momentum equation with viscous stresses in the compressible Navier–Stokes framework, perform a first-principles nondimensionalization to identify the dimensionless groups governing the relative strength of advection, thermal diffusion, momentum diffusion, and mass diffusion. Use these groups to:\n- Derive the expression for the Peclet number (Pe) associated with heat transport over the cellular length scale and the Schmidt number (Sc) associated with momentum-to-mass diffusion ratio.\n- Compute the numerical values of the Peclet number and Schmidt number under the given conditions.\n- Using the identified advective–diffusive length scales implied by these groups, decide whether thermal and species diffusion layers are physically resolvable on the available grid spacing $\\Delta x$; base your decision on a comparison of the relevant diffusion lengths with $\\Delta x$ and justify it in terms of the governing balance.\n\nExpress the Peclet number and Schmidt number as unitless numbers and round both to three significant figures. The final answer must consist only of the two computed values arranged as a row matrix. Do not include any units in the final answer.",
            "solution": "The problem statement has been evaluated and is determined to be valid. It is scientifically grounded in the established principles of transport phenomena and computational fluid dynamics, well-posed with sufficient and consistent data for a unique solution, and formulated using objective, precise language. The physical parameters provided are realistic for the study of detonation waves in reactive gases. We may therefore proceed with a formal solution.\n\nThe problem requires a nondimensional analysis of the governing transport equations to derive key dimensionless groups, calculate their values, and assess the resolvability of physical phenomena on a given computational grid.\n\nFirst, we derive the Peclet number, $\\text{Pe}$, associated with heat transport. The Peclet number represents the ratio of the rate of advection of a physical quantity by the flow to the rate of diffusion of the same quantity driven by an appropriate gradient. For heat transport, this involves the advection of thermal energy versus thermal diffusion. The simplified steady-state energy equation, which balances these two effects, can be scaled as follows. Let $U$ be the characteristic convective speed, $L$ be the characteristic length scale, and $\\alpha$ be the thermal diffusivity. The advective heat flux scales as $\\rho c_p U \\Delta T$, where $\\rho$ is the density, $c_p$ is the specific heat capacity, and $\\Delta T$ is a characteristic temperature difference. The diffusive heat flux, governed by Fourier's law, scales as $k \\frac{\\Delta T}{L} = \\rho c_p \\alpha \\frac{\\Delta T}{L}$. In a differential control volume analysis, the divergence of the advective flux scales as $\\frac{\\rho c_p U \\Delta T}{L}$, and the divergence of the diffusive flux scales as $\\frac{\\rho c_p \\alpha \\Delta T}{L^2}$.\n\nThe ratio of these two terms defines the Peclet number for heat transfer:\n$$\n\\text{Pe} = \\frac{\\text{Advective Transport}}{\\text{Diffusive Transport}} = \\frac{U L}{\\alpha}\n$$\nSubstituting the given values:\n$$\n\\text{Pe} = \\frac{(2000 \\, \\mathrm{m/s}) (5.0 \\times 10^{-3} \\, \\mathrm{m})}{3.0 \\times 10^{-4} \\, \\mathrm{m^2/s}} = \\frac{10}{3.0 \\times 10^{-4}} \\approx 33333.\\overline{3}\n$$\nRounding to three significant figures, the Peclet number is $\\text{Pe} \\approx 3.33 \\times 10^{4}$. This high value indicates that over the cellular length scale $L$, advection is the overwhelmingly dominant mechanism for heat transport compared to thermal diffusion.\n\nNext, we derive the Schmidt number, $\\text{Sc}$. The Schmidt number is a dimensionless group that compares momentum diffusivity to mass diffusivity. It is defined as the ratio of the kinematic viscosity, $\\nu$, to the species mass diffusivity, $D$.\n$$\n\\text{Sc} = \\frac{\\nu}{D}\n$$\nThis number is crucial for comparing the relative thicknesses of the hydrodynamic (momentum) boundary layer and the species concentration boundary layer. Using the provided values:\n$$\n\\text{Sc} = \\frac{4.0 \\times 10^{-4} \\, \\mathrm{m^2/s}}{1.2 \\times 10^{-3} \\, \\mathrm{m^2/s}} = \\frac{4.0}{12} = \\frac{1}{3} \\approx 0.3333\\overline{3}\n$$\nRounding to three significant figures, the Schmidt number is $\\text{Sc} \\approx 0.333$. A Schmidt number less than $1$ indicates that mass diffusivity is greater than momentum diffusivity, meaning that species concentration profiles will diffuse faster and over a wider region than momentum profiles.\n\nFinally, we must assess whether the thermal and species diffusion layers are physically resolvable on the computational grid. The characteristic thickness of a diffusion layer, $\\delta$, can be estimated as the length scale over which advection and diffusion are of the same order of magnitude. This scale is different from the global cellular scale $L$.\n\nFor the thermal diffusion layer, the thickness $\\delta_{th}$ is found by balancing advection $U \\frac{\\partial T}{\\partial x}$ and diffusion $\\alpha \\frac{\\partial^2 T}{\\partial x^2}$. Scaling these terms gives $U \\frac{\\Delta T}{\\delta_{th}} \\sim \\alpha \\frac{\\Delta T}{\\delta_{th}^2}$, which yields:\n$$\n\\delta_{th} = \\frac{\\alpha}{U} = \\frac{3.0 \\times 10^{-4} \\, \\mathrm{m^2/s}}{2000 \\, \\mathrm{m/s}} = 1.5 \\times 10^{-7} \\, \\mathrm{m}\n$$\n\nFor the species diffusion layer, the thickness $\\delta_{sp}$ is found by balancing advection $U \\frac{\\partial Y}{\\partial x}$ and mass diffusion $D \\frac{\\partial^2 Y}{\\partial x^2}$. Scaling gives $U \\frac{\\Delta Y}{\\delta_{sp}} \\sim D \\frac{\\Delta Y}{\\delta_{sp}^2}$, which yields:\n$$\n\\delta_{sp} = \\frac{D}{U} = \\frac{1.2 \\times 10^{-3} \\, \\mathrm{m^2/s}}{2000 \\, \\mathrm{m/s}} = 6.0 \\times 10^{-7} \\, \\mathrm{m}\n$$\n\nThe problem states the grid spacing is $\\Delta x = 1.0 \\times 10^{-5} \\, \\mathrm{m}$. To resolve a physical feature, the grid spacing must be significantly smaller than the feature's characteristic size. We compare $\\Delta x$ to the diffusion layer thicknesses:\n- For the thermal layer: $\\frac{\\Delta x}{\\delta_{th}} = \\frac{1.0 \\times 10^{-5} \\, \\mathrm{m}}{1.5 \\times 10^{-7} \\, \\mathrm{m}} \\approx 66.7$.\n- For the species layer: $\\frac{\\Delta x}{\\delta_{sp}} = \\frac{1.0 \\times 10^{-5} \\, \\mathrm{m}}{6.0 \\times 10^{-7} \\, \\mathrm{m}} \\approx 16.7$.\n\nIn both cases, the grid spacing $\\Delta x$ is substantially larger than the characteristic diffusion lengths ($\\Delta x \\gg \\delta_{th}$ and $\\Delta x \\gg \\delta_{sp}$). The grid is too coarse to resolve the thin regions where diffusion is important. The thermal layer would require a grid approximately $67$ times finer, and the species layer would require a grid about $17$ times finer, just to place a single grid point within the layer thickness. A proper resolution would demand several grid points within each layer.\n\nTherefore, we conclude that neither the thermal diffusion layer nor the species diffusion layer is physically resolvable with the given grid spacing of $\\Delta x = 1.0 \\times 10^{-5} \\, \\mathrm{m}$.These layers represent subgrid-scale phenomena. This highlights a fundamental challenge in computational combustion: the disparity between large-scale fluid structures (like detonation cells) and extremely thin reaction-diffusion zones necessitates either prohibitively fine grids or the use of advanced shock-capturing methods and subgrid-scale models to represent the unresolved physics.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.33 \\times 10^{4}  0.333\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The accuracy and stability of shock-capturing schemes depend heavily on the reconstruction step, which estimates flow properties at cell interfaces. For multi-species flows, a critical choice arises: should we reconstruct the conservative variables (like $\\rho Y_k$) or the primitive variables (like $Y_k$)? This hands-on coding practice  directly compares these two approaches, demonstrating how the seemingly straightforward conservative reconstruction can produce unphysical species mass fractions, while a characteristic-based approach offers a more robust alternative.",
            "id": "4061394",
            "problem": "You are given a one-dimensional finite-volume setting for a compressible, inviscid, multi-component gas mixture representative of detonation modeling in computational combustion. The governing equations are the multi-species Euler equations without diffusion or reaction for the reconstruction step. Let the conservative variables be $U = [\\rho, \\rho u, \\rho E, \\rho Y_1, \\rho Y_2]^\\top$, where $\\rho$ is density in $\\mathrm{kg/m^3}$, $u$ is velocity in $\\mathrm{m/s}$, $E$ is total specific energy in $\\mathrm{J/kg}$, and $Y_1$, $Y_2$ are species mass fractions (dimensionless) satisfying $Y_1 + Y_2 = 1$. The primitive variables are $Q = [\\rho, u, p, Y_1, Y_2]^\\top$, where $p$ is pressure in $\\mathrm{Pa}$. Assume a calorically perfect mixture with ratio of specific heats $\\gamma = 1.4$, and speed of sound $a = \\sqrt{\\gamma p / \\rho}$. The total energy satisfies $\\rho E = \\frac{p}{\\gamma - 1} + \\frac{1}{2} \\rho u^2$.\n\nYou will implement and compare two second-order MUSCL-type reconstructions at cell interfaces $x_{i+1/2}$:\n- Conservative-variable reconstruction: apply a Total Variation Diminishing (TVD) limiter directly and independently to each component of the conservative vector $U$ to obtain left $U_{i+1/2}^L$ and right $U_{i+1/2}^R$ interface states, then convert them to primitive interface mass fractions $Y_k^{L/R} = (\\rho Y_k)^{L/R} / \\rho^{L/R}$.\n- Characteristic-wise reconstruction: apply a TVD limiter in characteristic space for the hydrodynamic primitive variables $[\\rho, u, p]$ using the one-dimensional Euler eigenstructure, and reconstruct species mass fractions in primitive form as passive scalars consistent with the $u$-field by limiting $Y_1$ and setting $Y_2 = 1 - Y_1$ at interfaces. This approach decouples species from density scaling at reconstruction time.\n\nUse the Monotonized Central limiter for a generic scalar slope with left and right differences $\\Delta^- \\phi = \\phi_i - \\phi_{i-1}$ and $\\Delta^+ \\phi = \\phi_{i+1} - \\phi_i$:\n$$\ns_c = \\frac{1}{2}(\\Delta^- \\phi + \\Delta^+ \\phi), \\quad\n\\operatorname{MC}(\\Delta^-, \\Delta^+) =\n\\begin{cases}\n\\operatorname{sign}(s_c) \\min\\left(|s_c|, 2|\\Delta^-|, 2|\\Delta^+|\\right),  \\text{if } \\operatorname{sign}(s_c) = \\operatorname{sign}(\\Delta^-) = \\operatorname{sign}(\\Delta^+),\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nFor characteristic-wise reconstruction of the hydrodynamic primitive variables at cell $i$, use the linearized characteristic variables $\\alpha_k$ derived from the one-dimensional Euler eigenstructure for $Q_h = [\\rho, u, p]^\\top$ with eigenvalues $u - a$, $u$, $u + a$. For a generic difference $\\Delta Q_h = [\\Delta \\rho, \\Delta u, \\Delta p]^\\top$ at cell $i$ with local $a_i$ and $\\rho_i$:\n$$\n\\alpha_1 = \\frac{1}{2}\\left(\\frac{\\Delta p}{a_i^2} - \\frac{\\rho_i \\Delta u}{a_i}\\right),\\quad\n\\alpha_2 = \\Delta \\rho - \\frac{\\Delta p}{a_i^2},\\quad\n\\alpha_3 = \\frac{1}{2}\\left(\\frac{\\Delta p}{a_i^2} + \\frac{\\rho_i \\Delta u}{a_i}\\right),\n$$\nand reconstruct the limited hydrodynamic slope via the right eigenvectors\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ -\\frac{a_i}{\\rho_i} \\\\ a_i^2 \\end{bmatrix},\\quad\nr_2 = \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\end{bmatrix},\\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\frac{a_i}{\\rho_i} \\\\ a_i^2 \\end{bmatrix},\n$$\nso that the limited slope is\n$$\n\\sigma_{Q_h,i} = \\alpha_{1,i} r_1 + \\alpha_{2,i} r_2 + \\alpha_{3,i} r_3,\n$$\nwhere each $\\alpha_{k,i}$ is limited via the Monotonized Central limiter applied to $\\alpha_k$ computed from $\\Delta^- Q_h$ and $\\Delta^+ Q_h$ at cell $i$. Species are reconstructed in primitive form with $Y_1$ limited using the Monotonized Central limiter and $Y_2$ set by $Y_2 = 1 - Y_1$ at interfaces.\n\nFor both methods, construct interface states by the MUSCL half-step:\n$$\nX_{i+1/2}^L = X_i + \\frac{1}{2}\\sigma_i,\\quad\nX_{i+1/2}^R = X_{i+1} - \\frac{1}{2}\\sigma_{i+1},\n$$\nwhere $X$ is $U$ for conservative-variable reconstruction and $Q$ for characteristic-wise reconstruction, and $\\sigma_i$ is the limited slope at cell $i$. Set slopes at domain boundaries to zero.\n\nDefine the following metrics to quantify reconstruction impact on species mass fractions over all interfaces and both left and right reconstructed states:\n1. Bounds violation magnitude for species mass fractions:\n$$\nV = \\max_{i, s \\in \\{L, R\\}, k \\in \\{1,2\\}} \\left( \\max(0, -Y_{k,i+1/2}^s),\\ \\max(0, Y_{k,i+1/2}^s - 1) \\right).\n$$\n2. Sum-to-one imbalance (absolute $L^1$ aggregate):\n$$\nI = \\sum_{i, s \\in \\{L, R\\}} \\left| \\left(Y_{1,i+1/2}^s + Y_{2,i+1/2}^s\\right) - 1 \\right|.\n$$\n\nYour program must compute, for each test case, the differences between conservative-variable and characteristic-wise reconstructions:\n$$\n\\Delta V = V_{\\text{cons}} - V_{\\text{char}},\\quad \\Delta I = I_{\\text{cons}} - I_{\\text{char}}.\n$$\nReturn these differences for all test cases as floats.\n\nUse the following three test cases, each specified by arrays of cell-centered primitive variables with physical units noted. Assume $\\gamma = 1.4$ and a calorically perfect gas mixture. Units: density $\\rho$ in $\\mathrm{kg/m^3}$, velocity $u$ in $\\mathrm{m/s}$, pressure $p$ in $\\mathrm{Pa}$, species mass fractions $Y_1$ dimensionless. Set $Y_2 = 1 - Y_1$ at cell centers.\n\n- Test Case 1 (canonical detonation-like ramp, happy path):\n  - $\\rho = [1.0, 1.0, 1.2, 2.0, 2.5, 2.8, 2.9, 3.0]$\n  - $u = [0.0, 50.0, 100.0, 200.0, 400.0, 450.0, 470.0, 480.0]$\n  - $p = [1.0\\times 10^5, 1.2\\times 10^5, 2.0\\times 10^5, 3.5\\times 10^5, 5.0\\times 10^5, 5.5\\times 10^5, 5.8\\times 10^5, 6.0\\times 10^5]$\n  - $Y_1 = [1.0, 0.98, 0.90, 0.60, 0.30, 0.10, 0.05, 0.0]$\n\n- Test Case 2 (near-zero $Y_1$ with strong hydrodynamic gradients, boundary robustness):\n  - $\\rho = [0.8, 0.9, 1.1, 2.0, 3.0, 3.5, 3.8, 4.0]$\n  - $u = [20.0, 40.0, 60.0, 80.0, 100.0, 120.0, 140.0, 160.0]$\n  - $p = [9.0\\times 10^4, 1.0\\times 10^5, 1.1\\times 10^5, 2.5\\times 10^5, 4.0\\times 10^5, 5.0\\times 10^5, 5.5\\times 10^5, 6.0\\times 10^5]$\n  - $Y_1 = [1.0\\times 10^{-6}, 1.0\\times 10^{-6}, 1.0\\times 10^{-6}, 1.0\\times 10^{-5}, 1.0\\times 10^{-4}, 1.0\\times 10^{-3}, 1.0\\times 10^{-2}, 1.0\\times 10^{-1}]$\n\n- Test Case 3 (strong alternating species gradients under shock-like hydrodynamic oscillations, edge case):\n  - $\\rho = [1.0, 2.2, 0.9, 2.5, 1.1, 2.8, 1.0, 3.0]$\n  - $u = [0.0, 300.0, 50.0, 350.0, 80.0, 400.0, 100.0, 420.0]$\n  - $p = [1.0\\times 10^5, 4.0\\times 10^5, 1.1\\times 10^5, 4.5\\times 10^5, 1.2\\times 10^5, 4.8\\times 10^5, 1.3\\times 10^5, 5.0\\times 10^5]$\n  - $Y_1 = [1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0]$\n\nAlgorithmic requirements:\n- Implement the Monotonized Central limiter exactly as stated.\n- For conservative-variable reconstruction, limit each component of $U$ independently.\n- For characteristic-wise reconstruction, limit the hydrodynamic characteristic amplitudes $\\alpha_k$ and reconstruct $[\\rho, u, p]$ via the eigenvectors, limit $Y_1$ in primitive form and set $Y_2 = 1 - Y_1$ at interfaces.\n- Compute $V$ and $I$ for each method and return $\\Delta V$ and $\\Delta I$ per test case.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must be ordered as $[\\Delta V_{\\text{case 1}}, \\Delta I_{\\text{case 1}}, \\Delta V_{\\text{case 2}}, \\Delta I_{\\text{case 2}}, \\Delta V_{\\text{case 3}}, \\Delta I_{\\text{case 3}}]$, with each entry as a decimal number.",
            "solution": "We begin from the conservation laws for multi-species compressible flow in one dimension, expressed in conservative form for species without diffusion or reaction during the reconstruction step. The conservative variables are $U = [\\rho, \\rho u, \\rho E, \\rho Y_1, \\rho Y_2]^\\top$, satisfying hyperbolic conservation laws. The primitive variables are $Q = [\\rho, u, p, Y_1, Y_2]^\\top$ with the equation of state for a calorically perfect gas $p = (\\gamma - 1)\\rho e$ and total specific energy $E = e + \\frac{1}{2} u^2$, yielding $\\rho E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$.\n\nTo capture shocks while preserving stability, we employ Total Variation Diminishing (TVD) second-order MUSCL reconstruction. At each cell $i$, we compute limited slopes and reconstruct left and right states at interface $x_{i+1/2}$ as $X_{i+1/2}^L = X_i + \\frac{1}{2}\\sigma_i$ and $X_{i+1/2}^R = X_{i+1} - \\frac{1}{2}\\sigma_{i+1}$, where $X$ is either $U$ (conservative-variable reconstruction) or $Q$ (characteristic-wise reconstruction). Boundary cells use zero slopes.\n\nThe Monotonized Central limiter for a scalar variable $\\phi$ uses left and right differences $\\Delta^- \\phi = \\phi_i - \\phi_{i-1}$ and $\\Delta^+ \\phi = \\phi_{i+1} - \\phi_i$, with the central slope $s_c = \\frac{1}{2}(\\Delta^- \\phi + \\Delta^+ \\phi)$. The limited slope is\n$$\n\\operatorname{MC}(\\Delta^-, \\Delta^+) =\n\\begin{cases}\n\\operatorname{sign}(s_c) \\min\\left(|s_c|, 2|\\Delta^-|, 2|\\Delta^+|\\right),  \\text{if } \\operatorname{sign}(s_c) = \\operatorname{sign}(\\Delta^-) = \\operatorname{sign}(\\Delta^+),\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nFor vectors, we apply the limiter componentwise.\n\nFor characteristic-wise reconstruction, we exploit the eigenstructure of the one-dimensional Euler equations for the hydrodynamic primitive variables $Q_h = [\\rho, u, p]^\\top$. The Jacobian has eigenvalues $u - a$, $u$, $u + a$ with speed of sound $a = \\sqrt{\\gamma p / \\rho}$. A standard linear decomposition expresses any small difference $\\Delta Q_h$ in terms of characteristic amplitudes $\\alpha_k$:\n$$\n\\alpha_1 = \\frac{1}{2}\\left(\\frac{\\Delta p}{a^2} - \\frac{\\rho \\Delta u}{a}\\right),\\quad\n\\alpha_2 = \\Delta \\rho - \\frac{\\Delta p}{a^2},\\quad\n\\alpha_3 = \\frac{1}{2}\\left(\\frac{\\Delta p}{a^2} + \\frac{\\rho \\Delta u}{a}\\right).\n$$\nThe corresponding right eigenvectors in primitive variable space are\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ -\\frac{a}{\\rho} \\\\ a^2 \\end{bmatrix},\\quad\nr_2 = \\begin{bmatrix} 1 \\\\ 0 \\\\ 0 \\end{bmatrix},\\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\frac{a}{\\rho} \\\\ a^2 \\end{bmatrix}.\n$$\nAt each cell $i$, we compute $\\Delta^- Q_h$ and $\\Delta^+ Q_h$, form $\\alpha_{k,i}^-$ and $\\alpha_{k,i}^+$ for $k \\in \\{1,2,3\\}$, limit each $\\alpha_{k,i}$ via the Monotonized Central limiter to obtain $\\alpha_{k,i}$, and reconstruct the hydrodynamic slope\n$$\n\\sigma_{Q_h,i} = \\alpha_{1,i} r_1 + \\alpha_{2,i} r_2 + \\alpha_{3,i} r_3.\n$$\nSpecies mass fractions are linearly degenerate fields advected with velocity $u$; we reconstruct $Y_1$ in primitive form using the Monotonized Central limiter. To enforce the mixture constraint at interfaces, we set $Y_2 = 1 - Y_1$ after reconstruction. This decoupling avoids density-weighted scaling effects during characteristic-wise reconstruction and tends to preserve the $[0,1]$ bounds and the $Y_1 + Y_2 = 1$ constraint.\n\nFor conservative-variable reconstruction, we form $U$ from $Q$ via\n$$\n\\rho E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2,\\quad U = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\\\ \\rho Y_1 \\\\ \\rho Y_2 \\end{bmatrix},\n$$\napply the Monotonized Central limiter componentwise to $U$, reconstruct $U_{i+1/2}^{L/R}$, and convert to primitive interface mass fractions by dividing by reconstructed densities:\n$$\nY_k^{L/R} = \\frac{(\\rho Y_k)^{L/R}}{\\rho^{L/R}}.\n$$\nThis independent limiting of $\\rho$ and $\\rho Y_k$ may produce violations of $Y_k \\in [0,1]$ and $Y_1 + Y_2 = 1$ at interfaces, especially near strong gradients such as detonation shocks and reaction zones.\n\nTo quantify the reconstruction impact, we define two metrics over all interfaces and both left and right states. The bounds violation magnitude is\n$$\nV = \\max_{i, s \\in \\{L, R\\}, k \\in \\{1,2\\}} \\left( \\max(0, -Y_{k,i+1/2}^s),\\ \\max(0, Y_{k,i+1/2}^s - 1) \\right),\n$$\nwhich measures the worst-case excursion below $0$ or above $1$. The sum-to-one imbalance is\n$$\nI = \\sum_{i, s \\in \\{L, R\\}} \\left| \\left(Y_{1,i+1/2}^s + Y_{2,i+1/2}^s\\right) - 1 \\right|,\n$$\nwhich aggregates the absolute loss of the mixture constraint. We compute these for both methods and report differences\n$$\n\\Delta V = V_{\\text{cons}} - V_{\\text{char}},\\quad \\Delta I = I_{\\text{cons}} - I_{\\text{char}}.\n$$\n\nAlgorithmic steps for each test case:\n1. Construct cell-centered primitive arrays $Q_i = [\\rho_i, u_i, p_i, Y_{1,i}, Y_{2,i}]^\\top$ with $Y_{2,i} = 1 - Y_{1,i}$ and compute $a_i = \\sqrt{\\gamma p_i / \\rho_i}$.\n2. Conservative-variable reconstruction:\n   - Convert to $U_i$ via $\\rho E_i = \\frac{p_i}{\\gamma - 1} + \\frac{1}{2}\\rho_i u_i^2$.\n   - For each cell $i$, compute componentwise $\\Delta^- U_i$ and $\\Delta^+ U_i$; apply the Monotonized Central limiter to get $\\sigma_{U,i}$ (set $\\sigma_{U,0} = \\sigma_{U,N-1} = 0$).\n   - Reconstruct $U_{i+1/2}^L = U_i + \\frac{1}{2}\\sigma_{U,i}$ and $U_{i+1/2}^R = U_{i+1} - \\frac{1}{2}\\sigma_{U,i+1}$ for $i = 0,\\dots,N-2$.\n   - Convert to primitive interface mass fractions $Y_{k}^{L/R} = (\\rho Y_k)^{L/R} / \\rho^{L/R}$ and compute $V_{\\text{cons}}$ and $I_{\\text{cons}}$.\n3. Characteristic-wise reconstruction:\n   - For each cell $i$, form $\\Delta^- Q_{h,i}$ and $\\Delta^+ Q_{h,i}$ for $Q_h = [\\rho, u, p]^\\top$; compute $\\alpha_{k,i}^-$ and $\\alpha_{k,i}^+$ using the formulas above; apply the Monotonized Central limiter to obtain $\\alpha_{k,i}$; form $\\sigma_{Q_h,i}$ via the eigenvectors (set $\\sigma_{Q_h,0} = \\sigma_{Q_h,N-1} = 0$).\n   - Limit $Y_{1,i}$ using the Monotonized Central limiter on primitive differences; set the species slope vector as $\\sigma_{Y,i} = [\\sigma_{Y1,i}, -\\sigma_{Y1,i}]^\\top$ to enforce $Y_1 + Y_2 = 1$ at interfaces.\n   - Reconstruct $Q_{i+1/2}^L = Q_i + \\frac{1}{2}\\sigma_i$ and $Q_{i+1/2}^R = Q_{i+1} - \\frac{1}{2}\\sigma_{i+1}$, where $\\sigma_i$ is the concatenation of $\\sigma_{Q_h,i}$ and species slopes.\n   - Extract $Y_{1,i+1/2}^{L/R}$ and set $Y_{2,i+1/2}^{L/R} = 1 - Y_{1,i+1/2}^{L/R}$; compute $V_{\\text{char}}$ and $I_{\\text{char}}$.\n4. Report $\\Delta V$ and $\\Delta I$ for each test case.\n\nScientific rationale:\n- Shocks in reacting compressible flows produce steep gradients in hydrodynamic variables and species. Reconstructing species in conservative variables entangles $\\rho$ with $\\rho Y_k$, and independent limiting of these may produce inconsistent species values after division by $\\rho$, breaking both positivity and the mixture constraint $Y_1 + Y_2 = 1$.\n- Characteristic-wise reconstruction leverages the eigenstructure of the Euler system, limiting characteristic amplitudes to avoid spurious oscillations in the hydrodynamic fields, while treating species as passive scalars in primitive form consistent with advection. Enforcing $Y_2 = 1 - Y_1$ at interfaces preserves the mixture constraint, improving robustness in detonation-like profiles.\n\nYour program must implement the above and produce the final output as a single line in the format $[\\Delta V_{\\text{case 1}}, \\Delta I_{\\text{case 1}}, \\Delta V_{\\text{case 2}}, \\Delta I_{\\text{case 2}}, \\Delta V_{\\text{case 3}}, \\Delta I_{\\text{case 3}}]$, with decimal values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mc_limiter(delta_minus, delta_plus):\n    \"\"\"\n    Monotonized Central (MC) limiter for scalars.\n    \"\"\"\n    sc = 0.5 * (delta_minus + delta_plus)\n    # All must have the same sign\n    if (np.sign(sc) == np.sign(delta_minus)) and (np.sign(sc) == np.sign(delta_plus)):\n        return np.sign(sc) * min(abs(sc), 2.0 * abs(delta_minus), 2.0 * abs(delta_plus))\n    else:\n        return 0.0\n\ndef compute_energy_density(rho, u, p, gamma):\n    \"\"\"\n    rho E = p/(gamma-1) + 0.5 rho u^2\n    \"\"\"\n    return p / (gamma - 1.0) + 0.5 * rho * u**2\n\ndef primitive_to_conservative(rho, u, p, Y1, gamma):\n    \"\"\"\n    Convert primitive arrays to conservative arrays U = [rho, rho u, rho E, rho Y1, rho Y2].\n    Assumes Y2 = 1 - Y1.\n    \"\"\"\n    E = compute_energy_density(rho, u, p, gamma)  # rho E\n    Y2 = 1.0 - Y1\n    U = np.stack([rho, rho * u, E, rho * Y1, rho * Y2], axis=1)\n    return U\n\ndef conservative_to_primitive_species(U_LR):\n    \"\"\"\n    Extract species mass fractions from interface conservative states:\n    Yk = (rho Yk)/rho\n    \"\"\"\n    rho = U_LR[..., 0]\n    rhoY1 = U_LR[..., 3]\n    rhoY2 = U_LR[..., 4]\n    # Avoid divide-by-zero: if rho very small, treat as zero violation safely\n    eps = 1e-14\n    rho_safe = np.where(np.abs(rho)  eps, eps, rho)\n    Y1 = rhoY1 / rho_safe\n    Y2 = rhoY2 / rho_safe\n    return Y1, Y2\n\ndef reconstruct_conservative(rho, u, p, Y1, gamma):\n    \"\"\"\n    Perform conservative-variable MUSCL reconstruction with MC limiter.\n    Returns left/right interface species mass fractions arrays:\n    Y1_L, Y2_L, Y1_R, Y2_R for interfaces i+1/2, i=0..N-2.\n    \"\"\"\n    N = len(rho)\n    U = primitive_to_conservative(rho, u, p, Y1, gamma)\n\n    # Compute limited slopes sigma_U for each cell and each component\n    sigma = np.zeros_like(U)\n    for i in range(N):\n        if i == 0 or i == N - 1:\n            sigma[i, :] = 0.0\n        else:\n            delta_minus = U[i, :] - U[i - 1, :]\n            delta_plus = U[i + 1, :] - U[i, :]\n            # Apply MC limiter componentwise\n            limited = []\n            for k in range(U.shape[1]):\n                limited.append(mc_limiter(delta_minus[k], delta_plus[k]))\n            sigma[i, :] = np.array(limited)\n\n    # Reconstruct interface conservative states\n    UL = U[:-1, :] + 0.5 * sigma[:-1, :]\n    UR = U[1:, :] - 0.5 * sigma[1:, :]\n\n    # Convert to primitive species mass fractions\n    Y1_L, Y2_L = conservative_to_primitive_species(UL)\n    Y1_R, Y2_R = conservative_to_primitive_species(UR)\n\n    return Y1_L, Y2_L, Y1_R, Y2_R\n\ndef reconstruct_characteristic(rho, u, p, Y1, gamma):\n    \"\"\"\n    Perform characteristic-wise MUSCL reconstruction for hydrodynamic primitives [rho,u,p]\n    with MC limiter on characteristic amplitudes, and reconstruct species in primitive form\n    with Y2 = 1 - Y1 at interfaces.\n    Returns Y1_L, Y2_L, Y1_R, Y2_R for interfaces i+1/2, i=0..N-2.\n    \"\"\"\n    N = len(rho)\n    a = np.sqrt(gamma * p / rho)\n\n    # Slopes for hydrodynamic variables via characteristic limiting\n    sigma_rho = np.zeros(N)\n    sigma_u = np.zeros(N)\n    sigma_p = np.zeros(N)\n\n    for i in range(N):\n        if i == 0 or i == N - 1:\n            sigma_rho[i] = 0.0\n            sigma_u[i] = 0.0\n            sigma_p[i] = 0.0\n        else:\n            # Differences in primitive hydrodynamic variables\n            dminus_rho = rho[i] - rho[i - 1]\n            dminus_u = u[i] - u[i - 1]\n            dminus_p = p[i] - p[i - 1]\n            dplus_rho = rho[i + 1] - rho[i]\n            dplus_u = u[i + 1] - u[i]\n            dplus_p = p[i + 1] - p[i]\n\n            ai = a[i]\n            rhoi = rho[i]\n            # Characteristic amplitudes for left and right differences\n            def alphas(drho, du, dp, ai_local, rho_local):\n                alpha1 = 0.5 * (dp / (ai_local**2) - rho_local * du / ai_local)\n                alpha2 = drho - dp / (ai_local**2)\n                alpha3 = 0.5 * (dp / (ai_local**2) + rho_local * du / ai_local)\n                return alpha1, alpha2, alpha3\n\n            a1m, a2m, a3m = alphas(dminus_rho, dminus_u, dminus_p, ai, rhoi)\n            a1p, a2p, a3p = alphas(dplus_rho, dplus_u, dplus_p, ai, rhoi)\n\n            # Limit each characteristic amplitude\n            a1 = mc_limiter(a1m, a1p)\n            a2 = mc_limiter(a2m, a2p)\n            a3 = mc_limiter(a3m, a3p)\n\n            # Reconstruct slope via right eigenvectors in primitive space\n            # r1 = [1, -a/rho, a^2], r2 = [1, 0, 0], r3 = [1, a/rho, a^2]\n            r1 = np.array([1.0, -ai / rhoi, ai**2])\n            r2 = np.array([1.0, 0.0, 0.0])\n            r3 = np.array([1.0, ai / rhoi, ai**2])\n\n            sigma_vec = a1 * r1 + a2 * r2 + a3 * r3\n            sigma_rho[i] = sigma_vec[0]\n            sigma_u[i] = sigma_vec[1]\n            sigma_p[i] = sigma_vec[2]\n\n    # Species slope: limit Y1 in primitive form, enforce Y2 = 1 - Y1 via slope negation\n    sigma_Y1 = np.zeros(N)\n    for i in range(N):\n        if i == 0 or i == N - 1:\n            sigma_Y1[i] = 0.0\n        else:\n            dminus = Y1[i] - Y1[i - 1]\n            dplus = Y1[i + 1] - Y1[i]\n            sigma_Y1[i] = mc_limiter(dminus, dplus)\n\n    # Reconstruct interface primitive species values\n    # Left state at i+1/2 uses cell i; right state uses cell i+1\n    Y1_L = Y1[:-1] + 0.5 * sigma_Y1[:-1]\n    Y1_R = Y1[1:] - 0.5 * sigma_Y1[1:]\n    # Enforce Y2 = 1 - Y1 at interfaces\n    Y2_L = 1.0 - Y1_L\n    Y2_R = 1.0 - Y1_R\n\n    return Y1_L, Y2_L, Y1_R, Y2_R\n\ndef bounds_violation(Y1_L, Y2_L, Y1_R, Y2_R):\n    \"\"\"\n    Compute maximum bounds violation magnitude across all interfaces and sides.\n    Violation is max of negative excursion below 0 and excursion above 1 for either species.\n    \"\"\"\n    def violation_values(Y):\n        below = np.maximum(0.0, -Y)\n        above = np.maximum(0.0, Y - 1.0)\n        return np.maximum(below, above)\n\n    vL = np.maximum(violation_values(Y1_L), violation_values(Y2_L))\n    vR = np.maximum(violation_values(Y1_R), violation_values(Y2_R))\n    return float(max(np.max(vL), np.max(vR)))\n\ndef imbalance(Y1_L, Y2_L, Y1_R, Y2_R):\n    \"\"\"\n    Compute sum-to-one imbalance as L1 aggregate over all interfaces and both sides.\n    \"\"\"\n    sum_L = np.abs((Y1_L + Y2_L) - 1.0)\n    sum_R = np.abs((Y1_R + Y2_R) - 1.0)\n    return float(np.sum(sum_L) + np.sum(sum_R))\n\ndef run_case(rho, u, p, Y1, gamma):\n    \"\"\"\n    Run both reconstructions for a given test case and compute differences in metrics.\n    Returns (dV, dI) where dV = V_cons - V_char, dI = I_cons - I_char.\n    \"\"\"\n    # Conservative reconstruction\n    Y1_L_c, Y2_L_c, Y1_R_c, Y2_R_c = reconstruct_conservative(rho, u, p, Y1, gamma)\n    V_cons = bounds_violation(Y1_L_c, Y2_L_c, Y1_R_c, Y2_R_c)\n    I_cons = imbalance(Y1_L_c, Y2_L_c, Y1_R_c, Y2_R_c)\n\n    # Characteristic reconstruction\n    Y1_L_ch, Y2_L_ch, Y1_R_ch, Y2_R_ch = reconstruct_characteristic(rho, u, p, Y1, gamma)\n    V_char = bounds_violation(Y1_L_ch, Y2_L_ch, Y1_R_ch, Y2_R_ch)\n    I_char = imbalance(Y1_L_ch, Y2_L_ch, Y1_R_ch, Y2_R_ch)\n\n    dV = V_cons - V_char\n    dI = I_cons - I_char\n    return dV, dI\n\ndef solve():\n    gamma = 1.4\n\n    # Test Case 1\n    rho1 = np.array([1.0, 1.0, 1.2, 2.0, 2.5, 2.8, 2.9, 3.0], dtype=float)\n    u1 = np.array([0.0, 50.0, 100.0, 200.0, 400.0, 450.0, 470.0, 480.0], dtype=float)\n    p1 = np.array([1.0e5, 1.2e5, 2.0e5, 3.5e5, 5.0e5, 5.5e5, 5.8e5, 6.0e5], dtype=float)\n    Y1_1 = np.array([1.0, 0.98, 0.90, 0.60, 0.30, 0.10, 0.05, 0.0], dtype=float)\n\n    # Test Case 2\n    rho2 = np.array([0.8, 0.9, 1.1, 2.0, 3.0, 3.5, 3.8, 4.0], dtype=float)\n    u2 = np.array([20.0, 40.0, 60.0, 80.0, 100.0, 120.0, 140.0, 160.0], dtype=float)\n    p2 = np.array([9.0e4, 1.0e5, 1.1e5, 2.5e5, 4.0e5, 5.0e5, 5.5e5, 6.0e5], dtype=float)\n    Y1_2 = np.array([1.0e-6, 1.0e-6, 1.0e-6, 1.0e-5, 1.0e-4, 1.0e-3, 1.0e-2, 1.0e-1], dtype=float)\n\n    # Test Case 3\n    rho3 = np.array([1.0, 2.2, 0.9, 2.5, 1.1, 2.8, 1.0, 3.0], dtype=float)\n    u3 = np.array([0.0, 300.0, 50.0, 350.0, 80.0, 400.0, 100.0, 420.0], dtype=float)\n    p3 = np.array([1.0e5, 4.0e5, 1.1e5, 4.5e5, 1.2e5, 4.8e5, 1.3e5, 5.0e5], dtype=float)\n    Y1_3 = np.array([1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0], dtype=float)\n\n    # Run cases\n    dV1, dI1 = run_case(rho1, u1, p1, Y1_1, gamma)\n    dV2, dI2 = run_case(rho2, u2, p2, Y1_2, gamma)\n    dV3, dI3 = run_case(rho3, u3, p3, Y1_3, gamma)\n\n    results = [dV1, dI1, dV2, dI2, dV3, dI3]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Numerical simulations, especially with high-order schemes near discontinuities, can produce results that violate fundamental physical laws. In reacting flows, a common failure is the violation of species mass fraction constraints, where fractions may become negative or not sum to one, threatening the stability and physical realism of the simulation. This practice  challenges you to implement a robust, conservative, and mathematically sound procedure to 'renormalize' these mass fractions, projecting them back onto the physically valid state space without artificially altering the total mass.",
            "id": "4061426",
            "problem": "Consider a finite-volume discretization of the compressible reactive Euler equations in the context of shock-capturing for detonation cell simulation. Let a computational cell contain a mixture with density $\\rho$ (expressed in $\\mathrm{kg/m^3}$) and species mass fractions $Y_i$ for $i=1,\\dots,N$. The species mass fraction is defined by $Y_i = \\rho_i / \\rho$, where $\\rho_i$ is the partial density of species $i$, and the physical constraints require $Y_i \\ge 0$ for all $i$ and $\\sum_{i=1}^N Y_i = 1$. In practice, high-order shock-capturing schemes can produce violations of these constraints (e.g., due to numerical overshoot near discontinuities), which must be detected and corrected to maintain physical realism and numerical stability.\n\nYour task is to design:\n1. A diagnostic to flag any cell whose species mass fractions violate the constraint $\\sum_{i=1}^N Y_i = 1$ or positivity $Y_i \\ge 0$, using a tolerance $\\tau$ on the sum constraint.\n2. A conservative renormalization procedure that restores the species mass fractions to satisfy $Y_i^\\star \\ge 0$ and $\\sum_{i=1}^N Y_i^\\star = 1$ without altering the total mixture mass in the cell. The renormalization must keep $\\rho$ unchanged and should be derived from a principled projection, not an ad hoc heuristic.\n\nThe program you produce must:\n- Implement a diagnostic that marks a cell as violating the constraints if either $\\left|\\sum_{i=1}^N Y_i - 1\\right|  \\tau$ or $\\min_i Y_i  0$.\n- Implement a conservative renormalization that computes $Y^\\star$ as the Euclidean (least-squares) projection of $Y$ onto the probability simplex $\\mathcal{S}_N = \\{ x \\in \\mathbb{R}^N \\mid x_i \\ge 0,\\ \\sum_{i=1}^N x_i = 1 \\}$, and keeps the density $\\rho$ unchanged. After renormalization, update partial densities via $\\rho_i^\\star = \\rho\\,Y_i^\\star$ if needed. The renormalization must ensure the total mixture mass $\\rho$ remains unchanged.\n\nUse the following test suite of cells (each with $(\\rho, Y, \\tau)$), where all numbers are given explicitly:\n- Case A (happy path with moderate deviation): $\\rho = 1.2\\,\\mathrm{kg/m^3}$, $Y = (0.2, 0.3, 0.25, 0.2, 0.1)$, $\\tau = 10^{-10}$.\n- Case B (boundary condition near tolerance): $\\rho = 0.9\\,\\mathrm{kg/m^3}$, $Y = (0.3, 0.3, 0.400000000001)$, $\\tau = 10^{-10}$.\n- Case C (edge case with negativity): $\\rho = 1.0\\,\\mathrm{kg/m^3}$, $Y = (0.7, -0.05, 0.4)$, $\\tau = 10^{-10}$.\n- Case D (edge case with zero sum): $\\rho = 2.0\\,\\mathrm{kg/m^3}$, $Y = (0, 0, 0, 0)$, $\\tau = 10^{-10}$.\n- Case E (edge case with a species greater than one): $\\rho = 0.8\\,\\mathrm{kg/m^3}$, $Y = (1.2, -0.1, -0.1)$, $\\tau = 10^{-10}$.\n- Case F (detonation-relevant three-species mixture deviating from unity): $\\rho = 1.3\\,\\mathrm{kg/m^3}$, $Y = (0.03, 0.22, 0.73)$, $\\tau = 10^{-10}$.\n\nFor each case, your program must:\n- Apply the diagnostic before renormalization to produce a boolean flag indicating violation.\n- Apply the renormalization to compute $Y^\\star$.\n- Compute the absolute sum errors before and after: $e_{\\text{before}} = \\left|\\sum_i Y_i - 1\\right|$ and $e_{\\text{after}} = \\left|\\sum_i Y_i^\\star - 1\\right|$.\n- Verify that the mixture density is unchanged: a boolean $b_\\rho$ indicating whether the post-renormalization $\\rho$ equals the pre-renormalization $\\rho$ exactly.\n- Verify post-renormalization positivity: a boolean $b_{+}$ indicating whether $\\min_i Y_i^\\star \\ge 0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, where each case result is a list in the form $[\\text{flag}, e_{\\text{before}}, e_{\\text{after}}, b_\\rho, b_{+}]$.\n- For example, the output should look like $[[\\text{flag}_A, e_{\\text{before},A}, e_{\\text{after},A}, b_{\\rho,A}, b_{+,A}], [\\text{flag}_B, \\dots], \\dots]$.\n\nNo angles or percentages are involved; all outputs are dimensionless booleans or floats. Density must be treated in $\\mathrm{kg/m^3}$ internally but is not printed in the final output. The program must be completely self-contained and runnable without external input.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the field of computational combustion, mathematically well-posed, objective, and provides all necessary information to formulate a solution. No inconsistencies, unsound premises, or ambiguities were found.\n\nThe task is to develop and implement a two-part procedure for handling species mass fractions in a computational cell, a common requirement in simulations of compressible reacting flows. First, a diagnostic must flag cells with non-physical mass fractions. Second, a conservative renormalization procedure must correct these fractions to be physically admissible.\n\nLet the state of a cell be defined by its mixture density $\\rho$ and a vector of $N$ species mass fractions $Y = (Y_1, Y_2, \\dots, Y_N)$. The physical constraints on $Y$ are:\n1.  **Positivity:** $Y_i \\ge 0$ for all $i=1, \\dots, N$.\n2.  **Sum-to-unity:** $\\sum_{i=1}^N Y_i = 1$.\n\nThese two constraints define the standard, or probability, simplex in $N$ dimensions, denoted as $\\mathcal{S}_N$:\n$$ \\mathcal{S}_N = \\left\\{ x \\in \\mathbb{R}^N \\mid \\sum_{i=1}^N x_i = 1 \\text{ and } x_i \\ge 0 \\text{ for all } i \\right\\} $$\n\n### Part 1: Diagnostic for Constraint Violation\n\nThe diagnostic rule is explicitly defined. A given mass fraction vector $Y$ is flagged as being in violation of the physical constraints if its components are not on the simplex, with a specified tolerance $\\tau$ for the sum constraint. The violation condition is given by the logical disjunction:\n$$ \\left( \\left| \\sum_{i=1}^N Y_i - 1 \\right|  \\tau \\right) \\lor \\left( \\min_{i} Y_i  0 \\right) $$\nThis check is performed on the input state $(Y, \\tau)$ before any correction is applied. The absolute error in the sum before correction is calculated as $e_{\\text{before}} = \\left| \\sum_{i=1}^N Y_i - 1 \\right|$.\n\n### Part 2: Conservative Renormalization Procedure\n\nThe renormalization must map an arbitrary vector $Y \\in \\mathbb{R}^N$ to a vector $Y^\\star \\in \\mathcal{S}_N$. The problem mandates that this mapping be \"conservative,\" meaning the total mixture density $\\rho$ is unchanged. This is a key feature, as it ensures the total mass in the cell's volume, $\\rho V$, is conserved. The procedure only redistributes the mass among species.\n\nThe problem specifies a principled method: the corrected vector $Y^\\star$ must be the Euclidean (or least-squares) projection of the unphysical vector $Y$ onto the probability simplex $\\mathcal{S}_N$. This corresponds to solving the following quadratic programming problem:\n$$ \\begin{aligned} \\underset{Y^\\star}{\\text{minimize}} \\quad  \\frac{1}{2} \\| Y^\\star - Y \\|_2^2 = \\frac{1}{2} \\sum_{i=1}^N (Y_i^\\star - Y_i)^2 \\\\ \\text{subject to} \\quad  \\sum_{i=1}^N Y_i^\\star = 1 \\\\  Y_i^\\star \\ge 0, \\quad i=1, \\dots, N \\end{aligned} $$\nSince $\\mathcal{S}_N$ is a closed convex set, a unique solution $Y^\\star$ to this projection problem is guaranteed to exist for any $Y \\in \\mathbb{R}^N$.\n\nTo find the solution, we can use the Karush-Kuhn-Tucker (KKT) conditions. The solution $Y^\\star$ can be expressed in terms of a single scalar variable $\\theta$ (related to the Lagrange multiplier for the equality constraint) as:\n$$ Y_i^\\star = \\max(0, Y_i - \\theta) $$\nThis form elegantly incorporates the positivity constraint. Substituting this into the sum-to-unity constraint gives a non-linear equation for $\\theta$:\n$$ \\sum_{i=1}^N \\max(0, Y_i - \\theta) = 1 $$\nThe function $f(\\theta) = \\sum_{i=1}^N \\max(0, Y_i - \\theta)$ is continuous, piecewise linear, and monotonically decreasing. A unique $\\theta$ that solves $f(\\theta) = 1$ can be found efficiently. A well-established and fast algorithm for this projection is as follows:\n\n1.  Given the input vector $Y = (Y_1, \\dots, Y_N)$.\n2.  Sort the components of $Y$ in descending order to create a new vector $U$: $u_1 \\ge u_2 \\ge \\dots \\ge u_N$.\n3.  Find the largest integer index $\\rho_{\\text{idx}} \\in \\{1, \\dots, N\\}$ such that\n    $$ u_{\\rho_{\\text{idx}}} - \\frac{1}{\\rho_{\\text{idx}}} \\left( \\left( \\sum_{k=1}^{\\rho_{\\text{idx}}} u_k \\right) - 1 \\right)  0 $$\n    This index identifies the subset of components of $Y^\\star$ that will be positive.\n4.  Calculate the threshold $\\theta$ using this index $\\rho_{\\text{idx}}$:\n    $$ \\theta = \\frac{1}{\\rho_{\\text{idx}}} \\left( \\left( \\sum_{k=1}^{\\rho_{\\text{idx}}} u_k \\right) - 1 \\right) $$\n5.  The components of the projected vector $Y^\\star$ are then computed by applying this threshold to the original unsorted vector $Y$:\n    $$ Y_i^\\star = \\max(0, Y_i - \\theta) \\quad \\text{for } i=1, \\dots, N $$\n\n### Part 3: Post-Renormalization Verification\n\nAfter computing $Y^\\star$, we perform the required verification steps:\n1.  **Final Sum Error:** Calculate $e_{\\text{after}} = \\left| \\sum_{i=1}^N Y_i^\\star - 1 \\right|$. Due to the properties of the projection and the use of floating-point arithmetic, this value should be very close to $0$.\n2.  **Density Conservation:** The boolean $b_\\rho$ checks if the mixture density is unchanged. The algorithm described acts only on the mass fraction vector $Y$ and does not modify $\\rho$. Thus, by design, the post-renormalization density is identical to the pre-renormalization density, and $b_\\rho$ will be `True`.\n3.  **Positivity:** The boolean $b_{+}$ checks if $\\min_i Y_i^\\star \\ge 0$. The operation $Y_i^\\star = \\max(0, Y_i - \\theta)$ guarantees that all components of $Y^\\star$ are non-negative. Therefore, $b_{+}$ will also be `True`.\n\nThis completes the design of the diagnostic, the conservative renormalization procedure, and the verification steps. This framework is robust, non-heuristic, and ensures the fundamental physical constraints on species mass fractions are respected numerically.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef renormalize_mass_fractions(Y):\n    \"\"\"\n    Projects a vector Y onto the probability simplex using a fast projection algorithm.\n    This corresponds to finding Y_star that solves:\n    minimize ||Y_star - Y||_2^2\n    subject to sum(Y_star) = 1 and Y_star_i = 0.\n\n    Args:\n        Y (np.ndarray): The input vector of mass fractions.\n\n    Returns:\n        np.ndarray: The projected vector Y_star on the simplex.\n    \"\"\"\n    n_species = len(Y)\n    \n    # Sort the mass fractions in descending order\n    U = np.sort(Y)[::-1]\n    \n    # Compute the cumulative sum of the sorted values\n    cssv = np.cumsum(U)\n    \n    # Find the largest index rho such that the projection condition holds.\n    # The condition is u_j - (1/j) * (sum_{k=1 to j} u_k - 1)  0\n    # The 'j' in the formula is 1-based, so we use arange(1, n+1).\n    j_indices = np.arange(1, n_species + 1)\n    condition = U - (cssv - 1) / j_indices  0\n    \n    # Find the last index (which corresponds to the largest j) where condition is True.\n    # np.where returns a tuple of arrays; we take the first.\n    # If no element satisfies the condition (e.g., Y is a zero vector), this will be empty.\n    # In that edge case, the projection is uniform.\n    if np.any(condition):\n        rho = np.where(condition)[0][-1] + 1\n    else:\n        # This branch handles cases like Y=(0,0,0) where the condition is never strictly  0 for all u_j=0\n        # although mathematically it could be = 0. For Y=(0,0,0) u_j - ...  0 fails, but the projection is uniform.\n        # This can be seen by setting rho = n_species\n        rho = n_species\n\n    # Calculate the threshold theta\n    # cssv is 0-indexed, so we use rho-1\n    theta = (cssv[rho - 1] - 1) / rho\n    \n    # Compute the projection\n    Y_star = np.maximum(0, Y - theta)\n    \n    return Y_star\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and produce the required output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (rho, Y, tau)\n        (1.2, np.array([0.2, 0.3, 0.25, 0.2, 0.1]), 1e-10),     # Case A\n        (0.9, np.array([0.3, 0.3, 0.400000000001]), 1e-10),  # Case B\n        (1.0, np.array([0.7, -0.05, 0.4]), 1e-10),            # Case C\n        (2.0, np.array([0.0, 0.0, 0.0, 0.0]), 1e-10),           # Case D\n        (0.8, np.array([1.2, -0.1, -0.1]), 1e-10),            # Case E\n        (1.3, np.array([0.03, 0.22, 0.73]), 1e-10),         # Case F\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, Y, tau = case\n\n        # 1. Apply the diagnostic before renormalization\n        sum_Y = np.sum(Y)\n        min_Y = np.min(Y)\n        flag = bool(np.abs(sum_Y - 1)  tau or min_Y  0)\n\n        # 2. Compute the sum error before renormalization\n        e_before = np.abs(sum_Y - 1)\n\n        # 3. Apply the renormalization to compute Y_star\n        Y_star = renormalize_mass_fractions(Y)\n\n        # 4. Compute the sum error after renormalization\n        e_after = np.abs(np.sum(Y_star) - 1)\n\n        # 5. Verify density is unchanged. By problem design, it is.\n        b_rho = True\n\n        # 6. Verify post-renormalization positivity. By algorithm design, it is.\n        b_plus = bool(np.min(Y_star) = 0.0)\n\n        # Store the results for this case\n        case_result = [flag, e_before, e_after, b_rho, b_plus]\n        results.append(case_result)\n\n    # Format the final output string\n    # Python's bool `True` and `False` are used directly as specified by the problem's logic.\n    # The example output `[flag_A, ...]` is a generic placeholder.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}