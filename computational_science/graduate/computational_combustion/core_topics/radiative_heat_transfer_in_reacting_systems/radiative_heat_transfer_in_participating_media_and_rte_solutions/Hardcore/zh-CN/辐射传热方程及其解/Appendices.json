{
    "hands_on_practices": [
        {
            "introduction": "在燃烧系统中，辐射传热是理解火焰结构和热负荷的关键。本练习将理论与实践相结合，要求您从辐射传输方程（RTE）的第一性原理出发，应用光学薄近似来评估真实火焰条件下烟尘与气体辐射的相对重要性 ()。通过推导和计算，您将加深对普朗克平均吸收系数等关键概念的理解，并掌握一种在复杂场景中进行快速工程估算的重要技能。",
            "id": "4056019",
            "problem": "考虑一个嵌入在温度为 $T=1800\\,\\mathrm{K}$、压力为 $p=1\\,\\mathrm{atm}$ 的湍流扩散火焰发光核心中的局部均匀控制体积。该介质由于烟尘和辐射活性气体的存在而成为参与性介质。假设以下符合物理现实的条件和模型：\n\n- 描述发射和吸收的辐射传输方程 (RTE) 控制着辐射传输过程，且在该区域内，烟尘和气体的散射均可忽略不计。\n- 该区域是光学薄的，因此体积内的再吸收和来自周围环境的入射辐射都可以忽略；即，净辐射损失可仅由局部发射来估算。\n- 烟尘被建模为处于 Rayleigh 极限范围内的微小吸收性颗粒。其 Planck 平均吸收系数由经过充分验证的表达式 $\\kappa_{P,\\text{soot}}=\\dfrac{3\\,E_P\\,f_v}{d_p}$ 表示，其中 $E_P$ 是在给定温度下烟尘材料的 Planck 平均无量纲吸收函数，$f_v$ 是烟尘体积分数，$d_p$ 是一次颗粒直径。\n- 对于温度为 $T=1800\\,\\mathrm{K}$、代表性摩尔分数为 $x_{\\text{H}_2\\text{O}}=0.10$ 和 $x_{\\text{CO}_2}=0.12$ 的产物气体混合物，在 $p=1\\,\\mathrm{atm}$ 的压力下，高分辨率逐线模型计算得出其 Planck 平均吸收系数为 $\\kappa_{P,\\text{gas}}=0.40\\,\\mathrm{m}^{-1}$。\n- 在 $T=1800\\,\\mathrm{K}$ 时，Planck 平均烟尘吸收函数为 $E_P=0.28$，烟尘体积分数为 $f_v=2.0\\times 10^{-7}$，一次颗粒直径为 $d_p=35\\,\\mathrm{nm}$。\n\n从参与性介质中发射的基本定义和辐射传输方程 (RTE) 出发，利用光学薄近似，从第一性原理推导出一个表达式，用于描述烟尘所导致的辐射损失在总体积辐射损失中所占的比例。然后，使用给定的数据对此比例进行数值计算。将最终答案表示为一个四舍五入至四位有效数字的无量纲小数。",
            "solution": "本题要求推导在参与性介质中，由烟尘引起的辐射损失在总体积辐射损失中所占比例的表达式，并进行数值计算。\n\n**第一部分：理论推导**\n\n在吸收、发射且不散射的介质中，控制热辐射传输的基本方程是辐射传输方程 (RTE)。沿着坐标为 $s$ 的路径，光谱强度 $I_\\lambda$ 的 RTE 为：\n$$\n\\frac{dI_\\lambda}{ds} = \\kappa_\\lambda I_{b\\lambda}(T) - \\kappa_\\lambda I_\\lambda\n$$\n此处，$\\kappa_\\lambda$ 是介质的光谱吸收系数，$I_{b\\lambda}(T)$ 是温度为 $T$ 的黑体的光谱强度（由 Planck 定律给出），等式右侧的项分别代表光谱发射和吸收。\n\n单位体积内通过辐射传递的净能量速率由辐射热流矢量 $\\mathbf{q}_r$ 的散度 $\\nabla \\cdot \\mathbf{q}_r$ 给出。该量可以通过对 RTE 的源项在所有立体角（$4\\pi$ 球面度）和所有波长上积分来表示：\n$$\n\\nabla \\cdot \\mathbf{q}_r = \\int_{0}^{\\infty} \\int_{4\\pi} (\\kappa_\\lambda I_{b\\lambda}(T) - \\kappa_\\lambda I_\\lambda) \\,d\\Omega \\,d\\lambda\n$$\n这可以改写为：\n$$\n\\nabla \\cdot \\mathbf{q}_r = \\int_{0}^{\\infty} \\kappa_\\lambda \\left( \\int_{4\\pi} I_{b\\lambda}(T) \\,d\\Omega - \\int_{4\\pi} I_\\lambda \\,d\\Omega \\right) d\\lambda\n$$\n由于黑体辐射是各向同性的，$I_{b\\lambda}(T)$ 与方向无关，因此 $\\int_{4\\pi} I_{b\\lambda}(T) \\,d\\Omega = 4\\pi I_{b\\lambda}(T)$。第二个积分定义了入射光谱辐射 $G_\\lambda = \\int_{4\\pi} I_\\lambda \\,d\\Omega$。因此，\n$$\n\\nabla \\cdot \\mathbf{q}_r = \\int_{0}^{\\infty} \\kappa_\\lambda (4\\pi I_{b\\lambda}(T) - G_\\lambda) \\,d\\lambda\n$$\n题目指出介质是光学薄的，并且来自周围环境的入射辐射可以忽略。在光学薄近似下，介质发射的辐射在没有显著再吸收的情况下逸出。这一点，再加上可忽略的外部辐射，意味着局部辐射强度 $I_\\lambda$ 与黑体强度相比非常小，因此 $I_\\lambda \\approx 0$。因此，入射辐射 $G_\\lambda$ 也近似为零。\n\n在此近似下，我们定义为 $q_{loss} = \\nabla \\cdot \\mathbf{q}_r$ 的体积辐射损失简化为体积发射率：\n$$\nq_{loss} \\approx \\int_{0}^{\\infty} 4\\pi \\kappa_\\lambda I_{b\\lambda}(T) \\,d\\lambda = 4\\pi \\int_{0}^{\\infty} \\kappa_\\lambda I_{b\\lambda}(T) \\,d\\lambda\n$$\n为了计算这个光谱积分，我们引入 Planck 平均吸收系数 $\\kappa_P$，其定义为由黑体强度分布加权的光谱平均吸收系数：\n$$\n\\kappa_P = \\frac{\\int_{0}^{\\infty} \\kappa_\\lambda I_{b\\lambda}(T) \\,d\\lambda}{\\int_{0}^{\\infty} I_{b\\lambda}(T) \\,d\\lambda}\n$$\n分母是总黑体强度，它通过 $\\int_{0}^{\\infty} I_{b\\lambda}(T) \\,d\\lambda = \\frac{\\sigma T^4}{\\pi}$ 与 Stefan-Boltzmann 常数 $\\sigma$ 相关。\n重新整理 $\\kappa_P$ 的定义，我们得到：\n$$\n\\int_{0}^{\\infty} \\kappa_\\lambda I_{b\\lambda}(T) \\,d\\lambda = \\kappa_P \\int_{0}^{\\infty} I_{b\\lambda}(T) \\,d\\lambda = \\kappa_P \\frac{\\sigma T^4}{\\pi}\n$$\n将此代入 $q_{loss}$ 的表达式中：\n$$\nq_{loss} = 4\\pi \\left( \\kappa_P \\frac{\\sigma T^4}{\\pi} \\right) = 4 \\kappa_P \\sigma T^4\n$$\n这就是在光学薄介质中总体积辐射损失的表达式。\n\n介质是烟尘和辐射活性气体的混合物。假设这些组分形成一个简单混合物，它们的光谱吸收系数是可加的：$\\kappa_\\lambda = \\kappa_{\\lambda, \\text{soot}} + \\kappa_{\\lambda, \\text{gas}}$。由于 $\\kappa_P$ 定义中积分的线性性质，总 Planck 平均吸收系数是个体 Planck 平均系数之和：\n$$\n\\kappa_{P, \\text{total}} = \\kappa_{P, \\text{soot}} + \\kappa_{P, \\text{gas}}\n$$\n因此，总体积辐射损失为：\n$$\nq_{loss, \\text{total}} = 4 \\kappa_{P, \\text{total}} \\sigma T^4 = 4 (\\kappa_{P, \\text{soot}} + \\kappa_{P, \\text{gas}}) \\sigma T^4\n$$\n这部分损失中可归因于烟尘发射的部分仅由其自身的吸收系数决定：\n$$\nq_{loss, \\text{soot}} = 4 \\kappa_{P, \\text{soot}} \\sigma T^4\n$$\n由烟尘引起的辐射损失在总体积辐射损失中所占的比例 $F_{\\text{soot}}$ 是烟尘造成的损失与总损失之比：\n$$\nF_{\\text{soot}} = \\frac{q_{loss, \\text{soot}}}{q_{loss, \\text{total}}} = \\frac{4 \\kappa_{P, \\text{soot}} \\sigma T^4}{4 (\\kappa_{P, \\text{soot}} + \\kappa_{P, \\text{gas}}) \\sigma T^4}\n$$\n$4$、$\\sigma$ 和 $T^4$ 项相互抵消，得出最终推导的表达式：\n$$\nF_{\\text{soot}} = \\frac{\\kappa_{P, \\text{soot}}}{\\kappa_{P, \\text{soot}} + \\kappa_{P, \\text{gas}}}\n$$\n\n**第二部分：数值计算**\n\n给定了气相的 Planck 平均吸收系数：\n$$\n\\kappa_{P, \\text{gas}} = 0.40\\,\\mathrm{m}^{-1}\n$$\n我们必须使用所提供的模型和数据计算烟尘的 Planck 平均吸收系数：\n$$\n\\kappa_{P,\\text{soot}} = \\frac{3\\,E_P\\,f_v}{d_p}\n$$\n给定的值为：\n- $E_P = 0.28$\n- $f_v = 2.0 \\times 10^{-7}$\n- $d_p = 35\\,\\mathrm{nm} = 35 \\times 10^{-9}\\,\\mathrm{m}$\n\n将这些值代入 $\\kappa_{P,\\text{soot}}$ 的表达式中：\n$$\n\\kappa_{P,\\text{soot}} = \\frac{3 \\times 0.28 \\times (2.0 \\times 10^{-7})}{35 \\times 10^{-9}\\,\\mathrm{m}} = \\frac{1.68 \\times 10^{-7}}{35 \\times 10^{-9}\\,\\mathrm{m}} = 4.8\\,\\mathrm{m}^{-1}\n$$\n现在我们可以通过代入吸收系数的数值来计算比例 $F_{\\text{soot}}$：\n$$\nF_{\\text{soot}} = \\frac{4.8\\,\\mathrm{m}^{-1}}{4.8\\,\\mathrm{m}^{-1} + 0.40\\,\\mathrm{m}^{-1}} = \\frac{4.8}{5.2}\n$$\n$$\nF_{\\text{soot}} = \\frac{48}{52} = \\frac{12}{13} \\approx 0.9230769...\n$$\n题目要求答案是一个四舍五入到四位有效数字的无量纲小数。对结果进行四舍五入得到：\n$$\nF_{\\text{soot}} = 0.9231\n$$\n此结果表明，在给定条件下，烟尘贡献了该体积元总辐射能量损失的约 $92.31\\%$。",
            "answer": "$$\\boxed{0.9231}$$"
        },
        {
            "introduction": "精确模拟气体辐射需要处理其在光谱上剧烈变化的吸收系数，这给计算带来了巨大挑战。本练习旨在介绍并实践一种强大的非灰气体模型——correlated-k（`c-k`）分布方法，它通过巧妙的光谱重排实现了计算效率与精度的平衡 ()。通过编程实现 $c-k$ 方法并将其结果与高精度的逐线（LbL）积分基准进行比较，您将掌握一种先进的光谱模型，并深刻理解其在辐射计算中的准确性和效率优势。",
            "id": "4056000",
            "problem": "考虑在一维情况下，光谱辐射穿过一个处于局部热力学平衡状态的均匀、等温、非散射气体平板的传输过程。从针对准直光束在单一归一化光谱坐标 $x$ 上的辐射传输方程 (RTE) 出发，该方程只考虑纯吸收，不考虑发射，$$\\frac{d I(x,s)}{d s} = -\\kappa(x)\\, I(x,s),$$ 其中 $I(x,s)$ 是沿路径坐标 $s$ 的光谱强度，$\\kappa(x)$ 是光谱吸收系数。对于物理厚度为 $L$ 且 $\\kappa(x)$ 均匀的气体平板，其解为 $$I(x,L) = I(x,0)\\,\\exp\\!\\left(-\\kappa(x)\\,L\\right).$$ 因此，在 $x$ 处的光谱透过率为 $$\\mathcal{T}(x;L) = \\exp\\!\\left(-\\kappa(x)\\,L\\right).$$ 在归一化波段 $x \\in [0,1]$ 上的波段平均透过率为 $$\\overline{\\mathcal{T}}(L) = \\int_0^1 \\exp\\!\\left(-\\kappa(x)\\,L\\right)\\,dx.$$\n\n要求您使用两种方法计算波段平均透过率，并量化它们之间的差异：\n- 通过在均匀光谱网格上进行显式积分计算出的逐线 (LbL) 参考值。\n- 使用 $k$ 分布和在累积概率域上进行积分的 correlated-$k$ 近似。\n\n使用以下科学上一致的吸收系数合成光谱，其物理单位为长度的倒数（米的负一次方）：\n$$\\kappa(x) = b + \\sum_{i=1}^{5} A_i \\exp\\!\\left(-\\frac{(x-\\mu_i)^2}{2\\,\\sigma_i^2}\\right),$$\n参数如下\n- 基线 $b = 0.2$ m$^{-1}$，\n- 谱线中心 $\\mu = [0.15,\\, 0.37,\\, 0.55,\\, 0.72,\\, 0.90]$ (无量纲)，\n- 谱线振幅 $A = [150.0,\\, 50.0,\\, 300.0,\\, 120.0,\\, 220.0]$ m$^{-1}$，\n- 谱线宽度 $\\sigma = [0.01,\\, 0.02,\\, 0.015,\\, 0.025,\\, 0.008]$ (无量纲)。\n\n对于 LbL 参考值，使用 $N$ 个点上的均匀黎曼和来近似波段平均透过率：\n$$\\overline{\\mathcal{T}}_{\\text{LbL}}(L) \\approx \\frac{1}{N}\\sum_{j=1}^{N} \\exp\\!\\left(-\\kappa(x_j)\\,L\\right), \\quad x_j = \\frac{j-\\tfrac{1}{2}}{N},$$\n其中 $N = 4096$。\n\n对于 correlated-$k$ 近似，通过对集合 $\\{\\kappa(x_j)\\}_{j=1}^N$ 进行排序以获得一个非递减序列 $\\{k_{(j)}\\}_{j=1}^N$ 来构建经验 $k$ 分布，并定义经验累积概率坐标 $$g_j = \\frac{j-\\tfrac{1}{2}}{N}, \\quad j=1,\\dots,N.$$ 令 $Q(g)$ 表示经验分位数函数，它通过对数据点对 $(g_j, k_{(j)})$ 进行线性插值，将 $g \\in [0,1]$ 映射到 $k$。使用在 $[0,1]$ 上的 $m$ 阶 Gauss–Legendre 求积来近似 correlated-$k$ 透过率：\n$$\\overline{\\mathcal{T}}_{k}(L; m) \\approx \\sum_{q=1}^{m} w_q^{(g)} \\exp\\!\\left(-Q(g_q)\\,L\\right),$$\n其中 $\\{g_q, w_q^{(g)}\\}_{q=1}^m$ 是通过从 $[-1,1]$ 进行仿射映射得到的在 $[0,1]$ 上的 Gauss–Legendre 横坐标和权重。\n\n对于每个测试用例，使用 LbL 值作为参考来计算相对误差：\n$$\\varepsilon_{\\text{rel}} = \\frac{\\left|\\overline{\\mathcal{T}}_{k}(L; m) - \\overline{\\mathcal{T}}_{\\text{LbL}}(L)\\right|}{\\overline{\\mathcal{T}}_{\\text{LbL}}(L)}.$$\n\n您的程序必须精确实现上述定义，并为以下 $(L, m)$ 对的测试套件生成相对误差，其中 $L$ 的单位是米，$m$ 是无量纲的：\n- $(L, m) = (0.01, 4)$,\n- $(L, m) = (0.01, 12)$,\n- $(L, m) = (1.0, 4)$,\n- $(L, m) = (1.0, 12)$,\n- $(L, m) = (10.0, 4)$,\n- $(L, m) = (10.0, 12)$.\n\n要求和交付成果：\n- 使用 $N = 4096$ 个光谱点计算 LbL 参考值并构建经验 $k$ 分布。\n- 按照规定，使用在 $[0,1]$ 上的 $m$ 阶 Gauss–Legendre 求积来计算 correlated-$k$ 积分。\n- 将波段平均透过率表示为无量纲量。吸收系数 $\\kappa$ 的单位是 m$^{-1}$，平板厚度 $L$ 的单位是 m。\n- 对于每个测试用例，将 $\\varepsilon_{\\text{rel}}$ 计算为浮点数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,\\dots,r_6]$），其中 $r_i$ 是上面列出的第 $i$ 个测试用例的相对误差，顺序相同。不应打印任何其他文本。",
            "solution": "该问题在科学和数学上是适定的，提供了一套完整且一致的定义和数据。这是辐射传热领域的一个标准数值练习，具体涉及高分辨率逐线 (LbL) 计算与计算高效的 correlated-$k$ 模型之间的比较。所有必要的参数和步骤都已明确定义，从而能够直接且无歧义地实现。因此，该问题是有效的，下面提供了解决方案。\n\n核心任务是计算厚度为 $L$ 的均匀气体平板的波段平均透过率 $\\overline{\\mathcal{T}}(L)$。该量定义为光谱透过率 $\\mathcal{T}(x;L)$ 在归一化光谱波段 $x \\in [0,1]$ 上的积分：\n$$\n\\overline{\\mathcal{T}}(L) = \\int_0^1 \\mathcal{T}(x;L)\\,dx = \\int_0^1 \\exp\\!\\left(-\\kappa(x)\\,L\\right)\\,dx\n$$\n在这里，$\\kappa(x)$ 是光谱吸收系数，由一个基线和五个代表光谱线的高斯函数之和给出。解决方案的步骤是实现两种指定的数值方法来近似该积分，然后计算它们的相对差异。\n\n计算过程如下：\n\n1.  **光谱离散化与求值**：\n    首先，我们根据问题陈述定义吸收系数 $\\kappa(x)$ 的函数：\n    $$\n    \\kappa(x) = b + \\sum_{i=1}^{5} A_i \\exp\\!\\left(-\\frac{(x-\\mu_i)^2}{2\\,\\sigma_i^2}\\right)\n    $$\n    使用给定的参数 $b$、$A_i$、$\\mu_i$ 和 $\\sigma_i$。然后我们创建一个包含 $N=4096$ 个点的均匀光谱网格 $\\{x_j\\}$，其中 $x_j = (j-0.5)/N$，对于 $j=1, \\dots, N$。在每个点上对吸收系数进行求值，以获得离散光谱 $\\{\\kappa(x_j)\\}$。\n\n2.  **逐线 (LbL) 参考计算**：\n    波段平均透过率的 LbL 近似作为高保真参考。它是通过在 $N$ 个光谱点上使用均匀黎曼和来计算的：\n    $$\n    \\overline{\\mathcal{T}}_{\\text{LbL}}(L) = \\frac{1}{N}\\sum_{j=1}^{N} \\exp\\!\\left(-\\kappa(x_j)\\,L\\right)\n    $$\n    对于给定的路径长度 $L$，首先计算每个点 $x_j$ 的光谱透过率 $\\exp(-\\kappa(x_j)L)$，然后取这些值的算术平均值。\n\n3.  **Correlated-$k$ 分布构建**：\n    correlated-$k$ 方法将对光谱坐标 $x$ 的积分重构为对累积概率坐标 $g$ 的积分。这是通过对光谱吸收系数进行重排序来实现的。将 $N$ 个值组成的集合 $\\{\\kappa(x_j)\\}$ 按非递减顺序排序，得到序列 $\\{k_{(j)}\\}$。将这个排序后的序列与累积坐标 $g_j = (j-0.5)/N$ 对应绘制，就构成了经验 $k$ 分布。问题定义了一个分位数函数 $Q(g)$，它将 $g \\in [0,1]$ 映射到一个吸收系数 $k$。该函数通过对离散数据点 $(g_j, k_{(j)})$ 进行线性插值来构建。\n\n4.  **Correlated-$k$ 透过率计算**：\n    通过重排序，波段平均透过率积分变换为：\n    $$\n    \\overline{\\mathcal{T}}(L) = \\int_0^1 \\exp\\!\\left(-\\kappa(x)\\,L\\right)\\,dx = \\int_0^1 \\exp\\!\\left(-Q(g)\\,L\\right)\\,dg\n    $$\n    这个新积分使用在域 $g \\in [0,1]$ 上的 $m$ 点 Gauss-Legendre 求积进行计算。标准的 Gauss-Legendre 求积节点 $\\{\\xi_q\\}$ 和权重 $\\{w_q^{(\\xi)}\\}$ 定义在 $[-1,1]$ 上。它们通过仿射变换映射到区间 $[0,1]$：\n    $$\n    g_q = \\frac{1}{2}(\\xi_q + 1), \\quad w_q^{(g)} = \\frac{1}{2}w_q^{(\\xi)}\n    $$\n    然后，correlated-$k$ 透过率通过以下求和来近似：\n    $$\n    \\overline{\\mathcal{T}}_{k}(L; m) \\approx \\sum_{q=1}^{m} w_q^{(g)} \\exp\\!\\left(-Q(g_q)\\,L\\right)\n    $$\n    对于每个求积点 $g_q$，通过对上一步构建的经验 $k$ 分布进行插值来找到相应的值 $Q(g_q)$。\n\n5.  **相对误差计算**：\n    对于每个测试用例对 $(L, m)$，correlated-$k$ 近似相对于 LbL 参考的相对误差 $\\varepsilon_{\\text{rel}}$ 计算如下：\n    $$\n    \\varepsilon_{\\text{rel}} = \\frac{\\left|\\overline{\\mathcal{T}}_{k}(L; m) - \\overline{\\mathcal{T}}_{\\text{LbL}}(L)\\right|}{\\overline{\\mathcal{T}}_{\\text{LbL}}(L)}\n    $$\n    对所有六个指定的 $(L, m)$ 对执行此过程，并将得到的相对误差收集并格式化以备最终输出。该实现使用 `numpy` 进行高效的数组运算，并使用 `scipy.special.roots_legendre` 获取 Gauss-Legendre 求积节点和权重。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_legendre\n\ndef solve():\n    \"\"\"\n    Computes the relative error between LbL and correlated-k models for band-mean\n    transmissivity for a suite of test cases.\n    \"\"\"\n    # Define constants for the absorption coefficient model from the problem statement.\n    B = 0.2  # m^-1\n    MU = np.array([0.15, 0.37, 0.55, 0.72, 0.90])\n    A = np.array([150.0, 50.0, 300.0, 120.0, 220.0])  # m^-1\n    SIGMA = np.array([0.01, 0.02, 0.015, 0.025, 0.008])\n    N = 4096\n\n    # Define the test cases (L, m)\n    test_cases = [\n        (0.01, 4),\n        (0.01, 12),\n        (1.0, 4),\n        (1.0, 12),\n        (10.0, 4),\n        (10.0, 12),\n    ]\n\n    def kappa(x_grid):\n        \"\"\"\n        Calculates the spectral absorption coefficient kappa(x).\n        x_grid is expected to be a numpy array.\n        \"\"\"\n        # Ensure x_grid is a column vector to enable broadcasting against row vectors MU, A, SIGMA.\n        x_col = np.atleast_1d(x_grid)[:, np.newaxis]\n        \n        # Compute sum of Gaussians using broadcasting for efficiency.\n        # The expression `(x_col - MU)` broadcasts to a shape of (len(x_grid), 5).\n        # The sum is then performed along axis=1 to collapse the 5 Gaussian components.\n        gaussians = np.sum(A * np.exp(-((x_col - MU)**2) / (2 * SIGMA**2)), axis=1)\n        \n        return B + gaussians\n\n    # Pre-computation Step: Generate spectral grid and kappa values.\n    # Grid points x_j = (j - 0.5) / N for j = 1, ..., N.\n    x_j = (np.arange(1, N + 1) - 0.5) / N\n    kappa_vals = kappa(x_j)\n\n    # Pre-computation Step: Construct the k-distribution.\n    # The quantile function Q(g) is defined by the sorted kappa values\n    # against the cumulative probability coordinate g.\n    k_sorted = np.sort(kappa_vals)\n    # For a uniform spectral grid, the cumulative probability coordinates g_j are identical to x_j.\n    g_j = (np.arange(1, N + 1) - 0.5) / N\n    \n    results = []\n    for L, m in test_cases:\n        # Step 1: Compute the LbL reference transmissivity.\n        # This is the mean of the spectral transmissivity over the uniform grid.\n        transmissivity_lbl_spectral = np.exp(-kappa_vals * L)\n        mean_transmissivity_lbl = np.mean(transmissivity_lbl_spectral)\n\n        # Step 2: Compute the correlated-k transmissivity.\n        # Get Gauss-Legendre quadrature nodes (xi) and weights (w) for order m on [-1, 1].\n        xi_q_raw, w_q_raw = roots_legendre(m)\n        \n        # Affine mapping from [-1, 1] to [0, 1] for quadrature points and weights.\n        g_q = 0.5 * (xi_q_raw + 1.0)\n        w_q_g = 0.5 * w_q_raw\n        \n        # Evaluate the quantile function Q(g) at the quadrature points g_q\n        # by interpolating the pre-computed k-distribution (g_j, k_sorted).\n        k_q = np.interp(g_q, g_j, k_sorted)\n        \n        # Compute the correlated-k transmissivity as a weighted sum.\n        transmissivity_k_points = np.exp(-k_q * L)\n        mean_transmissivity_k = np.sum(w_q_g * transmissivity_k_points)\n        \n        # Step 3: Compute the relative error and store it.\n        relative_error = np.abs(mean_transmissivity_k - mean_transmissivity_lbl) / mean_transmissivity_lbl\n        results.append(relative_error)\n\n    # Format the final output as a single-line comma-separated list in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "离散坐标法（DOM）是求解辐射传输方程的通用工具，但其最终精度在很大程度上取决于空间离散格式的选择。本练习将带您深入了解 DOM 求解器的内部工作原理，要求您实现并比较两种基础且重要的空间格式：阶梯特征线法和菱形差分法 ()。通过在一个经典的基准问题中分析它们的数值行为，您将直观地认识到数值扩散和非物理振荡等关键问题，从而为在实际应用中选择和开发稳健的辐射模型打下坚实基础。",
            "id": "4056022",
            "problem": "考虑一个一维平面平行板，其厚度为 $L$，由参与介质构成，空间坐标为 $x \\in [0,L]$。该介质是灰体，在子区域内等温，并处于局部热力学平衡状态，因此其发射由黑体源项 $B(x)$（为进行无量纲化已归一化）表征。忽略散射和对流。设吸收系数为 $\\kappa > 0$ 且为常数。在稳态下，沿方向余弦 $\\mu \\in [-1,1]$ 的辐射强度 $I(x,\\mu)$ 的辐射传输方程 (RTE) 为\n$$\n\\mu \\,\\frac{\\partial I(x,\\mu)}{\\partial x} + \\kappa \\, I(x,\\mu) = \\kappa \\, B(x).\n$$\n假设板的两个表面均为真空边界条件，意味着没有入射辐射：\n$$\nI(0,\\mu>0) = 0, \\quad I(L,\\mu0) = 0.\n$$\n将标量通量（也称为平均强度）定义为\n$$\nJ(x) = \\frac{1}{2} \\int_{-1}^{1} I(x,\\mu) \\, d\\mu,\n$$\n在此处采用的归一化下，该量是无量纲的。\n\n使用离散纵标法 (DOM) 进行角度离散化，通过高斯-勒让德求积在 $[-1,1]$上获得 $N_\\mu$ 个方向和相应的权重 $\\{ \\mu_j, w_j \\}_{j=1}^{N_\\mu}$，其中权重满足 $\\sum_{j=1}^{N_\\mu} w_j = 2$，并用于近似角度积分。将板在空间上离散为 $N_x$ 个宽度为 $\\Delta x = L / N_x$ 的均匀单元。源项 $B(x)$ 是分段常数：\n- $B(x) = 1$ 对于 $x \\in [0, L/2)$，\n- $B(x) = 0$ 对于 $x \\in (L/2, L]$。\n在 $x = L/2$ 处，不连续性位于由此规定定义的两个不同单元中心区域之间的界面上。\n\n仅从 RTE 和这些定义出发，推导并实现两种不同的空间离散化格式，用于在板上进行 DOM 扫描：\n- 阶梯特征线格式，该格式在每个单元源项为常数的假设下，沿特征线精确积分 RTE。\n- 菱形差分格式，该格式使用单元面差分近似导数（迁移项），并使用菱形平均近似反应项中的强度。\n\n在每种情况下，对于 $\\mu > 0$，从 $x=0$ 到 $x=L$ 进行方向扫描；对于 $\\mu  0$，从 $x=L$ 到 $x=0$ 进行方向扫描，并应用真空边界条件。对于阶梯特征线格式，从第一性原理计算每个方向的单元平均强度。对于菱形差分格式，使用标准的菱形平均计算单元中心强度。\n\n通过离散纵标求积计算每个单元中心 $x_i$ 处的标量通量 $J(x_i)$\n$$\nJ(x_i) \\approx \\frac{1}{2} \\sum_{j=1}^{N_\\mu} w_j \\, I_{i}^{(j)},\n$$\n其中 $I_{i}^{(j)}$ 表示单元 $i$ 中沿方向 $j$ 的单元平均强度。\n\n使用以下指标定义菱形差分格式相对于阶梯特征线格式的数值弥散的定量度量：\n- 标量通量的均方根误差，\n$$\nE_{\\mathrm{L2}} = \\left( \\frac{1}{N_x} \\sum_{i=1}^{N_x} \\left(J_{\\mathrm{DD}}(x_i) - J_{\\mathrm{SC}}(x_i)\\right)^2 \\right)^{1/2},\n$$\n- 最大范数误差，\n$$\nE_{\\mathrm{L\\infty}} = \\max_{1 \\le i \\le N_x} \\left| J_{\\mathrm{DD}}(x_i) - J_{\\mathrm{SC}}(x_i) \\right|,\n$$\n- 梯度抑制比，\n$$\nR_{\\nabla} = \\frac{\\max_{1 \\le i \\le N_x - 1} \\left| \\frac{J_{\\mathrm{DD}}(x_{i+1}) - J_{\\mathrm{DD}}(x_i)}{\\Delta x} \\right|}{\\max_{1 \\le i \\le N_x - 1} \\left| \\frac{J_{\\mathrm{SC}}(x_{i+1}) - J_{\\mathrm{SC}}(x_i)}{\\Delta x} \\right|},\n$$\n约定如果分母为零，则 $R_{\\nabla} = 0$。\n此外，报告 $J_{\\mathrm{DD}}(x_i)  0$ 的单元数量，记为 $N_{\\mathrm{neg}}$，以突出显示菱形差分格式产生的任何非物理下冲。\n\n在归一化 $B \\in \\{0,1\\}$ 和真空边界条件下，所有量均为无量纲。使用高斯-勒让德求积进行角度离散化，并确保角度权重之和为 $2$。\n\n测试案例：\n- 案例 A (标准情况)：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 3$, $N_x = 80$, $N_\\mu = 8$。\n- 案例 B (输运主导边界)：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 0.3$, $N_x = 80$, $N_\\mu = 8$。\n- 案例 C (光学厚度边缘情况)：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 5$, $N_x = 50$, $N_\\mu = 8$。\n\n对于每个案例，计算并报告四个值 $[E_{\\mathrm{L2}}, E_{\\mathrm{L\\infty}}, R_{\\nabla}, N_{\\mathrm{neg}}]$，其中误差和梯度抑制比为浮点数，非物理计数为整数。您的程序应生成单行输出，其中包含所有三个案例的结果，格式为一个由这四个值的元组组成的逗号分隔列表，并用方括号括起来。例如：\"[[e1,e2,e3,e4],[e1,e2,e3,e4],[e1,e2,e3,e4]]\"。所有输出均表示为无单位、无额外空格的无量纲数。",
            "solution": "首先根据既定标准对用户提供的问题进行验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：对于灰体、非散射、吸收-发射介质，一维稳态辐射传输方程 (RTE) 为 $\\mu \\,\\frac{\\partial I(x,\\mu)}{\\partial x} + \\kappa \\, I(x,\\mu) = \\kappa \\, B(x)$。\n- **域**：厚度为 $L$ 的平面平行板，空间坐标为 $x \\in [0,L]$。\n- **方向余弦**：$\\mu \\in [-1,1]$。\n- **介质属性**：吸收系数 $\\kappa$ 为正常数。\n- **源项**：黑体源项 $B(x)$ 是分段常数：$B(x) = 1$ 对于 $x \\in [0, L/2)$ 且 $B(x) = 0$ 对于 $x \\in (L/2, L]$。\n- **边界条件**：应用真空条件：$I(0,\\mu>0) = 0$ 和 $I(L,\\mu0) = 0$。\n- **标量通量定义**：$J(x) = \\frac{1}{2} \\int_{-1}^{1} I(x,\\mu) \\, d\\mu$。\n- **角度离散化**：采用离散纵标法 (DOM)，使用 $N_\\mu$ 点高斯-勒让德求积集 $\\{\\mu_j, w_j\\}_{j=1}^{N_\\mu}$，其中 $\\sum_{j=1}^{N_\\mu} w_j = 2$。\n- **空间离散化**：将域划分为 $N_x$ 个宽度为 $\\Delta x = L / N_x$ 的均匀单元。\n- **数值格式**：\n    1.  **阶梯特征线 (SC)**：假设每个单元的源项为常数，从而沿特征线对 RTE 进行精确积分。\n    2.  **菱形差分 (DD)**：用单元面差分近似空间导数，用单元面强度的算术平均值近似单元平均强度。\n- **标量通量求积**：$J(x_i) \\approx \\frac{1}{2} \\sum_{j=1}^{N_\\mu} w_j \\, I_{i}^{(j)}$，其中 $I_{i}^{(j)}$ 是单元 $i$ 中方向 $j$ 的单元平均强度。\n- **误差度量**：\n    -   均方根误差：$E_{\\mathrm{L2}} = \\left( \\frac{1}{N_x} \\sum_{i=1}^{N_x} \\left(J_{\\mathrm{DD}}(x_i) - J_{\\mathrm{SC}}(x_i)\\right)^2 \\right)^{1/2}$。\n    -   最大范数误差：$E_{\\mathrm{L\\infty}} = \\max_{1 \\le i \\le N_x} \\left| J_{\\mathrm{DD}}(x_i) - J_{\\mathrm{SC}}(x_i) \\right|$。\n    -   梯度抑制比：$R_{\\nabla} = \\frac{\\max_{1 \\le i \\le N_x - 1} \\left| \\frac{J_{\\mathrm{DD}}(x_{i+1}) - J_{\\mathrm{DD}}(x_i)}{\\Delta x} \\right|}{\\max_{1 \\le i \\le N_x - 1} \\left| \\frac{J_{\\mathrm{SC}}(x_{i+1}) - J_{\\mathrm{SC}}(x_i)}{\\Delta x} \\right|}$ （若分母为 0，则 $R_{\\nabla} = 0$）。\n    -   负通量计数：$N_{\\mathrm{neg}}$，即 $J_{\\mathrm{DD}}(x_i)  0$ 的单元数量。\n- **测试案例**：\n    -   案例 A：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 3$, $N_x = 80$, $N_\\mu = 8$。\n    -   案例 B：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 0.3$, $N_x = 80$, $N_\\mu = 8$。\n    -   案例 C：$L = 1$, $\\tau_{\\mathrm{tot}} = \\kappa L = 5$, $N_x = 50$, $N_\\mu = 8$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于基本的辐射传输方程，这是物理学和工程学中输运现象的基石。指定的数值方法（DOM、SC、DD）是求解 RTE 的标准、文档齐全的技术。该设置是一个经典的基准问题，用于评估数值格式处理不连续性和数值弥散的能力。问题不含任何伪科学或推测。\n- **适定性**：该问题是适定的。RTE 是一个线性一阶偏微分方程。在给定的边界条件和定义的源项下，强度场 $I(x, \\mu)$ 存在唯一解。基于稳定离散格式（或具有已知稳定性限制的格式，如 DD）的数值问题也是适定的。\n- **客观性**：问题以精确、客观的数学语言陈述。所有术语都有定义，任务明确无歧义。\n- **完整性与一致性**：问题是自洽的。所有必要的参数（$L$、$\\tau_{tot}$、$N_x$、$N_\\mu$）、定义（格式、误差度量）和边界条件都已提供。没有矛盾之处。\n- **现实性与可行性**：该物理场景是辐射传热分析中的一个标准理想化模型。参数是物理上合理的无量纲值。计算任务是可行的。\n- **结构与形式化**：问题结构性强，且已在数学上形式化。它要求实现和比较具体的数值算法。\n\n### 步骤 3：结论与行动\n此问题是**有效的**。这是一个计算辐射传输中的标准、适定的问题，用于测试数值离散化和分析的基本概念。将提供完整解答。\n\n### 解答推导\n\n问题要求解灰体、非散射介质的一维稳态辐射传输方程 (RTE)：\n$$\n\\mu \\frac{\\partial I(x, \\mu)}{\\partial x} + \\kappa I(x, \\mu) = \\kappa B(x)\n$$\n采用离散纵标法 (DOM) 进行角度离散化。该方法用一组 $N_\\mu$ 个离散方向 $\\{\\mu_j\\}_{j=1}^{N_\\mu}$ 和相应的求积权重 $\\{w_j\\}_{j=1}^{N_\\mu}$ 替代连续的角度变量 $\\mu$。这将单个偏微分方程 (PDE) 转换为一个由 $N_\\mu$ 个常微分方程 (ODE) 组成的系统，每个方向 $\\mu_j$ 对应一个方程：\n$$\n\\mu_j \\frac{dI_j(x)}{dx} + \\kappa I_j(x) = \\kappa B(x)\n$$\n其中 $I_j(x) \\equiv I(x, \\mu_j)$。将空间域 $x \\in [0, L]$ 离散为 $N_x$ 个均匀单元，索引为 $i=1, \\dots, N_x$。每个单元 $i$ 的宽度为 $\\Delta x = L/N_x$，中心位于 $x_i$，跨越区间 $[x_{i-1/2}, x_{i+1/2}]$。假定源项 $B(x)$ 在每个单元内为常数，记为 $B_i$。\n\n将方向 $j$ 的 ODE 在单元 $i$ 上从 $x_{i-1/2}$ 到 $x_{i+1/2}$ 积分，得到该单元的精确平衡方程：\n$$\n\\mu_j \\left( I_{j, i+1/2} - I_{j, i-1/2} \\right) + \\kappa \\int_{x_{i-1/2}}^{x_{i+1/2}} I_j(x) dx = \\kappa B_i \\Delta x\n$$\n两边同除以 $\\Delta x$ 并定义单元平均强度为 $I_{i}^{(j)} = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} I_j(x) dx$，我们得到：\n$$\n\\frac{\\mu_j}{\\Delta x} \\left( I_{j, i+1/2} - I_{j, i-1/2} \\right) + \\kappa I_{i}^{(j)} = \\kappa B_i\n$$\n这里，$I_{j, i-1/2}$ 和 $I_{j, i+1/2}$ 分别代表单元 $i$ 左、右两面的辐射强度。不同的数值格式源于单元平均强度 $I_{i}^{(j)}$ 与单元面强度之间的不同关系。\n\n**1. 阶梯特征线 (SC) 格式**\n\n阶梯特征线格式是通过精确求解 ODE 推导出来的，其中假设源项 $B_i$ 在单元内是常数。ODE 的形式解将单元的出射强度与入射强度联系起来。我们定义沿方向 $\\mu_j$ 的单元光学厚度为 $\\Delta \\tau_j = \\frac{\\kappa \\Delta x}{|\\mu_j|}$。\n\n对于正向扫描 ($\\mu_j > 0$)，强度从左侧 ($x_{i-1/2}$) 传播到右侧 ($x_{i+1/2}$)。出射强度 $I_{j, i+1/2}$ 由下式给出：\n$$\nI_{j, i+1/2} = I_{j, i-1/2} e^{-\\kappa \\Delta x / \\mu_j} + B_i \\left( 1 - e^{-\\kappa \\Delta x / \\mu_j} \\right)\n$$\n对于反向扫描 ($\\mu_j  0$)，传播从右到左。在 $x_{i-1/2}$ 处的出射强度为：\n$$\nI_{j, i-1/2} = I_{j, i+1/2} e^{\\kappa \\Delta x / \\mu_j} + B_i \\left( 1 - e^{\\kappa \\Delta x / \\mu_j} \\right)\n$$\n问题要求计算单元平均强度 $I_{i}^{(j)}$。这可以从单元平衡方程中求得，经整理后可得：\n$$\nI_{i}^{(j)} = B_i - \\frac{\\mu_j}{\\kappa \\Delta x} \\left( I_{j, i+1/2} - I_{j, i-1/2} \\right)\n$$\n对于分段常数源，此关系是精确的。在扫描过程中，我们首先计算出射面强度，然后用它和入射面强度来求解单元平均强度。\n\n**2. 菱形差分 (DD) 格式**\n\n菱形差分格式提供了一个更简单的代数封闭关系。它将单元平均强度 $I_{i}^{(j)}$ 近似为单元面强度的算术平均值：\n$$\nI_{i}^{(j)} = \\frac{I_{j, i+1/2} + I_{j, i-1/2}}{2}\n$$\n将此封闭关系代入单元平衡方程，得到：\n$$\n\\frac{\\mu_j}{\\Delta x} \\left( I_{j, i+1/2} - I_{j, i-1/2} \\right) + \\kappa \\frac{I_{j, i+1/2} + I_{j, i-1/2}}{2} = \\kappa B_i\n$$\n该方程可以重新整理，以根据入射强度求解出射强度。\n\n对于正向扫描 ($\\mu_j > 0$)，求解 $I_{j, i+1/2}$ 可得：\n$$\nI_{j, i+1/2} = \\frac{\\mu_j - \\frac{\\kappa \\Delta x}{2}}{\\mu_j + \\frac{\\kappa \\Delta x}{2}} I_{j, i-1/2} + \\frac{\\kappa \\Delta x}{\\mu_j + \\frac{\\kappa \\Delta x}{2}} B_i\n$$\n对于反向扫描 ($\\mu_j  0$)，求解 $I_{j, i-1/2}$ 可得：\n$$\nI_{j, i-1/2} = \\frac{-\\mu_j - \\frac{\\kappa \\Delta x}{2}}{-\\mu_j + \\frac{\\kappa \\Delta x}{2}} I_{j, i+1/2} + \\frac{\\kappa \\Delta x}{-\\mu_j + \\frac{\\kappa \\Delta x}{2}} B_i\n$$\n计算出射强度后，使用菱形差分关系本身来计算单元平均强度 $I_{i}^{(j)}$。该格式在空间上是二阶精确的，但如果单元光学厚度 $\\frac{\\kappa \\Delta x}{|\\mu_j|}$ 较大（通常大于 2），它可能会产生非物理振荡和负强度，因为这会使得入射强度的系数变为负值。\n\n**输运扫描算法**\n\n对于这两种格式，解都是通过对每个离散方向 $\\mu_j$ 在空间网格上执行输运扫描来获得的。\n- 如果 $\\mu_j > 0$，扫描从左到右进行 ($i = 1, \\dots, N_x$)。单元 $i$ 的计算使用来自单元 $i-1$ 的入射强度。边界条件是 $I_{j, 1/2} = I(0, \\mu_j>0) = 0$。\n- 如果 $\\mu_j  0$，扫描从右到左进行 ($i = N_x, \\dots, 1$)。单元 $i$ 的计算使用来自单元 $i+1$ 的入射强度。边界条件是 $I_{j, N_x+1/2} = I(L, \\mu_j0) = 0$。\n\n在计算完所有单元 $i$ 和方向 $j$ 的单元平均强度 $I_{i}^{(j)}$ 后，使用求积公式计算每个单元中心 $x_i$ 处的标量通量：\n$$\nJ(x_i) = \\frac{1}{2} \\sum_{j=1}^{N_\\mu} w_j I_{i}^{(j)}\n$$\n\n**比较度量**\n阶梯特征线解 $J_{\\mathrm{SC}}$ 作为高保真基准（因为它对分段常数源是精确的）。菱形差分解 $J_{\\mathrm{DD}}$ 与之进行比较，使用指定的度量：$E_{\\mathrm{L2}}$ (均方根误差)，$E_{\\mathrm{L\\infty}}$ (最大绝对误差)，$R_{\\nabla}$ (梯度抑制比)，以及 $N_{\\mathrm{neg}}$ (负标量通量单元计数)。$R_{\\nabla}  1$ 表示数值弥散（梯度的涂抹），而 $N_{\\mathrm{neg}} > 0$ 表示非物理下冲，这是像菱形差分这样的高阶格式在急剧梯度附近常见的现象。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef transport_sweep_solver(L, kappa, Nx, N_mu, B, scheme):\n    \"\"\"\n    Solves the 1D RTE using DOM with either Step Characteristics or Diamond Difference.\n\n    Args:\n        L (float): Thickness of the slab.\n        kappa (float): Absorption coefficient.\n        Nx (int): Number of spatial cells.\n        N_mu (int): Number of discrete ordinates (must be even).\n        B (np.ndarray): Array of source terms for each cell.\n        scheme (str): 'SC' for Step Characteristics or 'DD' for Diamond Difference.\n\n    Returns:\n        np.ndarray: Scalar flux J at each cell center.\n    \"\"\"\n    dx = L / Nx\n    mu, w = np.polynomial.legendre.leggauss(N_mu)\n\n    I_avg = np.zeros((Nx, N_mu))\n\n    for j in range(N_mu):\n        if mu[j] > 0:  # Forward sweep from x=0 to x=L\n            I_face_in = 0.0  # Boundary condition I(0, mu>0) = 0\n\n            for i in range(Nx):\n                B_i = B[i]\n                if scheme == 'SC':\n                    exp_term = np.exp(-kappa * dx / mu[j])\n                    I_face_out = I_face_in * exp_term + B_i * (1 - exp_term)\n                    # The cell average is derived from the cell balance equation\n                    if kappa > 1e-12:\n                        I_avg[i, j] = B_i - (mu[j] / (kappa * dx)) * (I_face_out - I_face_in)\n                    else: # Optically thin limit kappa -> 0\n                        I_avg[i, j] = I_face_in\n                \n                elif scheme == 'DD':\n                    den = mu[j] + kappa * dx / 2.0\n                    num1 = mu[j] - kappa * dx / 2.0\n                    num2 = kappa * dx\n                    I_face_out = (num1 / den) * I_face_in + (num2 / den) * B_i\n                    I_avg[i, j] = (I_face_out + I_face_in) / 2.0\n                \n                I_face_in = I_face_out\n\n        elif mu[j]  0:  # Backward sweep from x=L to x=0\n            I_face_in = 0.0  # Boundary condition I(L, mu0) = 0\n            \n            for i in range(Nx - 1, -1, -1):\n                B_i = B[i]\n                # Note: mu[j] is negative\n                if scheme == 'SC':\n                    exp_term = np.exp(kappa * dx / mu[j]) # Same as exp(-kappa*dx/|mu[j]|)\n                    I_face_out = I_face_in * exp_term + B_i * (1 - exp_term)\n                    # I_face_out is intensity at left face of cell i\n                    # I_face_in is intensity at right face of cell i\n                    if kappa > 1e-12:\n                        I_avg[i, j] = B_i - (mu[j] / (kappa * dx)) * (I_face_in - I_face_out)\n                    else:\n                        I_avg[i, j] = I_face_in\n                \n                elif scheme == 'DD':\n                    # Let's use mu_abs to avoid confusion with signs\n                    mu_abs = -mu[j]\n                    den = mu_abs + kappa * dx / 2.0\n                    num1 = mu_abs - kappa * dx / 2.0\n                    num2 = kappa * dx\n                    I_face_out = (num1 / den) * I_face_in + (num2 / den) * B_i\n                    I_avg[i, j] = (I_face_out + I_face_in) / 2.0\n                \n                I_face_in = I_face_out\n\n    # Compute scalar flux J using quadrature\n    J = 0.5 * np.dot(I_avg, w)\n    return J\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute error metrics.\n    \"\"\"\n    test_cases = [\n        # (L, tau_tot, Nx, N_mu)\n        (1.0, 3.0, 80, 8),  # Case A\n        (1.0, 0.3, 80, 8),  # Case B\n        (1.0, 5.0, 50, 8),  # Case C\n    ]\n\n    all_results = []\n\n    for L, tau_tot, Nx, N_mu in test_cases:\n        kappa = tau_tot / L\n        dx = L / Nx\n        \n        # Define cell centers and source term B\n        cell_centers = (np.arange(Nx) + 0.5) * dx\n        B = np.where(cell_centers  L / 2.0, 1.0, 0.0)\n\n        # Get solution from Step Characteristics (benchmark)\n        J_sc = transport_sweep_solver(L, kappa, Nx, N_mu, B, 'SC')\n\n        # Get solution from Diamond Difference\n        J_dd = transport_sweep_solver(L, kappa, Nx, N_mu, B, 'DD')\n\n        # --- Compute Metrics ---\n\n        # 1. L2 Error\n        E_L2 = np.sqrt(np.mean((J_dd - J_sc)**2))\n\n        # 2. L-infinity Error\n        E_Linf = np.max(np.abs(J_dd - J_sc))\n        \n        # 3. Gradient Suppression Ratio\n        grad_sc = np.abs(np.diff(J_sc) / dx)\n        grad_dd = np.abs(np.diff(J_dd) / dx)\n        \n        max_grad_sc = np.max(grad_sc)\n        max_grad_dd = np.max(grad_dd)\n\n        if max_grad_sc == 0:\n            R_nabla = 0.0\n        else:\n            R_nabla = max_grad_dd / max_grad_sc\n            \n        # 4. Count of negative scalar flux cells\n        N_neg = np.sum(J_dd  0)\n\n        results_tuple = [E_L2, E_Linf, R_nabla, int(N_neg)]\n        all_results.append(results_tuple)\n\n    # Format the final output string\n    # Convert each inner list of numbers to a string representation\n    inner_strs = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    # Join the inner list strings with commas and enclose in brackets\n    final_output = f\"[{','.join(inner_strs)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}