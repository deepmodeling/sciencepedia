{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂应用之前，理解离散坐标法 (DOM) 的基本误差来源至关重要。本练习通过将 DOM 近似与理想化光学薄场景下的精确解析解进行比较，分离出角度离散化误差。这为衡量该方法的几何精度提供了一个清晰的标准，有助于我们理解其作为辐射传递方程数值解的内在局限性。",
            "id": "4020307",
            "problem": "考虑在边长为 $L$ 的轴对齐立方体内的均匀、等温、灰体、非散射气体中的单色辐射传输，该立方体具有冷黑边界表面（边界入射强度为零）。设气体吸收系数为 $\\kappa$（单位 $\\,\\mathrm{m^{-1}}$），发射由常数普朗克函数 $B$（单位 $\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}}$）表征。沿由弧长 $s$ 和方向单位向量 $\\boldsymbol{\\omega}$ 参数化的射线的辐射传输方程 (RTE) 为\n$$\n\\frac{d I(s,\\boldsymbol{\\omega})}{d s} \\;=\\; -\\,\\kappa\\, I(s,\\boldsymbol{\\omega}) \\;+\\; \\kappa\\, B,\n$$\n服从边界条件，即在立方体表面 $I=0$（冷黑边界）。将光学厚度定义为 $\\tau = \\kappa\\,L$。\n\n在光学薄极限下，假设 $\\kappa\\,L \\ll 1$，并从 RTE 系统地推导出立方体中心强度 $I_\\text{exact}(\\boldsymbol{\\omega})$ 的视线表达式，该表达式是 $\\kappa$、$B$ 以及沿方向 $\\boldsymbol{\\omega}$ 到最近边界距离的函数。为此，从 RTE 和冷黑边界条件出发获得积分解，然后取 $\\kappa L \\ll 1$ 极限来简化指数衰减因子。对于以原点为中心的轴对齐立方体，说明如何用 $\\boldsymbol{\\omega}$ 的方向余弦和 $L$ 来表示从中心到方向 $\\boldsymbol{\\omega}$ 上边界的视线距离 $s_b(\\boldsymbol{\\omega})$。\n\n现在，使用离散纵标法 (DOM) 近似相同的视线强度，该方法用有限的方向集代替连续的角度依赖性。使用具有 $N$ 个极向划分和 $N$ 个方位向划分的张量积角度网格来定义 $N^2$ 个离散纵标：\n- 极角 $\\theta_j = \\left(j+\\tfrac{1}{2}\\right)\\,\\pi/N$，其中 $j=0,1,\\dots,N-1$，\n- 方位角 $\\phi_k = \\left(k+\\tfrac{1}{2}\\right)\\,2\\pi/N$，其中 $k=0,1,\\dots,N-1$，\n以及相应的单位向量 $\\boldsymbol{\\omega}_{j,k} = \\big(\\sin\\theta_j\\cos\\phi_k,\\; \\sin\\theta_j\\sin\\phi_k,\\; \\cos\\theta_j\\big)$。对于给定的目标方向，其角度为 $(\\theta^\\star,\\phi^\\star)$，通过选择最近的离散纵标 $\\boldsymbol{\\omega}_{j,k}$（以最小角分离度量）并沿该离散方向评估光学薄视线积分来近似强度。将此 DOM 近似表示为 $I_\\text{DOM}(N,\\theta^\\star,\\phi^\\star)$。\n\n定义绝对误差\n$$\n\\varepsilon(\\tau,N,\\theta^\\star,\\phi^\\star) \\;=\\; \\big|\\,I_\\text{DOM}(N,\\theta^\\star,\\phi^\\star) \\;-\\; I_\\text{exact}(\\theta^\\star,\\phi^\\star)\\,\\big|,\n$$\n并研究其对光学厚度 $\\tau$ 和角分辨率 $N$ 的依赖性。\n\n您的程序必须：\n- 从第一性原理出发（如上所述，从 RTE 开始）实现精确的光学薄视线强度。\n- 使用上面定义的角度网格和最近方向选择来实现 DOM 近似。\n- 对以下测试套件计算绝对误差，其中 $L=1\\,\\mathrm{m}$ 和 $B=1\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}}$，角度以弧度为单位：\n    1. $\\tau = 10^{-3}$, $N=8$, $(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$,\n    2. $\\tau = 10^{-3}$, $N=2$, $(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$,\n    3. $\\tau = 10^{-3}$, $N=32$, $(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$,\n    4. $\\tau = 5\\times 10^{-4}$, $N=8$, $(\\theta^\\star,\\phi^\\star)=(0.05,\\,2.2)$,\n    5. $\\tau = 10^{-2}$, $N=8$, $(\\theta^\\star,\\phi^\\star)=(1.55,\\,\\tfrac{\\pi}{4})$,\n    6. $\\tau = 10^{-1}$, $N=8$, $(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$。\n- 以 $\\mathrm{W\\,m^{-2}\\,sr^{-1}}$ 为单位表示绝对误差。\n- 生成单行输出，包含六个误差值，形式为逗号分隔的列表并用方括号括起来，例如 $\\big[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4,\\varepsilon_5,\\varepsilon_6\\big]$。\n\n角度必须以弧度为单位。所有物理量必须使用 $L$（单位为米）、$\\kappa$（单位为米分之一）和 $B$（单位为瓦特每平方米每球面度）进行计算。测试套件的最终答案必须是浮点数。",
            "solution": "用户提供的问题已经过评估且有效。它具有科学依据，提法恰当，客观，并包含得出唯一解所需的所有必要信息。\n\n解答过程分三个阶段：首先，在光学薄近似下推导立方体中心的精确视线强度；其次，为此强度建立离散纵标法 (DOM) 近似的公式；第三，针对指定的测试用例计算两者之间的绝对误差。\n\n**1. 精确光学薄强度 $I_\\text{exact}$ 的推导**\n\n出发点是具有恒定属性的非散射、发射-吸收介质的辐射传输方程 (RTE)，其形式如下：\n$$\n\\frac{d I(s, \\boldsymbol{\\omega})}{ds} = -\\kappa I(s, \\boldsymbol{\\omega}) + \\kappa B\n$$\n其中 $I$ 是方向 $\\boldsymbol{\\omega}$ 上的辐射强度，$s$ 是路径长度，$\\kappa$ 是吸收系数，$B$ 是普朗克函数，代表由发射引起的源项。这是一个一阶线性常微分方程。我们可以通过重排并使用积分因子 $e^{\\kappa s}$ 来求解它：\n$$\n\\frac{dI}{ds} + \\kappa I = \\kappa B\n$$\n$$\ne^{\\kappa s} \\frac{dI}{ds} + \\kappa e^{\\kappa s} I = \\kappa B e^{\\kappa s}\n$$\n$$\n\\frac{d}{ds} \\left( I e^{\\kappa s} \\right) = \\kappa B e^{\\kappa s}\n$$\n为了求出点 $P$（立方体中心）的强度，我们沿着从边界点 $P_b$ 到 $P$ 的视线进行积分。让我们在 $P_b$ 处设路径坐标 $s'=0$，在 $P$ 處设 $s'=s_b$，其中 $s_b$ 是从中心到 $-\\boldsymbol{\\omega}$ 方向上边界的距离。积分结果为：\n$$\n\\int_{0}^{s_b} \\frac{d}{ds'} \\left( I(s') e^{\\kappa s'} \\right) ds' = \\int_{0}^{s_b} \\kappa B e^{\\kappa s'} ds'\n$$\n$$\nI(s_b) e^{\\kappa s_b} - I(0) e^0 = \\kappa B \\left[ \\frac{1}{\\kappa} e^{\\kappa s'} \\right]_0^{s_b} = B (e^{\\kappa s_b} - 1)\n$$\n问题陈述边界是冷黑的，意味着从任何边界表面发出的强度均为零。因此，边界条件是 $I(s'=0)=0$。代入此条件，我们得到：\n$$\nI(s_b) e^{\\kappa s_b} = B (e^{\\kappa s_b} - 1)\n$$\n$$\nI(s_b, \\boldsymbol{\\omega}) = B (1 - e^{-\\kappa s_b})\n$$\n这是中心强度的完整解。问题要求在光学薄极限下的解，此时区域的光学厚度很小，即 $\\tau = \\kappa L \\ll 1$。由于路径长度 $s_b$ 与 $L$ 同数量级，这意味着 $\\kappa s_b \\ll 1$。因此，我们可以使用指数函数的一阶泰勒级数展开式，$e^{-x} \\approx 1 - x$（对于小 $x$）。\n应用此近似，我们得到光学薄强度的表达式，我们将其记为 $I_\\text{exact}$：\n$$\nI_\\text{exact}(\\boldsymbol{\\omega}) \\approx B (1 - (1 - \\kappa s_b)) = B \\kappa s_b(\\boldsymbol{\\omega})\n$$\n\n**2. 几何路径长度 $s_b(\\boldsymbol{\\omega})$**\n\n立方体是轴对齐的，以原点 $(0,0,0)$ 为中心，边长为 $L$。其各面位于平面 $x=\\pm L/2$、$y=\\pm L/2$ 和 $z=\\pm L/2$。一束从边界向中心传播的光线沿 $-\\boldsymbol{\\omega}$ 方向移动。等效地，一束从中心 $\\mathbf{r}=(0,0,0)$ 发出、方向为 $\\boldsymbol{\\omega}$ 的射线可由参数方程 $\\mathbf{r}(s) = s\\boldsymbol{\\omega}$（对于 $s>0$）描述。设 $\\boldsymbol{\\omega}$ 的方向余弦为 $(\\mu, \\eta, \\xi)$，其中 $\\boldsymbol{\\omega} = (\\mu, \\eta, \\xi)$ 且 $\\mu^2+\\eta^2+\\xi^2=1$。射线上一点的坐标是 $(x,y,z) = (s\\mu, s\\eta, s\\xi)$。\n\n当满足以下条件之一时，射线与边界平面相交：\n$|x| = |s\\mu| = L/2 \\implies s = \\frac{L/2}{|\\mu|}$\n$|y| = |s\\eta| = L/2 \\implies s = \\frac{L/2}{|\\eta|}$\n$|z| = |s\\xi| = L/2 \\implies s = \\frac{L/2}{|\\xi|}$\n\n从中心沿此方向到最近边界点的距离 $s_b(\\boldsymbol{\\omega})$ 是这些正距离中的最小值：\n$$\ns_b(\\boldsymbol{\\omega}) = \\min\\left( \\frac{L/2}{|\\mu|}, \\frac{L/2}{|\\eta|}, \\frac{L/2}{|\\xi|} \\right)\n$$\n这可以更紧凑地写成：\n$$\ns_b(\\boldsymbol{\\omega}) = \\frac{L/2}{\\max(|\\mu|, |\\eta|, |\\xi|)}\n$$\n方向余弦可以用球坐标角 $(\\theta, \\phi)$ 表示为 $\\mu = \\sin\\theta\\cos\\phi$，$\\eta = \\sin\\theta\\sin\\phi$ 和 $\\xi = \\cos\\theta$。将这些代入强度表达式，我们得到：\n$$\nI_\\text{exact}(\\theta, \\phi) = B \\kappa \\left( \\frac{L/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)} \\right)\n$$\n使用光学厚度 $\\tau = \\kappa L$，这意味着 $\\kappa = \\tau/L$，表达式变得与 $L$ 无关：\n$$\nI_\\text{exact}(\\theta, \\phi) = B \\frac{\\tau}{L} \\left( \\frac{L/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)} \\right) = \\frac{B \\tau/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)}\n$$\n\n**3. 离散纵标法 (DOM) 近似, $I_\\text{DOM}$**\n\nDOM 用一组有限的离散方向或纵标 $\\{\\boldsymbol{\\omega}_{j,k}\\}$ 替换连续的角度域。问题指定了一个具有 $N^2$ 个纵标的张量积网格，定义如下：\n- 极角: $\\theta_j = \\left(j+\\tfrac{1}{2}\\right)\\frac{\\pi}{N}$ for $j=0, 1, \\dots, N-1$\n- 方位角: $\\phi_k = \\left(k+\\tfrac{1}{2}\\right)\\frac{2\\pi}{N}$ for $k=0, 1, \\dots, N-1$\n\n对于给定的目标方向 $\\boldsymbol{\\omega}^\\star$（角度为 $\\theta^\\star, \\phi^\\star$），该方法要求在集合中找到最近的离散纵标 $\\boldsymbol{\\omega}_{j,k}$。“最近”由最小角分离定义，这等效于最大化单位向量之间的点积。我们必须找到使下式最大化的索引对 $(j_0, k_0)$：\n$$\n(j_0, k_0) = \\underset{j,k}{\\operatorname{argmax}} (\\boldsymbol{\\omega}_{j,k} \\cdot \\boldsymbol{\\omega}^\\star)\n$$\n设最近的纵标为 $\\boldsymbol{\\omega}_\\text{DOM} = \\boldsymbol{\\omega}_{j_0, k_0}$。其方向余弦为 $(\\mu_\\text{DOM}, \\eta_\\text{DOM}, \\xi_\\text{DOM})$。\n\n强度的 DOM 近似 $I_\\text{DOM}$ 则是沿这个离散方向 $\\boldsymbol{\\omega}_\\text{DOM}$ 计算的光学薄强度：\n$$\nI_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) = B \\kappa s_b(\\boldsymbol{\\omega}_\\text{DOM})\n$$\n代入 $s_b$ 和 $\\kappa=\\tau/L$ 的表达式：\n$$\nI_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) = \\frac{B \\tau/2}{\\max(|\\mu_\\text{DOM}|, |\\eta_\\text{DOM}|, |\\xi_\\text{DOM}|)}\n$$\n\n**4. 测试套件的误差计算**\n\n绝对误差 $\\varepsilon$ 是 DOM 近似与精确光学薄解之差的绝对值：\n$$\n\\varepsilon(\\tau, N, \\theta^\\star, \\phi^\\star) = |I_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) - I_\\text{exact}(\\theta^\\star, \\phi^\\star)|\n$$\n$$\n\\varepsilon = \\frac{B\\tau}{2} \\left| \\frac{1}{\\max(|\\mu_\\text{DOM}|, |\\eta_\\text{DOM}|, |\\xi_\\text{DOM}|)} - \\frac{1}{\\max(|\\mu^\\star|, |\\eta^\\star|, |\\xi^\\star|)} \\right|\n$$\n提供的代码实现了这些公式，用于在 $L=1\\,\\mathrm{m}$ 和 $B=1\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}}$ 的条件下计算测试套件中每个案例的误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef get_thin_intensity(tau, b_val, l_val, theta, phi):\n    \"\"\"\n    Calculates the optically-thin intensity for a given direction.\n    This function implements the formula: I = B * (tau/L) * s_b.\n    \"\"\"\n    # Calculate direction cosines\n    mu = np.sin(theta) * np.cos(phi)\n    eta = np.sin(theta) * np.sin(phi)\n    xi = np.cos(theta)\n    \n    # Denominator for the path length calculation\n    max_abs_cosine = np.max([np.abs(mu), np.abs(eta), np.abs(xi)])\n    \n    # Avoid division by zero for directions exactly along an axis, though grid prevents this.\n    if max_abs_cosine == 0:\n        # This case should not be reached with the given angle definitions.\n        return np.inf\n\n    # Calculate distance to boundary from the center\n    s_b = (l_val / 2.0) / max_abs_cosine\n    \n    # Absorption coefficient from optical thickness and length\n    kappa = tau / l_val\n    \n    # Optically-thin intensity\n    intensity = b_val * kappa * s_b\n    \n    return intensity\n\ndef compute_error(tau, n_grid, theta_star, phi_star, l_val, b_val):\n    \"\"\"\n    Computes the absolute error between the exact and DOM-approximated intensities.\n    \"\"\"\n    # 1. Calculate the 'exact' optically-thin intensity for the target direction\n    i_exact = get_thin_intensity(tau, b_val, l_val, theta_star, phi_star)\n    \n    # 2. Find the nearest discrete ordinate for the DOM approximation\n    \n    # Target direction vector\n    w_star = np.array([\n        np.sin(theta_star) * np.cos(phi_star),\n        np.sin(theta_star) * np.sin(phi_star),\n        np.cos(theta_star)\n    ])\n    \n    max_dot_product = -1.0\n    theta_dom, phi_dom = -1.0, -1.0\n    \n    # Generate discrete polar angles\n    thetas_j = (np.arange(n_grid) + 0.5) * np.pi / n_grid\n    \n    # Generate discrete azimuthal angles\n    phis_k = (np.arange(n_grid) + 0.5) * 2.0 * np.pi / n_grid\n    \n    # Search for the nearest ordinate\n    for tj in thetas_j:\n        for pk in phis_k:\n            # DOM direction vector\n            w_jk = np.array([\n                np.sin(tj) * np.cos(pk),\n                np.sin(tj) * np.sin(pk),\n                np.cos(tj)\n            ])\n            \n            dot_product = np.dot(w_star, w_jk)\n            \n            if dot_product  max_dot_product:\n                max_dot_product = dot_product\n                theta_dom = tj\n                phi_dom = pk\n\n    # 3. Calculate the DOM-approximated intensity using the nearest ordinate\n    i_dom = get_thin_intensity(tau, b_val, l_val, theta_dom, phi_dom)\n    \n    # 4. Compute the absolute error\n    error = np.abs(i_dom - i_exact)\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Main solver function to run the test suite and print results.\n    \"\"\"\n    # Define physical constants from the problem statement\n    L = 1.0  # meters\n    B = 1.0  # W m^-2 sr^-1\n    \n    # Define the test cases from the problem statement.\n    # Format: (tau, N, theta_star_rad, phi_star_rad)\n    test_cases = [\n        (1e-3, 8, 0.7, 1.3),\n        (1e-3, 2, 0.7, 1.3),\n        (1e-3, 32, 0.7, 1.3),\n        (5e-4, 8, 0.05, 2.2),\n        (1e-2, 8, 1.55, np.pi/4),\n        (1e-1, 8, 0.7, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        tau_val, n_val, theta_s, phi_s = case\n        \n        # Calculate the error for the current test case\n        abs_error = compute_error(tau_val, n_val, theta_s, phi_s, L, B)\n        \n        results.append(abs_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了 DOM 的数值特性之后，本练习将探讨一个关键的物理建模选择：光谱表示。您将实现并比较一个详细的光谱模型和一个简化的灰气体模型，以量化光谱平均所引入的误差。在燃烧模拟中，这是一个在准确性与计算成本之间进行权衡的常见问题。",
            "id": "4020295",
            "problem": "考虑一个厚度为 $L$ (单位为 $\\text{m}$) 的一维、平面平行、等温、均质气体板层，其中填充了温度 $T=1800$ $\\text{K}$、总压力 $P=1$ $\\text{atm}$ 的水-二氧化碳混合物。该板层两侧均为真空；边界为非反射和非发射边界。折射率为 1，气体为非散射性，且唯一的辐射相互作用是吸收和发射。目标是量化灰体近似相对于光谱分辨的离散纵标法 (DOM) 解所引入的误差。\n\n从非散射、等温、均质介质中光谱强度 $I_\\lambda(x,\\mu)$ 的平面平行辐射传输方程 (RTE) 出发，\n$$\n\\mu \\,\\frac{d I_\\lambda}{dx} \\;=\\; -\\kappa_\\lambda \\left(I_\\lambda - B_\\lambda(T)\\right),\n$$\n其中 $\\mu$ 是相对于板层法线的方向余弦，$\\kappa_\\lambda$ 是光谱吸收系数（单位为 $\\text{m}^{-1}$），$B_\\lambda(T)$ 是普朗克光谱辐射亮度（单位为 $\\text{W}\\,\\text{m}^{-3}\\,\\text{sr}^{-1}$），\n$$\nB_\\lambda(T) \\;=\\; \\frac{2 h c^2}{\\lambda^5} \\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_B T}\\right) - 1\\right]^{-1},\n$$\n其中 $h$ 是普朗克常数，$c$ 是光速，$k_B$ 是玻尔兹曼常数。假设在 $P=1$ $\\text{atm}$ 时，混合物的吸收系数是各组分摩尔分数的加性函数：\n$$\n\\kappa_\\lambda^{\\text{mix}} \\;=\\; y_{\\mathrm{H_2O}}\\,\\kappa_\\lambda^{\\mathrm{H_2O}} \\;+\\; y_{\\mathrm{CO_2}}\\,\\kappa_\\lambda^{\\mathrm{CO_2}},\n$$\n其中 $y_{\\mathrm{H_2O}}$ 和 $y_{\\mathrm{CO_2}}$ 是摩尔分数。提供了在 $T=1800$ $\\text{K}$ 和 $P=1$ $\\text{atm}$ 下的光谱分辨表格数据，其中波长 $\\lambda$ 的单位为微米，组分吸收系数的单位为 $\\text{m}^{-1}$ 每单位摩尔分数：\n- 波长（单位：微米）：$\\lambda \\in \\{2.0,\\,2.7,\\,4.3,\\,5.0,\\,10.0\\}$。\n- 水的吸收系数：$\\kappa_\\lambda^{\\mathrm{H_2O}} \\in \\{0.2,\\,5.0,\\,0.5,\\,0.3,\\,0.1\\}$ $\\text{m}^{-1}$。\n- 二氧化碳的吸收系数：$\\kappa_\\lambda^{\\mathrm{CO_2}} \\in \\{0.1,\\,0.3,\\,8.0,\\,0.4,\\,0.2\\}$ $\\text{m}^{-1}$。\n\n对于光谱分辨解，使用 $S_4$ 离散纵标法 (DOM) 计算左边界 $x=0$ 处的向外半球光谱热通量，即，使用半程上的四个高斯-勒让德点和权重来近似 $\\mu\\in[0,1]$ 上的角度积分。对于每个波长，应用恒定属性下的精确特征线解来获得向外方向 $\\mu0$ 上的边界强度，\n$$\nI_\\lambda(0,\\mu0) \\;=\\; B_\\lambda(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_\\lambda^{\\text{mix}}\\,L}{|\\mu|}\\right)\\right],\n$$\n然后计算向外光谱热通量\n$$\nq_\\lambda(0) \\;=\\; 2\\pi \\,\\int_{0}^{1} \\mu \\, I_\\lambda(0,-\\mu)\\, d\\mu,\n$$\n并通过 $S_4$ 求积法近似。总向外热通量 $q_{\\text{spec}}$（单位为 $\\text{W}\\,\\text{m}^{-2}$）通过对 $q_\\lambda(0)$ 在以米为单位的波长 $\\lambda$ 上进行数值积分得到。\n\n对于灰体近似，将 $\\kappa_\\lambda^{\\text{mix}}$ 替换为其在 $T=1800$ $\\text{K}$ 时的普朗克平均值，\n$$\n\\kappa_{\\text{P}} \\;=\\; \\frac{\\int_{0}^{\\infty} \\kappa_\\lambda^{\\text{mix}} \\, B_\\lambda(T)\\, d\\lambda}{\\int_{0}^{\\infty} B_\\lambda(T)\\, d\\lambda},\n$$\n并求解光谱积分强度 $I(x,\\mu)$ 的灰体 RTE，\n$$\n\\mu \\,\\frac{d I}{dx} \\;=\\; -\\kappa_{\\text{P}} \\left(I - B(T)\\right),\n$$\n其中 $B(T)=\\int_{0}^{\\infty} B_\\lambda(T)\\, d\\lambda$（单位为 $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}$），使用相同的 $S_4$ 求积法和恒定属性特征线解\n$$\nI(0,\\mu0) \\;=\\; B(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_{\\text{P}}\\,L}{|\\mu|}\\right)\\right],\n$$\n来计算向外灰体热通量\n$$\nq_{\\text{gray}}(0) \\;=\\; 2\\pi \\,\\int_{0}^{1} \\mu \\, I(0,-\\mu)\\, d\\mu.\n$$\n\n将相对灰体误差定义为\n$$\n\\varepsilon \\;=\\; \\frac{q_{\\text{gray}} - q_{\\text{spec}}}{q_{\\text{spec}}},\n$$\n一个无量纲量，以小数形式报告。\n\n实现一个程序，使用以下方法执行上述计算：\n- 提供的波长 $\\lambda$（从微米转换为米）的光谱列表。\n- 用于角度积分的带 $S_4$ 半程高斯-勒让德求積的离散纵标法 (DOM)。\n- 对所有光谱积分，在提供的波长网格上进行数值梯形积分。\n\n使用以下参数值测试套件，涵盖典型、光学薄和光学厚的情况：\n- 案例 1：$L=0.05$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.10$。\n- 案例 2：$L=0.001$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.05$。\n- 案例 3：$L=0.20$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.05$，$y_{\\mathrm{CO_2}}=0.20$。\n\n您的程序应生成单行输出，其中包含上述三个案例的相对灰体误差，格式为方括号内由逗号分隔的小数列表，例如 $[e_1,e_2,e_3]$。角度（如有）必须以弧度处理。最终答案必须以小数表示；物理通量在内部以 $\\text{W}\\,\\text{m}^{-2}$ 计算，但输出是无单位的。",
            "solution": "基本依据是用于非散射、等温、均质介质的平面平行辐射传输方程 (RTE)、普朗克光谱辐射亮度，以及通过角度和光谱积分实现的能量守恒。我们考虑一个温度为 $T=1800$ $\\text{K}$ 的气体板层，其折射率为 1，两侧与真空相邻，因此没有外部入射辐射。气体吸收和发射但不散射。边界条件为 $I_\\lambda(0,\\mu0)=0$ 和 $I_\\lambda(L,\\mu0)=0$。\n\n我们从一维空间的 RTE 开始，\n$$\n\\mu \\,\\frac{d I_\\lambda}{dx} \\;=\\; -\\kappa_\\lambda \\left(I_\\lambda - B_\\lambda(T)\\right),\n$$\n由于板层是均质和等温的，$\\kappa_\\lambda$ 和 $B_\\lambda(T)$ 是常数。这是一个沿每个方向 $\\mu$ 的一阶线性常微分方程。齐次解呈指数衰減，特解为常数 $B_\\lambda(T)$。对 $\\mu0$ 应用 $x=L$ 处的边界条件，得到左边界 $x=0$ 处向外方向 $\\mu0$ 上的特征线解：\n$$\nI_\\lambda(0,\\mu0) \\;=\\; B_\\lambda(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_\\lambda L}{|\\mu|}\\right)\\right].\n$$\n根据对称性，右边界的向外强度可类似地从 $\\mu0$ 的 $x=0$ 边界条件获得。我们专注于左边界。\n\n$x=0$ 处的向外半球光谱热通量为\n$$\nq_\\lambda(0) \\;=\\; 2\\pi \\int_0^1 \\mu \\, I_\\lambda(0,-\\mu) \\, d\\mu,\n$$\n其中因子 $2\\pi$ 是平面平行板层中轴对称情况下的方位角积分。由于对于任意离散格式我们无法解析地积分 $\\mu$ 乘以指数项，我们引入离散纵标法 (DOM)。DOM 用离散方向余弦和权重的求积代替角度积分。具体来说，我们采用半程上的 $S_4$ 格式，使用 $[0,1]$ 中的四个高斯-勒让德点 $\\{\\mu_m\\}_{m=1}^4$ 和相应的权重 $\\{w_m\\}_{m=1}^4$。求积近似为\n$$\n\\int_0^1 f(\\mu)\\, d\\mu \\;\\approx\\; \\sum_{m=1}^4 w_m \\, f(\\mu_m).\n$$\n因此，\n$$\nq_\\lambda(0) \\;\\approx\\; 2\\pi \\sum_{m=1}^4 w_m \\, \\mu_m \\, I_\\lambda(0,-\\mu_m).\n$$\n在给定假设下，混合物吸收系数是摩尔分数的加性函数：\n$$\n\\kappa_\\lambda^{\\text{mix}} \\;=\\; y_{\\mathrm{H_2O}}\\,\\kappa_\\lambda^{\\mathrm{H_2O}} \\;+\\; y_{\\mathrm{CO_2}}\\,\\kappa_\\lambda^{\\mathrm{CO_2}}.\n$$\n我们使用上述特征线解，为每个波长和方向计算 $I_\\lambda(0,-\\mu_m)$。\n\n接下来，我们将 $q_\\lambda(0)$ 对波长进行积分以获得总向外热通量，\n$$\nq_{\\text{spec}} \\;=\\; \\int q_\\lambda(0)\\, d\\lambda,\n$$\n我们通过在提供的波长网格（从微米转换为米）上使用梯形法则来评估此积分，以与表格数据保持一致。\n\n对于灰体近似，我们使用相同的表格光谱网格和梯形法则定义普朗克平均吸收系数，\n$$\n\\kappa_{\\text{P}} \\;=\\; \\frac{\\int \\kappa_\\lambda^{\\text{mix}} B_\\lambda(T)\\, d\\lambda}{\\int B_\\lambda(T)\\, d\\lambda}.\n$$\n我们引入光谱积分普朗克辐射亮度，\n$$\nB(T) \\;=\\; \\int B_\\lambda(T)\\, d\\lambda,\n$$\n单位为 $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}$。光谱积分强度 $I(x,\\mu)$ 的灰体 RTE 保持相同的形式：\n$$\n\\mu \\,\\frac{d I}{dx} \\;=\\; -\\kappa_{\\text{P}} \\left(I - B(T)\\right).\n$$\n在相同的边界条件（来自真空的入射辐射为零）和恒定系数下，$x=0$ 处向外方向 $\\mu0$ 的特征线解为\n$$\nI(0,\\mu0) \\;=\\; B(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_{\\text{P}} L}{|\\mu|}\\right)\\right].\n$$\n使用相同的 $S_4$ 求积法，\n$$\nq_{\\text{gray}}(0) \\;\\approx\\; 2\\pi \\sum_{m=1}^4 w_m \\, \\mu_m \\, I(0,-\\mu_m).\n$$\n\n最后，相对灰体误差定义为\n$$\n\\varepsilon \\;=\\; \\frac{q_{\\text{gray}} - q_{\\text{spec}}}{q_{\\text{spec}}}.\n$$\n我们为每个测试案例计算 $\\varepsilon$：\n- 案例 1：$L=0.05$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.10$。\n- 案例 2：$L=0.001$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.05$。\n- 案例 3：$L=0.20$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.05$，$y_{\\mathrm{CO_2}}=0.20$。\n\n算法步骤：\n- 将波长从微米转换为米。\n- 使用物理常数 $h$, $c$, $k_B$ 计算每个波长的 $B_\\lambda(T)$。\n- 根据组分摩尔分数和表格化的 $\\kappa_\\lambda$ 构建 $\\kappa_\\lambda^{\\text{mix}}$。\n- 构建 $S_4$ 半程高斯-勒让德节点 $\\mu_m$ 和权重 $w_m$。\n- 光谱 DOM：对于每个波长，评估 $I_\\lambda(0,-\\mu_m)$ 并计算 $q_\\lambda(0)$；然后对 $\\lambda$ 进行积分以获得 $q_{\\text{spec}}$。\n- 灰体 DOM：通过梯形积分计算 $\\kappa_{\\text{P}}$ 和 $B(T)$；评估 $I(0,-\\mu_m)$ 并计算 $q_{\\text{gray}}$。\n- 以要求的单行格式将每个案例的 $\\varepsilon$ 报告为小数。\n\n此方法与用于角度积分的离散纵标法 (DOM) 一致，在恒定属性下使用 RTE 的精确特征线解，并对灰体近似应用普朗克加权。所有量均以一致的单位计算；最终报告的误差是无单位的小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants\nh = 6.62607015e-34       # Planck constant, J*s\nc = 2.99792458e8         # speed of light, m/s\nkB = 1.380649e-23        # Boltzmann constant, J/K\n\nT = 1800.0  # K\n\n# Tabulated spectral data at T=1800 K, P=1 atm\n# Wavelengths in micrometers; will convert to meters\nlambda_um = np.array([2.0, 2.7, 4.3, 5.0, 10.0], dtype=float)\nlambda_m = lambda_um * 1e-6\n\n# Species absorption coefficients (per unit mole fraction) in 1/m\nkappa_H2O = np.array([0.2, 5.0, 0.5, 0.3, 0.1], dtype=float)\nkappa_CO2 = np.array([0.1, 0.3, 8.0, 0.4, 0.2], dtype=float)\n\ndef planck_lambda(lam, T):\n    \"\"\"\n    Planck spectral radiance B_lambda(T) [W m^-3 sr^-1] for wavelength lam [m].\n    \"\"\"\n    # Avoid overflow/underflow issues with large/small arguments\n    x = (h * c) / (lam * kB * T)\n    # Use expm1 for numerical stability: 1/(exp(x)-1) = 1/expm1(x)\n    return (2.0 * h * c**2) / (lam**5) / np.expm1(x)\n\ndef half_range_gauss_legendre(n):\n    \"\"\"\n    Half-range Gauss-Legendre quadrature on [0,1].\n    Returns nodes mu in [0,1] and weights w for integrating f(mu) over [0,1].\n    \"\"\"\n    # Legendre nodes/weights on [-1, 1]\n    xi, wi = np.polynomial.legendre.leggauss(n)\n    # Map to [0, 1]: mu = (xi + 1)/2, w = wi/2\n    mu = 0.5 * (xi + 1.0)\n    w = 0.5 * wi\n    return mu, w\n\ndef spectral_flux_left(L, y_H2O, y_CO2):\n    \"\"\"\n    Compute the spectrally resolved outward hemispherical heat flux at the left boundary.\n    \"\"\"\n    # Mixture absorption coefficient at each wavelength\n    kappa_mix = y_H2O * kappa_H2O + y_CO2 * kappa_CO2  # 1/m\n    # Planck spectral radiance at each wavelength\n    B_lam = planck_lambda(lambda_m, T)  # W m^-3 sr^-1\n\n    # S4 half-range quadrature\n    mu, w = half_range_gauss_legendre(4)\n\n    # For each wavelength, compute q_lambda via DOM:\n    # I_lambda(0, -mu) = B_lambda(T) * [1 - exp(-kappa_mix * L / mu)]\n    # q_lambda = 2*pi * sum_m w_m * mu_m * I_lambda(0, -mu_m)\n    I_boundary = B_lam[:, None] * (1.0 - np.exp(-(kappa_mix[:, None] * L) / mu[None, :]))\n    q_lambda = 2.0 * np.pi * np.sum(w[None, :] * mu[None, :] * I_boundary, axis=1)  # W m^-3\n\n    # Integrate q_lambda over wavelength to get total flux [W m^-2]\n    q_spec = np.trapz(q_lambda, lambda_m)\n    return q_spec\n\ndef gray_flux_left(L, y_H2O, y_CO2):\n    \"\"\"\n    Compute the gray outward hemispherical heat flux at the left boundary using Planck-mean kappa.\n    \"\"\"\n    kappa_mix = y_H2O * kappa_H2O + y_CO2 * kappa_CO2  # 1/m\n    B_lam = planck_lambda(lambda_m, T)  # W m^-3 sr^-1\n\n    # Spectrally integrated B(T) and Planck-mean kappa\n    B_total = np.trapz(B_lam, lambda_m)  # W m^-2 sr^-1\n    numerator = np.trapz(kappa_mix * B_lam, lambda_m)  # (1/m) * W m^-3 sr^-1 integrated -> W m^-2 sr^-1 / m\n    kappa_P = numerator / B_total  # 1/m\n\n    mu, w = half_range_gauss_legendre(4)\n\n    # I(0, -mu) = B_total * [1 - exp(-kappa_P * L / mu)]\n    I_gray_boundary = B_total * (1.0 - np.exp(-(kappa_P * L) / mu))\n    q_gray = 2.0 * np.pi * np.sum(w * mu * I_gray_boundary)  # W m^-2\n    return q_gray\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], y_H2O, y_CO2)\n    test_cases = [\n        (0.05, 0.10, 0.10),   # Case 1: typical\n        (0.001, 0.10, 0.05),  # Case 2: optically thin\n        (0.20, 0.05, 0.20),   # Case 3: optically thick, CO2-dominant band\n    ]\n\n    results = []\n    for L, yH2O, yCO2 in test_cases:\n        q_spec = spectral_flux_left(L, yH2O, yCO2)\n        q_gray = gray_flux_left(L, yH2O, yCO2)\n        # Relative error as decimal\n        err = (q_gray - q_spec) / q_spec\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在探讨了光谱效应之后，一个实际问题随之而来：我们如何为真实气体构建高效的光谱模型？最后一个练习将指导您校准一个灰气体加权和 (WSGG) 模型，这是计算辐射学中的一项基石技术。您将通过最小二乘法，将模型参数与高保真发射率数据进行拟合，从而掌握将基础光谱数据转化为可在大型模拟中使用的高效模型的关键技能。",
            "id": "4020303",
            "problem": "您正在校准一个 Weighted-Sum-of-Gray-Gases (WSGG) 模型，以便为计算燃烧学中的 Discrete Ordinates Method (DOM) 求解器提供光谱积分气体发射率。从厚度为 $L$、均匀温度为 $T$、灰色吸收系数为 $k$ 的均匀、等温、非散射层的基本辐射传递出发。根据 Beer–Lambert 定律，光谱透射率为 $\\exp(-k U)$，其中 $U = p L$ 是压力-路径长度。对于与相同温度的黑体等温外壳进行交换的灰体气体平板，其半球发射率等于吸收率，由下式给出\n$$\n\\varepsilon_\\text{gray}(U;k) = 1 - \\exp(-k U).\n$$\nWSGG 模型将真实气体的光谱平均发射率近似为 $N_g$ 种虚拟灰体气体（外加一种吸收为零的隐式透明气体）的凸组合，每种气体具有固定的吸收系数 $k_i$ 和依赖于温度的权重 $a_i(T)$，满足 $a_i(T) \\ge 0$ 和 $\\sum_{i=1}^{N_g} a_i(T) = 1$。WSGG 发射率表示为\n$$\n\\varepsilon_\\text{WSGG}(U;T,\\mathbf{a}) = \\sum_{i=1}^{N_g} a_i(T) \\left[1 - \\exp\\left(-k_i U\\right)\\right],\n$$\n其中 $\\mathbf{a} = \\left(a_1(T),\\dots,a_{N_g}(T)\\right)$。\n\n假设您有适用于各种 $U$ 和 $T$ 的高保真参考发射率数据（表示逐线积分）$\\varepsilon^\\text{ref}(U;T)$。您的任务是构建并求解最小二乘校准问题，以拟合 WSGG 权重 $a_i(T)$，从而使 $\\varepsilon_\\text{WSGG}(U;T,\\mathbf{a})$ 在残差向量的欧几里得 2-范数意义下最佳匹配 $\\varepsilon^\\text{ref}(U;T)$。具体来说，定义残差\n$$\nr_j(T;\\mathbf{a}) = \\varepsilon_\\text{WSGG}(U_j;T,\\mathbf{a}) - \\varepsilon^\\text{ref}(U_j;T),\n$$\n该残差在一组压力-路径长度 $\\{U_j\\}_{j=1}^{M}$ 上叠加，并最小化范数\n$$\n\\left\\| \\mathbf{r}(T;\\mathbf{a}) \\right\\|_2 = \\sqrt{ \\sum_{j=1}^{M} \\left[r_j(T;\\mathbf{a})\\right]^2 }.\n$$\n对于多温度校准，将所有 $(U_j,T_m)$ 对的残差叠加成一个向量，并最小化总体 2-范数。\n\n所有变量必须使用以下单位：$T$ 的单位是 $\\text{K}$，$U$ 的单位是 $\\text{atm}\\cdot\\text{m}$，$k_i$ 的单位是 $\\text{(atm}\\cdot\\text{m)}^{-1}$，发射率是无量纲的。\n\n为确保校准问题被完全指定，请在您的程序中使用以下测试套件。在所有情况下，将给定的 $\\varepsilon^\\text{ref}$ 值视为数据，并通过最小二乘法拟合 WSGG 权重，以最小化指定的欧几里得 2-范数。您必须通过消除每个温度下的一个权重变量（例如，设置 $a_{N_g}(T)=1-\\sum_{i=1}^{N_g-1} a_i(T)$）来精确地施加和为一约束，并且可以忽略非负性。\n\n- 情况 1（单一温度，两种灰体气体）：\n  - 参数：$N_g = 2$，$T = 1200\\,\\text{K}$，$\\mathbf{k} = [0.5, 5.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$，$U \\in \\{0.1, 0.5, 1.0, 2.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 用于生成数据的合成真值：$\\mathbf{a}^\\star(T) = [0.3, 0.7]$。\n  - 数据：对于每个 $U$，$\\varepsilon^\\text{ref}(U;T) = \\sum_{i=1}^{2} a^\\star_i(T)\\left[1-\\exp(-k_i U)\\right]$。\n\n  任务：通过最小二乘法拟合单个未知权重 $a_1(T)$（其中 $a_2(T)=1-a_1(T)$），并报告拟合的权重和最小化的残差 2-范数。\n\n- 情况 2（边界覆盖，两个位于极端 $U$ 值的数据点）：\n  - 参数：$N_g = 2$，$T = 1200\\,\\text{K}$，$\\mathbf{k} = [0.5, 5.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$，$U \\in \\{10^{-4}, 10.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 用于生成数据的合成真值：$\\mathbf{a}^\\star(T) = [0.3, 0.7]$。\n  - 数据：$\\varepsilon^\\text{ref}(U;T)$ 的构建方式与情况 1 相同。\n\n  任务：如情况 1 那样进行拟合，并报告拟合的权重和最小化的残差 2-范数。\n\n- 情况 3（多温度，多项式权重，三种灰体气体）：\n  - 参数：$N_g = 3$，$\\mathbf{k} = [0.2, 2.0, 15.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$，$T \\in \\{800, 1200, 1800\\}\\,\\text{K}$，$U \\in \\{0.05, 0.2, 1.0, 3.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 定义归一化温度 $\\theta(T) = \\dfrac{T - T_0}{\\Delta T}$，其中 $T_0 = 1200\\,\\text{K}$，$\\Delta T = 600\\,\\text{K}$。\n  - 用于生成数据的合成真值，在 $\\theta$ 上呈线性：\n    $$\n    a_1^\\star(T) = 0.25 + 0.05\\,\\theta(T),\\quad\n    a_2^\\star(T) = 0.55 - 0.10\\,\\theta(T),\\quad\n    a_3^\\star(T) = 1 - a_1^\\star(T) - a_2^\\star(T).\n    $$\n  - 数据：$\\varepsilon^\\text{ref}(U;T)$ 根据上述真值针对每个 $(U,T)$ 对计算得出。\n\n  任务：为前两个权重校准一个在 $\\theta$ 上线性的模型，并消除第三个权重以强制执行和为一约束：\n    $$\n    a_1(T) = b_{10} + b_{11}\\,\\theta(T),\\quad\n    a_2(T) = b_{20} + b_{21}\\,\\theta(T),\\quad\n    a_3(T) = 1 - a_1(T) - a_2(T).\n    $$\n    通过最小化所有 $(U,T)$ 样本的叠加残差 2-范数来求解系数 $b_{10}, b_{11}, b_{20}, b_{21}$。然后报告在 $T=800\\,\\text{K}$、$T=1200\\,\\text{K}$ 和 $T=1800\\,\\text{K}$ 下评估的拟合权重，以及叠加数据集上的最小化残差 2-范数。\n\n您的程序必须输出一行，其中包含一个逗号分隔的 Python 风格列表，按以下顺序汇总结果：\n- 情况 1：拟合的 $a_1(T)$，拟合的 $a_2(T)$，最小化的残差 2-范数。\n- 情况 2：拟合的 $a_1(T)$，拟合的 $a_2(T)$，最小化的残差 2-范数。\n- 情况 3：拟合的 $[a_1(800\\,\\text{K}), a_2(800\\,\\text{K}), a_3(800\\,\\text{K}), a_1(1200\\,\\text{K}), a_2(1200\\,\\text{K}), a_3(1200\\,\\text{K}), a_1(1800\\,\\text{K}), a_2(1800\\,\\text{K}), a_3(1800\\,\\text{K})]$，后跟最小化的残差 2-范数。\n\n因此，您的程序应生成单行输出：\n\"[$r_1,r_2,\\dots,r_{16}$]\"\n包含按上述确切顺序排列的 16 个浮点数。发射率是无量纲的；所有输入均使用所述物理单位；不使用角度。输出中不允许出现百分号；所有数字必须以十进制浮点数形式打印。",
            "solution": "用户提供了一个需要校准 Weighted-Sum-of-Gray-Gases (WSGG) 模型的问题。我将首先验证问题陈述。\n\n### 第 1 步：提取已知条件\n\n- **WSGG 模型**：发射率由 $\\varepsilon_\\text{WSGG}(U;T,\\mathbf{a}) = \\sum_{i=1}^{N_g} a_i(T) \\left[1 - \\exp\\left(-k_i U\\right)\\right]$ 给出，权重满足 $a_i(T) \\ge 0$ 和 $\\sum_{i=1}^{N_g} a_i(T) = 1$。\n- **最小二乘目标**：最小化残差向量的欧几里得 2-范数，$\\| \\mathbf{r}(T;\\mathbf{a}) \\|_2 = \\sqrt{ \\sum_{j=1}^{M} \\left[r_j(T;\\mathbf{a})\\right]^2 }$，其中 $r_j(T;\\mathbf{a}) = \\varepsilon_\\text{WSGG}(U_j;T,\\mathbf{a}) - \\varepsilon^\\text{ref}(U_j;T)$。\n- **约束条件**：通过消除变量（例如，$a_{N_g}(T)=1-\\sum_{i=1}^{N_g-1} a_i(T)$）来强制执行 $\\sum_i a_i(T) = 1$。忽略非负性 $a_i(T) \\ge 0$。\n- **单位**：$T$ 的单位是 $\\text{K}$，$U$ 的单位是 $\\text{atm}\\cdot\\text{m}$，$k_i$ 的单位是 $\\text{(atm}\\cdot\\text{m)}^{-1}$。\n\n- **情况 1**：\n  - $N_g = 2$，$T = 1200\\,\\text{K}$。\n  - $\\mathbf{k} = [0.5, 5.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$。\n  - $U \\in \\{0.1, 0.5, 1.0, 2.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 使用真实权重 $\\mathbf{a}^\\star(T) = [0.3, 0.7]$ 生成参考数据 $\\varepsilon^\\text{ref}$。\n  - 任务：拟合 $a_1(T)$（其中 $a_2(T)=1-a_1(T)$）并报告 $[a_1, a_2, \\|\\mathbf{r}\\|_2]$。\n\n- **情况 2**：\n  - $N_g = 2$，$T = 1200\\,\\text{K}$。\n  - $\\mathbf{k} = [0.5, 5.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$。\n  - $U \\in \\{10^{-4}, 10.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 使用真实权重 $\\mathbf{a}^\\star(T) = [0.3, 0.7]$ 生成参考数据 $\\varepsilon^\\text{ref}$。\n  - 任务：如情况 1 那样进行拟合，并报告 $[a_1, a_2, \\|\\mathbf{r}\\|_2]$。\n\n- **情况 3**：\n  - $N_g = 3$，$\\mathbf{k} = [0.2, 2.0, 15.0]\\,\\text{(atm}\\cdot\\text{m)}^{-1}$。\n  - $T \\in \\{800, 1200, 1800\\}\\,\\text{K}$，$U \\in \\{0.05, 0.2, 1.0, 3.0\\}\\,\\text{atm}\\cdot\\text{m}$。\n  - 归一化温度：$\\theta(T) = \\dfrac{T - T_0}{\\Delta T}$，其中 $T_0 = 1200\\,\\text{K}$，$\\Delta T = 600\\,\\text{K}$。\n  - 真实权重（在 $\\theta$ 上呈线性）：$a_1^\\star(T) = 0.25 + 0.05\\,\\theta(T)$，$a_2^\\star(T) = 0.55 - 0.10\\,\\theta(T)$，$a_3^\\star(T) = 1 - a_1^\\star(T) - a_2^\\star(T)$。\n  - 根据这些真实权重生成参考数据 $\\varepsilon^\\text{ref}$。\n  - 待拟合模型：$a_1(T) = b_{10} + b_{11}\\,\\theta(T)$，$a_2(T) = b_{20} + b_{21}\\,\\theta(T)$，$a_3(T) = 1 - a_1(T) - a_2(T)$。\n  - 任务：求解系数 $b_{10}, b_{11}, b_{20}, b_{21}$。报告在三种温度下拟合的权重和总体残差范数 $\\|\\mathbf{r}\\|_2$。\n\n- **输出格式**：包含 16 个浮点数的单行逗号分隔列表。\n\n### 第 2 步：使用提取的已知条件进行验证\n\n该问题是一个定义明确的数学练习，涉及将线性最小二乘拟合应用于标准工程模型 (WSGG)。\n1.  **科学或事实不健全性**：无。该问题基于辐射传热和 WSGG 模型的既定原则。\n2.  **非形式化或不相关**：无。该问题是一个可形式化的数值任务，完全在指定的主题领域内。\n3.  **不完整或矛盾的设置**：无。提供了所有必要的参数、数据生成过程和约束条件。任务是具体且明确的。\n4.  **不切实际或不可行**：无。参数值对于气体辐射问题是物理上合理的。拟合任务是一个标准程序。\n5.  **不适定或结构不良**：无。如下所示，这些问题转化为具有满秩矩阵的超定线性系统，保证了唯一的最小二乘解。\n6.  **伪深刻、琐碎或同义反复**：该问题并非琐碎，因为它需要正确的代数操作来建立线性系统。合成数据允许零残差的完美拟合，这一事实使其成为一个验证案例，但设置本身是一个实质性的练习。\n7.  **超出科学可验证性范围**：无。结果是数学上可验证的。\n\n### 第 3 步：结论与行动\n\n问题陈述有效。我将继续提供完整的解决方案。\n\n问题的核心是最小化残差平方和，这构成了一个线性最小二乘问题。我们首先将 WSGG 模型相对于未知参数进行线性化。\n\n**WSGG 模型的线性化**\nWSGG 发射率由 $\\varepsilon_\\text{WSGG} = \\sum_{i=1}^{N_g} a_i(T) \\left[1 - \\exp\\left(-k_i U\\right)\\right]$ 给出。\n通过消除 $a_{N_g}(T) = 1 - \\sum_{i=1}^{N_g-1} a_i(T)$ 来强制执行约束 $\\sum_{i=1}^{N_g} a_i(T) = 1$，模型变为：\n$$ \\varepsilon_\\text{WSGG} = \\sum_{i=1}^{N_g-1} a_i(T) [1 - e^{-k_i U}] + \\left(1 - \\sum_{i=1}^{N_g-1} a_i(T)\\right) [1 - e^{-k_{N_g} U}] $$\n重新整理以分离未知权重 $a_i(T)$（其中 $i \\in \\{1, \\dots, N_g-1\\}$）：\n$$ \\varepsilon_\\text{WSGG} - [1 - e^{-k_{N_g} U}] = \\sum_{i=1}^{N_g-1} a_i(T) \\left( [1 - e^{-k_i U}] - [1 - e^{-k_{N_g} U}] \\right) $$\n$$ \\varepsilon_\\text{WSGG} - [1 - e^{-k_{N_g} U}] = \\sum_{i=1}^{N_g-1} a_i(T) (e^{-k_{N_g} U} - e^{-k_i U}) $$\n数据点 $(U_j, T_m)$ 的残差为 $r_{j,m} = \\varepsilon_\\text{WSGG}(U_j; T_m, \\mathbf{a}) - \\varepsilon^\\text{ref}(U_j; T_m)$。残差方程可以写成：\n$$ \\sum_{i=1}^{N_g-1} a_i(T_m) (e^{-k_{N_g} U_j} - e^{-k_i U_j}) - \\left(\\varepsilon^\\text{ref}(U_j, T_m) - [1 - e^{-k_{N_g} U_j}]\\right) = r_{j,m} $$\n这是一个线性系统。对于固定温度下的 $M$ 个数据点集，我们可以将其写成矩阵形式 $\\mathbf{C} \\mathbf{x} - \\mathbf{y} = \\mathbf{r}$，我们希望找到使 $\\| \\mathbf{r} \\|_2$ 最小化的未知数向量 $\\mathbf{x}$。对于 $N_g$ 种灰体气体，$\\mathbf{x}$ 是 $(N_g-1)$ 维的权重向量 $[a_1, \\dots, a_{N_g-1}]^T$。大小为 $M \\times (N_g-1)$ 的设计矩阵 $\\mathbf{C}$ 的元素为 $C_{ji} = e^{-k_{N_g} U_j} - e^{-k_i U_j}$，大小为 $M$ 的目标向量 $\\mathbf{y}$ 的元素为 $y_j = \\varepsilon^\\text{ref}(U_j) - [1 - e^{-k_{N_g} U_j}]$。\n最小二乘解通过求解正规方程组 $(\\mathbf{C}^T \\mathbf{C}) \\mathbf{x} = \\mathbf{C}^T \\mathbf{y}$ 得到。\n\n在所有给定的情况中，参考数据 $\\varepsilon^\\text{ref}$ 都是使用与待拟合模型形式相同的模型生成的。这意味着可以实现完美拟合，并且最小化的残差范数将为零（或数值上接近于零）。最小二乘法过程应该能恢复用于数据生成的“真实”参数。\n\n**情况 1：单一温度，两种灰体气体**\n这里，$N_g=2$，因此我们求解一个未知数 $a_1$。未知数向量为 $\\mathbf{x} = [a_1]$。我们有 $M=4$ 个数据点。设计矩阵 $\\mathbf{C}$ 是一个 $4 \\times 1$ 的列向量，其元素为 $C_{j1} = e^{-k_2 U_j} - e^{-k_1 U_j}$，$\\mathbf{y}$ 是一个 $4 \\times 1$ 的向量。\n由于该问题是具有无噪声合成数据的验证案例，解将是真实权重 $a_1^\\star = 0.3$。因此，拟合权重 $a_2 = 1 - a_1 = 1 - 0.3 = 0.7$。残差范数将为 $0$。\n\n**情况 2：边界覆盖**\n此情况在结构上与情况 1 相同，$N_g=2$ 且只有一个未知数 $a_1$。唯一的区别在于选择的 $M=2$ 个压力-路径长度点，$U \\in \\{10^{-4}, 10.0\\}$。矩阵 $\\mathbf{C}$ 是 $2 \\times 1$ 的。只要其元素非零（对于有限且不同的 $k_i$ 而言是如此），问题就是适定的。解将再次是真实权重 $a_1 = 0.3$ 和 $a_2 = 0.7$，残差范数为 $0$。\n\n**情况 3：多温度，多项式权重**\n在这里，权重本身被参数化为归一化温度 $\\theta$ 的线性函数：\n$a_1(T) = b_{10} + b_{11}\\,\\theta(T)$\n$a_2(T) = b_{20} + b_{21}\\,\\theta(T)$\n未知数是 $4$ 个系数 $\\mathbf{x} = [b_{10}, b_{11}, b_{20}, b_{21}]^T$。我们在 $3$ 个温度和 $4$ 个路径长度上有数据，总共有 $M = 3 \\times 4 = 12$ 个数据点。点 $(U_j, T_m)$ 的残差方程变为：\n$$ r_{j,m} + y_{j,m} = (b_{10} + b_{11}\\theta_m)(e^{-k_3 U_j} - e^{-k_1 U_j}) + (b_{20} + b_{21}\\theta_m)(e^{-k_3 U_j} - e^{-k_2 U_j}) $$\n其中 $y_{j,m} = \\varepsilon^\\text{ref}(U_j, T_m) - (1 - e^{-k_3 U_j})$。这在系数 $b_{ik}$ 上是线性的。我们组装一个 $12 \\times 4$ 的设计矩阵 $\\mathbf{C}$ 和一个 $12 \\times 1$ 的目标向量 $\\mathbf{y}$，并解决最小二乘问题 $\\min \\|\\mathbf{C}\\mathbf{x} - \\mathbf{y}\\|_2$。$\\mathbf{C}$ 的列对应于乘以每个未知系数的项。\n同样，由于参考数据是从这个精确的模型结构生成的，拟合将是完美的。解将恢复用于数据生成的真实系数：$b_{10}=0.25$，$b_{11}=0.05$，$b_{20}=0.55$，$b_{21}=-0.10$。总体残差范数将为 $0$。\n然后，通过将拟合系数和相应的 $\\theta$ 值（-2/3、0、1）代入多项式表达式中，计算出每个温度下所需的权重。\n\n每个情况的数值解都是通过使用 `numpy.linalg.lstsq` 来求解线性最小二乘系统获得的。残差向量的最小化 2-范数是此函数返回的残差平方和的平方根。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the three least-squares calibration problems for the WSGG model.\n    \"\"\"\n    \n    # --- Case 1 ---\n    k1_case1 = np.array([0.5, 5.0])\n    U_case1 = np.array([0.1, 0.5, 1.0, 2.0])\n    a_star_case1 = np.array([0.3, 0.7])\n    \n    a1_case1, a2_case1, norm_case1 = solve_single_temp(k1_case1, U_case1, a_star_case1)\n    \n    # --- Case 2 ---\n    k2_case2 = np.array([0.5, 5.0])\n    U_case2 = np.array([1e-4, 10.0])\n    a_star_case2 = np.array([0.3, 0.7])\n    \n    a1_case2, a2_case2, norm_case2 = solve_single_temp(k2_case2, U_case2, a_star_case2)\n    \n    # --- Case 3 ---\n    weights_case3, norm_case3 = solve_multi_temp()\n    \n    # --- Aggregate results ---\n    results = [\n        a1_case1, a2_case1, norm_case1,\n        a1_case2, a2_case2, norm_case2,\n        *weights_case3,\n        norm_case3\n    ]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\ndef wsgg_emissivity(U, k, a):\n    \"\"\"Calculates WSGG emissivity for a set of U values.\"\"\"\n    eps = np.zeros_like(U)\n    for i in range(len(k)):\n        eps += a[i] * (1.0 - np.exp(-k[i] * U))\n    return eps\n\ndef solve_single_temp(k, U, a_star):\n    \"\"\"\n    Helper function for single-temperature WSGG fit (Cases 1 and 2).\n    Solves for a_1 where a_2 = 1 - a_1.\n    \"\"\"\n    Ng = len(k)\n    M = len(U)\n    \n    # Generate reference emissivity data\n    eps_ref = wsgg_emissivity(U, k, a_star)\n\n    # Set up the linear least-squares problem: C * x = y\n    # where x = [a_1]\n    \n    # Number of unknowns is Ng - 1 = 1\n    C = np.zeros((M, Ng - 1))\n    y = np.zeros(M)\n\n    k_elim = k[Ng - 1] # k_2 in this case\n    \n    for j in range(M):\n        y[j] = eps_ref[j] - (1.0 - np.exp(-k_elim * U[j]))\n        # Column for a_1\n        C[j, 0] = np.exp(-k_elim * U[j]) - np.exp(-k[0] * U[j])\n        \n    # Solve the least squares problem\n    solution, residuals, _, _ = np.linalg.lstsq(C, y, rcond=None)\n    \n    a1_fit = solution[0]\n    a2_fit = 1.0 - a1_fit\n    \n    # The problem asks for the norm of the final residual vector r_j,\n    # which is sqrt of the value returned by lstsq if it's not empty.\n    res_norm = np.sqrt(residuals[0]) if residuals.size  0 else 0.0\n\n    return a1_fit, a2_fit, res_norm\n\ndef solve_multi_temp():\n    \"\"\"\n    Helper function for multi-temperature WSGG fit (Case 3).\n    \"\"\"\n    k = np.array([0.2, 2.0, 15.0])\n    T = np.array([800.0, 1200.0, 1800.0])\n    U = np.array([0.05, 0.2, 1.0, 3.0])\n    \n    T0, delta_T = 1200.0, 600.0\n    theta = (T - T0) / delta_T\n\n    # True model parameters for data generation\n    def a1_star_func(th): return 0.25 + 0.05 * th\n    def a2_star_func(th): return 0.55 - 0.10 * th\n    def a3_star_func(th): return 1.0 - a1_star_func(th) - a2_star_func(th)\n\n    # Generate reference data\n    U_grid, T_grid = np.meshgrid(U, T)\n    theta_grid = (T_grid - T0) / delta_T\n\n    a1_star = a1_star_func(theta_grid)\n    a2_star = a2_star_func(theta_grid)\n    a3_star = a3_star_func(theta_grid)\n    \n    eps_ref_grid = a1_star * (1-np.exp(-k[0]*U_grid)) + \\\n                   a2_star * (1-np.exp(-k[1]*U_grid)) + \\\n                   a3_star * (1-np.exp(-k[2]*U_grid))\n                   \n    # Flatten data for least squares\n    eps_ref_flat = eps_ref_grid.flatten()\n    U_flat = U_grid.flatten()\n    theta_flat = theta_grid.flatten()\n    \n    M = len(eps_ref_flat) # Total number of data points (12)\n    num_coeffs = 4 # b10, b11, b20, b21\n    \n    C = np.zeros((M, num_coeffs))\n    y = np.zeros(M)\n    \n    k_elim = k[2]\n\n    for p in range(M):\n        U_p, th_p = U_flat[p], theta_flat[p]\n        y[p] = eps_ref_flat[p] - (1.0 - np.exp(-k_elim * U_p))\n        \n        term1 = np.exp(-k_elim * U_p) - np.exp(-k[0] * U_p)\n        term2 = np.exp(-k_elim * U_p) - np.exp(-k[1] * U_p)\n        \n        # Columns for b10, b11, b20, b21\n        C[p, 0] = term1\n        C[p, 1] = th_p * term1\n        C[p, 2] = term2\n        C[p, 3] = th_p * term2\n\n    # Solve the least squares problem\n    solution, residuals, _, _ = np.linalg.lstsq(C, y, rcond=None)\n    b10, b11, b20, b21 = solution\n    \n    # Calculate fitted weights at specified temperatures\n    fitted_weights = []\n    for th_val in theta:\n        a1 = b10 + b11 * th_val\n        a2 = b20 + b21 * th_val\n        a3 = 1.0 - a1 - a2\n        fitted_weights.extend([a1, a2, a3])\n        \n    res_norm = np.sqrt(residuals[0]) if residuals.size  0 else 0.0\n\n    return fitted_weights, res_norm\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}