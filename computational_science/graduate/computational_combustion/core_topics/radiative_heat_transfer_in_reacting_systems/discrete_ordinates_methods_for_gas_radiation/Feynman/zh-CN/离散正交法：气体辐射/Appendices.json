{
    "hands_on_practices": [
        {
            "introduction": "建立了气体辐射特性的光谱模型后，下一步是在辐射传输模拟中应用它，并评估其相对于更简单模型的优势。本练习要求你使用$S_4$离散坐标法，针对包含水和二氧化碳的等温气体板，计算详细光谱模型下的热流，并将其与经典的普朗克平均（灰气体）近似进行比较。通过亲手量化灰气体近似带来的误差，你将深刻理解在高温气体辐射计算中考虑光谱选择性（非灰度）的重要性 。",
            "id": "4020295",
            "problem": "考虑一个一维、平面平行、等温、均匀的气体板，其厚度为 $L$（单位：$\\text{m}$），其中充满了水和二氧化碳的混合物，温度 $T=1800$ $\\text{K}$，总压力 $P=1$ $\\text{atm}$。该板两侧均为真空；边界为非反射、非发射。折射率为1，气体不发生散射，唯一的辐射相互作用是吸收和发射。目标是量化相对于光谱解析的离散纵标法（DOM）解，由灰体近似引入的误差。\n\n从非散射、等温、均匀介质中光谱强度 $I_\\lambda(x,\\mu)$ 的平面平行辐射传输方程（RTE）开始，\n$$\n\\mu \\,\\frac{d I_\\lambda}{dx} \\;=\\; -\\kappa_\\lambda \\left(I_\\lambda - B_\\lambda(T)\\right),\n$$\n其中 $\\mu$ 是相对于板法线的方向余弦，$\\kappa_\\lambda$ 是光谱吸收系数（单位：$\\text{m}^{-1}$），$B_\\lambda(T)$ 是普朗克光谱辐射亮度（单位：$\\text{W}\\,\\text{m}^{-3}\\,\\text{sr}^{-1}$），\n$$\nB_\\lambda(T) \\;=\\; \\frac{2 h c^2}{\\lambda^5} \\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_B T}\\right) - 1\\right]^{-1},\n$$\n其中 $h$ 是普朗克常数，$c$ 是光速，$k_B$ 是玻尔兹曼常数。假设在 $P=1$ $\\text{atm}$ 时，混合物的吸收系数在各组分摩尔分数上是可加的：\n$$\n\\kappa_\\lambda^{\\text{mix}} \\;=\\; y_{\\mathrm{H_2O}}\\,\\kappa_\\lambda^{\\mathrm{H_2O}} \\;+\\; y_{\\mathrm{CO_2}}\\,\\kappa_\\lambda^{\\mathrm{CO_2}},\n$$\n其中 $y_{\\mathrm{H_2O}}$ 和 $y_{\\mathrm{CO_2}}$ 是摩尔分数。提供了在 $T=1800$ $\\text{K}$ 和 $P=1$ $\\text{atm}$ 条件下的以下光谱解析表格数据，其中波长 $\\lambda$ 的单位为微米，组分吸收系数的单位为 $\\text{m}^{-1}$ 每单位摩尔分数：\n- 波长（单位：微米）：$\\lambda \\in \\{2.0,\\,2.7,\\,4.3,\\,5.0,\\,10.0\\}$。\n- 水吸收系数：$\\kappa_\\lambda^{\\mathrm{H_2O}} \\in \\{0.2,\\,5.0,\\,0.5,\\,0.3,\\,0.1\\}$ $\\text{m}^{-1}$。\n- 二氧化碳吸收系数：$\\kappa_\\lambda^{\\mathrm{CO_2}} \\in \\{0.1,\\,0.3,\\,8.0,\\,0.4,\\,0.2\\}$ $\\text{m}^{-1}$。\n\n对于光谱解析解，使用 $S_4$ 离散纵标法（DOM）计算左边界 $x=0$ 处的向外半球光谱热通量，即，用半值域上的四个 Gauss-Legendre 点和权重来近似 $\\mu\\in[0,1]$ 上的角度积分。对于每个波长，应用常数物性的精确特征线解来获得向外方向（$\\mu0$）上的边界强度，\n$$\nI_\\lambda(0,\\mu0) \\;=\\; B_\\lambda(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_\\lambda^{\\text{mix}}\\,L}{|\\mu|}\\right)\\right],\n$$\n然后计算向外光谱热通量\n$$\nq_\\lambda(0) \\;=\\; 2\\pi \\,\\int_{0}^{1} \\mu \\, I_\\lambda(0,-\\mu)\\, d\\mu,\n$$\n用 $S_4$ 求积法近似。总向外热通量 $q_{\\text{spec}}$（单位：$\\text{W}\\,\\text{m}^{-2}$）通过对以米为单位的波长 $\\lambda$ 上的 $q_\\lambda(0)$ 进行数值积分得到。\n\n对于灰体近似，将 $\\kappa_\\lambda^{\\text{mix}}$ 替换为其在 $T=1800$ $\\text{K}$ 时的普朗克平均值 $\\kappa_{\\text{P}}$，\n$$\n\\kappa_{\\text{P}} \\;=\\; \\frac{\\int_{0}^{\\infty} \\kappa_\\lambda^{\\text{mix}} \\, B_\\lambda(T)\\, d\\lambda}{\\int_{0}^{\\infty} B_\\lambda(T)\\, d\\lambda},\n$$\n并求解光谱积分强度 $I(x,\\mu)$ 的灰体 RTE，\n$$\n\\mu \\,\\frac{d I}{dx} \\;=\\; -\\kappa_{\\text{P}} \\left(I - B(T)\\right),\n$$\n其中 $B(T)=\\int_{0}^{\\infty} B_\\lambda(T)\\, d\\lambda$（单位：$\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}$），使用相同的 $S_4$ 求积法和常数物性特征线解\n$$\nI(0,\\mu0) \\;=\\; B(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_{\\text{P}}\\,L}{|\\mu|}\\right)\\right],\n$$\n来计算向外灰体热通量\n$$\nq_{\\text{gray}}(0) \\;=\\; 2\\pi \\,\\int_{0}^{1} \\mu \\, I(0,-\\mu)\\, d\\mu.\n$$\n\n将相对灰体误差定义为\n$$\n\\varepsilon \\;=\\; \\frac{q_{\\text{gray}} - q_{\\text{spec}}}{q_{\\text{spec}}},\n$$\n一个无量纲量，以小数形式报告。\n\n实现一个程序，使用以下方法执行上述计算：\n- 提供的以微米为单位的光谱表格数据，并将其转换为米。\n- 使用 $S_4$ 半值域 Gauss-Legendre 求积进行角度积分的离散纵标法（DOM）。\n- 对所有光谱积分，在提供的波长网格上使用数值梯形积分法。\n\n使用以下参数值测试套件，涵盖典型、光学薄和光学厚的情况：\n- 情况 1：$L=0.05$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.10$。\n- 情况 2：$L=0.001$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.05$。\n- 情况 3：$L=0.20$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.05$，$y_{\\mathrm{CO_2}}=0.20$。\n\n您的程序应生成单行输出，其中包含上述三种情况的相对灰体误差，格式为方括号内以逗号分隔的小数列表，例如 $[e_1,e_2,e_3]$。角度（如有）必须以弧度处理。最终答案必须以小数表示；物理通量在内部以 $\\text{W}\\,\\text{m}^{-2}$ 计算，但输出是无单位的。",
            "solution": "基本基础是用于非散射、等温、均匀介质的平面平行辐射传输方程（RTE）、普朗克光谱辐射亮度以及通过角度和光谱积分实现的能量守恒。我们考虑一个温度为 $T=1800$ $\\text{K}$ 的气体板，其折射率为1，两侧由真空界定，因此没有外部入射辐射。气体吸收和发射，但不散射。边界条件为 $I_\\lambda(0,\\mu>0)=0$ 和 $I_\\lambda(L,\\mu0)=0$。\n\n我们从一维RTE开始，\n$$\n\\mu \\,\\frac{d I_\\lambda}{dx} \\;=\\; -\\kappa_\\lambda \\left(I_\\lambda - B_\\lambda(T)\\right),\n$$\n由于板是均匀且等温的，$\\kappa_\\lambda$ 和 $B_\\lambda(T)$ 是常数。这是一个沿每个方向 $\\mu$ 的一阶线性常微分方程。齐次解呈指数衰减，而特解是常数 $B_\\lambda(T)$。对 $\\mu0$ 应用在 $x=L$ 处的边界条件，得到左边界 $x=0$ 在向外方向（$\\mu0$）上的特征线解：\n$$\nI_\\lambda(0,\\mu0) \\;=\\; B_\\lambda(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_\\lambda L}{|\\mu|}\\right)\\right].\n$$\n根据对称性，右边界的向外强度可以类似地从 $x=0$ 处对 $\\mu>0$ 的边界条件得到。我们关注左边界。\n\n在 $x=0$ 处的向外半球光谱热通量为\n$$\nq_\\lambda(0) \\;=\\; 2\\pi \\int_0^1 \\mu \\, I_\\lambda(0,-\\mu) \\, d\\mu,\n$$\n其中因子 $2\\pi$ 是平面平行板中轴对称情况下的方位角积分。由于我们无法对任意离散格式解析地积分 $\\mu$ 乘以指数项，因此我们调用离散纵标法（DOM）。DOM 用离散方向余弦和权重的求积法代替角度积分。具体来说，我们采用半值域上的 $S_4$ 格式，使用 $[0,1]$ 中的四个 Gauss-Legendre 点 $\\{\\mu_m\\}_{m=1}^4$ 和相应的权重 $\\{w_m\\}_{m=1}^4$。该求积法近似为\n$$\n\\int_0^1 f(\\mu)\\, d\\mu \\;\\approx\\; \\sum_{m=1}^4 w_m \\, f(\\mu_m).\n$$\n因此，\n$$\nq_\\lambda(0) \\;\\approx\\; 2\\pi \\sum_{m=1}^4 w_m \\, \\mu_m \\, I_\\lambda(0,-\\mu_m).\n$$\n在给定假设下，混合物吸收系数在摩尔分数上是可加的：\n$$\n\\kappa_\\lambda^{\\text{mix}} \\;=\\; y_{\\mathrm{H_2O}}\\,\\kappa_\\lambda^{\\mathrm{H_2O}} \\;+\\; y_{\\mathrm{CO_2}}\\,\\kappa_\\lambda^{\\mathrm{CO_2}}.\n$$\n我们使用上述特征线解为每个波长和方向计算 $I_\\lambda(0,-\\mu_m)$。\n\n接下来，我们将 $q_\\lambda(0)$ 对波长进行积分以获得总向外热通量，\n$$\nq_{\\text{spec}} \\;=\\; \\int q_\\lambda(0)\\, d\\lambda,\n$$\n我们通过在提供的波长网格（从微米转换为米）上使用梯形法则来评估该积分，以与表格数据保持一致。\n\n对于灰体近似，我们使用相同的表格化光谱网格和梯形法则定义普朗克平均吸收系数，\n$$\n\\kappa_{\\text{P}} \\;=\\; \\frac{\\int \\kappa_\\lambda^{\\text{mix}} B_\\lambda(T)\\, d\\lambda}{\\int B_\\lambda(T)\\, d\\lambda}.\n$$\n我们引入光谱积分的普朗克辐射亮度，\n$$\nB(T) \\;=\\; \\int B_\\lambda(T)\\, d\\lambda,\n$$\n单位为 $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}$。光谱积分强度 $I(x,\\mu)$ 的灰体 RTE 保持相同的形式：\n$$\n\\mu \\,\\frac{d I}{dx} \\;=\\; -\\kappa_{\\text{P}} \\left(I - B(T)\\right).\n$$\n在相同的边界条件（来自真空的入射辐射为零）和常数系数下，$x=0$ 处向外方向（$\\mu0$）的特征线解是\n$$\nI(0,\\mu0) \\;=\\; B(T)\\,\\left[1 - \\exp\\!\\left(-\\frac{\\kappa_{\\text{P}} L}{|\\mu|}\\right)\\right].\n$$\n使用相同的 $S_4$ 求积法，\n$$\nq_{\\text{gray}}(0) \\;\\approx\\; 2\\pi \\sum_{m=1}^4 w_m \\, \\mu_m \\, I(0,-\\mu_m).\n$$\n\n最后，相对灰体误差定义为\n$$\n\\varepsilon \\;=\\; \\frac{q_{\\text{gray}} - q_{\\text{spec}}}{q_{\\text{spec}}}.\n$$\n我们为每个测试用例计算 $\\varepsilon$：\n- 情况 1：$L=0.05$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.10$。\n- 情况 2：$L=0.001$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.10$，$y_{\\mathrm{CO_2}}=0.05$。\n- 情况 3：$L=0.20$ $\\text{m}$，$y_{\\mathrm{H_2O}}=0.05$，$y_{\\mathrm{CO_2}}=0.20$。\n\n算法步骤：\n- 将波长从微米转换为米。\n- 使用物理常数 $h$、$c$、$k_B$ 计算每个波长的 $B_\\lambda(T)$。\n- 根据组分摩尔分数和表格化的 $\\kappa_\\lambda$ 构建 $\\kappa_\\lambda^{\\text{mix}}$。\n- 构建 $S_4$ 半值域 Gauss-Legendre 节点 $\\mu_m$ 和权重 $w_m$。\n- 光谱 DOM：对于每个波长，评估 $I_\\lambda(0,-\\mu_m)$ 并计算 $q_\\lambda(0)$；然后对 $\\lambda$ 积分以获得 $q_{\\text{spec}}$。\n- 灰体 DOM：通过梯形积分计算 $\\kappa_{\\text{P}}$ 和 $B(T)$；评估 $I(0,-\\mu_m)$ 并计算 $q_{\\text{gray}}$。\n- 以要求的单行格式将每个情况的 $\\varepsilon$ 报告为小数。\n\n该方法与用于角度积分的离散纵标法（DOM）一致，使用常数物性下 RTE 的精确特征线解，并对灰体近似应用普朗克加权。所有量均以一致的单位计算；最终报告的误差是无单位的小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants\nh = 6.62607015e-34       # Planck constant, J*s\nc = 2.99792458e8         # speed of light, m/s\nkB = 1.380649e-23        # Boltzmann constant, J/K\n\nT = 1800.0  # K\n\n# Tabulated spectral data at T=1800 K, P=1 atm\n# Wavelengths in micrometers; will convert to meters\nlambda_um = np.array([2.0, 2.7, 4.3, 5.0, 10.0], dtype=float)\nlambda_m = lambda_um * 1e-6\n\n# Species absorption coefficients (per unit mole fraction) in 1/m\nkappa_H2O = np.array([0.2, 5.0, 0.5, 0.3, 0.1], dtype=float)\nkappa_CO2 = np.array([0.1, 0.3, 8.0, 0.4, 0.2], dtype=float)\n\ndef planck_lambda(lam, T):\n    \"\"\"\n    Planck spectral radiance B_lambda(T) [W m^-3 sr^-1] for wavelength lam [m].\n    \"\"\"\n    # Avoid overflow/underflow issues with large/small arguments\n    x = (h * c) / (lam * kB * T)\n    # Use expm1 for numerical stability: 1/(exp(x)-1) = 1/expm1(x)\n    return (2.0 * h * c**2) / (lam**5) / np.expm1(x)\n\ndef half_range_gauss_legendre(n):\n    \"\"\"\n    Half-range Gauss-Legendre quadrature on [0,1].\n    Returns nodes mu in [0,1] and weights w for integrating f(mu) over [0,1].\n    \"\"\"\n    # Legendre nodes/weights on [-1, 1]\n    xi, wi = np.polynomial.legendre.leggauss(n)\n    # Map to [0, 1]: mu = (xi + 1)/2, w = wi/2\n    mu = 0.5 * (xi + 1.0)\n    w = 0.5 * wi\n    return mu, w\n\ndef spectral_flux_left(L, y_H2O, y_CO2):\n    \"\"\"\n    Compute the spectrally resolved outward hemispherical heat flux at the left boundary.\n    \"\"\"\n    # Mixture absorption coefficient at each wavelength\n    kappa_mix = y_H2O * kappa_H2O + y_CO2 * kappa_CO2  # 1/m\n    # Planck spectral radiance at each wavelength\n    B_lam = planck_lambda(lambda_m, T)  # W m^-3 sr^-1\n\n    # S4 half-range quadrature\n    mu, w = half_range_gauss_legendre(4)\n\n    # For each wavelength, compute q_lambda via DOM:\n    # I_lambda(0, -mu) = B_lambda(T) * [1 - exp(-kappa_mix * L / mu)]\n    # q_lambda = 2*pi * sum_m w_m * mu_m * I_lambda(0, -mu_m)\n    I_boundary = B_lam[:, None] * (1.0 - np.exp(-(kappa_mix[:, None] * L) / mu[None, :]))\n    q_lambda = 2.0 * np.pi * np.sum(w[None, :] * mu[None, :] * I_boundary, axis=1)  # W m^-3\n\n    # Integrate q_lambda over wavelength to get total flux [W m^-2]\n    q_spec = np.trapz(q_lambda, lambda_m)\n    return q_spec\n\ndef gray_flux_left(L, y_H2O, y_CO2):\n    \"\"\"\n    Compute the gray outward hemispherical heat flux at the left boundary using Planck-mean kappa.\n    \"\"\"\n    kappa_mix = y_H2O * kappa_H2O + y_CO2 * kappa_CO2  # 1/m\n    B_lam = planck_lambda(lambda_m, T)  # W m^-3 sr^-1\n\n    # Spectrally integrated B(T) and Planck-mean kappa\n    B_total = np.trapz(B_lam, lambda_m)  # W m^-2 sr^-1\n    numerator = np.trapz(kappa_mix * B_lam, lambda_m)  # (1/m) * W m^-3 sr^-1 integrated - W m^-2 sr^-1 / m\n    kappa_P = numerator / B_total  # 1/m\n\n    mu, w = half_range_gauss_legendre(4)\n\n    # I(0, -mu) = B_total * [1 - exp(-kappa_P * L / mu)]\n    I_gray_boundary = B_total * (1.0 - np.exp(-(kappa_P * L) / mu))\n    q_gray = 2.0 * np.pi * np.sum(w * mu * I_gray_boundary)  # W m^-2\n    return q_gray\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], y_H2O, y_CO2)\n    test_cases = [\n        (0.05, 0.10, 0.10),   # Case 1: typical\n        (0.001, 0.10, 0.05),  # Case 2: optically thin\n        (0.20, 0.05, 0.20),   # Case 3: optically thick, CO2-dominant band\n    ]\n\n    results = []\n    for L, yH2O, yCO2 in test_cases:\n        q_spec = spectral_flux_left(L, yH2O, yCO2)\n        q_gray = gray_flux_left(L, yH2O, yCO2)\n        # Relative error as decimal\n        err = (q_gray - q_spec) / q_spec\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "离散坐标法（DOM）的核心思想是用一组离散的方向（ordinates）来近似连续的角度空间，这必然会引入角度离散误差。为了深入理解并量化这种误差，本练习设计了一个理想化的场景，将DOM的计算结果与光学薄极限下的精确解析解进行对比。通过分析在不同角度分辨率下DOM近似与精确解之间的差异，你将能够洞察该方法内在的精度限制，并理解增加离散方向数量是如何提高计算准确性的 。",
            "id": "4020307",
            "problem": "考虑在一个边长为 $L$、具有冷黑边界表面（边界入射强度为零）的轴对齐立方体中，包含着均匀、等温、灰体、非散射气体的单色辐射传输。设气体吸收系数为 $\\kappa$（单位为 $\\mathrm{m}^{-1}$），其发射由一个恒定的普朗克函数 $B$（单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}$）来表征。沿一条由弧长 $s$ 参数化、方向单位向量为 $\\boldsymbol{\\omega}$ 的射线，辐射传输方程 (RTE) 为\n$$\n\\frac{d I(s,\\boldsymbol{\\omega})}{d s} \\;=\\; -\\,\\kappa\\, I(s,\\boldsymbol{\\omega}) \\;+\\; \\kappa\\, B,\n$$\n其边界条件为在立方体表面处 $I=0$（冷黑边界）。定义光学厚度为 $\\tau = \\kappa\\,L$。\n\n在光学薄极限下，假设 $\\kappa\\,L \\ll 1$，并从 RTE 系统地推导立方体中心强度 $I_\\text{exact}(\\boldsymbol{\\omega})$ 的视线表达式，该表达式是关于 $\\kappa$、$B$ 以及沿方向 $\\boldsymbol{\\omega}$ 到最近边界的距离的函数。为此，从 RTE 和冷黑边界条件出发得到积分解，然后取 $\\kappa L \\ll 1$ 的极限来简化指数衰减因子。对于一个以原点为中心的轴对齐立方体，说明如何用 $\\boldsymbol{\\omega}$ 的方向余弦和 $L$ 来表示从中心沿方向 $\\boldsymbol{\\omega}$ 到边界的视线距离 $s_b(\\boldsymbol{\\omega})$。\n\n现在，使用离散纵标法 (DOM) 来近似相同的视线强度，该方法用一组有限的方向替代连续的角度依赖性。使用一个具有 $N$ 个极向划分和 $N$ 个方位向划分的张量积角度网格来定义 $N^2$ 个离散纵标：\n- 极角 $\\theta_j = \\left(j+\\tfrac{1}{2}\\right)\\,\\pi/N$，其中 $j=0,1,\\dots,N-1$，\n- 方位角 $\\phi_k = \\left(k+\\tfrac{1}{2}\\right)\\,2\\pi/N$，其中 $k=0,1,\\dots,N-1$，\n以及对应的单位向量 $\\boldsymbol{\\omega}_{j,k} = \\big(\\sin\\theta_j\\cos\\phi_k,\\; \\sin\\theta_j\\sin\\phi_k,\\; \\cos\\theta_j\\big)$。对于一个给定的角度为 $(\\theta^\\star,\\phi^\\star)$ 的目标方向，通过选择最近的离散纵标 $\\boldsymbol{\\omega}_{j,k}$（以最小角分离为准则）并沿该离散方向计算光学薄视线积分来近似强度。将此 DOM 近似记为 $I_\\text{DOM}(N,\\theta^\\star,\\phi^\\star)$。\n\n定义绝对误差\n$$\n\\varepsilon(\\tau,N,\\theta^\\star,\\phi^\\star) \\;=\\; \\big|\\,I_\\text{DOM}(N,\\theta^\\star,\\phi^\\star) \\;-\\; I_\\text{exact}(\\theta^\\star,\\phi^\\star)\\,\\big|,\n$$\n并研究其对光学厚度 $\\tau$ 和角分辨率 $N$ 的依赖性。\n\n你的程序必须：\n- 从第一性原理（如上所述，从 RTE 开始）实现精确的光学薄视线强度。\n- 使用上面定义的角度网格和最近方向选择法来实现 DOM 近似。\n- 对于以下测试套件，计算绝对误差，其中 $L=1\\,\\mathrm{m}$，$B=1\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}}$，角度以弧度为单位：\n    1. $\\tau = 10^{-3}$，$N=8$，$(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$，\n    2. $\\tau = 10^{-3}$，$N=2$，$(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$，\n    3. $\\tau = 10^{-3}$，$N=32$，$(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$，\n    4. $\\tau = 5\\times 10^{-4}$，$N=8$，$(\\theta^\\star,\\phi^\\star)=(0.05,\\,2.2)$，\n    5. $\\tau = 10^{-2}$，$N=8$，$(\\theta^\\star,\\phi^\\star)=(1.55,\\,\\tfrac{\\pi}{4})$，\n    6. $\\tau = 10^{-1}$，$N=8$，$(\\theta^\\star,\\phi^\\star)=(0.7,\\,1.3)$。\n- 以 $\\mathrm{W\\,m^{-2}\\,sr^{-1}}$ 为单位表示绝对误差。\n- 生成单行输出，其中包含六个误差值，形式为用方括号括起来的逗号分隔列表，例如 $[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4,\\varepsilon_5,\\varepsilon_6]$。\n\n角度必须以弧度为单位。所有物理量必须使用以米为单位的 $L$、以米的倒数为单位的 $\\kappa$ 以及以瓦特每平方米每球面度为单位的 $B$ 进行计算。测试套件的最终答案必须是浮点数。",
            "solution": "用户提供的问题已经过评估且有效。该问题有科学依据、提法恰当、客观，并包含了得出唯一解所需的所有信息。\n\n解答过程分三个阶段展开：首先，在光学薄近似下推导立方体中心处的精确视线强度；其次，构建此强度的离散纵标法 (DOM) 近似；第三，针对指定的测试用例，计算两者之间的绝对误差。\n\n**1. 精确光学薄强度 $I_\\text{exact}$ 的推导**\n\n出发点是具有恒定属性的非散射、发射-吸收介质的辐射传输方程 (RTE)，其形式如下：\n$$\n\\frac{d I(s, \\boldsymbol{\\omega})}{ds} = -\\kappa I(s, \\boldsymbol{\\omega}) + \\kappa B\n$$\n其中 $I$ 是方向 $\\boldsymbol{\\omega}$ 上的辐射强度，$s$ 是路径长度，$\\kappa$ 是吸收系数，$B$ 是普朗克函数，代表由发射引起的源项。这是一个一阶线性常微分方程。我们可以通过重排并使用积分因子 $e^{\\kappa s}$ 来求解它：\n$$\n\\frac{dI}{ds} + \\kappa I = \\kappa B\n$$\n$$\ne^{\\kappa s} \\frac{dI}{ds} + \\kappa e^{\\kappa s} I = \\kappa B e^{\\kappa s}\n$$\n$$\n\\frac{d}{ds} \\left( I e^{\\kappa s} \\right) = \\kappa B e^{\\kappa s}\n$$\n为了求出点 $P$（立方体中心）的强度，我们沿一条从边界点 $P_b$ 到 $P$ 的视线进行积分。我们设路径坐标在 $P_b$ 处为 $s'=0$，在 $P$ 处为 $s'=s_b$，其中 $s_b$ 是从中心沿 $-\\boldsymbol{\\omega}$ 方向到边界的距离。积分得出：\n$$\n\\int_{0}^{s_b} \\frac{d}{ds'} \\left( I(s') e^{\\kappa s'} \\right) ds' = \\int_{0}^{s_b} \\kappa B e^{\\kappa s'} ds'\n$$\n$$\nI(s_b) e^{\\kappa s_b} - I(0) e^0 = \\kappa B \\left[ \\frac{1}{\\kappa} e^{\\kappa s'} \\right]_0^{s_b} = B (e^{\\kappa s_b} - 1)\n$$\n问题陈述边界是冷黑的，这意味着源自任何边界表面的强度均为零。因此，边界条件为 $I(s'=0)=0$。代入此条件，我们得到：\n$$\nI(s_b) e^{\\kappa s_b} = B (e^{\\kappa s_b} - 1)\n$$\n$$\nI(s_b, \\boldsymbol{\\omega}) = B (1 - e^{-\\kappa s_b})\n$$\n这就是中心处强度的完整解。问题要求在光学薄极限下的解，此时区域的光学厚度很小，即 $\\tau = \\kappa L \\ll 1$。由于路径长度 $s_b$ 与 $L$ 是同一量级，这意味着 $\\kappa s_b \\ll 1$。因此，我们可以对指数函数使用一阶泰勒级数展开，$e^{-x} \\approx 1 - x$（对于小的 $x$）。\n应用此近似，我们得到光学薄强度的表达式，记为 $I_\\text{exact}$：\n$$\nI_\\text{exact}(\\boldsymbol{\\omega}) \\approx B (1 - (1 - \\kappa s_b)) = B \\kappa s_b(\\boldsymbol{\\omega})\n$$\n\n**2. 几何路径长度, $s_b(\\boldsymbol{\\omega})$**\n\n该立方体是轴对齐的，以原点 $(0,0,0)$ 为中心，边长为 $L$。它的各个面位于平面 $x=\\pm L/2$，$y=\\pm L/2$ 和 $z=\\pm L/2$ 上。一束从边界朝向中心行进的光线沿方向 $-\\boldsymbol{\\omega}$ 移动。等效地，一条从中心 $\\mathbf{r}=(0,0,0)$ 沿方向 $\\boldsymbol{\\omega}$ 发出的射线可由参数方程 $\\mathbf{r}(s) = s\\boldsymbol{\\omega}$（对于 $s0$）描述。设 $\\boldsymbol{\\omega}$ 的方向余弦为 $(\\mu, \\eta, \\xi)$，其中 $\\boldsymbol{\\omega} = (\\mu, \\eta, \\xi)$ 且 $\\mu^2+\\eta^2+\\xi^2=1$。射线上一点的坐标为 $(x,y,z) = (s\\mu, s\\eta, s\\xi)$。\n\n当满足以下条件之一时，射线与边界平面相交：\n$|x| = |s\\mu| = L/2 \\implies s = \\frac{L/2}{|\\mu|}$\n$|y| = |s\\eta| = L/2 \\implies s = \\frac{L/2}{|\\eta|}$\n$|z| = |s\\xi| = L/2 \\implies s = \\frac{L/2}{|\\xi|}$\n\n从中心沿此方向到最近边界点的距离 $s_b(\\boldsymbol{\\omega})$ 是这些正距离中的最小值：\n$$\ns_b(\\boldsymbol{\\omega}) = \\min\\left( \\frac{L/2}{|\\mu|}, \\frac{L/2}{|\\eta|}, \\frac{L/2}{|\\xi|} \\right)\n$$\n这可以更简洁地写为：\n$$\ns_b(\\boldsymbol{\\omega}) = \\frac{L/2}{\\max(|\\mu|, |\\eta|, |\\xi|)}\n$$\n方向余弦可以用球坐标角 $(\\theta, \\phi)$ 表示为 $\\mu = \\sin\\theta\\cos\\phi$，$\\eta = \\sin\\theta\\sin\\phi$ 和 $\\xi = \\cos\\theta$。将这些代入强度表达式，我们得到：\n$$\nI_\\text{exact}(\\theta, \\phi) = B \\kappa \\left( \\frac{L/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)} \\right)\n$$\n使用光学厚度 $\\tau = \\kappa L$（这意味着 $\\kappa = \\tau/L$），表达式变得与 $L$ 无关：\n$$\nI_\\text{exact}(\\theta, \\phi) = B \\frac{\\tau}{L} \\left( \\frac{L/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)} \\right) = \\frac{B \\tau/2}{\\max(|\\sin\\theta\\cos\\phi|, |\\sin\\theta\\sin\\phi|, |\\cos\\theta|)}\n$$\n\n**3. 离散纵标法 (DOM) 近似, $I_\\text{DOM}$**\n\nDOM 用一组有限的离散方向或纵标 $\\{\\boldsymbol{\\omega}_{j,k}\\}$ 替代连续的角度域。问题指定了一个具有 $N^2$ 个纵标的张量积网格，定义如下：\n- 极角：$\\theta_j = \\left(j+\\tfrac{1}{2}\\right)\\frac{\\pi}{N}$，其中 $j=0, 1, \\dots, N-1$\n- 方位角：$\\phi_k = \\left(k+\\tfrac{1}{2}\\right)\\frac{2\\pi}{N}$，其中 $k=0, 1, \\dots, N-1$\n\n对于一个给定的目标方向 $\\boldsymbol{\\omega}^\\star$（角度为 $\\theta^\\star, \\phi^\\star$），该方法要求在集合中找到最近的离散纵标 $\\boldsymbol{\\omega}_{j,k}$。“最近”是由最小角分离定义的，这等效于最大化单位向量之间的点积。我们必须找到使以下表达式最大化的索引对 $(j_0, k_0)$：\n$$\n(j_0, k_0) = \\underset{j,k}{\\operatorname{argmax}} (\\boldsymbol{\\omega}_{j,k} \\cdot \\boldsymbol{\\omega}^\\star)\n$$\n设最近的纵标为 $\\boldsymbol{\\omega}_\\text{DOM} = \\boldsymbol{\\omega}_{j_0, k_0}$。其方向余弦为 $(\\mu_\\text{DOM}, \\eta_\\text{DOM}, \\xi_\\text{DOM})$。\n\n强度的 DOM 近似 $I_\\text{DOM}$ 就是沿这个离散方向 $\\boldsymbol{\\omega}_\\text{DOM}$ 计算的光学薄强度：\n$$\nI_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) = B \\kappa s_b(\\boldsymbol{\\omega}_\\text{DOM})\n$$\n代入 $s_b$ 和 $\\kappa=\\tau/L$ 的表达式：\n$$\nI_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) = \\frac{B \\tau/2}{\\max(|\\mu_\\text{DOM}|, |\\eta_\\text{DOM}|, |\\xi_\\text{DOM}|)}\n$$\n\n**4. 测试套件的误差计算**\n\n绝对误差 $\\varepsilon$ 是 DOM 近似解与精确光学薄解之差的绝对值：\n$$\n\\varepsilon(\\tau, N, \\theta^\\star, \\phi^\\star) = |I_\\text{DOM}(N, \\theta^\\star, \\phi^\\star) - I_\\text{exact}(\\theta^\\star, \\phi^\\star)|\n$$\n$$\n\\varepsilon = \\frac{B\\tau}{2} \\left| \\frac{1}{\\max(|\\mu_\\text{DOM}|, |\\eta_\\text{DOM}|, |\\xi_\\text{DOM}|)} - \\frac{1}{\\max(|\\mu^\\star|, |\\eta^\\star|, |\\xi^\\star|)} \\right|\n$$\n所提供的代码实现了这些公式，用于计算测试套件中每个用例的误差，其中 $L=1\\,\\mathrm{m}$，$B=1\\,\\mathrm{W\\,m^{-2}\\,sr^{-1}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef get_thin_intensity(tau, b_val, l_val, theta, phi):\n    \"\"\"\n    Calculates the optically-thin intensity for a given direction.\n    This function implements the formula: I = B * (tau/L) * s_b.\n    \"\"\"\n    # Calculate direction cosines\n    mu = np.sin(theta) * np.cos(phi)\n    eta = np.sin(theta) * np.sin(phi)\n    xi = np.cos(theta)\n    \n    # Denominator for the path length calculation\n    max_abs_cosine = np.max([np.abs(mu), np.abs(eta), np.abs(xi)])\n    \n    # Avoid division by zero for directions exactly along an axis, though grid prevents this.\n    if max_abs_cosine == 0:\n        # This case should not be reached with the given angle definitions.\n        return np.inf\n\n    # Calculate distance to boundary from the center\n    s_b = (l_val / 2.0) / max_abs_cosine\n    \n    # Absorption coefficient from optical thickness and length\n    kappa = tau / l_val\n    \n    # Optically-thin intensity\n    intensity = b_val * kappa * s_b\n    \n    return intensity\n\ndef compute_error(tau, n_grid, theta_star, phi_star, l_val, b_val):\n    \"\"\"\n    Computes the absolute error between the exact and DOM-approximated intensities.\n    \"\"\"\n    # 1. Calculate the 'exact' optically-thin intensity for the target direction\n    i_exact = get_thin_intensity(tau, b_val, l_val, theta_star, phi_star)\n    \n    # 2. Find the nearest discrete ordinate for the DOM approximation\n    \n    # Target direction vector\n    w_star = np.array([\n        np.sin(theta_star) * np.cos(phi_star),\n        np.sin(theta_star) * np.sin(phi_star),\n        np.cos(theta_star)\n    ])\n    \n    max_dot_product = -1.0\n    theta_dom, phi_dom = -1.0, -1.0\n    \n    # Generate discrete polar angles\n    thetas_j = (np.arange(n_grid) + 0.5) * np.pi / n_grid\n    \n    # Generate discrete azimuthal angles\n    phis_k = (np.arange(n_grid) + 0.5) * 2.0 * np.pi / n_grid\n    \n    # Search for the nearest ordinate\n    for tj in thetas_j:\n        for pk in phis_k:\n            # DOM direction vector\n            w_jk = np.array([\n                np.sin(tj) * np.cos(pk),\n                np.sin(tj) * np.sin(pk),\n                np.cos(tj)\n            ])\n            \n            dot_product = np.dot(w_star, w_jk)\n            \n            if dot_product  max_dot_product:\n                max_dot_product = dot_product\n                theta_dom = tj\n                phi_dom = pk\n\n    # 3. Calculate the DOM-approximated intensity using the nearest ordinate\n    i_dom = get_thin_intensity(tau, b_val, l_val, theta_dom, phi_dom)\n    \n    # 4. Compute the absolute error\n    error = np.abs(i_dom - i_exact)\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Main solver function to run the test suite and print results.\n    \"\"\"\n    # Define physical constants from the problem statement\n    L = 1.0  # meters\n    B = 1.0  # W m^-2 sr^-1\n    \n    # Define the test cases from the problem statement.\n    # Format: (tau, N, theta_star_rad, phi_star_rad)\n    test_cases = [\n        (1e-3, 8, 0.7, 1.3),\n        (1e-3, 2, 0.7, 1.3),\n        (1e-3, 32, 0.7, 1.3),\n        (5e-4, 8, 0.05, 2.2),\n        (1e-2, 8, 1.55, np.pi/4),\n        (1e-1, 8, 0.7, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        tau_val, n_val, theta_s, phi_s = case\n        \n        # Calculate the error for the current test case\n        abs_error = compute_error(tau_val, n_val, theta_s, phi_s, L, B)\n        \n        results.append(abs_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}