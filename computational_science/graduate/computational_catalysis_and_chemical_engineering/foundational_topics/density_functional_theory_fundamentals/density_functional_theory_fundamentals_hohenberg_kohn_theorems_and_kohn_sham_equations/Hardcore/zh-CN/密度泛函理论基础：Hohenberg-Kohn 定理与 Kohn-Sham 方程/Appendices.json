{
    "hands_on_practices": [
        {
            "introduction": "在密度泛函理论中，总能量泛函由几个部分组成。本练习聚焦于其中一个最核心的经典贡献：哈特里能量（Hartree energy），它描述了电子云的经典静电自排斥作用。通过对一个模型高斯密度进行精确的解析计算，我们可以具体地理解该泛函的结构，并掌握傅里叶变换等关键数学工具的应用。这项实践旨在为您构建坚实的理论基础。",
            "id": "3876862",
            "problem": "在密度泛函理论 (DFT) 中，正如 Hohenberg–Kohn 定理所引入并于 Kohn–Sham 方法中实现的，经典的静电或 Hartree 能量泛函捕捉了电子密度的库仑自排斥作用。考虑一个球对称、归一化的三维高斯电子密度，该密度模拟了在计算催化中遇到的局域电荷分布，例如沸石孔中或金属活性位点附近的局域过剩电子。假设全文使用原子单位，因此库仑核为 $1/|\\mathbf{r}-\\mathbf{r}'|$，基本电荷量为 $1$。\n\n设密度为\n$$\nn(\\mathbf{r}) \\;=\\; N \\left(\\frac{\\beta}{\\pi}\\right)^{3/2} \\exp\\!\\left(-\\beta\\, r^{2}\\right),\n$$\n其中 $r = |\\mathbf{r}|$，总电子数 $N = \\int n(\\mathbf{r})\\,d^3\\mathbf{r}$，宽度参数 $\\beta0$。Hartree 能量泛函定义为\n$$\nE_{H}[n] \\;=\\; \\frac{1}{2}\\int_{\\mathbb{R}^{3}}\\int_{\\mathbb{R}^{3}} \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d^3\\mathbf{r}\\, d^3\\mathbf{r}'.\n$$\n\n从此定义以及库仑相互作用和积分的基本性质出发，对给定的 $n(\\mathbf{r})$，精确计算 $E_{H}[n]$。然后，独立地，考虑两个形式相同、总电荷为 $N$ 的相同、归一化的中心相距为 $R$ 的高斯电荷分布，推导相互作用能作为 $R$ 的函数；取 $R\\to 0$ 的极限，并考虑 $E_{H}[n]$ 中固有的重复计算，以得到相同的自能表达式。请将 $E_{H}[n]$ 的最终答案表示为 $N$ 和 $\\beta$ 的闭式解析表达式。无需数值取整。使用原子单位。",
            "solution": "该问题要求对给定的球对称高斯电子密度计算Hartree能量泛函 $E_H[n]$。该问题提法恰当，有科学依据，并提供了所有必要信息。我将开始解答。\n\nHartree能量由下式给出\n$$\nE_{H}[n] = \\frac{1}{2}\\int_{\\mathbb{R}^{3}}\\int_{\\mathbb{R}^{3}} \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d^3\\mathbf{r}\\, d^3\\mathbf{r}'\n$$\n电子密度为\n$$\nn(\\mathbf{r}) = N \\left(\\frac{\\beta}{\\pi}\\right)^{3/2} \\exp\\!\\left(-\\beta\\, r^{2}\\right)\n$$\n其中 $r = |\\mathbf{r}|$。$E_H[n]$ 的积分是密度 $n(\\mathbf{r})$ 与库仑核 $G(\\mathbf{r}) = 1/|\\mathbf{r}|$ 的卷积，再对密度本身积分。此类问题通常通过转换到傅里叶域来简化。\n\nHartree能量可以用密度和库仑核的傅里叶变换表示为\n$$\nE_{H}[n] = \\frac{1}{2} \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3} \\tilde{n}(-\\mathbf{k})\\, \\tilde{G}(\\mathbf{k})\\, \\tilde{n}(\\mathbf{k})\n$$\n其中 $\\tilde{f}(\\mathbf{k}) = \\int f(\\mathbf{r}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{r}) d^3\\mathbf{r}$ 是傅里叶变换。\n由于 $n(\\mathbf{r})$ 是一个实偶函数，其傅里叶变换 $\\tilde{n}(\\mathbf{k})$ 也是实偶函数，即 $\\tilde{n}(-\\mathbf{k}) = \\tilde{n}(\\mathbf{k})$。表达式简化为：\n$$\nE_{H}[n] = \\frac{1}{2} \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3} |\\tilde{n}(\\mathbf{k})|^2 \\tilde{G}(\\mathbf{k})\n$$\n\n首先，我们计算高斯密度 $n(\\mathbf{r})$ 的傅里叶变换。\n$$\n\\tilde{n}(\\mathbf{k}) = \\int N \\left(\\frac{\\beta}{\\pi}\\right)^{3/2} \\exp(-\\beta r^2) \\exp(-i\\mathbf{k}\\cdot\\mathbf{r}) d^3\\mathbf{r}\n$$\n三维高斯函数 $\\exp(-a r^2)$ 的傅里叶变换是一个标准结果：\n$$\n\\int \\exp(-a r^2) \\exp(-i\\mathbf{k}\\cdot\\mathbf{r}) d^3\\mathbf{r} = \\left(\\frac{\\pi}{a}\\right)^{3/2} \\exp\\left(-\\frac{k^2}{4a}\\right)\n$$\n其中 $k = |\\mathbf{k}|$。在我们的例子中，$a=\\beta$。\n将此代入 $\\tilde{n}(\\mathbf{k})$ 的表达式中：\n$$\n\\tilde{n}(\\mathbf{k}) = N \\left(\\frac{\\beta}{\\pi}\\right)^{3/2} \\left(\\frac{\\pi}{\\beta}\\right)^{3/2} \\exp\\left(-\\frac{k^2}{4\\beta}\\right) = N \\exp\\left(-\\frac{k^2}{4\\beta}\\right)\n$$\n\n接下来，我们需要库仑核 $G(\\mathbf{r}) = 1/r$ 的傅里叶变换。这是静电学中的另一个标准结果（在原子单位下）：\n$$\n\\tilde{G}(\\mathbf{k}) = \\int \\frac{1}{r} \\exp(-i\\mathbf{k}\\cdot\\mathbf{r}) d^3\\mathbf{r} = \\frac{4\\pi}{k^2}\n$$\n\n现在我们将这些傅里叶变换代回 $E_H[n]$ 的表达式中：\n$$\nE_{H}[n] = \\frac{1}{2} \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3} \\left[N \\exp\\left(-\\frac{k^2}{4\\beta}\\right)\\right]^2 \\left(\\frac{4\\pi}{k^2}\\right)\n$$\n$$\nE_{H}[n] = \\frac{4\\pi N^2}{2(2\\pi)^3} \\int \\frac{1}{k^2} \\exp\\left(-2\\frac{k^2}{4\\beta}\\right) d^3\\mathbf{k} = \\frac{N^2}{4\\pi^2} \\int \\frac{1}{k^2} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) d^3\\mathbf{k}\n$$\n被积函数在 $\\mathbf{k}$ 空间中是球对称的，因此我们可以切换到球坐标，积分体积元为 $d^3\\mathbf{k} = k^2 \\sin\\theta_k dk d\\theta_k d\\phi_k$：\n$$\n\\int \\frac{1}{k^2} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) d^3\\mathbf{k} = \\int_0^{2\\pi} d\\phi_k \\int_0^{\\pi} \\sin\\theta_k d\\theta_k \\int_0^\\infty k^2 dk \\left( \\frac{1}{k^2} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) \\right)\n$$\n角向积分给出一个因子 $4\\pi$。$k^2$ 项被消去。\n$$\n= 4\\pi \\int_0^\\infty \\exp\\left(-\\frac{k^2}{2\\beta}\\right) dk\n$$\n这是一个标准的高斯积分，其形式为 $\\int_0^\\infty \\exp(-ax^2)dx = \\frac{1}{2}\\sqrt{\\frac{\\pi}{a}}$。此处，$a=1/(2\\beta)$。\n$$\n4\\pi \\left(\\frac{1}{2}\\sqrt{\\frac{\\pi}{1/(2\\beta)}}\\right) = 2\\pi \\sqrt{2\\pi\\beta}\n$$\n将此结果代回 $E_H[n]$ 的表达式中：\n$$\nE_{H}[n] = \\frac{N^2}{4\\pi^2} \\left(2\\pi \\sqrt{2\\pi\\beta}\\right) = \\frac{N^2}{2\\pi} \\sqrt{2\\pi\\beta} = N^2 \\sqrt{\\frac{2\\pi\\beta}{4\\pi^2}} = N^2 \\sqrt{\\frac{\\beta}{2\\pi}}\n$$\n这就是给定高斯电荷分布的精确 Hartree 自能。\n\n问题的第二部分提供了一个独立的途径来验证此结果。我们考虑两个相同的、中心相距为 $R = |\\mathbf{R}|$ 的高斯分布 $n_1(\\mathbf{r}) = n(\\mathbf{r})$ 和 $n_2(\\mathbf{r}) = n(\\mathbf{r}-\\mathbf{R})$ 之间的相互作用能 $E_{int}(R)$。\n$$\nE_{int}(R) = \\int_{\\mathbb{R}^{3}}\\int_{\\mathbb{R}^{3}} \\frac{n_1(\\mathbf{r})\\,n_2(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\, d^3\\mathbf{r}\\, d^3\\mathbf{r}'\n$$\n在傅里叶空间中，该相互作用能由下式给出：\n$$\nE_{int}(R) = \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3} \\tilde{n}_1(-\\mathbf{k})\\, \\tilde{G}(\\mathbf{k})\\, \\tilde{n}_2(\\mathbf{k})\n$$\n我们有 $\\tilde{n}_1(\\mathbf{k}) = \\tilde{n}(\\mathbf{k})$。平移后的密度的傅里叶变换是 $\\tilde{n}_2(\\mathbf{k}) = \\exp(-i\\mathbf{k}\\cdot\\mathbf{R})\\tilde{n}(\\mathbf{k})$。\n$$\nE_{int}(R) = \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3} \\tilde{n}(\\mathbf{k})\\left(\\frac{4\\pi}{k^2}\\right) \\exp(-i\\mathbf{k}\\cdot\\mathbf{R})\\tilde{n}(\\mathbf{k})\n$$\n$$\nE_{int}(R) = \\frac{4\\pi N^2}{(2\\pi)^3} \\int \\frac{1}{k^2} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) \\exp(-i\\mathbf{k}\\cdot\\mathbf{R}) d^3\\mathbf{k}\n$$\n为了计算该积分，我们将 $\\mathbf{R}$ 与 z 轴对齐，因此 $\\mathbf{k}\\cdot\\mathbf{R} = kR\\cos\\theta_k$。\n积分的角向部分变为：\n$$\n\\int_0^{2\\pi} d\\phi_k \\int_0^{\\pi} \\sin\\theta_k d\\theta_k \\exp(-ikR\\cos\\theta_k) = 2\\pi \\int_{-1}^{1} \\exp(-ikRu)du = 2\\pi \\frac{\\exp(-ikR) - \\exp(ikR)}{-ikR} = 4\\pi \\frac{\\sin(kR)}{kR}\n$$\n将其代回，对 $d^3\\mathbf{k}$ 的积分变为：\n$$\n\\int_0^\\infty k^2 dk \\left(\\frac{1}{k^2} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) 4\\pi \\frac{\\sin(kR)}{kR}\\right) = \\frac{4\\pi}{R} \\int_0^\\infty \\frac{\\sin(kR)}{k} \\exp\\left(-\\frac{k^2}{2\\beta}\\right) dk\n$$\n已知积分 $\\int_0^\\infty \\frac{\\sin(kx)}{k} e^{-ak^2} dk$ 的值为 $\\frac{\\pi}{2} \\text{erf}\\left(\\frac{x}{2\\sqrt{a}}\\right)$。此处 $x=R$ 且 $a = 1/(2\\beta)$。\n$$\n\\text{积分} = \\frac{4\\pi}{R} \\frac{\\pi}{2} \\text{erf}\\left(\\frac{R}{2\\sqrt{1/(2\\beta)}}\\right) = \\frac{2\\pi^2}{R} \\text{erf}\\left(R\\sqrt{\\frac{\\beta}{2}}\\right)\n$$\n将此结果代入 $E_{int}(R)$ 的表达式中：\n$$\nE_{int}(R) = \\frac{N^2}{2\\pi^2} \\left[ \\frac{2\\pi^2}{R} \\text{erf}\\left(R\\sqrt{\\frac{\\beta}{2}}\\right) \\right] = \\frac{N^2}{R} \\text{erf}\\left(R\\sqrt{\\frac{\\beta}{2}}\\right)\n$$\n现在，我们取 $R \\to 0$ 的极限。对小的 $z = R\\sqrt{\\beta/2}$，使用误差函数 $\\text{erf}(z) = \\frac{2}{\\sqrt{\\pi}}(z - z^3/3! + \\dots)$ 的泰勒级数：\n$$\n\\lim_{R\\to 0} E_{int}(R) = \\lim_{R\\to 0} \\frac{N^2}{R} \\left[ \\frac{2}{\\sqrt{\\pi}} \\left(R\\sqrt{\\frac{\\beta}{2}}\\right) + O(R^3) \\right]\n$$\n$$\n\\lim_{R\\to 0} E_{int}(R) = N^2 \\frac{2}{\\sqrt{\\pi}} \\sqrt{\\frac{\\beta}{2}} = N^2 \\sqrt{\\frac{4\\beta}{2\\pi}} = N^2 \\sqrt{\\frac{2\\beta}{\\pi}}\n$$\n根据问题，这个结果应该与自能 $E_H[n]$ 相关。两个相同的、重叠的电荷分布 $n_1=n$ 和 $n_2=n$ 之间的相互作用能是 $\\int\\int \\frac{n(\\mathbf{r})n(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}d^3\\mathbf{r}d^3\\mathbf{r}'$，根据定义，它等于 $2 E_H[n]$。我们计算的极限对应于此量。\n我们来检查结果是否一致：\n$$\n2 E_H[n] = 2 \\left( N^2 \\sqrt{\\frac{\\beta}{2\\pi}} \\right) = N^2 \\sqrt{\\frac{4\\beta}{2\\pi}} = N^2 \\sqrt{\\frac{2\\beta}{\\pi}}\n$$\n这与 $\\lim_{R \\to 0} E_{int}(R)$ 完全匹配。一致性检验证实了我们推导出的 Hartree 能量 $E_H[n]$ 表达式的有效性。",
            "answer": "$$\n\\boxed{N^2 \\sqrt{\\frac{\\beta}{2\\pi}}}\n$$"
        },
        {
            "introduction": "从理论走向实践，密度泛函理论计算通常在离散网格上生成电子密度$n(\\mathbf{r})$。一项基本的自洽性检验，是确保对离散密度进行积分后，能够恢复系统中的总电子数。本练习将指导您实现一种数值积分方法，这是处理和验证计算数据的核心技能，并将其应用于包括非均匀网格在内的多种物理情境。",
            "id": "3876853",
            "problem": "在密度泛函理论（DFT）的背景下，给定一个表面平板模型的基态电子密度 $n(\\mathbf r)$ 的直角三维离散化。根据 Hohenberg-Kohn 定理，密度泛函理论（DFT）指的是从基态电子密度到系统所有可观测量之间的映射。目标是通过对模拟晶胞内的 $n(\\mathbf r)$ 进行数值积分，计算以电子为单位的积分电荷，并验证其等于晶胞中的电子数。这与 Kohn-Sham 方程一致，该方程通过一个辅助的非相互作用系统来表示相互作用系统，该辅助系统的轨道能再现相同的基态电子密度。基本原理是总电子数 $N$ 由积分给出\n$$\nN \\equiv \\int_{\\Omega} n(\\mathbf r)\\,\\mathrm d^3 \\mathbf r,\n$$\n并且，在 Kohn-Sham 表象中，密度可以表示为 $n(\\mathbf r) = \\sum_i f_i \\left|\\psi_i(\\mathbf r)\\right|^2$，其中 $f_i$ 是占据数，$\\psi_i(\\mathbf r)$ 是归一化的 Kohn-Sham 轨道。\n\n你的任务是实现一个与离散直角网格一致的数值积分方法。电子密度 $n(\\mathbf r)$ 在网格节点 $(x_i,y_j,z_k)$ 上采样。为了在物理和数值上与基于节点的离散化保持一致，请使用三维梯形法则。该方法沿每个轴应用一维梯形权重，并通过张量积构成体积元：\n- 对于一维坐标数组 $\\{u_\\ell\\}_{\\ell=0}^{M-1}$（其中 $u_\\ell$ 的单位为 $\\mathrm{\\AA}$），定义梯形权重 $w_\\ell$（单位为 $\\mathrm{\\AA}$）如下\n$$\nw_0 = \\frac{u_1 - u_0}{2},\\quad\nw_\\ell = \\frac{u_{\\ell+1} - u_{\\ell-1}}{2}\\ \\text{for}\\ 1 \\le \\ell \\le M-2,\\quad\nw_{M-1} = \\frac{u_{M-1} - u_{M-2}}{2}.\n$$\n- 对于具有坐标数组 $\\{x_i\\}_{i=0}^{N_x-1}$、$\\{y_j\\}_{j=0}^{N_y-1}$ 和 $\\{z_k\\}_{k=0}^{N_z-1}$ 的三个轴，三维梯形近似为\n$$\n\\hat N = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\sum_{k=0}^{N_z-1} n(x_i,y_j,z_k)\\, w^{(x)}_i\\, w^{(y)}_j\\, w^{(z)}_k,\n$$\n其中 $w^{(x)}_i$、$w^{(y)}_j$ 和 $w^{(z)}_k$ 是特定于轴的梯形权重。当 $n$ 的单位为电子/立方埃（$\\mathrm{e}/\\mathrm{\\AA}^3$）且坐标单位为埃（$\\mathrm{\\AA}$）时，此方法计算出的 $\\hat N$ 的单位为电子。\n\n请为以下五个测试用例实现上述方法。在所有用例中，不涉及角度。使用 $10^{-4}$ 电子的绝对验证容差。单位：\n- 坐标 $\\{x_i\\}, \\{y_j\\}, \\{z_k\\}$ 的单位是 $\\mathrm{\\AA}$。\n- 密度 $n(\\mathbf r)$ 的单位是 $\\mathrm{e}/\\mathrm{\\AA}^3$。\n- 积分电子数的单位是电子（无量纲）。\n\n对于每个用例，请完全按照规定构建坐标数组和离散密度 $n(\\mathbf r)$。\n\n用例1（含真空的正交平板中的均匀密度）：\n- 晶胞长度：$L_x = 5.0\\,\\mathrm{\\AA}$，$L_y = 5.0\\,\\mathrm{\\AA}$，$L_z = 20.0\\,\\mathrm{\\AA}$。\n- 网格大小：$N_x = 25$，$N_y = 25$，$N_z = 40$。\n- 坐标：$x_i$、$y_j$、$z_k$ 在 $0$ 和各自的晶胞长度之间（含两端）线性间隔。\n- 目标电子数：$N_{\\mathrm{target}} = 16$。\n- 密度：$n(\\mathbf r) = N_{\\mathrm{target}}/(L_x L_y L_z)$（均匀）。\n\n用例2（$z$ 轴非均匀间距和高斯平板密度）：\n- 晶胞长度：$L_x = 8.0\\,\\mathrm{\\AA}$，$L_y = 8.0\\,\\mathrm{\\AA}$，$L_z = 30.0\\,\\mathrm{\\AA}$。\n- 网格大小：$N_x = 20$，$N_y = 20$，$N_z = 60$。\n- 坐标：$x_i$、$y_j$ 在其范围内线性间隔；$z_k$ 是非均匀的，通过\n$$\nu_k = \\tanh\\!\\big(\\alpha\\, t_k\\big),\\ \\ t_k = \\frac{2k}{N_z - 1} - 1,\\ \\ \\alpha = 2.5,\n$$\n构建，然后通过 $p_k = \\frac{u_k - \\min(u)}{\\max(u) - \\min(u)}$ 将 $\\{u_k\\}$ 重新缩放到 $[0,1]$，并设置 $z_k = L_z p_k$。\n- 目标电子数：$N_{\\mathrm{target}} = 24$。\n- 密度：一个依赖于 $z$ 的高斯函数，\n$$\nn(x,y,z) = A \\exp\\!\\left( -\\frac{(z - z_0)^2}{2\\sigma^2} \\right),\n$$\n其中 $z_0 = L_z/2$，$\\sigma = 1.0\\,\\mathrm{\\AA}$，以及 $A = \\dfrac{N_{\\mathrm{target}}}{L_x L_y \\sqrt{2\\pi}\\,\\sigma}$。\n\n用例3（两个局域高斯峰，代表真空中的薄平板）：\n- 晶胞长度：$L_x = 10.0\\,\\mathrm{\\AA}$，$L_y = 10.0\\,\\mathrm{\\AA}$，$L_z = 60.0\\,\\mathrm{\\AA}$。\n- 网格大小：$N_x = 16$，$N_y = 16$，$N_z = 96$。\n- 坐标：$x_i$、$y_j$、$z_k$ 线性间隔。\n- 目标电子数：$N_{\\mathrm{target}} = 2$。\n- 密度：位于 $z_1 = 15.0\\,\\mathrm{\\AA}$ 和 $z_2 = 45.0\\,\\mathrm{\\AA}$ 的两个 $z$ 局域高斯函数之和，$\\sigma = 0.5\\,\\mathrm{\\AA}$，\n$$\nn(x,y,z) = \\sum_{m=1}^2 A_m \\exp\\!\\left( -\\frac{(z - z_m)^2}{2\\sigma^2} \\right),\\quad A_m = \\frac{1}{L_x L_y \\sqrt{2\\pi}\\,\\sigma},\n$$\n使得每个峰积分为 1 个电子，总计 $N_{\\mathrm{target}} = 2$。\n\n用例4（所有轴均为非均匀间距的均匀密度）：\n- 晶胞长度：$L_x = 7.5\\,\\mathrm{\\AA}$，$L_y = 6.25\\,\\mathrm{\\AA}$，$L_z = 12.5\\,\\mathrm{\\AA}$。\n- 网格大小：$N_x = 21$，$N_y = 17$，$N_z = 19$。\n- 坐标：对于每个轴，通过与用例2中相同的基于 $\\tanh$ 的过程构建非均匀节点，但使用不同的 $\\alpha$ 值：$\\alpha_x = 3.0$，$\\alpha_y = 1.5$，$\\alpha_z = 2.0$，并重新缩放到 $[0,L_\\bullet]$。\n- 目标电子数：$N_{\\mathrm{target}} = 11$。\n- 密度：$n(\\mathbf r) = N_{\\mathrm{target}}/(L_x L_y L_z)$（均匀）。\n\n用例5（通过占据数生成密度的 Kohn-Sham 轨道）：\n- 晶胞长度：$L_x = 12.0\\,\\mathrm{\\AA}$，$L_y = 10.0\\,\\mathrm{\\AA}$，$L_z = 14.0\\,\\mathrm{\\AA}$。\n- 网格大小：$N_x = 48$，$N_y = 40$，$N_z = 56$。\n- 坐标：$x_i$、$y_j$、$z_k$ 线性间隔。\n- 占据数：$f_1 = 2$，$f_2 = 2$。\n- 轨道：定义\n$$\n\\psi_1(x,y,z) = \\sqrt{\\frac{8}{L_x L_y L_z}}\\,\\sin\\!\\left(\\frac{\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{\\pi y}{L_y}\\right)\\sin\\!\\left(\\frac{\\pi z}{L_z}\\right),\n$$\n$$\n\\psi_2(x,y,z) = \\sqrt{\\frac{8}{L_x L_y L_z}}\\,\\sin\\!\\left(\\frac{2\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{\\pi y}{L_y}\\right)\\sin\\!\\left(\\frac{\\pi z}{L_z}\\right),\n$$\n并将密度设置为\n$$\nn(\\mathbf r) = f_1 \\left|\\psi_1(\\mathbf r)\\right|^2 + f_2 \\left|\\psi_2(\\mathbf r)\\right|^2.\n$$\n- 目标电子数：$N_{\\mathrm{target}} = f_1 + f_2 = 4$。\n\n验证：\n- 对于每个用例，使用三维梯形法则计算 $\\hat N$，并验证 $\\left|\\hat N - N_{\\mathrm{target}}\\right| \\le 10^{-4}$ 电子。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[\\hat N_1,\\mathrm{ok}_1,\\hat N_2,\\mathrm{ok}_2,\\ldots,\\hat N_5,\\mathrm{ok}_5]$，其中每个 $\\hat N_i$ 是一个浮点数，每个 $\\mathrm{ok}_i$ 是一个布尔值，如果验证不等式成立则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。每个 $\\hat N_i$ 的单位是电子（无量纲）。",
            "solution": "Hohenberg-Kohn 定理的基本原理指出，基态电子密度 $n(\\mathbf r)$ 唯一地决定了系统的所有性质，包括总电子数 $N$。电子数通过积分\n$$\nN = \\int_{\\Omega} n(\\mathbf r)\\,\\mathrm d^3 \\mathbf r\n$$\n得到，其中 $\\Omega$ 是三维空间中的模拟晶胞，$n(\\mathbf r) \\ge 0$ 的单位是电子/立方埃（$\\mathrm{e}/\\mathrm{\\AA}^3$）。在 Kohn-Sham 构建中，相同的 $n(\\mathbf r)$ 由具有占据数 $f_i$ 的非相互作用轨道 $\\psi_i(\\mathbf r)$ 再现，并且 $n(\\mathbf r) = \\sum_i f_i |\\psi_i(\\mathbf r)|^2$。由于每个归一化轨道都满足 $\\int |\\psi_i(\\mathbf r)|^2\\mathrm d^3\\mathbf r = 1$，根据线性关系可得 $\\int n(\\mathbf r)\\mathrm d^3\\mathbf r = \\sum_i f_i$，这使得积分值等于 Kohn-Sham 占据数所隐含的电子数。\n\n当 $n(\\mathbf r)$ 在节点 $\\{(x_i,y_j,z_k)\\}$ 构成的直角网格上提供时，为了进行数值积分，我们采用与基于节点的采样一致的梯形求积法。在一维情况下，对于跨越区间 $[0,U]$ 的坐标数组 $\\{u_\\ell\\}_{\\ell=0}^{M-1}$，梯形权重 $w_\\ell$ 近似了每个节点处的线元 $\\mathrm d u$：\n$$\nw_0 = \\frac{u_1 - u_0}{2},\\quad\nw_\\ell = \\frac{u_{\\ell+1} - u_{\\ell-1}}{2}\\ \\text{for}\\ 1 \\le \\ell \\le M-2,\\quad\nw_{M-1} = \\frac{u_{M-1} - u_{M-2}}{2}.\n$$\n这些权重满足 $\\sum_{\\ell=0}^{M-1} w_\\ell \\approx U$，对于线性间距，等号成立。在三维情况下，体积元的可分性意味着 $\\mathrm d^3 \\mathbf r = \\mathrm d x\\, \\mathrm d y\\, \\mathrm d z$，因此我们构建张量积权重。对于 $x$、$y$ 和 $z$ 轴，其各自的梯形权重为 $w^{(x)}_i$、$w^{(y)}_j$ 和 $w^{(z)}_k$，三维梯形法则将积分计算为\n$$\n\\hat N = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\sum_{k=0}^{N_z-1} n(x_i,y_j,z_k)\\, w^{(x)}_i\\, w^{(y)}_j\\, w^{(z)}_k.\n$$\n当密度 $n$ 的单位是 $\\mathrm{e}/\\mathrm{\\AA}^3$ 并且坐标单位是 $\\mathrm{\\AA}$ 时，该算法计算出的 $\\hat N$ 以电子为单位。梯形法则适用于 Kohn-Sham 计算中经常遇到的光滑密度，并能确保在均匀网格上的均匀密度的计算是精确的，以及在光滑非均匀情况下的高精度。\n\n算法步骤：\n1. 对于每个测试用例，根据指定的晶胞长度和网格大小构建坐标数组 $\\{x_i\\}$、$\\{y_j\\}$、$\\{z_k\\}$。对于非均匀轴，使用指定的双曲正切映射 $u = \\tanh(\\alpha t)$，其中 $t$ 在 $[-1,1]$ 内均匀间隔，然后将其重新缩放到物理区间。\n2. 构建离散密度 $n(x_i,y_j,z_k)$：\n   - 对于均匀密度情况，设置 $n(\\mathbf r) = N_{\\mathrm{target}}/(L_x L_y L_z)$。\n   - 对于仅在 $z$ 方向变化的高斯密度，设置 $n(x,y,z) = A \\exp\\!\\left( -\\frac{(z - z_0)^2}{2\\sigma^2} \\right)$ 并选择 $A$ 使得连续积分近似等于 $N_{\\mathrm{target}}$：$A = \\dfrac{N_{\\mathrm{target}}}{L_x L_y \\sqrt{2\\pi}\\,\\sigma}$，其中 $z_0 = L_z/2$ 且 $\\sigma$ 相对于 $L_z$ 较小以最小化截断误差。\n   - 对于两个高斯函数之和，使用叠加原理并选择振幅 $A_m$，使得每个高斯函数的积分为 1 个电子，从而确保总数为 2。\n   - 对于 Kohn-Sham 轨道，使用归一化常数 $\\sqrt{\\frac{8}{L_x L_y L_z}}$ 构建 $\\psi_1$ 和 $\\psi_2$，这保证了在连续谱中 $\\int |\\psi_i|^2 \\mathrm d^3 \\mathbf r = 1$ 精确成立。密度为 $n(\\mathbf r) = f_1|\\psi_1|^2 + f_2|\\psi_2|^2$。\n3. 使用差分公式计算每个轴上的一维梯形权重。这些权重的单位是 $\\mathrm{\\AA}$。\n4. 使用带有张量积权重的三重求和计算积分电子数，得到 $\\hat N$。\n5. 对每个用例验证 $\\left|\\hat N - N_{\\mathrm{target}}\\right| \\le 10^{-4}$ 电子。\n6. 将输出汇总为指定的单行格式：$[\\hat N_1,\\mathrm{ok}_1,\\hat N_2,\\mathrm{ok}_2,\\ldots,\\hat N_5,\\mathrm{ok}_5]$。\n\n该设计利用了电子数是密度积分（Hohenberg-Kohn）的原理，并且在 Kohn-Sham 形式主义中，从具有已知占据数的轨道导出的密度通过构造积分得到电子数。选择梯形积分方法是因为它与平面波和基于网格的 DFT 代码通常产生的基于节点的离散化相一致，并为积分提供了稳健、收敛的近似。测试套件包括均匀密度情况（用于验证精确性）、非均匀坐标（用于验证对可变间距的正确处理）、局域高斯密度（用于模拟真空中类似平板的电子分布）以及由归一化 Kohn-Sham 轨道构建的密度（用于探究轨道占据数与电子数之间的联系）。$10^{-4}$ 电子的统一绝对容差考虑了离散化和求积误差，同时对于高等研究生级别的数值验证来说仍然是严格的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef trapezoid_weights(coords: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Compute 1D trapezoidal weights for node-based integration over the coordinate array.\n    coords: array of shape (M,) in Angstrom.\n    Returns weights array of shape (M,) in Angstrom.\n    \"\"\"\n    M = coords.size\n    if M  2:\n        raise ValueError(\"At least two points are required to form trapezoidal weights.\")\n    diffs = np.diff(coords)\n    if np.any(diffs = 0):\n        raise ValueError(\"Coordinate array must be strictly increasing.\")\n    w = np.empty(M, dtype=float)\n    w[0] = diffs[0] / 2.0\n    w[-1] = diffs[-1] / 2.0\n    if M > 2:\n        w[1:-1] = (diffs[1:] + diffs[:-1]) / 2.0\n    return w\n\ndef integrate_density(n: np.ndarray, x: np.ndarray, y: np.ndarray, z: np.ndarray) -> float:\n    \"\"\"\n    Integrate a 3D density n(x_i, y_j, z_k) using tensor-product trapezoidal weights.\n    n: array of shape (Nx, Ny, Nz) in e/Angstrom^3\n    x, y, z: coordinate arrays in Angstrom\n    Returns total electrons as float.\n    \"\"\"\n    wx = trapezoid_weights(x)\n    wy = trapezoid_weights(y)\n    wz = trapezoid_weights(z)\n    # Use broadcasting to multiply weights\n    # Volume element per node = wx[i] * wy[j] * wz[k]\n    vol_weights = wx[:, None, None] * wy[None, :, None] * wz[None, None, :]\n    total_electrons = float(np.sum(n * vol_weights))\n    return total_electrons\n\ndef make_tanh_nonuniform_coords(L: float, N: int, alpha: float) -> np.ndarray:\n    \"\"\"\n    Construct a nonuniform coordinate array on [0, L] using a tanh mapping with parameter alpha.\n    \"\"\"\n    t = np.linspace(-1.0, 1.0, N)\n    u = np.tanh(alpha * t)  # range approximately (-tanh(alpha), tanh(alpha))\n    # Rescale to [0, 1]\n    p = (u - u.min()) / (u.max() - u.min())\n    return L * p\n\ndef solve():\n    tol = 1e-4  # absolute tolerance in electrons\n\n    results = []\n\n    # Case 1: Uniform density in orthorhombic slab with vacuum\n    Lx1, Ly1, Lz1 = 5.0, 5.0, 20.0\n    Nx1, Ny1, Nz1 = 25, 25, 40\n    x1 = np.linspace(0.0, Lx1, Nx1)\n    y1 = np.linspace(0.0, Ly1, Ny1)\n    z1 = np.linspace(0.0, Lz1, Nz1)\n    N_target1 = 16.0\n    n1_val = N_target1 / (Lx1 * Ly1 * Lz1)\n    n1 = np.full((Nx1, Ny1, Nz1), n1_val, dtype=float)\n    N_calc1 = integrate_density(n1, x1, y1, z1)\n    ok1 = abs(N_calc1 - N_target1) = tol\n    results.extend([N_calc1, ok1])\n\n    # Case 2: Nonuniform z with Gaussian\n    Lx2, Ly2, Lz2 = 8.0, 8.0, 30.0\n    Nx2, Ny2, Nz2 = 20, 20, 60\n    x2 = np.linspace(0.0, Lx2, Nx2)\n    y2 = np.linspace(0.0, Ly2, Ny2)\n    z2 = make_tanh_nonuniform_coords(Lz2, Nz2, alpha=2.5)\n    N_target2 = 24.0\n    z0_2 = Lz2 / 2.0\n    sigma2 = 1.0\n    A2 = N_target2 / (Lx2 * Ly2 * np.sqrt(2.0 * np.pi) * sigma2)\n    # Density depends only on z\n    n2_z = A2 * np.exp(-0.5 * ((z2 - z0_2) / sigma2) ** 2)\n    # Broadcast to 3D\n    n2 = np.broadcast_to(n2_z[None, None, :], (Nx2, Ny2, Nz2)).copy()\n    N_calc2 = integrate_density(n2, x2, y2, z2)\n    ok2 = abs(N_calc2 - N_target2) = tol\n    results.extend([N_calc2, ok2])\n\n    # Case 3: Two localized Gaussians (thin slab in vacuum)\n    Lx3, Ly3, Lz3 = 10.0, 10.0, 60.0\n    Nx3, Ny3, Nz3 = 16, 16, 96\n    x3 = np.linspace(0.0, Lx3, Nx3)\n    y3 = np.linspace(0.0, Ly3, Ny3)\n    z3 = np.linspace(0.0, Lz3, Nz3)\n    N_target3 = 2.0\n    z1_3, z2_3 = 15.0, 45.0\n    sigma3 = 0.5\n    A3 = 1.0 / (Lx3 * Ly3 * np.sqrt(2.0 * np.pi) * sigma3)  # each peak 1 electron\n    n3_z = A3 * np.exp(-0.5 * ((z3 - z1_3) / sigma3) ** 2) + A3 * np.exp(-0.5 * ((z3 - z2_3) / sigma3) ** 2)\n    n3 = np.broadcast_to(n3_z[None, None, :], (Nx3, Ny3, Nz3)).copy()\n    N_calc3 = integrate_density(n3, x3, y3, z3)\n    ok3 = abs(N_calc3 - N_target3) = tol\n    results.extend([N_calc3, ok3])\n\n    # Case 4: Uniform density with nonuniform spacing on all axes\n    Lx4, Ly4, Lz4 = 7.5, 6.25, 12.5\n    Nx4, Ny4, Nz4 = 21, 17, 19\n    x4 = make_tanh_nonuniform_coords(Lx4, Nx4, alpha=3.0)\n    y4 = make_tanh_nonuniform_coords(Ly4, Ny4, alpha=1.5)\n    z4 = make_tanh_nonuniform_coords(Lz4, Nz4, alpha=2.0)\n    N_target4 = 11.0\n    n4_val = N_target4 / (Lx4 * Ly4 * Lz4)\n    n4 = np.full((Nx4, Ny4, Nz4), n4_val, dtype=float)\n    N_calc4 = integrate_density(n4, x4, y4, z4)\n    ok4 = abs(N_calc4 - N_target4) = tol\n    results.extend([N_calc4, ok4])\n\n    # Case 5: Kohn-Sham orbitals with occupations\n    Lx5, Ly5, Lz5 = 12.0, 10.0, 14.0\n    Nx5, Ny5, Nz5 = 48, 40, 56\n    x5 = np.linspace(0.0, Lx5, Nx5)\n    y5 = np.linspace(0.0, Ly5, Ny5)\n    z5 = np.linspace(0.0, Lz5, Nz5)\n    f1, f2 = 2.0, 2.0\n    N_target5 = f1 + f2\n    C5 = np.sqrt(8.0 / (Lx5 * Ly5 * Lz5))\n    # Build 3D grids via broadcasting\n    X5 = x5[:, None, None]\n    Y5 = y5[None, :, None]\n    Z5 = z5[None, None, :]\n    psi1_sq = (C5**2) * (np.sin(np.pi * X5 / Lx5) ** 2) * (np.sin(np.pi * Y5 / Ly5) ** 2) * (np.sin(np.pi * Z5 / Lz5) ** 2)\n    psi2_sq = (C5**2) * (np.sin(2.0 * np.pi * X5 / Lx5) ** 2) * (np.sin(np.pi * Y5 / Ly5) ** 2) * (np.sin(np.pi * Z5 / Lz5) ** 2)\n    n5 = f1 * psi1_sq + f2 * psi2_sq\n    N_calc5 = integrate_density(n5, x5, y5, z5)\n    ok5 = abs(N_calc5 - N_target5) = tol\n    results.extend([N_calc5, ok5])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [val if not isinstance(val, bool) else str(val) for val in results]))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "密度泛函理论的计算精度在很大程度上取决于对交换关联（$E_{xc}$）泛函的近似。本练习将探讨两类主要泛函——局域密度近似（LDA）和广义梯度近似（GGA）——在实际应用中的差异。通过使用一个关于一氧化碳在铂表面吸附的模型数据，您将计算泛函选择如何影响一个关键化学量——吸附能，从而突显密度梯度在更高级泛函中的核心作用。",
            "id": "3876786",
            "problem": "要求您设计并实现一个程序，用于计算一氧化碳 (CO) 分子吸附在铂 $(111)$ 表面上时，从局域密度近似 (LDA) 迁移到广义梯度近似 (GGA) 所引起的吸附能变化。此问题必须从密度泛函理论 (DFT) 的基本原理出发解决，包括 Hohenberg-Kohn 定理和 Kohn-Sham (KS) 方程。您的程序将使用提供的模型交换相关数据来计算该变化，并且必须分析在一小组测试场景中的趋势。\n\n从以下基本依据开始：\n- Hohenberg-Kohn 定理确保了相互作用电子系统的基态能量是基态电子密度 $n(\\mathbf{r})$ 的唯一泛函，并且精确的基态密度使该能量泛函最小化。\n- Kohn-Sham 方程构建了一个无相互作用的电子系统，该系统可再现真实的基态密度，从而产生以下形式的总能量泛函\n$$\nE[n] = T_{\\mathrm{s}}[n] + \\int v_{\\mathrm{ext}}(\\mathbf{r}) n(\\mathbf{r}) \\, d\\mathbf{r} + E_{\\mathrm{H}}[n] + E_{\\mathrm{xc}}[n],\n$$\n其中 $T_{\\mathrm{s}}[n]$ 是无相互作用动能，$v_{\\mathrm{ext}}(\\mathbf{r})$ 是外势，$E_{\\mathrm{H}}[n]$ 是哈特里能量 (Hartree energy)，$E_{\\mathrm{xc}}[n]$ 是交换相关能。\n\nCO 在 Pt$(111)$ 上的吸附能定义为\n$$\nE_{\\mathrm{ads}} = E_{\\mathrm{tot}}^{\\mathrm{slab+CO}} - E_{\\mathrm{tot}}^{\\mathrm{slab}} - E_{\\mathrm{tot}}^{\\mathrm{CO}},\n$$\n从局域密度近似 (LDA) 迁移到广义梯度近似 (GGA) 时吸附能的变化为\n$$\n\\Delta E_{\\mathrm{ads}} = E_{\\mathrm{ads}}^{\\mathrm{GGA}} - E_{\\mathrm{ads}}^{\\mathrm{LDA}}.\n$$\n假设 LDA 和 GGA 之间的唯一变化来自交换相关泛函 $E_{\\mathrm{xc}}[n]$，而所有其他贡献在这两种近似中保持相同。在此假设下，\n$$\n\\Delta E_{\\mathrm{ads}} = \\left(E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab+CO}) - E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab}) - E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{CO})\\right) - \\left(E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab+CO}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{CO})\\right).\n$$\n\n在此问题中，交换相关能量泛函在具有体积元 $\\Delta V$ 的均匀网格上离散化，因此\n$$\nE_{\\mathrm{xc}}[n] \\approx \\sum_{i} n_{i} \\, \\varepsilon_{\\mathrm{xc}}(n_{i}, g_{i}) \\, \\Delta V,\n$$\n其中 $n_{i}$ 是网格点 $i$ 处的电子密度（单位：电子/立方埃），$g_{i} = \\lvert \\nabla n \\rvert_{i}$ 是网格点 $i$ 处密度梯度的模（单位：电子/立方埃/埃），而 $\\varepsilon_{\\mathrm{xc}}$ 是每个粒子的交换相关能。使用以下模型形式：\n- 对于局域密度近似 (LDA)，\n$$\n\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n) = -A \\, n^{1/3},\n$$\n其中 $A$ 是一个以电子伏特为单位的正常量。\n- 对于广义梯度近似 (GGA)，使用约化梯度修正，\n$$\n\\varepsilon_{\\mathrm{xc}}^{\\mathrm{GGA}}(n, g) = \\frac{\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n)}{1 + C \\, s^{2}},\n$$\n其中 $C$ 是一个正常量，$s$ 是无量纲的约化梯度\n$$\ns = \\frac{g}{2 k_{\\mathrm{F}}(n) \\, n}, \\quad k_{\\mathrm{F}}(n) = \\left(3 \\pi^{2} n\\right)^{1/3}.\n$$\n当 $n = 0$ 时，定义约化梯度 $s = 0$，且该网格点对 $E_{\\mathrm{xc}}$ 的贡献为零。\n\n单位与数值说明：\n- 将 $\\Delta E_{\\mathrm{ads}}$ 以电子伏特 ($\\mathrm{eV}$) 表示，并四舍五入到六位小数。\n- 不涉及角度；无需角度单位。\n- 不涉及百分比；不要使用百分号。\n\n测试套件和输入数据：\n对于每个测试用例，您将获得 $(A, C, \\Delta V)$ 以及 $(\\mathrm{slab+CO})$、$(\\mathrm{slab})$ 和 $(\\mathrm{CO})$ 三个系统的有限网格，每个网格由密度和梯度数组表示。请使用以下数据。\n\n情况 1 (中等梯度，典型场景)：\n- $A = 0.75$, $C = 0.30$, $\\Delta V = 1.0$.\n- $(\\mathrm{slab+CO})$: $n = [\\,0.10,\\,0.12,\\,0.15,\\,0.08,\\,0.20,\\,0.18\\,]$, $g = [\\,0.05,\\,0.08,\\,0.10,\\,0.04,\\,0.12,\\,0.09\\,]$.\n- $(\\mathrm{slab})$: $n = [\\,0.09,\\,0.11,\\,0.14,\\,0.08,\\,0.19,\\,0.17\\,]$, $g = [\\,0.04,\\,0.07,\\,0.08,\\,0.04,\\,0.10,\\,0.08\\,]$.\n- $(\\mathrm{CO})$: $n = [\\,0.01,\\,0.01,\\,0.01,\\,0.00,\\,0.01,\\,0.01\\,]$, $g = [\\,0.01,\\,0.01,\\,0.02,\\,0.00,\\,0.02,\\,0.01\\,]$.\n\n情况 2 (边界情况，零梯度)：\n- $A = 0.75$, $C = 0.30$, $\\Delta V = 1.0$.\n- $(\\mathrm{slab+CO})$: $n = [\\,0.10,\\,0.12,\\,0.15,\\,0.08\\,]$, $g = [\\,0.00,\\,0.00,\\,0.00,\\,0.00\\,]$.\n- $(\\mathrm{slab})$: $n = [\\,0.09,\\,0.11,\\,0.14,\\,0.08\\,]$, $g = [\\,0.00,\\,0.00,\\,0.00,\\,0.00\\,]$.\n- $(\\mathrm{CO})$: $n = [\\,0.01,\\,0.01,\\,0.01,\\,0.00\\,]$, $g = [\\,0.00,\\,0.00,\\,0.00,\\,0.00\\,]$.\n\n情况 3 (吸附位点附近的高梯度局域化)：\n- $A = 0.75$, $C = 0.30$, $\\Delta V = 1.0$.\n- $(\\mathrm{slab+CO})$: $n = [\\,0.10,\\,0.12,\\,0.15,\\,0.08,\\,0.20,\\,0.18,\\,0.25,\\,0.22\\,]$, $g = [\\,0.20,\\,0.25,\\,0.30,\\,0.15,\\,0.35,\\,0.28,\\,0.40,\\,0.33\\,]$.\n- $(\\mathrm{slab})$: $n = [\\,0.09,\\,0.11,\\,0.14,\\,0.08,\\,0.19,\\,0.17,\\,0.24,\\,0.21\\,]$, $g = [\\,0.08,\\,0.10,\\,0.12,\\,0.06,\\,0.14,\\,0.12,\\,0.16,\\,0.14\\,]$.\n- $(\\mathrm{CO})$: $n = [\\,0.01,\\,0.01,\\,0.01,\\,0.00,\\,0.01,\\,0.01,\\,0.01,\\,0.01\\,]$, $g = [\\,0.03,\\,0.04,\\,0.05,\\,0.00,\\,0.05,\\,0.04,\\,0.06,\\,0.05\\,]$.\n\n情况 4 (边缘情况，真空尾部和近零密度)：\n- $A = 0.75$, $C = 0.30$, $\\Delta V = 1.0$.\n- $(\\mathrm{slab+CO})$: $n = [\\,0.00,\\,0.002,\\,0.005,\\,0.000,\\,0.001\\,]$, $g = [\\,0.000,\\,0.008,\\,0.012,\\,0.000,\\,0.006\\,]$.\n- $(\\mathrm{slab})$: $n = [\\,0.00,\\,0.0015,\\,0.0035,\\,0.000,\\,0.0008\\,]$, $g = [\\,0.000,\\,0.006,\\,0.010,\\,0.000,\\,0.004\\,]$.\n- $(\\mathrm{CO})$: $n = [\\,0.00,\\,0.0005,\\,0.0015,\\,0.000,\\,0.0003\\,]$, $g = [\\,0.000,\\,0.003,\\,0.005,\\,0.000,\\,0.002\\,]$.\n\n程序要求：\n- 根据上述模型实现 $E_{\\mathrm{xc}}^{\\mathrm{LDA}}$ 和 $E_{\\mathrm{xc}}^{\\mathrm{GGA}}$ 的计算。\n- 为每种情况计算 $\\Delta E_{\\mathrm{ads}}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[x_{1},x_{2},x_{3},x_{4}]$，其中每个 $x_{i}$ 是测试用例 $i$ 的 $\\Delta E_{\\mathrm{ads}}$（以 $\\mathrm{eV}$ 为单位），并四舍五入到六位小数。",
            "solution": "核心任务是计算当理论描述从局域密度近似 (LDA) 更改为广义梯度近似 (GGA) 时，$\\mathrm{CO}$ 分子在 $\\mathrm{Pt}(111)$ 表面上的吸附能变化，记为 $\\Delta E_{\\mathrm{ads}}$。该问题从密度泛函理论 (DFT) 的基本原理入手解决。\n\n吸附能定义为组合系统的总能量减去孤立组分的总能量之和：\n$$\nE_{\\mathrm{ads}} = E_{\\mathrm{tot}}^{\\mathrm{slab+CO}} - E_{\\mathrm{tot}}^{\\mathrm{slab}} - E_{\\mathrm{tot}}^{\\mathrm{CO}}\n$$\n这个量的变化 $\\Delta E_{\\mathrm{ads}}$ 是 GGA 吸附能与 LDA 吸附能之间的差值：\n$$\n\\Delta E_{\\mathrm{ads}} = E_{\\mathrm{ads}}^{\\mathrm{GGA}} - E_{\\mathrm{ads}}^{\\mathrm{LDA}}\n$$\n问题规定了一个关键的简化假设：动能 ($T_s[n]$)、外势能和哈特里能量 ($E_H[n]$) 的泛函在 LDA 和 GGA 计算中是相同的，因此在求差时会相互抵消。该近似将变化隔离到交换相关 ($E_{\\mathrm{xc}}$) 泛函上。因此，$\\Delta E_{\\mathrm{ads}}$ 的表达式简化为交换相关能贡献的差值：\n$$\n\\Delta E_{\\mathrm{ads}} = \\left(E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab+CO}) - E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab}) - E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{CO})\\right) - \\left(E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab+CO}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{CO})\\right)\n$$\n可以通过对每个系统的项进行分组来方便地重新排列此表达式：\n$$\n\\Delta E_{\\mathrm{ads}} = \\left(E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab+CO}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab+CO})\\right) - \\left(E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{slab}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{slab})\\right) - \\left(E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{CO}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{CO})\\right)\n$$\n我们将单个系统中 GGA 和 LDA 之间的交换相关能之差定义为 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}} = E_{\\mathrm{xc}}^{\\mathrm{GGA}}(\\mathrm{sys}) - E_{\\mathrm{xc}}^{\\mathrm{LDA}}(\\mathrm{sys})$。吸附能变化的最终表达式变为：\n$$\n\\Delta E_{\\mathrm{ads}} = \\Delta E_{\\mathrm{xc}}^{\\mathrm{slab+CO}} - \\Delta E_{\\mathrm{xc}}^{\\mathrm{slab}} - \\Delta E_{\\mathrm{xc}}^{\\mathrm{CO}}\n$$\n我们的主要任务是使用提供的离散化数据和模型泛函，为三个系统——组合系统 ($\\mathrm{slab+CO}$)、表面 ($\\mathrm{slab}$) 和分子 ($\\mathrm{CO}$)——中的每一个计算 $\\Delta E_{\\mathrm{xc}}$。\n\n交换相关能由离散网格点 $i$ 上的总和给出：\n$$\nE_{\\mathrm{xc}}[n] \\approx \\sum_{i} n_{i} \\, \\varepsilon_{\\mathrm{xc}}(n_{i}, g_{i}) \\, \\Delta V\n$$\n其中 $n_i$ 是电子密度，$g_i = \\lvert \\nabla n \\rvert_i$ 是密度梯度的模，$\\Delta V$ 是体积元。\n\nLDA 中每个粒子的能量模型为：\n$$\n\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n) = -A \\, n^{1/3}\n$$\nGGA 中每个粒子的能量模型包括一个梯度修正：\n$$\n\\varepsilon_{\\mathrm{xc}}^{\\mathrm{GGA}}(n, g) = \\frac{\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n)}{1 + C \\, s^{2}}\n$$\n其中 $s$ 是无量纲的约化梯度：\n$$\ns = \\frac{g}{2 k_{\\mathrm{F}}(n) \\, n}\n$$\n其中费米波矢量 $k_{\\mathrm{F}}(n) = (3 \\pi^{2} n)^{1/3}$。\n\n我们现在可以为 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}$ 制定一个显式表达式。对于单个系统，其差值为：\n$$\n\\Delta E_{\\mathrm{xc}} = E_{\\mathrm{xc}}^{\\mathrm{GGA}} - E_{\\mathrm{xc}}^{\\mathrm{LDA}} = \\sum_{i} \\left( n_{i} \\varepsilon_{\\mathrm{xc}}^{\\mathrm{GGA}}(n_i, g_i) - n_i \\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i) \\right) \\Delta V\n$$\n代入 $\\varepsilon_{\\mathrm{xc}}^{\\mathrm{GGA}}$ 的表达式：\n$$\n\\Delta E_{\\mathrm{xc}} = \\sum_{i} n_{i} \\left( \\frac{\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i)}{1 + C s_i^2} - \\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i) \\right) \\Delta V\n$$\n提出因子 $\\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i)$：\n$$\n\\Delta E_{\\mathrm{xc}} = \\sum_{i} n_{i} \\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i) \\left( \\frac{1}{1 + C s_i^2} - 1 \\right) \\Delta V = \\sum_{i} n_{i} \\varepsilon_{\\mathrm{xc}}^{\\mathrm{LDA}}(n_i) \\left( \\frac{1 - (1 + C s_i^2)}{1 + C s_i^2} \\right) \\Delta V\n$$\n$$\n\\Delta E_{\\mathrm{xc}} = \\sum_{i} n_{i} (-A n_i^{1/3}) \\left( \\frac{-C s_i^2}{1 + C s_i^2} \\right) \\Delta V\n$$\n这简化为计算一个系统中 GGA-LDA 能量差的更直接公式：\n$$\n\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}} = \\sum_{i} A n_i^{4/3} \\left( \\frac{C s_i^2}{1 + C s_i^2} \\right) \\Delta V\n$$\n每个测试用例的计算过程如下：\n1. 对于每个系统（$\\mathrm{slab+CO}$、$\\mathrm{slab}$ 和 $\\mathrm{CO}$），使用推导出的公式计算 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}$。\n2. $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}$ 的计算涉及遍历系统数据数组中的每个网格点 $i$。\n3. 对于每个密度 $n_i  0$ 的网格点 $i$：\n    a. 计算费米波矢量 $k_{\\mathrm{F}}(n_i) = (3 \\pi^2 n_i)^{1/3}$。\n    b. 计算约化梯度 $s_i = g_i / (2 k_{\\mathrm{F}}(n_i) n_i)$。\n    c. 计算对总和的贡献：$A n_i^{4/3} \\frac{C s_i^2}{1 + C s_i^2} \\Delta V$。\n4. 对于任何 $n_i = 0$ 的网格点，其对任何交换相关能的贡献均为零，这由问题规定，并通过通用 $E_{\\mathrm{xc}}$ 表达式中的 $n_i$ 因子得到证实。我们推导的 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}$ 公式由于 $n_i^{4/3}$ 项的存在，也会产生零贡献。\n5. 将所有网格点的这些贡献相加，得到 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}$。\n6. 一旦计算出 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{slab+CO}}$、$\\Delta E_{\\mathrm{xc}}^{\\mathrm{slab}}$ 和 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{CO}}$，使用 $\\Delta E_{\\mathrm{ads}} = \\Delta E_{\\mathrm{xc}}^{\\mathrm{slab+CO}} - \\Delta E_{\\mathrm{xc}}^{\\mathrm{slab}} - \\Delta E_{\\mathrm{xc}}^{\\mathrm{CO}}$ 求得最终答案。\n7. 每种情况的最终结果四舍五入到六位小数。\n\n该程序将应用于所提供的四个测试用例中的每一个，使用它们各自的参数 $(A, C, \\Delta V)$ 以及 $n$ 和 $g$ 的数据数组。\n对于情况 2，其中所有梯度 $g_i$ 均为零，这意味着对所有点 $s_i=0$。项 $\\frac{C s_i^2}{1+C s_i^2}$ 变为零，导致所有三个系统的 $\\Delta E_{\\mathrm{xc}}^{\\mathrm{sys}}=0$。因此，在这种情况下，$\\Delta E_{\\mathrm{ads}}$ 将为 $0$，这是预期的，因为当密度梯度消失时，GGA 泛函会简化为 LDA。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in adsorption energy from LDA to GGA DFT.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"params\": {\"A\": 0.75, \"C\": 0.30, \"delta_V\": 1.0},\n            \"systems\": {\n                \"slab+CO\": {\n                    \"n\": np.array([0.10, 0.12, 0.15, 0.08, 0.20, 0.18]),\n                    \"g\": np.array([0.05, 0.08, 0.10, 0.04, 0.12, 0.09]),\n                },\n                \"slab\": {\n                    \"n\": np.array([0.09, 0.11, 0.14, 0.08, 0.19, 0.17]),\n                    \"g\": np.array([0.04, 0.07, 0.08, 0.04, 0.10, 0.08]),\n                },\n                \"CO\": {\n                    \"n\": np.array([0.01, 0.01, 0.01, 0.00, 0.01, 0.01]),\n                    \"g\": np.array([0.01, 0.01, 0.02, 0.00, 0.02, 0.01]),\n                },\n            },\n        },\n        {\n            \"params\": {\"A\": 0.75, \"C\": 0.30, \"delta_V\": 1.0},\n            \"systems\": {\n                \"slab+CO\": {\n                    \"n\": np.array([0.10, 0.12, 0.15, 0.08]),\n                    \"g\": np.array([0.00, 0.00, 0.00, 0.00]),\n                },\n                \"slab\": {\n                    \"n\": np.array([0.09, 0.11, 0.14, 0.08]),\n                    \"g\": np.array([0.00, 0.00, 0.00, 0.00]),\n                },\n                \"CO\": {\n                    \"n\": np.array([0.01, 0.01, 0.01, 0.00]),\n                    \"g\": np.array([0.00, 0.00, 0.00, 0.00]),\n                },\n            },\n        },\n        {\n            \"params\": {\"A\": 0.75, \"C\": 0.30, \"delta_V\": 1.0},\n            \"systems\": {\n                \"slab+CO\": {\n                    \"n\": np.array([0.10, 0.12, 0.15, 0.08, 0.20, 0.18, 0.25, 0.22]),\n                    \"g\": np.array([0.20, 0.25, 0.30, 0.15, 0.35, 0.28, 0.40, 0.33]),\n                },\n                \"slab\": {\n                    \"n\": np.array([0.09, 0.11, 0.14, 0.08, 0.19, 0.17, 0.24, 0.21]),\n                    \"g\": np.array([0.08, 0.10, 0.12, 0.06, 0.14, 0.12, 0.16, 0.14]),\n                },\n                \"CO\": {\n                    \"n\": np.array([0.01, 0.01, 0.01, 0.00, 0.01, 0.01, 0.01, 0.01]),\n                    \"g\": np.array([0.03, 0.04, 0.05, 0.00, 0.05, 0.04, 0.06, 0.05]),\n                },\n            },\n        },\n        {\n            \"params\": {\"A\": 0.75, \"C\": 0.30, \"delta_V\": 1.0},\n            \"systems\": {\n                \"slab+CO\": {\n                    \"n\": np.array([0.00, 0.002, 0.005, 0.000, 0.001]),\n                    \"g\": np.array([0.000, 0.008, 0.012, 0.000, 0.006]),\n                },\n                \"slab\": {\n                    \"n\": np.array([0.00, 0.0015, 0.0035, 0.000, 0.0008]),\n                    \"g\": np.array([0.000, 0.006, 0.010, 0.000, 0.004]),\n                },\n                \"CO\": {\n                    \"n\": np.array([0.00, 0.0005, 0.0015, 0.000, 0.0003]),\n                    \"g\": np.array([0.000, 0.003, 0.005, 0.000, 0.002]),\n                },\n            },\n        },\n    ]\n\n    def calculate_delta_exc(n_grid, g_grid, A, C, delta_V):\n        \"\"\"\n        Calculates Delta E_xc = E_xc^GGA - E_xc^LDA for a single system.\n        \"\"\"\n        total_delta_exc = 0.0\n        for i in range(len(n_grid)):\n            n = n_grid[i]\n            g = g_grid[i]\n\n            if n == 0.0:\n                continue\n\n            # Calculate Fermi wavevector, k_F = (3 * pi^2 * n)^(1/3)\n            kF = (3 * np.pi**2 * n)**(1/3)\n            \n            # Calculate dimensionless reduced gradient, s = g / (2 * k_F * n)\n            s = g / (2 * kF * n)\n            \n            # Calculate the contribution to Delta E_xc from this grid point\n            # Delta E_xc_i = A * n^(4/3) * (C * s^2 / (1 + C * s^2)) * delta_V\n            term = A * n**(4/3)\n            correction_factor = (C * s**2) / (1 + C * s**2)\n            \n            total_delta_exc += term * correction_factor * delta_V\n            \n        return total_delta_exc\n\n    results = []\n    for case in test_cases:\n        params = case[\"params\"]\n        systems = case[\"systems\"]\n        \n        A = params[\"A\"]\n        C = params[\"C\"]\n        delta_V = params[\"delta_V\"]\n        \n        delta_exc_slab_co = calculate_delta_exc(\n            systems[\"slab+CO\"][\"n\"], systems[\"slab+CO\"][\"g\"], A, C, delta_V\n        )\n        \n        delta_exc_slab = calculate_delta_exc(\n            systems[\"slab\"][\"n\"], systems[\"slab\"][\"g\"], A, C, delta_V\n        )\n        \n        delta_exc_co = calculate_delta_exc(\n            systems[\"CO\"][\"n\"], systems[\"CO\"][\"g\"], A, C, delta_V\n        )\n        \n        # Delta E_ads = Delta E_xc(slab+CO) - Delta E_xc(slab) - Delta E_xc(CO)\n        delta_E_ads = delta_exc_slab_co - delta_exc_slab - delta_exc_co\n        \n        results.append(round(delta_E_ads, 6))\n\n    # Format the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\n\nsolve()\n```"
        }
    ]
}