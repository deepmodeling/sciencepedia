{
    "hands_on_practices": [
        {
            "introduction": "在运行任何模拟之前，估算所需的计算资源至关重要。第一个练习将指导您完成一项基本计算，将主要精度参数——平面波动能截断 $E_{\\text{cut}}$ ——与基组的大小以及存储电子波函数所需的内存联系起来。这项实践让您切实地理解理论参数如何转化为实际的计算成本。",
            "id": "3894563",
            "problem": "一位计算催化领域的研究人员正在使用周期性立方超胞中的平面波展开来模拟一种体相氧化物。该立方晶胞的边长为 $L = 15\\,\\text{\\AA}$，采用玻恩-冯·卡门（Born–von Kármán）周期性边界条件，并在布里渊区（BZ）的 Γ 点（$\\mathbf{k} = \\mathbf{0}$）进行单点采样。该平面波基组包含所有满足平面波动能截断标准 $E_{\\text{kin}} \\leq E_{\\text{cut}}$ 的倒易格矢 $\\mathbf{G}$。假设为非自旋极化态，并且在存储中不使用时间反演或实波函数对称性；系数以双精度复数形式存储。\n\n仅从以下基本定义和事实出发：\n- 对于立方晶胞，倒易格矢为 $\\mathbf{G} = \\frac{2\\pi}{L}\\mathbf{n}$，其中 $\\mathbf{n} \\in \\mathbb{Z}^{3}$。\n- 对于质量为 $m_{e}$ 的电子，波矢为 $\\mathbf{k} + \\mathbf{G}$ 的平面波分量的动能为 $E_{\\text{kin}} = \\frac{\\hbar^{2}}{2 m_{e}} \\lvert \\mathbf{k} + \\mathbf{G} \\rvert^{2}$。\n- 在倒易空间中使用连续近似，通过 $\\mathbf{G}$ 空间中一个球体的体积来估算所包含的 $\\mathbf{G}$ 矢量数量，并包括 $\\mathbf{G} = \\mathbf{0}$ 矢量。\n\n已知：\n- $E_{\\text{cut}} = 400\\,\\text{eV}$，\n- $N_{b} = 600$ 个能带，\n- 每个复数系数以 $16$ 字节存储，\n- 使用 $1\\,\\text{GB} = 10^{9}\\,\\text{bytes}$，\n- 物理常数：$\\hbar = 1.054571817 \\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$， $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\text{kg}$，以及 $1\\,\\text{eV} = 1.602176634 \\times 10^{-19}\\,\\text{J}$。\n\n从第一性原理出发，推导出所包含平面波数量 $N_{G}$ 的估算值，然后估算在单个 Γ 点存储 $N_{b}$ 个能带的所有平面波系数所需的总内存 $M$（以吉字节为单位）。将 $N_{G}$ 和 $M$ 都四舍五入到三位有效数字。将您的最终答案表示为行矩阵 $\\begin{pmatrix} N_{G}  M \\end{pmatrix}$，其中 $M$ 的单位为吉字节（在最终的方框答案中不要包含单位）。",
            "solution": "该问题被认为是有效的，因为它在科学上基于固态物理学，问题表述清晰、客观，并包含求解所需的所有信息。\n\n求解过程分为两部分：首先，我们估算基组中的平面波数量（$N_G$）；其次，我们计算存储波函数系数所需的总内存（$M$）。\n\n**第一部分：平面波数量的估算（$N_G$）**\n\n问题陈述，平面波基组包含所有其平面波动能小于或等于截断能量 $E_{\\text{cut}}$ 的倒易格矢 $\\mathbf{G}$。对于波矢为 $\\mathbf{k} + \\mathbf{G}$ 的平面波，其动能由下式给出：\n$$E_{\\text{kin}} = \\frac{\\hbar^{2}}{2 m_{e}} |\\mathbf{k} + \\mathbf{G}|^{2}$$\n计算在布里渊区的 Γ 点进行，该点对应于 $\\mathbf{k} = \\mathbf{0}$。因此，将倒易格矢 $\\mathbf{G}$ 包含在基组中的条件简化为：\n$$\\frac{\\hbar^{2}}{2 m_{e}} |\\mathbf{G}|^{2} \\leq E_{\\text{cut}}$$\n这个不等式在倒易空间（G空间）中定义了一个以 $\\mathbf{G} = \\mathbf{0}$ 为中心的球体。所有位于该球体内部或其表面上的 $\\mathbf{G}$ 矢量都包含在基组中。该球体的半径，我们记为 $G_{\\text{cut}}$，可通过重新整理该不等式得到：\n$$|\\mathbf{G}|^{2} \\leq \\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}$$\n$$G_{\\text{cut}} = \\sqrt{\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}}$$\n因此，该球体在 G 空间中的体积为：\n$$V_{\\text{sphere}} = \\frac{4}{3}\\pi G_{\\text{cut}}^{3} = \\frac{4}{3}\\pi \\left(\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}\\right)^{3/2}$$\n对于边长为 $L$ 的立方晶胞，倒易格矢由 $\\mathbf{G} = \\frac{2\\pi}{L}\\mathbf{n}$ 给出，其中 $\\mathbf{n} = (n_x, n_y, n_z)$ 是一个整数矢量。这些矢量在 G 空间中形成一个简单立方晶格。这个倒易晶格的原胞体积，代表单个 $\\mathbf{G}$ 矢量所占的体积，是：\n$$V_{\\text{cell}} = \\left(\\frac{2\\pi}{L}\\right)^{3} = \\frac{8\\pi^{3}}{L^{3}}$$\n问题要求我们使用连续近似来估算 $\\mathbf{G}$ 矢量的数量 $N_G$。这通过将球体的总体积除以每个 $\\mathbf{G}$ 矢量的体积来完成。此方法恰当地包含了位于球体中心的 $\\mathbf{G} = \\mathbf{0}$ 矢量。\n$$N_{G} \\approx \\frac{V_{\\text{sphere}}}{V_{\\text{cell}}} = \\frac{\\frac{4}{3}\\pi \\left(\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}\\right)^{3/2}}{\\frac{8\\pi^{3}}{L^{3}}}$$\n简化此表达式可得：\n$$N_{G} \\approx \\frac{4\\pi L^{3}}{3 \\cdot 8\\pi^{3}} \\left(\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}\\right)^{3/2} = \\frac{L^{3}}{6\\pi^{2}} \\left(\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}}\\right)^{3/2}$$\n现在，我们代入给定的物理常数和国际单位制（SI）参数。我们使用标准转换 $1\\,\\text{\\AA} = 10^{-10}\\,\\text{m}$。\n- $L = 15\\,\\text{\\AA} = 15 \\times 10^{-10}\\,\\text{m}$\n- $E_{\\text{cut}} = 400\\,\\text{eV} = 400 \\times 1.602176634 \\times 10^{-19}\\,\\text{J} = 6.408706536 \\times 10^{-17}\\,\\text{J}$\n- $\\hbar = 1.054571817 \\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$\n- $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\text{kg}$\n\n首先，我们计算括号内的项：\n$$\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}} = \\frac{2 \\times (9.1093837015 \\times 10^{-31}\\,\\text{kg}) \\times (6.408706536 \\times 10^{-17}\\,\\text{J})}{(1.054571817 \\times 10^{-34}\\,\\text{J}\\cdot\\text{s})^{2}}$$\n$$\\frac{2 m_{e} E_{\\text{cut}}}{\\hbar^{2}} \\approx \\frac{1.16773344 \\times 10^{-46}}{1.11212263 \\times 10^{-68}}\\,\\text{m}^{-2} \\approx 1.05000342 \\times 10^{22}\\,\\text{m}^{-2}$$\n现在我们可以计算 $N_G$：\n$$N_{G} \\approx \\frac{(15 \\times 10^{-10}\\,\\text{m})^{3}}{6\\pi^{2}} \\left(1.05000342 \\times 10^{22}\\,\\text{m}^{-2}\\right)^{3/2}$$\n$$N_{G} \\approx \\frac{3.375 \\times 10^{-27}\\,\\text{m}^{3}}{59.217626} \\left(1.0760431 \\times 10^{33}\\,\\text{m}^{-3}\\right)$$\n$$N_{G} \\approx (5.69910 \\times 10^{-29}\\,\\text{m}^{3}) \\times (1.0760431 \\times 10^{33}\\,\\text{m}^{-3})$$\n$$N_{G} \\approx 61325.8$$\n四舍五入到三位有效数字，我们得到 $N_{G} \\approx 61300$，即 $6.13 \\times 10^{4}$。\n\n**第二部分：总内存的估算（$M$）**\n\n存储平面波系数所需的总内存取决于能带数（$N_b$）、每个能带的平面波基函数数量（$N_G$）以及存储单个系数所需的内存。\n\n每个能带的波函数在平面波基组中展开。对于单个 $\\mathbf{k}$ 点的非自旋极化计算，我们需要为 $N_b$ 个能带中的每一个存储 $N_G$ 个复数系数。问题说明未使用对称性来减少存储空间。\n需要存储的系数总数为 $N_{\\text{coeffs}} = N_{b} \\times N_{G}$。\n已知：\n- 能带数，$N_{b} = 600$。\n- 平面波数量，$N_{G} \\approx 61325.8$。\n- 每个复数系数的内存 = $16\\,\\text{bytes}$。\n\n以字节为单位的总内存为：\n$$M_{\\text{bytes}} = N_{b} \\times N_{G} \\times 16\\,\\text{bytes/coeff}$$\n$$M_{\\text{bytes}} = 600 \\times 61325.8 \\times 16 = 588727680\\,\\text{bytes}$$\n问题指定使用转换 $1\\,\\text{GB} = 10^{9}\\,\\text{bytes}$。\n$$M = \\frac{M_{\\text{bytes}}}{10^{9}} = \\frac{588727680}{10^{9}}\\,\\text{GB} = 0.58872768\\,\\text{GB}$$\n四舍五入到三位有效数字，我们得到：\n$$M \\approx 0.589\\,\\text{GB}$$\n\n最终答案是四舍五入到三位有效数字的值对 $(N_G, M)$。\n$N_G \\approx 6.13 \\times 10^{4}$\n$M \\approx 0.589$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n6.13 \\times 10^{4}  0.589\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "定义好基组后，下一步是确保布里渊区积分的准确性。这项实践将演示如何为金属体系估算所需的 k 点网格密度，在金属体系中，费米面的尖锐特征使得 k 点取样成为一个关键的收敛参数。通过使用简单的自由电子模型，您将推导出期望的能量精度与必要的 k 点网格密度之间的关系。",
            "id": "3894559",
            "problem": "给定一个假设的单价简立方金属，其原胞中含有一个原子，并在零温下具有类自由电子的导带。考虑一个尺寸为 $S \\times S \\times S$ 的三维周期性超胞，它由晶格常数为 $a$ 的原胞构成。我们使用一个三维Monkhorst-Pack (MP) 网格对布里渊区进行采样，总$\\mathbf{k}$点数为 $N_k = N_{\\text{side}}^3$，其中 $N_{\\text{side}}$ 是每个倒易方向上的点数。您的任务是从第一性原理出发，估算所需的最小整数 $N_k$，以确保费米能 $E_F$ 在目标容差 $\\delta E_F$（单位为电子伏特）内收敛。这个估算值应表示为超胞尺寸 $S$、晶格常数 $a$（单位为埃）和每原子价电子数 $z$ 的函数。\n\n该估算必须从基本定义和经过充分检验的公式开始：\n- 使用布洛赫定理和简立方晶格第一布里渊区的定义，其在每个方向上的倒易晶格间距为 $2\\pi/a$。\n- 在零温下，将能带建模为自由电子色散关系 $E(\\mathbf{k}) = \\hbar^2 |\\mathbf{k}|^2 / (2m_e)$，其中 $\\hbar$ 是约化普朗克常数，$m_e$ 是电子质量。\n- 使用电子数密度与费米波矢之间的标准关系，$n = z/a^3$ 和 $k_F = (3\\pi^2 n)^{1/3}$。\n- 将占据态指示函数在 $\\mathbf{k}$ 空间上的积分解释为在 MP 网格上的黎曼和，并将倒易空间中的离散化间距与超胞尺寸 $S$ 和 $N_{\\text{side}}$ 的共同作用联系起来。\n- 基于这些原理，推导出费米能误差 $\\delta E_F$ 相对于倒易空间网格间距的标度关系，并通过反演该关系式来获得满足指定容差 $\\delta E_F$ 所需的最小 $N_{\\text{side}}$，进而得到所需的最小总 $\\mathbf{k}$ 点数 $N_k = N_{\\text{side}}^3$。\n\n最终的程序必须使用国际单位制中的物理常数对该估算进行数值实现，并报告以下测试套件的整数 $N_k$。所有能量必须以电子伏特表示，所有长度以埃表示，本问题中不使用角度。最终输出必须是单行，包含一个用方括号括起来的逗号分隔的结果列表，顺序与测试套件一致。\n\n测试套件：\n1. $a = 3.000$ 埃，$z = 1$，$S = 1$，$\\delta E_F = 0.500$ 电子伏特。\n2. $a = 3.000$ 埃，$z = 1$，$S = 4$，$\\delta E_F = 0.500$ 电子伏特。\n3. $a = 3.000$ 埃，$z = 1$，$S = 2$，$\\delta E_F = 0.200$ 电子伏特。\n4. $a = 2.500$ 埃，$z = 2$，$S = 2$，$\\delta E_F = 0.300$ 电子伏特。\n5. $a = 3.500$ 埃，$z = 1$，$S = 8$，$\\delta E_F = 0.200$ 电子伏特。\n6. $a = 3.000$ 埃，$z = 1$，$S = 20$，$\\delta E_F = 1.000$ 电子伏特。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[n_1,n_2,n_3,n_4,n_5,n_6]$），其中每个 $n_i$ 是相应测试用例所需的最小整数总 $\\mathbf{k}$ 点数 $N_k$。不应打印任何其他输出。",
            "solution": "该问题被评估为有效，因为它科学上基于固态物理学原理，问题陈述清晰、客观且内部一致。它代表了计算材料科学中的一个标准估算问题。\n\n任务是推导出一个估算公式，用于计算将简立方金属的费米能 $E_F$ 收敛到容差 $\\delta E_F$ 以内所需的最小 $\\mathbf{k}$ 点数 $N_k$。该推导基于自由电子模型和对布里渊区的 Monkhorst-Pack (MP) 网格采样。\n\n首先，我们建立基本关系。该体系是一个简立方金属，晶格常数为 $a$，每个原胞有 $z$ 个价电子。因此，电子数密度 $n$ 为 $n = z/a^3$。在零温（$T=0$）的自由电子气模型中，被占据的电子态在倒易空间中填充一个半径为 $k_F$ 的球体，即费米球。$n$ 和 $k_F$ 之间的关系由下式给出：\n$$ n = \\frac{k_F^3}{3\\pi^2} $$\n这考虑了每个 $\\mathbf{k}$ 矢量对应的两个自旋态。代入 $n$ 的表达式，我们得到费米波矢：\n$$ k_F = \\left(\\frac{3\\pi^2 z}{a^3}\\right)^{1/3} $$\n能带结构由自由电子色散关系 $E(\\mathbf{k}) = \\frac{\\hbar^2 |\\mathbf{k}|^2}{2m_e}$ 给出，其中 $\\hbar$ 是约化普朗克常数，$m_e$ 是电子质量。精确的费米能是费米球面上的能量：\n$$ E_F = E(k_F) = \\frac{\\hbar^2 k_F^2}{2m_e} $$\n接下来，我们考虑计算设置。我们使用一个尺寸为 $S \\times S \\times S$ 的周期性超胞，其实空间晶格常数为 $L = Sa$。该超胞的倒易晶格矢量的特征长度为 $2\\pi/L = 2\\pi/(Sa)$。超胞的第一布里渊区（BZ）是一个边长为 $2\\pi/(Sa)$ 的立方体。该布里渊区由一个 $N_{\\text{side}} \\times N_{\\text{side}} \\times N_{\\text{side}}$ 的 MP 网格进行采样。$\\mathbf{k}$ 点网格中沿每个笛卡尔方向的相邻点间距是均匀的：\n$$ \\Delta k = \\frac{2\\pi/(Sa)}{N_{\\text{side}}} = \\frac{2\\pi}{S a N_{\\text{side}}} $$\n$\\mathbf{k}$ 空间的离散化意味着费米面没有被完美地表示。计算出的费米能 $E_F^{\\text{calc}}$ 是最高占据离散 $\\mathbf{k}$ 态的能量。误差 $\\delta E_F = |E_F - E_F^{\\text{calc}}|$ 的产生是因为离散的 k 点并不完美地落在理想的费米球面上。对此能量误差的一个稳健估计是考虑能量在 $\\mathbf{k}$ 空间中一个特征距离上的变化，该距离与网格间距 $\\Delta k$ 的量级相同。\n\n能量相对于波矢大小 $k=|\\mathbf{k}|$ 的变化由群速度关系给出：\n$$ \\frac{dE}{dk} = \\frac{d}{dk}\\left( \\frac{\\hbar^2 k^2}{2m_e} \\right) = \\frac{\\hbar^2 k}{m_e} $$\n最大能量误差将出现在费米面附近的态，其中 $k \\approx k_F$。能量误差 $\\delta E_F$ 可以通过一阶泰勒展开来近似：\n$$ \\delta E_F \\approx \\left| \\frac{dE}{dk} \\right|_{k=k_F} \\delta k $$\n其中 $\\delta k$ 是 $\\mathbf{k}$ 空间中的有效离散化长度。我们用网格间距 $\\Delta k$ 来近似 $\\delta k$。\n$$ \\delta E_F \\approx \\frac{\\hbar^2 k_F}{m_e} \\Delta k = \\frac{\\hbar^2 k_F}{m_e} \\left( \\frac{2\\pi}{S a N_{\\text{side}}} \\right) $$\n为了满足收敛标准，我们要求网格足够精细，使得这个估算误差小于或等于目标容差，我们也用 $\\delta E_F$ 表示。我们可以重新整理方程，以求解每个维度所需的网格点数 $N_{\\text{side}}$：\n$$ N_{\\text{side}} \\ge \\frac{2\\pi \\hbar^2 k_F}{m_e S a \\delta E_F} $$\n代入 $k_F = (3\\pi^2 z / a^3)^{1/3}$ 的表达式：\n$$ N_{\\text{side}} \\ge \\frac{2\\pi \\hbar^2}{m_e S a \\delta E_F} \\left(\\frac{3\\pi^2 z}{a^3}\\right)^{1/3} = \\frac{2\\pi (3\\pi^2 z)^{1/3} \\hbar^2}{m_e S a^2 \\delta E_F} $$\n由于 $N_{\\text{side}}$ 必须是一个整数，我们必须对表达式取上整，以找到满足不等式的最小整数值：\n$$ N_{\\text{side, min}} = \\left\\lceil \\frac{2\\pi (3\\pi^2 z)^{1/3} \\hbar^2}{m_e S a^2 \\delta E_F} \\right\\rceil $$\n总 $\\mathbf{k}$ 点数是 $N_k = N_{\\text{side}}^3$。因此，所需的最小 $\\mathbf{k}$ 点数是：\n$$ N_k = \\left( N_{\\text{side, min}} \\right)^3 = \\left( \\left\\lceil \\frac{2\\pi (3\\pi^2 z)^{1/3} \\hbar^2}{m_e S a^2 \\delta E_F} \\right\\rceil \\right)^3 $$\n该公式将进行数值实现。在计算中，所有输入参数（$a$, $\\delta E_F$）必须转换为国际单位制单位（分别为米和焦耳），并且必须使用物理常数 $\\hbar$ 和 $m_e$ 的国际单位制数值。每个测试用例的最终结果是整数 $N_k$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Calculates the minimal number of k-points for a set of test cases\n    based on a derived first-principles estimate.\n    \"\"\"\n\n    # Physical constants in SI units from scipy.constants\n    # Reduced Planck constant in J·s\n    HBAR = constants.hbar\n    # Electron mass in kg\n    M_E = constants.m_e\n    # Elementary charge in C (for eV to J conversion)\n    E_CHARGE = constants.e\n    # Pi\n    PI = constants.pi\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (a, z, S, dE_F)\n    # a: lattice constant in angstrom\n    # z: valence electrons per atom\n    # S: supercell size factor\n    # dE_F: Fermi energy tolerance in electronvolts\n    test_cases = [\n        (3.000, 1, 1, 0.500),\n        (3.000, 1, 4, 0.500),\n        (3.000, 1, 2, 0.200),\n        (2.500, 2, 2, 0.300),\n        (3.500, 1, 8, 0.200),\n        (3.000, 1, 20, 1.000),\n    ]\n\n    results = []\n    \n    def estimate_nk(a_angstrom, z, S, dE_F_ev):\n        \"\"\"\n        Estimates the minimal integer N_k = N_side^3 required to meet the \n        Fermi energy convergence tolerance.\n\n        Args:\n            a_angstrom (float): Lattice constant in angstroms.\n            z (int): Valence electrons per atom.\n            S (int): Supercell size factor.\n            dE_F_ev (float): Fermi energy tolerance in eV.\n\n        Returns:\n            int: The minimal total number of k-points, N_k.\n        \"\"\"\n        # Convert inputs to SI units\n        # Angstrom to meters\n        a_si = a_angstrom * 1e-10\n        # Electronvolts to Joules\n        dE_F_si = dE_F_ev * E_CHARGE\n\n        # Calculate the expression for N_side based on the derived formula:\n        # N_side >= (2*pi * (3*pi^2*z)^(1/3) * hbar^2) / (m_e * S * a^2 * dE_F)\n        \n        # Numerator of the expression\n        term_z = (3 * PI**2 * z)**(1/3)\n        numerator = 2 * PI * term_z * HBAR**2\n        \n        # Denominator of the expression\n        denominator = M_E * S * a_si**2 * dE_F_si\n        \n        # Calculate the floating-point value for N_side\n        if denominator == 0:\n            # Avoid division by zero, although not expected for the problem's constraints\n            return float('inf') \n            \n        n_side_float = numerator / denominator\n        \n        # The minimal integer N_side must be the ceiling of this value\n        n_side_min = int(np.ceil(n_side_float))\n        \n        # Total k-points N_k is N_side^3\n        nk = n_side_min**3\n        \n        return nk\n\n    for case in test_cases:\n        a, z, S, dE_F = case\n        result = estimate_nk(a, z, S, dE_F)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "即使使用了足够的基组和 k 点网格，实现自洽收敛也可能充满挑战，特别是对于容易出现“电荷振荡”不稳定性的金属体系。最后一个练习深入探讨了这种数值问题的物理根源（即库仑相互作用的长程性），并探讨了如何使用预处理技术设计稳健的混合方案。理解这些概念是成功模拟催化金属表面和其他挑战性材料的关键。",
            "id": "3894556",
            "problem": "在用于周期性体系的平面波密度泛函理论 (DFT) 中，自洽场 (SCF) 迭代会不断更新电子密度 $n(\\mathbf{r})$ 直至收敛。考虑一个带有吸附物的催化金属板，该体系在三维周期性边界条件下，使用平面波基组和均匀背景电荷中和进行建模。在金属的 SCF 计算中，当密度残差的长波傅里叶分量通过库仑核强耦合时，常常会出现电荷振荡不稳定性。从静电学中的泊松方程和线性电子响应图像出发，分析为何密度残差的小波矢分量会破坏金属体系中朴素线性混合的稳定性，并阐述基于物理动机的预处理如何缓解此问题。\n\n使用以下基本依据：\n\n- 实空间中的泊松方程 $\\nabla^2 v_{\\mathrm{H}}(\\mathbf{r}) = - 4 \\pi \\delta n(\\mathbf{r})$，及其倒易空间形式 $\\delta v_{\\mathrm{H}}(\\mathbf{G}) = \\dfrac{4 \\pi}{G^2} \\, \\delta n(\\mathbf{G})$，其中 $v_{\\mathrm{H}}$ 是 Hartree 势，$\\delta n(\\mathbf{G})$ 表示在倒易格矢 $\\mathbf{G}$ 处密度误差模式的傅里叶分量。\n- 倒易空间中的静态线性响应关系 $\\delta n(\\mathbf{G}) = \\chi(\\mathbf{G}) \\, \\delta v_{\\mathrm{eff}}(\\mathbf{G})$，其中 $\\delta v_{\\mathrm{eff}}(\\mathbf{G})$ 是有效势变化，$\\chi(\\mathbf{G})$ 是密度响应函数。\n- 对于一个简单的金属屏蔽模型，静态介电函数可近似为类 Thomas–Fermi 形式 $\\epsilon(\\mathbf{G}) \\approx 1 + k_s^2/G^2$，其中 $k_s$ 是该金属的特征屏蔽波矢。\n\n假设朴素线性密度混合通过 $n^{(k+1)}(\\mathbf{r}) = n^{(k)}(\\mathbf{r}) + \\alpha \\left[n_{\\mathrm{out}}^{(k)}(\\mathbf{r}) - n_{\\mathrm{in}}^{(k)}(\\mathbf{r})\\right]$ 更新输入密度，其中 $\\alpha$ 是一个标量混合参数，残差 $r^{(k)}(\\mathbf{r}) = n_{\\mathrm{out}}^{(k)}(\\mathbf{r}) - n_{\\mathrm{in}}^{(k)}(\\mathbf{r})$ 在第 $k$ 次迭代中形成。在倒易空间中，每个误差模式的演化近似为 $\\delta n^{(k+1)}(\\mathbf{G}) \\approx \\lambda(\\mathbf{G}) \\, \\delta n^{(k)}(\\mathbf{G})$，其中 $\\lambda(\\mathbf{G})$ 取决于 $\\alpha$、$\\chi(\\mathbf{G})$ 和库仑核。该板层几何结构包含沿表面法线方向的较大真空层，并且金属屏蔽主要发生在平面内。\n\n(a) 从所述基本依据出发，解释在金属中若不使用预处理且 $\\alpha$ 不足够小，为何对于小 $G$ 值，$\\lambda(\\mathbf{G})$ 的幅值会大于 $1$。概述电荷振荡的物理机制，以及库仑核和金属介电屏蔽在这种不稳定性中所起的作用。\n\n(b) 解释为何一个近似于 $1/\\epsilon(\\mathbf{G})$ 的倒易空间预处理器能够抑制残差中有问题的长波分量，并阐明在典型的 Pulay 方案中，为何预处理器应施加于密度残差而非 Kohn–Sham 势。\n\n(c) 对于带真空层的金属板，讨论板层几何结构如何促使我们调整预处理器，以避免对垂直于表面的、有物理意义的模式产生过度阻尼，例如，通过区别对待平面内波矢 $\\mathbf{G}_\\parallel$ 和平面外分量。\n\n基于您的推理，选择一个选项，该选项最稳健地将迭代子空间直接求逆法 (DIIS，通常称为 Pulay 混合) 与基于物理动机的预处理相结合，以稳定催化金属板的 SCF 计算，同时保留吸附物附近的短波特征。\n\nA. 在倒易空间中对电子密度残差进行 Pulay (DIIS) 混合，此前先通过 $P(G) = \\dfrac{G^2}{G^2 + k_s^2}$ 对每个傅里叶分量进行预处理，其中 $k_s$ 由 Thomas–Fermi 金属屏蔽理论确定 (例如，$k_s \\approx 1.0 \\, \\mathrm{\\AA}^{-1}$)。使用一个适中的线性混合基底 $\\alpha \\approx 0.1$ 和一个大小为 $m = 6$ 的 DIIS 子空间；对于板层结构，使用平面内波矢大小 $G_\\parallel$ 来计算 $P$，以避免对真空法向模式的过度阻尼。\n\nB. 对 Kohn–Sham 势残差进行 Pulay 混合，不进行预处理，使用一个较大的标量混合参数 $\\alpha = 0.7$ 来快速减少金属中的长波误差，并设置 DIIS 子空间维度为 $m = 2$。\n\nC. 根据 $P(G) = \\dfrac{1}{1 + (G/G_c)^2}$ 对高波矢分量进行阻尼预处理，并设一个小的截断波矢 $G_c$，将其与使用 $\\alpha = 0.3$ 的简单线性密度混合相结合，并省略 Pulay 混合以降低算法复杂性。\n\nD. 使用金属预处理器 $P(G) = \\dfrac{k_s^2}{G^2}$ 来放大长波分量，以便 Pulay 能在预处理后的势残差上高效地处理它们，同时使用 $\\alpha = 0.2$ 和大小为 $m = 8$ 的 DIIS 子空间。",
            "solution": "用户提供了一个关于平面波密度泛函理论 (DFT) 中金属体系自洽场 (SCF) 迭代数值不稳定性的问题陈述。任务是验证该问题陈述的有效性，基于所提供的物理原理进行深入分析，然后评估给出的选项，以确定最稳健的计算策略。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **体系：** 带吸附物的催化金属板。\n- **计算模型：** 三维周期性边界条件，平面波基组，均匀背景电荷中和。\n- **关注现象：** 金属 SCF 迭代过程中的电荷振荡不稳定性，其原因在于密度残差的长波分量通过库仑核产生的强耦合。\n- **基本依据：**\n    - 泊松方程 (实空间)：$\\nabla^2 v_{\\mathrm{H}}(\\mathbf{r}) = - 4 \\pi \\delta n(\\mathbf{r})$\n    - 泊松方程 (倒易空间)：$\\delta v_{\\mathrm{H}}(\\mathbf{G}) = \\dfrac{4 \\pi}{G^2} \\, \\delta n(\\mathbf{G})$\n    - 静态线性响应：$\\delta n(\\mathbf{G}) = \\chi(\\mathbf{G}) \\, \\delta v_{\\mathrm{eff}}(\\mathbf{G})$\n    - 金属介电函数模型：$\\epsilon(\\mathbf{G}) \\approx 1 + k_s^2/G^2$\n- **算法细节：**\n    - 朴素线性混合：$n^{(k+1)}(\\mathbf{r}) = n^{(k)}(\\mathbf{r}) + \\alpha \\left[n_{\\mathrm{out}}^{(k)}(\\mathbf{r}) - n_{\\mathrm{in}}^{(k)}(\\mathbf{r})\\right]$\n    - 误差模式演化：$\\delta n^{(k+1)}(\\mathbf{G}) \\approx \\lambda(\\mathbf{G}) \\, \\delta n^{(k)}(\\mathbf{G})$\n- **体系特定细节：** 板层几何结构包含大真空层；金属屏蔽主要在平面内。\n- **提出的问题：** 问题要求解释 (a) SCF 不稳定性的起源 ($|\\lambda(\\mathbf{G})| > 1$)，(b) 基于 $\\epsilon(\\mathbf{G})$ 的预处理器的作用，以及 (c) 针对板层几何的调整，最后要求选择最佳算法选项。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学上可靠：** 该问题牢固地植根于成熟的凝聚态物理学和计算材料科学的标准数值方法。电荷振荡、线性响应、介电屏蔽 (Thomas-Fermi 模型) 和 SCF 混合方案 (线性混合, DIIS/Pulay) 等概念是该领域的基石。所提供的方程均为标准方程。\n- **良构性：** 该问题是良构的。它提出了一个清晰的物理情景和一组数学关系，可以据此构建合理的分析。其目标是从一组选项中找出物理上最合理、算法上最稳健的程序，这是一个定义明确的任务。\n- **客观性：** 语言技术性强、精确，没有主观或模棱两可的术语。\n\n**步骤 3：结论与行动**\n该问题陈述在科学上是合理的、良构的且客观的。它不包含矛盾、缺失信息或伪科学声明。该情景是计算催化领域一个现实而重要的挑战。因此，该问题是 **有效的**。我们可以继续进行解答。\n\n### 推导与分析\n\n问题的核心在于理解在一个 SCF 迭代步中，从输入密度微扰 $\\delta n_{\\mathrm{in}}$到输出密度微扰 $\\delta n_{\\mathrm{out}}$ 的映射。迭代循环的稳定性由将一步误差映射到下一步误差的算符的本征值决定。\n\n**(a) 不稳定性机制 (电荷振荡)**\n\n令自洽密度为 $n_{sc}$。在第 $k$ 次迭代时，我们使用输入密度 $n_{\\mathrm{in}}^{(k)} = n_{sc} + \\delta n_{\\mathrm{in}}^{(k)}$。这会产生一个有效势的变化 $\\delta v_{\\mathrm{eff}}$。在线性响应图像中，该变化由 Hartree 势和交换关联 (xc) 势的响应组成：\n$$ \\delta v_{\\mathrm{eff}}(\\mathbf{G}) = \\delta v_{\\mathrm{H}}(\\mathbf{G}) + \\delta v_{\\mathrm{xc}}(\\mathbf{G}) $$\n对 Hartree 部分使用泊松方程，对交换关联部分使用局域/半局域近似 $\\delta v_{\\mathrm{xc}}(\\mathbf{G}) \\approx f_{\\mathrm{xc}}(\\mathbf{G}) \\delta n_{\\mathrm{in}}(\\mathbf{G})$，我们得到：\n$$ \\delta v_{\\mathrm{eff}}(\\mathbf{G}) = \\left( \\frac{4\\pi}{G^2} + f_{\\mathrm{xc}}(\\mathbf{G}) \\right) \\delta n_{\\mathrm{in}}(\\mathbf{G}) $$\n体系的电子结构响应于此势变化，产生一个输出密度。输出密度和有效势之间的关系由独立粒子极化率 $\\chi_0(\\mathbf{G})$ 给出：\n$$ \\delta n_{\\mathrm{out}}(\\mathbf{G}) = \\chi_0(\\mathbf{G}) \\delta v_{\\mathrm{eff}}(\\mathbf{G}) $$\n将这些结合起来得到雅可比矩阵 $J(\\mathbf{G}) = \\delta n_{\\mathrm{out}}(\\mathbf{G}) / \\delta n_{\\mathrm{in}}(\\mathbf{G})$：\n$$ J(\\mathbf{G}) = \\chi_0(\\mathbf{G}) \\left( \\frac{4\\pi}{G^2} + f_{\\mathrm{xc}}(\\mathbf{G}) \\right) $$\n总介电函数 $\\epsilon(\\mathbf{G})$ 定义为 $\\epsilon(\\mathbf{G}) = 1 - J(\\mathbf{G})$。因此，$J(\\mathbf{G}) = 1 - \\epsilon(\\mathbf{G})$。\n\n在使用参数 $\\alpha$ 的朴素线性混合下，误差演化如下：\n$$ \\delta n_{\\mathrm{in}}^{(k+1)} = \\delta n_{\\mathrm{in}}^{(k)} + \\alpha (\\delta n_{\\mathrm{out}}^{(k)} - \\delta n_{\\mathrm{in}}^{(k)}) = [ (1-\\alpha)I + \\alpha J ] \\delta n_{\\mathrm{in}}^{(k)} $$\n每个模式 $\\mathbf{G}$ 的放大因子是相应的本征值：\n$$ \\lambda(\\mathbf{G}) = 1 - \\alpha + \\alpha J(\\mathbf{G}) = 1 - \\alpha + \\alpha (1 - \\epsilon(\\mathbf{G})) = 1 - \\alpha \\epsilon(\\mathbf{G}) $$\n对于金属，电子屏蔽在长波 ($\\mathbf{G} \\to \\mathbf{0}$) 情况下极其有效。所给的 Thomas-Fermi 模型给出 $\\epsilon(\\mathbf{G}) \\approx 1 + k_s^2/G^2$。当 $G \\to 0$ 时，$\\epsilon(\\mathbf{G}) \\approx k_s^2/G^2 \\gg 1$。\n放大因子变为：\n$$ \\lambda(\\mathbf{G}) \\approx 1 - \\alpha \\frac{k_s^2}{G^2} \\approx -\\alpha \\frac{k_s^2}{G^2} $$\n为了收敛，我们需要 $|\\lambda(\\mathbf{G})|  1$。然而，对于任何固定的 $\\alpha > 0$，我们都可以找到一个足够小的 $G$ 使得 $|\\lambda(\\mathbf{G})| = \\alpha k_s^2 / G^2 > 1$。\n$\\lambda(\\mathbf{G})$ 的大的负值意味着一次迭代中的长波密度误差将在下一次迭代中产生一个符号相反且大得多的误差。这就是“电荷振荡”不稳定性：电荷在模拟晶胞的不同区域之间以不断增大的振幅振荡。这种不稳定性是由库仑核 ($4\\pi/G^2$) 在小 $G$ 处的发散驱动的，而混合方案未能充分抑制它。\n\n**(b) 预处理**\n\n为了稳定 SCF，我们必须抑制响应函数的大本征值。这可以通过在混合前对残差 $r^{(k)} = n_{\\mathrm{out}}^{(k)} - n_{\\mathrm{in}}^{(k)}$ 进行预处理来实现。在一个预处理方案中，更新方式是：\n$$ n^{(k+1)} = n^{(k)} + \\alpha P r^{(k)} $$\n修改后的放大因子为 $\\lambda'(\\mathbf{G}) = 1 + \\alpha P(\\mathbf{G}) (J(\\mathbf{G})-1) = 1 - \\alpha P(\\mathbf{G}) \\epsilon(\\mathbf{G})$。\n理想的预处理器应为 $P(\\mathbf{G}) \\approx 1/\\epsilon(\\mathbf{G})$，这将使得 $\\lambda'(\\mathbf{G}) \\approx 1 - \\alpha$。这在 $0  \\alpha  2$ 的范围内是稳定的。\n使用 Thomas-Fermi 模型 $\\epsilon(\\mathbf{G}) \\approx (G^2+k_s^2)/G^2$，理想的预处理器是：\n$$ P(\\mathbf{G}) \\approx \\frac{1}{\\epsilon(\\mathbf{G})} = \\frac{G^2}{G^2 + k_s^2} $$\n这个函数，被称为 Kerker 预处理器，具有所期望的性质：\n- 对于小 $G$ ($G \\ll k_s$)，$P(\\mathbf{G}) \\approx G^2/k_s^2 \\to 0$。它强烈地阻尼残差的长波分量，从而抑制不稳定性。\n- 对于大 $G$ ($G \\gg k_s$)，$P(\\mathbf{G}) \\approx 1$。它不改变短波分量，从而允许局部成键特征的有效收敛。\n\n在 Pulay (DIIS) 混合方案中，算法通过构建先前残差的最优线性组合来外推到自洽解。如果残差被病态振荡的不稳定模式主导 (就像在未预处理的金属中那样)，DIIS 所依赖的线性模型就会失效，算法性能会很差。通过在将密度残差传递给 DIIS 算法*之前*对其应用预处理器 $P$，我们为 DIIS 提供了一组“修正后”的残差，其中有问题的模式已被抑制。然后，DIIS 可以在预处理后残差的良性子空间中有效运作，以加速具有物理意义的电子结构变化的收敛。在密度混合方案中，将预处理器应用于势是错误的，因为 DIIS 是对被混合的输入和输出量之差（在此即为密度）进行操作的。\n\n**(c) 针对板层几何的调整**\n\n对于由真空隔开的板层，电子屏蔽是高度各向异性的。平面内 ($xy$) 的电荷涨落被金属电子有效屏蔽，导致对于小的平面内波矢 $\\mathbf{G}_\\parallel$ 出现电荷振荡不稳定性。然而，垂直于板层的涨落 (沿 $z$ 方向，对应于 $\\mathbf{G}_\\parallel = \\mathbf{0}$) 涉及电荷跨越真空能隙的移动。这个过程没有金属屏蔽，对应于物理变化，例如表面偶极子的形成和功函数的改变。一个简单的各向同性预处理器 $P(G)$ 会错误地阻尼这些有物理意义的 $G_z$ 模式，从而减慢或阻止表面性质的收敛。\n\n一个常见的实用调整是使预处理器仅依赖于平面内波矢的大小 $G_\\parallel = \\sqrt{G_x^2 + G_y^2}$。使用像 $P(G_\\parallel) = \\frac{G_\\parallel^2}{G_\\parallel^2 + k_s^2}$ 这样的预处理器，通过阻尼所有小 $G_\\parallel$ 的模式，专门针对平面内的振荡不稳定性。虽然这也阻尼了 $G_\\parallel=0$ 处的物理模式，但它保证了稳定性。这通常被认为是一个可接受的折衷，因为首要目标是克服数值上的灾难性不稳定性。声称“避免过度阻尼”是指不将三维金属屏蔽模型应用于对表面法向模式而言实际上是二维屏蔽的问题。\n\n### 选项评估\n\n**A. 在倒易空间中对电子密度残差进行 Pulay (DIIS) 混合，此前先通过 $P(G) = \\dfrac{G^2}{G^2 + k_s^2}$ 对每个傅里叶分量进行预处理，其中 $k_s$ 由 Thomas–Fermi 金属屏蔽理论确定 (例如，$k_s \\approx 1.0 \\, \\mathrm{\\AA}^{-1}$)。使用一个适中的线性混合基底 $\\alpha \\approx 0.1$ 和一个大小为 $m = 6$ 的 DIIS 子空间；对于板层结构，使用平面内波矢大小 $G_\\parallel$ 来计算 $P$，以避免对真空法向模式的过度阻尼。**\n- 该选项正确地组合了用于金属板的先进 SCF 方案的所有要素。它对密度残差使用 DIIS，在 DIIS 之前对残差应用正确形式的 Kerker 预处理器，使用了物理上合理的参数 ($k_s$, $\\alpha$, $m$)，并且正确地指出了板层几何结构需要各向异性预处理器，并提出了一个合理的实现方式。结论：**正确**。\n\n**B. 对 Kohn–Sham 势残差进行 Pulay 混合，不进行预处理，使用一个较大的标量混合参数 $\\alpha = 0.7$ 来快速减少金属中的长波误差，并设置 DIIS 子空间维度为 $m = 2$。**\n- 该选项有多个根本性缺陷。它省略了对金属至关重要的预处理。声称大的 $\\alpha$ 会减少长波误差是错误的；它会灾难性地放大这些误差，导致发散。$m=2$ 的子空间也太小了。结论：**错误**。\n\n**C. 根据 $P(G) = \\dfrac{1}{1 + (G/G_c)^2}$ 对高波矢分量进行阻尼预处理，并设一个小的截断波矢 $G_c$，将其与使用 $\\alpha = 0.3$ 的简单线性密度混合相结合，并省略 Pulay 混合以降低算法复杂性。**\n- 该选项提出了一个阻尼高 $G$ 分量（一个低通滤波器）的预处理器，这与解决低 $G$ 电荷振荡不稳定性所需要的恰恰相反。对于任何非平庸的体系，省略 Pulay (DIIS) 混合也是一个糟糕的策略，因为它牺牲了收敛加速的一个主要来源。结论：**错误**。\n\n**D. 使用金属预处理器 $P(G) = \\dfrac{k_s^2}{G^2}$ 来放大长波分量，以便 Pulay 能在预处理后的势残差上高效地处理它们，同时使用 $\\alpha = 0.2$ 和大小为 $m = 8$ 的 DIIS 子空间。**\n- 提议的预处理器 $P(G) \\approx \\epsilon(\\mathbf{G})$ 是正确预处理器的逆。应用它会放大已经不稳定的长波模式，使收敛变得不可能。认为 Pulay 可以“高效处理”无限大的残差的想法是荒谬的。它还错误地提到了对势残差进行预处理。结论：**错误**。\n\n最终结论：选项 A 提供了唯一物理上合理且算法上稳健的策略。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}