{
    "hands_on_practices": [
        {
            "introduction": "在进行周期性体系的电子结构计算时，首要任务之一是设置布里渊区采样的 $k$ 点网格。这个选择并非随意的，它与真实空间超胞的尺寸和形状密切相关。本练习将引导你推导出一个通用方案，将期望的倒易空间分辨率 $\\Delta k$ 映射为 Monkhorst-Pack 网格的具体维度 $(N_x, N_y, N_z)$，这是进行任何可靠计算所需掌握的基本技能 。",
            "id": "3870659",
            "problem": "在计算催化和化学工程领域的催化材料周期性电子结构模拟中，布里渊区 (BZ) 采样是在波矢网格上进行的，通常使用以Gamma点为中心的Monkhorst-Pack (MP) 网格。考虑一个用于模拟密排催化表面的晶体板层，它由三个正格矢 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$ 描述，其长度分别为 $a$、$b$ 和 $c$，轴间角分别为 $\\alpha$（$\\mathbf{b}$ 和 $\\mathbf{c}$ 之间）、$\\beta$（$\\mathbf{a}$ 和 $\\mathbf{c}$ 之间）以及 $\\gamma$（$\\mathbf{a}$ 和 $\\mathbf{b}$ 之间）。倒格矢根据标准晶体学惯例定义为 $\\mathbf{b}_1 = 2\\pi \\, \\frac{\\mathbf{b} \\times \\mathbf{c}}{V}$、$\\mathbf{b}_2 = 2\\pi \\, \\frac{\\mathbf{c} \\times \\mathbf{a}}{V}$ 和 $\\mathbf{b}_3 = 2\\pi \\, \\frac{\\mathbf{a} \\times \\mathbf{b}}{V}$，其中 $V$ 是正格子晶胞的体积。\n\n从这些定义和正格子的几何结构出发，请提出一个逻辑上合理的方案，用于为以Gamma点为中心的Monkhorst-Pack网格选择整数网格尺寸 $(N_x, N_y, N_z)$，以在每个倒易基矢方向上达到目标最大倒易空间分辨率 $\\Delta k$。推导一个从给定的目标 $\\Delta k$ 到整数 $(N_x, N_y, N_z)$ 的通用映射，该映射需保证沿每个倒易基矢方向上相邻采样 $\\mathbf{k}$ 点之间的间距小于或等于 $\\Delta k$，同时保持Gamma点中心。你的方案必须强制要求使用满足分辨率目标的最小奇数，并保证每个方向上至少有一个划分。\n\n然后，将你推导的映射应用于以下常用于表示密排催化剂表面的六方板层几何结构：\n- $a = 2.500$ $\\mathrm{\\AA}$，$b = 2.500$ $\\mathrm{\\AA}$，$c = 15.000$ $\\mathrm{\\AA}$。\n- $\\alpha = 90^\\circ$，$\\beta = 90^\\circ$，$\\gamma = 120^\\circ$。\n- 目标分辨率 $\\Delta k = 0.200$ $\\mathrm{\\AA}^{-1}$。\n角度以度为单位。请将最终的网格尺寸 $(N_x, N_y, N_z)$ 表示为整数，并使用与你的方案一致的最小奇数选择。最终答案必须是一个包含三个整数的单行矩阵，在最终的方框表达式中不带单位。",
            "solution": "首先根据科学正确性、逻辑一致性和完整性原则对问题进行验证。\n\n### 问题验证\n**步骤 1：提取已知条件**\n- **正格子：** 矢量 $\\mathbf{a}$、$\\mathbf{b}$、$\\mathbf{c}$，其长度为 $a$、$b$、$c$，轴间角为 $\\alpha$、$\\beta$、$\\gamma$。\n- **倒格矢：** $\\mathbf{b}_1 = 2\\pi \\, \\frac{\\mathbf{b} \\times \\mathbf{c}}{V}$、$\\mathbf{b}_2 = 2\\pi \\, \\frac{\\mathbf{c} \\times \\mathbf{a}}{V}$、$\\mathbf{b}_3 = 2\\pi \\, \\frac{\\mathbf{a} \\times \\mathbf{b}}{V}$，其中 $V = \\mathbf{a} \\cdot (\\mathbf{b} \\times \\mathbf{c})$ 是正格胞体积。\n- **采样方案：** 以Gamma点为中心的Monkhorst-Pack (MP) 网格，整数网格尺寸为 $(N_x, N_y, N_z)$。\n- **分辨率约束：** 沿每个倒易基矢方向上相邻采样 $\\mathbf{k}$ 点之间的间距必须小于或等于目标分辨率 $\\Delta k$。\n- **整数选择方案：** 整数 $(N_x, N_y, N_z)$ 必须是满足分辨率目标的最小奇数，且必须至少为1。\n- **特定几何结构：** 一个六方板层，其参数为 $a = 2.500$ $\\mathrm{\\AA}$、$b = 2.500$ $\\mathrm{\\AA}$、$c = 15.000$ $\\mathrm{\\AA}$、$\\alpha = 90^\\circ$、$\\beta = 90^\\circ$ 及 $\\gamma = 120^\\circ$。\n- **特定目标分辨率：** $\\Delta k = 0.200$ $\\mathrm{\\AA}^{-1}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题定义明确且在科学上是合理的。\n- **科学依据：** 正格子与倒格子、晶胞体积的定义，以及使用Monkhorst-Pack网格进行布里渊区采样的概念，都是固体物理学和计算材料科学的基本原理。为该晶格提供的数值对于一个表面板层模型是物理上可信的。\n- **适定性：** 该问题提供了推导唯一解所需的所有必要定义、约束和数据。对网格尺寸 $(N_x, N_y, N_z)$ 的要求被明确地指定（满足一个清晰不等式的最小奇数）。\n- **客观性：** 语言精确且定量。没有主观或基于观点的陈述。\n\n**步骤 3：结论与行动**\n该问题被判定为**有效**。将提供一个完整且合理的解答。\n\n### 解答\n解答过程分为两部分。首先，推导确定Monkhorst-Pack网格维度的一般方案。其次，将此方案应用于所提供的特定六方板层几何结构。\n\n**第一部分：一般方案的推导**\nMonkhorst-Pack网格是一个用于在布里渊区采样的均匀 $\\mathbf{k}$ 点网格。对于一个分别沿倒格矢方向 $\\mathbf{b}_1$、$\\mathbf{b}_2$ 和 $\\mathbf{b}_3$ 有 $N_x$、$N_y$ 和 $N_z$ 个划分的网格，采样的 $\\mathbf{k}$ 点集是通过沿这些矢量的分数坐标的线性组合生成的。\n\n沿倒格矢 $\\mathbf{b}_1$ 方向上相邻 $\\mathbf{k}$ 点之间的间距是矢量 $\\frac{1}{N_x}\\mathbf{b}_1$ 的大小，即 $\\frac{|\\mathbf{b}_1|}{N_x}$。设倒格矢的大小为 $b_1 = |\\mathbf{b}_1|$、$b_2 = |\\mathbf{b}_2|$ 和 $b_3 = |\\mathbf{b}_3|$。因此，间距分别为 $\\frac{b_1}{N_x}$、$\\frac{b_2}{N_y}$ 和 $\\frac{b_3}{N_z}$。\n\n问题要求这个间距不大于目标分辨率 $\\Delta k$。这为整数网格尺寸 $N_x, N_y, N_z$ 产生了一组不等式：\n$$\n\\frac{b_1}{N_x} \\le \\Delta k \\implies N_x \\ge \\frac{b_1}{\\Delta k}\n$$\n$$\n\\frac{b_2}{N_y} \\le \\Delta k \\implies N_y \\ge \\frac{b_2}{\\Delta k}\n$$\n$$\n\\frac{b_3}{N_z} \\le \\Delta k \\implies N_z \\ge \\frac{b_3}{\\Delta k}\n$$\n问题进一步要求 $N_x$、$N_y$ 和 $N_z$ 必须是满足这些条件的最小正奇数。正整数的条件保证了至少有一个划分。\n\n确定每个整数 $N_i$（其中 $i \\in \\{x,y,z\\}$）的方案如下：\n1.  计算所需的最小值，$R_i = \\frac{b_i}{\\Delta k}$。\n2.  找到大于或等于 $R_i$ 的最小整数。这通过向上取整函数计算，$M_i = \\lceil R_i \\rceil$。\n3.  如果 $M_i$ 是奇数，则 $N_i = M_i$。\n4.  如果 $M_i$ 是偶数，则必须选择下一个奇数，因此 $N_i = M_i + 1$。\n\n此方案确保满足所有约束条件。\n\n**第二部分：应用于六方板层几何结构**\n首先，我们必须根据给定的正格子参数计算倒格矢的大小 ($b_1, b_2, b_3$)：$a = 2.500$ $\\mathrm{\\AA}$、$b = 2.500$ $\\mathrm{\\AA}$、$c = 15.000$ $\\mathrm{\\AA}$、$\\alpha = 90^\\circ$、$\\beta = 90^\\circ$ 及 $\\gamma = 120^\\circ$。\n\n正格子晶胞的体积 $V$ 由以下公式给出：\n$$\nV = abc \\sqrt{1 - \\cos^2\\alpha - \\cos^2\\beta - \\cos^2\\gamma + 2\\cos\\alpha\\cos\\beta\\cos\\gamma}\n$$\n代入给定的角度，$\\cos(90^\\circ) = 0$ 和 $\\cos(120^\\circ) = -1/2$：\n$$\nV = (2.5)(2.5)(15.0) \\sqrt{1 - 0 - 0 - \\left(-\\frac{1}{2}\\right)^2 + 2(0)(0)\\left(-\\frac{1}{2}\\right)} = 93.75 \\sqrt{1 - \\frac{1}{4}} = 93.75 \\frac{\\sqrt{3}}{2} \\text{ } \\mathrm{\\AA}^3\n$$\n对于 $\\alpha=\\beta=90^\\circ$ 的这些特定角度，体积公式简化为 $V = abc\\sin\\gamma$。\n\n倒格矢的大小由以下公式给出：\n$$\nb_1 = |\\mathbf{b}_1| = \\frac{2\\pi}{V} |\\mathbf{b} \\times \\mathbf{c}| = \\frac{2\\pi bc \\sin\\alpha}{V}\n$$\n$$\nb_2 = |\\mathbf{b}_2| = \\frac{2\\pi}{V} |\\mathbf{c} \\times \\mathbf{a}| = \\frac{2\\pi ca \\sin\\beta}{V}\n$$\n$$\nb_3 = |\\mathbf{b}_3| = \\frac{2\\pi}{V} |\\mathbf{a} \\times \\mathbf{b}| = \\frac{2\\pi ab \\sin\\gamma}{V}\n$$\n代入 $V = abc\\sin\\gamma$ 和给定的角度：\n$$\nb_1 = \\frac{2\\pi bc \\sin(90^\\circ)}{abc\\sin(120^\\circ)} = \\frac{2\\pi (1)}{a\\sin(120^\\circ)} = \\frac{2\\pi}{(2.5)(\\sqrt{3}/2)} = \\frac{4\\pi}{2.5\\sqrt{3}} = \\frac{8\\pi}{5\\sqrt{3}} = \\frac{8\\pi\\sqrt{3}}{15} \\text{ } \\mathrm{\\AA}^{-1}\n$$\n由于 $a=b$ 且 $\\alpha=\\beta$，因此大小 $b_2$ 与 $b_1$ 相同：\n$$\nb_2 = \\frac{2\\pi ca \\sin(90^\\circ)}{abc\\sin(120^\\circ)} = \\frac{2\\pi (1)}{b\\sin(120^\\circ)} = \\frac{8\\pi\\sqrt{3}}{15} \\text{ } \\mathrm{\\AA}^{-1}\n$$\n对于 $b_3$：\n$$\nb_3 = \\frac{2\\pi ab \\sin(120^\\circ)}{abc\\sin(120^\\circ)} = \\frac{2\\pi}{c} = \\frac{2\\pi}{15} \\text{ } \\mathrm{\\AA}^{-1}\n$$\n现在我们应用推导出的方案，目标分辨率为 $\\Delta k = 0.200 = 1/5$ $\\mathrm{\\AA}^{-1}$。\n\n对于 $N_x$：\n$$\nR_x = \\frac{b_1}{\\Delta k} = \\frac{8\\pi\\sqrt{3}/15}{1/5} = \\frac{8\\pi\\sqrt{3}}{3} \\approx 14.518\n$$\n大于或等于 $14.518$ 的最小整数是 $M_x = \\lceil 14.518 \\rceil = 15$。由于 $15$ 是奇数，我们设 $N_x = 15$。\n\n对于 $N_y$：\n$$\nR_y = \\frac{b_2}{\\Delta k} = \\frac{8\\pi\\sqrt{3}/15}{1/5} = \\frac{8\\pi\\sqrt{3}}{3} \\approx 14.518\n$$\n大于或等于 $14.518$ 的最小整数是 $M_y = \\lceil 14.518 \\rceil = 15$。由于 $15$ 是奇数，我们设 $N_y = 15$。\n\n对于 $N_z$：\n$$\nR_z = \\frac{b_3}{\\Delta k} = \\frac{2\\pi/15}{1/5} = \\frac{2\\pi}{3} \\approx 2.094\n$$\n大于或等于 $2.094$ 的最小整数是 $M_z = \\lceil 2.094 \\rceil = 3$。由于 $3$ 是奇数，我们设 $N_z = 3$。\n\n得到的Monkhorst-Pack网格尺寸为 $(N_x, N_y, N_z) = (15, 15, 3)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n15  15  3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "计算的准确性固然重要，但计算成本往往是实际研究中的一个决定性限制因素。对于平面波方法，收敛性主要由平面波截断能 $E_{\\text{cut}}$ 和 $k$ 点数量 $N_k$ 共同决定。本练习通过简化的物理模型，让你探索如何在满足目标能量精度 $\\tau$ 的前提下，寻找成本最低的 $(E_{\\text{cut}}, N_k)$ 参数组合，从而培养系统性进行收敛性测试和优化计算策略的能力 。",
            "id": "3870671",
            "problem": "考虑一个在计算催化和化学工程中常用的周期性金属体系，其中每个晶胞的总能量是使用平面波基组和布里渊区积分计算的。以下是经过充分检验的基本事实和定义：\n\n- 在周期性边界条件下，电子态由Bloch函数描述，每个晶胞的总能量是晶体动量$k$在布里渊区上的积分。数值计算通过对$N_k$个离散$k$点的求和来代替积分，例如通过Monkhorst-Pack网格。对于采用有限温展宽的金属，布里渊区采样的求积误差随点数增加而按代数规律减小，表示为$e_k(N_k) = B N_k^{-q}$，其中$B$和$q$是取决于材料和展宽细节的正常数。\n\n- 在平面波方法中，基组通过能量截断值$E_{\\text{cut}}$（单位为$\\mathrm{eV}$）进行截断，这限制了所包含平面波的最大动能。像总能量这样的光滑可观测量的基组不完备性误差通常随着$E_{\\text{cut}}$的增加而遵循幂律$e_{\\text{pw}}(E_{\\text{cut}}) = A E_{\\text{cut}}^{-p}$减小，其中$A$和$p$为正常数，这反映了光滑函数的傅里叶展开的收敛性质。\n\n- 总能量误差被建模为各个独立贡献之和：$e_{\\text{tot}}(E_{\\text{cut}}, N_k) = e_{\\text{pw}}(E_{\\text{cut}}) + e_k(N_k) = A E_{\\text{cut}}^{-p} + B N_k^{-q}$。\n\n- 计算成本主要由与平面波数量和$k$点数量成比例的操作决定。平面波数量与$E_{\\text{cut}}^{3/2}$成正比，$N_{\\text{pw}} \\propto E_{\\text{cut}}^{3/2}$，因为由$E_{\\text{cut}}$设定的半径球体内的倒格矢数量随倒易空间的体积增长。忽略弱对数因子，一个简单且广泛使用的成本模型是$C(E_{\\text{cut}}, N_k) = \\gamma N_k E_{\\text{cut}}^{s}$，其中$s \\approx 3/2$，$\\gamma$是将操作计数转换为挂钟时间（单位为秒）的比例常数。\n\n你的任务是，对于给定的参数$(A, p, B, q, s, \\gamma)$、一个容差$\\tau$（单位为$\\mathrm{eV}$），以及$E_{\\text{cut}}$和$N_k$的有界离散搜索范围，计算出联合参数选择$(E_{\\text{cut}}, N_k)$，该选择在满足能量误差约束$e_{\\text{tot}}(E_{\\text{cut}}, N_k) \\le \\tau$的同时，最小化计算成本$C(E_{\\text{cut}}, N_k)$。如果在有界搜索空间中没有参数对满足容差，则返回使$e_{\\text{tot}}(E_{\\text{cut}}, N_k)$最小的参数对（即，在界限内可达到的最接近的值），并将该情况标记为不可实现。\n\n算法要求：\n\n- 使用误差模型$e_{\\text{tot}}(E_{\\text{cut}}, N_k) = A E_{\\text{cut}}^{-p} + B N_k^{-q}$。\n\n- 使用成本模型$C(E_{\\text{cut}}, N_k) = \\gamma N_k E_{\\text{cut}}^{s}$。\n\n- 在$E_{\\min}$和$E_{\\max}$（含边界）之间的整数网格上搜索$E_{\\text{cut}}$，单位为$\\mathrm{eV}$，步长为$\\Delta E_{\\text{cut}}$。\n\n- 在$N_{k,\\min}$和$N_{k,\\max}$（含边界）之间的整数范围内搜索$N_k$。\n\n- 如果有多个参数对达到了相同的最小成本（在数值容差范围内），选择$N_k$最小的那个；如果仍然相同，则选择$E_{\\text{cut}}$最小的那个。\n\n单位和输出要求：\n\n- 所有能量必须以$\\mathrm{eV}$为单位处理和报告。\n\n- 计算成本必须以秒为单位报告。\n\n- 对每个测试用例，输出一个列表$[\\text{achievable}, E_{\\text{cut}}^{\\star}, N_k^{\\star}, C^{\\star}]$，其中$\\text{achievable}$是一个布尔值，指示是否满足了容差$\\tau$，$E_{\\text{cut}}^{\\star}$是选定的截断值（单位为$\\mathrm{eV}$，整数），$N_k^{\\star}$是选定的$k$点数（整数），$C^{\\star}$是计算成本（单位为秒，四舍五入到六位小数）。你的程序应生成一行输出，其中包含一个用逗号分隔并包含在方括号中的结果列表（例如，$[ [\\text{True}, 500, 31, 1.733000], [\\text{False}, 900, 128, 4.321000] ]$）。\n\n测试套件：\n\n使用以下四个案例来检验算法：\n\n- 案例1（平衡，中等容差）：\n  - $A = 0.5$, $p = 1.5$, $B = 0.3$, $q = 1.0$, $s = 1.5$, $\\gamma = 5 \\times 10^{-6}$, $\\tau = 0.01$。\n  - $E_{\\min} = 200$, $E_{\\max} = 800$, $\\Delta E_{\\text{cut}} = 10$。\n  - $N_{k,\\min} = 6$, $N_{k,\\max} = 60$。\n\n- 案例2（严格容差，在界限内可能不可行）：\n  - $A = 0.8$, $p = 1.5$, $B = 0.5$, $q = 1.0$, $s = 1.5$, $\\gamma = 7 \\times 10^{-6}$, $\\tau = 0.001$。\n  - $E_{\\min} = 300$, $E_{\\max} = 900$, $\\Delta E_{\\text{cut}} = 10$。\n  - $N_{k,\\min} = 8$, $N_{k,\\max} = 128$。\n\n- 案例3（宽松容差，基组误差相对于$k$点采样误差较小）：\n  - $A = 1.0$, $p = 1.2$, $B = 0.2$, $q = 1.0$, $s = 1.5$, $\\gamma = 4 \\times 10^{-6}$, $\\tau = 0.05$。\n  - $E_{\\min} = 200$, $E_{\\max} = 600$, $\\Delta E_{\\text{cut}} = 10$。\n  - $N_{k,\\min} = 4$, $N_{k,\\max} = 20$。\n\n- 案例4（$k$点误差占主导，且具有稍高的平滑指数）：\n  - $A = 0.1$, $p = 1.5$, $B = 1.0$, $q = 1.2$, $s = 1.5$, $\\gamma = 6 \\times 10^{-6}$, $\\tau = 0.02$。\n  - $E_{\\min} = 300$, $E_{\\max} = 800$, $\\Delta E_{\\text{cut}} = 10$。\n  - $N_{k,\\min} = 10$, $N_{k,\\max} = 100$。\n\n你的程序必须为每个案例实现上述搜索和选择策略，并按规定生成包含四个列表的单行聚合输出。所有数值报告必须遵守指定的单位，并且$C^{\\star}$必须四舍五入到六位小数。",
            "solution": "该问题已被验证，并被确定为计算材料科学领域内一个适定的、有科学依据的、客观的优化任务。它没有任何使其无效的缺陷。\n\n任务是找到最优的计算参数——平面波能量截断值$E_{\\text{cut}}$和$k$点数$N_k$——在确保总能量误差$e_{\\text{tot}}$低于指定容差$\\tau$的同时，最小化计算成本$C$。该问题为误差和成本提供了具有物理动机的代数模型，它们都是$E_{\\text{cut}}$和$N_k$的函数。\n\n总误差被建模为两个独立贡献之和：\n$$ e_{\\text{tot}}(E_{\\text{cut}}, N_k) = e_{\\text{pw}}(E_{\\text{cut}}) + e_k(N_k) = A E_{\\text{cut}}^{-p} + B N_k^{-q} $$\n其中$e_{\\text{pw}}$是基组不完备性误差，$e_k$是布里渊区采样误差。参数$A, p, B, q$是特定于该材料体系的正常数。\n\n计算成本被建模为：\n$$ C(E_{\\text{cut}}, N_k) = \\gamma N_k E_{\\text{cut}}^{s} $$\n其中$s \\approx 3/2$，$\\gamma$是一个比例常数。\n\n最优对$(E_{\\text{cut}}, N_k)$的搜索将在一个有限的离散网格上进行。$E_{\\text{cut}}$在从$E_{\\min}$到$E_{\\max}$的整数网格上以$\\Delta E_{\\text{cut}}$为步长进行搜索。$N_k$在从$N_{k,\\min}$到$N_{k,\\max}$的整数范围内搜索。鉴于对于提供的测试用例，搜索空间是有限的且不是过大，全面的暴力网格搜索是最直接和稳健的算法。这种方法保证能找到离散空间内的真实最优解，避免了更复杂的优化方案可能因考虑离散化效应时目标函数的非光滑或非单调性质而遇到的潜在陷阱。\n\n对于每个测试用例，算法流程如下：\n1.  在指定的离散范围内生成所有可能的对$(E_{\\text{cut}}, N_k)$。\n2.  对每一对，计算总误差$e_{\\text{tot}}$和计算成本$C$。\n3.  将结果解分为两组：\n    a. `valid_solutions`：满足误差约束$e_{\\text{tot}} \\le \\tau$的参数对。\n    b. `all_solutions`：所有参数对，存储其计算出的误差和成本。该集合用于后备情况。\n4.  根据是否找到任何有效解来确定最终选择：\n    a. 如果`valid_solutions`不为空，则容差是可实现的。最优对通过对此列表进行排序以找到成本最小的那个来确定。问题指定了明确的平局打破规则：如果成本相等，则优先选择$N_k$较小的对；如果仍然平局，则选择$E_{\\text{cut}}$较小的那个。这通过使用元组$(C, N_k, E_{\\text{cut}})$作为键对有效解进行字典序排序来实现。\n    b. 如果`valid_solutions`为空，则容差是不可实现的。在这种情况下，要求是返回使总误差$e_{\\text{tot}}$最小的参数对。对于这种情况，一个合理且一致的平局打破方案（尽管在这种情况下没有明确说明）是从具有最小误差的参数对中选择成本最低的，然后是$N_k$最低的，再然后是$E_{\\text{cut}}$最低的。这通过使用键$(e_{\\text{tot}}, C, N_k, E_{\\text{cut}})$对`all_solutions`进行字典序排序来实现。\n5.  然后构造该案例的最终结果$[\\text{achievable}, E_{\\text{cut}}^{\\star}, N_k^{\\star}, C^{\\star}]$，其中成本$C^{\\star}$按要求四舍五入到六位小数。布尔值`achievable`在第一种情况下设置为`True`，在第二种情况下设置为`False`。\n此过程应用于每个测试用例，并将结果聚合为单个列表的列表作为最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the optimal (E_cut, N_k) pair for a series of test cases based on\n    minimizing computational cost under an energy error constraint.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (balanced, moderate tolerance)\n        {\n            \"params\": (0.5, 1.5, 0.3, 1.0, 1.5, 5e-6, 0.01),\n            \"E_range\": (200, 800, 10),\n            \"Nk_range\": (6, 60)\n        },\n        # Case 2 (tight tolerance, likely infeasible)\n        {\n            \"params\": (0.8, 1.5, 0.5, 1.0, 1.5, 7e-6, 0.001),\n            \"E_range\": (300, 900, 10),\n            \"Nk_range\": (8, 128)\n        },\n        # Case 3 (loose tolerance, basis error small)\n        {\n            \"params\": (1.0, 1.2, 0.2, 1.0, 1.5, 4e-6, 0.05),\n            \"E_range\": (200, 600, 10),\n            \"Nk_range\": (4, 20)\n        },\n        # Case 4 (dominant k-point error)\n        {\n            \"params\": (0.1, 1.5, 1.0, 1.2, 1.5, 6e-6, 0.02),\n            \"E_range\": (300, 800, 10),\n            \"Nk_range\": (10, 100)\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        A, p, B, q, s, gamma, tau = case[\"params\"]\n        E_min, E_max, dE = case[\"E_range\"]\n        Nk_min, Nk_max = case[\"Nk_range\"]\n\n        E_cut_values = np.arange(E_min, E_max + 1, dE)\n        Nk_values = range(Nk_min, Nk_max + 1)\n\n        valid_solutions = []\n        all_solutions = []\n\n        for E_cut in E_cut_values:\n            # Pre-calculate E_cut dependent parts\n            e_pw = A * E_cut**(-p)\n            cost_factor_E = gamma * E_cut**s\n\n            for N_k in Nk_values:\n                # Calculate total error\n                e_k = B * N_k**(-q)\n                e_tot = e_pw + e_k\n\n                # Calculate computational cost\n                cost = cost_factor_E * N_k\n\n                # Store all solutions for fallback scenario\n                all_solutions.append((e_tot, cost, N_k, E_cut))\n                \n                # Check constraint and store valid solutions\n                if e_tot = tau:\n                    valid_solutions.append((cost, N_k, E_cut))\n\n        if valid_solutions:\n            achievable = True\n            # Sort by cost, then N_k, then E_cut\n            valid_solutions.sort()\n            C_star, Nk_star, E_cut_star = valid_solutions[0]\n        else:\n            achievable = False\n            # Sort by error, then cost, then N_k, then E_cut\n            all_solutions.sort()\n            e_min, C_star, Nk_star, E_cut_star = all_solutions[0]\n        \n        results.append([achievable, E_cut_star, Nk_star, C_star])\n\n    def format_result(res):\n        ach, E, N, C = res\n        # Format with capital True/False and 6 decimal places for cost\n        return f\"[{str(ach)}, {E}, {N}, {C:.6f}]\"\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(format_result, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "绘制沿高对称路径的能带结构是分析材料电子性质的标准流程，但这种一维采样是否总能捕捉到体系的全部关键特征？本练习构建了一个解析能带模型，用以揭示能带的全局极值点（如导带底或价带顶）可能并不位于高对称线上。通过对比路径采样和全布里渊区网格采样的结果，你将亲身体会到仅依赖高对称路径可能带来的误导，并理解进行全面布里渊区分析的重要性 。",
            "id": "3870639",
            "problem": "考虑一个二维晶体催化剂，其模型为一个方形布拉菲晶格，实空间晶格常数为 $a$，且在每个笛卡尔方向上的倒易晶格矢量大小为 $2\\pi/a$。根据布洛赫定理，单电子能带能量可以表示为函数 $E_n(\\mathbf{k})$，该函数在布里渊区内是关于波矢 $\\mathbf{k}$ 的周期函数。在计算催化和化学工程中，沿着高对称性路径对布里渊区进行采样是能带结构计算中的常见做法。然而，仅沿着一组预设的高对称性路径线来优化 $E_n(\\mathbf{k})$，等同于在其定义域的一个严格子集上最小化一个函数，这可能会错过位于这些路径线之外的极值点。\n\n从经过充分检验的紧束缚直觉出发，考虑以下二维参数化周期性能带能量模型：\n$$\nE(\\mathbf{k}) \\equiv E(k_x,k_y) = E_0 + 2 t_1 \\left[\\cos(k_x a) + \\cos(k_y a)\\right] + 2 t_2 \\cos(k_x a)\\cos(k_y a) - \\Delta \\cos\\big(m (k_x - k_{0x}) a\\big)\\cos\\big(m (k_y - k_{0y}) a\\big),\n$$\n其中，$E_0$、$t_1$、$t_2$ 和 $\\Delta$ 是以电子伏特表示的能量参数，$m$ 是一个控制能谷特征的尖锐度和周期性复制的正整数，而 $(k_{0x},k_{0y})$ 指定了倒易空间中能谷特征的中心。三角函数内部使用的角度必须以弧度为单位进行解释。第一布里渊区定义域取为正方形 $k_x, k_y \\in [-\\pi/a, \\pi/a]$。\n\n设方形晶格的典型高对称性路径由分段线性序列 $\\Gamma \\rightarrow X \\rightarrow M \\rightarrow \\Gamma$ 定义，其中各点为 $\\Gamma=(0,0)$、$X=(\\pi/a,0)$ 和 $M=(\\pi/a,\\pi/a)$。能带路径采样在这些线上选择k点，并仅在该路径上最小化 $E(\\mathbf{k})$。而均匀布里渊区网格则在一组覆盖整个二维定义域的k点上最小化 $E(\\mathbf{k})$。\n\n您的任务是：\n\n- 根据上述定义和布洛赫定理所施加的周期性，解释为什么沿着一个子集（高对称性路径）最小化 $E(\\mathbf{k})$ 不能保证找到在整个布里渊区上的全局最小值，以及为什么会错过路径外的最小值。仅使用标准的集合优化论证和 $E(\\mathbf{k})$ 的周期性从第一性原理进行推理。\n- 设计并实现一个计算程序，对于给定的参数，在以下位置评估 $E(\\mathbf{k})$：\n  1. 在 $\\Gamma \\rightarrow X$、$X \\rightarrow M$ 和 $M \\rightarrow \\Gamma$ 的每个线段上进行密集的、每段包含 $N_{\\mathrm{path}}$ 个点的高对称性路径采样。\n  2. 一个覆盖整个第一布里渊区 $k_x, k_y \\in [-\\pi/a, \\pi/a]$ 的大小为 $N_{\\mathrm{fine}} \\times N_{\\mathrm{fine}}$ 的精细、均匀的二维网格。\n- 对于每个测试用例，返回：\n  1. 在高对称性路径上找到的最小能量，以电子伏特表示并四舍五入到 $6$ 位小数。\n  2. 在精细网格上找到的最小能量，以电子伏特表示并四舍五入到 $6$ 位小数。\n  3. 一个布尔值，指示精细网格是否找到了比路径采样严格更低的能量（当且仅当精细网格的最小值比路径最小值小超过 $10^{-8}$ 电子伏特的数值容差时，该布尔值必须为真）。\n\n您必须使用以下测试套件，该套件探讨了不同的情景，包括路径外能谷、路径上能谷，以及可能被粗略路径采样错过的尖锐特征：\n\n- 测试用例 1（路径外深能谷）：\n  - $a = 2.8$ 埃。\n  - $E_0 = 0.0$ 电子伏特，$t_1 = 0.8$ 电子伏特，$t_2 = 0.3$ 电子伏特。\n  - $\\Delta = 2.8$ 电子伏特，$m = 1$。\n  - $k_{0x} = 0.6 \\cdot \\pi/a$，$k_{0y} = 0.4 \\cdot \\pi/a$。\n  - $N_{\\mathrm{path}} = 401$，$N_{\\mathrm{fine}} = 301$。\n- 测试用例 2（路径外浅能谷，但路径仍占优）：\n  - $a = 2.8$ 埃。\n  - $E_0 = 0.0$ 电子伏特，$t_1 = 0.8$ 电子伏特，$t_2 = 0.3$ 电子伏特。\n  - $\\Delta = 0.3$ 电子伏特，$m = 1$。\n  - $k_{0x} = 0.6 \\cdot \\pi/a$，$k_{0y} = 0.4 \\cdot \\pi/a$。\n  - $N_{\\mathrm{path}} = 401$，$N_{\\mathrm{fine}} = 301$。\n- 测试用例 3（路径上能谷）：\n  - $a = 2.8$ 埃。\n  - $E_0 = 0.0$ 电子伏特，$t_1 = 0.8$ 电子伏特，$t_2 = 0.3$ 电子伏特。\n  - $\\Delta = 2.0$ 电子伏特，$m = 1$。\n  - $k_{0x} = 1.0 \\cdot \\pi/a$，$k_{0y} = 0.5 \\cdot \\pi/a$。\n  - $N_{\\mathrm{path}} = 401$，$N_{\\mathrm{fine}} = 301$。\n- 测试用例 4（路径外极尖锐能谷，需要精细网格）：\n  - $a = 2.8$ 埃。\n  - $E_0 = 0.0$ 电子伏特，$t_1 = 0.8$ 电子伏特，$t_2 = 0.3$ 电子伏特。\n  - $\\Delta = 3.0$ 电子伏特，$m = 9$。\n  - $k_{0x} = 0.53 \\cdot \\pi/a$，$k_{0y} = 0.37 \\cdot \\pi/a$。\n  - $N_{\\mathrm{path}} = 401$，$N_{\\mathrm{fine}} = 401$。\n\n所有三角函数参数必须以弧度为单位。所有能量以电子伏特表示。您的程序必须为上述测试套件计算所要求的量，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序如下：\n$[$path\\_min\\_1, mesh\\_min\\_1, flag\\_1, path\\_min\\_2, mesh\\_min\\_2, flag\\_2, path\\_min\\_3, mesh\\_min\\_3, flag\\_3, path\\_min\\_4, mesh\\_min\\_4, flag\\_4$]$，\n其中每个能量值四舍五入到 $6$ 位小数，每个标志都是一个布尔值。不得打印任何额外文本。",
            "solution": "该问题要求对为什么沿着高对称性路径最小化能带能量函数 $E(\\mathbf{k})$ 可能无法得到全局最小值提供理论解释，并要求设计一个计算程序来证明这一点。该问题具有科学依据，定义明确，且所有提供的数据都一致且足以求解。\n\n### 第1部分：理论论证\n\n问题的核心在于数学优化的基本原理。设函数 $E(\\mathbf{k})$ 的定义域为第一布里渊区（BZ），对于给定的二维方形晶格，这是一个倒易空间中的紧集。我们可以将此定义域定义为 $\\mathcal{B} = \\{ \\mathbf{k}=(k_x, k_y) \\in \\mathbb{R}^2 \\mid k_x \\in [-\\pi/a, \\pi/a], k_y \\in [-\\pi/a, \\pi/a] \\}$。能量函数 $E(\\mathbf{k})$ 在此定义域上是连续的。根据极值定理，$E(\\mathbf{k})$ 必须在 $\\mathcal{B}$ 上达到其全局最小值。设此全局最小值为 $E_{\\text{global}}$，并设其在点 $\\mathbf{k}^* \\in \\mathcal{B}$ 处取得，使得 $E(\\mathbf{k}^*) = E_{\\text{global}} = \\min_{\\mathbf{k} \\in \\mathcal{B}} E(\\mathbf{k})$。\n\n根据布洛赫定理，能带能量 $E(\\mathbf{k})$ 是波矢 $\\mathbf{k}$ 的周期函数，其周期性与倒易晶格相同。这意味着对于任何倒易晶格矢量 $\\mathbf{G}$，都有 $E(\\mathbf{k}) = E(\\mathbf{k}+\\mathbf{G})$。对于指定的方形晶格，其原胞倒易晶格矢量为 $\\mathbf{b}_1 = (2\\pi/a, 0)$ 和 $\\mathbf{b}_2 = (0, 2\\pi/a)$。$E(\\mathbf{k})$ 的周期性确保了整个能量景观都包含在倒易晶格的单个原胞内。第一布里渊区 $\\mathcal{B}$ 就是这样一个原胞。因此，将全局最小值的搜索限制在定义域 $\\mathcal{B}$ 内是充分且完备的；任何在 $\\mathcal{B}$ 之外的最小值在 $\\mathcal{B}$ 内部都有一个完全相同的对应点。\n\n由序列 $\\Gamma \\rightarrow X \\rightarrow M \\rightarrow \\Gamma$ 定义的高对称性路径，构成了二维布里渊区内的一个一维流形。我们将此路径域表示为 $\\mathcal{P}$。此路径上的点为 $\\mathbf{k} \\in \\mathcal{P}$，其中 $\\mathcal{P}$ 是连接 $\\Gamma=(0,0)$、$X=(\\pi/a,0)$ 和 $M=(\\pi/a,\\pi/a)$ 的线段的并集。从构造上可以清楚地看出，路径 $\\mathcal{P}$ 是布里渊区 $\\mathcal{B}$ 的一个严格子集，即 $\\mathcal{P} \\subset \\mathcal{B}$。\n\n当仅沿着高对称性路径进行采样优化时，实际上是在寻求 $E(\\mathbf{k})$ 在定义域 $\\mathcal{P}$ 上的最小值。设此路径限制下的最小值为 $E_{\\text{path}} = \\min_{\\mathbf{k} \\in \\mathcal{P}} E(\\mathbf{k})$。\n\n根据集合优化的原理，由于路径最小值的搜索域 $\\mathcal{P}$ 是全局最小值搜索域 $\\mathcal{B}$ 的子集，以下不等式必须成立：\n$$\nE_{\\text{global}} = \\min_{\\mathbf{k} \\in \\mathcal{B}} E(\\mathbf{k}) \\le \\min_{\\mathbf{k} \\in \\mathcal{P}} E(\\mathbf{k}) = E_{\\text{path}}\n$$\n该不等式表明，在一个较大集合上的最小值不能大于其一个较小的、被包含的子集上的最小值。等式 $E_{\\text{global}} = E_{\\text{path}}$ 成立的充分必要条件是全局最小值点 $\\mathbf{k}^*$ 恰好位于路径 $\\mathcal{P}$ 上（即 $\\mathbf{k}^* \\in \\mathcal{P}$）。\n\n然而，没有任何物理或数学定律保证任意周期函数 $E(\\mathbf{k})$ 的全局最小值必须位于一组预先选定的高对称性线上。极值点的位置由 $E(\\mathbf{k})$ 的具体函数形式及其参数（$t_1$、$t_2$、$\\Delta$ 等）决定。如果参数使得全局最小值出现在一个低对称性点 $\\mathbf{k}_{\\text{off-path}}^* \\notin \\mathcal{P}$，那么路径采样方法从根本上就无法找到这个最小值。在这种情况下，路径上找到的最小值 $E_{\\text{path}}$ 将严格大于真实的全局最小值 $E_{\\text{global}}$。全布里渊区网格采样近似于在 $\\mathcal{B}$ 上的搜索，因此可以定位（或接近）这类路径外的最小值，从而得到更低的能量值。\n\n总而言之，沿着高对称性路径 $\\mathcal{P}$ 最小化 $E(\\mathbf{k})$ 是在完整的二维定义域 $\\mathcal{B}$ 的一个受限一维子空间上进行优化。除非全局最小值恰好落在这个特定的子空间上，否则基于路径的搜索将错过它，并报告一个比真实全局最小值更高的值。\n\n### 第2部分：计算程序设计\n\n计算程序旨在数值上验证上述原理。对于每个测试用例，我们在两个不同的离散点集上对给定的能量函数 $E(k_x, k_y)$ 进行两次独立的最小化。\n\n能量函数为：\n$$\nE(k_x,k_y) = E_0 + 2 t_1 \\left[\\cos(k_x a) + \\cos(k_y a)\\right] + 2 t_2 \\cos(k_x a)\\cos(k_y a) - \\Delta \\cos\\big(m (k_x - k_{0x}) a\\big)\\cos\\big(m (k_y - k_{0y}) a\\big)\n$$\n\n1.  **高对称性路径采样**：\n    -   该路径由三个线段组成：$\\Gamma \\rightarrow X$、$X \\rightarrow M$ 和 $M \\rightarrow \\Gamma$。\n    -   端点为 $\\Gamma=(0,0)$、$X=(\\pi/a,0)$ 和 $M=(\\pi/a,\\pi/a)$。\n    -   对于每个线段，我们生成 $N_{\\mathrm{path}}$ 个等距点。\n        -   $\\Gamma \\rightarrow X$：对于 $s \\in [0,1]$，$\\mathbf{k}(s) = (s \\cdot \\pi/a, 0)$。我们通过对 $s$ 取均匀步长来采样 $N_{\\mathrm{path}}$ 个点。\n        -   $X \\rightarrow M$：对于 $s \\in [0,1]$，$\\mathbf{k}(s) = (\\pi/a, s \\cdot \\pi/a)$。我们采样 $N_{\\mathrm{path}}$ 个点。\n        -   $M \\rightarrow \\Gamma$：对于 $s \\in [0,1]$，$\\mathbf{k}(s) = ((1-s) \\cdot \\pi/a, (1-s) \\cdot \\pi/a)$。我们采样 $N_{\\mathrm{path}}$ 个点。\n    -   所有生成点的集合构成了离散集 $S_{\\text{path}}$。我们对每个 $\\mathbf{k} \\in S_{\\text{path}}$ 计算 $E(\\mathbf{k})$，并找到最小值 $E_{\\text{path\\_min}} = \\min_{\\mathbf{k} \\in S_{\\text{path}}} E(\\mathbf{k})$。\n\n2.  **均匀布里渊区网格采样**：\n    -   定义域为正方形 $k_x, k_y \\in [-\\pi/a, \\pi/a]$。\n    -   我们创建一个覆盖此正方形的 $N_{\\mathrm{fine}} \\times N_{\\mathrm{fine}}$ 点的均匀网格。这是通过在 $k_x$ 轴和 $k_y$ 轴上从 $-\\pi/a$ 到 $\\pi/a$ 生成 $N_{\\mathrm{fine}}$ 个等间距点，并形成一个网格（meshgrid）来完成的。\n    -   这个离散点集 $S_{\\text{mesh}}$ 作为完整布里渊区 $\\mathcal{B}$ 的一个近似。\n    -   我们对每个点 $\\mathbf{k} \\in S_{\\text{mesh}}$ 计算 $E(\\mathbf{k})$，并找到最小值 $E_{\\text{mesh\\_min}} = \\min_{\\mathbf{k} \\in S_{\\text{mesh}}} E(\\mathbf{k})$。\n\n3.  **比较**：\n    -   比较两个最小值 $E_{\\text{path\\_min}}$ 和 $E_{\\text{mesh\\_min}}$。\n    -   如果网格搜索找到严格更低的能量，即 $E_{\\text{path\\_min}} - E_{\\text{mesh\\_min}}  10^{-8}$，则布尔标志设置为 `True`，其中 $10^{-8}$ 是一个用于防止浮点噪声的数值容差。否则，标志为 `False`。然后按要求将结果四舍五入到 $6$ 位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Brillouin zone sampling problem for a suite of test cases.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"a\": 2.8, \"E0\": 0.0, \"t1\": 0.8, \"t2\": 0.3,\n            \"delta\": 2.8, \"m\": 1,\n            \"k0x_factor\": 0.6, \"k0y_factor\": 0.4,\n            \"N_path\": 401, \"N_fine\": 301\n        },\n        {\n            \"a\": 2.8, \"E0\": 0.0, \"t1\": 0.8, \"t2\": 0.3,\n            \"delta\": 0.3, \"m\": 1,\n            \"k0x_factor\": 0.6, \"k0y_factor\": 0.4,\n            \"N_path\": 401, \"N_fine\": 301\n        },\n        {\n            \"a\": 2.8, \"E0\": 0.0, \"t1\": 0.8, \"t2\": 0.3,\n            \"delta\": 2.0, \"m\": 1,\n            \"k0x_factor\": 1.0, \"k0y_factor\": 0.5,\n            \"N_path\": 401, \"N_fine\": 301\n        },\n        {\n            \"a\": 2.8, \"E0\": 0.0, \"t1\": 0.8, \"t2\": 0.3,\n            \"delta\": 3.0, \"m\": 9,\n            \"k0x_factor\": 0.53, \"k0y_factor\": 0.37,\n            \"N_path\": 401, \"N_fine\": 401\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        a = case[\"a\"]\n        E0 = case[\"E0\"]\n        t1 = case[\"t1\"]\n        t2 = case[\"t2\"]\n        delta = case[\"delta\"]\n        m = case[\"m\"]\n        N_path = case[\"N_path\"]\n        N_fine = case[\"N_fine\"]\n\n        pi_a = np.pi / a\n        k0x = case[\"k0x_factor\"] * pi_a\n        k0y = case[\"k0y_factor\"] * pi_a\n\n        def energy_func(kx, ky):\n            \"\"\"\n            Calculates the parametric band energy E(k_x, k_y).\n            \"\"\"\n            cos_kx_a = np.cos(kx * a)\n            cos_ky_a = np.cos(ky * a)\n            \n            base_energy = E0 + 2 * t1 * (cos_kx_a + cos_ky_a) + 2 * t2 * cos_kx_a * cos_ky_a\n            \n            valley_term = delta * np.cos(m * (kx - k0x) * a) * np.cos(m * (ky - k0y) * a)\n            \n            return base_energy - valley_term\n\n        # 1. High-symmetry path sampling\n        # Gamma - X\n        kx_gx = np.linspace(0, pi_a, N_path)\n        ky_gx = np.zeros(N_path)\n        \n        # X - M\n        kx_xm = np.full(N_path, pi_a)\n        ky_xm = np.linspace(0, pi_a, N_path)\n\n        # M - Gamma\n        kx_mg = np.linspace(pi_a, 0, N_path)\n        ky_mg = np.linspace(pi_a, 0, N_path)\n\n        # Concatenate path segments\n        k_path_x = np.concatenate((kx_gx, kx_xm, kx_mg))\n        k_path_y = np.concatenate((ky_gx, ky_xm, ky_mg))\n\n        path_energies = energy_func(k_path_x, k_path_y)\n        path_min = np.min(path_energies)\n\n        # 2. Uniform Brillouin zone mesh sampling\n        k_coords = np.linspace(-pi_a, pi_a, N_fine)\n        kx_mesh, ky_mesh = np.meshgrid(k_coords, k_coords)\n\n        mesh_energies = energy_func(kx_mesh, ky_mesh)\n        mesh_min = np.min(mesh_energies)\n\n        # 3. Comparison\n        # Flag is True if mesh_min is strictly lower than path_min by more than the tolerance.\n        found_lower = (path_min - mesh_min) > 1e-8\n\n        # Append results for this case\n        all_results.extend([\n            round(path_min, 6),\n            round(mesh_min, 6),\n            bool(found_lower) # Ensure it's a standard Python boolean\n        ])\n    \n    # Format the final output string exactly as specified\n    result_str = \",\".join(map(str, all_results))\n    print(f\"[{result_str.replace('True', 'true').replace('False', 'false')}]\")\n\nsolve()\n```"
        }
    ]
}