## 引言
在催化科学与化学工程领域，发现新颖、高效的化学反应路径是推动技术革新和新[材料设计](@entry_id:160450)的核心驱动力。然而，化学反应的可能空间极其广阔和复杂，传统的实验探索和基于化学直觉的方法往往耗时耗力，且容易遗漏非直观的关键反应机理。全局优化与[自动化反应发现](@entry_id:1121267)技术应运而生，旨在通过强大的计算方法系统性地绘制出完整的[反应网络](@entry_id:203526)，从而填补了这一知识空白。本文将全面介绍这一前沿领域。在接下来的章节中，我们将首先深入“原理和机制”，从第一性原理出发，剖析[势能面](@entry_id:143655)理论以及驱动反应发现的核心算法。随后，我们将在“应用与交叉学科联系”中展示这些方法如何在催化剂设计、多尺度建模等实际问题中发挥作用。最后，通过一系列“动手实践”练习，读者将有机会亲手应用这些关键概念，巩固所学知识。

## 原理和机制

本章旨在深入探讨计算催化和[化学工程](@entry_id:143883)领域中全局优化与[自动化反应发现](@entry_id:1121267)的核心科学原理和算法机制。继引言部分对该领域的宏观背景进行概述之后，我们将从第一性原理出发，系统性地构建理解[势能面](@entry_id:143655)、[反应路径](@entry_id:163735)、过渡态以及驱动这些系统探索的先进计算方法所需的理论框架。我们将阐明[势能面](@entry_id:143655)和自由能面的基本概念，剖析[全局搜索](@entry_id:172339)面临的挑战，并详细介绍一系列旨在克服这些挑战的关键算法，包括路径寻找、增强取样和数据驱动的优化策略。

### 计算景观：[势能面](@entry_id:143655)与自由能面

在[计算化学](@entry_id:143039)中，描述化学反应的理论基石是**波恩-奥本海默近似**（Born-Oppenheimer approximation）。该近似允许我们将原子核与电子的运动[解耦](@entry_id:160890)，从而引出**[势能面](@entry_id:143655)**（Potential Energy Surface, PES）的概念。[势能面](@entry_id:143655)是一个将原子核坐标构型 $\mathbf{x} \in \mathbb{R}^n$ 映射到其对应势能 $U(\mathbf{x})$ 的高维标量场。这个“景观”的地形特征决定了系统的化学行为。

景观中的关键点是**[驻点](@entry_id:136617)**（stationary points），在这些点上，作用于所有原子核的力（即[势能的梯度](@entry_id:173126)）均为零：$\nabla U(\mathbf{x}) = \mathbf{0}$。驻点主要分为两类：**局部极小点**（local minima）和**鞍点**（saddle points）。局部极小点对应于系统可以稳定或亚稳定存在的构型，如反应物、产物和中间体。在数学上，一个极小点的**黑塞矩阵**（Hessian matrix），即势能对坐标的二阶导数矩阵 $\mathbf{H}(\mathbf{q}) = \nabla^2 V(\mathbf{q})$，是正定的（所有特征值均为正）。

相比之下，鞍点在某些方向上是极大点，而在其他方向上是极小点。在化学反应理论中，我们最关心的是**[一阶鞍点](@entry_id:165164)**（first-order saddle point），它在物理上对应于化学反应的**过渡态**（transition state）。一个[一阶鞍点](@entry_id:165164)是一个驻点，其黑塞矩阵有且仅有一个负特征值 。这个唯一的负特征值所对应的[特征向量](@entry_id:151813)，定义了在过渡态位置的**反应坐标**（reaction coordinate）方向。沿着这个方向，势能是局域最大的，系统会自发地向能量更低的方向演化，即分别滑向反应物和产物两个不同的能量盆地。而在与此正交的所有其他 $n-1$ 个方向上，势能是局域最小的，这确保了任何偏离理想[反应路径](@entry_id:163735)的微小扰动都会被一个恢复力拉回到路径上。

寻找过渡态的根本目的在于计算[反应速率](@entry_id:185114)。根据常规的**过渡态理论**（Transition State Theory, TST），基元反应步骤的[速率常数](@entry_id:140362) $k$ 与[活化吉布斯自由能](@entry_id:178672) $\Delta G^\ddagger$ 之间存在指数关系 ：
$$ k = \frac{k_B T}{h} \exp\left(-\frac{\Delta G^\ddagger}{R T}\right) $$
其中，$k_B$ 是玻尔兹曼常数，$h$ 是[普朗克常数](@entry_id:139373)，$T$ 是温度，$R$ 是摩尔气体常数。$\Delta G^\ddagger = G^\ddagger - G_{\mathrm{R}}$ 是活化络合物（即过渡态）与反应物之间的吉布斯自由能差。常规 TST 建立在几个核心假设之上，包括：系统存在一个准[平衡分布](@entry_id:263943)于反应物和活化络合物之间；以及任何穿过过渡态的轨迹都不会再折返（即[透射系数](@entry_id:756126) $\kappa=1$）。这个公式清晰地表明，确定过渡态的能量是预测反应动力学的关键。

然而，[势能面](@entry_id:143655)是一个在零温（$T=0$ K）下的理想化图像。在有限温度下，系统的行为由**自由能面**（Free Energy Surface, FES）或称**[平均力势](@entry_id:137947)**（Potential of Mean Force, PMF）所支配。对于一个给定的慢集体变量（或反应坐标） $\mathbf{R}$，其自由能 $F(\mathbf{R})$ 是通过对所有其他快速变化的自由度 $\mathbf{q}$ 进行[热力学平均](@entry_id:755909)得到的 ：
$$ F(\mathbf{R}) = -k_{\mathrm{B}} T \ln \left[ \int \exp\left(-\beta \, U(\mathbf{R},\mathbf{q})\right) \,\mathrm{d}\mathbf{q} \right] + C $$
其中 $\beta = 1/(k_B T)$，$U(\mathbf{R},\mathbf{q})$ 是总势能，$C$ 是一个任意常数。这个定义本质上说明，自由能不仅包含了平均势能，还包含了与在固定 $\mathbf{R}$ 时系统可探索的构象空间体积相关的**熵**（entropy）贡献。因此，在有限温度下，系统倾向于沿着**最低自由能路径**（Minimum Free Energy Path, MFEP）演化，而不仅仅是最低能量路径（MEP）。值得强调的是，自由能是一个**[状态函数](@entry_id:137683)**，其在两点之间的差值 $\Delta F$ 与连接这两点的具体路径无关。

### 探索的挑战：全局优化与局部优化

催化体系的[势能面](@entry_id:143655)和自由能面通常极其复杂和“崎岖”，呈现出**非凸**（nonconvex）的特性。这意味着景观中存在大量的[局部极小值](@entry_id:143537)（[亚稳态](@entry_id:167515)中间体）和鞍点，它们被不同高度的能垒隔开。这就引出了**全局优化**（global optimization）的核心挑战：不仅要找到一个极小值，还要找到整个坐标空间中能量（或自由能）最低的那个点，即**[全局极小值](@entry_id:165977)**（global minimum）。

传统的**局部优化**（local optimization）算法，如[最速下降法](@entry_id:140448)或[拟牛顿法](@entry_id:138962)，通常是基于梯度的**单调下降**（monotone descent）策略。这些方法从一个初始点出发，沿着负梯度方向（“下山”方向）迭代，直到达到一个梯度为零的驻点。然而，在一个非凸的[势能面](@entry_id:143655)上，这种策略的局限性是致命的 。一旦算法进入某个能量盆地的[吸引域](@entry_id:172179)，它就无法通过“爬坡”来跨越能垒去探索其他可能存在更低能量的盆地。因此，局部[优化方法](@entry_id:164468)的结果完全依赖于初始构型的选择，并且几乎总会收敛到离初始点最近的[局部极小值](@entry_id:143537)，而这个值很可能不是全局最优解。

为了在[自动化反应发现](@entry_id:1121267)中完整地描绘出反应网络，即找到所有重要的中间体和连接它们的过渡态，我们必须采用能够系统性地逃离[局部极小值陷阱](@entry_id:176553)的全局优化策略。

### 全局探索策略概览

全局优化算法可以大致分为两大类：确定性方法和随机性方法 。

**[确定性全局优化](@entry_id:634455)方法**（Deterministic global optimization methods）旨在通过系统性的空间分割来提供找到全局最优解的严格保证。例如，[分支定界法](@entry_id:635251)（branch-and-bound）或 DIRECT 算法，它们将搜索空间不断地划分为更小的子区域。这些方法通常依赖于函数满足某些平滑性假设，如**[利普希茨连续性](@entry_id:142246)**（Lipschitz continuity），即 $|U(\mathbf{x}) - U(\mathbf{y})| \leq L \|\mathbf{x} - \mathbf{y}\|$。这个性质允许算法在一个子区域内根据一个采样点的值来估计该区域内函数值的下界。如果某个区域的下界高于当前已知的最优值，那么这个区域就可以被安全地“剪枝”掉。这类方法的优点是能提供最优性证明，但其致命弱点在于**维度灾难**（curse of dimensionality）：其计算复杂度随维度 $d$ 呈[指数增长](@entry_id:141869)，使得它们对于具有许多原子的高维化学体系（$d=3N-6$）几乎不可行。此外，它们通常要求函数值的计算是确定且无噪声的。

**随机性[全局优化方法](@entry_id:169046)**（Stochastic methods）则采用完全不同的哲学。它们通过引入随机性来探索搜索空间，从而有能力“跳出”[局部极小值](@entry_id:143537)的陷阱。例如，**[模拟退火](@entry_id:144939)**（simulated annealing）和**[演化算法](@entry_id:637616)**（evolutionary strategies）等。这些方法允许在一定概率下接受能量增加的“上坡”移动，从而能够跨越能垒。它们的理论基础通常依赖于[马尔可夫链](@entry_id:150828)的**遍历性**（ergodicity），即在足够长的时间内，算法能够访问到搜索空间中的任何区域。对于特定的算法和参数设置（如[模拟退火](@entry_id:144939)中的对数降温方案），可以证明它们将以概率1渐近收敛到[全局最优解](@entry_id:175747)。随机方法的巨大优势在于它们对函数的平滑性没有严格要求，并且对计算中的随机噪声具有更强的鲁棒性。然而，它们的缺点也同样明显：它们只提供渐近收敛保证，无法在有限时间内提供最优性证明，并且对于某些地形（如具有非常狭窄入口的能量漏斗），纯粹的随机探索可[能效](@entry_id:272127)率低下。

### 反应发现中的关键算法机制

现在，我们将深入探讨几种在[自动化反应发现](@entry_id:1121267)中扮演核心角色的具体算法。

#### 路径寻找方法：微动弹性带 (Nudged Elastic Band, NEB)

在许多情况下，我们已经知道了反应的初始态（反应物）和最终态（产物），我们的目标是找到连接这两点的最低能量路径（MEP）以及路径上的最高点——过渡态。**[微动弹性带](@entry_id:201656)（NEB）**方法是实现这一目标的标准算法。

NEB 的基本思想是在反应物和产物之间构建一条由多个[中间构型](@entry_id:193000)（称为“镜像”或 image）组成的离散路径。这些镜像通过虚拟的弹簧相互连接，形成一条“弹性带”。算法的目标是同时优化所有中间镜像的位置，使整条弹性带弛豫到 MEP 上。为了正确地实现这一点，施加在每个镜像 $\mathbf{R}_i$ 上的有效力 $\mathbf{F}_i$ 必须被精心设计 ：

$$ \mathbf{F}_i = \mathbf{F}_{i, \text{potential}} + \mathbf{F}_{i, \text{spring}} $$

这个力由两部分组成：

1.  **势能力分量**: 来自真实[势能面](@entry_id:143655)的力 $\mathbf{F}_{\text{true}}(\mathbf{R}_i) = -\nabla V(\mathbf{R}_i)$ 会导致镜像既向 MEP 移动，也沿着弹性带滑动。滑动分量会使得镜像点在能垒较低处聚集，在高处稀疏，不利于找到过渡态。为了避免这种情况，NEB 只保留真实势能力中垂直于路径[切线](@entry_id:268870) $\hat{\boldsymbol{\tau}}_i$ 的分量 $\mathbf{F}_{i}^{\perp}$。这个垂直分量将镜像“推”向 MEP，而不会使其沿路径滑动。其表达式为：
    $$ \mathbf{F}_{i, \text{potential}} = -\left(\nabla V(\mathbf{R}_i) - \left(\nabla V(\mathbf{R}_i)\cdot\hat{\boldsymbol{\tau}}_i\right)\hat{\boldsymbol{\tau}}_i\right) $$

2.  **弹簧力分量**: 虚拟弹簧力的作用是使镜像点在路径上均匀分布。为了防止弹簧力干扰路径向 MEP 的弛豫，弹簧力也必须被“微动”，即只保留其沿着路径切线方向的分量。这个平行分量确保了弹簧力只调节间距，而不会导致路径“切角”（corner-cutting）。其表达式为：
    $$ \mathbf{F}_{i, \text{spring}} = k\left(\left|\mathbf{R}_{i+1}-\mathbf{R}_i\right| - \left|\mathbf{R}_i - \mathbf{R}_{i-1}\right|\right)\hat{\boldsymbol{\tau}}_i $$

通过将这两个经过投影的力分量结合，NEB 算法能够稳定地将整个路径链收敛到真实的最低能量路径上。

##### 精确定位过渡态：爬升镜像 NEB (Climbing Image NEB, [CI-NEB](@entry_id:747380))

标准 NEB 方法的一个小缺陷是，能量最高的点（即过渡态）通常位于两个镜像之间，而不是某个镜像本身。为了精确地定位鞍点，**爬升镜像 NEB（[CI-NEB](@entry_id:747380)）**方法被提出 。

[CI-NEB](@entry_id:747380) 的思想是，在 NEB 计算进行到一定程度后，识别出能量最高的那个镜像，并对施加其上的力进行特殊修改。具体来说，对于这个“爬升镜像” $\mathbf{R}_m$：
1.  完全关闭作用在其上的弹簧力，使其位置不再受邻近镜像的影响。
2.  保留其真实的垂直势能力分量 $\mathbf{F}_m^{\perp}$，使其继续向 MEP 弛豫。
3.  反转其真实的平行势能力分量，即使用 $-\mathbf{F}_m^{\parallel}$。这会使该镜像不再沿路径“滑下”，而是沿着路径向能量最高点“爬升”。

综合起来，施加在爬升镜像上的有效力变为：
$$ \mathbf{F}_m^{\mathrm{eff}} = \mathbf{F}_m^{\perp} - \mathbf{F}_m^{\parallel} = \mathbf{F}_m - 2(\mathbf{F}_m \cdot \hat{\tau}_m)\hat{\tau}_m $$
在这种力的驱动下，爬升镜像将精确地收敛到[一阶鞍点](@entry_id:165164)的位置，从而极大地提高了过渡态搜索的精度和效率。

#### 增强取样与自由能景观：[元动力学](@entry_id:176772) (Metadynamics)

当系统的演化涉及跨越高的自由能垒时（即**稀有事件**），直接的[分子动力学模拟](@entry_id:160737)会极其低效，因为系统绝大多数时间都被困在能量阱中。**[元动力学](@entry_id:176772)**（Metadynamics）是一种强大的增强取样技术，旨在通过自适应地修改[势能面](@entry_id:143655)来加速这种稀有事件的发生。

其核心思想是沿着一个或多个预先选定的**[集体变量](@entry_id:165625)**（Collective Variables, CVs）$s(\mathbf{x})$，逐渐地添加一个具有历史依赖性的偏置势能 $V(s, t)$。这个偏置势能通常由一系列在模拟轨迹访问过的 CV 值处沉积的[高斯函数](@entry_id:261394)叠加而成。这样，系统访问过的自由能阱会被逐渐“填平”，从而迫使系统探索新的、未访问过的区域。

**适温元动力学**（Well-Tempered Metadynamics, WTM）是元动力学的一个重要改进，它解决了标准[元动力学](@entry_id:176772)中偏置势会无限制增长导致收敛性不佳的问题 。在 WTM 中，每次沉积的高斯“小山”的高度会随着该区域已经累积的偏置势 $V(s,t)$ 的增高而自动减小。具体而言，沉积速率正比于一个[衰减因子](@entry_id:1121239) $\exp\left(- V(s,t) / (k_B \Delta T) \right)$，其中 $\Delta T$ 是一个可调的温度参数。

这个简单的修改带来了深刻的后果。在模拟的[后期](@entry_id:165003)，系统会达到一个[稳态](@entry_id:139253)。在这个[稳态](@entry_id:139253)下，可以推导出两个关键结论：
1.  **自由能重构**: 最终收敛的偏置势 $V(s)$ 与真实的（未偏置的）自由能 $F(s)$ 之间存在一个简单的线性关系：
    $$ F(s) = - \frac{\gamma}{\gamma-1} V(s) + \text{const} $$
    其中，偏置因子 $\gamma = 1 + \Delta T/T$。这个公式使得我们可以从收敛的偏置势中直接重构出整个自由能曲面。
2.  **[有效温度](@entry_id:161960)**: 在 WTM 模拟中，系统沿着[集体变量](@entry_id:165625) $s$ 的取样行为，等效于在一个[有效温度](@entry_id:161960) $T_{\mathrm{eff}} = \gamma T$ 下进行的。由于 $\gamma > 1$，这个有效温度高于真实的物理温度 $T$。这从物理上解释了为什么 WTM 能够加速能垒穿越：在更高的有效温度下，自由能垒的相对高度 $F(s)/T_{\mathrm{eff}}$ 被降低了。同时，通过对模拟轨迹进行重加权（reweighting），我们仍然可以计算出在原始温度 $T$ 下的系综平均值。

#### 数据驱动的优化：[贝叶斯优化](@entry_id:175791) (Bayesian Optimization)

在催化剂设计等领域，我们常常面临一个“昂贵[黑箱优化](@entry_id:137409)”问题：目标函数（例如，某个反应的能垒 $E^\ddagger(\mathbf{x})$）的单次评估成本极高（例如，需要一次完整的 DFT+NEB 计算），且我们无法得知其梯度的解析形式。这里的 $\mathbf{x}$ 代表催化剂的描述符，如合金成分、表面[掺杂浓度](@entry_id:272646)等。在这种情况下，我们需要一种极其节省评估次数的智能搜索策略。**[贝叶斯优化](@entry_id:175791)**（Bayesian Optimization, BO）正是为此而生 。

[贝叶斯优化](@entry_id:175791)的核心是“在[探索与利用](@entry_id:174107)之间取得平衡”（exploration-exploitation trade-off）。它包含两个关键组件：

1.  **概率代理模型**（Probabilistic Surrogate Model）: BO 首先会用一个廉价的、可解析的[概率模型](@entry_id:265150)来拟合已有的昂贵函数评估数据。最常用的代理模型是**高斯过程**（Gaussian Process, GP）。GP 的强大之处在于，它不仅能对任意未测试点 $\mathbf{x}$ 给出一个预测均值 $\mu(\mathbf{x})$，还能给出一个关于该预测的不确定性（或方差）$\sigma^2(\mathbf{x})$。在数据点密集的区域，不确定性较低；在数据稀疏的区域，不确定性则较高。

2.  **[采集函数](@entry_id:168889)**（Acquisition Function）: 接下来，BO 并不直接在昂贵的真实函数上进行优化，而是在一个廉价的“[采集函数](@entry_id:168889)”上进行优化，以决定下一个最有价值的评估点。[采集函数](@entry_id:168889)的设计巧妙地结合了代理模型提供的信息，以平衡“利用”和“探索”：
    *   **利用（Exploitation）**: 在预测值 $\mu(\mathbf{x})$ 已经很低的区域进行采样，期望能找到更低的点。
    *   **探索（Exploration）**: 在不确定性 $\sigma(\mathbf{x})$ 很高的区域进行采样，以减少模型的不确定性，避免错过可能隐藏在未知区域的全局最优解。

常用的[采集函数](@entry_id:168889)包括**[期望提升](@entry_id:749168)**（Expected Improvement, EI）和**[置信上界](@entry_id:178122)/下界**（UCB/LCB）。例如，对于最小化问题，LCB [采集函数](@entry_id:168889)的形式可以是 $\alpha(\mathbf{x}) = \mu(\mathbf{x}) - \beta \sigma(\mathbf{x})$，其中 $\beta$ 是一个调节探索-利用平衡的参数。通过最大化（或最小化）采集函数，BO 能够以非常高效的方式逐步逼近[全局最优解](@entry_id:175747)。当观测值本身存在噪声时，GP 模型也能自然地将噪声纳入考量，从而提供更可靠的预测和[不确定性估计](@entry_id:191096)。

### 根本性挑战：[集体变量](@entry_id:165625)的选择

前述的元动力学和某些高级优化方法，其成功与否在很大程度上取决于**集体变量**（CVs）的选择。一个好的 CV 应该是一个或一组低维度的、关于原子坐标的函数，它能够准确地描述系统从反应物到产物转变过程中的慢动力学模式。一个糟糕的 CV 选择则可能导致模拟效率低下，甚至得到完全错误的物理化学结论。那么，如何选择好的 CV 呢？这需要回归到[反应动力学](@entry_id:150220)的第一性原理 。

**理想反应坐标：提交者（Committor）**
从理论上讲，最完美的反应坐标是**提交者概率** $q(\mathbf{x})$。对于一个从构型 $\mathbf{x}$ 出发的轨迹，其在到达反应物区域 $A$ 之前先到达产物区域 $B$ 的概率，就被定义为该构型的提交者概率 $q(\mathbf{x})$。因此，$q(\mathbf{x})$ 在反应物盆地中为0，在产物盆地中为1，而在过渡态区域，轨迹到达 A 和 B 的概率相等，即 $q(\mathbf{x}) = 1/2$。等提交者概率面（isocommittor surface）$q(\mathbf{x})=\text{const}$ 完美地描述了反应的进程。

**动力学近似与验证**
尽管提交者在理论上是完美的，但直接计算它极其困难。因此，实用的 CV 选择策略旨在找到能够很好地近似提交者或其他慢动力学模式的变量。
*   **变分法**：**[构象动力学](@entry_id:747687)[变分方法](@entry_id:163656)**（Variational Approach to Conformational Dynamics, VAC）提供了一个寻找最优 CV 的严谨框架。该理论表明，系统的最慢动力学模式对应于其**转移算符**（transfer operator）的前几个主要[特征函数](@entry_id:186820)。这些[特征函数](@entry_id:186820)可以通过最大化一组候选 CV 的时间延迟自相关函数来近似得到。
*   **[马尔可夫状态模型](@entry_id:192873)（MSM）**：一个好的 CV 集合应该能够构建出一个近似**马尔可夫**的低维动力学模型。这意味着在 CV 空间中的未来状态只依赖于当前状态，而与历史无关。我们可以通过构建一个 MSM 来检验这一点。如果模型的**[隐含时间尺度](@entry_id:1126425)**（implied timescales）在某个延迟时间 $\tau$ 之后趋于平稳，并且模型通过了**查普曼-科尔莫戈罗夫检验**（Chapman-Kolmogorov test），那么我们就可以认为所选的 CV 集合有效地捕捉了系统的慢动力学。
*   **实践中的重要性**: 在增强取样模拟中，如果一个 CV 在等提交者概率面上不是常数，就会导致**迟滞现象**（hysteresis），即系统在被偏置势来回驱动时会走上不同的路径，这会严重影响自由能计算的收敛。因此，选择近似提交者的 CV 对保证模拟的准确性和效率至关重要。

需要特别警惕的是，一些看似直观但错误的 CV 选择标准。例如，基于主成分分析（PCA）选择方差最大的坐标，这种纯几何方法完全忽略了动力学信息，大幅度的原子运动可能非常快，而关键的化学键断裂/生成可能位移很小。同样，选择能使投影自由能垒最小化的 CV 也是一种危险的偏见，它可能导向非物理的、人为创造的低能垒路径。

### 自由能计算的高级方法

最后，我们简要回顾一下计算自由能差值的两种关键技术，这对于在有限温度下验证[反应路径](@entry_id:163735)和计算能垒至关重要 。假设我们有一个由参数 $\lambda$ 表征的路径。

**热力学积分** (Thermodynamic Integration, TI)
该方法通过一个依赖于 $\lambda$ 的哈密顿量 $H(\lambda)$ 将两个状态连接起来。自由能差值可以通过对自由能导数的系综平均值进行积分得到：
$$ \Delta F = \int_{0}^{1} \left\langle \frac{\partial H}{\partial \lambda} \right\rangle_{\lambda} \mathrm{d}\lambda $$
其中 $\langle \cdot \rangle_{\lambda}$ 表示在固定 $\lambda$ 值下进行的[正则系综](@entry_id:142391)（NVT）平均。这是一种通用且强大的方法。

**[约束动力学](@entry_id:1122935)** (Constrained Dynamics)
该方法，也称为“[蓝月亮系综](@entry_id:746894)”（blue moon ensemble），通过在模拟中施加一个完整约束（holonomic constraint）$s(\mathbf{X})=\lambda$ 来计算自由能曲线。自由能的导数，即[平均力](@entry_id:170826)，等于维持该约束所需的平均力 $\langle f_s \rangle_\lambda$：
$$ \frac{\mathrm{d}F}{\mathrm{d}\lambda} = \left\langle f_{s} \right\rangle_{\lambda} $$
在实践中，这个[平均力](@entry_id:170826)不仅包括来自势能的力，还可能包括一个由坐标变换[雅可比矩阵](@entry_id:178326)产生的几何校正项，有时被称为**菲克曼势**（Fixman potential）。这两种方法为在复杂自由能面上进行定量[路径分析](@entry_id:753256)和动力学计算提供了坚实的理论基础。