{
    "hands_on_practices": [
        {
            "introduction": "本实践旨在通过一个基础模型揭开多参考方法的神秘面纱。你将为最简单的化学键——氢分子（$\\\\mathrm{H_2}$）——从头开始构建一个完整的活性空间自洽场（CASSCF）计算，从而亲手体验静态相关的本质以及单参考方法为何在键断裂时会失效。这项练习将理论概念（如Hubbard模型和第二量子化）与具体的计算实践（如矩阵对角化）联系起来。",
            "id": "3891375",
            "problem": "您需要为一个双原子氢分子 $\\mathrm{H_2}$ 在一个双轨道、双电子的活性空间（表示为 CAS$(2,2)$）中，实现一个最小的完全活性空间自洽场 (CASSCF) 程序，并使用一个适合拉伸键长的、物理上合理的模型哈密顿量。目标是仅使用二次量子化和精确对角化的第一性原理，计算优化后的 CASSCF 轨道中的自然轨道占据数，以及相对于限制性哈特里-福克 (RHF) 和全组态相互作用 (FCI) 的总能量。\n\n基本基组和模型：使用二次量子化形式的双位点哈伯德哈密顿量作为 $\\mathrm{H_2}$ 的最小分子描述的代理，其中两个位点代表两个氢的 $1s$ 原子轨道，而分子轨道（成键和反键）则由这些原子轨道的对称和反对称线性组合构成。哈伯德哈密顿量为\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow},\n$$\n其中 $\\hat{a}_{i\\sigma}^{\\dagger}$ 和 $\\hat{a}_{i\\sigma}$ 是在位点 $i \\in \\{1,2\\}$ 上自旋为 $\\sigma \\in \\{\\uparrow,\\downarrow\\}$ 的费米子产生和湮灭算符，而 $\\hat{n}_{i\\sigma} = \\hat{a}_{i\\sigma}^{\\dagger}\\hat{a}_{i\\sigma}$ 是粒子数算符。跃迁参数 $t$ 和在位相互作用 $U$ 以哈特里单位给出。\n\n分子轨道：成键 ($g$) 和反键 ($u$) 分子轨道定义为\n$$\n\\hat{a}_{g\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma} \\right), \\quad\n\\hat{a}_{u\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma} \\right).\n$$\n\n计算任务：\n1. 构建包含四个自旋轨道 $\\{(1\\uparrow),(1\\downarrow),(2\\uparrow),(2\\downarrow)\\}$ 的完整福克空间，并从中提取双电子子空间。使用正则费米子反对易关系，构建 $\\hat{H}$ 在双电子子空间上的矩阵表示，并通过对角化计算精确的基态能量 $E_{\\mathrm{FCI}}$。能量以哈特里表示。\n2. 构建 RHF 闭壳层行列式 $\\lvert \\Phi_{\\mathrm{HF}} \\rangle = \\hat{a}_{g\\uparrow}^{\\dagger}\\hat{a}_{g\\downarrow}^{\\dagger} \\lvert 0 \\rangle$ 并计算其哈密顿量的期望值 $E_{\\mathrm{HF}} = \\langle \\Phi_{\\mathrm{HF}} \\rvert \\hat{H} \\lvert \\Phi_{\\mathrm{HF}} \\rangle$，以哈特里为单位。\n3. 按如下方式执行一个最小的 CAS$(2,2)$ CASSCF 优化：\n   - 在由 $\\{g, u\\}$ 构成的含两个电子的活性空间内进行组态相互作用（对于双轨道系统，这等同于全组态相互作用）。\n   - 在 $\\{g,u\\}$ 轨道基上计算单粒子约化密度矩阵，\n     $$\n     \\gamma_{pq} \\;=\\; \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\langle \\Psi \\rvert \\hat{a}_{p\\sigma}^{\\dagger}\\hat{a}_{q\\sigma} \\lvert \\Psi \\rangle, \\quad p,q \\in \\{g,u\\},\n     $$\n     其中 $\\lvert \\Psi \\rangle$ 是 FCI 基态。\n   - 对角化 $\\gamma$ 以获得自然轨道及其占据数。报告按降序排列的两个占据数（无量纲）。\n   - CASSCF 能量 $E_{\\mathrm{CAS}}$ 是活性空间中的 CI 能量；对于完整的双轨道空间，这等于 $E_{\\mathrm{FCI}}$。\n4. 对于每组参数，报告能量差 $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}}$ 和 $E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}}$（以哈特里为单位，每个都四舍五入到八位小数），以及两个自然占据数（每个都四舍五入到八位小数）。\n\n物理和数值单位：所有能量必须以哈特里（原子单位）表示。占据数是无量纲的。不使用角度。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例应表示为一个四元素列表，形式为 $[E_{\\mathrm{CAS}}-E_{\\mathrm{HF}}, E_{\\mathrm{CAS}}-E_{\\mathrm{FCI}}, \\text{occ}_1, \\text{occ}_2]$，其中两个占据数按降序排列，所有数字都四舍五入到八位小数。总体输出应该是这些用例列表的列表，例如 $[[a,b,c,d],[\\dots],\\dots]$。\n\n测试套件：\n- 案例 1 (拉伸)：$t = 0.05$ 哈特里, $U = 2.0$ 哈特里。\n- 案例 2 (中等相关)：$t = 0.30$ 哈特里, $U = 0.60$ 哈特里。\n- 案例 3 (无相互作用极限)：$t = 0.30$ 哈特里, $U = 0.00$ 哈特里。\n- 案例 4 (完全解离极限)：$t = 0.00$ 哈特里, $U = 1.00$ 哈特里。\n\n覆盖性设计：测试套件包括一个显示强静态相关的拉伸键案例、一个中等相关案例、一个 RHF 等于 FCI 的无相互作用边界条件，以及一个跃迁设置为零的解离极限边缘案例。\n\n您的解决方案不得依赖任何外部量子化学软件包；必须按照规定，从二次量子化算符、费米子反对易规则和哈密顿量的精确对角化来构建。",
            "solution": "该问题被评估为有效。它在科学上基于量子力学和电子结构理论的原理，特别是使用了公认的哈伯德模型作为 $\\mathrm{H_2}$ 分子的有效哈密顿量。该问题是适定的，所有必要的参数和定义都已提供，计算任务也陈述得明确无误。其目标可通过标准的代数和数值方法进行形式化和验证。\n\n解决方案将按照以下步骤进行开发：\n1.  最初在原子轨道（位点）基中定义的哈伯德哈密顿量，将被转换到分子轨道（MO）基。MOs 由原子轨道的成键 ($g$) 和反键 ($u$) 线性组合给出。\n2.  通过考虑自旋和空间对称性，这个双电子、四自旋轨道问题将被简化。$\\mathrm{H_2}$ 的基态具有单重态自旋多重度和 gerade（偶）空间对称性 (${}^1\\Sigma_g^+$)。活性空间内的全组态相互作用 (FCI) 问题被简化为对角化一个 $2 \\times 2$ 的哈密顿量矩阵。\n3.  限制性哈特里-福克 (RHF) 能量 $E_{\\mathrm{HF}}$，是哈密顿量对于 RHF 行列式（对应于双占据的成键轨道）的期望值。\n4.  FCI 或完全活性空间 (CAS) 能量 $E_{\\mathrm{CAS}} = E_{\\mathrm{FCI}}$，通过找到 CI 矩阵的最低本征值获得。\n5.  基态 FCI 波函数用于计算单粒子约化密度矩阵 (1-RDM)。其本征值即为自然轨道占据数。\n\n**1. 分子轨道基中的哈密顿量**\n\n哈伯德哈密顿量由下式给出\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow}\n$$\n从原子轨道 (AO) 基 $\\{1,2\\}$ 到分子轨道 (MO) 基 $\\{g,u\\}$ 的变换是\n$$\n\\hat{a}_{g\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma}), \\quad \\hat{a}_{u\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma})\n$$\n对该变换求逆，可得用 MO 算符表示的 AO 算符：\n$$\n\\hat{a}_{1\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} + \\hat{a}_{u\\sigma}), \\quad \\hat{a}_{2\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} - \\hat{a}_{u\\sigma})\n$$\n将这些代入哈密顿量，得到 MO 基中的单电子项和双电子项。单电子部分变为\n$$\n\\hat{H}_{\\text{1-el}} = -t \\sum_{\\sigma} (\\hat{n}_{g\\sigma} - \\hat{n}_{u\\sigma})\n$$\n这表明 MOs 的单电子能量为 $\\epsilon_g = -t$ 和 $\\epsilon_u = t$。\n双电子部分经过冗长但标准的推导后，可以用 MO 双电子积分表示。对于哈伯德模型，这些积分是：\n$$\n(gg|gg) = (uu|uu) = (gg|uu) = (gu|gu) = \\frac{U}{2}\n$$\n所有其他积分，例如 $(gg|gu)$，均为零。\n\n**2. 组态相互作用 (CI) 矩阵**\n\n对于具有 ${}^1\\Sigma_g^+$ 对称性的 $\\mathrm{H_2}$ 双电子基态，我们只需考虑总自旋 $S=0$、总自旋投影 $S_z=0$ 和整体为 gerade ($g$) 空间对称性的组态。在最小 CAS(2,2) 空间中，有两个这样的组态：\n1.  $|\\Phi_g\\rangle = |g\\uparrow g\\downarrow\\rangle$：两个电子都在成键轨道中。这是一个 $g \\otimes g = g$ 的态。这也是 RHF 参考行列式。\n2.  $|\\Phi_u\\rangle = |u\\uparrow u\\downarrow\\rangle$：两个电子都在反键轨道中。这是一个 $u \\otimes u = g$ 的态。\n\n在基 $\\{|\\Phi_g\\rangle, |\\Phi_u\\rangle\\}$ 中的 CI 哈密顿量矩阵为：\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle \\\\ \\langle \\Phi_u | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle \\end{pmatrix}\n$$\n矩阵元计算如下：\n-   $H_{11} = \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle = 2\\epsilon_g + (gg|gg) = -2t + \\frac{U}{2}$\n-   $H_{22} = \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle = 2\\epsilon_u + (uu|uu) = 2t + \\frac{U}{2}$\n-   $H_{12} = H_{21} = \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle = (gg|uu) = \\frac{U}{2}$\n\n因此，CI 矩阵为：\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} -2t + U/2  U/2 \\\\ U/2  2t + U/2 \\end{pmatrix}\n$$\n\n**3. 能量计算**\n\nRHF 能量 $E_{\\mathrm{HF}}$ 是组态 $|\\Phi_g\\rangle$ 的能量：\n$$\nE_{\\mathrm{HF}} = H_{11} = -2t + \\frac{U}{2}\n$$\nCASSCF/FCI 能量 $E_{\\mathrm{CAS}}$ 是 $\\mathbf{H}_{\\mathrm{CI}}$ 的最低本征值。本征值 $\\lambda$ 是特征方程的解：\n$$\n(\\lambda - (-2t + U/2))(\\lambda - (2t + U/2)) - (U/2)^2 = 0\n$$\n$$\n\\lambda^2 - U\\lambda - 4t^2 = 0\n$$\n解为 $\\lambda = \\frac{U \\pm \\sqrt{U^2 + 16t^2}}{2}$。最低的本征值是：\n$$\nE_{\\mathrm{CAS}} = E_{\\mathrm{FCI}} = \\frac{U - \\sqrt{U^2 + 16t^2}}{2}\n$$\n所需的能量差为：\n-   根据该问题的定义，$E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}} = 0$。\n-   $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}} = \\left(\\frac{U - \\sqrt{U^2 + 16t^2}}{2}\\right) - \\left(-2t + \\frac{U}{2}\\right) = \\frac{4t - \\sqrt{U^2 + 16t^2}}{2}$\n\n**4. 自然轨道占据数**\n\n基态 FCI 波函数是线性组合 $|\\Psi\\rangle = c_g |\\Phi_g\\rangle + c_u |\\Phi_u\\rangle$。系数 $(c_g, c_u)$ 构成了对应于 $E_{\\mathrm{CAS}}$ 的本征矢。对于这个简单的对称系统，MOs $\\{g, u\\}$ 就是自然轨道。轨道 $p$ 的占据数由 $n_p = \\sum_\\sigma \\langle \\Psi | \\hat{a}_{p\\sigma}^\\dagger \\hat{a}_{p\\sigma} | \\Psi \\rangle$ 给出。\n$$\nn_g = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{g\\uparrow}+\\hat{n}_{g\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_g\\Phi_g \\rangle = 2c_g^2\n$$\n$$\nn_u = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{u\\uparrow}+\\hat{n}_{u\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_u\\Phi_u \\rangle = 2c_u^2\n$$\n占据数之和为 $n_g+n_u = 2(c_g^2+c_u^2) = 2$，符合两个电子的要求。为了求出 $c_g^2$，我们求解本征矢方程并进行归一化。\n从 $(\\mathbf{H}_{\\mathrm{CI}} - E_{\\mathrm{CAS}}\\mathbf{I})\\mathbf{c}=0$ 的第一行可得：\n$$\n(-2t + U/2 - E_{\\mathrm{CAS}})c_g + (U/2)c_u = 0\n$$\n系数之比为 $\\frac{c_u}{c_g} = -\\frac{-2t + U/2 - E_{\\mathrm{CAS}}}{U/2} = \\frac{4t - U + 2E_{\\mathrm{CAS}}}{U}$。代入 $E_{\\mathrm{CAS}}$ 可得：\n$$\n\\frac{c_u}{c_g} = \\frac{4t - U + (U - \\sqrt{U^2+16t^2})}{U} = \\frac{4t - \\sqrt{U^2+16t^2}}{U}\n$$\n根据归一化条件 $c_g^2 + c_u^2 = 1$，我们得到：\n$$\nc_g^2 = \\frac{1}{1 + (c_u/c_g)^2} = \\frac{1}{1 + \\left(\\frac{4t - \\sqrt{U^2+16t^2}}{U}\\right)^2}\n$$\n此公式在 $U \\neq 0$ 时有效。如果 $U=0$，则 CI 矩阵是对角的。基态纯粹是 $|\\Phi_g\\rangle$，因此 $c_g=1, c_u=0$，从而得到 $n_g=2$ 和 $n_u=0$。\n报告的占据数是按降序排列的 $n_g$ 和 $n_u$。由于 $\\epsilon_g  \\epsilon_u$，我们期望 $n_g \\ge n_u$，所以占据数为 $n_1=n_g$ 和 $n_2=n_u$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a minimal CAS(2,2) procedure for the two-site Hubbard model\n    to calculate energies and natural orbital occupations.\n    \"\"\"\n    test_cases = [\n        # (t, U) in Hartrees\n        (0.05, 2.0),   # Case 1: stretched\n        (0.30, 0.60),  # Case 2: moderate correlation\n        (0.30, 0.00),  # Case 3: non-interacting limit\n        (0.00, 1.00),  # Case 4: complete dissociation limit\n    ]\n\n    all_results = []\n    \n    for t, U in test_cases:\n        # Task 4: Calculate energy differences E_CAS - E_HF and E_CAS - E_FCI\n        \n        # E_CAS - E_FCI is zero by definition for a CAS(2,2) on a 2-orbital system.\n        E_cas_minus_E_fci = 0.0\n        \n        # E_CAS - E_HF = ( (U - sqrt(U^2 + 16t^2)) / 2 ) - ( -2t + U/2 )\n        # This simplifies to: (4t - sqrt(U^2 + 16t^2)) / 2\n        sqrt_term = np.sqrt(U**2 + 16 * t**2)\n        E_cas_minus_E_hf = (4 * t - sqrt_term) / 2\n        \n        # Task 3: Calculate natural orbital occupations\n        if U == 0.0:\n            # For non-interacting electrons, the lowest energy orbital (g) is\n            # doubly occupied, and the higher one (u) is empty.\n            occ_g = 2.0\n            occ_u = 0.0\n        else:\n            # The ground state is |Psi> = c_g |gg> + c_u |uu>\n            # The occupations are n_g = 2*c_g^2 and n_u = 2*c_u^2\n            # c_u / c_g = (4t - sqrt(U^2 + 16t^2)) / U\n            ratio_cu_cg = (4 * t - sqrt_term) / U\n            \n            # From normalization c_g^2 + c_u^2 = 1, we get c_g^2 = 1 / (1 + (c_u/c_g)^2)\n            cg_sq = 1.0 / (1.0 + ratio_cu_cg**2)\n            \n            occ_g = 2.0 * cg_sq\n            occ_u = 2.0 - occ_g # Since n_g + n_u = 2\n            \n        # Occupations must be sorted in descending order.\n        # Since g is the bonding orbital, its occupation will be higher or equal.\n        occ1 = occ_g\n        occ2 = occ_u\n\n        # Round all results to 8 decimal places\n        result = [\n            round(E_cas_minus_E_hf, 8),\n            round(E_cas_minus_E_fci, 8),\n            round(occ1, 8),\n            round(occ2, 8),\n        ]\n        all_results.append(result)\n\n    # Format the final output as a list of lists.\n    # The map(str, r) is not strictly needed for list of lists,\n    # but using it to build the string representation ensures conformity.\n    outer_list_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(outer_list_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了多参考方法的基本原理之后，下一个关键技能是识别哪些体系需要这种高级处理。本练习提供了一个重要的诊断工具，你将学习如何通过分析自然轨道占据数（NOONs）来量化静态相关的程度。通过这种方式，你可以为催化中间体等复杂分子做出明智的判断：是继续使用单参考方法（如CCSD(T)），还是必须采用多参考方法。",
            "id": "3891502",
            "problem": "考虑一个使用全活性空间自洽场 (CASSCF) 方法研究的双自由基催化中间体。CASSCF 是一种多参考方法，当存在强静态相关时，广泛应用于计算催化和化学工程领域。目标是从 CASSCF 的单电子约化密度矩阵中计算自然轨道占据数，并用它们来评估静态相关是否足够显著，以至于对耦合簇单双激发及微扰三激发 (CCSD(T)) 方法的可靠性构成挑战，而 CCSD(T) 本质上是一种单参考方法。\n\n使用以下基本且广为接受的定义：\n- 在玻恩–奥本海默近似下，一个电子波函数在选定的轨道基组中定义了一个单电子约化密度矩阵 (1-RDM)。令自旋求和的空间轨道 1-RDM 用对称矩阵 $\\Gamma \\in \\mathbb{R}^{m \\times m}$ 表示，其中 $m$ 是所选活性空间中的空间轨道数量。\n- 自然轨道是 1-RDM 的本征函数，自然占据数是相应的本征值。对于一个自旋求和的空间轨道 1-RDM，每个本征值 $n_i$ 都在 $[0,2]$ 区间内，并且 $\\sum_{i=1}^{m} n_i = N_{\\mathrm{e}}$，即活性电子的数量。在单一斯莱特行列式（单参考）的极限情况下，1-RDM 在自然轨道基组中是幂等的，其本征值等于 $0$ 或 $2$。\n- 将自旋求和的自然占据数 $n_i$ 映射为自旋轨道占据数 $p_i$ 是很有用的，通过 $p_i = n_i/2$，因此 $p_i \\in [0,1]$。对于单一斯莱特行列式，$p_i \\in \\{0,1\\}$，而分数值则表示存在电子相关。可以定义一个偏离幂等性标量\n$$\nD \\equiv \\sum_{i=1}^{m} p_i \\left(1 - p_i\\right),\n$$\n对于幂等的 1-RDM，该值为零，并随着静态相关程度的增加而增加。\n- 在双自由基典型的多参考情况下，两个或多个自然轨道的占据数会显著偏离单参考的极端值 $0$ 或 $2$，在自旋求和的情况下通常接近 $1$。\n\n任务：\n1. 对于每个给定的 CASSCF 自旋求和的空间轨道 1-RDM $\\Gamma$，通过对 $\\Gamma$ 进行对角化并按降序对本征值进行排序，来计算自然占据数。将这些本征值表示为 $n_1, n_2, \\ldots, n_m$。\n2. 计算自旋轨道占据数 $p_i = n_i/2$ 和偏离幂等性度量 $D = \\sum_i p_i(1-p_i)$。\n3. 对系统是否表现出显著的静态相关，从而对 CCSD(T) 用于定量能量学的可靠性构成挑战进行分类。使用以下基于自然占据数的定量标准：\n   - 定义阈值 $\\tau = 0.2$。计算分数占据的空间轨道的数量，即满足 $n_i \\in (\\tau, 2 - \\tau)$ 的 $n_i$ 的数量。\n   - 如果根据此标准至少有两个轨道是分数占据的，并且 $D \\ge D_{\\min}$（其中 $D_{\\min} = 0.1$），则将“与 CCSD(T) 相比存在显著静态相关”分类为布尔值 true。否则，分类为 false。\n   该标准将广为接受的观察结果可操作化：CCSD(T) 在单参考情况（接近幂等的 1-RDM）下表现最佳，而对于平衡双自由基或多个轨道占据数接近 $1$ 的强多参考态，其结果可能不可靠。\n4. 对于每个测试用例，报告：\n   - 自然占据数列表 $[n_1,\\ldots,n_m]$，四舍五入到三位小数。\n   - 标量 $D$，四舍五入到三位小数。\n   - 关于“与 CCSD(T) 相比存在显著静态相关”的布尔分类结果。\n\n测试套件：\n使用以下四个测试用例，每个用例都为包含 $m=2$ 个空间轨道和 $N_{\\mathrm{e}}=2$ 个电子的活性空间提供了一个对称、半正定的自旋求和的空间轨道 1-RDM $\\Gamma$：\n- 案例 1（平衡双自由基）：$\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$。这代表两个具有相等占据数的轨道，是双自由基中间体的特征。\n- 案例 2（闭壳层）：$\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$。这代表一个双占据轨道和一个空轨道。\n- 案例 3（准双自由基，不对称）：$\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$。这表现出不对称性，但其分数占据数仍表明存在静态相关。\n- 案例 4（带混合的双自由基）：$\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$。这引入了非对角相干性，并在对角化后产生分数占据数。\n\n数值和输出要求：\n- 所有中间和最终的数值量均为无量纲。\n- 将所有报告的自然占据数和 $D$ 值四舍五入到三位小数。\n- 您的程序应生成一行输出，其中包含四个案例的结果，形式为用方括号括起来的逗号分隔列表，每个案例的结果是一个形如 $[\\text{occupations}, D, \\text{boolean}]$ 的列表。例如：$[[[1.000,1.000],0.500,True],[[2.000,0.000],0.000,False],\\ldots]$。",
            "solution": "该问题是有效的。它在科学上基于量子化学的原理，特别是多参考电子结构理论，并且问题陈述清晰，为获得唯一解提供了所有必要的数据和标准。\n\n核心任务是分析来自全活性空间自洽场 (CASSCF) 计算的单电子约化密度矩阵 ($\\Gamma$)，以评估静态电子相关的程度。这通过计算其本征值（即自然占据数 $n_i$），然后用这些值计算偏离幂等性度量 ($D$) 并应用一个分类规则来实现。\n\n基本原理是，自然轨道是单电子约化密度矩阵 ($\\Gamma$) 的本征函数，而自然占据数 ($n_i$) 是相应的本征值。对于一个对称实矩阵 $\\Gamma$，其本征值是实数，可以通过对角化求得。问题指出，对于一个 $m$ 轨道的活性空间，$\\Gamma$ 是一个对称的 $m \\times m$ 矩阵。对每个给定的 $\\Gamma$ 的处理步骤如下：\n\n1.  **计算自然占据数 ($n_i$):**\n    自然占据数 $n_i$ 是矩阵 $\\Gamma$ 的本征值。由于 $\\Gamma$ 被指定为对称矩阵，其本征值为实数。我们通过对角化 $\\Gamma$ 来计算它们。然后将得到的本征值按降序排列，得到有序集合 $\\{n_i\\}$。\n\n2.  **计算自旋轨道占据数 ($p_i$) 和偏离幂等性 ($D$):**\n    通过关系式 $p_i = n_i / 2$，将自旋求和的空间轨道占据数 $n_i$ 转换为自旋轨道占据数 $p_i$。$p_i$ 的值位于区间 $[0, 1]$ 内。然后，使用以下公式计算偏离幂等性标量 $D$：\n    $$\n    D = \\sum_{i=1}^{m} p_i (1 - p_i)\n    $$\n    该标量量化了电子态的多参考特性。对于一个完美的单参考态，所有 $n_i$ 要么是 $0$ 要么是 $2$，使得所有 $p_i$ 要么是 $0$ 要么是 $1$，从而导致 $D=0$。与此显著的偏离表明存在静态相关。\n\n3.  **静态相关分类:**\n    使用一个定量标准来分类系统是否表现出显著的静态相关，从而对像 CCSD(T) 这样的单参考方法的可靠性构成挑战。该分类是一个基于两个条件的布尔结果：\n    a.  “分数占据”轨道的数量必须至少为两个。如果一个轨道 $i$ 的占据数 $n_i$ 落在开区间 $(\\tau, 2-\\tau)$ 内，则该轨道被认为是分数占据的，其中给定的阈值为 $\\tau = 0.2$。因此该区间为 $(0.2, 1.8)$。\n    b.  偏离度量 $D$ 必须大于或等于一个最小值 $D_{\\min} = 0.1$。\n    如果两个条件都满足，分类为 `True`；否则为 `False`。\n\n我们现在将此程序应用于所提供的四个测试案例，每个案例都有一个包含 $m=2$ 个轨道和 $N_{\\mathrm{e}}=2$ 个电子的活性空间。\n\n**案例 1：平衡双自由基**\n$\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$\n1.  该矩阵是对角矩阵，因此本征值即为对角元素。自然占据数为 $n_1=1.0$ 和 $n_2=1.0$。排序后为 $[1.0, 1.0]$。迹为 $1.0+1.0=2.0$，与 $N_{\\mathrm{e}}$ 匹配。\n2.  $p_1 = 1.0/2 = 0.5$, $p_2 = 1.0/2 = 0.5$。\n    $D = 0.5(1-0.5) + 0.5(1-0.5) = 0.25 + 0.25 = 0.5$。\n3.  $n_1=1.0$ 和 $n_2=1.0$ 都在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $2$。\n    条件是：(数量 $\\ge 2$) 为 `True`，且 ($D=0.5 \\ge 0.1$) 为 `True`。\n    分类为 `True`。\n4.  结果：占据数 $[1.000, 1.000]$，$D=0.500$，分类：`True`。\n\n**案例 2：闭壳层**\n$\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$\n1.  该矩阵是对角矩阵。自然占据数为 $n_1=2.0$ 和 $n_2=0.0$。迹为 $2.0+0.0=2.0$。\n2.  $p_1 = 2.0/2 = 1.0$, $p_2 = 0.0/2 = 0.0$。\n    $D = 1.0(1-1.0) + 0.0(1-0.0) = 0.0 + 0.0 = 0.0$。\n3.  $n_1=2.0$ 和 $n_2=0.0$ 都不在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $0$。\n    条件 (数量 $\\ge 2$) 为 `False`。\n    分类为 `False`。\n4.  结果：占据数 $[2.000, 0.000]$，$D=0.000$，分类：`False`。\n\n**案例 3：准双自由基，不对称**\n$\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$\n1.  该矩阵是对角矩阵。降序排列后，自然占据数为 $n_1=1.6$ 和 $n_2=0.4$。迹为 $1.6+0.4=2.0$。\n2.  $p_1 = 1.6/2 = 0.8$, $p_2 = 0.4/2 = 0.2$。\n    $D = 0.8(1-0.8) + 0.2(1-0.2) = 0.8(0.2) + 0.2(0.8) = 0.16 + 0.16 = 0.32$。\n3.  $n_1=1.6$ 和 $n_2=0.4$ 都在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $2$。\n    条件是：(数量 $\\ge 2$) 为 `True`，且 ($D=0.32 \\ge 0.1$) 为 `True`。\n    分类为 `True`。\n4.  结果：占据数 $[1.600, 0.400]$，$D=0.320$，分类：`True`。\n\n**案例 4：带混合的双自由基**\n$\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$\n1.  为了求出本征值 $\\lambda$，我们求解特征方程 $\\det(\\Gamma - \\lambda I) = 0$：\n    $$ (1.0-\\lambda)(1.0-\\lambda) - (0.6)(0.6) = 0 $$\n    $$ (1.0-\\lambda)^2 = 0.36 $$\n    $$ 1.0-\\lambda = \\pm 0.6 $$\n    $$ \\lambda = 1.0 \\mp 0.6 $$\n    本征值为 $\\lambda_1 = 1.6$ 和 $\\lambda_2 = 0.4$。降序排列后，自然占据数为 $n_1=1.6$ 和 $n_2=0.4$。迹为 $1.6+0.4=2.0$。\n2.  此案例产生的自然占据数与案例 3 相同。因此，$p_1=0.8$，$p_2=0.2$，且 $D=0.32$。\n3.  分类也与案例 3 相同。分数占据轨道的数量为 $2$，且 $D=0.32 \\ge 0.1$。\n    分类为 `True`。\n4.  结果：占据数 $[1.600, 0.400]$，$D=0.320$，分类：`True`。\n\n这证实了 1-RDM 中的非对角元素（代表基轨道之间的量子相干性）在对角化后可以产生分数自然轨道占据数，从而表明存在静态相关。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes natural orbital occupations and assesses static correlation for a series\n    of CASSCF one-electron reduced density matrices (1-RDMs).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Balanced diradical\n        np.array([[1.0, 0.0], [0.0, 1.0]]),\n        # Case 2: Closed shell\n        np.array([[2.0, 0.0], [0.0, 0.0]]),\n        # Case 3: Quasi-diradical, asymmetric\n        np.array([[1.6, 0.0], [0.0, 0.4]]),\n        # Case 4: Diradical with mixing\n        np.array([[1.0, 0.6], [0.6, 1.0]])\n    ]\n    \n    # Define classification parameters\n    tau = 0.2\n    D_min = 0.1\n    \n    # Store string representations of the results for each case\n    results_as_strings = []\n\n    for gamma in test_cases:\n        # Step 1: Compute natural occupation numbers (eigenvalues of Gamma)\n        # Use eigvalsh for symmetric matrices, ensuring real eigenvalues.\n        n = np.linalg.eigvalsh(gamma)\n        # Sort eigenvalues in descending order.\n        n = np.sort(n)[::-1]\n        \n        # Step 2: Compute spin-orbital occupations and deviation-from-idempotency\n        p = n / 2.0\n        D = np.sum(p * (1.0 - p))\n        \n        # Step 3: Classify static correlation\n        # Count orbitals with occupations n_i in (tau, 2-tau)\n        fractional_count = np.sum((n > tau)  (n  2.0 - tau))\n        \n        # Apply the boolean classification rule\n        is_significant = (fractional_count >= 2) and (D >= D_min)\n        \n        # Step 4: Format the results for the final output string\n        # Round occupations and D to three decimal places.\n        n_rounded_str_list = [f\"{x:.3f}\" for x in n]\n        n_list_str = f\"[{','.join(n_rounded_str_list)}]\"\n        D_str = f\"{D:.3f}\"\n        \n        # `str(bool)` correctly produces 'True' or 'False'.\n        bool_str = str(is_significant)\n        \n        # Assemble the final string for the current case\n        case_result_str = f\"[{n_list_str},{D_str},{bool_str}]\"\n        results_as_strings.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "正确选择活性空间是多参考计算中最具挑战性的部分，堪称一门“艺术”。本练习通过一个量化分析，模拟了在活性空间中包含或排除某些轨道（如配体$\\\\pi$轨道）对催化反应能垒计算结果的敏感性。通过这个实践，你将深刻理解活性空间选择的重要性，并学会审慎评估其对最终计算结论的潜在影响。",
            "id": "3891461",
            "problem": "要求您构建一个以电子伏特为单位的定量敏感性度量，用于衡量在后过渡金属催化步骤中，当配体 $\\pi$ 轨道被包含或排除在活性空间之外时，完整活性空间二阶微扰理论 (CASPT2) 的能垒高度如何变化。能垒高度是过渡态与其相应反应物态之间的能量差。您的程序必须为提供的测试套件实现计算，并生成一行输出，列出所有测试用例的敏感性值。\n\n使用的基本原理如下：\n- 在完整活性空间二阶微扰理论 (CASPT2) 中，总电子能量是一个多组态参考能量和一个二阶微扰相关能之和，两者都特定于具体的状态。设参考态为完整活性空间自洽场 (CASSCF)。\n- 在 Rayleigh–Schrödinger 微扰理论中，给定状态的二阶能量校正是对从参考态到外部空间的激发进行的求和，其中每一项由一个耦合矩阵元和一个能量分母决定。当分母为正时，二阶校正会降低能量。\n- 为避免与近简并相关的非物理发散，CASPT2 通常采用电离势电子亲和能 (IPEA) 位移，该位移通过一个加性常数来修改能量分母。您将使用一个以电子伏特为单位的实值 IPEA 位移参数，并将其统一应用于所有分母。\n\n为每个状态（反应物态和过渡态）定义以下量：\n- 令 $E_{\\mathrm{ref}}$ 表示当配体 $\\pi$ 轨道被排除在活性空间之外时的 CASSCF 参考能量。\n- 将外部激发划分为两个不相交的集合：以金属为中心的激发（表示为 $\\mathcal{M}$）和配体 $\\pi$ 激发（表示为 $\\Pi$）。\n- 对于任一集合中的每次激发 $k$，令 $V_k$ 为耦合强度（单位为 $\\mathrm{eV}$），令 $\\Delta_k$ 为未位移的分母（单位为 $\\mathrm{eV}$）。IPEA 位移 $s$（单位为 $\\mathrm{eV}$）被加到所有分母上。\n- 一组激发的二阶能量校正是使用带有 IPEA 位移分母的二阶微扰理论框架计算的。\n\n您将评估两种情景：\n1. 排除情景：配体 $\\pi$ 轨道被排除在活性空间之外。一个状态的总能量是 CASSCF 参考能量加上来自金属中心集合 $\\mathcal{M}$ 和配体 $\\pi$ 集合 $\\Pi$ 的二阶校正。\n2. 包含情景：配体 $\\pi$ 轨道被包含在活性空间内。在这种情况下，只有以金属为中心的激发对二阶校正有贡献。一部分本应是配体 $\\pi$ 的二阶贡献的能量，通过一个重整化因子被移入了参考能量中。令 $\\beta$ 为一个介于 0 和 1 之间的特定于态的实数，当配体 $\\pi$ 轨道被包含时，该实数参数化了从微扰项到参考能量的这种转移。\n\n您的任务是：\n- 计算排除情景下的 CASPT2 能垒高度 $\\Delta E_{\\mathrm{excl}}$，其定义为过渡态能量减去反应物能量，两者都包含来自 $\\mathcal{M}$ 和 $\\Pi$ 的二阶校正，并且分母应用了 IPEA 位移。\n- 计算包含情景下的 CASPT2 能垒高度 $\\Delta E_{\\mathrm{incl}}$，其定义为过渡态能量减去反应物能量，其中只有 $\\mathcal{M}$ 对二阶校正有贡献，而配体 $\\pi$ 的贡献通过特定于态的因子 $\\beta$ 转移到了参考能量中。\n- 报告以 $\\mathrm{eV}$ 为单位的敏感性 $S = \\Delta E_{\\mathrm{incl}} - \\Delta E_{\\mathrm{excl}}$。\n\n所有能量、耦合强度、分母和位移都已指定，并且必须以 $\\mathrm{eV}$ 为单位使用。您的程序必须生成四舍五入到六位小数的结果。计算不涉及角度。最终输出必须是单行文本，包含一个用方括号括起来的逗号分隔列表，列表内没有空格。\n\n测试套件参数：\n- 对每个测试用例，给出的输入参数如下：\n  - $s$：IPEA 位移（单位 $\\mathrm{eV}$）。\n  - $E_{\\mathrm{ref,R}}$：不包含配体 $\\pi$ 轨道的反应物参考能量（单位 $\\mathrm{eV}$）。\n  - $E_{\\mathrm{ref,TS}}$：不包含配体 $\\pi$ 轨道的过渡态参考能量（单位 $\\mathrm{eV}$）。\n  - $\\mathcal{M}_{\\mathrm{R}}$：反应物中以金属为中心的激发的 $(V_k,\\Delta_k)$ 对列表（单位 $\\mathrm{eV}$）。\n  - $\\Pi_{\\mathrm{R}}$：反应物中配体 $\\pi$ 激发的 $(V_k,\\Delta_k)$ 对列表（单位 $\\mathrm{eV}$）。\n  - $\\mathcal{M}_{\\mathrm{TS}}$：过渡态中以金属为中心的激发的 $(V_k,\\Delta_k)$ 对列表（单位 $\\mathrm{eV}$）。\n  - $\\Pi_{\\mathrm{TS}}$：过渡态中配体 $\\pi$ 激发的 $(V_k,\\Delta_k)$ 对列表（单位 $\\mathrm{eV}$）。\n  - $\\beta_{\\mathrm{R}}$：反应物重整化因子（无单位）。\n  - $\\beta_{\\mathrm{TS}}$：过渡态重整化因子（无单位）。\n\n使用以下四个测试用例：\n- 测试用例 1（一般情况，类似后过渡金属的氧化加成）：\n  - $s = 6.8$\n  - $E_{\\mathrm{ref,R}} = -100.0$, $E_{\\mathrm{ref,TS}} = -98.2$\n  - $\\mathcal{M}_{\\mathrm{R}} = [(1.0, 5.0), (0.7, 6.0)]$\n  - $\\Pi_{\\mathrm{R}} = [(0.5, 4.0), (0.4, 3.5)]$\n  - $\\mathcal{M}_{\\mathrm{TS}} = [(1.1, 5.2), (0.8, 6.1)]$\n  - $\\Pi_{\\mathrm{TS}} = [(0.6, 4.5), (0.45, 3.8)]$\n  - $\\beta_{\\mathrm{R}} = 0.6$, $\\beta_{\\mathrm{TS}} = 0.5$\n- 测试用例 2（边缘情况，$\\Pi$ 中存在近闯入者态分母）：\n  - $s = 6.8$\n  - $E_{\\mathrm{ref,R}} = -200.0$, $E_{\\mathrm{ref,TS}} = -198.7$\n  - $\\mathcal{M}_{\\mathrm{R}} = [(0.9, 5.5), (0.6, 7.0)]$\n  - $\\Pi_{\\mathrm{R}} = [(0.7, 0.2), (0.5, 0.3)]$\n  - $\\mathcal{M}_{\\mathrm{TS}} = [(0.95, 5.2), (0.65, 6.5)]$\n  - $\\Pi_{\\mathrm{TS}} = [(0.75, 0.25), (0.55, 0.35)]$\n  - $\\beta_{\\mathrm{R}} = 0.4$, $\\beta_{\\mathrm{TS}} = 0.7$\n- 测试用例 3（边界条件，$\\beta_{\\mathrm{R}} = \\beta_{\\mathrm{TS}} = 0$ 且两个状态的 $\\Pi$ 相同，因此能垒对 $\\Pi$ 不敏感）：\n  - $s = 6.8$\n  - $E_{\\mathrm{ref,R}} = -150.0$, $E_{\\mathrm{ref,TS}} = -148.9$\n  - $\\mathcal{M}_{\\mathrm{R}} = [(0.8, 5.0)]$\n  - $\\Pi_{\\mathrm{R}} = [(0.6, 4.0)]$\n  - $\\mathcal{M}_{\\mathrm{TS}} = [(0.8, 5.0)]$\n  - $\\Pi_{\\mathrm{TS}} = [(0.6, 4.0)]$\n  - $\\beta_{\\mathrm{R}} = 0.0$, $\\beta_{\\mathrm{TS}} = 0.0$\n- 测试用例 4（弱配体 $\\pi$ 耦合，小敏感性）：\n  - $s = 6.8$\n  - $E_{\\mathrm{ref,R}} = -120.0$, $E_{\\mathrm{ref,TS}} = -118.8$\n  - $\\mathcal{M}_{\\mathrm{R}} = [(1.0, 6.0), (0.5, 7.0)]$\n  - $\\Pi_{\\mathrm{R}} = [(0.1, 5.0), (0.05, 6.0)]$\n  - $\\mathcal{M}_{\\mathrm{TS}} = [(1.05, 6.1), (0.55, 7.2)]$\n  - $\\Pi_{\\mathrm{TS}} = [(0.12, 5.1), (0.06, 6.2)]$\n  - $\\beta_{\\mathrm{R}} = 0.5$, $\\beta_{\\mathrm{TS}} = 0.5$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的敏感性值（单位 $\\mathrm{eV}$），四舍五入到六位小数，格式为用方括号括起来的逗号分隔列表，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$，列表内无空格。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、良定且自洽的。所提供的模型虽然是完整活性空间二阶微扰理论 (CASPT2) 全计算的简化，但其内部是一致的，并基于计算化学中使用的多参考微扰理论的原理。因此，我们可以着手推导解决方案。\n\n核心任务是计算一个敏感性度量 $S$，它量化了当配体 $\\pi$ 轨道从外部空间（进行微扰处理）移入参考活性空间时反应能垒高度的变化。敏感性定义为配体 $\\pi$ 轨道包含在参考空间中的能垒高度 $\\Delta E_{\\mathrm{incl}}$ 与排除在外的能垒高度 $\\Delta E_{\\mathrm{excl}}$ 之间的差值。\n\n$S = \\Delta E_{\\mathrm{incl}} - \\Delta E_{\\mathrm{excl}}$\n\n首先，让我们为一个通用状态（可以是反应物 $\\mathrm{R}$ 或过渡态 $\\mathrm{TS}$）形式化其能量表达式。一组激发 $\\mathcal{X}$ 的二阶微扰能量校正由标准的 Rayleigh–Schrödinger 公式给出，其中包含了 IPEA 位移 $s$：\n$$E^{(2)}(\\mathcal{X}, s) = -\\sum_{k \\in \\mathcal{X}} \\frac{V_k^2}{\\Delta_k + s}$$\n其中对于每次激发 $k$，$V_k$ 是耦合强度，$\\Delta_k$ 是未位移的能量分母。所有量均以电子伏特 ($\\mathrm{eV}$) 为单位。\n\n我们现在可以为所提出的两种情景定义总能量。\n\n**1. 排除情景**\n在这种情景下，以金属为中心的激发 ($\\mathcal{M}$) 和配体 $\\pi$ 激发 ($\\Pi$) 都对二阶微扰校正有贡献。给定状态（反应物或过渡态）的总能量为：\n$$E_{\\mathrm{state,excl}} = E_{\\mathrm{ref,state}} + E^{(2)}(\\mathcal{M}_{\\mathrm{state}}, s) + E^{(2)}(\\Pi_{\\mathrm{state}}, s)$$\n排除情景下的反应能垒高度是过渡态和反应物总能量的差值：\n$$\\Delta E_{\\mathrm{excl}} = E_{\\mathrm{TS,excl}} - E_{\\mathrm{R,excl}}$$\n$$\\Delta E_{\\mathrm{excl}} = \\left( E_{\\mathrm{ref,TS}} + E^{(2)}(\\mathcal{M}_{\\mathrm{TS}}, s) + E^{(2)}(\\Pi_{\\mathrm{TS}}, s) \\right) - \\left( E_{\\mathrm{ref,R}} + E^{(2)}(\\mathcal{M}_{\\mathrm{R}}, s) + E^{(2)}(\\Pi_{\\mathrm{R}}, s) \\right)$$\n\n**2. 包含情景**\n在这种情景下，配体 $\\pi$ 轨道是参考活性空间的一部分。因此，只有以金属为中心的激发 ($\\mathcal{M}$) 对二阶校正有贡献。一部分配体 $\\pi$ 的微扰能量，按因子 $\\beta_{\\mathrm{state}}$ 缩放后，被并入零阶参考能量中。\n$$E_{\\mathrm{state,incl}} = E_{\\mathrm{ref,state}} + \\beta_{\\mathrm{state}} E^{(2)}(\\Pi_{\\mathrm{state}}, s) + E^{(2)}(\\mathcal{M}_{\\mathrm{state}}, s)$$\n相应的能垒高度为：\n$$\\Delta E_{\\mathrm{incl}} = E_{\\mathrm{TS,incl}} - E_{\\mathrm{R,incl}}$$\n$$\\Delta E_{\\mathrm{incl}} = \\left( E_{\\mathrm{ref,TS}} + \\beta_{\\mathrm{TS}} E^{(2)}(\\Pi_{\\mathrm{TS}}, s) + E^{(2)}(\\mathcal{M}_{\\mathrm{TS}}, s) \\right) - \\left( E_{\\mathrm{ref,R}} + \\beta_{\\mathrm{R}} E^{(2)}(\\Pi_{\\mathrm{R}}, s) + E^{(2)}(\\mathcal{M}_{\\mathrm{R}}, s) \\right)$$\n\n**敏感性度量 $S$ 的推导**\n我们现在将 $\\Delta E_{\\mathrm{incl}}$ 和 $\\Delta E_{\\mathrm{excl}}$ 的表达式代入 $S$ 的定义中：\n$$S = \\Delta E_{\\mathrm{incl}} - \\Delta E_{\\mathrm{excl}}$$\n让我们按各项的物理来源（参考、金属中心、配体 $\\pi$）进行分组：\n$$\\Delta E_{\\mathrm{incl}} = (E_{\\mathrm{ref,TS}} - E_{\\mathrm{ref,R}}) + (E^{(2)}(\\mathcal{M}_{\\mathrm{TS}}, s) - E^{(2)}(\\mathcal{M}_{\\mathrm{R}}, s)) + (\\beta_{\\mathrm{TS}} E^{(2)}(\\Pi_{\\mathrm{TS}}, s) - \\beta_{\\mathrm{R}} E^{(2)}(\\Pi_{\\mathrm{R}}, s))$$\n$$\\Delta E_{\\mathrm{excl}} = (E_{\\mathrm{ref,TS}} - E_{\\mathrm{ref,R}}) + (E^{(2)}(\\mathcal{M}_{\\mathrm{TS}}, s) - E^{(2)}(\\mathcal{M}_{\\mathrm{R}}, s)) + (E^{(2)}(\\Pi_{\\mathrm{TS}}, s) - E^{(2)}(\\Pi_{\\mathrm{R}}, s))$$\n相减之后，我们观察到来自参考能量 ($E_{\\mathrm{ref}}$) 和金属中心激发 ($E^{(2)}(\\mathcal{M}, s)$) 的贡献完全抵消：\n$$S = (\\beta_{\\mathrm{TS}} E^{(2)}(\\Pi_{\\mathrm{TS}}, s) - \\beta_{\\mathrm{R}} E^{(2)}(\\Pi_{\\mathrm{R}}, s)) - (E^{(2)}(\\Pi_{\\mathrm{TS}}, s) - E^{(2)}(\\Pi_{\\mathrm{R}}, s))$$\n重新整理各项，可以得到一个关于敏感性的简化而优雅的表达式：\n$$S = E^{(2)}(\\Pi_{\\mathrm{R}}, s) (1 - \\beta_{\\mathrm{R}}) - E^{(2)}(\\Pi_{\\mathrm{TS}}, s) (1 - \\beta_{\\mathrm{TS}})$$\n这个最终表达式揭示了敏感性 $S$ 仅取决于配体 $\\pi$ 激发的微扰校正及其各自的重整化因子。参数 $E_{\\mathrm{ref,R}}$、$E_{\\mathrm{ref,TS}}$、$\\mathcal{M}_{\\mathrm{R}}$ 和 $\\mathcal{M}_{\\mathrm{TS}}$ 对于计算 $S$ 而言是无关的，这是一个严谨的分析必须指出的事实。\n\n解决该问题的算法如下：\n1. 对每个测试用例，提取相关参数：IPEA 位移 $s$、配体 $\\pi$ 激发集 $\\Pi_{\\mathrm{R}}$ 和 $\\Pi_{\\mathrm{TS}}$，以及重整化因子 $\\beta_{\\mathrm{R}}$ 和 $\\beta_{\\mathrm{TS}}$。\n2. 实现一个根据其定义计算 $E^{(2)}(\\mathcal{X}, s)$ 的函数。\n3. 计算反应物和过渡态的配体 $\\pi$ 二阶能量校正：$E^{(2)}(\\Pi_{\\mathrm{R}}, s)$ 和 $E^{(2)}(\\Pi_{\\mathrm{TS}}, s)$。\n4. 使用简化公式计算敏感性 $S$。\n5. 按要求将最终值四舍五入到六位小数。\n此程序将为所有提供的测试用例实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the sensitivity of CASPT2 barrier heights to the inclusion/exclusion\n    of ligand pi orbitals in the active space.\n    \"\"\"\n\n    # Test suite parameters as defined in the problem statement.\n    # Each case is a tuple: (s, E_ref_R, E_ref_TS, M_R, Pi_R, M_TS, Pi_TS, beta_R, beta_TS)\n    # Note: E_ref and M sets are not needed for the final calculation of S,\n    # but are kept here for completeness relative to the problem description.\n    test_cases = [\n        # Test case 1\n        (\n            6.8,  # s\n            -100.0, -98.2,  # E_ref_R, E_ref_TS\n            [(1.0, 5.0), (0.7, 6.0)],  # M_R\n            [(0.5, 4.0), (0.4, 3.5)],  # Pi_R\n            [(1.1, 5.2), (0.8, 6.1)],  # M_TS\n            [(0.6, 4.5), (0.45, 3.8)],  # Pi_TS\n            0.6, 0.5  # beta_R, beta_TS\n        ),\n        # Test case 2\n        (\n            6.8,  # s\n            -200.0, -198.7,  # E_ref_R, E_ref_TS\n            [(0.9, 5.5), (0.6, 7.0)], # M_R\n            [(0.7, 0.2), (0.5, 0.3)],  # Pi_R\n            [(0.95, 5.2), (0.65, 6.5)],  # M_TS\n            [(0.75, 0.25), (0.55, 0.35)],  # Pi_TS\n            0.4, 0.7  # beta_R, beta_TS\n        ),\n        # Test case 3\n        (\n            6.8,  # s\n            -150.0, -148.9,  # E_ref_R, E_ref_TS\n            [(0.8, 5.0)],  # M_R\n            [(0.6, 4.0)],  # Pi_R\n            [(0.8, 5.0)],  # M_TS\n            [(0.6, 4.0)],  # Pi_TS\n            0.0, 0.0  # beta_R, beta_TS\n        ),\n        # Test case 4\n        (\n            6.8,  # s\n            -120.0, -118.8,  # E_ref_R, E_ref_TS\n            [(1.0, 6.0), (0.5, 7.0)], # M_R\n            [(0.1, 5.0), (0.05, 6.0)],  # Pi_R\n            [(1.05, 6.1), (0.55, 7.2)],  # M_TS\n            [(0.12, 5.1), (0.06, 6.2)],  # Pi_TS\n            0.5, 0.5  # beta_R, beta_TS\n        )\n    ]\n\n    def calculate_E2(excitations, s):\n        \"\"\"\n        Calculates the second-order perturbation energy correction.\n        E_2 = -sum_k (V_k^2 / (Delta_k + s))\n\n        Args:\n            excitations (list of tuples): A list of (V_k, Delta_k) pairs.\n            s (float): The IPEA shift.\n\n        Returns:\n            float: The total second-order energy correction.\n        \"\"\"\n        e2_correction = 0.0\n        for v_k, delta_k in excitations:\n            denominator = delta_k + s\n            # The problem setup ensures denominators are positive.\n            e2_correction -= (v_k**2) / denominator\n        return e2_correction\n\n    results = []\n    for case in test_cases:\n        s, _, _, _, pi_r, _, pi_ts, beta_r, beta_ts = case\n\n        # Calculate the second-order corrections for the ligand pi orbitals\n        e2_pi_r = calculate_E2(pi_r, s)\n        e2_pi_ts = calculate_E2(pi_ts, s)\n\n        # Calculate the sensitivity S using the derived simplified formula:\n        # S = (1 - beta_R) * E_2(Pi_R) - (1 - beta_TS) * E_2(Pi_TS)\n        sensitivity = (1 - beta_r) * e2_pi_r - (1 - beta_ts) * e2_pi_ts\n\n        # Round the result to six decimal places\n        results.append(round(sensitivity, 6))\n\n    # Format the final output string as [result1,result2,result3,result4]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}