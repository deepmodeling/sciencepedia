{
    "hands_on_practices": [
        {
            "introduction": "为了充分理解拟牛顿法的强大之处，我们首先需要探究经典牛顿法在何种情况下会失效。这个练习通过一个具体的催化参数估计问题，揭示了当目标函数的Hessian矩阵不定时，牛顿法可能产生一个上升方向而非预期的下降方向。通过亲手计算并验证这一过程，您将深刻体会到为何需要更稳健的算法来保证优化的收敛性。",
            "id": "3897692",
            "problem": "在多相催化的动力学参数估计中，通常需要在机理约束和数据拟合之间进行权衡。假设一位工程师将布朗斯特-埃文斯-波拉尼关系（活化能与吸附能的关系）作为软约束，同时引入了一个数据驱动的正则化器，该正则化器（错误地）奖励强吸附。由此产生的替代目标函数，其参数为吸附能 $x$ 和活化能 $y$（单位均为电子伏特），表达式为\n$$\nf(x,y) \\;=\\; \\big(y - a - b\\,x\\big)^2 \\;-\\; \\gamma\\,x^2,\n$$\n其中 $a>0$ 和 $b>0$ 编码了机理直线关系，而 $\\gamma>0$ 是（设定有误的）正则化权重。假设 $a=0.5$，$b=0.8$，$\\gamma=1.0$，并考虑起始点 $x_0=(x,y)=(1.0,\\,1.0)$。\n\n根据无约束最小化的牛顿法定义，某一点的牛顿方向 $p$ 满足 $H(x)p=-\\nabla f(x)$，其中 $\\nabla f$ 和 $H$ 分别是 $f$ 的梯度和Hessian矩阵。一个方向 $p$ 是下降方向，当且仅当 $\\nabla f(x)^{\\top} p  0$。充分下降（Armijo）准则仅在对于某个 $c_1\\in(0,1)$ 满足 $f(x+\\alpha p)\\le f(x)+c_1 \\alpha \\nabla f(x)^{\\top} p$ 时，才接受步长 $\\alpha0$。\n\n对于本例，下列哪些陈述是正确的？\n\nA. 在 $x_0$ 点，Hessian矩阵是不定的，牛顿步为 $p=(-1.0,\\,-0.5)^{\\top}$，且 $\\nabla f(x_0)^{\\top}p0$，因此单位牛顿步会导致 $f$ 从 $-0.91$ 增加到 $0$。\n\nB. 即使Hessian矩阵是不定的，非零梯度也能保证牛顿方向是下降方向，因此纯牛顿法不会发散。\n\nC. 在 $x_0$ 点，执行Armijo条件的折返线搜索无法在纯牛顿方向上找到任何能使 $f$ 减小的 $\\alpha\\in(0,1]$，因此该方法要么停滞，要么需要安全措施。\n\nD. 将精确Hessian矩阵替换为通过Broyden–Fletcher–Goldfarb–Shanno (BFGS) 方法更新的正定近似矩阵，从一个正定的初始矩阵开始，并使用强制执行曲率条件的线搜索，会在 $x_0$ 点产生一个下降方向。\n\nE. 添加一个莱文伯格-马夸特(Levenberg–Marquardt)对角位移，即用 $H(x_0)+\\lambda I$ 替换 $H(x_0)$，其中 $\\lambda-\\lambda_{\\min}(H(x_0))$，可以使系统变为正定，并迫使牛顿方向成为下降方向；对于给定的数值，任何 $\\lambda1.5$ 都足够。\n\n选择所有适用的选项。",
            "solution": "该问题提供了一个催化参数估计问题的替代目标函数，由 $f(x,y) = (y - a - bx)^2 - \\gamma x^2$ 给出。参数指定为 $a=0.5$，$b=0.8$ 和 $\\gamma=1.0$。优化程序的起始点为 $x_0 = (x,y) = (1.0, 1.0)$。我们需要评估关于牛顿法及其变体在该点行为的几个陈述。\n\n首先，我们必须计算在 $x_0$ 点的函数值、梯度和Hessian矩阵。\n给定参数的目标函数是：\n$$\nf(x,y) = (y - 0.5 - 0.8x)^2 - x^2\n$$\n\n梯度向量 $\\nabla f(x,y)$ 的分量为：\n$$\n\\frac{\\partial f}{\\partial x} = 2(y - 0.5 - 0.8x)(-0.8) - 2x = -1.6(y - 0.5 - 0.8x) - 2x\n$$\n$$\n\\frac{\\partial f}{\\partial y} = 2(y - 0.5 - 0.8x)(1) = 2(y - 0.5 - 0.8x)\n$$\n\nHessian矩阵 $H(x,y)$，对于此二次函数而言是常数，其分量为：\n$$\n\\frac{\\partial^2 f}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left(-1.6y + 0.8 + 1.28x - 2x\\right) = 1.28 - 2.0 = -0.72\n$$\n$$\n\\frac{\\partial^2 f}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left(2y - 1.0 - 1.6x\\right) = 2.0\n$$\n$$\n\\frac{\\partial^2 f}{\\partial x \\partial y} = \\frac{\\partial^2 f}{\\partial y \\partial x} = \\frac{\\partial}{\\partial y} \\left(-1.6y + 0.8 + 1.28x - 2x\\right) = -1.6\n$$\n因此，Hessian矩阵为：\n$$\nH = \\begin{pmatrix} -0.72  -1.6 \\\\ -1.6  2.0 \\end{pmatrix}\n$$\n\n现在，我们在特定点 $x_0 = (1.0, 1.0)$ 处计算这些量：\n函数值：\n$$\nf(1.0, 1.0) = (1.0 - 0.5 - 0.8(1.0))^2 - (1.0)^2 = (-0.3)^2 - 1.0 = 0.09 - 1.0 = -0.91\n$$\n$x_0$ 处的梯度：\n$$\n\\nabla f(x_0) = \\begin{pmatrix} -1.6(-0.3) - 2(1.0) \\\\ 2(-0.3) \\end{pmatrix} = \\begin{pmatrix} 0.48 - 2.0 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} -1.52 \\\\ -0.6 \\end{pmatrix}\n$$\n\n有了这些量，我们现在可以分析每个选项。\n\n### 逐项分析\n\n**A. 在 $x_0$ 点，Hessian矩阵是不定的，牛顿步为 $p=(-1.0,\\,-0.5)^{\\top}$，且 $\\nabla f(x_0)^{\\top}p0$，因此单位牛顿步会导致 $f$ 从 $-0.91$ 增加到 $0$。**\n\n1.  **Hessian矩阵的不定性**：我们检查Hessian矩阵的行列式：\n    $$\n    \\det(H) = (-0.72)(2.0) - (-1.6)^2 = -1.44 - 2.56 = -4.0\n    $$\n    由于 $\\det(H)  0$，特征值符号相反，这意味着Hessian矩阵是不定的。这部分是正确的。\n\n2.  **牛顿步 $p$**：牛顿方向 $p$ 通过求解 $H p = -\\nabla f(x_0)$ 得到。\n    $$\n    \\begin{pmatrix} -0.72  -1.6 \\\\ -1.6  2.0 \\end{pmatrix} \\begin{pmatrix} p_x \\\\ p_y \\end{pmatrix} = -\\begin{pmatrix} -1.52 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} 1.52 \\\\ 0.6 \\end{pmatrix}\n    $$\n    从第二个方程，$-1.6 p_x + 2.0 p_y = 0.6$，简化为 $p_y = 0.3 + 0.8 p_x$。代入第一个方程：\n    $$\n    -0.72 p_x - 1.6(0.3 + 0.8 p_x) = 1.52 \\implies -0.72 p_x - 0.48 - 1.28 p_x = 1.52\n    $$\n    $$\n    -2.0 p_x = 2.0 \\implies p_x = -1.0\n    $$\n    然后，$p_y = 0.3 + 0.8(-1.0) = -0.5$。牛顿步是 $p = (-1.0, -0.5)^{\\top}$。这部分是正确的。\n\n3.  **方向导数**：我们通过计算 $\\nabla f(x_0)^{\\top}p$ 来检查 $p$ 是否为下降方向。\n    $$\n    \\nabla f(x_0)^{\\top}p = \\begin{pmatrix} -1.52  -0.6 \\end{pmatrix} \\begin{pmatrix} -1.0 \\\\ -0.5 \\end{pmatrix} = (-1.52)(-1.0) + (-0.6)(-0.5) = 1.52 + 0.30 = 1.82\n    $$\n    由于 $\\nabla f(x_0)^{\\top}p = 1.82  0$，牛顿方向是上升方向，而不是下降方向。这部分是正确的。\n\n4.  **步长后的函数值**：一个单位牛顿步（$\\alpha=1$）会到达点 $x_1 = x_0 + p = (1.0, 1.0) + (-1.0, -0.5) = (0.0, 0.5)$。这个新点的函数值是：\n    $$\n    f(0.0, 0.5) = (0.5 - 0.5 - 0.8(0.0))^2 - (0.0)^2 = 0^2 - 0 = 0\n    $$\n    函数值从 $f(x_0) = -0.91$ 增加到 $f(x_1) = 0$。这部分是正确的。实际上，对于一个二次函数，一步牛顿法会直接到达唯一的驻点，在本例中由于Hessian矩阵不定，该驻点是一个鞍点。\n\n此陈述中的所有论断都是正确的。\n**结论：正确**\n\n**B. 即使Hessian矩阵是不定的，非零梯度也能保证牛顿方向是下降方向，因此纯牛顿法不会发散。**\n\n这是一个关于牛顿法性质的一般性陈述。一个方向 $p$ 是下降方向，如果 $\\nabla f(x)^{\\top}p  0$。牛顿方向是 $p = -H(x)^{-1}\\nabla f(x)$。方向导数是 $\\nabla f(x)^{\\top}p = -\\nabla f(x)^{\\top}H(x)^{-1}\\nabla f(x)$。只有当 $H(x)^{-1}$（因此 $H(x)$）是正定时，才能保证这个量是负的。如果 $H(x)$ 是不定的，则没有这样的保证。\n本问题提供了一个反例：在 $x_0$ 点，Hessian矩阵是不定的，梯度非零，但我们发现牛顿方向是上升方向（$\\nabla f(x_0)^{\\top}p  0$）。因此，该陈述的前提是错误的。\n**结论：不正确**\n\n**C. 在 $x_0$ 点，执行Armijo条件的折返线搜索无法在纯牛顿方向上找到任何能使 $f$ 减小的 $\\alpha\\in(0,1]$，因此该方法要么停滞，要么需要安全措施。**\n\n让我们分析从 $x_0=(1.0,1.0)$ 开始，沿着牛顿方向 $p = (-1.0, -0.5)^{\\top}$ 的函数值变化。\n设 $\\phi(\\alpha) = f(x_0 + \\alpha p) = f(1.0-\\alpha, 1.0-0.5\\alpha)$，对于 $\\alpha \\ge 0$。\n$$\n\\phi(\\alpha) = ((1.0-0.5\\alpha) - 0.5 - 0.8(1.0-\\alpha))^2 - (1.0-\\alpha)^2\n$$\n$$\n\\phi(\\alpha) = (1.0-0.5\\alpha-0.5-0.8+0.8\\alpha)^2 - (1.0-\\alpha)^2 = (-0.3+0.3\\alpha)^2 - (1.0-\\alpha)^2\n$$\n$$\n\\phi(\\alpha) = 0.09(\\alpha-1.0)^2 - (1.0-\\alpha)^2 = 0.09(1.0-\\alpha)^2 - (1.0-\\alpha)^2 = -0.91(1.0-\\alpha)^2\n$$\n初始函数值为 $f(x_0) = \\phi(0) = -0.91$。我们要检查是否能找到一个 $\\alpha \\in (0,1]$ 使得 $\\phi(\\alpha)  \\phi(0)$，即 $-0.91(1.0-\\alpha)^2  -0.91$。这可以简化为 $(1.0-\\alpha)^2  1.0$。对于 $\\alpha \\in (0,1]$，我们有 $1.0-\\alpha \\in [0, 1)$，所以 $(1.0-\\alpha)^2 \\in [0, 1)$。不等式 $(1.0-\\alpha)^2  1.0$ 永远不会满足。事实上，对于 $(0,1)$ 内的任何步长，$f$ 都是严格递增的。\n因此，关于折返线搜索找不到能*减小* $f$ 的 $\\alpha \\in (0,1]$ 的陈述是正确的。由于牛顿方向是一个上升方向，一个稳健的优化算法不会继续进行线搜索。它必须首先应用“安全措施”，例如修改Hessian矩阵使其正定，或切换到另一个方向（如最速下降方向）。如果使用要求函数值下降的简单线搜索，它将无法找到可接受的步长并会“停滞”。因此，整个陈述是正确的。\n**结论：正确**\n\n**D. 将精确Hessian矩阵替换为通过Broyden–Fletcher–Goldfarb–Shanno (BFGS) 方法更新的正定近似矩阵，从一个正定的初始矩阵开始，并使用强制执行曲率条件的线搜索，会在 $x_0$ 点产生一个下降方向。**\n\n这描述了拟牛顿法（BFGS）的第一步。在第 $k=0$ 步（我们的点 $x_0$）的搜索方向由 $p_0 = -B_0^{-1} \\nabla f(x_0)$ 给出，其中 $B_0$ 是Hessian矩阵的初始近似。BFGS方法要求从一个正定矩阵 $B_0$ 开始（例如 $B_0=I$）。$x_0$ 处沿 $p_0$ 的方向导数是：\n$$\n\\nabla f(x_0)^{\\top} p_0 = \\nabla f(x_0)^{\\top} (-B_0^{-1} \\nabla f(x_0)) = - \\nabla f(x_0)^{\\top} B_0^{-1} \\nabla f(x_0)\n$$\n由于 $B_0$ 是正定的，它的逆矩阵 $B_0^{-1}$ 也是正定的。对于任何非零向量 $v$，二次型 $v^{\\top} B_0^{-1} v$ 严格为正。我们的梯度 $\\nabla f(x_0)$ 是一个非零向量。因此，$\\nabla f(x_0)^{\\top} B_0^{-1} \\nabla f(x_0)  0$。这意味着 $\\nabla f(x_0)^{\\top} p_0  0$。根据定义，$p_0$ 是一个下降方向。其余信息（BFGS更新、曲率条件）确保此性质在后续步骤中得以保持，但关于 $x_0$ 处方向的论断仅基于从正定 $B_0$ 开始就已成立。\n**结论：正确**\n\n**E. 添加一个莱文伯格-马夸特(Levenberg–Marquardt)对角位移，即用 $H(x_0)+\\lambda I$ 替换 $H(x_0)$，其中 $\\lambda-\\lambda_{\\min}(H(x_0))$，可以使系统变为正定，并迫使牛顿方向成为下降方向；对于给定的数值，任何 $\\lambda1.5$ 都足够。**\n\n1.  **一般原理**：这描述了一种修正牛顿法。修正后的Hessian矩阵是 $H_{mod} = H + \\lambda I$。$H_{mod}$ 的特征值是 $\\mu_i = \\lambda_i + \\lambda$，其中 $\\lambda_i$ 是 $H$ 的特征值。要使 $H_{mod}$ 为正定，我们要求所有 $\\mu_i  0$，这意味着对所有 $i$ 都有 $\\lambda_i + \\lambda  0$。这等价于对所有 $i$ 都有 $\\lambda  -\\lambda_i$，或者 $\\lambda  -\\min_i(\\lambda_i) = -\\lambda_{\\min}(H)$。如果这个条件成立，$H_{mod}$ 就是正定的。修正后的牛顿方向 $p_{mod} = -H_{mod}^{-1} \\nabla f(x_0)$ 随后就保证是一个下降方向，原因与选项D中的推理相同。所述的一般原理是正确的。\n\n2.  **具体计算**：我们需要找到 $\\lambda_{\\min}(H(x_0))$。特征值是特征方程 $\\det(H - \\lambda I) = 0$ 的根：\n    $$\n    (-0.72 - \\lambda)(2.0 - \\lambda) - (-1.6)^2 = 0\n    $$\n    $$\n    \\lambda^2 - 1.28\\lambda - 1.44 - 2.56 = 0 \\implies \\lambda^2 - 1.28\\lambda - 4.0 = 0\n    $$\n    使用二次公式：\n    $$\n    \\lambda = \\frac{1.28 \\pm \\sqrt{(-1.28)^2 - 4(1)(-4.0)}}{2} = \\frac{1.28 \\pm \\sqrt{1.6384 + 16.0}}{2} = \\frac{1.28 \\pm \\sqrt{17.6384}}{2}\n    $$\n    最小特征值为：\n    $$\n    \\lambda_{\\min} = \\frac{1.28 - \\sqrt{17.6384}}{2} \\approx \\frac{1.28 - 4.1998}{2} = \\frac{-2.9198}{2} = -1.4599\n    $$\n    正定性的条件是 $\\lambda  -\\lambda_{\\min} = -(-1.4599) = 1.4599$。\n    该陈述声称任何 $\\lambda  1.5$ 都足够。由于 $1.5  1.4599$，这个论断是正确的。\n\n陈述的两个部分都已验证为正确。\n**结论：正确**",
            "answer": "$$\\boxed{ACDE}$$"
        },
        {
            "introduction": "在认识到牛顿法的局限性后，我们来学习拟牛顿法的核心——BFGS更新。这个练习将引导您完成一次完整的BFGS迭代计算，从给定的当前Hessian矩阵近似 $B_k$ 出发，利用梯度信息来构建一个更精确的新近似 $B_{k+1}$。这个实践旨在帮您掌握BFGS更新公式的机械步骤，并验证其如何巧妙地满足割线条件，为后续更复杂的算法打下坚实基础。",
            "id": "3897712",
            "problem": "在一个双参数微观动力学催化模型中，参数 $x \\in \\mathbb{R}^{2}$ 代表一个标度化的吸附焓和一个标度化的活化能垒，两者都通过除以适当的参考量级进行了无量纲化，使得目标函数是无量纲的。该模型的校准通过最小化预测和测量的转换频率之间的二次连续可微最小二乘失配函数 $f(x)$ 来进行，并且 $f$ 的曲率由一个对称正定矩阵 $B_{k}$ 迭代逼近。\n\n假设在第 $k$ 次迭代时，从校准后的微观动力学模拟器中获得了拟牛顿步 $s_{k} = x_{k+1} - x_{k}$ 和相应的梯度变化 $y_{k} = \\nabla f(x_{k+1}) - \\nabla f(x_{k})$，其值为\n$$\nB_{k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad s_{k} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix}, \\quad y_{k} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix}.\n$$\n使用 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 更新方法，该方法强制保证由 $\\nabla f$ 的一阶泰勒展开产生的梯度映射的对称性和割线条件，数值计算下一个曲率近似 $B_{k+1}$，并验证割线条件 $B_{k+1} s_{k} = y_{k}$。\n\n请报告 $B_{k+1}$ 的行列式 $\\det(B_{k+1})$ 作为你的最终答案，它是一个无量纲的实数。无需四舍五入；如果给出有理数值，请以最简精确形式表示。",
            "solution": "Hessian 矩阵近似 $B_{k+1}$ 的 BFGS 更新公式为：\n$$\nB_{k+1} = B_k - \\frac{B_k s_k s_k^T B_k^T}{s_k^T B_k s_k} + \\frac{y_k y_k^T}{y_k^T s_k}\n$$\n鉴于 $B_k$ 是对称的，即 $B_k^T = B_k$，公式简化为：\n$$\nB_{k+1} = B_k - \\frac{B_k s_k s_k^T B_k}{s_k^T B_k s_k} + \\frac{y_k y_k^T}{y_k^T s_k}\n$$\n给定的值为：\n$$\nB_{k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad s_{k} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix}, \\quad y_{k} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix}\n$$\n我们使用精确的分数表示来保持精度：$s_k = \\begin{pmatrix} 1/5 \\\\ -1/10 \\end{pmatrix}$ 和 $y_k = \\begin{pmatrix} 3/10 \\\\ -1/20 \\end{pmatrix}$。\n\n首先，我们验证曲率条件 $s_k^T y_k  0$，这是为了确保更新是良定的并保持 Hessian 矩阵近似的正定性所必需的。\n$$\ny_k^T s_k = s_k^T y_k = \\begin{pmatrix} 0.2  -0.1 \\end{pmatrix} \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} = (0.2)(0.3) + (-0.1)(-0.05) = 0.06 + 0.005 = 0.065\n$$\n用分数形式表示：\n$$\ns_k^T y_k = \\left(\\frac{1}{5}\\right)\\left(\\frac{3}{10}\\right) + \\left(-\\frac{1}{10}\\right)\\left(-\\frac{1}{20}\\right) = \\frac{3}{50} + \\frac{1}{200} = \\frac{12}{200} + \\frac{1}{200} = \\frac{13}{200}\n$$\n由于 $s_k^T y_k = 13/200  0$，曲率条件得到满足。\n\n接下来，我们计算 BFGS 公式的各个组成部分。\n第一个修正项的分母是 $s_k^T B_k s_k$。因为 $B_k = I$（单位矩阵），这简化为 $s_k^T s_k$：\n$$\ns_k^T B_k s_k = s_k^T s_k = (0.2)^2 + (-0.1)^2 = 0.04 + 0.01 = 0.05 = \\frac{1}{20}\n$$\n第一个修正项是 $-\\frac{B_k s_k s_k^T B_k}{s_k^T B_k s_k}$。因为 $B_k = I$，这变成 $-\\frac{s_k s_k^T}{s_k^T s_k}$。\n外积 $s_k s_k^T$ 为：\n$$\ns_k s_k^T = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix} \\begin{pmatrix} 0.2  -0.1 \\end{pmatrix} = \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = \\begin{pmatrix} 1/25  -1/50 \\\\ -1/50  1/100 \\end{pmatrix}\n$$\n因此，第一个修正项为：\n$$\n-\\frac{1}{0.05} \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = -20 \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = \\begin{pmatrix} -0.8  0.4 \\\\ 0.4  -0.2 \\end{pmatrix} = \\begin{pmatrix} -4/5  2/5 \\\\ 2/5  -1/5 \\end{pmatrix}\n$$\n第二个修正项是 $\\frac{y_k y_k^T}{y_k^T s_k}$。分母是 $y_k^T s_k = 0.065 = 13/200$。\n外积 $y_k y_k^T$ 为：\n$$\ny_k y_k^T = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} \\begin{pmatrix} 0.3  -0.05 \\end{pmatrix} = \\begin{pmatrix} 0.09  -0.015 \\\\ -0.015  0.0025 \\end{pmatrix} = \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix}\n$$\n因此，第二个修正项为：\n$$\n\\frac{1}{13/200} \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix} = \\frac{200}{13} \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix} = \\begin{pmatrix} 18/13  -3/13 \\\\ -3/13  1/26 \\end{pmatrix}\n$$\n现在，我们组装 $B_{k+1}$：\n$$\nB_{k+1} = B_k - \\frac{s_k s_k^T}{s_k^T s_k} + \\frac{y_k y_k^T}{y_k^T s_k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} -4/5  2/5 \\\\ 2/5  -1/5 \\end{pmatrix} + \\begin{pmatrix} 18/13  -3/13 \\\\ -3/13  1/26 \\end{pmatrix}\n$$\n合并各项：\n$$\nB_{k+1} = \\begin{pmatrix} 1 - 4/5 + 18/13  0 + 2/5 - 3/13 \\\\ 0 + 2/5 - 3/13  1 - 1/5 + 1/26 \\end{pmatrix} = \\begin{pmatrix} 1/5 + 18/13  2/5 - 3/13 \\\\ 2/5 - 3/13  4/5 + 1/26 \\end{pmatrix}\n$$\n我们为每个元素找到公分母：\n元素 (1,1): $\\frac{1}{5} + \\frac{18}{13} = \\frac{13 + 90}{65} = \\frac{103}{65}$\n元素 (1,2) 和 (2,1): $\\frac{2}{5} - \\frac{3}{13} = \\frac{26 - 15}{65} = \\frac{11}{65}$\n元素 (2,2): $\\frac{4}{5} + \\frac{1}{26} = \\frac{104 + 5}{130} = \\frac{109}{130}$\n所以，更新后的 Hessian 矩阵近似为：\n$$\nB_{k+1} = \\begin{pmatrix} 103/65  11/65 \\\\ 11/65  109/130 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 206  22 \\\\ 22  109 \\end{pmatrix}\n$$\n接下来，我们验证割线条件 $B_{k+1} s_k = y_k$：\n$$\nB_{k+1} s_k = \\frac{1}{130} \\begin{pmatrix} 206  22 \\\\ 22  109 \\end{pmatrix} \\begin{pmatrix} 1/5 \\\\ -1/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 206/5 - 22/10 \\\\ 22/5 - 109/10 \\end{pmatrix}\n$$\n$$\nB_{k+1} s_k = \\frac{1}{130} \\begin{pmatrix} 412/10 - 22/10 \\\\ 44/10 - 109/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 390/10 \\\\ -65/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 39 \\\\ -6.5 \\end{pmatrix}\n$$\n$$\nB_{k+1} s_k = \\begin{pmatrix} 39/130 \\\\ -6.5/130 \\end{pmatrix} = \\begin{pmatrix} 3/10 \\\\ -1/20 \\end{pmatrix} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} = y_k\n$$\n割线条件得到满足。\n\n最后，我们计算 $B_{k+1}$ 的行列式：\n$$\n\\det(B_{k+1}) = \\det \\begin{pmatrix} 103/65  11/65 \\\\ 11/65  109/130 \\end{pmatrix} = \\left(\\frac{103}{65}\\right)\\left(\\frac{109}{130}\\right) - \\left(\\frac{11}{65}\\right)\\left(\\frac{11}{65}\\right)\n$$\n$$\n\\det(B_{k+1}) = \\frac{103 \\times 109}{65 \\times 130} - \\frac{11 \\times 11 \\times 2}{65 \\times 130} = \\frac{11227 - 242}{8450} = \\frac{10985}{8450}\n$$\n为了化简分数，我们注意到 $8450 = 10 \\times 845 = 10 \\times 5 \\times 169 = 50 \\times 13^2$。\n并且 $10985 = 5 \\times 2197 = 5 \\times 13^3$。\n$$\n\\det(B_{k+1}) = \\frac{5 \\times 13^3}{50 \\times 13^2} = \\frac{13}{10}\n$$\n或者，使用 BFGS 行列式更新恒等式：\n$$\n\\det(B_{k+1}) = \\det(B_k) \\frac{y_k^T s_k}{s_k^T B_k s_k} = \\det(I) \\frac{0.065}{0.05} = 1 \\times \\frac{65}{50} = \\frac{13}{10}\n$$\n两种方法得到相同的结果。$B_{k+1}$ 的行列式为 $13/10$。",
            "answer": "$$\n\\boxed{\\frac{13}{10}}\n$$"
        },
        {
            "introduction": "虽然BFGS方法解决了牛顿法的不稳定性问题，但它需要存储并操作一个稠密的 $n \\times n$ Hessian矩阵，这对于计算催化中的高维问题是不可行的。有限内存BFGS（L-BFGS）方法应运而生，它以极小的内存代价实现了优异的性能。本练习要求您推导并应用L-BFGS算法的核心——著名的双循环递归，这是将拟牛顿法从理论构想转化为实用工具的关键一步。",
            "id": "3897724",
            "problem": "一个多相催化反应器模型通过最小化正则化最小二乘目标函数 $f(x)$ 来校准，其中 $x \\in \\mathbb{R}^{n}$ 是动力学参数向量。在第 $k$ 次迭代中，一种拟牛顿法构造搜索方向 $p_{k} = -H_{k} \\nabla f(x_{k})$，其中 $H_{k}$ 是 $f$ 在 $x_{k}$ 处Hessian矩阵的逆矩阵的近似，而 $\\nabla f(x_{k})$ 是在当前迭代点的梯度。\n\n在限制内存的 Broyden–Fletcher–Goldfarb–Shanno (L-BFGS) 方法中，$H_{k}$ 是由一小组存储的曲率对 $(s_{i}, y_{i})$ 隐式构建的，其中 $s_{i} = x_{i+1} - x_{i}$ 和 $y_{i} = \\nabla f(x_{i+1}) - \\nabla f(x_{i})$，并满足正曲率条件 $s_{i}^{\\top} y_{i}  0$。初始逆Hessian模型取为 $H_{k}^{0} = \\gamma_{k} I$，其中 $\\gamma_{k}  0$ 是一个标量缩放因子，$I$ 是单位矩阵。\n\n从拟牛顿割线条件以及满足割线条件和正定性约束的 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 逆Hessian最小变化更新原则出发，推导L-BFGS双循环递归。该递归使用存储的曲率对 $(s_{i}, y_{i})$ 和初始缩放 $\\gamma_{k} I$ 来计算 $p_{k} = -H_{k} \\nabla f(x_{k})$。明确给出将 $q = \\nabla f(x_{k})$ 映射到 $p_{k}$ 的前向循环和后向循环变换。\n\n然后，将你推导出的递归应用于以下具有 $n=2$ 和内存大小 $m=2$ 的化学上合理的校准子问题：\n- 存储的曲率对：$s_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$， $y_{1} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$， $s_{2} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$， $y_{2} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前梯度：$\\nabla f(x_{k}) = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n- 初始缩放：$\\gamma_{k} = 0.4$。\n\n使用你的双循环递归计算最终的L-BFGS搜索方向 $p_k$。将你的最终向量答案表示为行矩阵，并将每个分量四舍五入到四位有效数字。对于此校准子问题，各分量是无量纲的。",
            "solution": "### 第1部分：L-BFGS双循环递归的推导\n\nBroyden–Fletcher–Goldfarb–Shanno (BFGS) 方法为逆Hessian近似矩阵 $H_k$ 提供了一个更新。给定当前的近似 $H_k$ 和一个新的曲率对 $(s_k, y_k)$，其中 $s_k = x_{k+1}-x_k$ 且 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$，更新后的逆Hessian矩阵 $H_{k+1}$ 可由下式紧凑地表示：\n$$H_{k+1} = (I - \\rho_k s_k y_k^\\top) H_k (I - \\rho_k y_k s_k^\\top) + \\rho_k s_k s_k^\\top$$\n其中 $\\rho_k = 1/(y_k^\\top s_k)$。条件 $s_k^\\top y_k  0$ 确保 $\\rho_k  0$。\n\n在限制内存的BFGS (L-BFGS) 方法中，矩阵 $H_k$ 不被显式存储。相反，在每次迭代 $k$ 中，它是通过对初始矩阵 $H_k^0 = \\gamma_k I$ 应用 $m$ 次BFGS更新公式来隐式构建的，使用的是 $m$ 个最近的曲率对 $(s_i, y_i)$，其中 $i = k-m, \\dots, k-1$。\n\n目标是在不构造矩阵 $H_k$ 的情况下计算乘积 $H_k q$，其中 $q = \\nabla f(x_k)$。这是通过L-BFGS双循环递归实现的。假设存储的曲率对按从旧到新的顺序索引：$(s_{k-m}, y_{k-m}), \\dots, (s_{k-1}, y_{k-1})$。矩阵 $H_k$ 是通过用这一序列的曲率对更新 $H_k^0$ 而形成的。\n\n双循环递归算法如下：\n令 $q = \\nabla f(x_k)$。\n1. **后向循环：**\n   对于 $i = k-1$ 降序至 $k-m$：\n   - $\\alpha_i = \\rho_i s_i^\\top q$\n   - $q = q - \\alpha_i y_i$\n   $\\alpha_i$ 的值被存储起来用于第二个循环。\n\n2. **初始Hessian乘积：**\n   - $r = H_k^0 q = \\gamma_k q$\n\n3. **前向循环：**\n   对于 $i = k-m$ 升序至 $k-1$：\n   - $\\beta = \\rho_i y_i^\\top r$\n   - $r = r + s_i (\\alpha_i - \\beta)$\n\n最终向量 $r$ 是 $H_k \\nabla f(x_k)$ 的结果，搜索方向是 $p_k = -r$。\n\n为了推导这一点，我们展示它在内存为 $m=1$ 时的正确性。设单个存储的对为 $(s, y)$，其中 $\\rho = 1/(y^\\top s)$。L-BFGS矩阵是 $H = (I - \\rho s y^\\top) H^0 (I - \\rho y s^\\top) + \\rho s s^\\top$。设初始梯度为 $q_{orig}$。我们必须证明该算法计算了 $H q_{orig}$。\n\n对 $m=1$ 应用该算法：\n1. $q=q_{orig}$。\n2. **后向循环 ($i=k-1$):**\n   $\\alpha = \\rho s^\\top q_{orig}$。\n   $q = q_{orig} - \\alpha y$。\n3. **初始Hessian乘积:**\n   $r = H^0 q = H^0(q_{orig} - \\alpha y)$。\n4. **前向循环 ($i=k-1$):**\n   $\\beta = \\rho y^\\top r = \\rho y^\\top H^0(q_{orig} - \\alpha y)$。\n   $r_{final} = r + s(\\alpha - \\beta) = H^0(q_{orig} - \\alpha y) + s(\\alpha - \\beta)$。\n\n现在，我们代入 $\\alpha$ 和 $\\beta$ 并展开 $r_{final}$：\n$r_{final} = H^0 q_{orig} - \\alpha H^0 y + \\alpha s - \\beta s$\n$r_{final} = H^0 q_{orig} - (\\rho s^\\top q_{orig}) H^0 y + (\\rho s^\\top q_{orig}) s - (\\rho y^\\top H^0(q_{orig} - \\alpha y)) s$\n$r_{final} = H^0 q_{orig} - \\rho (H^0 y s^\\top) q_{orig} + \\rho (s s^\\top) q_{orig} - \\rho (s y^\\top H^0) q_{orig} + \\rho (s y^\\top H^0 \\alpha y)$\n再次将 $\\alpha = \\rho s^\\top q_{orig}$ 代入最后一项：\n$r_{final} = H^0 q_{orig} - \\rho (H^0 y s^\\top + s y^\\top H^0) q_{orig} + \\rho (s s^\\top) q_{orig} + \\rho^2 (y^\\top H^0 y) (s s^\\top) q_{orig}$\n提出因子 $q_{orig}$：\n$r_{final} = \\left[ H^0 - \\rho(H^0 y s^\\top + s y^\\top H^0) + \\rho \\left(1 + \\rho (y^\\top H^0 y)\\right) s s^\\top \\right] q_{orig}$\n括号中的表达式正是从 $H^0$ 开始的 $H$ 的BFGS更新公式的另一种形式。因此，该算法正确地计算了 $H q_{orig}$。通过归纳法，这证明了双循环递归对任何内存大小 $m$ 都能正确计算矩阵-向量乘积。\n\n### 第2部分：应用于数值子问题\n\n给定以下信息：\n- 内存大小: $m=2$。\n- 问题用索引 $1$ 和 $2$ 标记曲率对。我们假设曲率对2是最新的，因此它对应于索引 $k-1$，曲率对1对应于 $k-2$。\n- $s_{k-2} = s_1 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$， $y_{k-2} = y_1 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n- $s_{k-1} = s_2 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$， $y_{k-1} = y_2 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前梯度: $\\nabla f(x_k) = q_{orig} = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n- 初始缩放: $\\gamma_k = 0.4$，所以 $H_k^0 = 0.4I$。\n\n首先，我们计算标量 $\\rho_i = 1/(y_i^\\top s_i)$:\n$\\rho_{k-2} = \\rho_1 = \\frac{1}{s_1^\\top y_1} = \\frac{1}{\\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}} = \\frac{1}{1} = 1$。\n$\\rho_{k-1} = \\rho_2 = \\frac{1}{s_2^\\top y_2} = \\frac{1}{\\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}} = \\frac{1}{2} = 0.5$。\n\n现在，我们执行双循环递归。\n初始化 $q = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n\n**后向循环：**\n- **对于 $i=k-1$ (曲率对2):**\n  $\\alpha_{k-1} = \\alpha_2 = \\rho_2 s_2^\\top q = 0.5 \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix} = 0.5 \\times 4 = 2$。\n  $q = q - \\alpha_2 y_2 = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 3 - 2 \\\\ 4 - 4 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n\n- **对于 $i=k-2$ (曲率对1):**\n  $\\alpha_{k-2} = \\alpha_1 = \\rho_1 s_1^\\top q = 1 \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = 1 \\times 1 = 1$。\n  $q = q - \\alpha_1 y_1 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 - 1 \\\\ 0 - 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n\n我们已经存储了 $\\alpha_1=1$ 和 $\\alpha_2=2$。\n\n**初始Hessian乘积：**\n$r = H_k^0 q = \\gamma_k q = 0.4 \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix}$。\n\n**前向循环：**\n- **对于 $i=k-2$ (曲率对1):**\n  $\\beta = \\rho_1 y_1^\\top r = 1 \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} = -0.4$。\n  $r = r + s_1(\\alpha_1 - \\beta) = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} (1 - (-0.4)) = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 1.4 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix}$。\n\n- **对于 $i=k-1$ (曲率对2):**\n  $\\beta = \\rho_2 y_2^\\top r = 0.5 \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} = 0.5 (1.4 - 0.8) = 0.5 \\times 0.6 = 0.3$。\n  $r = r + s_2(\\alpha_2 - \\beta) = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} (2 - 0.3) = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1.7 \\end{pmatrix} = \\begin{pmatrix} 1.4 \\\\ 1.3 \\end{pmatrix}$。\n\n递归的结果是 $H_k \\nabla f(x_k) = r = \\begin{pmatrix} 1.4 \\\\ 1.3 \\end{pmatrix}$。\n搜索方向是 $p_k = -r = \\begin{pmatrix} -1.4 \\\\ -1.3 \\end{pmatrix}$。\n\n问题要求最终答案为行矩阵形式，且各分量四舍五入到四位有效数字。\n$p_k = \\begin{pmatrix} -1.400  -1.300 \\end{pmatrix}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1.400  -1.300\n\\end{pmatrix}\n}\n$$"
        }
    ]
}