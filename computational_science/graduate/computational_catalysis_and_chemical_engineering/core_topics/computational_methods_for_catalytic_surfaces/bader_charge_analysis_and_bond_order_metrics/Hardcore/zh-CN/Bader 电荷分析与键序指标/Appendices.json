{
    "hands_on_practices": [
        {
            "introduction": "Bader电荷分析的基石在于对电子密度进行拓扑划分，其核心是零通量面（zero-flux surface）的概念。本练习通过一个简单的双原子模型，引导您从第一性原理出发，解析地推导零通量面的位置。这个基础练习旨在阐明该方法背后的数学原理，为您在后续更复杂的体系中应用和理解Bader分析打下坚实的基础 。",
            "id": "3869069",
            "problem": "考虑一个在分子中原子的量子理论 (QTAIM) 中使用的双原子模型系统，其中原子盆由电子密度梯度的零通量面定义。两个相同的原子沿 $x$ 轴放置在位置 $\\mathbf{R}_1 = (0,0,0)$ 和 $\\mathbf{R}_2 = (L,0,0)$ 处，其中 $L = 2.986$ Å。每个原子贡献一个球对称的高斯电子密度 $n_i(\\mathbf{r}) = \\alpha \\exp\\!\\big(-\\beta\\,|\\mathbf{r}-\\mathbf{R}_i|^2\\big)$，具有相同的振幅 $\\alpha  0$ 和衰减参数 $\\beta  0$。总密度为 $n(\\mathbf{r}) = n_1(\\mathbf{r}) + n_2(\\mathbf{r})$。\n\n从 QTAIM 的定义出发，即零通量面 $\\mathcal{S}$ 对于所有 $\\mathbf{r} \\in \\mathcal{S}$ 都满足 $\\nabla n(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}}(\\mathbf{r}) = 0$，其中 $\\hat{\\mathbf{n}}(\\mathbf{r})$ 是在 $\\mathbf{r}$ 处曲面的单位法向量，构建将空间划分为两个原子盆的零通量分割面。通过考虑系统的对称性并强制执行零通量条件，确定分割面沿核间轴（$x$ 轴）的位置 $x^{\\star}$，表示为沿 $x$ 轴的单个坐标值。\n\n将您的最终数值 $x^{\\star}$ 四舍五入到四位有效数字，并以埃（ångström）为单位表示。",
            "solution": "该问题要求我们找到一个模型双原子系统中沿核间轴的零通量分割面的位置。\n\n首先，我们建立总电子密度 $n(\\mathbf{r})$ 的数学表示。该系统由两个相同的原子组成，位于 $\\mathbf{R}_1 = (0,0,0)$ 和 $\\mathbf{R}_2 = (L,0,0)$。每个原子贡献一个球对称的高斯电子密度，由 $n_i(\\mathbf{r}) = \\alpha \\exp(-\\beta |\\mathbf{r}-\\mathbf{R}_i|^2)$ 给出。总电子密度是每个原子贡献的总和：\n$$n(\\mathbf{r}) = n_1(\\mathbf{r}) + n_2(\\mathbf{r})$$\n在笛卡尔坐标系中，其中 $\\mathbf{r} = (x,y,z)$，位置为 $\\mathbf{R}_1 = (0,0,0)$ 和 $\\mathbf{R}_2 = (L,0,0)$，且 $L = 2.986$ Å。密度为：\n$$n(x,y,z) = \\alpha \\exp(-\\beta(x^2+y^2+z^2)) + \\alpha \\exp(-\\beta((x-L)^2+y^2+z^2))$$\n其中 $\\alpha  0$ 和 $\\beta  0$。\n\n根据分子中原子的量子理论 (QTAIM)，空间被零通量面划分为原子盆。如果电子密度的梯度 $\\nabla n(\\mathbf{r})$ 没有垂直于曲面的分量，则曲面 $\\mathcal{S}$ 是一个零通量面。这由条件表示：\n$$\\nabla n(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}}(\\mathbf{r}) = 0$$\n对于曲面 $\\mathcal{S}$ 上的所有点 $\\mathbf{r}$，其中 $\\hat{\\mathbf{n}}(\\mathbf{r})$ 是在 $\\mathbf{r}$ 处曲面的单位法向量。\n\n考虑到问题的对称性——两个相同的原子相对于平面 $x=L/2$ 对称放置——我们可以假设分割面是垂直平分核间轴的平面。该平面由方程 $x = L/2$ 描述。该平面的单位法向量 $\\hat{\\mathbf{n}}$ 在各处都是恒定的，并沿 $x$ 轴方向，即 $\\hat{\\mathbf{n}} = (1, 0, 0)$。\n\n为了验证这个假设，我们必须检验零通量条件是否对平面 $x=L/2$ 上的所有点都成立。对于这个曲面，条件变为：\n$$\\nabla n(\\mathbf{r}) \\cdot (1,0,0) = \\frac{\\partial n}{\\partial x}\\bigg|_{\\mathbf{r} \\in \\mathcal{S}} = 0$$\n我们需要计算总密度 $n(x,y,z)$ 关于 $x$ 的偏导数：\n$$\\frac{\\partial n}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\alpha \\exp(-\\beta(x^2+y^2+z^2)) + \\alpha \\exp(-\\beta((x-L)^2+y^2+z^2)) \\right]$$\n使用链式法则，我们得到：\n$$\\frac{\\partial n}{\\partial x} = \\alpha \\left[ (-2\\beta x) \\exp(-\\beta(x^2+y^2+z^2)) + (-2\\beta(x-L)) \\exp(-\\beta((x-L)^2+y^2+z^2)) \\right]$$\n$$\\frac{\\partial n}{\\partial x} = -2\\alpha\\beta \\left[ x \\exp(-\\beta(x^2+y^2+z^2)) + (x-L) \\exp(-\\beta((x-L)^2+y^2+z^2)) \\right]$$\n\n现在，我们在所提出的曲面上的任意一点计算这个导数，其中 $x = L/2$：\n$$\\frac{\\partial n}{\\partial x}\\bigg|_{x=L/2} = -2\\alpha\\beta \\left[ \\frac{L}{2} \\exp\\left(-\\beta\\left(\\left(\\frac{L}{2}\\right)^2+y^2+z^2\\right)\\right) + \\left(\\frac{L}{2}-L\\right) \\exp\\left(-\\beta\\left(\\left(\\frac{L}{2}-L\\right)^2+y^2+z^2\\right)\\right) \\right]$$\n简化各项：\n$$\\frac{\\partial n}{\\partial x}\\bigg|_{x=L/2} = -2\\alpha\\beta \\left[ \\frac{L}{2} \\exp\\left(-\\beta\\left(\\frac{L^2}{4}+y^2+z^2\\right)\\right) - \\frac{L}{2} \\exp\\left(-\\beta\\left(\\left(-\\frac{L}{2}\\right)^2+y^2+z^2\\right)\\right) \\right]$$\n$$\\frac{\\partial n}{\\partial x}\\bigg|_{x=L/2} = -2\\alpha\\beta \\left[ \\frac{L}{2} \\exp\\left(-\\beta\\left(\\frac{L^2}{4}+y^2+z^2\\right)\\right) - \\frac{L}{2} \\exp\\left(-\\beta\\left(\\frac{L^2}{4}+y^2+z^2\\right)\\right) \\right]$$\n$$\\frac{\\partial n}{\\partial x}\\bigg|_{x=L/2} = -2\\alpha\\beta [0] = 0$$\n由于此结果对任意 $y$ 和 $z$ 的值都成立，因此条件 $\\frac{\\partial n}{\\partial x}=0$ 对平面 $x=L/2$ 上的所有点都满足。因此，平面 $x=L/2$ 确实是两个原子盆之间的零通量分割面。注意，这个结果与参数 $\\alpha$ 和 $\\beta$ 无关。\n\n问题要求的是分割面沿核间轴（$x$ 轴）的位置 $x^{\\star}$。这是曲面 $x=L/2$ 与 $x$ 轴相交点的 $x$ 坐标。这个交点发生在 $x=L/2$ 处。\n因此，$x^{\\star} = L/2$。\n\n给定核间距 $L = 2.986$ Å，我们可以计算 $x^{\\star}$ 的数值：\n$$x^{\\star} = \\frac{2.986}{2} = 1.493$$\n该值的单位是埃（ångström）。问题要求答案四舍五入到四位有效数字。计算出的值 $1.493$ 已经有四位有效数字。\n所以，分割面沿核间轴的位置是 $x^{\\star} = 1.493$ Å。",
            "answer": "$$\\boxed{1.493}$$"
        },
        {
            "introduction": "在确定了原子间的边界之后，下一个逻辑步骤便是计算这些边界内包含的电荷量。本练习将引导您将零通量面的概念应用于一个二维模型体系，通过对电子密度在Bader原子盆（Bader basin）内进行积分，从而得到Bader电荷。通过这个练习，您可以直观地理解从空间划分到电荷赋值的全过程，并体会对称性在简化问题中的妙用 。",
            "id": "3869067",
            "problem": "考虑分子中原子的量子理论 (QTAIM)，该理论通过电子密度梯度中的零通量条件将空间划分为原子盆，即在单位法向量为 $\\hat{\\mathbf{n}}$ 的边界上，条件 $\\nabla n(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}} = 0$ 成立。在一个用于模拟催化表面上双原子吸附质的二维玩具模型中，我们将价电子密度近似为两个中心位于 $(x,y) = (\\pm d, 0)$ 的归一化各向同性高斯峰之和：\n$$\nn(x,y) = \\frac{1}{\\pi \\sigma^{2}} \\exp\\!\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right) + \\frac{1}{\\pi \\sigma^{2}} \\exp\\!\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right),\n$$\n其中 $\\sigma  0$ 和 $d  0$ 是给定的实数参数。该密度函数有多个极大值点，且在它们之间有一个键临界点（一个鞍点），并且对于所有 $(x,y) \\in \\mathbb{R}^{2}$ 都严格为正。\n\n任务：\n- 使用 QTAIM 关于零通量边界的核心定义，确定将平面划分为两个 Bader 盆的零通量线的显式方程。这两个 Bader 盆分别对应于 $(x,y) = (\\pm d, 0)$ 处的两个极大值点。\n- 通过在由零通量线所界定的 $x  0$ 区域上对密度进行积分，计算分配给右侧盆（与 $(x,y) = (d,0)$ 处的极大值点相关联）的 Bader 电荷。假设高斯归一化如文中所写，并将 $n(x,y)$ 在任何区域上的积分解释为该区域内的电子数。\n\n将最终的 Bader 电荷表示为一个以电子为单位的实数。无需四舍五入。使用给定的归一化，使得每个高斯峰所代表的总电子数为 1 个电子。",
            "solution": "用户要求解答一个计算化学问题，具体来说，是将分子中原子的量子理论 (QTAIM) 应用于一个电子密度的玩具模型。\n\n### 步骤 1：提取已知条件\n- **电子密度函数**：\n$$\nn(x,y) = \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right) + \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right)\n$$\n- **参数**：$d  0$ 和 $\\sigma  0$ 是实数参数。\n- **QTAIM 零通量条件**：原子盆之间的边界由条件 $\\nabla n(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}} = 0$ 定义，其中 $\\hat{\\mathbf{n}}$ 是边界曲面的单位法向量。\n- **密度归一化**：每个高斯峰在全空间积分后对应 1 个电子。\n- **任务 1**：找出划分平面的零通量线的显式方程。\n- **任务 2**：计算右侧盆的 Bader 电荷，该盆与 $(d, 0)$ 处的极大值点相关联，并对应于由零通量线界定的 $x  0$ 区域。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于 QTAIM 的原理，这是理论与计算化学中的一种标准且成熟的方法。使用高斯函数来模拟电子密度是一种常见且物理上合理的近似（例如，在高斯基组中）。零通量条件是该理论中原子间曲面的基本定义。该问题是将这些原理应用于一个简化的数学模型的有效实践。\n- **适定性**：该问题提供了一个具体、定义明确的数学函数，并要求求解其派生性质（零通量边界和在由此产生的区域上的积分）。任务清晰，且存在唯一解。\n- **客观性**：该问题以精确的数学语言陈述，没有主观性或模糊性。\n\n### 步骤 3：结论与行动\n该问题是有效的。其前提在科学上和数学上都是合理的，任务也定义明确。我将继续进行解答。\n\n### 详细解答\n\n按照要求，该问题分两部分解决：首先，确定零通量边界；其次，计算其中一个盆内的电荷。\n\n**第一部分：确定零通量线**\n\nBader 盆之间的边界是一个零通量曲面。在这个二维问题中，它是一条零通量线。这样一条线的条件是，电子密度的梯度 $\\nabla n(x,y)$ 必须与线上每一点的法向量 $\\hat{\\mathbf{n}}$ 垂直。\n\n给定的电子密度是两个分量的和：\n$n(x,y) = n_1(x,y) + n_2(x,y)$，其中\n$$\nn_1(x,y) = \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right)\n$$\n$$\nn_2(x,y) = \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right)\n$$\n总密度函数 $n(x,y)$ 关于 y 轴对称，即 $n(-x,y) = n(x,y)$。这种强对称性表明，与 $(\\pm d, 0)$ 处的极大值点相关联的两个原子盆之间的分界线是直线 $x=0$。\n\n为了验证这一点，我们必须证明直线 $x=0$ 满足零通量条件。对于直线 $x=0$，单位法向量为 $\\hat{\\mathbf{n}} = (1, 0)$。零通量条件 $\\nabla n(x,y) \\cdot \\hat{\\mathbf{n}} = 0$ 变为：\n$$\n\\frac{\\partial n}{\\partial x} \\bigg|_{x=0} = 0\n$$\n我们计算 $n(x,y)$ 对 $x$ 的偏导数：\n$$\n\\frac{\\partial n}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right) + \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right) \\right]\n$$\n$$\n\\frac{\\partial n}{\\partial x} = \\frac{1}{\\pi \\sigma^{2}} \\left[ \\exp\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right)\\left(-\\frac{2(x-d)}{\\sigma^{2}}\\right) + \\exp\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right)\\left(-\\frac{2(x+d)}{\\sigma^{2}}\\right) \\right]\n$$\n现在，我们在 $x=0$ 处计算这个导数：\n$$\n\\frac{\\partial n}{\\partial x} \\bigg|_{x=0} = \\frac{1}{\\pi \\sigma^{2}} \\left[ \\exp\\left(-\\frac{d^{2} + y^{2}}{\\sigma^{2}}\\right)\\left(-\\frac{2(-d)}{\\sigma^{2}}\\right) + \\exp\\left(-\\frac{d^{2} + y^{2}}{\\sigma^{2}}\\right)\\left(-\\frac{2(d)}{\\sigma^{2}}\\right) \\right]\n$$\n$$\n\\frac{\\partial n}{\\partial x} \\bigg|_{x=0} = \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{d^{2} + y^{2}}{\\sigma^{2}}\\right) \\left[ \\frac{2d}{\\sigma^{2}} - \\frac{2d}{\\sigma^{2}} \\right] = 0\n$$\n由于这个条件对所有 y 值都成立，直线 $x=0$ 确实是划分平面的零通量线。两个 Bader 盆是半平面 $x  0$ 和 $x > 0$。\n\n**第二部分：计算 Bader 电荷**\n\n右侧盆是由 $x > 0$ 定义的区域。与该盆相关联的 Bader 电荷 $Q_R$ 是电子密度在该区域上的积分：\n$$\nQ_R = \\int_{0}^{\\infty} \\int_{-\\infty}^{\\infty} n(x,y) \\,dy\\,dx\n$$\n我们可以代入 $n(x,y)$ 的表达式并将积分拆分：\n$$\nQ_R = \\int_{0}^{\\infty} \\int_{-\\infty}^{\\infty} \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x-d)^{2} + y^{2}}{\\sigma^{2}}\\right) \\,dy\\,dx + \\int_{0}^{\\infty} \\int_{-\\infty}^{\\infty} \\frac{1}{\\pi \\sigma^{2}} \\exp\\left(-\\frac{(x+d)^{2} + y^{2}}{\\sigma^{2}}\\right) \\,dy\\,dx\n$$\n我们分别将这两个积分表示为 $I_1$ 和 $I_2$。\n\n首先，考虑 $I_1$：\n$$\nI_1 = \\frac{1}{\\pi \\sigma^{2}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{(x-d)^{2}}{\\sigma^{2}}\\right) \\left[ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{y^{2}}{\\sigma^{2}}\\right) \\,dy \\right] \\,dx\n$$\n关于 $y$ 的内部积分是一个标准高斯积分，其值为 $\\sqrt{\\pi \\sigma^{2}}$。\n$$\nI_1 = \\frac{1}{\\pi \\sigma^{2}} \\sqrt{\\pi \\sigma^{2}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{(x-d)^{2}}{\\sigma^{2}}\\right) \\,dx = \\frac{1}{\\sqrt{\\pi \\sigma^{2}}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{(x-d)^{2}}{\\sigma^{2}}\\right) \\,dx\n$$\n我们进行换元：令 $u = \\frac{x-d}{\\sigma}$。则 $du = \\frac{dx}{\\sigma}$，所以 $dx = \\sigma du$。积分限从 $x=0$ 变为 $u = -d/\\sigma$，从 $x \\to \\infty$ 变为 $u \\to \\infty$。\n$$\nI_1 = \\frac{1}{\\sqrt{\\pi}\\sigma} \\int_{-d/\\sigma}^{\\infty} \\exp(-u^2) (\\sigma \\,du) = \\frac{1}{\\sqrt{\\pi}} \\int_{-d/\\sigma}^{\\infty} \\exp(-u^2) \\,du\n$$\n使用误差函数的定义 $\\text{erf}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_{0}^{z} \\exp(-t^2) \\,dt$，我们可以写出：\n$$\n\\int_{-d/\\sigma}^{\\infty} \\exp(-u^2) \\,du = \\int_{-d/\\sigma}^{0} \\exp(-u^2) \\,du + \\int_{0}^{\\infty} \\exp(-u^2) \\,du\n$$\n由于 $\\exp(-u^2)$ 是偶函数，所以 $\\int_{-a}^{0} f(u) du = \\int_{0}^{a} f(u) du$。并且，$\\int_{0}^{\\infty} \\exp(-u^2) \\,du = \\frac{\\sqrt{\\pi}}{2}$。\n$$\nI_1 = \\frac{1}{\\sqrt{\\pi}} \\left[ \\int_{0}^{d/\\sigma} \\exp(-u^2) \\,du + \\frac{\\sqrt{\\pi}}{2} \\right] = \\frac{1}{\\sqrt{\\pi}} \\left[ \\frac{\\sqrt{\\pi}}{2} \\text{erf}\\left(\\frac{d}{\\sigma}\\right) + \\frac{\\sqrt{\\pi}}{2} \\right] = \\frac{1}{2} \\left(1 + \\text{erf}\\left(\\frac{d}{\\sigma}\\right)\\right)\n$$\n\n现在，考虑 $I_2$：\n$$\nI_2 = \\frac{1}{\\sqrt{\\pi \\sigma^{2}}} \\int_{0}^{\\infty} \\exp\\left(-\\frac{(x+d)^{2}}{\\sigma^{2}}\\right) \\,dx\n$$\n我们使用一个新变量：令 $v = \\frac{x+d}{\\sigma}$。则 $dv = \\frac{dx}{\\sigma}$，所以 $dx = \\sigma dv$。积分限从 $x=0$ 变为 $v = d/\\sigma$，从 $x \\to \\infty$ 变为 $v \\to \\infty$。\n$$\nI_2 = \\frac{1}{\\sqrt{\\pi}\\sigma} \\int_{d/\\sigma}^{\\infty} \\exp(-v^2) (\\sigma \\,dv) = \\frac{1}{\\sqrt{\\pi}} \\int_{d/\\sigma}^{\\infty} \\exp(-v^2) \\,dv\n$$\n这个积分可以用互补误差函数 $\\text{erfc}(z) = 1 - \\text{erf}(z) = \\frac{2}{\\sqrt{\\pi}}\\int_{z}^{\\infty} \\exp(-t^2) \\,dt$ 来表示。\n$$\nI_2 = \\frac{1}{\\sqrt{\\pi}} \\left[ \\frac{\\sqrt{\\pi}}{2} \\text{erfc}\\left(\\frac{d}{\\sigma}\\right) \\right] = \\frac{1}{2} \\text{erfc}\\left(\\frac{d}{\\sigma}\\right) = \\frac{1}{2} \\left(1 - \\text{erf}\\left(\\frac{d}{\\sigma}\\right)\\right)\n$$\n\n最后，总电荷 $Q_R$ 是 $I_1$ 和 $I_2$ 的和：\n$$\nQ_R = I_1 + I_2 = \\frac{1}{2} \\left(1 + \\text{erf}\\left(\\frac{d}{\\sigma}\\right)\\right) + \\frac{1}{2} \\left(1 - \\text{erf}\\left(\\frac{d}{\\sigma}\\right)\\right)\n$$\n$$\nQ_R = \\frac{1}{2} + \\frac{1}{2}\\text{erf}\\left(\\frac{d}{\\sigma}\\right) + \\frac{1}{2} - \\frac{1}{2}\\text{erf}\\left(\\frac{d}{\\sigma}\\right) = 1\n$$\n另外，也可以使用一个基于对称性的更简单的论证。题目说明，每个归一化的高斯函数在全空间上的积分是 1。因此，系统中的总电子数是 $1+1=2$。密度函数 $n(x,y)$ 关于 $x=0$ 轴完全对称。分界线就是对称线 $x=0$。因此，总电荷必须在两个盆之间平均分配。右侧盆 ($x0$) 中的电荷是总电荷的一半：\n$$\nQ_R = \\frac{1}{2} Q_{\\text{total}} = \\frac{1}{2}(2) = 1\n$$\n两种方法得到相同的结果。右侧盆的 Bader 电荷是 1 个电子。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "为了将理论知识与实际研究相结合，本综合练习将带您进入真实的计算化学情境。在实际研究中，原子电荷是通过复杂的数值算法计算得到的。本练习要求您为一个三维甲烷分子模型编写程序，计算并比较三种常见的电荷布居方案：Mulliken电荷、Hirshfeld电荷和Bader电荷。通过亲手实现这些算法，您将深刻理解不同电荷分析方法的物理假设、计算细节及其对基组等参数的敏感性，这对于批判性地解读计算结果至关重要 。",
            "id": "3869040",
            "problem": "考虑一个甲烷分子，其模型由五个位于原子中心的、归一化的、$s$ 型高斯基函数构成，这些基函数分别位于一个碳原子核和四个呈四面体几何构型排列的氢原子核上。设碳原子位于原点，四个氢原子与碳的键长为 $1.09\\,\\mathrm{\\AA}$，沿着归一化到該键长的方向 $(1,1,1)$、$(1,-1,-1)$、$(-1,1,-1)$ 和 $(-1,-1,1)$ 分布，构成一个正四面体的顶点。每个原子轨道基函数 $\\chi_{\\mu}(\\mathbf{r})$ 定义为 $\\chi_{\\mu}(\\mathbf{r}) = N(\\alpha_{\\mu}) \\exp\\big(-\\alpha_{\\mu} \\lVert \\mathbf{r} - \\mathbf{R}_{\\mu} \\rVert^2\\big)$，其归一化常数 $N(\\alpha) = \\left(\\dfrac{2\\alpha}{\\pi}\\right)^{3/4}$ 使得 $\\int \\chi_{\\mu}^2(\\mathbf{r})\\,d^3\\mathbf{r} = 1$。假设只考虑价电子：碳有 $4$ 个，每个氢有 $1$ 个，总计 $8$ 个电子。\n\n你需要实现一个程序，该程序能针对每组指定的参数集，构建以下内容：\n- 大小为 $5\\times 5$ 的原子轨道重叠矩阵 $S$，其矩阵元为 $S_{\\mu\\nu} = \\int \\chi_{\\mu}(\\mathbf{r}) \\chi_{\\nu}(\\mathbf{r})\\,d^3\\mathbf{r}$，使用归一化 $s$ 型高斯函数重叠积分的解析公式计算：\n$$\nS_{\\mu\\nu} = \\left(\\frac{2\\sqrt{\\alpha_{\\mu}\\alpha_{\\nu}}}{\\alpha_{\\mu}+\\alpha_{\\nu}}\\right)^{3/2}\\exp\\left(-\\frac{\\alpha_{\\mu}\\alpha_{\\nu}}{\\alpha_{\\mu}+\\alpha_{\\nu}} \\lVert \\mathbf{R}_{\\mu}-\\mathbf{R}_{\\nu}\\rVert^2\\right).\n$$\n- 一组四个占据分子轨道。这些轨道位于正交归一化的原子轨道空间中，由一个正交归一化的 $5\\times 4$ 系数矩阵 $M$ 构建。该矩阵的第一列 $m_0$ 是全对称组合，与 $\\big[w_C,\\,w_H/2,\\,w_H/2,\\,w_H/2,\\,w_H/2\\big]^T$ 成正比；其余三列是氢基函数的、相互正交归一化的线性组合，且氢分量之和为零（因此与 $m_0$ 正交）。此处的正交归一化必须是相对于单位度规，而非 $S$ 矩阵。然后使用对称正交化方法回到原子轨道基组：若 $S = U\\Lambda U^T$，则定义 $X = U\\Lambda^{-1/2}U^T$，原子轨道分子轨道系数矩阵为 $C = X M$，满足 $C^T S C = I_4$。\n- 原子轨道基组下的闭壳层密度矩阵为 $P = 2 C C^T$，其在 $S$ 度规下的迹等于模型中的电子数，即 $\\operatorname{Tr}(P S) = 8$。\n\n利用这些结果，计算碳和氢的三种原子电荷：\n1. Mulliken 电荷：原子 $A$ 的 Mulliken 原子总布居数为 \n$$\nN_A^{\\mathrm{M}} = \\sum_{\\mu \\in A} (P S)_{\\mu\\mu},\n$$\nMulliken 原子电荷为 $q_A^{\\mathrm{M}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{M}}$，其中碳的价电子数 $Z_C^{\\mathrm{val}} = 4$，氢的价电子数 $Z_H^{\\mathrm{val}} = 1$。\n2. Hirshfeld 电荷：定义模型分子电子密度 \n$$\n\\rho(\\mathbf{r}) = \\sum_{\\mu\\nu} P_{\\mu\\nu} \\chi_{\\mu}(\\mathbf{r}) \\chi_{\\nu}(\\mathbf{r}),\n$$\n以及中性价电子层的前原子参考密度 \n$$\n\\rho_A^0(\\mathbf{r}) = Z_A^{\\mathrm{val}}\\, g_A(\\mathbf{r}),\\quad g_A(\\mathbf{r}) = \\left(\\frac{2\\beta_A}{\\pi}\\right)^{3/2} \\exp\\left(-2\\beta_A \\lVert \\mathbf{r}-\\mathbf{R}_A\\rVert^2\\right),\n$$\n其中 $g_A$ 归一化后积分为 $1$，$\\beta_A$ 是原子 $A$ 的前原子高斯指数。Hirshfeld 权重为 \n$$\nw_A(\\mathbf{r}) = \\frac{\\rho_A^0(\\mathbf{r})}{\\sum_B \\rho_B^0(\\mathbf{r})},\n$$\nHirshfeld 原子布居数为 \n$$\nN_A^{\\mathrm{H}} = \\int \\rho(\\mathbf{r}) w_A(\\mathbf{r})\\, d^3\\mathbf{r},\n$$\nHirshfeld 电荷为 $q_A^{\\mathrm{H}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{H}}$。\n3. Bader 电荷，通过对 $\\rho(\\mathbf{r})$ 的梯度进行零通量划分得到：原子 $A$ 的 Bader 流域是这样一个点集，从这些点出发的 $\\rho(\\mathbf{r})$ 最陡峭上升轨迹最终会终止于与原子核 $A$ 相关联的局部最大值点。这满足原子间表面上的零通量条件 $\\nabla \\rho(\\mathbf{r}) \\cdot \\mathbf{n}(\\mathbf{r}) = 0$，其中 $\\mathbf{n}(\\mathbf{r})$ 是表面法向量。在数值上，通过离散梯度上升更新 \n$$\n\\mathbf{r}_{k+1} = \\mathbf{r}_k + s \\frac{\\nabla \\rho(\\mathbf{r}_k)}{\\lVert \\nabla \\rho(\\mathbf{r}_k) \\rVert},\n$$\n将每个格点分配给一个原子，直到收敛到距离某个原子核小于一个很小的值，或达到最大步数为止；然后在每个流域 $\\Omega_A$ 中对密度进行积分：\n$$\nN_A^{\\mathrm{B}} = \\int_{\\Omega_A} \\rho(\\mathbf{r})\\, d^3\\mathbf{r}, \\quad q_A^{\\mathrm{B}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{B}}.\n$$\n\n为确保结果的可复现性和普适性，请实现以下数值方案：\n- 对于所有实空间积分，使用一个均匀立方格点，其在每个维度上覆盖 $[-3.0,3.0]\\,\\mathrm{\\AA}$ 的范围，格点间距为 $\\Delta x = \\Delta y = \\Delta z = 0.5\\,\\mathrm{\\AA}$。使用中点法则。体素体积为 $dV = \\Delta x\\, \\Delta y\\, \\Delta z$。\n- 对于梯度上升，使用固定步长 $s = 0.2\\,\\mathrm{\\AA}$。如果到任一原子核的距离小于 $0.3\\,\\mathrm{\\AA}$，或者梯度范数小于 $10^{-8}$，或者达到 $60$ 步，则终止，以先满足的条件为准。如果某个格点的初始密度小于 $10^{-9}$，你可以将该点直接分配给最近的原子核，以避免不必要的迭代。\n- 为了减轻有限计算盒子带来的积分误差，在计算 Hirshfeld 和 Bader 布居数之前，重新缩放数值积分得到的总电子密度，使得积分电子数恰好等于 $8$。具体来说，在格点上计算 $N_{\\mathrm{box}} = \\sum_i \\rho(\\mathbf{r}_i) dV$，然后在所有后续基于格点的划分中使用 $\\tilde{\\rho}(\\mathbf{r}_i) = \\rho(\\mathbf{r}_i)\\cdot \\left(8/N_{\\mathrm{box}}\\right)$。\n\n测试组：\n对于每组参数集，我们提供原子轨道指数 $\\alpha_C$ 和 $\\alpha_H$、全对称组合的正交归一化分子轨道混合权重 $w_C$ 和 $w_H$，以及前原子指数 $\\beta_C$ 和 $\\beta_H$。所有氢原子共享相同的指数值。使用给定的四面体几何构型，即碳位于原点，氢与碳的距离为 $1.09\\,\\mathrm{\\AA}$。\n\n- 情况 1 (均衡)：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.8,\\,1.2,\\,0.8,\\,0.6,\\,0.7,\\,1.0)$。\n- 情况 2 (氢基函数过局域化)：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.6,\\,2.0,\\,0.7,\\,0.6,\\,0.7,\\,1.2)$。\n- 情况 3 (弥散函数)：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.3,\\,0.4,\\,0.8,\\,0.4,\\,0.5,\\,0.7)$。\n\n对于每种情况，计算：\n- 碳的 Mulliken 电荷 $q_C^{\\mathrm{M}}$ 和氢的平均 Mulliken 电荷 $\\bar{q}_H^{\\mathrm{M}}$，\n- 碳的 Hirshfeld 电荷 $q_C^{\\mathrm{H}}$ 和氢的平均 Hirshfeld 电荷 $\\bar{q}_H^{\\mathrm{H}}$，\n- 碳的 Bader 电荷 $q_C^{\\mathrm{B}}$ 和氢的平均 Bader 电荷 $\\bar{q}_H^{\\mathrm{B}}$。\n\n所有电荷必须表示为十进制浮点数，单位为基本电荷 $e$（即以 $e$ 为单位的无量纲数），并四舍五入到小数点后三位。你的程序应生成单行输出，其中包含所有情况的结果，形式为一个扁平的、逗号分隔的列表，并用方括号括起来，顺序如下：\n$$\n\\big[q_C^{\\mathrm{M}}(1),\\,\\bar{q}_H^{\\mathrm{M}}(1),\\,q_C^{\\mathrm{H}}(1),\\,\\bar{q}_H^{\\mathrm{H}}(1),\\,q_C^{\\mathrm{B}}(1),\\,\\bar{q}_H^{\\mathrm{B}}(1),\\,q_C^{\\mathrm{M}}(2),\\,\\bar{q}_H^{\\mathrm{M}}(2),\\,\\ldots,\\,q_C^{\\mathrm{B}}(3),\\,\\bar{q}_H^{\\mathrm{B}}(3)\\big].\n$$\n括号中的数字表示情况的索引。本问题中不使用角度。请遵循上述定义和约束，确保数值稳定性和科学真实性，不要引入任何外部数据或文件。",
            "solution": "用户提供的问题陈述是一个定义明确的量子化学计算练习。它要求实现算法，为一个简化的甲烷分子模型计算三种不同类型的原子电荷（Mulliken、Hirshfeld 和 Bader）。\n\n### 步骤 1：提取已知条件\n\n- **分子几何构型**：一个碳原子位于原点 $\\mathbf{R}_C = (0,0,0)$。四个氢原子与碳的距离为 $d_{CH} = 1.09\\,\\mathrm{\\AA}$，沿着方向 $(1,1,1)$、$(1,-1,-1)$、$(-1,1,-1)$ 和 $(-1,-1,1)$ 分布。\n- **基函数**：五个位于原子中心的、归一化的 $s$ 型高斯基函数，$\\chi_{\\mu}(\\mathbf{r}) = N(\\alpha_{\\mu}) \\exp\\big(-\\alpha_{\\mu} \\lVert \\mathbf{r} - \\mathbf{R}_{\\mu} \\rVert^2\\big)$，其中 $N(\\alpha) = \\left(\\frac{2\\alpha}{\\pi}\\right)^{3/4}$。\n- **价电子**：$Z_C^{\\mathrm{val}} = 4$, $Z_H^{\\mathrm{val}} = 1$。总电子数为 $8$。\n- **重叠矩阵公式**：$S_{\\mu\\nu} = \\left(\\frac{2\\sqrt{\\alpha_{\\mu}\\alpha_{\\nu}}}{\\alpha_{\\mu}+\\alpha_{\\nu}}\\right)^{3/2}\\exp\\left(-\\frac{\\alpha_{\\mu}\\alpha_{\\nu}}{\\alpha_{\\mu}+\\alpha_{\\nu}} \\lVert \\mathbf{R}_{\\mu}-\\mathbf{R}_{\\nu}\\rVert^2\\right)$。\n- **分子轨道 (MOs)**：\n    - 在正交归一化原子轨道 (OAO) 空间中构建一个正交归一化的 $5\\times 4$ 系数矩阵 $M$。\n    - 第一列 $m_0$ 与 $\\big[w_C,\\,w_H/2,\\,w_H/2,\\,w_H/2,\\,w_H/2\\big]^T$ 成正比。\n    - 其他三列相互正交归一化，由氢基函数构成，并且氢分量之和为零。\n    - 原子轨道 (AO) 基组下的分子轨道系数为 $C = X M$，其中 $X = S^{-1/2}$ 来自重叠矩阵 $S$ 的对称正交化。关系式 $C^T S C = I_4$ 成立。\n- **密度矩阵**：$P = 2 C C^T$。迹 $\\operatorname{Tr}(P S) = 8$。\n- **Mulliken 电荷**：$N_A^{\\mathrm{M}} = \\sum_{\\mu \\in A} (P S)_{\\mu\\mu}$，$q_A^{\\mathrm{M}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{M}}$。\n- **Hirshfeld 电荷**：\n    - 分子密度：$\\rho(\\mathbf{r}) = \\sum_{\\mu\\nu} P_{\\mu\\nu} \\chi_{\\mu}(\\mathbf{r}) \\chi_{\\nu}(\\mathbf{r})$。\n    - 前原子密度：$\\rho_A^0(\\mathbf{r}) = Z_A^{\\mathrm{val}}\\, g_A(\\mathbf{r})$，其中 $g_A(\\mathbf{r}) = \\left(\\frac{2\\beta_A}{\\pi}\\right)^{3/2} \\exp\\left(-2\\beta_A \\lVert \\mathbf{r}-\\mathbf{R}_A\\rVert^2\\right)$。\n    - Hirshfeld 布居数：$N_A^{\\mathrm{H}} = \\int \\rho(\\mathbf{r}) \\frac{\\rho_A^0(\\mathbf{r})}{\\sum_B \\rho_B^0(\\mathbf{r})}\\, d^3\\mathbf{r}$。\n    - Hirshfeld 电荷：$q_A^{\\mathrm{H}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{H}}$。\n- **Bader 电荷**：\n    - 流域 $\\Omega_A$ 由 $\\nabla \\rho(\\mathbf{r})$ 的零通量面确定。\n    - 通过梯度上升法数值求解：$\\mathbf{r}_{k+1} = \\mathbf{r}_k + s \\frac{\\nabla \\rho(\\mathbf{r}_k)}{\\lVert \\nabla \\rho(\\mathbf{r}_k) \\rVert}$。\n    - 布居数：$N_A^{\\mathrm{B}} = \\int_{\\Omega_A} \\rho(\\mathbf{r})\\, d^3\\mathbf{r}$，电荷：$q_A^{\\mathrm{B}} = Z_A^{\\mathrm{val}} - N_A^{\\mathrm{B}}$。\n- **数值方案**：\n    - 网格：在每个维度上从 $[-3.0, 3.0]\\,\\mathrm{\\AA}$ 的立方体，间距 $\\Delta x = \\Delta y = \\Delta z = 0.5\\,\\mathrm{\\AA}$。\n    - 积分：中点法则，体素体积 $dV = (0.5)^3\\,\\mathrm{\\AA}^3$。\n    - 密度重归一化：在计算 Hirshfeld 和 Bader布居数之前，将盒子内的数值积分密度 $\\int_{\\text{box}} \\rho(\\mathbf{r})\\,d^3\\mathbf{r}$ 重新缩放至等于 $8$。\n    - 梯度上升：步长 $s = 0.2\\,\\mathrm{\\AA}$。终止条件：到原子核的距离 $ 0.3\\,\\mathrm{\\AA}$，梯度范数 $ 10^{-8}$，或 $60$ 步。\n    - 低密度分配：如果 $\\rho(\\mathbf{r}_i)  10^{-9}$，将格点 $\\mathbf{r}_i$ 分配给最近的原子核。\n- **测试用例**：\n    - 情况 1：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.8,\\,1.2,\\,0.8,\\,0.6,\\,0.7,\\,1.0)$。\n    - 情况 2：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.6,\\,2.0,\\,0.7,\\,0.6,\\,0.7,\\,1.2)$。\n    - 情况 3：$(\\alpha_C,\\alpha_H,w_C,w_H,\\beta_C,\\beta_H) = (0.3,\\,0.4,\\,0.8,\\,0.4,\\,0.5,\\,0.7)$。\n- **输出格式**：一个包含所有电荷的扁平列表 `[q_C^M(1), q_H^M(1), ..., q_H^B(3)]`，四舍五入到三位小数。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题牢固地植根于计算量子化学的原理。高斯基函数、重叠矩阵、密度矩阵以及各种布居数分析方案（Mulliken、Hirshfeld、Bader）的使用都是标准概念。所提供的公式是在一个简化模型中对这些概念的正确表述。\n- **适定性**：该问题没有歧义。它提供了所有必需的参数、常数和详细的数值方案。分子轨道的构建被明确定义，包括正交归一化条件。计算序列是逻辑连贯的，并导向一组唯一、可确定的结果。\n- **客观性**：语言完全是定量和形式化的，没有主观或基于观点的陈述。\n- **完整性与一致性**：该问题是自洽的。三个测试用例所需的所有数据都已提供。理论框架内部是一致的；例如，分子轨道和密度矩阵的构建正确地导出了总电子数为 8，与价电子的总和相匹配。\n- **可行性**：该计算虽然是计算密集型的（特别是 Bader 分析），但在现代硬件上于合理的时间范围内是完全可行的。指定的模型和参数对于一个教学示例而言在物理上是合理的。\n\n### 步骤 3：结论与行动\n\n该问题是**有效**的。它是一个适定、有科学依据且客观的计算任务。我将继续提供一个完整的解决方案。\n\n### 解决方案\n\n解决方案是通过遵循问题陈述中指定的操作序列来实现的。代码的架构被设计为模块化的，每个主要计算步骤由不同的函数处理，以确保清晰性和正确性。\n\n1.  **系统设置**：首先建立甲烷的几何构型，碳原子在原点，四个氢原子按指定的键长 $1.09\\,\\mathrm{\\AA}$ 四面体排列。\n\n2.  **矩阵构建**：\n    - 使用提供的 $s$ 型高斯重叠积分解析公式计算 $5 \\times 5$ 的原子轨道**重叠矩阵** $S$。\n    - 构建 $5 \\times 4$ 的**正交归一化分子轨道系数矩阵** $M$（在 OAO 基组中）。其第一列代表全对称成键轨道，由给定的权重 $w_C$ 和 $w_H$ 形成并归一化。其余三列被构建为相互正交归一化，位于氢基函数子空间内，并与第一个分子轨道正交，满足“氢分量之和为零”的规则。\n    - 通过对角化 $S$（$S = U\\Lambda U^T$），取特征值的负二分之一幂（$\\Lambda^{-1/2}$），然后变换回去（$X = U\\Lambda^{-1/2}U^T$），计算**对称正交化矩阵** $X = S^{-1/2}$。\n    - **AO 基组下的分子轨道系数矩阵**则为 $C = X M$。\n    - 最后，计算**密度矩阵** $P = 2 C C^T$，其中因子 $2$ 表示四个占据轨道中的自旋配对。\n\n3.  **Mulliken 布居数分析**：这是一个基于矩阵的计算。原子 $A$ 上的 Mulliken 原子总布居数是乘积矩阵 $PS$ 中对应于原子 $A$ 上基函数的对角元素之和。电荷是价电子数 $Z_A^{\\mathrm{val}}$ 与该布居数之差。\n\n4.  **基于网格的计算 (Hirshfeld 和 Bader)**：\n    - 在立方体 $[-3.0, 3.0]^3\\,\\mathrm{\\AA}^3$ 内生成一个均匀的三维网格。\n    - 在每个格点上计算分子电子密度 $\\rho(\\mathbf{r})$。设计了一个辅助类 `DensityHandler`，通过预先计算高斯乘积法则中的项，来高效计算任意点上的 $\\rho(\\mathbf{r})$ 及其梯度 $\\nabla\\rho(\\mathbf{r})$。\n    - 通过数值积分计算网格体积内的总电子数。然后对密度进行均匀重新缩放，使得总积分电荷精确等于电子数 $8$，以校正有限网格误差。这个重新缩放后的密度 $\\tilde{\\rho}(\\mathbf{r})$ 用于所有后续的布居数分析。\n\n5.  **Hirshfeld 电荷计算**：\n    - 在网格上为每个原子计算前原子密度 $\\rho_A^0(\\mathbf{r})$。\n    - 在每个格点上计算 Hirshfeld 权重函数 $w_A(\\mathbf{r}) = \\rho_A^0(\\mathbf{r}) / \\sum_B \\rho_B^0(\\mathbf{r})$。\n    - 通过在网格上对分子密度 $\\tilde{\\rho}(\\mathbf{r})$ 用 $w_A(\\mathbf{r})$进行加权数值积分，找到 Hirshfeld 布居数 $N_A^{\\mathrm{H}}$。然后得出电荷 $q_A^{\\mathrm{H}}$。\n\n6.  **Bader 电荷计算**：\n    - 这是计算上最密集的一步。对每个格点，在密度场 $\\rho(\\mathbf{r})$ 上执行离散梯度上升算法。\n    - 从格点 $\\mathbf{r}_i$ 开始的轨迹被追踪，直到它终止于一个原子核附近（$\\rho$ 的一个最大值点），其梯度变得可以忽略不计，或达到最大步数。然后将该格点分配给相应原子核 $A$ 的流域 $\\Omega_A$。\n    - 一个特殊情况处理低密度区域：将密度 $\\rho  10^{-9}$ 的点分配给最近的原子核，而不运行上升算法。\n    - Bader 布居数 $N_A^{\\mathrm{B}}$ 是分配给流域 $\\Omega_A$ 的所有格点上的重新缩放密度 $\\tilde{\\rho}(\\mathbf{r}_i)$ 的总和，再乘以体素体积 $dV$。然后计算出电荷 $q_A^{\\mathrm{B}}$。\n\n最后，收集每个测试用例中计算出的碳电荷和氢的平均电荷，四舍五入到小数点后三位，并格式化为所需的输出字符串。由于对称性，所有四个氢原子上的电荷都是相同的，因此平均值就是其中任意一个氢原子的电荷值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# --- Constants and Configuration ---\nD_CH = 1.09  # Angstrom\nZ_VAL = np.array([4.0, 1.0, 1.0, 1.0, 1.0])  # C, H1, H2, H3, H4\nNUM_ELECTRONS = 8.0\nGRID_BOUNDS = 3.0\nGRID_SPACING = 0.5\nASCENT_STEP_SIZE = 0.2\nASCENT_MAX_STEPS = 60\nASCENT_DIST_THRESH = 0.3\nASCENT_GRAD_THRESH = 1e-8\nDENSITY_CUTOFF = 1e-9\n\ndef get_methane_geometry():\n    \"\"\"Returns the 5x3 array of atomic coordinates for methane.\"\"\"\n    R = np.zeros((5, 3))\n    scale = D_CH / np.sqrt(3.0)\n    R[1, :] = scale * np.array([1.0, 1.0, 1.0])\n    R[2, :] = scale * np.array([1.0, -1.0, -1.0])\n    R[3, :] = scale * np.array([-1.0, 1.0, -1.0])\n    R[4, :] = scale * np.array([-1.0, -1.0, 1.0])\n    return R\n\ndef calculate_s_matrix(R, alphas):\n    \"\"\"Calculates the 5x5 atomic orbital overlap matrix S.\"\"\"\n    num_basis = len(alphas)\n    S = np.zeros((num_basis, num_basis))\n    for mu in range(num_basis):\n        for nu in range(mu, num_basis):\n            alpha_mu, alpha_nu = alphas[mu], alphas[nu]\n            R_mu, R_nu = R[mu], R[nu]\n            \n            dist_sq = np.sum((R_mu - R_nu)**2)\n            alpha_sum = alpha_mu + alpha_nu\n            \n            term1 = (2 * np.sqrt(alpha_mu * alpha_nu) / alpha_sum)**1.5\n            term2 = np.exp(-alpha_mu * alpha_nu * dist_sq / alpha_sum)\n            \n            s_val = term1 * term2\n            S[mu, nu] = S[nu, mu] = s_val\n    return S\n\ndef calculate_m_matrix(w_C, w_H):\n    \"\"\"Constructs the 5x4 orthonormal MO coefficient matrix M.\"\"\"\n    M = np.zeros((5, 4))\n    \n    # Column 0: Totally symmetric MO\n    v0 = np.array([w_C, w_H / 2, w_H / 2, w_H / 2, w_H / 2])\n    M[:, 0] = v0 / np.linalg.norm(v0)\n    \n    # Columns 1, 2, 3: Mutually orthonormal H-based MOs\n    c1 = np.array([1., 1., -1., -1.]) / 2.0\n    c2 = np.array([1., -1., 1., -1.]) / 2.0\n    c3 = np.array([1., -1., -1., 1.]) / 2.0\n    \n    M[1:, 1] = c1\n    M[1:, 2] = c2\n    M[1:, 3] = c3\n    \n    return M\n\nclass DensityHandler:\n    \"\"\"Calculates electron density and its gradient.\"\"\"\n    def __init__(self, P, R, alphas):\n        self.P = P\n        self.R = R\n        self.alphas = alphas\n        self.num_basis = len(alphas)\n        \n        self.norm_factors = (2 * self.alphas / np.pi)**0.75\n        self.precompute_terms()\n\n    def precompute_terms(self):\n        \"\"\"Precomputes terms for the Gaussian product rule.\"\"\"\n        self.gamma = np.add.outer(self.alphas, self.alphas)\n        \n        R_mu_w = self.alphas[:, np.newaxis] * self.R\n        self.Rp = (R_mu_w[:, np.newaxis, :] + R_mu_w[np.newaxis, :, :]) / self.gamma[..., np.newaxis]\n        \n        R_dist_sq = np.sum((self.R[:, np.newaxis, :] - self.R[np.newaxis, :, :])**2, axis=-1)\n        exp_term = np.exp(-(self.alphas[:, np.newaxis] * self.alphas) / self.gamma * R_dist_sq)\n        norm_prod = np.outer(self.norm_factors, self.norm_factors)\n        self.K = norm_prod * exp_term\n\n    def _get_gauss_prod(self, r_points):\n        r_points = np.atleast_2d(r_points) # Ensure (N,3)\n        # (N,1,1,3) - (1,M,M,3) - (N,M,M,3)\n        r_minus_Rp = r_points[:, np.newaxis, np.newaxis, :] - self.Rp[np.newaxis, ...]\n        dist_sq = np.sum(r_minus_Rp**2, axis=-1) # (N,M,M)\n        \n        # (1,M,M) * exp(-(1,M,M) * (N,M,M)) - (N,M,M)\n        gauss_prod_val = self.K[np.newaxis, ...] * np.exp(-self.gamma[np.newaxis, ...] * dist_sq)\n        return gauss_prod_val, r_minus_Rp\n\n    def rho(self, r_points):\n        gauss_prod_val, _ = self._get_gauss_prod(r_points)\n        # (1,M,M) * (N,M,M) - (N,M,M)\n        density_contrib = self.P[np.newaxis, ...] * gauss_prod_val\n        return np.sum(density_contrib, axis=(1, 2))\n\n    def grad_rho(self, r_points):\n        gauss_prod_val, r_minus_Rp = self._get_gauss_prod(r_points)\n\n        # (N,M,M,1) * (1,M,M,1) * (N,M,M,3) - (N,M,M,3)\n        grad_G = gauss_prod_val[..., np.newaxis] * (\n                   -2 * self.gamma[np.newaxis, ..., np.newaxis] * r_minus_Rp)\n        \n        # (1,M,M,1) * (N,M,M,3) - (N,M,M,3)\n        grad_rho_contrib = self.P[np.newaxis, ..., np.newaxis] * grad_G\n        return np.sum(grad_rho_contrib, axis=(1, 2))\n\ndef calculate_charges_for_case(params):\n    \"\"\"Main function to compute all charges for a single parameter set.\"\"\"\n    alpha_C, alpha_H, w_C, w_H, beta_C, beta_H = params\n    R = get_methane_geometry()\n    alphas = np.array([alpha_C] + [alpha_H] * 4)\n    betas = np.array([beta_C] + [beta_H] * 4)\n\n    # --- Step 1: Matrix Calculations and Mulliken Charges ---\n    S = calculate_s_matrix(R, alphas)\n    M = calculate_m_matrix(w_C, w_H)\n    \n    eigvals, eigvecs = np.linalg.eigh(S)\n    S_inv_sqrt = eigvecs @ np.diag(1.0 / np.sqrt(eigvals)) @ eigvecs.T\n    \n    C = S_inv_sqrt @ M\n    P = 2 * C @ C.T\n    \n    PS = P @ S\n    q_C_M = Z_VAL[0] - PS[0, 0]\n    q_H_M_avg = Z_VAL[1] - np.mean(np.diag(PS)[1:])\n\n    # --- Step 2: Grid Setup and Density Calculation ---\n    grid_1d = np.arange(GRID_BOUNDS, -GRID_BOUNDS - GRID_SPACING/2, -GRID_SPACING)[::-1]\n    grid_points = np.stack(np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij'), axis=-1).reshape(-1, 3)\n    dV = GRID_SPACING**3\n    \n    density_calc = DensityHandler(P, R, alphas)\n    rho_on_grid = density_calc.rho(grid_points)\n    \n    total_electrons_in_box = np.sum(rho_on_grid) * dV\n    rho_tilde_on_grid = rho_on_grid * (NUM_ELECTRONS / total_electrons_in_box)\n\n    # --- Step 3: Hirshfeld Charges ---\n    pro_atom_densities = np.zeros((len(R), len(grid_points)))\n    for i in range(len(R)):\n        dist_sq = np.sum((grid_points - R[i])**2, axis=1)\n        g_A = (2 * betas[i] / np.pi)**1.5 * np.exp(-2 * betas[i] * dist_sq)\n        pro_atom_densities[i, :] = Z_VAL[i] * g_A\n        \n    pro_molecule_density = np.sum(pro_atom_densities, axis=0)\n    # Avoid division by zero in empty space\n    pro_molecule_density[pro_molecule_density  1e-12] = 1.0\n    \n    hirshfeld_weights = pro_atom_densities / pro_molecule_density[np.newaxis, :]\n    \n    N_H_all = np.sum(hirshfeld_weights * rho_tilde_on_grid, axis=1) * dV\n    q_H = Z_VAL - N_H_all\n    q_C_H = q_H[0]\n    q_H_H_avg = np.mean(q_H[1:])\n\n    # --- Step 4: Bader Charges ---\n    basin_assignments = -np.ones(len(grid_points), dtype=int)\n    \n    dist_to_nuclei = np.linalg.norm(grid_points[:, np.newaxis, :] - R[np.newaxis, :, :], axis=2)\n    nearest_nucleus = np.argmin(dist_to_nuclei, axis=1)\n    \n    for i in range(len(grid_points)):\n        if rho_on_grid[i]  DENSITY_CUTOFF:\n            basin_assignments[i] = nearest_nucleus[i]\n            continue\n            \n        r_current = grid_points[i]\n        \n        for _ in range(ASCENT_MAX_STEPS):\n            grad = density_calc.grad_rho(r_current)[0]\n            grad_norm = np.linalg.norm(grad)\n\n            if grad_norm  ASCENT_GRAD_THRESH:\n                break\n            \n            r_current = r_current + ASCENT_STEP_SIZE * grad / grad_norm\n            \n            dists = np.linalg.norm(r_current - R, axis=1)\n            if np.min(dists)  ASCENT_DIST_THRESH:\n                break\n        \n        basin_assignments[i] = np.argmin(np.linalg.norm(r_current - R, axis=1))\n\n    N_B_all = np.zeros(len(R))\n    for i in range(len(R)):\n        mask = (basin_assignments == i)\n        N_B_all[i] = np.sum(rho_tilde_on_grid[mask]) * dV\n        \n    q_B = Z_VAL - N_B_all\n    q_C_B = q_B[0]\n    q_H_B_avg = np.mean(q_B[1:])\n\n    return [q_C_M, q_H_M_avg, q_C_H, q_H_H_avg, q_C_B, q_H_B_avg]\n\ndef solve():\n    \"\"\"Main solver function to run all test cases and print results.\"\"\"\n    test_cases = [\n        # (alpha_C, alpha_H, w_C, w_H, beta_C, beta_H)\n        (0.8, 1.2, 0.8, 0.6, 0.7, 1.0),\n        (0.6, 2.0, 0.7, 0.6, 0.7, 1.2),\n        (0.3, 0.4, 0.8, 0.4, 0.5, 0.7),\n    ]\n\n    all_results = []\n    for params in test_cases:\n        results = calculate_charges_for_case(params)\n        all_results.extend(results)\n\n    print(f\"[{','.join(f'{r:.3f}' for r in all_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}