{
    "hands_on_practices": [
        {
            "introduction": "密度泛函理论（DFT）计算的准确性在很大程度上取决于几个关键的数值参数，特别是用于对布里渊区进行采样的 $k$ 点网格密度和用于展开电子波函数的平面波截断能。在进行任何有意义的模拟之前，一个至关重要的步骤是执行收敛性测试，以确定能够以可接受的计算成本提供所需精度的最小参数集。本练习将通过一个简化的代理模型来模拟这一过程，旨在帮助您掌握在不运行昂贵的实际DFT计算的情况下测试收敛性的核心逻辑。",
            "id": "3883784",
            "problem": "给定一个用于研究钯 (100) 表面板坯模型上两个吸附位点之间吸附能差异收敛性的抽象但科学一致的代理模型，以及从表面几何结构中识别位点配位。您的任务是实现一个程序，确定能使桥位和穴位之间的吸附能差异在指定容差内保持稳定的最小倒易空间采样（k点网格尺寸）和平面波截断能，并从晶格几何中计算这些位点的配位数。\n\n从以下基本基础开始：\n\n- 一个位点的吸附能，记为 $E_{\\mathrm{ads}}$，在密度泛函理论 (DFT) 中定义为 $E_{\\mathrm{ads}} = E_{\\mathrm{slab+adsorbate}} - E_{\\mathrm{clean\\ slab}} - E_{\\mathrm{gas\\ adsorbate}}$。本问题中仅需要位点间吸附能的差异。\n- 周期性电子结构计算的收敛性由布里渊区采样和基组完备性驱动。增加k点网格尺寸会提高倒易空间积分的分辨率，而增加平面波截断能会提高基组的完备性。\n- 在本练习中，在有限k点网格尺寸和平面波截断能下计算的吸附能被建模为\n  $$E_{\\mathrm{site}}(M, E_{\\mathrm{cut}}) = E^{\\infty}_{\\mathrm{site}} + \\frac{\\alpha_{\\mathrm{site}}}{M^{p}} + \\frac{\\beta_{\\mathrm{site}}}{E_{\\mathrm{cut}}^{q}},$$\n  其中 $E^{\\infty}_{\\mathrm{site}}$ 是在无限k点采样和无限截断能下收敛的吸附能，$M$ 是方形网格 ($M \\times M$) 的一维k点网格尺寸，$E_{\\mathrm{cut}}$ 是平面波截断能，指数 $p = 2$ 和 $q = 1$。参数 $\\alpha_{\\mathrm{site}} > 0$ 和 $\\beta_{\\mathrm{site}} \\ge 0$ 是依赖于位点和具体情况的常数。这捕捉了普遍观察到的系统误差随 $M$ 和 $E_{\\mathrm{cut}}$ 增加而单调衰减的现象。\n\n将桥位和穴位之间的吸附能差异定义为\n$$\\Delta E(M, E_{\\mathrm{cut}}) = E_{\\mathrm{bridge}}(M,E_{\\mathrm{cut}}) - E_{\\mathrm{hollow}}(M,E_{\\mathrm{cut}})。$$\n\n需强制执行的收敛准则：\n\n- 对于选定的一对 $(M^\\star, E_{\\mathrm{cut}}^\\star)$，吸附能差异必须相对于增加 $M$ 或 $E_{\\mathrm{cut}}$ 保持局部稳定，即：\n  $$\\left|\\Delta E(M_{\\mathrm{next}}, E_{\\mathrm{cut}}^\\star) - \\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)\\right| \\le \\tau,$$\n  $$\\left|\\Delta E(M^\\star, E_{\\mathrm{cut,next}}) - \\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)\\right| \\le \\tau,$$\n  其中 $\\tau = 0.01\\,\\mathrm{eV}$ 是容差，$M_{\\mathrm{next}}$ 是允许集合中下一个更大的k点网格尺寸，$E_{\\mathrm{cut,next}}$ 是允许集合中下一个更大的平面波截断能。一个候选对 $(M^\\star, E_{\\mathrm{cut}}^\\star)$ 只有当它们的下一个值都存在于各自的有序集合中时才是容许的（即 $M^\\star$ 和 $E_{\\mathrm{cut}}^\\star$ 都不能是允许的最大值）。\n\n几何与配位：\n\n- 钯 (100) 表面的最顶层可以理想化为一个最近邻间距为 $a$ 的方形晶格。设一个 $2 \\times 2$ 面内团簇中表面原子的位置为 $\\{(0,0,0),(a,0,0),(0,a,0),(a,a,0)\\}$。桥位位于沿 $x$ 方向两个最近邻的中间，位置在 $(a/2, 0, 0)$，四重穴位位于正方形的中心，位置在 $(a/2, a/2, 0)$。在这个理想化模型中，将一个吸附位点的配位数定义为与其面内距离小于或等于截断半径 $r_{\\mathrm{cut}}$ 的表面原子数量。使用 $a = 3.89\\,\\mathrm{\\AA}$ 和 $r_{\\mathrm{cut}} = 0.8\\,a$，并从 $2 \\times 2$ 团簇中的四个原子中计数邻居。\n\n允许的离散参数集：\n\n- K点网格尺寸 $M$ 在集合 $\\{4,6,8,10,12\\}$ 中。\n- 平面波截断能 $E_{\\mathrm{cut}}$ 在集合 $\\{300,350,400,450,500\\}\\,\\mathrm{eV}$ 中。\n\n如果没有 $(M^\\star, E_{\\mathrm{cut}}^\\star)$ 满足收敛准则，则报告失败，输出 $M^\\star = -1$ 和 $E_{\\mathrm{cut}}^\\star = -1$，并且仍然报告在最大允许参数 $M=12$ 和 $E_{\\mathrm{cut}} = 500\\,\\mathrm{eV}$ 下计算的吸附能差异。\n\n测试套件：\n\n对于每个测试用例，给定参数 $(E^{\\infty}_{\\mathrm{bridge}}, \\alpha_{\\mathrm{bridge}}, \\beta_{\\mathrm{bridge}})$ 和 $(E^{\\infty}_{\\mathrm{hollow}}, \\alpha_{\\mathrm{hollow}}, \\beta_{\\mathrm{hollow}})$，以及固定的指数 $p=2$ 和 $q=1$。\n\n- 测试用例 1：\n  - 桥位：$E^{\\infty}_{\\mathrm{bridge}} = -0.35\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{bridge}} = 0.8\\,\\mathrm{eV}$，$\\beta_{\\mathrm{bridge}} = 10\\,\\mathrm{eV}$。\n  - 穴位：$E^{\\infty}_{\\mathrm{hollow}} = -0.40\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{hollow}} = 0.1\\,\\mathrm{eV}$，$\\beta_{\\mathrm{hollow}} = 10\\,\\mathrm{eV}$。\n- 测试用例 2：\n  - 桥位：$E^{\\infty}_{\\mathrm{bridge}} = -0.42\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{bridge}} = 0.06\\,\\mathrm{eV}$，$\\beta_{\\mathrm{bridge}} = 40\\,\\mathrm{eV}$。\n  - 穴位：$E^{\\infty}_{\\mathrm{hollow}} = -0.47\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{hollow}} = 0.02\\,\\mathrm{eV}$，$\\beta_{\\mathrm{hollow}} = 0\\,\\mathrm{eV}$。\n- 测试用例 3：\n  - 桥位：$E^{\\infty}_{\\mathrm{bridge}} = -0.44\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{bridge}} = 3.7\\,\\mathrm{eV}$，$\\beta_{\\mathrm{bridge}} = 2\\,\\mathrm{eV}$。\n  - 穴位：$E^{\\infty}_{\\mathrm{hollow}} = -0.50\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{hollow}} = 0.2\\,\\mathrm{eV}$，$\\beta_{\\mathrm{hollow}} = 0\\,\\mathrm{eV}$。\n- 测试用例 4：\n  - 桥位：$E^{\\infty}_{\\mathrm{bridge}} = -0.38\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{bridge}} = 0.06\\,\\mathrm{eV}$，$\\beta_{\\mathrm{bridge}} = 10\\,\\mathrm{eV}$。\n  - 穴位：$E^{\\infty}_{\\mathrm{hollow}} = -0.381\\,\\mathrm{eV}$，$\\alpha_{\\mathrm{hollow}} = 0.05\\,\\mathrm{eV}$，$\\beta_{\\mathrm{hollow}} = 5\\,\\mathrm{eV}$。\n\n程序要求：\n\n- 对于每个测试用例，搜索允许的集合以找到满足上述定义的容差为 $\\tau = 0.01\\,\\mathrm{eV}$ 的两个局部稳定性条件的最小 $(M^\\star, E_{\\mathrm{cut}}^\\star)$。“最小”指的是在按升序扫描 $M$ 时，以及对于每个 $M$ 按升序扫描 $E_{\\mathrm{cut}}$ 时，第一个出现的组合。\n- 如果达到收敛，计算吸附能差异 $\\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)$ (单位 eV)；如果收敛失败，则计算 $\\Delta E(12, 500)$ (单位 eV)。\n- 使用指定的晶格几何和截断半径 $r_{\\mathrm{cut}}$ 计算桥位和穴位的配位数（整数）。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个包含四个结果列表的列表，每个测试用例一个，按给定顺序排列。每个结果列表必须包含五个元素，顺序严格为 $[M^\\star, E_{\\mathrm{cut}}^\\star, \\Delta E, C_{\\mathrm{bridge}}, C_{\\mathrm{hollow}}]$，其中 $M^\\star$ 和 $E_{\\mathrm{cut}}^\\star$ 是整数（如果收敛失败则为 -1），$\\Delta E$ 是一个浮点数（单位 eV），$C_{\\mathrm{bridge}}$ 和 $C_{\\mathrm{hollow}}$ 是整数。例如，输出应看起来像一个单一的Python风格的列表的列表字面量：“[[...],[...],[...],[...]]”。",
            "solution": "该问题要求为一个关于钯 (100) 表面吸附能的代理模型确定收敛的计算参数，并从一个几何模型中计算位点配位数。解决方案分为两个主要部分：配位数的几何计算（对所有测试用例都相同），以及为每个单独的测试用例执行的收敛参数的数值搜索。\n\n首先，我们来处理吸附能的建模。给定吸附位点的能量由以下函数建模：\n$$E_{\\mathrm{site}}(M, E_{\\mathrm{cut}}) = E^{\\infty}_{\\mathrm{site}} + \\frac{\\alpha_{\\mathrm{site}}}{M^{p}} + \\frac{\\beta_{\\mathrm{site}}}{E_{\\mathrm{cut}}^{q}}$$\n这里，$M$ 代表k点采样网格 ($M \\times M$) 的密度，$E_{\\mathrm{cut}}$ 是平面波截断能，$E^{\\infty}_{\\mathrm{site}}$ 是在无限 $M$ 和 $E_{\\mathrm{cut}}$ 下的收敛能量。指数给定为 $p=2$ 和 $q=1$。参数 $\\alpha_{\\mathrm{site}}$ 和 $\\beta_{\\mathrm{site}}$ 是特定于吸附位点和化学体系的常数。这种函数形式是捕捉平面波密度泛函理论 (DFT) 计算中总能量收敛行为的标准经验模型，其中误差通常相对于这些计算参数呈多项式下降。\n\n主要关注的量是桥位和穴位之间的吸附能差异：\n$$\\Delta E(M, E_{\\mathrm{cut}}) = E_{\\mathrm{bridge}}(M,E_{\\mathrm{cut}}) - E_{\\mathrm{hollow}}(M,E_{\\mathrm{cut}})$$\n将每个位点能量的模型表达式代入，我们得到一个简化的差异表达式：\n$$\\Delta E(M, E_{\\mathrm{cut}}) = (E^{\\infty}_{\\mathrm{bridge}} - E^{\\infty}_{\\mathrm{hollow}}) + \\frac{(\\alpha_{\\mathrm{bridge}} - \\alpha_{\\mathrm{hollow}})}{M^2} + \\frac{(\\beta_{\\mathrm{bridge}} - \\beta_{\\mathrm{hollow}})}{E_{\\mathrm{cut}}}$$\n令 $\\Delta E^{\\infty} = E^{\\infty}_{\\mathrm{bridge}} - E^{\\infty}_{\\mathrm{hollow}}$，$\\Delta\\alpha = \\alpha_{\\mathrm{bridge}} - \\alpha_{\\mathrm{hollow}}$，以及 $\\Delta\\beta = \\beta_{\\mathrm{bridge}} - \\beta_{\\mathrm{hollow}}$。表达式变为：\n$$\\Delta E(M, E_{\\mathrm{cut}}) = \\Delta E^{\\infty} + \\frac{\\Delta\\alpha}{M^2} + \\frac{\\Delta\\beta}{E_{\\mathrm{cut}}}$$\n该函数使用提供的参数为每个测试用例进行求值。\n\n问题的第二部分是计算桥位和穴位的配位数。表面是一个理想化的方形晶格，由钯原子组成，最近邻间距为 $a = 3.89\\,\\mathrm{\\AA}$。考虑一个 $2 \\times 2$ 的原子团簇，位置分别为 $(0,0,0)$、$(a,0,0)$、$(0,a,0)$ 和 $(a,a,0)$。配位数定义为与吸附位点的面内距离在 $r_{\\mathrm{cut}} = 0.8\\,a$ 以内的表面原子数量。\n\n对于桥位，位于 $(a/2, 0, 0)$：\n到四个原子的面内距离为：\n-   到 $(0,0,0)$ 的距离：$\\sqrt{(a/2)^2} = a/2 = 0.5\\,a$。这 $\\le 0.8\\,a$。\n-   到 $(a,0,0)$ 的距离：$\\sqrt{(a/2-a)^2} = a/2 = 0.5\\,a$。这 $\\le 0.8\\,a$。\n-   到 $(0,a,0)$ 的距离：$\\sqrt{(a/2)^2 + (-a)^2} = \\sqrt{1.25\\,a^2} \\approx 1.118\\,a$。这 $> 0.8\\,a$。\n-   到 $(a,a,0)$ 的距离：$\\sqrt{(a/2-a)^2 + (-a)^2} = \\sqrt{1.25\\,a^2} \\approx 1.118\\,a$。这 $> 0.8\\,a$。\n因此，在截断半径内有 $2$ 个原子。桥位的配位数是 $C_{\\mathrm{bridge}} = 2$。\n\n对于穴位，位于 $(a/2, a/2, 0)$：\n到四个原子的面内距离为：\n-   到 $(0,0,0)$ 的距离：$\\sqrt{(a/2)^2 + (a/2)^2} = \\sqrt{0.5\\,a^2} \\approx 0.707\\,a$。这 $\\le 0.8\\,a$。\n-   到 $(a,0,0)$ 的距离：$\\sqrt{(a/2-a)^2 + (a/2)^2} = \\sqrt{0.5\\,a^2} \\approx 0.707\\,a$。这 $\\le 0.8\\,a$。\n-   到 $(0,a,0)$ 的距离：$\\sqrt{(a/2)^2 + (a/2-a)^2} = \\sqrt{0.5\\,a^2} \\approx 0.707\\,a$。这 $\\le 0.8\\,a$。\n-   到 $(a,a,0)$ 的距离：$\\sqrt{(a/2-a)^2 + (a/2-a)^2} = \\sqrt{0.5\\,a^2} \\approx 0.707\\,a$。这 $\\le 0.8\\,a$。\n所有四个原子都在截断半径内。穴位的配位数是 $C_{\\mathrm{hollow}} = 4$。这些配位数是恒定的几何属性，对于所有测试用例都是相同的。\n\n任务的核心是找到收敛的计算参数 $(M^\\star, E_{\\mathrm{cut}}^\\star)$。收敛准则要求对于一个候选对 $(M^\\star, E_{\\mathrm{cut}}^\\star)$，能量差异 $\\Delta E$ 相对于变化到下一个可用参数值是稳定的。条件是：\n$$\n\\begin{align*}\n\\left|\\Delta E(M_{\\mathrm{next}}, E_{\\mathrm{cut}}^\\star) - \\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)\\right| \\le \\tau \\\\\n\\left|\\Delta E(M^\\star, E_{\\mathrm{cut,next}}) - \\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)\\right| \\le \\tau\n\\end{align*}\n$$\n容差 $\\tau = 0.01\\,\\mathrm{eV}$。允许的离散参数集为 $M \\in \\{4,6,8,10,12\\}$ 和 $E_{\\mathrm{cut}} \\in \\{300,350,400,450,500\\}\\,\\mathrm{eV}$。一个有效的解 $(M^\\star, E_{\\mathrm{cut}}^\\star)$ 不能是任一集合中的最大值，因此我们在 $M^\\star \\in \\{4,6,8,10\\}$ 和 $E_{\\mathrm{cut}}^\\star \\in \\{300,350,400,450\\}$ 内搜索。\n\n算法流程如下：对于每个测试用例，我们按升序遍历 $M^\\star$ 的容许值。对于每个 $M^\\star$，我们按升序遍历 $E_{\\mathrm{cut}}^\\star$ 的容许值。在每一对 $(M^\\star, E_{\\mathrm{cut}}^\\star)$ 处，我们评估两个稳定性条件。第一个同时满足两个条件的对被认为是“最小”的收敛参数集。记录相应的 $M^\\star$、$E_{\\mathrm{cut}}^\\star$ 和 $\\Delta E(M^\\star, E_{\\mathrm{cut}}^\\star)$。如果循环完成仍未找到这样的对，则收敛失败。在这种情况下，我们报告 $M^\\star = -1$，$E_{\\mathrm{cut}}^\\star = -1$，并计算在最大可用参数下的 $\\Delta E$，即 $\\Delta E(12, 500)$。\n\n每个测试用例的最终结果是一个列表，包含确定的 $[M^\\star, E_{\\mathrm{cut}}^\\star, \\Delta E, C_{\\mathrm{bridge}}, C_{\\mathrm{hollow}}]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational chemistry convergence problem for a series of test cases.\n    \"\"\"\n    \n    # Define test cases with parameters:\n    # (E_inf_bridge, alpha_bridge, beta_bridge), (E_inf_hollow, alpha_hollow, beta_hollow)\n    test_cases = [\n        # Test case 1\n        ((-0.35, 0.8, 10), (-0.40, 0.1, 10)),\n        # Test case 2\n        ((-0.42, 0.06, 40), (-0.47, 0.02, 0)),\n        # Test case 3\n        ((-0.44, 3.7, 2), (-0.50, 0.2, 0)),\n        # Test case 4\n        ((-0.38, 0.06, 10), (-0.381, 0.05, 5)),\n    ]\n\n    # Fixed parameters from the problem statement\n    M_values = [4, 6, 8, 10, 12]\n    Ecut_values = [300, 350, 400, 450, 500]\n    tau = 0.01  # Convergence tolerance in eV\n    p = 2\n    q = 1\n\n    # --- Part 1: Coordination Number Calculation ---\n    a = 3.89  # Lattice constant in Angstrom\n    r_cut = 0.8 * a\n    \n    # 2x2 cluster of surface atoms in the xy-plane\n    atom_coords = np.array([[0, 0], [a, 0], [0, a], [a, a]])\n\n    # Adsorption site coordinates\n    site_bridge_coord = np.array([a / 2, 0])\n    site_hollow_coord = np.array([a / 2, a / 2])\n\n    # Calculate coordination for bridge site\n    dists_bridge = np.linalg.norm(atom_coords - site_bridge_coord, axis=1)\n    C_bridge = np.sum(dists_bridge = r_cut)\n\n    # Calculate coordination for hollow site\n    dists_hollow = np.linalg.norm(atom_coords - site_hollow_coord, axis=1)\n    C_hollow = np.sum(dists_hollow = r_cut)\n\n    all_results = []\n    \n    # --- Part 2: Convergence Search for each test case ---\n    for case in test_cases:\n        params_bridge, params_hollow = case\n        E_inf_b, alpha_b, beta_b = params_bridge\n        E_inf_h, alpha_h, beta_h = params_hollow\n\n        # Derived parameters for the energy difference equation\n        delta_E_inf = E_inf_b - E_inf_h\n        delta_alpha = alpha_b - alpha_h\n        delta_beta = beta_b - beta_h\n        \n        def delta_E(M, E_cut):\n            \"\"\"Calculates the adsorption energy difference for given parameters.\"\"\"\n            return delta_E_inf + (delta_alpha / (M**p)) + (delta_beta / (E_cut**q))\n\n        found_convergence = False\n        M_star, Ecut_star, final_delta_E = -1, -1, 0.0\n\n        # Admissible search space for M and E_cut (not the largest values)\n        admissible_M = M_values[:-1]\n        admissible_Ecut = Ecut_values[:-1]\n\n        for i, M_s in enumerate(admissible_M):\n            M_next = M_values[i + 1]\n            for j, Ecut_s in enumerate(admissible_Ecut):\n                Ecut_next = Ecut_values[j + 1]\n\n                current_dE = delta_E(M_s, Ecut_s)\n                \n                # Check convergence w.r.t. M\n                dE_M_next = delta_E(M_next, Ecut_s)\n                diff_M = abs(dE_M_next - current_dE)\n\n                # Check convergence w.r.t. E_cut\n                dE_Ecut_next = delta_E(M_s, Ecut_next)\n                diff_Ecut = abs(dE_Ecut_next - current_dE)\n\n                if diff_M = tau and diff_Ecut = tau:\n                    M_star = M_s\n                    Ecut_star = Ecut_s\n                    final_delta_E = current_dE\n                    found_convergence = True\n                    break\n            if found_convergence:\n                break\n        \n        if not found_convergence:\n            M_star, Ecut_star = -1, -1\n            final_delta_E = delta_E(M_values[-1], Ecut_values[-1])\n            \n        all_results.append([M_star, Ecut_star, final_delta_E, int(C_bridge), int(C_hollow)])\n\n    # Format the final output string as a list of lists literal\n    result_strings = []\n    for res in all_results:\n        # Manually format each inner list to ensure no spaces, e.g., \"[v1,v2,...]\"\n        s = f\"[{res[0]},{res[1]},{res[2]},{res[3]},{res[4]}]\"\n        result_strings.append(s)\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "DFT计算本质上是在 $0\\,\\mathrm{K}$ 和真空条件下进行的，这得出了纯电子能量。然而，为了将我们的计算结果与在有限温度和压力下进行的真实世界实验进行比较，我们必须弥合这一差距。这个实践练习将引导您完成一个关键步骤：使用“第一性原理原子热力学”框架，将气相分子的DFT基态能量校正为在特定 $(T, p)$ 条件下的化学势。通过这个练习，您将学会如何利用实验热化学数据来计算更实际的吸附能，从而使您的计算预测更具相关性。",
            "id": "3883860",
            "problem": "考虑一个氧分子（表示为 $\\mathrm{O}_2$）在金属板表面上的协同吸附模型，该表面具有不同的吸附位点，这些位点由直接配位的表面金属原子数来表征。目标是使用两种气相 $\\mathrm{O}_2$ 的参考标准来计算每个位点的吸附能：首先，使用密度泛函理论（DFT）的电子基态能量（密度泛函理论（DFT）是一种电子结构方法，可得出有效温度为 $0\\,\\mathrm{K}$ 时的总能量）；其次，将此参考标准校正为基于热化学的实验有限温度化学势。此外，每个位点必须通过其配位数来识别：$1$ 代表顶位，$2$ 代表桥位，$3$ 代表穴位。所有能量必须以 $\\mathrm{eV}$ 表示，所有温度以 $\\mathrm{K}$ 表示，所有压力以 $\\mathrm{bar}$ 表示。\n\n使用以下基本原理：\n- 一个 $\\mathrm{O}_2$ 分子在板上的协同吸附能定义为 $E_{\\text{ads}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - \\mu_{\\mathrm{O}_2}(T,p)$，其中 $E_{\\text{slab}+\\mathrm{O}_2}$ 和 $E_{\\text{slab}}$ 分别是吸附了和未吸附 $\\mathrm{O}_2$ 的板的总能量，而 $\\mu_{\\mathrm{O}_2}(T,p)$ 是气相 $\\mathrm{O}_2$ 在温度 $T$ 和压力 $p$ 下的化学势。\n- 在有限温度和压力下的理想气体化学势为 $\\mu_{\\mathrm{O}_2}(T,p) = \\mu_{\\mathrm{O}_2}^\\circ(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)$，其中 $\\mu_{\\mathrm{O}_2}^\\circ(T)$ 是在压力 $p^\\circ$ 下的标准化学势，$k_B$ 是玻尔兹曼常数，$\\ln$ 是自然对数。\n- 标准化学势是每个分子的标准吉布斯自由能，$\\mu_{\\mathrm{O}_2}^\\circ(T) = G^\\circ(T) = H^\\circ(T) - T S^\\circ(T)$，其中 $H^\\circ(T)$ 和 $S^\\circ(T)$ 分别是标准摩尔焓和熵。为将其与 DFT 电子能量 $E_{\\text{DFT}}(\\mathrm{O}_2)$ 联系起来，使用 $\\mu_{\\mathrm{O}_2}(T,p) = E_{\\text{DFT}}(\\mathrm{O}_2) + \\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)$，其中 $\\Delta H_{\\text{expt}}(T)$ 是相对于 $0\\,\\mathrm{K}$ 的实验测得的显焓。\n- 使用未校正的 DFT 气相参考标准的初始吸附能为 $E_{\\text{ads}}^{\\text{naive}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - E_{\\text{DFT}}(\\mathrm{O}_2)$。\n- 使用实验有限温度参考标准的校正后吸附能为 $E_{\\text{ads}}^{\\text{corr}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - \\left[E_{\\text{DFT}}(\\mathrm{O}_2) + \\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)\\right]$。\n- 有限温度校正对吸附能的影响为 $\\Delta E_{\\text{impact}} = E_{\\text{ads}}^{\\text{corr}} - E_{\\text{ads}}^{\\text{naive}} = -\\left[\\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)\\right]$。\n\n需使用的单位换算和常数：\n- 使用 $1\\,\\mathrm{eV}$ 每分子 $= 96.485\\,\\mathrm{kJ/mol}$ 将标准摩尔焓和 $T S$ 项从 $\\mathrm{kJ/mol}$ 转换为每分子的 $\\mathrm{eV}$。\n- 以 $\\mathrm{eV/K}$ 为单位的玻尔兹曼常数为 $k_B = 8.617333262145 \\times 10^{-5}\\,\\mathrm{eV/K}$。\n- 使用 $p^\\circ = 1\\,\\mathrm{bar}$。\n\n位点识别规则：\n- 配位数为 $1$ 的位点对应顶位，$2$ 对应桥位，$3$ 对应穴位。为输出目的，用配位数本身（一个整数）来编码位点类型。\n\n实现一个程序，为每个测试案例和位点计算：\n- $E_{\\text{ads}}^{\\text{naive}}$（单位 $\\mathrm{eV}$）。\n- $E_{\\text{ads}}^{\\text{corr}}$（单位 $\\mathrm{eV}$）。\n- $\\Delta E_{\\text{impact}}$（单位 $\\mathrm{eV}$）。\n- 位点类型代码，即配位数（一个整数）。\n\n将每个浮点数结果四舍五入到六位小数。\n\n测试套件（每个案例提供 $T$、$p$、$\\Delta H_{\\text{expt}}(T)$、$S_{\\text{expt}}(T)$、$E_{\\text{slab}}$、$E_{\\text{DFT}}(\\mathrm{O}_2)$ 以及每个位点的 $(E_{\\text{slab}+\\mathrm{O}_2}, \\text{coord})$）：\n- 案例 A（近环境条件下的通用情况）：\n  - $T = 298\\,\\mathrm{K}$，$p = 1\\,\\mathrm{bar}$，$\\Delta H_{\\text{expt}}(T) = 8.68\\,\\mathrm{kJ/mol}$，$S_{\\text{expt}}(T) = 205\\,\\mathrm{J/mol/K}$，$E_{\\text{slab}} = -100.000\\,\\mathrm{eV}$，$E_{\\text{DFT}}(\\mathrm{O}_2) = -10.000\\,\\mathrm{eV}$。\n  - 位点：顶位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.300\\,\\mathrm{eV}, \\text{coord} = 1)$，桥位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.600\\,\\mathrm{eV}, \\text{coord} = 2)$，穴位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.400\\,\\mathrm{eV}, \\text{coord} = 3)$。\n- 案例 B（较高温度，亚环境压力）：\n  - $T = 600\\,\\mathrm{K}$，$p = 0.1\\,\\mathrm{bar}$，$\\Delta H_{\\text{expt}}(T) = 19.54\\,\\mathrm{kJ/mol}$，$S_{\\text{expt}}(T) = 223\\,\\mathrm{J/mol/K}$，$E_{\\text{slab}} = -100.000\\,\\mathrm{eV}$，$E_{\\text{DFT}}(\\mathrm{O}_2) = -10.000\\,\\mathrm{eV}$。\n  - 位点：顶位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.300\\,\\mathrm{eV}, \\text{coord} = 1)$，桥位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.600\\,\\mathrm{eV}, \\text{coord} = 2)$，穴位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.400\\,\\mathrm{eV}, \\text{coord} = 3)$。\n- 案例 C（近环境温度，超高真空）：\n  - $T = 298\\,\\mathrm{K}$，$p = 10^{-10}\\,\\mathrm{bar}$，$\\Delta H_{\\text{expt}}(T) = 8.68\\,\\mathrm{kJ/mol}$，$S_{\\text{expt}}(T) = 205\\,\\mathrm{J/mol/K}$，$E_{\\text{slab}} = -100.000\\,\\mathrm{eV}$，$E_{\\text{DFT}}(\\mathrm{O}_2) = -10.000\\,\\mathrm{eV}$。\n  - 位点：顶位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.300\\,\\mathrm{eV}, \\text{coord} = 1)$，桥位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.600\\,\\mathrm{eV}, \\text{coord} = 2)$，穴位 $(E_{\\text{slab}+\\mathrm{O}_2} = -110.400\\,\\mathrm{eV}, \\text{coord} = 3)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，值按以下顺序为每个案例和位点展开：$[\\text{coord}, E_{\\text{ads}}^{\\text{naive}}, E_{\\text{ads}}^{\\text{corr}}, \\Delta E_{\\text{impact}}, \\ldots]$，其中省略号表示对所有案例中所有位点的重复。所有浮点数必须四舍五入到六位小数。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于统计力学和计算化学的原理，特别是用于计算表面相图的“第一性原理原子尺度热力学”框架。该问题定义明确，为获得唯一解提供了所有必要的定义、常数和数据。语言客观，量值定义清晰。\n\n任务是为氧分子 $\\mathrm{O}_2$ 在金属表面上的协同吸附，针对不同吸附位点计算三个能量描述符：初始吸附能（$E_{\\text{ads}}^{\\text{naive}}$）、校正后吸附能（$E_{\\text{ads}}^{\\text{corr}}$）和校正的影响（$\\Delta E_{\\text{impact}}$）。此外，每个位点将通过其配位数来识别。\n\n提供的基本方程如下：\n1.  初始吸附能：$E_{\\text{ads}}^{\\text{naive}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - E_{\\text{DFT}}(\\mathrm{O}_2)$\n2.  校正后吸附能：$E_{\\text{ads}}^{\\text{corr}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - \\mu_{\\mathrm{O}_2}(T,p)$\n3.  $\\mathrm{O}_2$ 的化学势：$\\mu_{\\mathrm{O}_2}(T,p) = E_{\\text{DFT}}(\\mathrm{O}_2) + \\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)$\n\n从这些方程中，我们可以推导出初始能量与校正后能量之间的关系。校正项 $\\Delta E_{\\text{impact}}$ 是它们之间的差值：\n$$\n\\Delta E_{\\text{impact}} = E_{\\text{ads}}^{\\text{corr}} - E_{\\text{ads}}^{\\text{naive}}\n$$\n代入 $E_{\\text{ads}}^{\\text{corr}}$ 和 $E_{\\text{ads}}^{\\text{naive}}$ 的定义：\n$$\n\\Delta E_{\\text{impact}} = (E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - \\mu_{\\mathrm{O}_2}(T,p)) - (E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - E_{\\text{DFT}}(\\mathrm{O}_2))\n$$\n项 $E_{\\text{slab}+\\mathrm{O}_2}$ 和 $E_{\\text{slab}}$ 相互抵消：\n$$\n\\Delta E_{\\text{impact}} = - \\mu_{\\mathrm{O}_2}(T,p) + E_{\\text{DFT}}(\\mathrm{O}_2)\n$$\n代入 $\\mu_{\\mathrm{O}_2}(T,p)$ 的表达式：\n$$\n\\Delta E_{\\text{impact}} = - \\left[ E_{\\text{DFT}}(\\mathrm{O}_2) + \\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right) \\right] + E_{\\text{DFT}}(\\mathrm{O}_2)\n$$\n$E_{\\text{DFT}}(\\mathrm{O}_2)$ 项相互抵消，得出校正影响的表达式：\n$$\n\\Delta E_{\\text{impact}} = -\\left[\\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) + k_B T \\ln\\!\\left(\\frac{p}{p^\\circ}\\right)\\right]\n$$\n这个项 $\\Delta E_{\\text{impact}}$ 包含了温度和压力对气相参考能量的影响。对于给定的条件（$T, p$），它对所有吸附位点都是恒定的。因此，校正后的吸附能可以简单地通过 $E_{\\text{ads}}^{\\text{corr}} = E_{\\text{ads}}^{\\text{naive}} + \\Delta E_{\\text{impact}}$ 来计算。\n\n解决此问题的算法如下：\n首先，对于每个测试案例，我们计算 $\\Delta E_{\\text{impact}}$ 的值。这涉及到仔细的单位换算。标准摩尔焓 $\\Delta H_{\\text{expt}}(T)$ 的单位是 $\\mathrm{kJ/mol}$，标准摩尔熵 $S_{\\text{expt}}(T)$ 的单位是 $\\mathrm{J/mol/K}$。对自由能的熵贡献项 $-T S_{\\text{expt}}(T)$ 必须通过除以 $1000$ 从 $\\mathrm{J/mol}$ 转换为 $\\mathrm{kJ/mol}$。然后，合并项 $\\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T)$ 的单位是 $\\mathrm{kJ/mol}$。我们使用提供的换算因子 $1\\,\\mathrm{eV} = 96.485\\,\\mathrm{kJ/mol}$ 将其转换为每分子的 $\\mathrm{eV}$。依赖于压力的项 $k_B T \\ln(p/p^\\circ)$ 使用玻尔兹曼常数 $k_B=8.617333262145 \\times 10^{-5}\\,\\mathrm{eV/K}$ 直接以 $\\mathrm{eV}$ 计算。标准压力 $p^\\circ$ 是 $1\\,\\mathrm{bar}$。\n\n其次，对于测试案例中的每个吸附位点，我们使用给定的 DFT 总能量计算 $E_{\\text{ads}}^{\\text{naive}}$。该值与温度和压力无关。\n\n第三，我们将先前计算的 $\\Delta E_{\\text{impact}}$ 加到 $E_{\\text{ads}}^{\\text{naive}}$ 上，以计算 $E_{\\text{ads}}^{\\text{corr}}$。\n\n最后，根据问题规范，通过其整数配位数来识别位点类型。所有得到的浮点值都四舍五入到六位小数。\n\n让我们以案例 A 的桥位（$\\text{coord}=2$）为例进行单次计算说明：\n- 给定：$T = 298\\,\\mathrm{K}$，$p = 1\\,\\mathrm{bar}$，$\\Delta H_{\\text{expt}}(T) = 8.68\\,\\mathrm{kJ/mol}$，$S_{\\text{expt}}(T) = 205\\,\\mathrm{J/mol/K}$，$E_{\\text{slab}} = -100.000\\,\\mathrm{eV}$，$E_{\\text{DFT}}(\\mathrm{O}_2) = -10.000\\,\\mathrm{eV}$，$E_{\\text{slab}+\\mathrm{O}_2} = -110.600\\,\\mathrm{eV}$。\n\n1.  计算 $\\Delta E_{\\text{impact}}$：\n    - 熵能项：$T S_{\\text{expt}}(T) = 298\\,\\mathrm{K} \\times 205\\,\\mathrm{J/mol/K} = 61090\\,\\mathrm{J/mol} = 61.09\\,\\mathrm{kJ/mol}$。\n    - 以 $\\mathrm{kJ/mol}$ 为单位的热化学能量校正：$\\Delta H_{\\text{expt}}(T) - T S_{\\text{expt}}(T) = 8.68 - 61.09 = -52.41\\,\\mathrm{kJ/mol}$。\n    - 转换为 $\\mathrm{eV}$：$\\frac{-52.41\\,\\mathrm{kJ/mol}}{96.485\\,\\mathrm{kJ/mol/eV}} \\approx -0.543209\\,\\mathrm{eV}$。\n    - 压力项：$k_B T \\ln(p/p^\\circ) = k_B \\times 298\\,\\mathrm{K} \\times \\ln(1/1) = 0\\,\\mathrm{eV}$。\n    - 总校正：$\\Delta E_{\\text{impact}} = -(-0.543209\\,\\mathrm{eV} + 0\\,\\mathrm{eV}) = 0.543209\\,\\mathrm{eV}$。\n\n2.  计算桥位的 $E_{\\text{ads}}^{\\text{naive}}$：\n    - $E_{\\text{ads}}^{\\text{naive}} = E_{\\text{slab}+\\mathrm{O}_2} - E_{\\text{slab}} - E_{\\text{DFT}}(\\mathrm{O}_2) = -110.600 - (-100.000) - (-10.000) = -0.600\\,\\mathrm{eV}$。\n\n3.  计算桥位的 $E_{\\text{ads}}^{\\text{corr}}$：\n    - $E_{\\text{ads}}^{\\text{corr}} = E_{\\text{ads}}^{\\text{naive}} + \\Delta E_{\\text{impact}} = -0.600\\,\\mathrm{eV} + 0.543209\\,\\mathrm{eV} = -0.056791\\,\\mathrm{eV}$。\n\n此特定位点的结果为：位点类型代码 $2$，$E_{\\text{ads}}^{\\text{naive}} = -0.600000\\,\\mathrm{eV}$，$E_{\\text{ads}}^{\\text{corr}} = -0.056791\\,\\mathrm{eV}$，以及 $\\Delta E_{\\text{impact}} = 0.543209\\,\\mathrm{eV}$。此过程将对所有测试案例中的所有位点重复进行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational chemistry problem for associative adsorption of O2.\n    Computes naive and corrected adsorption energies, the correction impact,\n    and identifies the site type for a given set of test cases.\n    \"\"\"\n    # Define constants and conversion factors as specified.\n    KB_EV_K = 8.617333262145e-5  # Boltzmann constant in eV/K\n    KJ_MOL_PER_EV = 96.485        # Conversion factor from kJ/mol to eV/molecule\n    P_STD = 1.0                   # Standard pressure in bar\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"T\": 298.0,  # K\n            \"p\": 1.0,    # bar\n            \"delta_H_expt\": 8.68,   # kJ/mol\n            \"S_expt\": 205.0,        # J/mol/K\n            \"E_slab\": -100.0,       # eV\n            \"E_dft_O2\": -10.0,      # eV\n            \"sites\": [\n                {\"E_slab_O2\": -110.300, \"coord\": 1},  # top\n                {\"E_slab_O2\": -110.600, \"coord\": 2},  # bridge\n                {\"E_slab_O2\": -110.400, \"coord\": 3},  # hollow\n            ],\n        },\n        {\n            \"name\": \"Case B\",\n            \"T\": 600.0,\n            \"p\": 0.1,\n            \"delta_H_expt\": 19.54,\n            \"S_expt\": 223.0,\n            \"E_slab\": -100.0,\n            \"E_dft_O2\": -10.0,\n            \"sites\": [\n                {\"E_slab_O2\": -110.300, \"coord\": 1},\n                {\"E_slab_O2\": -110.600, \"coord\": 2},\n                {\"E_slab_O2\": -110.400, \"coord\": 3},\n            ],\n        },\n        {\n            \"name\": \"Case C\",\n            \"T\": 298.0,\n            \"p\": 1e-10,\n            \"delta_H_expt\": 8.68,\n            \"S_expt\": 205.0,\n            \"E_slab\": -100.0,\n            \"E_dft_O2\": -10.0,\n            \"sites\": [\n                {\"E_slab_O2\": -110.300, \"coord\": 1},\n                {\"E_slab_O2\": -110.600, \"coord\": 2},\n                {\"E_slab_O2\": -110.400, \"coord\": 3},\n            ],\n        },\n    ]\n\n    all_results_flat = []\n\n    for case in test_cases:\n        T = case[\"T\"]\n        p = case[\"p\"]\n        delta_H_expt = case[\"delta_H_expt\"]\n        S_expt_J = case[\"S_expt\"]\n        E_slab = case[\"E_slab\"]\n        E_dft_O2 = case[\"E_dft_O2\"]\n\n        # 1. Calculate the impact of the finite-temperature correction (Delta_E_impact)\n        # This term is constant for all sites in a given case.\n\n        # Calculate T*S term and convert from J/mol to kJ/mol\n        T_S_expt_kJ = (T * S_expt_J) / 1000.0\n\n        # Calculate the thermochemical contribution (enthalpy and entropy)\n        thermo_correction_kJ = delta_H_expt - T_S_expt_kJ\n        \n        # Convert from kJ/mol to eV/molecule\n        thermo_correction_eV = thermo_correction_kJ / KJ_MOL_PER_EV\n\n        # Calculate the pressure contribution\n        pressure_correction_eV = KB_EV_K * T * np.log(p / P_STD)\n\n        # The term to be subtracted from the naive energy is the sum of these corrections.\n        # Delta_E_impact is the negative of this term.\n        correction_sum = thermo_correction_eV + pressure_correction_eV\n        delta_E_impact = -correction_sum\n\n        for site in case[\"sites\"]:\n            E_slab_O2 = site[\"E_slab_O2\"]\n            coord_num = site[\"coord\"]\n\n            # 2. Compute the naive adsorption energy (E_ads_naive)\n            E_ads_naive = E_slab_O2 - E_slab - E_dft_O2\n\n            # 3. Compute the corrected adsorption energy (E_ads_corr)\n            E_ads_corr = E_ads_naive + delta_E_impact\n            \n            # 4. Append results for the current site to the flattened list\n            all_results_flat.extend([\n                coord_num,\n                E_ads_naive,\n                E_ads_corr,\n                delta_E_impact\n            ])\n\n    # Format the results for the final output string.\n    # Integers are converted to strings, floats are rounded to 6 decimal places.\n    formatted_results = []\n    for val in all_results_flat:\n        if isinstance(val, float):\n            formatted_results.append(f\"{val:.6f}\")\n        else:\n            formatted_results.append(str(val))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在计算催化研究中，我们经常通过结构优化或分子动力学模拟生成大量的候选吸附构型。一个常见的挑战是，许多这些构型在数值上可能略有不同，但实际上代表了同一个物理状态，或通过周期性边界或对称性等效。本练习将教您一种强大的方法，通过计算考虑了周期性和原子排列不变性的均方根偏差（RMSD），来对这些结构进行聚类，从而自动识别出真正独特的吸附位点。掌握这项技能对于高通量筛选和构建准确的催化位点目录至关重要。",
            "id": "3883826",
            "problem": "给定多个在铜 (Cu) $(111)$ 表面上的优化吸附结构，您必须通过对在用户定义的容差范围内几何上无法区分的结构进行聚类，来防止对几乎等效的位点进行重复计数。其基本原理包括欧几里得几何和二维晶格上的周期性边界条件。铜的面心立方晶格参数用 $a_{\\mathrm{Cu}}$ 表示，单位为 $\\mathrm{\\AA}$，且 $(111)$ 表面形成一个二维三角晶格，其原胞矢量长度为 $a_{\\mathrm{surf}} = a_{\\mathrm{Cu}}/\\sqrt{2}$。设二维原胞晶格矢量在笛卡尔坐标系下为 $\\mathbf{a}_1 = (a_{\\mathrm{surf}}, 0)$ 和 $\\mathbf{a}_2 = (a_{\\mathrm{surf}}/2, \\sqrt{3}\\,a_{\\mathrm{surf}}/2)$。每个吸附结构由 $N$ 个分数坐标 $(u_i, v_i)$ 指定，其中 $0 \\le u_i, v_i  1$，描述了第 $i$ 个吸附质原子相对于表面晶格的位置 $\\mathbf{r}_i = u_i \\mathbf{a}_1 + v_i \\mathbf{a}_2$。\n\n如果两个结构 $A$ 和 $B$（每个结构包含 $N$ 个原子）在周期性边界条件 (PBC) 下的最小均方根偏差 (RMSD) 小于或等于几何容差 $\\tau$（单位为 $\\mathrm{\\AA}$），则认为它们是等效的。在 PBC 下，对于任意一对分数坐标为 $(u_i^A, v_i^A)$ 和 $(u_j^B, v_j^B)$ 的原子，其距离根据最小镜像约定定义为\n$$\nd_{ij} = \\min_{n_1,n_2 \\in \\mathbb{Z}} \\left\\| (u_i^A - u_j^B + n_1) \\mathbf{a}_1 + (v_i^A - v_j^B + n_2) \\mathbf{a}_2 \\right\\|,\n$$\n其中 $\\|\\cdot\\|$ 是欧几里得范数。结构 $A$ 和 $B$ 之间的 RMSD 则为\n$$\n\\mathrm{RMSD}(A,B) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} d_{i,\\pi(i)}^2 },\n$$\n其中 $\\pi$ 是 $\\{1,\\ldots,N\\}$ 的一个排列，其选择旨在最小化总平方距离，即，\n$$\n\\pi^* = \\arg\\min_{\\pi} \\sum_{i=1}^{N} d_{i,\\pi(i)}^2.\n$$\n定义一个无向图，其节点为各个结构，如果两个节点之间的 $\\mathrm{RMSD}(A,B) \\le \\tau$，则它们之间存在一条边。聚类即为该图的连通分量。您的任务是实现此聚类算法并报告聚类的数量。\n\n物理单位要求：几何容差 $\\tau$ 必须以 $\\mathrm{\\AA}$ 为单位表示，并在整个计算过程中保持一致。此问题不使用角度。最终答案应为表示聚类数量的整数。\n\n请实现一个程序，针对下面指定的每个测试用例，构建 Cu$(111)$ 晶格，计算具有最优匹配的成对最小镜像 RMSD，使用上述连通性规则形成聚类，并输出该用例的聚类数量。\n\n测试套件：\n1. 理想情况下的聚类，其中重复项远在容差范围内。参数：$a_{\\mathrm{Cu}} = 3.615\\,\\mathrm{\\AA}$，$\\tau = 0.05\\,\\mathrm{\\AA}$，结构为位于以下分数坐标处的单原子吸附质：\n   - 顶位 (Top): $(0, 0)$\n   - 顶位近边界重复项: $(0.995, 0.0)$\n   - 桥位 (Bridge): $(0.5, 0.0)$\n   - 桥位微小扰动: $(0.5, 0.01)$\n   - 面心立方 (fcc) 洞穴位: $(\\tfrac{1}{3}, \\tfrac{1}{3})$\n   - fcc 微小扰动: $(\\tfrac{1}{3} + 0.01, \\tfrac{1}{3})$\n   - 六方密堆 (hcp) 洞穴位: $(\\tfrac{2}{3}, \\tfrac{2}{3})$\n   - hcp 微小扰动: $(\\tfrac{2}{3}, \\tfrac{2}{3} + 0.008)$\n\n2. 在精确容差下的边界情况包含，以及一个单独的远距离变体。参数：$a_{\\mathrm{Cu}} = 3.615\\,\\mathrm{\\AA}$，$\\tau = 0.05\\,\\mathrm{\\AA}$。设 $\\delta = \\tau / a_{\\mathrm{surf}}$。结构：\n   - 顶位 (Top): $(0, 0)$\n   - 沿 $\\mathbf{a}_1$ 方向且恰好在容差边界上的顶位：$(\\delta, 0)$\n   - fcc: $(\\tfrac{1}{3}, \\tfrac{1}{3})$\n   - 超出容差的 fcc 位：$(\\tfrac{1}{3} + \\delta + 0.005, \\tfrac{1}{3})$\n\n3. 紧密容差下的周期性边界敏感性。参数：$a_{\\mathrm{Cu}} = 3.615\\,\\mathrm{\\AA}$，$\\tau = 0.02\\,\\mathrm{\\AA}$。结构：\n   - 顶位 (Top): $(0, 0)$\n   - 在容差范围内的顶位近边界项：$(0.995, 0.0)$\n   - 超出容差范围的顶位近边界项：$(0.99, 0.0)$\n\n4. 具有排列不变性和微小刚性平移的多原子结构。参数：$a_{\\mathrm{Cu}} = 3.615\\,\\mathrm{\\AA}$，$\\tau = 0.03\\,\\mathrm{\\AA}$。每个结构有两个原子：\n   - 沿 $\\mathbf{a}_1$ 方向的桥位取向双原子分子：$[(0.4, 0.0), (0.6, 0.0)]$\n   - 原子经过排列的相同双原子分子：$[(0.6, 0.0), (0.4, 0.0)]$\n   - 沿 $\\mathbf{a}_2$ 方向有微小平移的相同双原子分子：$[(0.4, 0.008), (0.6, 0.008)]$\n   - 沿 $\\mathbf{a}_2$ 方向的不同取向：$[(0.5, -0.1), (0.5, 0.1)]$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4}]$），列表中的每个条目是对应测试用例的整数聚类数。",
            "solution": "我们从欧几里得几何和二维晶格上的周期性边界条件开始。铜 $(111)$ 表面被建模为一个三角晶格，该晶格是通过将晶格参数为 $a_{\\mathrm{Cu}}$ 的面心立方晶格投影到 $(111)$ 平面上得到的。二维晶格常数为 $a_{\\mathrm{surf}} = a_{\\mathrm{Cu}}/\\sqrt{2}$，一组方便选择的原胞矢量为 $\\mathbf{a}_1 = (a_{\\mathrm{surf}}, 0)$ 和 $\\mathbf{a}_2 = (a_{\\mathrm{surf}}/2, \\sqrt{3}\\,a_{\\mathrm{surf}}/2)$，它们之间成 $60^{\\circ}$ 角且长度相等。\n\n每个吸附结构由 $N$ 个分数坐标 $(u_i, v_i)$ 定义，并解释为 $\\mathbf{r}_i = u_i \\mathbf{a}_1 + v_i \\mathbf{a}_2$。在周期性边界条件下，任何点在经过 $\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 的整数倍线性组合平移后都是等效的。因此，在比较两个分数坐标为 $(u_i^A, v_i^A)$ 和 $(u_j^B, v_j^B)$ 的原子时，我们必须计算所有周期性镜像中的最短实空间距离：\n$$\nd_{ij} = \\min_{n_1, n_2 \\in \\mathbb{Z}} \\left\\| (u_i^A - u_j^B + n_1) \\mathbf{a}_1 + (v_i^A - v_j^B + n_2) \\mathbf{a}_2 \\right\\|.\n$$\n这包含了最小镜像约定，该约定确保了平移不变性，这与周期性表面上唯一吸附位点的分类是一致的。在实践中，由于 $\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 定义了一个倾斜度不大的原胞，我们可以通过在最接近的分数坐标差周围搜索一个小的整数平移邻域来有效地找到 $\\mathbb{Z}^2$ 上的精确最小值。对于二维情况，一种稳健的方法是考虑候选的 $n_1 \\in \\{\\mathrm{round}(\\Delta u) - 1, \\mathrm{round}(\\Delta u), \\mathrm{round}(\\Delta u) + 1\\}$ 以及类似的 $n_2$，其中 $\\Delta u = u_i^A - u_j^B$ 和 $\\Delta v = v_i^A - v_j^B$，然后选择使欧几里得范数最小化的 $(n_1, n_2)$ 对。这样可以在不进行详尽搜索的情况下捕捉到 PBC 下的最近镜像。\n\n为了比较具有多个原子的两个结构，原子的排序和标记不能影响结果。因此，我们通过最优匹配来计算均方根偏差 (RMSD)，该匹配旨在最小化总平方距离。设结构 $A$ 和 $B$ 各包含 $N$ 个原子。定义成本矩阵 $C \\in \\mathbb{R}^{N \\times N}$，其元素为\n$$\nC_{ij} = d_{ij}^2,\n$$\n其中 $d_{ij}$ 是结构 $A$ 中原子 $i$ 与结构 $B$ 中原子 $j$ 之间的最小镜像距离。最优匹配是使 $\\sum_{i=1}^{N} C_{i,\\pi(i)}$ 最小化的排列 $\\pi^*$。这是一个线性指派问题，可通过匈牙利算法求解。给定 $\\pi^*$，我们计算\n$$\n\\mathrm{RMSD}(A,B) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} C_{i,\\pi^*(i)}}.\n$$\n\n如果 $\\mathrm{RMSD}(A,B) \\le \\tau$，则两个结构在无向图中有边相连，其中 $\\tau$ 是用户定义的几何容差，单位为 $\\mathrm{\\AA}$。聚类即为此图的连通分量，我们可以通过并查集（不相交集）数据结构找到它们。聚类的数量等于在合并所有满足容差标准的对之后的不相交集的数量。\n\n我们现在对测试套件进行分析：\n\n1. 理想情况下的聚类：$a_{\\mathrm{Cu}} = 3.615\\,\\mathrm{\\AA}$，所以 $a_{\\mathrm{surf}} = 3.615/\\sqrt{2} \\approx 2.555978\\,\\mathrm{\\AA}$。容差 $\\tau = 0.05\\,\\mathrm{\\AA}$。结构是位于对应于标准 Cu$(111)$ 位点（顶位、桥位、fcc、hcp）及其微小扰动的单原子，扰动远低于容差。近边界重复项 $(0.995,0)$ 在 PBC 下与 $(0,0)$ 的距离约为 $0.005\\,a_{\\mathrm{surf}} \\approx 0.0128\\,\\mathrm{\\AA}$。桥位扰动 $(0.5,0.01)$ 的距离约为 $\\approx 0.0256\\,\\mathrm{\\AA}$。沿 $\\mathbf{a}_1$ 方向的 fcc 扰动 $0.01$ 距离约为 $\\approx 0.0256\\,\\mathrm{\\AA}$，沿 $\\mathbf{a}_2$ 方向的 hcp 扰动 $0.008$ 距离约为 $\\approx 0.0204\\,\\mathrm{\\AA}$。所有扰动都在 $\\tau$ 范围内，因此每对结构都会聚类，最终产生四个聚类：顶位、桥位、fcc 和 hcp。\n\n2. 边界情况包含：相同的 $a_{\\mathrm{Cu}}$ 和 $\\tau$。设 $\\delta = \\tau/a_{\\mathrm{surf}} \\approx 0.019567$。顶位对 $(0,0)$ 和 $(\\delta,0)$ 的间距恰好为 $\\tau$，因此根据包含性准则 $\\le \\tau$，它们被聚为一类。位于 $(\\tfrac{1}{3},\\tfrac{1}{3})$ 和 $(\\tfrac{1}{3}+\\delta+0.005, \\tfrac{1}{3})$ 的 fcc 结构沿 $\\mathbf{a}_1$ 方向相差约 $\\approx 0.055\\,\\mathrm{\\AA}$，超过了 $\\tau$，因此它们形成两个独立的聚类。总聚类数：三个。\n\n3. 紧密容差下的周期性边界敏感性：$\\tau = 0.02\\,\\mathrm{\\AA}$。在 PBC 下，点 $(0.995,0)$ 与 $(0,0)$ 的距离约为 $\\approx 0.0128\\,\\mathrm{\\AA}$，因此与它聚为一类。点 $(0.99,0)$ 与 $(0,0)$ 的距离约为 $\\approx 0.0256\\,\\mathrm{\\AA}$，不发生聚类。因此有两个聚类。\n\n4. 多原子排列不变性：$\\tau = 0.03\\,\\mathrm{\\AA}$。在最优匹配下，结构 $[(0.4,0.0),(0.6,0.0)]$ 及其排列版本是相同的，RMSD 为零。平移后的结构 $[(0.4,0.008),(0.6,0.008)]$ 每个原子相差约 $\\approx 0.0204\\,\\mathrm{\\AA}$，产生的 RMSD 约为 $\\approx 0.0204\\,\\mathrm{\\AA}$，在 $\\tau$ 范围内，因此这三者形成一个聚类。取向改变的结构 $[(0.5,-0.1),(0.5,0.1)]$ 与沿 $\\mathbf{a}_1$ 方向的桥位取向双原子分子每个原子大约相差 $0.2556\\,\\mathrm{\\AA}$（因为 $0.1\\,a_{\\mathrm{surf}} \\approx 0.2556\\,\\mathrm{\\AA}$），超过了 $\\tau$；它形成一个独立的聚类。总聚类数：两个。\n\n算法步骤如下：\n- 计算 $a_{\\mathrm{surf}}$ 和原胞矢量 $\\mathbf{a}_1, \\mathbf{a}_2$。\n- 对于每对结构，通过在取整后的分数坐标差值周围进行小范围整数搜索，计算最小镜像距离的平方所构成的成本矩阵。\n- 求解线性指派问题以获得最小总平方距离，并计算 RMSD。\n- 通过连接 $\\mathrm{RMSD} \\le \\tau$ 的结构来构建图；使用并查集来导出连通分量。\n- 对于每个测试用例，输出聚类的数量。\n\n程序将实现这些步骤，并按规定格式生成一行包含四个测试用例对应的四个整数的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linear_sum_assignment\n\ndef lattice_vectors(a_cu: float):\n    \"\"\"\n    Construct the 2D primitive lattice vectors for Cu(111) in Cartesian coordinates.\n    Returns a_surf, a1, a2 where a1, a2 are 2D vectors.\n    \"\"\"\n    a_surf = a_cu / np.sqrt(2.0)\n    a1 = np.array([a_surf, 0.0])\n    a2 = np.array([a_surf/2.0, np.sqrt(3.0)*a_surf/2.0])\n    return a_surf, a1, a2\n\ndef min_image_vector(delta_frac: np.ndarray, a1: np.ndarray, a2: np.ndarray):\n    \"\"\"\n    Compute the minimum-image real-space vector for a fractional difference delta_frac = [du, dv].\n    Searches a small neighborhood of integer shifts around rounded components to handle oblique cells.\n    \"\"\"\n    du, dv = delta_frac\n    # Candidates around nearest integers to fractional differences\n    n1_candidates = [int(np.round(du)) + off for off in (-1, 0, 1)]\n    n2_candidates = [int(np.round(dv)) + off for off in (-1, 0, 1)]\n    best_vec = None\n    best_norm2 = np.inf\n    for n1 in n1_candidates:\n        for n2 in n2_candidates:\n            vec = (du - n1) * a1 + (dv - n2) * a2\n            norm2 = np.dot(vec, vec)\n            if norm2  best_norm2:\n                best_norm2 = norm2\n                best_vec = vec\n    return best_vec\n\ndef pairwise_distance_squared(frac_a: np.ndarray, frac_b: np.ndarray, a1: np.ndarray, a2: np.ndarray):\n    \"\"\"\n    Compute squared minimum-image distance between two fractional coordinates (2D).\n    \"\"\"\n    delta = frac_a - frac_b\n    vec = min_image_vector(delta, a1, a2)\n    return float(np.dot(vec, vec))\n\ndef rmsd_between_structures(frac_struct_a: np.ndarray, frac_struct_b: np.ndarray, a1: np.ndarray, a2: np.ndarray):\n    \"\"\"\n    Compute RMSD between two structures (Nx2 fractional coordinates) under optimal assignment.\n    \"\"\"\n    n = frac_struct_a.shape[0]\n    assert frac_struct_b.shape[0] == n, \"Structures must have the same number of atoms\"\n    # Build cost matrix of squared distances\n    cost = np.zeros((n, n), dtype=float)\n    for i in range(n):\n        for j in range(n):\n            cost[i, j] = pairwise_distance_squared(frac_struct_a[i], frac_struct_b[j], a1, a2)\n    row_ind, col_ind = linear_sum_assignment(cost)\n    total = cost[row_ind, col_ind].sum()\n    rmsd = np.sqrt(total / n)\n    return rmsd\n\nclass UnionFind:\n    def __init__(self, n):\n        self.parent = list(range(n))\n        self.rank = [0] * n\n    def find(self, x):\n        while self.parent[x] != x:\n            self.parent[x] = self.parent[self.parent[x]]\n            x = self.parent[x]\n        return x\n    def union(self, x, y):\n        rx, ry = self.find(x), self.find(y)\n        if rx == ry:\n            return\n        if self.rank[rx]  self.rank[ry]:\n            self.parent[rx] = ry\n        elif self.rank[rx] > self.rank[ry]:\n            self.parent[ry] = rx\n        else:\n            self.parent[ry] = rx\n            self.rank[rx] += 1\n    def count_sets(self):\n        roots = {self.find(i) for i in range(len(self.parent))}\n        return len(roots)\n\ndef cluster_count(structures: list, a_cu: float, tau: float):\n    \"\"\"\n    Compute the number of clusters for a given set of structures and tolerance tau (in Angstrom).\n    \"\"\"\n    a_surf, a1, a2 = lattice_vectors(a_cu)\n    n_structs = len(structures)\n    uf = UnionFind(n_structs)\n    for i in range(n_structs):\n        for j in range(i + 1, n_structs):\n            rmsd = rmsd_between_structures(structures[i], structures[j], a1, a2)\n            if rmsd = tau + 1e-12:  # inclusive threshold with tiny numerical tolerance\n                uf.union(i, j)\n    return uf.count_sets()\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each structure is represented as an array of fractional coordinates (Nx2).\n    a_cu = 3.615  # Angstrom\n\n    # Test case 1: Happy path clustering with duplicates well within tolerance (single-atom structures)\n    tau1 = 0.05\n    structures1 = [\n        np.array([[0.0, 0.0]]),            # Top\n        np.array([[0.995, 0.0]]),          # Top near-boundary duplicate\n        np.array([[0.5, 0.0]]),            # Bridge\n        np.array([[0.5, 0.01]]),           # Bridge slight perturbation\n        np.array([[1.0/3.0, 1.0/3.0]]),    # fcc\n        np.array([[1.0/3.0 + 0.01, 1.0/3.0]]),  # fcc slight perturbation\n        np.array([[2.0/3.0, 2.0/3.0]]),    # hcp\n        np.array([[2.0/3.0, 2.0/3.0 + 0.008]]),  # hcp slight perturbation\n    ]\n\n    # Test case 2: Boundary-case inclusion at exact tolerance with a separate far variant (single-atom structures)\n    tau2 = 0.05\n    a_surf, _, _ = lattice_vectors(a_cu)\n    delta = tau2 / a_surf\n    structures2 = [\n        np.array([[0.0, 0.0]]),                    # Top\n        np.array([[delta, 0.0]]),                  # Top at exact tolerance along a1\n        np.array([[1.0/3.0, 1.0/3.0]]),            # fcc\n        np.array([[1.0/3.0 + delta + 0.005, 1.0/3.0]]),  # fcc beyond tolerance\n    ]\n\n    # Test case 3: Periodic boundary sensitivity with tight tolerance (single-atom structures)\n    tau3 = 0.02\n    structures3 = [\n        np.array([[0.0, 0.0]]),           # Top\n        np.array([[0.995, 0.0]]),         # Top near-boundary within tolerance\n        np.array([[0.99, 0.0]]),          # Top near-boundary outside tolerance\n    ]\n\n    # Test case 4: Multi-atom structure with permutation invariance and small rigid translation (two-atom structures)\n    tau4 = 0.03\n    structures4 = [\n        np.array([[0.4, 0.0], [0.6, 0.0]]),       # Bridge-oriented dimer along a1\n        np.array([[0.6, 0.0], [0.4, 0.0]]),       # Same dimer with permuted atoms\n        np.array([[0.4, 0.008], [0.6, 0.008]]),   # Same dimer with small translation along a2\n        np.array([[0.5, -0.1], [0.5, 0.1]]),      # Distinct orientation along a2\n    ]\n\n    test_cases = [\n        (a_cu, tau1, structures1),\n        (a_cu, tau2, structures2),\n        (a_cu, tau3, structures3),\n        (a_cu, tau4, structures4),\n    ]\n\n    results = []\n    for a_cu_val, tau_val, structs in test_cases:\n        count = cluster_count(structs, a_cu_val, tau_val)\n        results.append(count)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}