{
    "hands_on_practices": [
        {
            "introduction": "The voltage profile of a lithium-ion cell is a direct reflection of the underlying thermodynamics of the electrode materials. This exercise contrasts solid-solution and phase-separating behaviors, providing a quantitative link between the material's free energy and an observable electrochemical signature. You will calculate the duration of a voltage plateau, a key feature of many cathode materials, based on first-principles thermodynamic and mass-conservation arguments .",
            "id": "4242973",
            "problem": "A spherical positive-electrode particle in a lithium-ion cell is modeled within the Doyle–Fuller–Newman framework under the single-particle simplification with galvanostatic operation and negligible electrolyte and electronic ohmic losses. The goal is to contrast solid-solution thermodynamics with phase-separating thermodynamics for the intercalation host and quantify the duration of a voltage plateau during discharge when a miscibility gap exists.\n\nAssume the following physically consistent setting. Let the intercalation fraction be $\\,\\theta \\in (0,1)\\,$ defined by $\\,\\theta = c_s/c_{\\max}\\,$ where $\\,c_s\\,$ is the solid-phase lithium concentration and $\\,c_{\\max}\\,$ is the maximum site concentration. The particle is a sphere of radius $\\,R\\,$ and surface area $\\,S\\,$ with volume $\\,V\\,$ satisfying $\\,S/V = 3/R\\,$. Under a constant applied interfacial current density $\\,j\\,$ (in $\\mathrm{A/m^2}$) at the particle surface, the molar intercalation flux $\\,j_n\\,$ (in $\\mathrm{mol/(m^2\\cdot s)}$) obeys $\\,j = F\\, j_n\\,$, where $\\,F\\,$ is the Faraday constant. Mass conservation implies the spatially averaged solid concentration evolves according to\n$$\n\\frac{d c_s}{dt} = \\frac{S}{V}\\, j_n = \\frac{3}{R}\\, j_n,\n$$\nso that the intercalation fraction obeys\n$$\n\\frac{d \\theta}{dt} = \\frac{1}{c_{\\max}} \\frac{d c_s}{dt} = \\frac{3 j}{R\\,F\\,c_{\\max}}.\n$$\nConsider isothermal operation at temperature $\\,T\\,$ and neglect any kinetic limitations in evaluating the duration spent in any thermodynamically defined two-phase region. The electrochemical thermodynamics of the positive electrode are described by a molar free-energy density $\\,g(\\theta)\\,$ per intercalation site. Two distinct models are to be examined:\n\n- Solid solution model: a convex ideal solution free energy,\n$$\ng_{\\mathrm{ss}}(\\theta) = R_g T\\left[\\theta \\ln \\theta + (1-\\theta)\\ln (1-\\theta)\\right],\n$$\nwith $\\,R_g\\,$ the universal gas constant.\n\n- Phase-separating model: a regular solution free energy with a symmetric interaction parameter $\\,\\Omega\\,$,\n$$\ng_{\\mathrm{rs}}(\\theta) = R_g T\\left[\\theta \\ln \\theta + (1-\\theta)\\ln (1-\\theta)\\right] + \\Omega\\, \\theta(1-\\theta).\n$$\n\nThe associated chemical potential is defined by the thermodynamic identity\n$$\n\\mu(\\theta) = \\frac{\\partial g(\\theta)}{\\partial \\theta}.\n$$\nWhen $\\,\\Omega \\le 2 R_g T\\,$, the free energy $\\,g_{\\mathrm{rs}}(\\theta)\\,$ is convex and the material behaves as a solid solution. When $\\,\\Omega > 2 R_g T\\,$, a miscibility gap exists. In the miscibility gap, the common-tangent construction defines two coexisting compositions $\\,\\theta_1\\,$ and $\\,\\theta_2\\,$ and a plateau chemical potential $\\,\\mu_t\\,$ such that\n$$\n\\mu(\\theta_1) = \\mu(\\theta_2) = \\mu_t,\n\\qquad\ng(\\theta_2) - g(\\theta_1) = \\mu_t\\,(\\theta_2 - \\theta_1),\n$$\nwith $\\,\\theta_1 < \\theta_2\\,$. During galvanostatic discharge, as the spatial average $\\,\\theta\\,$ traverses the interval $[\\theta_1,\\theta_2]$, the cell voltage is pinned to a plateau (up to kinetic overpotentials that are neglected here for the plateau duration calculation), and the time spent in the plateau equals the time required for the average composition to sweep the interval overlapped by the discharge window.\n\nYour task is to implement a program that, for a set of test cases, computes the duration (in seconds) of the voltage plateau during discharge for the phase-separating regular-solution model using the above first-principles thermodynamic definitions and mass conservation, and reports zero plateau duration if no miscibility gap exists. Use the following constants everywhere: $\\,T = 298.15\\,\\mathrm{K}$, $\\,R_g = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$, $\\,F = 96485.33212\\,\\mathrm{C/mol}$, $\\,c_{\\max} = 25000\\,\\mathrm{mol/m^3}$. Discharge is from an initial intercalation fraction $\\,\\theta_0 = 0.10\\,$ to a final fraction $\\,\\theta_f = 0.90\\,$.\n\nFor each test case, you must:\n1. Determine whether a miscibility gap exists by evaluating the condition $\\,\\Omega > 2 R_g T\\,$.\n2. If a miscibility gap exists, compute the coexisting compositions $\\,\\theta_1\\,$ and $\\,\\theta_2\\,$ using the common-tangent conditions given above, based strictly on $\\,g_{\\mathrm{rs}}(\\theta)\\,$.\n3. Compute the overlap $\\,\\Delta \\theta\\,$ of the interval $[\\theta_1,\\theta_2]$ with the discharge window $[\\theta_0,\\theta_f]$.\n4. Compute the plateau duration using the mass-conservation rate,\n$$\nt_{\\mathrm{plateau}} = \\frac{\\Delta \\theta}{\\frac{3 j}{R\\,F\\,c_{\\max}}}.\n$$\nIf there is no miscibility gap or the overlap $\\,\\Delta \\theta = 0\\,$, set $\\,t_{\\mathrm{plateau}} = 0\\,$. Express each plateau duration in seconds, rounded to six decimal places.\n\nTest suite:\n- Case 1 (happy path, clear phase separation): $\\,\\Omega = 7000\\,\\mathrm{J/mol}\\,$, $\\,j = 5\\,\\mathrm{A/m^2}\\,$, $\\,R = 5\\times 10^{-6}\\,\\mathrm{m}\\,$.\n- Case 2 (solid solution, no phase separation): $\\,\\Omega = 0\\,\\mathrm{J/mol}\\,$, $\\,j = 5\\,\\mathrm{A/m^2}\\,$, $\\,R = 5\\times 10^{-6}\\,\\mathrm{m}\\,$.\n- Case 3 (boundary, onset threshold): $\\,\\Omega = 2 R_g T\\,\\mathrm{J/mol}\\,$, $\\,j = 20\\,\\mathrm{A/m^2}\\,$, $\\,R = 5\\times 10^{-6}\\,\\mathrm{m}\\,$.\n\nFinal output format:\nYour program should produce a single line of output containing the plateau durations for the three cases as a comma-separated list enclosed in square brackets, in seconds, each rounded to six decimal places (e.g., \"[t1,t2,t3]\").",
            "solution": "The problem requires the calculation of the voltage plateau duration during the galvanostatic discharge of a spherical positive-electrode particle in a lithium-ion cell, modeled using the single-particle simplification of the Doyle-Fuller-Newman framework. The analysis contrasts a solid-solution material with a phase-separating material, with the latter being described by a regular solution model for its free energy.\n\nThe first step in our analysis is to establish the relationship between the applied current and the change in the state of charge of the particle, which is quantified by the average intercalation fraction $\\,\\theta\\,$. The problem provides the governing equation for the rate of change of $\\,\\theta\\,$ under a constant applied interfacial current density $\\,j\\,$:\n$$\n\\frac{d\\theta}{dt} = \\frac{3 j}{R\\,F\\,c_{\\max}}\n$$\nwhere $\\,R\\,$ is the particle radius, $\\,F\\,$ is the Faraday constant, and $\\,c_{\\max}\\,$ is the maximum solid-phase concentration. Since the rate $\\,d\\theta/dt\\,$ is constant, the time $\\,t_{\\mathrm{plateau}}\\,$ required for the average intercalation fraction to sweep an interval of width $\\,\\Delta\\theta\\,$ is given by:\n$$\nt_{\\mathrm{plateau}} = \\frac{\\Delta\\theta}{\\frac{d\\theta}{dt}} = \\frac{\\Delta\\theta \\cdot R\\,F\\,c_{\\max}}{3j}\n$$\nThe core of the problem lies in determining the interval width $\\,\\Delta\\theta\\,$ that corresponds to the voltage plateau.\n\nA voltage plateau is a direct thermodynamic consequence of two-phase coexistence in the electrode material. The problem provides the molar free-energy density for a phase-separating regular solution model:\n$$\ng_{\\mathrm{rs}}(\\theta) = R_g T\\left[\\theta \\ln \\theta + (1-\\theta)\\ln (1-\\theta)\\right] + \\Omega\\, \\theta(1-\\theta)\n$$\nHere, $\\,R_g\\,$ is the universal gas constant, $\\,T\\,$ is the absolute temperature, and $\\,\\Omega\\,$ is the interaction parameter. The associated chemical potential $\\,\\mu(\\theta)\\,$ is obtained by differentiation with respect to $\\,\\theta\\,$:\n$$\n\\mu(\\theta) = \\frac{\\partial g_{\\mathrm{rs}}}{\\partial \\theta} = R_g T \\ln\\left(\\frac{\\theta}{1-\\theta}\\right) + \\Omega(1 - 2\\theta)\n$$\nA miscibility gap, leading to phase separation, exists if and only if the free energy function $\\,g_{\\mathrm{rs}}(\\theta)\\,$ is not convex everywhere in the domain $\\,\\theta \\in (0,1)\\,$. This condition is met when the interaction parameter $\\,\\Omega\\,$ exceeds a critical value, given by $\\,\\Omega > 2 R_g T\\,$. If $\\,\\Omega \\le 2 R_g T\\,$, the material behaves as a solid solution, no miscibility gap forms, and the plateau duration is zero.\n\nWhen $\\,\\Omega > 2 R_g T\\,$, the system separates into two coexisting phases with lithium concentrations corresponding to intercalation fractions $\\,\\theta_1\\,$ and $\\,\\theta_2\\,$ ($\\,\\theta_1 < \\theta_2\\,$). These compositions are known as the binodal points and are determined by the common-tangent construction on the free energy curve. The two conditions for this are:\n1.  Equal chemical potential: $\\,\\mu(\\theta_1) = \\mu(\\theta_2)\\,$\n2.  Common tangent slope: $\\,\\displaystyle \\frac{g_{\\mathrm{rs}}(\\theta_2) - g_{\\mathrm{rs}}(\\theta_1)}{\\theta_2 - \\theta_1} = \\mu(\\theta_1)\\,$\n\nFor the symmetric regular solution model, the binodal compositions are symmetric about $\\,\\theta = 0.5\\,$, which implies $\\,\\theta_2 = 1 - \\theta_1\\,$. Substituting this symmetry into the first condition, $\\,\\mu(\\theta_1) = \\mu(1-\\theta_1)\\,$, yields:\n$$\nR_g T \\ln\\left(\\frac{\\theta_1}{1-\\theta_1}\\right) + \\Omega(1 - 2\\theta_1) = R_g T \\ln\\left(\\frac{1 - \\theta_1}{\\theta_1}\\right) + \\Omega(1 - 2(1 - \\theta_1))\n$$\n$$\nR_g T \\ln\\left(\\frac{\\theta_1}{1-\\theta_1}\\right) + \\Omega(1 - 2\\theta_1) = -R_g T \\ln\\left(\\frac{\\theta_1}{1-\\theta_1}\\right) - \\Omega(1 - 2\\theta_1)\n$$\nThis simplifies to a single transcendental equation for $\\,\\theta_1\\,$:\n$$\n\\ln\\left(\\frac{\\theta_1}{1-\\theta_1}\\right) = \\frac{\\Omega}{R_g T}(2\\theta_1 - 1)\n$$\nIt can be shown that applying the symmetry condition $\\,\\theta_2 = 1-\\theta_1\\,$ to the second common-tangent condition results in the same equation. For $\\,\\Omega > 2 R_g T\\,$, this equation has a non-trivial root for $\\,\\theta_1 \\in (0, 0.5)\\,$, which must be found numerically.\n\nOnce $\\,\\theta_1\\,$ and $\\,\\theta_2\\,$ are determined, the material exhibits a constant chemical potential (and thus a constant open-circuit voltage) as the average intercalation fraction $\\,\\theta\\,$ sweeps the interval $\\,[\\theta_1, \\theta_2]\\,$. The problem specifies a discharge process from an initial state $\\,\\theta_0 = 0.10\\,$ to a final state $\\,\\theta_f = 0.90\\,$. The plateau duration corresponds to the time spent traversing the portion of the miscibility gap that overlaps with this discharge window. The width of this overlap, $\\,\\Delta\\theta\\,$, is given by the length of the intersection of the two intervals $\\,[\\theta_1, \\theta_2]\\,$ and $\\,[\\theta_0, \\theta_f]\\,$:\n$$\n\\Delta\\theta = \\max(0, \\min(\\theta_2, \\theta_f) - \\max(\\theta_1, \\theta_0))\n$$\nIf $\\,\\Delta\\theta = 0\\,$ or if no miscibility gap exists, the plateau duration $\\,t_{\\mathrm{plateau}}\\,$ is $\\,0\\,$.\n\nThe procedure for each test case is as follows:\n1.  Define the constants: $\\,T = 298.15\\,\\mathrm{K}$, $\\,R_g = 8.314462618\\,\\mathrm{J/(mol\\cdot K)}$, $\\,F = 96485.33212\\,\\mathrm{C/mol}$, $\\,c_{\\max} = 25000\\,\\mathrm{mol/m^3}\\,$, $\\,\\theta_0 = 0.10\\,$, $\\,\\theta_f = 0.90\\,$.\n2.  For a given set of parameters $\\,(\\Omega, j, R)\\,$, calculate the critical interaction energy $\\,E_{crit} = 2 R_g T\\,$.\n3.  If $\\,\\Omega \\le E_{crit}\\,$, set $\\,t_{\\mathrm{plateau}} = 0\\,$.\n4.  If $\\,\\Omega > E_{crit}\\,$, numerically solve the transcendental equation for $\\,\\theta_1 \\in (0, 0.5)\\,$. Then, set $\\,\\theta_2 = 1 - \\theta_1\\,$.\n5.  Calculate the overlap width $\\,\\Delta\\theta\\,$ as defined above.\n6.  Calculate the plateau duration using the mass conservation formula: $\\,t_{\\mathrm{plateau}} = (\\Delta\\theta \\cdot R\\,F\\,c_{\\max}) / (3j)\\,$.\n7.  Report the result in seconds, rounded to six decimal places.\nThis systematic approach provides a rigorous and physically grounded solution to the problem.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves for the voltage plateau duration in a phase-separating electrode particle\n    for a given set of test cases.\n    \"\"\"\n    \n    # Define physical constants and problem parameters\n    T = 298.15  # Temperature [K]\n    R_g = 8.314462618  # Universal gas constant [J/(mol·K)]\n    F = 96485.33212  # Faraday constant [C/mol]\n    C_MAX = 25000.0  # Maximum site concentration [mol/m^3]\n    THETA_0 = 0.10  # Initial intercalation fraction (start of discharge)\n    THETA_F = 0.90  # Final intercalation fraction (end of discharge)\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: Happy path, clear phase separation\n        {\"Omega\": 7000.0, \"j\": 5.0, \"R\": 5e-6},\n        # Case 2: Solid solution, no phase separation\n        {\"Omega\": 0.0, \"j\": 5.0, \"R\": 5e-6},\n        # Case 3: Boundary, onset threshold\n        {\"Omega\": 2 * R_g * T, \"j\": 20.0, \"R\": 5e-6},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Omega = case[\"Omega\"]\n        j = case[\"j\"]\n        R = case[\"R\"]\n        \n        t_plateau = calculate_plateau_duration(Omega, j, R, T, R_g, F, C_MAX, THETA_0, THETA_F)\n        results.append(f\"{t_plateau:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_plateau_duration(Omega, j, R, T, R_g, F, c_max, theta_0, theta_f):\n    \"\"\"\n    Calculates the plateau duration for a single set of parameters.\n\n    Args:\n        Omega (float): Regular solution interaction parameter [J/mol].\n        j (float): Applied current density [A/m^2].\n        R (float): Particle radius [m].\n        T (float): Temperature [K].\n        R_g (float): Universal gas constant [J/(mol·K)].\n        F (float): Faraday constant [C/mol].\n        c_max (float): Maximum site concentration [mol/m^3].\n        theta_0 (float): Initial intercalation fraction.\n        theta_f (float): Final intercalation fraction.\n\n    Returns:\n        float: The calculated plateau duration in seconds.\n    \"\"\"\n    \n    # Step 1: Determine whether a miscibility gap exists.\n    e_crit = 2 * R_g * T\n    if Omega = e_crit:\n        # No miscibility gap, so plateau duration is zero.\n        return 0.0\n\n    # Step 2: If a miscibility gap exists, compute the coexisting compositions.\n    # The transcendental equation to solve for theta_1 is:\n    # ln(theta/(1-theta)) - (Omega/(R_g*T))*(2*theta - 1) = 0\n    # We define a function whose root we seek in the interval (0, 0.5).\n    A = Omega / (R_g * T)\n    def root_func(theta):\n        return np.log(theta / (1 - theta)) - A * (2 * theta - 1)\n\n    # Use a robust numerical root-finder (Brent's method) to find theta_1.\n    # The search interval is (0, 0.5), but we use a small epsilon to avoid division by zero.\n    try:\n        # theta_1 is the root in the lower half of the composition range\n        theta_1 = brentq(root_func, 1e-9, 0.5 - 1e-9)\n        # Due to symmetry of the regular solution model, theta_2 = 1 - theta_1.\n        theta_2 = 1 - theta_1\n    except ValueError:\n        # Should not happen for Omega > e_crit, but included for robustness.\n        return 0.0\n\n    # Step 3: Compute the overlap Delta_theta of the miscibility gap with the discharge window.\n    # Miscibility gap interval: [theta_1, theta_2]\n    # Discharge window interval: [theta_0, theta_f]\n    overlap_start = max(theta_1, theta_0)\n    overlap_end = min(theta_2, theta_f)\n    \n    Delta_theta = max(0, overlap_end - overlap_start)\n\n    if Delta_theta == 0:\n        return 0.0\n\n    # Step 4: Compute the plateau duration.\n    # d(theta)/dt = (3 * j) / (R * F * c_max)\n    d_theta_dt = (3 * j) / (R * F * c_max)\n    \n    t_plateau = Delta_theta / d_theta_dt\n    \n    return t_plateau\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The rate at which a battery can be charged or discharged is often limited by how quickly lithium ions can move within the solid electrode particles. This practice guides you through building a numerical solver for the spherical diffusion equation, a core component of the Doyle-Fuller-Newman model. By fitting the model to synthetic voltage data, you will also perform a parameter estimation for the solid diffusion coefficient, a crucial skill in battery modeling .",
            "id": "4242979",
            "problem": "You are tasked with estimating solid-phase diffusion coefficients in the Doyle-Fuller-Newman (DFN) model context for lithium-ion cells by solving and inverting the spherical solid diffusion equation for an electrode particle. The estimation should be carried out by fitting transient voltage data generated under a small galvanostatic step, where the voltage response is dominated by solid diffusion. The derivation and computation must begin from first principles of mass conservation and Fick's laws of diffusion, without relying on pre-specified shortcut formulas.\n\nConsider a single spherical active material particle of radius $R$ undergoing lithium intercalation. The solid-phase concentration $c(r,t)$ is governed by Fick's second law in spherical coordinates, derived from mass conservation and the constitutive flux law. The governing balance for the local concentration is the partial differential equation\n$$\n\\frac{\\partial c}{\\partial t} = D \\left( \\frac{\\partial^2 c}{\\partial r^2} + \\frac{2}{r} \\frac{\\partial c}{\\partial r} \\right),\n$$\nwhere $D$ is the solid diffusion coefficient to be estimated. The initial condition is a uniform concentration\n$$\nc(r,0) = c_0,\n$$\nand the boundary conditions are symmetry at the center\n$$\n\\left. \\frac{\\partial c}{\\partial r} \\right|_{r=0} = 0,\n$$\nand a specified molar flux $J$ at the surface (inward insertion taken as positive) linked to intercalation by mass conservation,\n$$\n- D \\left. \\frac{\\partial c}{\\partial r} \\right|_{r=R} = J.\n$$\n\nAssume the terminal voltage is dominated by the open-circuit potential variation with surface concentration and linearize it around the initial state as\n$$\nU(t) = U_0 + k \\left( c(R,t) - c_0 \\right),\n$$\nwhere $k$ is the local slope of the open-circuit potential with respect to solid concentration in units of volts times cubic meters per mole, $U_0$ is the initial open-circuit voltage, and $c(R,t)$ is the surface concentration. This approximation is valid under small currents where kinetic and electrolyte contributions to voltage are negligible for the transient times considered.\n\nYour program must:\n- Implement a time-stepping solver for the spherical diffusion equation using a stable implicit discretization in space and time that enforces the symmetry and flux boundary conditions. Use a uniform radial grid. The solver must compute $c(R,t)$ for a given $D$, $R$, $J$, $c_0$, final time $T$, and time step $\\Delta t$.\n- Generate synthetic voltage time-series data $U_{\\text{meas}}(t)$ from the model using a known \"true\" diffusion coefficient $D_{\\text{true}}$ and add small, zero-mean Gaussian noise of a specified standard deviation.\n- Formulate and solve the inverse problem to estimate $D$ by minimizing the sum of squared differences between the measured and model-predicted voltages over the time grid,\n$$\n\\min_{D_{\\min} \\le D \\le D_{\\max}} \\sum_{n=1}^{N_t} \\left( U_{\\text{model}}(t_n; D) - U_{\\text{meas}}(t_n) \\right)^2,\n$$\nwhere $N_t$ is the number of time points, and $D_{\\min}$ and $D_{\\max}$ are physically plausible bounds on $D$. Use a robust bounded scalar minimization.\n\nAll physical quantities and constants must be used in International System of Units (SI). Express the final estimated diffusion coefficients in meters squared per second (m^2/s) as floating-point numbers.\n\nImplement the solver under the following discrete approximation requirements:\n- Use a backward Euler time discretization for stability.\n- Use a second-order finite-difference spatial discretization for the spherical Laplacian on a uniform grid with nodes $r_i = i \\Delta r$ for $i = 0, 1, \\dots, N$, where $N$ is the number of radial intervals. Enforce the center symmetry condition using an appropriate discrete approximation and treat the surface flux boundary condition by introducing a ghost point to convert the flux into a source term in the surface node equation.\n- Ensure numerical stability and accuracy sufficient to resolve the transient responses for the provided parameter sets.\n\nTest Suite:\nRun your program for the following three parameter sets. In each case, generate synthetic data using the specified $D_{\\text{true}}$, estimate $D$, and return the estimated value. The final output must be a single line containing the estimated $D$ values for the three cases in the specified format.\n\nCase $1$ (general case):\n- Particle radius $R = 5 \\times 10^{-6}$ meters.\n- True solid diffusion coefficient $D_{\\text{true}} = 2 \\times 10^{-13}$ meters squared per second.\n- Constant molar flux at surface $J = 1 \\times 10^{-6}$ moles per square meter per second.\n- Initial concentration $c_0 = 20000$ moles per cubic meter.\n- Open-circuit voltage parameters: $U_0 = 3.7$ volts, $k = -1 \\times 10^{-4}$ volts times cubic meters per mole.\n- Final time $T = 100$ seconds and time step $\\Delta t = 0.2$ seconds.\n- Number of radial intervals $N = 30$ (i.e., $31$ nodes).\n- Additive Gaussian voltage noise standard deviation $\\sigma = 5 \\times 10^{-4}$ volts.\n\nCase $2$ (slow diffusion, larger particle):\n- Particle radius $R = 1.0 \\times 10^{-5}$ meters.\n- True solid diffusion coefficient $D_{\\text{true}} = 1 \\times 10^{-14}$ meters squared per second.\n- Constant molar flux at surface $J = 5 \\times 10^{-7}$ moles per square meter per second.\n- Initial concentration $c_0 = 15000$ moles per cubic meter.\n- Open-circuit voltage parameters: $U_0 = 3.8$ volts, $k = -8 \\times 10^{-5}$ volts times cubic meters per mole.\n- Final time $T = 300$ seconds and time step $\\Delta t = 0.5$ seconds.\n- Number of radial intervals $N = 40$.\n- Additive Gaussian voltage noise standard deviation $\\sigma = 1 \\times 10^{-3}$ volts.\n\nCase $3$ (fast diffusion, smaller particle):\n- Particle radius $R = 2 \\times 10^{-6}$ meters.\n- True solid diffusion coefficient $D_{\\text{true}} = 5 \\times 10^{-11}$ meters squared per second.\n- Constant molar flux at surface $J = 2 \\times 10^{-6}$ moles per square meter per second.\n- Initial concentration $c_0 = 22000$ moles per cubic meter.\n- Open-circuit voltage parameters: $U_0 = 3.6$ volts, $k = -1.2 \\times 10^{-4}$ volts times cubic meters per mole.\n- Final time $T = 10$ seconds and time step $\\Delta t = 0.02$ seconds.\n- Number of radial intervals $N = 25$.\n- Additive Gaussian voltage noise standard deviation $\\sigma = 2 \\times 10^{-4}$ volts.\n\nBounds for the diffusion coefficient in the inverse problem for all cases must be $D_{\\min} = 1 \\times 10^{-15}$ meters squared per second and $D_{\\max} = 1 \\times 10^{-9}$ meters squared per second.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[d_1,d_2,d_3]$, where $d_i$ are the estimated diffusion coefficients for Case $i$ expressed in meters squared per second (m^2/s) as floating-point numbers.",
            "solution": "The problem requires the estimation of the solid-phase diffusion coefficient, $D$, for a spherical electrode particle, a fundamental problem in the modeling of lithium-ion batteries using the Doyle-Fuller-Newman (DFN) framework. The approach involves two main parts: first, developing a numerical solver for the governing partial differential equation (PDE) of diffusion (the forward problem), and second, using this solver within an optimization routine to fit model predictions to synthetic, noisy voltage data (the inverse problem).\n\n### I. The Forward Problem: Solving the Spherical Diffusion Equation\n\nThe concentration of lithium, $c(r,t)$, within a spherical particle of radius $R$ is governed by Fick's second law in spherical coordinates:\n$$\n\\frac{\\partial c}{\\partial t} = \\frac{1}{r^2} \\frac{\\partial}{\\partial r} \\left( D r^2 \\frac{\\partial c}{\\partial r} \\right) = D \\left( \\frac{\\partial^2 c}{\\partial r^2} + \\frac{2}{r} \\frac{\\partial c}{\\partial r} \\right) \\quad \\text{for } 0  r  R, t  0\n$$\nwhere $D$ is the constant solid diffusion coefficient.\n\nThe initial and boundary conditions are:\n1.  **Initial Condition**: A uniform concentration $c_0$ at $t=0$.\n    $$ c(r,0) = c_0 $$\n2.  **Center Symmetry**: No flux at the center of the particle, due to symmetry.\n    $$ \\left. \\frac{\\partial c}{\\partial r} \\right|_{r=0} = 0 $$\n3.  **Surface Flux**: A constant molar flux $J$ at the surface, representing lithium intercalation/deintercalation.\n    $$ -D \\left. \\frac{\\partial c}{\\partial r} \\right|_{r=R} = J $$\n\nTo solve this PDE numerically, we employ the finite difference method. We discretize the spatial domain $r \\in [0, R]$ into $N$ intervals of width $\\Delta r = R/N$, with nodes $r_i = i \\Delta r$ for $i=0, 1, \\dots, N$. The time domain is discretized with a constant step $\\Delta t$, with time points $t_k = k \\Delta t$. Let $c_i^k \\approx c(r_i, t_k)$.\n\nWe use the backward Euler method for the time derivative, which is unconditionally stable:\n$$\n\\frac{\\partial c}{\\partial t} \\approx \\frac{c_i^{k+1} - c_i^k}{\\Delta t}\n$$\n\nFor spatial derivatives, we use second-order central differences:\n$$\n\\frac{\\partial c}{\\partial r} \\bigg|_{r_i} \\approx \\frac{c_{i+1}^{k+1} - c_{i-1}^{k+1}}{2 \\Delta r}\n$$\n$$\n\\frac{\\partial^2 c}{\\partial r^2} \\bigg|_{r_i} \\approx \\frac{c_{i+1}^{k+1} - 2c_i^{k+1} + c_{i-1}^{k+1}}{(\\Delta r)^2}\n$$\n\n#### Discretized Equations\n\n**For an interior node ($1 \\le i \\le N-1$):**\nSubstituting the finite difference approximations into the PDE yields:\n$$\n\\frac{c_i^{k+1} - c_i^k}{\\Delta t} = D \\left( \\frac{c_{i+1}^{k+1} - 2c_i^{k+1} + c_{i-1}^{k+1}}{(\\Delta r)^2} + \\frac{2}{i \\Delta r} \\frac{c_{i+1}^{k+1} - c_{i-1}^{k+1}}{2 \\Delta r} \\right)\n$$\nLetting $\\alpha = D \\Delta t / (\\Delta r)^2$, we can rearrange this into a linear equation relating the unknown concentrations at step $k+1$ to the known concentrations at step $k$:\n$$\n-\\alpha \\left(1 - \\frac{1}{i}\\right) c_{i-1}^{k+1} + (1+2\\alpha) c_i^{k+1} - \\alpha \\left(1 + \\frac{1}{i}\\right) c_{i+1}^{k+1} = c_i^k\n$$\n\n**For the center node ($r_0=0$, $i=0$):**\nThe term $2/r$ creates a singularity. We use L'Hôpital's rule to show that as $r \\to 0$, the spherical Laplacian simplifies to $3D \\frac{\\partial^2 c}{\\partial r^2}$. The symmetry condition implies $c_{-1}^{k+1} = c_{1}^{k+1}$. The discretized equation at the center is:\n$$\n\\frac{c_0^{k+1} - c_0^k}{\\Delta t} = 3D \\frac{c_1^{k+1} - 2c_0^{k+1} + c_{-1}^{k+1}}{(\\Delta r)^2} = 6D \\frac{c_1^{k+1} - c_0^{k+1}}{(\\Delta r)^2}\n$$\nRearranging gives:\n$$\n(1+6\\alpha) c_0^{k+1} - 6\\alpha c_1^{k+1} = c_0^k\n$$\n\n**For the surface node ($r_N=R$, $i=N$):**\nTo maintain second-order accuracy, we use a ghost point at $r_{N+1} = R + \\Delta r$. The flux boundary condition is discretized using a central difference at $r_N=R$:\n$$\n-D \\frac{c_{N+1}^{k+1} - c_{N-1}^{k+1}}{2 \\Delta r} = J  \\implies c_{N+1}^{k+1} = c_{N-1}^{k+1} - \\frac{2J\\Delta r}{D}\n$$\nSubstituting this into the discretized PDE at node $i=N$:\n$$\n\\frac{c_N^{k+1} - c_N^k}{\\Delta t} = D \\left( \\frac{c_{N+1}^{k+1} - 2c_N^{k+1} + c_{N-1}^{k+1}}{(\\Delta r)^2} + \\frac{2}{R} \\frac{c_{N+1}^{k+1} - c_{N-1}^{k+1}}{2 \\Delta r} \\right)\n$$\nSubstituting the expression for $c_{N+1}^{k+1}$ leads to simplification. A more robust way is to substitute the flux expression directly into the second term:\n$$\n\\frac{c_N^{k+1} - c_N^k}{\\Delta t} = D \\frac{c_{N+1}^{k+1} - 2c_N^{k+1} + c_{N-1}^{k+1}}{(\\Delta r)^2} - \\frac{2J}{R}\n$$\nNow, substituting for the ghost point $c_{N+1}^{k+1}$:\n$$\n\\frac{c_N^{k+1} - c_N^k}{\\Delta t} = D \\frac{2c_{N-1}^{k+1} - 2c_N^{k+1}}{(\\Delta r)^2} - \\frac{2J}{\\Delta r} - \\frac{2J}{R}\n$$\nRearranging and using $R=N\\Delta r$ gives:\n$$\n-2\\alpha c_{N-1}^{k+1} + (1+2\\alpha) c_N^{k+1} = c_N^k - \\frac{2J\\Delta t}{\\Delta r} \\left(1 + \\frac{1}{N}\\right)\n$$\n\nThe set of $N+1$ linear equations for $c_i^{k+1}$ ($i=0, \\dots, N$) forms a tridiagonal matrix system $\\mathbf{M} \\mathbf{c}^{k+1} = \\mathbf{d}^k$, which can be solved efficiently at each time step. The matrix $\\mathbf{M}$ is constant in time, so it needs to be assembled only once. We use `scipy.linalg.solve_banded` for this purpose.\n\n### II. The Inverse Problem: Parameter Estimation\n\nThe goal is to estimate $D$. We first generate synthetic \"measured\" voltage data $U_{\\text{meas}}(t)$ using the forward model with a known true diffusion coefficient, $D_{\\text{true}}$, and add Gaussian noise:\n$$\nU_{\\text{meas}}(t_n) = U_{\\text{true}}(t_n) + \\mathcal{N}(0, \\sigma^2)\n$$\nwhere $U_{\\text{true}}(t_n) = U_0 + k(c(R, t_n; D_{\\text{true}}) - c_0)$, and $\\mathcal{N}(0, \\sigma^2)$ is a normally distributed random variable with mean $0$ and standard deviation $\\sigma$.\n\nThe estimation of $D$ is formulated as a least-squares minimization problem. We seek the value of $D$ within a plausible range $[D_{\\min}, D_{\\max}]$ that minimizes the sum of squared differences between the model-predicted voltage and the synthetic data:\n$$\n\\min_{D_{\\min} \\le D \\le D_{\\max}} \\mathcal{L}(D) = \\sum_{n=1}^{N_t} \\left( U_{\\text{model}}(t_n; D) - U_{\\text{meas}}(t_n) \\right)^2\n$$\nwhere $U_{\\text{model}}(t_n; D) = U_0 + k(c(R, t_n; D) - c_0)$ is the voltage predicted by the forward model for a trial coefficient $D$. This is a scalar-bounded optimization problem, which we solve using `scipy.optimize.minimize_scalar` with the 'bounded' method.\n\n### III. Implementation Details\n\nThe implementation consists of two main functions:\n1.  `solve_pde`: This function implements the forward model. It takes physical parameters including a trial $D$ and numerical parameters ($T$, $\\Delta t$, $N$) as input. It assembles the tridiagonal system matrix $\\mathbf{M}$ and iteratively solves for the concentration profile over time, returning the surface concentration time series $c(R,t)$.\n2.  `solve`: This main function iterates through the three test cases provided. For each case, it:\n    a. Generates the synthetic noisy voltage data $U_{\\text{meas}}(t)$ using `solve_pde` with $D_{\\text{true}}$. A fixed random seed is used for reproducibility.\n    b. Defines an objective function that takes a trial $D$, calls `solve_pde` to get the model-predicted voltage, and returns the sum of squared errors against $U_{\\text{meas}}(t)$.\n    c. Calls `scipy.optimize.minimize_scalar` to find the optimal $D$ that minimizes the objective function.\n    d. Collects the estimated $D$ values and formats them for the final output.\n\nThe choice of numerical parameters ($N$, $\\Delta t$) for each case ensures numerical stability and sufficient resolution of the diffusion dynamics across different timescales.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\nfrom scipy.linalg import solve_banded\n\ndef solve_pde(D, R, J, c0, T, dt, N):\n    \"\"\"\n    Solves the spherical diffusion PDE using an implicit finite difference method.\n\n    Args:\n        D (float): Solid diffusion coefficient (m^2/s).\n        R (float): Particle radius (m).\n        J (float): Molar flux at the surface (mol/m^2/s).\n        c0 (float): Initial uniform concentration (mol/m^3).\n        T (float): Final time (s).\n        dt (float): Time step (s).\n        N (int): Number of radial intervals.\n\n    Returns:\n        tuple: A tuple containing:\n            - time_points (np.ndarray): Array of time points.\n            - c_surface (np.ndarray): Array of surface concentrations over time.\n    \"\"\"\n    dr = R / N\n    alpha = D * dt / (dr**2)\n    num_nodes = N + 1\n    \n    # Set up the tridiagonal matrix M in banded form for solve_banded.\n    # The matrix ab has shape (3, num_nodes) for kl=1, ku=1.\n    # ab[0,:] = super-diagonal (A[i, i+1])\n    # ab[1,:] = main diagonal (A[i, i])\n    # ab[2,:] = sub-diagonal (A[i, i-1])\n    ab = np.zeros((3, num_nodes))\n    \n    # Main diagonal\n    ab[1, 0] = 1.0 + 6.0 * alpha\n    ab[1, 1:] = 1.0 + 2.0 * alpha\n    \n    # Upper diagonal\n    ab[0, 1] = -6.0 * alpha\n    i_upper = np.arange(1, N)\n    ab[0, i_upper + 1] = -alpha * (1.0 + 1.0 / i_upper)\n    \n    # Lower diagonal\n    i_lower = np.arange(1, N)\n    # The j-th element of the i-th sub-diagonal is ab[i+ku, j]\n    # For sub-diagonal 1 (i=1), A[j+1, j] is ab[1+1, j].\n    # solve_banded expects ab[ku + i - j, j] = A[i,j].\n    # Lower diag: j = i-1 => ab[1 + i - (i-1), i-1] = ab[2, i-1] = A[i, i-1]\n    ab[2, i_lower - 1] = -alpha * (1.0 - 1.0 / i_lower)\n    # Surface node term A[N, N-1]\n    ab[2, N-1] = -2.0 * alpha\n\n    # Constant part of the RHS from the flux boundary condition\n    b_const = np.zeros(num_nodes)\n    if N > 0:\n        b_const[-1] = - (2.0 * J * dt / dr) * (1.0 + 1.0 / N)\n\n    # Time stepping\n    time_points = np.arange(0, T + dt, dt)\n    c = np.full(num_nodes, c0)\n    c_surface = np.zeros(len(time_points))\n    c_surface[0] = c0\n\n    for k in range(1, len(time_points)):\n        rhs = c + b_const\n        c = solve_banded((1, 1), ab, rhs, check_finite=False)\n        c_surface[k] = c[-1]\n    \n    return time_points, c_surface\n\ndef solve():\n    \"\"\"\n    Main function to run test cases for estimating the diffusion coefficient.\n    \"\"\"\n    # Use a fixed random seed for reproducible results\n    np.random.seed(0)\n\n    # Common parameters for optimization\n    D_min = 1e-15\n    D_max = 1e-9\n\n    test_cases = [\n        # Case 1 (general case)\n        {\n            \"R\": 5e-6, \"D_true\": 2e-13, \"J\": 1e-6, \"c0\": 20000,\n            \"U0\": 3.7, \"k\": -1e-4, \"T\": 100, \"dt\": 0.2, \"N\": 30,\n            \"sigma\": 5e-4\n        },\n        # Case 2 (slow diffusion, larger particle)\n        {\n            \"R\": 1.0e-5, \"D_true\": 1e-14, \"J\": 5e-7, \"c0\": 15000,\n            \"U0\": 3.8, \"k\": -8e-5, \"T\": 300, \"dt\": 0.5, \"N\": 40,\n            \"sigma\": 1e-3\n        },\n        # Case 3 (fast diffusion, smaller particle)\n        {\n            \"R\": 2e-6, \"D_true\": 5e-11, \"J\": 2e-6, \"c0\": 22000,\n            \"U0\": 3.6, \"k\": -1.2e-4, \"T\": 10, \"dt\": 0.02, \"N\": 25,\n            \"sigma\": 2e-4\n        }\n    ]\n\n    estimated_Ds = []\n\n    for params in test_cases:\n        # 1. Generate synthetic \"measured\" data\n        time_points, c_surf_true = solve_pde(\n            params[\"D_true\"], params[\"R\"], params[\"J\"], params[\"c0\"], \n            params[\"T\"], params[\"dt\"], params[\"N\"]\n        )\n        U_true = params[\"U0\"] + params[\"k\"] * (c_surf_true - params[\"c0\"])\n        noise = np.random.normal(0, params[\"sigma\"], len(U_true))\n        U_meas = U_true + noise\n\n        # 2. Define the objective function for minimization\n        def objective_func(D_trial):\n            _, c_surf_model = solve_pde(\n                D_trial, params[\"R\"], params[\"J\"], params[\"c0\"], \n                params[\"T\"], params[\"dt\"], params[\"N\"]\n            )\n            U_model = params[\"U0\"] + params[\"k\"] * (c_surf_model - params[\"c0\"])\n            return np.sum((U_model - U_meas)**2)\n\n        # 3. Perform bounded scalar minimization\n        result = minimize_scalar(\n            objective_func,\n            bounds=(D_min, D_max),\n            method='bounded'\n        )\n        estimated_Ds.append(result.x)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{d:.6e}' for d in estimated_Ds)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "The Butler-Volmer equation describes the rate of the electrochemical reaction at the electrode-electrolyte interface, a process governed by the exchange current density, $j_0$. This exercise demonstrates how to calibrate this critical kinetic parameter using data from cyclic voltammetry (CV), a standard electrochemical characterization technique. You will learn to isolate the faradaic current from capacitive effects and fit the data to the kinetic model, bridging the gap between theory and experimental measurement .",
            "id": "4242987",
            "problem": "You are tasked with calibrating the exchange current density parameter in the Doyle-Fuller-Newman model for lithium-ion cells from cyclic voltammetry (CV) data. The exchange current density plays a central role in the interfacial kinetics modeled by the Butler-Volmer equation. In the small-overpotential region typical of CV around equilibrium, the interface current is primarily governed by charge-transfer kinetics and the double-layer capacitance.\n\nStarting point, assumptions, and definitions:\n- The Doyle-Fuller-Newman model describes porous electrode behavior, where the interfacial reaction current density is given by the Butler-Volmer equation. For symmetric anodic and cathodic transfer coefficients with value $0.5$, the interfacial current density reduces to\n$$\nj_{n}(\\eta) = 2 j_{0} \\sinh\\left(\\frac{\\alpha F \\eta}{R T}\\right),\n$$\nwhere $j_{n}$ is the interfacial reaction current density in $\\mathrm{A}/\\mathrm{m}^2$, $j_{0}$ is the exchange current density in $\\mathrm{A}/\\mathrm{m}^2$, $\\eta$ is the interfacial overpotential in $\\mathrm{V}$, $F$ is the Faraday constant in $\\mathrm{C}/\\mathrm{mol}$, $R$ is the universal gas constant in $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$, $T$ is the absolute temperature in $\\mathrm{K}$, and $\\alpha$ is the charge-transfer coefficient (dimensionless).\n- In cyclic voltammetry, the applied potential $E(t)$ is swept linearly in time with scan rate $v$, so that $\\mathrm{d}E/\\mathrm{d}t = \\pm v$ depending on the scan direction, with $v$ in $\\mathrm{V}/\\mathrm{s}$.\n- The measured current density $i(t)$ is the sum of the faradaic current density $j_{n}(t)$ and the capacitive current density due to the double layer: $i(t) = j_{n}(t) + C_{\\mathrm{dl}} \\, \\mathrm{d}E/\\mathrm{d}t$, where $C_{\\mathrm{dl}}$ is the double-layer capacitance per unit area in $\\mathrm{F}/\\mathrm{m}^2$.\n- The overpotential is defined as $\\eta = E - U(x)$, where $U(x)$ is the equilibrium open-circuit potential for stoichiometry $x$ in the active material (dimensionless), and $E$ is the applied potential in $\\mathrm{V}$.\n- In the small-overpotential CV regime near a reference stoichiometry $x_{\\mathrm{ref}}$ (assumed constant over the small voltage window), we may treat $j_{0}$ as the exchange current density at that reference condition, denoted $j_{0,\\mathrm{ref}}$, with units $\\mathrm{A}/\\mathrm{m}^2$.\n\nYour goal is to recover $j_{0,\\mathrm{ref}}$ from given potential-current data produced under these assumptions. The small-voltage window ensures that solid stoichiometry remains approximately constant and that mass-transport limitations are negligible.\n\nUse the following open-circuit potential model:\n$$\nU(x) = U_{0} + A \\ln\\left(\\frac{x}{1-x}\\right),\n$$\nwhere $U_{0}$ is a constant in $\\mathrm{V}$, and $A$ is a constant in $\\mathrm{V}$. The reference stoichiometry is $x_{\\mathrm{ref}}$, so $E_{\\mathrm{eq}} = U(x_{\\mathrm{ref}})$.\n\nFor each test case, you are provided with the parameters necessary to synthesize the CV data over a discrete set of potentials $\\{E_{i}\\}$, and the CV current density is generated deterministically by\n$$\ni_{\\mathrm{meas}}(E_i) = 2 j_{0,\\mathrm{ref}} \\sinh\\left(\\frac{\\alpha F (E_i - E_{\\mathrm{eq}})}{R T}\\right) + C_{\\mathrm{dl}} \\, v,\n$$\nfor the forward scan with $\\mathrm{d}E/\\mathrm{d}t = +v$. Your task is to write a program that, given the test cases below, reconstructs $j_{0,\\mathrm{ref}}$ by fitting the faradaic component after subtracting the capacitive contribution. You must express the final calibrated $j_{0,\\mathrm{ref}}$ in $\\mathrm{A}/\\mathrm{m}^2$ for each test case, and produce the outputs as floats.\n\nConstants to use in all test cases:\n- $F = 96485.33212$ $\\mathrm{C}/\\mathrm{mol}$,\n- $R = 8.314462618$ $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$,\n- $\\alpha = 0.5$.\n\nTest suite:\n- Case 1 (happy path):\n  - $T = 298$ $\\mathrm{K}$,\n  - $v = 5\\times 10^{-3}$ $\\mathrm{V}/\\mathrm{s}$,\n  - $C_{\\mathrm{dl}} = 0.2$ $\\mathrm{F}/\\mathrm{m}^2$,\n  - $U_{0} = 3.6$ $\\mathrm{V}$,\n  - $A = 0.01$ $\\mathrm{V}$,\n  - $x_{\\mathrm{ref}} = 0.5$,\n  - $E_{\\mathrm{eq}} = U(x_{\\mathrm{ref}})$,\n  - $j_{0,\\mathrm{ref}} = 2.0$ $\\mathrm{A}/\\mathrm{m}^2$,\n  - Potential samples: $E_{i} = E_{\\mathrm{eq}} + k \\Delta E$ for $k \\in \\{-3,-2,-1,0,1,2,3\\}$ with $\\Delta E = 10^{-3}$ $\\mathrm{V}$.\n- Case 2 (capacitive-dominant edge case):\n  - $T = 298$ $\\mathrm{K}$,\n  - $v = 5\\times 10^{-2}$ $\\mathrm{V}/\\mathrm{s}$,\n  - $C_{\\mathrm{dl}} = 0.8$ $\\mathrm{F}/\\mathrm{m}^2$,\n  - $U_{0} = 3.7$ $\\mathrm{V}$,\n  - $A = 0.02$ $\\mathrm{V}$,\n  - $x_{\\mathrm{ref}} = 0.5$,\n  - $E_{\\mathrm{eq}} = U(x_{\\mathrm{ref}})$,\n  - $j_{0,\\mathrm{ref}} = 2.0$ $\\mathrm{A}/\\mathrm{m}^2$,\n  - Potential samples: $E_{i} = E_{\\mathrm{eq}} + k \\Delta E$ for $k \\in \\{-3,-2,-1,0,1,2,3\\}$ with $\\Delta E = 10^{-3}$ $\\mathrm{V}$.\n- Case 3 (small-signal window boundary case):\n  - $T = 310$ $\\mathrm{K}$,\n  - $v = 2\\times 10^{-3}$ $\\mathrm{V}/\\mathrm{s}$,\n  - $C_{\\mathrm{dl}} = 0.2$ $\\mathrm{F}/\\mathrm{m}^2$,\n  - $U_{0} = 3.8$ $\\mathrm{V}$,\n  - $A = 0.02$ $\\mathrm{V}$,\n  - $x_{\\mathrm{ref}} = 0.6$,\n  - $E_{\\mathrm{eq}} = U(x_{\\mathrm{ref}})$,\n  - $j_{0,\\mathrm{ref}} = 0.5$ $\\mathrm{A}/\\mathrm{m}^2$,\n  - Potential samples: $E_{i} = E_{\\mathrm{eq}} + k \\Delta E$ for $k \\in \\{-1,0,1\\}$ with $\\Delta E = 10^{-3}$ $\\mathrm{V}$.\n\nProgram requirements:\n- For each test case, compute $E_{\\mathrm{eq}} = U(x_{\\mathrm{ref}})$.\n- Construct the list of potentials $\\{E_{i}\\}$ as specified. Synthesize the measured current density values $\\{i_{\\mathrm{meas}}(E_{i})\\}$ using the equation above and the provided parameters. These represent deterministic CV measurements in the small-overpotential region for the forward scan.\n- Subtract the capacitive offset $C_{\\mathrm{dl}} v$ to isolate the faradaic current density $j_{n}$.\n- Fit $j_{n}(\\eta)$, with $\\eta = E_{i} - E_{\\mathrm{eq}}$, to the Butler-Volmer form $2 j_{0} \\sinh\\left(\\frac{\\alpha F \\eta}{R T}\\right)$ to calibrate $j_{0,\\mathrm{ref}}$ for each test case. Use a principled initial guess based on the small-signal slope near $\\eta = 0$.\n- Express the final calibrated $j_{0,\\mathrm{ref}}$ in $\\mathrm{A}/\\mathrm{m}^2$ as floats.\n\nFinal output format:\nYour program should produce a single line of output containing the calibrated exchange current densities for all three test cases as a comma-separated list enclosed in square brackets, in the order Case 1, Case 2, Case 3, for example: \"[j0_case1,j0_case2,j0_case3]\". Each entry must be in $\\mathrm{A}/\\mathrm{m}^2$.",
            "solution": "The problem requires the calibration of the exchange current density, $j_{0,\\mathrm{ref}}$, a key parameter in the Doyle-Fuller-Newman (DFN) model for lithium-ion cells, using synthetic cyclic voltammetry (CV) data. The process involves three main steps: synthesizing the measurement data based on the provided physical model, isolating the faradaic current component, and fitting this component to the Butler-Volmer equation to extract $j_{0,\\mathrm{ref}}$.\n\nFirst, we establish the physical framework. The total measured current density, $i(t)$, in a CV experiment is the sum of two contributions: the faradaic current from the electrochemical reaction at the electrode-electrolyte interface, $j_{n}(t)$, and the non-faradaic current from charging/discharging the electrical double layer, $i_{\\mathrm{cap}}(t)$. This is expressed as:\n$$\ni(t) = j_{n}(t) + i_{\\mathrm{cap}}(t)\n$$\nThe faradaic component, $j_n$, is described by the Butler-Volmer equation. For symmetric charge-transfer coefficients, $\\alpha = 1-\\alpha = 0.5$, this equation simplifies to:\n$$\nj_{n}(\\eta) = 2 j_{0} \\sinh\\left(\\frac{\\alpha F \\eta}{R T}\\right)\n$$\nHere, $\\eta = E - E_{\\mathrm{eq}}$ is the surface overpotential, $j_{0}$ is the exchange current density, $F$ is the Faraday constant ($96485.33212 \\text{ C/mol}$), $R$ is the universal gas constant ($8.314462618 \\text{ J/(mol}\\cdot\\text{K)}$), and $T$ is the temperature. The problem assumes a small potential window, so $j_{0}$ can be treated as a constant, $j_{0,\\mathrm{ref}}$.\n\nThe capacitive current, $i_{\\mathrm{cap}}$, is proportional to the rate of change of the potential, $\\mathrm{d}E/\\mathrm{d}t$, and the double-layer capacitance, $C_{\\mathrm{dl}}$:\n$$\ni_{\\mathrm{cap}}(t) = C_{\\mathrm{dl}} \\frac{\\mathrm{d}E}{\\mathrm{d}t}\n$$\nIn a CV experiment with a linear scan rate $v$, we have $\\mathrm{d}E/\\mathrm{d}t = v$ for the forward scan. Thus, the equation for the measured current at a given potential $E_i$ becomes:\n$$\ni_{\\mathrm{meas}}(E_i) = 2 j_{0,\\mathrm{ref}} \\sinh\\left(\\frac{\\alpha F (E_i - E_{\\mathrm{eq}})}{R T}\\right) + C_{\\mathrm{dl}} v\n$$\nThe equilibrium potential, $E_{\\mathrm{eq}}$, is determined by the reference stoichiometry, $x_{\\mathrm{ref}}$, through the given open-circuit potential model:\n$$\nE_{\\mathrm{eq}} = U(x_{\\mathrm{ref}}) = U_{0} + A \\ln\\left(\\frac{x_{\\mathrm{ref}}}{1-x_{\\mathrm{ref}}}\\right)\n$$\n\nThe overall algorithm for each test case is as follows:\n\n1.  **Data Synthesis**:\n    a.  Calculate the equilibrium potential, $E_{\\mathrm{eq}}$, using the provided case-specific parameters $U_0$, $A$, and $x_{\\mathrm{ref}}$.\n    b.  Construct the array of potential samples $\\{E_i\\}$ and the corresponding overpotentials $\\eta_i = E_i - E_{\\mathrm{eq}}$.\n    c.  Synthesize the measured current density values, $\\{i_{\\mathrm{meas}}(E_i)\\}$, using the given equation, the true value of $j_{0,\\mathrm{ref}}$, and the other parameters ($T$, $v$, $C_{\\mathrm{dl}}$).\n\n2.  **Data Processing**:\n    a.  Calculate the constant capacitive current offset, $i_{\\mathrm{cap}} = C_{\\mathrm{dl}} v$.\n    b.  Subtract this offset from the synthesized measured current data to isolate the faradaic component for each potential point: $j_{n,i} = i_{\\mathrm{meas}}(E_i) - i_{\\mathrm{cap}}$. As the data is generated deterministically, this step perfectly recovers the true faradaic current.\n\n3.  **Parameter Fitting**:\n    a.  The task is to find the value of $j_0$ that best fits the relationship $j_{n,i} = 2 j_0 \\sinh\\left(\\frac{\\alpha F \\eta_i}{R T}\\right)$. This is a non-linear least-squares problem. We employ the `scipy.optimize.curve_fit` function for this purpose.\n    b.  An essential part of robust fitting is providing a good initial guess for the parameter. The problem statement specifies using the small-signal slope. For small overpotentials ($|\\eta| \\ll RT/(\\alpha F)$), the Butler-Volmer equation can be linearized, as $\\sinh(z) \\approx z$ for small $z$.\n    $$\n    j_n(\\eta) \\approx 2 j_0 \\left(\\frac{\\alpha F \\eta}{R T}\\right)\n    $$\n    This shows a linear relationship between $j_n$ and $\\eta$ near equilibrium. The slope, or charge-transfer resistance inverse, is $\\frac{\\mathrm{d}j_n}{\\mathrm{d}\\eta}|_{\\eta=0} = \\frac{2 j_0 \\alpha F}{R T}$. We can rearrange this to estimate $j_0$:\n    $$\n    j_{0, \\text{guess}} = \\left(\\frac{\\mathrm{d}j_n}{\\mathrm{d}\\eta}\\right)_{\\eta=0} \\frac{R T}{2 \\alpha F}\n    $$\n    The slope is estimated from the data points closest to $\\eta=0$ using a finite difference, for example, using the points at $\\eta = \\pm \\Delta E$: $\\frac{j_n(\\Delta E) - j_n(-\\Delta E)}{2 \\Delta E}$.\n    c.  With the `x` data as the array of overpotentials $\\{\\eta_i\\}$, `y` data as the isolated faradaic currents $\\{j_{n,i}\\}$, the model function, and the initial guess, `curve_fit` is called to find the optimal value of $j_{0,\\mathrm{ref}}$.\n\nThis procedure is applied to each of the three test cases, and the resulting calibrated $j_{0,\\mathrm{ref}}$ values are collected. Since the input data is synthetically generated from the same model used for fitting and contains no noise, the fitting process is expected to recover the original $j_{0,\\mathrm{ref}}$ values with high precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves the problem of calibrating the exchange current density (j0_ref)\n    from synthetic cyclic voltammetry (CV) data for three test cases.\n    \"\"\"\n    \n    # Global constants\n    F = 96485.33212  # Faraday constant in C/mol\n    R = 8.314462618   # Universal gas constant in J/(mol*K)\n    ALPHA = 0.5   # Charge-transfer coefficient\n\n    # Test suite defined as a list of dictionaries\n    test_cases = [\n        {\n            \"T\": 298.0,\n            \"v\": 5e-3,\n            \"C_dl\": 0.2,\n            \"U0\": 3.6,\n            \"A\": 0.01,\n            \"x_ref\": 0.5,\n            \"j0_ref_true\": 2.0,\n            \"k_range\": range(-3, 4),\n            \"delta_E\": 1e-3,\n        },\n        {\n            \"T\": 298.0,\n            \"v\": 5e-2,\n            \"C_dl\": 0.8,\n            \"U0\": 3.7,\n            \"A\": 0.02,\n            \"x_ref\": 0.5,\n            \"j0_ref_true\": 2.0,\n            \"k_range\": range(-3, 4),\n            \"delta_E\": 1e-3,\n        },\n        {\n            \"T\": 310.0,\n            \"v\": 2e-3,\n            \"C_dl\": 0.2,\n            \"U0\": 3.8,\n            \"A\": 0.02,\n            \"x_ref\": 0.6,\n            \"j0_ref_true\": 0.5,\n            \"k_range\": range(-1, 2),\n            \"delta_E\": 1e-3,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Unpack parameters for the current case\n        T = case[\"T\"]\n        v = case[\"v\"]\n        C_dl = case[\"C_dl\"]\n        U0 = case[\"U0\"]\n        A = case[\"A\"]\n        x_ref = case[\"x_ref\"]\n        j0_ref_true = case[\"j0_ref_true\"]\n        k_range = case[\"k_range\"]\n        delta_E = case[\"delta_E\"]\n\n        # 1. Data Synthesis\n        # Calculate equilibrium potential E_eq\n        # Note: np.log can handle x_ref=0.5 where arg is 1, but for x_ref near 0 or 1,\n        # we check for domain validity, though not required by the test cases.\n        if x_ref > 0 and x_ref  1:\n            E_eq = U0 + A * np.log(x_ref / (1.0 - x_ref))\n        else: # Handles the x_ref = 0.5 case more efficiently\n            E_eq = U0\n\n        # Generate potential and overpotential arrays\n        k_values = np.array(list(k_range))\n        eta_values = k_values * delta_E\n        E_values = E_eq + eta_values\n\n        # Synthesize measured current density i_meas\n        exponent_arg = (ALPHA * F * eta_values) / (R * T)\n        j_n_true = 2.0 * j0_ref_true * np.sinh(exponent_arg)\n        i_cap = C_dl * v\n        i_meas = j_n_true + i_cap\n\n        # 2. Data Processing\n        # Isolate the faradaic current component for fitting\n        j_n_for_fitting = i_meas - i_cap\n\n        # 3. Parameter Fitting\n        # Define the model function for curve_fit. It captures T from the outer scope.\n        def butler_volmer_model(eta, j0):\n            return 2.0 * j0 * np.sinh((ALPHA * F * eta) / (R * T))\n\n        # Calculate a principled initial guess for j0\n        # Find indices for eta = +/- delta_E for slope calculation\n        eta_plus_idx = np.where(np.isclose(eta_values, delta_E))[0]\n        eta_minus_idx = np.where(np.isclose(eta_values, -delta_E))[0]\n\n        # Use linearization for small eta to estimate j0\n        if len(eta_plus_idx) > 0 and len(eta_minus_idx) > 0:\n            jn_plus = j_n_for_fitting[eta_plus_idx[0]]\n            jn_minus = j_n_for_fitting[eta_minus_idx[0]]\n            slope_at_zero = (jn_plus - jn_minus) / (2 * delta_E)\n            j0_guess = slope_at_zero * (R * T) / (2 * ALPHA * F)\n        else:\n            # Fallback guess if points are not available (not the case here)\n            j0_guess = 1.0\n        \n        # Perform non-linear least squares fitting\n        # We only fit j0, which is the first parameter.\n        popt, _ = curve_fit(\n            butler_volmer_model, \n            eta_values, \n            j_n_for_fitting, \n            p0=[j0_guess]\n        )\n        \n        calibrated_j0 = popt[0]\n        results.append(calibrated_j0)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}