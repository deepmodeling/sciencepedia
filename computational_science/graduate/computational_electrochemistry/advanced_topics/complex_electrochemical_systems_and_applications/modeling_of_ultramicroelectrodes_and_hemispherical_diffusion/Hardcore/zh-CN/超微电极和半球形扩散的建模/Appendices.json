{
    "hands_on_practices": [
        {
            "introduction": "我们的建模之旅始于一个基础案例：到球形超微电极的稳态扩散。该练习  将指导您构建一个简单而强大的一维有限差分模型。关键学习目标是理解有限计算域的选择（这是数值模拟中必要的折衷）如何影响解的准确性，并量化这种误差相对于理想无限域情况的大小。",
            "id": "4252988",
            "problem": "考虑在围绕一个完全吸收性超微电极（UME）的电解质中，单一电活性物质的球对称稳态扩散。该物质的体相浓度为 $c_{\\infty}$，扩散系数为 $D$。UME被建模为一个半径为 $a$、嵌入在无限介质中的球体。浓度场 $c(r)$ 仅依赖于径向坐标 $r$，并满足质量守恒和菲克定律。在球坐标系中，对于稳态和常数 $D$，其控制方程源于通过同心球壳的通量守恒。位于 $r=a$ 处的电极表面是吸收性的，远场浓度趋近于体相浓度。在计算中，远场条件施加在有限的外边界 $r=r_{max}$ 上，必须选择 $r_{max}\\gg a$ 以近似 $r\\to\\infty$。\n\n您的任务是，对区间 $r\\in[a,r_{max}]$ 上的稳态球对称扩散方程，使用以下狄利克雷边界条件：$c(a)=0$（吸收性电极）和 $c(r_{max})=c_{\\infty}$（远场），实现一种保守有限差分格式。使用一个包含边界在内共 $N$ 个节点的均匀径向网格。求解得到的线性系统以获得 $c(r)$，并计算电极表面的摩尔通量密度大小 $J=\\left|-D\\,\\frac{dc}{dr}\\big|_{r=a}\\right|$，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$。$\\frac{dc}{dr}\\big|_{r=a}$ 的有限差分近似应使用位于 $r=a$ 和 $r=a+\\Delta r$ 的前两个节点。\n\n然后，对于每个测试用例，计算相对于无限域稳态通量大小的相对误差，定义为 $\\varepsilon=\\frac{J-J_{\\infty}}{J_{\\infty}}$，其中 $J_{\\infty}$ 是 $r\\to\\infty$ 时的精确稳态通量大小。程序除了球对称性外，不能假定任何其他特殊对称性，并且必须将狄利克雷边界条件实现为显式节点值。最后，通过报告测试组中不同 $r_{max}/a$ 值下 $\\varepsilon$ 的行为，从数值上证明 $r_{max}\\gg a$ 这一要求是合理的。\n\n使用以下科学上真实的参数集（测试组），其中所有长度单位为米，扩散系数单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$，浓度单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$：\n- 测试用例 1：$a=1.0\\times 10^{-6}$，$D=1.0\\times 10^{-9}$，$c_{\\infty}=1.0\\times 10^{-3}$，$r_{max}=1.1\\times 10^{-6}$，$N=1001$。\n- 测试用例 2：$a=1.0\\times 10^{-6}$，$D=1.0\\times 10^{-9}$，$c_{\\infty}=1.0\\times 10^{-3}$，$r_{max}=5.0\\times 10^{-6}$，$N=401$。\n- 测试用例 3：$a=1.0\\times 10^{-6}$，$D=1.0\\times 10^{-9}$，$c_{\\infty}=1.0\\times 10^{-3}$，$r_{max}=20.0\\times 10^{-6}$，$N=1901$。\n- 测试用例 4：$a=1.0\\times 10^{-6}$，$D=1.0\\times 10^{-9}$，$c_{\\infty}=1.0\\times 10^{-3}$，$r_{max}=100.0\\times 10^{-6}$，$N=9901$。\n\n您的程序必须：\n- 在均匀网格上离散稳态球对称扩散方程的守恒形式，并求解生成的三对角线性系统以获得内部节点的值，同时遵守 $r=a$ 和 $r=r_{max}$ 处的狄利克雷节点。\n- 使用基于边界节点及其相邻节点的有限差分近似，计算 $r=a$ 处的摩尔通量密度大小 $J$。\n- 计算相对于精确无限域通量大小 $J_{\\infty}$ 的相对误差 $\\varepsilon$。\n- 生成一行输出，包含对应于四个测试用例的四个相对误差 $\\varepsilon$ 的列表，格式为方括号内以逗号分隔的列表（例如，$[x_1,x_2,x_3,x_4]$）。每个条目必须是浮点数。相对误差是无量纲的，应以小数形式报告，而不是百分比。\n\n以指定的单位表示所有中间和最终的物理量。此问题不涉及角度。",
            "solution": "该问题要求对球形超微电极（UME）周围单一电活性物质的稳态扩散方程进行数值求解，并计算电极表面通量的相对误差。\n\n**1. 控制方程与解析解**\n\n该物理过程由菲克扩散定律控制。在稳态和球对称条件下，浓度 $c$ 仅是径向坐标 $r$ 的函数，即 $c(r)$。问题陈述，控制方程由通过同心球壳的通量守恒导出。\n\n径向的摩尔通量密度 $J_r$ 由菲克第一定律给出：\n$$ J_r(r) = -D \\frac{dc}{dr} $$\n其中 $D$ 是扩散系数。\n\n通过半径为 $r$、表面积为 $A(r) = 4\\pi r^2$ 的球壳的总摩尔流率 $\\dot{N}$ 为 $\\dot{N} = A(r) J_r(r)$。在稳态下，质量守恒要求该流率对所有 $r$ 均为常数：\n$$ \\dot{N} = (4\\pi r^2) \\left(-D \\frac{dc}{dr}\\right) = \\text{常数} $$\n假设 $D$ 是常数，我们可以将其简化为：\n$$ r^2 \\frac{dc}{dr} = K_1 $$\n其中 $K_1$ 是一个积分常数。这是一阶常微分方程 (ODE)，用于求解 $c(r)$。第二次积分得到通解：\n$$ c(r) = -\\frac{K_1}{r} + K_2 $$\n其中 $K_2$ 是第二个积分常数。这等效于求解球坐标系中的稳态扩散方程 $D\\nabla^2 c = 0$，对于 $c(r)$，该方程简化为 $\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0$。\n\n为求得无限域的精确通量大小 $J_{\\infty}$，我们应用 $r_{max} \\to \\infty$ 的边界条件：\n1. 在电极表面（$r=a$）：$c(a) = 0$。\n2. 在远场（$r \\to \\infty$）：$c(r) \\to c_{\\infty}$。\n\n将这些条件应用于通解：\n1. $c(a) = 0 \\implies 0 = -\\frac{K_1}{a} + K_2 \\implies K_2 = \\frac{K_1}{a}$。\n2. $c(\\infty) = c_{\\infty} \\implies c_{\\infty} = -0 + K_2 \\implies K_2 = c_{\\infty}$。\n\n综合这些，我们得到 $K_2 = c_{\\infty}$ 和 $K_1 = a c_{\\infty}$。无限域的解析浓度分布为：\n$$ c(r) = c_{\\infty} \\left( 1 - \\frac{a}{r} \\right) $$\n那么，电极表面的理论通量大小 $J_{\\infty}$ 为：\n$$ J_{\\infty} = \\left| -D \\frac{dc}{dr}\\bigg|_{r=a} \\right| = \\left| -D \\left( c_{\\infty} \\frac{a}{r^2} \\right)\\bigg|_{r=a} \\right| = \\left| -D \\frac{c_{\\infty} a}{a^2} \\right| = D \\frac{c_{\\infty}}{a} $$\n$J_{\\infty}$ 的这个表达式将用作计算相对误差的参考值。\n\n**2. 数值离散**\n\n问题指定了在有限域 $r \\in [a, r_{max}]$ 上使用均匀网格进行保守有限差分格式离散。该域由 $N$ 个节点划分为 $N-1$ 个区间。网格间距为 $\\Delta r = (r_{max} - a) / (N-1)$。节点位置为 $r_i = a + i\\Delta r$，其中 $i=0, 1, \\dots, N-1$。每个节点处的浓度表示为 $c_i = c(r_i)$。边界条件为 $c_0 = c(a) = 0$ 和 $c_{N-1} = c(r_{max}) = c_{\\infty}$。\n\n我们对守恒形式的控制方程 $\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0$ 进行离散。我们将此方程对每个内部节点 $i$ (其中 $i=1, \\dots, N-2)$ 的控制体进行积分。节点 $r_i$ 的控制体从 $r_{i-1/2} = r_i - \\Delta r/2$ 延伸到 $r_{i+1/2} = r_i + \\Delta r/2$。\n$$ \\int_{r_{i-1/2}}^{r_{i+1/2}} \\frac{d}{dr} \\left(r^2 \\frac{dc}{dr}\\right) dr = 0 $$\n$$ \\left[ r^2 \\frac{dc}{dr} \\right]_{r_{i-1/2}}^{r_{i+1/2}} = 0 $$\n这得出了一个守恒声明，即在 $r_{i-1/2}$ 处进入控制体的通量等于在 $r_{i+1/2}$ 处离开的通量。我们使用中心差分来近似单元面上的导数：\n$$ r_{i+1/2}^2 \\left(\\frac{c_{i+1} - c_i}{\\Delta r}\\right) - r_{i-1/2}^2 \\left(\\frac{c_i - c_{i-1}}{\\Delta r}\\right) = 0 $$\n乘以 $\\Delta r$ 并重新排列各项，得到一个关于未知数 $c_i$ 及其相邻节点 $c_{i-1}$ 和 $c_{i+1}$ 的方程：\n$$ (r_{i-1/2}^2) c_{i-1} - (r_{i-1/2}^2 + r_{i+1/2}^2) c_i + (r_{i+1/2}^2) c_{i+1} = 0 $$\n该方程对所有内部节点 $i=1, 2, \\dots, N-2$ 均成立。\n\n**3. 线性系统构建**\n\n关于未知内部浓度 $c_1, \\dots, c_{N-2}$ 的 $N-2$ 个线性方程组构成了一个三对角系统 $\\mathbf{M}\\mathbf{c}_{int} = \\mathbf{d}$。我们来定义节点 $i$ 处方程的系数：\n- $A_i = (r_{i-1/2})^2 = (a + (i - 1/2)\\Delta r)^2$\n- $B_i = -((r_{i-1/2})^2 + (r_{i+1/2})^2) = -((a + (i - 1/2)\\Delta r)^2 + (a + (i + 1/2)\\Delta r)^2)$\n- $C_i = (r_{i+1/2})^2 = (a + (i + 1/2)\\Delta r)^2$\n\n方程组为：\n- 对于 $i=1$：$A_1 c_0 + B_1 c_1 + C_1 c_2 = 0$。由于 $c_0=0$，方程变为 $B_1 c_1 + C_1 c_2 = 0$。\n- 对于 $1  i  N-2$：$A_i c_{i-1} + B_i c_i + C_i c_{i+1} = 0$。\n- 对于 $i=N-2$：$A_{N-2} c_{N-3} + B_{N-2} c_{N-2} + C_{N-2} c_{N-1} = 0$。由于 $c_{N-1}=c_{\\infty}$，方程变为 $A_{N-2} c_{N-3} + B_{N-2} c_{N-2} = -C_{N-2} c_{\\infty}$。\n\n得到的关于未知向量 $\\mathbf{c}_{int} = [c_1, c_2, \\dots, c_{N-2}]^T$ 的三对角系统具有：\n- 主对角线：$[B_1, B_2, \\dots, B_{N-2}]$\n- 上对角线：$[C_1, C_2, \\dots, C_{N-3}]$\n- 下对角线：$[A_2, A_3, \\dots, A_{N-2}]$\n- 右端向量 $\\mathbf{d}$：$[0, 0, \\dots, 0, -C_{N-2}c_{\\infty}]^T$。\n\n该系统可以使用三对角矩阵算法高效求解，例如 `scipy.linalg.solve_banded` 中实现的算法。\n\n**4. 通量与误差计算**\n\n一旦求解出内部浓度的线性系统，就可以计算电极表面（$r=a$）的摩尔通量密度大小。问题指定使用前两个节点 $r_0=a$ 和 $r_1=a+\\Delta r$ 来近似导数。这对应于一阶向前差分：\n$$ \\frac{dc}{dr}\\bigg|_{r=a} \\approx \\frac{c(r_1) - c(r_0)}{r_1 - r_0} = \\frac{c_1 - c_0}{\\Delta r} $$\n由于 $c_0=0$，导数为 $\\frac{c_1}{\\Delta r}$。数值通量大小 $J$ 为：\n$$ J = \\left| -D \\frac{c_1}{\\Delta r} \\right| = D\\frac{c_1}{\\Delta r} $$\n（因为 $c_1 > c_0=0$）。\n\n最后一步是计算此数值通量相对于精确无限域通量 $J_{\\infty}$ 的相对误差 $\\varepsilon$：\n$$ \\varepsilon = \\frac{J - J_{\\infty}}{J_{\\infty}} = \\frac{D\\frac{c_1}{\\Delta r} - D\\frac{c_{\\infty}}{a}}{D\\frac{c_{\\infty}}{a}} = \\frac{a c_1}{c_{\\infty} \\Delta r} - 1 $$\n实现将对每个测试用例执行这些步骤。这一系列测试用例具有递增的 $r_{max}/a$ 值，旨在通过数值方式证明，随着外边界向更远处移动，误差会减小，从而验证了对无限域进行精确建模需要满足 $r_{max} \\gg a$ 的条件。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to solve the diffusion problem for all test cases and print results.\n    \"\"\"\n    # Test cases: (a, D, c_inf, r_max, N)\n    test_cases = [\n        (1.0e-6, 1.0e-9, 1.0e-3, 1.1e-6, 1001),\n        (1.0e-6, 1.0e-9, 1.0e-3, 5.0e-6, 401),\n        (1.0e-6, 1.0e-9, 1.0e-3, 20.0e-6, 1901),\n        (1.0e-6, 1.0e-9, 1.0e-3, 100.0e-6, 9901),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, D, c_inf, r_max, N = case\n        error = calculate_relative_error(a, D, c_inf, r_max, N)\n        results.append(error)\n\n    # Format and print the final output as a single-line comma-separated list.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef calculate_relative_error(a, D, c_inf, r_max, N):\n    \"\"\"\n    Calculates the relative error of the numerical flux for a given set of parameters.\n\n    Args:\n        a (float): Electrode radius in meters.\n        D (float): Diffusion coefficient in m^2/s.\n        c_inf (float): Bulk concentration in mol/m^3.\n        r_max (float): Outer boundary radius in meters.\n        N (int): Number of nodes in the mesh.\n\n    Returns:\n        float: The dimensionless relative error epsilon.\n    \"\"\"\n    # 1. Calculate mesh properties and the exact infinite-domain flux\n    if N  2:\n        raise ValueError(\"Number of nodes N must be at least 2.\")\n    \n    dr = (r_max - a) / (N - 1)\n    J_inf = D * c_inf / a\n\n    # The number of unknown interior nodes is M = N - 2\n    M = N - 2\n    if M == 0:\n        # This case occurs if N=2. The concentration is linear.\n        # c0 = 0, c1 = c_inf. dc/dr = (c_inf - 0) / dr.\n        # J = D * c_inf / dr\n        J_numerical = D * c_inf / dr\n        error = (J_numerical - J_inf) / J_inf\n        return error\n\n    # 2. Set up the tridiagonal system for interior nodes c_1, ..., c_{N-2}\n    # We build the system for unknowns c_int = [c_1, c_2, ..., c_{N-2}]\n    # The physical node indices corresponding to these unknowns are i = 1, ..., N-2.\n    i_phys = np.arange(1, N - 1)  # Physical indices of interior nodes\n\n    # Radii at the control volume faces\n    r_imhalf = a + (i_phys - 0.5) * dr\n    r_iphalf = a + (i_phys + 0.5) * dr\n\n    # Coefficients of the tridiagonal matrix\n    # A_i c_{i-1} + B_i c_i + C_i c_{i+1} = 0\n    A_coeffs = r_imhalf**2\n    B_coeffs = -(r_imhalf**2 + r_iphalf**2)\n    C_coeffs = r_iphalf**2\n\n    # 3. Assemble the banded matrix `ab` for scipy.linalg.solve_banded\n    # The matrix `ab` has shape (l+u+1, M) = (3, M), where M = N-2\n    # Row 0: Upper diagonal (u=1)\n    # Row 1: Main diagonal\n    # Row 2: Lower diagonal (l=1)\n    ab = np.zeros((3, M))\n    ab[0, 1:] = C_coeffs[:-1]  # Upper diagonal (C_1, ..., C_{N-3})\n    ab[1, :] = B_coeffs         # Main diagonal (B_1, ..., B_{N-2})\n    ab[2, :-1] = A_coeffs[1:]    # Lower diagonal (A_2, ..., A_{N-2})\n\n    # 4. Set up the right-hand-side (RHS) vector `d`\n    # The vector d is all zeros except for the last element, which incorporates\n    # the boundary condition c_{N-1} = c_inf.\n    d = np.zeros(M)\n    d[-1] = -C_coeffs[-1] * c_inf\n\n    # 5. Solve the linear system Mx = d for x = [c_1, ..., c_{N-2}]\n    c_internal = solve_banded((1, 1), ab, d)\n\n    # 6. Calculate the numerical flux and relative error\n    # Extract c_1, which is the first element of the solution vector\n    c1 = c_internal[0]\n\n    # Calculate numerical flux J using the first two nodes (c0=0, c1)\n    # J = D * (c1 - c0) / dr = D * c1 / dr\n    J_numerical = D * c1 / dr\n\n    # Calculate the relative error\n    error = (J_numerical - J_inf) / J_inf\n    \n    return error\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "在探索了基础知识之后，我们现在进阶到一个更真实的几何形状：半球形电极，它更好地代表了绝缘表面上的超微电极。此练习  侧重于模型验证，这是计算科学中的关键一步。您将实现一个数值求解器，并将其输出的稳态电流 $i_{ss}$ 与推导出的解析解进行严格比较，以评估模型的保真度。",
            "id": "4252976",
            "problem": "您的任务是评估一个用于半球扩散的超微电极 (UME) 的数值稳态扩散模型的保真度。您的程序必须数值求解球坐标系下一个半径为 $a$ 的半球形电极的径向稳态扩散方程，计算扩散控制条件下的模拟极限电流 $i_{ss}$，并根据第一性原理推导出的解析稳态半球表达式对其进行验证。验证应使用相对误差进行量化，如果相对误差不超过指定的阈值，则声明为可接受。\n\n基本原理：从 Fick 扩散第一定律和稳态连续性方程开始。在球坐标系和径向对称条件下，氧化还原物质浓度 $c(r)$ 的稳态连续性方程简化为关于径向通量的常微分方程。边界条件为：电极表面 $c(a)=0$（扩散控制消耗），以及在足够远的外部边界 $R$ 处 $c(R)=c^*$，代表本体浓度。该反应每个分子涉及 $n$ 个电子，Faraday 常数 $F$ 是将摩尔通量转换为电流的比例常数，扩散系数 $D$ 描述了传输过程。\n\n您的程序必须实现以下内容：\n\n1. 在径向坐标 $r \\in [a,R]$ 上求解稳态边值问题：\n   - 控制方程是在无对流或电迁移的径向对称条件下的稳态扩散方程：\n     $$\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0.$$\n   - 边界条件：\n     $$c(a) = 0, \\quad c(R) = c^*.$$\n\n2. 使用 $N$ 个节点的均匀网格对区域 $[a,R]$ 进行离散化，强制施加边界条件，并使用二阶有限体积或有限差分格式求解所得到的线性系统，以获得网格节点上 $c(r)$ 的近似值。对 $\\frac{dc}{dr}\\big|_{r=a}$ 使用二阶单边近似：\n   $$\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{-3 c_0 + 4 c_1 - c_2}{2 h},$$\n   其中 $h$ 是均匀网格间距，$c_0=c(a)$，$c_1=c(a+h)$，$c_2=c(a+2h)$。如果 $N3$，则改用一阶单边近似：\n   $$\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{c_1 - c_0}{h}.$$\n\n3. 使用 Fick 第一定律在电极表面和半球表面积计算模拟的半球稳态极限电流 $i_{ss}^{\\text{sim}}$：\n   - 在 $r=a$ 处的法向摩尔通量大小：$$J = D \\left.\\frac{dc}{dr}\\right|_{r=a}。$$\n   - 半球极限电流：$$i_{ss}^{\\text{sim}} = 2 \\pi a^2 \\, n F \\, J。$$\n   以安培 (A) 为单位作答。\n\n4. 通过在相同边界条件下解析求解径向稳态方程，并使用 $r=a$ 处的相应通量和半球面积，计算解析的半球稳态极限电流 $i_{ss}^{\\text{ana}}$，然后将结果纯粹用 $n$、$F$、$D$、$c^*$ 和 $a$ 表示。以安培 (A) 为单位作答。\n\n5. 计算相对误差：\n   $$\\varepsilon = \\frac{\\left| i_{ss}^{\\text{sim}} - i_{ss}^{\\text{ana}} \\right|}{i_{ss}^{\\text{ana}}}.$$\n\n6. 根据每个测试用例的预设阈值 $\\tau$ 决定是否接受：\n   $$\\text{accept} = \\varepsilon \\le \\tau.$$\n\n物理单位：\n- $D$ 单位为 $\\mathrm{m^2/s}$，\n- $c^*$ 单位为 $\\mathrm{mol/m^3}$，\n- $a$ 和 $R$ 单位为 $\\mathrm{m}$，\n- $F$ 单位为 $\\mathrm{C/mol}$，\n- 电流单位为 $\\mathrm{A}$。\n\n角度单位不适用。\n\n测试套件：\n您的程序必须评估以下参数集，每个案例指定为 $(n, F, D, c^*, a, R, N, \\tau)$：\n\n- 案例 1 (正常路径，细网格):\n  - $n=1$, $F=96485$, $D=1.0 \\times 10^{-9}$, $c^*=1.0$, $a=5.0 \\times 10^{-6}$, $R=2.0 \\times 10^{-3}$, $N=1000$, $\\tau=5.0 \\times 10^{-3}$。\n\n- 案例 2 (边界条件为非常小的 $a$ 和大的 $R$):\n  - $n=1$, $F=96485$, $D=2.2 \\times 10^{-9}$, $c^*=0.35$, $a=1.0 \\times 10^{-7}$, $R=1.0 \\times 10^{-2}$, $N=2000$, $\\tau=1.0 \\times 10^{-2}$。\n\n- 案例 3 (预期精度较低的粗网格边缘案例):\n  - $n=1$, $F=96485$, $D=1.5 \\times 10^{-9}$, $c^*=0.8$, $a=1.0 \\times 10^{-5}$, $R=5.0 \\times 10^{-4}$, $N=12$, $\\tau=2.0 \\times 10^{-2}$。\n\n- 案例 4 (多电子转移，中等网格):\n  - $n=2$, $F=96485$, $D=0.9 \\times 10^{-9}$, $c^*=0.5$, $a=2.0 \\times 10^{-6}$, $R=1.0 \\times 10^{-3}$, $N=50$, $\\tau=3.0 \\times 10^{-2}$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含四个测试用例的接受决策，格式为方括号括起来的逗号分隔列表（例如，“[True,False,True,True]”）。每个元素必须是一个布尔值，指示该测试用例的模拟电流是否满足接受标准。",
            "solution": "该问题要求将半球形超微电极稳态扩散的数值模型与其解析对应物进行验证。这是计算科学中评估模型保真度的标准程序。该过程涉及推导解析解、构建并求解数值等效模型，然后比较结果。\n\n### 1. 解析解\n\n该模型的基础是本体溶液中没有生成或消耗时的稳态连续性方程。对于具有球对称性的系统，这通过 Fick 扩散第一定律表示，从而得到浓度 $c$ 作为径向距离 $r$ 的函数的控制性常微分方程：\n$$\n\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0\n$$\n该方程需在区域 $r \\in [a, R]$ 上求解，并满足指定的边界条件：\n$$\nc(a) = 0 \\quad \\text{(电极表面的扩散控制消耗)}\n$$\n$$\nc(R) = c^* \\quad \\text{(外部边界的本体浓度)}\n$$\n将控制方程对 $r$ 积分一次，得到：\n$$\nr^2 \\frac{dc}{dr} = K_1\n$$\n其中 $K_1$ 是一个积分常数。该方程表示在稳态下，通过任何球形表面 ($4 \\pi r^2 J(r)$) 的总摩尔流率是恒定的。重新整理并进行第二次积分，得到浓度分布的通解：\n$$\n\\frac{dc}{dr} = \\frac{K_1}{r^2} \\implies \\int dc = \\int \\frac{K_1}{r^2} dr \\implies c(r) = -\\frac{K_1}{r} + K_2\n$$\n其中 $K_2$ 是第二个积分常数。这些常数通过应用边界条件来确定。\n应用 $c(a) = 0$：\n$$\n0 = -\\frac{K_1}{a} + K_2 \\implies K_2 = \\frac{K_1}{a}\n$$\n将此代入通解并应用 $c(R) = c^*$：\n$$\nc^* = -\\frac{K_1}{R} + \\frac{K_1}{a} = K_1 \\left(\\frac{1}{a} - \\frac{1}{R}\\right) = K_1 \\left(\\frac{R-a}{aR}\\right)\n$$\n解出 $K_1$：\n$$\nK_1 = c^* \\frac{aR}{R-a}\n$$\n根据 Fick 扩散第一定律，$J = -D \\frac{dc}{dr}\\big|_{r=a}$，电极表面 ($r=a$) 的摩尔通量 $J$ 由此给出。问题将 $J$ 定义为大小，因此我们使用 $J = D \\left|\\frac{dc}{dr}\\right|_{r=a}$。在 $r=a$ 处的梯度为：\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} = \\frac{K_1}{a^2} = \\frac{1}{a^2} \\left(c^* \\frac{aR}{R-a}\\right) = \\frac{c^*R}{a(R-a)}\n$$\n由于 $Ra$，梯度为正，符合预期。通量大小为：\n$$\nJ = D \\frac{c^*R}{a(R-a)}\n$$\n总电流是通量乘以电极表面积和每摩尔反应物的电荷。对于半径为 $a$ 的半球，其面积为 $2 \\pi a^2$。因此，解析稳态极限电流 $i_{ss}^{\\text{ana}}$ 为：\n$$\ni_{ss}^{\\text{ana}} = (2 \\pi a^2) (nF) J = 2 \\pi a^2 n F D \\frac{c^*R}{a(R-a)} = 2 \\pi n F D c^* a \\frac{R}{R-a}\n$$\n该表达式将作为精确解，用于与数值近似解进行比较。\n\n### 2. 数值解\n\n数值解通过使用有限体积法对控制方程进行离散化得到，该方法能确保扩散物质的守恒。\n\n**离散化：** 径向域 $[a, R]$ 被 $N$ 个节点 $r_0, r_1, \\dots, r_{N-1}$ 分为 $N-1$ 个控制体积。节点均匀分布，网格间距为 $h = (R-a)/(N-1)$，因此 $r_i = a + i h$。节点 $r_i$ 处的浓度表示为 $c_i$。\n\n**有限体积公式：** 我们将控制方程在一个以内节点 $r_i$ 为中心的控制体积上积分，范围从 $r_{i-1/2} = r_i - h/2$ 到 $r_{i+1/2} = r_i + h/2$：\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} \\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) dr = \\left[r^2 \\frac{dc}{dr}\\right]_{r_{i-1/2}}^{r_{i+1/2}} = 0\n$$\n这简化为：\n$$\nr_{i+1/2}^2 \\left.\\frac{dc}{dr}\\right|_{r_{i+1/2}} - r_{i-1/2}^2 \\left.\\frac{dc}{dr}\\right|_{r_{i-1/2}} = 0\n$$\n控制体积面上的梯度使用二阶中心差分格式进行近似：\n$$\n\\left.\\frac{dc}{dr}\\right|_{r_{i+1/2}} \\approx \\frac{c_{i+1}-c_i}{h}, \\quad \\left.\\frac{dc}{dr}\\right|_{r_{i-1/2}} \\approx \\frac{c_i-c_{i-1}}{h}\n$$\n代入这些近似值，得到每个内部节点 $i \\in \\{1, 2, \\dots, N-2\\}$ 的离散方程：\n$$\nr_{i+1/2}^2 \\left(\\frac{c_{i+1}-c_i}{h}\\right) - r_{i-1/2}^2 \\left(\\frac{c_i-c_{i-1}}{h}\\right) = 0\n$$\n乘以 $h$ 并按浓度重新组合各项，得到一个关于 $c_{i-1}, c_i, c_{i+1}$ 的线性方程：\n$$\nr_{i-1/2}^2 c_{i-1} - (r_{i-1/2}^2 + r_{i+1/2}^2) c_i + r_{i+1/2}^2 c_{i+1} = 0\n$$\n这为 $N-2$ 个未知的内部浓度 $\\{c_1, \\dots, c_{N-2}\\}$ 提供了 $N-2$ 个线性方程组。边界浓度是已知的：$c_0 = c(a) = 0$ 和 $c_{N-1} = c(R) = c^*$。这些边界值被并入第一个 ($i=1$) 和最后一个 ($i=N-2$) 内部节点的方程中：\n对于 $i=1$:\n$$\nr_{1/2}^2 c_{0} - (r_{1/2}^2 + r_{3/2}^2) c_1 + r_{3/2}^2 c_{2} = 0 \\implies -(r_{1/2}^2 + r_{3/2}^2) c_1 + r_{3/2}^2 c_{2} = 0\n$$\n对于 $i=N-2$:\n$$\nr_{N-5/2}^2 c_{N-3} - (r_{N-2.5}^2 + r_{N-1.5}^2) c_{N-2} + r_{N-1.5}^2 c_{N-1} = 0 \\implies r_{N-2.5}^2 c_{N-3} - (r_{N-2.5}^2 + r_{N-1.5}^2) c_{N-2} = -r_{N-1.5}^2 c^*\n$$\n这形成了一个三对角线性方程组 $A\\mathbf{c'} = \\mathbf{b}$，可以求解得到内部节点浓度向量 $\\mathbf{c'} = [c_1, \\dots, c_{N-2}]^T$。\n\n### 3. 电流计算与验证\n\n获得数值浓度分布 $\\{c_i\\}_{i=0}^{N-1}$ 后，计算模拟电流 $i_{ss}^{\\text{sim}}$。这需要计算电极表面 $r_0=a$ 处的浓度梯度。\n问题指定当 $N \\ge 3$ 时使用二阶单边有限差分公式：\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{-3 c_0 + 4 c_1 - c_2}{2 h}\n$$\n当 $N  3$ 时，应使用一阶公式：\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{c_1 - c_0}{h}\n$$\n模拟通量大小为 $J^{\\text{sim}} = D \\left.\\frac{dc}{dr}\\right|_{r=a}$。模拟电流则为：\n$$\ni_{ss}^{\\text{sim}} = 2 \\pi a^2 n F J^{\\text{sim}}\n$$\n最后，通过计算与解析解的相对误差 $\\varepsilon$ 来验证数值结果：\n$$\n\\varepsilon = \\frac{\\left| i_{ss}^{\\text{sim}} - i_{ss}^{\\text{ana}} \\right|}{i_{ss}^{\\text{ana}}}\n$$\n将此误差与指定的容差 $\\tau$ 进行比较。如果 $\\varepsilon \\le \\tau$，则认为该模拟是可接受的。对每个测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import linalg is not strictly needed as numpy.linalg.solve works fine.\n\ndef solve():\n    \"\"\"\n    Solves the steady-state diffusion problem for a hemispherical UME\n    and validates the numerical solution against the analytical one for several test cases.\n    \"\"\"\n    \n    # Define test cases as tuples: (n, F, D, c_star, a, R, N, tau)\n    test_cases = [\n        # Case 1 (happy path, fine grid)\n        (1, 96485, 1.0e-9, 1.0, 5.0e-6, 2.0e-3, 1000, 5.0e-3),\n        # Case 2 (boundary condition with very small 'a' and large 'R')\n        (1, 96485, 2.2e-9, 0.35, 1.0e-7, 1.0e-2, 2000, 1.0e-2),\n        # Case 3 (edge case with coarse grid)\n        (1, 96485, 1.5e-9, 0.8, 1.0e-5, 5.0e-4, 12, 2.0e-2),\n        # Case 4 (multi-electron transfer, moderate grid)\n        (2, 96485, 0.9e-9, 0.5, 2.0e-6, 1.0e-3, 50, 3.0e-2),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n, F, D, c_star, a, R, N, tau = case\n\n        # Ensure N is an integer\n        N = int(N)\n        \n        # --- 1. Analytical Solution ---\n        # i_ss_ana = 2 * pi * n * F * D * c_star * a * (R / (R - a))\n        i_ss_ana = 2.0 * np.pi * n * F * D * c_star * a * (R / (R - a))\n\n        # --- 2. Numerical Solution ---\n        if N  2:\n            # The problem is not well-defined for N  2.\n            # This path is not taken by the test cases but is included for robustness.\n            results.append(False) # Mark as unacceptable\n            continue\n\n        h = (R - a) / (N - 1)\n        r_nodes = np.linspace(a, R, N)\n        \n        c = np.zeros(N) # Concentration profile array\n        c[0] = 0.0      # Boundary condition at r=a\n        c[-1] = c_star  # Boundary condition at r=R\n        \n        # Solve for internal node concentrations c_1, ..., c_{N-2}\n        if N > 2:\n            # Number of internal nodes\n            num_internal_nodes = N - 2\n            \n            # Setup the tridiagonal linear system Ax = b for internal nodes\n            A = np.zeros((num_internal_nodes, num_internal_nodes))\n            b = np.zeros(num_internal_nodes)\n            \n            for i in range(1, N - 1):\n                # Matrix row index (0 to N-3)\n                k = i - 1\n                \n                # Radii of control volume faces\n                r_imhalf = r_nodes[i] - h / 2.0\n                r_iphalf = r_nodes[i] + h / 2.0\n                \n                # Coefficients from finite volume discretization.\n                # -(r_imhalf^2)c_{i-1} + (r_imhalf^2 + r_iphalf^2)c_i - (r_iphalf^2)c_{i+1} = 0\n                # The signs are flipped from explanation for a positive definite matrix\n                \n                # Diagonal element\n                A[k, k] = r_imhalf**2 + r_iphalf**2\n                \n                # Lower diagonal element\n                if i > 1:\n                    A[k, k - 1] = -r_imhalf**2\n                \n                # Upper diagonal element\n                if i  N - 2:\n                    A[k, k + 1] = -r_iphalf**2\n                \n                # Modify RHS vector for boundary conditions\n                if i == 1: # First internal node, adjacent to c_0=0\n                    b[k] = r_imhalf**2 * c[0] # This is 0 but shown for clarity\n                if i == N - 2: # Last internal node, adjacent to c_{N-1}=c_star\n                    b[k] = r_iphalf**2 * c[-1]\n\n            # Solve the linear system\n            c_internal = np.linalg.solve(A, b)\n            c[1:-1] = c_internal\n\n        # --- 3. Compute Simulated Current ---\n        # Calculate concentration gradient at r=a\n        if N >= 3:\n            # Second-order one-sided difference\n            dcdr_a = (-3.0 * c[0] + 4.0 * c[1] - c[2]) / (2.0 * h)\n        else: # N = 2\n            # First-order one-sided difference\n            dcdr_a = (c[1] - c[0]) / h\n\n        # Calculate simulated current\n        i_ss_sim = 2.0 * np.pi * a**2 * n * F * D * dcdr_a\n\n        # --- 4. Validate and Decide ---\n        # Compute relative error\n        if i_ss_ana == 0:\n             relative_error = np.inf if i_ss_sim != 0 else 0.0\n        else:\n             relative_error = np.abs(i_ss_sim - i_ss_ana) / np.abs(i_ss_ana)\n        \n        # Check if error is within the tolerance\n        is_accepted = relative_error = tau\n        results.append(is_accepted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了处理更复杂和现实的场景，我们必须超越一维近似。这最后一个练习  介绍了有限元法 (FEM)，用于构建半球形电极的二维轴对称模型。通过完成域设置、边界条件和弱形式的步骤，您将获得处理现代电化学模拟中广泛使用的通用且强大技术的实践经验。",
            "id": "4253017",
            "problem": "考虑一个二维轴对称扩散问题，该问题模拟一个位于绝缘平面上的半球形超微电极在电解质中的行为。独立的空间坐标是柱面半径 $r$ 和轴向坐标 $z$。未知场为在均匀扩散系数 $D$ 下稳态扩散的电活性物质的浓度 $c(r,z)$。控制方程是稳态下的菲克第二定律的散度形式，\n$$\n\\nabla\\cdot\\left(D\\nabla c\\right)=0,\n$$\n该方程定义于位于半空间 $z\\ge 0$、以原点为中心、半径为 $a$ 的半球外部区域。计算域被截断为矩形 $0\\le r\\le R_{\\max}$，$0\\le z\\le Z_{\\max}$，其中 $R_{\\max}$ 和 $Z_{\\max}$ 的选择应远大于 $a$。\n\n对称轴为 $r=0$ 处的 $z$ 轴。绝缘平面是 $z=0$ 的直线，半球电极所在位置除外。半球电极表面是由 $r^2+z^2=a^2$ 且 $z\\ge 0$ 定义的圆弧。\n\n边界条件如下：\n- 对称轴：在 $r=0$ 处为无通量（Neumann）条件，即 $\\partial c/\\partial r=0$。\n- 绝缘平面：在 $z=0$ 处为无通量（Neumann）条件，电极处除外。\n- 电极表面：在 $r^2+z^2=a^2$ 且 $z\\ge 0$ 处为扩散限制的 Dirichlet 条件，即 $c=0$。\n- 远场边界：在 $r=R_{\\max}$ 和 $z=Z_{\\max}$ 处为 Dirichlet 条件，即 $c=c_{\\mathrm{bulk}}$。\n\n轴对称域上的弱形式必须正确考虑围绕对称轴旋转所产生的 $2\\pi r$ 几何因子。具体而言，对于任何容许的测试函数 $v$，弱形式为\n$$\n\\int_{\\Omega} 2\\pi r\\, D\\, \\nabla c\\cdot \\nabla v\\, \\mathrm{d}\\Omega = \\int_{\\Gamma_N} 2\\pi r\\, v\\, q_N\\, \\mathrm{d}\\Gamma,\n$$\n其中 $\\Omega$ 是不包括电极的矩形计算域，$\\Gamma_N$ 表示 Neumann 边界，而 $q_N$ 是指定的法向扩散通量，在本问题中，所有 Neumann 边界上的 $q_N$ 均为零。\n\n您的任务是实现一个二维轴对称有限元方法（FEM）求解器，在矩形 $[0,R_{\\max}]\\times[0,Z_{\\max}]$ 上的结构化网格上使用双线性四边形单元。每个单元使用 $2\\times 2$ 的 Gauss 求积，并在单元刚度矩阵组装中包含轴对称权重 $2\\pi r$。通过在坐标满足 $r^2+z^2\\le a^2$ 的网格节点上施加 Dirichlet 条件 $c=0$ 来近似弯曲的电极边界，其容差等于 $r$ 和 $z$ 方向上局部网格间距最大值的一半。将对称和绝缘条件作为自然边界条件（即齐次 Neumann 条件）应用，并在外部边界 $r=R_{\\max}$ 和 $z=Z_{\\max}$ 处应用远场 Dirichlet 条件 $c=c_{\\mathrm{bulk}}$。\n\n计算出 $c(r,z)$ 后，通过对穿过远场边界的扩散通量进行积分来计算稳态极限电流 $I$，根据守恒定律，这等于稳态下流入电极的净通量。总电流为\n$$\nI = n F \\int_{\\Gamma_{\\mathrm{far}}} \\left(-D \\frac{\\partial c}{\\partial n}\\right) 2\\pi r\\, \\mathrm{d}s,\n$$\n其中 $n$ 是电荷数（化学计量电子数），$F$ 是法拉第常数，$\\Gamma_{\\mathrm{far}}$ 表示 $r=R_{\\max}$ 和 $z=Z_{\\max}$ 处边界的并集，而 $\\partial c/\\partial n$ 是向外的法向导数。沿边界段使用一致的单边有限差分来近似 $\\partial c/\\partial n$。\n\n将最终电流 $I$ 以安培（$\\mathrm{A}$）为单位表示为浮点数。\n\n实现您的程序以解决以下测试套件的问题。对于每个测试用例，设置 $R_{\\max}=\\alpha_R a$ 和 $Z_{\\max}=\\alpha_Z a$。\n\n- 测试用例 1（一般情况）：$a=5\\times 10^{-6}\\,\\mathrm{m}$，$D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$，$c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$，$n=1$，$\\alpha_R=50$，$\\alpha_Z=50$，$r$ 方向单元数 $N_r=80$，$z$ 方向单元数 $N_z=80$。\n- 测试用例 2（边界影响）：$a=5\\times 10^{-6}\\,\\mathrm{m}$，$D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$，$c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$，$n=1$，$\\alpha_R=10$，$\\alpha_Z=10$，$N_r=80$，$N_z=80$。\n- 测试用例 3（扩散系数变化）：$a=5\\times 10^{-6}\\,\\mathrm{m}$，$D=2\\times 10^{-9}\\,\\mathrm{m^2/s}$，$c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$，$n=1$，$\\alpha_R=50$，$\\alpha_Z=50$，$N_r=80$，$N_z=80$。\n- 测试用例 4（小电极）：$a=1\\times 10^{-6}\\,\\mathrm{m}$，$D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$，$c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$，$n=1$，$\\alpha_R=50$，$\\alpha_Z=50$，$N_r=80$，$N_z=80$。\n\n所有物理常数和参数必须使用其标准含义和单位；使用法拉第常数 $F=96485.33212\\,\\mathrm{C/mol}$。每个测试用例的输出必须是计算出的极限电流 $I$，以 $\\mathrm{A}$ 为单位的浮点数。\n\n您的程序应生成单行输出，其中包含以方括号括起来的逗号分隔列表形式的结果（例如，$[I_1,I_2,I_3,I_4]$），顺序与上述测试套件相同。不应打印任何其他文本。",
            "solution": "用户提供了有效的问题陈述。我将继续提供完整的解决方案。\n\n### 1. 问题公式化\n\n该问题要求对围绕半球形超微电极的电活性物质浓度的稳态二维轴对称扩散方程进行数值求解。控制方程是稳态下的菲克第二定律，对于均匀扩散系数 $D$，它简化为拉普拉斯方程：\n$$ \\nabla \\cdot (D \\nabla c) = 0 $$\n考虑到围绕 $z$ 轴的轴对称性，柱坐标 $(r, z)$ 中的拉普拉斯算子为：\n$$ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r D \\frac{\\partial c}{\\partial r}\\right) + \\frac{\\partial}{\\partial z}\\left(D \\frac{\\partial c}{\\partial z}\\right) = 0 $$\n此方程在一个截断的矩形域 $\\Omega = [0, R_{\\max}] \\times [0, Z_{\\max}]$（不包括电极区域）上求解。\n\n边界条件如下：\n1.  **电极表面（$r^2+z^2 \\le a^2, z \\ge 0$）：** 假设为扩散限制反应，施加 Dirichlet 条件 $c = 0$。\n2.  **远场边界（$r=R_{\\max}$ 或 $z=Z_{\\max}$）：** 浓度等于主体浓度，$c = c_{\\mathrm{bulk}}$。这是一个 Dirichlet 条件。\n3.  **对称轴（$r=0, z0$）：** 无通量（齐次 Neumann 条件），$\\frac{\\partial c}{\\partial r} = 0$。\n4.  **绝缘平面（$z=0, ra$）：** 无通量（齐次 Neumann 条件），$\\frac{\\partial c}{\\partial z} = 0$。\n\n### 2. 弱形式与有限元方法\n\n为了使用有限元方法（FEM）求解此偏微分方程（PDE），我们首先推导其弱形式。我们将控制方程乘以一个任意的测试函数 $v(r,z)$，并在轴对称体积元 $2\\pi r \\, \\mathrm{d}r \\, \\mathrm{d}z$ 上进行积分。\n$$ \\int_{\\Omega} v \\left[ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r D \\frac{\\partial c}{\\partial r}\\right) + \\frac{\\partial}{\\partial z}\\left(D \\frac{\\partial c}{\\partial z}\\right) \\right] 2\\pi r \\, \\mathrm{d}r \\, \\mathrm{d}z = 0 $$\n应用分部积分（格林第一恒等式），我们得到问题陈述中提供的弱形式：\n$$ \\int_{\\Omega} 2\\pi r D (\\nabla c \\cdot \\nabla v) \\, \\mathrm{d}A = \\oint_{\\partial\\Omega} v (2\\pi r D \\nabla c \\cdot \\mathbf{n}) \\, \\mathrm{d}s $$\n这里 $\\mathrm{d}A = \\mathrm{d}r \\mathrm{d}z$ 是 $r,z$ 平面中的面积元，$\\partial\\Omega$ 是域 $\\Omega$ 的边界，$\\mathbf{n}$ 是向外的法向量。右侧项表示穿过边界的通量。对于齐次 Neumann 边界（对称轴和绝缘平面），法向通量 $\\nabla c \\cdot \\mathbf{n}$ 为零。对于 Dirichlet 边界，测试函数 $v$ 被选为零，因此边界积分也消失。这导致了齐次系统：\n$$ \\int_{\\Omega} 2\\pi r D (\\nabla c \\cdot \\nabla v) \\, \\mathrm{d}A = 0 $$\n\n该域被离散化为 $N_r \\times N_z$ 个双线性四边形单元的结构化网格。在每个单元内，浓度场 $c(r,z)$ 由节点浓度 $c_k$ 和双线性形函数 $N_k(\\xi, \\eta)$ 的线性组合来近似：\n$$ c(r, z) \\approx c^h(r, z) = \\sum_{k=1}^{4} c_k N_k(\\xi, \\eta) $$\n其中 $(\\xi, \\eta)$ 是 $[-1, 1] \\times [-1, 1]$ 参考单元内的局部坐标。使用 Galerkin 方法，测试函数 $v$ 从同一组形函数中选取，即 $v = N_j$。\n\n### 3. 单元刚度矩阵\n\n将 FEM 近似代入弱形式，得到一个线性方程组 $\\mathbf{K}\\mathbf{c} = \\mathbf{F}$，其中 $\\mathbf{K}$ 是全局刚度矩阵，$\\mathbf{c}$ 是未知节点浓度的向量，$\\mathbf{F}$ 是载荷向量（将由边界条件修改）。单个单元对全局刚度矩阵的贡献是 $4 \\times 4$ 的单元刚度矩阵 $\\mathbf{K}^e$，其元素为：\n$$ K_{ij}^e = \\int_{\\Omega_e} 2\\pi r D (\\nabla N_i \\cdot \\nabla N_j) \\, \\mathrm{d}A $$\n该积分被转换到局部坐标 $(\\xi, \\eta)$，并使用 $2 \\times 2$ 的 Gauss 求积进行数值计算：\n$$ K_{ij}^e = \\int_{-1}^{1}\\int_{-1}^{1} \\left( 2\\pi r(\\xi,\\eta) D \\left[ \\frac{\\partial N_i}{\\partial r}\\frac{\\partial N_j}{\\partial r} + \\frac{\\partial N_i}{\\partial z}\\frac{\\partial N_j}{\\partial z} \\right] \\right) \\det(\\mathbf{J}) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta $$\n$$ K_{ij}^e \\approx \\sum_{p=1}^{2}\\sum_{q=1}^{2} w_p w_q \\left( 2\\pi r(\\xi_p,\\eta_q) D \\left[ \\nabla N_i \\cdot \\nabla N_j \\right]_{(\\xi_p,\\eta_q)} \\right) \\det(\\mathbf{J}) $$\n其中 $(\\xi_p, \\eta_q)$ 是 Gauss 点，$w_p=w_q=1$ 是权重，$\\mathbf{J}$ 是从 $(r, z)$ 到 $(\\xi, \\eta)$ 变换的雅可比矩阵。对于大小为 $\\Delta r \\times \\Delta z$ 的矩形单元，$\\det(\\mathbf{J}) = \\frac{\\Delta r \\Delta z}{4}$。径向坐标 $r(\\xi,\\eta) = \\sum_k r_k N_k(\\xi,\\eta)$ 必须在每个 Gauss 点上进行评估。\n\n### 4. 系统组装与求解\n\n全局刚度矩阵 $\\mathbf{K}$ 是通过对所有单元矩阵 $\\mathbf{K}^e$ 的贡献求和来组装的。所得矩阵是大型、稀疏和对称的。通过修改系统来应用 Dirichlet 边界条件。对于每个具有指定浓度 $c_k = u_k$ 的节点 $k$：\n1.  将 $\\mathbf{K}$ 的第 $k$ 行清零，并将对角线元素 $K_{kk}$ 设置为 $1$。\n2.  更新右侧向量 $\\mathbf{F}$。对于所有其他行 $j$，从 $F_j$ 中减去项 $K_{jk} u_k$。\n3.  将 $\\mathbf{F}$ 的第 $k$ 个元素设置为 $u_k$，即 $F_k = u_k$。\n\n在应用所有 Dirichlet 条件后，求解稀疏线性系统 $\\mathbf{K}\\mathbf{c}=\\mathbf{F}$，以获得节点浓度向量 $\\mathbf{c}$。\n\n### 5. 电流计算\n\n总极限电流 $I$ 是通过在远场边界 $\\Gamma_{\\mathrm{far}}$（$r=R_{\\max}$ 和 $z=Z_{\\max}$）上对扩散通量密度进行积分来计算的：\n$$ I = n F \\int_{\\Gamma_{\\mathrm{far}}} \\left(-D \\frac{\\partial c}{\\partial n}\\right) 2\\pi r\\, \\mathrm{d}s $$\n该积分是数值计算的。\n-   在顶部边界（$z=Z_{\\max}$）上，$\\frac{\\partial c}{\\partial n} = \\frac{\\partial c}{\\partial z}$。在每个节点处使用单边有限差分来近似此导数：$\\frac{\\partial c}{\\partial z} \\approx \\frac{c(r, Z_{\\max}) - c(r, Z_{\\max}-\\Delta z)}{\\Delta z}$。然后使用梯形法则对边界节点上的积分 $\\int_{0}^{R_{\\max}} (-D \\frac{\\partial c}{\\partial z}) 2\\pi r \\, \\mathrm{d}r$ 进行计算。\n-   在右侧边界（$r=R_{\\max}$）上，$\\frac{\\partial c}{\\partial n} = \\frac{\\partial c}{\\partial r}$。该导数近似为 $\\frac{\\partial c}{\\partial r} \\approx \\frac{c(R_{\\max}, z) - c(R_{\\max}-\\Delta r, z)}{\\Delta r}$。使用梯形法则计算积分 $\\int_{0}^{Z_{\\max}} (-D \\frac{\\partial c}{\\partial r}) 2\\pi R_{\\max} \\, \\mathrm{d}z$。\n\n总电流是来自顶部和右侧边界贡献的总和。最终的实现使用这些原理来求解四个指定的测试用例。\n\n注：应用电极边界条件的问题规范是“在坐标满足 $r^2+z^2\\le a^2$ 的网格节点上施加 Dirichlet 条件 $c=0$”。这个直接指令按其陈述实现，提供了半球形边界的离散阶梯状近似。相关的容差提及被解释为对这种近似性质的说明，而不是对条件的修改。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    F_CONST = 96485.33212  # Faraday constant in C/mol\n\n    test_cases = [\n        # a (m), D (m^2/s), c_bulk (mol/m^3), n, alpha_R, alpha_Z, Nr, Nz\n        (5e-6, 1e-9, 1e-3, 1, 50, 50, 80, 80),\n        (5e-6, 1e-9, 1e-3, 1, 10, 10, 80, 80),\n        (5e-6, 2e-9, 1e-3, 1, 50, 50, 80, 80),\n        (1e-6, 1e-9, 1e-3, 1, 50, 50, 80, 80),\n    ]\n\n    results = []\n    for params in test_cases:\n        current = run_fem_simulation(*params, F_CONST)\n        results.append(current)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_fem_simulation(a, D, c_bulk, n, alpha_R, alpha_Z, Nr, Nz, F_CONST):\n    \"\"\"\n    Performs a 2D axisymmetric FEM simulation for a single test case.\n    \"\"\"\n    # 1. Domain and Mesh Setup\n    R_max = alpha_R * a\n    Z_max = alpha_Z * a\n    dr = R_max / Nr\n    dz = Z_max / Nz\n    \n    r_nodes = np.linspace(0, R_max, Nr + 1)\n    z_nodes = np.linspace(0, Z_max, Nz + 1)\n    num_nodes = (Nr + 1) * (Nz + 1)\n    \n    # 2. FEM Assembly\n    K = lil_matrix((num_nodes, num_nodes), dtype=np.float64)\n    F = np.zeros(num_nodes, dtype=np.float64)\n    \n    # Pre-calculate shape functions and their derivatives at 2x2 Gauss points\n    gauss_pts = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n    N_vals = np.zeros((4, 4))\n    dN_dr_vals = np.zeros((4, 4))\n    dN_dz_vals = np.zeros((4, 4))\n    det_J = (dr * dz) / 4.0\n\n    for i_gp, xi in enumerate(gauss_pts):\n        for j_gp, eta in enumerate(gauss_pts):\n            gp_idx = 2 * i_gp + j_gp\n            \n            # Shape functions N_k(xi, eta) for k=1,2,3,4\n            N_vals[gp_idx, :] = [0.25*(1-xi)*(1-eta), 0.25*(1+xi)*(1-eta), \n                                 0.25*(1+xi)*(1+eta), 0.25*(1-xi)*(1+eta)]\n\n            # Derivatives w.r.t local coords dN_k/d(xi,eta)\n            dN_dxi = [ -0.25*(1-eta), 0.25*(1-eta), 0.25*(1+eta), -0.25*(1+eta)]\n            dN_deta = [-0.25*(1-xi), -0.25*(1+xi), 0.25*(1+xi),  0.25*(1-xi)]\n            \n            # Derivatives w.r.t global coords dN_k/d(r,z)\n            dN_dr_vals[gp_idx, :] = (2.0 / dr) * np.array(dN_dxi)\n            dN_dz_vals[gp_idx, :] = (2.0 / dz) * np.array(dN_deta)\n\n    # Loop over elements to assemble the global stiffness matrix K\n    for j in range(Nz):  # z-index\n        for i in range(Nr):  # r-index\n            node_indices = [\n                j * (Nr + 1) + i,            # Node 1 (bottom-left)\n                j * (Nr + 1) + (i + 1),        # Node 2 (bottom-right)\n                (j + 1) * (Nr + 1) + (i + 1),  # Node 3 (top-right)\n                (j + 1) * (Nr + 1) + i         # Node 4 (top-left)\n            ]\n            r_coords = [r_nodes[i], r_nodes[i+1], r_nodes[i+1], r_nodes[i]]\n            Ke = np.zeros((4, 4))\n\n            # 2x2 Gauss quadrature loop\n            for gp_idx in range(4):\n                r_gp = np.dot(N_vals[gp_idx, :], r_coords)\n                dN_dr = dN_dr_vals[gp_idx, :]\n                dN_dz = dN_dz_vals[gp_idx, :]\n                \n                grad_N_dot_grad_N = np.outer(dN_dr, dN_dr) + np.outer(dN_dz, dN_dz)\n                Ke += (2.0 * np.pi * r_gp * D * grad_N_dot_grad_N) * det_J\n            \n            # Assemble Ke into K\n            for row_idx, global_row in enumerate(node_indices):\n                for col_idx, global_col in enumerate(node_indices):\n                    K[global_row, global_col] += Ke[row_idx, col_idx]\n\n    # 3. Apply Boundary Conditions\n    dirichlet_nodes = {}\n    for j in range(Nz + 1):\n        for i in range(Nr + 1):\n            node_idx = j * (Nr + 1) + i\n            r = r_nodes[i]\n            z = z_nodes[j]\n            \n            if r**2 + z**2 = a**2:\n                dirichlet_nodes[node_idx] = 0.0\n            elif i == Nr or j == Nz:\n                dirichlet_nodes[node_idx] = c_bulk\n\n    # Modify K and F for Dirichlet BCs\n    active_rows = [i for i in range(num_nodes) if i not in dirichlet_nodes]\n    K_csc = K.tocsc()\n    for node_idx, value in dirichlet_nodes.items():\n        F[active_rows] -= K_csc[active_rows, node_idx].toarray().flatten() * value\n\n    for node_idx, value in dirichlet_nodes.items():\n        K[node_idx, :] = 0\n        K[:, node_idx] = 0\n        K[node_idx, node_idx] = 1.0\n        F[node_idx] = value\n        \n    # 4. Solve the linear system\n    c_vec = spsolve(K.tocsc(), F)\n    c_grid = c_vec.reshape((Nz + 1, Nr + 1))\n    \n    # 5. Post-processing: Calculate Current\n    I_top = 0.0\n    for i in range(Nr):\n        grad_c_i = (c_grid[Nz, i] - c_grid[Nz-1, i]) / dz\n        grad_c_i1 = (c_grid[Nz, i+1] - c_grid[Nz-1, i+1]) / dz\n        flux_i = -D * grad_c_i\n        flux_i1 = -D * grad_c_i1\n        I_top += 0.5 * (flux_i * 2*np.pi*r_nodes[i] + flux_i1 * 2*np.pi*r_nodes[i+1]) * dr\n        \n    I_right = 0.0\n    for j in range(Nz):\n        grad_c_j = (c_grid[j, Nr] - c_grid[j, Nr-1]) / dr\n        grad_c_j1 = (c_grid[j+1, Nr] - c_grid[j+1, Nr-1]) / dr\n        flux_j = -D * grad_c_j\n        flux_j1 = -D * grad_c_j1\n        I_right += 0.5 * (flux_j + flux_j1) * dz\n    I_right *= (2.0 * np.pi * R_max)\n    \n    total_flux = I_top + I_right\n    I_total = n * F_CONST * total_flux\n    \n    return I_total\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}