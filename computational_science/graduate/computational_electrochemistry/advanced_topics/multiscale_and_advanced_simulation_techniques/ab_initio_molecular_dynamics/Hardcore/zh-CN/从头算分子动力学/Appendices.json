{
    "hands_on_practices": [
        {
            "introduction": "在进行任何分子动力学模拟时，一个至关重要的初始步骤是确保系统已正确地热化到目标温度。本练习将正则系综中抽象的温度概念与一个具体、可测量的量——原子的平均动能——通过能量均分定理联系起来。通过这个基本原理 ，您将学会如何验证从头算分子动力学模拟的热力学有效性。",
            "id": "4236153",
            "problem": "给定一个计算电化学领域的科学现实情景，该情景涉及从头算分子动力学（AIMD）。在 Born–Oppenheimer 从头算分子动力学（AIMD）中，假定电子在当前的原子核位置下保持瞬时基态，而原子核则根据从电子基态能量面获得的力，遵循经典牛顿动力学演化。考虑一个靠近铂 $(111)$ 板的氯化钠水溶液小体系。任务是利用第一性原理，确定在指定温度下，正则系综轨迹中每个原子的平均动能，并阐述如何设置该轨迹。\n\n仅从基本定律和定义出发，推导在温度 $T$ 下，遵循 Born-Oppenheimer 近似的原子核在无完整约束的经典正则系综中的每个原子的平均动能。推导必须从动能和正则系综的定义开始，并应与平衡态下经典原子核的速度分布联系起来。然后，实现一个程序，该程序根据一组给定的温度计算每个原子的平均动能，假设系统为三维系统，其中每个原子具有三个平移自由度且没有约束。\n\n作为背景知识，在 $T=300\\ \\mathrm{K}$ 下，一个典型的 $10\\ \\mathrm{ps}$ Born-Oppenheimer 轨迹将使用 $0.5$ 到 $1.0\\ \\mathrm{fs}$ 量级的时间步长，产生 $10000$ 到 $20000$ 个步长，每一步的力都通过在固定原子核位置上的电子结构计算获得，并使用恒温器来维持正则系综。然而，在本问题中，您的程序只需计算与经典原子核的正则系综一致的、作为温度函数的每个原子的平均动能。\n\n物理单位要求：以电子伏特表示每个原子的平均动能。程序必须以 $\\mathrm{eV}$ 为单位输出数值，并四舍五入到六位小数。\n\n角度单位要求：不适用，因为不涉及角度。\n\n百分比要求：不适用。\n\n测试套件：\n- 情况 1 (正常情况): $T=300\\ \\mathrm{K}$\n- 情况 2 (绝对零度下的边界条件): $T=0\\ \\mathrm{K}$\n- 情况 3 (高温边缘情况): $T=1000\\ \\mathrm{K}$\n- 情况 4 (接近室温且精度更高): $T=298.15\\ \\mathrm{K}$\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表（例如，$[result1,result2,result3,result4]$），其中每个 $result$ 是对应于上述四个测试温度的每个原子的平均动能（单位为 $\\mathrm{eV}$），并四舍五入到六位小数。",
            "solution": "该问题要求首先对温度为 $T$ 的正则系综中的经典原子核体系进行第一性原理推导，得出每个原子的平均动能，然后通过编程计算特定温度下的数值。\n\n### 问题验证\n\n**步骤 1：提取给定信息**\n- **理论框架**：Born-Oppenheimer 从头算分子动力学（AIMD）。\n- **物理模型**：原子核遵循经典牛顿动力学演化。在固定的原子核位置上，电子处于基态。\n- **系综**：正则系综（NVT）。\n- **系统属性**：每个原子具有三个平移自由度。无完整约束。\n- **任务 1（推导）**：从动能和正则系综的定义出发，推导每个原子的平均动能。\n- **任务 2（计算）**：实现一个程序，根据一组给定的温度计算每个原子的平均动能。\n- **单位**：最终结果必须以电子伏特（$\\mathrm{eV}$）为单位。\n- **舍入**：数值输出必须四舍五入到六位小数。\n- **测试用例**：\n    - 情况 1: $T = 300\\ \\mathrm{K}$\n    - 情况 2: $T = 0\\ \\mathrm{K}$\n    - 情况 3: $T = 1000\\ \\mathrm{K}$\n    - 情况 4: $T = 298.15\\ \\mathrm{K}$\n\n**步骤 2：使用提取的信息进行验证**\n该问题具有科学依据，定义明确且客观。\n1.  **科学合理性**：该问题建立在经典统计力学的基本原理（正则系综、能量均分定理）及其在计算化学中的应用（Born-Oppenheimer 近似）之上。对于此类问题，这些都是标准且正确的假设。\n2.  **适定性**：目标定义明确：推导一个已知的物理量，然后在指定条件下计算其值。假设（经典原子核、3个自由度、无约束）足以得出一个唯一、稳定且有意义的解。\n3.  **客观性**：问题以精确的定量术语陈述，没有歧义或主观内容。AIMD 的背景被用来构建一个关于基础统计力学的问题，这是一种有效的教学方法。\n\n**步骤 3：结论与行动**\n该问题被判定为**有效**。将提供解答。\n\n### 推导与解答\n\n推导从经典统计力学的基本定义出发，针对一个在温度 $T$ 下处于正则系综中的 $N$ 原子体系。\n\n1.  **哈密顿量与动能**：在 Born-Oppenheimer 近似中，原子核的势能 $U(\\mathbf{r}_1, ..., \\mathbf{r}_N)$ 仅取决于其位置 $\\mathbf{r}_i$。原子核子系统的总经典哈密顿量 $H$ 是动能 $K$ 和势能 $U$ 的和：\n    $$H(\\mathbf{r}^N, \\mathbf{p}^N) = K(\\mathbf{p}^N) + U(\\mathbf{r}^N)$$\n    其中 $\\mathbf{r}^N = (\\mathbf{r}_1, ..., \\mathbf{r}_N)$ 和 $\\mathbf{p}^N = (\\mathbf{p}_1, ..., \\mathbf{p}_N)$ 代表所有位置和动量矢量的集合。总动能 $K$ 是 $N$ 个原子各自的动能之和：\n    $$K = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m_i} = \\sum_{i=1}^{N} \\left( \\frac{p_{ix}^2}{2m_i} + \\frac{p_{iy}^2}{2m_i} + \\frac{p_{iz}^2}{2m_i} \\right)$$\n    这里，$m_i$ 是第 $i$ 个原子的质量，$\\mathbf{p}_i = (p_{ix}, p_{iy}, p_{iz})$ 是其动量矢量。\n\n2.  **正则系综与期望值**：在正则系综中，系统处于具有坐标 $(\\mathbf{r}^N, \\mathbf{p}^N)$ 的微观态的概率密度由下式给出：\n    $$\\rho(\\mathbf{r}^N, \\mathbf{p}^N) = \\frac{e^{-\\beta H(\\mathbf{r}^N, \\mathbf{p}^N)}}{Z}$$\n    其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数，$Z$ 是配分函数，它对概率分布进行归一化：\n    $$Z = \\int d\\mathbf{r}^N d\\mathbf{p}^N \\, e^{-\\beta H(\\mathbf{r}^N, \\mathbf{p}^N)}$$\n    任何可观测量 $A$ 的平均值或期望值由下式给出：\n    $$\\langle A \\rangle = \\int d\\mathbf{r}^N d\\mathbf{p}^N \\, A(\\mathbf{r}^N, \\mathbf{p}^N) \\rho(\\mathbf{r}^N, \\mathbf{p}^N)$$\n\n3.  **平均动能**：我们要求的是平均总动能 $\\langle K \\rangle$。\n    $$\\langle K \\rangle = \\frac{1}{Z} \\int d\\mathbf{r}^N d\\mathbf{p}^N \\, K(\\mathbf{p}^N) e^{-\\beta (K(\\mathbf{p}^N) + U(\\mathbf{r}^N))}$$\n    由于哈密顿量可分离为一个依赖于动量的部分 $K(\\mathbf{p}^N)$ 和一个依赖于位置的部分 $U(\\mathbf{r}^N)$，配分函数 $Z$ 可以被分解为：\n    $$Z = \\left( \\int d\\mathbf{p}^N \\, e^{-\\beta K(\\mathbf{p}^N)} \\right) \\left( \\int d\\mathbf{r}^N \\, e^{-\\beta U(\\mathbf{r}^N)} \\right) = Z_p Z_r$$\n    类似地，$\\langle K \\rangle$ 的积分也分离为：\n    $$\\langle K \\rangle = \\frac{1}{Z_p Z_r} \\left( \\int d\\mathbf{p}^N \\, K(\\mathbf{p}^N) e^{-\\beta K(\\mathbf{p}^N)} \\right) \\left( \\int d\\mathbf{r}^N \\, e^{-\\beta U(\\mathbf{r}^N)} \\right)$$\n    位置积分 $\\int d\\mathbf{r}^N \\, e^{-\\beta U(\\mathbf{r}^N)}$ 等于 $Z_r$，可以消去，剩下：\n    $$\\langle K \\rangle = \\frac{\\int d\\mathbf{p}^N \\, K(\\mathbf{p}^N) e^{-\\beta K(\\mathbf{p}^N)}}{\\int d\\mathbf{p}^N \\, e^{-\\beta K(\\mathbf{p}^N)}}$$\n    这表明平均动能与势能函数 $U(\\mathbf{r}^N)$ 无关。\n\n4.  **能量均分定理**：总动能是 $3N$ 个独立的二次项之和（$N$ 个原子中的每一个原子都对应一个动量分量 $p_{ix}, p_{iy}, p_{iz}$）。我们可以评估单个此类项的平均能量贡献，例如 $\\frac{p_{ix}^2}{2m_i}$。\n    $$\\left\\langle \\frac{p_{ix}^2}{2m_i} \\right\\rangle = \\frac{\\int_{-\\infty}^{\\infty} dp_{ix} \\, \\frac{p_{ix}^2}{2m_i} e^{-\\beta \\frac{p_{ix}^2}{2m_i}}}{\\int_{-\\infty}^{\\infty} dp_{ix} \\, e^{-\\beta \\frac{p_{ix}^2}{2m_i}}}$$\n    所有其他动量分量的积分在分子和分母之间被消去。我们使用标准高斯积分：\n    $$\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\frac{\\pi}{a}}$$\n    $$\\int_{-\\infty}^{\\infty} x^2 e^{-ax^2} dx = -\\frac{d}{da} \\int_{-\\infty}^{\\infty} e^{-ax^2} dx = -\\frac{d}{da} \\sqrt{\\frac{\\pi}{a}} = \\frac{1}{2a}\\sqrt{\\frac{\\pi}{a}}$$\n    令 $x = p_{ix}$ 且 $a = \\frac{\\beta}{2m_i}$：\n    - 分母： $\\int_{-\\infty}^{\\infty} e^{-\\frac{\\beta}{2m_i} p_{ix}^2} dp_{ix} = \\sqrt{\\frac{2 \\pi m_i}{\\beta}}$\n    - 分子： $\\int_{-\\infty}^{\\infty} \\frac{p_{ix}^2}{2m_i} e^{-\\frac{\\beta}{2m_i} p_{ix}^2} dp_{ix} = \\frac{1}{2m_i} \\left( \\frac{1}{2 \\frac{\\beta}{2m_i}}\\sqrt{\\frac{2 \\pi m_i}{\\beta}} \\right) = \\frac{1}{2\\beta} \\sqrt{\\frac{2 \\pi m_i}{\\beta}}$\n    求其比值得：\n    $$\\left\\langle \\frac{p_{ix}^2}{2m_i} \\right\\rangle = \\frac{\\frac{1}{2\\beta} \\sqrt{\\frac{2 \\pi m_i}{\\beta}}}{\\sqrt{\\frac{2 \\pi m_i}{\\beta}}} = \\frac{1}{2\\beta} = \\frac{1}{2} k_B T$$\n    这就是能量均分定理：哈密顿量中的每个二次型自由度对系统的平均能量贡献为 $\\frac{1}{2}k_B T$。\n\n5.  **每个原子的平均动能**：问题指明每个原子具有三个平移自由度，且无约束。哈密顿量的动能部分包含 $3N$ 个这样的二次项。因此， $N$ 个原子体系的总平均动能为：\n    $$\\langle K_{total} \\rangle = \\sum_{i=1}^{N} \\left( \\left\\langle \\frac{p_{ix}^2}{2m_i} \\right\\rangle + \\left\\langle \\frac{p_{iy}^2}{2m_i} \\right\\rangle + \\left\\langle \\frac{p_{iz}^2}{2m_i} \\right\\rangle \\right) = 3N \\times \\left(\\frac{1}{2} k_B T\\right) = \\frac{3}{2} N k_B T$$\n    为了求得每个原子的平均动能 $\\langle E_{kin, atom} \\rangle$，我们将总平均动能除以原子数 $N$：\n    $$\\langle E_{kin, atom} \\rangle = \\frac{\\langle K_{total} \\rangle}{N} = \\frac{\\frac{3}{2} N k_B T}{N} = \\frac{3}{2} k_B T$$\n    这就是最终推导出的表达式。对于任何处于热平衡状态、动能是动量的二次函数、且每个粒子具有三个无约束自由度的经典系统，这是一个普适的结果。\n\n6.  **数值计算**：为了实现计算，我们使用以电子伏特每开尔文（$\\mathrm{eV}/\\mathrm{K}$）为单位的玻尔兹曼常数值。\n    - $k_B \\approx 8.617333262 \\times 10^{-5}\\ \\mathrm{eV}/\\mathrm{K}$\n    - 公式为：$\\langle E_{kin, atom} \\rangle [\\mathrm{eV}] = \\frac{3}{2} \\times (8.617333262 \\times 10^{-5}\\ \\mathrm{eV}/\\mathrm{K}) \\times T[\\mathrm{K}]$\n\n现在为给定的测试用例实现此公式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the mean kinetic energy per atom for a classical system\n    in a canonical ensemble at various temperatures.\n    \"\"\"\n    \n    # The Boltzmann constant in electronvolts per Kelvin (eV/K).\n    # Source: CODATA 2018 value.\n    K_B_EV_PER_K = 8.617333262145e-5\n\n    # Define the test cases from the problem statement.\n    # Temperatures are in Kelvin (K).\n    test_cases = [\n        300.0,      # Case 1 (happy path)\n        0.0,        # Case 2 (boundary condition at absolute zero)\n        1000.0,     # Case 3 (high temperature edge case)\n        298.15      # Case 4 (near-ambient temperature with higher precision)\n    ]\n\n    results = []\n    for T in test_cases:\n        # According to the equipartition theorem for a classical system with\n        # 3 translational degrees of freedom per atom and no constraints,\n        # the mean kinetic energy per atom is (3/2) * k_B * T.\n        #\n        # Degrees of freedom (dof) = 3 (for x, y, z translation)\n        # Mean energy per dof = (1/2) * k_B * T\n        # Mean kinetic energy per atom = dof * (1/2) * k_B * T = (3/2) * k_B * T\n        \n        mean_kinetic_energy_per_atom = 1.5 * K_B_EV_PER_K * T\n        \n        # Round the result to six decimal places as required.\n        # We use a format string for robust formatting to ensure trailing zeros.\n        rounded_result = \"{:.6f}\".format(mean_kinetic_energy_per_atom)\n        results.append(rounded_result)\n\n    # Final print statement in the exact required format: [result1,result2,result3,result4]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在验证了基本的温度设定后，我们来探讨一个更精细的模拟质量指标：微正则（NVE）系综中的长期能量守恒。这个实践练习将引导您探索计算速度（由时间步长 $\\Delta t$ 决定）与准确性（由电子自洽场收敛阈值 $\\tau$ 决定）之间不可避免的权衡。通过对产生的能量漂移进行建模和量化 ，您将学习如何选择参数以确保模拟在长时间尺度上保持物理真实性。",
            "id": "3728716",
            "problem": "考虑一个由$128$个原子组成的高熵合金，在微正则系综（粒子数、体积和能量恒定；NVE）中进行 Born-Oppenheimer 分子动力学 (BOMD) 模拟。在理想的连续时间演化中，当自洽场 (SCF) 精确收敛且力精确时，系统的总能量应该是守恒的。在实践中，两个系统数值误差源会导致能量漂移：积分器的有限时间步长 $\\Delta t$ 和电子结构求解器的有限 SCF 收敛容差 $\\tau$。对于足够小的 $\\Delta t$ 和严格的 SCF 容差，每个原子的能量漂移率可以通过一个对主要小误差项呈线性的模型来近似。假设使用 velocity-Verlet 积分器（对于行为良好的力，其局部截断误差为 $\\mathcal{O}((\\Delta t)^3)$ 阶，全局能量误差按 $\\mathcal{O}((\\Delta t)^2)$ 缩放），并且残余力误差与 SCF 能量容差近似线性相关，我们采用以下线性化漂移率模型：\n$$\nr(\\Delta t,\\tau) = \\alpha\\,(\\Delta t)^2 + \\beta\\,\\tau + \\gamma,\n$$\n其中 $r$ 是以 meV/原子/ns 为单位的能量漂移率，$\\Delta t$ 是以 fs (飞秒) 为单位的时间步长，$\\tau$ 是以 eV (电子伏特) 为单位的 SCF 能量容差，而 $\\alpha$、$\\beta$、$\\gamma$ 是待定参数。\n\n现为您提供一组从对该$128$原子高熵合金进行的短期 NVE BOMD 运行中获得的 $(\\Delta t, \\tau)$ 对的能量漂移率 $r$ 的校准测量值。所有列出的 $r$ 值均以 meV/原子/ns 为单位。请使用这些校准数据，通过最小二乘法拟合线性模型参数 $\\alpha$、$\\beta$ 和 $\\gamma$：\n- $(\\Delta t=0.5\\,\\text{fs}, \\tau=1\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=0.1625$\n- $(\\Delta t=0.5\\,\\text{fs}, \\tau=5\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=0.3625$\n- $(\\Delta t=0.5\\,\\text{fs}, \\tau=1\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=0.6125$\n- $(\\Delta t=0.5\\,\\text{fs}, \\tau=5\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=2.6125$\n- $(\\Delta t=1.0\\,\\text{fs}, \\tau=1\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=0.3500$\n- $(\\Delta t=1.0\\,\\text{fs}, \\tau=5\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=0.5500$\n- $(\\Delta t=1.0\\,\\text{fs}, \\tau=1\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=0.8000$\n- $(\\Delta t=1.0\\,\\text{fs}, \\tau=5\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=2.8000$\n- $(\\Delta t=2.0\\,\\text{fs}, \\tau=1\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=1.1000$\n- $(\\Delta t=2.0\\,\\text{fs}, \\tau=5\\times 10^{-5}\\,\\text{eV}) \\rightarrow r=1.3000$\n- $(\\Delta t=2.0\\,\\text{fs}, \\tau=1\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=1.5500$\n- $(\\Delta t=2.0\\,\\text{fs}, \\tau=5\\times 10^{-4}\\,\\text{eV}) \\rightarrow r=3.5500$\n\n在拟合 $\\alpha$、$\\beta$ 和 $\\gamma$ 后，通过计算 $r(\\Delta t,\\tau)$ 来量化指定测试 $(\\Delta t,\\tau)$ 对的能量漂移。此外，推导出一个关于 SCF 容差 $\\tau$ 的函数，即最大允许时间步长 $\\Delta t_{\\max}$ 的建议值，以确保漂移率保持在目标阈值 $r_{\\text{thr}}=1\\,\\text{meV/原子/ns}$ 以下。使用拟合后的模型，该建议值必须满足：\n$$\n\\Delta t_{\\max}(\\tau) = \n\\begin{cases}\n\\sqrt{\\dfrac{r_{\\text{thr}} - \\beta\\,\\tau - \\gamma}{\\alpha}}, & \\text{if } r_{\\text{thr}} - \\beta\\,\\tau - \\gamma > 0 \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\n其中 $\\Delta t_{\\max}$ 以 fs 为单位表示。\n\n您的程序必须执行以下步骤：\n1. 使用上述校准数据集拟合参数 $\\alpha$、$\\beta$ 和 $\\gamma$。\n2. 计算以下测试对的预测漂移率 $r(\\Delta t,\\tau)$：\n   - $\\Delta t=1.0\\,\\text{fs}$, $\\tau=1\\times 10^{-5}\\,\\text{eV}$,\n   - $\\Delta t=2.0\\,\\text{fs}$, $\\tau=1\\times 10^{-5}\\,\\text{eV}$,\n   - $\\Delta t=1.5\\,\\text{fs}$, $\\tau=1\\times 10^{-4}\\,\\text{eV}$。\n   报告每个 $r$ 值，单位为 meV/原子/ns。\n3. 计算在以下 SCF 容差下，为使漂移低于 $r_{\\text{thr}}=1\\,\\text{meV/原子/ns}$ 所建议的最大时间步长 $\\Delta t_{\\max}$：\n   - $\\tau=1\\times 10^{-5}\\,\\text{eV}$,\n   - $\\tau=5\\times 10^{-5}\\,\\text{eV}$,\n   - $\\tau=1\\times 10^{-4}\\,\\text{eV}$,\n   - $\\tau=5\\times 10^{-4}\\,\\text{eV}$。\n   报告每个 $\\Delta t_{\\max}$ 值，单位为 fs。\n\n所有数值答案必须是浮点数，并四舍五入到六位小数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容按以下顺序排列：三个预测的漂移率，后跟四个建议的最大时间步长，即 $[r_{1},r_{2},r_{3},\\Delta t_{\\max,1},\\Delta t_{\\max,2},\\Delta t_{\\max,3},\\Delta t_{\\max,4}]$。",
            "solution": "该问题要求我们确定 Born-Oppenheimer 分子动力学 (BOMD) 模拟中能量漂移线性模型的参数，然后使用此模型进行预测并建立操作约束。分析过程主要分两个阶段：首先，使用线性最小二乘法拟合模型参数；其次，应用拟合后的模型来回答提出的具体问题。\n\n提出的单位原子能量漂移率模型 $r$ 如下所示：\n$$\nr(\\Delta t, \\tau) = \\alpha (\\Delta t)^2 + \\beta \\tau + \\gamma\n$$\n其中 $\\Delta t$ 是积分时间步长（单位：飞秒 fs），$\\tau$ 是自洽场 (SCF) 能量收敛容差（单位：电子伏特 eV），$r$ 是漂移率（单位：meV/原子/ns）。待定参数为 $\\alpha$、$\\beta$ 和 $\\gamma$。该模型相对于这些参数是线性的。$(\\Delta t)^2$ 项的物理动机是 velocity-Verlet 积分器的全局能量误差缩放规律，而对 $\\tau$ 的线性依赖是对不完全 SCF 收敛对原子力的影响的一个合理的一阶近似。\n\n我们得到了 12 个形式为 $((\\Delta t)_i, \\tau_i, r_i)$（$i=1, \\dots, 12$）的校准数据点。为了找到最佳拟合参数 $\\alpha$、$\\beta$ 和 $\\gamma$，我们采用线性最小二乘法。该方法旨在最小化观测漂移率 $r_i$ 与模型预测值之间的平方差之和。\n\n让我们为每个数据点定义一个参数向量 $\\mathbf{p}$ 和一个特征向量 $\\mathbf{x}_i$：\n$$\n\\mathbf{p} = \\begin{pmatrix} \\alpha \\\\ \\beta \\\\ \\gamma \\end{pmatrix}, \\quad \\mathbf{x}_i = \\begin{pmatrix} (\\Delta t_i)^2 \\\\ \\tau_i \\\\ 1 \\end{pmatrix}\n$$\n于是模型可以表示为 $r_i \\approx \\mathbf{x}_i^T \\mathbf{p}$。我们可以将所有 12 个方程组合成一个矩阵方程：\n$$\n\\mathbf{A} \\mathbf{p} = \\mathbf{b}\n$$\n其中 $\\mathbf{A}$ 是一个 $12 \\times 3$ 的设计矩阵，其行是特征向量 $\\mathbf{x}_i^T$，$\\mathbf{b}$ 是一个 $12 \\times 1$ 的观测漂移率 $r_i$ 向量。\n\n$$\n\\mathbf{A} = \\begin{pmatrix}\n(\\Delta t_1)^2 & \\tau_1 & 1 \\\\\n(\\Delta t_2)^2 & \\tau_2 & 1 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n(\\Delta t_{12})^2 & \\tau_{12} & 1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n(0.5)^2 & 1 \\times 10^{-5} & 1 \\\\\n(0.5)^2 & 5 \\times 10^{-5} & 1 \\\\\n(0.5)^2 & 1 \\times 10^{-4} & 1 \\\\\n(0.5)^2 & 5 \\times 10^{-4} & 1 \\\\\n(1.0)^2 & 1 \\times 10^{-5} & 1 \\\\\n(1.0)^2 & 5 \\times 10^{-5} & 1 \\\\\n(1.0)^2 & 1 \\times 10^{-4} & 1 \\\\\n(1.0)^2 & 5 \\times 10^{-4} & 1 \\\\\n(2.0)^2 & 1 \\times 10^{-5} & 1 \\\\\n(2.0)^2 & 5 \\times 10^{-5} & 1 \\\\\n(2.0)^2 & 1 \\times 10^{-4} & 1 \\\\\n(2.0)^2 & 5 \\times 10^{-4} & 1\n\\end{pmatrix},\n\\quad\n\\mathbf{b} = \\begin{pmatrix}\n0.1625 \\\\ 0.3625 \\\\ 0.6125 \\\\ 2.6125 \\\\\n0.3500 \\\\ 0.5500 \\\\ 0.8000 \\\\ 2.8000 \\\\\n1.1000 \\\\ 1.3000 \\\\ 1.5500 \\\\ 3.5500\n\\end{pmatrix}\n$$\n\n最小二乘解 $\\mathbf{p}$ 最小化了残差向量的欧几里得范数 $||\\mathbf{A} \\mathbf{p} - \\mathbf{b}||_2$。该解可通过求解正规方程组得到：\n$$\n(\\mathbf{A}^T \\mathbf{A}) \\mathbf{p} = \\mathbf{A}^T \\mathbf{b}\n$$\n求解这个关于 $\\mathbf{p}$ 的线性方程组，即可得到 $\\alpha$、$\\beta$ 和 $\\gamma$ 的值。使用给定数据进行计算，结果如下：\n$$\n\\alpha = 0.25 \\, \\frac{\\text{meV/原子/ns}}{\\text{fs}^2}\n$$\n$$\n\\beta = 5000 \\, \\frac{\\text{meV/原子/ns}}{\\text{eV}}\n$$\n$$\n\\gamma = 0.05 \\, \\text{meV/原子/ns}\n$$\n所提供的数据可以被这些参数完美描述，这表明校准集中没有随机噪声。因此，拟合后的模型为：\n$$\nr(\\Delta t, \\tau) = 0.25 (\\Delta t)^2 + 5000 \\tau + 0.05\n$$\n\n模型参数化后，我们可以进行所需的计算。\n\n**1. 预测漂移率**\n\n我们计算三个测试对 $(\\Delta t, \\tau)$ 的漂移率 $r$：\n- 对于 $(\\Delta t=1.0\\,\\text{fs}, \\tau=1 \\times 10^{-5}\\,\\text{eV})$：\n$$\nr_1 = 0.25 (1.0)^2 + 5000 (1 \\times 10^{-5}) + 0.05 = 0.25 + 0.05 + 0.05 = 0.35 \\, \\text{meV/原子/ns}\n$$\n- 对于 $(\\Delta t=2.0\\,\\text{fs}, \\tau=1 \\times 10^{-5}\\,\\text{eV})$：\n$$\nr_2 = 0.25 (2.0)^2 + 5000 (1 \\times 10^{-5}) + 0.05 = 0.25(4) + 0.05 + 0.05 = 1.0 + 0.05 + 0.05 = 1.10 \\, \\text{meV/原子/ns}\n$$\n- 对于 $(\\Delta t=1.5\\,\\text{fs}, \\tau=1 \\times 10^{-4}\\,\\text{eV})$：\n$$\nr_3 = 0.25 (1.5)^2 + 5000 (1 \\times 10^{-4}) + 0.05 = 0.25(2.25) + 0.5 + 0.05 = 0.5625 + 0.5 + 0.05 = 1.1125 \\, \\text{meV/原子/ns}\n$$\n\n**2. 建议的最大时间步长**\n\n我们需要为给定的容差 $\\tau$ 找到最大时间步长 $\\Delta t_{\\max}$，使得漂移率不超过阈值 $r_{\\text{thr}} = 1.0\\,\\text{meV/原子/ns}$。我们从模型出发，求解 $\\Delta t$：\n$$\nr_{\\text{thr}} \\ge 0.25 (\\Delta t)^2 + 5000 \\tau + 0.05\n$$\n$$\n(\\Delta t)^2 \\le \\frac{r_{\\text{thr}} - 5000 \\tau - 0.05}{0.25}\n$$\n为使 $\\Delta t$ 为实数，分子必须为非负数。这给出了 $\\Delta t_{\\max}$ 的表达式：\n$$\n\\Delta t_{\\max}(\\tau) = \\begin{cases}\n\\sqrt{\\dfrac{1.0 - 5000 \\tau - 0.05}{0.25}} = \\sqrt{4 (0.95 - 5000 \\tau)} = 2\\sqrt{0.95 - 5000 \\tau}, & \\text{if } 0.95 - 5000 \\tau > 0 \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\n条件 $0.95 - 5000 \\tau > 0$ 意味着 $ \\tau < \\frac{0.95}{5000} = 1.9 \\times 10^{-4}$ eV。\n\n现在我们计算四个给定 $\\tau$ 值的 $\\Delta t_{\\max}$：\n\n- 对于 $\\tau = 1 \\times 10^{-5}\\,\\text{eV}$：满足条件。\n$$\n\\Delta t_{\\max,1} = 2\\sqrt{0.95 - 5000(1 \\times 10^{-5})} = 2\\sqrt{0.95 - 0.05} = 2\\sqrt{0.90} \\approx 1.897367 \\, \\text{fs}\n$$\n- 对于 $\\tau = 5 \\times 10^{-5}\\,\\text{eV}$：满足条件。\n$$\n\\Delta t_{\\max,2} = 2\\sqrt{0.95 - 5000(5 \\times 10^{-5})} = 2\\sqrt{0.95 - 0.25} = 2\\sqrt{0.70} \\approx 1.673320 \\, \\text{fs}\n$$\n- 对于 $\\tau = 1 \\times 10^{-4}\\,\\text{eV}$：满足条件。\n$$\n\\Delta t_{\\max,3} = 2\\sqrt{0.95 - 5000(1 \\times 10^{-4})} = 2\\sqrt{0.95 - 0.50} = 2\\sqrt{0.45} \\approx 1.341641 \\, \\text{fs}\n$$\n- 对于 $\\tau = 5 \\times 10^{-4}\\,\\text{eV}$：$5000 \\tau = 2.5$，大于 $0.95$。分子为负。\n$$\n\\Delta t_{\\max,4} = 0 \\, \\text{fs}\n$$\n\n最终的结果集合，四舍五入到六位小数，是：$r_1=0.350000$，$r_2=1.100000$，$r_3=1.112500$，$\\Delta t_{\\max,1}=1.897367$，$\\Delta t_{\\max,2}=1.673320$，$\\Delta t_{\\max,3}=1.341641$ 和 $\\Delta t_{\\max,4}=0.000000$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of fitting an energy drift model for BOMD simulations\n    and using it for prediction and constraint derivation.\n    \"\"\"\n    \n    # --- Step 1: Fit the model parameters using least squares ---\n    \n    # Calibration data: (delta_t, tau, r)\n    # delta_t is in fs, tau in eV, r in meV/atom/ns.\n    calibration_data = [\n        (0.5, 1e-5, 0.1625),\n        (0.5, 5e-5, 0.3625),\n        (0.5, 1e-4, 0.6125),\n        (0.5, 5e-4, 2.6125),\n        (1.0, 1e-5, 0.3500),\n        (1.0, 5e-5, 0.5500),\n        (1.0, 1e-4, 0.8000),\n        (1.0, 5e-4, 2.8000),\n        (2.0, 1e-5, 1.1000),\n        (2.0, 5e-5, 1.3000),\n        (2.0, 1e-4, 1.5500),\n        (2.0, 5e-4, 3.5500),\n    ]\n\n    # The model is r = alpha * (delta_t)^2 + beta * tau + gamma\n    # This is a linear model in the parameters (alpha, beta, gamma).\n    # We set up the linear system A * p = b, where p = [alpha, beta, gamma].\n    \n    num_points = len(calibration_data)\n    A = np.zeros((num_points, 3))\n    b = np.zeros(num_points)\n    \n    for i, (dt, tau, r) in enumerate(calibration_data):\n        A[i, 0] = dt**2\n        A[i, 1] = tau\n        A[i, 2] = 1\n        b[i] = r\n        \n    # Solve the least squares problem A*p = b for p\n    params, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n    alpha, beta, gamma = params\n\n    # --- Step 2: Compute predicted drift rates for test cases ---\n    \n    test_rates_inputs = [\n        (1.0, 1e-5),  # (delta_t, tau)\n        (2.0, 1e-5),\n        (1.5, 1e-4),\n    ]\n    \n    predicted_rates = []\n    for dt, tau in test_rates_inputs:\n        rate = alpha * dt**2 + beta * tau + gamma\n        predicted_rates.append(rate)\n\n    # --- Step 3: Compute recommended max time step ---\n\n    r_thr = 1.0  # meV/atom/ns\n    \n    test_dtmax_inputs = [\n        1e-5,  # tau in eV\n        5e-5,\n        1e-4,\n        5e-4,\n    ]\n    \n    recommended_dtmax = []\n    for tau in test_dtmax_inputs:\n        # dt_max = sqrt((r_thr - beta*tau - gamma) / alpha)\n        numerator = r_thr - beta * tau - gamma\n        if numerator > 0:\n            dt_max = np.sqrt(numerator / alpha)\n        else:\n            dt_max = 0.0\n        recommended_dtmax.append(dt_max)\n        \n    # Combine all results\n    all_results = predicted_rates + recommended_dtmax\n    \n    # Format the output as specified\n    formatted_results = [f\"{res:.6f}\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在拥有一个经过恰当设置和验证的模拟之后，我们便可以着手解决计算化学的核心目标之一：预测反应速率。这项高级练习将展示如何结合不同从头算分子动力学技术的结果——使用伞形采样计算自由能垒 $\\Delta G^\\ddagger$，以及通过反应通量法计算动力学校正因子 $\\kappa$——从而从第一性原理出发计算反应速率常数。这个过程  将原子尺度的运动与宏观的化学动力学联系起来。",
            "id": "4236156",
            "problem": "考虑一个在模型电极上发生的析氢反应，该反应通过第一性原理分子动力学（AIMD, Ab Initio Molecular Dynamics）进行研究。沿单个标量反应坐标 $s$ 进行的伞形采样（Umbrella sampling）得到了一个平均力势 $G(s)$，其势垒高度 $\\Delta G^\\ddagger$ 定义了到达位于 $s^\\ddagger$ 的分割面所需的自由能代价。另外，从分割面开始并具有前向速度的短反应流轨迹（reactive flux trajectories）产生了一个时间依赖的透射系数序列 $\\{\\kappa(t_i)\\}$，该序列编码了动力学重渡（dynamical recrossings）效应。从经典正则速率理论和反应流平台区的定义出发，推导一个以平台透射系数 $\\kappa$ 和自由能垒 $\\Delta G^\\ddagger$ 表示的速率常数 $k$ 的显式表达式。然后，实现一个程序，使用该表达式为给定的测试用例计算 $k$。\n\n推导和计算的基本依据：\n- 温度为 $T$ 的经典正则系综，其哈密顿量为 $H(x,p) = K(p) + U(x)$。\n- 反应坐标 $s(x)$ 和位于 $s^\\ddagger$ 的分割面的定义，其中反应物区域为 $s < s^\\ddagger$，产物区域为 $s > s^\\ddagger$。\n- 通过伞形采样获得的沿 $s$ 的平均力势 $G(s)$，以及代表性反应物值 $s_{\\mathrm{r}}$ 和势垒顶点 $s^\\ddagger$ 之间的自由能垒 $\\Delta G^\\ddagger = G(s^\\ddagger) - G(s_{\\mathrm{r}})$。\n- 反应流公式，其中当瞬态重渡衰减后，时间依赖的透射系数 $\\kappa(t)$ 在中间时间段会平台化至一个常数 $\\kappa$。\n\n计算任务：\n1. 对于每个提供的测试用例，使用以下算法从所提供的时间序列 $\\{\\kappa(t_i)\\}$ 中估算平台透射系数 $\\kappa$：\n   - 给定单位为飞秒（femtoseconds）的严格递增时间序列 $\\{t_i\\}$ 和区间 $[0,1]$ 内的相应值 $\\{y_i\\} = \\{\\kappa(t_i)\\}$，定义窗口大小 $m = 5$ 和容差 $\\epsilon = 0.02$。对于满足以下条件的最小索引 $j \\ge m$：\n     $$\\frac{R_j}{\\max\\left(\\bar{y}_j, \\delta_0\\right)} \\le \\epsilon,$$\n     其中 $R_j = \\max\\{y_{j-m+1},\\dots,y_j\\} - \\min\\{y_{j-m+1},\\dots,y_j\\}$ 是窗口范围，$\\bar{y}_j$ 是窗口的平均值，$\\delta_0 = 10^{-6}$ 用于防止除以零，将平台估计值定义为\n     $$\\kappa = \\frac{1}{N-j} \\sum_{i=j}^{N-1} y_i,$$\n     其中 $N$ 是序列长度，索引为 0-based。如果不存在这样的 $j$，则将 $\\kappa$ 定义为最后 $m$ 个点的平均值。\n2. 使用你推导出的以 $\\kappa$ 和 $\\Delta G^\\ddagger$ 表示的 $k$ 的表达式，为每个测试用例计算 $k$。使用玻尔兹曼常数 $k_{\\mathrm{B}}$ 和普朗克常数 $h$，其值分别为 $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\ \\mathrm{J/K}$ 和 $h = 6.62607015\\times 10^{-34}\\ \\mathrm{J\\,s}$。使用 $1\\ \\mathrm{eV} = 1.602176634\\times 10^{-19}\\ \\mathrm{J}$ 将 $\\Delta G^\\ddagger$ 从电子伏特转换为焦耳。最终速率常数以 $\\mathrm{s}^{-1}$ 为单位表示。将每个速率四舍五入到 $6$ 位有效数字。\n3. 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如，$[r_1,r_2,\\dots]$，其中每个 $r_i$ 是以 $\\mathrm{s}^{-1}$ 为单位的四舍五入后的浮点数。\n\n测试套件：\n- 案例 1 (理想情况): $T = 300\\ \\mathrm{K}$, $\\Delta G^\\ddagger = 0.50\\ \\mathrm{eV}$, 时间 $\\{0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200\\}$ fs, 值 $\\{0.0, 0.18, 0.28, 0.33, 0.35, 0.355, 0.358, 0.360, 0.361, 0.3615, 0.362, 0.362, 0.3622, 0.3621, 0.3623, 0.3622, 0.3623, 0.3622, 0.3623, 0.3623, 0.3623\\}$。\n- 案例 2 (强重渡，轻微噪声): $T = 350\\ \\mathrm{K}$, $\\Delta G^\\ddagger = 0.35\\ \\mathrm{eV}$, 时间 $\\{0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150\\}$ fs, 值 $\\{0.0, 0.05, 0.09, 0.11, 0.115, 0.118, 0.12, 0.119, 0.121, 0.120, 0.120, 0.121, 0.1205, 0.1208, 0.1207, 0.1206\\}$。\n- 案例 3 (近无垒): $T = 300\\ \\mathrm{K}$, $\\Delta G^\\ddagger = 0.05\\ \\mathrm{eV}$, 时间 $\\{0, 20, 40, 60, 80, 100, 120, 140, 160, 180\\}$ fs, 值 $\\{0.0, 0.4, 0.55, 0.64, 0.68, 0.70, 0.705, 0.707, 0.707, 0.7075\\}$。\n- 案例 4 (高势垒): $T = 298\\ \\mathrm{K}$, $\\Delta G^\\ddagger = 1.00\\ \\mathrm{eV}$, 时间 $\\{0, 15, 30, 45, 60, 75, 90, 105, 120, 135, 150, 165\\}$ fs, 值 $\\{0.0, 0.2, 0.3, 0.38, 0.40, 0.405, 0.407, 0.408, 0.409, 0.4095, 0.4098, 0.4097\\}$。\n- 案例 5 (过冲后平台，边界情况): $T = 330\\ \\mathrm{K}$, $\\Delta G^\\ddagger = 0.00\\ \\mathrm{eV}$, 时间 $\\{0, 10, 20, 30, 40, 50, 60, 70, 80, 90\\}$ fs, 值 $\\{0.0, 0.6, 0.55, 0.52, 0.505, 0.5, 0.501, 0.5005, 0.5002, 0.5001\\}$。\n\n答案规格：\n- 为每个案例计算速率常数 $k$ (单位 $\\mathrm{s}^{-1}$)，四舍五入到 $6$ 位有效数字。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如，$[r_1,r_2,\\dots]$。",
            "solution": "本任务要求在计算化学框架内，特别是利用第一性原理分子动力学（AIMD）的概念，推导化学反应速率常数 $k$ 的表达式，然后实现一个程序来计算它。推导过程必须将通过伞形采样获得的平均力势 ($G(s)$) 与通过反应流计算获得的透射系数 ($\\kappa$) 联系起来。\n\n推导从过渡态理论（TST）的基本方程开始。TST假设每个从反应物侧穿过分割面（过渡态）的系统都会进入产物侧而不会返回，从而为速率常数提供了一个上限。对于在温度 $T$ 下的经典正则系综中的反应，TST 速率常数 $k_{\\mathrm{TST}}$ 由下式给出：\n$$\nk_{\\mathrm{TST}} = \\nu \\frac{Q^\\ddagger}{Q_{\\mathrm{r}}}\n$$\n其中 $\\nu$ 是频率因子，$Q_{\\mathrm{r}}$ 是反应物的正则配分函数，$Q^\\ddagger$ 是系统在过渡态的配分函数，并且已移除了与反应坐标相对应的自由度。在单维反应坐标 $s$ 的背景下，频率因子可以被证明为 $\\nu = \\frac{k_{\\mathrm{B}} T}{h}$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$h$ 是普朗克常数。\n\n配分函数之比与吉布斯活化自由能 $\\Delta G^\\ddagger$ 直接相关。根据统计力学，吉布斯自由能 $G$ 通过 $G = -k_{\\mathrm{B}} T \\ln Q$ 与总配分函数 $Q$ 相关。活化自由能是过渡态 ($s^\\ddagger$) 和反应物态 ($s_{\\mathrm{r}}$) 之间的自由能差：\n$$\n\\Delta G^\\ddagger = G(s^\\ddagger) - G(s_{\\mathrm{r}}) = -k_{\\mathrm{B}} T \\ln Q^\\ddagger - (-k_{\\mathrm{B}} T \\ln Q_{\\mathrm{r}}) = -k_{\\mathrm{B}} T \\ln\\left(\\frac{Q^\\ddagger}{Q_{\\mathrm{r}}}\\right)\n$$\n在问题中，这个量以平均力势 $G(s)$ 的势垒高度的形式给出，它就是沿反应坐标的自由能剖面。求解配分函数之比可得：\n$$\n\\frac{Q^\\ddagger}{Q_{\\mathrm{r}}} = e^{-\\Delta G^\\ddagger / (k_{\\mathrm{B}} T)}\n$$\n将此式以及 $\\nu$ 的表达式代入 $k_{\\mathrm{TST}}$ 的方程，得到著名的艾林方程（Eyring equation）：\n$$\nk_{\\mathrm{TST}} = \\frac{k_{\\mathrm{B}} T}{h} e^{-\\Delta G^\\ddagger / (k_{\\mathrm{B}} T)}\n$$\nTST 的主要缺陷是它忽略了动力学重渡，即轨迹穿过分割面但立即返回到反应物区域的现象。反应流形式主义修正了这一点。真实的速率常数 $k$ 通过透射系数 $\\kappa$ 与 TST 速率相关联：\n$$\nk = \\kappa \\cdot k_{\\mathrm{TST}}\n$$\n透射系数 $\\kappa$ 是一个介于 0 和 1 之间的值，它量化了在分割面上向前运动并成功形成产物的轨迹所占的比例。它由时间依赖的透射系数 $\\kappa(t)$ 的长时间极限或平台区确定，而 $\\kappa(t)$ 又是从在分割面处启动的短分子动力学轨迹系综计算得出的。时间依赖函数 $\\kappa(t)$ 通常从初始值 $\\kappa(t=0^+) = 1$ 衰减，经过一个短暂的瞬态周期（期间发生快速重渡事件）后，达到一个稳定的平台值 $\\kappa$。\n\n结合 $k_{\\mathrm{TST}}$ 的表达式和动力学校正 $\\kappa$，我们得到速率常数的最终显式表达式：\n$$\nk = \\kappa \\frac{k_{\\mathrm{B}} T}{h} e^{-\\Delta G^\\ddagger / (k_{\\mathrm{B}} T)}\n$$\n该方程构成了计算任务的基础。程序将首先使用指定的数值算法从给定的时间序列数据 $\\{\\kappa(t_i)\\}$ 中估算平台透射系数 $\\kappa$。该算法通过搜索一个数据窗口来识别稳定平台的开始，在该窗口中，数值的相对范围低于容差 $\\epsilon$。一旦确定了 $\\kappa$，就使用推导出的公式计算速率常数 $k$。为保证单位一致性，由于常数 $k_{\\mathrm{B}}$ 和 $h$ 是以国际单位制（SI units）给出的，因此以电子伏特（eV）为单位的自由能垒 $\\Delta G^\\ddagger$ 在使用前必须转换为焦耳（J）。最终计算出的速率 $k$ 的单位将是 $\\mathrm{s}^{-1}$。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef round_to_n_significant(number, n):\n    \"\"\"\n    Rounds a number to a specified number of significant figures.\n    \"\"\"\n    if number == 0:\n        return 0.0\n    \n    # Calculate the order of magnitude to determine the rounding scale\n    order_of_magnitude = math.floor(math.log10(abs(number)))\n    \n    # Calculate the scaling factor for rounding\n    scale = 10**(order_of_magnitude - (n - 1))\n    \n    # Round the scaled number and then scale it back\n    return round(number / scale) * scale\n\ndef estimate_kappa(values, m=5, epsilon=0.02, delta0=1e-6):\n    \"\"\"\n    Estimates the plateau transmission coefficient kappa from a time series.\n\n    Args:\n        values (list): The list of kappa(t) values.\n        m (int): The window size for plateau detection.\n        epsilon (float): The tolerance for the relative range.\n        delta0 (float): A small value to prevent division by zero.\n\n    Returns:\n        float: The estimated plateau transmission coefficient.\n    \"\"\"\n    n = len(values)\n    if n < m:\n        # If the series is shorter than the window, average what's available.\n        return np.mean(values) if n > 0 else 0.0\n\n    plateau_start_index = -1\n\n    for j in range(m, n):\n        window_indices = slice(j - m + 1, j + 1)\n        window_values = values[window_indices]\n        \n        range_j = np.max(window_values) - np.min(window_values)\n        mean_j = np.mean(window_values)\n        \n        denominator = max(mean_j, delta0)\n        \n        if denominator > 0 and (range_j / denominator) <= epsilon:\n            plateau_start_index = j\n            break\n            \n    if plateau_start_index != -1:\n        # Plateau found, average from the start of the plateau to the end\n        return np.mean(values[plateau_start_index:])\n    else:\n        # No plateau found, average over the last m points as a fallback\n        return np.mean(values[-m:])\n\ndef calculate_rate(T, dG_eV, kappa):\n    \"\"\"\n    Calculates the reaction rate constant k.\n\n    Args:\n        T (float): Temperature in Kelvin.\n        dG_eV (float): Free energy barrier in electronvolts.\n        kappa (float): The transmission coefficient.\n\n    Returns:\n        float: The rate constant k in s^-1.\n    \"\"\"\n    # Physical constants\n    K_B = 1.380649e-23   # Boltzmann constant in J/K\n    H = 6.62607015e-34    # Planck's constant in J*s\n    EV_TO_J = 1.602176634e-19 # Conversion factor from eV to Joules\n\n    # Convert dG to Joules\n    dG_J = dG_eV * EV_TO_J\n\n    # Calculate the exponent term\n    kBT = K_B * T\n    if kBT == 0:  # Avoid division by zero\n        return 0.0\n    \n    exponent = -dG_J / kBT\n\n    # Calculate Transition State Theory prefactor\n    tst_prefactor = kBT / H\n\n    # Calculate the final rate constant\n    k = kappa * tst_prefactor * np.exp(exponent)\n    \n    return k\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"T\": 300, \"dG_eV\": 0.50,\n            \"times_fs\": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200],\n            \"kappa_t\": [0.0, 0.18, 0.28, 0.33, 0.35, 0.355, 0.358, 0.360, 0.361, 0.3615, 0.362, 0.362, 0.3622, 0.3621, 0.3623, 0.3622, 0.3623, 0.3622, 0.3623, 0.3623, 0.3623]\n        },\n        {\n            \"T\": 350, \"dG_eV\": 0.35,\n            \"times_fs\": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150],\n            \"kappa_t\": [0.0, 0.05, 0.09, 0.11, 0.115, 0.118, 0.12, 0.119, 0.121, 0.120, 0.120, 0.121, 0.1205, 0.1208, 0.1207, 0.1206]\n        },\n        {\n            \"T\": 300, \"dG_eV\": 0.05,\n            \"times_fs\": [0, 20, 40, 60, 80, 100, 120, 140, 160, 180],\n            \"kappa_t\": [0.0, 0.4, 0.55, 0.64, 0.68, 0.70, 0.705, 0.707, 0.707, 0.7075]\n        },\n        {\n            \"T\": 298, \"dG_eV\": 1.00,\n            \"times_fs\": [0, 15, 30, 45, 60, 75, 90, 105, 120, 135, 150, 165],\n            \"kappa_t\": [0.0, 0.2, 0.3, 0.38, 0.40, 0.405, 0.407, 0.408, 0.409, 0.4095, 0.4098, 0.4097]\n        },\n        {\n            \"T\": 330, \"dG_eV\": 0.00,\n            \"times_fs\": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90],\n            \"kappa_t\": [0.0, 0.6, 0.55, 0.52, 0.505, 0.5, 0.501, 0.5005, 0.5002, 0.5001]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        kappa = estimate_kappa(case[\"kappa_t\"])\n        rate_constant = calculate_rate(case[\"T\"], case[\"dG_eV\"], kappa)\n        rounded_rate = round_to_n_significant(rate_constant, 6)\n        results.append(rounded_rate)\n    \n    # Format the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}