{
    "hands_on_practices": [
        {
            "introduction": "The radial distribution function, $g(r)$, is a cornerstone of structural analysis in liquids and solutions, providing a statistical picture of the local environment around a particle. Its true power is unlocked when we connect it to tangible chemical concepts. This first practice guides you through the process of translating the abstract information within $g(r)$ into the coordination number, a chemically intuitive quantity that describes the average number of atoms in a solvation shell. By working through this exercise , you will bridge the gap between statistical mechanics and chemical structure, a fundamental skill in computational electrochemistry.",
            "id": "4259524",
            "problem": "A classical Molecular Dynamics (MD) simulation of a $1.0$ molar lithium salt in ethylene carbonate at $T=298\\,\\mathrm{K}$ and ambient pressure yields the radial distribution function (RDF) between lithium cations and carbonyl oxygen atoms, denoted $g_{ab}(r)$ with $a=\\mathrm{Li}^{+}$ and $b=\\mathrm{O}$. The goal is to obtain the average coordination number of carbonyl oxygen atoms in the first solvation shell of $\\mathrm{Li}^{+}$ by integrating the appropriate quantity up to the first minimum of the RDF.\n\nStarting from the definition of the pair correlation function and the spherical shell volume element, derive the expression that connects the coordination number to the RDF and bulk number density of species $b$. Then, using the provided physical properties to determine the bulk number density of oxygen atoms and the provided discrete RDF data, carry out a numerically consistent integration up to the first minimum and report the coordination number.\n\nAssume the liquid is dominated by ethylene carbonate with mass density $\\rho_{\\mathrm{mass}}=1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$ at $T=298\\,\\mathrm{K}$, ethylene carbonate molecular formula $\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$, molar mass $M=88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$, and three oxygen atoms per molecule. Use Avogadro’s constant $N_{A}=6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$. Treat the oxygen bulk number density as originating from the solvent molecules only. The first minimum of the lithium–oxygen RDF occurs at $r_{m}=3.2\\,\\text{\\AA}$.\n\nThe RDF data are sampled on a uniform radial grid with spacing $\\Delta r=0.2\\,\\text{\\AA}$, with $r$ in $\\text{\\AA}$ and $g_{ab}(r)$ dimensionless:\n\n- $r=\\{\\,0.0,\\,0.2,\\,0.4,\\,0.6,\\,0.8,\\,1.0,\\,1.2,\\,1.4,\\,1.6,\\,1.8,\\,2.0,\\,2.2,\\,2.4,\\,2.6,\\,2.8,\\,3.0,\\,3.2\\,\\}$\n\n- $g_{ab}(r)=\\{\\,0.0,\\,0.0,\\,0.0,\\,0.05,\\,0.10,\\,0.20,\\,0.50,\\,1.20,\\,2.50,\\,3.80,\\,4.20,\\,3.60,\\,2.80,\\,1.40,\\,0.70,\\,0.45,\\,0.35\\,\\}$\n\nProceed as follows:\n\n- From first principles, express the coordination number in terms of the RDF and the bulk number density.\n\n- Compute the oxygen atom bulk number density $\\rho_{b}$ in $\\text{\\AA}^{-3}$ from $\\rho_{\\mathrm{mass}}$, $M$, and $N_{A}$.\n\n- Perform a first-order quadrature that is consistent with the uniform sampling to evaluate the integral up to $r_{m}$.\n\n- Report the coordination number rounded to three significant figures. The coordination number is dimensionless; do not include units in your final numerical result.",
            "solution": "The user wants me to solve a problem from the field of computational electrochemistry.\n\n### Step 1: Extract Givens\n- System: $1.0$ molar lithium salt in ethylene carbonate.\n- Temperature: $T=298\\,\\mathrm{K}$.\n- Pressure: Ambient.\n- Quantity of interest: Average coordination number of carbonyl oxygen atoms in the first solvation shell of $\\mathrm{Li}^{+}$.\n- Correlation function: Radial distribution function (RDF), $g_{ab}(r)$, with $a=\\mathrm{Li}^{+}$ and $b=\\mathrm{O}$.\n- Integration limit: First minimum of the RDF, $r_{m}=3.2\\,\\text{\\AA}$.\n- Solvent (ethylene carbonate) mass density: $\\rho_{\\mathrm{mass}}=1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$.\n- Solvent molecular formula: $\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$.\n- Solvent molar mass: $M=88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$.\n- Number of oxygen atoms per solvent molecule: $3$.\n- Avogadro's constant: $N_{A}=6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$.\n- Instruction: Treat the oxygen bulk number density as originating from the solvent molecules only, using all three oxygen atoms per molecule.\n- RDF data grid spacing: $\\Delta r=0.2\\,\\text{\\AA}$.\n- RDF data points $(r, g_{ab}(r))$ where $r$ is in $\\text{\\AA}$:\n  - $r=\\{\\,0.0,\\,0.2,\\,0.4,\\,0.6,\\,0.8,\\,1.0,\\,1.2,\\,1.4,\\,1.6,\\,1.8,\\,2.0,\\,2.2,\\,2.4,\\,2.6,\\,2.8,\\,3.0,\\,3.2\\,\\}$\n  - $g_{ab}(r)=\\{\\,0.0,\\,0.0,\\,0.0,\\,0.05,\\,0.10,\\,0.20,\\,0.50,\\,1.20,\\,2.50,\\,3.80,\\,4.20,\\,3.60,\\,2.80,\\,1.40,\\,0.70,\\,0.45,\\,0.35\\,\\}$\n- Task 1: Derive expression for coordination number.\n- Task 2: Compute bulk number density of oxygen atoms, $\\rho_{b}$.\n- Task 3: Perform numerical integration using first-order quadrature.\n- Task 4: Report the final coordination number rounded to three significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the principles of statistical mechanics and computational chemistry. The use of the radial distribution function to calculate coordination numbers is a standard and fundamental technique for analyzing the structure of liquids and solutions. The physical data provided for ethylene carbonate (density, molar mass) are realistic.\n\nThe problem is well-posed. It provides all necessary data and constants ($g_{ab}(r)$ values, integration limits, physical constants) and a clear set of instructions to arrive at a unique numerical answer. The instruction to use a \"first-order quadrature\" is a standard specification for numerical methods, for which the trapezoidal rule is a suitable choice given the discrete, uniformly-spaced data.\n\nThere is a minor ambiguity in the problem statement. It specifies the RDF is between $\\mathrm{Li}^{+}$ and \"carbonyl oxygen atoms\" and the goal is the coordination number of \"carbonyl oxygen atoms\", but then explicitly instructs to use all \"three oxygen atoms per molecule\" to calculate the bulk number density $\\rho_b$. A strict interpretation would require using the bulk density of only carbonyl oxygens (of which there is one per molecule). This would create a contradiction. However, a more reasonable interpretation, common in such problems, is that species $b$ in both $g_{ab}(r)$ and $\\rho_b$ refers to the same set of atoms, which the problem defines for calculation purposes as all three oxygen atoms. The term \"carbonyl oxygen\" is likely used because the Li-O interaction is dominated by the carbonyl oxygen, but for the bulk calculation, all oxygens are to be included as per the explicit instruction. Under this interpretation, the problem is internally consistent and solvable.\n\nTherefore, the problem is deemed valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\nThe average coordination number, $N_c$, of species $b$ around species $a$ up to a distance $r_m$ is the total number of particles of species $b$ found within a sphere of radius $r_m$ centered on a particle of species $a$. This can be calculated by integrating the local number density of species $b$ over the volume of this sphere.\n\nThe radial distribution function, $g_{ab}(r)$, relates the local number density of species $b$ at a distance $r$ from a particle of species $a$, denoted $\\rho_b(r)$, to the average bulk number density of species $b$, $\\rho_b$. The relationship is given by:\n$$\n\\rho_b(r) = \\rho_b g_{ab}(r)\n$$\nThe number of particles of species $b$, $dN_b$, in a thin spherical shell of radius $r$ and thickness $dr$ around a particle of species $a$ is the product of the local density and the volume of the shell, $dV = 4\\pi r^2 dr$:\n$$\ndN_b(r) = \\rho_b(r) dV = \\rho_b g_{ab}(r) (4\\pi r^2 dr)\n$$\nTo find the total coordination number $N_c$ in the first solvation shell, which extends to the first minimum of the RDF at $r=r_m$, we integrate $dN_b(r)$ from $r=0$ to $r=r_m$:\n$$\nN_c(r_m) = \\int_0^{r_m} dN_b(r) = \\int_0^{r_m} 4\\pi \\rho_b r^2 g_{ab}(r) dr\n$$\nSince $\\rho_b$ and $4\\pi$ are constants, we can write the expression as:\n$$\nN_c(r_m) = 4\\pi \\rho_b \\int_0^{r_m} r^2 g_{ab}(r) dr\n$$\nThis is the required expression connecting the coordination number to the RDF and the bulk number density.\n\nNext, we compute the bulk number density of oxygen atoms, $\\rho_b$. The problem states that the solvent is ethylene carbonate ($\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$) and we must use its mass density $\\rho_{\\mathrm{mass}} = 1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$, molar mass $M = 88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$, and consider all three oxygen atoms per molecule. We use Avogadro's constant $N_{A} = 6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$.\n\nThe number density of solvent molecules, $\\rho_{\\text{solvent}}$, is given by:\n$$\n\\rho_{\\text{solvent}} = \\frac{\\rho_{\\mathrm{mass}}}{M} N_A\n$$\nSince there are $3$ oxygen atoms per solvent molecule, the number density of oxygen atoms, $\\rho_b$, is:\n$$\n\\rho_b = 3 \\times \\rho_{\\text{solvent}} = 3 \\frac{\\rho_{\\mathrm{mass}} N_A}{M}\n$$\nSubstituting the given values:\n$$\n\\rho_b = 3 \\times \\frac{1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}}{88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}} \\times 6.022\\times 10^{23}\\,\\mathrm{mol}^{-1} \\approx 2.7079 \\times 10^{22}\\,\\mathrm{cm}^{-3}\n$$\nThe calculation requires units of $\\text{\\AA}$. We use the conversion $1\\,\\mathrm{cm} = 10^8\\,\\text{\\AA}$, which implies $1\\,\\mathrm{cm}^3 = 10^{24}\\,\\text{\\AA}^3$.\n$$\n\\rho_b = (2.7079 \\times 10^{22}\\,\\mathrm{cm}^{-3}) \\times \\frac{1\\,\\mathrm{cm}^3}{10^{24}\\,\\text{\\AA}^3} = 0.027079\\,\\text{\\AA}^{-3}\n$$\n\nNow, we must numerically evaluate the integral $I = \\int_0^{r_m} r^2 g_{ab}(r) dr$. The data for $r$ and $g_{ab}(r)$ are provided on a uniform grid with spacing $\\Delta r = 0.2\\,\\text{\\AA}$, and the integration limit is $r_m = 3.2\\,\\text{\\AA}$. We use the trapezoidal rule, a first-order quadrature method. Let the integrand be $h(r) = r^2 g_{ab}(r)$. The integral is approximated as:\n$$\nI \\approx \\frac{\\Delta r}{2} \\left[ h(r_0) + 2\\sum_{i=1}^{N-1} h(r_i) + h(r_N) \\right]\n$$\nwhere the data points are indexed from $i=0$ to $N=16$, so $r_0=0.0\\,\\text{\\AA}$ and $r_{16}=3.2\\,\\text{\\AA}$.\nWe tabulate the values of $h_i = r_i^2 g_{ab}(r_i)$:\n$h_0 = (0.0)^2 \\times 0.0 = 0.0$\n$h_1 = (0.2)^2 \\times 0.0 = 0.0$\n$h_2 = (0.4)^2 \\times 0.0 = 0.0$\n$h_3 = (0.6)^2 \\times 0.05 = 0.018$\n$h_4 = (0.8)^2 \\times 0.10 = 0.064$\n$h_5 = (1.0)^2 \\times 0.20 = 0.200$\n$h_6 = (1.2)^2 \\times 0.50 = 0.720$\n$h_7 = (1.4)^2 \\times 1.20 = 2.352$\n$h_8 = (1.6)^2 \\times 2.50 = 6.400$\n$h_9 = (1.8)^2 \\times 3.80 = 12.312$\n$h_{10} = (2.0)^2 \\times 4.20 = 16.800$\n$h_{11} = (2.2)^2 \\times 3.60 = 17.424$\n$h_{12} = (2.4)^2 \\times 2.80 = 16.128$\n$h_{13} = (2.6)^2 \\times 1.40 = 9.464$\n$h_{14} = (2.8)^2 \\times 0.70 = 5.488$\n$h_{15} = (3.0)^2 \\times 0.45 = 4.050$\n$h_{16} = (3.2)^2 \\times 0.35 = 3.584$\n\nThe sum of the intermediate terms is:\n$$\n\\sum_{i=1}^{15} h_i = 0.0 + 0.0 + 0.018 + 0.064 + 0.200 + 0.720 + 2.352 + 6.400 + 12.312 + 16.800 + 17.424 + 16.128 + 9.464 + 5.488 + 4.050 = 91.422\n$$\nThe value of the integral is then:\n$$\nI \\approx \\frac{0.2\\,\\text{\\AA}}{2} \\left[ h_0 + 2\\sum_{i=1}^{15} h_i + h_{16} \\right] = 0.1\\,\\text{\\AA} \\times [0.0 + 2(91.422) + 3.584] = 0.1 \\times [182.844 + 3.584]\\,\\text{\\AA}^3 = 18.6428\\,\\text{\\AA}^3\n$$\nFinally, we compute the coordination number $N_c$:\n$$\nN_c = 4\\pi \\rho_b I \\approx 4\\pi \\times (0.027079\\,\\text{\\AA}^{-3}) \\times (18.6428\\,\\text{\\AA}^3)\n$$\n$$\nN_c \\approx 6.3429\n$$\nThe problem requires the result to be rounded to three significant figures.\n$$\nN_c \\approx 6.34\n$$",
            "answer": "$$\\boxed{6.34}$$"
        },
        {
            "introduction": "While pair correlation functions excel at describing local order, they can miss the bigger picture of large-scale organization, such as the formation of ion networks in concentrated electrolytes. To probe these mesoscale structures, we turn to graph-based methods and the concept of percolation. This practice  challenges you to model an electrolyte system as a network, where ions are nodes and connections are defined by a distance cutoff. By analyzing the connectivity of this graph, you will identify the percolation threshold—the point at which a system-spanning cluster emerges—providing direct insight into the structural backbone for ionic transport.",
            "id": "4259554",
            "problem": "You are given three artificial molecular dynamics snapshots representative of concentrated electrolyte environments in a cubic periodic simulation box. Each snapshot consists of a set of ion coordinates and a box length. Your task is to perform a structural analysis using graph-based connectivity: treat each ion as a node and connect two nodes with an undirected edge if their minimum-image distance under periodic boundary conditions is less than or equal to a specified cutoff distance. From this graph, compute the cluster size distribution and identify the percolation threshold across a set of candidate cutoff distances. The definition of percolation to use is the existence of a largest connected component whose fractional size is greater than or equal to a specified fraction threshold.\n\nFundamental base and definitions to use:\n- Molecular dynamics yields atomistic coordinates at discrete times. Given a single snapshot of positions $\\{\\mathbf{r}_i\\}_{i=1}^{N}$ within a cubic box of side length $L$, apply periodic boundary conditions via the Minimum Image Convention (MIC), defined as follows. For any pair $i,j$, define the displacement vector\n$$\n\\Delta \\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i - L \\cdot \\operatorname{round}\\left(\\frac{\\mathbf{r}_j - \\mathbf{r}_i}{L}\\right),\n$$\nwhere the rounding function is applied component-wise. The Euclidean distance is then\n$$\nd_{ij} = \\left\\lVert \\Delta \\mathbf{r}_{ij} \\right\\rVert_2.\n$$\n- For a given cutoff distance $r_c$, define an undirected graph $G(r_c)$ whose vertex set is the ions and whose edge set contains $\\{i,j\\}$ if and only if $d_{ij} \\le r_c$.\n- A connected component is a maximal set of vertices where any two are linked by a path. The cluster size distribution is the multiset of component sizes. The largest cluster fraction is $S_{\\max}(r_c)/N$, where $S_{\\max}(r_c)$ is the size of the largest component and $N$ is the total number of ions.\n- The percolation threshold for a given snapshot and fraction threshold $\\phi$ is the smallest cutoff $r_c$ from a supplied candidate list such that $S_{\\max}(r_c)/N \\ge \\phi$. If no candidate cutoff meets the criterion, report no percolation.\n\nThe analysis must be based solely on these definitions, starting from Euclidean geometry and graph connectivity, without invoking any shortcut formulas or external hints. Ensure numerical soundness by using the Minimum Image Convention and computing exact connected components.\n\nUnits and output requirements:\n- Distances are in nanometers, denoted $\\mathrm{nm}$. All cutoff distances $r_c$, box lengths $L$, and coordinates are in $\\mathrm{nm}$. Express the final percolation cutoff for each test case in $\\mathrm{nm}$, rounded to three decimal places.\n- The fraction threshold $\\phi$ is unitless and must be treated as a decimal (not a percentage).\n- If no percolation is found for a test case, output the sentinel value $-1.000$ (interpreted as $\\mathrm{nm}$) for that case.\n\nTest suite:\nFor each test case, construct the coordinates exactly as specified below.\n\n- Test Case A (happy path):\n  - Number of ions $N = 12$.\n  - Box length $L = 5.0\\,\\mathrm{nm}$.\n  - Coordinates are defined by two groups:\n    1. A linear chain of $7$ ions:\n       $$\\mathbf{r}_i = \\left(0.5 + 0.49\\,i,\\ 0.5,\\ 0.5\\right)\\ \\text{for}\\ i \\in \\{0,1,2,3,4,5,6\\}.$$\n    2. $5$ well-separated ions:\n       $$\\mathbf{r}_j = \\left(1.0 + 0.4\\,j,\\ 3.5,\\ 3.5\\right)\\ \\text{for}\\ j \\in \\{0,1,2,3,4\\}.$$\n  - Candidate cutoff distances:\n    $$\\{0.3,\\ 0.4,\\ 0.5,\\ 0.6\\}\\ \\mathrm{nm}.$$\n  - Fraction threshold:\n    $$\\phi = 0.5.$$\n\n- Test Case B (boundary condition at threshold):\n  - Number of ions $N = 10$.\n  - Box length $L = 4.0\\,\\mathrm{nm}$.\n  - Coordinates are defined by two groups:\n    1. A linear chain of $5$ ions:\n       $$\\mathbf{r}_i = \\left(0.5 + 0.45\\,i,\\ 0.5,\\ 0.5\\right)\\ \\text{for}\\ i \\in \\{0,1,2,3,4\\}.$$\n    2. $5$ well-separated ions:\n       $$\\mathbf{r}_j = \\left(1.0 + 0.5\\,j,\\ 3.0,\\ 3.0\\right)\\ \\text{for}\\ j \\in \\{0,1,2,3,4\\}.$$\n  - Candidate cutoff distances:\n    $$\\{0.4,\\ 0.45,\\ 0.5\\}\\ \\mathrm{nm}.$$\n  - Fraction threshold:\n    $$\\phi = 0.5.$$\n\n- Test Case C (no percolation):\n  - Number of ions $N = 8$.\n  - Box length $L = 3.0\\,\\mathrm{nm}$.\n  - Coordinates are $4$ dimers, each with separation $0.3\\,\\mathrm{nm}$, but candidate cutoffs are strictly less than $0.3\\,\\mathrm{nm}$:\n    $$\\begin{aligned}\n    \\mathbf{r}_0 &= (0.5,\\ 0.5,\\ 0.5), & \\mathbf{r}_1 &= (0.8,\\ 0.5,\\ 0.5),\\\\\n    \\mathbf{r}_2 &= (1.5,\\ 1.5,\\ 1.5), & \\mathbf{r}_3 &= (1.8,\\ 1.5,\\ 1.5),\\\\\n    \\mathbf{r}_4 &= (0.5,\\ 2.5,\\ 2.5), & \\mathbf{r}_5 &= (0.8,\\ 2.5,\\ 2.5),\\\\\n    \\mathbf{r}_6 &= (2.5,\\ 0.5,\\ 2.5), & \\mathbf{r}_7 &= (2.8,\\ 0.5, 2.5).\n    \\end{aligned}$$\n  - Candidate cutoff distances:\n    $$\\{0.2,\\ 0.25\\}\\ \\mathrm{nm}.$$\n  - Fraction threshold:\n    $$\\phi = 0.5.$$\n\nProgram requirements:\n- Implement the Minimum Image Convention for periodic boundary conditions exactly as specified.\n- For each candidate $r_c$, build $G(r_c)$, compute connected components, and obtain the cluster size distribution and the largest cluster fraction $S_{\\max}(r_c)/N$.\n- For each test case, identify the percolation threshold as the smallest $r_c$ from its candidate list such that $S_{\\max}(r_c)/N \\ge \\phi$. If none exist, report $-1.000$.\n- Your program should produce a single line of output containing the percolation thresholds for Test Cases A, B, and C, respectively, as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places in $\\mathrm{nm}$ (e.g., $[0.500,0.450,-1.000]$).",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of computational chemistry and statistical mechanics, specifically the analysis of particle configurations from molecular dynamics. The problem is well-posed, with all necessary data, definitions, and constraints provided. The objectives are clear, and the required methodology is explicitly defined, ensuring a unique and verifiable solution.\n\nThe task is to determine the percolation threshold for three distinct molecular systems given their ion coordinates, simulation box dimensions, a set of candidate cutoff distances, and a percolation fraction threshold. The solution involves a graph-based analysis of ion connectivity under periodic boundary conditions.\n\nThe algorithmic approach proceeds as follows for each test case:\n1.  The candidate cutoff distances, $\\{r_c\\}$, are first sorted in ascending order. This is essential because the percolation threshold is defined as the *smallest* $r_c$ that satisfies the percolation criterion.\n2.  We iterate through the sorted candidate cutoffs. For each $r_c$, we construct a graph $G(r_c)$ and test for percolation.\n3.  The graph $G(r_c)$ has $N$ vertices, where $N$ is the number of ions. An undirected edge is created between two vertices, say $i$ and $j$, if the distance between the corresponding ions, $d_{ij}$, is less than or equal to $r_c$.\n4.  The distance $d_{ij}$ must be calculated using the Minimum Image Convention (MIC) to account for the periodic boundary conditions of the cubic simulation box of side length $L$. The displacement vector $\\Delta \\mathbf{r}_{ij}$ between ion $j$ at position $\\mathbf{r}_j$ and ion $i$ at position $\\mathbf{r}_i$ is given by:\n    $$\n    \\Delta \\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i - L \\cdot \\operatorname{round}\\left(\\frac{\\mathbf{r}_j - \\mathbf{r}_i}{L}\\right)\n    $$\n    where the $\\operatorname{round}$ function is applied to each vector component. The distance is the Euclidean norm of this displacement vector, $d_{ij} = \\left\\lVert \\Delta \\mathbf{r}_{ij} \\right\\rVert_2$. Computationally, it is more efficient to compare squared distances to avoid the square root operation: an edge exists if $d_{ij}^2 \\le r_c^2$. The adjacency list is a suitable data structure to represent the graph.\n5.  Once the graph $G(r_c)$ is constructed, we must find the sizes of its connected components. A graph traversal algorithm, such as Depth-First Search (DFS) or Breadth-First Search (BFS), is employed. We maintain a `visited` array to keep track of visited vertices. We iterate through all vertices from $0$ to $N-1$. If a vertex has not been visited, we start a new traversal from it, counting all vertices in its connected component and marking them as visited.\n6.  During the component search, we track the size of the largest component found, denoted $S_{\\max}(r_c)$.\n7.  The percolation criterion is then checked. Percolation is said to occur if the fraction of ions in the largest cluster, $S_{\\max}(r_c)/N$, is greater than or equal to the specified fraction threshold, $\\phi$.\n    $$\n    \\frac{S_{\\max}(r_c)}{N} \\ge \\phi\n    $$\n8.  If the criterion is met, the current $r_c$ is the percolation threshold. Since we are iterating through the cutoffs in ascending order, this will be the smallest such $r_c$. The function then returns this value.\n9.  If the loop completes without the criterion ever being met, it signifies that no percolation occurs for any of the candidate cutoff distances. In this case, the specified sentinel value of $-1.0$ is returned.\n\nThis procedure is applied to each of the three test cases, and the resulting percolation thresholds are collected and formatted as a comma-separated list, with each value rounded to three decimal places.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef find_percolation_threshold(coords: np.ndarray, N: int, L: float, cutoffs: list[float], phi: float) -> float:\n    \"\"\"\n    Calculates the percolation threshold for a set of ions in a periodic box.\n\n    Args:\n        coords: An (N, 3) numpy array of ion coordinates.\n        N: The number of ions.\n        L: The side length of the cubic periodic box.\n        cutoffs: A list of candidate cutoff distances.\n        phi: The fraction threshold for percolation.\n\n    Returns:\n        The smallest cutoff distance that achieves percolation, or -1.0 if none do.\n    \"\"\"\n    sorted_cutoffs = sorted(cutoffs)\n\n    for rc in sorted_cutoffs:\n        rc_sq = rc * rc\n\n        # Build adjacency list for the graph G(rc)\n        adj = [[] for _ in range(N)]\n        for i in range(N):\n            for j in range(i + 1, N):\n                # Calculate squared distance using Minimum Image Convention (MIC)\n                dr = coords[j] - coords[i]\n                dr -= L * np.round(dr / L)\n                dist_sq = np.sum(dr**2)\n\n                if dist_sq <= rc_sq:\n                    adj[i].append(j)\n                    adj[j].append(i)\n\n        # Find connected components and the size of the largest one using DFS\n        visited = [False] * N\n        max_component_size = 0\n        for i in range(N):\n            if not visited[i]:\n                current_component_size = 0\n                stack = [i]\n                visited[i] = True\n                while stack:\n                    u = stack.pop()\n                    current_component_size += 1\n                    for v in adj[u]:\n                        if not visited[v]:\n                            visited[v] = True\n                            stack.append(v)\n                \n                if current_component_size > max_component_size:\n                    max_component_size = current_component_size\n        \n        # Check for percolation\n        if N > 0 and (max_component_size / N) >= phi:\n            return rc\n\n    return -1.0\n\ndef solve():\n    \"\"\"\n    Defines and solves the test cases for percolation analysis.\n    \"\"\"\n    # Test Case A\n    N_A = 12\n    coords_A_list = []\n    # Group 1: linear chain of 7 ions\n    for i in range(7):\n        coords_A_list.append([0.5 + 0.49 * i, 0.5, 0.5])\n    # Group 2: 5 well-separated ions\n    for j in range(5):\n        coords_A_list.append([1.0 + 0.4 * j, 3.5, 3.5])\n\n    case_A = (\n        np.array(coords_A_list),\n        N_A,\n        5.0,  # L\n        [0.3, 0.4, 0.5, 0.6],  # cutoffs\n        0.5   # phi\n    )\n\n    # Test Case B\n    N_B = 10\n    coords_B_list = []\n    # Group 1: linear chain of 5 ions\n    for i in range(5):\n        coords_B_list.append([0.5 + 0.45 * i, 0.5, 0.5])\n    # Group 2: 5 well-separated ions\n    for j in range(5):\n        coords_B_list.append([1.0 + 0.5 * j, 3.0, 3.0])\n\n    case_B = (\n        np.array(coords_B_list),\n        N_B,\n        4.0,  # L\n        [0.4, 0.45, 0.5],  # cutoffs\n        0.5   # phi\n    )\n\n    # Test Case C\n    N_C = 8\n    coords_C_list = [\n        [0.5, 0.5, 0.5], [0.8, 0.5, 0.5],\n        [1.5, 1.5, 1.5], [1.8, 1.5, 1.5],\n        [0.5, 2.5, 2.5], [0.8, 2.5, 2.5],\n        [2.5, 0.5, 2.5], [2.8, 0.5, 2.5]\n    ]\n\n    case_C = (\n        np.array(coords_C_list),\n        N_C,\n        3.0,  # L\n        [0.2, 0.25],  # cutoffs\n        0.5   # phi\n    )\n\n    test_cases = [case_A, case_B, case_C]\n    results = []\n    \n    for case in test_cases:\n        coords, N, L, cutoffs, phi = case\n        result = find_percolation_threshold(coords, N, L, cutoffs, phi)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Structural analysis is not only about processing data but also about designing simulations that can generate meaningful data in the first place. This practice shifts our focus from real space to reciprocal space to explore how finite-size effects constrain our observations. Using the static structure factor, $S(q)$, we can analyze periodic ordering, but only if our simulation box is commensurate with the wavelength of the structure. This exercise  presents a practical design problem: determining the minimum simulation box size required to resolve a target structural feature without introducing discretization artifacts, a critical consideration for accurately modeling interfacial phenomena.",
            "id": "4259478",
            "problem": "You will design and implement a program to estimate finite-size effects on the discretization of the static structure factor (SSF) $S(q)$ and to choose a simulation box size that resolves a target real-space wavelength associated with interfacial layering in a molecular dynamics system. The derivation must start from the following foundational principles and definitions: (i) Fourier analysis of periodic functions, (ii) the definition of the SSF as the Fourier transform of a correlation function, and (iii) Periodic Boundary Conditions (PBC) in a finite simulation box. Use only these principles as the base and do not rely on any shortcut formulas not derived from first principles.\n\nAssume a one-dimensional interfacial layering along the surface-normal direction with a density modulation that contains a sinusoidal component of target real-space wavelength $\\lambda_{\\mathrm{t}}$. In an infinite system, this modulation produces a spectral peak at wave number $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$ in the SSF along that direction. In a finite one-dimensional box of length $L$ with Periodic Boundary Conditions (PBC), allowed wave numbers are discrete and given by $q_k = 2\\pi k / L$ for integer $k$, and the SSF computed in this finite domain is the infinite-domain SSF convolved with the Fourier transform of the top-hat window of width $L$, which is proportional to $\\mathrm{sinc}(\\Delta q\\, L/2)$, where $\\Delta q$ is the wave number offset relative to a true spectral line. The discretization step in wave number space is $\\Delta q = 2\\pi/L$.\n\nTo represent the peak at $q_\\star$ without discretization mismatch, you must ensure that $q_\\star$ coincides with an allowed $q_k$. A sufficient condition is $L = m\\,\\lambda_{\\mathrm{t}}$ for some integer $m \\ge 1$, for which $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}} = 2\\pi m / (m\\,\\lambda_{\\mathrm{t}}) = q_m$. Additionally, to control finite-size broadening due to the window function, you must bound the relative resolution defined by the ratio $\\Delta q/q_\\star$. Since $\\Delta q = 2\\pi/L$ and $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$, the relative resolution simplifies to $\\Delta q/q_\\star = \\lambda_{\\mathrm{t}}/L = 1/m$. Therefore, to enforce a maximum relative resolution $\\mu_{\\max}$, you must choose $m \\ge 1/\\mu_{\\max}$. Finally, to diminish finite-size effects in real space, ensure at least $N_{\\min}$ wavelengths of the modulation are contained in the box, i.e., $m \\ge N_{\\min}$.\n\nYour task is to:\n- Derive, from the above principles, a rule to compute the minimal box length $L_{\\min}$ that guarantees exact representability of the target wave number $q_\\star$ on the discrete grid and satisfies both a resolution constraint and a minimum-number-of-periods constraint.\n- Implement a program that, for each test case, computes:\n  1. The integer $m_{\\min} = \\lceil \\max(1/\\mu_{\\max}, N_{\\min}) \\rceil$,\n  2. The minimal box length $L_{\\min} = m_{\\min}\\,\\lambda_{\\mathrm{t}}$ expressed in nanometers,\n  3. The discretization step $\\Delta q = 2\\pi/L_{\\min}$ expressed in inverse nanometers,\n  4. The target wave number $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$ expressed in inverse nanometers.\n\nYour program must produce its final output as a single line containing a comma-separated list of per-test-case results, where each per-test-case result is a list of the form $[L_{\\min}, \\Delta q, q_\\star, m_{\\min}]$. For example, your final output should look like $[[L_1,\\Delta q_1,q_{\\star,1},m_1],[L_2,\\Delta q_2,q_{\\star,2},m_2],\\dots]$. All $L$ values must be expressed in nanometers, and all $q$ values must be expressed in inverse nanometers. Angles are not used in this problem.\n\nUse the following test suite, which covers a general case, boundary equality of the resolution criterion, and large-box edge cases:\n- Test case 1: $\\lambda_{\\mathrm{t}} = 0.6\\,\\mathrm{nm}$, $\\mu_{\\max} = 0.1$, $N_{\\min} = 5$.\n- Test case 2: $\\lambda_{\\mathrm{t}} = 0.8\\,\\mathrm{nm}$, $\\mu_{\\max} = 0.25$, $N_{\\min} = 2$.\n- Test case 3: $\\lambda_{\\mathrm{t}} = 2.5\\,\\mathrm{nm}$, $\\mu_{\\max} = 0.05$, $N_{\\min} = 3$.\n- Test case 4: $\\lambda_{\\mathrm{t}} = 0.5\\,\\mathrm{nm}$, $\\mu_{\\max} = 0.01$, $N_{\\min} = 1$.\n- Test case 5 (boundary condition where the resolution equality holds): $\\lambda_{\\mathrm{t}} = 5.0\\,\\mathrm{nm}$, $\\mu_{\\max} = 0.2$, $N_{\\min} = 1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each per-test-case result itself being a list $[L_{\\min},\\Delta q,q_\\star,m_{\\min}]$ written without spaces. For example: $[[L_1,\\Delta q_1,q_{\\star,1},m_1],[L_2,\\Delta q_2,q_{\\star,2},m_2],\\dots]$.",
            "solution": "The problem is valid. The premises are scientifically sound, the objectives are clearly defined, and all necessary data and constraints are provided. The problem constitutes a well-posed exercise in applying the principles of Fourier analysis to finite-size effects in molecular dynamics simulations.\n\nThe task is to derive a rule for selecting the minimal simulation box length, $L_{\\min}$, that satisfies three conditions for analyzing a one-dimensional density modulation with a characteristic wavelength $\\lambda_{\\mathrm{t}}$: ($1$) exact representability of the corresponding wave number $q_{\\star}$ on a discrete Fourier grid, ($2$) a maximum relative resolution constraint $\\mu_{\\max}$, and ($3$) a minimum number of real-space periods $N_{\\min}$ within the box. Subsequently, we must implement this rule to calculate $L_{\\min}$ and related quantities for a suite of test cases.\n\nThe derivation proceeds by formalizing each of the three constraints based on the provided principles.\n\nFirst, we address the condition of exact representability. In a simulation box of length $L$ with Periodic Boundary Conditions (PBC), the allowed wave numbers are discrete, forming a set $\\{q_k\\}$ where $q_k = 2\\pi k / L$ for any integer $k$. The density modulation of interest has a characteristic wavelength $\\lambda_{\\mathrm{t}}$, which corresponds to a peak in the static structure factor (SSF) at the wave number $q_{\\star} = 2\\pi/\\lambda_{\\mathrm{t}}$ in an infinite system. For this feature to be represented without discretization error in the finite system, $q_{\\star}$ must be one of the allowed wave numbers. That is, there must exist a positive integer $m$ such that $q_{\\star} = q_m$.\n$$\nq_{\\star} = q_m \\implies \\frac{2\\pi}{\\lambda_{\\mathrm{t}}} = \\frac{2\\pi m}{L}\n$$\nSolving for the box length $L$ gives the fundamental relationship between the box length and the target wavelength required for perfect grid matching:\n$$\nL = m \\lambda_{\\mathrm{t}}, \\quad \\text{for } m \\in \\{1, 2, 3, \\dots\\}\n$$\nThis condition ensures that the simulation box contains an integer number $m$ of the target wavelengths.\n\nSecond, we incorporate the resolution constraint. The discretization of reciprocal space implies a finite resolution, or step size, between adjacent wave numbers, given by $\\Delta q = q_{k+1} - q_k = 2\\pi/L$. The problem requires that the relative resolution, defined as the ratio of the step size to the target wave number, $\\Delta q / q_{\\star}$, must not exceed a maximum value $\\mu_{\\max}$.\n$$\n\\frac{\\Delta q}{q_{\\star}} \\le \\mu_{\\max}\n$$\nSubstituting the expressions for $\\Delta q$ and $q_{\\star}$, we find:\n$$\n\\frac{2\\pi/L}{2\\pi/\\lambda_{\\mathrm{t}}} = \\frac{\\lambda_{\\mathrm{t}}}{L} \\le \\mu_{\\max}\n$$\nNow, we enforce the first condition by substituting $L = m \\lambda_{\\mathrm{t}}$ into this inequality:\n$$\n\\frac{\\lambda_{\\mathrm{t}}}{m \\lambda_{\\mathrm{t}}} = \\frac{1}{m} \\le \\mu_{\\max}\n$$\nSince $m$ must be positive, this inequality is equivalent to:\n$$\nm \\ge \\frac{1}{\\mu_{\\max}}\n$$\n\nThird, we consider the real-space constraint. To mitigate other potential finite-size artifacts and ensure adequate sampling of the structure, the box length $L$ must be large enough to contain at least $N_{\\min}$ periods of the modulation.\n$$\nL \\ge N_{\\min} \\lambda_{\\mathrm{t}}\n$$\nOnce again, substituting $L = m \\lambda_{\\mathrm{t}}$ yields:\n$$\nm \\lambda_{\\mathrm{t}} \\ge N_{\\min} \\lambda_{\\mathrm{t}}\n$$\nSince $\\lambda_{\\mathrm{t}} > 0$, we can divide by it without changing the inequality's direction, leading to a simple constraint on $m$:\n$$\nm \\ge N_{\\min}\n$$\n\nTo find the minimal box length $L_{\\min}$ that satisfies all three conditions simultaneously, we must find the smallest possible integer $m$, which we denote $m_{\\min}$, that satisfies both $m \\ge 1/\\mu_{\\max}$ and $m \\ge N_{\\min}$. This requires $m$ to be greater than or equal to the maximum of these two lower bounds.\n$$\nm \\ge \\max\\left(\\frac{1}{\\mu_{\\max}}, N_{\\min}\\right)\n$$\nSince $m$ must be an integer, the smallest possible value for $m$ is the ceiling of this maximum value.\n$$\nm_{\\min} = \\left\\lceil \\max\\left(\\frac{1}{\\mu_{\\max}}, N_{\\min}\\right) \\right\\rceil\n$$\nThe constraint $m \\ge 1$ is implicitly satisfied, as $\\mu_{\\max}$ (a relative resolution) is typically $\\le 1$, making $1/\\mu_{\\max} \\ge 1$, and $N_{\\min}$ is a count, so $N_{\\min} \\ge 1$.\n\nWith the rule for $m_{\\min}$ established, the quantities to be computed are determined as follows:\n1.  The minimal integer multiple: $m_{\\min} = \\lceil \\max(1/\\mu_{\\max}, N_{\\min}) \\rceil$.\n2.  The minimal box length: $L_{\\min} = m_{\\min} \\lambda_{\\mathrm{t}}$. Units will be nanometers ($\\mathrm{nm}$) since $\\lambda_{\\mathrm{t}}$ is given in $\\mathrm{nm}$.\n3.  The wave number discretization step: $\\Delta q = 2\\pi/L_{\\min}$. Units will be inverse nanometers ($\\mathrm{nm}^{-1}$).\n4.  The target wave number: $q_{\\star} = 2\\pi/\\lambda_{\\mathrm{t}}$. Units will be inverse nanometers ($\\mathrm{nm}^{-1}$).\n\nThese formulas provide the complete algorithm for determining the optimal simulation box parameters based on the stated principles.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the minimal simulation box length and related spectral quantities\n    for a series of test cases based on derived physical constraints.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (lambda_t in nm, mu_max, N_min)\n    test_cases = [\n        (0.6, 0.1, 5),   # Test case 1\n        (0.8, 0.25, 2),  # Test case 2\n        (2.5, 0.05, 3),  # Test case 3\n        (0.5, 0.01, 1),  # Test case 4\n        (5.0, 0.2, 1),   # Test case 5\n    ]\n\n    results_str_list = []\n    for lambda_t, mu_max, N_min in test_cases:\n        # Step 1: Compute the minimal integer multiple m_min.\n        # This is the smallest integer m satisfying both m >= 1/mu_max and m >= N_min.\n        m_min_float = np.ceil(np.maximum(1.0 / mu_max, N_min))\n        m_min = int(m_min_float)\n\n        # Step 2: Compute the minimal box length L_min.\n        # This is derived from the condition L = m * lambda_t.\n        L_min = m_min * lambda_t\n\n        # Step 3: Compute the discretization step in wave number space, Delta_q.\n        # This is determined by the box length, Delta_q = 2*pi / L.\n        delta_q = 2.0 * np.pi / L_min\n\n        # Step 4: Compute the target wave number, q_star.\n        # This corresponds to the real-space wavelength, q_star = 2*pi / lambda_t.\n        q_star = 2.0 * np.pi / lambda_t\n\n        # Format the result for this test case into a string '[L,dq,q*,m]' without spaces.\n        case_result_str = f\"[{L_min},{delta_q},{q_star},{m_min}]\"\n        results_str_list.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The output is a single line: \"[[L1,dq1,q*1,m1],[L2,dq2,q*2,m2],...]\"\n    print(f\"[{','.join(results_str_list)}]\")\n\nsolve()\n```"
        }
    ]
}