{
    "hands_on_practices": [
        {
            "introduction": "要理解电场在密度泛函理论（DFT）中的建模，最基础的一步是掌握电场如何改变系统的能量。本练习将从第一性原理出发，运用微扰理论和 Hellmann-Feynman 定理，推导在外加弱电场下分子基态能量的一阶变化。通过这个实践，你将把宏观的能量变化与微观的电荷分布（即偶极矩 $\\boldsymbol{\\mu}$）直接联系起来，从而加深对线性斯塔克效应（linear Stark effect）在分子层面上的理解 。",
            "id": "4253295",
            "problem": "考虑一个有限中性分子，在密度泛函理论（DFT）框架内处理，原子核位置固定，且原子核系统相对于原点没有净偶极矩。基态电子密度被建模为两个归一化的三维高斯分量的叠加，\n$$\nn(\\mathbf{r}) \\;=\\; \\sum_{i=1}^{2} \\, N_i \\, \\frac{1}{\\left(\\pi \\sigma_i^2\\right)^{3/2}} \\, \\exp\\!\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right),\n$$\n其中$N_i$是分量$i$中的电子数，$\\sigma_i$是其宽度，$\\mathbf{R}_i$是其中心。假设$\\mathbf{R}_1 = (0,0,1.20\\,\\mathrm{\\AA})$，$\\mathbf{R}_2 = (0,0,-0.80\\,\\mathrm{\\AA})$，$N_1 = 6$，$N_2 = 4$，且$\\sigma_1 = \\sigma_2 = 0.30\\,\\mathrm{\\AA}$。该体系处于一个空间均匀、微弱的静态电场$\\mathbf{E} = E\\,\\hat{\\mathbf{z}}$中，其中$E = 0.025\\,\\mathrm{V}/\\mathrm{\\AA}$。\n\n从Hohenberg–Kohn变分原理和不含时微扰理论出发，并援引Hellmann–Feynman定理，推导基态电子能量的一阶变化量，用基态密度和元电荷$e$表示，适用于均匀外电场情况。然后，使用所给的$n(\\mathbf{r})$模型，计算基态电子能量一阶变化量的数值。使用偶极矩的定义\n$$\n\\boldsymbol{\\mu} \\;=\\; -\\,e \\int \\mathbf{r}\\, n(\\mathbf{r})\\, d\\mathbf{r},\n$$\n并将元电荷$e$作为一个符号。将最终的能量变化以电子伏特（eV）为单位表示，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求计算一个处于均匀静电场中的分子的基态电子能量的一阶变化。我们将首先使用密度泛函理论（DFT）和微扰理论的原理推导该能量变化的一般表达式，然后根据给定的电子密度模型计算其数值。\n\n### 第1部分：一阶能量变化的推导\n\n在存在外势$v_{\\text{ext}}(\\mathbf{r})$的情况下，系统的总电子哈密顿量由$H = T + V_{ee} + V_{\\text{ext}}$给出，其中$T$是动能算符，$V_{ee}$是电子-电子相互作用，$V_{\\text{ext}} = \\int v_{\\text{ext}}(\\mathbf{r}) n(\\mathbf{r}) d\\mathbf{r}$是由外势引起的能量，而$n(\\mathbf{r})$是电子密度。\n\n在本问题中，系统处于一个均匀的静电场$\\mathbf{E}$中。一个电子（电荷为$-e$）所受的外势由固定的原子核产生的势$v_{\\text{nuc}}(\\mathbf{r})$和电场产生的势组成。电荷$q$在电势$\\phi(\\mathbf{r})$中的势能为$q\\phi(\\mathbf{r})$。对于一个均匀电场$\\mathbf{E}$，电势为$\\phi(\\mathbf{r}) = -\\mathbf{r} \\cdot \\mathbf{E}$（假设$\\phi(\\mathbf{0})=0$）。对于电荷为$q=-e$的电子，其势能为$(-e)(-\\mathbf{r} \\cdot \\mathbf{E}) = e\\,\\mathbf{r} \\cdot \\mathbf{E}$。\n\n因此，单个电子的外势为$v_{\\text{ext}}(\\mathbf{r}, \\mathbf{E}) = v_{\\text{nuc}}(\\mathbf{r}) + e\\,\\mathbf{r} \\cdot \\mathbf{E}$。总电子哈密顿量成为$\\mathbf{E}$的函数：\n$$\nH(\\mathbf{E}) = \\left(T + V_{ee} + \\int v_{\\text{nuc}}(\\mathbf{r}) n(\\mathbf{r}) d\\mathbf{r}\\right) + \\int (e\\,\\mathbf{r} \\cdot \\mathbf{E}) n(\\mathbf{r}) d\\mathbf{r}\n$$\n我们可以将无电场时的哈密顿量确定为$H_0 = H(\\mathbf{E}=\\mathbf{0})$，由电场引起的微扰为$V_{\\text{pert}}$。作用于多电子波函数的微扰算符形式为：\n$$\nV_{\\text{pert}} = \\sum_{j=1}^{N_{\\text{tot}}} e\\,\\mathbf{r}_j \\cdot \\mathbf{E}\n$$\n其中求和遍及所有$N_{\\text{tot}}$个电子。\n\n根据不含时微扰理论，基态能量的一阶修正$\\Delta E^{(1)}$是微扰算符相对于未受扰动的基态波函数$\\Psi_0$的期望值：\n$$\n\\Delta E^{(1)} = \\langle \\Psi_0 | V_{\\text{pert}} | \\Psi_0 \\rangle = \\left\\langle \\Psi_0 \\left| \\sum_{j=1}^{N_{\\text{tot}}} e\\,\\mathbf{r}_j \\cdot \\mathbf{E} \\right| \\Psi_0 \\right\\rangle\n$$\n这可以重写为：\n$$\n\\Delta E^{(1)} = e \\left( \\left\\langle \\Psi_0 \\left| \\sum_{j=1}^{N_{\\text{tot}}} \\mathbf{r}_j \\right| \\Psi_0 \\right\\rangle \\right) \\cdot \\mathbf{E}\n$$\n位置算符之和的期望值与基态电子密度$n_0(\\mathbf{r})$的关系为：\n$$\n\\left\\langle \\Psi_0 \\left| \\sum_{j=1}^{N_{\\text{tot}}} \\mathbf{r}_j \\right| \\Psi_0 \\right\\rangle = \\int \\mathbf{r}\\, n_0(\\mathbf{r})\\, d\\mathbf{r}\n$$\n将此代入$\\Delta E^{(1)}$的表达式中，得到以基态密度表示的期望结果：\n$$\n\\Delta E^{(1)} = e \\left( \\int \\mathbf{r}\\, n_0(\\mathbf{r})\\, d\\mathbf{r} \\right) \\cdot \\mathbf{E}\n$$\n这个结果与所要求的Hellmann-Feynman定理一致。该定理指出，对于依赖于参数$\\lambda$的哈密顿量$H(\\lambda)$，能量本征值$E(\\lambda)$对$\\lambda$的导数为$\\frac{dE}{d\\lambda} = \\left\\langle \\Psi(\\lambda) \\left| \\frac{\\partial H}{\\partial \\lambda} \\right| \\Psi(\\lambda) \\right\\rangle$。让我们将场强大小$E$视为参数，其中$\\mathbf{E} = E\\hat{\\mathbf{z}}$。哈密顿量为$H(E) = H_0 + E \\left(e \\sum_j z_j\\right)$。那么$\\frac{\\partial H}{\\partial E} = e\\sum_j z_j$。能量的导数为$\\frac{dE}{dE} = \\langle \\Psi(E) | e \\sum_j z_j | \\Psi(E) \\rangle$。对于弱场，一阶变化为$\\Delta E^{(1)} \\approx E \\left. \\frac{dE}{dE} \\right|_{E=0} = E \\langle \\Psi_0 | e \\sum_j z_j | \\Psi_0 \\rangle$，这导出了相同的表达式。\n\n该表达式也可以用永久电子偶极矩$\\boldsymbol{\\mu}_0$来表示。使用给定的定义$\\boldsymbol{\\mu} = -e \\int \\mathbf{r}\\, n(\\mathbf{r})\\, d\\mathbf{r}$，我们有：\n$$\n\\Delta E^{(1)} = - \\left( -e \\int \\mathbf{r}\\, n_0(\\mathbf{r})\\, d\\mathbf{r} \\right) \\cdot \\mathbf{E} = - \\boldsymbol{\\mu}_0 \\cdot \\mathbf{E}\n$$\n这是偶极子在外场中的经典能量。\n\n### 第2部分：针对给定模型的计算\n\n我们需要使用所给的未受扰动基态密度$n(\\mathbf{r})$（我们将其表示为$n_0(\\mathbf{r})$）的模型来计算积分$\\int \\mathbf{r}\\,n_0(\\mathbf{r})\\, d\\mathbf{r}$：\n$$\nn_0(\\mathbf{r}) \\;=\\; \\sum_{i=1}^{2} \\, N_i \\, \\frac{1}{\\left(\\pi \\sigma_i^2\\right)^{3/2}} \\, \\exp\\!\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right)\n$$\n积分为：\n$$\n\\int \\mathbf{r}\\, n_0(\\mathbf{r})\\, d\\mathbf{r} = \\int \\mathbf{r} \\left[ \\sum_{i=1}^{2} N_i \\frac{1}{(\\pi \\sigma_i^2)^{3/2}} \\exp\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right) \\right] d\\mathbf{r}\n$$\n根据积分的线性性质，我们可以交换求和与积分的顺序：\n$$\n= \\sum_{i=1}^{2} N_i \\frac{1}{(\\pi \\sigma_i^2)^{3/2}} \\int \\mathbf{r} \\exp\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right) d\\mathbf{r}\n$$\n为了计算每个分量$i$的积分，我们使用代换$\\mathbf{u} = \\mathbf{r} - \\mathbf{R}_i$，这意味着$\\mathbf{r} = \\mathbf{u} + \\mathbf{R}_i$且$d\\mathbf{r} = d\\mathbf{u}$。\n$$\n\\int \\mathbf{r} \\exp\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right) d\\mathbf{r} = \\int (\\mathbf{u} + \\mathbf{R}_i) \\exp\\left(-\\frac{|\\mathbf{u}|^2}{\\sigma_i^2}\\right) d\\mathbf{u}\n$$\n$$\n= \\int \\mathbf{u} \\exp\\left(-\\frac{|\\mathbf{u}|^2}{\\sigma_i^2}\\right) d\\mathbf{u} + \\mathbf{R}_i \\int \\exp\\left(-\\frac{|\\mathbf{u}|^2}{\\sigma_i^2}\\right) d\\mathbf{u}\n$$\n第一个积分$\\int \\mathbf{u} \\exp(-|\\mathbf{u}|^2/\\sigma_i^2) d\\mathbf{u}$为零，因为被积函数是一个在全空间上积分的奇函数。第二个积分是一个标准的三维高斯积分，$\\int \\exp(-|\\mathbf{u}|^2/\\sigma_i^2) d\\mathbf{u} = (\\pi \\sigma_i^2)^{3/2}$。\n因此，分量$i$的积分简化为：\n$$\n\\int \\mathbf{r} \\exp\\left(-\\frac{|\\mathbf{r}-\\mathbf{R}_i|^2}{\\sigma_i^2}\\right) d\\mathbf{r} = \\mathbf{R}_i (\\pi \\sigma_i^2)^{3/2}\n$$\n将其代回到求和式中：\n$$\n\\int \\mathbf{r}\\, n_0(\\mathbf{r})\\, d\\mathbf{r} = \\sum_{i=1}^{2} N_i \\frac{1}{(\\pi \\sigma_i^2)^{3/2}} \\left[ \\mathbf{R}_i (\\pi \\sigma_i^2)^{3/2} \\right] = \\sum_{i=1}^{2} N_i \\mathbf{R}_i\n$$\n现在我们代入给定的数值：\n$N_1 = 6$，$\\mathbf{R}_1 = (0, 0, 1.20) \\, \\mathrm{\\AA}$\n$N_2 = 4$，$\\mathbf{R}_2 = (0, 0, -0.80) \\, \\mathrm{\\AA}$\n\n$$\n\\sum_{i=1}^{2} N_i \\mathbf{R}_i = 6 \\cdot (0, 0, 1.20 \\, \\mathrm{\\AA}) + 4 \\cdot (0, 0, -0.80 \\, \\mathrm{\\AA})\n$$\n$$\n= (0, 0, 7.20 \\, \\mathrm{\\AA}) + (0, 0, -3.20 \\, \\mathrm{\\AA}) = (0, 0, 4.00 \\, \\mathrm{\\AA})\n$$\n电场为$\\mathbf{E} = E\\,\\hat{\\mathbf{z}} = (0, 0, 0.025) \\, \\mathrm{V}/\\mathrm{\\AA}$。\n\n现在我们可以计算一阶能量变化$\\Delta E^{(1)}$：\n$$\n\\Delta E^{(1)} = e \\left( \\sum_{i=1}^{2} N_i \\mathbf{R}_i \\right) \\cdot \\mathbf{E} = e \\left( (0, 0, 4.00 \\, \\mathrm{\\AA}) \\cdot (0, 0, 0.025 \\, \\mathrm{V}/\\mathrm{\\AA}) \\right)\n$$\n$$\n\\Delta E^{(1)} = e \\cdot (4.00 \\times 0.025) \\, (\\mathrm{\\AA} \\cdot \\mathrm{V}/\\mathrm{\\AA}) = e \\cdot 0.100 \\, \\mathrm{V}\n$$\n元电荷$e$与以伏特（V）为单位的电势差的乘积是以电子伏特（eV）为单位的能量。因此：\n$$\n\\Delta E^{(1)} = 0.100 \\, \\mathrm{eV}\n$$\n问题要求答案四舍五入到四位有效数字。为此，我们将输入值视为精确值，结果为$0.1$，我们写为$0.1000$。",
            "answer": "$$\\boxed{0.1000}$$"
        },
        {
            "introduction": "在掌握了基本的能量原理之后，我们将注意力转向一个在电化学中至关重要的体系：金属表面。本练习旨在探讨外加电场如何调节功函数——这是表面科学和电极过程中的一个关键参数。你将通过实现一个简化的 Thomas-Fermi 屏蔽模型，亲身体验金属如何响应并屏蔽外部电场，这是理解电化学界面行为的核心 。",
            "id": "4253242",
            "problem": "在密度泛函理论（DFT）的框架内，考虑一个真空中的金属板的一维平面平均表示。该金属板沿 $z$ 坐标建模，金属区域占据 $z \\in [-t,0]$，真空区域占据 $z \\in [0,L_{\\mathrm{vac}}]$，因此总晶胞长度为 $L_z = t + L_{\\mathrm{vac}}$。通过一个偶极校正的锯齿势，仅在真空区域施加一个均匀的外部电场 $E_{\\mathrm{ext}}$：这会在位于 $z = z_{\\mathrm{dc}} \\in (0,L_{\\mathrm{vac}})$ 的一个平面上引入静电势的有限不连续性，从而满足周期性边界条件并消除金属内部任何伪场。平面平均静电势 $\\phi(z)$ 和电场 $E(z)$ 满足国际单位制（SI）中的标准静电学：\n\n- 真空区域无电荷，因此电势满足 $d^2 \\phi(z)/dz^2 = 0$，且在 $z \\in (0,L_{\\mathrm{vac}})$ 中电场 $E(z) = -\\,d\\phi(z)/dz$ 是均匀的且等于 $E_{\\mathrm{ext}}$。\n- 金属区域由线性 Thomas–Fermi 屏蔽模型描述，其中感应的平面平均电荷密度对于 $z \\in [-t,0]$ 遵循 $\\rho(z) = -\\varepsilon_0\\,\\phi(z)/\\lambda^2$，$\\varepsilon_0$ 是真空介电常数，$\\lambda$ 是金属的 Thomas–Fermi 屏蔽长度。结合泊松方程 $d^2\\phi(z)/dz^2 = -\\rho(z)/\\varepsilon_0$，在金属中得到 $d^2\\phi(z)/dz^2 = \\phi(z)/\\lambda^2$。\n\n假设板厚度 $t$ 远大于 $\\lambda$（因此金属内部无场），并假设电势及其一阶导数在界面 $z=0$ 处是连续的（在此平面平均模型中不施加奇异表面电荷）。真空中的均匀外场与偶极校正势（一个在真空区 $z=z_{\\mathrm{dc}}$ 处具有单一不连续性 $\\Delta \\phi_{\\mathrm{dc}}$ 的锯齿剖面）一同实现，其选择方式使得周期性重复的晶胞在金属内部的净电场为零，同时在我们关心的那一侧的整个真空中保持 $E(z)=E_{\\mathrm{ext}}$。该不连续性确保 $\\phi(z)$ 在周期性边界条件下是单值的，但不会改变 $z=0$ 处的局部边界条件。\n\n将由外加电场 $E_{\\mathrm{ext}}$ 引起的功函数变化 $\\Delta \\Phi$ 定义为金属深处（板内 $z \\to -\\infty$）与表面外的局域真空参考点（$z \\to 0^+$）之间的势阶相对于零场情况的变化。使用平面平均静电学和 Thomas–Fermi 屏蔽模型，通过确定金属的感应静电响应以及在外加电场下 $z=0^+$ 处的最终电势来求得 $\\Delta \\Phi$。以电子伏特（eV）表示 $\\Delta \\Phi$。注意，在此上下文中，对于电势差，$1\\,\\mathrm{eV}$ 在数值上等于 $1\\,\\mathrm{V}$。\n\n您的程序必须实现此模型并为以下参数集测试套件计算 $\\Delta \\Phi$。每个参数集是一个元组 $(E_{\\mathrm{ext}}, \\lambda, t, L_{\\mathrm{vac}}, z_{\\mathrm{dc}})$，其中距离和电场使用SI单位，且 $z_{\\mathrm{dc}}$ 位于真空中：\n\n- 情况1（一般情况）：$E_{\\mathrm{ext}} = 5.0 \\times 10^{9}\\,\\mathrm{V/m}$，$\\lambda = 5.0 \\times 10^{-11}\\,\\mathrm{m}$， $t = 2.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 3.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 2.5 \\times 10^{-9}\\,\\mathrm{m}$。\n- 情况2（零场）：$E_{\\mathrm{ext}} = 0.0\\,\\mathrm{V/m}$，$\\lambda = 5.0 \\times 10^{-11}\\,\\mathrm{m}$， $t = 2.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 3.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 2.5 \\times 10^{-9}\\,\\mathrm{m}$。\n- 情况3（强场，极短屏蔽）：$E_{\\mathrm{ext}} = 1.0 \\times 10^{10}\\,\\mathrm{V/m}$，$\\lambda = 1.0 \\times 10^{-12}\\,\\mathrm{m}$， $t = 5.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 3.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 2.0 \\times 10^{-9}\\,\\mathrm{m}$。\n- 情况4（反向场）：$E_{\\mathrm{ext}} = -2.0 \\times 10^{9}\\,\\mathrm{V/m}$，$\\lambda = 1.0 \\times 10^{-10}\\,\\mathrm{m}$， $t = 5.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 5.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 3.0 \\times 10^{-9}\\,\\mathrm{m}$。\n- 情况5（不同真空长度 A）：$E_{\\mathrm{ext}} = 3.0 \\times 10^{9}\\,\\mathrm{V/m}$，$\\lambda = 3.0 \\times 10^{-11}\\,\\mathrm{m}$， $t = 4.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 2.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 1.0 \\times 10^{-9}\\,\\mathrm{m}$。\n- 情况6（不同真空长度 B）：$E_{\\mathrm{ext}} = 3.0 \\times 10^{9}\\,\\mathrm{V/m}$，$\\lambda = 3.0 \\times 10^{-11}\\,\\mathrm{m}$， $t = 4.0 \\times 10^{-9}\\,\\mathrm{m}$， $L_{\\mathrm{vac}} = 8.0 \\times 10^{-9}\\,\\mathrm{m}$， $z_{\\mathrm{dc}} = 4.0 \\times 10^{-9}\\,\\mathrm{m}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\Delta \\Phi_1,\\Delta \\Phi_2,\\dots]$）的结果，其中每个条目是对应于相应测试用例计算出的功函数变化的浮点数，单位为 $\\mathrm{eV}$。",
            "solution": "该问题要求计算在外部电场作用下金属板的功函数变化 $\\Delta \\Phi$。该量定义为金属深处与金属表面外的真空区域之间的静电势差相对于零场情况的变化。该分析基于一维平面平均静电模型。\n\n首先，我们在问题定义的两个区域中求解静电势 $\\phi(z)$：金属板区域 $z \\in [-t, 0]$ 和真空区域 $z \\in [0, L_{\\mathrm{vac}}]$。\n\n在金属区域（$z \\in [-t, 0]$），电势由 Thomas-Fermi 屏蔽模型描述。其控制性微分方程为：\n$$\n\\frac{d^2\\phi(z)}{dz^2} = \\frac{\\phi(z)}{\\lambda^2}\n$$\n其中 $\\lambda$ 是 Thomas-Fermi 屏蔽长度。这个二阶线性齐次微分方程的通解是：\n$$\n\\phi_m(z) = A e^{z/\\lambda} + B e^{-z/\\lambda}\n$$\n其中 $A$ 和 $B$ 是常数。问题陈述中提到，板厚度 $t$ 远大于 $\\lambda$，并且金属内部是无场的。这意味着远离表面（当 $z \\to -\\infty$ 时），电势扰动和电场必须衰减到零。为了满足这一物理条件，必须排除在 $z \\to -\\infty$ 时发散的 $e^{-z/\\lambda}$ 项。因此，我们将其系数 $B=0$。这样，金属内部的电势由下式给出：\n$$\n\\phi_m(z) = A e^{z/\\lambda}\n$$\n这种形式确保了电势 $\\phi_m(z)$ 和相关的电场 $E_m(z) = -d\\phi_m/dz = -(A/\\lambda)e^{z/\\lambda}$ 在金属深处正确地趋近于零。我们选择电势参考点，使得 $\\phi_m(z \\to -\\infty) = 0$。\n\n在真空区域（$z \\in [0, L_{\\mathrm{vac}}]$），空间是无电荷的。问题陈述中提到，施加了一个均匀电场 $E(z) = E_{\\mathrm{ext}}$。电场和静电势之间的关系是 $E(z) = -d\\phi(z)/dz$。这给出了微分方程：\n$$\n\\frac{d\\phi_v(z)}{dz} = -E_{\\mathrm{ext}}\n$$\n对 $z$ 积分，得到真空中的电势：\n$$\n\\phi_v(z) = -E_{\\mathrm{ext}} z + C\n$$\n其中 $C$ 是另一个积分常数。\n\n接下来，我们应用在金属-真空界面 $z=0$ 处的边界条件。问题规定电势 $\\phi(z)$ 及其一阶导数 $d\\phi(z)/dz$ 在此界面是连续的。\n1.  电势连续性：$\\phi_m(0) = \\phi_v(0)$。\n    $$\n    A e^{0/\\lambda} = -E_{\\mathrm{ext}}(0) + C \\implies A = C\n    $$\n2.  一阶导数连续性：$\\phi_m'(0) = \\phi_v'(0)$。\n    导数分别为 $\\phi_m'(z) = (A/\\lambda)e^{z/\\lambda}$ 和 $\\phi_v'(z) = -E_{\\mathrm{ext}}$。在 $z=0$ 处：\n    $$\n    \\frac{A}{\\lambda} e^{0/\\lambda} = -E_{\\mathrm{ext}} \\implies \\frac{A}{\\lambda} = -E_{\\mathrm{ext}}\n    $$\n从第二个条件，我们解出常数 $A$：\n$$\nA = -E_{\\mathrm{ext}} \\lambda\n$$\n因为 $A=C$，我们也有 $C = -E_{\\mathrm{ext}} \\lambda$。\n\n现在我们得到了两个区域中电势的完整表达式：\n-   金属（$z \\in [-t, 0]$）：$\\phi_m(z) = -E_{\\mathrm{ext}} \\lambda e^{z/\\lambda}$\n-   真空（$z \\in [0, L_{\\mathrm{vac}}]$）：$\\phi_v(z) = -E_{\\mathrm{ext}} z - E_{\\mathrm{ext}} \\lambda = -E_{\\mathrm{ext}}(z+\\lambda)$\n\n功函数变化 $\\Delta \\Phi$ 定义为金属深处与表面外的局域真空之间的势阶相对于零场情况的变化。设此势阶为 $\\delta\\phi = \\phi(0^+) - \\phi(-t)$，其中我们使用 $z=-t$ 作为深处的近似，这在 $t \\gg \\lambda$ 时是有效的。\n-   真空界面处的电势（$z=0^+$）：$\\phi(0^+) = \\phi_v(0) = -E_{\\mathrm{ext}}\\lambda$。\n-   金属深处的电势（$z=-t$）：$\\phi(-t) = \\phi_m(-t) = -E_{\\mathrm{ext}} \\lambda e^{-t/\\lambda}$。\n\n对于给定的电场 $E_{\\mathrm{ext}}$，势阶为：\n$$\n\\delta\\phi(E_{\\mathrm{ext}}) = \\phi(0^+) - \\phi(-t) = (-E_{\\mathrm{ext}}\\lambda) - (-E_{\\mathrm{ext}}\\lambda e^{-t/\\lambda}) = -E_{\\mathrm{ext}}\\lambda(1 - e^{-t/\\lambda})\n$$\n对于零场情况，$E_{\\mathrm{ext}} = 0$，势阶 $\\delta\\phi(0)$ 为 $0$。\n功函数变化是这两种情况之间的差异：\n$$\n\\Delta \\Phi = \\delta\\phi(E_{\\mathrm{ext}}) - \\delta\\phi(0) = -E_{\\mathrm{ext}}\\lambda(1 - e^{-t/\\lambda})\n$$\n问题要求以电子伏特（eV）为单位的 $\\Delta \\Phi$。由于计算出的电势差以伏特（V）为单位，并且 $1\\,\\mathrm{eV}$ 在数值上对应于 $1\\,\\mathrm{V}$ 的电势差，因此 $\\Delta \\Phi$ 以伏特为单位的数值就是以 eV 为单位的答案。\n\n这个推导出的表达式仅取决于 $E_{\\mathrm{ext}}$、$\\lambda$ 和 $t$。描述真空区域设置的参数（$L_{\\mathrm{vac}}$ 和 $z_{\\mathrm{dc}}$）是描述如何在 DFT 中执行数值稳定的周期性计算的一部分，但对于确定表面的局部静电响应（这决定了功函数的变化）而言并非必需。因此，它们没有出现在最终的公式中。对于所有给定的测试用例，条件 $t \\gg \\lambda$ 都成立，使得 $e^{-t/\\lambda}$ 项非常小。该公式可以精确地近似为 $\\Delta \\Phi \\approx -E_{\\mathrm{ext}}\\lambda$，但为了最高精度，我们将使用完整表达式。正电场 $E_{\\mathrm{ext}}$（指向远离表面）导致负的 $\\Delta\\Phi$，表示功函数减小，这在物理上是正确的。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the change in work function for a metal slab in an electric field,\n    based on a planar-averaged Thomas-Fermi screening model.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple (E_ext, lambda, t, L_vac, z_dc) in SI units.\n    # E_ext: V/m, lambda: m, t: m, L_vac: m, z_dc: m.\n    test_cases = [\n        # Case 1 (general case)\n        (5.0e9, 5.0e-11, 2.0e-9, 3.0e-9, 2.5e-9),\n        # Case 2 (zero field)\n        (0.0, 5.0e-11, 2.0e-9, 3.0e-9, 2.5e-9),\n        # Case 3 (strong field, very short screening)\n        (1.0e10, 1.0e-12, 5.0e-9, 3.0e-9, 2.0e-9),\n        # Case 4 (reversed field)\n        (-2.0e9, 1.0e-10, 5.0e-9, 5.0e-9, 3.0e-9),\n        # Case 5 (different vacuum length A)\n        (3.0e9, 3.0e-11, 4.0e-9, 2.0e-9, 1.0e-9),\n        # Case 6 (different vacuum length B)\n        (3.0e9, 3.0e-11, 4.0e-9, 8.0e-9, 4.0e-9),\n    ]\n\n    results = []\n    for case in test_cases:\n        E_ext, lam, t, L_vac, z_dc = case\n        \n        # The change in work function (Delta Phi) is given by the formula:\n        # Delta_Phi = -E_ext * lambda * (1 - exp(-t / lambda))\n        # The result in Volts is numerically equal to the result in electron-volts (eV).\n        # The parameters L_vac and z_dc are not needed for this specific calculation.\n        \n        # Handle cases to avoid division by zero, although not present in test data.\n        if lam == 0:\n            # A perfect conductor (lambda=0) would have perfect screening,\n            # meaning the potential change inside is zero instantly.\n            # The field does not penetrate, so the work function change as defined is zero.\n            delta_phi = 0.0\n        else:\n            # For t >> lambda, exp(-t/lambda) -> 0, so Delta_Phi approximates -E_ext * lambda.\n            # We use the full formula for precision.\n            ratio = t / lam\n            delta_phi = -E_ext * lam * (1.0 - np.exp(-ratio))\n        \n        results.append(delta_phi)\n\n    # The final print statement must produce a single-line format: [res1,res2,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的 DFT 计算中，尤其是在模拟电化学体系时，通常会采用周期性边界条件。然而，当模拟带电物质或施加外电场时，这种设置会引入非物理的人为相互作用。本练习直面这一关键的实际挑战，要求你实现并测试标准的有限尺寸校正方案（如 Makov–Payne 校正）。掌握这项实践对于从模拟中获得精确可靠的结果至关重要，它填补了理论模型与稳健计算预测之间的鸿沟 。",
            "id": "4253299",
            "problem": "考虑在密度泛函理论 (DFT) 中，对均匀外电场下的带电原胞和平板几何结构进行建模时，如何量化和校正由此产生的有限尺寸效应。在周期性边界条件下，电荷分布的静电能会与其周期性镜像相互作用，从而导致一个与尺寸相关的误差。对于线性尺寸为 $L$、体积为 $V = A L$（其中 $A$ 为横截面积）的立方超胞，一个经过充分检验的渐近描述，用于描述净电荷为 $q$、沿电场方向的偶极矩分量为 $p_z$、四极矩迹为 $Q$ 的带电缺陷的镜像相互作用，可以从基于 Ewald 求和的静电能展开式中获得。这产生了随 $1/L$ 和 $1/L^3$ 变化的领头阶修正。在均匀外电场 $E_z$ 下的平板几何结构中，对于平面外偶极矩 $p_z$ 也存在一个镜像相互作用项，其大小与 $1/(A L)$ 成正比，该项可以通过在真空区域引入一个平面偶极层来抵消。该问题的基本依据是静电学的泊松方程和用于周期性镜像的晶格求和的 Ewald 表示法。\n\n设 $k_c$ 表示以电子伏特-埃/基本电荷平方为单位的库仑常数，$k_c = 14.399645$。设 $\\alpha_M$ 为简单立方晶格的马德隆常数，$\\alpha_M = 2.837297$。设 $\\varepsilon$ 为一个无量纲介电常数，用于模拟介质的屏蔽响应。均匀外场与偶极子的耦合能量为 $- p_z E_z$。在渐近极限下，周期性重复超胞的总能量可以通过以下模型来描述\n$$\nE_L = E_0 - p_z E_z + \\frac{k_c \\alpha_M}{2 \\varepsilon} \\frac{q^2}{L} + \\frac{2 \\pi k_c}{3 \\varepsilon} \\frac{Q}{L^3} + \\frac{2 \\pi k_c}{\\varepsilon} \\frac{p_z^2}{A L} + \\frac{r}{L^5},\n$$\n其中 $E_0$ 是存在外场时孤立系统的能量，$r/L^5$ 代表一个被忽略的微小高阶余项。Makov–Payne (MP) 修正消除了 $\\sim 1/L$ 和 $\\sim 1/L^3$ 的带电缺陷项。偶极层 (DL) 技术消除了平板几何中 $\\sim 1/(A L)$ 的偶极镜像相互作用。当电荷和板坯偶极子同时存在时，组合修正会减去所有三个有限尺寸效应项。能量必须以电子伏特 ($\\mathrm{eV}$) 表示，长度以埃 ($\\mathrm{\\AA}$) 表示，电场以伏特/埃 ($\\mathrm{V/\\AA}$) 表示。角度不出现；不需要角度单位。\n\n您的任务是实现一个程序，该程序针对一组给定的物理上合理的参数集测试套件，根据上述模型构建合成的周期性原胞能量 $E_L$，应用适当的修正方案（Makov–Payne、偶极层或组合修正），评估在不同 $L$ 值下的收敛性，并报告估算的孤立系统能量 $E_0 - p_z E_z$ 以及一个布尔类型的收敛标志。收敛性定义为：在测试的所有 $L$ 值中，修正后能量的最大绝对偏差小于容差 $\\tau = 0.0005 \\ \\mathrm{eV}$。\n\n使用以下测试套件：\n\n- 案例 1（带电体相原胞；Makov–Payne 修正）：$q = 1$, $p_z = 0$, $Q = 5$, $\\varepsilon = 10$, $E_z = 0$, $A$ 未使用, $E_0 = 1.25$, $r = 0.05$, $L \\in \\{10, 12, 16, 20\\}$。\n- 案例 2（电场下的中性板坯；偶极层修正）：$q = 0$, $p_z = 10$, $Q = 0$, $\\varepsilon = 1$, $E_z = 0.2$, $A = 100$, $E_0 = 5.0$, $r = 0.05$, $L \\in \\{30, 40, 60\\}$。\n- 案例 3（电场下的带电板坯；组合修正）：$q = 1$, $p_z = 5$, $Q = 2$, $\\varepsilon = 5$, $E_z = 0.1$, $A = 80$, $E_0 = 2.0$, $r = 0.05$, $L \\in \\{20, 30, 40\\}$。\n\n科学真实性约束：\n- 参数 $q$、$p_z$ 和 $Q$ 分别以 $e$、$e \\cdot \\mathrm{\\AA}$ 和 $e \\cdot \\mathrm{\\AA}^2$ 为单位定义。\n- 所选的 $\\varepsilon$、$A$ 和 $L$ 值产生的能量在典型 DFT 尺度内是非病态的。\n- 外场耦合使用了 $1 \\ e \\cdot 1 \\ \\mathrm{V} = 1 \\ \\mathrm{eV}$ 的恒等式，因此当 $p_z$ 单位为 $e \\cdot \\mathrm{\\AA}$ 且 $E_z$ 单位为 $\\mathrm{V/\\AA}$ 时，$p_z E_z$ 的单位为 $\\mathrm{eV}$。\n\n对于每个案例，执行以下步骤：\n- 使用提供的参数和上述模型，为每个 $L$ 构建 $E_L$。\n- 应用适当的修正：\n  - Makov–Payne：减去 $\\frac{k_c \\alpha_M}{2 \\varepsilon} \\frac{q^2}{L} + \\frac{2 \\pi k_c}{3 \\varepsilon} \\frac{Q}{L^3}$。\n  - 偶极层：减去 $\\frac{2 \\pi k_c}{\\varepsilon} \\frac{p_z^2}{A L}$。\n  - 组合：减去所有三个有限尺寸效应项。\n- 计算一组 $L$ 值对应的修正后能量、它们的平均值以及与平均值的最大绝对偏差；如果此偏差小于 $\\tau$，则将收敛标志设为 true；否则，设为 false。\n- 将修正后能量的平均值作为 $E_0 - p_z E_z$ 的估计值（单位为 $\\mathrm{eV}$，四舍五入到六位小数）与布尔收敛标志一同报告。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。六个条目必须按以下顺序排列：\n$[\\text{E1}, \\text{B1}, \\text{E2}, \\text{B2}, \\text{E3}, \\text{B3}]$，\n其中 $\\text{E1}$、$\\text{E2}$ 和 $\\text{E3}$ 分别是案例 1、2 和 3 的估计孤立系统能量（均为浮点数，单位 $\\mathrm{eV}$，四舍五入到六位小数），$\\text{B1}$、$\\text{B2}$ 和 $\\text{B3}$ 是相应的布尔收敛标志。",
            "solution": "问题陈述经评估有效。其科学依据源于计算材料科学中有限尺寸修正的标准理论框架，尤其是在密度泛函理论 (DFT) 领域。所提供的能量模型是一个著名的渐近展开式，它源自周期性静电相互作用的 Ewald 求和。所给参数和测试案例在物理上是合理的且定义明确，任务在计算上是清晰的，并且没有内部矛盾或含糊之处。\n\n该任务是为周期性边界条件下带电和/或极性系统的 DFT 模拟中产生的效应实现并测试修正方案。在线性尺寸为 $L$ 的模拟超胞中，系统的总能量 $E_L$ 会因与系统周期性镜像的虚假静电相互作用而偏离孤立系统的能量 $E_\\infty$。问题为此偏差提供了一个定量模型：\n$$\nE_L = E_0 - p_z E_z + \\frac{k_c \\alpha_M}{2 \\varepsilon} \\frac{q^2}{L} + \\frac{2 \\pi k_c}{3 \\varepsilon} \\frac{Q}{L^3} + \\frac{2 \\pi k_c}{\\varepsilon} \\frac{p_z^2}{A L} + \\frac{r}{L^5}\n$$\n在此模型中，$E_0$ 代表零外场下孤立系统的能量。$-p_z E_z$ 项是偶极矩 $p_z$ 与均匀外场 $E_z$ 之间的标准静电相互作用能。我们感兴趣的量是电场下孤立系统的总能量，我们将其表示为 $E_\\text{iso} = E_0 - p_z E_z$。随后的项，即随 $L^{-1}$、$L^{-3}$ 和 $(AL)^{-1}$ 变化的项，是领头阶的有限尺寸效应。此处，$q$ 是净电荷，$Q$ 是四极矩的迹，$\\varepsilon$ 是介质的介电常数，$A$ 是平板的横截面积。常数 $k_c$ 和 $\\alpha_M$ 分别是库仑常数（$k_c = 14.399645 \\ \\mathrm{eV \\cdot \\AA / e^2}$）和简单立方晶格的马德隆常数（$\\alpha_M = 2.837297$）。最后一项 $r/L^5$ 模拟了剩余的高阶误差。\n\n该解决方案对每个测试案例遵循三步程序：\n\n1.  **合成总能量**：我们首先充当模拟数据的来源。对于一组给定的物理参数（$q, p_z, Q, \\dots$）和一系列超胞尺寸 $L$，我们使用提供的模型计算“原始”总能量 $E_L$。这模拟了一系列在不同原胞尺寸下执行的 DFT 计算的输出。\n\n2.  **应用有限尺寸修正**：然后，我们通过对每个 $E_L$ 应用指定的修正方案来处理这些合成数据。修正后的能量 $E_L^\\text{corr}$ 是通过减去已知的解析形式的效应项得到的。具体方案取决于系统的物理性质：\n    -   **Makov–Payne (MP) 修正**：对于带电缺陷，它减去单极-单极和单极-四极相互作用项。\n        $$ E_L^\\text{corr, MP} = E_L - \\left( \\frac{k_c \\alpha_M}{2 \\varepsilon} \\frac{q^2}{L} + \\frac{2 \\pi k_c}{3 \\varepsilon} \\frac{Q}{L^3} \\right) $$\n    -   **偶极层 (DL) 修正**：对于中性极性板坯，它减去虚假的板坯间偶极-偶极相互作用项。\n        $$ E_L^\\text{corr, DL} = E_L - \\left( \\frac{2 \\pi k_c}{\\varepsilon} \\frac{p_z^2}{A L} \\right) $$\n    -   **组合修正**：对于带电极性板坯，所有三个领头阶效应都被移除。\n        $$ E_L^\\text{corr, Combined} = E_L - \\left( \\frac{k_c \\alpha_M}{2 \\varepsilon} \\frac{q^2}{L} + \\frac{2 \\pi k_c}{3 \\varepsilon} \\frac{Q}{L^3} + \\frac{2 \\pi k_c}{\\varepsilon} \\frac{p_z^2}{A L} \\right) $$\n    根据合成能量模型的结构，所有情况下的修正能量简化为：\n    $$ E_L^\\text{corr} = E_\\text{iso} + \\frac{r}{L^5} $$\n    该表达式表明，随着原胞尺寸 $L$ 的增加，修正后的能量 $E_L^\\text{corr}$ 会收敛于真实的孤立系统能量 $E_\\text{iso}$。\n\n3.  **分析收敛性并估算能量**：对于与不同 $L$ 值对应的一组修正能量 $\\{E_L^\\text{corr}\\}$，我们分析它们的收敛性以估算 $E_\\text{iso}$。孤立系统能量的最佳估计值，表示为 $E_\\text{est}$，是这些修正能量的算术平均值：\n    $$ E_\\text{est} = \\frac{1}{N} \\sum_{i=1}^{N} E_{L_i}^\\text{corr} $$\n    收敛性通过计算修正能量与该平均值的最大绝对偏差来评估。如果此偏差小于指定的容差 $\\tau = 0.0005 \\ \\mathrm{eV}$，则认为计算收敛。\n    $$ \\max_{i} |E_{L_i}^\\text{corr} - E_\\text{est}|  \\tau $$\n该算法在一个 Python 脚本中实现。它通过生成合成能量、应用指定的修正并执行收敛性分析来系统地处理每个测试案例。最终输出是一个合并列表，包含每个案例的估计能量（四舍五入到六位小数）和布尔收敛标志。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates and corrects finite-size artifacts in synthetic DFT energy data\n    for charged and/or dipolar systems under periodic boundary conditions.\n    \"\"\"\n    \n    # Define physical and numerical constants\n    k_c = 14.399645      # Coulomb constant in eV * Angstrom / e^2\n    alpha_M = 2.837297   # Madelung constant for simple cubic lattice\n    tau = 0.0005         # Convergence tolerance in eV\n\n    # Define the test suite from the problem statement\n    test_cases = [\n        {\n            # Case 1: Charged bulk cell (Makov-Payne correction)\n            \"params\": {'q': 1, 'p_z': 0, 'Q': 5, 'epsilon': 10, 'E_z': 0, 'A': None, 'E_0': 1.25, 'r': 0.05},\n            \"L_values\": [10, 12, 16, 20],\n            \"correction_type\": \"mp\"\n        },\n        {\n            # Case 2: Neutral slab under field (Dipole-layer correction)\n            \"params\": {'q': 0, 'p_z': 10, 'Q': 0, 'epsilon': 1, 'E_z': 0.2, 'A': 100, 'E_0': 5.0, 'r': 0.05},\n            \"L_values\": [30, 40, 60],\n            \"correction_type\": \"dl\"\n        },\n        {\n            # Case 3: Charged slab under field (Combined correction)\n            \"params\": {'q': 1, 'p_z': 5, 'Q': 2, 'epsilon': 5, 'E_z': 0.1, 'A': 80, 'E_0': 2.0, 'r': 0.05},\n            \"L_values\": [20, 30, 40],\n            \"correction_type\": \"combined\"\n        }\n    ]\n\n    final_results = []\n\n    for case in test_cases:\n        params = case[\"params\"]\n        q = params['q']\n        p_z = params['p_z']\n        Q = params['Q']\n        epsilon = params['epsilon']\n        E_z = params['E_z']\n        A = params['A']\n        E_0 = params['E_0']\n        r = params['r']\n        \n        corrected_energies = []\n        \n        # Determine the true isolated system energy under the external field\n        E_iso = E_0 - p_z * E_z\n        \n        for L in case[\"L_values\"]:\n            # Step 1: Calculate individual artifact terms\n            # Makov-Payne charge term\n            term_charge = (k_c * alpha_M / (2 * epsilon)) * (q**2 / L)\n            # Makov-Payne quadrupole term\n            term_quadrupole = (2 * np.pi * k_c / (3 * epsilon)) * (Q / L**3)\n            \n            # Dipole-layer term (only relevant if p_z is non-zero and A is specified)\n            term_dipole = 0\n            if p_z != 0 and A is not None:\n                term_dipole = (2 * np.pi * k_c / epsilon) * (p_z**2 / (A * L))\n\n            # Higher-order remainder term\n            term_remainder = r / L**5\n            \n            # Step 2: Construct the synthetic total energy E_L\n            E_L = E_iso + term_charge + term_quadrupole + term_dipole + term_remainder\n\n            # Step 3: Apply the appropriate correction to obtain E_L_corr\n            correction_to_apply = 0.0\n            if case[\"correction_type\"] == \"mp\":\n                correction_to_apply = term_charge + term_quadrupole\n            elif case[\"correction_type\"] == \"dl\":\n                correction_to_apply = term_dipole\n            elif case[\"correction_type\"] == \"combined\":\n                correction_to_apply = term_charge + term_quadrupole + term_dipole\n            \n            E_L_corr = E_L - correction_to_apply\n            corrected_energies.append(E_L_corr)\n        \n        # Step 4: Analyze convergence and estimate the isolated energy\n        corrected_energies_np = np.array(corrected_energies)\n        \n        # The estimate is the mean of the corrected energies\n        estimated_energy = np.mean(corrected_energies_np)\n        \n        # The convergence check is based on the maximum absolute deviation from the mean\n        max_deviation = np.max(np.abs(corrected_energies_np - estimated_energy))\n        is_converged = max_deviation  tau\n        \n        # Step 5: Store results rounded as specified\n        final_results.append(round(estimated_energy, 6))\n        final_results.append(is_converged)\n\n    # Print the final output in the exact required format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}