{
    "hands_on_practices": [
        {
            "introduction": "理论的理解最好通过实践来巩固。本练习将通过一个直接的计算比较，揭示数值格式选择对质量守恒的深远影响。您将亲手实现一个保守格式和一个非保守格式，并量化它们在平流输运问题中截然不同的表现，从而直观地理解为何在物理模拟中，忠实于守恒定律的通量-散度形式至关重要。",
            "id": "4082100",
            "problem": "考虑一个长度为 $L$ 的一维周期性域，其空间坐标为 $x \\in [0,L)$。一个标量密度场 $\\rho(x,t)$ 被一个给定的、不随时间变化的速度场 $u(x)$ 平流输运，其过程遵循连续性方程（质量守恒）\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u) = 0,\n$$\n并采用周期性边界条件。所有量均为无量纲量，无需物理单位。\n\n您的任务是通过计算示例来证明，使用非守恒格式对密度进行平流计算会导致总质量的人为损失（或增加），并测量此质量误差如何随网格加密而缩放。请使用以下在数学和计算上都适定的设置：\n\n- 域长度 $L = 1$。\n- 速度场 $u(x) = \\tfrac{1}{2} + \\tfrac{1}{2}\\sin(2\\pi x)$，该场严格为正且空间变化。\n- 初始密度\n$$\n\\rho(x,0) = 1 + 0.3\\sin(2\\pi x) + 0.8\\exp\\!\\left(-\\frac{(x-0.3)^2}{0.01}\\right),\n$$\n该密度严格为正且平滑。\n- 总模拟时间 $T = 1$。\n- Courant–Friedrichs–Lewy (CFL) 数为 $\\mathrm{CFL} = 0.4$，用于选择名义时间步长 $\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_x u(x)$，其中 $\\Delta x = L/N$，$N$ 是网格点数。重复使用 $\\Delta t$ 进行尽可能多的完整步数以填充时间 $T$，然后用剩余时间走最后一步，以精确达到总时间 $T$。\n\n在一个具有 $N$ 个点的均匀网格上，使用周期性边界条件，实现并比较两种时间步进格式：\n\n1. 一种非守恒的半拉格朗日点式平流格式，在固定的欧拉网格上使用一阶回溯和线性插值。对每个网格点 $x_i$，计算回溯足点 $x_i^{\\star} = x_i - u(x_i)\\,\\Delta t$（周期性环绕），然后通过在 $x_i^{\\star}$ 处对 $\\rho^n$ 进行线性插值来更新 $\\rho_i^{n+1}$。\n\n2. 一种以通量-散度形式表示的守恒有限体积迎风通量格式。将单元面 $x_{i+1/2}$ 处的通量离散化为 $F_{i+1/2} = u(x_{i+1/2})\\,\\rho_i$（当 $u(x_{i+1/2}) > 0$ 时，本例中此条件成立），并通过通量差更新单元平均值 $\\rho_i^{n+1} = \\rho_i^n - (\\Delta t/\\Delta x)\\left(F_{i+1/2} - F_{i-1/2}\\right)$。\n\n对于每个 $N$，计算初始总质量 $M_0 = \\int_0^L \\rho(x,0)\\,dx$（用黎曼和 $M_0 \\approx \\sum_i \\rho_i^0\\,\\Delta x$ 近似），以及由非守恒和守恒格式分别产生的最终总质量 $M_{\\mathrm{nc}}(T)$ 和 $M_{\\mathrm{cons}}(T)$。将每种格式的相对质量误差定义为 $e_{\\mathrm{nc}} = \\lvert M_{\\mathrm{nc}}(T) - M_0 \\rvert / M_0$ 和 $e_{\\mathrm{cons}} = \\lvert M_{\\mathrm{cons}}(T) - M_0 \\rvert / M_0$，以小数形式表示。\n\n测试套件：\n- 使用网格尺寸 $N \\in \\{50, 100, 200, 400, 800\\}$。\n- 对每个 $N$，计算 $e_{\\mathrm{nc}}$ 和 $e_{\\mathrm{cons}}$。\n- 对于非守恒格式，通过在整个测试套件中对 $\\log(e_{\\mathrm{nc}})$ 与 $\\log(\\Delta x)$ 的关系进行直线拟合，来估计经验误差缩放指数 $q$，使得 $e_{\\mathrm{nc}} \\approx C\\,(\\Delta x)^q$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$\n[ e_{\\mathrm{nc}}(N{=}50), e_{\\mathrm{nc}}(N{=}100), e_{\\mathrm{nc}}(N{=}200), e_{\\mathrm{nc}}(N{=}400), e_{\\mathrm{nc}}(N{=}800), q, \\max\\{ e_{\\mathrm{cons}}(N) : N \\in \\{50,100,200,400,800\\} \\} ].\n$$\n所有条目必须是十进制数（浮点数）。此单行输出是程序唯一要求的输出。",
            "solution": "该问题要求通过计算来证明，对于一维连续性方程，非守恒数值格式会导致质量不守恒，而守恒格式则具有质量守恒的特性。我们将实现并比较两种指定的格式，计算在一系列网格分辨率下的质量守恒误差，并确定非守恒格式的误差随网格间距的经验缩放规律。\n\n控制方程是一维连续性方程，它表示标量 $\\rho$（密度）被速度场 $u$ 输运时的守恒性：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u) = 0\n$$\n这被称为守恒形式，因为空间导数作用于通量 $F = \\rho u$。这种形式的一个关键特性是，在封闭或周期性域中，总质量 $M = \\int \\rho \\, dx$ 不随时间变化。这可以通过在域 $[0,L]$ 上对该方程积分看出：\n$$\n\\frac{dM}{dt} = \\frac{d}{dt}\\int_0^L \\rho \\, dx = -\\int_0^L \\frac{\\partial}{\\partial x}(\\rho u) \\, dx = -[\\rho u]_0^L = 0\n$$\n由于周期性边界条件 $\\rho(0,t)u(0) = \\rho(L,t)u(L)$，最后的等式成立。直接离散化这种通量-散度形式的数值格式被称为“守恒格式”，它应能在机器精度范围内保持离散总质量。\n\n使用乘法法则，连续性方程可以改写为非守恒或平流形式：\n$$\n\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0\n$$\n当速度场 $u(x)$ 空间变化时，那些近似于简化版本（如简单平流方程 $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} = 0$）的数值格式被称为“非守恒”格式。这些格式未能考虑 $\\rho \\frac{\\partial u}{\\partial x}$ 项，该项表示由于速度场的汇聚或发散引起的密度变化。这种忽略会导致人为的质量源或汇，使总质量随时间漂移。\n\n我们将在一个有 $N$ 个点的均匀网格上建立一个数值实验，其空间分辨率为 $\\Delta x = L/N$，单元中心坐标为 $x_i = i \\Delta x$（$i=0, \\dots, N-1$）。时间步长 $\\Delta t$ 由 CFL 条件确定，$\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / \\max_x |u(x)|$。当 $L=1$，$\\mathrm{CFL}=0.4$，$u(x) = \\frac{1}{2} + \\frac{1}{2}\\sin(2\\pi x)$ 时，我们发现 $\\max_x u(x) = 1$，因此 $\\Delta t = 0.4 \\Delta x$。总模拟时间 $T=1$ 由一系列时间步长覆盖。\n\n**1. 非守恒半拉格朗日格式**\n该方法基于流体运动的拉格朗日观点。方程 $\\frac{D\\rho}{Dt} = \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} = 0$ 意味着 $\\rho$ 沿着由 $\\frac{dx}{dt} = u$ 定义的特征线是恒定的。为了将固定欧拉网格点 $x_i$ 上的密度从时间 $t^n$ 更新到 $t^{n+1} = t^n + \\Delta t$，我们沿特征线向后追溯，找到在时间 $t^n$ 的出发点 $x_i^\\star$。一阶近似给出：\n$$\nx_i^\\star = x_i - u(x_i) \\Delta t\n$$\n$x_i$ 处的新密度就是出发点处的密度，即 $\\rho_i^{n+1} = \\rho^n(x_i^\\star)$。由于 $x_i^\\star$ 通常不会与网格点重合，因此必须通过对已知的 $\\rho^n$ 网格值进行插值来找到该值。问题指定了线性插值。通过找到将周期性环绕坐标 $x_i^\\star$ 括起来的两个网格点 $x_j$ 和 $x_{j+1}$，并在 $\\rho_j^n$ 和 $\\rho_{j+1}^n$ 之间进行线性插值来计算 $\\rho_i^{n+1}$ 的值。这个插值步骤不保证总质量守恒，这些小误差的累积会导致总质量随时间产生显著的漂移。\n\n**2. 守恒有限体积迎风格式**\n该格式从每个网格单元（控制体）$[x_{i-1/2}, x_{i+1/2}]$ 上的守恒律积分形式开始，其中 $x_{i\\pm1/2} = x_i \\pm \\Delta x/2$。\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho \\, dx = (\\rho u)|_{x_{i-1/2}} - (\\rho u)|_{x_{i+1/2}}\n$$\n近似单元平均密度 $\\rho_i \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho \\, dx$ 并使用前向欧拉时间步长，我们得到离散化的通量-散度形式：\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\n其中 $F_{i\\pm1/2}$ 是单元面上的数值通量。对于一阶迎风格式，通量由“迎风”单元的状态确定。由于给定的速度场对所有 $x$ 都有 $u(x) \\geq 0$，流动方向总是从左到右（或静止）。因此，任何面上的状态都由其左侧的单元决定：\n$$\nF_{i+1/2} = u(x_{i+1/2}) \\rho_i^n\n$$\n当我们将更新规则对所有单元 $i=0, \\dots, N-1$ 求和时，通量差形成一个伸缩求和：$\\\\sum_i (F_{i+1/2} - F_{i-1/2})$。由于周期性（$F_{-1/2} = F_{N-1/2}$），该和正好为零。因此，$\\\\sum_i \\rho_i^{n+1} = \\\\sum_i \\rho_i^n$，离散总质量 $M = \\sum_i \\rho_i \\Delta x$ 在浮点运算的精度范围内是守恒的。\n\n**3. 误差分析**\n对于每个网格尺寸 $N$，我们计算初始质量 $M_0 = \\sum_i \\rho(x_i, 0) \\Delta x$ 和最终质量 $M_{\\mathrm{nc}}(T)$ 和 $M_{\\mathrm{cons}}(T)$。计算相对质量误差 $e_{\\mathrm{nc}} = |M_{\\mathrm{nc}}(T) - M_0| / M_0$ 和 $e_{\\mathrm{cons}} = |M_{\\mathrm{cons}}(T) - M_0| / M_0$。我们预计 $e_{\\mathrm{cons}}$ 将接近机器精度，而 $e_{\\mathrm{nc}}$ 将是显著的，并应随着网格的加密而减小。\n为了找到非守恒格式质量误差的经验收敛阶 $q$，我们假设存在一个幂律关系 $e_{\\mathrm{nc}} \\approx C (\\Delta x)^q$，其中 $C$ 是一个常数。取对数得到一个线性关系：\n$$\n\\log(e_{\\mathrm{nc}}) \\approx \\log(C) + q \\log(\\Delta x)\n$$\n通过对给定的一系列网格尺寸 $N$ 所计算出的 $\\log(e_{\\mathrm{nc}})$ 与 $\\log(\\Delta x)$ 的值进行线性回归，最佳拟合线的斜率提供了对缩放指数 $q$ 的估计。\n\n实现将遵循这些原则，对指定的 $N$ 范围执行模拟，计算误差，并拟合 $q$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D advection problem using non-conservative and conservative schemes,\n    computes mass errors, and determines the error scaling for the non-conservative scheme.\n    \"\"\"\n    # Problem parameters\n    L = 1.0\n    T = 1.0\n    CFL = 0.4\n    TEST_CASES_N = [50, 100, 200, 400, 800]\n\n    # Field definitions\n    def u_field(x):\n        return 0.5 + 0.5 * np.sin(2 * np.pi * x / L)\n\n    def rho_initial(x):\n        return 1.0 + 0.3 * np.sin(2 * np.pi * x / L) + 0.8 * np.exp(-((x - 0.3*L)**2) / 0.01)\n\n    e_nc_results = []\n    e_cons_results = []\n\n    for N in TEST_CASES_N:\n        # ---- 1. Grid and Initial Conditions Setup ----\n        dx = L / N\n        # Cell-centered grid\n        x_nodes = np.arange(N) * dx\n        \n        # Initial density at cell centers\n        rho0 = rho_initial(x_nodes)\n        \n        # Initial total mass\n        m0 = np.sum(rho0) * dx\n\n        # ---- 2. Time-stepping Setup ----\n        u_max = 1.0  # Max of u_field is 0.5 + 0.5*1 = 1.0\n        dt = CFL * dx / u_max\n        \n        num_steps = int(T / dt)\n        last_dt = T - num_steps * dt\n        \n        timesteps = [dt] * num_steps\n        if last_dt > 1e-12:  # Add final smaller step if needed\n            timesteps.append(last_dt)\n\n        # ---- 3. Simulation Loop ----\n        # Initialize densities for both schemes\n        rho_nc = rho0.copy()\n        rho_cons = rho0.copy()\n\n        # Pre-compute velocities for efficiency\n        # Velocities at cell centers (for non-conservative scheme)\n        u_nodes = u_field(x_nodes)\n        # Velocities at cell faces (for conservative scheme)\n        x_faces = (np.arange(N) + 0.5) * dx\n        u_faces = u_field(x_faces)\n\n        for t_step in timesteps:\n            # --- Update Non-Conservative (Semi-Lagrangian) Scheme ---\n            # Compute departure points\n            x_star = x_nodes - u_nodes * t_step\n            # Linearly interpolate to find new density. np.interp handles periodicity.\n            rho_nc = np.interp(x_star, x_nodes, rho_nc, period=L)\n\n            # --- Update Conservative (Finite-Volume Upwind) Scheme ---\n            # Flux at right face of each cell i (F_{i+1/2})\n            # Upwind flux uses rho_i since u >= 0\n            flux_right = u_faces * rho_cons\n            # Flux at left face of each cell i (F_{i-1/2})\n            flux_left = np.roll(flux_right, 1) # Get F_{i-1/2} by rolling F_{j+1/2}\n            \n            # Update cell average density\n            rho_cons -= (t_step / dx) * (flux_right - flux_left)\n\n        # ---- 4. Post-processing for this N ----\n        # Final total mass\n        m_nc_final = np.sum(rho_nc) * dx\n        m_cons_final = np.sum(rho_cons) * dx\n\n        # Relative mass error\n        e_nc = np.abs(m_nc_final - m0) / m0\n        e_cons = np.abs(m_cons_final - m0) / m0\n\n        e_nc_results.append(e_nc)\n        e_cons_results.append(e_cons)\n\n    # ---- 5. Empirical Error Scaling Analysis ----\n    dx_values = L / np.array(TEST_CASES_N)\n    log_dx = np.log(dx_values)\n    log_e_nc = np.log(np.array(e_nc_results))\n    \n    # Fit log(error) vs log(dx) to a line y = mx + c. The slope m is the order q.\n    q_exponent, _ = np.polyfit(log_dx, log_e_nc, 1)\n\n    # Get the maximum error for the conservative scheme\n    max_e_cons = np.max(e_cons_results)\n\n    # ---- 6. Final Output ----\n    final_results = e_nc_results + [q_exponent, max_e_cons]\n    \n    # Format the numbers to a reasonable precision for consistent output\n    formatted_results = [f\"{val:.10f}\" for val in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "对于不可压缩流体，质量守恒体现为速度场的无散度条件。本练习将带您深入研究投影法，这是一种在计算流体力学中用于强制执行此约束的基本算法。通过使用高效的谱方法实现一个投影步骤，您将见证一个中间的、非物理的速度场如何被“投影”到一个物理上正确的、离散无散度的速度场空间，从而确保质量在每个时间步都得到精确守恒。",
            "id": "4082126",
            "problem": "要求您在用于不可压缩复杂流体的分数步长法中，设计并实现一个质量守恒的投影步骤，该步骤在新时间层级上强制执行离散质量守恒。从质量守恒和不可压缩性定义出发，构建一个投影，将一个中间速度场映射到一个二维周期性域上的无散场。该域为单位环面，具有周期性边界条件，即 $[0,1]^2$，在一个均匀网格上离散化，x 方向有 $N_x$ 个点，y 方向有 $N_y$ 个点。在时间层级 $n$ 经过显式非压力更新后的中间速度场表示为 $\\mathbf{u}^\\star(x,y) = (u^\\star(x,y), v^\\star(x,y))$，目标是生成满足 $\\nabla \\cdot \\mathbf{u}^{n+1}(x,y) = 0$ 的 $\\mathbf{u}^{n+1}(x,y)$，在离散层面上达到机器精度。\n\n您的构建必须基于一对在周期性网格上共轭的离散梯度和散度算子，以使投影步骤能精确执行离散连续性方程，误差仅为浮点舍入误差。此步骤在概念上必须为一个标量势求解一个离散泊松方程，该标量势用于校正中间速度并保证得到一个无散的结果。核心科学基础必须从质量守恒定律和不可压缩性定义开始。问题陈述中不允许使用任何捷径公式；请在您的解法中推导出所需内容。\n\n以一种在周期性单位正方形上可复现且数值稳健的方式实现您的投影。所有计算都应是无量纲的。如果存在角度，则默认以弧度为单位，因为所用的函数是标准数学意义上的三角函数；但是，您不需要在输出中报告任何角度。\n\n您的程序必须：\n- 在给定网格上构建测试速度场 $\\mathbf{u}^\\star(x,y)$。\n- 应用您的质量守恒投影以获得 $\\mathbf{u}^{n+1}(x,y)$。\n- 使用与您的投影机制相同的离散算子计算 $\\mathbf{u}^{n+1}(x,y)$ 的离散散度。\n- 对于每个测试用例，报告整个网格上离散散度的最大绝对值，作为一个浮点数。\n\n测试套件：\n- 案例 1：$N_x = 32$，$N_y = 32$。定义 $x_i = i/N_x$，$y_j = j/N_y$，其中整数 $i \\in \\{0,\\dots,N_x-1\\}$ 且 $j \\in \\{0,\\dots,N_y-1\\}$。令标量场 $\\psi(x,y) = \\sin(2\\pi x)\\cos(2\\pi y)$ 和 $\\phi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y)$。定义一个势流梯度分量 $\\mathbf{u}_{\\mathrm{grad}} = \\nabla \\psi$ 和一个无散的旋转分量 $\\mathbf{u}_{\\mathrm{vort}} = (-\\partial_y \\phi, \\partial_x \\phi)$。设置 $\\mathbf{u}^\\star = \\mathbf{u}_{\\mathrm{grad}} + \\mathbf{u}_{\\mathrm{vort}} + 0.1\\,\\boldsymbol{\\eta}$，其中 $\\boldsymbol{\\eta}$ 是一个从标准正态分布中抽取的确定性伪随机场，种子设为 $0$，每个分量的形状为 $(N_x,N_y)$。\n- 案例 2：$N_x = 33$，$N_y = 17$。令 $\\mathbf{u}^\\star = \\boldsymbol{\\eta} + \\mathbf{c}$，其中 $\\boldsymbol{\\eta}$ 如上所述但种子设为 $0$，而 $\\mathbf{c} = (1.5, -0.75)$ 是一个恒定的均匀速度向量。\n- 案例 3：$N_x = 64$，$N_y = 64$。令 $\\psi(x,y) = \\cos(4\\pi x)\\sin(2\\pi y)$ 并设置 $\\mathbf{u}^\\star = \\nabla \\psi$（一个纯梯度场）。\n- 案例 4：$N_x = 8$，$N_y = 8$。令 $\\phi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y)$ 并设置 $\\mathbf{u}^\\star = 3\\,(-\\partial_y \\phi, \\partial_x \\phi)$（一个经过缩放的无散场）。\n- 案例 5：$N_x = 16$，$N_y = 24$。令 $\\mathbf{u}^\\star = \\boldsymbol{\\eta}$，种子设为 $42$，分量从标准正态分布中抽取。\n\n定义和要求：\n- 使用与周期性边界条件一致的离散傅里叶变换来实现离散梯度、散度和泊松方程的求解。使用快速傅里叶变换（FFT）作为变换的数值机制。\n- 离散散度必须使用与投影构造中所用相同的波数进行谱方法计算，以确保共轭性和精确抵消（误差仅为浮点误差）。\n- 对于每个案例，计算 $\\mathbf{u}^{n+1}$ 的最大绝对离散散度，并将其作为浮点值返回。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4,\\mathrm{result}_5]$）。每个结果必须是一个浮点数。",
            "solution": "该问题要求在二维周期性域上为不可压缩流体设计并实现一个质量守恒的投影步骤。解法必须从第一性原理推导，特别是质量守恒定律，并使用基于快速傅里叶变换（FFT）的谱方法来实现。\n\n支配流体运动的基本原理是质量守恒，由连续性方程表示：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{u}$ 是速度场。对于被视为不可压缩的复杂流体，密度 $\\rho$ 被假设在空间和时间上都是恒定的。因此，其偏导数为零，即 $\\frac{\\partial \\rho}{\\partial t} = 0$ 和 $\\nabla \\rho = \\mathbf{0}$。连续性方程简化为：\n$$\n\\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n由于 $\\rho > 0$，这就得出了不可压缩性约束，这是对速度场的运动学条件：\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\n该方程表明，不可压缩流的速度场必须是无散的。\n\n分数步长法，或称投影法，常用于求解不可压缩流的时变 Navier-Stokes 方程。它们将速度和压力的计算解耦。在一个典型的两步方案中，首先通过推进不含压力梯度项的动量方程，在时间层级 $n+1$ 计算出一个中间速度场，记为 $\\mathbf{u}^\\star$。通常情况下，这个场 $\\mathbf{u}^\\star$ 不会满足不可压缩性约束。\n\n第二步，即投影步骤，校正 $\\mathbf{u}^\\star$ 以生成一个离散无散的速度场 $\\mathbf{u}^{n+1}$。这是通过引入压力梯度的效应来实现的。校正由下式给出：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^\\star}{\\Delta t} = -\\nabla p^{n+1}\n$$\n其中 $p^{n+1}$ 与压力相关，$\\Delta t$ 是时间步长。对于我们的无量纲问题，我们可以将 $\\Delta t$ 吸收到一个标量势 $\\Phi$ 中，使得更新为：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\nabla \\Phi\n$$\n这是 Helmholtz-Hodge 分解的表述，该分解指出任何向量场 $\\mathbf{u}^\\star$ 都可以唯一地分解为一个无散分量（$\\mathbf{u}^{n+1}$）和一个无旋（梯度）分量（$\\nabla \\Phi$）。\n\n为了找到势 $\\Phi$，我们对最终速度场施加不可压缩性约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$。对校正方程应用散度算子，我们得到：\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^\\star - \\nabla \\cdot (\\nabla \\Phi)\n$$\n令 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 会得到一个关于标量势 $\\Phi$ 的泊松方程：\n$$\n\\nabla^2 \\Phi = \\nabla \\cdot \\mathbf{u}^\\star\n$$\n求解该方程得到 $\\Phi$ 后，我们便可以计算梯度 $\\nabla \\Phi$，并随后得到最终的无散速度场 $\\mathbf{u}^{n+1}$。\n\n对于指定的周期性域 $[0,1]^2$，使用离散傅里叶变换（DFT）的谱方法因其高精度和 FFT 算法的高效率而特别适用。在傅里叶空间中，微分算子变为代数乘法算子。网格上的函数 $f(x,y)$ 被变换为其傅里叶系数 $\\hat{f}(k_x, k_y)$，其中 $k_x$ 和 $k_y$ 是波数。导数算子变换如下：\n$$\n\\mathcal{F}\\left(\\frac{\\partial f}{\\partial x}\\right) = i k_x \\hat{f} \\quad \\text{and} \\quad \\mathcal{F}\\left(\\frac{\\partial f}{\\partial y}\\right) = i k_y \\hat{f}\n$$\n其中 $\\mathcal{F}$ 表示傅里叶变换。\n\n对于大小为 $L_x=1$，$L_y=1$ 且有 $N_x$ 和 $N_y$ 个点的域，其离散波数由 $k_x = 2\\pi m$ 和 $k_y = 2\\pi n$ 给出，其中 $m$ 和 $n$ 是整数模态。这些波数使用 `scipy.fft.fftfreq` 计算。具体来说，$k_x = 2\\pi \\times \\text{fftfreq}(N_x, 1/N_x)$ 且 $k_y = 2\\pi \\times \\text{fftfreq}(N_y, 1/N_y)$。\n\n对泊松方程 $\\nabla^2 \\Phi = \\nabla \\cdot \\mathbf{u}^\\star$ 应用傅里叶变换：\n$$\n\\mathcal{F}(\\nabla^2 \\Phi) = \\mathcal{F}(\\nabla \\cdot \\mathbf{u}^\\star)\n$$\n左边变为：\n$$\n\\mathcal{F}(\\nabla^2 \\Phi) = \\mathcal{F}\\left(\\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{\\partial^2 \\Phi}{\\partial y^2}\\right) = ((ik_x)^2 + (ik_y)^2)\\hat{\\Phi} = -(k_x^2 + k_y^2)\\hat{\\Phi}\n$$\n右边，即 $\\mathbf{u}^\\star = (u^\\star, v^\\star)$ 的散度，变为：\n$$\n\\mathcal{F}(\\nabla \\cdot \\mathbf{u}^\\star) = \\mathcal{F}\\left(\\frac{\\partial u^\\star}{\\partial x} + \\frac{\\partial v^\\star}{\\partial y}\\right) = i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star\n$$\n将这些结合起来，得到傅里叶空间中关于 $\\hat{\\Phi}$ 的代数方程：\n$$\n-(k_x^2 + k_y^2)\\hat{\\Phi} = i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star\n$$\n我们可以解出 $\\hat{\\Phi}$：\n$$\n\\hat{\\Phi}(k_x, k_y) = - \\frac{i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star}{k_x^2 + k_y^2}\n$$\n对于零波数模式 $(k_x, k_y) = (0,0)$，会出现一个特殊情况，此时分母 $k_x^2+k_y^2$ 为零。该模式对应于场的平均值。对于此模式，分子也为零，$i(0)\\hat{u}^\\star_{0,0} + i(0)\\hat{v}^\\star_{0,0} = 0$。这种 $0/0$ 的不确定性反映了势 $\\Phi$ 的确定只到一个任意常数的程度。我们可以通过设置 $\\hat{\\Phi}(0,0) = 0$ 来解决这个问题，这对应于选择空间平均值为零的唯一势函数。\n\n一旦知道了 $\\hat{\\Phi}$，我们就可以找到投影速度 $\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\nabla \\Phi$ 的傅里叶变换：\n$$\n\\hat{u}^{n+1} = \\hat{u}^\\star - i k_x \\hat{\\Phi}\n$$\n$$\n\\hat{v}^{n+1} = \\hat{v}^\\star - i k_y \\hat{\\Phi}\n$$\n最后，通过应用逆傅里叶变换 $\\mathcal{F}^{-1}$，可以恢复实空间中的速度场 $\\mathbf{u}^{n+1}$。\n\n为了验证结果，我们使用相同的谱算子计算 $\\mathbf{u}^{n+1}$ 的离散散度。在傅里叶空间中，这表示为：\n$$\n\\widehat{\\nabla \\cdot \\mathbf{u}^{n+1}} = i k_x \\hat{u}^{n+1} + i k_y \\hat{v}^{n+1}\n$$\n代入 $\\hat{u}^{n+1}$ 和 $\\hat{v}^{n+1}$ 的表达式：\n$$\n\\widehat{\\nabla \\cdot \\mathbf{u}^{n+1}} = i k_x (\\hat{u}^\\star - i k_x \\hat{\\Phi}) + i k_y (\\hat{v}^\\star - i k_y \\hat{\\Phi})\n= (i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star) - ( (ik_x)^2 + (ik_y)^2 ) \\hat{\\Phi}\n= (i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star) + (k_x^2 + k_y^2) \\hat{\\Phi}\n$$\n代入 $\\hat{\\Phi}$ 的解：\n$$\n= (i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star) + (k_x^2 + k_y^2) \\left( - \\frac{i k_x \\hat{u}^\\star + i k_y \\hat{v}^\\star}{k_x^2 + k_y^2} \\right) = 0\n$$\n这对所有 $(k_x, k_y) \\neq (0,0)$ 成立。对于 $(k_x, k_y)=(0,0)$，所有项都为零。因此，投影场的散度在傅里叶空间中是解析为零的。其逆变换将为零，误差仅为浮点舍入误差。该场的最大绝对值即为所要求的输出。",
            "answer": "```python\nimport numpy as np\nimport scipy.fft\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n\n    test_cases = [\n        {'Nx': 32, 'Ny': 32, 'case_type': 'grad_vort_noise', 'seed': 0},\n        {'Nx': 33, 'Ny': 17, 'case_type': 'noise_const', 'seed': 0},\n        {'Nx': 64, 'Ny': 64, 'case_type': 'pure_grad', 'seed': None},\n        {'Nx': 8, 'Ny': 8, 'case_type': 'pure_vort', 'seed': None},\n        {'Nx': 16, 'Ny': 24, 'case_type': 'pure_noise', 'seed': 42},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _solve_single_case(params)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.16e}' for r in results)}]\")\n\ndef _solve_single_case(params):\n    \"\"\"\n    Solves a single test case for the projection problem.\n    \"\"\"\n    Nx = params['Nx']\n    Ny = params['Ny']\n    case_type = params['case_type']\n    seed = params['seed']\n    \n    # 1. Construct the grid\n    x = np.arange(Nx) / Nx\n    y = np.arange(Ny) / Ny\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    # 2. Construct the intermediate velocity field u_star\n    pi = np.pi\n    u_star, v_star = None, None\n    rng = np.random.default_rng(seed) if seed is not None else None\n\n    if case_type == 'grad_vort_noise':\n        # Case 1: Grad + Vort + Noise\n        psi = np.sin(2 * pi * xx) * np.cos(2 * pi * yy)\n        dpsi_dx = 2 * pi * np.cos(2 * pi * xx) * np.cos(2 * pi * yy)\n        dpsi_dy = -2 * pi * np.sin(2 * pi * xx) * np.sin(2 * pi * yy)\n\n        phi_vort = np.sin(2 * pi * xx) * np.sin(2 * pi * yy)\n        dphi_dx = 2 * pi * np.cos(2 * pi * xx) * np.sin(2 * pi * yy)\n        dphi_dy = 2 * pi * np.sin(2 * pi * xx) * np.cos(2 * pi * yy)\n        \n        eta_x = rng.standard_normal(size=(Nx, Ny))\n        eta_y = rng.standard_normal(size=(Nx, Ny))\n\n        u_star = dpsi_dx - dphi_dy + 0.1 * eta_x\n        v_star = dpsi_dy + dphi_dx + 0.1 * eta_y\n\n    elif case_type == 'noise_const':\n        # Case 2: Noise + Constant\n        c = (1.5, -0.75)\n        eta_x = rng.standard_normal(size=(Nx, Ny))\n        eta_y = rng.standard_normal(size=(Nx, Ny))\n        u_star = eta_x + c[0]\n        v_star = eta_y + c[1]\n\n    elif case_type == 'pure_grad':\n        # Case 3: Pure gradient field\n        psi = np.cos(4 * pi * xx) * np.sin(2 * pi * yy)\n        u_star = -4 * pi * np.sin(4 * pi * xx) * np.sin(2 * pi * yy)\n        v_star = 2 * pi * np.cos(4 * pi * xx) * np.cos(2 * pi * yy)\n\n    elif case_type == 'pure_vort':\n        # Case 4: Purely rotational (divergence-free) field\n        phi_vort = np.sin(2 * pi * xx) * np.sin(2 * pi * yy)\n        dphi_dx = 2 * pi * np.cos(2 * pi * xx) * np.sin(2 * pi * yy)\n        dphi_dy = 2 * pi * np.sin(2 * pi * xx) * np.cos(2 * pi * yy)\n        u_star = 3.0 * (-dphi_dy)\n        v_star = 3.0 * (dphi_dx)\n\n    elif case_type == 'pure_noise':\n        # Case 5: Pure noise\n        u_star = rng.standard_normal(size=(Nx, Ny))\n        v_star = rng.standard_normal(size=(Nx, Ny))\n    \n    # 3. Perform the projection\n    u_proj, v_proj = _project_velocity(u_star, v_star, Nx, Ny)\n\n    # 4. Compute the divergence of the projected field\n    divergence_field = _calculate_divergence(u_proj, v_proj, Nx, Ny)\n\n    # 5. Return the maximum absolute divergence\n    return np.max(np.abs(divergence_field))\n\ndef _project_velocity(u, v, Nx, Ny):\n    \"\"\"\n    Projects a velocity field (u, v) onto its divergence-free part.\n    \"\"\"\n    # Create wavenumber grids\n    kx_1d = 2 * np.pi * scipy.fft.fftfreq(Nx, d=1.0/Nx)\n    ky_1d = 2 * np.pi * scipy.fft.fftfreq(Ny, d=1.0/Ny)\n    kx, ky = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n\n    # FFT of the velocity field\n    u_hat = scipy.fft.fft2(u)\n    v_hat = scipy.fft.fft2(v)\n\n    # Compute FFT of divergence of (u, v)\n    div_u_hat = 1j * kx * u_hat + 1j * ky * v_hat\n\n    # Solve Poisson equation for the potential phi in Fourier space\n    k_squared = kx**2 + ky**2\n    # Handle the k=0 mode to avoid division by zero\n    k_squared[0, 0] = 1.0  # Denominator is non-zero\n    \n    phi_hat = -div_u_hat / k_squared\n    # The numerator at k=0 is already zero, so this enforces phi_hat(0,0)=0\n\n    # Correct the velocity field in Fourier space\n    u_proj_hat = u_hat - 1j * kx * phi_hat\n    v_proj_hat = v_hat - 1j * ky * phi_hat\n\n    # Inverse FFT to get the projected velocity field in real space\n    u_proj = scipy.fft.ifft2(u_proj_hat).real\n    v_proj = scipy.fft.ifft2(v_proj_hat).real\n    \n    return u_proj, v_proj\n\ndef _calculate_divergence(u, v, Nx, Ny):\n    \"\"\"\n    Computes the divergence of a velocity field (u, v) using spectral methods.\n    \"\"\"\n    # Create wavenumber grids\n    kx_1d = 2 * np.pi * scipy.fft.fftfreq(Nx, d=1.0/Nx)\n    ky_1d = 2 * np.pi * scipy.fft.fftfreq(Ny, d=1.0/Ny)\n    kx, ky = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n\n    # FFT of the velocity field\n    u_hat = scipy.fft.fft2(u)\n    v_hat = scipy.fft.fft2(v)\n\n    # Compute divergence in Fourier space\n    div_u_hat = 1j * kx * u_hat + 1j * ky * v_hat\n\n    # Inverse FFT to get divergence in real space\n    divergence = scipy.fft.ifft2(div_u_hat).real\n    \n    return divergence\n\nsolve()\n```"
        },
        {
            "introduction": "在多相流模拟中，质量守恒面临着更为微妙的挑战。本练习探讨了广泛应用的水平集（level-set）方法，并揭示了一个关键问题：为维持数值稳定性所必需的重新初始化步骤，可能会无意中导致非物理性的质量增减。通过推导这一误差的产生机制，您将深刻理解为何需要发展如耦合水平集-流体体积（CLSVOF）等更先进的守恒型界面追踪技术。",
            "id": "4082120",
            "problem": "考虑一个计算域 $\\Omega \\subset \\mathbb{R}^d$，其边界为周期性或无通量边界，并存在一个无散速度场 $\\nabla \\cdot \\mathbf{u} = 0$。两个不可压缩相之间的界面由水平集函数 $\\psi(\\mathbf{x},t)$ 的零水平集 $\\Gamma(t) = \\{\\mathbf{x} \\in \\Omega : \\psi(\\mathbf{x},t) = 0\\}$ 表示。该界面在物理时间 $t$ 内由输运方程 $\\partial_t \\psi + \\mathbf{u}\\cdot \\nabla \\psi = 0$ 进行平流。为了控制扭曲，执行一个独立的伪时间 $\\tau$ 重新初始化步骤，以将 $\\psi$ 正则化为符号距离函数，求解 $\\partial_\\tau \\psi = \\mathcal{R}(\\psi,\\nabla \\psi)$，其中 $\\mathcal{R}$ 是某个依赖于 $\\psi$ 及其梯度的一致正则化算子。\n\n使用具有紧支集的光滑 Heaviside 函数 $H_\\epsilon$（其导数为 $\\delta_\\epsilon = H_\\epsilon'$，一个集中在 $\\Gamma(t)$ 附近的光滑 Dirac delta 函数），定义其中一个相的光滑指示函数 $I(\\mathbf{x},t) = H_\\epsilon(\\psi(\\mathbf{x},t))$，以及总质量 $M(t) = \\int_{\\Omega} I(\\mathbf{x},t)\\,\\mathrm{d}\\mathbf{x}$。从基本质量守恒和连续性方程出发，且不假设 $\\mathcal{R}$ 的任何特定形式，推导：\n- 在物理平流步骤中，关于 $\\mathrm{d}M/\\mathrm{d}t$ 的表达式，需满足给定的边界条件和 $\\nabla\\cdot\\mathbf{u} = 0$。\n- 在重新初始化步骤中，用在 $\\Gamma(t)$ 上求值的 $\\partial_\\tau \\psi$ 和 $|\\nabla \\psi|$ 表示 $\\mathrm{d}M/\\mathrm{d}\\tau$ 的表达式，并解释重新初始化误差如何通过界面法向运动产生质量损失。\n\n基于此推导，选择一个选项，该选项能正确诊断重新初始化导致质量损失的机理，并提出一个科学上合理的守恒替代方案，该方案能在周期性或无通量边界条件下为无散流保持质量。\n\nA. 使用 $I = H_\\epsilon(\\psi)$ 和 $\\delta_\\epsilon = H_\\epsilon'$，可以发现 $\\mathrm{d}M/\\mathrm{d}\\tau = \\displaystyle \\int_{\\Gamma(t)} \\frac{\\partial_\\tau \\psi}{|\\nabla \\psi|}\\,\\mathrm{d}S$，因此任何非零的 $\\partial_\\tau \\psi$ 都会产生一个法向界面速度 $V_n = -\\partial_\\tau \\psi/|\\nabla \\psi|$ 并改变 $M$。一个守恒的替代方案是用守恒输运方程 $\\partial_t \\phi + \\nabla\\cdot(\\phi\\,\\mathbf{u}) = 0$ 来演化一个有界指示函数 $\\phi$，并周期性地从 $\\phi$ 重构 $\\psi$（耦合水平集-流体体积法，Coupled Level Set–Volume of Fluid (CLSVOF)），这确保了当 $\\nabla\\cdot\\mathbf{u} = 0$ 且边界通量为零时，$\\int_{\\Omega} \\phi\\,\\mathrm{d}\\mathbf{x}$ 是不变的。\n\nB. 质量仅因 $\\nabla\\cdot\\mathbf{u} \\neq 0$ 而改变，因此重新初始化不是一个因素。守恒的替代方案是增加伪时间步长，以更严格地强制 $|\\nabla \\psi| = 1$。\n\nC. 根据链式法则，$\\mathrm{d}M/\\mathrm{d}\\tau = 0$，因为零水平集在重新初始化期间是固定的。守恒的替代方案是完全放弃输运方程，并将 $\\psi$ 保持为符号距离函数。\n\nD. $\\mathrm{d}M/\\mathrm{d}\\tau$ 等于平均曲率的积分；因此质量损失与曲率成正比。守恒的替代方案是在物理时间内向 $\\partial_t \\psi + \\mathbf{u}\\cdot\\nabla \\psi$ 添加依赖于曲率的扩散项。",
            "solution": "在进行求解之前，对问题陈述进行严格评估。\n\n### 第一步：提取已知条件\n-   计算域：$\\Omega \\subset \\mathbb{R}^d$。\n-   边界条件：周期性或无通量。\n-   速度场：$\\mathbf{u}$ 是无散的，即 $\\nabla \\cdot \\mathbf{u} = 0$。\n-   界面定义：$\\Gamma(t) = \\{\\mathbf{x} \\in \\Omega : \\psi(\\mathbf{x},t) = 0\\}$，其中 $\\psi(\\mathbf{x},t)$ 是一个水平集函数。\n-   物理平流方程：$\\partial_t \\psi + \\mathbf{u}\\cdot \\nabla \\psi = 0$。\n-   重新初始化方程：$\\partial_\\tau \\psi = \\mathcal{R}(\\psi,\\nabla \\psi)$，其中 $\\tau$ 是伪时间，$\\mathcal{R}$ 是一个正则化算子。\n-   相指示函数：$I(\\mathbf{x},t) = H_\\epsilon(\\psi(\\mathbf{x},t))$，对于一个光滑的 Heaviside 函数 $H_\\epsilon$。\n-   光滑 Dirac delta：$\\delta_\\epsilon = H_\\epsilon'$。\n-   相的总质量：$M(t) = \\int_{\\Omega} I(\\mathbf{x},t)\\,\\mathrm{d}\\mathbf{x}$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题描述了在计算流体动力学中使用水平集方法模拟两相不可压缩流的标准设置。\n\n-   **科学依据**：这些方程和概念是该领域的基础。用于 $\\psi$ 的输运方程、不可压缩性的无散条件、为保持符号距离属性而进行的重新初始化概念，以及使用光滑 Heaviside 函数定义体积的做法，都是标准且科学正确的。\n-   **适定性**：该问题是适定的。它要求基于所提供的设置进行两次推导，然后评估所提出的解决方案。所提供的信息是充分且自洽的。\n-   **客观性**：语言正式、精确，没有任何主观或非科学的主张。\n\n该问题没有违反任何无效性标准。这是一个在计算物理学中被良好阐述的问题。\n\n### 第三步：结论与行动\n该问题是**有效的**。将进行完整的推导和分析。\n\n### 推导与分析\n\n**1. 物理平流过程中的质量变化率 ($\\mathrm{d}M/\\mathrm{d}t$)**\n\n总质量定义为 $M(t) = \\int_{\\Omega} I(\\mathbf{x},t)\\,\\mathrm{d}\\mathbf{x} = \\int_{\\Omega} H_\\epsilon(\\psi(\\mathbf{x},t))\\,\\mathrm{d}\\mathbf{x}$。\n我们对 $M(t)$ 关于物理时间 $t$ 求导。由于域 $\\Omega$ 是固定的，导数可以移到积分号内：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = \\int_{\\Omega} \\frac{\\partial}{\\partial t} H_\\epsilon(\\psi(\\mathbf{x},t))\\,\\mathrm{d}\\mathbf{x}\n$$\n应用链式法则，$\\frac{\\partial}{\\partial t} H_\\epsilon(\\psi) = H_\\epsilon'(\\psi) \\frac{\\partial \\psi}{\\partial t} = \\delta_\\epsilon(\\psi) \\frac{\\partial \\psi}{\\partial t}$。\n根据物理平流方程，我们有 $\\frac{\\partial \\psi}{\\partial t} = -\\mathbf{u}\\cdot \\nabla \\psi$。\n将此代入积分：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = \\int_{\\Omega} \\delta_\\epsilon(\\psi) (-\\mathbf{u}\\cdot \\nabla \\psi)\\,\\mathrm{d}\\mathbf{x}\n$$\n现在，我们将此表达式与一个通量的散度联系起来。指示函数的梯度为 $\\nabla I = \\nabla H_\\epsilon(\\psi) = H_\\epsilon'(\\psi) \\nabla\\psi = \\delta_\\epsilon(\\psi) \\nabla\\psi$。\n因此，被积函数为 $-\\mathbf{u} \\cdot (\\delta_\\epsilon(\\psi) \\nabla\\psi) = -\\mathbf{u} \\cdot \\nabla I$。\n我们使用矢量微积分恒等式 $\\nabla \\cdot (I \\mathbf{u}) = (\\nabla I) \\cdot \\mathbf{u} + I(\\nabla \\cdot \\mathbf{u})$。\n鉴于流场是无散的，$\\nabla \\cdot \\mathbf{u} = 0$，该恒等式简化为 $\\nabla \\cdot (I \\mathbf{u}) = (\\nabla I) \\cdot \\mathbf{u}$。\n质量变化率的表达式变为：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = \\int_{\\Omega} -(\\nabla I \\cdot \\mathbf{u})\\,\\mathrm{d}\\mathbf{x} = \\int_{\\Omega} -\\nabla \\cdot (I \\mathbf{u})\\,\\mathrm{d}\\mathbf{x}\n$$\n根据散度定理（高斯定理），这个体积分可以转换为在域边界 $\\partial\\Omega$ 上的面积分：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = -\\oint_{\\partial\\Omega} (I \\mathbf{u}) \\cdot \\mathbf{n}\\,\\mathrm{d}S\n$$\n其中 $\\mathbf{n}$ 是 $\\partial\\Omega$ 上指向外的单位法向量。\n问题陈述边界条件是周期性或无通量的。\n-   **无通量条件**：在 $\\partial\\Omega$ 上 $\\mathbf{u} \\cdot \\mathbf{n} = 0$。这使得被积函数在边界上处处为零。\n-   **周期性条件**：从域的一侧流出的通量等于流入相对侧的通量，导致整个边界上的净积分为零。\n\n在这两种情况下，边积分都为零。因此，在物理平流步骤中：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}t} = 0\n$$\n这证实了在无散流场中，即使使用非守恒形式的平流方程，水平集函数的物理平流也是一个质量守恒的过程。\n\n**2. 重新初始化过程中的质量变化率 ($\\mathrm{d}M/\\mathrm{d}\\tau$)**\n\n接下来，我们分析重新初始化步骤中的质量变化，该过程由伪时间 $\\tau$ 的演化控制：$\\partial_\\tau \\psi = \\mathcal{R}(\\psi,\\nabla \\psi)$。\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}\\tau} = \\frac{\\mathrm{d}}{\\mathrm{d}\\tau} \\int_{\\Omega} H_\\epsilon(\\psi(\\mathbf{x},\\tau))\\,\\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\frac{\\partial}{\\partial \\tau} H_\\epsilon(\\psi)\\,\\mathrm{d}\\mathbf{x}\n$$\n和之前一样使用链式法则：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}\\tau} = \\int_{\\Omega} \\delta_\\epsilon(\\psi) \\frac{\\partial \\psi}{\\partial \\tau}\\,\\mathrm{d}\\mathbf{x}\n$$\n函数 $\\delta_\\epsilon(\\psi)$ 是 Dirac delta 函数的光滑近似，集中在 $\\psi = 0$ 附近。在平滑宽度 $\\epsilon \\to 0$ 的极限下，我们有 $\\delta_\\epsilon(\\psi) \\to \\delta(\\psi)$。积分变为：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}\\tau} = \\int_{\\Omega} \\delta(\\psi) \\frac{\\partial \\psi}{\\partial \\tau}\\,\\mathrm{d}\\mathbf{x}\n$$\n使用余面积公式，形式为 $\\int_{\\Omega} g(\\mathbf{x}) \\delta(\\psi(\\mathbf{x}))\\,\\mathrm{d}\\mathbf{x}$ 的积分可以转换为在水平集 $\\Gamma(t) = \\{\\mathbf{x} : \\psi(\\mathbf{x})=0\\}$ 上的面积分：\n$$\n\\int_{\\Omega} g(\\mathbf{x}) \\delta(\\psi(\\mathbf{x}))\\,\\mathrm{d}\\mathbf{x} = \\int_{\\Gamma(t)} \\frac{g(\\mathbf{x})}{|\\nabla \\psi|}\\,\\mathrm{d}S\n$$\n在我们的例子中，$g(\\mathbf{x}) = \\frac{\\partial \\psi}{\\partial \\tau}$。因此，重新初始化期间的质量变化率为：\n$$\n\\frac{\\mathrm{d}M}{\\mathrm{d}\\tau} = \\int_{\\Gamma(t)} \\frac{\\partial_\\tau \\psi}{|\\nabla \\psi|}\\,\\mathrm{d}S\n$$\n**解释**：项 $V_n^{(\\tau)} = \\frac{\\partial_\\tau \\psi}{|\\nabla \\psi|}$（符号取决于约定）代表了由重新初始化过程引起的界面 $\\Gamma(t)$ 的有效法向速度。如果在界面 $\\psi=0$ 上 $\\partial_\\tau \\psi$ 非零，界面就会移动，导致体积（质量）$M$ 发生变化。理想的重新初始化目标是在 $\\psi=0$ 水平集上实现 $\\partial_\\tau \\psi = 0$，但重新初始化算子 $\\mathcal{R}$ 的数值实现通常无法完美达到这一点，从而导致虚假的界面运动，并因此导致质量不守恒。这是标准水平集方法的一个众所周知的缺陷。\n\n### 选项评估\n\n让我们基于这些推导来评估每个选项。\n\n**A. 使用 $I = H_\\epsilon(\\psi)$ 和 $\\delta_\\epsilon = H_\\epsilon'$，可以发现 $\\mathrm{d}M/\\mathrm{d}\\tau = \\displaystyle \\int_{\\Gamma(t)} \\frac{\\partial_\\tau \\psi}{|\\nabla \\psi|}\\,\\mathrm{d}S$，因此任何非零的 $\\partial_\\tau \\psi$ 都会产生一个法向界面速度 $V_n = -\\partial_\\tau \\psi/|\\nabla \\psi|$ 并改变 $M$。一个守恒的替代方案是用守恒输运方程 $\\partial_t \\phi + \\nabla\\cdot(\\phi\\,\\mathbf{u}) = 0$ 来演化一个有界指示函数 $\\phi$，并周期性地从 $\\phi$ 重构 $\\psi$（耦合水平集-流体体积法，CLSVOF），这确保了当 $\\nabla\\cdot\\mathbf{u} = 0$ 且边界通量为零时，$\\int_{\\Omega} \\phi\\,\\mathrm{d}\\mathbf{x}$ 是不变的。**\n\n-   $\\mathrm{d}M/\\mathrm{d}\\tau$ 的表达式与我的推导相同。\n-   “在界面上非零的 $\\partial_\\tau \\psi$ 会产生法向速度并改变质量”这一解释是正确的。速度定义的符号是一个约定问题，但其物理联系被正确地识别了。\n-   提出的替代方案，CLSVOF，是一种用于强制质量守恒的标准且科学合理的方法。它通过一个保证守恒的方程 $\\partial_t \\phi + \\nabla\\cdot(\\phi\\,\\mathbf{u}) = 0$ 来演化一个体积分数场 $\\phi$。当给定的边界条件和 $\\nabla\\cdot\\mathbf{u}=0$ 成立时，对该方程在 $\\Omega$ 上积分可得 $\\mathrm{d}/dt \\int_\\Omega \\phi d\\mathbf{x} = 0$。然后，水平集函数 $\\psi$ 与 $\\phi$ 耦合或从 $\\phi$ 重建，从而兼具 $\\psi$ 的清晰界面表示和 $\\phi$ 的质量守恒性的优点。\n-   **结论：正确。**\n\n**B. 质量仅因 $\\nabla\\cdot\\mathbf{u} \\neq 0$ 而改变，因此重新初始化不是一个因素。守恒的替代方案是增加伪时间步长，以更严格地强制 $|\\nabla \\psi| = 1$。**\n\n-   前提是错误的。问题陈述了 $\\nabla \\cdot \\mathbf{u} = 0$。我们的推导表明，质量在物理平流期间是守恒的，但在重新初始化期间*不*守恒。在水平集方法中，重新初始化是导致质量损失的主要因素。\n-   提出的替代方案具有误导性。强制 $|\\nabla \\psi| = 1$ 是重新初始化的目的，而不是一种保持质量的方法。激进的重新初始化可能会加剧质量守恒误差。\n-   **结论：不正确。**\n\n**C. 根据链式法则，$\\mathrm{d}M/\\mathrm{d}\\tau = 0$，因为零水平集在重新初始化期间是固定的。守恒的替代方案是完全放弃输运方程，并将 $\\psi$ 保持为符号距离函数。**\n\n-   前提是错误的。虽然理想的重新初始化不会移动零等值线，但 $\\partial_\\tau \\psi = \\mathcal{R}(\\psi,\\nabla\\psi)$ 的实际数值格式确实会导致其移动，从而产生质量误差。我的推导明确表明，通常情况下 $\\mathrm{d}M/\\mathrm{d}\\tau \\neq 0$。\n-   提出的替代方案是荒谬的。输运方程 $\\partial_t \\psi + \\mathbf{u}\\cdot\\nabla\\psi = 0$ 描述了界面随流体的运动。放弃它将意味着界面是静止的，这在物理上是错误的。\n-   **结论：不正确。**\n\n**D. $\\mathrm{d}M/\\mathrm{d}\\tau$ 等于平均曲率的积分；因此质量损失与曲率成正比。守恒的替代方案是在物理时间内向 $\\partial_t \\psi + \\mathbf{u}\\cdot\\nabla \\psi$ 添加依赖于曲率的扩散项。**\n\n-   第一个陈述是错误的。我的推导表明 $\\mathrm{d}M/\\mathrm{d}\\tau = \\int_{\\Gamma(t)} (\\partial_\\tau \\psi / |\\nabla \\psi|)\\,\\mathrm{d}S$。这通常不等于平均曲率的积分。某些物理现象（如表面张力）或特定的重新初始化方案可能涉及曲率，但这对于任何算子 $\\mathcal{R}$ 都不是一个普遍的结果。\n-   提出的替代方案是不正确的。向物理输运方程添加依赖于曲率的扩散项是模拟一个物理过程（例如，表面张力），该过程本身就会改变相的体积。它不是一种强制质量守恒的技术。\n-   **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}