{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习是偏微分方程数值方法的基石。我们将对一维泊松方程进行离散化，并实现一个求解器，这个方程是模拟压力场或静电势等多种物理现象的模型。本练习的关键目标是通过数值实验验证我们所构建的方法能够达到其理论上预测的二阶精度，这是建立对任何数值代码信心的关键一步。这个实践为我们理解精度和收敛性奠定了基础。",
            "id": "4087184",
            "problem": "考虑一个在计算复杂流体中为压力修正建模时常出现的、一维空间中的标量场边值问题：求解区间 $[0,1]$ 上的二阶常微分方程 $-u_{xx}=f$，并满足齐次狄利克雷边界条件 $u(0)=0$ 和 $u(1)=0$。从足够光滑函数的泰勒展开和微积分中导数的定义出发，推导一种在均匀网格上使用三点拉普拉斯模板来近似内部网格点上 $-u_{xx}$ 的有限差分法 (FDM)。证明该空间离散化的截断误差是关于网格间距的二阶。然后，实现一个数值求解器，该求解器在均匀网格上构建并求解所得到的线性系统，并对强迫项 $f(x)=\\sin(\\pi x)$（其中三角函数参数以弧度为单位）进行经验性验证，证明该方法表现出二阶收敛性。\n\n需要完成的任务：\n- 使用关于均匀网格间距为 $h>0$ 的内部点 $x_i$ 的泰勒展开，推导 $u_{xx}(x_i)$ 的三点离散近似，并推断出截断误差的主阶项。总结出 $-u_{xx}$ 离散近似的精度阶。\n- 对区间 $[0,1]$ 使用 $N$ 个均匀子区间，其中 $h=1/N$ 且内部点索引为 $i=1,2,\\dots,N-1$，构建在该区间所有内部网格点上应用此离散近似所获得的线性系统。精确地施加边界条件 $u(0)=0$ 和 $u(1)=0$。\n- 对于制造的强迫项 $f(x)=\\sin(\\pi x)$，使用常微分方程的基本积分计算精确解 $u(x)$，并用它来评估数值误差。\n\n数值实验规范：\n- 将内部点的离散误差定义为数值解与精确解之差。计算离散 $L^2$范数误差为 $\\left(\\,h\\sum_{i=1}^{N-1} e_i^2\\,\\right)^{1/2}$，离散 $L^\\infty$范数误差为 $\\max_{1\\le i\\le N-1} |e_i|$。\n- 对于一系列均匀网格，其中 $N\\in\\{2,4,8,16,32,64\\}$，计算两种范数下的误差。通过 $p=\\dfrac{\\log(e(h_1)/e(h_2))}{\\log(h_1/h_2)}$ 来估计网格间距为 $h_1$ 和 $h_2$ 的连续网格之间的观测收敛率，其中 $e(h)$ 表示网格尺寸为 $h$ 时的误差。\n- 确定两个布尔指标，定义如下：如果对于 $L^2$范数，配对 $(N,N')\\in\\{(8,16),(16,32),(32,64)\\}$ 的每个观测收敛率都位于区间 $[1.9,2.1]$ 内，则 $converges\\_L2$ 为真；如果对于 $L^\\infty$范数，同样的情况成立，则 $converges\\_\\infty$ 为真。\n\n角度单位要求：\n- 所有三角函数求值必须使用弧度。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个方括号括起来的逗号分隔列表。该列表依次由以下部分组成：网格对 $(2,4)$, $(4,8)$, $(8,16)$, $(16,32)$, $(32,64)$ 在 $L^2$范数下的观测收敛率序列，接着是相同网格对在 $L^\\infty$范数下的观测收敛率，最后是两个布尔值 $converges\\_L2$ 和 $converges\\_\\infty$。例如，输出结构应为 $[p_{L^2}(2\\to 4),p_{L^2}(4\\to 8),p_{L^2}(8\\to 16),p_{L^2}(16\\to 32),p_{L^2}(32\\to 64),p_{\\infty}(2\\to 4),p_{\\infty}(4\\to 8),p_{\\infty}(8\\to 16),p_{\\infty}(16\\to 32),p_{\\infty}(32\\to 64),converges\\_L2,converges\\_\\infty]$。",
            "solution": "该问题是有效的，因为它在科学上基于微分方程和数值分析理论，是适定的，具有唯一解，并且其陈述客观，要求清晰、可形式化。它提出了一个用于推导、实现和验证一维泊松方程有限差分法的标准练习。\n\n解答按要求分为三个部分：数值格式及其截断误差的推导，所得线性系统的构建，以及给定强迫项的精确解的确定。随后是对数值实现的描述。\n\n**第一部分：三点模板和截断误差的推导**\n\n我们寻求在均匀网格上（网格间距 $h > 0$）近似内部网格点 $x_i$ 处的二阶导数 $u_{xx}$。网格点定义为 $x_j = j h$，其中 $j$ 为整数。我们使用泰勒定理在 $x_i$ 周围展开函数 $u(x)$。对于一个足够光滑的函数 $u$，$u(x_i+h)$ 和 $u(x_i-h)$ 的展开式为：\n$$ u(x_i+h) = u(x_{i+1}) = u(x_i) + h u'(x_i) + \\frac{h^2}{2!} u''(x_i) + \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\n$$ u(x_i-h) = u(x_{i-1}) = u(x_i) - h u'(x_i) + \\frac{h^2}{2!} u''(x_i) - \\frac{h^3}{3!} u'''(x_i) + \\frac{h^4}{4!} u^{(4)}(x_i) + O(h^5) $$\n将这两个方程相加可以消去奇数阶导数项：\n$$ u(x_{i-1}) + u(x_{i+1}) = 2u(x_i) + h^2 u''(x_i) + \\frac{2h^4}{24} u^{(4)}(x_i) + O(h^6) $$\n整理方程以求解 $u''(x_i)$，我们得到：\n$$ u''(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} - \\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\n二阶导数的中心有限差分近似，记为 $\\delta_x^2 u(x_i)$，是此表达式中的主项：\n$$ \\delta_x^2 u(x_i) = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2} $$\n截断误差 $\\tau_i$ 是精确导数与其有限差分近似之间的差值：\n$$ \\tau_i = u''(x_i) - \\delta_x^2 u(x_i) = -\\frac{h^2}{12} u^{(4)}(x_i) + O(h^4) $$\n截断误差的主阶项与 $h^2$ 成正比。因此，该近似是二阶精确的。微分方程为 $-u_{xx} = f$。我们使用所推导模板的负值来近似 $-u_{xx}$：\n$$ -u_{xx}(x_i) \\approx \\frac{-u(x_{i-1}) + 2u(x_i) - u(x_{i+1})}{h^2} $$\n这个用于 $-u_{xx}$ 的三点模板近似也是二阶精确的，其主阶截断误差为 $\\frac{h^2}{12} u^{(4)}(x_i)$。\n\n**第二部分：线性系统的构建**\n\n我们使用 $N$ 个子区间来离散化定义域 $[0,1]$，使得网格间距为 $h=1/N$。网格点为 $x_i = i h$，其中 $i=0, 1, \\dots, N$。解在内部点 $x_i$ 上求解，其中 $i=1, 2, \\dots, N-1$。令 $u_i$ 为 $u(x_i)$ 的数值近似，令 $f_i = f(x_i)$。\n\n在每个内部网格点 $x_i$ 上应用有限差分近似：\n$$ \\frac{-u_{i-1} + 2u_i - u_{i+1}}{h^2} = f_i, \\quad \\text{对于 } i=1, 2, \\dots, N-1 $$\n齐次狄利克雷边界条件是 $u(0)=0$ 和 $u(1)=0$，这意味着 $u_0=0$ 和 $u_N=0$。我们将这些条件代入 $i=1$ 和 $i=N-1$ 的方程中：\n对于 $i=1$：\n$$ \\frac{-u_0 + 2u_1 - u_2}{h^2} = f_1 \\implies \\frac{2u_1 - u_2}{h^2} = f_1 $$\n对于 $i=N-1$：\n$$ \\frac{-u_{N-2} + 2u_{N-1} - u_N}{h^2} = f_{N-1} \\implies \\frac{-u_{N-2} + 2u_{N-1}}{h^2} = f_{N-1} $$\n这组 $N-1$ 个线性方程可以写成矩阵形式 $A\\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$ 是未知解值的向量，$\\mathbf{b} = [f_1, f_2, \\dots, f_{N-1}]^T$ 是强迫项值的向量，$A$ 是 $(N-1) \\times (N-1)$ 的系数矩阵。\n$$ A = \\frac{1}{h^2} \\begin{pmatrix}\n2  -1  0  \\cdots  0  0 \\\\\n-1  2  -1  \\cdots  0  0 \\\\\n0  -1  2  \\ddots  \\vdots  \\vdots \\\\\n\\vdots  \\vdots  \\ddots  \\ddots  -1  0 \\\\\n0  0  \\cdots  -1  2  -1 \\\\\n0  0  \\cdots  0  -1  2\n\\end{pmatrix} $$\n该矩阵是对称、正定且三对角的。该线性系统有唯一解，可以通过数值方法求得。\n\n**第三部分：精确解**\n\n给定强迫项 $f(x) = \\sin(\\pi x)$，微分方程为 $-u_{xx} = \\sin(\\pi x)$。我们通过对 $x$ 积分两次来求解。\n第一次积分：\n$$ -u_x = \\int \\sin(\\pi x) \\,dx = -\\frac{1}{\\pi}\\cos(\\pi x) + C_1 $$\n$$ u_x = \\frac{1}{\\pi}\\cos(\\pi x) - C_1 $$\n第二次积分：\n$$ u(x) = \\int \\left(\\frac{1}{\\pi}\\cos(\\pi x) - C_1\\right) dx = \\frac{1}{\\pi^2}\\sin(\\pi x) - C_1 x + C_2 $$\n现在我们应用边界条件来求解积分常数 $C_1$ 和 $C_2$。\n在 $x=0$ 处，$u(0)=0$：\n$$ u(0) = \\frac{1}{\\pi^2}\\sin(0) - C_1(0) + C_2 = 0 \\implies C_2=0 $$\n在 $x=1$ 处，$u(1)=0$：\n$$ u(1) = \\frac{1}{\\pi^2}\\sin(\\pi) - C_1(1) + 0 = 0 \\implies 0 - C_1 = 0 \\implies C_1=0 $$\n因此，该边值问题的精确解为：\n$$ u(x) = \\frac{1}{\\pi^2}\\sin(\\pi x) $$\n\n**数值实验**\n\n为验证该方法的二阶收敛性，我们进行一个数值实验。对于一系列网格，其中 $N \\in \\{2, 4, 8, 16, 32, 64\\}$，我们求解线性系统 $A\\mathbf{u}=\\mathbf{b}$ 以找到数值解 $\\mathbf{u}$。然后，我们计算内部网格点上的精确解，并计算误差向量 $\\mathbf{e} = \\mathbf{u} - \\mathbf{u}_{\\text{exact}}$。计算离散 $L^2$ 和 $L^\\infty$ 误差范数。网格间距为 $h_1$ 和 $h_2$（其中 $h_1=2h_2$）的两个连续网格之间的收敛率 $p$ 通过 $p = \\log_2(e(h_1)/e(h_2))$ 来估计。由于该方法是二阶精确的，我们期望当 $h \\to 0$ 时，$p$ 趋近于 2。布尔指标 $converges\\_L2$ 和 $converges\\_\\infty$ 根据最精细的三个网格细化所观测到的收敛率是否落在区间 $[1.9, 2.1]$ 内来评估。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and verifies a second-order finite difference method\n    for the 1D Poisson equation -u_xx = f on [0,1] with u(0)=u(1)=0.\n    \"\"\"\n    \n    N_values = [2, 4, 8, 16, 32, 64]\n    l2_errors = {}\n    linf_errors = {}\n\n    for N in N_values:\n        # 1. Setup grid and parameters\n        h = 1.0 / N\n        # Interior grid points from x_1 to x_{N-1}\n        x_interior = np.linspace(h, 1.0 - h, N - 1)\n\n        # 2. Construct the linear system A*u = f\n        # Construct the (N-1)x(N-1) matrix A for -d^2/dx^2\n        # A = (1/h^2) * Tridiag(-1, 2, -1)\n        A = (2.0 * np.eye(N - 1) - np.eye(N - 1, k=1) - np.eye(N - 1, k=-1)) / h**2\n\n        # Construct the right-hand side vector f\n        f = np.sin(np.pi * x_interior)\n\n        # 3. Solve the linear system for the numerical solution\n        u_numerical = np.linalg.solve(A, f)\n\n        # 4. Compute the exact solution\n        u_exact = (1.0 / np.pi**2) * np.sin(np.pi * x_interior)\n\n        # 5. Compute errors\n        errors = u_numerical - u_exact\n        \n        # Discrete L2-norm: (h * sum(e_i^2))^(1/2)\n        l2_err = np.sqrt(h * np.sum(errors**2))\n        \n        # Discrete L-infinity norm: max|e_i|\n        linf_err = np.max(np.abs(errors))\n        \n        l2_errors[N] = l2_err\n        linf_errors[N] = linf_err\n\n    # 6. Calculate convergence rates\n    l2_rates = []\n    linf_rates = []\n    for i in range(len(N_values) - 1):\n        N1 = N_values[i]\n        N2 = N_values[i+1]\n        \n        h1 = 1.0 / N1\n        h2 = 1.0 / N2\n\n        # Rate formula: p = log(error(h1)/error(h2)) / log(h1/h2)\n        # Since h1/h2 is always 2, this simplifies to log2(error_ratio).\n        rate_l2 = np.log2(l2_errors[N1] / l2_errors[N2])\n        l2_rates.append(rate_l2)\n        \n        rate_linf = np.log2(linf_errors[N1] / linf_errors[N2])\n        linf_rates.append(rate_linf)\n\n    # 7. Check convergence criteria for the last three refinements\n    # These correspond to pairs (8,16), (16,32), (32,64)\n    # The rates list has indices 0, 1, 2, 3, 4 for pairs (2,4), (4,8), (8,16), (16,32), (32,64)\n    # So we check rates at indices 2, 3, 4.\n    relevant_l2_rates = l2_rates[2:]\n    relevant_linf_rates = linf_rates[2:]\n    \n    converges_L2 = all(1.9 = r = 2.1 for r in relevant_l2_rates)\n    converges_infty = all(1.9 = r = 2.1 for r in relevant_linf_rates)\n\n    # 8. Format and print the final output\n    # The order is: 5 L2 rates, 5 L-inf rates, 2 booleans\n    results = l2_rates + linf_rates + [converges_L2, converges_infty]\n    \n    # Map all items to string for printing\n    # Booleans will be converted to 'True' or 'False'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实世界的问题通常需要在边界上指定通量（梯度），而不仅仅是固定值。这个实践专注于为诺伊曼（Neumann）边界条件推导一个数值上相容的格式。通过在边界点进行泰勒级数展开，我们将开发一种能够保持内部格式二阶精度的方法，这对于精确模拟输运现象至关重要。",
            "id": "4087217",
            "problem": "在一个用于复杂流体的一维稳态输运模型中，标量场 $u(x)$ 在区间 $[0,L]$ 上满足偏微分方程(PDE) $-u_{xx}(x)=f(x)$，其中 $f(x)$ 是一个光滑源项。$x=0$ 处的边界服从给定的法向梯度（Neumann条件）$u_{x}(0)=\\alpha$，其中 $\\alpha$ 是一个给定常数。考虑一个均匀网格 $x_{i}=i\\,h$（$i=0,1,\\dots,N$），其网格尺寸为 $h=L/N$。令 $u_{i}$ 表示 $u(x_{i})$ 的近似值，$f_{i}=f(x_{i})$。\n\n你需要构建一种空间离散化方法，该方法对内部点 $i=1,2,\\dots,N-1$ 使用标准的二阶中心有限差分格式。在边界 $x=0$ 处，推导一个与内部格式的二阶精度相符的离散代数关系式，并消除任何虚拟值。你的推导必须从关于 $x=0$ 的泰勒展开以及控制方程 $-u_{xx}=f$ 和 $u_{x}(0)=\\alpha$ 开始，并且必须证明所得边界关系式的精度阶。\n\n给出 $u_{0}$ 关于 $u_{1}$、$f_{0}$、$\\alpha$ 和 $h$ 的单一闭式表达式作为最终结果。不需要数值，也无需四舍五入。最终答案必须是无单位的单一解析表达式。",
            "solution": "该问题要求推导在边界 $x=0$ 处标量值 $u_0$ 的一个二阶精度的离散代数关系式。该关系式必须与控制偏微分方程(PDE) $-u_{xx}(x)=f(x)$ 和 Neumann 边界条件 $u_x(0)=\\alpha$ 相符。推导必须基于泰勒级数展开，并且必须消除任何虚拟点。\n\n内部节点 $i=1, 2, \\dots, N-1$ 使用二阶中心差分格式对二阶导数进行离散化：\n$$\n- \\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2} = f_i\n$$\n此格式是二阶精度的，意味着其局部截断误差为 $O(h^2)$。任务是为边界节点 $u_0$ 找到一个关系式，以使整体数值方法保持此精度水平。\n\n我们首先考虑函数 $u(x)$ 在点 $x=0$ 附近的泰勒级数展开。展开至三阶项，我们有：\n$$\nu(x) = u(0) + x u_x(0) + \\frac{x^2}{2!} u_{xx}(0) + \\frac{x^3}{3!} u_{xxx}(0) + O(x^4)\n$$\n我们在离边界最近的第一个网格点 $x_1 = h$ 处计算此展开式：\n$$\nu(h) = u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n问题陈述提供了两个可以代入此展开式的控制方程。\n首先，Neumann 边界条件指定了 $x=0$ 处的一阶导数：\n$$\nu_x(0) = \\alpha\n$$\n其次，PDE 本身 $-u_{xx}(x)=f(x)$ 在定义域中的每一点都成立，包括边界 $x=0$ 处。因此，我们有：\n$$\n-u_{xx}(0) = f(0) \\implies u_{xx}(0) = -f(0)\n$$\n将这两个精确关系代入 $u(h)$ 的泰勒展开式中：\n$$\nu(h) = u(0) + h \\alpha + \\frac{h^2}{2} (-f(0)) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n在我们的离散记法中，$u_i$ 是 $u(x_i)$ 的近似值，因此我们有 $u_0 \\approx u(0)$，$u_1 \\approx u(h)$，以及 $f_0 = f(x_0) = f(0)$。通过截断级数并忽略 $h^3$ 及更高阶的项，我们得到一个离散关系式：\n$$\nu_1 = u_0 + h\\alpha - \\frac{h^2}{2}f_0\n$$\n这个代数关系式利用给定数据 $\\alpha$、$f_0$ 和网格尺寸 $h$，将边界值 $u_0$ 与相邻的内部值 $u_1$ 联系起来。它不涉及任何虚拟点。\n\n我们现在必须证明这个关系式“与内部格式的二阶精度相符”。这意味着边界格式的局部截断误差必须至少为 $O(h^2)$。推导出的关系式可以重新整理，为边界条件 $u_x(0) = \\alpha$ 提供一个近似：\n$$\n\\frac{u_1 - u_0}{h} + \\frac{h}{2}f_0 = \\alpha\n$$\n让我们分析这个数值格式的局部截断误差 $\\tau_0$。截断误差是通过将精确解 $u(x)$ 代入离散算子，然后减去它所要近似的精确量，即 $u_x(0)$，来求得的。\n$$\n\\tau_0 = \\left( \\frac{u(h) - u(0)}{h} + \\frac{h}{2}f(0) \\right) - u_x(0)\n$$\n使用 PDE，我们将 $f(0)$ 替换为 $-u_{xx}(0)$：\n$$\n\\tau_0 = \\left( \\frac{u(h) - u(0)}{h} - \\frac{h}{2}u_{xx}(0) \\right) - u_x(0)\n$$\n现在，我们使用 $u(h) - u(0)$ 的泰勒展开：\n$$\nu(h) - u(0) = h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)\n$$\n除以 $h$：\n$$\n\\frac{u(h) - u(0)}{h} = u_x(0) + \\frac{h}{2} u_{xx}(0) + \\frac{h^2}{6} u_{xxx}(0) + O(h^3)\n$$\n将此式代入 $\\tau_0$ 的表达式中：\n$$\n\\tau_0 = \\left( u_x(0) + \\frac{h}{2} u_{xx}(0) + \\frac{h^2}{6} u_{xxx}(0) + O(h^3) \\right) - \\frac{h}{2}u_{xx}(0) - u_x(0)\n$$\n各项相消如下：\n$$\n\\tau_0 = (u_x(0) - u_x(0)) + \\left(\\frac{h}{2} u_{xx}(0) - \\frac{h}{2} u_{xx}(0)\\right) + \\frac{h^2}{6} u_{xxx}(0) + O(h^3)\n$$\n$$\n\\tau_0 = \\frac{h^2}{6} u_{xxx}(0) + O(h^3)\n$$\n截断误差中的主导项是 $h^2$ 阶的。因此，推导出的边界格式是二阶精度的，这与要求一致，即与内部格式相符。\n\n最后一步是给出 $u_0$ 的闭式表达式。我们重新整理离散关系式 $u_1 = u_0 + h\\alpha - \\frac{h^2}{2}f_0$：\n$$\nu_0 = u_1 - h\\alpha + \\frac{h^2}{2}f_0\n$$\n这个表达式给出了边界节点的值 $u_0$，用第一个内部节点的值 $u_1$、Neumann 条件参数 $\\alpha$、边界上的源项 $f_0$ 以及网格间距 $h$ 来表示。",
            "answer": "$$\\boxed{u_1 - \\alpha h + \\frac{1}{2} f_0 h^2}$$"
        },
        {
            "introduction": "复杂流体通常是异质的，材料属性（如扩散系数 $\\mu(x)$）会在界面处发生突变。本练习旨在应对这一挑战，通过比较一个非守恒格式和一个守恒的有限体积式离散格式。你将亲眼看到，在处理非连续系数问题时，为何在界面上强制通量守恒对于获得物理上有意义的结果至关重要。",
            "id": "4087183",
            "problem": "考虑一个标量场 $\\,\\phi(x)\\,$ 的一维稳态扩散，该过程由守恒律控制\n$$\\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right)=q(x),$$\n其中 $\\,\\mu(x)0\\,$ 是扩散系数，$\\,q(x)\\,$ 是给定的体积源。在复杂流体中，由于微观结构的变化，$\\,\\mu(x)\\,$ 可能会在材料界面上表现出不连续性。假设在一个长度为 $\\,L\\,$ 的区域上有一个包含 $\\,N\\,$ 个节点的均匀计算网格，节点间距为 $\\,\\Delta x = L/(N-1)\\,$。设扩散系数为分段常数，\n$$\n\\mu(x)=\\begin{cases}\n\\mu_L, x\\le x_\\mathrm{int},\\\\\n\\mu_R, xx_\\mathrm{int},\n\\end{cases}\n$$\n材料界面与节点 $\\,i=j_\\mathrm{int}\\,$ 和 $\\,i=j_\\mathrm{int}+1\\,$ 之间的一个内表面对齐，因此 $\\,x_\\mathrm{int}=\\tfrac{1}{2}(x_{j_\\mathrm{int}}+x_{j_\\mathrm{int}+1})\\,$。施加 Dirichlet 边界条件 $\\,\\phi(0)=\\phi_L\\,$ 和 $\\,\\phi(L)=\\phi_R\\,$，并取恒定源 $\\,q(x)\\equiv q\\,$。\n\n从每个控制体积 $[x_{i-1/2},x_{i+1/2}]$ 上的守恒律积分形式和扩散通量 $\\,F=-\\mu\\,\\frac{d\\phi}{dx}\\,$ 的定义出发，推导两种空间离散化方法：\n\n- 一种守恒通量格式，它表示每个面上的界面通量，并强制通过共享面的通量具有唯一值。对 $\\,\\mu\\,$ 使用一种一致的面插值方法，该方法仅依赖于 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$，并且对于不连续系数尊重单调性。\n\n- 一种非守恒的逐点系数格式，它将二阶导数的近似值乘以 $\\,\\mu\\,$ 的节点值。\n\n使用两种离散化方法，在相同的网格和参数集上求解得到的关于 $\\,\\phi\\,$ 的线性系统，然后计算单一材料界面处的通量跳跃度量。使用索引 $\\,j_\\mathrm{int}\\,$ 定义界面，使得不连续性位于节点 $\\,j_\\mathrm{int}\\,$ 和 $\\,j_\\mathrm{int}+1\\,$ 之间。对于守恒离散化，使用唯一的面通量计算从左侧单元穿过界面面的向外通量和从右侧单元穿过同一面的向外通量；通过报告这两个向外通量之和的绝对值来验证通量的连续性。对于非守恒离散化，通过将跨界面的相同离散梯度分别乘以 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$，计算界面处的两个不同的本构面通量，并报告它们差值的绝对值。\n\n您的程序必须实现这两种离散化方法，求解线性系统，并为以下参数集测试套件 $\\,\\{L,N,\\mu_L,\\mu_R,j_\\mathrm{int},\\phi_L,\\phi_R,q\\}\\,$ 生成所要求的通量跳跃度量：\n\n- 测试用例 $\\,1\\,$ (一般不连续性，无源): $\\,\\{L=\\;1.0,\\;N=\\;33,\\;\\mu_L=\\;1.0,\\;\\mu_R=\\;10.0,\\;j_\\mathrm{int}=\\;16,\\;\\phi_L=\\;0.0,\\;\\phi_R=\\;1.0,\\;q=\\;0.0\\}\\,$。\n- 测试用例 $\\,2\\,$ (高对比度，反转边界值，无源): $\\,\\{L=\\;1.0,\\;N=\\;65,\\;\\mu_L=\\;0.1,\\;\\mu_R=\\;100.0,\\;j_\\mathrm{int}=\\;32,\\;\\phi_L=\\;1.0,\\;\\phi_R=\\;0.0,\\;q=\\;0.0\\}\\,$。\n- 测试用例 $\\,3\\,$ (无不连续性，无源): $\\,\\{L=\\;1.0,\\;N=\\;41,\\;\\mu_L=\\;2.0,\\;\\mu_R=\\;2.0,\\;j_\\mathrm{int}=\\;20,\\;\\phi_L=\\;0.0,\\;\\phi_R=\\;1.0,\\;q=\\;0.0\\}\\,$。\n- 测试用例 $\\,4\\,$ (一般不连续性，非零源): $\\,\\{L=\\;2.0,\\;N=\\;81,\\;\\mu_L=\\;1.0,\\;\\mu_R=\\;10.0,\\;j_\\mathrm{int}=\\;40,\\;\\phi_L=\\;0.0,\\;\\phi_R=\\;0.0,\\;q=\\;5.0\\}\\,$。\n\n对于每个测试用例，输出一对 $[\\mathrm{J}_\\mathrm{cons},\\mathrm{J}_\\mathrm{noncons}]$，其中 $\\,\\mathrm{J}_\\mathrm{cons}\\,$ 是使用守恒离散化计算的与界面面相邻的两个单元的向外通量之和的绝对值，而 $\\,\\mathrm{J}_\\mathrm{noncons}\\,$ 是使用非守恒离散化并利用 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$ 计算的两个本构面通量之差的绝对值。您的程序应生成单行输出，其中包含结果，形式为用方括号括起来的这些对的逗号分隔列表（例如，$\\,[[\\mathrm{J}_{1,\\mathrm{cons}},\\mathrm{J}_{1,\\mathrm{noncons}}],[\\mathrm{J}_{2,\\mathrm{cons}},\\mathrm{J}_{2,\\mathrm{noncons}}],\\dots]\\,$）。不需要物理单位；不使用角度；不要使用百分号表示任何量。",
            "solution": "该问题是有效的，因为它具有科学依据、良态且客观。它提出了一个计算输运现象中的标准练习，对比了用于具有不连续系数的扩散方程的守恒和非守恒数值格式。所有参数和条件都已明确定义。\n\n分析首先建立一个以单元为中心的有限体积框架。长度为 $\\,L\\,$ 的一维区域被离散化为 $\\,N\\,$ 个节点，节点位置为 $\\,x_i = i\\,\\Delta x\\,$，其中 $\\,i=0, 1, \\dots, N-1\\,$，且 $\\,\\Delta x = L/(N-1)\\,$。对于每个内部节点 $\\,i\\,$，我们定义一个控制体积 $\\,V_i = [x_{i-1/2}, x_{i+1/2}]\\,$，其中面位于节点之间的中点，$\\,x_{i \\pm 1/2} = x_i \\pm \\Delta x/2\\,$。\n\n控制方程是标量场 $\\,\\phi(x)\\,$ 的稳态守恒律：\n$$ \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) = q(x) $$\n扩散通量定义为 $\\,F(x) = -\\mu(x)\\,\\frac{d\\phi}{dx}\\,$。控制方程可以用通量重写为 $\\,-\\frac{dF}{dx} = q(x)\\,$。\n\n### 守恒有限体积离散化\n\n该格式由守恒律在任意控制体积 $\\,V_i\\,$ 上的积分形式推导而来：\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{d}{dx}\\left(\\mu(x)\\,\\frac{d\\phi}{dx}\\right) dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} q(x) dx $$\n对左侧应用微积分基本定理可得：\n$$ \\left[\\mu(x)\\,\\frac{d\\phi}{dx}\\right]_{x_{i-1/2}}^{x_{i+1/2}} = q \\cdot \\Delta x $$\n这里我们假设 $\\,q(x)\\,$ 是一个常数 $\\,q\\,$。这表示了跨控制体积面的通量平衡：\n$$ \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} - \\left(\\mu\\frac{d\\phi}{dx}\\right)_{i-1/2} = q \\Delta x $$\n用通量 $\\,F\\,$ 表示，即为 $\\,F_{i-1/2} - F_{i+1/2} = q \\Delta x\\,$。\n\n每个面上的通量使用 $\\,\\phi\\,$ 的节点值的中心差分来近似：\n$$ F_{i+1/2} = -\\left(\\mu\\frac{d\\phi}{dx}\\right)_{i+1/2} \\approx -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\n此处，$\\,\\mu_{i+1/2}\\,$ 是节点 $\\,i\\,$ 和 $\\,i+1\\,$ 之间面上的扩散系数。将此近似代入内部节点 $\\,i \\in \\{1, \\dots, N-2\\}\\,$ 的通量平衡方程，得到：\n$$ -\\mu_{i+1/2} \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} - \\left(-\\mu_{i-1/2} \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\\right) = q \\Delta x $$\n重新整理可得到关于 $\\,\\phi_i\\,$ 的线性方程：\n$$ \\mu_{i-1/2} \\phi_{i-1} - (\\mu_{i-1/2} + \\mu_{i+1/2}) \\phi_i + \\mu_{i+1/2} \\phi_{i+1} = q (\\Delta x)^2 $$\n该方法守恒性的关键在于面扩散率 $\\,\\mu_{i+1/2}\\,$ 的定义。问题陈述了材料界面位于 $\\,x_\\mathrm{int} = x_{j_\\mathrm{int}+1/2}\\,$，分隔了系数为 $\\,\\mu_L\\,$ 和 $\\,\\mu_R\\,$ 的区域。\n- 如果位于 $\\,x_{i+1/2}\\,$ 的面不是材料界面，则其上的系数是恒定的：若 $\\,i  j_\\mathrm{int}\\,$，则 $\\,\\mu_{i+1/2} = \\mu_L\\,$；若 $\\,i > j_\\mathrm{int}\\,$，则 $\\,\\mu_{i+1/2} = \\mu_R\\,$。\n- 在界面面 $\\,x_{j_\\mathrm{int}+1/2}\\,$ 处，一个能确保通量连续性并且对于不连续系数保持单调性的一致性插值是调和平均值：\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\left(\\frac{1-f}{\\mu_L} + \\frac{f}{\\mu_R}\\right)^{-1} $$\n由于界面位于节点之间的中点（$\\,f=1/2\\,$），这简化为：\n$$ \\mu_{j_\\mathrm{int}+1/2} = \\frac{2\\mu_L\\mu_R}{\\mu_L+\\mu_R} $$\n这种选择确保了数值通量 $\\,F_{j_\\mathrm{int}+1/2}\\,$ 具有单一、唯一的值，从而强制实现物理守恒。\n\n关于内部节点 $\\,\\phi_1, \\dots, \\phi_{N-2}\\,$ 的线性方程组构成一个三对角系统 $\\,A\\boldsymbol{\\phi} = \\mathbf{b}\\,$。Dirichlet 边界条件 $\\,\\phi_0 = \\phi_L\\,$ 和 $\\,\\phi_{N-1} = \\phi_R\\,$ 通过将相应项移到右侧向量 $\\,\\mathbf{b}\\,$ 中来合并。\n\n### 非守恒逐点系数离散化\n\n这种方法从控制方程的展开形式开始：$\\,\\mu\\,\\frac{d^2\\phi}{dx^2} + \\frac{d\\mu}{dx}\\frac{d\\phi}{dx} = q\\,$。非守恒格式通过近似项 $\\,\\mu(x_i) \\frac{d^2\\phi}{dx^2}\\,$ 并忽略包含 $\\,\\frac{d\\mu}{dx}\\,$ 的项，来在每个节点 $\\,i\\,$ 处离散化方程。在 $\\,\\mu\\,$ 不是常数的地方，这在形式上是不正确的。\n对二阶导数使用标准的中心差分，离散方程变为：\n$$ \\mu_i \\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{(\\Delta x)^2} = q $$\n其中 $\\,\\mu_i = \\mu(x_i)\\,$ 是扩散系数的节点值。根据 $\\,\\mu(x)\\,$ 的定义，我们有：\n$$ \\mu_i = \\begin{cases} \\mu_L,  i \\le j_\\mathrm{int} \\\\ \\mu_R,  i  j_\\mathrm{int} \\end{cases} $$\n对内部节点 $\\,i \\in \\{1, \\dots, N-2\\}\\,$ 进行重新整理，得到：\n$$ \\mu_i \\phi_{i-1} - 2\\mu_i \\phi_i + \\mu_i \\phi_{i+1} = q (\\Delta x)^2 $$\n这也为未知数 $\\,\\phi'_1, \\dots, \\phi'_{N-2}\\,$ 构成了一个三对角系统 $\\,A'\\boldsymbol{\\phi}' = \\mathbf{b}'\\,$，边界条件的处理方式类似。\n\n### 通量跳跃度量\n\n我们分析界面面 $\\,x_{j_\\mathrm{int}+1/2}\\,$ 处的通量连续性。\n\n对于**守恒格式**，界面面上的通量唯一定义为：\n$$ F_\\mathrm{cons} = -\\mu_{j_\\mathrm{int}+1/2} \\frac{\\phi_{j_\\mathrm{int}+1} - \\phi_{j_\\mathrm{int}}}{\\Delta x} $$\n其中 $\\,\\mu_{j_\\mathrm{int}+1/2}\\,$ 是调和平均值。从左侧单元（$\\,V_{j_\\mathrm{int}}\\,$）穿过该面的向外通量为 $\\,+F_\\mathrm{cons}\\,$。从右侧单元（$\\,V_{j_\\mathrm{int}+1}\\,$）穿过同个面的向外通量为 $\\,-F_\\mathrm{cons}\\,$。根据构造，这些向外通量之和为零。度量 $\\,J_\\mathrm{cons}\\,$ 是这个和的绝对值：\n$$ J_\\mathrm{cons} = |(+F_\\mathrm{cons}) + (-F_\\mathrm{cons})| = 0 $$\n这反映了该格式的局部守恒性质。\n\n对于**非守恒格式**，界面上没有唯一的通量定义。根据考虑的是界面的哪一侧，可以定义两种不同的本构通量。使用相同的梯度近似但不同的局部系数：\n- 从左侧材料的角度看的通量：$\\,F_L = -\\mu_L \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\,$\n- 从右侧材料的角度看的通量：$\\,F_R = -\\mu_R \\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\,$\n非守恒格式在计算的通量中产生一个跳跃，度量 $\\,J_\\mathrm{noncons}\\,$ 是这个物理上不正确的跳跃的绝对值：\n$$ J_\\mathrm{noncons} = |F_L - F_R| = |\\mu_R - \\mu_L| \\left|\\frac{\\phi'_{j_\\mathrm{int}+1} - \\phi'_{j_\\mathrm{int}}}{\\Delta x}\\right| $$\n当 $\\,\\mu_L \\ne \\mu_R\\,$ 时，该值通常为非零，表示违反了守恒原理。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares conservative and non-conservative finite difference\n    schemes for a 1D steady diffusion problem with a discontinuous coefficient.\n    \"\"\"\n    test_cases = [\n        # (L, N, mu_L, mu_R, j_int, phi_L, phi_R, q)\n        (1.0, 33, 1.0, 10.0, 16, 0.0, 1.0, 0.0),\n        (1.0, 65, 0.1, 100.0, 32, 1.0, 0.0, 0.0),\n        (1.0, 41, 2.0, 2.0, 20, 0.0, 1.0, 0.0),\n        (2.0, 81, 1.0, 10.0, 40, 0.0, 0.0, 5.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, N, mu_L, mu_R, j_int, phi_L, phi_R, q = case\n        \n        dx = L / (N - 1)\n        num_unknowns = N - 2\n\n        # --- CONSERVATIVE SCHEME ---\n        \n        # 1. Setup face diffusivities\n        mu_face = np.zeros(N - 1)\n        # Faces in the left material region\n        if j_int > 0:\n            mu_face[0:j_int] = mu_L\n        # Interface face (harmonic mean)\n        if mu_L + mu_R > 0:\n            mu_face[j_int] = (2 * mu_L * mu_R) / (mu_L + mu_R)\n        else: # Handle case of both mu are zero\n            mu_face[j_int] = 0.0\n        # Faces in the right material region\n        if j_int  N - 2:\n            mu_face[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A*phi = b\n        A_cons = np.zeros((num_unknowns, num_unknowns))\n        b_cons = np.full(num_unknowns, q * dx**2)\n\n        # Main diagonal\n        diag_main = -(mu_face[0:num_unknowns] + mu_face[1:num_unknowns+1])\n        # Lower diagonal\n        diag_lower = mu_face[0:num_unknowns-1]\n        # Upper diagonal\n        diag_upper = mu_face[1:num_unknowns]\n\n        np.fill_diagonal(A_cons, diag_main)\n        np.fill_diagonal(A_cons[1:], diag_lower)\n        np.fill_diagonal(A_cons[:,1:], diag_upper)\n\n        # Apply boundary conditions\n        b_cons[0] -= mu_face[0] * phi_L\n        b_cons[-1] -= mu_face[-1] * phi_R\n\n        # 3. Solve for interior phi values and construct full solution vector\n        phi_internal_cons = np.linalg.solve(A_cons, b_cons)\n        phi_cons = np.concatenate(([phi_L], phi_internal_cons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_cons = (phi_cons[j_int + 1] - phi_cons[j_int]) / dx\n        flux_cons = -mu_face[j_int] * flux_grad_cons\n        # Sum of outward fluxes from cell j_int and cell j_int+1 at the interface\n        J_cons = abs(flux_cons + (-flux_cons))\n\n\n        # --- NON-CONSERVATIVE SCHEME ---\n\n        # 1. Setup nodal diffusivities\n        mu_node = np.zeros(N)\n        mu_node[:j_int + 1] = mu_L\n        mu_node[j_int + 1:] = mu_R\n\n        # 2. Assemble the linear system A'*phi' = b'\n        A_noncons = np.zeros((num_unknowns, num_unknowns))\n        b_noncons = np.full(num_unknowns, q * dx**2)\n        \n        # Coefficients depend on mu_i for the equation at node i\n        mu_internal = mu_node[1:-1]\n        \n        # Main diagonal\n        diag_main_nc = -2.0 * mu_internal\n        # Lower diagonal\n        diag_lower_nc = mu_internal[1:]\n        # Upper diagonal\n        diag_upper_nc = mu_internal[:-1]\n\n        # Populate matrix A'\n        A_noncons = (np.diag(diag_main_nc) + \n                     np.diag(diag_upper_nc, k=1) + \n                     np.diag(diag_lower_nc, k=-1))\n\n        # Apply boundary conditions\n        b_noncons[0] -= mu_node[1] * phi_L\n        b_noncons[-1] -= mu_node[-2] * phi_R\n\n        # 3. Solve for interior phi' values and construct full solution vector\n        phi_internal_noncons = np.linalg.solve(A_noncons, b_noncons)\n        phi_noncons = np.concatenate(([phi_L], phi_internal_noncons, [phi_R]))\n\n        # 4. Calculate flux-jump metric\n        flux_grad_noncons = (phi_noncons[j_int + 1] - phi_noncons[j_int]) / dx\n        flux_L = -mu_L * flux_grad_noncons\n        flux_R = -mu_R * flux_grad_noncons\n        J_noncons = abs(flux_L - flux_R)\n\n        results.append([J_cons, J_noncons])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}