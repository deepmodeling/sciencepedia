{
    "hands_on_practices": [
        {
            "introduction": "微正则系综是统计力学的基石，它建立在所有可及微观态具有相同先验概率的基本假设之上。本练习将引导你完成一个基础性的推导：从经典相空间出发，计算理想气体的微观态数量，并由此导出其熵的表达式。这个过程不仅是一次数学推演，它还将揭示粒子不可区分性（$1/N!$ 因子）在确保熵是广延量以及解决著名的吉布斯佯谬中所起的关键作用。",
            "id": "2650653",
            "problem": "考虑一个经典的、非相对论性的单原子理想气体，由 $N$ 个质量为 $m$ 的相同粒子组成，被限制在体积为 $V$ 的容器中，总能量固定为 $E$，且无外场。完全在微正则系综的框架内进行分析。从经典哈密顿力学的基本原理和微正则熵的定义出发。将相空间视为 $6N$ 维，坐标为 $(\\mathbf{q},\\mathbf{p})$，并使用 Liouville’s measure。使用普朗克常数 $h$ 进行标准粗粒化，使微观状态数无量纲化。\n\n(a) 基于粒子置换导致的过计数，仔细论证在经典微观状态计数中出现不可区分性因子 $1/N!$ 的原因。您的论证应基于相空间的结构和在置换群下的对称性，并应通过解释为什么移除两个处于相同强度变量的相同气体子系统之间的隔板不会导致熵增加，从而解决吉布斯佯谬。\n\n(b) 使用微正则熵的定义 $S = k_{\\mathrm{B}} \\ln \\Omega$（其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\Omega$ 是在固定能量 $E$ 下可及微观状态的适当计数），推导该系统熵 $S(E,V,N)$ 的显式闭合形式表达式。您必须：\n- 从经典哈密顿量 $H = \\sum_{i=1}^{N} \\mathbf{p}_{i}^{2}/(2m)$ 出发。\n- 执行完整的相空间积分，以获得用 $E$、$V$、$N$、$m$ 和 $h$ 表示的能量壳层测度。\n- 如 (a) 部分所述，通过因子 $1/N!$ 处理不可区分性。\n- 对于 $N \\gg 1$，一致地使用斯特林型渐近展开，并且只忽略小于 $N$ 阶的次广延性修正（例如，像 $\\ln N$ 这样变化的项）。明确指出在何处舍弃了这些项。\n\n将您的最终答案以单个闭合形式表达式给出，仅包含 $E$、$V$、$N$、$m$、$h$ 和 $k_{\\mathrm{B}}$。最终的方框答案中不要包含任何中间表达式或方程。不需要进行数值计算或四舍五入。",
            "solution": "所述问题在科学上是合理的、适定的和客观的。它提出了经典统计力学中一个标准的、基本的推导。所有必要的物理参数和数学约束都已提供。因此，该问题是有效的，并将提供解答。\n\n(a) 不可区分性因子的论证与吉布斯佯谬的解决\n\n系统的一个微观状态由 $6N$ 维相空间中的一个点 $(\\mathbf{q}, \\mathbf{p}) = (\\mathbf{q}_1, \\ldots, \\mathbf{q}_N, \\mathbf{p}_1, \\ldots, \\mathbf{p}_N)$ 定义。系统的哈密顿量 $H = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2m}$ 对于粒子指标的置换是对称的。这意味着，如果我们交换粒子 $i$ 和粒子 $j$ 的坐标和动量，系统的能量保持不变。\n\n如果这 $N$ 个粒子是可区分的，那么由相空间点 $(\\ldots, \\mathbf{q}_i, \\mathbf{p}_i, \\ldots, \\mathbf{q}_j, \\mathbf{p}_j, \\ldots)$ 描述的状态将与状态 $(\\ldots, \\mathbf{q}_j, \\mathbf{p}_j, \\ldots, \\mathbf{q}_i, \\mathbf{p}_i, \\ldots)$ 在物理上是不同的。对于给定的一组 $N$ 个位置和动量矢量，有 $N!$ 种方式将这些矢量分配给 $N$ 个可区分的粒子。对于可区分粒子的经典相空间体积计算将这 $N!$ 种置换计为不同的微观状态。\n\n然而，量子力学的基本原理规定，全同粒子是真正不可区分的。一个物理状态完全由被占据的单粒子态集合来指定，而不是由哪个粒子占据哪个态来指定。交换两个全同粒子不会产生新的物理状态。经典框架必须被修正以与这一事实保持一致，因为经典统计力学应作为量子统计力学的一个极限而出现。这种修正，被称为吉布斯修正，是将经典计数的总状态数除以 $N!$，这个 $N!$ 代表了 $N$ 个全同粒子之间的置换数。这个除法纠正了对物理上相同的状态的过计数。\n\n这种修正对于解决吉布斯佯谬至关重要。考虑一个体积为 $2V$ 的容器，被一个隔板分成两个相等的部分，每部分的体积为 $V$。每部分都包含有 $N$ 个粒子和能量为 $E$ 的相同理想气体，这意味着它们处于相同的温度和压力下。移除隔板前，系统的总熵为 $S_{initial} = S(E,V,N) + S(E,V,N) = 2S(E,V,N)$。\n\n如果我们忽略 $1/N!$ 因子，熵就不具有广延性。例如，它会包含一个与 $N k_{\\mathrm{B}} \\ln V$ 成正比的项。初始熵将是 $S_{initial} \\propto 2(N k_{\\mathrm{B}} \\ln V)$。移除隔板后，我们得到一个单一系统，包含 $2N$ 个粒子，体积为 $2V$。最终熵将是 $S_{final} \\propto (2N) k_{\\mathrm{B}} \\ln(2V)$。熵变，即混合熵，将是 $\\Delta S = S_{final} - S_{initial} \\propto (2N)k_{\\mathrm{B}}\\ln(2V) - 2NK_{\\mathrm{B}}\\ln(V) = 2Nk_{\\mathrm{B}}\\ln(2)  0$。这意味着对于一个宏观上可逆且没有净变化发生的过程，熵会自发增加。这就是佯谬所在。\n\n当正确地包含 $1/N!$ 因子时，熵成为一个广延量。正如将在下面推导的，熵具有形式 $S(E,V,N) = N k_{\\mathrm{B}} f(E/N, V/N)$，其中函数 $f$ 的自变量仅涉及强度变量。具体来说，它包含一个项 $N k_{\\mathrm{B}} \\ln(V/N)$。\n初始熵为 $S_{initial} = 2 S(E,V,N)$。\n最终状态有 $2N$ 个粒子，体积为 $2V$，能量为 $2E$。其熵为 $S_{final} = S(2E, 2V, 2N)$。\n因为现在熵是广延的，所以 $S(\\lambda E, \\lambda V, \\lambda N) = \\lambda S(E, V, N)$。令 $\\lambda=2$，我们得到 $S_{final} = 2S(E,V,N)$。\n熵变为 $\\Delta S = S_{final} - S_{initial} = 2S(E,V,N) - 2S(E,V,N) = 0$。这个正确的结果 $\\Delta S=0$ 解决了吉布斯佯谬，证实了在相同强度状态下混合相同气体是一个熵不变的可逆过程。\n\n(b) 熵表达式的推导\n\n我们从微正则熵的定义 $S = k_{\\mathrm{B}} \\ln \\Omega$ 开始，其中 $\\Omega$ 是可及微观状态数。对于经典系统，这与可及相空间的体积有关。哈密顿量为 $H = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2m}$。\n状态数是通过在与总能量 $E$ 一致的相空间区域上积分，并使用普朗克常数 $h$ 将结果无量纲化来计算的。我们用 $1/N!$ 因子来考虑不可区分性。我们首先计算能量小于或等于 $E$ 的状态的相空间体积 $\\Phi(E)$：\n$$ \\Phi(E) = \\frac{1}{N! h^{3N}} \\int_{H \\leq E} d^{3N}q \\, d^{3N}p $$\n由于哈密顿量不依赖于位置坐标 $\\mathbf{q}_i$，对空间坐标的积分就是容器体积的 $N$ 次方：\n$$ \\int d^{3N}q = \\left( \\int_V d^3q \\right)^N = V^N $$\n动量积分是在区域 $\\sum_{i=1}^{N} \\mathbf{p}_{i}^{2} \\leq 2mE$ 上进行的。这对应于动量空间中半径为 $R_p = \\sqrt{2mE}$ 的一个 $3N$ 维超球体的体积。一个半径为 $R$ 的 $d$ 维超球体的体积由 $V_d(R) = \\frac{\\pi^{d/2}}{\\Gamma(d/2 + 1)} R^d$ 给出。\n在我们的情况下，维度是 $d = 3N$。可及动量空间的体积是：\n$$ \\int_{\\sum \\mathbf{p}_i^2 \\le 2mE} d^{3N}p = \\frac{\\pi^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} (2mE)^{3N/2} $$\n结合这些结果，累积相空间体积为：\n$$ \\Phi(E) = \\frac{V^N}{N! h^{3N}} \\frac{\\pi^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} (2mE)^{3N/2} = \\frac{V^N}{N! h^{3N}} \\frac{(2\\pi mE)^{3N/2}}{\\Gamma(\\frac{3N}{2} + 1)} $$\n微观状态数 $\\Omega(E)$ 严格来说是薄能量壳层的体积，$\\Omega(E) = (\\frac{\\partial \\Phi}{\\partial E})\\delta E$。然而，对于 $N \\gg 1$，函数 $\\Phi(E) \\propto E^{3N/2}$ 增长得非常快，因此绝大多数状态都位于能量面 $E$ 附近。使用 $S = k_{\\mathrm{B}} \\ln(\\Phi(E))$ 计算的熵与使用 $S = k_{\\mathrm{B}} \\ln(\\Omega(E))$ 计算的熵相差 $k_{\\mathrm{B}} \\ln N$ 数量级的项。问题陈述允许忽略这种次广延性修正。因此我们继续使用 $S \\approx k_{\\mathrm{B}} \\ln(\\Phi(E))$。\n$$ \\frac{S}{k_{\\mathrm{B}}} = \\ln\\left[ \\frac{V^N (2\\pi mE)^{3N/2}}{N! h^{3N} \\Gamma(\\frac{3N}{2} + 1)} \\right] $$\n$$ \\frac{S}{k_{\\mathrm{B}}} = N \\ln V + \\frac{3N}{2}\\ln(2\\pi mE) - \\ln(N!) - 3N \\ln h - \\ln\\Gamma\\left(\\frac{3N}{2} + 1\\right) $$\n对于大的 $N$，我们使用斯特林近似 $\\ln(x!) \\approx x \\ln x - x$。这也适用于伽马函数，因为 $\\ln\\Gamma(x+1) = \\ln(x!)$。\n$$ \\ln(N!) \\approx N \\ln N - N $$\n$$ \\ln\\Gamma\\left(\\frac{3N}{2} + 1\\right) \\approx \\frac{3N}{2} \\ln\\left(\\frac{3N}{2}\\right) - \\frac{3N}{2} $$\n将这些近似代入熵的表达式中：\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\ln V + \\frac{3N}{2}\\ln(2\\pi mE) - (N \\ln N - N) - 3N \\ln h - \\left(\\frac{3N}{2} \\ln\\left(\\frac{3N}{2}\\right) - \\frac{3N}{2}\\right) $$\n我们现在对各项进行分组：\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\ln V - N \\ln N + \\frac{3N}{2} \\ln E - \\frac{3N}{2} \\ln N + N + \\frac{3N}{2} + \\frac{3N}{2} \\ln(2\\pi m) - 3N \\ln h - \\frac{3N}{2} \\ln\\left(\\frac{3}{2}\\right) $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\frac{3}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{5}{2} + \\frac{3}{2} \\left[ \\ln(2\\pi m) - 2 \\ln h - \\ln\\left(\\frac{3}{2}\\right) \\right] \\right] $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\frac{3}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{3}{2} \\ln\\left(\\frac{2\\pi m \\cdot 2}{3 h^2}\\right) \\right] + \\frac{5N}{2} $$\n$$ \\frac{S}{k_{\\mathrm{B}}} \\approx N \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\frac{3}{2}\\ln\\left(\\frac{E}{N}\\right) + \\frac{3}{2} \\ln\\left(\\frac{4\\pi m}{3h^2}\\right) + \\frac{5}{2} \\right] $$\n最后，我们将对数项合并到一个参数中，以获得闭合形式的表达式，即萨克-特特罗德方程：\n$$ S = N k_{\\mathrm{B}} \\left[ \\ln\\left(\\frac{V}{N}\\right) + \\ln\\left(\\left(\\frac{E}{N}\\right)^{3/2}\\right) + \\ln\\left(\\left(\\frac{4\\pi m}{3h^2}\\right)^{3/2}\\right) + \\frac{5}{2} \\right] $$\n$$ S = N k_{\\mathrm{B}} \\left[ \\ln\\left( \\frac{V}{N} \\left(\\frac{4\\pi m E}{3N h^2}\\right)^{3/2} \\right) + \\frac{5}{2} \\right] $$\n如 (a) 部分所示，这个熵的表达式是正确的广延量。所有 $\\ln N$ 阶及更低阶的次广延性项都已通过使用斯特林近似被系统地舍弃，正如要求的那样。",
            "answer": "$$ \\boxed{ N k_{\\mathrm{B}} \\left[ \\ln\\left( \\frac{V}{N} \\left( \\frac{4\\pi m E}{3N h^2} \\right)^{3/2} \\right) + \\frac{5}{2} \\right] } $$"
        },
        {
            "introduction": "微正则系综在概念上是基础，而描述与热浴接触的系统的正则系综通常更具实用性。在正则系综中，配分函数 $Z$ 是核心量，所有热力学性质都可以由它导出。本练习旨在展示配分函数的强大功能，通过证明其对逆温度 $\\beta$ 的各阶导数可以生成能量分布的各阶累积量，从而揭示理论构造与可测量涨落之间的直接联系。",
            "id": "2650675",
            "problem": "考虑一个处于正则系综中的系统，其绝对温度为 $T$，逆温度为 $\\beta = 1/(k_B T)$，其中 $k_B$ 是玻尔兹曼常数。该系统具有离散的微观态，用 $i$ 标记，其能量为 $E_i$。正则配分函数为 $Z(\\beta) = \\sum_i \\exp(-\\beta E_i)$，状态 $i$ 的正则概率为 $p_i = \\exp(-\\beta E_i)/Z(\\beta)$。能量 $E$ 被视为关于此正则分布的一个随机变量。\n\n(a) 仅从这些定义以及能量的累积量生成函数 $K(t)$ 的定义 $K(t) = \\ln \\langle \\exp(t E) \\rangle$ (其中尖括号表示正则平均)出发，证明能量的 $n$ 阶累积量 $\\kappa_n$ 满足\n$$\n\\kappa_n = (-1)^n \\frac{\\partial^n}{\\partial \\beta^n} \\ln Z(\\beta).\n$$\n\n(b) 现在考虑一个具体模型：一个单一的非简并二能级系统，其能量为 $E_0 = 0$ 和 $E_1 = \\varepsilon$，其中 $\\varepsilon  0$ 是一个常数。使用 (a) 部分的结果，计算前四个能量累积量 $\\kappa_1$、$\\kappa_2$、$\\kappa_3$ 和 $\\kappa_4$ 的闭合形式解析表达式，用 $\\beta$ 和 $\\varepsilon$ 表示。将你的最终答案表示为一个仅含 $\\beta$ 和 $\\varepsilon$ 的四分量行向量。不要在最终表达式中代入数值或包含单位。",
            "solution": "我们从正则系综的框架开始。配分函数为 $Z(\\beta) = \\sum_i \\exp(-\\beta E_i)$，微观态 $i$ 的正则概率为 $p_i = \\exp(-\\beta E_i)/Z(\\beta)$。能量 $E$ 是一个随机变量，以概率 $p_i$ 取值 $E_i$。\n\n第 (a) 部分：能量的累积量生成函数 $K(t)$ 定义为\n$$\nK(t) = \\ln \\langle \\exp(t E) \\rangle,\n$$\n其中正则平均 $\\langle \\cdot \\rangle$ 是关于 $p_i$ 计算的。使用 $p_i$ 的定义，\n$$\n\\langle \\exp(t E) \\rangle = \\sum_i p_i \\exp(t E_i) = \\frac{1}{Z(\\beta)} \\sum_i \\exp(-\\beta E_i) \\exp(t E_i) = \\frac{1}{Z(\\beta)} \\sum_i \\exp\\!\\big(-( \\beta - t ) E_i\\big).\n$$\n将求和项识别为在平移后的逆温度下求值的配分函数，我们得到\n$$\n\\langle \\exp(t E) \\rangle = \\frac{Z(\\beta - t)}{Z(\\beta)}.\n$$\n因此，\n$$\nK(t) = \\ln \\langle \\exp(t E) \\rangle = \\ln Z(\\beta - t) - \\ln Z(\\beta).\n$$\n根据累积量的定义，$n$ 阶累积量 $\\kappa_n$ 是 $K(t)$ 在 $t=0$ 处的 $n$ 阶导数：\n$$\n\\kappa_n = \\left. \\frac{\\partial^n K}{\\partial t^n} \\right|_{t=0}.\n$$\n对 $K(t) = \\ln Z(\\beta - t) - \\ln Z(\\beta)$ 应用链式法则，注意对 $t$ 的微分作用在第一项上相当于 $\\frac{\\partial}{\\partial t} = - \\frac{\\partial}{\\partial \\beta}$，并使第二项（与 $t$ 无关）为零。因此，\n$$\n\\frac{\\partial^n K}{\\partial t^n} = (-1)^n \\frac{\\partial^n}{\\partial \\beta^n} \\ln Z(\\beta - t).\n$$\n在 $t=0$ 处求值可得\n$$\n\\kappa_n = (-1)^n \\left. \\frac{\\partial^n}{\\partial \\beta^n} \\ln Z(\\beta - t) \\right|_{t=0} = (-1)^n \\frac{\\partial^n}{\\partial \\beta^n} \\ln Z(\\beta),\n$$\n这证明了所述关系。\n\n第 (b) 部分：对于一个能量为 $E_0 = 0$ 和 $E_1 = \\varepsilon$ 的单一非简并二能级系统，其配分函数为\n$$\nZ(\\beta) = 1 + \\exp(-\\beta \\varepsilon).\n$$\n定义 $u = \\exp(-\\beta \\varepsilon)$ 来简化中间的求导过程。那么 $\\ln Z(\\beta) = \\ln(1+u)$ 且 $u' \\equiv \\frac{\\partial u}{\\partial \\beta} = - \\varepsilon u$。\n\n我们计算 $\\ln Z(\\beta)$ 的逐次导数：\n1. 一阶导数：\n$$\n\\frac{\\partial}{\\partial \\beta} \\ln Z = \\frac{u'}{1+u} = - \\varepsilon \\frac{u}{1+u}.\n$$\n根据 (a) 部分，当 $n=1$ 时，$\\kappa_1 = - \\frac{\\partial}{\\partial \\beta} \\ln Z = \\varepsilon \\frac{u}{1+u}$。将 $u$ 重写为 $\\exp(-\\beta \\varepsilon)$，\n$$\n\\kappa_1 = \\varepsilon \\frac{\\exp(-\\beta \\varepsilon)}{1+\\exp(-\\beta \\varepsilon)} = \\varepsilon \\frac{1}{1+\\exp(\\beta \\varepsilon)}.\n$$\n\n2. 二阶导数：\n$$\n\\frac{\\partial^2}{\\partial \\beta^2} \\ln Z = \\frac{\\partial}{\\partial \\beta} \\left( - \\varepsilon \\frac{u}{1+u} \\right) = - \\varepsilon \\frac{u'(1+u)-u u'}{(1+u)^2} = - \\varepsilon \\frac{u'}{(1+u)^2} = \\varepsilon^2 \\frac{u}{(1+u)^2}.\n$$\n因此，当 $n=2$ 时，$\\kappa_2 = \\frac{\\partial^2}{\\partial \\beta^2} \\ln Z = \\varepsilon^2 \\frac{u}{(1+u)^2}$。用 $\\exp(\\beta \\varepsilon)$ 表示，\n$$\n\\kappa_2 = \\varepsilon^2 \\frac{\\exp(\\beta \\varepsilon)}{(1+\\exp(\\beta \\varepsilon))^2}.\n$$\n\n3. 三阶导数：\n我们首先写出\n$$\n\\frac{\\partial^2}{\\partial \\beta^2} \\ln Z = \\varepsilon^2 \\frac{u}{(1+u)^2}.\n$$\n再微分一次，\n$$\n\\frac{\\partial^3}{\\partial \\beta^3} \\ln Z = \\varepsilon^2 \\frac{u'(1+u)^2 - u \\cdot 2(1+u)u'}{(1+u)^4} = \\varepsilon^2 u' \\frac{(1+u) - 2u}{(1+u)^3}.\n$$\n化简后得到\n$$\n\\frac{\\partial^3}{\\partial \\beta^3} \\ln Z = \\varepsilon^2 u' \\frac{1 - u}{(1+u)^3} = - \\varepsilon^3 \\frac{u(1 - u)}{(1+u)^3}.\n$$\n因此，当 $n=3$ 时，\n$$\n\\kappa_3 = - \\frac{\\partial^3}{\\partial \\beta^3} \\ln Z = \\varepsilon^3 \\frac{u(1 - u)}{(1+u)^3} = \\frac{\\varepsilon^3 \\exp(\\beta \\varepsilon)\\left(\\exp(\\beta \\varepsilon)-1\\right)}{\\left(1+\\exp(\\beta \\varepsilon)\\right)^{3}}.\n$$\n\n4. 四阶导数：\n从\n$$\n\\frac{\\partial^3}{\\partial \\beta^3} \\ln Z = - \\varepsilon^3 \\frac{u(1 - u)}{(1+u)^3},\n$$\n出发，再次微分：\n$$\n\\frac{\\partial^4}{\\partial \\beta^4} \\ln Z = - \\varepsilon^3 \\left[ \\frac{u'(1 - u)}{(1+u)^3} + \\frac{u(-u')}{(1+u)^3} - 3 \\frac{u(1 - u)u'}{(1+u)^4} \\right].\n$$\n使用 $u' = - \\varepsilon u$ 合并各项：\n$$\n\\frac{\\partial^4}{\\partial \\beta^4} \\ln Z = - \\varepsilon^3 u' \\left[ \\frac{1 - 2u}{(1+u)^3} - 3 \\frac{u(1 - u)}{(1+u)^4} \\right] = \\varepsilon^4 u \\frac{(1-2u)(1+u)-3u(1-u)}{(1+u)^4} = \\varepsilon^4 \\frac{u(1-4u+u^2)}{(1+u)^4}.\n$$\n因此，当 $n=4$ 时，$\\kappa_4 = \\frac{\\partial^4}{\\partial \\beta^4} \\ln Z$，用 $\\exp(\\beta \\varepsilon)$ 表示则为\n$$\n\\kappa_4 = \\frac{\\varepsilon^4 \\exp(\\beta \\varepsilon)\\left(\\exp(2 \\beta \\varepsilon)-4\\exp(\\beta \\varepsilon)+1\\right)}{(1+\\exp(\\beta \\varepsilon))^4}.\n$$\n\n将这四个累积量收集成所要求的行向量形式，便得到仅用 $\\beta$ 和 $\\varepsilon$ 表示的最终表达式。作为交叉检验，这些结果与将能量视为一个取值为 $0$ 和 $\\varepsilon$ 的伯努利随机变量是一致的。若其基态概率为 $p = 1/(1+\\exp(\\beta \\varepsilon))$，则能量的已知累积量为 $\\kappa_1 = \\varepsilon (1-p)$、$\\kappa_2 = \\varepsilon^2 p(1-p)$、$\\kappa_3 = \\varepsilon^3 p(1-p)(1-2p)$ 和 $\\kappa_4 = \\varepsilon^4 p(1-p)\\left(1 - 6 p(1-p)\\right)$。",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\dfrac{\\varepsilon}{1+\\exp(\\beta \\varepsilon)}  \\dfrac{\\varepsilon^{2}\\exp(\\beta \\varepsilon)}{\\left(1+\\exp(\\beta \\varepsilon)\\right)^{2}}  \\dfrac{\\varepsilon^{3}\\exp(\\beta \\varepsilon)\\left(\\exp(\\beta \\varepsilon)-1\\right)}{\\left(1+\\exp(\\beta \\varepsilon)\\right)^{3}}  \\dfrac{\\varepsilon^{4}\\exp(\\beta \\varepsilon)\\left(\\exp(2\\beta \\varepsilon)-4\\exp(\\beta \\varepsilon)+1\\right)}{\\left(1+\\exp(\\beta \\varepsilon)\\right)^{4}}\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "统计力学的原理不仅停留在理论层面，它们也是验证现代计算机模拟的重要工具。分子动力学（MD）模拟常使用称为“恒温器”的算法来维持恒定温度，这实际上是在模拟一个正则系综。这项动手计算练习要求你设计一个验证协议，通过检验模拟出的粒子速度和系统能量是否遵循正则系综理论所预测的精确分布，来判断一个恒温器是否正常工作。",
            "id": "4093857",
            "problem": "您的任务是在分子动力学 (MD) 的背景下，设计并实现一个验证协议，用以核实速度温控器能够从正确的正则系综中进行采样。该协议必须评估模拟的速度是否遵循麦克斯韦-玻尔兹曼速度分布，以及总动能的涨落是否与正则系综的预测一致。您交付的程序必须是一个完整的、可运行的脚本，该脚本能在多种测试场景下生成合成的 MD 速度数据，计算适当的统计检验，并报告每个场景的通过或失败判定。\n\n从基本原理出发：假设一个系统，包含 $N$ 个质量为 $m$ 的相同、无相互作用的点粒子，处于 $d$ 维空间中，并与绝对温度为 $T$ 的热库发生热接触。在正则系综下，微观态的平衡概率密度与 $\\exp(-\\beta H)$ 成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，$H$ 是哈密顿量。对于理想气体，哈密顿量简化为动能，并且由于能量是速度的二次型，每个速度分量都应服从高斯分布。请以此为基础，从第一性原理推导用于验证的目标分布。\n\n您的协议必须实现以下步骤：\n\n1.  对于一个处于温度 $T$ 平衡态下，质量为 $m$ 的单个粒子，推导其在 $d$ 维空间中的速率 $v$ 的麦克斯韦-玻尔兹曼分布。利用正则系综和速度的各向同性，得到速率的概率密度函数 (PDF) $f(v)$ 和相应的累积分布函数 (CDF) $F(v)$。您必须将 $F(v)$ 表示为一个对于任意实数 $d  0$ 都可以在数值上求解的闭合形式。\n\n2.  对于 $N$ 个处于温度 $T$ 平衡态下，在 $d$ 维空间中的无相互作用粒子，推导每个构型（或每个帧）的总动能 $K$ 的分布。从第一性原理出发，获得 $K$ 的 PDF 和 CDF，以及由涨落公式所蕴含的其均值和方差的正则表达式。最终形式必须适合使用现代科学计算库进行数值评估。\n\n3.  实现一个验证协议，该协议需：\n    -   根据指定的场景生成合成的 MD 速度数据。对于“一致”(`consistent`)的温控器，通过从温度 $T$ 和质量 $m$ 的平衡态所蕴含的高斯分布中独立采样每个分量来生成速度。对于“不一致”(`inconsistent`)的场景，构造违反正则系综期望的速度样本（例如，使用不同于指定 $T$ 的温度，或为所有粒子添加一个固定的漂移速度矢量）。\n    -   汇集所有生成帧中的所有粒子速率，用于速率分布检验。\n    -   计算每个帧的总动能 $K$，并汇集逐帧的能量，用于能量涨落检验。\n    -   执行统计拟合优度检验，将汇集的速率样本与推导出的麦克斯韦-玻尔兹曼 CDF 进行比较，并将汇集的能量样本与推导出的正则能量 CDF 进行比较。使用柯尔莫哥洛夫-斯米尔诺夫 (KS) 检验，显著性水平为 $\\alpha$；一个测试用例仅在两个 KS 检验产生的 $p$ 值都大于或等于 $\\alpha$ 时才算通过。\n\n使用以下经过充分检验的科学事实和定义作为您推导的基础：\n-   正则系综赋予的概率密度与 $\\exp(-\\beta H)$ 成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，$H$ 为哈密顿量。\n-   对于理想气体，哈密顿量是速度二次项贡献的总和，这意味着速度分量是独立的高斯变量。\n-   在由独立的二次自由度组成的系统中，总动能是独立的、同分布的二次型之和。\n\n物理单位与常数：\n-   温度 $T$ 必须以开尔文 (K) 为单位。\n-   质量 $m$ 必须以千克 (kg) 为单位。\n-   速度分量和速率 $v$ 必须以米/秒 (m/s) 为单位。\n-   能量 $K$ 必须以焦耳 (J) 为单位。\n-   玻尔兹曼常数 $k_{\\mathrm{B}}$ 为 $1.380649 \\times 10^{-23} \\, \\mathrm{J/K}$。\n\n您的程序必须实现该协议，使用固定的随机种子为下面的测试套件生成合成数据以确保可复现性，执行 KS 检验（针对速率和能量），并为每个测试用例输出一个布尔值，指示两个验证是否都通过。使用显著性水平 $\\alpha = 0.01$。\n\n测试套件规范：\n-   对于每个测试用例，参数为 $(N, d, T, m, M, \\text{mode})$，其中 $N$ 是粒子数，$d$ 是空间维度数，$T$ 是目标温控器温度，$m$ 是粒子质量，$M$ 是独立帧的数量，$\\text{mode}$ 指定数据生成场景：\n    1.  $(500, 3, 300 \\, \\mathrm{K}, 6.63 \\times 10^{-26} \\, \\mathrm{kg}, 200, \\text{consistent})$。\n    2.  $(500, 3, 300 \\, \\mathrm{K}, 6.63 \\times 10^{-26} \\, \\mathrm{kg}, 200, \\text{wrong\\_T})$；速度在 $450 \\, \\mathrm{K}$ 而不是 $300 \\, \\mathrm{K}$ 下生成。\n    3.  $(500, 3, 300 \\, \\mathrm{K}, 6.63 \\times 10^{-26} \\, \\mathrm{kg}, 200, \\text{drift})$；速度在 $300 \\, \\mathrm{K}$ 下生成，并为所有粒子沿单一轴向添加 $200 \\, \\mathrm{m/s}$ 的固定漂移。\n    4.  $(1000, 2, 300 \\, \\mathrm{K}, 6.63 \\times 10^{-26} \\, \\mathrm{kg}, 200, \\text{consistent})$。\n    5.  $(10, 3, 300 \\, \\mathrm{K}, 6.63 \\times 10^{-26} \\, \\mathrm{kg}, 100, \\text{consistent})$。\n\n最终输出格式：\n-   您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如，“[result1,result2,result3,result4,result5]”。\n-   每个结果必须是一个布尔值，如果速率分布 KS 检验和能量分布 KS 检验都以 $p \\ge \\alpha$ 通过，则为 “True”，否则为 “False”。\n\n所有数学实体的推导过程必须在您的解答中展示，并且程序必须实现这些推导出的形式以执行统计验证。",
            "solution": "问题陈述提出了计算统计力学中一个有效且明确定义的任务：设计并实现一个协议，用于验证温控器是否正确地从正则系综中采样。这涉及到从第一性原理推导粒子速率和系统总动能的理论分布，然后使用这些分布对合成生成的数据进行统计检验。该问题具有科学依据，是客观的，并为得出完整解决方案提供了所有必要的信息。\n\n在此，我将介绍所需分布的形式化推导以及验证算法的结构。\n\n### 第 1 部分：麦克斯韦-玻尔兹曼速率分布的推导\n\n我们考虑一个处于温度 $T$ 热平衡状态下的无相互作用点粒子系统。在正则系综中，微观态的概率与玻尔兹曼因子 $\\exp(-\\beta H)$ 成正比，其中 $H$ 是哈密顿量，$\\beta = 1/(k_B T)$。对于理想气体，哈密顿量完全是动能。\n\n#### 1.1 单分量速度分布\n对于一个质量为 $m$ 的单个粒子，其速度的一个分量（例如 $v_x$）所关联的动能为 $E_x = \\frac{1}{2} m v_x^2$。$v_x$ 的概率密度函数 (PDF) 为：\n$$p(v_x) \\propto \\exp(-\\beta E_x) = \\exp\\left(-\\frac{m v_x^2}{2 k_B T}\\right)$$\n这是一个均值为 $0$ 的高斯分布。为了归一化，我们需要 $\\int_{-\\infty}^{\\infty} p(v_x) dv_x = 1$。归一化常数可以通过标准高斯积分 $\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\pi/a}$ 求得。当 $a = m/(2 k_B T)$ 时，归一化后的 PDF 为：\n$$p(v_x) = \\sqrt{\\frac{m}{2 \\pi k_B T}} \\exp\\left(-\\frac{m v_x^2}{2 k_B T}\\right)$$\n这对应于均值为 $\\mu=0$、方差为 $\\sigma_v^2 = k_B T / m$ 的正态分布 $\\mathcal{N}(\\mu, \\sigma_v^2)$。\n\n#### 1.2 $d$ 维空间中的速率分布\n粒子在 $d$ 维空间中的速度矢量为 $\\mathbf{v} = (v_1, v_2, \\dots, v_d)$。由于理想气体的速度分量是独立的，其联合 PDF 为：\n$$p(\\mathbf{v}) = \\prod_{i=1}^d p(v_i) = \\left(\\frac{m}{2 \\pi k_B T}\\right)^{d/2} \\exp\\left(-\\frac{m}{2 k_B T} \\sum_{i=1}^d v_i^2\\right)$$\n粒子的速率是其大小 $v = |\\mathbf{v}| = \\sqrt{\\sum_{i=1}^d v_i^2}$。联合 PDF 仅取决于 $v$。为了找到速率的 PDF $f(v)$，我们可以变换到超球面坐标。速度空间中的体积元 $d\\mathbf{v} = dv_1 \\dots dv_d$ 变为 $v^{d-1} S_d dv$，其中 $S_d = 2\\pi^{d/2}/\\Gamma(d/2)$ 是 $d$ 维单位超球面的表面积。找到速率在 $v$ 和 $v+dv$ 之间的概率，需要将 $p(\\mathbf{v})$ 在半径为 $v$、厚度为 $dv$ 的超球壳上积分：\n$$f(v)dv = p(\\mathbf{v}) S_d v^{d-1} dv$$\n$$f(v) = \\left(\\frac{m}{2 \\pi k_B T}\\right)^{d/2} \\exp\\left(-\\frac{m v^2}{2 k_B T}\\right) \\frac{2 \\pi^{d/2}}{\\Gamma(d/2)} v^{d-1}$$\n简化后，我们得到 $d$ 维空间中的麦克斯韦-玻尔兹曼速率分布：\n$$f(v) = \\frac{2}{\\Gamma(d/2)} \\left(\\frac{m}{2 k_B T}\\right)^{d/2} v^{d-1} \\exp\\left(-\\frac{m v^2}{2 k_B T}\\right)$$\n\n#### 1.3 速率的累积分布函数 (CDF)\nCDF $F(v)$ 是 PDF 从 $0$到 $v$ 的积分：\n$$F(v) = \\int_0^v f(u) du = \\int_0^v \\frac{2}{\\Gamma(d/2)} \\left(\\frac{m}{2 k_B T}\\right)^{d/2} u^{d-1} \\exp\\left(-\\frac{m u^2}{2 k_B T}\\right) du$$\n我们进行换元，令 $x = \\frac{m u^2}{2 k_B T}$。这意味着 $u^2 = \\frac{2 k_B T x}{m}$ 且 $2u du = \\frac{2 k_B T}{m} dx$，所以 $du = \\frac{k_B T}{mu} dx$。\n更直接的代换是作用于微分形式 $f(u)du$：\n令 $x = \\frac{m u^2}{2 k_B T}$。那么 $u^{d-1} = (\\frac{2 k_B T x}{m})^{(d-1)/2}$ 且 $du = \\frac{1}{2}\\sqrt{\\frac{2 k_B T}{m x}} dx$。\n这导致：\n$u^{d-1} du = (\\frac{2k_BT}{m})^{(d-1)/2} x^{(d-1)/2} \\frac{1}{2} (\\frac{2k_BT}{m})^{1/2} x^{-1/2} dx = \\frac{1}{2}(\\frac{2k_BT}{m})^{d/2} x^{d/2-1} dx$。\n将此代入被积函数中：\n$$f(u)du = \\frac{2}{\\Gamma(d/2)} \\left(\\frac{m}{2 k_B T}\\right)^{d/2} e^{-x} \\left( \\frac{1}{2} \\left(\\frac{2 k_B T}{m}\\right)^{d/2} x^{d/2 - 1} dx \\right) = \\frac{1}{\\Gamma(d/2)} x^{d/2-1} e^{-x} dx$$\n将此表达式从 $u=0$ 积分到 $u=v$，对应于从 $x=0$ 积分到 $x=\\frac{m v^2}{2 k_B T}$：\n$$F(v) = \\int_0^{\\frac{m v^2}{2 k_B T}} \\frac{1}{\\Gamma(d/2)} t^{d/2-1} e^{-t} dt$$\n该积分定义了正则化下不完全伽马函数，$P(s, z) = \\gamma(s, z)/\\Gamma(s)$，其中 $\\gamma(s,z) = \\int_0^z t^{s-1} e^{-t} dt$。\n因此，速率的 CDF 为：\n$$F(v) = P\\left(\\frac{d}{2}, \\frac{m v^2}{2 k_B T}\\right)$$\n此表达式可使用标准科学计算库对任意实数 $d  0$进行数值求解。\n\n### 第 2 部分：总动能分布的推导\n\n#### 2.1 总动能分布\n对于一个包含 $N$ 个粒子、处于 $d$ 维空间中的系统，其总动能 $K$ 是所有 $N \\times d$ 个独立二次自由度的总和：\n$$K = \\sum_{i=1}^{N} \\sum_{j=1}^{d} \\frac{1}{2} m v_{ij}^2$$\n每一项 $\\frac{1}{2}mv_{ij}^2$ 代表单个自由度的动能。如第 1 部分所述，每个速度分量 $v_{ij}$ 是从 $\\mathcal{N}(0, k_B T / m)$ 中抽取的独立随机变量。变量 $Z_{ij} = v_{ij} / \\sqrt{k_B T/m}$ 是一个标准正态变量 $\\mathcal{N}(0, 1)$。来自一个自由度的能量贡献为 $\\frac{1}{2} k_B T Z_{ij}^2$。项 $Z_{ij}^2$ 服从自由度为 1 的卡方分布 ($\\chi^2_1$)，这等价于一个伽马分布 $\\text{Gamma}(k=1/2, \\theta=2)$。\n因此，一个自由度的能量 $\\frac{1}{2} k_B T Z_{ij}^2$ 服从形状参数 $k=1/2$、尺度参数 $\\theta=k_B T$ 的伽马分布。\n总动能 $K$ 是 $Nd$ 个这样的独立同分布的伽马变量之和。具有相同尺度参数 $\\theta$ 的独立伽马变量之和也是一个伽马变量，其尺度参数相同，形状参数等于各个形状参数之和。\n因此，$K$ 服从一个伽马分布：\n$$K \\sim \\text{Gamma}\\left(\\text{shape} = \\sum_{i=1}^{Nd} \\frac{1}{2}, \\text{scale} = k_B T\\right) = \\text{Gamma}\\left(k_K=\\frac{Nd}{2}, \\theta_K=k_B T\\right)$$\n$K$ 的 PDF 由伽马 PDF 给出：\n$$f(K) = \\frac{K^{k_K-1} e^{-K/\\theta_K}}{\\theta_K^{k_K} \\Gamma(k_K)} = \\frac{K^{Nd/2 - 1} \\exp(-K/(k_B T))}{(k_B T)^{Nd/2} \\Gamma(Nd/2)}$$\n\n#### 2.2 总动能的 CDF\nCDF $F(K)$ 是其 PDF 的积分。通过与速率 CDF 相似的变量代换 $t=x/\\theta_K$，我们发现总动能的 CDF 同样是一个正则化下不完全伽马函数：\n$$F(K) = P\\left(k_K, \\frac{K}{\\theta_K}\\right) = P\\left(\\frac{Nd}{2}, \\frac{K}{k_B T}\\right)$$\n\n#### 2.3 总动能的均值和方差\n对于一个服从伽马分布的随机变量 $X \\sim \\text{Gamma}(k, \\theta)$，其均值为 $\\langle X \\rangle = k\\theta$，方差为 $\\text{Var}(X) = k\\theta^2$。将此应用于总动能 $K$：\n$$\\langle K \\rangle = k_K \\theta_K = \\frac{Nd}{2} k_B T$$\n这就是能量均分定理，为 $Nd$ 个二次自由度中的每一个分配了 $\\frac{1}{2} k_B T$ 的平均能量。\n方差为：\n$$\\text{Var}(K) = k_K \\theta_K^2 = \\frac{Nd}{2} (k_B T)^2$$\n这与正则系综涨落公式 $\\text{Var}(E) = k_B T^2 C_V$ 相匹配，其中理想气体的热容为 $C_V = (\\partial \\langle E \\rangle / \\partial T)_V = \\frac{Nd}{2}k_B$。\n\n### 第 3 部分：验证协议的算法实现\n\n验证协议通过一个 Python 脚本实现，遵循问题规范。\n\n1.  **合成数据生成**：一个函数为 $M$ 个帧生成速度数据，每个帧包含 $N$ 个粒子，每个粒子处于 $d$ 维空间中。对于 $M \\times N \\times d$ 个速度分量中的每一个，从高斯分布 $\\mathcal{N}(0, \\sigma_v^2)$ 中抽取一个随机值，其中 $\\sigma_v = \\sqrt{k_B T_{gen}/m}$。\n    -   对于 `consistent` 模式，$T_{gen}$ 是目标温度 $T$。\n    -   对于 `wrong_T` 模式，$T_{gen}$ 是一个不同的温度（按规定为 $450 \\, \\mathrm{K}$）。\n    -   对于 `drift` 模式，速度以正确的 $T_{gen}=T$ 生成，然后对所有粒子的一个分量加上一个恒定的漂移速度。\n\n2.  **数据处理**：从生成的速度张量 `(M, N, d)` 中，我们计算：\n    -   一个一维的粒子速率数组，通过计算每个粒子速度矢量的欧几里得范数并将得到的 `(M, N)` 数组展平。\n    -   一个一维的逐帧总动能数组，通过对 $M$ 个帧中的每一个帧内的所有粒子的动能求和得到。\n\n3.  **统计检验**：柯尔莫哥洛夫-斯米尔诺夫 (KS) 检验用于比较采样数据的经验累积分布函数 (ECDF) 与理论推导的 CDF。\n    -   将汇集的速率数据与速率 CDF $F(v) = P(d/2, m v^2 / (2 k_B T))$ 进行检验。\n    -   将逐帧的动能数据与能量 CDF $F(K) = P(Nd/2, K / (k_B T))$ 进行检验。\n    -   关键在于，对于所有测试用例（包括不一致的用例），理论 CDF 都是使用 *目标* 温控器温度 $T=300\\,\\mathrm{K}$ 计算的，因为目标是根据指定的设定点进行验证。\n\n4.  **判定**：对于每个测试用例，获取速率和能量 KS 检验的 p 值。如果两个 p 值都大于或等于显著性水平 $\\alpha = 0.01$，则该测试用例被视为通过 (`True`)。否则，视为失败 (`False`)。对测试套件中的所有场景重复此过程。固定的随机种子确保了结果的可复现性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import kstest\nfrom scipy.special import gammainc, gamma\n\ndef solve():\n    \"\"\"\n    Implements a validation protocol for a canonical ensemble thermostat.\n    \"\"\"\n    KB = 1.380649e-23  # Boltzmann constant in J/K\n    ALPHA = 0.01       # Significance level for KS tests\n    \n    # Set a fixed random seed for reproducibility\n    np.random.seed(42)\n\n    def mb_speed_cdf(v, d, m, T):\n        \"\"\"\n        Calculates the theoretical Maxwell-Boltzmann speed CDF in d dimensions.\n        CDF(v) = P(d/2, m*v**2 / (2*k_B*T))\n        where P is the lower regularized incomplete gamma function.\n        \"\"\"\n        if np.any(v  0):\n            # Speed cannot be negative, handle this case for kstest\n            v = np.maximum(v, 0)\n        \n        shape = d / 2.0\n        # Argument for the incomplete gamma function\n        x = m * v**2 / (2.0 * KB * T)\n        return gammainc(shape, x)\n\n    def kinetic_energy_cdf(K, N, d, T):\n        \"\"\"\n        Calculates the theoretical total kinetic energy CDF for N particles in d dimensions.\n        CDF(K) = P(N*d/2, K / (k_B*T))\n        where P is the lower regularized incomplete gamma function.\n        \"\"\"\n        if np.any(K  0):\n            K = np.maximum(K, 0)\n\n        shape = N * d / 2.0\n        # Argument for the incomplete gamma function\n        x = K / (KB * T)\n        return gammainc(shape, x)\n\n    def generate_velocities(N, d, T_gen, m, M):\n        \"\"\"\n        Generates synthetic velocity data for M frames.\n        Each velocity component is sampled from N(0, k_B*T_gen/m).\n        \"\"\"\n        sigma_v = np.sqrt(KB * T_gen / m)\n        velocities = np.random.normal(loc=0.0, scale=sigma_v, size=(M, N, d))\n        return velocities\n    \n    def run_validation(N, d, T_target, m, M, mode):\n        \"\"\"\n        Runs the full validation protocol for a single test case.\n        \"\"\"\n        # --- 1. Generate Data ---\n        if mode == 'consistent' or mode == 'drift':\n            T_gen = T_target\n        elif mode == 'wrong_T':\n            T_gen = 450.0  # As specified in the problem for this scenario\n        else:\n            raise ValueError(f\"Unknown mode: {mode}\")\n\n        velocities = generate_velocities(N, d, T_gen, m, M)\n\n        if mode == 'drift':\n            drift_velocity = 200.0  # m/s\n            velocities[:, :, 0] += drift_velocity\n\n        # --- 2. Process Data ---\n        # Pool all particle speeds across all frames\n        speeds = np.linalg.norm(velocities, axis=2).flatten()\n        \n        # Calculate total kinetic energy for each frame\n        kinetic_energies = 0.5 * m * np.sum(velocities**2, axis=(1, 2))\n\n        # --- 3. Perform Statistical Tests ---\n        # Test against theoretical distributions corresponding to T_target\n        \n        # Speed distribution test\n        ks_speed = kstest(speeds, lambda v: mb_speed_cdf(v, d=d, m=m, T=T_target))\n        \n        # Kinetic energy distribution test\n        ks_energy = kstest(kinetic_energies, lambda K: kinetic_energy_cdf(K, N=N, d=d, T=T_target))\n        \n        # --- 4. Make Decision ---\n        pass_speed_test = ks_speed.pvalue >= ALPHA\n        pass_energy_test = ks_energy.pvalue >= ALPHA\n        \n        return pass_speed_test and pass_energy_test\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (N, d, T, m, M, mode)\n        (500, 3, 300.0, 6.63e-26, 200, 'consistent'),\n        (500, 3, 300.0, 6.63e-26, 200, 'wrong_T'),\n        (500, 3, 300.0, 6.63e-26, 200, 'drift'),\n        (1000, 2, 300.0, 6.63e-26, 200, 'consistent'),\n        (10, 3, 300.0, 6.63e-26, 100, 'consistent'),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_validation(*params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [r.item() for r in results]))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}