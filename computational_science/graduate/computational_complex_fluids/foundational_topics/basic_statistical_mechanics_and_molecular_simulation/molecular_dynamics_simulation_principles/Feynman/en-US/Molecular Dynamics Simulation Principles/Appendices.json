{
    "hands_on_practices": [
        {
            "introduction": "In simulations employing periodic boundary conditions, the total momentum of the system should be a conserved quantity in the absence of external forces. However, finite-precision arithmetic and the approximations inherent in numerical integration can lead to the accumulation of small errors, causing a spurious drift of the system's center of mass (COM). This exercise guides you through the fundamental derivation and application of the velocity correction required to nullify this COM motion, a crucial procedure for maintaining a stationary reference frame and ensuring the stability and physical realism of long simulations .",
            "id": "4096096",
            "problem": "A molecular dynamics (MD) simulation of a complex fluid is performed in a cubic domain with periodic boundary conditions (PBC). After a velocity-Verlet timestep, small numerical errors or thermostat artifacts can induce a uniform drift of the center-of-mass (COM), resulting in nonzero total momentum. To prevent spurious translation of the simulation cell while preserving internal dynamics, you must remove the COM motion by applying the same velocity correction to every particle at the end of each timestep so that the total momentum becomes zero without altering any pairwise relative velocity.\n\nStarting from Newton’s laws, the definition of momentum, and the requirement of translational invariance under PBC, derive the expression for the uniform velocity correction to be applied to all particles to exactly nullify the total momentum after a given timestep. Explain why this correction does not change any relative motion between particles. Then, for a specific three-particle subsystem extracted from the fluid, compute the corrected velocity of particle $2$.\n\nThe subsystem has three particles with masses $m_1=3.0\\times 10^{-26}\\,\\mathrm{kg}$, $m_2=6.0\\times 10^{-26}\\,\\mathrm{kg}$, and $m_3=9.0\\times 10^{-26}\\,\\mathrm{kg}$. Immediately after the timestep, their velocities are\n$$\n\\mathbf{v}_1=\\left(150,\\,-200,\\,50\\right)\\,\\mathrm{m/s},\\quad\n\\mathbf{v}_2=\\left(300,\\,100,\\,-100\\right)\\,\\mathrm{m/s},\\quad\n\\mathbf{v}_3=\\left(-250,\\,50,\\,200\\right)\\,\\mathrm{m/s}.\n$$\nAssume no external forces act on the system and that PBC only affects the positions through wrapping, not the instantaneous velocities. Using your derived expression, compute the corrected velocity $\\mathbf{v}_2'$ of particle $2$ after COM removal. Express your final numerical answer in $\\mathrm{m/s}$. If any rounding is required, round to four significant figures; otherwise provide exact values.",
            "solution": "The problem asks for the derivation of a uniform velocity correction to nullify the total momentum of a system of particles in a molecular dynamics simulation, an explanation of why this correction preserves relative motion, and the application of this correction to a specific three-particle subsystem.\n\n**Part 1: Derivation of the Velocity Correction**\n\nLet the system consist of $N$ particles, with the $i$-th particle having mass $m_i$ and velocity $\\mathbf{v}_i$ after a given timestep. The total momentum of the system, $\\mathbf{P}_{\\text{total}}$, is the vector sum of the individual momenta:\n$$\n\\mathbf{P}_{\\text{total}} = \\sum_{i=1}^{N} \\mathbf{p}_i = \\sum_{i=1}^{N} m_i \\mathbf{v}_i\n$$\nThe problem states that due to numerical artifacts, $\\mathbf{P}_{\\text{total}}$ may be non-zero. To correct this, a uniform velocity correction, $\\Delta\\mathbf{v}$, is applied to every particle. The new velocity of the $i$-th particle, $\\mathbf{v}_i'$, is given by:\n$$\n\\mathbf{v}_i' = \\mathbf{v}_i + \\Delta\\mathbf{v}\n$$\nThe objective is to choose $\\Delta\\mathbf{v}$ such that the new total momentum, $\\mathbf{P}_{\\text{total}}'$, becomes zero.\n$$\n\\mathbf{P}_{\\text{total}}' = \\sum_{i=1}^{N} m_i \\mathbf{v}_i' = \\mathbf{0}\n$$\nSubstituting the expression for $\\mathbf{v}_i'$ into this equation:\n$$\n\\sum_{i=1}^{N} m_i (\\mathbf{v}_i + \\Delta\\mathbf{v}) = \\mathbf{0}\n$$\nWe can distribute the mass $m_i$ and separate the sum:\n$$\n\\sum_{i=1}^{N} m_i \\mathbf{v}_i + \\sum_{i=1}^{N} m_i \\Delta\\mathbf{v} = \\mathbf{0}\n$$\nThe first term is the original total momentum, $\\mathbf{P}_{\\text{total}}$. In the second term, $\\Delta\\mathbf{v}$ is a constant vector and can be factored out of the summation:\n$$\n\\mathbf{P}_{\\text{total}} + \\left(\\sum_{i=1}^{N} m_i\\right) \\Delta\\mathbf{v} = \\mathbf{0}\n$$\nLet $M_{\\text{total}} = \\sum_{i=1}^{N} m_i$ be the total mass of the system. The equation becomes:\n$$\n\\mathbf{P}_{\\text{total}} + M_{\\text{total}} \\Delta\\mathbf{v} = \\mathbf{0}\n$$\nSolving for the velocity correction $\\Delta\\mathbf{v}$:\n$$\nM_{\\text{total}} \\Delta\\mathbf{v} = -\\mathbf{P}_{\\text{total}}\n$$\n$$\n\\Delta\\mathbf{v} = -\\frac{\\mathbf{P}_{\\text{total}}}{M_{\\text{total}}}\n$$\nThe velocity of the center-of-mass (COM) of the system is defined as $\\mathbf{v}_{\\text{COM}} = \\frac{\\sum m_i \\mathbf{v}_i}{\\sum m_i} = \\frac{\\mathbf{P}_{\\text{total}}}{M_{\\text{total}}}$. Therefore, the required velocity correction is the negative of the COM velocity:\n$$\n\\Delta\\mathbf{v} = -\\mathbf{v}_{\\text{COM}}\n$$\nThis correction effectively transforms the particle velocities into a reference frame where the center-of-mass is stationary, thus nullifying the total momentum. The premise of translational invariance under PBC implies that the physics of the system should be independent of a uniform translational velocity of the whole system, which is precisely what this procedure removes.\n\n**Part 2: Invariance of Relative Motion**\n\nThe relative velocity between any two particles, say particle $i$ and particle $j$, is defined as $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$. After the correction is applied, the new relative velocity, $\\mathbf{v}_{ij}'$, is:\n$$\n\\mathbf{v}_{ij}' = \\mathbf{v}_i' - \\mathbf{v}_j'\n$$\nSubstituting the expressions for the corrected velocities:\n$$\n\\mathbf{v}_{ij}' = (\\mathbf{v}_i + \\Delta\\mathbf{v}) - (\\mathbf{v}_j + \\Delta\\mathbf{v})\n$$\n$$\n\\mathbf{v}_{ij}' = \\mathbf{v}_i + \\Delta\\mathbf{v} - \\mathbf{v}_j - \\Delta\\mathbf{v}\n$$\nThe uniform correction term $\\Delta\\mathbf{v}$ cancels out:\n$$\n\\mathbf{v}_{ij}' = \\mathbf{v}_i - \\mathbf{v}_j = \\mathbf{v}_{ij}\n$$\nThus, the relative velocity between any pair of particles is unchanged by the uniform velocity correction. Since the internal forces in the system (e.g., from a pairwise potential) depend on the relative positions and velocities of the particles, the internal dynamics, particle-particle collisions, and structural evolution of the fluid are unaffected. The correction only removes the non-physical, uniform translation of the entire system as a rigid body.\n\n**Part 3: Numerical Calculation**\n\nWe apply the derived expression to the given three-particle subsystem. The masses and velocities are:\n$m_1=3.0\\times 10^{-26}\\,\\mathrm{kg}$, $m_2=6.0\\times 10^{-26}\\,\\mathrm{kg}$, $m_3=9.0\\times 10^{-26}\\,\\mathrm{kg}$.\n$$\n\\mathbf{v}_1=\\begin{pmatrix} 150 & -200 & 50 \\end{pmatrix}\\,\\mathrm{m/s}\n$$\n$$\n\\mathbf{v}_2=\\begin{pmatrix} 300 & 100 & -100 \\end{pmatrix}\\,\\mathrm{m/s}\n$$\n$$\n\\mathbf{v}_3=\\begin{pmatrix} -250 & 50 & 200 \\end{pmatrix}\\,\\mathrm{m/s}\n$$\n\nFirst, we calculate the total mass $M_{\\text{total}}$:\n$$\nM_{\\text{total}} = m_1 + m_2 + m_3 = (3.0 + 6.0 + 9.0) \\times 10^{-26}\\,\\mathrm{kg} = 18.0 \\times 10^{-26}\\,\\mathrm{kg}\n$$\nNext, we calculate the total momentum $\\mathbf{P}_{\\text{total}} = m_1\\mathbf{v}_1 + m_2\\mathbf{v}_2 + m_3\\mathbf{v}_3$.\nLet's compute each component of the momentum, denoted by subscripts $x, y, z$.\n$$\nP_{\\text{total},x} = m_1 v_{1,x} + m_2 v_{2,x} + m_3 v_{3,x} \\\\\n= (3.0 \\times 10^{-26})(150) + (6.0 \\times 10^{-26})(300) + (9.0 \\times 10^{-26})(-250) \\\\\n= (450 + 1800 - 2250) \\times 10^{-26} = 0\\,\\mathrm{kg\\cdot m/s}\n$$\n$$\nP_{\\text{total},y} = m_1 v_{1,y} + m_2 v_{2,y} + m_3 v_{3,y} \\\\\n= (3.0 \\times 10^{-26})(-200) + (6.0 \\times 10^{-26})(100) + (9.0 \\times 10^{-26})(50) \\\\\n= (-600 + 600 + 450) \\times 10^{-26} = 450 \\times 10^{-26}\\,\\mathrm{kg\\cdot m/s}\n$$\n$$\nP_{\\text{total},z} = m_1 v_{1,z} + m_2 v_{2,z} + m_3 v_{3,z} \\\\\n= (3.0 \\times 10^{-26})(50) + (6.0 \\times 10^{-26})(-100) + (9.0 \\times 10^{-26})(200) \\\\\n= (150 - 600 + 1800) \\times 10^{-26} = 1350 \\times 10^{-26}\\,\\mathrm{kg\\cdot m/s}\n$$\nSo, the total momentum vector is $\\mathbf{P}_{\\text{total}} = \\begin{pmatrix} 0 & 450 & 1350 \\end{pmatrix} \\times 10^{-26}\\,\\mathrm{kg\\cdot m/s}$.\n\nNow, we compute the velocity correction $\\Delta\\mathbf{v}$:\n$$\n\\Delta\\mathbf{v} = -\\frac{\\mathbf{P}_{\\text{total}}}{M_{\\text{total}}} = -\\frac{\\begin{pmatrix} 0 & 450 & 1350 \\end{pmatrix} \\times 10^{-26}}{18.0 \\times 10^{-26}}\n$$\nThe factor of $10^{-26}$ cancels.\n$$\n\\Delta\\mathbf{v} = -\\frac{1}{18.0} \\begin{pmatrix} 0 & 450 & 1350 \\end{pmatrix} = -\\begin{pmatrix} \\frac{0}{18.0} & \\frac{450}{18.0} & \\frac{1350}{18.0} \\end{pmatrix}\n$$\n$$\n\\Delta\\mathbf{v} = -\\begin{pmatrix} 0 & 25 & 75 \\end{pmatrix} = \\begin{pmatrix} 0 & -25 & -75 \\end{pmatrix}\\,\\mathrm{m/s}\n$$\nFinally, we compute the corrected velocity of particle $2$, $\\mathbf{v}_2'$:\n$$\n\\mathbf{v}_2' = \\mathbf{v}_2 + \\Delta\\mathbf{v}\n$$\n$$\n\\mathbf{v}_2' = \\begin{pmatrix} 300 & 100 & -100 \\end{pmatrix} + \\begin{pmatrix} 0 & -25 & -75 \\end{pmatrix}\n$$\n$$\n\\mathbf{v}_2' = \\begin{pmatrix} 300+0 & 100-25 & -100-75 \\end{pmatrix}\n$$\n$$\n\\mathbf{v}_2' = \\begin{pmatrix} 300 & 75 & -175 \\end{pmatrix}\\,\\mathrm{m/s}\n$$\nAll calculations resulted in exact integer values, so no rounding is necessary. The corrected velocity of particle $2$ is $\\begin{pmatrix} 300 & 75 & -175 \\end{pmatrix}\\,\\mathrm{m/s}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n300 & 75 & -175\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Transitioning from a constant-energy simulation to one at constant temperature requires coupling the system to a virtual heat bath via a thermostat. The choice of thermostat algorithm is not merely a technical detail; it critically determines whether the simulation correctly samples the canonical ensemble. This practice explores the notorious \"flying ice cube\" artifact, a classic example of how a flawed thermostat can lead to a severe violation of the equipartition of energy, draining kinetic energy from internal vibrations into system-wide translation . Understanding its cause is essential for selecting appropriate algorithms and diagnosing incorrect statistical mechanics in simulations.",
            "id": "2417118",
            "problem": "In Molecular Dynamics (MD) simulations of biomolecular systems, the so-called \"flying ice cube\" artifact has been reported in the literature. Consider a simulation aiming to represent a canonical ensemble at temperature $T$, where, according to the equipartition theorem, each quadratic degree of freedom should carry an average kinetic energy of $k_{\\mathrm{B}}T/2$. Which option best explains the physical mechanism behind the \"flying ice cube\" artifact and identifies a realistic system and thermostat configuration that would be particularly susceptible to exhibiting it?\n\nA. The artifact arises when a global, deterministic velocity-rescaling scheme systematically suppresses canonical temperature fluctuations and, via anharmonic mode coupling, redistributes kinetic energy from high-frequency internal modes (e.g., bond vibrations) into low-frequency collective motion, especially center-of-mass (COM) translation. This violates equipartition by overpopulating the translational degrees of freedom while leaving internal modes \"cold,\" making the molecule appear rigid while drifting as a whole. It is most pronounced in small or stiff systems under strong weak-coupling control, for example, a small box of rigid water or a small solvated peptide thermostatted with the Berendsen weak-coupling thermostat using a very short coupling time (e.g., $\\tau \\approx 0.05\\,\\mathrm{ps}$) and without periodic removal of total linear momentum.\n\nB. The artifact is caused by holonomic bond constraints that eliminate high-frequency vibrations, which makes the internal modes appear artificially cold relative to translation and rotation. It is therefore most severe in large protein systems using a well-tuned Nosé–Hoover chain (NHC) thermostat that correctly samples the canonical distribution; for example, a membrane protein in water with constraints on all bonds, coupled to an NHC thermostat with chain length $> 3$.\n\nC. The artifact is the generic outcome of numerical instability from a too-large time step, which transfers energy from translational degrees of freedom into high-frequency internal vibrations over time. It is therefore most severe in constant-energy simulations without a thermostat, for example, a small water box propagated with a time step of $4\\,\\mathrm{fs}$ and rigid bonds.\n\nD. The artifact originates from long-range electrostatics errors that create a net force on the simulation box, accelerating the system’s center of mass. It is therefore most severe when using Particle Mesh Ewald (PME) electrostatics with a well-tuned Langevin thermostat at moderate friction, for example, an ionic solution at $T=300\\,\\mathrm{K}$ with accurate real-space cutoffs and PME grid spacing.",
            "solution": "This is a problem of identifying the correct physical mechanism for a known artifact in computational physics. I will first validate the problem statement.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- Ensemble: Canonical ensemble at temperature $T$.\n- Theoretical principle: Equipartition theorem, stating each quadratic degree of freedom has an average kinetic energy of $k_{\\mathrm{B}}T/2$.\n- Artifact to explain: \"Flying ice cube\".\n- Task: Explain the physical mechanism and identify a susceptible system and thermostat configuration.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically sound and well-posed.\n- **Scientifically Grounded:** The \"flying ice cube\" is a well-documented artifact in molecular dynamics simulations. The canonical ensemble, equipartition theorem, and various thermostats (Berendsen, Nosé–Hoover) are fundamental concepts in statistical mechanics and computational chemistry/biology.\n- **Well-Posed:** The question asks for an explanation of a known phenomenon and the conditions under which it occurs. This is a standard conceptual question in the field, which has a well-established and unique answer in the scientific literature.\n- **Objective:** The problem is stated using precise, technical terminology (\"canonical ensemble\", \"equipartition theorem\", \"center-of-mass translation\") and is free from subjective or ambiguous language.\n\nAll criteria for a valid problem are met. The problem is not unsound, incomplete, ill-posed, or otherwise flawed.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed to derive the solution and evaluate the options.\n\n### Solution Derivation\n\nThe goal of a molecular dynamics (MD) simulation in the canonical ($NVT$) ensemble is to generate a trajectory of states $(\\vec{r}^N, \\vec{p}^N)$ that samples the Boltzmann distribution, $P(\\vec{r}^N, \\vec{p}^N) \\propto \\exp[-H(\\vec{r}^N, \\vec{p}^N) / (k_{\\mathrm{B}}T)]$. A necessary, though not sufficient, condition for correct canonical sampling is adherence to the equipartition theorem. For a system with $N_{df}$ degrees of freedom, the total kinetic energy, $E_k$, is related to the instantaneous kinetic temperature, $T_{kin}$, by $E_k = (N_{df}/2) k_{\\mathrm{B}} T_{kin}$. In a true canonical ensemble, the average kinetic temperature must equal the target temperature, $\\langle T_{kin} \\rangle = T$, and more importantly, the kinetic energy must be correctly partitioned among all degrees of freedom. For each quadratic degree of freedom $j$, the average kinetic energy must be $\\langle E_{k,j} \\rangle = k_{\\mathrm{B}}T/2$.\n\nThe \"flying ice cube\" artifact is a severe violation of this principle. The name is descriptive: the internal degrees of freedom of the simulated system (e.g., bond vibrations, intermolecular rotations) become \"cold,\" meaning their associated kinetic energy is far below the equipartition value. Concurrently, the kinetic energy associated with the translational motion of the system's center of mass (COM) becomes exceedingly large, causing the entire system to drift or \"fly\" through the simulation box as if it were a single, rigid, cold object—an \"ice cube.\"\n\nThis phenomenon is a direct consequence of using a thermostat that does not generate a true canonical ensemble. The primary culprit is the Berendsen weak-coupling thermostat. This thermostat adjusts the temperature by rescaling all particle velocities, $\\vec{v}_i$, at each time step, $\\Delta t$, by a common factor, $\\lambda$:\n$$ \\vec{v}_i' = \\lambda \\vec{v}_i $$\nwhere $\\lambda$ is calculated as:\n$$ \\lambda = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T} \\left( \\frac{T}{T_{kin}} - 1 \\right)} $$\nHere, $\\tau_T$ is the coupling time constant that determines the strength of the coupling to the external bath.\n\nThe fundamental flaw is that this is a global, deterministic feedback control mechanism. It suppresses the natural kinetic energy fluctuations that should be present in a canonical ensemble. Furthermore, it treats all degrees of freedom identically. In a typical simulation, due to anharmonicity of the potential and numerical integration errors, there is a slow, irreversible flow of energy from high-frequency modes (e.g., bond vibrations) to low-frequency modes. The modes with the lowest frequencies are the translational and rotational motion of the system as a whole.\n\nThe process is as follows:\n$1$. Energy leaks from fast internal modes to the slow COM translational modes.\n$2$. This increases the total kinetic energy, $E_k$, and thus the instantaneous temperature, $T_{kin}$.\n$3$. The Berendsen thermostat detects that $T_{kin} > T$ and calculates a scaling factor $\\lambda  1$.\n$4$. It then scales *all* velocities down by this factor, removing kinetic energy from *all* modes, including the internal ones that were already losing energy.\n$5$. This process repeats, systematically draining kinetic energy from the internal degrees of freedom and failing to prevent its accumulation in the COM translational motion. The thermostat is essentially pumping energy from the \"hot\" internal modes into the \"cold\" translational mode sink, but a more accurate picture is that it fails to properly thermalize the modes independently, allowing the natural downhill energy cascade to become a runaway process.\n\nThis effect is most pronounced in systems where the COM motion is a significant component and the energy gap between slow and fast modes is large. This includes small, stiff systems (like rigid water models or small peptides) under strong thermostatting (small $\\tau_T$), especially if the total COM momentum is not periodically set to zero.\n\n### Option-by-Option Analysis\n\n**A. The artifact arises when a global, deterministic velocity-rescaling scheme systematically suppresses canonical temperature fluctuations and, via anharmonic mode coupling, redistributes kinetic energy from high-frequency internal modes (e.g., bond vibrations) into low-frequency collective motion, especially center-of-mass (COM) translation. This violates equipartition by overpopulating the translational degrees of freedom while leaving internal modes \"cold,\" making the molecule appear rigid while drifting as a whole. It is most pronounced in small or stiff systems under strong weak-coupling control, for example, a small box of rigid water or a small solvated peptide thermostatted with the Berendsen weak-coupling thermostat using a very short coupling time (e.g., $\\tau \\approx 0.05\\,\\mathrm{ps}$) and without periodic removal of total linear momentum.**\nThis statement is a precise and complete description of the phenomenon. It correctly identifies the cause (global, deterministic velocity-rescaling, i.e., Berendsen thermostat), the mechanism (suppression of fluctuations and a one-way energy flow from high- to low-frequency modes), the consequence (violation of equipartition), and the conditions that exacerbate it (small/stiff systems, strong coupling/short $\\tau_T$, and no COM momentum removal).\n**Verdict: Correct.**\n\n**B. The artifact is caused by holonomic bond constraints that eliminate high-frequency vibrations, which makes the internal modes appear artificially cold relative to translation and rotation. It is therefore most severe in large protein systems using a well-tuned Nosé–Hoover chain (NHC) thermostat that correctly samples the canonical distribution; for example, a membrane protein in water with constraints on all bonds, coupled to an NHC thermostat with chain length $ 3$.**\nThis statement is incorrect on multiple grounds. First, while bond constraints remove degrees of freedom, they are not the cause of the energy mis-partitioning among the remaining modes. Second, the artifact is most severe in *small*, not large, systems. Third, the Nosé–Hoover chain (NHC) thermostat is specifically designed to generate a true canonical distribution and *avoids* the flying ice cube artifact. Using a proper thermostat is the solution, not the cause.\n**Verdict: Incorrect.**\n\n**C. The artifact is the generic outcome of numerical instability from a too-large time step, which transfers energy from translational degrees of freedom into high-frequency internal vibrations over time. It is therefore most severe in constant-energy simulations without a thermostat, for example, a small water box propagated with a time step of $4\\,\\mathrm{fs}$ and rigid bonds.**\nThis statement is incorrect. A large time step leads to a general increase in total energy and numerical instability, not the specific, structured energy imbalance of the flying ice cube. Crucially, it claims energy flows from translational (low-frequency) to vibrational (high-frequency) modes, which is the *opposite* of what occurs. Finally, the artifact is caused by a faulty thermostat, so it cannot occur in a constant-energy ($NVE$) simulation that has no thermostat.\n**Verdict: Incorrect.**\n\n**D. The artifact originates from long-range electrostatics errors that create a net force on the simulation box, accelerating the system’s center of mass. It is therefore most severe when using Particle Mesh Ewald (PME) electrostatics with a well-tuned Langevin thermostat at moderate friction, for example, an ionic solution at $T=300\\,\\mathrm{K}$ with accurate real-space cutoffs and PME grid spacing.**\nThis statement is incorrect. While errors in calculating long-range forces can lead to a net drift (non-conservation of momentum), this is a separate issue from the flying ice cube, which is fundamentally a problem of incorrect kinetic energy partitioning caused by the thermostat. Furthermore, the Langevin thermostat, being stochastic, provides proper coupling to a heat bath and robustly thermalizes all modes. It is known to *prevent* the flying ice cube artifact, not cause it.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Beyond physical accuracy, computational efficiency is a cornerstone of modern molecular dynamics. Since the evaluation of non-bonded forces is the most expensive part of a simulation, methods like the Verlet neighbor list are essential. This algorithm's efficiency hinges on a critical trade-off: a larger \"skin\" reduces the frequency of costly list rebuilds but increases the number of pairs in each force calculation. This advanced problem challenges you to model this trade-off mathematically, connecting a physical property—the diffusion coefficient $D$—to algorithmic parameters to derive the optimal skin distance $\\delta^{\\star}$ that minimizes the total computation time . This exercise exemplifies how to bridge physical principles and performance engineering.",
            "id": "4096094",
            "problem": "A homogeneous complex fluid is simulated using Molecular Dynamics (MD) with a truncated pair potential of cutoff radius $r_c$ and a Verlet neighbor list with a skin distance $\\delta$, so that the neighbor-list radius is $r_{\\ell} = r_c + \\delta$. Assume a large, uniform system of number density $\\rho$ in three dimensions and a constant time step $\\Delta t$. The per-pair, per-step force-evaluation wall time is $t_p$, and the neighbor-list rebuild wall time per particle is $t_b$. Over long times, particle displacements are diffusive with diffusion coefficient $D$, such that the mean-square displacement obeys $\\langle |\\Delta \\mathbf{r}(t)|^2 \\rangle = 6 D t$. In practice, the neighbor list is rebuilt whenever the root-mean-square displacement since the last rebuild reaches $\\delta/2$. For a large system in the long-time regime, model the neighbor count per particle as proportional to the volume $V_{\\ell} = \\frac{4\\pi}{3} (r_c + \\delta)^3$, and model the total computational cost rate (wall time per unit physical time) as the sum of (i) the per-step force-evaluation cost rate and (ii) the neighbor-list rebuild cost rate.\n\nStarting from the above physical inputs and definitions only, and without invoking any other pre-fabricated performance models, derive the analytic expression for the optimal skin $\\delta^{\\star}$ that minimizes the total computational cost rate in the asymptotic regime $\\delta \\ll r_c$ (retain the leading nontrivial contribution in $\\delta$ to the force-evaluation cost). Express your final answer as a closed-form function of $D$, $\\rho$, $r_c$, $\\Delta t$, $t_p$, and $t_b$. Do not include units in your final expression. No numerical evaluation is required; provide a single analytic expression only.",
            "solution": "The problem requires the derivation of the optimal skin distance, $\\delta^{\\star}$, that minimizes the total computational cost rate, $C$, for a Molecular Dynamics simulation. The total cost rate is the sum of the force-evaluation cost rate, $C_f$, and the neighbor-list rebuild cost rate, $C_b$:\n$$\nC(\\delta) = C_f(\\delta) + C_b(\\delta)\n$$\nWe will derive expressions for $C_f$ and $C_b$ as functions of the skin distance $\\delta$ and the other provided parameters.\n\nFirst, we determine the neighbor-list rebuild cost rate, $C_b$. The neighbor list is rebuilt whenever the root-mean-square displacement (RMSD) of particles since the last rebuild equals $\\delta/2$. The mean-square displacement (MSD) over a time interval $t$ is given as $\\langle |\\Delta \\mathbf{r}(t)|^2 \\rangle = 6 D t$. The RMSD is the square root of the MSD. Let $T_b$ be the physical time between two consecutive rebuilds. The rebuild condition is:\n$$\n\\sqrt{\\langle |\\Delta \\mathbf{r}(T_b)|^2 \\rangle} = \\frac{\\delta}{2}\n$$\nSubstituting the given expression for the MSD:\n$$\n\\sqrt{6 D T_b} = \\frac{\\delta}{2}\n$$\nSquaring both sides of the equation gives $6 D T_b = \\frac{\\delta^2}{4}$. Solving for $T_b$, we find the physical time between rebuilds:\n$$\nT_b = \\frac{\\delta^2}{24 D}\n$$\nThe wall time for a single neighbor-list rebuild for a system with $N$ particles is the product of the number of particles and the rebuild time per particle, $t_b$, which is $N t_b$. The cost rate $C_b$ is defined as the wall time for one rebuild divided by the physical time elapsed between rebuilds:\n$$\nC_b(\\delta) = \\frac{N t_b}{T_b} = \\frac{N t_b}{\\frac{\\delta^2}{24 D}} = \\frac{24 D N t_b}{\\delta^2}\n$$\nNext, we determine the force-evaluation cost rate, $C_f$. This cost occurs at every time step of duration $\\Delta t$. The cost of force calculation per step is proportional to the number of interacting particle pairs. The neighbor-list radius is given by $r_{\\ell} = r_c + \\delta$. The problem states that the number of neighbors for a single particle, $N_{neigh}$, is proportional to the volume of the neighbor-list sphere, $V_{\\ell} = \\frac{4\\pi}{3} r_{\\ell}^3$. Following the standard physical model, we take the number of neighbors to be the product of the number density $\\rho$ and this volume:\n$$\nN_{neigh} = \\rho V_{\\ell} = \\rho \\frac{4\\pi}{3} (r_c + \\delta)^3\n$$\nFor a system of $N$ particles, the total number of interacting pairs is $\\frac{1}{2} N \\cdot N_{neigh}$, where the factor of $\\frac{1}{2}$ corrects for double counting. The wall time for force evaluation in a single time step, $W_{step}$, is the total number of pairs multiplied by the per-pair evaluation time, $t_p$:\n$$\nW_{step} = \\frac{1}{2} N \\cdot N_{neigh} \\cdot t_p = \\frac{1}{2} N \\left( \\rho \\frac{4\\pi}{3} (r_c + \\delta)^3 \\right) t_p = \\frac{2\\pi N \\rho t_p}{3} (r_c + \\delta)^3\n$$\nThe force-evaluation cost rate, $C_f$, is the wall time per step divided by the duration of that step, $\\Delta t$:\n$$\nC_f(\\delta) = \\frac{W_{step}}{\\Delta t} = \\frac{2\\pi N \\rho t_p}{3 \\Delta t} (r_c + \\delta)^3\n$$\nThe problem requires an analysis in the asymptotic regime where $\\delta \\ll r_c$. We expand the term $(r_c + \\delta)^3$ and retain the leading nontrivial contribution in $\\delta$. Using the binomial approximation $(1+x)^n \\approx 1+nx$ for small $x$:\n$$\n(r_c + \\delta)^3 = r_c^3 \\left(1 + \\frac{\\delta}{r_c}\\right)^3 \\approx r_c^3 \\left(1 + 3\\frac{\\delta}{r_c}\\right) = r_c^3 + 3r_c^2\\delta\n$$\nSubstituting this approximation into the expression for $C_f(\\delta)$:\n$$\nC_f(\\delta) \\approx \\frac{2\\pi N \\rho t_p}{3 \\Delta t} (r_c^3 + 3r_c^2\\delta) = \\frac{2\\pi N \\rho t_p r_c^3}{3 \\Delta t} + \\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} \\delta\n$$\nThe total computational cost rate $C(\\delta)$ in this asymptotic regime is the sum of the approximated $C_f(\\delta)$ and $C_b(\\delta)$:\n$$\nC(\\delta) \\approx \\left( \\frac{2\\pi N \\rho t_p r_c^3}{3 \\Delta t} + \\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} \\delta \\right) + \\frac{24 D N t_b}{\\delta^2}\n$$\nTo find the optimal skin distance $\\delta^{\\star}$ that minimizes $C(\\delta)$, we compute the derivative of $C(\\delta)$ with respect to $\\delta$ and set it to zero. The first term in the expression for $C(\\delta)$ is a constant with respect to $\\delta$.\n$$\n\\frac{dC}{d\\delta} = \\frac{d}{d\\delta} \\left( \\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} \\delta + \\frac{24 D N t_b}{\\delta^2} \\right) = \\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} - 2 \\frac{24 D N t_b}{\\delta^3}\n$$\nSetting the derivative to zero to find the extremum $\\delta^{\\star}$:\n$$\n\\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} - \\frac{48 D N t_b}{(\\delta^{\\star})^3} = 0\n$$\n$$\n\\frac{2\\pi N \\rho t_p r_c^2}{\\Delta t} = \\frac{48 D N t_b}{(\\delta^{\\star})^3}\n$$\nSolving for $(\\delta^{\\star})^3$:\n$$\n(\\delta^{\\star})^3 = \\frac{48 D N t_b \\Delta t}{2\\pi N \\rho t_p r_c^2} = \\frac{24 D t_b \\Delta t}{\\pi \\rho t_p r_c^2}\n$$\nThe total number of particles, $N$, cancels, as expected for an intensive parameter in a large system. Taking the cube root gives the optimal skin distance:\n$$\n\\delta^{\\star} = \\left( \\frac{24 D t_b \\Delta t}{\\pi \\rho t_p r_c^2} \\right)^{1/3}\n$$\nTo confirm that this corresponds to a minimum, we examine the second derivative of the cost function, $\\frac{d^2C}{d\\delta^2} = 3 \\cdot \\frac{48 D N t_b}{\\delta^4} = \\frac{144 D N t_b}{\\delta^4}$. Since all parameters ($D$, $N$, $t_b$) are positive, the second derivative is positive, confirming that $\\delta^{\\star}$ minimizes the total cost rate.",
            "answer": "$$\n\\boxed{\\left( \\frac{24 D t_b \\Delta t}{\\pi \\rho t_p r_c^2} \\right)^{1/3}}\n$$"
        }
    ]
}