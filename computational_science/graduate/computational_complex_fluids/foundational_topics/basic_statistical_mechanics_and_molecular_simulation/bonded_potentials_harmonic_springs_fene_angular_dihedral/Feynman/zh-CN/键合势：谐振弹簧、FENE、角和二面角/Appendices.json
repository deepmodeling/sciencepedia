{
    "hands_on_practices": [
        {
            "introduction": "在分子建模中，我们经常使用不同的数学函数来描述相同的物理相互作用，例如键角弯曲。本练习将探讨两种常见的角势之间的关系：谐振势和余弦势。通过泰勒级数展开，您将了解这些势在小角度运动情况下的等价性，并能对其差异进行量化。这项实践对于理解不同力场的构建方式，以及领会谐振近似（一种在整个物理学中广泛使用的概念）的强大功能与局限性至关重要 。",
            "id": "4079989",
            "problem": "考虑一个用于计算复杂流体的粗粒化珠簧聚合物模型。键的伸缩由有限可伸展非线性弹性（FENE）势来模拟，而连续键之间的弯曲刚度则由角势表示。角弯曲势的两种常用形式是：(i) 由 $U_{\\mathrm{harm}}(\\theta) = \\frac{1}{2} k_{\\theta} (\\theta - \\theta_{0})^{2}$ 给出的谐振子角弹簧，以及 (ii) 由 $U_{\\mathrm{cos}}(\\theta) = \\kappa \\left[ 1 - \\cos(\\theta - \\theta_{0}) \\right]$ 给出的余弦弯曲形式，其中 $\\theta$ 是瞬时键角，$\\theta_{0}$ 是优选（静息）角，$k_{\\theta}$ 是谐振子角刚度，$\\kappa$ 是余弦刚度参数。所有角度均以弧度为单位。\n\n从解析函数在 $x=0$ 附近的标准 Taylor 级数展开式和势能曲率在极小值点的定义出发，对 $\\theta = \\theta_{0}$ 附近进行小角度分析。证明这两个势在 $|\\theta - \\theta_{0}|$ 的主导阶上是等效的，并找出实现这种等效性的 $k_{\\theta}$ 和 $\\kappa$ 之间的映射关系。然后将余弦形式相对于谐振子近似的相对偏差定义为\n$$\\varepsilon(\\theta) = \\frac{U_{\\mathrm{cos}}(\\theta) - U_{\\mathrm{harm}}(\\theta)}{U_{\\mathrm{harm}}(\\theta)}.$$\n在 $|\\theta - \\theta_{0}| \\to 0$ 的极限下，计算 $\\varepsilon(\\theta)$ 的主导阶解析表达式。用 $\\theta$ 和 $\\theta_{0}$ 将你的最终答案表示为一个单一的封闭形式表达式。不需要进行数值计算，也无需四舍五入。角度以弧度为单位。",
            "solution": "该问题要求在小角度偏离平衡位置的极限下，分析分子模拟中使用的两种常见角势：谐振子形式和余弦形式。目标是建立它们在主导阶上的等效性，然后量化在次高阶上的偏差。\n\n两种角势能函数如下：\n1.  谐振子势：$U_{\\mathrm{harm}}(\\theta) = \\frac{1}{2} k_{\\theta} (\\theta - \\theta_{0})^{2}$\n2.  余弦势：$U_{\\mathrm{cos}}(\\theta) = \\kappa \\left[ 1 - \\cos(\\theta - \\theta_{0}) \\right]$\n\n这里，$\\theta$ 是键角，$\\theta_{0}$ 是平衡角或静息角，$k_{\\theta}$ 是谐振子力常数，$\\kappa$ 是余弦势的刚度参数。我们被要求围绕平衡角 $\\theta_{0}$ 进行小角度分析。\n\n让我们将偏离平衡角的量定义为 $\\delta\\theta = \\theta - \\theta_0$。分析将在 $|\\delta\\theta| \\to 0$ 的极限下进行。用这个新变量表示，势能为：\n$U_{\\mathrm{harm}}(\\delta\\theta) = \\frac{1}{2} k_{\\theta} (\\delta\\theta)^{2}$\n$U_{\\mathrm{cos}}(\\delta\\theta) = \\kappa \\left[ 1 - \\cos(\\delta\\theta) \\right]$\n\n为了比较这两种形式在 $\\delta\\theta$ 很小时的情况，我们使用余弦函数在 $0$ 附近的 Taylor 级数展开。对于一个解析函数 $f(x)$，其在 $x=0$ 附近的展开式为 $f(x) = f(0) + f'(0)x + \\frac{f''(0)}{2!}x^2 + \\frac{f'''(0)}{3!}x^3 + \\dots$。\n对于 $f(x) = \\cos(x)$，其导数为 $f'(x) = -\\sin(x)$, $f''(x) = -\\cos(x)$, $f'''(x) = \\sin(x)$, $f^{(4)}(x) = \\cos(x)$ 等。\n在 $x=0$ 处，它们的值为 $f(0)=1$, $f'(0)=0$, $f''(0)=-1$, $f'''(0)=0$, $f^{(4)}(0)=1$。\n因此，$\\cos(x)$ 的 Taylor 级数为：\n$$ \\cos(x) = 1 - \\frac{x^2}{2!} + \\frac{x^4}{4!} - \\frac{x^6}{6!} + \\dots $$\n将 $x = \\delta\\theta$ 代入 $U_{\\mathrm{cos}}$ 的表达式，我们得到：\n$$ U_{\\mathrm{cos}}(\\delta\\theta) = \\kappa \\left[ 1 - \\left( 1 - \\frac{(\\delta\\theta)^2}{2!} + \\frac{(\\delta\\theta)^4}{4!} - \\dots \\right) \\right] $$\n$$ U_{\\mathrm{cos}}(\\delta\\theta) = \\kappa \\left[ \\frac{(\\delta\\theta)^2}{2} - \\frac{(\\delta\\theta)^4}{24} + O((\\delta\\theta)^6) \\right] $$\n表达式 $O((\\delta\\theta)^6)$ 表示 $(\\delta\\theta)^6$ 阶及更高阶的项，对于非常小的 $\\delta\\theta$ 可以忽略不计。\n\n$U_{\\mathrm{cos}}$ 在此展开式中的主导项是 $\\frac{1}{2}\\kappa(\\delta\\theta)^2$。谐振子势给出为 $U_{\\mathrm{harm}}(\\delta\\theta) = \\frac{1}{2} k_{\\theta} (\\delta\\theta)^{2}$。要使这两个势在 $\\delta\\theta$ 的主导阶上等效，它们的主导项必须相同。\n$$ \\frac{1}{2} k_{\\theta} (\\delta\\theta)^{2} = \\frac{1}{2} \\kappa (\\delta\\theta)^{2} $$\n这种等效性要求刚度参数之间的关系为：\n$$ k_{\\theta} = \\kappa $$\n这个结果表明，对于偏离静息角的小位移，余弦势的行为类似于一个谐振子弹簧，其弹簧常数 $k_{\\theta}$ 等于余弦刚度参数 $\\kappa$。这与一般原理相符，即任何平滑势能的极小值点在小位移下都可以用谐振子势来近似，其中有效弹簧常数是势能在极小值点的曲率。对于这两种势，极小值点都在 $\\delta\\theta=0$ 处，并且在该点的二阶导数（曲率）分别为 $k_\\theta$ 和 $\\kappa$。\n\n接下来，我们被要求计算相对偏差的主导阶表达式，其定义为：\n$$ \\varepsilon(\\theta) = \\frac{U_{\\mathrm{cos}}(\\theta) - U_{\\mathrm{harm}}(\\theta)}{U_{\\mathrm{harm}}(\\theta)} $$\n要计算这个，我们必须使用已建立的等效关系 $k_{\\theta} = \\kappa$。$U_{\\mathrm{cos}}$ 的表达式可以写为 $U_{\\mathrm{cos}}(\\theta) = k_{\\theta} \\left[ 1 - \\cos(\\theta - \\theta_{0}) \\right]$。\n让我们再次使用变量 $\\delta\\theta = \\theta - \\theta_0$。$\\varepsilon$ 的分子是：\n$$ U_{\\mathrm{cos}}(\\delta\\theta) - U_{\\mathrm{harm}}(\\delta\\theta) = k_{\\theta} \\left[ 1 - \\cos(\\delta\\theta) \\right] - \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2 $$\n使用 $\\cos(\\delta\\theta)$ 直到四阶项的 Taylor 级数展开：\n$$ U_{\\mathrm{cos}}(\\delta\\theta) - U_{\\mathrm{harm}}(\\delta\\theta) = k_{\\theta} \\left[ 1 - \\left( 1 - \\frac{(\\delta\\theta)^2}{2} + \\frac{(\\delta\\theta)^4}{24} - O((\\delta\\theta)^6) \\right) \\right] - \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2 $$\n$$ = k_{\\theta} \\left[ \\frac{(\\delta\\theta)^2}{2} - \\frac{(\\delta\\theta)^4}{24} + \\dots \\right] - \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2 $$\n$(\\delta\\theta)^2$ 阶的项相互抵消：\n$$ = \\left( \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2 - \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2 \\right) - \\frac{k_{\\theta}(\\delta\\theta)^4}{24} + \\dots $$\n因此，分子的主导项是：\n$$ U_{\\mathrm{cos}}(\\delta\\theta) - U_{\\mathrm{harm}}(\\delta\\theta) \\approx -\\frac{k_{\\theta}}{24}(\\delta\\theta)^4 $$\n分母是 $U_{\\mathrm{harm}}(\\delta\\theta) = \\frac{1}{2} k_{\\theta} (\\delta\\theta)^2$。\n现在我们可以计算相对偏差 $\\varepsilon(\\theta)$：\n$$ \\varepsilon(\\theta) = \\frac{-\\frac{k_{\\theta}}{24}(\\delta\\theta)^4 + O((\\delta\\theta)^6)}{\\frac{1}{2} k_{\\theta} (\\delta\\theta)^2} $$\n在 $|\\delta\\theta| \\to 0$ 的极限下，我们关心这个比值的主导项：\n$$ \\varepsilon(\\theta) \\approx \\frac{-\\frac{k_{\\theta}}{24}(\\delta\\theta)^4}{\\frac{1}{2} k_{\\theta} (\\delta\\theta)^2} = -\\frac{1}{24} \\cdot \\frac{2}{1} \\cdot \\frac{k_{\\theta}}{k_{\\theta}} \\cdot \\frac{(\\delta\\theta)^4}{(\\delta\\theta)^2} $$\n$$ \\varepsilon(\\theta) \\approx -\\frac{2}{24} (\\delta\\theta)^2 = -\\frac{1}{12} (\\delta\\theta)^2 $$\n将 $\\delta\\theta$ 替换为其定义 $\\delta\\theta = \\theta - \\theta_0$，我们得到相对偏差主导阶的最终表达式：\n$$ \\varepsilon(\\theta) = -\\frac{1}{12}(\\theta - \\theta_0)^2 $$\n这表明，对于小而有限的角度偏差，余弦势比其谐振子近似要稍微软一些（即能量更低），其偏差与偏离平衡角的位移成二次方关系。",
            "answer": "$$\\boxed{-\\frac{1}{12}(\\theta - \\theta_{0})^2}$$"
        },
        {
            "introduction": "既然我们有了势能模型，那么它的特性在一个有限温度的系统中是如何表现出来的呢？这个问题通过均分定理将微观势能函数与宏观热力学联系起来。您将推导出一个键角在热浴中的平均涨落，并验证其是否遵循经典统计力学的预测。这项练习加强了统计力学与模拟之间的桥梁，展示了一个简单的模型如何在正则系综下进行平均，从而再现基本的物理定律，这对于验证模拟结果和理解热涨落非常有帮助 。",
            "id": "4080033",
            "problem": "考虑嵌入在复杂流体中的一个粗粒化聚合物链段中的单个弯曲角，该角由三个连续珠子的位置 $\\mathbf{r}_{i-1}$、$\\mathbf{r}_{i}$ 和 $\\mathbf{r}_{i+1}$ 定义。角 $\\theta$ 张成了两个化学键 $(\\mathbf{r}_{i-1}, \\mathbf{r}_{i})$ 和 $(\\mathbf{r}_{i}, \\mathbf{r}_{i+1})$。假设化学键本身由有限可延展非线性弹性（FENE）弹簧来维持，这些弹簧足够硬，以至于在分析角度涨落时可以忽略键长的涨落。在围绕一个优选角度 $\\theta_0$ 的小角度范围内，弯曲势是谐和的，由 $U_{\\text{bend}}(\\theta) = \\frac{1}{2} k_{\\theta} (\\theta - \\theta_0)^2$ 给出，其中 $k_{\\theta}  0$ 是弯曲刚度。\n\n该系统与一个绝对温度为 $T$ 的热浴接触，并且弯曲角是从正则系综中采样的。$\\theta$ 的概率密度正比于玻尔兹曼权重 $\\exp\\!\\left[-\\beta U_{\\text{bend}}(\\theta)\\right]$（其中 $\\beta = 1/(k_B T)$），并包含了三维角度通常的几何测度因子。假设 $\\theta_0 \\in (0, \\pi)$，且涨落足够小，以至于谐和近似是有效的。\n\n使用统计力学的第一性原理和由刚度 $k_{\\theta}$ 保证的适当小角度近似，推导在谐和、小角度范围内热平均值 $\\langle (\\theta - \\theta_0)^2 \\rangle$ 对温度的依赖关系的解析表达式。然后用您的结果来评估在此范围内能量均分定理对于弯曲对平均势能的贡献的有效性。您的最终表达式必须在无量纲小参数 $k_B T / k_{\\theta}$ 的主导阶上有效。\n\n角度 $\\theta$ 以弧度表示。将 $\\langle (\\theta - \\theta_0)^2 \\rangle$ 的最终答案以 $k_B$、$T$ 和 $k_{\\theta}$ 表示的单个闭式解析表达式形式给出，并且不要在最终的方框答案中包含单位。不需要进行数值计算。",
            "solution": "主要任务是为一个粗粒化聚合物模型中的弯曲势推导角偏差平方的热平均值 $\\langle (\\theta - \\theta_0)^2 \\rangle$。系统处于温度为 $T$ 的正则系综中。\n\n角 $\\theta$ 的概率密度函数 $P(\\theta)$ 正比于玻尔兹曼权重与三维空间中角度的几何测度因子的乘积。该测度因子来自于对立体角元 $d\\Omega = \\sin(\\theta) d\\theta d\\phi$ 对方位角 $\\phi$ 进行积分，从而得到一个因子 $2\\pi \\sin(\\theta)$。因此，$\\theta$ 的概率密度由下式给出：\n$$ P(\\theta) = \\frac{1}{Z} \\sin(\\theta) \\exp[-\\beta U_{\\text{bend}}(\\theta)] $$\n其中 $\\beta = 1/(k_B T)$，$U_{\\text{bend}}(\\theta) = \\frac{1}{2} k_{\\theta} (\\theta - \\theta_0)^2$，而 $Z$ 是配分函数，它作为一个归一化常数：\n$$ Z = \\int_0^\\pi \\sin(\\theta) \\exp\\left[-\\frac{\\beta k_{\\theta}}{2} (\\theta - \\theta_0)^2\\right] d\\theta $$\n热平均值 $\\langle (\\theta - \\theta_0)^2 \\rangle$ 是作为偏差 $(\\theta - \\theta_0)$ 相对于此概率分布的二阶矩来计算的：\n$$ \\langle (\\theta - \\theta_0)^2 \\rangle = \\int_0^\\pi (\\theta - \\theta_0)^2 P(\\theta) d\\theta = \\frac{\\int_0^\\pi (\\theta - \\theta_0)^2 \\sin(\\theta) \\exp\\left[-\\frac{\\beta k_{\\theta}}{2} (\\theta - \\theta_0)^2\\right] d\\theta}{\\int_0^\\pi \\sin(\\theta) \\exp\\left[-\\frac{\\beta k_{\\theta}}{2} (\\theta - \\theta_0)^2\\right] d\\theta} $$\n问题指出涨落很小，这对应于谐和势很硬，即 $k_{\\theta}$ 很大，或温度 $T$ 很低。在此范围内，无量纲参数 $k_B T / k_{\\theta}$ 很小。这意味着高斯项 $\\exp\\left[-\\frac{\\beta k_{\\theta}}{2} (\\theta - \\theta_0)^2\\right]$ 在 $\\theta = \\theta_0$ 附近呈尖峰状。这种尖锐性使得几种合理的近似成为可能。\n\n让我们为涨落引入一个新变量 $x = \\theta - \\theta_0$。那么 $d\\theta = dx$。$x$ 的积分限从 $-\\theta_0$ 到 $\\pi - \\theta_0$。平均值的表达式变为：\n$$ \\langle x^2 \\rangle = \\frac{\\int_{-\\theta_0}^{\\pi - \\theta_0} x^2 \\sin(\\theta_0 + x) \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx}{\\int_{-\\theta_0}^{\\pi - \\theta_0} \\sin(\\theta_0 + x) \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx} $$\n由于高斯函数 $\\exp(-\\frac{\\beta k_{\\theta}}{2} x^2)$ 随着 $x$ 远离 0 而迅速衰减，两个积分的主要贡献都来自 $x=0$ 附近一个非常窄的区域。在这个区域内，与指数项相比，$\\sin(\\theta_0 + x)$ 项是缓变的。因此，我们可以用它在峰值 $x=0$ 处的值来近似它：\n$$ \\sin(\\theta_0 + x) \\approx \\sin(\\theta_0) $$\n这个近似在主导阶上是有效的。问题指出 $\\theta_0 \\in (0, \\pi)$，这确保了 $\\sin(\\theta_0)  0$，所以我们没有用零来近似。通过这个近似，$\\sin(\\theta_0)$ 项是一个常数，并且可以从分子和分母中消去：\n$$ \\langle x^2 \\rangle \\approx \\frac{\\int_{-\\theta_0}^{\\pi - \\theta_0} x^2 \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx}{\\int_{-\\theta_0}^{\\pi - \\theta_0} \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx} $$\n此外，由于被积函数在远离 $x=0$ 的地方可以忽略不计，将有限的积分限 $[-\\theta_0, \\pi - \\theta_0]$ 扩展到 $(-\\infty, \\infty)$ 只会引入一个非常小的误差，这个误差是小参数 $k_B T / k_{\\theta}$ 的高阶项。这是合理的，因为 $\\theta_0$ 和 $\\pi-\\theta_0$ 都远大于角度的标准差，该标准差的量级为 $\\sqrt{k_B T / k_\\theta}$。\n$$ \\langle x^2 \\rangle \\approx \\frac{\\int_{-\\infty}^{\\infty} x^2 \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_{\\theta}}{2} x^2\\right) dx} $$\n令 $\\alpha = \\frac{\\beta k_{\\theta}}{2}$。这些积分是标准的高斯积分。分母是：\n$$ I_0 = \\int_{-\\infty}^{\\infty} \\exp(-\\alpha x^2) dx = \\sqrt{\\frac{\\pi}{\\alpha}} $$\n分子可以通过对 $I_0$ 关于 $\\alpha$ 求导得到：\n$$ I_2 = \\int_{-\\infty}^{\\infty} x^2 \\exp(-\\alpha x^2) dx = -\\frac{d}{d\\alpha} \\int_{-\\infty}^{\\infty} \\exp(-\\alpha x^2) dx = -\\frac{d}{d\\alpha} \\left(\\sqrt{\\frac{\\pi}{\\alpha}}\\right) = -\\sqrt{\\pi} \\left(-\\frac{1}{2}\\alpha^{-3/2}\\right) = \\frac{1}{2\\alpha} \\sqrt{\\frac{\\pi}{\\alpha}} $$\n比值为：\n$$ \\langle x^2 \\rangle = \\frac{I_2}{I_0} = \\frac{\\frac{1}{2\\alpha} \\sqrt{\\frac{\\pi}{\\alpha}}}{\\sqrt{\\frac{\\pi}{\\alpha}}} = \\frac{1}{2\\alpha} $$\n将 $\\alpha = \\frac{\\beta k_{\\theta}}{2}$ 代回：\n$$ \\langle (\\theta - \\theta_0)^2 \\rangle = \\frac{1}{2 \\left(\\frac{\\beta k_{\\theta}}{2}\\right)} = \\frac{1}{\\beta k_{\\theta}} $$\n最后，代入 $\\beta = 1/(k_B T)$：\n$$ \\langle (\\theta - \\theta_0)^2 \\rangle = \\frac{k_B T}{k_{\\theta}} $$\n这就是在 $k_B T / k_{\\theta}$ 的主导阶上，$\\langle (\\theta - \\theta_0)^2 \\rangle$ 对温度依赖关系的所需解析表达式。\n\n任务的第二部分是评估能量均分定理的有效性。该定理指出，对于处于热平衡状态的经典系统，总能量中每个以二次方形式出现的自由度的平均能量为 $\\frac{1}{2} k_B T$。\n弯曲势能为 $U_{\\text{bend}}(\\theta) = \\frac{1}{2} k_{\\theta} (\\theta - \\theta_0)^2$。这是坐标 $(\\theta - \\theta_0)$ 的一个二次函数。\n弯曲对平均势能的贡献是：\n$$ \\langle U_{\\text{bend}} \\rangle = \\left\\langle \\frac{1}{2} k_{\\theta} (\\theta - \\theta_0)^2 \\right\\rangle = \\frac{1}{2} k_{\\theta} \\langle (\\theta - \\theta_0)^2 \\rangle $$\n代入我们为 $\\langle (\\theta - \\theta_0)^2 \\rangle$ 推导出的结果：\n$$ \\langle U_{\\text{bend}} \\rangle = \\frac{1}{2} k_{\\theta} \\left( \\frac{k_B T}{k_{\\theta}} \\right) = \\frac{1}{2} k_B T $$\n这个结果恰好是能量均分定理对单个二次自由度的预测。因此，我们的推导证实了能量均分定理在谐和、小涨落范围内对于弯曲能量贡献是有效的。所做的近似（将 $\\sin(\\theta)$ 近似为常数并扩展积分限）与能量均分定理对这样一个坐标预期成立的条件下的近似是相同的。",
            "answer": "$$\\boxed{\\frac{k_B T}{k_{\\theta}}}$$"
        },
        {
            "introduction": "除了简单的系综平均值，计算方法还使我们能够计算更深奥的热力学量，例如自由能，而这通常不是直接的观测量。本实践介绍了一种计算自由能差异的强大技术——热力学积分。您将应用该方法，计算当一个聚合物链段的弯曲刚度改变时，其自由能的变化。这是一个集分析推导与数值实现于一体的综合性练习，是计算科学中的一项核心技能。成功完成此问题  将证明您对如何利用模拟来探究系统基本热力学性质已具备了高阶的理解。",
            "id": "4079987",
            "problem": "考虑一个嵌入在三维空间中的线性四位点片段，其键合相互作用由以下物理标准分量组成：(i) 每个键的键长伸缩贡献，可以是谐振子弹簧或有限可伸展非线性弹性 (FENE) 弹簧；(ii) 两个键角贡献；以及 (iii) 一个二面角（扭转）贡献。假设总势能可加性地分解为内坐标的独立项之和，因此，在内坐标中，哈密顿量可以写为\n$$\nU(\\Gamma; k_\\theta) = U_{\\text{bonds}}(r_1,r_2,r_3) + U_{\\text{angle,1}}(\\theta; k_\\theta) + U_{\\text{angle,2}}(\\theta_2; k_{\\theta,2}) + U_{\\text{dihedral}}(\\phi; \\mathbf{p}_\\phi),\n$$\n其中 $r_1$、 $r_2$ 和 $r_3$ 是键长，$\\theta$ 是第一个键角，其刚度参数 $k_\\theta$ 我们将进行改变，$\\theta_2$ 是第二个键角，其刚度固定为 $k_{\\theta,2}$，$\\phi$ 是二面角，其参数集固定为 $\\mathbf{p}_\\phi$。对于第一个键角，采用二次角势\n$$\nU_{\\text{angle,1}}(\\theta; k_\\theta) = \\tfrac{1}{2} k_\\theta \\, (\\theta - \\theta_0)^2,\n$$\n其中有一个预设的参考角 $\\theta_0 \\in [0,\\pi]$（以弧度为单位）。假设 $U_{\\text{bonds}}$ 和 $U_{\\text{dihedral}}$ 不依赖于 $\\theta$，并且所有内坐标都是独立的，即内坐标中的构型空间测度可以分解为相应雅可比因子的乘积。特别地，对于三维空间中的单个键角，测度在对 $\\theta \\in [0,\\pi]$ 积分时贡献一个因子 $\\sin\\theta$。\n\n在逆温度 $\\beta = 1$（其中热能 $k_{\\mathrm{B}} T = 1$ 的无量纲单位）的正则系综中进行计算，因此配分函数为\n$$\nZ(k_\\theta) = \\int \\mathrm{d}\\Gamma \\, \\exp\\big(-U(\\Gamma; k_\\theta)\\big),\n$$\n自由能为 $F(k_\\theta) = - \\ln Z(k_\\theta)$。通过热力学积分，两个刚度值 $k_\\theta^{(1)}$ 和 $k_\\theta^{(2)}$ 之间的自由能差为\n$$\n\\Delta f \\equiv \\beta \\Delta F = \\int_{k_\\theta^{(1)}}^{k_\\theta^{(2)}} \\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta} \\, \\mathrm{d}k_\\theta,\n$$\n其中 $\\langle \\cdot \\rangle_{k_\\theta}$ 表示在固定 $k_\\theta$ 和 $\\beta = 1$ 时的正则系综平均。导数 $\\partial U/\\partial k_\\theta$ 是在固定构型 $\\Gamma$ 下计算的。\n\n从正则系综的第一性原理出发，仅使用所述的独立性假设和三维标准内坐标测度，推导出系综平均 $\\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta}$ 关于键角 $\\theta$ 的一维积分表达式。然后，实现一个数值程序来评估热力学积分，以获得下面测试套件中列出的参数集的无量纲自由能差 $\\Delta f$。数值评估必须对内层的 $\\theta$ 系综平均和外层的 $k_\\theta$ 积分都采用高精度求积法。\n\n您必须遵守以下建模和数值要求：\n- 使用正则系综定义以及 $U_{\\text{bonds}}$、$U_{\\text{angle,2}}$ 和 $U_{\\text{dihedral}}$ 不依赖于 $\\theta$ 这一事实，将系综平均简化为在 $\\theta \\in [0,\\pi]$ 上带有正确测度因子 $\\sin\\theta$ 的积分。\n- 使用 $\\beta = 1$（无量纲），因此输出的自由能差是无量纲量 $\\Delta f$。\n- 所有角度必须以弧度为单位。\n- 内层平均必须作为对 $\\theta$ 的积分来评估，外层对 $k_\\theta$ 的积分必须在指定区间上进行。两个积分都必须以足够的精度进行数值计算，以可靠地处理 $k_\\theta$ 非常小、非常大或 $\\theta_0$ 接近 $[0,\\pi]$ 边界的情况。\n\n测试套件：\n对于下面的每种情况，计算两个刚度值之间的无量纲自由能差 $\\Delta f$。每种情况由一个元组 $(\\theta_0, k_\\theta^{(1)}, k_\\theta^{(2)})$ 指定，其中 $\\theta_0$ 以弧度为单位，$k_\\theta^{(1)}, k_\\theta^{(2)}$ 为无量纲：\n\n1. $(\\theta_0 = \\tfrac{\\pi}{2}, \\, k_\\theta^{(1)} = 0.0, \\, k_\\theta^{(2)} = 5.0)$\n2. $(\\theta_0 = 1.0, \\, k_\\theta^{(1)} = 10^{-8}, \\, k_\\theta^{(2)} = 10.0)$\n3. $(\\theta_0 = 0.05, \\, k_\\theta^{(1)} = 0.0, \\, k_\\theta^{(2)} = 20.0)$\n4. $(\\theta_0 = 1.2, \\, k_\\theta^{(1)} = 50.0, \\, k_\\theta^{(2)} = 500.0)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目是对应测试用例的无量纲自由能差 $\\Delta f$，顺序与上面相同，并四舍五入到八位小数（例如，\"[1.23456789,0.12345678,2.00000000,0.00001234]\"）。",
            "solution": "该问题要求推导正则系综平均的表达式，并随后在数值热力学积分中使用该表达式来计算自由能差。我们将首先从第一性原理进行推导，然后概述数值计算过程。\n\n需要求平均的量是总势能 $U$ 相对于刚度参数 $k_\\theta$ 的偏导数。势能以可加和的形式给出：\n$$\nU(\\Gamma; k_\\theta) = U_{\\text{bonds}}(r_1,r_2,r_3) + U_{\\text{angle,1}}(\\theta; k_\\theta) + U_{\\text{angle,2}}(\\theta_2; k_{\\theta,2}) + U_{\\text{dihedral}}(\\phi; \\mathbf{p}_\\phi)\n$$\n第一个角势的具体形式为 $U_{\\text{angle,1}}(\\theta; k_\\theta) = \\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2$。由于 $U$ 中的所有其他项都与 $k_\\theta$ 无关，其偏导数为：\n$$\n\\frac{\\partial U(\\Gamma; k_\\theta)}{\\partial k_\\theta} = \\frac{\\partial}{\\partial k_\\theta} \\left[ \\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2 \\right] = \\frac{1}{2} (\\theta - \\theta_0)^2\n$$\n请注意，此导数是在固定的微观构型 $\\Gamma$ 下计算的，因此它仅依赖于坐标 $\\theta$。\n\n在逆温度 $\\beta=1$ 下，该量的正则系综平均由下式给出：\n$$\n\\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta} = \\left\\langle \\frac{1}{2} (\\theta - \\theta_0)^2 \\right\\rangle_{k_\\theta} = \\frac{\\int \\mathrm{d}\\Gamma \\, \\left[ \\frac{1}{2} (\\theta - \\theta_0)^2 \\right] e^{-U(\\Gamma; k_\\theta)}}{\\int \\mathrm{d}\\Gamma \\, e^{-U(\\Gamma; k_\\theta)}}\n$$\n问题陈述所有内坐标都是独立的，并且构型空间测度可以因子分解。我们可以将对所有自由度 $\\Gamma$ 的积分测度表示为每个独立内坐标测度的乘积：\n$$\n\\mathrm{d}\\Gamma = \\mathrm{d}\\Gamma_{\\text{bonds}} \\cdot \\mathrm{d}\\Gamma_{\\text{angle,2}} \\cdot \\mathrm{d}\\Gamma_{\\text{dihedral}} \\cdot \\sin\\theta \\, \\mathrm{d}\\theta\n$$\n这里，$\\mathrm{d}\\Gamma_{\\text{bonds}}$ 包括了对 $r_1, r_2, r_3$ 等的测度。关键信息是角度 $\\theta$ 的测度，对于在 $\\theta \\in [0, \\pi]$ 上的积分，该测度为 $\\sin\\theta \\, \\mathrm{d}\\theta$。\n\n鉴于势能 $U$ 的可加形式，玻尔兹曼因子 $e^{-U}$ 也可以因子分解：\n$$\ne^{-U(\\Gamma; k_\\theta)} = e^{-U_{\\text{bonds}}} \\cdot e^{-U_{\\text{angle,2}}} \\cdot e^{-U_{\\text{dihedral}}} \\cdot e^{-U_{\\text{angle,1}}(\\theta; k_\\theta)}\n$$\n让我们分析配分函数 $Z(k_\\theta)$，它是系综平均的分母。该积分可以分解为对独立坐标的积分的乘积：\n$$\nZ(k_\\theta) = \\left( \\int \\mathrm{d}\\Gamma_{\\text{bonds}} \\, e^{-U_{\\text{bonds}}} \\right) \\left( \\int \\mathrm{d}\\Gamma_{\\text{angle,2}} \\, e^{-U_{\\text{angle,2}}} \\right) \\left( \\int \\mathrm{d}\\Gamma_{\\text{dihedral}} \\, e^{-U_{\\text{dihedral}}} \\right) \\left( \\int_0^\\pi \\sin\\theta \\, e^{-U_{\\text{angle,1}}(\\theta; k_\\theta)} \\, \\mathrm{d}\\theta \\right)\n$$\n前三个积分是相对于 $k_\\theta$ 的常数。我们将它们组合成一个单一常数 $C$。\n$$\nZ(k_\\theta) = C \\cdot \\int_0^\\pi \\sin\\theta \\, e^{-\\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2} \\, \\mathrm{d}\\theta\n$$\n类似地，系综平均的分子变为：\n$$\n\\text{Numerator} = C \\cdot \\int_0^\\pi \\left[ \\frac{1}{2} (\\theta - \\theta_0)^2 \\right] \\sin\\theta \\, e^{-\\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2} \\, \\mathrm{d}\\theta\n$$\n当我们计算分子与分母的比值时，常数 $C$ 会被约去。这就得到了我们所期望的、用关于 $\\theta$ 的一维积分表示的系综平均表达式：\n$$\n\\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta} = \\frac{\\int_0^\\pi \\frac{1}{2} (\\theta - \\theta_0)^2 \\sin\\theta \\, e^{-\\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2} \\, \\mathrm{d}\\theta}{\\int_0^\\pi \\sin\\theta \\, e^{-\\frac{1}{2} k_\\theta (\\theta - \\theta_0)^2} \\, \\mathrm{d}\\theta}\n$$\n对于给定的 $k_\\theta$ 和 $\\theta_0$，必须对该表达式进行求值。\n\n无量纲自由能差 $\\Delta f$ 是通过将此系综平均在指定的刚度值范围 $[k_\\theta^{(1)}, k_\\theta^{(2)}]$ 上积分得到的：\n$$\n\\Delta f = \\int_{k_\\theta^{(1)}}^{k_\\theta^{(2)}} \\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta} \\, \\mathrm{d}k_\\theta\n$$\n这是一个嵌套积分问题。内层的 $\\theta$ 积分和外层的 $k_\\theta$ 积分都将使用高质量的自适应求积法进行数值计算，具体来说是 `scipy.integrate.quad` 函数。\n\n对于 $k_\\theta = 0$ 的特殊情况，指数项变为 $e^0 = 1$。积分可以解析求解。\n分母是 $\\int_0^\\pi \\sin\\theta \\, \\mathrm{d}\\theta = 2$。\n分子积分是 $\\int_0^\\pi \\frac{1}{2} (\\theta - \\theta_0)^2 \\sin\\theta \\, \\mathrm{d}\\theta$。使用分部积分法，可以得到：\n$$\n\\int_0^\\pi (\\theta - \\theta_0)^2 \\sin\\theta \\, \\mathrm{d}\\theta = \\pi^2 - 2\\pi\\theta_0 + 2\\theta_0^2 - 4\n$$\n因此，对于 $k_\\theta = 0$，系综平均为：\n$$\n\\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta=0} = \\frac{\\frac{1}{2} (\\pi^2 - 2\\pi\\theta_0 + 2\\theta_0^2 - 4)}{2} = \\frac{1}{4}(\\pi^2 - 2\\pi\\theta_0 + 2\\theta_0^2 - 4)\n$$\n当外层积分的求积例程需要在 $k_\\theta = 0$ 处求值时，将使用这个解析结果。对于非零的 $k_\\theta$，两个关于 $\\theta$ 的一维积分的比值将进行数值计算。对于大的 $k_\\theta$，被积函数在 $\\theta_0$ 附近变得非常尖锐，求积算法的自适应特性可以有效地处理这种情况。\n\n总体的数值步骤如下：\n1. 定义一个函数 `ensemble_avg(k_theta, theta_0)`，用于计算 $\\left\\langle \\frac{\\partial U}{\\partial k_\\theta} \\right\\rangle_{k_\\theta}$。\n2. 在此函数内部，如果 `k_theta` 为零，则返回解析结果。否则，定义分子和分母关于 $\\theta$ 的积分的被积函数。\n3. 使用 `scipy.integrate.quad` 计算这两个积分并返回它们的比值。\n4. 对于每个测试用例 $(\\theta_0, k_\\theta^{(1)}, k_\\theta^{(2)})$，再次调用 `scipy.integrate.quad`，将 `ensemble_avg` 对 $k_\\theta$ 从 $k_\\theta^{(1)}$ 到 $k_\\theta^{(2)}$ 进行积分。$\\theta_0$ 的值作为固定参数传递。\n5. 存储并按要求格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless free energy difference for a harmonic angle potential\n    using thermodynamic integration.\n    \"\"\"\n\n    test_cases = [\n        (np.pi / 2.0, 0.0, 5.0),\n        (1.0, 1e-8, 10.0),\n        (0.05, 0.0, 20.0),\n        (1.2, 50.0, 500.0)\n    ]\n\n    results = []\n\n    def ensemble_avg(k_theta, theta_0):\n        \"\"\"\n        Computes the ensemble average ∂U/∂k_theta for a given k_theta and theta_0.\n        This is the integrand for the thermodynamic integration.\n        \"\"\"\n        # Handle the k_theta = 0 case analytically for precision and stability.\n        if k_theta == 0.0:\n            # Denominator integral ∫sin(θ)dθ from 0 to π is 2.\n            # Numerator integral is 0.5 * ∫(θ-θ₀)²sin(θ)dθ.\n            # The indefinite integral of (θ-θ₀)²sin(θ) is\n            # -(θ-θ₀)²cos(θ) + 2(θ-θ₀)sin(θ) + 2cos(θ).\n            # Definite integral from 0 to π is π² - 2πθ₀ + 2θ₀² - 4.\n            num_integral_val = np.pi**2 - 2 * np.pi * theta_0 + 2 * theta_0**2 - 4\n            return (0.5 * num_integral_val) / 2.0\n\n        # Define the integrands for the numerator and denominator of the average.\n        # The exponential term can cause underflow for large k_theta, which is\n        # handled by np.exp returning 0.0. This is numerically correct.\n        \n        def num_integrand(theta, k, t0):\n            \"\"\"Integrand for the numerator.\"\"\"\n            exponent = -0.5 * k * (theta - t0)**2\n            return 0.5 * (theta - t0)**2 * np.sin(theta) * np.exp(exponent)\n\n        def den_integrand(theta, k, t0):\n            \"\"\"Integrand for the denominator (the angular part of the partition function).\"\"\"\n            exponent = -0.5 * k * (theta - t0)**2\n            return np.sin(theta) * np.exp(exponent)\n\n        # Numerically integrate over θ from 0 to π\n        num_val, _ = quad(num_integrand, 0, np.pi, args=(k_theta, theta_0))\n        den_val, _ = quad(den_integrand, 0, np.pi, args=(k_theta, theta_0))\n\n        # The denominator should not be zero for physically realistic parameters,\n        # but as a failsafe, we prevent division by zero.\n        if den_val == 0.0:\n            # For very large k_theta, the ensemble average approaches 1/(2*k_theta)\n            # based on the equipartition theorem. This can be used as a fallback if\n            # the numerical integration underflows.\n            return 1.0 / (2.0 * k_theta) if k_theta  0 else 0.0\n            \n        return num_val / den_val\n\n    for case in test_cases:\n        theta_0, k_theta1, k_theta2 = case\n\n        # Perform the outer integral (thermodynamic integration over k_theta)\n        # The 'ensemble_avg' function serves as the integrand.\n        delta_f, _ = quad(ensemble_avg, k_theta1, k_theta2, args=(theta_0,))\n        \n        # Format the result to eight decimal places\n        results.append(f\"{delta_f:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}