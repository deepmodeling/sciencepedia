{
    "hands_on_practices": [
        {
            "introduction": "To begin, we will ground our understanding with a direct calculation in a simple orthorhombic system. In such cells, the minimum image convention can be applied independently to each Cartesian dimension, making it the ideal starting point. This exercise  will walk you through the fundamental steps of calculating the minimum image displacement and using it to determine whether two particles interact based on a cutoff distance.",
            "id": "3830822",
            "problem": "Consider a three-dimensional orthorhombic simulation cell with Periodic Boundary Conditions (PBC), meaning that the cell is conceptually replicated in all directions so that any point $\\mathbf{r}$ is physically equivalent to $\\mathbf{r} + n_{x} L_{x} \\hat{\\mathbf{x}} + n_{y} L_{y} \\hat{\\mathbf{y}} + n_{z} L_{z} \\hat{\\mathbf{z}}$ for any integers $n_{x}$, $n_{y}$, and $n_{z}$. The Minimum Image Convention (MIC) states that for evaluating a short-ranged pairwise interaction, the relevant displacement between two particles is the vector of minimum Euclidean norm among all periodic images. Let the cell edge lengths be $L_{x} = 3.6\\,\\mathrm{nm}$, $L_{y} = 4.2\\,\\mathrm{nm}$, and $L_{z} = 5.0\\,\\mathrm{nm}$. Two particles are located at Cartesian positions $\\mathbf{r}_{1} = (0.5\\,\\mathrm{nm},\\, 3.9\\,\\mathrm{nm},\\, 4.8\\,\\mathrm{nm})$ and $\\mathbf{r}_{2} = (3.4\\,\\mathrm{nm},\\, 0.6\\,\\mathrm{nm},\\, 0.4\\,\\mathrm{nm})$ within the primary cell. Assume a pair potential truncated at a cutoff radius $r_{c} = 1.30\\,\\mathrm{nm}$, so that the particles interact if and only if their MIC distance is less than or equal to $r_{c}$.\n\nStarting only from the definitions of PBC, the Euclidean norm, and MIC as the selection of the shortest periodic displacement, derive the minimum image displacement vector $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$ and its magnitude $r_{\\mathrm{MIC}}$, and determine the interaction indicator $I$ defined by $I = 1$ if $r_{\\mathrm{MIC}} \\le r_{c}$ and $I = 0$ otherwise. Round all components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$ and $r_{\\mathrm{MIC}}$ to five significant figures. Express the displacement components and the distance in nanometers. Provide your final answer as a single row matrix containing, in order, the three components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$, the scalar distance $r_{\\mathrm{MIC}}$, and the indicator $I$.",
            "solution": "The problem requires the calculation of the minimum image displacement vector, its magnitude, and an interaction indicator for two particles in a three-dimensional orthorhombic simulation cell with periodic boundary conditions (PBC).\n\nFirst, the given parameters are extracted from the problem statement:\nThe simulation cell edge lengths are $L_{x} = 3.6\\,\\mathrm{nm}$, $L_{y} = 4.2\\,\\mathrm{nm}$, and $L_{z} = 5.0\\,\\mathrm{nm}$.\nThe positions of the two particles are $\\mathbf{r}_{1} = (0.5,\\, 3.9,\\, 4.8)\\,\\mathrm{nm}$ and $\\mathbf{r}_{2} = (3.4,\\, 0.6,\\, 0.4)\\,\\mathrm{nm}$.\nThe interaction cutoff radius is $r_{c} = 1.30\\,\\mathrm{nm}$.\nThe interaction indicator is $I=1$ if the minimum image distance $r_{\\mathrm{MIC}} \\le r_{c}$ and $I=0$ otherwise.\n\nThe displacement vector from particle $1$ to particle $2$ in the primary cell is calculated as $\\Delta \\mathbf{r} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$.\nLet the components of $\\mathbf{r}_{1}$ be $(x_1, y_1, z_1)$ and the components of $\\mathbf{r}_{2}$ be $(x_2, y_2, z_2)$.\nThe components of the displacement vector $\\Delta \\mathbf{r} = (\\Delta x, \\Delta y, \\Delta z)$ are:\n$$\n\\Delta x = x_{2} - x_{1} = 3.4\\,\\mathrm{nm} - 0.5\\,\\mathrm{nm} = 2.9\\,\\mathrm{nm}\n$$\n$$\n\\Delta y = y_{2} - y_{1} = 0.6\\,\\mathrm{nm} - 3.9\\,\\mathrm{nm} = -3.3\\,\\mathrm{nm}\n$$\n$$\n\\Delta z = z_{2} - z_{1} = 0.4\\,\\mathrm{nm} - 4.8\\,\\mathrm{nm} = -4.4\\,\\mathrm{nm}\n$$\nSo, the initial displacement vector is $\\Delta \\mathbf{r} = (2.9,\\, -3.3,\\, -4.4)\\,\\mathrm{nm}$.\n\nDue to PBC, particle $2$ has an infinite number of periodic images at positions $\\mathbf{r}_{2, \\mathbf{n}} = \\mathbf{r}_{2} + n_{x} L_{x} \\hat{\\mathbf{x}} + n_{y} L_{y} \\hat{\\mathbf{y}} + n_{z} L_{z} \\hat{\\mathbf{z}}$, where $n_x, n_y, n_z$ are any integers. The displacement vector from particle $1$ to any of these images is $\\Delta \\mathbf{r}_{\\mathbf{n}} = \\mathbf{r}_{2, \\mathbf{n}} - \\mathbf{r}_{1} = \\Delta \\mathbf{r} + (n_x L_x, n_y L_y, n_z L_z)$. The Minimum Image Convention (MIC) mandates that we find the vector $\\Delta \\mathbf{r}_{\\mathbf{n}}$ that has the minimum Euclidean norm. The squared norm is $\\|\\Delta \\mathbf{r}_{\\mathbf{n}}\\|^2 = (\\Delta x + n_x L_x)^2 + (\\Delta y + n_y L_y)^2 + (\\Delta z + n_z L_z)^2$. Since the terms are independent, we can minimize each component's contribution separately.\n\nFor each component $\\alpha \\in \\{x, y, z\\}$, the minimum image displacement component $\\Delta \\alpha_{\\mathrm{MIC}}$ must satisfy the condition $|\\Delta \\alpha_{\\mathrm{MIC}}| \\le \\frac{L_{\\alpha}}{2}$. This is achieved by adding or subtracting the cell length $L_{\\alpha}$ as many times as needed to bring the component into the range $[-\\frac{L_{\\alpha}}{2}, \\frac{L_{\\alpha}}{2}]$. A common implementation of this for a component $\\Delta \\alpha$ is:\n- If $\\Delta \\alpha  \\frac{L_{\\alpha}}{2}$, then $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha - L_{\\alpha}$.\n- If $\\Delta \\alpha  -\\frac{L_{\\alpha}}{2}$, then $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha + L_{\\alpha}$.\n- Otherwise, $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha$.\n\nLet's apply this to each component of $\\Delta \\mathbf{r}$.\n\nFor the $x$-component:\nThe half-box length is $\\frac{L_{x}}{2} = \\frac{3.6}{2} = 1.8\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta x = 2.9\\,\\mathrm{nm}$.\nSince $\\Delta x = 2.9\\,\\mathrm{nm}  1.8\\,\\mathrm{nm}$, we subtract $L_x$.\n$$\n\\Delta x_{\\mathrm{MIC}} = \\Delta x - L_{x} = 2.9 - 3.6 = -0.7\\,\\mathrm{nm}\n$$\n\nFor the $y$-component:\nThe half-box length is $\\frac{L_{y}}{2} = \\frac{4.2}{2} = 2.1\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta y = -3.3\\,\\mathrm{nm}$.\nSince $\\Delta y = -3.3\\,\\mathrm{nm}  -2.1\\,\\mathrm{nm}$, we add $L_y$.\n$$\n\\Delta y_{\\mathrm{MIC}} = \\Delta y + L_{y} = -3.3 + 4.2 = 0.9\\,\\mathrm{nm}\n$$\n\nFor the $z$-component:\nThe half-box length is $\\frac{L_{z}}{2} = \\frac{5.0}{2} = 2.5\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta z = -4.4\\,\\mathrm{nm}$.\nSince $\\Delta z = -4.4\\,\\mathrm{nm}  -2.5\\,\\mathrm{nm}$, we add $L_z$.\n$$\n\\Delta z_{\\mathrm{MIC}} = \\Delta z + L_{z} = -4.4 + 5.0 = 0.6\\,\\mathrm{nm}\n$$\n\nThus, the minimum image displacement vector is $\\Delta \\mathbf{r}_{\\mathrm{MIC}} = (-0.7,\\, 0.9,\\, 0.6)\\,\\mathrm{nm}$. Rounding these components to five significant figures gives $\\Delta x_{\\mathrm{MIC}} = -0.70000\\,\\mathrm{nm}$, $\\Delta y_{\\mathrm{MIC}} = 0.90000\\,\\mathrm{nm}$, and $\\Delta z_{\\mathrm{MIC}} = 0.60000\\,\\mathrm{nm}$.\n\nNext, we calculate the magnitude of this vector, which is the minimum image distance $r_{\\mathrm{MIC}}$.\n$$\nr_{\\mathrm{MIC}} = \\|\\Delta \\mathbf{r}_{\\mathrm{MIC}}\\| = \\sqrt{(\\Delta x_{\\mathrm{MIC}})^2 + (\\Delta y_{\\mathrm{MIC}})^2 + (\\Delta z_{\\mathrm{MIC}})^2}\n$$\n$$\nr_{\\mathrm{MIC}} = \\sqrt{(-0.7)^2 + (0.9)^2 + (0.6)^2} = \\sqrt{0.49 + 0.81 + 0.36} = \\sqrt{1.66}\\,\\mathrm{nm}\n$$\nNumerically, $r_{\\mathrm{MIC}} \\approx 1.28840987... \\,\\mathrm{nm}$.\nRounding to five significant figures, we get $r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$.\n\nFinally, we determine the interaction indicator $I$ by comparing $r_{\\mathrm{MIC}}$ with the cutoff radius $r_{c} = 1.30\\,\\mathrm{nm}$.\nThe condition for interaction is $r_{\\mathrm{MIC}} \\le r_{c}$.\nWe have $r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$ and $r_{c} = 1.30\\,\\mathrm{nm}$. Since $1.2884 \\le 1.30$, the condition is satisfied.\nTherefore, the interaction indicator is $I = 1$.\n\nThe required results are the components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$, its magnitude $r_{\\mathrm{MIC}}$, and the indicator $I$.\n$\\Delta x_{\\mathrm{MIC}} = -0.70000\\,\\mathrm{nm}$\n$\\Delta y_{\\mathrm{MIC}} = 0.90000\\,\\mathrm{nm}$\n$\\Delta z_{\\mathrm{MIC}} = 0.60000\\,\\mathrm{nm}$\n$r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$\n$I = 1$\nThese are to be presented in a single row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.70000  0.90000  0.60000  1.2884  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The simplicity of the orthogonal case can be misleading, as the component-wise approach fails in the general case of a triclinic (or skewed) simulation cell. This practice  presents a carefully constructed counterexample to demonstrate this critical pitfall. By working through it, you will see why the correct, general method requires transforming vectors into the lattice's fractional coordinate system before applying the nearest-image logic, and you will quantify the error introduced by the naive approach.",
            "id": "2793940",
            "problem": "Consider a three-dimensional periodic simulation cell defined by a triclinic Bravais lattice with cell matrix $\\mathbf{H}$ whose columns are the lattice vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$ in Cartesian coordinates. Let\n$$\n\\mathbf{a}=\\begin{pmatrix}10 \\\\ 0 \\\\ 0\\end{pmatrix},\\quad\n\\mathbf{b}=\\begin{pmatrix}9.8 \\\\ 1.0 \\\\ 0\\end{pmatrix},\\quad\n\\mathbf{c}=\\begin{pmatrix}9.8 \\\\ 0.2 \\\\ 1.0\\end{pmatrix}\\ \\text{(all components in \\AA)}.\n$$\nTwo particles have fractional (also called reduced) coordinates $\\mathbf{s}_{1}=\\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$ and $\\mathbf{s}_{2}=\\begin{pmatrix}0.02 \\\\ 0.6 \\\\ 0\\end{pmatrix}$ with respect to $\\mathbf{H}$, so their Cartesian positions are $\\mathbf{r}_{i}=\\mathbf{H}\\,\\mathbf{s}_{i}$. Under periodic boundary conditions, the minimum image of a separation vector $\\mathbf{r}=\\mathbf{r}_{2}-\\mathbf{r}_{1}$ is defined from first principles as\n$$\n\\mathbf{r}_{\\mathrm{mic}}=\\operatorname*{arg\\,min}_{\\mathbf{n}\\in\\mathbb{Z}^{3}}\\left\\|\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}\\right\\|_{2},\n$$\nthat is, the unique member of the set $\\{\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}:\\mathbf{n}\\in\\mathbb{Z}^{3}\\}$ with minimal Euclidean length.\n\nA commonly used but incorrect heuristic in skewed cells is to “wrap” in Cartesian coordinates by component-wise rounding using the diagonal lengths $L_{x},L_{y},L_{z}$ obtained from the upper-triangular form of $\\mathbf{H}$, namely $L_{x}=a_{x}$, $L_{y}=b_{y}$, $L_{z}=c_{z}$. In this cell, $L_{x}=10$, $L_{y}=1$, and $L_{z}=1$ (in \\AA). This naive Cartesian wrapping maps a Cartesian vector $\\mathbf{r}=(r_{x},r_{y},r_{z})^{\\top}$ to\n$$\n\\mathbf{r}_{\\mathrm{naive}}=\\begin{pmatrix}\nr_{x}-L_{x}\\,\\mathrm{nint}\\!\\left(\\frac{r_{x}}{L_{x}}\\right)\\\\[4pt]\nr_{y}-L_{y}\\,\\mathrm{nint}\\!\\left(\\frac{r_{y}}{L_{y}}\\right)\\\\[4pt]\nr_{z}-L_{z}\\,\\mathrm{nint}\\!\\left(\\frac{r_{z}}{L_{z}}\\right)\n\\end{pmatrix},\n$$\nwhere $\\mathrm{nint}(\\cdot)$ denotes rounding to the nearest integer.\n\nStarting only from the definitions above, do the following:\n\n1) Derive the correct triclinic minimum-image mapping by expressing $\\mathbf{r}$ in fractional coordinates $\\mathbf{s}=\\mathbf{H}^{-1}\\mathbf{r}$, reducing $\\mathbf{s}$ to the central cell by component-wise nearest-integer subtraction to obtain $\\mathbf{s}'=\\mathbf{s}-\\mathrm{nint}(\\mathbf{s})$, and mapping back to Cartesian via $\\mathbf{r}_{\\mathrm{mic}}=\\mathbf{H}\\,\\mathbf{s}'$.\n\n2) Compute the explicit Cartesian vectors $\\mathbf{r}$, $\\mathbf{r}_{\\mathrm{mic}}$, and their Euclidean lengths for the given $\\mathbf{H}$ and $\\mathbf{s}_{1},\\mathbf{s}_{2}$.\n\n3) Compute the naive Cartesian-wrapped vector $\\mathbf{r}_{\\mathrm{naive}}$ and its Euclidean length using the prescription above with $L_{x}=10$, $L_{y}=1$, $L_{z}=1$.\n\n4) Explain why $\\mathbf{r}_{\\mathrm{naive}}$ is not guaranteed to equal $\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}$ for any $\\mathbf{n}\\in\\mathbb{Z}^{3}$ when $\\mathbf{H}$ is skewed, and verify explicitly for this example that the true minimizer over $\\mathbf{n}\\in\\mathbb{Z}^{3}$ is attained by the choice prescribed in step $1)$.\n\n5) Define the distance error $\\delta=\\|\\mathbf{r}_{\\mathrm{naive}}\\|_{2}-\\|\\mathbf{r}_{\\mathrm{mic}}\\|_{2}$. Compute $\\delta$ for this case.\n\nExpress your final answer for $\\delta$ in \\AA\\ and round your answer to four significant figures.",
            "solution": "The posed problem is scientifically grounded, well-posed, and objective. It addresses a fundamental and non-trivial aspect of computational methods in theoretical chemistry and condensed matter physics, namely the correct implementation of the minimum image convention for general triclinic simulation cells. All data and definitions required for a unique solution are provided, and there are no internal contradictions or logical flaws. The problem is therefore valid, and I shall proceed with its solution.\n\nThe solution is structured into the five parts requested by the problem statement.\n\n1) Derivation of the correct triclinic minimum-image mapping.\nThe minimum image convention seeks to find the shortest vector connecting two particles, considering all their periodic images. The separation vector between particle $2$ and particle $1$ is $\\mathbf{r} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$. The set of all periodic images of this separation vector is given by $\\{\\mathbf{r} - \\mathbf{H}\\mathbf{n} : \\mathbf{n} \\in \\mathbb{Z}^3\\}$, where $\\mathbf{H}$ is the cell matrix and $\\mathbf{n}$ is a vector of three integers. The minimum image vector, $\\mathbf{r}_{\\mathrm{mic}}$, is the unique vector in this set with the minimum Euclidean norm.\n\nThe correct procedure avoids direct operations in Cartesian coordinates, which are not adapted to the lattice periodicity unless the cell is orthorhombic. Instead, one must work in the space of fractional coordinates, where the periodicity is simple.\n\nLet $\\mathbf{s} = \\mathbf{H}^{-1}\\mathbf{r}$ be the separation vector expressed in fractional coordinates. The components of $\\mathbf{s}$, denoted $s_i$, represent the displacement along the lattice vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$.\nIn this fractional space, the periodic images of the origin are located at all integer coordinates $\\mathbf{n} \\in \\mathbb{Z}^3$. To find the image of $\\mathbf{s}$ closest to the origin, we simply find the nearest integer for each component of $\\mathbf{s}$. This operation is denoted by the nearest integer function, $\\mathrm{nint}(\\cdot)$.\nLet $\\mathbf{n}_{\\mathrm{mic}} = \\mathrm{nint}(\\mathbf{s})$, where the function is applied component-wise. This integer vector $\\mathbf{n}_{\\mathrm{mic}}$ defines the translation required to bring $\\mathbf{s}$ into the central simulation cell, which is typically configured as the Wigner-Seitz cell of the fractional lattice, $[-0.5, 0.5)^3$.\nThe reduced fractional vector is $\\mathbf{s}' = \\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}}$. By construction, each component $s'_i$ of $\\mathbf{s}'$ lies in the interval $[-0.5, 0.5)$.\n\nFinally, this reduced fractional vector $\\mathbf{s}'$ is mapped back to Cartesian coordinates to obtain the minimum image vector:\n$$\n\\mathbf{r}_{\\mathrm{mic}} = \\mathbf{H}\\mathbf{s}' = \\mathbf{H}(\\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}}) = \\mathbf{H}(\\mathbf{H}^{-1}\\mathbf{r} - \\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r})) = \\mathbf{r} - \\mathbf{H}\\,\\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r}).\n$$\nThis is the correct general mapping for a triclinic cell. The integer vector that minimizes the distance is $\\mathbf{n} = \\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r})$.\n\n2) Computation of $\\mathbf{r}$, $\\mathbf{r}_{\\mathrm{mic}}$, and their lengths.\nThe givens are the cell matrix $\\mathbf{H}$ composed of column vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$:\n$$\n\\mathbf{H} = \\begin{pmatrix} 10  9.8  9.8 \\\\ 0  1.0  0.2 \\\\ 0  0  1.0 \\end{pmatrix}\n$$\nand the fractional coordinates $\\mathbf{s}_{1} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$ and $\\mathbf{s}_{2} = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$.\n\nThe initial separation vector in Cartesian coordinates is $\\mathbf{r} = \\mathbf{r}_2 - \\mathbf{r}_1$. Since $\\mathbf{s}_1$ is the origin, $\\mathbf{r}_1 = \\mathbf{H}\\mathbf{s}_1 = \\mathbf{0}$, and thus $\\mathbf{r} = \\mathbf{r}_2$.\n$$\n\\mathbf{r} = \\mathbf{H}\\mathbf{s}_2 = \\begin{pmatrix} 10  9.8  9.8 \\\\ 0  1.0  0.2 \\\\ 0  0  1.0 \\end{pmatrix} \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix} = 0.02\\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} + 0.6\\begin{pmatrix} 9.8 \\\\ 1.0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 5.88 \\\\ 0.6 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 6.08 \\\\ 0.6 \\\\ 0 \\end{pmatrix}.\n$$\nThe squared Euclidean length of $\\mathbf{r}$ is $\\|\\mathbf{r}\\|_2^2 = 6.08^2 + 0.6^2 + 0^2 = 36.9664 + 0.36 = 37.3264$.\nThe length is $\\|\\mathbf{r}\\|_2 = \\sqrt{37.3264} \\approx 6.1095\\ \\text{\\AA}$.\n\nTo compute $\\mathbf{r}_{\\mathrm{mic}}$, we follow the procedure from part 1. The fractional separation vector is $\\mathbf{s} = \\mathbf{s}_2 - \\mathbf{s}_1 = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$.\nWe find the nearest integer vector: $\\mathbf{n}_{\\mathrm{mic}} = \\mathrm{nint}(\\mathbf{s}) = \\begin{pmatrix} \\mathrm{nint}(0.02) \\\\ \\mathrm{nint}(0.6) \\\\ \\mathrm{nint}(0) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\nThe reduced fractional vector is $\\mathbf{s}' = \\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$.\nFinally, we map $\\mathbf{s}'$ back to Cartesian coordinates:\n$$\n\\mathbf{r}_{\\mathrm{mic}} = \\mathbf{H}\\mathbfs' = \\begin{pmatrix} 10  9.8  9.8 \\\\ 0  1.0  0.2 \\\\ 0  0  1.0 \\end{pmatrix} \\begin{pmatrix} 0.02 \\\\ -0.4 \\\\ 0 \\end{pmatrix} = 0.02\\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} - 0.4\\begin{pmatrix} 9.8 \\\\ 1.0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.2 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3.92 \\\\ 0.4 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -3.72 \\\\ -0.4 \\\\ 0 \\end{pmatrix}.\n$$\nThe squared Euclidean length is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2^2 = (-3.72)^2 + (-0.4)^2 + 0^2 = 13.8384 + 0.16 = 13.9984$.\nThe length is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2 = \\sqrt{13.9984} \\approx 3.7414\\ \\text{\\AA}$.\n\n3) Computation of the naive Cartesian-wrapped vector $\\mathbf{r}_{\\mathrm{naive}}$ and its length.\nThe naive method uses the diagonal elements of the upper-triangular cell matrix, $L_x=10$, $L_y=1$, $L_z=1$. It wraps the Cartesian vector $\\mathbf{r} = \\begin{pmatrix} 6.08 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$ component-wise.\n$$\nr_{\\mathrm{naive}, x} = r_x - L_x\\,\\mathrm{nint}\\!\\left(\\frac{r_x}{L_x}\\right) = 6.08 - 10\\,\\mathrm{nint}\\!\\left(\\frac{6.08}{10}\\right) = 6.08 - 10\\,\\mathrm{nint}(0.608) = 6.08 - 10(1) = -3.92.\n$$\n$$\nr_{\\mathrm{naive}, y} = r_y - L_y\\,\\mathrm{nint}\\!\\left(\\frac{r_y}{L_y}\\right) = 0.6 - 1\\,\\mathrm{nint}\\!\\left(\\frac{0.6}{1}\\right) = 0.6 - 1\\,\\mathrm{nint}(0.6) = 0.6 - 1(1) = -0.4.\n$$\n$$\nr_{\\mathrm{naive}, z} = r_z - L_z\\,\\mathrm{nint}\\!\\left(\\frac{r_z}{L_z}\\right) = 0 - 1\\,\\mathrm{nint}\\!\\left(\\frac{0}{1}\\right) = 0 - 1(0) = 0.\n$$\nThus, $\\mathbf{r}_{\\mathrm{naive}} = \\begin{pmatrix} -3.92 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$.\nThe squared Euclidean length is $\\|\\mathbf{r}_{\\mathrm{naive}}\\|_2^2 = (-3.92)^2 + (-0.4)^2 + 0^2 = 15.3664 + 0.16 = 15.5264$.\nThe length is $\\|\\mathbf{r}_{\\mathrm{naive}}\\|_2 = \\sqrt{15.5264} \\approx 3.9404\\ \\text{\\AA}$.\n\n4) Explanation of the flaw in the naive method and verification.\nThe fundamental flaw in the naive Cartesian wrapping is that the vector subtracted from $\\mathbf{r}$ is not, in general, a lattice vector of the form $\\mathbf{H}\\mathbf{n}$ for $\\mathbf{n} \\in \\mathbb{Z}^3$. A vector $\\mathbf{v}$ is a valid periodic image of $\\mathbf{r}$ only if $\\mathbf{v} = \\mathbf{r} - \\mathbf{H}\\mathbf{n}$ for some integer vector $\\mathbf{n}$.\nIn the naive method, the subtracted vector is $\\mathbf{v}_{\\mathrm{sub}} = \\begin{pmatrix} L_x\\,\\mathrm{nint}(r_x/L_x) \\\\ L_y\\,\\mathrm{nint}(r_y/L_y) \\\\ L_z\\,\\mathrm{nint}(r_z/L_z) \\end{pmatrix}$. For this example, this is $\\mathbf{v}_{\\mathrm{sub}} = \\begin{pmatrix} 10(1) \\\\ 1(1) \\\\ 1(0) \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\nFor $\\mathbf{v}_{\\mathrm{sub}}$ to be a valid lattice vector, there must exist an integer vector $\\mathbf{n}$ such that $\\mathbf{H}\\mathbf{n} = \\mathbf{v}_{\\mathrm{sub}}$. Solving for $\\mathbf{n}$ gives $\\mathbf{n} = \\mathbf{H}^{-1}\\mathbf{v}_{\\mathrm{sub}}$. The matrix $\\mathbf{H}$ is upper triangular, so its inverse is also upper triangular:\n$$\n\\mathbf{H}^{-1} = \\begin{pmatrix} 1/10  -9.8/10  (9.8 \\cdot 0.2 - 9.8 \\cdot 1)/10 \\\\ 0  1  -0.2/1 \\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} 0.1  -0.98  -0.784 \\\\ 0  1  -0.2 \\\\ 0  0  1 \\end{pmatrix}.\n$$\nLet us compute $\\mathbf{n}$:\n$$\n\\mathbf{n} = \\begin{pmatrix} 0.1  -0.98  -0.784 \\\\ 0  1  -0.2 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.1(10) - 0.98(1) \\\\ 1(1) \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 - 0.98 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ 1 \\\\ 0 \\end{pmatrix}.\n$$\nSince this $\\mathbf{n}$ is not an integer vector, the vector $\\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix}$ is not a lattice vector, and therefore $\\mathbf{r}_{\\mathrm{naive}}$ is not a valid periodic image of $\\mathbf{r}$. This Cartesian wrapping procedure produces a vector outside the set $\\{\\mathbf{r} - \\mathbf{H}\\mathbf{n}\\}$.\n\nTo verify that the method from part 1 yields the true minimizer, we examine the integer vector $\\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$. The corresponding squared distance is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2^2 = 13.9984$. We must check if other integer vectors $\\mathbf{n}$ yield a smaller distance.\n\\begin{itemize}\n    \\item For $\\mathbf{n} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$: $\\|\\mathbf{r} - \\mathbf{H}\\mathbf{n}\\|^2 = \\|\\mathbf{r}\\|^2 = 37.3264$.\n    \\item For $\\mathbf{n} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$: $\\mathbf{H}\\mathbf{n} = \\mathbf{a} = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix}$. The image is $\\mathbf{r} - \\mathbf{a} = \\begin{pmatrix} -3.92 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$. Squared length is $(-3.92)^2 + 0.6^2 = 15.3664 + 0.36 = 15.7264$.\n    \\item For $\\mathbf{n} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$: $\\mathbf{H}\\mathbf{n} = \\mathbf{b}-\\mathbf{a} = \\begin{pmatrix} -0.2 \\\\ 1.0 \\\\ 0 \\end{pmatrix}$. Image is $\\mathbf{r} - (\\mathbf{b}-\\mathbf{a}) = \\begin{pmatrix} 6.28 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$. Squared length is $6.28^2 + (-0.4)^2 = 39.4384 + 0.16 = 39.5984$.\n\\end{itemize}\nAll neighboring integer vectors $\\mathbf{n}$ result in a larger squared distance than for $\\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$. This confirms that the procedure of reducing fractional coordinates yields the correct minimum image for this case.\n\n5) Computation of the distance error $\\delta$.\nThe error in the calculated distance is defined as $\\delta = \\|\\mathbf{r}_{\\mathrm{naive}}\\|_2 - \\|\\mathbf{r}_{\\mathrm{mic}}\\|_2$.\nUsing the values computed previously:\n$$\n\\delta = \\sqrt{15.5264} - \\sqrt{13.9984}\n$$\n$$\n\\delta \\approx 3.9403553 - 3.7414436 = 0.1989117\n$$\nRounding to four significant figures, the distance error is $\\delta \\approx 0.1989\\ \\text{\\AA}$. This error demonstrates that the naive Cartesian wrapping not only produces a physically incorrect image vector but also overestimates the minimum distance between the particles.",
            "answer": "$$\n\\boxed{0.1989}\n$$"
        },
        {
            "introduction": "Having established the necessity of the fractional coordinate method, we now turn to its practical implementation. This final exercise  challenges you to design a computationally efficient and robust algorithm for arbitrary triclinic cells, avoiding conditional branches to enable potential vectorization. Furthermore, it prompts an analysis of numerical stability, a crucial consideration when dealing with the ill-conditioned matrices that can arise from highly skewed simulation cells.",
            "id": "3830821",
            "problem": "Design an algorithm that, given a three-dimensional primitive cell described by a nonsingular matrix $H \\in \\mathbb{R}^{3 \\times 3}$ (whose columns are the Cartesian lattice vectors) and a Cartesian displacement vector $r \\in \\mathbb{R}^3$, computes the minimum image vector $v_{\\min} \\in \\mathbb{R}^3$ under Periodic Boundary Conditions (PBC) for arbitrary triclinic cells. The minimum image vector is defined as the element in the equivalence class $r + H \\mathbb{Z}^3$ that minimizes the Euclidean norm. Your algorithm must use only linear operations involving $H$ and $H^{-1}$, avoid any branching (no conditional statements per component), and transform the displacement via fractional coordinates. The final program must also compute the Euclidean length of the minimum image vector. In addition to implementing the algorithm, analyze its computational complexity and numerical stability purely from first principles and well-tested facts.\n\nFormulate the algorithm strictly in mathematical terms based on the following foundational elements:\n- The lattice generated by $H$ is $\\Lambda = \\{H m \\mid m \\in \\mathbb{Z}^3\\}$.\n- The equivalence relation induced by periodicity is $r \\sim r + H m$ for $m \\in \\mathbb{Z}^3$.\n- The minimum image convention seeks $v_{\\min} = \\operatorname*{arg\\,min}_{m \\in \\mathbb{Z}^3} \\|r - H m\\|_2$.\n- Linear maps and their inverses (for nonsingular matrices) transform vectors between coordinate systems: fractional coordinates $s$ satisfy $r = H s$ with $s = H^{-1} r$.\n\nYour program must:\n1. Implement a branchless transformation in fractional space that selects the representative in the central cell with components in the half-open interval $[-\\tfrac{1}{2}, \\tfrac{1}{2})$ using only vectorized arithmetic operations and elementary functions (no per-component conditionals). Then map back to Cartesian space.\n2. For each test case, return the minimum image vector components $v_{\\min}$ and its Euclidean norm $\\|v_{\\min}\\|_2$.\n3. Round all output floating-point numbers to eight decimal places.\n4. Produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list of four floats $[v_x, v_y, v_z, \\|v\\|_2]$.\n\nTest Suite:\nUse the following $H$ matrices and displacement specifications. In cases where fractional coordinates $s$ are specified, the displacement is defined by $r = H s$.\n\n- Test Case 1 (Orthorhombic happy path):\n  - $H_1 = \\begin{bmatrix} 10.0  0.0  0.0 \\\\ 0.0  10.0  0.0 \\\\ 0.0  0.0  10.0 \\end{bmatrix}$.\n  - $r_1 = \\begin{bmatrix} 9.9 \\\\ -9.9 \\\\ 0.1 \\end{bmatrix}$.\n\n- Test Case 2 (Moderately skew triclinic):\n  - $H_2 = \\begin{bmatrix} 8.0  2.5  1.2 \\\\ 0.0  7.0  0.8 \\\\ 0.0  0.0  6.0 \\end{bmatrix}$.\n  - $s_2 = \\begin{bmatrix} 1.2 \\\\ -1.6 \\\\ 0.49 \\end{bmatrix}$, so $r_2 = H_2 s_2$.\n\n- Test Case 3 (Boundary half-integer tie handling in the same triclinic cell as Test Case 2):\n  - $H_2$ as above.\n  - $s_3 = \\begin{bmatrix} 0.5 \\\\ -0.5 \\\\ 0.5 \\end{bmatrix}$, so $r_3 = H_2 s_3$.\n\n- Test Case 4 (Nearly degenerate tilt, high condition number but nonsingular):\n  - $H_4 = \\begin{bmatrix} 10.0  9.999  0.0 \\\\ 0.0  0.01  0.0 \\\\ 0.0  0.0  10.0 \\end{bmatrix}$.\n  - $s_4 = \\begin{bmatrix} 3.7 \\\\ -4.4 \\\\ 0.33 \\end{bmatrix}$, so $r_4 = H_4 s_4$.\n\nAnswer Specification:\n- For each test case, compute $v_{\\min}$ and $\\|v_{\\min}\\|_2$ and output the four-tuple $[v_x, v_y, v_z, \\|v\\|_2]$ as floats rounded to eight decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example:\n  $$[ [v_{x1}, v_{y1}, v_{z1}, \\|v_1\\|_2], [v_{x2}, v_{y2}, v_{z2}, \\|v_2\\|_2], [v_{x3}, v_{y3}, v_{z3}, \\|v_3\\|_2], [v_{x4}, v_{y4}, v_{z4}, \\|v_4\\|_2] ].$$",
            "solution": "The problem requires the design and implementation of a branchless algorithm to compute the minimum image vector for a given displacement vector $r \\in \\mathbb{R}^3$ within a periodic cell defined by a nonsingular matrix $H \\in \\mathbb{R}^{3 \\times 3}$. The solution must also include an analysis of the algorithm's computational complexity and numerical stability.\n\n**Algorithm Formulation**\n\nThe set of all periodic images of a vector $r$ is given by the equivalence class $\\Lambda_r = \\{r + H m \\mid m \\in \\mathbb{Z}^3\\}$, where $H$ is the matrix whose columns are the lattice vectors and $\\mathbb{Z}^3$ is the set of all $3$-dimensional integer vectors. The minimum image vector, $v_{\\min}$, is the vector in this class with the smallest Euclidean norm:\n$$ v_{\\min} = \\operatorname*{arg\\,min}_{v \\in \\Lambda_r} \\|v\\|_2 = \\operatorname*{arg\\,min}_{m \\in \\mathbb{Z}^3} \\|r - H m\\|_2 $$\nDirectly solving this minimization problem, known as the Closest Vector Problem (CVP), is computationally expensive (NP-hard in general dimensions). However, a standard and efficient heuristic used in materials simulations is to perform the search in fractional coordinates.\n\nA Cartesian vector $x \\in \\mathbb{R}^3$ can be expressed in fractional coordinates $s \\in \\mathbb{R}^3$ with respect to the lattice basis $H$ via the linear transformation $x = H s$. Consequently, the fractional coordinates are found by the inverse transformation, $s = H^{-1} x$.\n\nLet the given displacement vector $r$ have fractional coordinates $s = H^{-1} r$. The vector to be minimized is $\\|r - H m\\|_2 = \\|H s - H m\\|_2 = \\|H(s - m)\\|_2$. The heuristic assumes that minimizing $\\|H(s - m)\\|_2$ is achieved by finding an integer vector $m$ that makes the components of the new fractional vector $s' = s - m$ as close to zero as possible. This is accomplished by mapping each component of $s$ into a central periodic cell. The problem specifies this central cell to be defined by components in the half-open interval $[-\\frac{1}{2}, \\frac{1}{2})$.\n\nLet $s = (s_1, s_2, s_3)^T$. We seek an integer vector $m = (m_1, m_2, m_3)^T$ such that each component of the wrapped fractional vector $s_{\\min} = s - m$ falls into the target interval. The integer $m_i$ for each component $s_i$ is the integer that shifts $s_i$ into this range. This integer is the one closest to $s_i$, with a tie-breaking rule for half-integer values. A branchless, vectorized operation to achieve this mapping to $[-\\frac{1}{2}, \\frac{1}{2})$ is:\n$$ s_{\\min} = s - \\text{nint}(s) $$\nwhere $\\text{nint}(s)$ is a component-wise nearest-integer function. The problem's requirement for the interval $[-\\frac{1}{2}, \\frac{1}{2})$ implies a specific tie-breaking rule: values like $k.5$ for $k \\in \\mathbb{Z}$ should be mapped to the lower boundary, $-0.5$. This can be robustly implemented using the floor function, $\\lfloor \\cdot \\rfloor$. For a single component $s_i$, the corresponding component of the wrapped vector, $s_{\\min, i}$, is given by:\n$$ s_{\\min, i} = s_i - \\lfloor s_i + \\tfrac{1}{2} \\rfloor $$\nThis operation correctly maps any $s_i \\in \\mathbb{R}$ to the interval $[-\\frac{1}{2}, \\frac{1}{2})$. For example, if $s_i = 2.5$, $s_{\\min, i} = 2.5 - \\lfloor 3.0 \\rfloor = 2.5 - 3 = -0.5$. If $s_i = -2.5$, $s_{\\min, i} = -2.5 - \\lfloor -2.0 \\rfloor = -2.5 - (-2) = -0.5$.\n\nThe complete algorithm is as follows:\n1. Given $H$ and $r$, compute the inverse matrix $H^{-1}$.\n2. Transform the Cartesian vector $r$ to fractional coordinates: $s = H^{-1} r$.\n3. Apply the wrapping function component-wise to obtain the fractional representation in the central cell: $s_{\\min} = s - \\lfloor s + \\tfrac{1}{2} \\rfloor$. The vector addition and floor function are applied element-wise.\n4. Transform the wrapped fractional vector back to Cartesian coordinates to obtain the minimum image vector: $v_{\\min} = H s_{\\min}$.\n5. Compute the Euclidean norm of the result: $\\|v_{\\min}\\|_2 = \\sqrt{v_{\\min} \\cdot v_{\\min}}$.\n\n**Analysis of Computational Complexity and Numerical Stability**\n\n**Computational Complexity**:\nThe algorithm operates on fixed-size $3 \\times 3$ matrices and $3 \\times 1$ vectors. The complexity is therefore constant, $O(1)$, with respect to the number of particles in a larger system. The number of floating-point operations (FLOPs) for a single application is:\n- **Matrix Inversion ($H^{-1}$)**: For a $3 \\times 3$ matrix, this involves a fixed number of operations. Using the adjugate matrix method, it requires approximately $50-60$ FLOPs.\n- **Matrix-Vector Product ($H^{-1} r$)**: Requires $3 \\times 3 = 9$ multiplications and $3 \\times 2 = 6$ additions, for a total of $15$ FLOPs.\n- **Wrapping ($s - \\lfloor s + \\tfrac{1}{2} \\rfloor$)**: Requires $3$ additions, $3$ floor operations, and $3$ subtractions.\n- **Matrix-Vector Product ($H s_{\\min}$)**: Requires another $15$ FLOPs.\n- **Norm Calculation ($\\|v_{\\min}\\|_2$)**: Requires $3$ multiplications, $2$ additions, and $1$ square root operation.\nThe total number of operations is constant for each vector processed.\n\n**Numerical Stability**:\nThe stability of the algorithm is primarily dictated by the conditioning of the matrix $H$. The condition number, $\\kappa(H) = \\|H\\| \\|H^{-1}\\|$, quantifies the sensitivity of the solution of a linear system to perturbations in the input data.\n1.  **Transformation to Fractional Coordinates**: The calculation $s = H^{-1} r$ is the most sensitive step. A large condition number, $\\kappa(H) \\gg 1$, indicates that $H$ is \"ill-conditioned\" or nearly singular. This occurs when the lattice vectors are nearly linearly dependent, defining a very skewed or \"squashed\" cell. In this case, small errors in $r$ (due to floating-point representation or measurement) can be amplified by $\\kappa(H)$, leading to large errors in the computed fractional coordinates $s$.\n2.  **Wrapping Step**: The wrapping operation $s_i - \\lfloor s_i + \\tfrac{1}{2} \\rfloor$ is itself numerically stable. However, it exhibits discontinuous behavior. If a numerical error in computing $s_i$ causes its value to cross a half-integer boundary (e.g., the true value is $2.499...$ but is computed as $2.500...$), the floor operation will produce a different integer. This leads to a jump of $1.0$ in the resulting $s_{\\min, i}$, causing the algorithm to select an entirely different periodic image. For an ill-conditioned system, this type of error becomes more probable.\n3.  **Transformation back to Cartesian Coordinates**: The final step, $v_{\\min} = H s_{\\min}$, can also amplify errors. If $s_{\\min}$ is inaccurate, the error in $v_{\\min}$ is scaled by $\\|H\\|$.\n\nTest Case 4, with its nearly collinear first and second lattice vectors, provides an example of an ill-conditioned matrix $H_4$. For this matrix, $\\det(H_4) = 1$, but its inverse contains large elements, leading to a high condition number ($\\kappa(H_4) \\approx 4000$). Calculations involving this matrix will be highly susceptible to floating-point precision errors, testing the robustness of the implementation. The algorithm remains formally correct, but the finite precision of computer arithmetic may lead to results that differ from an exact analytical calculation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum image vector and its norm for a series of test cases\n    under periodic boundary conditions in arbitrary triclinic cells.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    H1 = np.array([\n        [10.0, 0.0, 0.0],\n        [0.0, 10.0, 0.0],\n        [0.0, 0.0, 10.0]\n    ])\n    r1 = np.array([9.9, -9.9, 0.1])\n\n    H2 = np.array([\n        [8.0, 2.5, 1.2],\n        [0.0, 7.0, 0.8],\n        [0.0, 0.0, 6.0]\n    ])\n    s2 = np.array([1.2, -1.6, 0.49])\n    r2 = H2 @ s2\n\n    # Case 3 uses the same H matrix as Case 2\n    s3 = np.array([0.5, -0.5, 0.5])\n    r3 = H2 @ s3\n\n    H4 = np.array([\n        [10.0, 9.999, 0.0],\n        [0.0, 0.01, 0.0],\n        [0.0, 0.0, 10.0]\n    ])\n    s4 = np.array([3.7, -4.4, 0.33])\n    r4 = H4 @ s4\n\n    test_cases = [\n        (H1, r1),\n        (H2, r2),\n        (H2, r3),\n        (H4, r4),\n    ]\n\n    results = []\n    for H, r in test_cases:\n        # Step 1: Compute H_inv (or use solve for more stability, but inv is fine for 3x3)\n        H_inv = np.linalg.inv(H)\n\n        # Step 2: Transform Cartesian vector r to fractional coordinates s\n        s = H_inv @ r\n\n        # Step 3: Wrap fractional coordinates to the central cell [-0.5, 0.5)\n        # This is the branchless operation s' = s - floor(s + 0.5)\n        s_min = s - np.floor(s + 0.5)\n\n        # Step 4: Transform wrapped fractional vector back to Cartesian space\n        v_min = H @ s_min\n\n        # Step 5: Compute the Euclidean norm of the minimum image vector\n        norm_v_min = np.linalg.norm(v_min)\n        \n        # Store results for formatting\n        results.append([v_min[0], v_min[1], v_min[2], norm_v_min])\n\n    # Format the final output string as per problem specification.\n    # Round all output floating-point numbers to eight decimal places.\n    output_parts = []\n    for res_list in results:\n        # Format each number to 8 decimal places.\n        formatted_list = [f\"{x:.8f}\" for x in res_list]\n        output_parts.append(f\"[{','.join(formatted_list)}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(output_parts)}]\")\n\n\nsolve()\n```"
        }
    ]
}