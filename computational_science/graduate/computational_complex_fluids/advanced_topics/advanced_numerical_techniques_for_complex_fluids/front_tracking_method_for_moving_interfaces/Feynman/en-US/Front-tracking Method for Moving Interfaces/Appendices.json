{
    "hands_on_practices": [
        {
            "introduction": "The front-tracking method's primary strength is its explicit representation of interfaces, which are often sites of sharp discontinuities in material properties. This exercise invites you to explore this core challenge in a simplified one-dimensional diffusion problem, where a diffusion coefficient $k(x)$ has a jump at the interface location $x=\\alpha$. By implementing and comparing a sharp-interface technique (the Ghost Fluid Method) with a smeared-coefficient approach, you will gain direct insight into the fundamental trade-offs between accuracy and stability when discretizing jump conditions .",
            "id": "4088847",
            "problem": "Consider the one-dimensional diffusion of a scalar field with a stationary material interface tracked explicitly (front-tracking). Let the scalar field be denoted by $u(x,t)$ on the domain $x \\in [0,1]$ with Dirichlet boundary conditions $u(0,t) = 0$ and $u(1,t) = 1$. The governing equation is the diffusion equation\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(k(x)\\frac{\\partial u}{\\partial x}\\right),\n$$\nwhere the diffusion coefficient $k(x)$ is piecewise constant with a discontinuity at the interface location $x=\\alpha$, namely $k(x) = k_1$ for $x < \\alpha$ and $k(x) = k_2$ for $x > \\alpha$. The front-tracking method supplies the exact location of the interface $x=\\alpha$ at all times.\n\nIn a controlled steady problem with known analytical solution, the steady state $u(x)$ satisfies\n$$\n\\frac{d}{dx}\\left(k(x)\\frac{du}{dx}\\right) = 0,\n$$\nwith the boundary conditions $u(0)=0$ and $u(1)=1$, together with continuity of $u$ and continuity of the flux $k\\,u_x$ at the interface $x=\\alpha$. From these conditions, the exact steady solution is piecewise linear:\n$$\nu(x) = \\begin{cases}\na_1\\,x, & x \\le \\alpha, \\\\\na_2\\,x + b_2, & x \\ge \\alpha,\n\\end{cases}\n$$\nwhere the slopes $a_1$ and $a_2$ and the intercept $b_2$ are given by\n$$\nD = k_1 (1-\\alpha) + k_2 \\alpha,\\quad\na_1 = \\frac{k_2}{D},\\quad\na_2 = \\frac{k_1}{D},\\quad\nb_2 = a_1 \\alpha - a_2 \\alpha.\n$$\n\nYour task is to compare accuracy and stability of two numerical treatments of the discontinuity across the interface:\n\n- Ghost Fluid Method (GFM): Enforce the jump by constructing face fluxes that account for the interface within a face. For a uniform grid with spacing $\\Delta x$, define a per-face conductance $G_{i+\\frac{1}{2}}$ between nodes $x_i$ and $x_{i+1}$ as follows. If the interface lies within the face, i.e., $x_i < \\alpha < x_{i+1}$, then split the face length into $d_L = \\alpha - x_i$ and $d_R = x_{i+1} - \\alpha$ and use the exact series formula\n$$\nG_{i+\\frac{1}{2}} = \\left(\\frac{d_L}{k_1} + \\frac{d_R}{k_2}\\right)^{-1}.\n$$\nIf the face does not contain the interface, use\n$$\nG_{i+\\frac{1}{2}} = \\frac{k_s}{\\Delta x},\n$$\nwith $k_s = k_1$ if $x_{i+1} \\le \\alpha$ or $k_s = k_2$ if $x_i \\ge \\alpha$. The discrete operator acting on the interior nodes $i=1,\\dots,N-2$ is\n$$\n\\left[\\mathcal{L} u\\right]_i = \\frac{1}{\\Delta x}\\left( G_{i+\\frac{1}{2}}(u_{i+1}-u_i) - G_{i-\\frac{1}{2}}(u_i - u_{i-1}) \\right).\n$$\n\n- Smeared-Coefficient Method: Replace the discontinuous $k(x)$ by a regularized smooth transition using a smoothed Heaviside function $H_\\varepsilon(z)$, for example $H_\\varepsilon(z) = \\tfrac{1}{2}\\left(1+\\tanh\\left(\\tfrac{z}{\\varepsilon}\\right)\\right)$, and set\n$$\nk_\\varepsilon(x) = k_2 + (k_1 - k_2)\\,H_\\varepsilon(\\alpha - x).\n$$\nThen compute per-face conductances on a uniform grid using arithmetic averaging,\n$$\nk_{i+\\frac{1}{2}} = \\frac{k_\\varepsilon(x_i) + k_\\varepsilon(x_{i+1})}{2},\\quad G_{i+\\frac{1}{2}} = \\frac{k_{i+\\frac{1}{2}}}{\\Delta x},\n$$\nand use the same discrete operator $\\mathcal{L}$ as above with these $G_{i+\\frac{1}{2}}$.\n\nFor both methods, the steady discrete solution $u^\\ast$ satisfies the linear system $\\mathcal{L} u^\\ast = 0$ on the interior nodes with the Dirichlet boundary values enforced at $x=0$ and $x=1$. The explicit forward Euler time stepping for the semi-discrete system $u_t = \\mathcal{L} u$ has a stability constraint determined by the spectrum of the matrix representation $A$ of $\\mathcal{L}$ restricted to interior nodes. For a linear system $u_t = A u + f$ with Dirichlet boundaries, explicit forward Euler is stable if $|1 + \\Delta t\\,\\lambda| \\le 1$ for all eigenvalues $\\lambda$ of $A$; if all $\\lambda$ are real and negative, the largest stable time step is\n$$\n\\Delta t_{\\max} = -\\frac{2}{\\lambda_{\\min}},\n$$\nwhere $\\lambda_{\\min}$ is the most negative eigenvalue of $A$.\n\nImplement both methods on a uniform grid with $N$ nodes and compute:\n\n- The discrete $\\ell^2$ error of the steady numerical solution $u^\\ast$ compared to the exact steady solution $u(x)$, defined by\n$$\nE = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left(u^\\ast(x_i) - u(x_i)\\right)^2 \\right)^{1/2}.\n$$\n\n- The maximum stable time step $\\Delta t_{\\max}$ for explicit forward Euler, obtained from the most negative eigenvalue of the interior matrix $A$ for each method using the formula above.\n\nWork in dimensionless units.\n\nTest Suite:\nUse the following parameter sets, each given as $(N, \\alpha, k_1, k_2, \\varepsilon)$:\n\n- Case $1$: $(101,\\,0.37,\\,1,\\,10,\\,0.02)$.\n- Case $2$: $(101,\\,0.50,\\,1,\\,1000,\\,0.02)$.\n- Case $3$: $(81,\\,0.05,\\,5,\\,1,\\,0.02)$.\n- Case $4$: $(61,\\,0.3333,\\,2,\\,7,\\,0.001)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing, for each case, an inner list with four floats in the order $[E_{\\mathrm{GFM}}, E_{\\mathrm{smear}}, \\Delta t_{\\max,\\mathrm{GFM}}, \\Delta t_{\\max,\\mathrm{smear}}]$, aggregated into a single outer list. For example: $[[e_1,e_2,e_3,e_4],[e_5,e_6,e_7,e_8],\\dots]$.",
            "solution": "The user has provided a well-defined problem in the field of computational physics and numerical analysis. The problem is scientifically grounded, self-contained, and objective. It requires the implementation and comparison of two standard numerical methods for treating a material interface in a diffusion problem. All provided formulas and theoretical premises are correct. The problem is therefore deemed **valid**.\n\nThe objective is to analyze two numerical methods for solving the one-dimensional steady-state diffusion equation with a piecewise-constant diffusion coefficient $k(x)$:\n$$\n\\frac{d}{dx}\\left(k(x)\\frac{du}{dx}\\right) = 0\n$$\non the domain $x \\in [0, 1]$ with Dirichlet boundary conditions $u(0) = 0$ and $u(1) = 1$. The diffusion coefficient $k(x)$ has a jump discontinuity at $x = \\alpha$:\n$$\nk(x) = \\begin{cases} k_1 & \\text{for } x < \\alpha \\\\ k_2 & \\text{for } x > \\alpha \\end{cases}\n$$\nWe will discretize the domain using a uniform grid of $N$ nodes, $x_i = i \\Delta x$ for $i=0, \\dots, N-1$, where the grid spacing is $\\Delta x = 1/(N-1)$. We employ a finite-volume approach, which ensures conservation. Integrating the governing equation over a control volume $[x_{i-1/2}, x_{i+1/2}]$ centered at node $x_i$ yields a flux balance:\n$$\n\\left[k\\frac{du}{dx}\\right]_{x_{i+1/2}} - \\left[k\\frac{du}{dx}\\right]_{x_{i-1/2}} = 0\n$$\nThe flux at a face, e.g., $F_{i+1/2} = [k\\frac{du}{dx}]_{x_{i+1/2}}$, is approximated using the values at adjacent nodes, $u_i$ and $u_{i+1}$, as $F_{i+1/2} \\approx G_{i+1/2}(u_{i+1} - u_i)$. The term $G_{i+1/2}$ is the face conductance. This leads to a system of linear equations for the interior nodes ($i=1, \\dots, N-2$):\n$$\nG_{i+1/2}(u_{i+1} - u_i) - G_{i-1/2}(u_i - u_{i-1}) = 0\n$$\nThe two methods to be compared, the Ghost Fluid Method (GFM) and the Smeared-Coefficient Method, differ in their calculation of the face conductances $G_{i+1/2}$.\n\n**1. Ghost Fluid Method (GFM)**\nThis method explicitly accounts for the sub-cell location of the interface. The conductance of a face is computed based on whether the interface falls within it.\n- If the interface at $x=\\alpha$ is located within the face between nodes $x_i$ and $x_{i+1}$ (i.e., $x_i < \\alpha < x_{i+1}$), the face is treated as two resistors in series. The lengths of the sub-faces are $d_L = \\alpha - x_i$ and $d_R = x_{i+1} - \\alpha$. The total resistance is the sum of individual resistances, and the conductance is its inverse:\n$$\nG_{i+1/2} = \\left(\\frac{d_L}{k_1} + \\frac{d_R}{k_2}\\right)^{-1}\n$$\nThis is the harmonic mean of the conductivities over the face.\n- If the face is entirely on one side of the interface, the conductance is calculated assuming a homogeneous medium.\n    - If $x_{i+1} \\le \\alpha$, the medium is of type $1$, and $G_{i+1/2} = k_1/\\Delta x$.\n    - If $x_{i} \\ge \\alpha$, the medium is of type $2$, and $G_{i+1/2} = k_2/\\Delta x$.\n\n**2. Smeared-Coefficient Method**\nThis method regularizes the sharp interface by replacing the discontinuous $k(x)$ with a smooth function $k_\\varepsilon(x)$ that transitions over a small width controlled by $\\varepsilon$. A smoothed Heaviside function, $H_\\varepsilon(z) = \\frac{1}{2}(1+\\tanh(z/\\varepsilon))$, is used:\n$$\nk_\\varepsilon(x) = k_2 + (k_1 - k_2)H_\\varepsilon(\\alpha - x)\n$$\nWith this smooth coefficient field, the face conductivity $k_{i+1/2}$ is computed by arithmetic averaging of the values at the adjacent nodes:\n$$\nk_{i+1/2} = \\frac{k_\\varepsilon(x_i) + k_\\varepsilon(x_{i+1})}{2}\n$$\nThe face conductance is then given by:\n$$\nG_{i+1/2} = \\frac{k_{i+1/2}}{\\Delta x}\n$$\n\n**3. Solving for the Steady State and Error Calculation**\nFor both methods, the set of discrete equations for the interior nodes ($u_1, \\dots, u_{N-2}$) forms a linear system $M \\mathbf{u}_{\\text{int}} = \\mathbf{b}$. The $(N-2) \\times (N-2)$ matrix $M$ is tridiagonal and symmetric, derived from the conductance terms. Its elements for row $j$ (corresponding to node $u_{j+1}$) are:\n- Diagonal: $M_{j,j} = -(G_{j+3/2} + G_{j+1/2})$\n- Off-diagonal: $M_{j, j-1} = G_{j+1/2}$ and $M_{j, j+1} = G_{j+3/2}$.\nThe right-hand side vector $\\mathbf{b}$ incorporates the Dirichlet boundary conditions. Since $u_0=0$, the first equation is homogeneous. Since $u_{N-1}=1$, the last equation for node $u_{N-2}$ has a source term, making the vector $\\mathbf{b}$ have only one non-zero entry: $b_{N-3} = -G_{N-3/2}$. After solving for the interior values $\\mathbf{u}_{\\text{int}}$, the full numerical solution $u^\\ast$ is constructed by including the boundary values.\n\nThe accuracy of the numerical solution $u^\\ast$ is measured by the discrete $\\ell^2$ error against the exact analytical solution $u(x)$, given as:\n$$\nE = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left(u^\\ast(x_i) - u(x_i)\\right)^2 \\right)^{1/2}\n$$\n\n**4. Stability Analysis**\nThe semi-discretized time-dependent system is $\\frac{d\\mathbf{u}}{dt} = A\\mathbf{u} + \\mathbf{f}$, where $A$ is the matrix representation of the spatial operator $\\mathcal{L}$ for the interior nodes. This matrix is $A = (1/\\Delta x) M$. For the Forward Euler time-stepping scheme, stability requires that the time step $\\Delta t$ satisfies $|1 + \\Delta t \\lambda| \\le 1$ for all eigenvalues $\\lambda$ of $A$. Since $A$ is symmetric and represents a diffusion operator, its eigenvalues are real and non-positive. The stability condition simplifies to $\\Delta t \\le -2/\\lambda_{\\min}$, where $\\lambda_{\\min}$ is the most negative eigenvalue of $A$. The maximum stable time step is thus:\n$$\n\\Delta t_{\\max} = -\\frac{2}{\\lambda_{\\min}}\n$$\nWe compute the eigenvalues of $A$ for each method to determine their respective $\\Delta t_{\\max}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        (101, 0.37, 1, 10, 0.02),\n        (101, 0.50, 1, 1000, 0.02),\n        (81, 0.05, 5, 1, 0.02),\n        (61, 0.3333, 2, 7, 0.001),\n    ]\n\n    all_results_str = []\n\n    for N, alpha, k1, k2, epsilon in test_cases:\n        # GFM calculation\n        E_gfm, dt_gfm = compute_metrics(N, alpha, k1, k2, epsilon, method='gfm')\n        \n        # Smeared-coefficient calculation\n        E_smear, dt_smear = compute_metrics(N, alpha, k1, k2, epsilon, method='smear')\n\n        case_result_str = f\"[{E_gfm},{E_smear},{dt_gfm},{dt_smear}]\"\n        all_results_str.append(case_result_str)\n\n    print(f\"[{','.join(all_results_str)}]\")\n\ndef compute_metrics(N, alpha, k1, k2, epsilon, method):\n    \"\"\"\n    Computes numerical solution, error, and max timestep for a given method.\n    \n    Args:\n        N (int): Number of grid nodes.\n        alpha (float): Interface location.\n        k1 (float): Diffusion coefficient for x < alpha.\n        k2 (float): Diffusion coefficient for x > alpha.\n        epsilon (float): Smoothing width for smeared-coefficient method.\n        method (str): 'gfm' or 'smear'.\n        \n    Returns:\n        tuple: A tuple containing the l2 error (float) and max timestep (float).\n    \"\"\"\n    dx = 1.0 / (N - 1)\n    x = np.linspace(0, 1, N)\n\n    # 1. Compute face conductances G_{i+1/2}\n    G = np.zeros(N - 1)\n    if method == 'gfm':\n        for i in range(N - 1):\n            x_i, x_ip1 = x[i], x[i+1]\n            if x_ip1 <= alpha:\n                G[i] = k1 / dx\n            elif x_i >= alpha:\n                G[i] = k2 / dx\n            else: # Interface in face (x_i < alpha < x_ip1)\n                dL = alpha - x_i\n                dR = x_ip1 - alpha\n                # Harmonic mean for series resistors\n                G[i] = 1.0 / (dL/k1 + dR/k2)\n    elif method == 'smear':\n        def H_eps(z, eps):\n            return 0.5 * (1.0 + np.tanh(z / eps))\n        \n        k_eps = k2 + (k1 - k2) * H_eps(alpha - x, epsilon)\n        for i in range(N - 1):\n            k_face = (k_eps[i] + k_eps[i+1]) / 2.0\n            G[i] = k_face / dx\n    else:\n        raise ValueError(\"Unknown method specified.\")\n\n    # 2. Assemble and solve the linear system M*u_int = b for steady state\n    M_size = N - 2\n    if M_size <= 0: # Grid too coarse\n        u_star = np.array([0., 1.]) if N==2 else np.array([0.])\n    else:\n        diag_vals = -(G[1:M_size+1] + G[0:M_size])\n        off_diag_vals = G[1:M_size]\n        M = np.diag(diag_vals) + np.diag(off_diag_vals, k=1) + np.diag(off_diag_vals, k=-1)\n        \n        b = np.zeros(M_size)\n        b[-1] = -G[N-2] # -G_{N-3/2}\n        \n        u_int = np.linalg.solve(M, b)\n        u_star = np.concatenate(([0], u_int, [1]))\n\n    # 3. Calculate exact solution\n    D = k1 * (1 - alpha) + k2 * alpha\n    a1 = k2 / D\n    a2 = k1 / D\n    b2 = (k2 - k1) * alpha / D\n    u_exact = np.where(x <= alpha, a1 * x, a2 * x + b2)\n\n    # 4. Calculate l2 error\n    error = np.sqrt(dx * np.sum((u_star - u_exact)**2))\n\n    # 5. Calculate max stable timestep\n    if M_size <= 0:\n        dt_max = np.inf\n    else:\n        A = (1.0/dx) * M\n        # A is symmetric, use eigvalsh for efficiency and stability\n        eigenvalues = np.linalg.eigvalsh(A)\n        lambda_min = eigenvalues[0] # eigvalsh returns sorted eigenvalues\n        if lambda_min == 0:\n            dt_max = np.inf\n        else:\n            dt_max = -2.0 / lambda_min\n\n    return error, dt_max\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Beyond property jumps, interfaces in complex fluids are governed by singular forces like surface tension, which act only on the interface itself. A key mechanism in front-tracking is spreading this Lagrangian force onto the fixed Eulerian grid. This practice provides a concrete, hands-on calculation of this process, asking you to compute the force density at a grid node from a single interface element using a regularized delta function $\\delta_h$ . Mastering this calculation is fundamental to implementing surface tension in any immersed boundary or front-tracking code.",
            "id": "4088769",
            "problem": "Consider a single triangular interface element in a three-dimensional front-tracking discretization of a two-phase flow. The interface is represented by Lagrangian elements that exert a surface tension force density distributed to an underlying Eulerian grid using a regularized discrete delta function. The surface tension force per unit area on the interface is given by $\\sigma \\kappa \\mathbf{n}$, where $\\sigma$ is the surface tension coefficient, $\\kappa$ is the mean curvature, and $\\mathbf{n}$ is the unit normal. In the front-tracking method, the Eulerian force density at a grid node located at position $\\mathbf{x}_i$ due to a single element with centroid at position $\\mathbf{x}_e$ and area $A_e$ is modeled by\n$$\n\\mathbf{f}(\\mathbf{x}_i) \\approx \\sigma \\kappa \\mathbf{n} \\, A_e \\, \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e).\n$$\nAssume a uniform Cartesian grid with spacing $h$, and use the standard separable regularized discrete delta function popularized in the Immersed Boundary (IB) method,\n$$\n\\delta_h(\\mathbf{r}) = \\frac{1}{h^3} \\, \\phi\\!\\left(\\frac{r_x}{h}\\right) \\, \\phi\\!\\left(\\frac{r_y}{h}\\right) \\, \\phi\\!\\left(\\frac{r_z}{h}\\right),\n$$\nwhere $\\mathbf{r} = (r_x,r_y,r_z)$ and $\\phi$ is the four-point one-dimensional kernel defined by\n$$\n\\phi(r) =\n\\begin{cases}\n\\frac{1}{8}\\left(3 - 2|r| + \\sqrt{1 + 4|r| - 4 r^2}\\right), & |r| \\leq 1, \\\\\n\\frac{1}{8}\\left(5 - 2|r| - \\sqrt{-7 + 12|r| - 4 r^2}\\right), & 1 < |r| \\leq 2, \\\\\n0, & |r| > 2.\n\\end{cases}\n$$\nYou are given:\n- Surface tension coefficient $\\sigma = 0.072$ $\\mathrm{N\\,m^{-1}}$,\n- Mean curvature $\\kappa = 4.0 \\times 10^{3}$ $\\mathrm{m^{-1}}$,\n- Interface unit normal $\\mathbf{n} = \\frac{1}{\\sqrt{3}}(1,1,1)$,\n- Triangular element area $A_e = 2.5 \\times 10^{-8}$ $\\mathrm{m^2}$,\n- Grid spacing $h = 1.0 \\times 10^{-3}$ $\\mathrm{m}$,\n- Element centroid $\\mathbf{x}_e = (1.5 \\times 10^{-3},\\, 2.25 \\times 10^{-3},\\, 0.75 \\times 10^{-3})$ $\\mathrm{m}$,\n- Target grid node position $\\mathbf{x}_i = (2.0 \\times 10^{-3},\\, 2.0 \\times 10^{-3},\\, 1.0 \\times 10^{-3})$ $\\mathrm{m}$.\n\nUsing the centroid quadrature approximation and the discrete delta function $\\delta_h$ above, compute the magnitude of the discrete surface tension force density $\\|\\mathbf{f}(\\mathbf{x}_i)\\|$ at the specified grid node. Round your final numerical answer to four significant figures. Express your final answer in $\\mathrm{N\\,m^{-3}}$. Also, verify dimensional consistency of $\\mathbf{f}$ from first principles starting with the given physical definitions and the form of $\\delta_h$.",
            "solution": "The problem requires the calculation of the magnitude of a discrete surface tension force density at a specific grid node in a front-tracking simulation. It also asks for a verification of dimensional consistency.\n\n### Step 1: Extract Givens\n- The Eulerian force density at grid node $\\mathbf{x}_i$: $\\mathbf{f}(\\mathbf{x}_i) \\approx \\sigma \\kappa \\mathbf{n} \\, A_e \\, \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e)$\n- Surface tension coefficient: $\\sigma = 0.072 \\, \\mathrm{N\\,m^{-1}}$\n- Mean curvature: $\\kappa = 4.0 \\times 10^{3} \\, \\mathrm{m^{-1}}$\n- Interface unit normal: $\\mathbf{n} = \\frac{1}{\\sqrt{3}}(1,1,1)$\n- Triangular element area: $A_e = 2.5 \\times 10^{-8} \\, \\mathrm{m^2}$\n- Grid spacing: $h = 1.0 \\times 10^{-3} \\, \\mathrm{m}$\n- Element centroid position: $\\mathbf{x}_e = (1.5 \\times 10^{-3},\\, 2.25 \\times 10^{-3},\\, 0.75 \\times 10^{-3}) \\, \\mathrm{m}$\n- Target grid node position: $\\mathbf{x}_i = (2.0 \\times 10^{-3},\\, 2.0 \\times 10^{-3},\\, 1.0 \\times 10^{-3}) \\, \\mathrm{m}$\n- Regularized discrete delta function: $\\delta_h(\\mathbf{r}) = \\frac{1}{h^3} \\, \\phi\\!\\left(\\frac{r_x}{h}\\right) \\, \\phi\\!\\left(\\frac{r_y}{h}\\right) \\, \\phi\\!\\left(\\fracr_z}{h}\\right)$\n- One-dimensional kernel: $\\phi(r) =\n\\begin{cases}\n\\frac{1}{8}\\left(3 - 2|r| + \\sqrt{1 + 4|r| - 4 r^2}\\right), & |r| \\leq 1, \\\\\n\\frac{1}{8}\\left(5 - 2|r| - \\sqrt{-7 + 12|r| - 4 r^2}\\right), & 1 < |r| \\leq 2, \\\\\n0, & |r| > 2.\n\\end{cases}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n- **Scientifically Grounded:** The formulation is a standard representation of surface tension forces in the context of the front-tracking and immersed boundary methods, which are widely used in computational fluid dynamics for multiphase flows. The equations for the force density and the discrete delta function are taken directly from established literature (e.g., Peskin, 2002).\n- **Well-Posed:** All necessary parameters and functional forms are provided. The problem asks for a specific numerical calculation based on these inputs, which leads to a unique solution.\n- **Objective:** The problem statement is quantitative and free of subjective or ambiguous language.\n\nThe problem does not exhibit any of the flaws listed in the validation criteria. The data provided are self-consistent and realistic for a microfluidic simulation.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Dimensional Consistency Verification\nThe problem requests verification of the dimensional consistency of the force density $\\mathbf{f}(\\mathbf{x}_i)$. Let $[X]$ denote the dimensions of a quantity $X$ in terms of mass ($M$), length ($L$), and time ($T$).\nThe surface tension coefficient $\\sigma$ is force per unit length, so $[\\sigma] = \\frac{[\\text{Force}]}{[\\text{Length}]} = \\frac{MLT^{-2}}{L} = MT^{-2}$.\nThe mean curvature $\\kappa$ is the inverse of a length, so $[\\kappa] = L^{-1}$.\nThe area $A_e$ has dimensions of length squared, $[A_e] = L^2$.\nThe unit normal $\\mathbf{n}$ is dimensionless.\nThe total force exerted by the element is $\\mathbf{F}_e = \\sigma \\kappa A_e \\mathbf{n}$. The dimensions of its magnitude are:\n$$\n[\\|\\mathbf{F}_e\\|] = [\\sigma] [\\kappa] [A_e] = (MT^{-2}) (L^{-1}) (L^2) = MLT^{-2}\n$$\nThese are the dimensions of force, as expected.\n\nNow consider the discrete delta function $\\delta_h(\\mathbf{r})$. The argument of the kernel $\\phi$, $r/h$, is a ratio of lengths, so it is dimensionless. The function $\\phi$ itself is therefore dimensionless. The grid spacing $h$ has dimensions of length, $[h] = L$. The delta function is defined as:\n$$\n\\delta_h(\\mathbf{r}) = \\frac{1}{h^3} \\, \\phi\\!\\left(\\frac{r_x}{h}\\right) \\, \\phi\\!\\left(\\frac{r_y}{h}\\right) \\, \\phi\\!\\left(\\frac{r_z}{h}\\right)\n$$\nIts dimensions are:\n$$\n[\\delta_h] = \\frac{1}{[h^3]} [\\phi] [\\phi] [\\phi] = \\frac{1}{L^3} \\cdot 1 \\cdot 1 \\cdot 1 = L^{-3}\n$$\nThis corresponds to an inverse volume, which is the correct dimension for a three-dimensional delta function.\n\nFinally, the force density $\\mathbf{f}(\\mathbf{x}_i) = \\mathbf{F}_e \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e)$. Its dimensions are:\n$$\n[\\|\\mathbf{f}(\\mathbf{x}_i)\\|] = [\\|\\mathbf{F}_e\\|] [\\delta_h] = (MLT^{-2}) (L^{-3}) = ML^{-2}T^{-2}\n$$\nThe dimensions of force density (force per unit volume) are $\\frac{[\\text{Force}]}{[\\text{Volume}]} = \\frac{MLT^{-2}}{L^3} = ML^{-2}T^{-2}$. The dimensions are consistent.\n\n### Solution Calculation\nThe force density is given by $\\mathbf{f}(\\mathbf{x}_i) = \\sigma \\kappa A_e \\mathbf{n} \\, \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e)$. We need to compute its magnitude $\\|\\mathbf{f}(\\mathbf{x}_i)\\|$. Since $\\mathbf{n}$ is a unit vector, $\\|\\mathbf{n}\\| = 1$. The magnitude is:\n$$\n\\|\\mathbf{f}(\\mathbf{x}_i)\\| = |\\sigma \\kappa A_e| \\cdot \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e) \\cdot \\|\\mathbf{n}\\| = \\sigma \\kappa A_e \\delta_h(\\mathbf{x}_i - \\mathbf{x}_e)\n$$\n(assuming $\\sigma, \\kappa, A_e \\ge 0$ and $\\delta_h \\ge 0$, which is true for the given kernel).\n\nFirst, we compute the displacement vector $\\mathbf{r} = \\mathbf{x}_i - \\mathbf{x}_e$:\n$$\n\\mathbf{r} = \\begin{pmatrix} 2.0 \\times 10^{-3} \\\\ 2.0 \\times 10^{-3} \\\\ 1.0 \\times 10^{-3} \\end{pmatrix} \\mathrm{m} - \\begin{pmatrix} 1.5 \\times 10^{-3} \\\\ 2.25 \\times 10^{-3} \\\\ 0.75 \\times 10^{-3} \\end{pmatrix} \\mathrm{m} = \\begin{pmatrix} 0.5 \\times 10^{-3} \\\\ -0.25 \\times 10^{-3} \\\\ 0.25 \\times 10^{-3} \\end{pmatrix} \\mathrm{m}\n$$\nNext, we compute the normalized displacement components for the kernel function $\\phi$, using $h = 1.0 \\times 10^{-3} \\, \\mathrm{m}$:\n$$\n\\frac{r_x}{h} = \\frac{0.5 \\times 10^{-3}}{1.0 \\times 10^{-3}} = 0.5\n$$\n$$\n\\frac{r_y}{h} = \\frac{-0.25 \\times 10^{-3}}{1.0 \\times 10^{-3}} = -0.25\n$$\n$$\n\\frac{r_z}{h} = \\frac{0.25 \\times 10^{-3}}{1.0 \\times 10^{-3}} = 0.25\n$$\nNow we evaluate the kernel function $\\phi$ for each of these values. All absolute values are less than or equal to $1$, so we use the first case of the definition of $\\phi(r)$.\n\nFor $r=0.5$:\n$$\n\\phi(0.5) = \\frac{1}{8}\\left(3 - 2|0.5| + \\sqrt{1 + 4|0.5| - 4(0.5)^2}\\right) = \\frac{1}{8}\\left(3 - 1 + \\sqrt{1 + 2 - 1}\\right) = \\frac{1}{8}(2 + \\sqrt{2})\n$$\nFor $r=-0.25$:\n$$\n\\phi(-0.25) = \\frac{1}{8}\\left(3 - 2|-0.25| + \\sqrt{1 + 4|-0.25| - 4(-0.25)^2}\\right) = \\frac{1}{8}\\left(3 - 0.5 + \\sqrt{1 + 1 - 0.25}\\right)\n$$\n$$\n\\phi(-0.25) = \\frac{1}{8}\\left(2.5 + \\sqrt{1.75}\\right) = \\frac{1}{8}\\left(\\frac{5}{2} + \\sqrt{\\frac{7}{4}}\\right) = \\frac{1}{8}\\left(\\frac{5}{2} + \\frac{\\sqrt{7}}{2}\\right) = \\frac{1}{16}(5 + \\sqrt{7})\n$$\nSince $\\phi(r)$ depends on $|r|$, $\\phi(0.25) = \\phi(-0.25)$.\n\nNow, we compute the value of the discrete delta function $\\delta_h(\\mathbf{r})$:\n$$\n\\delta_h(\\mathbf{r}) = \\frac{1}{h^3} \\phi\\left(\\frac{r_x}{h}\\right) \\phi\\left(\\frac{r_y}{h}\\right) \\phi\\left(\\frac{r_z}{h}\\right)\n$$\n$$\n\\delta_h(\\mathbf{r}) = \\frac{1}{(1.0 \\times 10^{-3})^3} \\left[ \\frac{1}{8}(2 + \\sqrt{2}) \\right] \\left[ \\frac{1}{16}(5 + \\sqrt{7}) \\right] \\left[ \\frac{1}{16}(5 + \\sqrt{7}) \\right]\n$$\n$$\n\\delta_h(\\mathbf{r}) = \\frac{10^9}{8 \\cdot 16 \\cdot 16} (2 + \\sqrt{2}) (5 + \\sqrt{7})^2 = \\frac{10^9}{2048} (2 + \\sqrt{2}) (25 + 10\\sqrt{7} + 7) = \\frac{10^9}{2048} (2 + \\sqrt{2}) (32 + 10\\sqrt{7})\n$$\nNumerically evaluating the components:\n$\\phi(0.5) = \\frac{1}{8}(2 + \\sqrt{2}) \\approx \\frac{1}{8}(3.41421356) \\approx 0.42677670$\n$\\phi(\\pm 0.25) = \\frac{1}{16}(5 + \\sqrt{7}) \\approx \\frac{1}{16}(7.64575131) \\approx 0.47785946$\n$$\n\\delta_h(\\mathbf{r}) \\approx \\frac{1}{(1.0 \\times 10^{-3})^3} (0.42677670) (0.47785946)^2 \\approx 10^9 \\cdot (0.42677670) \\cdot (0.22834954) \\approx 9.745150 \\times 10^7 \\, \\mathrm{m^{-3}}\n$$\nNext, we compute the scalar part of the force magnitude, $F_e = \\sigma \\kappa A_e$:\n$$\nF_e = (0.072 \\, \\mathrm{N\\,m^{-1}}) \\cdot (4.0 \\times 10^3 \\, \\mathrm{m^{-1}}) \\cdot (2.5 \\times 10^{-8} \\, \\mathrm{m^2})\n$$\n$$\nF_e = 0.072 \\cdot (4.0 \\times 2.5) \\cdot (10^3 \\times 10^{-8}) \\, \\mathrm{N} = 0.072 \\cdot 10.0 \\cdot 10^{-5} \\, \\mathrm{N} = 0.72 \\cdot 10^{-5} \\, \\mathrm{N} = 7.2 \\times 10^{-6} \\, \\mathrm{N}\n$$\nFinally, we compute the magnitude of the force density:\n$$\n\\|\\mathbf{f}(\\mathbf{x}_i)\\| = F_e \\cdot \\delta_h(\\mathbf{r})\n$$\n$$\n\\|\\mathbf{f}(\\mathbf{x}_i)\\| \\approx (7.2 \\times 10^{-6} \\, \\mathrm{N}) \\cdot (9.745150 \\times 10^7 \\, \\mathrm{m^{-3}})\n$$\n$$\n\\|\\mathbf{f}(\\mathbf{x}_i)\\| \\approx 7.2 \\cdot 9.745150 \\times 10^1 \\, \\mathrm{N\\,m^{-3}} \\approx 701.6508 \\, \\mathrm{N\\,m^{-3}}\n$$\nRounding the final answer to four significant figures, we get $701.7 \\, \\mathrm{N\\,m^{-3}}$.",
            "answer": "$$\n\\boxed{701.7}\n$$"
        },
        {
            "introduction": "A successful implementation of a multiphase flow solver requires rigorous validation to ensure physical fidelity. One of the most common numerical artifacts in simulations with surface tension is the generation of non-physical \"spurious currents\" around static interfaces. This capstone exercise guides you through the design and implementation of a static drop test, a standard benchmark to quantify these currents by solving the full Stokes equations . By completing this test, you will learn how to diagnose a key source of error and evaluate the quality of the coupling between the interface force model and the bulk fluid solver.",
            "id": "4088839",
            "problem": "Consider a two-dimensional, periodic square domain of side length $L = 1$ filled with a single Newtonian fluid of dynamic viscosity $\\mu$. A single circular drop with surface tension coefficient $\\sigma$ is embedded, centered at $(0.5,0.5)$ with radius $R$. In the continuum, the static-drop configuration at rest is an exact equilibrium: the interface force balances the pressure jump and the velocity field is identically zero. In a front-tracking numerical method, the interfacial force is spread to an Eulerian grid using a regularized delta function with a finite smoothing width $\\,\\delta_h\\,$. In practice, a nonzero solenoidal component of the discretized force remains after spreading, generating so-called spurious currents. A rigorous way to assess the suppression of spurious currents is to perform a static-drop test: compute the steady incompressible Stokes response to the discretized interfacial force and report the maximum velocity magnitude as the grid is refined.\n\nStarting from the steady incompressible Stokes equations under periodic boundary conditions,\n$$\n-\\nabla p + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0,\n$$\ndesign and implement a program that:\n\n- Represents the interface as a closed parametric curve of $M$ equally spaced Lagrangian markers on a circle of radius $R$ centered at $(0.5,0.5)$.\n- Uses the curvature $\\,\\kappa = 1/R\\,$ and outward unit normal vector $\\mathbf{n}$ at each marker to construct the continuous interfacial surface tension force per unit length $\\,\\sigma \\kappa \\mathbf{n}\\,$.\n- Spreads the interfacial force to the Eulerian grid by approximating the line integral with a Riemann sum of $M$ markers, where each marker contributes\n$$\n\\Delta \\mathbf{F}(\\mathbf{x}) = \\sigma \\kappa \\mathbf{n} \\,\\Delta s\\, \\delta_{\\delta_h}(\\mathbf{x} - \\mathbf{X}_i),\n$$\nwith $\\,\\Delta s = 2\\pi R/M\\,$ and the regularized two-dimensional delta function chosen as the isotropic Gaussian\n$$\n\\delta_{\\delta_h}(\\mathbf{r}) = \\frac{1}{\\pi \\delta_h^2}\\,\\exp\\!\\left(-\\frac{\\lVert \\mathbf{r}\\rVert^2}{\\delta_h^2}\\right).\n$$\nDistances $\\,\\mathbf{r} = \\mathbf{x} - \\mathbf{X}_i\\,$ must be computed with minimum-image periodic wrapping on the unit torus so that each component is mapped to the interval $[-0.5,0.5]$.\n\n- Solves the steady Stokes problem on a uniform $N \\times N$ grid in Fourier space using a solenoidal projection consistent with the incompressibility constraint, returning the velocity field $\\,\\mathbf{u}(\\mathbf{x})\\,$. The exact continuum equilibrium would yield the zero field $\\,\\mathbf{u}(\\mathbf{x}) = \\mathbf{0}\\,$; any nonzero field is the spurious current induced by discretization and regularization.\n- Reports the maximum velocity magnitude $\\,\\max_{\\mathbf{x}} \\lVert \\mathbf{u}(\\mathbf{x}) \\rVert\\,$ for each test case.\n\nAll quantities are nondimensional. Angles must be in radians. The discrete Fourier transform should be implemented using the Fast Fourier Transform (FFT). The program must produce the steady Stokes response by projecting the spread force to its divergence-free component and inverting the Laplacian in Fourier space, consistently handling the zero wavenumber mode to avoid singularities.\n\nTest Suite. Use the following set of parameter values to exercise different aspects of the method:\n\n- Case $1$: $N = 32$, $\\delta_h/h = 0.5$, $R = 0.25$, $\\mu = 1.0$, $\\sigma = 1.0$, $M = 128$.\n- Case $2$: $N = 64$, $\\delta_h/h = 1.0$, $R = 0.25$, $\\mu = 1.0$, $\\sigma = 1.0$, $M = 256$.\n- Case $3$: $N = 64$, $\\delta_h/h = 2.0$, $R = 0.25$, $\\mu = 1.0$, $\\sigma = 1.0$, $M = 256$.\n- Case $4$: $N = 128$, $\\delta_h/h = 2.0$, $R = 0.25$, $\\mu = 1.0$, $\\sigma = 1.0$, $M = 512$.\n- Case $5$: $N = 64$, $\\delta_h/h = 4.0$, $R = 0.25$, $\\mu = 1.0$, $\\sigma = 1.0$, $M = 256$.\n\nHere $\\,h = L/N\\,$ and $\\,\\delta_h = (\\delta_h/h)\\,h\\,$. The program should compute the maximum velocity magnitude for each case. Your program should produce a single line of output containing the results as a comma-separated list of floats in scientific notation with exactly $8$ significant digits, enclosed in square brackets, in the order of the cases above (e.g., $[a_1, a_2, a_3, a_4, a_5]$). The answers are nondimensional floats.",
            "solution": "The user-provided problem is a well-posed and scientifically sound task from the domain of computational fluid dynamics, specifically concerning the numerical simulation of multiphase flows. It asks for the implementation of a static drop test, a standard benchmark used to quantify the magnitude of non-physical \"spurious currents\" that arise from the discretization of surface tension forces in front-tracking and other Eulerian methods for moving interfaces. The problem provides a complete set of physical and numerical parameters and specifies a Fourier spectral method for the solution, which is appropriate for the periodic domain. The problem statement is validated as complete, consistent, and grounded in established scientific principles.\n\nThe solution proceeds by implementing a Fourier-spectral solver for the steady, incompressible Stokes equations on a two-dimensional periodic domain, with a forcing term derived from a regularized model of surface tension on a circular interface.\n\n### Principle-Based Design of the Numerical Method\n\nThe core of the problem is to find the steady-state velocity field $\\mathbf{u}(\\mathbf{x})$ that satisfies the incompressible Stokes equations for a fluid with dynamic viscosity $\\mu$ under the action of a force field $\\mathbf{f}(\\mathbf{x})$:\n$$\n-\\nabla p + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{f} = \\mathbf{0}\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\nwhere $p$ is the pressure. The domain is a periodic square of side length $L=1$.\n\n#### 1. Fourier Spectral Solution of Stokes Equations\nFor a problem on a periodic domain, a Fourier spectral method is highly effective. We represent all fields (velocity $\\mathbf{u}$, pressure $p$, and force $\\mathbf{f}$) by their Fourier series. The differential operators transform into algebraic operations in Fourier space. Let $\\hat{\\phi}(\\mathbf{k})$ denote the Fourier transform of a field $\\phi(\\mathbf{x})$, where $\\mathbf{k}=(k_x, k_y)$ is the wavevector. The operators transform as: $\\nabla \\rightarrow i\\mathbf{k}$, $\\nabla \\cdot \\rightarrow i\\mathbf{k} \\cdot$, and $\\nabla^2 \\rightarrow -\\|\\mathbf{k}\\|^2 = -k^2$.\n\nApplying the Fourier transform to the Stokes equations yields a system of algebraic equations for each wavevector $\\mathbf{k}$:\n$$\n-i\\mathbf{k} \\hat{p}(\\mathbf{k}) + \\mu (-k^2) \\hat{\\mathbf{u}}(\\mathbf{k}) + \\hat{\\mathbf{f}}(\\mathbf{k}) = \\mathbf{0}\n$$\n$$\ni\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}) = 0\n$$\n\nThe second equation is the incompressibility constraint in Fourier space, which states that the Fourier mode of the velocity field, $\\hat{\\mathbf{u}}(\\mathbf{k})$, must be orthogonal to its corresponding wavevector $\\mathbf{k}$. This means $\\hat{\\mathbf{u}}(\\mathbf{k})$ is a solenoidal (divergence-free) vector field.\n\nWe can eliminate the pressure term by applying a solenoidal projection operator, $\\mathcal{P}_{\\mathbf{k}}(\\mathbf{v}) = \\mathbf{v} - \\frac{\\mathbf{v} \\cdot \\mathbf{k}}{k^2}\\mathbf{k}$, to the momentum equation. This operator projects a vector onto the subspace perpendicular to $\\mathbf{k}$.\n- The pressure gradient term, $-i\\mathbf{k} \\hat{p}$, is parallel to $\\mathbf{k}$, so its projection is zero: $\\mathcal{P}_{\\mathbf{k}}(-i\\mathbf{k} \\hat{p}) = \\mathbf{0}$.\n- The velocity field $\\hat{\\mathbf{u}}$ is already solenoidal, so it is unchanged by the projection: $\\mathcal{P}_{\\mathbf{k}}(\\hat{\\mathbf{u}}) = \\hat{\\mathbf{u}}$.\n\nApplying the projection to the momentum equation gives:\n$$\n-\\mu k^2 \\hat{\\mathbf{u}}(\\mathbf{k}) + \\mathcal{P}_{\\mathbf{k}}(\\hat{\\mathbf{f}}(\\mathbf{k})) = \\mathbf{0}\n$$\nSolving for $\\hat{\\mathbf{u}}(\\mathbf{k})$ for $\\mathbf{k} \\neq \\mathbf{0}$ yields:\n$$\n\\hat{\\mathbf{u}}(\\mathbf{k}) = \\frac{1}{\\mu k^2} \\mathcal{P}_{\\mathbf{k}}(\\hat{\\mathbf{f}}(\\mathbf{k})) = \\frac{1}{\\mu k^2} \\left( \\hat{\\mathbf{f}}(\\mathbf{k}) - \\frac{\\hat{\\mathbf{f}}(\\mathbf{k}) \\cdot \\mathbf{k}}{k^2} \\mathbf{k} \\right)\n$$\nFor the zero-wavenumber mode $\\mathbf{k} = \\mathbf{0}$, which corresponds to the spatial average of the fields, the momentum equation reduces to $\\hat{\\mathbf{f}}(\\mathbf{0}) = \\mathbf{0}$. This condition, stating that the net force on the domain must be zero, is satisfied for a closed interface due to symmetry. The equation provides no information about the mean velocity $\\hat{\\mathbf{u}}(\\mathbf{0})$. For a static test, we assume the system is at rest on average, so we set $\\hat{\\mathbf{u}}(\\mathbf{0}) = \\mathbf{0}$.\n\n#### 2. Interfacial Force Calculation and Spreading\nThe force $\\mathbf{f}$ originates from surface tension $\\sigma$ acting on the circular interface of radius $R$. The continuum surface tension force is a line source given by $\\mathbf{F}_s = \\sigma \\kappa \\mathbf{n}$, where $\\kappa = 1/R$ is the curvature and $\\mathbf{n}$ is the outward normal vector.\n\nNumerically, this continuous force is discretized and spread onto the $N \\times N$ Eulerian grid. The interface is represented by $M$ Lagrangian markers $\\mathbf{X}_i$ for $i=0, \\dots, M-1$, with arc length $\\Delta s = 2\\pi R / M$ between them. Each marker contributes a force that is distributed to nearby grid points using a regularized two-dimensional delta function, $\\delta_{\\delta_h}$. The problem specifies an isotropic Gaussian:\n$$\n\\delta_{\\delta_h}(\\mathbf{r}) = \\frac{1}{\\pi \\delta_h^2}\\,\\exp\\left(-\\frac{\\lVert \\mathbf{r}\\rVert^2}{\\delta_h^2}\\right)\n$$\nThe force density at any grid point $\\mathbf{x}$ is the sum of contributions from all markers:\n$$\n\\mathbf{f}(\\mathbf{x}) = \\sum_{i=0}^{M-1} (\\sigma \\kappa \\mathbf{n}_i \\Delta s) \\, \\delta_{\\delta_h}(\\mathbf{x} - \\mathbf{X}_i)\n$$\nSubstituting $\\kappa=1/R$ and $\\Delta s = 2\\pi R / M$, the term in parenthesis becomes $(2\\pi\\sigma/M)\\mathbf{n}_i$. The distance vector $\\mathbf{r} = \\mathbf{x} - \\mathbf{X}_i$ is computed using the minimum-image convention on the periodic domain of side length $L=1$, ensuring each component lies in $[-0.5, 0.5]$.\n\n#### 3. Algorithm Summary\nThe complete algorithm is as follows:\n1.  **Initialization**: Define the Eulerian grid of size $N \\times N$ with grid spacing $h=L/N=1/N$. Define the $M$ Lagrangian markers on the circular interface.\n2.  **Force Spreading**: For each grid point $\\mathbf{x}_{jk}$, calculate the total force $\\mathbf{f}(\\mathbf{x}_{jk})$ by summing the contributions from all $M$ markers using the Gaussian delta function and periodic distances. This results in two $N \\times N$ arrays for the force components, $f_x$ and $f_y$.\n3.  **Forward FFT**: Compute the discrete Fourier transforms of $f_x$ and $f_y$ to obtain $\\hat{f}_x(\\mathbf{k})$ and $\\hat{f}_y(\\mathbf{k})$.\n4.  **Fourier-Space Solve**: For each wavevector $\\mathbf{k}$ in the discrete Fourier grid:\n    a. If $\\mathbf{k}=\\mathbf{0}$, set $\\hat{u}_x(\\mathbf{0})=0$ and $\\hat{u}_y(\\mathbf{0})=0$.\n    b. If $\\mathbf{k}\\neq\\mathbf{0}$, calculate $\\hat{\\mathbf{u}}(\\mathbf{k})$ using the derived expression involving the solenoidal projection of $\\hat{\\mathbf{f}}(\\mathbf{k})$.\n5.  **Inverse FFT**: Compute the inverse discrete Fourier transforms of $\\hat{u}_x(\\mathbf{k})$ and $\\hat{u}_y(\\mathbf{k})$ to obtain the real-space velocity components $u_x(\\mathbf{x})$ and $u_y(\\mathbf{x})$.\n6.  **Result**: Calculate the velocity magnitude $\\lVert \\mathbf{u}(\\mathbf{x}) \\rVert = \\sqrt{u_x^2(\\mathbf{x}) + u_y^2(\\mathbf{x})}$ at each grid point and find the maximum value over the entire domain. This value is the magnitude of the spurious current.\n\nThis procedure is repeated for each set of parameters provided in the test suite. The resulting maximum velocity magnitudes quantify the numerical error, which is expected to decrease with grid refinement (increasing $N$) and depend sensitively on the choice of the smoothing parameter $\\delta_h$.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_max_velocity(N, delta_h_over_h, R, mu, sigma, M):\n    \"\"\"\n    Computes the maximum spurious velocity for a static drop test using a \n    Fourier-spectral method for the Stokes equations.\n\n    Args:\n        N (int): Number of grid points in each dimension (N x N grid).\n        delta_h_over_h (float): Ratio of the smoothing width to the grid spacing.\n        R (float): Radius of the circular drop.\n        mu (float): Dynamic viscosity of the fluid.\n        sigma (float): Surface tension coefficient.\n        M (int): Number of Lagrangian markers on the interface.\n\n    Returns:\n        float: The maximum magnitude of the velocity field (spurious current).\n    \"\"\"\n    # 1. Grid and physical parameters setup\n    L = 1.0\n    h = L / N\n    delta_h = delta_h_over_h * h\n    \n    # Eulerian grid coordinates\n    grid_coords_1d = np.arange(N) * h\n    xx, yy = np.meshgrid(grid_coords_1d, grid_coords_1d, indexing='ij')\n\n    # 2. Interface representation\n    theta = np.linspace(0, 2 * np.pi, M, endpoint=False)\n    # Marker positions\n    Xi_x = 0.5 + R * np.cos(theta)\n    Xi_y = 0.5 + R * np.sin(theta)\n    # Outward normal vectors\n    ni_x = np.cos(theta)\n    ni_y = np.sin(theta)\n    \n    # 3. Force spreading\n    fx = np.zeros((N, N), dtype=float)\n    fy = np.zeros((N, N), dtype=float)\n    \n    # Pre-calculate constant factor for force spreading.\n    # The term sigma * kappa * ds for a marker is sigma * (1/R) * (2*pi*R/M) = 2*pi*sigma/M.\n    # The prefactor for the Gaussian delta function is 1/(pi*delta_h^2).\n    # The combined prefactor is (2*pi*sigma/M) * (1/(pi*delta_h^2)) = 2*sigma / (M*delta_h^2).\n    force_prefactor = 2 * sigma / (M * delta_h**2)\n    \n    for i in range(M):\n        # Compute wrapped distance from marker i to all grid points\n        dx = xx - Xi_x[i]\n        dy = yy - Xi_y[i]\n        \n        # Apply minimum image convention for periodic domain of L=1\n        dx -= np.round(dx)\n        dy -= np.round(dy)\n        \n        r_sq = dx**2 + dy**2\n        \n        # Evaluate the Gaussian delta function kernel\n        kernel = np.exp(-r_sq / delta_h**2)\n        \n        # Add the force contribution from marker i to the grid force field\n        fx += force_prefactor * ni_x[i] * kernel\n        fy += force_prefactor * ni_y[i] * kernel\n\n    # 4. Solve Stokes equations in Fourier space\n    # Take the 2D Fast Fourier Transform of the force field components\n    f_hat_x = np.fft.fft2(fx)\n    f_hat_y = np.fft.fft2(fy)\n    \n    # Create the grid of angular wavenumbers\n    k_freq = np.fft.fftfreq(N, d=h)\n    k_angular = 2 * np.pi * k_freq\n    kx, ky = np.meshgrid(k_angular, k_angular, indexing='ij')\n\n    k_sq = kx**2 + ky**2\n    \n    # To avoid division by zero at k=0, we compute the inverse of k^2 only where k is non-zero.\n    # The k=0 mode must be handled separately.\n    k_sq_inv = np.zeros_like(k_sq)\n    non_zero_k_mask = k_sq != 0\n    k_sq_inv[non_zero_k_mask] = 1.0 / k_sq[non_zero_k_mask]\n    \n    # Project the force field onto its solenoidal (divergence-free) part.\n    # This is done by subtracting the irrotational (curl-free) part: f_hat - (f_hat . k)k/k^2\n    f_hat_dot_k = f_hat_x * kx + f_hat_y * ky\n    \n    f_sol_x = f_hat_x - (f_hat_dot_k * kx * k_sq_inv)\n    f_sol_y = f_hat_y - (f_hat_dot_k * ky * k_sq_inv)\n    \n    # Solve for velocity in Fourier space: u_hat = f_sol / (mu * k^2)\n    u_hat_x = (1 / mu) * f_sol_x * k_sq_inv\n    u_hat_y = (1 / mu) * f_sol_y * k_sq_inv\n    # For k=0, k_sq_inv is 0, so u_hat(0,0) is correctly set to 0, satisfying the zero mean velocity condition.\n    \n    # Transform velocity back to real space using inverse FFT\n    ux = np.fft.ifft2(u_hat_x).real\n    uy = np.fft.ifft2(u_hat_y).real\n    \n    # 5. Compute the maximum velocity magnitude\n    vel_mag = np.sqrt(ux**2 + uy**2)\n    max_vel = np.max(vel_mag)\n    \n    return max_vel\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, delta_h/h, R, mu, sigma, M)\n        (32, 0.5, 0.25, 1.0, 1.0, 128),\n        (64, 1.0, 0.25, 1.0, 1.0, 256),\n        (64, 2.0, 0.25, 1.0, 1.0, 256),\n        (128, 2.0, 0.25, 1.0, 1.0, 512),\n        (64, 4.0, 0.25, 1.0, 1.0, 256),\n    ]\n\n    results = []\n    for params in test_cases:\n        max_v = calculate_max_velocity(*params)\n        results.append(f\"{max_v:.8e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}