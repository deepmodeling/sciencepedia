{
    "hands_on_practices": [
        {
            "introduction": "质量矩阵代表了 $L^2$ 内积的离散化，是求解时间依赖问题或进行数据投影的基础。本练习将演示如何通过精心选择求积点来实现质量矩阵的对角化，这一特性即所谓的“质量集中”(mass lumping)，它能极大地简化计算。通过练习，您将推导这一重要性质，并为一个具体算例计算出矩阵的各项。",
            "id": "4089553",
            "problem": "考虑一个在一维参考单元 $[-1,1]$ 上的问题，该单元用于计算复杂流体的高阶离散化，例如非连续伽辽金（DG）方法和谱元法（SEM）。令 $p$ 表示局部近似空间的多项式次数。对于定义在 $[-1,1]$ 上的函数 $f$ 和 $g$，连续 $L^{2}$ 内积定义为\n$$\n(f,g)_{L^{2}([-1,1])} = \\int_{-1}^{1} f(x)\\,g(x)\\,dx.\n$$\n为了构造一个对最高 $2p$ 次的多项式被积函数精确的离散内积，假设在 $[-1,1]$ 上有一个 $n$ 点求积法则 $(x_{k},w_{k})_{k=1}^{n}$，其节点为 $x_{k}$，正权重为 $w_{k}$，使得\n$$\n\\int_{-1}^{1} q(x)\\,dx = \\sum_{k=1}^{n} w_{k}\\,q(x_{k})\n$$\n对于每个次数至多为 $2p$ 的多项式 $q$ 都成立。考虑与插值节点 $\\{x_{i}\\}_{i=1}^{n}$ 相关联的 $p$ 次节点拉格朗日基 $\\{\\ell_{i}(x)\\}_{i=1}^{n}$，其中对于 $1 \\le i,j \\le n$ 有 $\\ell_{i}(x_{j}) = \\delta_{ij}$。\n\n从 $L^{2}$ 内积的定义和求积的精确性出发，推导出离散内积\n$$\n(f,g)_{h} \\equiv \\sum_{k=1}^{n} w_{k}\\,f(x_{k})\\,g(x_{k}),\n$$\n然后构造相应的单元质量矩阵 $M$，其元素为\n$$\nM_{ij} = (\\ell_{i},\\ell_{j})_{h}.\n$$\n证明在这些假设下，当求积节点与插值节点重合时，$M$ 是对角的。最后，在 $[-1,1]$ 上针对 $p=3$ 的情况，使用 $n=p+1=4$ 点的高斯-勒让德求积法则（该法则对最高 $2n-1=7 \\ge 2p$ 次的多项式是精确的）。以精确的封闭形式计算质量矩阵的四个对角元素，并按照节点在 $[-1,1]$ 上从左到右的顺序排列它们。\n\n提供精确值，不要四舍五入。使用 LaTeX 的 $\\texttt{pmatrix}$ 环境，将最终答案表示为一个行矩阵，顺序为 $\\{x_{1},x_{2},x_{3},x_{4}\\}$，其中在 $[-1,1]$ 上 $x_{1}  x_2  x_3  x_4$。",
            "solution": "该问题要求进行几项推导，并对一维参考单元 $[-1,1]$ 上的高阶数值方法进行一项具体计算。我们将按顺序解决问题的每个部分。\n\n首先，我们验证问题陈述的有效性。\n提取并分析所有给定条件。\n- 定义域：$[-1,1]$。\n- 多项式次数：$p$。\n- 连续内积：$(f,g)_{L^{2}([-1,1])} = \\int_{-1}^{1} f(x)\\,g(x)\\,dx$。\n- 求积法则：一个 $n$ 点法则 $(x_{k},w_{k})_{k=1}^{n}$，对次数至多为 $2p$ 的多项式精确。\n- 拉格朗日基：在 $n$ 个节点 $\\{x_i\\}$ 上的 $p$ 次基函数 $\\{\\ell_{i}(x)\\}_{i=1}^{n}$，满足 $\\ell_{i}(x_{j})=\\delta_{ij}$。为了由 $n$ 个节点值唯一定义一个 $p$ 次多项式，必须有 $n=p+1$。\n- 离散内积：$(f,g)_{h} = \\sum_{k=1}^{n} w_{k}\\,f(x_{k})\\,g(x_{k})$。\n- 质量矩阵：$M_{ij} = (\\ell_{i},\\ell_{j})_{h}$。\n- 特定情况：$p=3$，$n=p+1=4$ 点高斯-勒让德求积，对次数最高为 $2n-1=7$ 的多项式精确。\n\n该问题在科学上基于有限元法和谱方法理论。它提法良好、客观且内部一致。对于 $p$ 次节点基，$n=p+1$ 的关系是标准的。求积的精确性要求（$2p=6$）被所选的4点高斯-勒让德法则（精确到7次）满足。因此，该问题是有效的。\n\n第1部分：离散内积的推导\n两个基函数 $\\ell_i(x)$ 和 $\\ell_j(x)$ 的连续 $L^2$ 内积由下式给出\n$$\n(\\ell_i, \\ell_j)_{L^2} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x) dx.\n$$\n基函数 $\\{\\ell_i(x)\\}_{i=1}^{n}$ 是 $p=n-1$ 次多项式。因此，乘积 $\\ell_i(x)\\ell_j(x)$ 是一个次数至多为 $2p$ 的多项式。\n问题陈述我们使用一个对任意次数至多为 $2p$ 的多项式 $q(x)$ 都精确的求积法则：\n$$\n\\int_{-1}^{1} q(x)\\,dx = \\sum_{k=1}^{n} w_{k}\\,q(x_{k}).\n$$\n将此求积法则应用于被积函数 $\\ell_i(x)\\ell_j(x)$（这是一个次数至多为 $2p$ 的多项式），我们发现该积分可以被精确计算：\n$$\n(\\ell_i, \\ell_j)_{L^2} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x) dx = \\sum_{k=1}^{n} w_{k}\\,\\ell_i(x_{k})\\,\\ell_j(x_{k}).\n$$\n右侧的表达式正是在问题陈述中定义的离散内积 $(\\ell_i, \\ell_j)_{h}$。因此，当应用于基函数对时，这个离散内积被构造成连续 $L^2$ 内积的精确表示。\n\n第2部分：单元质量矩阵 $M$ 的构造\n单元质量矩阵 $M$ 的元素 $M_{ij}$ 由基函数的离散内积给出：\n$$\nM_{ij} = (\\ell_{i},\\ell_{j})_{h} = \\sum_{k=1}^{n} w_{k}\\,\\ell_{i}(x_{k})\\,\\ell_{j}(x_{k}).\n$$\n\n第3部分：证明 $M$ 是对角的\n问题增加了一个关键假设，即求积节点 $\\{x_k\\}_{k=1}^n$ 与插值节点 $\\{x_i\\}_{i=1}^n$ 重合。因此，我们可以（在适当排序后）令 $x_k=x_i$ 当 $k=i$。拉格朗日基的定义属性是其在插值节点上的值：$\\ell_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克δ符号。\n将此属性代入 $M_{ij}$ 的表达式中（求积节点 $\\{x_k\\}$ 与 $\\{x_j\\}$ 是同一集合）：\n$$\nM_{ij} = \\sum_{k=1}^{n} w_{k}\\,\\ell_{i}(x_{k})\\,\\ell_{j}(x_{k}).\n$$\n和中的项是 $\\ell_{i}(x_{k})\\ell_{j}(x_{k})$ 形式的乘积。属性 $\\ell_i(x_k)=\\delta_{ik}$ 意味着如果 $k=i$，$\\ell_i(x_k)$ 为 $1$，否则为 $0$。类似地，$\\ell_j(x_k)=\\delta_{jk}$。\n$M_{ij}$ 的表达式变为：\n$$\nM_{ij} = \\sum_{k=1}^{n} w_{k}\\,\\delta_{ik}\\,\\delta_{jk}.\n$$\n如果 $i \\neq j$，那么对于任何给定的索引 $k$，不可能同时有 $k=i$ 和 $k=j$。因此，乘积 $\\delta_{ik}\\delta_{jk}$ 总是零。这使得求和中的每一项都为零，所以当 $i \\neq j$ 时，$M_{ij} = 0$。\n如果 $i = j$，表达式变为：\n$$\nM_{ii} = \\sum_{k=1}^{n} w_{k}\\,\\delta_{ik}\\,\\delta_{ik} = \\sum_{k=1}^{n} w_{k}\\,(\\delta_{ik})^2.\n$$\n由于 $\\delta_{ik}$ 不是 $0$ 就是 $1$，所以 $(\\delta_{ik})^2 = \\delta_{ik}$。\n$$\nM_{ii} = \\sum_{k=1}^{n} w_{k}\\,\\delta_{ik}.\n$$\n这个和只有一个非零项，出现在 $k=i$ 时。该项的值是 $w_i \\cdot 1 = w_i$。\n因此，质量矩阵的元素为 $M_{ij} = w_i \\delta_{ij}$。这表明 $M$ 是一个对角矩阵，其对角线上的元素是求积权重：$M = \\text{diag}(w_1, w_2, \\ldots, w_n)$。\n\n第4部分：计算 $p=3$ 时的对角元素\n我们具体研究多项式次数为 $p=3$ 的情况。基由 $n=p+1=4$ 个拉格朗日多项式组成。使用的求积法则是4点高斯-勒让德求积。节点 $\\{x_k\\}$ 是4次勒让德多项式 $P_4(x)$ 的根。质量矩阵的对角元素是相应的求积权重，$M_{ii} = w_i$。\n\n节点 $x_k$ 是 $P_4(x) = \\frac{1}{8}(35x^4 - 30x^2 + 3)$ 的根。令 $P_4(x)=0$ 得到 $35x^4 - 30x^2 + 3 = 0$。设 $y=x^2$。关于 $y$ 的二次方程是 $35y^2 - 30y + 3 = 0$，其解为\n$$\ny = \\frac{30 \\pm \\sqrt{30^2 - 4(35)(3)}}{2(35)} = \\frac{30 \\pm \\sqrt{900-420}}{70} = \\frac{30 \\pm \\sqrt{480}}{70}.\n$$\n由于 $\\sqrt{480} = \\sqrt{16 \\times 30} = 4\\sqrt{30}$，我们有\n$$\ny = x^2 = \\frac{30 \\pm 4\\sqrt{30}}{70} = \\frac{15 \\pm 2\\sqrt{30}}{35}.\n$$\n四个节点从左到右排序为 $x_1  x_2  x_3  x_4$：\n$x_{1,4} = \\mp\\sqrt{\\frac{15+2\\sqrt{30}}{35}}$ （外部节点）和 $x_{2,3} = \\mp\\sqrt{\\frac{15-2\\sqrt{30}}{35}}$ （内部节点）。\n\n高斯-勒让德权重 $w_k$ 可以使用公式 $w_k = \\frac{2}{(1-x_k^2)[P_n'(x_k)]^2}$ 计算。对于 $n=4$，我们有 $P_4'(x) = \\frac{1}{8}(140x^3-60x) = \\frac{5x}{2}(7x^2-3)$。\n可以推导出一个更方便的权重公式。由于 $y_k=x_k^2$ 是 $35y^2-30y+3=0$ 的根，我们可以表示 $y^2 = (30y-3)/35$。这导出了恒等式 $w_k = \\frac{1}{15(y_k - y_k^2)}$。\n我们有 $y_k - y_k^2 = y_k - \\frac{30y_k-3}{35} = \\frac{35y_k - 30y_k + 3}{35} = \\frac{5y_k+3}{35}$。\n所以，权重由以下简单表达式给出：\n$$\nw_k = \\frac{1}{15 \\left( \\frac{5y_k+3}{35} \\right)} = \\frac{35}{15(5y_k+3)} = \\frac{7}{3(5y_k+3)}.\n$$\n我们现在计算两个不同的权重值。对于外部节点 $x_1, x_4$，我们使用 $y_{outer} = \\frac{15+2\\sqrt{30}}{35}$：\n$$\nw_{outer} = \\frac{7}{3\\left(5\\left(\\frac{15+2\\sqrt{30}}{35}\\right)+3\\right)} = \\frac{7}{3\\left(\\frac{15+2\\sqrt{30}}{7}+3\\right)} = \\frac{7}{3\\left(\\frac{15+2\\sqrt{30}+21}{7}\\right)} = \\frac{49}{3(36+2\\sqrt{30})} = \\frac{49}{6(18+\\sqrt{30})}.\n$$\n分母有理化：\n$$\nw_{outer} = \\frac{49(18-\\sqrt{30})}{6(18+\\sqrt{30})(18-\\sqrt{30})} = \\frac{49(18-\\sqrt{30})}{6(18^2 - 30)} = \\frac{49(18-\\sqrt{30})}{6(324 - 30)} = \\frac{49(18-\\sqrt{30})}{6(294)} = \\frac{49(18-\\sqrt{30})}{6(6 \\times 49)} = \\frac{18-\\sqrt{30}}{36}.\n$$\n对于内部节点 $x_2, x_3$，我们使用 $y_{inner} = \\frac{15-2\\sqrt{30}}{35}$：\n$$\nw_{inner} = \\frac{7}{3\\left(5\\left(\\frac{15-2\\sqrt{30}}{35}\\right)+3\\right)} = \\frac{7}{3\\left(\\frac{15-2\\sqrt{30}}{7}+3\\right)} = \\frac{7}{3\\left(\\frac{15-2\\sqrt{30}+21}{7}\\right)} = \\frac{49}{3(36-2\\sqrt{30})} = \\frac{49}{6(18-\\sqrt{30})}.\n$$\n分母有理化：\n$$\nw_{inner} = \\frac{49(18+\\sqrt{30})}{6(18-\\sqrt{30})(18+\\sqrt{30})} = \\frac{49(18+\\sqrt{30})}{6(18^2-30)} = \\frac{49(18+\\sqrt{30})}{6(294)} = \\frac{18+\\sqrt{30}}{36}.\n$$\n质量矩阵的对角元素是这些权重，按节点 $x_1  x_2  x_3  x_4$ 的顺序排列。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{18-\\sqrt{30}}{36}  \\frac{18+\\sqrt{30}}{36}  \\frac{18+\\sqrt{30}}{36}  \\frac{18-\\sqrt{30}}{36} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "现实世界的问题需要在复杂几何上进行离散，这通常通过将一个简单的参考单元（如正方形）映射到物理空间中的弯曲单元来实现。本练习探讨了雅可比矩阵在转换微分算子（如梯度）中的关键作用。掌握这种坐标变换对于将间断伽辽金或谱元法应用于任何超出简单矩形域的问题至关重要。",
            "id": "4089509",
            "problem": "考虑一个用于计算复杂流体的高阶间断 Galerkin (DG) 和谱元法 (SEM) 离散化中的二维曲线等参映射。设参考单元为方形区域 $[-1,1] \\times [-1,1]$，其坐标为 $\\boldsymbol{\\xi} = (\\xi,\\eta)$，物理坐标为 $\\boldsymbol{x} = (x,y)$，由光滑映射 $\\boldsymbol{x} = \\boldsymbol{X}(\\boldsymbol{\\xi})$ 给出，其分量为：\n$$\nx(\\xi,\\eta) = \\xi + \\frac{1}{5}\\,\\eta + \\frac{1}{10}\\,\\xi\\,\\eta + \\frac{1}{20}\\,(1 - \\xi^{2}) + \\frac{1}{12}\\,\\eta^{2},\n$$\n$$\ny(\\xi,\\eta) = \\frac{3}{10}\\,\\xi + \\eta + \\frac{3}{25}\\,\\xi\\,\\eta + \\frac{7}{100}\\,\\xi^{2} - \\frac{1}{20}\\,(1 - \\eta^{2}).\n$$\n设 $\\phi(\\xi,\\eta)$ 是一个由 Legendre 多项式构造的张量积谱基函数，具体为：\n$$\n\\phi(\\xi,\\eta) = L_{2}(\\xi)\\,L_{3}(\\eta),\n$$\n其中 $L_{2}(\\xi) = \\frac{1}{2}\\,(3\\xi^{2} - 1)$ 且 $L_{3}(\\eta) = \\frac{1}{2}\\,(5\\eta^{3} - 3\\eta)$。\n\n仅从多变量链式法则和映射的雅可比矩阵的定义出发，完成以下任务：\n\n1. 在映射 $\\boldsymbol{X}(\\boldsymbol{\\xi})$ 下，推导将标量场的参考梯度 $\\nabla_{\\boldsymbol{\\xi}}$ 映射到其物理梯度 $\\nabla_{\\boldsymbol{x}}$ 的算子。您的推导必须从第一性原理出发，展示该变换是如何产生的，并且必须明确指出雅可比矩阵及其逆转置的作用，不得引用任何预先给定的变换公式。\n\n2. 使用您的结果，计算在参考点 $(\\xi,\\eta) = \\left(\\frac{1}{2}, -\\frac{1}{3}\\right)$ 处的物理梯度 $\\nabla_{\\boldsymbol{x}} \\phi$。将您的最终答案表示为精确有理数。\n\n使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境，以行向量的形式给出物理梯度的最终结果。无需四舍五入，也不涉及物理单位。",
            "solution": "该问题经验证是适定的、有科学依据且自洽的。它是偏微分方程计算方法框架下的一个标准问题，特别是关于有限元法和谱方法中所需的几何变换。因此，我们可以开始求解。\n\n该问题分为两部分：第一部分，从第一性原理推导梯度变换算子；第二部分，应用该算子计算一个具体的物理梯度。\n\n**第一部分：梯度变换算子的推导**\n\n设 $u$ 是一个定义在物理域上的标量场，其在点 $\\boldsymbol{x}=(x,y)$ 处的值为 $u(\\boldsymbol{x})$。映射 $\\boldsymbol{x} = \\boldsymbol{X}(\\boldsymbol{\\xi})$ 提供了物理坐标 $\\boldsymbol{x}$ 和参考坐标 $\\boldsymbol{\\xi}=(\\xi,\\eta)$ 之间的关系。基函数 $\\phi(\\boldsymbol{\\xi})$ 定义在参考单元上。我们考虑标量场 $u(\\boldsymbol{x})$，其在参考单元上的表示为 $\\phi(\\boldsymbol{\\xi})$，即 $u(\\boldsymbol{X}(\\boldsymbol{\\xi})) = \\phi(\\boldsymbol{\\xi})$。我们旨在用参考梯度 $\\nabla_{\\boldsymbol{\\xi}} \\phi = \\begin{pmatrix} \\partial \\phi / \\partial \\xi \\\\ \\partial \\phi / \\partial \\eta \\end{pmatrix}$ 来表示物理梯度 $\\nabla_{\\boldsymbol{x}} u = \\begin{pmatrix} \\partial u / \\partial x \\\\ \\partial u / \\partial y \\end{pmatrix}$。为简化记法（这是该领域的常见做法），我们将 $\\nabla_{\\boldsymbol{x}}u$ 记为 $\\nabla_{\\boldsymbol{x}}\\phi$。\n\n推导从多变量链式法则开始。$\\phi$ 关于参考坐标 $\\xi$ 和 $\\eta$ 的偏导数可以用 $u$ 关于物理坐标 $x$ 和 $y$ 的偏导数来表示：\n$$\n\\frac{\\partial \\phi}{\\partial \\xi} = \\frac{\\partial u}{\\partial x} \\frac{\\partial x}{\\partial \\xi} + \\frac{\\partial u}{\\partial y} \\frac{\\partial y}{\\partial \\xi}\n$$\n$$\n\\frac{\\partial \\phi}{\\partial \\eta} = \\frac{\\partial u}{\\partial x} \\frac{\\partial x}{\\partial \\eta} + \\frac{\\partial u}{\\partial y} \\frac{\\partial y}{\\partial \\eta}\n$$\n这是一个关于物理梯度的未知分量 $\\frac{\\partial u}{\\partial x}$ 和 $\\frac{\\partial u}{\\partial y}$ 的二元线性方程组。我们可以将该方程组写成矩阵形式：\n$$\n\\begin{pmatrix} \\frac{\\partial \\phi}{\\partial \\xi} \\\\ \\frac{\\partial \\phi}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial u}{\\partial x} \\\\ \\frac{\\partial u}{\\partial y} \\end{pmatrix}\n$$\n左边的向量是参考梯度 $\\nabla_{\\boldsymbol{\\xi}} \\phi$。最右边的向量是物理梯度 $\\nabla_{\\boldsymbol{x}} u$。中间的矩阵是坐标变换 $\\boldsymbol{X}(\\boldsymbol{\\xi})$ 的雅可比矩阵的转置。雅可比矩阵 $\\boldsymbol{J}$ 定义为：\n$$\n\\boldsymbol{J} = \\frac{\\partial\\boldsymbol{x}}{\\partial\\boldsymbol{\\xi}} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n其转置为：\n$$\n\\boldsymbol{J}^T = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n因此，梯度之间的关系为：\n$$\n\\nabla_{\\boldsymbol{\\xi}} \\phi = \\boldsymbol{J}^T \\nabla_{\\boldsymbol{x}} \\phi\n$$\n为了求得物理梯度，我们必须对此关系求逆。假设雅可比行列式非零，则矩阵 $\\boldsymbol{J}^T$ 是可逆的。我们可以用 $(\\boldsymbol{J}^T)^{-1}$ 左乘：\n$$\n\\nabla_{\\boldsymbol{x}} \\phi = (\\boldsymbol{J}^T)^{-1} \\nabla_{\\boldsymbol{\\xi}} \\phi\n$$\n该方程定义了将参考梯度映射到物理梯度的算子。该算子就是乘以映射的雅可比矩阵的逆转置。至此，从第一性原理出发的推导完成。\n\n**第二部分：物理梯度的计算**\n\n现在我们将此结果应用于问题中给出的具体函数和点。\n\n首先，我们通过对映射函数求导来计算雅可比矩阵 $\\boldsymbol{J}$ 的分量：\n$x(\\xi,\\eta) = \\xi + \\frac{1}{5}\\,\\eta + \\frac{1}{10}\\,\\xi\\,\\eta + \\frac{1}{20}\\,(1 - \\xi^{2}) + \\frac{1}{12}\\,\\eta^{2}$\n$y(\\xi,\\eta) = \\frac{3}{10}\\,\\xi + \\eta + \\frac{3}{25}\\,\\xi\\,\\eta + \\frac{7}{100}\\,\\xi^{2} - \\frac{1}{20}\\,(1 - \\eta^{2})$\n\n偏导数是：\n$J_{11} = \\frac{\\partial x}{\\partial \\xi} = 1 + \\frac{1}{10}\\eta - \\frac{1}{10}\\xi$\n$J_{12} = \\frac{\\partial x}{\\partial \\eta} = \\frac{1}{5} + \\frac{1}{10}\\xi + \\frac{1}{6}\\eta$\n$J_{21} = \\frac{\\partial y}{\\partial \\xi} = \\frac{3}{10} + \\frac{3}{25}\\eta + \\frac{7}{50}\\xi$\n$J_{22} = \\frac{\\partial y}{\\partial \\eta} = 1 + \\frac{3}{25}\\xi + \\frac{1}{10}\\eta$\n\n接下来，我们在指定的参考点 $(\\xi,\\eta) = \\left(\\frac{1}{2}, -\\frac{1}{3}\\right)$ 计算这些分量的值：\n$J_{11} = 1 + \\frac{1}{10}(-\\frac{1}{3}) - \\frac{1}{10}(\\frac{1}{2}) = 1 - \\frac{1}{30} - \\frac{1}{20} = \\frac{60 - 2 - 3}{60} = \\frac{55}{60} = \\frac{11}{12}$\n$J_{12} = \\frac{1}{5} + \\frac{1}{10}(\\frac{1}{2}) + \\frac{1}{6}(-\\frac{1}{3}) = \\frac{1}{5} + \\frac{1}{20} - \\frac{1}{18} = \\frac{36 + 9 - 10}{180} = \\frac{35}{180} = \\frac{7}{36}$\n$J_{21} = \\frac{3}{10} + \\frac{3}{25}(-\\frac{1}{3}) + \\frac{7}{50}(\\frac{1}{2}) = \\frac{3}{10} - \\frac{1}{25} + \\frac{7}{100} = \\frac{30 - 4 + 7}{100} = \\frac{33}{100}$\n$J_{22} = 1 + \\frac{3}{25}(\\frac{1}{2}) + \\frac{1}{10}(-\\frac{1}{3}) = 1 + \\frac{3}{50} - \\frac{1}{30} = \\frac{150 + 9 - 5}{150} = \\frac{154}{150} = \\frac{77}{75}$\n\n因此，在该点的雅可比矩阵为 $\\boldsymbol{J} = \\begin{pmatrix} \\frac{11}{12}  \\frac{7}{36} \\\\ \\frac{33}{100}  \\frac{77}{75} \\end{pmatrix}$。\n\n雅可比行列式为：\n$\\det(\\boldsymbol{J}) = (\\frac{11}{12})(\\frac{77}{75}) - (\\frac{7}{36})(\\frac{33}{100}) = \\frac{847}{900} - \\frac{231}{3600} = \\frac{4 \\cdot 847 - 231}{3600} = \\frac{3388 - 231}{3600} = \\frac{3157}{3600}$。\n由于行列式非零，逆矩阵存在。\n\n变换需要 $(\\boldsymbol{J}^T)^{-1} = (\\boldsymbol{J}^{-1})^T$。我们首先求 $\\boldsymbol{J}^{-1}$：\n$\\boldsymbol{J}^{-1} = \\frac{1}{\\det(\\boldsymbol{J})} \\begin{pmatrix} J_{22}  -J_{12} \\\\ -J_{21}  J_{11} \\end{pmatrix} = \\frac{3600}{3157} \\begin{pmatrix} \\frac{77}{75}  -\\frac{7}{36} \\\\ -\\frac{33}{100}  \\frac{11}{12} \\end{pmatrix}$。\n因此，逆转置为：\n$(\\boldsymbol{J}^T)^{-1} = (\\boldsymbol{J}^{-1})^T = \\frac{3600}{3157} \\begin{pmatrix} \\frac{77}{75}  -\\frac{33}{100} \\\\ -\\frac{7}{36}  \\frac{11}{12} \\end{pmatrix}$。\n\n接下来，我们计算 $\\phi(\\xi,\\eta) = L_{2}(\\xi)\\,L_{3}(\\eta)$ 的参考梯度：\n梯度的分量为 $\\frac{\\partial \\phi}{\\partial \\xi} = L_{2}'(\\xi)\\,L_{3}(\\eta)$ 和 $\\frac{\\partial \\phi}{\\partial \\eta} = L_{2}(\\xi)\\,L_{3}'(\\eta)$。\n$L_{2}(\\xi) = \\frac{1}{2}(3\\xi^2 - 1) \\implies L_{2}'(\\xi) = 3\\xi$\n$L_{3}(\\eta) = \\frac{1}{2}(5\\eta^3 - 3\\eta) \\implies L_{3}'(\\eta) = \\frac{1}{2}(15\\eta^2 - 3)$\n\n在 $(\\xi,\\eta) = (\\frac{1}{2}, -\\frac{1}{3})$ 处计算这些函数及其导数的值：\n$L_{2}(\\frac{1}{2}) = \\frac{1}{2}(3(\\frac{1}{2})^2 - 1) = \\frac{1}{2}(\\frac{3}{4} - 1) = -\\frac{1}{8}$\n$L_{2}'(\\frac{1}{2}) = 3(\\frac{1}{2}) = \\frac{3}{2}$\n$L_{3}(-\\frac{1}{3}) = \\frac{1}{2}(5(-\\frac{1}{3})^3 - 3(-\\frac{1}{3})) = \\frac{1}{2}(-\\frac{5}{27} + 1) = \\frac{1}{2}(\\frac{22}{27}) = \\frac{11}{27}$\n$L_{3}'(-\\frac{1}{3}) = \\frac{1}{2}(15(-\\frac{1}{3})^2 - 3) = \\frac{1}{2}(\\frac{15}{9} - 3) = \\frac{1}{2}(\\frac{5}{3} - \\frac{9}{3}) = \\frac{1}{2}(-\\frac{4}{3}) = -\\frac{2}{3}$\n\n现在计算参考梯度的分量：\n$\\frac{\\partial \\phi}{\\partial \\xi} = L_{2}'(\\frac{1}{2})\\,L_{3}(-\\frac{1}{3}) = (\\frac{3}{2})(\\frac{11}{27}) = \\frac{33}{54} = \\frac{11}{18}$\n$\\frac{\\partial \\phi}{\\partial \\eta} = L_{2}(\\frac{1}{2})\\,L_{3}'(-\\frac{1}{3}) = (-\\frac{1}{8})(-\\frac{2}{3}) = \\frac{2}{24} = \\frac{1}{12}$\n参考梯度为 $\\nabla_{\\boldsymbol{\\xi}} \\phi = \\begin{pmatrix} 11/18 \\\\ 1/12 \\end{pmatrix}$。\n\n最后，我们计算物理梯度 $\\nabla_{\\boldsymbol{x}} \\phi = (\\boldsymbol{J}^T)^{-1} \\nabla_{\\boldsymbol{\\xi}} \\phi$：\n$$\n\\nabla_{\\boldsymbol{x}} \\phi = \\frac{3600}{3157} \\begin{pmatrix} \\frac{77}{75}  -\\frac{33}{100} \\\\ -\\frac{7}{36}  \\frac{11}{12} \\end{pmatrix} \\begin{pmatrix} \\frac{11}{18} \\\\ \\frac{1}{12} \\end{pmatrix}\n$$\nx-分量是：\n$(\\nabla_{\\boldsymbol{x}} \\phi)_x = \\frac{3600}{3157} \\left( (\\frac{77}{75})(\\frac{11}{18}) - (\\frac{33}{100})(\\frac{1}{12}) \\right) = \\frac{3600}{3157} \\left( \\frac{847}{1350} - \\frac{33}{1200} \\right) = \\frac{3600}{3157} \\left( \\frac{847}{1350} - \\frac{11}{400} \\right)$\n$1350$ 和 $400$ 的公分母是 $10800$。\n$(\\nabla_{\\boldsymbol{x}} \\phi)_x = \\frac{3600}{3157} \\left( \\frac{847 \\cdot 8}{10800} - \\frac{11 \\cdot 27}{10800} \\right) = \\frac{3600}{3157} \\frac{6776 - 297}{10800} = \\frac{3600}{10800} \\frac{6479}{3157} = \\frac{1}{3} \\frac{6479}{3157}$。\n我们注意到因子分解 $6479 = 11 \\cdot 19 \\cdot 31$ 和 $3157 = 7 \\cdot 11 \\cdot 41$。\n$(\\nabla_{\\boldsymbol{x}} \\phi)_x = \\frac{1}{3} \\frac{11 \\cdot 19 \\cdot 31}{7 \\cdot 11 \\cdot 41} = \\frac{19 \\cdot 31}{3 \\cdot 7 \\cdot 41} = \\frac{589}{861}$。\n\ny-分量是：\n$(\\nabla_{\\boldsymbol{x}} \\phi)_y = \\frac{3600}{3157} \\left( -(\\frac{7}{36})(\\frac{11}{18}) + (\\frac{11}{12})(\\frac{1}{12}) \\right) = \\frac{3600}{3157} \\left( -\\frac{77}{648} + \\frac{11}{144} \\right)$\n$648$ 和 $144$ 的公分母是 $1296$。\n$(\\nabla_{\\boldsymbol{x}} \\phi)_y = \\frac{3600}{3157} \\left( \\frac{-77 \\cdot 2}{1296} + \\frac{11 \\cdot 9}{1296} \\right) = \\frac{3600}{3157} \\frac{-154 + 99}{1296} = \\frac{3600}{1296} \\frac{-55}{3157}$。\n简化前置因子：$\\frac{3600}{1296} = \\frac{100 \\cdot 36}{36 \\cdot 36} = \\frac{100}{36} = \\frac{25}{9}$。\n$(\\nabla_{\\boldsymbol{x}} \\phi)_y = \\frac{25}{9} \\frac{-55}{3157} = -\\frac{1375}{9 \\cdot 3157}$。\n使用因子分解 $1375 = 11 \\cdot 125$ 和 $3157 = 7 \\cdot 11 \\cdot 41$：\n$(\\nabla_{\\boldsymbol{x}} \\phi)_y = -\\frac{11 \\cdot 125}{9 \\cdot 7 \\cdot 11 \\cdot 41} = -\\frac{125}{9 \\cdot 7 \\cdot 41} = -\\frac{125}{2583}$。\n\n在指定点的物理梯度是一个向量，其分量为这两个值。\n$\\nabla_{\\boldsymbol{x}} \\phi = \\left(\\frac{589}{861}, -\\frac{125}{2583}\\right)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{589}{861}  -\\frac{125}{2583} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "高阶方法在解决大型三维问题中的可行性取决于其计算效率。本练习研究了使用“和因子分解”或张量积方法来应用算子所带来的性能优势，并将其与组装和使用大型稠密矩阵的传统方法进行比较。通过分析计算成本，您将量化高阶方法所带来的显著加速，正是这种加速使其成为复杂流体模拟的实用工具。",
            "id": "4089482",
            "problem": "考虑计算复杂流体中动量方程的粘性扩散项，该项在单个六面体单元上使用高阶张量积基进行离散。设单元映射为仿射映射，粘度在空间上为常数，因此在参考坐标系中，通过高斯-洛巴托-勒让德求积和拉格朗日插值，弱形式刚度算子可以表示为三个张量积项之和。具体来说，对于每个坐标方向的多项式次数 $p$，令 $n = p+1$ 表示一维方向上的节点数，令 $D \\in \\mathbb{R}^{n \\times n}$ 为一维导数矩阵，$W \\in \\mathbb{R}^{n \\times n}$ 为一维求积权重的对角矩阵。那么，在标准强对称谱元实现中，三维刚度算子作用于节点值 $u \\in \\mathbb{R}^{n \\times n \\times n}$ 的形式如下：\n$$\nA u \\;=\\; \\left(D^{\\top} \\otimes I \\otimes I\\right)\\left(W \\otimes W \\otimes W\\right)\\left(D \\otimes I \\otimes I\\right) u \\;+\\; \\left(I \\otimes D^{\\top} \\otimes I\\right)\\left(W \\otimes W \\otimes W\\right)\\left(I \\otimes D \\otimes I\\right) u \\;+\\; \\left(I \\otimes I \\otimes D^{\\top}\\right)\\left(W \\otimes W \\otimes W\\right)\\left(I \\otimes I \\otimes D\\right) u,\n$$\n其中 $I \\in \\mathbb{R}^{n \\times n}$ 是单位矩阵，$\\otimes$ 表示克罗内克积。假设在一个浮点运算（flop）模型中，每次标量乘法或加法计为 1 flop，并忽略内存传输和系数预计算的成本。\n\n仅使用此张量积结构和高阶谱元求值的第一性原理，推导通过求和分解（张量积求值）将算子 $A$ 应用于此单个六面体单元上的节点向量 $u$ 所需的总浮点运算次数。然后，推导使用大小为 $N \\times N$（其中 $N = n^{3}$）的预组装稠密刚度矩阵，通过朴素的稠密矩阵乘法应用相同算子所需的浮点运算次数。最后，给出朴素稠密矩阵乘法浮点运算次数与张量积浮点运算次数之比 $R(p)$ 的简化符号表达式，该表达式仅以 $p$ 为函数。\n\n你的最终答案必须是这个比率 $R(p)$，作为一个单一的封闭形式解析表达式。不需要进行数值计算，也不允许四舍五入。",
            "solution": "用户希望我解决一个问题。\n\n### 第1步：提取已知条件\n-   **背景**：计算复杂流体中单个六面体单元上的粘性扩散。\n-   **离散化**：高阶张量积基，仿射单元映射，恒定粘度。\n-   **多项式次数**：$p$。\n-   **每维节点数**：$n = p+1$。\n-   **一维导数矩阵**：$D \\in \\mathbb{R}^{n \\times n}$。\n-   **一维求积权重矩阵**：$W \\in \\mathbb{R}^{n \\times n}$，对角矩阵。\n-   **单位矩阵**：$I \\in \\mathbb{R}^{n \\times n}$。\n-   **克罗内克积**：$\\otimes$。\n-   **节点值向量**：$u \\in \\mathbb{R}^{n \\times n \\times n}$。\n-   **刚度算子作用**：三维刚度算子 $A$ 作用于 $u$ 的形式为：\n    $$\n    A u \\;=\\; \\left(D^{\\top} \\otimes I \\otimes I\\right)\\left(W \\otimes W \\otimes W\\right)\\left(D \\otimes I \\otimes I\\right) u \\;+\\; \\left(I \\otimes D^{\\top} \\otimes I\\right)\\left(W \\otimes W \\otimes W\\right)\\left(I \\otimes D \\otimes I\\right) u \\;+\\; \\left(I \\otimes I \\otimes D^{\\top}\\right)\\left(W \\otimes W \\otimes W\\right)\\left(I \\otimes I \\otimes D\\right) u\n    $$\n-   **Flop模型**：每次标量乘法或加法计为1次浮点运算（flop）。忽略内存传输和预计算成本。\n-   **任务1**：基于所提供的结构，使用求和分解（张量积求值）推导将 $A$ 应用于 $u$ 的总浮点运算次数。\n-   **任务2**：通过朴素的稠密矩阵乘法应用 $A$ 推导所需的浮点运算次数，其中 $A$ 是一个预组装的 $N \\times N$ 矩阵，且 $N = n^{3}$。\n-   **任务3**：提供朴素稠密矩阵乘法浮点运算次数与张量积浮点运算次数之比 $R(p)$ 的简化符号表达式，作为 $p$ 的函数。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题设置在偏微分方程数值方法这一成熟领域内，特别是谱元法。算子定义对应于张量积网格上拉普拉斯算子的强形式，这是该领域的标准构造。克罗内克积、求和分解和浮点运算计数是数值线性代数和科学计算中的标准概念。\n-   **适定性**：该问题要求基于一组清晰的定义和指定的计算过程，推导两种浮点运算次数及其比率。这些任务在数学上是明确定义的，并能导出一个唯一的解析解。\n-   **客观性**：语言精确，使用标准的数学和计算术语。没有主观或模糊的陈述。\n\n该问题是自洽的、科学上合理的且适定的。未发现任何缺陷。\n\n### 第3步：结论与行动\n该问题是**有效的**。将提供完整解答。\n\n### 解题推导\n\n该问题要求对应用刚度算子 $A$ 的两种方法进行比较分析。我们将首先推导每种方法的运算成本（浮点运算次数），然后计算它们的比率。\n\n**1. 张量积求值（求和分解）的浮点运算次数**\n\n算子 $A$ 是三项之和，我们可以表示为 $A_x$、$A_y$ 和 $A_z$：\n$$A u = A_x u + A_y u + A_z u$$\n总浮点运算次数，我们称之为 $Flop_{SF}$，是计算每一项所需的浮点运算次数与将结果相加所需的浮点运算次数之和。\n\n让我们分析计算 $y_x = A_x u$ 的成本，其中\n$$y_x = \\left(D^{\\top} \\otimes I \\otimes I\\right)\\left(W \\otimes W \\otimes W\\right)\\left(D \\otimes I \\otimes I\\right) u$$\n该表达式的求值从右到左按一系列算子应用的顺序进行。向量 $u$ 表示 $n \\times n \\times n$ 网格上的节点值。\n\n-   **第1步：应用 $D \\otimes I \\otimes I$**\n    算子 $D \\otimes I \\otimes I$ 沿 $n \\times n \\times n$ 数据数组 $u$ 的第一个维度应用 $n \\times n$ 矩阵 $D$。这相当于执行 $n \\times n = n^2$ 次独立的矩阵向量乘积，形式为 $D v$，其中 $v$ 是一个长度为 $n$ 的向量。\n    单个稠密的 $n \\times n$ 矩阵与向量相乘的浮点运算次数为 $n^2$ 次乘法和 $n(n-1)$ 次加法，总计 $n^2 + n(n-1) = 2n^2 - n$ flops。\n    由于这对第一个维度中的 $n^2$ 个“列”中的每一个都执行一次，此步骤的总浮点运算次数为：\n    $$Flop_1 = n^2 (2n^2 - n) = 2n^4 - n^3$$\n\n-   **第2步：应用 $W \\otimes W \\otimes W$**\n    矩阵 $W$ 是对角矩阵。因此，克罗内克积 $W \\otimes W \\otimes W$ 也是一个大小为 $n^3 \\times n^3$ 的对角矩阵。将对角矩阵应用于向量涉及逐点相乘。第1步得到的向量有 $n^3$ 个元素。\n    此步骤的总浮点运算次数为 $n^3$ 次乘法：\n    $$Flop_2 = n^3$$\n\n-   **第3步：应用 $D^{\\top} \\otimes I \\otimes I$**\n    此步骤与第1步类似，但使用的是矩阵 $D^{\\top}$。由于 $D^{\\top}$ 也是一个一般的 $n \\times n$ 矩阵，应用它的成本与应用 $D$ 相同。该算子作用于第2步得到的 $n^3$ 维向量。这涉及 $n^2$ 次矩阵向量乘积。\n    此步骤的总浮点运算次数为：\n    $$Flop_3 = n^2 (2n^2 - n) = 2n^4 - n^3$$\n\n计算 $y_x = A_x u$ 的总成本是这三个步骤成本的总和：\n$$Flop(A_x u) = Flop_1 + Flop_2 + Flop_3 = (2n^4 - n^3) + n^3 + (2n^4 - n^3) = 4n^4 - n^3$$\n由于算子 $A$ 的对称结构，计算 $A_y u$ 和 $A_z u$ 的成本是相同的：\n$$Flop(A_y u) = Flop(A_z u) = 4n^4 - n^3$$\n\n-   **第4步：求和结果**\n    最后，我们必须将三个结果向量相加：$y_x + y_y + y_z$。每个向量有 $n^3$ 个元素。这需要两次向量加法。\n    两次 $n^3$ 元素向量加法的浮点运算次数为：\n    $$Flop_{add} = 2n^3$$\n求和分解方法的总浮点运算次数为：\n$$Flop_{SF} = Flop(A_x u) + Flop(A_y u) + Flop(A_z u) + Flop_{add}$$\n$$Flop_{SF} = 3(4n^4 - n^3) + 2n^3 = 12n^4 - 3n^3 + 2n^3 = 12n^4 - n^3$$\n\n**2. 朴素稠密矩阵乘法的浮点运算次数**\n\n在这种方法中，算子 $A$ 首先被组装成一个大小为 $N \\times N$ 的单一稠密矩阵，其中 $N = n^3$。算子的应用则是一个单一的矩阵向量乘积 $A u$。\n将一个 $N \\times N$ 的稠密矩阵与一个 $N$ 维向量相乘的浮点运算次数为 $N^2$ 次乘法和 $N(N-1)$ 次加法。\n$$Flop_{dense} = N^2 + N(N-1) = 2N^2 - N$$\n代入 $N = n^3$：\n$$Flop_{dense} = 2(n^3)^2 - n^3 = 2n^6 - n^3$$\n\n**3. 浮点运算次数之比**\n\n问题要求朴素稠密矩阵乘法浮点运算次数与张量积浮点运算次数之比 $R(p)$。我们首先求出比率 $R(n)$ 作为 $n$ 的函数。\n$$R(n) = \\frac{Flop_{dense}}{Flop_{SF}} = \\frac{2n^6 - n^3}{12n^4 - n^3}$$\n我们可以从分子和分母中提出公因式 $n^3$：\n$$R(n) = \\frac{n^3(2n^3 - 1)}{n^3(12n - 1)} = \\frac{2n^3 - 1}{12n - 1}$$\n问题要求比率作为多项式次数 $p$ 的函数，其中 $n = p+1$。我们将 $n=p+1$ 代入 $R(n)$ 的表达式中：\n$$R(p) = \\frac{2(p+1)^3 - 1}{12(p+1) - 1}$$\n现在，我们展开这些项。分子是：\n$$2(p+1)^3 - 1 = 2(p^3 + 3p^2 + 3p + 1) - 1 = 2p^3 + 6p^2 + 6p + 2 - 1 = 2p^3 + 6p^2 + 6p + 1$$\n分母是：\n$$12(p+1) - 1 = 12p + 12 - 1 = 12p + 11$$\n结合这些，比率 $R(p)$ 的最终表达式是：\n$$R(p) = \\frac{2p^3 + 6p^2 + 6p + 1}{12p + 11}$$",
            "answer": "$$\\boxed{\\frac{2p^{3} + 6p^{2} + 6p + 1}{12p + 11}}$$"
        }
    ]
}