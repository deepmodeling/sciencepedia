{
    "hands_on_practices": [
        {
            "introduction": "Steered Molecular Dynamics (SMD) is a powerful technique for probing energy landscapes by pulling on a molecule. However, the work you measure is not always the free energy change you seek, as it includes energy stored in the virtual spring used for pulling. This first-principles exercise guides you through deriving the precise relationship between measured work and the underlying potential of mean force in an idealized, reversible scenario, building your intuition for how to correctly interpret SMD results. ",
            "id": "3856253",
            "problem": "In a steered molecular dynamics protocol used to probe a one-dimensional reaction coordinate $x$ within a biomolecular complex, the underlying potential of mean force (PMF) near the region of interest is well-approximated by a harmonic form $U_{0}(x) = \\frac{a}{2}\\,x^{2}$, with curvature $a$ known from an independent equilibrium calculation. During pulling, a harmonic bias (the “spring”) of stiffness $k$ is applied, with center $\\lambda(t)$ translated at a constant speed from $\\lambda(0)=0$ to $\\lambda(\\tau)=L$. The total Hamiltonian is $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$. The measured pulling work $W_{\\mathrm{meas}}$ is defined as the time integral of the protocol work, $W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$. Assume that the pulling is sufficiently slow that the process is effectively reversible (quasi-static) and the system remains at temperature $T$ (canonical ensemble).\n\nUsing only fundamental statistical mechanics definitions of canonical free energy $F(\\lambda)=-k_{B}T\\ln Z(\\lambda)$ and the definition of protocol work $W=\\int_{0}^{\\tau}(\\partial H/\\partial t)\\,dt=\\int_{0}^{\\tau}(\\partial H/\\partial \\lambda)\\,\\dot{\\lambda}\\,dt$, and without invoking any specialized “shortcut” formulas, do the following:\n\n- Explain how a stiff spring (large $k$) changes the measured work by coupling the system to a moving restraint, and show that in the quasi-static limit $W_{\\mathrm{meas}}$ equals the free energy difference between the coupled Hamiltonians at $\\lambda=0$ and $\\lambda=L$.\n- Derive, by evaluating the canonical partition function $Z(\\lambda)$ for the coupled Hamiltonian, the functional form of $F(\\lambda)$ and hence the analytic expression for the quasi-static measured work $W_{\\mathrm{meas}}$ between $\\lambda=0$ and $\\lambda=L$ in terms of $a$, $k$, and $L$.\n- From first principles, devise a correction that converts this coupled-system free energy difference into the underlying physical PMF difference $\\Delta G_{\\mathrm{phys}}=G(L)-G(0)$ associated with $U_{0}(x)$ alone, and express $\\Delta G_{\\mathrm{phys}}$ in closed form in terms of $a$, $k$, and $W_{\\mathrm{meas}}$.\n\nThen, using your derived correction, compute the numerical value of the corrected physical free energy difference for the following parameter set, representative of a ligand translation in a protein tunnel:\n- Molecular PMF curvature $a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$,\n- Spring stiffness $k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$,\n- Pulling displacement $L = 0.2\\,\\mathrm{nm}$,\n- Reversible measured work obtained by averaging many slow pulls $W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$.\n\nExpress the final energy as a single real number in $\\mathrm{kJ\\,mol^{-1}}$ and round your answer to four significant figures.",
            "solution": "The problem has been validated and is a well-posed, scientifically sound query in the field of computational chemical biology. We will proceed with a full derivation and solution.\n\nThe problem asks for a multi-part analysis of a steered molecular dynamics (SMD) simulation in the quasi-static (reversible) limit. We will address each part in sequence using the provided definitions and first principles of statistical mechanics.\n\nFirst, we address the relationship between measured work and free energy. The total Hamiltonian of the coupled system is $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$, where $\\lambda$ is the time-dependent control parameter. The canonical free energy of this coupled system is defined as $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$, where $Z(\\lambda)$ is the partition function for a given $\\lambda$:\n$$Z(\\lambda) = C \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\nHere, $C$ represents a constant factor arising from the kinetic energy (momentum integral), which is independent of $\\lambda$ and will not affect free energy differences. The change in free energy with respect to the control parameter $\\lambda$ is given by the derivative:\n$$\\frac{dF}{d\\lambda} = \\frac{d}{d\\lambda}\\left(-k_{B}T\\ln Z(\\lambda)\\right) = -k_{B}T \\frac{1}{Z(\\lambda)} \\frac{dZ(\\lambda)}{d\\lambda}$$\nThe derivative of the partition function is:\n$$\\frac{dZ(\\lambda)}{d\\lambda} = C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\nSubstituting this back, we find:\n$$\\frac{dF}{d\\lambda} = -k_{B}T \\frac{1}{Z(\\lambda)} \\left[ C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx \\right]$$\n$$\\frac{dF}{d\\lambda} = \\frac{C \\int \\frac{\\partial H}{\\partial \\lambda} \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx}{C \\int \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx} = \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle$$\nThis demonstrates that the derivative of the free energy with respect to the control parameter is equal to the canonical ensemble average of the generalized force conjugate to that parameter.\n\nThe work done on the system, as defined in the problem, is $W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$. In a quasi-static process, the system is always in equilibrium at the instantaneous value of $\\lambda(t)$. Therefore, the fluctuating instantaneous force $\\frac{\\partial H}{\\partial \\lambda}$ can be replaced by its ensemble average $\\langle \\frac{\\partial H}{\\partial \\lambda} \\rangle$. The work integral becomes:\n$$W_{\\mathrm{meas}} = \\int_{0}^{\\tau} \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle \\dot{\\lambda}\\,dt = \\int_{0}^{\\tau} \\frac{dF}{d\\lambda} \\frac{d\\lambda}{dt} dt = \\int_{\\lambda(0)}^{\\lambda(\\tau)} dF$$\nGiven the limits $\\lambda(0)=0$ and $\\lambda(\\tau)=L$, the quasi-static work is exactly the free energy difference of the coupled system between its final and initial states:\n$$W_{\\mathrm{meas}} = F(L) - F(0)$$\nA stiff spring (large $k$) enhances the coupling between the system coordinate $x$ and the trap center $\\lambda$. The potential term $\\frac{k}{2}(x-\\lambda)^2$ penalizes deviations of $x$ from $\\lambda$. As $k \\to \\infty$, the particle is forced to track the trap center, i.e., $x(t) \\to \\lambda(t)$. The measured work reflects the energy change of this tightly coupled system, which is distinct from the energy change of the unperturbed system $U_0(x)$.\n\nNext, we derive the functional form of $F(\\lambda)$ and the expression for $W_{\\mathrm{meas}}$. We start by rewriting the Hamiltonian $H(x;\\lambda)$ by completing the square with respect to $x$:\n$$H(x;\\lambda) = \\frac{a}{2}x^2 + \\frac{k}{2}(x^2 - 2x\\lambda + \\lambda^2) = \\frac{a+k}{2}x^2 - k\\lambda x + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x^2 - \\frac{2k\\lambda}{a+k}x\\right) + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left[\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\left(\\frac{k\\lambda}{a+k}\\right)^2\\right] + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\frac{k^2\\lambda^2}{2(a+k)} + \\frac{k(a+k)\\lambda^2}{2(a+k)}$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 + \\frac{ak}{2(a+k)}\\lambda^2$$\nThe partition function $Z(\\lambda)$ is then:\n$$Z(\\lambda) = C \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{a+k}{2k_{B}T}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2\\right) dx$$\nThe integral is a standard Gaussian integral, which evaluates to $\\sqrt{\\frac{2\\pi k_{B}T}{a+k}}$.\n$$Z(\\lambda) = C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}} \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right)$$\nThe free energy $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$ is:\n$$F(\\lambda) = -k_{B}T\\ln\\left(C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}}\\right) + \\frac{ak}{2(a+k)}\\lambda^2$$\nThe first term is a constant with respect to $\\lambda$. Let's denote it $F_{\\text{ref}}$.\n$$F(\\lambda) = F_{\\text{ref}} + \\frac{ak}{2(a+k)}\\lambda^2$$\nUsing this functional form, the quasi-static work $W_{\\mathrm{meas}} = F(L) - F(0)$ is:\n$$W_{\\mathrm{meas}} = \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}L^2\\right) - \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}0^2\\right)$$\n$$W_{\\mathrm{meas}} = \\frac{ak}{2(a+k)}L^2$$\n\nNow, we devise a correction to obtain the physical PMF difference $\\Delta G_{\\mathrm{phys}} = G(L) - G(0)$. The physical PMF is $G(x) = U_0(x) = \\frac{a}{2}x^2$. The desired quantity is:\n$$\\Delta G_{\\mathrm{phys}} = G(L) - G(0) = \\frac{a}{2}L^2 - 0 = \\frac{a}{2}L^2$$\nThe measured work $W_{\\mathrm{meas}}$ reflects pulling on a composite system. The system (spring constant $a$) and the biasing spring (constant $k$) act like two springs in series. The effective spring constant of such a system is $k_{\\text{eff}} = \\left(\\frac{1}{a} + \\frac{1}{k}\\right)^{-1} = \\frac{ak}{a+k}$. The work measured, $W_{\\mathrm{meas}} = \\frac{k_{\\text{eff}}}{2}L^2$, is the energy to extend this composite spring system by a distance $L$. Our goal, $\\Delta G_{\\mathrm{phys}}$, is the energy that would be stored in the physical spring *alone* if it were extended by the same distance $L$.\nWe can establish a direct relationship:\n$$\\frac{\\Delta G_{\\mathrm{phys}}}{W_{\\mathrm{meas}}} = \\frac{\\frac{a}{2}L^2}{\\frac{ak}{2(a+k)}L^2} = \\frac{a(a+k)}{ak} = \\frac{a+k}{k} = 1 + \\frac{a}{k}$$\nThus, we can express the physical free energy difference in terms of the measured work and the known system parameters $a$ and $k$:\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{a}{k}\\right) W_{\\mathrm{meas}}$$\nThis is the required correction. It scales the measured free energy of the coupled system to find the free energy of the underlying physical system. The correction factor $1 + \\frac{a}{k}$ is always greater than $1$, indicating that the measured work in this setup always underestimates the true free energy barrier being probed, because some of the pulling work goes into deforming the harmonic restraint itself.\n\nFinally, we compute the numerical value of $\\Delta G_{\\mathrm{phys}}$ using the provided data:\n$a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$\n\nUsing the derived correction formula:\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}{1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}\\right) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = (1 + 0.25) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 1.25 \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 5.000\\,\\mathrm{kJ\\,mol^{-1}}$$\nThe result is to be rounded to four significant figures. The calculated value is $5.000$.",
            "answer": "$$\\boxed{5.000}$$"
        },
        {
            "introduction": "Moving from idealized pulling to real-world applications, we now tackle the complete calculation of a ligand's binding free energy. This practice integrates the Jarzynski equality with the power of thermodynamic cycles to compute a standard-state binding affinity from alchemical decoupling simulations. You will implement the full workflow, from processing raw non-equilibrium work data to applying the necessary corrections, translating theoretical principles into a functional computational tool. ",
            "id": "3856267",
            "problem": "You will design a program that computes a physically meaningful binding free energy for a ligand using an alchemical decoupling protocol analyzed by non-equilibrium work relations. The system is a ligand interacting either with a macromolecular binding site or with bulk solvent. The ligand is decoupled (its interactions are turned off) by changing a coupling parameter that controls the Hamiltonian from a fully interacting value to a non-interacting value under a thermostatted dynamics. The underlying physical base is that the canonical ensemble quantifies equilibrium free energies and that non-equilibrium work over many realizations can recover equilibrium free-energy differences when work is defined consistently with the manipulated Hamiltonian. Your program must use this base to derive and implement the estimator, paying careful attention to signs and the definition of binding through a thermodynamic cycle. All energies must be handled as per-mole quantities.\n\nFundamental base you must start from:\n- The canonical ensemble free energy for a parameterized Hamiltonian $H(\\mathbf{x},\\lambda)$: $G(\\lambda) = - R T \\ln Z(\\lambda)$ with $Z(\\lambda) = \\int \\exp\\big(-\\beta H(\\mathbf{x},\\lambda)\\big) \\, d\\mathbf{x}$, where $R$ is the ideal gas constant per mole, $T$ is temperature, and $\\beta = 1/(R T)$.\n- Work $W$ along a non-equilibrium manipulation of the parameter $\\lambda$ is the mechanical work performed by changing the Hamiltonian parameter, accumulated along the trajectory, consistent with the inclusive definition for a thermostatted ensemble. The values provided are realizations of this work in $\\mathrm{kJ\\,mol^{-1}}$ for completing the protocol from fully interacting to non-interacting.\n- Binding is defined via a closed thermodynamic cycle that includes decoupling the ligand in the complex, decoupling the ligand in solvent, and a restraint attachment step that confines a non-interacting ligand to a binding-site reference geometry to enforce the standard concentration $c^{\\circ} = 1\\,\\mathrm{mol\\,L^{-1}}$. The restraint term is provided directly as a per-mole free-energy cost of attaching restraints to a non-interacting ligand at the binding site, so that your program can include the standard-state correction consistently.\n\nYour task:\n- Derive, from the canonical ensemble and the definition of non-equilibrium work applied to $H(\\mathbf{x},\\lambda)$, the correct estimator that maps a set of non-equilibrium work values for decoupling into an equilibrium free-energy difference for each decoupling step.\n- Establish the correct sign convention for binding based on a closed thermodynamic cycle that includes: decoupling in the complex, decoupling in solvent, and restraint attachment. Ensure the restraint term is included in the correct direction to reference the standard state.\n- Implement the resulting estimator in your program to compute the binding free energy for each test case.\n\nUnits and output requirements:\n- All energies are in $\\mathrm{kJ\\,mol^{-1}}$.\n- Temperatures are in $\\mathrm{K}$.\n- Use $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ and convert appropriately to $\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$ when needed.\n- Your program must produce a single line of output containing a comma-separated list of the binding free energies for all test cases, rounded to three decimals, enclosed in square brackets. For example, the output format must be exactly like $[x_1,x_2,x_3]$.\n\nTest suite:\n- Case 1 (general case):\n  - Temperature: $300.0\\,\\mathrm{K}$\n  - Complex decoupling work values (fully interacting $\\rightarrow$ non-interacting): $[24.2,26.5,23.7,25.1,27.8,24.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values (fully interacting $\\rightarrow$ non-interacting): $[8.9,10.2,9.5,11.3,8.7,9.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy (non-interacting ligand confined to binding site, standard-state consistent): $6.2\\,\\mathrm{kJ\\,mol^{-1}}$\n- Case 2 (boundary condition: zero-variance work):\n  - Temperature: $298.15\\,\\mathrm{K}$\n  - Complex decoupling work values: $[20.0,20.0,20.0,20.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values: $[6.0,6.0,6.0,6.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy: $6.0\\,\\mathrm{kJ\\,mol^{-1}}$\n- Case 3 (edge case: higher temperature and broader distributions):\n  - Temperature: $310.0\\,\\mathrm{K}$\n  - Complex decoupling work values: $[18.0,22.5,20.1,19.7,21.3,17.9,24.0,16.5]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values: $[12.0,14.5,13.8,15.2,13.0,14.1]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy: $4.0\\,\\mathrm{kJ\\,mol^{-1}}$\n\nFinal specification:\n- Implement numerically stable averaging for exponentials of work to obtain decoupling free energies from the provided work realizations and temperatures.\n- Combine the decoupling free energies with the restraint attachment free energy according to the correct binding-cycle sign convention to produce the binding free energy in $\\mathrm{kJ\\,mol^{-1}}$ for each case.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, rounded to three decimals, exactly: $[x_1,x_2,x_3]$.",
            "solution": "The problem requires the computation of the standard binding free energy, $\\Delta G_{bind}^{\\circ}$, for a ligand-receptor system using data from non-equilibrium alchemical simulations. The solution involves two principal components: first, the application of Jarzynski's equality to estimate equilibrium free energy differences from non-equilibrium work values; and second, the construction of a thermodynamic cycle to relate these free energy differences to the binding affinity.\n\nThe foundational principle is the relationship between the Helmholtz or Gibbs free energy ($G$) and the canonical partition function ($Z$) for a system with a Hamiltonian $H(\\mathbf{x}, \\lambda)$ that depends on a set of coordinates $\\mathbf{x}$ and a coupling parameter $\\lambda$. For a system in thermal equilibrium with a heat bath at temperature $T$, the free energy is given by:\n$$ G(\\lambda) = -k_B T \\ln Z(\\lambda) $$\nwhere $k_B$ is the Boltzmann constant and $\\beta = 1/(k_B T)$. The partition function is an integral over all accessible microstates:\n$$ Z(\\lambda) = \\int e^{-\\beta H(\\mathbf{x}, \\lambda)} \\, d\\mathbf{x} $$\nSince the problem specifies energies in per-mole quantities (e.g., $\\mathrm{kJ\\,mol^{-1}}$), we replace the Boltzmann constant $k_B$ with the ideal gas constant $R$, and $\\beta$ is defined as $\\beta = 1/(RT)$.\n$$ G(\\lambda) = -RT \\ln Z(\\lambda) $$\n\nThe free energy difference $\\Delta G$ between two states defined by $\\lambda = \\lambda_A$ and $\\lambda = \\lambda_B$ is:\n$$ \\Delta G = G(\\lambda_B) - G(\\lambda_A) $$\nWhile this difference can be computed through equilibrium methods, the problem provides data from non-equilibrium trajectories. Jarzynski's equality provides the theoretical bridge between the work, $W$, performed on the system during a non-equilibrium transformation from state $\\lambda_A$ to $\\lambda_B$ and the equilibrium free energy difference $\\Delta G$. The equality states:\n$$ \\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta G} $$\nHere, the angle brackets $\\langle \\cdot \\rangle$ denote an average over an ensemble of an infinite number of non-equilibrium trajectories. Solving for $\\Delta G$ yields:\n$$ \\Delta G = -\\frac{1}{\\beta} \\ln \\langle e^{-\\beta W} \\rangle = -RT \\ln \\langle e^{-\\beta W} \\rangle $$\nIn practice, the average is estimated from a finite sample of $N$ work measurements, $W_1, W_2, \\dots, W_N$:\n$$ \\langle e^{-\\beta W} \\rangle \\approx \\frac{1}{N} \\sum_{i=1}^{N} e^{-\\beta W_i} $$\nSubstituting this estimator into the expression for $\\Delta G$, we obtain the formula to be implemented for calculating the free energy of decoupling:\n$$ \\Delta G_{\\text{decouple}} = -RT \\ln \\left( \\frac{1}{N} \\sum_{i=1}^{N} e^{-W_i/(RT)} \\right) $$\nThe direct computation of this expression can be numerically unstable due to floating-point limitations when the arguments of the exponential function are large and negative. A stable method involves recognizing that the expression is equivalent to:\n$$ \\Delta G_{\\text{decouple}} = -RT \\left( \\text{logsumexp}(-W_i/(RT)) - \\ln(N) \\right) $$\nwhere the `logsumexp` function computes the logarithm of the sum of exponentials in a way that prevents underflow and overflow. This is the estimator we will use.\n\nNext, we establish the thermodynamic cycle to calculate the standard binding free energy, $\\Delta G_{bind}^{\\circ}$. The process of binding is $P + L \\rightarrow P:L$, where $P$ is the protein, $L$ is the ligand, and $P:L$ is the complex. The states in our cycle are:\n1. $P:L$ (solvated complex)\n2. $P + L$ (solvated protein and ligand, separated)\n3. $P:L^*$ (complex with a non-interacting \"ghost\" ligand $L^*$)\n4. $P + L^*$ (separated protein and ghost ligand)\n\nThe cycle connects these states with four processes:\n(a) $P:L \\rightarrow P + L$: The unbinding of the ligand, with free energy change $\\Delta G_{unbind} = -\\Delta G_{bind}^{\\circ}$.\n(b) $P:L \\rightarrow P:L^*$: The decoupling of the ligand within the binding site. The free energy change is $\\Delta G_{decouple,complex}$, calculated from the complex decoupling work values.\n(c) $P+L \\rightarrow P+L^*$: The decoupling of the free ligand in solvent. Since the protein is a spectator, this is effectively $L \\rightarrow L^*$. The free energy change is $\\Delta G_{decouple,solvent}$, calculated from the solvent decoupling work values.\n(d) $P:L^* \\rightarrow P+L^*$: The release of the non-interacting ligand from the binding site into the bulk solvent, transitioning to the standard state concentration. The free energy for the reverse process (attaching the restraints to a free non-interacting ligand) is given as $\\Delta G_{restraint}$. Therefore, the free energy change for this release process is $-\\Delta G_{restraint}$.\n\nAs free energy is a state function, the sum of free energy changes around a closed cycle must be zero. Traversing the cycle $P+L \\rightarrow P:L \\rightarrow P:L^* \\rightarrow P+L^* \\rightarrow P+L$:\n$$ (\\Delta G_{bind}^{\\circ}) + (\\Delta G_{decouple,complex}) + (-\\Delta G_{restraint}) + (-\\Delta G_{decouple,solvent}) = 0 $$\nSolving for the standard binding free energy, $\\Delta G_{bind}^{\\circ}$:\n$$ \\Delta G_{bind}^{\\circ} = \\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex} + \\Delta G_{restraint} $$\nThis is the final expression to be implemented. A favorable binding event corresponds to a negative $\\Delta G_{bind}^{\\circ}$. Let us verify the signs. The decoupling free energies are positive costs. Typically, interactions in the complex are stronger than in the solvent, making $\\Delta G_{decouple,complex} > \\Delta G_{decouple,solvent}$. This results in a negative contribution $(\\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex})$ to binding. The restraint free energy, $\\Delta G_{restraint}$, is the entropic cost of confining the ligand to the binding site and is a positive quantity, making binding less favorable. The signs in the derived equation are therefore physically consistent.\n\nThe calculation proceeds by first computing $\\Delta G_{decouple,complex}$ and $\\Delta G_{decouple,solvent}$ for each test case using the Jarzynski estimator and then combining them with the provided $\\Delta G_{restraint}$ value according to the derived thermodynamic cycle equation. The gas constant $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ must be converted to $0.00831446261815324\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$ to match the units of the provided work values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Computes the binding free energy for a ligand using an alchemical decoupling\n    protocol and non-equilibrium work relations (Jarzynski's equality).\n    \"\"\"\n\n    # Define the gas constant in the required units.\n    # R is given in J mol^-1 K^-1. Work values are in kJ mol^-1.\n    # We convert R to kJ mol^-1 K^-1.\n    R_J_MOL_K = 8.31446261815324\n    R_KJ_MOL_K = R_J_MOL_K / 1000.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"temperature\": 300.0,\n            \"complex_work\": [24.2, 26.5, 23.7, 25.1, 27.8, 24.9],\n            \"solvent_work\": [8.9, 10.2, 9.5, 11.3, 8.7, 9.9],\n            \"restraint_dg\": 6.2,\n        },\n        {\n            \"temperature\": 298.15,\n            \"complex_work\": [20.0, 20.0, 20.0, 20.0],\n            \"solvent_work\": [6.0, 6.0, 6.0, 6.0],\n            \"restraint_dg\": 6.0,\n        },\n        {\n            \"temperature\": 310.0,\n            \"complex_work\": [18.0, 22.5, 20.1, 19.7, 21.3, 17.9, 24.0, 16.5],\n            \"solvent_work\": [12.0, 14.5, 13.8, 15.2, 13.0, 14.1],\n            \"restraint_dg\": 4.0,\n        },\n    ]\n\n    results = []\n\n    def calculate_delta_g_decouple(work_values: list[float], temp: float) -> float:\n        \"\"\"\n        Calculates the free energy difference from non-equilibrium work values\n        using Jarzynski's equality in a numerically stable way.\n        \n        Args:\n            work_values: A list of work values in kJ/mol.\n            temp: The temperature in Kelvin.\n            \n        Returns:\n            The estimated free energy difference in kJ/mol.\n        \"\"\"\n        work_array = np.array(work_values, dtype=np.float64)\n        num_trajectories = len(work_array)\n        \n        # RT term, also known as beta_inv, in kJ/mol\n        beta_inv = R_KJ_MOL_K * temp\n        \n        # When all work values are the same, the process is quasi-static,\n        # and Delta G = W. This avoids potential precision issues with the\n        # exponential average for this specific boundary condition.\n        if np.all(work_array == work_array[0]):\n            return work_array[0]\n            \n        # Exponents for Jarzynski's equality: -W / (RT)\n        exponents = -work_array / beta_inv\n        \n        # Calculate log of the ensemble average of exp(-beta*W)\n        # log(<exp(-beta*W)>) = log( (1/N) * sum(exp(-beta*W_i)) )\n        #                     = log(sum(exp(-beta*W_i))) - log(N)\n        # We use scipy.special.logsumexp for numerical stability.\n        log_avg_exp = logsumexp(exponents) - np.log(num_trajectories)\n        \n        # Delta G = -RT * log(<exp(-beta*W)>)\n        delta_g = -beta_inv * log_avg_exp\n        \n        return delta_g\n\n    for case in test_cases:\n        temp = case[\"temperature\"]\n        \n        # Calculate free energy of decoupling in the complex\n        dg_decouple_complex = calculate_delta_g_decouple(case[\"complex_work\"], temp)\n        \n        # Calculate free energy of decoupling in the solvent\n        dg_decouple_solvent = calculate_delta_g_decouple(case[\"solvent_work\"], temp)\n        \n        # Retrieve the restraint free energy\n        dg_restraint = case[\"restraint_dg\"]\n        \n        # Apply the thermodynamic cycle formula:\n        # dG_bind = dG_decouple,solvent - dG_decouple,complex + dG_restraint\n        dg_bind = dg_decouple_solvent - dg_decouple_complex + dg_restraint\n        \n        # Round the final result to three decimal places\n        results.append(round(dg_bind, 3))\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A robust computational result relies on a physically sound simulation. The Crooks Fluctuation Theorem offers more than a path to free energies; it provides a rigorous framework for validating your simulation methodology. This exercise challenges you to think like a detective, using the theorem's predictions to design consistency checks that can expose subtle but critical violations of microscopic reversibility in your dynamics engine, ensuring your results are built on a solid foundation. ",
            "id": "3856285",
            "problem": "A computational chemical biology laboratory is building non-equilibrium protocols to estimate binding free energy differences between two alchemical states of a ligand in a protein pocket. The system is equilibrated at temperature $T$ under a canonical distribution before each switching, and the control parameter $\\lambda$ is driven from $\\lambda = 0$ to $\\lambda = 1$ in the forward process and from $\\lambda = 1$ to $\\lambda = 0$ in the reverse process, over a fixed schedule of duration $\\tau$. For each realization, the mechanical work $W$ performed on the system along the driven trajectory is recorded. Two Molecular Dynamics (MD) setups are considered:\n\n- Setup $1$: A time-reversible, symplectic integrator and a thermostat known to sample the canonical distribution with local detailed balance.\n- Setup $2$: A non-symmetric integrator and a non-equilibrium thermostat that regulates kinetic energy deterministically, potentially breaking detailed balance.\n\nAssume that microscopic reversibility means that, for the time-reversed version of the forward protocol (including identical step ordering and noise statistics), the probabilities of observing a trajectory and its time reverse satisfy a well-defined symmetry consistent with detailed balance in equilibrium. Also assume that in the canonical ensemble at fixed $T$, the equilibrium free energy difference $\\Delta F$ between $\\lambda = 0$ and $\\lambda = 1$ is a state function determined by the partition functions of the end states, independent of the path. The work distributions of the forward and reverse protocols are denoted $P_F(W)$ and $P_R(W)$, respectively, and the forward and reverse protocols are designed to be identical except for time reversal.\n\nThe research team wants to detect violations of microreversibility in MD setups using consistency checks derived from the Crooks Fluctuation Theorem (CFT) framework, without relying on any a priori knowledge of the target formulas. They have access to large samples of forward and reverse work values $W$, to equilibrium reference estimates of $\\Delta F$ obtained from separate long equilibrium simulations, and to the ability to reconstruct histograms $P_F(W)$ and $P_R(W)$ under both setups.\n\nWhich of the following checks are valid CFT-based diagnostics that would reliably flag violations of microreversibility in Setup $2$ when applied to the measured work statistics under the described protocols, and why?\n\nA. Regress the function $R(W) \\equiv \\ln\\!\\big(P_F(W)/P_R(-W)\\big)$ against $W$; under microreversibility, the relationship between $R(W)$ and $W$ should be linear with slope equal to the inverse thermal energy $\\beta \\equiv 1/(k_B T)$ and with an intercept set by the equilibrium free energy difference. A statistically significant deviation of the fitted slope from $\\beta$ indicates a violation.\n\nB. Identify the crossing point $W^\\star$ at which $P_F(W^\\star) = P_R(-W^\\star)$; under microreversibility, this crossing must occur at the equilibrium $\\Delta F$. A statistically significant mismatch between $W^\\star$ and the independently estimated $\\Delta F$ indicates a violation.\n\nC. Evaluate the integral fluctuation identity connecting the exponential average of the forward work to the equilibrium free energy difference; under microreversibility, the equality holds exactly. If the measured exponential average from the forward work deviates from the equilibrium reference beyond sampling uncertainty, this indicates a violation.\n\nD. Verify only that the inequality $\\langle W \\rangle_F \\ge \\Delta F$ is satisfied for the forward protocol; if the inequality holds, conclude that microreversibility is not violated.\n\nE. Confirm that the reverse protocol differs from the time reverse of the forward protocol in thermostat parameters and integration step ordering; if differences are present, conclude that microreversibility holds because the end states are identical and only the path differs.\n\nF. Compute the Kullback–Leibler divergence $D_{\\mathrm{KL}}\\!\\big(P_F(W)\\,\\Vert\\,P_R(-W)\\big) \\equiv \\int dW\\, P_F(W)\\,\\ln\\!\\big(P_F(W)/P_R(-W)\\big)$ and compare it to the mean dissipated work scaled by $\\beta$, namely $\\beta\\,\\big(\\langle W \\rangle_F - \\Delta F\\big)$; under microreversibility, these two quantities are equal. A statistically significant difference between them indicates a violation.\n\nSelect all options that are valid CFT-based diagnostics as described. Here, $k_B$ is the Boltzmann constant, $\\beta \\equiv 1/(k_B T)$, angle brackets denote averages over the specified ensemble, and $D_{\\mathrm{KL}}$ denotes the Kullback–Leibler divergence.",
            "solution": "The problem requires identifying valid diagnostic tests for violations of microscopic reversibility in a molecular dynamics simulation, based on the framework of the Crooks Fluctuation Theorem (CFT). The CFT provides a powerful relationship between the work distributions of a forward process and its time-reversed counterpart.\n\nA non-equilibrium process is considered, where a system is driven from an initial equilibrium state (at $\\lambda=0$) to a final state (at $\\lambda=1$) over a finite time $\\tau$. The system is described by a Hamiltonian $H(x, p; \\lambda)$ that depends on the control parameter $\\lambda$, where $(x, p)$ represents the phase space coordinates. The forward process follows a protocol $\\lambda(t)$ for $t \\in [0, \\tau]$, and the reverse process follows the time-reversed protocol $\\lambda(\\tau-t)$.\n\nThe core assumptions for the CFT are:\n$1$. The forward process starts from a system configuration drawn from the canonical equilibrium distribution at $\\lambda=0$, given by $p_{eq}(x, p; \\lambda=0) = Z_0^{-1} e^{-\\beta H(x, p; \\lambda=0)}$, where $Z_0$ is the partition function.\n$2$. The reverse process starts from a system configuration drawn from the canonical equilibrium distribution at $\\lambda=1$, given by $p_{eq}(x, p; \\lambda=1) = Z_1^{-1} e^{-\\beta H(x, p; \\lambda=1)}$.\n$3$. The microscopic dynamics governing the system's evolution are microscopically reversible, meaning they obey the principle of detailed balance. For stochastic dynamics, this implies a specific symmetry for the transition probabilities between states.\n$4$. The work $W$ is the mechanical work performed on the system, defined as $W = \\int_0^\\tau \\frac{\\partial H}{\\partial \\lambda} \\frac{d\\lambda}{dt} dt$.\n\nUnder these assumptions, the CFT states:\n$$ \\frac{P_F(W)}{P_R(-W)} = e^{\\beta (W - \\Delta F)} $$\nwhere $P_F(W)$ is the work distribution for the forward process, $P_R(W)$ is the work distribution for the reverse process, $\\Delta F = F_1 - F_0$ is the equilibrium free energy difference between the end states, and $\\beta = 1/(k_B T)$. The free energy is related to the partition function by $F_\\lambda = -k_B T \\ln Z_\\lambda$.\n\nSetup $1$ is described as satisfying these conditions, while Setup $2$ might violate the microscopic reversibility condition (assumption $3$). The task is to find which of the proposed checks can reliably detect this violation by testing the consequences of the CFT.\n\n**Option A: Regress the function $R(W) \\equiv \\ln\\!\\big(P_F(W)/P_R(-W)\\big)$ against $W$; under microreversibility, the relationship between $R(W)$ and $W$ should be linear with slope equal to the inverse thermal energy $\\beta \\equiv 1/(k_B T)$ and with an intercept set by the equilibrium free energy difference. A statistically significant deviation of the fitted slope from $\\beta$ indicates a violation.**\n\nThis check is a direct test of the CFT equation. Taking the natural logarithm of the CFT gives:\n$$ \\ln\\left(\\frac{P_F(W)}{P_R(-W)}\\right) = \\ln\\left(e^{\\beta (W - \\Delta F)}\\right) $$\n$$ R(W) = \\beta (W - \\Delta F) = \\beta W - \\beta \\Delta F $$\nThis equation predicts that the function $R(W)$ is a linear function of work $W$. The slope of this line is $\\beta$, and the y-intercept is $-\\beta \\Delta F$. If the underlying dynamics do not obey microscopic reversibility, the CFT is not guaranteed to hold, and this precise linear relationship is not expected. By reconstructing the work histograms $P_F(W)$ and $P_R(W)$ from the simulation data, one can compute $R(W)$ for a range of work values where the histograms overlap. Performing a linear regression on $R(W)$ versus $W$ and finding that the slope is not equal to the known value of $\\beta$ (within statistical uncertainty) is a strong and direct indication that the assumptions of the CFT are violated. Therefore, this is a valid and reliable diagnostic.\n\nVerdict: **Correct**.\n\n**Option B: Identify the crossing point $W^\\star$ at which $P_F(W^\\star) = P_R(-W^\\star)$; under microreversibility, this crossing must occur at the equilibrium $\\Delta F$. A statistically significant mismatch between $W^\\star$ and the independently estimated $\\Delta F$ indicates a violation.**\n\nThis check follows directly from the CFT. The crossing point $W^\\star$ of the distributions $P_F(W)$ and $P_R(-W)$ is defined by the condition $P_F(W^\\star) = P_R(-W^\\star)$. At this point, the ratio on the left-hand side of the CFT equation is equal to $1$:\n$$ \\frac{P_F(W^\\star)}{P_R(-W^\\star)} = 1 $$\nSubstituting this into the CFT equation:\n$$ 1 = e^{\\beta (W^\\star - \\Delta F)} $$\nTaking the natural logarithm of both sides gives:\n$$ 0 = \\beta (W^\\star - \\Delta F) $$\nSince $\\beta \\neq 0$, this implies $W^\\star - \\Delta F = 0$, or $W^\\star = \\Delta F$. Thus, the CFT predicts that the two work distributions, when plotted as $P_F(W)$ and $P_R(-W)$, will intersect at a work value equal to the equilibrium free energy difference. If the measured crossing point $W^\\star$ from the histograms deviates significantly from an independently determined value of $\\Delta F$, it indicates that the CFT is violated, pointing to a failure in its underlying assumptions, such as microscopic reversibility. This is a valid diagnostic.\n\nVerdict: **Correct**.\n\n**Option C: Evaluate the integral fluctuation identity connecting the exponential average of the forward work to the equilibrium free energy difference; under microreversibility, the equality holds exactly. If the measured exponential average from the forward work deviates from the equilibrium reference beyond sampling uncertainty, this indicates a violation.**\n\nThis check refers to the Jarzynski equality, which can be derived from the CFT. We rearrange the CFT to $P_F(W) e^{-\\beta W} = P_R(-W) e^{-\\beta \\Delta F}$ and integrate over all possible work values $W$:\n$$ \\int dW \\, P_F(W) e^{-\\beta W} = \\int dW \\, P_R(-W) e^{-\\beta \\Delta F} $$\nThe left side is the definition of the ensemble average $\\langle e^{-\\beta W} \\rangle_F$. The right side can be simplified:\n$$ \\langle e^{-\\beta W} \\rangle_F = e^{-\\beta \\Delta F} \\int dW \\, P_R(-W) $$\nBy performing a change of variables $W' = -W$, the integral becomes $\\int dW' \\, P_R(W')$, which is the integral of the reverse work probability distribution over its entire domain, and thus equals $1$. This leads to the Jarzynski equality:\n$$ \\langle e^{-\\beta W} \\rangle_F = e^{-\\beta \\Delta F} $$\nThis equality is a direct consequence of the CFT. Therefore, if microscopic reversibility is violated, the Jarzynski equality is not guaranteed to hold. The check proposes computing the exponential average $\\langle e^{-\\beta W} \\rangle_F$ from the sample of forward work values and comparing it to $e^{-\\beta \\Delta F}$, where $\\Delta F$ is known from an equilibrium reference calculation. A statistically significant disagreement between these two quantities is a valid indicator of a violation of the CFT's premises.\n\nVerdict: **Correct**.\n\n**Option D: Verify only that the inequality $\\langle W \\rangle_F \\ge \\Delta F$ is satisfied for the forward protocol; if the inequality holds, conclude that microreversibility is not violated.**\n\nThis inequality is a statement of the second law of thermodynamics for non-equilibrium processes. It can be derived from the Jarzynski equality, $\\langle e^{-\\beta W} \\rangle_F = e^{-\\beta \\Delta F}$, by applying Jensen's inequality. Since the exponential function $f(x) = e^x$ is convex, we have $\\langle e^X \\rangle \\ge e^{\\langle X \\rangle}$. Letting $X = -\\beta W$, we get:\n$$ \\langle e^{-\\beta W} \\rangle_F \\ge e^{\\langle -\\beta W \\rangle_F} = e^{-\\beta \\langle W \\rangle_F} $$\nCombining this with the Jarzynski equality:\n$$ e^{-\\beta \\Delta F} \\ge e^{-\\beta \\langle W \\rangle_F} $$\nTaking the logarithm and multiplying by $-1/\\beta < 0$ reverses the inequality:\n$$ \\Delta F \\le \\langle W \\rangle_F $$\nWhile this inequality is a necessary consequence of the CFT, it is not a sufficient condition. A simulation that violates microscopic reversibility might produce so much dissipation that $\\langle W \\rangle_F$ is very large, thus trivially satisfying the inequality. The option's logic, \"if the inequality holds, conclude that microreversibility is not violated,\" is a logical fallacy known as affirming the consequent. Because the inequality can be satisfied even when the underlying assumptions of the CFT are violated, it is not a reliable diagnostic for confirming that those assumptions hold. It can only flag a violation if the inequality is found to be broken, but it cannot certify correctness.\n\nVerdict: **Incorrect**.\n\n**Option E: Confirm that the reverse protocol differs from the time reverse of the forward protocol in thermostat parameters and integration step ordering; if differences are present, conclude that microreversibility holds because the end states are identical and only the path differs.**\n\nThis statement is based on a profound misunderstanding of the requirements for the CFT. One of the crucial assumptions for the CFT to hold is that the reverse protocol must be the exact time-reversal of the forward protocol. If the reverse protocol differs (e.g., in thermostat settings or the order of integration steps), then the CFT relation, $P_F(W)/P_R(-W) = e^{\\beta(W - \\Delta F)}$, is not expected to hold, even if the underlying dynamics perfectly obey microscopic reversibility. The option illogically suggests that such a difference in protocols would be evidence *for* microreversibility holding. The provided reasoning, \"because the end states are identical and only the path differs,\" is a vague statement about free energy being a state function, which has no bearing on the validity of the fluctuation theorem's path-dependent relations. The entire premise and conclusion of this option are nonsensical.\n\nVerdict: **Incorrect**.\n\n**Option F: Compute the Kullback–Leibler divergence $D_{\\mathrm{KL}}\\!\\big(P_F(W)\\,\\Vert\\,P_R(-W)\\big) \\equiv \\int dW\\, P_F(W)\\,\\ln\\!\\big(P_F(W)/P_R(-W)\\big)$ and compare it to the mean dissipated work scaled by $\\beta$, namely $\\beta\\,\\big(\\langle W \\rangle_F - \\Delta F\\big)$; under microreversibility, these two quantities are equal. A statistically significant difference between them indicates a violation.**\n\nThis check proposes another identity derived from the CFT. The Kullback-Leibler (KL) divergence between $P_F(W)$ and $P_R(-W)$ is defined as given. If the CFT holds, we can substitute the expression for the logarithm term:\n$$ \\ln\\left(\\frac{P_F(W)}{P_R(-W)}\\right) = \\beta (W - \\Delta F) $$\nInserting this into the definition of the KL divergence:\n$$ D_{\\mathrm{KL}}\\!\\big(P_F(W)\\,\\Vert\\,P_R(-W)\\big) = \\int dW\\, P_F(W) \\, \\big[\\beta (W - \\Delta F)\\big] $$\n$$ = \\beta \\int dW\\, P_F(W) \\, (W - \\Delta F) $$\n$$ = \\beta \\left( \\int dW\\, W P_F(W) - \\Delta F \\int dW\\, P_F(W) \\right) $$\nThe first integral is the definition of the average forward work, $\\langle W \\rangle_F$. The second integral is $\\Delta F$ multiplied by the normalization of the probability distribution, which is $1$. This yields:\n$$ D_{\\mathrm{KL}}\\!\\big(P_F(W)\\,\\Vert\\,P_R(-W)\\big) = \\beta (\\langle W \\rangle_F - \\Delta F) $$\nThe term $\\langle W \\rangle_F - \\Delta F$ is the average dissipated work, $\\langle W_{diss} \\rangle_F$. Thus, the CFT predicts that the KL divergence is equal to the average dissipated work scaled by $\\beta$. This is a rigorous, quantitative identity. If the simulation data from Setup $2$ shows a statistically significant disagreement between the two sides of this equation, it is a valid indicator that the assumptions underlying the CFT, such as microscopic reversibility, have been violated.\n\nVerdict: **Correct**.",
            "answer": "$$\\boxed{ABCF}$$"
        }
    ]
}