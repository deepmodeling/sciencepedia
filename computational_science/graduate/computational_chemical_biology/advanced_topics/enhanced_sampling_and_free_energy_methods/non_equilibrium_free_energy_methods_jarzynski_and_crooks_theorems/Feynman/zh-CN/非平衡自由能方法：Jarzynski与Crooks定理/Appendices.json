{
    "hands_on_practices": [
        {
            "introduction": "本实践将引导您完成一个完整的计算流程。我们将结合使用热力学循环和Jarzynski等式，来计算标准结合自由能——这是药物发现中最重要的物理量之一。本练习将展示如何将原始的非平衡功数据与一个有物理意义的宏观性质联系起来。",
            "id": "3856267",
            "problem": "您将设计一个程序，该程序使用通过非平衡功关系分析的炼金术去耦合方案，计算配体的物理上有意义的结合自由能。该系统是一个配体，与大分子结合位点或与本体溶剂相互作用。通过在恒温动力学下，将控制哈密顿量的耦合参数从完全相互作用值更改为非相互作用值，来解耦配体（即关闭其相互作用）。其基本物理基础是，正则系综量化了平衡自由能，并且当功的定义与所操纵的哈密顿量一致时，通过多次实现的非平衡功可以恢复平衡自由能差。您的程序必须基于此基础来推导和实现该估计量，并特别注意符号以及通过热力学循环对结合的定义。所有能量都必须按每摩尔的量处理。\n\n您必须从以下基本基础出发：\n- 对于参数化哈密顿量 $H(\\mathbf{x},\\lambda)$，其正则系综自由能为：$G(\\lambda) = - R T \\ln Z(\\lambda)$，其中 $Z(\\lambda) = \\int \\exp\\big(-\\beta H(\\mathbf{x},\\lambda)\\big) \\, d\\mathbf{x}$，$R$ 是每摩尔的理想气体常数，$T$ 是温度，且 $\\beta = 1/(R T)$。\n- 沿着对参数 $\\lambda$ 的非平衡操纵所做的功 $W$ 是通过改变哈密顿量参数所做的机械功，沿轨迹累积，并与恒温系综的广义定义一致。提供的值是完成从完全相互作用到非相互作用方案的这种功的实现，单位为 $\\mathrm{kJ\\,mol^{-1}}$。\n- 结合是通过一个封闭的热力学循环来定义的，该循环包括在复合物中解耦配体，在溶剂中解耦配体，以及一个约束附加步骤，该步骤将一个不相互作用的配体限制在结合位点的参考几何构型中，以强制执行标准浓度 $c^{\\circ} = 1\\,\\mathrm{mol\\,L^{-1}}$。约束项直接作为将约束附加到结合位点上不相互作用的配体所需的每摩尔自由能成本提供，以便您的程序可以一致地包含标准态校正。\n\n您的任务：\n- 从正则系综和应用于 $H(\\mathbf{x},\\lambda)$ 的非平衡功的定义中，推导出正确的估计量，该估计量将一组用于去耦合的非平衡功值映射为每个去耦合步骤的平衡自由能差。\n- 基于一个封闭的热力学循环（包括：在复合物中去耦合、在溶剂中去耦合以及约束附加），建立正确的结合符号约定。确保约束项以正确的方向被包含，以参考标准态。\n- 在您的程序中实现最终的估计量，以计算每个测试用例的结合自由能。\n\n单位和输出要求：\n- 所有能量单位均为 $\\mathrm{kJ\\,mol^{-1}}$。\n- 温度单位均为 $\\mathrm{K}$。\n- 使用 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，并在需要时适当转换为 $\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n- 您的程序必须生成一行输出，其中包含所有测试用例的结合自由能的逗号分隔列表，四舍五入到三位小数，并用方括号括起来。例如，输出格式必须完全像 `[x_1,x_2,x_3]`。\n\n测试套件：\n- 用例 1（一般情况）：\n  - 温度：$300.0\\,\\mathrm{K}$\n  - 复合物去耦合功值（完全相互作用 $\\rightarrow$ 非相互作用）：$[24.2,26.5,23.7,25.1,27.8,24.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 溶剂去耦合功值（完全相互作用 $\\rightarrow$ 非相互作用）：$[8.9,10.2,9.5,11.3,8.7,9.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 约束附加自由能（将不相互作用的配体限制在结合位点，与标准态一致）：$6.2\\,\\mathrm{kJ\\,mol^{-1}}$\n- 用例 2（边界条件：零方差功）：\n  - 温度：$298.15\\,\\mathrm{K}$\n  - 复合物去耦合功值：$[20.0,20.0,20.0,20.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 溶剂去耦合功值：$[6.0,6.0,6.0,6.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 约束附加自由能：$6.0\\,\\mathrm{kJ\\,mol^{-1}}$\n- 用例 3（边缘情况：更高温度和更宽分布）：\n  - 温度：$310.0\\,\\mathrm{K}$\n  - 复合物去耦合功值：$[18.0,22.5,20.1,19.7,21.3,17.9,24.0,16.5]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 溶剂去耦合功值：$[12.0,14.5,13.8,15.2,13.0,14.1]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 约束附加自由能：$4.0\\,\\mathrm{kJ\\,mol^{-1}}$\n\n最终规范：\n- 实现对功的指数进行数值稳定的平均，以从提供的功实现和温度中获得去耦合自由能。\n- 根据正确的结合循环符号约定，将去耦合自由能与约束附加自由能相结合，以产生每个用例的结合自由能，单位为 $\\mathrm{kJ\\,mol^{-1}}$。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，四舍五入到三位小数，格式完全为：$[x_1,x_2,x_3]$。",
            "solution": "该问题要求使用来自非平衡炼金术模拟的数据，计算配体-受体系统的标准结合自由能 $\\Delta G_{bind}^{\\circ}$。该解决方案包含两个主要部分：首先，应用 Jarzynski 等式从非平衡功值估计平衡自由能差；其次，构建一个热力学循环，将这些自由能差与结合亲和力联系起来。\n\n基本原理是亥姆霍兹或吉布斯自由能 ($G$) 与具有哈密顿量 $H(\\mathbf{x}, \\lambda)$ 的系统的正则配分函数 ($Z$) 之间的关系，该哈密顿量取决于一组坐标 $\\mathbf{x}$ 和一个耦合参数 $\\lambda$。对于一个在温度 $T$ 的热浴中处于热平衡的系统，其自由能由下式给出：\n$$ G(\\lambda) = -k_B T \\ln Z(\\lambda) $$\n其中 $k_B$ 是玻尔兹曼常数，$\\beta = 1/(k_B T)$。配分函数是对所有可及微观状态的积分：\n$$ Z(\\lambda) = \\int e^{-\\beta H(\\mathbf{x}, \\lambda)} \\, d\\mathbf{x} $$\n由于问题指定能量单位为每摩尔量（例如 $\\mathrm{kJ\\,mol^{-1}}$），我们将玻尔兹曼常数 $k_B$ 替换为理想气体常数 $R$，并将 $\\beta$ 定义为 $\\beta = 1/(RT)$。\n$$ G(\\lambda) = -RT \\ln Z(\\lambda) $$\n\n由 $\\lambda = \\lambda_A$ 和 $\\lambda = \\lambda_B$ 定义的两个状态之间的自由能差 $\\Delta G$ 是：\n$$ \\Delta G = G(\\lambda_B) - G(\\lambda_A) $$\n虽然这个差值可以通过平衡方法计算，但问题提供了来自非平衡轨迹的数据。Jarzynski 等式提供了在从状态 $\\lambda_A$ 到 $\\lambda_B$ 的非平衡转换过程中对系统所做的功 $W$ 与平衡自由能差 $\\Delta G$ 之间的理论桥梁。该等式表述为：\n$$ \\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta G} $$\n这里，尖括号 $\\langle \\cdot \\rangle$ 表示对无限多个非平衡轨迹系综的平均。求解 $\\Delta G$ 可得：\n$$ \\Delta G = -\\frac{1}{\\beta} \\ln \\langle e^{-\\beta W} \\rangle = -RT \\ln \\langle e^{-\\beta W} \\rangle $$\n在实践中，该平均值是通过对 $N$ 个功测量值 $W_1, W_2, \\dots, W_N$ 的有限样本进行估计的：\n$$ \\langle e^{-\\beta W} \\rangle \\approx \\frac{1}{N} \\sum_{i=1}^{N} e^{-\\beta W_i} $$\n将此估计量代入 $\\Delta G$ 的表达式中，我们得到了用于计算去耦合自由能的公式：\n$$ \\Delta G_{\\text{decouple}} = -RT \\ln \\left( \\frac{1}{N} \\sum_{i=1}^{N} e^{-W_i/(RT)} \\right) $$\n当指数函数的参数为大的负数时，由于浮点数的限制，直接计算此表达式可能在数值上不稳定。一种稳定的方法是认识到该表达式等价于：\n$$ \\Delta G_{\\text{decouple}} = -RT \\left( \\text{logsumexp}(-W_i/(RT)) - \\ln(N) \\right) $$\n其中 `logsumexp` 函数以一种防止下溢和上溢的方式计算指数和的对数。这就是我们将要使用的估计量。\n\n接下来，我们建立热力学循环来计算标准结合自由能 $\\Delta G_{bind}^{\\circ}$。结合过程为 $P + L \\rightarrow P:L$，其中 $P$ 是蛋白质，$L$ 是配体，$P:L$ 是复合物。我们循环中的状态是：\n1. $P:L$（溶剂化的复合物）\n2. $P + L$（溶剂化的蛋白质和配体，已分离）\n3. $P:L^*$（带有不相互作用的“幽灵”配体 $L^*$ 的复合物）\n4. $P + L^*$（分离的蛋白质和幽灵配体）\n\n该循环通过四个过程连接这些状态：\n(a) $P:L \\rightarrow P + L$：配体的解离，自由能变为 $\\Delta G_{unbind} = -\\Delta G_{bind}^{\\circ}$。\n(b) $P:L \\rightarrow P:L^*$：在结合位点内解耦配体。自由能变为 $\\Delta G_{decouple,complex}$，由复合物去耦合功值计算得出。\n(c) $P+L \\rightarrow P+L^*$：在溶剂中解耦自由配体。由于蛋白质是旁观者，这实际上是 $L \\rightarrow L^*$。自由能变为 $\\Delta G_{decouple,solvent}$，由溶剂去耦合功值计算得出。\n(d) $P:L^* \\rightarrow P+L^*$：将不相互作用的配体从结合位点释放到本体溶剂中，过渡到标准态浓度。其逆过程（将约束附加到自由的不相互作用配体上）的自由能作为 $\\Delta G_{restraint}$ 给出。因此，此释放过程的自由能变为 $-\\Delta G_{restraint}$。\n\n由于自由能是状态函数，围绕一个闭合循环的自由能变化总和必须为零。遍历循环 $P+L \\rightarrow P:L \\rightarrow P:L^* \\rightarrow P+L^* \\rightarrow P+L$：\n$$ (\\Delta G_{bind}^{\\circ}) + (\\Delta G_{decouple,complex}) + (-\\Delta G_{restraint}) + (-\\Delta G_{decouple,solvent}) = 0 $$\n求解标准结合自由能 $\\Delta G_{bind}^{\\circ}$：\n$$ \\Delta G_{bind}^{\\circ} = \\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex} + \\Delta G_{restraint} $$\n这是最终要实现的表达式。一个有利的结合事件对应一个负的 $\\Delta G_{bind}^{\\circ}$。让我们验证一下符号。去耦合自由能是正的成本。通常，复合物中的相互作用比溶剂中强，使得 $\\Delta G_{decouple,complex} > \\Delta G_{decouple,solvent}$。这导致对结合的负贡献 $(\\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex})$。约束自由能 $\\Delta G_{restraint}$ 是将配体限制在结合位点的熵成本，是一个正值，使结合变得更不利。因此，推导出的方程中的符号在物理上是一致的。\n\n计算过程首先是为每个测试用例使用 Jarzynski 估计量计算 $\\Delta G_{decouple,complex}$ 和 $\\Delta G_{decouple,solvent}$，然后根据推导出的热力学循环方程将它们与提供的 $\\Delta G_{restraint}$ 值结合起来。气体常数 $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ 必须转换为 $0.00831446261815324\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$ 以匹配所提供功值的单位。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Computes the binding free energy for a ligand using an alchemical decoupling\n    protocol and non-equilibrium work relations (Jarzynski's equality).\n    \"\"\"\n\n    # Define the gas constant in the required units.\n    # R is given in J mol^-1 K^-1. Work values are in kJ mol^-1.\n    # We convert R to kJ mol^-1 K^-1.\n    R_J_MOL_K = 8.31446261815324\n    R_KJ_MOL_K = R_J_MOL_K / 1000.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"temperature\": 300.0,\n            \"complex_work\": [24.2, 26.5, 23.7, 25.1, 27.8, 24.9],\n            \"solvent_work\": [8.9, 10.2, 9.5, 11.3, 8.7, 9.9],\n            \"restraint_dg\": 6.2,\n        },\n        {\n            \"temperature\": 298.15,\n            \"complex_work\": [20.0, 20.0, 20.0, 20.0],\n            \"solvent_work\": [6.0, 6.0, 6.0, 6.0],\n            \"restraint_dg\": 6.0,\n        },\n        {\n            \"temperature\": 310.0,\n            \"complex_work\": [18.0, 22.5, 20.1, 19.7, 21.3, 17.9, 24.0, 16.5],\n            \"solvent_work\": [12.0, 14.5, 13.8, 15.2, 13.0, 14.1],\n            \"restraint_dg\": 4.0,\n        },\n    ]\n\n    results = []\n\n    def calculate_delta_g_decouple(work_values: list[float], temp: float) -> float:\n        \"\"\"\n        Calculates the free energy difference from non-equilibrium work values\n        using Jarzynski's equality in a numerically stable way.\n        \n        Args:\n            work_values: A list of work values in kJ/mol.\n            temp: The temperature in Kelvin.\n            \n        Returns:\n            The estimated free energy difference in kJ/mol.\n        \"\"\"\n        work_array = np.array(work_values, dtype=np.float64)\n        num_trajectories = len(work_array)\n        \n        beta_inv = R_KJ_MOL_K * temp\n        \n        if np.all(work_array == work_array[0]):\n            return work_array[0]\n            \n        exponents = -work_array / beta_inv\n        \n        log_avg_exp = logsumexp(exponents) - np.log(num_trajectories)\n        \n        delta_g = -beta_inv * log_avg_exp\n        return delta_g\n\n    for case in test_cases:\n        temp = case[\"temperature\"]\n        dg_complex = calculate_delta_g_decouple(case[\"complex_work\"], temp)\n        dg_solvent = calculate_delta_g_decouple(case[\"solvent_work\"], temp)\n        dg_restraint = case[\"restraint_dg\"]\n        \n        dg_bind_standard = dg_solvent - dg_complex + dg_restraint\n        results.append(dg_bind_standard)\n        \n    output_str = \"[\" + \",\".join([f\"{res:.3f}\" for res in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "引导分子动力学（SMD）是探索能量形貌的强大工具，但解释其产生的“功”需要格外小心。本练习深入探讨了用外部弹簧拉动分子时所测量的功的含义，揭示了它反映的是一个复合系统（分子+弹簧）的自由能。您将学习如何推导并应用必要的校正，以提取出其背后具有物理意义的平均力势（PMF）。",
            "id": "3856253",
            "problem": "在一个用于探测生物分子复合物内部一维反应坐标 $x$ 的引导分子动力学方案中，感兴趣区域附近的底层平均力势 (PMF) 可以很好地用谐振形式 $U_{0}(x) = \\frac{a}{2}\\,x^{2}$ 近似，其曲率 $a$ 可通过独立的平衡计算得知。在牵引过程中，施加一个刚度为 $k$ 的谐振偏置（“弹簧”），其中心 $\\lambda(t)$ 以恒定速率从 $\\lambda(0)=0$ 平移到 $\\lambda(\\tau)=L$。总哈密顿量为 $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$。测得的牵引功 $W_{\\mathrm{meas}}$ 定义为方案功的时间积分，$W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$。假设牵引过程足够缓慢，以至于该过程可视为可逆（准静态），且系统保持在温度 $T$（正则系综）。\n\n仅使用正则自由能 $F(\\lambda)=-k_{B}T\\ln Z(\\lambda)$ 的统计力学基本定义和方案功 $W=\\int_{0}^{\\tau}(\\partial H/\\partial t)\\,dt=\\int_{0}^{\\tau}(\\partial H/\\partial \\lambda)\\,\\dot{\\lambda}\\,dt$ 的定义，并且不借助任何专门的“捷径”公式，完成以下任务：\n\n- 解释硬弹簧（大的 $k$ 值）如何通过将系统与移动约束耦合来改变测量的功，并证明在准静态极限下，$W_{\\mathrm{meas}}$ 等于耦合哈密顿量在 $\\lambda=0$ 和 $\\lambda=L$ 时的自由能差。\n- 通过计算耦合哈密顿量的正则配分函数 $Z(\\lambda)$，推导 $F(\\lambda)$ 的函数形式，进而得出在 $\\lambda=0$ 和 $\\lambda=L$ 之间准静态测量功 $W_{\\mathrm{meas}}$ 的解析表达式，该表达式用 $a$、$k$ 和 $L$ 表示。\n- 从第一性原理出发，设计一个修正项，将此耦合系统的自由能差转换为仅与 $U_{0}(x)$ 相关的底层物理 PMF 差 $\\Delta G_{\\mathrm{phys}}=G(L)-G(0)$，并以 $a$、$k$ 和 $W_{\\mathrm{meas}}$ 的形式给出 $\\Delta G_{\\mathrm{phys}}$ 的闭合表达式。\n\n然后，使用您推导的修正项，为以下参数集计算修正后的物理自由能差的数值，该参数集代表了配体在蛋白质通道中的平移过程：\n- 分子PMF曲率 $a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$，\n- 弹簧刚度 $k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$，\n- 牵引位移 $L = 0.2\\,\\mathrm{nm}$，\n- 通过平均多次慢速牵引获得的可逆测量功 $W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$。\n\n将最终能量以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示为单个实数，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题已经过验证，是计算化学生物学领域一个形式良好且科学上合理的探询。我们将进行完整的推导和解答。\n\n问题要求对准静态（可逆）极限下的引导分子动力学 (SMD) 模拟进行多部分分析。我们将使用所提供的定义和统计力学的第一性原理，依次处理每个部分。\n\n首先，我们阐述测量的功与自由能之间的关系。耦合系统的总哈密顿量为 $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$，其中 $\\lambda$ 是随时间变化的控制参数。该耦合系统的正则自由能定义为 $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$，其中 $Z(\\lambda)$ 是给定 $\\lambda$ 时的配分函数：\n$$Z(\\lambda) = C \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\n在此，$C$ 代表一个源自动能（动量积分）的常数因子，它与 $\\lambda$ 无关，不会影响自由能的差值。自由能相对于控制参数 $\\lambda$ 的变化由其导数给出：\n$$\\frac{dF}{d\\lambda} = \\frac{d}{d\\lambda}\\left(-k_{B}T\\ln Z(\\lambda)\\right) = -k_{B}T \\frac{1}{Z(\\lambda)} \\frac{dZ(\\lambda)}{d\\lambda}$$\n配分函数的导数是：\n$$\\frac{dZ(\\lambda)}{d\\lambda} = C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\n将此代回，我们得到：\n$$\\frac{dF}{d\\lambda} = -k_{B}T \\frac{1}{Z(\\lambda)} \\left[ C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx \\right]$$\n$$\\frac{dF}{d\\lambda} = \\frac{C \\int \\frac{\\partial H}{\\partial \\lambda} \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx}{C \\int \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx} = \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle$$\n这证明了自由能对控制参数的导数等于与该参数共轭的广义力的正则系综平均值。\n\n根据问题定义，对系统所做的功为 $W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$。在准静态过程中，系统在任意时刻都处于瞬时 $\\lambda(t)$ 值下的平衡态。因此，涨落的瞬时力 $\\frac{\\partial H}{\\partial \\lambda}$ 可以被其系综平均值 $\\langle \\frac{\\partial H}{\\partial \\lambda} \\rangle$ 所替代。功的积分变为：\n$$W_{\\mathrm{meas}} = \\int_{0}^{\\tau} \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle \\dot{\\lambda}\\,dt = \\int_{0}^{\\tau} \\frac{dF}{d\\lambda} \\frac{d\\lambda}{dt} dt = \\int_{\\lambda(0)}^{\\lambda(\\tau)} dF$$\n在极限 $\\lambda(0)=0$ 和 $\\lambda(\\tau)=L$ 的条件下，准静态功恰好是耦合系统在末态和初态之间的自由能差：\n$$W_{\\mathrm{meas}} = F(L) - F(0)$$\n硬弹簧（大的 $k$ 值）增强了系统坐标 $x$ 和陷阱中心 $\\lambda$ 之间的耦合。势能项 $\\frac{k}{2}(x-\\lambda)^2$ 对 $x$ 偏离 $\\lambda$ 的行为施加惩罚。当 $k \\to \\infty$ 时，粒子被迫跟随陷阱中心，即 $x(t) \\to \\lambda(t)$。测量的功反映了这个紧密耦合系统的能量变化，这与未受扰动系统 $U_0(x)$ 的能量变化是不同的。\n\n接下来，我们推导 $F(\\lambda)$ 的函数形式和 $W_{\\mathrm{meas}}$ 的表达式。我们首先通过对 $x$ 进行配方来重写哈密顿量 $H(x;\\lambda)$：\n$$H(x;\\lambda) = \\frac{a}{2}x^2 + \\frac{k}{2}(x^2 - 2x\\lambda + \\lambda^2) = \\frac{a+k}{2}x^2 - k\\lambda x + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x^2 - \\frac{2k\\lambda}{a+k}x\\right) + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left[\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\left(\\frac{k\\lambda}{a+k}\\right)^2\\right] + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\frac{k^2\\lambda^2}{2(a+k)} + \\frac{k(a+k)\\lambda^2}{2(a+k)}$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 + \\frac{ak}{2(a+k)}\\lambda^2$$\n于是，配分函数 $Z(\\lambda)$ 为：\n$$Z(\\lambda) = C \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{a+k}{2k_{B}T}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2\\right) dx$$\n该积分为一个标准高斯积分，其结果为 $\\sqrt{\\frac{2\\pi k_{B}T}{a+k}}$。\n$$Z(\\lambda) = C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}} \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right)$$\n自由能 $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$ 为：\n$$F(\\lambda) = -k_{B}T\\ln\\left(C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}}\\right) + \\frac{ak}{2(a+k)}\\lambda^2$$\n第一项是相对于 $\\lambda$ 的一个常数。我们将其记为 $F_{\\text{ref}}$。\n$$F(\\lambda) = F_{\\text{ref}} + \\frac{ak}{2(a+k)}\\lambda^2$$\n使用这个函数形式，准静态功 $W_{\\mathrm{meas}} = F(L) - F(0)$ 为：\n$$W_{\\mathrm{meas}} = \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}L^2\\right) - \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}0^2\\right)$$\n$$W_{\\mathrm{meas}} = \\frac{ak}{2(a+k)}L^2$$\n\n现在，我们设计一个修正项来获得物理 PMF 差 $\\Delta G_{\\mathrm{phys}} = G(L) - G(0)$。物理 PMF 为 $G(x) = U_0(x) = \\frac{a}{2}x^2$。所求的量是：\n$$\\Delta G_{\\mathrm{phys}} = G(L) - G(0) = \\frac{a}{2}L^2 - 0 = \\frac{a}{2}L^2$$\n测量的功 $W_{\\mathrm{meas}}$ 反映了对一个复合系统进行的牵引。系统（弹簧常数为 $a$）和偏置弹簧（常数为 $k$）的作用如同两个串联的弹簧。这样一个系统的等效弹簧常数为 $k_{\\text{eff}} = \\left(\\frac{1}{a} + \\frac{1}{k}\\right)^{-1} = \\frac{ak}{a+k}$。测量的功 $W_{\\mathrm{meas}} = \\frac{k_{\\text{eff}}}{2}L^2$ 是将此复合弹簧系统拉伸距离 $L$ 所需的能量。我们的目标 $\\Delta G_{\\mathrm{phys}}$ 是如果物理弹簧*本身*被拉伸相同的距离 $L$ 时所储存的能量。\n我们可以建立一个直接关系：\n$$\\frac{\\Delta G_{\\mathrm{phys}}}{W_{\\mathrm{meas}}} = \\frac{\\frac{a}{2}L^2}{\\frac{ak}{2(a+k)}L^2} = \\frac{a(a+k)}{ak} = \\frac{a+k}{k} = 1 + \\frac{a}{k}$$\n因此，我们可以用测量的功和已知的系统参数 $a$ 和 $k$ 来表示物理自由能差：\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{a}{k}\\right) W_{\\mathrm{meas}}$$\n这就是所需的修正。它通过缩放耦合系统的测量自由能，来得到底层物理系统的自由能。修正因子 $1 + \\frac{a}{k}$ 总是大于 1，这表明在这种设置下，测量的功总是低估了被探测的真实自由能垒，因为一部分牵引功消耗在了谐振约束本身的形变上。\n\n最后，我们使用提供的数据计算 $\\Delta G_{\\mathrm{phys}}$ 的数值：\n$a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$\n\n使用推导出的修正公式：\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}{1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}\\right) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = (1 + 0.25) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 1.25 \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 5.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n结果需要四舍五入到四位有效数字。计算值为 $5.000$。",
            "answer": "$$\\boxed{5.000}$$"
        },
        {
            "introduction": "Jarzynski等式中的指数平均是出了名的难以收敛，因为它常常被稀有的低功事件所主导。本实践将探讨应用该定理时面临的统计挑战，并要求您区分可靠的方法论与带有偏见的“捷径”来处理这些“离群值”。理解这些问题对于获得可靠且可重复的自由能估计至关重要。",
            "id": "3856268",
            "problem": "在一个配体从蛋白质结合口袋中被拉出的过程中，于温度 $T$ 下进行了一系列非平衡受控分子动力学 (SMD) 实现，这些实现从结合状态的平衡态开始。记录下每条轨迹上所做的机械功 $W$，从而得到一组来自正向协议的功值 $\\{W_i\\}$，以及可选地，一组来自时间反向协议的功值 $\\{W_j^{\\mathrm{rev}}\\}$（该协议从非结合状态开始）。在这种情况下，使用功的指数平均来估计一个仅依赖于固定温度 $T$ 下初始和最终热力学状态的状态函数。您担心罕见的、低功值的轨迹会主导这个指数平均，导致高方差和对离群值的敏感性。\n\n仅从以下基本依据出发：\n- 初始条件为平衡态，根据玻尔兹曼分布 $\\propto \\exp(-\\beta H)$ 分布，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，哈密顿量为 $H$。\n- 动力学的微观可逆性和平衡系综的细致平衡。\n- 机械功 $W$ 的定义为广义力乘以协议速度沿轨迹的路径积分。\n- 采样中任何无偏的测度变换都必须伴随相应的似然比重加权，以保持期望值不变。\n\n解释为什么对于 $W$ 的指数平均，功分布下尾部的贡献（$W$ 远低于其均值）变得不成比例地重要，以及这如何与正向和反向过程的路径概率之比相关联。基于此推理，从以下策略中选择所有既能 (i) 可靠地检测少数轨迹主导估计量的情况，又能 (ii) 以不引入对底层状态函数估计的统计偏差的方式处理这种主导情况的策略。\n\nA. 结合正向和反向的功数据集，应用源自正向和反向路径概率之比的 Bennett 接受率 (BAR) 方法，并通过比较正向和反向功的直方图或其推断的交叉点来评估重叠；当其假设成立时，该方法可以无偏地降低对极端尾部的敏感性。\n\nB. 在计算指数平均之前，丢弃或缩尾处理 (winsorize) 功值最低的一部分（例如，$\\{W_i\\}$ 中最小的 $p$ 部分），以减小方差，理由是这些事件是离群值，并且随着样本量的增大，其移除的影响可以忽略不计。\n\nC. 使用重要性采样，通过在非平衡协议期间沿拉动坐标添加偏置势来优先生成低耗散轨迹；通过精确的偏置路径测度与无偏路径测度之间的似然比对每条轨迹进行重加权，以恢复原始期望；监测根据归一化重要性权重计算的有效样本量，以检测权重简并。\n\nD. 无论耗散程度如何，都用围绕平均功的二阶累积量展开来代替指数平均，因为截断到二阶可以抑制离群值的影响，并且随着轨迹数量的增加，它仍然是无偏的。\n\nE. 在平均之前为每个指数权重设置一个固定的最大值上限，以防止个别轨迹占主导地位；这可以稳定计算，而不会改变估计量的期望值。\n\nF. 使用诸如 log-sum-exp 恒等式之类的数值稳定变换来计算指数平均，以避免上溢/下溢，并使用跨轨迹的非参数自举重采样来量化不确定性和识别影响点；这些诊断方法不会改变估计量的期望值。\n\n选择所有适用的选项，并使用上面列出的基本依据来证明您的选择。您的证明应明确阐述离群值是如何从玻尔兹曼统计、微观可逆性和指数重加权的相互作用中产生的，以及每种提出的方法是如何在诊断罕见事件主导情况的同时，保持或不保持期望值不变的。",
            "solution": "该问题陈述在科学上是合理的、提法得当且客观的。它描述了非平衡统计力学在计算生物学应用中的一个典型问题，即使用 Jarzynski 等式估计自由能差时面临的统计挑战。其前提基于已建立的第一性原理，问题本身是对理解这些原理及其统计学意义的严格考验。该问题是有效的。\n\n问题的核心在于 Jarzynski 等式 (JE)，它将非平衡转变过程中对系统所做的功 $W$ 与初始和最终状态之间的平衡自由能差 $\\Delta F$ 联系起来：\n$$\n\\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta F}\n$$\n这里，$\\beta = 1/(k_{\\mathrm{B}} T)$，平均 $\\langle \\cdot \\rangle$ 是对一个实现系综进行的，每个实现都从初始热力学状态的平衡玻尔兹曼分布 $\\propto \\exp(-\\beta H)$ 中采样的一个状态开始。对于有限数量的 $N$ 条轨迹，自由能估计为：\n$$\n\\Delta F_N = -\\frac{1}{\\beta} \\ln \\left( \\frac{1}{N} \\sum_{i=1}^{N} e^{-\\beta W_i} \\right)\n$$\n项 $e^{-\\beta W_i}$ 作为每条轨迹的权重。因为功 $W$ 在一个负指数中，所以功值较小的轨迹对总和的贡献呈指数级增长。热力学第二定律对于非平衡过程意味着平均功大于或等于自由能变化，即 $\\langle W \\rangle \\ge \\Delta F$。因此，大多数轨迹的功值将满足 $W_i > \\Delta F$。因此，平均值由那些罕见但在统计上至关重要的轨迹所主导，特别是那些 $W_i$ 很小，尤其是 $W_i \\approx \\Delta F$ 的轨迹。\n\n这种现象可以通过源于微观可逆性的 Crooks 涨落定理 (CFT) 来解释。CFT 将观察到产生功 $W$ 的正向轨迹 $\\mathbf{Z}(t)$ 的概率与其时间反向对应物 $\\mathbf{Z}^{\\dagger}(t)$ 的概率联系起来，后者从最终平衡态开始并遵循时间反向协议。它们的路径概率之比为：\n$$\n\\frac{\\mathcal{P}_F[\\mathbf{Z}(t)]}{\\mathcal{P}_R[\\mathbf{Z}^{\\dagger}(t)]} = e^{\\beta(W - \\Delta F)} = e^{\\beta W_d}\n$$\n其中 $W_d = W - \\Delta F$ 是耗散功。\n\n这个比率表明，低功值轨迹（$W \\approx \\Delta F$）具有低耗散功（$W_d \\approx 0$）。对于这些路径，正向与反向路径概率之比接近 1，意味着它们几乎是微观可逆的。在远离平衡（高耗散）的过程中，这样的轨迹极为罕见。JE 隐式地执行了重要性采样：它使用从正向过程中采样的轨迹来估计一个量，而该量严重依赖于那些其统计权重更能代表反向过程的罕见事件。典型正向功值与低功区域之间的重叠不佳，导致少数罕见样本主导估计，从而引起高方差。\n\n一个有效的策略必须能够正确诊断这种主导情况，并在不引入对 $\\Delta F$ 估计的统计偏差的情况下解决它。\n\n**选项 A 的分析：**\nBennett 接受率 (BAR) 方法通过优化组合来自正向 (F) 和反向 (R) 协议的数据来估计 $\\Delta F$。它源于 CFT，其对 $\\Delta F$ 的解是通过求解一个隐式方程找到的，该方程根据费米函数对数据点进行加权。这种加权方案自然地减少了来自任一分布的极端功值的影响，使其对尾部的离群值具有鲁棒性。BAR 估计的质量取决于正向功分布 $P_F(W)$ 和反向功分布 $P_R(-W^{\\mathrm{rev}})$ 之间的重叠程度。对这些分布进行视觉比较（例如，通过直方图）并定位它们的交叉点（理论上发生在 $W=\\Delta F$ 处）是检测采样不佳和潜在主导问题的直接而可靠的方法。因为 BAR 是从应用于 CFT 的最大似然原则推导出来的，所以它是渐近无偏的，并且已被证明在一大类双向估计量中具有最小方差。因此，该策略既能通过重叠评估可靠地检测潜在的主导情况，又能使用统计上合理、无偏的估计量来处理它。\n**结论：正确。**\n\n**选项 B 的分析：**\n该策略建议丢弃或缩尾处理功值最低的轨迹。这些轨迹恰恰是为指数平均收敛提供最关键信息的轨迹。Jarzynski 等式是一个精确的恒等式；移除对该恒等式贡献最大的数据点从根本上破坏了它。这个过程会引入系统性的、不受控制的偏差，将导致对 $\\Delta F$ 的高估（因为 $\\langle e^{-\\beta W} \\rangle$ 会被低估）。关于样本量大时其影响可以忽略不计的论点是不正确的；这些轨迹不是错误的离群值，而是功分布尾部的必要样本。该方法不满足无偏的标准。\n**结论：不正确。**\n\n**选项 C 的分析：**\n这描述了一个严格的重要性采样 (IS) 方案。通过添加偏置势，改变了采样动力学，以优先生成在无偏动力学下罕见的低耗散（低功）轨迹。为了校正这种有意的测度变换，每条轨迹对平均值的贡献都通过适当的似然比进行重加权，该似然比因子源于偏置势所做的功。根据其构造，此过程在统计上是精确的，不会对期望值引入偏差。原始估计量中少数轨迹占主导地位的问题，在 IS 方案中表现为“权重简并”，即少数重加权轨迹的重要性权重接近 1，而所有其他轨迹的权重接近 0。通过监测有效样本量（$N_{\\text{eff}}$，通常由归一化重要性权重的方差计算得出），可以可靠地检测到这种简并。低的 $N_{\\text{eff}}$ 表明估计值由少数轨迹主导。一个精心设计的偏置势将通过拓宽权重分布和增加 $N_{\\text{eff}}$ 来“处理”主导问题，从而降低 $\\Delta F$ 估计的方差。该策略既提供了检测方法，也提供了一种处理问题的无偏方式。\n**结论：正确。**\n\n**选项 D 的分析：**\n这建议使用二阶累积量展开，$\\Delta F \\approx \\langle W \\rangle - \\frac{\\beta}{2} \\sigma_W^2$。这是一个近似，而非等式，除非功分布 $P(W)$ 是高斯分布。对于远离平衡的过程，$P(W)$ 通常是高度偏斜和非高斯的。将累积量级数截断到二阶忽略了所有更高阶的累积量，并引入了一个取决于耗散程度的系统性偏差。这种偏差不会随着轨迹数量的增加而消失；估计量会收敛到错误的值。虽然只使用均值和方差抑制了单个尾部事件的影响，但这是以牺牲统计有效性为代价的。该方法是有偏的，并且仅在近平衡极限下才准确。\n**结论：不正确。**\n\n**选项 E 的分析：**\n为指数权重 $w_i = e^{-\\beta W_i}$ 设置上限是一种类似于选项 B 的临时性程序。它人为地截断了来自最重要的低功轨迹的贡献。虽然这可能会稳定平均值的数值，但它是通过破坏底层等式来实现的。关于这“不会改变估计量的期望值”的说法是错误的。通过为权重设置上限，人们不再是计算 $\\langle e^{-\\beta W} \\rangle$ 的估计，而是计算另一个有偏的量的估计。这会在最终的 $\\Delta F$ 估计中引入系统误差。\n**结论：不正确。**\n\n**选项 F 的分析：**\n该选项结合了两个有效的程序。首先，使用 log-sum-exp 恒等式是一种标准的数值技术，用于在计算指数平均时避免浮点数上溢或下溢。这是一个精确的变换，不会改变估计量的数学值，因此不会引入偏差。其次，非参数自举法是一种用于评估估计量不确定性的强大统计方法。通过从原始轨迹集中反复重采样并重新计算 $\\Delta F$，可以构建一个估计值的分布。如果原始估计被一个或少数几个影响点主导，自举分布将变得极其宽泛或呈多峰状，从而可靠地检测出估计量的不稳定性。这种诊断程序通过正确量化估计量的巨大方差（即高度不确定性）来“处理”主导问题，从而防止报告一个具有虚假置信度的、在统计上无意义的点估计。这是健全统计分析的关键部分。至关重要的是，自举法是一种后处理分析，它不改变原始估计量的期望，因此不引入偏差。\n**结论：正确。**",
            "answer": "$$\\boxed{ACF}$$"
        }
    ]
}