{
    "hands_on_practices": [
        {
            "introduction": "This practice serves as a capstone exercise, guiding you through the development of a complete workflow for calculating a standard binding free energy. You will implement the Jarzynski equality to estimate free energy differences from raw non-equilibrium work data and embed this calculation within a thermodynamic cycle to connect alchemical decoupling to the physical process of binding. This problem bridges theory and practice, demonstrating how to construct a quantitative tool for predicting molecular affinities while correctly handling standard state corrections .",
            "id": "3856267",
            "problem": "You will design a program that computes a physically meaningful binding free energy for a ligand using an alchemical decoupling protocol analyzed by non-equilibrium work relations. The system is a ligand interacting either with a macromolecular binding site or with bulk solvent. The ligand is decoupled (its interactions are turned off) by changing a coupling parameter that controls the Hamiltonian from a fully interacting value to a non-interacting value under a thermostatted dynamics. The underlying physical base is that the canonical ensemble quantifies equilibrium free energies and that non-equilibrium work over many realizations can recover equilibrium free-energy differences when work is defined consistently with the manipulated Hamiltonian. Your program must use this base to derive and implement the estimator, paying careful attention to signs and the definition of binding through a thermodynamic cycle. All energies must be handled as per-mole quantities.\n\nFundamental base you must start from:\n- The canonical ensemble free energy for a parameterized Hamiltonian $H(\\mathbf{x},\\lambda)$: $G(\\lambda) = - R T \\ln Z(\\lambda)$ with $Z(\\lambda) = \\int \\exp\\big(-\\beta H(\\mathbf{x},\\lambda)\\big) \\, d\\mathbf{x}$, where $R$ is the ideal gas constant per mole, $T$ is temperature, and $\\beta = 1/(R T)$.\n- Work $W$ along a non-equilibrium manipulation of the parameter $\\lambda$ is the mechanical work performed by changing the Hamiltonian parameter, accumulated along the trajectory, consistent with the inclusive definition for a thermostatted ensemble. The values provided are realizations of this work in $\\mathrm{kJ\\,mol^{-1}}$ for completing the protocol from fully interacting to non-interacting.\n- Binding is defined via a closed thermodynamic cycle that includes decoupling the ligand in the complex, decoupling the ligand in solvent, and a restraint attachment step that confines a non-interacting ligand to a binding-site reference geometry to enforce the standard concentration $c^{\\circ} = 1\\,\\mathrm{mol\\,L^{-1}}$. The restraint term is provided directly as a per-mole free-energy cost of attaching restraints to a non-interacting ligand at the binding site, so that your program can include the standard-state correction consistently.\n\nYour task:\n- Derive, from the canonical ensemble and the definition of non-equilibrium work applied to $H(\\mathbf{x},\\lambda)$, the correct estimator that maps a set of non-equilibrium work values for decoupling into an equilibrium free-energy difference for each decoupling step.\n- Establish the correct sign convention for binding based on a closed thermodynamic cycle that includes: decoupling in the complex, decoupling in solvent, and restraint attachment. Ensure the restraint term is included in the correct direction to reference the standard state.\n- Implement the resulting estimator in your program to compute the binding free energy for each test case.\n\nUnits and output requirements:\n- All energies are in $\\mathrm{kJ\\,mol^{-1}}$.\n- Temperatures are in $\\mathrm{K}$.\n- Use $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ and convert appropriately to $\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$ when needed.\n- Your program must produce a single line of output containing a comma-separated list of the binding free energies for all test cases, rounded to three decimals, enclosed in square brackets. For example, the output format must be exactly like $[x_1,x_2,x_3]$.\n\nTest suite:\n- Case 1 (general case):\n  - Temperature: $300.0\\,\\mathrm{K}$\n  - Complex decoupling work values (fully interacting $\\rightarrow$ non-interacting): $[24.2,26.5,23.7,25.1,27.8,24.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values (fully interacting $\\rightarrow$ non-interacting): $[8.9,10.2,9.5,11.3,8.7,9.9]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy (non-interacting ligand confined to binding site, standard-state consistent): $6.2\\,\\mathrm{kJ\\,mol^{-1}}$\n- Case 2 (boundary condition: zero-variance work):\n  - Temperature: $298.15\\,\\mathrm{K}$\n  - Complex decoupling work values: $[20.0,20.0,20.0,20.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values: $[6.0,6.0,6.0,6.0]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy: $6.0\\,\\mathrm{kJ\\,mol^{-1}}$\n- Case 3 (edge case: higher temperature and broader distributions):\n  - Temperature: $310.0\\,\\mathrm{K}$\n  - Complex decoupling work values: $[18.0,22.5,20.1,19.7,21.3,17.9,24.0,16.5]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Solvent decoupling work values: $[12.0,14.5,13.8,15.2,13.0,14.1]\\,\\mathrm{kJ\\,mol^{-1}}$\n  - Restraint attachment free energy: $4.0\\,\\mathrm{kJ\\,mol^{-1}}$\n\nFinal specification:\n- Implement numerically stable averaging for exponentials of work to obtain decoupling free energies from the provided work realizations and temperatures.\n- Combine the decoupling free energies with the restraint attachment free energy according to the correct binding-cycle sign convention to produce the binding free energy in $\\mathrm{kJ\\,mol^{-1}}$ for each case.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, rounded to three decimals, exactly: $[x_1,x_2,x_3]$.",
            "solution": "The problem requires the computation of the standard binding free energy, $\\Delta G_{bind}^{\\circ}$, for a ligand-receptor system using data from non-equilibrium alchemical simulations. The solution involves two principal components: first, the application of Jarzynski's equality to estimate equilibrium free energy differences from non-equilibrium work values; and second, the construction of a thermodynamic cycle to relate these free energy differences to the binding affinity.\n\nThe foundational principle is the relationship between the Helmholtz or Gibbs free energy ($G$) and the canonical partition function ($Z$) for a system with a Hamiltonian $H(\\mathbf{x}, \\lambda)$ that depends on a set of coordinates $\\mathbf{x}$ and a coupling parameter $\\lambda$. For a system in thermal equilibrium with a heat bath at temperature $T$, the free energy is given by:\n$$ G(\\lambda) = -k_B T \\ln Z(\\lambda) $$\nwhere $k_B$ is the Boltzmann constant and $\\beta = 1/(k_B T)$. The partition function is an integral over all accessible microstates:\n$$ Z(\\lambda) = \\int e^{-\\beta H(\\mathbf{x}, \\lambda)} \\, d\\mathbf{x} $$\nSince the problem specifies energies in per-mole quantities (e.g., $\\mathrm{kJ\\,mol^{-1}}$), we replace the Boltzmann constant $k_B$ with the ideal gas constant $R$, and $\\beta$ is defined as $\\beta = 1/(RT)$.\n$$ G(\\lambda) = -RT \\ln Z(\\lambda) $$\n\nThe free energy difference $\\Delta G$ between two states defined by $\\lambda = \\lambda_A$ and $\\lambda = \\lambda_B$ is:\n$$ \\Delta G = G(\\lambda_B) - G(\\lambda_A) $$\nWhile this difference can be computed through equilibrium methods, the problem provides data from non-equilibrium trajectories. Jarzynski's equality provides the theoretical bridge between the work, $W$, performed on the system during a non-equilibrium transformation from state $\\lambda_A$ to $\\lambda_B$ and the equilibrium free energy difference $\\Delta G$. The equality states:\n$$ \\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta G} $$\nHere, the angle brackets $\\langle \\cdot \\rangle$ denote an average over an ensemble of an infinite number of non-equilibrium trajectories. Solving for $\\Delta G$ yields:\n$$ \\Delta G = -\\frac{1}{\\beta} \\ln \\langle e^{-\\beta W} \\rangle = -RT \\ln \\langle e^{-\\beta W} \\rangle $$\nIn practice, the average is estimated from a finite sample of $N$ work measurements, $W_1, W_2, \\dots, W_N$:\n$$ \\langle e^{-\\beta W} \\rangle \\approx \\frac{1}{N} \\sum_{i=1}^{N} e^{-\\beta W_i} $$\nSubstituting this estimator into the expression for $\\Delta G$, we obtain the formula to be implemented for calculating the free energy of decoupling:\n$$ \\Delta G_{\\text{decouple}} = -RT \\ln \\left( \\frac{1}{N} \\sum_{i=1}^{N} e^{-W_i/(RT)} \\right) $$\nThe direct computation of this expression can be numerically unstable due to floating-point limitations when the arguments of the exponential function are large and negative. A stable method involves recognizing that the expression is equivalent to:\n$$ \\Delta G_{\\text{decouple}} = -RT \\left( \\text{logsumexp}(-W_i/(RT)) - \\ln(N) \\right) $$\nwhere the `logsumexp` function computes the logarithm of the sum of exponentials in a way that prevents underflow and overflow. This is the estimator we will use.\n\nNext, we establish the thermodynamic cycle to calculate the standard binding free energy, $\\Delta G_{bind}^{\\circ}$. The process of binding is $P + L \\rightarrow P:L$, where $P$ is the protein, $L$ is the ligand, and $P:L$ is the complex. The states in our cycle are:\n1. $P:L$ (solvated complex)\n2. $P + L$ (solvated protein and ligand, separated)\n3. $P:L^*$ (complex with a non-interacting \"ghost\" ligand $L^*$)\n4. $P + L^*$ (separated protein and ghost ligand)\n\nThe cycle connects these states with four processes:\n(a) $P:L \\rightarrow P + L$: The unbinding of the ligand, with free energy change $\\Delta G_{unbind} = -\\Delta G_{bind}^{\\circ}$.\n(b) $P:L \\rightarrow P:L^*$: The decoupling of the ligand within the binding site. The free energy change is $\\Delta G_{decouple,complex}$, calculated from the complex decoupling work values.\n(c) $P+L \\rightarrow P+L^*$: The decoupling of the free ligand in solvent. Since the protein is a spectator, this is effectively $L \\rightarrow L^*$. The free energy change is $\\Delta G_{decouple,solvent}$, calculated from the solvent decoupling work values.\n(d) $P:L^* \\rightarrow P+L^*$: The release of the non-interacting ligand from the binding site into the bulk solvent, transitioning to the standard state concentration. The free energy for the reverse process (attaching the restraints to a free non-interacting ligand) is given as $\\Delta G_{restraint}$. Therefore, the free energy change for this release process is $-\\Delta G_{restraint}$.\n\nAs free energy is a state function, the sum of free energy changes around a closed cycle must be zero. Traversing the cycle $P+L \\rightarrow P:L \\rightarrow P:L^* \\rightarrow P+L^* \\rightarrow P+L$:\n$$ (\\Delta G_{bind}^{\\circ}) + (\\Delta G_{decouple,complex}) + (-\\Delta G_{restraint}) + (-\\Delta G_{decouple,solvent}) = 0 $$\nSolving for the standard binding free energy, $\\Delta G_{bind}^{\\circ}$:\n$$ \\Delta G_{bind}^{\\circ} = \\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex} + \\Delta G_{restraint} $$\nThis is the final expression to be implemented. A favorable binding event corresponds to a negative $\\Delta G_{bind}^{\\circ}$. Let us verify the signs. The decoupling free energies are positive costs. Typically, interactions in the complex are stronger than in the solvent, making $\\Delta G_{decouple,complex} > \\Delta G_{decouple,solvent}$. This results in a negative contribution $(\\Delta G_{decouple,solvent} - \\Delta G_{decouple,complex})$ to binding. The restraint free energy, $\\Delta G_{restraint}$, is the entropic cost of confining the ligand to the binding site and is a positive quantity, making binding less favorable. The signs in the derived equation are therefore physically consistent.\n\nThe calculation proceeds by first computing $\\Delta G_{decouple,complex}$ and $\\Delta G_{decouple,solvent}$ for each test case using the Jarzynski estimator and then combining them with the provided $\\Delta G_{restraint}$ value according to the derived thermodynamic cycle equation. The gas constant $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$ must be converted to $0.00831446261815324\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$ to match the units of the provided work values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Computes the binding free energy for a ligand using an alchemical decoupling\n    protocol and non-equilibrium work relations (Jarzynski's equality).\n    \"\"\"\n\n    # Define the gas constant in the required units.\n    # R is given in J mol^-1 K^-1. Work values are in kJ mol^-1.\n    # We convert R to kJ mol^-1 K^-1.\n    R_J_MOL_K = 8.31446261815324\n    R_KJ_MOL_K = R_J_MOL_K / 1000.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"temperature\": 300.0,\n            \"complex_work\": [24.2, 26.5, 23.7, 25.1, 27.8, 24.9],\n            \"solvent_work\": [8.9, 10.2, 9.5, 11.3, 8.7, 9.9],\n            \"restraint_dg\": 6.2,\n        },\n        {\n            \"temperature\": 298.15,\n            \"complex_work\": [20.0, 20.0, 20.0, 20.0],\n            \"solvent_work\": [6.0, 6.0, 6.0, 6.0],\n            \"restraint_dg\": 6.0,\n        },\n        {\n            \"temperature\": 310.0,\n            \"complex_work\": [18.0, 22.5, 20.1, 19.7, 21.3, 17.9, 24.0, 16.5],\n            \"solvent_work\": [12.0, 14.5, 13.8, 15.2, 13.0, 14.1],\n            \"restraint_dg\": 4.0,\n        },\n    ]\n\n    results = []\n\n    def calculate_delta_g_decouple(work_values: list[float], temp: float) -> float:\n        \"\"\"\n        Calculates the free energy difference from non-equilibrium work values\n        using Jarzynski's equality in a numerically stable way.\n        \n        Args:\n            work_values: A list of work values in kJ/mol.\n            temp: The temperature in Kelvin.\n            \n        Returns:\n            The estimated free energy difference in kJ/mol.\n        \"\"\"\n        work_array = np.array(work_values, dtype=np.float64)\n        num_trajectories = len(work_array)\n        \n        # RT term, also known as beta_inv, in kJ/mol\n        beta_inv = R_KJ_MOL_K * temp\n        \n        # When all work values are the same, the process is quasi-static,\n        # and Delta G = W. This avoids potential precision issues with the\n        # exponential average for this specific boundary condition.\n        if np.all(work_array == work_array[0]):\n            return work_array[0]\n            \n        # Exponents for Jarzynski's equality: -W / (RT)\n        exponents = -work_array / beta_inv\n        \n        # Calculate log of the ensemble average of exp(-beta*W)\n        # log(<exp(-beta*W)>) = log( (1/N) * sum(exp(-beta*W_i)) )\n        #                     = log(sum(exp(-beta*W_i))) - log(N)\n        # We use scipy.special.logsumexp for numerical stability.\n        log_avg_exp = logsumexp(exponents) - np.log(num_trajectories)\n        \n        # Delta G = -RT * log(<exp(-beta*W)>)\n        delta_g = -beta_inv * log_avg_exp\n        \n        return delta_g\n\n    for case in test_cases:\n        temp = case[\"temperature\"]\n        \n        # Calculate free energy of decoupling in the complex\n        dg_decouple_complex = calculate_delta_g_decouple(case[\"complex_work\"], temp)\n        \n        # Calculate free energy of decoupling in the solvent\n        dg_decouple_solvent = calculate_delta_g_decouple(case[\"solvent_work\"], temp)\n        \n        # Retrieve the restraint free energy\n        dg_restraint = case[\"restraint_dg\"]\n        \n        # Apply the thermodynamic cycle formula:\n        # dG_bind = dG_decouple,solvent - dG_decouple,complex + dG_restraint\n        dg_bind = dg_decouple_solvent - dg_decouple_complex + dg_restraint\n        \n        # Round the final result to three decimal places\n        results.append(round(dg_bind, 3))\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In steered molecular dynamics (SMD), we often apply an external, time-dependent potential to drive a system along a reaction coordinate. This exercise delves into the physical meaning of the work measured in such a protocol, using an analytically solvable model of a harmonic restraint pulling on a harmonic potential. By deriving the correction factor from first principles, you will see how the measured work $W_{\\mathrm{meas}}$ relates to the underlying potential of mean force (PMF), clarifying that what we measure is the free energy of a composite system and must be carefully analyzed to yield the property of interest .",
            "id": "3856253",
            "problem": "In a steered molecular dynamics protocol used to probe a one-dimensional reaction coordinate $x$ within a biomolecular complex, the underlying potential of mean force (PMF) near the region of interest is well-approximated by a harmonic form $U_{0}(x) = \\frac{a}{2}\\,x^{2}$, with curvature $a$ known from an independent equilibrium calculation. During pulling, a harmonic bias (the “spring”) of stiffness $k$ is applied, with center $\\lambda(t)$ translated at a constant speed from $\\lambda(0)=0$ to $\\lambda(\\tau)=L$. The total Hamiltonian is $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$. The measured pulling work $W_{\\mathrm{meas}}$ is defined as the time integral of the protocol work, $W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$. Assume that the pulling is sufficiently slow that the process is effectively reversible (quasi-static) and the system remains at temperature $T$ (canonical ensemble).\n\nUsing only fundamental statistical mechanics definitions of canonical free energy $F(\\lambda)=-k_{B}T\\ln Z(\\lambda)$ and the definition of protocol work $W=\\int_{0}^{\\tau}(\\partial H/\\partial t)\\,dt=\\int_{0}^{\\tau}(\\partial H/\\partial \\lambda)\\,\\dot{\\lambda}\\,dt$, and without invoking any specialized “shortcut” formulas, do the following:\n\n- Explain how a stiff spring (large $k$) changes the measured work by coupling the system to a moving restraint, and show that in the quasi-static limit $W_{\\mathrm{meas}}$ equals the free energy difference between the coupled Hamiltonians at $\\lambda=0$ and $\\lambda=L$.\n- Derive, by evaluating the canonical partition function $Z(\\lambda)$ for the coupled Hamiltonian, the functional form of $F(\\lambda)$ and hence the analytic expression for the quasi-static measured work $W_{\\mathrm{meas}}$ between $\\lambda=0$ and $\\lambda=L$ in terms of $a$, $k$, and $L$.\n- From first principles, devise a correction that converts this coupled-system free energy difference into the underlying physical PMF difference $\\Delta G_{\\mathrm{phys}}=G(L)-G(0)$ associated with $U_{0}(x)$ alone, and express $\\Delta G_{\\mathrm{phys}}$ in closed form in terms of $a$, $k$, and $W_{\\mathrm{meas}}$.\n\nThen, using your derived correction, compute the numerical value of the corrected physical free energy difference for the following parameter set, representative of a ligand translation in a protein tunnel:\n- Molecular PMF curvature $a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$,\n- Spring stiffness $k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$,\n- Pulling displacement $L = 0.2\\,\\mathrm{nm}$,\n- Reversible measured work obtained by averaging many slow pulls $W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$.\n\nExpress the final energy as a single real number in $\\mathrm{kJ\\,mol^{-1}}$ and round your answer to four significant figures.",
            "solution": "The problem has been validated and is a well-posed, scientifically sound query in the field of computational chemical biology. We will proceed with a full derivation and solution.\n\nThe problem asks for a multi-part analysis of a steered molecular dynamics (SMD) simulation in the quasi-static (reversible) limit. We will address each part in sequence using the provided definitions and first principles of statistical mechanics.\n\nFirst, we address the relationship between measured work and free energy. The total Hamiltonian of the coupled system is $H(x;\\lambda) = U_{0}(x) + \\frac{k}{2}\\,(x-\\lambda)^{2}$, where $\\lambda$ is the time-dependent control parameter. The canonical free energy of this coupled system is defined as $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$, where $Z(\\lambda)$ is the partition function for a given $\\lambda$:\n$$Z(\\lambda) = C \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\nHere, $C$ represents a constant factor arising from the kinetic energy (momentum integral), which is independent of $\\lambda$ and will not affect free energy differences. The change in free energy with respect to the control parameter $\\lambda$ is given by the derivative:\n$$\\frac{dF}{d\\lambda} = \\frac{d}{d\\lambda}\\left(-k_{B}T\\ln Z(\\lambda)\\right) = -k_{B}T \\frac{1}{Z(\\lambda)} \\frac{dZ(\\lambda)}{d\\lambda}$$\nThe derivative of the partition function is:\n$$\\frac{dZ(\\lambda)}{d\\lambda} = C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx$$\nSubstituting this back, we find:\n$$\\frac{dF}{d\\lambda} = -k_{B}T \\frac{1}{Z(\\lambda)} \\left[ C \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\frac{\\partial H(x;\\lambda)}{\\partial \\lambda}\\right) \\exp\\left(-\\frac{H(x;\\lambda)}{k_{B}T}\\right) dx \\right]$$\n$$\\frac{dF}{d\\lambda} = \\frac{C \\int \\frac{\\partial H}{\\partial \\lambda} \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx}{C \\int \\exp\\left(-\\frac{H}{k_{B}T}\\right) dx} = \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle$$\nThis demonstrates that the derivative of the free energy with respect to the control parameter is equal to the canonical ensemble average of the generalized force conjugate to that parameter.\n\nThe work done on the system, as defined in the problem, is $W_{\\mathrm{meas}}=\\int_{0}^{\\tau}\\frac{\\partial H}{\\partial \\lambda}\\,\\dot{\\lambda}\\,dt$. In a quasi-static process, the system is always in equilibrium at the instantaneous value of $\\lambda(t)$. Therefore, the fluctuating instantaneous force $\\frac{\\partial H}{\\partial \\lambda}$ can be replaced by its ensemble average $\\langle \\frac{\\partial H}{\\partial \\lambda} \\rangle$. The work integral becomes:\n$$W_{\\mathrm{meas}} = \\int_{0}^{\\tau} \\left\\langle \\frac{\\partial H}{\\partial \\lambda} \\right\\rangle \\dot{\\lambda}\\,dt = \\int_{0}^{\\tau} \\frac{dF}{d\\lambda} \\frac{d\\lambda}{dt} dt = \\int_{\\lambda(0)}^{\\lambda(\\tau)} dF$$\nGiven the limits $\\lambda(0)=0$ and $\\lambda(\\tau)=L$, the quasi-static work is exactly the free energy difference of the coupled system between its final and initial states:\n$$W_{\\mathrm{meas}} = F(L) - F(0)$$\nA stiff spring (large $k$) enhances the coupling between the system coordinate $x$ and the trap center $\\lambda$. The potential term $\\frac{k}{2}(x-\\lambda)^2$ penalizes deviations of $x$ from $\\lambda$. As $k \\to \\infty$, the particle is forced to track the trap center, i.e., $x(t) \\to \\lambda(t)$. The measured work reflects the energy change of this tightly coupled system, which is distinct from the energy change of the unperturbed system $U_0(x)$.\n\nNext, we derive the functional form of $F(\\lambda)$ and the expression for $W_{\\mathrm{meas}}$. We start by rewriting the Hamiltonian $H(x;\\lambda)$ by completing the square with respect to $x$:\n$$H(x;\\lambda) = \\frac{a}{2}x^2 + \\frac{k}{2}(x^2 - 2x\\lambda + \\lambda^2) = \\frac{a+k}{2}x^2 - k\\lambda x + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x^2 - \\frac{2k\\lambda}{a+k}x\\right) + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left[\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\left(\\frac{k\\lambda}{a+k}\\right)^2\\right] + \\frac{k}{2}\\lambda^2$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 - \\frac{k^2\\lambda^2}{2(a+k)} + \\frac{k(a+k)\\lambda^2}{2(a+k)}$$\n$$H(x;\\lambda) = \\frac{a+k}{2}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2 + \\frac{ak}{2(a+k)}\\lambda^2$$\nThe partition function $Z(\\lambda)$ is then:\n$$Z(\\lambda) = C \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{a+k}{2k_{B}T}\\left(x - \\frac{k\\lambda}{a+k}\\right)^2\\right) dx$$\nThe integral is a standard Gaussian integral, which evaluates to $\\sqrt{\\frac{2\\pi k_{B}T}{a+k}}$.\n$$Z(\\lambda) = C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}} \\exp\\left(-\\frac{ak\\lambda^2}{2k_{B}T(a+k)}\\right)$$\nThe free energy $F(\\lambda) = -k_{B}T\\ln Z(\\lambda)$ is:\n$$F(\\lambda) = -k_{B}T\\ln\\left(C \\sqrt{\\frac{2\\pi k_{B}T}{a+k}}\\right) + \\frac{ak}{2(a+k)}\\lambda^2$$\nThe first term is a constant with respect to $\\lambda$. Let's denote it $F_{\\text{ref}}$.\n$$F(\\lambda) = F_{\\text{ref}} + \\frac{ak}{2(a+k)}\\lambda^2$$\nUsing this functional form, the quasi-static work $W_{\\mathrm{meas}} = F(L) - F(0)$ is:\n$$W_{\\mathrm{meas}} = \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}L^2\\right) - \\left(F_{\\text{ref}} + \\frac{ak}{2(a+k)}0^2\\right)$$\n$$W_{\\mathrm{meas}} = \\frac{ak}{2(a+k)}L^2$$\n\nNow, we devise a correction to obtain the physical PMF difference $\\Delta G_{\\mathrm{phys}} = G(L) - G(0)$. The physical PMF is $G(x) = U_0(x) = \\frac{a}{2}x^2$. The desired quantity is:\n$$\\Delta G_{\\mathrm{phys}} = G(L) - G(0) = \\frac{a}{2}L^2 - 0 = \\frac{a}{2}L^2$$\nThe measured work $W_{\\mathrm{meas}}$ reflects pulling on a composite system. The system (spring constant $a$) and the biasing spring (constant $k$) act like two springs in series. The effective spring constant of such a system is $k_{\\text{eff}} = \\left(\\frac{1}{a} + \\frac{1}{k}\\right)^{-1} = \\frac{ak}{a+k}$. The work measured, $W_{\\mathrm{meas}} = \\frac{k_{\\text{eff}}}{2}L^2$, is the energy to extend this composite spring system by a distance $L$. Our goal, $\\Delta G_{\\mathrm{phys}}$, is the energy that would be stored in the physical spring *alone* if it were extended by the same distance $L$.\nWe can establish a direct relationship:\n$$\\frac{\\Delta G_{\\mathrm{phys}}}{W_{\\mathrm{meas}}} = \\frac{\\frac{a}{2}L^2}{\\frac{ak}{2(a+k)}L^2} = \\frac{a(a+k)}{ak} = \\frac{a+k}{k} = 1 + \\frac{a}{k}$$\nThus, we can express the physical free energy difference in terms of the measured work and the known system parameters $a$ and $k$:\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{a}{k}\\right) W_{\\mathrm{meas}}$$\nThis is the required correction. It scales the measured free energy of the coupled system to find the free energy of the underlying physical system. The correction factor $1 + \\frac{a}{k}$ is always greater than $1$, indicating that the measured work in this setup always underestimates the true free energy barrier being probed, because some of the pulling work goes into deforming the harmonic restraint itself.\n\nFinally, we compute the numerical value of $\\Delta G_{\\mathrm{phys}}$ using the provided data:\n$a = 250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$k = 1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}$\n$W_{\\mathrm{meas}} = 4.000\\,\\mathrm{kJ\\,mol^{-1}}$\n\nUsing the derived correction formula:\n$$\\Delta G_{\\mathrm{phys}} = \\left(1 + \\frac{250\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}{1000\\,\\mathrm{kJ\\,mol^{-1}\\,nm^{-2}}}\\right) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = (1 + 0.25) \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 1.25 \\times 4.000\\,\\mathrm{kJ\\,mol^{-1}}$$\n$$\\Delta G_{\\mathrm{phys}} = 5.000\\,\\mathrm{kJ\\,mol^{-1}}$$\nThe result is to be rounded to four significant figures. The calculated value is $5.000$.",
            "answer": "$$\\boxed{5.000}$$"
        },
        {
            "introduction": "The Jarzynski equality, $\\langle \\exp(-\\beta W) \\rangle = \\exp(-\\beta \\Delta F)$, is exact but can be statistically challenging to apply due to its reliance on an exponential average. This average is often dominated by rare, low-work trajectories, leading to high variance and poor convergence. This practice challenges you to confront this critical issue, exploring why these \"outliers\" are physically significant and how to diagnose their influence, while distinguishing statistically robust estimation methods from biased, ad-hoc fixes .",
            "id": "3856268",
            "problem": "A ligand is pulled from a protein binding pocket in a series of non-equilibrium steered molecular dynamics (SMD) realizations at temperature $T$, starting from equilibrium in the bound state. The mechanical work $W$ performed along each trajectory is recorded, yielding a set $\\{W_i\\}$ from the forward protocol and, optionally, a set $\\{W_j^{\\mathrm{rev}}\\}$ from the time-reversed protocol that starts in the unbound state. In this setting, an exponential average of work is used to estimate a state function that depends only on the initial and final thermodynamic states at fixed $T$. You are concerned that rare, low-work trajectories dominate this exponential average, causing high variance and sensitivity to outliers.\n\nStarting only from the following foundational bases:\n- Equilibrium initial conditions distributed according to the Boltzmann distribution $\\propto \\exp(-\\beta H)$ with $\\beta = 1/(k_{\\mathrm{B}} T)$ and Hamiltonian $H$.\n- Microscopic reversibility of the dynamics and detailed balance for equilibrium ensembles.\n- The definition of mechanical work $W$ as the path integral of generalized force times the protocol velocity along a trajectory.\n- The fact that any unbiased change of measure in sampling must be accompanied by the corresponding likelihood-ratio reweighting to preserve expectations.\n\nExplain why, for an exponential average over $W$, contributions from the lower tail of the work distribution (with $W$ substantially below its mean) become disproportionately important, and how this connects to the ratio of path probabilities for forward and reverse processes. Based on this reasoning, choose all strategies below that both (i) reliably detect when a small number of trajectories dominate the estimator and (ii) handle such dominance in a way that does not introduce statistical bias in the estimate of the underlying state function.\n\nA. Combine forward and reverse work datasets to apply the Bennett Acceptance Ratio (BAR), derived from the ratio of forward and reverse path probabilities, and assess overlap by comparing forward and reverse work histograms or their inferred crossing point; this reduces sensitivity to extreme tails without bias when its assumptions hold.\n\nB. Discard or winsorize the lowest-work fraction (e.g., the smallest fraction $p$ of $\\{W_i\\}$) before computing the exponential average to reduce variance, arguing that these events are outliers and their removal becomes negligible as the sample size grows.\n\nC. Use importance sampling that preferentially generates low-dissipation trajectories by adding a bias potential along the pulling coordinate during the non-equilibrium protocol; reweight each trajectory by the exact likelihood ratio between biased and unbiased path measures to recover the original expectation; monitor an effective sample size computed from normalized importance weights to detect weight degeneracy.\n\nD. Replace the exponential average by a second-order cumulant expansion around the mean work, regardless of dissipation, because truncating at second order suppresses the influence of outliers and remains unbiased as the number of trajectories increases.\n\nE. Prevent individual trajectories from dominating by capping each exponential weight at a fixed maximum value before averaging; this stabilizes the computation without altering the estimator’s expectation.\n\nF. Compute the exponential average using numerically stable transformations such as the log-sum-exp identity to avoid underflow/overflow, and use nonparametric bootstrap resampling across trajectories to quantify uncertainty and identify influential points; these diagnostics do not alter the estimator’s expectation.\n\nSelect all that apply and justify your choices using the fundamental bases listed above. Your justification should make explicit how outliers arise from the interplay between Boltzmann statistics, microscopic reversibility, and exponential reweighting, and how each proposed method does or does not preserve the expectation while diagnosing dominance by rare events.",
            "solution": "The problem statement is scientifically sound, well-posed, and objective. It describes a canonical problem in the application of non-equilibrium statistical mechanics to computational biology, namely the statistical challenges of estimating free energy differences using the Jarzynski Equality. The premises are grounded in established first principles, and the question is a rigorous test of understanding these principles and their statistical implications. The problem is valid.\n\nThe core of the problem lies in the Jarzynski Equality (JE), which relates the work $W$ performed on a system during a non-equilibrium transformation to the equilibrium free energy difference $\\Delta F$ between the initial and final states:\n$$\n\\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta F}\n$$\nHere, $\\beta = 1/(k_{\\mathrm{B}} T)$ and the average $\\langle \\cdot \\rangle$ is taken over an ensemble of realizations, each starting from a state sampled from the equilibrium Boltzmann distribution $\\propto \\exp(-\\beta H)$ of the initial thermodynamic state. For a finite number of trajectories $N$, the free energy is estimated as:\n$$\n\\Delta F_N = -\\frac{1}{\\beta} \\ln \\left( \\frac{1}{N} \\sum_{i=1}^{N} e^{-\\beta W_i} \\right)\n$$\nThe term $e^{-\\beta W_i}$ serves as a weight for each trajectory. Because work $W$ is in a negative exponent, trajectories with smaller work values contribute exponentially more to the sum. The second law of thermodynamics for non-equilibrium processes implies that the average work is greater than or equal to the free energy change, $\\langle W \\rangle \\ge \\Delta F$. Thus, most trajectories will have $W_i > \\Delta F$. The average is therefore dominated by the rare but statistically crucial trajectories for which $W_i$ is small, particularly those where $W_i \\approx \\Delta F$.\n\nThis phenomenon is explained by the Crooks Fluctuation Theorem (CFT), which stems from microscopic reversibility. The CFT relates the probability of observing a forward trajectory $\\mathbf{Z}(t)$ that produces work $W$ to the probability of its time-reversed counterpart $\\mathbf{Z}^{\\dagger}(t)$, which starts from the final equilibrium state and follows the time-reversed protocol. The ratio of their path probabilities is:\n$$\n\\frac{\\mathcal{P}_F[\\mathbf{Z}(t)]}{\\mathcal{P}_R[\\mathbf{Z}^{\\dagger}(t)]} = e^{\\beta(W - \\Delta F)} = e^{\\beta W_d}\n$$\nwhere $W_d = W - \\Delta F$ is the dissipated work.\n\nThis ratio shows that trajectories with low work ($W \\approx \\Delta F$) have low dissipated work ($W_d \\approx 0$). For these paths, the ratio of forward to reverse path probabilities is close to $1$, meaning they are nearly microscopically reversible. In a process driven far from equilibrium (high dissipation), such trajectories are exceedingly rare. The JE implicitly performs importance sampling: it uses trajectories sampled from the forward process to estimate a quantity that depends critically on rare events whose statistical weight is more representative of the reverse process. Poor overlap between the typical forward work values and the low-work region results in a few rare samples dominating the estimate, causing high variance.\n\nA valid strategy must correctly diagnose this dominance and address it without introducing statistical bias into the estimate of $\\Delta F$.\n\n**Analysis of Option A:**\nThe Bennett Acceptance Ratio (BAR) method estimates $\\Delta F$ by optimally combining data from both forward ($F$) and reverse ($R$) protocols. It is derived from the CFT and its solution for $\\Delta F$ is found by solving an implicit equation that weights data points based on the Fermi function. This weighting scheme naturally reduces the influence of extreme work values from either distribution, making it robust against outliers in the tails. The quality of the BAR estimate depends on the overlap between the forward work distribution, $P_F(W)$, and the reverse work distribution, $P_R(-W^{\\mathrm{rev}})$. A visual comparison of these distributions (e.g., via histograms) and locating their crossing point (which theoretically occurs at $W=\\Delta F$) is a direct and reliable way to detect poor sampling and potential dominance issues. Because BAR is derived from Maximum Likelihood principles applied to the CFT, it is asymptotically unbiased and has been shown to have the minimum variance among a large class of bidirectional estimators. Therefore, this strategy both reliably detects potential dominance (via overlap assessment) and handles it using a statistically sound, unbiased estimator.\n**Verdict: Correct.**\n\n**Analysis of Option B:**\nThis strategy proposes discarding or winsorizing (capping) the lowest-work trajectories. These trajectories are precisely the ones that provide the most crucial information for converging the exponential average. The Jarzynski Equality is an exact identity; removing the data points that contribute most significantly to this identity fundamentally breaks it. This procedure introduces a systematic and uncontrolled bias, which will lead to an overestimation of $\\Delta F$ (as $\\langle e^{-\\beta W} \\rangle$ will be underestimated). The argument that the effect is negligible for large sample sizes is incorrect; these trajectories are not erroneous outliers but essential samples from the tail of the work distribution. The method fails to meet the criterion of being unbiased.\n**Verdict: Incorrect.**\n\n**Analysis of Option C:**\nThis describes a rigorous importance sampling (IS) scheme. By adding a bias potential, the sampling dynamics are altered to preferentially generate low-dissipation (low-work) trajectories that are rare under the unbiased dynamics. To correct for this intentional change of measure, each trajectory's contribution to the average is reweighted by the appropriate likelihood ratio, a factor derived from the work done by the bias potential. This procedure is, by construction, statistically exact and does not introduce bias into the expectation value. The problem of dominance by a few trajectories in the original estimator manifests in the IS scheme as \"weight degeneracy,\" where a few of the reweighted trajectories have importance weights close to $1$ while all others are close to $0$. This degeneracy can be reliably detected by monitoring the effective sample size ($N_{\\text{eff}}$), typically calculated from the variance of the normalized importance weights. A low $N_{\\text{eff}}$ signals that the estimate is dominated by a few trajectories. A well-designed bias potential will \"handle\" the dominance by broadening the weight distribution and increasing $N_{\\text{eff}}$, thus reducing the variance of the $\\Delta F$ estimate. This strategy provides both a method for detection and an unbiased way of handling the problem.\n**Verdict: Correct.**\n\n**Analysis of Option D:**\nThis proposes using the second-order cumulant expansion, $\\Delta F \\approx \\langle W \\rangle - \\frac{\\beta}{2} \\sigma_W^2$. This is an approximation, not an equality, unless the work distribution $P(W)$ is Gaussian. For processes far from equilibrium, $P(W)$ is typically highly skewed and non-Gaussian. Truncating the cumulant series at second order ignores all higher-order cumulants and introduces a systematic bias that depends on the degree of dissipation. This bias does not vanish as the number of trajectories increases; the estimator converges to the wrong value. While using only the mean and variance suppresses the influence of individual tail events, it does so at the cost of statistical validity. The method is biased and is only accurate in the near-equilibrium limit.\n**Verdict: Incorrect.**\n\n**Analysis of Option E:**\nCapping the exponential weights, $w_i = e^{-\\beta W_i}$, is an ad-hoc procedure similar to option B. It artificially truncates the contributions from the most important low-work trajectories. While this might stabilize the numerical value of the average, it does so by breaking the underlying equality. The statement that this \"does not alter the estimator's expectation\" is false. By capping the weights, one is no longer computing an estimate of $\\langle e^{-\\beta W} \\rangle$, but of a different, biased quantity. This introduces systematic error into the final $\\Delta F$ estimate.\n**Verdict: Incorrect.**\n\n**Analysis of Option F:**\nThis option combines two valid procedures. First, using the log-sum-exp identity is a standard numerical technique to compute the exponential average while avoiding floating-point overflow or underflow. This is an exact transformation that does not alter the mathematical value of the estimator, thus it introduces no bias. Second, nonparametric bootstrapping is a powerful statistical method for assessing the uncertainty of an estimator. By repeatedly resampling from the original set of trajectories and re-computing $\\Delta F$, one can build a distribution of estimates. If the original estimate is dominated by one or a few influential trajectories, the bootstrap distribution will be extremely broad or multimodal, reliably detecting the instability of the estimator. This diagnostic procedure \"handles\" the dominance issue by correctly quantifying the estimator's large variance (i.e., high uncertainty), which prevents reporting a statistically meaningless point estimate with false confidence. This is a crucial part of a sound statistical analysis. Crucially, bootstrapping is a post-processing analysis that does not alter the expectation of the original estimator, and thus introduces no bias.\n**Verdict: Correct.**",
            "answer": "$$\\boxed{ACF}$$"
        }
    ]
}