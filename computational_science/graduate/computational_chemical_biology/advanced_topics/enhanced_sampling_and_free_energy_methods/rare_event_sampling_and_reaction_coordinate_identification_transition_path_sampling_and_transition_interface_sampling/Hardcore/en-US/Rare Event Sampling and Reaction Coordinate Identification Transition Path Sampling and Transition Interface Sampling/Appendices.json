{
    "hands_on_practices": [
        {
            "introduction": "The core challenge in simulating rare events is the vast timescale separation between fluctuations within a stable state and the infrequent transitions between states. Before delving into the complex algorithms of Transition Path Sampling (TPS) and Transition Interface Sampling (TIS), it is essential to grasp the fundamental energetic origin of this rarity. This exercise invites you to analyze the archetypal double-well potential, a cornerstone model in chemical physics, to quantitatively connect the potential energy barrier height, $\\Delta U$, to the exponential suppression of transition probability, giving rise to the famous Arrhenius factor .",
            "id": "3861440",
            "problem": "Consider a one-dimensional reaction coordinate $x$ describing a conformational transition of a biomolecule in a thermal bath at temperature $T$, with potential energy landscape given by $U(x) = ax^4 - bx^2$ for constants $a>0$ and $b>0$. The system is in the canonical ensemble with inverse temperature $\\beta = 1/(k_B T)$, where $k_B$ is the Boltzmann constant. Assume overdamped dynamics with $x$ as an adequate reaction coordinate and a well-separated timescale between intra-basin equilibration and inter-basin transitions.\n\nStarting from the canonical probability density $p(x) \\propto \\exp(-\\beta U(x))$ and general considerations of path-ensemble reweighting used in Transition Path Sampling (TPS) and Transition Interface Sampling (TIS), do the following:\n\n1. Determine the locations and character (minimum or maximum) of the stationary points of $U(x)$, and compute the barrier height $\\Delta U$ between a minimum and the barrier top.\n\n2. Using only canonical equilibrium reasoning and the notion that reactive trajectories must visit the barrier region, argue how the rarity of transitions is controlled by the energetic barrier through the exponential reweighting of configurations. In the high-barrier limit and under the assumption that $x$ is a suitable reaction coordinate, deduce the functional form of the dominant exponential factor governing the likelihood of observing a reactive trajectory in TPS/TIS.\n\nExpress your final answer as the closed-form analytic expression for the Arrhenius factor $\\exp(-\\beta \\Delta U)$ in terms of $a$, $b$, $k_{B}$, and $T$. No numerical evaluation is required, and no units are to be included in the final boxed expression.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of statistical mechanics and computational chemistry, specifically using the standard double-well potential model to explore concepts of rare event sampling. The problem is well-posed, with all necessary parameters and assumptions provided ($U(x)=a x^{4}-b x^{2}$ with $a0$, $b0$, canonical ensemble, overdamped dynamics) to determine a unique, meaningful solution. The language is objective and the tasks are formalizable.\n\nWe proceed with the solution in two parts as requested.\n\nPart 1: Stationary points and barrier height calculation.\nThe potential energy landscape is given by the function $U(x) = a x^{4} - b x^{2}$, where $a > 0$ and $b > 0$.\n\nTo find the stationary points, we must find the values of $x$ for which the first derivative of the potential energy with respect to $x$ is zero.\n$$\n\\frac{dU(x)}{dx} = \\frac{d}{dx}(a x^{4} - b x^{2}) = 4 a x^{3} - 2 b x\n$$\nSetting the derivative to zero gives:\n$$\n4 a x^{3} - 2 b x = 0\n$$\n$$\n2x (2 a x^{2} - b) = 0\n$$\nThis equation has three solutions for the locations of the stationary points:\n$1$. $x = 0$\n$2$. $2 a x^{2} - b = 0 \\implies x^{2} = \\frac{b}{2a} \\implies x = \\pm\\sqrt{\\frac{b}{2a}}$\n\nSo, the three stationary points are $x_{0} = 0$, $x_{+} = +\\sqrt{\\frac{b}{2a}}$, and $x_{-} = -\\sqrt{\\frac{b}{2a}}$.\n\nTo determine the character of these stationary points (minimum, maximum, or saddle point), we compute the second derivative of the potential energy, $U''(x)$:\n$$\nU''(x) = \\frac{d^2U(x)}{dx^2} = \\frac{d}{dx}(4 a x^{3} - 2 b x) = 12 a x^{2} - 2 b\n$$\nWe evaluate the sign of $U''(x)$ at each stationary point:\n- At $x = x_{0} = 0$:\n  $U''(0) = 12 a (0)^{2} - 2 b = -2b$. Since $b > 0$, $U''(0)  0$. This indicates that the stationary point at $x=0$ is a local maximum, corresponding to the top of the potential energy barrier.\n- At $x = x_{\\pm} = \\pm\\sqrt{\\frac{b}{2a}}$:\n  $x_{\\pm}^{2} = \\frac{b}{2a}$.\n  $U''(\\pm\\sqrt{\\frac{b}{2a}}) = 12 a \\left(\\frac{b}{2a}\\right) - 2 b = 6b - 2b = 4b$. Since $b > 0$, $U''(\\pm\\sqrt{\\frac{b}{2a}})  0$. This indicates that the stationary points at $x = \\pm\\sqrt{\\frac{b}{2a}}$ are local minima, corresponding to the stable or metastable states of the system.\n\nNow, we compute the barrier height, $\\Delta U$. This is defined as the difference in potential energy between the barrier top (local maximum) and the bottom of one of the potential wells (local minimum).\nThe energy at the barrier top ($x=0$) is:\n$$\nU_{\\text{max}} = U(0) = a(0)^{4} - b(0)^{2} = 0\n$$\nThe energy at the minima ($x=\\pm\\sqrt{\\frac{b}{2a}}$) is:\n$$\nU_{\\text{min}} = U\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right) = a\\left(\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right)^2\\right)^2 - b\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right)^2 = a\\left(\\frac{b}{2a}\\right)^{2} - b\\left(\\frac{b}{2a}\\right)\n$$\n$$\nU_{\\text{min}} = a\\frac{b^2}{4a^2} - \\frac{b^2}{2a} = \\frac{b^2}{4a} - \\frac{b^2}{2a} = -\\frac{b^2}{4a}\n$$\nThe barrier height $\\Delta U$ is the difference between these two energy values:\n$$\n\\Delta U = U_{\\text{max}} - U_{\\text{min}} = 0 - \\left(-\\frac{b^2}{4a}\\right) = \\frac{b^2}{4a}\n$$\n\nPart 2: Conceptual argument and deduction of the dominant exponential factor.\nThe system is in a canonical ensemble at inverse temperature $\\beta = 1/(k_{B}T)$. The probability density of finding the system at a configuration $x$ is given by the Boltzmann distribution:\n$$\np(x) = \\frac{\\exp(-\\beta U(x))}{Z}\n$$\nwhere $Z = \\int \\exp(-\\beta U(x)) dx$ is the partition function. This means that the probability of occupying a state with energy $U(x)$ is exponentially suppressed. States with high energy are much less probable than states with low energy.\n\nA reactive trajectory is a path in configuration space that connects the two stable basins, i.e., the region around $x_{-} = -\\sqrt{b/2a}$ and the region around $x_{+} = +\\sqrt{b/2a}$. For any such continuous path to exist, it must necessarily pass through all intermediate points, including the transition state region around the barrier top at $x=0$.\n\nThe rarity of such transitions stems directly from the low probability of accessing the high-energy configurations that constitute the barrier region. The assumption of timescale separation implies that the system equilibrates rapidly within a basin before making a rare, stochastic fluctuation large enough to surmount the barrier. The rate-limiting step for the entire transition process is the act of crossing the barrier.\n\nIn path sampling methods like TPS and TIS, we are interested in the ensemble of reactive paths. The statistical weight of any path is related to the energies of the configurations that make up the path. The likelihood of a transition is dominated by the probability of sampling the most \"unfavorable\" (i.e., highest energy) configuration along the reactive path. For a simple one-dimensional potential like $U(x)$, this configuration is the one at the top of the barrier, $x=0$.\n\nWe can quantify this by considering the ratio of probabilities of finding the system at the barrier top versus in a stable minimum:\n$$\n\\frac{p(x=0)}{p(x=x_{\\pm})} = \\frac{\\exp(-\\beta U(0)) / Z}{\\exp(-\\beta U(x_{\\pm})) / Z} = \\frac{\\exp(-\\beta U_{\\text{max}})}{\\exp(-\\beta U_{\\text{min}})} = \\exp(-\\beta(U_{\\text{max}} - U_{\\text{min}})) = \\exp(-\\beta \\Delta U)\n$$\nIn the high-barrier limit, where $\\beta \\Delta U \\gg 1$, this ratio is very small. This indicates that observing the system at the barrier top is an exponentially rare event. Since visiting the barrier top is a necessary condition for a reactive transition, the probability (and thus the rate) of the transition is primarily governed by this factor. The likelihood of observing a reactive trajectory is proportional to the probability of visiting the transition state. Therefore, the dominant exponential factor that controls the rarity of transitions and governs the likelihood of observing a reactive trajectory is $\\exp(-\\beta \\Delta U)$. This is the cornerstone of Arrhenius rate theory and is a central concept in understanding rare events.\n\nFinally, we are asked to provide the expression for this Arrhenius factor, $\\exp(-\\beta \\Delta U)$, in terms of the given parameters. Substituting our calculated $\\Delta U = \\frac{b^2}{4a}$ and the definition $\\beta = \\frac{1}{k_{B}T}$:\n$$\n\\exp(-\\beta \\Delta U) = \\exp\\left(-\\frac{1}{k_{B}T} \\cdot \\frac{b^2}{4a}\\right) = \\exp\\left(-\\frac{b^2}{4ak_{B}T}\\right)\n$$\nThis is the final expression for the dominant exponential factor.",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{b^2}{4ak_{B}T}\\right)}\n$$"
        },
        {
            "introduction": "Effective application of interface-based methods like TIS hinges on the choice of a reaction coordinate, $\\lambda$, that accurately tracks progress from the reactant to the product state. In realistic, high-dimensional systems, a perfectly chosen reaction coordinate is a rarity in itself, and misalignment with the true transition mechanism is common. This practice explores the critical, and often subtle, consequences of using an imperfect reaction coordinate, introducing the concepts of the committor function, $q(\\mathbf{r})$, and the phenomenon of hysteresis, which severely degrades sampling efficiency .",
            "id": "3861452",
            "problem": "Consider overdamped Langevin dynamics for a biomolecular conformational change idealized by a two-dimensional coordinate $\\mathbf{r}=(x,y)$ evolving under a smooth potential energy $U(x,y)$ at temperature $T$ with friction coefficient $\\gamma$. The dynamics are\n$$\n\\gamma \\,\\dot{x}(t) = -\\partial_x U(x,y) + \\sqrt{2 \\gamma k_{\\mathrm{B}} T}\\,\\eta_x(t), \\quad \\gamma \\,\\dot{y}(t) = -\\partial_y U(x,y) + \\sqrt{2 \\gamma k_{\\mathrm{B}} T}\\,\\eta_y(t),\n$$\nwhere $k_{\\mathrm{B}}$ is Boltzmannâ€™s constant and $\\eta_x(t)$, $\\eta_y(t)$ are independent Gaussian white noises of zero mean and delta correlation. Define the reactant basin $A$ and product basin $B$ as disjoint regions separated by a single dominant saddle. The committor function $q(x,y)$ is the probability that a trajectory initiated at $(x,y)$ with thermal noise reaches basin $B$ before basin $A$. By definition, the committor satisfies the backward Smoluchowski equation with absorbing boundary conditions $q=0$ on $A$ and $q=1$ on $B$.\n\nNear the saddle point at $\\mathbf{r}=\\mathbf{0}$, assume the potential is well-approximated by a quadratic form with an orthogonal stiff and soft direction, but rotated with respect to the Cartesian axes through a mixed term:\n$$\nU(x,y) \\approx U^\\ddagger + \\frac{1}{2}\\left(-k_u x^2 + k_s y^2\\right) + \\alpha x y,\n$$\nwhere $U^\\ddagger$ is the saddle energy, $k_u>0$ sets the unstable curvature, $k_s>0$ sets the stable curvature, and $\\alpha$ controls the rotation of the principal axes and the coupling between $x$ and $y$. Consider using the naive reaction coordinate $\\lambda(x,y)=x$ to construct interfaces $\\{\\lambda=\\lambda_i\\}$ for Transition Interface Sampling (TIS). In this setting, rare event sampling efficiency depends on how well $\\lambda(x,y)$ is aligned with the committor $q(x,y)$, which near the saddle is approximately a monotone function of the coordinate along the unstable manifold determined by the linearized drift.\n\nWhich of the following statements is/are correct about how misalignment of the naive reaction coordinate with the committor leads to hysteresis and poor sampling efficiency in interface-based methods such as TIS?\n\nA. Even when $\\lambda(x,y)=x$ is misaligned with the gradient of the committor near the saddle, the TIS rate estimate remains unbiased because it factors a flux through the first interface and conditional interface-to-interface probabilities; however, hysteresis manifests as multiple recrossings of $\\{\\lambda=\\lambda_i\\}$ due to fast relaxation in the stiff mode, inflating the variance of the estimator and lowering efficiency.\n\nB. Misalignment of $\\lambda(x,y)$ with the committor makes the committor non-monotone in configuration space and invalidates the basin definitions $A$ and $B$, causing Transition Path Sampling (TPS) to fail to converge to the true reactive path ensemble.\n\nC. If interfaces are exactly aligned with isocommittor surfaces, hysteresis is eliminated and the conditional probability to reach the next interface before returning to the previous one is exactly $1$ for every interface.\n\nD. Under linearized dynamics near the saddle with isotropic thermal noise, the expected probability that a path initiated on $\\{\\lambda=\\lambda_i\\}$ advances to $\\{\\lambda=\\lambda_{i+1}\\}$ before returning scales approximately with the squared cosine of the misalignment angle $\\theta$ between $\\nabla \\lambda$ and $\\nabla q$; thus, a misalignment of $\\theta=45^\\circ$ reduces acceptance by about a factor of $2$.\n\nE. In the presence of a stiff orthogonal mode, using a single collective variable $\\lambda$ for interfaces necessarily biases the TIS rate constant estimate upward because reactive trajectories are trapped and counted multiple times as successful crossings.\n\nSelect all that apply.",
            "solution": "The problem asks to evaluate statements regarding the consequences of using a misaligned reaction coordinate in interface-based rare event sampling methods like Transition Interface Sampling (TIS). The system is described by two-dimensional overdamped Langevin dynamics on a potential energy surface with a saddle point.\n\nFirst, we establish the theoretical framework. The dynamics are given by:\n$$ \\gamma \\dot{\\mathbf{r}}(t) = -\\nabla U(\\mathbf{r}) + \\sqrt{2 \\gamma k_{\\mathrm{B}} T} \\mathbf{\\eta}(t) $$\nwhere $\\mathbf{r}=(x,y)$, $U(x,y)$ is the potential energy, $\\gamma$ is the friction coefficient, $T$ is the temperature, $k_{\\mathrm{B}}$ is Boltzmann's constant, and $\\mathbf{\\eta}(t)$ is a vector of independent Gaussian white noises.\n\nThe rate of transition from a reactant basin $A$ to a product basin $B$ can be calculated using TIS. The TIS formula for the rate constant is:\n$$ k_{AB} = \\phi_A(\\lambda_0) P(\\lambda_B | \\lambda_0) $$\nwhere $\\phi_A(\\lambda_0)$ is the flux of trajectories leaving $A$ and crossing the first interface $\\lambda=\\lambda_0$ for the first time. $P(\\lambda_B | \\lambda_0)$ is the probability that a trajectory starting at interface $\\lambda_0$ will reach the product basin $B$ (defined by the last interface $\\lambda_N$) before returning to $A$. This probability is typically calculated as a product of conditional probabilities between successive interfaces $\\{\\lambda_i\\}$:\n$$ P(\\lambda_B | \\lambda_0) = \\prod_{i=0}^{N-1} P(\\lambda_{i+1} | \\lambda_i) $$\nwhere $P(\\lambda_{i+1} | \\lambda_i)$ is the probability that a trajectory initiated on interface $\\lambda_i$ reaches $\\lambda_{i+1}$ before any preceding interface $\\lambda_j$ with $ji$. This formulation is formally exact, meaning the TIS rate constant estimator is unbiased, irrespective of the choice of the reaction coordinate $\\lambda(\\mathbf{r})$ used to define the interfaces. The choice of $\\lambda$ critically affects the statistical efficiency (i.e., the variance) of the calculation.\n\nAn ideal reaction coordinate is the committor function, $q(\\mathbf{r})$, which is the probability that a trajectory starting at $\\mathbf{r}$ reaches basin $B$ before basin $A$. The level sets of the committor, $q(\\mathbf{r}) = \\text{const}$, are known as isocommittor surfaces. The optimal choice for interfaces in TIS are these isocommittor surfaces. This means the gradient of the chosen reaction coordinate, $\\nabla \\lambda$, should be parallel to the gradient of the committor, $\\nabla q$.\n\nThe problem considers a potential near the saddle point $(\\mathbf{r}=\\mathbf{0})$:\n$$ U(x,y) \\approx U^\\ddagger + \\frac{1}{2}\\left(-k_u x^2 + k_s y^2\\right) + \\alpha x y $$\nThe Hessian matrix of the potential at the saddle point is $\\mathbf{H}_U = \\begin{pmatrix} -k_u  \\alpha \\\\ \\alpha  k_s \\end{pmatrix}$. The eigenvectors of this matrix define the principal axes of curvature. The eigenvector corresponding to the negative eigenvalue defines the direction of the unstable mode, which is the direction along which reactive trajectories progress over the saddle. Near the saddle, $\\nabla q$ is aligned with this unstable eigenvector. If the coupling term $\\alpha \\neq 0$, the eigenvectors are not aligned with the Cartesian axes.\n\nThe proposed reaction coordinate is $\\lambda(x,y) = x$. Its gradient is $\\nabla\\lambda = (1, 0)$, a constant vector along the x-axis. Thus, if $\\alpha \\neq 0$, $\\nabla \\lambda$ is misaligned with $\\nabla q$. The angle between them is non-zero. This misalignment is the source of sampling inefficiency. When a trajectory crosses an interface $\\lambda(x,y) = x_i$, there is a component of the deterministic force, $-\\nabla U$, that is parallel to the interface. This force, especially the strong restoring force from the stiff stable mode (related to $k_s$), can quickly pull the trajectory back across the interface it just crossed. This phenomenon of rapid recrossings is often called hysteresis and is a key signature of a poor reaction coordinate.\n\nNow we evaluate each statement:\n\n**A. Even when $\\lambda(x,y)=x$ is misaligned with the gradient of the committor near the saddle, the TIS rate estimate remains unbiased because it factors a flux through the first interface and conditional interface-to-interface probabilities; however, hysteresis manifests as multiple recrossings of $\\{\\lambda=\\lambda_i\\}$ due to fast relaxation in the stiff mode, inflating the variance of the estimator and lowering efficiency.**\nThis statement is entirely correct. As explained above, the TIS formalism provides an unbiased estimator for the rate constant regardless of the reaction coordinate choice. The misalignment between the interfaces $\\{\\lambda=\\lambda_i\\}$ and the true isocommittor surfaces leads to frequent recrossings. These recrossings mean that a very large number of trajectories must be sampled to obtain a statistically meaningful estimate of the small probability $P(\\lambda_{i+1}|\\lambda_i)$ that a trajectory successfully advances. This high statistical uncertainty translates to a large variance in the final rate constant estimate, hence poor sampling efficiency. The physical reason for the recrossings is indeed the fast relaxation along the stiff potential mode orthogonal to the true reactive pathway.\n**Verdict: Correct.**\n\n**B. Misalignment of $\\lambda(x,y)$ with the committor makes the committor non-monotone in configuration space and invalidates the basin definitions $A$ and $B$, causing Transition Path Sampling (TPS) to fail to converge to the true reactive path ensemble.**\nThis statement is incorrect on multiple grounds.\n1. The committor $q(x,y)$ is an intrinsic property of the system dynamics and potential energy surface. Its definition and properties, including its monotonicity along the true reaction pathway, are independent of any arbitrarily chosen coordinate $\\lambda(x,y)$. Misalignment does not alter the committor itself.\n2. The definitions of basins $A$ and $B$ are inputs to the problem, typically defined based on stable minima of the potential energy surface. They are not affected by the choice of $\\lambda$.\n3. Transition Path Sampling (TPS) in its original form does not rely on interfaces or a reaction coordinate. It samples the ensemble of paths connecting $A$ and $B$. While a poor choice of initial path can make sampling inefficient, the algorithm does not fundamentally \"fail to converge\" because of a misaligned auxiliary coordinate.\n**Verdict: Incorrect.**\n\n**C. If interfaces are exactly aligned with isocommittor surfaces, hysteresis is eliminated and the conditional probability to reach the next interface before returning to the previous one is exactly $1$ for every interface.**\nThis statement is incorrect. While aligning interfaces with isocommittor surfaces, $\\lambda(\\mathbf{r}) \\propto q(\\mathbf{r})$, is optimal and eliminates recrossings due to deterministic relaxation, it does not eliminate recrossings caused by thermal fluctuations. The Langevin dynamics include a stochastic noise term, $\\mathbf{\\eta}(t)$. This term means that a trajectory at an interface $q=q_i$ can move in any direction, including backwards towards a lower committor value $q_{i-1}$. Therefore, the probability of advancing to the next interface $q_{i+1}$ before returning to $q_{i-1}$ is strictly less than $1$. For a one-dimensional diffusion process along the committor coordinate, this probability is given by $(q_i - q_{i-1}) / (q_{i+1} - q_{i-1})$ (assuming $q=0$ at the starting basin boundary and linear interpolation), which is clearly not $1$.\n**Verdict: Incorrect.**\n\n**D. Under linearized dynamics near the saddle with isotropic thermal noise, the expected probability that a path initiated on $\\{\\lambda=\\lambda_i\\}$ advances to $\\{\\lambda=\\lambda_{i+1}\\}$ before returning scales approximately with the squared cosine of the misalignment angle $\\theta$ between $\\nabla \\lambda$ and $\\nabla q$; thus, a misalignment of $\\theta=45^\\circ$ reduces acceptance by about a factor of $2$.**\nThis statement is correct. It reflects a known result from the theoretical analysis of path sampling methods. The misalignment angle $\\theta$ is the angle between the normal to the chosen interface, $\\nabla \\lambda$, and the direction of the true reactive pathway, $\\nabla q$. The probability of a successful transition between interfaces depends on the effective flux in the forward direction. This flux is reduced by geometric projections. Detailed theoretical models (e.g., by Berezhkovskii and Szabo, or analysis in the context of Forward Flux Sampling) show that the crossing probability $P(\\lambda_{i+1}|\\lambda_i)$ often scales as $\\cos^2(\\theta)$. This scaling arises because both the effective velocity component perpendicular to the interface and the geometric \"target size\" on the next interface are reduced by factors related to $\\cos(\\theta)$. If the probability scales as $\\cos^2(\\theta)$, a misalignment of $\\theta = 45^\\circ$ would lead to a factor of $\\cos^2(45^\\circ) = (1/\\sqrt{2})^2 = 1/2$. This reduces the probability by a factor of $2$, severely impacting sampling efficiency.\n**Verdict: Correct.**\n\n**E. In the presence of a stiff orthogonal mode, using a single collective variable $\\lambda$ for interfaces necessarily biases the TIS rate constant estimate upward because reactive trajectories are trapped and counted multiple times as successful crossings.**\nThis statement is incorrect. As discussed in point A, the TIS method is constructed to be formally unbiased. The choice of reaction coordinate affects the variance of the estimate, not its mean. The claim of an upward bias is false. Furthermore, the justification is flawed. Frequent recrossings do not lead to multiple counting of \"successful\" crossings. In TIS, a successful transition from $\\lambda_i$ to $\\lambda_{i+1}$ is a path segment that reaches $\\lambda_{i+1}$ without returning to $\\lambda_i$ or any previous interface. Recrossings of $\\lambda_i$ are part of paths that fail to make a successful transition, and they correctly contribute to a *lower* calculated value for the conditional probability $P(\\lambda_{i+1}|\\lambda_i)$, which in turn increases the variance of the estimator, but does not introduce a bias.\n**Verdict: Incorrect.**\n\nIn summary, statements A and D correctly describe the consequences of using a misaligned reaction coordinate in TIS.",
            "answer": "$$\\boxed{AD}$$"
        },
        {
            "introduction": "Ultimately, path sampling methods are realized through numerical simulations, and their accuracy is limited by the approximations made, most notably the use of a finite time step, $\\Delta t$, in the integration of the equations of motion. A rigorous computational study is not complete without assessing and correcting for the systematic biases introduced by such numerical choices. This final practice moves from theory to the essential task of data analysis, guiding you through a procedure to quantify integrator-induced bias by extrapolating results from several finite time steps to the continuum limit of $\\Delta t \\to 0$ .",
            "id": "3861345",
            "problem": "You are given a computational task grounded in Transition Path Sampling (TPS) and Transition Interface Sampling (TIS), both of which are rare event sampling methods used in computational chemical biology to estimate reaction rates between metastable states. The TIS expression for the rate constant from state $A$ to state $B$ is the product of a flux and a conditional crossing probability, written as $k_{AB} = \\Phi_{A}(\\lambda_0) \\cdot P_{A\\rightarrow B}(\\lambda_B \\mid \\lambda_0)$, where $\\Phi_{A}(\\lambda_0)$ is the flux of trajectories from $A$ crossing the first interface at $\\lambda_0$ per unit time, and $P_{A\\rightarrow B}(\\lambda_B \\mid \\lambda_0)$ is the conditional probability that a trajectory that crosses $\\lambda_0$ reaches the target interface $\\lambda_B$ before returning to $A$. Due to finite time-step numerical integration, measured rates $k_{AB}(\\Delta t)$ may be biased away from the zero time-step limit, with symmetric, time-reversible integrators typically exhibiting leading-order even-power bias (for example, proportional to $\\Delta t^2$) and non-symmetric first-order schemes potentially exhibiting leading-order odd-power bias (for example, proportional to $\\Delta t$). Your task is to implement a general procedure to verify integrator-induced bias by computing rates at multiple time steps $\\Delta t$, extrapolating to the zero time-step limit, and quantifying uncertainty in the extrapolation.\n\nStart from the following fundamental base:\n- The TIS rate definition $k_{AB} = \\Phi_{A}(\\lambda_0) \\cdot P_{A\\rightarrow B}(\\lambda_B \\mid \\lambda_0)$.\n- The Poisson counting model for flux events, where $N_{\\text{flux}} \\sim \\text{Poisson}(\\Phi \\cdot T)$ when observing over total time $T$, giving the flux estimator $\\hat{\\Phi} = N_{\\text{flux}}/T$ with variance $\\operatorname{Var}(\\hat{\\Phi}) = N_{\\text{flux}} / T^2$.\n- The Binomial model for crossing trials, where $n_s \\sim \\text{Binomial}(n, P)$, giving the crossing probability estimator $\\hat{P} = n_s/n$ with variance $\\operatorname{Var}(\\hat{P}) = \\hat{P}(1-\\hat{P})/n$.\n- The independence of flux and crossing probability estimates under separate sampling, permitting uncertainty propagation for the rate via $\\operatorname{Var}(\\hat{k}) = \\hat{P}^2 \\operatorname{Var}(\\hat{\\Phi}) + \\hat{\\Phi}^2 \\operatorname{Var}(\\hat{P})$.\n- Weighted least squares for heteroscedastic Gaussian errors, where, with design matrix $X$ and diagonal weight matrix $W = \\operatorname{diag}(1/\\sigma_i^2)$, the parameter estimator is $\\hat{\\beta} = (X^\\top W X)^{-1} X^\\top W y$, and the covariance matrix is approximated by $(X^\\top W X)^{-1}$, with optional overdispersion scaling by the reduced chi-square factor $\\chi^2/(n-p)$ if the observed scatter exceeds nominal uncertainties, where $n$ is the number of data points and $p$ is the number of fit parameters.\n\nYou must implement the following:\n1. Given arrays of time steps $\\Delta t_i$ (in femtoseconds), flux counts $N_{\\text{flux}}$, total observation time $T$ (in seconds), crossing successes $n_{s,i}$, and total crossing trials $n$ for each $\\Delta t_i$, compute, for each $i$, the rate estimate $\\hat{k}_i$ in $\\mathrm{s}^{-1}$ and its variance $\\sigma_{k,i}^2$ using the above propagation.\n2. For a symmetric, time-reversible integrator (for example, velocity Verlet), fit the model $\\hat{k}_i = \\beta_0 + \\beta_1 \\Delta t_i^2$ by weighted least squares with weights $w_i = 1/\\sigma_{k,i}^2$. For a non-symmetric, first-order integrator (for example, stochastic Euler), fit both $\\hat{k}_i = \\beta_0 + \\beta_1 \\Delta t_i$ and $\\hat{k}_i = \\beta_0 + \\beta_1 \\Delta t_i^2$ and select the model with the smaller weighted chi-square $\\chi^2 = \\sum_i (\\hat{k}_i - \\beta_0 - \\beta_1 x_i)^2 / \\sigma_{k,i}^2$, where $x_i$ is either $\\Delta t_i$ or $\\Delta t_i^2$.\n3. Quantify the uncertainty in $\\beta_0$ (the extrapolated zero time-step rate in $\\mathrm{s}^{-1}$) as the standard error $\\sigma_{\\beta_0} = \\sqrt{C_{00}}$, where $C = (X^\\top W X)^{-1}$ is optionally scaled by the reduced chi-square factor $\\max(1, \\chi^2/(n-p))$ to account for overdispersion.\n4. Produce, for each test case, a list containing the extrapolated rate $\\beta_0$ in $\\mathrm{s}^{-1}$, its standard error $\\sigma_{\\beta_0}$ in $\\mathrm{s}^{-1}$, and the selected model order $p$ as an integer where $p = 1$ denotes linear in $\\Delta t$ and $p = 2$ denotes linear in $\\Delta t^2$.\n\nPhysical units note: All rates must be expressed in $\\mathrm{s}^{-1}$. All time steps $\\Delta t$ must be interpreted in femtoseconds. No angles are involved. No percentages must be used; any proportions must be expressed as decimals.\n\nTest suite and parameters:\n- Test Case $1$ (symmetric integrator, expected quadratic bias): Integrator type velocity Verlet. Use $\\Delta t$ values $\\{0.5, 1.0, 2.0, 4.0\\}$ in femtoseconds. Use a constant flux count $N_{\\text{flux}} = 13000$ observed over $T = 10000$ seconds (so the flux estimate is $\\hat{\\Phi} = 1.3$ $\\mathrm{s}^{-1}$ with variance specified above). For crossing trials, use $n = 5000$ with successes $\\{79, 85, 108, 200\\}$ for the respective $\\Delta t$, producing the crossing probability estimates and variances as specified above.\n- Test Case $2$ (non-symmetric integrator, expected linear bias): Integrator type stochastic Euler. Use $\\Delta t$ values $\\{0.5, 1.0, 2.0, 4.0\\}$ in femtoseconds. Use a constant flux count $N_{\\text{flux}} = 16000$ observed over $T = 20000$ seconds (so the flux estimate is $\\hat{\\Phi} = 0.8$ $\\mathrm{s}^{-1}$ with variance specified above). For crossing trials, use $n = 8000$ with successes $\\{220, 240, 280, 360\\}$ for the respective $\\Delta t$.\n- Test Case $3$ (symmetric integrator, negligible bias): Integrator type velocity Verlet. Use $\\Delta t$ values $\\{0.25, 0.5, 1.0, 2.0, 4.0\\}$ in femtoseconds. Use a constant flux count $N_{\\text{flux}} = 15000$ observed over $T = 15000$ seconds (so the flux estimate is $\\hat{\\Phi} = 1.0$ $\\mathrm{s}^{-1}$ with variance specified above). For crossing trials, use $n = 6000$ with successes $\\{90, 89, 92, 88, 90\\}$ for the respective $\\Delta t$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list of the form $[\\beta_0, \\sigma_{\\beta_0}, p]$ corresponding to the three test cases in order. For example, the output should look like $[[\\text{case1\\_beta0},\\text{case1\\_sigma},\\text{case1\\_p}],[\\text{case2\\_beta0},\\text{case2\\_sigma},\\text{case2\\_p}],[\\text{case3\\_beta0},\\text{case3\\_sigma},\\text{case3\\_p}]]$, with numerical values in place of the placeholders.",
            "solution": "The problem presented is a valid and well-posed exercise in data analysis, grounded in the principles of computational chemical biology, specifically rare event sampling via Transition Interface Sampling (TIS). It requires the implementation of a procedure to quantify and correct for numerical integrator-induced bias in reaction rate calculations. The provided statistical models and fitting procedures are standard and appropriate for the task. We shall proceed with a detailed, step-by-step solution.\n\nThe core of the problem lies in extrapolating a series of rate constant measurements, each biased by a different numerical integration time step $\\Delta t$, to the continuum limit of $\\Delta t \\rightarrow 0$. The TIS methodology provides a framework for estimating the rate constant $k_{AB}$ for transitions between two metastable states, $A$ and $B$. The rate is given by the product of two independently estimated quantities:\n\n$$k_{AB} = \\Phi_{A}(\\lambda_0) \\cdot P_{A\\rightarrow B}(\\lambda_B \\mid \\lambda_0)$$\n\nHere, $\\Phi_{A}(\\lambda_0)$ represents the flux, or the rate at which trajectories initiated in state $A$ cross a defined interface $\\lambda_0$ for the first time, expressed in units of events per unit time (s$^{-1}$). The second term, $P_{A\\rightarrow B}(\\lambda_B \\mid \\lambda_0)$, is the conditional probability that a trajectory, having crossed $\\lambda_0$, proceeds to reach the final interface $\\lambda_B$ (defining state $B$) before returning to state $A$.\n\nThe problem provides statistical models for estimating these quantities from simulation data. The flux $\\hat{\\Phi}$ is estimated by counting the number of flux-crossing events, $N_{\\text{flux}}$, over a total simulation time $T$. Assuming these events follow a Poisson process, the estimator and its variance are:\n\n$$\n\\hat{\\Phi} = \\frac{N_{\\text{flux}}}{T}\n\\quad , \\quad\n\\operatorname{Var}(\\hat{\\Phi}) = \\frac{N_{\\text{flux}}}{T^2}\n$$\n\nThe crossing probability $\\hat{P}$ is estimated from a set of $n$ path sampling trials initiated from the first interface $\\lambda_0$. If $n_s$ of these trials are successful in reaching $\\lambda_B$, the process is modeled as a Binomial experiment. The estimator and its variance are:\n\n$$\n\\hat{P} = \\frac{n_s}{n}\n\\quad , \\quad\n\\operatorname{Var}(\\hat{P}) = \\frac{\\hat{P}(1-\\hat{P})}{n}\n$$\n\nSince $\\hat{\\Phi}$ and $\\hat{P}$ are determined from separate simulations, they are treated as independent random variables. The rate constant estimate for a given time step $\\Delta t_i$, denoted $\\hat{k}_i$, is the product of the corresponding estimators, $\\hat{k}_i = \\hat{\\Phi} \\cdot \\hat{P}_i$. The variance of $\\hat{k}_i$, denoted $\\sigma_{k,i}^2$, is found using standard error propagation for a product:\n\n$$\n\\sigma_{k,i}^2 = \\operatorname{Var}(\\hat{k}_i) \\approx \\hat{P}_i^2 \\operatorname{Var}(\\hat{\\Phi}) + \\hat{\\Phi}^2 \\operatorname{Var}(\\hat{P}_i)\n$$\n\nThe central task is to model the dependence of $\\hat{k}_i$ on the time step $\\Delta t_i$. For a symmetric, time-reversible integrator, the leading-order error is expected to be quadratic in $\\Delta t$, suggesting the model $\\hat{k}_i(\\Delta t_i) = \\beta_0 + \\beta_1 \\Delta t_i^2 + \\epsilon_i$. For a non-symmetric first-order scheme, the leading-order error may be linear, suggesting $\\hat{k}_i(\\Delta t_i) = \\beta_0 + \\beta_1 \\Delta t_i + \\epsilon_i$. In both cases, $\\beta_0$ represents the desired extrapolated rate at $\\Delta t = 0$.\n\nTo determine the parameters $\\beta = (\\beta_0, \\beta_1)^\\top$, we employ weighted least squares (WLS), which is appropriate for data with heteroscedastic (unequal) variances. The weights are chosen as the inverse of the measurement variances, $w_i = 1/\\sigma_{k,i}^2$. The WLS solution for the parameters $\\hat{\\beta}$ is given by:\n\n$$\n\\hat{\\beta} = (X^\\top W X)^{-1} X^\\top W y\n$$\n\nwhere $y$ is the vector of rate estimates $[\\hat{k}_1, \\dots, \\hat{k}_n]^\\top$, $X$ is the design matrix, and $W$ is the diagonal matrix of weights. For the model $\\hat{k}_i = \\beta_0 + \\beta_1 x_i$, where $x_i$ is either $\\Delta t_i$ or $\\Delta t_i^2$, the design matrix is:\n\n$$\nX = \\begin{pmatrix}\n1  x_1 \\\\\n1  x_2 \\\\\n\\vdots  \\vdots \\\\\n1  x_n\n\\end{pmatrix}\n$$\n\nThe statistical uncertainty in the estimated parameters is captured by the covariance matrix, which is initially estimated as $C = (X^\\top W X)^{-1}$. The uncertainty in the extrapolated rate $\\beta_0$ is the square root of the first diagonal element, $\\sigma_{\\beta_0, \\text{unscaled}} = \\sqrt{C_{00}}$. To account for potential underestimation of variance or model misspecification (i.e., when the observed scatter of data points around the fitted line is larger than expected from the weights), we calculate the weighted chi-square statistic:\n\n$$\n\\chi^2 = \\sum_{i=1}^{n} w_i (\\hat{k}_i - (\\beta_0 + \\beta_1 x_i))^2 = \\sum_{i=1}^{n} \\frac{(\\hat{k}_i - \\hat{k}_{\\text{fit},i})^2}{\\sigma_{k,i}^2}\n$$\n\nThe reduced chi-square is $\\chi^2_{\\text{red}} = \\chi^2/(n-p_{fit})$, where $n$ is the number of data points and $p_{fit}$ is the number of fitted parameters (here, $p_{fit}=2$ for $\\beta_0$ and $\\beta_1$). A scale factor $S = \\max(1, \\chi^2_{\\text{red}})$ is then applied to the covariance matrix. The final, corrected standard error for $\\beta_0$ is $\\sigma_{\\beta_0} = \\sqrt{S \\cdot C_{00}}$.\n\nFor the non-symmetric integrator case, we must select between two models. We fit both the linear model (model order $p=1$, with $x_i = \\Delta t_i$) and the quadratic model (model order $p=2$, with $x_i = \\Delta t_i^2$) and choose the one that yields the smaller weighted chi-square value, $\\chi^2$, as this indicates a better fit to the data.\n\nWe now apply this complete procedure to the three test cases.\n\n**Test Case 1: Symmetric Integrator**\n- Integrator type: velocity Verlet. Expected model order $p=2$.\n- Input data: $\\Delta t = \\{0.5, 1.0, 2.0, 4.0\\}$ in fs, $N_{\\text{flux}} = 13000$, $T = 10000$ s, $n = 5000$, $n_s = \\{79, 85, 108, 200\\}$.\n- First, we calculate the constant flux and its variance:\n  $\\hat{\\Phi} = 13000 / 10000 = 1.3$ s$^{-1}$.\n  $\\operatorname{Var}(\\hat{\\Phi}) = 13000 / (10000)^2 = 1.3 \\times 10^{-5}$ s$^{-2}$.\n- Next, we compute $\\hat{k}_i$ and $\\sigma_{k,i}^2$ for each of the $n=4$ time steps.\n- We then perform a WLS fit of $\\hat{k}_i$ versus $x_i = \\Delta t_i^2 = \\{0.25, 1.0, 4.0, 16.0\\}$ fs$^2$.\n- The fit yields the extrapolated rate $\\beta_0$ and its standard error $\\sigma_{\\beta_0}$, using the reduced chi-square scaling with $n=4$ and $p_{fit}=2$. The model order is fixed at $p = 2$.\n\n**Test Case 2: Non-symmetric Integrator**\n- Integrator type: stochastic Euler. Model order must be determined.\n- Input data: $\\Delta t = \\{0.5, 1.0, 2.0, 4.0\\}$ in fs, $N_{\\text{flux}} = 16000$, $T = 20000$ s, $n = 8000$, $n_s = \\{220, 240, 280, 360\\}$.\n- Flux and its variance:\n  $\\hat{\\Phi} = 16000 / 20000 = 0.8$ s$^{-1}$.\n  $\\operatorname{Var}(\\hat{\\Phi}) = 16000 / (20000)^2 = 4.0 \\times 10^{-6}$ s$^{-2}$.\n- After computing $\\hat{k}_i$ and $\\sigma_{k,i}^2$ for the $n=4$ data points, we perform two separate WLS fits.\n- Fit 1 (Order $p=1$): $\\hat{k}_i$ versus $x_i = \\Delta t_i = \\{0.5, 1.0, 2.0, 4.0\\}$ fs. This yields $\\beta_{0,1}$, $\\sigma_{\\beta_{0,1}}$, and $\\chi_1^2$.\n- Fit 2 (Order $p=2$): $\\hat{k}_i$ versus $x_i = \\Delta t_i^2 = \\{0.25, 1.0, 4.0, 16.0\\}$ fs$^2$. This yields $\\beta_{0,2}$, $\\sigma_{\\beta_{0,2}}$, and $\\chi_2^2$.\n- We compare $\\chi_1^2$ and $\\chi_2^2$. If $\\chi_1^2  \\chi_2^2$, we select model order $p=1$ and report its corresponding parameters. Otherwise, we select $p=2$.\n\n**Test Case 3: Symmetric Integrator, Negligible Bias**\n- Integrator type: velocity Verlet. Expected model order $p=2$.\n- Input data: $\\Delta t = \\{0.25, 0.5, 1.0, 2.0, 4.0\\}$ in fs, $N_{\\text{flux}} = 15000$, $T = 15000$ s, $n = 6000$, $n_s = \\{90, 89, 92, 88, 90\\}$.\n- Flux and its variance:\n  $\\hat{\\Phi} = 15000 / 15000 = 1.0$ s$^{-1}$.\n  $\\operatorname{Var}(\\hat{\\Phi}) = 15000 / (15000)^2 \\approx 6.67 \\times 10^{-6}$ s$^{-2}$.\n- Here we have $n=5$ data points. The $n_s$ values are very close, suggesting a weak dependence on $\\Delta t$.\n- We compute $\\hat{k}_i$ and $\\sigma_{k,i}^2$ for each time step.\n- We perform a WLS fit of $\\hat{k}_i$ versus $x_i = \\Delta t_i^2 = \\{0.0625, 0.25, 1.0, 4.0, 16.0\\}$ fs$^2$.\n- The fit is expected to yield a slope $\\beta_1$ close to zero. The uncertainty is calculated as before with $n=5$ and $p_{fit}=2$, and the model order is $p=2$.\n\nThe implementation of this procedure is detailed in the accompanying Python code, which systematically executes these steps for each test case and formats the results as required.",
            "answer": "```python\nimport numpy as np\n\ndef perform_wls(x_vals, y_vals, y_vars):\n    \"\"\"\n    Performs a weighted least squares fit for the model y = beta0 + beta1*x.\n\n    Args:\n        x_vals (np.ndarray): The independent variable values.\n        y_vals (np.ndarray): The dependent variable values (measurements).\n        y_vars (np.ndarray): The variances of the measurements.\n\n    Returns:\n        tuple: A tuple containing:\n            - beta0 (float): The intercept of the fit.\n            - sigma_beta0 (float): The standard error of the intercept.\n            - chi_squared (float): The weighted chi-square of the fit.\n    \"\"\"\n    n = len(x_vals)\n    p_fit = 2  # Number of fit parameters (beta0, beta1)\n\n    # Design matrix X\n    X = np.vstack([np.ones(n), x_vals]).T\n\n    # Weight matrix W\n    weights = 1.0 / y_vars\n    W = np.diag(weights)\n\n    # Perform WLS calculation: beta = (X^T W X)^-1 X^T W y\n    try:\n        XT_W_X = X.T @ W @ X\n        cov_matrix_unscaled = np.linalg.inv(XT_W_X)\n        XT_W_y = X.T @ W @ y_vals\n        beta_hat = cov_matrix_unscaled @ XT_W_y\n    except np.linalg.LinAlgError:\n        # Failsafe for singular matrix, although not expected with given data\n        return np.nan, np.nan, np.nan\n\n    beta0 = beta_hat[0]\n    \n    # Calculate chi-squared\n    y_pred = X @ beta_hat\n    chi_squared = np.sum((y_vals - y_pred)**2 / y_vars)\n\n    # Calculate error scaling factor for overdispersion\n    if n > p_fit:\n        reduced_chi_squared = chi_squared / (n - p_fit)\n        scale_factor = max(1.0, reduced_chi_squared)\n    else:\n        scale_factor = 1.0\n    \n    # Calculate scaled standard error for beta0\n    cov_matrix_scaled = scale_factor * cov_matrix_unscaled\n    sigma_beta0 = np.sqrt(cov_matrix_scaled[0, 0])\n\n    return beta0, sigma_beta0, chi_squared\n\n\ndef analyze_case(dt_vals, n_flux, T_obs, n_trials, ns_vals, integrator_type):\n    \"\"\"\n    Analyzes a single test case according to the problem description.\n    \"\"\"\n    dt_vals = np.array(dt_vals, dtype=float)\n    ns_vals = np.array(ns_vals, dtype=float)\n\n    # Step 1: Calculate rate estimates and variances\n    phi_hat = n_flux / T_obs\n    var_phi = n_flux / (T_obs**2)\n\n    p_hat = ns_vals / n_trials\n    var_p = p_hat * (1 - p_hat) / n_trials\n\n    k_hats = phi_hat * p_hat\n    k_vars = (p_hat**2 * var_phi) + (phi_hat**2 * var_p)\n\n    # Step 2  3: Perform WLS fit(s) and determine uncertainty\n    if integrator_type == 'symmetric':\n        x_vals = dt_vals**2\n        beta0, sigma_beta0, _ = perform_wls(x_vals, k_hats, k_vars)\n        model_order = 2\n        return [beta0, sigma_beta0, model_order]\n    \n    elif integrator_type == 'non-symmetric':\n        # Fit model 1 (linear in dt)\n        x_vals1 = dt_vals\n        beta0_1, sigma_beta0_1, chi2_1 = perform_wls(x_vals1, k_hats, k_vars)\n        \n        # Fit model 2 (linear in dt^2)\n        x_vals2 = dt_vals**2\n        beta0_2, sigma_beta0_2, chi2_2 = perform_wls(x_vals2, k_hats, k_vars)\n        \n        # Step 4: Select model and report results\n        if chi2_1  chi2_2:\n            return [beta0_1, sigma_beta0_1, 1]\n        else:\n            return [beta0_2, sigma_beta0_2, 2]\n    else:\n        raise ValueError(\"Unknown integrator type\")\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"dt_vals\": [0.5, 1.0, 2.0, 4.0],\n            \"n_flux\": 13000,\n            \"T_obs\": 10000,\n            \"n_trials\": 5000,\n            \"ns_vals\": [79, 85, 108, 200],\n            \"integrator_type\": \"symmetric\"\n        },\n        {\n            \"dt_vals\": [0.5, 1.0, 2.0, 4.0],\n            \"n_flux\": 16000,\n            \"T_obs\": 20000,\n            \"n_trials\": 8000,\n            \"ns_vals\": [220, 240, 280, 360],\n            \"integrator_type\": \"non-symmetric\"\n        },\n        {\n            \"dt_vals\": [0.25, 0.5, 1.0, 2.0, 4.0],\n            \"n_flux\": 15000,\n            \"T_obs\": 15000,\n            \"n_trials\": 6000,\n            \"ns_vals\": [90, 89, 92, 88, 90],\n            \"integrator_type\": \"symmetric\"\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_case(\n            dt_vals=case[\"dt_vals\"],\n            n_flux=case[\"n_flux\"],\n            T_obs=case[\"T_obs\"],\n            n_trials=case[\"n_trials\"],\n            ns_vals=case[\"ns_vals\"],\n            integrator_type=case[\"integrator_type\"]\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}