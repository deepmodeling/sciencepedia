{
    "hands_on_practices": [
        {
            "introduction": "Understanding the statistical efficiency of different free energy methods is fundamental to designing robust calculations. This exercise uses an analytically solvable harmonic oscillator model to provide a clear, first-principles comparison between Free Energy Perturbation (FEP) and Thermodynamic Integration (TI). By deriving the exact asymptotic variances for both methods, you will gain a concrete understanding of how the magnitude of the perturbation impacts their convergence properties and relative performance .",
            "id": "3838810",
            "problem": "Consider a one-dimensional classical configuration coordinate $x \\in \\mathbb{R}$ at inverse temperature $\\beta = 1/(k_{B} T)$ under two harmonic potentials $U_{0}(x) = \\frac{k_{0}}{2} x^{2}$ and $U_{1}(x) = \\frac{k_{1}}{2} x^{2}$, with $k_{0}  0$ and $k_{1}  0$. Let $\\Delta k = k_{1} - k_{0}$ and $r = k_{1}/k_{0}$. The canonical partition function for a potential $U(x)$ is $Z = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x)) \\, dx$, and the Helmholtz free energy is $F = -\\beta^{-1} \\ln Z$.\n\nStarting from these definitions and the canonical ensemble, do the following:\n\n1. Derive the exact analytical free energy difference $\\Delta F = F_{1} - F_{0}$ for this model.\n2. Using the Free Energy Perturbation (FEP) identity, defined as sampling under $U_{0}$ and estimating $\\Delta F$ by $-\\beta^{-1} \\ln \\langle \\exp[-\\beta (U_{1}(x) - U_{0}(x))] \\rangle_{0}$, derive a closed-form expression for the expectation and variance of the random variable $Y = \\exp[-\\beta (U_{1}(x) - U_{0}(x))]$ when $x$ is distributed according to the canonical distribution of $U_{0}$. Then, by the delta method, obtain the large-sample asymptotic variance of the FEP estimator of $\\Delta F$ based on $N$ independent samples.\n3. Using Thermodynamic Integration (TI), with a linear coupling path $U_{\\lambda}(x) = \\frac{1}{2} \\big(k_{0} + \\lambda \\Delta k\\big) x^{2}$ for $\\lambda \\in [0,1]$, derive the TI expression $\\Delta F = \\int_{0}^{1} \\langle \\partial U_{\\lambda} / \\partial \\lambda \\rangle_{\\lambda} \\, d\\lambda$ for this model. Then, in the continuum-$\\lambda$ limit assuming independent sampling at each $\\lambda$ and negligible quadrature error, derive a closed-form expression for the large-sample asymptotic variance of the TI estimator of $\\Delta F$ when $N$ independent samples are collected at each $\\lambda$.\n4. Finally, provide a single closed-form analytic expression for the ratio $R(r)$ of the FEP asymptotic variance to the TI asymptotic variance as a function of $r = k_{1}/k_{0}$, valid in the regime where both variances are finite.\n\nYour final answer must be the expression for $R(r)$ only. No numerical evaluation is required. If you perform any intermediate numerical simplifications, retain constants symbolically unless the final expression demands otherwise. The final answer is dimensionless.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a standard, analytically solvable problem in statistical mechanics to compare the statistical efficiency of Free Energy Perturbation (FEP) and Thermodynamic Integration (TI).\n\nThe solution proceeds in four stages as requested:\n1.  Derivation of the exact analytical free energy difference, $\\Delta F$.\n2.  Derivation of the FEP estimator's asymptotic variance.\n3.  Derivation of the TI estimator's asymptotic variance.\n4.  Derivation of the ratio of these variances, $R(r)$.\n\n**1. Exact Analytical Free Energy Difference**\n\nThe potential energy for state $i$ (where $i \\in \\{0, 1\\}$) is given by $U_i(x) = \\frac{k_i}{2} x^2$. The canonical partition function $Z_i$ is calculated by integrating the Boltzmann factor over all possible configurations $x$. This is a standard Gaussian integral.\n$$Z_i = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U_i(x)) \\, dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_i}{2} x^2\\right) \\, dx$$\nUsing the known result for the Gaussian integral $\\int_{-\\infty}^{\\infty} \\exp(-a x^2) \\, dx = \\sqrt{\\frac{\\pi}{a}}$, we set $a = \\frac{\\beta k_i}{2}$ to obtain:\n$$Z_i = \\sqrt{\\frac{2\\pi}{\\beta k_i}}$$\nThe Helmholtz free energy $F_i$ is related to the partition function by $F_i = -\\beta^{-1} \\ln Z_i$.\n$$F_i = -\\beta^{-1} \\ln\\left(\\sqrt{\\frac{2\\pi}{\\beta k_i}}\\right) = -\\frac{1}{2\\beta} \\ln\\left(\\frac{2\\pi}{\\beta k_i}\\right) = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta k_i}{2\\pi}\\right)$$\nThe free energy difference $\\Delta F = F_1 - F_0$ is therefore:\n$$\\Delta F = F_1 - F_0 = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta k_1}{2\\pi}\\right) - \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta k_0}{2\\pi}\\right) = \\frac{1}{2\\beta} \\left[ \\ln(\\beta k_1) - \\ln(\\beta k_0) \\right]$$\n$$\\Delta F = \\frac{1}{2\\beta} \\ln\\left(\\frac{k_1}{k_0}\\right) = \\frac{1}{2\\beta} \\ln(r)$$\nwhere $r = k_1/k_0$.\n\n**2. Free Energy Perturbation (FEP) Variance**\n\nThe FEP estimator for $\\Delta F$ is given by $\\hat{F}_{\\text{FEP}} = -\\beta^{-1} \\ln(\\bar{Y})$, where $\\bar{Y}$ is the sample average of the random variable $Y = \\exp[-\\beta (U_1(x) - U_0(x))]$ over $N$ samples drawn from the canonical distribution of state $0$. The probability density for state $0$ is $p_0(x) = Z_0^{-1} \\exp(-\\beta U_0(x))$.\nThe potential energy difference is $\\Delta U(x) = U_1(x) - U_0(x) = \\frac{1}{2}(k_1 - k_0)x^2 = \\frac{\\Delta k}{2} x^2$.\nSo, $Y = \\exp\\left(-\\frac{\\beta \\Delta k}{2} x^2\\right)$.\n\nThe expectation of $Y$ in the ensemble $0$ is:\n$$\\langle Y \\rangle_0 = \\int_{-\\infty}^{\\infty} Y p_0(x) \\, dx = \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta \\Delta k}{2} x^2\\right) \\exp\\left(-\\frac{\\beta k_0}{2} x^2\\right) \\, dx$$\n$$\\langle Y \\rangle_0 = \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta (k_0 + \\Delta k)}{2} x^2\\right) \\, dx = \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_1}{2} x^2\\right) \\, dx = \\frac{Z_1}{Z_0}$$\nUsing the expressions for $Z_i$:\n$$\\langle Y \\rangle_0 = \\frac{\\sqrt{2\\pi/(\\beta k_1)}}{\\sqrt{2\\pi/(\\beta k_0)}} = \\sqrt{\\frac{k_0}{k_1}} = \\frac{1}{\\sqrt{r}}$$\nTo find the variance of $Y$, we first need the second moment, $\\langle Y^2 \\rangle_0$.\n$$Y^2 = \\exp\\left(-2 \\cdot \\frac{\\beta \\Delta k}{2} x^2\\right) = \\exp\\left(-\\beta \\Delta k x^2\\right)$$\n$$\\langle Y^2 \\rangle_0 = \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\Delta k x^2\\right) \\exp\\left(-\\frac{\\beta k_0}{2} x^2\\right) \\, dx = \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta (k_0 + 2\\Delta k)}{2} x^2\\right) \\, dx$$\nThis integral is $\\sqrt{2\\pi/(\\beta(k_0+2\\Delta k))}$. The integral converges only if $k_0 + 2\\Delta k  0$.\n$k_0 + 2(k_1 - k_0)  0 \\implies 2k_1 - k_0  0 \\implies k_1/k_0  1/2 \\implies r  1/2$. This is the condition for finite variance.\n$$\\langle Y^2 \\rangle_0 = \\frac{\\sqrt{2\\pi/(\\beta(k_0+2\\Delta k))}}{\\sqrt{2\\pi/(\\beta k_0)}} = \\sqrt{\\frac{k_0}{k_0+2\\Delta k}} = \\sqrt{\\frac{k_0}{2k_1 - k_0}} = \\sqrt{\\frac{1}{2r-1}}$$\nThe variance of the estimator $\\hat{F}_{\\text{FEP}} = -\\beta^{-1}\\ln(\\bar{Y})$ for large $N$ is found using the delta method:\n$$\\sigma^2_{\\text{FEP}} = \\text{Var}(\\hat{F}_{\\text{FEP}}) \\approx \\left( \\frac{\\partial (-\\beta^{-1} \\ln \\bar{Y})}{\\partial \\bar{Y}} \\bigg|_{\\bar{Y}=\\langle Y \\rangle_0} \\right)^2 \\text{Var}(\\bar{Y})$$\nWith $\\text{Var}(\\bar{Y}) = \\frac{1}{N}\\text{Var}_0(Y)$, and the derivative being $-\\frac{1}{\\beta \\bar{Y}}$, this becomes:\n$$\\sigma^2_{\\text{FEP}} = \\left(-\\frac{1}{\\beta \\langle Y \\rangle_0}\\right)^2 \\frac{\\text{Var}_0(Y)}{N} = \\frac{1}{N\\beta^2} \\frac{\\langle Y^2 \\rangle_0 - (\\langle Y \\rangle_0)^2}{(\\langle Y \\rangle_0)^2} = \\frac{1}{N\\beta^2} \\left( \\frac{\\langle Y^2 \\rangle_0}{(\\langle Y \\rangle_0)^2} - 1 \\right)$$\nSubstituting our results:\n$$\\frac{\\langle Y^2 \\rangle_0}{(\\langle Y \\rangle_0)^2} = \\frac{1/\\sqrt{2r-1}}{(1/\\sqrt{r})^2} = \\frac{r}{\\sqrt{2r-1}}$$\nThe large-sample asymptotic variance of the FEP estimator is:\n$$\\sigma^2_{\\text{FEP}} = \\frac{1}{N\\beta^2} \\left( \\frac{r}{\\sqrt{2r-1}} - 1 \\right)$$\n\n**3. Thermodynamic Integration (TI) Variance**\n\nIn TI, $\\Delta F$ is an integral of an ensemble average: $\\Delta F = \\int_0^1 \\langle \\frac{\\partial U_\\lambda}{\\partial \\lambda} \\rangle_\\lambda \\, d\\lambda$.\nThe path is $U_\\lambda(x) = \\frac{1}{2} k_\\lambda x^2$, with $k_\\lambda = k_0 + \\lambda \\Delta k$.\nThe derivative is $\\frac{\\partial U_\\lambda}{\\partial \\lambda} = \\frac{1}{2} \\frac{d k_\\lambda}{d\\lambda} x^2 = \\frac{\\Delta k}{2} x^2$.\nThe TI integrand is $I(\\lambda) = \\langle \\frac{\\partial U_\\lambda}{\\partial \\lambda} \\rangle_\\lambda = \\frac{\\Delta k}{2} \\langle x^2 \\rangle_\\lambda$.\nThe ensemble average $\\langle x^2 \\rangle_\\lambda$ is the variance of the coordinate $x$ under potential $U_\\lambda$, which is a Gaussian distribution with variance $(\\beta k_\\lambda)^{-1}$. Thus, $\\langle x^2 \\rangle_\\lambda = \\frac{1}{\\beta k_\\lambda}$.\n$$I(\\lambda) = \\frac{\\Delta k}{2\\beta k_\\lambda}$$\nThe TI estimator is $\\hat{F}_{\\text{TI}} = \\int_0^1 \\hat{I}(\\lambda) d\\lambda$, where $\\hat{I}(\\lambda)$ is the mean of $N$ samples of $\\frac{\\partial U_\\lambda}{\\partial \\lambda}$ at each $\\lambda$.\nThe variance of the estimator is $\\sigma^2_{\\text{TI}} = \\text{Var}(\\int_0^1 \\hat{I}(\\lambda) d\\lambda)$. Assuming independent sampling at each $\\lambda$ and negligible quadrature error, this becomes $\\int_0^1 \\text{Var}(\\hat{I}(\\lambda)) d\\lambda$.\n$$\\text{Var}(\\hat{I}(\\lambda)) = \\frac{1}{N} \\text{Var}_\\lambda\\left(\\frac{\\partial U_\\lambda}{\\partial \\lambda}\\right) = \\frac{1}{N} \\left(\\frac{\\Delta k}{2}\\right)^2 \\text{Var}_\\lambda(x^2)$$\nFor a Gaussian distribution with mean $0$ and variance $\\sigma_x^2 = (\\beta k_\\lambda)^{-1}$, the variance of $x^2$ is $\\text{Var}(x^2) = \\langle x^4 \\rangle - (\\langle x^2 \\rangle)^2 = 3(\\sigma_x^2)^2 - (\\sigma_x^2)^2 = 2(\\sigma_x^2)^2$.\nSo, $\\text{Var}_\\lambda(x^2) = 2/(\\beta k_\\lambda)^2$.\n$$\\text{Var}(\\hat{I}(\\lambda)) = \\frac{1}{N} \\left(\\frac{\\Delta k}{2}\\right)^2 \\frac{2}{(\\beta k_\\lambda)^2} = \\frac{(\\Delta k)^2}{2N\\beta^2 k_\\lambda^2}$$\nThe asymptotic variance of the TI estimator is the integral of this quantity over $\\lambda$:\n$$\\sigma^2_{\\text{TI}} = \\int_0^1 \\frac{(\\Delta k)^2}{2N\\beta^2 k_\\lambda^2} \\, d\\lambda = \\frac{(\\Delta k)^2}{2N\\beta^2} \\int_0^1 \\frac{1}{(k_0 + \\lambda \\Delta k)^2} \\, d\\lambda$$\nThe integral is:\n$$\\int_0^1 (k_0 + \\lambda \\Delta k)^{-2} \\, d\\lambda = \\left[ -\\frac{1}{\\Delta k} (k_0 + \\lambda \\Delta k)^{-1} \\right]_0^1 = -\\frac{1}{\\Delta k} \\left( \\frac{1}{k_1} - \\frac{1}{k_0} \\right) = -\\frac{1}{\\Delta k} \\frac{k_0-k_1}{k_0 k_1} = \\frac{k_1-k_0}{\\Delta k \\cdot k_0 k_1} = \\frac{1}{k_0 k_1}$$\nSubstituting this back, we get:\n$$\\sigma^2_{\\text{TI}} = \\frac{(\\Delta k)^2}{2N\\beta^2} \\frac{1}{k_0 k_1} = \\frac{(k_1-k_0)^2}{2N\\beta^2 k_0 k_1}$$\nIn terms of $r = k_1/k_0$:\n$$\\sigma^2_{\\text{TI}} = \\frac{(k_0 r - k_0)^2}{2N\\beta^2 k_0 (k_0 r)} = \\frac{k_0^2(r-1)^2}{2N\\beta^2 k_0^2 r} = \\frac{(r-1)^2}{2N\\beta^2 r}$$\n\n**4. Ratio of variances $R(r)$**\n\nThe problem asks for the ratio of the FEP asymptotic variance to the TI asymptotic variance. This is the ratio of $\\sigma^2_{\\text{FEP}}$ to $\\sigma^2_{\\text{TI}}$. The common factors $1/N$ and $1/\\beta^2$ will cancel.\n$$R(r) = \\frac{\\sigma^2_{\\text{FEP}}}{\\sigma^2_{\\text{TI}}} = \\frac{\\frac{1}{N\\beta^2} \\left( \\frac{r}{\\sqrt{2r-1}} - 1 \\right)}{\\frac{1}{N\\beta^2} \\frac{(r-1)^2}{2r}} = \\frac{\\frac{r - \\sqrt{2r-1}}{\\sqrt{2r-1}}}{\\frac{(r-1)^2}{2r}}$$\n$$R(r) = \\frac{2r(r - \\sqrt{2r-1})}{(r-1)^2 \\sqrt{2r-1}}$$\nThis expression is valid for $r  1/2$ and $r \\neq 1$. The singularity at $r=1$ is removable, and $\\lim_{r\\to 1} R(r) = 1$. This final expression is the required closed-form analytic result for the ratio of the variances.",
            "answer": "$$\n\\boxed{\\frac{2r(r - \\sqrt{2r-1})}{(r-1)^{2} \\sqrt{2r-1}}}\n$$"
        },
        {
            "introduction": "A common challenge in alchemical free energy calculations is the \"endpoint catastrophe,\" where statistical errors diverge as an atom's interactions are fully turned on or off. This practice delves into the mathematical origins of this problem by analyzing the TI integrand for a single atom being decoupled from a solvent . You will derive the scaling behavior of the variance with and without soft-core potentials, demonstrating precisely how this essential technique tames the singularities that otherwise plague naive linear coupling schemes.",
            "id": "3838836",
            "problem": "In alchemical free energy calculations, the convergence of estimators in Free Energy Perturbation (FEP) and Thermodynamic Integration (TI) depends critically on the statistical behavior of the TI integrand. Consider a single solute atom $X$ being decoupled from a homogeneous solvent at temperature $T$ within the canonical ensemble. The solute–solvent nonbonded interactions consist of a Lennard–Jones $12$–$6$ potential and a Coulomb potential. For the standard (non-soft-core) coupling scheme, the nonbonded potential energy along the alchemical path is $U_{\\mathrm{nb}}(\\lambda) = \\lambda U_{\\mathrm{LJ}} + \\lambda U_{\\mathrm{C}}$, where $\\lambda \\in [0,1]$ is the coupling parameter and $U_{\\mathrm{LJ}}$ and $U_{\\mathrm{C}}$ are the full Lennard–Jones and Coulomb energies, respectively. For the soft-core scheme (using the common Beutler-type soft-core), the Lennard–Jones part is modified to\n$$\nU_{\\mathrm{LJ}}^{\\mathrm{sc}}(r;\\lambda) = 4\\varepsilon \\left[ \\lambda \\frac{\\sigma^{12}}{\\left(r^{6} + \\alpha (1-\\lambda)\\sigma^{6}\\right)^{2}} - \\lambda \\frac{\\sigma^{6}}{r^{6} + \\alpha (1-\\lambda)\\sigma^{6}} \\right],\n$$\nwith $\\varepsilon$ and $\\sigma$ the Lennard–Jones parameters and $\\alpha  0$ a dimensionless soft-core parameter. The Coulomb term is scaled linearly as in the non-soft-core case.\n\nLet $\\beta = 1/(k_{B}T)$ where $k_{B}$ is the Boltzmann constant. The TI estimator is governed by the ensemble average $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$, with fluctuations characterized by the variance $\\mathrm{Var}_{\\lambda}[\\partial U/\\partial \\lambda]$. Assume a homogeneous solvent number density $\\rho$ and that when interactions vanish ($\\lambda \\to 0$), the pair distribution function approaches unity at short distances. Model the dominant short-range contribution to fluctuations by the nearest-neighbor solvent degree of freedom with radial coordinate $r$ and measure proportional to $4\\pi \\rho r^{2}\\mathrm{d}r$.\n\nUsing first-principles statistical mechanics, and focusing on the leading-order short-range behavior, compute the power-law scaling exponents $\\alpha_{\\mathrm{no\\_sc}}$ and $\\alpha_{\\mathrm{sc}}$ defined by\n$$\n\\mathrm{Var}_{\\lambda}\\!\\left[\\frac{\\partial U}{\\partial \\lambda}\\right] \\sim C_{\\mathrm{no\\_sc}} \\lambda^{\\alpha_{\\mathrm{no\\_sc}}} \\quad \\text{for the non-soft-core scheme, and} \\quad \\mathrm{Var}_{\\lambda}\\!\\left[\\frac{\\partial U}{\\partial \\lambda}\\right] \\sim C_{\\mathrm{sc}} \\lambda^{\\alpha_{\\mathrm{sc}}} \\quad \\text{for the soft-core scheme,}\n$$\nas $\\lambda \\to 0$, where $C_{\\mathrm{no\\_sc}}$ and $C_{\\mathrm{sc}}$ are $\\lambda$-independent positive constants depending on $\\beta$, $\\varepsilon$, $\\sigma$, $\\alpha$, and $\\rho$. Treat the Coulomb contribution as subleading for the divergence analysis and justify its impact on the scaling. Your final answer must be the ordered pair $(\\alpha_{\\mathrm{no\\_sc}}, \\alpha_{\\mathrm{sc}})$ expressed as a row matrix using the $\\mathrm{pmatrix}$ environment. No rounding is required and no units should be reported in the final boxed answer.",
            "solution": "The problem requires the determination of the power-law scaling exponents for the variance of the thermodynamic integration (TI) integrand, $\\frac{\\partial U}{\\partial \\lambda}$, as the coupling parameter $\\lambda$ approaches zero. This variance, $\\mathrm{Var}_{\\lambda}\\!\\left[\\frac{\\partial U}{\\partial \\lambda}\\right]$, is a key indicator of the convergence behavior of alchemical free energy calculations. The analysis will be performed for two potential schemes: a standard non-soft-core scheme and a soft-core scheme.\n\nThe variance of an observable $A$ in the canonical ensemble at a given $\\lambda$ is defined as $\\mathrm{Var}_{\\lambda}[A] = \\langle A^2 \\rangle_{\\lambda} - \\langle A \\rangle_{\\lambda}^2$. In our case, the observable is $A = \\frac{\\partial U}{\\partial \\lambda}$. The ensemble average $\\langle \\cdot \\rangle_{\\lambda}$ is given by\n$$\n\\langle F \\rangle_{\\lambda} = \\frac{\\int F(\\mathbf{r}) \\exp(-\\beta U(\\mathbf{r};\\lambda)) \\, d\\mathbf{r}}{\\int \\exp(-\\beta U(\\mathbf{r};\\lambda)) \\, d\\mathbf{r}}\n$$\nwhere $\\mathbf{r}$ represents the coordinates of the solvent particles. The problem states we can model the dominant short-range contributions by considering a single nearest-neighbor solvent particle at a radial distance $r$, with a measure proportional to $4\\pi \\rho r^2 dr$. This simplification, combined with the assumption that the pair distribution function $g(r) \\to 1$ as $\\lambda \\to 0$, allows us to write the relevant averages as integrals over $r$.\n\nAs $\\lambda \\to 0$, the potential $U(\\lambda) \\to 0$, and the system approaches an ideal gas state where the Boltzmann factor $\\exp(-\\beta U(\\lambda)) \\to 1$. In this limit, the variance is dominated by the second moment, $\\langle (\\frac{\\partial U}{\\partial \\lambda})^2 \\rangle_{\\lambda}$. The controlling integral for the scaling analysis of the variance is therefore\n$$\nI(\\lambda) = \\int_0^\\infty \\left(\\frac{\\partial U(r;\\lambda)}{\\partial \\lambda}\\right)^2 \\exp(-\\beta U(r;\\lambda)) r^2 \\, dr\n$$\nThe divergence of this integral as $\\lambda \\to 0$ arises from the behavior of the integrand at small $r$, where the potential can be singular.\n\nFirst, we address the non-soft-core scheme. The potential is $U_{\\mathrm{nb}}(r;\\lambda) = \\lambda (U_{\\mathrm{LJ}}(r) + U_{\\mathrm{C}}(r))$. The derivative with respect to $\\lambda$ is $\\frac{\\partial U_{\\mathrm{nb}}}{\\partial \\lambda} = U_{\\mathrm{LJ}}(r) + U_{\\mathrm{C}}(r)$.\nThe Lennard–Jones potential is $U_{\\mathrm{LJ}}(r) = 4\\varepsilon [(\\frac{\\sigma}{r})^{12} - (\\frac{\\sigma}{r})^6]$, and the Coulomb potential is $U_{\\mathrm{C}}(r) \\propto r^{-1}$. At short distances ($r \\to 0$), the repulsive $r^{-12}$ term of the LJ potential dominates the $r^{-6}$ term and the $r^{-1}$ Coulomb term. Therefore, for the purpose of analyzing the divergence, we can make the following approximations for small $r$:\n$$\nU_{\\mathrm{nb}}(r;\\lambda) \\approx \\lambda \\cdot 4\\varepsilon \\sigma^{12} r^{-12}\n$$\n$$\n\\frac{\\partial U_{\\mathrm{nb}}}{\\partial \\lambda} \\approx 4\\varepsilon \\sigma^{12} r^{-12}\n$$\nThis justifies treating the Coulomb contribution as subleading for the divergence analysis in this scheme. Let $K = 4\\varepsilon \\sigma^{12}$. The integral $I(\\lambda)$ scales as\n$$\nI_{\\mathrm{no\\_sc}}(\\lambda) \\propto \\int_0^\\infty (K r^{-12})^2 \\exp(-\\beta \\lambda K r^{-12}) r^2 \\, dr = K^2 \\int_0^\\infty r^{-22} \\exp(-\\beta \\lambda K r^{-12}) \\, dr\n$$\nTo determine the scaling with $\\lambda$, we perform a change of variables. Let $x = (\\beta \\lambda K)^{1/12} r^{-1}$. Then $r^{-1} = x (\\beta \\lambda K)^{-1/12}$, and $r = x^{-1} (\\beta \\lambda K)^{1/12}$. The differential is $dr = -x^{-2} (\\beta \\lambda K)^{1/12} dx$. As $r$ goes from $0$ to $\\infty$, $x$ goes from $\\infty$ to $0$.\nSubstituting these into the integral:\n$$\nI_{\\mathrm{no\\_sc}}(\\lambda) \\propto \\int_\\infty^0 \\left(x^{22} (\\beta \\lambda K)^{-22/12}\\right) \\exp(-x^{12}) \\left(-x^{-2} (\\beta \\lambda K)^{1/12}\\right) \\, dx\n$$\n$$\n\\propto (\\beta \\lambda K)^{-22/12} (\\beta \\lambda K)^{1/12} \\int_0^\\infty x^{20} \\exp(-x^{12}) \\, dx\n$$\nThe integral is a constant independent of $\\lambda$. The scaling is thus determined by the prefactors:\n$$\nI_{\\mathrm{no\\_sc}}(\\lambda) \\propto (\\lambda)^{-22/12 + 1/12} = \\lambda^{-21/12} = \\lambda^{-7/4}\n$$\nSince $\\mathrm{Var}_{\\lambda}[\\frac{\\partial U}{\\partial \\lambda}] \\propto I_{\\mathrm{no\\_sc}}(\\lambda)$, we find that $\\mathrm{Var}_{\\lambda}[\\frac{\\partial U}{\\partial \\lambda}] \\sim C_{\\mathrm{no\\_sc}} \\lambda^{-7/4}$. Comparing this with the given form $\\lambda^{\\alpha_{\\mathrm{no\\_sc}}}$, we identify the exponent as $\\alpha_{\\mathrm{no\\_sc}} = -7/4$.\n\nNext, we analyze the soft-core scheme. The potential is $U(r;\\lambda) = U_{\\mathrm{LJ}}^{\\mathrm{sc}}(r;\\lambda) + \\lambda U_{\\mathrm{C}}(r)$. The key feature of the soft-core potential is the regularization of the singularity at $r=0$. As $r \\to 0$, the soft-core potential $U_{\\mathrm{LJ}}^{\\mathrm{sc}}(r;\\lambda)$ approaches a finite value:\n$$\n\\lim_{r\\to 0} U_{\\mathrm{LJ}}^{\\mathrm{sc}}(r;\\lambda) = 4\\varepsilon \\left[ \\lambda \\frac{\\sigma^{12}}{(\\alpha(1-\\lambda)\\sigma^6)^2} - \\lambda \\frac{\\sigma^6}{\\alpha(1-\\lambda)\\sigma^6} \\right] = \\frac{4\\varepsilon\\lambda}{\\alpha(1-\\lambda)} \\left( \\frac{1}{\\alpha(1-\\lambda)} - 1 \\right)\n$$\nThis value is finite for $\\lambda \\in [0, 1)$ and goes to $0$ as $\\lambda \\to 0$. The hardcore singularity is removed. The TI integrand is $\\frac{\\partial U}{\\partial \\lambda} = \\frac{\\partial U_{\\mathrm{LJ}}^{\\mathrm{sc}}}{\\partial \\lambda} + U_{\\mathrm{C}}(r)$.\nTo analyze the variance, we consider its behavior as $\\lambda \\to 0$. In this limit, the system approaches the ideal gas state, and the variance approaches a well-defined limit if the integrals for its moments converge.\n$$\n\\lim_{\\lambda \\to 0} \\mathrm{Var}_{\\lambda}\\!\\left[\\frac{\\partial U}{\\partial \\lambda}\\right] = \\mathrm{Var}_{0}\\!\\left[\\lim_{\\lambda \\to 0} \\frac{\\partial U}{\\partial \\lambda}\\right]\n$$\nWe need the limit of the derivative. Let $D(r, \\lambda) = r^6 + \\alpha (1-\\lambda)\\sigma^6$. As $\\lambda \\to 0$, $D \\to r^6 + \\alpha \\sigma^6$. The derivative of the soft-core LJ term is\n$$\n\\frac{\\partial U_{\\mathrm{LJ}}^{\\mathrm{sc}}}{\\partial \\lambda} = U_{\\mathrm{LJ}}^{\\mathrm{sc}}/\\lambda + \\lambda \\frac{\\partial (U_{\\mathrm{LJ}}^{\\mathrm{sc}}/\\lambda)}{\\partial \\lambda} = 4\\varepsilon \\left[ \\frac{\\sigma^{12}}{D^2} - \\frac{\\sigma^6}{D} \\right] + \\lambda \\left(\\dots\\right)\n$$\nIn the limit $\\lambda \\to 0$, the second term vanishes, and we are left with\n$$\n\\lim_{\\lambda \\to 0} \\frac{\\partial U_{\\mathrm{LJ}}^{\\mathrm{sc}}}{\\partial \\lambda} = 4\\varepsilon \\left[ \\frac{\\sigma^{12}}{(r^6 + \\alpha\\sigma^6)^2} - \\frac{\\sigma^6}{r^6 + \\alpha\\sigma^6} \\right]\n$$\nThis function is finite for all $r \\ge 0$. The full derivative in the limit is\n$$\n\\lim_{\\lambda \\to 0} \\frac{\\partial U}{\\partial \\lambda} = 4\\varepsilon \\left[ \\frac{\\sigma^{12}}{(r^6 + \\alpha\\sigma^6)^2} - \\frac{\\sigma^6}{r^6 + \\alpha\\sigma^6} \\right] + U_{\\mathrm{C}}(r)\n$$\nIn this soft-core case, the short-range behavior of $\\lim_{\\lambda \\to 0} \\frac{\\partial U}{\\partial \\lambda}$ is now dominated by the Coulomb term $U_{\\mathrm{C}}(r) \\propto r^{-1}$, as the soft-core LJ part is regular at $r=0$. The variance at $\\lambda=0$ involves an integral of the form $\\int_0^\\infty (\\lim_{\\lambda \\to 0} \\frac{\\partial U}{\\partial \\lambda})^2 r^2 \\, dr$. The behavior of the integrand near $r=0$ is determined by the Coulomb term:\n$$\n\\text{Integrand} \\sim (U_{\\mathrm{C}}(r))^2 r^2 \\propto (r^{-1})^2 r^2 = 1\n$$\nSince the integrand approaches a constant as $r \\to 0$, the integral $\\int_0^{\\delta} 1 \\, dr$ is convergent. The integral over the full range $[0, \\infty)$ is also convergent because $\\frac{\\partial U}{\\partial \\lambda}$ decays sufficiently fast at large $r$. Thus, $\\lim_{\\lambda \\to 0} \\mathrm{Var}_{\\lambda}[\\frac{\\partial U}{\\partial \\lambda}]$ is a finite, non-zero constant. A quantity that approaches a non-zero constant as $\\lambda \\to 0$ has a power-law scaling of $\\lambda^0$. Therefore, $\\mathrm{Var}_{\\lambda}[\\frac{\\partial U}{\\partial \\lambda}] \\sim C_{\\mathrm{sc}} \\lambda^0$, which implies the exponent is $\\alpha_{\\mathrm{sc}} = 0$.\n\nThe pair of scaling exponents is $(\\alpha_{\\mathrm{no\\_sc}}, \\alpha_{\\mathrm{sc}}) = (-7/4, 0)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{7}{4}  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Robust free energy estimation requires sufficient overlap between the thermodynamic states being compared, a condition that is often violated in practice. This problem uses a simple, discrete two-level system to vividly illustrate the catastrophic failure of unidirectional estimators like FEP when phase space overlap is poor . By analyzing the stability of the Bennett Acceptance Ratio (BAR) in the same scenario, you will develop a deep appreciation for the superior robustness of bidirectional methods in handling challenging transformations.",
            "id": "3838881",
            "problem": "Consider a canonical ensemble at inverse temperature $\\beta$ in which two thermodynamic states $A$ and $B$ are defined on a shared, discrete two-configuration space $x \\in \\{L,H\\}$ (a two-level system). Let the potential energy gap be $\\Delta U(x) \\equiv U_B(x) - U_A(x)$. Assume that sampling from state $A$ yields the following known energy-gap distribution: with probability $P_A(L) = \\varepsilon$ the configuration is $L$ with $\\Delta U(L) = 0$, and with probability $P_A(H) = 1 - \\varepsilon$ the configuration is $H$ with $\\Delta U(H) = \\Delta$. Work in dimensionless energy units such that $\\beta = 1$ (that is, energies are in units of $k_B T$). Take $\\varepsilon = 10^{-3}$ and $\\Delta = 10$.\n\nUsing only fundamental facts of equilibrium statistical mechanics (Boltzmann weights, partition functions, and detailed balance), and without quoting estimator-specific formulas, do the following:\n\n1. Starting from the ratio of partition functions and the Boltzmann distribution, derive an exact expression for the equilibrium free energy difference $\\Delta F \\equiv F_B - F_A$ in terms of the energy-gap distribution under state $A$, and evaluate it for the given $\\varepsilon$ and $\\Delta$.\n\n2. To analyze the failure mode of forward Free Energy Perturbation (FEP) under poor overlap, suppose you draw $N_A = 500$ independent samples from state $A$. Compute the probability that none of the $N_A$ samples land in configuration $L$. Conditional on that event, determine the forward FEP point estimate one would report from those data alone, and compare it qualitatively to the exact $\\Delta F$ you obtained in part 1.\n\n3. To assess the stability of Bennett Acceptance Ratio (BAR), consider the large-sample, equal-count limit with $N_A = N_B$ and no bias constant. Starting only from the canonical-ensemble relationship between $P_B(x)$ and $P_A(x)$ implied by detailed balance and the definition of $\\Delta F$, reduce the BAR self-consistency condition for this two-level system to a scalar equation for $\\Delta F$, and solve it. Explain why this solution is stable even when $\\varepsilon \\ll 1$.\n\nExpress your final numerical answer for the free energy difference $\\Delta F$ in units of $k_B T$, rounded to four significant figures.",
            "solution": "This problem analyzes the calculation of a free energy difference, $\\Delta F$, between two thermodynamic states, $A$ and $B$, for a simple two-level system using different computational methods. The analysis is performed from first principles of statistical mechanics. We are given a canonical ensemble at inverse temperature $\\beta=1$, where energies are measured in units of $k_B T$. The system can exist in two configurations, $x \\in \\{L, H\\}$. The potential energy difference between the states is $\\Delta U(x) \\equiv U_B(x) - U_A(x)$. When sampling from state $A$, the system is found in configuration $L$ with probability $P_A(L) = \\varepsilon$ and energy gap $\\Delta U(L) = 0$. It is found in configuration $H$ with probability $P_A(H) = 1 - \\varepsilon$ and energy gap $\\Delta U(H) = \\Delta$. The numerical values are $\\varepsilon = 10^{-3}$, $\\Delta = 10$, and the number of samples from state $A$ is $N_A = 500$.\n\n1. Derivation of the exact free energy difference $\\Delta F$.\n\nThe Helmholtz free energy $F$ of a state is related to its canonical partition function $Z$ by $F = -k_B T \\ln Z = -\\frac{1}{\\beta} \\ln Z$. The partition function for a system with discrete configurations $x$ is $Z = \\sum_x \\exp(-\\beta U(x))$.\n\nThe free energy difference $\\Delta F$ between states $B$ and $A$ is:\n$$\n\\Delta F = F_B - F_A = -\\frac{1}{\\beta} \\ln Z_B - \\left(-\\frac{1}{\\beta} \\ln Z_A\\right) = -\\frac{1}{\\beta} \\ln\\left(\\frac{Z_B}{Z_A}\\right)\n$$\nThe ratio of partition functions can be expressed as:\n$$\n\\frac{Z_B}{Z_A} = \\frac{\\sum_x \\exp(-\\beta U_B(x))}{\\sum_x \\exp(-\\beta U_A(x))}\n$$\nWe can rewrite $U_B(x)$ as $U_A(x) + \\Delta U(x)$. Substituting this into the numerator gives:\n$$\n\\frac{Z_B}{Z_A} = \\frac{\\sum_x \\exp(-\\beta (U_A(x) + \\Delta U(x)))}{\\sum_x \\exp(-\\beta U_A(x))} = \\frac{\\sum_x \\exp(-\\beta U_A(x)) \\exp(-\\beta \\Delta U(x))}{\\sum_x \\exp(-\\beta U_A(x))}\n$$\nThis expression is a thermal average over ensemble $A$. The probability of observing configuration $x$ in ensemble $A$ is $P_A(x) = \\frac{\\exp(-\\beta U_A(x))}{Z_A}$. The expression thus simplifies to:\n$$\n\\frac{Z_B}{Z_A} = \\sum_x \\frac{\\exp(-\\beta U_A(x))}{Z_A} \\exp(-\\beta \\Delta U(x)) = \\sum_x P_A(x) \\exp(-\\beta \\Delta U(x)) = \\left\\langle \\exp(-\\beta \\Delta U) \\right\\rangle_A\n$$\nThis leads to the fundamental relation known as the Zwanzig formula or the forward Free Energy Perturbation (FEP) identity:\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\left\\langle \\exp(-\\beta \\Delta U) \\right\\rangle_A\n$$\nFor the given two-level system, the average is a sum over the two configurations $L$ and $H$:\n$$\n\\left\\langle \\exp(-\\beta \\Delta U) \\right\\rangle_A = P_A(L) \\exp(-\\beta \\Delta U(L)) + P_A(H) \\exp(-\\beta \\Delta U(H))\n$$\nSubstituting the given values $\\beta=1$, $P_A(L)=\\varepsilon$, $P_A(H)=1-\\varepsilon$, $\\Delta U(L)=0$, and $\\Delta U(H)=\\Delta$:\n$$\n\\left\\langle \\exp(-\\Delta U) \\right\\rangle_A = \\varepsilon \\cdot \\exp(-0) + (1-\\varepsilon) \\cdot \\exp(-\\Delta) = \\varepsilon + (1-\\varepsilon)\\exp(-\\Delta)\n$$\nTherefore, the exact free energy difference is:\n$$\n\\Delta F = -\\ln\\left( \\varepsilon + (1-\\varepsilon)\\exp(-\\Delta) \\right)\n$$\nUsing the numerical values $\\varepsilon = 10^{-3}$ and $\\Delta = 10$:\n$$\n\\Delta F = -\\ln\\left( 10^{-3} + (1-10^{-3})\\exp(-10) \\right) = -\\ln\\left( 0.001 + 0.999 \\exp(-10) \\right)\n$$\nCalculating the value:\n$$\n\\Delta F \\approx -\\ln(0.001 + 0.999 \\times 4.53999 \\times 10^{-5}) = -\\ln(0.00104535) \\approx 6.86345\n$$\nRounded to four significant figures, the exact free energy difference is $6.863$ $k_B T$.\n\n2. Analysis of the forward FEP failure mode.\n\nWe consider drawing $N_A = 500$ independent samples from state $A$. The probability of sampling configuration $L$ is $P_A(L) = \\varepsilon = 10^{-3}$, and the probability of sampling configuration $H$ is $P_A(H) = 1-\\varepsilon = 0.999$.\n\nThe probability that a single sample is *not* configuration $L$ is $P_A(H) = 1-\\varepsilon$. Since the $N_A$ samples are independent, the probability that *none* of them are configuration $L$ is:\n$$\nP(\\text{no L samples in } N_A \\text{ trials}) = (P_A(H))^{N_A} = (1-\\varepsilon)^{N_A} = (1-10^{-3})^{500} = (0.999)^{500} \\approx 0.6064\n$$\nThis is a high probability, meaning that missing the rare configuration $L$ is a very likely outcome for this number of samples.\n\nConditional on this event, all $N_A = 500$ samples drawn from state $A$, denoted $\\{x_i\\}$, are in configuration $H$. The forward FEP estimator for a finite sample is:\n$$\n\\Delta F_{\\text{FEP}} = -\\frac{1}{\\beta} \\ln\\left( \\frac{1}{N_A} \\sum_{i=1}^{N_A} \\exp(-\\beta \\Delta U(x_i)) \\right)\n$$\nSince every sample $x_i$ is configuration $H$, we have $\\Delta U(x_i) = \\Delta$ for all $i=1, \\dots, N_A$. With $\\beta=1$:\n$$\n\\Delta F_{\\text{FEP}} = -\\ln\\left( \\frac{1}{N_A} \\sum_{i=1}^{N_A} \\exp(-\\Delta) \\right) = -\\ln\\left( \\frac{1}{N_A} \\cdot N_A \\exp(-\\Delta) \\right) = -\\ln(\\exp(-\\Delta)) = \\Delta\n$$\nFor the given value $\\Delta=10$, the FEP point estimate would be $\\Delta F_{\\text{FEP}} = 10$.\n\nQualitatively, this estimated value of $10$ $k_B T$ is significantly different from the exact value of $\\Delta F \\approx 6.863$ $k_B T$. The estimate is catastrophically biased. The failure arises because the FEP average $\\langle \\exp(-\\Delta U) \\rangle_A$ is dominated by the contribution from the rare state $L$, for which $\\exp(-\\Delta U(L)) = \\exp(0) = 1$. The contribution from the common state $H$ is $\\exp(-\\Delta) = \\exp(-10)$, which is negligible. By failing to sample the rare but overwhelmingly important state $L$, the estimator only observes the high-energy-gap state $H$, leading to a massive overestimation of the free energy difference.\n\n3. Analysis of Bennett Acceptance Ratio (BAR) stability.\n\nThe BAR method combines data from both forward ($A$) and reverse ($B$) simulations. In the large-sample, equal-count limit ($N_A = N_B$), the self-consistency condition for the BAR estimate of the free energy difference, which we denote as $C$, is:\n$$\n\\left\\langle f(\\beta(\\Delta U - C)) \\right\\rangle_A = \\left\\langle f(\\beta(C - \\Delta U)) \\right\\rangle_B\n$$\nwhere $f(u) = (1+\\exp(u))^{-1}$ is the Fermi function. We are asked to show that the exact free energy difference $\\Delta F$ is the solution to this equation. We begin with the relationship between the probability distributions in the two ensembles:\n$$\nP_B(x) = \\frac{\\exp(-\\beta U_B(x))}{Z_B} = \\frac{\\exp(-\\beta (U_A(x)+\\Delta U(x)))}{Z_A \\exp(-\\beta \\Delta F)} = P_A(x) \\exp(\\beta(\\Delta F - \\Delta U(x)))\n$$\nUsing this, we can express the average over ensemble $B$ as an average over ensemble $A$:\n$$\n\\left\\langle g(x) \\right\\rangle_B = \\sum_x P_B(x) g(x) = \\sum_x P_A(x) \\exp(\\beta(\\Delta F - \\Delta U(x))) g(x) = \\left\\langle g(x) \\exp(\\beta(\\Delta F - \\Delta U(x))) \\right\\rangle_A\n$$\nThe RHS of the BAR equation becomes:\n$$\n\\left\\langle f(\\beta(C - \\Delta U)) \\right\\rangle_B = \\left\\langle f(\\beta(C - \\Delta U)) \\exp(\\beta(\\Delta F - \\Delta U)) \\right\\rangle_A\n$$\nThe BAR equation to solve for $C$ is thus:\n$$\n\\left\\langle f(\\beta(\\Delta U - C)) \\right\\rangle_A = \\left\\langle f(\\beta(C - \\Delta U)) \\exp(\\beta(\\Delta F - \\Delta U)) \\right\\rangle_A\n$$\nWe now verify that $C=\\Delta F$ is the solution. Let $C = \\Delta F$ and define a shorthand $W(x) = \\beta(\\Delta U(x) - \\Delta F)$. The equation becomes:\n$$\n\\left\\langle f(W(x)) \\right\\rangle_A = \\left\\langle f(-W(x)) \\exp(-W(x)) \\right\\rangle_A\n$$\nLet's examine the term inside the average on the RHS:\n$$\nf(-W(x)) \\exp(-W(x)) = \\frac{1}{1+\\exp(-W(x))} \\exp(-W(x)) = \\frac{\\exp(-W(x))}{1+\\exp(-W(x))}\n$$\nMultiplying the numerator and denominator by $\\exp(W(x))$:\n$$\n\\frac{\\exp(-W(x))\\exp(W(x))}{(1+\\exp(-W(x)))\\exp(W(x))} = \\frac{1}{\\exp(W(x))+1} = f(W(x))\n$$\nThus, the equation reduces to $\\langle f(W(x)) \\rangle_A = \\langle f(W(x)) \\rangle_A$, which is an identity. This proves that the exact free energy difference $\\Delta F$ is the solution to the BAR self-consistency equation in the large-sample limit. The scalar equation asked for is the BAR equation itself, and solving it analytically shows the solution is $\\Delta F$. Its value is therefore the same as computed in part 1.\n\nThe BAR method is stable even when $\\varepsilon \\ll 1$ for two primary reasons. First, the function being averaged, the Fermi function $f(u)$, is bounded between $0$ and $1$. This \"squashes\" the problematic exponential term that causes instability in FEP, preventing any single rare event from dominating the average. Second, BAR symmetrically uses information from both ensembles. In our problem, state $L$ is rare in ensemble $A$ (probability $\\varepsilon=10^{-3}$) but dominant in ensemble $B$ (probability $P_B(L) \\approx 0.957$). Conversely, state $H$ is dominant in ensemble $A$ (probability $1-\\varepsilon = 0.999$) but rare in ensemble $B$. FEP from simulation $A$ fails because it is likely to miss the crucial state $L$. In BAR, even if sampling from $A$ misses state $L$, sampling from $B$ will capture it robustly. The BAR equation effectively balances the statistical information, using the data from simulation $A$ to constrain the properties of state $H$ and data from simulation $B$ to constrain the properties of state $L$. This symmetric use of information from both simulations, combined with the bounded nature of the estimator, ensures a stable and accurate result even in cases of poor overlap where FEP fails catastrophically.",
            "answer": "$$\\boxed{6.863}$$"
        }
    ]
}