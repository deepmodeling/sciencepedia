{
    "hands_on_practices": [
        {
            "introduction": "许多用于药物设计的生成模型其工作方式类似于语言模型，通过逐个构建“标记”（token）来生成分子的表示，例如SMILES字符串。一个关键的挑战在于控制模型的创造性：过多的随机性可能导致无效的结构，而过少的随机性则会抑制对新化学空间的探索。本练习深入探讨了“温度”参数（$\\tau$）的使用，这是一个源自统计力学的基本概念，通过调节模型的采样分布，从而直接影响生成分子的有效性和多样性。",
            "id": "3847976",
            "problem": "考虑一个基于简化分子线性输入规范 (SMILES) 的生成式语言模型，该模型从一个有限词汇表 $\\mathcal{V}$ 中发射一个符号序列来构建分子字符串。在生成步骤 $t \\in \\{1, 2, \\dots, L\\}$，模型为符号分配实值分数 (logits) $\\{z_{i}^{(t)}\\}_{i \\in \\mathcal{V}}$，这些分数通过一个具有固定期望分数和归一化约束的最大熵原理来确定采样分布。最大熵解引入了一个标量温度参数 $\\tau > 0$，该参数控制符号上分布的离散程度。\n\n假设一个简化的 SMILES 构建有效性准则，其中对于每一步 $t$，存在一个依赖于上下文的符号子集 $S_{t} \\subseteq \\mathcal{V}$，这些符号能够使部分字符串在局部约束（例如，分支括号的平衡或当前状态允许的闭环符号）下保持有效。在模型分布为条件下，各步骤有效性独立的近似假设下，在步骤 $t$ 独立采样的符号能产生有效部分字符串的概率，是模型的温控分布分配给 $S_{t}$ 的总概率质量。一个长度为 $L$ 的符号序列的总体有效性就是这些逐步有效性的乘积。\n\n从香non熵的定义以及归一化和固定期望分数的约束出发，推导出每一步中符号上的温控分布。然后，将独立生成的长度为 $L$ 的 SMILES 的期望有效率 $R(\\tau)$ 表示为 $\\tau$、logits $\\{z_{i}^{(t)}\\}$ 和有效集 $\\{S_{t}\\}$ 的闭式解析函数。你的最终答案必须是 $R(\\tau)$ 的一个单一闭式表达式，只依赖于 $\\tau$、$\\{z_{i}^{(t)}\\}$ 和 $\\{S_{t}\\}$。不需要进行数值计算。",
            "solution": "问题要求基于最大熵原理推导温控采样分布，并随后使用该分布找到所生成序列的期望有效率的闭式表达式。整个过程分为两个主要部分：首先，推导概率分布；其次，计算有效率。\n\n第一部分：温控分布的推导\n\n问题陈述，在每个生成步骤 $t \\in \\{1, 2, \\dots, L\\}$，词汇表 $\\mathcal{V}$ 上的采样分布是通过在特定约束下最大化香Shannon熵来确定的。设 $p_i^{(t)}$ 为在步骤 $t$ 采样符号 $i \\in \\mathcal{V}$ 的概率。为清晰起见，在推导过程中我们将省略上标 $(t)$，因为每一步的逻辑都是相同的。香Shannon熵由以下公式给出：\n$$H = -\\sum_{i \\in \\mathcal{V}} p_i \\ln(p_i)$$\n\n此最大化受两个约束条件限制：\n1.  归一化：词汇表中所有符号的概率之和必须为 $1$。\n    $$\\sum_{i \\in \\mathcal{V}} p_i = 1$$\n2.  固定期望分数：logits $\\{z_i\\}_{i \\in \\mathcal{V}}$ 的期望值必须等于一个固定的、但未指定的常数 $E$。\n    $$\\sum_{i \\in \\mathcal{V}} p_i z_i = E$$\n\n我们采用拉格朗日乘数法来解决这个约束优化问题。拉格朗日函数 $\\mathcal{L}$ 构建如下：\n$$\\mathcal{L}(p_i, \\lambda_0, \\lambda_1) = H - \\lambda_0 \\left(\\sum_{i \\in \\mathcal{V}} p_i - 1\\right) - \\lambda_1 \\left(\\sum_{i \\in \\mathcal{V}} p_i z_i - E\\right)$$\n代入 $H$ 的表达式：\n$$\\mathcal{L}(p_i, \\lambda_0, \\lambda_1) = -\\sum_{i \\in \\mathcal{V}} p_i \\ln(p_i) - \\lambda_0 \\sum_{i \\in \\mathcal{V}} p_i + \\lambda_0 - \\lambda_1 \\sum_{i \\in \\mathcal{V}} p_i z_i + \\lambda_1 E$$\n\n为了找到使 $\\mathcal{L}$ 最大化的概率 $p_k$，我们对每个 $p_k$ 求偏导数并令其为 $0$：\n$$\\frac{\\partial \\mathcal{L}}{\\partial p_k} = \\frac{\\partial}{\\partial p_k} \\left( -p_k \\ln(p_k) - \\lambda_0 p_k - \\lambda_1 p_k z_k \\right) = 0$$\n使用微分的乘法法则，$\\frac{d}{dx}(x\\ln x) = \\ln x + 1$：\n$$-(\\ln(p_k) + 1) - \\lambda_0 - \\lambda_1 z_k = 0$$\n$$\\ln(p_k) = -1 - \\lambda_0 - \\lambda_1 z_k$$\n求解 $p_k$：\n$$p_k = \\exp(-1 - \\lambda_0 - \\lambda_1 z_k) = \\exp(-1 - \\lambda_0) \\exp(-\\lambda_1 z_k)$$\n\n现在，我们使用归一化约束来确定包含 $\\lambda_0$ 的项。\n$$\\sum_{k \\in \\mathcal{V}} p_k = \\sum_{k \\in \\mathcal{V}} \\exp(-1 - \\lambda_0) \\exp(-\\lambda_1 z_k) = 1$$\n$$\\exp(-1 - \\lambda_0) \\sum_{k \\in \\mathcal{V}} \\exp(-\\lambda_1 z_k) = 1$$\n$$\\exp(-1 - \\lambda_0) = \\frac{1}{\\sum_{j \\in \\mathcal{V}} \\exp(-\\lambda_1 z_j)}$$\n\n将此代回 $p_k$ 的表达式中：\n$$p_k = \\frac{\\exp(-\\lambda_1 z_k)}{\\sum_{j \\in \\mathcal{V}} \\exp(-\\lambda_1 z_j)}$$\n\n问题引入了温度参数 $\\tau > 0$。在统计力学和机器学习中，与类能量约束相关的拉格朗日乘数与逆温度有关。logits 的常规温度缩放形式涉及将 logits 除以 $\\tau$。为了与此惯例匹配，我们将我们的拉格朗日乘数 $\\lambda_1$ 与温度 $\\tau$ 之间的关系定义为 $\\lambda_1 = -1/\\tau$。这个选择给出了所需的形式。\n\n将 $\\lambda_1 = -1/\\tau$ 代入概率表达式并重新引入步骤索引 $(t)$，我们得到温控分布，即 softmax 函数：\n$$p_i^{(t)}(\\tau) = \\frac{\\exp(z_i^{(t)}/\\tau)}{\\sum_{j \\in \\mathcal{V}} \\exp(z_j^{(t)}/\\tau)}$$\n\n第二部分：期望有效率 $R(\\tau)$ 的推导\n\n问题定义了一个简化的有效性准则，其中在每一步 $t$，一个符号子集 $S_t \\subseteq \\mathcal{V}$ 维持部分序列的有效性。在步骤 $t$ 独立采样的符号是有效的概率，我们记为 $V_t(\\tau)$，是这个有效集 $S_t$ 中符号的概率之和。\n$$V_t(\\tau) = \\sum_{i \\in S_t} p_i^{(t)}(\\tau)$$\n\n代入推导出的 $p_i^{(t)}(\\tau)$ 表达式：\n$$V_t(\\tau) = \\sum_{i \\in S_t} \\frac{\\exp(z_i^{(t)}/\\tau)}{\\sum_{j \\in \\mathcal{V}} \\exp(z_j^{(t)}/\\tau)} = \\frac{\\sum_{i \\in S_t} \\exp(z_i^{(t)}/\\tau)}{\\sum_{j \\in \\mathcal{V}} \\exp(z_j^{(t)}/\\tau)}$$\n\n问题陈述，由于独立性近似，一个长度为 $L$ 的符号序列的总体有效性是这些逐步有效性概率的乘积。期望有效率 $R(\\tau)$ 就是这个总体有效性概率。\n$$R(\\tau) = \\prod_{t=1}^{L} V_t(\\tau)$$\n\n通过代入 $V_t(\\tau)$ 的表达式，我们得到了期望有效率 $R(\\tau)$ 作为温度 $\\tau$、logits $\\{z_i^{(t)}\\}$ 和有效集 $\\{S_t\\}$ 的函数的最终闭式表达式。\n$$R(\\tau) = \\prod_{t=1}^{L} \\left( \\frac{\\sum_{i \\in S_t} \\exp(z_i^{(t)}/\\tau)}{\\sum_{j \\in \\mathcal{V}} \\exp(z_j^{(t)}/\\tau)} \\right)$$\n这个表达式就是所要求的闭式解析函数。",
            "answer": "$$ \\boxed{ \\prod_{t=1}^{L} \\left( \\frac{\\sum_{i \\in S_t} \\exp(z_i^{(t)}/\\tau)}{\\sum_{j \\in \\mathcal{V}} \\exp(z_j^{(t)}/\\tau)} \\right) } $$"
        },
        {
            "introduction": "生成化学上有效的分子只是第一步；对于从头设计（de novo design）而言，我们必须引导模型产生具有理想治疗特性的候选分子。这通常涉及一个多目标优化问题：在遵守关键的药物化学约束（如类药性规则）的同时，最大化一个目标函数（如结合亲和力）。本练习演示了如何使用惩罚方法，将这个复杂的约束优化问题转化为一个单一的、无约束的目标函数，这是一种引导生成模型产出高质量、类药性化合物的强大技术。",
            "id": "5247455",
            "problem": "一个从头分子生成器正在被训练以提出候选配体，这些配体在满足药物化学规则（如Lipinski五规则、泛分析干扰化合物（PAINS）过滤和合成可及性约束）的同时，优化一个归一化的结合目标 $A \\in [0,1]$。设 $V \\in \\{0,1,2,\\dots\\}$ 表示在这一规则集下，给定分子观察到的规则违例计数，并假设设计目标是在约束 $V=0$ 下最大化 $A$ 的约束优化问题。在实践中，约束优化通常通过拉格朗日乘子法进行松弛，即构建一个无约束的代理目标，该目标包含了对约束违例的惩罚。假设惩罚对于各个违例是可加的，并且在一阶上与违例计数成线性关系，其非负标量惩罚权重为 $\\lambda \\geq 0$，反映了 $A$ 与规则符合性之间的权衡。从这个约束公式和拉格朗日松弛的原理出发，推导无约束代理目标 $S(A,V;\\lambda)$，然后为一个 $A=0.8$，$V=3$，$\\lambda=0.1$ 的候选分子计算该目标的值。分数 $S$ 是无量纲的。请以小数形式提供精确值。此外，简要讨论在固定的 $A$ 和 $V$ 下，$S$ 对 $\\lambda$ 变化的敏感性，并结合为符合药物规则而调整生成器的背景来解释这种敏感性。不要对数值分数进行四舍五入。",
            "solution": "该问题要求将一个约束优化问题转化为一个无约束的代理目标，并对其进行评估和分析。\n\n### 代理目标的推导\n原始的约束优化问题表述为在约束 $V = 0$ 下最大化结合目标 $A$。我们可以使用拉格朗日松弛法将此问题转化为无约束问题。对于一个在约束 $g(x)=c$ 下最大化函数 $f(x)$ 的问题，其代理目标通常可以写作 $f(x) - \\lambda(g(x)-c)$，其中 $\\lambda$ 是一个惩罚权重。\n\n在本问题中，要最大化的函数是 $A$，约束是 $V=0$。惩罚项与违例计数 $V$ 成线性关系，权重为 $\\lambda$。因此，无约束的代理目标 $S(A, V; \\lambda)$ 可以构建为：\n$$\nS(A, V; \\lambda) = A - \\lambda V\n$$\n这个函数将原始目标 $A$ 和对约束违例的惩罚项 $\\lambda V$ 结合在一起。生成器的目标是最大化这个综合分数 $S$。\n\n### 代理目标的求值\n题目要求我们为候选分子计算 $S$ 的值，其参数为 $A=0.8$，$V=3$，惩罚权重为 $\\lambda=0.1$。\n将这些值代入推导出的表达式中：\n$$\nS(0.8, 3; 0.1) = 0.8 - (0.1)(3) = 0.8 - 0.3 = 0.5\n$$\n该候选分子的代理目标分数为 $0.5$。\n\n### 敏感性分析与解释\n分数 $S$ 对惩罚权重 $\\lambda$ 变化的敏感性由 $S$ 对 $\\lambda$ 的偏导数给出，同时保持 $A$ 和 $V$ 不变：\n$$\n\\frac{\\partial S}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} (A - \\lambda V) = -V\n$$\n**解释：**\n此结果表明，分数 $S$ 对惩罚权重 $\\lambda$ 的敏感性等于规则违例数量的负值。这在调整生成器的背景下具有清晰的解释：\n\n1.  **对违例的依赖性**：改变 $\\lambda$ 对分子分数的影响与其违例数量成正比。一个完全符合规则的分子（$V=0$），其分数不受 $\\lambda$ 影响。而一个违例越多的分子（$V$ 值越大），其分数随 $\\lambda$ 增加而下降得越快。\n\n2.  **调整参数**：$\\lambda$ 充当了控制生成模型行为的“旋钮”。增加 $\\lambda$ 会更严厉地惩罚违例，从而引导模型生成更多“类药性”的分子。反之，减小 $\\lambda$ 则会降低对违例的惩罚，允许模型探索更广阔的化学空间，以寻找可能具有更高结合潜力（$A$ 值更高）但存在少量规则违例的分子。\n\n总之，敏感性 $\\frac{\\partial S}{\\partial \\lambda} = -V$ 量化了在最大化主要目标和满足约束之间的权衡，为引导生成过程提供了明确的机制。",
            "answer": "$$\n\\boxed{0.5}\n$$"
        },
        {
            "introduction": "在训练和优化一个生成模型后，我们需要一个稳健的方法来评估其整体性能。相比于逐一评估单个分子，一种更强大的方法是比较整个生成分子集合与已知药物参考数据集之间的统计分布。本练习介绍了Fréchet ChemNet距离（FCD），这是一个标准度量，它在一个学习到的化学嵌入空间中量化这种分布相似性，从而为模型捕捉目标化学空间的能力提供一个整体性的衡量标准。",
            "id": "3847972",
            "problem": "在计算化学生物学中，一种定量评估由生成模型产生的分子嵌入分布与参考数据集分布之间相似性的常用方法是，将学习到的嵌入建模为多元高斯分布，并使用二次代价最优传输距离来衡量它们之间的差异。Fréchet ChemNet 距离 (FCD) 定义为，一个生成分子集和一个参考分子集的 ChemNet 嵌入的两个高斯近似之间的二次代价最优传输距离的平方。ChemNet 是一个经过训练的神经网络，用于从分子表示中学习具有化学意义的嵌入。\n\n从第一性原理出发，使用 $\\mathbb{R}^{d}$ 上概率测度之间的二次代价 $2$-Wasserstein 距离的定义，\n$$\nW_{2}^{2}(\\mu,\\nu) \\equiv \\inf_{\\gamma \\in \\Gamma(\\mu,\\nu)} \\int_{\\mathbb{R}^{d} \\times \\mathbb{R}^{d}} \\|x-y\\|^{2} \\, \\mathrm{d}\\gamma(x,y),\n$$\n其中 $\\Gamma(\\mu,\\nu)$ 是边缘分布为 $\\mu$ 和 $\\nu$ 的所有耦合的集合，并利用高斯测度的特性，推导在参考集和生成集的 ChemNet 嵌入向量服从多元正态分布的假设下的闭式 Fréchet ChemNet 距离。然后，计算在从头药物设计中近似参考和生成的 ChemNet 嵌入分布的以下两个高斯分布之间的闭式 $2$-Wasserstein 距离：\n\n- 参考嵌入：$X_{\\mathrm{ref}} \\sim \\mathcal{N}(\\mu_{\\mathrm{ref}}, \\Sigma_{\\mathrm{ref}})$，其中 $\\mu_{\\mathrm{ref}} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 3 \\end{pmatrix}$ 且 $\\Sigma_{\\mathrm{ref}} = \\mathrm{diag}(1,\\,4,\\,9)$。\n- 生成嵌入：$X_{\\mathrm{gen}} \\sim \\mathcal{N}(\\mu_{\\mathrm{gen}}, \\Sigma_{\\mathrm{gen}})$，其中 $\\mu_{\\mathrm{gen}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix}$ 且 $\\Sigma_{\\mathrm{gen}} = \\mathrm{diag}(4,\\,1,\\,16)$。\n\n您的推导必须从上面 $W_{2}^{2}$ 的定义以及高斯测度和最优传输的核心性质开始，不得预先假设任何目标公式。确定在此高斯设定下产生的 Fréchet ChemNet 距离 (FCD)，并最终报告 $X_{\\mathrm{ref}}$ 和 $X_{\\mathrm{gen}}$ 之间 $2$-Wasserstein 距离 $W_{2}$ 的精确解析值。最终答案以精确表达式形式给出，不带单位，请勿四舍五入。",
            "solution": "本问题要求推导两个多元高斯分布之间的 Fréchet ChemNet 距离 (FCD) 的闭式表达式，并随后为一对特定的分布计算该值。FCD 定义为平方 $2$-Wasserstein 距离，即 $W_2^2$。\n\n设参考嵌入和生成嵌入的两个多元高斯分布为 $\\mathbb{R}^{d}$ 上的 $\\mu = \\mathcal{N}(\\mu_1, \\Sigma_1)$ 和 $\\nu = \\mathcal{N}(\\mu_2, \\Sigma_2)$。平方 $2$-Wasserstein 距离定义为：\n$$\nW_{2}^{2}(\\mu, \\nu) = \\inf_{\\gamma \\in \\Gamma(\\mu, \\nu)} \\int_{\\mathbb{R}^{d} \\times \\mathbb{R}^{d}} \\|x-y\\|^{2} \\, \\mathrm{d}\\gamma(x,y)\n$$\n其中 $\\Gamma(\\mu, \\nu)$ 是 $\\mathbb{R}^{d} \\times \\mathbb{R}^{d}$ 上所有边缘分布为 $\\mu$ 和 $\\nu$ 的联合概率测度（耦合）的集合。令 $(X, Y)$ 是联合分布为 $\\gamma$ 的一对随机向量。那么 $X \\sim \\mu$ 且 $Y \\sim \\nu$。该积分为期望 $\\mathbb{E}_{\\gamma}[\\|X-Y\\|^2]$。\n\n首先，我们根据均值分解平方范数项：\n$$\n\\|x-y\\|^2 = \\|(x-\\mu_1) - (y-\\mu_2) + (\\mu_1-\\mu_2)\\|^2\n$$\n展开此式，我们得到：\n$$\n\\|x-y\\|^2 = \\|(x-\\mu_1) - (y-\\mu_2)\\|^2 + \\|\\mu_1-\\mu_2\\|^2 + 2((x-\\mu_1) - (y-\\mu_2))^T(\\mu_1-\\mu_2)\n$$\n对 $\\gamma$ 取期望，我们有：\n$$\n\\mathbb{E}_{\\gamma}[\\|X-Y\\|^2] = \\mathbb{E}_{\\gamma}[\\|(X-\\mu_1) - (Y-\\mu_2)\\|^2] + \\|\\mu_1-\\mu_2\\|^2 + 2\\mathbb{E}_{\\gamma}[((X-\\mu_1) - (Y-\\mu_2))^T(\\mu_1-\\mu_2)]\n$$\n最后一项为零，因为 $\\mathbb{E}_{\\gamma}[X-\\mu_1] = \\mathbb{E}_{\\mu}[X]-\\mu_1 = \\mu_1-\\mu_1 = 0$ 且 $\\mathbb{E}_{\\gamma}[Y-\\mu_2] = \\mathbb{E}_{\\nu}[Y]-\\mu_2 = \\mu_2-\\mu_2 = 0$。\n项 $\\|\\mu_1-\\mu_2\\|^2$ 相对于耦合 $\\gamma$ 是一个常数。因此，最小化期望等价于最小化第一项，该项对应于中心化分布 $\\mathcal{N}(0, \\Sigma_1)$ 和 $\\mathcal{N}(0, \\Sigma_2)$ 之间的平方 $2$-Wasserstein 距离。\n这建立了如下分解：\n$$\nW_{2}^{2}(\\mathcal{N}(\\mu_1, \\Sigma_1), \\mathcal{N}(\\mu_2, \\Sigma_2)) = \\|\\mu_1-\\mu_2\\|^2 + W_{2}^{2}(\\mathcal{N}(0, \\Sigma_1), \\mathcal{N}(0, \\Sigma_2))\n$$\n现在，我们关注中心化的情况。令 $\\tilde{X} \\sim \\mathcal{N}(0, \\Sigma_1)$ 和 $\\tilde{Y} \\sim \\mathcal{N}(0, \\Sigma_2)$。我们试图计算：\n$$\nW_{2}^{2}(\\mathcal{N}(0, \\Sigma_1), \\mathcal{N}(0, \\Sigma_2)) = \\inf_{\\gamma} \\mathbb{E}_{\\gamma}[\\|\\tilde{X}-\\tilde{Y}\\|^2]\n$$\n展开范数：\n$$\n\\mathbb{E}_{\\gamma}[\\|\\tilde{X}-\\tilde{Y}\\|^2] = \\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{X} - 2\\tilde{X}^T\\tilde{Y} + \\tilde{Y}^T\\tilde{Y}] = \\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{X}] + \\mathbb{E}_{\\gamma}[\\tilde{Y}^T\\tilde{Y}] - 2\\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{Y}]\n$$\n由于边缘分布是固定的，前两项是常数：\n$$\n\\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{X}] = \\mathbb{E}_{\\gamma}[\\text{Tr}(\\tilde{X}\\tilde{X}^T)] = \\text{Tr}(\\mathbb{E}_{\\gamma}[\\tilde{X}\\tilde{X}^T]) = \\text{Tr}(\\text{Cov}(\\tilde{X})) = \\text{Tr}(\\Sigma_1)\n$$\n$$\n\\mathbb{E}_{\\gamma}[\\tilde{Y}^T\\tilde{Y}] = \\text{Tr}(\\Sigma_2)\n$$\n因此，问题简化为在所有有效的耦合 $\\gamma$ 上最大化交叉项 $\\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{Y}]$。\n$$\n\\mathbb{E}_{\\gamma}[\\tilde{X}^T\\tilde{Y}] = \\mathbb{E}_{\\gamma}[\\text{Tr}(\\tilde{Y}\\tilde{X}^T)] = \\text{Tr}(\\mathbb{E}_{\\gamma}[\\tilde{Y}\\tilde{X}^T]) = \\text{Tr}(\\text{Cov}(\\tilde{X}, \\tilde{Y}))\n$$\n任务是找到 $\\text{Tr}(\\Sigma_{12})$ 的上确界，其中 $\\Sigma_{12} = \\text{Cov}(\\tilde{X}, \\tilde{Y})$，遍及所有可能的耦合。为了使 $(\\tilde{X}, \\tilde{Y})$ 的联合分布成为一个有效的耦合，级联向量 $(\\tilde{X}^T, \\tilde{Y}^T)^T$ 的协方差矩阵必须是半正定的 (PSD)：\n$$\n\\begin{pmatrix} \\Sigma_1 & \\Sigma_{12} \\\\ \\Sigma_{12}^T & \\Sigma_2 \\end{pmatrix} \\succeq 0\n$$\n高斯测度最优传输中的一个基本结果指出，该迹的最大可达值为：（该结果可以从半正定矩阵的性质和迹不等式推导得出）\n$$\n\\sup_{\\gamma} \\text{Tr}(\\text{Cov}(\\tilde{X}, \\tilde{Y})) = \\text{Tr}((\\Sigma_1^{1/2} \\Sigma_2 \\Sigma_1^{1/2})^{1/2})\n$$\n其中 $A^{1/2}$ 表示一个半正定矩阵 $A$ 的唯一半正定平方根。\n\n综合所有部分，两个中心化高斯分布之间的平方 $2$-Wasserstein 距离为：\n$$\nW_{2}^{2}(\\mathcal{N}(0, \\Sigma_1), \\mathcal{N}(0, \\Sigma_2)) = \\text{Tr}(\\Sigma_1) + \\text{Tr}(\\Sigma_2) - 2 \\text{Tr}((\\Sigma_1^{1/2} \\Sigma_2 \\Sigma_1^{1/2})^{1/2})\n$$\n因此，Fréchet ChemNet 距离 (FCD)（即 $W_2^2$）的一般闭式表达式为：\n$$\n\\text{FCD} = W_{2}^{2}(\\mathcal{N}(\\mu_1, \\Sigma_1), \\mathcal{N}(\\mu_2, \\Sigma_2)) = \\|\\mu_1-\\mu_2\\|^2 + \\text{Tr}(\\Sigma_1) + \\text{Tr}(\\Sigma_2) - 2 \\text{Tr}((\\Sigma_1^{1/2} \\Sigma_2 \\Sigma_1^{1/2})^{1/2})\n$$\n推导至此完成。\n\n现在，我们为给定的分布计算这个距离：\n-   参考分布：$\\mu_1 = \\mu_{\\mathrm{ref}} = \\begin{pmatrix} 1 \\\\ -2 \\\\ 3 \\end{pmatrix}$，$\\Sigma_1 = \\Sigma_{\\mathrm{ref}} = \\mathrm{diag}(1, 4, 9)$\n-   生成分布：$\\mu_2 = \\mu_{\\mathrm{gen}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 1 \\end{pmatrix}$，$\\Sigma_2 = \\Sigma_{\\mathrm{gen}} = \\mathrm{diag}(4, 1, 16)$\n\n1. 计算均值差的平方范数：\n$$\n\\|\\mu_{\\mathrm{ref}} - \\mu_{\\mathrm{gen}}\\|^2 = \\left\\| \\begin{pmatrix} 1-0 \\\\ -2-1 \\\\ 3-1 \\end{pmatrix} \\right\\|^2 = \\left\\| \\begin{pmatrix} 1 \\\\ -3 \\\\ 2 \\end{pmatrix} \\right\\|^2 = 1^2 + (-3)^2 + 2^2 = 1 + 9 + 4 = 14\n$$\n\n2. 计算协方差矩阵的迹：\n$$\n\\text{Tr}(\\Sigma_{\\mathrm{ref}}) = 1 + 4 + 9 = 14\n$$\n$$\n\\text{Tr}(\\Sigma_{\\mathrm{gen}}) = 4 + 1 + 16 = 21\n$$\n\n3. 计算协方差交叉项的迹。由于 $\\Sigma_{\\mathrm{ref}}$ 和 $\\Sigma_{\\mathrm{gen}}$ 是对角矩阵，它们是可交换的。当 $\\Sigma_1$ 和 $\\Sigma_2$ 可交换时，表达式简化为：\n$$\n(\\Sigma_1^{1/2} \\Sigma_2 \\Sigma_1^{1/2})^{1/2} = (\\Sigma_1 \\Sigma_2)^{1/2} = \\Sigma_1^{1/2} \\Sigma_2^{1/2}\n$$\n我们来计算 $\\Sigma_1^{1/2}$ 和 $\\Sigma_2^{1/2}$：\n$$\n\\Sigma_{\\mathrm{ref}}^{1/2} = \\mathrm{diag}(\\sqrt{1}, \\sqrt{4}, \\sqrt{9}) = \\mathrm{diag}(1, 2, 3) = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 2 & 0 \\\\ 0 & 0 & 3 \\end{pmatrix}\n$$\n$$\n\\Sigma_{\\mathrm{gen}}^{1/2} = \\mathrm{diag}(\\sqrt{4}, \\sqrt{1}, \\sqrt{16}) = \\mathrm{diag}(2, 1, 4) = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 4 \\end{pmatrix}\n$$\n现在，计算它们的乘积：\n$$\n\\Sigma_{\\mathrm{ref}}^{1/2} \\Sigma_{\\mathrm{gen}}^{1/2} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 2 & 0 \\\\ 0 & 0 & 3 \\end{pmatrix} \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 4 \\end{pmatrix} = \\begin{pmatrix} 1 \\cdot 2 & 0 & 0 \\\\ 0 & 2 \\cdot 1 & 0 \\\\ 0 & 0 & 3 \\cdot 4 \\end{pmatrix} = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 2 & 0 \\\\ 0 & 0 & 12 \\end{pmatrix}\n$$\n该矩阵的迹为：\n$$\n\\text{Tr}(\\Sigma_{\\mathrm{ref}}^{1/2} \\Sigma_{\\mathrm{gen}}^{1/2}) = 2 + 2 + 12 = 16\n$$\n\n4. 组合得到 $W_2^2$ 的最终值：\n$$\nW_2^2 = 14 + 14 + 21 - 2(16) = 49 - 32 = 17\n$$\n问题要求的是 $2$-Wasserstein 距离 $W_2$，即该值的平方根。\n$$\nW_2 = \\sqrt{17}\n$$\n这就是该距离的精确解析值。",
            "answer": "$$\n\\boxed{\\sqrt{17}}\n$$"
        }
    ]
}