{
    "hands_on_practices": [
        {
            "introduction": "To understand the complex protonation equilibria in proteins, we must first master the behavior of a single, isolated titratable site. This foundational exercise guides you through the derivation of the theoretical titration curve, which describes the protonation fraction of a site as a function of pH. By analyzing the slope of this curve, you will uncover the direct mathematical relationship between a site's $pK_a$ and its maximum buffering capacity, a key principle in protein biophysics .",
            "id": "3860091",
            "problem": "A single proton-binding site embedded in a protein undergoes the chemical equilibrium $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$, with acid dissociation constant $K_{a}$ defined by activities as $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$. The acid dissociation constant $K_{a}$ is related to the acid strength via $pK_{a} = -\\log_{10}(K_{a})$, and the hydrogen ion activity defines $pH$ via $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$. Assume the site is isolated (no coupling to other ionizable groups), the solution is ideal so that activity ratios reflect the mass-action law, and temperature and ionic strength are fixed. \n\nUsing only these definitions and the law of mass action, derive an analytic expression for the protonation fraction $\\theta(pH)$ of the site (the fraction in the $\\mathrm{HA}$ state) as a function of $pH$ and $pK_{a}$. Then, differentiate this $\\theta(pH)$ with respect to $pH$ and evaluate the slope $\\frac{d\\theta}{d(pH)}$ at $pH = pK_{a}$. Interpret the physical meaning of this slope at $pH = pK_{a}$ in terms of the sensitivity of the site’s protonation state to changes in $pH$ and its role in local buffering by the protein microenvironment.\n\nExpress your final answer as an exact analytic expression. No rounding is required, and no units should be included in the final answer.",
            "solution": "The problem asks for the derivation of the protonation fraction $\\theta(pH)$ for a single ionizable site, the calculation of the slope of this function with respect to $pH$ at the point where $pH = pK_{a}$, and the physical interpretation of this slope.\n\nFirst, the problem is validated.\n**Step 1: Extract Givens**\n- Chemical Equilibrium: $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$\n- Acid Dissociation Constant: $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$\n- $pK_{a}$ Definition: $pK_{a} = -\\log_{10}(K_{a})$\n- $pH$ Definition: $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$\n- Protonation Fraction $\\theta(pH)$: The fraction of the site in the protonated state, $\\mathrm{HA}$.\n- Assumptions: The site is isolated, the solution is ideal (activity ratios can be represented by concentration ratios under the law of mass action), and temperature and ionic strength are constant.\n\n**Step 2: Validate Using Extracted Givens**\n- The problem is scientifically grounded, as it is based on the fundamental principles of acid-base chemistry, specifically the Henderson-Hasselbalch relationship.\n- The problem is well-posed. The provided definitions and assumptions are self-contained and sufficient to derive a unique, meaningful analytical solution.\n- The problem is objective, using clear and standard scientific terminology.\n- The problem does not violate any of the invalidity criteria. It is a standard, formalizable problem in chemical biology.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution process will proceed.\n\n**Derivation of the Protonation Fraction $\\theta(pH)$**\n\nThe protonation fraction, $\\theta$, is defined as the fraction of the total sites that are in the protonated state ($\\mathrm{HA}$). The total concentration of the site is the sum of the concentrations of the protonated form, $[\\mathrm{HA}]$, and the deprotonated form, $[\\mathrm{A}^{-}]$. Therefore, $\\theta$ is given by:\n$$\n\\theta = \\frac{[\\mathrm{HA}]}{[\\mathrm{HA}] + [\\mathrm{A}^{-}]}\n$$\nTo express $\\theta$ as a function of $pH$ and $pK_{a}$, we can manipulate this expression. Dividing both the numerator and the denominator by $[\\mathrm{HA}]$ gives:\n$$\n\\theta = \\frac{1}{1 + \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}}\n$$\nThe relationship between the concentrations is governed by the acid dissociation constant, $K_{a}$. The problem defines $K_{a}$ in terms of activities: $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$. With the assumption of an ideal solution, the ratio of activities of the acid and its conjugate base is equal to the ratio of their molar concentrations. Thus, we can write:\n$$\nK_{a} = \\frac{[\\mathrm{A}^{-}] a_{\\mathrm{H}^{+}}}{[\\mathrm{HA}]}\n$$\nRearranging this equation to solve for the ratio $\\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}$ yields:\n$$\n\\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]} = \\frac{K_{a}}{a_{\\mathrm{H}^{+}}}\n$$\nNow, substitute this ratio back into the expression for $\\theta$:\n$$\n\\theta = \\frac{1}{1 + \\frac{K_{a}}{a_{\\mathrm{H}^{+}}}}\n$$\nTo introduce $pH$ and $pK_{a}$, we use the given definitions: $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$ and $pK_{a} = -\\log_{10}(K_{a})$. These can be rewritten in exponential form as $a_{\\mathrm{H}^{+}} = 10^{-pH}$ and $K_{a} = 10^{-pK_{a}}$. Substituting these into the expression for $\\theta$:\n$$\n\\frac{K_{a}}{a_{\\mathrm{H}^{+}}} = \\frac{10^{-pK_{a}}}{10^{-pH}} = 10^{pH - pK_{a}}\n$$\nThus, the final expression for the protonation fraction $\\theta$ as a function of $pH$ and $pK_{a}$ is:\n$$\n\\theta(pH) = \\frac{1}{1 + 10^{pH - pK_{a}}}\n$$\n\n**Differentiation and Evaluation of the Slope**\n\nNext, we must find the derivative of $\\theta(pH)$ with respect to $pH$, which we denote as $\\frac{d\\theta}{d(pH)}$. Let $x = pH$ and $c = pK_{a}$ (a constant). The function is $\\theta(x) = (1 + 10^{x-c})^{-1}$. We use the chain rule for differentiation.\n$$\n\\frac{d\\theta}{d(pH)} = \\frac{d}{d(pH)} \\left( (1 + 10^{pH - pK_{a}})^{-1} \\right)\n$$\nApplying the power rule and the chain rule:\n$$\n\\frac{d\\theta}{d(pH)} = -1 \\cdot (1 + 10^{pH - pK_{a}})^{-2} \\cdot \\frac{d}{d(pH)} (1 + 10^{pH - pK_{a}})\n$$\nThe derivative of the inner function is:\n$$\n\\frac{d}{d(pH)} (1 + 10^{pH - pK_{a}}) = \\frac{d}{d(pH)} (10^{pH - pK_{a}})\n$$\nUsing the rule for the derivative of an exponential function, $\\frac{d}{dz}(b^z) = b^z \\ln(b)$, we get:\n$$\n\\frac{d}{d(pH)} (10^{pH - pK_{a}}) = 10^{pH - pK_{a}} \\ln(10) \\cdot \\frac{d}{d(pH)}(pH - pK_{a}) = 10^{pH - pK_{a}} \\ln(10) \\cdot 1\n$$\nCombining these results, the derivative of $\\theta(pH)$ is:\n$$\n\\frac{d\\theta}{d(pH)} = - \\frac{10^{pH - pK_{a}} \\ln(10)}{(1 + 10^{pH - pK_{a}})^2}\n$$\nThe problem requires evaluating this slope at the specific point where $pH = pK_{a}$. At this point, the exponent becomes $pH - pK_{a} = 0$.\n$$\n\\left. \\frac{d\\theta}{d(pH)} \\right|_{pH = pK_{a}} = - \\frac{10^{0} \\ln(10)}{(1 + 10^{0})^2}\n$$\nSince $10^0 = 1$, the expression simplifies to:\n$$\n\\left. \\frac{d\\theta}{d(pH)} \\right|_{pH = pK_{a}} = - \\frac{1 \\cdot \\ln(10)}{(1 + 1)^2} = - \\frac{\\ln(10)}{2^2} = - \\frac{\\ln(10)}{4}\n$$\n\n**Physical Interpretation**\n\nThe slope $\\frac{d\\theta}{d(pH)}$ quantifies the sensitivity of the protonation state of the site to a change in the solution's $pH$.\nThe calculated value of the slope at $pH = pK_{a}$ is $-\\frac{\\ln(10)}{4} \\approx -0.5756$.\n1.  **Negative Sign**: The negative sign indicates that as the $pH$ increases (i.e., the solution becomes more alkaline), the protonation fraction $\\theta$ decreases. This is chemically intuitive: a lower concentration of protons in the environment shifts the equilibrium $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$ to the right, favoring the deprotonated state $\\mathrm{A}^{-}$.\n2.  **Magnitude at $pH=pK_a$**: At $pH = pK_{a}$, the site is exactly half-protonated ($\\theta = 0.5$). The slope $\\frac{d\\theta}{d(pH)}$ reaches its maximum magnitude at this point. This means that the protonation state of the group is most sensitive to fluctuations in $pH$ when the $pH$ is equal to its $pK_{a}$. Small changes in the local $pH$ around the $pK_{a}$ will induce the largest possible change in the ratio of protonated to deprotonated species.\n3.  **Role in Buffering**: This maximal sensitivity is synonymous with maximal buffering capacity. A buffer resists changes in $pH$ by taking up or releasing protons. At $pH = pK_{a}$, the concentrations of the proton donor ($\\mathrm{HA}$) and proton acceptor ($\\mathrm{A}^{-}$) are equal, allowing the system to effectively absorb either added acid (by the reaction $\\mathrm{A}^{-} + \\mathrm{H}^{+} \\rightarrow \\mathrm{HA}$) or added base (by the reaction $\\mathrm{HA} + \\mathrm{OH}^{-} \\rightarrow \\mathrm{A}^{-} + \\mathrm{H}_{2}\\mathrm{O}$) with minimal change in the overall $pH$. Therefore, the value $-\\frac{\\ln(10)}{4}$ represents the maximal rate of change of the protonation state, which corresponds to the point where the titratable group exerts its greatest buffering effect on its local microenvironment.",
            "answer": "$$\\boxed{-\\frac{\\ln(10)}{4}}$$"
        },
        {
            "introduction": "While the single-site model is instructive, real amino acid residues like histidine present greater complexity, involving multiple protonation steps and tautomerism. This practice challenges you to translate theory into a working computational model by applying the principles of statistical mechanics . You will construct a partition function that accounts for all relevant microstates of histidine, allowing you to simulate its complete titration behavior and appreciate how intrinsic energies and environmental effects shape its response to pH.",
            "id": "3860065",
            "problem": "A single histidine side chain embedded in a protein can populate multiple chemically distinct microstates due to both acid-base chemistry and tautomerization of the imidazole ring. The neutral imidazole exists as two tautomers that differ by the position of the bound proton on the ring nitrogens, and the cationic state has two bound protons on the ring. The potential of Hydrogen (pH) of the solution controls the thermodynamic weight of each microstate through the proton chemical potential, which couples to the number of bound protons. Your task is to derive, implement, and test a statistically rigorous microstate enumeration that includes histidine tautomerization and multiple protonation states without double counting, and then compute the titration behavior.\n\nBegin from the following foundational bases:\n- Statistical mechanics with the Boltzmann distribution: the probability of a microstate with energy $G$ is proportional to $\\exp(-\\beta G)$, where $\\beta = 1/(R T)$, $R$ is the gas constant, and $T$ is the absolute temperature.\n- Chemical potential of a species in solution: for the proton, $\\mu_{\\mathrm{H}^+} = \\mu_{\\mathrm{H}^+}^{\\circ} + R T \\ln a_{\\mathrm{H}^+}$, with activity $a_{\\mathrm{H}^+} \\approx 10^{-\\mathrm{pH}}$ in dilute solutions. Therefore, $\\mu_{\\mathrm{H}^+} = \\mu_{\\mathrm{H}^+}^{\\circ} - R T \\ln(10)\\,\\mathrm{pH}$.\n- The negative base-10 logarithm of the acid dissociation constant (pKa) defines characteristic pH values at which acid-base transitions are half-populated in simple two-state systems.\n\nDefine the histidine microstates as unique, chemically distinguishable species:\n- Anionic imidazolate ($A_0$) with $n=0$ bound protons on the ring.\n- Neutral tautomer with proton on $\\mathrm{N}\\delta$ ($N_{1\\delta}$) with $n=1$ bound proton.\n- Neutral tautomer with proton on $\\mathrm{N}\\epsilon$ ($N_{1\\epsilon}$) with $n=1$ bound proton.\n- Cationic imidazolium ($C_2$) with $n=2$ bound protons.\nAvoid double counting by enumerating each chemically distinct microstate once. In particular, do not introduce multiple $C_2$ microstates for distinct protonation pathways; $C_2$ is a single chemical species.\n\nLet each microstate $i$ have an intrinsic standard-state free energy $G_i^{\\mathrm{intr}}$ in $\\mathrm{kcal/mol}$ that captures environmental stabilization independent of pH, and let $n_i$ be the integer number of bound protons on the ring. The pH-dependent effective free energy should be treated as $G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} - n_i\\,\\mu_{\\mathrm{H}^+}(\\mathrm{pH})$, and the observable probabilities are computed from Boltzmann weights at temperature $T$.\n\nImplement a program that:\n1. Enumerates the four microstates $\\{A_0, N_{1\\delta}, N_{1\\epsilon}, C_2\\}$ exactly once, with their $n_i$ values $\\{0,1,1,2\\}$ respectively, and computes their Boltzmann probabilities at a specified pH using $G_i(\\mathrm{pH})$ and $\\beta = 1/(R T)$.\n2. Computes the fraction of the cationic microstate $f_{C_2}(\\mathrm{pH})$ as the Boltzmann probability of $C_2$ divided by the partition function that sums over all four microstates.\n3. Uses the gas constant $R = 0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$, the temperature $T = 298.15$ $\\mathrm{K}$, and energies in $\\mathrm{kcal/mol}$.\n4. Accepts three distinct parameter sets (the test suite below), each specifying $G_{N_{1\\delta}}^{\\mathrm{intr}}$ by definition as $0$ $\\mathrm{kcal/mol}$, a tautomer energy offset $\\Delta_{\\mathrm{taut}}$ that sets $G_{N_{1\\epsilon}}^{\\mathrm{intr}} = \\Delta_{\\mathrm{taut}}$, a cation intrinsic energy $G_{C_2}^{\\mathrm{intr}}$, and an anion intrinsic energy $G_{A_0}^{\\mathrm{intr}}$. The cation and anion intrinsic energies are chosen to reflect target macroscopic transitions in the absence of tautomer imbalance. Specifically, for reference neutral energy $G_{N_{1\\delta}}^{\\mathrm{intr}} = 0$, use $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{cat}}$ to center the neutral-to-cation transition near $\\mathrm{p}K_{a}^{\\mathrm{cat}}$, and $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{ani}}$ to center the neutral-to-anion transition near $\\mathrm{p}K_{a}^{\\mathrm{ani}}$. These choices ensure scientific realism but still require proper microstate enumeration and Boltzmann statistics to obtain the correct titration behavior when $\\Delta_{\\mathrm{taut}} \\neq 0$.\n\nUse the following test suite of parameter sets and pH values:\n- Test Case 1 (symmetry of neutral tautomers): $\\Delta_{\\mathrm{taut}} = 0.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 14.0$. Set $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10)\\cdot 6.0$, $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10)\\cdot 14.0$.\n- Test Case 2 (environment stabilizes one tautomer): $\\Delta_{\\mathrm{taut}} = -2.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 14.0$. Set $G_{C_2}^{\\mathrm{intr}}$ and $G_{A_0}^{\\mathrm{intr}}$ as in Test Case 1.\n- Test Case 3 (anion transition shifted closer): $\\Delta_{\\mathrm{taut}} = 0.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 12.0$. Set $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10)\\cdot 6.0$, $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10)\\cdot 12.0$.\n\nCompute $f_{C_2}(\\mathrm{pH})$ at the pH values $\\mathrm{pH} \\in \\{4.0, 6.0, 8.0\\}$ for each test case. Express all energies in $\\mathrm{kcal/mol}$ and temperature in $\\mathrm{K}$. The final program output must be a single line containing the results as a comma-separated list enclosed in square brackets, ordered as:\n$[f_{C_2}^{\\text{TC1}}(4.0), f_{C_2}^{\\text{TC1}}(6.0), f_{C_2}^{\\text{TC1}}(8.0), f_{C_2}^{\\text{TC2}}(4.0), f_{C_2}^{\\text{TC2}}(6.0), f_{C_2}^{\\text{TC2}}(8.0), f_{C_2}^{\\text{TC3}}(4.0), f_{C_2}^{\\text{TC3}}(6.0), f_{C_2}^{\\text{TC3}}(8.0)]$.\n\nYour implementation must be self-contained, general, and avoid double counting by enumerating each microstate exactly once and summing its Boltzmann weight in the partition function. No additional user input or files are permitted.",
            "solution": "The problem has been validated and is determined to be a well-posed, scientifically grounded problem in computational chemical biology. The following solution provides a detailed derivation and plan for implementation.\n\n### Theoretical Framework\n\nThe objective is to compute the fractional population of the cationic microstate of a histidine side chain, denoted as $f_{C_2}(\\mathrm{pH})$, as a function of the solution's potential of Hydrogen, $\\mathrm{pH}$. The model considers four distinct chemical microstates: an anionic form ($A_0$), two neutral tautomers ($N_{1\\delta}$ and $N_{1\\epsilon}$), and a cationic form ($C_2$).\n\nFirst, we enumerate the microstates and their corresponding number of bound protons, $n_i$:\n-   Anionic imidazolate, $A_0$, with $n_{A_0} = 0$ protons.\n-   Neutral tautomer, $N_{1\\delta}$, with the proton on the $\\delta$-nitrogen, $n_{N_{1\\delta}} = 1$. This is our reference state.\n-   Neutral tautomer, $N_{1\\epsilon}$, with the proton on the $\\epsilon$-nitrogen, $n_{N_{1\\epsilon}} = 1$.\n-   Cationic imidazolium, $C_2$, with $n_{C_2} = 2$ protons.\n\nThe probability of observing a microstate $i$ is given by the Boltzmann distribution, where the probability $P_i$ is proportional to its Boltzmann weight $w_i = \\exp(-\\beta G_i)$, with $\\beta = 1/(RT)$. $R$ is the gas constant ($0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$) and $T$ is the temperature ($298.15$ $\\mathrm{K}$).\n\nThe free energy of each microstate, $G_i$, is dependent on $\\mathrm{pH}$ due to the exchange of protons with the solution. The problem specifies the pH-dependent effective free energy as $G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} - n_i\\,\\mu_{\\mathrm{H}^+}(\\mathrm{pH})$, where $G_i^{\\mathrm{intr}}$ is the intrinsic standard-state free energy and $\\mu_{\\mathrm{H}^+}(\\mathrm{pH}) = \\mu_{\\mathrm{H}^+}^{\\circ} - R T \\ln(10)\\,\\mathrm{pH}$ is the chemical potential of the proton. This formulation introduces a dependency on the standard chemical potential, $\\mu_{\\mathrm{H}^+}^{\\circ}$. However, the definition of intrinsic energies in terms of $\\mathrm{p}K_a$ values implies that the standard chemical potential terms are already incorporated. A standard, equivalent formulation for the pH-dependent free energy, consistent with the problem's definitions, is:\n$$G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} + n_i R T \\ln(10) \\cdot \\mathrm{pH}$$\nHere, $G_i^{\\mathrm{intr}}$ represents the standard free energy of the microstate at a reference pH of $0$. We will proceed with this physically consistent formulation.\n\nThe intrinsic free energies for each microstate are defined relative to the $N_{1\\delta}$ tautomer:\n-   $G_{N_{1\\delta}}^{\\mathrm{intr}} = 0$ $\\mathrm{kcal/mol}$ (by definition of the reference state).\n-   $G_{N_{1\\epsilon}}^{\\mathrm{intr}} = \\Delta_{\\mathrm{taut}}$.\n-   $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{cat}}$. This corresponds to the standard free energy change for the reaction $N_{1\\delta} + \\mathrm{H}^+ \\rightarrow C_2$.\n-   $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{ani}}$. This corresponds to the standard free energy change for the reaction $N_{1\\delta} \\rightarrow A_0 + \\mathrm{H}^+$.\n\n### Partition Function and State Probabilities\n\nThe Boltzmann weight $w_i(\\mathrm{pH})$ for each microstate $i$ is calculated as:\n$$w_i(\\mathrm{pH}) = \\exp(-\\beta G_i(\\mathrm{pH})) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}} + n_i R T \\ln(10) \\cdot \\mathrm{pH}}{RT}\\right)$$\nThis simplifies to:\n$$w_i(\\mathrm{pH}) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}}}{RT}\\right) \\exp(-n_i \\ln(10) \\cdot \\mathrm{pH}) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}}}{RT}\\right) 10^{-n_i \\cdot \\mathrm{pH}}$$\n\nApplying this to each of the four microstates:\n-   $w_{A_0}(\\mathrm{pH}) = \\exp\\left(-\\frac{+RT\\ln(10)\\mathrm{p}K_a^{\\mathrm{ani}}}{RT}\\right) \\cdot 10^{-0 \\cdot \\mathrm{pH}} = 10^{-\\mathrm{p}K_a^{\\mathrm{ani}}}$\n-   $w_{N_{1\\delta}}(\\mathrm{pH}) = \\exp\\left(-\\frac{0}{RT}\\right) \\cdot 10^{-1 \\cdot \\mathrm{pH}} = 10^{-\\mathrm{pH}}$\n-   $w_{N_{1\\epsilon}}(\\mathrm{pH}) = \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right) \\cdot 10^{-1 \\cdot \\mathrm{pH}}$\n-   $w_{C_2}(\\mathrm{pH}) = \\exp\\left(-\\frac{-RT\\ln(10)\\mathrm{p}K_a^{\\mathrm{cat}}}{RT}\\right) \\cdot 10^{-2 \\cdot \\mathrm{pH}} = 10^{\\mathrm{p}K_a^{\\mathrm{cat}}} \\cdot 10^{-2 \\cdot \\mathrm{pH}} = 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}$\n\nThe partition function, $Z(\\mathrm{pH})$, is the sum of the Boltzmann weights of all possible microstates:\n$$Z(\\mathrm{pH}) = w_{A_0}(\\mathrm{pH}) + w_{N_{1\\delta}}(\\mathrm{pH}) + w_{N_{1\\epsilon}}(\\mathrm{pH}) + w_{C_2}(\\mathrm{pH})$$\n$$Z(\\mathrm{pH}) = 10^{-\\mathrm{p}K_a^{\\mathrm{ani}}} + \\left(1 + \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right)\\right)10^{-\\mathrm{pH}} + 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}$$\n\nThe fractional population of the cationic state, $f_{C_2}(\\mathrm{pH})$, is the ratio of its Boltzmann weight to the partition function:\n$$f_{C_2}(\\mathrm{pH}) = \\frac{w_{C_2}(\\mathrm{pH})}{Z(\\mathrm{pH})} = \\frac{10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}}{10^{-\\mathrm{p}K_a^{\\mathrm{ani}}} + \\left(1 + \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right)\\right)10^{-\\mathrm{pH}} + 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}}$$\n\n### Algorithmic Implementation\n\nThe algorithm to solve the problem is as follows:\n1.  Define the constants $R = 0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$ and $T=298.15$ $\\mathrm{K}$. Pre-calculate the product $RT$.\n2.  Define the three test cases, each with specific values for $\\Delta_{\\mathrm{taut}}$, $\\mathrm{p}K_a^{\\mathrm{cat}}$, and $\\mathrm{p}K_a^{\\mathrm{ani}}$.\n3.  Define the list of pH values to be tested: $\\{4.0, 6.0, 8.0\\}$.\n4.  Iterate through each test case and, for each case, iterate through the list of pH values.\n5.  In each iteration, calculate the individual Boltzmann weights for the four microstates ($w_{A_0}$, $w_{N_{1\\delta}}$, $w_{N_{1\\epsilon}}$, $w_{C_2}$) using the formulas derived above.\n6.  Sum the weights to compute the partition function $Z(\\mathrm{pH})$.\n7.  Calculate the fractional population $f_{C_2}(\\mathrm{pH}) = w_{C_2}(\\mathrm{pH})/Z(\\mathrm{pH})$.\n8.  Collect all nine results in a single list, ordered as specified in the problem statement.\n9.  Format the list into the final output string.\n\nThis procedure ensures that each microstate is enumerated exactly once, respecting the problem's constraint against double counting, and that the calculation is performed according to the principles of statistical mechanics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the histidine titration problem by calculating the fractional population\n    of the cationic state for different parameter sets and pH values.\n    \"\"\"\n    \n    # Define physical constants\n    R = 0.0019872041  # gas constant in kcal/(mol·K)\n    T = 298.15        # temperature in K\n    RT = R * T        # Product RT in kcal/mol\n\n    # Define the test suite of parameter sets\n    # Each tuple is (delta_taut [kcal/mol], pKa_cat, pKa_ani)\n    test_cases = [\n        (0.0, 6.0, 14.0),   # Test Case 1\n        (-2.0, 6.0, 14.0),  # Test Case 2\n        (0.0, 6.0, 12.0),   # Test Case 3\n    ]\n    \n    # pH values to test for each case\n    ph_values = [4.0, 6.0, 8.0]\n    \n    results = []\n\n    for delta_taut, pka_cat, pka_ani in test_cases:\n        for ph in ph_values:\n            # Calculate the Boltzmann weights for each of the four microstates.\n            # The derivation in the solution text simplifies the weight expressions\n            # to be based on powers of 10.\n            \n            # Weight of the anionic state (A0, n=0)\n            # w_A0 = exp(-G_A0_intr / RT) * 10**(-0 * pH)\n            # G_A0_intr = RT * ln(10) * pKa_ani\n            # w_A0 = exp(-RT * ln(10) * pKa_ani / RT) = exp(-ln(10)*pKa_ani) = 10**(-pKa_ani)\n            w_a0 = 10**(-pka_ani)\n            \n            # Weights of the neutral tautomers (N1d and N1e, n=1)\n            # w_n1d = exp(-G_n1d_intr / RT) * 10**(-1 * pH)\n            # G_n1d_intr = 0 (reference)\n            w_n1d = 1.0 * (10**(-ph))\n            \n            # w_n1e = exp(-G_n1e_intr / RT) * 10**(-1 * pH)\n            # G_n1e_intr = delta_taut\n            w_n1e = np.exp(-delta_taut / RT) * (10**(-ph))\n            \n            # Weight of the cationic state (C2, n=2)\n            # w_c2 = exp(-G_c2_intr / RT) * 10**(-2 * pH)\n            # G_c2_intr = -RT * ln(10) * pKa_cat\n            # w_c2 = exp(RT * ln(10) * pKa_cat / RT) * 10**(-2*pH) = 10**pKa_cat * 10**(-2*pH)\n            w_c2 = 10**(pka_cat - 2 * ph)\n            \n            # The partition function is the sum of all weights\n            partition_function = w_a0 + w_n1d + w_n1e + w_c2\n            \n            # The fractional population of the cationic state is its weight divided by the partition function\n            f_c2 = w_c2 / partition_function\n            \n            results.append(f_c2)\n\n    # Format the final output string exactly as required.\n    # The default string conversion for floats provides sufficient precision.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A computational model is only as useful as its ability to reproduce and predict experimental reality. This final practice closes the loop of the scientific method by focusing on the critical skill of model validation . You will design and implement a quantitative protocol to assess the performance of hypothetical $pK_a$ predictions against experimental data, learning to calculate key statistical metrics of accuracy, bias, and correlation, and to probe for sources of systematic error.",
            "id": "3860076",
            "problem": "You are tasked with designing and implementing a quantitative validation protocol for comparing continuum Poisson–Boltzmann (PB)-predicted acid dissociation values to experimental protein titration data. Your implementation must adhere to the following principles and requirements.\n\nFundamental base. Begin from the thermodynamic definitions of acid–base equilibria: the acid dissociation constant satisfies $K_{a} = \\frac{[\\mathrm{A}^{-}][\\mathrm{H}^{+}]}{[\\mathrm{HA}]}$, the corresponding acidity is defined by $pK_{a} = -\\log_{10} K_{a}$, and the standard deprotonation free energy is related to $K_{a}$ by $\\Delta G^{\\circ} = - R T \\ln K_{a}$, implying $pK_{a} = \\Delta G^{\\circ} / (2.303 \\, R T)$. In PB-based electrostatics, the predicted $pK_{a}$ reflects the change in electrostatic solvation free energy upon deprotonation in the protein environment, so a systematic discrepancy in free energies manifests as an additive or multiplicative distortion of the predicted $pK_{a}$. Therefore, validation metrics should quantify error magnitude, error bias, linear calibration consistency, and correlation structure, while accounting for experimental uncertainty.\n\nDefinitions to implement. For a dataset consisting of pairs of PB predictions and experimental measurements, denote predicted values by the vector $\\mathbf{p}^{\\mathrm{pred}} = (x_{1}, \\dots, x_{n})$, experimental values by $\\mathbf{p}^{\\mathrm{exp}} = (y_{1}, \\dots, y_{n})$, and experimental standard uncertainties by $\\boldsymbol{\\sigma} = (\\sigma_{1}, \\dots, \\sigma_{n})$. Define residuals $\\mathbf{e}$ by $e_{i} = x_{i} - y_{i}$ and weights $w_{i} = 1/\\sigma_{i}^{2}$. The protocol requires the following quantities for each dataset:\n- Bias (mean signed error): $\\mathrm{Bias} = \\frac{1}{n}\\sum_{i=1}^{n} e_{i}$.\n- Mean absolute error: $\\mathrm{MAE} = \\frac{1}{n}\\sum_{i=1}^{n} |e_{i}|$.\n- Root mean squared error: $\\mathrm{RMSE} = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n} e_{i}^{2}}$.\n- Weighted root mean squared error: $\\mathrm{WRMSE} = \\sqrt{\\frac{\\sum_{i=1}^{n} w_{i} e_{i}^{2}}{\\sum_{i=1}^{n} w_{i}}}$.\n- Pearson correlation coefficient between $\\mathbf{p}^{\\mathrm{pred}}$ and $\\mathbf{p}^{\\mathrm{exp}}$: $r = \\frac{\\sum_{i=1}^{n} (x_{i} - \\bar{x})(y_{i} - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_{i} - \\bar{x})^{2} \\sum_{i=1}^{n} (y_{i} - \\bar{y})^{2}}}$, where $\\bar{x}$ and $\\bar{y}$ denote sample means.\n- Linear calibration parameters $(a, b)$ solving $\\min_{a,b} \\sum_{i=1}^{n} (a x_{i} + b - y_{i})^{2}$; these are given by the unique least-squares solution with $a = \\frac{\\sum_{i=1}^{n} (x_{i} - \\bar{x})(y_{i} - \\bar{y})}{\\sum_{i=1}^{n} (x_{i} - \\bar{x})^{2}}$ and $b = \\bar{y} - a \\bar{x}$.\n- Outlier fraction for threshold $\\tau$: $\\phi_{\\tau} = \\frac{1}{n}\\sum_{i=1}^{n} \\mathbf{1}\\{|e_{i}|  \\tau\\}$, where the indicator is $1$ when the condition is satisfied, else $0$. Use $\\tau = 1.0$ in $pK_{a}$ units (dimensionless).\n- Systematic error coefficients from an ordinary least squares linear model of residuals on environment features: if $\\mathbf{z}_{i} = (1, b_{i}, \\Delta I_{i}, s_{i})$ is the augmented feature vector with intercept, burial fraction $b_{i}\\in[0,1]$, ionic strength mismatch $\\Delta I_{i}$ in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$, and local charge sign $s_{i}\\in\\{-1,0,1\\}$, then find $\\mathbf{c} = (c_{0}, c_{1}, c_{2}, c_{3})^{\\top}$ minimizing $\\sum_{i=1}^{n} (e_{i} - \\mathbf{z}_{i}^{\\top} \\mathbf{c})^{2}$ and report $(c_{0}, c_{1}, c_{2}, c_{3})$.\n\nData to analyze (test suite). Apply the above to three datasets. For each dataset, you are given $(\\mathbf{p}^{\\mathrm{pred}}, \\mathbf{p}^{\\mathrm{exp}}, \\boldsymbol{\\sigma}, \\mathbf{B}, \\boldsymbol{\\Delta I}, \\mathbf{S})$, where $\\mathbf{B}$ is the burial fraction vector, $\\boldsymbol{\\Delta I}$ is the ionic strength mismatch vector, and $\\mathbf{S}$ is the local charge sign vector.\n\nDataset $1$ ($n = 8$):\n- $\\mathbf{p}^{\\mathrm{exp}} = (\\,4.0,\\, 4.3,\\, 6.5,\\, 10.4,\\, 9.9,\\, 8.5,\\, 3.2,\\, 7.8\\,)$.\n- $\\mathbf{p}^{\\mathrm{pred}} = (\\,3.8,\\, 4.1,\\, 6.2,\\, 10.2,\\, 9.7,\\, 8.4,\\, 3.0,\\, 7.6\\,)$.\n- $\\boldsymbol{\\sigma} = (\\,0.05,\\, 0.05,\\, 0.10,\\, 0.05,\\, 0.10,\\, 0.10,\\, 0.05,\\, 0.10\\,)$.\n- $\\mathbf{B} = (\\,0.2,\\, 0.4,\\, 0.5,\\, 0.1,\\, 0.3,\\, 0.7,\\, 0.6,\\, 0.2\\,)$.\n- $\\boldsymbol{\\Delta I} = (\\,0.05,\\, 0.10,\\, 0.00,\\, 0.05,\\, 0.20,\\, 0.15,\\, 0.00,\\, 0.10\\,)$ in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$.\n- $\\mathbf{S} = (\\, -1,\\, -1,\\, 1,\\, 1,\\, 0,\\, -1,\\, -1,\\, 1\\,)$.\n\nDataset $2$ ($n = 10$):\n- $\\mathbf{p}^{\\mathrm{exp}} = (\\,4.1,\\, 4.1,\\, 6.8,\\, 10.6,\\, 10.2,\\, 8.0,\\, 3.0,\\, 7.5,\\, 9.0,\\, 5.5\\,)$.\n- $\\mathbf{p}^{\\mathrm{pred}} = (\\,3.3,\\, 3.2,\\, 6.0,\\, 9.8,\\, 9.5,\\, 7.2,\\, 2.1,\\, 6.7,\\, 8.2,\\, 4.8\\,)$.\n- $\\boldsymbol{\\sigma} = (\\,0.05,\\, 0.05,\\, 0.10,\\, 0.05,\\, 0.10,\\, 0.15,\\, 0.05,\\, 0.10,\\, 0.10,\\, 0.05\\,)$.\n- $\\mathbf{B} = (\\,0.8,\\, 0.6,\\, 0.5,\\, 0.2,\\, 0.3,\\, 0.9,\\, 0.7,\\, 0.4,\\, 0.2,\\, 0.5\\,)$.\n- $\\boldsymbol{\\Delta I} = (\\,0.10,\\, 0.10,\\, 0.05,\\, 0.00,\\, 0.20,\\, 0.15,\\, 0.05,\\, 0.00,\\, 0.10,\\, 0.05\\,)$ in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$.\n- $\\mathbf{S} = (\\, -1,\\, -1,\\, 1,\\, 1,\\, 0,\\, -1,\\, -1,\\, 1,\\, 0,\\, 1\\,)$.\n\nDataset $3$ ($n = 7$):\n- $\\mathbf{p}^{\\mathrm{exp}} = (\\,2.8,\\, 3.0,\\, 12.5,\\, 1.2,\\, 13.0,\\, 9.5,\\, 7.0\\,)$.\n- $\\mathbf{p}^{\\mathrm{pred}} = (\\,3.2,\\, 3.5,\\, 11.0,\\, 2.0,\\, 11.5,\\, 9.2,\\, 6.6\\,)$.\n- $\\boldsymbol{\\sigma} = (\\,0.10,\\, 0.10,\\, 0.05,\\, 0.10,\\, 0.05,\\, 0.10,\\, 0.10\\,)$.\n- $\\mathbf{B} = (\\,0.9,\\, 0.8,\\, 0.1,\\, 0.9,\\, 0.2,\\, 0.5,\\, 0.4\\,)$.\n- $\\boldsymbol{\\Delta I} = (\\,0.20,\\, 0.20,\\, 0.00,\\, 0.15,\\, 0.00,\\, 0.10,\\, 0.05\\,)$ in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$.\n- $\\mathbf{S} = (\\, -1,\\, -1,\\, 1,\\, -1,\\, 1,\\, 0,\\, 1\\,)$.\n\nComputational tasks. For each dataset, compute the following $12$ quantities in order: $(\\mathrm{Bias}, \\mathrm{MAE}, \\mathrm{RMSE}, \\mathrm{WRMSE}, r, a, b, \\phi_{1.0}, c_{0}, c_{1}, c_{2}, c_{3})$, where $\\phi_{1.0}$ uses $\\tau = 1.0$. All $pK_{a}$ values and error metrics are dimensionless; the ionic strength mismatch is in $\\mathrm{mol}\\,\\mathrm{L}^{-1}$, and the burial fraction is unitless in $[0,1]$.\n\nFinal output format. Your program should produce a single line of output containing the concatenation of these $12$ numbers for Dataset $1$, then Dataset $2$, then Dataset $3$, as a comma-separated list enclosed in square brackets (for example, $[x_{1},x_{2},\\dots]$). Each number must be rounded to exactly $6$ decimal places using standard rounding and printed as a decimal (no scientific notation and no percentage signs). No additional text should be printed.",
            "solution": "The problem statement is valid. It presents a well-defined, scientifically grounded task in computational chemical biology, specifically the quantitative validation of theoretical predictions against experimental data. All necessary data, formulae, and conditions are provided, and they are internally consistent and free of scientific or logical flaws. The task is to compute a series of standard statistical metrics to assess the accuracy, precision, and sources of systematic error in a set of predicted protein $pK_{a}$ values.\n\nThe validation protocol is executed for each of the three provided datasets. A dataset consists of a vector of predicted $pK_{a}$ values $\\mathbf{p}^{\\mathrm{pred}} = \\{x_{i}\\}_{i=1}^{n}$, a corresponding vector of experimental values $\\mathbf{p}^{\\mathrm{exp}} = \\{y_{i}\\}_{i=1}^{n}$, and their associated experimental uncertainties $\\boldsymbol{\\sigma} = \\{\\sigma_{i}\\}_{i=1}^{n}$. Additionally, vectors of physical features are provided for systematic error analysis: burial fraction $\\mathbf{B} = \\{b_i\\}$, ionic strength mismatch $\\boldsymbol{\\Delta I} = \\{\\Delta I_i\\}$, and local charge sign $\\mathbf{S} = \\{s_i\\}$.\n\nThe analysis proceeds through the calculation of twelve specified quantities for each dataset.\n\n$1$. Calculation of Residuals\nThe foundation of error analysis is the vector of residuals, $\\mathbf{e}$, where each element $e_{i}$ is the difference between a predicted value and its corresponding experimental measurement:\n$$e_{i} = x_{i} - y_{i}$$\nThese residuals represent the per-datapoint error of the computational model.\n\n$2$. Overall Error Metrics\nFour metrics are computed to characterize the central tendency and magnitude of the error distribution.\n-   Bias (Mean Signed Error): This measures the average systematic error. A non-zero bias indicates a tendency of the model to either overpredict ($0$) or underpredict ($0$) the experimental values. It is defined as:\n    $$\\mathrm{Bias} = \\frac{1}{n}\\sum_{i=1}^{n} e_{i}$$\n-   Mean Absolute Error (MAE): This is the average of the absolute values of the errors, providing a measure of the typical error magnitude without regard to direction.\n    $$\\mathrm{MAE} = \\frac{1}{n}\\sum_{i=1}^{n} |e_{i}|$$\n-   Root Mean Squared Error (RMSE): This metric is sensitive to large errors due to the squaring of residuals. It quantifies the standard deviation of the prediction errors.\n    $$\\mathrm{RMSE} = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n} e_{i}^{2}}$$\n-   Weighted Root Mean Squared Error (WRMSE): This metric refines the RMSE by incorporating the experimental uncertainties $\\sigma_i$. Each squared residual is weighted by $w_i = 1/\\sigma_i^2$. A model whose prediction errors are on the same order as the experimental uncertainty will have a WRMSE close to $1.0$.\n    $$\\mathrm{WRMSE} = \\sqrt{\\frac{\\sum_{i=1}^{n} w_{i} e_{i}^{2}}{\\sum_{i=1}^{n} w_{i}}}$$\n\n$3$. Correlation and Linear Calibration\nThese metrics assess the linear relationship between predicted and experimental data.\n-   Pearson Correlation Coefficient ($r$): This statistic measures the strength and direction of the linear association between the predicted and experimental values. An ideal prediction would have $r = 1$. The coefficient is calculated as:\n    $$r = \\frac{\\sum_{i=1}^{n} (x_{i} - \\bar{x})(y_{i} - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_{i} - \\bar{x})^{2} \\sum_{i=1}^{n} (y_{i} - \\bar{y})^{2}}}$$\n    where $\\bar{x}$ and $\\bar{y}$ are the sample means of the predicted and experimental values, respectively.\n-   Linear Calibration Parameters ($a, b$): These parameters result from modeling the experimental data as a linear function of the predicted data, $y_{i} \\approx a x_{i} + b$. They are determined by minimizing the sum of squared errors, $\\sum_{i=1}^{n} (a x_{i} + b - y_{i})^{2}$. An ideal model corresponds to a slope of $a=1$ and an intercept of $b=0$. The parameters are given by the ordinary least-squares solution:\n    $$a = \\frac{\\sum_{i=1}^{n} (x_{i} - \\bar{x})(y_{i} - \\bar{y})}{\\sum_{i=1}^{n} (x_{i} - \\bar{x})^{2}}$$\n    $$b = \\bar{y} - a \\bar{x}$$\n\n$4$. Outlier Detection\n-   Outlier Fraction ($\\phi_{\\tau}$): This metric quantifies the proportion of predictions that are grossly inaccurate, defined as having an absolute error $|e_i|$ greater than a specified threshold $\\tau$. For this problem, $\\tau=1.0$ $pK_{a}$ unit. The fraction is computed using an indicator function $\\mathbf{1}$:\n    $$\\phi_{\\tau} = \\frac{1}{n}\\sum_{i=1}^{n} \\mathbf{1}\\{|e_{i}|  \\tau\\}$$\n\n$5$. Systematic Error Analysis\nTo investigate potential sources of systematic error, the residuals $e_i$ are modeled as a linear function of physical descriptors using ordinary least squares (OLS). The model is:\n$$e_{i} \\approx c_{0} + c_{1} b_{i} + c_{2} \\Delta I_{i} + c_{3} s_{i}$$\nThe feature vector for each data point is $\\mathbf{z}_{i} = (1, b_{i}, \\Delta I_{i}, s_{i})^{\\top}$. The goal is to find the coefficient vector $\\mathbf{c} = (c_{0}, c_{1}, c_{2}, c_{3})^{\\top}$ that minimizes the sum of squared differences $\\sum_{i=1}^{n} (e_{i} - \\mathbf{z}_{i}^{\\top} \\mathbf{c})^{2}$. In matrix form, this is equivalent to solving $\\mathbf{e} \\approx \\mathbf{Zc}$, where $\\mathbf{Z}$ is the $n \\times 4$ design matrix whose rows are $\\mathbf{z}_{i}^{\\top}$. The well-known OLS solution is $\\mathbf{c} = (\\mathbf{Z}^{\\top}\\mathbf{Z})^{-1}\\mathbf{Z}^{\\top}\\mathbf{e}$. This linear system is solved using numerically stable methods, such as those based on QR decomposition or Singular Value Decomposition (SVD), to yield the coefficients $(c_0, c_1, c_2, c_3)$. These coefficients quantify the dependence of the prediction error on a constant offset ($c_0$), residue burial ($c_1$), ionic strength mismatch ($c_2$), and local charge environment ($c_3$).\n\nThe algorithm is implemented by processing each of the three datasets through these computational steps. The resulting twelve metrics for each dataset are then concatenated and formatted as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import lstsq\n\ndef solve():\n    \"\"\"\n    Main function to process all datasets and print the final results.\n    \"\"\"\n    datasets = [\n        {\n            \"p_exp\": np.array([4.0, 4.3, 6.5, 10.4, 9.9, 8.5, 3.2, 7.8]),\n            \"p_pred\": np.array([3.8, 4.1, 6.2, 10.2, 9.7, 8.4, 3.0, 7.6]),\n            \"sigma\": np.array([0.05, 0.05, 0.10, 0.05, 0.10, 0.10, 0.05, 0.10]),\n            \"B\": np.array([0.2, 0.4, 0.5, 0.1, 0.3, 0.7, 0.6, 0.2]),\n            \"Delta_I\": np.array([0.05, 0.10, 0.00, 0.05, 0.20, 0.15, 0.00, 0.10]),\n            \"S\": np.array([-1, -1, 1, 1, 0, -1, -1, 1]),\n        },\n        {\n            \"p_exp\": np.array([4.1, 4.1, 6.8, 10.6, 10.2, 8.0, 3.0, 7.5, 9.0, 5.5]),\n            \"p_pred\": np.array([3.3, 3.2, 6.0, 9.8, 9.5, 7.2, 2.1, 6.7, 8.2, 4.8]),\n            \"sigma\": np.array([0.05, 0.05, 0.10, 0.05, 0.10, 0.15, 0.05, 0.10, 0.10, 0.05]),\n            \"B\": np.array([0.8, 0.6, 0.5, 0.2, 0.3, 0.9, 0.7, 0.4, 0.2, 0.5]),\n            \"Delta_I\": np.array([0.10, 0.10, 0.05, 0.00, 0.20, 0.15, 0.05, 0.00, 0.10, 0.05]),\n            \"S\": np.array([-1, -1, 1, 1, 0, -1, -1, 1, 0, 1]),\n        },\n        {\n            \"p_exp\": np.array([2.8, 3.0, 12.5, 1.2, 13.0, 9.5, 7.0]),\n            \"p_pred\": np.array([3.2, 3.5, 11.0, 2.0, 11.5, 9.2, 6.6]),\n            \"sigma\": np.array([0.10, 0.10, 0.05, 0.10, 0.05, 0.10, 0.10]),\n            \"B\": np.array([0.9, 0.8, 0.1, 0.9, 0.2, 0.5, 0.4]),\n            \"Delta_I\": np.array([0.20, 0.20, 0.00, 0.15, 0.00, 0.10, 0.05]),\n            \"S\": np.array([-1, -1, 1, -1, 1, 0, 1]),\n        }\n    ]\n\n    all_results = []\n    for data in datasets:\n        results = calculate_metrics(data)\n        all_results.extend(results)\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"{val:.6f}\" for val in all_results]) + \"]\"\n    print(output_str)\n\ndef calculate_metrics(data):\n    \"\"\"\n    Calculates all 12 validation metrics for a single dataset.\n    \n    Args:\n        data (dict): A dictionary containing numpy arrays for p_pred, p_exp,\n                     sigma, B, Delta_I, and S.\n\n    Returns:\n        list: A list of 12 calculated metric values.\n    \"\"\"\n    x = data[\"p_pred\"]\n    y = data[\"p_exp\"]\n    sigma = data[\"sigma\"]\n    B = data[\"B\"]\n    Delta_I = data[\"Delta_I\"]\n    S = data[\"S\"]\n    \n    n = len(x)\n\n    # 1. Residuals\n    e = x - y\n\n    # 2. Bias (Mean Signed Error)\n    bias = np.mean(e)\n\n    # 3. Mean Absolute Error (MAE)\n    mae = np.mean(np.abs(e))\n\n    # 4. Root Mean Squared Error (RMSE)\n    rmse = np.sqrt(np.mean(e**2))\n\n    # 5. Weighted Root Mean Squared Error (WRMSE)\n    w = 1.0 / (sigma**2)\n    wrmse = np.sqrt(np.sum(w * e**2) / np.sum(w))\n\n    # 6. Pearson Correlation Coefficient (r)\n    # Using np.corrcoef is a robust way to calculate r\n    r = np.corrcoef(x, y)[0, 1]\n\n    # 7. Linear Calibration Parameters (a, b)\n    # y ≈ a*x + b\n    x_mean = np.mean(x)\n    y_mean = np.mean(y)\n    \n    # Calculate slope 'a'\n    numerator_a = np.sum((x - x_mean) * (y - y_mean))\n    denominator_a = np.sum((x - x_mean)**2)\n    a = numerator_a / denominator_a\n    \n    # Calculate intercept 'b'\n    b = y_mean - a * x_mean\n\n    # 8. Outlier Fraction (phi_tau)\n    tau = 1.0\n    outlier_count = np.sum(np.abs(e) > tau)\n    phi_1_0 = outlier_count / n\n\n    # 9-12. Systematic Error Coefficients (c0, c1, c2, c3)\n    # Model: e ≈ c0 + c1*B + c2*Delta_I + c3*S\n    # Construct the design matrix Z\n    Z = np.vstack([np.ones(n), B, Delta_I, S]).T\n    \n    # Solve the ordinary least squares problem: Zc = e\n    # lstsq returns the solution 'c', residuals, rank, and singular values\n    c_coeffs, _, _, _ = lstsq(Z, e)\n    c0, c1, c2, c3 = c_coeffs\n\n    return [bias, mae, rmse, wrmse, r, a, b, phi_1_0, c0, c1, c2, c3]\n\nsolve()\n```"
        }
    ]
}