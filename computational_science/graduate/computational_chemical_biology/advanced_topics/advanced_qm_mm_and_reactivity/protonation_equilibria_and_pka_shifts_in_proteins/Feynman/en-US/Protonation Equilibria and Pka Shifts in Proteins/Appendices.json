{
    "hands_on_practices": [
        {
            "introduction": "The fundamental building block for understanding protein titration is the behavior of a single, isolated ionizable group. This first exercise  guides you through the derivation of the classic titration curve equation, which relates the protonation fraction $ \\theta $ to the solution's $ \\mathrm{pH} $. By analyzing the slope of this curve, you will uncover the direct mathematical link between the group's $ pK_a $ and its maximal buffering capacity, a key concept in local pH regulation within biomolecules.",
            "id": "3860091",
            "problem": "A single proton-binding site embedded in a protein undergoes the chemical equilibrium $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$, with acid dissociation constant $K_{a}$ defined by activities as $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$. The acid dissociation constant $K_{a}$ is related to the acid strength via $pK_{a} = -\\log_{10}(K_{a})$, and the hydrogen ion activity defines $pH$ via $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$. Assume the site is isolated (no coupling to other ionizable groups), the solution is ideal so that activity ratios reflect the mass-action law, and temperature and ionic strength are fixed. \n\nUsing only these definitions and the law of mass action, derive an analytic expression for the protonation fraction $\\theta(pH)$ of the site (the fraction in the $\\mathrm{HA}$ state) as a function of $pH$ and $pK_{a}$. Then, differentiate this $\\theta(pH)$ with respect to $pH$ and evaluate the slope $\\frac{d\\theta}{d(pH)}$ at $pH = pK_{a}$. Interpret the physical meaning of this slope at $pH = pK_{a}$ in terms of the sensitivity of the site’s protonation state to changes in $pH$ and its role in local buffering by the protein microenvironment.\n\nExpress your final answer as an exact analytic expression. No rounding is required, and no units should be included in the final answer.",
            "solution": "The problem asks for the derivation of the protonation fraction $\\theta(pH)$ for a single ionizable site, the calculation of the slope of this function with respect to $pH$ at the point where $pH = pK_{a}$, and the physical interpretation of this slope.\n\nFirst, the problem is validated.\n**Step 1: Extract Givens**\n- Chemical Equilibrium: $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$\n- Acid Dissociation Constant: $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$\n- $pK_{a}$ Definition: $pK_{a} = -\\log_{10}(K_{a})$\n- $pH$ Definition: $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$\n- Protonation Fraction $\\theta(pH)$: The fraction of the site in the protonated state, $\\mathrm{HA}$.\n- Assumptions: The site is isolated, the solution is ideal (activity ratios can be represented by concentration ratios under the law of mass action), and temperature and ionic strength are constant.\n\n**Step 2: Validate Using Extracted Givens**\n- The problem is scientifically grounded, as it is based on the fundamental principles of acid-base chemistry, specifically the Henderson-Hasselbalch relationship.\n- The problem is well-posed. The provided definitions and assumptions are self-contained and sufficient to derive a unique, meaningful analytical solution.\n- The problem is objective, using clear and standard scientific terminology.\n- The problem does not violate any of the invalidity criteria. It is a standard, formalizable problem in chemical biology.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution process will proceed.\n\n**Derivation of the Protonation Fraction $\\theta(pH)$**\n\nThe protonation fraction, $\\theta$, is defined as the fraction of the total sites that are in the protonated state ($\\mathrm{HA}$). The total concentration of the site is the sum of the concentrations of the protonated form, $[\\mathrm{HA}]$, and the deprotonated form, $[\\mathrm{A}^{-}]$. Therefore, $\\theta$ is given by:\n$$\n\\theta = \\frac{[\\mathrm{HA}]}{[\\mathrm{HA}] + [\\mathrm{A}^{-}]}\n$$\nTo express $\\theta$ as a function of $pH$ and $pK_{a}$, we can manipulate this expression. Dividing both the numerator and the denominator by $[\\mathrm{HA}]$ gives:\n$$\n\\theta = \\frac{1}{1 + \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}}\n$$\nThe relationship between the concentrations is governed by the acid dissociation constant, $K_{a}$. The problem defines $K_{a}$ in terms of activities: $K_{a} = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}$. With the assumption of an ideal solution, the ratio of activities of the acid and its conjugate base is equal to the ratio of their molar concentrations. Thus, we can write:\n$$\nK_{a} = \\frac{[\\mathrm{A}^{-}] a_{\\mathrm{H}^{+}}}{[\\mathrm{HA}]}\n$$\nRearranging this equation to solve for the ratio $\\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}$ yields:\n$$\n\\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]} = \\frac{K_{a}}{a_{\\mathrm{H}^{+}}}\n$$\nNow, substitute this ratio back into the expression for $\\theta$:\n$$\n\\theta = \\frac{1}{1 + \\frac{K_{a}}{a_{\\mathrm{H}^{+}}}}\n$$\nTo introduce $pH$ and $pK_{a}$, we use the given definitions: $pH = -\\log_{10}(a_{\\mathrm{H}^{+}})$ and $pK_{a} = -\\log_{10}(K_{a})$. These can be rewritten in exponential form as $a_{\\mathrm{H}^{+}} = 10^{-pH}$ and $K_{a} = 10^{-pK_{a}}$. Substituting these into the expression for $\\theta$:\n$$\n\\frac{K_{a}}{a_{\\mathrm{H}^{+}}} = \\frac{10^{-pK_{a}}}{10^{-pH}} = 10^{pH - pK_{a}}\n$$\nThus, the final expression for the protonation fraction $\\theta$ as a function of $pH$ and $pK_{a}$ is:\n$$\n\\theta(pH) = \\frac{1}{1 + 10^{pH - pK_{a}}}\n$$\n\n**Differentiation and Evaluation of the Slope**\n\nNext, we must find the derivative of $\\theta(pH)$ with respect to $pH$, which we denote as $\\frac{d\\theta}{d(pH)}$. Let $x = pH$ and $c = pK_{a}$ (a constant). The function is $\\theta(x) = (1 + 10^{x-c})^{-1}$. We use the chain rule for differentiation.\n$$\n\\frac{d\\theta}{d(pH)} = \\frac{d}{d(pH)} \\left( (1 + 10^{pH - pK_{a}})^{-1} \\right)\n$$\nApplying the power rule and the chain rule:\n$$\n\\frac{d\\theta}{d(pH)} = -1 \\cdot (1 + 10^{pH - pK_{a}})^{-2} \\cdot \\frac{d}{d(pH)} (1 + 10^{pH - pK_{a}})\n$$\nThe derivative of the inner function is:\n$$\n\\frac{d}{d(pH)} (1 + 10^{pH - pK_{a}}) = \\frac{d}{d(pH)} (10^{pH - pK_{a}})\n$$\nUsing the rule for the derivative of an exponential function, $\\frac{d}{dz}(b^z) = b^z \\ln(b)$, we get:\n$$\n\\frac{d}{d(pH)} (10^{pH - pK_{a}}) = 10^{pH - pK_{a}} \\ln(10) \\cdot \\frac{d}{d(pH)}(pH - pK_{a}) = 10^{pH - pK_{a}} \\ln(10) \\cdot 1\n$$\nCombining these results, the derivative of $\\theta(pH)$ is:\n$$\n\\frac{d\\theta}{d(pH)} = - \\frac{10^{pH - pK_{a}} \\ln(10)}{(1 + 10^{pH - pK_{a}})^2}\n$$\nThe problem requires evaluating this slope at the specific point where $pH = pK_{a}$. At this point, the exponent becomes $pH - pK_{a} = 0$.\n$$\n\\left. \\frac{d\\theta}{d(pH)} \\right|_{pH = pK_{a}} = - \\frac{10^{0} \\ln(10)}{(1 + 10^{0})^2}\n$$\nSince $10^0 = 1$, the expression simplifies to:\n$$\n\\left. \\frac{d\\theta}{d(pH)} \\right|_{pH = pK_{a}} = - \\frac{1 \\cdot \\ln(10)}{(1 + 1)^2} = - \\frac{\\ln(10)}{2^2} = - \\frac{\\ln(10)}{4}\n$$\n\n**Physical Interpretation**\n\nThe slope $\\frac{d\\theta}{d(pH)}$ quantifies the sensitivity of the protonation state of the site to a change in the solution's $pH$.\nThe calculated value of the slope at $pH = pK_{a}$ is $-\\frac{\\ln(10)}{4} \\approx -0.5756$.\n1.  **Negative Sign**: The negative sign indicates that as the $pH$ increases (i.e., the solution becomes more alkaline), the protonation fraction $\\theta$ decreases. This is chemically intuitive: a lower concentration of protons in the environment shifts the equilibrium $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$ to the right, favoring the deprotonated state $\\mathrm{A}^{-}$.\n2.  **Magnitude at $pH=pK_a$**: At $pH = pK_{a}$, the site is exactly half-protonated ($\\theta = 0.5$). The slope $\\frac{d\\theta}{d(pH)}$ reaches its maximum magnitude at this point. This means that the protonation state of the group is most sensitive to fluctuations in $pH$ when the $pH$ is equal to its $pK_{a}$. Small changes in the local $pH$ around the $pK_{a}$ will induce the largest possible change in the ratio of protonated to deprotonated species.\n3.  **Role in Buffering**: This maximal sensitivity is synonymous with maximal buffering capacity. A buffer resists changes in $pH$ by taking up or releasing protons. At $pH = pK_{a}$, the concentrations of the proton donor ($\\mathrm{HA}$) and proton acceptor ($\\mathrm{A}^{-}$) are equal, allowing the system to effectively absorb either added acid (by the reaction $\\mathrm{A}^{-} + \\mathrm{H}^{+} \\rightarrow \\mathrm{HA}$) or added base (by the reaction $\\mathrm{HA} + \\mathrm{OH}^{-} \\rightarrow \\mathrm{A}^{-} + \\mathrm{H}_{2}\\mathrm{O}$) with minimal change in the overall $pH$. Therefore, the value $-\\frac{\\ln(10)}{4}$ represents the maximal rate of change of the protonation state, which corresponds to the point where the titratable group exerts its greatest buffering effect on its local microenvironment.",
            "answer": "$$\\boxed{-\\frac{\\ln(10)}{4}}$$"
        },
        {
            "introduction": "Ionizable groups in proteins rarely act in isolation; their protonation states are often coupled through electrostatic interactions. This practice  elevates our model to a two-site system, introducing the essential concepts of microscopic constants, cooperativity, and the statistical mechanical binding polynomial. By deriving the average proton uptake and solving for the macroscopic titration midpoint, you will see how interactions between sites give rise to emergent titration behavior that cannot be described by a simple single-site model.",
            "id": "3860122",
            "problem": "Consider a protein microenvironment hosting two coupled titratable sites, denoted site $A$ and site $B$, which can each bind a proton from solution. Assume ideal solution behavior so that the hydrogen ion activity is $a_{H} = 10^{-\\mathrm{pH}}$. Let the microscopic association constants for proton binding to the sites, when the partner site is deprotonated, be $K_{A}^{(0)}$ and $K_{B}^{(0)}$, respectively. Coupling between the sites is described by a positive cooperativity factor $\\omega > 0$ that multiplies the statistical weight of the doubly protonated state relative to the product of the singly protonated weights; equivalently, thermodynamic cycle closure implies the second-step association constant for either site is $\\omega$ times its first-step constant. All association constants are referenced to a $1\\,\\mathrm{M}$ standard state and are therefore dimensionless.\n\nStarting from the law of mass action, the statistical weighting of protonation microstates, and the definition of the binding polynomial for ligand binding in statistical thermodynamics, derive an expression for the average number of protons bound, $n(\\mathrm{pH})$, in terms of $a_{H}$, $K_{A}^{(0)}$, $K_{B}^{(0)}$, and $\\omega$. Then determine the macroscopic titration midpoint defined as the hydrogen ion activity $a_{H}^{\\ast}$ at which the expected total proton uptake equals one, i.e., $n = 1$. Finally, compute the corresponding apparent acid dissociation constant ($pK_{a}$), defined here as $\\mathrm{p}K_{a,\\mathrm{app}} = -\\log_{10}(a_{H}^{\\ast})$.\n\nUse the following hypothetical microscopic parameters, which are scientifically plausible for protein interior sites: $K_{A}^{(0)} = 3.16227766 \\times 10^{6}$, $K_{B}^{(0)} = 1.00000000 \\times 10^{5}$, and $\\omega = 10.00000000$. Provide your final numerical values for $a_{H}^{\\ast}$ and $\\mathrm{p}K_{a,\\mathrm{app}}$ rounded to four significant figures. Express your answer as a row matrix $\\left(a_{H}^{\\ast} \\text{ , } \\mathrm{p}K_{a,\\mathrm{app}}\\right)$.",
            "solution": "The problem statement is critically validated and found to be valid. It is scientifically grounded in the principles of statistical thermodynamics and chemical equilibrium as applied to protein biophysics. It is well-posed, objective, self-contained, and free of contradictions or ambiguities.\n\nThe system consists of two titratable sites, $A$ and $B$, which can be either deprotonated (e.g., $A$) or protonated (e.g., $AH$). This gives rise to $2^2 = 4$ possible protonation microstates: $(A, B)$, $(AH, B)$, $(A, BH)$, and $(AH, BH)$. The average number of protons bound to the protein, $n(\\mathrm{pH})$, can be determined using a statistical mechanical approach based on the relative populations of these microstates at a given hydrogen ion activity, $a_{H} = 10^{-\\mathrm{pH}}$.\n\nFirst, we define the statistical weights ($W$) of each microstate. By convention, the weight of the fully deprotonated reference state $(A, B)$ is set to $1$.\n$$W_{00} = [A, B] / [A, B] = 1$$\nThe weights of the other states are determined by the law of mass action for the proton binding equilibria that connect them to the reference state. Let $x = a_{H}$ denote the hydrogen ion activity.\n\nThe singly protonated state $(AH, B)$ is formed via the reaction $(A, B) + H^{+} \\rightleftharpoons (AH, B)$. The problem defines the microscopic association constant for this step as $K_{A}^{(0)}$.\n$$K_{A}^{(0)} = \\frac{[AH, B]}{[A, B] \\cdot a_{H}}$$\nThus, the statistical weight of the $(AH, B)$ state, which has one proton on site $A$ and zero on site $B$, is:\n$$W_{10} = \\frac{[AH, B]}{[A, B]} = K_{A}^{(0)} a_{H}$$\nSimilarly, for the state $(A, BH)$, formed via $(A, B) + H^{+} \\rightleftharpoons (A, BH)$ with association constant $K_{B}^{(0)}$:\n$$K_{B}^{(0)} = \\frac{[A, BH]}{[A, B] \\cdot a_{H}}$$\nThe statistical weight of the $(A, BH)$ state, with zero protons on $A$ and one on $B$, is:\n$$W_{01} = \\frac{[A, BH]}{[A, B]} = K_{B}^{(0)} a_{H}$$\nThe doubly protonated state $(AH, BH)$ can be formed from either singly protonated state. Let's consider its formation from $(AH, B)$: $(AH, B) + H^{+} \\rightleftharpoons (AH, BH)$. The association constant is $K_{B}^{(A)}$. The problem states that the second-step association constant is $\\omega$ times the first-step constant, so $K_{B}^{(A)} = \\omega K_{B}^{(0)}$.\n$$K_{B}^{(A)} = \\frac{[AH, BH]}{[AH, B] \\cdot a_{H}} = \\omega K_{B}^{(0)}$$\nThe weight of the $(AH, BH)$ state can be expressed relative to the reference state:\n$$W_{11} = \\frac{[AH, BH]}{[A, B]} = \\frac{[AH, BH]}{[AH, B]} \\frac{[AH, B]}{[A, B]} = (K_{B}^{(A)} a_{H}) (K_{A}^{(0)} a_{H}) = (\\omega K_{B}^{(0)} a_{H}) (K_{A}^{(0)} a_{H}) = \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}$$\nThis result is consistent with the thermodynamic cycle closure condition $K_{A}^{(0)} K_{B}^{(A)} = K_{B}^{(0)} K_{A}^{(B)}$ and the definition of cooperativity $\\omega$.\n\nThe binding polynomial, $\\Xi(a_{H})$, is the sum of the statistical weights of all possible microstates. It serves as the partition function for the system.\n$$\\Xi(a_{H}) = W_{00} + W_{10} + W_{01} + W_{11}$$\n$$\\Xi(a_{H}) = 1 + K_{A}^{(0)} a_{H} + K_{B}^{(0)} a_{H} + \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}$$\n$$\\Xi(a_{H}) = 1 + (K_{A}^{(0)} + K_{B}^{(0)}) a_{H} + \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}$$\nThe average number of protons bound, $n(a_{H})$, is derived from the binding polynomial using the standard statistical mechanical formula:\n$$n(a_{H}) = a_{H} \\frac{d}{d a_{H}} \\ln(\\Xi(a_{H})) = \\frac{a_{H}}{\\Xi(a_{H})} \\frac{d\\Xi(a_{H})}{d a_{H}}$$\nFirst, we find the derivative of $\\Xi(a_{H})$ with respect to $a_{H}$:\n$$\\frac{d\\Xi(a_{H})}{d a_{H}} = K_{A}^{(0)} + K_{B}^{(0)} + 2 \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}$$\nSubstituting this into the expression for $n(a_{H})$:\n$$n(a_{H}) = \\frac{a_{H} \\left( K_{A}^{(0)} + K_{B}^{(0)} + 2 \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H} \\right)}{1 + (K_{A}^{(0)} + K_{B}^{(0)}) a_{H} + \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}}$$\n$$n(a_{H}) = \\frac{(K_{A}^{(0)} + K_{B}^{(0)}) a_{H} + 2 \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}}{1 + (K_{A}^{(0)} + K_{B}^{(0)}) a_{H} + \\omega K_{A}^{(0)} K_{B}^{(0)} a_{H}^{2}}$$\nThis is the derived expression for the average number of protons bound.\n\nThe macroscopic titration midpoint is defined as the hydrogen ion activity $a_{H}^{\\ast}$ at which the average number of bound protons is exactly one, i.e., $n(a_{H}^{\\ast}) = 1$.\n$$1 = \\frac{(K_{A}^{(0)} + K_{B}^{(0)}) a_{H}^{\\ast} + 2 \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}}{1 + (K_{A}^{(0)} + K_{B}^{(0)}) a_{H}^{\\ast} + \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}}$$\nMultiplying both sides by the denominator gives:\n$$1 + (K_{A}^{(0)} + K_{B}^{(0)}) a_{H}^{\\ast} + \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2} = (K_{A}^{(0)} + K_{B}^{(0)}) a_{H}^{\\ast} + 2 \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}$$\nThe term $(K_{A}^{(0)} + K_{B}^{(0)}) a_{H}^{\\ast}$ cancels from both sides, yielding a simplified equation:\n$$1 + \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2} = 2 \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}$$\nSubtracting $\\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}$ from both sides gives:\n$$1 = \\omega K_{A}^{(0)} K_{B}^{(0)} (a_{H}^{\\ast})^{2}$$\nSolving for $a_{H}^{\\ast}$, we take the positive root since activity must be positive:\n$$(a_{H}^{\\ast})^{2} = \\frac{1}{\\omega K_{A}^{(0)} K_{B}^{(0)}}$$\n$$a_{H}^{\\ast} = \\frac{1}{\\sqrt{\\omega K_{A}^{(0)} K_{B}^{(0)}}}$$\nThe apparent acid dissociation constant is defined as $\\mathrm{p}K_{a,\\mathrm{app}} = -\\log_{10}(a_{H}^{\\ast})$.\n$$\\mathrm{p}K_{a,\\mathrm{app}} = -\\log_{10}\\left( (\\omega K_{A}^{(0)} K_{B}^{(0)})^{-1/2} \\right) = \\frac{1}{2} \\log_{10}(\\omega K_{A}^{(0)} K_{B}^{(0)})$$\n$$\\mathrm{p}K_{a,\\mathrm{app}} = \\frac{1}{2} (\\log_{10}(\\omega) + \\log_{10}(K_{A}^{(0)}) + \\log_{10}(K_{B}^{(0)}))$$\nNow we substitute the given numerical values:\n$K_{A}^{(0)} = 3.16227766 \\times 10^{6}$. We note that $3.16227766$ is the numerical value of $\\sqrt{10}$ to high precision, so we can write $K_{A}^{(0)} = 10^{0.5} \\times 10^{6} = 10^{6.5}$.\n$K_{B}^{(0)} = 1.00000000 \\times 10^{5} = 10^{5}$.\n$\\omega = 10.00000000 = 10^{1}$.\n\nFirst, we compute the product in the denominator for $a_{H}^{\\ast}$:\n$$\\omega K_{A}^{(0)} K_{B}^{(0)} = (10^{1}) \\cdot (10^{6.5}) \\cdot (10^{5}) = 10^{(1 + 6.5 + 5)} = 10^{12.5}$$\nNow, we find $a_{H}^{\\ast}$:\n$$a_{H}^{\\ast} = \\frac{1}{\\sqrt{10^{12.5}}} = \\frac{1}{10^{12.5/2}} = \\frac{1}{10^{6.25}} = 10^{-6.25}$$\nTo express this in standard scientific notation, we calculate $10^{-6.25} = 10^{0.75} \\times 10^{-7}$.\n$10^{0.75} \\approx 5.62341325$.\nSo, $a_{H}^{\\ast} \\approx 5.62341325 \\times 10^{-7}$.\nRounding to $4$ significant figures, we get $a_{H}^{\\ast} = 5.623 \\times 10^{-7}$.\n\nNext, we calculate the apparent $\\mathrm{p}K_{a}$:\n$$\\mathrm{p}K_{a,\\mathrm{app}} = -\\log_{10}(a_{H}^{\\ast}) = -\\log_{10}(10^{-6.25}) = 6.25$$\nThe problem requires this value to be rounded to $4$ significant figures, so we write it as $6.250$.\n\nThe final results are $a_{H}^{\\ast} = 5.623 \\times 10^{-7}$ and $\\mathrm{p}K_{a,\\mathrm{app}} = 6.250$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.623 \\times 10^{-7} & 6.250\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "This final practice translates theoretical principles into a tangible computational model for the histidine residue, one of the most versatile and complex titratable groups in proteins. The challenge  lies in correctly accounting for its four distinct chemical species: the cationic, anionic, and two neutral tautomeric states. By implementing a complete microstate enumeration from first principles, you will learn to calculate pH-dependent populations and build a foundational tool for predicting the behavior of complex titratable networks.",
            "id": "3860065",
            "problem": "A single histidine side chain embedded in a protein can populate multiple chemically distinct microstates due to both acid-base chemistry and tautomerization of the imidazole ring. The neutral imidazole exists as two tautomers that differ by the position of the bound proton on the ring nitrogens, and the cationic state has two bound protons on the ring. The potential of Hydrogen (pH) of the solution controls the thermodynamic weight of each microstate through the proton chemical potential, which couples to the number of bound protons. Your task is to derive, implement, and test a statistically rigorous microstate enumeration that includes histidine tautomerization and multiple protonation states without double counting, and then compute the titration behavior.\n\nBegin from the following foundational bases:\n- Statistical mechanics with the Boltzmann distribution: the probability of a microstate with energy $G$ is proportional to $\\exp(-\\beta G)$, where $\\beta = 1/(R T)$, $R$ is the gas constant, and $T$ is the absolute temperature.\n- Chemical potential of a species in solution: for the proton, $\\mu_{\\mathrm{H}^+} = \\mu_{\\mathrm{H}^+}^{\\circ} + R T \\ln a_{\\mathrm{H}^+}$, with activity $a_{\\mathrm{H}^+} \\approx 10^{-\\mathrm{pH}}$ in dilute solutions. Therefore, $\\mu_{\\mathrm{H}^+} = \\mu_{\\mathrm{H}^+}^{\\circ} - R T \\ln(10)\\,\\mathrm{pH}$.\n- The negative base-10 logarithm of the acid dissociation constant (pKa) defines characteristic pH values at which acid-base transitions are half-populated in simple two-state systems.\n\nDefine the histidine microstates as unique, chemically distinguishable species:\n- Anionic imidazolate ($A_0$) with $n=0$ bound protons on the ring.\n- Neutral tautomer with proton on N$_\\delta$ ($N_{1\\delta}$) with $n=1$ bound proton.\n- Neutral tautomer with proton on N$_\\epsilon$ ($N_{1\\epsilon}$) with $n=1$ bound proton.\n- Cationic imidazolium ($C_2$) with $n=2$ bound protons.\nAvoid double counting by enumerating each chemically distinct microstate once. In particular, do not introduce multiple $C_2$ microstates for distinct protonation pathways; $C_2$ is a single chemical species.\n\nLet each microstate $i$ have an intrinsic standard-state free energy $G_i^{\\mathrm{intr}}$ in $\\mathrm{kcal/mol}$ that captures environmental stabilization independent of pH, and let $n_i$ be the integer number of bound protons on the ring. The pH-dependent effective free energy should be treated as $G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} - n_i\\,\\mu_{\\mathrm{H}^+}(\\mathrm{pH})$, and the observable probabilities are computed from Boltzmann weights at temperature $T$.\n\nImplement a program that:\n1. Enumerates the four microstates $\\{A_0, N_{1\\delta}, N_{1\\epsilon}, C_2\\}$ exactly once, with their $n_i$ values $\\{0,1,1,2\\}$ respectively, and computes their Boltzmann probabilities at a specified pH using $G_i(\\mathrm{pH})$ and $\\beta = 1/(R T)$.\n2. Computes the fraction of the cationic microstate $f_{C_2}(\\mathrm{pH})$ as the Boltzmann probability of $C_2$ divided by the partition function that sums over all four microstates.\n3. Uses the gas constant $R = 0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$, the temperature $T = 298.15$ $\\mathrm{K}$, and energies in $\\mathrm{kcal/mol}$.\n4. Accepts three distinct parameter sets (the test suite below), each specifying $G_{N_{1\\delta}}^{\\mathrm{intr}}$ by definition as $0$ $\\mathrm{kcal/mol}$, a tautomer energy offset $\\Delta_{\\mathrm{taut}}$ that sets $G_{N_{1\\epsilon}}^{\\mathrm{intr}} = \\Delta_{\\mathrm{taut}}$, a cation intrinsic energy $G_{C_2}^{\\mathrm{intr}}$, and an anion intrinsic energy $G_{A_0}^{\\mathrm{intr}}$. The cation and anion intrinsic energies are chosen to reflect target macroscopic transitions in the absence of tautomer imbalance. Specifically, for reference neutral energy $G_{N_{1\\delta}}^{\\mathrm{intr}} = 0$, use $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{cat}}$ to center the neutral-to-cation transition near $\\mathrm{p}K_{a}^{\\mathrm{cat}}$, and $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{ani}}$ to center the neutral-to-anion transition near $\\mathrm{p}K_{a}^{\\mathrm{ani}}$. These choices ensure scientific realism but still require proper microstate enumeration and Boltzmann statistics to obtain the correct titration behavior when $\\Delta_{\\mathrm{taut}} \\neq 0$.\n\nUse the following test suite of parameter sets and pH values:\n- Test Case 1 (symmetry of neutral tautomers): $\\Delta_{\\mathrm{taut}} = 0.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 14.0$. Set $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10)\\cdot 6.0$, $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10)\\cdot 14.0$.\n- Test Case 2 (environment stabilizes one tautomer): $\\Delta_{\\mathrm{taut}} = -2.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 14.0$. Set $G_{C_2}^{\\mathrm{intr}}$ and $G_{A_0}^{\\mathrm{intr}}$ as in Test Case 1.\n- Test Case 3 (anion transition shifted closer): $\\Delta_{\\mathrm{taut}} = 0.0$ $\\mathrm{kcal/mol}$, $\\mathrm{p}K_{a}^{\\mathrm{cat}} = 6.0$, $\\mathrm{p}K_{a}^{\\mathrm{ani}} = 12.0$. Set $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10)\\cdot 6.0$, $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10)\\cdot 12.0$.\n\nCompute $f_{C_2}(\\mathrm{pH})$ at the pH values $\\mathrm{pH} \\in \\{4.0, 6.0, 8.0\\}$ for each test case. Express all energies in $\\mathrm{kcal/mol}$ and temperature in $\\mathrm{K}$. The final program output must be a single line containing the results as a comma-separated list enclosed in square brackets, ordered as:\n$[f_{C_2}^{\\text{TC1}}(4.0), f_{C_2}^{\\text{TC1}}(6.0), f_{C_2}^{\\text{TC1}}(8.0), f_{C_2}^{\\text{TC2}}(4.0), f_{C_2}^{\\text{TC2}}(6.0), f_{C_2}^{\\text{TC2}}(8.0), f_{C_2}^{\\text{TC3}}(4.0), f_{C_2}^{\\text{TC3}}(6.0), f_{C_2}^{\\text{TC3}}(8.0)]$.\n\nYour implementation must be self-contained, general, and avoid double counting by enumerating each microstate exactly once and summing its Boltzmann weight in the partition function. No additional user input or files are permitted.",
            "solution": "The problem has been validated and is determined to be a well-posed, scientifically grounded problem in computational chemical biology. The following solution provides a detailed derivation and plan for implementation.\n\n### Theoretical Framework\n\nThe objective is to compute the fractional population of the cationic microstate of a histidine side chain, denoted as $f_{C_2}(\\mathrm{pH})$, as a function of the solution's potential of Hydrogen, $\\mathrm{pH}$. The model considers four distinct chemical microstates: an anionic form ($A_0$), two neutral tautomers ($N_{1\\delta}$ and $N_{1\\epsilon}$), and a cationic form ($C_2$).\n\nFirst, we enumerate the microstates and their corresponding number of bound protons, $n_i$:\n-   Anionic imidazolate, $A_0$, with $n_{A_0} = 0$ protons.\n-   Neutral tautomer, $N_{1\\delta}$, with the proton on the $\\delta$-nitrogen, $n_{N_{1\\delta}} = 1$. This is our reference state.\n-   Neutral tautomer, $N_{1\\epsilon}$, with the proton on the $\\epsilon$-nitrogen, $n_{N_{1\\epsilon}} = 1$.\n-   Cationic imidazolium, $C_2$, with $n_{C_2} = 2$ protons.\n\nThe probability of observing a microstate $i$ is given by the Boltzmann distribution, where the probability $P_i$ is proportional to its Boltzmann weight $w_i = \\exp(-\\beta G_i)$, with $\\beta = 1/(RT)$. $R$ is the gas constant ($0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$) and $T$ is the temperature ($298.15$ $\\mathrm{K}$).\n\nThe free energy of each microstate, $G_i$, is dependent on $\\mathrm{pH}$ due to the exchange of protons with the solution. The problem specifies the pH-dependent effective free energy as $G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} - n_i\\,\\mu_{\\mathrm{H}^+}(\\mathrm{pH})$, where $G_i^{\\mathrm{intr}}$ is the intrinsic standard-state free energy and $\\mu_{\\mathrm{H}^+}(\\mathrm{pH}) = \\mu_{\\mathrm{H}^+}^{\\circ} - R T \\ln(10)\\,\\mathrm{pH}$ is the chemical potential of the proton. This formulation introduces a dependency on the standard chemical potential, $\\mu_{\\mathrm{H}^+}^{\\circ}$. However, the definition of intrinsic energies in terms of $\\mathrm{p}K_a$ values implies that the standard chemical potential terms are already incorporated. A standard, equivalent formulation for the pH-dependent free energy, consistent with the problem's definitions, is:\n$$G_i(\\mathrm{pH}) = G_i^{\\mathrm{intr}} + n_i R T \\ln(10) \\cdot \\mathrm{pH}$$\nHere, $G_i^{\\mathrm{intr}}$ represents the standard free energy of the microstate at a reference pH of $0$. We will proceed with this physically consistent formulation.\n\nThe intrinsic free energies for each microstate are defined relative to the $N_{1\\delta}$ tautomer:\n-   $G_{N_{1\\delta}}^{\\mathrm{intr}} = 0$ $\\mathrm{kcal/mol}$ (by definition of the reference state).\n-   $G_{N_{1\\epsilon}}^{\\mathrm{intr}} = \\Delta_{\\mathrm{taut}}$.\n-   $G_{C_2}^{\\mathrm{intr}} = - R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{cat}}$. This corresponds to the standard free energy change for the reaction $N_{1\\delta} + \\mathrm{H}^+ \\rightarrow C_2$.\n-   $G_{A_0}^{\\mathrm{intr}} = + R T \\ln(10) \\cdot \\mathrm{p}K_{a}^{\\mathrm{ani}}$. This corresponds to the standard free energy change for the reaction $N_{1\\delta} \\rightarrow A_0 + \\mathrm{H}^+$.\n\n### Partition Function and State Probabilities\n\nThe Boltzmann weight $w_i(\\mathrm{pH})$ for each microstate $i$ is calculated as:\n$$w_i(\\mathrm{pH}) = \\exp(-\\beta G_i(\\mathrm{pH})) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}} + n_i R T \\ln(10) \\cdot \\mathrm{pH}}{RT}\\right)$$\nThis simplifies to:\n$$w_i(\\mathrm{pH}) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}}}{RT}\\right) \\exp(-n_i \\ln(10) \\cdot \\mathrm{pH}) = \\exp\\left(-\\frac{G_i^{\\mathrm{intr}}}{RT}\\right) 10^{-n_i \\cdot \\mathrm{pH}}$$\n\nApplying this to each of the four microstates:\n-   $w_{A_0}(\\mathrm{pH}) = \\exp\\left(-\\frac{+RT\\ln(10)\\mathrm{p}K_a^{\\mathrm{ani}}}{RT}\\right) \\cdot 10^{-0 \\cdot \\mathrm{pH}} = 10^{-\\mathrm{p}K_a^{\\mathrm{ani}}}$\n-   $w_{N_{1\\delta}}(\\mathrm{pH}) = \\exp\\left(-\\frac{0}{RT}\\right) \\cdot 10^{-1 \\cdot \\mathrm{pH}} = 10^{-\\mathrm{pH}}$\n-   $w_{N_{1\\epsilon}}(\\mathrm{pH}) = \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right) \\cdot 10^{-1 \\cdot \\mathrm{pH}}$\n-   $w_{C_2}(\\mathrm{pH}) = \\exp\\left(-\\frac{-RT\\ln(10)\\mathrm{p}K_a^{\\mathrm{cat}}}{RT}\\right) \\cdot 10^{-2 \\cdot \\mathrm{pH}} = 10^{\\mathrm{p}K_a^{\\mathrm{cat}}} \\cdot 10^{-2 \\cdot \\mathrm{pH}} = 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}$\n\nThe partition function, $Z(\\mathrm{pH})$, is the sum of the Boltzmann weights of all possible microstates:\n$$Z(\\mathrm{pH}) = w_{A_0}(\\mathrm{pH}) + w_{N_{1\\delta}}(\\mathrm{pH}) + w_{N_{1\\epsilon}}(\\mathrm{pH}) + w_{C_2}(\\mathrm{pH})$$\n$$Z(\\mathrm{pH}) = 10^{-\\mathrm{p}K_a^{\\mathrm{ani}}} + \\left(1 + \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right)\\right)10^{-\\mathrm{pH}} + 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}$$\n\nThe fractional population of the cationic state, $f_{C_2}(\\mathrm{pH})$, is the ratio of its Boltzmann weight to the partition function:\n$$f_{C_2}(\\mathrm{pH}) = \\frac{w_{C_2}(\\mathrm{pH})}{Z(\\mathrm{pH})} = \\frac{10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}}{10^{-\\mathrm{p}K_a^{\\mathrm{ani}}} + \\left(1 + \\exp\\left(-\\frac{\\Delta_{\\mathrm{taut}}}{RT}\\right)\\right)10^{-\\mathrm{pH}} + 10^{\\mathrm{p}K_a^{\\mathrm{cat}} - 2 \\cdot \\mathrm{pH}}}$$\n\n### Algorithmic Implementation\n\nThe algorithm to solve the problem is as follows:\n1.  Define the constants $R = 0.0019872041$ $\\mathrm{kcal/(mol\\cdot K)}$ and $T=298.15$ $\\mathrm{K}$. Pre-calculate the product $RT$.\n2.  Define the three test cases, each with specific values for $\\Delta_{\\mathrm{taut}}$, $\\mathrm{p}K_a^{\\mathrm{cat}}$, and $\\mathrm{p}K_a^{\\mathrm{ani}}$.\n3.  Define the list of pH values to be tested: $\\{4.0, 6.0, 8.0\\}$.\n4.  Iterate through each test case and, for each case, iterate through the list of pH values.\n5.  In each iteration, calculate the individual Boltzmann weights for the four microstates ($w_{A_0}$, $w_{N_{1\\delta}}$, $w_{N_{1\\epsilon}}$, $w_{C_2}$) using the formulas derived above.\n6.  Sum the weights to compute the partition function $Z(\\mathrm{pH})$.\n7.  Calculate the fractional population $f_{C_2}(\\mathrm{pH}) = w_{C_2}(\\mathrm{pH})/Z(\\mathrm{pH})$.\n8.  Collect all nine results in a single list, ordered as specified in the problem statement.\n9.  Format the list into the final output string.\n\nThis procedure ensures that each microstate is enumerated exactly once, respecting the problem's constraint against double counting, and that the calculation is performed according to the principles of statistical mechanics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the histidine titration problem by calculating the fractional population\n    of the cationic state for different parameter sets and pH values.\n    \"\"\"\n    \n    # Define physical constants\n    R = 0.0019872041  # gas constant in kcal/(mol·K)\n    T = 298.15        # temperature in K\n    RT = R * T        # Product RT in kcal/mol\n\n    # Define the test suite of parameter sets\n    # Each tuple is (delta_taut [kcal/mol], pKa_cat, pKa_ani)\n    test_cases = [\n        (0.0, 6.0, 14.0),   # Test Case 1\n        (-2.0, 6.0, 14.0),  # Test Case 2\n        (0.0, 6.0, 12.0),   # Test Case 3\n    ]\n    \n    # pH values to test for each case\n    ph_values = [4.0, 6.0, 8.0]\n    \n    results = []\n\n    for delta_taut, pka_cat, pka_ani in test_cases:\n        for ph in ph_values:\n            # Calculate the Boltzmann weights for each of the four microstates.\n            # The derivation in the solution text simplifies the weight expressions\n            # to be based on powers of 10.\n            \n            # Weight of the anionic state (A0, n=0)\n            # w_A0 = exp(-G_A0_intr / RT) * 10**(-0 * pH)\n            # G_A0_intr = RT * ln(10) * pKa_ani\n            # w_A0 = exp(-RT * ln(10) * pKa_ani / RT) = exp(-ln(10)*pKa_ani) = 10**(-pKa_ani)\n            w_a0 = 10**(-pka_ani)\n            \n            # Weights of the neutral tautomers (N1d and N1e, n=1)\n            # w_n1d = exp(-G_n1d_intr / RT) * 10**(-1 * pH)\n            # G_n1d_intr = 0 (reference)\n            w_n1d = 1.0 * (10**(-ph))\n            \n            # w_n1e = exp(-G_n1e_intr / RT) * 10**(-1 * pH)\n            # G_n1e_intr = delta_taut\n            w_n1e = np.exp(-delta_taut / RT) * (10**(-ph))\n            \n            # Weight of the cationic state (C2, n=2)\n            # w_c2 = exp(-G_c2_intr / RT) * 10**(-2 * pH)\n            # G_c2_intr = -RT * ln(10) * pKa_cat\n            # w_c2 = exp(RT * ln(10) * pKa_cat / RT) * 10**(-2*pH) = 10**pKa_cat * 10**(-2*pH)\n            w_c2 = 10**(pka_cat - 2 * ph)\n            \n            # The partition function is the sum of all weights\n            partition_function = w_a0 + w_n1d + w_n1e + w_c2\n            \n            # The fractional population of the cationic state is its weight divided by the partition function\n            f_c2 = w_c2 / partition_function\n            \n            results.append(f_c2)\n\n    # Format the final output string exactly as required.\n    # The default string conversion for floats provides sufficient precision.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}