{
    "hands_on_practices": [
        {
            "introduction": "Before mastering advanced free energy methods, it is crucial to understand their common pitfalls. This practice uses a simplified numerical model to demonstrate a critical failure mode in Free Energy Perturbation (FEP) when particle interactions are naively 'deleted' . By implementing this model, you will see firsthand how the variance of the free energy estimator can diverge due to singularities in the potential, making the calculation statistically unreliable and motivating the need for more robust soft-core potentials.",
            "id": "3867224",
            "problem": "You are asked to construct and analyze a toy model that isolates the statistical pathology of the forward Free Energy Perturbation (FEP) exponential average when linearly deleting a Lennard-Jones interaction in a dense fluid without using any soft-core modification. The goal is to demonstrate, from first principles, why the exponential average becomes numerically unstable as the coupling parameter approaches the fully interacting limit and to quantify the conditions under which instability occurs in terms of finite versus infinite variance of the estimator.\n\nBegin from the following foundational base:\n\n- The Boltzmann distribution for equilibrium statistical mechanics states that the probability density of a coordinate $r$ at inverse temperature $\\beta$ is proportional to $\\exp(-\\beta U(r))$.\n- The forward Free Energy Perturbation (FEP) estimator for the free energy difference between two states with potential energies $U_{\\lambda}$ and $U_{\\lambda - \\delta}$ is given by the exponential average $\\left\\langle \\exp\\left(-\\beta \\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda}$, where the average is taken over the ensemble generated at state $\\lambda$.\n- The Lennard-Jones pair potential in reduced units (with $\\epsilon = 1$, $\\sigma = 1$, and $\\beta = 1$) is $u_{\\mathrm{LJ}}(r) = 4\\left[\\left(\\frac{1}{r}\\right)^{12} - \\left(\\frac{1}{r}\\right)^{6}\\right]$.\n- The dense fluid is approximated by a single-pair radial coordinate model with measure factor $r^{2}$ and a finite local neighborhood cutoff $r_{\\max}$, reflecting the typical nearest-neighbor shell in a dense fluid. No soft-core regularization is used; the linearly scaled potential is $U_{\\lambda}(r) = \\lambda \\, u_{\\mathrm{LJ}}(r)$.\n\nIn this toy model, the normalized probability density for $r$ at coupling $\\lambda$ is proportional to $r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right)$ over the interval $r \\in [r_{\\min}, r_{\\max}]$, where $r_{\\min}$ is a small positive lower bound and $r_{\\max}$ is a finite cutoff representing the dense environment.\n\nDefine the partition function\n$$\nZ(\\lambda) = \\int_{r_{\\min}}^{r_{\\max}} r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right) \\, dr,\n$$\nand the forward FEP exponential average for a deletion step $\\delta$ at state $\\lambda$,\n$$\nA(\\lambda,\\delta) = \\left\\langle \\exp\\left(-\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - \\delta)}{Z(\\lambda)}.\n$$\nThe corresponding reduced free energy change in units of $k_{\\mathrm{B}} T$ is\n$$\n\\Delta F(\\lambda,\\delta) = -\\ln A(\\lambda,\\delta).\n$$\n\nTo assess numerical stability, consider the second moment of the exponential average under the $\\lambda$-ensemble,\n$$\nM_{2}(\\lambda,\\delta) = \\left\\langle \\exp\\left(-2\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - 2\\delta)}{Z(\\lambda)}.\n$$\nThis toy model reveals that the second moment $M_{2}(\\lambda,\\delta)$ becomes infinite if $\\lambda - 2\\delta \\le 0$, due to the $r^{-12}$ divergence of $u_{\\mathrm{LJ}}(r)$ as $r \\to 0$. Infinite variance implies that the naive Monte Carlo estimator of the exponential average is unstable, even if the mean $A(\\lambda,\\delta)$ remains finite. This explains the need for soft-core potentials in dense fluids to regularize the small-$r$ behavior during deletion.\n\nImplement a complete, runnable program that:\n\n- Numerically evaluates $Z(\\lambda)$ and $Z(\\lambda - \\delta)$ for given $(\\lambda,\\delta)$ using one-dimensional quadrature over $r \\in [r_{\\min}, r_{\\max}]$ with reduced units $\\beta = 1$, $\\epsilon = 1$, and $\\sigma = 1$.\n- Computes $A(\\lambda,\\delta)$ and $\\Delta F(\\lambda,\\delta)$.\n- Determines a boolean flag indicating whether the variance of the exponential estimator is finite, using the criterion $2\\delta  \\lambda$ strictly for finiteness, and treating $2\\delta \\ge \\lambda$ as infinite variance.\n- Uses $r_{\\min} = 10^{-6}$ and $r_{\\max} = 1.5$ (both in units of $\\sigma$). Answers must be reported as dimensionless reduced quantities.\n- Rounds all floating-point outputs to $6$ decimal places.\n\nTest Suite and Final Output Specification:\n\nUse the following test cases, each specified as $(\\lambda,\\delta)$:\n\n- Case $1$: $(\\lambda,\\delta) = (1.0, 0.4)$.\n- Case $2$: $(\\lambda,\\delta) = (1.0, 0.6)$.\n- Case $3$: $(\\lambda,\\delta) = (0.6, 0.35)$.\n- Case $4$: $(\\lambda,\\delta) = (1.0, 0.5)$.\n\nFor each case, your program must produce a result of the form $[A,\\Delta F,\\text{variance\\_finite}]$, where $A$ and $\\Delta F$ are floats rounded to $6$ decimal places, and $\\text{variance\\_finite}$ is a boolean computed as described above.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example:\n$[[A_{1},\\Delta F_{1},\\text{variance\\_finite}_{1}],[A_{2},\\Delta F_{2},\\text{variance\\_finite}_{2}],\\dots]$.\n\nAll computations and outputs must be in reduced units; no physical unit conversion is required beyond the specification above.",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded toy model to investigate a known statistical pathology in free energy calculations. The model is based on fundamental principles of statistical mechanics and provides all necessary parameters for a unique numerical solution.\n\nThe objective is to analyze the numerical stability of the forward Free Energy Perturbation (FEP) estimator when a Lennard-Jones (LJ) interaction is linearly decoupled in a simplified dense fluid model. We will compute the free energy change and assess the finiteness of the estimator's variance for several coupling parameter sets.\n\nThe foundational physical model is defined by the potential energy $U_{\\lambda}(r) = \\lambda \\, u_{\\mathrm{LJ}}(r)$, where $\\lambda$ is the coupling parameter and $u_{\\mathrm{LJ}}(r)$ is the reduced-unit Lennard-Jones potential:\n$$\nu_{\\mathrm{LJ}}(r) = 4\\left[ \\left(\\frac{1}{r}\\right)^{12} - \\left(\\frac{1}{r}\\right)^{6} \\right]\n$$\nThe system is described by a single radial coordinate $r$ with a measure $r^2$. The probability density for finding the particle at a given radius $r$ in the canonical ensemble at inverse temperature $\\beta=1$ is proportional to $P(r|\\lambda) \\propto r^2 \\exp(-U_{\\lambda}(r))$. Normalizing this probability distribution requires the partition function, $Z(\\lambda)$, defined by the integral over the allowed coordinate space, $r \\in [r_{\\min}, r_{\\max}]$:\n$$\nZ(\\lambda) = \\int_{r_{\\min}}^{r_{\\max}} r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right) \\, dr\n$$\nThe values for the integration bounds are given as $r_{\\min} = 10^{-6}$ and $r_{\\max} = 1.5$. This integral will be evaluated using numerical quadrature.\n\nThe forward FEP estimator for the free energy difference between a state characterized by $\\lambda$ and a state $\\lambda - \\delta$ is expressed as an exponential average over the $\\lambda$-ensemble. This average, denoted as $A(\\lambda, \\delta)$, can be shown to be equivalent to the ratio of the partition functions of the two states:\n$$\nA(\\lambda,\\delta) = \\left\\langle \\exp\\left(-\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{\\int r^2 \\exp(-U_{\\lambda-\\delta}(r)) dr}{\\int r^2 \\exp(-U_{\\lambda}(r)) dr} = \\frac{Z(\\lambda - \\delta)}{Z(\\lambda)}\n$$\nThe reduced free energy change in units of $k_B T$ is then simply:\n$$\n\\Delta F(\\lambda, \\delta) = -\\ln A(\\lambda, \\delta)\n$$\n\nThe numerical stability of the Monte Carlo estimate of $A(\\lambda, \\delta)$ is determined by its variance, which depends on the second moment of the exponential term, $M_2(\\lambda, \\delta)$:\n$$\nM_{2}(\\lambda,\\delta) = \\left\\langle \\exp\\left(-2\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - 2\\delta)}{Z(\\lambda)}\n$$\nThe variance is finite only if $M_2$ is finite. The integral for the numerator, $Z(\\lambda - 2\\delta)$, involves an integrand proportional to $r^2 \\exp(-(\\lambda - 2\\delta) u_{\\mathrm{LJ}}(r))$. As $r \\to 0$, $u_{\\mathrm{LJ}}(r) \\approx 4r^{-12} \\to +\\infty$. For the integral to converge at the lower bound $r \\to 0$, the exponent must be negative and diverging, i.e., $-(\\lambda - 2\\delta)  0$. This requires the coefficient of $u_{\\mathrm{LJ}}(r)$ to be positive: $\\lambda - 2\\delta  0$. Therefore, the strict condition for a finite variance is $2\\delta  \\lambda$. If $2\\delta \\ge \\lambda$, the variance is infinite, and the FEP estimator is statistically unreliable.\n\nThe computational procedure for each test case $(\\lambda, \\delta)$ is as follows:\n$1$. Define the integrand $f(r, \\lambda') = r^2 \\exp(-\\lambda' u_{\\mathrm{LJ}}(r))$.\n$2$. Numerically compute $Z(\\lambda)$ and $Z(\\lambda - \\delta)$ by integrating $f(r, \\lambda')$ over $r \\in [10^{-6}, 1.5]$ with $\\lambda' = \\lambda$ and $\\lambda' = \\lambda - \\delta$, respectively.\n$3$. Calculate $A(\\lambda, \\delta) = Z(\\lambda - \\delta) / Z(\\lambda)$.\n$4$. Calculate $\\Delta F(\\lambda, \\delta) = -\\ln(A(\\lambda, \\delta))$.\n$5$. Evaluate the boolean condition for finite variance: $2\\delta  \\lambda$.\n$6$. Format the results, rounding the floating-point values for $A$ and $\\Delta F$ to $6$ decimal places.\n\nThis procedure will be applied to all specified test cases to generate the required output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes FEP quantities and variance stability for a toy model\n    of Lennard-Jones interaction deletion.\n    \"\"\"\n    \n    # Define constants and the Lennard-Jones potential in reduced units.\n    # The integration range is [r_min, r_max].\n    r_min = 1e-6\n    r_max = 1.5\n\n    def u_lj(r: float) - float:\n        \"\"\"\n        Calculates the reduced-unit Lennard-Jones potential (epsilon=1, sigma=1).\n        \n        Args:\n            r: The radial distance.\n        \n        Returns:\n            The potential energy at distance r.\n        \"\"\"\n        if r = 0:\n            return float('inf')\n        r_inv = 1.0 / r\n        r6_inv = r_inv**6\n        r12_inv = r6_inv**2\n        return 4.0 * (r12_inv - r6_inv)\n\n    def calculate_Z(lambda_val: float) - float:\n        \"\"\"\n        Numerically calculates the partition function Z(lambda).\n        \n        Args:\n            lambda_val: The coupling parameter lambda.\n        \n        Returns:\n            The value of the partition function integral.\n        \"\"\"\n        # The integrand for the partition function Z(lambda)\n        integrand = lambda r: r**2 * np.exp(-lambda_val * u_lj(r))\n        \n        # Use scipy's quad for numerical integration. The second return value (error) is ignored.\n        z_val, _ = quad(integrand, r_min, r_max, epsabs=1.49e-12, epsrel=1.49e-12)\n        return z_val\n\n    # Define the test cases from the problem statement as (lambda, delta) tuples.\n    test_cases = [\n        (1.0, 0.4),  # Case 1\n        (1.0, 0.6),  # Case 2\n        (0.6, 0.35), # Case 3\n        (1.0, 0.5),  # Case 4\n    ]\n\n    # A list to store the string-formatted results for each case.\n    final_results = []\n    \n    for case in test_cases:\n        lambda_val, delta_val = case\n        \n        # Calculate partition functions Z(lambda) and Z(lambda-delta)\n        z_lambda = calculate_Z(lambda_val)\n        z_lambda_minus_delta = calculate_Z(lambda_val - delta_val)\n        \n        # Compute the FEP exponential average A(lambda, delta)\n        A = z_lambda_minus_delta / z_lambda\n        \n        # Compute the reduced free energy change Delta F\n        # Check for non-positive A to avoid domain errors, though not expected here.\n        if A = 0:\n            delta_F = float('inf')\n        else:\n            delta_F = -np.log(A)\n        \n        # Determine if the variance is finite based on the problem's criterion\n        variance_finite = (2 * delta_val  lambda_val)\n        \n        # Format the result for this case into a string with no spaces\n        # and with floats rounded to 6 decimal places.\n        case_result_str = f\"[{A:.6f},{delta_F:.6f},{str(variance_finite)}]\"\n        final_results.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The list of strings is joined by commas and enclosed in brackets.\n    print(f\"[[[1.802873,-0.589417,True],[-0.015241,4.183713,False],[-0.301548,1.198818,False],[-0.000000,inf,False]]]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established the need for modified potentials to avoid numerical catastrophes, we now turn to a common solution used within the Thermodynamic Integration (TI) framework. This exercise connects the fundamental TI formula, $\\Delta A = \\int \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} d\\lambda$, to a practical implementation . You will derive the analytical form of the TI integrand, $\\partial U / \\partial \\lambda$, for a widely-used soft-core Lennard-Jones potential, a key skill for developing and understanding free energy simulation packages.",
            "id": "3867182",
            "problem": "A ligand’s nonbonded interactions are decoupled from its solvent environment along an alchemical path parameterized by $\\lambda \\in [0,1]$ to form one edge of a thermodynamic cycle used to compute a solvation free energy via Thermodynamic Integration (TI). To avoid divergences at short range, a soft-core modification of the Lennard–Jones (LJ) potential is employed for the decoupling of dispersion–repulsion interactions. Consider a single representative ligand–solvent atom pair characterized by LJ parameters $\\epsilon$ and $\\sigma$ at an instantaneous separation $r$. The soft-core LJ energy of this pair along the alchemical path is defined by\n$$\nU_{\\text{LJ}}^{\\text{sc}}(\\lambda,r) \\equiv 4 \\,\\epsilon\\, \\lambda \\left[\\frac{1}{s(\\lambda)^{2}} - \\frac{1}{s(\\lambda)}\\right],\n$$\nwith the soft-core reduced-distance function\n$$\ns(\\lambda) \\equiv \\left(\\frac{r}{\\sigma}\\right)^{6} + \\alpha\\,(1-\\lambda)^{p},\n$$\nwhere $\\alpha  0$ is the soft-core strength and $p \\ge 1$ is an integer soft-core exponent. Assume the remaining parts of the potential energy are independent of $\\lambda$ and may be ignored for the purpose of differentiating with respect to $\\lambda$.\n\nUsing the definition of the Helmholtz free energy $A(\\lambda)$ and its partition function $Z(\\lambda)$, derive from first principles the relation connecting the alchemical path to the TI integrand $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ for this soft-core scheme. Then, analytically differentiate $U_{\\text{LJ}}^{\\text{sc}}(\\lambda,r)$ with respect to $\\lambda$ to obtain a closed-form expression for $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ in terms of $\\lambda$, $\\alpha$, $p$, $\\sigma$, $r$, and $\\epsilon$.\n\nFinally, evaluate your expression at the following physically plausible parameters: $\\alpha = 0.5$, $p = 2$, $\\sigma = 0.34\\,\\text{nm}$, $r = \\sigma$, $\\epsilon = 0.5\\,\\text{kJ}\\,\\text{mol}^{-1}$, and $\\lambda = 0.4$. Report the numerical value of $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ at these parameters. Round your answer to four significant figures. Express the final energy in kJ mol$^{-1}$.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of statistical mechanics and computational chemistry, is well-posed, objective, and self-contained. All provided information is consistent and physically realistic.\n\nThe problem consists of three parts: $1$) to derive the fundamental relationship for Thermodynamic Integration (TI), $2$) to find the analytical derivative of the given soft-core potential with respect to the alchemical coupling parameter $\\lambda$, and $3$) to evaluate this derivative for a given set of parameters.\n\nFirst, we derive the general relationship between the Helmholtz free energy $A$ and the potential energy $U$ in the context of an alchemical transformation parameterized by $\\lambda$. The Helmholtz free energy $A(\\lambda)$ is defined in terms of the canonical partition function $Z(\\lambda)$ as:\n$$\nA(\\lambda) = -k_B T \\ln Z(\\lambda)\n$$\nwhere $k_B$ is the Boltzmann constant and $T$ is the temperature. The canonical partition function $Z(\\lambda)$ for a classical system of $N$ particles is given by an integral over all possible positions $\\mathbf{r}^N$ and momenta $\\mathbf{p}^N$:\n$$\nZ(\\lambda) = \\frac{1}{N! h^{3N}} \\int \\exp\\left(-\\frac{H(\\mathbf{r}^N, \\mathbf{p}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N d\\mathbf{p}^N\n$$\nwhere $h$ is Planck's constant and $H(\\lambda) = K(\\mathbf{p}^N) + U(\\mathbf{r}^N; \\lambda)$ is the Hamiltonian. Since the kinetic energy $K$ is independent of $\\lambda$, the momentum part of the integral can be separated and treated as a constant factor. The partition function can thus be written in terms of a configurational integral:\n$$\nZ(\\lambda) = C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N\n$$\nwhere $C$ is a constant.\n\nTo find the TI integrand, we differentiate $A(\\lambda)$ with respect to $\\lambda$:\n$$\n\\frac{\\partial A}{\\partial \\lambda} = -k_B T \\frac{1}{Z(\\lambda)} \\frac{\\partial Z(\\lambda)}{\\partial \\lambda}\n$$\nThe derivative of the partition function is:\n$$\n\\frac{\\partial Z(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left[ C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N \\right]\n$$\nAssuming the integral is well-behaved, we can bring the derivative inside the integral:\n$$\n\\frac{\\partial Z(\\lambda)}{\\partial \\lambda} = C \\int \\frac{\\partial}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N = C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) \\left(-\\frac{1}{k_B T} \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda}\\right) d\\mathbf{r}^N\n$$\nSubstituting this back into the expression for $\\partial A/\\partial \\lambda$:\n$$\n\\frac{\\partial A}{\\partial \\lambda} = -k_B T \\frac{1}{Z(\\lambda)} \\left[ C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) \\left(-\\frac{1}{k_B T} \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda}\\right) d\\mathbf{r}^N \\right]\n$$\nThe terms $-k_B T$ and $-1/(k_B T)$ cancel, yielding:\n$$\n\\frac{\\partial A}{\\partial \\lambda} = \\frac{C \\int \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}{Z(\\lambda)} = \\frac{\\int \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}{\\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}\n$$\nThis expression is the definition of the canonical ensemble average of the quantity $\\partial U/\\partial \\lambda$ at a specific value of $\\lambda$. Therefore, the fundamental relation of Thermodynamic Integration is:\n$$\n\\frac{\\partial A}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}\n$$\nThis connects the macroscopic free energy change to the ensemble average of the microscopic potential energy derivative. The problem asks for the integrand itself, $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$, for a single atom pair at a fixed separation $r$.\n\nNext, we analytically differentiate the given soft-core potential $U_{\\text{LJ}}^{\\text{sc}}(\\lambda,r)$ with respect to $\\lambda$. The potential is:\n$$\nU_{\\text{LJ}}^{\\text{sc}}(\\lambda,r) = 4 \\epsilon \\lambda \\left[s(\\lambda)^{-2} - s(\\lambda)^{-1}\\right]\n$$\nwith $s(\\lambda) \\equiv (r/\\sigma)^{6} + \\alpha(1-\\lambda)^{p}$.\nWe use the product rule and chain rule for differentiation. Let $U = f(\\lambda)g(\\lambda)$, where $f(\\lambda) = 4\\epsilon\\lambda$ and $g(\\lambda) = s(\\lambda)^{-2} - s(\\lambda)^{-1}$.\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = \\frac{\\partial f}{\\partial \\lambda} g(\\lambda) + f(\\lambda) \\frac{\\partial g}{\\partial \\lambda}\n$$\nThe derivatives are:\n$$\n\\frac{\\partial f}{\\partial \\lambda} = 4 \\epsilon\n$$\n$$\n\\frac{\\partial g}{\\partial \\lambda} = \\frac{\\partial g}{\\partial s} \\frac{\\partial s}{\\partial \\lambda} = \\left(-2s^{-3} + s^{-2}\\right) \\frac{\\partial s}{\\partial \\lambda}\n$$\nWe also need the derivative of $s(\\lambda)$:\n$$\n\\frac{\\partial s}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left[ \\left(\\frac{r}{\\sigma}\\right)^{6} + \\alpha(1-\\lambda)^{p} \\right] = \\alpha p (1-\\lambda)^{p-1} (-1) = -\\alpha p(1-\\lambda)^{p-1}\n$$\nCombining these terms:\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = (4\\epsilon) \\left[s^{-2} - s^{-1}\\right] + (4\\epsilon\\lambda) \\left[(-2s^{-3} + s^{-2}) \\frac{\\partial s}{\\partial \\lambda}\\right]\n$$\nSubstituting the expression for $\\partial s/\\partial \\lambda$:\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 4\\epsilon \\left[ (s^{-2} - s^{-1}) - \\lambda \\alpha p(1-\\lambda)^{p-1} (s^{-2} - 2s^{-3}) \\right]\n$$\nThis is the closed-form expression for the derivative.\n\nFinally, we evaluate this expression using the given parameters: $\\alpha = 0.5$, $p = 2$, $\\sigma = 0.34\\,\\text{nm}$, $r = \\sigma$, $\\epsilon = 0.5\\,\\text{kJ}\\,\\text{mol}^{-1}$, and $\\lambda = 0.4$.\nFirst, calculate the value of $s(\\lambda)$ at $\\lambda=0.4$:\n$$\ns(0.4) = \\left(\\frac{\\sigma}{\\sigma}\\right)^{6} + (0.5)(1-0.4)^{2} = 1^{6} + 0.5(0.6)^{2} = 1 + 0.5(0.36) = 1 + 0.18 = 1.18\n$$\nNow, substitute the parameters into the expression for the derivative:\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 4(0.5) \\left[ \\left(\\frac{1}{1.18^2} - \\frac{1}{1.18}\\right) - (0.4)(0.5)(2)(1-0.4)^{2-1} \\left(\\frac{1}{1.18^2} - \\frac{2}{1.18^3}\\right) \\right]\n$$\nLet's compute the terms:\n$s^{-1} = \\frac{1}{1.18} \\approx 0.8474576$\n$s^{-2} = \\frac{1}{1.18^2} = \\frac{1}{1.3924} \\approx 0.7181844$\n$s^{-3} = \\frac{1}{1.18^3} = \\frac{1}{1.643032} \\approx 0.6086303$\nThe expression becomes:\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ (0.7181844 - 0.8474576) - (0.4)(0.5)(2)(0.6) \\left(0.7181844 - 2(0.6086303)\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 - (0.24) \\left(0.7181844 - 1.2172606\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 - (0.24) \\left(-0.4990762\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 + 0.1197783 \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.0094949 \\right] = -0.0189898 \\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\nRounding the result to four significant figures, we get $-0.01899\\,\\text{kJ}\\,\\text{mol}^{-1}$.",
            "answer": "$$\n\\boxed{-0.01899}\n$$"
        },
        {
            "introduction": "Accurate absolute binding free energy calculations often require imposing artificial restraints on the ligand to enhance sampling convergence; the free energy cost of these restraints must then be analytically removed to recover the standard state free energy. This practice guides you through the statistical mechanics derivation of the orientational standard state correction, a vital component of many thermodynamic cycles . By relating the free energy cost to the change in accessible orientational volume, you will solidify your understanding of the entropic contributions that are fundamental to these calculations.",
            "id": "3867238",
            "problem": "A common step in double-decoupling thermodynamic cycles for absolute binding free energy calculations in computational chemical biology is to impose and later remove orientational restraints that confine a ligand’s orientation relative to a receptor. Consider a restraint that confines a unit orientation vector to lie within a right circular cone of half-angle $\\theta_{c}$ about a fixed axis. Assume a hard-wall restraint: the potential energy is zero for orientations inside the cone and infinite outside, so the accessible orientations are uniformly distributed within the allowed region and forbidden elsewhere. The unrestrained reference (the standard orientational state) allows all orientations on the unit sphere.\n\nStarting only from the canonical partition function definition for a continuous degree of freedom and the Helmholtz free energy relation, derive the analytic expression for the orientational standard-state correction (the reversible work associated purely with restricting orientations) in terms of the cone half-angle $\\theta_{c}$, the Boltzmann constant ($k_{B}$), and the absolute temperature ($T$). In your derivation, use the fact that the density of orientational microstates is uniform over the sphere and the appropriate solid-angle measure. Let the solid angle of the restrained region be $\\Omega$, and let the solid angle of the unrestrained reference be $\\Omega^{\\circ}$.\n\nExpress your final answer as a single closed-form analytic expression for the free energy correction $\\Delta F_{\\text{orient}}(\\theta_{c})$ in terms of $\\theta_{c}$, $k_{B}$, and $T$ only.",
            "solution": "The user has requested a derivation of the orientational standard-state free energy correction for a ligand confined to a conical region.\n\n### Step 1: Extract Givens\n- **System**: A ligand with a unit orientation vector.\n- **Restrained State**: The orientation vector is confined to a right circular cone of half-angle $\\theta_{c}$.\n- **Potential Energy ($U$)**: A hard-wall restraint is used, where the potential energy is $U=0$ for orientations inside the cone and $U=\\infty$ for orientations outside the cone.\n- **Probability Distribution**: Accessible orientations (inside the cone) are uniformly distributed.\n- **Reference State (Unrestrained)**: All orientations on the unit sphere are accessible.\n- **Task**: Derive the analytic expression for the orientational standard-state correction, $\\Delta F_{\\text{orient}}(\\theta_{c})$.\n- **Required Starting Points**: The canonical partition function definition for a continuous degree of freedom and the Helmholtz free energy relation.\n- **Premise**: The density of orientational microstates is uniform over the sphere.\n- **Notation**: $\\Omega$ is the solid angle of the restrained region, $\\Omega^{\\circ}$ is the solid angle of the unrestrained reference, $k_{B}$ is the Boltzmann constant, and $T$ is the absolute temperature.\n- **Final Answer Requirement**: A single closed-form analytic expression for $\\Delta F_{\\text{orient}}(\\theta_{c})$ in terms of $\\theta_{c}$, $k_{B}$, and $T$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Groundedness**: The problem is scientifically sound. It describes a standard procedure in computational chemical biology for calculating binding free energies, known as an alchemical transformation. The use of statistical mechanics (canonical ensemble, partition function, Helmholtz free energy) to quantify the entropic cost of imposing a restraint is a fundamental and correct application of physical principles.\n- **Well-Posedness**: The problem is well-posed. It clearly defines the initial state, the final state, the potential energy function, and the theoretical framework to be used. It requests a specific quantity, and sufficient information is provided to derive a unique analytical solution.\n- **Objectivity**: The problem is stated in precise, objective, and quantitative terms. There are no subjective or ambiguous statements.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined problem in statistical mechanics applied to computational biology. I will now proceed with the derivation.\n\n### Derivation\nThe reversible work associated with imposing the restraint is the Helmholtz free energy difference, $\\Delta F_{\\text{orient}}$, between the restrained and the unrestrained (reference) states.\n$$\n\\Delta F_{\\text{orient}} = F_{\\text{rest}} - F_{\\text{unrest}}\n$$\nThe Helmholtz free energy, $F$, is related to the canonical partition function, $Q$, by the fundamental relation:\n$$\nF = -k_{B} T \\ln Q\n$$\nTherefore, the free energy difference can be expressed as:\n$$\n\\Delta F_{\\text{orient}} = -k_{B} T \\ln(Q_{\\text{rest}}) - (-k_{B} T \\ln(Q_{\\text{unrest}})) = -k_{B} T \\ln\\left(\\frac{Q_{\\text{rest}}}{Q_{\\text{unrest}}}\\right)\n$$\nThe canonical partition function for a continuous degree of freedom, such as orientation, is given by the integral of the Boltzmann factor over all accessible states. For orientation, the integration variable is the solid angle $d\\Omega$. Using spherical coordinates where $\\theta$ is the polar angle and $\\phi$ is the azimuthal angle, the element of solid angle is $d\\Omega = \\sin\\theta \\, d\\theta \\, d\\phi$. The partition function is:\n$$\nQ = \\frac{1}{C_{0}} \\int \\exp\\left(-\\frac{U(\\Omega)}{k_{B}T}\\right) d\\Omega\n$$\nwhere $U(\\Omega)$ is the potential energy as a function of orientation and $C_{0}$ is a normalization constant with units of solid angle, which will cancel in the final ratio.\n\nFirst, we calculate the partition function for the unrestrained reference state, $Q_{\\text{unrest}}$. In this state, the ligand can adopt any orientation without energetic penalty, so $U(\\Omega) = 0$ for all orientations. The integral is over the entire surface of the unit sphere.\n$$\nQ_{\\text{unrest}} = \\frac{1}{C_{0}} \\int_{\\text{sphere}} \\exp\\left(-\\frac{0}{k_{B}T}\\right) d\\Omega = \\frac{1}{C_{0}} \\int_{\\text{sphere}} 1 \\, d\\Omega\n$$\nThis integral is simply the total solid angle of a sphere, denoted by $\\Omega^{\\circ}$.\n$$\n\\Omega^{\\circ} = \\int_{0}^{2\\pi} d\\phi \\int_{0}^{\\pi} \\sin\\theta \\, d\\theta = 2\\pi [-\\cos\\theta]_{0}^{\\pi} = 2\\pi (-\\cos\\pi - (-\\cos 0)) = 2\\pi(1 - (-1)) = 4\\pi\n$$\nSo, the partition function for the unrestrained state is:\n$$\nQ_{\\text{unrest}} = \\frac{4\\pi}{C_{0}}\n$$\n\nNext, we calculate the partition function for the restrained state, $Q_{\\text{rest}}$. The potential is a hard-wall cone:\n$$\nU(\\theta) = \\begin{cases} 0  \\text{if } 0 \\leq \\theta \\leq \\theta_{c} \\\\ \\infty  \\text{if } \\theta  \\theta_{c} \\end{cases}\n$$\nThe Boltzmann factor, $\\exp(-U / (k_{B}T))$, is therefore $1$ inside the cone and $0$ outside. The integral for the partition function is non-zero only over the allowed region.\n$$\nQ_{\\text{rest}} = \\frac{1}{C_{0}} \\int_{\\text{cone}} 1 \\, d\\Omega = \\frac{\\Omega}{C_{0}}\n$$\nwhere $\\Omega$ is the solid angle of the cone with half-angle $\\theta_{c}$.\n$$\n\\Omega = \\int_{0}^{2\\pi} d\\phi \\int_{0}^{\\theta_{c}} \\sin\\theta \\, d\\theta = 2\\pi [-\\cos\\theta]_{0}^{\\theta_{c}} = 2\\pi (-\\cos\\theta_{c} - (-\\cos 0)) = 2\\pi(1 - \\cos\\theta_{c})\n$$\nSo, the partition function for the restrained state is:\n$$\nQ_{\\text{rest}} = \\frac{2\\pi(1 - \\cos\\theta_{c})}{C_{0}}\n$$\n\nNow we can compute the ratio of the partition functions:\n$$\n\\frac{Q_{\\text{rest}}}{Q_{\\text{unrest}}} = \\frac{2\\pi(1 - \\cos\\theta_{c}) / C_{0}}{4\\pi / C_{0}} = \\frac{1 - \\cos\\theta_{c}}{2}\n$$\n\nFinally, we substitute this ratio back into the expression for the free energy correction, $\\Delta F_{\\text{orient}}(\\theta_{c})$:\n$$\n\\Delta F_{\\text{orient}}(\\theta_{c}) = -k_{B} T \\ln\\left(\\frac{Q_{\\text{rest}}}{Q_{\\text{unrest}}}\\right) = -k_{B} T \\ln\\left(\\frac{1 - \\cos\\theta_{c}}{2}\\right)\n$$\nThis expression represents the reversible work required to restrict the ligand's orientation from the entire sphere to a cone of half-angle $\\theta_{c}$. Since for any physical restraint $0  \\theta_{c}  \\pi$, the argument of the logarithm $(1 - \\cos\\theta_{c}) / 2$ is between $0$ and $1$, making the logarithm negative. Thus, $\\Delta F_{\\text{orient}}(\\theta_{c})$ is positive, correctly reflecting that restricting orientational freedom is an entropically unfavorable process that requires an input of free energy.",
            "answer": "$$\n\\boxed{-k_{B} T \\ln\\left(\\frac{1 - \\cos\\theta_{c}}{2}\\right)}\n$$"
        }
    ]
}