{
    "hands_on_practices": [
        {
            "introduction": "计算生物物理学的一个核心目标是直接从底层的自由能形貌预测分子过程的动力学速率，例如配体解离。该练习将挑战你应用化学动力学的两个基石理论到一个一维的平均力势（PMF）上来实现这一目标 。通过使用过渡态理论（TST）和基于扩散的平均首通时间（MFPT）模型推导并比较解离速率 $k_{\\mathrm{off}}$，你将更深入地理解能垒高度和扩散效應如何共同决定驻留时间。",
            "id": "3837022",
            "problem": "一个配体通过单一主导反应坐标 $x$ 从蛋白质上解离，在该坐标上定义了平均力势 (PMF) $W(x)$。该动力学过程是过阻尼的，具有恒定的坐标扩散系数 $D$，并且可以由朗之万方程的斯莫鲁霍夫斯基极限很好地描述。假设在 $x=x_{a}$ 处有一个亚稳态的结合最小值，在 $x=x^{\\ddagger}$ 处有一个单一的势垒顶点，它将结合盆地与逃逸区分开。在最小值和势垒顶点附近，PMF 局部是二次的，曲率分别为 $W''(x_{a})0$ 和 $W''(x^{\\ddagger})0$，势垒高度为 $\\Delta W^{\\ddagger}=W(x^{\\ddagger})-W(x_{a})$。将结合盆地入口处的边界视为反射边界，将 $x^{\\ddagger}$ 处的势垒穿越视为吸收边界。\n\n从过阻尼扩散在 PMF 中的第一性原理以及平均首过时间 (MFPT) 的定义出发，使用适用于高势垒的适当渐近近似，推导解离速率 $k_{\\mathrm{off}}$ 关于 $D$、$W''(x_{a})$、$W''(x^{\\ddagger})$、温度 $T$ 和 $\\Delta W^{\\ddagger}$ 的表达式。然后，假设 PMF 势垒 $\\Delta W^{\\ddagger}$ 是活化自由能，写出使用标准艾林形式的过渡态理论 (TST) 对速率的预测。\n\n使用以下科学上合理的参数：\n- 温度 $T=300\\,\\mathrm{K}$。\n- 扩散系数 $D=0.10\\,\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1}$。\n- 曲率 $W''(x_{a})=2.0\\,k_{B}T\\,\\mathrm{nm}^{-2}$ 和 $W''(x^{\\ddagger})=-1.0\\,k_{B}T\\,\\mathrm{nm}^{-2}$。\n- 势垒高度 $\\Delta W^{\\ddagger}=12\\,k_{B}T$。\n\n这里，$k_{B}$ 是玻尔兹曼常数，$h$ 是普朗克常数。使用 $k_{B}=1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$ 和 $h=6.62607015\\times 10^{-34}\\,\\mathrm{J\\,s}$。\n\n分别以 $\\mathrm{s}^{-1}$ 为单位数值计算 $k_{\\mathrm{off}}^{\\mathrm{MFPT}}$ 和 $k_{\\mathrm{off}}^{\\mathrm{TST}}$，然后报告单个量 $r=k_{\\mathrm{off}}^{\\mathrm{MFPT}}/k_{\\mathrm{off}}^{\\mathrm{TST}}$。将您的最终值 $r$ 四舍五入到四位有效数字。将 $r$ 表示为无单位的小数。",
            "solution": "解离速率 $k_{\\mathrm{off}}$ 是配体逃离结合口袋的平均首过时间 (MFPT) 的倒数。问题描述了一维平均力势 (PMF) $W(x)$ 上的过阻尼动力学。\n\n首先，我们将基于 MFPT 推导速率的表达式，这在此背景下是高摩擦（斯莫鲁霍夫斯基）极限下的克莱默斯速率。对于一个从 $x_0$ 开始、到达吸收边界 $x_b$、并在 $x_a$ 有一个反射边界的粒子，其 MFPT $\\tau(x_0)$ 由庞特里亚金(Pontryagin)方程的积分给出：\n$$ \\tau(x_0) = \\frac{1}{D} \\int_{x_0}^{x_b} dx \\, \\exp\\left(\\frac{W(x)}{k_B T}\\right) \\int_{x_a}^{x} dy \\, \\exp\\left(-\\frac{W(y)}{k_B T}\\right) $$\n其中 $D$ 是扩散系数，$k_B$ 是玻尔兹曼常数，$T$ 是温度。\n\n对于从势阱中逃逸，我们认为起始点是势阱最小值 $x_a$，逃逸点是势垒最大值 $x^{\\ddagger}$。另一个边界是反射的，远离势阱，我们可以取其在 $x \\to -\\infty$。为了找到总速率，我们应该在阱内的平衡分布上对起始位置的 MFPT 进行平均。对于高势垒 $\\Delta W^{\\ddagger} \\gg k_B T$ 的情况，这可以很好地近似为从势阱最小值 $x_a$ 开始的 MFPT。平均逃逸时间 $\\tau$ 的表达式为：\n$$ \\tau = \\frac{1}{D} \\int_{x_a}^{x^{\\ddagger}} dx \\, \\exp\\left(\\frac{W(x)}{k_B T}\\right) \\int_{-\\infty}^{x} dy \\, \\exp\\left(-\\frac{W(y)}{k_B T}\\right) $$\n这些嵌套积分可以使用鞍点近似来计算。内层积分主要由势能最小值 $y=x_a$ 附近的区域贡献，而外层积分主要由势能最大值 $x=x^{\\ddagger}$ 附近的区域贡献。PMF 在这些点附近被近似为二次形式：\n$W(y) \\approx W(x_a) + \\frac{1}{2} W''(x_a) (y-x_a)^2$\n$W(x) \\approx W(x^{\\ddagger}) + \\frac{1}{2} W''(x^{\\ddagger}) (x-x^{\\ddagger})^2 = W(x^{\\ddagger}) - \\frac{1}{2} |W''(x^{\\ddagger})| (x-x^{\\ddagger})^2$\n\n用这些近似计算双重积分是克莱默斯(Kramers)理论的一个标准结果。得到的平均逃逸时间是：\n$$ \\tau = \\frac{2\\pi k_B T}{D \\sqrt{W''(x_a)|W''(x^{\\ddagger})|}} \\exp\\left(\\frac{\\Delta W^{\\ddagger}}{k_B T}\\right) $$\n其中 $\\Delta W^{\\ddagger} = W(x^{\\ddagger}) - W(x_a)$。解离速率是这个时间的倒数：\n$$ k_{\\mathrm{off}}^{\\mathrm{MFPT}} = \\frac{1}{\\tau} = \\frac{D \\sqrt{W''(x_a)|W''(x^{\\ddagger})|}}{2\\pi k_B T} \\exp\\left(-\\frac{\\Delta W^{\\ddagger}}{k_B T}\\right) $$\n这是过阻尼（斯莫鲁霍夫斯基）极限下的克莱默斯速率。\n\n接下来，我们写出过渡态理论 (TST) 在其标准艾林形式下的预测速率。该理论假设任何穿越势垒顶点的轨迹都是反应性的，并按如下方式计算速率：\n$$ k_{\\mathrm{off}}^{\\mathrm{TST}} = \\frac{k_B T}{h} \\exp\\left(-\\frac{\\Delta G^{\\ddagger}}{k_B T}\\right) $$\n其中 $h$ 是普朗克常数，$\\Delta G^{\\ddagger}$ 是吉布斯活化自由能。按照指示，我们取 $\\Delta G^{\\ddagger} = \\Delta W^{\\ddagger}$。\n$$ k_{\\mathrm{off}}^{\\mathrm{TST}} = \\frac{k_B T}{h} \\exp\\left(-\\frac{\\Delta W^{\\ddagger}}{k_B T}\\right) $$\n\n我们需要计算比率 $r = k_{\\mathrm{off}}^{\\mathrm{MFPT}}/k_{\\mathrm{off}}^{\\mathrm{TST}}$。\n$$ r = \\frac{\\frac{D \\sqrt{W''(x_a)|W''(x^{\\ddagger})|}}{2\\pi k_B T} \\exp\\left(-\\frac{\\Delta W^{\\ddagger}}{k_B T}\\right)}{\\frac{k_B T}{h} \\exp\\left(-\\frac{\\Delta W^{\\ddagger}}{k_B T}\\right)} $$\n指数项相互抵消，剩下指前因子的比率：\n$$ r = \\frac{D h \\sqrt{W''(x_a)|W''(x^{\\ddagger})|}}{2\\pi (k_B T)^2} $$\n这个比率通常被认为是透射系数 $\\kappa$，它校正了 TST，因为它考虑了扩散克莱默斯模型中包含的重穿越事件。\n\n现在，我们将给定的参数值代入 $r$ 的表达式中。首先进行符号代入是有利的。\n给定：\n$W''(x_a) = 2.0\\,k_{B}T\\,\\mathrm{nm}^{-2}$\n$|W''(x^{\\ddagger})| = 1.0\\,k_{B}T\\,\\mathrm{nm}^{-2}$\n\n平方根下的项变为：\n$$ \\sqrt{W''(x_a)|W''(x^{\\ddagger})|} = \\sqrt{(2.0\\,k_{B}T\\,\\mathrm{nm}^{-2})(1.0\\,k_{B}T\\,\\mathrm{nm}^{-2})} = \\sqrt{2.0} \\frac{k_B T}{\\mathrm{nm}^2} $$\n将此代入 $r$ 的表达式中：\n$$ r = \\frac{D h \\left(\\sqrt{2.0} \\frac{k_B T}{\\mathrm{nm}^2}\\right)}{2\\pi (k_B T)^2} = \\frac{\\sqrt{2} D h}{2\\pi k_B T (\\mathrm{nm}^2)} $$\n这个简化后的表达式已准备好进行数值计算。我们使用提供的数值（以国际单位制为准），除非可以抵消。\n$D = 0.10\\,\\mathrm{nm}^{2}\\,\\mathrm{ns}^{-1} = 0.10\\,\\mathrm{nm}^{2}\\,(10^{-9}\\,\\mathrm{s})^{-1} = 1.0 \\times 10^8\\,\\mathrm{nm}^{2}\\,\\mathrm{s}^{-1}$\n$h = 6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}$\n$k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n$T = 300\\,\\mathrm{K}$\n\n$k_B T$ 项为：\n$k_B T = (1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (300\\,\\mathrm{K}) = 4.141947 \\times 10^{-21}\\,\\mathrm{J}$\n\n现在我们计算 $r$：\n$$ r = \\frac{\\sqrt{2} (1.0 \\times 10^8\\,\\mathrm{nm}^{2}\\,\\mathrm{s}^{-1}) (6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s})}{2\\pi (4.141947 \\times 10^{-21}\\,\\mathrm{J}) (\\mathrm{nm}^2)} $$\n单位 $\\mathrm{nm}^2$ 直接抵消。剩余的单位是 $(\\mathrm{s}^{-1})(\\mathrm{J\\,s}) / \\mathrm{J}$，是无量纲的，符合预期。\n$$ r = \\frac{\\sqrt{2} \\times 1.0 \\times 10^8 \\times 6.62607015 \\times 10^{-34}}{2\\pi \\times 4.141947 \\times 10^{-21}} $$\n$$ r = \\frac{9.37080 \\times 10^{-26}}{2.60232 \\times 10^{-20}} $$\n$$ r = 3.60094 \\times 10^{-6} $$\n四舍五入到四位有效数字，我们得到 $r = 3.601 \\times 10^{-6}$。\n\n作为分析的一部分，我们可以计算各个速率。\n$k_{\\mathrm{off}}^{\\mathrm{TST}} = \\frac{k_B T}{h} \\exp(-12) = \\frac{4.141947 \\times 10^{-21}\\,\\mathrm{J}}{6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}} \\exp(-12) \\approx (6.2506 \\times 10^{12}\\,\\mathrm{s}^{-1}) \\times (6.1442 \\times 10^{-6}) \\approx 3.841 \\times 10^7\\,\\mathrm{s}^{-1}$。\n$k_{\\mathrm{off}}^{\\mathrm{MFPT}} = r \\times k_{\\mathrm{off}}^{\\mathrm{TST}} = (3.60094 \\times 10^{-6}) \\times (3.84068 \\times 10^7\\,\\mathrm{s}^{-1}) \\approx 138.3\\,\\mathrm{s}^{-1}$。\nr 的值非常小，表明在这个高摩擦（过阻尼）体系中，被 TST 忽略的势垒重穿越事件极为频繁，导致速率远低于 TST 的预测值。\n\n最终要求的量是 $r$ 的数值，四舍五入到四位有效数字。\n$r \\approx 3.601 \\times 10^{-6}$。这可以写成 $0.000003601$。",
            "answer": "$$\\boxed{3.601 \\times 10^{-6}}$$"
        },
        {
            "introduction": "虽然理论模型提供了内禀的速率常数，但实验测量值常常受到测量设备和条件的影响。本练习探讨了表面等离振子共振（SPR）实验中的一个常见复杂问题：质量输运限制 。你将推导一个耦合的反应-输运模型，以理解分析物输送到传感器表面的速率如何限制观测到的结合动力学，这是准确解释实验数据的关键概念。",
            "id": "3837042",
            "problem": "在表面等离振子共振 (SPR) 实验中，传感图谱报告了在连续流动条件下，一对一结合相互作用的表面复合物密度随时间的演变。考虑一个体相浓度为 $C_{b}$ 的分析物，流过一个载有固定化结合位点的平面，其总位点密度为 $R_{\\max}$ (单位为 $\\text{mol}/\\text{m}^{2}$)。令 $R(t)$ 表示表面复合物密度 (单位为 $\\text{mol}/\\text{m}^{2}$)。结合和解离动力学遵循标准反应规则，结合速率常数为 $k_{\\text{on}}$ (单位为 $\\text{m}^{3}/(\\text{mol}\\cdot\\text{s})$)，解离速率常数为 $k_{\\text{off}}$ (单位为 $\\text{s}^{-1}$)。从流动体相到表面的质量传输由线性传质系数 $k_{m}$ (单位为 $\\text{m}/\\text{s}$) 描述，产生的通量 $J$ (单位为 $\\text{mol}/(\\text{m}^{2}\\cdot\\text{s})$) 由体相浓度与近表面浓度 $C_{s}$ 之间的浓度差驱动，即 $J = k_{m}\\left(C_{b} - C_{s}\\right)$。假设存在一个准稳态边界层，使得表面的分析物净吸收等于来自体相的通量，并假设在早期结合阶段，$R(t) \\ll R_{\\max}$。\n\n从基本的质量传输和反应原理出发，推导将 $k_{m}$ 与表面结合动力学联系起来的耦合传输-反应模型，并获得在低占有率区域下，控制 $R(t)$ 指数逼近的观测结合速率常数 $k_{\\text{obs}}$ 的解析表达式。然后，对于参数集\n$k_{\\text{on}} = 2.0 \\times 10^{3}\\ \\text{m}^{3}/(\\text{mol}\\cdot\\text{s})$，$k_{\\text{off}} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$，$R_{\\max} = 1.0 \\times 10^{-8}\\ \\text{mol}/\\text{m}^{2}$，$k_{m} = 1.0 \\times 10^{-6}\\ \\text{m}/\\text{s}$，以及体相浓度 $C_{b} = 20\\ \\text{nM}$ (使用 $1\\ \\text{M} = 10^{3}\\ \\text{mol}/\\text{m}^{3}$ 转换为 $\\text{mol}/\\text{m}^{3}$)，计算 $k_{\\text{obs}}$ (单位为 $\\text{s}^{-1}$)。将您的数值答案四舍五入到四位有效数字，并以 $\\text{s}^{-1}$ 为单位表示。",
            "solution": "### $k_{\\text{obs}}$ 的推导\n\n表面复合物密度 $R(t)$ 的净变化率由表面上的质量作用定律决定。结合速率与近表面分析物浓度 $C_s$ 和可用结合位点密度 $(R_{\\max} - R(t))$ 成正比。解离速率与已形成的复合物密度 $R(t)$ 成正比。因此，表面反应的速率方程为：\n$$\n\\frac{dR(t)}{dt} = k_{\\text{on}} C_s (R_{\\max} - R(t)) - k_{\\text{off}} R(t) \\quad (1)\n$$\n准稳态边界层假设意味着，表面上分析物的净结合速率等于从体相到表面的质量输运通量 $J$：\n$$\n\\frac{dR(t)}{dt} = J = k_{m}(C_b - C_s) \\quad (2)\n$$\n我们的目标是通过消去中间变量——近表面浓度 $C_s$——来得到一个关于 $R(t)$ 的单一微分方程。从方程 (2) 中，我们可以将 $C_s$ 表示为：\n$$\nC_s = C_b - \\frac{1}{k_m} \\frac{dR(t)}{dt} \\quad (3)\n$$\n现在，将方程 (3) 中 $C_s$ 的表达式代入方程 (1)：\n$$\n\\frac{dR(t)}{dt} = k_{\\text{on}} \\left(C_b - \\frac{1}{k_m} \\frac{dR(t)}{dt}\\right) (R_{\\max} - R(t)) - k_{\\text{off}} R(t)\n$$\n这是一个耦合了质量输运和反应的非线性微分方程。为了推导在早期结合阶段（低占有率）的观测速率常数 $k_{\\text{obs}}$，我们利用假设 $R(t) \\ll R_{\\max}$ 来对该方程进行线性化。\n\n将方程展开并整理所有包含 $\\frac{dR(t)}{dt}$ 的项：\n$$\n\\frac{dR(t)}{dt} = k_{\\text{on}} C_b (R_{\\max} - R(t)) - \\frac{k_{\\text{on}}}{k_m} (R_{\\max} - R(t)) \\frac{dR(t)}{dt} - k_{\\text{off}} R(t)\n$$\n$$\n\\frac{dR(t)}{dt} \\left[ 1 + \\frac{k_{\\text{on}}}{k_m} (R_{\\max} - R(t)) \\right] = k_{\\text{on}} C_b (R_{\\max} - R(t)) - k_{\\text{off}} R(t)\n$$\n应用低占有率近似 $R(t) \\approx 0$。左侧方括号中的项变为：\n$$\n1 + \\frac{k_{\\text{on}}}{k_m} (R_{\\max} - R(t)) \\approx 1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m}\n$$\n右侧被线性化为：\n$$\nk_{\\text{on}} C_b R_{\\max} - k_{\\text{on}} C_b R(t) - k_{\\text{off}} R(t) = k_{\\text{on}} C_b R_{\\max} - (k_{\\text{on}} C_b + k_{\\text{off}}) R(t)\n$$\n将这些线性化的部分组合起来，我们得到一个关于 $R(t)$ 的线性微分方程：\n$$\n\\frac{dR(t)}{dt} \\left( 1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m} \\right) \\approx k_{\\text{on}} C_b R_{\\max} - (k_{\\text{on}} C_b + k_{\\text{off}}) R(t)\n$$\n分离出 $\\frac{dR(t)}{dt}$：\n$$\n\\frac{dR(t)}{dt} \\approx \\frac{k_{\\text{on}} C_b R_{\\max}}{1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m}} - \\left( \\frac{k_{\\text{on}} C_b + k_{\\text{off}}}{1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m}} \\right) R(t)\n$$\n这是一个形式为 $\\frac{dy}{dt} = A - B y$ 的一阶线性常微分方程。其解是一个指数函数，以特征速率常数 $B$ 趋近于平衡值 $y_{eq} = A/B$。根据定义，这个弛豫速率常数就是观测到的速率常数 $k_{\\text{obs}}$。\n因此，我们得到 $k_{\\text{obs}}$ 的解析表达式：\n$$\nk_{\\text{obs}} = \\frac{k_{\\text{on}} C_b + k_{\\text{off}}}{1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m}}\n$$\n这个表达式将内禀的反应动力学（$k_{\\text{on}}$, $k_{\\text{off}}$）与质量输运限制（通过分母中的项 $k_{\\text{on}} R_{\\max} / k_m$）联系起来。\n\n### 数值计算\n\n首先，我们将体相浓度 $C_b$ 转换为国际单位制（$\\text{mol}/\\text{m}^3$）。\n已知 $C_b = 20\\ \\text{nM} = 20 \\times 10^{-9}\\ \\text{mol}/\\text{L}$。\n使用换算关系 $1\\ \\text{M} = 10^3\\ \\text{mol}/\\text{m}^3$ (即 $1\\ \\text{L} = 10^{-3}\\ \\text{m}^3$)：\n$$\nC_b = 20 \\times 10^{-9}\\ \\frac{\\text{mol}}{10^{-3}\\ \\text{m}^3} = 20 \\times 10^{-6}\\ \\frac{\\text{mol}}{\\text{m}^3} = 2.0 \\times 10^{-5}\\ \\frac{\\text{mol}}{\\text{m}^3}\n$$\n现在，我们计算 $k_{\\text{obs}}$ 表达式的各个组成部分。\n\n分子：$k_{\\text{on}} C_b + k_{\\text{off}}$\n$$\nk_{\\text{on}} C_b = \\left(2.0 \\times 10^{3}\\ \\frac{\\text{m}^3}{\\text{mol}\\cdot\\text{s}}\\right) \\times \\left(2.0 \\times 10^{-5}\\ \\frac{\\text{mol}}{\\text{m}^3}\\right) = 4.0 \\times 10^{-2}\\ \\text{s}^{-1}\n$$\n$$\nk_{\\text{on}} C_b + k_{\\text{off}} = 4.0 \\times 10^{-2}\\ \\text{s}^{-1} + 1.0 \\times 10^{-3}\\ \\text{s}^{-1} = 0.040\\ \\text{s}^{-1} + 0.001\\ \\text{s}^{-1} = 0.041\\ \\text{s}^{-1}\n$$\n\n分母：$1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m}$\n首先，计算无量纲的质量输运项：\n$$\n\\frac{k_{\\text{on}} R_{\\max}}{k_m} = \\frac{\\left(2.0 \\times 10^{3}\\ \\frac{\\text{m}^3}{\\text{mol}\\cdot\\text{s}}\\right) \\times \\left(1.0 \\times 10^{-8}\\ \\frac{\\text{mol}}{\\text{m}^2}\\right)}{1.0 \\times 10^{-6}\\ \\frac{\\text{m}}{\\text{s}}} = \\frac{2.0 \\times 10^{-5}\\ \\frac{\\text{m}}{\\text{s}}}{1.0 \\times 10^{-6}\\ \\frac{\\text{m}}{\\text{s}}} = 20\n$$\n$$\n1 + \\frac{k_{\\text{on}} R_{\\max}}{k_m} = 1 + 20 = 21\n$$\n\n最后，计算 $k_{\\text{obs}}$：\n$$\nk_{\\text{obs}} = \\frac{0.041\\ \\text{s}^{-1}}{21} \\approx 0.00195238\\ \\text{s}^{-1}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\nk_{\\text{obs}} \\approx 1.952 \\times 10^{-3}\\ \\text{s}^{-1}\n$$",
            "answer": "$$\\boxed{1.952 \\times 10^{-3}}$$"
        },
        {
            "introduction": "最终，我们的预测和实验会产生原始数据，通常表现为一系列单分子驻留时间。这个编程实践练习将指导你完成关键的最后一步：稳健的统计分析 。你将实现一个最大似然估计器，从数据集中确定驻留时间，区分简单的（指数）和复杂的（伽马）解离动力学模型，并且，至关重要的是，学会计算你估算值的置信区间。",
            "id": "3837054",
            "problem": "考虑一个计算化学生物学中的单分子结合实验，其中驻留时间（配体在解离前与受体保持结合的持续时间）被记录为以秒为单位的正实数列表。在单步马尔可夫解离过程中，驻留时间是无记忆性的，并呈指数分布。在多步顺序解离过程中，即在解离前必须经过几个中间态，驻留时间呈非指数分布，并且可以用伽马分布族很好地建模，这与多个指数等待时间之和相符。从独立同分布观测的似然函数定义以及潜在微观状态的马尔可夫性质出发，推导一种方法来估计指数和非指数驻留时间模型的结合驻留时间及其不确定性。\n\n需使用的定义：\n- 驻留时间是平均驻留时间，记为 $ \\tau_{\\mathrm{res}} $。\n- 对于指数模型，参数是解离速率 $ k_{\\mathrm{off}} $，使得 $ \\tau_{\\mathrm{res}} $ 等于指数分布的均值。\n- 对于非指数模型，使用由正形状参数 $ \\alpha $ 和正速率参数 $ \\beta $ 参数化的伽马分布，这与连续时间马尔可夫链中的顺序步骤一致。\n\n你必须：\n- 基于似然原理，推导每种模型下参数的最大似然估计。\n- 从这些参数估计中，获得每种模型的 $ \\tau_{\\mathrm{res}} $ 估计值。\n- 以小数形式（例如，$ 0.95 $）量化置信水平为 $ 1 - \\alpha $ 的 $ \\tau_{\\mathrm{res}} $ 双侧置信区间，确保科学真实性和正确性。对于指数模型，使用从基本分布结果推导出的精确置信区间。对于伽马模型，使用基于费雪信息和德尔塔方法的渐近方法。\n- 将解决方案实现为一个完整、可运行的程序。\n\n所有涉及物理单位的答案必须以秒表示。置信水平必须以小数形式指定，任何概率或置信水平不得使用百分号表示。最终输出必须是数值浮点值。\n\n测试套件：\n为以下四个测试用例提供结果。每个测试用例包含一个模型标识符和以秒为单位的驻留时间列表，以及以小数形式指定的置信水平 $ 1 - \\alpha $。请在您的实现和计算中使用这些确切的列表。\n\n- 测试用例 $ 1 $（指数模型，具有中等样本量的典型情景）：模型 $ = $ \"exp\"，时间 $ = [\\, $0.41$, $0.28$, $0.55$, $0.32$, $0.77$, $1.09$, $0.63$, $0.40$, $0.94$, $0.35$ \\,]$，置信水平 $ 1 - \\alpha = $ $0.95$。\n- 测试用例 $ 2 $（伽马模型，具有多个步骤的非指数模型，中等样本量）：模型 $ = $ \"gamma\"，时间 $ = [\\, $0.17$, $0.62$, $1.35$, $0.84$, $0.49$, $1.05$, $1.84$, $0.73$, $0.98$, $1.20$ \\,]$，置信水平 $ 1 - \\alpha = $ $0.95$。\n- 测试用例 $ 3 $（指数模型，小样本边缘情况）：模型 $ = $ \"exp\"，时间 $ = [\\, $2.50$, $0.30$, $0.80$ \\,]$，置信水平 $ 1 - \\alpha = $ $0.95$。\n- 测试用例 $ 4 $（伽马模型，具有重尾的非指数模型，小样本）：模型 $ = $ \"gamma\"，时间 $ = [\\, $0.02$, $0.05$, $0.10$, $0.20$, $1.00$, $2.50$, $3.00$ \\,]$，置信水平 $ 1 - \\alpha = $ $0.95$。\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个方括号内以逗号分隔的结果列表。将所有测试用例的结果汇总成一个扁平的浮点数列表，每个测试用例按以下顺序排列：$ [\\, \\hat{\\tau}_{\\mathrm{res}}, \\mathrm{CI}_{\\mathrm{lower}}, \\mathrm{CI}_{\\mathrm{upper}} \\,] $。连接所有测试用例的这些三元组，从而为所有四个测试用例生成一个单一列表。例如，生成 $ [\\, \\text{result}_{1}, \\text{result}_{2}, \\dots \\,] $，其中每个 $ \\text{result}_{i} $ 是一个浮点数。所有输出均以秒表示，并将每个浮点数四舍五入到 $ 6 $ 位小数。",
            "solution": "设给定的 $n$ 个独立同分布（i.i.d.）的驻留时间集合为 $\\mathbf{t} = \\{t_1, t_2, \\dots, t_n\\}$。给定数据 $\\mathbf{t}$，参数向量 $\\theta$ 的似然函数 $L(\\theta; \\mathbf{t})$ 是观测值的联合概率密度函数（PDF）：\n$$L(\\theta; \\mathbf{t}) = \\prod_{i=1}^{n} f(t_i; \\theta)$$\n最大似然估计 $\\hat{\\theta}$ 是使 $L(\\theta; \\mathbf{t})$ 最大化的 $\\theta$ 值，等价于使对数似然函数 $\\ell(\\theta; \\mathbf{t}) = \\ln L(\\theta; \\mathbf{t})$ 最大化。\n\n为避免与伽马分布的形状参数 $\\alpha$ 混淆，我们将置信区间的显著性水平表示为 $\\alpha_{sig}$。因此，置信水平为 $1 - \\alpha_{sig}$。\n\n### 模型1：指数驻留时间\n\n对于单步马尔可夫解离过程，驻留时间遵循指数分布。其概率密度函数（PDF）为：\n$$f(t; k_{\\mathrm{off}}) = k_{\\mathrm{off}} e^{-k_{\\mathrm{off}} t}$$\n其中 $t  0$，$k_{\\mathrm{off}}$ 是解离速率常数。驻留时间 $\\tau_{\\mathrm{res}}$ 是该分布的均值，$\\tau_{\\mathrm{res}} = E[T] = 1/k_{\\mathrm{off}}$。\n\n对于 $n$ 个观测值，对数似然函数为：\n$$\\ell(k_{\\mathrm{off}}; \\mathbf{t}) = \\ln \\left( \\prod_{i=1}^{n} k_{\\mathrm{off}} e^{-k_{\\mathrm{off}} t_i} \\right) = \\sum_{i=1}^{n} (\\ln k_{\\mathrm{off}} - k_{\\mathrm{off}} t_i) = n \\ln k_{\\mathrm{off}} - k_{\\mathrm{off}} \\sum_{i=1}^{n} t_i$$\n为求 $k_{\\mathrm{off}}$ 的最大似然估计，我们对 $\\ell$ 关于 $k_{\\mathrm{off}}$ 求导，并令结果为零：\n$$\\frac{d\\ell}{dk_{\\mathrm{off}}} = \\frac{n}{k_{\\mathrm{off}}} - \\sum_{i=1}^{n} t_i = 0$$\n求解 $k_{\\mathrm{off}}$ 得到其最大似然估计 $\\hat{k}_{\\mathrm{off}}$：\n$$\\hat{k}_{\\mathrm{off}} = \\frac{n}{\\sum_{i=1}^{n} t_i} = \\frac{1}{\\bar{t}}$$\n其中 $\\bar{t} = \\frac{1}{n}\\sum_{i=1}^{n} t_i$ 是驻留时间的样本均值。\n\n根据最大似然估计的不变性，驻留时间的最大似然估计 $\\hat{\\tau}_{\\mathrm{res}}$ 可通过对 $\\hat{k}_{\\mathrm{off}}$ 应用相同的变换得到：\n$$\\hat{\\tau}_{\\mathrm{res}} = \\frac{1}{\\hat{k}_{\\mathrm{off}}} = \\bar{t}$$\n因此，对于指数模型，估计的驻留时间是观测驻留时间的样本均值。\n\n为构建 $\\tau_{\\mathrm{res}}$ 的精确置信区间，我们利用这样一个事实：对于 $n$ 个均值为 $\\tau_{\\mathrm{res}}$ 的独立同分布指数随机变量 $T_i$，其总和经均值缩放后，遵循一个明确定义的分布。量 $2 \\sum_{i=1}^n T_i / \\tau_{\\mathrm{res}}$ 服从自由度为 $2n$ 的卡方（$\\chi^2$）分布。\n$$ \\frac{2 \\sum_{i=1}^{n} T_i}{\\tau_{\\mathrm{res}}} \\sim \\chi^2_{2n} $$\n置信水平为 $1 - \\alpha_{sig}$ 的双侧置信区间通过找到临界值 $\\chi^2_{\\alpha_{sig}/2, 2n}$ 和 $\\chi^2_{1-\\alpha_{sig}/2, 2n}$ 来构建，使得：\n$$ P\\left( \\chi^2_{\\alpha_{sig}/2, 2n}  \\frac{2 \\sum t_i}{\\tau_{\\mathrm{res}}}  \\chi^2_{1-\\alpha_{sig}/2, 2n} \\right) = 1 - \\alpha_{sig} $$\n反转不等式以求解 $\\tau_{\\mathrm{res}}$，得到精确置信区间：\n$$ \\left( \\frac{2 \\sum t_i}{\\chi^2_{1-\\alpha_{sig}/2, 2n}}, \\frac{2 \\sum t_i}{\\chi^2_{\\alpha_{sig}/2, 2n}} \\right) $$\n代入 $\\sum t_i = n\\bar{t} = n\\hat{\\tau}_{\\mathrm{res}}$，该区间为：\n$$ \\mathrm{CI} = \\left( \\frac{2n\\hat{\\tau}_{\\mathrm{res}}}{\\chi^2_{1-\\alpha_{sig}/2, 2n}}, \\frac{2n\\hat{\\tau}_{\\mathrm{res}}}{\\chi^2_{\\alpha_{sig}/2, 2n}} \\right) $$\n\n### 模型2：伽马驻留时间\n\n对于多步解离过程，驻留时间由形状参数 $\\alpha  0$ 和速率参数 $\\beta  0$ 的伽马分布建模。其概率密度函数为：\n$$f(t; \\alpha, \\beta) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} t^{\\alpha-1} e^{-\\beta t}$$\n其中 $\\Gamma(\\alpha)$ 是伽马函数。该分布的均值为驻留时间，$\\tau_{\\mathrm{res}} = E[T] = \\alpha/\\beta$。\n\n对于 $n$ 个观测值，对数似然函数为：\n$$\\ell(\\alpha, \\beta; \\mathbf{t}) = \\ln \\left( \\prod_{i=1}^{n} \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} t_i^{\\alpha-1} e^{-\\beta t_i} \\right) = n(\\alpha \\ln \\beta - \\ln \\Gamma(\\alpha)) + (\\alpha-1)\\sum_{i=1}^{n} \\ln t_i - \\beta \\sum_{i=1}^{n} t_i$$\n为求最大似然估计，我们对 $\\alpha$ 和 $\\beta$ 取偏导数，并令其为零：\n$$ \\frac{\\partial\\ell}{\\partial\\beta} = \\frac{n\\alpha}{\\beta} - \\sum_{i=1}^{n} t_i = 0 \\implies \\hat{\\beta} = \\frac{\\hat{\\alpha}}{\\bar{t}} $$\n$$ \\frac{\\partial\\ell}{\\partial\\alpha} = n \\ln \\beta - n \\psi(\\alpha) + \\sum_{i=1}^{n} \\ln t_i = 0 $$\n其中 $\\psi(\\alpha) = \\frac{d}{d\\alpha}\\ln\\Gamma(\\alpha)$ 是双伽马函数。将 $\\hat{\\beta}$ 的表达式代入第二个方程，得到一个关于 $\\hat{\\alpha}$ 的方程：\n$$ n \\ln\\left(\\frac{\\hat{\\alpha}}{\\bar{t}}\\right) - n \\psi(\\hat{\\alpha}) + \\sum_{i=1}^{n} \\ln t_i = 0 \\implies \\ln(\\hat{\\alpha}) - \\psi(\\hat{\\alpha}) = \\ln(\\bar{t}) - \\frac{1}{n}\\sum_{i=1}^{n} \\ln t_i $$\n这个关于 $\\hat{\\alpha}$ 的超越方程必须数值求解。一旦求得 $\\hat{\\alpha}$，$\\hat{\\beta}$ 就通过 $\\hat{\\beta} = \\hat{\\alpha}/\\bar{t}$ 计算得出。\n利用最大似然估计的不变性，驻留时间的最大似然估计为：\n$$\\hat{\\tau}_{\\mathrm{res}} = \\frac{\\hat{\\alpha}}{\\hat{\\beta}} = \\frac{\\hat{\\alpha}}{\\hat{\\alpha}/\\bar{t}} = \\bar{t}$$\n值得注意的是，平均驻留时间的最大似然估计同样是样本均值，与指数模型中的情况一样。\n\n对于置信区间，我们采用一种渐近方法。中心极限定理指出，当 $n$ 很大时，样本均值 $\\bar{t}$ 近似服从均值为 $\\tau_{\\mathrm{res}}$、方差为 $\\text{Var}(T)/n$ 的正态分布。伽马分布变量 $T$ 的方差是 $\\text{Var}(T) = \\alpha/\\beta^2$。估计量 $\\hat{\\tau}_{\\mathrm{res}} = \\bar{t}$ 的标准误差为：\n$$ SE(\\hat{\\tau}_{\\mathrm{res}}) = \\sqrt{\\frac{\\text{Var}(T)}{n}} = \\sqrt{\\frac{\\alpha}{n\\beta^2}} $$\n我们用真实参数 $\\alpha$ 和 $\\beta$ 的最大似然估计 $\\hat{\\alpha}$ 和 $\\hat{\\beta}$ 来代替它们，得到估计的标准误差：\n$$ \\widehat{SE}(\\hat{\\tau}_{\\mathrm{res}}) = \\sqrt{\\frac{\\hat{\\alpha}}{n\\hat{\\beta}^2}} = \\sqrt{\\frac{\\hat{\\alpha}}{n(\\hat{\\alpha}/\\bar{t})^2}} = \\sqrt{\\frac{\\bar{t}^2}{n\\hat{\\alpha}}} = \\frac{\\bar{t}}{\\sqrt{n\\hat{\\alpha}}} = \\frac{\\hat{\\tau}_{\\mathrm{res}}}{\\sqrt{n\\hat{\\alpha}}} $$\n置信水平为 $1 - \\alpha_{sig}$ 的渐近双侧置信区间则为：\n$$ \\mathrm{CI} = \\hat{\\tau}_{\\mathrm{res}} \\pm z_{1-\\alpha_{sig}/2} \\cdot \\widehat{SE}(\\hat{\\tau}_{\\mathrm{res}}) = \\hat{\\tau}_{\\mathrm{res}} \\left( 1 \\pm \\frac{z_{1-\\alpha_{sig}/2}}{\\sqrt{n\\hat{\\alpha}}} \\right) $$\n其中 $z_{1-\\alpha_{sig}/2}$ 是标准正态分布的上 $1 - \\alpha_{sig}/2$ 分位数。该区间依赖于最大似然估计的渐近正态性，适用于伽马模型，因为在这种模型下没有易于处理的精确枢轴量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2, gamma, norm\nfrom scipy.special import digamma, polygamma\nimport sys\nimport warnings\n\ndef calculate_exp_model(times, confidence_level):\n    \"\"\"\n    Calculates residence time and its confidence interval for the exponential model.\n\n    Args:\n        times (list or np.ndarray): List of observed dwell times in seconds.\n        confidence_level (float): The confidence level for the interval (e.g., 0.95).\n\n    Returns:\n        tuple: A tuple containing (tau_res_hat, ci_lower, ci_upper).\n    \"\"\"\n    times = np.asarray(times)\n    n = len(times)\n    if n == 0:\n        return np.nan, np.nan, np.nan\n\n    # MLE for residence time is the sample mean\n    tau_res_hat = np.mean(times)\n    \n    # Per the derivation, an exact CI is based on the Chi-squared distribution\n    alpha_sig = 1.0 - confidence_level\n    df = 2 * n\n    \n    # Sum of observations\n    sum_t = np.sum(times)\n    \n    # Chi-squared critical values\n    chi2_lower_crit = chi2.ppf(alpha_sig / 2, df)\n    chi2_upper_crit = chi2.ppf(1 - alpha_sig / 2, df)\n    \n    # The upper bound of the CI uses the lower critical value of chi2, and vice-versa.\n    ci_upper = (2 * sum_t) / chi2_lower_crit if chi2_lower_crit > 0 else np.inf\n    ci_lower = (2 * sum_t) / chi2_upper_crit if chi2_upper_crit > 0 else 0\n    \n    return tau_res_hat, ci_lower, ci_upper\n\ndef calculate_gamma_model(times, confidence_level):\n    \"\"\"\n    Calculates residence time and its CI for the Gamma model.\n\n    Args:\n        times (list or np.ndarray): List of observed dwell times in seconds.\n        confidence_level (float): The confidence level for the interval (e.g., 0.95).\n\n    Returns:\n        tuple: A tuple containing (tau_res_hat, ci_lower, ci_upper).\n    \"\"\"\n    times = np.asarray(times)\n    n = len(times)\n    if n == 0:\n        return np.nan, np.nan, np.nan\n\n    # MLE for residence time is the sample mean\n    tau_res_hat = np.mean(times)\n\n    # Use scipy's built-in MLE fitter for the Gamma distribution to get alpha_hat\n    # The Gamma PDF in scipy is parameterized by a shape 'a', loc, and scale.\n    # Our PDF has shape=alpha, rate=beta. The relationship is scale = 1/beta.\n    # We assume loc=0.\n    # The fitter solves the transcendental equation for alpha numerically.\n    # A known issue in older scipy versions might cause warnings for small samples.\n    with warnings.catch_warnings():\n        warnings.simplefilter(\"ignore\", category=RuntimeWarning)\n        try:\n            alpha_hat, _, _ = gamma.fit(times, floc=0)\n        except Exception:\n            # Fallback for numerical instability, especially with very small samples\n            # or extreme data, although gamma.fit is generally robust.\n            return tau_res_hat, np.nan, np.nan\n    \n    # Asymptotic CI based on the Normal approximation and the delta method\n    alpha_sig = 1.0 - confidence_level\n    z_crit = norm.ppf(1 - alpha_sig / 2)\n    \n    # Standard error of tau_res_hat\n    se_tau = tau_res_hat / np.sqrt(n * alpha_hat)\n    \n    margin_of_error = z_crit * se_tau\n    \n    ci_lower = tau_res_hat - margin_of_error\n    ci_upper = tau_res_hat + margin_of_error\n    \n    # A physical dwell time cannot be negative.\n    ci_lower = max(0, ci_lower)\n\n    return tau_res_hat, ci_lower, ci_upper\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (\"exp\", [0.41, 0.28, 0.55, 0.32, 0.77, 1.09, 0.63, 0.40, 0.94, 0.35], 0.95),\n        (\"gamma\", [0.17, 0.62, 1.35, 0.84, 0.49, 1.05, 1.84, 0.73, 0.98, 1.20], 0.95),\n        (\"exp\", [2.50, 0.30, 0.80], 0.95),\n        (\"gamma\", [0.02, 0.05, 0.10, 0.20, 1.00, 2.50, 3.00], 0.95),\n    ]\n\n    all_results = []\n    for model, times, conf_level in test_cases:\n        if model == \"exp\":\n            results = calculate_exp_model(times, conf_level)\n        elif model == \"gamma\":\n            results = calculate_gamma_model(times, conf_level)\n        else:\n            raise ValueError(f\"Unknown model type: {model}\")\n        \n        all_results.extend(results)\n\n    # Format output to 6 decimal places as required.\n    formatted_results = [f\"{val:.6f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}