{
    "hands_on_practices": [
        {
            "introduction": "要有效利用主成分分析（PCA），首要任务是理解如何将构象数据投影到由主成分定义的新坐标系中。这项练习将引导你推导这一基本变换的数学公式，并强调在整个分析流程中保持数据预处理一致性的重要性。通过具体的数值计算，本练习旨在巩固你对PCA核心操作的理解，即将高维构象数据映射到低维表示形式。",
            "id": "3859043",
            "problem": "考虑一个由蛋白质骨架构象组成的分子动力学系综，每个构象由一个 $d$ 维特征向量 $x \\in \\mathbb{R}^{d}$ 表示。该向量是通过固定的特征化和对齐程序，从内坐标描述符（例如，扭转角派生特征）构建的。对一个包含 $n$ 个构象的训练集 $\\{x_{i}\\}_{i=1}^{n}$ 执行主成分分析 (PCA)，并采用标准的均值中心化预处理。其中，训练均值为 $\\bar{x} \\in \\mathbb{R}^{d}$，经验协方差矩阵定义为\n$$\nS \\equiv \\frac{1}{n-1} \\sum_{i=1}^{n} (x_{i} - \\bar{x})(x_{i} - \\bar{x})^{\\top}.\n$$\n设 $S$ 的标准正交特征分解为 $S = V \\Lambda V^{\\top}$，其中 $V \\in \\mathbb{R}^{d \\times d}$ 的列是标准正交特征向量，$\\Lambda \\in \\mathbb{R}^{d \\times d}$ 是对角矩阵，其对角线上的特征值按非递增顺序排列。$V$ 的前 $k$ 列被称为前 $k$ 个主成分的载荷向量。\n\n严格从上述定义和标准正交基的性质出发，推导一个表达式，用于计算一个新构象 $x_{\\text{new}} \\in \\mathbb{R}^{d}$ 在与训练协方差 $S$ 相关的 $k$ 维主成分基中的表示系数。然后，解释为什么对 $x_{\\text{new}}$ 应用相同的预处理流程（包括特征化、对齐和使用训练均值 $\\bar{x}$ 进行的均值中心化）对于获得科学上有意义的投影是必要的。\n\n最后，对以下仅进行均值中心化（无缩放）的具体案例，计算推导出的表达式的值：\n- 维度 $d = 4$，主成分数量 $k = 2$。\n- 前两个主成分的载荷矩阵为\n$$\nV_{(2)} = \\begin{pmatrix}\n\\frac{1}{2}  \\frac{1}{2} \\\\\n\\frac{1}{2}  -\\frac{1}{2} \\\\\n\\frac{1}{2}  \\frac{1}{2} \\\\\n\\frac{1}{2}  -\\frac{1}{2}\n\\end{pmatrix}.\n$$\n- 训练均值向量为\n$$\n\\bar{x} = \\begin{pmatrix}\n0.2 \\\\ -0.1 \\\\ 0.3 \\\\ 0.0\n\\end{pmatrix}.\n$$\n- 新构象为\n$$\nx_{\\text{new}} = \\begin{pmatrix}\n0.3 \\\\ 0.1 \\\\ 0.0 \\\\ -0.1\n\\end{pmatrix}.\n$$\n\n使用推导的表达式计算 $x_{\\text{new}}$ 的两个主成分系数，并将这对值表示为单个行向量。将最终数值结果四舍五入到四位有效数字。最终数值答案不需要物理单位。",
            "solution": "在进行解答之前，对问题陈述进行分析和验证。\n\n### 步骤 1：问题验证\n\n逐字提取给定条件：\n- 一个 $d$ 维特征向量 $x \\in \\mathbb{R}^{d}$ 代表一个蛋白质骨架构象。\n- 训练集为 $\\{x_{i}\\}_{i=1}^{n}$。\n- 预处理是使用训练均值 $\\bar{x} \\in \\mathbb{R}^{d}$ 进行均值中心化。\n- 经验协方差矩阵为 $S \\equiv \\frac{1}{n-1} \\sum_{i=1}^{n} (x_{i} - \\bar{x})(x_{i} - \\bar{x})^{\\top}$。\n- $S$ 的特征分解为 $S = V \\Lambda V^{\\top}$，其中 $V \\in \\mathbb{R}^{d \\times d}$ 的列是标准正交特征向量，$\\Lambda$ 是一个特征值非递增的对角矩阵。\n- $V$ 的前 $k$ 列是载荷向量。\n- 一个新构象由 $x_{\\text{new}} \\in \\mathbb{R}^{d}$ 给出。\n- 对于数值计算案例：\n  - $d = 4$ 且 $k = 2$。\n  - 前两个主成分的载荷矩阵：$V_{(2)} = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  -\\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  -\\frac{1}{2} \\end{pmatrix}$。\n  - 训练均值向量：$\\bar{x} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\\\ 0.3 \\\\ 0.0 \\end{pmatrix}$。\n  - 新构象：$x_{\\text{new}} = \\begin{pmatrix} 0.3 \\\\ 0.1 \\\\ 0.0 \\\\ -0.1 \\end{pmatrix}$。\n\n对问题进行验证：\n- **科学依据**：该问题描述了主成分分析 (PCA) 在分子动力学构象数据中的一个标准和基础应用，这是计算生物物理学中的一项核心技术。协方差矩阵、其特征分解和主成分的定义都是标准且正确的。\n- **适定性**：该问题是适定的。它要求进行标准推导、概念解释和具体计算，并为此提供了所有必要数据。保证存在唯一且有意义的解。\n- **客观性**：问题以精确的数学术语陈述，没有歧义或主观性。\n- **一致性**：所提供的载荷矩阵 $V_{(2)}$ 由两列组成。设这两列为 $v_1$ 和 $v_2$。我们检查其标准正交性：$v_1^\\top v_1 = (\\frac{1}{2})^2 \\times 4 = 1$，$v_2^\\top v_2 = (\\frac{1}{2})^2 + (-\\frac{1}{2})^2 + (\\frac{1}{2})^2 + (-\\frac{1}{2})^2 = 1$，以及 $v_1^\\top v_2 = \\frac{1}{4} - \\frac{1}{4} + \\frac{1}{4} - \\frac{1}{4} = 0$。这些列确实是标准正交的，这证实了问题陈述的内部一致性。\n\n该问题被认为是有效的，因为它是科学合理的、自洽的、一致的且适定的。\n\n### 步骤 2：解答\n\n#### 主成分系数的推导\n\n主成分，即矩阵 $V$ 的列向量，构成了空间 $\\mathbb{R}^d$ 的一个标准正交基。设这些列向量表示为 $\\{v_j\\}_{j=1}^d$。PCA 的核心思想是描述数据相对于其均值 $\\bar{x}$ 的方差。因此，任何新的数据点 $x_{\\text{new}}$ 都必须首先被转换到这个中心化的坐标系中。中心化后的向量是：\n$$\nx'_{\\text{new}} = x_{\\text{new}} - \\bar{x}\n$$\n我们希望将这个中心化向量 $x'_{\\text{new}}$ 表示为前 $k$ 个主成分基向量的线性组合。在 $d$ 维基中的完整表示是：\n$$\nx'_{\\text{new}} = \\sum_{j=1}^{d} c_j v_j\n$$\n其中 $c_j$ 是对应于第 $j$ 个主成分 $v_j$ 的系数或得分。\n\n为了找到特定系数（例如 $c_i$）的值，我们利用基向量的标准正交性。将方程两边与向量 $v_i$ 进行点积（内积）：\n$$\nv_i^{\\top} x'_{\\text{new}} = v_i^{\\top} \\left( \\sum_{j=1}^{d} c_j v_j \\right)\n$$\n根据点积的线性性质，我们可以将 $v_i^{\\top}$ 移到求和符号内部：\n$$\nv_i^{\\top} x'_{\\text{new}} = \\sum_{j=1}^{d} c_j (v_i^{\\top} v_j)\n$$\n由于基 $\\{v_j\\}$ 是标准正交的，内积 $v_i^{\\top} v_j$ 等于克罗内克 δ (Kronecker delta) $\\delta_{ij}$，当 $i=j$ 时为 $1$，当 $i \\neq j$ 时为 $0$。\n$$\nv_i^{\\top} x'_{\\text{new}} = \\sum_{j=1}^{d} c_j \\delta_{ij}\n$$\n右侧的求和坍缩为单项 $c_i$：\n$$\nc_i = v_i^{\\top} x'_{\\text{new}} = v_i^{\\top} (x_{\\text{new}} - \\bar{x})\n$$\n这个表达式给出了第 $i$ 个主成分的系数。为了找到前 $k$ 个主成分的系数集，我们收集系数 $\\{c_1, c_2, \\dots, c_k\\}$。这可以用矩阵形式表示。设 $V_{(k)} \\in \\mathbb{R}^{d \\times k}$ 是一个矩阵，其列是前 $k$ 个特征向量 $v_1, \\dots, v_k$。设 $c \\in \\mathbb{R}^k$ 是系数的列向量。那么：\n$$\nc = \\begin{pmatrix} c_1 \\\\ c_2 \\\\ \\vdots \\\\ c_k \\end{pmatrix} = \\begin{pmatrix} v_1^{\\top} \\\\ v_2^{\\top} \\\\ \\vdots \\\\ v_k^{\\top} \\end{pmatrix} (x_{\\text{new}} - \\bar{x}) = V_{(k)}^{\\top} (x_{\\text{new}} - \\bar{x})\n$$\n这就是表示新构象在 $k$ 维主成分基中的系数的推导表达式。\n\n#### 预处理流程的合理性论证\n\n应用相同的预处理流程是确保科学有效性的关键要求。\n1.  **共享参考框架**：PCA 确定了一个新的坐标系（主成分），其原点是训练数据的均值 $\\bar{x}$，其坐标轴与该训练数据内方差最大的方向对齐。协方差矩阵 $S$ 及其特征向量 $V$ 完全是在这个统计背景下定义的。将一个新的数据点 $x_{\\text{new}}$ 投影到这个基上，只有当 $x_{\\text{new}}$ 首先在同一个坐标系中表示时才有意义。从 $x_{\\text{new}}$ 中减去*训练均值* $\\bar{x}$，将新数据点转换到这个共享的参考框架中。如果不这样做，就好比相对于一个坐标原点（例如，全局原点）测量一个位置，却将其绘制在以其他地方为中心的地图上，从而得到一个无意义的位置。\n2.  **一致的特征空间**：特征化和对齐程序更为基础。它们定义了分析所在的向量空间 $\\mathbb{R}^d$ 本身。构象本身并不是一个向量；它是通过一组特定的规则（例如，计算所有 $\\phi/\\psi$ 扭转角）转换而来的。如果 $x_{\\text{new}}$ 的特征化或对齐方式与训练集不同，它将存在于一个完全不同的特征空间中。将一个空间中的向量投影到另一个空间中定义的基上，在数学上和科学上都是无效的操作。因此，为了在从训练集中学到的构象景观的背景下比较或表示 $x_{\\text{new}}$，它必须经过完全相同的变换序列。\n\n#### 数值计算\n\n给定条件如下：\n- 维度 $d = 4$，主成分数量 $k = 2$。\n- 载荷矩阵 $V_{(2)} = \\begin{pmatrix} 0.5  0.5 \\\\ 0.5  -0.5 \\\\ 0.5  0.5 \\\\ 0.5  -0.5 \\end{pmatrix}$。\n- 训练均值 $\\bar{x} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\\\ 0.3 \\\\ 0.0 \\end{pmatrix}$。\n- 新构象 $x_{\\text{new}} = \\begin{pmatrix} 0.3 \\\\ 0.1 \\\\ 0.0 \\\\ -0.1 \\end{pmatrix}$。\n\n首先，我们计算中心化向量 $x'_{\\text{new}} = x_{\\text{new}} - \\bar{x}$：\n$$\nx'_{\\text{new}} = \\begin{pmatrix} 0.3 \\\\ 0.1 \\\\ 0.0 \\\\ -0.1 \\end{pmatrix} - \\begin{pmatrix} 0.2 \\\\ -0.1 \\\\ 0.3 \\\\ 0.0 \\end{pmatrix} = \\begin{pmatrix} 0.3 - 0.2 \\\\ 0.1 - (-0.1) \\\\ 0.0 - 0.3 \\\\ -0.1 - 0.0 \\end{pmatrix} = \\begin{pmatrix} 0.1 \\\\ 0.2 \\\\ -0.3 \\\\ -0.1 \\end{pmatrix}\n$$\n接下来，我们使用推导出的表达式 $c = V_{(2)}^{\\top} x'_{\\text{new}}$ 计算系数向量 $c \\in \\mathbb{R}^2$。$V_{(2)}$ 的转置是：\n$$\nV_{(2)}^{\\top} = \\begin{pmatrix} 0.5  0.5  0.5  0.5 \\\\ 0.5  -0.5  0.5  -0.5 \\end{pmatrix}\n$$\n现在我们进行矩阵-向量乘法：\n$$\nc = \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix} = \\begin{pmatrix} 0.5  0.5  0.5  0.5 \\\\ 0.5  -0.5  0.5  -0.5 \\end{pmatrix} \\begin{pmatrix} 0.1 \\\\ 0.2 \\\\ -0.3 \\\\ -0.1 \\end{pmatrix}\n$$\n第一个系数 $c_1$ 是：\n$$\nc_1 = (0.5)(0.1) + (0.5)(0.2) + (0.5)(-0.3) + (0.5)(-0.1) = 0.05 + 0.10 - 0.15 - 0.05 = -0.05\n$$\n第二个系数 $c_2$ 是：\n$$\nc_2 = (0.5)(0.1) + (-0.5)(0.2) + (0.5)(-0.3) + (-0.5)(-0.1) = 0.05 - 0.10 - 0.15 + 0.05 = -0.15\n$$\n得到的系数向量是 $c = \\begin{pmatrix} -0.05 \\\\ -0.15 \\end{pmatrix}$。题目要求将答案表示为单个行向量，并将数值四舍五入到四位有效数字。\n- $-0.05$ 变为 $-0.05000$。\n- $-0.15$ 变为 $-0.1500$。\n最终的行向量是 $\\begin{pmatrix} -0.05000  -0.1500 \\end{pmatrix}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.05000  -0.1500\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "PCA分析的有效性在很大程度上取决于我们如何表征输入数据，尤其是在处理具有周期性边界的分子坐标（如扭转角）时。这项练习通过一个简化的双稳态模型，清晰地揭示了为何直接使用原始角度值进行PCA分析会产生误导性结果。通过对比原始角度编码和正弦-余弦嵌入两种方法，你将深入理解如何正确处理周期性数据以确保分析的物理意义。",
            "id": "3859111",
            "problem": "来自肽的单个主链扭转角 $\\,\\phi\\,$ 表现出两个布居数相等的亚稳构象盆，一个中心位于 $\\,\\phi=0\\,$，另一个中心位于 $\\,\\phi=\\pi\\,$。假设每个盆内的热展宽相对于盆间距可以忽略不计，因此经验分布可以建模为位于 $\\,\\phi=0\\,$ 和 $\\,\\phi=\\pi\\,$ 的两个点质量的混合，每个点质量的概率均为 $\\,\\tfrac{1}{2}\\,$。角度以弧度为单位。\n\n主成分分析 (PCA) 定义为将均值中心化数据的协方差矩阵对角化的正交线性变换；主成分方差是协方差矩阵的特征值。仅使用协方差和 PCA 的核心定义，考虑同一构象系综的两种编码方式：\n\n- 原始角度编码：标量变量 $\\,x=\\phi\\,$。\n- 正余弦嵌入：向量变量 $\\,\\mathbf{y}=\\big(\\cos\\phi,\\sin\\phi\\big)^{\\top}$。\n\n对于每种编码，根据给定的两态模型构建随机变量的均值中心化协方差矩阵，并确定其最大特征值（沿第一主成分的方差）。然后，计算精确比率\n$$\nr \\;=\\; \\frac{\\lambda_{\\text{raw}}}{\\lambda_{\\text{sincos}}}\\,,\n$$\n其中 $\\,\\lambda_{\\text{raw}}\\,$ 是原始角度编码的最大特征值，$\\,\\lambda_{\\text{sincos}}\\,$ 是正余弦嵌入的最大特征值。以精确的符号表达式形式给出最终答案。无需四舍五入。",
            "solution": "*   从问题验证开始。逐字陈述已知条件。根据标准对其进行分析。得出问题有效的结论。\n    *   继续进行求解。\n    *   首先处理“原始角度编码”。\n        *   定义随机变量 $x$。\n        *   计算其均值 $E[x]$。\n        *   陈述均值中心化变量 $x' = x - E[x]$。\n        *   计算协方差矩阵，即 $x$ 的方差。$C_x = \\text{Var}(x) = E[(x-E[x])^2]$。\n        *   唯一的特征值就是这个方差。称之为 $\\lambda_{\\text{raw}}$。\n    *   接下来处理“正余弦嵌入”。\n        *   定义随机向量 $\\mathbf{y}$。\n        *   计算其均值向量 $E[\\mathbf{y}]$。\n        *   陈述均值中心化向量 $\\mathbf{y}' = \\mathbf{y} - E[\\mathbf{y}]$。\n        *   计算协方差矩阵 $\\mathbf{C}_\\mathbf{y} = E[(\\mathbf{y}-E[\\mathbf{y}])(\\mathbf{y}-E[\\mathbf{y}])^\\top]$。\n        *   通过求解特征方程 $\\det(\\mathbf{C}_\\mathbf{y} - \\lambda \\mathbf{I}) = 0$ 来求 $\\mathbf{C}_\\mathbf{y}$ 的特征值。\n        *   确定最大特征值 $\\lambda_{\\text{sincos}}$。\n    *   最后，计算比率 $r = \\frac{\\lambda_{\\text{raw}}}{\\lambda_{\\text{sincos}}}$。\n    *   所有数学实体都将使用 LaTeX 格式。",
            "answer": "$$\n\\boxed{\\frac{\\pi^2}{4}}\n$$"
        },
        {
            "introduction": "主成分分析不仅是一种强大的降维和分析工具，更是一种富有潜力的生成模型，能够用于探索新的分子构象。这项综合性的编程练习将指导你完成从PCA空间中采样、将低维坐标反向映射回笛卡尔空间，到最终生成全新分子结构的全过程。此外，练习还引入了基于空间位阻的物理过滤器，强调了在生成构象后进行物理现实性验证的关键步骤，从而将抽象的统计模型与真实的化学校验联系起来。",
            "id": "3859035",
            "problem": "给定一项任务，要求在计算化学生物学领域中，将主成分分析（PCA）与构象采样相结合，应用于一个粗粒化的肽骨架模型。目标是推导、实现并验证一种方法，通过在主成分空间中采样并反向映射回笛卡尔坐标来生成合成结构，然后使用简单的空间位阻检查过滤掉物理上不合理的构象。所有分子距离均以埃（Ångström）为单位，并且任何随机数生成都必须通过一个固定的伪随机种子来实现确定性。\n\n必须从以下基本原理出发，这些原理将指导您的推导和算法设计：\n- 输入构象系综表示为一个分子系统的零均值坐标涨落集合，其中每个构象是 $N$ 个原子的笛卡尔坐标向量，构成一个长度为 $3N$ 的向量。\n- 系综协方差矩阵由零均值数据矩阵定义，它是一个对称半正定矩阵，其特征分解产生标准正交的特征向量和非负的特征值。\n- 主成分分析（PCA）被定义为一种正交变换，它将协方差矩阵对角化，从而将零均值坐标投影到一个基底上，在该基底上坐标方差是有序且解耦的。\n\n您必须实现以下内容，并严格依据上述基本原理推导出必要的变换：\n1. 为一个包含 $N = 6$ 个原子（标记为 $\\{N, CA, C, N, CA, C\\}$）的骨架基序构建一个确定性的训练系综，包含 $T$ 个构象。这些原子沿骨架图线性排列，连续原子之间存在键。使用固定的伪随机种子，对一个物理上合理的平均结构施加绕 $z$ 轴的微小随机刚性旋转和独立的高斯位置噪声，所有距离单位为埃。骨架图是一条简单的链，因此原子索引 $i$ 和 $j$ 之间的图距离为 $|i - j|$。\n2. 从零均值的扁平化坐标系综中计算 $3N \\times 3N$ 的协方差矩阵，并进行特征分解以获得有序的主成分。使用特征值从大到小的排序。\n3. 通过在维度为 $k$ 的主成分空间中抽取具有零均值和逐分量方差（与对应的前 $k$ 个特征值成比例，并由一个无量纲因子 $s$ 缩放）的高斯系数来采样合成结构。使用前 $k$ 个主成分方向将这些样本反向映射回完整的 $3N$ 维笛卡尔坐标空间，并重新加上平均值。\n4. 使用简单的空间位阻检查过滤非物理构象：对于所有图距离大于或等于 $3$（即 $|i - j| \\ge 3$）的原子对，如果任何原子间的欧几里得距离严格小于 $\\alpha \\cdot (r_i + r_j)$，则拒绝该构象。其中 $r_i$ 和 $r_j$ 分别是原子 $i$ 和 $j$ 的范德华半径，给定 $r_{\\mathrm{N}} = 1.55$ Å、$r_{\\mathrm{C}} = 1.70$ Å 以及 $r_{\\mathrm{CA}} = r_{\\mathrm{C}}$。任何旋转的角度单位必须是弧度。报告接受率，定义为通过空间位阻过滤的采样构象数除以总样本数，结果以小数表示。\n\n测试套件和要求输出：\n- 使用一个单一的、确定性的训练系综，包含 $T = 1000$ 个构象，这些构象是通过对平均结构施加标准差为 $0.1$ Å 的高斯位置噪声和标准差为 $0.05$ 弧度的绕 $z$ 轴旋转而生成的。所有随机性必须由固定的伪随机种子控制。\n- 将该方法应用于以下四个测试用例，每个用例指定为一个元组 $(k, M, s, \\alpha)$，其中 $k$ 是保留的主成分数量， $M$ 是要抽取的合成样本数量， $s$ 是分量方差的无量纲缩放因子， $\\alpha$ 是空间位阻缩放因子：\n    - 用例 1: $(k = 2, M = 200, s = 1.0, \\alpha = 1.0)$。\n    - 用例 2: $(k = 1, M = 200, s = 0.5, \\alpha = 1.0)$。\n    - 用例 3: $(k = 18, M = 200, s = 0.0, \\alpha = 1.0)$，其中 $18 = 3N$。\n    - 用例 4: $(k = 4, M = 200, s = 3.0, \\alpha = 1.0)$。\n- 对于每个用例，计算接受率（一个十进制浮点数）。您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表内是四个四舍五入到三位小数的十进制数，并用方括号括起来（例如，$[x_1,x_2,x_3,x_4]$）。\n\n您的实现必须是一个完整的、可运行的程序，该程序能够执行系综生成、PCA、采样、反向映射、空间位阻过滤，并汇总四个测试用例的接受率，最后以指定格式打印最终的单行输出。",
            "solution": "所提出的问题是有效的，因为它具有科学依据、问题适定、客观，并包含了推导唯一、可验证解所需的所有信息。它概述了计算生物物理学中使用主成分分析（PCA）——一种统计数据分析的基石——来分析和生成分子结构的标准流程。我们现在将进行形式化的推导和求解。\n\n总体目标是从 PCA 定义的低维潜在空间中生成一组合成的分子构象，并对这些构象进行物理合理性过滤。该方法包括四个主要阶段：1. 生成训练构象系综。2. 应用 PCA 识别结构变异的主要模式。3. 在主成分空间中进行随机采样并反向映射回笛卡尔坐标。4. 对生成的结构进行空间位阻过滤。\n\n假设系统由 $N$ 个原子组成。单个构象由一个向量 $\\mathbf{x} \\in \\mathbb{R}^{3N}$ 表示，该向量包含扁平化的笛卡尔坐标 $(x_1, y_1, z_1, x_2, y_2, z_2, \\dots, x_N, y_N, z_N)$。所有坐标和距离的单位均为埃（Å）。\n\n1.  **系综生成与协方差分析**\n\n我们首先生成一个包含 $T$ 个构象的训练系综，记为 $\\{\\mathbf{x}^{(m)}\\}_{m=1}^T$。该系综是通过对一个参考平均结构施加随机扰动来创建的。第 $m$ 个构象的坐标构成向量 $\\mathbf{x}^{(m)}$。这些向量被收集为一个大小为 $T \\times 3N$ 的数据矩阵 $X$ 的行。\n\nPCA 的第一步是对数据进行中心化。我们计算系综的平均构象 $\\bar{\\mathbf{x}}$：\n$$\n\\bar{\\mathbf{x}} = \\frac{1}{T} \\sum_{m=1}^{T} \\mathbf{x}^{(m)}\n$$\n零均值（或中心化）构象由 $\\bar{\\mathbf{x}}^{(m)} = \\mathbf{x}^{(m)} - \\bar{\\mathbf{x}}$ 给出。然后，从这些中心化向量计算样本协方差矩阵 $C$，它是一个 $3N \\times 3N$ 的对称半正定矩阵：\n$$\nC = \\frac{1}{T-1} \\sum_{m=1}^{T} \\bar{\\mathbf{x}}^{(m)} (\\bar{\\mathbf{x}}^{(m)})^T\n$$\n协方差矩阵量化了所有原子坐标对之间的相关涨落。\n\n2.  **主成分分析**\n\n通过求解协方差矩阵 $C$ 的特征值和特征向量来进行 PCA。这是一个特征分解问题：\n$$\nC \\mathbf{v}_i = \\lambda_i \\mathbf{v}_i, \\quad i = 1, \\dots, 3N\n$$\n这里，$\\lambda_i$ 是特征值，$\\mathbf{v}_i$ 是对应的特征向量。这些特征向量，被称为主成分（PC），形成一个将协方差矩阵对角化的标准正交基。每个特征值 $\\lambda_i$ 代表数据投影到相应特征向量 $\\mathbf{v}_i$ 上的方差。PC 根据其对应的特征值按降序排列，$\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_{3N} \\ge 0$。具有最大特征值的前几个 PC 捕捉了构象系综内部主要的、大振幅的运动。设 $V$ 是一个正交矩阵，其列为有序的特征向量，即 $V = [\\mathbf{v}_1, \\mathbf{v}_2, \\dots, \\mathbf{v}_{3N}]$。\n\n任何一个零均值构象 $\\bar{\\mathbf{x}}^{(m)}$ 都可以精确地表示为 PC 的线性组合：\n$$\n\\bar{\\mathbf{x}}^{(m)} = \\sum_{i=1}^{3N} p_{i}^{(m)} \\mathbf{v}_i = V \\mathbf{p}^{(m)}\n$$\n其中 $\\mathbf{p}^{(m)}$ 是构象 $m$ 的主坐标向量，通过投影获得：$\\mathbf{p}^{(m)} = V^T \\bar{\\mathbf{x}}^{(m)}$。\n\n3.  **合成构象生成**\n\n我们可以通过在由前 $k$ 个主成分张成的低维空间中进行采样来生成新的合成构象，其中 $k \\le 3N$。生成一个新的主坐标向量 $\\mathbf{p}_{\\text{synth}}$。其前 $k$ 个分量 $\\{c_i\\}_{i=1}^k$ 从独立的高斯分布中抽取，而其余的 $3N-k$ 个分量被设置为零。每个分量 $c_i$ 的分布选择模拟训练数据中观察到的方差：\n$$\nc_i \\sim \\mathcal{N}(\\mu=0, \\sigma^2=s \\lambda_i), \\quad \\text{for } i=1, \\dots, k\n$$\n这里，$s$ 是一个无量纲缩放因子，允许调节采样的方差。完整的合成主坐标向量为 $\\mathbf{p}_{\\text{synth}} = (c_1, c_2, \\dots, c_k, 0, \\dots, 0)^T$。\n\n然后，通过反向映射在笛卡尔坐标中重建合成构象。首先，获得零均值的合成构象 $\\bar{\\mathbf{x}}_{\\text{synth}}$：\n$$\n\\bar{\\mathbf{x}}_{\\text{synth}} = \\sum_{i=1}^{k} c_i \\mathbf{v}_i\n$$\n然后，加回平均构象以得到最终结构：\n$$\n\\mathbf{x}_{\\text{synth}} = \\bar{\\mathbf{x}}_{\\text{synth}} + \\bar{\\mathbf{x}}\n$$\n\n4.  **空间位阻过滤**\n\n生成的结构，特别是在以大方差（$s > 1$）或从有限数量的 PC 中采样时，可能不是物理上真实的。一个常见问题是空间位阻碰撞，即非键合原子之间距离过近，不符合物理实际。我们应用一个过滤器来拒绝此类结构。如果任何一对在分子图中连接不紧密的原子 $(i, j)$ 之间的欧几里得距离 $d_{ij}$ 违反了距离判据，则该构象被视为无效。\n\n对于给定的具有 $N=6$ 个原子的骨架，图距离为 $|i-j|$。对所有满足 $|i-j| \\ge 3$ 的原子对进行检查。如果对于任何这样的原子对：\n$$d_{ij}  \\alpha \\cdot (r_i + r_j)$$\n则拒绝该构象，其中 $r_i$ 和 $r_j$ 分别是原子 $i$ 和 $j$ 的范德华半径，$\\alpha$ 是一个缩放因子。指定的半径为 $r_{\\mathrm{N}} = 1.55$ Å 和 $r_{\\mathrm{C}} = r_{\\mathrm{CA}} = 1.70$ Å。接受率是成功通过此过滤器的构象数与生成的总样本数 $M$ 的比值。\n\n对于方差缩放因子 $s=0$ 的特殊情况，所有生成的系数 $c_i$ 将恰好为 $0$。因此，$\\bar{\\mathbf{x}}_{\\text{synth}}$ 将是零向量，每个合成构象 $\\mathbf{x}_{\\text{synth}}$ 都将与平均构象 $\\bar{\\mathbf{x}}$ 完全相同。如果平均结构本身在空间位阻上是有效的，那么接受率将为 $1.0$，否则为 $0.0$。鉴于平均结构是物理上合理构象的平均值，预期它是有效的，从而导致接受率为 $1.0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs PCA-based conformational sampling and steric filtering for a coarse-grained peptide model.\n    \"\"\"\n    #\n    # --- GLOBAL PARAMETERS AND CONSTANTS ---\n    #\n    RANDOM_SEED = 0  # Fixed seed for deterministic randomness\n    \n    # Ensemble generation parameters\n    T = 1000  # Number of training conformations\n    N = 6     # Number of atoms\n    POS_NOISE_STD = 0.1  # Std dev for Gaussian positional noise (Å)\n    ROT_NOISE_STD = 0.05  # Std dev for z-axis rotation noise (radians)\n\n    # Atom properties\n    ATOM_LABELS = ['N', 'CA', 'C', 'N', 'CA', 'C']\n    VDW_RADII_MAP = {'N': 1.55, 'C': 1.70, 'CA': 1.70}\n    ATOM_RADII = np.array([VDW_RADII_MAP[label] for label in ATOM_LABELS])\n\n    # Bond lengths for mean structure (Å)\n    BOND_N_CA = 1.46\n    BOND_CA_C = 1.52\n    BOND_C_N_PEPTIDE = 1.33\n\n    # Test cases: (k, M, s, alpha)\n    test_cases = [\n        (2, 200, 1.0, 1.0),\n        (1, 200, 0.5, 1.0),\n        (18, 200, 0.0, 1.0),\n        (4, 200, 3.0, 1.0),\n    ]\n\n    #\n    # --- STEP 1: GENERATE TRAINING ENSEMBLE ---\n    #\n    # Define a simple, reproducible mean structure (linear along x-axis)\n    mean_structure_coords = np.zeros((N, 3))\n    x_pos = 0.0\n    mean_structure_coords[1] = [x_pos := x_pos + BOND_N_CA, 0, 0]\n    mean_structure_coords[2] = [x_pos := x_pos + BOND_CA_C, 0, 0]\n    mean_structure_coords[3] = [x_pos := x_pos + BOND_C_N_PEPTIDE, 0, 0]\n    mean_structure_coords[4] = [x_pos := x_pos + BOND_N_CA, 0, 0]\n    mean_structure_coords[5] = [x_pos := x_pos + BOND_CA_C, 0, 0]\n    \n    rng_ensemble = np.random.default_rng(RANDOM_SEED)\n\n    ensemble_matrix_X = np.zeros((T, N * 3))\n\n    for i in range(T):\n        # Generate random z-rotation\n        theta = rng_ensemble.normal(0, ROT_NOISE_STD)\n        cos_t, sin_t = np.cos(theta), np.sin(theta)\n        rotation_matrix = np.array([\n            [cos_t, -sin_t, 0],\n            [sin_t, cos_t, 0],\n            [0, 0, 1]\n        ])\n        \n        # Apply rotation to the mean structure\n        rotated_coords = mean_structure_coords @ rotation_matrix.T\n        \n        # Add independent Gaussian positional noise\n        noise = rng_ensemble.normal(0, POS_NOISE_STD, size=(N, 3))\n        perturbed_coords = rotated_coords + noise\n        \n        # Store flattened coordinates\n        ensemble_matrix_X[i, :] = perturbed_coords.flatten()\n\n    #\n    # --- STEP 2: PERFORM PRINCIPAL COMPONENT ANALYSIS ---\n    #\n    # Compute mean conformation and mean-free data\n    mean_conformation = np.mean(ensemble_matrix_X, axis=0)\n    mean_free_X = ensemble_matrix_X - mean_conformation\n\n    # Compute covariance matrix\n    # Using T-1 for the unbiased sample covariance estimator\n    covariance_matrix = (mean_free_X.T @ mean_free_X) / (T - 1)\n    \n    # Eigen-decomposition of the symmetric covariance matrix\n    # np.linalg.eigh returns eigenvalues in ascending order, so we reverse them\n    eigenvalues, eigenvectors = np.linalg.eigh(covariance_matrix)\n    \n    # Sort eigenvalues and eigenvectors in descending order\n    sorted_indices = np.argsort(eigenvalues)[::-1]\n    sorted_eigenvalues = eigenvalues[sorted_indices]\n    sorted_eigenvectors = eigenvectors[:, sorted_indices]\n\n    results = []\n    \n    rng_sampling = np.random.default_rng(RANDOM_SEED + 1) # Separate RNG for sampling\n\n    #\n    # --- STEPS 3  4: SAMPLING, BACK-MAPPING, AND FILTERING LOOP ---\n    #\n    for k, M, s, alpha in test_cases:\n        passed_count = 0\n        for _ in range(M):\n            # Step 3: Sample in PC space and back-map\n            \n            # Sample coefficients for the top k components\n            # Handle s=0 case where variance is 0, avoiding sqrt of negative tiny numbers\n            stdevs = np.sqrt(np.maximum(0, s * sorted_eigenvalues[:k]))\n            coeffs = rng_sampling.normal(0, stdevs)\n\n            # Reconstruct mean-free conformation\n            mean_free_synth = sorted_eigenvectors[:, :k] @ coeffs\n            \n            # Add mean to get full conformation\n            synth_conformation_flat = mean_free_synth + mean_conformation\n            synth_conformation = synth_conformation_flat.reshape((N, 3))\n\n            # Step 4: Steric filtering\n            is_valid = True\n            for i in range(N):\n                for j in range(i + 1, N):\n                    # Check only pairs with graph distance = 3\n                    if abs(i - j) = 3:\n                        dist_sq = np.sum((synth_conformation[i] - synth_conformation[j])**2)\n                        min_dist_sq = (alpha * (ATOM_RADII[i] + ATOM_RADII[j]))**2\n                        \n                        if dist_sq  min_dist_sq:\n                            is_valid = False\n                            break\n                if not is_valid:\n                    break\n            \n            if is_valid:\n                passed_count += 1\n        \n        acceptance_fraction = passed_count / M\n        results.append(acceptance_fraction)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}