{
    "hands_on_practices": [
        {
            "introduction": "In building a computational model of a complex biomolecular system, such as a protein binding to a drug molecule, we face a combinatorial explosion of atom-atom interactions. While parameters for like-atom interactions (e.g., C-C, O-O) are carefully optimized, experimentally parameterizing every possible cross-interaction (e.g., C-O, N-H) is intractable. This practice introduces the use of combining rules, such as the Lorentz-Berthelot rules, which provide a physically motivated and computationally efficient method to estimate these cross-interaction parameters, a foundational skill in force field development and application .",
            "id": "3869504",
            "problem": "In parameterizing nonbonded interactions for Molecular Mechanics (MM) simulations used in Computational Chemical Biology (CCB), an oxygen atom in a protein side chain and a carbon atom in a ligand are modeled with a pairwise-additive Lennard–Jones (LJ) interaction. The Lennard–Jones potential is a short-ranged model for van der Waals forces that supplements the long-ranged London dispersion attraction with a steep repulsion at short distances. In many force fields, unlike atoms are combined via mixing rules that are widely used and empirically validated for cross-interactions.\n\nYou are given the like-atom Lennard–Jones parameters for oxygen and carbon as follows: for oxygen, $\\sigma_{\\mathrm{O}} = 3.1$ angstrom and $\\epsilon_{\\mathrm{O}} = 0.12$ kcal/mol; for carbon, $\\sigma_{\\mathrm{C}} = 3.5$ angstrom and $\\epsilon_{\\mathrm{C}} = 0.07$ kcal/mol. Using the standard Lorentz–Berthelot combining rules applied in molecular simulations, determine the mixed Lennard–Jones parameters $\\sigma_{ij}$ and $\\epsilon_{ij}$ for the oxygen–carbon pair suitable for cross-interactions in a protein–ligand complex.\n\nReport your final result as the ordered pair $\\left(\\sigma_{ij}, \\epsilon_{ij}\\right)$, where $\\sigma_{ij}$ is expressed in angstrom and $\\epsilon_{ij}$ is expressed in kcal/mol. Round each value to four significant figures. Provide no derivation in the final answer.",
            "solution": "The problem statement has been evaluated and is determined to be valid. It is scientifically grounded, well-posed, and provides all necessary information to arrive at a unique and meaningful solution. The problem is a standard exercise in the application of empirical combining rules for Lennard-Jones parameters, a fundamental concept in the development and use of molecular mechanics force fields in computational chemical biology.\n\nThe Lennard-Jones (LJ) potential, $V_{LJ}(r)$, for the interaction between two atoms $i$ and $j$ separated by a distance $r$, is typically expressed as:\n$$V_{LJ}(r) = 4 \\epsilon_{ij} \\left[ \\left(\\frac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r}\\right)^{6} \\right]$$\nHere, $\\epsilon_{ij}$ represents the depth of the potential well (the energy minimum), and $\\sigma_{ij}$ is the finite distance at which the inter-particle potential is zero. For interactions between identical atoms (like-like interactions, e.g., O-O or C-C), the parameters $\\epsilon_{ii}$ and $\\sigma_{ii}$ are typically derived from fits to experimental data or high-level quantum mechanical calculations.\n\nFor interactions between dissimilar atoms (cross-interactions, e.g., O-C), the parameters are commonly estimated using combining rules rather than being individually parameterized. The problem specifies the use of the Lorentz-Berthelot combining rules, which are a standard choice in many classical force fields.\n\nThe given parameters for the like-like interactions are:\nFor the oxygen atom (O), let's denote it as atom $i$:\n$$ \\sigma_{ii} = \\sigma_{\\mathrm{O}} = 3.1 \\, \\text{angstrom} $$\n$$ \\epsilon_{ii} = \\epsilon_{\\mathrm{O}} = 0.12 \\, \\text{kcal/mol} $$\n\nFor the carbon atom (C), let's denote it as atom $j$:\n$$ \\sigma_{jj} = \\sigma_{\\mathrm{C}} = 3.5 \\, \\text{angstrom} $$\n$$ \\epsilon_{jj} = \\epsilon_{\\mathrm{C}} = 0.07 \\, \\text{kcal/mol} $$\n\nThe Lorentz-Berthelot combining rules are defined as follows:\n1.  The Lorentz rule for the size parameter, $\\sigma_{ij}$, is an arithmetic mean:\n    $$ \\sigma_{ij} = \\frac{\\sigma_{ii} + \\sigma_{jj}}{2} $$\n2.  The Berthelot rule for the energy parameter, $\\epsilon_{ij}$, is a geometric mean:\n    $$ \\epsilon_{ij} = \\sqrt{\\epsilon_{ii} \\epsilon_{jj}} $$\n\nWe will now apply these rules to calculate the cross-interaction parameters for the oxygen-carbon pair, which we denote as $\\sigma_{\\mathrm{OC}}$ and $\\epsilon_{\\mathrm{OC}}$.\n\nFirst, we calculate the size parameter $\\sigma_{\\mathrm{OC}}$ using the Lorentz rule:\n$$ \\sigma_{\\mathrm{OC}} = \\frac{\\sigma_{\\mathrm{O}} + \\sigma_{\\mathrm{C}}}{2} = \\frac{3.1 + 3.5}{2} \\, \\text{angstrom} $$\n$$ \\sigma_{\\mathrm{OC}} = \\frac{6.6}{2} \\, \\text{angstrom} = 3.3 \\, \\text{angstrom} $$\n\nNext, we calculate the energy parameter $\\epsilon_{\\mathrm{OC}}$ using the Berthelot rule:\n$$ \\epsilon_{\\mathrm{OC}} = \\sqrt{\\epsilon_{\\mathrm{O}} \\epsilon_{\\mathrm{C}}} = \\sqrt{(0.12) \\cdot (0.07)} \\, \\text{kcal/mol} $$\n$$ \\epsilon_{\\mathrm{OC}} = \\sqrt{0.0084} \\, \\text{kcal/mol} $$\n$$ \\epsilon_{\\mathrm{OC}} \\approx 0.091651513899... \\, \\text{kcal/mol} $$\n\nThe problem requires that the final values be rounded to four significant figures.\nFor $\\sigma_{\\mathrm{OC}}$, the value is exactly $3.3$. To express this to four significant figures, we write it as $3.300$.\n$$ \\sigma_{\\mathrm{OC}} = 3.300 \\, \\text{angstrom} $$\n\nFor $\\epsilon_{\\mathrm{OC}}$, we round the calculated value to four significant figures. The first four significant figures are $9$, $1$, $6$, and $5$. The fifth significant figure is $1$, which is less than $5$, so we round down (i.e., truncate at the fifth figure).\n$$ \\epsilon_{\\mathrm{OC}} \\approx 0.09165 \\, \\text{kcal/mol} $$\n\nTherefore, the mixed Lennard-Jones parameters for the oxygen-carbon pair are $\\sigma_{\\mathrm{OC}} = 3.300 \\, \\text{angstrom}$ and $\\epsilon_{\\mathrm{OC}} = 0.09165 \\, \\text{kcal/mol}$. The final result reported as the ordered pair $(\\sigma_{ij}, \\epsilon_{ij})$ is $(3.300, 0.09165)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.300 & 0.09165\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The shape of a potential energy function does more than just define interaction strengths; it dictates the dynamics of the system. The steepness of the Lennard-Jones potential's repulsive wall, for instance, corresponds to very high-frequency atomic vibrations. This analytical exercise connects the static features of the potential, such as its curvature at the energy minimum, to the dynamic timescale of atomic motion and, critically, to the maximum stable time step ($\\Delta t_{\\max}$) that can be used in a molecular dynamics simulation . Understanding this link is essential for designing stable and efficient simulations.",
            "id": "3869569",
            "problem": "In a Molecular Dynamics (MD) simulation of two identical noble-gas atoms of mass $m$ interacting via the Lennard–Jones (LJ) pair potential $U(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$, consider small-amplitude radial oscillations about the equilibrium separation. Starting from Newton’s second law and the definition of force from a potential, carry out the following steps without invoking any unproven shortcut formulas:\n\n1. Derive the analytic expression for the radial pair force $F(r)$ defined by $F(r)=-\\frac{dU}{dr}$ as a function of $r$, $\\epsilon$, and $\\sigma$.\n2. Determine the equilibrium separation $r_{m}$ by solving $\\frac{dU}{dr}=0$.\n3. Linearize the relative motion about $r_{m}$ to obtain the harmonic frequency $\\omega$ in terms of the reduced mass $\\mu$ and the curvature $U''(r_{m})$ of the potential at the minimum. For two identical masses $m$, use $\\mu=\\frac{m}{2}$.\n4. Using the well-tested linear stability bound for the velocity Verlet integrator applied to a harmonic oscillator, namely that stability requires $\\omega\\,\\Delta t<2$, deduce the maximum stable time step $\\Delta t_{\\max}$ in terms of $m$, $\\epsilon$, and $\\sigma$.\n\nExpress your final answer as a single closed-form analytic expression for $\\Delta t_{\\max}$ in seconds. Do not include units in the boxed answer. No numerical substitution is required. You may keep constants symbolically (e.g., powers of $2$).",
            "solution": "The problem requires a four-step derivation to find the maximum stable time step, $\\Delta t_{\\max}$, for a Molecular Dynamics simulation of two identical noble-gas atoms interacting via a Lennard-Jones potential. Each step will be addressed in sequence. The system consists of two atoms of mass $m$. Their interaction is described by the potential $U(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$.\n\nStep $1$: Derive the analytic expression for the radial pair force $F(r)$.\n\nThe force is defined as the negative gradient of the potential, $F(r) = -\\frac{dU}{dr}$. We begin by writing the potential $U(r)$ in a form more amenable to differentiation:\n$$U(r) = 4\\epsilon\\left(\\sigma^{12}r^{-12} - \\sigma^{6}r^{-6}\\right)$$\nTaking the derivative with respect to the interatomic distance $r$:\n$$\\frac{dU}{dr} = 4\\epsilon\\left(\\sigma^{12}(-12)r^{-13} - \\sigma^{6}(-6)r^{-7}\\right)$$\n$$\\frac{dU}{dr} = 4\\epsilon\\left(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}\\right)$$\nThe force $F(r)$ is therefore:\n$$F(r) = -\\frac{dU}{dr} = -4\\epsilon\\left(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}\\right)$$\n$$F(r) = 48\\epsilon\\sigma^{12}r^{-13} - 24\\epsilon\\sigma^{6}r^{-7}$$\nThis expression can be factored for clarity:\n$$F(r) = \\frac{24\\epsilon}{r}\\left[2\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$$\n\nStep $2$: Determine the equilibrium separation $r_{m}$.\n\nThe equilibrium separation $r_m$ is the distance at which the net force between the atoms is zero, which corresponds to the minimum of the potential energy curve. We find this by setting the first derivative of the potential to zero:\n$$\\frac{dU}{dr}\\bigg|_{r=r_m} = 0$$\nUsing the expression for $\\frac{dU}{dr}$ from Step $1$:\n$$4\\epsilon\\left(-12\\sigma^{12}r_m^{-13} + 6\\sigma^{6}r_m^{-7}\\right) = 0$$\nSince the parameters $4$ and $\\epsilon$ are non-zero, the term in the parentheses must be zero:\n$$-12\\sigma^{12}r_m^{-13} + 6\\sigma^{6}r_m^{-7} = 0$$\n$$6\\sigma^{6}r_m^{-7} = 12\\sigma^{12}r_m^{-13}$$\nAssuming $\\sigma \\neq 0$ and $r_m \\neq 0$, we can divide by $6\\sigma^6 r_m^{-13}$:\n$$r_m^{6} = 2\\sigma^{6}$$\nTaking the sixth root of both sides gives the equilibrium separation:\n$$r_m = (2\\sigma^6)^{1/6} = 2^{1/6}\\sigma$$\n\nStep $3$: Linearize the motion to obtain the harmonic frequency $\\omega$.\n\nFor small-amplitude oscillations around the equilibrium separation $r_m$, the potential can be approximated by a quadratic function (a parabola), which describes a simple harmonic oscillator. The potential energy is expanded in a Taylor series about $r=r_m$:\n$$U(r) \\approx U(r_m) + U'(r_m)(r-r_m) + \\frac{1}{2}U''(r_m)(r-r_m)^2 + \\dots$$\nSince $r_m$ is the equilibrium position, the first derivative $U'(r_m) = -F(r_m)$ is zero. Letting $x = r - r_m$ be the small displacement from equilibrium, the potential energy, ignoring the constant offset $U(r_m)$, becomes $U(x) \\approx \\frac{1}{2}kx^2$, where the effective spring constant $k$ is the curvature of the potential at $r_m$:\n$$k = U''(r_m) = \\frac{d^2U}{dr^2}\\bigg|_{r=r_m}$$\nWe first compute the second derivative of $U(r)$:\n$$U''(r) = \\frac{d}{dr}\\left(4\\epsilon(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7})\\right) = 4\\epsilon\\left((-12)(-13)\\sigma^{12}r^{-14} + (6)(-7)\\sigma^{6}r^{-8}\\right)$$\n$$U''(r) = 4\\epsilon\\left(156\\sigma^{12}r^{-14} - 42\\sigma^{6}r^{-8}\\right)$$\nNow we evaluate this at $r=r_m$. Using the relation $r_m^6 = 2\\sigma^6$:\n$$k = U''(r_m) = 4\\epsilon\\left(156\\frac{\\sigma^{12}}{r_m^{14}} - 42\\frac{\\sigma^{6}}{r_m^{8}}\\right) = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{\\sigma^{12}}{(r_m^6)^2} - 42\\frac{\\sigma^{6}}{r_m^6}\\right)$$\n$$k = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{\\sigma^{12}}{(2\\sigma^6)^2} - 42\\frac{\\sigma^{6}}{2\\sigma^6}\\right) = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{1}{4} - 42\\frac{1}{2}\\right) = \\frac{4\\epsilon}{r_m^2}(39 - 21) = \\frac{72\\epsilon}{r_m^2}$$\nSubstituting $r_m^2 = (2^{1/6}\\sigma)^2 = 2^{1/3}\\sigma^2$:\n$$k = \\frac{72\\epsilon}{2^{1/3}\\sigma^2}$$\nThe motion of this two-body system is equivalent to that of a single particle with reduced mass $\\mu$ under the potential $U(r)$. For two identical masses $m$, the reduced mass is $\\mu = \\frac{m \\cdot m}{m+m} = \\frac{m}{2}$. The angular frequency $\\omega$ of the harmonic oscillator is given by $\\omega = \\sqrt{k/\\mu}$.\n$$\\omega^2 = \\frac{k}{\\mu} = \\frac{72\\epsilon}{2^{1/3}\\sigma^2} \\cdot \\frac{1}{m/2} = \\frac{144\\epsilon}{m\\sigma^2 2^{1/3}}$$\nTaking the square root to find $\\omega$:\n$$\\omega = \\sqrt{\\frac{144\\epsilon}{m\\sigma^2 2^{1/3}}} = \\frac{12}{\\sigma\\sqrt{m}}\\sqrt{\\frac{\\epsilon}{2^{1/3}}} = \\frac{12 \\cdot 2^{-1/6}}{\\sigma}\\sqrt{\\frac{\\epsilon}{m}}$$\n\nStep $4$: Deduce the maximum stable time step $\\Delta t_{\\max}$.\n\nThe problem provides the stability bound for the velocity Verlet integrator applied to a harmonic oscillator: $\\omega \\Delta t < 2$. The maximum stable time step $\\Delta t_{\\max}$ is the value of $\\Delta t$ at the boundary of this inequality.\n$$\\Delta t_{\\max} = \\frac{2}{\\omega}$$\nSubstituting the expression for $\\omega$ derived in Step $3$:\n$$\\Delta t_{\\max} = \\frac{2}{\\frac{12 \\cdot 2^{-1/6}}{\\sigma}\\sqrt{\\frac{\\epsilon}{m}}} = \\frac{2\\sigma}{12 \\cdot 2^{-1/6}}\\sqrt{\\frac{m}{\\epsilon}}$$\nSimplifying the expression:\n$$\\Delta t_{\\max} = \\frac{\\sigma}{6 \\cdot 2^{-1/6}}\\sqrt{\\frac{m}{\\epsilon}} = \\frac{2^{1/6}\\sigma}{6}\\sqrt{\\frac{m}{\\epsilon}}$$\nThis is the final analytical expression for the maximum stable time step. If the parameters $m$, $\\epsilon$, and $\\sigma$ are provided in SI units (kilograms, joules, and meters, respectively), the resulting $\\Delta t_{\\max}$ will be in seconds.",
            "answer": "$$\n\\boxed{\\frac{2^{1/6}}{6}\\sigma\\sqrt{\\frac{m}{\\epsilon}}}\n$$"
        },
        {
            "introduction": "Simulating large biomolecular systems requires computational efficiency, which is often achieved by truncating nonbonded interactions beyond a certain cutoff distance. However, a naive \"hard\" truncation creates an unphysical discontinuity in the force, leading to poor energy conservation and simulation artifacts. This hands-on coding practice guides you through the design and implementation of a smooth switching function, a sophisticated technique used in modern simulation packages to gently turn off the interaction, ensuring that both the potential and the force go to zero smoothly at the cutoff . This exercise demonstrates how to engineer a more physically sound and stable computational model.",
            "id": "3869576",
            "problem": "In computational chemical biology, nonbonded interactions such as van der Waals forces are commonly modeled using the Lennard–Jones potential, and truncated at a finite radius to reduce computational cost. Truncation without smoothing introduces discontinuities in the potential or force that can yield unphysical artifacts. Your task is to construct and analyze a smooth switching scheme that attenuates the Lennard–Jones interaction in a physically principled way.\n\nGiven a Lennard–Jones potential $U_{\\mathrm{LJ}}(r)$ between two particles separated by distance $r$ defined by the widely used form\n$$\nU_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^6 \\right],\n$$\nand its corresponding radial force $F_{\\mathrm{LJ}}(r)$ defined by the negative derivative with respect to $r$,\n$$\nF_{\\mathrm{LJ}}(r) = -\\frac{d U_{\\mathrm{LJ}}(r)}{dr},\n$$\ndesign a smooth scalar switching function $S(r)$ on the interval $[r_{\\mathrm{on}}, r_c]$ that satisfies the boundary conditions\n- $S(r_{\\mathrm{on}}) = 1$,\n- $S'(r_{\\mathrm{on}}) = 0$,\n- $S(r_c) = 0$,\n- $S'(r_c) = 0$,\nand is extended piecewise by $S(r) = 1$ for $r \\le r_{\\mathrm{on}}$ and $S(r) = 0$ for $r \\ge r_c$.\n\nUse this $S(r)$ to define a switched potential $U_{\\mathrm{sw}}(r) = S(r) \\, U_{\\mathrm{LJ}}(r)$ and a switched force $F_{\\mathrm{sw}}(r)$ given by the radial negative derivative of $U_{\\mathrm{sw}}(r)$. Analyze the impact of switching on force artifacts by computing the following metrics over the interval $[r_{\\mathrm{on}}, r_c]$:\n1. The maximum absolute force deviation\n$$\n\\Delta F_{\\max} = \\max_{r \\in [r_{\\mathrm{on}}, r_c]} \\left| F_{\\mathrm{sw}}(r) - F_{\\mathrm{LJ}}(r) \\right| \\quad \\text{in } \\mathrm{kJ\\, mol^{-1}\\, nm^{-1}}.\n$$\n2. The integral of absolute force deviation\n$$\nI_{\\Delta F} = \\int_{r_{\\mathrm{on}}}^{r_c} \\left| F_{\\mathrm{sw}}(r) - F_{\\mathrm{LJ}}(r) \\right| \\, dr \\quad \\text{in } \\mathrm{kJ\\, mol^{-1}}.\n$$\n3. A boolean continuity check $C$ that is true if and only if $S(r_{\\mathrm{on}})=1$, $S'(r_{\\mathrm{on}})=0$, $S(r_c)=0$, and $S'(r_c)=0$ are simultaneously satisfied within a numerical tolerance of $10^{-10}$.\n4. A boolean monotonicity check $M$ that is true if and only if the number of sign changes in the discrete derivative of $F_{\\mathrm{sw}}(r)$ across $[r_{\\mathrm{on}}, r_c]$ matches that of $F_{\\mathrm{LJ}}(r)$, indicating no extra extrema introduced by switching.\n\nAll distances must be expressed in nanometers (nm), energies in kilojoules per mole ($\\mathrm{kJ\\, mol^{-1}}$), and forces in kilojoules per mole per nanometer ($\\mathrm{kJ\\, mol^{-1}\\, nm^{-1}}$). Angles do not appear in this problem. Express all floating-point outputs rounded to $6$ decimal places.\n\nImplement your analysis as a complete program that evaluates these metrics for the following test suite of parameter sets $(\\varepsilon, \\sigma, r_{\\mathrm{on}}, r_c, \\Delta r)$, where $\\Delta r$ is the radial discretization step in nanometers:\n- Test $1$ (general case): $(\\varepsilon = 0.5\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.34\\, \\mathrm{nm}, r_{\\mathrm{on}} = 0.8\\, \\mathrm{nm}, r_c = 1.2\\, \\mathrm{nm}, \\Delta r = 0.001\\, \\mathrm{nm})$.\n- Test $2$ (narrow switching region): $(\\varepsilon = 0.5\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.34\\, \\mathrm{nm}, r_{\\mathrm{on}} = 1.19\\, \\mathrm{nm}, r_c = 1.2\\, \\mathrm{nm}, \\Delta r = 0.0001\\, \\mathrm{nm})$.\n- Test $3$ (switch spanning repulsive-to-attractive transition): $(\\varepsilon = 1.0\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.38\\, \\mathrm{nm}, r_{\\mathrm{on}} = 0.35\\, \\mathrm{nm}, r_c = 0.5\\, \\mathrm{nm}, \\Delta r = 0.0005\\, \\mathrm{nm})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of per-test-case lists, each in the form\n$[\\Delta F_{\\max}, I_{\\Delta F}, C, M]$, rounded to $6$ decimal places for the floating-point values. For example, the final output format must be\n$[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3]]$\nwith no spaces.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded, well-posed, and objective. It presents a standard and relevant task in computational chemistry: the design and analysis of a switching function to smoothly truncate a potential, specifically the Lennard-Jones potential. The problem requires the solver to select a suitable functional form for the switching function that satisfies a set of boundary conditions, a common practice in physics and engineering problem-solving. The provided parameters and metrics for evaluation are physically meaningful and computationally tractable.\n\nThe solution proceeds as follows: first, a suitable analytical form for the switching function $S(r)$ is designed. Second, the expressions for the switched potential $U_{\\mathrm{sw}}(r)$ and switched force $F_{\\mathrm{sw}}(r)$ are derived. Third, the computational methodology for evaluating the specified metrics ($\\Delta F_{\\max}$, $I_{\\Delta F}$, $C$, and $M$) is detailed.\n\n**1. Design of the Switching Function $S(r)$**\n\nThe problem requires a smooth scalar switching function $S(r)$ on the interval $[r_{\\mathrm{on}}, r_c]$ that satisfies four boundary conditions: $S(r_{\\mathrm{on}}) = 1$, $S'(r_{\\mathrm{on}}) = 0$, $S(r_c) = 0$, and $S'(r_c) = 0$. These conditions ensure that the switched potential $U_{\\mathrm{sw}}(r)$ and its corresponding force $F_{\\mathrm{sw}}(r)$ are continuous and have continuous first derivatives at the boundaries $r_{\\mathrm{on}}$ and $r_c$.\n\nA cubic polynomial is the simplest polynomial form that can satisfy these four constraints. Let us define a normalized variable $x$ that maps the interval $[r_{\\mathrm{on}}, r_c]$ to $[0, 1]$:\n$$\nx(r) = \\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}}\n$$\nThe boundary conditions in terms of $x$ become: $S(x=0) = 1$, $S'(x=0) = 0$, $S(x=1) = 0$, and $S'(x=1) = 0$. Note that $S'(x) = \\frac{dS}{dr} \\frac{dr}{dx}$ must be zero, and since $\\frac{dr}{dx} = r_c - r_{\\mathrm{on}} \\ne 0$, this requires $\\frac{dS}{dx} = 0$ at $x=0$ and $x=1$.\n\nLet the polynomial be $S(x) = ax^3 + bx^2 + cx + d$. Its derivative is $\\frac{dS}{dx} = 3ax^2 + 2bx + c$.\nApplying the boundary conditions:\n1. $S(0) = d = 1$\n2. $\\frac{dS}{dx}(0) = c = 0$\n3. $S(1) = a + b + c + d = a + b + 0 + 1 = 0 \\implies a + b = -1$\n4. $\\frac{dS}{dx}(1) = 3a + 2b + c = 3a + 2b = 0$\n\nSolving the system of linear equations for $a$ and $b$:\nFrom $a+b=-1$, we have $a = -1-b$. Substituting into the second equation gives $3(-1-b) + 2b = 0 \\implies -3 - 3b + 2b = 0 \\implies b = -3$.\nThen, $a = -1 - (-3) = 2$.\nThe resulting polynomial is:\n$$\nS(x) = 2x^3 - 3x^2 + 1\n$$\nThis form is uniquely determined by the boundary conditions. The full piecewise switching function $S(r)$ is:\n$$\nS(r) =\n\\begin{cases}\n1 & \\text{if } r \\le r_{\\mathrm{on}} \\\\\n2x(r)^3 - 3x(r)^2 + 1 & \\text{if } r_{\\mathrm{on}} < r < r_c \\\\\n0 & \\text{if } r \\ge r_c\n\\end{cases}\n$$\nwhere $x(r) = (r - r_{\\mathrm{on}}) / (r_c - r_{\\mathrm{on}})$.\n\n**2. Derivation of Force Expressions**\n\nThe Lennard-Jones potential is given as:\n$$\nU_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^6 \\right]\n$$\nThe corresponding force $F_{\\mathrm{LJ}}(r)$ is its negative radial derivative:\n$$\nF_{\\mathrm{LJ}}(r) = -\\frac{d U_{\\mathrm{LJ}}(r)}{dr} = -4\\varepsilon \\left[ \\sigma^{12}(-12)r^{-13} - \\sigma^{6}(-6)r^{-7} \\right] = 24\\varepsilon \\left[ 2 \\frac{\\sigma^{12}}{r^{13}} - \\frac{\\sigma^{6}}{r^7} \\right]\n$$\nThe switched potential is $U_{\\mathrm{sw}}(r) = S(r) U_{\\mathrm{LJ}}(r)$. The switched force $F_{\\mathrm{sw}}(r)$ is the negative derivative of $U_{\\mathrm{sw}}(r)$:\n$$\nF_{\\mathrm{sw}}(r) = -\\frac{d}{dr} \\left[ S(r) U_{\\mathrm{LJ}}(r) \\right]\n$$\nUsing the product rule:\n$$\nF_{\\mathrm{sw}}(r) = - \\left( \\frac{dS(r)}{dr} U_{\\mathrm{LJ}}(r) + S(r) \\frac{d U_{\\mathrm{LJ}}(r)}{dr} \\right)\n$$\nSubstituting $F_{\\mathrm{LJ}}(r) = - \\frac{d U_{\\mathrm{LJ}}(r)}{dr}$, we obtain the expression for the switched force:\n$$\nF_{\\mathrm{sw}}(r) = S(r) F_{\\mathrm{LJ}}(r) - S'(r) U_{\\mathrm{LJ}}(r)\n$$\nwhere $S'(r) = \\frac{dS(r)}{dr}$. Using the chain rule, $S'(r) = \\frac{dS}{dx} \\frac{dx}{dr}$.\n$\\frac{dx}{dr} = \\frac{1}{r_c - r_{\\mathrm{on}}}$.\n$\\frac{dS}{dx} = 6x^2 - 6x$.\nSo, for $r \\in [r_{\\mathrm{on}}, r_c]$:\n$$\nS'(r) = \\frac{6x(x-1)}{r_c - r_{\\mathrm{on}}} = \\frac{6 \\left(\\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}}\\right) \\left(\\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}} - 1\\right)}{r_c - r_{\\mathrm{on}}} = \\frac{6(r-r_{\\mathrm{on}})(r-r_c)}{(r_c-r_{\\mathrm{on}})^3}\n$$\nOutside this interval, $S'(r) = 0$.\n\n**3. Computational Methodology**\n\nFor each test case, the interval $[r_{\\mathrm{on}}, r_c]$ is discretized into a grid of points $r_i$ with spacing $\\Delta r$. The required functions ($U_{\\mathrm{LJ}}$, $F_{\\mathrm{LJ}}$, $S$, $S'$, $F_{\\mathrm{sw}}$) are evaluated on this grid.\n\n1.  **Maximum Absolute Force Deviation, $\\Delta F_{\\max}$**:\n    The force deviation is computed at each grid point $r_i$ as $\\Delta F(r_i) = |F_{\\mathrm{sw}}(r_i) - F_{\\mathrm{LJ}}(r_i)|$. The maximum of these values is $\\Delta F_{\\max}$.\n    $$\n    \\Delta F_{\\max} = \\max_{i} \\left| F_{\\mathrm{sw}}(r_i) - F_{\\mathrm{LJ}}(r_i) \\right|\n    $$\n\n2.  **Integral of Absolute Force Deviation, $I_{\\Delta F}$**:\n    This integral is computed numerically over the grid using the trapezoidal rule, which is a suitable and standard method for numerical integration of discretized functions.\n    $$\n    I_{\\Delta F} = \\int_{r_{\\mathrm{on}}}^{r_c} |\\Delta F(r)| \\, dr \\approx \\sum_{i=1}^{N-1} \\frac{|\\Delta F(r_i)| + |\\Delta F(r_{i+1})|}{2} (r_{i+1} - r_i)\n    $$\n    This is implemented using `numpy.trapz`.\n\n3.  **Continuity Check, $C$**:\n    This boolean metric verifies that the designed switching function $S(r)$ meets its boundary conditions. The check is performed on the analytical expressions for $S(r)$ and $S'(r)$ at $r=r_{\\mathrm{on}}$ and $r=r_c$. The results are compared to their target values ($1$ or $0$) within a numerical tolerance of $10^{-10}$.\n    $C = (|S(r_{\\mathrm{on}})-1| < 10^{-10}) \\land (|S'(r_{\\mathrm{on}})-0| < 10^{-10}) \\land (|S(r_c)-0| < 10^{-10}) \\land (|S'(r_c)-0| < 10^{-10})$.\n    Given our analytical derivation, this check is expected to pass, serving as a validation of the implementation.\n\n4.  **Monotonicity Check, $M$**:\n    This check ensures that the switching function does not introduce unphysical oscillations (new extrema) in the force. This is done by comparing the number of sign changes in the discrete derivative of $F_{\\mathrm{sw}}(r)$ to that of $F_{\\mathrm{LJ}}(r)$ over the interval $[r_{\\mathrm{on}}, r_c]$. The discrete derivatives, $\\frac{dF}{dr}$, are computed using `numpy.gradient`. A helper function counts the number of times the sign of the derivative array changes.\n    - Compute $dF_{\\mathrm{LJ}}/dr$ and $dF_{\\mathrm{sw}}/dr$ on the grid.\n    - Count sign changes for each derivative array, ignoring zero-crossings.\n    - $M$ is true if and only if the two counts are identical.\n\nThe implementation will process each test case according to this methodology, collecting the four metrics and formatting them as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (epsilon, sigma, r_on, r_c, dr)\n        (0.5, 0.34, 0.8, 1.2, 0.001),     # Test 1\n        (0.5, 0.34, 1.19, 1.2, 0.0001),   # Test 2\n        (1.0, 0.38, 0.35, 0.5, 0.0005)    # Test 3\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_switching_scheme(*case)\n        results.append(result)\n\n    # Format the final output string as specified.\n    formatted_results = []\n    for r in results:\n        # Format: [Delta_F_max, I_Delta_F, C, M]\n        # Floats rounded to 6 decimal places. Booleans as True/False.\n        formatted_results.append(f\"[{r[0]:.6f},{r[1]:.6f},{r[2]},{r[3]}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef analyze_switching_scheme(epsilon, sigma, r_on, r_c, dr):\n    \"\"\"\n    Analyzes the switching scheme for a single set of parameters.\n\n    Args:\n        epsilon (float): LJ energy parameter (kJ/mol).\n        sigma (float): LJ distance parameter (nm).\n        r_on (float): Switching function turn-on distance (nm).\n        r_c (float): Cutoff distance (nm).\n        dr (float): Discretization step (nm).\n\n    Returns:\n        list: A list containing [Delta_F_max, I_Delta_F, C, M].\n    \"\"\"\n    # 1. Discretize the interval\n    # Use np.linspace for robust handling of floating point endpoints\n    num_points = int(round((r_c - r_on) / dr)) + 1\n    r_vals = np.linspace(r_on, r_c, num_points)\n\n    # 2. Define analytical functions\n    # Lennard-Jones Potential U_LJ(r)\n    def u_lj(r, eps, sig):\n        if np.any(r == 0):\n            # Handle potential division by zero, though problem constraints make this unlikely.\n            # Create a copy to avoid modifying the original array\n            r_safe = np.copy(r)\n            r_safe[r_safe == 0] = 1e-12 \n            sr6 = (sig / r_safe)**6\n        else:\n            sr6 = (sig / r)**6\n        return 4.0 * eps * (sr6**2 - sr6)\n\n    # Lennard-Jones Force F_LJ(r)\n    def f_lj(r, eps, sig):\n        if np.any(r == 0):\n            r_safe = np.copy(r)\n            r_safe[r_safe == 0] = 1e-12\n            sr6 = (sig / r_safe)**6\n        else:\n            sr6 = (sig / r)**6\n        return 24.0 * eps * (2.0 * sr6**2 - sr6) / r\n\n    # Switching function S(r) and its derivative S'(r)\n    def s_func_and_deriv(r, r_on_val, r_c_val):\n        s = np.zeros_like(r)\n        s_prime = np.zeros_like(r)\n        \n        mask = (r > r_on_val)  (r  r_c_val)\n        r_interval = r[mask]\n\n        delta_r_switch = r_c_val - r_on_val\n        x = (r_interval - r_on_val) / delta_r_switch\n        \n        s_poly = 2 * x**3 - 3 * x**2 + 1\n        s[mask] = s_poly\n        \n        s_prime_poly = (6 * x**2 - 6 * x) / delta_r_switch\n        s_prime[mask] = s_prime_poly\n\n        s[r = r_on_val] = 1.0\n        s[r >= r_c_val] = 0.0\n        # s_prime is already 0 outside the interval\n\n        return s, s_prime\n\n    # 3. Calculate functions on the grid for the interval [r_on, r_c]\n    u_lj_vals = u_lj(r_vals, epsilon, sigma)\n    f_lj_vals = f_lj(r_vals, epsilon, sigma)\n    s_vals, s_prime_vals = s_func_and_deriv(r_vals, r_on, r_c)\n    \n    # Switched force F_sw(r) = S(r)F_LJ(r) - S'(r)U_LJ(r)\n    f_sw_vals = s_vals * f_lj_vals - s_prime_vals * u_lj_vals\n\n    # 4. Compute metrics\n    # Metric 1: Maximum absolute force deviation\n    force_deviation = np.abs(f_sw_vals - f_lj_vals)\n    delta_f_max = np.max(force_deviation)\n\n    # Metric 2: Integral of absolute force deviation\n    i_delta_f = np.trapz(force_deviation, x=r_vals)\n\n    # Metric 3: Continuity check\n    tol = 1e-10\n    delta_r_switch = r_c - r_on\n    # Check at r_on\n    x_on = 0.0\n    s_at_ron = 2 * x_on**3 - 3 * x_on**2 + 1\n    s_prime_at_ron = (6 * x_on**2 - 6 * x_on) / delta_r_switch\n    # Check at r_c\n    x_c = 1.0\n    s_at_rc = 2 * x_c**3 - 3 * x_c**2 + 1\n    s_prime_at_rc = (6 * x_c**2 - 6 * x_c) / delta_r_switch\n    \n    c_check = (abs(s_at_ron - 1.0)  tol and\n               abs(s_prime_at_ron - 0.0)  tol and\n               abs(s_at_rc - 0.0)  tol and\n               abs(s_prime_at_rc - 0.0)  tol)\n\n    # Metric 4: Monotonicity check\n    def count_sign_changes(arr):\n        signs = np.sign(arr)\n        # Filter out zeros to correctly count changes, e.g., [-1, 0, 1] is one change\n        signs_nonzero = signs[signs != 0]\n        if len(signs_nonzero)  2:\n            return 0\n        return np.sum(signs_nonzero[:-1] != signs_nonzero[1:])\n\n    # Use np.gradient for a more accurate discrete derivative\n    dF_lj_dr = np.gradient(f_lj_vals, r_vals)\n    dF_sw_dr = np.gradient(f_sw_vals, r_vals)\n\n    num_changes_lj = count_sign_changes(dF_lj_dr)\n    num_changes_sw = count_sign_changes(dF_sw_dr)\n\n    m_check = (num_changes_lj == num_changes_sw)\n\n    return [delta_f_max, i_delta_f, c_check, m_check]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}