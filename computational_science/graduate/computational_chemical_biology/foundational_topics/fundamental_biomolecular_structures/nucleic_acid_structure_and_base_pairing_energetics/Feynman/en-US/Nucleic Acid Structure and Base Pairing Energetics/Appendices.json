{
    "hands_on_practices": [
        {
            "introduction": "To understand the stability of nucleic acid structures, we must first appreciate the nature of the forces holding them together. This exercise grounds the concept of hydrogen bonding in fundamental physics by modeling it as a simple electrostatic dipole-dipole interaction. By deriving the energy cost of breaking a single bond within a dielectric medium, you will gain a quantitative feel for the strength of these crucial interactions and their sensitivity to the solvent environment .",
            "id": "3857048",
            "problem": "Consider a guanine–cytosine base pair in which the three interbase hydrogen bonds are approximated as independent dipole–dipole interactions embedded in a uniform dielectric continuum. Model each hydrogen bond as an interaction between two identical point dipoles of magnitude $\\,\\mu\\,$ oriented colinearly along the donor–acceptor axis and separated by a center-to-center distance $\\,r\\,$. The solvent is treated as a linear, homogeneous dielectric with relative permittivity $\\,\\epsilon\\,$, and the vacuum permittivity is $\\,\\varepsilon_{0}\\,$. Assume the dipole–dipole interaction is the sole contributor to the hydrogen bond stabilization and neglect any coupling among the hydrogen bonds. Treat the intact guanine–cytosine base pair as having $\\,3\\,$ such identical dipole–dipole interactions; when one hydrogen bond is broken, only $\\,2\\,$ remain, with the geometry and magnitudes of the remaining dipoles unchanged.\n\nUsing only electrostatics based on Coulomb’s law, the definition of a point dipole, and continuum dielectric screening, derive the interaction energy for two colinear point dipoles in a medium of relative permittivity $\\,\\epsilon\\,$ and use it to compute the change in the total hydrogen-bond stabilization energy of the base pair upon breaking a single hydrogen bond. Define the energy change as\n$$\n\\Delta E(\\epsilon) \\equiv E_{\\text{broken}} - E_{\\text{intact}},\n$$\nwhere $\\,E_{\\text{intact}}\\,$ and $\\,E_{\\text{broken}}\\,$ are the total dipole–dipole stabilization energies with $\\,3\\,$ and $\\,2\\,$ hydrogen bonds, respectively. Provide your final result as a single closed-form expression for $\\,\\Delta E(\\epsilon)\\,$ in terms of $\\,\\mu\\,$, $\\,r\\,$, $\\,\\varepsilon_{0}\\,$, and $\\,\\epsilon\\,$. Express the energy in Joules. Do not substitute numerical values. The final answer must be a single analytic expression.",
            "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- **System:** Guanine–cytosine base pair with three interbase hydrogen bonds.\n- **Model:**\n    - Each hydrogen bond is approximated as an independent dipole–dipole interaction.\n    - Each interaction is between two identical point dipoles.\n    - Dipole magnitude: $\\mu$.\n    - Dipole orientation: Colinear along the donor–acceptor axis.\n    - Dipole separation (center-to-center): $r$.\n- **Environment:**\n    - Uniform dielectric continuum.\n    - Relative permittivity of the medium: $\\epsilon$.\n    - Vacuum permittivity: $\\varepsilon_{0}$.\n- **Assumptions:**\n    - Dipole–dipole interaction is the sole contributor to hydrogen bond stabilization.\n    - Coupling among the hydrogen bonds is neglected (energies are additive).\n    - Geometry and magnitudes of remaining dipoles are unchanged when a bond is broken.\n- **States:**\n    - Intact state: $3$ identical dipole-dipole interactions. Total energy is $E_{\\text{intact}}$.\n    - Broken state: $2$ identical dipole-dipole interactions. Total energy is $E_{\\text{broken}}$.\n- **Objective:**\n    - Derive the interaction energy for two colinear point dipoles.\n    - Compute the change in total hydrogen-bond stabilization energy: $\\Delta E(\\epsilon) \\equiv E_{\\text{broken}} - E_{\\text{intact}}$.\n    - Provide the result as a single closed-form expression in terms of $\\mu$, $r$, $\\varepsilon_{0}$, and $\\epsilon$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It employs a standard and simplified physical model (point dipoles in a dielectric continuum) commonly used in biophysics to approximate electrostatic interactions. The assumptions, such as additivity and unchanged geometry, are explicitly stated to make the problem tractable. All required parameters are defined, and the objective is clear and unambiguous. The problem is free from scientific flaws, contradictions, and non-formalizable elements. It is a valid theoretical physics problem within the domain of computational chemical biology.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe derivation proceeds in three parts: first, we determine the interaction energy of a single hydrogen bond as modeled; second, we calculate the total energy of the intact and broken states; and third, we compute the specified energy change.\n\n**Part 1: Interaction Energy of Two Colinear Point Dipoles**\n\nThe electrostatic potential $V_1$ generated by a point dipole $\\vec{\\mu}_1$ at a position $\\vec{x}$ in a linear, homogeneous dielectric medium with relative permittivity $\\epsilon$ is given by:\n$$\nV_1(\\vec{x}) = \\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\frac{\\vec{\\mu}_1 \\cdot \\vec{x}}{|\\vec{x}|^3}\n$$\nThe electric field $\\vec{E}_1$ is the negative gradient of the potential:\n$$\n\\vec{E}_1(\\vec{x}) = -\\nabla V_1(\\vec{x}) = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\nabla \\left( \\frac{\\vec{\\mu}_1 \\cdot \\vec{x}}{|\\vec{x}|^3} \\right)\n$$\nUsing the vector identity $\\nabla(\\frac{\\vec{A}\\cdot\\vec{B}}{C}) = \\frac{C(\\nabla(\\vec{A}\\cdot\\vec{B})) - (\\vec{A}\\cdot\\vec{B})\\nabla C}{C^2}$ and related gradient rules, the electric field of a dipole is found to be:\n$$\n\\vec{E}_1(\\vec{x}) = \\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{3(\\vec{\\mu}_1 \\cdot \\vec{x})\\vec{x}}{|\\vec{x}|^5} - \\frac{\\vec{\\mu}_1}{|\\vec{x}|^3} \\right)\n$$\nThe interaction energy $U$ of a second dipole $\\vec{\\mu}_2$ placed in this field at position $\\vec{x}$ is:\n$$\nU = -\\vec{\\mu}_2 \\cdot \\vec{E}_1(\\vec{x}) = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{3(\\vec{\\mu}_1 \\cdot \\vec{x})(\\vec{\\mu}_2 \\cdot \\vec{x})}{|\\vec{x}|^5} - \\frac{\\vec{\\mu}_1 \\cdot \\vec{\\mu}_2}{|\\vec{x}|^3} \\right)\n$$\nWe now apply the specific conditions of the problem. Let the first dipole $\\vec{\\mu}_1$ be at the origin and pointing along the $z$-axis. The second dipole $\\vec{\\mu}_2$ is at a distance $r$ along this same axis. Thus, we have:\n- Position vector of the second dipole: $\\vec{x} = r\\hat{k}$, where $\\hat{k}$ is the unit vector along the $z$-axis. The magnitude is $|\\vec{x}|=r$.\n- Dipoles are identical and colinear: $\\vec{\\mu}_1 = \\mu\\hat{k}$ and $\\vec{\\mu}_2 = \\mu\\hat{k}$. Their magnitudes are $|\\vec{\\mu}_1| = |\\vec{\\mu}_2| = \\mu$.\n\nWe compute the dot products:\n- $\\vec{\\mu}_1 \\cdot \\vec{\\mu}_2 = (\\mu\\hat{k}) \\cdot (\\mu\\hat{k}) = \\mu^2$\n- $\\vec{\\mu}_1 \\cdot \\vec{x} = (\\mu\\hat{k}) \\cdot (r\\hat{k}) = \\mu r$\n- $\\vec{\\mu}_2 \\cdot \\vec{x} = (\\mu\\hat{k}) \\cdot (r\\hat{k}) = \\mu r$\n\nSubstituting these into the general energy expression:\n$$\nU = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{3(\\mu r)(\\mu r)}{r^5} - \\frac{\\mu^2}{r^3} \\right)\n$$\n$$\nU = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{3\\mu^2 r^2}{r^5} - \\frac{\\mu^2}{r^3} \\right) = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{3\\mu^2}{r^3} - \\frac{\\mu^2}{r^3} \\right)\n$$\n$$\nU = -\\frac{1}{4\\pi\\varepsilon_0\\epsilon} \\left( \\frac{2\\mu^2}{r^3} \\right) = -\\frac{2\\mu^2}{4\\pi\\varepsilon_0\\epsilon r^3}\n$$\nSimplifying, the stabilization energy for a single hydrogen bond, $E_{\\text{H-bond}}$, is:\n$$\nE_{\\text{H-bond}} = -\\frac{\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3}\n$$\nThis energy is negative, indicating a stabilizing (attractive) interaction.\n\n**Part 2: Total Energy of Intact and Broken States**\n\nThe problem states that the hydrogen bonds are independent. Therefore, the total stabilization energy is the sum of the individual bond energies.\n- For the intact guanine–cytosine pair with $3$ hydrogen bonds:\n$$\nE_{\\text{intact}} = 3 \\times E_{\\text{H-bond}} = 3 \\left( -\\frac{\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} \\right) = -\\frac{3\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3}\n$$\n- For the state with one broken bond, leaving $2$ hydrogen bonds:\n$$\nE_{\\text{broken}} = 2 \\times E_{\\text{H-bond}} = 2 \\left( -\\frac{\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} \\right) = -\\frac{2\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3}\n$$\n\n**Part 3: Change in Stabilization Energy**\n\nThe problem defines the change in energy as $\\Delta E(\\epsilon) = E_{\\text{broken}} - E_{\\text{intact}}$.\n$$\n\\Delta E(\\epsilon) = \\left( -\\frac{2\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} \\right) - \\left( -\\frac{3\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} \\right)\n$$\n$$\n\\Delta E(\\epsilon) = \\frac{3\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} - \\frac{2\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3}\n$$\n$$\n\\Delta E(\\epsilon) = \\frac{(3-2)\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3} = \\frac{\\mu^2}{2\\pi\\varepsilon_0\\epsilon r^3}\n$$\nThe result is a positive energy change, corresponding to the energy cost required to break one hydrogen bond. This aligns with physical intuition, as breaking a stabilizing interaction should increase the total energy of the system. The derived expression is given in terms of the specified variables and fundamental constants. If all quantities were expressed in SI units, the resulting energy would be in Joules.",
            "answer": "$$\n\\boxed{\\frac{\\mu^{2}}{2\\pi\\varepsilon_{0}\\epsilon r^{3}}}\n$$"
        },
        {
            "introduction": "While first-principles calculations are insightful, practical predictions of duplex stability often rely on empirically-derived thermodynamic models. This practice introduces the nearest-neighbor model, a powerful framework that approximates the total free energy of a duplex by summing local contributions from base pairing and stacking. By calculating the change in stability upon an inosine substitution, you will learn to use this essential tool to evaluate the energetic impact of sequence variations and non-canonical pairs .",
            "id": "3856973",
            "problem": "Consider an antiparallel ribonucleic acid (RNA) duplex at temperature $T = 310$ kelvin and monovalent salt concentration $0.15$ molar, where the central base pair is a guanine–cytosine pair. In a designed variant, guanine is replaced with inosine at the same position, yielding an inosine–cytosine wobble-like pairing geometry in the identical sequence context. Assume the coarse-grained nearest-neighbor free energy model for duplex formation at fixed $T$ and ionic strength, in which the total free energy is approximated by a sum of effective local contributions that already incorporate enthalpic and entropic terms at the specified conditions. The sequence context around the central position is given as a local trimer on the top strand $5'$-end as $5'$-$X$-$G$-$Y$-$3'$, and on the bottom strand $3'$-end as $3'$-$X'$-$C$-$Y'$-$5'$, with $X = \\text{A}$, $X' = \\text{U}$, $Y = \\text{U}$, and $Y' = \\text{A}$.\n\nUse the following effective free energy contributions (all values are for $T = 310$ kelvin and monovalent salt $0.15$ molar):\n\n- Base-pairing contribution for a canonical guanine–cytosine pair: $\\Delta G_{\\text{bp}}(\\text{G–C}) = -6.4$ kilojoules per mole.\n- Base-pairing contribution for an inosine–cytosine wobble-like pair: $\\Delta G_{\\text{bp}}(\\text{I–C}) = -4.1$ kilojoules per mole.\n- Left nearest-neighbor stacking contribution with the central pair in the wild type (WT): $\\Delta G_{\\text{stack,left}}^{\\text{WT}} = -3.2$ kilojoules per mole for the step $5'$-$X$-$G$/$3'$-$X'$-$C$.\n- Left nearest-neighbor stacking contribution with the central pair in the inosine variant (Mut): $\\Delta G_{\\text{stack,left}}^{\\text{Mut}} = -2.5$ kilojoules per mole for the step $5'$-$X$-$I$/$3'$-$X'$-$C$.\n- Right nearest-neighbor stacking contribution with the central pair in WT: $\\Delta G_{\\text{stack,right}}^{\\text{WT}} = -2.8$ kilojoules per mole for the step $5'$-$G$-$Y$/$3'$-$C$-$Y'$.\n- Right nearest-neighbor stacking contribution with the central pair in Mut: $\\Delta G_{\\text{stack,right}}^{\\text{Mut}} = -2.2$ kilojoules per mole for the step $5'$-$I$-$Y$/$3'$-$C$-$Y'$.\n- Additional wobble geometric penalty for the inosine–cytosine pair due to non-canonical pairing geometry: $\\Delta G_{\\text{wobble}} = +0.9$ kilojoules per mole.\n- Context-specific backbone strain penalty in this trimer due to the central wobble pair: $\\Delta G_{\\text{strain}} = +0.4$ kilojoules per mole.\n- Minor hydration/desolvation penalty associated with the inosine substitution at this site: $\\Delta G_{\\text{hydr}} = +0.2$ kilojoules per mole.\n\nAssume that all other contributions in the duplex unaffected by the substitution are identical between wild type and variant and cancel in the free energy difference. Within this framework, compute the change in pairing free energy of duplex formation due to the substitution, defined as $\\Delta\\Delta G = \\Delta G_{\\text{Mut}} - \\Delta G_{\\text{WT}}$. Express the final answer in kilojoules per mole and round your answer to four significant figures.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the nearest-neighbor model of nucleic acid thermodynamics, is well-posed with all necessary data provided, and is formulated objectively without ambiguity.\n\nThe objective is to compute the change in the free energy of duplex formation, $\\Delta\\Delta G$, resulting from the substitution of a guanine ($G$) with an inosine ($I$) in a specific RNA sequence context. This change is defined as $\\Delta\\Delta G = \\Delta G_{\\text{Mut}} - \\Delta G_{\\text{WT}}$, where $\\Delta G_{\\text{Mut}}$ and $\\Delta G_{\\text{WT}}$ represent the local free energy contributions for the mutant and wild-type duplexes, respectively. The problem specifies that all contributions from regions of the duplex unaffected by the substitution cancel out and can be ignored.\n\nFirst, we define the local free energy contribution for the wild-type (WT) segment. This segment involves the central guanine–cytosine ($G$–$C$) pair and its immediate nearest-neighbor stacking interactions. The sequence context is $5'$-$X$-$G$-$Y$-$3'$ on one strand and $3'$-$X'$-$C$-$Y'-5'$ on the other, where $X = \\text{A}$, $X' = \\text{U}$, $Y = \\text{U}$, and $Y' = \\text{A}$. The total local free energy, $\\Delta G_{\\text{WT}}$, is the sum of the central base-pairing energy and the two flanking stacking energies:\n$$\n\\Delta G_{\\text{WT}} = \\Delta G_{\\text{bp}}(\\text{G–C}) + \\Delta G_{\\text{stack,left}}^{\\text{WT}} + \\Delta G_{\\text{stack,right}}^{\\text{WT}}\n$$\nUsing the provided values:\n- Base-pairing contribution for $G$–$C$: $\\Delta G_{\\text{bp}}(\\text{G–C}) = -6.4$ kilojoules per mole.\n- Left stacking contribution for $5'$-AG/$3'$-UC: $\\Delta G_{\\text{stack,left}}^{\\text{WT}} = -3.2$ kilojoules per mole.\n- Right stacking contribution for $5'$-GU/$3'$-CA: $\\Delta G_{\\text{stack,right}}^{\\text{WT}} = -2.8$ kilojoules per mole.\n\nSubstituting these values, we calculate $\\Delta G_{\\text{WT}}$:\n$$\n\\Delta G_{\\text{WT}} = (-6.4) + (-3.2) + (-2.8) = -12.4 \\text{ kilojoules per mole}\n$$\n\nNext, we define the local free energy contribution for the mutant (Mut) segment. In this variant, the guanine ($G$) is replaced by inosine ($I$), forming an inosine–cytosine ($I$–$C$) pair. The local free energy, $\\Delta G_{\\text{Mut}}$, includes the contributions from the new base pair, the altered stacking interactions, and additional penalty terms associated with the non-canonical nature of the $I$–$C$ pair in this context.\n$$\n\\Delta G_{\\text{Mut}} = \\Delta G_{\\text{bp}}(\\text{I–C}) + \\Delta G_{\\text{stack,left}}^{\\text{Mut}} + \\Delta G_{\\text{stack,right}}^{\\text{Mut}} + \\Delta G_{\\text{wobble}} + \\Delta G_{\\text{strain}} + \\Delta G_{\\text{hydr}}\n$$\nUsing the provided values for the mutant:\n- Base-pairing contribution for $I$–$C$: $\\Delta G_{\\text{bp}}(\\text{I–C}) = -4.1$ kilojoules per mole.\n- Left stacking contribution for $5'$-AI/$3'$-UC: $\\Delta G_{\\text{stack,left}}^{\\text{Mut}} = -2.5$ kilojoules per mole.\n- Right stacking contribution for $5'$-IU/$3'$-CA: $\\Delta G_{\\text{stack,right}}^{\\text{Mut}} = -2.2$ kilojoules per mole.\n- Wobble geometry penalty: $\\Delta G_{\\text{wobble}} = +0.9$ kilojoules per mole.\n- Backbone strain penalty: $\\Delta G_{\\text{strain}} = +0.4$ kilojoules per mole.\n- Hydration/desolvation penalty: $\\Delta G_{\\text{hydr}} = +0.2$ kilojoules per mole.\n\nSubstituting these values, we calculate $\\Delta G_{\\text{Mut}}$:\n$$\n\\Delta G_{\\text{Mut}} = (-4.1) + (-2.5) + (-2.2) + (+0.9) + (+0.4) + (+0.2)\n$$\n$$\n\\Delta G_{\\text{Mut}} = -8.8 + 1.5 = -7.3 \\text{ kilojoules per mole}\n$$\n\nFinally, we compute the change in free energy, $\\Delta\\Delta G$, by subtracting the wild-type free energy from the mutant free energy:\n$$\n\\Delta\\Delta G = \\Delta G_{\\text{Mut}} - \\Delta G_{\\text{WT}}\n$$\n$$\n\\Delta\\Delta G = (-7.3 \\text{ kilojoules per mole}) - (-12.4 \\text{ kilojoules per mole})\n$$\n$$\n\\Delta\\Delta G = -7.3 + 12.4 \\text{ kilojoules per mole} = +5.1 \\text{ kilojoules per mole}\n$$\nThe positive value of $\\Delta\\Delta G$ indicates that the substitution is thermodynamically destabilizing, as expected when replacing a canonical $G$–$C$ pair with a wobble-like $I$–$C$ pair with associated penalties.\n\nThe problem requires the answer to be rounded to four significant figures. The calculated value is $5.1$. To express this with four significant figures, we write it as $5.100$.",
            "answer": "$$\\boxed{5.100}$$"
        },
        {
            "introduction": "The stability of a base pair is not a single number but a dynamic equilibrium described by a free energy landscape. This advanced computational exercise guides you through the process of reconstructing a Potential of Mean Force ($PMF$) for base pair opening from biased simulation data using the Weighted Histogram Analysis Method (WHAM). By implementing the WHAM algorithm yourself, you will master a cornerstone technique in computational biophysics for quantifying the energetic barriers and states that define complex biomolecular processes .",
            "id": "3857041",
            "problem": "Design a complete program that reconstructs a potential of mean force for base pair opening along one collective coordinate using the Weighted Histogram Analysis Method. The reconstruction is to be performed from synthetic umbrella sampling histograms generated for a physically plausible model of unbiased sampling. The physical basis is the Boltzmann distribution, in which the unbiased probability density over an opening coordinate $q$ is proportional to $\\exp(-\\beta F_0(q))$, where $\\beta = 1/(R T)$ and $R$ is the molar gas constant. You must derive the reconstruction on the basis of first principles, starting from the definitions of the Boltzmann distribution, harmonic umbrella biasing, and maximum-likelihood consistency across overlapping windows. The program must generate deterministic histograms for specified test suites, perform the Weighted Histogram Analysis Method reconstruction to obtain an estimate of the unbiased probability, and then convert the probability to a potential of mean force. Energies must be reported in kilojoules per mole (kJ/mol), angles in radians, and distances in nanometers (nm). All logarithms are natural logarithms. Use $R = 0.008314462618$ kilojoules per mole per kelvin and $T = 298$ kelvin in all cases, and express final energies in kJ/mol. The program should not rely on any randomness, user input, or external files.\n\nFundamental definitions and generative model for synthetic data are as follows. Let the unbiased probability density over $q$ be a mixture of two Gaussian components representing closed and open configurations. Define $p_0(q) \\propto w_1 \\exp\\left(-\\frac{(q - \\mu_1)^2}{2 \\sigma_1^2}\\right) + w_2 \\exp\\left(-\\frac{(q - \\mu_2)^2}{2 \\sigma_2^2}\\right)$ with positive weights $w_1$ and $w_2$. In umbrella window $i$ with a harmonic bias $U_i(q) = \\frac{1}{2} k_i (q - q_i)^2$, the biased sampling density is $p_i(q) \\propto p_0(q) \\exp(-\\beta U_i(q))$. Synthetic histograms are produced by discretizing $q$ on an evenly spaced grid and assigning counts deterministically by distributing a total number of samples $M_i$ according to the normalized $p_i(q)$ over bins. This deterministic assignment must ensure that the total number of counts equals $M_i$ exactly. From the ensemble of biased histograms across windows, reconstruct the unbiased probability over bins and convert to a potential of mean force $W(q) = - \\frac{1}{\\beta} \\ln P(q) + C$ with $C$ chosen so that the minimum value of $W(q)$ is zero.\n\nThe Weighted Histogram Analysis Method must be implemented by solving a self-consistent set of equations derived from the requirement that the unbiased probability $P(q)$ be compatible with all biased histograms under their respective biases and the normalization constraints for each window. The reconstruction must be achieved iteratively until convergence. After reconstruction, identify the two basins corresponding to the closed and open states using specified intervals and compute two metrics: the barrier height and the free energy difference between basins. The barrier height is defined as $W(q^\\ddagger) - \\min\\{W(q_{\\text{closed}}^{\\ast}), W(q_{\\text{open}}^{\\ast})\\}$, where $q_{\\text{closed}}^{\\ast}$ and $q_{\\text{open}}^{\\ast}$ are the bin locations of the local minima within the specified basin intervals for closed and open states, respectively, and $q^\\ddagger$ is the location of the local maximum between these minima. The free energy difference is defined as $W(q_{\\text{open}}^{\\ast}) - W(q_{\\text{closed}}^{\\ast})$. Report both metrics in kilojoules per mole (kJ/mol), rounded in the program to full-precision floating point without explicit rounding.\n\nYour program must implement the following three test cases, which collectively test the reconstruction for separation and angular coordinates, a happy path with substantial window overlap, and a challenging edge case with poor overlap. For all test cases use $\\beta = 1/(R T)$ with $R = 0.008314462618$ kilojoules per mole per kelvin and $T = 298$ kelvin. The grid discretization is uniform, and the same $\\beta$ applies in all calculations.\n\n- Test Case $1$ (separation coordinate, happy path):\n    - Coordinate: $q = x$ in nanometers.\n    - Grid: $x \\in [0.24, 0.60]$ nanometers with bin width $\\Delta x = 0.002$ nanometers.\n    - Unbiased mixture parameters: $w_1 = 1.0$, $w_2 = 0.5$, $\\mu_1 = 0.30$ nanometers, $\\sigma_1 = 0.015$ nanometers, $\\mu_2 = 0.52$ nanometers, $\\sigma_2 = 0.020$ nanometers.\n    - Number of windows: $K = 7$, window centers $q_i \\in \\{0.28, 0.32, 0.36, 0.42, 0.48, 0.52, 0.56\\}$ nanometers, spring constants $k_i = 1500$ kilojoules per mole per nanometer squared for all $i$, and $M_i = 5000$ samples per window.\n    - Basin intervals: closed basin $x \\in [0.27, 0.36]$ nanometers; open basin $x \\in [0.47, 0.57]$ nanometers.\n\n- Test Case $2$ (angular coordinate, happy path):\n    - Coordinate: $q = \\theta$ in radians.\n    - Grid: $\\theta \\in [0.00, 0.90]$ radians with bin width $\\Delta \\theta = 0.01$ radians.\n    - Unbiased mixture parameters: $w_1 = 1.0$, $w_2 = 0.25$, $\\mu_1 = 0.00$ radians, $\\sigma_1 = 0.12$ radians, $\\mu_2 = 0.60$ radians, $\\sigma_2 = 0.12$ radians.\n    - Number of windows: $K = 5$, window centers $q_i \\in \\{0.00, 0.20, 0.40, 0.60, 0.80\\}$ radians, spring constants $k_i = 60$ kilojoules per mole per radian squared for all $i$, and $M_i = 5000$ samples per window.\n    - Basin intervals: closed basin $\\theta \\in [0.00, 0.25]$ radians; open basin $\\theta \\in [0.50, 0.80]$ radians.\n\n- Test Case $3$ (separation coordinate, poor overlap edge case):\n    - Coordinate: $q = x$ in nanometers.\n    - Grid: $x \\in [0.24, 0.60]$ nanometers with bin width $\\Delta x = 0.002$ nanometers.\n    - Unbiased mixture parameters: $w_1 = 1.0$, $w_2 = 0.5$, $\\mu_1 = 0.30$ nanometers, $\\sigma_1 = 0.015$ nanometers, $\\mu_2 = 0.52$ nanometers, $\\sigma_2 = 0.020$ nanometers.\n    - Number of windows: $K = 3$, window centers $q_i \\in \\{0.30, 0.42, 0.54\\}$ nanometers, spring constants $k_i = 6000$ kilojoules per mole per nanometer squared for all $i$, and $M_i = 2000$ samples per window.\n    - Basin intervals: closed basin $x \\in [0.27, 0.36]$ nanometers; open basin $x \\in [0.47, 0.57]$ nanometers.\n\nAlgorithmic requirements:\n- Construct $p_0(q)$ on the grid for each test case, up to a proportionality constant, and combine with the harmonic bias to obtain normalized $p_i(q)$ in each window.\n- Allocate integer histogram counts $n_i(q)$ deterministically so that $\\sum_{q} n_i(q) = M_i$ exactly, using a scheme that assigns $\\lfloor M_i p_i(q) \\rfloor$ counts per bin and then distributes the remaining counts by descending residuals until all $M_i$ samples are assigned.\n- Derive and implement an iterative Weighted Histogram Analysis Method reconstruction from first principles. Do not use any pre-packaged WHAM functions. The iterative scheme must converge to a self-consistent $P(q)$ over bins and window free energy offsets enforcing normalization constraints in each window.\n- Convert the reconstructed $P(q)$ into $W(q)$ in kilojoules per mole, normalized so that $\\min_q W(q) = 0$.\n- Identify basin minima and the intervening barrier, and compute barrier height and basin free energy difference.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a two-element list containing the barrier height and the basin free energy difference in kilojoules per mole. For example, the output format is exactly of the form $[[b_1,\\Delta_1],[b_2,\\Delta_2],[b_3,\\Delta_3]]$, where $b_i$ is the barrier height and $\\Delta_i$ is the open-minus-closed free energy difference for test case $i$.",
            "solution": "The problem statement has been critically validated and is deemed to be scientifically sound, well-posed, objective, and complete. It describes a standard and important procedure in computational biophysics: the reconstruction of a potential of mean force (PMF) from biased simulations using the Weighted Histogram Analysis Method (WHAM). The provided parameters and test cases are physically plausible and computationally tractable. We may therefore proceed with a formal derivation and solution.\n\nThe core task is to reconstruct the unbiased probability distribution, $P(q)$, along a collective coordinate $q$, from a set of biased histograms, $\\{n_i(q)\\}$, generated from $K$ independent simulations (windows). Each window $i$ is subjected to a biasing potential $U_i(q)$.\n\nThe fundamental principle is the Boltzmann distribution. The unbiased probability of the system being in a state characterized by coordinate $q$ is related to its potential of mean force, $F_0(q)$, by:\n$$\nP(q) \\propto \\exp(-\\beta F_0(q))\n$$\nwhere $\\beta = 1/(RT)$ is the inverse temperature, $R$ is the molar gas constant, and $T$ is the absolute temperature. The PMF is thus $F_0(q) = -\\frac{1}{\\beta} \\ln P(q) + C$, where $C$ is an arbitrary constant.\n\nIn umbrella sampling, a biasing potential $U_i(q)$ is added in each window $i$. The resulting biased probability distribution, $p_i(q)$, is given by:\n$$\np_i(q) \\propto P(q) \\exp(-\\beta U_i(q))\n$$\nThe total probability sampled in window $i$ is normalized. Let $f_i$ be the free energy offset of window $i$ relative to the unbiased system. This offset acts as the logarithm of the normalization constant:\n$$\n\\exp(-\\beta f_i) = \\int P(q) \\exp(-\\beta U_i(q)) dq\n$$\nFor a discretized coordinate grid with bins centered at $q_j$, this becomes a sum:\n$$\n\\exp(-\\beta f_i) = \\sum_{j} P(q_j) \\exp(-\\beta U_i(q_j))\n$$\nThe normalized biased probability for bin $j$ in window $i$ is therefore:\n$$\np_i(q_j) = \\frac{P(q_j) \\exp(-\\beta U_i(q_j))}{\\sum_k P(q_k) \\exp(-\\beta U_i(q_k))} = P(q_j) \\exp(-\\beta U_i(q_j)) \\exp(\\beta f_i)\n$$\n\nThe WHAM equations are derived by maximizing the likelihood of observing the collection of histograms $\\{n_i(q_j)\\}$, where $n_i(q_j)$ is the number of counts in bin $j$ from window $i$. The total number of samples in window $i$ is $M_i = \\sum_j n_i(q_j)$. The log-likelihood function $\\ln \\mathcal{L}$ for observing the full dataset, neglecting constant terms, is:\n$$\n\\ln \\mathcal{L} = \\sum_{i=1}^{K} \\sum_{j} n_i(q_j) \\ln p_i(q_j)\n$$\nSubstituting the expression for $p_i(q_j)$:\n$$\n\\ln \\mathcal{L} = \\sum_{i=1}^{K} \\sum_{j} n_i(q_j) \\left( \\ln P(q_j) - \\beta U_i(q_j) + \\beta f_i \\right)\n$$\nWe wish to find the set of probabilities $\\{P(q_j)\\}$ and free energies $\\{f_i\\}$ that maximizes $\\ln \\mathcal{L}$ subject to the constraints $\\sum_j P(q_j) = 1$ and the definitions of $f_i$. This optimization problem leads to a set of self-consistent equations. By taking the partial derivative of the corresponding Lagrangian with respect to each $P(q_j)$ and setting it to zero, we obtain the optimal estimate for $P(q_j)$:\n$$\nP(q_j) = \\frac{\\sum_{i=1}^{K} n_i(q_j)}{\\sum_{k=1}^{K} M_k \\exp(\\beta f_k - \\beta U_k(q_j))} \\quad \\text{(Equation 1)}\n$$\nThis equation provides the best estimate for the unbiased probability in bin $j$ as a weighted average of observations from all windows. The weights depend on the window free energies $f_k$.\n\nThe free energies $f_i$ themselves are determined by the normalization condition, which we restate:\n$$\n\\exp(-\\beta f_i) = \\sum_{j} P(q_j) \\exp(-\\beta U_i(q_j)) \\quad \\text{(Equation 2)}\n$$\nThis can be rearranged to solve for $f_i$:\n$$\nf_i = -\\frac{1}{\\beta} \\ln \\left( \\sum_{j} P(q_j) \\exp(-\\beta U_i(q_j)) \\right)\n$$\n\nEquations 1 and 2 form a coupled, non-linear system that must be solved iteratively for $\\{P(q_j)\\}$ and $\\{f_i\\}$. An arbitrary constant can be added to all $f_i$ without changing the solution for $P(q_j)$, so we fix one value, e.g., $f_1 = 0$, throughout the iteration.\n\nThe iterative algorithm is as follows:\n1.  Initialize the free energies, for instance, $f_i = 0$ for all $i=1, \\dots, K$.\n2.  Begin iteration:\n    a. Calculate the unbiased probabilities $P(q_j)$ for all bins $j$ using the current set of $\\{f_i\\}$ and the histogram data $\\{n_i(q_j)\\}$ via Equation 1.\n    b. Normalize the resulting probability distribution: $P(q_j) \\leftarrow P(q_j) / \\sum_k P(q_k)$.\n    c. Calculate a new set of free energies $\\{f_i^{\\text{new}}\\}$ using the updated $\\{P(q_j)\\}$ via Equation 2.\n    d. Fix the arbitrary constant by shifting the new free energies, e.g., $f_i^{\\text{new}} \\leftarrow f_i^{\\text{new}} - f_1^{\\text{new}}$.\n    e. Check for convergence by comparing $\\{f_i^{\\text{new}}\\}$ with the previous $\\{f_i\\}$. If the maximum absolute difference is below a defined tolerance, the solution is converged. Otherwise, set $f_i \\leftarrow f_i^{\\text{new}}$ and repeat from step 2a.\n\nBefore applying WHAM, synthetic histograms are generated deterministically. The unbiased probability density $p_0(q)$ is defined as a Gaussian mixture. For each window $i$, the biased probability density $p_i(q) \\propto p_0(q)\\exp(-\\beta U_i(q))$ is computed on the grid and normalized. Then, $M_i$ total samples are distributed into bins. Integer counts are first assigned as $n_i(q_j) = \\lfloor M_i p_i(q_j) \\rfloor$. The remaining $M_i - \\sum_j n_i(q_j)$ samples are assigned one by one to the bins with the largest residuals, $r_j = M_i p_i(q_j) - n_i(q_j)$, until the total count matches $M_i$.\n\nOnce the converged unbiased probability distribution $P(q)$ is obtained, the PMF is calculated as $W(q) = -\\frac{1}{\\beta} \\ln P(q)$. To prevent numerical errors, a small positive floor is applied to $P(q)$ before the logarithm. The PMF is normalized by subtracting its minimum value, such that $\\min(W(q)) = 0$.\n\nFinally, the required metrics are computed. Local minima $q_{\\text{closed}}^{\\ast}$ and $q_{\\text{open}}^{\\ast}$ are found within specified basin intervals. The local maximum $q^{\\ddagger}$ is located on the PMF profile between these two minima. The barrier height is $W(q^\\ddagger) - \\min\\{W(q_{\\text{closed}}^{\\ast}), W(q_{\\text{open}}^{\\ast})\\}$ and the free energy difference is $\\Delta W = W(q_{\\text{open}}^{\\ast}) - W(q_{\\text{closed}}^{\\ast})$.",
            "answer": "```python\nimport numpy as np\n\nclass WHAMAnalysis:\n    \"\"\"\n    Encapsulates the logic for a single WHAM test case, from data generation\n    to PMF reconstruction and analysis.\n    \"\"\"\n    def __init__(self, test_case_params):\n        \"\"\"\n        Initializes the analysis with parameters for a specific test case.\n        \"\"\"\n        self.params = test_case_params\n        self.R = 0.008314462618  # kJ/mol/K\n        self.T = 298.0  # K\n        self.beta = 1.0 / (self.R * self.T)\n\n        grid_params = self.params['grid']\n        self.q = np.arange(\n            grid_params['range'][0],\n            grid_params['range'][1] + grid_params['width'] / 2.0,\n            grid_params['width']\n        )\n        self.num_bins = len(self.q)\n\n    def _generate_synthetic_data(self):\n        \"\"\"\n        Generates deterministic histograms based on the problem's generative model.\n        \"\"\"\n        # 1. Unbiased probability density (unnormalized)\n        p0_params = self.params['unbiased_mixture']\n        p0 = p0_params['w1'] * np.exp(-((self.q - p0_params['mu1'])**2) / (2 * p0_params['sigma1']**2)) + \\\n             p0_params['w2'] * np.exp(-((self.q - p0_params['mu2'])**2) / (2 * p0_params['sigma2']**2))\n\n        # 2. Biased histograms for each window\n        num_windows = self.params['num_windows']\n        window_centers = self.params['window_centers']\n        spring_constants = self.params['spring_constants']\n        samples_per_window = self.params['samples_per_window']\n\n        histograms = np.zeros((num_windows, self.num_bins), dtype=int)\n        biases = np.zeros((num_windows, self.num_bins))\n\n        for i in range(num_windows):\n            # Calculate bias potential U_i(q)\n            U_i = 0.5 * spring_constants[i] * (self.q - window_centers[i])**2\n            biases[i, :] = U_i\n\n            # Calculate biased probability density p_i(q)\n            p_i = p0 * np.exp(-self.beta * U_i)\n            \n            # Normalize p_i\n            p_i_normalized = p_i / np.sum(p_i)\n\n            # Deterministic histogram generation\n            M_i = samples_per_window[i]\n            expected_counts = M_i * p_i_normalized\n            \n            base_counts = np.floor(expected_counts).astype(int)\n            histograms[i, :] = base_counts\n            \n            remainder_count = M_i - np.sum(base_counts)\n            if remainder_count > 0:\n                residuals = expected_counts - base_counts\n                top_residual_indices = np.argsort(residuals)[-remainder_count:]\n                histograms[i, top_residual_indices] += 1\n        \n        return histograms, biases, np.array(samples_per_window, dtype=float)\n\n    def _run_wham(self, histograms, biases, M_i_vec, tol=1e-12, max_iter=10000):\n        \"\"\"\n        Solves the WHAM equations iteratively.\n        \"\"\"\n        num_windows = histograms.shape[0]\n        \n        # Initialize free energies\n        f = np.zeros(num_windows)\n        \n        N_j = np.sum(histograms, axis=0) # Total counts per bin\n\n        for iteration in range(max_iter):\n            f_old = np.copy(f)\n            \n            # Equation 1: Calculate P(q_j)\n            denominator = np.zeros(self.num_bins)\n            for k in range(num_windows):\n                denominator += M_i_vec[k] * np.exp(self.beta * (f[k] - biases[k, :]))\n            \n            P = np.zeros_like(denominator)\n            # Avoid division by zero where denominator might be zero (although unlikely)\n            # If N_j is zero, P_j is zero.\n            non_zero_N_j = N_j > 0\n            safe_denominator = np.where(denominator > 0, denominator, 1.0)\n            P[non_zero_N_j] = N_j[non_zero_N_j] / safe_denominator[non_zero_N_j]\n\n            # Normalize P\n            P /= np.sum(P)\n            \n            # Equation 2: Update f_i\n            f_new = np.zeros_like(f)\n            # Add a small epsilon to P to avoid log(0)\n            P_log_safe = P + 1e-300\n            for i in range(num_windows):\n                sum_term = np.sum(P_log_safe * np.exp(-self.beta * biases[i, :]))\n                f_new[i] = - (1.0 / self.beta) * np.log(sum_term)\n\n            # Shift f to set f_1 = 0\n            f = f_new - f_new[0]\n\n            # Check for convergence\n            if np.max(np.abs(f - f_old))  tol:\n                break\n        \n        return P\n\n    def _analyze_pmf(self, P, basin_intervals):\n        \"\"\"\n        Calculates the PMF and extracts the required metrics.\n        \"\"\"\n        # Calculate PMF W(q)\n        P_safe = np.maximum(P, 1e-300) # Prevent log(0)\n        W = - (1.0 / self.beta) * np.log(P_safe)\n        \n        # Normalize PMF so min(W) = 0\n        W -= np.min(W)\n\n        # Identify basin indices\n        basin_closed_indices = np.where(\n            (self.q >= basin_intervals['closed'][0])  (self.q = basin_intervals['closed'][1])\n        )[0]\n        basin_open_indices = np.where(\n            (self.q >= basin_intervals['open'][0])  (self.q = basin_intervals['open'][1])\n        )[0]\n\n        # Find minima in basins\n        idx_closed_min_local = np.argmin(W[basin_closed_indices])\n        idx_closed_min = basin_closed_indices[idx_closed_min_local]\n        w_closed_star = W[idx_closed_min]\n\n        idx_open_min_local = np.argmin(W[basin_open_indices])\n        idx_open_min = basin_open_indices[idx_open_min_local]\n        w_open_star = W[idx_open_min]\n        \n        # Find barrier between minima\n        start_idx = min(idx_closed_min, idx_open_min) + 1\n        end_idx = max(idx_closed_min, idx_open_min)\n        \n        if start_idx >= end_idx: # No points between minima\n            w_ddagger = max(w_closed_star, w_open_star)\n        else:\n            idx_barrier_local = np.argmax(W[start_idx:end_idx])\n            idx_barrier = start_idx + idx_barrier_local\n            w_ddagger = W[idx_barrier]\n\n        # Calculate metrics\n        barrier_height = w_ddagger - min(w_closed_star, w_open_star)\n        free_energy_diff = w_open_star - w_closed_star\n        \n        return [barrier_height, free_energy_diff]\n\n    def run(self):\n        \"\"\"\n        Executes the full analysis pipeline for the test case.\n        \"\"\"\n        histograms, biases, M_i_vec = self._generate_synthetic_data()\n        P = self._run_wham(histograms, biases, M_i_vec)\n        results = self._analyze_pmf(P, self.params['basin_intervals'])\n        return results\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run the analysis, and print results.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: separation coordinate, happy path\n        {\n            'grid': {'range': [0.24, 0.60], 'width': 0.002},\n            'unbiased_mixture': {'w1': 1.0, 'w2': 0.5, 'mu1': 0.30, 'sigma1': 0.015, 'mu2': 0.52, 'sigma2': 0.020},\n            'num_windows': 7,\n            'window_centers': [0.28, 0.32, 0.36, 0.42, 0.48, 0.52, 0.56],\n            'spring_constants': [1500] * 7,\n            'samples_per_window': [5000] * 7,\n            'basin_intervals': {'closed': [0.27, 0.36], 'open': [0.47, 0.57]}\n        },\n        # Test Case 2: angular coordinate, happy path\n        {\n            'grid': {'range': [0.00, 0.90], 'width': 0.01},\n            'unbiased_mixture': {'w1': 1.0, 'w2': 0.25, 'mu1': 0.00, 'sigma1': 0.12, 'mu2': 0.60, 'sigma2': 0.12},\n            'num_windows': 5,\n            'window_centers': [0.00, 0.20, 0.40, 0.60, 0.80],\n            'spring_constants': [60] * 5,\n            'samples_per_window': [5000] * 5,\n            'basin_intervals': {'closed': [0.00, 0.25], 'open': [0.50, 0.80]}\n        },\n        # Test Case 3: separation coordinate, poor overlap\n        {\n            'grid': {'range': [0.24, 0.60], 'width': 0.002},\n            'unbiased_mixture': {'w1': 1.0, 'w2': 0.5, 'mu1': 0.30, 'sigma1': 0.015, 'mu2': 0.52, 'sigma2': 0.020},\n            'num_windows': 3,\n            'window_centers': [0.30, 0.42, 0.54],\n            'spring_constants': [6000] * 3,\n            'samples_per_window': [2000] * 3,\n            'basin_intervals': {'closed': [0.27, 0.36], 'open': [0.47, 0.57]}\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        analyzer = WHAMAnalysis(params)\n        result = analyzer.run()\n        all_results.append(result)\n\n    # Format the results into the required string \"[[b_1,d_1],[b_2,d_2],[b_3,d_3]]\"\n    result_str = '[' + ','.join([f\"[{r[0]},{r[1]}]\" for r in all_results]) + ']'\n    print(result_str)\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}