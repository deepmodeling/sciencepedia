{
    "hands_on_practices": [
        {
            "introduction": "拉马钱德兰图的特定形状源于基本的物理原理，即原子间的空间位阻。通过从头开始构建一个简化的二肽模型并系统地检测非键原子间的碰撞，这个练习将帮助你使用硬球范德华模型，亲手重现这些构象限制，从而深入理解驱动蛋白质主链构象偏好的底层物理学原理 。",
            "id": "3861074",
            "problem": "要求您实现一个物理上合理的硬球空间位阻过滤器，以估算在标准肽主链模型中，丙氨酸的空间位阻允许区域在 $(\\phi,\\psi)$ 平面中所占的分数。您的程序必须使用固定的内坐标构建一个最小的类丙氨酸二肽片段，并针对每个采样的主链二面角对 $(\\phi,\\psi)$，判断其构象在硬球范德华（vdW）模型下是否为空间位阻所允许。随后，您将在 $(\\phi,\\psi)$ 的均匀网格上估算允许区域的分数，并报告当所有半径统一按 $0.95$ 的比例因子缩放时，该分数如何变化。\n\n需要使用的基本核心定义：\n- 主链二面角由四个有序原子 $(\\mathbf{r}_0,\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3)$ 定义，其值等于平面 $(\\mathbf{r}_0,\\mathbf{r}_1,\\mathbf{r}_2)$ 与平面 $(\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3)$ 之间的有符号角。符号约定源于沿键 $\\mathbf{r}_1\\mathbf{r}_2$ 的右手法则。该二面角通过向量和叉积计算：设 $\\mathbf{b}_1=\\mathbf{r}_1-\\mathbf{r}_0$, $\\mathbf{b}_2=\\mathbf{r}_2-\\mathbf{r}_1$, $\\mathbf{b}_3=\\mathbf{r}_3-\\mathbf{r}_2$，则平面法向量为 $\\mathbf{n}_1=\\mathbf{b}_1\\times\\mathbf{b}_2$ 和 $\\mathbf{n}_2=\\mathbf{b}_2\\times\\mathbf{b}_3$，有符号角 $\\omega$ 满足 $\\tan\\omega=\\dfrac{\\left(\\mathbf{n}_1\\times \\dfrac{\\mathbf{b}_2}{\\lVert \\mathbf{b}_2\\rVert}\\right)\\cdot \\mathbf{n}_2}{\\mathbf{n}_1\\cdot\\mathbf{n}_2}$。\n- 在硬球模型下，当两个非键合原子 $i$ 和 $j$ 之间的欧几里得距离 $d_{ij}$ 严格小于它们的vdW半径之和 $r_i+r_j$（或当半径按比例因子 $s$ 缩放时的 $s\\,(r_i+r_j)$）时，发生空间位阻冲突。距离以埃（Å）为单位。\n- 键合对和由两个键分隔的原子对（也称为 $1$–$3$ 对）不参与冲突检查。仅考虑由三个或更多键分隔的原子对进行空间排斥计算。\n- 围绕键轴 $\\mathbf{u}$ 进行角度为 $\\theta$ 的刚性旋转，使用罗德里格斯旋转公式对任意点 $\\mathbf{x}$ 进行操作，旋转轴经过点 $\\mathbf{p}$：$\\mathbf{x}'=\\mathbf{p}+\\cos\\theta(\\mathbf{x}-\\mathbf{p})+\\sin\\theta\\,(\\mathbf{u}\\times(\\mathbf{x}-\\mathbf{p}))+(1-\\cos\\theta)\\,\\mathbf{u}\\,(\\mathbf{u}\\cdot(\\mathbf{x}-\\mathbf{p}))$，其中 $\\mathbf{u}$ 是归一化的。\n\n待构建的几何结构（距离单位为埃，角度单位为度）：\n- 中心残基的主链：将主链原子 $\\mathrm{N}$、$\\mathrm{C_\\alpha}$ 和 $\\mathrm{C}$ 放置在一个肽平面内，具有固定的键长和键角：$\\lVert \\mathrm{N}-\\mathrm{C_\\alpha}\\rVert=1.458$，$\\lVert \\mathrm{C_\\alpha}-\\mathrm{C}\\rVert=1.525$，以及键角 $\\angle \\mathrm{N}\\!-\\!\\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}=110.1$ 度。初始肽平面为 $x$–$y$ 平面，其中 $\\mathrm{N}$ 位于原点，$\\mathrm{C_\\alpha}$ 位于 $x$ 轴上。\n- 中心残基的羰基氧：$\\mathrm{O}$ 与 $\\mathrm{C}$ 键合，键长 $\\lVert \\mathrm{C}-\\mathrm{O}\\rVert=1.229$，呈平面几何构型，键角 $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}\\!-\\!\\mathrm{O}=120.0$ 度。\n- 前一个残基的羰基：$\\mathrm{C_{-1}}$ 与 $\\mathrm{N}$ 键合，键长 $\\lVert \\mathrm{N}-\\mathrm{C_{-1}}\\rVert=1.330$，键角 $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{N}\\!-\\!\\mathrm{C_{-1}}=121.7$ 度；将 $\\mathrm{O_{-1}}$ 与 $\\mathrm{C_{-1}}$ 键合，键长 $\\lVert \\mathrm{C_{-1}}-\\mathrm{O_{-1}}\\rVert=1.229$，键角 $\\angle \\mathrm{N}\\!-\\!\\mathrm{C_{-1}}\\!-\\!\\mathrm{O_{-1}}=120.0$ 度，所有这些原子均在同一肽平面内（反式肽键）。\n- 后一个残基的酰胺氮：$\\mathrm{N_{+1}}$ 与 $\\mathrm{C}$ 键合，键长 $\\lVert \\mathrm{C}-\\mathrm{N_{+1}}\\rVert=1.330$，键角 $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}\\!-\\!\\mathrm{N_{+1}}=116.2$ 度，位于肽平面内（反式）。\n- 丙氨酸侧链：一个位于 $\\mathrm{C_\\beta}$ 的联合原子甲基与 $\\mathrm{C_\\alpha}$ 键合，键长 $\\lVert \\mathrm{C_\\alpha}-\\mathrm{C_\\beta}\\rVert=1.530$。为反映四面体构象偏好，初始时将 $\\mathrm{C_\\beta}$ 沿肽平面法线方向放置，即垂直于主链平面。\n\n主链二面角控制：\n- 中心残基的拉马钱德兰二面角定义为 $\\phi=\\angle(\\mathrm{C_{-1}},\\mathrm{N},\\mathrm{C_\\alpha},\\mathrm{C})$ 和 $\\psi=\\angle(\\mathrm{N},\\mathrm{C_\\alpha},\\mathrm{C},\\mathrm{N_{+1}})$，单位均为度。为设置目标 $(\\phi,\\psi)$，将上游基团 $\\{\\mathrm{C_{-1}},\\mathrm{O_{-1}}\\}$ 作为一个刚体，围绕 $\\mathrm{N}$–$\\mathrm{C_\\alpha}$ 键轴旋转以达到目标 $\\phi$ 所需的增量；并将下游基团 $\\{\\mathrm{O},\\mathrm{N_{+1}}\\}$ 作为一个刚体，围绕 $\\mathrm{C_\\alpha}$–$\\mathrm{C}$ 键轴旋转以达到目标 $\\psi$ 所需的增量。\n\n空间位阻模型半径 (Bondi 半径)：\n- $\\mathrm{N}$：$1.55$，$\\mathrm{C}$：$1.70$，$\\mathrm{O}$：$1.52$，联合原子甲基 $\\mathrm{C_\\beta}$：$2.00$。按指定要求，将所有半径乘以比例因子 $s$ 进行缩放。\n\n连接性排除：\n- 从冲突检查中排除任何直接键合或由两个键精确分隔的原子对。连接边包括：$\\mathrm{N}$–$\\mathrm{C_\\alpha}$、$\\mathrm{C_\\alpha}$–$\\mathrm{C}$、$\\mathrm{C}$–$\\mathrm{O}$、$\\mathrm{N}$–$\\mathrm{C_{-1}}$、$\\mathrm{C_{-1}}$–$\\mathrm{O_{-1}}$、$\\mathrm{C}$–$\\mathrm{N_{+1}}$ 和 $\\mathrm{C_\\alpha}$–$\\mathrm{C_\\beta}$。\n\n网格和单位：\n- 在覆盖 $[-180,180]$（含边界）的均匀网格上对 $(\\phi,\\psi)$ 进行采样，单位为度。距离单位为埃。角度单位必须为度。\n\n允许区域分数估算：\n- 允许区域分数计算方法为：其构象在非键合原子对之间没有空间位阻冲突的网格点数，除以总网格点数。\n\n测试套件：\n- 每个测试用例是一个序对 $(\\Delta, s)$，其中 $\\Delta$ 是网格步长（单位为度），$s$ 是 vdW 缩放因子。请使用以下测试用例：$(60,1.0)$, $(60,0.95)$, $(20,1.0)$, $(20,0.95)$, $(10,1.0)$, $(10,0.95)$。\n- 对每个测试用例，输出允许区域的分数，格式为浮点数，保留六位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，“[f1,f2,f3,f4,f5,f6]”）。每个 $f_k$ 对应于上述顺序中第 $k$ 个测试用例的允许区域分数。",
            "solution": "用户要求编写一个程序，用于计算一个类丙氨酸二肽片段的拉马钱德兰 $(\\phi,\\psi)$ 构象空间中，空间位阻允许区域所占的分数。该问题属于计算化学生物学领域，需要基于几何构建来实现一个硬球空间位阻冲突模型。\n\n### 问题验证\n\n首先，我将严格验证问题陈述。\n\n#### 第1步：提取已知信息\n\n- **模型**：一个丙氨酸二肽片段，在 $\\mathrm{C_\\alpha}$ 上带有一个联合原子甲基 $(\\mathrm{C_\\beta})$。空间相互作用通过硬球模型进行评估。\n- **原子**：该模型包含八个原子中心：中心残基的 $\\mathrm{N, C_\\alpha, C, O}$，前一个残基的 $\\mathrm{C_{-1}, O_{-1}}$，后一个残基的 $\\mathrm{N_{+1}}$，以及丙氨酸侧链的 $\\mathrm{C_\\beta}$。\n- **几何参数（距离单位为Å，角度单位为度）**：\n    - 键长：$\\lVert \\mathrm{N}-\\mathrm{C_\\alpha}\\rVert=1.458$, $\\lVert \\mathrm{C_\\alpha}-\\mathrm{C}\\rVert=1.525$, $\\lVert \\mathrm{C}-\\mathrm{O}\\rVert=1.229$, $\\lVert \\mathrm{N}-\\mathrm{C_{-1}}\\rVert=1.330$, $\\lVert \\mathrm{C_{-1}}-\\mathrm{O_{-1}}\\rVert=1.229$, $\\lVert \\mathrm{C}-\\mathrm{N_{+1}}\\rVert=1.330$, $\\lVert \\mathrm{C_\\alpha}-\\mathrm{C_\\beta}\\rVert=1.530$。\n    - 键角：$\\angle \\mathrm{N}\\!-\\!\\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}=110.1^\\circ$, $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}\\!-\\!\\mathrm{O}=120.0^\\circ$, $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{N}\\!-\\!\\mathrm{C_{-1}}=121.7^\\circ$, $\\angle \\mathrm{N}\\!-\\!\\mathrm{C_{-1}}\\!-\\!\\mathrm{O_{-1}}=120.0^\\circ$, $\\angle \\mathrm{C_\\alpha}\\!-\\!\\mathrm{C}\\!-\\!\\mathrm{N_{+1}}=116.2^\\circ$。\n- **参考几何结构构建**：\n    - 初始肽平面为 $x$–$y$ 平面。\n    - $\\mathrm{N}$ 位于原点 $(0,0,0)$。$\\mathrm{C_\\alpha}$ 位于 $x$ 轴上。\n    - 主链 $\\mathrm{N}-\\mathrm{C_\\alpha}-\\mathrm{C}$ 位于 $x$–$y$ 平面内。\n    - 前一个基团 $(\\mathrm{C_{-1}}, \\mathrm{O_{-1}})$ 和后一个原子 $(\\mathrm{N_{+1}})$ 也被放置在该平面内，并提到了“反式”肽键的特性。\n    - $\\mathrm{C_\\beta}$ 初始沿肽平面法线方向放置。\n- **二面角与旋转**：\n    - $\\phi = \\angle(\\mathrm{C_{-1}}, \\mathrm{N}, \\mathrm{C_\\alpha}, \\mathrm{C})$, $\\psi = \\angle(\\mathrm{N}, \\mathrm{C_\\alpha}, \\mathrm{C}, \\mathrm{N_{+1}})$。\n    - 通过旋转刚性基团来实现目标 $(\\phi,\\psi)$ 值：旋转 $\\{\\mathrm{C_{-1}}, \\mathrm{O_{-1}}\\}$ 围绕 $\\mathrm{N}-\\mathrm{C_\\alpha}$ 轴以改变 $\\phi$，旋转 $\\{\\mathrm{O}, \\mathrm{N_{+1}}\\}$ 围绕 $\\mathrm{C_\\alpha}-\\mathrm{C}$ 轴以改变 $\\psi$。\n    - 旋转使用提供的罗德里格斯公式执行。\n- **空间位阻冲突模型**：\n    - 如果两个非键合原子 $i, j$ 之间的距离 $d_{ij}$ 小于 $s(r_i+r_j)$，则发生冲突，其中 $r_i, r_j$ 是 vdW 半径，$s$ 是缩放因子。\n    - 排除项：键合对（1-2对）或由两个键分隔的原子对（1-3对）不进行冲突检查。\n- **范德华半径（单位为Å）**：$\\mathrm{N}: 1.55$, $\\mathrm{C}: 1.70$, $\\mathrm{O}: 1.52$, 联合原子甲基 $\\mathrm{C_\\beta}: 2.00$。其他原子根据其元素类型分配半径（$\\mathrm{C_\\alpha, C, C_{-1}}$ 是碳；$\\mathrm{N_{+1}}$ 是氮；$\\mathrm{O_{-1}}$ 是氧）。\n- **计算任务**：\n    - 在 $[-180, 180]$（含边界）的均匀网格上采样 $(\\phi,\\psi)$。\n    - 计算允许区域分数：（无冲突构象数）/（总网格点数）。\n- **测试用例**：六对 $(\\Delta, s)$，其中 $\\Delta$ 是网格步长（单位为度），$s$ 是半径缩放因子：$(60,1.0), (60,0.95), (20,1.0), (20,0.95), (10,1.0), (10,0.95)$。\n- **输出**：一个单行列表，包含六个浮点数，保留六位小数，格式为 `[f1,f2,f3,f4,f5,f6]`。\n\n#### 第2步：使用提取的已知信息进行验证\n该问题具有科学依据、适定且客观。它描述了计算生物物理学中一个标准的、简化的练习。几何参数、物理模型（硬球）和数学定义（二面角、罗德里格斯旋转）都是标准且正确的。几何构建的指令足够详细，可以创建一个明确定义的初始分子结构。尽管“反式肽键”这一短语在其他明确的平面构建规则的背景下可能会引入轻微的歧义，但将明确的规则作为首要解释可以得出一个一致且可形式化的过程。该问题是自洽的，没有科学缺陷、矛盾或不可行的要求。\n\n#### 第3步：结论与行动\n该问题是**有效的**。将根据经过验证的规范构建一个解决方案。\n\n### 解决方案设计\n\n解决方案将遵循从问题陈述中得出的清晰、分步的流程来实现。\n\n1.  **参考几何结构构建**：首先，我们根据提供的几何参数构建丙氨酸二肽片段的参考构象。除 $\\mathrm{C_\\beta}$ 原子外，所有原子最初都放置在 $x,y$-平面中。\n    - 将 $\\mathrm{N}$ 置于原点 $\\mathbf{r}_N = (0, 0, 0)$。\n    - 将 $\\mathrm{C_\\alpha}$ 置于 $x$ 轴正半轴上，坐标为 $\\mathbf{r}_{C\\alpha} = (1.458, 0, 0)$。\n    - 将 $\\mathrm{C}$ 放置在 $x,y$-平面中，以满足 $\\lVert \\mathbf{r}_C - \\mathbf{r}_{C\\alpha} \\rVert = 1.525$ 和 $\\angle \\mathrm{N-C_\\alpha-C} = 110.1^\\circ$。我们选择 $y$ 坐标为正的解。\n    - 其他原子（$\\mathrm{C_{-1}}, \\mathrm{O_{-1}}, \\mathrm{O}, \\mathrm{N_{+1}}$）根据它们的键长和键角，相对于核心主链原子放置在 $x,y$-平面中。构建方式选择创建一个参考状态，其中初始二面角 $\\phi_0$ 和 $\\psi_0$ 均为 $0^\\circ$（顺-顺式构象）。这是一个明确定义的起点。\n    - 将 $\\mathrm{C_\\beta}$ 垂直于该平面放置，坐标为 $\\mathbf{r}_{C\\beta} = \\mathbf{r}_{C\\alpha} + (0, 0, 1.530)$。\n\n2.  **二面角旋转**：为生成任意构象 $(\\phi, \\psi)$，我们从参考几何结构开始，并按规定执行刚体旋转。\n    - **$\\phi$ 旋转**：原子基团 $\\{\\mathrm{C_{-1}}, \\mathrm{O_{-1}}\\}$ 围绕由向量 $\\mathbf{r}_{C\\alpha} - \\mathbf{r}_{N}$ 定义、通过点 $\\mathbf{r}_{N}$ 的轴旋转角度 $\\phi$。\n    - **$\\psi$ 旋转**：原子基团 $\\{\\mathrm{O}, \\mathrm{N_{+1}}\\}$ 围绕由向量 $\\mathbf{r}_{C} - \\mathbf{r}_{C\\alpha}$ 定义、通过点 $\\mathbf{r}_{C\\alpha}$ 的轴旋转角度 $\\psi$。\n    - 旋转使用提供的罗德里格斯旋转公式实现。所有角度在使用三角函数前必须从度转换为弧度。\n\n3.  **空间位阻冲突检测**：对于每个生成的构象，我们检查是否存在空间位阻冲突。\n    - **排除列表**：我们首先确定所有免于冲突检测的原子对。这些是 1-2 对（共价键合）和 1-3 对（由两个键分隔）。这可以通过在分子连接图中找到图距离为 $1$ 或 $2$ 的所有原子对来确定。\n    - **冲突检查**：对于所有其他原子对 $(i, j)$，我们计算欧几里得距离 $d_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert$。如果 $d_{ij}  s(r_i + r_j)$，则发生冲突，其中 $r_i$ 和 $r_j$ 是各自的范德华半径，$s$ 是给定的缩放因子。\n\n4.  **网格采样与分数计算**：构象空间在从 $-180^\\circ$ 到 $180^\\circ$（含边界）、步长为 $\\Delta$ 的 $(\\phi, \\psi)$ 均匀网格上进行采样。\n    - 对于每个测试用例 $(\\Delta, s)$，我们遍历所有网格点。\n    - 我们统计其对应构象没有任何空间位阻冲突的网格点数 $N_{allowed}$。\n    - 网格点总数为 $N_{total} = (360/\\Delta + 1)^2$。\n    - 允许区域分数计算为 $f = N_{allowed} / N_{total}$。\n\n5.  **实现**：该算法将按要求使用 Python 的 `numpy` 库来实现，以进行高效的向量和矩阵运算。最终的程序结构将包含所有这些步骤，以处理指定的测试用例并按所需格式生成输出。",
            "answer": "```python\nimport numpy as np\nfrom collections import defaultdict\n\n# No further imports, including scipy, are necessary for this problem.\n\ndef rodrigues_rotation(points, p_axis, axis_vec, angle_rad):\n    \"\"\"\n    Rotates a set of points around an axis using Rodrigues' formula.\n    \n    Args:\n        points (np.ndarray): Array of points to rotate (Nx3).\n        p_axis (np.ndarray): A point on the axis of rotation (3,).\n        axis_vec (np.ndarray): Direction vector of the axis of rotation (3,).\n        angle_rad (float): The angle of rotation in radians.\n    \n    Returns:\n        np.ndarray: The array of rotated points (Nx3).\n    \"\"\"\n    # Ensure axis vector is normalized\n    axis_vec = axis_vec / np.linalg.norm(axis_vec)\n    \n    # Use broadcasting for vector operations\n    v = points - p_axis\n    \n    cos_theta = np.cos(angle_rad)\n    sin_theta = np.sin(angle_rad)\n    \n    # Rodrigues' formula components\n    term1 = v * cos_theta\n    term2 = np.cross(axis_vec, v) * sin_theta\n    \n    # Handle dot product for multiple points in v\n    v_dot_axis = np.dot(v, axis_vec)\n    term3 = np.outer(v_dot_axis, axis_vec) * (1 - cos_theta)\n    \n    v_rot = term1 + term2 + term3\n    \n    return p_axis + v_rot\n\ndef build_reference_geometry():\n    \"\"\"\n    Constructs coordinates of the alanine fragment in a reference planar conformation\n    corresponding to phi=0, psi=0 degrees.\n    \"\"\"\n    rad = np.deg2rad\n    \n    # Geometric parameters\n    L_NCa, L_CaC, L_CO, L_NCm1, L_Cm1Om1, L_CNp1, L_CaCb = 1.458, 1.525, 1.229, 1.330, 1.229, 1.330, 1.530\n    A_NCaC, A_CaCO, A_CaNCm1, A_NCm1Om1, A_CaCNp1 = rad(110.1), rad(120.0), rad(121.7), rad(120.0), rad(116.2)\n\n    coords = {}\n    \n    # Central backbone N-Ca-C in xy-plane\n    coords['N'] = np.array([0., 0., 0.])\n    coords['Ca'] = np.array([L_NCa, 0., 0.])\n    \n    # Place C in xy-plane with y > 0\n    coords['C'] = np.array([\n        L_NCa + L_CaC * np.cos(np.pi - A_NCaC),\n        L_CaC * np.sin(np.pi - A_NCaC),\n        0.\n    ])\n\n    # Place upstream group {Cm1, Om1} for phi=0\n    coords['Cm1'] = np.array([\n        L_NCm1 * np.cos(A_CaNCm1),\n        L_NCm1 * np.sin(A_CaNCm1),\n        0.\n    ])\n    v_Cm1N = coords['N'] - coords['Cm1']\n    angle_Cm1N = np.arctan2(v_Cm1N[1], v_Cm1N[0])\n    angle_Cm1Om1 = angle_Cm1N - A_NCm1Om1\n    coords['Om1'] = coords['Cm1'] + np.array([\n        L_Cm1Om1 * np.cos(angle_Cm1Om1),\n        L_Cm1Om1 * np.sin(angle_Cm1Om1),\n        0.\n    ])\n    \n    # Place downstream group {O, Np1} for psi=0\n    v_CCa = coords['Ca'] - coords['C']\n    angle_CCa = np.arctan2(v_CCa[1], v_CCa[0])\n    \n    angle_CNp1 = angle_CCa + A_CaCNp1\n    coords['Np1'] = coords['C'] + np.array([\n        L_CNp1 * np.cos(angle_CNp1),\n        L_CNp1 * np.sin(angle_CNp1),\n        0.\n    ])\n    \n    angle_CO = angle_CCa - A_CaCO\n    coords['O'] = coords['C'] + np.array([\n        L_CO * np.cos(angle_CO),\n        L_CO * np.sin(angle_CO),\n        0.\n    ])\n    \n    # Place sidechain Cb perpendicular to plane\n    coords['Cb'] = coords['Ca'] + np.array([0., 0., L_CaCb])\n\n    return coords\n    \ndef get_nonbonded_pairs_to_check(atom_names):\n    \"\"\"\n    Determines atom pairs to be checked for steric clashes by excluding 1-2 and 1-3 pairs.\n    \"\"\"\n    connectivity = {\n        'N': ['Ca', 'Cm1'], 'Ca': ['N', 'C', 'Cb'], 'C': ['Ca', 'O', 'Np1'],\n        'O': ['C'], 'Cm1': ['N', 'Om1'], 'Om1': ['Cm1'], 'Np1': ['C'], 'Cb': ['Ca']\n    }\n    \n    name_to_idx = {name: i for i, name in enumerate(atom_names)}\n    idx_to_name = {i: name for i, name in enumerate(atom_names)}\n    \n    adj = defaultdict(list)\n    for u, neighbors in connectivity.items():\n        for v in neighbors:\n            adj[name_to_idx[u]].append(name_to_idx[v])\n\n    num_atoms = len(atom_names)\n    pairs_to_check = []\n    for i in range(num_atoms):\n        for j in range(i + 1, num_atoms):\n            # Check for path of length 1 or 2\n            # dist 1\n            if j in adj[i]:\n                continue\n            # dist 2\n            is_dist_2 = False\n            for neighbor in adj[i]:\n                if j in adj[neighbor]:\n                    is_dist_2 = True\n                    break\n            if is_dist_2:\n                continue\n            \n            pairs_to_check.append((i, j))\n            \n    return pairs_to_check\n\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        (60, 1.0), (60, 0.95), (20, 1.0), (20, 0.95), (10, 1.0), (10, 0.95)\n    ]\n    \n    atom_names = ['N', 'Ca', 'C', 'O', 'Cm1', 'Om1', 'Np1', 'Cb']\n    radii_map = {'N': 1.55, 'Ca': 1.70, 'C': 1.70, 'O': 1.52, 'Cm1': 1.70, 'Om1': 1.52, 'Np1': 1.55, 'Cb': 2.00}\n    radii = np.array([radii_map[name] for name in atom_names])\n\n    ref_coords_dict = build_reference_geometry()\n    ref_coords = np.array([ref_coords_dict[name] for name in atom_names])\n    \n    pairs_to_check = get_nonbonded_pairs_to_check(atom_names)\n\n    results = []\n    \n    for grid_step, scale_factor in test_cases:\n        angle_range = np.arange(-180, 180 + grid_step, grid_step)\n        \n        allowed_count = 0\n        total_points = len(angle_range)**2\n\n        # Pre-calculate clash thresholds\n        radii_sums = np.zeros((len(atom_names), len(atom_names)))\n        for i, j in pairs_to_check:\n            radii_sums[i, j] = scale_factor * (radii[i] + radii[j])\n        \n        for phi in angle_range:\n            for psi in angle_range:\n                current_coords = ref_coords.copy()\n                \n                # Apply phi rotation to {Cm1, Om1}\n                phi_rad = np.deg2rad(phi)\n                axis_phi = ref_coords[1] - ref_coords[0] # Ca - N\n                p_axis_phi = ref_coords[0] # N\n                indices_phi = [4, 5] # Cm1, Om1\n                current_coords[indices_phi] = rodrigues_rotation(current_coords[indices_phi], p_axis_phi, axis_phi, phi_rad)\n                \n                # Apply psi rotation to {O, Np1}\n                psi_rad = np.deg2rad(psi)\n                axis_psi = ref_coords[2] - ref_coords[1] # C - Ca\n                p_axis_psi = ref_coords[1] # Ca\n                indices_psi = [3, 6] # O, Np1\n                current_coords[indices_psi] = rodrigues_rotation(current_coords[indices_psi], p_axis_psi, axis_psi, psi_rad)\n                \n                # Check for steric clashes\n                has_clash = False\n                for i, j in pairs_to_check:\n                    dist_sq = np.sum((current_coords[i] - current_coords[j])**2)\n                    clash_dist_sq = radii_sums[i, j]**2\n                    if dist_sq  clash_dist_sq:\n                        has_clash = True\n                        break\n                \n                if not has_clash:\n                    allowed_count += 1\n        \n        fraction = allowed_count / total_points\n        results.append(round(fraction, 6))\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "拉马钱德兰图不仅是构象允许区的图示，它更是一个二维自由能地貌的体现，即平均力势 (PMF)。通过分析一个离散化的PMF网格，我们可以识别出对应于稳定二级结构（如 $\\alpha$-螺旋和 $\\beta$-折叠）的能量盆地，并估算它们之间的能量转换势垒。这个练习将让你直接运用热力学概念来解读构象稳定性与转变 。",
            "id": "3861099",
            "problem": "肽主链的 Ramachandran map 由二面角 $\\phi$ 和 $\\psi$（单位为度）参数化。构象自由能景观由平均力势（PMF）$F(\\phi,\\psi)$ 描述，这是一种通过从玻尔兹曼分布中积分掉所有其他自由度而获得的自由能。根据定义，$F(\\phi,\\psi)$ 与边际概率密度 $P(\\phi,\\psi)$ 的关系为 $F(\\phi,\\psi) = - k_{B} T \\ln P(\\phi,\\psi) + C$，其中 $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度，$C$ 是一个加性常数。在本问题中，直接提供了一个离散化的 PMF $F(\\phi,\\psi)$，它定义在一个矩形网格上，角度单位为度，能量单位为千焦耳/摩尔 (kJ/mol)。\n\n设 $\\phi$ 的网格点为 $\\Phi = \\left(-150^{\\circ}, -120^{\\circ}, -90^{\\circ}, -60^{\\circ}, -30^{\\circ}\\right)$，$\\psi$ 的网格点为 $\\Psi = \\left(-150^{\\circ}, -90^{\\circ}, -45^{\\circ}, 45^{\\circ}, 135^{\\circ}\\right)$。PMF 的值由一个 $5 \\times 5$ 矩阵 $M$ 给出，其 $(j,i)$ 元等于 $F(\\phi_{i},\\psi_{j})$，其中行按 $\\Psi$ 排序，列按 $\\Phi$ 排序：\n$$\nM = \\begin{pmatrix}\n3.90  3.20  4.10  3.50  4.40 \\\\\n2.90  3.40  2.60  0.78  1.90 \\\\\n3.00  2.20  1.07  0.42  1.36 \\\\\n4.60  5.12  5.60  4.83  3.70 \\\\\n2.10  1.25  1.68  2.40  3.20\n\\end{pmatrix}.\n$$\nα-螺旋构象池位于 $\\phi \\approx -60^{\\circ}$ 和 $\\psi \\approx -45^{\\circ}$ 附近，β-折叠构象池位于 $\\phi \\approx -120^{\\circ}$ 和 $\\psi \\approx 135^{\\circ}$ 附近。假设此网格上的构象池极小值是通过与离散化 PMF 中的四邻域模板（上、下、左、右）进行严格的局部比较来确定的。\n\n就本问题而言，定义两个构象池之间的能垒高度为连接两个极小值的以下离散路径 $P$ 上的最大 PMF 与两个构象池极小值能量中较低者之差。路径 $P$ 是以下网格点的有序序列：\n$$\nP:~(-60^{\\circ},-45^{\\circ}) \\to (-60^{\\circ},45^{\\circ}) \\to (-90^{\\circ},45^{\\circ}) \\to (-120^{\\circ},45^{\\circ}) \\to (-120^{\\circ},135^{\\circ}).\n$$\n\n任务：\n- 通过识别网格上指定区域附近的局部极小值，确定 α 和 β 构象池的自由能极小值 $F_{\\alpha}$ 和 $F_{\\beta}$。\n- 计算沿路径 $P$ 的能垒高度，定义为 $\\max_{(\\phi,\\psi)\\in P} F(\\phi,\\psi) - \\min\\{F_{\\alpha},F_{\\beta}\\}$。\n\n将最终答案以行矩阵 $\\left(F_{\\alpha},~F_{\\beta},~\\text{barrier}\\right)$ 的形式报告，其中能量单位为千焦耳/摩尔。将您的数值四舍五入到四位有效数字。整个问题中，角度均应以度为单位进行解释。",
            "solution": "用户提供的问题具有科学依据、提法明确、客观，并包含获得唯一解所需的所有必要信息。所提出的概念——Ramachandran plot、平均力势（PMF）和构象能量池——是计算化学生物学的基础。局部极小值和能垒高度的定义是明确的，可以直接进行计算。因此，该问题是有效的，我将着手解决。\n\n问题要求三个量：α-螺旋构象池的自由能极小值 $F_{\\alpha}$；β-折叠构象池的自由能极小值 $F_{\\beta}$；以及它们之间沿指定路径的能垒。所有能量的单位均为千焦耳/摩尔（kJ/mol）。\n\n首先，我们必须建立二面角对 $(\\phi, \\psi)$ 与给定 PMF 矩阵 $M$ 的索引之间的对应关系。$\\phi$ 和 $\\psi$ 的网格点给出如下：\n$\\Phi = (\\phi_1, \\phi_2, \\phi_3, \\phi_4, \\phi_5) = (-150^{\\circ}, -120^{\\circ}, -90^{\\circ}, -60^{\\circ}, -30^{\\circ})$\n$\\Psi = (\\psi_1, \\psi_2, \\psi_3, \\psi_4, \\psi_5) = (-150^{\\circ}, -90^{\\circ}, -45^{\\circ}, 45^{\\circ}, 135^{\\circ})$\n矩阵元 $M_{j,i}$ 对应于自由能 $F(\\phi_{i},\\psi_{j})$。\n\n**步骤 1：确定自由能极小值 $F_{\\alpha}$**\n题目说明 α-螺旋构象池位于 $(\\phi, \\psi) \\approx (-60^{\\circ}, -45^{\\circ})$ 附近。查阅网格定义，这对应于点 $(\\phi_4, \\psi_3)$。该点的自由能由矩阵元 $M_{3,4}$ 给出。\n$$ M = \\begin{pmatrix} \\cdot  \\cdot  \\cdot  \\cdot  \\cdot \\\\ \\cdot  \\cdot  \\cdot  0.78  \\cdot \\\\ \\cdot  \\cdot  1.07  \\mathbf{0.42}  1.36 \\\\ \\cdot  \\cdot  \\cdot  4.83  \\cdot \\\\ \\cdot  \\cdot  \\cdot  \\cdot  \\cdot \\end{pmatrix} $$\n所以，$F(\\phi_4, \\psi_3) = M_{3,4} = 0.42$ kJ/mol。\n\n为了确认这是一个构象池极小值，我们必须根据问题定义，检查其能量是否严格低于其在网格上的四个邻居（上、下、左、右）。点 $(\\phi_4, \\psi_3)$ 对应于矩阵的一个内部点，因此它有四个邻居。\n- 上方邻居（较小的 $j$）：$F(\\phi_4, \\psi_2) = M_{2,4} = 0.78$ kJ/mol。\n- 下方邻居（较大的 $j$）：$F(\\phi_4, \\psi_4) = M_{4,4} = 4.83$ kJ/mol。\n- 左侧邻居（较小的 $i$）：$F(\\phi_3, \\psi_3) = M_{3,3} = 1.07$ kJ/mol。\n- 右侧邻居（较大的 $i$）：$F(\\phi_5, \\psi_3) = M_{3,5} = 1.36$ kJ/mol。\n\n将 $(\\phi_4, \\psi_3)$ 处的能量与其邻居进行比较：\n$0.42  0.78$\n$0.42  4.83$\n$0.42  1.07$\n$0.42  1.36$\n由于 $(\\phi_4, \\psi_3)$ 处的能量严格低于其所有四个邻居，因此它是一个局部极小值。我们将其确定为 α-螺旋构象池的能量。\n$F_{\\alpha} = 0.42$ kJ/mol。\n\n**步骤 2：确定自由能极小值 $F_{\\beta}$**\n题目说明 β-折叠构象池位于 $(\\phi, \\psi) \\approx (-120^{\\circ}, 135^{\\circ})$ 附近。这对应于点 $(\\phi_2, \\psi_5)$。该点的能量由矩阵元 $M_{5,2}$ 给出。\n$$ M = \\begin{pmatrix} \\cdot  \\cdot  \\cdot  \\cdot  \\cdot \\\\ \\cdot  \\cdot  \\cdot  \\cdot  \\cdot \\\\ \\cdot  \\cdot  \\cdot  \\cdot  \\cdot \\\\ \\cdot  5.12  \\cdot  \\cdot  \\cdot \\\\ 2.10  \\mathbf{1.25}  1.68  \\cdot  \\cdot \\end{pmatrix} $$\n所以，$F(\\phi_2, \\psi_5) = M_{5,2} = 1.25$ kJ/mol。\n\n为了确认这是一个极小值，我们检查其邻居。点 $(\\phi_2, \\psi_5)$ 位于网格的边界上（$j=5$），因此只有三个邻居。我们对这些存在的邻居应用严格比较规则。\n- 上方邻居（较小的 $j$）：$F(\\phi_2, \\psi_4) = M_{4,2} = 5.12$ kJ/mol。\n- 左侧邻居（较小的 $i$）：$F(\\phi_1, \\psi_5) = M_{5,1} = 2.10$ kJ/mol。\n- 右侧邻居（较大的 $i$）：$F(\\phi_3, \\psi_5) = M_{5,3} = 1.68$ kJ/mol。\n\n将 $(\\phi_2, \\psi_5)$ 处的能量与其邻居进行比较：\n$1.25  5.12$\n$1.25  2.10$\n$1.25  1.68$\n由于 $(\\phi_2, \\psi_5)$ 处的能量严格低于其所有存在的邻居，因此它符合局部极小值的条件。我们将其确定为 β-折叠构象池的能量。\n$F_{\\beta} = 1.25$ kJ/mol。\n\n**步骤 3：计算能垒高度**\n能垒高度定义为 $\\max_{(\\phi,\\psi)\\in P} F(\\phi,\\psi) - \\min\\{F_{\\alpha},F_{\\beta}\\}$。\n首先，我们确定两个构象池极小值中较低的一个：\n$\\min\\{F_{\\alpha}, F_{\\beta}\\} = \\min\\{0.42, 1.25\\} = 0.42$ kJ/mol。\n\n接下来，我们评估沿指定路径 $P$ 的每个点的 PMF $F(\\phi,\\psi)$：\n$P: (-60^{\\circ},-45^{\\circ}) \\to (-60^{\\circ},45^{\\circ}) \\to (-90^{\\circ},45^{\\circ}) \\to (-120^{\\circ},45^{\\circ}) \\to (-120^{\\circ},135^{\\circ})$\n让我们找出这五个点的能量：\n1. $F(-60^{\\circ}, -45^{\\circ}) = F(\\phi_4, \\psi_3) = M_{3,4} = 0.42$ kJ/mol。\n2. $F(-60^{\\circ}, 45^{\\circ}) = F(\\phi_4, \\psi_4) = M_{4,4} = 4.83$ kJ/mol。\n3. $F(-90^{\\circ}, 45^{\\circ}) = F(\\phi_3, \\psi_4) = M_{4,3} = 5.60$ kJ/mol。\n4. $F(-120^{\\circ}, 45^{\\circ}) = F(\\phi_2, \\psi_4) = M_{4,2} = 5.12$ kJ/mol。\n5. $F(-120^{\\circ}, 135^{\\circ}) = F(\\phi_2, \\psi_5) = M_{5,2} = 1.25$ kJ/mol。\n\n路径 $P$ 上的能量集合为 $\\{0.42, 4.83, 5.60, 5.12, 1.25\\}$。此路径上的最大能量是：\n$\\max_{(\\phi,\\psi)\\in P} F(\\phi,\\psi) = \\max\\{0.42, 4.83, 5.60, 5.12, 1.25\\} = 5.60$ kJ/mol。\n\n现在我们可以计算能垒高度：\n$\\text{Barrier} = \\max_{(\\phi,\\psi)\\in P} F(\\phi,\\psi) - \\min\\{F_{\\alpha}, F_{\\beta}\\} = 5.60 - 0.42 = 5.18$ kJ/mol。\n\n**步骤 4：最终答案的构建**\n问题要求将 $(F_{\\alpha}, F_{\\beta}, \\text{barrier})$ 的结果四舍五入到四位有效数字。\n- $F_{\\alpha} = 0.42$ 变为 $0.4200$。\n- $F_{\\beta} = 1.25$ 变为 $1.250$。\n- 能垒 $= 5.18$ 变为 $5.180$。\n\n最终答案以行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.4200  1.250  5.180\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在蛋白质结构生物学中，拉马钱德兰图是评估实验或计算模型质量的关键工具。我们可以用一个复杂的概率模型来精确描述（$\\phi$,$\\psi$）角的分布，而不是简单的区域划分，从而定义“优选”、“允许”和“异常”区域。此练习将引导你应用一个基于冯·米塞斯分布混合模型的知识库方法，来对残基构象进行分类并根据标准阈值验证蛋白质结构的合理性 。",
            "id": "3861147",
            "problem": "给定一个简化的、基于物理动机和知识的骨架扭转角分布模型，该模型用于在拉马钱德兰图（Ramachandran plot）上对残基进行分类。骨架扭转角是由连续肽平面几何结构定义的二面角 $\\phi$ 和 $\\psi$。由于 $\\phi$ 和 $\\psi$ 是圆上的角度变量，因此构象偏好具有周期性。我们将 $(\\phi,\\psi)$ 的联合分布建模为二维环面上独立的 von Mises 组分的混合，这反映了公认的典型区域（右旋 $\\alpha$ 螺旋、$\\beta$ 折叠、聚脯氨酸 II 型螺旋、左旋 $\\alpha$ 螺旋）。该模型由以下以弧度为单位的概率密度函数（Probability Density Function (PDF)）指定：\n$$\np(\\phi,\\psi) \\;=\\; \\sum_{j=1}^{J} w_j\\, f_{\\mathrm{VM}}(\\phi;\\mu_{\\phi,j},\\kappa_{\\phi,j})\\, f_{\\mathrm{VM}}(\\psi;\\mu_{\\psi,j},\\kappa_{\\psi,j}),\n$$\n其中 $J$ 是混合组分的数量，$w_j$ 是非负权重且满足 $\\sum_{j=1}^{J} w_j = 1$，$\\mu_{\\phi,j}$ 和 $\\mu_{\\psi,j}$ 是组分均值（以弧度为单位），$\\kappa_{\\phi,j}$ 和 $\\kappa_{\\psi,j}$ 是集中度参数。一维 von Mises 密度（以弧度为单位）为：\n$$\nf_{\\mathrm{VM}}(\\theta;\\mu,\\kappa) \\;=\\; \\frac{e^{\\kappa \\cos(\\theta-\\mu)}}{2\\pi I_0(\\kappa)},\n$$\n其中 $I_0$ 是第一类 0 阶修正贝塞尔函数。混合参数如下：\n- $J = 4$,\n- $(w_1,w_2,w_3,w_4) = (0.55,\\,0.35,\\,0.07,\\,0.03)$,\n- 组分 1（右旋 $\\alpha$ 螺旋）: $(\\mu_{\\phi,1},\\mu_{\\psi,1}) = (-60^\\circ,-45^\\circ)$, $(\\kappa_{\\phi,1},\\kappa_{\\psi,1}) = (25,\\,25)$,\n- 组分 2（$\\beta$ 折叠）: $(\\mu_{\\phi,2},\\mu_{\\psi,2}) = (-135^\\circ,135^\\circ)$, $(\\kappa_{\\phi,2},\\kappa_{\\psi,2}) = (35,\\,20)$,\n- 组分 3（聚脯氨酸 II 型螺旋）: $(\\mu_{\\phi,3},\\mu_{\\psi,3}) = (-75^\\circ,145^\\circ)$, $(\\kappa_{\\phi,3},\\kappa_{\\psi,3}) = (15,\\,15)$,\n- 组分 4（左旋 $\\alpha$ 螺旋）: $(\\mu_{\\phi,4},\\mu_{\\psi,4}) = (60^\\circ,30^\\circ)$, $(\\kappa_{\\phi,4},\\kappa_{\\psi,4}) = (20,\\,20)$.\n在计算时，必须使用 $\\theta_{\\mathrm{rad}} = \\theta_{\\mathrm{deg}}\\times\\pi/180$ 将角度从度转换为弧度。\n\n将最优区域 $L_f$ 定义为捕获指定高概率质量 $p_f$ 的密度上水平集，即\n$$\nL_f \\;=\\; \\{(\\phi,\\psi) \\;:\\; p(\\phi,\\psi) \\;\\ge\\; \\tau_f\\}, \\quad \\text{其中 } \\iint_{L_f} p(\\phi,\\psi)\\, d\\phi\\, d\\psi \\;=\\; p_f,\n$$\n其中 $p_f = 0.98$。类似地，使用 $p_a = 0.999$ 和阈值 $\\tau_a$ 定义允许区域 $L_a$，即\n$$\nL_a \\;=\\; \\{(\\phi,\\psi) \\;:\\; p(\\phi,\\psi) \\;\\ge\\; \\tau_a\\}, \\quad \\text{其中 } \\iint_{L_a} p(\\phi,\\psi)\\, d\\phi\\, d\\psi \\;=\\; p_a.\n$$\n角度为 $(\\phi_i,\\psi_i)$ 的残基分类如下：如果 $(\\phi_i,\\psi_i)\\in L_f$，则为最优区；如果 $(\\phi_i,\\psi_i)\\in L_a\\setminus L_f$，则为仅允许区；如果 $(\\phi_i,\\psi_i)\\notin L_a$，则为离群区。各部分的分数定义为：\n$$\nF_f \\;=\\; \\frac{N_f}{N},\\quad F_{ao} \\;=\\; \\frac{N_{ao}}{N},\\quad F_o \\;=\\; \\frac{N_o}{N},\n$$\n其中，$N$ 是残基总数，$N_f$ 是最优区残基的数量，$N_{ao}$ 是仅允许区残基的数量，$N_o$ 是离群区残基的数量。总允许区分数为 $F_{\\mathrm{inc}} = F_f + F_{ao}$。\n\n通过数值方法近似计算阈值 $\\tau_f$ 和 $\\tau_a$。具体方法为：将 $(\\phi,\\psi)$ 域在 $[-180^\\circ,180^\\circ]\\times[-180^\\circ,180^\\circ]$ 范围内以 $\\Delta = 1^\\circ$ 的步长均匀离散化为网格，在每个网格点计算 $p(\\phi,\\psi)$ 时将角度转换为弧度，将网格点上的密度值按降序排序，并选择其累积黎曼和首次等于或超过 $p_f$（或 $p_a$）的最小密度值。使用黎曼矩形面积 $A_{\\mathrm{cell}} = (\\Delta\\pi/180)^2$。\n\n最后，将计算出的分数与标准验证阈值进行比较，并为每个案例报告三个布尔测试结果：\n- 最优区分数测试：$F_f \\ge \\theta_f$，其中 $\\theta_f = 0.95$，\n- 允许区（总）分数测试：$F_{\\mathrm{inc}} \\ge \\theta_a$，其中 $\\theta_a = 0.99$，\n- 离群区分数测试：$F_o \\le \\theta_o$，其中 $\\theta_o = 0.01$。\n\n角度应以度为单位进行解释，程序必须以四舍五入到三位小数的小数形式输出分数。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，每个元素对应一个测试用例，并且本身是一个包含六个条目的列表，顺序为 $[F_f, F_{ao}, F_o, \\text{favored\\_pass}, \\text{allowed\\_pass}, \\text{outlier\\_pass}]$。\n\n请使用以下残基角度集（以度为单位）的测试套件：\n- 测试用例 1（$N=10$ 个残基）：\n  $[(-60,-45),\\,(-58,-47),\\,(-62,-50),\\,(-130,130),\\,(-135,135),\\,(-75,145),\\,(60,30),\\,(-120,120),\\,(0,0),\\,(-61,-44)]$.\n- 测试用例 2（$N=12$ 个残基）：\n  $[(-179,179),\\,(179,-179),\\,(-180,180),\\,(-75,145),\\,(60,30),\\,(-60,130),\\,(-140,140),\\,(-65,-40),\\,(-135,120),\\,(62,28),\\,(170,-170),\\,(-170,170)]$.\n- 测试用例 3（$N=14$ 个残基）：\n  $[(0,180),\\,(180,0),\\,(90,-90),\\,(-90,90),\\,(120,0),\\,(0,-120),\\,(-45,160),\\,(80,80),\\,(-80,-80),\\,(-130,130),\\,(-60,-45),\\,(-135,135),\\,(10,10),\\,(-10,-10)]$.\n\n您的任务是实现一个程序，该程序能够：\n- 使用上述基于网格的近似方法计算 $\\tau_f$ 和 $\\tau_a$，\n- 对每个测试用例中的每个残基进行分类，\n- 计算 $F_f$、$F_{ao}$、$F_o$ 以及三个验证布尔值，其中分数四舍五入到三位小数，\n- 并以上述确切格式输出单行结果。",
            "solution": "问题陈述已经过分析，并被确定为**有效**。它在科学上基于计算结构生物学的原理，特别是蛋白质骨架构象的统计分析。这是一个适定问题，提供了完整且一致的定义、参数和数值程序集。所有术语都经过客观和数学上的定义，从而可以得到唯一且可验证的解。\n\n任务是根据概率模型对由二面角 $(\\phi, \\psi)$ 定义的蛋白质残基骨架构象进行分类，然后对给定的残基集进行统计验证。解决方案涉及三个主要阶段：\n1.  确定定义“最优”和“允许”构象区域的概率密度阈值。\n2.  根据这些阈值对单个残基进行分类。\n3.  计算每个类别中残基的比例，并将其与标准质量控制基准进行比较。\n\n**1. 骨架构象的概率模型**\n\n蛋白质骨架的构象空间由二面角 $(\\phi, \\psi)$ 描述。该问题以概率密度函数 $p(\\phi,\\psi)$ 的形式提供了一个基于知识的能量模型。该函数被构建为一个混合模型，它是一些更简单分布的总和，每个分布代表一个典型的蛋白质二级结构元件。\n$$\np(\\phi,\\psi) \\;=\\; \\sum_{j=1}^{J} w_j\\, f_{\\mathrm{VM}}(\\phi;\\mu_{\\phi,j},\\kappa_{\\phi,j})\\, f_{\\mathrm{VM}}(\\psi;\\mu_{\\psi,j},\\kappa_{\\psi,j})\n$$\n在这里，$J=4$ 个组分分别对应于右旋 $\\alpha$-螺旋、$\\beta$-折叠、聚脯氨酸 II 型螺旋和左旋 $\\alpha$-螺旋。每个组分由 $w_j$ 加权，代表其在大型蛋白质结构数据库中的普遍性。角度 $\\phi$ 和 $\\psi$ 是周期性的，因此每个角度的适当概率分布是 von Mises 分布，它是正态分布在圆形上的类似物。von Mises 概率密度函数（PDF）由下式给出：\n$$\nf_{\\mathrm{VM}}(\\theta;\\mu,\\kappa) \\;=\\; \\frac{e^{\\kappa \\cos(\\theta-\\mu)}}{2\\pi I_0(\\kappa)}\n$$\n参数 $\\mu$ 和 $\\kappa$ 分别代表平均角度和集中度（方差的倒数）。$I_0(\\kappa)$ 是第一类 0 阶修正贝塞尔函数，它充当归一化常数，确保分布在圆 $[-\\pi, \\pi]$ 上的积分为 1。完整的 $p(\\phi, \\psi)$ 是二维环面上的一个分布，并且由于每个组分的 $\\phi$ 和 $\\psi$ 分布是独立的，因此一个组分的联合概率密度函数是两个一维 von Mises 概率密度函数的乘积。所有角度参数 $(\\mu_{\\phi,j}, \\mu_{\\psi,j})$ 均以度为单位提供，计算时必须使用关系式 $\\theta_{\\mathrm{rad}} = \\theta_{\\mathrm{deg}} \\times \\pi / 180$ 转换为弧度。\n\n**2. 密度阈值的确定**\n\n问题将拉马钱德兰图的“最优”区 ($L_f$) 和“允许”区 ($L_a$) 定义为高概率密度水平集。具体来说，$L_f$ 是一个区域 $\\{(\\phi,\\psi) : p(\\phi,\\psi) \\ge \\tau_f\\}$，包含总概率质量的 $p_f = 98\\%$；$L_a$ 是一个区域 $\\{(\\phi,\\psi) : p(\\phi,\\psi) \\ge \\tau_a\\}$，包含总概率质量的 $p_a = 99.9\\%$。这项任务的核心是找到密度阈值 $\\tau_f$ 和 $\\tau_a$。\n\n这些阈值的解析解是难以处理的。因此，规定了一种数值方法。连续的 $(\\phi, \\psi)$ 空间被离散化为一个均匀网格。问题指定了一个在 $[-180^\\circ, 180^\\circ]\\times[-180^\\circ, 180^\\circ]$ 范围、步长为 $\\Delta = 1^\\circ$ 的网格。为了正确处理域的周期性，我们使用一个 $360 \\times 360$ 点的网格，例如，在每个维度上覆盖角度 $[-180^\\circ, 179^\\circ]$。这对应于弧度下的周期域 $[-\\pi, \\pi) \\times [-\\pi, \\pi)$。\n\n找到阈值的算法如下：\n1.  以弧度为单位构建 $(\\phi, \\psi)$ 角度对的 $360 \\times 360$ 网格。\n2.  在每个 $360^2 = 129,600$ 个网格点上评估概率密度函数 $p(\\phi, \\psi)$。\n3.  将得到的二维密度值数组展平为一维列表，并按降序排序，得到 $p_{(1)} \\ge p_{(2)} \\ge \\dots \\ge p_{(N)}$，其中 $N=129600$。\n4.  PDF 在域上的积分通过黎曼和近似：$\\iint p(\\phi,\\psi) d\\phi d\\psi \\approx \\sum_{k=1}^N p_{(k)} A_{\\mathrm{cell}}$，其中 $A_{\\mathrm{cell}} = (\\Delta \\cdot \\pi/180)^2$ 是单个网格单元的面积（以平方弧度为单位）。\n5.  $k$ 个最可能点的累积概率为 $C_k = A_{\\mathrm{cell}} \\sum_{i=1}^k p_{(i)}$。\n6.  阈值 $\\tau_f$ 是累积概率 $C_{k_f}$ 首次达到或超过 $p_f = 0.98$ 时的最小密度值 $p_{(k_f)}$。类似地，$\\tau_a$ 是 $C_{k_a}$ 首次达到或超过 $p_a = 0.999$ 时的 $p_{(k_a)}$。这些索引 $k_f$ 和 $k_a$ 可以通过在累积概率数组上使用搜索算法高效地找到。\n\n**3. 残基分类与验证**\n\n在确定阈值 $\\tau_f$ 和 $\\tau_a$ 后，可以对测试用例中的每个残基进行分类。对于一个给定角度为 $(\\phi_i, \\psi_i)$ 的残基：\n1.  首先将以度为单位提供的角度转换为弧度。为了稳健地处理周期性，角度被映射到区间 $[-180^\\circ, 180^\\circ)$ 或弧度下的 $[-\\pi, \\pi)$。\n2.  使用混合模型计算概率密度 $p_i = p(\\phi_i, \\psi_i)$。\n3.  根据以下规则对残基进行分类：\n    *   **最优区**：如果 $p_i \\ge \\tau_f$。\n    *   **仅允许区**：如果 $\\tau_a \\le p_i  \\tau_f$。\n    *   **离群区**：如果 $p_i  \\tau_a$。\n\n对于每个测试用例（一组残基），我们统计每个类别中的残基数量（$N_f, N_{ao}, N_o$）。根据这些计数和残基总数 $N$，我们计算分数：\n$$\nF_f \\;=\\; \\frac{N_f}{N},\\quad F_{ao} \\;=\\; \\frac{N_{ao}}{N},\\quad F_o \\;=\\; \\frac{N_o}{N}\n$$\n这些分数代表了给定蛋白质模型的质量，将它们与标准验证阈值进行比较：\n*   最优区分数测试：$F_f \\ge 0.95$。\n*   允许区（总）分数测试：$F_{\\mathrm{inc}} = F_f + F_{ao} \\ge 0.99$。\n*   离群区分数测试：$F_o \\le 0.01$。\n\n每个测试用例的最终输出是一个列表，其中包含计算出的分数（$F_f, F_{ao}, F_o$）（四舍五入到三位小数）以及这三个测试的布尔结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes Ramachandran plot statistics based on a von Mises mixture model.\n    \"\"\"\n    # ------------------ MODEL PARAMETERS ------------------\n    # Conversion factor from degrees to radians\n    deg_to_rad = np.pi / 180.0\n\n    # Mixture model parameters\n    weights = np.array([0.55, 0.35, 0.07, 0.03])\n    means_deg = np.array([\n        [-60.0, -45.0],   # Component 1: right-handed alpha-helix\n        [-135.0, 135.0],  # Component 2: beta-sheet\n        [-75.0, 145.0],   # Component 3: polyproline II\n        [60.0, 30.0]      # Component 4: left-handed alpha-helix\n    ])\n    kappas = np.array([\n        [25.0, 25.0],\n        [35.0, 20.0],\n        [15.0, 15.0],\n        [20.0, 20.0]\n    ])\n    \n    # Convert mean angles to radians\n    means_rad = means_deg * deg_to_rad\n\n    # Target probability masses for regions\n    p_f = 0.98\n    p_a = 0.999\n\n    # Validation thresholds for fractions\n    theta_f = 0.95\n    theta_a = 0.99\n    theta_o = 0.01\n\n    # ------------------ HELPER FUNCTIONS ------------------\n    def f_vm(theta, mu, kappa):\n        \"\"\"Calculates the 1D von Mises PDF.\"\"\"\n        # The i0 function is vectorized.\n        norm_const = 2.0 * np.pi * i0(kappa)\n        return np.exp(kappa * np.cos(theta - mu)) / norm_const\n\n    def p_phi_psi(phi, psi, W, M, K):\n        \"\"\"Calculates the 2D mixture model PDF for scalar or array inputs.\"\"\"\n        total_p = np.zeros_like(phi, dtype=np.float64)\n        for j in range(len(W)):\n            f_phi = f_vm(phi, M[j, 0], K[j, 0])\n            f_psi = f_vm(psi, M[j, 1], K[j, 1])\n            total_p += W[j] * f_phi * f_psi\n        return total_p\n\n    def calculate_thresholds():\n        \"\"\"Numerically determines the density thresholds tau_f and tau_a.\"\"\"\n        delta_deg = 1.0\n        grid_angles_deg = np.arange(-180.0, 180.0, delta_deg)\n        phi_deg_grid, psi_deg_grid = np.meshgrid(grid_angles_deg, grid_angles_deg)\n\n        phi_rad_grid = phi_deg_grid * deg_to_rad\n        psi_rad_grid = psi_deg_grid * deg_to_rad\n\n        # Evaluate PDF on the grid\n        p_grid = p_phi_psi(phi_rad_grid, psi_rad_grid, weights, means_rad, kappas)\n\n        # Flatten and sort densities in descending order\n        p_flat_sorted = np.sort(p_grid.flatten())[::-1]\n\n        # Calculate cumulative probability using Riemann sum\n        delta_rad = delta_deg * deg_to_rad\n        A_cell = delta_rad ** 2\n        cum_prob = np.cumsum(p_flat_sorted) * A_cell\n\n        # Find indices where cumulative probability exceeds targets\n        idx_f = np.searchsorted(cum_prob, p_f)\n        idx_a = np.searchsorted(cum_prob, p_a)\n\n        # Thresholds are the density values at these indices\n        tau_f = p_flat_sorted[idx_f]\n        tau_a = p_flat_sorted[idx_a]\n        return tau_f, tau_a\n\n    # ------------------ MAIN LOGIC ------------------\n    # Calculate thresholds once\n    tau_f, tau_a = calculate_thresholds()\n    \n    # Test case data\n    test_cases_deg = [\n        [(-60, -45), (-58, -47), (-62, -50), (-130, 130), (-135, 135), (-75, 145), (60, 30), (-120, 120), (0, 0), (-61, -44)],\n        [(-179, 179), (179, -179), (-180, 180), (-75, 145), (60, 30), (-60, 130), (-140, 140), (-65, -40), (-135, 120), (62, 28), (170, -170), (-170, 170)],\n        [(0, 180), (180, 0), (90, -90), (-90, 90), (120, 0), (0, -120), (-45, 160), (80, 80), (-80, -80), (-130, 130), (-60, -45), (-135, 135), (10, 10), (-10, -10)]\n    ]\n\n    all_results = []\n    \n    for case_data_deg in test_cases_deg:\n        N = len(case_data_deg)\n        N_f, N_ao, N_o = 0, 0, 0\n\n        angles = np.array(case_data_deg, dtype=np.float64)\n        \n        # Convert all angles to radians for calculation\n        phi_rad_data = angles[:, 0] * deg_to_rad\n        psi_rad_data = angles[:, 1] * deg_to_rad\n\n        # Calculate PDF for all residues in the case\n        densities = p_phi_psi(phi_rad_data, psi_rad_data, weights, means_rad, kappas)\n\n        for p_val in densities:\n            if p_val >= tau_f:\n                N_f += 1\n            elif p_val >= tau_a:\n                N_ao += 1\n            else:\n                N_o += 1\n\n        # Calculate fractions\n        F_f = N_f / N\n        F_ao = N_ao / N\n        F_o = N_o / N\n        F_inc = F_f + F_ao\n\n        # Perform validation tests\n        favored_pass = F_f >= theta_f\n        allowed_pass = F_inc >= theta_a\n        outlier_pass = F_o = theta_o\n\n        # Assemble the result for the case as specified\n        case_result = [\n            f\"{F_f:.3f}\",\n            f\"{F_ao:.3f}\",\n            f\"{F_o:.3f}\",\n            favored_pass,\n            allowed_pass,\n            outlier_pass\n        ]\n        \n        # Format the list into a string\n        inner_list_str = f\"[{case_result[0]},{case_result[1]},{case_result[2]},{str(case_result[3]).lower()},{str(case_result[4]).lower()},{str(case_result[5]).lower()}]\"\n        all_results.append(inner_list_str)\n\n    # Print a single line with all results in the required format\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}