{
    "hands_on_practices": [
        {
            "introduction": "The charge state of amino acid residues is a primary determinant of electrostatic interactions, which govern protein folding, binding, and catalysis. This exercise provides fundamental practice in calculating the expected net charge of a polyprotic amino acid at physiological pH. By applying the principles of acid-base equilibria to each titratable group, you will develop a core skill for parameterizing molecules in computational models and understanding pH-dependent protein behavior .",
            "id": "3836005",
            "problem": "In coarse-grained implicit-solvent modeling of biomolecules, an effective, ensemble-averaged charge is assigned to titratable residues to parameterize electrostatics. Consider free L-lysine in dilute aqueous solution at the power of hydrogen (pH) $\\mathrm{pH}=7.4$. Treat the three titratable sites as independent and noninteracting: the $\\alpha$-carboxyl group (formal states $\\mathrm{COOH}/\\mathrm{COO}^{-}$), the $\\alpha$-ammonium group (formal states $\\mathrm{NH_{3}^{+}}/\\mathrm{NH_{2}}$), and the $\\varepsilon$-ammonium side chain (formal states $\\mathrm{NH_{3}^{+}}/\\mathrm{NH_{2}}$). You are given the following acid dissociation constant logarithms (pK$_a$ values): $pK_{a}(\\mathrm{COOH})=2.2$, $pK_{a}(\\mathrm{NH_{3}^{+}})=9.0$, and $pK_{a}(\\mathrm{side\\ chain})=10.5$. \n\nStarting only from the law of mass action for proton binding equilibria, the definition of the acid dissociation constant $K_{a}$, and the definitions of the power of hydrogen (pH) and the acid dissociation constant logarithm (pK$_a$), compute the expected net charge of lysine at $\\mathrm{pH}=7.4$ by summing the site charges weighted by their equilibrium protonation fractions at that $\\mathrm{pH}$. Assume no coupling between sites and neglect activity coefficients and ionic strength effects. Round your final result to four significant figures. Express your answer as a pure number (dimensionless).",
            "solution": "The problem requires the calculation of the expected net charge of free L-lysine in an aqueous solution at a specified power of hydrogen ($\\mathrm{pH}$). This can be accomplished by determining the fractional protonation state of each of its three titratable groups and summing their average charges. The problem stipulates that the derivation must begin from fundamental principles.\n\nLet us consider a generic monoprotic acid, $HA$, which dissociates in water according to the equilibrium:\n$$\nHA \\rightleftharpoons H^{+} + A^{-}\n$$\nThe law of mass action for this equilibrium gives the acid dissociation constant, $K_a$, as:\n$$\nK_a = \\frac{[H^{+}][A^{-}]}{[HA]}\n$$\nwhere $[H^{+}]$, $[A^{-}]$, and $[HA]$ represent the molar concentrations of the proton, the deprotonated (conjugate base) form, and the protonated (acid) form, respectively.\n\nThe definitions for $\\mathrm{pH}$ and $pK_a$ are given by:\n$$\n\\mathrm{pH} = -\\log_{10}([H^{+}])\n$$\n$$\npK_a = -\\log_{10}(K_a)\n$$\nFrom these definitions, it follows that $[H^{+}] = 10^{-\\mathrm{pH}}$ and $K_a = 10^{-pK_a}$.\n\nWe can rearrange the expression for $K_a$ to find the ratio of the deprotonated to protonated species:\n$$\n\\frac{[A^{-}]}{[HA]} = \\frac{K_a}{[H^{+}]} = \\frac{10^{-pK_a}}{10^{-\\mathrm{pH}}} = 10^{\\mathrm{pH} - pK_a}\n$$\nThis relationship is a precursor to the Henderson-Hasselbalch equation. To find the fraction of molecules in a given protonation state, we define the fractional populations. The fraction of the acid in its protonated form, $HA$, is denoted $f_{HA}$, and the fraction in its deprotonated form, $A^{-}$, is denoted $f_{A^{-}}$.\n$$\nf_{HA} = \\frac{[HA]}{[HA] + [A^{-}]}\n$$\n$$\nf_{A^{-}} = \\frac{[A^{-}]}{[HA] + [A^{-}]}\n$$\nBy dividing the numerator and denominator of the expression for $f_{HA}$ by $[HA]$, we get:\n$$\nf_{HA} = \\frac{1}{1 + \\frac{[A^{-}]}{[HA]}} = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}}\n$$\nSince the species must be in one of the two states, $f_{HA} + f_{A^{-}} = 1$. Therefore, the fraction of the deprotonated form is:\n$$\nf_{A^{-}} = 1 - f_{HA} = 1 - \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}} = \\frac{10^{\\mathrm{pH} - pK_a}}{1 + 10^{\\mathrm{pH} - pK_a}}\n$$\nThe expected charge, $\\langle q \\rangle$, of a single titratable group is the weighted average of the charges of its possible states, where the weights are the fractional populations:\n$$\n\\langle q \\rangle = q_{HA} \\cdot f_{HA} + q_{A^{-}} \\cdot f_{A^{-}}\n$$\nwhere $q_{HA}$ and $q_{A^{-}}$ are the integer charges of the protonated and deprotonated states, respectively.\n\nL-lysine has three independent titratable sites: the $\\alpha$-carboxyl group, the $\\alpha$-ammonium group, and the $\\varepsilon$-ammonium group. The total expected net charge, $\\langle Q_{net} \\rangle$, is the sum of the expected charges of these three sites.\n$\\langle Q_{net} \\rangle = \\langle q_{\\mathrm{carboxyl}} \\rangle + \\langle q_{\\alpha\\mathrm{-ammonium}} \\rangle + \\langle q_{\\varepsilon\\mathrm{-ammonium}} \\rangle$.\n\n$1$. $\\alpha$-Carboxyl group ($\\mathrm{COOH}/\\mathrm{COO}^{-}$):\nThe equilibrium is $\\mathrm{COOH} \\rightleftharpoons H^{+} + \\mathrm{COO}^{-}$.\nThe protonated state, $\\mathrm{COOH}$, has a charge $q_{prot} = 0$.\nThe deprotonated state, $\\mathrm{COO}^{-}$, has a charge $q_{deprot} = -1$.\nThe given $pK_a$ is $2.2$ and the $\\mathrm{pH}$ is $7.4$.\nThe expected charge is $\\langle q_{\\mathrm{carboxyl}} \\rangle = (0) \\cdot f_{\\mathrm{COOH}} + (-1) \\cdot f_{\\mathrm{COO}^{-}} = -f_{\\mathrm{COO}^{-}}$.\n$$\n\\langle q_{\\mathrm{carboxyl}} \\rangle = -\\frac{10^{\\mathrm{pH} - pK_a}}{1 + 10^{\\mathrm{pH} - pK_a}} = -\\frac{10^{7.4 - 2.2}}{1 + 10^{7.4 - 2.2}} = -\\frac{10^{5.2}}{1 + 10^{5.2}}\n$$\n\n$2$. $\\alpha$-Ammonium group ($\\mathrm{NH_{3}^{+}}/\\mathrm{NH_{2}}$):\nThe equilibrium is $\\mathrm{NH}_{3}^{+} \\rightleftharpoons H^{+} + \\mathrm{NH}_{2}$.\nThe protonated state, $\\mathrm{NH}_{3}^{+}$, has a charge $q_{prot} = +1$.\nThe deprotonated state, $\\mathrm{NH}_{2}$, has a charge $q_{deprot} = 0$.\nThe given $pK_a$ is $9.0$ and the $\\mathrm{pH}$ is $7.4$.\nThe expected charge is $\\langle q_{\\alpha\\mathrm{-ammonium}} \\rangle = (+1) \\cdot f_{\\mathrm{NH_{3}^{+}}} + (0) \\cdot f_{\\mathrm{NH_{2}}} = f_{\\mathrm{NH_{3}^{+}}}$.\n$$\n\\langle q_{\\alpha\\mathrm{-ammonium}} \\rangle = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}} = \\frac{1}{1 + 10^{7.4 - 9.0}} = \\frac{1}{1 + 10^{-1.6}}\n$$\n\n$3$. $\\varepsilon$-Ammonium side chain ($\\mathrm{NH_{3}^{+}}/\\mathrm{NH_{2}}$):\nThe equilibrium is $\\mathrm{NH}_{3}^{+} \\rightleftharpoons H^{+} + \\mathrm{NH}_{2}$.\nThe protonated state, $\\mathrm{NH}_{3}^{+}$, has a charge $q_{prot} = +1$.\nThe deprotonated state, $\\mathrm{NH}_{2}$, has a charge $q_{deprot} = 0$.\nThe given $pK_a$ is $10.5$ and the $\\mathrm{pH}$ is $7.4$.\nThe expected charge is $\\langle q_{\\varepsilon\\mathrm{-ammonium}} \\rangle = (+1) \\cdot f_{\\mathrm{NH_{3}^{+}}} + (0) \\cdot f_{\\mathrm{NH_{2}}} = f_{\\mathrm{NH_{3}^{+}}}$.\n$$\n\\langle q_{\\varepsilon\\mathrm{-ammonium}} \\rangle = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}} = \\frac{1}{1 + 10^{7.4 - 10.5}} = \\frac{1}{1 + 10^{-3.1}}\n$$\n\nThe total expected net charge is the sum of these three contributions:\n$$\n\\langle Q_{net} \\rangle = -\\frac{10^{5.2}}{1 + 10^{5.2}} + \\frac{1}{1 + 10^{-1.6}} + \\frac{1}{1 + 10^{-3.1}}\n$$\nNow, we compute the numerical values:\nFor the carboxyl group: $\\langle q_{\\mathrm{carboxyl}} \\rangle = -\\frac{10^{5.2}}{1 + 10^{5.2}} \\approx -\\frac{158489.3}{1 + 158489.3} \\approx -0.99999369$\nFor the $\\alpha$-ammonium group: $\\langle q_{\\alpha\\mathrm{-ammonium}} \\rangle = \\frac{1}{1 + 10^{-1.6}} \\approx \\frac{1}{1 + 0.02511886} \\approx 0.97549603$\nFor the $\\varepsilon$-ammonium group: $\\langle q_{\\varepsilon\\mathrm{-ammonium}} \\rangle = \\frac{1}{1 + 10^{-3.1}} \\approx \\frac{1}{1 + 0.00079433} \\approx 0.99920630$\n\nSumming these values:\n$$\n\\langle Q_{net} \\rangle \\approx -0.99999369 + 0.97549603 + 0.99920630 \\approx 0.97470864\n$$\nRounding the final result to four significant figures, we obtain $0.9747$.",
            "answer": "$$\n\\boxed{0.9747}\n$$"
        },
        {
            "introduction": "Beyond electrostatics, the steric properties of amino acid side chains are critical in defining local backbone conformation. This conceptual practice challenges you to reason about how subtle differences in side-chain architecture—specifically, the β-branching in valine and isoleucine—influence conformational preferences on the Ramachandran map. Mastering this type of steric analysis is essential for understanding protein stability and interpreting the energetic landscapes produced by molecular mechanics force fields .",
            "id": "3836007",
            "problem": "You are modeling the local backbone conformational preferences of a tripeptide context $ \\mathrm{G}\\text{-}X\\text{-}\\mathrm{G} $ where $ X $ is either valine or isoleucine, in aqueous solution at $ T = 300\\,\\mathrm{K} $. You want to predict the impact of substituting valine with isoleucine on the relative occupancy of Ramachandran regions near the canonical $ \\alpha $ helix basin (approximately $ \\phi \\approx -60^{\\circ}, \\psi \\approx -45^{\\circ} $), the $ \\beta $-strand basin (approximately $ \\phi \\approx -135^{\\circ}, \\psi \\approx 135^{\\circ} $), and the polyproline II (PPII) basin (approximately $ \\phi \\approx -75^{\\circ}, \\psi \\approx 145^{\\circ} $). You will reason from steric hindrance and side chain branching.\n\nAssume the following well-tested facts and definitions as your fundamental base:\n- The backbone dihedral angles $ \\phi $ and $ \\psi $ determine steric proximity between the side chain atoms and the backbone atoms, which is the basis of the Ramachandran map.\n- Valine and isoleucine are $ \\beta $-branched residues (two heavy substituents on $ \\mathrm{C}_{\\beta} $), which typically disfavors the $ \\alpha $-helical region due to steric crowding near $ \\phi \\approx -60^{\\circ} $.\n- Valine has symmetric $ \\mathrm{C}_{\\beta} $ methyl groups, leading to approximately degenerate $ \\chi_{1} $ rotamers near $ g^{+} \\approx +60^{\\circ} $ and $ g^{-} \\approx -60^{\\circ} $, while the $ t \\approx 180^{\\circ} $ rotamer is less populated. Isoleucine is asymmetric and, in peptide contexts, often prefers $ \\chi_{1} \\approx t $ because it places the bulk of the side chain away from the backbone carbonyl oxygen.\n- Short-range steric repulsion is dominated by the repulsive part of a Lennard–Jones potential (Light–Matter intermolecular interaction modeled by the Lennard–Jones potential), which scales approximately as $ r^{-12} $ at small separation $ r $, so small increases in interatomic separation dramatically reduce the repulsive energy.\n- At equilibrium, relative conformational probabilities are proportional to $ \\exp(-E/k_{B}T) $ by the Boltzmann distribution, where $ E $ is the conformational energy, $ k_{B} $ is the Boltzmann constant, and $ T $ is the absolute temperature.\n- PPII and $ \\beta $-strand regions both avoid certain helical steric contacts but differ in their $ \\psi $ angle and side-chain–backbone packing.\n\nUsing only these bases, and neglecting side-chain hydrogen bonding and specific solvent packing effects beyond their contribution to effective steric radii, which statement best predicts the impact of substituting valine with isoleucine on local $ (\\phi,\\psi) $ preferences and on near-backbone rotameric entropy?\n\nA. The substitution strengthens $ \\beta $-strand preference and further decreases $ \\alpha $-helix compatibility because the bulkier isoleucine increases $ \\beta $-branch steric clashes in the $ \\alpha $ region; rotameric entropy increases due to the extra $ \\chi_{2} $ dihedral in isoleucine.\n\nB. The substitution slightly relieves $ \\alpha $-helix steric clashes by favoring $ \\chi_{1} \\approx t $, shifting some population from PPII into the $ \\alpha $ basin while the $ \\beta $-strand basin remains the most populated; near-backbone rotameric entropy decreases because valine’s $ g^{\\pm} $ degeneracy is lost.\n\nC. The substitution has negligible effect on $ (\\phi,\\psi) $ preferences because both residues are $ \\beta $-branched; only hydrophobicity changes, which does not affect sterics on the Ramachandran map.\n\nD. The substitution shifts substantial population from $ \\beta $-strand into $ \\alpha $-helix because isoleucine is not $ \\beta $-branched; $ \\chi_{1} $ distributions become more symmetric with isoleucine than with valine.",
            "solution": "We begin from the provided bases: backbone dihedral angles $ \\phi $ and $ \\psi $ set the relative geometry of the side chain with respect to the backbone atoms, constraining allowed conformations by steric exclusion. The repulsive part of the Lennard–Jones interaction grows roughly as $ r^{-12} $ for short distances $ r $, so even small changes in interatomic distances can produce large changes in repulsive energy. The relative population of conformers follows the Boltzmann distribution $ p \\propto \\exp(-E/k_{B}T) $, hence reductions in steric repulsion translate exponentially into increased occupancy.\n\nBoth valine and isoleucine are $ \\beta $-branched, placing two heavy substituents on $ \\mathrm{C}_{\\beta} $. In the $ \\alpha $-helical region (near $ \\phi \\approx -60^{\\circ}, \\psi \\approx -45^{\\circ} $), the proximity of the $ \\mathrm{C}_{\\beta} $ substituents to the backbone carbonyl oxygen of residue $ i-1 $ and to the backbone nitrogen of residue $ i+1 $ generates potential steric clashes. This is the canonical explanation for why $ \\beta $-branched residues tend to disfavor the $ \\alpha $-helical basin relative to the $ \\beta $ basin (near $ \\phi \\approx -135^{\\circ}, \\psi \\approx 135^{\\circ} $), in which these contacts are alleviated.\n\nHowever, the details of $ \\chi_{1} $ rotamer preferences modulate these steric interactions. Valine has two methyl groups on $ \\mathrm{C}_{\\beta} $, making the $ g^{+} $ and $ g^{-} $ $ \\chi_{1} $ rotamers approximately degenerate by symmetry; the $ t $ rotamer is less favored. In both $ g^{+} $ and $ g^{-} $, one of the methyls tends to approach the backbone carbonyl oxygen in $ \\alpha $ geometry, exacerbating short-range repulsion. Because the repulsive energy scales as $ r^{-12} $, any rotamer that reduces this approach distance can reduce the energetic penalty substantially.\n\nIsoleucine is asymmetric and typically prefers $ \\chi_{1} \\approx t $ in peptide environments. In the $ t $ rotamer, the bulk of the side chain is oriented away from the backbone carbonyl oxygen, increasing key interatomic distances by a small amount relative to valine’s common $ g^{\\pm} $ rotamers. Given the $ r^{-12} $ dependence, this small increase in distance significantly reduces the repulsive component of the Lennard–Jones potential in the $ \\alpha $ region, thus lowering the energy $ E_{\\alpha} $ for isoleucine relative to valine. By the Boltzmann factor $ \\exp(-\\Delta E/k_{B}T) $, this reduction translates into an increase in the relative occupancy of the $ \\alpha $ basin for isoleucine compared to valine. Nevertheless, because both residues remain $ \\beta $-branched, the $ \\beta $-strand basin generally remains strongly populated; the substitution does not invert the overall preference to make $ \\alpha $ dominate.\n\nThe PPII basin (near $ \\phi \\approx -75^{\\circ}, \\psi \\approx 145^{\\circ} $) shares the feature of avoiding certain helical steric contacts, so $ \\beta $-branched residues often populate PPII. If the $ \\alpha $ basin becomes relatively less penalized for isoleucine due to the $ \\chi_{1} \\approx t $ orientation, then some population can shift from PPII toward $ \\alpha $ at constant temperature via the Boltzmann redistribution, while the $ \\beta $ basin remains favored overall.\n\nFinally, consider rotameric entropy near the backbone. Valine’s $ \\chi_{1} $ rotamer has two nearly degenerate states $ g^{+} $ and $ g^{-} $, which contribute to configurational entropy at fixed $ (\\phi,\\psi) $. Isoleucine’s near-backbone packing constrains $ \\chi_{1} $ more strongly, often selecting $ t $ as the dominant state. This loss of near-degeneracy in $ \\chi_{1} $ reduces the near-backbone rotameric entropy component. Although isoleucine has an additional internal degree of freedom $ \\chi_{2} $, the relevant comparison here is the near-backbone $ \\chi_{1} $ degeneracy affecting local $ (\\phi,\\psi) $ preferences; the increased internal flexibility does not offset the reduction in $ \\chi_{1} $ degeneracy with respect to immediate backbone steric accommodation.\n\nOption-by-option analysis:\n- Option A: It claims that isoleucine further decreases $ \\alpha $ compatibility and increases rotameric entropy. The first clause contradicts the steric analysis: isoleucine’s preference for $ \\chi_{1} \\approx t $ increases key distances to backbone atoms in the $ \\alpha $ region, reducing $ r^{-12} $ repulsion and modestly increasing $ \\alpha $ occupancy relative to valine. The second clause is also problematic in the near-backbone context: the loss of $ g^{\\pm} $ degeneracy at $ \\chi_{1} $ reduces the near-backbone rotameric entropy despite the presence of $ \\chi_{2} $. Verdict: Incorrect.\n- Option B: It states that isoleucine slightly relieves $ \\alpha $ steric clashes via $ \\chi_{1} \\approx t $, shifting some population from PPII to $ \\alpha $ while $ \\beta $ remains most populated, and that near-backbone rotameric entropy decreases because valine’s $ g^{\\pm} $ degeneracy is lost. This aligns with the $ r^{-12} $ steric argument, Boltzmann redistribution, and known rotamer preferences. Verdict: Correct.\n- Option C: It claims negligible effect because both residues are $ \\beta $-branched, ignoring the substantial effect of $ \\chi_{1} $ geometry on short-range steric contacts and the empirically observed differences in helix propensities. Verdict: Incorrect.\n- Option D: It incorrectly asserts that isoleucine is not $ \\beta $-branched and that $ \\chi_{1} $ distributions become more symmetric; both statements are false. Verdict: Incorrect.\n\nTherefore, the best prediction is given by Option B.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "Textbook $pK_a$ values provide a useful baseline, but the true ionization behavior of a residue is dictated by its unique microenvironment within a folded protein. This advanced computational exercise bridges theory with practical data analysis, mimicking a common workflow in modern computational chemical biology. You will use the Henderson-Hasselbalch model not to predict a charge, but to fit simulated titration data from a constant pH molecular dynamics experiment, thereby extracting a site-specific $pK_a$ value for a histidine residue .",
            "id": "3836002",
            "problem": "A constant pH Molecular Dynamics (MD) simulation of a histidine side chain in a peptide yields a titration curve, i.e., a series of sample points $(\\mathrm{pH}_i, \\theta_i)$, where $\\theta_i$ denotes the fraction of the protonated species at $\\mathrm{pH}_i$. From first principles of acid-base equilibria, the acid dissociation constant $K_a$ is defined by the law of mass action, and $pK_a$ is defined by $pK_a = -\\log_{10}(K_a)$. The Henderson–Hasselbalch (HH) relation connects $pK_a$ and protonation fractions, and a Hill-like generalization introduces a phenomenological cooperativity parameter. Your task is to derive a fitting model for $\\theta(\\mathrm{pH})$ based on these principles and implement a program that estimates $pK_a$ for histidine in a peptide from the provided titration curves.\n\nStarting from the law of mass action, analytically derive a two-parameter model that relates the fraction protonated $\\theta$ to $\\mathrm{pH}$ in terms of unknown $pK_a$ and, when applicable, a cooperativity parameter $n_{\\mathrm{H}}$. Then, design an algorithm that, given a set of $(\\mathrm{pH}_i, \\theta_i)$ values, computes:\n- An estimated $pK_a$ by fitting the Henderson–Hasselbalch model (with fixed $n_{\\mathrm{H}} = 1$).\n- An estimated $pK_a$ and an estimated $n_{\\mathrm{H}}$ by fitting the Hill-like generalized model (with $n_{\\mathrm{H}}$ free).\n\nYou must use nonlinear least squares to fit your derived models to the data by minimizing the sum of squared residuals between observed $\\theta_i$ and predicted values. Because $\\mathrm{pH}$ and $pK_a$ are dimensionless quantities, report all numeric results without physical units. The final output must be a single line containing all estimated parameters for the provided test suite in a flat list, in the following order: for each test case, output the Henderson–Hasselbalch $pK_a$, the Hill-like $pK_a$, and the Hill-like $n_{\\mathrm{H}}$, all rounded to three decimal places. The output should be a single line of text formatted as a comma-separated list enclosed in square brackets, for example, $[\\dots]$.\n\nUse the following test suite of titration curves, given as $\\mathrm{pH}$ sample points and corresponding observed protonation fractions $\\theta$:\n\n- Test case $1$ (canonical histidine-like behavior, wide range):\n  - $\\mathrm{pH}$ points: $[3.0, 4.0, 5.0, 5.5, 6.0, 6.5, 7.0, 8.0, 9.0]$\n  - $\\theta$ points: $[0.999001, 0.990099, 0.909091, 0.759746, 0.500000, 0.240253, 0.090909, 0.009901, 0.000999]$\n- Test case $2$ (cooperative-like steepness, shifted midpoint):\n  - $\\mathrm{pH}$ points: $[4.5, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0]$\n  - $\\theta$ points: $[0.997488, 0.952269, 0.816271, 0.500000, 0.182993, 0.047744, 0.011095]$\n- Test case $3$ (sparse points near transition):\n  - $\\mathrm{pH}$ points: $[6.0, 6.1, 6.2, 6.3, 6.4]$\n  - $\\theta$ points: $[0.613813, 0.557521, 0.500000, 0.442479, 0.386186]$\n- Test case $4$ (midpoint outside much of sampling range):\n  - $\\mathrm{pH}$ points: $[5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0]$\n  - $\\theta$ points: $[0.999900, 0.999001, 0.990099, 0.909091, 0.500000, 0.090909, 0.009901]$\n\nAlgorithmic and numerical requirements:\n- Derive the model equations from the law of mass action and the definition of $pK_a$.\n- Implement nonlinear least squares fitting for both the Henderson–Hasselbalch model and the Hill-like model. Constrain parameters to physically reasonable domains, for example, $pK_a \\in [-2, 14]$ and $n_{\\mathrm{H}} \\in [0.1, 5.0]$.\n- Use robust initial guesses that do not assume prior knowledge of the true parameters and that can handle data sets which may be nearly saturated (e.g., $\\theta \\approx 0$ or $\\theta \\approx 1$ over much of the range). If you use any transformation, justify it from the derived model.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output three floating-point numbers: the Henderson–Hasselbalch $pK_a$, the Hill-like $pK_a$, and the Hill-like $n_{\\mathrm{H}}$, all rounded to three decimal places.\n\nDesign for coverage:\n- The test suite includes a general wide-range case (test case $1$), a cooperative-like steep case (test case $2$), a boundary near-transition case with sparse points (test case $3$), and a case where the midpoint is partially outside the sampling range (test case $4$). This ensures your algorithm handles varied steepness, sampling density, and saturation behavior.\n\nYour final program must be self-contained, require no user input, and strictly follow the specified output format.",
            "solution": "The problem requires the derivation of a mathematical model for a titration curve and the implementation of a numerical fitting procedure to estimate the parameters $pK_a$ and a cooperativity coefficient $n_{\\mathrm{H}}$ from experimental data. The derivation begins from the fundamental principles of acid-base chemical equilibrium.\n\n### Model Derivation\n\nLet us consider the reversible dissociation of a generic monoprotic acid, which for the histidine side chain (imidazole) can be represented as the equilibrium between its protonated form ($\\mathrm{HisH}^+$) and its deprotonated form ($\\mathrm{His}$):\n$$\n\\mathrm{HisH}^+ \\rightleftharpoons \\mathrm{His} + \\mathrm{H}^+\n$$\nAccording to the law of mass action, the acid dissociation constant, $K_a$, is defined as:\n$$\nK_a = \\frac{[\\mathrm{His}][\\mathrm{H}^+]}{[\\mathrm{HisH}^+]}\n$$\nwhere $[\\cdot]$ denotes the molar concentration of a species. The problem defines $\\theta$ as the fraction of the protonated species. This is expressed as the ratio of the concentration of the protonated form to the total concentration of the species:\n$$\n\\theta = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{His}]_{\\text{total}}} = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{HisH}^+] + [\\mathrm{His}]}\n$$\nTo express $\\theta$ as a function of $[\\mathrm{H}^+]$ and $K_a$, we first rearrange the $K_a$ expression to find $[\\mathrm{His}]$:\n$$\n[\\mathrm{His}] = K_a \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{H}^+]}\n$$\nSubstituting this into the equation for $\\theta$:\n$$\n\\theta = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{HisH}^+] + K_a \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{H}^+]}}\n$$\nAssuming a non-zero concentration of the protonated species, we can divide the numerator and denominator by $[\\mathrm{HisH}^+]$:\n$$\n\\theta = \\frac{1}{1 + \\frac{K_a}{[\\mathrm{H}^+]}} = \\frac{[\\mathrm{H}^+]}{[\\mathrm{H}^+] + K_a}\n$$\nBy definition, $\\mathrm{pH} = -\\log_{10}([\\mathrm{H}^+])$ and $pK_a = -\\log_{10}(K_a)$, which implies $[\\mathrm{H}^+] = 10^{-\\mathrm{pH}}$ and $K_a = 10^{-pK_a}$. Substituting these logarithmic forms into the equation for $\\theta$ yields the Henderson-Hasselbalch model for the protonation fraction:\n$$\n\\theta(\\mathrm{pH}, pK_a) = \\frac{10^{-\\mathrm{pH}}}{10^{-\\mathrm{pH}} + 10^{-pK_a}}\n$$\nMultiplying the numerator and denominator by $10^{\\mathrm{pH}}$ gives a more convenient form:\n$$\n\\theta(\\mathrm{pH}, pK_a) = \\frac{1}{1 + 10^{\\mathrm{pH}} \\cdot 10^{-pK_a}} = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}}\n$$\nThis equation represents the standard, non-cooperative titration model, which corresponds to the case where the Hill coefficient $n_{\\mathrm{H}} = 1$.\n\nThe problem asks for a generalized two-parameter model including a cooperativity parameter $n_{\\mathrm{H}}$. This is achieved by generalizing the derived model, which is mathematically equivalent to the Hill equation for ligand binding. The term $(\\mathrm{pH} - pK_a)$ in the exponent is multiplied by the Hill coefficient $n_{\\mathrm{H}}$:\n$$\n\\theta(\\mathrm{pH}, pK_a, n_{\\mathrm{H}}) = \\frac{1}{1 + 10^{n_{\\mathrm{H}}(\\mathrm{pH} - pK_a)}}\n$$\nThis is the general fitting model. When $n_{\\mathrm{H}}=1$, it reduces to the standard Henderson-Hasselbalch model. When $n_{\\mathrm{H}}>1$, the transition from the protonated to the deprotonated state is steeper (cooperative), and when $n_{\\mathrm{H}}<1$, it is broader (anti-cooperative).\n\n### Algorithmic Design for Parameter Fitting\n\nThe goal is to estimate the parameters ($pK_a$ for the first model, and both $pK_a$ and $n_{\\mathrm{H}}$ for the second) by fitting the derived models to the provided $(\\mathrm{pH}_i, \\theta_i)$ data points. The method specified is nonlinear least squares, which involves minimizing the sum of squared residuals (SSR) between the observed data $\\theta_i^{\\text{obs}}$ and the values predicted by the model $\\theta(\\mathrm{pH}_i, \\text{params})$:\n$$\n\\mathrm{SSR}(\\text{params}) = \\sum_{i=1}^{N} \\left( \\theta_i^{\\text{obs}} - \\theta(\\mathrm{pH}_i, \\text{params}) \\right)^2\n$$\nThe `scipy.optimize.curve_fit` function is an appropriate tool for this task. It implements the Levenberg-Marquardt algorithm for nonlinear least squares optimization.\n\nThe implementation will proceed as follows for each test case:\n1.  **Define Model Functions**: Two Python functions will be defined, corresponding to the two models:\n    -   Henderson-Hasselbalch model: `hh_model(ph, pka)` which computes $\\theta$ using the formula with $n_{\\mathrm{H}}=1$.\n    -   Hill-like model: `hill_model(ph, pka, n_h)` which computes $\\theta$ using the general formula.\n\n2.  **Initial Guesses**: Robust initial parameter guesses are crucial for the convergence of the optimization algorithm.\n    -   For $pK_a$, a logical initial guess is the $\\mathrm{pH}$ value at which the system is half-protonated, i.e., $\\theta=0.5$. We can estimate this by finding the $\\mathrm{pH}_i$ from the input data that corresponds to the $\\theta_i$ value closest to $0.5$.\n    -   For $n_{\\mathrm{H}}$, a neutral initial guess is $1.0$, which assumes no cooperativity.\n\n3.  **Parameter Constraints**: The problem specifies physical and numerical constraints on the parameters, which will be enforced using the `bounds` argument in `curve_fit`.\n    -   For the Henderson-Hasselbalch fit: $pK_a \\in [-2, 14]$. The bounds tuple will be `([-2], [14])`.\n    -   For the Hill-like fit: $pK_a \\in [-2, 14]$ and $n_{\\mathrm{H}} \\in [0.1, 5.0]$. The bounds tuple will be `([-2, 0.1], [14, 5.0])`.\n\n4.  **Fitting Procedure**: For each test case's data:\n    -   First, `curve_fit` will be called with the `hh_model` function, the data, the initial guess for $pK_a$, and the corresponding bounds. The optimized $pK_a$ will be extracted.\n    -   Second, `curve_fit` will be called with the `hill_model` function, the data, the initial guesses for $pK_a$ and $n_{\\mathrm{H}}$, and the two-parameter bounds. The optimized $pK_a$ and $n_{\\mathrm{H}}$ will be extracted.\n\n5.  **Output Formatting**: The three resulting parameters (HH $pK_a$, Hill $pK_a$, Hill $n_{\\mathrm{H}}$) for each test case will be rounded to three decimal places and collected into a single list, which will then be formatted into the required string output. This process is repeated for all test cases provided in the suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves the problem of fitting titration curves to estimate pKa and Hill coefficients.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"ph\": [3.0, 4.0, 5.0, 5.5, 6.0, 6.5, 7.0, 8.0, 9.0],\n            \"theta\": [0.999001, 0.990099, 0.909091, 0.759746, 0.500000, 0.240253, 0.090909, 0.009901, 0.000999]\n        },\n        {\n            \"ph\": [4.5, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0],\n            \"theta\": [0.997488, 0.952269, 0.816271, 0.500000, 0.182993, 0.047744, 0.011095]\n        },\n        {\n            \"ph\": [6.0, 6.1, 6.2, 6.3, 6.4],\n            \"theta\": [0.613813, 0.557521, 0.500000, 0.442479, 0.386186]\n        },\n        {\n            \"ph\": [5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0],\n            \"theta\": [0.999900, 0.999001, 0.990099, 0.909091, 0.500000, 0.090909, 0.009901]\n        }\n    ]\n\n    # Model definitions\n    def hh_model(ph, pka):\n        \"\"\"Henderson-Hasselbalch model (Hill coefficient n_H = 1).\"\"\"\n        return 1.0 / (1.0 + 10**(ph - pka))\n\n    def hill_model(ph, pka, n_h):\n        \"\"\"Generalized Hill-like model.\"\"\"\n        return 1.0 / (1.0 + 10**(n_h * (ph - pka)))\n\n    results = []\n\n    for case in test_cases:\n        ph_data = np.array(case[\"ph\"])\n        theta_data = np.array(case[\"theta\"])\n\n        # Robust initial guess for pKa: pH where theta is closest to 0.5\n        idx_pka_guess = np.argmin(np.abs(theta_data - 0.5))\n        pka_guess = ph_data[idx_pka_guess]\n\n        # --- Fit 1: Henderson-Hasselbalch model (n_H fixed to 1) ---\n        p0_hh = [pka_guess]\n        bounds_hh = ([-2.0], [14.0])\n        \n        try:\n            params_hh, _ = curve_fit(hh_model, ph_data, theta_data, p0=p0_hh, bounds=bounds_hh)\n            pka_hh = params_hh[0]\n        except RuntimeError:\n            pka_hh = np.nan # Failed fit\n\n        # --- Fit 2: Hill-like model (n_H is a free parameter) ---\n        p0_hill = [pka_guess, 1.0] # Initial guess for n_H is 1.0\n        bounds_hill = ([-2.0, 0.1], [14.0, 5.0])\n\n        try:\n            params_hill, _ = curve_fit(hill_model, ph_data, theta_data, p0=p0_hill, bounds=bounds_hill)\n            pka_hill, n_h_hill = params_hill\n        except RuntimeError:\n            pka_hill, n_h_hill = np.nan, np.nan # Failed fit\n\n        results.append(f\"{pka_hh:.3f}\")\n        results.append(f\"{pka_hill:.3f}\")\n        results.append(f\"{n_h_hill:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}