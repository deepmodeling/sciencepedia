{
    "hands_on_practices": [
        {
            "introduction": "At the heart of statistical thermodynamics lies the ability to predict macroscopic properties from the underlying microscopic states of a system. This practice provides a foundational, hands-on experience in bridging this gap by calculating the standard Gibbs free energy of binding, $\\Delta G^\\circ$, directly from a set of discrete energy levels and degeneracies. By implementing the calculation of the canonical partition function, you will gain a concrete understanding of how temperature modulates the population of states and ultimately determines the thermodynamic favorability of a biomolecular interaction .",
            "id": "3867873",
            "problem": "A computational task is required to model temperature dependence of biomolecular binding based on first principles. Consider a bimolecular binding process between a receptor and a ligand forming a complex. Assume ideal solution behavior and that the relevant thermodynamic functions arise from the canonical ensemble applied to discrete microstates sampled in simulations such as Molecular Dynamics (MD) and Monte Carlo (MC). The fundamental base must be strictly used: the Boltzmann distribution, canonical partition function, and definitions of thermodynamic potentials. No shortcut formulas may be assumed a priori.\n\nBegin with the canonical ensemble for a macrostate labeled by $m \\in \\{\\mathrm{AB}, \\mathrm{A}, \\mathrm{B}\\}$, with discrete microstates indexed by $i$, molar energies $E_{m,i}$, and integer degeneracies $g_{m,i}$. The canonical partition function for macrostate $m$ is the sum over microstates of Boltzmann factors weighted by degeneracies. The inverse thermal energy is defined by $\\beta = 1/(\\mathcal{R} T)$, where $\\mathcal{R}$ is the molar gas constant. Treat energies as molar quantities and use the relation between free energy, equilibrium constant, and partition functions as implied by statistical mechanics of chemical equilibria, making the equilibrium constant dimensionless by the standard concentration $C^\\circ$ of $1$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$. Carefully justify every step purely from these bases. From these, derive the temperature-dependent standard Gibbs free energy of binding $\\,\\Delta G^\\circ(T)\\,$ for the reaction $\\mathrm{A} + \\mathrm{B} \\rightleftharpoons \\mathrm{AB}$, and derive expressions to compute ensemble-average molar enthalpies $H_m(T)$ for each macrostate, then the standard enthalpy and entropy changes $\\,\\Delta H^\\circ(T)\\,$ and $\\,\\Delta S^\\circ(T)\\,$. Finally, provide an algorithm that, given lists $\\{E_{m,i}\\}$ and $\\{g_{m,i}\\}$ and a temperature $T$, computes $\\,\\Delta G^\\circ(T)\\,$ expressed in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n\nYour program must implement the derived expressions to compute $\\,\\Delta G^\\circ(T)\\,$ for the following test suite. For all calculations, use $\\mathcal{R} = 8.314462618$ $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, and interpret every $E_{m,i}$ given below in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. When converting to Boltzmann factors, convert $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ to $\\mathrm{J}\\,\\mathrm{mol}^{-1}$ exactly. The standard concentration $C^\\circ$ is $1$ $\\mathrm{mol}\\,\\mathrm{L}^{-1}$, used only to render the equilibrium constant dimensionless. Your program must output $\\,\\Delta G^\\circ(T)\\,$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, rounded to three decimal places.\n\nTest suite (each case is a tuple of temperature, energies, and degeneracies for $\\mathrm{AB}$, $\\mathrm{A}$, and $\\mathrm{B}$):\n- Case $1$: $T = 298$ $\\mathrm{K}$; $\\mathrm{AB}$ energies $[-40.0, -35.0]$ with degeneracies $[2, 6]$; $\\mathrm{A}$ energies $[0.0, 1.0, 2.0]$ with degeneracies $[10, 5, 1]$; $\\mathrm{B}$ energies $[0.0, 1.0]$ with degeneracies $[10, 2]$.\n- Case $2$: $T = 250$ $\\mathrm{K}$; same energies and degeneracies as Case $1$.\n- Case $3$: $T = 350$ $\\mathrm{K}$; same energies and degeneracies as Case $1$.\n- Case $4$: $T = 298$ $\\mathrm{K}$; $\\mathrm{AB}$ energies $[-10.0, -9.0, -8.0]$ with degeneracies $[1, 1, 1]$; $\\mathrm{A}$ energies $[0.0, 0.5, 1.0]$ with degeneracies $[50, 20, 5]$; $\\mathrm{B}$ energies $[0.0, 0.5]$ with degeneracies $[50, 20]$.\n- Case $5$: $T = 298$ $\\mathrm{K}$; $\\mathrm{AB}$ energies $[-25.0]$ with degeneracies $[50]$; $\\mathrm{A}$ energies $[0.0]$ with degeneracies $[1]$; $\\mathrm{B}$ energies $[0.0]$ with degeneracies $[1]$.\n\nScientific realism requirements:\n- The canonical ensemble and ideal solution assumptions apply; pressure-volume contributions for dilute solutions are negligible, allowing identification of enthalpy with the ensemble average of molar energy for the present discrete-state model.\n- Degeneracies and energy levels represent coarse-grained microstates obtainable from simulations.\n\nYour program must produce exactly one line of output containing the results for the five cases as a comma-separated list enclosed in square brackets. The list must contain the five values of $\\,\\Delta G^\\circ(T)\\,$ corresponding to Cases $1$ to $5$ in order, each rounded to three decimal places, expressed in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$; for example, an output in the format $[x_1,x_2,x_3,x_4,x_5]$ where each $x_i$ is a float rounded to three decimals and uses the decimal or fraction representation without any percentage signs.",
            "solution": "The problem statement is a well-posed exercise in computational statistical thermodynamics, grounded in fundamental principles. It requests the derivation of key thermodynamic quantities for a biomolecular binding reaction from the canonical ensemble and the implementation of an algorithm to compute the standard Gibbs free energy of binding, $\\Delta G^\\circ(T)$. The problem is self-contained, scientifically sound, and provides all necessary data and constants for a unique solution.\n\nThe derivation and algorithmic design proceed from first principles as follows.\n\nThe core of the problem lies in the canonical ensemble. For a system at constant temperature $T$, volume $V$, and number of particles $N$, the probability of finding the system in a microstate $i$ with energy $E_i$ is given by the Boltzmann distribution. The canonical partition function, $Q$, sums the Boltzmann factors over all possible microstates and is the central quantity connecting microscopic states to macroscopic thermodynamic properties.\n\nFor a given molecular species (macrostate) $m \\in \\{\\mathrm{A}, \\mathrm{B}, \\mathrm{AB}\\}$, the partition function is defined as a sum over its discrete microstates $i$, which have molar energies $E_{m,i}$ and degeneracies $g_{m,i}$:\n$$Q_m(T) = \\sum_i g_{m,i} e^{-\\beta E_{m,i}}$$\nHere, $\\beta = 1/(\\mathcal{R}T)$ is the inverse thermal energy, with $\\mathcal{R}$ being the molar gas constant. The energies $E_{m,i}$ are provided in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ and must be converted to $\\mathrm{J}\\,\\mathrm{mol}^{-1}$ for use with $\\mathcal{R}$ in SI units.\n\nThe fundamental link from the partition function to thermodynamics is the Helmholtz free energy, $A$. For one mole of species $m$ in its standard state, the molar Helmholtz free energy is $A_m^\\circ(T) = -\\mathcal{R}T \\ln Q_m(T)$. The Gibbs free energy is $G_m^\\circ = A_m^\\circ + P V_m^\\circ$. As specified in the problem, for solutes in a dilute solution, pressure-volume contributions are considered negligible. Thus, we can approximate the standard molar Gibbs free energy of species $m$ as:\n$$G_m^\\circ(T) \\approx A_m^\\circ(T) = -\\mathcal{R}T \\ln Q_m(T)$$\n\nThe binding reaction is $\\mathrm{A} + \\mathrm{B} \\rightleftharpoons \\mathrm{AB}$. The standard Gibbs free energy of binding, $\\Delta G^\\circ(T)$, is the change in Gibbs free energy for this reaction under standard conditions:\n$$\\Delta G^\\circ(T) = G_{\\mathrm{AB}}^\\circ(T) - \\left( G_{\\mathrm{A}}^\\circ(T) + G_{\\mathrm{B}}^\\circ(T) \\right)$$\nSubstituting the expression for $G_m^\\circ(T)$ in terms of the partition functions, we obtain the primary equation for our calculation:\n$$\\Delta G^\\circ(T) = \\left(-\\mathcal{R}T \\ln Q_{\\mathrm{AB}}(T)\\right) - \\left(-\\mathcal{R}T \\ln Q_{\\mathrm{A}}(T) - \\mathcal{R}T \\ln Q_{\\mathrm{B}}(T)\\right)$$\n$$\\Delta G^\\circ(T) = -\\mathcal{R}T \\left( \\ln Q_{\\mathrm{AB}}(T) - \\ln Q_{\\mathrm{A}}(T) - \\ln Q_{\\mathrm{B}}(T) \\right)$$\nThis can be written compactly using the definition $\\Delta G^\\circ = -\\mathcal{R}T \\ln K^\\circ$, where $K^\\circ$ is the dimensionless standard equilibrium constant:\n$$K^\\circ = \\frac{Q_{\\mathrm{AB}}(T)}{Q_{\\mathrm{A}}(T) Q_{\\mathrm{B}}(T)}$$\nThe problem's reference to the standard concentration $C^\\circ=1 \\, \\mathrm{mol}\\,\\mathrm{L}^{-1}$ is a standard convention to ensure the equilibrium constant is dimensionless, effectively accounting for the volume/concentration dependence that is otherwise omitted in this simplified model focused on internal energy states.\n\nThe problem also requires the derivation of expressions for enthalpy and entropy changes. The ensemble-average molar energy for a species $m$, $U_m$, is given by:\n$$U_m(T) = \\langle E_m \\rangle = \\frac{\\sum_i g_{m,i} E_{m,i} e^{-\\beta E_{m,i}}}{\\sum_i g_{m,i} e^{-\\beta E_{m,i}}} = \\frac{1}{Q_m(T)} \\sum_i g_{m,i} E_{m,i} e^{-\\beta E_{m,i}}$$\nThis can also be expressed as a derivative of the partition function: $U_m(T) = -\\left(\\frac{\\partial \\ln Q_m}{\\partial \\beta}\\right)_V$. With the given assumption of negligible $PV$ work, the molar enthalpy $H_m$ is identified with the molar internal energy $U_m$, so $H_m(T) \\approx U_m(T)$.\nThe standard enthalpy of binding, $\\Delta H^\\circ(T)$, is then:\n$$\\Delta H^\\circ(T) = H_{\\mathrm{AB}}(T) - \\left( H_{\\mathrm{A}}(T) + H_{\\mathrm{B}}(T) \\right)$$\nFinally, the standard entropy of binding, $\\Delta S^\\circ(T)$, is obtained from the fundamental thermodynamic relation $\\Delta G^\\circ = \\Delta H^\\circ - T\\Delta S^\\circ$:\n$$\\Delta S^\\circ(T) = \\frac{\\Delta H^\\circ(T) - \\Delta G^\\circ(T)}{T}$$\n\nThe computational algorithm to find $\\Delta G^\\circ(T)$ must address a a critical numerical issue. Direct computation of $Q_m(T)$ involves terms like $e^{-\\beta E_{m,i}}$. If an energy $E_{m,i}$ is large and positive, the exponential term may underflow to zero. More critically, if $E_{m,i}$ is large and negative (strong binding), the exponent becomes large and positive, leading to numerical overflow. To ensure stability, we compute the natural logarithm of the partition function, $\\ln Q_m$, directly. We select the minimum energy for a given species, $E_{m, \\text{min}}$, and rewrite the partition function by factoring out its Boltzmann factor:\n$$Q_m(T) = \\sum_i g_{m,i} e^{-\\beta (E_{m,i} - E_{m, \\text{min}} + E_{m, \\text{min}})} = e^{-\\beta E_{m, \\text{min}}} \\sum_i g_{m,i} e^{-\\beta (E_{m,i} - E_{m, \\text{min}})}$$\nTaking the natural logarithm yields a numerically stable expression:\n$$\\ln Q_m(T) = -\\beta E_{m, \\text{min}} + \\ln\\left( \\sum_i g_{m,i} e^{-\\beta (E_{m,i} - E_{m, \\text{min}})} \\right)$$\nIn this form, the arguments of the exponentials are always non-positive, preventing overflow. The leading term, $-\\beta E_{m, \\text{min}}$, handles the overall energy scale.\n\nThe algorithm is therefore:\n1. For each species $m \\in \\{\\mathrm{A}, \\mathrm{B}, \\mathrm{AB}\\}$, obtain the lists of molar energies $\\{E_{m,i}\\}$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ and degeneracies $\\{g_{m,i}\\}$.\n2. Convert all energies to $\\mathrm{J}\\,\\mathrm{mol}^{-1}$ by multiplying by $1000$.\n3. Given a temperature $T$, calculate $\\beta = 1/(\\mathcal{R}T)$.\n4. For each species, calculate $\\ln Q_m(T)$ using the numerically stable formula derived above.\n5. Compute $\\Delta G^\\circ(T)$ in $\\mathrm{J}\\,\\mathrm{mol}^{-1}$ using $\\Delta G^\\circ(T) = -\\mathcal{R}T (\\ln Q_{\\mathrm{AB}} - \\ln Q_{\\mathrm{A}} - \\ln Q_{\\mathrm{B}})$.\n6. Convert the final $\\Delta G^\\circ(T)$ to $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ by dividing by $1000$ and round to the specified precision.\n\nThis procedure is implemented in the following code to compute the results for the provided test suite.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the temperature-dependent standard Gibbs free energy of binding\n    for a bimolecular reaction from first principles of statistical mechanics.\n    \"\"\"\n\n    # Define constants as specified in the problem statement.\n    # Molar gas constant in J mol^-1 K^-1.\n    R_GAS_CONSTANT = 8.314462618\n\n    def calculate_log_q(T, energies_kj, degeneracies):\n        \"\"\"\n        Calculates the natural logarithm of the canonical partition function, ln(Q),\n        for a given species at temperature T. This function uses a numerically stable\n        method by shifting energies to prevent overflow/underflow.\n\n        Args:\n            T (float): Temperature in Kelvin.\n            energies_kj (list of float): Molar energies of microstates in kJ/mol.\n            degeneracies (list of int): Degeneracies of the microstates.\n\n        Returns:\n            float: The value of ln(Q), which is dimensionless.\n        \"\"\"\n        # Handle the case of no microstates, although not expected for this problem.\n        if not energies_kj:\n            return -np.inf\n\n        # Convert energies from kJ/mol to J/mol for calculations with R.\n        energies_j = np.array(energies_kj) * 1000.0\n        degen_arr = np.array(degeneracies)\n\n        # Calculate the inverse thermal energy, beta.\n        beta = 1.0 / (R_GAS_CONSTANT * T)\n\n        # For numerical stability, find the minimum energy and shift all energies\n        # relative to it. This ensures that exponents in the Boltzmann factors\n        # are non-positive, preventing overflow.\n        min_energy_j = np.min(energies_j)\n        shifted_energies_j = energies_j - min_energy_j\n\n        # Calculate the sum of Boltzmann factors for the shifted energies.\n        sum_of_factors = np.sum(degen_arr * np.exp(-beta * shifted_energies_j))\n\n        # Calculate ln(Q) using the identity:\n        # ln(Q) = ln(exp(-beta * E_min) * sum(g_i * exp(-beta * (E_i - E_min))))\n        #       = -beta * E_min + ln(sum(g_i * exp(-beta * (E_i - E_min))))\n        log_q = -beta * min_energy_j + np.log(sum_of_factors)\n\n        return log_q\n\n    # The test suite as provided in the problem statement.\n    # Each entry is a tuple: (T, E_AB, g_AB, E_A, g_A, E_B, g_B)\n    test_cases = [\n        (298, [-40.0, -35.0], [2, 6], [0.0, 1.0, 2.0], [10, 5, 1], [0.0, 1.0], [10, 2]),\n        (250, [-40.0, -35.0], [2, 6], [0.0, 1.0, 2.0], [10, 5, 1], [0.0, 1.0], [10, 2]),\n        (350, [-40.0, -35.0], [2, 6], [0.0, 1.0, 2.0], [10, 5, 1], [0.0, 1.0], [10, 2]),\n        (298, [-10.0, -9.0, -8.0], [1, 1, 1], [0.0, 0.5, 1.0], [50, 20, 5], [0.0, 0.5], [50, 20]),\n        (298, [-25.0], [50], [0.0], [1], [0.0], [1]),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, e_ab, g_ab, e_a, g_a, e_b, g_b = case\n\n        # Calculate the natural logarithm of the partition function for each species.\n        log_q_ab = calculate_log_q(T, e_ab, g_ab)\n        log_q_a = calculate_log_q(T, e_a, g_a)\n        log_q_b = calculate_log_q(T, e_b, g_b)\n\n        # Calculate the standard Gibbs free energy of binding, Delta G^o.\n        # Delta_G_std = -RT * ln(K_eq)\n        # where K_eq = Q_ab / (Q_a * Q_b)\n        # Thus, ln(K_eq) = ln(Q_ab) - ln(Q_a) - ln(Q_b)\n        delta_log_q = log_q_ab - (log_q_a + log_q_b)\n        delta_g_j_mol = -R_GAS_CONSTANT * T * delta_log_q\n\n        # Convert the result from J/mol to kJ/mol for the final output.\n        delta_g_kj_mol = delta_g_j_mol / 1000.0\n\n        results.append(delta_g_kj_mol)\n\n    # Format the results to three decimal places and create the final output string.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While theoretical models provide invaluable insight, connecting them to experimental data is a critical skill in computational chemical biology. This exercise focuses on the van't Hoff analysis, a classic and powerful method for determining the complete thermodynamic signature of a binding event from temperature-dependent equilibrium measurements. By fitting experimental-like data, you will extract the standard enthalpy ($\\Delta H^\\circ$) and entropy ($\\Delta S^\\circ$) changes, revealing the driving forces behind the association process .",
            "id": "3867869",
            "problem": "You are tasked with implementing a complete, runnable program that performs a rigorous analysis of biomolecular binding thermodynamics using data appropriate for van't Hoff analysis, grounded in first principles. The program must derive and estimate the standard binding enthalpy and entropy from equilibrium binding data across temperature, and then evaluate the standard Gibbs free energy at a specified reference temperature. Your derivation must begin from the fundamental thermodynamic identities for standard Gibbs free energy and its relation to the equilibrium constant, and from the definition of standard enthalpy and entropy, without invoking any shortcut formulas. The analysis must be applicable to association equilibrium constants provided directly or to dissociation constants that must be first converted to association constants. The program must operate deterministically without any external input, must perform its own calculations and output the result in the specified format.\n\nScientific assumptions and constraints:\n- Standard Gibbs free energy applies, with a molar standard state of $1$ mol per liter (M) for solutes, consistent with biochemical conventions.\n- Over the provided temperature ranges, you may assume that the standard binding enthalpy and entropy are temperature-independent to a good approximation.\n- Use the natural logarithm for all logarithmic quantities related to equilibrium constants.\n- Equilibrium constants are treated as dimensionless using the $1$ mol per liter standard state; numerical values may be provided as association constants with nominal units of $\\mathrm{M}^{-1}$ or as dissociation constants with nominal units of $\\mathrm{M}$, and must be handled consistently by conversion when necessary.\n- Temperatures are absolute and expressed in Kelvin.\n\nYour program must perform the following for each dataset in the test suite:\n1. Convert any dissociation constant data to association constants using only fundamental definitions.\n2. Construct the appropriate variables from first principles to obtain a linear relation amenable to an ordinary least squares fit that estimates the standard binding enthalpy and entropy.\n3. Compute the standard Gibbs free energy at a reference temperature $T_0$ using the fitted thermodynamic parameters.\n4. Express the standard enthalpy in kilojoules per mole, the standard entropy in joules per mole per Kelvin, and the standard Gibbs free energy in kilojoules per mole.\n5. Round all numerical outputs to three decimal places.\n\nPhysical constants and units:\n- Use the universal gas constant $R = 8.314462618$ $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n- Express the standard enthalpy in $\\mathrm{kJ\\,mol^{-1}}$, the standard entropy in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, and the standard Gibbs free energy in $\\mathrm{kJ\\,mol^{-1}}$.\n- Use the reference temperature $T_0 = 298.000$ $\\mathrm{K}$.\n\nTest suite:\nEach test case consists of a list of temperatures in Kelvin, a corresponding list of equilibrium constant values, and a flag indicating whether the constants are provided as dissociation constants. All temperatures and constants are noise-free except where noted. All numerical values below are given to a realistic number of significant figures.\n\n- Test case $1$ (association constants, exothermic-like binding):\n  - Temperatures $T$: $[283.000, 293.000, 303.000, 313.000]$ $\\mathrm{K}$.\n  - Association constants $K_\\mathrm{a}$: $[80000.000, 60000.000, 45000.000, 34000.000]$ (dimensionless with $1$ mol per liter standard state).\n  - Flag is dissociation constants: $False$.\n\n- Test case $2$ (dissociation constants, mildly endothermic with measurement variation):\n  - Temperatures $T$: $[283.000, 293.000, 303.000, 313.000]$ $\\mathrm{K}$.\n  - Dissociation constants $K_\\mathrm{d}$: $[0.000009000, 0.000007000, 0.000005800, 0.000005000]$ $\\mathrm{M}$.\n  - Flag is dissociation constants: $True$.\n\n- Test case $3$ (association constants, near-zero enthalpy boundary; weak temperature dependence):\n  - Temperatures $T$: $[283.000, 293.000, 303.000, 313.000]$ $\\mathrm{K}$.\n  - Association constants $K_\\mathrm{a}$: $[50000.000, 50050.000, 49950.000, 50020.000]$ (dimensionless with $1$ mol per liter standard state).\n  - Flag is dissociation constants: $False$.\n\n- Test case $4$ (association constants, endothermic-like binding; stronger temperature dependence):\n  - Temperatures $T$: $[283.000, 293.000, 303.000, 313.000]$ $\\mathrm{K}$.\n  - Association constants $K_\\mathrm{a}$: $[20000.000, 25000.000, 33000.000, 44000.000]$ (dimensionless with $1$ mol per liter standard state).\n  - Flag is dissociation constants: $False$.\n\nOutput specification:\n- For each test case, compute and output a list $[\\Delta H^\\circ, \\Delta S^\\circ, \\Delta G^\\circ(T_0)]$ with values rounded to three decimal places in the units specified above.\n- Your program should produce a single line of output containing the results as a comma-separated list of these lists, enclosed in square brackets, with no spaces. For example: $\"[[h_1,s_1,g_1],[h_2,s_2,g_2],...]\"$ where each $h_i$, $s_i$, and $g_i$ are rounded floats.\n\nWhat to implement:\n- Implement an ordinary least squares linear regression from first principles for the appropriate linearized variables implied by the thermodynamic identities. You may use standard numerical routines provided by the programming environment. Ensure numerical stability and dimensional consistency.\n- Ensure that all computations use the natural logarithm and the specified constant $R$.\n- Ensure that the final output adheres exactly to the specified single-line format.\n\nAnswer in the exact units specified and in the format described. Use radians for any angle computations if relevant; angles are not required in this task.",
            "solution": "We begin from the fundamental thermodynamic definitions. The standard Gibbs free energy of binding, denoted by $\\Delta G^\\circ$, is defined via the equilibrium constant by the identity\n$$\n\\Delta G^\\circ = - R T \\ln K,\n$$\nwhere $R$ is the universal gas constant, $T$ is the absolute temperature, and $K$ is the dimensionless equilibrium constant referenced to the $1$ mol per liter standard state. In solution biochemistry, when a numerical value for an association constant is given in nominal $\\mathrm{M}^{-1}$ units, it is understood as dimensionless after multiplication by the standard concentration $c^\\circ = 1\\,\\mathrm{M}$, so that the natural logarithm can be applied consistently. When dissociation constants $K_\\mathrm{d}$ are provided in $\\mathrm{M}$, the association constant follows from the fundamental definition of equilibrium via $K_\\mathrm{a} = 1/K_\\mathrm{d}$, and likewise can be treated as dimensionless under the same standard-state convention.\n\nAnother fundamental identity for the standard Gibbs free energy relates it to the standard enthalpy $\\Delta H^\\circ$ and standard entropy $\\Delta S^\\circ$:\n$$\n\\Delta G^\\circ = \\Delta H^\\circ - T \\Delta S^\\circ.\n$$\nUnder the assumption that $\\Delta H^\\circ$ and $\\Delta S^\\circ$ are approximately independent of temperature over the range studied (a widely used approximation for modest temperature windows in biochemical binding), we can combine these two identities algebraically to obtain a relationship between the equilibrium constant and temperature. Substituting the expression for $\\Delta G^\\circ$ into the identity linking it to $\\ln K$ yields\n$$\n- R T \\ln K = \\Delta H^\\circ - T \\Delta S^\\circ.\n$$\nDividing both sides by $-R T$ and rearranging terms gives\n$$\n\\ln K = -\\frac{\\Delta H^\\circ}{R} \\left(\\frac{1}{T}\\right) + \\frac{\\Delta S^\\circ}{R}.\n$$\nThis shows that the natural logarithm of the equilibrium association constant $\\ln K$ varies linearly with the reciprocal temperature $1/T$, with slope $m = -\\Delta H^\\circ / R$ and intercept $b = \\Delta S^\\circ / R$. Therefore, given measurements of equilibrium constants at multiple temperatures, we can perform an ordinary least squares linear regression of $y = \\ln K$ against $x = 1/T$ to estimate the slope $m$ and intercept $b$. From these, the thermodynamic parameters are recovered by\n$$\n\\Delta H^\\circ = - m R \\quad\\text{and}\\quad \\Delta S^\\circ = b R.\n$$\n\nAlgorithmic design grounded in the above principles:\n1. For each dataset, determine the association constant values. If the dataset provides dissociation constants $K_\\mathrm{d}$ (flag is true), compute association constants via $K_\\mathrm{a} = 1/K_\\mathrm{d}$. If association constants are provided (flag is false), use them directly. Under the $1$ mol per liter standard state, treat these numerical values as dimensionless for the logarithm.\n2. Form the predictor and response variables as $x_i = 1/T_i$ (in $\\mathrm{K}^{-1}$) and $y_i = \\ln K_{\\mathrm{a},i}$ (dimensionless), respectively, using the natural logarithm.\n3. Fit a straight line $y = m x + b$ to these points using ordinary least squares. In closed form, the normal equations yield:\n   $$\n   m = \\frac{N \\sum x_i y_i - \\sum x_i \\sum y_i}{N \\sum x_i^2 - \\left(\\sum x_i\\right)^2}, \\qquad\n   b = \\frac{\\sum y_i - m \\sum x_i}{N},\n   $$\n   where $N$ is the number of data points. Equivalently, a numerically stable polynomial fit routine for degree $1$ can be used to obtain $m$ and $b$.\n4. Compute the thermodynamic parameters using the identities $\\Delta H^\\circ = - m R$ and $\\Delta S^\\circ = b R$. Convert $\\Delta H^\\circ$ to $\\mathrm{kJ\\,mol^{-1}}$ by dividing by $1000$, retain $\\Delta S^\\circ$ in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n5. Evaluate the standard Gibbs free energy at the reference temperature $T_0$ using $\\Delta G^\\circ(T_0) = \\Delta H^\\circ - T_0 \\Delta S^\\circ$. Convert the result to $\\mathrm{kJ\\,mol^{-1}}$ by dividing by $1000$.\n6. Round each of $\\Delta H^\\circ$ (in $\\mathrm{kJ\\,mol^{-1}}$), $\\Delta S^\\circ$ (in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$), and $\\Delta G^\\circ(T_0)$ (in $\\mathrm{kJ\\,mol^{-1}}$) to three decimal places.\n7. Aggregate the results for all test cases into a single list of lists $[[\\Delta H^\\circ,\\Delta S^\\circ,\\Delta G^\\circ(T_0)],\\ldots]$, and print a single line containing this list with comma-separated entries and no spaces.\n\nScientific realism and edge cases in the test suite:\n- Test case $1$ provides association constants decreasing with temperature, typical of exothermic binding ($\\Delta H^\\circ < 0$), yielding a negative slope $m$ and a negative $\\Delta H^\\circ$.\n- Test case $2$ provides dissociation constants that, when inverted, yield association constants increasing with temperature, consistent with endothermic binding ($\\Delta H^\\circ > 0$). Minor measurement variation tests numerical stability.\n- Test case $3$ provides association constants nearly independent of temperature, probing the boundary where $\\Delta H^\\circ \\approx 0$ and the slope approaches zero.\n- Test case $4$ provides association constants increasing more strongly with temperature, consistent with a more endothermic process and a larger positive entropy.\n\nThe program will implement the above steps, using the universal gas constant $R = 8.314462618$ $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, the natural logarithm, and the reference temperature $T_0 = 298.000$ $\\mathrm{K}$. The final output will strictly adhere to the specified formatting.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef vanthoff_fit(temperatures_K, constants, is_dissociation, R=8.314462618, T0=298.0):\n    \"\"\"\n    Perform van't Hoff analysis:\n    - temperatures_K: list or array of temperatures in Kelvin.\n    - constants: list or array of equilibrium constants (association or dissociation).\n    - is_dissociation: bool, True if 'constants' are dissociation constants (Kd), False if association (Ka).\n    - R: universal gas constant in J/mol/K.\n    - T0: reference temperature in Kelvin.\n    Returns: (DeltaH_kJ_per_mol, DeltaS_J_per_mol_K, DeltaG_kJ_per_mol_at_T0)\n    \"\"\"\n    T = np.array(temperatures_K, dtype=float)\n    vals = np.array(constants, dtype=float)\n\n    # Convert dissociation constants to association constants if necessary.\n    if is_dissociation:\n        # Association constant Ka = 1 / Kd\n        Ka = 1.0 / vals\n    else:\n        Ka = vals\n\n    # Prepare variables for linear regression: y = ln(Ka), x = 1/T\n    x = 1.0 / T\n    y = np.log(Ka)\n\n    # Fit y = m*x + b using ordinary least squares.\n    # Use numpy.polyfit degree 1 for numerical stability.\n    m, b = np.polyfit(x, y, 1)\n\n    # Recover thermodynamic parameters from slope and intercept.\n    # m = -DeltaH/R  => DeltaH = -m*R (J/mol)\n    # b = DeltaS/R   => DeltaS = b*R (J/mol/K)\n    deltaH_J_per_mol = -m * R\n    deltaS_J_per_mol_K = b * R\n\n    # Convert DeltaH to kJ/mol\n    deltaH_kJ_per_mol = deltaH_J_per_mol / 1000.0\n\n    # Compute DeltaG at T0: DeltaG = DeltaH - T0*DeltaS (J/mol), then to kJ/mol\n    deltaG_J_per_mol_T0 = deltaH_J_per_mol - T0 * deltaS_J_per_mol_K\n    deltaG_kJ_per_mol_T0 = deltaG_J_per_mol_T0 / 1000.0\n\n    # Round to three decimal places\n    return (\n        round(deltaH_kJ_per_mol, 3),\n        round(deltaS_J_per_mol_K, 3),\n        round(deltaG_kJ_per_mol_T0, 3),\n    )\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Each case: (temperatures_K_list, constants_list, is_dissociation_flag)\n        ([283.000, 293.000, 303.000, 313.000], [80000.000, 60000.000, 45000.000, 34000.000], False),\n        ([283.000, 293.000, 303.000, 313.000], [0.000009000, 0.000007000, 0.000005800, 0.000005000], True),\n        ([283.000, 293.000, 303.000, 313.000], [50000.000, 50050.000, 49950.000, 50020.000], False),\n        ([283.000, 293.000, 303.000, 313.000], [20000.000, 25000.000, 33000.000, 44000.000], False),\n    ]\n\n    results = []\n    for temps, consts, is_kd in test_cases:\n        h_kj, s_jk, g_kj = vanthoff_fit(temps, consts, is_kd)\n        results.append([h_kj, s_jk, g_kj])\n\n    # Build the exact required single-line output: comma-separated lists, no spaces.\n    # Format each inner list with numbers joined by commas.\n    inner_strs = []\n    for triple in results:\n        inner_strs.append(f\"[{triple[0]},{triple[1]},{triple[2]}]\")\n    output = f\"[{','.join(inner_strs)}]\"\n    print(output)\n\nsolve()\n```"
        },
        {
            "introduction": "Many biological processes, from oxygen transport by hemoglobin to gene regulation, rely on cooperativity, where the binding of one ligand influences the affinity of subsequent ligands. This advanced practice challenges you to model this phenomenon from first principles using a statistical mechanical model for a multi-site macromolecule. You will construct the binding polynomial for a system with nearest-neighbor interactions and compute the Hill coefficient, a key experimental measure of cooperativity, thereby linking a sophisticated theoretical framework to empirical observation .",
            "id": "3867863",
            "problem": "Consider a macromolecule with $N$ identical ligand binding sites arranged linearly (no periodic wrap-around). A ligand at bulk concentration $c$ (in moles per liter) can bind to each site with an intrinsic dissociation constant $K_{\\mathrm{d}}$ (in moles per liter). Cooperative interaction arises through nearest-neighbor coupling: for every pair of adjacent occupied sites, there is an interaction free energy $\\Delta \\epsilon_{\\mathrm{coop}}$ (in kilojoules per mole) added to the system’s free energy. The temperature is $T$ (in kelvins), and the universal gas constant is $R = 8.314462618$ in joules per mole per kelvin. Assume a grand canonical description in which the bulk concentration sets the effective binding weight per site, and treat the ligand as ideal and well-mixed.\n\nStarting from statistical mechanics of the canonical ensemble and the definition of the binding polynomial (partition function), construct from first principles a computational procedure to evaluate the operational Hill coefficient at half-saturation as follows:\n\n- Enumerate all microstates of the $N$-site linear chain, where each site is either occupied $(1)$ or unoccupied $(0)$. For a given microstate, let $n_{\\mathrm{b}}$ be the number of occupied sites and let $n_{\\mathrm{pairs}}$ be the number of adjacent occupied pairs.\n- Let $w = c / K_{\\mathrm{d}}$ be the dimensionless binding weight per site, and let $\\omega = \\exp\\!\\left(-\\Delta \\epsilon_{\\mathrm{coop}} \\times 10^{3} \\, / \\, (R \\, T)\\right)$ be the dimensionless cooperativity factor per adjacent occupied pair, with $\\Delta \\epsilon_{\\mathrm{coop}}$ converted from kilojoules per mole to joules per mole inside the exponential.\n- Define the partition function\n$$\nZ(c) = \\sum_{\\text{microstates}} w^{n_{\\mathrm{b}}} \\, \\omega^{n_{\\mathrm{pairs}}}.\n$$\n- Define the fractional occupancy\n$$\n\\theta(c) = \\frac{1}{N} \\, \\frac{\\sum_{\\text{microstates}} n_{\\mathrm{b}} \\, w^{n_{\\mathrm{b}}} \\, \\omega^{n_{\\mathrm{pairs}}}}{\\sum_{\\text{microstates}} w^{n_{\\mathrm{b}}} \\, \\omega^{n_{\\mathrm{pairs}}}}.\n$$\n\nThe operational Hill coefficient $n_{\\mathrm{H}}$ at half-saturation is defined in terms of the slope of the Hill transform at $\\theta = 1/2$:\n$$\nn_{\\mathrm{H}} = \\left. \\frac{\\mathrm{d}}{\\mathrm{d} \\ln c} \\ln\\!\\left(\\frac{\\theta(c)}{1 - \\theta(c)}\\right) \\right|_{\\theta(c) = 1/2}.\n$$\nYour program must:\n- Numerically determine $c_{1/2}$ such that $\\theta(c_{1/2}) = 1/2$.\n- Numerically evaluate $n_{\\mathrm{H}}$ at $c_{1/2}$ using a small symmetric increment in $\\ln c$ to approximate the derivative, ensuring numerical stability in all regimes specified below.\n- Use a numerically stable algorithm to evaluate $Z(c)$ and $\\theta(c)$ for all required $c$, avoiding overflow or underflow.\n\nPhysical unit specifications:\n- Temperature $T$ must be handled in kelvins.\n- Dissociation constant $K_{\\mathrm{d}}$ and concentration $c$ must be handled in moles per liter.\n- Interaction free energy $\\Delta \\epsilon_{\\mathrm{coop}}$ must be handled in kilojoules per mole and converted internally to joules per mole for use with $R$.\n\nTest suite:\nCompute $n_{\\mathrm{H}}$ for the following four parameter sets, each specified as a tuple $(N, K_{\\mathrm{d}}, \\Delta \\epsilon_{\\mathrm{coop}}, T)$:\n\n1. $(4, 10^{-6}, -2, 298)$: positive cooperativity with moderate stabilization.\n2. $(4, 10^{-6}, 0, 298)$: no cooperativity (independent sites).\n3. $(4, 10^{-6}, +4, 298)$: negative cooperativity with moderate destabilization.\n4. $(1, 10^{-6}, -10, 298)$: single-site limit, interaction irrelevant.\n\nAnswer specification and final output format:\n- For each test case, output the computed $n_{\\mathrm{H}}$ as a float rounded to three decimal places.\n- Your program should produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets, for example, $[\\dots]$.\n- The final outputs are dimensionless; no unit symbols should appear in the output.\n\nScientific realism constraints:\n- All computations must follow from the fundamental definitions above without introducing empirical shortcut formulas.\n- Ensure monotonicity of $\\theta(c)$ in $c$ is respected by the root-finding procedure used to obtain $c_{1/2}$.",
            "solution": "The problem requires the computation of the operational Hill coefficient, $n_{\\mathrm{H}}$, at half-saturation ($\\theta = 1/2$) for a one-dimensional chain of $N$ identical ligand binding sites. The theoretical framework is that of statistical mechanics, specifically the grand canonical ensemble applied to a lattice model, commonly known as the 1D Ising model in this context. The solution will be constructed from first principles as stipulated.\n\nThe state of the system is defined by the set of all possible binding configurations, or microstates. For a linear chain of $N$ sites, where each site can be either unoccupied (state $0$) or occupied (state $1$), there are $2^N$ distinct microstates. The statistical weight of each microstate in the grand canonical ensemble is determined by the number of occupied sites, $n_{\\mathrm{b}}$, and the number of nearest-neighbor interactions between occupied sites, $n_{\\mathrm{pairs}}$.\n\nThe dimensionless statistical weight for binding a single ligand is given by the ratio of the ligand concentration $c$ to the intrinsic dissociation constant $K_{\\mathrm{d}}$:\n$$\nw = \\frac{c}{K_{\\mathrm{d}}}\n$$\nThe dimensionless cooperativity factor, $\\omega$, accounts for the interaction free energy $\\Delta \\epsilon_{\\mathrm{coop}}$ between adjacent occupied sites. This factor is derived from the Boltzmann weight of the interaction energy:\n$$\n\\omega = \\exp\\!\\left(-\\frac{\\Delta \\epsilon_{\\mathrm{coop}} \\times 10^3}{RT}\\right)\n$$\nwhere the factor of $10^3$ converts $\\Delta \\epsilon_{\\mathrm{coop}}$ from kilojoules per mole to the SI unit of joules per mole, consistent with the universal gas constant $R = 8.314462618 \\, \\mathrm{J} \\, \\mathrm{mol}^{-1} \\, \\mathrm{K}^{-1}$. A value of $\\Delta \\epsilon_{\\mathrm{coop}} < 0$ corresponds to a stabilizing interaction (positive cooperativity, $\\omega > 1$), while $\\Delta \\epsilon_{\\mathrm{coop}} > 0$ corresponds to a destabilizing interaction (negative cooperativity, $\\omega < 1$). If $\\Delta \\epsilon_{\\mathrm{coop}} = 0$, the sites are independent ($\\omega = 1$).\n\nThe partition function, or binding polynomial, $Z(c)$, is the sum of the statistical weights of all possible microstates:\n$$\nZ(c) = \\sum_{i=1}^{2^N} w^{n_{\\mathrm{b},i}} \\, \\omega^{n_{\\mathrm{pairs},i}}\n$$\nwhere the sum is over all microstates $i$, and $n_{\\mathrm{b},i}$ and $n_{\\mathrm{pairs},i}$ are the number of bound ligands and adjacent occupied pairs for that microstate, respectively.\n\nThe fractional saturation, $\\theta(c)$, is the average number of occupied sites, $\\langle n_{\\mathrm{b}} \\rangle$, divided by the total number of sites, $N$. The average is calculated using the partition function:\n$$\n\\theta(c) = \\frac{\\langle n_{\\mathrm{b}} \\rangle}{N} = \\frac{1}{N} \\frac{\\sum_{i} n_{\\mathrm{b},i} \\, w^{n_{\\mathrm{b},i}} \\, \\omega^{n_{\\mathrm{pairs},i}}}{\\sum_{i} w^{n_{\\mathrm{b},i}} \\, \\omega^{n_{\\mathrm{pairs},i}}}\n$$\nThis expression can also be written compactly as a derivative of the logarithm of the partition function:\n$$\n\\theta(c) = \\frac{1}{N} w \\frac{\\partial \\ln Z(c)}{\\partial w} = \\frac{1}{N} \\frac{\\partial \\ln Z(c)}{\\partial \\ln w}\n$$\n\nThe computational procedure to determine the Hill coefficient $n_{\\mathrm{H}}$ involves three main steps.\n\n**Step 1: Evaluation of Thermodynamic Functions**\nAs per the problem description, we will evaluate $Z(c)$ and the numerator sum for $\\theta(c)$ by direct enumeration of all $2^N$ microstates. This approach is numerically exact and feasible for the small values of $N$ specified in the test suite. Each integer from $0$ to $2^N - 1$ uniquely represents a microstate via its binary representation. For each microstate:\n1.  The number of occupied sites, $n_{\\mathrm{b}}$, is the number of set bits (Hamming weight) in its binary representation.\n2.  The number of adjacent occupied pairs, $n_{\\mathrm{pairs}}$, is found by inspecting adjacent bits in the binary string, counting occurrences of the pattern `11`.\nWith these values for each microstate, the sums for $Z(c)$ and the numerator term for $\\theta(c)$ can be computed for any given concentration $c$.\n\n**Step 2: Determination of the Half-Saturation Concentration, $c_{1/2}$**\nThe concentration at half-saturation, $c_{1/2}$, is defined by the condition $\\theta(c_{1/2}) = 1/2$. To find $c_{1/2}$, we must solve the following equation for $c$:\n$$\nf(c) = \\theta(c) - \\frac{1}{2} = 0\n$$\nThe function $\\theta(c)$ is a monotonically increasing function of $c$, ranging from $\\theta(0)=0$ to $\\theta(\\infty)=1$. This guarantees the existence of a unique root $c_{1/2}$. A robust numerical root-finding algorithm, such as Brent's method, is suitable for this task. An appropriate search interval is required; given that $c_{1/2} = K_{\\mathrm{d}}$ for the non-cooperative case, a search bracket centered logarithmically around $K_{\\mathrm{d}}$ (e.g., $[10^{-3} K_{\\mathrm{d}}, 10^3 K_{\\mathrm{d}}]$) is a reliable choice.\n\n**Step 3: Calculation of the Hill Coefficient, $n_{\\mathrm{H}}$**\nThe operational Hill coefficient at half-saturation is defined as the slope of the Hill plot at the point of half-saturation:\n$$\nn_{\\mathrm{H}} = \\left. \\frac{\\mathrm{d}}{\\mathrm{d} \\ln c} \\ln\\!\\left(\\frac{\\theta(c)}{1 - \\theta(c)}\\right) \\right|_{c = c_{1/2}}\n$$\nWe will approximate this derivative numerically using a second-order, symmetric finite difference scheme. Let $Y(c) = \\ln(\\theta(c)/(1 - \\theta(c)))$ and $x = \\ln c$. The derivative is then approximated as:\n$$\nn_{\\mathrm{H}} \\approx \\frac{Y(c_+) - Y(c_-)}{x_+ - x_-}\n$$\nwhere $x_{\\pm} = \\ln(c_{1/2}) \\pm h$ for a small step size $h$ (e.g., $h=10^{-6}$). This translates to evaluating the Hill transform $Y(c)$ at concentrations $c_+ = c_{1/2} e^h$ and $c_- = c_{1/2} e^{-h}$. The full expression is:\n$$\nn_{\\mathrm{H}} \\approx \\frac{Y(c_{1/2} e^h) - Y(c_{1/2} e^{-h})}{2h}\n$$\nThis method provides a stable and accurate estimate of the derivative.\n\nThe overall algorithm for each test case is as follows:\n1.  Given $(N, K_{\\mathrm{d}}, \\Delta \\epsilon_{\\mathrm{coop}}, T)$, calculate the cooperativity factor $\\omega$.\n2.  Pre-compute and store the properties ($n_{\\mathrm{b}}$, $n_{\\mathrm{pairs}}$) for all $2^N$ microstates.\n3.  Define a function for $\\theta(c)$ based on the microstate enumeration.\n4.  Numerically solve $\\theta(c) - 1/2 = 0$ to find $c_{1/2}$.\n5.  Apply the symmetric finite difference formula using the computed $c_{1/2}$ to find $n_{\\mathrm{H}}$.\n6.  Round the result to three decimal places as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It calculates the operational Hill coefficient at half-saturation for a 1D cooperative binding model.\n    \"\"\"\n    R = 8.314462618  # Universal gas constant in J/(mol·K)\n\n    # Test suite: (N, K_d, dE_coop, T)\n    # N: number of sites\n    # K_d: intrinsic dissociation constant (mol/L)\n    # dE_coop: interaction free energy (kJ/mol)\n    # T: temperature (K)\n    test_cases = [\n        (4, 1e-6, -2.0, 298.0),  # Positive cooperativity\n        (4, 1e-6, 0.0, 298.0),   # No cooperativity (independent sites)\n        (4, 1e-6, 4.0, 298.0),   # Negative cooperativity\n        (1, 1e-6, -10.0, 298.0)  # Single site (cooperativity irrelevant)\n    ]\n\n    results = []\n    for case in test_cases:\n        n_H = compute_hill_coefficient(case, R)\n        results.append(f\"{n_H:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef get_microstate_properties(N):\n    \"\"\"\n    Enumerates all 2^N microstates and computes their properties.\n    For each microstate, it calculates the number of occupied sites (n_b)\n    and the number of adjacent occupied pairs (n_pairs).\n\n    Args:\n        N (int): The number of binding sites.\n\n    Returns:\n        list: A list of tuples, where each tuple is (n_b, n_pairs).\n    \"\"\"\n    properties = []\n    for i in range(2**N):\n        # n_b is the number of set bits (Hamming weight)\n        n_b = bin(i).count('1')\n        \n        # n_pairs is the number of adjacent '11' patterns\n        n_pairs = 0\n        temp_i = i\n        while temp_i > 0:\n            # Check if the last two bits are '11'\n            if (temp_i  3) == 3:\n                n_pairs += 1\n            temp_i >>= 1\n        \n        properties.append((n_b, n_pairs))\n    return properties\n\ndef compute_hill_coefficient(params, R):\n    \"\"\"\n    Computes the Hill coefficient for a single set of parameters.\n\n    Args:\n        params (tuple): A tuple containing (N, K_d, dE_coop, T).\n        R (float): The universal gas constant.\n\n    Returns:\n        float: The calculated Hill coefficient.\n    \"\"\"\n    N, Kd, dE_coop, T = params\n    \n    # Calculate dimensionless cooperativity factor omega\n    # dE_coop is converted from kJ/mol to J/mol\n    omega = np.exp(-dE_coop * 1000.0 / (R * T))\n    \n    # Pre-compute properties of all microstates to speed up calculations\n    microstate_props = get_microstate_properties(N)\n\n    def theta_fn(c):\n        \"\"\"\n        Calculates the fractional occupancy theta for a given concentration c.\n        \"\"\"\n        if c = 0:\n            return 0.0\n        \n        w = c / Kd  # Dimensionless binding weight\n        \n        Z_sum = 0.0\n        numerator_sum = 0.0\n        \n        for n_b, n_pairs in microstate_props:\n            # The calculation of w**n_b can be unstable for large n_b and extreme w.\n            # Using logarithms can improve stability, but for N=4, direct power is fine.\n            # term = np.exp(n_b * np.log(w) + n_pairs * np.log(omega)) if w > 0 else 0\n            term = (w**n_b) * (omega**n_pairs)\n            Z_sum += term\n            numerator_sum += n_b * term\n            \n        if Z_sum == 0.0:\n            return 0.0 # Should not occur for c > 0\n            \n        return (1.0 / N) * numerator_sum / Z_sum\n\n    # Step 2: Find the concentration c_1/2 where theta(c) = 1/2\n    # Define the function whose root we want to find\n    root_fn = lambda c: theta_fn(c) - 0.5\n    \n    # Set a safe search bracket around Kd\n    # Cooperativity shifts c_1/2, so a wide range is robust.\n    bracket = [Kd * 1e-4, Kd * 1e4]\n    \n    # Use Brent's method to find the root\n    sol = root_scalar(root_fn, bracket=bracket, method='brentq')\n    c_half = sol.root\n\n    # Step 3: Calculate the Hill coefficient n_H using a symmetric finite difference\n    h = 1e-6  # Small step for numerical derivative in log space\n    \n    # Concentrations for symmetric difference\n    c_plus = c_half * np.exp(h)\n    c_minus = c_half * np.exp(-h)\n    \n    # Calculate theta at these concentrations\n    theta_plus = theta_fn(c_plus)\n    theta_minus = theta_fn(c_minus)\n    \n    # Hill transform Y = log(theta / (1 - theta))\n    # Add small epsilon to avoid log(0) or division by zero, though unlikely here.\n    eps = 1e-12\n    Y_plus = np.log((theta_plus + eps) / (1.0 - theta_plus + eps))\n    Y_minus = np.log((theta_minus + eps) / (1.0 - theta_minus + eps))\n    \n    # n_H = d(Y) / d(log c)\n    n_H = (Y_plus - Y_minus) / (2.0 * h)\n    \n    return n_H\n\nsolve()\n```"
        }
    ]
}