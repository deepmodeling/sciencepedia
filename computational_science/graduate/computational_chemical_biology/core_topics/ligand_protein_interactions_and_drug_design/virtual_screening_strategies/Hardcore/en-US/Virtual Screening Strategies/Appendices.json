{
    "hands_on_practices": [
        {
            "introduction": "In ligand-based virtual screening, the principle of molecular similarity is paramount. We often represent molecules as binary fingerprints, and the Tanimoto coefficient is the workhorse for quantifying their similarity. This practice will guide you through the fundamental calculation of the Tanimoto similarity between two hypothetical fingerprints , helping you build a concrete understanding of how structural relationships are encoded and compared numerically.",
            "id": "3869931",
            "problem": "A central operation in ligand-based virtual screening is to rank candidate molecules by similarity to a query using binary structural fingerprints. Consider two molecules whose hashed circular fingerprints of length $64$ bits are represented by the sets of indices at which the bits are $1$. Let the query fingerprint be\n$$A=\\{1,3,5,7,8,12,15,16,18,21,26,27,32,33,34,38,44,48,53,57,60\\},$$\nand the candidate fingerprint be\n$$B=\\{3,5,7,9,12,15,16,18,20,21,24,26,27,30,33,34,35,38,41,44,47,48,57,60,61\\}.$$\nStarting from the set-theoretic definition of the similarity measure commonly used to compute the Tanimoto coefficient (also known as the Jaccard index) for binary fingerprints in virtual screening, derive the expression that relates similarity to the number of shared bits and the numbers of bits unique to each molecule, and then compute the similarity between $A$ and $B$. Finally, explain how this dependence informs neighborhood ranking with respect to increasing the count of shared bits versus increasing the count of unique bits. Express the final numerical similarity as a unitless decimal and round your answer to four significant figures.",
            "solution": "The problem requires a three-part response: the derivation of a specific form of the Tanimoto coefficient, its calculation for the given data, and an explanation of its properties in the context of neighborhood ranking.\n\nFirst, we address the derivation. The Tanimoto coefficient, $T_c$, for two sets $A$ and $B$ is defined as the ratio of the size (cardinality) of their intersection to the size of their union:\n$$T_c(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}$$\nThis definition is fundamental. The cardinality of the union of two sets can be expressed in terms of their individual cardinalities and the cardinality of their intersection using the principle of inclusion-exclusion:\n$$|A \\cup B| = |A| + |B| - |A \\cap B|$$\nSubstituting this into the definition of the Tanimoto coefficient gives:\n$$T_c(A, B) = \\frac{|A \\cap B|}{|A| + |B| - |A \\cap B|}$$\nNow, we introduce the terms specified in the problem statement. Let $c$ be the number of shared bits, which corresponds to the cardinality of the intersection:\n$$c = |A \\cap B|$$\nLet $a$ be the number of bits unique to molecule $A$, and $b$ be the number of bits unique to molecule $B$. These are the cardinalities of the set differences:\n$$a = |A \\setminus B| = |A| - |A \\cap B|$$\n$$b = |B \\setminus A| = |B| - |A \\cap B|$$\nFrom these definitions, we can express $|A|$ and $|B|$ as:\n$$|A| = a + c$$\n$$|B| = b + c$$\nSubstituting these expressions for $|A|$ and $|B|$ and the definition of $c$ into the expanded formula for $T_c(A, B)$:\n$$T_c(A, B) = \\frac{c}{(a+c) + (b+c) - c} = \\frac{c}{a + b + c}$$\nThis is the desired expression, relating the similarity to the number of shared bits ($c$) and the numbers of bits unique to each molecule ($a$ and $b$).\n\nSecond, we compute the similarity for the given fingerprints $A$ and $B$.\nThe query fingerprint is given by the set:\n$$A=\\{1,3,5,7,8,12,15,16,18,21,26,27,32,33,34,38,44,48,53,57,60\\}$$\nThe candidate fingerprint is given by the set:\n$$B=\\{3,5,7,9,12,15,16,18,20,21,24,26,27,30,33,34,35,38,41,44,47,48,57,60,61\\}$$\nWe first determine the cardinalities of these sets. By counting the elements, we find:\n$$|A| = 21$$\n$$|B| = 25$$\nNext, we determine their intersection, $A \\cap B$, which contains elements present in both sets:\n$$A \\cap B = \\{3, 5, 7, 12, 15, 16, 18, 21, 26, 27, 33, 34, 38, 44, 48, 57, 60\\}$$\nThe cardinality of the intersection is:\n$$c = |A \\cap B| = 17$$\nWe can now calculate the Tanimoto coefficient using the standard formula. The cardinality of the union is:\n$$|A \\cup B| = |A| + |B| - |A \\cap B| = 21 + 25 - 17 = 46 - 17 = 29$$\nThe Tanimoto coefficient is therefore:\n$$T_c(A, B) = \\frac{|A \\cap B|}{|A \\cup B|} = \\frac{17}{29}$$\nTo provide the numerical answer, we perform the division and round to four significant figures:\n$$T_c(A, B) = \\frac{17}{29} \\approx 0.58620689... \\approx 0.5862$$\n\nThird, we explain how this dependence informs neighborhood ranking. The derived expression $T_c = \\frac{c}{a+b+c}$ is illuminative. In virtual screening, candidate molecules are ranked by their similarity to a query. A higher $T_c$ indicates a higher rank.\nThe formula shows that the similarity score has two dependencies:\n1.  It is directly proportional to the number of shared features, $c$.\n2.  It is inversely related to the number of unshared features, $a$ and $b$.\n\nConsider the change in $T_c$ with respect to each variable. The partial derivatives are:\n$$\\frac{\\partial T_c}{\\partial c} = \\frac{(a+b)}{(a+b+c)^2} > 0 \\quad (\\text{for } a+b > 0)$$\n$$\\frac{\\partial T_c}{\\partial a} = \\frac{-c}{(a+b+c)^2} < 0 \\quad (\\text{for } c > 0)$$\n$$\\frac{\\partial T_c}{\\partial b} = \\frac{-c}{(a+b+c)^2} < 0 \\quad (\\text{for } c > 0)$$\nThis analysis formally confirms that increasing the count of shared bits ($c$) always increases similarity, while increasing the count of unique bits in either molecule ($a$ or $b$) always decreases it. This structure penalizes dissimilarity. For neighborhood ranking, this means that the ideal neighbors are not just those that share many features with the query, but also those that do not introduce many new, unshared features. The Tanimoto coefficient implicitly favors candidates that have a similar size or complexity (in terms of the number of set bits in their fingerprint) to the query. A very large molecule may share a moderate number of features with the query, but its large number of unique features will result in a large value for $b$, significantly lowering its $T_c$ score and thus its rank. Conversely, a smaller molecule with a high overlap percentage can achieve a very high $T_c$ score. In essence, neighborhood ranking using the Tanimoto coefficient prioritizes candidates that are structurally analogous in a proportional sense, not just in an absolute count of shared substructures.",
            "answer": "$$\\boxed{0.5862}$$"
        },
        {
            "introduction": "After performing a virtual screening, how do we measure its success? The Enrichment Factor ($EF$) provides a robust answer by quantifying how effectively a method concentrates known active compounds in the top-ranked portion of a library compared to random selection. In this exercise, you will derive the formula for $EF$ from first principles and apply it to a typical screening scenario , mastering a critical tool for validating and comparing screening protocols.",
            "id": "3869870",
            "problem": "A Virtual Screening (VS) campaign ranks a chemical library by a scoring function to prioritize compounds for experimental testing. Consider a library of size $N$ containing $A$ known actives and $N-A$ inactives. The top fraction $\\alpha$ of the ranked list contains $N_{\\alpha}=\\lfloor \\alpha N \\rfloor$ compounds, among which $a_{\\alpha}$ are actives. Starting from core definitions of prevalence and hit rate, and the random-selection expectation for drawing from a mixed population, derive the formula for the Enrichment Factor (EF) at fraction $\\alpha$, denoted $\\mathrm{EF}_{\\alpha}$, that quantifies how much better the early ranked subset performs relative to random selection.\n\nThen, for a kinase-target VS on a library with $N=12000$ compounds and $A=240$ actives, the top $N_{0.01}=\\lfloor 0.01 \\times 12000 \\rfloor$ ranks contain $a_{0.01}=30$ actives. Compute $\\mathrm{EF}_{0.01}$ and express the final value as a decimal rounded to four significant figures. Provide a brief interpretation in terms of early recognition performance in your derivation, but the final answer must be only the value of $\\mathrm{EF}_{0.01}$.",
            "solution": "The primary goal is to derive the formula for the Enrichment Factor ($\\mathrm{EF}_{\\alpha}$) and then use it to compute a specific value.\n\nThe Enrichment Factor quantifies the performance of a ranking method by comparing the hit rate in a top fraction of the ranked list to the hit rate expected from random selection. Let's define the necessary components.\n\nLet $N$ be the total number of compounds in the library.\nLet $A$ be the total number of active compounds within this library.\nLet $\\alpha$ be the fraction of the top-ranked compounds being considered, where $0 < \\alpha \\le 1$.\nThe number of compounds in this top fraction is given as $N_{\\alpha} = \\lfloor \\alpha N \\rfloor$.\nThe number of actives found within this top-ranked subset is $a_{\\alpha}$.\n\n$1$. **Hit Rate in the Top Fraction**: The hit rate, which we can denote as $H_{\\alpha}$, is the proportion of compounds in the top-ranked subset that are active. It is calculated as the number of actives found, $a_{\\alpha}$, divided by the total number of compounds in that subset, $N_{\\alpha}$.\n$$H_{\\alpha} = \\frac{a_{\\alpha}}{N_{\\alpha}}$$\n\n$2$. **Random Hit Rate**: The random hit rate, $H_{\\text{random}}$, represents the expected hit rate if one were to select a subset of compounds randomly from the library. In a sufficiently large random sample, the proportion of actives is expected to be the same as the overall prevalence of actives in the entire library. This prevalence is the total number of actives, $A$, divided by the total library size, $N$.\n$$H_{\\text{random}} = \\frac{A}{N}$$\n\n$3$. **Enrichment Factor (EF)**: As stated in the problem, $\\mathrm{EF}_{\\alpha}$ quantifies how much better the early ranked subset performs relative to random selection. It is therefore defined as the ratio of the observed hit rate in the top fraction ($H_{\\alpha}$) to the random hit rate ($H_{\\text{random}}$).\n$$\\mathrm{EF}_{\\alpha} = \\frac{H_{\\alpha}}{H_{\\text{random}}}$$\nSubstituting the expressions for $H_{\\alpha}$ and $H_{\\text{random}}$ gives the formula for the Enrichment Factor:\n$$\\mathrm{EF}_{\\alpha} = \\frac{a_{\\alpha} / N_{\\alpha}}{A / N}$$\nBy substituting $N_{\\alpha} = \\lfloor \\alpha N \\rfloor$, we obtain the fully explicit formula:\n$$\\mathrm{EF}_{\\alpha} = \\frac{a_{\\alpha} \\cdot N}{A \\cdot \\lfloor \\alpha N \\rfloor}$$\nAn $\\mathrm{EF}_{\\alpha}$ value of $1$ indicates that the ranking method performs no better than random guessing. A value greater than $1$ demonstrates that the method successfully concentrates, or 'enriches', active compounds into the top-ranked portion of the library, signifying effective early recognition performance. Higher values correspond to more effective screening protocols.\n\nNow, we compute the specific value $\\mathrm{EF}_{0.01}$ for the given kinase-target virtual screening campaign.\n\nThe provided data are:\nTotal library size, $N = 12000$.\nTotal number of actives, $A = 240$.\nThe fraction of the library under consideration is $\\alpha = 0.01$.\nThe number of actives found in this top fraction is $a_{0.01} = 30$.\n\nFirst, we determine the number of compounds in the top $1\\%$ of the ranked list, $N_{0.01}$:\n$$N_{0.01} = \\lfloor \\alpha N \\rfloor = \\lfloor 0.01 \\times 12000 \\rfloor = \\lfloor 120 \\rfloor = 120$$\nNext, we use the derived formula for $\\mathrm{EF}_{0.01}$:\n$$\\mathrm{EF}_{0.01} = \\frac{a_{0.01} / N_{0.01}}{A / N}$$\nWe substitute the numerical values into this expression:\n$$\\mathrm{EF}_{0.01} = \\frac{30 / 120}{240 / 12000}$$\nLet's calculate the numerator and the denominator separately.\nThe hit rate in the top $1\\%$ is $H_{0.01} = \\frac{30}{120} = \\frac{1}{4} = 0.25$.\nThe random hit rate (overall prevalence) is $H_{\\text{random}} = \\frac{240}{12000} = \\frac{24}{1200} = \\frac{1}{50} = 0.02$.\nThe enrichment factor is the ratio of these rates:\n$$\\mathrm{EF}_{0.01} = \\frac{0.25}{0.02} = \\frac{25}{2} = 12.5$$\nThe problem requires the final value to be expressed as a decimal rounded to four significant figures. The exact value $12.5$ has three significant figures. To express it with four significant figures, we append a trailing zero.\n$$\\mathrm{EF}_{0.01} = 12.50$$",
            "answer": "$$\\boxed{12.50}$$"
        },
        {
            "introduction": "Structure-based docking involves many nuanced decisions, and one of the most critical is how to handle crystallographic water molecules, which can mediate key interactions. This advanced practice challenges you to move beyond simple scoring and develop a physics-informed program to quantify the thermodynamic impact of including water-mediated hydrogen bond networks . By implementing a model based on statistical mechanics, you will gain hands-on experience in one of the more sophisticated aspects of modern drug design.",
            "id": "3869902",
            "problem": "You are tasked with constructing a principled, physics-informed program to quantify how including versus excluding key crystallographic water molecules in a docking model impacts the computed docking score for a ligand binding to a protein. You must model water-mediated hydrogen bond networks and evaluate their contributions using a thermodynamically consistent approach grounded in statistical mechanics and physically motivated hydrogen bond geometry scoring. The result should be a single-line output aggregating the computed differences for a set of distinct test scenarios.\n\nFundamental base to use:\n- Thermodynamics and Statistical Mechanics: The Helmholtz free energy of a system with discrete states is based on the partition function, with a general relation $$\\Delta G = -k_B T \\ln Z,$$ where $k_B$ is Boltzmann’s constant. When energies are expressed per mole, the molar gas constant $R$ replaces Boltzmann’s constant, yielding $$\\Delta G = -R T \\ln Z.$$ This is a well-tested relation in statistical thermodynamics.\n- Hydrogen bond geometry dependence: The strength of a hydrogen bond depends on donor–acceptor separation and angle. A physically motivated, geometry-dependent interaction energy can be modeled by combining a distance attenuation and an angular directionality factor. The model must be explicit and consistent with typical hydrogen bond physics, but you may not assert any ad hoc shortcuts without justification.\n\nDefinitions and modeling requirements:\n- Define each hydrogen bond leg (whether direct ligand–protein or water-mediated link) with distance $r$ (in Angstroms, specified as $\\text{\\AA}$) and angle $\\theta$ (in degrees). The hydrogen bond energy for a leg must be computed as\n$$E_{\\mathrm{leg}}(r,\\theta) = -\\varepsilon \\cdot \\exp\\!\\big(-\\alpha \\cdot |r - r_0|\\big) \\cdot \\cos^2\\!\\Big(\\frac{\\pi}{180} \\cdot (\\theta - 180)\\Big),$$\nwhere $\\varepsilon$ is a characteristic hydrogen bond strength (in $\\mathrm{kJ \\cdot mol^{-1}}$), $\\alpha$ is a distance sensitivity (in $\\text{\\AA}^{-1}$), and $r_0$ is the ideal heavy-atom separation (in $\\text{\\AA}$). This form captures that optimal hydrogen bonds have $r$ near $r_0$ and $\\theta$ near $180^\\circ$ (linear geometry). You must use the provided numerical parameter values below.\n- A water-mediated hydrogen bond network is represented as a sequence of legs forming a path from ligand to protein through $m$ waters: ligand $\\rightarrow$ water $1$ $\\rightarrow$ water $2$ $\\rightarrow \\cdots \\rightarrow$ water $m$ $\\rightarrow$ protein, yielding $m+1$ legs. The presence of the entire network is governed by the product of individual water occupancy probabilities. Constraining each water in the network incurs a free energy penalty per water that must be added to the present-state energy.\n- For a given network $j$ with $m_j$ waters, legs $\\{(r_\\ell,\\theta_\\ell)\\}_{\\ell=1}^{m_j+1}$, per-water penalties $\\{\\Delta G_{\\mathrm{pen},i}\\}_{i=1}^{m_j}$ (in $\\mathrm{kJ \\cdot mol^{-1}}$), and water presence probabilities $\\{p_i\\}_{i=1}^{m_j}$, define the network presence probability as $$p_{\\mathrm{net},j} = \\prod_{i=1}^{m_j} p_i.$$ Define the present-state energy as $$E_{\\mathrm{present},j} = \\sum_{\\ell=1}^{m_j+1} E_{\\mathrm{leg}}(r_\\ell,\\theta_\\ell) + \\sum_{i=1}^{m_j} \\Delta G_{\\mathrm{pen},i}.$$ The absent state has energy $0$. The effective free energy contribution of network $j$ is then\n$$\\Delta G_{\\mathrm{net},j} = -R T \\cdot \\ln\\!\\Big(p_{\\mathrm{net},j} \\cdot e^{-E_{\\mathrm{present},j}/(R T)} + (1 - p_{\\mathrm{net},j}) \\cdot e^{-0/(R T)}\\Big) = -R T \\cdot \\ln\\!\\Big(p_{\\mathrm{net},j} \\cdot e^{-E_{\\mathrm{present},j}/(R T)} + 1 - p_{\\mathrm{net},j}\\Big).$$\n- Direct ligand–protein hydrogen bonds that are always geometrically accessible, independent of water inclusion, contribute deterministically as $$E_{\\mathrm{direct,base}} = \\sum_{d \\in D_0} E_{\\mathrm{leg}}(r_d,\\theta_d).$$ Some direct ligand–protein bonds may only be accessible when waters are excluded due to steric or competitive interactions. Define such contributions as $$E_{\\mathrm{direct,excl}} = \\sum_{d \\in D_{\\mathrm{excl}}} E_{\\mathrm{leg}}(r_d,\\theta_d),$$ which are added only in the water-excluded scenario.\n- The docking score for the water-included model is $$S_{\\mathrm{incl}} = E_{\\mathrm{direct,base}} + \\sum_{j} \\Delta G_{\\mathrm{net},j},$$ and the docking score for the water-excluded model is $$S_{\\mathrm{excl}} = E_{\\mathrm{direct,base}} + E_{\\mathrm{direct,excl}}.$$ The impact of including waters is the difference $$\\Delta S = S_{\\mathrm{incl}} - S_{\\mathrm{excl}},$$ reported in $\\mathrm{kJ \\cdot mol^{-1}}$.\n\nConstants to use:\n- Use the molar gas constant $$R = 0.008314462618 \\ \\mathrm{kJ \\cdot mol^{-1} \\cdot K^{-1}}.$$\n- Use characteristic hydrogen bond parameters $$\\varepsilon = 8.0 \\ \\mathrm{kJ \\cdot mol^{-1}}, \\quad \\alpha = 2.0 \\ \\text{\\AA}^{-1}, \\quad r_0 = 2.8 \\ \\text{\\AA}.$$\n\nAngle unit:\n- All input angles $\\theta$ are in degrees. Internally, convert degrees to radians using multiplication by $$\\frac{\\pi}{180}$$ where needed.\n\nTemperature unit:\n- Use temperatures $T$ in Kelvin.\n\nEnergy unit:\n- All energies and the final reported score differences must be in $\\mathrm{kJ \\cdot mol^{-1}}$.\n\nProgram requirements:\n- Implement the above physically based definitions exactly.\n- Compute $S_{\\mathrm{incl}}$, $S_{\\mathrm{excl}}$, and $\\Delta S$ for each test case.\n- Produce a single line of output containing the differences $\\Delta S$ for all test cases, as a comma-separated list enclosed in square brackets (e.g., $$[\\delta_1,\\delta_2,\\delta_3,\\delta_4]$$). Each $\\delta_i$ must be a floating-point number in $\\mathrm{kJ \\cdot mol^{-1}}$.\n\nTest suite:\nYou must evaluate the following four test cases, which probe different regimes. Use the exact values provided.\n\n- Test case $1$ (single strong bridging water; happy path):\n    - Temperature: $T = 300.0 \\ \\mathrm{K}$.\n    - Base direct hydrogen bonds $D_0$: none (empty set).\n    - Water networks: one network with $m_1 = 1$ water.\n        - Legs: $(r,\\theta)$ pairs are $\\big(2.80, 170.0\\big)$ and $\\big(2.80, 170.0\\big)$.\n        - Per-water penalties: $\\{\\Delta G_{\\mathrm{pen},1}\\} = \\{2.0\\}$.\n        - Water occupancies: $\\{p_1\\} = \\{0.85\\}$.\n    - Exclusion-only direct bonds $D_{\\mathrm{excl}}$: none.\n\n- Test case $2$ (single weak bridging water; boundary angles):\n    - Temperature: $T = 300.0 \\ \\mathrm{K}$.\n    - Base direct hydrogen bonds $D_0$: none.\n    - Water networks: one network with $m_2 = 1$ water.\n        - Legs: $(r,\\theta)$ pairs are $\\big(2.90, 120.0\\big)$ and $\\big(2.90, 125.0\\big)$.\n        - Per-water penalties: $\\{\\Delta G_{\\mathrm{pen},1}\\} = \\{2.5\\}$.\n        - Water occupancies: $\\{p_1\\} = \\{0.90\\}$.\n    - Exclusion-only direct bonds $D_{\\mathrm{excl}}$: none.\n\n- Test case $3$ (two-water chain; probabilistic presence):\n    - Temperature: $T = 300.0 \\ \\mathrm{K}$.\n    - Base direct hydrogen bonds $D_0$: none.\n    - Water networks: one network with $m_3 = 2$ waters.\n        - Legs: $(r,\\theta)$ pairs are $\\big(2.75, 165.0\\big)$, $\\big(2.85, 160.0\\big)$, and $\\big(2.80, 170.0\\big)$.\n        - Per-water penalties: $\\{\\Delta G_{\\mathrm{pen},1}, \\Delta G_{\\mathrm{pen},2}\\} = \\{1.5, 1.8\\}$.\n        - Water occupancies: $\\{p_1, p_2\\} = \\{0.70, 0.60\\}$.\n    - Exclusion-only direct bonds $D_{\\mathrm{excl}}$: none.\n\n- Test case $4$ (competing direct bond emerges when waters are excluded):\n    - Temperature: $T = 300.0 \\ \\mathrm{K}$.\n    - Base direct hydrogen bonds $D_0$: one weak bond with $(r,\\theta) = \\big(3.40, 130.0\\big)$.\n    - Water networks: one network with $m_4 = 1$ water.\n        - Legs: $(r,\\theta)$ pairs are $\\big(3.10, 150.0\\big)$ and $\\big(3.00, 140.0\\big)$.\n        - Per-water penalties: $\\{\\Delta G_{\\mathrm{pen},1}\\} = \\{2.0\\}$.\n        - Water occupancies: $\\{p_1\\} = \\{0.50\\}$.\n    - Exclusion-only direct bonds $D_{\\mathrm{excl}}$: one strong bond with $(r,\\theta) = \\big(2.70, 175.0\\big)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact order of the test cases $1$ through $4$, for example $$[\\Delta S_1,\\Delta S_2,\\Delta S_3,\\Delta S_4].$$ The values must be in $\\mathrm{kJ \\cdot mol^{-1}}$ and computed using the definitions and constants above.",
            "solution": "The problem requires implementing a physics-based model to calculate the impact of including water molecules in a docking score, represented by $\\Delta S = S_{\\mathrm{incl}} - S_{\\mathrm{excl}}$. The solution involves calculating the scores for water-included ($S_{\\mathrm{incl}}$) and water-excluded ($S_{\\mathrm{excl}}$) scenarios across four test cases. The core calculation is the free energy contribution of water networks, $\\Delta G_{\\mathrm{net},j}$.\n\nFirst, we define the energy of a single hydrogen bond leg, $E_{\\mathrm{leg}}(r, \\theta)$, using the provided formula and constants ($R$, $\\varepsilon$, $\\alpha$, $r_0$).\n$$E_{\\mathrm{leg}}(r,\\theta) = -\\varepsilon \\cdot \\exp\\!\\big(-\\alpha \\cdot |r - r_0|\\big) \\cdot \\cos^2\\!\\Big(\\frac{\\pi}{180} \\cdot (\\theta - 180)\\Big)$$\nThe total impact $\\Delta S$ is given by the difference between the sum of water network free energies and the energy of direct bonds that only form when water is excluded:\n$$\\Delta S = \\sum_{j} \\Delta G_{\\mathrm{net},j} - E_{\\mathrm{direct,excl}}$$\n\nLet's walk through the calculation for Test Case 1 as an example.\n**Test Case 1: Strong Bridging Water**\n-   $T = 300.0 \\ \\mathrm{K}$\n-   $RT = (0.00831446...\\ \\mathrm{kJ \\cdot mol^{-1} \\cdot K^{-1}}) \\times 300.0 \\ \\mathrm{K} \\approx 2.4943 \\ \\mathrm{kJ \\cdot mol^{-1}}$\n-   $D_{\\mathrm{excl}}$ is empty, so $E_{\\mathrm{direct,excl}} = 0$.\n-   There is one water network ($j=1$) with one water ($m_1=1$).\n    - Legs: $(2.80, 170.0)$ and $(2.80, 170.0)$. The energy for one such leg is:\n      $E_{\\mathrm{leg}}(2.8, 170) = -8.0 \\cdot \\exp(-2.0 \\cdot |2.8 - 2.8|) \\cdot \\cos^2(\\frac{\\pi}{180} \\cdot (170 - 180)) = -8.0 \\cdot 1 \\cdot \\cos^2(-10^\\circ) \\approx -7.759 \\ \\mathrm{kJ \\cdot mol^{-1}}$.\n    - Sum of leg energies: $2 \\times (-7.759) = -15.518 \\ \\mathrm{kJ \\cdot mol^{-1}}$.\n    - Water penalty $\\Delta G_{\\mathrm{pen},1} = 2.0 \\ \\mathrm{kJ \\cdot mol^{-1}}$.\n    - Present-state energy: $E_{\\mathrm{present},1} = -15.518 + 2.0 = -13.518 \\ \\mathrm{kJ \\cdot mol^{-1}}$.\n    - Network probability: $p_{\\mathrm{net},1} = p_1 = 0.85$.\n    - The free energy contribution $\\Delta G_{\\mathrm{net},1}$ is:\n      $$\\Delta G_{\\mathrm{net},1} = -RT \\cdot \\ln(p_{\\mathrm{net},1} \\cdot e^{-E_{\\mathrm{present},1}/(RT)} + 1 - p_{\\mathrm{net},1})$$\n      $$\\Delta G_{\\mathrm{net},1} = -2.4943 \\cdot \\ln(0.85 \\cdot e^{-(-13.518)/2.4943} + 1 - 0.85)$$\n      $$\\Delta G_{\\mathrm{net},1} = -2.4943 \\cdot \\ln(0.85 \\cdot e^{5.4195} + 0.15) = -2.4943 \\cdot \\ln(191.78 + 0.15) \\approx -13.1133 \\ \\mathrm{kJ \\cdot mol^{-1}}$$\n-   Since there's only one network and $E_{\\mathrm{direct,excl}}=0$, the total impact is $\\Delta S_1 = \\Delta G_{\\mathrm{net},1} \\approx -13.1133 \\ \\mathrm{kJ \\cdot mol^{-1}}$.\n\nThis same procedure is applied to the other three test cases. The calculation can be automated with a script.\n\n**Example Implementation**\n\nThe following Python script implements the defined physical model and calculates the score differences for all four test cases.\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the impact of including water molecules in a docking score\n    for a series of test cases.\n    \"\"\"\n    R = 0.008314462618\n    EPSILON = 8.0\n    ALPHA = 2.0\n    R0 = 2.8\n\n    test_cases = [\n        {\n            \"T\": 300.0,\n            \"d_zero_bonds\": [],\n            \"networks\": [\n                {\n                    \"legs\": [(2.80, 170.0), (2.80, 170.0)],\n                    \"penalties\": [2.0],\n                    \"probabilities\": [0.85]\n                }\n            ],\n            \"d_excl_bonds\": []\n        },\n        {\n            \"T\": 300.0,\n            \"d_zero_bonds\": [],\n            \"networks\": [\n                {\n                    \"legs\": [(2.90, 120.0), (2.90, 125.0)],\n                    \"penalties\": [2.5],\n                    \"probabilities\": [0.90]\n                }\n            ],\n            \"d_excl_bonds\": []\n        },\n        {\n            \"T\": 300.0,\n            \"d_zero_bonds\": [],\n            \"networks\": [\n                {\n                    \"legs\": [(2.75, 165.0), (2.85, 160.0), (2.80, 170.0)],\n                    \"penalties\": [1.5, 1.8],\n                    \"probabilities\": [0.70, 0.60]\n                }\n            ],\n            \"d_excl_bonds\": []\n        },\n        {\n            \"T\": 300.0,\n            \"d_zero_bonds\": [(3.40, 130.0)],\n            \"networks\": [\n                {\n                    \"legs\": [(3.10, 150.0), (3.00, 140.0)],\n                    \"penalties\": [2.0],\n                    \"probabilities\": [0.50]\n                }\n            ],\n            \"d_excl_bonds\": [(2.70, 175.0)]\n        }\n    ]\n\n    results = []\n\n    def e_leg(r, theta):\n        angle_rad = np.pi / 180.0 * (theta - 180.0)\n        return -EPSILON * np.exp(-ALPHA * np.abs(r - R0)) * np.cos(angle_rad)**2\n\n    for case in test_cases:\n        T = case[\"T\"]\n        RT = R * T\n\n        e_direct_base = sum(e_leg(r, theta) for r, theta in case[\"d_zero_bonds\"])\n        e_direct_excl = sum(e_leg(r, theta) for r, theta in case[\"d_excl_bonds\"])\n        \n        sum_delta_g_net = 0.0\n        if case.get(\"networks\"):\n            for network in case[\"networks\"]:\n                sum_e_legs = sum(e_leg(r, theta) for r, theta in network[\"legs\"])\n                sum_g_pen = sum(network[\"penalties\"])\n                e_present_j = sum_e_legs + sum_g_pen\n                p_net_j = np.prod(network[\"probabilities\"])\n                boltzmann_term = np.exp(-e_present_j / RT)\n                partition_term = p_net_j * boltzmann_term + (1 - p_net_j)\n                delta_g_net_j = -RT * np.log(partition_term)\n                sum_delta_g_net += delta_g_net_j\n\n        s_incl = e_direct_base + sum_delta_g_net\n        s_excl = e_direct_base + e_direct_excl\n\n        delta_s = s_incl - s_excl\n        results.append(delta_s)\n\n    # The final list of differences is then computed.\n    # print(f\"[{','.join(f'{x:.4f}' for x in results)}]\")\n    # Output: [-13.1133,-1.1868,-15.4262,3.4095]\n\n```\nExecuting this script yields the final numerical results for all four test cases. A negative $\\Delta S$ indicates that the water-included model is more favorable (lower score) than the excluded model, while a positive $\\Delta S$ indicates the opposite. The results show that including well-oriented water networks (cases 1-3) provides a significant scoring benefit, whereas in case 4, the formation of a strong direct H-bond in the excluded model outweighs the contribution from the weak water network, making the water-excluded model more favorable.",
            "answer": "$$\\boxed{[-13.1133, -1.1868, -15.4262, 3.4095]}$$"
        }
    ]
}