{
    "hands_on_practices": [
        {
            "introduction": "The fundamental task in pharmacophore searching is to quantify how well a candidate molecule's features satisfy the geometric constraints of a given model. This exercise delves into a common and statistically robust method for scoring this alignment. By calculating a match score based on Gaussian-weighted deviations from ideal distances and angles, you will gain a hands-on understanding of how abstract models are translated into a concrete \"goodness-of-fit\" value, forming the basis for ranking compounds in a virtual screen .",
            "id": "3857956",
            "problem": "A pharmacophore is an abstract representation of the essential molecular features required for biological activity, typically encoded as geometric constraints on feature pairs (distances) and on feature triplets (angles). In computational chemical biology, a standard approach is to treat deviations from the pharmacophore’s ideal geometry as independent, normally distributed measurement or modeling errors. Concretely, suppose each constraint deviation is modeled as a random variable with a Gaussian distribution having zero mean and known standard deviation, and the deviations are assumed independent across constraints.\n\nConsider a pharmacophore with three pairwise distance constraints and one angular constraint among features: a hydrogen bond donor ($D$), a hydrogen bond acceptor ($A$), and an aromatic centroid ($\\mathrm{Ar}$). The design constraints (ideal geometry) are:\n- Ideal donor–acceptor distance: $d_{DA}^{\\ast} = 2.80\\,\\mathrm{\\AA}$ with standard deviation $\\sigma_{DA} = 0.20\\,\\mathrm{\\AA}$.\n- Ideal donor–aromatic centroid distance: $d_{D\\mathrm{Ar}}^{\\ast} = 5.00\\,\\mathrm{\\AA}$ with standard deviation $\\sigma_{D\\mathrm{Ar}} = 0.30\\,\\mathrm{\\AA}$.\n- Ideal acceptor–aromatic centroid distance: $d_{A\\mathrm{Ar}}^{\\ast} = 6.20\\,\\mathrm{\\AA}$ with standard deviation $\\sigma_{A\\mathrm{Ar}} = 0.25\\,\\mathrm{\\AA}$.\n- Ideal angle at the acceptor (formed by the ordered triplet $D$–$A$–$\\mathrm{Ar}$): $\\theta^{\\ast} = 120\\,\\mathrm{degrees}$ with standard deviation $\\sigma_{\\theta} = 10\\,\\mathrm{degrees}$. Angles are specified in degrees.\n\nA candidate ligand maps its features to the pharmacophore as follows, yielding the measured geometry:\n- Measured donor–acceptor distance: $d_{DA} = 2.95\\,\\mathrm{\\AA}$.\n- Measured donor–aromatic centroid distance: $d_{D\\mathrm{Ar}} = 5.18\\,\\mathrm{\\AA}$.\n- Measured acceptor–aromatic centroid distance: $d_{A\\mathrm{Ar}} = 6.05\\,\\mathrm{\\AA}$.\n- Measured angle at the acceptor: $\\theta = 113\\,\\mathrm{degrees}$.\n\nUnder the independence assumption and Gaussian modeling of deviations, define the match score $S$ as the negative logarithm of the joint likelihood, up to an additive constant independent of the candidate geometry. That is, $S$ is the sum over constraints of the squared deviation normalized by its standard deviation. Explicitly, if $\\Delta_{i}$ denotes the deviation for constraint $i$ and $\\sigma_{i}$ its standard deviation, then $S = \\sum_{i} \\left(\\Delta_{i}/\\sigma_{i}\\right)^{2}$.\n\nCompute the match score $S$ for the candidate ligand described above. Express the final score as a dimensionless real number and round your answer to $4$ significant figures. Additionally, in your solution, justify the scoring function from first principles and discuss the sensitivity of $S$ to the standard deviations $\\sigma_{i}$ and the deviations $\\Delta_{i}$ in terms of partial derivatives, but do not include those discussions in the final numerical answer.",
            "solution": "The problem asks for the calculation of a pharmacophore match score, $S$, for a candidate ligand. This score is defined as the sum of squared deviations from ideal geometric constraints, normalized by their respective standard deviations. We are also asked to justify this scoring function.\n\nFirst, let us justify the form of the scoring function $S$. The problem states that the deviation for each constraint, $\\Delta_{i}$, is modeled as an independent random variable following a Gaussian (normal) distribution with a mean of zero and a known standard deviation, $\\sigma_{i}$. The probability density function (PDF) for a single deviation $\\Delta_{i}$ is:\n$$P(\\Delta_i | \\sigma_i) = \\frac{1}{\\sigma_i \\sqrt{2\\pi}} \\exp\\left(-\\frac{\\Delta_i^2}{2\\sigma_i^2}\\right)$$\nSince the deviations are independent, the joint probability of observing a specific set of deviations $\\{\\Delta_1, \\Delta_2, \\ldots, \\Delta_N\\}$ is the product of their individual probabilities. This is the likelihood function, $L$:\n$$L = \\prod_{i=1}^{N} P(\\Delta_i | \\sigma_i) = \\prod_{i=1}^{N} \\frac{1}{\\sigma_i \\sqrt{2\\pi}} \\exp\\left(-\\frac{\\Delta_i^2}{2\\sigma_i^2}\\right)$$\nIn statistical analysis, it is often more convenient to work with the negative log-likelihood, $-\\ln(L)$, which is minimized to find the most probable parameters (or in this case, the best fit).\n$$-\\ln(L) = -\\sum_{i=1}^{N} \\left( -\\ln(\\sigma_i \\sqrt{2\\pi}) - \\frac{\\Delta_i^2}{2\\sigma_i^2} \\right) = \\frac{1}{2} \\sum_{i=1}^{N} \\frac{\\Delta_i^2}{\\sigma_i^2} + \\sum_{i=1}^{N} \\ln(\\sigma_i \\sqrt{2\\pi})$$\nThe score $S$ is defined as $S = \\sum_{i} (\\Delta_{i}/\\sigma_{i})^{2}$. This is precisely twice the variable part of the negative log-likelihood. Minimizing $S$ is equivalent to maximizing the likelihood of the fit, justifying its use as a \"badness-of-fit\" score. Each term $(\\Delta_{i}/\\sigma_{i})$ is a z-score, and $S$ is the sum of their squares.\n\nNow, we compute the score $S$. First, we calculate the deviation $\\Delta_i$ for each constraint, where $\\Delta_i = (\\text{measured value})_i - (\\text{ideal value})_i$.\n\n1.  Donor–Acceptor distance ($DA$):\n    - $\\Delta_{DA} = 2.95 - 2.80 = 0.15\\,\\mathrm{\\AA}$\n    - $\\sigma_{DA} = 0.20\\,\\mathrm{\\AA}$\n\n2.  Donor–Aromatic centroid distance ($D\\mathrm{Ar}$):\n    - $\\Delta_{D\\mathrm{Ar}} = 5.18 - 5.00 = 0.18\\,\\mathrm{\\AA}$\n    - $\\sigma_{D\\mathrm{Ar}} = 0.30\\,\\mathrm{\\AA}$\n\n3.  Acceptor–Aromatic centroid distance ($A\\mathrm{Ar}$):\n    - $\\Delta_{A\\mathrm{Ar}} = 6.05 - 6.20 = -0.15\\,\\mathrm{\\AA}$\n    - $\\sigma_{A\\mathrm{Ar}} = 0.25\\,\\mathrm{\\AA}$\n\n4.  Angle ($D$–$A$–$\\mathrm{Ar}$):\n    - $\\Delta_{\\theta} = 113 - 120 = -7\\,\\mathrm{degrees}$\n    - $\\sigma_{\\theta} = 10\\,\\mathrm{degrees}$\n\nThe total score $S$ is the sum of the squared normalized deviations:\n$$S = \\left(\\frac{\\Delta_{DA}}{\\sigma_{DA}}\\right)^{2} + \\left(\\frac{\\Delta_{D\\mathrm{Ar}}}{\\sigma_{D\\mathrm{Ar}}}\\right)^{2} + \\left(\\frac{\\Delta_{A\\mathrm{Ar}}}{\\sigma_{A\\mathrm{Ar}}}\\right)^{2} + \\left(\\frac{\\Delta_{\\theta}}{\\sigma_{\\theta}}\\right)^{2}$$\n$$S = \\left(\\frac{0.15}{0.20}\\right)^{2} + \\left(\\frac{0.18}{0.30}\\right)^{2} + \\left(\\frac{-0.15}{0.25}\\right)^{2} + \\left(\\frac{-7}{10}\\right)^{2}$$\n$$S = (0.75)^{2} + (0.6)^{2} + (-0.6)^{2} + (-0.7)^{2}$$\n$$S = 0.5625 + 0.36 + 0.36 + 0.49 = 1.7725$$\nRounding to $4$ significant figures gives $1.773$.\n\nFinally, we discuss the sensitivity of the score $S$ to the deviations $\\Delta_i$ and standard deviations $\\sigma_i$. The sensitivity of $S$ with respect to a specific deviation $\\Delta_j$ is given by the partial derivative:\n$$\\frac{\\partial S}{\\partial \\Delta_j} = \\frac{2\\Delta_j}{\\sigma_j^2}$$\nThis shows that the score's sensitivity to a deviation is proportional to the deviation itself and inversely proportional to the variance $\\sigma_j^2$. The sensitivity of $S$ with respect to a standard deviation $\\sigma_j$ is:\n$$\\frac{\\partial S}{\\partial \\sigma_j} = -\\frac{2\\Delta_j^2}{\\sigma_j^3}$$\nThis derivative is non-positive, confirming that increasing the standard deviation (making a constraint \"looser\") decreases the penalty score. The score is extremely sensitive to changes in $\\sigma_j$ when $\\sigma_j$ is small, highlighting the importance of accurately parameterizing the pharmacophore model.",
            "answer": "$$\\boxed{1.773}$$"
        },
        {
            "introduction": "While calculating a detailed match score is essential, performing this expensive 3D alignment for every molecule in a vast library is computationally infeasible. This practice introduces the elegant and efficient concept of using geometric invariants as a rapid pre-filter. By deriving a rotationally and permutationally invariant signature for a pharmacophore triangle, you will see how to quickly discard vast numbers of non-congruent candidates, a critical step for enabling large-scale virtual screening campaigns .",
            "id": "3858049",
            "problem": "In pharmacophore modeling, a pharmacophore triangle is formed by three distinct feature points in three-dimensional space, regarded as points $p_{1}, p_{2}, p_{3} \\in \\mathbb{R}^{3}$. The Euclidean distance between features $i$ and $j$ is $d_{ij} = \\|p_{i} - p_{j}\\|$, where $\\|\\cdot\\|$ denotes the Euclidean norm. Rigid motions of space (rotations and translations) act on points as $x \\mapsto R x + t$, with $R \\in \\mathrm{SO}(3)$ (the Special Orthogonal group in three dimensions) and $t \\in \\mathbb{R}^{3}$. Pharmacophore searching frequently seeks rotationally invariant prefilters to avoid unnecessary full alignments.\n\nStarting from the invariance of the Euclidean norm under orthogonal transformations and translation invariance of differences, derive a rotationally invariant characterization of a pharmacophore triangle using its side lengths $d_{12}$, $d_{23}$, $d_{13}$, and explain how to ensure invariance under permutation of feature labels by mapping the multiset $\\{d_{12}, d_{23}, d_{13}\\}$ to a canonical representative. To make the subsequent calculation definite, use the canonical representative defined by ordering the three side lengths in nondecreasing magnitude.\n\nPropose a dimensionless prefilter metric that compares two pharmacophore triangles solely through these canonical side-length vectors, suitable for rejecting noncongruent candidates prior to full three-dimensional alignment. For the subsequent calculation, take this metric to be the supremum of the component-wise relative deviation of the candidate’s canonical side-length vector from the model’s canonical side-length vector.\n\nGiven a model triangle with distances $d^{\\text{model}}_{12} = 3.45\\,\\text{\\AA}$, $d^{\\text{model}}_{23} = 5.78\\,\\text{\\AA}$, and $d^{\\text{model}}_{13} = 7.12\\,\\text{\\AA}$, and a candidate triangle with measured distances $d^{\\text{cand}}_{12} = 5.80\\,\\text{\\AA}$, $d^{\\text{cand}}_{23} = 7.10\\,\\text{\\AA}$, and $d^{\\text{cand}}_{13} = 3.44\\,\\text{\\AA}$, compute the value of the chosen prefilter metric. Round your answer to four significant figures and express the result as a dimensionless number.",
            "solution": "The solution is developed in three parts: demonstrating the invariance of side lengths under rigid motion, defining a permutation-invariant canonical representation and a prefilter metric, and finally, performing the calculation.\n\n**1. Invariance under Rigid Motion**\nA rigid motion in $\\mathbb{R}^3$ transforms a point $p$ to $p' = R p + t$, where $R \\in \\mathrm{SO}(3)$ is a rotation matrix and $t \\in \\mathbb{R}^3$ is a translation vector. The distance $d'_{ij}$ between two transformed points $p'_i = R p_i + t$ and $p'_j = R p_j + t$ is:\n$$ d'_{ij} = \\|p'_i - p'_j\\| = \\|(R p_i + t) - (R p_j + t)\\| = \\|R(p_i - p_j)\\| $$\nSince rotation matrices are orthogonal, they preserve the Euclidean norm ($ \\|Rv\\| = \\|v\\| $). Therefore:\n$$ d'_{ij} = \\|p_i - p_j\\| = d_{ij} $$\nThis shows that the side lengths $\\{d_{12}, d_{23}, d_{13}\\}$ are invariant under rotations and translations, providing a characterization of the triangle's geometry independent of its position and orientation.\n\n**2. Canonical Representation and Prefilter Metric**\nTo ensure the representation is also invariant to the arbitrary labeling of vertices, we define a canonical form. As specified, this is achieved by ordering the side lengths non-decreasingly into a vector $D = (s_1, s_2, s_3)$, where $s_1 \\le s_2 \\le s_3$. This vector is a unique signature for the triangle's congruence class.\n\nThe specified prefilter metric $M$ compares the canonical vector of a candidate triangle, $D^{\\text{cand}} = (s^{\\text{cand}}_1, s^{\\text{cand}}_2, s^{\\text{cand}}_3)$, to that of the model, $D^{\\text{model}} = (s^{\\text{model}}_1, s^{\\text{model}}_2, s^{\\text{model}}_3)$, using the supremum of the component-wise relative deviations:\n$$ M = \\sup_{k \\in \\{1,2,3\\}} \\left\\{ \\frac{|s^{\\text{cand}}_k - s^{\\text{model}}_k|}{s^{\\text{model}}_k} \\right\\} = \\max\\left( \\frac{|s^{\\text{cand}}_1 - s^{\\text{model}}_1|}{s^{\\text{model}}_1}, \\frac{|s^{\\text{cand}}_2 - s^{\\text{model}}_2|}{s^{\\text{model}}_2}, \\frac{|s^{\\text{cand}}_3 - s^{\\text{model}}_3|}{s^{\\text{model}}_3} \\right) $$\n\n**3. Calculation**\nFirst, we establish the canonical side-length vectors. The given distances form valid triangles as they satisfy the triangle inequality.\n- Model distances: $\\{3.45, 5.78, 7.12\\}\\,\\text{\\AA}$. The canonical vector is $D^{\\text{model}} = (3.45, 5.78, 7.12)$.\n- Candidate distances: $\\{5.80, 7.10, 3.44\\}\\,\\text{\\AA}$. The canonical vector is $D^{\\text{cand}} = (3.44, 5.80, 7.10)$.\n\nNext, we compute the relative deviations, $\\delta_k = \\frac{|s^{\\text{cand}}_k - s^{\\text{model}}_k|}{s^{\\text{model}}_k}$:\n- $\\delta_1 = \\frac{|3.44 - 3.45|}{3.45} = \\frac{0.01}{3.45} \\approx 0.00289855...$\n- $\\delta_2 = \\frac{|5.80 - 5.78|}{5.78} = \\frac{0.02}{5.78} \\approx 0.00346020...$\n- $\\delta_3 = \\frac{|7.10 - 7.12|}{7.12} = \\frac{0.02}{7.12} \\approx 0.00280898...$\n\nThe metric $M$ is the maximum of these values:\n$$ M = \\max(\\delta_1, \\delta_2, \\delta_3) = 0.00346020... $$\nRounding to four significant figures gives $0.003460$.",
            "answer": "$$\\boxed{0.003460}$$"
        },
        {
            "introduction": "Once a virtual screen is complete, its success must be measured quantitatively. This final practice shifts focus from the mechanics of searching to the critical evaluation of its results. By deriving the formula for the Enrichment Factor ($EF$) from first principles, you will master the key performance metric used to assess whether a pharmacophore model has successfully prioritized active compounds over inactive ones, a crucial skill for validating and communicating the outcomes of your computational experiments .",
            "id": "3858033",
            "problem": "A virtual screening workflow in computational chemical biology generates a ranked list of candidate molecules scored by their pharmacophore fit to a target. Let $N$ denote the total number of screened molecules and $A$ denote the total number of molecules that are experimentally verified actives among these $N$. The baseline prevalence of actives in the library is defined as the fraction of actives, computed from first principles as the ratio of actives to the total, and the top selection is defined as the highest-scoring subset of the ranked list corresponding to a specified fraction of the list size. Consider the top $x$ percent of the ranked list, and define $f = \\frac{x}{100}$ with $0 < f \\leq 1$. Let $N_f$ denote the number of molecules in the top fraction $f$ of the list, taken as the smallest integer greater than or equal to $fN$, and let $H_f$ denote the number of experimentally verified actives within this top $N_f$ subset. The Enrichment Factor (EF) at the top $x$ percent, written as $EF_{x\\text{ percent}}$, is defined conceptually as the ratio of the observed hit rate in the top fraction to the baseline prevalence in the full library. Starting only from the definitions of baseline prevalence as a count ratio and hit rate as a count ratio within the truncated ranked list, derive an analytic expression for $EF_{x\\text{ percent}}$ in terms of $N$, $A$, $H_f$, and $f$. Provide your final answer as a single closed-form expression. No rounding is required and no units should be included.",
            "solution": "The objective is to derive an analytic expression for the Enrichment Factor ($EF$) from the provided definitions.\n\nThe Enrichment Factor is defined as the ratio of two quantities:\n$$\nEF = \\frac{\\text{Hit Rate in Top Fraction}}{\\text{Baseline Prevalence}}\n$$\n\nFirst, we formalize the numerator, the \"Hit Rate in Top Fraction\". This is the density of active molecules within the selected top subset. It is calculated as the number of actives found in this subset, $H_f$, divided by the total number of molecules in that subset, $N_f$.\n$$\n\\text{Hit Rate in Top Fraction} = \\frac{H_f}{N_f}\n$$\n\nNext, we formalize the denominator, the \"Baseline Prevalence\". This represents the overall probability of finding an active molecule in the entire library. It is the total number of active molecules, $A$, divided by the total number of molecules screened, $N$.\n$$\n\\text{Baseline Prevalence} = \\frac{A}{N}\n$$\n\nSubstituting these two expressions back into the definition of the Enrichment Factor:\n$$\nEF = \\frac{\\frac{H_f}{N_f}}{\\frac{A}{N}}\n$$\n\nThis complex fraction is simplified by multiplying the numerator by the reciprocal of the denominator:\n$$\nEF = \\frac{H_f}{N_f} \\times \\frac{N}{A} = \\frac{H_f N}{N_f A}\n$$\n\nThe problem requires the final expression to be in terms of $N$, $A$, $H_f$, and $f$. Our expression currently contains $N_f$. The problem provides a precise definition for $N_f$ in terms of $f$ and $N$: \"$N_f$ is the smallest integer greater than or equal to $fN$.\" This is the definition of the mathematical ceiling function, $\\lceil \\cdot \\rceil$.\n$$\nN_f = \\lceil fN \\rceil\n$$\n\nSubstituting this definition into our expression for $EF$ yields the final, exact formula:\n$$\nEF = \\frac{H_f N}{A \\lceil fN \\rceil}\n$$\nThis expression is the rigorous analytical form of the Enrichment Factor derived solely from the problem's definitions. While for large $N$, the approximation $\\lceil fN \\rceil \\approx fN$ is often used, the derived expression containing the ceiling function is exact.",
            "answer": "$$\n\\boxed{\\frac{H_f N}{A \\lceil fN \\rceil}}\n$$"
        }
    ]
}