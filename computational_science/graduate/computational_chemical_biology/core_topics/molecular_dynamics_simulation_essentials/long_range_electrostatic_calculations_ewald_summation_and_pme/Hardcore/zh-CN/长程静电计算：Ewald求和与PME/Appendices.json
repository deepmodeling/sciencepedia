{
    "hands_on_practices": [
        {
            "introduction": "在我们深入研究如何优化参数之前，理解埃瓦尔德方法在数学上的严谨性至关重要。总能量的计算引入了一个任意的分割参数$\\alpha$。这项练习  将引导您完成一个形式化的证明，以表明最终能量实际上与$\\alpha$无关，从而证实该方法的鲁棒性。这种基础性理解是欣赏埃瓦尔德加和中不同项如何协同作用以产生一致的物理结果的关键。",
            "id": "3851277",
            "problem": "考虑一个由$N$个点电荷$\\{q_{i}\\}_{i=1}^{N}$组成的体系，其位置为$\\{\\mathbf{r}_{i}\\}_{i=1}^{N}$，位于边长为$L$、体积为$V=L^{3}$的立方周期性盒子中，且体系整体呈电中性，即$\\sum_{i=1}^{N} q_{i} = 0$。静电相互作用在周期性边界条件下使用 Ewald 分裂方法进行计算，其中高斯屏蔽参数为$\\alpha>0$。总静电能$U(\\alpha)$由实空间项$U_{\\mathrm{r}}(\\alpha)$、倒易空间项$U_{\\mathrm{k}}(\\alpha)$、自能项$U_{\\mathrm{self}}(\\alpha)$以及一个取决于无穷远处边界条件的表面项$U_{\\mathrm{surf}}$组成。对于导电（锡箔）边界条件，$U_{\\mathrm{surf}}$为零，并且不依赖于$\\alpha$。为专注于$\\alpha$标度关系，假设库仑前置因子为 1。使用 Ewald 分裂对势定义实空间贡献\n$$\n\\phi_{\\mathrm{r}}(r;\\alpha) = \\frac{\\operatorname{erfc}(\\alpha r)}{r},\n$$\n其中$\\operatorname{erfc}$是互补误差函数，并设倒易空间贡献通过傅里叶空间表示定义，其中倒易格矢为$\\mathbf{k} = \\frac{2\\pi}{L} \\mathbf{m}$，$\\mathbf{m}\\in\\mathbb{Z}^{3}$，结构因子为$S(\\mathbf{k}) = \\sum_{j=1}^{N} q_{j} \\exp(- i \\mathbf{k}\\cdot \\mathbf{r}_{j})$。粒子网格 Ewald (PME) 方法通过电荷分配和基于网格的快速傅里叶变换来数值计算$U_{\\mathrm{k}}(\\alpha)$，但精确的 Ewald 求和对应于对非零$\\mathbf{k}$的形式化倒易空间级数。\n\n从上述定义出发，仅使用高斯函数和泊松求和公式的基本性质，分析各贡献项的$\\alpha$标度关系，并计算在导电边界条件下中性体系的精确导数$\\frac{\\partial U(\\alpha)}{\\partial \\alpha}$。您必须在分析中明确考虑自能项和表面项，并为您所声称的任何$\\alpha$依赖性的抵消提供理由。请将最终答案表示为单个实数。无需单位。无需四舍五入。",
            "solution": "任务是计算总 Ewald 静电能$U(\\alpha)$对高斯屏蔽参数$\\alpha$的导数。在 Ewald 求和中，总能量的构造方式使其不依赖于$\\alpha$。因此，它对$\\alpha$的导数必须为零。本题要求通过分析特定情况下 Ewald 能量表达式中每一项对$\\alpha$的依赖性，来给出该结果的形式化证明。\n\n对于一个由$N$个点电荷$\\{q_i\\}$（位于位置$\\{\\mathbf{r}_i\\}$）组成的体系，在体积为$V=L^3$的立方盒子中，满足周期性边界条件、整体电中性（$\\sum_i q_i = 0$）以及无穷远处为导电边界条件，其总静电能$U(\\alpha)$由以下四项之和给出：\n$$\nU(\\alpha) = U_{\\mathrm{r}}(\\alpha) + U_{\\mathrm{k}}(\\alpha) + U_{\\mathrm{self}}(\\alpha) + U_{\\mathrm{surf}}\n$$\n\n题目指明库仑前置因子为 1（即$1/(4\\pi\\epsilon_0) = 1$），并且对于导电边界条件，$U_{\\mathrm{surf}} = 0$。其他三项由标准的 Ewald 公式给出，与所提供的实空间势一致。\n\n1.  **实空间项 ($U_{\\mathrm{r}}$):** 此项计算所有电荷对及其周期性映像之间的短程屏蔽相互作用之和。求和符号上的撇号表示在原胞（$\\mathbf{n}=0$）内排除$i=j$的自相互作用项。\n    $$\n    U_{\\mathrm{r}}(\\alpha) = \\frac{1}{2} \\sum_{i,j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}{'} q_i q_j \\frac{\\operatorname{erfc}(\\alpha |\\mathbf{r}_{ij} + L\\mathbf{n}|)}{|\\mathbf{r}_{ij} + L\\mathbf{n}|}\n    $$\n    其中$\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$，$\\operatorname{erfc}(x)$是互补误差函数。\n\n2.  **倒易空间项 ($U_{\\mathrm{k}}$):** 此项通过在傅里叶空间中对倒易格矢$\\mathbf{k} = \\frac{2\\pi}{L}\\mathbf{m}$（其中$\\mathbf{m} \\in \\mathbb{Z}^3$）求和来计算相互作用的长程部分。$\\mathbf{k}=\\mathbf{0}$项被排除在外。\n    $$\n    U_{\\mathrm{k}}(\\alpha) = \\frac{2\\pi}{V} \\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\frac{|S(\\mathbf{k})|^2}{k^2} \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right)\n    $$\n    其中$S(\\mathbf{k}) = \\sum_{j=1}^{N} q_j \\exp(-i\\mathbf{k}\\cdot\\mathbf{r}_j)$是结构因子。前置因子$2\\pi/V$与设置$1/(4\\pi\\epsilon_0)=1$是一致的。\n\n3.  **自能项 ($U_{\\mathrm{self}}$):** 此项减去每个电荷与其自身屏蔽高斯电荷云之间的人为相互作用。\n    $$\n    U_{\\mathrm{self}}(\\alpha) = -\\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2\n    $$\n\n现在我们来计算每一项对$\\alpha$的导数。\n\n**实空间项的导数 $\\frac{\\partial U_{\\mathrm{r}}}{\\partial \\alpha}$:**\n我们首先需要屏蔽函数的导数。使用链式法则和恒等式$\\frac{d}{dx}\\operatorname{erfc}(x) = -\\frac{2}{\\sqrt{\\pi}}\\exp(-x^2)$，我们得到：\n$$\n\\frac{\\partial}{\\partial \\alpha} \\left( \\frac{\\operatorname{erfc}(\\alpha r)}{r} \\right) = \\frac{1}{r} \\left( \\frac{\\partial}{\\partial \\alpha} \\operatorname{erfc}(\\alpha r) \\right) = \\frac{1}{r} \\left( -\\frac{2}{\\sqrt{\\pi}}\\exp(-(\\alpha r)^2) \\cdot r \\right) = -\\frac{2}{\\sqrt{\\pi}}\\exp(-\\alpha^2 r^2)\n$$\n将此应用于$U_{\\mathrm{r}}(\\alpha)$，我们得到：\n$$\n\\frac{\\partial U_{\\mathrm{r}}}{\\partial \\alpha} = \\frac{1}{2} \\sum_{i,j,\\mathbf{n}}{'} q_i q_j \\left( -\\frac{2}{\\sqrt{\\pi}}\\exp(-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2) \\right) = -\\frac{1}{\\sqrt{\\pi}} \\sum_{i,j,\\mathbf{n}}{'} q_i q_j \\exp(-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2)\n$$\n带撇的求和$\\sum'$遍历所有对$(i,j)$和格矢$\\mathbf{n}$，同时排除$i=j$和$\\mathbf{n}=\\mathbf{0}$的情况。我们可以通过计算完整和并减去被排除的项来重写它：\n$$\n\\sum_{i,j,\\mathbf{n}}{'} (\\dots) = \\sum_{i,j,\\mathbf{n}} (\\dots) - \\sum_{i=1}^N \\left( q_i^2 \\exp(-\\alpha^2 |\\mathbf{r}_{ii} + L\\mathbf{0}|^2) \\right) = \\sum_{i,j,\\mathbf{n}} (\\dots) - \\sum_{i=1}^N q_i^2\n$$\n因此，实空间项的导数是：\n$$\n\\frac{\\partial U_{\\mathrm{r}}}{\\partial \\alpha} = -\\frac{1}{\\sqrt{\\pi}} \\left( \\sum_{i,j,\\mathbf{n}} q_i q_j \\exp(-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2) \\right) + \\frac{1}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2\n$$\n\n**倒易空间项的导数 $\\frac{\\partial U_{\\mathrm{k}}}{\\partial \\alpha}$:**\n我们对指数项关于$\\alpha$求导：\n$$\n\\frac{\\partial}{\\partial \\alpha} \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right) = \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right) \\cdot \\left( -\\frac{k^2}{4} \\right) \\cdot \\left( -2\\alpha^{-3} \\right) = \\frac{k^2}{2\\alpha^3} \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right)\n$$\n将此代入$U_{\\mathrm{k}}(\\alpha)$的表达式中：\n$$\n\\frac{\\partial U_{\\mathrm{k}}}{\\partial \\alpha} = \\frac{2\\pi}{V} \\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\frac{|S(\\mathbf{k})|^2}{k^2} \\left[ \\frac{k^2}{2\\alpha^3} \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right) \\right] = \\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}\\neq \\mathbf{0}} |S(\\mathbf{k})|^2 \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right)\n$$\n\n**自能项的导数 $\\frac{\\partial U_{\\mathrm{self}}}{\\partial \\alpha}$:**\n这个导数很简单：\n$$\n\\frac{\\partial U_{\\mathrm{self}}}{\\partial \\alpha} = \\frac{\\partial}{\\partial \\alpha} \\left( -\\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2 \\right) = -\\frac{1}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2\n$$\n\n**总导数 $\\frac{\\partial U}{\\partial \\alpha}$:**\n现在，我们将所有分量的导数相加。$U_{\\mathrm{surf}}$的导数为$0$。\n$$\n\\frac{\\partial U}{\\partial \\alpha} = \\frac{\\partial U_{\\mathrm{r}}}{\\partial \\alpha} + \\frac{\\partial U_{\\mathrm{k}}}{\\partial \\alpha} + \\frac{\\partial U_{\\mathrm{self}}}{\\partial \\alpha}\n$$\n$$\n\\frac{\\partial U}{\\partial \\alpha} = \\left[ -\\frac{1}{\\sqrt{\\pi}} \\sum_{i,j,\\mathbf{n}} q_i q_j e^{-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2} + \\frac{1}{\\sqrt{\\pi}} \\sum_i q_i^2 \\right] + \\left[ \\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}\\neq\\mathbf{0}} |S(\\mathbf{k})|^2 e^{-\\frac{k^2}{4\\alpha^2}} \\right] + \\left[ -\\frac{1}{\\sqrt{\\pi}} \\sum_i q_i^2 \\right]\n$$\n自能项的导数与实空间项导数的第二部分完全抵消：\n$$\n\\frac{\\partial U}{\\partial \\alpha} = -\\frac{1}{\\sqrt{\\pi}} \\sum_{i,j,\\mathbf{n}} q_i q_j e^{-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2} + \\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}\\neq\\mathbf{0}} |S(\\mathbf{k})|^2 e^{-\\frac{k^2}{4\\alpha^2}}\n$$\n为了证明剩余的和为零，我们使用泊松求和公式，该公式将实空间格点上的和与相应倒易空间格点上的和联系起来。对于高斯函数，相关的恒等式是：\n$$\n\\sum_{\\mathbf{n}\\in\\mathbb{Z}^3} \\exp(-a |\\mathbf{x} + L\\mathbf{n}|^2) = \\frac{1}{L^3} \\left(\\frac{\\pi}{a}\\right)^{3/2} \\sum_{\\mathbf{k}} \\exp\\left(-\\frac{k^2}{4a}\\right) \\exp(i\\mathbf{k}\\cdot\\mathbf{x})\n$$\n我们将其应用于第一项，令$a = \\alpha^2$，$\\mathbf{x} = \\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$，以及$V=L^3$：\n$$\n\\sum_{\\mathbf{n}} \\exp(-\\alpha^2 |\\mathbf{r}_{ij} + L\\mathbf{n}|^2) = \\frac{\\pi^{3/2}}{V\\alpha^3} \\sum_{\\mathbf{k}} \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right) \\exp(i\\mathbf{k}\\cdot\\mathbf{r}_{ij})\n$$\n将此代回$\\frac{\\partial U}{\\partial \\alpha}$的第一项中：\n$$\n-\\frac{1}{\\sqrt{\\pi}} \\sum_{i,j} q_i q_j \\left[ \\frac{\\pi^{3/2}}{V\\alpha^3} \\sum_{\\mathbf{k}} e^{-\\frac{k^2}{4\\alpha^2}} e^{i\\mathbf{k}\\cdot(\\mathbf{r}_i - \\mathbf{r}_j)} \\right] = -\\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}} e^{-\\frac{k^2}{4\\alpha^2}} \\sum_{i,j} q_i q_j e^{i\\mathbf{k}\\cdot\\mathbf{r}_i} e^{-i\\mathbf{k}\\cdot\\mathbf{r}_j}\n$$\n对$i,j$的双重求和可以因式分解：\n$$\n\\sum_{i,j} q_i q_j e^{i\\mathbf{k}\\cdot\\mathbf{r}_i} e^{-i\\mathbf{k}\\cdot\\mathbf{r}_j} = \\left(\\sum_i q_i e^{i\\mathbf{k}\\cdot\\mathbf{r}_i}\\right) \\left(\\sum_j q_j e^{-i\\mathbf{k}\\cdot\\mathbf{r}_j}\\right) = S(-\\mathbf{k}) S(\\mathbf{k}) = |S(\\mathbf{k})|^2\n$$\n这里我们对于实数电荷$q_j$使用了$S(\\mathbf{k})^* = \\sum_j q_j e^{i\\mathbf{k}\\cdot\\mathbf{r}_j} = S(-\\mathbf{k})$。\n\n所以第一项变为：\n$$\n-\\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}} |S(\\mathbf{k})|^2 \\exp\\left(-\\frac{k^2}{4\\alpha^2}\\right)\n$$\n现在，将此代回总导数的表达式中：\n$$\n\\frac{\\partial U}{\\partial \\alpha} = -\\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}} |S(\\mathbf{k})|^2 e^{-\\frac{k^2}{4\\alpha^2}} + \\frac{\\pi}{V\\alpha^3} \\sum_{\\mathbf{k}\\neq\\mathbf{0}} |S(\\mathbf{k})|^2 e^{-\\frac{k^2}{4\\alpha^2}}\n$$\n这两个和是相同的，只是第一个和包含了$\\mathbf{k}=\\mathbf{0}$项，而第二个没有。它们的差是第一个和中$\\mathbf{k}=\\mathbf{0}$项的负值：\n$$\n\\frac{\\partial U}{\\partial \\alpha} = -\\frac{\\pi}{V\\alpha^3} |S(\\mathbf{0})|^2 \\exp(0) = -\\frac{\\pi}{V\\alpha^3} |S(\\mathbf{0})|^2\n$$\n在$\\mathbf{k}=\\mathbf{0}$处的结构因子定义为$S(\\mathbf{0}) = \\sum_{j=1}^{N} q_j \\exp(-i\\mathbf{0}\\cdot\\mathbf{r}_j) = \\sum_{j=1}^{N} q_j$。\n题目说明体系整体呈电中性，所以$\\sum_{j=1}^{N} q_j = 0$。\n这意味着$S(\\mathbf{0}) = 0$。\n因此，总导数为：\n$$\n\\frac{\\partial U(\\alpha)}{\\partial \\alpha} = 0\n$$\n这证明了总 Ewald 能量与任意的分裂参数$\\alpha$无关，这是该方法的一个基本性质。最终答案是该导数的数值。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "尽管总能量与$\\alpha$无关，但计算成本却对其高度敏感。一个糟糕的$\\alpha$选择可能使计算成本高得令人望而却步。这项练习  探讨了一个根本性的权衡：$\\alpha$如何在快速衰减的实空间加和与基于傅里叶变换的倒易空间加和之间转移计算负担。通过分析其标度行为，您将建立起为您的模拟选择高效$\\alpha$值所需的直觉。",
            "id": "3851319",
            "problem": "考虑一个边长为$L$的立方周期性模拟单元，其中包含$N$个点电荷，数密度为$\\rho = N/L^3$。在 Ewald 求和中，库仑核通过宽度参数为$\\alpha$的高斯屏蔽被分解为一个短程实空间项和一个长程倒易空间项。实空间求和在截断半径$r_c$处截断，倒易空间求和在最大波矢大小$k_{\\max}$处截断，或者通过粒子网格 Ewald（PME，Particle Mesh Ewald）方法在有效分辨率对应于$k_{\\max}$的网格上进行评估。假设在误差估计中电荷为均匀分布，并考虑一个目标均方根（RMS，root-mean-square）力误差容差$\\varepsilon$。\n\n从以下事实出发：(i) 当$x$很大时，互补误差函数$\\operatorname{erfc}(x)$的衰减类似于高斯函数；(ii) 倒易空间 Ewald 核在$k$空间中被一个高斯因子所阻尼。请从第一性原理出发进行推导，以确定$\\alpha$如何控制实空间核的空间衰减和倒易空间核的谱衰减。利用这些衰减特性来限定截断误差，并推导出为了保持固定的容差$\\varepsilon$，$r_c$和$k_{\\max}$必须如何随$\\alpha$缩放。然后，利用这些关系，在以下标准成本模型下，推断这两部分计算成本随$\\alpha$的定性标度关系：由于$r_c$范围内的邻居计数，实空间中每个粒子的成本标度为$\\mathcal{O}(\\rho r_c^3)$；倒易空间成本与$|{\\bf k}| \\le k_{\\max}$的$k$模式数量成标度关系，即对于经典 Ewald 方法为$\\mathcal{O}(k_{\\max}^3)$，或对于 PME 方法与该数量单调相关。\n\n根据您的推导，以下哪些陈述是正确的？选择所有适用项。\n\nA. 对于固定的误差容差$\\varepsilon$和固定的密度$\\rho$，减小$\\alpha$会迫使$r_c$大致按$\\alpha^{-1}$增长以保持实空间截断误差较小，因此实空间计算成本按$\\alpha^{-3}$的比例增加，而所需的倒易空间模式数按$\\alpha^{3}$的比例减少，因为$k$空间中的高斯阻尼变得更强。\n\nB. 对于固定的$r_c$，实空间计算成本与$\\alpha$无关，但随着$\\alpha$的减小，实空间截断误差会增加，其主要依赖关系近似为$\\propto \\exp(-\\alpha^2 r_c^2)$，这意味着对于给定的容差，即使倒易空间网格被任意细化，选择过小的$\\alpha$也是不可接受的。\n\nC. 对于固定的$r_c$，减小$\\alpha$会增加倒易空间的工作量，因为$k$空间中的高斯阻尼因子衰减得更慢，所以需要更多的$k$模式。\n\nD. 在固定的精度目标$\\varepsilon$下，存在一个最优的$\\alpha$来平衡实空间和倒易空间的成本，并且随着$r_c$的减小（例如，由于内存或邻居列表的限制），最优的$\\alpha$会转向更大的值，从而将更多的工作转移到倒易空间。",
            "solution": "该问题要求分析 Ewald 求和方法，特别是关注在固定误差容差$\\varepsilon$的情况下，Ewald 参数$\\alpha$如何影响计算中实空间和倒易空间部分的计算成本。\n\n首先，我们验证问题陈述的有效性。\n**第 1 步：提取已知条件**\n- 系统：一个边长为$L$的立方周期性模拟单元。\n- 内容：$N$个点电荷，数密度为$\\rho = N/L^3$。\n- 方法：Ewald 求和，其中库仑核使用宽度参数为$\\alpha$的高斯屏蔽进行分解。\n- 实空间部分：在截断半径$r_c$处截断。\n- 倒易空间部分：在最大波矢大小$k_{\\max}$处截断。\n- 误差容差：目标均方根（RMS）力误差$\\varepsilon$。\n- 事实 (i)：当$x$很大时，互补误差函数$\\operatorname{erfc}(x)$的衰减类似于高斯函数。\n- 事实 (ii)：倒易空间 Ewald 核在$k$空间中被一个高斯因子所阻尼。\n- 成本模型（实空间）：每个粒子的成本为$\\mathcal{O}(\\rho r_c^3)$。\n- 成本模型（倒易空间）：成本为$\\mathcal{O}(k_{\\max}^3)$。\n\n**第 2 步：使用提取的已知条件进行验证**\n问题陈述具有科学依据，描述了计算化学生物学中使用的标准 Ewald 求和技术。其物理和数学前提是正确的：库仑势的分解、截断的使用、误差函数的渐近行为以及倒易空间中的高斯阻尼都是标准的教科书概念。成本模型对于基于对列表的短程计算和基于傅里叶的长程计算是合理的近似。该问题是适定的、客观的，并包含足够的信息来推导出所要求的定性标度关系。它既不琐碎，也不是病态问题。\n\n**第 3 步：结论与行动**\n问题有效。我们可以继续进行解答。\n\n**从第一性原理推导**\n\nEwald 求和方法利用恒等式$1 = \\operatorname{erfc}(\\alpha r) + \\operatorname{erf}(\\alpha r)$将每对电荷间的库仑势$V(r) = 1/r$分解为短程和长程两个分量。参数$\\alpha$控制用于此分解的屏蔽高斯电荷分布的宽度。\n\n势能被分解为：\n$$ V(r) = \\underbrace{\\frac{\\operatorname{erfc}(\\alpha r)}{r}}_{\\text{Real space}} + \\underbrace{\\frac{\\operatorname{erf}(\\alpha r)}{r}}_{\\text{Reciprocal space}} $$\n\n**1. 实空间分析**\n实空间项是$\\phi_{rs}(r) = q_i q_j \\frac{\\operatorname{erfc}(\\alpha r)}{r}$。由于互补误差函数，该项迅速衰减。力是势的负梯度。力的贡献大小为$|F_{rs}(r)| = | - \\frac{d\\phi_{rs}}{dr} | = |q_i q_j| \\left| \\frac{\\operatorname{erfc}(\\alpha r)}{r^2} + \\frac{2\\alpha}{\\sqrt{\\pi}} \\frac{e^{-\\alpha^2 r^2}}{r} \\right|$。\n\n实空间求和在截断半径$r_c$处截断。此截断引入的误差主要由$r=r_c$处的力项的大小决定。对于足够大的乘积$\\alpha r_c$，包含高斯项$e^{-\\alpha^2 r_c^2}$的项主导了衰减。关于均方根力误差$\\varepsilon_{rs}$的一个标准结果是，它近似地按以下方式缩放：\n$$ \\varepsilon_{rs} \\propto \\frac{e^{-\\alpha^2 r_c^2}}{r_c} $$\n更详细的分析表明其依赖关系类似于$\\varepsilon_{rs} \\propto (\\alpha r_c + 1) e^{-\\alpha^2 r_c^2}/r_c^2$。无论如何，为了保持恒定的误差$\\varepsilon$，指数项必须大致保持不变。这意味着我们必须有$\\alpha^2 r_c^2 \\approx C_1$，其中$C_1$是由目标容差$\\varepsilon$决定的常数。这导致了以下标度关系：\n$$ r_c \\propto \\frac{1}{\\alpha} $$\n实空间计算成本被给出为$\\mathcal{O}(\\rho r_c^3)$。代入$r_c$的标度关系：\n$$ \\text{Cost}_{rs} \\propto \\rho r_c^3 \\propto \\rho \\left(\\frac{1}{\\alpha}\\right)^3 = \\rho \\alpha^{-3} $$\n因此，随着$\\alpha$减小，$r_c$必须增加，实空间成本按$\\alpha^{-3}$增长。\n\n**2. 倒易空间分析**\n长程项$\\frac{\\operatorname{erf}(\\alpha r)}{r}$变化缓慢，通过傅里叶变换处理。相关联的屏蔽电荷分布（一个宽度由$\\alpha$控制的高斯函数）的傅里叶变换也是一个高斯函数。倒易空间求和的系数被因子$\\exp(-k^2 / (4\\alpha^2))$调制，其中$k$是波矢$\\mathbf{k}$的大小。\n\n在$k_{\\max}$处截断倒易空间求和会引入一个误差$\\varepsilon_{recip}$，该误差主要由第一个被忽略的项决定。力的误差近似按以下方式缩放：\n$$ \\varepsilon_{recip} \\propto k_{\\max}^c \\exp\\left(-\\frac{k_{\\max}^2}{4\\alpha^2}\\right) $$\n其中$c$是一个小的正幂。为了保持恒定的误差，指数项必须再次大致保持不变。这要求$k_{\\max}^2 / (4\\alpha^2) \\approx C_2$，从而得出以下标度关系：\n$$ k_{\\max} \\propto \\alpha $$\n倒易空间成本被给出为$\\mathcal{O}(k_{\\max}^3)$，代表要求和的波矢数量。代入$k_{\\max}$的标度关系：\n$$ \\text{Cost}_{recip} \\propto k_{\\max}^3 \\propto \\alpha^3 $$\n因此，随着$\\alpha$减小，$k_{\\max}$可以减小，倒易空间成本按$\\alpha^3$缩小。\n\n**3. 总成本与优化**\n总计算成本是实空间成本和倒易空间成本之和：\n$$ \\text{Cost}_{total} \\approx C_{rs} \\alpha^{-3} + C_{recip} \\alpha^3 $$\n这个关于$\\alpha$的函数有一个最小值，当两项大小相当时出现，即当计算负载在实空间和倒易空间之间平衡时。这为给定的问题和期望的精度定义了一个最优的$\\alpha$。\n\n**选项评估**\n\n**A. 对于固定的误差容差$\\varepsilon$和固定的密度$\\rho$，减小$\\alpha$会迫使$r_c$大致按$\\alpha^{-1}$增长以保持实空间截断误差较小，因此实空间计算成本按$\\alpha^{-3}$的比例增加，而所需的倒易空间模式数按$\\alpha^{3}$的比例减少，因为$k$空间中的高斯阻尼变得更强。**\n- “减小$\\alpha$会迫使$r_c$大致按$\\alpha^{-1}$增长”：我们的推导表明$r_c \\propto 1/\\alpha$。这是正确的。\n- “因此实空间计算成本按$\\alpha^{-3}$的比例增加”：我们的推导表明$\\text{Cost}_{rs} \\propto \\alpha^{-3}$。这是正确的。\n- “所需的倒易空间模式数按$\\alpha^{3}$的比例减少”：模式数与$k_{\\max}^3$成正比。我们的推导表明$k_{\\max} \\propto \\alpha$，所以模式数按$\\alpha^3$缩放。随着$\\alpha$减小，该数量减少。这是正确的。\n- “因为$k$空间中的高斯阻尼变得更强”：阻尼因子是$\\exp(-k^2/(4\\alpha^2))$。随着$\\alpha$减小，分母$4\\alpha^2$变小，因此负指数的绝对值随$k$增长得更快。这对应于更强（更快）的衰减。这个推理是正确的。\n该陈述完全准确。\n**结论：正确**\n\n**B. 对于固定的$r_c$，实空间计算成本与$\\alpha$无关，但随着$\\alpha$的减小，实空间截断误差会增加，其主要依赖关系近似为$\\propto \\exp(-\\alpha^2 r_c^2)$，这意味着对于给定的容差，即使倒易空间网格被任意细化，选择过小的$\\alpha$也是不可接受的。**\n- “对于固定的$r_c$，实空间计算成本与$\\alpha$无关”：成本模型是$\\mathcal{O}(\\rho r_c^3)$。如果$r_c$固定，则成本是恒定的。这是正确的。\n- “随着$\\alpha$的减小，实空间截断误差会增加”：误差与诸如$\\exp(-\\alpha^2 r_c^2)$的项成标度关系。对于固定的$r_c$，当$\\alpha$减小时，$\\alpha^2 r_c^2$减小，所以$-\\alpha^2 r_c^2$增加，指数项增长。误差增加。这是正确的。\n- “其主要依赖关系近似为$\\propto \\exp(-\\alpha^2 r_c^2)$”：正如我们初步分析所确立的，这是误差公式中的主导因子。正确。\n- “这意味着对于给定的容差，即使倒易空间网格被任意细化，选择过小的$\\alpha$也是不可接受的”：如果对于给定的$r_c$，$\\alpha$过小，实空间误差$\\varepsilon_{rs}$可能会超过总允许误差$\\varepsilon$。细化倒易空间计算只能减少$\\varepsilon_{recip}$；它无法补偿已经过大的$\\varepsilon_{rs}$。因此，$\\alpha$的选择受到$r_c$和$\\varepsilon$的约束。这是使用 Ewald 方法的一个关键实践考虑。正确。\n该陈述完全准确。\n**结论：正确**\n\n**C. 对于固定的$r_c$，减小$\\alpha$会增加倒易空间的工作量，因为$k$空间中的高斯阻尼因子衰减得更慢，所以需要更多的$k$模式。**\n- 该陈述分析了减小$\\alpha$的后果。正如我们在倒易空间分析中所确立的，减小$\\alpha$会导致倒易空间项的更快衰减（阻尼因子$\\exp(-k^2 / (4\\alpha^2))$衰减得更快）。\n- 这意味着达到给定精度所需的$k$模式更少，因此$k_{\\max}$可以更小。更小的$k_{\\max}$导致倒易空间工作量*减少*，而不是增加。\n- 该陈述声称工作量增加是因为阻尼因子“衰减得更慢”，这在事实上也是不正确的。减小$\\alpha$会使衰减更快。\n该陈述的结论和推理都是不正确的。\n**结论：不正确**\n\n**D. 在固定的精度目标$\\varepsilon$下，存在一个最优的$\\alpha$来平衡实空间和倒易空间的成本，并且随着$r_c$的减小（例如，由于内存或邻居列表的限制），最优的$\\alpha$会转向更大的值，从而将更多的工作转移到倒易空间。**\n- “存在一个最优的$\\alpha$来平衡实空间和倒易空间的成本”：我们对总成本函数$\\text{Cost}_{total} \\approx C_{rs} \\alpha^{-3} + C_{recip} \\alpha^3$的分析表明存在一个最小值，通常在两个成本平衡的地方。正确。\n- “随着$r_c$的减小……最优的$\\alpha$会转向更大的值”：如果$r_c$被限制得更小，我们必须确保实空间误差$\\varepsilon_{rs} \\propto \\exp(-\\alpha^2 r_c^2)$保持较小。在$r_c$较小的情况下，保持参数$\\alpha^2 r_c^2$较大的唯一方法是增加$\\alpha$。因此，较小的$r_c$迫使$\\alpha$变大。正确。\n- “将更多的工作转移到倒易空间”：较大的$\\alpha$使实空间相互作用$\\operatorname{erfc}(\\alpha r)/r$的程更短，这为较小的$r_c$提供了理由并降低了实空间成本。相反，较大的$\\alpha$使倒易空间分量在$k$空间中衰减得更慢（因为随着$\\alpha$增加，$\\exp(-k^2/(4\\alpha^2))$衰减得更慢），需要更大的$k_{\\max}$，因此倒易空间成本更高（$\\propto \\alpha^3$）。工作负荷的平衡从实空间转移到了倒易空间。正确。\n该陈述完全准确。\n**结论：正确**",
            "answer": "$$\\boxed{ABD}$$"
        },
        {
            "introduction": "粒子网格埃瓦尔德 (PME) 方法引入了与其基于网格的实现相关的额外参数，即网格间距和电荷插值阶数。这些选择创造了另一层优化权衡，需要在快速傅里叶变换 (FFT) 的成本与将电荷分配到网格的成本之间取得平衡。这项练习  挑战您像一个实践者一样思考，为选择这些参数以达到期望的精度而制定一个经济高效的策略。",
            "id": "3851278",
            "problem": "一个大小为$N$的溶剂化生物分子体系通过长程库仑力相互作用，这些力使用粒子网格埃瓦尔德（PME）方法计算，该方法是埃瓦尔德求和的一种基于网格的实现。在PME中，倒易空间贡献是通过以下步骤获得的：使用$p$阶B样条将电荷分配到网格上，执行三维快速傅里叶变换（FFT），乘以晶格格林函数，然后将场插值回粒子位置。设模拟单元的线性维度为$L$，并有一个间距为$h$的均匀网格，因此网格点数为$M \\approx (L/h)^3$。埃瓦尔德分裂参数为$\\alpha$，实空间贡献在截断半径$r_c$处被截断。\n\n根据电荷分配的傅里叶分析，一个$p$阶B样条的傅里叶变换具有一个$\\mathrm{sinc}$包络，因此由未解析的晶格镜像引起的混叠振幅被一个随着$p$增加而衰减的因子所抑制。对于足够光滑的目标场，力计算中的这种网格插值误差会随着$p$的增加而迅速减小，并且对于较小的$h$，其行为表现为由$p$决定的$h$的高阶幂。PME的主要计算成本是：电荷散布和收集，其成本与粒子数和模板大小成比例；以及三维FFT，其成本与$M \\log M$成比例。\n\n你的任务是通过选择插值阶数$p$和网格间距$h$，以最小的计算成本实现目标相对均方根力误差$\\varepsilon_{\\text{target}}$。同时，埃瓦尔德参数$\\alpha$和截断半径$r_c$已经调整好，使得实空间截断误差小于$\\varepsilon_{\\text{target}}$。基于通过B样条分配抑制傅里叶误差的基本原理以及PME各组成部分的渐进成本缩放，选择$p$的哪条准则最适合以最小成本达到目标误差？\n\nA. 选择非常大的插值阶数$p$（例如，$p \\ge 10$），这样网格可以变得更粗糙，即$h$取得尽可能大，因为FFT成本$M \\log M$占主导地位；增加$p$几乎不改变总运行时间。\n\nB. 选择尽可能小的插值阶数$p$（例如，$p=3$），并减小网格间距$h$，直到网格插值误差小于$\\varepsilon_{\\text{target}}$，因为减小$h$总是比增加$p$更便宜。\n\nC. 选择一个中等的插值阶数$p$（例如，$p$在$4$到$6$的范围内），然后将网格间距$h$设置得刚好足够精细，使得网格插值误差与$\\varepsilon_{\\text{target}}$相匹配，从而在每个粒子的散布/收集成本（随模板体积以$p^3$的阶数增长）与FFT成本（以$(L/h)^3 \\log\\big((L/h)^3\\big)$增长）之间取得平衡。\n\nD. 保持网格间距$h$由盒子维度$L$固定，并让插值阶数$p$增加，直到网格插值误差可以忽略不计，因为PME误差主要由$p$控制，而$h$不是一个有效的调节参数。",
            "solution": "问题要求为粒子网格埃瓦尔德（PME）方法找到选择插值阶数$p$和网格间距$h$的最恰当准则，以最小的计算成本实现目标均方根力误差$\\varepsilon_{\\text{target}}$。假设实空间误差贡献已经低于目标误差。\n\n首先，我们必须将目标形式化。目标是在网格插值误差$\\varepsilon_{\\text{mesh}}$等于目标误差$\\varepsilon_{\\text{target}}$的约束下，最小化总计算成本$C_{\\text{total}}$。我们设定$\\varepsilon_{\\text{mesh}} = \\varepsilon_{\\text{target}}$，因为任何更小的误差都意味着更高的计算成本（例如，来自更精细的网格），而没有额外的好处。\n\n如问题陈述所述，总计算成本$C_{\\text{total}}$主要由两个部分主导：\n1.  电荷散布和收集成本$C_{\\text{sg}}$。这部分计算涉及将$N$个粒子中每个粒子的部分电荷分布到周围的网格点上，并且在计算的FFT部分之后，将势或场从网格插值回粒子位置。对于一个$p$阶B样条，样条函数的支撑域覆盖$p$个网格区间。因此，每个粒子的计算模板是一个边长为$p$个网格点的立方体，其成本与粒子数$N$和该模板的体积$p^3$成比例。\n    $$C_{\\text{sg}} \\propto N p^3$$\n2.  快速傅里叶变换（FFT）成本$C_{\\text{FFT}}$。倒易空间计算涉及在具有$M$个点的网格上进行三维FFT。3D FFT的成本与$M \\log M$成比例。给定一个线性维度为$L$的模拟单元和网格间距$h$，网格点数为$M \\approx (L/h)^3$。\n    $$C_{\\text{FFT}} \\propto M \\log M \\approx \\left(\\frac{L}{h}\\right)^3 \\log\\left(\\left(\\frac{L}{h}\\right)^3\\right)$$\n    这可以简化为$C_{\\text{FFT}} \\propto (L/h)^3 \\log(L/h)$。\n\n需要最小化的总成本是这两个部分的和：\n$$C_{\\text{total}}(p, h) = k_1 N p^3 + k_2 \\left(\\frac{L}{h}\\right)^3 \\log\\left(\\frac{L}{h}\\right)$$\n其中$k_1$和$k_2$是比例常数。\n\n约束由网格插值误差给出。对于足够光滑的电荷分布和势，使用$p$阶B样条插值在间距为$h$的网格上计算的力的误差，其缩放关系为：\n$$\\varepsilon_{\\text{mesh}}(p, h) \\propto h^p$$\n更精确地说，误差是埃瓦尔德分裂参数$\\alpha$和网格间距$h$的乘积的函数，因此$\\varepsilon_{\\text{mesh}}(p, h) \\approx C(p) (\\alpha h)^p$，其中$C(p)$是一个随$p$变化的系数。为满足目标误差，我们设定：\n$$\\varepsilon_{\\text{target}} = C(p) (\\alpha h)^p$$\n这个方程为固定的目标误差建立了$h$和$p$之间的关系。我们可以将$h$表示为$p$的函数：\n$$h(p) = \\frac{1}{\\alpha} \\left(\\frac{\\varepsilon_{\\text{target}}}{C(p)}\\right)^{1/p}$$\n这表明，为了保持恒定的误差$\\varepsilon_{\\text{target}}$，增加插值阶数$p$允许使用更粗糙的网格（更大的$h$）。\n\n现在，通过将$h(p)$代入$C_{\\text{total}}$的表达式中，我们可以将成本仅作为$p$的函数进行分析：\n$$C_{\\text{total}}(p) = k_1 N p^3 + k_2 \\left(\\frac{\\alpha L}{\\left(\\frac{\\varepsilon_{\\text{target}}}{C(p)}\\right)^{1/p}}\\right)^3 \\log\\left(\\frac{\\alpha L}{\\left(\\frac{\\varepsilon_{\\text{target}}}{C(p)}\\right)^{1/p}}\\right)$$\n让我们分析这两个成本项作为$p$的函数的行为：\n-   散布/收集成本$C_{\\text{sg}}(p) = k_1 N p^3$，是$p$的一个单调且快速增长的函数。\n-   FFT成本$C_{\\text{FFT}}(p)$，是$p$的一个递减函数。这是因为随着$p$的增加，$h(p)$也增加，这意味着网格点数$M \\approx (L/h(p))^3$减少，从而降低了FFT成本。\n\n总成本是一个快速增长的函数 ($C_{\\text{sg}}$) 和一个递减的函数 ($C_{\\text{FFT}}$) 的和。$p$的最优选择将是使这个和最小化的值。这个最小值不会在极端值（非常小或非常大的$p$）处，而是在一个中等的、中间值处，此时两个成本达到平衡。如果$p$太小，为达到精度目标，$h$必须非常小，使得FFT成本过高。如果$p$太大，散布/收集成本对$p^3$的依赖性将变得占主导地位且成本过高。因此，最优策略是选择一个中等的$p$，然后确定满足误差约束的相应$h$。\n\n现在我们评估每个选项。\n\n**A. 选择非常大的插值阶数$p$（例如，$p \\ge 10$）...**\n这个选项正确地认识到大的$p$允许使用更粗糙的网格，从而降低FFT成本。然而，它错误地声称增加$p$“几乎不改变总运行时间”。它完全忽略了与$p^3$成比例的散布/收集成本。对于大的$p$，这个成本会变得非常大，并且很容易主导总成本。例如，将$p$从一个中等值如$5$增加到一个大值如$10$，会使这个成本部分增加$(10/5)^3 = 8$倍，这是一个巨大的变化。因此，这个策略是次优的。\n**结论：不正确。**\n\n**B. 选择尽可能小的插值阶数$p$（例如，$p=3$）...**\n这个选项建议使用最小的$p$，例如$p=3$（三次样条）。为了用低阶样条实现高精度，必须使用非常精细的网格（非常小的$h$）。这会导致非常大的网格点数$M \\approx (L/h)^3$，使得FFT成本$C_{\\text{FFT}} \\propto M \\log M$变得极其巨大。断言“减小$h$总是比增加$p$更便宜”是根本错误的。它忽略了通过使用稍大的$p$可以在FFT部分实现的显著成本节省，因为这允许使用更粗糙得多的网格。这个策略也是次优的，特别是对于高精度计算。\n**结论：不正确。**\n\n**C. 选择一个中等的插值阶数$p$（例如，$p$在$4$到$6$的范围内）...**\n这个选项正确地将问题框定为一个优化任务，以平衡两个相互竞争的成本。它准确地指出了散布/收集成本随$p$增加（如$p^3$），而FFT成本随$p$减小（对于固定的精度，因为$h$可以取得更大）。合乎逻辑的结论是，存在一个最优的、中等的$p$值，可以最小化这两个成本的和。一旦选定了这个中等的$p$，$h$就由精度要求确定。建议的$p$范围从$4$到$6$（四次到六次样条）与经验研究的已知结果一致，并且在实践中通常用于实现最佳平衡。这个陈述提供了对优化准则的完整和正确的描述。\n**结论：正确。**\n\n**D. 保持网格间距$h$由盒子维度$L$固定...**\n这个选项是有缺陷的，因为它从优化过程中移除了一个关键的调节参数$h$。网格间距$h$是一个非常有效的调节精度和成本的参数，因为误差的缩放关系是$h^p$，而FFT成本的缩放关系是$(1/h)^3$。任意固定$h$会导致次优解。如果固定的$h$太大，就需要一个不切实际的大$p$，导致过度的散布/收集成本。如果固定的$h$太小，FFT成本将不必要地高。前提“$h$不是一个有效的调节参数”在事实上是不正确的。\n**结论：不正确。**\n\n分析证实，最恰当的准则是认识到散布/收集成本和FFT成本之间的权衡，从而选择一个中等的插值阶数$p$和相应的网格间距$h$。",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}