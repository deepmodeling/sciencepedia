{
    "hands_on_practices": [
        {
            "introduction": "To truly understand Root Mean Square Fluctuation (RMSF), we must first connect it to its physical origins. The flexibility of an atom is not arbitrary; it is a direct consequence of thermal energy causing motion against the restoring forces of the local chemical environment. This foundational exercise  bridges the gap between the abstract concept of RMSF and the concrete principles of statistical mechanics. By deriving the RMSF for an idealized harmonic oscillator, you will establish a clear, analytical relationship between an atom's fluctuation, the system's temperature $T$, and the stiffness of its potential, represented by the force constant $k$.",
            "id": "3868675",
            "problem": "In computational chemical biology, root-mean-square fluctuation (RMSF) is used to quantify the amplitude of per-atom positional fluctuations along a trajectory, while root-mean-square deviation (RMSD) aggregates deviations for many atoms against a reference structure. Consider a single Cartesian coordinate $x$ of a protein atom that fluctuates near an equilibrium position $x_{0}$ under a one-dimensional harmonic potential $U(x) = \\frac{1}{2} k \\left(x - x_{0}\\right)^{2}$, where $k$ is a force constant. The system is at absolute temperature $T$ and exchanges energy with a thermal reservoir, so it is described by the canonical ensemble. A long, ergodic molecular dynamics trajectory provides samples $x(t)$ such that time averages equal ensemble averages.\n\nStarting from the canonical distribution and the definition of RMSF as the square root of the mean-squared fluctuation about the mean position, derive a closed-form analytic expression for the RMSF in terms of the Boltzmann constant $k_{B}$, the temperature $T$, and the force constant $k$. Your final answer must be a single simplified analytic expression. If you perform any intermediate integrations, justify each step from first principles of equilibrium statistical mechanics. Express your final answer in the same length units as $x$ (no numerical evaluation is required).",
            "solution": "The problem requires the derivation of a closed-form expression for the root-mean-square fluctuation (RMSF) of a single Cartesian coordinate, $x$, of an atom. The atom is subject to a one-dimensional harmonic potential, $U(x)$, and is in thermal equilibrium with a reservoir at temperature $T$. This corresponds to a canonical ensemble in statistical mechanics.\n\nThe problem statement provides the following:\n- Potential energy: $U(x) = \\frac{1}{2} k (x - x_0)^2$, where $k$ is the force constant and $x_0$ is the equilibrium position.\n- The system is described by the canonical ensemble at absolute temperature $T$.\n- The Boltzmann constant is $k_B$.\n- The assumption of ergodicity implies that time averages from a long trajectory are equivalent to ensemble averages.\n\nThe RMSF is defined as the square root of the mean-squared fluctuation of the coordinate about its mean position. Mathematically, this is expressed as:\n$$\n\\text{RMSF} = \\sqrt{\\langle (x - \\langle x \\rangle)^2 \\rangle}\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the ensemble average.\n\nIn the canonical ensemble, the probability density function for the coordinate $x$ follows the Boltzmann distribution:\n$$\nP(x) = \\frac{1}{Z} \\exp(-\\beta U(x))\n$$\nwhere $\\beta = \\frac{1}{k_B T}$ and $Z$ is the partition function, which acts as a normalization constant. The partition function is given by the integral of the Boltzmann factor over all possible states (positions):\n$$\nZ = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x)) \\, dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} (x - x_0)^2\\right) \\, dx\n$$\n\nThe derivation proceeds in two main steps: first, we determine the mean position $\\langle x \\rangle$, and second, we calculate the mean-squared fluctuation about this mean.\n\n**Step 1: Calculation of the Mean Position $\\langle x \\rangle$**\n\nThe mean position $\\langle x \\rangle$ is the expectation value of $x$, calculated as:\n$$\n\\langle x \\rangle = \\int_{-\\infty}^{\\infty} x P(x) \\, dx = \\frac{\\int_{-\\infty}^{\\infty} x \\exp\\left(-\\frac{\\beta k}{2} (x - x_0)^2\\right) \\, dx}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} (x - x_0)^2\\right) \\, dx}\n$$\nTo evaluate these integrals, we perform a change of variables. Let $y = x - x_0$, which implies $x = y + x_0$ and $dx = dy$. The limits of integration from $-\\infty$ to $\\infty$ for $x$ remain the same for $y$.\n$$\n\\langle x \\rangle = \\frac{\\int_{-\\infty}^{\\infty} (y + x_0) \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}\n$$\nWe can split the numerator into two parts:\n$$\n\\langle x \\rangle = \\frac{\\int_{-\\infty}^{\\infty} y \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy + \\int_{-\\infty}^{\\infty} x_0 \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}\n$$\nThe first integral in the numerator, $\\int_{-\\infty}^{\\infty} y \\exp(-\\frac{\\beta k}{2} y^2) \\, dy$, has an integrand that is an odd function (a product of an odd function, $y$, and an even function, $\\exp(-\\text{const} \\cdot y^2)$). The integral of an odd function over a symmetric interval $(-\\infty, \\infty)$ is zero.\nThe second integral in the numerator is $x_0 \\int_{-\\infty}^{\\infty} \\exp(-\\frac{\\beta k}{2} y^2) \\, dy$.\nTherefore, the expression for $\\langle x \\rangle$ simplifies to:\n$$\n\\langle x \\rangle = \\frac{0 + x_0 \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy} = x_0\n$$\nThis confirms the physically intuitive result that the average position is the equilibrium position $x_0$ for a symmetric harmonic potential.\n\n**Step 2: Calculation of the Mean-Squared Fluctuation $\\langle (x - \\langle x \\rangle)^2 \\rangle$**\n\nWith $\\langle x \\rangle = x_0$, the mean-squared fluctuation is $\\langle (x - x_0)^2 \\rangle$. This is the variance of the position, $\\sigma_x^2$.\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{\\int_{-\\infty}^{\\infty} (x - x_0)^2 \\exp\\left(-\\frac{\\beta k}{2} (x - x_0)^2\\right) \\, dx}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} (x - x_0)^2\\right) \\, dx}\n$$\nUsing the same substitution $y = x - x_0$:\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{\\int_{-\\infty}^{\\infty} y^2 \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} y^2\\right) \\, dy}\n$$\nLet's define the constant $\\alpha = \\frac{\\beta k}{2}$. The expression becomes:\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{\\int_{-\\infty}^{\\infty} y^2 \\exp(-\\alpha y^2) \\, dy}{\\int_{-\\infty}^{\\infty} \\exp(-\\alpha y^2) \\, dy}\n$$\nThese are standard forms of Gaussian integrals. Let's denote them as $I_2 = \\int_{-\\infty}^{\\infty} y^2 \\exp(-\\alpha y^2) \\, dy$ and $I_0 = \\int_{-\\infty}^{\\infty} \\exp(-\\alpha y^2) \\, dy$.\nThe value of the standard Gaussian integral $I_0$ is:\n$$\nI_0 = \\sqrt{\\frac{\\pi}{\\alpha}}\n$$\nThe integral $I_2$ can be obtained from $I_0$ by differentiating with respect to the parameter $\\alpha$:\n$$\n\\frac{dI_0}{d\\alpha} = \\frac{d}{d\\alpha} \\int_{-\\infty}^{\\infty} \\exp(-\\alpha y^2) \\, dy = \\int_{-\\infty}^{\\infty} \\frac{\\partial}{\\partial\\alpha} \\exp(-\\alpha y^2) \\, dy = \\int_{-\\infty}^{\\infty} (-y^2) \\exp(-\\alpha y^2) \\, dy = -I_2\n$$\nSo, $I_2 = -\\frac{dI_0}{d\\alpha}$. Differentiating the expression for $I_0$:\n$$\nI_2 = - \\frac{d}{d\\alpha} \\left(\\sqrt{\\pi} \\alpha^{-1/2}\\right) = - \\sqrt{\\pi} \\left(-\\frac{1}{2} \\alpha^{-3/2}\\right) = \\frac{\\sqrt{\\pi}}{2} \\alpha^{-3/2} = \\frac{1}{2\\alpha} \\sqrt{\\frac{\\pi}{\\alpha}} = \\frac{I_0}{2\\alpha}\n$$\nNow we can compute the ratio $\\frac{I_2}{I_0}$:\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{I_2}{I_0} = \\frac{I_0 / (2\\alpha)}{I_0} = \\frac{1}{2\\alpha}\n$$\nSubstituting back the expression for $\\alpha = \\frac{\\beta k}{2}$:\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{1}{2 \\left(\\frac{\\beta k}{2}\\right)} = \\frac{1}{\\beta k}\n$$\nFinally, substituting $\\beta = \\frac{1}{k_B T}$:\n$$\n\\langle (x - x_0)^2 \\rangle = \\frac{k_B T}{k}\n$$\nThis result is consistent with the equipartition theorem, which states that each quadratic degree of freedom in the energy contributes an average of $\\frac{1}{2} k_B T$ to the total energy. For the potential energy $U(x)$, we have $\\langle U(x) \\rangle = \\langle \\frac{1}{2} k (x-x_0)^2 \\rangle = \\frac{1}{2} k \\langle (x-x_0)^2 \\rangle = \\frac{1}{2} k_B T$, which directly yields $\\langle (x-x_0)^2 \\rangle = \\frac{k_B T}{k}$.\n\n**Step 3: Final Calculation of RMSF**\n\nThe RMSF is the square root of the mean-squared fluctuation:\n$$\n\\text{RMSF} = \\sqrt{\\langle (x - x_0)^2 \\rangle} = \\sqrt{\\frac{k_B T}{k}}\n$$\nThis is the final closed-form analytic expression for the RMSF of a coordinate fluctuating under a harmonic potential at temperature $T$. The units are consistent, as $k_B T$ has units of energy (e.g., Joules) and $k$ has units of energy per length squared (e.g., Joules/meter$^2$), so the ratio has units of length squared, and its square root has units of length, as required.",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{k_B T}{k}}}\n$$"
        },
        {
            "introduction": "Moving from theory to practice, we encounter the raw complexities of molecular dynamics simulation data. A common feature, periodic boundary conditions (PBC), is efficient for simulations but can produce coordinates where a single molecule appears fragmented across the boundaries of the simulation box. This creates large, artificial distances between atoms that are chemically bonded, making naive calculations of geometric properties like RMSD meaningless. This hands-on practice  challenges you to develop and implement a coordinate \"unwrapping\" algorithm, an essential data-processing step that restores the physical integrity of the molecule, thereby enabling accurate and meaningful trajectory analysis.",
            "id": "3868658",
            "problem": "You are given a scenario from computational chemical biology in which molecular dynamics trajectories are recorded under periodic boundary conditions. The simulated system is a three-dimensional orthorhombic periodic box, and recorded coordinates are \"wrapped\" into the primary image of the unit cell. You must explain using first principles why periodic boundary conditions necessitate unwrapping or imaging corrections before aligning coordinates and computing Root Mean Square Deviation (RMSD) and Root Mean Square Fluctuation (RMSF), and then implement a robust unwrapping algorithm. Finally, you must compute RMSD and RMSF for a small test suite of wrapped trajectories and demonstrate the effect of unwrapping.\n\nBegin from the following foundational base:\n- The periodic box is a lattice defined by side lengths $\\mathbf{L} = (L_x, L_y, L_z)$ in nanometers; coordinates obey equivalence modulo $\\mathbf{L}$, i.e., two positions $\\mathbf{r}$ and $\\mathbf{r} + n_x L_x \\hat{\\mathbf{x}} + n_y L_y \\hat{\\mathbf{y}} + n_z L_z \\hat{\\mathbf{z}}$ for integers $n_x, n_y, n_z$ represent the same physical point in the periodic sense.\n- The Euclidean distance in three dimensions is defined by $\\|\\mathbf{a} - \\mathbf{b}\\| = \\sqrt{(a_x - b_x)^2 + (a_y - b_y)^2 + (a_z - b_z)^2}$.\n- The best-fit rigid alignment (rotation and translation) between two sets of points minimizes the sum of squared Euclidean distances between corresponding points, under the constraint that the transformation is a rotation in special orthogonal group $\\mathrm{SO}(3)$ followed by a translation.\n- The Root Mean Square Deviation (RMSD) between two conformations with $N$ atoms is the square root of the mean of squared distances between corresponding atoms after optimal alignment.\n- The Root Mean Square Fluctuation (RMSF) of one atom over a trajectory is the square root of the mean of squared distances of that atom from its time-averaged position (after removing global rotations and translations by alignment).\n\nYour tasks:\n1. Explain, starting from the above fundamental base, why wrapped coordinates under periodic boundary conditions can cause erroneous distances and misalignment if unwrapping or imaging corrections are not applied prior to RMSD and RMSF computation.\n2. Propose and implement an algorithm that robustly unwraps coordinates frame-by-frame, preserving continuity and internal geometry. The algorithm must use connectivity (a bonded graph between atoms) to propagate imaging corrections across the molecule and use the minimum image convention to choose the nearest periodic image for continuity.\n3. Align each trajectory frame to the first frame using an optimal rigid rotation and translation derived from minimizing the sum of squared distances, and compute:\n   - The mean RMSD over frames $t = 1,\\dots,T-1$ relative to the reference frame $t = 0$.\n   - The mean RMSF over atoms, computed from aligned coordinates across all frames $t = 0,\\dots,T-1$.\n4. Perform the above computations once using raw wrapped coordinates (no unwrapping), and once using your unwrapped coordinates. Report both sets of results for each test case.\n\nPhysical units:\n- All coordinates and box lengths are in nanometers. RMSD and RMSF must be reported in nanometers, as floating-point numbers.\n\nAngle unit:\n- Any periodic modulations you use for synthetic vibrations must use radians in trigonometric functions.\n\nTest suite:\nImplement your program to use the following three test cases of synthetic trajectories. Each test case defines the number of atoms $N$, the number of frames $T$, the box lengths $\\mathbf{L}$, an initial configuration $\\mathbf{r}_i(0)$ for atom index $i$, a constant drift per frame $\\mathbf{d}$, and small per-frame vibrations $\\boldsymbol{\\epsilon}_{i}(t)$. The unwrapped coordinates are defined by\n$$\n\\mathbf{r}_i(t) = \\mathbf{r}_i(0) + t\\,\\mathbf{d} + \\boldsymbol{\\epsilon}_{i}(t),\n$$\nand the wrapped coordinates recorded are\n$$\n\\mathbf{w}_i(t) = \\mathbf{r}_i(t) \\bmod \\mathbf{L},\n$$\nwhere the modulo operation is applied component-wise to map positions into the interval $[0,L_\\alpha)$ for each axis $\\alpha \\in \\{x,y,z\\}$.\n\nPer-frame vibrations are defined by\n$$\n\\boldsymbol{\\epsilon}_{i}(t) = \\left(0,\\; 0.01 \\sin\\left(\\frac{2\\pi t}{T} + i\\right),\\; 0.005 \\cos\\left(\\frac{2\\pi t}{T} + \\frac{i}{2}\\right)\\right),\n$$\nwith all quantities in nanometers and radians.\n\nFor each test, provide the bonded connectivity as an undirected edge list that forms a chain.\n\n- Test Case A (happy path drift across $x$-boundary):\n  - $N = 3$, $T = 6$, $\\mathbf{L} = (3.0, 3.0, 3.0)$.\n  - Initial positions: $\\mathbf{r}_0(0) = (0.40, 0.40, 0.20)$, $\\mathbf{r}_1(0) = (0.52, 0.40, 0.20)$, $\\mathbf{r}_2(0) = (0.64, 0.40, 0.20)$.\n  - Drift per frame: $\\mathbf{d} = (0.80, 0.00, 0.00)$.\n  - Connectivity: edges $(0,1)$, $(1,2)$.\n\n- Test Case B (drift across $y$-boundary with mild internal vibrations):\n  - $N = 5$, $T = 8$, $\\mathbf{L} = (2.5, 2.5, 2.5)$.\n  - Initial positions: $\\mathbf{r}_0(0) = (0.30, 1.80, 0.30)$, $\\mathbf{r}_1(0) = (0.30, 1.90, 0.30)$, $\\mathbf{r}_2(0) = (0.30, 2.00, 0.30)$, $\\mathbf{r}_3(0) = (0.30, 2.10, 0.30)$, $\\mathbf{r}_4(0) = (0.30, 2.20, 0.30)$.\n  - Drift per frame: $\\mathbf{d} = (0.00, -0.60, 0.00)$.\n  - Connectivity: edges $(0,1)$, $(1,2)$, $(2,3)$, $(3,4)$.\n\n- Test Case C (near half-box jump in $x$ to probe rounding robustness):\n  - $N = 4$, $T = 7$, $\\mathbf{L} = (3.0, 3.0, 3.0)$.\n  - Initial positions: $\\mathbf{r}_0(0) = (0.10, 0.50, 0.10)$, $\\mathbf{r}_1(0) = (0.23, 0.50, 0.10)$, $\\mathbf{r}_2(0) = (0.36, 0.50, 0.10)$, $\\mathbf{r}_3(0) = (0.49, 0.50, 0.10)$.\n  - Drift per frame: $\\mathbf{d} = (1.49, 0.00, 0.00)$.\n  - Connectivity: edges $(0,1)$, $(1,2)$, $(2,3)$.\n\nRequired computations:\n- For each test case, compute four floats in nanometers:\n  1. Mean RMSD using wrapped coordinates, aligned to the wrapped frame $t=0$.\n  2. Mean RMSD using unwrapped coordinates, aligned to the unwrapped frame $t=0$.\n  3. Mean RMSF (averaged over atoms) using wrapped coordinates after alignment.\n  4. Mean RMSF (averaged over atoms) using unwrapped coordinates after alignment.\n\nOutput format:\n- Your program should produce a single line of output containing the results for the three test cases as a comma-separated list of lists enclosed in square brackets; each inner list must be ordered as specified above for the four floats. For example: \"[[a,b,c,d],[e,f,g,h],[i,j,k,l]]\". All values must be floats in nanometers.\n\nNo external input:\n- Your program must be self-contained, generate the test cases as specified, and print the result line exactly as described, with no additional text. The alignment must be performed by minimizing the sum of squared distances under a rotation in $\\mathrm{SO}(3)$ and a translation, and the unwrapping must use connectivity and the minimum image convention to enforce continuity and internal geometry.\n\nExpress units in nanometers for all reported quantities. Do not include percentage signs; any ratios must be reported as decimal numbers if present.",
            "solution": "The problem presented is valid, scientifically grounded in the principles of computational biophysics, and well-posed with sufficient information for a unique solution. We will proceed with a detailed, step-by-step resolution.\n\nThe core of this problem lies in the disconnect between the mathematical formalism of structural comparison metrics like Root Mean Square Deviation (RMSD) and Root Mean Square Fluctuation (RMSF), which assume a contiguous object in Euclidean space, and the computational convenience of periodic boundary conditions (PBC) in simulations, which \"wrap\" coordinates into a primary box, thus breaking this contiguity.\n\n### 1. The Necessity of Unwrapping for RMSD and RMSF Calculation\n\nLet us begin from the foundational definitions. RMSD and RMSF are measures of structural similarity and atomic mobility, respectively. Both rely fundamentally on the Euclidean distance, $\\|\\mathbf{a} - \\mathbf{b}\\|$, between atomic positions.\n\nThe RMSD between two conformations, $A$ and $B$, each with $N$ atoms, is calculated after finding an optimal rigid-body transformation (rotation $R \\in \\mathrm{SO}(3)$ and translation $\\mathbf{v}$) that minimizes the sum of squared distances between corresponding atoms. The RMSD is then:\n$$\n\\text{RMSD}(A, B) = \\min_{R, \\mathbf{v}} \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} \\| (R\\mathbf{r}_{i,A} + \\mathbf{v}) - \\mathbf{r}_{i,B} \\|^2}\n$$\nThe RMSF of an atom $i$ over a trajectory of $T$ frames is the square root of its mean squared displacement from its average position, after the entire trajectory has been aligned to a common reference frame to remove global translation and rotation:\n$$\n\\text{RMSF}_i = \\sqrt{\\frac{1}{T} \\sum_{t=0}^{T-1} \\| \\mathbf{r}'_i(t) - \\langle \\mathbf{r}'_i \\rangle \\|^2}\n$$\nwhere $\\mathbf{r}'_i(t)$ are the coordinates of atom $i$ in frame $t$ after alignment, and $\\langle\\mathbf{r}'_i\\rangle$ is its time-averaged position.\n\nNow, consider a molecular dynamics simulation employing a periodic box of side lengths $\\mathbf{L} = (L_x, L_y, L_z)$. When an atom crosses a boundary, its coordinates are \"wrapped\" back into the primary box, typically in the range $[0, L_\\alpha)$ for each axis $\\alpha \\in \\{x, y, z\\}$. For example, an atom moving from $x=L_x - \\delta$ to $x=L_x + \\delta$ (where $\\delta$ is small) will have its recorded coordinate jump from $L_x - \\delta$ to $\\delta$.\n\nThis wrapping procedure has two catastrophic consequences for RMSD and RMSF calculations if not corrected:\n\n1.  **Distortion of Internal Geometry**: Consider two bonded atoms, $i$ and $j$, with a small bond length. If the molecule drifts such that atom $i$ is at $x_i \\approx 0$ and atom $j$ has crossed the boundary to $x_j \\approx L_x$, their true separation is small. However, the naive Euclidean distance calculated from their wrapped coordinates, $\\|\\mathbf{w}_i - \\mathbf{w}_j\\|$, will be large, approaching $L_x$. This artifactually breaks the molecule's apparent structure. The alignment algorithm, which seeks to minimize the sum of these squared distances, will be presented with what appears to be a grotesquely distorted structure. It will fail to find a meaningful superposition, leading to an exceptionally large and incorrect RMSD value that reflects properties of the box size rather than true conformational change.\n\n2.  **Corruption of Temporal Averages**: For RMSF, an atom's coordinates over time are averaged. If an atom's true trajectory is continuous but crosses a boundary, its wrapped coordinates will exhibit large, instantaneous jumps (e.g., from $L_y-\\delta$ to $\\delta$). The average of these jumping coordinates, $\\langle \\mathbf{w}_i \\rangle$, will not represent a physically meaningful central position. Instead, it will be biased towards the center of the box. Consequently, the calculated fluctuations of $\\mathbf{w}_i(t)$ around this erroneous average, $\\|\\mathbf{w}_i(t) - \\langle \\mathbf{w}_i \\rangle\\|^2$, will be enormous and dominated by the artificial wrapping events, not by the true physical vibrations of the atom.\n\nTherefore, it is an absolute prerequisite to \"unwrap\" the trajectory, or at least apply imaging corrections, to restore a physically contiguous representation of the molecule in Euclidean space before any alignment, RMSD, or RMSF analysis can be performed.\n\n### 2. An Algorithm for Coordinate Unwrapping\n\nA robust unwrapping algorithm must achieve two goals: (1) maintain the internal geometric integrity of the molecular structure, and (2) preserve the temporal continuity of the molecule's overall motion. The following algorithm uses the molecule's bonded connectivity and the minimum image convention (MIC) to achieve this.\n\nThe MIC states that the true vector between two points $\\mathbf{a}$ and $\\mathbf{b}$ in a periodic box of lengths $\\mathbf{L}$ is the one connecting $\\mathbf{a}$ to the closest periodic image of $\\mathbf{b}$. This vector, $\\Delta\\mathbf{r}_{\\text{mic}}$, is calculated as:\n$$\n\\Delta\\mathbf{r}_{\\text{mic}}(\\mathbf{a}, \\mathbf{b}) = (\\mathbf{a} - \\mathbf{b}) - \\mathbf{L} \\odot \\text{round}\\left(\\frac{\\mathbf{a} - \\mathbf{b}}{\\mathbf{L}}\\right)\n$$\nwhere $\\odot$ denotes component-wise multiplication and the division and rounding are also component-wise.\n\nThe unwrapping proceeds frame-by-frame, using the previously unwrapped frame as a reference for the current one. Let $\\mathbf{W}(t)$ be the wrapped trajectory and $\\mathbf{R}(t)$ be the unwrapped trajectory to be constructed.\n\n**Algorithm: Frame-by-Frame Unwrapping**\n1.  **Initialization**: The first frame requires no unwrapping. Set $\\mathbf{R}_i(0) = \\mathbf{W}_i(0)$ for all atoms $i=0, \\dots, N-1$.\n2.  **Iteration**: For each subsequent frame $t=1, \\dots, T-1$:\n    a.  Let $\\mathbf{R}_{\\text{prev}}$ be the unwrapped coordinates from frame $t-1$, and $\\mathbf{W}_{\\text{curr}}$ be the wrapped coordinates from frame $t$.\n    b.  **Seed Atom Continuity**: Select a single \"seed\" atom (e.g., atom $0$). Its unwrapped position in the new frame is determined by assuming its motion from the previous frame was continuous. We calculate the minimum image of its displacement vector:\n        -   Displacement in wrapped space: $\\Delta\\mathbf{w}_0 = \\mathbf{W}_0(t) - \\mathbf{R}_0(t-1)$.\n        -   Minimum image displacement: $\\Delta\\mathbf{r}'_0 = \\Delta\\mathbf{w}_0 - \\mathbf{L} \\odot \\text{round}(\\Delta\\mathbf{w}_0 / \\mathbf{L})$.\n        -   Set the seed atom's new unwrapped position: $\\mathbf{R}_0(t) = \\mathbf{R}_0(t-1) + \\Delta\\mathbf{r}'_0$.\n    c.  **Propagate via Connectivity**: Reconstruct the rest of the molecule around the newly placed seed atom. This is done by traversing the bonded connectivity graph (e.g., using a Breadth-First Search or Depth-First Search starting from the seed atom).\n        -   Initialize a queue for the traversal with the seed atom and a set of visited atoms.\n        -   While the queue is not empty, dequeue an atom $i$ whose position $\\mathbf{R}_i(t)$ is known.\n        -   For each bonded neighbor $j$ of $i$ that has not been visited:\n            i.  Calculate the vector between $j$ and $i$ in the current wrapped frame: $\\Delta\\mathbf{w}_{ji} = \\mathbf{W}_j(t) - \\mathbf{W}_i(t)$.\n            ii. Apply MIC to find the correct bond vector, connecting to the nearest image of atom $j$: $\\Delta\\mathbf{r}'_{ji} = \\Delta\\mathbf{w}_{ji} - \\mathbf{L} \\odot \\text{round}(\\Delta\\mathbf{w}_{ji} / \\mathbf{L})$.\n            iii. Set the unwrapped position of atom $j$: $\\mathbf{R}_j(t) = \\mathbf{R}_i(t) + \\Delta\\mathbf{r}'_{ji}$.\n            iv. Mark $j$ as visited and add it to the queue.\n3.  The resulting sequence of coordinates $\\mathbf{R}(t)$ constitutes the fully unwrapped trajectory, representing a continuous path in an infinite Euclidean space, with all internal covalent geometry preserved.\n\n### 3. Alignment and Analysis Procedure\n\nWith a valid (unwrapped) trajectory, we can proceed with the analysis.\n\n**Alignment**: The optimal rigid-body rotation is found using the Kabsch algorithm, which is based on Singular Value Decomposition (SVD). To align a \"mobile\" set of coordinates $A$ to a \"reference\" set $B$:\n1.  Translate both sets of coordinates to their respective centroids: $A' = A - \\mathbf{c}_A$ and $B' = B - \\mathbf{c}_B$.\n2.  Compute the $3 \\times 3$ covariance matrix $H = (A')^T B'$.\n3.  Perform SVD on $H$: $H = U S V^T$.\n4.  The optimal rotation matrix is $R = V U^T$. A check must be performed to ensure $R$ is a proper rotation ($\\det(R)=+1$) and not a reflection. If $\\det(R)=-1$, the sign of the column of $V$ corresponding to the smallest singular value is flipped before recomputing $R$.\n5.  The mobile coordinates are then rotated: $A'' = A' R$.\n\n**RMSD Calculation**:\n- For each frame $t \\in \\{1, \\dots, T-1\\}$, the coordinates $\\mathbf{X}(t)$ are aligned to the reference frame $\\mathbf{X}(0)$.\n- The centered coordinates are computed: $\\mathbf{X}'(t) = \\mathbf{X}(t) - \\mathbf{c}(t)$ and $\\mathbf{X}'(0) = \\mathbf{X}(0) - \\mathbf{c}(0)$.\n- The rotation matrix $R_t$ is found via the Kabsch algorithm.\n- The RMSD for that frame is $\\text{RMSD}(t) = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\| (\\mathbf{X}'(t)R_t)_i - \\mathbf{X}'_i(0) \\|^2}$.\n- The final reported value is the mean of these values: $\\langle \\text{RMSD} \\rangle = \\frac{1}{T-1}\\sum_{t=1}^{T-1}\\text{RMSD}(t)$.\n\n**RMSF Calculation**:\n- An entire trajectory, $\\mathbf{X}(0), \\dots, \\mathbf{X}(T-1)$, is aligned to the single reference frame $\\mathbf{X}(0)$. This produces a trajectory of aligned structures, $\\mathbf{X}''(0), \\dots, \\mathbf{X}''(T-1)$, where each frame has been centered and optimally rotated.\n- For each atom $i$, its time-averaged position is computed from this aligned trajectory: $\\langle \\mathbf{x}''_i \\rangle = \\frac{1}{T}\\sum_{t=0}^{T-1} \\mathbf{x}''_i(t)$.\n- The RMSF for atom $i$ is then $\\text{RMSF}_i = \\sqrt{\\frac{1}{T}\\sum_{t=0}^{T-1} \\| \\mathbf{x}''_i(t) - \\langle \\mathbf{x}''_i \\rangle \\|^2}$.\n- The final reported value is the mean RMSF over all atoms: $\\langle \\text{RMSF} \\rangle = \\frac{1}{N}\\sum_{i=0}^{N-1}\\text{RMSF}_i$.\n\nThe implementation will perform these calculations twice for each test case: once using the raw, wrapped coordinates and once using the coordinates produced by our unwrapping algorithm. As hypothesized, the results will demonstrate a drastic difference, highlighting the critical importance of the unwrapping step.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 3, \"T\": 6, \"L\": np.array([3.0, 3.0, 3.0]),\n            \"r0\": np.array([\n                [0.40, 0.40, 0.20],\n                [0.52, 0.40, 0.20],\n                [0.64, 0.40, 0.20]\n            ]),\n            \"d\": np.array([0.80, 0.00, 0.00]),\n            \"connectivity\": [(0, 1), (1, 2)],\n        },\n        {\n            \"N\": 5, \"T\": 8, \"L\": np.array([2.5, 2.5, 2.5]),\n            \"r0\": np.array([\n                [0.30, 1.80, 0.30],\n                [0.30, 1.90, 0.30],\n                [0.30, 2.00, 0.30],\n                [0.30, 2.10, 0.30],\n                [0.30, 2.20, 0.30]\n            ]),\n            \"d\": np.array([0.00, -0.60, 0.00]),\n            \"connectivity\": [(0, 1), (1, 2), (2, 3), (3, 4)],\n        },\n        {\n            \"N\": 4, \"T\": 7, \"L\": np.array([3.0, 3.0, 3.0]),\n            \"r0\": np.array([\n                [0.10, 0.50, 0.10],\n                [0.23, 0.50, 0.10],\n                [0.36, 0.50, 0.10],\n                [0.49, 0.50, 0.10]\n            ]),\n            \"d\": np.array([1.49, 0.00, 0.00]),\n            \"connectivity\": [(0, 1), (1, 2), (2, 3)],\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, T, L, r0, d, conn_edges = case[\"N\"], case[\"T\"], case[\"L\"], case[\"r0\"], case[\"d\"], case[\"connectivity\"]\n\n        # 1. Generate trajectories\n        unwrapped_traj = np.zeros((T, N, 3))\n        wrapped_traj = np.zeros((T, N, 3))\n        \n        t_vals = np.arange(T)[:, np.newaxis]\n        i_vals = np.arange(N)[np.newaxis, :]\n        \n        eps_y = 0.01 * np.sin(2 * np.pi * t_vals / T + i_vals)\n        eps_z = 0.005 * np.cos(2 * np.pi * t_vals / T + i_vals / 2)\n        epsilon = np.stack([np.zeros((T, N)), eps_y, eps_z], axis=2)\n\n        unwrapped_traj = r0[np.newaxis, :, :] + t_vals[:, :, np.newaxis] * d[np.newaxis, np.newaxis, :] + epsilon\n        wrapped_traj = unwrapped_traj % L\n\n        # 2. Re-create unwrapped trajectory from wrapped one to test the algorithm\n        re_unwrapped_traj = unwrap_trajectory(wrapped_traj, L, conn_edges)\n\n        # 3. Analyze trajectories\n        mean_rmsd_w, mean_rmsf_w = analyze_trajectory(wrapped_traj)\n        mean_rmsd_u, mean_rmsf_u = analyze_trajectory(re_unwrapped_traj)\n\n        all_results.append([mean_rmsd_w, mean_rmsd_u, mean_rmsf_w, mean_rmsf_u])\n\n    # Final print statement in the exact required format.\n    inner_strings = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(inner_strings)}]\")\n\ndef kabsch_align(mobile_coords, ref_coords):\n    \"\"\"\n    Aligns mobile_coords to ref_coords using the Kabsch algorithm and returns the\n    rotated (but not translated) mobile coordinates.\n    \"\"\"\n    # Center coordinates\n    mobile_centroid = np.mean(mobile_coords, axis=0)\n    ref_centroid = np.mean(ref_coords, axis=0)\n    mobile_c = mobile_coords - mobile_centroid\n    ref_c = ref_coords - ref_centroid\n\n    # Covariance matrix\n    H = mobile_c.T @ ref_c\n\n    # SVD\n    U, S, Vt = np.linalg.svd(H)\n    V = Vt.T\n\n    # Calculate rotation matrix, checking for reflection\n    R = V @ U.T\n    if np.linalg.det(R)  0:\n        V[:, -1] *= -1\n        R = V @ U.T\n    \n    # Apply rotation\n    aligned_mobile_c = mobile_c @ R\n    \n    return aligned_mobile_c, ref_c\n\n\ndef analyze_trajectory(traj):\n    \"\"\"\n    Computes mean RMSD and mean RMSF for a given trajectory.\n    \"\"\"\n    T, N, _ = traj.shape\n    ref_frame = traj[0]\n\n    # Mean RMSD calculation (over frames t=1...T-1)\n    rmsd_values = []\n    if T > 1:\n        for t in range(1, T):\n            mobile_frame = traj[t]\n            aligned_mobile_c, ref_c = kabsch_align(mobile_frame, ref_frame)\n            \n            # Sum of squared distances\n            ssd = np.sum((aligned_mobile_c - ref_c)**2)\n            rmsd = np.sqrt(ssd / N)\n            rmsd_values.append(rmsd)\n        mean_rmsd = np.mean(rmsd_values) if rmsd_values else 0.0\n    else:\n        mean_rmsd = 0.0\n\n    # Mean RMSF calculation (over all atoms)\n    aligned_traj_c = np.zeros_like(traj)\n    _, ref_c_for_all = kabsch_align(ref_frame, ref_frame)\n    aligned_traj_c[0] = ref_c_for_all\n    \n    for t in range(1, T):\n        aligned_mobile_c, _ = kabsch_align(traj[t], ref_frame)\n        aligned_traj_c[t] = aligned_mobile_c\n        \n    avg_pos = np.mean(aligned_traj_c, axis=0)\n    sq_displacements = np.sum((aligned_traj_c - avg_pos)**2, axis=2) # Sum over x,y,z\n    msd_per_atom = np.mean(sq_displacements, axis=0) # Average over time\n    rmsf_values = np.sqrt(msd_per_atom)\n    mean_rmsf = np.mean(rmsf_values)\n\n    return mean_rmsd, mean_rmsf\n\n\ndef unwrap_trajectory(wrapped_traj, L, connectivity_edges):\n    \"\"\"\n    Unwraps a trajectory using connectivity and the minimum image convention.\n    \"\"\"\n    T, N, _ = wrapped_traj.shape\n    unwrapped_traj = np.zeros_like(wrapped_traj)\n    unwrapped_traj[0] = wrapped_traj[0]\n\n    # Build adjacency list for connectivity\n    adj = [[] for _ in range(N)]\n    for i, j in connectivity_edges:\n        adj[i].append(j)\n        adj[j].append(i)\n\n    for t in range(1, T):\n        prev_unwrapped = unwrapped_traj[t-1]\n        curr_wrapped = wrapped_traj[t]\n        curr_unwrapped = np.zeros_like(curr_wrapped)\n        \n        visited = [False] * N\n        q = deque()\n\n        # 1. Place seed atom (atom 0) based on temporal continuity\n        seed_atom = 0\n        delta = curr_wrapped[seed_atom] - prev_unwrapped[seed_atom]\n        shift = L * np.round(delta / L)\n        delta_mic = delta - shift\n        curr_unwrapped[seed_atom] = prev_unwrapped[seed_atom] + delta_mic\n        \n        visited[seed_atom] = True\n        q.append(seed_atom)\n\n        # 2. Propagate unwrapping through the molecule via BFS\n        while q:\n            i = q.popleft()\n            for j in adj[i]:\n                if not visited[j]:\n                    delta_ij = curr_wrapped[j] - curr_wrapped[i]\n                    shift_ij = L * np.round(delta_ij / L)\n                    delta_ij_mic = delta_ij - shift_ij\n                    curr_unwrapped[j] = curr_unwrapped[i] + delta_ij_mic\n                    \n                    visited[j] = True\n                    q.append(j)\n        \n        unwrapped_traj[t] = curr_unwrapped\n        \n    return unwrapped_traj\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```\n```"
        },
        {
            "introduction": "With the ability to correctly calculate RMSD and RMSF, the final and most critical skill is interpretation. While both metrics quantify atomic motion, they describe fundamentally different aspects of a system's dynamics, and confusing them can lead to incorrect biological conclusions. This exercise  presents a classic scenario of a protein undergoing a large-scale conformational change to sharpen your conceptual understanding. By analyzing this case, you will learn to distinguish the signature of an instantaneous deviation from a static reference ($RMSD(t)$) from that of a time-averaged fluctuation around a dynamic mean ($RMSF_i$), a key step toward decoding the story of molecular motion told by a trajectory.",
            "id": "3868684",
            "problem": "A protein of $N=300$ residues comprises two rigid domains connected by a hinge spanning residues $i \\in [95,115]$. In a molecular dynamics simulation at $300\\,\\mathrm{K}$ over $300\\,\\mathrm{ns}$, the protein undergoes a single, slow conformational transition from state $\\mathcal{A}$ (initial conformation at $t=0$) to state $\\mathcal{B}$, characterized by a relative rotation of the second domain by approximately $30^\\circ$ about the hinge, with negligible intrastate vibrations within each domain away from the hinge. Investigators compute two observables: the time-dependent root mean square deviation ($RMSD(t)$) of $C_{\\alpha}$ atoms relative to the initial structure $\\mathcal{A}$ after optimal global rigid-body superposition at each time $t$, and the per-residue root mean square fluctuation ($RMSF_i$) of $C_{\\alpha}$ atoms over the full $300\\,\\mathrm{ns}$ trajectory after the same global superposition, where $RMSF_i$ measures the time-averaged positional fluctuation of residue $i$ around its temporal mean position.\n\nAssume that the transition is slow and occurs once, with the system dwelling in state $\\mathcal{A}$ for an extended initial period and in state $\\mathcal{B}$ for the remaining time, and that intrastate thermal vibrations away from the hinge are small compared to the displacement between the two states. Which of the following statements best capture the expected behaviors of $RMSD(t)$ and $RMSF_i$ under these conditions and correctly distinguish between instantaneous deviation and time-averaged fluctuation?\n\nA. $RMSD(t)$ relative to $\\mathcal{A}$ will remain near zero while the system dwells in $\\mathcal{A}$, then increase gradually to a higher plateau after the transition, potentially with a sigmoidal profile if the transition is slow; $RMSF_i$ computed over the full trajectory will be largest in the hinge residues and in the moving domain because their time-averaged positions lie between the two states, yielding large fluctuations.\n\nB. Under global superposition to the initial reference, rigid-body rotation of one domain does not change $RMSD(t)$ because the superposition removes all rotational differences, so $RMSD(t)$ stays near zero throughout.\n\nC. If the transition is slow and occurs only once, $RMSF_i$ in the stationary domain will be nearly zero, and $RMSF_i$ in the moving domain will also be small because $RMSF_i$ captures only fast intrastate vibrations and not occupancy of distinct states.\n\nD. A residue that alternates between two well-separated positions with negligible intrastate vibration will exhibit large $RMSF_i$ over the full trajectory, approximately proportional to the separation between its positions in $\\mathcal{A}$ and $\\mathcal{B}$; at the same time, its contribution to $RMSD(t)$ can be small at early times when the system remains in $\\mathcal{A}$.\n\nE. Segmenting the trajectory into basins (time windows confined to $\\mathcal{A}$ or $\\mathcal{B}$) and computing $RMSF_i$ within each basin will reduce contributions from the transition, revealing low intrastate flexibility in the rigid domains; in contrast, $RMSD(t)$ computed across the full trajectory remains a sensitive indicator of the conformational transition with respect to $\\mathcal{A}$.",
            "solution": "The user wants me to validate and solve a problem in computational chemical biology concerning the analysis of a molecular dynamics trajectory.\n\n### Step 1: Extract Givens\n- Protein size: $N=300$ residues.\n- Structure: Two rigid domains connected by a hinge.\n- Hinge residues: $i \\in [95, 115]$.\n- Simulation conditions: Molecular dynamics (MD) at $T=300\\,\\mathrm{K}$ for a total duration of $300\\,\\mathrm{ns}$.\n- Conformational change: A single, slow transition from state $\\mathcal{A}$ (initial conformation at $t=0$) to state $\\mathcal{B}$.\n- Nature of transition: Relative rotation of the second domain by approximately $30^\\circ$ about the hinge.\n- Domain properties: Intrastate vibrations within each rigid domain (away from the hinge) are negligible/small compared to the displacement between states $\\mathcal{A}$ and $\\mathcal{B}$.\n- Dwelling times: The system dwells in state $\\mathcal{A}$ for an extended initial period and in state $\\mathcal{B}$ for the remaining time.\n- Observable 1: $RMSD(t)$, the time-dependent root mean square deviation of C$\\alpha$ atoms. It is calculated at each time $t$ relative to the initial structure $\\mathcal{A}$ after an optimal global rigid-body superposition.\n- Observable 2: $RMSF_i$, the per-residue root mean square fluctuation of C$\\alpha$ atoms. It is calculated over the full $300\\,\\mathrm{ns}$ trajectory after the same global superposition. It measures the time-averaged positional fluctuation of residue $i$ around its own temporal mean position.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a classic scenario in the study of protein dynamics: hinge-bending motion between two domains. The observables, $RMSD$ and $RMSF$, are standard metrics used to quantify conformational changes and flexibility from MD simulations.\n\n- **Scientifically Grounded**: The scenario is based on established principles of protein structure, dynamics, and the methods used to analyze them. Two-domain proteins with hinge motion are common (e.g., kinases, adenylate kinase). $RMSD$ and $RMSF$ are fundamental tools in the field. The setup is scientifically realistic.\n- **Well-Posed**: The problem is clearly defined. The initial conditions, the nature of the motion, and the definitions of the observables are specified, allowing for a unique qualitative prediction of their behavior.\n- **Objective**: The language is precise and uses standard, unambiguous terminology from computational biophysics. Statements are factual and free of subjective content.\n\nThe problem does not exhibit any of the invalidity flags. It is not scientifically unsound, incomplete, contradictory, unrealistic, or ill-posed. It presents a standard conceptual challenge in interpreting trajectory analysis data.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. I will proceed with the derivation and solution.\n\n### Principle-Based Derivation\n\nFirst, let us formalize the definitions of the two observables. Let $\\mathbf{r}_i(t)$ be the coordinate vector of the $C_{\\alpha}$ atom of residue $i$ at time $t$. The reference structure is state $\\mathcal{A}$, with coordinates $\\mathbf{r}_{i, \\text{ref}}$. The total number of residues is $N=300$. The trajectory duration is $\\tau = 300\\,\\mathrm{ns}$.\n\n**Root Mean Square Deviation ($RMSD(t)$)**\nThe $RMSD(t)$ measures the deviation of the conformation at a specific time $t$ from a fixed reference structure. After finding the optimal rotation and translation that superimposes the conformation at time $t$ onto the reference structure $\\mathcal{A}$, the $RMSD(t)$ is calculated as:\n$$ RMSD(t) = \\left[ \\frac{1}{N} \\sum_{i=1}^{N} \\|\\mathbf{r}_i(t) - \\mathbf{r}_{i, \\text{ref}}\\|^2 \\right]^{1/2} $$\nThis is an *instantaneous* measure of structural difference at each time point $t$.\n\n**Root Mean Square Fluctuation ($RMSF_i$)**\nThe $RMSF_i$ measures the fluctuation of a specific residue $i$ around its own average position over the entire trajectory. First, the average position of residue $i$, $\\langle \\mathbf{r}_i \\rangle$, is computed over the whole trajectory (after all frames are globally superimposed on a common reference):\n$$ \\langle \\mathbf{r}_i \\rangle = \\frac{1}{\\tau} \\int_{0}^{\\tau} \\mathbf{r}_i(t) dt $$\nThen, the $RMSF_i$ is the root mean square of the deviations from this average position:\n$$ RMSF_i = \\left[ \\frac{1}{\\tau} \\int_{0}^{\\tau} \\|\\mathbf{r}_i(t) - \\langle \\mathbf{r}_i \\rangle\\|^2 dt \\right]^{1/2} $$\nThis is a *time-averaged* measure of flexibility for each residue $i$.\n\n**Expected Behavior based on the Problem Statement**\n\n1.  **$RMSD(t)$ Behavior**: The reference structure is state $\\mathcal{A}$.\n    - For the initial period when the system is in state $\\mathcal{A}$, the protein's conformation is very similar to the reference. Thus, $RMSD(t)$ will be small, reflecting only minor thermal vibrations.\n    - During the slow transition, one domain moves away from its initial position. The structure at time $t$ becomes progressively more different from $\\mathcal{A}$. Consequently, $RMSD(t)$ will increase. A slow, single transition suggests a sigmoidal or ramp-like increase.\n    - After the transition, the system settles into state $\\mathcal{B}$. State $\\mathcal{B}$ is conformationally distinct from $\\mathcal{A}$ ($30^\\circ$ domain rotation). The global superposition cannot simultaneously align both the stationary and the moved domain perfectly. Therefore, there will be a large, persistent deviation from the reference structure $\\mathcal{A}$. $RMSD(t)$ will plateau at a high value, fluctuating around it due to small vibrations in state $\\mathcal{B}$.\n    - The overall $RMSD(t)$ plot will show a low plateau, followed by a rise, and then a high plateau.\n\n2.  **$RMSF_i$ Behavior**: This is calculated over the entire $300\\,\\mathrm{ns}$ trajectory.\n    - **Stationary Domain Residues**: These residues remain close to their initial positions throughout the simulation. Their position $\\mathbf{r}_i(t)$ shows minimal deviation from their average position $\\langle \\mathbf{r}_i \\rangle$. Thus, their $RMSF_i$ will be low.\n    - **Moving Domain Residues**: These residues occupy a position near $\\mathbf{r}_{i, \\mathcal{A}}$ for part of the trajectory and a distinctly different position near $\\mathbf{r}_{i, \\mathcal{B}}$ for the rest. The average position, $\\langle \\mathbf{r}_i \\rangle$, will be located somewhere *between* a residue's position in state $\\mathcal{A}$ and its position in state $\\mathcal{B}$. For nearly the entire simulation, the residue's instantaneous position $\\mathbf{r}_i(t)$ will be far from this non-physical average position. This large, persistent deviation $\\|\\mathbf{r}_i(t) - \\langle \\mathbf{r}_i \\rangle\\|$ results in a large $RMSF_i$.\n    - **Hinge Residues**: These residues ($i \\in [95, 115]$) are intrinsically flexible to allow the domain motion. They will likely explore a wider range of conformations than the rigid domains, and their positions will change substantially during the transition. Therefore, they are also expected to exhibit high $RMSF_i$ values.\n\n### Option-by-Option Analysis\n\n**A. $RMSD(t)$ relative to $\\mathcal{A}$ will remain near zero while the system dwells in $\\mathcal{A}$, then increase gradually to a higher plateau after the transition, potentially with a sigmoidal profile if the transition is slow; $RMSF_i$ computed over the full trajectory will be largest in the hinge residues and in the moving domain because their time-averaged positions lie between the two states, yielding large fluctuations.**\n- The description of the $RMSD(t)$ profile (low plateau $\\rightarrow$ sigmoidal rise $\\rightarrow$ high plateau) perfectly matches our derivation.\n- The description of the $RMSF_i$ profile correctly identifies that the hinge and moving domain residues will have the largest fluctuations. The provided reason—that the time-averaged positions for the moving domain lie between the two states—is the correct physical explanation for the high $RMSF_i$ values in that region.\n- **Verdict: Correct**\n\n**B. Under global superposition to the initial reference, rigid-body rotation of one domain does not change $RMSD(t)$ because the superposition removes all rotational differences, so $RMSD(t)$ stays near zero throughout.**\n- This statement is fundamentally flawed. An optimal *global* superposition minimizes the RMSD over all $N=300$ atoms. It finds a single rotation/translation for the entire molecule. It cannot simultaneously align a stationary domain and a domain that has rotated relative to it. An internal conformational change, such as a domain rotation, results in an irreducible, non-zero $RMSD$ after any global alignment.\n- **Verdict: Incorrect**\n\n**C. If the transition is slow and occurs only once, $RMSF_i$ in the stationary domain will be nearly zero, and $RMSF_i$ in the moving domain will also be small because $RMSF_i$ captures only fast intrastate vibrations and not occupancy of distinct states.**\n- The claim that \"$RMSF_i$ captures only fast intrastate vibrations\" is false. The mathematical definition of $RMSF_i$ involves an average over the entire trajectory. Any positional variation during that time, including slow transitions between distinct states, contributes to the final value. As derived above, the occupancy of two widespread states leads to a *large* $RMSF_i$ for the moving atoms, not a small one.\n- **Verdict: Incorrect**\n\n**D. A residue that alternates between two well-separated positions with negligible intrastate vibration will exhibit large $RMSF_i$ over the full trajectory, approximately proportional to the separation between its positions in $\\mathcal{A}$ and $\\mathcal{B}$; at the same time, its contribution to $RMSD(t)$ can be small at early times when the system remains in $\\mathcal{A}$.**\n- The first part correctly states that sampling two distinct positions results in a large $RMSF_i$ (which is a time-averaged property). The fluctuation is indeed related to the separation distance between the two positions.\n- The second part correctly states that the contribution of that same residue to $RMSD(t)$ (an instantaneous property) will be small at early times when the protein is in state $\\mathcal{A}$, the reference state. This statement accurately and effectively distinguishes the time-averaged nature of $RMSF_i$ from the instantaneous nature of $RMSD(t)$.\n- **Verdict: Correct**\n\n**E. Segmenting the trajectory into basins (time windows confined to $\\mathcal{A}$ or $\\mathcal{B}$) and computing $RMSF_i$ within each basin will reduce contributions from the transition, revealing low intrastate flexibility in the rigid domains; in contrast, $RMSD(t)$ computed across the full trajectory remains a sensitive indicator of the conformational transition with respect to $\\mathcal{A}$.**\n- This describes a common and valid analysis technique. By calculating $RMSF_i$ only over the portion of the trajectory where the system is in state $\\mathcal{A}$ (or $\\mathcal{B}$), one isolates the intrastate fluctuations. Given the problem states these are small, the resulting $RMSF_i$ values for the rigid domains would indeed be low. This correctly separates the inter-state motion (the transition) from the intra-state motion (vibrations).\n- The contrast with $RMSD(t)$ is also correct. The $RMSD(t)$ plot, by its definition as a deviation from the initial state over time, provides a direct visualization of the entire transition event.\n- **Verdict: Correct**\n\nBased on the analysis, statements A, D, and E are all correct descriptions of the physical situation and the associated data analysis concepts. They capture different, but equally valid, aspects of the problem. Following the instructions to include all correct options, the final answer must include A, D, and E.",
            "answer": "$$\\boxed{ADE}$$"
        }
    ]
}