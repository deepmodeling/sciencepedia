{
    "hands_on_practices": [
        {
            "introduction": "To build a robust understanding of the radius of gyration ($R_g$), we begin with the simplest possible multi-particle system. This exercise challenges you to derive the analytical expression for $R_g$ for a two-mass system from first principles. By working through this fundamental case, you will gain crucial physical intuition into how mass inhomogeneity, characterized by the reduced mass, governs the effective size of a molecular complex, an insight that is directly applicable to the study of heterodimeric proteins. ",
            "id": "3864903",
            "problem": "In computational structural analysis of macromolecules, the mass-weighted radius of gyration about the center of mass is a key size descriptor that connects directly to scattering observables in Small-Angle X-ray Scattering (SAXS). Consider a rigid coarse-grained model of a two-domain biomolecular complex represented by two point masses $m_1$ and $m_2$ separated by a fixed center-to-center distance $d$ in three-dimensional Euclidean space. Let the total mass be $M$, the position vectors of the masses be $\\mathbf{r}_1$ and $\\mathbf{r}_2$, and the center of mass be $\\mathbf{r}_{\\mathrm{cm}}$.\n\nYou may assume only the following fundamental definitions:\n- The center of mass is given by $\\mathbf{r}_{\\mathrm{cm}} = \\left(m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2\\right)/M$, where $M = m_1 + m_2$.\n- The radius of gyration squared is defined by $R_g^2 = \\left(1/M\\right) \\sum_{i=1}^{2} m_i \\left|\\mathbf{r}_i - \\mathbf{r}_{\\mathrm{cm}}\\right|^2$.\n\nStarting strictly from these definitions and geometric considerations, derive an exact analytic expression for $R_g^2$ as a function of $m_1$, $m_2$, and $d$. Then analyze the asymptotic limit $m_1 \\gg m_2$ and interpret it physically in the context of how mass inhomogeneity affects $R_g^2$ for a rigid dimer.\n\nAnswer specification:\n- Provide your final result as a single, closed-form analytic expression for $R_g^2$ in terms of $m_1$, $m_2$, and $d$.\n- Do not substitute numerical values and do not include units in your final expression.\n- No rounding is required.",
            "solution": "The problem is found to be valid as it is scientifically grounded in the principles of classical mechanics, well-posed with sufficient information for a unique solution, and stated objectively. We shall proceed with a rigorous derivation.\n\nThe objective is to derive an expression for the square of the radius of gyration, $R_g^2$, for a system of two point masses, $m_1$ and $m_2$, separated by a fixed distance $d$, as a function of these three parameters. We begin strictly from the provided definitions.\n\nThe total mass of the system is $M = m_1 + m_2$.\nThe center of mass vector is defined as:\n$$\n\\mathbf{r}_{\\mathrm{cm}} = \\frac{m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2}{M}\n$$\nThe square of the radius of gyration is defined as:\n$$\nR_g^2 = \\frac{1}{M} \\sum_{i=1}^{2} m_i |\\mathbf{r}_i - \\mathbf{r}_{\\mathrm{cm}}|^2 = \\frac{1}{M} \\left( m_1 |\\mathbf{r}_1 - \\mathbf{r}_{\\mathrm{cm}}|^2 + m_2 |\\mathbf{r}_2 - \\mathbf{r}_{\\mathrm{cm}}|^2 \\right)\n$$\nOur strategy is to express the vectors from the center of mass to each particle, $\\mathbf{r}_i - \\mathbf{r}_{\\mathrm{cm}}$, in terms of the vector separating the two masses, $\\mathbf{r}_1 - \\mathbf{r}_2$.\n\nFirst, let's find the vector from the center of mass to mass $m_1$:\n$$\n\\mathbf{r}_1 - \\mathbf{r}_{\\mathrm{cm}} = \\mathbf{r}_1 - \\frac{m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2}{m_1 + m_2}\n$$\nPlacing the terms over a common denominator, $M = m_1 + m_2$:\n$$\n\\mathbf{r}_1 - \\mathbf{r}_{\\mathrm{cm}} = \\frac{(m_1 + m_2)\\mathbf{r}_1 - (m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2)}{m_1 + m_2} = \\frac{m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_1 - m_1 \\mathbf{r}_1 - m_2 \\mathbf{r}_2}{M} = \\frac{m_2 (\\mathbf{r}_1 - \\mathbf{r}_2)}{M}\n$$\nSimilarly, for the vector from the center of mass to mass $m_2$:\n$$\n\\mathbf{r}_2 - \\mathbf{r}_{\\mathrm{cm}} = \\mathbf{r}_2 - \\frac{m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2}{m_1 + m_2}\n$$\n$$\n\\mathbf{r}_2 - \\mathbf{r}_{\\mathrm{cm}} = \\frac{(m_1 + m_2)\\mathbf{r}_2 - (m_1 \\mathbf{r}_1 + m_2 \\mathbf{r}_2)}{m_1 + m_2} = \\frac{m_1 \\mathbf{r}_2 + m_2 \\mathbf{r}_2 - m_1 \\mathbf{r}_1 - m_2 \\mathbf{r}_2}{M} = \\frac{m_1 (\\mathbf{r}_2 - \\mathbf{r}_1)}{M}\n$$\nNow we compute the squared magnitudes of these vectors. The distance between the masses is given as $d$, so $|\\mathbf{r}_1 - \\mathbf{r}_2| = |\\mathbf{r}_2 - \\mathbf{r}_1| = d$.\n$$\n|\\mathbf{r}_1 - \\mathbf{r}_{\\mathrm{cm}}|^2 = \\left| \\frac{m_2 (\\mathbf{r}_1 - \\mathbf{r}_2)}{M} \\right|^2 = \\left(\\frac{m_2}{M}\\right)^2 |\\mathbf{r}_1 - \\mathbf{r}_2|^2 = \\frac{m_2^2}{M^2} d^2\n$$\n$$\n|\\mathbf{r}_2 - \\mathbf{r}_{\\mathrm{cm}}|^2 = \\left| \\frac{m_1 (\\mathbf{r}_2 - \\mathbf{r}_1)}{M} \\right|^2 = \\left(\\frac{m_1}{M}\\right)^2 |\\mathbf{r}_2 - \\mathbf{r}_1|^2 = \\frac{m_1^2}{M^2} d^2\n$$\nSubstitute these results back into the definition of $R_g^2$:\n$$\nR_g^2 = \\frac{1}{M} \\left( m_1 \\left[ \\frac{m_2^2}{M^2} d^2 \\right] + m_2 \\left[ \\frac{m_1^2}{M^2} d^2 \\right] \\right)\n$$\nWe can factor out the common term $\\frac{d^2}{M^2}$:\n$$\nR_g^2 = \\frac{d^2}{M^3} \\left( m_1 m_2^2 + m_2 m_1^2 \\right)\n$$\nFactoring out $m_1 m_2$ from the term in the parenthesis gives:\n$$\nR_g^2 = \\frac{d^2}{M^3} \\left( m_1 m_2 (m_2 + m_1) \\right)\n$$\nBy definition, $M = m_1 + m_2$. Substituting this into the expression yields:\n$$\nR_g^2 = \\frac{m_1 m_2 (M)}{M^3} d^2 = \\frac{m_1 m_2}{M^2} d^2\n$$\nFinally, replacing $M$ with $m_1 + m_2$, we arrive at the desired expression for $R_g^2$ as a function of $m_1$, $m_2$, and $d$:\n$$\nR_g^2 = \\frac{m_1 m_2}{(m_1 + m_2)^2} d^2\n$$\nThis expression is equivalent to $R_g^2 = \\frac{\\mu}{M}d^2$, where $\\mu = \\frac{m_1 m_2}{m_1+m_2}$ is the reduced mass of the two-body system.\n\nNext, we analyze the asymptotic limit where one mass is much larger than the other, i.e., $m_1 \\gg m_2$. In this limit, the total mass $M = m_1 + m_2 \\approx m_1$.\nWe can rewrite the expression for $R_g^2$ by factoring out $m_1$ from the denominator:\n$$\nR_g^2 = \\frac{m_1 m_2}{(m_1(1 + m_2/m_1))^2} d^2 = \\frac{m_1 m_2}{m_1^2 (1 + m_2/m_1)^2} d^2 = \\frac{m_2}{m_1} \\frac{1}{(1 + m_2/m_1)^2} d^2\n$$\nAs $m_1 \\gg m_2$, the ratio $\\frac{m_2}{m_1} \\to 0$. Therefore, the term $(1 + m_2/m_1)^2 \\to (1+0)^2 = 1$.\nThe expression for $R_g^2$ thus approaches:\n$$\n\\lim_{m_2/m_1 \\to 0} R_g^2 = \\frac{m_2}{m_1} d^2\n$$\nThe physical interpretation of this result is as follows. When $m_1 \\gg m_2$, the center of mass $\\mathbf{r}_{\\mathrm{cm}}$ of the system is located very close to the position of the heavy mass, $\\mathbf{r}_1$. In the limit, $\\mathbf{r}_{\\mathrm{cm}} \\to \\mathbf{r}_1$. The radius of gyration is a mass-weighted average of the squared distances of all masses from the center of mass.\nIn this limit:\n- The contribution from the large mass $m_1$ to $R_g^2$ becomes negligible, as its distance to the center of mass, $|\\mathbf{r}_1 - \\mathbf{r}_{\\mathrm{cm}}|$, approaches $0$.\n- The contribution from the small mass $m_2$ dominates. Its distance from the center of mass is approximately the full separation distance $d$, i.e., $|\\mathbf{r}_2 - \\mathbf{r}_{\\mathrm{cm}}| \\approx |\\mathbf{r}_2 - \\mathbf{r}_1| = d$.\nThe definition of $R_g^2$ becomes approximately:\n$$\nR_g^2 \\approx \\frac{1}{M} \\left( m_1 (0)^2 + m_2 (d)^2 \\right) = \\frac{m_2}{M} d^2\n$$\nSince $M \\approx m_1$, this simplifies to $R_g^2 \\approx \\frac{m_2}{m_1} d^2$, which confirms our analytical limit. This demonstrates that for a system with highly inhomogeneous mass distribution, the radius of gyration is not a measure of the simple geometric extent (like $d$) but is strongly suppressed by the mass ratio. The system's effective size, as measured by $R_g$, becomes much smaller than its physical dimension $d$ because most of the mass is concentrated at the center of mass.",
            "answer": "$$\n\\boxed{\\frac{m_1 m_2}{\\left(m_1 + m_2\\right)^{2}} d^{2}}\n$$"
        },
        {
            "introduction": "While biomolecules are discrete, it is often useful to approximate them as continuous bodies, especially in coarse-grained modeling or when interpreting scattering data. This practice guides you through the transition from a discrete to a continuous framework by deriving the radius of gyration for a uniform solid sphere. Mastering this derivation not only reinforces essential mathematical skills in integral calculus but also provides the basis for one of the most common reference models for compact, globular macromolecules. ",
            "id": "3864882",
            "problem": "In computational chemical biology, globular macromolecules are often coarse-grained as continuous bodies with symmetric mass distributions to derive structural metrics used in Molecular Dynamics (MD) analysis. Consider a spherically symmetric, uniform mass distribution that approximates a compact biomolecular assembly (for example, a folded protein or ribonucleoprotein complex) as a solid sphere of radius $R$ and constant mass density $\\rho$. The center of mass coincides with the geometric center. Starting from the fundamental definition that the radius of gyration is the mass-weighted mean square distance from the center of mass for a continuous distribution, set up and evaluate the requisite integrals in spherical coordinates to obtain the square of the radius of gyration as a function of $R$.\n\nConstraints and instructions:\n- Treat the mass density as $\\rho(r)=\\rho$ for $0 \\leq r \\leq R$ and $\\rho(r)=0$ for $r>R$.\n- Use spherical coordinates centered at the center of mass and explicitly show the angular and radial integration limits and the Jacobian factor for the volume element.\n- Do not invoke any pre-tabulated results; derive every intermediate quantity needed from first principles.\n- Express your final answer as a single closed-form analytic expression in terms of $R$.\n- Express the final quantity in meters squared, but do not include units inside your boxed answer.",
            "solution": "The problem statement is a valid and well-posed exercise in classical mechanics applied to a biophysical model. It asks for the derivation of the square of the radius of gyration for a solid sphere of uniform density, starting from first principles and using spherical coordinates. The problem is scientifically grounded, self-contained, and objective. We shall proceed with the solution.\n\nThe square of the radius of gyration, denoted as $R_g^2$, for a continuous mass distribution is defined as the mass-weighted mean square distance of the object's constituent parts from its center of mass. For a body with volume $V$ and mass density distribution $\\rho(\\mathbf{r})$, this is expressed by the integral:\n$$R_g^2 = \\frac{1}{M} \\int_V \\|\\mathbf{r}\\|^2 dm$$\nwhere $M$ is the total mass of the body, $dm$ is a differential mass element, and $\\mathbf{r}$ is the position vector from the center of mass. In this problem, the center of mass is at the origin of our coordinate system, so the distance from the center of mass is simply the magnitude of the position vector, $\\|\\mathbf{r}\\|$.\n\nThe differential mass element $dm$ can be expressed in terms of the density $\\rho$ and the differential volume element $dV$ as $dm = \\rho(\\mathbf{r}) dV$. The problem specifies a uniform mass distribution, such that the density $\\rho(\\mathbf{r})$ is a constant $\\rho$ for distances $r \\leq R$ from the center, and $0$ otherwise.\nSubstituting $dm = \\rho dV$ into the definition for $R_g^2$ gives:\n$$R_g^2 = \\frac{1}{M} \\int_V \\|\\mathbf{r}\\|^2 \\rho dV$$\nSince $\\rho$ is constant throughout the volume of the sphere, it can be factored out of the integral in the numerator.\n$$R_g^2 = \\frac{\\rho}{M} \\int_V \\|\\mathbf{r}\\|^2 dV$$\n\nThe total mass $M$ is the integral of the constant density $\\rho$ over the volume $V$ of the sphere:\n$$M = \\int_V \\rho dV = \\rho \\int_V dV = \\rho V$$\nWe must first derive the volume $V$ by integration, as stipulated. In spherical coordinates $(r, \\theta, \\phi)$, the position vector magnitude is $\\|\\mathbf{r}\\| = r$, and the volume element is $dV = r^2 \\sin\\theta dr d\\theta d\\phi$. The term $r^2 \\sin\\theta$ is the Jacobian determinant for the coordinate transformation. The integration limits for a sphere of radius $R$ are $r \\in [0, R]$, $\\theta \\in [0, \\pi]$, and $\\phi \\in [0, 2\\pi]$.\nThe volume integral is:\n$$V = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\int_{0}^{R} r^2 \\sin\\theta dr d\\theta d\\phi$$\nWe evaluate this by separating the variables:\n$$V = \\left( \\int_{0}^{2\\pi} d\\phi \\right) \\left( \\int_{0}^{\\pi} \\sin\\theta d\\theta \\right) \\left( \\int_{0}^{R} r^2 dr \\right)$$\nEvaluating each integral separately:\n$$\\int_{0}^{2\\pi} d\\phi = [\\phi]_{0}^{2\\pi} = 2\\pi$$\n$$\\int_{0}^{\\pi} \\sin\\theta d\\theta = [-\\cos\\theta]_{0}^{\\pi} = -(\\cos\\pi - \\cos0) = -(-1 - 1) = 2$$\n$$\\int_{0}^{R} r^2 dr = \\left[ \\frac{r^3}{3} \\right]_{0}^{R} = \\frac{R^3}{3}$$\nMultiplying these results gives the volume of the sphere:\n$$V = (2\\pi)(2)\\left(\\frac{R^3}{3}\\right) = \\frac{4}{3}\\pi R^3$$\nThus, the total mass is $M = \\rho \\frac{4}{3}\\pi R^3$.\n\nNow we can express $R_g^2$ by substituting $M$:\n$$R_g^2 = \\frac{\\rho}{\\rho \\frac{4}{3}\\pi R^3} \\int_V r^2 dV = \\frac{1}{\\frac{4}{3}\\pi R^3} \\int_V r^2 dV$$\nNotice that the density $\\rho$ cancels, which is expected for the radius of gyration of a body with uniform density.\n\nNext, we evaluate the integral in the numerator, $\\int_V r^2 dV$. Using spherical coordinates as before:\n$$ \\int_V r^2 dV = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\int_{0}^{R} (r^2) (r^2 \\sin\\theta dr d\\theta d\\phi) $$\nThe integrand contains an additional factor of $r^2$ from the definition of $R_g^2$.\n$$ \\int_V r^2 dV = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\int_{0}^{R} r^4 \\sin\\theta dr d\\theta d\\phi $$\nAgain, we separate the integrals:\n$$ \\int_V r^2 dV = \\left( \\int_{0}^{2\\pi} d\\phi \\right) \\left( \\int_{0}^{\\pi} \\sin\\theta d\\theta \\right) \\left( \\int_{0}^{R} r^4 dr \\right) $$\nThe angular integrals are identical to those computed for the volume:\n$$\\int_{0}^{2\\pi} d\\phi = 2\\pi$$\n$$\\int_{0}^{\\pi} \\sin\\theta d\\theta = 2$$\nThe radial integral is now:\n$$\\int_{0}^{R} r^4 dr = \\left[ \\frac{r^5}{5} \\right]_{0}^{R} = \\frac{R^5}{5}$$\nMultiplying these gives the result for the numerator integral:\n$$\\int_V r^2 dV = (2\\pi)(2)\\left(\\frac{R^5}{5}\\right) = \\frac{4}{5}\\pi R^5$$\n\nFinally, we substitute this result and the expression for the volume back into the equation for $R_g^2$:\n$$R_g^2 = \\frac{\\int_V r^2 dV}{\\int_V dV} = \\frac{\\frac{4}{5}\\pi R^5}{\\frac{4}{3}\\pi R^3}$$\nCanceling the common factors of $4$, $\\pi$, and $R^3$:\n$$R_g^2 = \\frac{1/5}{1/3} \\frac{R^5}{R^3} = \\frac{3}{5} R^2$$\nThe square of the radius of gyration for a solid sphere of uniform density and radius $R$ is therefore $\\frac{3}{5}R^2$. The units are length squared, consistent with the instruction that the final quantity is in meters squared.",
            "answer": "$$\\boxed{\\frac{3}{5}R^2}$$"
        },
        {
            "introduction": "This final practice moves from static structures to the dynamic reality of molecular simulations, a core activity in computational chemical biology. You will develop an algorithm to compute the time-averaged $R_g$ from a molecular dynamics trajectory, tackling the critical and practical challenges of periodic boundary conditions (PBC) and coordinate unwrapping. Successfully completing this exercise demonstrates the ability to translate a theoretical structural metric into a robust analysis tool for dynamic simulation data. ",
            "id": "3864854",
            "problem": "You are given short, synthetic Molecular Dynamics (MD) trajectories under Periodic Boundary Conditions (PBC), and asked to design and implement an algorithm to compute the time-averaged, mass-weighted radius of gyration. The algorithm must explicitly handle coordinate unwrapping across frames to restore continuity of atomic trajectories. Your program must compute the following, in order, for each trajectory: coordinate unwrapping under PBC, the per-frame mass-weighted center of mass, the per-frame mass-weighted radius of gyration, and the time-average of the radius of gyration across all frames. All distances must be treated in nanometers and the final results must be reported in nanometers, rounded to six decimal places. The output must be a single line containing the results for all test cases, as a comma-separated list enclosed in square brackets.\n\nThe intended scientific base you should use is:\n- The definition of mass and position for point particles.\n- The definition of the center of mass for a set of point masses.\n- The Euclidean norm in three-dimensional space.\n- The conceptual structure of Periodic Boundary Conditions (PBC), which identifies positions differing by integer multiples of the box lengths along each axis as equivalent, and the minimum image convention.\n- The notion of coordinate unwrapping, which reconstructs a continuous trajectory by accounting for boundary crossings between consecutive frames.\n\nYou must not start from or quote any shortcut formula defining the radius of gyration; instead, derive the algorithm from the above base, including the mass-weighted center of mass and the dispersion of positions about that center.\n\nUnits and representation requirements:\n- Positions are in nanometers.\n- The box is orthorhombic with lengths given per axis in nanometers.\n- The answer must be expressed in nanometers, rounded to six decimal places.\n- Angles are not used in this problem.\n\nYour algorithmic tasks are:\n1. Given a trajectory with positions $r_{t,i}$ for frame $t$ and atom $i$, and box lengths $\\ell_x$, $\\ell_y$, $\\ell_z$, reconstruct an unwrapped trajectory $\\tilde{r}_{t,i}$ that is continuous in time. Use the minimum image logic across consecutive frames so that the per-axis displacement between consecutive frames is the nearest displacement accounting for PBC. The unwrapped coordinate at time $t$ should be obtained by adding the corrected displacement to the unwrapped coordinate at time $t-1$.\n2. For each frame $t$, compute the mass-weighted center of mass from the unwrapped positions and the given atomic masses.\n3. For each frame $t$, compute the mass-weighted dispersion of points around the center of mass as a scalar distance measure.\n4. Compute the time-averaged scalar distance across all frames of a trajectory.\n5. Report one floating-point number per trajectory in nanometers, rounded to six decimal places.\n\nTest suite to exercise the implementation:\n- Test case $1$ (happy path with multiple atoms, non-uniform masses, and boundary crossings):\n  - Number of atoms $N$: $3$.\n  - Number of frames $T$: $4$.\n  - Box lengths: $[\\,10.0,\\,10.0,\\,10.0\\,]$.\n  - Atomic masses (atomic mass units): $[\\,12.0,\\,1.0,\\,16.0\\,]$.\n  - Positions per frame (nanometers), each row is $[x,y,z]$:\n    - Frame $0$: $[\\,9.8,\\,9.9,\\,0.1\\,]$, $[\\,0.2,\\,0.1,\\,0.2\\,]$, $[\\,0.0,\\,9.9,\\,9.8\\,]$.\n    - Frame $1$: $[\\,0.1,\\,0.0,\\,0.2\\,]$, $[\\,0.4,\\,0.3,\\,0.3\\,]$, $[\\,9.9,\\,0.1,\\,9.9\\,]$.\n    - Frame $2$: $[\\,0.3,\\,0.2,\\,0.3\\,]$, $[\\,9.9,\\,0.2,\\,0.4\\,]$, $[\\,9.8,\\,0.2,\\,0.0\\,]$.\n    - Frame $3$: $[\\,0.4,\\,0.4,\\,0.5\\,]$, $[\\,9.7,\\,9.9,\\,0.6\\,]$, $[\\,9.7,\\,0.3,\\,0.2\\,]$.\n- Test case $2$ (boundary condition with a single atom; the radius of gyration should be zero for every frame regardless of motion):\n  - Number of atoms $N$: $1$.\n  - Number of frames $T$: $5$.\n  - Box lengths: $[\\ell_x,\\ell_y,\\ell_z] = [\\,10.0,\\,10.0,\\,10.0\\,]$.\n  - Atomic masses (atomic mass units): $[\\,12.0\\,]$.\n  - Positions per frame (nanometers):\n    - Frame $0$: $[\\,5.0,\\,5.0,\\,5.0\\,]$.\n    - Frame $1$: $[\\,9.9,\\,0.1,\\,0.0\\,]$.\n    - Frame $2$: $[\\,0.2,\\,0.3,\\,0.4\\,]$.\n    - Frame $3$: $[\\,0.1,\\,9.8,\\,9.7\\,]$.\n    - Frame $4$: $[\\,9.9,\\,9.9,\\,9.9\\,]$.\n- Test case $3$ (edge case with two equal-mass atoms maintaining a constant separation while crossing boundaries):\n  - Number of atoms $N$: $2$.\n  - Number of frames $T$: $4$.\n  - Box lengths: $[\\ell_x,\\ell_y,\\ell_z] = [\\,10.0,\\,10.0,\\,10.0\\,]$.\n  - Atomic masses (atomic mass units): $[\\,12.0,\\,12.0\\,]$.\n  - Positions per frame (nanometers), pairs given as $[x,y,z]$ for atom $1$ and atom $2$:\n    - Frame $0$: $[\\,9.0,\\,0.0,\\,0.0\\,]$, $[\\,5.0,\\,0.0,\\,0.0\\,]$.\n    - Frame $1$: $[\\,0.5,\\,0.0,\\,0.0\\,]$, $[\\,6.5,\\,0.0,\\,0.0\\,]$.\n    - Frame $2$: $[\\,1.7,\\,0.0,\\,0.0\\,]$, $[\\,7.7,\\,0.0,\\,0.0\\,]$.\n    - Frame $3$: $[\\,8.9,\\,0.0,\\,0.0\\,]$, $[\\,4.9,\\,0.0,\\,0.0\\,]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\,r_1,\\,r_2,\\,r_3\\,]$), where $r_k$ is the time-averaged, mass-weighted radius of gyration in nanometers for test case $k$, rounded to six decimal places.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of classical mechanics and statistical physics, is well-posed with all necessary information provided, and is expressed in objective, formal language. We will proceed to derive and implement the required algorithm from first principles.\n\nThe algorithm to compute the time-averaged, mass-weighted radius of gyration, $R_g$, requires four sequential steps: (1) unwrapping the atomic coordinates to ensure trajectory continuity, (2) computing the mass-weighted center of mass for each frame, (3) computing the mass-weighted radius of gyration for each frame, and (4) averaging the per-frame $R_g$ values over time.\n\nLet the system consist of $N$ atoms, with masses $m_i$ for $i \\in \\{1, \\dots, N\\}$. The trajectory is given for $T$ frames, with a wrapped position vector $\\boldsymbol{r}_{t,i} \\in \\mathbb{R}^3$ for each atom $i$ at frame $t \\in \\{0, \\dots, T-1\\}$. The simulation box is orthorhombic with dimension vector $\\boldsymbol{\\ell} = (\\ell_x, \\ell_y, \\ell_z)$.\n\n**1. Coordinate Unwrapping**\n\nThe provided coordinates $\\boldsymbol{r}_{t,i}$ are subject to periodic boundary conditions (PBC). To compute a global structural property like the radius of gyration, we must first reconstruct a continuous trajectory in space. We denote the unwrapped coordinates as $\\tilde{\\boldsymbol{r}}_{t,i}$.\n\nThe unwrapping process is iterative. For the initial frame, $t=0$, we assume the wrapped and unwrapped coordinates are identical:\n$$\n\\tilde{\\boldsymbol{r}}_{0,i} = \\boldsymbol{r}_{0,i} \\quad \\forall i \\in \\{1, \\dots, N\\}\n$$\nFor each subsequent frame $t > 0$, the unwrapped position of an atom is determined by its unwrapped position in the previous frame, $\\tilde{\\boldsymbol{r}}_{t-1,i}$, and the true physical displacement that occurred between frame $t-1$ and $t$. This displacement is computed using the minimum image convention.\n\nThe apparent displacement vector is $\\Delta\\boldsymbol{r}_{t,i} = \\boldsymbol{r}_{t,i} - \\boldsymbol{r}_{t-1,i}$. Due to PBC, a component of this vector, say $\\Delta x_{t,i}$, may not represent the shortest path if a boundary was crossed. The minimum image displacement, $\\Delta\\tilde{\\boldsymbol{r}}_{t,i}$, is found by correcting each component of the apparent displacement. For each axis $k \\in \\{x, y, z\\}$:\n$$\n\\Delta\\tilde{r}_{t,i,k} = \\Delta r_{t,i,k} - \\ell_k \\cdot \\text{round}\\left( \\frac{\\Delta r_{t,i,k}}{\\ell_k} \\right)\n$$\nwhere `round` is a function that rounds its argument to the nearest integer. This operation ensures that each component of the corrected displacement vector lies in the interval $[-\\ell_k/2, \\ell_k/2]$.\n\nThe unwrapped coordinate for atom $i$ at frame $t$ is then calculated by adding this corrected displacement to the previous unwrapped position:\n$$\n\\tilde{\\boldsymbol{r}}_{t,i} = \\tilde{\\boldsymbol{r}}_{t-1,i} + \\Delta\\tilde{\\boldsymbol{r}}_{t,i}\n$$\nThis process is repeated for all atoms and for all frames from $t=1$ to $T-1$.\n\n**2. Per-Frame Mass-Weighted Center of Mass**\n\nFor each frame $t$, we compute the mass-weighted center of mass, $\\tilde{\\boldsymbol{R}}_t$, using the unwrapped coordinates $\\tilde{\\boldsymbol{r}}_{t,i}$. The total mass of the system is $M = \\sum_{i=1}^{N} m_i$. The center of mass is defined as:\n$$\n\\tilde{\\boldsymbol{R}}_t = \\frac{\\sum_{i=1}^{N} m_i \\tilde{\\boldsymbol{r}}_{t,i}}{\\sum_{i=1}^{N} m_i} = \\frac{1}{M} \\sum_{i=1}^{N} m_i \\tilde{\\boldsymbol{r}}_{t,i}\n$$\n\n**3. Per-Frame Mass-Weighted Radius of Gyration**\n\nThe radius of gyration, $R_{g,t}$, for frame $t$ is a measure of the spatial extent of the atoms. It is defined as the mass-weighted root-mean-square distance of the atoms from their center of mass. The squared radius of gyration, $R_{g,t}^2$, is the mass-weighted mean of the squared Euclidean distances of each atom from the center of mass:\n$$\nR_{g,t}^2 = \\frac{\\sum_{i=1}^{N} m_i ||\\tilde{\\boldsymbol{r}}_{t,i} - \\tilde{\\boldsymbol{R}}_t||^2}{\\sum_{i=1}^{N} m_i} = \\frac{1}{M} \\sum_{i=1}^{N} m_i ||\\tilde{\\boldsymbol{r}}_{t,i} - \\tilde{\\boldsymbol{R}}_t||^2\n$$\nwhere $||\\cdot||$ denotes the Euclidean norm. The \"scalar distance measure\" requested is the radius of gyration itself, which has units of length:\n$$\nR_{g,t} = \\sqrt{R_{g,t}^2}\n$$\n\n**4. Time-Averaged Radius of Gyration**\n\nFinally, the time-averaged radius of gyration, $\\langle R_g \\rangle$, is the arithmetic mean of the per-frame $R_{g,t}$ values over all $T$ frames of the trajectory:\n$$\n\\langle R_g \\rangle = \\frac{1}{T} \\sum_{t=0}^{T-1} R_{g,t}\n$$\nThe resulting value is reported in nanometers, rounded to six decimal places, as per the problem specification.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_average_rg(masses: np.ndarray, positions: np.ndarray, box_lengths: np.ndarray) -> float:\n    \"\"\"\n    Computes the time-averaged, mass-weighted radius of gyration for a trajectory.\n\n    The algorithm performs three main steps:\n    1. Unwraps the trajectory coordinates to handle periodic boundary conditions (PBC).\n    2. For each frame, calculates the mass-weighted center of mass (COM) and then the\n       mass-weighted radius of gyration (Rg).\n    3. Averages the per-frame Rg values over the entire trajectory.\n\n    Args:\n        masses: A 1D numpy array of shape (N,) containing atomic masses.\n        positions: A 3D numpy array of shape (T, N, 3) containing wrapped atomic\n                   positions for T frames and N atoms.\n        box_lengths: A 1D numpy array of shape (3,) with the box dimensions [Lx, Ly, Lz].\n\n    Returns:\n        The time-averaged radius of gyration as a float.\n    \"\"\"\n    num_frames, num_atoms, _ = positions.shape\n\n    # 1. Coordinate Unwrapping\n    unwrapped_pos = np.zeros_like(positions)\n    unwrapped_pos[0] = positions[0]\n\n    for t in range(1, num_frames):\n        delta = positions[t] - positions[t-1]\n        # Apply minimum image convention\n        correction = box_lengths * np.round(delta / box_lengths)\n        unwrapped_delta = delta - correction\n        unwrapped_pos[t] = unwrapped_pos[t-1] + unwrapped_delta\n    \n    # 2. Per-Frame Rg Calculation\n    rg_per_frame = []\n    total_mass = np.sum(masses)\n    \n    if total_mass == 0:\n        return 0.0\n\n    # Reshape masses for broadcasting: from (N,) to (N, 1)\n    masses_reshaped = masses[:, np.newaxis]\n\n    for t in range(num_frames):\n        frame_pos = unwrapped_pos[t]\n        \n        # Calculate mass-weighted center of mass for the frame\n        com = np.sum(frame_pos * masses_reshaped, axis=0) / total_mass\n        \n        # Calculate squared distances from COM\n        dist_sq = np.sum((frame_pos - com)**2, axis=1)\n        \n        # Calculate mass-weighted squared Rg\n        rg_sq = np.sum(masses * dist_sq) / total_mass\n        \n        # Rg is the square root\n        rg = np.sqrt(rg_sq)\n        rg_per_frame.append(rg)\n        \n    # 3. Time-Averaging\n    average_rg = np.mean(rg_per_frame)\n    \n    return average_rg\n\ndef solve():\n    \"\"\"\n    Defines test cases and computes the average radius of gyration for each.\n    The final output is a single-line string of comma-separated results\n    rounded to six decimal places, enclosed in square brackets.\n    \"\"\"\n    test_cases = [\n        {\n            \"masses\": np.array([12.0, 1.0, 16.0]),\n            \"positions\": np.array([\n                [[9.8, 9.9, 0.1], [0.2, 0.1, 0.2], [0.0, 9.9, 9.8]],\n                [[0.1, 0.0, 0.2], [0.4, 0.3, 0.3], [9.9, 0.1, 9.9]],\n                [[0.3, 0.2, 0.3], [9.9, 0.2, 0.4], [9.8, 0.2, 0.0]],\n                [[0.4, 0.4, 0.5], [9.7, 9.9, 0.6], [9.7, 0.3, 0.2]],\n            ]),\n            \"box_lengths\": np.array([10.0, 10.0, 10.0])\n        },\n        {\n            \"masses\": np.array([12.0]),\n            \"positions\": np.array([\n                [[5.0, 5.0, 5.0]],\n                [[9.9, 0.1, 0.0]],\n                [[0.2, 0.3, 0.4]],\n                [[0.1, 9.8, 9.7]],\n                [[9.9, 9.9, 9.9]],\n            ]),\n            \"box_lengths\": np.array([10.0, 10.0, 10.0])\n        },\n        {\n            \"masses\": np.array([12.0, 12.0]),\n            \"positions\": np.array([\n                [[9.0, 0.0, 0.0], [5.0, 0.0, 0.0]],\n                [[0.5, 0.0, 0.0], [6.5, 0.0, 0.0]],\n                [[1.7, 0.0, 0.0], [7.7, 0.0, 0.0]],\n                [[8.9, 0.0, 0.0], [4.9, 0.0, 0.0]],\n            ]),\n            \"box_lengths\": np.array([10.0, 10.0, 10.0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_average_rg(case[\"masses\"], case[\"positions\"], case[\"box_lengths\"])\n        results.append(result)\n\n    # Format the results to exactly six decimal places and join them.\n    formatted_results = ','.join(f\"{r:.6f}\" for r in results)\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        }
    ]
}