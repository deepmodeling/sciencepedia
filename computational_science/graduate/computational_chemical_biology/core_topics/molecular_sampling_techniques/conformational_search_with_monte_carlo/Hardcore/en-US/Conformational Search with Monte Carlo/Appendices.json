{
    "hands_on_practices": [
        {
            "introduction": "The heart of a Monte Carlo simulation is the decision to accept or reject a proposed move based on the change in energy. This practice provides a concrete calculation of the Metropolis acceptance probability for a simple yet realistic conformational change: the rotation of a single dihedral angle. By working through this exercise , you will solidify your understanding of how the algorithm balances exploration of higher-energy states with exploitation of lower-energy ones, a key principle for sampling the Boltzmann distribution.",
            "id": "3840331",
            "problem": "A single dihedral angle $\\phi$ in a flexible ligand is modeled by the torsional potential\n$$\nE_{\\text{dihedral}}(\\phi) \\;=\\; \\sum_{n=1}^{3} \\frac{V_n}{2}\\,\\big[1 + \\cos(n\\phi - \\gamma_n)\\big],\n$$\nwhere all angles are in radians and energies are in $\\text{kJ}\\,\\text{mol}^{-1}$. Consider a canonical-ensemble Monte Carlo (MC) move that proposes changing the torsion from an initial value $\\phi$ to a new value $\\phi'$, using a symmetric proposal distribution over $\\phi$. Assume this torsional term captures the relevant energetic change for the move (i.e., neglect couplings to other degrees of freedom for this step).\n\nParameters for this torsion are: $V_1 = 2.5\\,\\text{kJ}\\,\\text{mol}^{-1}$ with $\\gamma_1 = 0$, $V_2 = 1.2\\,\\text{kJ}\\,\\text{mol}^{-1}$ with $\\gamma_2 = \\pi/3$, and $V_3 = 0.8\\,\\text{kJ}\\,\\text{mol}^{-1}$ with $\\gamma_3 = \\pi$. The initial angle is $\\phi = 2.1$ and the proposed angle is $\\phi' = \\phi + \\Delta\\phi$ with $\\Delta\\phi = -0.7$ (hence $\\phi' = 1.4$). The temperature is $T = 300\\,\\text{K}$.\n\nStarting from the canonical ensemble and detailed balance principles appropriate for a symmetric proposal in Markov chain Monte Carlo (MCMC), compute the energy change $\\Delta E = E_{\\text{dihedral}}(\\phi') - E_{\\text{dihedral}}(\\phi)$ and then evaluate the acceptance probability for this move at temperature $T$.\n\nExpress the final answer as the acceptance probability, in decimal form, rounded to four significant figures. Do not include units with the final number.",
            "solution": "The problem requires the calculation of the acceptance probability for a Monte Carlo move in the canonical ensemble. The standard method for this is the Metropolis-Hastings algorithm. The acceptance probability $P_{\\text{acc}}$ for a move from a state with configuration $\\phi$ to a new configuration $\\phi'$ is given by:\n$$P_{\\text{acc}}(\\phi \\to \\phi') = \\min\\left(1, \\frac{\\pi(\\phi')}{\\pi(\\phi)} \\frac{g(\\phi|\\phi')}{g(\\phi'|\\phi)}\\right)$$\nwhere $\\pi(x)$ is the probability of state $x$ in the target distribution, and $g(y|x)$ is the conditional probability of proposing state $y$ given state $x$.\n\nIn the canonical ensemble, the probability of a state is proportional to its Boltzmann factor, $\\pi(\\phi) \\propto \\exp(-E(\\phi)/(k_B T))$, where $E(\\phi)$ is the energy of the state, $k_B$ is the Boltzmann constant, and $T$ is the absolute temperature. The problem states that the proposal distribution is symmetric, which means $g(\\phi|\\phi') = g(\\phi'|\\phi)$. Under these conditions, the acceptance probability simplifies to the Metropolis criterion:\n$$P_{\\text{acc}}(\\phi \\to \\phi') = \\min\\left(1, \\frac{\\exp(-E(\\phi')/(k_B T))}{\\exp(-E(\\phi)/(k_B T))}\\right) = \\min\\left(1, \\exp\\left(-\\frac{E(\\phi') - E(\\phi)}{k_B T}\\right)\\right)$$\nLet $\\Delta E = E(\\phi') - E(\\phi)$ be the change in energy. The acceptance probability is:\n$$P_{\\text{acc}} = \\min(1, \\exp(-\\Delta E / (RT)))$$\nSince the given energies are in units of $\\text{kJ}\\,\\text{mol}^{-1}$, we must use the molar gas constant $R$ instead of the Boltzmann constant $k_B$. The thermal energy is $RT$.\n\nThe first step is to calculate the energy change $\\Delta E = E_{\\text{dihedral}}(\\phi') - E_{\\text{dihedral}}(\\phi)$. Using the provided potential energy function:\n$$\n\\Delta E = \\sum_{n=1}^{3} \\frac{V_n}{2}\\,\\big[1 + \\cos(n\\phi' - \\gamma_n)\\big] - \\sum_{n=1}^{3} \\frac{V_n}{2}\\,\\big[1 + \\cos(n\\phi - \\gamma_n)\\big]\n$$\nThe constant $1$ within the brackets cancels out upon subtraction, yielding:\n$$\n\\Delta E = \\sum_{n=1}^{3} \\frac{V_n}{2}\\,\\big[\\cos(n\\phi' - \\gamma_n) - \\cos(n\\phi - \\gamma_n)\\big]\n$$\nWe are given the initial angle $\\phi = 2.1\\,\\text{rad}$ and the proposed angle $\\phi' = 1.4\\,\\text{rad}$. We now calculate the contribution to $\\Delta E$ for each term $n=1, 2, 3$.\n\nFor $n=1$: $V_1 = 2.5\\,\\text{kJ}\\,\\text{mol}^{-1}$, $\\gamma_1 = 0$.\n$$\n\\Delta E_1 = \\frac{2.5}{2} \\big[\\cos(1 \\cdot 1.4 - 0) - \\cos(1 \\cdot 2.1 - 0)\\big] = 1.25 \\big[\\cos(1.4) - \\cos(2.1)\\big]\n$$\nUsing a calculator in radian mode:\n$$\n\\cos(1.4) \\approx 0.169967 \\quad \\text{and} \\quad \\cos(2.1) \\approx -0.504846\n$$\n$$\n\\Delta E_1 \\approx 1.25 \\big[0.169967 - (-0.504846)\\big] = 1.25 \\big[0.674813\\big] \\approx 0.843516\\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\n\nFor $n=2$: $V_2 = 1.2\\,\\text{kJ}\\,\\text{mol}^{-1}$, $\\gamma_2 = \\pi/3$.\n$$\n\\Delta E_2 = \\frac{1.2}{2} \\big[\\cos(2 \\cdot 1.4 - \\pi/3) - \\cos(2 \\cdot 2.1 - \\pi/3)\\big] = 0.6 \\big[\\cos(2.8 - \\pi/3) - \\cos(4.2 - \\pi/3)\\big]\n$$\nUsing $\\pi \\approx 3.141593$:\n$$\n\\cos(2.8 - \\pi/3) \\approx \\cos(2.8 - 1.047198) = \\cos(1.752802) \\approx -0.180425\n$$\n$$\n\\cos(4.2 - \\pi/3) \\approx \\cos(4.2 - 1.047198) = \\cos(3.152802) \\approx -0.999818\n$$\n$$\n\\Delta E_2 \\approx 0.6 \\big[-0.180425 - (-0.999818)\\big] = 0.6 \\big[0.819393\\big] \\approx 0.491636\\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\n\nFor $n=3$: $V_3 = 0.8\\,\\text{kJ}\\,\\text{mol}^{-1}$, $\\gamma_3 = \\pi$.\n$$\n\\Delta E_3 = \\frac{0.8}{2} \\big[\\cos(3 \\cdot 1.4 - \\pi) - \\cos(3 \\cdot 2.1 - \\pi)\\big] = 0.4 \\big[\\cos(4.2 - \\pi) - \\cos(6.3 - \\pi)\\big]\n$$\n$$\n\\cos(4.2 - \\pi) \\approx \\cos(4.2 - 3.141593) = \\cos(1.058407) \\approx 0.490056\n$$\n$$\n\\cos(6.3 - \\pi) \\approx \\cos(6.3 - 3.141593) = \\cos(3.158407) \\approx -0.999718\n$$\n$$\n\\Delta E_3 \\approx 0.4 \\big[0.490056 - (-0.999718)\\big] = 0.4 \\big[1.489774\\big] \\approx 0.595910\\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\n\nThe total energy change is the sum of these contributions:\n$$\n\\Delta E = \\Delta E_1 + \\Delta E_2 + \\Delta E_3 \\approx 0.843516 + 0.491636 + 0.595910 = 1.931062\\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\nSince $\\Delta E  0$, the move is energetically unfavorable, and the acceptance probability will be less than $1$.\n\nNext, we calculate the thermal energy $RT$.\n$$\nR \\approx 8.31446 \\times 10^{-3}\\,\\text{kJ}\\,\\text{mol}^{-1}\\,\\text{K}^{-1} \\quad \\text{and} \\quad T = 300\\,\\text{K}\n$$\n$$\nRT \\approx (8.31446 \\times 10^{-3}) \\cdot 300 = 2.494338\\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\nNow we compute the exponent in the acceptance probability formula:\n$$\n-\\frac{\\Delta E}{RT} \\approx -\\frac{1.931062}{2.494338} \\approx -0.774180\n$$\nFinally, we calculate the acceptance probability:\n$$\nP_{\\text{acc}} = \\exp\\left(-\\frac{\\Delta E}{RT}\\right) \\approx \\exp(-0.774180) \\approx 0.461064\n$$\nThe problem asks for the result rounded to four significant figures.\n$$\nP_{\\text{acc}} \\approx 0.4611\n$$",
            "answer": "$$\n\\boxed{0.4611}\n$$"
        },
        {
            "introduction": "While the basic Metropolis criterion assumes the probability of proposing a move is symmetric, many powerful and efficient moves in computational biology are inherently asymmetric. This exercise  introduces such a scenario involving discrete protein sidechain rotamers, where the number of available moves depends on the current state. You will apply the more general Metropolis-Hastings acceptance rule, which corrects for this asymmetry to ensure detailed balance is maintained, a cornerstone of any valid MCMC simulation.",
            "id": "3840278",
            "problem": "A single-residue sidechain in a protein is explored by a conformational search using a Markov chain Monte Carlo algorithm in the canonical ensemble. The sidechain is represented by a discrete rotamer library. At any instant, a proposal consists of choosing a different rotamer from a state-dependent, sterically filtered set of allowed rotamers for that instant, uniformly among those that are not equal to the current rotamer. The instantaneous set of allowed rotamers can change after a move because steric clashes with the environment depend on the current sidechain orientation.\n\nConsider a proposed move from the current rotamer $i$ to a new rotamer $j$ at temperature $T = 300\\ \\mathrm{K}$. The potential energy is a sum of a torsional term and a nonbonded term, so that the change in potential energy upon the move is $\\Delta U = \\Delta U_{\\mathrm{tor}} + \\Delta U_{\\mathrm{nb}}$. For this particular move, the torsional energy change is $\\Delta U_{\\mathrm{tor}} = +2.3\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}$ and the nonbonded energy change is $\\Delta U_{\\mathrm{nb}} = -0.5\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}$. The molar gas constant is $R = 8.314462618\\times 10^{-3}\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}\\ \\mathrm{K}^{-1}$.\n\nBecause of the steric filter, when the system is in rotamer $i$ there are $K_{i} = 3$ allowed rotamers (including $i$ itself), and the proposal mechanism draws uniformly from the $K_{i}-1$ alternatives that differ from $i$. After the move, when the system would be in rotamer $j$, there are $K_{j} = 6$ allowed rotamers (including $j$ itself), and from $j$ the proposal mechanism would draw uniformly from the $K_{j}-1$ alternatives that differ from $j$.\n\nStarting from the canonical Boltzmann distribution and the requirement of detailed balance for the Markov chain, derive the correct acceptance probability for the move $i \\to j$ that accounts for the possible asymmetry of the discrete proposal mechanism induced by the state-dependent allowed-rotamer sets. Then evaluate this acceptance probability numerically for the data above. Express your final answer as a dimensionless number rounded to four significant figures.\n\nIn one or two sentences, briefly indicate how the acceptance expression should be modified if, instead of a uniform choice among the allowed alternatives, the proposal from any state uses state-dependent bias weights over the allowed alternatives.",
            "solution": "The foundation of a Markov chain Monte Carlo (MCMC) simulation that samples from a target probability distribution is the detailed balance condition. This condition ensures that the stationary distribution of the Markov chain is the desired target distribution. For a system in the canonical ensemble, the target distribution is the Boltzmann distribution, where the probability $P(x)$ of a state $x$ with potential energy $U(x)$ at temperature $T$ is given by:\n$$ P(x) \\propto \\exp\\left(-\\frac{U(x)}{RT}\\right) $$\nwhere $R$ is the molar gas constant.\n\nThe detailed balance condition for any two states, say $i$ and $j$, is:\n$$ P(i) \\cdot T(i \\to j) = P(j) \\cdot T(j \\to i) $$\nwhere $T(i \\to j)$ is the total transition probability from state $i$ to state $j$.\n\nIn the Metropolis-Hastings algorithm, the transition probability is a product of the proposal probability $g(i \\to j)$ and the acceptance probability $A(i \\to j)$:\n$$ T(i \\to j) = g(i \\to j) \\cdot A(i \\to j) \\quad (\\text{for } i \\neq j) $$\nSubstituting this into the detailed balance equation gives:\n$$ P(i) \\cdot g(i \\to j) \\cdot A(i \\to j) = P(j) \\cdot g(j \\to i) \\cdot A(j \\to i) $$\nThe general form for the acceptance probability that satisfies this condition is given by:\n$$ A(i \\to j) = \\min\\left(1, \\frac{P(j) \\cdot g(j \\to i)}{P(i) \\cdot g(i \\to j)}\\right) $$\n\nWe must first determine the ratio of the Boltzmann probabilities and the ratio of the proposal probabilities. The ratio of the Boltzmann probabilities is:\n$$ \\frac{P(j)}{P(i)} = \\frac{\\exp(-U(j)/(RT))}{\\exp(-U(i)/(RT))} = \\exp\\left(-\\frac{U(j) - U(i)}{RT}\\right) = \\exp\\left(-\\frac{\\Delta U}{RT}\\right) $$\nwhere $\\Delta U = U(j) - U(i)$ is the change in potential energy for the move $i \\to j$.\n\nThe proposal probability $g(i \\to j)$ is the probability of proposing a move to state $j$ given that the system is currently in state $i$. The problem states that from state $i$, there are $K_i$ sterically allowed rotamers (including $i$ itself). A new rotamer is chosen uniformly from the $K_i - 1$ alternatives. Therefore, the probability of proposing a move to a specific rotamer $j$ is:\n$$ g(i \\to j) = \\frac{1}{K_i - 1} $$\nSimilarly, the proposal probability for the reverse move, from $j$ to $i$, depends on the $K_j$ allowed rotamers from state $j$. The probability of picking $i$ from the $K_j - 1$ alternatives to $j$ is:\n$$ g(j \\to i) = \\frac{1}{K_j - 1} $$\nThe proposal mechanism is asymmetric because $K_i \\neq K_j$.\n\nSubstituting these expressions into the acceptance probability formula yields the Metropolis-Hastings acceptance rule:\n$$ A(i \\to j) = \\min\\left(1, \\exp\\left(-\\frac{\\Delta U}{RT}\\right) \\cdot \\frac{g(j \\to i)}{g(i \\to j)}\\right) $$\n$$ A(i \\to j) = \\min\\left(1, \\exp\\left(-\\frac{\\Delta U}{RT}\\right) \\cdot \\frac{1/(K_j - 1)}{1/(K_i - 1)}\\right) $$\n$$ A(i \\to j) = \\min\\left(1, \\frac{K_i - 1}{K_j - 1} \\exp\\left(-\\frac{\\Delta U}{RT}\\right)\\right) $$\nThis is the required expression for the acceptance probability.\n\nNow, we evaluate this expression numerically using the provided data.\nThe change in potential energy is:\n$$ \\Delta U = \\Delta U_{\\mathrm{tor}} + \\Delta U_{\\mathrm{nb}} = +2.3\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1} + (-0.5\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}) = 1.8\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1} $$\nThe thermal energy is:\n$$ RT = (8.314462618 \\times 10^{-3}\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}\\ \\mathrm{K}^{-1}) \\cdot (300\\ \\mathrm{K}) \\approx 2.4943388\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1} $$\nThe argument of the exponential function is:\n$$ -\\frac{\\Delta U}{RT} = -\\frac{1.8\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}}{2.4943388\\ \\mathrm{kJ}\\ \\mathrm{mol}^{-1}} \\approx -0.72164 $$\nThe exponential term is:\n$$ \\exp\\left(-\\frac{\\Delta U}{RT}\\right) \\approx \\exp(-0.72164) \\approx 0.48596 $$\nThe proposal probability ratio is:\n$$ \\frac{K_i - 1}{K_j - 1} = \\frac{3 - 1}{6 - 1} = \\frac{2}{5} = 0.4 $$\nCombining these terms, the argument of the $\\min$ function is:\n$$ \\frac{K_i - 1}{K_j - 1} \\exp\\left(-\\frac{\\Delta U}{RT}\\right) \\approx 0.4 \\times 0.48596 = 0.194384 $$\nFinally, the acceptance probability is:\n$$ A(i \\to j) = \\min(1, 0.194384) = 0.194384 $$\nRounding to four significant figures, the acceptance probability is $0.1944$.\n\nRegarding the modification for state-dependent bias weights: if the proposal from any state used state-dependent bias weights $w_{ik}$ instead of a uniform choice, the specific proposal probabilities $g(i \\to j)$ and $g(j \\to i)$ would be calculated from these weights. Consequently, the simple ratio of counts $\\frac{K_i - 1}{K_j - 1}$ in the acceptance formula would be replaced by the more general ratio of proposal probabilities $\\frac{g(j \\to i)}{g(i \\to j)}$.",
            "answer": "$$\\boxed{0.1944}$$"
        },
        {
            "introduction": "Standard Monte Carlo simulations can struggle to cross high energy barriers, often becoming trapped in local minima and failing to adequately sample the relevant conformational space. This practice  delves into Replica Exchange Monte Carlo (REMC), a powerful enhanced sampling technique designed to overcome this very problem. You will derive the analytical expression for the swap acceptance probability between adjacent temperature replicas and use it to rationally design an efficient simulation, providing a direct link between thermodynamic principles and practical algorithm optimization.",
            "id": "3840243",
            "problem": "A conformational search is performed using Replica Exchange Monte Carlo (REMC) over a narrow temperature range in a coarse-grained biomolecular model. Adjacent replicas at temperatures $T_{1}$ and $T_{2}$ are proposed to swap configurations using the Metropolis criterion. Assume the canonical ensemble and the following well-tested facts about energy fluctuations: the mean internal energy $U(T)$ satisfies $dU/dT = C_{V}(T)$ and, for a system with many weakly coupled degrees of freedom over a narrow temperature interval, the energy distribution at fixed temperature is approximately Gaussian with variance $\\operatorname{Var}(E) = k_{B} T^{2} C_{V}(T)$, where $k_{B}$ is the Boltzmann constant and $C_{V}(T)$ is the heat capacity at constant volume. Over the temperature interval of interest, take $C_{V}(T)$ to be constant and equal to $C_{V}$.\n\nConsider two adjacent replicas with temperatures $T_{1}$ and $T_{2} = r T_{1}$, with $r  1$, whose energies are independent Gaussian random variables $E_{1} \\sim \\mathcal{N}(\\mu_{1}, \\sigma_{1}^{2})$ and $E_{2} \\sim \\mathcal{N}(\\mu_{2}, \\sigma_{2}^{2})$. Using only the canonical ensemble facts stated above, derive from first principles the analytical expression for the expected swap acceptance probability between these two replicas under the Metropolis criterion. Then, for a system with a constant dimensionless heat capacity given by $C_{V}/k_{B} = 100$ and base temperature $T_{1} = 300\\,\\mathrm{K}$, choose the geometric spacing ratio $r$ such that the expected acceptance probability between adjacent replicas equals the target value $0.3$. Round your final value of $r$ to four significant figures. The final answer must be a single real-valued number without units.",
            "solution": "The problem asks for two results: first, the derivation of an analytical expression for the expected swap acceptance probability between two replicas in a Replica Exchange Monte Carlo (REMC) simulation under specific assumptions; second, the calculation of the temperature spacing ratio $r$ that yields a target acceptance probability of $0.3$.\n\n**Part 1: Derivation of the Expected Acceptance Probability**\n\nA swap between two replicas, one at temperature $T_1$ with energy $E_1$ and another at temperature $T_2$ with energy $E_2$, is accepted according to the Metropolis criterion. The acceptance probability $P_{\\text{acc}}$ is given by:\n$$ P_{\\text{acc}}(E_1, E_2) = \\min\\left(1, \\exp\\left(-\\left[\\left(\\frac{E_2}{k_B T_1} + \\frac{E_1}{k_B T_2}\\right) - \\left(\\frac{E_1}{k_B T_1} + \\frac{E_2}{k_B T_2}\\right)\\right]\\right)\\right) $$\nwhere $k_B$ is the Boltzmann constant. Let $\\beta_1 = 1/(k_B T_1)$ and $\\beta_2 = 1/(k_B T_2)$. The expression simplifies to:\n$$ P_{\\text{acc}}(E_1, E_2) = \\min\\left(1, \\exp\\left((E_1 - E_2)(\\beta_1 - \\beta_2)\\right)\\right) $$\nWe define the energy difference $\\Delta E = E_1 - E_2$ and the inverse temperature difference $\\Delta\\beta = \\beta_1 - \\beta_2$. With this, the acceptance probability for specific energy values is:\n$$ P_{\\text{acc}}(\\Delta E) = \\min(1, \\exp(\\Delta E \\Delta\\beta)) $$\nSince $T_2 = rT_1$ with $r  1$, we have $T_2  T_1$, which implies $\\beta_1  \\beta_2$ and thus $\\Delta\\beta  0$.\n\nThe problem states that the energies $E_1$ and $E_2$ are independent Gaussian random variables: $E_1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$ and $E_2 \\sim \\mathcal{N}(\\mu_2, \\sigma_2^2)$. The difference, $\\Delta E = E_1 - E_2$, is also a Gaussian random variable, $\\Delta E \\sim \\mathcal{N}(\\mu_{\\Delta}, \\sigma_{\\Delta}^2)$, with mean and variance given by:\n$$ \\mu_{\\Delta} = \\mathbb{E}[\\Delta E] = \\mathbb{E}[E_1] - \\mathbb{E}[E_2] = \\mu_1 - \\mu_2 $$\n$$ \\sigma_{\\Delta}^2 = \\operatorname{Var}(\\Delta E) = \\operatorname{Var}(E_1) + \\operatorname{Var}(E_2) = \\sigma_1^2 + \\sigma_2^2 $$\n\nWe are given the physical interpretations of these parameters. The mean energy is $\\mu(T) = U(T)$, and its variance is $\\operatorname{Var}(E) = k_B T^2 C_V(T)$. With a constant heat capacity $C_V$, we have:\n$\\mu_1 = U(T_1)$ and $\\mu_2 = U(T_2)$.\n$\\sigma_1^2 = k_B T_1^2 C_V$ and $\\sigma_2^2 = k_B T_2^2 C_V$.\n\nFrom the relation $dU/dT = C_V$, we integrate from $T_1$ to $T_2$:\n$U(T_2) - U(T_1) = \\int_{T_1}^{T_2} C_V dT = C_V(T_2 - T_1)$.\nThus, the mean of the energy difference is:\n$$ \\mu_{\\Delta} = U(T_1) - U(T_2) = -C_V(T_2 - T_1) $$\nThe variance of the energy difference is:\n$$ \\sigma_{\\Delta}^2 = \\sigma_1^2 + \\sigma_2^2 = k_B T_1^2 C_V + k_B T_2^2 C_V = k_B C_V (T_1^2 + T_2^2) $$\n\nThe expected acceptance probability, $\\langle P_{\\text{acc}} \\rangle$, is the average of $P_{\\text{acc}}(\\Delta E)$ over the probability distribution of $\\Delta E$, which is $p(\\Delta E) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{\\Delta}} \\exp\\left(-\\frac{(\\Delta E - \\mu_{\\Delta})^2}{2\\sigma_{\\Delta}^2}\\right)$.\n$$ \\langle P_{\\text{acc}} \\rangle = \\int_{-\\infty}^{\\infty} \\min(1, \\exp(\\Delta E \\Delta\\beta)) p(\\Delta E) d(\\Delta E) $$\nSince $\\Delta\\beta  0$, the term $\\exp(\\Delta E \\Delta\\beta)$ is less than $1$ for $\\Delta E  0$ and greater than $1$ for $\\Delta E  0$. We split the integral at $\\Delta E = 0$:\n$$ \\langle P_{\\text{acc}} \\rangle = \\int_{-\\infty}^{0} \\exp(\\Delta E \\Delta\\beta) p(\\Delta E) d(\\Delta E) + \\int_{0}^{\\infty} 1 \\cdot p(\\Delta E) d(\\Delta E) $$\nThe second integral is the probability $P(\\Delta E \\ge 0)$, which is $1 - \\Phi\\left(\\frac{0 - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) = \\Phi\\left(\\frac{\\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right)$, where $\\Phi(z)$ is the cumulative distribution function (CDF) of the standard normal distribution.\n\nThe first integral, $I_1$, can be evaluated by completing the square in the exponent of the integrand:\n$$ \\Delta E \\Delta\\beta - \\frac{(\\Delta E - \\mu_{\\Delta})^2}{2\\sigma_{\\Delta}^2} = -\\frac{(\\Delta E - (\\mu_{\\Delta} + \\sigma_{\\Delta}^2 \\Delta\\beta))^2}{2\\sigma_{\\Delta}^2} + \\mu_{\\Delta}\\Delta\\beta + \\frac{1}{2}(\\sigma_{\\Delta}\\Delta\\beta)^2 $$\nThis algebraic manipulation allows us to write the integral $I_1$ in terms of another normal distribution's CDF:\n$$ I_1 = \\exp\\left(\\mu_{\\Delta}\\Delta\\beta + \\frac{1}{2}(\\sigma_{\\Delta}\\Delta\\beta)^2\\right) \\int_{-\\infty}^{0} \\frac{1}{\\sqrt{2\\pi}\\sigma_{\\Delta}} \\exp\\left(-\\frac{(\\Delta E - (\\mu_{\\Delta} + \\sigma_{\\Delta}^2 \\Delta\\beta))^2}{2\\sigma_{\\Delta}^2}\\right) d(\\Delta E) $$\nThe integral part is the CDF of a normal distribution with mean $\\mu' = \\mu_{\\Delta} + \\sigma_{\\Delta}^2 \\Delta\\beta$ and standard deviation $\\sigma_{\\Delta}$, evaluated at $0$.\n$$ I_1 = \\exp\\left(\\mu_{\\Delta}\\Delta\\beta + \\frac{1}{2}(\\sigma_{\\Delta}\\Delta\\beta)^2\\right) \\Phi\\left(\\frac{0 - (\\mu_{\\Delta} + \\sigma_{\\Delta}^2 \\Delta\\beta)}{\\sigma_{\\Delta}}\\right) $$\nCombining the terms, the analytical expression for the expected acceptance probability is:\n$$ \\langle P_{\\text{acc}} \\rangle = \\exp\\left(\\mu_{\\Delta}\\Delta\\beta + \\frac{1}{2}\\sigma_{\\Delta}^2(\\Delta\\beta)^2\\right) \\Phi\\left(-\\frac{\\mu_{\\Delta} + \\sigma_{\\Delta}^2\\Delta\\beta}{\\sigma_{\\Delta}}\\right) + \\Phi\\left(\\frac{\\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) $$\n\n**Part 2: Calculation of the Temperature Ratio r**\n\nWe are given $C_V/k_B = 100$, $T_1 = 300\\,\\mathrm{K}$, and a target $\\langle P_{\\text{acc}} \\rangle = 0.3$. We are to find the ratio $r=T_2/T_1$. Let's express the arguments of the derived formula in terms of $r$ and the dimensionless heat capacity $\\mathcal{C} = C_V/k_B = 100$.\n\n- $\\Delta\\beta = \\frac{1}{k_B T_1} - \\frac{1}{k_B T_2} = \\frac{1}{k_B T_1}\\left(1 - \\frac{1}{r}\\right) = \\frac{r-1}{rk_BT_1}$\n- $\\mu_{\\Delta} = -C_V(T_2 - T_1) = -k_B\\mathcal{C}T_1(r-1)$\n- $\\sigma_{\\Delta}^2 = k_B C_V (T_1^2 + T_2^2) = k_B^2\\mathcal{C}T_1^2(1+r^2)$\n- $\\sigma_{\\Delta} = k_B T_1\\sqrt{\\mathcal{C}(1+r^2)}$\n\nNow we calculate the key dimensionless groups in the $\\langle P_{\\text{acc}} \\rangle$ formula:\n- The argument for the second $\\Phi$ term:\n  $$ \\frac{\\mu_{\\Delta}}{\\sigma_{\\Delta}} = \\frac{-k_B\\mathcal{C}T_1(r-1)}{k_B T_1\\sqrt{\\mathcal{C}(1+r^2)}} = -\\sqrt{\\mathcal{C}}\\frac{r-1}{\\sqrt{1+r^2}} $$\n- The exponent in the first term simplifies to:\n  $$ \\mu_{\\Delta}\\Delta\\beta + \\frac{1}{2}\\sigma_{\\Delta}^2(\\Delta\\beta)^2 = \\frac{\\mathcal{C}(r-1)^4}{2r^2} $$\n- The argument for the first $\\Phi$ term simplifies to:\n  $$ -\\frac{\\mu_{\\Delta} + \\sigma_{\\Delta}^2\\Delta\\beta}{\\sigma_{\\Delta}} = -\\frac{\\sqrt{\\mathcal{C}}(r-1)(r^2-r+1)}{r\\sqrt{1+r^2}} $$\n\nSubstituting $\\mathcal{C}=100$, we must solve the following transcendental equation for $r$:\n$$ 0.3 = \\exp\\left(\\frac{100(r-1)^4}{2r^2}\\right) \\Phi\\left(-\\frac{10(r-1)(r^2-r+1)}{r\\sqrt{1+r^2}}\\right) + \\Phi\\left(-\\frac{10(r-1)}{\\sqrt{1+r^2}}\\right) $$\nThis equation does not have a simple analytical solution for $r$ and must be solved numerically. We can define a function $f(r)$ representing the right-hand side and find the root of $f(r) - 0.3 = 0$.\n\nTesting values of $r$ close to 1:\n- For $r = 1.15$, $\\langle P_{\\text{acc}} \\rangle \\approx 0.323$\n- For $r = 1.16$, $\\langle P_{\\text{acc}} \\rangle \\approx 0.294$\nThe desired value of $r$ is between $1.15$ and $1.16$. A more precise numerical search or interpolation leads to $r \\approx 1.158$.\nLet's verify this value:\nFor $r=1.158$:\n- Argument of the second $\\Phi$ term: $-\\frac{10(0.158)}{\\sqrt{1+1.158^2}} \\approx -1.0327$.\n- $\\Phi(-1.0327) \\approx 0.1509$.\n- Exponent term: $\\exp\\left(\\frac{100(0.158)^4}{2(1.158)^2}\\right) \\approx \\exp(0.02324) \\approx 1.0235$.\n- Argument of first $\\Phi$ term: $-\\frac{10(0.158)(1.158^2 - 1.158 + 1)}{1.158\\sqrt{1+1.158^2}} \\approx -1.0549$.\n- $\\Phi(-1.0549) \\approx 0.1457$.\n- $\\langle P_{\\text{acc}} \\rangle \\approx 1.0235 \\times 0.1457 + 0.1509 \\approx 0.1491 + 0.1509 = 0.3000$.\nThe value $r = 1.158$ gives the desired acceptance probability. Rounding to four significant figures, the result is $1.158$.",
            "answer": "$$\\boxed{1.158}$$"
        }
    ]
}