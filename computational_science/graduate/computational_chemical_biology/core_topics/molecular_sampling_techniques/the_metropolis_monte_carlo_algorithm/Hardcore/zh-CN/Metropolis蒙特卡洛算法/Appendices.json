{
    "hands_on_practices": [
        {
            "introduction": "Metropolis蒙特卡洛模拟中的每一步都始于为提议的构象变化计算能量变化量 $\\Delta U$。本练习将重点放在这一基础计算上，通过一个模拟生物分子中常见的局部运动——肽二面角旋转——的真实势能函数来进行实践。掌握能量计算是至关重要的，因为整个模拟的准确性都建立在对能量景观的正确评估之上。",
            "id": "3866303",
            "problem": "在 Metropolis Monte Carlo (MMC) 模拟中，提出了一个分子力学模型中的肽主链二面角旋转。单个二面角的势能的扭转贡献由以下函数建模：\n$$\nU_{\\text{dihedral}}(\\phi) \\;=\\; \\sum_{k=1}^{3} K_{k}\\left[1+\\cos\\!\\left(n_{k}\\,\\phi-\\delta_{k}\\right)\\right],\n$$\n其中 $\\phi$ 是二面角，单位为弧度；$K_{k}$ 是扭转振幅，单位为 $\\mathrm{kJ\\,mol^{-1}}$；$n_{k}$ 是周期性；$\\delta_{k}$ 是相位偏移，单位为弧度。在温度为 $T$ 的正则系综中，MMC 方法将玻尔兹曼分布应用于势能差，但在这里，你必须计算由所提出的二面角旋转本身引起的能量变化。\n\n考虑一个肽二面角初始位于 $\\phi_{\\mathrm{i}} = -0.8$ 弧度。一个试探移动提出了 $\\Delta\\phi = 0.6$ 弧度的旋转，得到候选角度 $\\phi_{\\mathrm{f}} = \\phi_{\\mathrm{i}} + \\Delta\\phi$。扭转参数为：\n- $K_{1} = 2.3$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{1} = 1$，$\\delta_{1} = 0.4$ 弧度；\n- $K_{2} = 1.7$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{2} = 3$，$\\delta_{2} = -1.1$ 弧度；\n- $K_{3} = 0.9$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{3} = 2$，$\\delta_{3} = 2.2$ 弧度。\n\n仅使用所提供的扭转势和统计力学的定义，计算此次提议旋转的能量变化\n$$\n\\Delta U \\;=\\; U_{\\text{dihedral}}(\\phi_{\\mathrm{f}}) \\;-\\; U_{\\text{dihedral}}(\\phi_{\\mathrm{i}})\n$$\n。所有三角函数均使用弧度。以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示最终的能量变化，并将答案四舍五入到四位有效数字。",
            "solution": "该问题要求计算肽主链二面角在一次提议的旋转中所产生的扭转势能变化 $\\Delta U$。该问题具有科学依据，表述清晰，并提供了直接计算所需的所有信息。因此，该问题被认为是有效的。\n\n势能变化 $\\Delta U$ 定义为最终势能 $U_{\\text{dihedral}}(\\phi_{\\mathrm{f}})$ 与初始势能 $U_{\\text{dihedral}}(\\phi_{\\mathrm{i}})$ 之差：\n$$\n\\Delta U = U_{\\text{dihedral}}(\\phi_{\\mathrm{f}}) - U_{\\text{dihedral}}(\\phi_{\\mathrm{i}})\n$$\n首先，我们确定初始和最终的二面角。初始角度为 $\\phi_{\\mathrm{i}} = -0.8$ 弧度。一个试探移动提出了 $\\Delta\\phi = 0.6$ 弧度的旋转。因此，最终角度 $\\phi_{\\mathrm{f}}$ 为：\n$$\n\\phi_{\\mathrm{f}} = \\phi_{\\mathrm{i}} + \\Delta\\phi = -0.8 + 0.6 = -0.2 \\text{ radians}\n$$\n扭转势能 $U_{\\text{dihedral}}(\\phi)$ 由以下函数给出：\n$$\nU_{\\text{dihedral}}(\\phi) = \\sum_{k=1}^{3} K_{k}\\left[1+\\cos(n_{k}\\,\\phi-\\delta_{k})\\right]\n$$\n我们可以通过将此函数代入 $\\Delta U$ 的定义来表示能量变化 $\\Delta U$：\n$$\n\\Delta U = \\sum_{k=1}^{3} K_{k}\\left[1+\\cos(n_{k}\\,\\phi_{\\mathrm{f}}-\\delta_{k})\\right] - \\sum_{k=1}^{3} K_{k}\\left[1+\\cos(n_{k}\\,\\phi_{\\mathrm{i}}-\\delta_{k})\\right]\n$$\n通过合并求和并简化，括号内的常数 $1$ 被消去：\n$$\n\\Delta U = \\sum_{k=1}^{3} K_{k} \\left( [1+\\cos(n_{k}\\,\\phi_{\\mathrm{f}}-\\delta_{k})] - [1+\\cos(n_{k}\\,\\phi_{\\mathrm{i}}-\\delta_{k})] \\right)\n$$\n$$\n\\Delta U = \\sum_{k=1}^{3} K_{k} \\left[ \\cos(n_{k}\\,\\phi_{\\mathrm{f}}-\\delta_{k}) - \\cos(n_{k}\\,\\phi_{\\mathrm{i}}-\\delta_{k}) \\right]\n$$\n该表达式允许直接计算能量变化。我们现在计算求和中三项的贡献，记为 $\\Delta U_k$。\n\n对于项 $k=1$：\n参数为 $K_{1} = 2.3$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{1} = 1$，$\\delta_{1} = 0.4$ 弧度。\n初始角度的余弦函数自变量为 $n_{1}\\phi_{\\mathrm{i}}-\\delta_{1} = (1)(-0.8) - 0.4 = -1.2$ 弧度。\n最终角度的余弦函数自变量为 $n_{1}\\phi_{\\mathrm{f}}-\\delta_{1} = (1)(-0.2) - 0.4 = -0.6$ 弧度。\n该项的能量变化为：\n$$\n\\Delta U_1 = K_{1} \\left[ \\cos(-0.6) - \\cos(-1.2) \\right] = 2.3 \\left[ \\cos(0.6) - \\cos(1.2) \\right]\n$$\n$$\n\\Delta U_1 \\approx 2.3 \\times (0.8253356 - 0.3623577) = 2.3 \\times (0.4629779) \\approx 1.064849 \\text{ kJ mol}^{-1}\n$$\n\n对于项 $k=2$：\n参数为 $K_{2} = 1.7$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{2} = 3$，$\\delta_{2} = -1.1$ 弧度。\n初始角度的自变量为 $n_{2}\\phi_{\\mathrm{i}}-\\delta_{2} = (3)(-0.8) - (-1.1) = -2.4 + 1.1 = -1.3$ 弧度。\n最终角度的自变量为 $n_{2}\\phi_{\\mathrm{f}}-\\delta_{2} = (3)(-0.2) - (-1.1) = -0.6 + 1.1 = 0.5$ 弧度。\n该项的能量变化为：\n$$\n\\Delta U_2 = K_{2} \\left[ \\cos(0.5) - \\cos(-1.3) \\right] = 1.7 \\left[ \\cos(0.5) - \\cos(1.3) \\right]\n$$\n$$\n\\Delta U_2 \\approx 1.7 \\times (0.8775826 - 0.2674988) = 1.7 \\times (0.6100838) \\approx 1.037142 \\text{ kJ mol}^{-1}\n$$\n\n对于项 $k=3$：\n参数为 $K_{3} = 0.9$ $\\mathrm{kJ\\,mol^{-1}}$，$n_{3} = 2$，$\\delta_{3} = 2.2$ 弧度。\n初始角度的自变量为 $n_{3}\\phi_{\\mathrm{i}}-\\delta_{3} = (2)(-0.8) - 2.2 = -1.6 - 2.2 = -3.8$ 弧度。\n最终角度的自变量为 $n_{3}\\phi_{\\mathrm{f}}-\\delta_{3} = (2)(-0.2) - 2.2 = -0.4 - 2.2 = -2.6$ 弧度。\n该项的能量变化为：\n$$\n\\Delta U_3 = K_{3} \\left[ \\cos(-2.6) - \\cos(-3.8) \\right] = 0.9 \\left[ \\cos(2.6) - \\cos(3.8) \\right]\n$$\n$$\n\\Delta U_3 \\approx 0.9 \\times (-0.8560751 - (-0.7909677)) = 0.9 \\times (-0.0651074) \\approx -0.058597 \\text{ kJ mol}^{-1}\n$$\n\n总势能变化是这些单独贡献的总和：\n$$\n\\Delta U = \\Delta U_1 + \\Delta U_2 + \\Delta U_3\n$$\n$$\n\\Delta U \\approx 1.064849 + 1.037142 - 0.058597 \\approx 2.043394 \\text{ kJ mol}^{-1}\n$$\n问题要求最终答案四舍五入到四位有效数字。\n$$\n\\Delta U \\approx 2.043 \\text{ kJ mol}^{-1}\n$$",
            "answer": "$$\\boxed{2.043}$$"
        },
        {
            "introduction": "在计算出能量变化 $\\Delta U$ 后，下一步是应用Metropolis接受准则来决定是否接受该构象变化。本练习不仅要求计算 $\\Delta U$，还要求进一步计算最终的接受概率 $P_{\\text{acc}} = \\min(1, \\exp(-\\Delta U / k_B T))$，这一过程基于一个简化的配体-受体相互作用模型。通过这个练习，你将巩固Metropolis蒙特卡洛算法的核心逻辑，即将能量计算与概率决策相结合，使系统能够根据玻尔兹曼分布探索构象空间。",
            "id": "3866338",
            "problem": "一个具有两个相互作用位点的小分子配体结合在水环境中一个带电的受体口袋附近。考虑一个提议的配体绕 $z$ 轴的刚体旋转，角度为 $\\theta = \\pi/2$（右手系，配体坐标的主动旋转），而受体保持固定。势能由一个 Lennard-Jones (LJ) $12$–$6$ 项和一个屏蔽静电项之和来建模。从正则系综和 Metropolis Monte Carlo (MMC) 算法的定义出发，计算在指定力场下此提议移动的能量变化 $\\Delta U$，然后评估在温度 $T$ 下的 MMC 接受概率。\n\n使用以下科学上一致的设置和常数：\n- 几何结构（所有位置单位为纳米）：受体原子位于 $\\mathbf{R}_1 = (0, 0, 0)$ 和 $\\mathbf{R}_2 = (1.0, 0, 0)$；配体原子初始位于 $\\mathbf{L}_1 = (0.5, 0.5, 0)$ 和 $\\mathbf{L}_2 = (0.5, -0.5, 0)$。提议的绕 $z$ 轴旋转 $\\theta = \\pi/2$ 将 $(x, y, z)$ 映射为 $(-y, x, z)$，得到 $\\mathbf{L}_1' = (-0.5, 0.5, 0)$ 和 $\\mathbf{L}_2' = (0.5, 0.5, 0)$。\n- 部分电荷（以基本电荷单位 $e$ 计）：$q_{\\mathrm{L}_1} = +0.20$，$q_{\\mathrm{L}_2} = -0.20$，$Q_{\\mathrm{R}_1} = -0.50$，$Q_{\\mathrm{R}_2} = -0.50$。\n- 非键参数：LJ 采用 Lorentz–Berthelot 混合规则，位点参数为 $\\sigma_{\\mathrm{L}} = 0.50$ 和 $\\epsilon_{\\mathrm{L}} = 0.25$（对配体原子），$\\sigma_{\\mathrm{R}} = 0.50$ 和 $\\epsilon_{\\mathrm{R}} = 0.25$（对受体原子），单位分别为纳米和千焦耳/摩尔。因此，对于任何配体-受体对，$\\sigma_{ij} = (\\sigma_{\\mathrm{L}} + \\sigma_{\\mathrm{R}})/2$ 且 $\\epsilon_{ij} = \\sqrt{\\epsilon_{\\mathrm{L}} \\epsilon_{\\mathrm{R}}}$。\n- 力场能量项，对于分离距离为 $r$ 的配体-受体对：LJ 能量 $U_{\\mathrm{LJ}}(r) = 4 \\epsilon_{ij} \\left[ \\left( \\frac{\\sigma_{ij}}{r} \\right)^{12} - \\left( \\frac{\\sigma_{ij}}{r} \\right)^6 \\right]$；屏蔽库仑能量 $U_{\\mathrm{coul}}(r) = \\frac{k_e}{\\varepsilon_r} \\frac{q_i q_j}{r}$，其中 $k_e = 138.935456$ $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}\\,e^{-2}$，相对介电常数 $\\varepsilon_r = 80$（水环境）。\n- 温度：$T = 300$ $\\mathrm{K}$；玻尔兹曼常数 $k_B = 8.314462618 \\times 10^{-3}$ $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。\n\n假设只有配体-受体非键相互作用对此次移动的能量变化有贡献。计算旋转后的总能量变化 $\\Delta U$，并利用与正则系综和细致平衡条件一致的第一性原理，评估此移动的 Metropolis 接受概率。仅报告接受概率，以十进制数表示，四舍五入至四位有效数字，不带单位。",
            "solution": "该问题要求计算一个提议的配体分子在受体附近的刚体旋转的 Metropolis Monte Carlo (MMC) 接受概率。解决方案必须从第一性原理推导，以正则系综和 MMC 算法的原则为起点，并利用所提供的力场模型。\n\nMetropolis Monte Carlo 算法是一种从概率分布中采样构型的方法。在正则 ($NVT$) 系综中，系统处于具有势能 $U_i$ 的微观态 $i$ 的平衡概率 $\\pi_i$ 由玻尔兹曼分布给出：\n$$ \\pi_i = \\frac{1}{Z} \\exp\\left(-\\frac{U_i}{k_B T}\\right) $$\n其中 $Z$ 是正则配分函数，$k_B$ 是玻尔兹曼常数，$T$ 是绝对温度。MMC 算法生成一系列状态（一个马尔可夫链），其极限分布就是这个玻尔兹曼分布。从旧状态 $o$ 到新状态 $n$ 的移动以概率 $P_{acc}$ 被接受，该概率满足细致平衡条件，$\\pi_o P(o \\to n) = \\pi_n P(n \\to o)$。接受概率的标准选择是 Metropolis 判据：\n$$ P_{acc} = \\min\\left(1, \\frac{\\pi_n}{\\pi_o}\\right) = \\min\\left(1, \\exp\\left(-\\frac{U_n - U_o}{k_B T}\\right)\\right) = \\min\\left(1, \\exp\\left(-\\frac{\\Delta U}{k_B T}\\right)\\right) $$\n这里，$\\Delta U = U_n - U_o$ 是提议移动的势能变化。我们的任务是计算这个 $\\Delta U$ 并随后计算接受概率 $P_{acc}$。\n\n系统的总势能 $U$ 是配体和受体原子之间的 Lennard-Jones ($U_{\\mathrm{LJ}}$) 和屏蔽静电 ($U_{\\mathrm{coul}}$) 相互作用之和。根据规定，我们只考虑这些分子间相互作用。总共有四个这样的相互作用对：$(\\mathbf{R}_1, \\mathbf{L}_1)$、$(\\mathbf{R}_1, \\mathbf{L}_2)$、$(\\mathbf{R}_2, \\mathbf{L}_1)$ 和 $(\\mathbf{R}_2, \\mathbf{L}_2)$。\n给定构型的总能量为 $U = \\sum_{i=1}^2 \\sum_{j=1}^2 U(\\mathbf{R}_i, \\mathbf{L}_j)$，其中 $U(\\mathbf{A}, \\mathbf{B}) = U_{\\mathrm{LJ}}(r_{AB}) + U_{\\mathrm{coul}}(r_{AB})$ 且 $r_{AB} = \\|\\mathbf{A} - \\mathbf{B}\\|$。\n\n首先，我们使用 Lorentz–Berthelot 组合规则确定混合的非键参数：\n配体参数：$\\sigma_{\\mathrm{L}} = 0.50\\,\\mathrm{nm}$，$\\epsilon_{\\mathrm{L}} = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n受体参数：$\\sigma_{\\mathrm{R}} = 0.50\\,\\mathrm{nm}$，$\\epsilon_{\\mathrm{R}} = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n对于任何配体-受体对 $(ij)$：\n$$ \\sigma_{ij} = \\frac{\\sigma_{\\mathrm{L}} + \\sigma_{\\mathrm{R}}}{2} = \\frac{0.50\\,\\mathrm{nm} + 0.50\\,\\mathrm{nm}}{2} = 0.50\\,\\mathrm{nm} $$\n$$ \\epsilon_{ij} = \\sqrt{\\epsilon_{\\mathrm{L}} \\epsilon_{\\mathrm{R}}} = \\sqrt{(0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}) \\times (0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1})} = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n因此，所有配体-受体对共享相同的 Lennard-Jones 参数 $\\sigma_{ij} = 0.50\\,\\mathrm{nm}$ 和 $\\epsilon_{ij} = 0.25\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n\n接下来，我们计算初始状态的能量 $U_o$。初始坐标为：$\\mathbf{R}_1=(0,0,0)$、$\\mathbf{R}_2=(1.0,0,0)$、$\\mathbf{L}_1=(0.5,0.5,0)$ 和 $\\mathbf{L}_2=(0.5,-0.5,0)$。距离为：\n$$ r_{R_1 L_1} = \\|(0.5, 0.5, 0) - (0, 0, 0)\\| = \\sqrt{0.5^2 + 0.5^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n$$ r_{R_1 L_2} = \\|(0.5, -0.5, 0) - (0, 0, 0)\\| = \\sqrt{0.5^2 + (-0.5)^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n$$ r_{R_2 L_1} = \\|(0.5, 0.5, 0) - (1.0, 0, 0)\\| = \\sqrt{(-0.5)^2 + 0.5^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n$$ r_{R_2 L_2} = \\|(0.5, -0.5, 0) - (1.0, 0, 0)\\| = \\sqrt{(-0.5)^2 + (-0.5)^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n所有初始距离均相同，$r_o = \\sqrt{0.5}\\,\\mathrm{nm}$。\n距离为 $r_o$ 的一个对的 Lennard-Jones 能量为：\n$$ U_{\\mathrm{LJ}}(r_o) = 4 \\epsilon_{ij} \\left[ \\left(\\frac{\\sigma_{ij}}{r_o}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r_o}\\right)^6 \\right] = 4(0.25) \\left[ \\left(\\frac{0.50}{\\sqrt{0.5}}\\right)^{12} - \\left(\\frac{0.50}{\\sqrt{0.5}}\\right)^6 \\right] $$\n$$ U_{\\mathrm{LJ}}(r_o) = 1.0 \\left[ \\left(\\frac{1}{\\sqrt{2}}\\right)^{12} - \\left(\\frac{1}{\\sqrt{2}}\\right)^6 \\right] = \\left(\\frac{1}{2^6} - \\frac{1}{2^3}\\right) = \\frac{1}{64} - \\frac{8}{64} = -\\frac{7}{64}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n初始总 LJ 能量为 $U_{\\mathrm{LJ}, o} = 4 \\times U_{\\mathrm{LJ}}(r_o) = 4 \\times (-\\frac{7}{64}) = -\\frac{7}{16}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n初始总库仑能量为：\n$$ U_{\\mathrm{coul}, o} = \\frac{k_e}{\\varepsilon_r r_o} \\sum_{i,j} q_{\\mathrm{L}_j} Q_{\\mathrm{R}_i} = \\frac{k_e}{\\varepsilon_r \\sqrt{0.5}} \\left[ (+0.2)(-0.5) + (-0.2)(-0.5) + (+0.2)(-0.5) + (-0.2)(-0.5) \\right] $$\n$$ U_{\\mathrm{coul}, o} = \\frac{k_e}{\\varepsilon_r \\sqrt{0.5}} \\left[ -0.10 + 0.10 - 0.10 + 0.10 \\right] = 0 $$\n因此，初始总能量为 $U_o = U_{\\mathrm{LJ}, o} + U_{\\mathrm{coul}, o} = -\\frac{7}{16}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n\n现在，我们计算最终状态的能量 $U_n$。提议的移动是绕 $z$ 轴旋转 $\\theta=\\pi/2$，将 $(x,y,z)$ 映射为 $(-y,x,z)$。新的配体坐标为 $\\mathbf{L}_1' = (-0.5, 0.5, 0)$ 和 $\\mathbf{L}_2' = (0.5, 0.5, 0)$。新的距离为：\n$$ r'_{R_1 L_1} = \\|(-0.5, 0.5, 0) - (0, 0, 0)\\| = \\sqrt{(-0.5)^2 + 0.5^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n$$ r'_{R_1 L_2} = \\|(0.5, 0.5, 0) - (0, 0, 0)\\| = \\sqrt{0.5^2 + 0.5^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n$$ r'_{R_2 L_1} = \\|(-0.5, 0.5, 0) - (1.0, 0, 0)\\| = \\sqrt{(-1.5)^2 + 0.5^2} = \\sqrt{2.25 + 0.25} = \\sqrt{2.5}\\,\\mathrm{nm} $$\n$$ r'_{R_2 L_2} = \\|(0.5, 0.5, 0) - (1.0, 0, 0)\\| = \\sqrt{(-0.5)^2 + 0.5^2} = \\sqrt{0.5}\\,\\mathrm{nm} $$\n三对的距离为 $r_1' = \\sqrt{0.5}\\,\\mathrm{nm}$，一对（R2-L1）的距离为 $r_2' = \\sqrt{2.5}\\,\\mathrm{nm}$。\n最终总 LJ 能量 $U_{\\mathrm{LJ}, n}$ 是这些对的贡献之和。对于距离为 $r_2'=\\sqrt{2.5}$ 的对：\n$$ U_{\\mathrm{LJ}}(r_2') = 1.0 \\left[ \\left(\\frac{0.50}{\\sqrt{2.5}}\\right)^{12} - \\left(\\frac{0.50}{\\sqrt{2.5}}\\right)^6 \\right] = \\left(\\frac{1}{\\sqrt{10}}\\right)^{12} - \\left(\\frac{1}{\\sqrt{10}}\\right)^6 = \\frac{1}{10^6} - \\frac{1}{10^3} = -\\frac{999}{10^6}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n最终总 LJ 能量为：\n$$ U_{\\mathrm{LJ}, n} = 3 \\times U_{\\mathrm{LJ}}(r_1') + 1 \\times U_{\\mathrm{LJ}}(r_2') = 3 \\times \\left(-\\frac{7}{64}\\right) - \\frac{999}{10^6} = -\\frac{21}{64} - 0.000999\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n最终总库仑能量为：\n$$ U_{\\mathrm{coul}, n} = \\frac{k_e}{\\varepsilon_r} \\left[ \\frac{q_{L_1}Q_{R_1}}{r'_{R_1 L_1}} + \\frac{q_{L_2}Q_{R_1}}{r'_{R_1 L_2}} + \\frac{q_{L_1}Q_{R_2}}{r'_{R_2 L_1}} + \\frac{q_{L_2}Q_{R_2}}{r'_{R_2 L_2}} \\right] $$\n$$ U_{\\mathrm{coul}, n} = \\frac{k_e}{\\varepsilon_r} \\left[ \\frac{(-0.10)}{\\sqrt{0.5}} + \\frac{(+0.10)}{\\sqrt{0.5}} + \\frac{(-0.10)}{\\sqrt{2.5}} + \\frac{(+0.10)}{\\sqrt{0.5}} \\right] = \\frac{k_e}{\\varepsilon_r} \\left[ \\frac{0.10}{\\sqrt{0.5}} - \\frac{0.10}{\\sqrt{2.5}} \\right] $$\n最终总能量为 $U_n = U_{\\mathrm{LJ}, n} + U_{\\mathrm{coul}, n}$。\n\n能量变化为 $\\Delta U = U_n - U_o = (U_{\\mathrm{LJ}, n} - U_{\\mathrm{LJ}, o}) + (U_{\\mathrm{coul}, n} - U_{\\mathrm{coul}, o})$。\n$$ \\Delta U_{\\mathrm{LJ}} = \\left(-\\frac{21}{64} - 0.000999\\right) - \\left(-\\frac{7}{16}\\right) = -\\frac{21}{64} + \\frac{28}{64} - 0.000999 = \\frac{7}{64} - 0.000999\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n$$ \\Delta U_{\\mathrm{coul}} = U_{\\mathrm{coul}, n} - 0 = 0.10 \\frac{k_e}{\\varepsilon_r} \\left( \\frac{1}{\\sqrt{0.5}} - \\frac{1}{\\sqrt{2.5}} \\right)\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n现在我们代入数值：\n$$ \\Delta U_{\\mathrm{LJ}} = 0.109375 - 0.000999 = 0.108376\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n$$ \\Delta U_{\\mathrm{coul}} = 0.10 \\times \\frac{138.935456}{80} \\left( \\frac{1}{\\sqrt{0.5}} - \\frac{1}{\\sqrt{2.5}} \\right) \\approx 0.173669 \\times (1.414214 - 0.632456) \\approx 0.135753\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n总能量变化：\n$$ \\Delta U = \\Delta U_{\\mathrm{LJ}} + \\Delta U_{\\mathrm{coul}} \\approx 0.108376 + 0.135753 = 0.244129\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n能量变为正，表示新状态在能量上是不利的。\n\n最后，我们计算接受概率。热能为：\n$$ k_B T = (8.314462618 \\times 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}) \\times (300\\,\\mathrm{K}) \\approx 2.494339\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1} $$\n由于 $\\Delta U > 0$，接受概率为：\n$$ P_{acc} = \\exp\\left(-\\frac{\\Delta U}{k_B T}\\right) = \\exp\\left(-\\frac{0.244129}{2.494339}\\right) \\approx \\exp(-0.097873) \\approx 0.90676 $$\n四舍五入到四位有效数字，接受概率为 $0.9068$。",
            "answer": "$$\\boxed{0.9068}$$"
        },
        {
            "introduction": "运行模拟是一回事，但知道何时停止则是另一回事。我们如何确信模拟已经充分采样了平衡态？本练习介绍了一个关键的收敛诊断工具——Gelman-Rubin统计量（$\\hat{R}$），它通过比较多个并行模拟链的内部方差和链间方差来评估收敛性。通过学习计算和解释 $\\hat{R}$ 值，你将掌握一项评估MCMC模拟结果可靠性和稳健性的关键技能，这是严谨计算研究的基石。",
            "id": "3866365",
            "problem": "使用Metropolis算法在固定温度$T$下，对一个结合在酶活性位点的小分子配体进行模拟。模拟的目标是玻尔兹曼分布，其概率密度与$\\exp(-\\beta E(\\mathbf{x}))$成正比，其中$\\beta = 1/(k_B T)$，$k_B$是玻尔兹曼常数，$E(\\mathbf{x})$是构象$\\mathbf{x}$的势能，移动是从一个对称的提议分布中提出的。考虑一个标量可观测量$h(\\mathbf{x})$，它报告某一快照中蛋白质-配体氢键的瞬时数量。运行四条独立的Metropolis轨迹，每条轨迹都从过度分散的构象初始化，并从每条轨迹收集$n = 50$个老化期后的样本。$h$的每条轨迹的样本均值为\n$$\\bar{h}_1 = 2.90,\\quad \\bar{h}_2 = 3.10,\\quad \\bar{h}_3 = 3.35,\\quad \\bar{h}_4 = 3.65,$$\n相应的每条轨迹的样本方差为\n$$s_1^2 = 0.50,\\quad s_2^2 = 0.55,\\quad s_3^2 = 0.65,\\quad s_4^2 = 0.70.$$\n从Metropolis蒙特卡洛的玻尔兹曼目标、马尔可夫链蒙特卡洛（MCMC）的平稳性收敛思想以及全方差定律的基本定义出发，推导出来自$m$条独立Metropolis轨迹的标量可观测量Gelman-Rubin潜在标度缩减因子$\\hat{R}$，然后为给定数据计算$\\hat{R}$。解释计算出的值在计算化学生物学中收敛性评估方面的意义。将最终数值答案四舍五入至四位有效数字，并以无量纲数表示。",
            "solution": "该问题要求推导Gelman-Rubin潜在标度缩减因子$\\hat{R}$，根据给定的模拟数据进行计算，并解释其结果。该问题具有科学依据，提法恰当且客观，并提供了所有必要数据。因此，我们开始求解。\n\nGelman-Rubin诊断是用于马尔可夫链蒙特卡洛（MCMC）模拟的一种收敛性诊断方法。它通过比较多个平行链的链内方差与这些链之间的链间方差来评估收敛性。其基本前提是，如果所有链都已收敛到目标平稳分布（此处为玻尔兹曼分布），那么它们各自的统计特性应彼此无法区分，也无法与它们的混合体的特性区分开来。$\\hat{R}$的推导植根于这种比较，其概念源于全方差定律。\n\n设$h$为我们感兴趣的标量可观测量，即蛋白质-配体氢键的数量。我们有$m$条独立的MCMC轨迹（链），从每条链$i$（其中$i=1, \\dots, m$）中，我们收集$n$个老化期后的样本，记为$h_{ij}$，其中$j=1, \\dots, n$。\n\n目标是估计平稳分布下可观测量的真实方差$\\sigma^2 = \\text{Var}(h)$。Gelman-Rubin方法为$\\sigma^2$构建了两个估计量。\n\n首先，我们估计每条链*内部*的方差。链$i$的样本均值为：\n$$ \\bar{h}_i = \\frac{1}{n} \\sum_{j=1}^{n} h_{ij} $$\n链$i$的样本方差为：\n$$ s_i^2 = \\frac{1}{n-1} \\sum_{j=1}^{n} (h_{ij} - \\bar{h}_i)^2 $$\n合并链内方差$W$是这些单个样本方差的平均值：\n$$ W = \\frac{1}{m} \\sum_{i=1}^{m} s_i^2 $$\n如果这些链尚未探索整个状态空间（即它们尚未完全收敛），那么每个$s_i^2$都是平稳分布受限部分内部方差的估计。因此，$W$很可能是对真实总方差$\\sigma^2$的*低估*。\n\n其次，我们估计链*之间*的方差。这通过链样本均值的方差来捕捉。所有链的所有样本的总均值为：\n$$ \\bar{h} = \\frac{1}{m} \\sum_{i=1}^{m} \\bar{h}_i = \\frac{1}{mn} \\sum_{i=1}^{m} \\sum_{j=1}^{n} h_{ij} $$\n链间方差$B$被定义为链均值的缩放样本方差：\n$$ B = \\frac{n}{m-1} \\sum_{i=1}^{m} (\\bar{h}_i - \\bar{h})^2 $$\n缩放因子$n$确保$B$是$\\sigma^2$的估计量，而不是$\\sigma^2/n$的估计量。如果链从过度分散的位置开始，链均值$\\bar{h}_i$的离散程度将比从单一分布进行纯粹抽样误差所预期的要大。这意味着$B$提供了关于链之间已探索的状态空间部分的信息。\n\n全方差定律为组合这些方差分量提供了概念基础。对于一个随机变量$Y$和一个分组变量$X$，有$\\text{Var}(Y) = E[\\text{Var}(Y|X)] + \\text{Var}(E[Y|X])$。在我们的情境中，$Y$是可观测量$h$，$X$是链索引$i$。$W$是第一项$E_i[\\text{Var}(h|\\text{chain } i)]$的基于样本的估计量。$B/n$是与第二项$\\text{Var}_i(E[h|\\text{chain } i])$相关的基于样本的估计量。\n\nGelman和Rubin为目标方差提出了一个合并估计量$\\hat{\\sigma}^2_+$，它是$W$和$B$的加权平均值：\n$$ \\hat{\\sigma}^2_+ = \\frac{n-1}{n} W + \\frac{1}{n} B $$\n这个量代表了由合并所有$m$条链形成的混合分布中可观测量方差的估计。如果链相对于目标分布是从过度分散的起始点开始的，那么这个混合分布会比目标分布本身更宽，至少在链完全收敛之前是这样。因此，$\\hat{\\sigma}^2_+$预期会是真实方差$\\sigma^2$的*高估*。\n\n潜在标度缩减因子$\\hat{R}$被定义为高估方差与低估方差之比。它量化了如果模拟运行更长时间，当前分布的标度（由$\\sqrt{\\hat{\\sigma}^2_+}$估计）可能缩减的潜力。\n$$ \\hat{R} = \\sqrt{\\frac{\\hat{\\sigma}^2_+}{W}} $$\n代入$\\hat{\\sigma}^2_+$的表达式：\n$$ \\hat{R} = \\sqrt{\\frac{\\frac{n-1}{n} W + \\frac{1}{n} B}{W}} = \\sqrt{\\frac{n-1}{n} + \\frac{B}{nW}} $$\n随着链的收敛，链均值$\\bar{h}_i$都趋近于真实均值$\\mu_h$，因此$B$趋近于$W$。在极限情况下，$B \\to W$，且$\\hat{R} \\to \\sqrt{\\frac{n-1}{n} + \\frac{W}{nW}} = \\sqrt{\\frac{n-1}{n} + \\frac{1}{n}} = \\sqrt{1} = 1$。因此，接近于1的$\\hat{R}$值表示收敛。\n\n现在，我们为给定数据计算$\\hat{R}$。\n已知：\n轨迹数，$m = 4$。\n每条轨迹的样本数，$n = 50$。\n每条轨迹的均值：$\\bar{h}_1 = 2.90$, $\\bar{h}_2 = 3.10$, $\\bar{h}_3 = 3.35$, $\\bar{h}_4 = 3.65$。\n每条轨迹的方差：$s_1^2 = 0.50$, $s_2^2 = 0.55$, $s_3^2 = 0.65$, $s_4^2 = 0.70$。\n\n首先，计算合并链内方差$W$：\n$$ W = \\frac{1}{m} \\sum_{i=1}^{m} s_i^2 = \\frac{1}{4} (0.50 + 0.55 + 0.65 + 0.70) = \\frac{2.40}{4} = 0.60 $$\n\n接下来，计算链间方差$B$。我们首先需要总均值$\\bar{h}$：\n$$ \\bar{h} = \\frac{1}{m} \\sum_{i=1}^{m} \\bar{h}_i = \\frac{1}{4} (2.90 + 3.10 + 3.35 + 3.65) = \\frac{13.00}{4} = 3.25 $$\n现在，我们计算$B$：\n$$ B = \\frac{n}{m-1} \\sum_{i=1}^{m} (\\bar{h}_i - \\bar{h})^2 $$\n$$ B = \\frac{50}{4-1} \\left[ (2.90 - 3.25)^2 + (3.10 - 3.25)^2 + (3.35 - 3.25)^2 + (3.65 - 3.25)^2 \\right] $$\n$$ B = \\frac{50}{3} \\left[ (-0.35)^2 + (-0.15)^2 + (0.10)^2 + (0.40)^2 \\right] $$\n$$ B = \\frac{50}{3} \\left[ 0.1225 + 0.0225 + 0.0100 + 0.1600 \\right] $$\n$$ B = \\frac{50}{3} (0.3150) = 50 \\times 0.1050 = 5.25 $$\n\n最后，我们计算$\\hat{R}$：\n$$ \\hat{R} = \\sqrt{\\frac{n-1}{n} + \\frac{B}{nW}} = \\sqrt{\\frac{50-1}{50} + \\frac{5.25}{50 \\times 0.60}} $$\n$$ \\hat{R} = \\sqrt{\\frac{49}{50} + \\frac{5.25}{30}} = \\sqrt{0.98 + 0.175} = \\sqrt{1.155} $$\n$$ \\hat{R} \\approx 1.07470926 \\dots $$\n四舍五入到四位有效数字，我们得到$\\hat{R} = 1.075$。\n\n结果解释：\n$\\hat{R} \\approx 1.075$这个值是可观测量$h(\\mathbf{x})$（氢键数量）收敛性的一个度量。理想值为$\\hat{R}=1.0$，这将表明链间方差与链内方差一致，意味着所有链都在从同一个分布中抽样。在实践中，通常使用一个阈值（例如$\\hat{R}  1.1$）来宣告收敛。\n计算出的值1.075接近这个常用阈值，但仍然表明链之间存在显著差异。具体来说，它意味着所有链的混合方差大约是链内平均方差的$1.155$倍（$=\\hat{R}^2$）。这表明这些链尚未完全混合并忘记其过度分散的起始点。四条轨迹的平均氢键数的变化（从$2.90$到$3.65$）比所有链都从一个单一、收敛的平稳分布中抽样所预期的要大。在计算化学生物学的严谨分析中，这个值表明需要延长模拟（即收集更多样本），以提高对计算出的平均值$\\bar{h}=3.25$及其他相关统计数据的置信度。抽样可能不完整，在$\\hat{R}$更接近1.0之前，关于氢键模式的定量结论应谨慎得出。",
            "answer": "$$\\boxed{1.075}$$"
        }
    ]
}