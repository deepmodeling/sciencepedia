{
    "hands_on_practices": [
        {
            "introduction": "The genesis of a runaway electron beam during a tokamak disruption is the intense toroidal electric field induced by the rapid collapse of plasma current. To design any mitigation strategy, we must first be able to predict the magnitude of this electric field. This first practice provides a hands-on approach to this critical calculation, modeling the tokamak plasma and its surrounding vacuum vessel as a system of coupled inductive circuits . By solving this model, you will compute the peak electric field generated during a prescribed current quench, gaining quantitative insight into the primary driver of runaway formation.",
            "id": "4042701",
            "problem": "Consider a tokamak plasma undergoing a prescribed current quench and its electromagnetic coupling to the surrounding conducting vessel. To assess runaway electron mitigation strategies, the goal is to compute the peak toroidal electric field that appears during the quench, because sufficiently large toroidal electric fields can accelerate electrons into the runaway regime. Model the plasma and vessel as two coupled single-turn circuits with self-inductances, mutual inductance, and resistances. Use the International System of Units (SI) and express the final toroidal electric field in volts per meter (V/m).\n\nStart from the following principles and definitions:\n\n- Faraday's law of electromagnetic induction: the loop voltage is related to the time rate of change of the linked magnetic flux. For a circuit with self and mutual inductances, this gives a voltage term proportional to the time derivatives of the currents.\n- Ohm's law: the resistive voltage drop in a circuit element with resistance $R$ and current $I$ is $RI$.\n- Kirchhoff's voltage law: the sum of voltage drops around a closed loop equals the applied loop voltage.\n- Mutual inductance for two coupled circuits: the flux linkage in each circuit includes a mutual term proportional to the current in the other circuit.\n\nAssume:\n- Plasma current $I_p(t)$ is prescribed by a current quench waveform and given by the exponential decay $I_p(t) = I_0 e^{-t/\\tau}$ for $t \\ge 0$, where $I_0$ is the pre-quench plasma current and $\\tau$ is the quench time constant. The derivative is $dI_p/dt = -(I_0/\\tau)e^{-t/\\tau}$.\n- The plasma loop voltage is the sum of inductive and resistive terms linked to the plasma circuit and the vessel circuit via the mutual inductance. Denote the plasma inductance by $L_p$, the vessel inductance by $L_v$, the plasma resistance by $R_p$, the vessel resistance by $R_v$, and the mutual inductance by $M$.\n- The vessel is a passive circuit with no applied source, responding to induced electromotive force. Its current $I_v(t)$ obeys an Ordinary Differential Equation (ODE) arising from Kirchhoff's voltage law and mutual inductive coupling.\n\nFrom these principles, the plasma loop voltage $V_p(t)$ is given by the inductive and resistive response:\n$$\nV_p(t) = L_p \\frac{dI_p}{dt} + R_p I_p(t) + M \\frac{dI_v}{dt}.\n$$\nThe vessel current obeys:\n$$\nL_v \\frac{dI_v}{dt} + R_v I_v(t) + M \\frac{dI_p}{dt} = 0,\n$$\nwith the initial condition $I_v(0) = 0$.\n\nThe toroidal electric field $E(t)$ is related to the loop voltage by the major radius $R_0$:\n$$\nE(t) = \\frac{V_p(t)}{2\\pi R_0}.\n$$\n\nYour task is to write a complete program that:\n- Solves for $I_v(t)$ given the prescribed $I_p(t)$, using the ODE for the vessel circuit.\n- Computes $V_p(t)$ using the expression above.\n- Computes $E(t)$ and returns the peak value $\\max_{t \\in [0, T_{\\mathrm{end}}]} E(t)$ over a specified simulation interval $[0,T_{\\mathrm{end}}]$.\n\nSpecial case handling:\n- Define $\\alpha = R_v/L_v$ and $\\beta = (M/L_v)(I_0/\\tau)$. For the generic case $1/\\tau \\neq \\alpha$, the solution for $I_v(t)$ can be obtained analytically as:\n$$\nI_v(t) = A\\left(e^{-t/\\tau} - e^{-\\alpha t}\\right), \\quad \\text{with} \\quad A = \\frac{M I_0}{R_v \\tau - L_v},\n$$\nwhich satisfies $I_v(0)=0$.\n- In the resonance case $1/\\tau = \\alpha$ (that is, $R_v \\tau = L_v$), the particular solution changes and the vessel current is:\n$$\nI_v(t) = \\beta\\, t\\, e^{-\\alpha t},\n$$\nwhich also satisfies $I_v(0)=0$.\n\nIn all cases, compute $dI_v/dt$ consistently from the chosen expression for $I_v(t)$, then compute $V_p(t)$ and $E(t)$, and finally report the peak value of $E(t)$ in $\\mathrm{V/m}$.\n\nTest suite:\nUse the following parameter sets (each test case is a tuple of $(I_0, \\tau, L_p, R_p, L_v, R_v, M, R_0, T_{\\mathrm{end}})$), where all quantities are in SI units:\n- Case $1$ (typical coupling, \"happy path\"):\n  - $I_0 = 1.25\\times 10^{6}$, $\\tau = 4.0\\times 10^{-3}$, $L_p = 2.0\\times 10^{-6}$, $R_p = 1.2\\times 10^{-3}$, $L_v = 6.0\\times 10^{-6}$, $R_v = 4.0\\times 10^{-3}$, $M = 2.5\\times 10^{-6}$, $R_0 = 3.2$, $T_{\\mathrm{end}} = 3.0\\times 10^{-2}$.\n- Case $2$ (no coupling, edge case $M=0$):\n  - $I_0 = 1.25\\times 10^{6}$, $\\tau = 4.0\\times 10^{-3}$, $L_p = 2.0\\times 10^{-6}$, $R_p = 1.2\\times 10^{-3}$, $L_v = 6.0\\times 10^{-6}$, $R_v = 4.0\\times 10^{-3}$, $M = 0.0$, $R_0 = 3.2$, $T_{\\mathrm{end}} = 3.0\\times 10^{-2}$.\n- Case $3$ (fast quench, small $\\tau$):\n  - $I_0 = 1.25\\times 10^{6}$, $\\tau = 5.0\\times 10^{-4}$, $L_p = 2.0\\times 10^{-6}$, $R_p = 1.2\\times 10^{-3}$, $L_v = 6.0\\times 10^{-6}$, $R_v = 4.0\\times 10^{-3}$, $M = 2.5\\times 10^{-6}$, $R_0 = 3.2$, $T_{\\mathrm{end}} = 5.0\\times 10^{-3}$.\n- Case $4$ (resonant coupling, boundary condition $R_v \\tau = L_v$):\n  - $I_0 = 8.0\\times 10^{5}$, $\\tau = 1.0\\times 10^{-3}$, $L_p = 1.0\\times 10^{-6}$, $R_p = 1.0\\times 10^{-3}$, $L_v = 5.0\\times 10^{-6}$, $R_v = 5.0\\times 10^{-3}$, $M = 1.5\\times 10^{-6}$, $R_0 = 3.0$, $T_{\\mathrm{end}} = 1.0\\times 10^{-2}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry being the peak toroidal electric field in $\\mathrm{V/m}$ for the corresponding test case (e.g., $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$). Each result must be a floating-point number.",
            "solution": "The user-provided problem has been analyzed and validated. All givens, definitions, and constraints are self-contained, scientifically grounded in the principles of electromagnetism and circuit theory, and form a well-posed problem. No inconsistencies, ambiguities, or factual errors were detected. Therefore, the problem is deemed valid and a full solution is provided below.\n\nThe problem requires the calculation of the peak toroidal electric field, $E(t)$, in a tokamak during a plasma current quench. This is a critical parameter for assessing the potential for runaway electron generation. The physical system is modeled as two inductively coupled circuits: the plasma (circuit $p$) and the surrounding vacuum vessel (circuit $v$).\n\nThe analysis is based on fundamental principles of electromagnetism:\n1.  **Faraday's Law of Induction and Kirchhoff's Voltage Law**: The sum of voltages around a closed loop is zero. For the plasma and vessel circuits, this leads to a system of coupled ordinary differential equations (ODEs).\n2.  **Ohm's Law**: The resistive voltage drop across a component is $V = RI$.\n\nThe plasma circuit's loop voltage, $V_p(t)$, which drives the toroidal electric field, is given by the sum of its self-inductive response, its resistive drop, and the voltage mutually induced by the changing current in the vessel:\n$$\nV_p(t) = L_p \\frac{dI_p}{dt} + R_p I_p(t) + M \\frac{dI_v}{dt}\n$$\nHere, $L_p$ and $R_p$ are the plasma inductance and resistance, $I_p(t)$ is the plasma current, $M$ is the mutual inductance between the plasma and the vessel, and $I_v(t)$ is the vessel current.\n\nThe vessel is a passive circuit, so the sum of voltages around its loop is zero. This gives the governing ODE for the vessel current, $I_v(t)$:\n$$\nL_v \\frac{dI_v}{dt} + R_v I_v(t) + M \\frac{dI_p}{dt} = 0\n$$\nwhere $L_v$ and $R_v$ are the vessel inductance and resistance. The initial condition is $I_v(0) = 0$, as no current flows in the vessel before the quench begins at $t=0$.\n\nThe plasma current quench is prescribed as an exponential decay:\n$$\nI_p(t) = I_0 e^{-t/\\tau} \\quad \\text{for } t \\ge 0\n$$\nwhere $I_0$ is the pre-quench current and $\\tau$ is the characteristic quench time. The time derivative is:\n$$\n\\frac{dI_p}{dt} = -\\frac{I_0}{\\tau} e^{-t/\\tau}\n$$\n\nSubstituting the expression for $dI_p/dt$ into the vessel's ODE gives a first-order linear non-homogeneous ODE for $I_v(t)$:\n$$\nL_v \\frac{dI_v}{dt} + R_v I_v(t) = \\frac{M I_0}{\\tau} e^{-t/\\tau}\n$$\nThis ODE can be solved analytically. The solution depends on the relationship between the plasma current decay rate, $1/\\tau$, and the vessel's intrinsic L/R time constant, $\\alpha = R_v/L_v$. Two distinct cases arise, as specified in the problem statement.\n\n**Case 1: Non-resonant Coupling ($1/\\tau \\neq \\alpha$)**\nWhen the driving frequency does not match the natural frequency of the vessel circuit, the solution for the vessel current, satisfying $I_v(0)=0$, is:\n$$\nI_v(t) = A\\left(e^{-t/\\tau} - e^{-\\alpha t}\\right), \\quad \\text{with} \\quad A = \\frac{M I_0}{R_v \\tau - L_v}\n$$\nThe required time derivative is found by differentiation:\n$$\n\\frac{dI_v}{dt} = A\\left(-\\frac{1}{\\tau} e^{-t/\\tau} + \\alpha e^{-\\alpha t}\\right)\n$$\n\n**Case 2: Resonant Coupling ($1/\\tau = \\alpha$)**\nIn the special case where $R_v \\tau = L_v$, the form of the particular solution changes. The solution for the vessel current, satisfying $I_v(0)=0$, is:\n$$\nI_v(t) = \\beta t e^{-\\alpha t}, \\quad \\text{with} \\quad \\beta = \\frac{M}{L_v}\\frac{I_0}{\\tau}\n$$\nUsing the product rule, the time derivative is:\n$$\n\\frac{dI_v}{dt} = \\beta (e^{-\\alpha t} - \\alpha t e^{-\\alpha t}) = \\beta e^{-\\alpha t}(1 - \\alpha t)\n$$\n\nOnce the expression for $dI_v/dt$ is determined for the appropriate case, all terms in the equation for $V_p(t)$ are known functions of time. The toroidal electric field is then directly proportional to the loop voltage:\n$$\nE(t) = \\frac{V_p(t)}{2\\pi R_0}\n$$\nwhere $R_0$ is the tokamak's major radius.\n\nTo find the peak electric field, $\\max_{t \\in [0, T_{\\mathrm{end}}]} E(t)$, an algorithmic approach is used:\n1.  A discrete time grid is generated over the interval $[0, T_{\\mathrm{end}}]$. A high-resolution grid is chosen to ensure the peak is captured accurately.\n2.  For each test case, the condition $R_v \\tau = L_v$ is checked to determine if the system is resonant. A floating-point-safe comparison is employed.\n3.  The corresponding analytical expression for $dI_v/dt$ is selected and evaluated at each point on the time grid.\n4.  The functions $I_p(t)$ and $dI_p/dt$ are also evaluated on the time grid.\n5.  All components are combined to compute the loop voltage $V_p(t)$ and subsequently the toroidal electric field $E(t)$ at each time point.\n6.  The maximum value of the resulting array for $E(t)$ is identified. This value represents the peak toroidal electric field.\n\nThis procedure is implemented for each of the provided test cases. `NumPy` is used for efficient, vectorized calculations over the time grid.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_peak_E(I0: float, tau: float, Lp: float, Rp: float, \n                     Lv: float, Rv: float, M: float, R0: float, Tend: float) - float:\n    \"\"\"\n    Solves for the peak toroidal electric field during a plasma current quench.\n\n    Args:\n        I0 (float): Pre-quench plasma current in Amperes.\n        tau (float): Current quench time constant in seconds.\n        Lp (float): Plasma self-inductance in Henrys.\n        Rp (float): Plasma resistance in Ohms.\n        Lv (float): Vessel self-inductance in Henrys.\n        Rv (float): Vessel resistance in Ohms.\n        M (float): Mutual inductance in Henrys.\n        R0 (float): Major radius in meters.\n        Tend (float): Simulation end time in seconds.\n\n    Returns:\n        float: The peak toroidal electric field in Volts/meter.\n    \"\"\"\n    # Create a fine time grid for the simulation interval\n    num_points = 20000  # High resolution to capture the peak accurately\n    t = np.linspace(0, Tend, num_points)\n\n    # Calculate plasma current and its time derivative over the time grid\n    I_p = I0 * np.exp(-t / tau)\n    dIp_dt = -(I0 / tau) * np.exp(-t / tau)\n\n    # Determine the vessel current response based on the coupling case\n    # Check for the resonant case: R_v * tau = L_v\n    if np.isclose(Rv * tau, Lv):\n        # Resonant case\n        alpha = Rv / Lv\n        beta = (M / Lv) * (I0 / tau)\n        # Vessel current derivative from d/dt(beta * t * exp(-alpha*t))\n        dIv_dt = beta * np.exp(-alpha * t) * (1 - alpha * t)\n    else:\n        # Non-resonant case\n        alpha = Rv / Lv\n        A = (M * I0) / (Rv * tau - Lv)\n        # Vessel current derivative from d/dt(A * (exp(-t/tau) - exp(-alpha*t)))\n        dIv_dt = A * (-np.exp(-t / tau) / tau + alpha * np.exp(-alpha * t))\n\n    # Calculate the total plasma loop voltage Vp(t)\n    # Vp(t) = L_p * dI_p/dt + R_p * I_p(t) + M * dI_v/dt\n    Vp = Lp * dIp_dt + Rp * I_p + M * dIv_dt\n\n    # Calculate the toroidal electric field E(t)\n    # E(t) = Vp(t) / (2 * pi * R0)\n    E_t = Vp / (2 * np.pi * R0)\n\n    # Find and return the peak value of the electric field\n    peak_E = np.max(E_t)\n    return peak_E\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple: (I0, tau, Lp, Rp, Lv, Rv, M, R0, Tend)\n    test_cases = [\n        # Case 1 (typical coupling, \"happy path\")\n        (1.25e6, 4.0e-3, 2.0e-6, 1.2e-3, 6.0e-6, 4.0e-3, 2.5e-6, 3.2, 3.0e-2),\n        # Case 2 (no coupling, edge case M=0)\n        (1.25e6, 4.0e-3, 2.0e-6, 1.2e-3, 6.0e-6, 4.0e-3, 0.0, 3.2, 3.0e-2),\n        # Case 3 (fast quench, small tau)\n        (1.25e6, 5.0e-4, 2.0e-6, 1.2e-3, 6.0e-6, 4.0e-3, 2.5e-6, 3.2, 5.0e-3),\n        # Case 4 (resonant coupling, boundary condition R_v * tau = L_v)\n        (8.0e5, 1.0e-3, 1.0e-6, 1.0e-3, 5.0e-6, 5.0e-3, 1.5e-6, 3.0, 1.0e-2),\n    ]\n\n    results = []\n    for case in test_cases:\n        peak_E_field = calculate_peak_E(*case)\n        results.append(peak_E_field)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Once the toroidal electric field, $E$, surpasses the critical threshold, $E_c$, a small seed population of high-energy electrons can trigger a devastating avalanche. This exponential growth, where existing runaway electrons knock thermal electrons into the runaway regime, is the primary mechanism for generating dangerous, multi-mega-ampere runaway beams. In this exercise, you will analytically derive the characteristic time for this avalanche process from first principles, connecting the growth rate directly to the supercritical field ratio $E/E_c$ and the plasma's collisional properties . This practice solidifies the fundamental physics governing the runaway population explosion.",
            "id": "4042645",
            "problem": "Consider a post-thermal-quench phase in a large-aspect-ratio tokamak plasma in which a spatially uniform toroidal electric field of magnitude $E$ is sustained and approximately constant in time over a flux-tube cross-section of area $A$. A seed population of runaway electrons (REs) of density $n_{re,0}$ is present immediately after the thermal quench. Assume that avalanche multiplication by large-angle Coulomb (Møller) knock-on collisions dominates the production of new runaway electrons and that the REs rapidly become highly relativistic so that their parallel speed can be approximated as $v_{\\parallel} \\approx c$, where $c$ is the speed of light in vacuum.\n\nUse the following well-tested definitions as the fundamental base:\n- The Connor–Hastie critical electric field $E_c$ defined by\n$$\nE_c \\equiv \\frac{n_e e^{3} \\ln\\Lambda}{4 \\pi \\epsilon_0^{2} m_e c^{2}},\n$$\nwhere $n_e$ is the background electron density, $e$ is the elementary charge, $\\ln\\Lambda$ is the Coulomb logarithm, $\\epsilon_0$ is the vacuum permittivity, and $m_e$ is the electron mass.\n- The relativistic electron–electron collision time\n$$\n\\tau_r \\equiv \\frac{4 \\pi \\epsilon_0^{2} m_e^{2} c^{3}}{n_e e^{4} \\ln\\Lambda}.\n$$\n\nStarting from particle-number balance for the runaway electron population and basic kinetic considerations of large-angle collision production, argue from first principles that, for a fixed supercritical field ratio $E/E_c > 1$, the avalanche source induces exponential growth of the runaway density $n_{re}(t)$ with a constant growth rate that scales with $(E/E_c - 1)$ and is set by the timescale $\\tau_r$ up to an order-unity factor. For an analytical estimate, neglect order-unity prefactors associated with detailed pitch-angle and effective charge dependences, and model the growth rate as directly proportional to $(E/E_c - 1)/\\tau_r$.\n\nAssuming the total runaway current is well approximated by $I_{re}(t) = e\\, A\\, c\\, n_{re}(t)$, determine an analytic expression for the time $t_{\\ast}$ required for the runaway current to reach a specified target value $I_{\\ast}$, in terms of $E/E_c$, $\\tau_r$, $I_{\\ast}$, $A$, $e$, $c$, and $n_{re,0}$. Express your final formula for the time in seconds if all inputs are provided in the International System of Units (SI). Your final answer must be a single closed-form expression. No numerical evaluation is required.",
            "solution": "The problem requires the derivation of an expression for the time $t_{\\ast}$ needed for an avalanching runaway electron population to reach a target current $I_{\\ast}$. The problem statement is scientifically sound, well-posed, and contains sufficient information for a unique solution under the specified simplifying assumptions.\n\nThe fundamental principle governing the evolution of the runaway electron (RE) population is particle conservation. The rate of change of the runaway electron density, $n_{re}$, is determined by the balance of source and loss mechanisms. The problem specifies that an initial seed population with density $n_{re,0}$ exists at time $t=0$ and that the dominant production mechanism is avalanche multiplication. We neglect any loss terms for this estimate. The avalanche source term, $S_{ava}$, is proportional to the number of existing runaway electrons that create secondary runaways through large-angle collisions. Therefore, the particle balance equation can be written as a first-order rate equation:\n$$\n\\frac{d n_{re}(t)}{dt} = S_{ava} = \\gamma n_{re}(t)\n$$\nwhere $\\gamma$ is the avalanche growth rate.\n\nThe next step is to establish the form of the growth rate $\\gamma$. The problem asks for an argument from first principles. The existence of runaway electrons is contingent on the toroidal electric field $E$ being strong enough to overcome the collisional drag force. The Connor–Hastie critical field $E_c$ represents the threshold at which the energy gain from the field for a relativistic electron exactly balances the energy loss due to collisions. For a supercritical field, $E > E_c$, an electron experiences a net acceleration. The rate of energy gain is proportional to the magnitude of the \"supercritical\" field, $E - E_c$. The avalanche process, where a high-energy electron knocks a thermal electron into the runaway energy range, has a rate that depends on this net energy gain. The characteristic time scale for this collisional process for relativistic electrons is the relativistic collision time, $\\tau_r$. Consequently, the growth rate $\\gamma$ must be proportional to the dimensionless field ratio $(E-E_c)/E_c$ and inversely proportional to the collision time $\\tau_r$. The problem directs us to model the growth rate by taking the constant of proportionality to be unity:\n$$\n\\gamma = \\frac{\\frac{E}{E_c} - 1}{\\tau_r}\n$$\nGiven that $E/E_c > 1$, the growth rate $\\gamma$ is a positive constant, leading to exponential growth.\n\nWe now solve the differential equation for $n_{re}(t)$:\n$$\n\\frac{d n_{re}}{dt} = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) n_{re}\n$$\nThis is a separable first-order linear ordinary differential equation. We integrate it from the initial condition $(t=0, n_{re}=n_{re,0})$ to a later state $(t, n_{re}(t))$:\n$$\n\\int_{n_{re,0}}^{n_{re}(t)} \\frac{d n'_{re}}{n'_{re}} = \\int_{0}^{t} \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) dt'\n$$\nSince the terms in the parenthesis on the right-hand side are constant with respect to time, the integration yields:\n$$\n\\ln(n_{re}(t)) - \\ln(n_{re,0}) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t\n$$\n$$\n\\ln\\left(\\frac{n_{re}(t)}{n_{re,0}}\\right) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t\n$$\nSolving for $n_{re}(t)$ by exponentiating both sides gives the time evolution of the runaway electron density:\n$$\nn_{re}(t) = n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t \\right)\n$$\n\nThe problem provides an expression for the total runaway current, $I_{re}(t)$, assuming the runaways are highly relativistic ($v_{\\parallel} \\approx c$):\n$$\nI_{re}(t) = e A c n_{re}(t)\n$$\nwhere $e$ is the elementary charge, $A$ is the cross-sectional area of the flux-tube, and $c$ is the speed of light. Substituting our expression for $n_{re}(t)$:\n$$\nI_{re}(t) = e A c n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t \\right)\n$$\n\nFinally, we determine the time $t_{\\ast}$ at which the runaway current reaches a specified target value $I_{\\ast}$. We set $I_{re}(t_{\\ast}) = I_{\\ast}$:\n$$\nI_{\\ast} = e A c n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast} \\right)\n$$\nTo solve for $t_{\\ast}$, we first isolate the exponential term:\n$$\n\\frac{I_{\\ast}}{e A c n_{re,0}} = \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast} \\right)\n$$\nTaking the natural logarithm of both sides:\n$$\n\\ln\\left( \\frac{I_{\\ast}}{e A c n_{re,0}} \\right) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast}\n$$\nIsolating $t_{\\ast}$ yields the final expression:\n$$\nt_{\\ast} = \\frac{\\tau_r}{\\frac{E}{E_c} - 1} \\ln\\left( \\frac{I_{\\ast}}{e A c n_{re,0}} \\right)\n$$\nThis expression provides the time required for the runaway current to grow from its initial value, determined by the seed density $n_{re,0}$, to the target value $I_{\\ast}$, driven by an avalanche with a growth rate determined by the supercritical electric field ratio $E/E_c$ and the relativistic collision time $\\tau_r$. The expression is dimensionally correct, as $\\tau_r$ has units of time, and all other factors are dimensionless.",
            "answer": "$$\n\\boxed{\\frac{\\tau_r}{\\frac{E}{E_c} - 1} \\ln\\left(\\frac{I_{\\ast}}{e A c n_{re,0}}\\right)}\n$$"
        },
        {
            "introduction": "Effective runaway mitigation is a matter of strategic timing, balancing competing physical effects to achieve the best outcome. Injecting a large quantity of material (e.g., through Massive Gas Injection) can raise the critical electric field and suppress the avalanche, but when is the best moment to act? This final practice brings together the concepts of electric field evolution and avalanche growth into a dynamic optimization problem . You will develop a simulation to find the optimal injection time that minimizes a cost function, weighing the final runaway population against the penalty of unmitigated acceleration, thereby simulating a core strategic challenge in tokamak protection.",
            "id": "4042696",
            "problem": "You are to design and implement a complete program that computes the optimal timing of impurity injection (such as Massive Gas Injection (MGI) or Shattered Pellet Injection (SPI)) relative to the onset of the thermal quench to suppress runaway electron avalanche growth while minimizing the unmitigated acceleration during the early current quench. Consider a simplified zero-dimensional plasma model with the following dynamics and objective.\n\nAssume the thermal quench onset occurs at time $t=0$ seconds. For $t0$, the plasma is in a pre-quench state. For $t\\ge 0$, the plasma temperature drops exponentially and the resistive electric field grows accordingly. The model uses the following ingredients:\n\n1. Temperature evolution: for $t\\ge 0$, the temperature decays as\n$$\nT(t)=T_0 \\exp\\left(-\\frac{t}{t_{\\mathrm{TQ}}}\\right),\n$$\nand for $t0$, $T(t)=T_0$, where $t_{\\mathrm{TQ}}$ is the thermal quench timescale. Only the ratio $T(t)/T_0$ is needed.\n\n2. Electric field evolution: for $t\\ge 0$, the ohmic field scales inversely with the Spitzer conductivity, which scales as $\\sigma\\propto T^{3/2}$. This leads to\n$$\nE(t)=E_0\\exp\\left(\\frac{3t}{2t_{\\mathrm{TQ}}}\\right),\n$$\nand for $t0$, $E(t)=E_0$, where $E_0$ is the pre-quench electric field.\n\n3. Electron density: the background electron density is $n_e(t)=n_{e0}$ before injection. At the injection time $t_{\\mathrm{inj}}$, a density increment $\\Delta n$ is assimilated with a time-dependent efficiency. Define the Heaviside step function $H(\\cdot)$ and the assimilation function $s(t_{\\mathrm{inj}})$ by\n$$\ns(t_{\\mathrm{inj}})=\n\\begin{cases}\n1,  t_{\\mathrm{inj}}\\ge 0,\\\\\n\\exp\\left(\\frac{t_{\\mathrm{inj}}}{t_{\\mathrm{assim}}}\\right),  t_{\\mathrm{inj}}0,\n\\end{cases}\n$$\nwhere $t_{\\mathrm{assim}}$ is a characteristic pre-quench assimilation timescale. Then\n$$\nn_e(t)=n_{e0}+s(t_{\\mathrm{inj}})\\,\\Delta n\\,H\\!\\left(t-t_{\\mathrm{inj}}\\right).\n$$\n\n4. Critical electric field: approximate the Connor-Hastie critical field as linear in the electron density,\n$$\nE_c(n_e)=k_c\\,n_e(t),\n$$\nwith proportionality constant $k_c$.\n\n5. Avalanche growth factor: define the effective normalized accelerating field\n$$\nF(t)=\\max\\left(0,\\,\\frac{E(t)}{E_c\\!\\left(n_e(t)\\right)}-1\\right).\n$$\nThe avalanche growth rate is\n$$\n\\gamma_a(t)=\\gamma_{\\mathrm{ref}}\\,F(t)\\,\\frac{n_{e,\\mathrm{ref}}}{n_e(t)},\n$$\nwhere $\\gamma_{\\mathrm{ref}}$ is a reference rate and $n_{e,\\mathrm{ref}}$ is a reference density.\n\n6. Seed source for runaway electrons: adopt a Gaussian hot-tail seed centered near the thermal quench onset,\n$$\nS_{\\mathrm{seed}}(t)=S_0\\,\\exp\\!\\left(-\\frac{\\left(t-t_{\\mathrm{seed}}\\right)^2}{2\\sigma_{\\mathrm{seed}}^2}\\right),\n$$\nwith amplitude $S_0$, center $t_{\\mathrm{seed}}$, and width $\\sigma_{\\mathrm{seed}}$.\n\n7. Runaway electron density evolution: the total runaway electron density $n_r(t)$ evolves as\n$$\n\\frac{d n_r}{d t}=\\gamma_a(t)\\,n_r(t)+S_{\\mathrm{seed}}(t),\n$$\nwith initial condition $n_r(t_{\\min})=0$, where $t_{\\min}0$ is the start time of the simulation window.\n\nDefine the unmitigated current-quench acceleration penalty as the time integral of the accelerating factor $F(t)$ before mitigation begins,\n$$\nA_{\\mathrm{unmit}}(t_{\\mathrm{inj}})=\n\\begin{cases}\n\\displaystyle \\int_0^{t_{\\mathrm{inj}}}F(t)\\,dt,  t_{\\mathrm{inj}}0, \\\\[2ex]\n0,  t_{\\mathrm{inj}}\\le 0.\n\\end{cases}\n$$\n\nDefine the optimization objective as\n$$\nJ(t_{\\mathrm{inj}})=w_R\\,n_r(T_{\\mathrm{end}})+w_A\\,A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}),\n$$\nwhere $w_R$ and $w_A$ are weights and $T_{\\mathrm{end}}$ is the end time of the simulation window.\n\nYour program must:\n- Simulate the model on a uniform time grid using a forward-Euler integrator for the runaway electron density $n_r(t)$ as specified above.\n- Compute the objective $J(t_{\\mathrm{inj}})$ for candidate injection times $t_{\\mathrm{inj}}$ in a closed interval $[t_{\\min},t_{\\max}]$, and select the $t_{\\mathrm{inj}}$ that minimizes $J(t_{\\mathrm{inj}})$.\n- Use the test suite below, and for each case, report the optimal $t_{\\mathrm{inj}}$ in seconds.\n\nPhysical units:\n- Time should be in seconds (s).\n- Electric field in volts per meter ($\\mathrm{V/m}$).\n- Electron density in inverse cubic meters ($\\mathrm{m^{-3}}$).\n- The final program output must be the optimal injection times in seconds.\n\nAngle units: No angles are used. If any trigonometric functions are needed, arguments must be in radians.\n\nPercentages: Not used. If any fractional outputs are required, express as decimals.\n\nTest suite:\nProvide the following $4$ parameter sets. Each parameter is given with its unit and numerical value. You must strictly use these values in your program.\n\n- Case $1$ (typical thermal quench and good pre-quench assimilation):\n    - $t_{\\mathrm{TQ}}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $E_0=6.0\\times 10^{-1}\\,\\mathrm{V/m}$,\n    - $n_{e0}=3.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $\\Delta n=8.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $k_c=5.0\\times 10^{-21}\\,\\mathrm{V\\,m}$,\n    - $\\gamma_{\\mathrm{ref}}=5.0\\times 10^{2}\\,\\mathrm{s^{-1}}$,\n    - $n_{e,\\mathrm{ref}}=1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $S_0=5.0\\times 10^{15}\\,\\mathrm{m^{-3}\\,s^{-1}}$,\n    - $t_{\\mathrm{seed}}=6.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $\\sigma_{\\mathrm{seed}}=2.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $w_R=1.0$,\n    - $w_A=1.0\\times 10^{18}\\,\\mathrm{s^{-1}}$,\n    - $t_{\\min}=-1.5\\times 10^{-3}\\,\\mathrm{s}$,\n    - $t_{\\max}=2.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $T_{\\mathrm{end}}=2.5\\times 10^{-3}\\,\\mathrm{s}$,\n    - $\\Delta t=2.0\\times 10^{-6}\\,\\mathrm{s}$,\n    - $t_{\\mathrm{assim}}=5.0\\times 10^{-4}\\,\\mathrm{s}$.\n\n- Case $2$ (poor pre-quench assimilation):\n    - Same as Case $1$ except $t_{\\mathrm{assim}}=1.0\\times 10^{-4}\\,\\mathrm{s}$.\n\n- Case $3$ (fast thermal quench with stronger early field rise):\n    - $t_{\\mathrm{TQ}}=2.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $E_0=6.0\\times 10^{-1}\\,\\mathrm{V/m}$,\n    - $n_{e0}=3.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $\\Delta n=8.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $k_c=5.0\\times 10^{-21}\\,\\mathrm{V\\,m}$,\n    - $\\gamma_{\\mathrm{ref}}=5.0\\times 10^{2}\\,\\mathrm{s^{-1}}$,\n    - $n_{e,\\mathrm{ref}}=1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $S_0=5.0\\times 10^{15}\\,\\mathrm{m^{-3}\\,s^{-1}}$,\n    - $t_{\\mathrm{seed}}=1.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $\\sigma_{\\mathrm{seed}}=5.0\\times 10^{-5}\\,\\mathrm{s}$,\n    - $w_R=1.0$,\n    - $w_A=1.0\\times 10^{18}\\,\\mathrm{s^{-1}}$,\n    - $t_{\\min}=-5.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $t_{\\max}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $T_{\\mathrm{end}}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $\\Delta t=1.0\\times 10^{-6}\\,\\mathrm{s}$,\n    - $t_{\\mathrm{assim}}=5.0\\times 10^{-4}\\,\\mathrm{s}$.\n\n- Case $4$ (weak injection magnitude):\n    - Same as Case $1$ except $\\Delta n=2.0\\times 10^{19}\\,\\mathrm{m^{-3}}$.\n\nFinal output:\nYour program should produce a single line of output containing the optimal injection times for the four cases, in seconds, as a comma-separated list enclosed in square brackets (for example, $[t_1,t_2,t_3,t_4]$). Each $t_i$ must be a floating-point number in seconds.\n\nYour program must be a complete, runnable Python $3.12$ script that uses only the standard library and the specified numerical libraries. It must not require any user input or external files. It must strictly adhere to the execution environment and the final output formatting requirement.",
            "solution": "The problem presented is a well-posed optimization task rooted in the computational physics of tokamak disruptions. It requires the determination of an optimal impurity injection time, $t_{\\mathrm{inj}}$, to mitigate the generation of runaway electrons. This is achieved by minimizing a composite objective function, $J(t_{\\mathrm{inj}})$, which represents a trade-off between two competing effects: the final runaway electron population and the unmitigated acceleration of electrons prior to the intervention.\n\nThe problem is deemed valid. Although the objective function $J(t_{\\mathrm{inj}}) = w_R\\,n_r(T_{\\mathrm{end}}) + w_A\\,A_{\\mathrm{unmit}}(t_{\\mathrm{inj}})$ adds terms with different physical dimensions ($w_R n_r$ has units of density, $\\mathrm{m^{-3}}$, while $w_A A_{\\mathrm{unmit}}$ is dimensionless given the provided units), this is a standard and acceptable practice in multi-objective optimization. In this context, $J$ is not a physical quantity itself but a mathematical cost function, where the weights $w_R$ and $w_A$ are chosen to properly scale and balance the relative importance of the two distinct physical objectives. All other aspects of the problem are scientifically and mathematically sound, and all parameters required for a solution are provided.\n\nThe core of the solution is to perform a parameter sweep. We will evaluate the objective function $J(t_{\\mathrm{inj}})$ for a set of discrete candidate injection times $t_{\\mathrm{inj}}$ within the specified range $[t_{\\min}, t_{\\max}]$ and identify the time that yields the minimum value of $J$. For each candidate $t_{\\mathrm{inj}}$, a time-dependent simulation must be executed according to the provided zero-dimensional model.\n\nThe algorithmic procedure is as follows:\n\n**1. Discretization and Grid Setup**\n\nThe continuous-time problem is discretized onto a uniform time grid. Let the time step be $\\Delta t$. The simulation time points are $t_i = t_{\\min} + i \\cdot \\Delta t$ for $i=0, 1, 2, \\dots, N$. The simulation runs from $t_{\\min}$ to $T_{\\mathrm{end}}$, so the total number of points is $N+1 = (T_{\\mathrm{end}} - t_{\\min})/\\Delta t + 1$. The candidate injection times $t_{\\mathrm{inj}}$ will be chosen from the grid points $t_i$ that fall within the interval $[t_{\\min}, t_{\\max}]$.\n\n**2. Simulation for a Fixed Candidate Injection Time $t_{\\mathrm{inj}}$**\n\nFor each candidate $t_{\\mathrm{inj}}$, we simulate the plasma and runaway electron dynamics from $t_{\\min}$ to $T_{\\mathrm{end}}$.\n\n-   **Electric Field and Seed Source**: The time-dependent electric field $E(t)$ and the runaway seed source $S_{\\mathrm{seed}}(t)$ are independent of the injection time $t_{\\mathrm{inj}}$. Their values can be pre-calculated and stored in arrays for the entire simulation grid.\n    For each time point $t_i$:\n    $$\n    E(t_i) = \n    \\begin{cases}\n    E_0\\exp\\left(\\frac{3t_i}{2t_{\\mathrm{TQ}}}\\right),  t_i \\ge 0 \\\\\n    E_0,  t_i  0\n    \\end{cases}\n    $$\n    $$\n    S_{\\mathrm{seed}}(t_i) = S_0\\,\\exp\\!\\left(-\\frac{\\left(t_i-t_{\\mathrm{seed}}\\right)^2}{2\\sigma_{\\mathrm{seed}}^2}\\right)\n    $$\n\n-   **Electron Density**: The background electron density $n_e(t)$ depends on the chosen $t_{\\mathrm{inj}}$. First, we calculate the assimilation efficiency factor $s(t_{\\mathrm{inj}})$:\n    $$\n    s(t_{\\mathrm{inj}}) = \n    \\begin{cases}\n    1,  t_{\\mathrm{inj}}\\ge 0 \\\\\n    \\exp\\left(\\frac{t_{\\mathrm{inj}}}{t_{\\mathrm{assim}}}\\right),  t_{\\mathrm{inj}}0\n    \\end{cases}\n    $$\n    Then, for each time point $t_i$, the electron density is:\n    $$\n    n_e(t_i) = n_{e0}+s(t_{\\mathrm{inj}})\\,\\Delta n\\,H\\!\\left(t_i-t_{\\mathrm{inj}}\\right)\n    $$\n    where $H$ is the Heaviside step function, equal to $1$ if its argument is non-negative and $0$ otherwise. This creates a step-increase in density at time $t_{\\mathrm{inj}}$.\n\n-   **Derived Quantities**: With arrays for $E(t)$ and $n_e(t)$, we can compute the critical field $E_c(t)$, the normalized accelerating field $F(t)$, and the avalanche growth rate $\\gamma_a(t)$ for each time point $t_i$:\n    $$ E_c(t_i) = k_c\\,n_e(t_i) $$\n    $$ F(t_i) = \\max\\left(0,\\,\\frac{E(t_i)}{E_c(t_i)}-1\\right) $$\n    $$ \\gamma_a(t_i) = \\gamma_{\\mathrm{ref}}\\,F(t_i)\\,\\frac{n_{e,\\mathrm{ref}}}{n_e(t_i)} $$\n\n-   **Runaway Density Evolution**: The runaway density $n_r(t)$ is governed by the ordinary differential equation $\\frac{d n_r}{d t}=\\gamma_a(t)\\,n_r(t)+S_{\\mathrm{seed}}(t)$. We solve this numerically using the forward-Euler method, as specified. Starting with the initial condition $n_r(t_{\\min}) = 0$, we iterate for $i=0, \\dots, N-1$:\n    $$\n    n_r(t_{i+1}) = n_r(t_i) + \\Delta t \\left[ \\gamma_a(t_i)\\,n_r(t_i) + S_{\\mathrm{seed}}(t_i) \\right]\n    $$\n    The value needed for the objective function is the final density, $n_r(T_{\\mathrm{end}})$, which corresponds to $n_r(t_N)$.\n\n**3. Objective Function Calculation**\n\nAfter completing the simulation for a given $t_{\\mathrm{inj}}$, we calculate the two components of the objective function $J(t_{\\mathrm{inj}})$.\n\n-   **Runaway Population Penalty**: This is simply $w_R$ times the final runaway density: $w_R \\, n_r(T_{\\mathrm{end}})$.\n\n-   **Unmitigated Acceleration Penalty**: This is $w_A$ times the integral $A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}) = \\int_0^{t_{\\mathrm{inj}}}F(t)\\,dt$. We approximate this integral numerically. A left Riemann sum is consistent with the forward-Euler integration scheme. We find the grid indices corresponding to $t=0$ and $t=t_{\\mathrm{inj}}$ and sum the values of $F(t_i)\\Delta t$ over this interval. If $t_{\\mathrm{inj}} \\le 0$, this penalty is $0$ by definition.\n    $$\n    A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}) \\approx \n    \\begin{cases}\n    \\displaystyle \\Delta t \\sum_{t_i \\in [0, t_{\\mathrm{inj}})} F(t_i),  t_{\\mathrm{inj}}0 \\\\\n    0,  t_{\\mathrm{inj}}\\le 0\n    \\end{cases}\n    $$\n\nThe total objective value is the sum: $J(t_{\\mathrm{inj}}) = w_R\\,n_r(T_{\\mathrm{end}}) + w_A\\,A_{\\mathrm{unmit}}(t_{\\mathrm{inj}})$.\n\n**4. Optimization**\n\nThe above procedure (steps 2 and 3) is repeated for every candidate injection time $t_{\\mathrm{inj}}$ on the time grid within the search window $[t_{\\min}, t_{\\max}]$. We maintain a record of the minimum value of $J$ found so far and the corresponding $t_{\\mathrm{inj}}$ that produced it. After iterating through all candidate times, the recorded $t_{\\mathrm{inj}}$ is the optimal injection time for the given set of parameters. This process is carried out for each of the four test cases provided. The implementation will leverage the `numpy` library for efficient vectorized computations of the time-dependent arrays.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the runaway electron mitigation optimization problem\n    for the four provided test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (typical thermal quench and good pre-quench assimilation)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 5.0e-4\n        },\n        # Case 2 (poor pre-quench assimilation)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 1.0e-4\n        },\n        # Case 3 (fast thermal quench with stronger early field rise)\n        {\n            \"t_TQ\": 2.0e-4, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 1.0e-4, \"sigma_seed\": 5.0e-5,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -5.0e-4, \"t_max\": 1.0e-3,\n            \"T_end\": 1.0e-3, \"dt\": 1.0e-6, \"t_assim\": 5.0e-4\n        },\n        # Case 4 (weak injection magnitude)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 2.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 5.0e-4\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        optimal_t = find_optimal_injection_time(params)\n        results.append(optimal_t)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef find_optimal_injection_time(params):\n    \"\"\"\n    Computes the optimal injection time for a single set of parameters.\n    \"\"\"\n    # Unpack parameters\n    t_TQ = params[\"t_TQ\"]\n    E_0 = params[\"E_0\"]\n    n_e0 = params[\"n_e0\"]\n    delta_n = params[\"delta_n\"]\n    k_c = params[\"k_c\"]\n    gamma_ref = params[\"gamma_ref\"]\n    n_e_ref = params[\"n_e_ref\"]\n    S_0 = params[\"S_0\"]\n    t_seed = params[\"t_seed\"]\n    sigma_seed = params[\"sigma_seed\"]\n    w_R = params[\"w_R\"]\n    w_A = params[\"w_A\"]\n    t_min = params[\"t_min\"]\n    t_max = params[\"t_max\"]\n    T_end = params[\"T_end\"]\n    dt = params[\"dt\"]\n    t_assim = params[\"t_assim\"]\n\n    # --- 1. Grid setup and pre-calculation ---\n    # Use T_end + dt/2 to ensure T_end is included in the range\n    time_grid = np.arange(t_min, T_end + dt/2, dt)\n    num_steps = len(time_grid)\n\n    # Pre-calculate E(t) and S_seed(t) as they don't depend on t_inj\n    E_t = np.where(time_grid = 0, \n                   E_0 * np.exp(1.5 * time_grid / t_TQ),\n                   E_0)\n    \n    S_seed_t = S_0 * np.exp(-(time_grid - t_seed)**2 / (2 * sigma_seed**2))\n\n    # --- 2. Optimization loop ---\n    min_J = np.inf\n    optimal_t_inj = None\n\n    candidate_t_inj_grid = time_grid[(time_grid = t_min)  (time_grid = t_max)]\n\n    for t_inj in candidate_t_inj_grid:\n        # --- 3. Simulation for a fixed t_inj ---\n        \n        # Calculate assimilation efficiency s(t_inj)\n        if t_inj = 0:\n            s_t_inj = 1.0\n        else:\n            s_t_inj = np.exp(t_inj / t_assim)\n        \n        # Electron density n_e(t)\n        n_e_t = n_e0 + s_t_inj * delta_n * np.heaviside(time_grid - t_inj, 1)\n\n        # Critical field E_c(t), normalized field F(t), and avalanche rate gamma_a(t)\n        E_c_t = k_c * n_e_t\n        # Avoid division by zero, although E_c_t should always be  0\n        F_t = np.maximum(0, E_t / E_c_t - 1)\n        gamma_a_t = gamma_ref * F_t * (n_e_ref / n_e_t)\n\n        # Runaway density evolution n_r(t) using forward-Euler\n        n_r_t = np.zeros(num_steps)\n        # Initial condition n_r(t_min) = 0 is set by np.zeros\n        for i in range(num_steps - 1):\n            dn_r_dt = gamma_a_t[i] * n_r_t[i] + S_seed_t[i]\n            n_r_t[i+1] = n_r_t[i] + dt * dn_r_dt\n        \n        n_r_T_end = n_r_t[-1]\n\n        # --- 4. Objective function calculation ---\n\n        # Unmitigated acceleration penalty A_unmit(t_inj)\n        if t_inj = 0:\n            A_unmit = 0.0\n        else:\n            # Integrate F(t) from t=0 to t=t_inj using a left Riemann sum\n            idx_0 = np.searchsorted(time_grid, 0, side='left')\n            idx_inj = np.searchsorted(time_grid, t_inj, side='left')\n            A_unmit = np.sum(F_t[idx_0:idx_inj]) * dt\n            \n        # Total objective J(t_inj)\n        J = w_R * n_r_T_end + w_A * A_unmit\n\n        # Check for new minimum\n        if J  min_J:\n            min_J = J\n            optimal_t_inj = t_inj\n\n    return optimal_t_inj\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}