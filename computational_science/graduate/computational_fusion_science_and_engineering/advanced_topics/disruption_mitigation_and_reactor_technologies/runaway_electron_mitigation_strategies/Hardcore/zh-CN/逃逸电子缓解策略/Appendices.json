{
    "hands_on_practices": [
        {
            "introduction": "逃逸电子最危险的特性之一是通过“雪崩”过程实现指数级增长的能力。本练习旨在从第一性原理出发，对雪崩增长建立一个基础的解析理解，并推导出其特征时间尺度。通过这个练习，你将深入理解逃逸电子的增殖如何关键地依赖于加速电场 $E$ 与临界电场 $E_c$ 的比值，这是掌握逃逸电子动力学的第一步。",
            "id": "4042645",
            "problem": "考虑一个大环径比托卡马克等离子体在热猝灭后的阶段，其中一个大小为 $E$ 的空间均匀环向电场在一个面积为 $A$ 的磁通管截面上持续存在，并且在时间上近似恒定。热猝灭后立即存在一个密度为 $n_{re,0}$ 的种子逃逸电子（REs）布居。假设由大角度库仑（Møller）敲出碰撞引起的雪崩倍增是新逃逸电子产生的主要机制，并且逃逸电子迅速达到高相对论状态，因此其平行速度可以近似为 $v_{\\parallel} \\approx c$，其中 $c$ 是真空中的光速。\n\n使用以下经过充分检验的定义作为基本依据：\n- Connor–Hastie 临界电场 $E_c$ 定义为\n$$\nE_c \\equiv \\frac{n_e e^{3} \\ln\\Lambda}{4 \\pi \\epsilon_0^{2} m_e c^{2}},\n$$\n其中 $n_e$ 是背景电子密度，$e$ 是元电荷，$\\ln\\Lambda$ 是库仑对数，$\\epsilon_0$ 是真空介电常数，$m_e$ 是电子质量。\n- 相对论性电子-电子碰撞时间\n$$\n\\tau_r \\equiv \\frac{4 \\pi \\epsilon_0^{2} m_e^{2} c^{3}}{n_e e^{4} \\ln\\Lambda}.\n$$\n\n从逃逸电子布居的粒子数平衡和关于大角度碰撞产生的基本动力学考虑出发，基于第一性原理进行论证：对于一个固定的超临界场比 $E/E_c  1$，雪崩源会引起逃逸电子密度 $n_{re}(t)$ 的指数增长，其增长率是一个常数，该增长率与 $(E/E_c - 1)$ 成正比，并由时间尺度 $\\tau_r$ 决定（相差一个数量级为一的因子）。为了进行解析估算，忽略与详细的螺距角和有效电荷依赖性相关的数量级为一的前置因子，并将增长率建模为与 $(E/E_c - 1)/\\tau_r$ 成正比。\n\n假设总逃逸电流可以很好地由 $I_{re}(t) = e\\, A\\, c\\, n_{re}(t)$ 近似，请确定逃逸电流达到指定目标值 $I_{\\ast}$ 所需时间 $t_{\\ast}$ 的解析表达式，该表达式应使用 $E/E_c$、$\\tau_r$、$I_{\\ast}$、$A$、$e$、$c$ 和 $n_{re,0}$ 表示。如果所有输入均采用国际单位制（SI），则以秒为单位表示时间的最终公式。你的最终答案必须是单一的封闭形式表达式。无需进行数值计算。",
            "solution": "问题要求推导雪崩增长的逃逸电子布居达到目标电流 $I_{\\ast}$ 所需时间 $t_{\\ast}$ 的表达式。该问题陈述在科学上是合理的、提法明确，并且在给定的简化假设下，包含了获得唯一解所需的足够信息。\n\n控制逃逸电子（RE）布居演化的基本原理是粒子数守恒。逃逸电子密度 $n_{re}$ 的变化率由源项和损失机制的平衡决定。问题指明，在时间 $t=0$ 时存在一个密度为 $n_{re,0}$ 的初始种子布居，并且主要的产生机制是雪崩倍增。在此估算中，我们忽略任何损失项。雪崩源项 $S_{ava}$ 与现有逃逸电子通过大角度碰撞产生次级逃逸电子的数量成正比。因此，粒子平衡方程可以写成一个一阶速率方程：\n$$\n\\frac{d n_{re}(t)}{dt} = S_{ava} = \\gamma n_{re}(t)\n$$\n其中 $\\gamma$ 是雪崩增长率。\n\n下一步是确定增长率 $\\gamma$ 的形式。问题要求从第一性原理进行论证。逃逸电子的存在取决于环向电场 $E$ 是否足够强以克服碰撞阻力。Connor–Hastie 临界电场 $E_c$ 代表了一个阈值，在该阈值下，相对论性电子从电场获得的能量恰好与因碰撞造成的能量损失相平衡。对于超临界场 $E  E_c$，电子会经历净加速。能量增益的速率与“超临界”场的大小 $E - E_c$ 成正比。雪崩过程，即高能电子将热电子敲入逃逸能量范围的过程，其速率取决于这个净能量增益。对于相对论性电子，这个碰撞过程的特征时间尺度是相对论性碰撞时间 $\\tau_r$。因此，增长率 $\\gamma$ 必须与无量纲的场比 $(E-E_c)/E_c$ 成正比，并与碰撞时间 $\\tau_r$ 成反比。问题指导我们将比例常数取为1来对增长率进行建模：\n$$\n\\gamma = \\frac{\\frac{E}{E_c} - 1}{\\tau_r}\n$$\n鉴于 $E/E_c  1$，增长率 $\\gamma$ 是一个正常数，这会导致指数增长。\n\n我们现在求解 $n_{re}(t)$ 的微分方程：\n$$\n\\frac{d n_{re}}{dt} = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) n_{re}\n$$\n这是一个可分离的一阶线性常微分方程。我们从初始条件 $(t=0, n_{re}=n_{re,0})$ 对其积分到后来的状态 $(t, n_{re}(t))$：\n$$\n\\int_{n_{re,0}}^{n_{re}(t)} \\frac{d n'_{re}}{n'_{re}} = \\int_{0}^{t} \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) dt'\n$$\n由于右侧括号中的项不随时间变化，积分得到：\n$$\n\\ln(n_{re}(t)) - \\ln(n_{re,0}) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t\n$$\n$$\n\\ln\\left(\\frac{n_{re}(t)}{n_{re,0}}\\right) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t\n$$\n对两边取指数求解 $n_{re}(t)$，得到逃逸电子密度的时间演化：\n$$\nn_{re}(t) = n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t \\right)\n$$\n\n问题提供了一个总逃逸电流 $I_{re}(t)$ 的表达式，假设逃逸电子是高相对论性的（$v_{\\parallel} \\approx c$）：\n$$\nI_{re}(t) = e A c n_{re}(t)\n$$\n其中 $e$ 是元电荷，$A$ 是磁通管的截面积，$c$ 是光速。代入我们得到的 $n_{re}(t)$ 表达式：\n$$\nI_{re}(t) = e A c n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t \\right)\n$$\n\n最后，我们确定逃逸电流达到指定目标值 $I_{\\ast}$ 的时间 $t_{\\ast}$。我们令 $I_{re}(t_{\\ast}) = I_{\\ast}$：\n$$\nI_{\\ast} = e A c n_{re,0} \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast} \\right)\n$$\n为了求解 $t_{\\ast}$，我们首先分离出指数项：\n$$\n\\frac{I_{\\ast}}{e A c n_{re,0}} = \\exp\\left( \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast} \\right)\n$$\n对两边取自然对数：\n$$\n\\ln\\left( \\frac{I_{\\ast}}{e A c n_{re,0}} \\right) = \\left( \\frac{E/E_c - 1}{\\tau_r} \\right) t_{\\ast}\n$$\n分离出 $t_{\\ast}$ 得到最终表达式：\n$$\nt_{\\ast} = \\frac{\\tau_r}{\\frac{E}{E_c} - 1} \\ln\\left( \\frac{I_{\\ast}}{e A c n_{re,0}} \\right)\n$$\n这个表达式给出了逃逸电流从其由种子密度 $n_{re,0}$ 决定的初始值增长到目标值 $I_{\\ast}$ 所需的时间，该增长由雪崩驱动，其增长率由超临界电场比 $E/E_c$ 和相对论性碰撞时间 $\\tau_r$ 决定。该表达式在量纲上是正确的，因为 $\\tau_r$ 具有时间单位，而所有其他因子都是无量纲的。",
            "answer": "$$\n\\boxed{\\frac{\\tau_r}{\\frac{E}{E_c} - 1} \\ln\\left(\\frac{I_{\\ast}}{e A c n_{re,0}}\\right)}\n$$"
        },
        {
            "introduction": "在理解了临界电场 $E_c$ 的概念后，本练习将探讨一种核心的缓解策略：通过注入高 $Z$ 杂质来提高 $E_c$。我们将深入研究这些杂质如何通过增加对逃逸电子的碰撞阻力来实现缓解，并引入一个依赖于能量的屏蔽模型来提供更真实的估算。这项实践对于设计有效的物质注入系统至关重要，因为它揭示了杂质原子与高能电子相互作用的微观物理机制。",
            "id": "4042672",
            "problem": "建立一个算法模型，通过在碰撞阻力中包含束缚电子的能量依赖性屏蔽效应，来量化高Z杂质的部分电离如何改变用于抑制逃逸电子的相对论临界电场。从基本能量平衡出发，构建一个计算上易于处理的公式，该公式可用一系列给定的案例进行测试。\n\n基本原理：考虑一个高相对论性电子，其电荷为 $e$，质量为 $m_e$，速度为 $v \\approx c$，洛伦兹因子为 $\\gamma$。其瞬时能量演化遵循 $d(\\gamma m_e c^2)/dt = e E v - P_{\\mathrm{coll}}(\\gamma)$，其中 $E$ 是电场，$P_{\\mathrm{coll}}(\\gamma)$ 是碰撞功率损失。相对论临界电场 $E_c$ 在 $v \\approx c$ 的极限下由条件 $e E_c c = P_{\\mathrm{coll}}(\\gamma)$ 定义。在完全电离的等离子体中，不考虑束缚电子效应且在高能量下，基准临界电场的标准 Connor-Hastie 形式为\n$$\nE_c^{(0)} = \\frac{n_e e^3 \\ln \\Lambda}{4 \\pi \\epsilon_0^2 m_e c^2},\n$$\n其中 $n_e$ 是自由电子密度，$\\epsilon_0$ 是真空介电常数，而 $\\ln \\Lambda$ 是库仑对数，在此处的冷等离子体近似下被视为常数。\n\n束缚电子屏蔽建模：当高Z杂质部分电离时，其一部分束缚电子会贡献于碰撞阻力，这取决于逃逸电子的能量。设杂质种类由 $j$ 索引，其数密度为 $n_j$，每个离子有 $N_b^{(j)}$ 个束缚电子。为种类 $j$ 定义一个能量依赖的去屏蔽分数 $S_j(\\gamma) \\in [0,1]$，该分数满足在低能量下（完全屏蔽）$S_j(\\gamma) \\rightarrow 0$，并在极高能量下（去屏蔽）$S_j(\\gamma) \\rightarrow 1$。基于动量转移标度的最小、有物理动机的参数形式为\n$$\nS_j(\\gamma) = \\frac{(\\gamma/\\gamma_{s,j})^q}{1 + (\\gamma/\\gamma_{s,j})^q},\n$$\n其中 $q$ 是一个控制转变锐度的正实数，$\\gamma_{s,j}$ 是种类 $j$ 中去屏蔽开始的特征洛伦兹因子，它编码了其束缚电子结构（例如，通过有效屏蔽长度或平均激发能）。在此模型中，在洛伦兹因子 $\\gamma$ 下对碰撞阻力有贡献的有效电子数密度为\n$$\nn_{\\mathrm{eff}}(\\gamma) = n_e + \\sum_j n_j N_b^{(j)} S_j(\\gamma).\n$$\n假设碰撞功率损失与可接触的电子密度成线性关系，那么修正后的临界电场为\n$$\nE_c(\\gamma) = \\frac{n_{\\mathrm{eff}}(\\gamma)}{n_e} E_c^{(0)} = \\left[1 + \\sum_j \\frac{n_j}{n_e} N_b^{(j)} S_j(\\gamma)\\right] \\frac{n_e e^3 \\ln \\Lambda}{4 \\pi \\epsilon_0^2 m_e c^2}.\n$$\n\n任务：实现一个程序，对于一组给定的等离子体和杂质参数，使用上述模型计算 $E_c(\\gamma)$。使用国际单位制（SI）中的物理常数 $e$、$m_e$、$c$ 和 $\\epsilon_0$。所有电场必须以 $\\mathrm{V/m}$ 为单位表示，所有密度以 $\\mathrm{m}^{-3}$ 为单位表示。此任务中不涉及角度。程序应生成四舍五入到六位小数的结果。\n\n测试套件：对以下五个案例评估 $E_c(\\gamma)$，每个案例由 $(n_e, \\ln \\Lambda, \\gamma, q, \\{(n_j, N_b^{(j)}, \\gamma_{s,j})\\}_j)$ 指定：\n\n- 案例 $1$（基准，无杂质）：$n_e = 4.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$\\ln \\Lambda = 15.0$，$\\gamma = 20.0$，$q = 2$，无杂质种类（空集）。\n- 案例 $2$（低能量下的部分电离钨）：$n_e = 4.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$\\ln \\Lambda = 15.0$，$\\gamma = 3.0$，$q = 2$，一个种类，其 $n_1 = 5.0 \\times 10^{17}\\ \\mathrm{m}^{-3}$，$N_b^{(1)} = 44$（代表每个钨离子有 $44$ 个束缚电子），以及 $\\gamma_{s,1} = 10.0$。\n- 案例 $3$（高能量下的部分电离钨）：与案例2相同，除了 $\\gamma = 50.0$。\n- 案例 $4$（中等能量下的多种杂质）：$n_e = 6.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$\\ln \\Lambda = 16.0$，$\\gamma = 12.0$，$q = 2$，两种类：种类1，其 $n_1 = 1.2 \\times 10^{18}\\ \\mathrm{m}^{-3}$，$N_b^{(1)} = 10$，$\\gamma_{s,1} = 8.0$；以及种类2，其 $n_2 = 8.0 \\times 10^{17}\\ \\mathrm{m}^{-3}$，$N_b^{(2)} = 2$，$\\gamma_{s,2} = 5.0$。\n- 案例 $5$（完全电离杂质，边界检查）：$n_e = 4.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$\\ln \\Lambda = 15.0$，$\\gamma = 1000000.0$，$q = 2$，一个种类，其 $n_1 = 1.0 \\times 10^{18}\\ \\mathrm{m}^{-3}$，$N_b^{(1)} = 0$（无束缚电子），以及 $\\gamma_{s,1} = 10.0$。\n\n答案规格与最终输出格式：对每个案例，计算一个等于 $E_c(\\gamma)$（单位为 $\\mathrm{V/m}$）的浮点数，并四舍五入到六位小数。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[E_1,E_2,E_3,E_4,E_5]$）。不允许有其他输出。",
            "solution": "该问题经评估有效。它在科学上基于等离子体物理学和逃逸电子动力学的原理，特别是在计算聚变科学的背景下。该问题是适定的，提供了完整且一致的方程、参数和测试案例，从而可以构建一个唯一且可验证的解。语言客观、精确，所有术语都有明确定义。因此，将提供一个合理的解。\n\n目标是计算修正后的临界电场 $E_c(\\gamma)$，该电场考虑了来自部分电离杂质的束缚电子的能量依赖性碰撞阻力。计算过程通过实现问题陈述中描述的模型来进行。\n\n该模型的基础是针对完全电离等离子体的 Connor-Hastie 临界电场 $E_c^{(0)}$。这代表了平衡高相对论性电子上的碰撞阻力所需的基准电场，以防止其“逃逸”到更高能量。其表达式为：\n$$\nE_c^{(0)} = \\frac{n_e e^3 \\ln \\Lambda}{4 \\pi \\epsilon_0^2 m_e c^2}\n$$\n此处，$n_e$ 是自由电子密度，$\\ln \\Lambda$ 是库仑对数，$e$ 是元电荷，$m_e$ 是电子静止质量，$c$ 是真空中的光速，$\\epsilon_0$ 是真空介电常数。\n\n为了简化计算，我们可以将物理常数组合成一个单一因子 $K$：\n$$\nK = \\frac{e^3}{4 \\pi \\epsilon_0^2 m_e c^2}\n$$\n使用物理常数的标准国际单位制（SI）值：\n- $e \\approx 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$\n- $\\epsilon_0 \\approx 8.8541878128 \\times 10^{-12}\\ \\mathrm{F/m}$\n- $m_e \\approx 9.1093837015 \\times 10^{-31}\\ \\mathrm{kg}$\n- $c = 299792458\\ \\mathrm{m/s}$\n\n该常数的值约为 $K \\approx 5.090333 \\times 10^{-23}\\ \\mathrm{V \\cdot m^2}$。于是基准临界电场可以表示为 $E_c^{(0)} = K n_e \\ln \\Lambda$。\n\n新模型的核心是引入一个有效电子密度 $n_{\\mathrm{eff}}(\\gamma)$，洛伦兹因子为 $\\gamma$ 的逃逸电子与之相互作用。该密度不仅包括自由电子 $n_e$，还包括来自杂质离子的部分束缚电子。这个比例由每种杂质 $j$ 的能量依赖性去屏蔽函数 $S_j(\\gamma)$ 决定：\n$$\nS_j(\\gamma) = \\frac{(\\gamma/\\gamma_{s,j})^q}{1 + (\\gamma/\\gamma_{s,j})^q}\n$$\n其中 $\\gamma_{s,j}$ 是种类 $j$ 去屏蔽开始的特征洛伦兹因子，$q$ 决定了此转变的锐度。此函数正确地捕捉了物理极限：对于低能电子（$\\gamma \\ll \\gamma_{s,j}$），$S_j(\\gamma) \\to 0$，束缚电子被完全屏蔽。对于高能电子（$\\gamma \\gg \\gamma_{s,j}$），$S_j(\\gamma) \\to 1$，束缚电子被去屏蔽，完全贡献于碰撞阻力。\n\n有效电子密度是自由电子和所有杂质种类的贡献之和：\n$$\nn_{\\mathrm{eff}}(\\gamma) = n_e + \\sum_j n_j N_b^{(j)} S_j(\\gamma)\n$$\n其中 $n_j$ 是杂质种类 $j$ 的数密度，$N_b^{(j)}$ 是该种类每个离子的束缚电子数。\n\n修正后的临界电场 $E_c(\\gamma)$ 被假定与此有效电子密度成线性关系。因此，它通过比率 $n_{\\mathrm{eff}}(\\gamma)/n_e$ 与基准电场相关联：\n$$\nE_c(\\gamma) = \\frac{n_{\\mathrm{eff}}(\\gamma)}{n_e} E_c^{(0)} = \\left[1 + \\frac{1}{n_e}\\sum_j n_j N_b^{(j)} S_j(\\gamma)\\right] E_c^{(0)}\n$$\n这是需要实现的最终表达式。算法流程如下：\n1. 对于一个给定的测试案例，确定参数：$n_e$、$\\ln \\Lambda$、$\\gamma$、$q$ 和杂质数据集 $\\{(n_j, N_b^{(j)}, \\gamma_{s,j})\\}_j$。\n2. 计算基准临界电场 $E_c^{(0)} = K n_e \\ln \\Lambda$。\n3. 初始化杂质贡献的总和 $\\Sigma = 0$。\n4. 对于所提供集合中的每个杂质种类 $j$：\n    a. 使用其特定参数 $\\gamma_{s,j}$ 和全局参数 $\\gamma$、$q$ 来计算去屏蔽分数 $S_j(\\gamma)$。\n    b. 计算该种类对总和的贡献：$\\frac{n_j}{n_e} N_b^{(j)} S_j(\\gamma)$。\n    c. 将此贡献加到总和 $\\Sigma$ 中。\n5. 计算最终的修正临界电场 $E_c(\\gamma) = (1 + \\Sigma) E_c^{(0)}$。\n6. 按要求将结果四舍五入到六位小数。\n\n此流程将应用于所提供的五个测试案例中的每一个。对于没有杂质的案例，总和 $\\Sigma$ 为零，结果简化为 $E_c(\\gamma) = E_c^{(0)}$。对于杂质种类没有束缚电子（$N_b^{(j)}=0$）的特殊情况，其对总和的贡献也为零，无论其他参数如何。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the modified critical electric field for runaway electrons,\n    including effects from partially ionized impurities.\n    \"\"\"\n\n    # Physical constants in SI units\n    E_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\n    EPSILON_0 = 8.8541878128e-12  # Vacuum permittivity in F/m\n    M_E = 9.1093837015e-31      # Electron rest mass in kg\n    C_LIGHT = 299792458         # Speed of light in m/s\n\n    # Pre-calculate the constant factor K for E_c^(0)\n    K_CONST = (E_CHARGE**3) / (4 * np.pi * EPSILON_0**2 * M_E * C_LIGHT**2)\n\n    def calculate_Ec(n_e, ln_Lambda, gamma, q, impurities):\n        \"\"\"\n        Computes the modified critical electric field E_c(gamma).\n\n        Args:\n            n_e (float): Free electron density in m^-3.\n            ln_Lambda (float): Coulomb logarithm.\n            gamma (float): Lorentz factor of the runaway electron.\n            q (float): Sharpness parameter for the unscreening function.\n            impurities (list of tuples): A list where each tuple contains\n                                        (n_j, N_b, gamma_s) for an impurity species.\n                                        n_j: impurity density in m^-3\n                                        N_b: number of bound electrons\n                                        gamma_s: characteristic Lorentz factor for unscreening\n\n        Returns:\n            float: The modified critical electric field in V/m, rounded to 6 decimal places.\n        \"\"\"\n        # Step 1: Calculate the baseline Connor-Hastie critical field E_c^(0)\n        Ec0 = K_CONST * n_e * ln_Lambda\n\n        # Step 2: Calculate the impurity contribution sum\n        impurity_sum = 0.0\n        if impurities: # Handle cases with no impurities\n            for n_j, N_b, gamma_s in impurities:\n                # If there are no bound electrons, this term is zero\n                if N_b == 0:\n                    continue\n                \n                # Calculate the energy-dependent unscreening fraction S_j(gamma)\n                gamma_ratio_q = (gamma / gamma_s)**q\n                S_j = gamma_ratio_q / (1.0 + gamma_ratio_q)\n                \n                # Add the contribution of this species to the sum\n                impurity_sum += (n_j / n_e) * N_b * S_j\n\n        # Step 3: Calculate the final modified critical field E_c(gamma)\n        Ec_gamma = (1.0 + impurity_sum) * Ec0\n        \n        # Step 4: Round to the specified number of decimal places\n        return round(Ec_gamma, 6)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: baseline, no impurities\n        (4.0e19, 15.0, 20.0, 2, []),\n        # Case 2: partially ionized tungsten at low energy\n        (4.0e19, 15.0, 3.0, 2, [(5.0e17, 44, 10.0)]),\n        # Case 3: partially ionized tungsten at high energy\n        (4.0e19, 15.0, 50.0, 2, [(5.0e17, 44, 10.0)]),\n        # Case 4: multiple impurities at intermediate energy\n        (6.0e19, 16.0, 12.0, 2, [(1.2e18, 10, 8.0), (8.0e17, 2, 5.0)]),\n        # Case 5: fully ionized impurity, boundary check\n        (4.0e19, 15.0, 1000000.0, 2, [(1.0e18, 0, 10.0)]),\n    ]\n\n    results = []\n    for case in test_cases:\n        n_e, ln_Lambda, gamma, q, impurities = case\n        result = calculate_Ec(n_e, ln_Lambda, gamma, q, impurities)\n        results.append(f\"{result:.6f}\") # Ensure trailing zeros are included\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这个练习将前面的概念综合成一个实际的优化问题。成功的缓解策略不仅取决于注入“什么”物质，还关键地取决于“何时”注入。本练习要求你建立一个动态模型，通过权衡抑制逃逸电子雪崩的需求与行动过晚所带来的惩罚，来寻找最佳的注入时机。这让你能够体验在托卡马克运行和保护中需要做出的真实世界里的权衡与决策。",
            "id": "4042696",
            "problem": "您需要设计并实现一个完整的程序，该程序计算相对于热猝灭起始时刻的杂质注入（例如大量气体注入（MGI）或破碎弹丸注入（SPI））的最佳时机，以抑制逃逸电子雪崩增长，同时最小化电流猝灭早期的未缓解加速。考虑一个具有以下动力学和目标的简化零维等离子体模型。\n\n假设热猝灭在时间 $t=0$ 秒时开始。对于 $t0$，等离子体处于猝灭前状态。对于 $t\\ge 0$，等离子体温度呈指数下降，电阻电场相应增长。该模型使用以下要素：\n\n1. 温度演化：对于 $t\\ge 0$，温度按以下公式衰减\n$$\nT(t)=T_0 \\exp\\left(-\\frac{t}{t_{\\mathrm{TQ}}}\\right),\n$$\n对于 $t0$，$T(t)=T_0$，其中 $t_{\\mathrm{TQ}}$ 是热猝灭时间尺度。只需要比值 $T(t)/T_0$。\n\n2. 电场演化：对于 $t\\ge 0$，欧姆电场与 Spitzer 电导率成反比，而 Spitzer 电导率与温度的关系为 $\\sigma\\propto T^{3/2}$。这导致\n$$\nE(t)=E_0\\exp\\left(\\frac{3t}{2t_{\\mathrm{TQ}}}\\right),\n$$\n对于 $t0$，$E(t)=E_0$，其中 $E_0$ 是猝灭前电场。\n\n3. 电子密度：注入前，背景电子密度为 $n_e(t)=n_{e0}$。在注入时刻 $t_{\\mathrm{inj}}$，密度增量 $\\Delta n$ 以随时间变化的效率被吸收。定义 Heaviside 阶跃函数 $H(\\cdot)$ 和吸收函数 $s(t_{\\mathrm{inj}})$ 为\n$$\ns(t_{\\mathrm{inj}})=\n\\begin{cases}\n1,  t_{\\mathrm{inj}}\\ge 0 \\\\\n\\exp\\left(\\frac{t_{\\mathrm{inj}}}{t_{\\mathrm{assim}}}\\right),  t_{\\mathrm{inj}}0\n\\end{cases}\n$$\n其中 $t_{\\mathrm{assim}}$ 是一个特征性的猝灭前吸收时间尺度。则\n$$\nn_e(t)=n_{e0}+s(t_{\\mathrm{inj}})\\,\\Delta n\\,H\\!\\left(t-t_{\\mathrm{inj}}\\right).\n$$\n\n4. 临界电场：将 Connor-Hastie 临界电场近似为与电子密度成线性关系，\n$$\nE_c(n_e)=k_c\\,n_e(t),\n$$\n比例常数为 $k_c$。\n\n5. 雪崩增长因子：定义有效归一化加速电场\n$$\nF(t)=\\max\\left(0,\\,\\frac{E(t)}{E_c\\!\\left(n_e(t)\\right)}-1\\right).\n$$\n雪崩增长率为\n$$\n\\gamma_a(t)=\\gamma_{\\mathrm{ref}}\\,F(t)\\,\\frac{n_{e,\\mathrm{ref}}}{n_e(t)},\n$$\n其中 $\\gamma_{\\mathrm{ref}}$ 是一个参考率，$n_{e,\\mathrm{ref}}$ 是一个参考密度。\n\n6. 逃逸电子的种子源：采用一个以热猝灭起始点附近为中心的高斯热尾种子源，\n$$\nS_{\\mathrm{seed}}(t)=S_0\\,\\exp\\!\\left(-\\frac{\\left(t-t_{\\mathrm{seed}}\\right)^2}{2\\sigma_{\\mathrm{seed}}^2}\\right),\n$$\n振幅为 $S_0$，中心为 $t_{\\mathrm{seed}}$，宽度为 $\\sigma_{\\mathrm{seed}}$。\n\n7. 逃逸电子密度演化：总逃逸电子密度 $n_r(t)$ 按以下公式演化\n$$\n\\frac{d n_r}{d t}=\\gamma_a(t)\\,n_r(t)+S_{\\mathrm{seed}}(t),\n$$\n初始条件为 $n_r(t_{\\min})=0$，其中 $t_{\\min}0$ 是模拟窗口的开始时间。\n\n定义未缓解的电流猝灭加速惩罚项为缓解开始前加速因子 $F(t)$ 的时间积分，\n$$\nA_{\\mathrm{unmit}}(t_{\\mathrm{inj}})=\n\\begin{cases}\n\\displaystyle \\int_0^{t_{\\mathrm{inj}}}F(t)\\,dt,  t_{\\mathrm{inj}}>0 \\\\\n0,  t_{\\mathrm{inj}}\\le 0\n\\end{cases}\n$$\n\n定义优化目标为\n$$\nJ(t_{\\mathrm{inj}})=w_R\\,n_r(T_{\\mathrm{end}})+w_A\\,A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}),\n$$\n其中 $w_R$ 和 $w_A$ 是权重，$T_{\\mathrm{end}}$ 是模拟窗口的结束时间。\n\n您的程序必须：\n- 使用前向欧拉（forward-Euler）积分器，在均匀时间网格上模拟上述模型，以计算逃逸电子密度 $n_r(t)$。\n- 对于闭区间 $[t_{\\min},t_{\\max}]$ 内的候选注入时间 $t_{\\mathrm{inj}}$，计算目标函数 $J(t_{\\mathrm{inj}})$，并选择使 $J(t_{\\mathrm{inj}})$ 最小的 $t_{\\mathrm{inj}}$。\n- 使用下方的测试套件，并为每个案例报告以秒为单位的最佳 $t_{\\mathrm{inj}}$。\n\n物理单位：\n- 时间单位应为秒 (s)。\n- 电场单位应为伏特/米 ($\\mathrm{V/m}$)。\n- 电子密度单位应为每立方米 ($\\mathrm{m^{-3}}$)。\n- 最终程序输出必须是最佳注入时间，以秒为单位。\n\n角度单位：不使用角度。如果需要任何三角函数，其参数必须以弧度为单位。\n\n百分比：不使用。如果需要任何分数形式的输出，请以小数表示。\n\n测试套件：\n提供以下 4 组参数集。每个参数都给出了其单位和数值。您必须在程序中严格使用这些值。\n\n- 案例 1（典型的热猝灭和良好的猝灭前吸收）：\n    - $t_{\\mathrm{TQ}}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $E_0=6.0\\times 10^{-1}\\,\\mathrm{V/m}$,\n    - $n_{e0}=3.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $\\Delta n=8.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $k_c=5.0\\times 10^{-21}\\,\\mathrm{V\\,m}$,\n    - $\\gamma_{\\mathrm{ref}}=5.0\\times 10^{2}\\,\\mathrm{s^{-1}}$,\n    - $n_{e,\\mathrm{ref}}=1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $S_0=5.0\\times 10^{15}\\,\\mathrm{m^{-3}\\,s^{-1}}$,\n    - $t_{\\mathrm{seed}}=6.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $\\sigma_{\\mathrm{seed}}=2.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $w_R=1.0$,\n    - $w_A=1.0\\times 10^{18}\\,\\mathrm{s^{-1}}$,\n    - $t_{\\min}=-1.5\\times 10^{-3}\\,\\mathrm{s}$,\n    - $t_{\\max}=2.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $T_{\\mathrm{end}}=2.5\\times 10^{-3}\\,\\mathrm{s}$,\n    - $\\Delta t=2.0\\times 10^{-6}\\,\\mathrm{s}$,\n    - $t_{\\mathrm{assim}}=5.0\\times 10^{-4}\\,\\mathrm{s}$.\n\n- 案例 2（不良的猝灭前吸收）：\n    - 除 $t_{\\mathrm{assim}}=1.0\\times 10^{-4}\\,\\mathrm{s}$ 外，与案例 1 相同。\n\n- 案例 3（快速热猝灭，早期电场上升更强）：\n    - $t_{\\mathrm{TQ}}=2.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $E_0=6.0\\times 10^{-1}\\,\\mathrm{V/m}$,\n    - $n_{e0}=3.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $\\Delta n=8.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $k_c=5.0\\times 10^{-21}\\,\\mathrm{V\\,m}$,\n    - $\\gamma_{\\mathrm{ref}}=5.0\\times 10^{2}\\,\\mathrm{s^{-1}}$,\n    - $n_{e,\\mathrm{ref}}=1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n    - $S_0=5.0\\times 10^{15}\\,\\mathrm{m^{-3}\\,s^{-1}}$,\n    - $t_{\\mathrm{seed}}=1.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $\\sigma_{\\mathrm{seed}}=5.0\\times 10^{-5}\\,\\mathrm{s}$,\n    - $w_R=1.0$,\n    - $w_A=1.0\\times 10^{18}\\,\\mathrm{s^{-1}}$,\n    - $t_{\\min}=-5.0\\times 10^{-4}\\,\\mathrm{s}$,\n    - $t_{\\max}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $T_{\\mathrm{end}}=1.0\\times 10^{-3}\\,\\mathrm{s}$,\n    - $\\Delta t=1.0\\times 10^{-6}\\,\\mathrm{s}$,\n    - $t_{\\mathrm{assim}}=5.0\\times 10^{-4}\\,\\mathrm{s}$.\n\n- 案例 4（注入量较弱）：\n    - 除 $\\Delta n=2.0\\times 10^{19}\\,\\mathrm{m^{-3}}$ 外，与案例 1 相同。\n\n最终输出：\n您的程序应生成单行输出，其中包含四个案例的最佳注入时间（以秒为单位），格式为方括号内以逗号分隔的列表（例如，$[t_1,t_2,t_3,t_4]$）。每个 $t_i$ 必须是浮点数，单位为秒。\n\n您的程序必须是一个完整、可运行的 Python 3.12 脚本，仅使用标准库和指定的数值库。它不得要求任何用户输入或外部文件。它必须严格遵守执行环境和最终输出格式要求。",
            "solution": "解决此优化问题的核心方法是进行参数扫描。我们需要最小化一个复合目标函数 $J(t_{\\mathrm{inj}})$，该函数由两部分加权构成：最终的逃逸电子密度 $n_r(T_{\\mathrm{end}})$ 和干预前的未缓解加速积分 $A_{\\mathrm{unmit}}(t_{\\mathrm{inj}})$。尽管这两个部分的物理量纲不同，但通过权重 $w_R$ 和 $w_A$ 进行缩放后，它们共同构成了一个用于评估缓解策略优劣的数学成本函数。我们将在一系列候选注入时间 $t_{\\mathrm{inj}}$ 上计算此成本函数，并找出使其最小化的时间点。对于每个候选的 $t_{\\mathrm{inj}}$，必须根据所提供的零维模型执行一次含时模拟。\n\n算法流程如下：\n\n**1. 离散化与网格设置**\n\n将连续时间问题离散化到均匀的时间网格上。设时间步长为 $\\Delta t$。模拟时间点为 $t_i = t_{\\min} + i \\cdot \\Delta t$，其中 $i=0, 1, 2, \\dots, N$。模拟从 $t_{\\min}$ 运行到 $T_{\\mathrm{end}}$，因此总点数为 $N+1 = (T_{\\mathrm{end}} - t_{\\min})/\\Delta t + 1$。候选注入时间 $t_{\\mathrm{inj}}$ 将从落在区间 $[t_{\\min}, t_{\\max}]$ 内的网格点 $t_i$ 中选择。\n\n**2. 针对固定的候选注入时间 $t_{\\mathrm{inj}}$ 的模拟**\n\n对于每个候选的 $t_{\\mathrm{inj}}$，我们模拟从 $t_{\\min}$ 到 $T_{\\mathrm{end}}$ 的等离子体和逃逸电子动力学。\n\n-   **电场和种子源**：含时电场 $E(t)$ 和逃逸种子源 $S_{\\mathrm{seed}}(t)$ 与注入时间 $t_{\\mathrm{inj}}$ 无关。它们的值可以针对整个模拟网格预先计算并存储在数组中。\n    对于每个时间点 $t_i$：\n    $$\n    E(t_i) = \n    \\begin{cases}\n    E_0\\exp\\left(\\frac{3t_i}{2t_{\\mathrm{TQ}}}\\right),  t_i \\ge 0 \\\\\n    E_0,  t_i  0\n    \\end{cases}\n    $$\n    $$\n    S_{\\mathrm{seed}}(t_i) = S_0\\,\\exp\\!\\left(-\\frac{\\left(t_i-t_{\\mathrm{seed}}\\right)^2}{2\\sigma_{\\mathrm{seed}}^2}\\right)\n    $$\n\n-   **电子密度**：背景电子密度 $n_e(t)$ 取决于所选的 $t_{\\mathrm{inj}}$。首先，我们计算吸收效率因子 $s(t_{\\mathrm{inj}})$：\n    $$\n    s(t_{\\mathrm{inj}}) = \n    \\begin{cases}\n    1,  t_{\\mathrm{inj}}\\ge 0 \\\\\n    \\exp\\left(\\frac{t_{\\mathrm{inj}}}{t_{\\mathrm{assim}}}\\right),  t_{\\mathrm{inj}}0\n    \\end{cases}\n    $$\n    然后，对于每个时间点 $t_i$，电子密度为：\n    $$\n    n_e(t_i) = n_{e0}+s(t_{\\mathrm{inj}})\\,\\Delta n\\,H\\!\\left(t_i-t_{\\mathrm{inj}}\\right)\n    $$\n    其中 H 是 Heaviside 阶跃函数，如果其参数为非负数则等于 1，否则等于 0。这会在时间 $t_{\\mathrm{inj}}$ 处产生密度的阶跃式增加。\n\n-   **导出量**：有了 $E(t)$ 和 $n_e(t)$ 的数组，我们可以为每个时间点 $t_i$ 计算临界电场 $E_c(t)$、归一化加速电场 $F(t)$ 和雪崩增长率 $\\gamma_a(t)$：\n    $$ E_c(t_i) = k_c\\,n_e(t_i) $$\n    $$ F(t_i) = \\max\\left(0,\\,\\frac{E(t_i)}{E_c(t_i)}-1\\right) $$\n    $$ \\gamma_a(t_i) = \\gamma_{\\mathrm{ref}}\\,F(t_i)\\,\\frac{n_{e,\\mathrm{ref}}}{n_e(t_i)} $$\n\n-   **逃逸密度演化**：逃逸密度 $n_r(t)$ 由常微分方程 $\\frac{d n_r}{d t}=\\gamma_a(t)\\,n_r(t)+S_{\\mathrm{seed}}(t)$ 控制。我们按照规定，使用前向欧拉（forward-Euler）方法对其进行数值求解。从初始条件 $n_r(t_{\\min}) = 0$ 开始，我们对 $i=0, \\dots, N-1$ 进行迭代：\n    $$\n    n_r(t_{i+1}) = n_r(t_i) + \\Delta t \\left[ \\gamma_a(t_i)\\,n_r(t_i) + S_{\\mathrm{seed}}(t_i) \\right]\n    $$\n    目标函数所需的值是最终密度 $n_r(T_{\\mathrm{end}})$，它对应于 $n_r(t_N)$。\n\n**3. 目标函数计算**\n\n在完成给定 $t_{\\mathrm{inj}}$ 的模拟后，我们计算目标函数 $J(t_{\\mathrm{inj}})$ 的两个组成部分。\n\n-   **逃逸布居惩罚项**：这部分就是 $w_R$ 乘以最终逃逸密度：$w_R \\, n_r(T_{\\mathrm{end}})$。\n\n-   **未缓解加速惩罚项**：这部分是 $w_A$ 乘以积分 $A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}) = \\int_0^{t_{\\mathrm{inj}}}F(t)\\,dt$。我们对这个积分进行数值近似。左黎曼和与前向欧拉积分方案一致。我们找到对应于 $t=0$ 和 $t=t_{\\mathrm{inj}}$ 的网格索引，并在此区间内对 $F(t_i)\\Delta t$ 的值求和。根据定义，如果 $t_{\\mathrm{inj}} \\le 0$，则此惩罚项为 0。\n    $$\n    A_{\\mathrm{unmit}}(t_{\\mathrm{inj}}) \\approx \n    \\begin{cases}\n    \\displaystyle \\Delta t \\sum_{t_i \\in [0, t_{\\mathrm{inj}})} F(t_i),  t_{\\mathrm{inj}}>0 \\\\\n    0,  t_{\\mathrm{inj}}\\le 0\n    \\end{cases}\n    $$\n\n总目标值为两项之和：$J(t_{\\mathrm{inj}}) = w_R\\,n_r(T_{\\mathrm{end}}) + w_A\\,A_{\\mathrm{unmit}}(t_{\\mathrm{inj}})$。\n\n**4. 优化**\n\n对于搜索窗口 $[t_{\\min}, t_{\\max}]$ 内时间网格上的每个候选注入时间 $t_{\\mathrm{inj}}$，重复上述过程（步骤2和3）。我们记录到目前为止找到的 $J$ 的最小值以及产生该最小值的相应 $t_{\\mathrm{inj}}$。在遍历所有候选时间后，记录的 $t_{\\mathrm{inj}}$ 就是给定参数集下的最佳注入时间。对所提供的四个测试案例中的每一个都执行此过程。实现将利用 `numpy` 库来高效地对含时数组进行矢量化计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the runaway electron mitigation optimization problem\n    for the four provided test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (typical thermal quench and good pre-quench assimilation)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 5.0e-4\n        },\n        # Case 2 (poor pre-quench assimilation)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 1.0e-4\n        },\n        # Case 3 (fast thermal quench with stronger early field rise)\n        {\n            \"t_TQ\": 2.0e-4, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 8.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 1.0e-4, \"sigma_seed\": 5.0e-5,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -5.0e-4, \"t_max\": 1.0e-3,\n            \"T_end\": 1.0e-3, \"dt\": 1.0e-6, \"t_assim\": 5.0e-4\n        },\n        # Case 4 (weak injection magnitude)\n        {\n            \"t_TQ\": 1.0e-3, \"E_0\": 0.6, \"n_e0\": 3.0e19, \"delta_n\": 2.0e19,\n            \"k_c\": 5.0e-21, \"gamma_ref\": 5.0e2, \"n_e_ref\": 1.0e19,\n            \"S_0\": 5.0e15, \"t_seed\": 6.0e-4, \"sigma_seed\": 2.0e-4,\n            \"w_R\": 1.0, \"w_A\": 1.0e18, \"t_min\": -1.5e-3, \"t_max\": 2.0e-3,\n            \"T_end\": 2.5e-3, \"dt\": 2.0e-6, \"t_assim\": 5.0e-4\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        optimal_t = find_optimal_injection_time(params)\n        results.append(optimal_t)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef find_optimal_injection_time(params):\n    \"\"\"\n    Computes the optimal injection time for a single set of parameters.\n    \"\"\"\n    # Unpack parameters\n    t_TQ = params[\"t_TQ\"]\n    E_0 = params[\"E_0\"]\n    n_e0 = params[\"n_e0\"]\n    delta_n = params[\"delta_n\"]\n    k_c = params[\"k_c\"]\n    gamma_ref = params[\"gamma_ref\"]\n    n_e_ref = params[\"n_e_ref\"]\n    S_0 = params[\"S_0\"]\n    t_seed = params[\"t_seed\"]\n    sigma_seed = params[\"sigma_seed\"]\n    w_R = params[\"w_R\"]\n    w_A = params[\"w_A\"]\n    t_min = params[\"t_min\"]\n    t_max = params[\"t_max\"]\n    T_end = params[\"T_end\"]\n    dt = params[\"dt\"]\n    t_assim = params[\"t_assim\"]\n\n    # --- 1. Grid setup and pre-calculation ---\n    # Use T_end + dt/2 to ensure T_end is included in the range\n    time_grid = np.arange(t_min, T_end + dt/2, dt)\n    num_steps = len(time_grid)\n\n    # Pre-calculate E(t) and S_seed(t) as they don't depend on t_inj\n    E_t = np.where(time_grid = 0, \n                   E_0 * np.exp(1.5 * time_grid / t_TQ),\n                   E_0)\n    \n    S_seed_t = S_0 * np.exp(-(time_grid - t_seed)**2 / (2 * sigma_seed**2))\n\n    # --- 2. Optimization loop ---\n    min_J = np.inf\n    optimal_t_inj = None\n\n    candidate_t_inj_grid = time_grid[(time_grid = t_min)  (time_grid = t_max)]\n\n    for t_inj in candidate_t_inj_grid:\n        # --- 3. Simulation for a fixed t_inj ---\n        \n        # Calculate assimilation efficiency s(t_inj)\n        if t_inj = 0:\n            s_t_inj = 1.0\n        else:\n            s_t_inj = np.exp(t_inj / t_assim)\n        \n        # Electron density n_e(t)\n        n_e_t = n_e0 + s_t_inj * delta_n * np.heaviside(time_grid - t_inj, 1)\n\n        # Critical field E_c(t), normalized field F(t), and avalanche rate gamma_a(t)\n        E_c_t = k_c * n_e_t\n        # Avoid division by zero, although E_c_t should always be > 0\n        with np.errstate(divide='ignore', invalid='ignore'):\n            F_t = np.maximum(0, E_t / E_c_t - 1)\n            gamma_a_t = gamma_ref * F_t * (n_e_ref / n_e_t)\n        \n        # Handle potential NaNs if n_e_t becomes zero, though unlikely with this model\n        F_t = np.nan_to_num(F_t)\n        gamma_a_t = np.nan_to_num(gamma_a_t)\n\n\n        # Runaway density evolution n_r(t) using forward-Euler\n        n_r_t = np.zeros(num_steps)\n        # Initial condition n_r(t_min) = 0 is set by np.zeros\n        for i in range(num_steps - 1):\n            dn_r_dt = gamma_a_t[i] * n_r_t[i] + S_seed_t[i]\n            n_r_t[i+1] = n_r_t[i] + dt * dn_r_dt\n        \n        n_r_T_end = n_r_t[-1]\n\n        # --- 4. Objective function calculation ---\n\n        # Unmitigated acceleration penalty A_unmit(t_inj)\n        if t_inj = 0:\n            A_unmit = 0.0\n        else:\n            # Integrate F(t) from t=0 to t=t_inj using a left Riemann sum\n            idx_0 = np.searchsorted(time_grid, 0, side='left')\n            idx_inj = np.searchsorted(time_grid, t_inj, side='left')\n            A_unmit = np.sum(F_t[idx_0:idx_inj]) * dt\n            \n        # Total objective J(t_inj)\n        J = w_R * n_r_T_end + w_A * A_unmit\n\n        # Check for new minimum\n        if J  min_J:\n            min_J = J\n            optimal_t_inj = t_inj\n\n    return optimal_t_inj\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}