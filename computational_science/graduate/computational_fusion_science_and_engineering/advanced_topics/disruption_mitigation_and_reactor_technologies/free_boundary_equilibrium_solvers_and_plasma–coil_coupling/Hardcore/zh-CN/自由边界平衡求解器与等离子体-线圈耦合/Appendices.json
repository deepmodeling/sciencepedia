{
    "hands_on_practices": [
        {
            "introduction": "在为托卡马克等环形设备中的等离子体建模时，首要任务是建立一个能够有效描述其复杂几何形状的坐标系。磁通坐标系 $(\\psi, \\theta, \\phi)$ 因其天然贴合嵌套磁面结构而成为理想选择。本实践练习的核心任务是将这些抽象的磁通坐标与实验室的物理圆柱坐标 $(R, Z, \\phi)$ 联系起来，并计算出描述该坐标变换的关键几何量，例如度规张量和雅可比行列式。通过这个练习，你将掌握为平衡和输运模拟构建几何基础的技能，并初步探索外部线圈产生的磁场如何改变等离子体几何形状，这是理解等离子体-线圈耦合的第一步 。",
            "id": "3982360",
            "problem": "您的任务是为环形几何中的轴对称自由边界平衡实现磁通坐标几何，通过线圈感应的垂直磁场来展示等离子体-线圈耦合，该磁场会使磁轴发生位移。必须使用从磁通坐标到柱坐标的映射来推导度规系数和雅可比行列式。计算必须在整个区域内（包括磁轴附近）保持数值稳定，并且必须遵循指定的单位。\n\n从以下适用于计算聚变科学与工程的基本原理开始：\n- 麦克斯韦方程组表明，如果外部线圈距离足够远，它们可以在等离子体区域产生一个近似均匀的垂直磁场。对于具有总安培匝数和有效长度的直线段近似，垂直磁场被视为均匀的：$$B_Z = \\mu_0 \\frac{N I}{L_{\\mathrm{eff}}},$$ 其中 $$\\mu_0 = 4 \\pi \\times 10^{-7} \\ \\mathrm{T \\cdot m/A},$$ $$N$$ 是匝数，$$I$$ 是线圈电流（单位为 $$\\mathrm{A}$$），$$L_{\\mathrm{eff}}$$ 是有效长度（单位为 $$\\mathrm{m}$$）。\n- 在轴对称中，磁面可以由磁通坐标 $$\\left(\\psi, \\theta, \\phi\\right)$$ 参数化，其中 $$\\psi$$ 是一个无量纲的极向磁通标签（归一化为 $$\\psi \\in [0,1]$$），$$\\theta$$ 是以弧度为单位的极向角，$$\\phi$$ 是以弧度为单位的环向角。柱坐标 $$\\left(R, Z, \\phi\\right)$$ 通过几何映射与磁通坐标相关联。\n- 等离子体-线圈耦合通过磁面的类 Shafranov 水平位移来体现，此处通过一个依赖于线圈场的中心半径 $$R_c(\\psi)$$ 来建模。\n\n按如下方式定义磁面映射及其参数：\n- 主半径基线：$$R_0 = 3.0 \\ \\mathrm{m}.$$\n- 边界小半径：$$a_{\\mathrm{edge}} = 1.0 \\ \\mathrm{m}.$$\n- 延伸度（垂直拉伸）：$$\\kappa = 1.7 \\ \\text{(无量纲)}.$$\n- 线圈几何：$$N = 20 \\ \\text{匝}, \\quad L_{\\mathrm{eff}} = 8.0 \\ \\mathrm{m}.$$\n- 线圈感应的垂直磁场：$$B_Z(I) = \\mu_0 \\frac{N I}{L_{\\mathrm{eff}}} \\ \\mathrm{T}.$$\n- 线圈感应的中心位移系数：$$\\sigma = 0.2 \\ \\mathrm{m/T}.$$\n- 耦合下的中心半径：$$R_c(\\psi) = R_0 + \\sigma B_Z(I) \\, \\psi.$$\n- 具有小半径剖面的椭圆截面：$$a(\\psi) = a_{\\mathrm{edge}} \\sqrt{\\max(\\psi, \\varepsilon)},$$ 其中 $$\\varepsilon = 10^{-6}$$ 是一个正则化参数，以确保在磁轴附近的数值稳定性。\n- 从磁通坐标到柱坐标的映射：\n  $$R(\\psi, \\theta) = R_c(\\psi) + a(\\psi) \\cos\\theta,$$\n  $$Z(\\psi, \\theta) = \\kappa \\, a(\\psi) \\sin\\theta,$$\n  其中 $$\\phi$$ 被确定为柱坐标的环向角。\n\n从这个映射出发，推导协变基矢量 $$\\mathbf{e}_\\psi = \\frac{\\partial \\mathbf{r}}{\\partial \\psi}, \\ \\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{r}}{\\partial \\theta}, \\ \\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{r}}{\\partial \\phi},$$ 其中在柱坐标系中 $$\\mathbf{r} = R \\, \\hat{\\mathbf{e}}_R + Z \\, \\hat{\\mathbf{e}}_Z$$ （$$\\hat{\\mathbf{e}}_R, \\hat{\\mathbf{e}}_\\phi, \\hat{\\mathbf{e}}_Z$$ 为标准正交基矢）。利用这些，计算协变度规分量和雅可比行列式：\n- 协变度规分量：\n  $$g_{\\psi\\psi} = \\mathbf{e}_\\psi \\cdot \\mathbf{e}_\\psi = \\left(\\frac{\\partial R}{\\partial \\psi}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\psi}\\right)^2,$$\n  $$g_{\\psi\\theta} = \\mathbf{e}_\\psi \\cdot \\mathbf{e}_\\theta = \\left(\\frac{\\partial R}{\\partial \\psi}\\right)\\left(\\frac{\\partial R}{\\partial \\theta}\\right) + \\left(\\frac{\\partial Z}{\\partial \\psi}\\right)\\left(\\frac{\\partial Z}{\\partial \\theta}\\right),$$\n  $$g_{\\theta\\theta} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\theta = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2,$$\n  $$g_{\\phi\\phi} = \\mathbf{e}_\\phi \\cdot \\mathbf{e}_\\phi = R^2.$$\n- 坐标变换 $$\\left(\\psi, \\theta, \\phi\\right) \\mapsto \\left(x, y, z\\right)$$ 的雅可比行列式：\n  $$J(\\psi, \\theta) = \\left|\\mathbf{e}_\\psi \\cdot \\left(\\mathbf{e}_\\theta \\times \\mathbf{e}_\\phi \\right)\\right|.$$\n\n所有角度以弧度表示，长度以米表示。返回的雅可比行列式单位为 $$\\mathrm{m^3}$$，$$g_{\\phi\\phi}$$ 单位为 $$\\mathrm{m^2}$$。为保证数值稳定性，在计算 $$\\frac{\\partial a}{\\partial \\psi}$$ 时，使用正则化规则\n$$\n\\frac{\\partial a}{\\partial \\psi} =\n\\begin{cases}\n\\frac{a_{\\mathrm{edge}}}{2 \\sqrt{\\psi}},  \\psi \\ge \\varepsilon, \\\\\n\\frac{a_{\\mathrm{edge}}}{2 \\sqrt{\\varepsilon}},  \\psi  \\varepsilon,\n\\end{cases}\n$$\n并使用 $$\\frac{d R_c}{d \\psi} = \\sigma B_Z(I).$$\n\n您的程序必须为每个测试用例计算数对 $$\\left(J(\\psi, \\theta), \\ g_{\\phi\\phi}(\\psi, \\theta)\\right)$$，并输出一行，将所有测试用例的结果聚合到一个以逗号分隔的列表中，并用方括号括起来，结果按给定测试用例的顺序排列，每个用例内部先是 $$J$$ 然后是 $$g_{\\phi\\phi}$$。每个浮点数必须四舍五入到六位小数。\n\n使用以下测试套件，它涵盖了一般情况、线圈通电情况、边界情况和近轴稳定性情况：\n1. $$I = 0 \\ \\mathrm{A}, \\ \\psi = 0.25, \\ \\theta = 0 \\ \\mathrm{rad}.$$\n2. $$I = 50{,}000 \\ \\mathrm{A}, \\ \\psi = 0.5, \\ \\theta = \\frac{\\pi}{2} \\ \\mathrm{rad}.$$\n3. $$I = 100{,}000 \\ \\mathrm{A}, \\ \\psi = 1.0, \\ \\theta = \\pi \\ \\mathrm{rad}.$$\n4. $$I = 100{,}000 \\ \\mathrm{A}, \\ \\psi = 10^{-8}, \\ \\theta = \\frac{\\pi}{3} \\ \\mathrm{rad}.$$\n\n您的程序应生成单行输出，其中包含按以下顺序排列的结果，形式为逗号分隔的列表，并用方括号括起来：\n$$[J_1, g_{\\phi\\phi,1}, J_2, g_{\\phi\\phi,2}, J_3, g_{\\phi\\phi,3}, J_4, g_{\\phi\\phi,4}],$$\n每个值都四舍五入到六位小数。",
            "solution": "该问题是有效的，因为它在科学上基于环形等离子体的磁流体动力学原理，定义和参数完整，问题本身是适定的，并且陈述客观。它代表了聚变等离子体物理学中的一个标准计算练习。\n\n求解过程需要为给定的从磁通坐标 $$(\\psi, \\theta, \\phi)$$ 到柱坐标 $$(R, Z, \\phi)$$ 的几何映射，计算坐标变换的雅可比行列式 $$J$$ 和度规分量 $$g_{\\phi\\phi}$$。该映射模拟了一个椭圆形的、有位移的等离子体截面，其位移取决于外部垂直磁场，从而将等离子体几何与外部线圈耦合起来。\n\n首先，我们定义所有常数和给定函数：\n- 真空磁导率：$$\\mu_0 = 4 \\pi \\times 10^{-7} \\ \\mathrm{T \\cdot m/A}$$\n- 线圈参数：$$N = 20 \\ \\text{匝}, \\ L_{\\mathrm{eff}} = 8.0 \\ \\mathrm{m}$$\n- 几何参数：$$R_0 = 3.0 \\ \\mathrm{m}, \\ a_{\\mathrm{edge}} = 1.0 \\ \\mathrm{m}, \\ \\kappa = 1.7$$\n- 耦合系数：$$\\sigma = 0.2 \\ \\mathrm{m/T}$$\n- 正则化参数：$$\\varepsilon = 10^{-6}$$\n\n由线圈感应的外部垂直磁场 $$B_Z$$ 由下式给出：\n$$B_Z(I) = \\mu_0 \\frac{N I}{L_{\\mathrm{eff}}}$$\n\n磁面几何由以下映射定义：\n$$R(\\psi, \\theta) = R_c(\\psi) + a(\\psi) \\cos\\theta$$\n$$Z(\\psi, \\theta) = \\kappa \\, a(\\psi) \\sin\\theta$$\n其中中心半径 $$R_c(\\psi)$$ 和小半径 $$a(\\psi)$$ 为：\n$$R_c(\\psi) = R_0 + \\sigma B_Z(I) \\, \\psi$$\n$$a(\\psi) = a_{\\mathrm{edge}} \\sqrt{\\max(\\psi, \\varepsilon)}$$\n\n为了计算度规分量和雅可比行列式，我们需要 $$R$$ 和 $$Z$$ 关于 $$\\psi$$ 和 $$\\theta$$ 的偏导数。我们首先求出 $$R_c(\\psi)$$ 和 $$a(\\psi)$$ 关于 $$\\psi$$ 的导数。\n$$ \\frac{dR_c}{d\\psi} = \\sigma B_Z(I) $$\n小半径的导数 $$a'(\\psi) = \\frac{da}{d\\psi}$$ 由正则化的分段公式给出：\n$$\na'(\\psi) = \\frac{da}{d\\psi} =\n\\begin{cases}\n\\frac{a_{\\mathrm{edge}}}{2 \\sqrt{\\psi}},  \\text{if } \\psi \\ge \\varepsilon \\\\\n\\frac{a_{\\mathrm{edge}}}{2 \\sqrt{\\varepsilon}},  \\text{if } \\psi  \\varepsilon\n\\end{cases}\n$$\n\n使用链式法则，我们求出柱坐标的偏导数：\n$$ \\frac{\\partial R}{\\partial \\psi} = \\frac{dR_c}{d\\psi} + \\frac{da}{d\\psi}\\cos\\theta = \\sigma B_Z(I) + a'(\\psi)\\cos\\theta $$\n$$ \\frac{\\partial R}{\\partial \\theta} = -a(\\psi)\\sin\\theta $$\n$$ \\frac{\\partial Z}{\\partial \\psi} = \\kappa \\frac{da}{d\\psi}\\sin\\theta = \\kappa a'(\\psi)\\sin\\theta $$\n$$ \\frac{\\partial Z}{\\partial \\theta} = \\kappa a(\\psi)\\cos\\theta $$\n\n度规分量 $$g_{\\phi\\phi}$$ 定义为主半径 $$R$$ 的平方：\n$$ g_{\\phi\\phi}(\\psi, \\theta) = R(\\psi, \\theta)^2 = (R_c(\\psi) + a(\\psi)\\cos\\theta)^2 $$\n\n从 $$(\\psi, \\theta, \\phi)$$ 到笛卡尔坐标的变换的雅可比行列式由 $$J = \\left|\\det\\left(\\frac{\\partial(x,y,z)}{\\partial(\\psi,\\theta,\\phi)}\\right)\\right|$$ 给出。在轴对称柱坐标系中，这简化为 $$J = R \\left| \\frac{\\partial R}{\\partial \\psi} \\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta} \\frac{\\partial Z}{\\partial \\psi} \\right|$$。让我们计算行列式项：\n$$ \\mathcal{J}_{2D} = \\frac{\\partial R}{\\partial \\psi} \\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta} \\frac{\\partial Z}{\\partial \\psi} $$\n$$ = (\\sigma B_Z(I) + a'(\\psi)\\cos\\theta)(\\kappa a(\\psi)\\cos\\theta) - (-a(\\psi)\\sin\\theta)(\\kappa a'(\\psi)\\sin\\theta) $$\n$$ = \\kappa a(\\psi)\\sigma B_Z(I)\\cos\\theta + \\kappa a(\\psi)a'(\\psi)\\cos^2\\theta + \\kappa a(\\psi)a'(\\psi)\\sin^2\\theta $$\n$$ = \\kappa a(\\psi)\\sigma B_Z(I)\\cos\\theta + \\kappa a(\\psi)a'(\\psi)(\\cos^2\\theta + \\sin^2\\theta) $$\n$$ = \\kappa a(\\psi) (a'(\\psi) + \\sigma B_Z(I)\\cos\\theta) $$\n那么，完整的雅可比行列式 $$J$$ 是：\n$$ J(\\psi, \\theta) = R(\\psi, \\theta) |\\mathcal{J}_{2D}| = R(\\psi, \\theta) \\left| \\kappa a(\\psi) (a'(\\psi) + \\sigma B_Z(I)\\cos\\theta) \\right| $$\n对于典型的物理参数，绝对值内的项是正的，因此我们可以写成：\n$$ J(\\psi, \\theta) = \\kappa R(\\psi, \\theta) a(\\psi) (a'(\\psi) + \\sigma B_Z(I)\\cos\\theta) $$\n\n这些推导出的公式将为每个测试用例进行数值实现。\n- 对于测试用例1：$$I=0$$。系统没有线圈感应的位移。$$B_Z=0$$，所以 $$R_c(\\psi) = R_0$$。雅可比行列式简化为 $$J=\\kappa R a a'$$。\n- 对于测试用例2：$$I=50 \\ \\mathrm{kA}$$。施加了一个中等强度的垂直磁场，导致了依赖于 $$\\psi$$ 的位移。由于 $$\\theta=\\pi/2$$，$$\\cos\\theta=0$$，这简化了 $$R$$ 和 $$J$$ 的计算。\n- 对于测试用例3：$$I=100 \\ \\mathrm{kA}$$。在等离子体边界（$$\\psi=1$$）和内侧（$$\\theta=\\pi$$）施加了更强的磁场，此时位移对减小主半径的影响最大。\n- 对于测试用例4：$$I=100 \\ \\mathrm{kA}$$。这测试了磁轴附近（$$\\psi \\to 0$$）的数值稳定性。由于 $$\\psi = 10^{-8}  \\varepsilon$$，调用了 $$a(\\psi)$$ 和 $$a'(\\psi)$$ 的正则化公式以防止除以零并保持几何量的良好性态。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Jacobian and g_phiphi metric component for a set of test cases\n    based on a model of flux-coordinate geometry for an axisymmetric toroidal plasma.\n    \"\"\"\n\n    # Define physical and geometric constants from the problem statement.\n    MU_0 = 4 * np.pi * 1e-7  # T*m/A\n    R0 = 3.0  # m\n    A_EDGE = 1.0  # m\n    KAPPA = 1.7  # dimensionless\n    N_TURNS = 20.0\n    L_EFF = 8.0  # m\n    SIGMA = 0.2  # m/T\n    EPSILON = 1e-6  # Regularization parameter\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (I [A], psi [dimless], theta [rad])\n        (0.0, 0.25, 0.0),\n        (50000.0, 0.5, np.pi / 2),\n        (100000.0, 1.0, np.pi),\n        (100000.0, 1e-8, np.pi / 3),\n    ]\n\n    results = []\n    for i_val, psi, theta in test_cases:\n        # Step 1: Calculate the coil-induced vertical magnetic field.\n        b_z = MU_0 * (N_TURNS * i_val) / L_EFF\n\n        # Step 2: Calculate psi-dependent geometric quantities with regularization.\n        psi_eff = max(psi, EPSILON)\n        a_psi = A_EDGE * np.sqrt(psi_eff)\n        \n        if psi >= EPSILON:\n            a_prime_psi = A_EDGE / (2 * np.sqrt(psi))\n        else:\n            a_prime_psi = A_EDGE / (2 * np.sqrt(EPSILON))\n\n        # Step 3: Calculate the center radius with plasma-coil coupling.\n        r_c_psi = R0 + SIGMA * b_z * psi\n\n        # Step 4: Compute the mapping to cylindrical coordinates.\n        cos_theta = np.cos(theta)\n        r_psi_theta = r_c_psi + a_psi * cos_theta\n\n        # Step 5: Compute the required metric component g_phiphi.\n        g_phiphi = r_psi_theta**2\n\n        # Step 6: Compute the Jacobian of the transformation.\n        # J = kappa * R * a * (a' + sigma * B_Z * cos(theta))\n        jacobian = KAPPA * r_psi_theta * a_psi * (a_prime_psi + SIGMA * b_z * cos_theta)\n\n        # Step 7: Append results, formatted to six decimal places.\n        results.append(f\"{jacobian:.6f}\")\n        results.append(f\"{g_phiphi:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在建立了几何框架之后，下一步是求解描述磁流体动力学（MHD）静态平衡的核心物理方程。在轴对称环形等离子体中，这个方程就是著名的 Grad-Shafranov 方程（GSE），它是一个关于磁通函数 $\\psi$ 的椭圆型偏微分方程。本实践练习将指导你使用有限差分法，将连续的 GSE 算子 $\\Delta^*$ 离散化，构建源项（同时包含等离子体内部压力和外部线圈电流的贡献），并最终求解所得的线性代数方程组，从而得到磁通 $\\psi$ 的分布 。完成这项任务相当于构建了一个二维自由边界平衡求解器的核心引擎，是计算聚变科学中的一项经典而关键的实践。",
            "id": "3982361",
            "problem": "托卡马克中的自由边界轴对称平衡由静磁学定律和力平衡决定。在轴对称条件下，定义极向磁通函数 $\\,\\psi(R,Z)\\,$，使得极向磁场分量满足 $\\,B_R = -\\frac{1}{R}\\frac{\\partial \\psi}{\\partial Z}\\,$ 和 $\\,B_Z = \\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\,$，其中 $\\,R\\,$ 是柱坐标半径，$\\,Z\\,$ 是垂直坐标。轴对称的环向电流密度 $\\,j_\\phi\\,$ 通过安培定律 $\\,\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j}\\,$ 与磁通函数相关联，得出 $\\,j_\\phi = -\\frac{1}{\\mu_0 R}\\Delta^* \\psi\\,$，其中椭圆算子 $\\,\\Delta^*\\,$ 定义为\n$$\n\\Delta^* \\psi \\equiv R \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2} = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}.\n$$\n在等离子体区域，力平衡方程 $\\,\\mathbf{j} \\times \\mathbf{B} = \\nabla p\\,$ 与轴对称性相结合，得到 Grad–Shafranov 方程 (GSE)，\n$$\n\\Delta^* \\psi = -\\mu_0 R^2 \\frac{dp}{d\\psi} - F(\\psi) \\frac{dF}{d\\psi},\n$$\n其中 $\\,p(\\psi)\\,$ 是压强分布，$\\,F(\\psi) \\equiv R B_\\phi\\,$ 编码了环向磁场的贡献。外部极向场线圈表示为环向电流分布 $\\,j_{\\phi,\\text{coil}}(R,Z)\\,$，它们通过麦克斯韦方程组与等离子体耦合，并直接对 $\\,\\Delta^* \\psi\\,$ 产生贡献。在一个包含线圈在计算域内的自由边界计算中，可以通过以下方式叠加线圈电流和等离子体电流：\n$$\n\\Delta^* \\psi = -\\mu_0 R j_{\\phi,\\text{coil}}(R,Z) - \\mu_0 R^2 \\frac{dp}{d\\psi} - F(\\psi) \\frac{dF}{d\\psi},\n$$\n然后从 $\\,\\psi\\,$ 中一致地恢复 $\\,j_\\phi\\,$。\n\n仅使用上述基本关系，在均匀矩形网格上推导算子 $\\,\\Delta^*\\,$ 的有限差分格式，并为未知的 $\\,\\psi\\,$ 节点值建立一个线性系统，边界上采用齐次狄利克雷边界条件 $\\,\\psi=0\\,$。将线圈处理为以线圈位置为中心的归一化高斯环模拟的局部环向电流密度。具体来说，对于位于 $\\,\\left(R_0,Z_0\\right)\\,$ 且总电流为 $\\,I\\,$ 的线圈，其环向电流密度近似为\n$$\nj_{\\phi,\\text{coil}}(R,Z) = I \\, g(R,Z), \\quad g(R,Z) = \\frac{1}{2\\pi \\sigma_R \\sigma_Z} \\exp\\left(-\\frac{(R-R_0)^2}{2\\sigma_R^2} - \\frac{(Z-Z_0)^2}{2\\sigma_Z^2}\\right),\n$$\n并在离散网格上对 $\\,g\\,$ 进行数值归一化，使得在计算域内 $\\,\\int g\\, dR\\, dZ = 1\\,$ 在机器精度下成立。假设一个简单的等离子体模型，其中 $\\,F(\\psi) = F_0\\,$ 为常数，因此 $\\,\\frac{dF}{d\\psi} = 0\\,$，并取 $\\,\\frac{dp}{d\\psi} = p'_0\\,$ 在指定的椭圆等离子体区域内为常数，在其外部为零。计算域和参数如下：\n\n- 计算域：$\\,R \\in [1.0,3.0]\\,$ 米 和 $\\,Z \\in [-1.0,1.0]\\,$ 米，在 $\\,N_R = 81\\,$ 和 $\\,N_Z = 81\\,$ 个节点上均匀离散化。\n- 自由空间磁导率：$\\,\\mu_0 = 4\\pi \\times 10^{-7}\\,$ 亨利每米。\n- 线圈高斯宽度：$\\,\\sigma_R = 0.02\\,$ 米 和 $\\,\\sigma_Z = 0.02\\,$ 米。\n- 等离子体区域：一个以 $\\,\\left(R_c,Z_c\\right)\\,$ 为中心，半轴为 $\\,a_R\\,$ 和 $\\,a_Z\\,$ 的椭圆，由满足 $\\,\\left(\\frac{R-R_c}{a_R}\\right)^2 + \\left(\\frac{Z-Z_c}{a_Z}\\right)^2 \\le 1\\,$ 的点定义。\n- 压强梯度：$\\,\\frac{dp}{d\\psi} = p'_0\\,$ (单位：帕斯卡每韦伯)，在等离子体椭圆内部为常数，外部为零。\n- 环向场函数：$\\,F(\\psi) = F_0\\,$ 且 $\\,\\frac{dF}{d\\psi} = 0\\,$。\n\n任务：\n\n1. 从 $\\,\\Delta^*\\,$ 的定义出发，为内部节点在均匀网格上推导一个二阶精度的有限差分模板。建立稀疏线性系统 $\\,\\mathbf{A}\\mathbf{\\Psi}=\\mathbf{b}\\,$，其中 $\\,\\mathbf{\\Psi}\\,$ 是 $\\,\\psi\\,$ 的内部节点值，并采用齐次狄利克雷边界条件。\n2. 在网格上将 $\\,j_{\\phi,\\text{coil}}(R,Z)\\,$ 构建为每个线圈的归一化高斯环之和，并构建右侧源项 $\\,S(R,Z) = -\\mu_0 R j_{\\phi,\\text{coil}}(R,Z) - \\mu_0 R^2 p'_0 \\chi_{\\text{plasma}}(R,Z)\\,$，其中 $\\,\\chi_{\\text{plasma}}\\,$ 是等离子体椭圆的指示函数。\n3. 求解线性系统得到 $\\,\\psi\\,$，使用相同的模板计算内部节点上的离散残差 $\\,\\mathcal{R} = \\Delta^* \\psi - S\\,$，并报告以韦伯每平方米为单位的最大绝对残差值。\n4. 通过在等离子体区域上对 $\\,j_{\\phi,\\text{plasma}}(R,Z) = -\\frac{1}{\\mu_0 R}\\Delta^* \\psi(R,Z) - j_{\\phi,\\text{coil}}(R,Z)\\,$ 进行积分，计算等离子体环向电流 $\\,I_p\\,$。报告以安培为单位的 $\\,I_p\\,$。\n\n设计一个程序，对以下测试套件执行上述步骤，该套件涵盖了一系列等离子体-线圈耦合场景：\n\n- 测试用例 $\\,1\\,$ (一般情况)：$\\,p'_0 = -1.0\\times 10^6\\,$ 帕斯卡每韦伯，等离子体椭圆参数为 $\\,R_c = 2.0\\,$ 米，$\\,Z_c = 0.0\\,$ 米，$\\,a_R = 0.5\\,$ 米，$\\,a_Z = 0.3\\,$ 米，一个线圈位于 $\\,R_0 = 3.0\\,$ 米，$\\,Z_0 = 0.6\\,$ 米，电流 $\\,I = 1.0 \\times 10^6\\,$ 安培。\n- 测试用例 $\\,2\\,$ (对称线圈)：等离子体与测试用例 $\\,1\\,$ 相同，两个线圈分别位于 $\\,\\left(R_0,Z_0\\right) = (3.0,0.6)\\,$ 和 $\\,\\left(R_0,Z_0\\right) = (3.0,-0.6)\\,$，每个电流均为 $\\,I = 1.0 \\times 10^6\\,$ 安培。\n- 测试用例 $\\,3\\,$ (真空极限)：$\\,p'_0 = 0.0\\,$，无等离子体 (设置 $\\,a_R = 0.0\\,$ 和 $\\,a_Z = 0.0\\,$，使得 $\\,\\chi_{\\text{plasma}}=0\\,$ 处处为零)，两个线圈位于 $\\,\\left(R_0,Z_0\\right) = (3.0,0.6)\\,$ 和 $\\,\\left(R_0,Z_0\\right) = (3.0,-0.6)\\,$，每个电流均为 $\\,I = 1.0 \\times 10^6\\,$ 安培。\n- 测试用例 $\\,4\\,$ (带有微小等离子体的边缘情况)：$\\,p'_0 = -2.0\\times 10^6\\,$ 帕斯卡每韦伯，等离子体椭圆参数为 $\\,R_c = 2.0\\,$ 米，$\\,Z_c = 0.0\\,$ 米，$\\,a_R = 0.15\\,$ 米，$\\,a_Z = 0.10\\,$ 米，两个线圈位于 $\\,\\left(R_0,Z_0\\right) = (3.0,0.6)\\,$ 和 $\\,\\left(R_0,Z_0\\right) = (3.0,-0.6)\\,$，每个电流均为 $\\,I = 0.5 \\times 10^6\\,$ 安培。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个双元素列表 $\\,\\left[\\text{residual\\_max}, I_p\\right]\\,$，按测试套件的顺序排列。第一个元素必须是以韦伯每平方米为单位的最大绝对残差，第二个元素必须是以安培为单位的等离子体电流。例如，输出格式必须类似于 $\\,\\left[[r_1,i_1],[r_2,i_2],[r_3,i_3],[r_4,i_4]\\right]\\,$，并用数值替换。",
            "solution": "推导从静磁学和轴对称性开始。在定义了极向磁通函数 $\\,\\psi(R,Z)\\,$ 使得 $\\,B_R = -\\frac{1}{R}\\frac{\\partial \\psi}{\\partial Z}\\,$ 和 $\\,B_Z = \\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\,$ 后，$\\,\\mathbf{B}\\,$ 的旋度的环向分量为\n$$\n(\\nabla \\times \\mathbf{B})_\\phi = \\frac{\\partial B_R}{\\partial Z} - \\frac{\\partial B_Z}{\\partial R}.\n$$\n使用 $\\,B_R\\,$ 和 $\\,B_Z\\,$ 的轴对称表达式，计算每个导数：\n$$\n\\frac{\\partial B_R}{\\partial Z} = \\frac{\\partial}{\\partial Z}\\left(-\\frac{1}{R}\\frac{\\partial \\psi}{\\partial Z}\\right) = -\\frac{1}{R} \\frac{\\partial^2 \\psi}{\\partial Z^2},\n$$\n$$\n\\frac{\\partial B_Z}{\\partial R} = \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right) = -\\frac{1}{R^2}\\frac{\\partial \\psi}{\\partial R} + \\frac{1}{R}\\frac{\\partial^2 \\psi}{\\partial R^2}.\n$$\n因此，\n$$\n(\\nabla \\times \\mathbf{B})_\\phi = -\\frac{1}{R}\\frac{\\partial^2 \\psi}{\\partial Z^2} - \\left(-\\frac{1}{R^2}\\frac{\\partial \\psi}{\\partial R} + \\frac{1}{R}\\frac{\\partial^2 \\psi}{\\partial R^2}\\right) = -\\frac{1}{R}\\left(\\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R}\\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}\\right) = -\\frac{1}{R}\\Delta^* \\psi.\n$$\n安培定律 $\\,\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j}\\,$ 于是得到 $\\,j_\\phi = \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B})_\\phi = -\\frac{1}{\\mu_0 R}\\Delta^* \\psi\\,$。在具有压强 $\\,p(\\psi)\\,$ 和环向场函数 $\\,F(\\psi) \\equiv R B_\\phi\\,$ 的等离子体区域中，力平衡 $\\,\\mathbf{j} \\times \\mathbf{B} = \\nabla p\\,$ 意味着 Grad–Shafranov 方程\n$$\n\\Delta^* \\psi = -\\mu_0 R^2 \\frac{dp}{d\\psi} - F(\\psi) \\frac{dF}{d\\psi}.\n$$\n当外部环向线圈电流 $\\,j_{\\phi,\\text{coil}}(R,Z)\\,$ 与等离子体电流同时存在时，由于 $\\,\\Delta^* \\psi = - \\mu_0 R j_\\phi\\,$，麦克斯韦关系式将它们线性地加到 $\\,\\Delta^* \\psi\\,$ 的源项上。当 $\\,F(\\psi) = F_0\\,$ 为常数，因此 $\\,\\frac{dF}{d\\psi} = 0\\,$ 时，可获得计算上方便的形式\n$$\n\\Delta^* \\psi = -\\mu_0 R j_{\\phi,\\text{coil}}(R,Z) - \\mu_0 R^2 \\frac{dp}{d\\psi}.\n$$\n\n离散化遵循 $\\,\\Delta^*\\,$ 的定义。在具有 $\\,R\\,$ 方向间距 $\\,\\Delta R\\,$ 和 $\\,Z\\,$ 方向间距 $\\,\\Delta Z\\,$ 的均匀网格上，对于位于 $\\,\\left(R_i,Z_j\\right)\\,$ 的内部节点，使用二阶中心差分来近似导数：\n$$\n\\frac{\\partial^2 \\psi}{\\partial R^2}\\bigg|_{i,j} \\approx \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{\\Delta R^2},\n\\quad\n\\frac{\\partial \\psi}{\\partial R}\\bigg|_{i,j} \\approx \\frac{\\psi_{i+1,j} - \\psi_{i-1,j}}{2\\Delta R},\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial Z^2}\\bigg|_{i,j} \\approx \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{\\Delta Z^2}.\n$$\n将这些代入 $\\,\\Delta^* \\psi = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R}\\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}\\,$ 在 $\\,R=R_i\\,$ 处，得到一个线性模板：\n$$\n\\Delta^* \\psi\\big|_{i,j} \\approx \\left(\\frac{1}{\\Delta R^2} - \\frac{1}{2 R_i \\Delta R}\\right)\\psi_{i+1,j} + \\left(\\frac{1}{\\Delta R^2} + \\frac{1}{2 R_i \\Delta R}\\right)\\psi_{i-1,j} + \\frac{1}{\\Delta Z^2}\\psi_{i,j+1} + \\frac{1}{\\Delta Z^2}\\psi_{i,j-1} - \\left(\\frac{2}{\\Delta R^2} + \\frac{2}{\\Delta Z^2}\\right)\\psi_{i,j}.\n$$\n在域边界上的齐次狄利克雷边界条件 $\\,\\psi=0\\,$ 允许从未知向量中消除边界节点，并组装一个表示内部节点模板的稀疏矩阵 $\\,\\mathbf{A}\\,$。对于每个内部节点，其系数乘以相邻内部节点上的未知数；边界上的邻居贡献的已知值为零，因此不改变右侧项。每个内部节点上的源项是 $\\,S_{i,j} = -\\mu_0 R_i j_{\\phi,\\text{coil}}(R_i,Z_j) - \\mu_0 R_i^2 p'_0 \\chi_{\\text{plasma}}(R_i,Z_j)\\,$。\n\n线圈模型 $\\,j_{\\phi,\\text{coil}}\\,$ 使用高斯环。对于每个位于 $\\,\\left(R_0,Z_0\\right)\\,$ 且电流为 $\\,I\\,$ 的线圈，定义\n$$\ng(R,Z) = \\frac{1}{2\\pi \\sigma_R \\sigma_Z} \\exp\\left(-\\frac{(R-R_0)^2}{2\\sigma_R^2} - \\frac{(Z-Z_0)^2}{2\\sigma_Z^2}\\right).\n$$\n为确保在离散网格上 $\\,\\int g\\, dR\\, dZ = 1\\,$，计算离散和 $\\,G = \\sum_{i,j} g(R_i,Z_j)\\, \\Delta R\\, \\Delta Z\\,$ 并重新归一化 $\\,\\tilde{g} = g/G\\,$。线圈电流密度的贡献则为 $\\,j_{\\phi,\\text{coil}} = I \\tilde{g}\\,$，当存在多个线圈时，叠加 $\\,j_{\\phi,\\text{coil}} = \\sum_k I_k \\tilde{g}_k\\,$。\n\n使用稀疏直接求解器求解线性系统 $\\,\\mathbf{A}\\mathbf{\\Psi}=\\mathbf{b}\\,$，得到 $\\,\\psi\\,$ 的内部值。通过将相同的有限差分模板应用于整个网格（边界值为零）并减去源项 $\\,S\\,$ 来计算离散残差：\n$$\n\\mathcal{R}_{i,j} = \\left(\\Delta^* \\psi\\right)_{i,j}^{\\text{disc}} - S_{i,j}.\n$$\n最大范数 $\\,\\max_{i,j} |\\mathcal{R}_{i,j}|\\,$ 以韦伯每平方米为单位报告。通过使用安培关系式减去线圈的贡献，从解中提取等离子体环向电流密度：\n$$\nj_{\\phi,\\text{plasma}}(R_i,Z_j) = -\\frac{1}{\\mu_0 R_i}\\left(\\Delta^* \\psi\\right)_{i,j}^{\\text{disc}} - j_{\\phi,\\text{coil}}(R_i,Z_j),\n$$\n并在等离子体椭圆上积分：\n$$\nI_p = \\sum_{i,j \\in \\text{plasma}} j_{\\phi,\\text{plasma}}(R_i,Z_j)\\, \\Delta R\\, \\Delta Z.\n$$\n\n程序实现的算法步骤：\n\n- 在指定域上使用 $\\,N_R = 81\\,$ 和 $\\,N_Z = 81\\,$ 构建 $\\,R\\,$ 和 $\\,Z\\,$ 的均匀网格，计算 $\\,\\Delta R\\,$ 和 $\\,\\Delta Z\\,$。\n- 使用推导出的模板系数构建稀疏矩阵 $\\,\\mathbf{A}\\,$，将每个内部节点 $\\,\\left(i,j\\right)\\,$ 映射到一个线性索引。\n- 对于每个测试用例：\n  - 根据提供的 $\\,R_c\\,$, $\\,Z_c\\,$, $\\,a_R\\,$, $\\,a_Z\\,$ 从椭圆定义构建等离子体指示函数 $\\,\\chi_{\\text{plasma}}\\,$。\n  - 通过对所有线圈的归一化高斯环求和来组装 $\\,j_{\\phi,\\text{coil}}\\,$。\n  - 根据 $\\,j_{\\phi,\\text{coil}}\\,$ 和 $\\,p'_0\\,$ 构建 $\\,S\\,$。\n  - 求解 $\\,\\mathbf{A}\\mathbf{\\Psi}=\\mathbf{b}\\,$ 得到 $\\,\\psi\\,$。\n  - 计算离散残差 $\\,\\mathcal{R}\\,$ 及其最大绝对值。\n  - 从 $\\,\\psi\\,$ 计算 $\\,j_{\\phi,\\text{plasma}}\\,$ 并在等离子体区域上积分以获得 $\\,I_p\\,$。\n- 生成单行输出 $\\,\\left[[r_1,i_1],[r_2,i_2],[r_3,i_3],[r_4,i_4]\\right]\\,$，其中 $\\,r_k\\,$ 的单位是韦伯每平方米，$\\,i_k\\,$ 的单位是安培。\n\n这种构建是基于原理的：算子 $\\,\\Delta^*\\,$ 源于静磁学，而离散化采用与算子中依赖于 $\\,R\\,$ 的项相一致的二阶精度有限差分。线圈-等离子体耦合通过在源项中使用从物理上合理的局部电流密度导出的 $\\,j_{\\phi,\\text{coil}}\\,$ 进行叠加而引入。通过安培关系式，从求解出的 $\\,\\psi\\,$ 中一致地提取等离子体电流，即减去线圈的贡献以分离出等离子体分量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import coo_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef build_grid(R_min, R_max, Z_min, Z_max, NR, NZ):\n    R = np.linspace(R_min, R_max, NR)\n    Z = np.linspace(Z_min, Z_max, NZ)\n    dR = (R_max - R_min) / (NR - 1)\n    dZ = (Z_max - Z_min) / (NZ - 1)\n    return R, Z, dR, dZ\n\ndef interior_index(i, j, NZ_interior):\n    # Map interior grid (i in [1..NR-2], j in [1..NZ-2]) to linear index\n    return (i - 1) * NZ_interior + (j - 1)\n\ndef assemble_matrix(R, dR, dZ, NR, NZ):\n    # Build sparse matrix for interior nodes\n    NZ_interior = NZ - 2\n    N_interior = (NR - 2) * (NZ - 2)\n    rows = []\n    cols = []\n    data = []\n\n    inv_dR2 = 1.0 / (dR * dR)\n    inv_dZ2 = 1.0 / (dZ * dZ)\n\n    for i in range(1, NR - 1):\n        Ri = R[i]\n        for j in range(1, NZ - 1):\n            idx = interior_index(i, j, NZ_interior)\n            \n            # Diagonal coefficient\n            coeff_center = -(2.0 * inv_dR2 + 2.0 * inv_dZ2)\n            rows.append(idx); cols.append(idx); data.append(coeff_center)\n\n            # Off-diagonal coefficients for neighbors\n            # Check if neighbor is also an interior node before adding to sparse matrix\n            # i+1,j neighbor\n            if i + 1 = NR - 2:\n                id_n = interior_index(i + 1, j, NZ_interior)\n                rows.append(idx); cols.append(id_n); data.append(inv_dR2 - 1.0 / (2.0 * Ri * dR))\n            # i-1,j neighbor\n            if i - 1 >= 1:\n                id_n = interior_index(i - 1, j, NZ_interior)\n                rows.append(idx); cols.append(id_n); data.append(inv_dR2 + 1.0 / (2.0 * Ri * dR))\n            # i,j+1 neighbor\n            if j + 1 = NZ - 2:\n                id_n = interior_index(i, j + 1, NZ_interior)\n                rows.append(idx); cols.append(id_n); data.append(inv_dZ2)\n            # i,j-1 neighbor\n            if j - 1 >= 1:\n                id_n = interior_index(i, j - 1, NZ_interior)\n                rows.append(idx); cols.append(id_n); data.append(inv_dZ2)\n\n    A = coo_matrix((data, (rows, cols)), shape=(N_interior, N_interior)).tocsr()\n    return A\n\ndef apply_delta_star_disc(psi, R, dR, dZ):\n    # Apply discrete Delta* operator to full grid psi (including boundary), return interior values array\n    NR = psi.shape[0]\n    NZ = psi.shape[1]\n    inv_dR2 = 1.0 / (dR * dR)\n    inv_dZ2 = 1.0 / (dZ * dZ)\n    NZ_interior = NZ - 2\n    result = np.zeros(((NR - 2) * (NZ - 2),), dtype=float)\n    for i in range(1, NR - 1):\n        Ri = R[i]\n        for j in range(1, NZ - 1):\n            idx = interior_index(i, j, NZ_interior)\n            term_R2 = (psi[i + 1, j] - 2.0 * psi[i, j] + psi[i - 1, j]) * inv_dR2\n            term_Z2 = (psi[i, j + 1] - 2.0 * psi[i, j] + psi[i, j - 1]) * inv_dZ2\n            term_R1 = (psi[i + 1, j] - psi[i - 1, j]) / (2.0 * dR)\n            result[idx] = term_R2 - (1.0 / Ri) * term_R1 + term_Z2\n    return result\n\ndef gaussian_ring(R, Z, R0, Z0, sigR, sigZ):\n    # Evaluate unnormalized Gaussian ring on grid\n    RR = R[:, None]\n    ZZ = Z[None, :]\n    g = np.exp(-0.5 * ((RR - R0) ** 2 / (sigR ** 2) + (ZZ - Z0) ** 2 / (sigZ ** 2)))\n    # Prefactor 1/(2*pi*sigR*sigZ) for proper normalization in continuous plane\n    g *= (1.0 / (2.0 * np.pi * sigR * sigZ))\n    return g\n\ndef normalize_on_grid(g, dR, dZ):\n    total = np.sum(g) * dR * dZ\n    if total == 0.0:\n        return g\n    return g / total\n\ndef build_coil_current_density(R, Z, dR, dZ, coils, sigR, sigZ):\n    # coils: list of (R0, Z0, I)\n    j = np.zeros((len(R), len(Z)), dtype=float)\n    for (R0, Z0, I) in coils:\n        g = gaussian_ring(R, Z, R0, Z0, sigR, sigZ)\n        g_norm = normalize_on_grid(g, dR, dZ)\n        j += I * g_norm\n    return j\n\ndef plasma_indicator(R, Z, Rc, Zc, aR, aZ):\n    # Ellipse indicator\n    RR = R[:, None]\n    ZZ = Z[None, :]\n    if aR == 0.0 or aZ == 0.0:\n        return np.zeros((len(R), len(Z)), dtype=float)\n    val = ((RR - Rc) / aR) ** 2 + ((ZZ - Zc) / aZ) ** 2\n    return (val = 1.0).astype(float)\n\ndef solve_case(params, grid, A):\n    R, Z, dR, dZ = grid\n    NR = len(R); NZ = len(Z)\n    NZ_interior = NZ - 2\n    mu0 = 4.0 * np.pi * 1e-7  # H/m\n\n    # Unpack params\n    pprime = params['pprime']\n    Rc, Zc = params['plasma_center']\n    aR, aZ = params['plasma_axes']\n    coils = params['coils']\n    sigR = params['sigma_R']\n    sigZ = params['sigma_Z']\n\n    # Build source terms\n    chi = plasma_indicator(R, Z, Rc, Zc, aR, aZ)\n    jcoil = build_coil_current_density(R, Z, dR, dZ, coils, sigR, sigZ)\n    # S = -mu0 * R * jcoil - mu0 * R^2 * pprime * chi\n    RR = R[:, None]\n    S = -mu0 * RR * jcoil - mu0 * (RR ** 2) * pprime * chi\n\n    # Right-hand side vector b for interior nodes\n    b = np.zeros(((NR - 2) * (NZ - 2),), dtype=float)\n    for i in range(1, NR - 1):\n        for j in range(1, NZ - 1):\n            idx = interior_index(i, j, NZ_interior)\n            b[idx] = S[i, j]\n\n    # Solve A psi_interior = b\n    psi_interior = spsolve(A, b)\n\n    # Assemble full psi grid with boundary zeros\n    psi = np.zeros((NR, NZ), dtype=float)\n    for i in range(1, NR - 1):\n        for j in range(1, NZ - 1):\n            idx = interior_index(i, j, NZ_interior)\n            psi[i, j] = psi_interior[idx]\n\n    # Compute discrete residual on interior: R_disc = Delta* psi - S\n    Lpsi_interior = apply_delta_star_disc(psi, R, dR, dZ)\n    residual_interior = Lpsi_interior - b  # since b = S at interior\n    residual_max = float(np.max(np.abs(residual_interior)))\n\n    # Compute j_phi_plasma from solution: j_plasma = -(1/(mu0 R)) Delta*psi - jcoil\n    # First, reconstruct Delta*psi on full grid interior values in array form\n    # Map Lpsi_interior back to grid\n    Lpsi_grid = np.zeros((NR, NZ), dtype=float)\n    for i in range(1, NR - 1):\n        for j in range(1, NZ - 1):\n            idx = interior_index(i, j, NZ_interior)\n            Lpsi_grid[i, j] = Lpsi_interior[idx]\n    j_plasma = np.zeros_like(Lpsi_grid)\n    # Avoid divide by zero at R=0 (not in domain)\n    j_plasma[1:NR-1, 1:NZ-1] = -(1.0 / (mu0 * RR[1:NR-1, 0][:, None])) * Lpsi_grid[1:NR-1, 1:NZ-1] - jcoil[1:NR-1, 1:NZ-1]\n    # Integrate over plasma region to get Ip\n    Ip = float(np.sum(j_plasma * chi) * dR * dZ)\n\n    return residual_max, Ip\n\ndef solve():\n    # Define grid and matrix\n    R_min, R_max = 1.0, 3.0\n    Z_min, Z_max = -1.0, 1.0\n    NR, NZ = 81, 81\n    R, Z, dR, dZ = build_grid(R_min, R_max, Z_min, Z_max, NR, NZ)\n    A = assemble_matrix(R, dR, dZ, NR, NZ)\n\n    # Define test cases\n    test_cases = [\n        # Test case 1\n        {\n            'pprime': -1.0e6,  # Pa/Wb\n            'plasma_center': (2.0, 0.0),\n            'plasma_axes': (0.5, 0.3),\n            'coils': [(3.0, 0.6, 1.0e6)],\n            'sigma_R': 0.02,\n            'sigma_Z': 0.02\n        },\n        # Test case 2\n        {\n            'pprime': -1.0e6,\n            'plasma_center': (2.0, 0.0),\n            'plasma_axes': (0.5, 0.3),\n            'coils': [(3.0, 0.6, 1.0e6), (3.0, -0.6, 1.0e6)],\n            'sigma_R': 0.02,\n            'sigma_Z': 0.02\n        },\n        # Test case 3 (vacuum, no plasma)\n        {\n            'pprime': 0.0,\n            'plasma_center': (2.0, 0.0),\n            'plasma_axes': (0.0, 0.0),  # no plasma\n            'coils': [(3.0, 0.6, 1.0e6), (3.0, -0.6, 1.0e6)],\n            'sigma_R': 0.02,\n            'sigma_Z': 0.02\n        },\n        # Test case 4 (tiny plasma)\n        {\n            'pprime': -2.0e6,\n            'plasma_center': (2.0, 0.0),\n            'plasma_axes': (0.15, 0.10),\n            'coils': [(3.0, 0.6, 0.5e6), (3.0, -0.6, 0.5e6)],\n            'sigma_R': 0.02,\n            'sigma_Z': 0.02\n        }\n    ]\n\n    grid = (R, Z, dR, dZ)\n    results = []\n    for case in test_cases:\n        residual_max, Ip = solve_case(case, grid, A)\n        results.append([residual_max, Ip])\n\n    # Final print statement in the exact required format.\n    # Ensure simple float string formatting without extra text\n    def format_list(lst):\n        return \"[\" + \",\".join(str(x) if not isinstance(x, list) else format_list(x) for x in lst) + \"]\"\n    print(format_list(results))\n\nsolve()\n```"
        },
        {
            "introduction": "上一个练习  将外部线圈放置在计算网格内部，这是一种直接但可能效率不高的方法。对于自由边界问题，一种更优雅且强大的方法是将求解区域分为等离子体区和真空区，并分别处理。在无电流的真空区，磁场可以用满足拉普拉斯方程 $\\nabla^2 \\Phi = 0$ 的磁标势 $\\Phi$ 来描述，这使得我们可以运用势理论的强大工具。狄利克雷-诺伊曼（Dirichlet-to-Neumann, DtN）映射是一种数学算符，它简洁地概括了真空场对等离子体边界的响应，将边界上的势函数值与法向磁场联系起来 。本练习旨在探索 DtN 映射的解析与数值性质，让你理解现代高效平衡代码中处理等离子体-线圈耦合的一种高级方法，而无需对整个真空区域进行网格剖分。",
            "id": "3982367",
            "problem": "在轴对称自由边界平衡中，一个圆形的等离子体边界被一个无电流的真空区域所包围，在该区域中，磁场线由静磁学定律决定。在真空区，从静磁学的麦克斯韦方程组出发，磁场 $\\mathbf{B}$ 满足 $\\nabla \\cdot \\mathbf{B} = 0$ 和 $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$，其中 $\\mu_0$ 是真空磁导率，$\\mathbf{J}$ 是电流密度。在外部真空区域，$\\mathbf{J} = \\mathbf{0}$，因此有 $\\nabla \\times \\mathbf{B} = \\mathbf{0}$ 和 $\\nabla \\cdot \\mathbf{B} = \\mathbf{0}$。因此，存在一个标量磁势 $\\Phi$，使得 $\\mathbf{B} = -\\nabla \\Phi$，并且 $\\Phi$ 满足拉普拉斯方程 $\\nabla^2 \\Phi = 0$。这个框架是自由边界平衡求解器中等离子体-线圈耦合的基础：等离子体区域外的线圈电流决定了真空场的边界条件，而由此产生的在等离子体边界上的法向磁场则约束了等离子体的边界形状。\n\n考虑平面上半径为 $R$ 的圆的二维外部区域，使用极坐标 $(r,\\theta)$，圆形边界位于 $r=R$。在圆外，$\\Phi$ 满足 $\\nabla^2 \\Phi = 0$ 并在无穷远处衰减。假设狄利克雷边界数据（$\\Phi$ 在 $r=R$ 上的值）被指定为 $g(\\theta) = \\cos(n\\theta)$，其中 $n$ 是一个非负整数。狄利克雷-诺伊曼 (DtN) 映射 $\\Lambda$ 将边界上的狄利克雷数据 $g(\\theta)$ 映射为调和解在边界处的法向导数。在自由边界平衡求解器的背景下，这个 $\\Lambda$ 封装了真空耦合：给定一个与外部线圈一致的真空调和函数的边界迹，DtN 映射返回在等离子体边界上为满足平衡约束所需的法向磁场。\n\n您的任务是：\n\n1.  根据极坐标中的拉普拉斯方程和在无穷远处衰减的要求，推导一个傅里叶模态的外部调和解的一般形式，并证明圆上的狄利克雷-诺伊曼映射在傅里叶模态下是对角的。特别地，证明如果 $g(\\theta) = \\cos(n\\theta)$ 在 $r=R$ 处，其中 $n \\ge 1$，则对应的圆外调和解是 $\\Phi(r,\\theta) = \\left(\\frac{R}{r}\\right)^n \\cos(n\\theta)$，其在 $r=R$ 处的外法向导数是 $\\frac{\\partial \\Phi}{\\partial r}\\big\\rvert_{r=R} = -\\frac{n}{R} \\cos(n\\theta)$。对于 $n=0$，证明与常数狄利克雷数据一致的唯一衰减解是平凡解 $\\Phi \\equiv 0$，因此诺伊曼数据为 $0$。因此，狄利克雷-诺伊曼映射的作用方式为 $\\Lambda[\\cos(n\\theta)] = -\\frac{n}{R} \\cos(n\\theta)$ (对于 $n \\ge 1$) 和 $\\Lambda[1] = 0$。\n\n2.  使用自由空间格林函数 $G(\\boldsymbol{x},\\boldsymbol{y}) = -\\frac{1}{2\\pi}\\ln\\lVert \\boldsymbol{x} - \\boldsymbol{y} \\rVert$ 的拉普拉斯方程的边界积分观点，解释为什么在光滑边界上的狄利克雷-诺伊曼映射是一个非局域线性算子，以及为什么它在傅里叶基下对圆对角化。您无需实现该积分；只需用它来从概念上论证 $\\Lambda$ 的谱形式。\n\n3.  实现一个数值程序，使用边界处的径向有限差分从狄利克雷数据近似诺伊曼数据，并将其与上面推导的精确狄利克雷-诺伊曼映射进行比较。具体来说，在 $[0,2\\pi)$ 弧度范围内均匀采样 $N_\\theta$ 个点，将 $r=R$ 处的狄利克雷数据设为 $g(\\theta) = \\cos(n\\theta)$，并用向前差分来近似 $r=R$ 处的径向导数\n$$\n\\left.\\frac{\\partial \\Phi}{\\partial r}\\right\\rvert_{r=R} \\approx \\frac{\\Phi(R+\\Delta r,\\theta) - \\Phi(R,\\theta)}{\\Delta r},\n$$\n其中 $\\Delta r0$ 是一个小步长，$\\Phi(r,\\theta) = \\left(\\frac{R}{r}\\right)^n \\cos(n\\theta)$ 是精确的外部调和解。计算这个有限差分近似与精确的狄利克雷-诺伊曼结果 $-\\frac{n}{R} \\cos(n\\theta)$ 在所有 $\\theta$ 上的最大绝对偏差。\n\n4.  使用以下参数值测试套件 $(R,n,N_\\theta,\\Delta r)$，角度以弧度为单位，所有长度均以一致的无量纲单位表示：\n\n-   测试用例 1 (正常情况): $(R,n,N_\\theta,\\Delta r) = (1.0, 3, 256, 10^{-4})$。\n-   测试用例 2 (边界条件模态): $(R,n,N_\\theta,\\Delta r) = (0.5, 0, 128, 10^{-3})$。\n-   测试用例 3 (高模态，良好解析): $(R,n,N_\\theta,\\Delta r) = (2.0, 15, 512, 10^{-3})$。\n-   测试用例 4 (大步长，具挑战性): $(R,n,N_\\theta,\\Delta r) = (1.0, 50, 128, 5 \\times 10^{-2})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4]\"），其中每个结果是相应测试用例的最大绝对偏差（一个浮点数）。角度必须以弧度为单位，输出必须是纯数字，不带任何单位指示符。",
            "solution": "该问题陈述已经过验证，被认为是科学上可靠、适定且客观的。它提出了一个应用于等离子体物理学的势论标准问题，涉及解析推导、概念解释和数值实现。我们现在着手提供完整的解决方案。\n\n解决方案按要求分为三部分：狄利克雷-诺伊曼映射的推导，使用边界积分观点的概念性解释，以及计算近似误差的数值实现说明。\n\n### 1. 外部调和解与狄利克雷-诺伊曼映射的推导\n\n我们的任务是在半径为 $R$ 的圆外（即 $r  R$）求解拉普拉斯方程 $\\nabla^2 \\Phi = 0$，边界条件为 $\\Phi(R,\\theta) = g(\\theta) = \\cos(n\\theta)$，并满足在无穷远处衰减的条件。\n\n极坐标 $(r,\\theta)$ 下的拉普拉斯方程为：\n$$\n\\nabla^2 \\Phi = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r \\frac{\\partial \\Phi}{\\partial r}\\right) + \\frac{1}{r^2}\\frac{\\partial^2 \\Phi}{\\partial \\theta^2} = 0\n$$\n我们使用分离变量法，假设解的形式为 $\\Phi(r,\\theta) = U(r)V(\\theta)$。将其代入方程并整理得：\n$$\n\\frac{r}{U(r)}\\frac{d}{dr}\\left(r \\frac{dU}{dr}\\right) = -\\frac{1}{V(\\theta)}\\frac{d^2 V}{d\\theta^2}\n$$\n由于左侧仅依赖于 $r$，右侧仅依赖于 $\\theta$，两者必等于一个常数，我们记为 $\\lambda$。这得到两个常微分方程：\n1.  角向方程: $\\frac{d^2 V}{d\\theta^2} + \\lambda V = 0$\n2.  径向方程: $r\\frac{d}{dr}\\left(r \\frac{dU}{dr}\\right) - \\lambda U = 0 \\implies r^2 \\frac{d^2 U}{dr^2} + r \\frac{dU}{dr} - \\lambda U = 0$\n\n为使解在定义域内单值连续，$V(\\theta)$ 必须是 $2\\pi$-周期的。这要求 $\\lambda = k^2$，其中 $k$ 为非负整数。$V(\\theta)$ 的解是 $\\cos(k\\theta)$ 和 $\\sin(k\\theta)$ 的线性组合。\n\n当 $\\lambda = k^2$ 时，径向方程变为柯西-欧拉方程：$r^2 U'' + rU' - k^2 U = 0$。\n-   对于 $k \\ge 1$，通解为 $U_k(r) = A_k r^k + B_k r^{-k}$。\n-   对于 $k = 0$，方程为 $r(rU')' = 0$，积分得到 $U_0(r) = A_0 + B_0 \\ln r$。\n\n$\\Phi$ 的通解是这些模态的叠加：\n$$\n\\Phi(r,\\theta) = A_0 + B_0 \\ln r + \\sum_{k=1}^{\\infty} \\left( (A_k r^k + B_k r^{-k}) \\cos(k\\theta) + (C_k r^k + D_k r^{-k}) \\sin(k\\theta) \\right)\n$$\n问题规定解必须在无穷远处（$r \\to \\infty$）衰减。对于磁势的物理问题，这对应于磁场 $\\mathbf{B} = -\\nabla \\Phi$ 在无穷远处消失。这意味着当 $r \\to \\infty$ 时 $\\Phi$ 必须有界。项 $B_0 \\ln r$、$A_k r^k$ 和 $C_k r^k$ 是无界的。因此，我们必须设 $B_0=0$、$A_k=0$ 和 $C_k=0$ 对所有 $k \\ge 1$ 成立。如果我们施加更强的、也是常见的条件，即当 $r \\to \\infty$ 时 $\\Phi \\to 0$，我们还必须设 $A_0=0$。因此，一般的衰减外部调和函数是：\n$$\n\\Phi(r,\\theta) = A_0 + \\sum_{k=1}^{\\infty} \\left( B_k r^{-k} \\cos(k\\theta) + D_k r^{-k} \\sin(k\\theta) \\right)\n$$\n现在我们应用具体的狄利克雷边界条件 $g(\\theta) = \\cos(n\\theta)$ 于 $r=R$。\n\n**情况 1: $n \\ge 1$**\n边界条件是 $\\Phi(R,\\theta) = \\cos(n\\theta)$。将此与通解匹配：\n$$\nA_0 + \\sum_{k=1}^{\\infty} \\left( B_k R^{-k} \\cos(k\\theta) + D_k R^{-k} \\sin(k\\theta) \\right) = \\cos(n\\theta)\n$$\n根据傅里叶基函数在 $[0, 2\\pi]$ 上的正交性，我们可以比较系数。这得出 $A_0=0$，$D_k=0$ 对所有 $k$ 成立，以及 $B_k=0$ 对所有 $k \\neq n$ 成立。对于 $k=n$，我们必须有 $B_n R^{-n} = 1$，这意味着 $B_n = R^n$。\n因此，唯一的衰减解是：\n$$\n\\Phi(r,\\theta) = (R^n r^{-n}) \\cos(n\\theta) = \\left(\\frac{R}{r}\\right)^n \\cos(n\\theta)\n$$\n这与问题中给出的形式相符。在边界 $r=R$ 处的外法向导数是 $\\frac{\\partial \\Phi}{\\partial r}\\big\\rvert_{r=R}$。\n$$\n\\frac{\\partial \\Phi}{\\partial r} = \\frac{\\partial}{\\partial r} \\left( R^n r^{-n} \\cos(n\\theta) \\right) = R^n (-n r^{-n-1}) \\cos(n\\theta) = -n \\frac{R^n}{r^{n+1}} \\cos(n\\theta)\n$$\n在 $r=R$ 处计算：\n$$\n\\frac{\\partial \\Phi}{\\partial r}\\bigg\\rvert_{r=R} = -n \\frac{R^n}{R^{n+1}} \\cos(n\\theta) = -\\frac{n}{R} \\cos(n\\theta)\n$$\n根据问题定义，狄利克雷-诺伊曼映射 $\\Lambda$ 是法向导数本身：$\\Lambda[g] = \\frac{\\partial \\Phi}{\\partial r}\\big\\rvert_{r=R}$。因此：\n$$\n\\Lambda[\\cos(n\\theta)] = -\\frac{n}{R} \\cos(n\\theta)\n$$\n这与问题中的公式一致。\n\n**情况 2: $n = 0$**\n边界条件是 $g(\\theta) = \\cos(0\\theta) = 1$。该模态的一般衰减解是 $\\Phi(r,\\theta) = A_0$。在 $r=R$ 处应用边界条件得到 $A_0 = 1$。解是 $\\Phi(r,\\theta) = 1$。然而，这个解在无穷远处不衰减到 $0$。它是有界的。如果我们严格强制 $\\Phi \\to 0$ 当 $r \\to \\infty$ 时，那么必须有 $A_0 = 0$，这只与边界条件 $g(\\theta)=0$ 兼容。因此，如问题所述，对于非零常数边界条件，不存在在无穷远处消失的解。对于 $g(\\theta)=0$ 的平凡情况，解是 $\\Phi \\equiv 0$，诺伊曼数据是 $0$。\n如果我们将条件放宽到在无穷远处有界（这对于 $\\mathbf{B} \\to \\mathbf{0}$ 是足够的），那么对于 $g(\\theta)=1$，解是 $\\Phi(r,\\theta) = 1$。法向导数是 $\\frac{\\partial \\Phi}{\\partial r} = \\frac{\\partial (1)}{\\partial r} = 0$。所以对于 $g(\\theta)=1$，诺伊曼数据是 $0$。这与问题中 $\\Lambda[1]=0$ 的结论相符。\n\n总的来说，DtN 映射作用于傅里叶基的方式是 $\\cos(n\\theta) \\mapsto -\\frac{n}{R}\\cos(n\\theta)$ 和 $\\sin(n\\theta) \\mapsto -\\frac{n}{R}\\sin(n\\theta)$ (对于 $n \\ge 1$)，以及 $1 \\mapsto 0$。这是该基中对角算子的作用，其特征值（对角元素）等于 $-\\frac{|n|}{R}$。\n\n### 2. 边界积分观点\n\n拉普拉斯方程的解 $\\Phi$ 可以通过格林第二恒等式表示。对于点 $\\boldsymbol{x} \\in \\mathbb{R}^2 \\setminus \\bar{\\Omega}$（外部域），$\\Phi$ 的值由边界 $\\partial\\Omega$ 上的积分给出：\n$$\n\\Phi(\\boldsymbol{x}) = \\int_{\\partial\\Omega} \\left( G(\\boldsymbol{x},\\boldsymbol{y}) \\frac{\\partial \\Phi}{\\partial \\nu_y}(\\boldsymbol{y}) - \\Phi(\\boldsymbol{y}) \\frac{\\partial G}{\\partial \\nu_y}(\\boldsymbol{x},\\boldsymbol{y}) \\right) dS_y\n$$\n其中 $\\boldsymbol{y}$ 是边界上的点，$G(\\boldsymbol{x},\\boldsymbol{y}) = -\\frac{1}{2\\pi}\\ln\\lVert \\boldsymbol{x} - \\boldsymbol{y} \\rVert$ 是二维拉普拉斯算子的自由空间格林函数，而 $\\frac{\\partial}{\\partial \\nu_y}$ 是在 $\\boldsymbol{y}$ 处的外法向导数。当 $\\boldsymbol{x}$ 趋近于边界上的一点时，取极限会得到一个边界积分方程 (BIE)，它将狄利克雷数据 $u = \\Phi|_{\\partial\\Omega}$ 与诺伊曼数据 $q = \\frac{\\partial \\Phi}{\\partial \\nu}|_{\\partial\\Omega}$ 联系起来。这个方程可以用算子形式写成 $S q - D u = \\mathcal{O}(u)$，其中 $S$ 和 $D$ 分别是单层和双层势算子。狄利克雷-诺伊曼映射 $\\Lambda$ 由 $q = \\Lambda u$ 定义。示意性地，$\\Lambda = S^{-1} \\circ D'$，其中 $D'$ 与 $D$ 相关。\n\n关键属性源于积分算子 $S$ 和 $D$ 的性质：\n-   **非局域性:** 这些算子由整个边界 $\\partial\\Omega$ 上的积分定义。例如，$(Sq)(\\boldsymbol{x}) = \\int_{\\partial\\Omega} G(\\boldsymbol{x},\\boldsymbol{y}) q(\\boldsymbol{y}) dS_y$。单点 $\\boldsymbol{x}$ 处 $(Sq)(\\boldsymbol{x})$ 的值依赖于函数 $q$ 在整个边界上的值。因此，由这些算子构成的 DtN 映射 $\\Lambda$ 也是一个非局域算子。\n-   **在圆上的对角化:** 对于半径为 $R$ 的圆形边界，我们可以用角度 $\\theta$ 来参数化点。设 $\\boldsymbol{x} = (R, \\theta_x)$ 和 $\\boldsymbol{y} = (R, \\theta_y)$。它们之间的距离平方是 $\\lVert \\boldsymbol{x} - \\boldsymbol{y} \\rVert^2 = R^2(\\cos\\theta_x - \\cos\\theta_y)^2 + R^2(\\sin\\theta_x - \\sin\\theta_y)^2 = 2R^2(1 - \\cos(\\theta_x - \\theta_y))$。单层算子的核 $G(\\boldsymbol{x},\\boldsymbol{y})$ 仅依赖于角度之差 $\\theta_x - \\theta_y$。双层算子的核 $\\frac{\\partial G}{\\partial \\nu_y}$ 也是如此。一个积分算子，如果其核 $k(\\boldsymbol{x}, \\boldsymbol{y})$ 仅依赖于其参数的差（在群论意义上，这里是旋转），则它是一个卷积算子。在圆群上，卷积定义为 $(f*h)(\\theta_x) = \\int_0^{2\\pi} f(\\theta_x - \\theta_y) h(\\theta_y) d\\theta_y$。傅里叶分析的一个基本定理指出，卷积算子可被傅里叶基 $\\{e^{ik\\theta}\\}_{k \\in \\mathbb{Z}}$（或等价地，$\\{\\cos(k\\theta), \\sin(k\\theta)\\}$）对角化。因此，对于圆形域，由这类卷积算子构成的 DtN 映射 $\\Lambda$ 在傅里叶基中也是对角的。\n\n### 3. 数值近似与偏差\n\n我们被要求使用向前有限差分格式来近似法向导数 $\\frac{\\partial \\Phi}{\\partial r}\\big\\rvert_{r=R}$，并计算其与精确结果的最大绝对偏差。\n\n对于狄利克雷数据 $g(\\theta)=\\cos(n\\theta)$ ($n \\ge 1$)，精确解是 $\\Phi(r,\\theta) = (R/r)^n \\cos(n\\theta)$。\n在 $r=R$ 处的导数的有限差分近似是：\n$$\n\\left.\\frac{\\partial \\Phi}{\\partial r}\\right\\rvert_{r=R}^{\\text{approx}} = \\frac{\\Phi(R+\\Delta r,\\theta) - \\Phi(R,\\theta)}{\\Delta r}\n$$\n代入 $\\Phi$ 的表达式：\n$$\n\\left.\\frac{\\partial \\Phi}{\\partial r}\\right\\rvert_{r=R}^{\\text{approx}} = \\frac{\\left(\\frac{R}{R+\\Delta r}\\right)^n \\cos(n\\theta) - \\left(\\frac{R}{R}\\right)^n \\cos(n\\theta)}{\\Delta r} = \\left[ \\frac{(1+\\Delta r/R)^{-n} - 1}{\\Delta r} \\right] \\cos(n\\theta)\n$$\n精确导数是：\n$$\n\\left.\\frac{\\partial \\Phi}{\\partial r}\\right\\rvert_{r=R}^{\\text{exact}} = -\\frac{n}{R} \\cos(n\\theta)\n$$\n偏差是这两个量之间的绝对差。我们需要找到这个偏差在采样角度 $\\theta_j = j \\frac{2\\pi}{N_\\theta}$ ($j=0, \\dots, N_\\theta-1$) 上的最大值。\n$$\n\\text{偏差}(\\theta) = \\left| \\left[ \\frac{(1+\\Delta r/R)^{-n} - 1}{\\Delta r} \\right] \\cos(n\\theta) - \\left( -\\frac{n}{R} \\cos(n\\theta) \\right) \\right|\n$$\n$$\n= \\left| \\left( \\frac{(1+\\Delta r/R)^{-n} - 1}{\\Delta r} + \\frac{n}{R} \\right) \\cos(n\\theta) \\right|\n$$\n此表达式的绝对值在 $|\\cos(n\\theta)|=1$ 时达到最大，这在 $\\theta=0$ 时发生。因此，最大偏差是：\n$$\n\\text{最大偏差} = \\left| \\frac{(1+\\Delta r/R)^{-n} - 1}{\\Delta r} + \\frac{n}{R} \\right|\n$$\n这是需要计算的量。对于特殊情况 $n=0$，边界数据是 $g(\\theta)=1$。有界解是 $\\Phi(r,\\theta)=1$。\n$$\n\\left.\\frac{\\partial \\Phi}{\\partial r}\\right\\rvert_{r=R}^{\\text{approx}} = \\frac{\\Phi(R+\\Delta r,\\theta) - \\Phi(R,\\theta)}{\\Delta r} = \\frac{1-1}{\\Delta r} = 0\n$$\n精确导数是 $\\frac{\\partial \\Phi}{\\partial r} = 0$。偏差为 $0$。\n\n对于小的 $x=\\Delta r/R$，$(1+x)^{-n}$ 的泰勒级数展开是 $1 - nx + \\frac{n(n+1)}{2}x^2 + O(x^3)$。括号中的项变为 $\\frac{-nx + \\frac{n(n+1)}{2}x^2 + O(x^3)}{R x} + \\frac{n}{R} = (-\\frac{n}{R} + \\frac{n(n+1)}{2R}x + O(x^2)) + \\frac{n}{R} \\approx \\frac{n(n+1)}{2R^2}\\Delta r$。这表明近似误差是关于 $\\Delta r$ 的一阶，正如向前差分格式所预期的。实现将计算完整的表达式以获得最大精度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum absolute discrepancy between the analytical Neumann data\n    and a finite-difference approximation for the exterior Laplace problem on a circle.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (R, n, N_theta, delta_r)\n        (1.0, 3, 256, 1.0e-4),\n        (0.5, 0, 128, 1.0e-3),\n        (2.0, 15, 512, 1.0e-3),\n        (1.0, 50, 128, 5.0e-2),\n    ]\n\n    results = []\n    for R, n, N_theta, delta_r in test_cases:\n        # The task is to compute the maximum absolute discrepancy over theta.\n        # The discrepancy function is:\n        # D(theta) = abs(numerical_derivative(theta) - exact_derivative(theta))\n        #\n        # numerical_derivative(theta) = [ ((1 + delta_r/R)**(-n) - 1) / delta_r ] * cos(n*theta)\n        # exact_derivative(theta) = -(n/R) * cos(n*theta)\n        #\n        # D(theta) = abs( ( ((1 + delta_r/R)**(-n) - 1) / delta_r + n/R ) * cos(n*theta) )\n        #\n        # The maximum value of D(theta) occurs when abs(cos(n*theta)) is maximized.\n        # Since theta is sampled uniformly and includes theta=0, max(abs(cos(n*theta))) is 1.\n        # Therefore, we only need to compute the scalar prefactor.\n\n        if n == 0:\n            # For n=0, the solution is Phi(r,theta)=1 (for BC=1).\n            # The numerical derivative is (1-1)/delta_r = 0.\n            # The exact derivative is -0/R = 0.\n            # The discrepancy is 0.\n            discrepancy = 0.0\n        else:\n            # For n >= 1\n            # Calculate the two terms that form the prefactor\n            \n            # This is the factor that multiplies cos(n*theta) in the numerical derivative\n            numerical_factor = ((1.0 + delta_r / R)**(-n) - 1.0) / delta_r\n            \n            # This is the factor that multiplies cos(n*theta) in the exact derivative\n            exact_factor = -n / R\n            \n            # The max discrepancy is the absolute difference of these factors\n            discrepancy = abs(numerical_factor - exact_factor)\n            \n        results.append(discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}