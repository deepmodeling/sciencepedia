{
    "hands_on_practices": [
        {
            "introduction": "The narrow region where hot plasma interacts with material surfaces, known as the Scrape-Off Layer (SOL), is of paramount importance for managing heat exhaust in a tokamak. This practice problem challenges you to construct a simplified, first-principles model of the SOL by balancing the timescales of heat transport across and along the magnetic field. By doing so, you will derive an expression for the heat-flux width ($\\lambda_q$), a critical parameter that governs the peak heat load on the divertor targets. ",
            "id": "3997030",
            "problem": "A toroidally axisymmetric tokamak plasma operates in a regime where the Scrape-Off Layer (SOL) is dominated by cross-field diffusion and parallel losses. Consider a simplified integrated model of the SOL based on first principles of energy transport along and across the magnetic field. Assume the following steady-state scenario:\n\n- The along-field energy removal from an SOL flux tube is convective, characterized by the parallel heat flux density $q_{\\parallel}$ and the sheath energy transmission factor $\\gamma_{\\mathrm{sh}}$.\n- The parallel sound speed $c_{s}$ obeys the ion-acoustic relation in a singly ionized deuterium plasma.\n- The radial spreading of heat across the SOL is governed by a constant perpendicular thermal diffusivity $\\chi_{\\perp}$.\n- The parallel connection length $L_{\\parallel}$ from the outer midplane to the outer divertor is set by the magnetic geometry.\n- The divertor target is oriented such that the incidence angle of the magnetic field equals the poloidal pitch angle at the strike point, with $\\sin\\alpha = B_{p}/B$.\n\nStarting from fundamental laws and well-tested formulas, derive an expression for the SOL heat-flux width $\\lambda_{q}$ by balancing the perpendicular diffusion timescale against the parallel loss timescale, and then estimate the normal heat flux to the divertor target.\n\nUse the following parameters, which are all scientifically realistic:\n- Toroidal magnetic field magnitude $B = 2.1\\,\\mathrm{T}$.\n- Major radius $R = 1.7\\,\\mathrm{m}$ and edge safety factor $q_{\\mathrm{sf}} = 4.5$.\n- Minor radius at the strike-point flux surface $r = 0.60\\,\\mathrm{m}$.\n- Perpendicular thermal diffusivity $\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$.\n- Parallel heat flux density (upstream) $q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$.\n- Edge density $n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$.\n- Sheath energy transmission factor $\\gamma_{\\mathrm{sh}} = 7$.\n- Ion mass for deuterium $m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$.\n\nAssume:\n- The parallel connection length satisfies $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$.\n- The poloidal magnetic field at the strike-point satisfies $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$.\n- Parallel losses are convective with $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$ and $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$.\n- The SOL width is set by equating the perpendicular diffusion time $\\tau_{\\perp} = \\dfrac{\\lambda_{q}^{2}}{\\chi_{\\perp}}$ to the parallel loss time $\\tau_{\\parallel} = \\dfrac{L_{\\parallel}}{c_{s}}$.\n\nTasks:\n1. Derive an analytic expression for $\\lambda_{q}$ in terms of $\\chi_{\\perp}$, $L_{\\parallel}$, $q_{\\parallel}$, $\\gamma_{\\mathrm{sh}}$, $n$, and $m_{i}$.\n2. Using the given numerical values, compute $\\lambda_{q}$ and the divertor target normal heat flux $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$ with $\\sin\\alpha = \\dfrac{B_{p}}{B}$.\n3. Express $\\lambda_{q}$ in meters and $q_{\\mathrm{target}}$ in $\\mathrm{MW/m^{2}}$.\n4. Round both results to three significant figures.\n\nProvide the final numerical results as two quantities in the order $\\lambda_{q}$ and $q_{\\mathrm{target}}$.",
            "solution": "The derivation is based on balancing the characteristic timescales for perpendicular and parallel heat transport. The perpendicular transport is diffusive, while the parallel transport is convective.\n\nThe characteristic time for heat to diffuse radially across a distance $\\lambda_{q}$ is given by:\n$$\n\\tau_{\\perp} = \\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}}\n$$\nwhere $\\chi_{\\perp}$ is the constant perpendicular thermal diffusivity.\n\nThe characteristic time for heat to be lost along the magnetic field lines to the divertor target is given by:\n$$\n\\tau_{\\parallel} = \\frac{L_{\\parallel}}{c_{s}}\n$$\nwhere $L_{\\parallel}$ is the parallel connection length and $c_{s}$ is the parallel sound speed.\n\nThe SOL width $\\lambda_{q}$ is determined by the condition that these two timescales are equal:\n$$\n\\tau_{\\perp} = \\tau_{\\parallel}\n$$\nSubstituting the expressions for the timescales yields:\n$$\n\\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}} = \\frac{L_{\\parallel}}{c_{s}}\n$$\nSolving for $\\lambda_{q}^{2}$ gives:\n$$\n\\lambda_{q}^{2} = \\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}\n$$\n\nTo proceed, we need an expression for the sound speed $c_{s}$ in terms of the given upstream plasma parameters. The problem provides two key relations for the singly ionized deuterium plasma:\n1.  The parallel heat flux density $q_{\\parallel}$ is given by $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$, where $\\gamma_{\\mathrm{sh}}$ is the sheath energy transmission factor, $n$ is the plasma density, $k_{B}$ is the Boltzmann constant, and $T$ is the temperature.\n2.  The ion-acoustic sound speed is given by $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$, where $m_{i}$ is the ion mass.\n\nWe can eliminate the temperature $T$ from these two equations. From the second equation, we express $k_{B}T$ as:\n$$\nk_{B}T = m_{i} c_{s}^{2}\n$$\nSubstituting this expression for $k_{B}T$ into the equation for $q_{\\parallel}$:\n$$\nq_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, (m_{i} c_{s}^{2})\\, c_{s} = \\gamma_{\\mathrm{sh}}\\, n\\, m_{i}\\, c_{s}^{3}\n$$\nWe can now solve for the sound speed $c_{s}$ in terms of $q_{\\parallel}$, $n$, $m_{i}$, and $\\gamma_{\\mathrm{sh}}$:\n$$\nc_{s}^{3} = \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\implies c_{s} = \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3}\n$$\nNow, we substitute this expression for $c_s$ back into the equation for $\\lambda_{q}^{2}$:\n$$\n\\lambda_{q}^{2} = \\chi_{\\perp} L_{\\parallel} \\left( \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3} \\right)^{-1} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{-1/3} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}\n$$\nTaking the square root gives the final analytic expression for $\\lambda_{q}$, which is the answer to the first task:\n$$\n\\lambda_{q} = \\sqrt{\\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}}\n$$\n\nFor the second task, we compute the numerical values. First, we calculate the intermediate quantities $L_{\\parallel}$ and $c_{s}$ using the provided parameters:\n- Toroidal magnetic field: $B = 2.1\\,\\mathrm{T}$\n- Major radius: $R = 1.7\\,\\mathrm{m}$\n- Edge safety factor: $q_{\\mathrm{sf}} = 4.5$\n- Minor radius at strike-point: $r = 0.60\\,\\mathrm{m}$\n- Perpendicular thermal diffusivity: $\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$\n- Upstream parallel heat flux: $q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$\n- Edge density: $n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$\n- Sheath energy transmission factor: $\\gamma_{\\mathrm{sh}} = 7$\n- Deuterium ion mass: $m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$\n\nThe parallel connection length $L_{\\parallel}$ is given by $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$:\n$$\nL_{\\parallel} = \\pi \\times (1.7\\,\\mathrm{m}) \\times 4.5 = 7.65\\pi\\,\\mathrm{m} \\approx 24.033\\,\\mathrm{m}\n$$\nThe sound speed $c_{s}$ is:\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}}{7 \\times (2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}) \\times (3.345 \\times 10^{-27}\\,\\mathrm{kg})} \\right)^{1/3}\n$$\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}}{4.683 \\times 10^{-7}} \\right)^{1/3} \\mathrm{m/s} = (4.270766 \\times 10^{14})^{1/3}\\,\\mathrm{m/s} \\approx 75313.3\\,\\mathrm{m/s}\n$$\nNow we can compute $\\lambda_{q}$:\n$$\n\\lambda_{q} = \\sqrt{\\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}} = \\sqrt{\\frac{(0.40\\,\\mathrm{m^{2}/s}) \\times (24.033\\,\\mathrm{m})}{75313.3\\,\\mathrm{m/s}}} = \\sqrt{1.2764 \\times 10^{-4}\\,\\mathrm{m^2}}\n$$\n$$\n\\lambda_{q} \\approx 0.011298\\,\\mathrm{m}\n$$\nRounding to three significant figures, we get $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$.\n\nNext, we calculate the normal heat flux to the divertor target, $q_{\\mathrm{target}}$. It is given by $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$, where $\\alpha$ is the incidence angle of the magnetic field. We are given that $\\sin\\alpha = B_{p}/B$ and $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$.\nTherefore:\n$$\n\\sin\\alpha = \\frac{1}{B} \\left( \\frac{r B}{R q_{\\mathrm{sf}}} \\right) = \\frac{r}{R q_{\\mathrm{sf}}}\n$$\nSubstituting the numerical values:\n$$\n\\sin\\alpha = \\frac{0.60\\,\\mathrm{m}}{(1.7\\,\\mathrm{m}) \\times 4.5} = \\frac{0.60}{7.65} \\approx 0.078431\n$$\nNow, we can compute $q_{\\mathrm{target}}$:\n$$\nq_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha = (2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}) \\times 0.078431 = 1.56862 \\times 10^{7}\\,\\mathrm{W/m^{2}}\n$$\nThe problem asks for the result in $\\mathrm{MW/m^{2}}$. Since $1\\,\\mathrm{MW} = 10^{6}\\,\\mathrm{W}$:\n$$\nq_{\\mathrm{target}} = 15.6862\\,\\mathrm{MW/m^{2}}\n$$\nRounding to three significant figures, we get $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$.\n\nThe final results are $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$ and $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.13 \\times 10^{-2} & 15.7 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Integrated modeling workflows often employ a hierarchy of physics models, ranging from computationally intensive, high-fidelity simulations to fast, reduced-order surrogates. This exercise explores the practical trade-offs of such an approach by focusing on the global energy confinement time, $\\tau_E$. You will implement and compare a comprehensive gyrokinetic-based transport model with a simplified surrogate to assess its accuracy and identify the plasma regimes where the reduced model's predictions become unreliable. ",
            "id": "3997054",
            "problem": "Consider a zero-dimensional integrated modeling workflow for a tokamak plasma that combines a global energy balance with transport closures. The global energy confinement time $\\tau_E$ is defined through the energy balance at quasi-steady state. The aim is to compare a full gyrokinetic (GK) coupling model for the effective thermal diffusivity with a reduced surrogate model, compute the resulting error in the global confinement time, and classify regimes in which the surrogate fails.\n\nStart from the following fundamental laws and definitions:\n- The global thermal energy content is $W = \\frac{3}{2} n V k_B (T_e + T_i)$, where $n$ is the volume-averaged density, $V$ is the plasma volume, $k_B$ is the Boltzmann constant, and $T_e$, $T_i$ are the electron and ion temperatures. Temperatures are treated as a combined scalar $T_e + T_i$ via the energy content $W$.\n- The conductive heat flux follows Fourier's law $q = - n c \\chi \\nabla T$, where $c$ is the specific heat per particle, and $\\chi$ is the effective thermal diffusivity representing turbulent transport.\n- For a large-aspect-ratio torus, the plasma volume and surface area are $V = 2 \\pi^2 R a^2$ and $S = 4 \\pi^2 R a$, where $R$ is the major radius and $a$ is the minor radius.\n- At quasi-steady state, the energy balance is $P_{\\text{in}} = P_{\\text{cond}} + P_{\\text{rad}}$, where $P_{\\text{in}}$ is the external heating power and $P_{\\text{rad}}$ is radiative loss power. The global energy confinement time is $\\tau_E = W / P_{\\text{loss}}$ with $P_{\\text{loss}} = P_{\\text{in}}$ at steady state.\n\nAssume the following integrated closures:\n- Take the conduction loss power to be $P_{\\text{cond}} = S \\, n \\, (3 k_B) \\, \\chi_{\\text{eff}} \\, \\frac{T_e + T_i}{a}$, consistent with Fourier's law and toroidal geometry, where $3 k_B$ is the combined specific heat per particle for electrons and ions.\n- Assume a fixed radiative fraction $f_{\\text{rad}}$ of the input power, so $P_{\\text{rad}} = f_{\\text{rad}} P_{\\text{in}}$, with $0 \\le f_{\\text{rad}} < 1$.\n- Under these assumptions, eliminating $(T_e + T_i)$ via $W$ yields the steady-state global confinement time\n$$\n\\tau_E = \\frac{W}{P_{\\text{in}}} = (1 - f_{\\text{rad}})\\,\\frac{a V}{2 S \\, \\chi_{\\text{eff}}}.\n$$\nThis formula expresses $\\tau_E$ purely in terms of geometry, radiative fraction, and the effective thermal diffusivity $\\chi_{\\text{eff}}$.\n\nDefine the effective thermal diffusivity predicted by two closures:\n1. Full gyrokinetic coupling model (GK):\n$$\n\\chi_{\\text{GK}} = \\chi_{\\text{ref}} \\left(\\frac{\\rho_*}{\\rho_{*,\\text{ref}}}\\right)^{\\alpha} \\left(\\frac{\\nu_*}{\\nu_{*,\\text{ref}}}\\right)^{\\delta} \\left(1 + c_{\\beta} \\frac{\\beta}{\\beta_{\\text{ref}}}\\right)\\;+\\;\\chi_{\\text{EM}} \\left(\\frac{\\beta}{\\beta_{\\text{ref}}}\\right)^{2}\\;+\\;\\chi_{\\text{grad}} \\left[\\max\\left(0, \\frac{R}{L_T} - \\kappa_c\\right)\\right]^p,\n$$\nwhere $\\rho_*$ is the normalized ion gyroradius, $\\beta$ is the plasma beta, $\\nu_*$ is the normalized collisionality, and $R/L_T$ is the normalized temperature gradient.\n2. Reduced surrogate model:\n$$\n\\chi_{\\text{surr}} = \\chi_{\\text{ref}} \\left(\\frac{\\rho_*}{\\rho_{*,\\text{ref}}}\\right)^{\\alpha} \\left(\\frac{\\nu_*}{\\nu_{*,\\text{ref}}}\\right)^{\\delta}\\;+\\;\\chi_{\\text{grad}} \\left[\\max\\left(0, \\frac{R}{L_T} - \\kappa_c\\right)\\right]^p,\n$$\nwhich omits explicit electromagnetic enhancements.\n\nUse the following constants for both models:\n- $\\chi_{\\text{ref}} = 0.5\\,\\text{m}^2/\\text{s}$, $\\rho_{*,\\text{ref}} = 1\\times 10^{-3}$, $\\nu_{*,\\text{ref}} = 0.3$, $\\beta_{\\text{ref}} = 0.01$, $c_{\\beta} = 0.6$, $\\chi_{\\text{EM}} = 0.1\\,\\text{m}^2/\\text{s}$, $\\chi_{\\text{grad}} = 0.3\\,\\text{m}^2/\\text{s}$, $\\kappa_c = 3.0$, $p = 2.0$, $\\alpha = 1.0$, $\\delta = 0.5$.\n- The Boltzmann constant is $k_B = 1.380649 \\times 10^{-23}\\,\\text{J}/\\text{K}$, but it cancels in the final expression for $\\tau_E$ given above and is not needed in numerical evaluation.\n\nFor each test case, compute:\n- $\\tau_{E,\\text{GK}}$ in seconds using $\\chi_{\\text{GK}}$.\n- $\\tau_{E,\\text{surr}}$ in seconds using $\\chi_{\\text{surr}}$.\n- The relative error $\\epsilon = \\left|\\tau_{E,\\text{surr}} - \\tau_{E,\\text{GK}}\\right| / \\tau_{E,\\text{GK}}$ as a decimal.\n- A failure boolean defined as $\\epsilon > \\epsilon_{\\text{th}}$, with $\\epsilon_{\\text{th}} = 0.25$.\n\nExpress all $\\tau_E$ values in seconds. Express the relative error $\\epsilon$ as a decimal. Angles are not involved. The output for each case must be a list of four elements $[\\tau_{E,\\text{GK}}, \\tau_{E,\\text{surr}}, \\epsilon, \\text{fail}]$.\n\nUse the toroidal geometry formulas $V = 2 \\pi^2 R a^2$ and $S = 4 \\pi^2 R a$. The input parameters for each case are $(R, a, n, P_{\\text{in}}, f_{\\text{rad}}, \\rho_*, \\beta, \\nu_*, R/L_T, B)$, where $B$ is the magnetic field in tesla, but in these closures $B$ is not used directly and is provided for completeness.\n\nTest suite parameter values:\n- Case $1$ (nominal ion temperature gradient regime): $R = 3.0\\,\\text{m}$, $a = 0.6\\,\\text{m}$, $n = 8.0 \\times 10^{19}\\,\\text{m}^{-3}$, $P_{\\text{in}} = 1.5 \\times 10^{7}\\,\\text{W}$, $f_{\\text{rad}} = 0.2$, $\\rho_* = 2.0 \\times 10^{-3}$, $\\beta = 0.01$, $\\nu_* = 0.3$, $R/L_T = 6.0$, $B = 5.3\\,\\text{T}$.\n- Case $2$ (high electromagnetic activity): $R = 6.0\\,\\text{m}$, $a = 0.9\\,\\text{m}$, $n = 1.0 \\times 10^{20}\\,\\text{m}^{-3}$, $P_{\\text{in}} = 2.5 \\times 10^{7}\\,\\text{W}$, $f_{\\text{rad}} = 0.3$, $\\rho_* = 1.0 \\times 10^{-3}$, $\\beta = 0.04$, $\\nu_* = 0.2$, $R/L_T = 5.0$, $B = 5.0\\,\\text{T}$.\n- Case $3$ (near-threshold low-gradient): $R = 1.65\\,\\text{m}$, $a = 0.5\\,\\text{m}$, $n = 6.0 \\times 10^{19}\\,\\text{m}^{-3}$, $P_{\\text{in}} = 8.0 \\times 10^{6}\\,\\text{W}$, $f_{\\text{rad}} = 0.1$, $\\rho_* = 3.0 \\times 10^{-3}$, $\\beta = 0.005$, $\\nu_* = 0.5$, $R/L_T = 2.9$, $B = 2.5\\,\\text{T}$.\n- Case $4$ (high collisionality and strong gradients): $R = 2.8\\,\\text{m}$, $a = 0.8\\,\\text{m}$, $n = 1.5 \\times 10^{20}\\,\\text{m}^{-3}$, $P_{\\text{in}} = 1.2 \\times 10^{7}\\,\\text{W}$, $f_{\\text{rad}} = 0.5$, $\\rho_* = 5.0 \\times 10^{-4}$, $\\beta = 0.015$, $\\nu_* = 1.5$, $R/L_T = 7.0$, $B = 3.0\\,\\text{T}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the case-specific list described above, for example $[[\\tau_{E,1}^{\\text{GK}},\\tau_{E,1}^{\\text{surr}},\\epsilon_1,\\text{fail}_1],[\\tau_{E,2}^{\\text{GK}},\\tau_{E,2}^{\\text{surr}},\\epsilon_2,\\text{fail}_2],\\dots]$, with no spaces in the printed output. All numerical outputs must be floats in seconds for $\\tau_E$ and decimals for $\\epsilon$, and booleans for the failure flag.",
            "solution": "First, we establish the formula for the global energy confinement time, $\\tau_E$, from the provided 0D steady-state model. The energy balance is given by $P_{\\text{in}} = P_{\\text{cond}} + P_{\\text{rad}}$. With the radiative power fraction defined as $P_{\\text{rad}} = f_{\\text{rad}} P_{\\text{in}}$, the conductive power loss is $P_{\\text{cond}} = (1 - f_{\\text{rad}}) P_{\\text{in}}$. The global energy confinement time is defined as $\\tau_E = W / P_{\\text{in}}$, where $W$ is the total plasma thermal energy, $W = \\frac{3}{2} n V k_B (T_e + T_i)$. The problem provides a closure for the conductive power based on Fourier's law in toroidal geometry: $P_{\\text{cond}} = S \\, n \\, (3 k_B) \\, \\chi_{\\text{eff}} \\, \\frac{T_e + T_i}{a}$.\n\nBy equating the two expressions for $P_{\\text{cond}}$, we have:\n$$\n(1 - f_{\\text{rad}}) P_{\\text{in}} = S \\, n \\, (3 k_B) \\, \\chi_{\\text{eff}} \\, \\frac{T_e + T_i}{a}\n$$\nFrom the definition of $W$, we can express the combined temperature term as $k_B(T_e + T_i) = \\frac{2W}{3nV}$. Substituting this into the energy balance equation yields:\n$$\n(1 - f_{\\text{rad}}) P_{\\text{in}} = S \\, n \\, 3 \\, \\chi_{\\text{eff}} \\, \\frac{1}{a} \\left( \\frac{2W}{3nV} \\right) = \\frac{2 S \\chi_{\\text{eff}} W}{aV}\n$$\nRearranging this equation to solve for the ratio $W/P_{\\text{in}}$ directly gives the expression for $\\tau_E$:\n$$\n\\tau_E = \\frac{W}{P_{\\text{in}}} = (1 - f_{\\text{rad}}) \\frac{aV}{2S\\chi_{\\text{eff}}}\n$$\nThe problem specifies the geometry for a large-aspect-ratio torus: plasma volume $V = 2 \\pi^2 R a^2$ and surface area $S = 4 \\pi^2 R a$. Substituting these into the expression for $\\tau_E$ leads to a significant simplification:\n$$\n\\tau_E = (1 - f_{\\text{rad}}) \\frac{a(2 \\pi^2 R a^2)}{2(4 \\pi^2 R a)\\chi_{\\text{eff}}} = (1 - f_{\\text{rad}}) \\frac{2 \\pi^2 R a^3}{8 \\pi^2 R a \\chi_{\\text{eff}}} = (1 - f_{\\text{rad}}) \\frac{a^2}{4\\chi_{\\text{eff}}}\n$$\nThis simplified formula is the basis for our calculation. It reveals that within this 0D model, $\\tau_E$ depends only on the minor radius $a$, the radiative fraction $f_{\\text{rad}}$, and the effective thermal diffusivity $\\chi_{\\text{eff}}$.\n\nNext, we define the two models for $\\chi_{\\text{eff}}$. The full gyrokinetic model is:\n$$\n\\chi_{\\text{GK}} = \\chi_{\\text{ref}} \\left(\\frac{\\rho_*}{\\rho_{*,\\text{ref}}}\\right)^{\\alpha} \\left(\\frac{\\nu_*}{\\nu_{*,\\text{ref}}}\\right)^{\\delta} \\left(1 + c_{\\beta} \\frac{\\beta}{\\beta_{\\text{ref}}}\\right)\\;+\\;\\chi_{\\text{EM}} \\left(\\frac{\\beta}{\\beta_{\\text{ref}}}\\right)^{2}\\;+\\;\\chi_{\\text{grad}} \\left[\\max\\left(0, \\frac{R}{L_T} - \\kappa_c\\right)\\right]^p\n$$\nThe reduced surrogate model is:\n$$\n\\chi_{\\text{surr}} = \\chi_{\\text{ref}} \\left(\\frac{\\rho_*}{\\rho_{*,\\text{ref}}}\\right)^{\\alpha} \\left(\\frac{\\nu_*}{\\nu_{*,\\text{ref}}}\\right)^{\\delta}\\;+\\;\\chi_{\\text{grad}} \\left[\\max\\left(0, \\frac{R}{L_T} - \\kappa_c\\right)\\right]^p\n$$\nThe surrogate model, $\\chi_{\\text{surr}}$, omits the terms dependent on plasma beta, $\\beta$, which represent electromagnetic transport effects. The difference between the models lies in these two terms:\n$$\n\\chi_{\\text{GK}} - \\chi_{\\text{surr}} = \\left[\\chi_{\\text{ref}} \\left(\\frac{\\rho_*}{\\rho_{*,\\text{ref}}}\\right)^{\\alpha} \\left(\\frac{\\nu_*}{\\nu_{*,\\text{ref}}}\\right)^{\\delta}\\right] \\left(c_{\\beta} \\frac{\\beta}{\\beta_{\\text{ref}}}\\right) + \\chi_{\\text{EM}} \\left(\\frac{\\beta}{\\beta_{\\text{ref}}}\\right)^{2}\n$$\n\nThe computational procedure for each test case is as follows:\n1.  For a given set of parameters $(a, f_{\\text{rad}}, \\rho_*, \\beta, \\nu_*, R/L_T)$, calculate $\\chi_{\\text{GK}}$ and $\\chi_{\\text{surr}}$ using their respective formulas and the provided physical constants.\n2.  Calculate the confinement times $\\tau_{E,\\text{GK}}$ and $\\tau_{E,\\text{surr}}$ using the derived formula $\\tau_E = (1 - f_{\\text{rad}}) a^2 / (4\\chi_{\\text{eff}})$.\n3.  Compute the relative error, $\\epsilon = |\\tau_{E,\\text{surr}} - \\tau_{E,\\text{GK}}| / \\tau_{E,\\text{GK}}$.\n4.  Determine the boolean failure flag, $\\text{fail} = (\\epsilon > \\epsilon_{\\text{th}})$, where the threshold is given as $\\epsilon_{\\text{th}} = 0.25$.\n5.  Collect the four resulting values, $[\\tau_{E,\\text{GK}}, \\tau_{E,\\text{surr}}, \\epsilon, \\text{fail}]$, for each test case.\nThis procedure will be implemented for all provided test cases.",
            "answer": "[[0.01636363636363636,0.01945945945945946,0.1891608391608392,False],[0.03384606214840854,0.08813955611417537,1.6041180295988502,True],[0.05267323886639676,0.05445544554455445,0.03383210338321041,False],[0.04018884978540773,0.058823529411764705,0.4636734693877551,True]]"
        },
        {
            "introduction": "At the computational core of modern integrated modeling lies the challenge of efficiently solving vast, tightly coupled systems of equations that arise from implicit time-stepping schemes. This advanced practice delves into the design of robust numerical solvers, focusing on the critical technique of preconditioning for a coupled transport-MHD system. You will construct a physics-informed block preconditioner and analyze its spectral properties to predict its effectiveness, a fundamental skill for developing high-performance simulation tools. ",
            "id": "3997034",
            "problem": "Consider an integrated multi-physics Newton step arising from a fully implicit discretization of coupled transport and single-fluid magnetohydrodynamics (MHD) in a tokamak plasma, restricted to a linearized model. The discrete Jacobian can be represented as a $2 \\times 2$ block operator\n$$\n\\mathbf{A} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{T} & \\mathbf{C} \\\\\n\\mathbf{B} & \\mathbf{M}\n\\end{bmatrix},\n$$\nwhere $\\mathbf{T} \\in \\mathbb{R}^{n_t \\times n_t}$ models the transport block (e.g., diffusion of temperature), $\\mathbf{M} \\in \\mathbb{R}^{n_m \\times n_m}$ models the MHD block (e.g., quasi-static force balance), and $\\mathbf{C} \\in \\mathbb{R}^{n_t \\times n_m}$, $\\mathbf{B} \\in \\mathbb{R}^{n_m \\times n_t}$ capture linearized cross-physics couplings. Assume $n_t = n_m = 3$.\n\nStart from the following well-tested, foundational modeling ingredients:\n- The implicit linearized transport operator is symmetric positive definite and can be represented by a scaled discrete Laplacian plus a positive diagonal regularization,\n$$\n\\mathbf{T} \\;=\\; \\chi_t \\mathbf{L}_t \\;+\\; \\alpha \\mathbf{I}_{n_t},\n$$\nwhere $\\chi_t > 0$ is a transport diffusivity scale, $\\alpha > 0$ is a regularization from time discretization, and $\\mathbf{L}_t$ is the $n_t \\times n_t$ interior-point Dirichlet discrete one-dimensional Laplacian on a uniform grid with spacing $h_t$, i.e.,\n$$\n\\mathbf{L}_t \\;=\\; \\frac{1}{h_t^2}\n\\begin{bmatrix}\n2 & -1 & 0 \\\\\n-1 & 2 & -1 \\\\\n0 & -1 & 2 \\\\\n\\end{bmatrix}.\n$$\n- The implicit linearized MHD operator is symmetric positive definite and similarly modeled,\n$$\n\\mathbf{M} \\;=\\; \\chi_m \\mathbf{L}_m \\;+\\; \\beta \\mathbf{I}_{n_m},\n$$\nwith $\\chi_m > 0$, $\\beta > 0$, and $\\mathbf{L}_m$ defined analogously to $\\mathbf{L}_t$ with spacing $h_m$.\n- The linearized inter-physics coupling is represented using a rectangular injection matrix $\\mathbf{J} \\in \\mathbb{R}^{n_m \\times n_t}$ with entries $(\\mathbf{J})_{ij} = 1$ if $i=j \\le \\min(n_m,n_t)$ and $0$ otherwise. Define\n$$\n\\mathbf{C} \\;=\\; \\gamma \\mathbf{J}^\\top, \\qquad\n\\mathbf{B} \\;=\\; -\\gamma \\mathbf{J},\n$$\nwhere $\\gamma \\ge 0$ controls the coupling strength.\n\nDesign a right preconditioning strategy based on block factorization. Begin from the exact block lower-upper (LU) factorization identity for invertible $\\mathbf{T}$,\n$$\n\\mathbf{A} \\;=\\;\n\\underbrace{\\begin{bmatrix}\n\\mathbf{I}_{n_t} & \\mathbf{0} \\\\\n\\mathbf{B}\\mathbf{T}^{-1} & \\mathbf{I}_{n_m}\n\\end{bmatrix}}_{\\text{Unit lower}}\n\\underbrace{\\begin{bmatrix}\n\\mathbf{T} & \\mathbf{C} \\\\\n\\mathbf{0} & \\mathbf{S}\n\\end{bmatrix}}_{\\text{Upper}},\n\\qquad\n\\mathbf{S} \\;=\\; \\mathbf{M} \\;-\\; \\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}\n$$\nand propose a practical block lower-triangular right preconditioner\n$$\n\\mathbf{M}_{\\mathrm{prec}} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{T} & \\mathbf{0} \\\\\n\\mathbf{B} & \\widehat{\\mathbf{S}}\n\\end{bmatrix},\n$$\nwhere $\\widehat{\\mathbf{S}}$ is an approximation of the Schur complement $\\mathbf{S}$. To ensure computational tractability, take the approximation $\\widehat{\\mathbf{S}} = \\mathbf{M}$, which neglects the coupling-induced term $\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$.\n\nForm the right-preconditioned operator\n$$\n\\mathbf{P} \\;=\\; \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}.\n$$\nAnalyze its spectrum to predict Krylov solver performance by computing the eigenvalues of $\\mathbf{P}$ and the following quantitative metrics:\n- The spectral radius $r = \\max_i |\\lambda_i(\\mathbf{P})|$.\n- The two-norm condition number $\\kappa_2(\\mathbf{P}) = \\sigma_{\\max}(\\mathbf{P}) / \\sigma_{\\min}(\\mathbf{P})$, where $\\sigma_{\\max}$ and $\\sigma_{\\min}$ are the largest and smallest singular values, respectively.\n- The maximum deviation from unity $d = \\max_i |\\lambda_i(\\mathbf{P}) - 1|$.\n\nImplement the construction and analysis for the following test suite, using $n_t = n_m = 3$ and $h_t = h_m = 1/(n_t+1) = 1/4$, with the listed parameter sets $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma)$:\n- Test $1$ (moderate, balanced): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,0.5\\,)$.\n- Test $2$ (decoupled boundary): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,0.0\\,)$.\n- Test $3$ (strong coupling): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,5.0\\,)$.\n- Test $4$ (diffusivity contrast): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,100.0,\\,1.0,\\,0.1,\\,1.0,\\,1.0\\,)$.\n\nYour program must:\n- Construct $\\mathbf{L}_t$, $\\mathbf{L}_m$, then $\\mathbf{T}$, $\\mathbf{M}$, $\\mathbf{C}$, $\\mathbf{B}$, $\\mathbf{A}$ and the preconditioner $\\mathbf{M}_{\\mathrm{prec}}$ for each test case.\n- Compute $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}$ efficiently by exploiting the block lower-triangular structure of $\\mathbf{M}_{\\mathrm{prec}}$ via block forward solves, not by explicitly inverting $\\mathbf{M}_{\\mathrm{prec}}$.\n- Compute the eigenvalues of $\\mathbf{P}$, then $r$, $\\kappa_2(\\mathbf{P})$, and $d$.\n\nFinal output format:\n- Produce a single line containing the aggregated results over the four test cases as a comma-separated list enclosed in square brackets. Each test case result must itself be a list in the form $[r,\\kappa_2,d]$, in the same order as stated above.\n- For example, the output must have the form $[[r_1,\\kappa_{2,1},d_1],[r_2,\\kappa_{2,2},d_2],[r_3,\\kappa_{2,3},d_3],[r_4,\\kappa_{2,4},d_4]]$ with all values represented as floating-point numbers.",
            "solution": "This problem requires the analysis of a physics-based block preconditioner for a $2 \\times 2$ block matrix $\\mathbf{A}$. An effective preconditioner aims to construct an operator $\\mathbf{M}_{\\mathrm{prec}}$ that is both a good approximation to $\\mathbf{A}$ and is easily invertible, such that the eigenvalues of the preconditioned operator $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1}\\mathbf{A}$ are clustered around $1$. The performance of Krylov solvers is closely tied to the spectral properties of $\\mathbf{P}$. The requested metrics—spectral radius $r$, condition number $\\kappa_2$, and maximum deviation from unity $d$—provide quantitative measures of this clustering.\n\nThe chosen preconditioner,\n$$ \\mathbf{M}_{\\mathrm{prec}} \\;=\\; \\begin{bmatrix} \\mathbf{T} & \\mathbf{0} \\\\ \\mathbf{B} & \\widehat{\\mathbf{S}} \\end{bmatrix}, $$\nis a block lower-triangular approximation of $\\mathbf{A}$, derived from its exact block LU factorization by approximating the true Schur complement $\\mathbf{S} = \\mathbf{M} - \\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$ with $\\widehat{\\mathbf{S}} = \\mathbf{M}$. This approximation is computationally advantageous but its quality depends on the magnitude of the neglected term $\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$, which is related to the coupling strength $\\gamma$.\n\n**Step-by-Step Solution**\n\n**1. Construct Model Matrices**\nFor each test case with parameters $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma)$, we construct the matrices with $n_t = n_m = 3$ and grid spacing $h = 1/4$.\n-   **Discrete Laplacian:**\n    $$\n    \\mathbf{L} \\;=\\; \\frac{1}{h^2}\n    \\begin{bmatrix}\n    2 & -1 & 0 \\\\\n    -1 & 2 & -1 \\\\\n    0 & -1 & 2 \\\\\n    \\end{bmatrix}\n    \\;=\\;\n    \\begin{bmatrix}\n    32 & -16 & 0 \\\\\n    -16 & 32 & -16 \\\\\n    0 & -16 & 32 \\\\\n    \\end{bmatrix}.\n    $$\n-   **Transport and MHD Blocks:** $\\mathbf{T} = \\chi_t \\mathbf{L} + \\alpha \\mathbf{I}$ and $\\mathbf{M} = \\chi_m \\mathbf{L} + \\beta \\mathbf{I}$.\n-   **Coupling Blocks:** For $n_t = n_m = 3$, the injection matrix $\\mathbf{J}$ is the identity matrix $\\mathbf{I}$. Thus, $\\mathbf{C} = \\gamma \\mathbf{I}$ and $\\mathbf{B} = -\\gamma \\mathbf{I}$.\n-   **Full System and Preconditioner:** Assemble the full matrix $\\mathbf{A} = \\begin{bsmallmatrix} \\mathbf{T} & \\mathbf{C} \\\\ \\mathbf{B} & \\mathbf{M} \\end{bsmallmatrix}$ and the preconditioner $\\mathbf{M}_{\\mathrm{prec}} = \\begin{bsmallmatrix} \\mathbf{T} & \\mathbf{0} \\\\ \\mathbf{B} & \\mathbf{M} \\end{bsmallmatrix}$.\n\n**2. Form the Preconditioned Operator**\nThe preconditioned operator $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}$ is found by solving the system $\\mathbf{M}_{\\mathrm{prec}}\\mathbf{P} = \\mathbf{A}$ using block forward substitution. This yields a block upper-triangular matrix:\n$$\n\\mathbf{P} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{I} & \\mathbf{T}^{-1}\\mathbf{C} \\\\\n\\mathbf{0} & \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}\n\\end{bmatrix}.\n$$\nThe blocks are computed numerically by solving linear systems, not by explicit inversion.\n\n**3. Compute Performance Metrics**\nFor the computed matrix $\\mathbf{P}$ in each case:\n-   **Eigenvalues:** The eigenvalues of $\\mathbf{P}$ are computed. They are the union of the eigenvalues of the diagonal blocks.\n-   **Spectral Radius, $r$:** $r = \\max_i |\\lambda_i(\\mathbf{P})|$.\n-   **Maximum Deviation from Unity, $d$:** $d = \\max_i |\\lambda_i(\\mathbf{P}) - 1|$.\n-   **2-Norm Condition Number, $\\kappa_2(\\mathbf{P})$:** $\\kappa_2(\\mathbf{P}) = \\sigma_{\\max}(\\mathbf{P}) / \\sigma_{\\min}(\\mathbf{P})$, computed from the singular values of $\\mathbf{P}$.\n\nThe implementation will perform these calculations for each parameter set and format the results as requested.",
            "answer": "[[1.0007253456860163,1.023811467554988,0.0007253456860163016],[1.0,1.0,0.0],[1.3218951416487107,23.33649938816666,0.3218951416487107],[1.000000028718105,1.0002931201979927,2.87181050215711e-08]]"
        }
    ]
}