{
    "hands_on_practices": [
        {
            "introduction": "集成建模的一个关键应用是评估和预测等离子体与壁的相互作用，特别是在偏滤器靶板上的热负荷。本练习将引导你通过平衡物理过程来构建一个简化模型，这是一个在集成建模中常用的核心方法。通过推导刮削层（SOL）的热通量宽度（$\\lambda_q$），你将实践如何从基本输运原理（垂直于磁场的扩散和沿磁场的损失）出发，估算决定聚变反应堆可行性的关键工程参数。",
            "id": "3997030",
            "problem": "一个环向轴对称的托卡马克等离子体运行在一个刮削层（SOL）由跨场扩散和平行损失主导的区域。考虑一个基于沿磁场和跨磁场能量输运第一性原理的简化SOL集成模型。假设以下稳态情景：\n\n- 从SOL磁通管中沿场移除的能量是对流性的，其特征在于平行热通量密度 $q_{\\parallel}$ 和鞘层能量传输因子 $\\gamma_{\\mathrm{sh}}$。\n- 在单电离氘等离子体中，平行声速 $c_{s}$ 服从离子声学关系。\n- 跨SOL的热量径向扩展由一个恒定的垂直热扩散系数 $\\chi_{\\perp}$ 控制。\n- 从外中平面到外偏滤器的平行连接长度 $L_{\\parallel}$ 由磁几何结构决定。\n- 偏滤器靶板的取向使得磁场的入射角等于打击点处的极向角，其中 $\\sin\\alpha = B_{p}/B$。\n\n从基本定律和经过充分检验的公式出发，通过平衡垂直扩散时间尺度与平行损失时间尺度，推导SOL热通量宽度 $\\lambda_{q}$ 的表达式，然后估算到偏滤器靶板的法向热通量。\n\n使用以下参数，这些参数都符合科学实际：\n- 环向磁场强度 $B = 2.1\\,\\mathrm{T}$。\n- 大半径 $R = 1.7\\,\\mathrm{m}$，边界安全因子 $q_{\\mathrm{sf}} = 4.5$。\n- 打击点磁通面处的小半径 $r = 0.60\\,\\mathrm{m}$。\n- 垂直热扩散系数 $\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$。\n- 平行热通量密度（上游） $q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$。\n- 边界密度 $n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$。\n- 鞘层能量传输因子 $\\gamma_{\\mathrm{sh}} = 7$。\n- 氘的离子质量 $m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$。\n\n假设：\n- 平行连接长度满足 $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$。\n- 打击点处的极向磁场满足 $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$。\n- 平行损失是对流性的，其关系为 $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$ 和 $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$。\n- SOL宽度通过将垂直扩散时间 $\\tau_{\\perp} = \\dfrac{\\lambda_{q}^{2}}{\\chi_{\\perp}}$ 与平行损失时间 $\\tau_{\\parallel} = \\dfrac{L_{\\parallel}}{c_{s}}$ 相等来设定。\n\n任务：\n1. 推导 $\\lambda_{q}$ 关于 $\\chi_{\\perp}$、 $L_{\\parallel}$、 $q_{\\parallel}$、 $\\gamma_{\\mathrm{sh}}$、 $n$ 和 $m_{i}$ 的解析表达式。\n2. 使用给定的数值，计算 $\\lambda_{q}$ 和偏滤器靶板法向热通量 $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$，其中 $\\sin\\alpha = \\dfrac{B_{p}}{B}$。\n3. 将 $\\lambda_{q}$ 以米为单位表示，将 $q_{\\mathrm{target}}$ 以 $\\mathrm{MW/m^{2}}$ 为单位表示。\n4. 将两个结果都四舍五入到三位有效数字。\n\n按照 $\\lambda_{q}$ 和 $q_{\\mathrm{target}}$ 的顺序，提供最终的两个数值结果。",
            "solution": "用户提供了一个具有科学依据、问题明确且客观的问题。这是计算聚变科学领域一个标准但简化的物理问题，并且为获得唯一解提供了所有必要的参数和定义。该问题是有效的。\n\n问题要求推导刮削层（SOL）热通量宽度（记为 $\\lambda_{q}$）的解析表达式，并对 $\\lambda_{q}$ 和到偏滤器靶板的法向热通量 $q_{\\mathrm{target}}$ 进行数值估算。\n\n推导基于平衡垂直和平行热输运的特征时间尺度。垂直输运是扩散性的，而平行输运是对流性的。\n\n热量径向扩散穿过距离 $\\lambda_{q}$ 的特征时间由下式给出：\n$$\n\\tau_{\\perp} = \\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}}\n$$\n其中 $\\chi_{\\perp}$ 是恒定的垂直热扩散系数。\n\n热量沿磁力线损失到偏滤器靶板的特征时间由下式给出：\n$$\n\\tau_{\\parallel} = \\frac{L_{\\parallel}}{c_{s}}\n$$\n其中 $L_{\\parallel}$ 是平行连接长度，$c_{s}$ 是平行声速。\n\nSOL宽度 $\\lambda_{q}$ 由这两个时间尺度相等的条件决定：\n$$\n\\tau_{\\perp} = \\tau_{\\parallel}\n$$\n代入时间尺度的表达式可得：\n$$\n\\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}} = \\frac{L_{\\parallel}}{c_{s}}\n$$\n解出 $\\lambda_{q}^{2}$：\n$$\n\\lambda_{q}^{2} = \\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}\n$$\n\n为了继续推导，我们需要一个用给定的上游等离子体参数表示声速 $c_{s}$ 的表达式。问题为单电离氘等离子体提供了两个关键关系：\n1.  平行热通量密度 $q_{\\parallel}$ 由 $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$ 给出，其中 $\\gamma_{\\mathrm{sh}}$ 是鞘层能量传输因子，$n$ 是等离子体密度，$k_{B}$ 是玻尔兹曼常数，$T$ 是温度。\n2.  离子声速由 $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$ 给出，其中 $m_{i}$ 是离子质量。\n\n我们可以从这两个方程中消去温度 $T$。从第二个方程中，我们将 $k_{B}T$ 表示为：\n$$\nk_{B}T = m_{i} c_{s}^{2}\n$$\n将这个 $k_{B}T$ 的表达式代入 $q_{\\parallel}$ 的方程中：\n$$\nq_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, (m_{i} c_{s}^{2})\\, c_{s} = \\gamma_{\\mathrm{sh}}\\, n\\, m_{i}\\, c_{s}^{3}\n$$\n现在我们可以解出声速 $c_{s}$，用 $q_{\\parallel}$、$n$、$m_{i}$ 和 $\\gamma_{\\mathrm{sh}}$ 表示：\n$$\nc_{s}^{3} = \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\implies c_{s} = \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3}\n$$\n现在，我们将这个 $c_s$ 的表达式代回到 $\\lambda_{q}^{2}$ 的方程中：\n$$\n\\lambda_{q}^{2} = \\chi_{\\perp} L_{\\parallel} \\left( \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3} \\right)^{-1} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{-1/3} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}\n$$\n取平方根，得到 $\\lambda_{q}$ 的最终解析表达式，这是第一个任务的答案：\n$$\n\\lambda_{q} = \\sqrt{\\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}}\n$$\n\n对于第二个任务，我们计算数值。首先，我们使用给定的参数计算中间量 $L_{\\parallel}$ 和 $c_{s}$：\n- 环向磁场：$B = 2.1\\,\\mathrm{T}$\n- 大半径：$R = 1.7\\,\\mathrm{m}$\n- 边界安全因子：$q_{\\mathrm{sf}} = 4.5$\n- 打击点处的小半径：$r = 0.60\\,\\mathrm{m}$\n- 垂直热扩散系数：$\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$\n- 上游平行热通量：$q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$\n- 边界密度：$n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$\n- 鞘层能量传输因子：$\\gamma_{\\mathrm{sh}} = 7$\n- 氘离子质量：$m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$\n\n平行连接长度 $L_{\\parallel}$ 由 $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$ 给出：\n$$\nL_{\\parallel} = \\pi \\times (1.7\\,\\mathrm{m}) \\times 4.5 = 7.65\\pi\\,\\mathrm{m} \\approx 24.033\\,\\mathrm{m}\n$$\n声速 $c_{s}$ 为：\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}}{7 \\times (2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}) \\times (3.345 \\times 10^{-27}\\,\\mathrm{kg})} \\right)^{1/3}\n$$\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}}{4.683 \\times 10^{-7}} \\right)^{1/3} \\mathrm{m/s} = (4.270766 \\times 10^{14})^{1/3}\\,\\mathrm{m/s} \\approx 75313.3\\,\\mathrm{m/s}\n$$\n现在我们可以计算 $\\lambda_{q}$：\n$$\n\\lambda_{q} = \\sqrt{\\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}} = \\sqrt{\\frac{(0.40\\,\\mathrm{m^{2}/s}) \\times (24.033\\,\\mathrm{m})}{75313.3\\,\\mathrm{m/s}}} = \\sqrt{1.2764 \\times 10^{-4}\\,\\mathrm{m^2}}\n$$\n$$\n\\lambda_{q} \\approx 0.011298\\,\\mathrm{m}\n$$\n四舍五入到三位有效数字，我们得到 $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$。\n\n接下来，我们计算到偏滤器靶板的法向热通量 $q_{\\mathrm{target}}$。它由 $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$ 给出，其中 $\\alpha$ 是磁场的入射角。我们已知 $\\sin\\alpha = B_{p}/B$ 和 $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$。\n因此：\n$$\n\\sin\\alpha = \\frac{1}{B} \\left( \\frac{r B}{R q_{\\mathrm{sf}}} \\right) = \\frac{r}{R q_{\\mathrm{sf}}}\n$$\n代入数值：\n$$\n\\sin\\alpha = \\frac{0.60\\,\\mathrm{m}}{(1.7\\,\\mathrm{m}) \\times 4.5} = \\frac{0.60}{7.65} \\approx 0.078431\n$$\n现在，我们可以计算 $q_{\\mathrm{target}}$：\n$$\nq_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha = (2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}) \\times 0.078431 = 1.56862 \\times 10^{7}\\,\\mathrm{W/m^{2}}\n$$\n问题要求结果以 $\\mathrm{MW/m^{2}}$ 为单位。因为 $1\\,\\mathrm{MW} = 10^{6}\\,\\mathrm{W}$：\n$$\nq_{\\mathrm{target}} = 15.6862\\,\\mathrm{MW/m^{2}}\n$$\n四舍五入到三位有效数字，我们得到 $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$。\n\n最终结果是 $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$ 和 $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.13 \\times 10^{-2}  15.7 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在成功地为等离子体边界建模后，我们转向核心区域的挑战——杂质输运。本练习模拟了在稳态条件下，扩散和对流如何共同决定堆芯等离子体中的杂质分布，这是一个典型的多物理场耦合问题。通过求解杂质密度轮廓并计算其“聚集因子”，你不仅将掌握从输运系数预测等离子体分布的技能，还将通过敏感性分析，探索不同物理机制（如湍流内向夹缩）对整体性能的影响。",
            "id": "3997063",
            "problem": "考虑一个一维（1D）磁面平均、径向对称的杂质输运近似模型，该模型应用于次半径为 $a$（单位为米）的环形磁约束装置。设 $r \\in [0,a]$ 表示径向坐标（单位为米），杂质数密度由 $n_Z(r)$ 表示，单位为 $\\mathrm{m}^{-3}$。假设核心区为无体积源的稳态连续性方程，杂质径向粒子通量由扩散和对流组合建模。具体来说，杂质径向粒子通量 $\\Gamma_Z(r)$ 由一个扩散项和一个对流项之和建模。装置核心区的净径向杂质通量被视为零。在此建模框架下，目标是计算核心区的杂质峰化因子，并评估其对杂质对流速度中由湍流引起的向内箍缩分量的灵敏度。\n\n基本建模假设：\n- 核心区无源的稳态连续性方程意味着杂质径向通量 $\\Gamma_Z(r)$ 在核心区域内是常数。\n- 杂质径向通量的本构关系是扩散和对流之和，其中扩散系数为 $D_Z(r)$（单位 $\\mathrm{m}^2/\\mathrm{s}$），对流速度为 $V_Z(r)$（单位 $\\mathrm{m}/\\mathrm{s}$）。\n\n定义与要求：\n- 核心区的杂质峰化因子应以无量纲量的形式报告。峰化因子定义为在内部核心区域 $0 \\le r \\le r_c$ 上，杂质对数密度梯度的次半径归一化、面积加权平均值，其中 $r_c = \\rho_c a$ 且 $0  \\rho_c  1$ 是归一化的核心区半径。权重采用圆柱截面积。形式上，杂质峰化因子为\n$$\n\\mathrm{PF}_{\\mathrm{core}} \\equiv - a \\,\\frac{\\int_{0}^{r_c} \\left(\\frac{1}{n_Z(r)}\\frac{d n_Z}{dr}\\right) r \\, dr}{\\int_{0}^{r_c} r \\, dr}.\n$$\n- 湍流引起的箍缩表示为对 $V_Z(r)$ 的一个附加向内（负）贡献，由一个无量纲的箍缩幅度 $C_{\\mathrm{pinch}} \\ge 0$ 进行缩放。\n- 对湍流引起的箍缩的灵敏度定义为 $\\mathrm{PF}_{\\mathrm{core}}$ 相对于 $C_{\\mathrm{pinch}}$ 的导数，通过使用小增量 $\\Delta C$ 的对称有限差分进行数值近似：\n$$\nS_{\\mathrm{pinch}} \\equiv \\frac{\\partial \\mathrm{PF}_{\\mathrm{core}}}{\\partial C_{\\mathrm{pinch}}} \\approx \\frac{\\mathrm{PF}_{\\mathrm{core}}(C_{\\mathrm{pinch}}+\\Delta C) - \\mathrm{PF}_{\\mathrm{core}}(C_{\\mathrm{pinch}}-\\Delta C)}{2\\,\\Delta C}.\n$$\n- 所有物理单位必须一致处理：$a$ 的单位是米，$r$ 的单位是米，$D_Z$ 的单位是 $\\mathrm{m}^2/\\mathrm{s}$，$V_Z$ 的单位是 $\\mathrm{m}/\\mathrm{s}$，而 $\\mathrm{PF}_{\\mathrm{core}}$ 和 $S_{\\mathrm{pinch}}$ 是无量纲的。\n\n给定的函数形式：\n- 杂质扩散系数剖面为\n$$\nD_Z(r) = D_0 \\left[1 + c_D \\left(\\frac{r}{a}\\right)^2\\right],\n$$\n其中 $D_0$ 是一个单位为 $\\mathrm{m}^2/\\mathrm{s}$ 的正常数，$c_D$ 是一个非负的无量纲形态参数。\n- 杂质对流速度是类新经典项 $V_{\\mathrm{neo}}(r)$ 和湍流诱导箍缩项 $V_{\\mathrm{turb}}(r)$ 的和：\n$$\nV_Z(r) = V_{\\mathrm{neo}}(r) + V_{\\mathrm{turb}}(r),\n$$\n其中\n$$\nV_{\\mathrm{neo}}(r) = V_{n0}\\left(\\frac{r}{a}\\right),\n\\quad\nV_{\\mathrm{turb}}(r) = - C_{\\mathrm{pinch}}\\,\\frac{D_Z(r)}{a}\\left[1 - \\left(\\frac{r}{a}\\right)^2\\right],\n$$\n其中 $V_{n0}$ 的单位是 $\\mathrm{m}/\\mathrm{s}$，$C_{\\mathrm{pinch}} \\ge 0$ 是无量纲的。\n\n核心区通量条件：\n- 在建模的核心区域内，设杂质径向通量为零。在求解杂质剖面或其梯度时，应一致地使用此条件。\n\n计算内容：\n- 对每个测试用例，使用上述定义和给定的函数形式计算 $\\mathrm{PF}_{\\mathrm{core}}$，并使用指定的 $\\Delta C$ 通过对称有限差分计算 $S_{\\mathrm{pinch}}$。\n\n数值方法要求：\n- 将核心区半径表示为 $r_c = \\rho_c a$。\n- 在 $\\mathrm{PF}_{\\mathrm{core}}$ 的平均积分中，使用与 $r$ 成正比的面积权重。\n- 在 $r \\in [0,r_c]$ 或归一化坐标 $\\rho \\equiv r/a \\in [0,\\rho_c]$ 上使用足够精细的数值积分。\n\n测试组：\n- 使用以下参数集。每个案例指定了 $(a, \\rho_c, D_0, c_D, V_{n0}, C_{\\mathrm{pinch}}, \\Delta C)$。\n    - 案例1（理想情况，中等向内箍缩）：$a = 0.5\\,\\mathrm{m}$，$\\rho_c = 0.2$，$D_0 = 0.3\\,\\mathrm{m}^2/\\mathrm{s}$，$c_D = 0.2$，$V_{n0} = 0.3\\,\\mathrm{m}/\\mathrm{s}$，$C_{\\mathrm{pinch}} = 0.5$，$\\Delta C = 0.05$。\n    - 案例2（无箍缩基线）：$a = 0.5\\,\\mathrm{m}$，$\\rho_c = 0.2$，$D_0 = 0.3\\,\\mathrm{m}^2/\\mathrm{s}$，$c_D = 0.2$，$V_{n0} = 0.3\\,\\mathrm{m}/\\mathrm{s}$，$C_{\\mathrm{pinch}} = 0.0$，$\\Delta C = 0.05$。\n    - 案例3（强向内箍缩）：$a = 0.5\\,\\mathrm{m}$，$\\rho_c = 0.2$，$D_0 = 0.3\\,\\mathrm{m}^2/\\mathrm{s}$，$c_D = 0.2$，$V_{n0} = 0.3\\,\\mathrm{m}/\\mathrm{s}$，$C_{\\mathrm{pinch}} = 1.0$，$\\Delta C = 0.05$。\n    - 案例4（边界情况：零对流，无箍缩）：$a = 0.5\\,\\mathrm{m}$，$\\rho_c = 0.2$，$D_0 = 0.3\\,\\mathrm{m}^2/\\mathrm{s}$，$c_D = 0.2$，$V_{n0} = 0.0\\,\\mathrm{m}/\\mathrm{s}$，$C_{\\mathrm{pinch}} = 0.0$，$\\Delta C = 0.05$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于每个测试用例，输出两个浮点数：首先是 $\\mathrm{PF}_{\\mathrm{core}}$，然后是 $S_{\\mathrm{pinch}}$。最终输出必须按以下顺序排列\n$$\n[\\mathrm{PF}_1, S_1, \\mathrm{PF}_2, S_2, \\mathrm{PF}_3, S_3, \\mathrm{PF}_4, S_4],\n$$\n其中 $\\mathrm{PF}_i$ 和 $S_i$ 对应于案例 $i$。",
            "solution": "该问题被评估为有效的，因为它是基于科学的、适定的和客观的。它提出了一个聚变等离子体中杂质输运的标准（尽管简化了）模型，该模型是可形式化和可解的。所有必要的数据和定义都已提供，并且没有内部矛盾。\n\n解决方案首先为目标量，即核心杂质峰化因子 $\\mathrm{PF}_{\\mathrm{core}}$，推导出一个解析表达式。这种方法优于纯数值方法，因为它在模型内部提供了精确解，从而消除了数值积分误差。\n\n核心指导原则是稳态、无源的连续性方程，在给定条件下，这意味着核心区域（即 $r \\in [0, r_c]$）内的杂质径向粒子通量为零，即 $\\Gamma_Z(r) = 0$。通量的本构关系如下：\n$$\n\\Gamma_Z(r) = -D_Z(r) \\frac{d n_Z}{dr} + V_Z(r) n_Z(r)\n$$\n令 $\\Gamma_Z(r) = 0$ 使我们能够解出对数密度梯度，这是峰化因子定义的关键组成部分：\n$$\n\\frac{1}{n_Z(r)}\\frac{d n_Z}{dr} = \\frac{V_Z(r)}{D_Z(r)}\n$$\n问题给出了扩散系数 $D_Z(r)$ 和对流速度 $V_Z(r)$ 的函数形式。代入这些形式可得到作为半径 $r$ 函数的对数梯度：\n$$\n\\frac{1}{n_Z(r)}\\frac{d n_Z}{dr} = \\frac{V_{\\mathrm{neo}}(r) + V_{\\mathrm{turb}}(r)}{D_Z(r)} = \\frac{V_{n0}\\left(\\frac{r}{a}\\right)}{D_0 \\left[1 + c_D \\left(\\frac{r}{a}\\right)^2\\right]} + \\frac{- C_{\\mathrm{pinch}}\\,\\frac{D_Z(r)}{a}\\left[1 - \\left(\\frac{r}{a}\\right)^2\\right]}{D_Z(r)}\n$$\n这可简化为：\n$$\n\\frac{1}{n_Z(r)}\\frac{d n_Z}{dr} = \\frac{V_{n0}}{D_0} \\frac{r/a}{1 + c_D (r/a)^2} - \\frac{C_{\\mathrm{pinch}}}{a}\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)\n$$\n核心杂质峰化因子 $\\mathrm{PF}_{\\mathrm{core}}$ 定义为该梯度在核心区域 $r \\in [0, r_c]$ 上的面积加权平均值：\n$$\n\\mathrm{PF}_{\\mathrm{core}} \\equiv - a \\,\\frac{\\int_{0}^{r_c} \\left(\\frac{1}{n_Z(r)}\\frac{d n_Z}{dr}\\right) r \\, dr}{\\int_{0}^{r_c} r \\, dr}\n$$\n分母是一个简单的积分：$\\int_{0}^{r_c} r \\, dr = \\frac{r_c^2}{2}$。我们将对数梯度的表达式代入分子。为便于积分，我们引入归一化径向坐标 $\\rho = r/a$，核心区边界为 $\\rho_c = r_c/a$。通过这个变量替换（$r = a\\rho$, $dr = a\\,d\\rho$），峰化因子变为：\n$$\n\\mathrm{PF}_{\\mathrm{core}} = - a \\frac{2}{(a\\rho_c)^2} \\int_{0}^{\\rho_c} \\left[ \\frac{V_{n0}}{D_0} \\frac{\\rho}{1+c_D\\rho^2} - \\frac{C_{\\mathrm{pinch}}}{a}(1-\\rho^2) \\right] (a\\rho) (a\\,d\\rho)\n$$\n经过代数简化，表达式分为两项，分别对应于新经典输运和湍流输运的贡献：\n$$\n\\mathrm{PF}_{\\mathrm{core}} = -\\frac{2a V_{n0}}{D_0 \\rho_c^2} \\int_{0}^{\\rho_c} \\frac{\\rho^2}{1+c_D\\rho^2} \\,d\\rho + \\frac{2 C_{\\mathrm{pinch}}}{\\rho_c^2} \\int_{0}^{\\rho_c} (\\rho-\\rho^3) \\,d\\rho\n$$\n我们将这两个积分定义为 $I_1$ 和 $I_2$：\n$$\nI_1 = \\int_{0}^{\\rho_c} \\frac{\\rho^2}{1+c_D\\rho^2} \\,d\\rho \\quad \\text{and} \\quad I_2 = \\int_{0}^{\\rho_c} (\\rho-\\rho^3) \\,d\\rho\n$$\n这些定积分可以解析求解。\n对于 $I_2$：\n$$\nI_2 = \\left[ \\frac{\\rho^2}{2} - \\frac{\\rho^4}{4} \\right]_0^{\\rho_c} = \\frac{\\rho_c^2}{2} - \\frac{\\rho_c^4}{4}\n$$\n对于 $I_1$，我们首先考虑 $c_D  0$：\n$$\nI_1 = \\int_{0}^{\\rho_c} \\frac{1}{c_D}\\left(1 - \\frac{1}{1+c_D\\rho^2}\\right) d\\rho = \\frac{1}{c_D} \\left[\\rho - \\frac{1}{\\sqrt{c_D}}\\arctan(\\sqrt{c_D}\\rho)\\right]_0^{\\rho_c} = \\frac{1}{c_D}\\left(\\rho_c - \\frac{\\arctan(\\sqrt{c_D}\\rho_c)}{\\sqrt{c_D}}\\right)\n$$\n在 $c_D = 0$ 的特殊情况下，积分简化为 $I_1 = \\int_0^{\\rho_c} \\rho^2 d\\rho = \\rho_c^3/3$。\n综合这些结果，峰化因子的解析表达式为：\n$$\n\\mathrm{PF}_{\\mathrm{core}} = -\\frac{2a V_{n0}}{D_0 \\rho_c^2} I_1 + \\frac{2 C_{\\mathrm{pinch}}}{\\rho_c^2} I_2\n$$\n该公式被实现用来计算 $\\mathrm{PF}_{\\mathrm{core}}$。\n\n灵敏度 $S_{\\mathrm{pinch}}$ 使用给定的对称有限差分公式进行数值计算：\n$$\nS_{\\mathrm{pinch}} = \\frac{\\mathrm{PF}_{\\mathrm{core}}(C_{\\mathrm{pinch}}+\\Delta C) - \\mathrm{PF}_{\\mathrm{core}}(C_{\\mathrm{pinch}}-\\Delta C)}{2\\,\\Delta C}\n$$\n这需要计算在 $C_{\\mathrm{pinch}} + \\Delta C$ 和 $C_{\\mathrm{pinch}} - \\Delta C$ 处的峰化因子。由于 $\\mathrm{PF}_{\\mathrm{core}}$ 是 $C_{\\mathrm{pinch}}$ 的线性函数，该数值导数将是精确的，并等于解析导数 $\\partial \\mathrm{PF}_{\\mathrm{core}}/\\partial C_{\\mathrm{pinch}} = \\frac{2 I_2}{\\rho_c^2} = 1 - \\frac{\\rho_c^2}{2}$。对于所有 $\\rho_c = 0.2$ 的测试用例，灵敏度预计为 $1 - 0.2^2/2 = 0.98$。\n\n最终的 Python 代码在一个函数中实现了这些解析公式，该函数被每个测试用例调用以计算 $\\mathrm{PF}_{\\mathrm{core}}$ 和 $S_{\\mathrm{pinch}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the impurity transport problem for a suite of test cases.\n    \"\"\"\n\n    # Test suite: (a, rho_c, D0, cD, Vn0, C_pinch, delta_C)\n    test_cases = [\n        # Case 1 (happy path, moderate inward pinch)\n        (0.5, 0.2, 0.3, 0.2, 0.3, 0.5, 0.05),\n        # Case 2 (no pinch baseline)\n        (0.5, 0.2, 0.3, 0.2, 0.3, 0.0, 0.05),\n        # Case 3 (strong inward pinch)\n        (0.5, 0.2, 0.3, 0.2, 0.3, 1.0, 0.05),\n        # Case 4 (edge case: zero convection, no pinch)\n        (0.5, 0.2, 0.3, 0.2, 0.0, 0.0, 0.05),\n    ]\n\n    results = []\n\n    def _calculate_pf_core(params):\n        \"\"\"\n        Calculates the core impurity peaking factor based on derived analytical solution.\n        \n        Args:\n            params (tuple): A tuple containing the physical parameters:\n                            (a, rhoc, D0, cD, Vn0, C_pinch)\n        \n        Returns:\n            float: The dimensionless core impurity peaking factor PF_core.\n        \"\"\"\n        a, rhoc, D0, cD, Vn0, C_pinch = params\n\n        # Integral I1: term related to neoclassical convection\n        if cD == 0.0:\n            # Special case for constant diffusion coefficient\n            I1 = rhoc**3 / 3.0\n        else:\n            # General case for radially varying diffusion coefficient\n            sqrt_cD = np.sqrt(cD)\n            I1 = (1.0 / cD) * (rhoc - (1.0 / sqrt_cD) * np.arctan(sqrt_cD * rhoc))\n\n        # Integral I2: term related to turbulent pinch\n        I2 = rhoc**2 / 2.0 - rhoc**4 / 4.0\n\n        # Contribution from the neoclassical term\n        # The problem states D0 is a positive constant, so no check for D0=0 needed for test cases.\n        term_neo = - (2.0 * a * Vn0) / (D0 * rhoc**2) * I1\n        \n        # Contribution from the turbulent pinch term\n        term_turb = (2.0 * C_pinch) / (rhoc**2) * I2\n\n        pf_core = term_neo + term_turb\n        return pf_core\n\n    for case in test_cases:\n        a, rhoc, D0, cD, Vn0, C_pinch, delta_C = case\n\n        # Calculate PF_core for the nominal C_pinch\n        params_nom = (a, rhoc, D0, cD, Vn0, C_pinch)\n        pf = _calculate_pf_core(params_nom)\n        \n        # Calculate PF_core for C_pinch + delta_C\n        params_plus = (a, rhoc, D0, cD, Vn0, C_pinch + delta_C)\n        pf_plus = _calculate_pf_core(params_plus)\n\n        # Calculate PF_core for C_pinch - delta_C\n        params_minus = (a, rhoc, D0, cD, Vn0, C_pinch - delta_C)\n        pf_minus = _calculate_pf_core(params_minus)\n        \n        # Calculate sensitivity S_pinch using symmetric finite difference\n        S_pinch = (pf_plus - pf_minus) / (2.0 * delta_C)\n        \n        results.extend([pf, S_pinch])\n\n    # Final print statement in the exact required format.\n    # Use f-string with general format 'g' to avoid trailing zeros and use scientific notation if needed.\n    print(f\"[{','.join(f'{r:g}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "集成建模代码的可靠性取决于其数值引擎的准确性。本练习将带你深入计算科学的核心，使用“人造解方法”（Method of Manufactured Solutions）来严格验证输运方程求解器的正确性。你将为同一个平流-扩散方程实现显式和隐式两种时间积分方案，并分析它们的收敛速度与数值稳定性。这项实践对于培养建立和评判复杂模拟工具的严谨性至关重要，确保了物理模型的计算实现是可信的。",
            "id": "3997077",
            "problem": "考虑一维、守恒的平流-扩散模型，用于描述一个归一化标量场 $u(x,t)$，该标量场代表了聚变等离子体集成建模中的一个输运通道，其定义在周期性域 $x \\in [0,1)$ 上，并使用无量纲单位。控制方程为\n$$\n\\partial_t u(x,t) \\;=\\; \\partial_x\\big( D(x)\\,\\partial_x u(x,t) \\big) \\;-\\; \\partial_x\\big( v(x)\\,u(x,t) \\big) \\;+\\; S(x,t),\n$$\n其中 $D(x)$ 是一个空间变化的扩散系数，$v(x)$ 是一个空间变化的平流速度场。通量表示为 $\\Gamma(x,t) = -D(x)\\,\\partial_x u(x,t) + v(x)\\,u(x,t)$，这与守恒律 $\\partial_t u + \\partial_x \\Gamma = S$ 一致。\n\n你将使用人造解法（method of manufactured solutions）。设精确解为\n$$\nu_{\\text{exact}}(x,t) \\;=\\; \\sin(2\\pi x)\\,e^{-t},\n$$\n其边界条件为周期性边界条件，初始条件为 $u(x,0) = \\sin(2\\pi x)$。定义系数\n$$\nD(x) \\;=\\; D_0\\left[1 + \\tfrac{1}{2}\\sin(2\\pi x)\\right], \\qquad v(x) \\;=\\; v_0\\,\\cos(2\\pi x),\n$$\n并选择源项 $S(x,t)$ 使得 $u_{\\text{exact}}(x,t)$ 满足该偏微分方程。使用 $\\partial_x\\big(D(x)\\,\\partial_x u\\big) = D_x(x)\\,\\partial_x u + D(x)\\,\\partial_{xx}u$ 和 $\\partial_x\\big(v(x)\\,u\\big) = v_x(x)\\,u + v(x)\\,\\partial_x u$，所需源项为\n$$\nS(x,t) \\;=\\; \\partial_t u_{\\text{exact}} \\;-\\; \\partial_x\\big( D\\,\\partial_x u_{\\text{exact}}\\big) \\;+\\; \\partial_x\\big( v\\,u_{\\text{exact}}\\big).\n$$\n\n在 $[0,1)$ 上使用包含 $N$ 个单元的均匀网格对空间进行离散，网格间距为 $\\Delta x = 1/N$，并采用周期性边界条件。使用一种守恒的、类有限体积法的空间离散格式：\n- 扩散项 $\\partial_x\\big( D\\,\\partial_x u\\big)$ 通过对 $D$ 进行面心算术平均和对 $\\partial_x u$ 使用中心差分来进行离散，即使用 $D_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\big(D_i + D_{i+1}\\big)$ 和 $(u_{i+1}-u_i)/\\Delta x$。\n- 平流项 $\\partial_x\\big( v\\,u\\big)$ 通过基于 $v_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\big(v_i + v_{i+1}\\big)$ 符号的面上的迎风通量来进行离散。\n\n实现两种时间积分方案：\n1. 显式向前欧拉法（方案 E）：$u^{n+1} = u^n + \\Delta t \\left[ \\mathcal{L}_D(u^n) - \\mathcal{L}_A(u^n) + S(\\cdot, t^n) \\right]$，其中 $\\mathcal{L}_D$ 和 $\\mathcal{L}_A$ 分别是离散的扩散和对流算子，$S(\\cdot, t)$ 在当前时间进行计算。\n2. 隐式向后欧拉法（方案 I）：$u^{n+1}$ 求解 $u^{n+1} - \\Delta t\\left[ \\mathcal{L}_D(u^{n+1}) - \\mathcal{L}_A(u^{n+1}) \\right] = u^n + \\Delta t\\,S(\\cdot, t^{n+1})$，其中相同的空间算子在新时间步进行计算。\n\n对于每种方案，将解从 $t=0$ 推进到最终时间 $T$，并使用离散 $L^2$ 范数计算在 $t=T$ 时与 $u_{\\text{exact}}(x,T)$ 的误差：\n$$\n\\|e\\|_2 \\;=\\; \\left(\\Delta x \\sum_{i=0}^{N-1} \\big(u_i(T) - u_{\\text{exact}}(x_i,T)\\big)^2\\right)^{1/2}.\n$$\n\n时间收敛率估计：对每个测试用例使用固定的空间网格（如下文指定），计算三种递减时间步长 $\\Delta t_1 = T/40$、$\\Delta t_2 = T/80$ 和 $\\Delta t_3 = T/160$ 下的误差。对于每种方案，通过对三种 $\\Delta t$ 值下的 $\\log \\|e\\|_2$ 与 $\\log \\Delta t$ 进行线性回归，估算经验性时间收敛率 $r$，即最佳拟合线的斜率。\n\n库朗-弗里德里希-列维（Courant–Friedrichs–Lewy, CFL）约束：对于显式方案，根据网格上的最大系数计算稳定性限制的时间步长，\n$$\n\\Delta t_{\\text{diff}} \\;=\\; \\frac{\\Delta x^2}{2\\,\\max_i D_i}, \\qquad \\Delta t_{\\text{adv}} \\;=\\; \\frac{\\Delta x}{\\max_i |v_i|},\n$$\n并报告 $\\Delta t_{\\max,\\text{E}} = \\min\\big(\\Delta t_{\\text{diff}},\\,\\Delta t_{\\text{adv}}\\big)$。对于采用时间上向后欧拉法和空间上迎风格式的隐式方案，报告一个有效的不受约束的稳定性极限，其十进制值为 $10^9$，即 $\\Delta t_{\\max,\\text{I}}$。\n\n所有量均被视为无量纲数。\n\n测试套件：在以下三个参数集上运行你的程序，每个参数集定义为 $(D_0, v_0, N, T)$：\n- 案例 A（平衡输运）：$(10^{-3},\\, 0.5,\\, 256,\\, 0.1)$。\n- 案例 B（平流主导）：$(10^{-5},\\, 1.0,\\, 256,\\, 0.1)$。\n- 案例 C（扩散主导）：$(7.5\\times 10^{-3},\\, 0.0,\\, 128,\\, 0.1)$。\n\n对于每个案例，计算：\n- 方案 E 的时间收敛率 $r_{\\text{E}}$。\n- 方案 I 的时间收敛率 $r_{\\text{I}}$。\n- 显式 CFL 最大时间步长 $\\Delta t_{\\max,\\text{E}}$。\n- 隐式报告的稳定性极限 $\\Delta t_{\\max,\\text{I}} = 10^9$。\n\n最终输出格式：你的程序应生成一行输出，其中包含结果，格式为列表的列表，每个子列表对应一个测试用例，每个子列表中的顺序为 $[r_{\\text{E}},\\, r_{\\text{I}},\\, \\Delta t_{\\max,\\text{E}},\\, \\Delta t_{\\max,\\text{I}}]$。例如，输出应如下所示：\n$$\n\\big[ [r_{\\text{E,A}}, r_{\\text{I,A}}, \\Delta t_{\\max,\\text{E,A}}, \\Delta t_{\\max,\\text{I,A}}], [r_{\\text{E,B}}, r_{\\text{I,B}}, \\Delta t_{\\max,\\text{E,B}}, \\Delta t_{\\max,\\text{I,B}}], [r_{\\text{E,C}}, r_{\\text{I,C}}, \\Delta t_{\\max,\\text{E,C}}, \\Delta t_{\\max,\\text{I,C}}] \\big],\n$$\n以 Python 列表语法和十进制数的形式打印。",
            "solution": "用户在计算物理领域提供了一个定义明确的问题，具体涉及平流-扩散方程的数值解。该问题将使用人造解法来解决，以验证两种不同时间积分方案的实现。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n*   **控制方程**：一维平流-扩散方程 $\\partial_t u(x,t) = \\partial_x( D(x)\\,\\partial_x u(x,t) ) - \\partial_x( v(x)\\,u(x,t) ) + S(x,t)$，定义在周期性域 $x \\in [0,1)$ 上。\n*   **通量表示**：$\\Gamma(x,t) = -D(x)\\,\\partial_x u(x,t) + v(x)\\,u(x,t)$。\n*   **人造解**：$u_{\\text{exact}}(x,t) = \\sin(2\\pi x)\\,e^{-t}$。\n*   **初始条件**：$u(x,0) = \\sin(2\\pi x)$。\n*   **系数**：$D(x) = D_0[1 + \\tfrac{1}{2}\\sin(2\\pi x)]$ 和 $v(x) = v_0\\,\\cos(2\\pi x)$。\n*   **源项**：$S(x,t)$ 的定义使得 $u_{\\text{exact}}$ 是一个解：$S(x,t) = \\partial_t u_{\\text{exact}} - \\partial_x( D\\,\\partial_x u_{\\text{exact}}) + \\partial_x( v\\,u_{\\text{exact}})$。\n*   **空间离散**：具有 $N$ 个单元的均匀网格，间距 $\\Delta x = 1/N$。守恒的类有限体积法。扩散项对 $D$ 使用面心算术平均。平流项使用基于面心速度 $v_{i+\\frac{1}{2}} = \\tfrac{1}{2}(v_i + v_{i+1})$ 的迎风通量。\n*   **时间积分方案**：\n    1.  显式向前欧拉法（方案 E）。\n    2.  隐式向后欧拉法（方案 I）。\n*   **误差度量**：离散 $L^2$ 范数，$\\|e\\|_2 = (\\Delta x \\sum_{i=0}^{N-1} (u_i(T) - u_{\\text{exact}}(x_i,T))^2)^{1/2}$。\n*   **收敛率分析**：通过对 $\\log \\|e\\|_2$ 与 $\\log \\Delta t$ 进行线性回归来估算时间收敛率 $r$，其中 $\\Delta t \\in \\{T/40, T/80, T/160\\}$。\n*   **CFL 时间步长**：$\\Delta t_{\\text{diff}} = \\frac{\\Delta x^2}{2\\,\\max_i D_i}$，$\\Delta t_{\\text{adv}} = \\frac{\\Delta x}{\\max_i |v_i|}$，$\\Delta t_{\\max,\\text{E}} = \\min(\\Delta t_{\\text{diff}},\\,\\Delta t_{\\text{adv}})$，以及 $\\Delta t_{\\max,\\text{I}} = 10^9$。\n*   **测试用例**：\n    *   A: $(D_0, v_0, N, T) = (10^{-3}, 0.5, 256, 0.1)$。\n    *   B: $(D_0, v_0, N, T) = (10^{-5}, 1.0, 256, 0.1)$。\n    *   C: $(D_0, v_0, N, T) = (7.5 \\times 10^{-3}, 0.0, 128, 0.1)$。\n*   **输出格式**：一个 Python 列表的列表，形式为 $[[r_{\\text{E,A}}, r_{\\text{I,A}}, \\Delta t_{\\max,\\text{E,A}}, \\Delta t_{\\max,\\text{I,A}}], \\dots]$。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n该问题在科学和数学上是合理的。它涉及计算科学和工程中使用的标准模型和数值方法。\n*   **科学依据**：平流-扩散方程是输运现象的基本模型。人造解法是一种标准的代码验证技术。有限体积法、欧拉时间步进方案、迎风格式和 CFL 稳定性条件都是偏微分方程数值分析中的经典概念。\n*   **适定性**：具有周期性边界条件和光滑初始条件的偏微分方程是适定的。人造解法保证了解的存在性。数值问题结构良好，隐式方案会产生一个可逆的线性系统。\n*   **客观性**：问题的所有方面都经过数学上的精确定义。没有歧义或依赖于主观解释。\n*   问题是自洽的，没有缺失或矛盾的信息。它在计算上是可行的且并非微不足道。\n\n**第 3 步：结论与行动**\n\n问题陈述是有效的。将提供一个解决方案。\n\n### 基于原理的解决方案设计\n\n解决方案需要为给定的平流-扩散方程实现一个数值模拟。核心步骤是推导解析源项，在空间和时间上离散控制方程，实现数值方案，并执行指定的误差分析。\n\n**1. 解析源项推导**\n\n为使用人造解法，我们将 $u_{\\text{exact}}(x,t) = \\sin(2\\pi x) e^{-t}$ 代入偏微分方程以求得所需的源项 $S(x,t)$。\n\n首先，我们计算 $u_{\\text{exact}}$ 的必要导数：\n$$\n\\partial_t u_{\\text{exact}} = -\\sin(2\\pi x) e^{-t}\n$$\n$$\n\\partial_x u_{\\text{exact}} = 2\\pi \\cos(2\\pi x) e^{-t}\n$$\n\n接下来，我们用精确解计算扩散通量和平流通量的散度。\n扩散通量项为 $\\partial_x(D(x)\\,\\partial_x u_{\\text{exact}})$：\n$$\n\\partial_x \\left( D_0\\left[1 + \\tfrac{1}{2}\\sin(2\\pi x)\\right] 2\\pi \\cos(2\\pi x) e^{-t} \\right) = 2\\pi D_0 e^{-t} \\partial_x \\left( \\cos(2\\pi x) + \\tfrac{1}{4}\\sin(4\\pi x) \\right)\n$$\n$$\n= 2\\pi D_0 e^{-t} \\left( -2\\pi \\sin(2\\pi x) + \\pi \\cos(4\\pi x) \\right) = 2\\pi^2 D_0 e^{-t} \\left( \\cos(4\\pi x) - 2\\sin(2\\pi x) \\right)\n$$\n平流通量项为 $\\partial_x(v(x)\\,u_{\\text{exact}})$：\n$$\n\\partial_x \\left( v_0 \\cos(2\\pi x) \\sin(2\\pi x) e^{-t} \\right) = v_0 e^{-t} \\partial_x \\left( \\tfrac{1}{2}\\sin(4\\pi x) \\right)\n$$\n$$\n= v_0 e^{-t} \\left( \\tfrac{1}{2} \\cdot 4\\pi \\cos(4\\pi x) \\right) = 2\\pi v_0 e^{-t} \\cos(4\\pi x)\n$$\n源项为 $S = \\partial_t u_{\\text{exact}} - \\partial_x(D\\,\\partial_x u_{\\text{exact}}) + \\partial_x(v\\,u_{\\text{exact}})$：\n$$\nS(x,t) = e^{-t} \\left[ -\\sin(2\\pi x) - 2\\pi^2 D_0 (\\cos(4\\pi x) - 2\\sin(2\\pi x)) + 2\\pi v_0 \\cos(4\\pi x) \\right]\n$$\n合并各项，我们得到简化后的表达式：\n$$\nS(x,t) = e^{-t} \\left[ (4\\pi^2 D_0 - 1)\\sin(2\\pi x) + (2\\pi v_0 - 2\\pi^2 D_0)\\cos(4\\pi x) \\right]\n$$\n\n**2. 空间离散**\n\n我们在均匀网格 $x_i = i\\Delta x$（对于 $i = 0, \\dots, N-1$，单元宽度 $\\Delta x = 1/N$）上使用有限体积法。在单元 $i$ 处的半离散方程为：\n$$\n\\frac{du_i}{dt} = \\mathcal{L}_D(u)_i - \\mathcal{L}_A(u)_i + S_i(t)\n$$\n其中 $\\mathcal{L}_D$ 和 $\\mathcal{L}_A$ 分别是扩散和对流的离散算子。\n\n扩散算子 $\\mathcal{L}_D(u)_i$ 由下式给出：\n$$\n\\mathcal{L}_D(u)_i = \\frac{1}{\\Delta x} \\left( \\Gamma_{D, i+\\frac{1}{2}} - \\Gamma_{D, i-\\frac{1}{2}} \\right) = \\frac{1}{\\Delta x} \\left( D_{i+\\frac{1}{2}}\\frac{u_{i+1}-u_i}{\\Delta x} - D_{i-\\frac{1}{2}}\\frac{u_i-u_{i-1}}{\\Delta x} \\right)\n$$\n其中 $D_{i\\pm\\frac{1}{2}} = \\frac{1}{2}(D_i + D_{i\\pm1})$。\n\n平流算子 $\\mathcal{L}_A(u)_i$ 由下式给出：\n$$\n\\mathcal{L}_A(u)_i = \\frac{1}{\\Delta x} \\left( \\Gamma_{A, i+\\frac{1}{2}} - \\Gamma_{A, i-\\frac{1}{2}} \\right)\n$$\n其中，在面 $i+\\frac{1}{2}$ 处的通量由迎风格式定义：\n$$\n\\Gamma_{A, i+\\frac{1}{2}} = v_{i+\\frac{1}{2}} u_i \\text{ if } v_{i+\\frac{1}{2}} \\ge 0, \\quad \\text{and} \\quad \\Gamma_{A, i+\\frac{1}{2}} = v_{i+\\frac{1}{2}} u_{i+1} \\text{ if } v_{i+\\frac{1}{2}}  0\n$$\n其中 $v_{i+\\frac{1}{2}} = \\frac{1}{2}(v_i + v_{i+1})$。周期性意味着对于 $i=N-1$，$i+1$ 映射到 $0$；对于 $i=0$，$i-1$ 映射到 $N-1$。\n\n**3. 时间积分**\n\n*   **显式向前欧拉法（方案 E）**：这是一个显式一阶方案。更新规则是：\n    $$\n    u^{n+1}_i = u^n_i + \\Delta t \\left[ \\mathcal{L}_D(u^n)_i - \\mathcal{L}_A(u^n)_i + S(x_i, t^n) \\right]\n    $$\n    该方案是有条件稳定的，受 CFL 条件限制。\n\n*   **隐式向后欧拉法（方案 I）**：这是一个隐式一阶方案。其更新规则要求在每个时间步求解一个线性系统：\n    $$\n    u^{n+1}_i - \\Delta t \\left[ \\mathcal{L}_D(u^{n+1})_i - \\mathcal{L}_A(u^{n+1})_i \\right] = u^n_i + \\Delta t S(x_i, t^{n+1})\n    $$\n    这可以写成矩阵形式 $(I - \\Delta t(\\mathbf{L}_D - \\mathbf{L}_A)) \\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\mathbf{S}^{n+1}$，其中 $\\mathbf{L}_D$ 和 $\\mathbf{L}_A$ 是离散空间算子的矩阵表示。对于此问题，该方案是无条件稳定的。\n\n**4. 实现策略**\n\n将开发一个 Python 脚本来自动化整个过程。\n*   **解析项函数**：辅助函数将用于计算 $u_{\\text{exact}}(x,t)$、$D(x)$、$v(x)$ 和 $S(x,t)$。\n*   **数值算子**：\n    *   对于显式方案，一个名为 `apply_rhs` 的函数将使用向量化的 `numpy` 操作和用于周期性边界的 `np.roll` 来高效计算半离散方程的整个右侧。\n    *   对于隐式方案，一个函数将构建表示离散算子的稠密矩阵 $\\mathbf{L}_D$ 和 $\\mathbf{L}_A$。然后形成系统矩阵 $\\mathbf{M} = I - \\Delta t(\\mathbf{L}_D - \\mathbf{L}_A)$，并使用 `numpy.linalg.solve` 求解线性系统。\n*   **模拟循环**：一个核心函数将针对给定的方案和时间步长 $\\Delta t$ 运行模拟，从 $t=0$ 推进到 $t=T$。\n*   **分析工作流**：对于每个测试用例，脚本将首先计算稳定性极限 $\\Delta t_{\\max,\\text{E}}$ 和 $\\Delta t_{\\max,\\text{I}}$。然后，对于每个方案（E 和 I），它将遍历指定的 $\\Delta t$ 值，运行模拟，计算最终的 $L^2$ 误差，并存储结果。最后，它使用 `numpy.polyfit` 对误差和时间步长的对数进行处理，以找到斜率，即经验收敛率 $r$。所有案例的最终结果将被收集并按指定格式打印。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D advection-diffusion problem using the method of manufactured solutions\n    to find temporal convergence rates for explicit and implicit Euler schemes.\n    \"\"\"\n    _2pi = 2.0 * np.pi\n    _4pi = 4.0 * np.pi\n\n    def u_exact(x, t):\n        \"\"\"Analytical solution u(x,t).\"\"\"\n        return np.sin(_2pi * x) * np.exp(-t)\n\n    def D_func(x, D0):\n        \"\"\"Diffusion coefficient D(x).\"\"\"\n        return D0 * (1.0 + 0.5 * np.sin(_2pi * x))\n\n    def v_func(x, v0):\n        \"\"\"Advection velocity v(x).\"\"\"\n        return v0 * np.cos(_2pi * x)\n\n    def S_func(x, t, D0, v0):\n        \"\"\"Analytical source term S(x,t).\"\"\"\n        term1 = (4.0 * np.pi**2 * D0 - 1.0) * np.sin(_2pi * x)\n        term2 = (2.0 * np.pi * v0 - 2.0 * np.pi**2 * D0) * np.cos(_4pi * x)\n        return np.exp(-t) * (term1 + term2)\n\n    def apply_rhs(u, t, x, dx, N, D0, v0):\n        \"\"\"Computes the RHS for the explicit Euler method.\"\"\"\n        # Vectorized array setup with periodic boundaries\n        u_p1 = np.roll(u, -1)\n        u_m1 = np.roll(u, 1)\n\n        # Diffusion term\n        D_vec = D_func(x, D0)\n        D_p1 = np.roll(D_vec, -1)\n        D_face_p = 0.5 * (D_vec + D_p1)\n        D_face_m = np.roll(D_face_p, 1)\n        flux_diff_p = D_face_p * (u_p1 - u) / dx\n        flux_diff_m = D_face_m * (u - u_m1) / dx\n        Lu_D = (flux_diff_p - flux_diff_m) / dx\n\n        # Advection term\n        v_vec = v_func(x, v0)\n        v_p1 = np.roll(v_vec, -1)\n        v_face_p = 0.5 * (v_vec + v_p1)\n        flux_adv_p = np.where(v_face_p >= 0, v_face_p * u, v_face_p * u_p1)\n        flux_adv_m = np.roll(flux_adv_p, 1)\n        Lu_A = (flux_adv_p - flux_adv_m) / dx\n        \n        # Source term\n        S_vec = S_func(x, t, D0, v0)\n\n        return Lu_D - Lu_A + S_vec\n\n    def build_operator_matrices(x, dx, N, D0, v0):\n        \"\"\"Builds the dense matrices for the spatial operators L_D and L_A.\"\"\"\n        # Diffusion matrix L_D\n        D_vec = D_func(x, D0)\n        D_p1 = np.roll(D_vec, -1)\n        D_face_p = 0.5 * (D_vec + D_p1)\n        D_face_m = np.roll(D_face_p, 1)\n        \n        diag_D = -(D_face_p + D_face_m) / dx**2\n        sub_diag_D = D_face_m / dx**2\n        sup_diag_D = D_face_p / dx**2\n        \n        L_D = np.diag(diag_D) + np.diag(sub_diag_D[1:], k=-1) + np.diag(sup_diag_D[:-1], k=1)\n        L_D[0, N-1] = sub_diag_D[0]\n        L_D[N-1, 0] = sup_diag_D[N-1]\n\n        # Advection matrix L_A\n        v_vec = v_func(x, v0)\n        v_p1 = np.roll(v_vec, -1)\n        v_face_p = 0.5 * (v_vec + v_p1)\n\n        v_plus = np.maximum(v_face_p, 0)\n        v_minus = np.minimum(v_face_p, 0)\n        v_plus_m = np.roll(v_plus, 1)\n        v_minus_m = np.roll(v_minus, 1)\n        \n        diag_A = (v_plus - v_minus_m) / dx\n        sub_diag_A = -v_plus_m / dx\n        sup_diag_A = v_minus / dx\n        \n        L_A = np.diag(diag_A) + np.diag(sub_diag_A[1:], k=-1) + np.diag(sup_diag_A[:-1], k=1)\n        L_A[0, N-1] = sub_diag_A[0]\n        L_A[N-1, 0] = sup_diag_A[N-1]\n\n        return L_D, L_A\n\n    def run_simulation(scheme, dt, T, N, D0, v0, L_D_mat, L_A_mat):\n        \"\"\"Runs a single simulation for a given scheme and dt.\"\"\"\n        dx = 1.0 / N\n        x = np.arange(N) * dx\n        num_steps = int(round(T / dt))\n        actual_T = num_steps * dt\n\n        u = u_exact(x, 0.0)\n\n        if scheme == 'E':\n            for n in range(num_steps):\n                t = n * dt\n                dudt = apply_rhs(u, t, x, dx, N, D0, v0)\n                u = u + dt * dudt\n        elif scheme == 'I':\n            M = np.identity(N) - dt * (L_D_mat - L_A_mat)\n            for n in range(num_steps):\n                t_np1 = (n + 1) * dt\n                S_np1 = S_func(x, t_np1, D0, v0)\n                rhs_vec = u + dt * S_np1\n                u = np.linalg.solve(M, rhs_vec)\n        \n        u_fin_exact = u_exact(x, actual_T)\n        error = np.sqrt(dx * np.sum((u - u_fin_exact)**2))\n        return error\n\n    def run_case(D0, v0, N, T):\n        \"\"\"\n        Runs a full test case, including CFL and convergence rate calculation.\n        \"\"\"\n        dx = 1.0 / N\n        x = np.arange(N) * dx\n\n        # CFL calculations\n        D_vec = D_func(x, D0)\n        v_vec = v_func(x, v0)\n        \n        dt_diff = dx**2 / (2 * np.max(D_vec))\n        if v0 == 0.0:\n            dt_adv = np.inf\n        else:\n            dt_adv = dx / np.max(np.abs(v_vec))\n\n        dt_max_E = min(dt_diff, dt_adv)\n        dt_max_I = 1e9\n\n        # Pre-build matrices for implicit scheme\n        L_D_mat, L_A_mat = build_operator_matrices(x, dx, N, D0, v0)\n\n        # Convergence rate calculation\n        rates = []\n        for scheme in ['E', 'I']:\n            dt_vals = np.array([T/40, T/80, T/160])\n            errors = np.array([run_simulation(scheme, dt, T, N, D0, v0, L_D_mat, L_A_mat) for dt in dt_vals])\n            \n            # Linear regression on log-log scale\n            slope, _ = np.polyfit(np.log(dt_vals), np.log(errors), 1)\n            rates.append(slope)\n        \n        r_E, r_I = rates\n        return [r_E, r_I, dt_max_E, dt_max_I]\n\n    # --- Main execution ---\n    test_cases = [\n        (1e-3, 0.5, 256, 0.1),    # Case A\n        (1e-5, 1.0, 256, 0.1),    # Case B\n        (7.5e-3, 0.0, 128, 0.1),  # Case C\n    ]\n    \n    results = [run_case(*case) for case in test_cases]\n    \n    print(results)\n\nsolve()\n```"
        }
    ]
}