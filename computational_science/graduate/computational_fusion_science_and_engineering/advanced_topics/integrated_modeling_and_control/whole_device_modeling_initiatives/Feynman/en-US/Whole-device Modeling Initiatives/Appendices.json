{
    "hands_on_practices": [
        {
            "introduction": "The starting point for any whole-device model is understanding the global power balance. This exercise grounds you in the fundamental principle of energy conservation applied to the entire plasma volume. By treating the tokamak as a zero-dimensional system, you will calculate two of the most critical figures of merit for a fusion device: the fusion gain $Q$ and the rate of change of stored energy $dW/dt$, learning to interpret these values in the context of operational goals like achieving a burning plasma. ",
            "id": "4065674",
            "problem": "A whole-device power balance model for a deuterium–tritium (D–T) tokamak plasma treats the plasma as a single volume with global sources and sinks of power. In such a zero-dimensional framework, the plasma stored energy $W(t)$ evolves according to energy conservation, with source terms from self-heating by fusion-produced alpha particles and externally injected auxiliary heating, and sink terms from radiation and transport losses. The fusion gain $Q$ is defined operationally as the ratio of total fusion power to externally injected auxiliary heating power. For D–T fusion, a well-tested fact is that each reaction releases $E_{fusion}=17.6 \\text{ MeV}$ of energy, of which the alpha particle carries $E_{\\alpha}=3.5 \\text{ MeV}$ deposited in the plasma, giving an alpha fraction $f_{\\alpha}=E_{\\alpha}/E_{fusion}$. Assume steady composition and that all alpha power is promptly thermalized in the plasma.\n\nConsider a scenario in a whole-device modeling exercise with the following modeled power channels: alpha self-heating power $P_{\\alpha}=82.5 \\text{ MW}$, externally injected auxiliary heating power $P_{aux}=47.3 \\text{ MW}$, line-plus-bremsstrahlung radiation $P_{rad}=69.4 \\text{ MW}$, and transport loss power $P_{loss}=58.7 \\text{ MW}$. Using only energy conservation and the D–T energy partition stated above, determine the fusion gain $Q$ and the net stored energy growth rate $dW/dt$ for this scenario. Express $Q$ as a pure number and express $dW/dt$ in megajoules per second. Round both quantities to four significant figures. Finally, interpret whether the plasma is increasing or decreasing its stored energy and whether the gain is compatible with operational viability for a burning plasma relative to typical design targets.",
            "solution": "The problem statement will first be validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\nThe following information is provided in the problem statement:\n- **Model**: A zero-dimensional whole-device power balance model for a deuterium-tritium (D–T) tokamak plasma.\n- **Energy Conservation**: The plasma stored energy $W(t)$ evolves according to the balance of power sources and sinks.\n- **Power Sources**: Alpha self-heating power ($P_{\\alpha}$) and auxiliary heating power ($P_{aux}$).\n- **Power Sinks**: Radiation loss power ($P_{rad}$) and transport loss power ($P_{loss}$).\n- **Fusion Gain Definition**: $Q = \\frac{\\text{Total Fusion Power}}{\\text{Auxiliary Heating Power}}$.\n- **D-T Fusion Energetics**:\n  - Total energy per reaction: $E_{fusion} = 17.6 \\text{ MeV}$.\n  - Alpha particle energy per reaction: $E_{\\alpha} = 3.5 \\text{ MeV}$.\n- **Alpha Fraction**: $f_{\\alpha} = \\frac{E_{\\alpha}}{E_{fusion}}$.\n- **Modeled Power Values**:\n  - Alpha heating power: $P_{\\alpha} = 82.5 \\text{ MW}$.\n  - Auxiliary heating power: $P_{aux} = 47.3 \\text{ MW}$.\n  - Radiation loss power: $P_{rad} = 69.4 \\text{ MW}$.\n  - Transport loss power: $P_{loss} = 58.7 \\text{ MW}$.\n- **Requirements**:\n  - Determine the fusion gain $Q$.\n  - Determine the net stored energy growth rate $\\frac{dW}{dt}$.\n  - Express $Q$ as a pure number rounded to four significant figures.\n  - Express $\\frac{dW}{dt}$ in megajoules per second, rounded to four significant figures.\n  - Interpret the results regarding energy storage and operational viability.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the established validation criteria.\n- **Scientifically Grounded**: The problem is based on the fundamental principle of energy conservation applied to a fusion plasma, a standard approach in plasma physics. The definitions of fusion gain ($Q$) and power balance channels ($P_{\\alpha}, P_{aux}, P_{rad}, P_{loss}$) are correct and widely used. The energy values for the D-T fusion reaction ($E_{fusion} = 17.6 \\text{ MeV}$ and $E_{\\alpha} = 3.5 \\text{ MeV}$) are the standard, accepted values for this process. The problem is scientifically sound.\n- **Well-Posed**: The problem is structured such that unique solutions for $Q$ and $\\frac{dW}{dt}$ exist. All necessary data and definitions are provided to calculate these quantities. The tasks are specified clearly.\n- **Objective**: The problem is stated using precise, quantitative, and unbiased language. The request for interpretation is grounded in comparing the calculated results to established benchmarks in fusion research (\"typical design targets\"), which is a standard form of analysis, not a subjective inquiry.\n- **Completeness and Consistency**: The problem is self-contained and free of contradictions. The power values are provided in consistent units (megawatts, MW), which are equivalent to megajoules per second (MJ/s), ensuring dimensional consistency.\n- **Realism**: The power values are realistic for a large-scale, high-performance tokamak experiment, such as one operating in a regime similar to that planned for ITER.\n- **Other Flaws**: The problem is not metaphorical, trivial, ill-posed, or unverifiable.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full, reasoned solution will be provided.\n\n### Solution\n\nThe solution proceeds in two parts: first, the calculation of the net stored energy growth rate, $\\frac{dW}{dt}$; and second, the calculation of the fusion gain, $Q$. Finally, an interpretation of these results is provided.\n\n**1. Net Stored Energy Growth Rate ($\\frac{dW}{dt}$)**\n\nThe rate of change of the plasma's total stored energy, $\\frac{dW}{dt}$, is governed by the principle of energy conservation. It is the sum of all power sources minus the sum of all power sinks.\n\nThe power sources are the alpha self-heating power, $P_{\\alpha}$, and the externally injected auxiliary heating power, $P_{aux}$.\n$$P_{source} = P_{\\alpha} + P_{aux}$$\n\nThe power sinks (losses) are the power lost through radiation, $P_{rad}$, and the power lost through transport processes, $P_{loss}$.\n$$P_{sink} = P_{rad} + P_{loss}$$\n\nThe net power balance equation is therefore:\n$$\\frac{dW}{dt} = P_{source} - P_{sink} = (P_{\\alpha} + P_{aux}) - (P_{rad} + P_{loss})$$\n\nSubstituting the given values:\n$$P_{\\alpha} = 82.5 \\text{ MW}$$\n$$P_{aux} = 47.3 \\text{ MW}$$\n$$P_{rad} = 69.4 \\text{ MW}$$\n$$P_{loss} = 58.7 \\text{ MW}$$\n\nWe calculate the total power input and total power loss:\n$$P_{source} = 82.5 \\text{ MW} + 47.3 \\text{ MW} = 129.8 \\text{ MW}$$\n$$P_{sink} = 69.4 \\text{ MW} + 58.7 \\text{ MW} = 128.1 \\text{ MW}$$\n\nThe net rate of change of stored energy is:\n$$\\frac{dW}{dt} = 129.8 \\text{ MW} - 128.1 \\text{ MW} = 1.7 \\text{ MW}$$\n\nSince $1 \\text{ Watt}$ is equivalent to $1 \\text{ Joule per second}$, $1 \\text{ MW}$ is equivalent to $1 \\text{ MJ/s}$. The problem requires the result to be rounded to four significant figures.\n$$\\frac{dW}{dt} = 1.700 \\text{ MJ/s}$$\n\n**2. Fusion Gain ($Q$)**\n\nThe fusion gain $Q$ is defined as the ratio of the total fusion power, $P_{fusion}$, to the auxiliary heating power, $P_{aux}$:\n$$Q = \\frac{P_{fusion}}{P_{aux}}$$\n\nThe auxiliary heating power is given as $P_{aux} = 47.3 \\text{ MW}$. The total fusion power, $P_{fusion}$, must be determined. The problem provides the alpha heating power, $P_{\\alpha}$, which is the fraction of the total fusion power carried by the alpha particles. This fraction, $f_{\\alpha}$, is the ratio of the alpha particle energy, $E_{\\alpha}$, to the total fusion energy per reaction, $E_{fusion}$.\n\n$$f_{\\alpha} = \\frac{E_{\\alpha}}{E_{fusion}}$$\nGiven $E_{\\alpha} = 3.5 \\text{ MeV}$ and $E_{fusion} = 17.6 \\text{ MeV}$:\n$$f_{\\alpha} = \\frac{3.5}{17.6}$$\n\nThe alpha heating power is related to the total fusion power by this same fraction:\n$$P_{\\alpha} = f_{\\alpha} P_{fusion}$$\n\nWe can therefore find $P_{fusion}$ by rearranging this equation:\n$$P_{fusion} = \\frac{P_{\\alpha}}{f_{\\alpha}} = P_{\\alpha} \\left( \\frac{E_{fusion}}{E_{\\alpha}} \\right)$$\n\nSubstituting the given values for $P_{\\alpha}$, $E_{fusion}$, and $E_{\\alpha}$:\n$$P_{fusion} = (82.5 \\text{ MW}) \\left( \\frac{17.6}{3.5} \\right) \\approx 414.8571 \\text{ MW}$$\n\nNow we can calculate $Q$ using its definition:\n$$Q = \\frac{P_{fusion}}{P_{aux}} = \\frac{(82.5) \\left( \\frac{17.6}{3.5} \\right)}{47.3}$$\n$$Q \\approx \\frac{414.8571}{47.3} \\approx 8.770764$$\n\nRounding the result to four significant figures as required:\n$$Q \\approx 8.771$$\n\n**3. Interpretation**\n\n- **Stored Energy**: The calculated value for the net stored energy growth rate is $\\frac{dW}{dt} = +1.700 \\text{ MJ/s}$. Since this value is positive, the total energy content of the plasma is increasing. This indicates that the plasma is not in a steady state but is heating up, albeit slowly, as the total power input ($129.8 \\text{ MW}$) slightly exceeds the total power loss ($128.1 \\text{ MW}$).\n\n- **Fusion Gain**: The calculated fusion gain is $Q \\approx 8.771$. This value is significant. A value of $Q=1$ represents \"scientific breakeven,\" where the fusion power produced equals the external heating power supplied. A value of $Q=5$ is often cited as the threshold for a \"burning plasma,\" where alpha heating becomes a dominant term in the plasma's power balance (here, $P_{\\alpha}=82.5 \\text{ MW}$ is substantially larger than $P_{aux}=47.3 \\text{ MW}$, confirming this is a burning plasma regime). A value of $Q \\ge 10$ is typically considered the minimum for a commercially viable fusion power plant. The calculated gain of approximately $8.8$ places this modeled scenario firmly in the burning plasma domain and is approaching the target for a reactor pilot plant. It represents a high-performance operational scenario.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n8.771 & 1.700\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Whole-device models gain their predictive power by coupling different physics models across various regions. This practice moves beyond the global 0-D view to a 1-D reduced model for the scrape-off layer (SOL), a critical boundary region. You will derive and apply the classic two-point model, which connects upstream plasma conditions to the heat flux arriving at the divertor plates, providing essential insight into how boundary conditions are managed in integrated simulations. ",
            "id": "4065654",
            "problem": "In whole-device modeling initiatives for magnetic confinement fusion devices, edge and divertor boundary conditions are often closed using reduced one-dimensional models that connect upstream scrape-off layer (SOL) parameters to divertor targets along a magnetic field line. Consider a conduction-limited SOL segment of length $L$ with no volumetric sources or sinks, steady state, and electron heat conduction described by Spitzer–Härm conductivity. Assume a single-fluid electron temperature $T(s)$ varying along the magnetic field coordinate $s \\in [0,L]$, with $T(0)=T_{t}$ at the divertor target and $T(L)=T_{u}$ as an upstream boundary condition. Take the parallel electron heat flux $q_{\\parallel}$ to be directed from upstream to target and constant in $s$ at steady state. Let the electron parallel conductivity be $\\kappa_{\\parallel}(T)=\\kappa_{0}\\,T^{5/2}$, where $\\kappa_{0}$ is a constant.\n\nStarting from one-dimensional steady-state energy conservation along the field and Fourier’s law with temperature-dependent conductivity, derive an expression for $q_{\\parallel}$ in terms of $T_{u}$, $T_{t}$, $L$, and $\\kappa_{0}$. Then, using the derived result, evaluate $q_{\\parallel}$ and the sensitivity $\\partial q_{\\parallel}/\\partial T_{t}$ at the target for the following parameters representative of a high-recycling, conduction-limited SOL closure used within integrated simulations:\n- $\\kappa_{0} = 2000\\,\\mathrm{W\\,m^{-1}\\,eV^{-7/2}}$,\n- $L = 40\\,\\mathrm{m}$,\n- $T_{u} = 50\\,\\mathrm{eV}$,\n- $T_{t} = 5\\,\\mathrm{eV}$.\n\nNeglect ion conduction, parallel convection, sheath heat transmission factors, and any volumetric radiation or ionization sinks along the field line. Treat electrons as the sole conducting species.\n\nReport only the sensitivity $\\partial q_{\\parallel}/\\partial T_{t}$ evaluated at the specified $T_{t}$, expressed in $\\mathrm{MW\\,m^{-2}\\,eV^{-1}}$. Round your answer to $3$ significant figures.",
            "solution": "The derivation begins from steady-state one-dimensional energy conservation along a magnetic field line in the scrape-off layer, which implies that the parallel conductive heat flux is constant:\n$$\n\\frac{d}{ds} q_{\\parallel}(s) = 0 \\quad \\Rightarrow \\quad q_{\\parallel}(s) = q_{\\parallel} = \\text{const}.\n$$\nFor electron heat conduction with Spitzer–Härm conductivity, Fourier’s law along the field reads\n$$\nq_{\\parallel} = -\\kappa_{\\parallel}(T)\\,\\frac{dT}{ds}, \\quad \\kappa_{\\parallel}(T) = \\kappa_{0}\\,T^{5/2}.\n$$\nWe define $q_{\\parallel}$ as positive from upstream toward the target. With $T(s)$ monotonically decreasing from upstream ($s=L$, $T=T_{u}$) to target ($s=0$, $T=T_{t}$), the sign convention gives\n$$\nq_{\\parallel} = \\kappa_{0}\\,T^{5/2}\\left|\\frac{dT}{ds}\\right|.\n$$\nTo obtain $q_{\\parallel}$ in terms of boundary values, rearrange and integrate:\n$$\nq_{\\parallel} = -\\kappa_{0}\\,T^{5/2}\\frac{dT}{ds}\n\\quad \\Rightarrow \\quad\n-\\frac{q_{\\parallel}}{\\kappa_{0}}\\,ds = T^{5/2}\\,dT.\n$$\nIntegrate from target to upstream along $s$ and from $T_{t}$ to $T_{u}$ in temperature:\n$$\n-\\frac{q_{\\parallel}}{\\kappa_{0}} \\int_{0}^{L} ds = \\int_{T_{t}}^{T_{u}} T^{5/2}\\,dT.\n$$\nThe left-hand side gives $-\\dfrac{q_{\\parallel}}{\\kappa_{0}}\\,L$. The right-hand side evaluates to\n$$\n\\int_{T_{t}}^{T_{u}} T^{5/2}\\,dT = \\left[\\frac{2}{7} T^{7/2}\\right]_{T_{t}}^{T_{u}} = \\frac{2}{7}\\left(T_{u}^{7/2}-T_{t}^{7/2}\\right).\n$$\nHence,\n$$\n-\\frac{q_{\\parallel}}{\\kappa_{0}}\\,L = \\frac{2}{7}\\left(T_{u}^{7/2}-T_{t}^{7/2}\\right)\n\\quad \\Rightarrow \\quad\nq_{\\parallel} = \\frac{2}{7}\\,\\frac{\\kappa_{0}}{L}\\,\\left(T_{u}^{7/2}-T_{t}^{7/2}\\right).\n$$\nThis is the standard two-point conduction-limited result with no volumetric sources or sinks.\n\nNext, compute the sensitivity of the heat flux to the target temperature at fixed upstream conditions:\n$$\n\\frac{\\partial q_{\\parallel}}{\\partial T_{t}} = \\frac{2}{7}\\,\\frac{\\kappa_{0}}{L}\\,\\frac{\\partial}{\\partial T_{t}}\\left(-T_{t}^{7/2}\\right) = \\frac{2}{7}\\,\\frac{\\kappa_{0}}{L}\\,\\left(-\\frac{7}{2} T_{t}^{5/2}\\right) = -\\frac{\\kappa_{0}}{L}\\,T_{t}^{5/2}.\n$$\nThis local sensitivity is negative, indicating that increasing $T_{t}$ reduces the driving temperature gradient and thus reduces $q_{\\parallel}$ for fixed $T_{u}$ and $L$.\n\nEvaluate $q_{\\parallel}$ and $\\dfrac{\\partial q_{\\parallel}}{\\partial T_{t}}$ for the given parameters. Keep symbols until the final step.\n\nGiven\n$$\n\\kappa_{0} = 2000\\,\\mathrm{W\\,m^{-1}\\,eV^{-7/2}}, \\quad L=40\\,\\mathrm{m}, \\quad T_{u}=50\\,\\mathrm{eV}, \\quad T_{t}=5\\,\\mathrm{eV}.\n$$\nFirst, compute $q_{\\parallel}$ (for context):\n$$\nT_{u}^{7/2} = \\left(50\\right)^{7/2} = \\left(50\\right)^{3}\\sqrt{50} = 125000 \\times 7.071067811 \\approx 8.838834765\\times 10^{5},\n$$\n$$\nT_{t}^{7/2} = \\left(5\\right)^{7/2} = \\left(5\\right)^{3}\\sqrt{5} = 125 \\times 2.236067977 \\approx 2.795084972\\times 10^{2},\n$$\n$$\nT_{u}^{7/2} - T_{t}^{7/2} \\approx 8.838834765\\times 10^{5} - 2.795084972 \\times 10^{2} \\approx 8.836039680\\times 10^{5}.\n$$\nThen\n$$\nq_{\\parallel} = \\frac{2}{7}\\,\\frac{2000}{40}\\,\\left(8.836039680\\times 10^{5}\\right)\n= \\frac{100}{7}\\,\\left(8.836039680\\times 10^{5}\\right)\n= \\frac{8.836039680\\times 10^{7}}{7}\n\\approx 1.262291383\\times 10^{7}\\,\\mathrm{W\\,m^{-2}}.\n$$\nThus $q_{\\parallel} \\approx 12.6\\,\\mathrm{MW\\,m^{-2}}$, which is within a realistic range for conduction-limited SOL conditions.\n\nNow compute the requested sensitivity at the target:\n$$\n\\frac{\\partial q_{\\parallel}}{\\partial T_{t}} = -\\frac{\\kappa_{0}}{L}\\,T_{t}^{5/2}.\n$$\nEvaluate $T_{t}^{5/2}$:\n$$\nT_{t}^{5/2} = \\left(5\\right)^{5/2} = \\left(5\\right)^{2}\\sqrt{5} = 25 \\times 2.236067977 \\approx 5.590169943\\times 10^{1}.\n$$\nThen\n$$\n\\frac{\\kappa_{0}}{L} = \\frac{2000}{40} = 50,\n$$\nso\n$$\n\\frac{\\partial q_{\\parallel}}{\\partial T_{t}} \\approx -50 \\times \\left(5.590169943\\times 10^{1}\\right) \\approx -2.795084972\\times 10^{3}\\,\\mathrm{W\\,m^{-2}\\,eV^{-1}}.\n$$\nConvert to $\\mathrm{MW\\,m^{-2}\\,eV^{-1}}$ by dividing by $10^{6}$:\n$$\n\\frac{\\partial q_{\\parallel}}{\\partial T_{t}} \\approx -2.795084972\\times 10^{-3}\\,\\mathrm{MW\\,m^{-2}\\,eV^{-1}}.\n$$\nRounded to $3$ significant figures, this is\n$$\n-0.00280\\,\\mathrm{MW\\,m^{-2}\\,eV^{-1}}.\n$$\nPer the problem’s instruction, only the sensitivity value is to be reported as the final answer, in the specified units and rounding.",
            "answer": "$$\\boxed{-0.00280}$$"
        },
        {
            "introduction": "A key challenge in whole-device modeling is ensuring the models are consistent with experimental observations. This involves calibrating uncertain parameters, such as transport coefficients, against diagnostic data. This hands-on coding exercise introduces you to the modern framework of Bayesian inference for model validation, where you will infer a transport coefficient by combining prior physical knowledge with likelihoods from synthetic diagnostic measurements, a core skill in uncertainty quantification (UQ). ",
            "id": "4065646",
            "problem": "Consider a calibration problem for a scalar transport coefficient $\\chi$ (thermal diffusivity) used in Whole-Device Modeling (WDM) of magnetically confined fusion plasmas. The goal is to infer $\\chi$ in $\\mathrm{m^2/s}$ from synthetic diagnostic observations by combining a physically informed prior with a likelihood derived from independent diagnostic models. Assume the following fundamental basis:\n\n- Bayesian inference: Bayes' theorem relates the posterior $p(\\chi \\mid \\mathbf{y})$ to the prior $p(\\chi)$ and the likelihood $p(\\mathbf{y}\\mid\\chi)$ as $p(\\chi \\mid \\mathbf{y}) \\propto p(\\mathbf{y}\\mid\\chi)\\,p(\\chi)$.\n- Independent Gaussian measurement errors: for each diagnostic $i$ with observation model $y_i = f_i(\\chi) + \\epsilon_i$, the noise $\\epsilon_i$ is independent and identically distributed as $\\mathcal{N}(0,\\sigma_i^2)$, yielding the likelihood $p(y_i \\mid \\chi) = \\frac{1}{\\sqrt{2\\pi}\\sigma_i}\\exp\\!\\Big(-\\frac{\\big(y_i - f_i(\\chi)\\big)^2}{2\\sigma_i^2}\\Big)$.\n- Positivity constraint and prior: thermal diffusivity $\\chi$ is strictly positive; choose a log-normal prior defined via $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$ so that $p(\\chi) = \\frac{1}{\\chi\\,\\sigma\\sqrt{2\\pi}} \\exp\\!\\Big(-\\frac{(\\ln \\chi - \\mu)^2}{2\\sigma^2}\\Big)$ for $\\chi > 0$.\n- Diagnostic forward models used in WDM approximations:\n  1. Heat flux measurement: $f_{\\mathrm{flux}}(\\chi) = \\kappa \\chi$, with $\\kappa$ a known constant; the observed heat flux $y$ is in $\\mathrm{W/m^2}$.\n  2. Global energy confinement time: $f_{\\tau}(\\chi) = \\frac{a}{\\chi}$, where $a$ is a geometry-dependent constant (for slab diffusion, $a = L^2/\\pi^2$), and the observed confinement time $y$ is in $\\mathrm{s}$.\n\nFrom this base, implement a numerical posterior inference for $\\chi$ via direct quadrature over a positive grid for $\\chi$. Specifically:\n- Construct the unnormalized posterior $p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) = p(\\chi)\\prod_i p(y_i\\mid\\chi)$.\n- Normalize by numerically integrating over $\\chi \\in [\\chi_{\\min}, \\chi_{\\max}]$ to obtain $p(\\chi \\mid \\mathbf{y})$.\n- Compute the posterior mean $\\mathbb{E}[\\chi \\mid \\mathbf{y}] = \\int_{\\chi_{\\min}}^{\\chi_{\\max}} \\chi\\,p(\\chi \\mid \\mathbf{y})\\,d\\chi$.\n\nExpress the final answers in $\\mathrm{m^2/s}$ and round to six decimal places.\n\nTest Suite:\nCompute the posterior mean $\\mathbb{E}[\\chi \\mid \\mathbf{y}]$ for the following four cases. In every case, use a log-spaced grid over $\\chi \\in [10^{-4}, 1.0]\\,\\mathrm{m^2/s}$. Treat diagnostics as independent. The constants are:\n- $\\kappa = 801\\,\\,\\mathrm{W\\,m^{-2}\\,(m^2/s)^{-1}}$ for flux diagnostics.\n- $a = \\dfrac{L^2}{\\pi^2}$ with $L = 0.5\\,\\mathrm{m}$ so $a \\approx 0.25/\\pi^2 \\approx 0.02533029591\\,\\mathrm{m^2}$ for confinement time diagnostics.\n\nCase 1 (single flux diagnostic, moderately informative prior):\n- Prior: $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$ with $\\mu = \\ln(0.3)$ and $\\sigma = 0.45$.\n- Diagnostic: flux with $y = 210\\,\\mathrm{W/m^2}$, $\\sigma_y = 60\\,\\mathrm{W/m^2}$.\n\nCase 2 (single confinement time diagnostic, broader prior):\n- Prior: $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$ with $\\mu = \\ln(0.2)$ and $\\sigma = 0.6$.\n- Diagnostic: confinement time with $y = 0.17\\,\\mathrm{s}$, $\\sigma_y = 0.01\\,\\mathrm{s}$.\n\nCase 3 (combined diagnostics):\n- Prior: $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$ with $\\mu = \\ln(0.25)$ and $\\sigma = 0.5$.\n- Diagnostics:\n  - Flux with $y = 158\\,\\mathrm{W/m^2}$, $\\sigma_y = 50\\,\\mathrm{W/m^2}$.\n  - Confinement time with $y = 0.13\\,\\mathrm{s}$, $\\sigma_y = 0.015\\,\\mathrm{s}$.\n\nCase 4 (low flux observation, narrower prior):\n- Prior: $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$ with $\\mu = \\ln(0.1)$ and $\\sigma = 0.4$.\n- Diagnostic: flux with $y = 10\\,\\mathrm{W/m^2}$, $\\sigma_y = 80\\,\\mathrm{W/m^2}$.\n\nRequired final output format:\nYour program should produce a single line of output containing the posterior means of $\\chi$ for Cases 1 through 4, in order, as a comma-separated list enclosed in square brackets, with each entry rounded to six decimal places in $\\mathrm{m^2/s}$ (e.g., \"[0.254321,0.173456,0.201234,0.089765]\").",
            "solution": "The objective of this problem is to compute the posterior mean of the thermal diffusivity, $\\chi$, using Bayesian inference. The posterior probability distribution for $\\chi$ given a set of measurements $\\mathbf{y}$, denoted $p(\\chi \\mid \\mathbf{y})$, is determined by Bayes' theorem:\n\n$$\np(\\chi \\mid \\mathbf{y}) \\propto p(\\mathbf{y} \\mid \\chi) \\, p(\\chi)\n$$\n\nHere, $p(\\chi)$ is the prior probability distribution of $\\chi$, and $p(\\mathbf{y} \\mid \\chi)$ is the likelihood of observing the data $\\mathbf{y}$ for a given value of $\\chi$. The term on the left, $p(\\chi \\mid \\mathbf{y})$, is the posterior distribution. We are asked to find the expectation value (mean) of $\\chi$ with respect to this posterior distribution.\n\nFirst, we define the components of the Bayesian model as specified.\n\nThe prior distribution for $\\chi$ is given as a log-normal distribution, which is appropriate for a strictly positive quantity. If $\\ln \\chi \\sim \\mathcal{N}(\\mu, \\sigma^2)$, the probability density function (PDF) of $\\chi$ is:\n$$\np(\\chi) = \\frac{1}{\\chi \\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(\\ln \\chi - \\mu)^2}{2\\sigma^2}\\right) \\quad \\text{for } \\chi > 0\n$$\nwhere $\\mu$ and $\\sigma$ are the mean and standard deviation of $\\ln \\chi$, respectively.\n\nThe likelihood function is derived from the assumption of independent Gaussian noise for each diagnostic measurement $y_i$. For a measurement $y_i$ with standard deviation $\\sigma_i$ and a forward model $f_i(\\chi)$ that predicts the measurement from $\\chi$, the likelihood for that single measurement is:\n$$\np(y_i \\mid \\chi) = \\frac{1}{\\sigma_i \\sqrt{2\\pi}} \\exp\\left(-\\frac{(y_i - f_i(\\chi))^2}{2\\sigma_i^2}\\right)\n$$\nSince the diagnostic measurements are independent, the total likelihood for a set of measurements $\\mathbf{y} = \\{y_1, y_2, \\dots\\}$ is the product of the individual likelihoods:\n$$\np(\\mathbf{y} \\mid \\chi) = \\prod_i p(y_i \\mid \\chi)\n$$\nThe problem specifies two types of forward models:\n1.  Heat flux: $f_{\\mathrm{flux}}(\\chi) = \\kappa \\chi$, with $\\kappa = 801\\,\\mathrm{W\\,m^{-2}\\,(m^2/s)^{-1}}$.\n2.  Global energy confinement time: $f_{\\tau}(\\chi) = \\frac{a}{\\chi}$, with $a = \\frac{L^2}{\\pi^2}$ where $L = 0.5\\,\\mathrm{m}$, so $a \\approx 0.02533029591\\,\\mathrm{m^2}$.\n\nThe unnormalized posterior distribution, $p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y})$, is the product of the prior and the total likelihood:\n$$\np_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) = p(\\chi) \\prod_i p(y_i \\mid \\chi)\n$$\nFor numerical stability, it is advantageous to work with the logarithm of the posterior. The log-posterior is proportional to the sum of the log-prior and the log-likelihoods, ignoring terms that are constant with respect to $\\chi$:\n\n$$\n\\ln p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) \\propto -\\ln \\chi - \\frac{(\\ln \\chi - \\mu)^2}{2\\sigma^2} - \\sum_i \\frac{(y_i - f_i(\\chi))^2}{2\\sigma_i^2}\n$$\n\nThe posterior mean, $\\mathbb{E}[\\chi \\mid \\mathbf{y}]$, is defined as the integral of $\\chi$ weighted by the normalized posterior PDF:\n$$\n\\mathbb{E}[\\chi \\mid \\mathbf{y}] = \\int_{0}^{\\infty} \\chi \\, p(\\chi \\mid \\mathbf{y}) \\, d\\chi\n$$\nThe normalized posterior is obtained by dividing the unnormalized posterior by its integral over all possible values of $\\chi$, which is the normalization constant $Z$:\n$$\np(\\chi \\mid \\mathbf{y}) = \\frac{p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y})}{Z}, \\quad \\text{where} \\quad Z = \\int_{0}^{\\infty} p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) \\, d\\chi\n$$\nThus, the posterior mean can be calculated as the ratio of two integrals:\n$$\n\\mathbb{E}[\\chi \\mid \\mathbf{y}] = \\frac{\\int_{0}^{\\infty} \\chi \\, p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) \\, d\\chi}{\\int_{0}^{\\infty} p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}) \\, d\\chi}\n$$\n\nThe problem instructs to perform these integrations numerically over the finite interval $\\chi \\in [\\chi_{\\min}, \\chi_{\\max}]$, where $\\chi_{\\min} = 10^{-4}\\,\\mathrm{m^2/s}$ and $\\chi_{\\max} = 1.0\\,\\mathrm{m^2/s}$. A log-spaced grid of points, $\\{\\chi_j\\}$, is created within this interval. We evaluate the unnormalized posterior at each point. To prevent numerical underflow from the exponentiation, we can compute $L(\\chi) = \\ln p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y})$, find its maximum value $L_{\\max}$ on the grid, and then calculate $p_{\\text{unnorm}}(\\chi_j) \\propto \\exp(L(\\chi_j) - L_{\\max})$.\n\nThe integrals are then approximated using a numerical quadrature method, such as the trapezoidal rule, which is suitable for a sufficiently dense grid. For a function $g(\\chi)$ evaluated on the grid, the integral is approximated as:\n$$\n\\int g(\\chi) \\, d\\chi \\approx \\sum_{j=1}^{N-1} \\frac{g(\\chi_j) + g(\\chi_{j-1})}{2} (\\chi_j - \\chi_{j-1})\n$$\nApplying this to our expression for the posterior mean:\n$$\n\\mathbb{E}[\\chi \\mid \\mathbf{y}] \\approx \\frac{\\text{trapz}(\\chi \\cdot p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}), \\chi)}{\\text{trapz}(p_{\\text{unnorm}}(\\chi \\mid \\mathbf{y}), \\chi)}\n$$\nwhere `trapz` denotes the trapezoidal integration over the grid of $\\chi$ values.\n\nWe apply this procedure for each of the four test cases provided.\n\n**Case 1**: Prior with $\\mu = \\ln(0.3)$, $\\sigma = 0.45$. Single flux diagnostic with $y = 210\\,\\mathrm{W/m^2}$ and $\\sigma_y = 60\\,\\mathrm{W/m^2}$.\n$$\n\\ln p_1(\\chi \\mid y) \\propto -\\ln \\chi - \\frac{(\\ln \\chi - \\ln 0.3)^2}{2(0.45)^2} - \\frac{(210 - 801\\chi)^2}{2(60)^2}\n$$\n\n**Case 2**: Prior with $\\mu = \\ln(0.2)$, $\\sigma = 0.6$. Single confinement time diagnostic with $y = 0.17\\,\\mathrm{s}$ and $\\sigma_y = 0.01\\,\\mathrm{s}$.\n$$\n\\ln p_2(\\chi \\mid y) \\propto -\\ln \\chi - \\frac{(\\ln \\chi - \\ln 0.2)^2}{2(0.6)^2} - \\frac{(0.17 - a/\\chi)^2}{2(0.01)^2}\n$$\n\n**Case 3**: Prior with $\\mu = \\ln(0.25)$, $\\sigma = 0.5$. Two diagnostics: a flux measurement ($y_1 = 158\\,\\mathrm{W/m^2}$, $\\sigma_{y1} = 50\\,\\mathrm{W/m^2}$) and a confinement time measurement ($y_2 = 0.13\\,\\mathrm{s}$, $\\sigma_{y2} = 0.015\\,\\mathrm{s}$).\n$$\n\\ln p_3(\\chi \\mid \\mathbf{y}) \\propto -\\ln \\chi - \\frac{(\\ln \\chi - \\ln 0.25)^2}{2(0.5)^2} - \\frac{(158 - 801\\chi)^2}{2(50)^2} - \\frac{(0.13 - a/\\chi)^2}{2(0.015)^2}\n$$\n\n**Case 4**: Prior with $\\mu = \\ln(0.1)$, $\\sigma = 0.4$. Single flux diagnostic with a low observed value, $y = 10\\,\\mathrm{W/m^2}$, and high uncertainty, $\\sigma_y = 80\\,\\mathrm{W/m^2}$.\n$$\n\\ln p_4(\\chi \\mid y) \\propto -\\ln \\chi - \\frac{(\\ln \\chi - \\ln 0.1)^2}{2(0.4)^2} - \\frac{(10 - 801\\chi)^2}{2(80)^2}\n$$\n\nFor each case, the corresponding log-posterior function is evaluated on the numerical grid, exponentiated (with stabilization), and then used in the trapezoidal rule integrations to compute the posterior mean of $\\chi$. The final numerical results are rounded to six decimal places.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the posterior mean of thermal diffusivity chi for four different cases\n    using Bayesian inference and numerical quadrature.\n    \"\"\"\n    \n    # Define physical and numerical constants\n    KAPPA = 801.0  # W m^-2 (m^2/s)^-1\n    L = 0.5  # m\n    A = (L**2) / (np.pi**2)  # m^2\n\n    CHI_MIN = 1e-4  # m^2/s\n    CHI_MAX = 1.0  # m^2/s\n    N_POINTS = 50000\n\n    # Create a log-spaced grid for chi\n    chi_grid = np.logspace(np.log10(CHI_MIN), np.log10(CHI_MAX), N_POINTS)\n    log_chi_grid = np.log(chi_grid)\n\n    # Define the four test cases from the problem statement\n    test_cases = [\n        {\n            'prior_mu': np.log(0.3),\n            'prior_sigma': 0.45,\n            'diagnostics': [\n                {'type': 'flux', 'y': 210.0, 'sigma_y': 60.0}\n            ]\n        },\n        {\n            'prior_mu': np.log(0.2),\n            'prior_sigma': 0.6,\n            'diagnostics': [\n                {'type': 'tau', 'y': 0.17, 'sigma_y': 0.01}\n            ]\n        },\n        {\n            'prior_mu': np.log(0.25),\n            'prior_sigma': 0.5,\n            'diagnostics': [\n                {'type': 'flux', 'y': 158.0, 'sigma_y': 50.0},\n                {'type': 'tau', 'y': 0.13, 'sigma_y': 0.015}\n            ]\n        },\n        {\n            'prior_mu': np.log(0.1),\n            'prior_sigma': 0.4,\n            'diagnostics': [\n                {'type': 'flux', 'y': 10.0, 'sigma_y': 80.0}\n            ]\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        mu = case['prior_mu']\n        sigma = case['prior_sigma']\n        \n        # Calculate log-prior (up to a constant)\n        # Log-normal PDF: 1/(chi*sigma*sqrt(2pi)) * exp(-(ln(chi)-mu)^2/(2*sigma^2))\n        # Log is: -ln(chi) - (ln(chi)-mu)^2/(2*sigma^2) + const\n        log_prior = -log_chi_grid - (log_chi_grid - mu)**2 / (2 * sigma**2)\n        \n        # Calculate log-likelihood (up to a constant)\n        log_likelihood = np.zeros_like(chi_grid)\n        for diag in case['diagnostics']:\n            if diag['type'] == 'flux':\n                f_chi = KAPPA * chi_grid\n            else:  # 'tau'\n                f_chi = A / chi_grid\n            \n            y = diag['y']\n            sigma_y = diag['sigma_y']\n            # Gaussian PDF: 1/(sigma_y*sqrt(2pi)) * exp(-(y - f(chi))^2/(2*sigma_y^2))\n            # Log is: -(y - f(chi))^2/(2*sigma_y^2) + const\n            log_likelihood += -(y - f_chi)**2 / (2 * sigma_y**2)\n\n        # Combine to get the unnormalized log-posterior\n        log_posterior = log_prior + log_likelihood\n        \n        # Stabilize for exponentiation by subtracting the maximum value\n        # This avoids numerical underflow/overflow\n        log_posterior -= np.max(log_posterior)\n        posterior_unnorm = np.exp(log_posterior)\n        \n        # Compute the posterior mean using numerical integration (trapezoidal rule)\n        # E[chi|y] = Integral[chi * p(chi|y) dchi]\n        #          = Integral[chi * p_unnorm(chi|y) dchi] / Integral[p_unnorm(chi|y) dchi]\n        \n        # Numerator: integral of chi-weighted unnormalized posterior\n        numerator_integrand = chi_grid * posterior_unnorm\n        numerator = np.trapz(numerator_integrand, chi_grid)\n        \n        # Denominator: integral of unnormalized posterior (the normalization constant)\n        denominator = np.trapz(posterior_unnorm, chi_grid)\n        \n        posterior_mean = numerator / denominator\n        results.append(posterior_mean)\n\n    # Format the final output as specified\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}