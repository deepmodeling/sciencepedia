{
    "hands_on_practices": [
        {
            "introduction": "在利用剖面数据库进行模型验证之前，我们必须首先掌握描述等离子体的基本语言——坐标系统。聚变等离子体剖面通常在不同的径向坐标下给出，例如小半径 $r$ 或归一化极向磁通 $\\rho_{\\text{pol}}$。这项实践将引导你从磁流体动力学（MHD）的基本原理出发，推导这两个关键坐标之间的转换关系，这是确保数据库内部自洽性和进行有效模型-实验比对的基础技能 。",
            "id": "4032731",
            "problem": "一个研究团队正在通过交叉检验小半径 $r$ 与归一化极向磁通半径 $\\rho_{\\text{pol}}$ 之间的映射关系，来验证一个磁平衡位形数据库的内部一致性。该装置是一个大环径比托卡马克，其大半径为 $R_{0}$，小半径为 $a$。位形数据库提供了在稳态、轴对称运行条件下记录的安全因子位形 $q(r)$ 和极向磁通位形 $\\psi(r)$。为进行计算验证，所有分析都应在标准的大环径比、圆形磁通面近似下进行。\n\n在轴对称环体中，磁场可以表示为 $\\mathbf{B} = \\nabla \\psi \\times \\nabla \\phi + F(\\psi)\\nabla \\phi / R$，其中 $\\psi$ 是单位弧度的极向磁通函数，$\\phi$ 是环向角。在大环径比、圆形磁通面的极限情况下，极向磁场的大小满足 $B_{p}(r) = \\frac{1}{R_{0}}\\frac{d\\psi}{dr}$，安全因子的定义简化为 $q(r) = \\frac{r B_{t}}{R_{0} B_{p}(r)}$，其中 $B_{t}$ 是环向磁场，此处假定其在小半径范围内径向均匀。归一化极向磁通半径定义为\n$$\n\\rho_{\\text{pol}}(r) = \\sqrt{\\frac{\\psi(r) - \\psi(0)}{\\psi(a) - \\psi(0)}},\n$$\n这是一个无量纲量。该位形数据库使用 $\\psi(0)=0$ 的约定进行归一化。\n\n在此验证任务中，为确保科学真实性，假设如下：\n- 轴对称性成立，因此 $\\psi$ 仅是 $r$ 的函数。\n- 磁通面为圆形且嵌套，小半径 $r \\in [0,a]$。\n- 环向磁场 $B_{t}$ 在 $r \\in [0,a]$ 上径向均匀且严格为正。\n- 数据库返回的安全因子位形在 $r \\in [0,a]$ 上严格为正且单调递增。\n\n在这些假设下，当位形数据库参数化安全因子位形为\n$$\nq(r) = q_{0} + q_{2} \\left(\\frac{r}{a}\\right)^{2},\n$$\n其中 $q_{0} > 0$ 且 $q_{2} > 0$ 时，请用 $r$、$a$ 以及安全因子位形的参数推导出变换 $\\rho_{\\text{pol}}(r)$ 的闭合形式。数据库中的极向磁通 $\\psi(r)$ 将通过 $\\psi(0)=0$ 和 $\\psi(a)$ 用于归一化，但您必须展示如何根据给定的假设从 $q(r)$ 自洽地获得此归一化。请将您的最终答案表示为 $\\rho_{\\text{pol}}(r)$ 关于 $r$、$a$、$q_{0}$ 和 $q_{2}$ 的单一闭合解析表达式。无需进行数值计算。最终答案是无量纲的，因此不包含单位。在推导过程中，请明确说明您所使用的关于轴对称性和单调性的任何假设。",
            "solution": "首先对问题陈述进行严格的验证程序。\n\n### 第1步：提取已知条件\n- **设备与几何**：大环径比托卡马克，大半径 $R_{0}$，小半径 $a$。\n- **坐标与变量**：小半径 $r \\in [0,a]$，环向角 $\\phi$，单位弧度的极向磁通 $\\psi(r)$，安全因子 $q(r)$。\n- **运行条件与近似**：稳态、轴对称运行。大环径比、圆形磁通面近似。\n- **物理关系**：\n    - 磁场：$\\mathbf{B} = \\nabla \\psi \\times \\nabla \\phi + F(\\psi)\\nabla \\phi / R$。\n    - 极向磁场（近似）：$B_{p}(r) = \\frac{1}{R_{0}}\\frac{d\\psi}{dr}$。\n    - 安全因子（近似）：$q(r) = \\frac{r B_{t}}{R_{0} B_{p}(r)}$。\n    - 环向磁场 $B_{t}$ 被视为径向均匀且严格为正。\n- **定义**：\n    - 归一化极向磁通半径：$\\rho_{\\text{pol}}(r) = \\sqrt{\\frac{\\psi(r) - \\psi(0)}{\\psi(a) - \\psi(0)}}$。\n    - 归一化约定：$\\psi(0)=0$。\n- **特定位形**：\n    - 安全因子：$q(r) = q_{0} + q_{2} \\left(\\frac{r}{a}\\right)^{2}$，参数为 $q_{0} > 0$ 且 $q_{2} > 0$。\n- **验证任务的假设**：\n    - 轴对称性：$\\psi = \\psi(r)$。\n    - 嵌套的圆形磁通面。\n    - $B_{t}$ 均匀且为正。\n    - $q(r)$ 严格为正且单调递增。\n- **目标**：推导 $\\rho_{\\text{pol}}(r)$ 关于 $r$、$a$、$q_{0}$ 和 $q_{2}$ 的闭合表达式。\n\n### 第2步：使用提取的已知条件进行验证\n根据既定标准对问题进行评估。\n- **科学依据**：该问题基于托卡马克的标准磁流体动力学（MHD）平衡理论，特别是广泛使用的大环径比、圆形磁通面近似。极向磁通 $\\psi$、安全因子 $q$ 和归一化坐标 $\\rho_{\\text{pol}}$ 的定义都是磁约束聚变领域的标准。$q(r)$ 的抛物线模型是一种常见且物理上合理的参数化方法。该问题在科学上是合理的。\n- **适定性**：该问题提供了一套完整的定义和关系，足以推导出所需量。$q(r)$ 和 $\\psi(r)$ 之间的关系可以通过一个关于 $\\psi(r)$ 的一阶常微分方程建立。利用边界条件 $\\psi(0)=0$，可以对该方程进行积分，求得 $\\psi(r)$ 的唯一解，进而求得 $\\rho_{\\text{pol}}(r)$ 的解。该问题是适定的。\n- **客观性**：问题陈述使用了精确的数学和物理语言，没有歧义或主观论断。\n\n该问题没有表现出验证清单中列出的任何缺陷。给定的约束条件 $q_0 > 0$ 和 $q_2 > 0$ 与 $q(r)$ 在 $r \\in [0, a]$ 上为正且单调递增的假设是一致的。整个设置是自洽的、逻辑一致的且科学有效的。\n\n### 第3步：结论与行动\n问题被判定为**有效**。将进行求解。\n\n### 推导过程\n目标是求出变换 $\\rho_{\\text{pol}}(r)$。我们从大环径比、圆形磁通面近似下的给定定义开始。安全因子 $q(r)$ 由下式给出\n$$q(r) = \\frac{r B_{t}}{R_{0} B_{p}(r)}$$\n而极向磁场 $B_{p}(r)$ 与极向磁通 $\\psi(r)$ 的关系为\n$$B_{p}(r) = \\frac{1}{R_{0}}\\frac{d\\psi}{dr}$$\n将 $B_{p}(r)$ 的表达式代入 $q(r)$ 的定义，我们可以将 $q(r)$ 与极向磁通的导数直接联系起来：\n$$q(r) = \\frac{r B_{t}}{R_{0} \\left(\\frac{1}{R_{0}}\\frac{d\\psi}{dr}\\right)} = \\frac{r B_{t}}{\\frac{d\\psi}{dr}}$$\n这个方程可以重新排列，得到一个关于 $\\psi(r)$ 的一阶常微分方程：\n$$\\frac{d\\psi}{dr} = \\frac{r B_{t}}{q(r)}$$\n问题指定安全因子位形为 $q(r) = q_{0} + q_{2} \\left(\\frac{r}{a}\\right)^{2}$。将此形式代入微分方程，得到：\n$$\\frac{d\\psi}{dr} = \\frac{r B_{t}}{q_{0} + q_{2} \\left(\\frac{r}{a}\\right)^{2}}$$\n为了求出 $\\psi(r)$，我们将此表达式对小半径从磁轴（$r=0$）积分到任意半径 $r$。设 $r'$ 为积分变量。\n$$\\psi(r) - \\psi(0) = \\int_{0}^{r} \\frac{r' B_{t}}{q_{0} + q_{2} \\left(\\frac{r'}{a}\\right)^{2}} dr'$$\n使用给定的归一化约定 $\\psi(0)=0$：\n$$\\psi(r) = B_{t} \\int_{0}^{r} \\frac{r'}{q_{0} + \\frac{q_{2}}{a^{2}}(r')^{2}} dr'$$\n为了求解这个积分，我们使用换元法。令 $u = q_{0} + \\frac{q_{2}}{a^{2}}(r')^{2}$。其微分为 $du = \\frac{2q_{2}}{a^{2}}r' dr'$，这意味着 $r' dr' = \\frac{a^{2}}{2q_{2}} du$。我们还必须变换积分上下限：\n- 当 $r' = 0$ 时，$u = q_{0}$。\n- 当 $r' = r$ 时，$u = q_{0} + \\frac{q_{2}}{a^{2}}r^{2}$。\n$\\psi(r)$ 的积分变为：\n$$\\psi(r) = B_{t} \\int_{q_{0}}^{q_{0} + \\frac{q_{2}}{a^{2}}r^{2}} \\frac{1}{u} \\left(\\frac{a^{2}}{2q_{2}} du\\right) = \\frac{B_{t} a^{2}}{2q_{2}} \\int_{q_{0}}^{q_{0} + \\frac{q_{2}}{a^{2}}r^{2}} \\frac{1}{u} du$$\n这是 $1/u$ 的积分，结果是自然对数：\n$$\\psi(r) = \\frac{B_{t} a^{2}}{2q_{2}} \\left[ \\ln(u) \\right]_{q_{0}}^{q_{0} + \\frac{q_{2}}{a^{2}}r^{2}}$$\n条件 $q_{0}>0$ 和 $q_{2}>0$ 确保了对数的参数始终为正，因此不需要绝对值。\n$$\\psi(r) = \\frac{B_{t} a^{2}}{2q_{2}} \\left( \\ln\\left(q_{0} + \\frac{q_{2}}{a^{2}}r^{2}\\right) - \\ln(q_{0}) \\right)$$\n使用对数恒等式 $\\ln(A) - \\ln(B) = \\ln(A/B)$，我们简化表达式：\n$$\\psi(r) = \\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(\\frac{q_{0} + \\frac{q_{2}}{a^{2}}r^{2}}{q_{0}}\\right) = \\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\left(\\frac{r}{a}\\right)^{2}\\right)$$\n这个 $\\psi(r)$ 的表达式使得归一化因子 $\\psi(a)$ 可以自洽地确定，该因子对应于最外闭合磁通面 $r=a$ 内部的总极向磁通：\n$$\\psi(a) = \\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\left(\\frac{a}{a}\\right)^{2}\\right) = \\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\right)$$\n现在我们可以使用归一化极向磁通半径 $\\rho_{\\text{pol}}(r)$ 的定义来构建它：\n$$\\rho_{\\text{pol}}(r) = \\sqrt{\\frac{\\psi(r) - \\psi(0)}{\\psi(a) - \\psi(0)}}$$\n在 $\\psi(0)=0$ 的条件下：\n$$\\rho_{\\text{pol}}(r) = \\sqrt{\\frac{\\psi(r)}{\\psi(a)}} = \\sqrt{\\frac{\\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\left(\\frac{r}{a}\\right)^{2}\\right)}{\\frac{B_{t} a^{2}}{2q_{2}} \\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\right)}}$$\n常数前置因子 $\\frac{B_{t} a^{2}}{2q_{2}}$ 消去，得到 $\\rho_{\\text{pol}}(r)$ 关于给定参数的最终表达式：\n$$\\rho_{\\text{pol}}(r) = \\sqrt{\\frac{\\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\left(\\frac{r}{a}\\right)^{2}\\right)}{\\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\right)}}$$\n此推导依赖于问题中指定的大环径比、圆形磁通面近似的有效性，以及轴对称性的假设，该假设允许将 $\\psi$ 仅视为 $r$ 的函数。结果是无量纲的，并且只依赖于安全因子位形的形状参数（$q_{0}$、$q_{2}$）和几何参数（$r$、$a$），这与预期相符。",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\left(\\frac{r}{a}\\right)^{2}\\right)}{\\ln\\left(1 + \\frac{q_{2}}{q_{0}}\\right)}}}$$"
        },
        {
            "introduction": "掌握了坐标变换后，下一步是进行严格的模型与实验数据的比较。一个常见的误区是假设测量误差是完全独立的，但这往往与事实不符，因为诊断系统通常存在影响整个剖面的系统性误差。本练习将深入探讨这一关键问题，你将学习如何构建一个包含共享系统误差（如绝对标定因子和背景偏移）的协方差矩阵，并计算正确的卡方（$\\chi^2$）统计量，从而进行更为严谨和可靠的验证 。",
            "id": "4032708",
            "problem": "一个聚变装置剖面数据库被用来验证一个芯部输运模型，其方法是将存储的电子温度剖面与模型预测进行比较。考虑数据库中的一次放电条目，其中电子温度（用 $x(r)$ 表示）在 $N=3$ 个归一化磁通面半径 $r_1$、$r_2$ 和 $r_3$ 处被测量。除了逐点的统计噪声外，这些测量还受到两种覆盖整个放电范围的系统性校准误差的影响：一个乘性绝对校准因子误差和一个加性背景偏移误差。假设每个剖面点都遵循以下随机测量模型：\n- 在 $r_i$ 处的测量满足 $x(r_i) = (1 + k)\\,x_{\\mathrm{true}}(r_i) + b + \\epsilon_i$，其中 $k$ 是一个零均值的乘性校准误差，$b$ 是一个零均值的加性偏移误差，$\\epsilon_i$ 是一个零均值的统计噪声项。\n- 变量 $k$、$b$ 以及向量 $\\boldsymbol{\\epsilon} = (\\epsilon_1,\\epsilon_2,\\epsilon_3)^{\\mathsf{T}}$ 相互独立，且 $k \\sim \\mathcal{N}(0,\\sigma_k^2)$，$b \\sim \\mathcal{N}(0,\\sigma_b^2)$，以及 $\\epsilon_i \\sim \\mathcal{N}(0,\\sigma_i^2)$。\n- 你可以假设处于小误差情形，并围绕模型预测进行线性化，因此在方差或协方差中任何出现 $x_{\\mathrm{true}}(r_i)$ 的地方，你都可以用 $x_{\\mathrm{model}}(r_i)$ 来代替。\n\n该数据库条目为这次放电提供了以下信息：\n- 三个半径处的模型预测值为 $x_{\\mathrm{model}}(r_1) = 2.0$，$x_{\\mathrm{model}}(r_2) = 1.5$，$x_{\\mathrm{model}}(r_3) = 1.0$（单位为 $\\mathrm{keV}$）。\n- 相应的测量值为 $x(r_1) = 2.1$，$x(r_2) = 1.6$，$x(r_3) = 0.9$（单位为 $\\mathrm{keV}$）。\n- 逐点的统计标准差为 $\\sigma_1 = 0.1$，$\\sigma_2 = 0.1$，$\\sigma_3 = 0.1$（单位为 $\\mathrm{keV}$）。\n- 校准元数据报告了分数绝对校准不确定度 $\\sigma_k = 0.05$ 和加性背景不确定度 $\\sigma_b = 0.05$（单位为 $\\mathrm{keV}$）。\n\n任务：\n1) 从协方差的定义、独立零均值高斯变量的性质以及小误差情形下的线性化出发，推导出协方差结构 $C_{ij} = \\mathrm{Cov}\\!\\left[x(r_i), x(r_j)\\right]$，并用 $\\delta_{ij}$、$\\sigma_i$、$\\sigma_k$、$\\sigma_b$ 和 $x_{\\mathrm{model}}(r_i)$ 表示。\n2) 使用推导出的协方差，为这次放电构建完整的协方差矩阵 $\\mathbf{C}$，并计算与卡方统计量 $\\chi^2 = \\boldsymbol{d}^{\\mathsf{T}} \\mathbf{C}^{-1} \\boldsymbol{d}$ 相关的二次型，其中残差向量为 $\\boldsymbol{d} = \\big(x(r_1)-x_{\\mathrm{model}}(r_1),\\,x(r_2)-x_{\\mathrm{model}}(r_2),\\,x(r_3)-x_{\\mathrm{model}}(r_3)\\big)^{\\mathsf{T}}$。\n3) 为了进行比较，计算朴素的、不相关的卡方值 $\\chi^2_{\\mathrm{naive}}$，该计算忽略了共享的校准误差，仅将不确定度视为不相关的，其方差为 $\\sigma_i^2$。\n4) 定义过高估计因子 $R = \\chi^2_{\\mathrm{naive}} / \\chi^2$，该因子用于量化共享系统误差对基于卡方的验证决策的影响。以最简分数的形式给出 $R$ 作为最终答案。不需要单位。不要四舍五入。",
            "solution": "问题陈述已经过验证，被认为具有科学依据、是良定的、客观且内部一致的。它提出了一个在实验物理和工程学科中常见的统计数据分析和模型验证的标准问题。所有必要的数据和定义都已提供，足以得出一个唯一的、有意义的解。\n\n解答过程按顺序处理四个任务。\n\n任务1：推导协方差结构 $C_{ij}$。\n\n在归一化磁通面半径 $r_i$ 处的测量由以下随机模型给出：\n$$x(r_i) = (1 + k)\\,x_{\\mathrm{true}}(r_i) + b + \\epsilon_i$$\n此处，$k$、$b$ 和 $\\epsilon_i$ 分别是方差为 $\\sigma_k^2$、$\\sigma_b^2$ 和 $\\sigma_i^2$ 的独立的、零均值的高斯随机变量。我们记 $x_i = x(r_i)$ 和 $x_{i, \\mathrm{true}} = x_{\\mathrm{true}}(r_i)$。\n\n两个测量值 $x_i$ 和 $x_j$ 之间的协方差定义为 $C_{ij} = \\mathrm{Cov}(x_i, x_j) = E[(x_i - E[x_i])(x_j - E[x_j])]$。首先，我们求 $x_i$ 的期望值：\n$$E[x_i] = E[(1 + k)x_{i, \\mathrm{true}} + b + \\epsilon_i] = E[x_{i, \\mathrm{true}} + k x_{i, \\mathrm{true}} + b + \\epsilon_i]$$\n利用期望的线性性质以及 $E[k] = 0$、$E[b] = 0$ 和 $E[\\epsilon_i] = 0$ 的事实：\n$$E[x_i] = x_{i, \\mathrm{true}} + E[k]x_{i, \\mathrm{true}} + E[b] + E[\\epsilon_i] = x_{i, \\mathrm{true}}$$\n测量值与其期望（真实）值的偏差为：\n$$x_i - E[x_i] = x_i - x_{i, \\mathrm{true}} = k x_{i, \\mathrm{true}} + b + \\epsilon_i$$\n现在我们计算协方差：\n$$C_{ij} = E[(x_i - x_{i, \\mathrm{true}})(x_j - x_{j, \\mathrm{true}})] = E[(k x_{i, \\mathrm{true}} + b + \\epsilon_i)(k x_{j, \\mathrm{true}} + b + \\epsilon_j)]$$\n展开乘积：\n$$C_{ij} = E[k^2 x_{i, \\mathrm{true}} x_{j, \\mathrm{true}} + k b (x_{i, \\mathrm{true}} + x_{j, \\mathrm{true}}) + b^2 + k(x_{i, \\mathrm{true}}\\epsilon_j + x_{j, \\mathrm{true}}\\epsilon_i) + b(\\epsilon_i + \\epsilon_j) + \\epsilon_i \\epsilon_j]$$\n由于 $k$、$b$ 和 $\\epsilon_i$ 的相互独立性和零均值性质，任何交叉项的期望均为零（例如，$E[kb] = E[k]E[b]=0$）。唯一非零的期望是平方项：$E[k^2] = \\sigma_k^2$、$E[b^2] = \\sigma_b^2$ 和 $E[\\epsilon_i \\epsilon_j]$。不同点的统计噪声项 $\\epsilon_i$ 是独立的，因此对于 $i \\neq j$ 有 $E[\\epsilon_i \\epsilon_j] = 0$，而 $E[\\epsilon_i^2] = \\sigma_i^2$。这可以使用克罗内克δ函数 $\\delta_{ij}$ 紧凑地写作 $E[\\epsilon_i \\epsilon_j] = \\sigma_i^2 \\delta_{ij}$。\n\n将这些代入 $C_{ij}$ 的展开式中：\n$$C_{ij} = \\sigma_k^2 x_{i, \\mathrm{true}} x_{j, \\mathrm{true}} + \\sigma_b^2 + \\sigma_i^2 \\delta_{ij}$$\n问题允许在小误差情形下进行线性化，即用模型预测值 $x_{\\mathrm{model}}(r_i)$（我们记作 $x_{i, \\mathrm{model}}$）替换真实值 $x_{i, \\mathrm{true}}$。因此，协方差结构的最终表达式为：\n$$C_{ij} = \\sigma_k^2 x_{i, \\mathrm{model}} x_{j, \\mathrm{model}} + \\sigma_b^2 + \\sigma_i^2 \\delta_{ij}$$\n\n任务2：构建协方差矩阵 $\\mathbf{C}$ 并计算 $\\chi^2$。\n\n我们已知以下数值：\n- 模型预测值：$\\mathbf{x}_{\\mathrm{model}} = (x_{1, \\mathrm{model}}, x_{2, \\mathrm{model}}, x_{3, \\mathrm{model}})^{\\mathsf{T}} = (2.0, 1.5, 1.0)^{\\mathsf{T}}$。\n- 测量值：$\\mathbf{x} = (x_1, x_2, x_3)^{\\mathsf{T}} = (2.1, 1.6, 0.9)^{\\mathsf{T}}$。\n- 统计标准差：$\\sigma_1 = \\sigma_2 = \\sigma_3 = 0.1$，所以对于所有 $i$ 有 $\\sigma_i^2 = 0.01$。\n- 校准不确定度：$\\sigma_k = 0.05$（所以 $\\sigma_k^2 = 0.0025$）以及 $\\sigma_b = 0.05$（所以 $\\sigma_b^2 = 0.0025$）。\n\n残差向量为 $\\mathbf{d} = \\mathbf{x} - \\mathbf{x}_{\\mathrm{model}} = (0.1, 0.1, -0.1)^{\\mathsf{T}}$。\n\n我们计算 $3 \\times 3$ 协方差矩阵 $\\mathbf{C}$ 的元素：\n$C_{11} = (0.05)^2 (2.0)^2 + (0.05)^2 + (0.1)^2 = 0.0025 \\cdot 4 + 0.0025 + 0.01 = 0.01 + 0.0025 + 0.01 = 0.0225$。\n$C_{22} = (0.05)^2 (1.5)^2 + (0.05)^2 + (0.1)^2 = 0.0025 \\cdot 2.25 + 0.0025 + 0.01 = 0.005625 + 0.0025 + 0.01 = 0.018125$。\n$C_{33} = (0.05)^2 (1.0)^2 + (0.05)^2 + (0.1)^2 = 0.0025 \\cdot 1 + 0.0025 + 0.01 = 0.005 + 0.01 = 0.015$。\n$C_{12} = C_{21} = (0.05)^2 (2.0)(1.5) + (0.05)^2 = 0.0025 \\cdot 3 + 0.0025 = 0.01$。\n$C_{13} = C_{31} = (0.05)^2 (2.0)(1.0) + (0.05)^2 = 0.0025 \\cdot 2 + 0.0025 = 0.0075$。\n$C_{23} = C_{32} = (0.05)^2 (1.5)(1.0) + (0.05)^2 = 0.0025 \\cdot 1.5 + 0.0025 = 0.00625$。\n\n完整的协方差矩阵 $\\mathbf{C}$ 为：\n$$ \\mathbf{C} = \\begin{pmatrix} 0.0225 & 0.01 & 0.0075 \\\\ 0.01 & 0.018125 & 0.00625 \\\\ 0.0075 & 0.00625 & 0.015 \\end{pmatrix} $$\n为了计算 $\\chi^2 = \\mathbf{d}^{\\mathsf{T}} \\mathbf{C}^{-1} \\mathbf{d}$，我们首先求 $\\mathbf{C}$ 的逆矩阵。使用分数进行计算在计算上更有利。\n$\\sigma_k^2 = (\\frac{1}{20})^2=\\frac{1}{400}$，$\\sigma_b^2 = \\frac{1}{400}$，$\\sigma_i^2 = (\\frac{1}{10})^2=\\frac{1}{100}$。 $x_{1, \\mathrm{model}}=2, x_{2, \\mathrm{model}}=\\frac{3}{2}, x_{3, \\mathrm{model}}=1$。\n$C_{11} = \\frac{4}{400}+\\frac{1}{400}+\\frac{4}{400}=\\frac{9}{400}$。 $C_{22} = \\frac{9/4}{400}+\\frac{1}{400}+\\frac{4}{400}=\\frac{9}{1600}+\\frac{4}{1600}+\\frac{16}{1600}=\\frac{29}{1600}$。 $C_{33} = \\frac{1}{400}+\\frac{1}{400}+\\frac{4}{400}=\\frac{6}{400}$。\n$C_{12} = \\frac{3}{400}+\\frac{1}{400}=\\frac{4}{400}$。 $C_{13} = \\frac{2}{400}+\\frac{1}{400}=\\frac{3}{400}$。 $C_{23} = \\frac{3/2}{400}+\\frac{1}{400}=\\frac{5}{800}$。\n$$ \\mathbf{C} = \\frac{1}{1600} \\begin{pmatrix} 36 & 16 & 12 \\\\ 16 & 29 & 10 \\\\ 12 & 10 & 24 \\end{pmatrix} $$\n令 $\\mathbf{M}$ 为内部矩阵。$\\mathbf{M}$ 的行列式为 $\\det(\\mathbf{M}) = 14976$。逆矩阵为 $\\mathbf{C}^{-1} = 1600 \\cdot \\mathbf{M}^{-1} = 1600 \\frac{\\mathrm{adj}(\\mathbf{M})}{\\det(\\mathbf{M})}$。\n$$ \\mathrm{adj}(\\mathbf{M}) = \\begin{pmatrix} 596 & -264 & -188 \\\\ -264 & 720 & -168 \\\\ -188 & -168 & 788 \\end{pmatrix} $$\n$$ \\mathbf{C}^{-1} = \\frac{1600}{14976} \\mathrm{adj}(\\mathbf{M}) = \\frac{25}{234} \\mathrm{adj}(\\mathbf{M}) $$\n卡方统计量为 $\\chi^2 = \\mathbf{d}^{\\mathsf{T}} \\mathbf{C}^{-1} \\mathbf{d}$：\n$$ \\chi^2 = (0.1, 0.1, -0.1) \\frac{25}{234} \\begin{pmatrix} 596 & -264 & -188 \\\\ -264 & 720 & -168 \\\\ -188 & -168 & 788 \\end{pmatrix} \\begin{pmatrix} 0.1 \\\\ 0.1 \\\\ -0.1 \\end{pmatrix} $$\n$$ \\chi^2 = \\frac{0.01 \\times 25}{234} (1, 1, -1) \\begin{pmatrix} 596 & -264 & -188 \\\\ -264 & 720 & -168 \\\\ -188 & -168 & 788 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix} $$\n二次型计算结果为：\n$$ (1, 1, -1) \\begin{pmatrix} 596-264+188 \\\\ -264+720+168 \\\\ -188-168-788 \\end{pmatrix} = (1, 1, -1) \\begin{pmatrix} 520 \\\\ 624 \\\\ -1144 \\end{pmatrix} = 520+624+1144 = 2288 $$\n$$ \\chi^2 = \\frac{0.25}{234} \\times 2288 = \\frac{1}{4} \\frac{2288}{234} = \\frac{572}{234} = \\frac{286}{117} = \\frac{22 \\times 13}{9 \\times 13} = \\frac{22}{9} $$\n\n任务3：计算朴素的、不相关的卡方值 $\\chi^2_{\\mathrm{naive}}$。\n\n这个计算忽略了共享的系统误差，将测量值视为独立的。协方差矩阵变为对角矩阵，其元素仅为统计方差 $\\sigma_i^2$。\n$$ \\mathbf{C}_{\\mathrm{naive}} = \\mathrm{diag}(\\sigma_1^2, \\sigma_2^2, \\sigma_3^2) = \\mathrm{diag}(0.01, 0.01, 0.01) $$\n卡方值计算如下：\n$$ \\chi^2_{\\mathrm{naive}} = \\sum_{i=1}^3 \\frac{(x_i - x_{i, \\mathrm{model}})^2}{\\sigma_i^2} = \\frac{d_1^2}{\\sigma_1^2} + \\frac{d_2^2}{\\sigma_2^2} + \\frac{d_3^2}{\\sigma_3^2} $$\n$$ \\chi^2_{\\mathrm{naive}} = \\frac{(0.1)^2}{(0.1)^2} + \\frac{(0.1)^2}{(0.1)^2} + \\frac{(-0.1)^2}{(0.1)^2} = 1 + 1 + 1 = 3 $$\n\n任务4：计算过高估计因子 $R$。\n\n因子 $R$ 量化了朴素卡方值与正确卡方值的比率。\n$$ R = \\frac{\\chi^2_{\\mathrm{naive}}}{\\chi^2} = \\frac{3}{22/9} = 3 \\times \\frac{9}{22} = \\frac{27}{22} $$\n朴素计算通过忽略共享系统误差所引起的正相关，从而过高估计了模型与数据不匹配的统计显著性。",
            "answer": "$$\\boxed{\\frac{27}{22}}$$"
        },
        {
            "introduction": "最后，我们将把技能从单次放电的验证提升到利用大型数据库进行跨装置研究的更高层次。剖面数据库的真正威力在于能够汇集来自不同实验装置的数据，以揭示普适的物理规律。在这项综合实践中，你将运用统计回归和方差分析方法，从一个假设的多装置数据库中提取基座电子温度的标度律，并学习如何利用这种标度律来设定跨装置验证的合理预期，这代表了数据库在聚变科学验证中的前沿应用 。",
            "id": "4032768",
            "problem": "一项计算聚变科学与工程验证研究旨在使用多装置剖面数据库，量化台基电子温度高度如何随环形磁场和外部加热功率进行标度变化。其目标是推导出一个既有科学依据又可检验的跨装置标度关系，然后通过考虑装置间的变异性，用它来调整对目标装置的验证预期。\n\n出发点和科学基础：台基能量平衡由能量守恒和输运决定。外部注入的加热功率被从台基区向外的跨场热输运所平衡。根据量纲推理和聚变实验中经过充分检验的经验观测，台基电子温度 $T_{e,\\text{ped}}$ 通常表现出对环形磁场 $B_T$ 和总加热功率 $P_{\\text{heat}}$ 的幂律依赖关系。这启发了以下模型\n$$\nT_{e,\\text{ped}} \\propto B_T^{a}\\, P_{\\text{heat}}^{b},\n$$\n其中的指数 $a$ 和 $b$ 有待推断。对数变换产生一个线性关系，\n$$\n\\ln T_{e,\\text{ped}} = \\ln C + a \\ln B_T + b \\ln P_{\\text{heat}},\n$$\n其中 $C$ 是一个常数前因子。在不同装置之间，可能由于几何构型、壁条件或运行细节而存在系统性偏差。这些偏差在统计上可以表示为装置层面的随机效应，与装置内的变异性相比，它们拓宽了跨装置的预期范围。\n\n数据库：使用以下关于台基电子温度高度的多装置数据集。每个元组为 $(B_T, P_{\\text{heat}}, T_{e,\\text{ped}})$，其中 $B_T$ 的单位是特斯拉，$P_{\\text{heat}}$ 的单位是兆瓦，$T_{e,\\text{ped}}$ 的单位是电子伏特。装置标记为 $\\text{D1}$、$\\text{D2}$、$\\text{D3}$、$\\text{D4}$。\n\n装置 $\\text{D1}$:\n- $(\\,$ $2.0$, $5.0$, $410.0$ $\\,)$\n- $(\\,$ $2.5$, $8.0$, $535.0$ $\\,)$\n- $(\\,$ $2.5$, $10.0$, $561.0$ $\\,)$\n- $(\\,$ $3.0$, $5.0$, $493.0$ $\\,)$\n- $(\\,$ $3.0$, $8.0$, $597.0$ $\\,)$\n- $(\\,$ $3.5$, $10.0$, $672.0$ $\\,)$\n\n装置 $\\text{D2}$:\n- $(\\,$ $2.0$, $6.0$, $373.0$ $\\,)$\n- $(\\,$ $2.5$, $4.0$, $354.0$ $\\,)$\n- $(\\,$ $3.0$, $12.0$, $559.0$ $\\,)$\n- $(\\,$ $3.0$, $8.0$, $500.0$ $\\,)$\n- $(\\,$ $3.5$, $6.0$, $498.0$ $\\,)$\n- $(\\,$ $4.0$, $10.0$, $612.0$ $\\,)$\n\n装置 $\\text{D3}$:\n- $(\\,$ $1.5$, $5.0$, $329.0$ $\\,)$\n- $(\\,$ $2.0$, $8.0$, $435.0$ $\\,)$\n- $(\\,$ $3.0$, $10.0$, $581.0$ $\\,)$\n- $(\\,$ $3.5$, $12.0$, $676.0$ $\\,)$\n- $(\\,$ $4.0$, $5.0$, $511.0$ $\\,)$\n- $(\\,$ $5.0$, $8.0$, $708.0$ $\\,)$\n\n装置 $\\text{D4}$:\n- $(\\,$ $2.0$, $3.0$, $271.0$ $\\,)$\n- $(\\,$ $2.5$, $6.0$, $394.0$ $\\,)$\n- $(\\,$ $3.0$, $4.0$, $372.0$ $\\,)$\n- $(\\,$ $3.5$, $8.0$, $501.0$ $\\,)$\n- $(\\,$ $4.0$, $6.0$, $499.0$ $\\,)$\n- $(\\,$ $5.0$, $10.0$, $660.0$ $\\,)$\n\n任务：\n1. 通过在整个数据库上，在对数变换空间中对模型 $\\ln T_{e,\\text{ped}} = \\ln C + a \\ln B_T + b \\ln P_{\\text{heat}}$ 最小化误差平方和，来推断标度指数 $a$ 和 $b$以及前因子 $C$。\n2. 计算残差 $r_i = \\ln T_{e,\\text{ped},i} - (\\ln C + a \\ln B_{T,i} + b \\ln P_{\\text{heat},i})$，并将变异性分解为装置间分量和装置内分量。设 $m_d$ 为装置 $d$ 的平均残差，并设 $w_i = r_i - m_{d(i)}$ 为数据点 $i$ 的装置内残差。从 $\\{w_i\\}$ 估计装置内方差 $\\sigma_e^2$，从 $\\{m_d\\}$ 估计装置间方差 $\\sigma_d^2$，同时考虑由 $\\sigma_e^2 / n_d$ 引起的有限样本校正，其中 $n_d$ 是装置 $d$ 的数据点数量。使用 $D = 4$ 个装置和总数据点数 $N = 24$。\n3. 为了进行跨装置验证，按如下方式为预测的 $\\ln T_{e,\\text{ped}}$ 定义一个置信水平为 $0.95$ 的调整后置信区间：\n   - 对于数据库中没有的新装置，使用总标准差 $\\sqrt{\\sigma_d^2 + \\sigma_e^2}$。\n   - 对于数据库中已存在的现有装置，仅使用装置内标准差 $\\sqrt{\\sigma_e^2}$。\n   设 $z$ 为标准正态分布的双侧分位数，使得覆盖率为 $0.95$。在对数空间中构建区间 $[\\hat{y} - z s, \\hat{y} + z s]$。通过指数函数将其映射回电子伏特单位，得到 $[T_{\\text{low}}, T_{\\text{high}}]$。\n4. 将该标度关系应用于下面的测试套件，并评估每个案例中测量的台基电子温度是否与调整后的预期一致。对于每个案例，计算预测的台基电子温度 $T_{e,\\text{pred}}$（单位为电子伏特），并在提供测量值的情况下，输出一个布尔值，指示测量值是否落在调整后的置信区间内。\n\n测试套件：\n- 案例 $1$ (新装置): $B_T = 2.5$ (特斯拉)，$P_{\\text{heat}} = 10.0$ (兆瓦)，测量的 $T_{e,\\text{ped}} = 560.0$ (电子伏特)。\n- 案例 $2$ (新装置，边界情况): $B_T = 1.5$ (特斯拉)，$P_{\\text{heat}} = 3.0$ (兆瓦)，测量的 $T_{e,\\text{ped}} = 210.0$ (电子伏特)。\n- 案例 $3$ (新装置，边缘情况): $B_T = 5.0$ (特斯拉)，$P_{\\text{heat}} = 8.0$ (兆瓦)，测量的 $T_{e,\\text{ped}} = 750.0$ (电子伏特)。\n- 案例 $4$ (现有装置 $\\text{D2}$): $B_T = 3.0$ (特斯拉)，$P_{\\text{heat}} = 12.0$ (兆瓦)，测量的 $T_{e,\\text{ped}} = 520.0$ (电子伏特)。\n- 案例 $5$ (仅预测): $B_T = 2.0$ (特斯拉)，$P_{\\text{heat}} = 5.0$ (兆瓦)，无测量值；仅报告 $T_{e,\\text{pred}}$。\n\n答案规格：\n- 物理单位：所有台基电子温度均以电子伏特表示。\n- 置信水平：使用 $0.95$ 及其相应的双侧正态分位数 $z$。\n- 输出格式：您的程序应产生单行输出，包含一个用方括号括起来的逗号分隔列表。该列表必须是 $[b_1,b_2,b_3,b_4,t_5]$，其中 $b_k$ 是案例1到4的布尔值（如果测量值在调整后的区间内，则为True，否则为False），$t_5$ 是案例5的预测台基电子温度，以浮点数形式表示，并保留一位小数。例如，一个有效的输出将类似于 $[\\,\\text{True},\\text{False},\\text{True},\\text{False},362.0\\,]$。",
            "solution": "目标是利用一个多装置剖面数据库，为台基电子温度高度构建一个有物理动机、经过统计校准且可通过算法实现的跨装置标度关系，该关系是环形磁场和总加热功率的函数，然后用它来调整跨装置的验证预期。\n\n原理推导：\n\n1. 物理基础和标度形式。在台基区，能量守恒要求沉积在等离子体中的外部加热功率必须与输运损失相平衡。台基处的跨场热通量 $q$ 由输运系数决定，而输运系数又依赖于磁场强度和热力学梯度。对于一大类由微不稳定性主导的输运机制，无量纲分析和经验观测支持电子温度高度与控制参数（如 $B_T$ 和 $P_{\\text{heat}}$）之间存在幂律关系。这引出了以下假设\n$$\nT_{e,\\text{ped}} \\propto B_T^{a} P_{\\text{heat}}^{b},\n$$\n其中未知指数 $a$ 和 $b$ 将从数据中估计。该模型足够普适，可在不同装置上进行检验，同时其物理基础在于：更强的磁场和增加的加热往往会提高温度。\n\n2. 线性化与估计。为了估计参数，对两边取对数得到\n$$\n\\ln T_{e,\\text{ped}} = \\ln C + a \\ln B_T + b \\ln P_{\\text{heat}},\n$$\n其中 $C$ 是一个待定的前因子。这是一个关于变量 $\\ln B_T$ 和 $\\ln P_{\\text{heat}}$ 的线性模型。定义 $y_i = \\ln T_{e,\\text{ped},i}$，$x_{1,i} = \\ln B_{T,i}$，以及 $x_{2,i} = \\ln P_{\\text{heat},i}$。将数据堆叠成一个设计矩阵\n$$\nX = \\begin{bmatrix}\n1 & x_{1,1} & x_{2,1} \\\\\n\\vdots & \\vdots & \\vdots \\\\\n1 & x_{1,N} & x_{2,N}\n\\end{bmatrix}, \\quad y = \\begin{bmatrix} y_1 \\\\ \\vdots \\\\ y_N \\end{bmatrix}.\n$$\n通过最小化残差平方和 $\\sum_{i=1}^{N} (y_i - X_i \\beta)^2$ 来估计 $\\beta = [\\ln C, a, b]^T$，其中 $X_i$ 是 $X$ 的第 $i$ 行。最小二乘解为\n$$\n\\hat{\\beta} = (X^T X)^{-1} X^T y,\n$$\n从而得到 $\\widehat{\\ln C}$、$\\hat{a}$ 和 $\\hat{b}$。对于一个新的 $(B_T, P_{\\text{heat}})$ 对，预测的对数温度为\n$$\n\\hat{y} = \\widehat{\\ln C} + \\hat{a} \\ln B_T + \\hat{b} \\ln P_{\\text{heat}}, \\quad T_{e,\\text{pred}} = \\exp(\\hat{y}).\n$$\n\n3. 跨装置的变异性分解。由于数据库跨越多个装置，可能会出现装置层面的系统性偏差。设残差为 $r_i = y_i - X_i \\hat{\\beta}$。对于每个索引集为 $I_d$、样本数为 $n_d$ 的装置 $d$，定义装置平均残差\n$$\nm_d = \\frac{1}{n_d} \\sum_{i \\in I_d} r_i,\n$$\n以及装置内残差\n$$\nw_i = r_i - m_{d(i)},\n$$\n其中 $d(i)$ 表示数据点 $i$ 所在的装置。装置内方差可以通过无偏估计量\n$$\n\\hat{\\sigma}_e^2 = \\frac{1}{N - D} \\sum_{d=1}^{D} \\sum_{i \\in I_d} w_i^2,\n$$\n来估计，其中 $D$ 是装置的数量。装置均值 $\\{m_d\\}$ 的变异可用于估计装置间方差，但每个 $m_d$ 都包含一个由装置内噪声 $\\sigma_e^2$（按 $n_d^{-1}$ 缩放）产生的贡献。通过减去平均的装置内贡献，可以得到一个校正后的估计量：\n$$\n\\operatorname{Var}_{\\text{unb}}(m_d) = \\frac{1}{D - 1} \\sum_{d=1}^{D} \\left(m_d - \\overline{m}\\right)^2, \\quad \\overline{m} = \\frac{1}{D} \\sum_{d=1}^{D} m_d,\n$$\n$$\n\\hat{\\sigma}_d^2 = \\max\\left(0,\\ \\operatorname{Var}_{\\text{unb}}(m_d) - \\frac{1}{D} \\sum_{d=1}^{D} \\frac{\\hat{\\sigma}_e^2}{n_d} \\right).\n$$\n与 $0$ 取最大值可确保方差估计为非负。\n\n4. 调整后的验证预期。对于置信水平为 $0.95$ 的跨装置验证，在对数空间中使用正态近似。设 $z$ 为标准正态随机变量的双侧分位数，使得区间 $[-z,z]$ 的覆盖率为 $0.95$。然后将用于预测的标准差定义为\n$$\ns_{\\text{new}} = \\sqrt{\\hat{\\sigma}_d^2 + \\hat{\\sigma}_e^2} \\quad \\text{对于新装置},\n$$\n$$\ns_{\\text{existing}} = \\sqrt{\\hat{\\sigma}_e^2} \\quad \\text{对于数据库中已存在的装置}。\n$$\n在对数空间中，调整后的置信区间为 $[\\hat{y} - z s, \\hat{y} + z s]$，其中 $s$ 被适当地选择；在电子伏特单位下，该区间为 $[T_{\\text{low}}, T_{\\text{high}}] = [\\exp(\\hat{y} - z s), \\exp(\\hat{y} + z s)]$。如果测量的台基电子温度 $T_{e,\\text{meas}}$ 满足 $T_{\\text{low}} \\le T_{e,\\text{meas}} \\le T_{\\text{high}}$，则认为其是一致的。\n\n算法实现细节：\n- 构建数据库向量 $B_T$、$P_{\\text{heat}}$、$T_{e,\\text{ped}}$ 和装置标签。\n- 在对数空间中构建 $X$ 和 $y$，并使用最小二乘法求解 $\\hat{\\beta}$。\n- 计算残差 $r_i$，按装置分组以计算 $m_d$、$w_i$，然后使用上述公式计算 $\\hat{\\sigma}_e^2$ 和 $\\hat{\\sigma}_d^2$。\n- 对于每个测试案例，计算 $\\hat{y}$，根据装置是新的还是已有的来选择 $s$，构建区间边界 $T_{\\text{low}}$ 和 $T_{\\text{high}}$，并在提供测量值 $T_{e,\\text{meas}}$ 的情况下进行比较。同时计算 $T_{e,\\text{pred}} = \\exp(\\hat{y})$。\n- 报告案例1至4的布尔值，以及案例5的预测台基电子温度（保留一位小数），格式为指定的单行列表，所有温度单位均为电子伏特。\n\n科学真实性：数据库中的值涵盖了在一定范围的环形磁场（特斯拉）和加热功率（兆瓦）下，合理的台基电子温度（电子伏特）。回归和方差分解是聚变剖面数据库中经验标度分析的标准且经过充分检验的方法，而调整后的预期则基于装置层面的变异性建模。置信水平被指定为小数值概率 $0.95$，避免了百分比表示法。\n\n```python\nimport numpy as np\n\ndef fit_log_linear_scaling(BT, Pheat, Te):\n    \"\"\"\n    Fit ln(Te) = beta0 + a*ln(BT) + b*ln(Pheat) via least squares.\n    Returns beta0, a, b and residuals.\n    \"\"\"\n    y = np.log(Te)\n    X = np.column_stack([np.ones_like(BT), np.log(BT), np.log(Pheat)])\n    beta, *_ = np.linalg.lstsq(X, y, rcond=None)\n    residuals = y - X @ beta\n    return beta, residuals\n\ndef variance_components(residuals, devices):\n    \"\"\"\n    Compute within-device (sigma_e^2) and between-device (sigma_d^2) variance\n    components from residuals using device means and within-device residuals.\n    \"\"\"\n    # Map devices to indices\n    unique_devices = np.unique(devices)\n    D = len(unique_devices)\n    N = len(residuals)\n    m_d = []\n    n_d = []\n    device_mean = {}\n    # Compute mean residual per device\n    for d in unique_devices:\n        idx = np.where(devices == d)[0]\n        r_d = residuals[idx]\n        md = np.mean(r_d)\n        device_mean[d] = md\n        m_d.append(md)\n        n_d.append(len(idx))\n    m_d = np.array(m_d)\n    n_d = np.array(n_d)\n    # Within-device residuals\n    w = np.zeros_like(residuals)\n    for i in range(N):\n        w[i] = residuals[i] - device_mean[devices[i]]\n    # Unbiased within-device variance\n    sigma_e2 = np.sum(w**2) / (N - D)\n    # Unbiased variance of device means (unweighted)\n    m_bar = np.mean(m_d)\n    var_m_unb = np.sum((m_d - m_bar)**2) / (D - 1)\n    # Correction for finite within-device noise in means\n    avg_noise = np.mean(sigma_e2 / n_d)\n    sigma_d2 = max(0.0, var_m_unb - avg_noise)\n    return sigma_e2, sigma_d2\n\ndef predict_log(beta, BT, Pheat):\n    \"\"\"\n    Predict ln(Te) given beta and inputs.\n    \"\"\"\n    return beta[0] + beta[1]*np.log(BT) + beta[2]*np.log(Pheat)\n\ndef solve():\n    # Construct database\n    # Each entry: (device, BT [T], P_heat [MW], Te_ped [eV])\n    data = [\n        ('D1', 2.0, 5.0, 410.0),\n        ('D1', 2.5, 8.0, 535.0),\n        ('D1', 2.5, 10.0, 561.0),\n        ('D1', 3.0, 5.0, 493.0),\n        ('D1', 3.0, 8.0, 597.0),\n        ('D1', 3.5, 10.0, 672.0),\n\n        ('D2', 2.0, 6.0, 373.0),\n        ('D2', 2.5, 4.0, 354.0),\n        ('D2', 3.0, 12.0, 559.0),\n        ('D2', 3.0, 8.0, 500.0),\n        ('D2', 3.5, 6.0, 498.0),\n        ('D2', 4.0, 10.0, 612.0),\n\n        ('D3', 1.5, 5.0, 329.0),\n        ('D3', 2.0, 8.0, 435.0),\n        ('D3', 3.0, 10.0, 581.0),\n        ('D3', 3.5, 12.0, 676.0),\n        ('D3', 4.0, 5.0, 511.0),\n        ('D3', 5.0, 8.0, 708.0),\n\n        ('D4', 2.0, 3.0, 271.0),\n        ('D4', 2.5, 6.0, 394.0),\n        ('D4', 3.0, 4.0, 372.0),\n        ('D4', 3.5, 8.0, 501.0),\n        ('D4', 4.0, 6.0, 499.0),\n        ('D4', 5.0, 10.0, 660.0),\n    ]\n    devices = np.array([d for d, _, _, _ in data])\n    BT = np.array([bt for _, bt, _, _ in data], dtype=float)\n    Pheat = np.array([p for _, _, p, _ in data], dtype=float)\n    Te = np.array([te for _, _, _, te in data], dtype=float)\n\n    # Fit scaling\n    beta, residuals = fit_log_linear_scaling(BT, Pheat, Te)\n\n    # Variance components\n    sigma_e2, sigma_d2 = variance_components(residuals, devices)\n\n    # Confidence level 0.95 -> z approx 1.96 for two-sided normal\n    z = 1.96\n\n    # Test cases:\n    case1 = {'type': 'new', 'BT': 2.5, 'P': 10.0, 'Te_meas': 560.0}\n    case2 = {'type': 'new', 'BT': 1.5, 'P': 3.0, 'Te_meas': 210.0}\n    case3 = {'type': 'new', 'BT': 5.0, 'P': 8.0, 'Te_meas': 750.0}\n    case4 = {'type': 'existing', 'device': 'D2', 'BT': 3.0, 'P': 12.0, 'Te_meas': 520.0}\n    case5 = {'type': 'prediction', 'BT': 2.0, 'P': 5.0}\n\n    test_cases = [case1, case2, case3, case4, case5]\n\n    results = []\n    for case in test_cases:\n        if case['type'] == 'prediction':\n            y_pred = predict_log(beta, case['BT'], case['P'])\n            Te_pred = float(np.exp(y_pred))\n            results.append(round(Te_pred, 1))\n        else:\n            y_pred = predict_log(beta, case['BT'], case['P'])\n            if case['type'] == 'new':\n                s = np.sqrt(sigma_d2 + sigma_e2)\n            elif case['type'] == 'existing':\n                s = np.sqrt(sigma_e2)\n            \n            lower = np.exp(y_pred - z * s)\n            upper = np.exp(y_pred + z * s)\n            Te_meas = case['Te_meas']\n            ok = (Te_meas >= lower) and (Te_meas = upper)\n            results.append(ok)\n\n    # Final output format: single line, comma-separated list enclosed in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```",
            "answer": "[True,False,True,False,400.6]"
        }
    ]
}