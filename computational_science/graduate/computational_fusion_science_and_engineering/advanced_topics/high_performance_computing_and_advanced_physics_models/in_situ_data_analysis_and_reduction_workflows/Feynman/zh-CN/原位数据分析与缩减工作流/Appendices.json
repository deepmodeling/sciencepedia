{
    "hands_on_practices": [
        {
            "introduction": "在设计复杂的原位工作流之前，首先必须理解问题的规模。这项实践提供了一个基础的“信封背面”式计算练习，旨在量化模拟产生的海量数据以及简单压缩步骤对存储大小和I/O时间的直接、切实的益处。这项练习将“数据洪流”这一抽象概念用具体的数字加以阐明，为理解原位处理的必要性奠定了基础。",
            "id": "3994993",
            "problem": "在计算聚变科学中，一次高保真的湍流解析回旋动理学模拟在每个输出检查点都会生成一个原位标量诊断场。该场被离散化到一个包含 $512^3$ 个点的均匀网格上，每个样本存储为占用 $4$ 字节的单精度浮点值。在写入一个持续输入/输出（I/O）带宽为 $100$ 吉字节/秒的并行文件系统之前，一个节点上的原位压缩器对该场实现了 $10$ 的压缩比。为保证单位一致性，定义 $1$ 吉字节（GB）为 $10^9$ 字节。\n\n仅使用以下基本定义：(i) 数据大小等于样本数量与每样本字节数的乘积，(ii) 压缩比等于未压缩大小除以压缩后大小，以及 (iii) I/O 时间等于数据大小除以持续带宽，确定以下三个量：\n1. 未压缩数据的大小（以吉字节为单位）。\n2. 压缩后数据的大小（以吉字节为单位）。\n3. 在所述文件系统上写入压缩数据集所需的缩减 I/O 时间（以秒为单位）。\n\n将两个大小以 GB 表示，时间以秒表示。将这三个量中的每一个都四舍五入到四位有效数字。你的最终答案必须以单行矩阵的形式提供，其中包含按上述顺序列出的三个四舍五入后的值，不带单位。",
            "solution": "在进行求解之前，对问题陈述进行严格验证。\n\n### 第1步：提取已知条件\n- 网格离散化：$512^3$ 个点\n- 每样本字节数：$4$ 字节（单精度浮点数）\n- 压缩比，$C_r$：$10$\n- 持续I/O带宽，$R_{IO}$：$100$ 吉字节/秒\n- 吉字节（GB）的定义：$1 \\text{ GB} = 10^9 \\text{ 字节}$\n- 数据大小的定义：（样本数量） $\\times$ （每样本字节数）\n- 压缩比的定义：（未压缩大小） / （压缩后大小）\n- I/O时间的定义：（数据大小） / （持续带宽）\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于数据存储、压缩和传输速率等基本概念，这些是高性能计算和计算科学的核心。所提供的值（$512^3$ 网格、$4$ 字节浮点数、$10:1$ 压缩比、$100$ GB/s 带宽）对于当代大规模科学模拟是现实的。将吉字节明确定义为 $10^9$ 字节（而不是 $2^{30}$ 字节）是精确性的标志。\n- **良构性：** 提供了所有必要的数据和定义。要确定的三个量已明确指定，并且可以从已知条件中推导出唯一解。\n- **客观性：** 问题以精确、定量且无偏见的语言陈述。\n\n### 第3步：结论与行动\n该问题被认为是**有效的**，因为它是自洽的、科学上合理的且良构的。现在将推导一个正式的解。\n\n### 求解推导\n设 $N$ 为总样本数（网格点数），$B_s$ 为每样本字节数，$S_u$ 为未压缩数据大小，$S_c$ 为压缩后数据大小，$C_r$ 为压缩比，$R_{IO}$ 为 I/O 带宽，$T_{IO}$ 为 I/O 时间。\n\n已知值为：\n- $N = 512^3$\n- $B_s = 4$ 字节\n- $C_r = 10$\n- $R_{IO} = 100 \\text{ GB/s}$\n- 从字节到吉字节的转换因子是 $1 \\text{ GB} = 10^9 \\text{ 字节}$。\n\n要确定的三个量是：\n1. $S_u$（以 GB 为单位）。\n2. $S_c$（以 GB 为单位）。\n3. 压缩数据的 $T_{IO}$（以秒为单位）。\n\n**1. 未压缩数据大小 ($S_u$)**\n\n根据所提供的定义，未压缩数据的大小（以字节为单位）是样本数量与每样本字节数的乘积。\n$$S_{u, \\text{bytes}} = N \\times B_s$$\n代入已知值：\n$$S_{u, \\text{bytes}} = 512^3 \\times 4$$\n因为 $512 = 2^9$，我们有：\n$$S_{u, \\text{bytes}} = (2^9)^3 \\times 2^2 = 2^{27} \\times 2^2 = 2^{29} \\text{ 字节}$$\n$$S_{u, \\text{bytes}} = 536,870,912 \\text{ 字节}$$\n要将此大小转换为吉字节（GB），我们除以 $10^9$。\n$$S_u = \\frac{S_{u, \\text{bytes}}}{10^9} = \\frac{536,870,912}{10^9} \\text{ GB}$$\n$$S_u = 0.536870912 \\text{ GB}$$\n按要求四舍五入到四位有效数字：\n$$S_u \\approx 0.5369 \\text{ GB}$$\n\n**2. 压缩后数据大小 ($S_c$)**\n\n压缩比定义为未压缩大小除以压缩后大小。\n$$C_r = \\frac{S_u}{S_c}$$\n整理得到压缩后大小 $S_c$：\n$$S_c = \\frac{S_u}{C_r}$$\n为确保准确性，使用 $S_u$ 的未四舍五入值和给定的 $C_r$：\n$$S_c = \\frac{0.536870912 \\text{ GB}}{10}$$\n$$S_c = 0.0536870912 \\text{ GB}$$\n四舍五入到四位有效数字：\n$$S_c \\approx 0.05369 \\text{ GB}$$\n\n**3. 缩减的 I/O 时间 ($T_{IO}$)**\n\nI/O 时间定义为要写入的数据大小除以持续 I/O 带宽。要写入的数据是压缩数据集，因此其大小为 $S_c$。\n$$T_{IO} = \\frac{S_c}{R_{IO}}$$\n单位是一致的（$S_c$ 以 GB 为单位，$R_{IO}$ 以 GB/s 为单位），所以得到的时间将以秒为单位。\n为确保准确性，使用 $S_c$ 的未四舍五入值：\n$$T_{IO} = \\frac{0.0536870912 \\text{ GB}}{100 \\text{ GB/s}}$$\n$$T_{IO} = 0.000536870912 \\text{ s}$$\n四舍五入到四位有效数字：\n$$T_{IO} \\approx 0.0005369 \\text{ s}$$\n\n所要求的三个量，四舍五入到四位有效数字后，分别为 $0.5369$、$0.05369$ 和 $0.0005369$。这些将按规定以单行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.5369  0.05369  0.0005369\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从简单的压缩技术进阶，我们来探讨基于物理原则的有损数据约减。奇异值分解（SVD）是一种识别数据集中最主要特征或“模式”的强大工具。这项实践要求你不仅要约减数据，更要智能地操作：通过确定满足特定保真度标准（以弗罗贝尼乌斯范数 $\\lVert \\cdot \\rVert_F$ 衡量）所需的最小信息量，来保证数据的科学完整性。",
            "id": "3995012",
            "problem": "一个磁约束聚变实验产生一个快照矩阵 $X \\in \\mathbb{R}^{m \\times n}$，其中 $m=400$ 个诊断通道，$n=1000$ 个时间切片。为了支持原位数据分析和简化，该流程通过仅保留奇异值分解（SVD; Singular Value Decomposition）的前 $k$ 个秩因子来压缩每个 $X$。保真度要求规定，相对平方重构误差必须满足 $\\lVert X - X_{k} \\rVert_{F}^{2} / \\lVert X \\rVert_{F}^{2} \\leq \\delta$，其中 $\\delta = 0.005$，以确保在压缩表示中保留了主要的磁流体动力学模态能量。\n\n假设 $X$ 的数值秩为 $r=12$，其奇异值（按降序排列）为 $\\sigma_{1} = 10$, $\\sigma_{2} = 5$, $\\sigma_{3} = 3$, $\\sigma_{4} = 2$, $\\sigma_{5} = 1.5$, $\\sigma_{6} = 1.2$, $\\sigma_{7} = 1.0$, $\\sigma_{8} = 0.8$, $\\sigma_{9} = 0.6$, $\\sigma_{10} = 0.5$, $\\sigma_{11} = 0.4$ 和 $\\sigma_{12} = 0.3$。\n\n仅从 SVD 和弗罗贝尼乌斯范数（Frobenius norm）的定义出发，推导最佳秩 $k$ 近似下的平方弗罗贝尼乌斯重构误差如何依赖于被舍弃的奇异值。然后，利用给定的奇异值和保真度要求，确定满足 $\\lVert X - X_{k} \\rVert_{F}^{2} / \\lVert X \\rVert_{F}^{2} \\leq \\delta$ 的最小整数 $k$。将最终答案表示为最小整数 $k$。",
            "solution": "问题陈述已经过分析，并被确定为有效。它具有科学依据，问题定义明确，客观，并提供了推导唯一解所需的所有必要信息。\n\n该问题需要一个两部分的解答：首先，推导平方弗罗贝尼乌斯重构误差与奇异值之间的关系；其次，应用此结果来找到满足给定保真度要求的最小秩 $k$。\n\n**第一部分：重构误差的推导**\n\n设 $X$ 是一个大小为 $m \\times n$ 的实矩阵。$X$ 的奇异值分解（SVD）由下式给出：\n$$X = U \\Sigma V^T$$\n其中 $U$ 是一个 $m \\times m$ 的正交矩阵（$U^T U = I_m$），$V$ 是一个 $n \\times n$ 的正交矩阵（$V^T V = I_n$），$\\Sigma$ 是一个 $m \\times n$ 的矩形对角矩阵，其对角线上的非负实数 $\\sigma_i$ 称为奇异值。奇异值按降序排列，$\\sigma_1 \\geq \\sigma_2 \\geq \\dots \\geq \\sigma_p \\geq 0$，其中 $p = \\min(m, n)$。如果 $X$ 的秩为 $r$，那么恰好有 $r$ 个非零奇异值。SVD 也可以写成外积展开的形式：\n$$X = \\sum_{i=1}^{r} \\sigma_i u_i v_i^T$$\n其中 $u_i$ 和 $v_i$ 分别是 $U$ 和 $V$ 的第 $i$ 列。\n\n矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的弗罗贝尼乌斯范数定义为：\n$$\\lVert A \\rVert_{F} = \\sqrt{\\sum_{i=1}^m \\sum_{j=1}^n a_{ij}^2}$$\n平方弗罗贝尼乌斯范数可以用矩阵的迹来表示：\n$$\\lVert A \\rVert_{F}^2 = \\text{tr}(A^T A)$$\n将此应用于矩阵 $X$：\n$$\\lVert X \\rVert_{F}^2 = \\text{tr}(X^T X)$$\n将 $X$ 的 SVD 代入此表达式：\n$$\\lVert X \\rVert_{F}^2 = \\text{tr}((U \\Sigma V^T)^T (U \\Sigma V^T)) = \\text{tr}(V \\Sigma^T U^T U \\Sigma V^T)$$\n由于 $U$ 是正交的，$U^T U = I_m$。利用迹的循环性质 $\\text{tr}(ABC) = \\text{tr}(CAB)$：\n$$\\lVert X \\rVert_{F}^2 = \\text{tr}(V \\Sigma^T \\Sigma V^T) = \\text{tr}(\\Sigma^T \\Sigma V^T V)$$\n由于 $V$ 是正交的，$V^T V = I_n$。\n$$\\lVert X \\rVert_{F}^2 = \\text{tr}(\\Sigma^T \\Sigma)$$\n矩阵 $\\Sigma^T \\Sigma$ 是一个 $n \\times n$ 的对角矩阵，其前 $r$ 个对角元素为 $\\sigma_1^2, \\sigma_2^2, \\dots, \\sigma_r^2$，其余为零。迹是主对角元素的和。因此，$X$ 的平方弗罗贝尼乌斯范数是其奇异值的平方和：\n$$\\lVert X \\rVert_{F}^2 = \\sum_{i=1}^r \\sigma_i^2$$\n\n根据 Eckart-Young-Mirsky 定理，在弗罗贝尼乌斯范数下，$X$ 的最佳秩 $k$ 近似（表示为 $X_k$）是通过将 SVD 求和截断到第 $k$ 项得到的：\n$$X_k = \\sum_{i=1}^k \\sigma_i u_i v_i^T$$\n重构误差是原始矩阵与其近似值之差，$X - X_k$。使用外积展开：\n$$X - X_k = \\sum_{i=1}^r \\sigma_i u_i v_i^T - \\sum_{i=1}^k \\sigma_i u_i v_i^T = \\sum_{i=k+1}^r \\sigma_i u_i v_i^T$$\n这个误差矩阵本身也具有 SVD 形式。它的奇异值是被舍弃的 $X$ 的奇异值，即 $\\sigma_{k+1}, \\sigma_{k+2}, \\dots, \\sigma_r$。将弗罗贝尼乌斯范数和奇异值之间的相同关系应用于误差矩阵 $X - X_k$，我们得到其平方弗罗贝尼乌斯范数：\n$$\\lVert X - X_k \\rVert_{F}^2 = \\sum_{i=k+1}^r \\sigma_i^2$$\n这个结果表明，最佳秩 $k$ 近似的平方弗罗贝尼乌斯重构误差恰好是被舍弃的奇异值的平方和。\n\n**第二部分：寻找最小秩 $k$**\n\n保真度要求由下式给出：\n$$\\frac{\\lVert X - X_k \\rVert_{F}^2}{\\lVert X \\rVert_{F}^2} \\leq \\delta$$\n使用上面推导的表达式，这个不等式变为：\n$$\\frac{\\sum_{i=k+1}^r \\sigma_i^2}{\\sum_{i=1}^r \\sigma_i^2} \\leq \\delta$$\n问题陈述指出，数值秩为 $r=12$，保真度阈值为 $\\delta = 0.005$。奇异值已给出。\n\n首先，我们计算总的平方弗罗贝尼乌斯范数，$\\lVert X \\rVert_{F}^2 = \\sum_{i=1}^{12} \\sigma_i^2$：\n$$\n\\begin{aligned}\n\\lVert X \\rVert_{F}^2 = (10)^2 + (5)^2 + (3)^2 + (2)^2 + (1.5)^2 + (1.2)^2 + (1.0)^2 + (0.8)^2 + (0.6)^2 + (0.5)^2 + (0.4)^2 + (0.3)^2 \\\\\n= 100 + 25 + 9 + 4 + 2.25 + 1.44 + 1 + 0.64 + 0.36 + 0.25 + 0.16 + 0.09 \\\\\n= 144.19\n\\end{aligned}\n$$\n接下来，我们计算允许的最大平方重构误差：\n$$\\lVert X - X_k \\rVert_{F}^2 \\leq \\delta \\cdot \\lVert X \\rVert_{F}^2 = 0.005 \\times 144.19 = 0.72095$$\n我们必须找到最小的整数 $k$，使得被舍弃的奇异值的平方和 $\\sum_{i=k+1}^{12} \\sigma_i^2$ 小于或等于这个阈值。\n令 $E_k = \\sum_{i=k+1}^{12} \\sigma_i^2$。我们将从 $r-1=11$ 开始向下测试 $k$ 的值。\n对于 $k=11$：\n$E_{11} = \\sigma_{12}^2 = (0.3)^2 = 0.09$。因为 $0.09 \\leq 0.72095$，所以条件满足。\n\n对于 $k=10$：\n$E_{10} = \\sigma_{11}^2 + \\sigma_{12}^2 = (0.4)^2 + 0.09 = 0.16 + 0.09 = 0.25$。因为 $0.25 \\leq 0.72095$，所以条件满足。\n\n对于 $k=9$：\n$E_{9} = \\sigma_{10}^2 + E_{10} = (0.5)^2 + 0.25 = 0.25 + 0.25 = 0.50$。因为 $0.50 \\leq 0.72095$，所以条件满足。\n\n对于 $k=8$：\n$E_{8} = \\sigma_{9}^2 + E_{9} = (0.6)^2 + 0.50 = 0.36 + 0.50 = 0.86$。因为 $0.86 > 0.72095$，所以条件不满足。\n\n对于 $k=8$ 条件不满足，但对于 $k=9$ 条件满足。因此，满足保真度要求的最小整数 $k$ 值为 $9$。\n\n或者，我们可以将保真度要求表示为保留一定比例的“能量”：\n$\\sum_{i=1}^k \\sigma_i^2 \\geq (1-\\delta) \\sum_{i=1}^{12} \\sigma_i^2$。\n当 $1 - \\delta = 0.995$ 时，要求保留的能量为 $0.995 \\times 144.19 = 143.46905$。\n我们来计算奇异值平方的累积和，$S_k = \\sum_{i=1}^k \\sigma_i^2$：\n$S_8 = \\sum_{i=1}^8 \\sigma_i^2 = \\lVert X \\rVert_F^2 - E_8 = 144.19 - 0.86 = 143.33$。\n因为 $S_8 = 143.33  143.46905$，所以 $k=8$ 是不够的。\n$S_9 = S_8 + \\sigma_9^2 = 143.33 + (0.6)^2 = 143.33 + 0.36 = 143.69$。\n因为 $S_9 = 143.69 \\geq 143.46905$，所以 $k=9$ 是满足该标准的最小秩。\n两种方法都证实了这一结果。",
            "answer": "$$\\boxed{9}$$"
        },
        {
            "introduction": "现实世界中的模拟，其数据生成率和可用计算资源都是动态变化的，这要求我们的工作流具备自适应能力。这项高级实践将静态约减方案提升到动态、自适应的层面。你将设计一个反馈控制系统，它能主动监控数据处理管道的状态（例如队列长度），并动态调整数据约减率，以在防止系统瓶颈和最大化数据保真度之间取得平衡。这项练习融合了计算科学、控制理论和软件工程，是构建智能原位工作流的核心实践。",
            "id": "3994971",
            "problem": "考虑一个用于计算聚变科学与工程的高性能计算（HPC）流水线中的原位数据削减控制器，其中流式诊断数据在进入处理队列前必须进行削减，以避免下游处理能力过载。设队列长度由一个非负离散时间状态 $q_k$ 表示，单位为千兆字节（GB），按 $\\Delta t = 1\\,\\mathrm{s}$ 的时间步长根据守恒定律（质量平衡）和正性约束进行更新\n$$\nq_{k+1} = \\max\\!\\Big(0,\\; q_k + \\Delta t\\big(\\lambda_\\mathrm{eff}(k) - \\mu(k)\\big)\\Big),\n$$\n其中 $\\lambda_\\mathrm{eff}(k) = r_k\\,\\lambda(k)$ 是削减后的有效到达率，$\\lambda(k)$ 是输入数据率（单位为千兆字节/秒），$\\mu(k)$ 是下游服务容量（单位为千兆字节/秒），$r_k\\in[0,1]$ 是在时间 $k$ 的削减率，解释为削减后保留的数据比例。控制目标是仅使用当前测量值 $(q_k,\\lambda(k),\\mu(k))$ 和一个可调标量参数 $\\gamma \\in (0,1)$ 来为 $r_k$ 设计一个反馈律，使得闭环队列动力学对平衡点 $q^\\star = 0$ 全局渐近稳定，并且有效到达率在每一步都保持在服务容量以下，即 $\\lambda_\\mathrm{eff}(k) \\le \\mu(k)$。请从质量平衡更新和正性约束的基本基础出发，对队列长度动力学使用离散时间李雅普诺夫论证来证明其稳定性，并且不援引快捷公式。\n\n然后，您必须实现所推导的控制器，并针对以下包含三个案例的确定性测试套件模拟闭环动力学。在所有案例中，使用 $\\Delta t = 1\\,\\mathrm{s}$，并以千兆字节表示所有结果。正弦定义中若出现角度，单位为弧度。\n\n为每个测试案例定义以下序列和参数：\n- 案例 A（具有突发流量的一般可变性）：$T = 300$，$q_0 = 20\\,\\mathrm{GB}$，对所有 $k$ 有 $\\mu(k) = 5\\,\\mathrm{GB/s}$，$\\lambda(k) = L_0 + A\\sin\\!\\big(2\\pi k / 25\\big) + B(k)$，其中 $L_0 = 6\\,\\mathrm{GB/s}$，$A = 2\\,\\mathrm{GB/s}$，并且当 $k\\in\\{50,51,52,53,54,150,151,152,153,154\\}$ 时 $B(k)$ 等于 $5\\,\\mathrm{GB/s}$，否则为 $0\\,\\mathrm{GB/s}$。使用 $\\gamma = 0.3$。\n- 案例 B（次容量状态）：$T = 200$，$q_0 = 10\\,\\mathrm{GB}$，对所有 $k$ 有 $\\mu(k) = 5\\,\\mathrm{GB/s}$，$\\lambda(k) = 3 + 0.5\\sin\\!\\big(2\\pi k / 30\\big)$，单位为 $\\mathrm{GB/s}$。使用 $\\gamma = 0.4$。\n- 案例 C（容量下降伴随大突发流量）：$T = 400$，$q_0 = 0\\,\\mathrm{GB}$，当 $k\\in\\{100,101,\\dots,110\\}$ 时 $\\mu(k) = 0\\,\\mathrm{GB/s}$，否则 $\\mu(k)=4\\,\\mathrm{GB/s}$，$\\lambda(k) = L_0 + A\\sin\\!\\big(2\\pi k / 20\\big) + B(k)$，其中 $L_0 = 10\\,\\mathrm{GB/s}$，$A = 5\\,\\mathrm{GB/s}$，并且当 $k\\in\\{80,81,\\dots,90,250,251,\\dots,260\\}$ 时 $B(k)$ 等于 $15\\,\\mathrm{GB/s}$，否则为 $0\\,\\mathrm{GB/s}$。使用 $\\gamma = 0.6$。\n\n您的程序必须：\n- 实现推导出的反馈控制器 $r_k$ 并模拟每种情况下的队列动力学。\n- 为保证数值安全，通过任何能保持物理意义的明确约定来处理 $\\lambda(k)=0$ 的情况（无到达意味着无论 $r_k$ 为何，$\\lambda_\\mathrm{eff}(k)=0$）。\n- 生成一行输出，其中包含每个案例的最终队列长度 $q_T$（单位为千兆字节），形式为用方括号括起来的逗号分隔列表。将每个数字四舍五入到三位小数。例如，输出格式必须类似于 $[x_A,x_B,x_C]$，其中 $x_A$、$x_B$、$x_C$ 分别是案例 A、B 和 C 的最终队列长度（单位为千兆字节），并四舍五入到三位小数。",
            "solution": "该问题陈述经评估有效。它在科学上基于控制理论和排队模型的既定原则，问题设定良好，为理论推导和数值模拟提供了所有必要信息，并且其语言和目标是客观的。未发现与科学不健全、不完整、矛盾或模糊性相关的缺陷。因此，我们可以着手解决。\n\n目标是为削减率 $r_k \\in [0, 1]$ 设计一个反馈控制律，以确保队列长度 $q_k$ 对平衡点 $q^\\star=0$ 的全局渐近稳定性，并受限于有效到达率不超过服务容量的约束，即 $\\lambda_\\mathrm{eff}(k) \\le \\mu(k)$。$r_k$ 的控制律必须仅使用当前可用的信息，即状态 $q_k$ 和系统参数 $\\lambda(k)$ 和 $\\mu(k)$。\n\n系统动力学由离散时间更新方程给出：\n$$\nq_{k+1} = \\max\\!\\Big(0,\\; q_k + \\Delta t\\big(\\lambda_\\mathrm{eff}(k) - \\mu(k)\\big)\\Big)\n$$\n其中 $\\lambda_\\mathrm{eff}(k) = r_k \\lambda(k)$ 且 $\\Delta t = 1\\,\\mathrm{s}$。根据定义，状态 $q_k$ 是非负的。\n\n为证明稳定性，我们采用一个离散时间李雅普诺夫函数。对于一个状态为非负量且目标是驱动其至零的系统，一个自然的选择是状态本身。设李雅普诺夫候选函数为 $V(q_k) = q_k$。\n要使其成为一个有效的李雅普诺夫函数，必须满足：\n1.  对于所有 $q_k > 0$，$V(q_k) > 0$，且 $V(0) = 0$。由于 $q_k$ 代表物理队列长度，它是非负的，因此该条件得到满足。\n2.  李雅普诺夫差分 $\\Delta V_k = V(q_{k+1}) - V(q_k) = q_{k+1} - q_k$ 必须是负定的，即对于 $q_k > 0$，有 $\\Delta V_k  0$。\n\n我们为 $r_k$ 设计的控制必须确保此条件。反馈控制中的一个常用策略是强制状态呈指数衰减。让我们寻求一个控制律，试图在 $q_k > 0$ 时强制实现关系 $q_{k+1} \\approx (1-\\gamma)q_k$，其中 $\\gamma \\in (0,1)$ 是某个速率参数。\n\n暂时假设 $\\max(0, \\cdot)$ 操作不激活，即 $q_k + \\Delta t(\\lambda_\\mathrm{eff}(k) - \\mu(k)) > 0$。那么 $q_{k+1} = q_k + \\Delta t(\\lambda_\\mathrm{eff}(k) - \\mu(k))$。为达到期望的衰减，我们设定：\n$$\nq_k + \\Delta t\\big(\\lambda_\\mathrm{eff}(k) - \\mu(k)\\big) = (1-\\gamma)q_k\n$$\n求解期望的有效到达率 $\\lambda_\\mathrm{eff}^\\mathrm{des}(k)$，得到：\n$$\n\\Delta t\\big(\\lambda_\\mathrm{eff}^\\mathrm{des}(k) - \\mu(k)\\big) = -\\gamma q_k\n$$\n$$\n\\lambda_\\mathrm{eff}^\\mathrm{des}(k) = \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\n$$\n有效到达率不能为负，所以我们必须取其正部：\n$$\n\\lambda_\\mathrm{eff}^\\mathrm{des}(k) = \\max\\left(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\\right)\n$$\n实际的有效到达率 $\\lambda_\\mathrm{eff}(k) = r_k \\lambda(k)$ 也受限于输入数据率 $\\lambda(k)$，即 $\\lambda_\\mathrm{eff}(k) \\le \\lambda(k)$。因此，最接近我们期望率的可实现有效率为：\n$$\n\\lambda_\\mathrm{eff}(k) = \\min\\left(\\lambda(k), \\max\\left(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\\right)\\right)\n$$\n由此，我们推导出 $r_k$ 的控制律。假设 $\\lambda(k) > 0$：\n$$\nr_k = \\frac{\\lambda_\\mathrm{eff}(k)}{\\lambda(k)} = \\frac{1}{\\lambda(k)} \\min\\left(\\lambda(k), \\max\\left(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\\right)\\right)\n$$\n通过将 $1/\\lambda(k)$ 项移入最小值函数内部，可以重写为：\n$$\nr_k = \\min\\left(1, \\frac{1}{\\lambda(k)}\\max\\left(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\\right)\\right)\n$$\n$$\nr_k = \\min\\left(1, \\max\\left(0, \\frac{\\mu(k)}{\\lambda(k)} - \\frac{\\gamma q_k}{\\Delta t \\lambda(k)}\\right)\\right)\n$$\n这等效于对目标控制值进行饱和处理：\n$$\nr_k = \\mathrm{sat}_{[0,1]}\\left(\\frac{\\mu(k)}{\\lambda(k)} - \\frac{\\gamma q_k}{\\Delta t \\lambda(k)}\\right)\n$$\n如果 $\\lambda(k)=0$，则该表达式奇异。然而，在这种情况下，对于任何有效的 $r_k \\in [0,1]$，$\\lambda_\\mathrm{eff}(k) = r_k \\cdot 0 = 0$。我们期望的速率公式也给出 $\\lambda_\\mathrm{eff}(k)=0$，因此逻辑是一致的。我们采用约定，如果 $\\lambda(k)=0$，我们可以设置 $r_k=1$，这导致 $\\lambda_\\mathrm{eff}(k)=0$。\n\n现在让我们正式证明使用此控制器的闭环系统的稳定性。\n\n**稳定性分析：**\n设 $V(q_k) = q_k$。我们分析 $\\Delta V_k = q_{k+1} - q_k$。控制器设置 $\\lambda_\\mathrm{eff}(k) = r_k \\lambda(k)$。\n让我们分析动力学中 max 函数内部的项：\n$q_k + \\Delta t(\\lambda_\\mathrm{eff}(k) - \\mu(k)) = q_k + \\Delta t \\left(\\min\\left(\\lambda(k), \\max\\left(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}\\right)\\right) - \\mu(k)\\right)$。\n我们考虑项 $\\mu(k) - \\frac{\\gamma q_k}{\\Delta t}$ 的两种主要情况。\n\n情况1：$\\mu(k) - \\frac{\\gamma q_k}{\\Delta t} > 0$。\n在这种情况下，$\\lambda_\\mathrm{eff}(k) = \\min(\\lambda(k), \\mu(k) - \\frac{\\gamma q_k}{\\Delta t})$。\n子情况1a：$\\lambda(k) \\le \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}$。这对应于 $r_k=1$。\n则 $\\lambda_\\mathrm{eff}(k) = \\lambda(k)$。更新项变为 $q_k + \\Delta t(\\lambda(k) - \\mu(k))$。根据子情况的条件，$\\lambda(k) - \\mu(k) \\le -\\frac{\\gamma q_k}{\\Delta t}$。因此，$q_k + \\Delta t(\\lambda(k) - \\mu(k)) \\le q_k - \\gamma q_k = (1-\\gamma)q_k$。\n由于 $\\gamma \\in (0,1)$ 且 $q_k \\ge 0$，我们有 $0 \\le (1-\\gamma)q_k \\le q_k$。\n则 $q_{k+1} = \\max(0, q_k + \\Delta t(\\lambda(k) - \\mu(k))) \\le (1-\\gamma)q_k$。\n李雅普诺夫差分为 $\\Delta V_k = q_{k+1} - q_k \\le (1-\\gamma)q_k - q_k = -\\gamma q_k$。\n\n子情况1b：$\\lambda(k) > \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}$。这对应于 $0  r_k  1$。\n则 $\\lambda_\\mathrm{eff}(k) = \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}$。\n更新项变为 $q_k + \\Delta t((\\mu(k) - \\frac{\\gamma q_k}{\\Delta t}) - \\mu(k)) = q_k - \\gamma q_k = (1-\\gamma)q_k$。\n和之前一样，这是非负的，所以 $q_{k+1} = (1-\\gamma)q_k$。\n李雅普诺夫差分为 $\\Delta V_k = q_{k+1} - q_k = -\\gamma q_k$。\n\n情况2：$\\mu(k) - \\frac{\\gamma q_k}{\\Delta t} \\le 0$。\n在这种情况下，$\\max(0, \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}) = 0$。这对应于 $r_k=0$。\n则 $\\lambda_\\mathrm{eff}(k) = \\min(\\lambda(k), 0) = 0$。\n更新项变为 $q_k + \\Delta t(0 - \\mu(k)) = q_k - \\Delta t \\mu(k)$。\n所以 $q_{k+1} = \\max(0, q_k - \\Delta t \\mu(k))$。\n李雅普诺夫差分为 $\\Delta V_k = q_{k+1} - q_k = \\max(0, q_k - \\Delta t \\mu(k)) - q_k$。\n如果 $q_k - \\Delta t \\mu(k) \\ge 0$，则 $\\Delta V_k = (q_k - \\Delta t \\mu(k)) - q_k = -\\Delta t \\mu(k) \\le 0$（因为 $\\mu(k) \\ge 0$）。\n如果 $q_k - \\Delta t \\mu(k)  0$，则 $\\Delta V_k = 0 - q_k = -q_k  0$（对于 $q_k > 0$）。\n在所有子情况下，对于 $q_k > 0$，我们都有 $\\Delta V_k \\le 0$。\n\n这表明 $V(q_k)$ 是一个非增函数，从而证明了李雅普诺夫意义下的稳定性。为建立渐近稳定性，我们援引离散时间系统的拉萨尔不变性原理。令 $E = \\{q \\ge 0 \\mid \\Delta V(q) = 0\\}$。\n根据我们的分析，$\\Delta V_k = 0$ 当且仅当以下情况之一成立：\n(i) $q_k = 0$。\n(ii) $q_k > 0$，且情况2的条件适用（$r_k=0$）并有 $\\mu(k)=0$。如果 $\\mu(k)=0$，则 $q_{k+1} = \\max(0, q_k) = q_k$，所以 $\\Delta V_k = 0$。\n\n系统轨迹必须收敛到包含在 $E$ 中的最大不变集 $M$。一个轨迹只有在对于所有 $j \\ge k$，$q_j$ 是常数的情况下才能保持在集合 $\\{q > 0\\} \\cap E$ 中，这要求对于所有 $j \\ge k$，$\\mu(j)=0$。假设下游处理容量不是永久为零（即 $\\mu(k)=0$ 的条件不会对所有 $k \\to \\infty$ 持续存在），没有轨迹可以无限期地停留在 $\\{q > 0\\} \\cap E$ 中。因此，$E$ 中唯一的不变集是单点集 $M = \\{0\\}$。根据拉萨尔不变性原理，所有从任何 $q_0 \\ge 0$ 开始的轨迹都必须收敛到 $M$，这意味着 $\\lim_{k \\to \\infty} q_k = 0$。这证明了平衡点 $q^\\star=0$ 的全局渐近稳定性。\n\n最后，设计约束 $\\lambda_\\mathrm{eff}(k) \\le \\mu(k)$ 得到满足。\n如果 $r_k=1$，根据构造（子情况1a），该约束成立。\n如果 $0 \\le r_k  1$，则 $\\lambda_\\mathrm{eff}(k) \\le \\mu(k) - \\frac{\\gamma q_k}{\\Delta t}$。由于 $\\gamma, q_k, \\Delta t$ 都是非负的，$\\frac{\\gamma q_k}{\\Delta t} \\ge 0$，这意味着 $\\lambda_\\mathrm{eff}(k) \\le \\mu(k)$。该约束对所有 $k$ 都满足。\n\n现在将实施推导出的控制器，以模拟所提供的测试案例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the derived feedback controller and simulates the closed-loop \n    queue dynamics for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"T\": 300,\n            \"q0\": 20.0,\n            \"gamma\": 0.3,\n            \"mu_func\": lambda k: 5.0,\n            \"lambda_func\": lambda k: 6.0 + 2.0 * np.sin(2 * np.pi * k / 25) + \\\n                                   (5.0 if (50 = k = 54) or (150 = k = 154) else 0.0),\n        },\n        {\n            \"name\": \"Case B\",\n            \"T\": 200,\n            \"q0\": 10.0,\n            \"gamma\": 0.4,\n            \"mu_func\": lambda k: 5.0,\n            \"lambda_func\": lambda k: 3.0 + 0.5 * np.sin(2 * np.pi * k / 30),\n        },\n        {\n            \"name\": \"Case C\",\n            \"T\": 400,\n            \"q0\": 0.0,\n            \"gamma\": 0.6,\n            \"mu_func\": lambda k: 0.0 if 100 = k = 110 else 4.0,\n            \"lambda_func\": lambda k: 10.0 + 5.0 * np.sin(2 * np.pi * k / 20) + \\\n                                   (15.0 if (80 = k = 90) or (250 = k = 260) else 0.0),\n        }\n    ]\n\n    final_queue_lengths = []\n    delta_t = 1.0  # Time step in seconds, as given\n\n    for case in test_cases:\n        T = case[\"T\"]\n        q_k = case[\"q0\"]\n        gamma = case[\"gamma\"]\n        mu_func = case[\"mu_func\"]\n        lambda_func = case[\"lambda_func\"]\n\n        # Simulation loop from k=0 to T-1\n        for k in range(T):\n            lambda_k = lambda_func(k)\n            mu_k = mu_func(k)\n\n            # --- Controller Logic ---\n            # Calculate reduction ratio r_k\n            if lambda_k  1e-9:  # Numerical safety for lambda(k) approaching 0\n                r_k = 1.0  # Convention: effective rate will be 0 anyway\n            else:\n                # Target reduction ratio based on the derived control law\n                r_k_target = (mu_k / lambda_k) - (gamma * q_k) / (delta_t * lambda_k)\n                # Saturate to the valid range [0, 1]\n                r_k = np.clip(r_k_target, 0.0, 1.0)\n\n            # --- System Dynamics ---\n            # Calculate effective arrival rate\n            lambda_eff_k = r_k * lambda_k\n\n            # Update queue length q_k -> q_{k+1}\n            q_k = np.maximum(0.0, q_k + delta_t * (lambda_eff_k - mu_k))\n\n        # After T steps, the final queue length is q_T\n        final_queue_lengths.append(q_k)\n\n    # Format the output as specified: [x_A,x_B,x_C] rounded to 3 decimal places.\n    formatted_results = [f\"{q:.3f}\" for q in final_queue_lengths]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}