{
    "hands_on_practices": [
        {
            "introduction": "在分析非轴对称装置中的输运之前，我们必须首先精确地描述磁面的几何结构。这项练习提供了微分几何方面的基础实践，要求您从给定的参数化出发，推导度规张量，它定义了非轴对称磁面上的距离、面积和体积。掌握这项技能对于构建仿星器等离子体的任何计算模型都至关重要，因为几何是所有物理过程发生的基础。",
            "id": "4018915",
            "problem": "考虑一个三维环形等离子体位形，它代表了一个非轴对称的类仿星器磁通面。令 $\\psi$ 标记嵌套的环形磁通面，并在一个固定的磁通面 $\\psi=\\psi_0$ 上，定义常数小半径 $r=r(\\psi_0)$。引入角向和环向计算角 $(\\theta,\\zeta)$，并令几何（柱）坐标 $(R,\\phi,Z)$ 由以下坐标映射给出：\n$$\nR(\\psi_0,\\theta,\\zeta) \\equiv R_0 + r\\left[\\cos\\theta + \\varepsilon \\cos\\!\\left(m\\theta - n\\zeta\\right)\\right],\\qquad\n\\phi(\\psi_0,\\theta,\\zeta) \\equiv \\zeta,\\qquad\nZ(\\psi_0,\\theta,\\zeta) \\equiv \\kappa\\,r\\left[\\sin\\theta + \\varepsilon_Z \\sin\\!\\left(m\\theta - n\\zeta\\right)\\right],\n$$\n其中 $R_00$ 是大半径，$\\kappa0$ 是拉长率，$\\varepsilon,\\varepsilon_Z$ 是与模数 $m\\in\\mathbb{Z}^+$ 和 $n\\in\\mathbb{Z}^+$ 的螺旋微扰相关的形状振幅。通过笛卡尔坐标将该曲面嵌入欧几里得三维空间：\n$$\nx = R\\cos\\phi,\\qquad y = R\\sin\\phi,\\qquad z = Z,\n$$\n因此，在固定的 $\\psi=\\psi_0$ 上，位置矢量为 $\\boldsymbol{r}(\\theta,\\zeta) = \\big(R(\\theta,\\zeta)\\cos\\zeta,\\;R(\\theta,\\zeta)\\sin\\zeta,\\;Z(\\theta,\\zeta)\\big)$。\n\n从欧几里得线元 $d\\ell^2 = dx^2 + dy^2 + dz^2$ 和在固定 $\\psi=\\psi_0$ 时对 $i,j\\in\\{\\theta,\\zeta\\}$ 的协变度规系数定义 $g_{ij} = \\partial_i \\boldsymbol{r}\\cdot \\partial_j \\boldsymbol{r}$ 出发，推导此映射的度规系数 $g_{\\theta\\theta}$、$g_{\\zeta\\zeta}$ 和 $g_{\\theta\\zeta}$，过程中不使用任何预先制定的几何公式。然后，计算曲面上的弧长元，\n$$\nd\\ell^2 \\;=\\; g_{\\theta\\theta}\\,d\\theta^2 \\;+\\; 2\\,g_{\\theta\\zeta}\\,d\\theta\\,d\\zeta \\;+\\; g_{\\zeta\\zeta}\\,d\\zeta^2,\n$$\n将其表示为 $(\\theta,\\zeta)$ 和参数 $(R_0,r,\\kappa,\\varepsilon,\\varepsilon_Z,m,n)$ 的显式闭式解析函数。将 $r$、$R_0$、$\\kappa$、$\\varepsilon$、$\\varepsilon_Z$、$m$ 和 $n$ 视为关于 $\\theta$ 和 $\\zeta$ 的常数。你最终的方框答案必须是 $d\\ell^2$ 仅以 $\\theta$ 和 $\\zeta$ 表示的单个闭式解析表达式（表达式中可以定义任何辅助的相位组合）。不需要进行数值计算，也无需四舍五入。三角函数参数以弧度表示。",
            "solution": "该问题是有效的。这是一个适定的、有科学依据的微分几何在等离子体物理中的应用问题，要求计算一个参数化曲面的度规张量。所有必要信息均已提供，任务是进行直接推导，而不依赖于预先制定的公式。\n\n目标是计算指定环形曲面上的弧长元 $d\\ell^2$。该曲面由坐标 $(\\theta, \\zeta)$ 参数化，其在三维欧几里得空间中的嵌入由位置矢量 $\\boldsymbol{r}(\\theta, \\zeta)$ 给出。弧长元由二次型 $d\\ell^2 = d\\boldsymbol{r} \\cdot d\\boldsymbol{r}$ 定义。\n\n位置矢量 $\\boldsymbol{r}$ 的全微分为\n$$d\\boldsymbol{r} = \\frac{\\partial \\boldsymbol{r}}{\\partial \\theta} d\\theta + \\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta} d\\zeta$$\n因此，弧长元的平方为\n$$d\\ell^2 = d\\boldsymbol{r} \\cdot d\\boldsymbol{r} = \\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{r}}{\\partial \\theta}\\right) d\\theta^2 + 2\\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta}\\right) d\\theta d\\zeta + \\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta} \\cdot \\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta}\\right) d\\zeta^2$$\n此表达式的形式为 $d\\ell^2 = g_{\\theta\\theta}\\,d\\theta^2 + 2 g_{\\theta\\zeta}\\,d\\theta d\\zeta + g_{\\zeta\\zeta}\\,d\\zeta^2$，其中协变度规系数定义为 $g_{ij} = \\partial_i \\boldsymbol{r} \\cdot \\partial_j \\boldsymbol{r}$。我们的任务是计算这些系数。\n\n首先，我们将位置矢量 $\\boldsymbol{r}$ 写成笛卡尔坐标 $(x,y,z)$ 的形式。使用给定的变换 $x = R\\cos\\phi$、$y = R\\sin\\phi$、$z=Z$ 以及 $\\phi=\\zeta$，我们有\n$$\\boldsymbol{r}(\\theta,\\zeta) = \\large( R(\\theta,\\zeta)\\cos\\zeta, \\;R(\\theta,\\zeta)\\sin\\zeta, \\;Z(\\theta,\\zeta) \\large)$$\n其中\n$$R(\\theta,\\zeta) = R_0 + r\\left[\\cos\\theta + \\varepsilon \\cos(m\\theta - n\\zeta)\\right]$$\n$$Z(\\theta,\\zeta) = \\kappa\\,r\\left[\\sin\\theta + \\varepsilon_Z \\sin(m\\theta - n\\zeta)\\right]$$\n为简化记法，令螺旋相角为 $\\alpha(\\theta, \\zeta) = m\\theta - n\\zeta$。\n\n接下来，我们计算切矢量 $\\partial_\\theta \\boldsymbol{r} = \\frac{\\partial \\boldsymbol{r}}{\\partial \\theta}$ 和 $\\partial_\\zeta \\boldsymbol{r} = \\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta}$。这需要 $R$ 和 $Z$ 的偏导数：\n$$\\frac{\\partial R}{\\partial \\theta} = r\\left[-\\sin\\theta - m\\,\\varepsilon \\sin(m\\theta - n\\zeta)\\right] = -r(\\sin\\theta + m\\varepsilon\\sin\\alpha)$$\n$$\\frac{\\partial R}{\\partial \\zeta} = r\\left[n\\,\\varepsilon \\sin(m\\theta - n\\zeta)\\right] = n r \\varepsilon \\sin\\alpha$$\n$$\\frac{\\partial Z}{\\partial \\theta} = \\kappa r\\left[\\cos\\theta + m\\,\\varepsilon_Z \\cos(m\\theta - n\\zeta)\\right] = \\kappa r(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)$$\n$$\\frac{\\partial Z}{\\partial \\zeta} = \\kappa r\\left[-n\\,\\varepsilon_Z \\cos(m\\theta - n\\zeta)\\right] = -n\\kappa r \\varepsilon_Z \\cos\\alpha$$\n\n使用乘法法则和链式法则，切矢量为：\n$$\\partial_\\theta \\boldsymbol{r} = \\left( \\frac{\\partial R}{\\partial \\theta} \\cos\\zeta, \\; \\frac{\\partial R}{\\partial \\theta} \\sin\\zeta, \\; \\frac{\\partial Z}{\\partial \\theta} \\right)$$\n$$\\partial_\\zeta \\boldsymbol{r} = \\left( \\frac{\\partial R}{\\partial \\zeta} \\cos\\zeta - R \\sin\\zeta, \\; \\frac{\\partial R}{\\partial \\zeta} \\sin\\zeta + R \\cos\\zeta, \\; \\frac{\\partial Z}{\\partial \\zeta} \\right)$$\n\n现在我们通过计算这些切矢量的点积来计算度规系数。\n对于 $g_{\\theta\\theta}$：\n$$g_{\\theta\\theta} = \\partial_\\theta \\boldsymbol{r} \\cdot \\partial_\\theta \\boldsymbol{r} = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 \\cos^2\\zeta + \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 \\sin^2\\zeta + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2$$\n$$g_{\\theta\\theta} = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2$$\n代入导数：\n$$g_{\\theta\\theta} = \\left[-r(\\sin\\theta + m\\varepsilon\\sin\\alpha)\\right]^2 + \\left[\\kappa r(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)\\right]^2$$\n$$g_{\\theta\\theta} = r^2(\\sin\\theta + m\\varepsilon\\sin\\alpha)^2 + \\kappa^2 r^2(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)^2$$\n\n对于 $g_{\\zeta\\zeta}$：\n$$g_{\\zeta\\zeta} = \\partial_\\zeta \\boldsymbol{r} \\cdot \\partial_\\zeta \\boldsymbol{r} = \\left(\\frac{\\partial R}{\\partial \\zeta} \\cos\\zeta - R \\sin\\zeta\\right)^2 + \\left(\\frac{\\partial R}{\\partial \\zeta} \\sin\\zeta + R \\cos\\zeta\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\zeta}\\right)^2$$\n展开前两项：\n$$(\\ldots) = \\left(\\frac{\\partial R}{\\partial \\zeta}\\right)^2\\cos^2\\zeta - 2R\\frac{\\partial R}{\\partial \\zeta}\\cos\\zeta\\sin\\zeta + R^2\\sin^2\\zeta + \\left(\\frac{\\partial R}{\\partial \\zeta}\\right)^2\\sin^2\\zeta + 2R\\frac{\\partial R}{\\partial \\zeta}\\sin\\zeta\\cos\\zeta + R^2\\cos^2\\zeta$$\n$$(\\ldots) = \\left(\\frac{\\partial R}{\\partial \\zeta}\\right)^2(\\cos^2\\zeta+\\sin^2\\zeta) + R^2(\\sin^2\\zeta+\\cos^2\\zeta) = \\left(\\frac{\\partial R}{\\partial \\zeta}\\right)^2 + R^2$$\n因此，\n$$g_{\\zeta\\zeta} = R^2 + \\left(\\frac{\\partial R}{\\partial \\zeta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\zeta}\\right)^2$$\n代入 $R$ 的表达式和导数：\n$$g_{\\zeta\\zeta} = \\left(R_0 + r(\\cos\\theta + \\varepsilon \\cos\\alpha)\\right)^2 + (n r \\varepsilon \\sin\\alpha)^2 + (-n\\kappa r \\varepsilon_Z \\cos\\alpha)^2$$\n$$g_{\\zeta\\zeta} = \\left(R_0 + r(\\cos\\theta + \\varepsilon \\cos\\alpha)\\right)^2 + n^2 r^2 \\varepsilon^2 \\sin^2\\alpha + n^2 \\kappa^2 r^2 \\varepsilon_Z^2 \\cos^2\\alpha$$\n\n对于交叉项 $g_{\\theta\\zeta}$：\n$$g_{\\theta\\zeta} = \\partial_\\theta \\boldsymbol{r} \\cdot \\partial_\\zeta \\boldsymbol{r} = \\left(\\frac{\\partial R}{\\partial \\theta} \\cos\\zeta\\right)\\left(\\frac{\\partial R}{\\partial \\zeta} \\cos\\zeta - R \\sin\\zeta\\right) + \\left(\\frac{\\partial R}{\\partial \\theta} \\sin\\zeta\\right)\\left(\\frac{\\partial R}{\\partial \\zeta} \\sin\\zeta + R \\cos\\zeta\\right) + \\frac{\\partial Z}{\\partial \\theta}\\frac{\\partial Z}{\\partial \\zeta}$$\n展开前两项：\n$$(\\ldots) = \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial R}{\\partial \\zeta}\\cos^2\\zeta - R\\frac{\\partial R}{\\partial \\theta}\\cos\\zeta\\sin\\zeta + \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial R}{\\partial \\zeta}\\sin^2\\zeta + R\\frac{\\partial R}{\\partial \\theta}\\sin\\zeta\\cos\\zeta = \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial R}{\\partial \\zeta}(\\cos^2\\zeta+\\sin^2\\zeta) = \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial R}{\\partial \\zeta}$$\n因此，\n$$g_{\\theta\\zeta} = \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial R}{\\partial \\zeta} + \\frac{\\partial Z}{\\partial \\theta}\\frac{\\partial Z}{\\partial \\zeta}$$\n代入导数：\n$$g_{\\theta\\zeta} = \\left[-r(\\sin\\theta + m\\varepsilon\\sin\\alpha)\\right]\\left[n r \\varepsilon \\sin\\alpha\\right] + \\left[\\kappa r(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)\\right]\\left[-n\\kappa r \\varepsilon_Z \\cos\\alpha\\right]$$\n$$g_{\\theta\\zeta} = -n r^2 \\varepsilon\\sin\\alpha(\\sin\\theta + m\\varepsilon\\sin\\alpha) - n\\kappa^2 r^2 \\varepsilon_Z\\cos\\alpha(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)$$\n$$g_{\\theta\\zeta} = -n r^2 \\left[ \\varepsilon\\sin\\theta\\sin\\alpha + m\\varepsilon^2\\sin^2\\alpha + \\kappa^2\\varepsilon_Z\\cos\\theta\\cos\\alpha + \\kappa^2 m\\varepsilon_Z^2\\cos^2\\alpha \\right]$$\n\n最后，我们组合出弧长元 $d\\ell^2$ 的完整表达式：\n$$d\\ell^2 = g_{\\theta\\theta}\\,d\\theta^2 + 2\\,g_{\\theta\\zeta}\\,d\\theta\\,d\\zeta + g_{\\zeta\\zeta}\\,d\\zeta^2$$\n代入推导出的系数表达式即可得到最终结果。\n$$d\\ell^2 = \\left[ r^2(\\sin\\theta + m\\varepsilon\\sin\\alpha)^2 + \\kappa^2 r^2(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)^2 \\right] d\\theta^2$$\n$$- 2 n r^2 \\left[ \\varepsilon\\sin\\theta\\sin\\alpha + m\\varepsilon^2\\sin^2\\alpha + \\kappa^2\\varepsilon_Z\\cos\\theta\\cos\\alpha + \\kappa^2 m\\varepsilon_Z^2\\cos^2\\alpha \\right] d\\theta d\\zeta$$\n$$+ \\left[ (R_0 + r(\\cos\\theta + \\varepsilon\\cos\\alpha))^2 + n^2 r^2 \\varepsilon^2 \\sin^2\\alpha + n^2 \\kappa^2 r^2 \\varepsilon_Z^2 \\cos^2\\alpha \\right] d\\zeta^2$$\n其中 $\\alpha = m\\theta - n\\zeta$。这就是曲面上弧长元的平方作为 $(\\theta, \\zeta)$ 和给定参数的函数的显式闭式解析表达式。三角函数参数隐式地以弧度为单位。",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\n\\text{令 } \\alpha = m\\theta - n\\zeta。\\text{ 则 } d\\ell^2 =  \\left[ r^2(\\sin\\theta + m\\varepsilon\\sin\\alpha)^2 + \\kappa^2 r^2(\\cos\\theta + m\\varepsilon_Z\\cos\\alpha)^2 \\right] d\\theta^2 \\\\\n - 2 n r^2 \\left[ \\varepsilon\\sin\\theta\\sin\\alpha + m\\varepsilon^2\\sin^2\\alpha + \\kappa^2\\varepsilon_Z\\cos\\theta\\cos\\alpha + \\kappa^2 m\\varepsilon_Z^2\\cos^2\\alpha \\right] d\\theta d\\zeta \\\\\n + \\left[ (R_0 + r(\\cos\\theta + \\varepsilon\\cos\\alpha))^2 + n^2 r^2 \\varepsilon^2 \\sin^2\\alpha + n^2 \\kappa^2 r^2 \\varepsilon_Z^2 \\cos^2\\alpha \\right] d\\zeta^2\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "在定义了几何结构之后，输运理论中的一个关键工具是磁面平均，它将磁面上复杂的二维变化简化为单一的代表性数值。本问题探讨了磁面平均的定义，并演示了在特殊坐标系（如Hamada坐标系）中其形式的简化。理解这一概念是连接微观涨落与宏观输运系数的关键。",
            "id": "4018918",
            "problem": "考虑一个非轴对称的环形等离子体，其在每个磁通面上都配备了直场线磁坐标，用三元组 $(\\psi,\\theta,\\zeta)$ 表示，其中 $\\psi$ 是一个磁通面标签，$\\theta$ 是一个角向角，$\\zeta$ 是一个环向角。令微分体积元由雅可比量 $J(\\psi,\\theta,\\zeta)$ 决定，其通过坐标映射定义为 $J(\\psi,\\theta,\\zeta) = \\nabla \\psi \\cdot (\\nabla \\theta \\times \\nabla \\zeta)$。从微分体积元的定义出发，构造一个在固定 $\\psi$ 上的标量场 $f(\\theta,\\zeta)$ 的磁通面平均算符，其形式为带有适当几何加权的角坐标积分之比。然后，在坐标为 Hamada 坐标（在这种坐标下，面雅可比 $J^{-1}(\\psi,\\theta,\\zeta)$ 在每个磁通面上为常数）的假设下，计算由傅里叶展开式表示的标量场的磁通面平均值\n$$\nf(\\theta,\\zeta) = \\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}} f_{mn}\\,\\cos(m\\theta - n\\zeta).\n$$\n将最终答案表示为单一的闭式解析表达式。无需四舍五入，最终答案中不包含单位。",
            "solution": "问题陈述是有效的，因为它在科学上基于等离子体物理和磁流体动力学的原理，是适定的、客观的，并且包含了获得唯一解所需的所有必要信息。\n\n第一步是构造磁通面平均算符。在广义坐标 $(\\alpha^1, \\alpha^2, \\alpha^3)$ 中，微分体积元由 $d V = \\mathcal{J} d\\alpha^1 d\\alpha^2 d\\alpha^3$ 给出，其中 $\\mathcal{J}$ 是从笛卡尔坐标变换的雅可比行列式。问题给出了坐标 $(\\psi, \\theta, \\zeta)$ 并定义了一个量 $J = \\nabla \\psi \\cdot (\\nabla \\theta \\times \\nabla \\zeta)$。这个量 $J$ 是变换的雅可比行列式的倒数，即 $\\mathcal{J} = J^{-1}$。因此，微分体积元为 $d V = J^{-1}(\\psi, \\theta, \\zeta) d\\psi d\\theta d\\zeta$。\n\n标量场 $A$ 的磁通面平均值定义为 $A$ 在两个磁通面 $\\psi$ 和 $\\psi + d\\psi$ 之间的无穷小壳层体积上的平均值。该壳层的体积为 $dV_{\\text{shell}} = V'(\\psi) d\\psi$，其中 $V'(\\psi) = \\frac{dV}{d\\psi}$ 是由磁通面 $\\psi$ 所包围的体积的导数。我们可以通过对角坐标上的体积元进行积分来表示 $V'(\\psi)$：\n$$\nV'(\\psi) = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} J^{-1}(\\psi, \\theta, \\zeta) d\\theta d\\zeta\n$$\n标量场 $f(\\psi, \\theta, \\zeta)$ 的磁通面平均值（记为 $\\langle f \\rangle$）则定义为：\n$$\n\\langle f \\rangle(\\psi) = \\frac{1}{V'(\\psi) d\\psi} \\int_{\\text{shell}} f(\\psi', \\theta, \\zeta) dV = \\frac{1}{V'(\\psi) d\\psi} \\int_{\\psi}^{\\psi+d\\psi} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} f(\\psi', \\theta, \\zeta) J^{-1}(\\psi', \\theta, \\zeta) d\\theta d\\zeta d\\psi'\n$$\n在 $d\\psi \\to 0$ 的极限下，这变为：\n$$\n\\langle f \\rangle(\\psi) = \\frac{1}{V'(\\psi)} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} f(\\psi, \\theta, \\zeta) J^{-1}(\\psi, \\theta, \\zeta) d\\theta d\\zeta\n$$\n代入 $V'(\\psi)$ 的表达式，我们得到题目所要求的、以积分之比表示的磁通面平均算符：\n$$\n\\langle f \\rangle(\\psi) = \\frac{\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} f(\\psi, \\theta, \\zeta) J^{-1}(\\psi, \\theta, \\zeta) d\\theta d\\zeta}{\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} J^{-1}(\\psi, \\theta, \\zeta) d\\theta d\\zeta}\n$$\n这是对于一个在固定磁通面 $\\psi$ 上作为角坐标函数的标量场 $f$ 的磁通面平均算符的一般形式。\n\n问题的第二部分要求在 Hamada 坐标的假设下计算该平均值。Hamada 坐标的一个定义性属性是雅可比量 $J(\\psi, \\theta, \\zeta)$ 仅是磁通面标签 $\\psi$ 的函数。我们可以写作 $J(\\psi, \\theta, \\zeta) = J_H(\\psi)$。因此，其倒数 $J^{-1}$ 也仅是 $\\psi$ 的函数，$J^{-1}(\\psi, \\theta, \\zeta) = J_H^{-1}(\\psi)$。\n\n在此条件下，项 $J_H^{-1}(\\psi)$ 相对于积分变量 $\\theta$ 和 $\\zeta$ 是一个常数。它可以从分子和分母的积分中提出来：\n$$\n\\langle f \\rangle(\\psi) = \\frac{J_H^{-1}(\\psi) \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} f(\\psi, \\theta, \\zeta) d\\theta d\\zeta}{J_H^{-1}(\\psi) \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} d\\theta d\\zeta}\n$$\n项 $J_H^{-1}(\\psi)$ 被消去，分母中的积分计算结果为 $(2\\pi)^2 = 4\\pi^2$。在 Hamada 坐标中，磁通面平均值简化为对角域的未加权平均：\n$$\n\\langle f \\rangle(\\psi) = \\frac{1}{4\\pi^2} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} f(\\psi, \\theta, \\zeta) d\\theta d\\zeta\n$$\n现在，我们必须为给定的标量场计算这个平均值：\n$$\nf(\\theta, \\zeta) = \\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}} f_{mn}\\,\\cos(m\\theta - n\\zeta)\n$$\n系数 $f_{mn}$ 在给定的磁通面 $\\psi$ 上是常数。将其代入简化的平均值表达式，并假设级数是一致收敛的，我们可以交换求和与积分的顺序：\n$$\n\\langle f \\rangle(\\psi) = \\frac{1}{4\\pi^2} \\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}} f_{mn} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\cos(m\\theta - n\\zeta) d\\theta d\\zeta\n$$\n我们分析这个二重积分 $I_{mn} = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\cos(m\\theta - n\\zeta) d\\theta d\\zeta$。\n\n情况1：$m \\neq 0$。\n关于 $\\theta$ 的积分是：\n$$\n\\int_{0}^{2\\pi} \\cos(m\\theta - n\\zeta) d\\theta = \\left[ \\frac{1}{m} \\sin(m\\theta - n\\zeta) \\right]_{\\theta=0}^{\\theta=2\\pi} = \\frac{1}{m} (\\sin(2\\pi m - n\\zeta) - \\sin(-n\\zeta))\n$$\n由于 $m$ 是一个非零整数，$\\sin(2\\pi m - n\\zeta) = \\sin(-n\\zeta)$。因此，该积分为 $0$。所以，对于所有 $m \\neq 0$，$I_{mn} = 0$。\n\n情况2：$m = 0$ 且 $n \\neq 0$。\n积分变为：\n$$\nI_{0n} = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\cos(-n\\zeta) d\\theta d\\zeta = \\int_{0}^{2\\pi} \\cos(n\\zeta) \\left( \\int_{0}^{2\\pi} d\\theta \\right) d\\zeta = 2\\pi \\int_{0}^{2\\pi} \\cos(n\\zeta) d\\zeta\n$$\n$$\nI_{0n} = 2\\pi \\left[ \\frac{1}{n} \\sin(n\\zeta) \\right]_{\\zeta=0}^{\\zeta=2\\pi} = 2\\pi (0-0) = 0\n$$\n\n情况3：$m = 0$ 且 $n = 0$。\n积分变为：\n$$\nI_{00} = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\cos(0) d\\theta d\\zeta = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} 1 \\, d\\theta d\\zeta = (2\\pi)(2\\pi) = 4\\pi^2\n$$\n积分 $I_{mn}$ 仅在 $m=0$ 和 $n=0$ 的情况下非零。这是环面上傅里叶模正交性的一个结果。\n\n将此结果代回到 $\\langle f \\rangle(\\psi)$ 的求和式中，二重求和中的所有项都为零，除了对应于 $m=0$ 和 $n=0$ 的那一项：\n$$\n\\langle f \\rangle(\\psi) = \\frac{1}{4\\pi^2} \\left[ f_{00} \\cdot I_{00} + \\sum_{\\substack{m,n \\in \\mathbb{Z} \\\\ (m,n) \\neq (0,0)}} f_{mn} \\cdot 0 \\right] = \\frac{1}{4\\pi^2} f_{00} (4\\pi^2)\n$$\n这简化为：\n$$\n\\langle f \\rangle(\\psi) = f_{00}\n$$\n标量场 $f$ 的磁通面平均值等于其 $(m=0, n=0)$ 的傅里叶系数。这是函数在磁通面上展开式的直流分量，或称常数部分。",
            "answer": "$$\\boxed{f_{00}}$$"
        },
        {
            "introduction": "新经典输运分析的一个核心目标是确定双极径向电场 $E_r$，该电场源于离子和电子径向粒子流必须相互抵消以维持等离子体宏观稳定性的条件。这项练习模拟了一项真实的计算任务：使用模型输运系数（这些系数的计算依赖于前述的几何与平均概念）来求解非线性的双极性方程。这项实践将理论理解与寻找物理上有意义的等离子体平衡态所需的稳健数值方法联系起来。",
            "id": "4018927",
            "problem": "考虑在非轴对称环形几何中，由布泽尔坐标（Boozer coordinates）参数化的单个磁通面。假设一个漂移动力学求解器 (DKS) 为每个粒子种类提供新经典径向粒子通量响应系数，这些系数用以量化该粒子种类的径向粒子通量如何依赖于径向电场。对于粒子种类 $s \\in \\{\\text{离子}, \\text{电子}\\}$，其径向粒子通量 $\\Gamma_s$ 作为径向电场 $E_r$ 的函数被建模为\n$$\n\\Gamma_s(E_r) = A_s + B_s E_r + C_s \\tanh\\!\\big( D_s\\, g\\, E_r \\big),\n$$\n其中 $A_s$、$B_s$、$C_s$ 和 $D_s$ 是从漂移动力学求解器获得的常数系数，$g$ 是一个几何因子，用于缩放由非轴对称性引起的有效相空间进动频率（例如，与有效螺旋纹波和场线曲率相关）。假设离子和电子均为单电荷，因此双极性条件简化为\n$$\n\\Gamma_i(E_r) - \\Gamma_e(E_r) = 0.\n$$\n令 $f(E_r) \\equiv \\Gamma_i(E_r) - \\Gamma_e(E_r)$。您的任务是设计并实现一个迭代数值方案，使用带回溯的阻尼牛顿法求解 $f(E_r) = 0$ 以得到 $E_r$，并以松弛皮卡迭代作为备用方案。您必须通过找到代表不同非轴对称几何和输运区的三个不同参数集的解来展示其收敛特性。\n\n从基本的新经典输运原理出发：磁通面上的径向双极性和漂移动力学响应系数。目标是设计并实现一个稳健的求解器，该求解器遵循这些原理，并能收敛到 $f(E_r)$ 的具有物理意义的根。\n\n实现要求：\n- 根据给定模型，解析地定义函数 $f(E_r)$ 及其导数 $f'(E_r)$。导数必须从所提供的 $\\Gamma_s(E_r)$ 依赖关系中推导得出。\n- 实现一个带回溯的阻尼牛顿法，该方法试图单调减小 $|f(E_r)|$，并包含对小的 $|f'(E_r)|$ 的保障措施。\n- 实现一个松弛皮卡迭代 $E_r^{(k+1)} = E_r^{(k)} - \\lambda f(E_r^{(k)})$，其中松弛参数 $\\lambda$ 根据局部信息（例如，在可用时使用 $f'(E_r)$）自适应选择，以确保在牛顿法遇到困难时能够收敛。\n- 对所有测试用例使用初始猜测值 $E_r^{(0)} = 0$。\n- 使用基于残差 $|f(E_r)|$ 的停止准则，具体为 $|f(E_r)|  \\varepsilon$ 且 $\\varepsilon = 10^{-9}$，并且每种方法的最大迭代次数为 $100$ 次。\n- 将最终计算出的径向电场以伏特每米 (V/m) 为单位表示，并四舍五入至三位有效数字。\n\n解析形式：\n- 使用上述模型，推导出\n$$\nf(E_r) = \\big(A_i - A_e\\big) + \\big(B_i - B_e\\big) E_r + C_i \\tanh\\!\\big( D_i g E_r \\big) - C_e \\tanh\\!\\big( D_e g E_r \\big),\n$$\n和\n$$\nf'(E_r) = \\big(B_i - B_e\\big) + C_i D_i g\\, \\operatorname{sech}^2\\!\\big( D_i g E_r \\big) - C_e D_e g\\, \\operatorname{sech}^2\\!\\big( D_e g E_r \\big).\n$$\n\n测试套件：\n提供并求解以下三个科学上合理的测试用例，每个用例由参数元组 $(A_i, B_i, C_i, D_i, A_e, B_e, C_e, D_e, g)$ 指定。\n\n- 用例 1（电子根区间，典型纹波）：\n  - $A_i = 30.8$, $B_i = 10^{-3}$, $C_i = 0.5$, $D_i = 10^{-4}$,\n  - $A_e = 0.8$, $B_e = -10^{-3}$, $C_e = 0.4$, $D_e = 2 \\times 10^{-4}$,\n  - $g = 1.0$.\n- 用例 2（离子根区间，减弱的纹波）：\n  - $A_i = 0.2$, $B_i = 10^{-3}$, $C_i = 0.5$, $D_i = 10^{-4}$,\n  - $A_e = 10.2$, $B_e = -10^{-3}$, $C_e = 0.4$, $D_e = 2 \\times 10^{-4}$,\n  - $g = 0.5$.\n- 用例 3（临界情况，线性斜率近似抵消且非线性更强，增强的纹波）：\n  - $A_i = 0.45$, $B_i = 5.1 \\times 10^{-4}$, $C_i = 0.15$, $D_i = 5 \\times 10^{-5}$,\n  - $A_e = 0.15$, $B_e = 5.0 \\times 10^{-4}$, $C_e = 0.05$, $D_e = 10^{-4}$,\n  - $g = 2.0$.\n\n数值细节：\n- 在解析表达式中使用弧度作为双曲函数的单位，并遵循标准数学定义；无需进行角度单位转换。\n- 程序必须计算每个用例的根 $E_r$，将其转换为伏特每米 (V/m)，并四舍五入至三位有效数字。\n\n最终输出规格：\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，$[result1,result2,result3]$）。每个 $result$ 必须是最终的 $E_r$（单位 V/m），四舍五入至三位有效数字，并表示为浮点数。",
            "solution": "所提出的问题是有效的。它在科学上基于磁约束等离子体中的新经典输运原理，具体解决了非轴对称几何中双极性径向电场的计算问题。该问题是适定的，提供了一个明确定义的非线性方程、三个不同物理区间所需的所有参数，以及对稳健数值求解器的明确要求。所提供的函数及其导数的解析形式在数学上是正确的。整个设置是自洽、客观的，并要求将标准数值分析技术应用于一个具有物理意义的场景。\n\n问题的核心是找到双极性条件的根，该条件规定在稳态下，穿过磁通面的总电荷通量必须为零。对于由单电荷离子和电子组成的等离子体，此条件表示为 $\\Gamma_i(E_r) - \\Gamma_e(E_r) = 0$，其中 $\\Gamma_s$ 是粒子种类 $s$ 的径向粒子通量，$E_r$ 是径向电场。\n\n粒子种类通量由以下函数建模：\n$$\n\\Gamma_s(E_r) = A_s + B_s E_r + C_s \\tanh(D_s g E_r)\n$$\n在这里，$A_s$ 代表扩散通量分量，$B_s E_r$ 代表与非共振漂移相关的输运，而双曲正切项 $C_s \\tanh(D_s g E_r)$ 则模拟了非轴对称装置（例如，超香蕉-平台区）在低碰撞率区间中 resonant 粒子输运的特征性非线性行为。常数系数 $A_s$、$B_s$、$C_s$ 和 $D_s$ 由计算密集型的漂移动力学模拟确定，$g$ 是与磁场结构相关的几何因子。\n\n我们的任务是求解非线性方程 $f(E_r) = 0$，其中 $f(E_r)$ 是净电荷通量：\n$$\nf(E_r) \\equiv \\Gamma_i(E_r) - \\Gamma_e(E_r) = (A_i - A_e) + (B_i - B_e) E_r + C_i \\tanh(D_i g E_r) - C_e \\tanh(D_e g E_r)\n$$\n为了使用牛顿-拉夫逊法，我们需要 $f(E_r)$ 关于 $E_r$ 的解析导数。使用链式法则和恒等式 $\\frac{d}{dx}\\tanh(x) = \\operatorname{sech}^2(x)$，我们得到：\n$$\nf'(E_r) = \\frac{df}{dE_r} = (B_i - B_e) + C_i D_i g\\, \\operatorname{sech}^2(D_i g E_r) - C_e D_e g\\, \\operatorname{sech}^2(D_e g E_r)\n$$\n数值解将使用一种混合迭代方法寻求，从初始猜测值 $E_r^{(0)} = 0$ 开始。\n\n主要求解器是带回溯线搜索的阻尼牛顿法。第 $k$ 次迭代的标准牛顿-拉夫逊更新为：\n$$\nE_r^{(k+1)} = E_r^{(k)} - \\frac{f(E_r^{(k)})}{f'(E_r^{(k)})}\n$$\n这种更新可能过于激进，可能会越过解或导致发散。为了增强稳健性，引入一个阻尼因子 $\\alpha \\in (0, 1]$：\n$$\nE_r^{(k+1)} = E_r^{(k)} - \\alpha \\frac{f(E_r^{(k)})}{f'(E_r^{(k)})}\n$$\n回溯算法在每一步确定一个合适的 $\\alpha$ 值。它从 $\\alpha=1$（完整的牛顿步）开始，并检查新的候选解 $E_r^{(k+1)}$ 是否减小了残差的量级，即 $|f(E_r^{(k+1)})|  |f(E_r^{(k)})|$ 是否成立。如果不满足此条件，则相继减小 $\\alpha$（例如，减半）并测试新的候选解，直到条件满足或 $\\alpha$ 低于最小阈值。\n\n如果导数 $f'(E_r)$ 为零或接近零，牛顿法可能会失败，这种情况可能发生在 $f(E_r)$ 的局部极值附近。这是新经典输运中的一个已知特征，其中可能存在多个根和局部极值。问题为此类情况指定了一个备用机制：松弛皮卡迭代。该迭代的形式为：\n$$\nE_r^{(k+1)} = E_r^{(k)} - \\lambda_k f(E_r^{(k)})\n$$\n松弛参数 $\\lambda_k$ 使用局部信息自适应选择。一个有效的 $\\lambda_k$ 选择是利用导数来近似理想步长，从而将此方法与牛顿法联系起来：$\\lambda_k \\approx 1/f'(E_r^{(k)})$。为了处理 $f'(E_r^{(k)})$ 很小的情况，我们对该表达式进行正则化，例如，设置 $\\lambda_k = 1 / (\\text{sign}(f'(E_r^{(k)})) \\max(|f'(E_r^{(k)})|, \\delta))$，其中 $\\delta$ 是一个小的正常数。然而，为了在备用场景中保持简单和稳健，可以采用更简单的自适应方案，即在局部斜率的指导下，朝着与残差值相反的方向迈出一个小的、正则化的步长。所选择的实现将以牛顿法为主要工具，仅在牛顿更新失败时（由于导数接近零或回溯线搜索失败）才诉诸于次要的、更简单的步骤。\n\n对于每个测试用例，整体算法流程如下：\n1.  初始化 $k=0$，$E_r^{(0)} = 0$。\n2.  对于 $k$ 从 $0$ 到最大值 $100$：\n    a.  计算残差 $f_k = f(E_r^{(k)})$。\n    b.  检查收敛性：如果 $|f_k|  10^{-9}$，则终止并返回 $E_r^{(k)}$。\n    c.  计算导数 $f'_k = f'(E_r^{(k)})$。\n    d.  尝试一个阻尼牛顿步。如果成功（即 $|f'(E_r^{(k)})|$ 不太小且回溯找到一个能减小残差的步长），则更新 $E_r^{(k+1)}$ 并继续下一次迭代。\n    e.  如果牛顿步失败，则执行一个松弛皮卡步来生成 $E_r^{(k+1)}$。这确保了迭代能够取得进展。\n3.  如果达到最大迭代次数而未收敛，则报告失败。\n4.  最终收敛的 $E_r$ 值四舍五入至三位有效数字。\n\n这种混合策略结合了牛顿法在函数行为良好时的快速二次收敛性，以及在遇到数值困难时基于梯度的方法的更谨慎、稳健的行为，为指定问题提供了一个可靠的求解器。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve for the ambipolar radial electric field for three test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple of parameters:\n    # (A_i, B_i, C_i, D_i, A_e, B_e, C_e, D_e, g)\n    test_cases = [\n        # Case 1: electron-root regime, typical ripple\n        (30.8, 1e-3, 0.5, 1e-4, 0.8, -1e-3, 0.4, 2e-4, 1.0),\n        # Case 2: ion-root regime, reduced ripple\n        (0.2, 1e-3, 0.5, 1e-4, 10.2, -1e-3, 0.4, 2e-4, 0.5),\n        # Case 3: edge case, enhanced ripple\n        (0.45, 5.1e-4, 0.15, 5e-5, 0.15, 5.0e-4, 0.05, 1e-4, 2.0),\n    ]\n\n    def _f(Er, params):\n        \"\"\"Calculates the net charge flux f(Er).\"\"\"\n        Ai, Bi, Ci, Di, Ae, Be, Ce, De, g = params\n        term_const = Ai - Ae\n        term_linear = (Bi - Be) * Er\n        term_tanh_i = Ci * np.tanh(Di * g * Er)\n        term_tanh_e = Ce * np.tanh(De * g * Er)\n        return term_const + term_linear + term_tanh_i - term_tanh_e\n\n    def _df(Er, params):\n        \"\"\"Calculates the derivative of the net charge flux df/dEr.\"\"\"\n        _, Bi, Ci, Di, _, Be, Ce, De, g = params\n        term_linear = Bi - Be\n        \n        # sech(x) = 1/cosh(x)\n        cosh_i_arg = Di * g * Er\n        sech_sq_i = (1.0 / np.cosh(cosh_i_arg))**2\n        term_sech_i = Ci * Di * g * sech_sq_i\n\n        cosh_e_arg = De * g * Er\n        sech_sq_e = (1.0 / np.cosh(cosh_e_arg))**2\n        term_sech_e = Ce * De * g * sech_sq_e\n        \n        return term_linear + term_sech_i - term_sech_e\n\n    def find_ambipolar_root(params):\n        \"\"\"\n        Finds the root of f(Er) = 0 using a hybrid Newton/Picard method.\n        \"\"\"\n        Er = 0.0\n        max_iter = 100\n        tolerance = 1e-9\n        \n        # Parameters for the numerical methods\n        deriv_min_thresh = 1e-8  # Threshold for small derivative\n        backtrack_min_alpha = 1e-5 # Minimum damping factor in backtracking\n        picard_reg_delta = 1e-2 # Regularization for adaptive Picard lambda\n\n        for _ in range(max_iter):\n            f_val = _f(Er, params)\n\n            if abs(f_val)  tolerance:\n                return Er\n\n            df_val = _df(Er, params)\n            \n            newton_failed = False\n\n            # Attempt Damped Newton Step\n            if abs(df_val)  deriv_min_thresh:\n                newton_failed = True\n            else:\n                newton_step = -f_val / df_val\n                alpha = 1.0  # Start with full Newton step\n                \n                backtrack_success = False\n                while alpha  backtrack_min_alpha:\n                    Er_candidate = Er + alpha * newton_step\n                    f_candidate = _f(Er_candidate, params)\n                    \n                    if abs(f_candidate)  abs(f_val):\n                        Er = Er_candidate\n                        backtrack_success = True\n                        break\n                    \n                    alpha /= 2.0\n                \n                if not backtrack_success:\n                    newton_failed = True\n\n            # Fallback to Relaxed Picard Iteration\n            if newton_failed:\n                # Use an adaptive, regularized lambda for the Picard step\n                # to ensure a safe but productive step.\n                lambda_param = 1.0 / max(abs(df_val), picard_reg_delta)\n                Er = Er - lambda_param * f_val\n        \n        # If loop finishes without convergence, raise an error.\n        raise RuntimeError(f\"Solver failed to converge for params: {params}\")\n\n    def round_to_sig_figs(x, n):\n        \"\"\"Rounds a number x to n significant figures.\"\"\"\n        if x == 0:\n            return 0.0\n        return float(f'{x:.{n-1}e}')\n\n    results = []\n    for case in test_cases:\n        root_Er = find_ambipolar_root(case)\n        rounded_result = round_to_sig_figs(root_Er, 3)\n        results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}