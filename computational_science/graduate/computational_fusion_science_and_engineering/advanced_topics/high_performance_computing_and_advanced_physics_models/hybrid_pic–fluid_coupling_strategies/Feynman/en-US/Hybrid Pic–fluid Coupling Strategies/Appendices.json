{
    "hands_on_practices": [
        {
            "introduction": "Building effective simulation models often begins with a critical \"ordering analysis\" to determine the relevant physics. This practice will guide you through deriving the key dimensionless parameters that govern the behavior of a hybrid plasma model . By comparing the magnitudes of different terms in the governing equations, you can identify the dominant physics in a given scenario, a crucial first step in both theoretical analysis and computational modeling.",
            "id": "3991706",
            "problem": "A hybrid Particle-In-Cell (PIC)–fluid model treats ions kinetically and electrons as a charge-neutralizing fluid. Consider the electron momentum equation in the limit of collisional, quasi-neutral plasma, which yields the generalized Ohm’s law, and the ion momentum equation with possible finite Larmor radius corrections. You are tasked with constructing an ordering analysis that identifies the dimensionless parameters that control the relative importance of non-ideal terms in the electron generalized Ohm’s law compared to the ideal Magnetohydrodynamics (MHD) term. Use only the following fundamental starting points: Ampère’s law without displacement current, the definition of the Alfvén speed, the definition of plasma beta, the definition of the ion inertial length, and the definition of the ion gyroradius and ion thermal speed.\n\nAssume the following baseline for magnitudes:\n- The ideal MHD term magnitude in generalized Ohm’s law is set by $| \\boldsymbol{u}_i \\times \\boldsymbol{B} |$, with $|\\boldsymbol{u}_i| \\sim v_A$, where $v_A = B / \\sqrt{\\mu_0 n m_i}$ is the Alfvén speed.\n- The Hall term scales as $|( \\boldsymbol{J} \\times \\boldsymbol{B} )/(e n)|$, with $|\\boldsymbol{J}| \\sim B/(\\mu_0 L)$ from Ampère’s law and a single macroscopic length scale $L$.\n- The electron pressure-gradient term scales as $|\\nabla p_e|/(e n)$ with $|\\nabla p_e| \\sim p_e/L$. Use $p_e = f_e n k_B T$, where $f_e \\equiv T_e/(T_e+T_i)$ and $T \\equiv T_e + T_i$, and define the total plasma beta $\\beta \\equiv 2 \\mu_0 n k_B T / B^2$.\n- The leading finite Larmor radius (FLR) correction to the ion momentum equation (e.g., gyroviscous stress) produces a contribution that is higher order in the small parameter $\\rho_i/L$, where $\\rho_i \\equiv v_{\\text{th}i}/\\Omega_{ci}$ is the ion gyroradius, $v_{\\text{th}i} \\equiv \\sqrt{2 k_B T_i / m_i}$ is the ion thermal speed, and $\\Omega_{ci} \\equiv e B / m_i$ is the ion cyclotron frequency. For the purpose of this dimensional analysis, take its relative magnitude to the ideal MHD convective scale to be $\\mathcal{O}\\!\\left((\\rho_i/L)^2\\right)$.\n\nTasks:\n1) Using only the definitions above and $\\mu_0 \\varepsilon_0 c^2 = 1$, derive the dimensionless ratios of the Hall term and the electron pressure-gradient term to the ideal MHD term, and express them in terms of the ion inertial length $d_i \\equiv \\sqrt{m_i/(\\mu_0 n e^2)}$, the total beta $\\beta$, and the electron temperature fraction $f_e$. Show that the Hall ratio reduces to a function of $d_i/L$ and that the electron pressure-gradient ratio reduces to a function of $\\beta$, $f_e$, and $d_i/L$. Combine these with the FLR scaling to write the composite non-ideal-to-ideal ratio\n$$\nR_{\\text{total}} \\equiv R_{\\text{Hall}} + R_{p_e} + R_{\\text{FLR}}\n$$\nas a closed-form expression in $d_i/L$, $\\beta$, $f_e$, and $\\rho_i/L$.\n\n2) Evaluate $R_{\\text{total}}$ numerically for a deuterium plasma with the following parameters representative of a compact fusion device edge:\n- Magnetic field $B = 3\\,\\mathrm{T}$,\n- Number density $n = 5.0 \\times 10^{19}\\,\\mathrm{m}^{-3}$,\n- Ion temperature $T_i = 1.0\\,\\mathrm{keV}$,\n- Electron temperature $T_e = 1.0\\,\\mathrm{keV}$,\n- Macroscopic gradient scale $L = 0.10\\,\\mathrm{m}$,\n- Ion mass $m_i = 2 m_p$, with proton mass $m_p = 1.6726219 \\times 10^{-27}\\,\\mathrm{kg}$,\n- Elementary charge $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$,\n- Vacuum permeability $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\mathrm{H/m}$,\n- Speed of light $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m/s}$,\n- Vacuum permittivity $\\varepsilon_0 = 1/(\\mu_0 c^2)$.\n\nAdopt $f_e = 1/2$. Take $k_B T_e$ and $k_B T_i$ in joules using $1\\,\\mathrm{eV} = e\\,\\mathrm{J}$. Compute the intermediate quantities $\\beta$, $d_i/L$, and $\\rho_i/L$ explicitly from the definitions above, and then evaluate $R_{\\text{total}}$ using your expression from part (1). Round your final answer for $R_{\\text{total}}$ to three significant figures. The final answer is dimensionless; do not include units in the final answer.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\nThe givens are extracted verbatim from the problem statement:\n- **Model**: Hybrid Particle-In-Cell (PIC)–fluid model (ions kinetic, electrons fluid).\n- **Physics Context**: Generalized Ohm’s law from electron momentum equation, ion momentum equation with Finite Larmor Radius (FLR) corrections.\n- **Task**: Perform an ordering analysis to find dimensionless parameters controlling non-ideal terms relative to the ideal Magnetohydrodynamics (MHD) term.\n- **Fundamental Starting Points**: Ampère’s law without displacement current, and definitions of Alfvén speed, plasma beta, ion inertial length, ion gyroradius, and ion thermal speed.\n- **Scale Assumptions**:\n  - Ideal MHD term magnitude: $| \\boldsymbol{u}_i \\times \\boldsymbol{B} |$, with $|\\boldsymbol{u}_i| \\sim v_A$.\n  - Alfvén speed: $v_A = B / \\sqrt{\\mu_0 n m_i}$.\n  - Hall term magnitude: $|( \\boldsymbol{J} \\times \\boldsymbol{B} )/(e n)|$, with $|\\boldsymbol{J}| \\sim B/(\\mu_0 L)$.\n  - Electron pressure-gradient term magnitude: $|\\nabla p_e|/(e n)$, with $|\\nabla p_e| \\sim p_e/L$.\n  - Electron pressure: $p_e = f_e n k_B T$.\n  - Electron temperature fraction: $f_e \\equiv T_e/(T_e+T_i)$.\n  - Total temperature: $T \\equiv T_e + T_i$.\n  - Total plasma beta: $\\beta \\equiv 2 \\mu_0 n k_B T / B^2$.\n  - FLR correction relative magnitude: $R_{\\text{FLR}} \\sim \\mathcal{O}\\!\\left((\\rho_i/L)^2\\right)$.\n  - Ion gyroradius: $\\rho_i \\equiv v_{\\text{th}i}/\\Omega_{ci}$.\n  - Ion thermal speed: $v_{\\text{th}i} \\equiv \\sqrt{2 k_B T_i / m_i}$.\n  - Ion cyclotron frequency: $\\Omega_{ci} \\equiv e B / m_i$.\n  - Ion inertial length: $d_i \\equiv \\sqrt{m_i/(\\mu_0 n e^2)}$.\n- **Task 1**: Derive dimensionless ratios $R_{\\text{Hall}}$ and $R_{p_e}$ and the composite ratio $R_{\\text{total}} \\equiv R_{\\text{Hall}} + R_{p_e} + R_{\\text{FLR}}$.\n- **Task 2**: Evaluate $R_{\\text{total}}$ for a deuterium plasma with parameters:\n  - $B = 3\\,\\mathrm{T}$\n  - $n = 5.0 \\times 10^{19}\\,\\mathrm{m}^{-3}$\n  - $T_i = 1.0\\,\\mathrm{keV}$\n  - $T_e = 1.0\\,\\mathrm{keV}$\n  - $L = 0.10\\,\\mathrm{m}$\n  - $m_i = 2 m_p$\n  - $m_p = 1.6726219 \\times 10^{-27}\\,\\mathrm{kg}$\n  - $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n  - $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\mathrm{H/m}$\n- **Assumptions for evaluation**: $f_e = 1/2$. Use $1\\,\\mathrm{eV} = e\\,\\mathrm{J}$.\n- **Final Answer requirement**: Round numerical result for $R_{\\text{total}}$ to three significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is validated against the required criteria:\n- **Scientifically Grounded**: The problem is based on standard, well-established principles of plasma physics, specifically extended MHD theory, which is critical for understanding phenomena in fusion plasmas. All definitions and equations are standard.\n- **Well-Posed**: The problem is clearly structured. It asks for a symbolic derivation followed by a numerical calculation using a complete set of provided parameters. The tasks lead to a unique and meaningful result.\n- **Objective**: The problem is expressed in precise, technical language, free of any subjectivity or bias.\n- **Completeness and Consistency**: The problem provides all necessary definitions, scaling assumptions, and numerical values to complete the required tasks. There are no contradictions. The assumption $f_e = 1/2$ is consistent with the given $T_e=T_i=1.0\\,\\mathrm{keV}$.\n- **Realism**: The physical parameters are realistic and representative of the edge region of a modern compact fusion device.\n\n### Step 3: Verdict and Action\nThe problem is found to be valid. The solution will be derived as follows.\n\n### Part 1: Derivation of Dimensionless Ratios\n\nThe goal is to find the ratio of the non-ideal terms to the ideal MHD term in the generalized Ohm's law.\n\n**Ideal MHD Term Magnitude ($M_{\\text{ideal}}$)**\nThe magnitude of the ideal MHD term is given by the scale of $| \\boldsymbol{u}_i \\times \\boldsymbol{B} |$. With the assumption $|\\boldsymbol{u}_i| \\sim v_A$, and assuming $\\boldsymbol{u}_i$ is not parallel to $\\boldsymbol{B}$, the magnitude scales as:\n$$\nM_{\\text{ideal}} \\sim v_A B\n$$\n\n**Hall Term Ratio ($R_{\\text{Hall}}$)**\nThe magnitude of the Hall term is given by the scale of $|(\\boldsymbol{J} \\times \\boldsymbol{B}) / (e n)|$. Using the Ampère's law scaling for the current density, $|\\boldsymbol{J}| \\sim B/(\\mu_0 L)$, the magnitude is:\n$$\nM_{\\text{Hall}} \\sim \\frac{(B/(\\mu_0 L)) B}{e n} = \\frac{B^2}{\\mu_0 e n L}\n$$\nThe dimensionless ratio $R_{\\text{Hall}}$ is the ratio of $M_{\\text{Hall}}$ to $M_{\\text{ideal}}$:\n$$\nR_{\\text{Hall}} = \\frac{M_{\\text{Hall}}}{M_{\\text{ideal}}} \\sim \\frac{B^2/(\\mu_0 e n L)}{v_A B} = \\frac{B}{\\mu_0 e n L v_A}\n$$\nNow, we substitute the definition of the Alfvén speed, $v_A = B / \\sqrt{\\mu_0 n m_i}$:\n$$\nR_{\\text{Hall}} \\sim \\frac{B}{\\mu_0 e n L (B/\\sqrt{\\mu_0 n m_i})} = \\frac{\\sqrt{\\mu_0 n m_i}}{\\mu_0 e n L} = \\frac{1}{eL} \\sqrt{\\frac{m_i}{\\mu_0 n}}\n$$\nWe recognize that the definition of the ion inertial length is $d_i = \\sqrt{m_i/(\\mu_0 n e^2)}$. We can rewrite our expression for $R_{\\text{Hall}}$ to match this form:\n$$\nR_{\\text{Hall}} \\sim \\frac{1}{L} \\sqrt{\\frac{m_i}{\\mu_0 n e^2}} = \\frac{d_i}{L}\n$$\nThus, the Hall term ratio is $R_{\\text{Hall}} = d_i/L$, which is a function of $d_i/L$ as required.\n\n**Electron Pressure-Gradient Ratio ($R_{p_e}$)**\nThe magnitude of the electron pressure-gradient term is given by the scale of $|\\nabla p_e|/(en)$. With $|\\nabla p_e| \\sim p_e/L$, the magnitude is:\n$$\nM_{p_e} \\sim \\frac{p_e}{e n L}\n$$\nUsing the given definition $p_e = f_e n k_B T$, we have:\n$$\nM_{p_e} \\sim \\frac{f_e n k_B T}{e n L} = \\frac{f_e k_B T}{e L}\n$$\nThe dimensionless ratio $R_{p_e}$ is the ratio of $M_{p_e}$ to $M_{\\text{ideal}}$:\n$$\nR_{p_e} = \\frac{M_{p_e}}{M_{\\text{ideal}}} \\sim \\frac{f_e k_B T / (e L)}{v_A B} = \\frac{f_e k_B T}{e L v_A B}\n$$\nTo express this in the desired variables, we use the definition of plasma beta, $\\beta = 2 \\mu_0 n k_B T / B^2$, which gives $k_B T = \\beta B^2 / (2 \\mu_0 n)$. Substituting this into the expression for $R_{p_e}$:\n$$\nR_{p_e} \\sim \\frac{f_e}{e L v_A B} \\left( \\frac{\\beta B^2}{2 \\mu_0 n} \\right) = \\frac{f_e \\beta B}{2 e L \\mu_0 n v_A}\n$$\nAgain, we substitute $v_A = B / \\sqrt{\\mu_0 n m_i}$:\n$$\nR_{p_e} \\sim \\frac{f_e \\beta B}{2 e L \\mu_0 n (B/\\sqrt{\\mu_0 n m_i})} = \\frac{f_e \\beta \\sqrt{\\mu_0 n m_i}}{2 e L \\mu_0 n} = \\frac{f_e \\beta}{2} \\left( \\frac{1}{eL} \\sqrt{\\frac{m_i}{\\mu_0 n}} \\right)\n$$\nAs before, the term in parentheses is equivalent to $d_i/L$. Therefore:\n$$\nR_{p_e} = \\frac{\\beta f_e}{2} \\frac{d_i}{L}\n$$\nThis expression is a function of $\\beta$, $f_e$, and $d_i/L$ as required.\n\n**Finite Larmor Radius Ratio ($R_{\\text{FLR}}$)**\nThe problem states that the relative magnitude of the leading FLR correction to the ideal MHD scale is $\\mathcal{O}\\!\\left((\\rho_i/L)^2\\right)$. Thus, we take:\n$$\nR_{\\text{FLR}} = \\left(\\frac{\\rho_i}{L}\\right)^2\n$$\n\n**Composite Ratio ($R_{\\text{total}}$)**\nThe total ratio of non-ideal to ideal terms is the sum of the individual ratios:\n$$\nR_{\\text{total}} = R_{\\text{Hall}} + R_{p_e} + R_{\\text{FLR}} = \\frac{d_i}{L} + \\frac{\\beta f_e}{2} \\frac{d_i}{L} + \\left(\\frac{\\rho_i}{L}\\right)^2\n$$\nThis expression can be factored to give the final closed-form expression:\n$$\nR_{\\text{total}} = \\frac{d_i}{L} \\left(1 + \\frac{\\beta f_e}{2}\\right) + \\left(\\frac{\\rho_i}{L}\\right)^2\n$$\n\n### Part 2: Numerical Evaluation\n\nWe now evaluate $R_{\\text{total}}$ using the provided parameters for a deuterium plasma.\n- Ion mass: $m_i = 2 m_p = 2 \\times (1.6726219 \\times 10^{-27}\\,\\mathrm{kg}) = 3.3452438 \\times 10^{-27}\\,\\mathrm{kg}$.\n- Temperatures: $T_e = 1.0\\,\\mathrm{keV}$ and $T_i = 1.0\\,\\mathrm{keV}$.\n- Temperature in Joules: $1\\,\\mathrm{keV} = 1000\\,\\mathrm{eV} = 1000 \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})\\,\\mathrm{J} = 1.602176634 \\times 10^{-16}\\,\\mathrm{J}$.\n- $k_B T_e = k_B T_i = 1.602176634 \\times 10^{-16}\\,\\mathrm{J}$.\n- Total temperature term: $k_B T = k_B(T_e + T_i) = 2 \\times (1.602176634 \\times 10^{-16}\\,\\mathrm{J}) = 3.204353268 \\times 10^{-16}\\,\\mathrm{J}$.\n- Electron temperature fraction: $f_e = T_e/(T_e+T_i) = 1.0/(1.0+1.0) = 0.5$.\n\nWe calculate the intermediate dimensionless quantities:\n\n**Total Plasma Beta ($\\beta$)**:\n$$\n\\beta = \\frac{2 \\mu_0 n k_B T}{B^2} = \\frac{2 \\times (4\\pi \\times 10^{-7}\\,\\mathrm{H/m}) \\times (5.0 \\times 10^{19}\\,\\mathrm{m}^{-3}) \\times (3.20435... \\times 10^{-16}\\,\\mathrm{J})}{(3\\,\\mathrm{T})^2}\n$$\n$$\n\\beta = \\frac{4.026548... \\times 10^{-2}}{9} = 0.0044739...\n$$\n\n**Ratio $d_i/L$**:\nFirst, we compute the ion inertial length $d_i$:\n$$\nd_i = \\sqrt{\\frac{m_i}{\\mu_0 n e^2}} = \\sqrt{\\frac{3.3452438 \\times 10^{-27}\\,\\mathrm{kg}}{(4\\pi \\times 10^{-7}\\,\\mathrm{H/m}) \\times (5.0 \\times 10^{19}\\,\\mathrm{m}^{-3}) \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})^2}}\n$$\n$$\nd_i = \\sqrt{\\frac{3.3452438 \\times 10^{-27}}{1.61280... \\times 10^{-24}}}\\,\\mathrm{m} = \\sqrt{0.002074...}\\,\\mathrm{m} = 0.045543... \\,\\mathrm{m}\n$$\nThen, we find the ratio to the macroscopic scale length $L = 0.10\\,\\mathrm{m}$:\n$$\n\\frac{d_i}{L} = \\frac{0.045543... \\,\\mathrm{m}}{0.10\\,\\mathrm{m}} = 0.45543...\n$$\n\n**Ratio $\\rho_i/L$**:\nFirst, we compute the ion thermal speed $v_{\\text{th}i}$:\n$$\nv_{\\text{th}i} = \\sqrt{\\frac{2 k_B T_i}{m_i}} = \\sqrt{\\frac{2 \\times (1.602176634 \\times 10^{-16}\\,\\mathrm{J})}{3.3452438 \\times 10^{-27}\\,\\mathrm{kg}}} = \\sqrt{9.5788... \\times 10^{10}}\\,\\mathrm{m/s} = 3.0950... \\times 10^5\\,\\mathrm{m/s}\n$$\nNext, the ion cyclotron frequency $\\Omega_{ci}$:\n$$\n\\Omega_{ci} = \\frac{e B}{m_i} = \\frac{(1.602176634 \\times 10^{-19}\\,\\mathrm{C}) \\times (3\\,\\mathrm{T})}{3.3452438 \\times 10^{-27}\\,\\mathrm{kg}} = 1.4368... \\times 10^8\\,\\mathrm{rad/s}\n$$\nThe ion gyroradius $\\rho_i$ is their ratio:\n$$\n\\rho_i = \\frac{v_{\\text{th}i}}{\\Omega_{ci}} = \\frac{3.0950... \\times 10^5\\,\\mathrm{m/s}}{1.4368... \\times 10^8\\,\\mathrm{rad/s}} = 0.002154... \\,\\mathrm{m}\n$$\nFinally, we find the ratio to the macroscopic scale length $L$:\n$$\n\\frac{\\rho_i}{L} = \\frac{0.002154... \\,\\mathrm{m}}{0.10\\,\\mathrm{m}} = 0.02154...\n$$\n\n**Total Ratio $R_{\\text{total}}$**:\nWe substitute the calculated values into the expression for $R_{\\text{total}}$:\n$$\nR_{\\text{total}} = \\frac{d_i}{L} \\left(1 + \\frac{\\beta f_e}{2}\\right) + \\left(\\frac{\\rho_i}{L}\\right)^2\n$$\n$$\nR_{\\text{total}} = 0.45543... \\times \\left(1 + \\frac{0.0044739... \\times 0.5}{2}\\right) + (0.02154...)^2\n$$\n$$\nR_{\\text{total}} = 0.45543... \\times (1 + 0.001118...) + 0.0004640...\n$$\n$$\nR_{\\text{total}} = 0.45543... \\times (1.001118...) + 0.0004640...\n$$\n$$\nR_{\\text{total}} = 0.45594... + 0.0004640... = 0.456405...\n$$\nRounding the final result to three significant figures, we get $0.456$. For these parameters, the non-ideal effects have a magnitude that is approximately $45.6\\%$ of the ideal MHD term, with the Hall effect being the dominant contribution.",
            "answer": "$$\\boxed{0.456}$$"
        },
        {
            "introduction": "A cornerstone of stable and accurate hybrid simulations is the strict enforcement of charge conservation. This exercise provides a practical, code-based demonstration of what happens when a numerical scheme fails to perfectly conserve charge . By intentionally introducing a small error in the current deposition, you will quantify the resulting spurious growth in electrostatic energy, providing a clear lesson on the importance of conservative algorithms.",
            "id": "3991671",
            "problem": "Consider a one-dimensional periodic domain of length $L$ representing a simplified electrostatic mode in a hybrid Particle-In-Cell–fluid (PIC–fluid) model relevant to computational fusion science and engineering. In such hybrid models, kinetic ions are coupled to a fluid electron model, and stable evolution requires strict enforcement of the discrete charge continuity equation. A small violation of charge conservation can inject inconsistency into the coupling, which in turn can produce spurious electrostatic energy growth.\n\nStart from the following fundamental relations:\n- Maxwell's equations in the electrostatic limit (with vanishing magnetic field curl) imply the Ampère update $\\partial_t E(x,t) = - J(x,t) / \\varepsilon_0$, and Gauss's law $\\partial_x E(x,t) = \\rho(x,t)/\\varepsilon_0$, where $\\varepsilon_0$ is the vacuum permittivity.\n- The charge continuity equation is $\\partial_t \\rho(x,t) + \\partial_x J(x,t) = 0$.\n\nDefine a physically consistent, single-mode hybrid test problem with spatial wavenumber $k = 2\\pi m/L$ and time dependence at angular frequency $\\omega$:\n- Physical charge density: $\\rho(x,t) = A \\cos(k x) \\sin(\\omega t)$,\n- Physical current density: $J(x,t) = -\\dfrac{A \\omega}{k} \\sin(k x) \\cos(\\omega t)$,\nwhich exactly satisfies $\\partial_t \\rho + \\partial_x J = 0$.\n\nSuppose that the PIC–fluid coupling deposits a slightly incorrect current, modeled as a fractional multiplicative error $\\varepsilon$ such that\n- Deposited current: $J_{\\mathrm{dep}}(x,t) = (1+\\varepsilon) J(x,t)$,\nwhich introduces a controlled violation of the discrete continuity equation.\n\nAdvance the electric field using the Ampère update in the electrostatic limit from the initial condition $E(x,0) = 0$:\n- Deposited-field evolution: $\\partial_t E_{\\mathrm{dep}}(x,t) = - J_{\\mathrm{dep}}(x,t)/\\varepsilon_0$,\nand compare to the physically consistent field obtained from Gauss's law with periodic boundary conditions and zero spatial mean:\n- Physical field: $\\partial_x E_{\\mathrm{phys}}(x,t) = \\rho(x,t)/\\varepsilon_0$.\n\nDefine the electrostatic energies\n- $W_{\\mathrm{dep}}(t) = \\displaystyle \\int_0^L \\dfrac{\\varepsilon_0}{2}\\, E_{\\mathrm{dep}}(x,t)^2 \\, dx$,\n- $W_{\\mathrm{phys}}(t) = \\displaystyle \\int_0^L \\dfrac{\\varepsilon_0}{2}\\, E_{\\mathrm{phys}}(x,t)^2 \\, dx$,\nand the spurious growth due to the charge-conservation violation\n- $\\Delta W(t) = W_{\\mathrm{dep}}(t) - W_{\\mathrm{phys}}(t)$.\n\nTask: Write a complete, runnable program that computes $\\Delta W(t)$ at $t_{\\mathrm{end}} = \\pi/(2\\omega)$, where $\\sin(\\omega t_{\\mathrm{end}}) = 1$ (angles in radians), for the parameter sets listed below. Use $\\varepsilon_0 = 8.854187817\\times 10^{-12}$ Farads per meter. Express all final energy quantities in Joules.\n\nTest suite parameter sets, given as tuples $(\\varepsilon, m, A, \\omega, L)$:\n1. $(0.0, 1, 1.0\\times 10^{-6}, 1.0\\times 10^{6}, 1.0)$,\n2. $(1.0\\times 10^{-3}, 1, 1.0\\times 10^{-6}, 1.0\\times 10^{6}, 1.0)$,\n3. $(5.0\\times 10^{-3}, 10, 1.0\\times 10^{-6}, 1.0\\times 10^{6}, 1.0)$,\n4. $(-2.0\\times 10^{-3}, 1, 1.0\\times 10^{-6}, 1.0\\times 10^{6}, 1.0)$,\n5. $(5.0\\times 10^{-3}, 1, 0.0, 1.0\\times 10^{6}, 1.0)$.\n\nYour program should produce a single line of output containing the results for these five test cases as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3,result4,result5]\"). Each result must be a float giving $\\Delta W(t_{\\mathrm{end}})$ in Joules.",
            "solution": "The problem requires the calculation of the spurious electrostatic energy growth, $\\Delta W(t)$, at a specific time, $t_{\\mathrm{end}}$, arising from a controlled violation of charge conservation in a hybrid Particle-In-Cell (PIC)–fluid model. The analysis begins by deriving the analytical expressions for the electric fields and associated energies.\n\nFirst, the physical electric field, $E_{\\mathrm{phys}}(x,t)$, is determined from Gauss's law, $\\partial_x E_{\\mathrm{phys}}(x,t) = \\rho(x,t)/\\varepsilon_0$. Using the given physical charge density, $\\rho(x,t) = A \\cos(k x) \\sin(\\omega t)$, we integrate with respect to $x$:\n$$\nE_{\\mathrm{phys}}(x,t) = \\int \\frac{\\rho(x,t)}{\\varepsilon_0} \\, dx = \\int \\frac{A}{\\varepsilon_0} \\cos(k x) \\sin(\\omega t) \\, dx\n$$\n$$\nE_{\\mathrm{phys}}(x,t) = \\frac{A \\sin(\\omega t)}{\\varepsilon_0} \\int \\cos(k x) \\, dx = \\frac{A \\sin(\\omega t)}{k \\varepsilon_0} \\sin(k x) + C(t)\n$$\nThe problem specifies periodic boundary conditions and a zero spatial mean for the electric field. The spatial mean of $\\sin(k x)$ over the domain of length $L$, where $k=2\\pi m/L$ and $m$ is an integer, is zero.\n$$\n\\frac{1}{L} \\int_0^L \\sin(k x) \\, dx = \\frac{1}{L} \\left[ -\\frac{1}{k} \\cos(k x) \\right]_0^L = -\\frac{1}{kL} (\\cos(2\\pi m) - \\cos(0)) = 0\n$$\nTo maintain a zero spatial mean for $E_{\\mathrm{phys}}(x,t)$, the integration constant $C(t)$ must be zero. Therefore, the physical electric field is:\n$$\nE_{\\mathrm{phys}}(x,t) = \\frac{A}{k \\varepsilon_0} \\sin(k x) \\sin(\\omega t)\n$$\n\nNext, the deposited electric field, $E_{\\mathrm{dep}}(x,t)$, is found by integrating the Ampère update, $\\partial_t E_{\\mathrm{dep}}(x,t) = - J_{\\mathrm{dep}}(x,t)/\\varepsilon_0$, with the initial condition $E_{\\mathrm{dep}}(x,0) = 0$. The deposited current, $J_{\\mathrm{dep}}(x,t)$, is given as $(1+\\varepsilon)J(x,t)$, where $J(x,t) = -\\frac{A \\omega}{k} \\sin(k x) \\cos(\\omega t)$.\n$$\n\\partial_t E_{\\mathrm{dep}}(x,t) = - \\frac{(1+\\varepsilon)}{\\varepsilon_0} \\left( -\\frac{A \\omega}{k} \\sin(k x) \\cos(\\omega t) \\right) = (1+\\varepsilon) \\frac{A \\omega}{k \\varepsilon_0} \\sin(k x) \\cos(\\omega t)\n$$\nIntegrating with respect to $t$:\n$$\nE_{\\mathrm{dep}}(x,t) = \\int (1+\\varepsilon) \\frac{A \\omega}{k \\varepsilon_0} \\sin(k x) \\cos(\\omega t) \\, dt = (1+\\varepsilon) \\frac{A}{k \\varepsilon_0} \\sin(k x) \\int \\omega \\cos(\\omega t) \\, dt\n$$\n$$\nE_{\\mathrm{dep}}(x,t) = (1+\\varepsilon) \\frac{A}{k \\varepsilon_0} \\sin(k x) \\sin(\\omega t) + C'(x)\n$$\nApplying the initial condition $E_{\\mathrm{dep}}(x,0) = 0$:\n$$\nE_{\\mathrm{dep}}(x,0) = (1+\\varepsilon) \\frac{A}{k \\varepsilon_0} \\sin(k x) \\sin(0) + C'(x) = 0 + C'(x) = 0\n$$\nThus, the integration constant $C'(x)$ is zero, and the deposited field is:\n$$\nE_{\\mathrm{dep}}(x,t) = (1+\\varepsilon) \\frac{A}{k \\varepsilon_0} \\sin(k x) \\sin(\\omega t) = (1+\\varepsilon) E_{\\mathrm{phys}}(x,t)\n$$\n\nNow we calculate the electrostatic energies. The physical energy $W_{\\mathrm{phys}}(t)$ is:\n$$\nW_{\\mathrm{phys}}(t) = \\int_0^L \\frac{\\varepsilon_0}{2} E_{\\mathrm{phys}}(x,t)^2 \\, dx = \\int_0^L \\frac{\\varepsilon_0}{2} \\left( \\frac{A}{k \\varepsilon_0} \\sin(k x) \\sin(\\omega t) \\right)^2 \\, dx\n$$\n$$\nW_{\\mathrm{phys}}(t) = \\frac{\\varepsilon_0}{2} \\frac{A^2 \\sin^2(\\omega t)}{k^2 \\varepsilon_0^2} \\int_0^L \\sin^2(k x) \\, dx = \\frac{A^2 \\sin^2(\\omega t)}{2 k^2 \\varepsilon_0} \\int_0^L \\sin^2(k x) \\, dx\n$$\nSince $k=2\\pi m/L$, the domain $[0,L]$ contains exactly $m$ periods, so the integral is $\\int_0^L \\sin^2(k x) dx = L/2$.\n$$\nW_{\\mathrm{phys}}(t) = \\frac{A^2 \\sin^2(\\omega t)}{2 k^2 \\varepsilon_0} \\left( \\frac{L}{2} \\right) = \\frac{L A^2}{4 k^2 \\varepsilon_0} \\sin^2(\\omega t)\n$$\nThe deposited energy $W_{\\mathrm{dep}}(t)$ is related to $W_{\\mathrm{phys}}(t)$ through the fields:\n$$\nW_{\\mathrm{dep}}(t) = \\int_0^L \\frac{\\varepsilon_0}{2} E_{\\mathrm{dep}}(x,t)^2 \\, dx = \\int_0^L \\frac{\\varepsilon_0}{2} ((1+\\varepsilon)E_{\\mathrm{phys}}(x,t))^2 \\, dx\n$$\n$$\nW_{\\mathrm{dep}}(t) = (1+\\varepsilon)^2 \\int_0^L \\frac{\\varepsilon_0}{2} E_{\\mathrm{phys}}(x,t)^2 \\, dx = (1+\\varepsilon)^2 W_{\\mathrm{phys}}(t)\n$$\nThe spurious energy growth $\\Delta W(t)$ is the difference between these energies:\n$$\n\\Delta W(t) = W_{\\mathrm{dep}}(t) - W_{\\mathrm{phys}}(t) = (1+\\varepsilon)^2 W_{\\mathrm{phys}}(t) - W_{\\mathrm{phys}}(t)\n$$\n$$\n\\Delta W(t) = \\left( (1+2\\varepsilon+\\varepsilon^2) - 1 \\right) W_{\\mathrm{phys}}(t) = (2\\varepsilon + \\varepsilon^2) W_{\\mathrm{phys}}(t)\n$$\nSubstituting the expression for $W_{\\mathrm{phys}}(t)$:\n$$\n\\Delta W(t) = (2\\varepsilon + \\varepsilon^2) \\frac{L A^2}{4 k^2 \\varepsilon_0} \\sin^2(\\omega t)\n$$\nThe task is to evaluate this quantity at $t_{\\mathrm{end}} = \\pi/(2\\omega)$, where $\\sin(\\omega t_{\\mathrm{end}}) = \\sin(\\pi/2) = 1$.\n$$\n\\Delta W(t_{\\mathrm{end}}) = (2\\varepsilon + \\varepsilon^2) \\frac{L A^2}{4 k^2 \\varepsilon_0}\n$$\nFinally, substituting $k = 2\\pi m/L$, we obtain the formula for computation:\n$$\n\\Delta W(t_{\\mathrm{end}}) = (2\\varepsilon + \\varepsilon^2) \\frac{L A^2}{4 (2\\pi m/L)^2 \\varepsilon_0} = (2\\varepsilon + \\varepsilon^2) \\frac{L A^2}{4 (4\\pi^2 m^2/L^2) \\varepsilon_0}\n$$\n$$\n\\Delta W(t_{\\mathrm{end}}) = (2\\varepsilon + \\varepsilon^2) \\frac{L^3 A^2}{16 \\pi^2 m^2 \\varepsilon_0}\n$$\nThis final expression is used to compute the required values for each test case. Note that if $A=0$ or $\\varepsilon=0$, $\\Delta W(t_{\\mathrm{end}})$ is correctly zero. For $m \\to \\infty$, the spurious energy growth vanishes, as expected since high-$k$ modes contain less energy for a given amplitude. The angular frequency $\\omega$ does not appear in the final expression for the energy at peak field, as its role is only to set the timescale, and the problem specifies evaluation at a fixed phase $\\omega t = \\pi/2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spurious electrostatic energy growth in a simplified 1D\n    hybrid PIC-fluid model due to a charge conservation violation.\n    \"\"\"\n    \n    # Define the physical constant\n    epsilon_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (epsilon, m, A, omega, L)\n    test_cases = [\n        (0.0, 1, 1.0e-6, 1.0e6, 1.0),\n        (1.0e-3, 1, 1.0e-6, 1.0e6, 1.0),\n        (5.0e-3, 10, 1.0e-6, 1.0e6, 1.0),\n        (-2.0e-3, 1, 1.0e-6, 1.0e6, 1.0),\n        (5.0e-3, 1, 0.0, 1.0e6, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        eps, m, A, omega, L = case\n        \n        # The analytical formula for the spurious energy growth at t_end is:\n        # Delta_W = (2*eps + eps^2) * (L^3 * A^2) / (16 * pi^2 * m^2 * epsilon_0)\n        #\n        # A_val = 0 or m = 0 would result in Delta_W = 0.\n        # The problem statement ensures m >= 1.\n        if A == 0.0 or m == 0:\n            delta_W = 0.0\n        else:\n            # Factor related to the fractional current error\n            eps_factor = 2 * eps + eps**2\n            \n            # Factor related to the physical parameters\n            phys_factor = (L**3 * A**2) / (16 * np.pi**2 * m**2 * epsilon_0)\n            \n            delta_W = eps_factor * phys_factor\n        \n        results.append(delta_W)\n\n    # Final print statement in the exact required format.\n    # The format specifier '.7e' ensures sufficient precision for all cases.\n    print(f\"[{','.join(f'{r:.7e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice integrates theory, implementation, and analysis in a comprehensive verification test, a standard task in computational code development. You will implement a solver for whistler waves, a fundamental mode in magnetized plasmas, based on the hybrid model equations . By comparing the wave frequency from your simulation against the analytical dispersion relation, you will verify the correctness of the numerical scheme, a crucial step in building confidence in any simulation tool.",
            "id": "3991711",
            "problem": "Consider a one-dimensional periodic domain of length $L$ with a uniform background magnetic field $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{x}}$, a cold electron fluid of number density $n_0$, and ions treated in the hybrid Particle-In-Cell (PIC)–fluid framework as an immobile quasi-neutralizing background. Assume low-frequency electromagnetic dynamics with the displacement current neglected, so that Ampère's law reduces to $\\mu_0 \\mathbf{J} = \\nabla \\times \\mathbf{B}$, and Faraday's law is $\\partial_t \\mathbf{B} = - \\nabla \\times \\mathbf{E}$. The electron momentum equation with inertia is $m_e \\partial_t \\mathbf{v}_e = - e \\left( \\mathbf{E} + \\mathbf{v}_e \\times \\mathbf{B}_0 \\right)$, and quasi-neutrality with immobile ions gives $\\mathbf{J} = - e n_0 \\mathbf{v}_e$. The electron inertial skin depth is $d_e = \\sqrt{ \\dfrac{m_e}{\\mu_0 n_0 e^2} }$, and the electron cyclotron frequency is $\\Omega_e = \\dfrac{e B_0}{m_e}$. For parallel propagation along $\\hat{\\mathbf{x}}$, the linear whistler wave dispersion relation including electron inertia is\n$$\n\\omega(k) \\;=\\; \\frac{k^2 d_e^2}{1 + k^2 d_e^2} \\, \\Omega_e,\n$$\nwhere $k$ is the scalar wavenumber.\n\nStarting from the fundamental laws described above, derive the evolution equation for the transverse magnetic field components $\\mathbf{B}_\\perp = (B_y, B_z)$ that is consistent with the hybrid PIC–fluid coupling in the cold-electron, quasi-neutral, immobile-ion limit. Then design an algorithm that, for a single Fourier mode with index $m$ in a periodic domain, numerically integrates this evolution and estimates the angular frequency $\\omega$ from the time series of $B_y(t)$ at a fixed location, using peak detection and parabolic interpolation to estimate the period. Compare the numerically estimated $\\omega$ with the theoretical $\\omega(k)$ and report the relative error.\n\nYour program must:\n- Use the following physical constants: electron charge $e$ in Coulombs, electron mass $m_e$ in kilograms, vacuum permeability $\\mu_0$ in henries per meter, and vacuum permittivity $\\varepsilon_0$ in farads per meter. All internally computed frequencies must be in radians per second.\n- Implement the coupled scheme implied by the equations above by evolving the Fourier amplitudes of $B_y$ and $B_z$ using the linear operator derived from the cold-electron generalized Ohm's law with inertia, Ampère's law (without displacement current), and Faraday's law.\n- Initialize a single circularly polarized whistler mode with wavenumber $k = \\dfrac{2\\pi m}{L}$ using real-valued fields in physical space corresponding to $B_y(x,0) = A \\cos(kx)$ and $B_z(x,0) = A \\sin(kx)$, where $A$ is a small amplitude in tesla.\n- Estimate $\\omega$ numerically from the simulated $B_y(0,t)$ time series by detecting local maxima and applying parabolic interpolation to refine peak times. Compute the period $T$ as the average difference between successive peak times, and take $\\omega_{\\text{num}} = \\dfrac{2\\pi}{T}$.\n- Compute the theoretical $\\omega_{\\text{th}}(k)$ from the given dispersion relation.\n- Output, for each test case, the relative error as a decimal fraction $\\left| \\dfrac{\\omega_{\\text{num}} - \\omega_{\\text{th}}}{\\omega_{\\text{th}}} \\right|$.\n\nUse the following test suite (all quantities in SI units):\n- Domain length $L = 0.05$ meters, number of grid points $N = 256$, electron density $n_0 = 5.0 \\times 10^{19}$ meters$^{-3}$, background magnetic field $B_0 = 0.02$ tesla, perturbation amplitude $A = 1.0 \\times 10^{-6}$ tesla.\n- Fourier mode indices to test: $m \\in \\{1, 11, 53\\}$, which exercise the regimes $k d_e \\ll 1$, $k d_e \\sim 1$, and $k d_e \\gg 1$.\n- Time step selection for each case must ensure sufficient temporal resolution, using a heuristic that targets at least $200$ steps per theoretical period, but you must ensure numerical stability by choosing a fixed or adaptive step that keeps the integration accurate. The program must internally compute and use an appropriate number of steps to cover at least $5$ oscillation periods per case.\n\nYour program should produce a single line of output containing the relative errors for the three test cases as a comma-separated list enclosed in square brackets, for example, \"[err_case1,err_case2,err_case3]\". The values must be floats. No other output is permitted. All intermediate physical quantities (frequencies) must be computed in radians per second, but only the dimensionless relative errors are to be printed.",
            "solution": "We begin from the cold-electron hybrid Particle-In-Cell (PIC)–fluid setting with immobile ions and quasi-neutrality. The governing equations are Faraday's law $\\partial_t \\mathbf{B} = - \\nabla \\times \\mathbf{E}$ and Ampère's law without displacement current $\\mu_0 \\mathbf{J} = \\nabla \\times \\mathbf{B}$. The electron momentum equation is $m_e \\partial_t \\mathbf{v}_e = - e \\left( \\mathbf{E} + \\mathbf{v}_e \\times \\mathbf{B}_0 \\right)$, and the current closure in quasi-neutrality with immobile ions gives $\\mathbf{J} = - e n_0 \\mathbf{v}_e$. Solving the electron momentum equation for $\\mathbf{E}$ in terms of $\\mathbf{J}$, we use $\\mathbf{v}_e = - \\dfrac{\\mathbf{J}}{e n_0}$ to obtain\n$$\nm_e \\partial_t \\left( - \\frac{\\mathbf{J}}{e n_0} \\right) \\;=\\; - e \\left( \\mathbf{E} + \\left( - \\frac{\\mathbf{J}}{e n_0} \\right) \\times \\mathbf{B}_0 \\right),\n$$\nwhich rearranges to\n$$\n\\mathbf{E} \\;=\\; \\frac{m_e}{e^2 n_0} \\, \\partial_t \\mathbf{J} \\;+\\; \\frac{1}{e n_0} \\, \\mathbf{J} \\times \\mathbf{B}_0.\n$$\nUsing Ampère's law without displacement current $\\mathbf{J} = \\dfrac{1}{\\mu_0} \\nabla \\times \\mathbf{B}$, we substitute to obtain\n$$\n\\mathbf{E} \\;=\\; \\frac{m_e}{e^2 n_0 \\mu_0} \\, \\nabla \\times \\partial_t \\mathbf{B} \\;+\\; \\frac{1}{e n_0 \\mu_0} \\, \\left( \\nabla \\times \\mathbf{B} \\right) \\times \\mathbf{B}_0.\n$$\nDefining the electron skin depth $d_e^2 = \\dfrac{m_e}{\\mu_0 n_0 e^2}$ and the factor $\\beta = \\dfrac{1}{e n_0 \\mu_0}$, we write\n$$\n\\mathbf{E} \\;=\\; d_e^2 \\, \\nabla \\times \\partial_t \\mathbf{B} \\;+\\; \\beta \\, \\left( \\nabla \\times \\mathbf{B} \\right) \\times \\mathbf{B}_0.\n$$\nFaraday's law gives the magnetic field evolution:\n$$\n\\partial_t \\mathbf{B} \\;=\\; - \\nabla \\times \\mathbf{E} \\;=\\; - \\nabla \\times \\left( d_e^2 \\nabla \\times \\partial_t \\mathbf{B} \\right) \\;-\\; \\nabla \\times \\left( \\beta \\left( \\nabla \\times \\mathbf{B} \\right) \\times \\mathbf{B}_0 \\right).\n$$\nAssuming spatial dependence only along $x$ and a uniform background $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{x}}$, the transverse components $\\mathbf{B}_\\perp = (B_y, B_z)$ decouple, and using the vector identity $\\nabla \\times \\nabla \\times \\mathbf{W} = \\nabla(\\nabla \\cdot \\mathbf{W}) - \\nabla^2 \\mathbf{W}$, with $\\nabla \\cdot \\mathbf{B}_\\perp = 0$ in this one-dimensional setting, we get $\\nabla \\times \\nabla \\times \\partial_t \\mathbf{B}_\\perp = - \\nabla^2 \\partial_t \\mathbf{B}_\\perp$. Therefore,\n$$\n\\partial_t \\mathbf{B}_\\perp \\;=\\; d_e^2 \\, \\nabla^2 \\partial_t \\mathbf{B}_\\perp \\;-\\; \\nabla \\times \\left( \\beta \\left( \\nabla \\times \\mathbf{B} \\right) \\times \\mathbf{B}_0 \\right).\n$$\nMoving the inertia term to the left-hand side yields\n$$\n\\left( 1 - d_e^2 \\, \\nabla^2 \\right) \\partial_t \\mathbf{B}_\\perp \\;=\\; - \\nabla \\times \\left( \\beta \\left( \\nabla \\times \\mathbf{B} \\right) \\times \\mathbf{B}_0 \\right).\n$$\nIn components, for one-dimensional variation in $x$,\n$$\n\\begin{aligned}\n\\left( 1 - d_e^2 \\, \\partial_x^2 \\right) \\, \\partial_t B_y &= \\beta \\, B_0 \\, \\partial_x^2 B_z, \\\\\n\\left( 1 - d_e^2 \\, \\partial_x^2 \\right) \\, \\partial_t B_z &= - \\beta \\, B_0 \\, \\partial_x^2 B_y.\n\\end{aligned}\n$$\nFor a single Fourier mode $B_\\perp \\propto e^{i(kx - \\omega t)}$, substituting $\\partial_x^2 \\mapsto -k^2$ and $\\partial_t \\mapsto - i \\omega$ gives\n$$\n\\begin{aligned}\n\\left( 1 + d_e^2 k^2 \\right) \\, (- i \\omega) \\, B_y &= - \\beta \\, B_0 \\, k^2 \\, B_z, \\\\\n\\left( 1 + d_e^2 k^2 \\right) \\, (- i \\omega) \\, B_z &= \\beta \\, B_0 \\, k^2 \\, B_y.\n\\end{aligned}\n$$\nThis represents a rotation in the $(B_y, B_z)$ plane at angular frequency\n$$\n\\omega(k) \\;=\\; \\frac{\\beta B_0 k^2}{1 + d_e^2 k^2} \\;=\\; \\frac{k^2 d_e^2}{1 + k^2 d_e^2} \\, \\Omega_e,\n$$\nusing $\\beta B_0 = \\dfrac{B_0}{\\mu_0 e n_0} = \\dfrac{e B_0}{m_e} \\cdot \\dfrac{m_e}{\\mu_0 e^2 n_0} = \\Omega_e d_e^2$.\n\nAlgorithmic design:\n- Spatial discretization: use a periodic grid with $N$ points over $[0, L)$, and represent fields by their discrete Fourier transforms. The discrete wavenumbers are $k_n = \\dfrac{2\\pi n}{L}$, $n \\in \\left\\{ - \\dfrac{N}{2}, \\dots, \\dfrac{N}{2}-1 \\right\\}$.\n- Mode initialization: choose a single mode index $m$ and initialize the real-space fields with $B_y(x,0) = A \\cos(k x)$ and $B_z(x,0) = A \\sin(k x)$. In Fourier space, this corresponds to nonzero components at $k = \\pm \\dfrac{2\\pi m}{L}$ with complex amplitudes that ensure real-valued fields.\n- Time evolution in Fourier space: for each wavenumber $k$, the coupled linear ordinary differential equations are\n$$\n\\frac{d}{dt} \\hat{B}_y(k,t) \\;=\\; - \\frac{\\beta B_0 k^2}{1 + d_e^2 k^2} \\, \\hat{B}_z(k,t), \\qquad\n\\frac{d}{dt} \\hat{B}_z(k,t) \\;=\\; \\frac{\\beta B_0 k^2}{1 + d_e^2 k^2} \\, \\hat{B}_y(k,t).\n$$\nSince the dynamics decouple per wavenumber, we integrate these linear equations using a fourth-order Runge–Kutta method with a time step chosen to provide at least two hundred steps per theoretical period based on $\\omega_{\\text{th}} = \\dfrac{k^2 d_e^2}{1 + k^2 d_e^2} \\, \\Omega_e$.\n- Frequency estimation: record the time series $B_y(0,t)$ by summing the Fourier amplitudes at $x=0$. Identify local maxima by comparing neighboring samples, and refine the peak times using parabolic interpolation. Compute the average period $T$ from differences of successive peak times and return $\\omega_{\\text{num}} = \\dfrac{2\\pi}{T}$.\n- Comparison: compute $\\omega_{\\text{th}}(k)$ from the whistler dispersion relation and the relative error $\\left| \\dfrac{\\omega_{\\text{num}} - \\omega_{\\text{th}}}{\\omega_{\\text{th}}} \\right|$ for each test case. All frequencies are handled in radians per second; the reported relative errors are dimensionless decimal fractions.\n\nTest suite and output:\n- Use $L = 0.05$ meters, $N = 256$, $n_0 = 5.0 \\times 10^{19}$ meters$^{-3}$, $B_0 = 0.02$ tesla, $A = 1.0 \\times 10^{-6}$ tesla, and $m \\in \\{1, 11, 53\\}$.\n- For each $m$, simulate at least five oscillation periods with sufficient time resolution and print a single line containing the three relative errors as a comma-separated list in brackets, for example, \"[0.0001,0.0002,0.0003]\".\n\nThis approach is principle-based: starting from Maxwell's equations and the electron momentum law with inertia, we derive the consistent coupled evolution for $\\mathbf{B}_\\perp$, obtain the dispersion relation, and design a numerical spectral integration scheme that mirrors the hybrid PIC–fluid closure. The frequency estimation via peak detection and parabolic refinement provides a robust numerical comparison against the analytical dispersion relation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants (SI units)\ne = 1.602176634e-19       # Coulomb\nm_e = 9.1093837015e-31    # kg\nmu0 = 4.0e-7 * np.pi      # H/m\neps0 = 1.0 / (mu0 * (299792458.0**2))  # F/m, not used directly but defined\n\ndef rk4_step(Bhat_y, Bhat_z, dt, factor):\n    \"\"\"\n    One Runge–Kutta 4 step for the linear system in Fourier space:\n        dBhat_y/dt = - factor * Bhat_z\n        dBhat_z/dt =   factor * Bhat_y\n    where factor is a real array dependent on k (shape (N,)).\n    \"\"\"\n    k1y = -factor * Bhat_z\n    k1z =  factor * Bhat_y\n\n    By2 = Bhat_y + 0.5 * dt * k1y\n    Bz2 = Bhat_z + 0.5 * dt * k1z\n    k2y = -factor * Bz2\n    k2z =  factor * By2\n\n    By3 = Bhat_y + 0.5 * dt * k2y\n    Bz3 = Bhat_z + 0.5 * dt * k2z\n    k3y = -factor * Bz3\n    k3z =  factor * By3\n\n    By4 = Bhat_y + dt * k3y\n    Bz4 = Bhat_z + dt * k3z\n    k4y = -factor * Bz4\n    k4z =  factor * By4\n\n    Bhat_y_next = Bhat_y + (dt / 6.0) * (k1y + 2.0 * k2y + 2.0 * k3y + k4y)\n    Bhat_z_next = Bhat_z + (dt / 6.0) * (k1z + 2.0 * k2z + 2.0 * k3z + k4z)\n    return Bhat_y_next, Bhat_z_next\n\ndef parabolic_peak_time(y_prev, y_peak, y_next, t_peak, dt):\n    \"\"\"\n    Estimate refined peak time using parabolic interpolation around a detected local maximum.\n    For samples at times t_peak - dt, t_peak, t_peak + dt with values y_prev, y_peak, y_next,\n    the vertex offset delta (in units of dt) is:\n        delta = 0.5 * (y_prev - y_next) / (y_prev - 2*y_peak + y_next)\n    The refined peak time is t_peak + delta*dt.\n    \"\"\"\n    denom = y_prev - 2.0 * y_peak + y_next\n    if abs(denom) < 1e-30:\n        return t_peak\n    delta = 0.5 * (y_prev - y_next) / denom\n    return t_peak + delta * dt\n\ndef estimate_frequency(times, signal):\n    \"\"\"\n    Estimate angular frequency from a time series using peak detection and parabolic interpolation.\n    Returns omega_num = 2*pi / T_avg, where T_avg is the average period between successive peaks.\n    \"\"\"\n    # Detect local maxima\n    peak_times = []\n    for i in range(1, len(signal) - 1):\n        if signal[i-1] < signal[i] and signal[i] > signal[i+1]:\n            t_refined = parabolic_peak_time(signal[i-1], signal[i], signal[i+1], times[i], times[1] - times[0])\n            peak_times.append(t_refined)\n\n    # Need at least two peaks to estimate period\n    if len(peak_times) < 2:\n        return np.nan\n\n    # Compute average period from successive peaks\n    periods = np.diff(peak_times)\n    T_avg = np.mean(periods)\n    omega_num = 2.0 * np.pi / T_avg\n    return omega_num\n\ndef simulate_case(L, N, n0, B0, A, m):\n    \"\"\"\n    Simulate one test case:\n    - Initialize a single circularly polarized Fourier mode with index m.\n    - Integrate using RK4 for several periods.\n    - Estimate frequency via peak detection on B_y(0,t).\n    - Return theoretical and numerical omega and the relative error.\n    \"\"\"\n    # Derived quantities\n    de2 = m_e / (mu0 * n0 * e**2)     # electron skin depth squared\n    de = np.sqrt(de2)\n    Omega_e = e * B0 / m_e            # electron cyclotron frequency\n\n    # Wavenumbers\n    dx = L / N\n    k = 2.0 * np.pi * np.fft.fftfreq(N, d=dx)  # array of k values\n    # Build factor for each k: beta*B0*k^2 / (1 + de^2*k^2), where beta = 1/(e n0 mu0)\n    beta = 1.0 / (e * n0 * mu0)\n    factor = beta * B0 * (k**2) / (1.0 + de2 * (k**2))  # shape (N,)\n\n    # Theoretical frequency for mode m\n    k_m = 2.0 * np.pi * m / L\n    omega_th = (k_m**2 * de2) / (1.0 + k_m**2 * de2) * Omega_e\n\n    # Time step heuristic: ~200 steps per theoretical period; cap dt to maintain accuracy\n    if omega_th <= 0.0:\n        dt = 1e-10\n    else:\n        dt_target = (2.0 * np.pi) / (200.0 * omega_th)\n        dt = min(2e-11, dt_target)\n\n    # Number of steps: at least 5 periods\n    steps = int(max(1024, np.ceil(5.0 * (2.0 * np.pi) / (omega_th * dt)))) if omega_th > 0.0 else 2048\n\n    # Initialize Fourier amplitudes for a real-space field:\n    # B_y(x,0) = A cos(k_m x), B_z(x,0) = A sin(k_m x).\n    # In Fourier: cos -> (A/2 at +m and +A/2 at -m), sin -> (-i A/2 at +m, +i A/2 at -m).\n    Bhat_y = np.zeros(N, dtype=np.complex128)\n    Bhat_z = np.zeros(N, dtype=np.complex128)\n\n    # Positive and negative index for mode m\n    idx_pos = m % N\n    idx_neg = (-m) % N\n\n    Bhat_y[idx_pos] = A / 2.0\n    Bhat_y[idx_neg] = A / 2.0\n    Bhat_z[idx_pos] = -1j * A / 2.0\n    Bhat_z[idx_neg] =  1j * A / 2.0\n\n    # Time integration and recording B_y at x=0 (sum of Fourier amplitudes)\n    times = np.zeros(steps)\n    By_at_0 = np.zeros(steps)\n    t = 0.0\n    for i in range(steps):\n        # Record\n        times[i] = t\n        # B_y at x=0 is sum of Fourier components (since exp(i k x) with x=0 is 1)\n        By_at_0[i] = np.real(np.sum(Bhat_y))\n        # Step\n        Bhat_y, Bhat_z = rk4_step(Bhat_y, Bhat_z, dt, factor)\n        t += dt\n\n    # Estimate numerical frequency\n    omega_num = estimate_frequency(times, By_at_0)\n\n    # Relative error\n    rel_err = np.abs(omega_num - omega_th) / omega_th if (omega_th > 0.0 and np.isfinite(omega_num)) else np.nan\n    return omega_th, omega_num, rel_err\n\ndef solve():\n    # Define the test cases from the problem statement.\n    L = 0.05     # meters\n    N = 256      # grid points\n    n0 = 5.0e19  # m^-3\n    B0 = 0.02    # tesla\n    A = 1.0e-6   # tesla\n\n    test_modes = [1, 11, 53]\n\n    results = []\n    for m in test_modes:\n        omega_th, omega_num, rel_err = simulate_case(L, N, n0, B0, A, m)\n        results.append(rel_err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}