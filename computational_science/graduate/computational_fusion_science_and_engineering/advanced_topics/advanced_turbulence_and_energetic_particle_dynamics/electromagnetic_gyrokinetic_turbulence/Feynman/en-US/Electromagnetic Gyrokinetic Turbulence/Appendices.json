{
    "hands_on_practices": [
        {
            "introduction": "Before writing a single line of code, it is critical to have a deep command of the fundamental equations governing the system. This practice focuses on the Maxwell-Ampère law, a cornerstone of electromagnetic gyrokinetics. By working through the transformation between SI and Gaussian unit systems, you will develop a robust understanding of how physical quantities are scaled and ensure your theoretical framework is self-consistent, a vital skill for interpreting and cross-referencing foundational texts and research papers in plasma physics. ",
            "id": "3971203",
            "problem": "Consider electromagnetic gyrokinetic turbulence in a homogeneous, magnetized plasma with equilibrium magnetic field $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{b}}_0$, where $\\hat{\\mathbf{b}}_0$ is a constant unit vector. Small-amplitude fluctuations are represented by the scalar potential $\\phi(\\mathbf{x},t)$ and the parallel component of the vector potential $A_{\\parallel}(\\mathbf{x},t)$, with the perpendicular magnetic fluctuation given by $\\delta \\mathbf{B}_{\\perp} = \\nabla_{\\perp} A_{\\parallel} \\times \\hat{\\mathbf{b}}_0$ under the gyrokinetic ordering. The electric field is expressed in terms of electromagnetic potentials as follows: in International System of Units (SI), $\\mathbf{E}_{\\mathrm{SI}} = -\\nabla \\phi_{\\mathrm{SI}} - \\partial \\mathbf{A}_{\\mathrm{SI}}/\\partial t$, and in Gaussian centimeter–gram–second units (cgs), $\\mathbf{E}_{\\mathrm{G}} = -\\nabla \\phi_{\\mathrm{G}} - (1/c)\\,\\partial \\mathbf{A}_{\\mathrm{G}}/\\partial t$, where $c$ is the speed of light, $\\mu_0$ is the vacuum permeability, and $\\varepsilon_0$ is the vacuum permittivity. The magnetic field is given by $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ in both unit systems. Maxwell–Ampère's law takes the form $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} + \\mu_0 \\varepsilon_0\\, \\partial \\mathbf{E}/\\partial t$ in SI and $\\nabla \\times \\mathbf{B} = (4\\pi/c)\\, \\mathbf{j} + (1/c)\\, \\partial \\mathbf{E}/\\partial t$ in Gaussian units.\n\nUsing only these fundamental relations and the gyrokinetic ordering assumptions, derive the parallel projection of Maxwell–Ampère's law for the fluctuations and show that it reduces to an equation of the form $-\\nabla_{\\perp}^{2} A_{\\parallel} = \\text{(current term)} + \\text{(displacement term)}$. Impose that the physical electric field is invariant between unit systems, so that $\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$, and assume $\\phi_{\\mathrm{G}} = \\phi_{\\mathrm{SI}}$ for definiteness. By introducing unit-system rescalings $A_{\\parallel,\\mathrm{G}} = \\alpha\\, A_{\\parallel,\\mathrm{SI}}$ and $j_{\\parallel,\\mathrm{G}} = \\gamma\\, j_{\\parallel,\\mathrm{SI}}$, determine the values of the scaling factors $\\alpha$ and $\\gamma$ that make the parallel Maxwell–Ampère equation identical in SI and Gaussian units for the same physical fields. Express your final answer for the ordered pair $(\\alpha,\\gamma)$ purely in terms of $\\mu_0$, $\\varepsilon_0$, and $c$ as a closed-form analytic expression. No numerical approximation is required.",
            "solution": "The user provided a problem statement that requires validation before a solution can be attempted.\n\n### Step 1: Extract Givens\n- **System**: Homogeneous, magnetized plasma.\n- **Equilibrium Field**: $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{b}}_0$, with $\\hat{\\mathbf{b}}_0$ as a constant unit vector.\n- **Fluctuations**: Scalar potential $\\phi(\\mathbf{x},t)$ and parallel vector potential $A_{\\parallel}(\\mathbf{x},t)$.\n- **Perpendicular Magnetic Fluctuation**: $\\delta \\mathbf{B}_{\\perp} = \\nabla_{\\perp} A_{\\parallel} \\times \\hat{\\mathbf{b}}_0$.\n- **Electric Field (SI)**: $\\mathbf{E}_{\\mathrm{SI}} = -\\nabla \\phi_{\\mathrm{SI}} - \\partial \\mathbf{A}_{\\mathrm{SI}}/\\partial t$.\n- **Electric Field (Gaussian cgs)**: $\\mathbf{E}_{\\mathrm{G}} = -\\nabla \\phi_{\\mathrm{G}} - (1/c)\\,\\partial \\mathbf{A}_{\\mathrm{G}}/\\partial t$.\n- **Magnetic Field**: $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ in both systems.\n- **Maxwell–Ampère's Law (SI)**: $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} + \\mu_0 \\varepsilon_0\\, \\partial \\mathbf{E}/\\partial t$.\n- **Maxwell–Ampère's Law (Gaussian cgs)**: $\\nabla \\times \\mathbf{B} = (4\\pi/c)\\, \\mathbf{j} + (1/c)\\, \\partial \\mathbf{E}/\\partial t$.\n- **Constants**: $c$ (speed of light), $\\mu_0$ (vacuum permeability), $\\varepsilon_0$ (vacuum permittivity).\n- **Constraints**:\n    1. Field invariance: $\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$.\n    2. Potential equality: $\\phi_{\\mathrm{G}} = \\phi_{\\mathrm{SI}}$.\n- **Rescaling Definitions**: $A_{\\parallel,\\mathrm{G}} = \\alpha\\, A_{\\parallel,\\mathrm{SI}}$ and $j_{\\parallel,\\mathrm{G}} = \\gamma\\, j_{\\parallel,\\mathrm{SI}}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is firmly rooted in the fundamental principles of classical electromagnetism (Maxwell's equations) and their application in plasma physics, specifically within the well-established framework of gyrokinetics. All provided equations are standard and factually correct representations for SI and Gaussian unit systems.\n- **Well-Posedness**: The problem clearly defines the objective: to find the scaling factors $\\alpha$ and $\\gamma$. It provides a complete set of equations, constraints, and definitions necessary to derive a unique solution.\n- **Objectivity**: The problem is stated in precise, objective, and formal scientific language, free of any subjective or ambiguous terminology.\n- **Consistency and Completeness**: The setup is self-contained. The given relations and constraints are mutually consistent and sufficient for the derivation. No contradictions or missing critical information are present.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and internally consistent. It is therefore deemed **valid**. We may proceed to the solution.\n\n### Derivation\n\nThe goal is to find the scaling factors $(\\alpha, \\gamma)$ that make the parallel component of Maxwell–Ampère's law identical in SI and Gaussian units.\n\nFirst, we derive the general form of the parallel Maxwell–Ampère's law under the given gyrokinetic ordering. The total magnetic field is $\\mathbf{B} = \\mathbf{B}_0 + \\delta \\mathbf{B}$. Since $\\mathbf{B}_0$ is a uniform field, its curl is zero, $\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$. Therefore, the curl of the total magnetic field is just the curl of the fluctuating part, $\\nabla \\times \\mathbf{B} = \\nabla \\times \\delta \\mathbf{B}$. The fluctuating vector potential is assumed to be purely parallel, $\\mathbf{A} \\approx A_{\\parallel} \\hat{\\mathbf{b}}_0$. The fluctuating magnetic field is then given by $\\delta \\mathbf{B} = \\nabla \\times \\mathbf{A} = \\nabla \\times (A_{\\parallel} \\hat{\\mathbf{b}}_0)$.\n\nThe left-hand side of Maxwell–Ampère's law involves $\\nabla \\times \\mathbf{B} = \\nabla \\times (\\nabla \\times (A_{\\parallel} \\hat{\\mathbf{b}}_0))$. We use the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{F}) = \\nabla(\\nabla \\cdot \\mathbf{F}) - \\nabla^2 \\mathbf{F}$.\n$$\n\\nabla \\times \\delta \\mathbf{B} = \\nabla(\\nabla \\cdot (A_{\\parallel} \\hat{\\mathbf{b}}_0)) - \\nabla^2 (A_{\\parallel} \\hat{\\mathbf{b}}_0)\n$$\nSince $\\hat{\\mathbf{b}}_0$ is a constant vector, we have $\\nabla \\cdot (A_{\\parallel} \\hat{\\mathbf{b}}_0) = \\hat{\\mathbf{b}}_0 \\cdot \\nabla A_{\\parallel} = \\partial_{\\parallel} A_{\\parallel}$ and $\\nabla^2 (A_{\\parallel} \\hat{\\mathbf{b}}_0) = (\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0$.\nThus,\n$$\n\\nabla \\times \\delta \\mathbf{B} = \\nabla(\\partial_{\\parallel} A_{\\parallel}) - (\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0\n$$\nProjecting this equation onto the parallel direction $\\hat{\\mathbf{b}}_0$:\n$$\n\\hat{\\mathbf{b}}_0 \\cdot (\\nabla \\times \\delta \\mathbf{B}) = \\hat{\\mathbf{b}}_0 \\cdot \\nabla(\\partial_{\\parallel} A_{\\parallel}) - \\hat{\\mathbf{b}}_0 \\cdot ((\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0) = \\partial_{\\parallel}(\\partial_{\\parallel} A_{\\parallel}) - \\nabla^2 A_{\\parallel} = \\partial_{\\parallel}^2 A_{\\parallel} - \\nabla^2 A_{\\parallel}\n$$\nUsing the decomposition of the Laplacian operator $\\nabla^2 = \\nabla_{\\perp}^2 + \\partial_{\\parallel}^2$, the parallel component of the LHS becomes:\n$$\n\\hat{\\mathbf{b}}_0 \\cdot (\\nabla \\times \\delta \\mathbf{B}) = \\partial_{\\parallel}^2 A_{\\parallel} - (\\nabla_{\\perp}^2 + \\partial_{\\parallel}^2) A_{\\parallel} = -\\nabla_{\\perp}^2 A_{\\parallel}\n$$\nThis establishes the requested form for the left-hand side of the equation.\n\nNow, we write the full parallel Maxwell–Ampère's law in both unit systems.\n\nIn SI units:\nThe parallel projection of the right-hand side is $\\hat{\\mathbf{b}}_0 \\cdot (\\mu_0 \\mathbf{j}_{\\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial \\mathbf{E}_{\\mathrm{SI}}}{\\partial t}) = \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$.\nSo, the equation is:\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}} = \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t} \\quad (\\text{SI})\n$$\n\nIn Gaussian units:\nThe parallel projection of the right-hand side is $\\hat{\\mathbf{b}}_0 \\cdot (\\frac{4\\pi}{c} \\mathbf{j}_{\\mathrm{G}} + \\frac{1}{c} \\frac{\\partial \\mathbf{E}_{\\mathrm{G}}}{\\partial t}) = \\frac{4\\pi}{c} j_{\\parallel, \\mathrm{G}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{G}}}{\\partial t}$.\nSo, the equation is:\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{G}} = \\frac{4\\pi}{c} j_{\\parallel, \\mathrm{G}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{G}}}{\\partial t} \\quad (\\text{Gaussian})\n$$\n\nNext, we determine the scaling factor $\\alpha$. The problem states that the physical electric field is invariant, $\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$, and the scalar potentials are equal, $\\phi_{\\mathrm{SI}} = \\phi_{\\mathrm{G}}$. Using the definitions of $\\mathbf{E}$ and the gyrokinetic approximation $\\mathbf{A} \\approx A_{\\parallel} \\hat{\\mathbf{b}}_0$:\n$$\n-\\nabla \\phi_{\\mathrm{SI}} - \\frac{\\partial A_{\\parallel, \\mathrm{SI}}}{\\partial t} \\hat{\\mathbf{b}}_0 = -\\nabla \\phi_{\\mathrm{G}} - \\frac{1}{c} \\frac{\\partial A_{\\parallel, \\mathrm{G}}}{\\partial t} \\hat{\\mathbf{b}}_0\n$$\nWith $\\phi_{\\mathrm{SI}} = \\phi_{\\mathrm{G}}$, this simplifies to:\n$$\n\\frac{\\partial A_{\\parallel, \\mathrm{SI}}}{\\partial t} \\hat{\\mathbf{b}}_0 = \\frac{1}{c} \\frac{\\partial A_{\\parallel, \\mathrm{G}}}{\\partial t} \\hat{\\mathbf{b}}_0\n$$\nAssuming this relation holds for the fields themselves (not just their time derivatives), we get $A_{\\parallel, \\mathrm{SI}} = \\frac{1}{c} A_{\\parallel, \\mathrm{G}}$. Using the definition $A_{\\parallel, \\mathrm{G}} = \\alpha A_{\\parallel, \\mathrm{SI}}$, we find:\n$$\nA_{\\parallel, \\mathrm{SI}} = \\frac{1}{c} (\\alpha A_{\\parallel, \\mathrm{SI}}) \\implies 1 = \\frac{\\alpha}{c} \\implies \\alpha = c\n$$\n\nFinally, we enforce that the two forms of Maxwell–Ampère's law are identical. This means that if the SI fields satisfy the SI equation, the corresponding Gaussian fields must satisfy the Gaussian equation. This implies that the Gaussian equation, when expressed in terms of SI fields, must be a constant multiple of the SI equation.\nSubstituting $A_{\\parallel, \\mathrm{G}} = \\alpha A_{\\parallel, \\mathrm{SI}}$, $j_{\\parallel, \\mathrm{G}} = \\gamma j_{\\parallel, \\mathrm{SI}}$, and $E_{\\parallel, \\mathrm{G}} = E_{\\parallel, \\mathrm{SI}}$ (from $\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$) into the Gaussian equation:\n$$\n-\\nabla_{\\perp}^2 (\\alpha A_{\\parallel, \\mathrm{SI}}) = \\frac{4\\pi}{c} (\\gamma j_{\\parallel, \\mathrm{SI}}) + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\n$$\n\\alpha (-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}}) = \\frac{4\\pi \\gamma}{c} j_{\\parallel, \\mathrm{SI}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\nNow substitute the SI equation's right-hand side for $-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}}$:\n$$\n\\alpha \\left( \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t} \\right) = \\frac{4\\pi \\gamma}{c} j_{\\parallel, \\mathrm{SI}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\nThis equality must hold for arbitrary field dynamics, meaning the coefficients of the independent terms $j_{\\parallel, \\mathrm{SI}}$ and $\\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$ must be equal on both sides.\n\n1.  Equating coefficients of $j_{\\parallel, \\mathrm{SI}}$:\n$$\n\\alpha \\mu_0 = \\frac{4\\pi \\gamma}{c}\n$$\n2.  Equating coefficients of $\\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$:\n$$\n\\alpha \\mu_0 \\varepsilon_0 = \\frac{1}{c}\n$$\nFrom the second equation, we can re-derive $\\alpha$:\n$$\n\\alpha = \\frac{1}{c \\mu_0 \\varepsilon_0}\n$$\nUsing the fundamental electromagnetic relation $c^2 = 1/(\\mu_0 \\varepsilon_0)$, we find:\n$$\n\\alpha = \\frac{1}{c (1/c^2)} = c\n$$\nThis confirms our earlier result for $\\alpha$.\n\nNow, we use the first equation to solve for $\\gamma$:\n$$\n\\gamma = \\frac{\\alpha \\mu_0 c}{4\\pi}\n$$\nSubstituting $\\alpha = c$:\n$$\n\\gamma = \\frac{c \\cdot \\mu_0 c}{4\\pi} = \\frac{\\mu_0 c^2}{4\\pi}\n$$\nTo obtain a simpler form, we can again use the identity $c^2 = 1/(\\mu_0 \\varepsilon_0)$:\n$$\n\\gamma = \\frac{\\mu_0}{4\\pi} \\left( \\frac{1}{\\mu_0 \\varepsilon_0} \\right) = \\frac{1}{4\\pi \\varepsilon_0}\n$$\nThus, the scaling factors are $\\alpha = c$ and $\\gamma = \\frac{1}{4\\pi \\varepsilon_0}$. The requested ordered pair is $(\\alpha, \\gamma)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} c & \\frac{1}{4 \\pi \\varepsilon_0} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A numerical simulation is only as reliable as its implementation is correct, and the Method of Manufactured Solutions (MMS) is a rigorous technique for code verification. In this practice, you will construct a known analytical solution for the electromagnetic potentials $\\phi$ and $A_{\\parallel}$ and use it to define corresponding source terms for the gyrokinetic field equations. By feeding these manufactured sources into your numerical solver and comparing the output to the known solution, you can precisely quantify the accuracy of your implementation of the quasineutrality and parallel Ampère's law constraints. ",
            "id": "3971207",
            "problem": "Consider a periodic slab domain with coordinates $x$, $y$, and $z$, and uniform background magnetic field $B_0 \\hat{\\boldsymbol{z}}$. Let $\\phi(x,y,z)$ be the electrostatic potential and $A_{\\parallel}(x,y,z)$ be the magnetic vector potential component parallel to $\\hat{\\boldsymbol{z}}$. In low-frequency electromagnetic gyrokinetics, the field equations that close the kinetic system are, in spectral representation for each perpendicular Fourier mode with perpendicular wavevector $\\boldsymbol{k}_{\\perp}$, the gyrokinetic quasineutrality constraint and the parallel component of Ampère’s law. A well-tested formulation for these constraints in a homogeneous plasma with species index $s$ is:\n- Gyrokinetic quasineutrality: the generalized charge density (right-hand side) $\\rho_{\\mathrm{gk}}$ satisfies, for each $\\boldsymbol{k}_{\\perp}$,\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\sum_{s} \\frac{q_s^2 n_s}{T_s} \\Bigl( 1 - \\Gamma_0(b_s) \\Bigr) \\,\\phi(\\boldsymbol{k}),\n$$\nwhere $q_s$ is the species charge, $n_s$ is the uniform background density, $T_s$ is the temperature, $b_s = k_{\\perp}^2 \\rho_{ts}^2$, and $\\Gamma_0(b) = e^{-b} I_0(b)$ with $I_0$ the modified Bessel function of the first kind of order $0$. The thermal Larmor radius is $\\rho_{ts} = v_{ts}/\\Omega_s$ with thermal speed $v_{ts} = \\sqrt{2 T_s / m_s}$ and cyclotron frequency $\\Omega_s = |q_s| B_0 / m_s$.\n- Parallel Ampère’s law in the low-$\\beta$ and low-frequency limit (neglecting displacement current and compressional magnetic perturbations) gives, mode by mode,\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel}(\\boldsymbol{x}) \\;=\\; \\mu_0 \\, j_{\\parallel}(\\boldsymbol{x}),\n$$\nso that in Fourier space\n$$\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\frac{k_{\\perp}^2}{\\mu_0} \\, A_{\\parallel}(\\boldsymbol{k}),\n$$\nwhere $\\mu_0$ is the permeability of free space.\n\nYou are asked to implement the method of manufactured solutions to exercise both constraints simultaneously in a periodic slab using a discrete spectral representation and to verify the numerical correctness of your implementation. You must:\n- Use a manufactured solution for the fields,\n$$\n\\phi^{\\star}(x,y,z) \\;=\\; \\Phi_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr), \\qquad\nA_{\\parallel}^{\\star}(x,y,z) \\;=\\; A_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr),\n$$\nwith $k_x = 2\\pi m_x/L_x$, $k_y = 2\\pi m_y/L_y$, and $k_z = 2\\pi m_z/L_z$, for given positive integers $m_x$, $m_y$, and $m_z$, and positive domain sizes $L_x$, $L_y$, $L_z$.\n- Define the manufactured right-hand sides in spectral space for all Fourier modes by\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\left[ \\sum_s \\frac{q_s^2 n_s}{T_s} \\left(1 - \\Gamma_0\\bigl(k_{\\perp}^2 \\rho_{ts}^2\\bigr)\\right) \\right] \\phi^{\\star}(\\boldsymbol{k}) \\;\\equiv\\; P(\\boldsymbol{k}) \\, \\phi^{\\star}(\\boldsymbol{k}),\n$$\n$$\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\left[\\frac{k_{\\perp}^2}{\\mu_0}\\right] A_{\\parallel}^{\\star}(\\boldsymbol{k}) \\;\\equiv\\; M(\\boldsymbol{k}) \\, A_{\\parallel}^{\\star}(\\boldsymbol{k}),\n$$\nwith $k_{\\perp}^2 = k_x^2 + k_y^2$ for each mode.\n- Numerically reconstruct $\\phi$ and $A_{\\parallel}$ by inverting $P(\\boldsymbol{k})$ and $M(\\boldsymbol{k})$ in spectral space wherever they are nonzero, i.e.,\n$$\n\\phi(\\boldsymbol{k}) = \\begin{cases} \\rho_{\\mathrm{gk}}(\\boldsymbol{k})/P(\\boldsymbol{k}),  P(\\boldsymbol{k}) \\neq 0 \\\\[4pt] 0,  P(\\boldsymbol{k}) = 0 \\end{cases} \\qquad A_{\\parallel}(\\boldsymbol{k}) = \\begin{cases} j_{\\parallel}(\\boldsymbol{k})/M(\\boldsymbol{k}),  M(\\boldsymbol{k}) \\neq 0 \\\\[4pt] 0,  M(\\boldsymbol{k}) = 0 \\end{cases}\n$$\nand then applying the inverse discrete Fourier transform to obtain fields in real space on a uniform grid in the periodic domain. Use a three-dimensional Fast Fourier Transform (FFT) with the standard unitary scaling convention of your chosen library, applied consistently to forward and inverse transforms. Use a uniform grid with $N_x = N_y = N_z = 64$ points.\n- Compute, for each test case, the relative $\\ell^2$ reconstruction errors,\n$$\n\\varepsilon_{\\phi} \\;=\\; \\frac{\\left\\|\\phi - \\phi^{\\star}\\right\\|_2}{\\left\\|\\phi^{\\star}\\right\\|_2}, \\qquad\n\\varepsilon_{A} \\;=\\; \\frac{\\left\\|A_{\\parallel} - A_{\\parallel}^{\\star}\\right\\|_2}{\\left\\|A_{\\parallel}^{\\star}\\right\\|_2}.\n$$\nThese errors are dimensionless and must be reported as decimal numbers.\n\nAll quantities must be handled in the International System of Units (SI). In particular, $n_s$ must be in $\\mathrm{m}^{-3}$, $T_s$ in joules, $B_0$ in tesla, $\\Phi_0$ in volts, and $A_0$ in volt-seconds per meter. Use the elementary charge $e$ in coulombs and the permeability of free space $\\mu_0$ in henries per meter. Convert any supplied electron-volts to joules using $T[\\mathrm{J}] = T[\\mathrm{eV}] \\times e$.\n\nImplement the program to evaluate the following test suite. In all cases, include exactly two species: a deuterium ion with charge $q_i = +e$ and mass $m_i = 2 m_p$, and an electron with charge $q_e = -e$ and mass $m_e$, with $m_p$ the proton mass. Take $e$ and $\\mu_0$ as their standard physical constants. The uniform densities satisfy $n_i = n_e = n_0$.\n\nTest case $1$ (general case):\n- $n_0 = 1.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$, $B_0 = 3.0\\ \\mathrm{T}$, $T_i = 2.5\\ \\mathrm{keV}$, $T_e = 1.5\\ \\mathrm{keV}$,\n- $L_x = 0.6\\ \\mathrm{m}$, $L_y = 0.4\\ \\mathrm{m}$, $L_z = 1.0\\ \\mathrm{m}$,\n- $(m_x, m_y, m_z) = (1, 2, 1)$,\n- $\\Phi_0 = 1.2\\ \\mathrm{V}$, $A_0 = 2.0 \\times 10^{-6}\\ \\mathrm{V\\cdot s/m}$.\n\nTest case $2$ (small $k_{\\perp}$ regime):\n- $n_0 = 5.0 \\times 10^{18}\\ \\mathrm{m}^{-3}$, $B_0 = 6.0\\ \\mathrm{T}$, $T_i = 3.0\\ \\mathrm{keV}$, $T_e = 3.0\\ \\mathrm{keV}$,\n- $L_x = 4.0\\ \\mathrm{m}$, $L_y = 3.0\\ \\mathrm{m}$, $L_z = 2.0\\ \\mathrm{m}$,\n- $(m_x, m_y, m_z) = (1, 1, 2)$,\n- $\\Phi_0 = 0.8\\ \\mathrm{V}$, $A_0 = 1.0 \\times 10^{-6}\\ \\mathrm{V\\cdot s/m}$.\n\nTest case $3$ (large $k_{\\perp}$ regime):\n- $n_0 = 2.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$, $B_0 = 2.5\\ \\mathrm{T}$, $T_i = 1.0\\ \\mathrm{keV}$, $T_e = 0.8\\ \\mathrm{keV}$,\n- $L_x = 0.1\\ \\mathrm{m}$, $L_y = 0.08\\ \\mathrm{m}$, $L_z = 0.5\\ \\mathrm{m}$,\n- $(m_x, m_y, m_z) = (5, 7, 3)$,\n- $\\Phi_0 = 1.0\\ \\mathrm{V}$, $A_0 = 5.0 \\times 10^{-7}\\ \\mathrm{V\\cdot s/m}$.\n\nYour program must:\n- Construct $\\phi^{\\star}$ and $A_{\\parallel}^{\\star}$ on the uniform grid using the specified parameters,\n- Compute the spectral operators $P(\\boldsymbol{k})$ and $M(\\boldsymbol{k})$ for all modes using $\\Gamma_0(b) = e^{-b} I_0(b)$ with $b_s = k_{\\perp}^2 \\rho_{ts}^2$, $\\rho_{ts} = \\sqrt{2 T_s m_s}/(|q_s| B_0)$,\n- Manufacture $\\rho_{\\mathrm{gk}}$ and $j_{\\parallel}$ in spectral space via multiplication by $P(\\boldsymbol{k})$ and $M(\\boldsymbol{k})$, respectively,\n- Reconstruct $\\phi$ and $A_{\\parallel}$ by spectral division where $P(\\boldsymbol{k})$ and $M(\\boldsymbol{k})$ are nonzero (set the corresponding reconstructed spectral coefficients to zero where denominators are zero),\n- Compute $\\varepsilon_{\\phi}$ and $\\varepsilon_{A}$,\n- Output a single line containing the $6$ floating-point results in a comma-separated list enclosed in square brackets, ordered as $[\\varepsilon_{\\phi}^{(1)}, \\varepsilon_{A}^{(1)}, \\varepsilon_{\\phi}^{(2)}, \\varepsilon_{A}^{(2)}, \\varepsilon_{\\phi}^{(3)}, \\varepsilon_{A}^{(3)}]$.\n\nAll outputs are dimensionless relative errors and must be printed as decimal numbers. There are no angle quantities; if any intermediate trigonometric functions are used, interpret their arguments in radians. The final output format must be exactly one line: a single list as specified, with no additional text.",
            "solution": "The method of manufactured solutions constructs a pair of fields and corresponding right-hand sides that satisfy the target equations by design, enabling controlled verification of discretization and implementation. The fundamental laws and definitions we invoke are as follows.\n\nFrom Maxwell’s equations in the magnetostatic, low-frequency limit appropriate for electromagnetic gyrokinetics, the parallel component of Ampère’s law reduces to $-\\nabla_{\\perp}^2 A_{\\parallel} = \\mu_0 j_{\\parallel}$, where $\\nabla_{\\perp}^2$ is the Laplacian in the plane perpendicular to the background magnetic field. In a periodic domain, expanding all fields in Fourier series yields, for each mode, $j_{\\parallel}(\\boldsymbol{k}) = \\left(k_{\\perp}^2/\\mu_0\\right) A_{\\parallel}(\\boldsymbol{k})$. This follows from applying the Fourier transform property $\\mathcal{F}\\{\\nabla_{\\perp}^2 f\\} = -k_{\\perp}^2 \\mathcal{F}\\{f\\}$.\n\nIn the gyrokinetic quasineutrality constraint derived from the Vlasov–Maxwell system after averaging over the gyrophase, the generalized polarization relates $\\phi$ to the charge density moment of the gyrocenter distribution. In a homogeneous plasma with background density $n_s$ and temperature $T_s$ for species $s$, the spectral relation for each perpendicular mode is\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\sum_s \\frac{q_s^2 n_s}{T_s} \\left[1 - \\Gamma_0(b_s)\\right] \\phi(\\boldsymbol{k}),\n$$\nwith finite Larmor radius effects encapsulated in $\\Gamma_0(b) = e^{-b} I_0(b)$ and $b_s = k_{\\perp}^2 \\rho_{ts}^2$. The thermal Larmor radius is $\\rho_{ts} = v_{ts}/\\Omega_s$, where the thermal speed $v_{ts} = \\sqrt{2 T_s/m_s}$ comes from equipartition and $\\Omega_s = |q_s| B_0/m_s$ is the cyclotron frequency. These are standard, well-tested definitions in gyrokinetic theory.\n\nWe adopt a manufactured solution\n$$\n\\phi^{\\star}(x,y,z) \\;=\\; \\Phi_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr), \\qquad\nA_{\\parallel}^{\\star}(x,y,z) \\;=\\; A_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr).\n$$\nBy linearity of the field equations, it suffices to compute the spectral coefficients at the selected Fourier mode and apply the operators. In spectral space, for all modes, we define\n$$\nP(\\boldsymbol{k}) \\;=\\; \\sum_s \\frac{q_s^2 n_s}{T_s} \\left(1 - \\Gamma_0\\bigl(k_{\\perp}^2 \\rho_{ts}^2\\bigr)\\right), \\qquad\nM(\\boldsymbol{k}) \\;=\\; \\frac{k_{\\perp}^2}{\\mu_0}.\n$$\nThen the manufactured sources are\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; P(\\boldsymbol{k}) \\, \\phi^{\\star}(\\boldsymbol{k}), \\qquad\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; M(\\boldsymbol{k}) \\, A_{\\parallel}^{\\star}(\\boldsymbol{k}).\n$$\nTo verify the implementation, we reconstruct the fields by spectral division:\n$$\n\\phi(\\boldsymbol{k}) = \\begin{cases} \\rho_{\\mathrm{gk}}(\\boldsymbol{k})/P(\\boldsymbol{k}),  P(\\boldsymbol{k}) \\neq 0,\\\\ 0,  P(\\boldsymbol{k}) = 0, \\end{cases} \\qquad A_{\\parallel}(\\boldsymbol{k}) = \\begin{cases} j_{\\parallel}(\\boldsymbol{k})/M(\\boldsymbol{k}),  M(\\boldsymbol{k}) \\neq 0,\\\\ 0,  M(\\boldsymbol{k}) = 0, \\end{cases}\n$$\nBecause the manufactured fields have zero mean (each is a product of cosines over full periods), their zero-wavenumber coefficients vanish, so division by zero does not occur for these target modes. Any other modes have zero manufactured amplitude, so setting reconstructed coefficients to zero where the operator vanishes is consistent and avoids numerical issues.\n\nAlgorithmic design:\n- Discretize the domain $[0,L_x)\\times[0,L_y)\\times[0,L_z)$ with $N_x = N_y = N_z = 64$ points. Let the grid spacings be $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$, and $\\Delta z = L_z/N_z$. Construct the grid points $x_j = j \\Delta x$, $y_k = k \\Delta y$, $z_{\\ell} = \\ell \\Delta z$ for integers $j$, $k$, and $\\ell$.\n- Compute the manufactured fields $\\phi^{\\star}$ and $A_{\\parallel}^{\\star}$ at each grid point using the prescribed amplitudes and wavenumbers $k_x = 2\\pi m_x/L_x$, $k_y = 2\\pi m_y/L_y$, $k_z = 2\\pi m_z/L_z$.\n- Compute the spectral wave numbers along each axis consistent with the discrete Fourier transform: $k_x^{(p)} = 2\\pi \\,\\mathrm{fftfreq}(N_x, \\Delta x)$, $k_y^{(q)} = 2\\pi \\,\\mathrm{fftfreq}(N_y, \\Delta y)$, $k_z^{(r)} = 2\\pi \\,\\mathrm{fftfreq}(N_z, \\Delta z)$, and form the three-dimensional arrays $K_x$, $K_y$, $K_z$ by meshing. The perpendicular wavenumber squared is $k_{\\perp}^2 = K_x^2 + K_y^2$.\n- For each species $s$ (deuterium ion and electron), compute $\\rho_{ts} = \\sqrt{2 T_s m_s}/(|q_s| B_0)$ in International System of Units (SI), then $b_s = k_{\\perp}^2 \\rho_{ts}^2$, and $\\Gamma_0(b_s) = e^{-b_s} I_0(b_s)$. Sum $P(\\boldsymbol{k})$ over species according to $P(\\boldsymbol{k}) = \\sum_s (q_s^2 n_s / T_s)\\left(1 - \\Gamma_0(b_s)\\right)$. Compute $M(\\boldsymbol{k}) = k_{\\perp}^2/\\mu_0$.\n- Compute the forward three-dimensional Fast Fourier Transform (FFT) of $\\phi^{\\star}$ and $A_{\\parallel}^{\\star}$ to obtain $\\phi^{\\star}(\\boldsymbol{k})$ and $A_{\\parallel}^{\\star}(\\boldsymbol{k})$, then construct the manufactured sources in spectral space: $\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) = P(\\boldsymbol{k}) \\phi^{\\star}(\\boldsymbol{k})$ and $j_{\\parallel}(\\boldsymbol{k}) = M(\\boldsymbol{k}) A_{\\parallel}^{\\star}(\\boldsymbol{k})$.\n- Reconstruct the spectral fields by dividing by $P(\\boldsymbol{k})$ and $M(\\boldsymbol{k})$ where they are nonzero and setting the coefficients to zero where they vanish. Apply the inverse FFT to obtain $\\phi$ and $A_{\\parallel}$ in real space.\n- Compute the relative $\\ell^2$ errors $\\varepsilon_{\\phi} = \\|\\phi - \\phi^{\\star}\\|_2/\\|\\phi^{\\star}\\|_2$ and $\\varepsilon_{A} = \\|A_{\\parallel} - A_{\\parallel}^{\\star}\\|_2/\\|A_{\\parallel}^{\\star}\\|_2$.\n\nThe test suite specifies three scenarios that probe different regimes:\n- A general case with moderate $k_{\\perp}$ and unequal temperatures,\n- A small $k_{\\perp}$ regime where $b_s \\ll 1$ and $1 - \\Gamma_0(b_s)$ is small, testing sensitivity of the polarization operator,\n- A large $k_{\\perp}$ regime where finite Larmor radius effects are strong, testing the implementation of $\\Gamma_0(b)$ through $I_0(b)$.\n\nBecause the manufactured sources are constructed by direct application of the operators in spectral space and the reconstruction is their exact algebraic inverse applied in the same representation, the expected numerical errors $\\varepsilon_{\\phi}$ and $\\varepsilon_{A}$ are limited to floating-point rounding and the finite-precision of the FFT, typically at or near machine precision (on the order of $10^{-15}$ to $10^{-13}$), provided that the grid resolves the chosen wavenumbers exactly and that the transforms are applied consistently. The final program aggregates the six errors into a single list $[\\varepsilon_{\\phi}^{(1)}, \\varepsilon_{A}^{(1)}, \\varepsilon_{\\phi}^{(2)}, \\varepsilon_{A}^{(2)}, \\varepsilon_{\\phi}^{(3)}, \\varepsilon_{A}^{(3)}]$ and prints it as the only line of output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\nfrom scipy import constants as const\n\ndef manufactured_errors_for_case(Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV):\n    # Grid resolution\n    Nx = Ny = Nz = 64\n    dx, dy, dz = Lx / Nx, Ly / Ny, Lz / Nz\n\n    # Real-space grids\n    x = np.arange(Nx) * dx\n    y = np.arange(Ny) * dy\n    z = np.arange(Nz) * dz\n    X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n    # Wavenumbers for manufactured fields\n    kx = 2.0 * np.pi * mx / Lx\n    ky = 2.0 * np.pi * my / Ly\n    kz = 2.0 * np.pi * mz / Lz\n\n    # Manufactured fields in real space\n    phi_star = Phi0 * np.cos(kx * X) * np.cos(ky * Y) * np.cos(kz * Z)\n    Apar_star = A0 * np.cos(kx * X) * np.cos(ky * Y) * np.cos(kz * Z)\n\n    # Spectral wave numbers consistent with numpy FFT conventions\n    kx_arr = 2.0 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_arr = 2.0 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kz_arr = 2.0 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    KX, KY, KZ = np.meshgrid(kx_arr, ky_arr, kz_arr, indexing='ij')\n    kperp2 = KX**2 + KY**2\n\n    # Species parameters\n    # Charges\n    qi = const.e\n    qe = -const.e\n    # Masses\n    mp = const.proton_mass\n    mi = 2.0 * mp  # deuterium approximation\n    me = const.electron_mass\n    # Densities\n    ni = n0\n    ne = n0\n    # Temperatures (convert keV to J)\n    Ti_J = Ti_keV * 1.0e3 * const.e\n    Te_J = Te_keV * 1.0e3 * const.e\n\n    # Thermal Larmor radii\n    rho_ti = np.sqrt(2.0 * Ti_J * mi) / (abs(qi) * B0)\n    rho_te = np.sqrt(2.0 * Te_J * me) / (abs(qe) * B0)\n\n    # Compute Gamma0 for each species over all k_perp\n    bi = kperp2 * (rho_ti**2)\n    be = kperp2 * (rho_te**2)\n    Gamma0_i = np.exp(-bi) * i0(bi)\n    Gamma0_e = np.exp(-be) * i0(be)\n\n    # Build P(k) = sum_s (q_s^2 n_s / T_s) (1 - Gamma0_s)\n    Pi = (qi**2 * ni / Ti_J) * (1.0 - Gamma0_i)\n    Pe = (qe**2 * ne / Te_J) * (1.0 - Gamma0_e)  # qe**2 = e**2\n    Pk = Pi + Pe\n\n    # Build M(k) = k_perp^2 / mu0\n    Mk = kperp2 / const.mu_0\n\n    # Forward FFTs of manufactured fields\n    phi_k = np.fft.fftn(phi_star)\n    Apar_k = np.fft.fftn(Apar_star)\n\n    # Manufactured sources in spectral space\n    rho_k = Pk * phi_k\n    jpar_k = Mk * Apar_k\n\n    # Reconstruct by spectral division where operator is nonzero\n    tol = 0.0  # exact mask; zero where exactly zero operator\n    phi_k_rec = np.zeros_like(phi_k, dtype=np.complex128)\n    Apar_k_rec = np.zeros_like(Apar_k, dtype=np.complex128)\n\n    mask_P = Pk > tol\n    mask_M = Mk > tol\n\n    phi_k_rec[mask_P] = rho_k[mask_P] / Pk[mask_P]\n    Apar_k_rec[mask_M] = jpar_k[mask_M] / Mk[mask_M]\n\n    # Inverse FFT to real space\n    phi_rec = np.fft.ifftn(phi_k_rec).real\n    Apar_rec = np.fft.ifftn(Apar_k_rec).real\n\n    # Compute relative L2 errors\n    def rel_l2(a, b):\n        num = np.linalg.norm((a - b).ravel())\n        den = np.linalg.norm(b.ravel())\n        # Guard against zero norm (should not happen with cos products and nonzero amplitudes)\n        if den == 0.0:\n            return 0.0\n        return num / den\n\n    err_phi = rel_l2(phi_rec, phi_star)\n    err_A = rel_l2(Apar_rec, Apar_star)\n    return float(err_phi), float(err_A)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV)\n        (0.6, 0.4, 1.0, 1, 2, 1, 1.2, 2.0e-6, 1.0e19, 3.0, 2.5, 1.5),\n        (4.0, 3.0, 2.0, 1, 1, 2, 0.8, 1.0e-6, 5.0e18, 6.0, 3.0, 3.0),\n        (0.1, 0.08, 0.5, 5, 7, 3, 1.0, 5.0e-7, 2.0e19, 2.5, 1.0, 0.8),\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV = case\n        err_phi, err_A = manufactured_errors_for_case(\n            Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV\n        )\n        results.append(err_phi)\n        results.append(err_A)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With a verified model of the field equations, we can proceed to compute physically meaningful quantities, such as the turbulent heat flux that drives energy loss in fusion plasmas. This exercise guides you through the implementation of a quasilinear heat flux calculation, which connects the statistical properties of turbulence to macroscopic transport. You will integrate contributions from both electrostatic ($\\boldsymbol{E}\\times\\boldsymbol{B}$) and electromagnetic (magnetic flutter) transport channels and, most importantly, perform a systematic resolution study to demonstrate that your numerical result is converged and physically reliable. ",
            "id": "3971193",
            "problem": "Consider an Ion Temperature Gradient (ITG) microturbulence scenario in a homogeneous slab with moderate plasma beta defined as the ratio of thermal to magnetic pressure, $\\beta = p_{\\mathrm{th}}/p_{\\mathrm{mag}}$. Using the gyrokinetic framework for ions and retaining electromagnetic perturbations via the parallel component of the vector potential, $A_{\\parallel}$, the turbulent ion heat flux arises from correlated fluctuations of the ion distribution function and the advective fields. The objective of this problem is to derive, implement, and measure the convergence of a dimensionless electromagnetic ion heat flux with respect to parallel wavenumber resolution $k_{\\parallel}$, perpendicular wavenumber resolution $k_{\\perp}$, and velocity-space resolution, under a set of physically consistent, moderate-$\\beta$ ITG assumptions.\n\nStarting point. Your derivation must begin from the following foundational bases and core definitions:\n- The gyrokinetic equation for the non-adiabatic part of the fluctuating ion distribution function $h_i$ in the presence of electrostatic potential $\\phi$ and parallel vector potential $A_{\\parallel}$, with Maxwellian equilibrium $F_M(v)$ for ions.\n- The definition of ion heat flux as the correlation of energy density with the radial component of advection at leading order in electrostatic $\\boldsymbol{E} \\times \\boldsymbol{B}$ drift and its electromagnetic counterpart due to magnetic flutter (parallel vector potential mediated transport).\n- Standard gyroaveraging via the zeroth-order Bessel function of the first kind, $J_0$, applied to the coupling between fields and the distribution function.\n\nAssumptions and modeling choices to be used in the derivation (all scientifically plausible for a moderate-$\\beta$ ITG slab and intended to keep the computational problem tractable while retaining the correct qualitative physics):\n- Electrons are treated as adiabatic in the electrostatic response but provide electromagnetic coupling through $A_{\\parallel}$ in the ion dynamics.\n- The system is normalized to dimensionless gyrokinetic units: lengths are scaled to the ion Larmor radius, $\\rho_i$, velocities to the ion thermal speed, $v_{\\mathrm{th},i}$, time to the ion gyrofrequency, and potentials to $T_i/e$. In these units, the computed heat flux is dimensionless.\n- Turbulent spectra are modeled by anisotropic envelopes consistent with ITG turbulence: the electrostatic potential amplitude $|\\phi_{\\boldsymbol{k}}|$ peaks at finite $k_{\\perp}$ and decays with increasing $|k_{\\parallel}|$; the electromagnetic potential $A_{\\parallel,\\boldsymbol{k}}$ scales with $\\beta$ and anisotropy through a ratio proportional to $k_{\\parallel}/k_{\\perp}$.\n- Linear/quasilinear dynamics provide the cross-phase between $\\phi_{\\boldsymbol{k}}$ and $h_{i,\\boldsymbol{k}}$, and between $A_{\\parallel,\\boldsymbol{k}}$ and the corresponding electromagnetic heat flux channel, through the mode growth rate $\\gamma_{\\boldsymbol{k}}$ and real frequency $\\omega_{\\boldsymbol{k}}$.\n\nYou must derive, from these bases and assumptions, a quasilinear expression for the dimensionless ion heat flux $Q_i$ as a spectral sum over wavevectors $(k_{\\perp},k_{\\parallel})$ and a numerical integral over velocity-space coordinates. The velocity-space integration must be performed over energy coordinate $\\varepsilon$ and pitch-angle coordinate $\\lambda$, where $v^2 = 2 \\varepsilon$, $v_{\\perp}^2 = 2 \\varepsilon \\lambda$, and $v_{\\parallel}^2 = 2 \\varepsilon (1-\\lambda)$, with $0 \\le \\lambda \\le 1$ and $0 \\le \\varepsilon  \\infty$. The integrands must include the Maxwellian weight, $e^{-\\varepsilon}$, appropriate energy weighting for heat transport, and the gyroaverage factor $J_0\\!\\left(k_{\\perp} \\sqrt{2 \\varepsilon \\lambda}\\right)$.\n\nImplementation requirements. Based on your derivation, implement a program that computes the total dimensionless ion heat flux $Q_i$ by summing electrostatic and electromagnetic contributions, each expressed as a double sum over $(k_{\\perp},k_{\\parallel})$ and a double integral over $(\\varepsilon,\\lambda)$. The program must:\n- Construct uniform grids for $k_{\\perp}$ on $[k_{\\perp,\\min},k_{\\perp,\\max}]$ and for $k_{\\parallel}$ on $[-k_{\\parallel,\\max},k_{\\parallel,\\max}]$ with specified numbers of points $N_{k_{\\perp}}$ and $N_{k_{\\parallel}}$.\n- Evaluate velocity-space integrals using Gauss-Laguerre quadrature for $\\varepsilon \\in [0,\\infty)$ with weight $e^{-\\varepsilon}$ and Gauss-Legendre quadrature for $\\lambda \\in [0,1]$ (mapped from $[-1,1]$).\n- Use the following physically motivated spectral and response models to parameterize $|\\phi_{\\boldsymbol{k}}|$, $|A_{\\parallel,\\boldsymbol{k}}|$, $\\omega_{\\boldsymbol{k}}$, and $\\gamma_{\\boldsymbol{k}}$:\n  - Electrostatic potential envelope:\n    $$|\\phi_{\\boldsymbol{k}}|^2 = \\phi_0^2 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\left(\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right)^{c}\\right],$$\n    with constants $\\phi_0$, $k_0$, $a$, $b$, $c$, and $k_{\\parallel,0}$ provided below.\n  - Electromagnetic potential via a proportionality motivated by parallel Ohm's law and anisotropy:\n    $$A_{\\parallel,\\boldsymbol{k}} = \\alpha(\\beta)\\,\\frac{k_{\\parallel}}{k_{\\perp} + \\delta}\\,\\phi_{\\boldsymbol{k}}, \\quad \\alpha(\\beta) = \\frac{\\beta}{2+\\beta},$$\n    where $\\delta$ is a small positive constant to prevent division by zero.\n  - Real frequency and growth rate consistent with ITG-type scaling:\n    $$\\omega_{\\boldsymbol{k}} = \\omega_{*0} \\frac{k_y}{1+(k_{\\perp}/k_0)^2}, \\qquad \\gamma_{\\boldsymbol{k}} = \\gamma_0 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right],$$\n    and you may take $k_y \\approx k_{\\perp}$ in this slab model.\n  - Quasilinear cross-phase factor:\n    $$\\mathcal{C}_{\\boldsymbol{k}} = \\frac{\\gamma_{\\boldsymbol{k}}}{\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2}.$$\n- Electrostatic contribution must weight the integrand with energy $\\varepsilon$ and the gyroaverage $J_0^2$, and the spectral factor must include $k_y^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$.\n- Electromagnetic contribution must weight the integrand with parallel energy $\\varepsilon(1-\\lambda)$ and include an appropriate spectral factor such as $k_{\\perp}^2 |A_{\\parallel,\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$.\n- Sum both contributions over all $(k_{\\perp},k_{\\parallel})$ and multiply by the grid-cell measures to approximate the integrals.\n\nResolution study and test suite. Perform a resolution study to demonstrate convergence of $Q_i$ with respect to $k_{\\parallel}$, $k_{\\perp}$, and velocity-space grids. Use the following fixed parameters unless otherwise stated:\n- Spectral parameters: $\\phi_0 = 1$, $k_0 = 0.3$, $a = 1$, $b = 2$ (or $b=6$ where specified), $c = 1$, $k_{\\parallel,0} = 0.3$, $\\omega_{*0} = 1$, $\\gamma_0 = 0.2$, $\\delta = 10^{-12}$.\n- Wavenumber ranges: $k_{\\perp,\\min} = 0.05$, $k_{\\perp,\\max} = 2.0$, $k_{\\parallel,\\max} = 1.0$.\n\nDefine four test cases:\n- Case A (happy path, $k_{\\parallel}$-convergence at moderate $\\beta$): $\\beta = 0.03$, $N_{k_{\\perp}} = 96$, $N_{\\varepsilon} = 80$, $N_{\\lambda} = 80$, coarse $N_{k_{\\parallel}} = 24$, fine $N_{k_{\\parallel}} = 96$.\n- Case B (happy path, $k_{\\perp}$-convergence at moderate $\\beta$): $\\beta = 0.05$, $N_{k_{\\parallel}} = 96$, $N_{\\varepsilon} = 80$, $N_{\\lambda} = 80$, coarse $N_{k_{\\perp}} = 24$, fine $N_{k_{\\perp}} = 96$.\n- Case C (velocity-space convergence at higher moderate $\\beta$): $\\beta = 0.08$, $N_{k_{\\perp}} = 96$, $N_{k_{\\parallel}} = 96$, coarse $N_{\\varepsilon} = 24$, $N_{\\lambda} = 24$, fine $N_{\\varepsilon} = 96$, $N_{\\lambda} = 96$.\n- Case D (edge case, nearly electrostatic and steeper spectrum): $\\beta = 0.005$, $N_{k_{\\perp}} = 96$, $N_{k_{\\parallel}} = 96$, $N_{\\varepsilon} = 80$, $N_{\\lambda} = 80$, use $b = 6$ for the perpendicular spectrum steepness; compare coarse $N_{k_{\\perp}}=24$ to fine $N_{k_{\\perp}}=96$.\n\nFor each case, compute $Q_i$ at the coarse resolution and at the fine resolution (keeping all other resolutions fixed to the values stated), and report the relative change as a decimal,\n$$\\Delta = \\frac{|Q_i^{\\mathrm{fine}} - Q_i^{\\mathrm{coarse}}|}{|Q_i^{\\mathrm{fine}}|},$$\nwith no percentage sign. Also evaluate whether convergence is achieved using the criterion $\\Delta  0.02$.\n\nFinal output specification. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order:\n- The four relative changes for Cases A, B, C, D, followed by\n- The four boolean indicators of convergence (True or False) for Cases A, B, C, D using the threshold $0.02$.\n\nFor example, the output must be of the form\n$$[\\Delta_A,\\Delta_B,\\Delta_C,\\Delta_D,\\mathrm{conv}_A,\\mathrm{conv}_B,\\mathrm{conv}_C,\\mathrm{conv}_D].$$\nAll outputs are dimensionless numbers or booleans; no physical units are required. Angles are not used; the pitch-angle variable $\\lambda$ is dimensionless on $[0,1]$.\n\nNote. No shortcut formulas for the heat flux should be inserted into the problem statement. You must derive the working quasilinear expressions for both the electrostatic and electromagnetic contributions from the foundational bases and assumptions above, and then implement them numerically with the specified test suite.",
            "solution": "The user has provided a valid, well-posed problem in computational plasma physics. This response will first provide a detailed derivation of the expressions for the ion heat flux and then present the numerical implementation.\n\n### Problem Validation\n\nThe problem statement has been validated and is deemed **valid**.\n- **Givens**: All required physical parameters, functional forms for spectra, numerical methods, and test case definitions are explicitly provided.\n- **Scientific Grounding**: The problem is based on the standard and well-established gyrokinetic (GK) framework for modeling plasma microturbulence. The concepts of quasilinear heat flux, $\\boldsymbol{E}\\times\\boldsymbol{B}$ and magnetic flutter transport, and ITG turbulence are all fundamental to fusion plasma physics.\n- **Well-Posedness and Objectivity**: The problem is unambiguous, objective, and its structure leads to a unique numerical solution for each test case.\n\n### Derivation of Quasilinear Ion Heat Flux\n\nThe objective is to derive an expression for the total ion heat flux $Q_i$, which is the sum of its electrostatic ($Q_{i,ES}$) and electromagnetic ($Q_{i,EM}$) components.\n\n**1. Foundational Definitions**\n\nThe radial ion heat flux $Q_i$ is the radial component of the heat flux vector $\\boldsymbol{q}_i$, defined as the third moment of the ion distribution function. In a turbulent plasma, this is computed as the statistical correlation between the fluctuating energy density and the fluctuating radial velocity:\n$$ Q_i = \\left\\langle \\int d^3v \\left(\\frac{1}{2}m_i v^2\\right) \\delta v_r \\delta f_i \\right\\rangle $$\nwhere $\\delta f_i$ is the fluctuating part of the ion distribution function, $\\delta v_r$ is the fluctuating radial component of the single particle velocity, and $\\langle\\dots\\rangle$ denotes a flux-surface average, which in a homogeneous slab model becomes a spatial average. In Fourier space, for two fluctuating quantities $A$ and $B$, this average is $\\langle AB \\rangle = \\sum_{\\boldsymbol{k}} \\Re\\{ A_{\\boldsymbol{k}} B_{\\boldsymbol{k}}^* \\}$.\n\nThe problem is posed in dimensionless gyrokinetic units where lengths are normalized to the ion Larmor radius $\\rho_i$, velocities to the ion thermal speed $v_{\\mathrm{th},i}$, potentials to $T_i/e$, and energy $\\varepsilon = v^2/2$. The radial drift velocity $\\delta v_r$ has two main components:\n1.  **$\\boldsymbol{E}\\times\\boldsymbol{B}$ drift**: $\\delta v_{E,r} = -i k_y \\phi$, where $\\phi$ is the electrostatic potential and we align the binormal direction with $y$.\n2.  **Magnetic flutter drift**: $\\delta v_{B,r} = v_{\\parallel} \\delta b_r = v_{\\parallel} (i k_y A_{\\parallel})$, where $A_{\\parallel}$ is the parallel component of the vector potential and $v_{\\parallel}$ is the parallel velocity.\n\nThe total radial velocity fluctuation is $\\delta v_{r,\\boldsymbol{k}} = -i k_y \\phi_{\\boldsymbol{k}} + i k_y v_{\\parallel} A_{\\parallel,\\boldsymbol{k}}$.\n\nThe fluctuating distribution function $\\delta f_i$ is given in the gyrokinetic framework by its non-adiabatic part $h_i$, as the adiabatic part does not contribute to net transport. Thus, $\\delta f_i \\to h_i$.\n\n**2. Quasilinear Approximation**\n\nIn the quasilinear approximation, the net flux is the sum of contributions from each mode $\\boldsymbol{k}$. The phase relationship between the fluctuating fields and the distribution function response, which determines the net transport, is prescribed by the linear mode characteristics. The problem provides a simplified cross-phase factor $\\mathcal{C}_{\\boldsymbol{k}} = \\frac{\\gamma_{\\boldsymbol{k}}}{\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2}$, where $\\gamma_{\\boldsymbol{k}}$ is the mode growth rate and $\\omega_{\\boldsymbol{k}}$ is the real frequency. This factor encapsulates the dissipative part of the plasma response that leads to transport.\n\nThe heat flux for a single mode $\\boldsymbol{k}$ is given by:\n$$ Q_{i,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, \\delta v_{r,\\boldsymbol{k}}^* \\, h_{i,\\boldsymbol{k}} \\right\\} $$\nWe can now separate this into electrostatic and electromagnetic contributions.\n\n**3. Electrostatic Heat Flux ($Q_{i,ES}$)**\n\nThe electrostatic component arises from the $\\boldsymbol{E}\\times\\boldsymbol{B}$ drift.\n$$ Q_{i,ES,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, (-i k_y \\phi_{\\boldsymbol{k}})^* \\, h_{i,\\boldsymbol{k}}^{ES} \\right\\} $$\nwhere $h_{i,\\boldsymbol{k}}^{ES}$ is the part of the distribution function response driven by the electrostatic potential. In gyrokinetics, particles respond to the gyro-averaged potential, $J_0(k_{\\perp} v_{\\perp}) \\phi_{\\boldsymbol{k}}$, where $J_0$ is the zeroth-order Bessel function. The resultant distribution function perturbation is $h_{i,\\boldsymbol{k}}^{ES} \\propto J_0(k_{\\perp} v_{\\perp}) \\phi_{\\boldsymbol{k}}$. The quasilinear flux expression for this interaction involves the square of the driving field and the response function. Following the problem statement's guidance, the spectral factor is $k_y^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$. Using the slab approximation $k_y \\approx k_{\\perp}$, this becomes $k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$.\n\nThe integrand is weighted by energy $\\varepsilon$ and the gyroaverage factor squared, $J_0^2$. The full expression for the electrostatic heat flux, summed over all modes, is:\n$$ Q_{i,ES} = \\sum_{\\boldsymbol{k}} k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} \\left\\langle \\varepsilon J_0^2(k_{\\perp} v_{\\perp}) \\right\\rangle_v $$\nThe notation $\\langle \\dots \\rangle_v$ represents the velocity space integral. The problem specifies quadratures that imply the integral is defined as:\n$$ \\langle F(\\varepsilon, \\lambda) \\rangle_v \\equiv \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} F(\\varepsilon, \\lambda) $$\nwhere $\\varepsilon = v^2/2$, $\\lambda = v_{\\perp}^2/v^2$, so $v_{\\perp} = \\sqrt{2\\varepsilon\\lambda}$.\nThus, the velocity-space integral for the ES flux is:\n$$ V_{ES}(k_\\perp) = \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} \\, \\varepsilon \\, J_0^2(k_{\\perp} \\sqrt{2\\varepsilon\\lambda}) $$\nThe total ES flux is then:\n$$ Q_{i,ES} = \\int d\\boldsymbol{k} \\, k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} V_{ES}(k_\\perp) $$\n\n**4. Electromagnetic Heat Flux ($Q_{i,EM}$)**\n\nThe electromagnetic component arises from the magnetic flutter transport channel.\n$$ Q_{i,EM,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, (i k_y v_{\\parallel} A_{\\parallel,\\boldsymbol{k}})^* \\, h_{i,\\boldsymbol{k}}^{EM} \\right\\} $$\nHere, $h_{i,\\boldsymbol{k}}^{EM}$ is the distribution function response to the electromagnetic part of the gyrokinetic potential, which is proportional to $v_\\parallel J_0(k_\\perp v_\\perp) A_{\\parallel, \\boldsymbol{k}}$. The resulting quasilinear flux involves the square of this drive, and thus contains factors of $v_\\parallel^2$ and $J_0^2$.\n\nThe problem states that the EM integrand is weighted by \"parallel energy\" $\\varepsilon(1-\\lambda)$, which in our normalized units is $v_\\parallel^2/2$. This is consistent with the $v_\\parallel$ factors in both the drift and the GK drive. The spectral factor is given as $k_{\\perp}^2 |A_{\\parallel, \\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$, again using $k_y \\approx k_{\\perp}$. The velocity-space integral is:\n$$ V_{EM}(k_\\perp) = \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} \\, \\varepsilon(1-\\lambda) \\, J_0^2(k_{\\perp} \\sqrt{2\\varepsilon\\lambda}) $$\nThe total EM flux is:\n$$ Q_{i,EM} = \\int d\\boldsymbol{k} \\, k_{\\perp}^2 |A_{\\parallel,\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} V_{EM}(k_\\perp) $$\n\n**5. Final Expression for Implementation**\n\nThe total ion heat flux $Q_i = Q_{i,ES} + Q_{i,EM}$ is calculated by discretizing the integrals over $\\boldsymbol{k}$-space into sums over a grid:\n$$ Q_i \\approx \\sum_{i,j} \\left( k_{\\perp,i}^2 |\\phi_{\\boldsymbol{k}_{ij}}|^2 \\mathcal{C}_{\\boldsymbol{k}_{ij}} V_{ES}(k_{\\perp,i}) + k_{\\perp,i}^2 |A_{\\parallel,\\boldsymbol{k}_{ij}}|^2 \\mathcal{C}_{\\boldsymbol{k}_{ij}} V_{EM}(k_{\\perp,i}) \\right) \\Delta k_{\\perp} \\Delta k_{\\parallel} $$\nThe spectral functions $|\\phi_{\\boldsymbol{k}}|^2$, $|A_{\\parallel, \\boldsymbol{k}}|^2$, and $\\mathcal{C}_{\\boldsymbol{k}}$ are evaluated on the grid using the provided models:\n- $|\\phi_{\\boldsymbol{k}}|^2 = \\phi_0^2 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\left(\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right)^{c}\\right]$\n- $|A_{\\parallel,\\boldsymbol{k}}|^2 = \\left(\\frac{\\beta}{2+\\beta}\\right)^2 \\left(\\frac{k_{\\parallel}}{k_{\\perp} + \\delta}\\right)^2 |\\phi_{\\boldsymbol{k}}|^2$\n- $\\mathcal{C}_{\\boldsymbol{k}} = \\gamma_{\\boldsymbol{k}} / (\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2)$, with $\\omega_{\\boldsymbol{k}} = \\omega_{*0} \\frac{k_{\\perp}}{1+(k_{\\perp}/k_0)^2}$ and $\\gamma_{\\boldsymbol{k}} = \\gamma_0 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right]$.\n\nThe velocity integrals $V_{ES}$ and $V_{EM}$ are computed numerically using Gauss-Laguerre quadrature for the $\\varepsilon$ integral (with weight $e^{-\\varepsilon}$) and Gauss-Legendre quadrature for the $\\lambda$ integral on $[0,1]$. This derived structure forms the basis for the following program.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef calculate_Qi(beta, b, N_k_perp, N_k_para, N_eps, N_lambda,\n                 phi0, k0, a, c, k_para_0, omega_star_0, gamma0, delta,\n                 k_perp_min, k_perp_max, k_para_max):\n    \"\"\"\n    Computes the total dimensionless ion heat flux Q_i based on the provided\n    gyrokinetic model.\n    \"\"\"\n    # 1. Setup Grids and Quadrature Points/Weights\n    # Velocity space grids\n    eps_p, w_eps = special.roots_laguerre(N_eps)\n    x_leg, w_leg = special.roots_legendre(N_lambda)\n    lambda_q = (x_leg + 1.0) / 2.0\n    w_lambda = w_leg / 2.0\n\n    # Wavenumber space grids\n    k_perp_grid = np.linspace(k_perp_min, k_perp_max, N_k_perp)\n    dk_perp = (k_perp_max - k_perp_min) / (N_k_perp - 1) if N_k_perp > 1 else 0.0\n\n    k_para_grid = np.linspace(-k_para_max, k_para_max, N_k_para)\n    dk_para = (2.0 * k_para_max) / (N_k_para - 1) if N_k_para > 1 else 0.0\n\n    # 2. Pre-calculate Velocity-Space Integrals V_ES and V_EM\n    # These integrals, V_ES(k_perp) and V_EM(k_perp), depend only on k_perp.\n    V_ES = np.zeros(N_k_perp)\n    V_EM = np.zeros(N_k_perp)\n    \n    # Create 2D grids for vectorized quadrature\n    eps_grid, lambda_grid = np.meshgrid(eps_p, lambda_q, indexing='ij')\n    w_grid = np.outer(w_eps, w_lambda)\n\n    for i, k_perp in enumerate(k_perp_grid):\n        arg_J0 = k_perp * np.sqrt(2.0 * eps_grid * lambda_grid)\n        J0_sq = special.j0(arg_J0)**2\n        \n        integrand_ES_v = eps_grid * J0_sq\n        integrand_EM_v = eps_grid * (1.0 - lambda_grid) * J0_sq\n        \n        V_ES[i] = np.sum(w_grid * integrand_ES_v)\n        V_EM[i] = np.sum(w_grid * integrand_EM_v)\n\n    # 3. Sum contributions over the k-space grid\n    total_Qi = 0.0\n    alpha_beta = beta / (2.0 + beta)\n\n    # Vectorize k_para grid calculations for efficiency\n    k_para_abs = np.abs(k_para_grid)\n    k_para_norm = k_para_abs / k_para_0\n    k_para_factor_on_grid = np.exp(-(k_para_norm**c))\n\n    # Loop over the k_perp grid\n    for i, k_perp in enumerate(k_perp_grid):\n        k_perp_norm = k_perp / k0\n        \n        # This factor is part of both phi^2 and gamma\n        k_perp_factor = (k_perp_norm**a) * np.exp(-(k_perp_norm**b))\n        \n        # Calculate spectral quantities over the k_para grid for the current k_perp\n        phi_k_sq_perp_part = phi0**2 * k_perp_factor\n        gamma_k_perp_part = gamma0 * k_perp_factor\n        \n        phi_k_sq = phi_k_sq_perp_part * k_para_factor_on_grid\n        gamma_k = gamma_k_perp_part * k_para_factor_on_grid\n        \n        omega_k_val = omega_star_0 * k_perp / (1.0 + (k_perp / k0)**2)\n        \n        # Calculate the cross-phase factor C_k\n        C_k = gamma_k / (omega_k_val**2 + gamma_k**2)\n        \n        # Electrostatic flux contribution at this k_perp, summed over k_para\n        Qi_ES_sum_over_kpara = np.sum(phi_k_sq * C_k)\n        \n        # Electromagnetic flux contribution at this k_perp, summed over k_para\n        A_para_factor_sq = (alpha_beta * k_para_grid / (k_perp + delta))**2\n        A_para_k_sq = A_para_factor_sq * phi_k_sq\n        Qi_EM_sum_over_kpara = np.sum(A_para_k_sq * C_k)\n\n        # Sum ES and EM contributions for current k_perp, weighting by velocity integrals\n        Qi_at_k_perp = k_perp**2 * (Qi_ES_sum_over_kpara * V_ES[i] + \\\n                                   Qi_EM_sum_over_kpara * V_EM[i])\n        \n        total_Qi += Qi_at_k_perp\n\n    # Final multiplication by grid cell measures\n    total_Qi *= dk_perp * dk_para\n    \n    return total_Qi\n\ndef solve():\n    \"\"\"\n    Main function to run the resolution study for the four test cases.\n    \"\"\"\n    # Define fixed physical and spectral parameters\n    fixed_params = {\n        'phi0': 1.0, 'k0': 0.3, 'a': 1.0, 'c': 1.0,\n        'k_para_0': 0.3, 'omega_star_0': 1.0, 'gamma0': 0.2,\n        'delta': 1e-12, 'k_perp_min': 0.05, 'k_perp_max': 2.0,\n        'k_para_max': 1.0\n    }\n\n    # Define the four test cases as specified in the problem\n    test_cases = [\n        # Case A: k_parallel convergence at moderate beta\n        {'case_params': {'beta': 0.03, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 96, 'N_k_para': 24, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n        # Case B: k_perpendicular convergence at moderate beta\n        {'case_params': {'beta': 0.05, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 24, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n        # Case C: velocity-space convergence at higher moderate beta\n        {'case_params': {'beta': 0.08, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 24, 'N_lambda': 24},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 96, 'N_lambda': 96}},\n        # Case D: edge case, nearly ES, steeper k_perp spectrum\n        {'case_params': {'beta': 0.005, 'b': 6.0},\n         'coarse_res': {'N_k_perp': 24, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n    ]\n\n    results_delta = []\n    results_conv = []\n    convergence_threshold = 0.02\n    \n    for case in test_cases:\n        params_coarse = {**fixed_params, **case['case_params'], **case['coarse_res']}\n        params_fine = {**fixed_params, **case['case_params'], **case['fine_res']}\n        \n        Q_coarse = calculate_Qi(**params_coarse)\n        Q_fine = calculate_Qi(**params_fine)\n        \n        # Calculate relative change, handle Q_fine == 0 case\n        if Q_fine == 0:\n            delta = 0.0 if Q_coarse == 0 else 1.0\n        else:\n            delta = np.abs(Q_fine - Q_coarse) / np.abs(Q_fine)\n            \n        converged = delta  convergence_threshold\n        \n        results_delta.append(delta)\n        results_conv.append(converged)\n\n    final_results = results_delta + results_conv\n    \n    # Format the print output exactly as required\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}