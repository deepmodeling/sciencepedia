{
    "hands_on_practices": [
        {
            "introduction": "在等离子体物理的文献中，国际单位制（SI）和高斯单位制（cgs）都常被使用，因此理解这两种单位制之间的转换关系至关重要。这项练习 () 将通过推导在回旋动理学近似下麦克斯韦方程组的等价形式，帮助您掌握不同单位制下物理量和方程的规范化方法。这为后续的理论和数值工作奠定了坚实基础。",
            "id": "3971203",
            "problem": "考虑一个均匀磁化等离子体中的电磁回旋动理学湍流，其平衡磁场为$\\mathbf{B}_0 = B_0 \\hat{\\mathbf{b}}_0$，其中$\\hat{\\mathbf{b}}_0$是一个常单位向量。小振幅涨落由标量势$\\phi(\\mathbf{x},t)$和矢量势的平行分量$A_{\\parallel}(\\mathbf{x},t)$表示，根据回旋动理学级数，垂直磁涨落由$\\delta \\mathbf{B}_{\\perp} = \\nabla_{\\perp} A_{\\parallel} \\times \\hat{\\mathbf{b}}_0$给出。电场用电磁势表示如下：在国际单位制（SI）中，$\\mathbf{E}_{\\mathrm{SI}} = -\\nabla \\phi_{\\mathrm{SI}} - \\partial \\mathbf{A}_{\\mathrm{SI}}/\\partial t$；在高斯厘米-克-秒单位制（cgs）中，$\\mathbf{E}_{\\mathrm{G}} = -\\nabla \\phi_{\\mathrm{G}} - (1/c)\\,\\partial \\mathbf{A}_{\\mathrm{G}}/\\partial t$，其中$c$是光速，$\\mu_0$是真空磁导率，$\\varepsilon_0$是真空介电常数。在两种单位制中，磁场均由$\\mathbf{B} = \\nabla \\times \\mathbf{A}$给出。麦克斯韦-安培定律在SI单位制中的形式为$\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} + \\mu_0 \\varepsilon_0\\, \\partial \\mathbf{E}/\\partial t$，在高斯单位制中的形式为$\\nabla \\times \\mathbf{B} = (4\\pi/c)\\, \\mathbf{j} + (1/c)\\, \\partial \\mathbf{E}/\\partial t$。\n\n仅使用这些基本关系和回旋动理学级数假设，推导涨落的麦克斯韦-安培定律的平行投影，并证明其可简化为$-\\nabla_{\\perp}^{2} A_{\\parallel} = \\text{(电流项)} + \\text{(位移项)}$的形式。施加物理电场在不同单位制间不变的条件，即$\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$，并为确定起见，假设$\\phi_{\\mathrm{G}} = \\phi_{\\mathrm{SI}}$。通过引入单位制换算$A_{\\parallel,\\mathrm{G}} = \\alpha\\, A_{\\parallel,\\mathrm{SI}}$和$j_{\\parallel,\\mathrm{G}} = \\gamma\\, j_{\\parallel,\\mathrm{SI}}$，确定标度因子$\\alpha$和$\\gamma$的值，使得对于相同的物理场，平行的麦克斯韦-安培方程在SI单位制和高斯单位制中完全相同。将有序对$(\\alpha,\\gamma)$的最终答案纯粹用$\\mu_0$、$\\varepsilon_0$和$c$表示为一个闭式解析表达式。不需要数值近似。",
            "solution": "用户提供了一个问题陈述，在尝试解答之前需要进行验证。\n\n### 步骤 1：提取已知条件\n- **系统**：均匀磁化等离子体。\n- **平衡场**：$\\mathbf{B}_0 = B_0 \\hat{\\mathbf{b}}_0$，其中 $\\hat{\\mathbf{b}}_0$ 是一个常单位向量。\n- **涨落**：标量势 $\\phi(\\mathbf{x},t)$ 和平行矢量势 $A_{\\parallel}(\\mathbf{x},t)$。\n- **垂直磁涨落**：$\\delta \\mathbf{B}_{\\perp} = \\nabla_{\\perp} A_{\\parallel} \\times \\hat{\\mathbf{b}}_0$。\n- **电场 (SI)**：$\\mathbf{E}_{\\mathrm{SI}} = -\\nabla \\phi_{\\mathrm{SI}} - \\partial \\mathbf{A}_{\\mathrm{SI}}/\\partial t$。\n- **电场 (高斯 cgs)**：$\\mathbf{E}_{\\mathrm{G}} = -\\nabla \\phi_{\\mathrm{G}} - (1/c)\\,\\partial \\mathbf{A}_{\\mathrm{G}}/\\partial t$。\n- **磁场**：在两种单位制中均为 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$。\n- **麦克斯韦-安培定律 (SI)**：$\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} + \\mu_0 \\varepsilon_0\\, \\partial \\mathbf{E}/\\partial t$。\n- **麦克斯韦-安培定律 (高斯 cgs)**：$\\nabla \\times \\mathbf{B} = (4\\pi/c)\\, \\mathbf{j} + (1/c)\\, \\partial \\mathbf{E}/\\partial t$。\n- **常数**：$c$ (光速)，$\\mu_0$ (真空磁导率)，$\\varepsilon_0$ (真空介电常数)。\n- **约束条件**：\n    1. 场不变性：$\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$。\n    2. 势相等：$\\phi_{\\mathrm{G}} = \\phi_{\\mathrm{SI}}$。\n- **换算定义**：$A_{\\parallel,\\mathrm{G}} = \\alpha\\, A_{\\parallel,\\mathrm{SI}}$ 和 $j_{\\parallel,\\mathrm{G}} = \\gamma\\, j_{\\parallel,\\mathrm{SI}}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题牢固地植根于经典电磁学（麦克斯韦方程组）的基本原理及其在等离子体物理学中的应用，特别是在已完善建立的回旋动理学框架内。所有给出的方程都是 SI 和高斯单位制的标准且事实正确的表示。\n- **适定性**：该问题明确定义了目标：求出标度因子 $\\alpha$ 和 $\\gamma$。它提供了一套完整的方程、约束条件和定义，这些对于推导唯一解是必要的。\n- **客观性**：该问题以精确、客观、形式化的科学语言陈述，没有任何主观或模棱两可的术语。\n- **一致性与完备性**：整个设定是自洽的。给定的关系和约束条件是相互一致的，并且足以进行推导。问题的结构从基本方程逻辑地引导到待求的特定量。不存在矛盾或缺失关键信息。\n\n### 步骤 3：结论与行动\n该问题在科学上是合理的、适定的、客观的且内部一致。因此，它被判定为**有效**。我们可以继续进行求解。\n\n### 推导\n\n目标是找到标度因子 $(\\alpha, \\gamma)$，使得麦克斯韦-安培定律的平行分量在 SI 和高斯单位制中相同。\n\n首先，我们在给定的回旋动理学级数下推导平行的麦克斯韦-安培定律的一般形式。总磁场为 $\\mathbf{B} = \\mathbf{B}_0 + \\delta \\mathbf{B}$。由于 $\\mathbf{B}_0$ 是一个均匀场，其旋度为零，$\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$。因此，总磁场的旋度就是涨落部分的旋度，$\\nabla \\times \\mathbf{B} = \\nabla \\times \\delta \\mathbf{B}$。涨落矢量势假定为纯平行的，$\\mathbf{A} \\approx A_{\\parallel} \\hat{\\mathbf{b}}_0$。于是涨落磁场由 $\\delta \\mathbf{B} = \\nabla \\times \\mathbf{A} = \\nabla \\times (A_{\\parallel} \\hat{\\mathbf{b}}_0)$ 给出。\n\n麦克斯韦-安培定律的左侧涉及 $\\nabla \\times \\mathbf{B} = \\nabla \\times (\\nabla \\times (A_{\\parallel} \\hat{\\mathbf{b}}_0))$。我们使用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{F}) = \\nabla(\\nabla \\cdot \\mathbf{F}) - \\nabla^2 \\mathbf{F}$。\n$$\n\\nabla \\times \\delta \\mathbf{B} = \\nabla(\\nabla \\cdot (A_{\\parallel} \\hat{\\mathbf{b}}_0)) - \\nabla^2 (A_{\\parallel} \\hat{\\mathbf{b}}_0)\n$$\n由于 $\\hat{\\mathbf{b}}_0$ 是一个常矢量，我们有 $\\nabla \\cdot (A_{\\parallel} \\hat{\\mathbf{b}}_0) = \\hat{\\mathbf{b}}_0 \\cdot \\nabla A_{\\parallel} = \\partial_{\\parallel} A_{\\parallel}$ 以及 $\\nabla^2 (A_{\\parallel} \\hat{\\mathbf{b}}_0) = (\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0$。\n因此，\n$$\n\\nabla \\times \\delta \\mathbf{B} = \\nabla(\\partial_{\\parallel} A_{\\parallel}) - (\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0\n$$\n将此方程投影到平行方向 $\\hat{\\mathbf{b}}_0$：\n$$\n\\hat{\\mathbf{b}}_0 \\cdot (\\nabla \\times \\delta \\mathbf{B}) = \\hat{\\mathbf{b}}_0 \\cdot \\nabla(\\partial_{\\parallel} A_{\\parallel}) - \\hat{\\mathbf{b}}_0 \\cdot ((\\nabla^2 A_{\\parallel}) \\hat{\\mathbf{b}}_0) = \\partial_{\\parallel}(\\partial_{\\parallel} A_{\\parallel}) - \\nabla^2 A_{\\parallel} = \\partial_{\\parallel}^2 A_{\\parallel} - \\nabla^2 A_{\\parallel}\n$$\n使用拉普拉斯算子的分解 $\\nabla^2 = \\nabla_{\\perp}^2 + \\partial_{\\parallel}^2$，左侧（LHS）的平行分量变为：\n$$\n\\hat{\\mathbf{b}}_0 \\cdot (\\nabla \\times \\delta \\mathbf{B}) = \\partial_{\\parallel}^2 A_{\\parallel} - (\\nabla_{\\perp}^2 + \\partial_{\\parallel}^2) A_{\\parallel} = -\\nabla_{\\perp}^2 A_{\\parallel}\n$$\n这就确立了方程左侧所要求的形式。\n\n现在，我们在两种单位制中写出完整的平行麦克斯韦-安培定律。\n\n在 SI 单位制中：\n右侧的平行投影为 $\\hat{\\mathbf{b}}_0 \\cdot (\\mu_0 \\mathbf{j}_{\\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial \\mathbf{E}_{\\mathrm{SI}}}{\\partial t}) = \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$。\n所以，方程为：\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}} = \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t} \\quad (\\text{SI})\n$$\n\n在高斯单位制中：\n右侧的平行投影为 $\\hat{\\mathbf{b}}_0 \\cdot (\\frac{4\\pi}{c} \\mathbf{j}_{\\mathrm{G}} + \\frac{1}{c} \\frac{\\partial \\mathbf{E}_{\\mathrm{G}}}{\\partial t}) = \\frac{4\\pi}{c} j_{\\parallel, \\mathrm{G}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{G}}}{\\partial t}$。\n所以，方程为：\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{G}} = \\frac{4\\pi}{c} j_{\\parallel, \\mathrm{G}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{G}}}{\\partial t} \\quad (\\text{Gaussian})\n$$\n\n接下来，我们确定标度因子 $\\alpha$。问题陈述物理电场是不变的，$\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$，并且标量势相等，$\\phi_{\\mathrm{SI}} = \\phi_{\\mathrm{G}}$。使用 $\\mathbf{E}$ 的定义和回旋动理学近似 $\\mathbf{A} \\approx A_{\\parallel} \\hat{\\mathbf{b}}_0$：\n$$\n-\\nabla \\phi_{\\mathrm{SI}} - \\frac{\\partial A_{\\parallel, \\mathrm{SI}}}{\\partial t} \\hat{\\mathbf{b}}_0 = -\\nabla \\phi_{\\mathrm{G}} - \\frac{1}{c} \\frac{\\partial A_{\\parallel, \\mathrm{G}}}{\\partial t} \\hat{\\mathbf{b}}_0\n$$\n由于 $\\phi_{\\mathrm{SI}} = \\phi_{\\mathrm{G}}$，这简化为：\n$$\n\\frac{\\partial A_{\\parallel, \\mathrm{SI}}}{\\partial t} \\hat{\\mathbf{b}}_0 = \\frac{1}{c} \\frac{\\partial A_{\\parallel, \\mathrm{G}}}{\\partial t} \\hat{\\mathbf{b}}_0\n$$\n假设这个关系对场本身成立（而不仅仅是对它们的时间导数），我们得到 $A_{\\parallel, \\mathrm{SI}} = \\frac{1}{c} A_{\\parallel, \\mathrm{G}}$。使用定义 $A_{\\parallel, \\mathrm{G}} = \\alpha A_{\\parallel, \\mathrm{SI}}$，我们发现：\n$$\nA_{\\parallel, \\mathrm{SI}} = \\frac{1}{c} (\\alpha A_{\\parallel, \\mathrm{SI}}) \\implies 1 = \\frac{\\alpha}{c} \\implies \\alpha = c\n$$\n\n最后，我们强制要求两种形式的麦克斯韦-安培定律相同。这意味着如果 SI 场满足 SI 方程，则相应的高斯场必须满足高斯方程。这意味着当用 SI 场表示高斯方程时，它必须是 SI 方程的常数倍。\n将 $A_{\\parallel, \\mathrm{G}} = \\alpha A_{\\parallel, \\mathrm{SI}}$，$j_{\\parallel, \\mathrm{G}} = \\gamma j_{\\parallel, \\mathrm{SI}}$ 和 $E_{\\parallel, \\mathrm{G}} = E_{\\parallel, \\mathrm{SI}}$（由 $\\mathbf{E}_{\\mathrm{SI}} = \\mathbf{E}_{\\mathrm{G}}$ 得出）代入高斯方程：\n$$\n-\\nabla_{\\perp}^2 (\\alpha A_{\\parallel, \\mathrm{SI}}) = \\frac{4\\pi}{c} (\\gamma j_{\\parallel, \\mathrm{SI}}) + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\n$$\n\\alpha (-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}}) = \\frac{4\\pi \\gamma}{c} j_{\\parallel, \\mathrm{SI}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\n现在用 SI 方程的右侧替换 $-\\nabla_{\\perp}^2 A_{\\parallel, \\mathrm{SI}}$：\n$$\n\\alpha \\left( \\mu_0 j_{\\parallel, \\mathrm{SI}} + \\mu_0 \\varepsilon_0 \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t} \\right) = \\frac{4\\pi \\gamma}{c} j_{\\parallel, \\mathrm{SI}} + \\frac{1}{c} \\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}\n$$\n这个等式必须对任意的场动力学都成立，这意味着独立项 $j_{\\parallel, \\mathrm{SI}}$ 和 $\\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$ 的系数在两边必须相等。\n\n1.  令 $j_{\\parallel, \\mathrm{SI}}$ 的系数相等：\n$$\n\\alpha \\mu_0 = \\frac{4\\pi \\gamma}{c}\n$$\n2.  令 $\\frac{\\partial E_{\\parallel, \\mathrm{SI}}}{\\partial t}$ 的系数相等：\n$$\n\\alpha \\mu_0 \\varepsilon_0 = \\frac{1}{c}\n$$\n从第二个方程，我们可以重新推导出 $\\alpha$：\n$$\n\\alpha = \\frac{1}{c \\mu_0 \\varepsilon_0}\n$$\n使用基本电磁关系 $c^2 = 1/(\\mu_0 \\varepsilon_0)$，我们发现：\n$$\n\\alpha = \\frac{1}{c (1/c^2)} = c\n$$\n这证实了我们之前得到的 $\\alpha$ 的结果。\n\n现在，我们使用第一个方程来求解 $\\gamma$：\n$$\n\\gamma = \\frac{\\alpha \\mu_0 c}{4\\pi}\n$$\n代入 $\\alpha = c$：\n$$\n\\gamma = \\frac{c \\cdot \\mu_0 c}{4\\pi} = \\frac{\\mu_0 c^2}{4\\pi}\n$$\n为了得到更简单的形式，我们可以再次使用恒等式 $c^2 = 1/(\\mu_0 \\varepsilon_0)$：\n$$\n\\gamma = \\frac{\\mu_0}{4\\pi} \\left( \\frac{1}{\\mu_0 \\varepsilon_0} \\right) = \\frac{1}{4\\pi \\varepsilon_0}\n$$\n因此，标度因子为 $\\alpha = c$ 和 $\\gamma = \\frac{1}{4\\pi \\varepsilon_0}$。所求的有序对是 $(\\alpha, \\gamma)$。",
            "answer": "$$\n\\boxed{(\\alpha, \\gamma) = (c, \\frac{1}{4\\pi\\varepsilon_0})}\n$$"
        },
        {
            "introduction": "验证代码的正确性是计算科学中的关键步骤，“人造解方法”（Method of Manufactured Solutions, MMS）是实现这一目标的强大技术。通过这项实践 ()，您将学习如何为人造的电磁场构建相应的源项，并数值地检验核心回旋动理学场方程求解器的准确性。这项练习是确保模拟代码可靠性的基本功。",
            "id": "3971207",
            "problem": "考虑一个具有坐标 $x$、$y$ 和 $z$ 的周期性板状区域，以及一个均匀背景磁场 $B_0 \\hat{\\boldsymbol{z}}$。设 $\\phi(x,y,z)$ 为静电势，$A_{\\parallel}(x,y,z)$ 为平行于 $\\hat{\\boldsymbol{z}}$ 的磁矢量势分量。在低频电磁回旋动理学（Gyrokinetic (GK)）中，用于闭合动理学系统的场方程，对于每个具有垂直波矢 $\\boldsymbol{k}_{\\perp}$ 的垂直傅里叶模式，在其谱表示下为回旋动理学准中性约束和平行于磁场的安培定律分量。在均匀等离子体中，对这些约束的一种经过充分检验的表述（其中粒子种类指数为 $s$）如下：\n- 回旋动理学准中性：广义电荷密度（右侧）$\\rho_{\\mathrm{gk}}$ 对每个 $\\boldsymbol{k}_{\\perp}$ 满足，\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\sum_{s} \\frac{q_s^2 n_s}{T_s} \\Bigl( 1 - \\Gamma_0(b_s) \\Bigr) \\,\\phi(\\boldsymbol{k}),\n$$\n其中 $q_s$ 是粒子种类电荷，$n_s$ 是均匀背景密度，$T_s$ 是温度，$b_s = k_{\\perp}^2 \\rho_{ts}^2$，并且 $\\Gamma_0(b) = e^{-b} I_0(b)$，其中 $I_0$ 是$0$阶第一类修正贝塞尔函数。热拉莫尔半径为 $\\rho_{ts} = v_{ts}/\\Omega_s$，其中热速度 $v_{ts} = \\sqrt{2 T_s / m_s}$，回旋频率 $\\Omega_s = |q_s| B_0 / m_s$。\n- 在低$\\beta$和低频极限下（忽略位移电流和压缩性磁扰动），平行安培定律逐个模式给出，\n$$\n-\\nabla_{\\perp}^2 A_{\\parallel}(\\boldsymbol{x}) \\;=\\; \\mu_0 \\, j_{\\parallel}(\\boldsymbol{x}),\n$$\n因此在傅里叶空间中\n$$\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\frac{k_{\\perp}^2}{\\mu_0} \\, A_{\\parallel}(\\boldsymbol{k}),\n$$\n其中 $\\mu_0$ 是自由空间磁导率。\n\n要求您实现人造解方法，在一个周期性板状区域中使用离散谱表示同时检验这两个约束，并验证您实现的数值正确性。您必须：\n- 对场使用一个人造解，\n$$\n\\phi^{\\star}(x,y,z) \\;=\\; \\Phi_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr), \\qquad\nA_{\\parallel}^{\\star}(x,y,z) \\;=\\; A_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr),\n$$\n其中 $k_x = 2\\pi m_x/L_x$、$k_y = 2\\pi m_y/L_y$ 和 $k_z = 2\\pi m_z/L_z$，对于给定的正整数 $m_x$、$m_y$ 和 $m_z$，以及正的区域尺寸 $L_x$、$L_y$、$L_z$。\n- 通过以下方式为所有傅里叶模式在谱空间中定义人造的右侧项\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\left[ \\sum_s \\frac{q_s^2 n_s}{T_s} \\left(1 - \\Gamma_0\\bigl(k_{\\perp}^2 \\rho_{ts}^2\\bigr)\\right) \\right] \\phi^{\\star}(\\boldsymbol{k}) \\;\\equiv\\; P(\\boldsymbol{k}) \\, \\phi^{\\star}(\\boldsymbol{k}),\n$$\n$$\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\left[\\frac{k_{\\perp}^2}{\\mu_0}\\right] A_{\\parallel}^{\\star}(\\boldsymbol{k}) \\;\\equiv\\; M(\\boldsymbol{k}) \\, A_{\\parallel}^{\\star}(\\boldsymbol{k}),\n$$\n其中对每个模式 $k_{\\perp}^2 = k_x^2 + k_y^2$。\n- 通过在谱空间中对非零的 $P(\\boldsymbol{k})$ 和 $M(\\boldsymbol{k})$ 进行求逆来数值重构 $\\phi$ 和 $A_{\\parallel}$，即，\n$$\n\\phi(\\boldsymbol{k}) \\;=\\; \\begin{cases}\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k})/P(\\boldsymbol{k}), & P(\\boldsymbol{k}) \\neq 0, \\\\\n0, & P(\\boldsymbol{k}) = 0,\n\\end{cases}\n\\qquad\nA_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\begin{cases}\nj_{\\parallel}(\\boldsymbol{k})/M(\\boldsymbol{k}), & M(\\boldsymbol{k}) \\neq 0, \\\\\n0, & M(\\boldsymbol{k}) = 0,\n\\end{cases}\n$$\n然后应用离散傅里叶逆变换，在周期性区域的均匀网格上获得实空间中的场。使用三维快速傅里叶变换（Fast Fourier Transform (FFT)），采用您所选库的标准幺正缩放约定，并对正向和逆向变换保持一致的应用。使用一个具有 $N_x = N_y = N_z = 64$ 个点的均匀网格。\n- 对每个测试用例，计算相对$\\ell^2$重构误差，\n$$\n\\varepsilon_{\\phi} \\;=\\; \\frac{\\left\\|\\phi - \\phi^{\\star}\\right\\|_2}{\\left\\|\\phi^{\\star}\\right\\|_2}, \\qquad\n\\varepsilon_{A} \\;=\\; \\frac{\\left\\|A_{\\parallel} - A_{\\parallel}^{\\star}\\right\\|_2}{\\left\\|A_{\\parallel}^{\\star}\\right\\|_2}.\n$$\n这些误差是无量纲的，必须以十进制数报告。\n\n所有量都必须使用国际单位制（International System of Units (SI)）处理。特别地，$n_s$ 的单位必须是 $\\mathrm{m}^{-3}$，$T_s$ 是焦耳，$B_0$ 是特斯拉，$\\Phi_0$ 是伏特，$A_0$ 是伏特-秒/米。使用单位为库仑的基本电荷 $e$ 和单位为亨利/米的自由空间磁导率 $\\mu_0$。使用 $T[\\mathrm{J}] = T[\\mathrm{eV}] \\times e$ 将任何提供的电子伏特转换为焦耳。\n\n实现程序以评估以下测试套件。在所有情况下，都精确包含两种粒子：电荷为 $q_i = +e$、质量为 $m_i = 2 m_p$ 的氘离子，以及电荷为 $q_e = -e$、质量为 $m_e$ 的电子，其中 $m_p$ 是质子质量。将 $e$ 和 $\\mu_0$ 作为其标准物理常数。均匀密度满足 $n_i = n_e = n_0$。\n\n测试用例 1（一般情况）：\n- $n_0 = 1.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$B_0 = 3.0\\ \\mathrm{T}$，$T_i = 2.5\\ \\mathrm{keV}$，$T_e = 1.5\\ \\mathrm{keV}$，\n- $L_x = 0.6\\ \\mathrm{m}$，$L_y = 0.4\\ \\mathrm{m}$，$L_z = 1.0\\ \\mathrm{m}$，\n- $(m_x, m_y, m_z) = (1, 2, 1)$，\n- $\\Phi_0 = 1.2\\ \\mathrm{V}$，$A_0 = 2.0 \\times 10^{-6}\\ \\mathrm{V\\cdot s/m}$。\n\n测试用例 2（小 $k_{\\perp}$ 区域）：\n- $n_0 = 5.0 \\times 10^{18}\\ \\mathrm{m}^{-3}$，$B_0 = 6.0\\ \\mathrm{T}$，$T_i = 3.0\\ \\mathrm{keV}$，$T_e = 3.0\\ \\mathrm{keV}$，\n- $L_x = 4.0\\ \\mathrm{m}$，$L_y = 3.0\\ \\mathrm{m}$，$L_z = 2.0\\ \\mathrm{m}$，\n- $(m_x, m_y, m_z) = (1, 1, 2)$，\n- $\\Phi_0 = 0.8\\ \\mathrm{V}$，$A_0 = 1.0 \\times 10^{-6}\\ \\mathrm{V\\cdot s/m}$。\n\n测试用例 3（大 $k_{\\perp}$ 区域）：\n- $n_0 = 2.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$B_0 = 2.5\\ \\mathrm{T}$，$T_i = 1.0\\ \\mathrm{keV}$，$T_e = 0.8\\ \\mathrm{keV}$，\n- $L_x = 0.1\\ \\mathrm{m}$，$L_y = 0.08\\ \\mathrm{m}$，$L_z = 0.5\\ \\mathrm{m}$，\n- $(m_x, m_y, m_z) = (5, 7, 3)$，\n- $\\Phi_0 = 1.0\\ \\mathrm{V}$，$A_0 = 5.0 \\times 10^{-7}\\ \\mathrm{V\\cdot s/m}$。\n\n您的程序必须：\n- 使用指定的参数在均匀网格上构造 $\\phi^{\\star}$ 和 $A_{\\parallel}^{\\star}$，\n- 对所有模式使用 $\\Gamma_0(b) = e^{-b} I_0(b)$（其中 $b_s = k_{\\perp}^2 \\rho_{ts}^2$，$\\rho_{ts} = \\sqrt{2 T_s m_s}/(|q_s| B_0)$）计算谱算符 $P(\\boldsymbol{k})$ 和 $M(\\boldsymbol{k})$，\n- 通过分别乘以 $P(\\boldsymbol{k})$ 和 $M(\\boldsymbol{k})$，在谱空间中制造 $\\rho_{\\mathrm{gk}}$ 和 $j_{\\parallel}$，\n- 在 $P(\\boldsymbol{k})$ 和 $M(\\boldsymbol{k})$ 非零处通过谱除法重构 $\\phi$ 和 $A_{\\parallel}$（在分母为零处将相应的重构谱系数设为零），\n- 计算 $\\varepsilon_{\\phi}$ 和 $\\varepsilon_{A}$，\n- 输出一行，包含一个方括号内的逗号分隔列表，其中有 6 个浮点数结果，顺序为 $[\\varepsilon_{\\phi}^{(1)}, \\varepsilon_{A}^{(1)}, \\varepsilon_{\\phi}^{(2)}, \\varepsilon_{A}^{(2)}, \\varepsilon_{\\phi}^{(3)}, \\varepsilon_{A}^{(3)}]$。\n\n所有输出均为无量纲的相对误差，必须以十进制数打印。没有角度量；如果使用任何中间三角函数，其参数应解释为弧度。最终输出格式必须是精确的一行：一个指定的列表，不含任何额外文本。",
            "solution": "人造解方法通过设计构造出一对场和相应的右侧项，使其满足目标方程，从而能够对离散化和实现进行受控验证。我们引用的基本定律和定义如下。\n\n从适用于电磁回旋动理学的静磁、低频极限下的麦克斯韦方程组出发，安培定律的平行分量简化为 $-\\nabla_{\\perp}^2 A_{\\parallel} = \\mu_0 j_{\\parallel}$，其中 $\\nabla_{\\perp}^2$ 是垂直于背景磁场平面内的拉普拉斯算子。在一个周期性区域中，将所有场展开为傅里叶级数，对每个模式可得 $j_{\\parallel}(\\boldsymbol{k}) = \\left(k_{\\perp}^2/\\mu_0\\right) A_{\\parallel}(\\boldsymbol{k})$。这是应用傅里叶变换性质 $\\mathcal{F}\\{\\nabla_{\\perp}^2 f\\} = -k_{\\perp}^2 \\mathcal{F}\\{f\\}$ 的结果。\n\n在对回旋相位进行平均后从弗拉索夫-麦克斯韦系统导出的回旋动理学准中性约束中，广义极化将 $\\phi$ 与回旋中心分布的电荷密度矩联系起来。在一个背景密度为 $n_s$、温度为 $T_s$ 的均匀等离子体中，对于粒子种类 $s$，每个垂直模式的谱关系为\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; \\sum_s \\frac{q_s^2 n_s}{T_s} \\left[1 - \\Gamma_0(b_s)\\right] \\phi(\\boldsymbol{k}),\n$$\n其中有限拉莫尔半径效应包含在 $\\Gamma_0(b) = e^{-b} I_0(b)$ 和 $b_s = k_{\\perp}^2 \\rho_{ts}^2$ 中。热拉莫尔半径为 $\\rho_{ts} = v_{ts}/\\Omega_s$，其中热速度 $v_{ts} = \\sqrt{2 T_s/m_s}$ 来自能量均分，回旋频率 $\\Omega_s = |q_s| B_0/m_s$。这些是回旋动理学理论中标准且经过充分检验的定义。\n\n我们采用一个人造解\n$$\n\\phi^{\\star}(x,y,z) \\;=\\; \\Phi_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr), \\qquad\nA_{\\parallel}^{\\star}(x,y,z) \\;=\\; A_0 \\cos\\!\\bigl(k_x x\\bigr)\\cos\\!\\bigl(k_y y\\bigr)\\cos\\!\\bigl(k_z z\\bigr).\n$$\n根据场方程的线性性，只需计算所选傅里叶模式下的谱系数并应用算符即可。在谱空间中，对所有模式，我们定义\n$$\nP(\\boldsymbol{k}) \\;=\\; \\sum_s \\frac{q_s^2 n_s}{T_s} \\left(1 - \\Gamma_0\\bigl(k_{\\perp}^2 \\rho_{ts}^2\\bigr)\\right), \\qquad\nM(\\boldsymbol{k}) \\;=\\; \\frac{k_{\\perp}^2}{\\mu_0}.\n$$\n那么人造源为\n$$\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) \\;=\\; P(\\boldsymbol{k}) \\, \\phi^{\\star}(\\boldsymbol{k}), \\qquad\nj_{\\parallel}(\\boldsymbol{k}) \\;=\\; M(\\boldsymbol{k}) \\, A_{\\parallel}^{\\star}(\\boldsymbol{k}).\n$$\n为验证实现，我们通过谱除法重构场：\n$$\n\\phi(\\boldsymbol{k}) \\;=\\; \\begin{cases}\n\\rho_{\\mathrm{gk}}(\\boldsymbol{k})/P(\\boldsymbol{k}), & P(\\boldsymbol{k}) \\neq 0,\\\\\n0, & P(\\boldsymbol{k}) = 0,\n\\end{cases}\n\\qquad\nA_{\\parallel}(\\boldsymbol{k}) \\;=\\; \\begin{cases}\nj_{\\parallel}(\\boldsymbol{k})/M(\\boldsymbol{k}), & M(\\boldsymbol{k}) \\neq 0,\\\\\n0, & M(\\boldsymbol{k}) = 0.\n\\end{cases}\n$$\n由于人造场具有零均值（每个都是在完整周期上的余弦乘积），它们的零波数系数为零，因此对于这些目标模式不会发生除以零的情况。任何其他模式的人造振幅都为零，因此在算符为零处将重构系数设为零是一致的，并能避免数值问题。\n\n算法设计：\n- 将区域 $[0,L_x)\\times[0,L_y)\\times[0,L_z)$ 用 $N_x = N_y = N_z = 64$ 个点进行离散化。设网格间距为 $\\Delta x = L_x/N_x$、$\\Delta y = L_y/N_y$ 和 $\\Delta z = L_z/N_z$。对整数 $j$、$k$ 和 $\\ell$，构造网格点 $x_j = j \\Delta x$、$y_k = k \\Delta y$、$z_{\\ell} = \\ell \\Delta z$。\n- 使用规定的振幅和波数 $k_x = 2\\pi m_x/L_x$、$k_y = 2\\pi m_y/L_y$、$k_z = 2\\pi m_z/L_z$ 计算每个网格点上的人造场 $\\phi^{\\star}$ 和 $A_{\\parallel}^{\\star}$。\n- 计算与离散傅里叶变换一致的沿各轴的谱波数：$k_x^{(p)} = 2\\pi \\,\\mathrm{fftfreq}(N_x, \\Delta x)$、$k_y^{(q)} = 2\\pi \\,\\mathrm{fftfreq}(N_y, \\Delta y)$、$k_z^{(r)} = 2\\pi \\,\\mathrm{fftfreq}(N_z, \\Delta z)$，并通过网格化形成三维数组 $K_x$、$K_y$、$K_z$。垂直波数的平方为 $k_{\\perp}^2 = K_x^2 + K_y^2$。\n- 对每种粒子 $s$（氘离子和电子），在国际单位制（SI）中计算 $\\rho_{ts} = \\sqrt{2 T_s m_s}/(|q_s| B_0)$，然后计算 $b_s = k_{\\perp}^2 \\rho_{ts}^2$ 和 $\\Gamma_0(b_s) = e^{-b_s} I_0(b_s)$。根据 $P(\\boldsymbol{k}) = \\sum_s (q_s^2 n_s / T_s)\\left(1 - \\Gamma_0(b_s)\\right)$ 对所有粒子种类求和得到 $P(\\boldsymbol{k})$。计算 $M(\\boldsymbol{k}) = k_{\\perp}^2/\\mu_0$。\n- 计算 $\\phi^{\\star}$ 和 $A_{\\parallel}^{\\star}$ 的正向三维快速傅里叶变换（FFT），得到 $\\phi^{\\star}(\\boldsymbol{k})$ 和 $A_{\\parallel}^{\\star}(\\boldsymbol{k})$，然后在谱空间中构造人造源：$\\rho_{\\mathrm{gk}}(\\boldsymbol{k}) = P(\\boldsymbol{k}) \\phi^{\\star}(\\boldsymbol{k})$ 和 $j_{\\parallel}(\\boldsymbol{k}) = M(\\boldsymbol{k}) A_{\\parallel}^{\\star}(\\boldsymbol{k})$。\n- 在 $P(\\boldsymbol{k})$ 和 $M(\\boldsymbol{k})$ 非零处通过除法重构谱场，并在它们为零处将系数设为零。应用傅里叶逆变换（inverse FFT）得到实空间中的 $\\phi$ 和 $A_{\\parallel}$。\n- 计算相对$\\ell^2$误差 $\\varepsilon_{\\phi} = \\|\\phi - \\phi^{\\star}\\|_2/\\|\\phi^{\\star}\\|_2$ 和 $\\varepsilon_{A} = \\|A_{\\parallel} - A_{\\parallel}^{\\star}\\|_2/\\|A_{\\parallel}^{\\star}\\|_2$。\n\n该测试套件指定了三种探索不同区域的场景：\n- 一个具有中等 $k_{\\perp}$ 和不等温度的一般情况，\n- 一个小 $k_{\\perp}$ 区域，其中 $b_s \\ll 1$ 且 $1 - \\Gamma_0(b_s)$ 很小，用于测试极化算符的灵敏度，\n- 一个大 $k_{\\perp}$ 区域，其中有限拉莫尔半径效应很强，用于通过 $I_0(b)$ 测试 $\\Gamma_0(b)$ 的实现。\n\n由于人造源是通过在谱空间中直接应用算符构造的，而重构是在同一表示中应用其精确的代数逆，因此预期的数值误差 $\\varepsilon_{\\phi}$ 和 $\\varepsilon_{A}$ 仅限于浮点舍入和FFT的有限精度，通常处于或接近机器精度（量级在 $10^{-15}$ 到 $10^{-13}$ 之间），前提是网格能精确解析所选的波数，并且变换的应用是一致的。最终程序将六个误差汇总到一个列表中 $[\\varepsilon_{\\phi}^{(1)}, \\varepsilon_{A}^{(1)}, \\varepsilon_{\\phi}^{(2)}, \\varepsilon_{A}^{(2)}, \\varepsilon_{\\phi}^{(3)}, \\varepsilon_{A}^{(3)}]$，并将其作为唯一的输出行打印出来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\nfrom scipy import constants as const\n\ndef manufactured_errors_for_case(Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV):\n    # Grid resolution\n    Nx = Ny = Nz = 64\n    dx, dy, dz = Lx / Nx, Ly / Ny, Lz / Nz\n\n    # Real-space grids\n    x = np.arange(Nx) * dx\n    y = np.arange(Ny) * dy\n    z = np.arange(Nz) * dz\n    X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n    # Wavenumbers for manufactured fields\n    kx = 2.0 * np.pi * mx / Lx\n    ky = 2.0 * np.pi * my / Ly\n    kz = 2.0 * np.pi * mz / Lz\n\n    # Manufactured fields in real space\n    phi_star = Phi0 * np.cos(kx * X) * np.cos(ky * Y) * np.cos(kz * Z)\n    Apar_star = A0 * np.cos(kx * X) * np.cos(ky * Y) * np.cos(kz * Z)\n\n    # Spectral wave numbers consistent with numpy FFT conventions\n    kx_arr = 2.0 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_arr = 2.0 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kz_arr = 2.0 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    KX, KY, KZ = np.meshgrid(kx_arr, ky_arr, kz_arr, indexing='ij')\n    kperp2 = KX**2 + KY**2\n\n    # Species parameters\n    # Charges\n    qi = const.e\n    qe = -const.e\n    # Masses\n    mp = const.proton_mass\n    mi = 2.0 * mp  # deuterium approximation\n    me = const.electron_mass\n    # Densities\n    ni = n0\n    ne = n0\n    # Temperatures (convert keV to J)\n    Ti_J = Ti_keV * 1.0e3 * const.e\n    Te_J = Te_keV * 1.0e3 * const.e\n\n    # Thermal Larmor radii\n    rho_ti = np.sqrt(2.0 * Ti_J * mi) / (abs(qi) * B0)\n    rho_te = np.sqrt(2.0 * Te_J * me) / (abs(qe) * B0)\n\n    # Compute Gamma0 for each species over all k_perp\n    bi = kperp2 * (rho_ti**2)\n    be = kperp2 * (rho_te**2)\n    Gamma0_i = np.exp(-bi) * i0(bi)\n    Gamma0_e = np.exp(-be) * i0(be)\n\n    # Build P(k) = sum_s (q_s^2 n_s / T_s) (1 - Gamma0_s)\n    Pi = (qi**2 * ni / Ti_J) * (1.0 - Gamma0_i)\n    Pe = (qe**2 * ne / Te_J) * (1.0 - Gamma0_e)  # qe**2 = e**2\n    Pk = Pi + Pe\n\n    # Build M(k) = k_perp^2 / mu0\n    Mk = kperp2 / const.mu_0\n\n    # Forward FFTs of manufactured fields\n    phi_k = np.fft.fftn(phi_star)\n    Apar_k = np.fft.fftn(Apar_star)\n\n    # Manufactured sources in spectral space\n    rho_k = Pk * phi_k\n    jpar_k = Mk * Apar_k\n\n    # Reconstruct by spectral division where operator is nonzero\n    tol = 0.0  # exact mask; zero where exactly zero operator\n    phi_k_rec = np.zeros_like(phi_k, dtype=np.complex128)\n    Apar_k_rec = np.zeros_like(Apar_k, dtype=np.complex128)\n\n    mask_P = Pk > tol\n    mask_M = Mk > tol\n\n    phi_k_rec[mask_P] = rho_k[mask_P] / Pk[mask_P]\n    Apar_k_rec[mask_M] = jpar_k[mask_M] / Mk[mask_M]\n\n    # Inverse FFT to real space\n    phi_rec = np.fft.ifftn(phi_k_rec).real\n    Apar_rec = np.fft.ifftn(Apar_k_rec).real\n\n    # Compute relative L2 errors\n    def rel_l2(a, b):\n        num = np.linalg.norm((a - b).ravel())\n        den = np.linalg.norm(b.ravel())\n        # Guard against zero norm (should not happen with cos products and nonzero amplitudes)\n        if den == 0.0:\n            return 0.0\n        return num / den\n\n    err_phi = rel_l2(phi_rec, phi_star)\n    err_A = rel_l2(Apar_rec, Apar_star)\n    return float(err_phi), float(err_A)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV)\n        (0.6, 0.4, 1.0, 1, 2, 1, 1.2, 2.0e-6, 1.0e19, 3.0, 2.5, 1.5),\n        (4.0, 3.0, 2.0, 1, 1, 2, 0.8, 1.0e-6, 5.0e18, 6.0, 3.0, 3.0),\n        (0.1, 0.08, 0.5, 5, 7, 3, 1.0, 5.0e-7, 2.0e19, 2.5, 1.0, 0.8),\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV = case\n        err_phi, err_A = manufactured_errors_for_case(\n            Lx, Ly, Lz, mx, my, mz, Phi0, A0, n0, B0, Ti_keV, Te_keV\n        )\n        results.append(err_phi)\n        results.append(err_A)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "回旋动理学模拟的一个核心目标是预测由微观湍流引起的输运。本练习 () 将理论付诸实践，要求您推导并计算离子温度梯度（ITG）湍流引起的离子热通量。此外，您还将通过执行分辨率收敛性研究来评估计算结果的可靠性，这是确保数值模拟科学严谨性的必要训练。",
            "id": "3971193",
            "problem": "考虑一个均匀平板中的离子温度梯度（ITG）微观湍流场景，其中等离子体贝塔值为中等，定义为热压与磁压之比，即 $\\beta = p_{\\mathrm{th}}/p_{\\mathrm{mag}}$。使用离子的回旋动理学（GK）框架，并通过矢势的平行分量 $A_{\\parallel}$ 保留电磁微扰，湍流离子热通量源于离子分布函数的涨落与平流场之间的关联。本问题的目标是，在一组物理上一致、适用于中等$\\beta$值ITG的假设下，推导、实现并测量无量纲电磁离子热通量相对于平行波数分辨率 $k_{\\parallel}$、垂直波数分辨率 $k_{\\perp}$ 以及速度空间分辨率的收敛性。\n\n出发点。您的推导必须从以下基础和核心定义开始：\n- 在存在静电势 $\\phi$ 和平行矢势 $A_{\\parallel}$ 的情况下，针对涨落离子分布函数的非绝热部分 $h_i$ 的回旋动理学方程，其中离子的平衡分布为麦克斯韦分布 $F_M(v)$。\n- 离子热通量的定义，即能量密度与平流径向分量在主导阶上的关联。这包括静电 $\\boldsymbol{E} \\times \\boldsymbol{B}$ 漂移及其由磁涨落（平行矢势介导的输运）引起的相应电磁部分。\n- 通过第一类零阶贝塞尔函数 $J_0$ 进行的标准回旋平均，应用于场与分布函数之间的耦合。\n\n推导中使用的假设和建模选择（所有这些对于中等$\\beta$值的ITG平板都是科学上合理的，旨在保持正确的定性物理的同时，使计算问题易于处理）：\n- 电子在静电响应中被视为绝热的，但通过 $A_{\\parallel}$ 在离子动力学中提供电磁耦合。\n- 系统被归一化为无量纲回旋动理学单位：长度以离子拉莫尔半径 $\\rho_i$ 为单位，速度以离子热速度 $v_{\\mathrm{th},i}$ 为单位，时间以离子回旋频率为单位，势以 $T_i/e$ 为单位。在这些单位中，计算出的热通量是无量纲的。\n- 湍谱由与ITG湍流一致的各向异性包络建模：静电势振幅 $|\\phi_{\\boldsymbol{k}}|$ 在有限的 $k_{\\perp}$ 处达到峰值，并随 $|k_{\\parallel}|$ 的增加而衰减；电磁势 $A_{\\parallel,\\boldsymbol{k}}$ 通过一个与 $k_{\\parallel}/k_{\\perp}$ 成比例的比率，随 $\\beta$ 和各向异性而变化。\n- 线性/准线性动力学通过模式增长率 $\\gamma_{\\boldsymbol{k}}$ 和实频率 $\\omega_{\\boldsymbol{k}}$，提供了 $\\phi_{\\boldsymbol{k}}$ 和 $h_{i,\\boldsymbol{k}}$ 之间的交叉相位，以及 $A_{\\parallel,\\boldsymbol{k}}$ 和相应电磁热通量通道之间的交叉相位。\n\n您必须从这些基础和假设出发，推导出一个准线性表达式，用于表示无量纲离子热通量 $Q_i$，该表达式为对波矢量 $(k_{\\perp},k_{\\parallel})$ 的谱求和以及对速度空间坐标的数值积分。速度空间积分必须在能量坐标 $\\varepsilon$ 和螺距角坐标 $\\lambda$ 上进行，其中$v^2 = 2 \\varepsilon$, $v_{\\perp}^2 = 2 \\varepsilon \\lambda$, $v_{\\parallel}^2 = 2 \\varepsilon (1-\\lambda)$，且$0 \\le \\lambda \\le 1$，$0 \\le \\varepsilon  \\infty$。被积函数必须包括麦克斯韦权重 $e^{-\\varepsilon}$、适用于热输运的适当能量加权，以及回旋平均因子 $J_0\\!\\left(k_{\\perp} \\sqrt{2 \\varepsilon \\lambda}\\right)$。\n\n实现要求。基于您的推导，实现一个程序，通过对静电和电磁贡献求和来计算总的无量纲离子热通量 $Q_i$，其中每个贡献都表示为对 $(k_{\\perp},k_{\\parallel})$ 的双重求和以及对 $(\\varepsilon,\\lambda)$ 的双重积分。该程序必须：\n- 为 $k_{\\perp}$ 在 $[k_{\\perp,\\min},k_{\\perp,\\max}]$ 上和 $k_{\\parallel}$ 在 $[-k_{\\parallel,\\max},k_{\\parallel,\\max}]$ 上构建具有指定点数 $N_{k_{\\perp}}$ 和 $N_{k_{\\parallel}}$ 的均匀网格。\n- 使用高斯-拉盖尔求积法计算 $\\varepsilon \\in [0,\\infty)$ 上的速度空间积分（权重为 $e^{-\\varepsilon}$），并使用高斯-勒让德求积法计算 $\\lambda \\in [0,1]$ 上的积分（从 $[-1,1]$ 映射而来）。\n- 使用以下具有物理动机的谱和响应模型来参数化 $|\\phi_{\\boldsymbol{k}}|$、$|A_{\\parallel,\\boldsymbol{k}}|$、$\\omega_{\\boldsymbol{k}}$ 和 $\\gamma_{\\boldsymbol{k}}$：\n  - 静电势包络：\n    $$|\\phi_{\\boldsymbol{k}}|^2 = \\phi_0^2 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\left(\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right)^{c}\\right],$$\n    其中常数 $\\phi_0$、$k_0$、$a$、$b$、$c$ 和 $k_{\\parallel,0}$ 在下文提供。\n  - 通过平行欧姆定律和各向异性启发的比例关系得到的电磁势：\n    $$A_{\\parallel,\\boldsymbol{k}} = \\alpha(\\beta)\\,\\frac{k_{\\parallel}}{k_{\\perp} + \\delta}\\,\\phi_{\\boldsymbol{k}}, \\quad \\alpha(\\beta) = \\frac{\\beta}{2+\\beta},$$\n    其中 $\\delta$ 是一个小的正常数，以防止除以零。\n  - 与ITG类型标度一致的实频率和增长率：\n    $$\\omega_{\\boldsymbol{k}} = \\omega_{*0} \\frac{k_y}{1+(k_{\\perp}/k_0)^2}, \\qquad \\gamma_{\\boldsymbol{k}} = \\gamma_0 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right],$$\n    在此平板模型中，您可以取 $k_y \\approx k_{\\perp}$。\n  - 准线性交叉相位因子：\n    $$\\mathcal{C}_{\\boldsymbol{k}} = \\frac{\\gamma_{\\boldsymbol{k}}}{\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2}。$$\n- 静电贡献必须用能量 $\\varepsilon$ 和回旋平均 $J_0^2$ 对被积函数进行加权，并且谱因子必须包括 $k_y^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$。\n- 电磁贡献必须用平行能量 $\\varepsilon(1-\\lambda)$ 对被积函数进行加权，并包括一个适当的谱因子，如 $k_{\\perp}^2 |A_{\\parallel,\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$。\n- 将两种贡献在所有 $(k_{\\perp},k_{\\parallel})$ 上求和，并乘以网格单元测度来近似积分。\n\n分辨率研究和测试套件。执行分辨率研究，以展示 $Q_i$ 相对于 $k_{\\parallel}$、$k_{\\perp}$ 和速度空间网格的收敛性。除非另有说明，否则使用以下固定参数：\n- 谱参数：$\\phi_0 = 1$，$k_0 = 0.3$，$a = 1$，$b = 2$（或在指定处为 $b=6$），$c = 1$，$k_{\\parallel,0} = 0.3$，$\\omega_{*0} = 1$，$\\gamma_0 = 0.2$，$\\delta = 10^{-12}$。\n- 波数范围：$k_{\\perp,\\min} = 0.05$，$k_{\\perp,\\max} = 2.0$，$k_{\\parallel,\\max} = 1.0$。\n\n定义四个测试案例：\n- 案例 A（理想路径，中等$\\beta$下的$k_{\\parallel}$-收敛性）：$\\beta = 0.03$，$N_{k_{\\perp}} = 96$，$N_{\\varepsilon} = 80$，$N_{\\lambda} = 80$，粗分辨率 $N_{k_{\\parallel}} = 24$，精细分辨率 $N_{k_{\\parallel}} = 96$。\n- 案例 B（理想路径，中等$\\beta$下的$k_{\\perp}$-收敛性）：$\\beta = 0.05$，$N_{k_{\\parallel}} = 96$，$N_{\\varepsilon} = 80$，$N_{\\lambda} = 80$，粗分辨率 $N_{k_{\\perp}} = 24$，精细分辨率 $N_{k_{\\perp}} = 96$。\n- 案例 C（较高中等$\\beta$下的速度空间收敛性）：$\\beta = 0.08$，$N_{k_{\\perp}} = 96$，$N_{k_{\\parallel}} = 96$，粗分辨率 $N_{\\varepsilon} = 24$、$N_{\\lambda} = 24$，精细分辨率 $N_{\\varepsilon} = 96$、$N_{\\lambda} = 96$。\n- 案例 D（边界情况，近静电且谱更陡峭）：$\\beta = 0.005$，$N_{k_{\\perp}} = 96$，$N_{k_{\\parallel}} = 96$，$N_{\\varepsilon} = 80$，$N_{\\lambda} = 80$，垂直谱陡峭度使用 $b = 6$；比较粗分辨率 $N_{k_{\\perp}}=24$ 与精细分辨率 $N_{k_{\\perp}}=96$。\n\n对于每个案例，计算粗分辨率和精细分辨率下的 $Q_i$（保持所有其他分辨率固定为所述值），并以小数形式报告相对变化，\n$$\\Delta = \\frac{|Q_i^{\\mathrm{fine}} - Q_i^{\\mathrm{coarse}}|}{|Q_i^{\\mathrm{fine}}|},$$\n不带百分号。同时使用准则 $\\Delta  0.02$ 评估是否达到收敛。\n\n最终输出规范。您的程序应生成单行输出，其中包含一个以逗号分隔的列表，用方括号括起来，按以下顺序排列结果：\n- 案例 A、B、C、D 的四个相对变化，随后是\n- 案例 A、B、C、D 的四个收敛性布尔指标（True 或 False），使用阈值 $0.02$。\n\n例如，输出必须是以下形式\n$$[\\Delta_A,\\Delta_B,\\Delta_C,\\Delta_D,\\mathrm{conv}_A,\\mathrm{conv}_B,\\mathrm{conv}_C,\\mathrm{conv}_D].$$\n所有输出均为无量纲数或布尔值；不需要物理单位。未使用角度；螺距角变量 $\\lambda$ 是在 $[0,1]$ 上的无量纲量。\n\n注意。不得在问题陈述中插入任何关于热通量的捷径公式。您必须从上述基础和假设出发，推导出静电和电磁贡献的可用的准线性表达式，然后用指定的测试套件进行数值实现。",
            "solution": "用户提供了一个有效且适定的计算等离子体物理问题。本回应将首先详细推导离子热通量的表达式，然后给出数值实现。\n\n### 问题验证\n\n问题陈述已经过验证，被认为是**有效的**。\n- **已知条件**：所有必需的物理参数、谱的函数形式、数值方法和测试案例定义均已明确提供。\n- **科学依据**：该问题基于用于模拟等离子体微观湍流的标准且成熟的回旋动理学（GK）框架。准线性热通量、$\\boldsymbol{E}\\times\\boldsymbol{B}$ 和磁涨落输运以及ITG湍流等概念都是聚变等离子体物理学的基础。\n- **适定性与客观性**：该问题明确、客观，其结构导致每个测试案例都有唯一的数值解。\n\n### 准线性离子热通量的推导\n\n目标是推导总离子热通量 $Q_i$ 的表达式，它是其静电（$Q_{i,ES}$）和电磁（$Q_{i,EM}$）分量的总和。\n\n**1. 基础定义**\n\n径向离子热通量 $Q_i$ 是热通量矢量 $\\boldsymbol{q}_i$ 的径向分量，定义为离子分布函数的三阶矩。在湍流等离子体中，这被计算为涨落的能量密度与涨落的径向速度之间的统计关联：\n$$ Q_i = \\left\\langle \\int d^3v \\left(\\frac{1}{2}m_i v^2\\right) \\delta v_r \\delta f_i \\right\\rangle $$\n其中 $\\delta f_i$ 是离子分布函数的涨落部分，$\\delta v_r$ 是单个粒子速度的涨落径向分量，$\\langle\\dots\\rangle$ 表示磁通面平均，在均匀平板模型中这变为空间平均。在傅里叶空间中，对于两个涨落量 $A$ 和 $B$，此平均为 $\\langle AB \\rangle = \\sum_{\\boldsymbol{k}} \\Re\\{ A_{\\boldsymbol{k}} B_{\\boldsymbol{k}}^* \\}$。\n\n该问题以无量纲回旋动理学单位提出，其中长度以离子拉莫尔半径 $\\rho_i$ 归一化，速度以离子热速度 $v_{\\mathrm{th},i}$ 归一化，势以 $T_i/e$ 归一化，能量 $\\varepsilon = v^2/2$。径向漂移速度涨落 $\\delta v_r$ 有两个主要分量：\n1.  **$\\boldsymbol{E}\\times\\boldsymbol{B}$ 漂移**：$\\delta v_{E,r} = -i k_y \\phi$，其中 $\\phi$ 是静电势，我们将副法线方向与 $y$ 对齐。\n2.  **磁涨落漂移**：$\\delta v_{B,r} = v_{\\parallel} \\delta b_r = v_{\\parallel} (i k_y A_{\\parallel})$，其中 $A_{\\parallel}$ 是矢势的平行分量，$v_{\\parallel}$ 是平行速度。\n\n总径向速度涨落为 $\\delta v_{r,\\boldsymbol{k}} = -i k_y \\phi_{\\boldsymbol{k}} + i k_y v_{\\parallel} A_{\\parallel,\\boldsymbol{k}}$。\n\n在回旋动理学框架中，涨落分布函数 $\\delta f_i$ 由其非绝热部分 $h_i$ 给出，因为绝热部分对净输运没有贡献。因此，$\\delta f_i \\to h_i$。\n\n**2. 准线性近似**\n\n在准线性近似中，净通量是每个模式 $\\boldsymbol{k}$ 贡献的总和。决定净输运的涨落场与分布函数响应之间的相位关系由线性模式特性规定。问题提供了一个简化的交叉相位因子 $\\mathcal{C}_{\\boldsymbol{k}} = \\frac{\\gamma_{\\boldsymbol{k}}}{\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2}$，其中 $\\gamma_{\\boldsymbol{k}}$ 是模式增长率，$\\omega_{\\boldsymbol{k}}$ 是实频率。该因子包含了导致输运的等离子体响应的耗散部分。\n\n单个模式 $\\boldsymbol{k}$ 的热通量由下式给出：\n$$ Q_{i,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, \\delta v_{r,\\boldsymbol{k}}^* \\, h_{i,\\boldsymbol{k}} \\right\\} $$\n我们现在可以将其分为静电和电磁贡献。\n\n**3. 静电热通量 ($Q_{i,ES}$)**\n\n静电分量源于 $\\boldsymbol{E}\\times\\boldsymbol{B}$ 漂移。\n$$ Q_{i,ES,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, (-i k_y \\phi_{\\boldsymbol{k}})^* \\, h_{i,\\boldsymbol{k}}^{ES} \\right\\} $$\n其中 $h_{i,\\boldsymbol{k}}^{ES}$ 是由静电势驱动的分布函数响应部分。在回旋动理学中，粒子响应于回旋平均势 $J_0(k_{\\perp} v_{\\perp}) \\phi_{\\boldsymbol{k}}$，其中 $J_0$ 是零阶贝塞尔函数。由此产生的分布函数微扰为 $h_{i,\\boldsymbol{k}}^{ES} \\propto J_0(k_{\\perp} v_{\\perp}) \\phi_{\\boldsymbol{k}}$。此相互作用的准线性通量表达式涉及驱动场的平方和响应函数。根据问题陈述的指导，谱因子为 $k_y^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$。使用平板近似 $k_y \\approx k_{\\perp}$，这变为 $k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$。\n\n被积函数由能量 $\\varepsilon$ 和回旋平均因子的平方 $J_0^2$ 加权。对所有模式求和后，静电热通量的完整表达式为：\n$$ Q_{i,ES} = \\sum_{\\boldsymbol{k}} k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} \\left\\langle \\varepsilon J_0^2(k_{\\perp} v_{\\perp}) \\right\\rangle_v $$\n符号 $\\langle \\dots \\rangle_v$ 代表速度空间积分。问题指定的求积法意味着该积分定义为：\n$$ \\langle F(\\varepsilon, \\lambda) \\rangle_v \\equiv \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} F(\\varepsilon, \\lambda) $$\n其中 $\\varepsilon = v^2/2$，$\\lambda = v_{\\perp}^2/v^2$，因此 $v_{\\perp} = \\sqrt{2\\varepsilon\\lambda}$。\n因此，ES 通量的速度空间积分为：\n$$ V_{ES}(k_\\perp) = \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} \\, \\varepsilon \\, J_0^2(k_{\\perp} \\sqrt{2\\varepsilon\\lambda}) $$\n总 ES 通量则为：\n$$ Q_{i,ES} = \\int d\\boldsymbol{k} \\, k_{\\perp}^2 |\\phi_{\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} V_{ES}(k_\\perp) $$\n\n**4. 电磁热通量 ($Q_{i,EM}$)**\n\n电磁分量源于磁涨落输运通道。\n$$ Q_{i,EM,\\boldsymbol{k}} = \\Re\\left\\{ \\int d^3v \\, \\varepsilon \\, (i k_y v_{\\parallel} A_{\\parallel,\\boldsymbol{k}})^* \\, h_{i,\\boldsymbol{k}}^{EM} \\right\\} $$\n此处，$h_{i,\\boldsymbol{k}}^{EM}$ 是分布函数对回旋动理学势的电磁部分的响应，该部分与 $v_\\parallel J_0(k_\\perp v_\\perp) A_{\\parallel, \\boldsymbol{k}}$ 成正比。由此产生的准线性通量涉及该驱动的平方，因此包含因子 $v_\\parallel^2$ 和 $J_0^2$。\n\n问题陈述指出，EM 被积函数由“平行能量” $\\varepsilon(1-\\lambda)$ 加权，在我们的归一化单位中即为 $v_\\parallel^2/2$。这与漂移和 GK 驱动中的 $v_\\parallel$ 因子一致。谱因子被给出为 $k_{\\perp}^2 |A_{\\parallel, \\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}}$，同样使用了 $k_y \\approx k_{\\perp}$。速度空间积分为：\n$$ V_{EM}(k_\\perp) = \\int_0^\\infty d\\varepsilon \\int_0^1 d\\lambda \\, e^{-\\varepsilon} \\, \\varepsilon(1-\\lambda) \\, J_0^2(k_{\\perp} \\sqrt{2\\varepsilon\\lambda}) $$\n总 EM 通量为：\n$$ Q_{i,EM} = \\int d\\boldsymbol{k} \\, k_{\\perp}^2 |A_{\\parallel,\\boldsymbol{k}}|^2 \\mathcal{C}_{\\boldsymbol{k}} V_{EM}(k_\\perp) $$\n\n**5. 用于实现的最终表达式**\n\n总离子热通量 $Q_i = Q_{i,ES} + Q_{i,EM}$ 通过将 $\\boldsymbol{k}$ 空间上的积分离散化为网格上的求和来计算：\n$$ Q_i \\approx \\sum_{i,j} \\left( k_{\\perp,i}^2 |\\phi_{\\boldsymbol{k}_{ij}}|^2 \\mathcal{C}_{\\boldsymbol{k}_{ij}} V_{ES}(k_{\\perp,i}) + k_{\\perp,i}^2 |A_{\\parallel,\\boldsymbol{k}_{ij}}|^2 \\mathcal{C}_{\\boldsymbol{k}_{ij}} V_{EM}(k_{\\perp,i}) \\right) \\Delta k_{\\perp} \\Delta k_{\\parallel} $$\n谱函数 $|\\phi_{\\boldsymbol{k}}|^2$、$|A_{\\parallel, \\boldsymbol{k}}|^2$ 和 $\\mathcal{C}_{\\boldsymbol{k}}$ 使用提供的模型在网格上进行评估：\n- $|\\phi_{\\boldsymbol{k}}|^2 = \\phi_0^2 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\left(\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right)^{c}\\right]$\n- $|A_{\\parallel,\\boldsymbol{k}}|^2 = \\left(\\frac{\\beta}{2+\\beta}\\right)^2 \\left(\\frac{k_{\\parallel}}{k_{\\perp} + \\delta}\\right)^2 |\\phi_{\\boldsymbol{k}}|^2$\n- $\\mathcal{C}_{\\boldsymbol{k}} = \\gamma_{\\boldsymbol{k}} / (\\omega_{\\boldsymbol{k}}^2 + \\gamma_{\\boldsymbol{k}}^2)$，其中 $\\omega_{\\boldsymbol{k}} = \\omega_{*0} \\frac{k_{\\perp}}{1+(k_{\\perp}/k_0)^2}$ 且 $\\gamma_{\\boldsymbol{k}} = \\gamma_0 \\left(\\frac{k_{\\perp}}{k_0}\\right)^{a} \\exp\\!\\left[-\\left(\\frac{k_{\\perp}}{k_0}\\right)^{b}\\right] \\exp\\!\\left[-\\frac{|k_{\\parallel}|}{k_{\\parallel,0}}\\right]$。\n\n速度积分 $V_{ES}$ 和 $V_{EM}$ 使用高斯-拉盖尔求积法对 $\\varepsilon$ 积分（权重为 $e^{-\\varepsilon}$）和高斯-勒让德求积法对 $\\lambda$ 在 $[0,1]$ 上的积分进行数值计算。这个推导出的结构构成了以下程序的基础。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef calculate_Qi(beta, b, N_k_perp, N_k_para, N_eps, N_lambda,\n                 phi0, k0, a, c, k_para_0, omega_star_0, gamma0, delta,\n                 k_perp_min, k_perp_max, k_para_max):\n    \"\"\"\n    Computes the total dimensionless ion heat flux Q_i based on the provided\n    gyrokinetic model.\n    \"\"\"\n    # 1. Setup Grids and Quadrature Points/Weights\n    # Velocity space grids\n    eps_p, w_eps = special.roots_laguerre(N_eps)\n    x_leg, w_leg = special.roots_legendre(N_lambda)\n    lambda_q = (x_leg + 1.0) / 2.0\n    w_lambda = w_leg / 2.0\n\n    # Wavenumber space grids\n    k_perp_grid = np.linspace(k_perp_min, k_perp_max, N_k_perp)\n    dk_perp = (k_perp_max - k_perp_min) / (N_k_perp - 1) if N_k_perp > 1 else 0.0\n\n    k_para_grid = np.linspace(-k_para_max, k_para_max, N_k_para)\n    dk_para = (2.0 * k_para_max) / (N_k_para - 1) if N_k_para > 1 else 0.0\n\n    # 2. Pre-calculate Velocity-Space Integrals V_ES and V_EM\n    # These integrals, V_ES(k_perp) and V_EM(k_perp), depend only on k_perp.\n    V_ES = np.zeros(N_k_perp)\n    V_EM = np.zeros(N_k_perp)\n    \n    # Create 2D grids for vectorized quadrature\n    eps_grid, lambda_grid = np.meshgrid(eps_p, lambda_q, indexing='ij')\n    w_grid = np.outer(w_eps, w_lambda)\n\n    for i, k_perp in enumerate(k_perp_grid):\n        arg_J0 = k_perp * np.sqrt(2.0 * eps_grid * lambda_grid)\n        J0_sq = special.j0(arg_J0)**2\n        \n        integrand_ES_v = eps_grid * J0_sq\n        integrand_EM_v = eps_grid * (1.0 - lambda_grid) * J0_sq\n        \n        V_ES[i] = np.sum(w_grid * integrand_ES_v)\n        V_EM[i] = np.sum(w_grid * integrand_EM_v)\n\n    # 3. Sum contributions over the k-space grid\n    total_Qi = 0.0\n    alpha_beta = beta / (2.0 + beta)\n\n    # Vectorize k_para grid calculations for efficiency\n    k_para_abs = np.abs(k_para_grid)\n    k_para_norm = k_para_abs / k_para_0\n    k_para_factor_on_grid = np.exp(-(k_para_norm**c))\n\n    # Loop over the k_perp grid\n    for i, k_perp in enumerate(k_perp_grid):\n        k_perp_norm = k_perp / k0\n        \n        # This factor is part of both phi^2 and gamma\n        k_perp_factor = (k_perp_norm**a) * np.exp(-(k_perp_norm**b))\n        \n        # Calculate spectral quantities over the k_para grid for the current k_perp\n        phi_k_sq_perp_part = phi0**2 * k_perp_factor\n        gamma_k_perp_part = gamma0 * k_perp_factor\n        \n        phi_k_sq = phi_k_sq_perp_part * k_para_factor_on_grid\n        gamma_k = gamma_k_perp_part * k_para_factor_on_grid\n        \n        omega_k_val = omega_star_0 * k_perp / (1.0 + (k_perp / k0)**2)\n        \n        # Calculate the cross-phase factor C_k\n        C_k = gamma_k / (omega_k_val**2 + gamma_k**2)\n        \n        # Electrostatic flux contribution at this k_perp, summed over k_para\n        Qi_ES_sum_over_kpara = np.sum(phi_k_sq * C_k)\n        \n        # Electromagnetic flux contribution at this k_perp, summed over k_para\n        A_para_factor_sq = (alpha_beta * k_para_grid / (k_perp + delta))**2\n        A_para_k_sq = A_para_factor_sq * phi_k_sq\n        Qi_EM_sum_over_kpara = np.sum(A_para_k_sq * C_k)\n\n        # Sum ES and EM contributions for current k_perp, weighting by velocity integrals\n        Qi_at_k_perp = k_perp**2 * (Qi_ES_sum_over_kpara * V_ES[i] + \\\n                                   Qi_EM_sum_over_kpara * V_EM[i])\n        \n        total_Qi += Qi_at_k_perp\n\n    # Final multiplication by grid cell measures\n    total_Qi *= dk_perp * dk_para\n    \n    return total_Qi\n\ndef solve():\n    \"\"\"\n    Main function to run the resolution study for the four test cases.\n    \"\"\"\n    # Define fixed physical and spectral parameters\n    fixed_params = {\n        'phi0': 1.0, 'k0': 0.3, 'a': 1.0, 'c': 1.0,\n        'k_para_0': 0.3, 'omega_star_0': 1.0, 'gamma0': 0.2,\n        'delta': 1e-12, 'k_perp_min': 0.05, 'k_perp_max': 2.0,\n        'k_para_max': 1.0\n    }\n\n    # Define the four test cases as specified in the problem\n    test_cases = [\n        # Case A: k_parallel convergence at moderate beta\n        {'case_params': {'beta': 0.03, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 96, 'N_k_para': 24, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n        # Case B: k_perpendicular convergence at moderate beta\n        {'case_params': {'beta': 0.05, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 24, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n        # Case C: velocity-space convergence at higher moderate beta\n        {'case_params': {'beta': 0.08, 'b': 2.0},\n         'coarse_res': {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 24, 'N_lambda': 24},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 96, 'N_lambda': 96}},\n        # Case D: edge case, nearly ES, steeper k_perp spectrum\n        {'case_params': {'beta': 0.005, 'b': 6.0},\n         'coarse_res': {'N_k_perp': 24, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80},\n         'fine_res':   {'N_k_perp': 96, 'N_k_para': 96, 'N_eps': 80, 'N_lambda': 80}},\n    ]\n\n    results_delta = []\n    results_conv = []\n    convergence_threshold = 0.02\n    \n    for case in test_cases:\n        params_coarse = {**fixed_params, **case['case_params'], **case['coarse_res']}\n        params_fine = {**fixed_params, **case['case_params'], **case['fine_res']}\n        \n        Q_coarse = calculate_Qi(**params_coarse)\n        Q_fine = calculate_Qi(**params_fine)\n        \n        # Calculate relative change, handle Q_fine == 0 case\n        if Q_fine == 0:\n            delta = 0.0 if Q_coarse == 0 else 1.0\n        else:\n            delta = np.abs(Q_fine - Q_coarse) / np.abs(Q_fine)\n            \n        converged = delta  convergence_threshold\n        \n        results_delta.append(delta)\n        results_conv.append(converged)\n\n    final_results = results_delta + results_conv\n    \n    # Format the print output exactly as required\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}