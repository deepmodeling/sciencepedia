{
    "hands_on_practices": [
        {
            "introduction": "The engine driving energetic particle instabilities is the resonant transfer of energy from the particles to a plasma wave. This practice demystifies this core mechanism by guiding you through the calculation of a Toroidal Alfvén Eigenmode (TAE) growth rate from first principles. By implementing and comparing a numerical marker-based scheme against an exact analytic solution, you will gain tangible insight into how the abstract concept of Landau resonance is realized and verified in modern simulation codes .",
            "id": "3972647",
            "problem": "Consider a reduced one-dimensional linear gyrokinetic model for the drive of a Toroidal Alfvén Eigenmode (TAE) by a marker-represented fast-ion species under the drift-kinetic approximation in a slab, constant magnetic field configuration. The goal is to compute the energetic particle contribution to the TAE growth rate using two approaches: (i) an analytic resonance integral based on the singular Landau resonance and (ii) a marker-based numerical quadrature that approximates the resonance using a normalized Gaussian representation of the Dirac delta function.\n\nStart from the time-linearized Vlasov equation for the fast-ion species, coupled to a shear-Alfvén perturbation with parallel wave number $k_{\\parallel}$, frequency $\\omega$, and perpendicular wave number $k_{\\perp}$. In the drift-kinetic and low-frequency limit for passing particles, the resonant energy exchange arises from the parallel motion resonance condition $\\omega - k_{\\parallel} v_{\\parallel} = 0$. The imaginary part of the species susceptibility is obtained from the singular part of the response operator, which is proportional to $\\delta(\\omega - k_{\\parallel} v_{\\parallel})$. In a simplified model that factors the perpendicular gyroaverage into a scalar form factor, the fast-ion drive contribution to the growth rate can be reduced to a one-dimensional integral over the parallel velocity.\n\nAssume the following modeling choices and normalizations:\n- The fast-ion equilibrium distribution function is a shifted one-dimensional Gaussian in parallel velocity:\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right),\n$$\nwith thermal speed $v_{\\mathrm{th}}$ and beam shift $v_0$.\n- The coupling of the fast ions to the mode is represented by a scalar constant $C$ and a finite Larmor radius gyroaverage factor\n$$\n\\Gamma_0(b) = I_0(b) e^{-b}, \\quad b = \\frac{(k_{\\perp} \\rho)^2}{2},\n$$\nwhere $I_0$ is the modified Bessel function of the first kind of order zero and $\\rho$ is the fast-ion gyroradius. Treat $\\rho$ as absorbed into the parameter $k_{\\perp} \\rho$ so that $b$ is directly given by the input.\n- The growth rate contribution from the fast ions is modeled as the resonant Landau term\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv,\n$$\nwhere $k \\equiv k_{\\parallel}$ and the integration domain $[v_{\\min}, v_{\\max}]$ bounds the marker velocity space. Using the property of the Dirac delta under variable transformation, the analytic expression becomes\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} = \\frac{C \\, \\Gamma_0(b)}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right)\\bigg|_{v = v_{\\mathrm{res}}}, \\quad v_{\\mathrm{res}} = \\frac{\\omega}{k},\n$$\nprovided $v_{\\mathrm{res}} \\in [v_{\\min}, v_{\\max}]$, and zero otherwise.\n\nImplement a linear gyrokinetic solver that approximates the integral for $\\gamma_{\\mathrm{EP}}$ using $N$ velocity markers uniformly distributed over $[v_{\\min}, v_{\\max}]$ and a normalized Gaussian representation of the Dirac delta function:\n$$\n\\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right),\n$$\nwith a small width $\\sigma$. The marker-based estimate is\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\, \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v,\n$$\nwith uniform spacing $\\Delta v = \\frac{v_{\\max} - v_{\\min}}{N}$ and $v_j = v_{\\min} + \\left(j - \\frac{1}{2}\\right)\\Delta v$.\n\nYour task is to:\n1. Derive the analytic expression for $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ from the linearized gyrokinetic response using the resonance condition and properties of the Dirac delta function, clearly stating all assumptions.\n2. Implement a program that computes both $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ and $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$ for each test case and returns the absolute difference $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$ as a float.\n3. Use dimensionless normalized units throughout; no physical units are required.\n4. Use the modified Bessel function $I_0(b)$ to compute $\\Gamma_0(b)$.\n\nThe test suite consists of the following parameter sets, chosen to exercise different facets of the computation:\n- Case 1 (resonant peak, moderate finite Larmor radius): $v_0 = 1.5$, $v_{\\mathrm{th}} = 0.4$, $\\omega = 0.8$, $k = 0.5$, $k_{\\perp}\\rho = 0.5$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 2 (far-tail resonance, small drive): $v_0 = 1.0$, $v_{\\mathrm{th}} = 0.3$, $\\omega = 2.0$, $k = 0.5$, $k_{\\perp}\\rho = 0.3$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 3 (strong finite Larmor radius attenuation): $v_0 = 1.5$, $v_{\\mathrm{th}} = 0.6$, $\\omega = 0.3$, $k = 0.3$, $k_{\\perp}\\rho = 1.8$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 4 (boundary resonance at the upper limit): $v_0 = 2.0$, $v_{\\mathrm{th}} = 0.5$, $\\omega = 2.5$, $k = 0.5$, $k_{\\perp}\\rho = 0.7$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be the absolute difference between the marker-based estimate and the analytic value for the corresponding test case, represented as a float in dimensionless units.",
            "solution": "The problem statement has been validated as scientifically grounded, well-posed, and objective. It presents a standard exercise in computational plasma physics, specifically concerning the calculation of wave growth rates driven by energetic particles in a simplified gyrokinetic model. All necessary parameters and definitions are provided, and there are no internal contradictions or violations of physical principles within the context of the model.\n\nThe task is to compute the energetic particle contribution to the growth rate of a Toroidal Alfvén Eigenmode (TAE), denoted $\\gamma_{\\mathrm{EP}}$, using two distinct methods: a direct analytic evaluation and a numerical approximation based on a marker distribution. We will then quantify the difference between these two approaches.\n\nFirst, we derive the analytic expression for the growth rate, $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$. The starting point is the provided integral expression, which models the resonant energy exchange between the fast ions and the wave:\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv\n$$\nHere, $C$ is a coupling constant, $f_0(v)$ is the fast-ion equilibrium distribution function in parallel velocity $v$, $\\omega$ and $k$ are the wave frequency and parallel wavenumber, respectively, and $\\Gamma_0(b)$ is a gyroaverage factor accounting for finite Larmor radius (FLR) effects. The integral is evaluated over the parallel velocity space populated by numerical markers, from $v_{\\min}$ to $v_{\\max}$. The Dirac delta function, $\\delta(\\omega - k v)$, enforces the Landau resonance condition, $v = \\omega/k$, selecting only particles moving with this specific parallel velocity to contribute to the resonant drive.\n\nTo evaluate this integral, we employ the sifting property of the Dirac delta function, specifically its behavior under a change of variables. For a function $g(v)$, the following identity holds:\n$$\n\\int \\delta(g(v)) \\, h(v) \\, dv = \\sum_{i} \\frac{h(v_i)}{|g'(v_i)|}\n$$\nwhere the sum is over all simple roots $v_i$ of $g(v)$ within the integration domain. In our case, $g(v) = \\omega - k v$, and $h(v) = -\\frac{\\partial f_0}{\\partial v}$. The only root is $v = \\omega/k$, which we define as the resonant velocity, $v_{\\mathrm{res}}$. The derivative is $g'(v) = -k$. Thus, the integral evaluates to:\n$$\n\\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv = \\frac{1}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\bigg|_{v=v_{\\mathrm{res}}}\n$$\nThis result is non-zero only if the resonant velocity $v_{\\mathrm{res}}$ falls within the integration domain, i.e., $v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max}$. Otherwise, the integral is zero.\n\nThe fast-ion distribution is a shifted Gaussian:\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\nIts derivative with respect to $v$ is found using the chain rule:\n$$\n\\frac{\\partial f_0}{\\partial v} = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\cdot \\left(-\\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\\right) = -f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\n$$\nThe term required for the growth rate is therefore:\n$$\n-\\frac{\\partial f_0}{\\partial v} = f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2} = \\frac{2(v - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\nThe term $\\partial f_0 / \\partial v$ is related to the gradient of the distribution function in velocity space, and its sign determines whether the wave is driven (growth) or damped.\n\nThe FLR effect is encapsulated by $\\Gamma_0(b) = I_0(b) e^{-b}$, where $b = (k_{\\perp} \\rho)^2/2$ and $I_0(b)$ is the modified Bessel function of the first kind of order zero.\n\nCombining these elements, the full analytic expression for the growth rate is:\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} =\n\\begin{cases}\n\\frac{C \\, \\Gamma_0(b)}{|k|} \\left[ \\frac{2(v_{\\mathrm{res}} - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v_{\\mathrm{res}} - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\right] & \\text{if } v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max} \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\nwith $v_{\\mathrm{res}} = \\omega/k$.\n\nNext, we formulate the numerical marker-based quadrature for the growth rate, $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$. This approach approximates the integral by a discrete sum over $N$ markers. The Dirac delta function, which is singular, is replaced by a regularized, normalized Gaussian function:\n$$\n\\delta(x) \\approx \\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right)\n$$\nwhere $\\sigma$ is a small width parameter. The integral is approximated as a Riemann sum using the midpoint rule over a uniform grid of $N$ markers. The velocity of the $j$-th marker is $v_j = v_{\\min} + (j - 1/2) \\Delta v$, with grid spacing $\\Delta v = (v_{\\max} - v_{\\min}) / N$.\n\nSubstituting these into the original integral for $\\gamma_{\\mathrm{EP}}$, we obtain the numerical estimate:\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v\n$$\nEach term in the sum is evaluated at the marker velocity $v_j$. The term $-\\frac{\\partial f_0}{\\partial v}(v_j)$ is computed using the expression derived earlier, and $\\delta_{\\sigma}(\\omega - k v_j)$ is computed using its Gaussian form.\n\nThe computational task is to implement both formulas for $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ and $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$ for the given test cases and calculate their absolute difference, $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$. This difference serves as a measure of the accuracy of the numerical approximation, which depends on the number of markers $N$ and the resolution parameter $\\sigma$. The provided parameters, with a large $N=200000$ and a small $\\sigma = 0.02$, are chosen to ensure the numerical result is a close approximation of the analytical one.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes and compares analytic and marker-based estimates for the energetic particle\n    contribution to the TAE growth rate in a simplified linear gyrokinetic model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Resonant peak, moderate FLR\n        {'v0': 1.5, 'v_th': 0.4, 'omega': 0.8, 'k': 0.5, 'k_perp_rho': 0.5, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 2: Far-tail resonance, small drive\n        {'v0': 1.0, 'v_th': 0.3, 'omega': 2.0, 'k': 0.5, 'k_perp_rho': 0.3, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 3: Strong FLR attenuation\n        {'v0': 1.5, 'v_th': 0.6, 'omega': 0.3, 'k': 0.3, 'k_perp_rho': 1.8, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 4: Boundary resonance\n        {'v0': 2.0, 'v_th': 0.5, 'omega': 2.5, 'k': 0.5, 'k_perp_rho': 0.7, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Extract parameters\n        v0, v_th, omega, k = params['v0'], params['v_th'], params['omega'], params['k']\n        k_perp_rho, C, sigma = params['k_perp_rho'], params['C'], params['sigma']\n        v_min, v_max, N = params['v_min'], params['v_max'], params['N']\n\n        # Shared calculations\n        b = (k_perp_rho**2) / 2.0\n        gamma0_b = i0(b) * np.exp(-b)\n\n        # --- Analytic Calculation (gamma_an) ---\n        v_res = omega / k\n        gamma_an = 0.0\n\n        if v_min = v_res = v_max:\n            # -df0/dv evaluated at v_res\n            term1 = 2.0 * (v_res - v0) / (np.sqrt(np.pi) * v_th**3)\n            term2 = np.exp(-((v_res - v0)**2) / v_th**2)\n            df0_dv_res = term1 * term2\n            \n            gamma_an = (C * gamma0_b / np.abs(k)) * df0_dv_res\n\n        # --- Marker-based Calculation (gamma_mc) ---\n        delta_v = (v_max - v_min) / N\n        v_j = v_min + (np.arange(N) + 0.5) * delta_v\n\n        # -df0/dv evaluated at each marker velocity v_j\n        term1_mc = 2.0 * (v_j - v0) / (np.sqrt(np.pi) * v_th**3)\n        term2_mc = np.exp(-((v_j - v0)**2) / v_th**2)\n        df0_dv_j = term1_mc * term2_mc\n\n        # Gaussian representation of delta function\n        delta_sigma = (1.0 / (np.sqrt(np.pi) * sigma)) * np.exp(-((omega - k * v_j)**2) / sigma**2)\n\n        # Summation over markers\n        integrand_sum = np.sum(df0_dv_j * delta_sigma * delta_v)\n        gamma_mc = C * gamma0_b * integrand_sum\n\n        # Calculate absolute difference\n        abs_diff = np.abs(gamma_mc - gamma_an)\n        results.append(abs_diff)\n        \n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building a robust simulation for energetic particle physics involves crucial design choices, particularly in how the kinetic particle population \"talks to\" the background fluid plasma. This exercise challenges you to analyze and compare two dominant paradigms: pressure-coupling and current-coupling schemes in hybrid models. By dissecting their conservation properties and physical applicability, you will develop the critical judgment needed to select and assess the right simulation tools for specific problems like Alfvén Eigenmodes and fishbones .",
            "id": "3972682",
            "problem": "Consider a hybrid kinetic–magnetohydrodynamic model of a toroidal plasma in which bulk ions and electrons are described by reduced magnetohydrodynamics (MHD), and energetic particles are evolved with a drift-kinetic equation. Two coupling strategies are commonly used: a pressure-coupling scheme and a current-coupling scheme. In the pressure-coupling scheme, the bulk momentum equation includes the divergence of the energetic particle pressure tensor, and Maxwell’s equations are closed with the bulk current. In the current-coupling scheme, the total current entering Ampère’s law includes the energetic particle current, and the bulk momentum equation does not explicitly include the energetic particle pressure tensor. Assume a low-frequency ordering with $\\omega / \\Omega_{ci} \\ll 1$, negligible displacement current, and ideal Ohm’s law for the bulk plasma.\n\nLet the bulk obey\n$$\n\\rho \\frac{d \\mathbf{v}}{dt} = - \\nabla p + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} + \\nabla \\cdot \\mathbf{P}_h \\quad \\text{(pressure-coupling)},\n$$\nor\n$$\n\\rho \\frac{d \\mathbf{v}}{dt} = - \\nabla p + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} \\quad \\text{(current-coupling)},\n$$\nwith $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\mathbf{0}$ and $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$, where $\\mathbf{J}$ is the total current that may or may not include the energetic particle current $\\mathbf{J}_h$ depending on the scheme. The energetic particle distribution function $f_h(\\mathbf{R}, v_\\parallel, \\mu, t)$ evolves according to a drift-kinetic equation consistent with the same ordering, yielding moments such as the energetic particle pressure tensor $\\mathbf{P}_h$ and current $\\mathbf{J}_h$.\n\nStarting from the Poynting theorem, the bulk kinetic energy equation, and the drift-kinetic energy moment of the energetic particles, derive the global energy transfer channels for each coupling strategy and identify conditions under which the total quadratic energy (magnetic plus bulk kinetic plus energetic particle energy, plus any required internal energy terms consistent with the ordering) is conserved in the ideal, collisionless limit. Use these results, together with the characteristic physics of shear Alfvén waves with frequency $\\omega \\sim k_\\parallel v_A$ and energetic particle driven internal kink modes (fishbones) at low toroidal mode number, to assess the following statements about advantages and limitations of pressure-coupling versus current-coupling in hybrid simulations of Alfvén Eigenmodes (AE) — including the Toroidal Alfvén Eigenmode (TAE) — and fishbones. Here $v_A$ is the Alfvén speed, $k_\\parallel$ is the parallel wavenumber, and $\\rho_h$ is the energetic particle Larmor radius.\n\nWhich of the following statements are correct?\n\nA. Under the low-frequency ordering with ideal Ohm’s law and an incompressible bulk closure, the pressure-coupling scheme yields a conserved quadratic energy invariant provided $\\mathbf{P}_h$ is computed from a drift-kinetic model consistent with $\\omega / \\Omega_{ci} \\ll 1$ and $k_\\perp \\rho_h \\lesssim 1$, so that the exchange term $\\int \\mathbf{v} \\cdot (\\nabla \\cdot \\mathbf{P}_h)\\, d^3x$ exactly balances the energetic particle energy change via $- \\int \\mathbf{P}_h : \\nabla \\mathbf{v}\\, d^3x$.\n\nB. For shear Alfvénic dynamics such as the Toroidal Alfvén Eigenmode with $\\omega \\sim k_\\parallel v_A$ and finite $k_\\perp \\rho_h$, the current-coupling scheme is generally preferred because it represents the energetic particle current response (including polarization and parallel current) directly through $\\int \\mathbf{J}_h \\cdot \\mathbf{E}\\, d^3x$, which is gauge-invariant, and avoids spurious non-solenoidal forces that can arise from truncated anisotropic $\\mathbf{P}_h$ closures.\n\nC. The pressure-coupling scheme is fundamentally incompatible with simulating energetic particle driven internal kink (fishbone) modes because the instability drive enters only through an energetic particle parallel current and not through the pressure tensor.\n\nD. The current-coupling scheme can be numerically stiffer at large $k_\\perp \\rho_h$ due to rapid energetic particle polarization current response, introducing fast time scales into $\\mathbf{J}_h$ that often necessitate implicit or sub-cycling strategies to stably integrate Alfvénic dynamics.\n\nE. In pressure-coupling, the inclusion of $\\nabla \\cdot \\mathbf{P}_h$ suppresses the continuum damping of shear Alfvén waves because the energetic particle pressure tensor always cancels the bulk MHD Reynolds stress contribution to the energy balance.\n\nSelect all correct options.",
            "solution": "The problem requires an analysis of two common coupling strategies in hybrid kinetic-MHD simulations, pressure-coupling and current-coupling, to assess their properties concerning energy conservation and their applicability to simulating specific energetic particle (EP) driven instabilities like Alfvén Eigenmodes (AE) and fishbones.\n\nFirst, we must validate the problem statement.\n\n### Step 1: Extract Givens\n- **Model:** Hybrid kinetic-magnetohydrodynamic model for a toroidal plasma.\n- **Components:**\n    - Bulk plasma (ions and electrons) described by reduced magnetohydrodynamics (MHD).\n    - Energetic particles (EPs) described by a drift-kinetic equation.\n- **Coupling Schemes:**\n    - **Pressure-coupling (P-C):** The bulk momentum equation is $$ \\rho \\frac{d \\mathbf{v}}{dt} = - \\nabla p + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} + \\nabla \\cdot \\mathbf{P}_h $$. Maxwell's equations are closed with the bulk current.\n    - **Current-coupling (C-C):** The bulk momentum equation is $$ \\rho \\frac{d \\mathbf{v}}{dt} = - \\nabla p + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} $$. The total current in Ampère's law includes the EP current, $\\mathbf{J}_h$.\n- **Assumptions:**\n    - Low-frequency ordering: $\\omega / \\Omega_{ci} \\ll 1$.\n    - Negligible displacement current: $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$.\n    - Ideal Ohm's law for the bulk plasma: $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\mathbf{0}$.\n- **Definitions:** $\\rho$ (bulk mass density), $\\mathbf{v}$ (bulk fluid velocity), $p$ (bulk thermal pressure), $\\mathbf{B}$ (magnetic field), $\\mu_0$ (vacuum permeability), $\\mathbf{P}_h$ (EP pressure tensor), $\\mathbf{J}$ (total current), $\\mathbf{J}_h$ (EP current), $f_h$ (EP distribution function), $\\Omega_{ci}$ (bulk ion cyclotron frequency).\n- **Phenomena to assess:** Shear Alfvén waves ($\\omega \\sim k_\\parallel v_A$), Toroidal Alfvén Eigenmodes (TAE), and fishbones.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard and very active area of research in computational fusion science.\n- **Scientifically Grounded:** The hybrid kinetic-MHD model is a cornerstone of modern fusion plasma simulation. Both pressure-coupling and current-coupling schemes are well-established, physically-motivated, and documented in peer-reviewed literature. The drift-kinetic equation is the appropriate low-frequency model for the energetic particles. The phenomena mentioned (TAEs, fishbones) are critical topics in this field. The problem is firmly grounded in established plasma physics principles.\n- **Well-Posed:** The problem provides the governing equations for the two schemes and asks for a derivation of energy balance and an assessment of their properties. This is a well-defined task with a unique, meaningful path to a solution based on first-principles analysis.\n- **Objective:** The language is technical and precise, free from subjective or ambiguous wording.\n- **Incomplete or Contradictory Setup:** The problem provides a clear, self-contained setup. While the written equations could be interpreted in slightly different ways depending on implicit definitions, the context provided by standard plasma physics literature allows for a consistent interpretation. For instance, in the current-coupling scheme, the force on the bulk fluid should be due to the bulk current, not the total current. This standard interpretation, $\\rho \\frac{d\\mathbf{v}}{dt} = \\dots + (\\mathbf{J}_{total} - \\mathbf{J}_h)\\times\\mathbf{B}$, is logically inferred and resolves any apparent inconsistency with the simplified expression given. The problem is sufficiently complete for the required analysis.\n- **Other Flaws:** The problem does not violate any other criteria for validity. It is neither trivial nor tautological and requires substantial domain knowledge to solve.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. We proceed to the derivation and analysis.\n\n### Derivation of Energy Conservation\n\nWe analyze the rate of change of the total energy of the system, which is the sum of the bulk plasma kinetic energy $\\mathcal{K}_{bulk}$, the magnetic field energy $\\mathcal{W}_B$, the energetic particle kinetic energy $\\mathcal{K}_h$, and the bulk plasma internal energy $\\mathcal{U}$.\n\n1.  **Magnetic Energy:** From Poynting's theorem with no displacement current, the rate of change of magnetic energy density is $\\frac{\\partial}{\\partial t}(\\frac{B^2}{2\\mu_0}) = -\\mathbf{E}\\cdot\\mathbf{J} - \\nabla\\cdot(\\frac{\\mathbf{E}\\times\\mathbf{B}}{\\mu_0})$. Integrating over volume and assuming surface terms vanish:\n    $$ \\frac{d\\mathcal{W}_B}{dt} = \\frac{d}{dt} \\int \\frac{B^2}{2\\mu_0} d^3x = - \\int \\mathbf{E} \\cdot \\mathbf{J}_{total} d^3x $$\n    where $\\mathbf{J}_{total} = \\frac{1}{\\mu_0}\\nabla\\times\\mathbf{B}$.\n\n2.  **Bulk Kinetic Energy:** The rate of change of bulk kinetic energy $\\mathcal{K}_{bulk} = \\int \\frac{1}{2}\\rho v^2 d^3x$ is found by taking the dot product of the bulk momentum equation with $\\mathbf{v}$. For an incompressible fluid ($\\nabla\\cdot\\mathbf{v}=0$), $\\mathbf{v}\\cdot(\\rho\\frac{d\\mathbf{v}}{dt}) = \\frac{d}{dt}(\\frac{1}{2}\\rho v^2) - \\frac{v^2}{2}(\\frac{\\partial\\rho}{\\partial t} + \\nabla\\cdot(\\rho\\mathbf{v}))$. Assuming mass conservation, the second part is zero.\n    $$ \\frac{d\\mathcal{K}_{bulk}}{dt} = \\int \\mathbf{v} \\cdot \\left( \\rho \\frac{d\\mathbf{v}}{dt} \\right) d^3x $$\n\n3.  **Energetic Particle Kinetic Energy:** The rate of change of the total kinetic energy of the energetic particles is the total power transferred from the electric field to the EPs:\n    $$ \\frac{d\\mathcal{K}_h}{dt} = \\int \\mathbf{J}_h \\cdot \\mathbf{E} \\, d^3x $$\n    This result is derived by taking the energy moment of the guiding-center or drift-kinetic equation.\n\n4.  **Bulk Internal Energy:** The evolution of the bulk internal energy depends on the closure (e.g., an adiabatic equation of state). The relevant term for the work-energy balance is $\\frac{d\\mathcal{U}}{dt} = \\int -p(\\nabla\\cdot\\mathbf{v}) - \\mathbf{v}\\cdot\\nabla p \\,d^3x + \\dots$. For an incompressible flow, this simplifies. The term $\\int -\\mathbf{v}\\cdot\\nabla p\\,d^3x$ will appear.\n\nWe now apply these principles to each coupling scheme, using the ideal Ohm's law $\\mathbf{E} = -\\mathbf{v} \\times \\mathbf{B}$.\n\n**Analysis of Pressure-Coupling Scheme**\n- Momentum equation: $\\rho \\frac{d \\mathbf{v}}{dt} = - \\nabla p + \\mathbf{J}_{bulk} \\times \\mathbf{B} + \\nabla \\cdot \\mathbf{P}_h$. Here, the problem states Ampère's law is closed with bulk current, so $\\frac{1}{\\mu_0}(\\nabla\\times\\mathbf{B}) = \\mathbf{J}_{bulk}$. However, the total current acted on by the electric field is $\\mathbf{J}_{total} = \\mathbf{J}_{bulk} + \\mathbf{J}_h$.\n- Rate of change of total energy $E_{total} = \\mathcal{K}_{bulk} + \\mathcal{W}_B + \\mathcal{K}_h + \\mathcal{U}$:\n$$ \\frac{dE_{total}}{dt} = \\int \\left[ \\mathbf{v} \\cdot (-\\nabla p + \\mathbf{J}_{bulk} \\times \\mathbf{B} + \\nabla \\cdot \\mathbf{P}_h) \\right] d^3x - \\int \\mathbf{E} \\cdot (\\mathbf{J}_{bulk} + \\mathbf{J}_h) d^3x + \\int \\mathbf{J}_h \\cdot \\mathbf{E} d^3x $$\n(We have absorbed the $\\mathbf{v}\\cdot\\nabla p$ term into the time derivative of $\\mathcal{U}$).\n- The terms $- \\int \\mathbf{E} \\cdot \\mathbf{J}_h d^3x$ and $+ \\int \\mathbf{J}_h \\cdot \\mathbf{E} d^3x$ cancel.\n- Using Ohm's Law, the Lorentz force work term is $\\mathbf{v} \\cdot (\\mathbf{J}_{bulk} \\times \\mathbf{B}) = \\mathbf{J}_{bulk} \\cdot (\\mathbf{B} \\times \\mathbf{v}) = \\mathbf{J}_{bulk} \\cdot \\mathbf{E}$. This cancels with the $- \\int \\mathbf{E} \\cdot \\mathbf{J}_{bulk} d^3x$ term.\n- The remaining term governing the change in total energy is the power exchange between the bulk fluid and the EPs: $\\int \\mathbf{v} \\cdot (\\nabla \\cdot \\mathbf{P}_h) d^3x$.\n- For total energy to be conserved, this term must be exactly balanced by the corresponding energy-exchange term appearing in the EP energy evolution equation. The power transferred from the fluid motion to the EPs is derived from the drift-kinetic equation and is given by $\\int \\mathbf{P}_h : \\nabla\\mathbf{v} \\, d^3x$.\n- Using integration by parts and assuming vanishing surface terms, $\\int \\mathbf{v} \\cdot (\\nabla \\cdot \\mathbf{P}_h) d^3x = - \\int \\mathbf{P}_h : \\nabla\\mathbf{v} d^3x$.\n- Thus, the two terms cancel perfectly if the kinetic and fluid models are self-consistent. This consistency is achieved when $\\mathbf{P}_h$ is derived from a kinetic model respecting the same low-frequency ($\\omega/\\Omega_{ci} \\ll 1$) and spatial-scale ($k_\\perp \\rho_h \\lesssim 1$) orderings as the fluid model.\n\n**Analysis of Current-Coupling Scheme**\n- The standard formulation (which we assume is intended) is:\n  Momentum: $\\rho \\frac{d\\mathbf{v}}{dt} = - \\nabla p + \\mathbf{J}_{bulk} \\times \\mathbf{B}$.\n  Ampère's Law: $\\nabla\\times\\mathbf{B} = \\mu_0(\\mathbf{J}_{bulk} + \\mathbf{J}_h)$.\nThis can be rewritten as $\\rho \\frac{d\\mathbf{v}}{dt} = - \\nabla p + (\\frac{1}{\\mu_0}\\nabla\\times\\mathbf{B} - \\mathbf{J}_h) \\times \\mathbf{B}$.\n- Rate of change of total energy:\n$$ \\frac{dE_{total}}{dt} = \\int \\left[ \\mathbf{v} \\cdot (-\\nabla p + (\\mathbf{J}_{total} - \\mathbf{J}_h) \\times \\mathbf{B}) \\right] d^3x - \\int \\mathbf{E} \\cdot \\mathbf{J}_{total} d^3x + \\int \\mathbf{J}_h \\cdot \\mathbf{E} d^3x $$\n- The Lorentz force work term is $\\mathbf{v} \\cdot ((\\mathbf{J}_{total} - \\mathbf{J}_h) \\times \\mathbf{B}) = (\\mathbf{J}_{total} - \\mathbf{J}_h) \\cdot (\\mathbf{B} \\times \\mathbf{v}) = (\\mathbf{J}_{total} - \\mathbf{J}_h) \\cdot \\mathbf{E} = \\mathbf{J}_{total}\\cdot\\mathbf{E} - \\mathbf{J}_h \\cdot \\mathbf{E}$.\n- Substituting this into the energy evolution equation:\n$$ \\frac{dE_{total}}{dt} = \\int \\left[ (\\mathbf{J}_{total}\\cdot\\mathbf{E} - \\mathbf{J}_h \\cdot \\mathbf{E}) - \\mathbf{E} \\cdot \\mathbf{J}_{total} + \\mathbf{J}_h \\cdot \\mathbf{E} \\right] d^3x = 0 $$\n- The total energy is exactly conserved in the ideal, collisionless limit without any further assumptions on the form of $\\mathbf{J}_h$.\n\n### Option-by-Option Analysis\n\n**A.Correct.** This statement accurately describes the condition for energy conservation in the pressure-coupling scheme. As derived above, conservation requires the power exerted by the EPs on the fluid, $\\int \\mathbf{v} \\cdot (\\nabla \\cdot \\mathbf{P}_h)\\, d^3x$, to be the exact negative of the power exerted by the fluid on the EPs. Via integration by parts, this means the EP power absorption must be $\\int \\mathbf{P}_h : \\nabla \\mathbf{v}\\, d^3x$. A drift-kinetic model consistent with the stated low-frequency and spatial-scale orderings ($\\omega/\\Omega_{ci} \\ll 1, k_\\perp \\rho_h \\lesssim 1$) is precisely what is required to construct such an energy-conserving or Hamiltonian coupling.\n\n**B. Correct.** For shear Alfvénic modes like TAEs, the dynamics are primarily transverse to the magnetic field. The current-coupling force term, $(\\frac{1}{\\mu_0}\\nabla\\times\\mathbf{B} - \\mathbf{J}_h) \\times \\mathbf{B}$, is manifestly perpendicular to $\\mathbf{B}$. This avoids driving spurious compressional modes, an issue that can arise in the P-C scheme if the computed pressure tensor $\\mathbf{P}_h$ is not perfectly accurate, leading to a non-solenoidal force $\\nabla \\cdot \\mathbf{P}_h$. Furthermore, the power exchange term $\\int \\mathbf{J}_h \\cdot \\mathbf{E}\\, d^3x$ is a fundamental and gauge-invariant expression for wave-particle energy transfer in kinetic theory, which can be a significant advantage over the $\\mathbf{P}_h : \\nabla\\mathbf{v}$ form, especially for phenomena with finite $k_\\perp \\rho_h$ where higher-order Larmor radius effects become important. Therefore, the C-C scheme is often considered more robust for these applications.\n\n**C. Incorrect.** The statement claims the P-C scheme is \"fundamentally incompatible\" with simulating fishbones. This is false. Fishbone instabilities are driven by the resonance between the $m=n=1$ internal kink mode and the precessional drift of trapped energetic particles. This resonant interaction can be captured by the EP pressure tensor $\\mathbf{P}_h$, which, if computed from an appropriate drift-kinetic model, contains all the necessary kinetic information, including the effects of precessional drift resonance. Numerous successful simulations of fishbones have been performed using pressure-coupling codes (e.g., M3D, M3D-C1). The assertion that the drive enters \"only through an energetic particle parallel current\" is also incorrect; the precessional drift is a perpendicular motion, and its resonance with the wave is the key driving mechanism.\n\n**D. Correct.** The energetic particle current $\\mathbf{J}_h$ contains the polarization current, $\\mathbf{J}_{pol}$, which is the response to a time-varying electric field. This current scales as $J_{pol} \\propto (k_\\perp \\rho_h)^2 \\omega$. At large values of $k_\\perp \\rho_h$, this term can become very large and introduce a high-frequency dynamic into the system, associated with ion Bernstein waves. For an explicit time-integration scheme, the time step must be small enough to resolve this fast timescale ($\\Delta t \\ll 1/\\omega_{fast}$), which may be much shorter than the Alfvénic timescale being studied. This disparity in timescales makes the system of equations \"numerically stiff,\" significantly increasing computational cost. This is a known numerical challenge for the C-C scheme, and mitigation strategies like implicit treatment of the polarization current or sub-cycling are often required.\n\n**E. Incorrect.** Continuum damping is a fundamental energy sink for shear Alfvén waves, arising from phase mixing at the spatial resonance where the mode frequency matches the local Alfvén continuum frequency, $\\omega = \\omega_A(r)$. The MHD Reynolds stress is an integral part of the fluid's inertial response that facilitates this process. The EP term $\\nabla \\cdot \\mathbf{P}_h$ acts as a source of free energy that *drives* the instability. For the mode to grow, this drive must overcome the continuum damping (and other damping mechanisms). The EP drive term competes with damping; it does not suppress the damping mechanism itself. The claim that the EP pressure tensor \"always cancels\" the Reynolds stress is physically unsubstantiated; these terms represent distinct physical processes and there is no general principle ensuring their cancellation.",
            "answer": "$$\\boxed{ABD}$$"
        },
        {
            "introduction": "A simulation is only as trustworthy as its implementation is correct, a principle rigorously addressed by code verification. This practice introduces the Method of Manufactured Solutions (MMS), a powerful technique for confirming that a numerical solver achieves its theoretical accuracy. By applying MMS to a model Alfvén Eigenmode problem, you will learn to quantitatively measure your code's convergence rate, a fundamental skill for building confidence in any computational physics result .",
            "id": "3972709",
            "problem": "You are asked to design and implement a verification test for a linear Alfvén Eigenmode (AE) solver using the method of manufactured solutions, and to quantify discretization error convergence in both frequency and damping rate. The solver acts on a scalar field $\\,\\phi(x)\\,$ defined on a one-dimensional periodic slab of length $\\,L\\,$. In non-dimensional units, the governing eigenvalue problem is\n$$\\left(-\\,v_A^2\\,\\frac{d^2}{dx^2} + i\\,\\sigma\\right)\\,\\phi(x) \\;=\\; \\omega^2\\,\\phi(x),$$\nwhere $\\,v_A\\,$ is the normalized Alfvén speed, $\\,\\sigma\\,$ is a constant that represents the net effect of energetic particle drive or damping, and $\\,\\omega\\,$ is the complex eigenfrequency. For a manufactured plane-wave solution $\\,\\phi_m(x) = e^{i k x}\\,$ with wavenumber $\\,k\\,$, the continuous symbol yields\n$$\\omega_{\\text{exact}}^2 \\;=\\; v_A^2\\,k^2 \\;+\\; i\\,\\sigma,$$\nand we take the principal branch of the square root so that\n$$\\omega_{\\text{exact}} \\;=\\; \\sqrt{v_A^2\\,k^2 \\;+\\; i\\,\\sigma}.$$\nDefine the frequency and damping rate as $\\,f := \\Re(\\omega)\\,$ and $\\,\\gamma := -\\Im(\\omega)\\,$, respectively.\n\nConsider a second-order central-difference discretization of $\\,\\frac{d^2}{dx^2}\\,$ on a uniform periodic grid with $\\,N\\,$ points and spacing $\\,h = L/N\\,$. Its discrete Fourier symbol for the Laplacian applied to $\\,e^{i k x}\\,$ is\n$$\\widehat{\\partial_{xx}}(k) \\;\\approx\\; -\\,\\frac{4}{h^2}\\,\\sin^2\\!\\left(\\frac{k h}{2}\\right).$$\nThus, the discrete manufactured eigenvalue problem evaluated on the mode $\\,e^{i k x}\\,$ implies\n$$\\omega_h^2 \\;=\\; v_A^2\\,\\widehat{k}_h^{\\,2} \\;+\\; i\\,\\sigma,\\quad\\text{where}\\quad \\widehat{k}_h \\;=\\; \\frac{2}{h}\\,\\sin\\!\\left(\\frac{k h}{2}\\right),$$\nand $\\,\\omega_h\\,$ is again the principal branch of the square root. Let $\\,f_h := \\Re(\\omega_h)\\,$ and $\\,\\gamma_h := -\\Im(\\omega_h)\\,$. For a fixed manufactured wavenumber $\\,k\\,$, compute the discretization errors $\\,|f_h - f|\\,$ and $\\,|\\gamma_h - \\gamma|\\,$ for a sequence of grid spacings $\\,h\\,$ and estimate the observed orders of convergence $\\,p_f\\,$ and $\\,p_\\gamma\\,$ by performing a least-squares linear regression of $\\,\\log(|\\text{error}|)\\,$ versus $\\,\\log(h)\\,$.\n\nYour task is to implement a self-contained program that:\n- For each test case listed below, generates the sequence of grid sizes $\\,N\\,$, computes $\\,h = L/N\\,$, constructs the manufactured wavenumber $\\,k\\,$ as specified, evaluates $\\,\\omega_{\\text{exact}}\\,$ and $\\,\\omega_h\\,$, forms $\\,f,\\,\\gamma,\\,f_h,\\,\\gamma_h\\,$, computes the errors $\\,|f_h - f|\\,$ and $\\,|\\gamma_h - \\gamma|\\,$, and fits a line to $\\,(\\log(h),\\log(\\text{error}))\\,$ to obtain the slopes $\\,p_f\\,$ and $\\,p_\\gamma\\,$.\n- Aggregates the results for all test cases into a single output line.\n\nAll quantities are non-dimensional, and angles are in radians. No external input is to be used. Use the following test suite:\n- Case $\\,1\\,$ (happy path plane wave): $\\,L = 2\\pi\\,$, $\\,v_A = 1\\,$, $\\,\\sigma = -10^{-3}\\,$, integer mode $\\,m = 3\\,$ with $\\,k = 2\\pi m / L\\,$, and $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$.\n- Case $\\,2\\,$ (fraction-of-Nyquist driven mode): $\\,L = 2\\pi\\,$, $\\,v_A = 0.8\\,$, $\\,\\sigma = +2\\times 10^{-3}\\,$, fraction $\\,q = 0.45\\,$ of the Nyquist wavenumber defined as follows: for each $\\,N\\,$, choose the integer mode $\\,m(N) = \\lfloor q\\,N/2 \\rfloor\\,$ and set $\\,k = 2\\pi\\,m(N)/L\\,$, with $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$.\n- Case $\\,3\\,$ (high-wavenumber near-Nyquist damped mode): $\\,L = 2\\pi\\,$, $\\,v_A = 1\\,$, $\\,\\sigma = -10^{-3}\\,$, fraction $\\,q = 0.90\\,$, with the same definition of $\\,m(N)\\,$ and $\\,k\\,$ as in Case $\\,2\\,$, and $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases $\\,1\\,$, $\\,2\\,$, $\\,3\\,$. Each case result must be a two-element list $\\,\\,[p_f,\\,p_\\gamma]\\,\\,$ of floating-point numbers. For example, a valid output format is $\\,[[p_{f,1},p_{\\gamma,1}],[p_{f,2},p_{\\gamma,2}],[p_{f,3},p_{\\gamma,3}]]\\,$.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, and objective. It presents a standard verification task from computational plasma physics, specifically the calculation of discretization error convergence for a simplified Alfvén Eigenmode solver using the method of manufactured solutions. All parameters and procedures are explicitly defined, allowing for a unique and verifiable solution.\n\nThe solution proceeds as follows. First, we establish the mathematical framework for the continuous and discrete systems. Then, we outline the numerical procedure to compute the convergence orders for the given test cases.\n\nThe governing equation is a one-dimensional Helmholtz-type eigenvalue problem for the scalar field $\\phi(x)$:\n$$\n\\left(-\\,v_A^2\\,\\frac{d^2}{dx^2} + i\\,\\sigma\\right)\\,\\phi(x) \\;=\\; \\omega^2\\,\\phi(x)\n$$\nwhere $v_A$ is the Alfvén speed, $\\sigma$ is a drive/damping parameter, and $\\omega$ is the complex eigenfrequency. The analysis is performed on a periodic domain of length $L$.\n\nFor a manufactured plane-wave solution $\\phi_m(x) = e^{i k x}$, the differential operator $\\frac{d^2}{dx^2}$ acts as multiplication by $-k^2$. Substituting this into the governing equation yields the exact dispersion relation:\n$$\n\\omega_{\\text{exact}}^2 \\;=\\; v_A^2\\,k^2 \\;+\\; i\\,\\sigma\n$$\nThe complex eigenfrequency $\\omega_{\\text{exact}}$ is found by taking the principal square root of the right-hand side. The frequency $f$ and damping rate $\\gamma$ are defined as the real and negative imaginary parts of $\\omega$, respectively:\n$$\nf := \\Re(\\omega), \\quad \\gamma := -\\Im(\\omega)\n$$\nA positive $\\gamma$ indicates an unstable (growing) mode, while a negative $\\gamma$ indicates a stable (damped) mode.\n\nThe numerical scheme employs a second-order central-difference approximation for the Laplacian, $\\frac{d^2}{dx^2}$, on a uniform grid of $N$ points with spacing $h = L/N$. The action of this discrete operator on the same plane wave $e^{i k x}$ is equivalent to multiplication by its Fourier symbol, which is given as:\n$$\n\\widehat{\\partial_{xx}}(k) \\;=\\; -\\,\\frac{4}{h^2}\\,\\sin^2\\!\\left(\\frac{k h}{2}\\right) =: -\\widehat{k}_h^{\\,2}\n$$\nHere, we have defined an effective discrete wavenumber $\\widehat{k}_h = \\frac{2}{h}\\,\\sin\\left(\\frac{k h}{2}\\right)$. The discrete dispersion relation is obtained by replacing $k^2$ with $\\widehat{k}_h^{\\,2}$ in the exact dispersion relation:\n$$\n\\omega_h^2 \\;=\\; v_A^2\\,\\widehat{k}_h^{\\,2} \\;+\\; i\\,\\sigma\n$$\nThe numerical eigenfrequency $\\omega_h$ is the principal root of $\\omega_h^2$, from which the numerical frequency $f_h$ and damping rate $\\gamma_h$ are determined.\n\nThe discretization error arises from the difference between the exact wavenumber $k$ and the effective discrete wavenumber $\\widehat{k}_h$. For small arguments, i.e., $kh \\ll 1$, a Taylor expansion of $\\sin(kh/2)$ reveals the nature of this error:\n$$\n\\widehat{k}_h = \\frac{2}{h}\\left(\\frac{kh}{2} - \\frac{(kh)^3}{48} + \\mathcal{O}(h^5)\\right) = k - \\frac{k^3}{24}h^2 + \\mathcal{O}(h^4)\n$$\nThe error in $\\widehat{k}_h$ is of second order in $h$, i.e., $\\mathcal{O}(h^2)$. Consequently, the error in $\\omega_h$ compared to $\\omega_{\\text{exact}}$ is also expected to be $\\mathcal{O}(h^2)$. This implies that the errors in frequency, $|f_h - f|$, and damping rate, $|\\gamma_h - \\gamma|$, should both scale as $h^2$.\n\nTo verify this, we perform a convergence study. For a sequence of decreasing grid spacings $h$, we compute the corresponding errors. The order of convergence, $p$, is determined by the relationship $|\\text{error}| \\approx C h^p$, where $C$ is a constant. By taking the logarithm of both sides, we obtain a linear relationship:\n$$\n\\log(|\\text{error}|) \\approx p \\log(h) + \\log(C)\n$$\nWe can, therefore, estimate the convergence order $p$ as the slope of a line fitted to the data points $(\\log(h), \\log(|\\text{error}|))$ using a least-squares regression.\n\nThe procedure is applied to three test cases:\n1.  **Case 1:** A fixed, low wavenumber $k=3$. As $h \\to 0$, we are in the regime where $kh \\to 0$, so the Taylor series argument holds. We expect to observe convergence orders $p_f \\approx 2$ and $p_\\gamma \\approx 2$.\n2.  **Case 2  3:** The manufactured wavenumber $k$ is chosen as a fixed fraction of the Nyquist wavenumber ($\\pi/h$), so $k \\propto N \\propto 1/h$. As a result, the product $kh$ approaches a constant value. The Taylor expansion about $kh=0$ is no longer applicable. A more detailed analysis shows that for large $N$, the error in frequency $|f_h - f|$ scales as $h^{-1}$ (divergence, $p_f \\approx -1$), while the error in damping rate $|\\gamma_h - \\gamma|$ scales as $h^1$ (convergence, $p_\\gamma \\approx 1$).\n\nThe algorithm for each case is as follows:\n1.  Initialize empty lists for $\\log(h)$, $\\log(|f_h - f|)$, and $\\log(|\\gamma_h - \\gamma|)$.\n2.  Iterate through the specified sequence of grid sizes $N$.\n3.  For each $N$, calculate $h=L/N$ and the case-specific wavenumber $k$.\n4.  Compute $\\omega_{\\text{exact}}$ and $\\omega_h$ using their respective dispersion relations and `numpy.sqrt` for the principal complex root.\n5.  Extract the frequencies ($f, f_h$) and damping rates ($\\gamma, \\gamma_h$).\n6.  Calculate the absolute errors and append their logarithms, along with $\\log(h)$, to the lists.\n7.  After the loop, use `scipy.stats.linregress` on the collected log-log data to find the slopes, which correspond to the observed convergence orders $p_f$ and $p_\\gamma$.\n8.  The results for all three cases are collected and formatted into a single output line as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n\n    def get_convergence_orders(L, vA, sigma, k_func, N_values):\n        \"\"\"\n        Calculates the observed order of convergence for frequency and damping rate.\n\n        Args:\n            L (float): Length of the periodic domain.\n            vA (float): Alfvén speed.\n            sigma (float): Drive/damping parameter.\n            k_func (callable): A function that takes N and returns the wavenumber k.\n            N_values (list of int): A list of grid sizes N to use for the study.\n\n        Returns:\n            list: A list containing the two float values [p_f, p_gamma].\n        \"\"\"\n        log_h_list = []\n        log_error_f_list = []\n        log_error_gamma_list = []\n\n        for N in N_values:\n            h = L / N\n            k = k_func(N)\n\n            # Exact (continuous) solution\n            omega_sq_exact = vA**2 * k**2 + 1j * sigma\n            omega_exact = np.sqrt(omega_sq_exact)\n            f_exact = np.real(omega_exact)\n            gamma_exact = -np.imag(omega_exact)\n\n            # Discrete solution from symbol\n            kh_over_2 = k * h / 2.0\n            k_h_hat = (2.0 / h) * np.sin(kh_over_2)\n            \n            omega_sq_h = vA**2 * k_h_hat**2 + 1j * sigma\n            omega_h = np.sqrt(omega_sq_h)\n            f_h = np.real(omega_h)\n            gamma_h = -np.imag(omega_h)\n\n            # Errors\n            error_f = np.abs(f_h - f_exact)\n            error_gamma = np.abs(gamma_h - gamma_exact)\n\n            # Store log of values for regression, avoiding log(0)\n            if error_f > 1e-16 and error_gamma > 1e-16:\n                log_h_list.append(np.log(h))\n                log_error_f_list.append(np.log(error_f))\n                log_error_gamma_list.append(np.log(error_gamma))\n        \n        # Perform linear regression to find slope (order of convergence)\n        p_f = stats.linregress(log_h_list, log_error_f_list).slope\n        p_gamma = stats.linregress(log_h_list, log_error_gamma_list).slope\n        \n        return [p_f, p_gamma]\n\n    # Common parameters for the test suite\n    N_values = [32, 64, 128, 256, 512]\n    L = 2 * np.pi\n\n    # Define the test cases\n    test_cases = [\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N: 3.0,\n        },\n        {\n            \"L\": L, \"vA\": 0.8, \"sigma\": 2e-3,\n            \"k_func\": lambda N, q=0.45: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        },\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N, q=0.90: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = get_convergence_orders(\n            L=case[\"L\"],\n            vA=case[\"vA\"],\n            sigma=case[\"sigma\"],\n            k_func=case[\"k_func\"],\n            N_values=N_values\n        )\n        all_results.append(result)\n\n    # Format the output string as specified: [[pf1,pg1],[pf2,pg2],[pf3,pg3]]\n    # Each sublist is converted to a string, then joined by commas.\n    list_of_strs = [f\"[{r[0]},{r[1]}]\" for r in all_results]\n    output_str = f\"[{','.join(list_of_strs)}]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}