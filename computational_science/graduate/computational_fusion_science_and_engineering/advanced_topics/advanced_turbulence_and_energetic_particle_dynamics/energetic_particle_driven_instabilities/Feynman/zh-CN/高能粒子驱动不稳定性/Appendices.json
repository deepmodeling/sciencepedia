{
    "hands_on_practices": [
        {
            "introduction": "在稳定性分析中，一项核心任务是根据给定的高能粒子分布函数计算不稳定性的增长率。这项实践练习  为您提供了这一过程的入门级动手经验。通过让学生构建一个简化的、基于标记点（marker-based）的数值求解器，并将其计算结果与从朗道共振条件推导出的精确解析解进行基准比较，本练习弥合了理论回旋动理学方程与其数值实现之间的鸿沟。",
            "id": "3972647",
            "problem": "考虑一个简化的（或降维的）一维线性回旋动理学模型，用于描述在平板、恒定磁场位形中，基于漂移动理学近似下，由标记点表示的快离子物种对环形阿尔芬本征模 (TAE) 的驱动。目标是使用两种方法计算高能粒子对 TAE 增长率的贡献：(i) 基于奇异朗道共振的解析共振积分；(ii) 一种基于标记点的数值求积方法，该方法使用狄拉克δ函数的归一化高斯表示来近似共振。\n\n从快离子物种的时间线性化的弗拉索夫方程出发，该方程与一个具有平行波数 $k_{\\parallel}$、频率 $\\omega$ 和垂直波数 $k_{\\perp}$ 的剪切阿尔芬扰动相耦合。在通行粒子的漂移动理学和低频极限下，共振能量交换源于平行运动共振条件 $\\omega - k_{\\parallel} v_{\\parallel} = 0$。物种磁化率的虚部可从响应算符的奇异部分获得，该部分与 $\\delta(\\omega - k_{\\parallel} v_{\\parallel})$ 成正比。在一个将垂直回旋平均分解为标量形状因子的简化模型中，快离子驱动对增长率的贡献可以简化为平行速度上的一维积分。\n\n假设采用以下模型选择和归一化：\n- 快离子平衡分布函数是平行速度上的一维平移高斯分布：\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right),\n$$\n其中 $v_{\\mathrm{th}}$ 为热速度，$v_0$ 为束流偏移。\n- 快离子与模式的耦合由一个标量常数 $C$ 和一个有限拉莫尔半径回旋平均因子表示\n$$\n\\Gamma_0(b) = I_0(b) e^{-b}, \\quad b = \\frac{(k_{\\perp} \\rho)^2}{2},\n$$\n其中 $I_0$ 是零阶第一类修正贝塞尔函数，$\\rho$ 是快离子回旋半径。将 $\\rho$ 视为已被吸收到参数 $k_{\\perp} \\rho$ 中，因此 $b$ 由输入直接给出。\n- 来自快离子的增长率贡献被建模为共振朗道项\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv,\n$$\n其中 $k \\equiv k_{\\parallel}$，积分域 $[v_{\\min}, v_{\\max}]$ 界定了标记点速度空间。利用狄拉克δ函数在变量变换下的性质，解析表达式变为\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} = \\frac{C \\, \\Gamma_0(b)}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right)\\bigg|_{v = v_{\\mathrm{res}}}, \\quad v_{\\mathrm{res}} = \\frac{\\omega}{k},\n$$\n条件是 $v_{\\mathrm{res}} \\in [v_{\\min}, v_{\\max}]$，否则为零。\n\n实现一个线性回旋动理学求解器，该求解器使用 $N$ 个在 $[v_{\\min}, v_{\\max}]$ 上均匀分布的速度标记点和狄拉克δ函数的归一化高斯表示来近似 $\\gamma_{\\mathrm{EP}}$ 的积分：\n$$\n\\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right),\n$$\n其中 $\\sigma$ 是一个很小的宽度。基于标记点的估计值为\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\, \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v,\n$$\n其中均匀间距为 $\\Delta v = \\frac{v_{\\max} - v_{\\min}}{N}$ 且 $v_j = v_{\\min} + \\left(j - \\frac{1}{2}\\right)\\Delta v$。\n\n您的任务是：\n1. 使用共振条件和狄拉克δ函数的性质，从线性化回旋动理学响应中推导出 $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ 的解析表达式，并清楚地说明所有假设。\n2. 实现一个程序，为每个测试用例计算 $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ 和 $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$，并返回浮点数形式的绝对差 $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$。\n3. 全程使用无量纲归一化单位；不需要物理单位。\n4. 使用修正贝塞尔函数 $I_0(b)$ 来计算 $\\Gamma_0(b)$。\n\n测试套件包含以下参数集，选择这些参数是为了检验计算的不同方面：\n- 情况1（共振峰，中等有限拉莫尔半径）：$v_0 = 1.5$, $v_{\\mathrm{th}} = 0.4$, $\\omega = 0.8$, $k = 0.5$, $k_{\\perp}\\rho = 0.5$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$。\n- 情况2（远尾部共振，小驱动）：$v_0 = 1.0$, $v_{\\mathrm{th}} = 0.3$, $\\omega = 2.0$, $k = 0.5$, $k_{\\perp}\\rho = 0.3$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$。\n- 情况3（强有限拉莫尔半径衰减）：$v_0 = 1.5$, $v_{\\mathrm{th}} = 0.6$, $\\omega = 0.3$, $k = 0.3$, $k_{\\perp}\\rho = 1.8$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$。\n- 情况4（上限处的边界共振）：$v_0 = 2.0$, $v_{\\mathrm{th}} = 0.5$, $\\omega = 2.5$, $k = 0.5$, $k_{\\perp}\\rho = 0.7$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”）。每个结果必须是相应测试用例的基于标记点的估计值与解析值之间的绝对差，以无量纲单位的浮点数表示。",
            "solution": "该问题陈述经核实具有科学依据、问题明确且客观。它提出了一个计算等离子体物理学中的标准练习，具体涉及在简化的回旋动理学模型中计算由高能粒子驱动的波增长率。所有必要的参数和定义均已提供，在模型框架内没有内部矛盾或违反物理原理之处。\n\n任务是使用两种不同的方法计算高能粒子对环形阿尔芬本征模 (TAE) 增长率（表示为 $\\gamma_{\\mathrm{EP}}$）的贡献：一种是直接解析评估，另一种是基于标记点分布的数值近似。然后，我们将量化这两种方法之间的差异。\n\n首先，我们推导增长率的解析表达式 $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$。出发点是所提供的积分表达式，该表达式模拟了快离子与波之间的共振能量交换：\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv\n$$\n此处，$C$ 是耦合常数，$f_0(v)$ 是平行速度 $v$ 上的快离子平衡分布函数，$\\omega$ 和 $k$ 分别是波的频率和平行波数，$\\Gamma_0(b)$ 是考虑了有限拉莫尔半径 (FLR) 效应的回旋平均因子。该积分在由数值标记点填充的平行速度空间（从 $v_{\\min}$ 到 $v_{\\max}$）上进行计算。狄拉克δ函数 $\\delta(\\omega - k v)$ 强制执行朗道共振条件 $v = \\omega/k$，仅选择以该特定平行速度运动的粒子对共振驱动做出贡献。\n\n为了计算该积分，我们使用狄拉克δ函数的筛选性质，特别是它在变量变换下的行为。对于函数 $g(v)$，以下恒等式成立：\n$$\n\\int \\delta(g(v)) \\, h(v) \\, dv = \\sum_{i} \\frac{h(v_i)}{|g'(v_i)|}\n$$\n其中，求和遍历积分域内 $g(v)$ 的所有单根 $v_i$。在我们的例子中，$g(v) = \\omega - k v$，且 $h(v) = -\\frac{\\partial f_0}{\\partial v}$。唯一的根是 $v = \\omega/k$，我们将其定义为共振速度 $v_{\\mathrm{res}}$。导数是 $g'(v) = -k$。因此，积分的计算结果为：\n$$\n\\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv = \\frac{1}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\bigg|_{v=v_{\\mathrm{res}}}\n$$\n仅当共振速度 $v_{\\mathrm{res}}$ 落在积分域内，即 $v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max}$ 时，此结果才非零。否则，积分为零。\n\n快离子分布是一个平移高斯函数：\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\n使用链式法则求其关于 $v$ 的导数：\n$$\n\\frac{\\partial f_0}{\\partial v} = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\cdot \\left(-\\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\\right) = -f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\n$$\n因此，增长率所需的项是：\n$$\n-\\frac{\\partial f_0}{\\partial v} = f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2} = \\frac{2(v - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\n$\\partial f_0 / \\partial v$ 项与速度空间中分布函数的梯度有关，其符号决定了波是被驱动（增长）还是被阻尼。\n\nFLR 效应由 $\\Gamma_0(b) = I_0(b) e^{-b}$ 概括，其中 $b = (k_{\\perp} \\rho)^2/2$，$I_0(b)$ 是零阶第一类修正贝塞尔函数。\n\n综合这些元素，增长率的完整解析表达式为：\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} =\n\\begin{cases}\n\\frac{C \\, \\Gamma_0(b)}{|k|} \\left[ \\frac{2(v_{\\mathrm{res}} - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v_{\\mathrm{res}} - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\right]   \\text{若 } v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max} \\\\\n0   \\text{其他情况}\n\\end{cases}\n$$\n其中 $v_{\\mathrm{res}} = \\omega/k$。\n\n接下来，我们构建增长率的基于标记点的数值求积公式 $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$。该方法通过对 $N$ 个标记点进行离散求和来近似积分。奇异的狄拉克δ函数被一个正则化的、归一化的高斯函数所替代：\n$$\n\\delta(x) \\approx \\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right)\n$$\n其中 $\\sigma$ 是一个很小的宽度参数。该积分通过使用中点法则在一个包含 $N$ 个标记点的均匀网格上近似为黎曼和。第 $j$ 个标记点的速度为 $v_j = v_{\\min} + (j - 1/2) \\Delta v$，网格间距为 $\\Delta v = (v_{\\max} - v_{\\min}) / N$。\n\n将这些代入 $\\gamma_{\\mathrm{EP}}$ 的原始积分中，我们得到数值估计值：\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v\n$$\n和中的每一项都在标记点速度 $v_j$ 处求值。项 $-\\frac{\\partial f_0}{\\partial v}(v_j)$ 使用先前推导的表达式计算，而 $\\delta_{\\sigma}(\\omega - k v_j)$ 使用其高斯形式计算。\n\n计算任务是为给定的测试用例实现 $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ 和 $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$ 的公式，并计算它们的绝对差 $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$。这个差值可作为数值近似准确度的度量，其准确度取决于标记点数量 $N$ 和分辨率参数 $\\sigma$。所提供的参数中，$N=200000$ 较大，$\\sigma = 0.02$ 较小，这样选择是为了确保数值结果与解析结果非常接近。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes and compares analytic and marker-based estimates for the energetic particle\n    contribution to the TAE growth rate in a simplified linear gyrokinetic model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Resonant peak, moderate FLR\n        {'v0': 1.5, 'v_th': 0.4, 'omega': 0.8, 'k': 0.5, 'k_perp_rho': 0.5, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 2: Far-tail resonance, small drive\n        {'v0': 1.0, 'v_th': 0.3, 'omega': 2.0, 'k': 0.5, 'k_perp_rho': 0.3, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 3: Strong FLR attenuation\n        {'v0': 1.5, 'v_th': 0.6, 'omega': 0.3, 'k': 0.3, 'k_perp_rho': 1.8, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 4: Boundary resonance\n        {'v0': 2.0, 'v_th': 0.5, 'omega': 2.5, 'k': 0.5, 'k_perp_rho': 0.7, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Extract parameters\n        v0, v_th, omega, k = params['v0'], params['v_th'], params['omega'], params['k']\n        k_perp_rho, C, sigma = params['k_perp_rho'], params['C'], params['sigma']\n        v_min, v_max, N = params['v_min'], params['v_max'], params['N']\n\n        # Shared calculations\n        b = (k_perp_rho**2) / 2.0\n        gamma0_b = i0(b) * np.exp(-b)\n\n        # --- Analytic Calculation (gamma_an) ---\n        v_res = omega / k\n        gamma_an = 0.0\n\n        if v_min = v_res = v_max:\n            # -df0/dv evaluated at v_res\n            term1 = 2.0 * (v_res - v0) / (np.sqrt(np.pi) * v_th**3)\n            term2 = np.exp(-((v_res - v0)**2) / v_th**2)\n            df0_dv_res = term1 * term2\n            \n            gamma_an = (C * gamma0_b / np.abs(k)) * df0_dv_res\n\n        # --- Marker-based Calculation (gamma_mc) ---\n        delta_v = (v_max - v_min) / N\n        v_j = v_min + (np.arange(N) + 0.5) * delta_v\n\n        # -df0/dv evaluated at each marker velocity v_j\n        term1_mc = 2.0 * (v_j - v0) / (np.sqrt(np.pi) * v_th**3)\n        term2_mc = np.exp(-((v_j - v0)**2) / v_th**2)\n        df0_dv_j = term1_mc * term2_mc\n\n        # Gaussian representation of delta function\n        delta_sigma = (1.0 / (np.sqrt(np.pi) * sigma)) * np.exp(-((omega - k * v_j)**2) / sigma**2)\n\n        # Summation over markers\n        integrand_sum = np.sum(df0_dv_j * delta_sigma * delta_v)\n        gamma_mc = C * gamma0_b * integrand_sum\n\n        # Calculate absolute difference\n        abs_diff = np.abs(gamma_mc - gamma_an)\n        results.append(abs_diff)\n        \n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在构建数值求解器之后，必须确立其可靠性。这项实践  介绍了一种计算科学的基石技术：使用“人造解方法”（method of manufactured solutions）进行代码验证。通过构建一个具有已知解析解的问题，我们可以严格地量化数值格式的准确性，并确认当网格分辨率提高时，误差是否以预期的速率收敛，从而验证代码的正确性。",
            "id": "3972709",
            "problem": "要求您使用人造解方法，为线性Alfvén本征模 (AE) 求解器设计并实现一个验证测试，并量化其在频率和阻尼率方面的离散化误差收敛性。该求解器作用于一个定义在一维周期性平板（长度为 $\\,L\\,$）上的标量场 $\\,\\phi(x)\\,$。在无量纲单位下，其控制性本征值问题为\n$$\\left(-\\,v_A^2\\,\\frac{d^2}{dx^2} + i\\,\\sigma\\right)\\,\\phi(x) \\;=\\; \\omega^2\\,\\phi(x),$$\n其中 $\\,v_A\\,$ 是归一化的Alfvén速度，$\\,\\sigma\\,$ 是一个代表高能粒子驱动或阻尼净效应的常数，而 $\\,\\omega\\,$ 是复本征频率。对于一个波数为 $\\,k\\,$ 的人造平面波解 $\\,\\phi_m(x) = e^{i k x}\\,$，其连续符号可得\n$$\\omega_{\\text{exact}}^2 \\;=\\; v_A^2\\,k^2 \\;+\\; i\\,\\sigma,$$\n我们取平方根的主支，因此\n$$\\omega_{\\text{exact}} \\;=\\; \\sqrt{v_A^2\\,k^2 \\;+\\; i\\,\\sigma}.$$\n分别定义频率和阻尼率为 $\\,f := \\Re(\\omega)\\,$ 和 $\\,\\gamma := -\\Im(\\omega)\\,$。\n\n考虑在具有 $\\,N\\,$ 个点和间距 $\\,h = L/N\\,$ 的均匀周期性网格上，对 $\\,\\frac{d^2}{dx^2}\\,$ 进行二阶中心差分离散。其应用于 $\\,e^{i k x}\\,$ 的拉普拉斯算子的离散傅里叶符号为\n$$\\widehat{\\partial_{xx}}(k) \\;\\approx\\; -\\,\\frac{4}{h^2}\\,\\sin^2\\!\\left(\\frac{k h}{2}\\right).$$\n因此，在模式 $\\,e^{i k x}\\,$ 上评估的离散人造本征值问题意味着\n$$\\omega_h^2 \\;=\\; v_A^2\\,\\widehat{k}_h^{\\,2} \\;+\\; i\\,\\sigma,\\quad\\text{where}\\quad \\widehat{k}_h \\;=\\; \\frac{2}{h}\\,\\sin\\!\\left(\\frac{k h}{2}\\right),$$\n并且 $\\,\\omega_h\\,$ 同样是平方根的主支。令 $\\,f_h := \\Re(\\omega_h)\\,$ 和 $\\,\\gamma_h := -\\Im(\\omega_h)\\,$。对于一个固定的人造波数 $\\,k\\,$，计算一系列网格间距 $\\,h\\,$ 下的离散化误差 $\\,|f_h - f|\\,$ 和 $\\,|\\gamma_h - \\gamma|\\,$，并通过对 $\\,\\log(|\\text{error}|)\\,$ 与 $\\,\\log(h)\\,$ 进行最小二乘线性回归来估算观测到的收敛阶 $\\,p_f\\,$ 和 $\\,p_\\gamma\\,$。\n\n您的任务是实现一个独立的程序，该程序：\n- 对于下面列出的每个测试用例，生成网格大小序列 $\\,N\\,$，计算 $\\,h = L/N\\,$，按规定构造人造波数 $\\,k\\,$，评估 $\\,\\omega_{\\text{exact}}\\,$ 和 $\\,\\omega_h\\,$，构成 $\\,f,\\,\\gamma,\\,f_h,\\,\\gamma_h\\,$，计算误差 $\\,|f_h - f|\\,$ 和 $\\,|\\gamma_h - \\gamma|\\,$，并对 $\\,(\\log(h),\\log(\\text{error}))\\,$ 进行线性拟合以获得斜率 $\\,p_f\\,$ 和 $\\,p_\\gamma\\,$。\n- 将所有测试用例的结果汇总到单行输出中。\n\n所有量均为无量纲，角度以弧度为单位。不使用任何外部输入。使用以下测试套件：\n- 用例 $\\,1\\,$ (理想路径平面波)：$\\,L = 2\\pi\\,$, $\\,v_A = 1\\,$, $\\,\\sigma = -10^{-3}\\,$, 整数模 $\\,m = 3\\,$ 且 $\\,k = 2\\pi m / L\\,$，以及 $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$。\n- 用例 $\\,2\\,$ (奈奎斯特分数驱动模)：$\\,L = 2\\pi\\,$, $\\,v_A = 0.8\\,$, $\\,\\sigma = +2\\times 10^{-3}\\,$, 奈奎斯特波数的分数 $\\,q = 0.45\\,$，定义如下：对于每个 $\\,N\\,$，选择整数模 $\\,m(N) = \\lfloor q\\,N/2 \\rfloor\\,$ 并设置 $\\,k = 2\\pi\\,m(N)/L\\,$，其中 $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$。\n- 用例 $\\,3\\,$ (高波数近奈奎斯特阻尼模)：$\\,L = 2\\pi\\,$, $\\,v_A = 1\\,$, $\\,\\sigma = -10^{-3}\\,$, 分数 $\\,q = 0.90\\,$，其中 $\\,m(N)\\,$ 和 $\\,k\\,$ 的定义与用例 $\\,2\\,$ 中相同，且 $\\,N \\in \\{32,\\,64,\\,128,\\,256,\\,512\\}\\,$。\n\n您的程序应生成单行输出，其中包含按用例 $\\,1\\,$, $\\,2\\,$, $\\,3\\,$ 顺序排列的结果，格式为方括号括起来的逗号分隔列表。每个用例的结果必须是一个包含两个浮点数 $\\,\\,[p_f,\\,p_\\gamma]\\,\\,$ 的列表。例如，一个有效的输出格式是 $\\,[[p_{f,1},p_{\\gamma,1}],[p_{f,2},p_{\\gamma,2}],[p_{f,3},p_{\\gamma,3}]]\\,$。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、良态且客观。它提出了一个来自计算等离子体物理学的标准验证任务，具体来说是使用人造解方法为一个简化的Alfvén本征模求解器计算离散化误差收敛性。所有参数和过程都已明确定义，从而可以得到唯一且可验证的解。\n\n解题过程如下。首先，我们为连续和离散系统建立数学框架。然后，我们概述计算给定测试用例收敛阶的数值程序。\n\n控制方程是关于标量场 $\\phi(x)$ 的一维亥姆霍兹型本征值问题：\n$$\n\\left(-\\,v_A^2\\,\\frac{d^2}{dx^2} + i\\,\\sigma\\right)\\,\\phi(x) \\;=\\; \\omega^2\\,\\phi(x)\n$$\n其中 $v_A$ 是Alfvén速度，$\\sigma$ 是一个驱动/阻尼参数，$\\omega$ 是复本征频率。分析在长度为 $L$ 的周期性域上进行。\n\n对于人造平面波解 $\\phi_m(x) = e^{i k x}$，微分算子 $\\frac{d^2}{dx^2}$ 的作用等同于乘以 $-k^2$。将此代入控制方程可得到精确的色散关系：\n$$\n\\omega_{\\text{exact}}^2 \\;=\\; v_A^2\\,k^2 \\;+\\; i\\,\\sigma\n$$\n复本征频率 $\\omega_{\\text{exact}}$ 是通过取等式右边的主平方根得到的。频率 $f$ 和阻尼率 $\\gamma$ 分别定义为 $\\omega$ 的实部和负虚部：\n$$\nf := \\Re(\\omega), \\quad \\gamma := -\\Im(\\omega)\n$$\n正的 $\\gamma$ 表示不稳定的（增长的）模式，而负的 $\\gamma$ 表示稳定的（阻尼的）模式。\n\n该数值方案在具有 $N$ 个点、间距为 $h=L/N$ 的均匀网格上，对拉普拉斯算子 $\\frac{d^2}{dx^2}$ 采用二阶中心差分近似。此离散算子作用于同一平面波 $e^{i k x}$ 的效果等同于乘以其傅里叶符号，表示为：\n$$\n\\widehat{\\partial_{xx}}(k) \\;=\\; -\\,\\frac{4}{h^2}\\,\\sin^2\\!\\left(\\frac{k h}{2}\\right) =: -\\widehat{k}_h^{\\,2}\n$$\n在此，我们定义了一个有效离散波数 $\\widehat{k}_h = \\frac{2}{h}\\,\\sin\\left(\\frac{k h}{2}\\right)$。通过在精确色散关系中用 $\\widehat{k}_h^{\\,2}$ 替换 $k^2$，我们得到离散色散关系：\n$$\n\\omega_h^2 \\;=\\; v_A^2\\,\\widehat{k}_h^{\\,2} \\;+\\; i\\,\\sigma\n$$\n数值本征频率 $\\omega_h$ 是 $\\omega_h^2$ 的主根，由此可确定数值频率 $f_h$ 和阻尼率 $\\gamma_h$。\n\n离散化误差源于精确波数 $k$ 和有效离散波数 $\\widehat{k}_h$ 之间的差异。对于小宗量，即 $kh \\ll 1$，$\\sin(kh/2)$ 的泰勒展开揭示了此误差的性质：\n$$\n\\widehat{k}_h = \\frac{2}{h}\\left(\\frac{kh}{2} - \\frac{(kh)^3}{48} + \\mathcal{O}(h^5)\\right) = k - \\frac{k^3}{24}h^2 + \\mathcal{O}(h^4)\n$$\n$\\widehat{k}_h$ 的误差是 $h$ 的二阶，即 $\\mathcal{O}(h^2)$。因此，$\\omega_h$ 相对于 $\\omega_{\\text{exact}}$ 的误差也预期为 $\\mathcal{O}(h^2)$。这意味着频率误差 $|f_h - f|$ 和阻尼率误差 $|\\gamma_h - \\gamma|$ 都应与 $h^2$ 成比例。\n\n为验证这一点，我们进行收敛性研究。对于一系列递减的网格间距 $h$，我们计算相应的误差。收敛阶 $p$ 由关系式 $|\\text{error}| \\approx C h^p$ 确定，其中 $C$ 为常数。对两边取对数，我们得到一个线性关系：\n$$\n\\log(|\\text{error}|) \\approx p \\log(h) + \\log(C)\n$$\n因此，我们可以通过对数据点 $(\\log(h), \\log(|\\text{error}|))$ 进行最小二乘回归拟合一条直线，并将其斜率作为收敛阶 $p$ 的估计值。\n\n该程序应用于三个测试用例：\n1.  **用例 1:** 一个固定的低波数 $k=3$。当 $h \\to 0$ 时，我们处于 $kh \\to 0$ 的区间，因此泰勒级数的论证成立。我们预期观测到的收敛阶为 $p_f \\approx 2$ 和 $p_\\gamma \\approx 2$。\n2.  **用例 2 和 3:** 人造波数 $k$ 被选为奈奎斯特波数 ($\\pi/h$) 的一个固定分数，因此 $k \\propto N \\propto 1/h$。结果，乘积 $kh$ 趋于一个常数值。关于 $kh=0$ 的泰勒展开不再适用。误差主要由 $k^2$ 和 $\\widehat{k}_h^2$ 之间与 $h$ 无关的差异主导。更详细的分析表明，对于较大的 $N$，频率误差 $|f_h - f|$ 按 $h^{-1}$ 比例变化（发散，$p_f \\approx -1$），而阻尼率误差 $|\\gamma_h - \\gamma|$ 按 $h^1$ 比例变化（收敛，$p_\\gamma \\approx 1$）。\n\n每个用例的算法如下：\n1.  为 $\\log(h)$、$\\log(|f_h - f|)$ 和 $\\log(|\\gamma_h - \\gamma|)$ 初始化空列表。\n2.  遍历指定的网格大小序列 $N$。\n3.  对于每个 $N$，计算 $h=L/N$ 和特定用例的波数 $k$。\n4.  使用各自的色散关系和 `numpy.sqrt` 来计算 $\\omega_{\\text{exact}}$ 和 $\\omega_h$，以获得复数主根。\n5.  提取频率 ($f, f_h$) 和阻尼率 ($\\gamma, \\gamma_h$)。\n6.  计算绝对误差并将其对数以及 $\\log(h)$ 添加到列表中。\n7.  循环结束后，对收集的对数-对数数据使用 `scipy.stats.linregress` 来找到斜率，这些斜率对应于观测到的收敛阶 $p_f$ 和 $p_\\gamma$。\n8.  将所有三个用例的结果收集并按规定格式化为单行输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n\n    def get_convergence_orders(L, vA, sigma, k_func, N_values):\n        \"\"\"\n        Calculates the observed order of convergence for frequency and damping rate.\n\n        Args:\n            L (float): Length of the periodic domain.\n            vA (float): Alfvén speed.\n            sigma (float): Drive/damping parameter.\n            k_func (callable): A function that takes N and returns the wavenumber k.\n            N_values (list of int): A list of grid sizes N to use for the study.\n\n        Returns:\n            list: A list containing the two float values [p_f, p_gamma].\n        \"\"\"\n        log_h_list = []\n        log_error_f_list = []\n        log_error_gamma_list = []\n\n        for N in N_values:\n            h = L / N\n            k = k_func(N)\n\n            # Exact (continuous) solution\n            omega_sq_exact = vA**2 * k**2 + 1j * sigma\n            omega_exact = np.sqrt(omega_sq_exact)\n            f_exact = np.real(omega_exact)\n            gamma_exact = -np.imag(omega_exact)\n\n            # Discrete solution from symbol\n            kh_over_2 = k * h / 2.0\n            k_h_hat = (2.0 / h) * np.sin(kh_over_2)\n            \n            omega_sq_h = vA**2 * k_h_hat**2 + 1j * sigma\n            omega_h = np.sqrt(omega_sq_h)\n            f_h = np.real(omega_h)\n            gamma_h = -np.imag(omega_h)\n\n            # Errors\n            error_f = np.abs(f_h - f_exact)\n            error_gamma = np.abs(gamma_h - gamma_exact)\n\n            # Store log of values for regression, avoiding log(0)\n            if error_f > 1e-16 and error_gamma > 1e-16:\n                log_h_list.append(np.log(h))\n                log_error_f_list.append(np.log(error_f))\n                log_error_gamma_list.append(np.log(error_gamma))\n        \n        # Perform linear regression to find slope (order of convergence)\n        p_f = stats.linregress(log_h_list, log_error_f_list).slope\n        p_gamma = stats.linregress(log_h_list, log_error_gamma_list).slope\n        \n        return [p_f, p_gamma]\n\n    # Common parameters for the test suite\n    N_values = [32, 64, 128, 256, 512]\n    L = 2 * np.pi\n\n    # Define the test cases\n    test_cases = [\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N: 3.0,\n        },\n        {\n            \"L\": L, \"vA\": 0.8, \"sigma\": 2e-3,\n            \"k_func\": lambda N, q=0.45: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        },\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N, q=0.90: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = get_convergence_orders(\n            L=case[\"L\"],\n            vA=case[\"vA\"],\n            sigma=case[\"sigma\"],\n            k_func=case[\"k_func\"],\n            N_values=N_values\n        )\n        all_results.append(result)\n\n    # Format the output string as specified: [[pf1,pg1],[pf2,pg2],[pf3,pg3]]\n    # Each sublist is converted to a string, then joined by commas.\n    list_of_strs = [f\"[{r[0]},{r[1]}]\" for r in all_results]\n    output_str = f\"[{','.join(list_of_strs)}]\"\n    \n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基本计算和验证之后，下一步是利用我们的模型进行预测与控制。这项练习  旨在探索不稳定性增长率对高能粒子分布变化的敏感性。计算这种敏感性对于设计控制不稳定性的策略至关重要，例如，通过调整中性束注入或离子回旋加热来改变粒子分布，从而达到稳定等离子体的目的。",
            "id": "3972672",
            "problem": "考虑一个托卡马克等离子体中的小振幅阿尔芬本征模 (AE)，其中高能（快）离子种类由一个分布函数 $f(\\Gamma)$ 建模，该函数定义在由导心坐标组成的约化相空间 $\\Gamma$ 上。在线性区域，波能量 $W(t)$ 遵循 $dW/dt = 2\\,\\gamma[f]\\,W$，其中 $\\gamma[f]$ 是快离子对线性增长率的贡献。对于计算建模，高能粒子驱动由以下泛函表示\n$$\n\\gamma[f] = \\int_{\\Gamma} R(\\Gamma)\\,f(\\Gamma)\\,d\\Gamma + \\frac{1}{2}\\int_{\\Gamma}\\int_{\\Gamma'} f(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,f(\\Gamma')\\,d\\Gamma\\,d\\Gamma',\n$$\n其中 $R(\\Gamma)$ 编码了局域共振驱动，$K(\\Gamma,\\Gamma')$ 是一个对称核，$K(\\Gamma,\\Gamma') = K(\\Gamma',\\Gamma)$，表示有限轨道宽度 (FOW) 非局域耦合。假设基函数 $\\{\\chi_i(\\Gamma)\\}_{i=1}^{N}$ 对于相空间内积构成一个标准正交集，因此 $\\int_{\\Gamma} \\chi_i(\\Gamma)\\,\\chi_j(\\Gamma)\\,d\\Gamma = \\delta_{ij}$。分布函数被离散化为 $f(\\Gamma) = \\sum_{i=1}^{N} f_i\\,\\chi_i(\\Gamma)$，并且泛函系数定义为 $R_i = \\int_{\\Gamma} R(\\Gamma)\\,\\chi_i(\\Gamma)\\,d\\Gamma$ 和 $K_{ij} = \\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,\\chi_j(\\Gamma')\\,d\\Gamma\\,d\\Gamma'$。\n\n从线性波-粒子能量转移的基本原理和泛函导数的定义出发，推导 AE 增长率相对于快离子分布的离散化灵敏度向量，即分量为 $g_i \\equiv (\\delta\\gamma/\\delta f)_i$ 的向量，其定义为一个任意微扰 $\\delta f(\\Gamma) = \\sum_i \\delta f_i\\,\\chi_i(\\Gamma)$ 会产生\n$$\n\\delta\\gamma = \\sum_{i=1}^{N} g_i\\,\\delta f_i.\n$$\n然后，对于 $N=3$ 的情况，在以下科学上一致的数据下，数值计算 $g_i$：\n- 线性系数为 $R_1 = 0.8\\ \\mathrm{s}^{-1}$，$R_2 = -0.2\\ \\mathrm{s}^{-1}$ 和 $R_3 = 0.5\\ \\mathrm{s}^{-1}$。\n- 对称耦合矩阵（单位为 $\\mathrm{s}^{-1}$）为\n$$\nK = \\begin{pmatrix}\n0.5  -0.1  0.0 \\\\\n-0.1  0.3  0.05 \\\\\n0.0  0.05  0.2\n\\end{pmatrix}.\n$$\n- 离散化的快离子分布系数为 $f_1 = 1.1$，$f_2 = -0.4$ 和 $f_3 = 0.9$。\n\n以 $\\mathrm{s}^{-1}$ 为单位表示最终的灵敏度向量条目，并将每个条目四舍五入到四位有效数字。使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境，将最终答案表示为单行矩阵。",
            "solution": "该问题陈述已经过验证，被认为是科学上合理的、适定的和客观的。它为计算聚变科学领域中的一个可解问题提供了一个完整且一致的框架。\n\n任务是推导阿尔芬本征模 (AE) 增长率 $\\gamma$ 相对于快离子分布系数 $f_i$ 的灵敏度向量 $g_i$，然后针对一个具体情况计算其数值。\n\n首先，我们将增长率泛函 $\\gamma[f]$ 表示为其离散形式。分布函数由展开式 $f(\\Gamma) = \\sum_{i=1}^{N} f_i\\,\\chi_i(\\Gamma)$ 给出。将此代入 $\\gamma[f]$ 的定义中：\n$$\n\\gamma[f] = \\int_{\\Gamma} R(\\Gamma)\\left(\\sum_{j=1}^{N} f_j\\chi_j(\\Gamma)\\right)d\\Gamma + \\frac{1}{2}\\int_{\\Gamma}\\int_{\\Gamma'} \\left(\\sum_{i=1}^{N} f_i\\chi_i(\\Gamma)\\right)K(\\Gamma,\\Gamma')\\left(\\sum_{j=1}^{N} f_j\\chi_j(\\Gamma')\\right)d\\Gamma\\,d\\Gamma'\n$$\n使用离散化系数的定义 $R_j = \\int_{\\Gamma} R(\\Gamma)\\,\\chi_j(\\Gamma)\\,d\\Gamma$ 和 $K_{ij} = \\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,\\chi_j(\\Gamma')\\,d\\Gamma\\,d\\Gamma'$，我们可以简化该表达式：\n$$\n\\gamma = \\sum_{j=1}^{N} f_j \\left(\\int_{\\Gamma} R(\\Gamma)\\chi_j(\\Gamma)d\\Gamma\\right) + \\frac{1}{2}\\sum_{i=1}^{N}\\sum_{j=1}^{N} f_i f_j \\left(\\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)K(\\Gamma,\\Gamma')\\chi_j(\\Gamma')d\\Gamma\\,d\\Gamma'\\right)\n$$\n这给出了增长率作为系数 $f_i$ 的函数：\n$$\n\\gamma(f_1, \\dots, f_N) = \\sum_{j=1}^{N} R_j f_j + \\frac{1}{2}\\sum_{i=1}^{N}\\sum_{j=1}^{N} f_i K_{ij} f_j\n$$\n在向量和矩阵表示法中，其中 $\\mathbf{f}$ 是系数 $f_i$ 的列向量，$\\mathbf{R}$ 是 $R_i$ 的列向量，$K$ 是元素为 $K_{ij}$ 的矩阵，这可以写成：\n$$\n\\gamma(\\mathbf{f}) = \\mathbf{R}^T \\mathbf{f} + \\frac{1}{2}\\mathbf{f}^T K \\mathbf{f}\n$$\n灵敏度向量分量 $g_i$ 由关系式 $\\delta\\gamma = \\sum_i g_i \\delta f_i$ 定义，对于一个小的微扰 $\\delta f_i$。这等价于将 $g_i$ 定义为 $\\gamma$ 对 $f_i$ 的偏导数：\n$$\ng_i = \\frac{\\partial\\gamma}{\\partial f_i}\n$$\n我们计算这个导数：\n$$\ng_i = \\frac{\\partial}{\\partial f_i}\\left(\\sum_j R_j f_j\\right) + \\frac{1}{2}\\frac{\\partial}{\\partial f_i}\\left(\\sum_j\\sum_k f_j K_{jk} f_k\\right)\n$$\n线性项的导数是：\n$$\n\\frac{\\partial}{\\partial f_i}\\left(\\sum_j R_j f_j\\right) = \\sum_j R_j \\frac{\\partial f_j}{\\partial f_i} = \\sum_j R_j \\delta_{ij} = R_i\n$$\n二次项的导数是：\n$$\n\\frac{\\partial}{\\partial f_i}\\left(\\sum_j\\sum_k f_j K_{jk} f_k\\right) = \\sum_j\\sum_k \\left( \\frac{\\partial f_j}{\\partial f_i} K_{jk} f_k + f_j K_{jk} \\frac{\\partial f_k}{\\partial f_i} \\right) = \\sum_j\\sum_k \\left( \\delta_{ij} K_{jk} f_k + f_j K_{jk} \\delta_{ik} \\right)\n$$\n$$\n= \\sum_k K_{ik} f_k + \\sum_j f_j K_{ji}\n$$\n问题陈述中指出核 $K(\\Gamma,\\Gamma')$ 是对称的，这意味着矩阵 $K$ 是对称的，即 $K_{ij} = K_{ji}$。因此，第二项 $\\sum_j f_j K_{ji}$ 可以重写为 $\\sum_j f_j K_{ij}$。将求和索引从 $j$ 重命名为 $k$，这变为 $\\sum_k f_k K_{ik} = \\sum_k K_{ik} f_k$。\n因此，二次项的导数是 $2\\sum_k K_{ik} f_k$。\n\n合并各项，得到 $g_i$ 的表达式为：\n$$\ng_i = R_i + \\frac{1}{2}\\left( 2\\sum_j K_{ij} f_j \\right) = R_i + \\sum_{j=1}^{N} K_{ij} f_j\n$$\n以向量形式表示，即为 $\\mathbf{g} = \\mathbf{R} + K\\mathbf{f}$。\n\n现在我们对给定的 $N=3$ 的情况计算 $g_i$。所提供的数据是：\n$\\mathbf{R} = \\begin{pmatrix} 0.8 \\\\ -0.2 \\\\ 0.5 \\end{pmatrix} \\mathrm{s}^{-1}$\n$K = \\begin{pmatrix} 0.5  -0.1  0.0 \\\\ -0.1  0.3  0.05 \\\\ 0.0  0.05  0.2 \\end{pmatrix} \\mathrm{s}^{-1}$\n$\\mathbf{f} = \\begin{pmatrix} 1.1 \\\\ -0.4 \\\\ 0.9 \\end{pmatrix}$\n\n首先，我们计算矩阵-向量乘积 $K\\mathbf{f}$：\n$$\nK\\mathbf{f} = \\begin{pmatrix} 0.5  -0.1  0.0 \\\\ -0.1  0.3  0.05 \\\\ 0.0  0.05  0.2 \\end{pmatrix} \\begin{pmatrix} 1.1 \\\\ -0.4 \\\\ 0.9 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix}\n(0.5)(1.1) + (-0.1)(-0.4) + (0.0)(0.9) \\\\\n(-0.1)(1.1) + (0.3)(-0.4) + (0.05)(0.9) \\\\\n(0.0)(1.1) + (0.05)(-0.4) + (0.2)(0.9)\n\\end{pmatrix}\n= \\begin{pmatrix}\n0.55 + 0.04 + 0 \\\\\n-0.11 - 0.12 + 0.045 \\\\\n0 - 0.02 + 0.18\n\\end{pmatrix}\n= \\begin{pmatrix}\n0.59 \\\\\n-0.185 \\\\\n0.16\n\\end{pmatrix} \\mathrm{s}^{-1}\n$$\n接下来，我们加上向量 $\\mathbf{R}$ 来求得 $\\mathbf{g}$：\n$$\n\\mathbf{g} = \\mathbf{R} + K\\mathbf{f} = \\begin{pmatrix} 0.8 \\\\ -0.2 \\\\ 0.5 \\end{pmatrix} + \\begin{pmatrix} 0.59 \\\\ -0.185 \\\\ 0.16 \\end{pmatrix} = \\begin{pmatrix} 0.8 + 0.59 \\\\ -0.2 - 0.185 \\\\ 0.5 + 0.16 \\end{pmatrix} = \\begin{pmatrix} 1.39 \\\\ -0.385 \\\\ 0.66 \\end{pmatrix} \\mathrm{s}^{-1}\n$$\n问题要求将最终答案四舍五入到四位有效数字。\n$g_1 = 1.390\\ \\mathrm{s}^{-1}$\n$g_2 = -0.3850\\ \\mathrm{s}^{-1}$\n$g_3 = 0.6600\\ \\mathrm{s}^{-1}$\n\n最终的灵敏度向量，以行矩阵形式表示，为 $(1.390, -0.3850, 0.6600)$，单位为 $\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.390  -0.3850  0.6600\n\\end{pmatrix}\n}\n$$"
        }
    ]
}