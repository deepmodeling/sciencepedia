{
    "hands_on_practices": [
        {
            "introduction": "Understanding energetic particle driven instabilities begins with quantifying their growth rate. This practice provides a direct link between the theoretical concept of Landau resonance and its numerical evaluation in a gyrokinetic code . By implementing both an analytical solution based on the Dirac delta function and a marker-based numerical quadrature, you will gain hands-on experience with how continuous phase-space physics is translated into a discrete particle-in-cell representation.",
            "id": "3972647",
            "problem": "Consider a reduced one-dimensional linear gyrokinetic model for the drive of a Toroidal Alfvén Eigenmode (TAE) by a marker-represented fast-ion species under the drift-kinetic approximation in a slab, constant magnetic field configuration. The goal is to compute the energetic particle contribution to the TAE growth rate using two approaches: (i) an analytic resonance integral based on the singular Landau resonance and (ii) a marker-based numerical quadrature that approximates the resonance using a normalized Gaussian representation of the Dirac delta function.\n\nStart from the time-linearized Vlasov equation for the fast-ion species, coupled to a shear-Alfvén perturbation with parallel wave number $k_{\\parallel}$, frequency $\\omega$, and perpendicular wave number $k_{\\perp}$. In the drift-kinetic and low-frequency limit for passing particles, the resonant energy exchange arises from the parallel motion resonance condition $\\omega - k_{\\parallel} v_{\\parallel} = 0$. The imaginary part of the species susceptibility is obtained from the singular part of the response operator, which is proportional to $\\delta(\\omega - k_{\\parallel} v_{\\parallel})$. In a simplified model that factors the perpendicular gyroaverage into a scalar form factor, the fast-ion drive contribution to the growth rate can be reduced to a one-dimensional integral over the parallel velocity.\n\nAssume the following modeling choices and normalizations:\n- The fast-ion equilibrium distribution function is a shifted one-dimensional Gaussian in parallel velocity:\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right),\n$$\nwith thermal speed $v_{\\mathrm{th}}$ and beam shift $v_0$.\n- The coupling of the fast ions to the mode is represented by a scalar constant $C$ and a finite Larmor radius gyroaverage factor\n$$\n\\Gamma_0(b) = I_0(b) e^{-b}, \\quad b = \\frac{(k_{\\perp} \\rho)^2}{2},\n$$\nwhere $I_0$ is the modified Bessel function of the first kind of order zero and $\\rho$ is the fast-ion gyroradius. Treat $\\rho$ as absorbed into the parameter $k_{\\perp} \\rho$ so that $b$ is directly given by the input.\n- The growth rate contribution from the fast ions is modeled as the resonant Landau term\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv,\n$$\nwhere $k \\equiv k_{\\parallel}$ and the integration domain $[v_{\\min}, v_{\\max}]$ bounds the marker velocity space. Using the property of the Dirac delta under variable transformation, the analytic expression becomes\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} = \\frac{C \\, \\Gamma_0(b)}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right)\\bigg|_{v = v_{\\mathrm{res}}}, \\quad v_{\\mathrm{res}} = \\frac{\\omega}{k},\n$$\nprovided $v_{\\mathrm{res}} \\in [v_{\\min}, v_{\\max}]$, and zero otherwise.\n\nImplement a linear gyrokinetic solver that approximates the integral for $\\gamma_{\\mathrm{EP}}$ using $N$ velocity markers uniformly distributed over $[v_{\\min}, v_{\\max}]$ and a normalized Gaussian representation of the Dirac delta function:\n$$\n\\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right),\n$$\nwith a small width $\\sigma$. The marker-based estimate is\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\, \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v,\n$$\nwith uniform spacing $\\Delta v = \\frac{v_{\\max} - v_{\\min}}{N}$ and $v_j = v_{\\min} + \\left(j - \\frac{1}{2}\\right)\\Delta v$.\n\nYour task is to:\n1. Derive the analytic expression for $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ from the linearized gyrokinetic response using the resonance condition and properties of the Dirac delta function, clearly stating all assumptions.\n2. Implement a program that computes both $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ and $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$ for each test case and returns the absolute difference $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$ as a float.\n3. Use dimensionless normalized units throughout; no physical units are required.\n4. Use the modified Bessel function $I_0(b)$ to compute $\\Gamma_0(b)$.\n\nThe test suite consists of the following parameter sets, chosen to exercise different facets of the computation:\n- Case 1 (resonant peak, moderate finite Larmor radius): $v_0 = 1.5$, $v_{\\mathrm{th}} = 0.4$, $\\omega = 0.8$, $k = 0.5$, $k_{\\perp}\\rho = 0.5$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 2 (far-tail resonance, small drive): $v_0 = 1.0$, $v_{\\mathrm{th}} = 0.3$, $\\omega = 2.0$, $k = 0.5$, $k_{\\perp}\\rho = 0.3$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 3 (strong finite Larmor radius attenuation): $v_0 = 1.5$, $v_{\\mathrm{th}} = 0.6$, $\\omega = 0.3$, $k = 0.3$, $k_{\\perp}\\rho = 1.8$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n- Case 4 (boundary resonance at the upper limit): $v_0 = 2.0$, $v_{\\mathrm{th}} = 0.5$, $\\omega = 2.5$, $k = 0.5$, $k_{\\perp}\\rho = 0.7$, $C = 1.0$, $\\sigma = 0.02$, $v_{\\min} = 0.0$, $v_{\\max} = 5.0$, $N = 200000$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be the absolute difference between the marker-based estimate and the analytic value for the corresponding test case, represented as a float in dimensionless units.",
            "solution": "The problem statement has been validated as scientifically grounded, well-posed, and objective. It presents a standard exercise in computational plasma physics, specifically concerning the calculation of wave growth rates driven by energetic particles in a simplified gyrokinetic model. All necessary parameters and definitions are provided, and there are no internal contradictions or violations of physical principles within the context of the model.\n\nThe task is to compute the energetic particle contribution to the growth rate of a Toroidal Alfvén Eigenmode (TAE), denoted $\\gamma_{\\mathrm{EP}}$, using two distinct methods: a direct analytic evaluation and a numerical approximation based on a marker distribution. We will then quantify the difference between these two approaches.\n\nFirst, we derive the analytic expression for the growth rate, $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$. The starting point is the provided integral expression, which models the resonant energy exchange between the fast ions and the wave:\n$$\n\\gamma_{\\mathrm{EP}} = C \\, \\Gamma_0(b) \\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv\n$$\nHere, $C$ is a coupling constant, $f_0(v)$ is the fast-ion equilibrium distribution function in parallel velocity $v$, $\\omega$ and $k$ are the wave frequency and parallel wavenumber, respectively, and $\\Gamma_0(b)$ is a gyroaverage factor accounting for finite Larmor radius (FLR) effects. The integral is evaluated over the parallel velocity space populated by numerical markers, from $v_{\\min}$ to $v_{\\max}$. The Dirac delta function, $\\delta(\\omega - k v)$, enforces the Landau resonance condition, $v = \\omega/k$, selecting only particles moving with this specific parallel velocity to contribute to the resonant drive.\n\nTo evaluate this integral, we employ the sifting property of the Dirac delta function, specifically its behavior under a change of variables. For a function $g(v)$, the following identity holds:\n$$\n\\int \\delta(g(v)) \\, h(v) \\, dv = \\sum_{i} \\frac{h(v_i)}{|g'(v_i)|}\n$$\nwhere the sum is over all simple roots $v_i$ of $g(v)$ within the integration domain. In our case, $g(v) = \\omega - k v$, and $h(v) = -\\frac{\\partial f_0}{\\partial v}$. The only root is $v = \\omega/k$, which we define as the resonant velocity, $v_{\\mathrm{res}}$. The derivative is $g'(v) = -k$. Thus, the integral evaluates to:\n$$\n\\int_{v_{\\min}}^{v_{\\max}} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\, \\delta(\\omega - k v) \\, dv = \\frac{1}{|k|} \\left(-\\frac{\\partial f_0}{\\partial v}\\right) \\bigg|_{v=v_{\\mathrm{res}}}\n$$\nThis result is non-zero only if the resonant velocity $v_{\\mathrm{res}}$ falls within the integration domain, i.e., $v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max}$. Otherwise, the integral is zero.\n\nThe fast-ion distribution is a shifted Gaussian:\n$$\nf_0(v) = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\nIts derivative with respect to $v$ is found using the chain rule:\n$$\n\\frac{\\partial f_0}{\\partial v} = \\frac{1}{\\sqrt{\\pi} v_{\\mathrm{th}}} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\cdot \\left(-\\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\\right) = -f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2}\n$$\nThe term required for the growth rate is therefore:\n$$\n-\\frac{\\partial f_0}{\\partial v} = f_0(v) \\frac{2(v - v_0)}{v_{\\mathrm{th}}^2} = \\frac{2(v - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v - v_0)^2}{v_{\\mathrm{th}}^2}\\right)\n$$\nThe term $\\partial f_0 / \\partial v$ is related to the gradient of the distribution function in velocity space, and its sign determines whether the wave is driven (growth) or damped.\n\nThe FLR effect is encapsulated by $\\Gamma_0(b) = I_0(b) e^{-b}$, where $b = (k_{\\perp} \\rho)^2/2$ and $I_0(b)$ is the modified Bessel function of the first kind of order zero.\n\nCombining these elements, the full analytic expression for the growth rate is:\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{an}} =\n\\begin{cases}\n\\frac{C \\, \\Gamma_0(b)}{|k|} \\left[ \\frac{2(v_{\\mathrm{res}} - v_0)}{\\sqrt{\\pi} v_{\\mathrm{th}}^3} \\exp\\left(-\\frac{(v_{\\mathrm{res}} - v_0)^2}{v_{\\mathrm{th}}^2}\\right) \\right]  \\text{if } v_{\\min} \\le v_{\\mathrm{res}} \\le v_{\\max} \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nwith $v_{\\mathrm{res}} = \\omega/k$.\n\nNext, we formulate the numerical marker-based quadrature for the growth rate, $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$. This approach approximates the integral by a discrete sum over $N$ markers. The Dirac delta function, which is singular, is replaced by a regularized, normalized Gaussian function:\n$$\n\\delta(x) \\approx \\delta_{\\sigma}(x) = \\frac{1}{\\sqrt{\\pi} \\sigma} \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right)\n$$\nwhere $\\sigma$ is a small width parameter. The integral is approximated as a Riemann sum using the midpoint rule over a uniform grid of $N$ markers. The velocity of the $j$-th marker is $v_j = v_{\\min} + (j - 1/2) \\Delta v$, with grid spacing $\\Delta v = (v_{\\max} - v_{\\min}) / N$.\n\nSubstituting these into the original integral for $\\gamma_{\\mathrm{EP}}$, we obtain the numerical estimate:\n$$\n\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} \\approx C \\, \\Gamma_0(b) \\sum_{j=1}^{N} \\left(-\\frac{\\partial f_0}{\\partial v}(v_j)\\right) \\delta_{\\sigma}(\\omega - k v_j) \\, \\Delta v\n$$\nEach term in the sum is evaluated at the marker velocity $v_j$. The term $-\\frac{\\partial f_0}{\\partial v}(v_j)$ is computed using the expression derived earlier, and $\\delta_{\\sigma}(\\omega - k v_j)$ is computed using its Gaussian form.\n\nThe computational task is to implement both formulas for $\\gamma_{\\mathrm{EP}}^{\\mathrm{an}}$ and $\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}}$ for the given test cases and calculate their absolute difference, $|\\gamma_{\\mathrm{EP}}^{\\mathrm{mc}} - \\gamma_{\\mathrm{EP}}^{\\mathrm{an}}|$. This difference serves as a measure of the accuracy of the numerical approximation, which depends on the number of markers $N$ and the resolution parameter $\\sigma$. The provided parameters, with a large $N=200000$ and a small $\\sigma = 0.02$, are chosen to ensure the numerical result is a close approximation of the analytical one.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes and compares analytic and marker-based estimates for the energetic particle\n    contribution to the TAE growth rate in a simplified linear gyrokinetic model.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Resonant peak, moderate FLR\n        {'v0': 1.5, 'v_th': 0.4, 'omega': 0.8, 'k': 0.5, 'k_perp_rho': 0.5, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 2: Far-tail resonance, small drive\n        {'v0': 1.0, 'v_th': 0.3, 'omega': 2.0, 'k': 0.5, 'k_perp_rho': 0.3, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 3: Strong FLR attenuation\n        {'v0': 1.5, 'v_th': 0.6, 'omega': 0.3, 'k': 0.3, 'k_perp_rho': 1.8, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n        # Case 4: Boundary resonance\n        {'v0': 2.0, 'v_th': 0.5, 'omega': 2.5, 'k': 0.5, 'k_perp_rho': 0.7, 'C': 1.0, 'sigma': 0.02, 'v_min': 0.0, 'v_max': 5.0, 'N': 200000},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Extract parameters\n        v0, v_th, omega, k = params['v0'], params['v_th'], params['omega'], params['k']\n        k_perp_rho, C, sigma = params['k_perp_rho'], params['C'], params['sigma']\n        v_min, v_max, N = params['v_min'], params['v_max'], params['N']\n\n        # Shared calculations\n        b = (k_perp_rho**2) / 2.0\n        gamma0_b = i0(b) * np.exp(-b)\n\n        # --- Analytic Calculation (gamma_an) ---\n        v_res = omega / k\n        gamma_an = 0.0\n\n        if v_min = v_res = v_max:\n            # -df0/dv evaluated at v_res\n            term1 = 2.0 * (v_res - v0) / (np.sqrt(np.pi) * v_th**3)\n            term2 = np.exp(-((v_res - v0)**2) / v_th**2)\n            df0_dv_res = term1 * term2\n            \n            gamma_an = (C * gamma0_b / np.abs(k)) * df0_dv_res\n\n        # --- Marker-based Calculation (gamma_mc) ---\n        delta_v = (v_max - v_min) / N\n        v_j = v_min + (np.arange(N) + 0.5) * delta_v\n\n        # -df0/dv evaluated at each marker velocity v_j\n        term1_mc = 2.0 * (v_j - v0) / (np.sqrt(np.pi) * v_th**3)\n        term2_mc = np.exp(-((v_j - v0)**2) / v_th**2)\n        df0_dv_j = term1_mc * term2_mc\n\n        # Gaussian representation of delta function\n        delta_sigma = (1.0 / (np.sqrt(np.pi) * sigma)) * np.exp(-((omega - k * v_j)**2) / sigma**2)\n\n        # Summation over markers\n        integrand_sum = np.sum(df0_dv_j * delta_sigma * delta_v)\n        gamma_mc = C * gamma0_b * integrand_sum\n\n        # Calculate absolute difference\n        abs_diff = np.abs(gamma_mc - gamma_an)\n        results.append(abs_diff)\n        \n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Once the growth rate of an instability can be calculated, the next critical step is to determine how it responds to changes in the energetic particle population. This exercise introduces the concept of sensitivity analysis, a powerful tool for identifying which parts of the particle phase space are most influential in driving or damping a mode . You will derive and compute the functional derivative of the growth rate, providing a quantitative map of the instability's response to perturbations in the distribution function.",
            "id": "3972672",
            "problem": "Consider a small-amplitude Alfvén Eigenmode (AE) in a tokamak plasma, where the energetic (fast) ion species is modeled by a distribution function $f(\\Gamma)$ over the reduced phase space $\\Gamma$ comprised of guiding-center coordinates. In the linear regime, the wave energy $W(t)$ obeys $dW/dt = 2\\,\\gamma[f]\\,W$, where $\\gamma[f]$ is the fast-ion contribution to the linear growth rate. For computational modeling, the energetic particle drive is represented by the functional\n$$\n\\gamma[f] = \\int_{\\Gamma} R(\\Gamma)\\,f(\\Gamma)\\,d\\Gamma + \\frac{1}{2}\\int_{\\Gamma}\\int_{\\Gamma'} f(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,f(\\Gamma')\\,d\\Gamma\\,d\\Gamma',\n$$\nwhere $R(\\Gamma)$ encodes the local resonant drive and $K(\\Gamma,\\Gamma')$ is a symmetric kernel, $K(\\Gamma,\\Gamma') = K(\\Gamma',\\Gamma)$, representing finite-orbit-width (FOW) nonlocal coupling. Assume the basis functions $\\{\\chi_i(\\Gamma)\\}_{i=1}^{N}$ form an orthonormal set with respect to the phase-space inner product, so that $\\int_{\\Gamma} \\chi_i(\\Gamma)\\,\\chi_j(\\Gamma)\\,d\\Gamma = \\delta_{ij}$. The distribution is discretized as $f(\\Gamma) = \\sum_{i=1}^{N} f_i\\,\\chi_i(\\Gamma)$, and the functional coefficients are defined by $R_i = \\int_{\\Gamma} R(\\Gamma)\\,\\chi_i(\\Gamma)\\,d\\Gamma$ and $K_{ij} = \\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,\\chi_j(\\Gamma')\\,d\\Gamma\\,d\\Gamma'$.\n\nStarting from fundamental principles of linear wave-particle energy transfer and the definition of the functional derivative, derive the discretized sensitivity vector of the AE growth rate with respect to the fast-ion distribution, namely the vector with components $g_i \\equiv (\\delta\\gamma/\\delta f)_i$, defined so that an arbitrary perturbation $\\delta f(\\Gamma) = \\sum_i \\delta f_i\\,\\chi_i(\\Gamma)$ produces\n$$\n\\delta\\gamma = \\sum_{i=1}^{N} g_i\\,\\delta f_i.\n$$\nThen, for $N=3$, evaluate $g_i$ numerically under the following scientifically consistent data:\n- The linear coefficients are $R_1 = 0.8\\ \\mathrm{s}^{-1}$, $R_2 = -0.2\\ \\mathrm{s}^{-1}$, and $R_3 = 0.5\\ \\mathrm{s}^{-1}$.\n- The symmetric coupling matrix (units of $\\mathrm{s}^{-1}$) is\n$$\nK = \\begin{pmatrix}\n0.5  -0.1  0.0 \\\\\n-0.1  0.3  0.05 \\\\\n0.0  0.05  0.2\n\\end{pmatrix}.\n$$\n- The discretized fast-ion distribution coefficients are $f_1 = 1.1$, $f_2 = -0.4$, and $f_3 = 0.9$.\n\nExpress the final sensitivity vector entries in $\\mathrm{s}^{-1}$, and round each entry to four significant figures. Provide the final answer as a single row matrix using the LaTeX $\\mathrm{pmatrix}$ environment.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and objective. It provides a complete and consistent setup for a solvable problem in the field of computational fusion science.\n\nThe task is to derive the sensitivity vector $g_i$ of the Alfvén Eigenmode (AE) growth rate $\\gamma$ with respect to the fast-ion distribution coefficients $f_i$, and then to compute its numerical value for a specific case.\n\nFirst, we express the growth rate functional $\\gamma[f]$ in its discretized form. The distribution function is given by the expansion $f(\\Gamma) = \\sum_{i=1}^{N} f_i\\,\\chi_i(\\Gamma)$. Substituting this into the definition of $\\gamma[f]$:\n$$\n\\gamma[f] = \\int_{\\Gamma} R(\\Gamma)\\left(\\sum_{j=1}^{N} f_j\\chi_j(\\Gamma)\\right)d\\Gamma + \\frac{1}{2}\\int_{\\Gamma}\\int_{\\Gamma'} \\left(\\sum_{i=1}^{N} f_i\\chi_i(\\Gamma)\\right)K(\\Gamma,\\Gamma')\\left(\\sum_{j=1}^{N} f_j\\chi_j(\\Gamma')\\right)d\\Gamma\\,d\\Gamma'\n$$\nUsing the definitions of the discretized coefficients $R_j = \\int_{\\Gamma} R(\\Gamma)\\,\\chi_j(\\Gamma)\\,d\\Gamma$ and $K_{ij} = \\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)\\,K(\\Gamma,\\Gamma')\\,\\chi_j(\\Gamma')\\,d\\Gamma\\,d\\Gamma'$, we can simplify the expression:\n$$\n\\gamma = \\sum_{j=1}^{N} f_j \\left(\\int_{\\Gamma} R(\\Gamma)\\chi_j(\\Gamma)d\\Gamma\\right) + \\frac{1}{2}\\sum_{i=1}^{N}\\sum_{j=1}^{N} f_i f_j \\left(\\int_{\\Gamma}\\int_{\\Gamma'} \\chi_i(\\Gamma)K(\\Gamma,\\Gamma')\\chi_j(\\Gamma')d\\Gamma\\,d\\Gamma'\\right)\n$$\nThis gives the growth rate as a function of the coefficients $f_i$:\n$$\n\\gamma(f_1, \\dots, f_N) = \\sum_{j=1}^{N} R_j f_j + \\frac{1}{2}\\sum_{i=1}^{N}\\sum_{j=1}^{N} f_i K_{ij} f_j\n$$\nIn vector and matrix notation, where $\\mathbf{f}$ is a column vector of the coefficients $f_i$, $\\mathbf{R}$ is a column vector of the $R_i$, and $K$ is the matrix of elements $K_{ij}$, this is written as:\n$$\n\\gamma(\\mathbf{f}) = \\mathbf{R}^T \\mathbf{f} + \\frac{1}{2}\\mathbf{f}^T K \\mathbf{f}\n$$\nThe sensitivity vector components $g_i$ are defined by the relation $\\delta\\gamma = \\sum_i g_i \\delta f_i$ for a small perturbation $\\delta f_i$. This is equivalent to defining $g_i$ as the partial derivative of $\\gamma$ with respect to $f_i$:\n$$\ng_i = \\frac{\\partial\\gamma}{\\partial f_i}\n$$\nWe compute this derivative:\n$$\ng_i = \\frac{\\partial}{\\partial f_i}\\left(\\sum_j R_j f_j\\right) + \\frac{1}{2}\\frac{\\partial}{\\partial f_i}\\left(\\sum_j\\sum_k f_j K_{jk} f_k\\right)\n$$\nThe derivative of the linear term is:\n$$\n\\frac{\\partial}{\\partial f_i}\\left(\\sum_j R_j f_j\\right) = \\sum_j R_j \\frac{\\partial f_j}{\\partial f_i} = \\sum_j R_j \\delta_{ij} = R_i\n$$\nThe derivative of the quadratic term is:\n$$\n\\frac{\\partial}{\\partial f_i}\\left(\\sum_j\\sum_k f_j K_{jk} f_k\\right) = \\sum_j\\sum_k \\left( \\frac{\\partial f_j}{\\partial f_i} K_{jk} f_k + f_j K_{jk} \\frac{\\partial f_k}{\\partial f_i} \\right) = \\sum_j\\sum_k \\left( \\delta_{ij} K_{jk} f_k + f_j K_{jk} \\delta_{ik} \\right)\n$$\n$$\n= \\sum_k K_{ik} f_k + \\sum_j f_j K_{ji}\n$$\nThe problem states that the kernel $K(\\Gamma,\\Gamma')$ is symmetric, which implies that the matrix $K$ is symmetric, i.e., $K_{ij} = K_{ji}$. Therefore, the second term $\\sum_j f_j K_{ji}$ can be rewritten as $\\sum_j f_j K_{ij}$. Renaming the summation index from $j$ to $k$, this is $\\sum_k f_k K_{ik} = \\sum_k K_{ik} f_k$.\nThus, the derivative of the quadratic term is $2\\sum_k K_{ik} f_k$.\n\nCombining the terms, the expression for $g_i$ is:\n$$\ng_i = R_i + \\frac{1}{2}\\left( 2\\sum_j K_{ij} f_j \\right) = R_i + \\sum_{j=1}^{N} K_{ij} f_j\n$$\nIn vector form, this is $\\mathbf{g} = \\mathbf{R} + K\\mathbf{f}$.\n\nNow we evaluate $g_i$ for the given case with $N=3$. The data provided are:\n$\\mathbf{R} = \\begin{pmatrix} 0.8 \\\\ -0.2 \\\\ 0.5 \\end{pmatrix} \\mathrm{s}^{-1}$\n$K = \\begin{pmatrix} 0.5  -0.1  0.0 \\\\ -0.1  0.3  0.05 \\\\ 0.0  0.05  0.2 \\end{pmatrix} \\mathrm{s}^{-1}$\n$\\mathbf{f} = \\begin{pmatrix} 1.1 \\\\ -0.4 \\\\ 0.9 \\end{pmatrix}$\n\nFirst, we compute the matrix-vector product $K\\mathbf{f}$:\n$$\nK\\mathbf{f} = \\begin{pmatrix} 0.5  -0.1  0.0 \\\\ -0.1  0.3  0.05 \\\\ 0.0  0.05  0.2 \\end{pmatrix} \\begin{pmatrix} 1.1 \\\\ -0.4 \\\\ 0.9 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix}\n(0.5)(1.1) + (-0.1)(-0.4) + (0.0)(0.9) \\\\\n(-0.1)(1.1) + (0.3)(-0.4) + (0.05)(0.9) \\\\\n(0.0)(1.1) + (0.05)(-0.4) + (0.2)(0.9)\n\\end{pmatrix}\n= \\begin{pmatrix}\n0.55 + 0.04 + 0 \\\\\n-0.11 - 0.12 + 0.045 \\\\\n0 - 0.02 + 0.18\n\\end{pmatrix}\n= \\begin{pmatrix}\n0.59 \\\\\n-0.185 \\\\\n0.16\n\\end{pmatrix} \\mathrm{s}^{-1}\n$$\nNext, we add the vector $\\mathbf{R}$ to find $\\mathbf{g}$:\n$$\n\\mathbf{g} = \\mathbf{R} + K\\mathbf{f} = \\begin{pmatrix} 0.8 \\\\ -0.2 \\\\ 0.5 \\end{pmatrix} + \\begin{pmatrix} 0.59 \\\\ -0.185 \\\\ 0.16 \\end{pmatrix} = \\begin{pmatrix} 0.8 + 0.59 \\\\ -0.2 - 0.185 \\\\ 0.5 + 0.16 \\end{pmatrix} = \\begin{pmatrix} 1.39 \\\\ -0.385 \\\\ 0.66 \\end{pmatrix} \\mathrm{s}^{-1}\n$$\nThe problem requires the final answer to be rounded to four significant figures.\n$g_1 = 1.390\\ \\mathrm{s}^{-1}$\n$g_2 = -0.3850\\ \\mathrm{s}^{-1}$\n$g_3 = 0.6600\\ \\mathrm{s}^{-1}$\n\nThe final sensitivity vector, as a row matrix, is $(1.390, -0.3850, 0.6600)$, with units of $\\mathrm{s}^{-1}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.390  -0.3850  0.6600\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The development of any numerical solver is incomplete without rigorous verification of its implementation. This practice introduces the Method of Manufactured Solutions (MMS), an essential technique for confirming that a code correctly solves the intended mathematical equations to the expected order of accuracy . By applying MMS to a model Alfvén wave equation, you will learn the fundamental workflow of code verification that underpins the reliability of complex simulation tools.",
            "id": "3972709",
            "problem": "You are asked to design and implement a verification test for a linear Alfvén Eigenmode (AE) solver using the method of manufactured solutions, and to quantify discretization error convergence in both frequency and damping rate. The solver acts on a scalar field $\\phi(x)$ defined on a one-dimensional periodic slab of length $L$. In non-dimensional units, the governing eigenvalue problem is\n$$\\left(-v_A^2 \\frac{d^2}{dx^2} + i\\sigma\\right)\\phi(x) = \\omega^2\\phi(x),$$\nwhere $v_A$ is the normalized Alfvén speed, $\\sigma$ is a constant that represents the net effect of energetic particle drive or damping, and $\\omega$ is the complex eigenfrequency. For a manufactured plane-wave solution $\\phi_m(x) = e^{i k x}$ with wavenumber $k$, the continuous symbol yields\n$$\\omega_{\\text{exact}}^2 = v_A^2 k^2 + i\\sigma,$$\nand we take the principal branch of the square root so that\n$$\\omega_{\\text{exact}} = \\sqrt{v_A^2 k^2 + i\\sigma}.$$\nDefine the frequency and damping rate as $f := \\Re(\\omega)$ and $\\gamma := -\\Im(\\omega)$, respectively.\n\nConsider a second-order central-difference discretization of $\\frac{d^2}{dx^2}$ on a uniform periodic grid with $N$ points and spacing $h = L/N$. Its discrete Fourier symbol for the Laplacian applied to $e^{i k x}$ is\n$$\\widehat{\\partial_{xx}}(k) \\approx -\\frac{4}{h^2}\\sin^2\\left(\\frac{k h}{2}\\right).$$\nThus, the discrete manufactured eigenvalue problem evaluated on the mode $e^{i k x}$ implies\n$$\\omega_h^2 = v_A^2\\widehat{k}_h^2 + i\\sigma, \\quad \\text{where} \\quad \\widehat{k}_h = \\frac{2}{h}\\sin\\left(\\frac{k h}{2}\\right),$$\nand $\\omega_h$ is again the principal branch of the square root. Let $f_h := \\Re(\\omega_h)$ and $\\gamma_h := -\\Im(\\omega_h)$. For a fixed manufactured wavenumber $k$, compute the discretization errors $|f_h - f|$ and $|\\gamma_h - \\gamma|$ for a sequence of grid spacings $h$ and estimate the observed orders of convergence $p_f$ and $p_\\gamma$ by performing a least-squares linear regression of $\\log(|\\text{error}|)$ versus $\\log(h)$.\n\nYour task is to implement a self-contained program that:\n- For each test case listed below, generates the sequence of grid sizes $N$, computes $h = L/N$, constructs the manufactured wavenumber $k$ as specified, evaluates $\\omega_{\\text{exact}}$ and $\\omega_h$, forms $f, \\gamma, f_h, \\gamma_h$, computes the errors $|f_h - f|$ and $|\\gamma_h - \\gamma|$, and fits a line to $(\\log(h), \\log(|\\text{error}|))$ to obtain the slopes $p_f$ and $p_\\gamma$.\n- Aggregates the results for all test cases into a single output line.\n\nAll quantities are non-dimensional, and angles are in radians. No external input is to be used. Use the following test suite:\n- Case 1 (happy path plane wave): $L = 2\\pi$, $v_A = 1$, $\\sigma = -10^{-3}$, integer mode $m = 3$ with $k = 2\\pi m / L$, and $N \\in \\{32, 64, 128, 256, 512\\}$.\n- Case 2 (fraction-of-Nyquist driven mode): $L = 2\\pi$, $v_A = 0.8$, $\\sigma = +2\\times 10^{-3}$, fraction $q = 0.45$ of the Nyquist wavenumber defined as follows: for each $N$, choose the integer mode $m(N) = \\lfloor q N/2 \\rfloor$ and set $k = 2\\pi m(N)/L$, with $N \\in \\{32, 64, 128, 256, 512\\}$.\n- Case 3 (high-wavenumber near-Nyquist damped mode): $L = 2\\pi$, $v_A = 1$, $\\sigma = -10^{-3}$, fraction $q = 0.90$, with the same definition of $m(N)$ and $k$ as in Case 2, and $N \\in \\{32, 64, 128, 256, 512\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases 1, 2, 3. Each case result must be a two-element list $[p_f, p_\\gamma]$ of floating-point numbers. For example, a valid output format is $[[p_{f,1},p_{\\gamma,1}],[p_{f,2},p_{\\gamma,2}],[p_{f,3},p_{\\gamma,3}]]$.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, and objective. It presents a standard verification task from computational plasma physics, specifically the calculation of discretization error convergence for a simplified Alfvén Eigenmode solver using the method of manufactured solutions. All parameters and procedures are explicitly defined, allowing for a unique and verifiable solution.\n\nThe solution proceeds as follows. First, we establish the mathematical framework for the continuous and discrete systems. Then, we outline the numerical procedure to compute the convergence orders for the given test cases.\n\nThe governing equation is a one-dimensional Helmholtz-type eigenvalue problem for the scalar field $\\phi(x)$:\n$$\n\\left(-v_A^2 \\frac{d^2}{dx^2} + i\\sigma\\right)\\phi(x) = \\omega^2\\phi(x)\n$$\nwhere $v_A$ is the Alfvén speed, $\\sigma$ is a drive/damping parameter, and $\\omega$ is the complex eigenfrequency. The analysis is performed on a periodic domain of length $L$.\n\nFor a manufactured plane-wave solution $\\phi_m(x) = e^{i k x}$, the differential operator $\\frac{d^2}{dx^2}$ acts as multiplication by $-k^2$. Substituting this into the governing equation yields the exact dispersion relation:\n$$\n\\omega_{\\text{exact}}^2 = v_A^2 k^2 + i\\sigma\n$$\nThe complex eigenfrequency $\\omega_{\\text{exact}}$ is found by taking the principal square root of the right-hand side. The frequency $f$ and damping rate $\\gamma$ are defined as the real and negative imaginary parts of $\\omega$, respectively:\n$$\nf := \\Re(\\omega), \\quad \\gamma := -\\Im(\\omega)\n$$\nA positive $\\gamma$ indicates an unstable (growing) mode, while a negative $\\gamma$ indicates a stable (damped) mode.\n\nThe numerical scheme employs a second-order central-difference approximation for the Laplacian, $\\frac{d^2}{dx^2}$, on a uniform grid of $N$ points with spacing $h = L/N$. The action of this discrete operator on the same plane wave $e^{i k x}$ is equivalent to multiplication by its Fourier symbol, which is given as:\n$$\n\\widehat{\\partial_{xx}}(k) \\approx -\\frac{4}{h^2}\\sin^2\\left(\\frac{k h}{2}\\right) =: -\\widehat{k}_h^2\n$$\nHere, we have defined an effective discrete wavenumber $\\widehat{k}_h = \\frac{2}{h}\\sin\\left(\\frac{k h}{2}\\right)$. The discrete dispersion relation is obtained by replacing $k^2$ with $\\widehat{k}_h^2$ in the exact dispersion relation:\n$$\n\\omega_h^2 = v_A^2\\widehat{k}_h^2 + i\\sigma\n$$\nThe numerical eigenfrequency $\\omega_h$ is the principal root of $\\omega_h^2$, from which the numerical frequency $f_h$ and damping rate $\\gamma_h$ are determined.\n\nThe discretization error arises from the difference between the exact wavenumber $k$ and the effective discrete wavenumber $\\widehat{k}_h$. For small arguments, i.e., $kh \\ll 1$, a Taylor expansion of $\\sin(kh/2)$ reveals the nature of this error:\n$$\n\\widehat{k}_h = \\frac{2}{h}\\left(\\frac{kh}{2} - \\frac{(kh)^3}{48} + \\mathcal{O}(h^5)\\right) = k - \\frac{k^3}{24}h^2 + \\mathcal{O}(h^4)\n$$\nThe error in $\\widehat{k}_h$ is of second order in $h$, i.e., $\\mathcal{O}(h^2)$. Consequently, the error in $\\omega_h$ compared to $\\omega_{\\text{exact}}$ is also expected to be $\\mathcal{O}(h^2)$. This implies that the errors in frequency, $|f_h - f|$, and damping rate, $|\\gamma_h - \\gamma|$, should both scale as $h^2$.\n\nTo verify this, we perform a convergence study. For a sequence of decreasing grid spacings $h$, we compute the corresponding errors. The order of convergence, $p$, is determined by the relationship $|\\text{error}| \\approx C h^p$, where $C$ is a constant. By taking the logarithm of both sides, we obtain a linear relationship:\n$$\n\\log(|\\text{error}|) \\approx p \\log(h) + \\log(C)\n$$\nWe can, therefore, estimate the convergence order $p$ as the slope of a line fitted to the data points $(\\log(h), \\log(|\\text{error}|))$ using a least-squares regression.\n\nThe procedure is applied to three test cases:\n1.  **Case 1:** A fixed, low wavenumber $k=3$. As $h \\to 0$, we are in the regime where $kh \\to 0$, so the Taylor series argument holds. We expect to observe convergence orders $p_f \\approx 2$ and $p_\\gamma \\approx 2$.\n2.  **Case 2  3:** The manufactured wavenumber $k$ is chosen as a fixed fraction of the Nyquist wavenumber ($\\pi/h$), so $k \\propto N \\propto 1/h$. As a result, the product $kh$ approaches a constant value. The Taylor expansion about $kh=0$ is no longer applicable. The error is dominated by the constant-in-h difference between $k^2$ and $\\widehat{k}_h^2$. A more detailed analysis shows that for large $N$, the error in frequency $|f_h - f|$ scales as $h^{-1}$ (divergence, $p_f \\approx -1$), while the error in damping rate $|\\gamma_h - \\gamma|$ scales as $h^1$ (convergence, $p_\\gamma \\approx 1$).\n\nThe algorithm for each case is as follows:\n1.  Initialize empty lists for $\\log(h)$, $\\log(|f_h - f|)$, and $\\log(|\\gamma_h - \\gamma|)$.\n2.  Iterate through the specified sequence of grid sizes $N$.\n3.  For each $N$, calculate $h=L/N$ and the case-specific wavenumber $k$.\n4.  Compute $\\omega_{\\text{exact}}$ and $\\omega_h$ using their respective dispersion relations and `numpy.sqrt` for the principal complex root.\n5.  Extract the frequencies ($f, f_h$) and damping rates ($\\gamma, \\gamma_h$).\n6.  Calculate the absolute errors and append their logarithms, along with $\\log(h)$, to the lists.\n7.  After the loop, use `scipy.stats.linregress` on the collected log-log data to find the slopes, which correspond to the observed convergence orders $p_f$ and $p_\\gamma$.\n8.  The results for all three cases are collected and formatted into a single output line as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n\n    def get_convergence_orders(L, vA, sigma, k_func, N_values):\n        \"\"\"\n        Calculates the observed order of convergence for frequency and damping rate.\n\n        Args:\n            L (float): Length of the periodic domain.\n            vA (float): Alfvén speed.\n            sigma (float): Drive/damping parameter.\n            k_func (callable): A function that takes N and returns the wavenumber k.\n            N_values (list of int): A list of grid sizes N to use for the study.\n\n        Returns:\n            list: A list containing the two float values [p_f, p_gamma].\n        \"\"\"\n        log_h_list = []\n        log_error_f_list = []\n        log_error_gamma_list = []\n\n        for N in N_values:\n            h = L / N\n            k = k_func(N)\n\n            # Exact (continuous) solution\n            omega_sq_exact = vA**2 * k**2 + 1j * sigma\n            omega_exact = np.sqrt(omega_sq_exact)\n            f_exact = np.real(omega_exact)\n            gamma_exact = -np.imag(omega_exact)\n\n            # Discrete solution from symbol\n            kh_over_2 = k * h / 2.0\n            k_h_hat = (2.0 / h) * np.sin(kh_over_2)\n            \n            omega_sq_h = vA**2 * k_h_hat**2 + 1j * sigma\n            omega_h = np.sqrt(omega_sq_h)\n            f_h = np.real(omega_h)\n            gamma_h = -np.imag(omega_h)\n\n            # Errors\n            error_f = np.abs(f_h - f_exact)\n            error_gamma = np.abs(gamma_h - gamma_exact)\n\n            # Store log of values for regression, avoiding log(0)\n            if error_f  1e-16 and error_gamma  1e-16:\n                log_h_list.append(np.log(h))\n                log_error_f_list.append(np.log(error_f))\n                log_error_gamma_list.append(np.log(error_gamma))\n        \n        # Perform linear regression to find slope (order of convergence)\n        p_f = stats.linregress(log_h_list, log_error_f_list).slope\n        p_gamma = stats.linregress(log_h_list, log_error_gamma_list).slope\n        \n        return [p_f, p_gamma]\n\n    # Common parameters for the test suite\n    N_values = [32, 64, 128, 256, 512]\n    L = 2 * np.pi\n\n    # Define the test cases\n    test_cases = [\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N: 3.0,\n        },\n        {\n            \"L\": L, \"vA\": 0.8, \"sigma\": 2e-3,\n            \"k_func\": lambda N, q=0.45: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        },\n        {\n            \"L\": L, \"vA\": 1.0, \"sigma\": -1e-3,\n            \"k_func\": lambda N, q=0.90: np.floor(q * N / 2.0) * (2.0 * np.pi / L),\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = get_convergence_orders(\n            L=case[\"L\"],\n            vA=case[\"vA\"],\n            sigma=case[\"sigma\"],\n            k_func=case[\"k_func\"],\n            N_values=N_values\n        )\n        all_results.append(result)\n\n    # Format the output string as specified: [[pf1,pg1],[pf2,pg2],[pf3,pg3]]\n    # Each sublist is converted to a string, then joined by commas.\n    list_of_strs = [f\"[{r[0]},{r[1]}]\" for r in all_results]\n    output_str = f\"[{','.join(list_of_strs)}]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}