{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a foundational, analytical comparison between gradient-driven and flux-driven approaches. By solving a simplified one-dimensional transport equation for both cases, you will directly see how prescribing a boundary gradient versus prescribing a boundary flux leads to different steady-state solutions . This practice is essential for building a core understanding of how boundary closures control the global behavior of a simulated profile.",
            "id": "3986727",
            "problem": "Consider a one-dimensional slab domain $x \\in [0,L]$ representing a simplified radial coordinate of a toroidal fusion device. Let $T(x,t)$ denote a temperature-like scalar field obeying conservation of a transported quantity with a volumetric source $s$ (assumed spatially uniform and time-independent). The transport flux closure combines diffusion and convection according to $q(x,t) = -\\chi \\,\\partial T/\\partial x + v\\,T$, where $\\chi > 0$ is a constant diffusivity and $v > 0$ is a constant convective velocity. Starting from the local conservation law $\\partial T/\\partial t + \\partial q/\\partial x = s$, derive the steady-state equation for $T(x)$.\n\nImpose the following two distinct boundary closures at $x=0$, with a common Dirichlet closure at $x=L$:\n\n- Case G (gradient-driven): prescribe the boundary gradient $\\partial T/\\partial x|_{x=0} = G_{0}$.\n- Case Q (flux-driven): prescribe the boundary flux $q(0) = Q_{0}$.\n\nIn both cases, let $T(L) = T_{L}$.\n\nSolve the steady-state boundary value problem for both cases and compute the closed-form analytic expression for the difference in the mid-plane value,\n$$\n\\Delta T_{\\mathrm{mid}} \\equiv T_{Q}(L/2) - T_{G}(L/2),\n$$\nwhere $T_{Q}$ and $T_{G}$ denote the steady-state solutions under the flux-driven and gradient-driven closures, respectively. Express your final answer as a single analytic expression in terms of $\\chi$, $v$, $s$, $L$, $G_{0}$, $Q_{0}$, and $T_{L}$. No numerical approximation is required.",
            "solution": "First, we derive the steady-state transport equation. The conservation law is given by\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\partial q}{\\partial x} = s\n$$\nIn steady state, $\\frac{\\partial T}{\\partial t} = 0$, so the equation simplifies to $\\frac{d q}{d x} = s$. Integrating this gives the flux profile $q(x) = sx + C$, where $C=q(0)$.\nThe full steady-state equation is obtained by substituting the flux closure $q(x) = -\\chi \\frac{dT}{dx} + vT$:\n$$\n\\frac{d}{dx}\\left(-\\chi \\frac{dT}{dx} + vT\\right) = s \\implies \\chi \\frac{d^2 T}{dx^2} - v \\frac{dT}{dx} = -s\n$$\nThis is a second-order linear ordinary differential equation (ODE) for the steady-state temperature profile $T(x)$.\n\nTo find the required difference, $\\Delta T_{\\mathrm{mid}} = T_Q(L/2) - T_G(L/2)$, we define the difference profile $\\delta T(x) = T_Q(x) - T_G(x)$. Since both $T_Q$ and $T_G$ satisfy the same non-homogeneous ODE, their difference $\\delta T(x)$ must satisfy the corresponding homogeneous ODE:\n$$\n\\chi \\frac{d^2(\\delta T)}{dx^2} - v \\frac{d(\\delta T)}{dx} = 0\n$$\nThe general solution is $\\delta T(x) = C_1 + C_2 \\exp\\left(\\frac{v}{\\chi}x\\right)$.\n\nWe now apply the boundary conditions for $\\delta T(x)$. At $x=L$, both solutions share the same boundary condition, $T_Q(L) = T_G(L) = T_L$. Thus, their difference is zero:\n$$\n\\delta T(L) = T_Q(L) - T_G(L) = 0\n$$\nApplying this to the general solution gives $C_1 + C_2 \\exp\\left(\\frac{vL}{\\chi}\\right) = 0$, which implies $C_1 = -C_2 \\exp\\left(\\frac{vL}{\\chi}\\right)$. The solution for the difference profile can be written as:\n$$\n\\delta T(x) = C_2 \\left( \\exp\\left(\\frac{vx}{\\chi}\\right) - \\exp\\left(\\frac{vL}{\\chi}\\right) \\right) = A \\left(1 - \\exp\\left(\\frac{v}{\\chi}(x-L)\\right)\\right)\n$$\nfor some constant $A = -C_2 \\exp\\left(\\frac{vL}{\\chi}\\right)$.\n\nTo find $A$, we use the boundary conditions at $x=0$. The difference in flux $\\delta q(x) = q_Q(x) - q_G(x)$ is constant, as can be seen by integrating the steady-state conservation law: $\\delta q(x) = q_Q(0) - q_G(0) = Q_0 - q_G(0)$. We can also express this difference using the flux definition:\n$$\n\\delta q(x) = \\left(-\\chi \\frac{dT_Q}{dx} + vT_Q\\right) - \\left(-\\chi \\frac{dT_G}{dx} + vT_G\\right) = -\\chi \\frac{d(\\delta T)}{dx} + v\\delta T\n$$\nEvaluating this at $x=L$, where $\\delta T(L) = 0$, we get $\\delta q(L) = -\\chi \\left.\\frac{d(\\delta T)}{dx}\\right|_{x=L}$. The derivative of $\\delta T(x)$ at $x=L$ is $\\left.\\frac{d(\\delta T)}{dx}\\right|_{x=L} = -A\\frac{v}{\\chi}$. Therefore, $\\delta q(L) = -\\chi(-A\\frac{v}{\\chi}) = Av$.\nSince the flux difference is constant, we have $Av = Q_0 - q_G(0)$, which means $A = \\frac{Q_0 - q_G(0)}{v}$.\n\nThe final step is to find the flux $q_G(0)$ resulting from the gradient-driven case. The general solution to the ODE is $T_G(x) = K_1 + K_2 \\exp\\left(\\frac{v}{\\chi}x\\right) + \\frac{s}{v}x$. Applying the boundary conditions $T_G'(0) = G_0$ and $T_G(L) = T_L$ allows us to solve for the integration constants $K_1$ and $K_2$ and then compute the flux at the boundary, $q_G(0) = -\\chi T_G'(0) + v T_G(0)$. This yields:\n$$\nq_G(0) = vT_L - sL - \\frac{s\\chi}{v} + \\chi\\left(\\frac{s}{v} - G_0\\right)\\exp\\left(\\frac{vL}{\\chi}\\right)\n$$\nSubstituting this into the expression for $A$ gives:\n$$\nA = \\frac{1}{v} \\left[ Q_0 - \\left(vT_L - sL - \\frac{s\\chi}{v} + \\chi\\left(\\frac{s}{v} - G_0\\right)\\exp\\left(\\frac{vL}{\\chi}\\right)\\right) \\right] = \\frac{1}{v} \\left[ Q_0 - vT_L + sL + \\frac{s\\chi}{v} + \\chi\\left(G_0 - \\frac{s}{v}\\right)\\exp\\left(\\frac{vL}{\\chi}\\right) \\right]\n$$\nFinally, we evaluate $\\delta T(x)$ at the mid-plane $x=L/2$:\n$$\n\\Delta T_{\\mathrm{mid}} = \\delta T(L/2) = A \\left(1 - \\exp\\left(\\frac{v}{\\chi}\\left(\\frac{L}{2}-L\\right)\\right)\\right) = A \\left(1 - \\exp\\left(-\\frac{vL}{2\\chi}\\right)\\right)\n$$\nSubstituting the expression for $A$ gives the final result.",
            "answer": "$$\n\\boxed{\\frac{1}{v} \\left( Q_{0} - vT_{L} + sL + \\frac{s\\chi}{v} + \\chi\\left(G_{0} - \\frac{s}{v}\\right)\\exp\\left(\\frac{vL}{\\chi}\\right) \\right) \\left(1 - \\exp\\left(-\\frac{vL}{2\\chi}\\right)\\right)}\n$$"
        },
        {
            "introduction": "Building on the steady-state analysis, this problem explores the dynamic consequences of combining different boundary condition types, a common scenario in realistic simulations. You will analytically derive the formation of a boundary layer resulting from a time-varying core heat flux (a flux-driven source) interacting with a fixed-temperature edge (a gradient-driven constraint) . Understanding the scaling of this boundary layer's thickness, $\\delta$, with physical parameters like diffusivity $\\chi$ and frequency $\\omega$ is a critical skill for both designing and interpreting transport experiments and simulations.",
            "id": "3986721",
            "problem": "Consider radial heat transport in a magnetically confined fusion plasma idealized as a one-dimensional slab with coordinate $x \\in [0,L]$, where $x=0$ represents the core side and $x=L$ the outer boundary. Assume cross-field heat transport is diffusive with a constant thermal diffusivity $\\chi$, and that the plasma is well-described by conservation of thermal energy coupled with Fourier’s law of heat conduction. Specifically, the radial heat flux $q(x,t)$ and the temperature $T(x,t)$ satisfy conservation of energy and Fickian closure in one spatial dimension, with no volumetric sources in the domain. This setting is representative of flux-driven simulations when a net heat flux is injected at the core while a boundary condition fixes the edge temperature, typical of a gradient-driven constraint.\n\nImpose a fixed outer temperature (Dirichlet) boundary condition $T(L,t)=T_{\\mathrm{edge}}$, held constant in time by a strong edge control system, and impose a core heat flux (Neumann) boundary condition at $x=0$ of the form\n$$\nq(0,t)=\\bar{q}+\\tilde{q}\\cos(\\omega t),\n$$\nwhere $\\bar{q}>0$ is a constant mean heat flux injected from the core, $\\tilde{q}$ is a small-amplitude modulation, and $\\omega>0$ is a single angular frequency. Assume that the modulation is sufficiently small to justify linearization about the steady state set by $\\bar{q}$ and that the modulation frequency satisfies the high-frequency limit $\\omega L^{2}/\\chi \\gg 1$, ensuring that any oscillatory boundary layer that forms near $x=L$ has thickness much smaller than $L$.\n\nStarting from conservation of thermal energy and Fourier’s law with constant $\\chi$, and without invoking any pre-packaged “penetration depth” formulas, derive the spatial structure of the time-harmonic temperature perturbation $\\tilde{T}(x)\\cos(\\omega t+\\phi)$ that rides on top of the steady profile. Show that the fixed outer temperature condition forces a rapidly varying layer near $x=L$, and determine the characteristic thickness $\\delta$ of this boundary layer by extracting the exponential decay length of the oscillatory solution away from $x=L$. \n\nProvide your final answer as a single closed-form analytic expression for $\\delta$ in terms of $\\chi$ and $\\omega$. No numerical evaluation is required. Do not include units in your final boxed answer. If you choose to check dimensional consistency, you may do so in your working. The requested final answer is a single expression only.",
            "solution": "The conservation of thermal energy in a one-dimensional system with no volumetric sources, combined with Fourier's law ($q = -k_{th} \\partial T / \\partial x$) and the definition of thermal diffusivity ($\\chi = k_{th}/c_v$, where $c_v$ is the volumetric heat capacity), gives the one-dimensional heat equation:\n$$\n\\frac{\\partial T}{\\partial t} = \\chi \\frac{\\partial^2 T}{\\partial x^2}\n$$\nWe linearize the solution by decomposing the temperature into a steady-state part and a small, time-varying perturbation: $T(x,t) = \\bar{T}(x) + \\tilde{T}(x,t)$. The equation for the perturbation $\\tilde{T}(x,t)$ is identical in form:\n$$\n\\frac{\\partial \\tilde{T}}{\\partial t} = \\chi \\frac{\\partial^2 \\tilde{T}}{\\partial x^2}\n$$\nGiven the harmonic nature of the driving flux, we seek a harmonic solution for the temperature perturbation using complex notation: $\\tilde{T}(x,t) = \\mathrm{Re}\\{\\hat{T}(x)e^{i\\omega t}\\}$. Here, $\\hat{T}(x)$ is a complex amplitude that encodes both the spatial amplitude and phase. Substituting this into the perturbation equation yields a second-order ordinary differential equation (ODE) for $\\hat{T}(x)$:\n$$\ni\\omega \\hat{T}(x) = \\chi \\frac{d^2 \\hat{T}(x)}{dx^2} \\implies \\frac{d^2 \\hat{T}}{dx^2} = \\frac{i\\omega}{\\chi} \\hat{T}\n$$\nThe general solution to this ODE is a superposition of exponential functions, $\\hat{T}(x) = C_1 e^{kx} + C_2 e^{-kx}$, where $k$ is the complex wave number defined by the characteristic equation:\n$$\nk^2 = \\frac{i\\omega}{\\chi}\n$$\nThe problem asks for the characteristic thickness $\\delta$ of the boundary layer, which is the exponential decay length of the solution. This length is the reciprocal of the magnitude of the real part of the wave number, $\\delta = 1/|\\mathrm{Re}(k)|$. To find $\\mathrm{Re}(k)$, we solve for $k$:\n$$\nk = \\sqrt{\\frac{i\\omega}{\\chi}} = \\sqrt{\\frac{\\omega}{\\chi}}\\sqrt{i}\n$$\nUsing the principal value of the square root of $i$, where $\\sqrt{i} = e^{i\\pi/4} = \\cos(\\pi/4) + i\\sin(\\pi/4) = \\frac{1+i}{\\sqrt{2}}$, we get:\n$$\nk = \\sqrt{\\frac{\\omega}{\\chi}} \\left( \\frac{1+i}{\\sqrt{2}} \\right) = \\sqrt{\\frac{\\omega}{2\\chi}} (1+i)\n$$\nThe real part of the wave number is therefore $k_r = \\mathrm{Re}(k) = \\sqrt{\\frac{\\omega}{2\\chi}}$. The characteristic decay length, or boundary layer thickness, is its reciprocal:\n$$\n\\delta = \\frac{1}{k_r} = \\frac{1}{\\sqrt{\\frac{\\omega}{2\\chi}}} = \\sqrt{\\frac{2\\chi}{\\omega}}\n$$\nThis length scale, often called the skin depth, represents the distance over which the amplitude of the high-frequency temperature oscillation decays by a factor of $e$. The high-frequency assumption $\\omega L^2/\\chi \\gg 1$ ensures that this decay length is much smaller than the system size $L$, so a distinct boundary layer forms.",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2\\chi}{\\omega}}}\n$$"
        },
        {
            "introduction": "This final practice moves from analytical derivation to practical implementation, challenging you to build a numerical solver for a flux-driven heat transport model in a realistic plasma geometry. You will implement a finite-volume scheme in cylindrical coordinates, handle physically motivated boundary conditions, and evolve the temperature profile in response to a prescribed heating source . This exercise provides hands-on experience with the complete workflow of setting up, running, and analyzing a canonical flux-driven simulation.",
            "id": "3986676",
            "problem": "Consider a one-dimensional radial heat transport model for a magnetically confined plasma core and edge in cylindrical geometry. The temperature profile $T(r,t)$ evolves under a constant-in-time volumetric heating source $S_T(r)$ and diffusive transport. The evolution is governed by the conservation of energy and Fourier’s heat conduction law, yielding the Partial Differential Equation (PDE)\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right) + S_T(r),\n$$\nfor $r \\in [0,a]$, with $a$ the minor radius, $\\chi$ the thermal diffusivity, and $S_T(r)$ the heating source. The no-flux boundary condition at the core enforces\n$$\n\\left.\\frac{\\partial T}{\\partial r}\\right|_{r=0} = 0,\n$$\nand the edge is coupled to a sink via a Robin boundary condition that models convective loss to the scrape-off layer,\n$$\n-\\chi\\,\\left.\\frac{\\partial T}{\\partial r}\\right|_{r=a} = h\\,[T(a,t) - T_{\\mathrm{edge}}],\n$$\nwhere $h$ is a heat-transfer coefficient and $T_{\\mathrm{edge}}$ is a prescribed edge temperature.\n\nThis setup is “flux-driven”: the profile $T(r,t)$ is allowed to evolve in response to the imposed source $S_T(r)$, and the outward heat flux at the edge adjusts self-consistently. In cylindrical geometry, integrating the PDE over $r$ shows that at steady state the outward edge heat flux satisfies\n$$\nF_{\\mathrm{out}} = -\\chi\\,\\left.\\frac{\\partial T}{\\partial r}\\right|_{r=a} = \\frac{1}{a}\\int_{0}^{a} r\\,S_T(r)\\,dr,\n$$\nwhich embodies flux-driven balance.\n\nYour task is to implement a finite-volume method in space with an implicit time integrator to evolve $T(r,t)$ under a constant-in-time source $S_T(r)$ and enforce the above boundary conditions. Use cell-centered discretization with $N$ uniform radial cells, cell centers at $r_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta r$ for $i \\in \\{0,\\dots,N-1\\}$, and faces at $r_{i+\\frac{1}{2}} = (i+1)\\Delta r$ with $\\Delta r = a/N$. The heating source is prescribed as a Gaussian,\n$$\nS_T(r) = S_0 \\exp\\!\\left(-\\left(\\frac{r}{r_s}\\right)^2\\right),\n$$\nwith constant amplitude $S_0$ and scale length $r_s$. Initialize $T(r,0) = 0$ for all $r$.\n\nImplement the discrete fluxes consistent with cylindrical geometry. The inner face flux at $r=0$ must be zero to enforce the no-flux core boundary condition. The outer face flux at $r=a$ must satisfy the Robin condition, which in the finite-volume formulation translates into eliminating the ghost cell using the relation\n$$\n-\\chi\\,\\frac{T_N - T_{N-1}}{\\Delta r} = h\\,[T_{N-1} - T_{\\mathrm{edge}}],\n$$\nwhere $T_N$ is the ghost value beyond the edge and $T_{N-1}$ is the edge cell-center value. Use an implicit Euler time step of size $\\Delta t$ to evolve to a final time $t_{\\mathrm{end}}$, constructing the linear system\n$$\n\\left(\\mathbf{I} - \\Delta t\\,\\mathbf{L}\\right)\\,\\mathbf{T}^{n+1} = \\mathbf{T}^{n} + \\Delta t\\,\\left(\\mathbf{S} + \\mathbf{g}\\right),\n$$\nwhere $\\mathbf{L}$ is the discrete diffusion operator incorporating the geometry and boundary conditions, $\\mathbf{S}$ is the discrete source vector, and $\\mathbf{g}$ is the constant vector arising from the Robin boundary condition’s edge temperature term.\n\nUnits: use meters (m) for $r$, seconds (s) for $t$, kilo-electronvolts (keV) for $T$, meters squared per second ($\\mathrm{m}^2/\\mathrm{s}$) for $\\chi$, meters per second ($\\mathrm{m}/\\mathrm{s}$) for $h$, and kilo-electronvolts per second (keV/s) for $S_T$. Report the final outward edge heat flux $F_{\\mathrm{out}}(t_{\\mathrm{end}})$ in keV·m/s and the magnitude of the core gradient $\\left|\\partial T/\\partial r\\right|_{r=0}(t_{\\mathrm{end}})$ in keV/m.\n\nDesign a program that computes these two quantities for each test case described below. Use the following test suite, which covers a general case, a zero-source edge case, a high-diffusivity case, and a small-domain weak-sink case:\n\n- Test Case $1$ (general “happy path”): $a = 1.0\\,\\mathrm{m}$, $\\chi = 1.0\\,\\mathrm{m}^2/\\mathrm{s}$, $h = 3.0\\,\\mathrm{m}/\\mathrm{s}$, $T_{\\mathrm{edge}} = 0.0\\,\\mathrm{keV}$, $S_0 = 2.0\\,\\mathrm{keV}/\\mathrm{s}$, $r_s = 0.3\\,\\mathrm{m}$, $N = 256$, $\\Delta t = 0.01\\,\\mathrm{s}$, $t_{\\mathrm{end}} = 1.5\\,\\mathrm{s}$.\n- Test Case $2$ (zero source): $a = 1.0\\,\\mathrm{m}$, $\\chi = 1.0\\,\\mathrm{m}^2/\\mathrm{s}$, $h = 3.0\\,\\mathrm{m}/\\mathrm{s}$, $T_{\\mathrm{edge}} = 0.0\\,\\mathrm{keV}$, $S_0 = 0.0\\,\\mathrm{keV}/\\mathrm{s}$, $r_s = 0.3\\,\\mathrm{m}$, $N = 256$, $\\Delta t = 0.1\\,\\mathrm{s}$, $t_{\\mathrm{end}} = 1.0\\,\\mathrm{s}$.\n- Test Case $3$ (high diffusivity): $a = 1.0\\,\\mathrm{m}$, $\\chi = 10.0\\,\\mathrm{m}^2/\\mathrm{s}$, $h = 3.0\\,\\mathrm{m}/\\mathrm{s}$, $T_{\\mathrm{edge}} = 0.0\\,\\mathrm{keV}$, $S_0 = 2.0\\,\\mathrm{keV}/\\mathrm{s}$, $r_s = 0.3\\,\\mathrm{m}$, $N = 256$, $\\Delta t = 0.01\\,\\mathrm{s}$, $t_{\\mathrm{end}} = 0.3\\,\\mathrm{s}$.\n- Test Case $4$ (small domain, weak sink): $a = 0.5\\,\\mathrm{m}$, $\\chi = 1.0\\,\\mathrm{m}^2/\\mathrm{s}$, $h = 0.5\\,\\mathrm{m}/\\mathrm{s}$, $T_{\\mathrm{edge}} = 0.0\\,\\mathrm{keV}$, $S_0 = 1.5\\,\\mathrm{keV}/\\mathrm{s}$, $r_s = 0.2\\,\\mathrm{m}$, $N = 256$, $\\Delta t = 0.02\\,\\mathrm{s}$, $t_{\\mathrm{end}} = 1.0\\,\\mathrm{s}$.\n\nFor each test case, compute:\n- The final outward edge heat flux $F_{\\mathrm{out}}(t_{\\mathrm{end}}) = h\\,[T(a,t_{\\mathrm{end}}) - T_{\\mathrm{edge}}]$ in keV·m/s.\n- The magnitude of the core gradient $\\left|\\partial T/\\partial r\\right|_{r=0}(t_{\\mathrm{end}})$ in keV/m, approximated by the one-sided difference at the innermost cell centers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain $8$ floating-point numbers in the order\n$$\n\\left[F_{\\mathrm{out}}^{(1)},\\left|\\partial_r T\\right|_{0}^{(1)},F_{\\mathrm{out}}^{(2)},\\left|\\partial_r T\\right|_{0}^{(2)},F_{\\mathrm{out}}^{(3)},\\left|\\partial_r T\\right|_{0}^{(3)},F_{\\mathrm{out}}^{(4)},\\left|\\partial_r T\\right|_{0}^{(4)}\\right],\n$$\nwhere the superscript $^{(k)}$ refers to Test Case $k$.",
            "solution": "The problem requires the numerical solution of a one-dimensional radial heat transport equation in cylindrical geometry using a finite-volume method. We will first validate the problem statement and then develop the solution by discretizing the governing partial differential equation (PDE) and implementing the specified boundary conditions.\n\nThe governing PDE for the temperature profile $T(r,t)$ is given by:\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right) + S_T(r)\n$$\nThis equation describes the conservation of energy, where the change in temperature over time is driven by heat diffusion (the first term on the right-hand side) and a volumetric heat source $S_T(r)$. The thermal diffusivity $\\chi$ is assumed to be constant.\n\nTo solve this equation numerically, we employ a finite-volume method. The radial domain $r \\in [0, a]$ is divided into $N$ uniform cells. The $i$-th cell, for $i \\in \\{0, 1, \\dots, N-1\\}$, is defined by the interval $[r_{i-1/2}, r_{i+1/2}]$, where cell faces are located at $r_{i+1/2} = (i+1)\\Delta r$ with $\\Delta r = a/N$. The cell centers are at $r_i = (i + 1/2)\\Delta r$. The temperature within cell $i$ is represented by a single value $T_i(t)$, which is an approximation of the temperature at the cell center, $T(r_i, t)$.\n\nWe begin by multiplying the PDE by $r$ and integrating over the volume of the $i$-th cell, which in one dimension (per unit length and angle) corresponds to integrating from $r_{i-1/2}$ to $r_{i+1/2}$:\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} r \\frac{\\partial T}{\\partial t} \\,dr = \\int_{r_{i-1/2}}^{r_{i+1/2}} \\frac{\\partial}{\\partial r}\\left(r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right) \\,dr + \\int_{r_{i-1/2}}^{r_{i+1/2}} r S_T(r) \\,dr\n$$\nApproximating the integrals with midpoint rule values for quantities that vary smoothly over the cell, we get:\n$$\n(r_i \\Delta r) \\frac{dT_i}{dt} \\approx \\left[r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right]_{r_{i+1/2}} - \\left[r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right]_{r_{i-1/2}} + (r_i \\Delta r) S_T(r_i)\n$$\nThe terms on the right-hand side represent the heat fluxes across the cell faces. Let's define the radial heat flux density as $F_r = -\\chi \\frac{\\partial T}{\\partial r}$, so the term $r \\chi \\frac{\\partial T}{\\partial r}$ is $-r F_r$. We discretize the spatial derivative using a central difference scheme at the cell faces:\n$$\n\\left.\\frac{\\partial T}{\\partial r}\\right|_{r_{i+1/2}} \\approx \\frac{T_{i+1} - T_i}{\\Delta r}\n$$\nThe flux term at the face $r_{i+1/2}$ becomes:\n$$\nJ_{i+1/2} = \\left[r\\,\\chi\\,\\frac{\\partial T}{\\partial r}\\right]_{r_{i+1/2}} \\approx r_{i+1/2} \\chi \\frac{T_{i+1} - T_i}{\\Delta r}\n$$\nSubstituting this into the integrated equation and dividing by $r_i \\Delta r$ gives the semi-discrete equation for an interior cell $i \\in \\{1, \\dots, N-2\\}$:\n$$\n\\frac{dT_i}{dt} = \\frac{1}{r_i \\Delta r} \\left( r_{i+1/2} \\chi \\frac{T_{i+1} - T_i}{\\Delta r} - r_{i-1/2} \\chi \\frac{T_i - T_{i-1}}{\\Delta r} \\right) + S_i\n$$\nwhere $S_i = S_T(r_i)$.\n\nNow, we must incorporate the boundary conditions for the cells at the core ($i=0$) and the edge ($i=N-1$).\n\nFor the core cell ($i=0$), the domain is $[r_{-1/2}, r_{1/2}] = [0, \\Delta r]$. The no-flux boundary condition at the center, $\\left.\\frac{\\partial T}{\\partial r}\\right|_{r=0} = 0$, implies that the flux at the face $r_{-1/2}=0$ is zero, i.e., $J_{-1/2} = 0$. The equation for cell $0$ becomes:\n$$\n\\frac{dT_0}{dt} = \\frac{1}{r_0 \\Delta r} \\left( J_{1/2} - J_{-1/2} \\right) + S_0 = \\frac{1}{r_0 \\Delta r} \\left( r_{1/2} \\chi \\frac{T_1 - T_0}{\\Delta r} - 0 \\right) + S_0\n$$\nSubstituting $r_0 = \\Delta r/2$ and $r_{1/2} = \\Delta r$:\n$$\n\\frac{dT_0}{dt} = \\frac{1}{(\\Delta r/2) \\Delta r} \\left( \\Delta r \\chi \\frac{T_1 - T_0}{\\Delta r} \\right) + S_0 = \\frac{2\\chi}{\\Delta r^2} (T_1 - T_0) + S_0\n$$\n\nFor the edge cell ($i=N-1$), the domain is $[r_{N-3/2}, r_{N-1/2}] = [r_{N-3/2}, a]$. The flux at the outer face $r_{N-1/2}=a$ is determined by the Robin boundary condition:\n$$\n-\\chi\\,\\left.\\frac{\\partial T}{\\partial r}\\right|_{r=a} = h\\,[T(a,t) - T_{\\mathrm{edge}}]\n$$\nThe flux term $J_{N-1/2}$ is $\\left. r \\chi \\frac{\\partial T}{\\partial r} \\right|_{r=a} = a \\chi \\left. \\frac{\\partial T}{\\partial r} \\right|_{r=a}$. Using the Robin condition, this becomes:\n$$\nJ_{N-1/2} = -a h [T(a,t) - T_{\\mathrm{edge}}]\n$$\nWe approximate the temperature at the boundary $T(a,t)$ with the temperature of the last cell center, $T_{N-1}$. Thus, $J_{N-1/2} \\approx -a h (T_{N-1} - T_{\\mathrm{edge}})$. The equation for cell $N-1$ is:\n$$\n\\frac{dT_{N-1}}{dt} = \\frac{1}{r_{N-1} \\Delta r} \\left( J_{N-1/2} - J_{N-3/2} \\right) + S_{N-1}\n$$\n$$\n\\frac{dT_{N-1}}{dt} = \\frac{1}{r_{N-1} \\Delta r} \\left( -a h (T_{N-1} - T_{\\mathrm{edge}}) - r_{N-3/2} \\chi \\frac{T_{N-1} - T_{N-2}}{\\Delta r} \\right) + S_{N-1}\n$$\nThis system of $N$ ordinary differential equations can be written in matrix form:\n$$\n\\frac{d\\mathbf{T}}{dt} = \\mathbf{L}\\mathbf{T} + \\mathbf{S} + \\mathbf{g}\n$$\nwhere $\\mathbf{T}$ is the vector of cell temperatures $[T_0, T_1, \\dots, T_{N-1}]^T$, $\\mathbf{L}$ is the tridiagonal matrix representing the discretized diffusion operator, $\\mathbf{S}$ is the vector of source terms $[S_0, S_1, \\dots, S_{N-1}]^T$, and $\\mathbf{g}$ is a vector containing the constant part of the boundary condition. Only the last element of $\\mathbf{g}$ is non-zero: $g_{N-1} = \\frac{ahT_{\\mathrm{edge}}}{r_{N-1}\\Delta r}$. The matrix $\\mathbf{L}$ has the following non-zero elements:\n- Upper diagonal ($i \\in \\{0, \\dots, N-2\\}$): $L_{i, i+1} = \\frac{\\chi}{\\Delta r^2} \\frac{r_{i+1/2}}{r_i} = \\frac{\\chi}{\\Delta r^2} \\frac{i+1}{i+0.5}$\n- Main diagonal ($i \\in \\{0, \\dots, N-1\\}$): $L_{i,i} = -\\frac{\\chi}{\\Delta r^2}\\frac{r_{i+1/2}+r_{i-1/2}}{r_i} = - \\frac{2\\chi}{\\Delta r^2}$ (for $i  N-1$) and $L_{N-1,N-1} = -\\frac{ah}{r_{N-1}\\Delta r} - \\frac{\\chi r_{N-3/2}}{r_{N-1}\\Delta r^2}$\n- Lower diagonal ($i \\in \\{1, \\dots, N-1\\}$): $L_{i, i-1} = \\frac{\\chi}{\\Delta r^2} \\frac{r_{i-1/2}}{r_i} = \\frac{\\chi}{\\Delta r^2} \\frac{i}{i+0.5}$\n\nFor time integration, we use the implicit Euler method, which is unconditionally stable. The time derivative is approximated as $\\frac{d\\mathbf{T}}{dt} \\approx \\frac{\\mathbf{T}^{n+1} - \\mathbf{T}^n}{\\Delta t}$. The implicit scheme evaluates the right-hand side at the future time step $n+1$:\n$$\n\\frac{\\mathbf{T}^{n+1} - \\mathbf{T}^n}{\\Delta t} = \\mathbf{L}\\mathbf{T}^{n+1} + \\mathbf{S} + \\mathbf{g}\n$$\nRearranging the terms to solve for $\\mathbf{T}^{n+1}$, we get the linear system specified in the problem:\n$$\n(\\mathbf{I} - \\Delta t \\mathbf{L}) \\mathbf{T}^{n+1} = \\mathbf{T}^n + \\Delta t (\\mathbf{S} + \\mathbf{g})\n$$\nwhere $\\mathbf{I}$ is the identity matrix. At each time step, we solve this tridiagonal linear system for $\\mathbf{T}^{n+1}$. The initial condition is $T(r,0)=0$, so $\\mathbf{T}^0 = \\mathbf{0}$.\n\nAfter evolving the system to the final time $t_{\\mathrm{end}}$, we compute the required quantities.\nThe final outward edge heat flux is given by the convective loss term:\n$$\nF_{\\mathrm{out}}(t_{\\mathrm{end}}) = h\\,[T(a,t_{\\mathrm{end}}) - T_{\\mathrm{edge}}] \\approx h\\,[T_{N-1}(t_{\\mathrm{end}}) - T_{\\mathrm{edge}}]\n$$\nThe magnitude of the core gradient is approximated using a one-sided finite difference between the two innermost cell centers:\n$$\n\\left|\\frac{\\partial T}{\\partial r}\\right|_{r=0}(t_{\\mathrm{end}}) \\approx \\left| \\frac{T_1(t_{\\mathrm{end}}) - T_0(t_{\\mathrm{end}})}{\\Delta r} \\right|\n$$\nThis quantity is a simple numerical diagnostic of the profile shape near the core; it represents the gradient at $r \\approx \\Delta r/2$ rather than at $r=0$, where the analytical gradient is zero by symmetry.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases for the plasma heat transport problem.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (general “happy path”)\n        (1.0, 1.0, 3.0, 0.0, 2.0, 0.3, 256, 0.01, 1.5),\n        # Test Case 2 (zero source)\n        (1.0, 1.0, 3.0, 0.0, 0.0, 0.3, 256, 0.1, 1.0),\n        # Test Case 3 (high diffusivity)\n        (1.0, 10.0, 3.0, 0.0, 2.0, 0.3, 256, 0.01, 0.3),\n        # Test Case 4 (small domain, weak sink)\n        (0.5, 1.0, 0.5, 0.0, 1.5, 0.2, 256, 0.02, 1.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        F_out, core_grad_mag = simulate_heat_transport(*params)\n        results.extend([F_out, core_grad_mag])\n    \n    print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n\ndef simulate_heat_transport(a, chi, h, T_edge, S0, rs, N, dt, t_end):\n    \"\"\"\n    Solves the 1D radial heat transport equation using a finite-volume method.\n\n    Args:\n        a (float): Minor radius [m].\n        chi (float): Thermal diffusivity [m^2/s].\n        h (float): Heat-transfer coefficient [m/s].\n        T_edge (float): Prescribed edge temperature [keV].\n        S0 (float): Heating source amplitude [keV/s].\n        rs (float): Heating source scale length [m].\n        N (int): Number of radial cells.\n        dt (float): Time step size [s].\n        t_end (float): Final simulation time [s].\n\n    Returns:\n        tuple: A tuple containing:\n            - F_out (float): Final outward edge heat flux [keV·m/s].\n            - core_grad_mag (float): Magnitude of the core gradient approximation [keV/m].\n    \"\"\"\n    dr = a / N\n    \n    # Grid setup\n    i_vals = np.arange(N)\n    r_centers = (i_vals + 0.5) * dr\n\n    # Source vector S\n    S_vec = S0 * np.exp(-(r_centers / rs)**2) if rs  0 else np.full(N, S0)\n\n    # Constant boundary vector g\n    g_vec = np.zeros(N)\n    # The term is only non-zero if h != 0 and T_edge != 0.\n    if abs(h) > 0 and abs(T_edge) > 0:\n        g_vec[N - 1] = (a * h * T_edge) / (r_centers[N - 1] * dr)\n\n    # Build the diffusion matrix L\n    L_main = np.zeros(N)\n    L_upper = np.zeros(N - 1)\n    L_lower = np.zeros(N - 1)\n\n    # Vectorized calculation for L matrix components\n    i_upper = np.arange(N - 1)  # Matrix indices i=0 to N-2\n    L_upper = (chi / dr**2) * ((i_upper + 1) / (i_upper + 0.5))\n\n    i_lower = np.arange(1, N)  # Matrix indices i=1 to N-1\n    L_lower = (chi / dr**2) * (i_lower / (i_lower + 0.5))\n\n    L_main[:N-1] = -2.0 * chi / dr**2\n    L_main[N-1] = -(N * h / ((N - 0.5) * dr)) - (chi * (N - 1) / ((N - 0.5) * dr**2))\n\n    # Form the implicit evolution matrix M = I - dt*L for solve_banded\n    # M_banded[0,:] = super-diagonal (upper), M_banded[1,:] = main diagonal, M_banded[2,:] = sub-diagonal (lower)\n    M_banded = np.zeros((3, N))\n    M_banded[0, 1:] = -dt * L_upper\n    M_banded[1, :] = 1.0 - dt * L_main\n    M_banded[2, :-1] = -dt * L_lower\n\n    # Time evolution loop\n    T = np.zeros(N)  # Initial condition T(r,0) = 0\n    num_steps = int(round(t_end / dt))\n    \n    # Pre-calculate the time-independent part of the right-hand side\n    rhs_const_part = dt * (S_vec + g_vec)\n    \n    for _ in range(num_steps):\n        rhs = T + rhs_const_part\n        T = solve_banded((1, 1), M_banded, rhs)\n\n    # Calculate final quantities\n    F_out = h * (T[N - 1] - T_edge)\n    core_grad_mag = np.abs((T[1] - T[0]) / dr)\n    \n    return F_out, core_grad_mag\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}