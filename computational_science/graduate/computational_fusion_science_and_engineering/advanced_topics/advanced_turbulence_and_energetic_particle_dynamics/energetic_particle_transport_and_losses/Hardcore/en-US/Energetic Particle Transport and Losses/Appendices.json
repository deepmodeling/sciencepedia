{
    "hands_on_practices": [
        {
            "introduction": "Before we can model the transport of energetic particles, we must first be confident in our most fundamental simplification: the guiding-center approximation. This exercise challenges you to quantify the conditions for its validity by calculating the key dimensionless parameters that measure the separation of scales between the particle's gyromotion and the background magnetic field variations . By doing so, you will develop a concrete understanding of when this powerful approximation can be reliably applied.",
            "id": "3973328",
            "problem": "A circular tokamak of large aspect ratio is modeled with major radius $R_0$ and minor radius $a$. The toroidal magnetic field is taken as $B_{\\mathrm{t}}(R) = B_0 R_0 / R$, where $R$ is the major-radius coordinate. Consider a $1.0\\ \\mathrm{MeV}$ alpha particle at the outboard midplane of the edge, located at $R_{\\mathrm{edge}} = R_0 + a$. Assume the following parameters: $R_0 = 3.0\\ \\mathrm{m}$, $a = 0.6\\ \\mathrm{m}$, $B_0 = 2.8\\ \\mathrm{T}$, the alpha particle charge $q_{\\alpha} = 2e$, the alpha particle mass $m_{\\alpha} = 6.644657 \\times 10^{-27}\\ \\mathrm{kg}$, and the relative toroidal field ripple amplitude at the outboard midplane $\\delta B / B = 8.0 \\times 10^{-3}$. The particle has pitch-angle $\\alpha = 60^\\circ$ at the outboard midplane. Angles must be handled in degrees.\n\nStarting from first principles of charged-particle motion in a magnetic field and the nonrelativistic kinetic energy relation, compute the particleâ€™s cyclotron frequency, gyroradius, and the characteristic magnetic field scale-lengths at the edge. Use these to evaluate the dimensionless measures $\\rho/a$, $\\rho/L_B$, and $\\delta B/B$ at $R_{\\mathrm{edge}}$, where $\\rho$ is the Larmor radius and $L_B \\equiv B/|\\nabla B|$ is the magnetic field gradient scale-length. For the curvature of field lines at the outboard midplane in a large-aspect-ratio tokamak, you may take the curvature scale $L_c \\equiv 1/|\\hat{\\boldsymbol{b}}\\cdot\\nabla \\hat{\\boldsymbol{b}}|$ to be of order $R_{\\mathrm{edge}}$, and you should estimate it accordingly.\n\nDefine a single guiding-center smallness indicator by\n$\\epsilon_{\\mathrm{gc}} \\equiv \\max\\left\\{\\rho/a,\\ \\rho/L_B,\\ \\delta B/B\\right\\}$,\nand compute it as a single dimensionless number.\n\nRound your final value of $\\epsilon_{\\mathrm{gc}}$ to three significant figures. The final answer must be a single real number without units.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- Tokamak major radius: $R_0 = 3.0\\ \\mathrm{m}$\n- Tokamak minor radius: $a = 0.6\\ \\mathrm{m}$\n- Toroidal magnetic field model: $B_{\\mathrm{t}}(R) = B_0 R_0 / R$\n- On-axis magnetic field: $B_0 = 2.8\\ \\mathrm{T}$\n- Particle: Alpha particle\n- Particle kinetic energy: $K = 1.0\\ \\mathrm{MeV}$\n- Particle initial position: Outboard midplane edge, $R_{\\mathrm{edge}} = R_0 + a$\n- Alpha particle charge: $q_{\\alpha} = 2e$\n- Alpha particle mass: $m_{\\alpha} = 6.644657 \\times 10^{-27}\\ \\mathrm{kg}$\n- Relative toroidal field ripple at the outboard midplane: $\\delta B / B = 8.0 \\times 10^{-3}$\n- Particle pitch angle at the outboard midplane: $\\alpha = 60^\\circ$\n- Definition of magnetic field gradient scale-length: $L_B \\equiv B/|\\nabla B|$\n- Definition of guiding-center smallness indicator: $\\epsilon_{\\mathrm{gc}} \\equiv \\max\\left\\{\\rho/a,\\ \\rho/L_B,\\ \\delta B/B\\right\\}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the well-established theory of charged particle motion in magnetic fields, specifically the guiding-center approximation in the context of a tokamak, which is central to fusion plasma physics. The provided tokamak model ($B \\propto 1/R$) is a standard large-aspect-ratio approximation. All parameters (dimensions, field strength, particle energy) are realistic for contemporary fusion experiments. The problem is well-posed, objective, and self-contained, providing all necessary physical constants, definitions, and data to compute the required quantities. The instructions are unambiguous. The problem does not violate any scientific principles, contain contradictions, or rely on subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is assessed as **valid**. A full solution will be provided.\n\n### Solution Derivation\nThe solution proceeds by first calculating the physical parameters of the particle and the magnetic field at the specified location. Then, the dimensionless ratios are computed to determine the guiding-center smallness indicator.\n\nFirst, we determine the properties at the particle's location, the outboard midplane edge. The major radius at this point is:\n$$R_{\\mathrm{edge}} = R_0 + a = 3.0\\ \\mathrm{m} + 0.6\\ \\mathrm{m} = 3.6\\ \\mathrm{m}$$\nThe magnetic field strength at this location is given by the toroidal field model:\n$$B_{\\mathrm{edge}} = B_{\\mathrm{t}}(R_{\\mathrm{edge}}) = B_0 \\frac{R_0}{R_{\\mathrm{edge}}} = (2.8\\ \\mathrm{T}) \\frac{3.0\\ \\mathrm{m}}{3.6\\ \\mathrm{m}} = 2.8 \\times \\frac{5}{6}\\ \\mathrm{T} = \\frac{7}{3}\\ \\mathrm{T}$$\n\nNext, we calculate the particle's properties. The kinetic energy is given as $K = 1.0\\ \\mathrm{MeV}$. We convert this to Joules using the elementary charge $e = 1.60217663 \\times 10^{-19}\\ \\mathrm{C}$:\n$$K = 1.0 \\times 10^6\\ \\mathrm{eV} \\times (1.60217663 \\times 10^{-19}\\ \\mathrm{J/eV}) = 1.60217663 \\times 10^{-13}\\ \\mathrm{J}$$\nThe particle's total speed $v$ is derived from the nonrelativistic kinetic energy relation $K = \\frac{1}{2} m_{\\alpha} v^2$:\n$$v = \\sqrt{\\frac{2K}{m_{\\alpha}}} = \\sqrt{\\frac{2(1.60217663 \\times 10^{-13}\\ \\mathrm{J})}{6.644657 \\times 10^{-27}\\ \\mathrm{kg}}} \\approx 6.944 \\times 10^6\\ \\mathrm{m/s}$$\nThe velocity component perpendicular to the magnetic field, $v_{\\perp}$, is determined by the pitch angle $\\alpha = 60^\\circ$:\n$$v_{\\perp} = v \\sin(\\alpha) = v \\sin(60^\\circ)$$\n\nThe problem requires the computation of the cyclotron frequency, gyroradius, and magnetic field scale-lengths.\n\nThe cyclotron (or gyro-) frequency, $\\omega_c$, is given by:\n$$\\omega_c = \\frac{|q_{\\alpha}| B}{m_{\\alpha}}$$\nAt the edge location, using $|q_\\alpha| = 2e$:\n$$\\omega_{c, \\mathrm{edge}} = \\frac{2e B_{\\mathrm{edge}}}{m_{\\alpha}} = \\frac{2(1.60217663 \\times 10^{-19}\\ \\mathrm{C}) (\\frac{7}{3}\\ \\mathrm{T})}{6.644657 \\times 10^{-27}\\ \\mathrm{kg}} \\approx 1.125 \\times 10^8\\ \\mathrm{rad/s}$$\n\nThe gyroradius (or Larmor radius), $\\rho$, is the radius of the circular motion of the particle around a magnetic field line:\n$$\\rho = \\frac{m_{\\alpha} v_{\\perp}}{|q_{\\alpha}| B}$$\nSubstituting $v_{\\perp} = v \\sin(\\alpha)$ and $v = \\sqrt{2K/m_{\\alpha}}$:\n$$\\rho = \\frac{m_{\\alpha}}{|q_{\\alpha}| B} \\left(\\sqrt{\\frac{2K}{m_{\\alpha}}} \\sin(\\alpha)\\right) = \\frac{\\sqrt{2 K m_{\\alpha}}}{|q_{\\alpha}| B} \\sin(\\alpha)$$\nAt the edge, we have:\n$$\\rho_{\\mathrm{edge}} = \\frac{\\sqrt{2(1.60217663 \\times 10^{-13}\\ \\mathrm{J})(6.644657 \\times 10^{-27}\\ \\mathrm{kg})}}{2(1.60217663 \\times 10^{-19}\\ \\mathrm{C})(\\frac{7}{3}\\ \\mathrm{T})} \\sin(60^\\circ)$$\n$$\\rho_{\\mathrm{edge}} \\approx 0.053447\\ \\mathrm{m}$$\n\nThe magnetic field gradient scale-length is $L_B \\equiv B/|\\nabla B|$. For the given field $B(R) = B_0 R_0 / R$, the field magnitude only varies with $R$. The gradient is:\n$$\\nabla B(R) = \\frac{dB}{dR}\\hat{\\boldsymbol{R}} = -\\frac{B_0 R_0}{R^2}\\hat{\\boldsymbol{R}}$$\nIts magnitude is $|\\nabla B| = \\frac{B_0 R_0}{R^2}$. Therefore, the scale-length simplifies to:\n$$L_B = \\frac{B(R)}{|\\nabla B(R)|} = \\frac{B_0 R_0 / R}{B_0 R_0 / R^2} = R$$\nAt the outboard midplane edge, this becomes:\n$$L_{B, \\mathrm{edge}} = R_{\\mathrm{edge}} = 3.6\\ \\mathrm{m}$$\n\nWe now evaluate the three dimensionless measures that constitute the guiding-center smallness indicator $\\epsilon_{\\mathrm{gc}}$.\n\n1.  Ratio of gyroradius to minor radius, $\\rho/a$:\n    $$\\frac{\\rho_{\\mathrm{edge}}}{a} = \\frac{0.053447\\ \\mathrm{m}}{0.6\\ \\mathrm{m}} \\approx 0.089078$$\n\n2.  Ratio of gyroradius to magnetic field gradient scale-length, $\\rho/L_B$:\n    $$\\frac{\\rho_{\\mathrm{edge}}}{L_{B, \\mathrm{edge}}} = \\frac{0.053447\\ \\mathrm{m}}{3.6\\ \\mathrm{m}} \\approx 0.014846$$\n\n3.  Relative toroidal field ripple, $\\delta B/B$:\n    This value is given directly for the location of interest.\n    $$\\frac{\\delta B}{B} = 8.0 \\times 10^{-3} = 0.008$$\n\nFinally, we compute $\\epsilon_{\\mathrm{gc}}$ by taking the maximum of these three values:\n$$\\epsilon_{\\mathrm{gc}} = \\max\\left\\{\\frac{\\rho}{a}, \\frac{\\rho}{L_B}, \\frac{\\delta B}{B}\\right\\} = \\max\\{0.089078, 0.014846, 0.008\\}$$\n$$\\epsilon_{\\mathrm{gc}} = 0.089078$$\nThe problem requires rounding the final result to three significant figures.\n$$\\epsilon_{\\mathrm{gc}} \\approx 0.0891$$",
            "answer": "$$\\boxed{0.0891}$$"
        },
        {
            "introduction": "With the guiding-center framework established, we can now apply it to understand a crucial loss mechanism in tokamaks: toroidal field ripple trapping. This practice guides you through the first-principles derivation of the condition for a particle to be trapped in the magnetic wells created by the discrete toroidal field coils . You will then translate this physical condition into a quantitative estimate of the resulting particle loss fraction, directly linking machine design to plasma confinement.",
            "id": "3973346",
            "problem": "Consider a large-aspect-ratio tokamak in which the toroidal magnetic field exhibits a finite-number-of-coils ripple. Model the toroidal-field variation along a field line by a single-harmonic modulation, such that the magnetic field magnitude attains a minimum and maximum given by $B_{\\min} = B_{0}(1 - \\delta)$ and $B_{\\max} = B_{0}(1 + \\delta)$, where $B_{0}$ is the nominal toroidal field and $\\delta$ is the ripple amplitude. Assume collisionless guiding-center motion for an energetic particle, and that the first adiabatic invariant (magnetic moment) and the total kinetic energy are conserved between $B_{\\min}$ and $B_{\\max}$. A particle is said to be ripple-trapped if it experiences magnetic mirroring between $B_{\\min}$ and $B_{\\max}$ due to the ripple wells. \n\nStarting from fundamental invariants of magnetized particle motion, derive a trapping condition that relates $\\delta$ and the particle energy $E$, evaluated at $B_{\\min}$. Then, assume an isotropic distribution of particle pitch angles at $B_{\\min}$ and estimate the fraction of particles that are ripple-trapped. Finally, for a representative device characterized by major radius $R_{0} = 3.0\\ \\mathrm{m}$, minor radius $a = 1.0\\ \\mathrm{m}$, nominal toroidal field $B_{0} = 5.3\\ \\mathrm{T}$, number of toroidal field (TF) coils $N = 18$, ripple amplitude at the outboard midplane $\\delta = 8.0 \\times 10^{-3}$, and a monoenergetic population of fusion-born alpha particles with energy $E = 3.5\\ \\mathrm{MeV}$, assume that any ripple-trapped particle is promptly lost to the wall. Under these assumptions, compute the ripple loss fraction for this tokamak. Express the fraction as a decimal and round your final answer to three significant figures.",
            "solution": "The problem asks for the derivation of a ripple-trapping condition, the estimation of the trapped particle fraction, and a numerical calculation of this fraction for a specific tokamak scenario. We will proceed by first establishing the physics of particle trapping in a spatially varying magnetic field.\n\nThe motion of a charged particle in a slowly varying magnetic field, under the collisionless guiding-center approximation, conserves two key quantities: the total kinetic energy $E$ and the first adiabatic invariant, the magnetic moment $\\mu$.\nThe kinetic energy is given by:\n$$E = \\frac{1}{2}m v_{\\parallel}^2 + \\frac{1}{2}m v_{\\perp}^2 = \\text{constant}$$\nwhere $m$ is the particle mass, $v_{\\parallel}$ is the velocity component parallel to the magnetic field $\\vec{B}$, and $v_{\\perp}$ is the velocity component perpendicular to $\\vec{B}$.\n\nThe magnetic moment is given by:\n$$\\mu = \\frac{\\frac{1}{2}m v_{\\perp}^2}{B} = \\text{constant}$$\nwhere $B = |\\vec{B}|$ is the magnetic field strength.\n\nFrom the expression for $\\mu$, we can write the perpendicular kinetic energy as $\\frac{1}{2}m v_{\\perp}^2 = \\mu B$. Substituting this into the energy conservation equation gives:\n$$E = \\frac{1}{2}m v_{\\parallel}^2 + \\mu B$$\nThis equation can be rearranged to solve for the parallel velocity:\n$$v_{\\parallel} = \\pm\\sqrt{\\frac{2}{m}(E - \\mu B)}$$\nA particle is said to be trapped or magnetically mirrored when its parallel velocity becomes zero, i.e., $v_{\\parallel} = 0$. This occurs at a specific point along its trajectory where the magnetic field strength reaches a value $B_{mirror}$. At this \"turning point,\" the condition is:\n$$E - \\mu B_{mirror} = 0 \\implies B_{mirror} = \\frac{E}{\\mu}$$\nA particle moving from a region of lower magnetic field into a region of higher magnetic field will be reflected if the field strength reaches $B_{mirror}$.\n\nThe problem describes a ripple well where the magnetic field varies between $B_{\\min}$ and $B_{\\max}$. A particle is ripple-trapped if it enters this region and its mirror point $B_{mirror}$ is less than or equal to the maximum field of the well, $B_{mirror} \\le B_{\\max}$. If $B_{mirror}  B_{\\max}$, the particle is a \"passing\" particle and is not trapped by the ripple.\n\nTo derive the trapping condition, we express $\\mu$ in terms of the particle's state at the location of minimum magnetic field, $B_{\\min}$. The total speed of the particle is $v = \\sqrt{2E/m}$. Let the pitch angle at $B_{\\min}$ be $\\theta$, defined such that $v_{\\perp, \\min} = v \\sin\\theta$ and $v_{\\parallel, \\min} = v \\cos\\theta$. The magnetic moment can be written as:\n$$\\mu = \\frac{\\frac{1}{2}m v_{\\perp, \\min}^2}{B_{\\min}} = \\frac{\\frac{1}{2}m (v \\sin\\theta)^2}{B_{\\min}} = \\frac{E \\sin^2\\theta}{B_{\\min}}$$\nSubstituting this into the expression for $B_{mirror}$:\n$$B_{mirror} = \\frac{E}{\\mu} = \\frac{E}{(E \\sin^2\\theta / B_{\\min})} = \\frac{B_{\\min}}{\\sin^2\\theta}$$\nThe particle is trapped if $B_{mirror} \\le B_{\\max}$, which leads to the condition:\n$$\\frac{B_{\\min}}{\\sin^2\\theta} \\le B_{\\max} \\implies \\sin^2\\theta \\ge \\frac{B_{\\min}}{B_{\\max}}$$\nThis condition relates the particle's pitch angle at $B_{\\min}$ to the magnetic field extrema. This pitch angle itself is a measure of the partitioning of the total energy $E$ into perpendicular and parallel components at $B_{\\min}$ ($E_{\\perp, \\min} = E \\sin^2\\theta$, $E_{\\parallel, \\min} = E \\cos^2\\theta$).\nUsing the given forms $B_{\\min} = B_{0}(1 - \\delta)$ and $B_{\\max} = B_{0}(1 + \\delta)$, the trapping condition becomes:\n$$\\sin^2\\theta \\ge \\frac{B_{0}(1 - \\delta)}{B_{0}(1 + \\delta)} = \\frac{1 - \\delta}{1 + \\delta}$$\n\nNext, we estimate the fraction of ripple-trapped particles assuming an isotropic distribution of pitch angles at $B_{\\min}$. In an isotropic velocity distribution, particle velocity vectors are uniformly distributed over all solid angles. The differential solid angle in velocity space is $d\\Omega = 2\\pi \\sin\\theta d\\theta$ for $\\theta \\in [0, \\pi]$. The total solid angle is $4\\pi$. The probability distribution function for the pitch angle $\\theta$ is thus $p(\\theta)d\\theta = \\frac{2\\pi \\sin\\theta d\\theta}{4\\pi} = \\frac{1}{2}\\sin\\theta d\\theta$.\n\nThe fraction of trapped particles, $f_{trap}$, is the integral of this probability density over all angles $\\theta$ that satisfy the trapping condition. Let $\\xi_0^2 = \\frac{B_{\\min}}{B_{\\max}}$. The trapping condition is $\\sin^2\\theta \\ge \\xi_0^2$, or $\\sin\\theta \\ge \\xi_0$ (since $\\sin\\theta \\ge 0$ for $\\theta \\in [0, \\pi]$). This inequality holds for pitch angles in the range $[\\theta_c, \\pi - \\theta_c]$, where $\\theta_c = \\arcsin(\\xi_0)$.\nThe trapped fraction is:\n$$f_{trap} = \\int_{\\theta_c}^{\\pi - \\theta_c} \\frac{1}{2}\\sin\\theta \\, d\\theta = \\frac{1}{2} \\left[-\\cos\\theta\\right]_{\\arcsin(\\xi_0)}^{\\pi - \\arcsin(\\xi_0)}$$\n$$f_{trap} = \\frac{1}{2} \\left( -\\cos(\\pi - \\arcsin(\\xi_0)) - (-\\cos(\\arcsin(\\xi_0))) \\right)$$\nUsing the identity $\\cos(\\pi - x) = -\\cos(x)$, we get:\n$$f_{trap} = \\frac{1}{2} \\left( \\cos(\\arcsin(\\xi_0)) + \\cos(\\arcsin(\\xi_0)) \\right) = \\cos(\\arcsin(\\xi_0))$$\nUsing the identity $\\cos(\\arcsin(x)) = \\sqrt{1-x^2}$, we obtain:\n$$f_{trap} = \\sqrt{1 - \\xi_0^2} = \\sqrt{1 - \\frac{B_{\\min}}{B_{\\max}}} = \\sqrt{\\frac{B_{\\max} - B_{\\min}}{B_{\\max}}}$$\nNow, we substitute the expressions for $B_{\\min}$ and $B_{\\max}$ in terms of the ripple amplitude $\\delta$:\n$$B_{\\max} - B_{\\min} = B_{0}(1 + \\delta) - B_{0}(1 - \\delta) = 2\\delta B_{0}$$\n$$B_{\\max} = B_{0}(1 + \\delta)$$\nSo, the trapped fraction is:\n$$f_{trap} = \\sqrt{\\frac{2\\delta B_{0}}{B_{0}(1 + \\delta)}} = \\sqrt{\\frac{2\\delta}{1 + \\delta}}$$\nThis expression for the trapped fraction depends only on the ripple amplitude $\\delta$.\n\nFinally, we compute the numerical value for the ripple loss fraction. The problem states that any ripple-trapped particle is promptly lost. Therefore, the ripple loss fraction $f_{loss}$ is equal to the ripple-trapped fraction $f_{trap}$. The provided value for the ripple amplitude is $\\delta = 8.0 \\times 10^{-3}$. Note that the other device parameters ($R_0$, $a$, $B_0$, $N$) and the particle energy $E$ are not needed for this calculation, as the ripple amplitude $\\delta$ is given directly and the derived loss fraction formula depends only on $\\delta$.\n$$f_{loss} = f_{trap} = \\sqrt{\\frac{2\\delta}{1 + \\delta}} = \\sqrt{\\frac{2 \\times (8.0 \\times 10^{-3})}{1 + 8.0 \\times 10^{-3}}}$$\n$$f_{loss} = \\sqrt{\\frac{0.016}{1.008}}$$\n$$f_{loss} \\approx \\sqrt{0.015873015...} \\approx 0.125988156...$$\nRounding the result to three significant figures, we get $0.126$.",
            "answer": "$$\\boxed{0.126}$$"
        },
        {
            "introduction": "Energetic particle transport is often driven by small-scale turbulence, but the particles themselves have large orbits that can span significant variations in the turbulence intensity. This exercise introduces the critical concept of orbit-averaging, a technique to determine the effective transport experienced by a particle as it traverses different regions of the plasma . By comparing a full numerical orbit-average to simpler local approximations, you will assess the importance of finite orbit width effects, a key topic in advanced transport modeling.",
            "id": "3973268",
            "problem": "Consider an integrable Hamiltonian system for a fast ion confined in a toroidal magnetic field, with action-angle variables $(J,\\theta)$ defined so that the angle $ \\theta $ advances uniformly in time with $ \\dot{\\theta} = \\Omega(J) $. Assume a single, slowly varying spatial coordinate $ r $ parameterizes the strongest variation of the local turbulent diffusion intensity that drives stochastic transport of the action variable. In a local, near-circular orbit model consistent with guiding-center theory, approximate the instantaneous radial position along the orbit by\n$$\nr(\\theta;J) = r_{\\mathrm{gc}}(J) + \\Delta r(J)\\cos\\theta,\n$$\nwhere $ r_{\\mathrm{gc}}(J) $ is the guiding-center radius and $ \\Delta r(J) $ is the radial excursion amplitude. Let the local diffusion coefficient as a function of radius be given by a normalized Gaussian profile\n$$\nD_{\\mathrm{loc}}(r) = D_0 \\exp\\left( -\\frac{(r-r_0)^2}{2\\sigma^2} \\right),\n$$\nwith constant parameters $ D_0  0 $, $ r_0 $, and $ \\sigma  0 $. In the local linearization between the action and the radius, approximate $ J \\approx \\kappa r $ near $ r_{\\mathrm{gc}} $, where $ \\kappa  0 $ is a constant, so that $ \\left(\\frac{\\partial J}{\\partial r}\\right) \\approx \\kappa $.\n\nStarting from the fundamental definitions of action-angle variables, the uniform advance of the angle $ \\theta $ in time for integrable motion, and the orbit-average operation over the angle $ \\theta $ (which is equivalent to the time average for uniform angular frequency), derive how to compute an orbit-averaged diffusion coefficient for the action variable, denoted by $ \\bar{D}_J(J) $, using the given $ r(\\theta;J) $ and $ D_{\\mathrm{loc}}(r) $. Explicitly use $ \\theta $ measured in radians. Then, define a zero-order local approximation $ D_J^{\\mathrm{loc},0}(J) $ by evaluating the diffusion at $ r_{\\mathrm{gc}}(J) $ only, and a second-order local curvature approximation $ D_J^{\\mathrm{loc},2}(J) $ by performing a Taylor expansion of $ D_{\\mathrm{loc}}(r) $ around $ r_{\\mathrm{gc}}(J) $ up to second order in $ \\Delta r(J)\\cos\\theta $ and orbit-averaging that expansion. Using these, define the relative errors\n$$\n\\epsilon_0(J) = \\frac{\\bar{D}_J(J) - D_J^{\\mathrm{loc},0}(J)}{\\bar{D}_J(J)}, \\qquad\n\\epsilon_2(J) = \\frac{\\bar{D}_J(J) - D_J^{\\mathrm{loc},2}(J)}{\\bar{D}_J(J)}.\n$$\n\nAll quantities in this problem are normalized and unitless. Your program must compute $ \\bar{D}_J(J) $, $ D_J^{\\mathrm{loc},0}(J) $, $ \\epsilon_0(J) $, $ D_J^{\\mathrm{loc},2}(J) $, and $ \\epsilon_2(J) $ for each of the following test cases, using orbit-averaging over the angle $ \\theta $ via numerical quadrature with a sufficiently fine uniform partition of $ [0,2\\pi] $:\n\n- Test case $ 1 $: $ (D_0,\\sigma,r_0,\\kappa,r_{\\mathrm{gc}},\\Delta r) = (1.0,0.1,0.5,1.3,0.5,1\\times 10^{-6}) $.\n- Test case $ 2 $: $ (D_0,\\sigma,r_0,\\kappa,r_{\\mathrm{gc}},\\Delta r) = (1.0,0.1,0.5,1.3,0.5,0.2) $.\n- Test case $ 3 $: $ (D_0,\\sigma,r_0,\\kappa,r_{\\mathrm{gc}},\\Delta r) = (1.0,0.1,0.5,1.3,0.7,0.2) $.\n- Test case $ 4 $: $ (D_0,\\sigma,r_0,\\kappa,r_{\\mathrm{gc}},\\Delta r) = (1.0,0.05,0.5,1.3,0.5,0.2) $.\n- Test case $ 5 $: $ (D_0,\\sigma,r_0,\\kappa,r_{\\mathrm{gc}},\\Delta r) = (1.0,0.2,0.5,1.3,0.3,0.3) $.\n\nYour program must produce, for the five test cases in order, a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list of the five floating-point numbers $ [\\bar{D}_J, D_J^{\\mathrm{loc},0}, \\epsilon_0, D_J^{\\mathrm{loc},2}, \\epsilon_2] $. The angle $ \\theta $ must be treated in radians in all computations. The final output format must be\n$$\n\\text{[ [}\\bar{D}_J^{(1)},D_J^{\\mathrm{loc},0\\,(1)},\\epsilon_0^{(1)},D_J^{\\mathrm{loc},2\\,(1)},\\epsilon_2^{(1)}\\text{], [}\\bar{D}_J^{(2)},\\ldots\\text{], \\ldots, [}\\bar{D}_J^{(5)},\\ldots\\text{] ]},\n$$\nwith no additional text.",
            "solution": "The problem requires the derivation and computation of several quantities related to the orbit-averaged diffusion of fast ions in a toroidal magnetic field. The core of the problem lies in transforming a spatially-dependent diffusion coefficient into an action-space diffusion coefficient and then averaging it over a particle's orbit.\n\n### Step 1: Derivation of the Orbit-Averaged Action Diffusion Coefficient, $\\bar{D}_J(J)$\n\nThe stochastic transport is initially described in the radial coordinate $r$ by the diffusion coefficient $D_{\\mathrm{loc}}(r)$. We need to find the corresponding diffusion coefficient for the action variable $J$. The problem provides a local linear relationship between action $J$ and radius $r$, such that $\\frac{\\partial J}{\\partial r} \\approx \\kappa$, where $\\kappa$ is a constant.\n\nA random displacement $\\Delta r$ in the radial coordinate corresponds to a displacement in action $\\Delta J$ given by the chain rule:\n$$\n\\Delta J \\approx \\frac{\\partial J}{\\partial r} \\Delta r = \\kappa \\Delta r\n$$\nThe mean-squared displacement is related by:\n$$\n\\langle (\\Delta J)^2 \\rangle \\approx \\kappa^2 \\langle (\\Delta r)^2 \\rangle\n$$\nThe definition of a diffusion coefficient $D$ for a variable $x$ relates the mean-squared displacement over a time $\\Delta t$ as $\\langle (\\Delta x)^2 \\rangle = 2 D_x \\Delta t$. Applying this to both $r$ and $J$:\n$$\n\\langle (\\Delta r)^2 \\rangle = 2 D_{\\mathrm{loc}}(r) \\Delta t\n$$\n$$\n\\langle (\\Delta J)^2 \\rangle = 2 D_J \\Delta t\n$$\nSubstituting these into the relationship between mean-squared displacements yields:\n$$\n2 D_J \\Delta t = \\kappa^2 (2 D_{\\mathrm{loc}}(r) \\Delta t)\n$$\nThis implies that the instantaneous diffusion coefficient in action space, at a specific radial position $r$ along the orbit, is:\n$$\nD_J(r) = \\kappa^2 D_{\\mathrm{loc}}(r)\n$$\nThe particle's radial position varies along its orbit as a function of the angle variable $\\theta$:\n$$\nr(\\theta;J) = r_{\\mathrm{gc}}(J) + \\Delta r(J)\\cos\\theta\n$$\nTherefore, the instantaneous action diffusion coefficient also varies along the orbit:\n$$\nD_J(\\theta; J) = \\kappa^2 D_{\\mathrm{loc}}(r(\\theta;J)) = \\kappa^2 D_0 \\exp\\left( -\\frac{(r_{\\mathrm{gc}} + \\Delta r\\cos\\theta - r_0)^2}{2\\sigma^2} \\right)\n$$\nThe problem states that the angle $\\theta$ advances uniformly in time for the integrable system. Consequently, a time average over an orbit period is equivalent to an average over the angle $\\theta$ from $0$ to $2\\pi$. The orbit-averaged diffusion coefficient $\\bar{D}_J(J)$ is thus defined as:\n$$\n\\bar{D}_J(J) = \\langle D_J(\\theta; J) \\rangle_{\\theta} = \\frac{1}{2\\pi} \\int_0^{2\\pi} D_J(\\theta; J) \\, d\\theta\n$$\nSubstituting the expression for $D_J(\\theta; J)$:\n$$\n\\bar{D}_J(J) = \\frac{\\kappa^2 D_0}{2\\pi} \\int_0^{2\\pi} \\exp\\left( -\\frac{(r_{\\mathrm{gc}}(J) + \\Delta r(J)\\cos\\theta - r_0)^2}{2\\sigma^2} \\right) \\, d\\theta\n$$\nThis integral will be computed numerically as it generally does not have a simple analytical solution.\n\n### Step 2: Derivation of the Local Approximations\n\n**Zero-Order Approximation, $D_J^{\\mathrm{loc},0}(J)$**:\nThis approximation neglects the finite orbit width by setting $\\Delta r(J) = 0$. The diffusion is evaluated solely at the guiding-center radius $r_{\\mathrm{gc}}(J)$.\n$$\nD_J^{\\mathrm{loc},0}(J) = \\kappa^2 D_{\\mathrm{loc}}(r_{\\mathrm{gc}}(J)) = \\kappa^2 D_0 \\exp\\left( -\\frac{(r_{\\mathrm{gc}}(J)-r_0)^2}{2\\sigma^2} \\right)\n$$\n\n**Second-Order Approximation, $D_J^{\\mathrm{loc},2}(J)$**:\nThis approximation is found by performing a Taylor expansion of the instantaneous diffusion coefficient around $r = r_{\\mathrm{gc}}(J)$ and then orbit-averaging. Let $g(r) = D_{\\mathrm{loc}}(r)$ and $\\delta r = \\Delta r \\cos\\theta$. The expansion is:\n$$\ng(r_{\\mathrm{gc}} + \\delta r) \\approx g(r_{\\mathrm{gc}}) + g'(r_{\\mathrm{gc}}) \\delta r + \\frac{1}{2} g''(r_{\\mathrm{gc}}) (\\delta r)^2\n$$\nThe instantaneous action diffusion coefficient is approximately:\n$$\nD_J(\\theta; J) \\approx \\kappa^2 \\left[ D_{\\mathrm{loc}}(r_{\\mathrm{gc}}) + D'_{\\mathrm{loc}}(r_{\\mathrm{gc}})(\\Delta r \\cos\\theta) + \\frac{1}{2}D''_{\\mathrm{loc}}(r_{\\mathrm{gc}})(\\Delta r \\cos\\theta)^2 \\right]\n$$\nTo obtain $D_J^{\\mathrm{loc},2}(J)$, we average this expression over $\\theta \\in [0, 2\\pi]$. We use the standard integrals $\\langle \\cos\\theta \\rangle = 0$ and $\\langle \\cos^2\\theta \\rangle = 1/2$.\n$$\nD_J^{\\mathrm{loc},2}(J) = \\langle D_J(\\theta; J) \\rangle_{\\theta} \\approx \\kappa^2 \\left[ D_{\\mathrm{loc}}(r_{\\mathrm{gc}}) + 0 + \\frac{1}{2}D''_{\\mathrm{loc}}(r_{\\mathrm{gc}})(\\Delta r)^2 \\left\\langle \\cos^2\\theta \\right\\rangle \\right]\n$$\n$$\nD_J^{\\mathrm{loc},2}(J) = \\kappa^2 \\left[ D_{\\mathrm{loc}}(r_{\\mathrm{gc}}) + \\frac{(\\Delta r)^2}{4} D''_{\\mathrm{loc}}(r_{\\mathrm{gc}}) \\right]\n$$\nWe need the second derivative of $D_{\\mathrm{loc}}(r)$:\n$$\nD'_{\\mathrm{loc}}(r) = -D_{\\mathrm{loc}}(r) \\frac{r-r_0}{\\sigma^2}\n$$\n$$\nD''_{\\mathrm{loc}}(r) = D_{\\mathrm{loc}}(r) \\left( \\frac{(r-r_0)^2}{\\sigma^4} - \\frac{1}{\\sigma^2} \\right)\n$$\nSubstituting $D''_{\\mathrm{loc}}(r_{\\mathrm{gc}})$ into the expression for $D_J^{\\mathrm{loc},2}(J)$:\n$$\nD_J^{\\mathrm{loc},2}(J) = \\kappa^2 D_{\\mathrm{loc}}(r_{\\mathrm{gc}}) + \\kappa^2 \\frac{(\\Delta r)^2}{4} D_{\\mathrm{loc}}(r_{\\mathrm{gc}}) \\left( \\frac{(r_{\\mathrm{gc}}-r_0)^2}{\\sigma^4} - \\frac{1}{\\sigma^2} \\right)\n$$\nRecognizing that the first term is $D_J^{\\mathrm{loc},0}(J)$, we can write:\n$$\nD_J^{\\mathrm{loc},2}(J) = D_J^{\\mathrm{loc},0}(J) \\left[ 1 + \\frac{(\\Delta r)^2}{4} \\left( \\frac{(r_{\\mathrm{gc}}-r_0)^2}{\\sigma^4} - \\frac{1}{\\sigma^2} \\right) \\right]\n$$\nThis can be simplified to:\n$$\nD_J^{\\mathrm{loc},2}(J) = D_J^{\\mathrm{loc},0}(J) \\left[ 1 + \\frac{(\\Delta r)^2}{4\\sigma^2} \\left( \\frac{(r_{\\mathrm{gc}}-r_0)^2}{\\sigma^2} - 1 \\right) \\right]\n$$\n\n### Step 3: Calculation of Relative Errors and Algorithmic Plan\n\nThe relative errors are defined as:\n$$\n\\epsilon_0(J) = \\frac{\\bar{D}_J(J) - D_J^{\\mathrm{loc},0}(J)}{\\bar{D}_J(J)}\n$$\n$$\n\\epsilon_2(J) = \\frac{\\bar{D}_J(J) - D_J^{\\mathrm{loc},2}(J)}{\\bar{D}_J(J)}\n$$\nFor each test case, the algorithm is as follows:\n1.  Unpack the parameters $(D_0, \\sigma, r_0, \\kappa, r_{\\mathrm{gc}}, \\Delta r)$.\n2.  Compute $\\bar{D}_J(J)$ by numerically integrating the derived expression. We use a uniform grid of $N$ points for $\\theta \\in [0, 2\\pi]$ and approximate the integral via the mean of the integrand values, noting that $\\frac{1}{2\\pi}\\int_0^{2\\pi} f(\\theta)d\\theta \\approx \\frac{1}{N}\\sum_{i=1}^{N} f(\\theta_i)$.\n3.  Compute $D_J^{\\mathrm{loc},0}(J)$ using its analytical formula.\n4.  Compute $\\epsilon_0(J)$ from the values of $\\bar{D}_J(J)$ and $D_J^{\\mathrm{loc},0}(J)$.\n5.  Compute $D_J^{\\mathrm{loc},2}(J)$ using its analytical formula.\n6.  Compute $\\epsilon_2(J)$ from the values of $\\bar{D}_J(J)$ and $D_J^{\\mathrm{loc},2}(J)$.\n7.  Store the five computed floating-point numbers for the current test case.\n8.  Repeat for all test cases and format the final output as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes orbit-averaged diffusion coefficients and their local approximations\n    for a set of test cases in computational fusion science.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (D0, sigma, r0, kappa, rgc, dr)\n        (1.0, 0.1, 0.5, 1.3, 0.5, 1e-6),\n        (1.0, 0.1, 0.5, 1.3, 0.5, 0.2),\n        (1.0, 0.1, 0.5, 1.3, 0.7, 0.2),\n        (1.0, 0.05, 0.5, 1.3, 0.5, 0.2),\n        (1.0, 0.2, 0.5, 1.3, 0.3, 0.3),\n    ]\n\n    results = []\n    \n    # Number of points for numerical quadrature\n    num_points = 10000 \n    theta = np.linspace(0, 2 * np.pi, num_points, endpoint=False)\n\n    for case in test_cases:\n        D0, sigma, r0, kappa, rgc, dr = case\n\n        # 1. Compute the full orbit-averaged diffusion coefficient D_J_bar\n        # r(theta) = r_gc + dr*cos(theta)\n        r_orbit = rgc + dr * np.cos(theta)\n        \n        # D_loc(r) = D0 * exp(-(r - r0)^2 / (2 * sigma^2))\n        D_loc_orbit = D0 * np.exp(-(r_orbit - r0)**2 / (2 * sigma**2))\n        \n        # The orbit-average of D_loc is simply the mean over the uniform theta grid.\n        D_loc_bar = np.mean(D_loc_orbit)\n        \n        # D_J = kappa^2 * D_loc, so D_J_bar = kappa^2 * D_loc_bar\n        D_J_bar = kappa**2 * D_loc_bar\n\n        # 2. Compute the zero-order local approximation D_J_loc0\n        # Evaluate D_loc at the guiding center radius rgc\n        D_loc_rgc = D0 * np.exp(-(rgc - r0)**2 / (2 * sigma**2))\n        D_J_loc0 = kappa**2 * D_loc_rgc\n\n        # 3. Compute the relative error epsilon_0\n        # Check for division by zero, although not expected here\n        if D_J_bar == 0:\n            eps0 = np.nan\n        else:\n            eps0 = (D_J_bar - D_J_loc0) / D_J_bar\n\n        # 4. Compute the second-order local approximation D_J_loc2\n        # D_J_loc2 = D_J_loc0 * [1 + (dr^2 / (4*sigma^2)) * (((rgc-r0)/sigma)^2 - 1)]\n        term_in_paren = ((rgc - r0)**2 / sigma**2) - 1.0\n        correction_factor = 1.0 + (dr**2 / (4.0 * sigma**2)) * term_in_paren\n        D_J_loc2 = D_J_loc0 * correction_factor\n\n        # 5. Compute the relative error epsilon_2\n        if D_J_bar == 0:\n            eps2 = np.nan\n        else:\n            eps2 = (D_J_bar - D_J_loc2) / D_J_bar\n            \n        results.append([D_J_bar, D_J_loc0, eps0, D_J_loc2, eps2])\n\n    # Final print statement in the exact required format.\n    # The skeleton format uses `str(results)` which adds spaces inside inner lists.\n    # Ex: [[1.0, 2.0], [3.0, 4.0]] becomes '[[1.0, 2.0],[3.0, 4.0]]'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}