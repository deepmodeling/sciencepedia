{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的轨道跟踪算法之前，我们必须首先牢固掌握粒子运动背后的基本物理原理。本练习将引导你从第一性原理出发，在一个简化但具有代表性的大环径比托卡马克模型中，推导驱动高能粒子轨道漂移的关键力：梯度-$B$漂移和曲率漂移。通过亲手计算这些漂移速度，你将能更深刻地理解引导中心近似的物理内涵及其在磁约束聚变中的核心作用。",
            "id": "4025430",
            "problem": "考虑一个托卡马克类型的环形约束装置，其大半径为 $R_{0}$，小半径为 $r$ 的圆形同心磁通量面满足 $r \\ll R_{0}$ (大环径比)。使用柱坐标系 $(R,\\phi,Z)$，其标准正交基为 $\\{\\hat{\\mathbf{e}}_{R},\\hat{\\mathbf{e}}_{\\phi},\\hat{\\mathbf{e}}_{Z}\\}$，并引入由 $R = R_{0} + r \\cos\\theta$ 和 $Z = r \\sin\\theta$ 定义的极向角 $\\theta$。假设系统具有轴对称性，且磁场是一个占主导的环向分量和一个较小的极向分量的叠加。环向磁场的大小按 $B_{\\phi}(R) = B_{0}\\,R_{0}/R$ 的规律变化，其中 $B_{0}$ 是一个常数。安全因子 $q(r)$ 定义为 $q = \\frac{r\\,B_{\\phi}}{R_{0}\\,B_{\\theta}}$。\n\n仅从这些定义和标准的导心漂移公式出发，并以反环径比 $\\varepsilon = r/R_{0}$ 为小量，一致地计算到领头阶（忽略 $\\varepsilon^{2}$ 及更高阶的项）：\n\n1) 使用极向单位矢量 $\\hat{\\mathbf{e}}_{\\theta} = -\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}$，在柱坐标系下用 $B_{\\phi}(R)$、$q(r)$、$r$ 和 $\\theta$ 表示磁场 $\\mathbf{B}(R,Z)$。\n\n2) 计算磁场大小的梯度矢量 $\\nabla B$ 和磁曲率矢量 $\\boldsymbol{\\kappa} = \\hat{\\mathbf{b}}\\cdot\\nabla\\hat{\\mathbf{b}}$，其中 $\\hat{\\mathbf{b}} = \\mathbf{B}/|\\mathbf{B}|$ 是磁场单位矢量。计算在柱坐标系下进行，并保留到 $\\varepsilon$ 的领头阶。\n\n3) 使用您的结果，推导一个电荷为 $q_{i}$、质量为 $m_{i}$、平行速度为 $v_{\\parallel}$、垂直速度为 $v_{\\perp}$ 的高能离子，在 $\\theta = 0$ 处的外侧中平面上的总磁漂移速度。总磁漂移速度是梯度-B漂移和曲率漂移之和。将您的最终答案表示为柱坐标分量 $(v_{R}, v_{\\phi}, v_{Z})$ 的单个闭式解析行向量，仅保留 $\\varepsilon$ 的领头阶项。无需进行数值计算或四舍五入，且最终表达式中不要包含单位。",
            "solution": "经评估，问题陈述有效。其科学基础是等离子体物理和磁约束聚变的原理，特别是托卡马克中带电粒子运动的导心近似。问题是适定的、客观的，并包含足够的信息，可以在指定的近似条件下得到唯一的解析解。不存在科学缺陷、矛盾或歧义。\n\n解答过程按题目要求分为三个部分。\n\n第1部分：磁场 $\\mathbf{B}$ 的表达式\n\n磁场 $\\mathbf{B}$ 是其环向分量和极向分量之和，即 $\\mathbf{B} = \\mathbf{B}_{\\phi} + \\mathbf{B}_{p}$。在柱坐标基下，环向分量为 $\\mathbf{B}_{\\phi} = B_{\\phi} \\hat{\\mathbf{e}}_{\\phi}$。极向分量沿着极向单位矢量 $\\hat{\\mathbf{e}}_{\\theta}$ 的方向，因此 $\\mathbf{B}_{p} = B_{\\theta} \\hat{\\mathbf{e}}_{\\theta}$。使用题目给出的 $\\hat{\\mathbf{e}}_{\\theta}$ 表达式，总磁场为：\n$$\n\\mathbf{B} = B_{\\phi} \\hat{\\mathbf{e}}_{\\phi} + B_{\\theta} (-\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z})\n$$\n$$\n\\mathbf{B} = - B_{\\theta} \\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + B_{\\phi} \\hat{\\mathbf{e}}_{\\phi} + B_{\\theta} \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}\n$$\n接下来，我们将磁场大小 $B_{\\phi}$ 和 $B_{\\theta}$ 用给定参数表示，并计算到反环径比 $\\varepsilon = r/R_{0}$ 的领头阶。环向坐标 $R$ 由 $R = R_{0} + r \\cos\\theta = R_{0}(1 + \\varepsilon \\cos\\theta)$ 给出。\n环向磁场大小为 $B_{\\phi}(R) = B_{0} R_{0}/R$。代入 $R$ 的表达式：\n$$\nB_{\\phi} = \\frac{B_{0} R_{0}}{R_{0}(1 + \\varepsilon \\cos\\theta)} = B_{0}(1 + \\varepsilon \\cos\\theta)^{-1}\n$$\n对于小的 $x$ 使用二项式展开 $(1+x)^{n} \\approx 1+nx$，我们得到 $\\varepsilon$ 的一阶近似：\n$$\nB_{\\phi} \\approx B_{0}(1 - \\varepsilon \\cos\\theta)\n$$\n极向磁场大小 $B_{\\theta}$ 由安全因子 $q(r) = \\frac{r B_{\\phi}}{R_{0} B_{\\theta}}$ 的定义给出。\n$$\nB_{\\theta} = \\frac{r B_{\\phi}}{R_{0} q(r)} = \\frac{\\varepsilon B_{\\phi}}{q(r)}\n$$\n由于 $B_{\\theta}$ 本身已经是 $\\varepsilon$ 阶的，为了得到其领头阶表达式，我们可以使用 $B_{\\phi}$ 的领头阶表达式，即 $B_{\\phi} \\approx B_{0}$。\n$$\nB_{\\theta} \\approx \\frac{\\varepsilon B_{0}}{q(r)} = \\frac{r B_{0}}{R_{0} q(r)}\n$$\n将 $B_{\\phi}$ 和 $B_{\\theta}$ 的这些表达式代入 $\\mathbf{B}$ 的矢量表达式中，我们得到在柱坐标系下 $\\varepsilon$ 领头阶的磁场：\n$$\n\\mathbf{B}(r,\\theta) \\approx -\\frac{r B_{0}}{R_{0} q(r)}\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + B_{0}(1 - \\frac{r}{R_{0}}\\cos\\theta)\\hat{\\mathbf{e}}_{\\phi} + \\frac{r B_{0}}{R_{0} q(r)}\\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}\n$$\n\n第2部分：$\\nabla B$ 和 $\\boldsymbol{\\kappa}$ 的计算\n\n首先，我们求磁场的大小，$B = |\\mathbf{B}|$。\n$$\nB^{2} = B_{R}^{2} + B_{\\phi}^{2} + B_{Z}^{2} \\approx \\left(-\\frac{\\varepsilon B_{0}}{q}\\sin\\theta\\right)^{2} + \\left(B_{0}(1 - \\varepsilon\\cos\\theta)\\right)^{2} + \\left(\\frac{\\varepsilon B_{0}}{q}\\cos\\theta\\right)^{2}\n$$\n$$\nB^{2} \\approx \\frac{\\varepsilon^{2} B_{0}^{2}}{q^{2}}\\sin^{2}\\theta + B_{0}^{2}(1 - 2\\varepsilon\\cos\\theta + \\varepsilon^{2}\\cos^{2}\\theta) + \\frac{\\varepsilon^{2} B_{0}^{2}}{q^{2}}\\cos^{2}\\theta\n$$\n$$\nB^{2} \\approx B_{0}^{2} \\left( 1 - 2\\varepsilon\\cos\\theta + \\frac{\\varepsilon^{2}}{q^{2}} + \\varepsilon^{2}\\cos^{2}\\theta \\right)\n$$\n忽略 $\\varepsilon^{2}$ 及更高阶的项，我们得到 $B^{2} \\approx B_{0}^{2}(1 - 2\\varepsilon\\cos\\theta)$。开平方并使用二项式近似：\n$$\nB \\approx B_{0}(1 - 2\\varepsilon\\cos\\theta)^{1/2} \\approx B_{0}(1 - \\varepsilon\\cos\\theta)\n$$\n这表明在领头阶上，$B \\approx B_{\\phi}$。一个更简单且完全一致的方法是认识到 $B_{\\theta}^{2}$ 是 $\\varepsilon^{2}B_{0}^{2}$ 阶的，因此它对 $B$ 的一阶贡献可以忽略不计。因此，我们可以用环向分量来近似磁场的大小：\n$$\nB(R,Z) \\approx B_{\\phi}(R) = \\frac{B_{0} R_{0}}{R}\n$$\n我们现在计算 $B$ 在柱坐标系下的梯度。梯度算子为 $\\nabla = \\hat{\\mathbf{e}}_{R}\\frac{\\partial}{\\partial R} + \\hat{\\mathbf{e}}_{\\phi}\\frac{1}{R}\\frac{\\partial}{\\partial \\phi} + \\hat{\\mathbf{e}}_{Z}\\frac{\\partial}{\\partial Z}$。由于 $B$ 仅依赖于 $R$：\n$$\n\\nabla B = \\nabla\\left(\\frac{B_{0} R_{0}}{R}\\right) = B_{0} R_{0} \\nabla\\left(\\frac{1}{R}\\right) = B_{0} R_{0} \\left(-\\frac{1}{R^{2}}\\hat{\\mathbf{e}}_{R}\\right) = -\\frac{B_{0} R_{0}}{R^{2}}\\hat{\\mathbf{e}}_{R}\n$$\n通过在系数中令 $R \\approx R_{0}$ 来找到领头阶项：\n$$\n\\nabla B \\approx -\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}\n$$\n接下来，我们计算磁曲率矢量 $\\boldsymbol{\\kappa} = (\\hat{\\mathbf{b}}\\cdot\\nabla)\\hat{\\mathbf{b}}$，其中 $\\hat{\\mathbf{b}} = \\mathbf{B}/B$ 是沿着磁场方向的单位矢量。在领头阶上，磁场是纯环向的，$\\mathbf{B} \\approx B_{0}\\hat{\\mathbf{e}}_{\\phi}$，所以 $\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$。因此，方向导数算子 $\\hat{\\mathbf{b}}\\cdot\\nabla$ 中的主导项是 $(\\hat{\\mathbf{e}}_{\\phi}\\cdot\\nabla) = \\frac{1}{R}\\frac{\\partial}{\\partial\\phi}$。将此应用于 $\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$ 需要计算基矢量 $\\hat{\\mathbf{e}}_{\\phi}$ 的导数，即 $\\frac{\\partial\\hat{\\mathbf{e}}_{\\phi}}{\\partial\\phi} = -\\hat{\\mathbf{e}}_{R}$。\n$$\n\\boldsymbol{\\kappa} \\approx (\\hat{\\mathbf{e}}_{\\phi}\\cdot\\nabla)\\hat{\\mathbf{e}}_{\\phi} = \\frac{1}{R}\\frac{\\partial\\hat{\\mathbf{e}}_{\\phi}}{\\partial\\phi} = -\\frac{1}{R}\\hat{\\mathbf{e}}_{R}\n$$\n在领头阶上，当 $R \\approx R_{0}$ 时：\n$$\n\\boldsymbol{\\kappa} \\approx -\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}\n$$\n\n第3部分：磁漂移速度的推导\n\n总磁漂移速度 $\\mathbf{v}_{m}$ 是梯度-B漂移 $\\mathbf{v}_{\\nabla B}$ 和曲率漂移 $\\mathbf{v}_{\\kappa}$ 的和：\n$$\n\\mathbf{v}_{m} = \\mathbf{v}_{\\nabla B} + \\mathbf{v}_{\\kappa} = \\frac{m_{i} v_{\\perp}^{2}}{2 q_{i} B^{2}}(\\hat{\\mathbf{b}} \\times \\nabla B) + \\frac{m_{i} v_{\\parallel}^{2}}{q_{i} B}(\\hat{\\mathbf{b}} \\times \\boldsymbol{\\kappa})\n$$\n我们可以合并这些项：\n$$\n\\mathbf{v}_{m} = \\frac{m_{i}}{q_{i}B} \\left( \\hat{\\mathbf{b}} \\times \\left( \\frac{v_{\\perp}^{2}}{2B} \\nabla B + v_{\\parallel}^{2} \\boldsymbol{\\kappa} \\right) \\right)\n$$\n我们在 $\\theta=0$ 的外侧中平面处计算此表达式。在此位置，我们使用所涉及各量的领头阶表达式：\n$R = R_{0}+r$, $Z=0$。\n$B \\approx B_{0}(1-\\varepsilon\\cos(0)) = B_{0}(1-\\varepsilon)$。在领头阶上，$B \\approx B_{0}$。\n$\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$。（在 $\\theta=0$ 处，$\\hat{\\mathbf{e}}_Z$ 分量是 $O(\\varepsilon)$ 阶的）。\n$\\nabla B \\approx -\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}$。\n$\\boldsymbol{\\kappa} \\approx -\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}$。\n\n将这些领头阶表达式代入漂移速度公式：\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( \\frac{v_{\\perp}^{2}}{2B_{0}} \\left(-\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}\\right) + v_{\\parallel}^{2} \\left(-\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}\\right) \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( -\\frac{v_{\\perp}^{2}}{2R_{0}}\\hat{\\mathbf{e}}_{R} - \\frac{v_{\\parallel}^{2}}{R_{0}}\\hat{\\mathbf{e}}_{R} \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( -\\frac{1}{R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\hat{\\mathbf{e}}_{R} \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx -\\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) (\\hat{\\mathbf{e}}_{\\phi} \\times \\hat{\\mathbf{e}}_{R})\n$$\n使用柱坐标基矢量的右手定则，$\\hat{\\mathbf{e}}_{\\phi} \\times \\hat{\\mathbf{e}}_{R} = -\\hat{\\mathbf{e}}_{Z}$。\n$$\n\\mathbf{v}_{m} \\approx -\\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) (-\\hat{\\mathbf{e}}_{Z})\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\hat{\\mathbf{e}}_{Z}\n$$\n这就是领头阶的磁漂移速度。表示为柱坐标分量 $(v_{R}, v_{\\phi}, v_{Z})$ 的行向量，结果是：\n$$\n\\mathbf{v}_{m} = \\begin{pmatrix} 0   0  \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0   0  \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left(\\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "解析理论，如微扰论，是理解复杂物理现象的强大工具，但其有效性依赖于近似的准确性。作为一名计算科学家，一项关键技能就是通过直接数值模拟来验证这些解析理论的预测。本练习将引导你运用哈密顿力学来研究被捕获离子的弹跳运动，并将其在弱电场剪切下的二阶频率修正的解析结果与精确的数值积分结果进行比较，从而让你亲身体验理论与计算相结合的验证过程。",
            "id": "4025406",
            "problem": "考虑一个在大环径比、轴对称环形磁约束装置中被磁场捕获的高能离子。在源自 Lorentz 力定律的导心近似下，磁阱底部附近的平行（弹跳）运动可以很好地用正则作用量-角度变量 $(\\theta, J)$ 中的单自由度谐振子来近似，其未扰动哈密顿量为 $H_{0}(J) = \\omega_{b0} J$，其中 $\\omega_{b0}$ 是未扰动弹跳角频率。弱静态径向电场剪切通过 $\\mathbf{E} \\times \\mathbf{B}$ 流剪切对弹跳动力学产生微小扰动。假设此扰动以零均值周期项的形式进入弹跳哈密顿量，形式为 $H_{1}(J, \\theta) = F(J) \\cos(2 \\theta)$ 乘以一个无量纲小参数 $\\epsilon \\ll 1$，其中 $F(J) = a J$，$a$ 与电场剪切率成正比，单位为秒的倒数。总哈密顿量为 $H(J,\\theta) = H_{0}(J) + \\epsilon H_{1}(J,\\theta)$。\n\n您的任务是：\n- 从基本定律和核心定义（Lorentz 力定律、导心近似和正则哈密顿动力学）出发，使用正则平均法（近恒等正则变换）推导由弱剪切引起的弹跳角频率的二阶修正。您必须明确证明对于零均值周期性微扰，一阶修正为何为零，并求出在 $\\epsilon^{2}$ 阶上的领头非零修正。\n- 通过直接积分给定哈密顿量 $H(J,\\theta)$ 的哈密顿方程 $(\\theta, J)$，实现计算验证，以获得数值弹跳角频率。在 $\\theta(0) = 0$ 和给定的 $J(0) = J_{0}$ 处初始化，并积分直到 $\\theta$ 首次增加 $2\\pi$。计算数值弹跳角频率为 $\\omega_{\\mathrm{num}} = 2\\pi / T$，其中 $T$ 是达到 $\\theta = 2\\pi$ 所经过的时间。所有角频率必须以 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 为单位表示。\n- 对多个测试用例，比较正则平均法得到的解析二阶预测与直接数值积分的结果，并报告定义为 $\\left|\\omega_{\\mathrm{num}} - \\omega_{\\mathrm{ana}}\\right| / \\omega_{\\mathrm{ana}}$ 的相对误差。该误差是无量纲的，应以浮点数形式输出。\n\n对于计算实现，请使用给定哈密顿量下的以下运动方程的显式结构：\n- $H(J,\\theta) = \\omega_{b0} J + \\epsilon \\, a J \\cos(2 \\theta)$，\n- $\\dot{\\theta} = \\dfrac{\\partial H}{\\partial J}$，\n- $\\dot{J} = -\\dfrac{\\partial H}{\\partial \\theta}$。\n\n您必须通过以下参数值 $(\\omega_{b0}, \\epsilon, a, J_{0})$ 的测试套件来验证您的实现：\n1. $(1.0 \\times 10^{6}, 0.05, 1.0 \\times 10^{5}, 1.0)$，\n2. $(8.0 \\times 10^{5}, 0.05, 0.0, 1.0)$，\n3. $(1.2 \\times 10^{6}, 0.01, 2.0 \\times 10^{5}, 0.5)$，\n4. $(1.5 \\times 10^{6}, 0.03, 3.0 \\times 10^{5}, 2.0)$。\n\n所有 $\\omega_{b0}$ 和 $a$ 的单位均为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$J$ 的单位是作用量（能量除以角频率）。虽然您推导的解析二阶频移应取决于 $\\epsilon$、$a$ 和 $\\omega_{b0}$，但初始作用量 $J_{0}$ 是数值积分所必需的，也用于展示在小 $\\epsilon$ 下 $J(t)$ 的弱调制。\n\n您的程序应生成单行输出，其中包含所有测试用例的相对误差，格式为方括号内以逗号分隔的列表，并使用小数点后六位的科学记数法（例如，$[\\text{case1},\\text{case2},\\text{case3},\\text{case4}]$）。相对误差是无量纲的。\n\n无需用户输入。所有常量和参数均已在上面指定。通过从基本原理出发论证每个建模步骤来确保科学真实性；不要在问题陈述本身中引入简化公式。",
            "solution": "在尝试任何解决方案之前，用户提供的问题都经过了严格的验证过程。\n\n### 步骤 1：提取已知条件\n- **系统**：一个在大环径比、轴对称环形磁约束装置中被磁场捕获的高能离子。\n- **近似**：源自 Lorentz 力定律的导心近似。\n- **动力学**：平行（弹跳）运动是正则作用量-角度变量 $(\\theta, J)$ 中的单自由度谐振子。\n- **未扰动哈密顿量**：$H_{0}(J) = \\omega_{b0} J$，其中 $\\omega_{b0}$ 是未扰动弹跳角频率。\n- **微扰**：一个弱静态径向电场剪切，模型化为一个零均值周期项 $H_{1}(J, \\theta) = F(J) \\cos(2 \\theta)$ 乘以小参数 $\\epsilon \\ll 1$。\n- **微扰函数**：$F(J) = a J$，其中 $a$ 是一个与电场剪切率成正比的常数。\n- **总哈密顿量**：$H(J,\\theta) = H_{0}(J) + \\epsilon H_{1}(J,\\theta) = \\omega_{b0} J + \\epsilon \\, a J \\cos(2 \\theta)$。\n- **哈密顿运动方程**：$\\dot{\\theta} = \\frac{\\partial H}{\\partial J}$ 和 $\\dot{J} = -\\frac{\\partial H}{\\partial \\theta}$。\n- **数值积分初始条件**：$\\theta(0) = 0$ 和 $J(0) = J_{0}$。\n- **数值频率计算**：积分直到 $\\theta$ 在时间 $T$ 首次增加 $2\\pi$。数值弹跳角频率为 $\\omega_{\\mathrm{num}} = 2\\pi / T$。\n- **解析任务**：使用正则平均法推导弹跳角频率的二阶（$\\mathcal{O}(\\epsilon^2)$）修正。\n- **比较指标**：相对误差，定义为 $\\left|\\omega_{\\mathrm{num}} - \\omega_{\\mathrm{ana}}\\right| / \\omega_{\\mathrm{ana}}$。\n- **测试套件 $(\\omega_{b0}, \\epsilon, a, J_{0})$**：\n  1. $(1.0 \\times 10^{6}, 0.05, 1.0 \\times 10^{5}, 1.0)$\n  2. $(8.0 \\times 10^{5}, 0.05, 0.0, 1.0)$\n  3. $(1.2 \\times 10^{6}, 0.01, 2.0 \\times 10^{5}, 0.5)$\n  4. $(1.5 \\times 10^{6}, 0.03, 3.0 \\times 10^{5}, 2.0)$\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题牢固地植根于经典力学和等离子体物理学。导心理论和哈密顿形式是描述带电粒子在磁场中运动的标准工具。弹跳运动的谐振子模型对于深度捕获的粒子是有效的近似。将 $\\mathbf{E} \\times \\mathbf{B}$ 剪切表示为微扰在物理上是合理的。\n- **良态问题**：该问题在数学上是明确定义的。哈密顿量已指定，运动方程是明确的（哈密顿方程），并且为数值部分提供了初始条件。解析任务涉及将标准技术（正则微扰理论）应用于一个明确定义的系统。对于指定的量，存在唯一解。\n- **客观性**：该问题使用精确、客观的科学语言陈述。所有量都有清晰的定义，没有主观或含糊的术语。\n\n该问题不存在任何无效性缺陷：\n1.  **科学或事实不健全**：无。该模型是一个真实物理系统的标准（尽管简化了的）表示。\n2.  **不可形式化或不相关**：无。该问题是指定领域内哈密顿力学的一个形式化练习。\n3.  **设置不完整或矛盾**：无。所有必要的参数和定义均已提供。\n4.  **不切实际或不可行**：无。给定的参数值对于典型聚变装置中高能离子的弹跳运动具有现实的数量级。\n5.  **病态或结构不良**：无。\n6.  **伪深刻、琐碎或同义反复**：无。该问题需要非平凡的推导和仔细的数值实现。\n7.  **超出科学可验证性范围**：无。结果可通过数学推导和计算实验进行验证。\n\n### 步骤 3：结论与行动\n该问题是**有效**的。将提供完整的解析和计算解决方案。\n\n### 解题推导\n\n该问题要求使用正则微扰理论推导修正后的弹跳频率，并与直接数值积分的结果进行验证。\n\n**1. 通过正则平均法进行解析推导**\n\n我们从作用量-角度变量 $(J, \\theta)$ 的系统哈密顿量开始：\n$$H(J, \\theta) = H_0(J) + \\epsilon H_1(J, \\theta) = \\omega_{b0} J + \\epsilon a J \\cos(2\\theta)$$\n其中 $\\epsilon \\ll 1$ 是一个小参数。未扰动弹跳频率为 $\\omega_0(J) = \\partial H_0 / \\partial J = \\omega_{b0}$，它与作用量 $J$ 无关。\n\n我们寻求一个从原始变量 $(J, \\theta)$ 到新的“平均”变量 $(\\bar{J}, \\bar{\\theta})$ 的近恒等正则变换，使得新的哈密顿量 $K(\\bar{J})$ 在 $\\epsilon$ 的某个期望阶数内与角度 $\\bar{\\theta}$ 无关。此变换由一个形式为 $S(\\theta, \\bar{J}) = \\theta \\bar{J} + \\epsilon S_1(\\theta, \\bar{J}) + \\epsilon^2 S_2(\\theta, \\bar{J}) + \\dots$ 的生成函数定义。变换方程为 $J = \\partial S / \\partial \\theta$ 和 $\\bar{\\theta} = \\partial S / \\partial \\bar{J}$。\n\n新的哈密顿量 $K(\\bar{J})$ 是通过用新变量表示旧哈密顿量 $H(J, \\theta)$ 并确保其与 $\\theta$ 无关来找到的。将 $H$ 和 $K$ 按 $\\epsilon$ 的幂次展开（$H = H_0 + \\epsilon H_1$，$K = K_0 + \\epsilon K_1 + \\epsilon^2 K_2 + \\dots$）并令同次幂的项相等，得到一组同调方程。\n\n**一阶修正 ($\\mathcal{O}(\\epsilon)$):**\n一阶方程由下式给出：\n$$K_1(\\bar{J}) = \\langle H_1(\\bar{J}, \\theta) \\rangle_{\\theta}$$\n其中 $\\langle \\cdot \\rangle_{\\theta} = \\frac{1}{2\\pi} \\int_0^{2\\pi} (\\cdot) d\\theta$ 表示对未扰动运动（即对角度 $\\theta$）的平均。对于给定的微扰 $H_1(\\bar{J}, \\theta) = a \\bar{J} \\cos(2\\theta)$：\n$$K_1(\\bar{J}) = \\langle a \\bar{J} \\cos(2\\theta) \\rangle_{\\theta} = a \\bar{J} \\frac{1}{2\\pi} \\int_0^{2\\pi} \\cos(2\\theta) d\\theta = a \\bar{J} \\left[ \\frac{\\sin(2\\theta)}{2} \\right]_0^{2\\pi} = 0$$\n哈密顿量的一阶修正 $K_1$ 为零，因为微扰 $H_1$ 的均值为零。相应的一阶频率修正 $\\partial K_1 / \\partial \\bar{J}$ 也因此为零。这明确地证明了为什么领头修正必须至少是二阶的。\n\n生成函数的一阶部分 $S_1$ 由 $H_1$ 的振荡部分确定：\n$$\\omega_{b0} \\frac{\\partial S_1}{\\partial \\theta} = -(H_1 - \\langle H_1 \\rangle) = -a \\bar{J} \\cos(2\\theta)$$\n对 $\\theta$ 积分得到：\n$$S_1(\\theta, \\bar{J}) = -\\frac{a \\bar{J}}{2\\omega_{b0}} \\sin(2\\theta)$$\n\n**二阶修正 ($\\mathcal{O}(\\epsilon^2)$):**\n哈密顿量的二阶修正由标准公式给出：\n$$K_2(\\bar{J}) = \\left\\langle \\frac{1}{2} \\frac{\\partial^2 H_0}{\\partial \\bar{J}^2} \\left(\\frac{\\partial S_1}{\\partial \\theta}\\right)^2 + \\frac{\\partial H_1}{\\partial \\bar{J}} \\frac{\\partial S_1}{\\partial \\theta} \\right\\rangle_{\\theta}$$\n对于我们特定的未扰动哈密顿量 $H_0(\\bar{J}) = \\omega_{b0} \\bar{J}$，其二阶导数为零：\n$$\\frac{\\partial H_0}{\\partial \\bar{J}} = \\omega_{b0} \\quad \\implies \\quad \\frac{\\partial^2 H_0}{\\partial \\bar{J}^2} = 0$$\n这极大地简化了 $K_2$ 的表达式，因为第一项消失了。这是谐振子的一个特殊性质。我们剩下：\n$$K_2(\\bar{J}) = \\left\\langle \\frac{\\partial H_1}{\\partial \\bar{J}} \\frac{\\partial S_1}{\\partial \\theta} \\right\\rangle_{\\theta}$$\n我们需要 $H_1$ 和 $S_1$ 的导数：\n$$\\frac{\\partial H_1}{\\partial \\bar{J}} = \\frac{\\partial}{\\partial \\bar{J}} (a \\bar{J} \\cos(2\\theta)) = a \\cos(2\\theta)$$\n$$\\frac{\\partial S_1}{\\partial \\theta} = -\\frac{a \\bar{J}}{\\omega_{b0}} \\cos(2\\theta)$$\n将这些代入 $K_2$ 的表达式中：\n$$K_2(\\bar{J}) = \\left\\langle (a \\cos(2\\theta)) \\left(-\\frac{a \\bar{J}}{\\omega_{b0}} \\cos(2\\theta) \\right) \\right\\rangle_{\\theta} = -\\frac{a^2 \\bar{J}}{\\omega_{b0}} \\langle \\cos^2(2\\theta) \\rangle_{\\theta}$$\n$\\cos^2(2\\theta)$ 在一个周期内的平均值为 $1/2$：\n$$\\langle \\cos^2(2\\theta) \\rangle_{\\theta} = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{1+\\cos(4\\theta)}{2} d\\theta = \\frac{1}{2}$$\n因此，哈密顿量的二阶修正为：\n$$K_2(\\bar{J}) = -\\frac{a^2 \\bar{J}}{2\\omega_{b0}}$$\n\n**平均哈密顿量和修正频率：**\n修正到 $\\epsilon$ 二阶的平均哈密顿量为：\n$$K(\\bar{J}) = K_0(\\bar{J}) + \\epsilon K_1(\\bar{J}) + \\epsilon^2 K_2(\\bar{J}) = \\omega_{b0}\\bar{J} + 0 - \\epsilon^2 \\frac{a^2 \\bar{J}}{2\\omega_{b0}}$$\n新的正则频率，即解析弹跳频率 $\\omega_{\\text{ana}}$，通过对 $K$ 求关于新作用量 $\\bar{J}$ 的导数得到：\n$$\\omega_{\\text{ana}} = \\frac{d K}{d \\bar{J}} = \\omega_{b0} - \\epsilon^2 \\frac{a^2}{2\\omega_{b0}}$$\n这是弹跳频率的最终解析表达式，包含了在 $\\epsilon^2$ 阶上的领头非零修正。\n\n**2. 计算验证**\n\n为验证此解析结果，我们直接积分原始系统的哈密顿方程：\n$$ \\dot{\\theta} = \\frac{\\partial H}{\\partial J} = \\omega_{b0} + \\epsilon a \\cos(2\\theta) $$\n$$ \\dot{J} = -\\frac{\\partial H}{\\partial \\theta} = -(-\\epsilon a J \\cdot 2\\sin(2\\theta)) = 2\\epsilon a J \\sin(2\\theta) $$\n我们从初始条件 $\\theta(0) = 0$ 和 $J(0) = J_0$ 开始积分这个常微分方程组（ODEs）。积分过程持续到 $\\theta(t)$ 首次达到值 $2\\pi$。此事件发生的时间 $T$ 是数值弹跳周期。然后，数值频率计算为 $\\omega_{\\text{num}} = 2\\pi / T$。\n\n该实现使用 SciPy 库中的高精度 ODE 求解器（`scipy.integrate.solve_ivp`）及其事件检测功能，以精确确定弹跳周期 $T$。\n\n最后，根据规定为每个测试用例计算解析预测与数值结果之间的相对误差：\n$$\\text{相对误差} = \\frac{|\\omega_{\\text{num}} - \\omega_{\\text{ana}}|}{\\omega_{\\text{ana}}}$$\n解析理论是 $\\epsilon$ 的展开式，因此误差预计为 $\\mathcal{O}(\\epsilon^3)$ 或更高阶，对于给定的 $\\epsilon$ 值应该非常小。最终答案中的代码实现了此验证过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the bounce frequency of a trapped ion\n    both analytically (using second-order perturbation theory) and numerically\n    (by direct integration of Hamilton's equations), and then computes the\n    relative error between the two methods for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (omega_b0, epsilon, a, J0)\n    test_cases = [\n        # (omega_b0 [rad/s], epsilon [dimless], a [rad/s], J0 [action units])\n        (1.0e6, 0.05, 1.0e5, 1.0),\n        (8.0e5, 0.05, 0.0, 1.0),\n        (1.2e6, 0.01, 2.0e5, 0.5),\n        (1.5e6, 0.03, 3.0e5, 2.0),\n    ]\n\n    results = []\n    \n    # Define the system of ODEs (Hamilton's equations)\n    def hamiltonian_dynamics(t, y, w_b0, eps, a):\n        \"\"\"\n        Defines the time derivatives for the (theta, J) state vector.\n        y[0] = theta, y[1] = J.\n        \"\"\"\n        theta, J = y\n        d_theta_dt = w_b0 + eps * a * np.cos(2.0 * theta)\n        d_J_dt = 2.0 * eps * a * J * np.sin(2.0 * theta)\n        return [d_theta_dt, d_J_dt]\n\n    # Define the event function to stop integration when theta = 2*pi\n    def stop_at_2pi(t, y, w_b0, eps, a):\n        \"\"\"\n        Event function that triggers when theta crosses 2*pi from below.\n        Returns y[0] - 2*pi, so the event occurs when this function is zero.\n        \"\"\"\n        return y[0] - 2.0 * np.pi\n    \n    stop_at_2pi.terminal = True  # Stop the integration when the event is found\n    stop_at_2pi.direction = 1    # Trigger only when theta is increasing\n\n    for case in test_cases:\n        w_b0, eps, a, J0 = case\n\n        # 1. Calculate the analytical bounce frequency\n        # The formula derived is w_ana = w_b0 - eps^2 * a^2 / (2 * w_b0)\n        # Handle the case where w_b0 might be zero to avoid division by zero,\n        # although test cases here have w_b0  0.\n        if w_b0 == 0:\n            # For a=0 this is ill-defined, for a!=0 the frequency diverges\n            # which is outside the scope of this perturbation theory.\n            # This case is not in the test suite.\n            omega_ana = np.nan\n        else:\n            omega_ana = w_b0 - (eps**2 * a**2) / (2.0 * w_b0)\n\n        # 2. Calculate the numerical bounce frequency\n        # For the case a=0, the perturbation is zero, so w_num = w_b0.\n        if a == 0.0:\n            omega_num = w_b0\n        else:\n            # Set up the numerical integration\n            y0 = [0.0, J0]  # Initial conditions: theta(0)=0, J(0)=J0\n            \n            # An estimated time span for the integration.\n            # T_guess is approx 2*pi/w_b0. Let's use a safe upper bound.\n            t_span_end = 3.0 * np.pi / w_b0\n            \n            # Use a high-precision solver to minimize numerical error\n            sol = solve_ivp(\n                fun=hamiltonian_dynamics,\n                t_span=(0, t_span_end),\n                y0=y0,\n                args=(w_b0, eps, a),\n                events=stop_at_2pi,\n                method='DOP853',  # A high-order accurate method\n                rtol=1e-13,\n                atol=1e-13,\n                dense_output=True\n            )\n            \n            # The time of the event is the bounce period T\n            if sol.status == 1 and len(sol.t_events[0])  0:\n                T_bounce = sol.t_events[0][0]\n                omega_num = 2.0 * np.pi / T_bounce\n            else:\n                # Integration failed to find the event\n                omega_num = np.nan\n\n        # 3. Calculate the relative error\n        if np.isnan(omega_ana) or np.isnan(omega_num) or omega_ana == 0:\n            relative_error = np.nan\n        else:\n            relative_error = np.abs(omega_num - omega_ana) / np.abs(omega_ana)\n        \n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{err:.6e}' for err in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何物理模型都有其适用范围，引导中心近似也不例外。虽然它是高能粒子轨道跟踪计算的基石，但在磁场梯度剧烈变化的区域（如磁零点附近），这一近似会失效。本练习要求你编写一个完整的洛伦兹力积分器来模拟电子的轨迹，通过数值计算来确定磁矩绝热不变量失效的标度关系。这项实践将为你揭示我们最常用的模拟工具的有效性边界，这是评估和开发先进计算模型的一项核心能力。",
            "id": "4025404",
            "problem": "考虑一个非相对论性的高能电子，其电荷为 $q=-e$、质量为 $m=m_e$，在一个磁零点附近的静态、空间非均匀磁场中运动。使用一个具有一维零点的局域线性磁场模型：$\\mathbf{B}(\\mathbf{x})=b\\,x\\,\\hat{\\mathbf{z}}$，其中 $b$ 是一个单位为 $\\text{T}/\\text{m}$ 的恒定梯度，$x$ 是以米为单位的笛卡尔坐标，$\\hat{\\mathbf{z}}$ 是沿 $z$ 轴的单位向量。不存在电场。电子的运动遵循洛伦兹力定律和运动学方程：$m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$，$d\\mathbf{x}/dt=\\mathbf{v}$。磁矩定义为 $\\mu = m v_{\\perp}^{2}/(2\\,|\\mathbf{B}|)$，其中 $v_{\\perp}$ 是垂直于局部磁场的速度分量。\n\n从基本原理出发，完成以下任务：\n\n1) 使用洛伦兹力定律和局部回旋半径的定义 $ \\rho = m v_{\\perp}/(|q|\\,|\\mathbf{B}|)$，以及标准场变化标度 $L_{B} \\equiv |\\mathbf{B}|/|\\nabla \\mathbf{B}|$，推导给定线性零点场的无量纲绝热参数 $\\varepsilon \\equiv \\rho/L_{B}$，并用瞬时位置 $x$ 和速度分量 $v_{\\perp}$ 表示。然后，仅使用关于缓变系统的第一性原理进行推理，论证在零点附近回旋平均失效的标度关系，方法是将每个回旋周期内磁矩的分数变化 $\\Delta \\mu/\\mu$ 与 $\\varepsilon$ 联系起来，并推导出当在 $x(0)=r_{0}0$ 初始化时，$\\Delta \\mu/\\mu$ 随接近零点的距离 $r_{0}$ 的标度关系。你的推导必须从上述定义和 Newton 第二定律开始，并且不得引入任何关于回旋平均的现成结论；结论必须源于你自己的推理链。\n\n2) 对完整的洛伦兹动力学进行直接的数值轨道积分，以估计回旋平均的失效情况。在 $t=0$ 时，初始化电子的位置为 $(x,y,z)=(r_{0},0,0)$，速度为 $(v_{x},v_{y},v_{z})=(0,v_{0},0)$，其中 $r_{0}0$ 且 $v_{0}0$。对于下面测试套件中的每个初始 $r_{0}$，计算在一个初始回旋周期 $T_{0}$ 内磁矩的分数变化，该周期对应于初始磁场 $|\\mathbf{B}(0)|=b\\,r_{0}$，即 $T_{0}=2\\pi/\\omega_{0}$，其中 $\\omega_{0}=|q|\\,b\\,r_{0}/m$。具体来说，定义\n$$D(r_{0})=\\left|\\frac{\\mu(T_{0})-\\mu(0)}{\\mu(0)}\\right|,$$\n其中 $\\mu(t)=m\\,v_{\\perp}^{2}(t)/(2\\,|\\mathbf{B}(t)|)$ 且 $v_{\\perp}^{2}(t)=v_{x}^{2}(t)+v_{y}^{2}(t)$，因为 $\\mathbf{B}$ 沿着 $\\hat{\\mathbf{z}}$ 方向。为了在数值计算 $\\mu(t)$ 时，当轨迹恰好接近零点时避免除以零，通过使用一个小的底值 $B_{\\text{floor}}$ 将磁场大小 $|\\mathbf{B}(t)|$ 正则化为 $|\\mathbf{B}(t)|_{\\text{eff}}=\\max(|\\mathbf{B}(t)|,B_{\\text{floor}})$。\n\n3) 使用四个初始接近距离（测试套件）的集合\n- $r_{0,1}=1.0\\times 10^{-4}\\,\\text{m}$,\n- $r_{0,2}=5.0\\times 10^{-5}\\,\\text{m}$,\n- $r_{0,3}=2.5\\times 10^{-5}\\,\\text{m}$,\n- $r_{0,4}=1.25\\times 10^{-5}\\,\\text{m}$,\n\n以及固定参数\n- $b=50\\,\\text{T}/\\text{m}$,\n- $v_{0}=1.0\\times 10^{4}\\,\\text{m}/\\text{s}$,\n- $q=-1.602176634\\times 10^{-19}\\,\\text{C}$,\n- $m=9.1093837015\\times 10^{-31}\\,\\text{kg}$,\n- $B_{\\text{floor}}=1.0\\times 10^{-6}\\,\\text{T}$,\n\n计算 $i\\in\\{1,2,3,4\\}$ 的 $D(r_{0,i})$。然后，使用这四个数据点，通过对 $\\log D$ 与 $\\log r_{0}$ 进行最小二乘线性拟合，估计由 $D(r_{0})\\propto r_{0}^{-\\alpha}$ 定义的标度指数 $\\alpha$，并将 $\\alpha=-\\,d(\\log D)/d(\\log r_{0})$ 报告为单个浮点数。\n\n任何计算中的所有角度都必须以弧度为单位。输出 $D(r_{0,i})$ 和 $\\alpha$ 是无量纲的，并且必须报告为不带单位的浮点数。\n\n你的程序必须直接积分运动方程（在数值步骤中不使用引导中心近似），为所有四个 $r_{0}$ 值计算 $D(r_{0,i})$，从这四个点估计 $\\alpha$，并生成单行输出，包含五个结果，按以下顺序排列为一个逗号分隔的Python风格列表：\n$[D(r_{0,1}),D(r_{0,2}),D(r_{0,3}),D(r_{0,4}),\\alpha]$。",
            "solution": "该问题要求对电子在具有一维零点的磁场中的运动进行两部分分析。首先，是绝热参数的理论推导和磁矩守恒失效的标度关系论证。其次，是通过直接数值模拟来计算磁矩的分数变化，并从数值数据中确定标度指数。\n\n### 第1部分：理论推导与标度关系论证\n\n电子的运动由洛伦兹力 $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$ 在磁场 $\\mathbf{B}(\\mathbf{x})=b\\,x\\,\\hat{\\mathbf{z}}$ 中决定。问题要求推导无量纲绝热参数 $\\varepsilon \\equiv \\rho/L_{B}$ 以及关于磁矩 $\\mu$ 不守恒的标度关系论证。\n\n**1.1. 绝热参数 $\\varepsilon$ 的推导**\n\n绝热参数 $\\varepsilon$ 是局部回旋半径 $\\rho$ 与磁场特征标度长度 $L_{B}$ 的比值。我们针对给定场推导每一项。\n\n磁场为 $\\mathbf{B} = b\\,x\\,\\hat{\\mathbf{z}}$。其大小为 $|\\mathbf{B}| = |b\\,x|$。我们假设 $b  0$ 且感兴趣的区域是 $x0$，这与初始条件 $x(0) = r_0  0$ 一致。因此，$|\\mathbf{B}| = b\\,x$。\n\n磁场变化标度长度定义为 $L_{B} \\equiv |\\mathbf{B}|/|\\nabla \\mathbf{B}|$。项 $|\\nabla \\mathbf{B}|$ 通常被解释为磁场强度梯度的模，即 $|\\nabla(|\\mathbf{B}|)|$。\n我们计算场强的梯度：\n$$\n\\nabla(|\\mathbf{B}|) = \\nabla(b\\,x) = b\\,\\nabla x = b\\,\\hat{\\mathbf{x}}\n$$\n这个梯度的大小是 $|\\nabla(|\\mathbf{B}|)| = |b\\,\\hat{\\mathbf{x}}| = b$。\n因此，标度长度是：\n$$\nL_{B} = \\frac{|\\mathbf{B}|}{|\\nabla(|\\mathbf{B}|)|} = \\frac{b\\,x}{b} = x\n$$\n这个结果表明，对于这种线性零点场，特征标度长度就是到 $x=0$ 零点平面的距离。\n\n局部回旋半径定义为 $\\rho = m v_{\\perp}/(|q|\\,|\\mathbf{B}|)$，其中 $v_{\\perp}$ 是垂直于 $\\mathbf{B}$ 的速度分量。代入 $|\\mathbf{B}| = b\\,x$，我们得到：\n$$\n\\rho = \\frac{m v_{\\perp}}{|q|\\,b\\,x}\n$$\n现在，我们可以表示绝热参数 $\\varepsilon$：\n$$\n\\varepsilon \\equiv \\frac{\\rho}{L_{B}} = \\frac{m v_{\\perp}/(|q|\\,b\\,x)}{x} = \\frac{m v_{\\perp}}{|q|\\,b\\,x^2}\n$$\n这就是所求的用瞬时位置 $x$ 和垂直速度 $v_{\\perp}$ 表示的 $\\varepsilon$ 的表达式。\n\n**1.2. 磁矩不守恒的标度关系**\n\n磁矩 $\\mu = m v_{\\perp}^2 / (2|\\mathbf{B}|)$ 是一个绝热不变量，意味着当粒子经历的磁场在一个回旋周期内变化缓慢时，它是近似守恒的。“缓慢性”的程度由 $\\varepsilon$ 量化。当 $\\varepsilon \\ll 1$ 时，系统是绝热的。当 $\\varepsilon \\gtrsim 1$ 时，绝热性被破坏，$\\mu$ 不再守恒。\n\n问题要求一个关于每个回旋周期内 $\\mu$ 的分数变化 $\\Delta\\mu/\\mu$ 的标度关系的第一性原理的论证。$\\mu$ 的守恒依赖于回旋平均：在一个回旋轨道的半边改变粒子能量或动量的效应被另一半边的相反效应所抵消。这种抵消仅在均匀磁场中是完美的。在非均匀场中，粒子在其轨道上会采样到变化的场强和方向。\n\n这种抵消的失效是由于在回旋半径 $\\rho$ 范围内的场变化。粒子在其轨道上经历的磁场分数变化量级为 $\\delta B / |\\mathbf{B}| \\approx (\\rho |\\nabla \\mathbf{B}|) / |\\mathbf{B}| = \\rho / (|\\mathbf{B}|/|\\nabla \\mathbf{B}|) = \\rho/L_B = \\varepsilon$。\n\n导致在一个回旋周期内 $\\mu$ 发生净变化的非绝热效应是这种场变化的直接后果。对于缓变系统（$\\varepsilon \\ll 1$），微扰理论的一个标准结果是，绝热不变量在快运动每个周期内的分数变化与表征慢变化的小参数成正比。在本例中，该参数是 $\\varepsilon$。因此，我们可以论证每个回旋周期内 $\\mu$ 的分数变化与 $\\varepsilon$ 呈线性标度关系：\n$$\n\\frac{\\Delta \\mu}{\\mu} \\propto \\varepsilon\n$$\n问题要求用初始接近距离 $r_0$ 来评估此标度关系。我们在初始条件下评估 $\\varepsilon$：$x(0) = r_0$ 并且，由于 $\\mathbf{v}(0)=(0,v_0,0)$ 且 $\\mathbf{B}$ 沿 $\\hat{\\mathbf{z}}$ 方向，$v_{\\perp}(0)=v_0$。\n$$\n\\varepsilon(t=0) = \\frac{m v_0}{|q|\\,b\\,r_0^2}\n$$\n基于第一个回旋周期内 $\\mu$ 的分数变化 $D(r_0)$ 与绝热参数的初始值成正比的论点，我们推导出标度关系：\n$$\nD(r_0) \\propto \\varepsilon(t=0) \\propto \\frac{1}{r_0^2}\n$$\n这意味着标度定律为 $D(r_0) \\propto r_0^{-\\alpha}$，理论指数为 $\\alpha=2$。\n\n### 第2部分：数值解设计\n\n问题要求直接数值积分运动方程以计算 $D(r_0)=\\left|\\frac{\\mu(T_{0})-\\mu(0)}{\\mu(0)}\\right|$ 并估计标度指数 $\\alpha$。\n\n**2.1. 运动方程和运动常数**\n\n电子的状态由其位置 $\\mathbf{x}=(x,y,z)$ 和速度 $\\mathbf{v}=(v_x,v_y,v_z)$ 描述。洛伦兹力方程的分量形式为：\n$$\n\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}\n$$\n$$\nm \\frac{d\\mathbf{v}}{dt} = q\\,\\mathbf{v} \\times (b\\,x\\,\\hat{\\mathbf{z}}) = q\\,b\\,x\\,(v_y\\hat{\\mathbf{x}} - v_x\\hat{\\mathbf{y}})\n$$\n这得到六个一阶常微分方程（ODE）组成的系统：\n$1. \\quad \\dot{x} = v_x$\n$2. \\quad \\dot{y} = v_y$\n$3. \\quad \\dot{z} = v_z$\n$4. \\quad \\dot{v}_x = (q/m)\\,b\\,x\\,v_y$\n$5. \\quad \\dot{v}_y = -(q/m)\\,b\\,x\\,v_x$\n$6. \\quad \\dot{v}_z = 0$\n\n从方程6和初始条件 $v_z(0)=0$，我们有 $v_z(t)=0$ 对所有 $t$ 成立。因此，$z(t)=0$。\n此外，考虑垂直动能 $K_{\\perp} = \\frac{1}{2}m v_{\\perp}^2 = \\frac{1}{2}m(v_x^2+v_y^2)$。其变化率为：\n$$\n\\frac{dK_{\\perp}}{dt} = m(v_x \\dot{v}_x + v_y \\dot{v}_y) = m\\left(v_x \\frac{qbxv_y}{m} + v_y \\frac{-qbxv_x}{m}\\right) = qbx(v_x v_y - v_y v_x) = 0\n$$\n因此，对于这个特定的磁场，$v_{\\perp}^2 = v_x^2+v_y^2$ 是一个精确的运动常数。给定初始条件，$v_{\\perp}^2(t) = v_x(0)^2+v_y(0)^2 = v_0^2$ 对所有 $t$ 成立。\n\n**2.2. $D(r_0)$的计算**\n\n磁矩是 $\\mu(t) = \\frac{m v_{\\perp}^2(t)}{2 |\\mathbf{B}(t)|_{\\text{eff}}}$。由于 $v_{\\perp}^2(t) = v_0^2$ 是常数，公式简化为 $\\mu(t) = \\frac{m v_0^2}{2 |\\mathbf{B}(t)|_{\\text{eff}}}$。那么量 $D(r_0)$ 是：\n$$\nD(r_0) = \\left|\\frac{\\mu(T_0) - \\mu(0)}{\\mu(0)}\\right| = \\left|\\frac{m v_0^2 / (2 |\\mathbf{B}(T_0)|_{\\text{eff}}) - m v_0^2 / (2 |\\mathbf{B}(0)|_{\\text{eff}})}{m v_0^2 / (2 |\\mathbf{B}(0)|_{\\text{eff}})}\\right| = \\left| \\frac{|\\mathbf{B}(0)|_{\\text{eff}}}{|\\mathbf{B}(T_0)|_{\\text{eff}}} - 1 \\right|\n$$\n其中 $|\\mathbf{B}(t)|_{\\text{eff}}=\\max(|\\mathbf{B}(t)|,B_{\\text{floor}})$。在 $t=0$ 时， $|\\mathbf{B}(0)| = |b\\,x(0)| = b\\,r_0$。在 $t=T_0$ 时， $|\\mathbf{B}(T_0)| = |b\\,x(T_0)|$。\n数值算法如下：\n1.  对于测试套件中的每个初始距离 $r_{0,i}$：\n2.  定义初始状态向量 $S_0 = (x,y,z,v_x,v_y,v_z) = (r_{0,i}, 0, 0, 0, v_0, 0)$。\n3.  计算初始回旋周期 $T_{0,i} = 2\\pi m / (|q|\\,b\\,r_{0,i})$。\n4.  使用高精度数值求解器（例如，`scipy.integrate.solve_ivp` 并设置严格的误差容限）将6个ODE组成的系统从 $t=0$ 积分到 $t=T_{0,i}$。\n5.  从积分结果中，提取最终位置 $x(T_{0,i})$。\n6.  计算有效磁场大小：$|\\mathbf{B}(0)|_{\\text{eff}} = \\max(b\\,r_{0,i}, B_{\\text{floor}})$ 和 $|\\mathbf{B}(T_0)|_{\\text{eff}} = \\max(|b\\,x(T_{0,i})|, B_{\\text{floor}})$。\n7.  使用上面的简化公式计算 $D(r_{0,i})$。\n\n**2.3. 标度指数 $\\alpha$ 的估计**\n\n假设的标度定律是 $D(r_0) \\propto r_0^{-\\alpha}$。两边取自然对数得到一个线性关系：\n$$\n\\ln(D(r_0)) = C - \\alpha \\ln(r_0)\n$$\n这是一个直线方程 $y = mx+c$，其中 $y = \\ln(D)$，$x = \\ln(r_0)$，斜率 $m = -\\alpha$，截距 $c=C$。\n为了从四个计算出的数据点 $(r_{0,i}, D(r_{0,i}))$ 估计 $\\alpha$：\n1.  将数据转换为对数标度：$(\\ln(r_{0,i}), \\ln(D(r_{0,i})))$。\n2.  对这四个转换后的点进行线性最小二乘回归，以找到最佳拟合斜率。可以使用像 `numpy.polyfit` 这样的标准库函数。\n3.  标度指数是斜率的负值：$\\alpha = -\\text{slope}$。\n\n这个数值过程将提供 $D(r_{0,i})$ 的四个值和估计的指数 $\\alpha$，满足问题的所有要求。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the problem of electron orbit integration near a magnetic null\n    to determine the breakdown of magnetic moment conservation.\n    \"\"\"\n    \n    # Given physical and simulation parameters\n    b = 50.0  # T/m\n    v0 = 1.0e4 # m/s\n    q = -1.602176634e-19  # C\n    m = 9.1093837015e-31  # kg\n    B_floor = 1.0e-6  # T\n    \n    # Test suite of initial distances to the null\n    r0_values = np.array([\n        1.0e-4,\n        5.0e-5,\n        2.5e-5,\n        1.25e-5,\n    ])\n\n    # Pre-calculate constant factor for ODEs\n    q_over_m = q / m\n    q_b_over_m = q_over_m * b\n\n    def lorentz_force_ode(t, state):\n        \"\"\"\n        Defines the system of ordinary differential equations for the Lorentz force.\n        The state vector is [x, y, z, vx, vy, vz].\n        \"\"\"\n        x, y, z, vx, vy, vz = state\n        \n        # d(state)/dt\n        dxdt = vx\n        dydt = vy\n        dzdt = vz\n        \n        # Lorentz force components\n        dvxdt = q_b_over_m * x * vy\n        dvydt = -q_b_over_m * x * vx\n        dvzdt = 0.0\n        \n        return [dxdt, dydt, dzdt, dvxdt, dvydt, dvzdt]\n\n    D_values = []\n    \n    for r0 in r0_values:\n        # 1. Set initial conditions\n        # state = [x, y, z, vx, vy, vz]\n        initial_state = [r0, 0.0, 0.0, 0.0, v0, 0.0]\n        \n        # 2. Calculate the initial gyroperiod\n        # B0 is guaranteed to be  B_floor for the given r0 values.\n        B0 = b * r0 \n        omega0 = abs(q) * B0 / m\n        T0 = 2.0 * np.pi / omega0\n        \n        # 3. Integrate the equations of motion over one initial gyroperiod\n        # Use a high-precision solver (RK45 is the default, which is fine)\n        # with stringent tolerances for accuracy.\n        sol = solve_ivp(\n            lorentz_force_ode,\n            t_span=[0, T0],\n            y0=initial_state,\n            t_eval=[T0],\n            rtol=1e-12,\n            atol=1e-12,\n        )\n        \n        final_state = sol.y[:, -1]\n        x_final = final_state[0]\n        \n        # 4. Calculate the fractional change in magnetic moment D(r0)\n        # As derived, v_perp is conserved, so the change in mu is due to B\n        # D(r0) = | mu(T0)/mu(0) - 1 | = | B(0)_eff / B(T0)_eff - 1|\n        B0_eff = max(B0, B_floor)\n        B_final = abs(b * x_final)\n        B_final_eff = max(B_final, B_floor)\n        \n        # Avoid division by zero if particle hits the null and B_final_eff is zero\n        if B_final_eff == 0:\n            # This case is unlikely with B_floor regularization but is a safe-guard.\n            # If the final field is zero, mu is infinite, and D is infinite.\n            D_r0 = np.inf\n        else:\n            D_r0 = abs(B0_eff / B_final_eff - 1.0)\n            \n        D_values.append(D_r0)\n\n    # 5. Estimate the scaling exponent alpha\n    # Model: D(r0) = C * r0^(-alpha) = log(D) = log(C) - alpha * log(r0)\n    # We fit a line to log(D) vs log(r0). The slope is -alpha.\n    log_r0 = np.log(r0_values)\n    log_D = np.log(D_values)\n    \n    # Perform linear least-squares fit (degree 1 polynomial)\n    slope, intercept = np.polyfit(log_r0, log_D, 1)\n    \n    alpha = -slope\n    \n    # 6. Format and print the final output\n    results = D_values + [alpha]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}