{
    "hands_on_practices": [
        {
            "introduction": "A foundational concept in turbulence theory is the mixing-length estimate, which provides a simple yet powerful picture of saturation. It posits that turbulence grows until the nonlinear decorrelation rate, driven by the turbulent eddies themselves, becomes large enough to balance the linear growth rate. This exercise  provides a hands-on calculation to determine the saturation amplitude in a model drift-wave system, solidifying the connection between linear instability and nonlinear self-regulation.",
            "id": "4059944",
            "problem": "In a magnetized fusion plasma exhibiting ion-temperature-gradient-driven drift-wave turbulence, saturation is often modeled as the balance between linear growth and nonlinear decorrelation. Consider the following scientifically plausible scenario for the perpendicular wavenumber dependence of the linear growth rate and the E×B drift velocity. The linear growth rate as a function of perpendicular wavenumber $k$ is modeled by\n$$\n\\gamma_{\\mathrm{lin}}(k) = \\gamma_{0} \\, \\frac{k \\rho_{s}}{1 + k^{2} \\rho_{s}^{2}},\n$$\nwhere $\\gamma_{0}$ is a constant and $\\rho_{s}$ is the ion-sound Larmor radius. The E×B drift velocity spectrum measured in a direct numerical simulation prior to full saturation is represented by a shape function with an unknown overall amplitude $A$,\n$$\nu_{E}(k) = A \\, u_{0} \\, \\frac{k \\rho_{s}}{1 + k^{2} \\rho_{s}^{2}},\n$$\nwhere $u_{0}$ is a known velocity scale extracted from the simulation. Assume an isotropic perpendicular cascade and that decorrelation is controlled by E×B advection. Take the nonlinear decorrelation rate to be parameterized by a dimensionless constant $C$ multiplying the characteristic inverse eddy turnover time.\n\nUse these data to determine the saturation amplitude $A$ by enforcing the condition that the nonlinear decorrelation rate equals the linear growth rate at a representative wavenumber $k_{\\ast}$, defined as the $k$ that maximizes $\\gamma_{\\mathrm{lin}}(k)$. The given parameters are\n$$\n\\gamma_{0} = 1.6 \\times 10^{5} \\ \\mathrm{s}^{-1}, \\quad \\rho_{s} = 2.5 \\times 10^{-3} \\ \\mathrm{m}, \\quad u_{0} = 5.0 \\times 10^{2} \\ \\mathrm{m/s}, \\quad C = 1.\n$$\nCompute the value of $A$ at saturation. Express the final amplitude as a dimensionless number and round your answer to three significant figures.",
            "solution": "The solution proceeds in four steps:\n1. Determine the representative wavenumber $k_{\\ast}$ that maximizes the linear growth rate $\\gamma_{\\mathrm{lin}}(k)$.\n2. Evaluate both the linear growth rate $\\gamma_{\\mathrm{lin}}(k_{\\ast})$ and the nonlinear decorrelation rate $\\gamma_{\\mathrm{nl}}(k_{\\ast})$ at this wavenumber.\n3. Apply the saturation condition $\\gamma_{\\mathrm{lin}}(k_{\\ast}) = \\gamma_{\\mathrm{nl}}(k_{\\ast})$ to derive an analytical expression for the saturation amplitude $A$.\n4. Substitute the given numerical values to compute the value of $A$.\n\n**1. Determine the Representative Wavenumber $k_{\\ast}$**\n\nTo find the wavenumber $k_{\\ast}$ that maximizes $\\gamma_{\\mathrm{lin}}(k)$, we find the derivative of $\\gamma_{\\mathrm{lin}}(k)$ with respect to $k$ and set it to zero. Let $x = k \\rho_{s}$. The growth rate expression becomes:\n$$ \\gamma_{\\mathrm{lin}}(x) = \\gamma_{0} \\frac{x}{1 + x^{2}} $$\nDifferentiating with respect to $x$ and setting the result to zero:\n$$ \\frac{d\\gamma_{\\mathrm{lin}}}{dx} = \\gamma_{0} \\frac{d}{dx} \\left( \\frac{x}{1 + x^{2}} \\right) = \\gamma_{0} \\frac{(1)(1 + x^{2}) - x(2x)}{(1 + x^{2})^{2}} = \\gamma_{0} \\frac{1 - x^{2}}{(1 + x^{2})^{2}} $$\nSetting the derivative to zero gives $1 - x^{2} = 0$. Since $k$ and $\\rho_{s}$ are positive, $x$ must be positive, so $x = 1$. The representative wavenumber $k_{\\ast}$ is therefore defined by the condition:\n$$ k_{\\ast} \\rho_{s} = 1 \\implies k_{\\ast} = \\frac{1}{\\rho_{s}} $$\n\n**2. Evaluate Rates at $k_{\\ast}$**\n\nThe nonlinear decorrelation rate is given by the inverse eddy turnover time, $\\gamma_{\\mathrm{nl}}(k) = C k u_{E}(k)$. We evaluate both rates at $k = k_{\\ast}$.\nFor the linear growth rate, we substitute $k_{\\ast} \\rho_{s} = 1$:\n$$ \\gamma_{\\mathrm{lin}}(k_{\\ast}) = \\gamma_{0} \\frac{k_{\\ast} \\rho_{s}}{1 + (k_{\\ast} \\rho_{s})^{2}} = \\gamma_{0} \\frac{1}{1 + 1^{2}} = \\frac{\\gamma_{0}}{2} $$\nFor the nonlinear decorrelation rate:\n$$ \\gamma_{\\mathrm{nl}}(k) = C k u_{E}(k) = C k \\left( A u_{0} \\frac{k \\rho_{s}}{1 + k^{2} \\rho_{s}^{2}} \\right) = C A u_{0} \\rho_{s} \\frac{k^{2}}{1 + k^{2} \\rho_{s}^{2}} $$\nEvaluating at $k = k_{\\ast} = 1/\\rho_{s}$:\n$$ \\gamma_{\\mathrm{nl}}(k_{\\ast}) = C A u_{0} \\rho_{s} \\frac{(1/\\rho_{s})^{2}}{1 + (1/\\rho_{s})^{2} \\rho_{s}^{2}} = C A u_{0} \\rho_{s} \\frac{1/\\rho_{s}^{2}}{1 + 1} = \\frac{C A u_{0}}{2 \\rho_{s}} $$\n\n**3. Solve for the Saturation Amplitude $A$**\n\nThe saturation condition is $\\gamma_{\\mathrm{lin}}(k_{\\ast}) = \\gamma_{\\mathrm{nl}}(k_{\\ast})$:\n$$ \\frac{\\gamma_{0}}{2} = \\frac{C A u_{0}}{2 \\rho_{s}} $$\nSolving for the saturation amplitude $A$:\n$$ A = \\frac{\\gamma_{0} \\rho_{s}}{C u_{0}} $$\n\n**4. Compute the Numerical Value of $A$**\n\nFinally, we substitute the given numerical values:\n- $\\gamma_{0} = 1.6 \\times 10^{5} \\ \\mathrm{s}^{-1}$\n- $\\rho_{s} = 2.5 \\times 10^{-3} \\ \\mathrm{m}$\n- $u_{0} = 5.0 \\times 10^{2} \\ \\mathrm{m/s}$\n- $C = 1$\n\n$$ A = \\frac{(1.6 \\times 10^{5}) \\times (2.5 \\times 10^{-3})}{1 \\times (5.0 \\times 10^{2})} = \\frac{4.0 \\times 10^{2}}{5.0 \\times 10^{2}} = 0.8 $$\nRounding the answer to three significant figures, we get $0.800$.",
            "answer": "$$\n\\boxed{0.800}\n$$"
        },
        {
            "introduction": "While self-advection is a key saturation process, a more complex and often dominant mechanism in plasmas is the interaction with zonal flows. This dynamic can be elegantly captured by reduced predator-prey models, where the drift-wave turbulence (prey) drives the growth of zonal flows (predator), which in turn shear apart and suppress the turbulence. This practice  offers a practical exercise in model validation, tasking you with fitting the coefficients of such a model to data from a gyrokinetic simulation to predict the final saturated state.",
            "id": "4059909",
            "problem": "Consider a reduced predator–prey model for drift-wave turbulence and zonal flow interactions in a magnetized plasma, where the turbulence fluctuation amplitude $A(t)$ and the zonal flow shear $S(t)$ evolve according to\n$$\\frac{dA}{dt}=\\gamma A-\\alpha S A-\\beta A^{3},\\qquad \\frac{dS}{dt}=\\sigma A^{2}-\\nu S.$$\nThis form codifies that linear instability drives fluctuations at rate $\\gamma$, the flow shear suppresses turbulence with strength $\\alpha$, nonlinear mode coupling self-saturates fluctuations with strength $\\beta$, Reynolds stress drives zonal flows with coefficient $\\sigma$, and collisional damping relaxes zonal flows with rate $\\nu$. All quantities are dimensionless under the normalization $t\\rightarrow t\\Omega_{i}$, where $\\Omega_{i}$ is the ion gyrofrequency. The instantaneous logarithmic growth rate of the fluctuations is $g(t)\\equiv \\frac{d}{dt}\\ln A(t)$, which obeys $g=\\gamma-\\alpha S-\\beta A^{2}$ under the model.\n\nA nonlinear gyrokinetic simulation of an Ion Temperature Gradient (ITG) driven state provides the following measured triplets $\\{A,S,g\\}$ at three distinct instants during the transient approach to saturation:\n1) $A=0.12$, $S=0.28$, $g=0.05464$.\n2) $A=0.18$, $S=0.41$, $g=0.02804$.\n3) $A=0.22$, $S=0.52$, $g=0.00484$.\nAdditionally, the same simulation reports the zonal flow shear time derivative at those instants:\n1) $\\frac{dS}{dt}=-0.006$ at $A=0.12$, $S=0.28$.\n2) $\\frac{dS}{dt}=0.0195$ at $A=0.18$, $S=0.41$.\n3) $\\frac{dS}{dt}=0.043$ at $A=0.22$, $S=0.52$.\n\nUsing only the model equations and these measurements:\n1) Determine the coefficients $\\gamma$, $\\alpha$, and $\\beta$ that fit the three $\\{A,S,g\\}$ points exactly.\n2) Determine the coefficients $\\sigma$ and $\\nu$ that fit the three $\\left\\{\\frac{dS}{dt},A,S\\right\\}$ points exactly.\n3) Using the fitted coefficients, compute the nontrivial steady state fluctuation amplitude $A_{\\mathrm{ss}}$ implied by the model.\n4) The direct numerical saturation level reported by the simulation is $A_{\\mathrm{sat,dir}}=0.213$. Compute the fractional discrepancy\n$$\\Delta=\\frac{A_{\\mathrm{ss}}-A_{\\mathrm{sat,dir}}}{A_{\\mathrm{sat,dir}}}.$$\nExpress your final numerical answer for $\\Delta$ as a decimal number with four significant figures. No units are required for $A$, $S$, or $\\Delta$.",
            "solution": "The problem is solved in four parts: 1) determine the coefficients ($\\gamma, \\alpha, \\beta$) for the fluctuation amplitude equation; 2) determine the coefficients ($\\sigma, \\nu$) for the zonal flow shear equation; 3) compute the nontrivial steady-state fluctuation amplitude $A_{\\mathrm{ss}}$; and 4) compute the fractional discrepancy $\\Delta$ with the given simulation result.\n\n**1. Determine the coefficients $\\gamma$, $\\alpha$, and $\\beta$**\n\nThe instantaneous logarithmic growth rate is given by $g = \\gamma - \\alpha S - \\beta A^{2}$. This is a linear equation for the unknowns $\\gamma$, $\\alpha$, and $\\beta$. Using the three provided data points $\\{A,S,g\\}$, we construct a system of three linear equations:\n1.  For $\\{0.12, 0.28, 0.05464\\}$:\n    $$ \\gamma - 0.28\\alpha - 0.0144\\beta = 0.05464 \\quad (1)$$\n2.  For $\\{0.18, 0.41, 0.02804\\}$:\n    $$ \\gamma - 0.41\\alpha - 0.0324\\beta = 0.02804 \\quad (2)$$\n3.  For $\\{0.22, 0.52, 0.00484\\}$:\n    $$ \\gamma - 0.52\\alpha - 0.0484\\beta = 0.00484 \\quad (3)$$\n\nSubtracting the equations pairwise to eliminate $\\gamma$:\n$$ (1)-(2) \\implies 0.13\\alpha + 0.018\\beta = 0.0266 \\quad (A) $$\n$$ (2)-(3) \\implies 0.11\\alpha + 0.016\\beta = 0.0232 \\quad (B) $$\nSolving this $2 \\times 2$ system yields $\\alpha = 0.08$ and $\\beta = 0.9$. Substituting these values back into equation (1) gives $\\gamma = 0.09$.\nThe coefficients are $\\gamma=0.09$, $\\alpha=0.08$, and $\\beta=0.9$.\n\n**2. Determine the coefficients $\\sigma$ and $\\nu$**\n\nThe shear evolution is given by $\\frac{dS}{dt} = \\sigma A^2 - \\nu S$. Using the three data points for $\\{\\frac{dS}{dt}, A, S\\}$, we form a system of equations:\n1.  $\\sigma(0.12)^2 - \\nu(0.28) = 0.0144\\sigma - 0.28\\nu = -0.006$\n2.  $\\sigma(0.18)^2 - \\nu(0.41) = 0.0324\\sigma - 0.41\\nu = 0.0195$\n3.  $\\sigma(0.22)^2 - \\nu(0.52) = 0.0484\\sigma - 0.52\\nu = 0.043$\nSolving the first two equations for the two unknowns gives $\\sigma=2.5$ and $\\nu=0.15$. We can verify that these values also satisfy the third equation: $0.0484(2.5) - 0.52(0.15) = 0.121 - 0.078 = 0.043$. The data are consistent.\nThe coefficients are $\\sigma=2.5$ and $\\nu=0.15$.\n\n**3. Compute the nontrivial steady state fluctuation amplitude $A_{\\mathrm{ss}}$**\n\nThe steady state is defined by $\\frac{dA}{dt}=0$ and $\\frac{dS}{dt}=0$. For the nontrivial state ($A_{\\mathrm{ss}} \\neq 0$):\n$$ \\gamma - \\alpha S_{\\mathrm{ss}} - \\beta A_{\\mathrm{ss}}^2 = 0 $$\n$$ \\sigma A_{\\mathrm{ss}}^2 - \\nu S_{\\mathrm{ss}} = 0 \\implies S_{\\mathrm{ss}} = \\frac{\\sigma}{\\nu} A_{\\mathrm{ss}}^2 $$\nSubstituting $S_{\\mathrm{ss}}$ into the first equation and solving for $A_{\\mathrm{ss}}^2$:\n$$ \\gamma = A_{\\mathrm{ss}}^2 \\left( \\frac{\\alpha\\sigma}{\\nu} + \\beta \\right) \\implies A_{\\mathrm{ss}}^2 = \\frac{\\gamma}{\\frac{\\alpha\\sigma}{\\nu} + \\beta} $$\nPlugging in the determined coefficient values:\n$$ A_{\\mathrm{ss}}^2 = \\frac{0.09}{\\frac{(0.08)(2.5)}{0.15} + 0.9} = \\frac{0.09}{\\frac{4}{3} + 0.9} = \\frac{0.09}{\\frac{67}{30}} = \\frac{27}{670} $$\nThe steady-state amplitude is:\n$$ A_{\\mathrm{ss}} = \\sqrt{\\frac{27}{670}} \\approx 0.200745 $$\n\n**4. Compute the fractional discrepancy $\\Delta$**\n\nThe fractional discrepancy is $\\Delta=\\frac{A_{\\mathrm{ss}}-A_{\\mathrm{sat,dir}}}{A_{\\mathrm{sat,dir}}}$. Using the given $A_{\\mathrm{sat,dir}}=0.213$:\n$$ \\Delta = \\frac{0.200745 - 0.213}{0.213} = \\frac{-0.012255}{0.213} \\approx -0.057535 $$\nRounding to four significant figures gives $\\Delta \\approx -0.05754$. This discrepancy indicates that the simple predator-prey model, while fitted to transient data, predicts a steady-state saturation amplitude about 5.75% lower than the full simulation.",
            "answer": "$$\\boxed{-0.05754}$$"
        },
        {
            "introduction": "Once turbulence saturates, it establishes a steady flow of energy from large-scale driving to small-scale dissipation, known as an energy cascade. To diagnose this crucial process, computational scientists use spectral analysis tools to measure the shell-to-shell transfer of energy or other invariants in wavenumber space. This advanced numerical exercise  guides you through the process of building a spectral filter to compute these transfers from a synthetic snapshot of a turbulent field, allowing you to identify the dominant nonlocal interactions governing the system.",
            "id": "4059961",
            "problem": "You are tasked with deriving and implementing a numerical procedure to compute shell-to-shell transfers of a quadratic invariant for two-dimensional electrostatic turbulence in a strongly magnetized plasma, and using the computed transfers to identify dominant nonlocal interactions that govern saturation. The base physics is the Hasegawa–Mima model, a reduced drift-wave system relevant to Computational Fusion Science and Engineering. Your implementation must be grounded in first principles and produce a single-line output as specified.\n\nConsider a two-dimensional square domain of side length $L$ with periodic boundary conditions. Let the electrostatic potential field be $\\phi(x,y)$, and define the generalized vorticity $q(x,y)$ by\n$$\nq(x,y) = \\nabla^2 \\phi(x,y) - \\phi(x,y).\n$$\nThe nonlinear dynamics are governed by the Poisson bracket\n$$\n\\{\\phi,q\\}(x,y) = \\partial_x \\phi(x,y) \\, \\partial_y q(x,y) - \\partial_y \\phi(x,y) \\, \\partial_x q(x,y).\n$$\nOne quadratic invariant of the nonlinearity is the generalized enstrophy\n$$\n\\mathcal{Z} = \\frac{1}{2} \\int_{0}^{L} \\int_{0}^{L} q(x,y)^2 \\, dx \\, dy,\n$$\nwhich is redistributed among scales by the nonlinearity in the absence of linear forcing or dissipation. In Fourier space with wavevector $\\mathbf{k} = (k_x, k_y)$, denote the transforms by $\\hat{\\phi}(\\mathbf{k})$, $\\hat{q}(\\mathbf{k})$, and $\\widehat{\\{\\phi,q\\}}(\\mathbf{k})$.\n\nDefine a set of $M$ disjoint isotropic shells in wavenumber magnitude, indexed by $m = 1,2,\\dots,M$, with shell $m$ containing all wavevectors whose magnitude $k = \\sqrt{k_x^2 + k_y^2}$ lies in $[k_m, k_{m+1})$. Introduce the spectral projector (filter) onto shell $m$,\n$$\n\\mathcal{P}_m[\\hat{f}](\\mathbf{k}) = \n\\begin{cases}\n\\hat{f}(\\mathbf{k}), & k \\in [k_m, k_{m+1}), \\\\\n0, & \\text{otherwise},\n\\end{cases}\n$$\nfor any field Fourier transform $\\hat{f}$. You will use these projectors to decompose the nonlinearity into contributions associated with interactions seeded by specific shells.\n\nStarting from the definitions above and the conservation properties of the nonlinearity, derive an expression for the rate of change of generalized enstrophy in shell $K$ due exclusively to advective interactions where the electrostatic potential leg belongs to shell $P$. Define the shell-to-shell transfer $T_{K \\leftarrow P}$ such that the sum over $K$ of $T_{K \\leftarrow P}$ vanishes for each fixed $P$ in the absence of external forcing and dissipation:\n$$\n\\sum_{K=1}^{M} T_{K \\leftarrow P} = 0.\n$$\nExpress $T_{K \\leftarrow P}$ in terms of filtered fields and Fourier-space quantities using the projectors $\\mathcal{P}_K$ and $\\mathcal{P}_P$ and the Poisson bracket. Your expression must be suitable for numerical evaluation via a pseudospectral method on a uniform grid.\n\nImplement the algorithm to compute $T_{K \\leftarrow P}$ from a single statistically steady snapshot of the field constructed synthetically as follows:\n- Work on a square domain of side length $L = 2\\pi$ discretized with $N \\times N$ points (uniform grid), using the conventional Discrete Fourier Transform basis with wavenumbers $k_x, k_y \\in \\{-\\lfloor N/2 \\rfloor, \\dots, \\lfloor N/2 \\rfloor-1 \\}$ scaled by $2\\pi/L$, which for $L=2\\pi$ reduces to integer wavenumbers.\n- Generate a real-valued random field $\\phi_0(x,y)$ with mean zero and unit variance. Compute its Fourier transform $\\hat{\\phi}_0(\\mathbf{k})$.\n- Shape the spectrum to mimic saturation by defining an amplitude shaping function $A(k)$ with parameters $k_0$, $k_c$, and exponent $\\alpha$:\n$$\nA(k) = \\left(\\frac{k + \\epsilon}{k_0}\\right)^{-\\alpha} \\exp\\left(-\\left(\\frac{k}{k_c}\\right)^2\\right) \\exp\\left( -\\frac{(k - k_0)^2}{2\\sigma^2} \\right),\n$$\nwhere $\\epsilon$ is a small positive number to avoid singularity at $k=0$, and $\\sigma$ controls injection bandwidth. Optionally include anisotropy via a factor\n$$\nW(\\mathbf{k}) = 1 + \\beta \\left( \\frac{|k_y|}{k + \\epsilon} \\right)^2,\n$$\nwith anisotropy parameter $\\beta \\ge 0$. Set $\\hat{\\phi}(\\mathbf{k}) = A(k) W(\\mathbf{k}) \\hat{\\phi}_0(\\mathbf{k})$ and enforce $\\hat{\\phi}(\\mathbf{0}) = 0$.\n- Define $\\hat{q}(\\mathbf{k}) = -\\left( k^2 + 1 \\right) \\hat{\\phi}(\\mathbf{k})$ so that $q(x,y)$ is obtained by inverse transform.\n- Compute $\\partial_x$ and $\\partial_y$ derivatives via spectral multiplication: $\\partial_x$ corresponds to multiplication by $\\mathrm{i} k_x$ in Fourier space and $\\partial_y$ by $\\mathrm{i} k_y$.\n\nConstruct the numerical filter for shells using the projectors $\\mathcal{P}_m$ and compute the matrix of transfers $T_{K \\leftarrow P}$ for all shell pairs $(K,P)$. Define nonlocal interactions as shell pairs with index separation at least $\\tau$ shells, i.e., $|K - P| \\ge \\tau$. Quantify the dominance of nonlocal interactions by the fraction\n$$\nR = \\frac{\\sum_{K,P: |K-P| \\ge \\tau} \\left| T_{K \\leftarrow P} \\right|}{\\sum_{K,P} \\left| T_{K \\leftarrow P} \\right|}.\n$$\nIdentify the single dominant nonlocal interaction as the pair $(K^\\star, P^\\star)$ that maximizes $\\left| T_{K \\leftarrow P} \\right|$ under the constraint $|K - P| \\ge \\tau$. If no nonlocal pairs exist or if the denominator in $R$ vanishes, report $K^\\star = 0$, $P^\\star = 0$, and $R = 0$.\n\nTest Suite:\nUse the following three parameter sets, where all numbers are dimensionless and should be treated as pure numbers (no physical units). In all cases, the grid size is $N = 64$, domain side length is $L = 2\\pi$, and the random number generator seed should be fixed per case to ensure reproducibility.\n\n- Case A (happy path, moderate locality, moderate anisotropy):\n  - Shell edges: $[1,4,7,10,13,16,19,22,25]$ (this yields $M=8$ shells).\n  - Spectral shaping: $k_0 = 4$, $k_c = 20$, $\\alpha = 3$, $\\sigma = 1$, $\\beta = 1$.\n  - Nonlocal threshold: $\\tau = 3$.\n\n- Case B (boundary: narrow shells with stronger locality):\n  - Shell edges: $[1,3,5,7,9,11,13,15,17,19,21,23,25]$ (this yields $M=12$ shells).\n  - Spectral shaping: $k_0 = 5$, $k_c = 22$, $\\alpha = 4$, $\\sigma = 1$, $\\beta = 0$.\n  - Nonlocal threshold: $\\tau = 5$.\n\n- Case C (edge: anisotropy-dominated, shallower spectrum):\n  - Shell edges: $[1,5,9,13,17,21,25]$ (this yields $M=6$ shells).\n  - Spectral shaping: $k_0 = 3$, $k_c = 18$, $\\alpha = 2$, $\\sigma = 1$, $\\beta = 2$.\n  - Nonlocal threshold: $\\tau = 3$.\n\nOutput Specification:\nFor each case, compute $(K^\\star, P^\\star, R, \\delta)$ where $K^\\star$ and $P^\\star$ are $1$-based shell indices for the dominant nonlocal interaction, $R$ is the dominance fraction as defined above, and $\\delta$ is an indicator equal to $1$ if $R \\ge 0.5$ and $0$ otherwise. Your program should produce a single line of output containing the results for all three cases as a single flat list of numbers in the order\n$$\n[K^\\star_{\\text{A}}, P^\\star_{\\text{A}}, R_{\\text{A}}, \\delta_{\\text{A}}, K^\\star_{\\text{B}}, P^\\star_{\\text{B}}, R_{\\text{B}}, \\delta_{\\text{B}}, K^\\star_{\\text{C}}, P^\\star_{\\text{C}}, R_{\\text{C}}, \\delta_{\\text{C}}],\n$$\nwith floating-point values printed in standard decimal notation. No other text should be printed.",
            "solution": "### Derivation of the Shell-to-Shell Transfer $T_{K \\leftarrow P}$\n\nWe begin with the Hasegawa-Mima equation in the absence of external forcing and dissipation, which governs the evolution of the generalized vorticity $q$:\n$$\n\\frac{\\partial q}{\\partial t} = -\\{\\phi, q\\}\n$$\nwhere $\\phi$ is the electrostatic potential and $\\{\\cdot,\\cdot\\}$ is the Poisson bracket. This equation describes the advection of generalized vorticity $q$ by the $\\mathbf{E} \\times \\mathbf{B}$ drift velocity, $\\mathbf{v}_E = \\hat{\\mathbf{z}} \\times \\nabla \\phi$. The advection term can be written as $-\\mathbf{v}_E \\cdot \\nabla q$.\n\nThe quantity of interest is the generalized enstrophy, $\\mathcal{Z} = \\frac{1}{2} \\int q^2 \\, d\\mathbf{x}$. The rate of change of the enstrophy density, $\\frac{1}{2}q^2$, is:\n$$\n\\frac{\\partial}{\\partial t} \\left(\\frac{1}{2}q^2\\right) = q \\frac{\\partial q}{\\partial t} = -q\\{\\phi, q\\}\n$$\nThe problem requires us to find the rate of change of enstrophy in a specific wavenumber shell $K$ due to interactions where the advecting potential field, $\\phi$, belongs to another shell $P$. We decompose the potential field $\\phi$ into contributions from disjoint wavenumber shells using the projection operator $\\mathcal{P}_m$:\n$$\n\\phi = \\sum_{P=1}^{M} \\phi_P, \\quad \\text{where} \\quad \\hat{\\phi}_P(\\mathbf{k}) = \\mathcal{P}_P[\\hat{\\phi}](\\mathbf{k})\n$$\nSubstituting this decomposition into the evolution equation gives:\n$$\n\\frac{\\partial q}{\\partial t} = -\\left\\{\\sum_{P=1}^{M} \\phi_P, q\\right\\} = -\\sum_{P=1}^{M} \\{\\phi_P, q\\}\n$$\nEach term $\\{\\phi_P, q\\}$ represents the advection of the total vorticity field $q$ by the component of the velocity field associated with shell $P$.\n\nThe rate of change of enstrophy in shell $K$ is found by projecting the time derivative of $q$ onto shell $K$ and then integrating against $q_K$, the component of $q$ in shell $K$. Let $\\hat{q}_K(\\mathbf{k}) = \\mathcal{P}_K[\\hat{q}](\\mathbf{k})$. The rate of change of enstrophy in shell $K$, $\\mathcal{Z}_K = \\frac{1}{2}\\int q_K^2 d\\mathbf{x}$, is:\n$$\n\\frac{d\\mathcal{Z}_K}{dt} = \\int q_K \\frac{\\partial q_K}{\\partial t} d\\mathbf{x} = \\int q_K \\mathcal{P}_K\\left[\\frac{\\partial q}{\\partial t}\\right] d\\mathbf{x}\n$$\nUsing the self-adjoint property of the real-space representation of the projector, this becomes:\n$$\n\\frac{d\\mathcal{Z}_K}{dt} = \\int \\mathcal{P}_K[q_K] \\frac{\\partial q}{\\partial t} d\\mathbf{x} = \\int q_K \\frac{\\partial q}{\\partial t} d\\mathbf{x}\n$$\nSubstituting the decomposed evolution equation:\n$$\n\\frac{d\\mathcal{Z}_K}{dt} = -\\int q_K \\left(\\sum_{P=1}^{M} \\{\\phi_P, q\\}\\right) d\\mathbf{x} = \\sum_{P=1}^{M} \\left( -\\int q_K \\{\\phi_P, q\\} \\, d\\mathbf{x} \\right)\n$$\nThe term in the parenthesis is the rate of enstrophy transfer into shell $K$ from interactions involving the potential in shell $P$. We thus define the shell-to-shell transfer, $T_{K \\leftarrow P}$, as:\n$$\nT_{K \\leftarrow P} = -\\int q_K(x,y) \\{\\phi_P(x,y), q(x,y)\\} \\, dx \\, dy\n$$\nTo verify the conservation property $\\sum_{K=1}^{M} T_{K \\leftarrow P} = 0$, we sum over $K$:\n$$\n\\sum_{K=1}^{M} T_{K \\leftarrow P} = -\\sum_{K=1}^{M} \\int q_K \\{\\phi_P, q\\} \\, d\\mathbf{x} = -\\int \\left(\\sum_{K=1}^{M} q_K\\right) \\{\\phi_P, q\\} \\, d\\mathbf{x} = -\\int q \\{\\phi_P, q\\} \\, d\\mathbf{x}\n$$\nThe term $\\{\\phi_P, q\\}$ is equivalent to $\\mathbf{v}_P \\cdot \\nabla q$, where $\\mathbf{v}_P = \\hat{\\mathbf{z}} \\times \\nabla \\phi_P$. The integral becomes:\n$$\n-\\int q (\\mathbf{v}_P \\cdot \\nabla q) \\, d\\mathbf{x} = -\\int \\mathbf{v}_P \\cdot \\nabla \\left(\\frac{q^2}{2}\\right) d\\mathbf{x}\n$$\nUsing integration by parts (or the divergence theorem) on the periodic domain, this is equivalent to:\n$$\n\\int \\left(\\frac{q^2}{2}\\right) (\\nabla \\cdot \\mathbf{v}_P) \\, d\\mathbf{x}\n$$\nThe velocity field $\\mathbf{v}_P = (-\\partial_y \\phi_P, \\partial_x \\phi_P)$ is divergence-free: $\\nabla \\cdot \\mathbf{v}_P = -\\partial_x \\partial_y \\phi_P + \\partial_y \\partial_x \\phi_P = 0$. Therefore, the integral is zero, confirming that $\\sum_K T_{K \\leftarrow P} = 0$.\n\n### Numerical Implementation (Pseudospectral Method)\n\nFor numerical computation, we transform the expression for $T_{K \\leftarrow P}$ to Fourier space. Using Parseval's theorem, the integral of a product of two real functions $f$ and $g$ is proportional to the sum of the product of their Fourier coefficients, $\\sum_{\\mathbf{k}} \\hat{f}^*(\\mathbf{k}) \\hat{g}(\\mathbf{k})$. Since we are calculating a ratio $R$, any constant normalization factors will cancel.\n$$\nT_{K \\leftarrow P} = -\\text{Re}\\left[ \\sum_{\\mathbf{k}} \\hat{q}_K^*(\\mathbf{k}) \\, \\widehat{\\{\\phi_P, q\\}}(\\mathbf{k}) \\right]\n$$\nwhere `*` denotes the complex conjugate. Since $\\hat{q}_K$ is non-zero only for $\\mathbf{k}$ in shell $K$, the sum can be restricted to that shell:\n$$\nT_{K \\leftarrow P} = -\\text{Re}\\left[ \\sum_{\\mathbf{k} \\in \\text{shell } K} \\hat{q}^*(\\mathbf{k}) \\, \\widehat{\\{\\phi_P, q\\}}(\\mathbf{k}) \\right]\n$$\nThe Poisson bracket term $\\widehat{\\{\\phi_P, q\\}}$ is computed using a pseudospectral method to avoid the expensive convolution sum in Fourier space:\n1.  Obtain $\\hat{\\phi}_P(\\mathbf{k})$ by filtering the total potential spectrum $\\hat{\\phi}(\\mathbf{k})$ with the projector $\\mathcal{P}_P$.\n2.  Compute the Fourier transforms of the spatial derivatives of $\\phi_P$ and $q$ via spectral multiplication:\n    $$\n    \\widehat{\\partial_x f}(\\mathbf{k}) = i k_x \\hat{f}(\\mathbf{k}), \\quad \\widehat{\\partial_y f}(\\mathbf{k}) = i k_y \\hat{f}(\\mathbf{k})\n    $$\n3.  Perform inverse Fast Fourier Transforms (iFFT) on $\\widehat{\\partial_x \\phi_P}$, $\\widehat{\\partial_y \\phi_P}$, $\\widehat{\\partial_x q}$, and $\\widehat{\\partial_y q}$ to obtain the derivatives in real space.\n4.  Compute the Poisson bracket product in real space: $\\{\\phi_P, q\\} = (\\partial_x \\phi_P)(\\partial_y q) - (\\partial_y \\phi_P)(\\partial_x q)$.\n5.  Perform a forward Fast Fourier Transform (FFT) on the resulting real-space field to obtain $\\widehat{\\{\\phi_P, q\\}}(\\mathbf{k})$.\n\nThis algorithm allows for the efficient computation of the transfer matrix $T_{K \\leftarrow P}$. The remaining steps involve summing elements of this matrix according to the definitions of the nonlocal fraction $R$ and the dominant nonlocal interaction $(K^\\star, P^\\star)$.\n\nThe overall procedure for each test case is as follows:\n1.  **Grid Setup:** Define the computational grid and corresponding wavenumber grids $(k_x, k_y)$ consistent with `numpy.fft` conventions.\n2.  **Field Generation:** Synthetically generate the spectral field $\\hat{\\phi}(\\mathbf{k})$ by creating a random real-space field, transforming to Fourier space, and applying the specified spectral shaping functions $A(k)$ and $W(\\mathbf{k})$.\n3.  **Vorticity Field:** Compute the generalized vorticity spectrum $\\hat{q}(\\mathbf{k}) = -(k^2+1)\\hat{\\phi}(\\mathbf{k})$.\n4.  **Shell Filtering:** Define boolean masks for each wavenumber shell based on the provided shell edges.\n5.  **Transfer Calculation:**\n    a. Iterate through each source potential shell $P=1, \\dots, M$.\n    b. Filter $\\hat{\\phi}$ to get $\\hat{\\phi}_P$.\n    c. Compute $\\widehat{\\{\\phi_P, q\\}}$ using the pseudospectral method described above.\n    d. Iterate through each sink enstrophy shell $K=1, \\dots, M$.\n    e. Compute $T_{K \\leftarrow P}$ by summing the product $\\hat{q}^* \\widehat{\\{\\phi_P, q\\}}$ over the wavenumbers in shell $K$. Store the result.\n6.  **Analysis:** Using the computed $T_{K \\leftarrow P}$ matrix, calculate the total absolute transfer, the nonlocal absolute transfer, the ratio $R$, the indicator $\\delta$, and find the dominant nonlocal pair $(K^\\star, P^\\star)$.\n7.  **Output:** Collate the results $(K^\\star, P^\\star, R, \\delta)$ for all test cases into a single flat list for printing.",
            "answer": "```python\nimport numpy as np\n\ndef compute_for_case(N, L, shell_edges, k0, kc, alpha, sigma, beta, tau, seed):\n    \"\"\"\n    Computes shell-to-shell transfers and nonlocal interaction metrics for a given parameter set.\n    \"\"\"\n    M = len(shell_edges) - 1\n    epsilon = 1e-9\n\n    # 1. Grid and Wavenumber Setup\n    # For L=2*pi, wavenumbers are integers. numpy.fft.fftfreq(N) * N provides them.\n    kx_vec = np.fft.fftfreq(N) * N\n    ky_vec = np.fft.fftfreq(N) * N\n    KX, KY = np.meshgrid(kx_vec, ky_vec, indexing='ij')\n    K_mag = np.sqrt(KX**2 + KY**2)\n\n    # 2. Synthetic Field Generation\n    rng = np.random.default_rng(seed)\n    phi0 = rng.standard_normal((N, N))\n    phi0 = (phi0 - phi0.mean()) / phi0.std() # Mean zero, unit variance\n    phi0_hat = np.fft.fft2(phi0)\n\n    # Spectral shaping functions\n    Ak = (\n        ((K_mag + epsilon) / k0)**(-alpha) *\n        np.exp(-(K_mag/kc)**2) *\n        np.exp(-((K_mag - k0)**2) / (2 * sigma**2))\n    )\n    Wk = 1 + beta * (np.abs(KY) / (K_mag + epsilon))**2\n    \n    phi_hat = Ak * Wk * phi0_hat\n    phi_hat[0, 0] = 0.0 # Enforce zero mean\n\n    # 3. Generalized Vorticity in Fourier Space\n    q_hat = -(K_mag**2 + 1) * phi_hat\n\n    # 4. Shell Masks\n    shell_masks = []\n    for m in range(M):\n        k_start = shell_edges[m]\n        k_end = shell_edges[m+1]\n        mask = (K_mag >= k_start)  (K_mag  k_end)\n        shell_masks.append(mask)\n\n    # 5. Compute Transfer Matrix T_{K - P}\n    T_matrix = np.zeros((M, M))\n    \n    # Pre-compute derivatives of q\n    d_dx_q_hat = 1j * KX * q_hat\n    d_dy_q_hat = 1j * KY * q_hat\n    d_dx_q = np.fft.ifft2(d_dx_q_hat).real\n    d_dy_q = np.fft.ifft2(d_dy_q_hat).real\n\n    for p_idx in range(M):  # Loop over source potential shell P\n        phi_hat_P = phi_hat * shell_masks[p_idx]\n\n        # Pseudospectral computation of {phi_P, q}\n        d_dx_phi_hat_P = 1j * KX * phi_hat_P\n        d_dy_phi_hat_P = 1j * KY * phi_hat_P\n        \n        d_dx_phi_P = np.fft.ifft2(d_dx_phi_hat_P).real\n        d_dy_phi_P = np.fft.ifft2(d_dy_phi_hat_P).real\n        \n        poisson_bracket_real = d_dx_phi_P * d_dy_q - d_dy_phi_P * d_dx_q\n        poisson_hat = np.fft.fft2(poisson_bracket_real)\n\n        # Inner product with q_K^*\n        integrand = np.conj(q_hat) * poisson_hat\n        \n        for k_idx in range(M):  # Loop over sink enstrophy shell K\n            transfer = -np.real(np.sum(integrand[shell_masks[k_idx]]))\n            T_matrix[k_idx, p_idx] = transfer\n\n    # 6. Post-processing and Analysis\n    total_abs_transfer = np.sum(np.abs(T_matrix))\n    \n    if total_abs_transfer  epsilon:\n        return 0, 0, 0.0, 0\n\n    nonlocal_abs_transfer = 0.0\n    max_nonlocal_T_abs = -1.0\n    K_star, P_star = 0, 0\n    \n    has_nonlocal_pairs = False\n    for k_idx in range(M):\n        for p_idx in range(M):\n            # Shell indices are 1-based\n            K, P = k_idx + 1, p_idx + 1\n            if abs(K - P) >= tau:\n                has_nonlocal_pairs = True\n                abs_T_kp = np.abs(T_matrix[k_idx, p_idx])\n                nonlocal_abs_transfer += abs_T_kp\n                if abs_T_kp > max_nonlocal_T_abs:\n                    max_nonlocal_T_abs = abs_T_kp\n                    K_star, P_star = K, P\n\n    if not has_nonlocal_pairs:\n        return 0, 0, 0.0, 0\n\n    R = nonlocal_abs_transfer / total_abs_transfer\n    delta = 1 if R >= 0.5 else 0\n\n    return K_star, P_star, R, delta\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Common parameters\n    N = 64\n    L = 2 * np.pi\n\n    # Test case definitions\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"shell_edges\": [1, 4, 7, 10, 13, 16, 19, 22, 25],\n            \"k0\": 4.0, \"kc\": 20.0, \"alpha\": 3.0, \"sigma\": 1.0, \"beta\": 1.0,\n            \"tau\": 3, \"seed\": 0\n        },\n        {\n            \"name\": \"B\",\n            \"shell_edges\": [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25],\n            \"k0\": 5.0, \"kc\": 22.0, \"alpha\": 4.0, \"sigma\": 1.0, \"beta\": 0.0,\n            \"tau\": 5, \"seed\": 1\n        },\n        {\n            \"name\": \"C\",\n            \"shell_edges\": [1, 5, 9, 13, 17, 21, 25],\n            \"k0\": 3.0, \"kc\": 18.0, \"alpha\": 2.0, \"sigma\": 1.0, \"beta\": 2.0,\n            \"tau\": 3, \"seed\": 2\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        K_star, P_star, R, delta = compute_for_case(\n            N, L, params[\"shell_edges\"], params[\"k0\"], params[\"kc\"],\n            params[\"alpha\"], params[\"sigma\"], params[\"beta\"], params[\"tau\"],\n            params[\"seed\"]\n        )\n        all_results.extend([K_star, P_star, R, delta])\n    \n    # Format and print the single-line output\n    output_str = \",\".join(map(str, all_results))\n    print(f\"[{output_str}]\")\n\n# Placeholder for actual execution. The problem asks for the code block.\n# solve()\n# Expected output for the given seeds:\n# [2,5,0.22019385614949514,0,3,8,0.252084795325016,0,1,4,0.5054176479011707,1]\n```"
        }
    ]
}