{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of the gyrokinetic model is the gyroaverage operation, which elegantly separates the fast cyclotron motion of particles from their slower guiding-center drift dynamics. By averaging the effect of plasma fluctuations over a particle's Larmor orbit, we can determine how strongly that particle couples to a wave of a given spatial scale. This practice provides a first-principles derivation of the gyroaveraging factor and uses it to explore one of the most important consequences in a multi-species plasma: the natural decoupling of electrons from ion-scale turbulence .",
            "id": "4016812",
            "problem": "In an electrostatic, collisionless, homogeneous magnetized plasma described by the multi-species gyrokinetic model, the coupling of species to perpendicular fluctuations of wavevector magnitude $k_{\\perp}$ is controlled by the gyroaveraging of a plane wave over the cyclotron orbit of radius $\\rho_{s}$ for species $s$. Starting from first principles, the gyroaverage is the gyrophase average of $\\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho})$ over a circular orbit at fixed $\\rho_{s}$ and gyrophase angle $\\theta$, where $\\boldsymbol{\\rho}$ is the Larmor displacement vector. Use the fundamental definitions $\\rho_{s} = v_{\\mathrm{th},s}/\\Omega_{s}$, $v_{\\mathrm{th},s} = \\sqrt{2 T_{s}/m_{s}}$, and $\\Omega_{s} = Z_{s} e B/m_{s}$ for species $s$ with charge number $Z_{s}$, charge magnitude $e$, magnetic field magnitude $B$, mass $m_{s}$, and temperature $T_{s}$.\n\n1) Derive the analytic form of the gyroaveraging factor as a function of $k_{\\perp}\\rho_{s}$ by evaluating the gyrophase average $\\langle \\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho}) \\rangle_{\\theta}$ from its definition.\n\n2) For a singly charged ion species with $Z_{i}=1$, compute the values of the gyroaveraging factor for the ion for representative ion-scale arguments $k_{\\perp} \\rho_{i} = 0.1$, $0.5$, and $1.0$. Round each value to four significant figures.\n\n3) For electrons with $Z_{e}=-1$, under the assumptions $T_{e}=T_{i}$ and a protonic ion species with $m_{i}=m_{p}$, express the ratio $\\rho_{e}/\\rho_{i}$ in terms of $m_{e}$ and $m_{i}$. Using this, determine the value of $k_{\\perp}\\rho_{i}$ at which $k_{\\perp}\\rho_{e} = 1$. Then compute the electron gyroaveraging factor at $k_{\\perp}\\rho_{e} = 1$ and $k_{\\perp}\\rho_{e} = 2$, each rounded to four significant figures.\n\n4) Using only the results of parts 1)–3) and fundamental properties of special functions, explain briefly why and how electrons decouple from electrostatic fluctuations at scales $k_{\\perp}\\rho_{e} \\gtrsim 1$ in the gyrokinetic model. As your final quantitative statement, provide the leading-order asymptotic expression for the gyroaveraging factor at large argument $x \\equiv k_{\\perp}\\rho_{s} \\to \\infty$ in terms of $x$. Your final answer must be this closed-form analytic expression, with no units.",
            "solution": "The problem statement is evaluated to be scientifically sound, well-posed, and objective. It presents a standard, self-contained problem in computational fusion science that is based on fundamental principles of gyrokinetics. The provided definitions and conditions are consistent and sufficient for deriving a unique and meaningful solution. Therefore, the problem is valid, and a full solution is presented below.\n\n1) The gyroaveraging factor is defined as the gyrophase average of the plane wave phase factor $\\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho})$ over all possible orientations of the Larmor displacement vector $\\boldsymbol{\\rho}$ for a fixed Larmor radius $\\rho_{s}$. The average is taken over the gyrophase angle $\\theta$. The gyroaverage is denoted as $\\langle \\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho}) \\rangle_{\\theta}$.\n\nLet us establish a coordinate system where the uniform magnetic field $\\boldsymbol{B}$ is directed along the $\\hat{z}$-axis. The wavevector $\\boldsymbol{k}_{\\perp}$ and the Larmor displacement vector $\\boldsymbol{\\rho}$ lie in the plane perpendicular to $\\boldsymbol{B}$, which is the $xy$-plane. Without loss of generality, we can align the coordinate system such that $\\boldsymbol{k}_{\\perp}$ points along the $\\hat{x}$-axis, so $\\boldsymbol{k}_{\\perp} = k_{\\perp} \\hat{x}$, where $k_{\\perp} = |\\boldsymbol{k}_{\\perp}|$.\n\nThe Larmor displacement vector $\\boldsymbol{\\rho}$ traces a circular path in the $xy$-plane. Its position can be described as a function of the gyrophase angle $\\theta$ and the Larmor radius $\\rho_{s}$:\n$$ \\boldsymbol{\\rho} = \\rho_{s} (\\cos\\theta \\, \\hat{x} + \\sin\\theta \\, \\hat{y}) $$\nThe dot product $\\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho}$ is then:\n$$ \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho} = (k_{\\perp} \\hat{x}) \\cdot (\\rho_{s} \\cos\\theta \\, \\hat{x} + \\rho_{s} \\sin\\theta \\, \\hat{y}) = k_{\\perp} \\rho_{s} \\cos\\theta $$\nThe gyroaverage is the integral over all gyrophase angles $\\theta$ from $0$ to $2\\pi$, normalized by the total angle $2\\pi$:\n$$ \\langle \\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho}) \\rangle_{\\theta} = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\exp(i k_{\\perp} \\rho_{s} \\cos\\theta) \\, d\\theta $$\nThis integral is a standard integral representation of the zeroth-order Bessel function of the first kind, $J_{0}(x)$. The general integral representation is:\n$$ J_{n}(x) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\exp(i(x \\sin\\theta - n\\theta)) \\, d\\theta $$\nA more convenient representation for our purpose is derived from the Jacobi-Anger expansion:\n$$ \\exp(iz\\cos\\theta) = \\sum_{n=-\\infty}^{\\infty} i^{n} J_{n}(z) \\exp(in\\theta) $$\nIntegrating both sides over $\\theta$ from $0$ to $2\\pi$ and dividing by $2\\pi$:\n$$ \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\exp(iz\\cos\\theta) \\, d\\theta = \\frac{1}{2\\pi} \\sum_{n=-\\infty}^{\\infty} i^{n} J_{n}(z) \\int_{0}^{2\\pi} \\exp(in\\theta) \\, d\\theta $$\nThe integral on the right-hand side is $2\\pi$ if $n=0$ and $0$ otherwise. Thus, only the $n=0$ term of the sum survives:\n$$ \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\exp(iz\\cos\\theta) \\, d\\theta = \\frac{1}{2\\pi} (i^{0} J_{0}(z) \\cdot 2\\pi) = J_{0}(z) $$\nBy setting $z = k_{\\perp}\\rho_{s}$, we find that the analytic form of the gyroaveraging factor is:\n$$ \\langle \\exp(i \\boldsymbol{k}_{\\perp} \\cdot \\boldsymbol{\\rho}) \\rangle_{\\theta} = J_{0}(k_{\\perp}\\rho_{s}) $$\n\n2) We are asked to compute the values of the ion gyroaveraging factor, $J_{0}(k_{\\perp}\\rho_{i})$, for $k_{\\perp}\\rho_{i} = 0.1$, $0.5$, and $1.0$. The series expansion for $J_{0}(x)$ is $J_{0}(x) = \\sum_{k=0}^{\\infty} \\frac{(-1)^{k}}{(k!)^{2}} \\left(\\frac{x}{2}\\right)^{2k} = 1 - \\frac{x^{2}}{4} + \\frac{x^{4}}{64} - O(x^{6})$. Using this or standard numerical libraries, we compute the values and round to four significant figures.\n\nFor $k_{\\perp}\\rho_{i} = 0.1$:\n$$ J_{0}(0.1) \\approx 0.99750156 \\dots \\approx 0.9975 $$\nFor $k_{\\perp}\\rho_{i} = 0.5$:\n$$ J_{0}(0.5) \\approx 0.93846980 \\dots \\approx 0.9385 $$\nFor $k_{\\perp}\\rho_{i} = 1.0$:\n$$ J_{0}(1.0) \\approx 0.76519768 \\dots \\approx 0.7652 $$\n\n3) We are given an electron-ion plasma with $Z_{i}=1$, $Z_{e}=-1$, $T_{e}=T_{i}$, and $m_{i}=m_{p}$. We first find the ratio $\\rho_{e}/\\rho_{i}$. The Larmor radius for a species $s$ is defined using its thermal velocity $v_{\\mathrm{th},s} = \\sqrt{2 T_{s}/m_{s}}$ and cyclotron frequency $\\Omega_{s} = Z_{s} e B/m_{s}$. Since radius must be a positive quantity, we use the magnitude of the cyclotron frequency:\n$$ \\rho_{s} = \\frac{v_{\\mathrm{th},s}}{|\\Omega_{s}|} = \\frac{\\sqrt{2 T_{s}/m_{s}}}{|Z_{s}| e B/m_{s}} = \\frac{m_{s}}{|Z_{s}| e B} \\sqrt{\\frac{2 T_{s}}{m_{s}}} = \\frac{\\sqrt{2 m_{s} T_{s}}}{|Z_{s}| e B} $$\nThe ratio of the electron Larmor radius to the ion Larmor radius is:\n$$ \\frac{\\rho_{e}}{\\rho_{i}} = \\frac{\\sqrt{2 m_{e} T_{e}}/(|Z_{e}| e B)}{\\sqrt{2 m_{i} T_{i}}/(|Z_{i}| e B)} = \\frac{\\sqrt{m_{e}T_{e}}}{\\sqrt{m_{i}T_{i}}} \\frac{|Z_{i}|}{|Z_{e}|} $$\nUsing the given conditions $T_{e}=T_{i}$, $|Z_{i}|=1$, and $|Z_{e}|=|-1|=1$, the expression simplifies to:\n$$ \\frac{\\rho_{e}}{\\rho_{i}} = \\sqrt{\\frac{m_{e}}{m_{i}}} $$\nNext, we find the value of $k_{\\perp}\\rho_{i}$ at which $k_{\\perp}\\rho_{e} = 1$. From this condition, we have $k_{\\perp} = 1/\\rho_{e}$. Substituting this into the expression for the ion argument:\n$$ k_{\\perp}\\rho_{i} = \\left(\\frac{1}{\\rho_{e}}\\right)\\rho_{i} = \\frac{\\rho_{i}}{\\rho_{e}} = \\sqrt{\\frac{m_{i}}{m_{e}}} $$\nFor a protonic ion, $m_{i}=m_{p}$. The proton-to-electron mass ratio is $m_{p}/m_{e} \\approx 1836.15$. The value is $k_{\\perp}\\rho_{i} \\approx \\sqrt{1836.15} \\approx 42.85$. This represents the ion-scale wavenumber corresponding to the electron-scale condition $k_{\\perp}\\rho_{e} = 1$.\n\nFinally, we compute the electron gyroaveraging factor $J_{0}(k_{\\perp}\\rho_{e})$ for $k_{\\perp}\\rho_{e} = 1$ and $k_{\\perp}\\rho_{e} = 2$.\nFor $k_{\\perp}\\rho_{e} = 1.0$:\n$$ J_{0}(1.0) \\approx 0.76519768 \\dots \\approx 0.7652 $$\nFor $k_{\\perp}\\rho_{e} = 2.0$:\n$$ J_{0}(2.0) \\approx 0.22389077 \\dots \\approx 0.2239 $$\n\n4) The gyroaveraging factor $J_{0}(k_{\\perp}\\rho_{s})$ quantifies how strongly a particle of species $s$ couples to an electrostatic potential fluctuation with perpendicular wavevector $k_{\\perp}$. The function $J_{0}(x)$ has its maximum value of $1$ at $x=0$ and decays in an oscillatory manner as $x$ increases. A value of $J_{0}(k_{\\perp}\\rho_{s})$ close to $1$ means strong coupling, while a value close to $0$ implies weak coupling, or decoupling.\n\nThe condition $k_{\\perp}\\rho_{e} \\gtrsim 1$ corresponds to fluctuations whose perpendicular wavelength $\\lambda_{\\perp} = 2\\pi/k_{\\perp}$ is comparable to or smaller than the electron Larmor radius $\\rho_{e}$. As shown in part 3, the value of $J_{0}(k_{\\perp}\\rho_{e})$ drops from $1$ (for $k_{\\perp}\\rho_e \\ll 1$) to $0.7652$ at $k_{\\perp}\\rho_{e}=1$ and further to $0.2239$ at $k_{\\perp}\\rho_{e}=2$. For even larger arguments, the function continues to decrease in amplitude. Physically, when the fluctuation wavelength is much smaller than the gyroradius, the particle's circular orbit traverses many positive and negative phases of the wave potential. The net effect of the potential, when averaged over the orbit, becomes very small. This is the mechanism of gyrokinetic decoupling. Electrons, due to their small mass and consequently small Larmor radius (for a given temperature), decouple from fluctuations at much smaller spatial scales (larger $k_{\\perp}$) than ions.\n\nThe leading-order asymptotic expression for the zeroth-order Bessel function $J_{0}(x)$ for large argument $x \\to \\infty$ is given by:\n$$ J_{0}(x) \\sim \\sqrt{\\frac{2}{\\pi x}} \\cos\\left(x - \\frac{\\pi}{4}\\right) $$\nThis expression shows that the amplitude of the gyroaveraging factor decays as $x^{-1/2} = (k_{\\perp}\\rho_{s})^{-1/2}$, confirming that the coupling to fluctuations becomes vanishingly small at large $k_{\\perp}\\rho_s$. This completes the explanation for the decoupling. The final quantitative statement required is this asymptotic expression.",
            "answer": "$$ \\boxed{\\sqrt{\\frac{2}{\\pi x}} \\cos\\left(x - \\frac{\\pi}{4}\\right)} $$"
        },
        {
            "introduction": "Beyond the primary ion and electron species, fusion plasmas invariably contain impurities, which can significantly influence transport and stability even at low concentrations. This exercise demonstrates the practical application of multi-species gyrokinetic models to assess the impact of a high-$Z$ impurity on a critical microinstability, the Trapped Electron Mode (TEM). By calculating the change in effective collisionality, you will quantify how impurities can alter the drive for turbulence, providing a tangible example of the model's predictive capability in realistic scenarios .",
            "id": "4016868",
            "problem": "Consider a low-collisionality tokamak plasma described by the linear electrostatic gyrokinetic (GK) equation for electrons in the presence of multiple ion species. Focus on the trapped electron response relevant to the Trapped Electron Mode (TEM). Assume a singly charged main ion species with charge number $Z_{i} = 1$ and a trace, fully stripped high-$Z$ impurity species with charge number $Z_{Z}$ and fractional concentration $f_{Z} \\equiv n_{Z}/n_{e} \\ll 1$, where $n_{e}$ is the electron density and $n_{Z}$ is the impurity density. Use quasi-neutrality with $Z_{i}=1$ to relate species densities. Work in the local, bounce-averaged limit and model pitch-angle scattering collisions on trapped electrons by a Krook operator with effective rate $\\nu_{e}^{\\mathrm{eff}}$. Neglect electron-electron collisions and any finite Larmor radius corrections, and adopt the ordering $|\\langle \\omega_{D e} \\rangle| \\ll |\\omega|$, where $\\langle \\omega_{D e} \\rangle$ is the bounce-averaged electron magnetic drift frequency and $\\omega$ is the complex mode frequency.\n\nStarting from the linearized, bounce-averaged GK equation for trapped electrons with the above collision model and ordering, derive the scaling of the non-adiabatic trapped electron density response amplitude with the complex denominator $[\\omega + i \\nu_{e}^{\\mathrm{eff}}]$. Using the well-tested scaling that the electron-ion pitch-angle scattering frequency is proportional to the weighted density sum $\\sum_{a} n_{a} Z_{a}^{2}$ over ion species $a$, show how a high-$Z$ impurity modifies $\\nu_{e}^{\\mathrm{eff}}$ relative to the baseline main-ion-only value $\\nu_{0}$. Then, for the following parameters:\n- $Z_{Z} = 74$,\n- $f_{Z} = 1.0 \\times 10^{-4}$,\n- $\\omega = \\omega_{r} + i \\gamma$ with $\\omega_{r} = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$ and $\\gamma = 5.0 \\times 10^{4}\\ \\mathrm{s}^{-1}$,\n- baseline electron-ion collision rate (main ions only) $\\nu_{0} = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$,\n\ncompute the multiplicative reduction factor\n$$F \\equiv \\frac{\\left| \\omega + i \\nu_{0} \\right|}{\\left| \\omega + i \\nu_{e}^{\\mathrm{eff}} \\right|}$$\nfor the trapped electron non-adiabatic density response amplitude due to the impurity. Interpret $F<1$ as stabilization of the trapped-electron drive and $F>1$ as destabilization. Express your final answer as a unitless number and round to four significant figures.",
            "solution": "The problem is first subject to validation.\n\n### Step 1: Extract Givens\n- **System**: Low-collisionality tokamak plasma.\n- **Model**: Linear electrostatic gyrokinetic (GK) equation for electrons in the bounce-averaged limit, relevant to the Trapped Electron Mode (TEM).\n- **Species**:\n    - Electrons with density $n_{e}$.\n    - Singly charged main ions with charge number $Z_{i} = 1$ and density $n_{i}$.\n    - Trace, fully stripped high-$Z$ impurity with charge number $Z_{Z}$ and density $n_{Z}$.\n- **Definitions and Conditions**:\n    - Impurity fractional concentration: $f_{Z} \\equiv n_{Z}/n_{e} \\ll 1$.\n    - Quasi-neutrality: The total positive charge density equals the electron density.\n    - Collision model: Pitch-angle scattering on trapped electrons is modeled by a Krook operator with an effective rate $\\nu_{e}^{\\mathrm{eff}}$.\n    - Neglected effects: Electron-electron collisions, finite Larmor radius corrections.\n    - Ordering: $|\\langle \\omega_{D e} \\rangle| \\ll |\\omega|$, where $\\langle \\omega_{D e} \\rangle$ is the bounce-averaged electron magnetic drift frequency and $\\omega$ is the complex mode frequency.\n- **Scaling Law**: The electron-ion pitch-angle scattering frequency is proportional to the weighted density sum $\\sum_{a} n_{a} Z_{a}^{2}$ over all ion species $a$.\n- **Parameters**:\n    - $Z_{Z} = 74$.\n    - $f_{Z} = 1.0 \\times 10^{-4}$.\n    - $\\omega = \\omega_{r} + i \\gamma$ with $\\omega_{r} = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$ and $\\gamma = 5.0 \\times 10^{4}\\ \\mathrm{s}^{-1}$.\n    - Baseline electron-ion collision rate (main ions only): $\\nu_{0} = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$.\n- **Objective**: Compute the multiplicative reduction factor $F \\equiv \\frac{\\left| \\omega + i \\nu_{0} \\right|}{\\left| \\omega + i \\nu_{e}^{\\mathrm{eff}} \\right|}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the established theory of tokamak micro-instabilities, specifically the gyrokinetic description of Trapped Electron Modes. The assumptions, such as the Krook collision operator, bounce-averaging for trapped particles, and the ordering $|\\langle \\omega_{D e} \\rangle| \\ll |\\omega|$, are standard simplifications in this field. The scaling of collision frequency with $\\sum n_{a} Z_{a}^{2}$ is a fundamental result from plasma transport theory. The use of quasi-neutrality to relate species densities is a core principle of plasma physics. All parameters are physically realistic for a modern tokamak. The problem is well-posed, with a clear objective and sufficient information to derive a unique solution. The language is objective and unambiguous.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be provided.\n\n### Solution Derivation\n\nThe analysis begins with the linearized, bounce-averaged gyrokinetic equation for the non-adiabatic part of the trapped electron distribution function, denoted $\\delta g_{e}$. In its general form, this equation balances the effects of mode frequency, magnetic drifts, and collisions against the wave-particle resonance driving term.\n$$(\\omega - \\langle \\omega_{De} \\rangle + i C_{e}) \\delta g_{e} = (\\omega - \\omega_{*e}^{T}) \\frac{e \\langle \\phi \\rangle}{T_e} F_{M,e}$$\nHere, $\\omega$ is the complex mode frequency, $\\langle \\omega_{De} \\rangle$ is the bounce-averaged magnetic drift frequency, $C_{e}$ is the collision operator, $\\omega_{*e}^{T}$ is the total electron diamagnetic frequency (including density and temperature gradients), $\\langle \\phi \\rangle$ is the bounce-averaged electrostatic potential fluctuation, $e$ is the elementary charge, $T_e$ is the electron temperature, and $F_{M,e}$ is the background Maxwellian distribution.\n\nThe problem specifies a Krook model for pitch-angle scattering, so we replace the operator $C_{e}$ with an effective collision frequency, $\\nu_{e}^{\\mathrm{eff}}$. Furthermore, we are given the ordering $|\\langle \\omega_{De} \\rangle| \\ll |\\omega|$, which allows us to neglect the drift frequency term in the denominator. The equation for $\\delta g_{e}$ simplifies to:\n$$(\\omega + i \\nu_{e}^{\\mathrm{eff}}) \\delta g_{e} \\approx (\\omega - \\omega_{*e}^{T}) \\frac{e \\langle \\phi \\rangle}{T_e} F_{M,e}$$\nSolving for $\\delta g_{e}$:\n$$\\delta g_{e} \\approx \\frac{(\\omega - \\omega_{*e}^{T})}{\\omega + i \\nu_{e}^{\\mathrm{eff}}} \\frac{e \\langle \\phi \\rangle}{T_e} F_{M,e}$$\nThe non-adiabatic part of the trapped electron density perturbation, $\\delta n_{e, \\mathrm{trap}}^{\\mathrm{na}}$, is obtained by integrating $\\delta g_{e}$ over the trapped region of velocity space. This integration yields:\n$$\\delta n_{e, \\mathrm{trap}}^{\\mathrm{na}} = \\int_{\\mathrm{trap}} \\delta g_{e} \\, d^{3}v \\propto \\frac{1}{\\omega + i \\nu_{e}^{\\mathrm{eff}}}$$\nThe amplitude of this response is therefore proportional to the magnitude of this complex fraction:\n$$|\\delta n_{e, \\mathrm{trap}}^{\\mathrm{na}}| \\propto \\frac{1}{|\\omega + i \\nu_{e}^{\\mathrm{eff}}|}$$\nThis confirms that the amplitude of the non-adiabatic trapped electron density response scales inversely with the complex denominator $|\\omega + i \\nu_{e}^{\\mathrm{eff}}|$.\n\nNext, we determine the effective collision frequency $\\nu_{e}^{\\mathrm{eff}}$ in the presence of impurities. We are given that the electron-ion collision frequency is proportional to $\\sum_{a} n_{a} Z_{a}^{2}$, where the sum is over all ion species $a$. Let the proportionality constant be $C$.\n$$\\nu_{e}^{\\mathrm{eff}} = C \\sum_{a} n_{a} Z_{a}^{2}$$\nIn our case, the ion species are the main ions ($a=i$) and the impurity ions ($a=Z$).\n$$\\nu_{e}^{\\mathrm{eff}} = C (n_{i} Z_{i}^{2} + n_{Z} Z_{Z}^{2})$$\nThe baseline collision rate, $\\nu_{0}$, corresponds to a pure plasma with only the main ion species. In this case, $n_{Z}=0$ and quasi-neutrality implies $n_{i} = n_{e}$. With $Z_i=1$, we have:\n$$\\nu_{0} = C (n_{e} \\cdot 1^{2}) = C n_{e}$$\nThis allows us to determine the constant $C = \\nu_{0}/n_{e}$.\n\nNow, we consider the plasma with impurities. The quasi-neutrality condition is $n_{e} = Z_{i} n_{i} + Z_{Z} n_{Z}$. Given $Z_{i}=1$, this becomes $n_{e} = n_{i} + Z_{Z} n_{Z}$, which gives the main ion density as $n_{i} = n_{e} - Z_{Z} n_{Z}$.\nSubstituting this into the expression for $\\nu_{e}^{\\mathrm{eff}}$:\n$$\\nu_{e}^{\\mathrm{eff}} = C ((n_{e} - Z_{Z} n_{Z}) Z_{i}^{2} + n_{Z} Z_{Z}^{2})$$\nUsing $Z_i=1$ and the definition $f_{Z} = n_{Z}/n_{e}$ (so $n_{Z} = f_{Z} n_{e}$):\n$$\\nu_{e}^{\\mathrm{eff}} = C ((n_{e} - Z_{Z} f_{Z} n_{e}) \\cdot 1^{2} + f_{Z} n_{e} Z_{Z}^{2}) = C n_{e} (1 - Z_{Z} f_{Z} + f_{Z} Z_{Z}^{2})$$\nSubstituting $C = \\nu_{0}/n_{e}$:\n$$\\nu_{e}^{\\mathrm{eff}} = \\frac{\\nu_{0}}{n_{e}} n_{e} (1 - Z_{Z} f_{Z} + f_{Z} Z_{Z}^{2}) = \\nu_{0} (1 - Z_{Z} f_{Z} + f_{Z} Z_{Z}^{2})$$\nThis expression relates the effective collision rate in the impure plasma to the baseline rate. The term in parentheses is the effective charge, $Z_{\\mathrm{eff}} = \\sum_a n_a Z_a^2 / n_e$.\n\nFinally, we compute the multiplicative reduction factor $F$ using the given parameters. First, we calculate the numerical value of $\\nu_{e}^{\\mathrm{eff}}$:\n- $Z_{Z} = 74$\n- $f_{Z} = 1.0 \\times 10^{-4}$\n- $\\nu_{0} = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$\n\n$$\\nu_{e}^{\\mathrm{eff}} = (1.0 \\times 10^{5}) \\left(1 - (74)(1.0 \\times 10^{-4}) + (1.0 \\times 10^{-4})(74)^{2}\\right)$$\n$$\\nu_{e}^{\\mathrm{eff}} = (1.0 \\times 10^{5}) (1 - 0.0074 + 0.5476) = (1.0 \\times 10^{5}) (1.5402) = 1.5402 \\times 10^{5}\\ \\mathrm{s}^{-1}$$\nThe presence of the high-$Z$ impurity increases the effective collision frequency significantly.\n\nNow we compute the factor $F$:\n$$F = \\frac{\\left| \\omega + i \\nu_{0} \\right|}{\\left| \\omega + i \\nu_{e}^{\\mathrm{eff}} \\right|}$$\nGiven $\\omega = \\omega_{r} + i \\gamma = (1.0 \\times 10^{5}) + i (5.0 \\times 10^{4})\\ \\mathrm{s}^{-1}$:\nThe numerator term is:\n$$\\omega + i \\nu_{0} = (1.0 \\times 10^{5} + i \\cdot 5.0 \\times 10^{4}) + i (1.0 \\times 10^{5}) = 1.0 \\times 10^{5} + i (1.5 \\times 10^{5})$$\nThe magnitude is:\n$$|\\omega + i \\nu_{0}| = \\sqrt{(1.0 \\times 10^{5})^{2} + (1.5 \\times 10^{5})^{2}} = (1.0 \\times 10^{5}) \\sqrt{1.0^{2} + 1.5^{2}} = (1.0 \\times 10^{5}) \\sqrt{1.0 + 2.25} = (1.0 \\times 10^{5}) \\sqrt{3.25}$$\nThe denominator term is:\n$$\\omega + i \\nu_{e}^{\\mathrm{eff}} = (1.0 \\times 10^{5} + i \\cdot 5.0 \\times 10^{4}) + i (1.5402 \\times 10^{5}) = 1.0 \\times 10^{5} + i (2.0402 \\times 10^{5})$$\nThe magnitude is:\n$$|\\omega + i \\nu_{e}^{\\mathrm{eff}}| = \\sqrt{(1.0 \\times 10^{5})^{2} + (2.0402 \\times 10^{5})^{2}} = (1.0 \\times 10^{5}) \\sqrt{1.0^{2} + 2.0402^{2}}$$\n$$|\\omega + i \\nu_{e}^{\\mathrm{eff}}| = (1.0 \\times 10^{5}) \\sqrt{1.0 + 4.16241604} = (1.0 \\times 10^{5}) \\sqrt{5.16241604}$$\nThe factor $F$ is the ratio of these magnitudes:\n$$F = \\frac{(1.0 \\times 10^{5}) \\sqrt{3.25}}{(1.0 \\times 10^{5}) \\sqrt{5.16241604}} = \\sqrt{\\frac{3.25}{5.16241604}} \\approx \\sqrt{0.629550} \\approx 0.793442$$\nRounding to four significant figures, we get $F \\approx 0.7934$. Since $F < 1$, the amplitude of the non-adiabatic response is reduced, indicating a stabilizing effect of the impurity on the Trapped Electron Mode. This is due to the enhanced collisional damping of the trapped electrons.",
            "answer": "$$\\boxed{0.7934}$$"
        },
        {
            "introduction": "Solving the gyrokinetic equations for any species requires a precise mathematical description of the magnetic 'landscape' in which the particles move. For realistic simulations in complex geometries like a tokamak, this involves calculating the metric coefficients that define distances, areas, and volumes in the chosen coordinate system. This computational practice will guide you through the process of deriving and implementing the geometric coefficients for a Miller equilibrium, providing a foundational skill for setting up and understanding modern gyrokinetic codes .",
            "id": "4016846",
            "problem": "You are asked to implement a complete, runnable program that evaluates selected geometric coefficients entering the gyrokinetic equations for a tokamak plasma described by the Miller equilibrium. These coefficients are used identically for all species in multi-species gyrokinetic models. You must derive the required expressions from fundamental geometric definitions and then compute the values for a provided test suite. All quantities must be treated in a mathematically precise way.\n\nThe Miller equilibrium specifies the flux surface shape in cylindrical coordinates with major radius and vertical position given by\n$$\nR(r,\\theta) = R_0 + \\Delta(r) + r \\cos\\!\\big(\\theta + \\delta \\sin\\theta\\big), \\quad Z(r,\\theta) = \\kappa \\, r \\sin\\theta,\n$$\nwhere $R_0$ is the major radius of the magnetic axis, $r$ is the minor radius (a flux surface label), $\\theta$ is the geometric poloidal angle, $\\kappa$ is the elongation, $\\delta$ is the triangularity, and $\\Delta(r)$ is the Shafranov shift. In this problem, model the Shafranov shift as a linear function $\\Delta(r) = \\Delta' \\, r$, where $\\Delta'$ is a constant parameter with units of $1$ (dimensionless slope, multiplying $r$ to produce meters).\n\nThe spatial coordinates are $(r,\\theta,\\phi)$, where $\\phi$ is the toroidal angle. The position vector in Cartesian coordinates is\n$$\n\\boldsymbol{x}(r,\\theta,\\phi) = \\big(R(r,\\theta)\\cos\\phi, \\; R(r,\\theta)\\sin\\phi, \\; Z(r,\\theta)\\big).\n$$\nFrom the fundamental definitions of differential geometry in curvilinear coordinates, the covariant basis vectors are\n$$\n\\boldsymbol{e}_r = \\frac{\\partial \\boldsymbol{x}}{\\partial r}, \\quad \\boldsymbol{e}_\\theta = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta}, \\quad \\boldsymbol{e}_\\phi = \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi},\n$$\nand the covariant metric components are $g_{ij} = \\boldsymbol{e}_i \\cdot \\boldsymbol{e}_j$, for $i,j \\in \\{r,\\theta,\\phi\\}$. The contravariant metric components are defined by $g^{ij} = \\nabla u^i \\cdot \\nabla u^j$, where $(u^1,u^2,u^3) \\equiv (r,\\theta,\\phi)$ and $\\nabla u^i$ are the dual basis satisfying $\\nabla u^i \\cdot \\boldsymbol{e}_j = \\delta^i{}_j$.\n\nIntroduce the straight-field-line coordinate $y \\equiv \\alpha = \\phi - q \\, \\theta$, where $q$ is the safety factor treated as a constant on the flux tube. Use the coordinate set $(x,y,\\theta)$ with $x \\equiv r$ and $y \\equiv \\alpha$. Your tasks are:\n\n- Using the above definitions, derive expressions for the contravariant metric components $g^{xx}$ and $g^{xy}$, defined as\n$$\ng^{xx} = \\nabla x \\cdot \\nabla x, \\quad g^{xy} = \\nabla x \\cdot \\nabla y,\n$$\nwhere $x=r$ and $y=\\alpha$. Express $g^{xx}$ and $g^{xy}$ in terms of the covariant metric components $g_{rr}$, $g_{r\\theta}$, $g_{\\theta\\theta}$, and $g_{\\phi\\phi}$.\n\n- Using the definition of the unit magnetic field direction $\\hat{\\boldsymbol{b}}$ aligned with field lines and the property that a field line in straight-field-line coordinates locally follows the tangent $\\boldsymbol{t} = \\boldsymbol{e}_\\theta + q \\, \\boldsymbol{e}_\\phi$, derive and compute\n$$\n\\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta.\n$$\n\nAll calculations must start from the fundamental definitions provided above. Do not use any shortcut formulas that are not derived from these definitions.\n\nImplement a program that, for each test case in the suite below, computes the following three quantities:\n- $g^{xx}$, in units of $\\mathrm{m}^{-2}$,\n- $g^{xy}$, in units of $\\mathrm{m}^{-2}$,\n- $\\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta$, in units of $\\mathrm{m}^{-1}$.\n\nUse angles in radians. Take all lengths in meters. Treat $q$ and $\\Delta'$ as dimensionless constants in the sense defined above (with $\\Delta(r) = \\Delta' \\, r$ producing meters).\n\nTest Suite parameter sets $(R_0, r, \\kappa, \\delta, \\Delta', q, \\theta)$:\n1. $(3.0, 0.3, 1.8, 0.33, 0.25, 1.7, \\pi/3)$,\n2. $(3.0, 0.3, 1.0, 0.0, 0.0, 2.0, \\pi/2)$,\n3. $(3.0, 0.1, 2.5, 0.2, 0.4, 4.0, \\pi)$,\n4. $(3.0, 0.4, 1.4, 0.4, 0.1, 1.1, 0.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is a list of three floating-point numbers in the order $[g^{xx}, g^{xy}, \\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta]$. For example, the output structure must be\n$$\n\\big[ [g^{xx}_1, g^{xy}_1, \\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta_1], \\; [g^{xx}_2, g^{xy}_2, \\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta_2], \\; \\ldots \\big].\n$$",
            "solution": "The user-provided problem is assessed as **valid** following a rigorous validation process. All premises are scientifically sound, consistent, and well-defined within the domain of computational plasma physics and differential geometry. The problem is well-posed, objective, and contains all necessary information for a unique solution.\n\nThe task is to derive and compute three specific geometric coefficients used in gyrokinetic models for a tokamak plasma described by the Miller equilibrium. The derivation will begin from fundamental principles of differential geometry.\n\n### 1. Preliminaries: Miller Equilibrium and Coordinate System\n\nThe Miller equilibrium defines the shape of magnetic flux surfaces in cylindrical coordinates $(R, \\phi, Z)$. The major radius $R$ and vertical position $Z$ are functions of a flux surface label $r$ (minor radius) and a poloidal angle $\\theta$:\n$$\nR(r,\\theta) = R_0 + \\Delta(r) + r \\cos\\big(\\theta + \\delta \\sin\\theta\\big)\n$$\n$$\nZ(r,\\theta) = \\kappa \\, r \\sin\\theta\n$$\nWith the Shafranov shift modeled as $\\Delta(r) = \\Delta' r$, the expression for $R$ becomes:\n$$\nR(r,\\theta) = R_0 + \\Delta' r + r \\cos\\big(\\theta + \\delta \\sin\\theta\\big)\n$$\nFor convenience, we define $\\Theta(\\theta) = \\theta + \\delta \\sin\\theta$.\n\nThe position vector in Cartesian coordinates $(x_1, x_2, x_3)$ is given by $\\boldsymbol{x}(r,\\theta,\\phi) = (R\\cos\\phi, R\\sin\\phi, Z)$. We will compute the components of the metric tensor in the curvilinear coordinate system $(u^1, u^2, u^3) = (r, \\theta, \\phi)$.\n\n### 2. Derivation of Covariant Metric Tensor Components $g_{ij}$\n\nThe covariant basis vectors $\\boldsymbol{e}_i$ are given by the partial derivatives of the position vector $\\boldsymbol{x}$ with respect to the coordinates $r, \\theta, \\phi$.\n$$\n\\boldsymbol{e}_r = \\frac{\\partial \\boldsymbol{x}}{\\partial r} = \\left(\\frac{\\partial R}{\\partial r}\\cos\\phi, \\frac{\\partial R}{\\partial r}\\sin\\phi, \\frac{\\partial Z}{\\partial r}\\right)\n$$\n$$\n\\boldsymbol{e}_\\theta = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} = \\left(\\frac{\\partial R}{\\partial \\theta}\\cos\\phi, \\frac{\\partial R}{\\partial \\theta}\\sin\\phi, \\frac{\\partial Z}{\\partial \\theta}\\right)\n$$\n$$\n\\boldsymbol{e}_\\phi = \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} = (-R\\sin\\phi, R\\cos\\phi, 0)\n$$\nThe required partial derivatives of $R$ and $Z$ are:\n$$\n\\frac{\\partial R}{\\partial r} = \\Delta' + \\cos(\\Theta)\n$$\n$$\n\\frac{\\partial R}{\\partial \\theta} = -r\\sin(\\Theta) \\frac{\\partial\\Theta}{\\partial\\theta} = -r\\sin(\\Theta)(1 + \\delta \\cos\\theta)\n$$\n$$\n\\frac{\\partial Z}{\\partial r} = \\kappa \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial \\theta} = \\kappa r \\cos\\theta\n$$\nThe covariant metric components $g_{ij} = \\boldsymbol{e}_i \\cdot \\boldsymbol{e}_j$ are then computed:\n$$\ng_{rr} = \\boldsymbol{e}_r \\cdot \\boldsymbol{e}_r = \\left(\\frac{\\partial R}{\\partial r}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial r}\\right)^2 = (\\Delta' + \\cos\\Theta)^2 + (\\kappa \\sin\\theta)^2\n$$\n$$\ng_{\\theta\\theta} = \\boldsymbol{e}_\\theta \\cdot \\boldsymbol{e}_\\theta = \\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2 = \\left(-r\\sin\\Theta(1+\\delta\\cos\\theta)\\right)^2 + (\\kappa r \\cos\\theta)^2\n$$\n$$\ng_{\\phi\\phi} = \\boldsymbol{e}_\\phi \\cdot \\boldsymbol{e}_\\phi = R^2\\sin^2\\phi + R^2\\cos^2\\phi = R^2\n$$\n$$\ng_{r\\theta} = \\boldsymbol{e}_r \\cdot \\boldsymbol{e}_\\theta = \\frac{\\partial R}{\\partial r}\\frac{\\partial R}{\\partial \\theta} + \\frac{\\partial Z}{\\partial r}\\frac{\\partial Z}{\\partial \\theta} = -r(\\Delta' + \\cos\\Theta)\\sin\\Theta(1+\\delta\\cos\\theta) + r\\kappa^2\\sin\\theta\\cos\\theta\n$$\nDue to axisymmetry, the geometry does not depend on $\\phi$, which leads to $\\boldsymbol{e}_r \\cdot \\boldsymbol{e}_{\\phi} = 0$ and $\\boldsymbol{e}_{\\theta} \\cdot \\boldsymbol{e}_{\\phi} = 0$. Thus, $g_{r\\phi} = g_{\\theta\\phi} = 0$. This makes the metric tensor matrix block-diagonal:\n$$\n(g_{ij}) = \\begin{pmatrix} g_{rr} & g_{r\\theta} & 0 \\\\ g_{r\\theta} & g_{\\theta\\theta} & 0 \\\\ 0 & 0 & g_{\\phi\\phi} \\end{pmatrix}\n$$\n\n### 3. Derivation of Contravariant Coefficients $g^{xx}$ and $g^{xy}$\n\nThe problem asks for $g^{xx} = \\nabla x \\cdot \\nabla x$ and $g^{xy} = \\nabla x \\cdot \\nabla y$, where the coordinates are $x \\equiv r$ and $y \\equiv \\alpha = \\phi - q\\theta$. The gradients $\\nabla r, \\nabla \\theta, \\nabla \\phi$ form the contravariant (or dual) basis $\\boldsymbol{e}^r, \\boldsymbol{e}^\\theta, \\boldsymbol{e}^\\phi$. The dot products of these basis vectors define the contravariant metric components $g^{ij} = \\boldsymbol{e}^i \\cdot \\boldsymbol{e}^j = \\nabla u^i \\cdot \\nabla u^j$.\n\nTherefore, we can express the desired quantities as:\n$$\ng^{xx} = \\nabla r \\cdot \\nabla r = g^{rr}\n$$\n$$\ng^{xy} = \\nabla r \\cdot \\nabla y = \\nabla r \\cdot (\\nabla\\phi - q\\nabla\\theta) = (\\nabla r \\cdot \\nabla\\phi) - q(\\nabla r \\cdot \\nabla\\theta) = g^{r\\phi} - q g^{r\\theta}\n$$\nThe contravariant metric tensor $(g^{ij})$ is the inverse of the covariant metric tensor $(g_{ij})$. Given the block-diagonal structure of $(g_{ij})$, we can invert the blocks separately.\n$$\n(g^{ij}) = \\begin{pmatrix} g^{rr} & g^{r\\theta} & 0 \\\\ g^{r\\theta} & g^{\\theta\\theta} & 0 \\\\ 0 & 0 & g^{\\phi\\phi} \\end{pmatrix} = \\begin{pmatrix} \\frac{g_{\\theta\\theta}}{g_{rr}g_{\\theta\\theta}-g_{r\\theta}^2} & \\frac{-g_{r\\theta}}{g_{rr}g_{\\theta\\theta}-g_{r\\theta}^2} & 0 \\\\ \\frac{-g_{r\\theta}}{g_{rr}g_{\\theta\\theta}-g_{r\\theta}^2} & \\frac{g_{rr}}{g_{rr}g_{\\theta\\theta}-g_{r\\theta}^2} & 0 \\\\ 0 & 0 & \\frac{1}{g_{\\phi\\phi}} \\end{pmatrix}\n$$\nFrom this, we identify the necessary components: $g^{rr}$, $g^{r\\theta}$, and $g^{r\\phi}=0$. Let the determinant of the poloidal metric be $\\mathcal{G} = g_{rr}g_{\\theta\\theta} - g_{r\\theta}^2$.\n\nSubstituting these into the expressions for $g^{xx}$ and $g^{xy}$:\n$$\ng^{xx} = g^{rr} = \\frac{g_{\\theta\\theta}}{\\mathcal{G}}\n$$\n$$\ng^{xy} = g^{r\\phi} - q g^{r\\theta} = 0 - q \\left( \\frac{-g_{r\\theta}}{\\mathcal{G}} \\right) = \\frac{q g_{r\\theta}}{\\mathcal{G}}\n$$\n\n### 4. Derivation of $\\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta$\n\nThe unit magnetic field vector $\\hat{\\boldsymbol{b}}$ is aligned with the local magnetic field line. In straight-field-line coordinates, the tangent to a field line is given by the vector $\\boldsymbol{t} = \\boldsymbol{e}_\\theta + q\\boldsymbol{e}_\\phi$. The unit vector is therefore:\n$$\n\\hat{\\boldsymbol{b}} = \\frac{\\boldsymbol{t}}{|\\boldsymbol{t}|} = \\frac{\\boldsymbol{e}_\\theta + q\\boldsymbol{e}_\\phi}{\\sqrt{(\\boldsymbol{e}_\\theta + q\\boldsymbol{e}_\\phi) \\cdot (\\boldsymbol{e}_\\theta + q\\boldsymbol{e}_\\phi)}}\n$$\nThe squared magnitude of $\\boldsymbol{t}$ is:\n$$\n|\\boldsymbol{t}|^2 = \\boldsymbol{e}_\\theta \\cdot \\boldsymbol{e}_\\theta + 2q(\\boldsymbol{e}_\\theta \\cdot \\boldsymbol{e}_\\phi) + q^2(\\boldsymbol{e}_\\phi \\cdot \\boldsymbol{e}_\\phi) = g_{\\theta\\theta} + 2qg_{\\theta\\phi} + q^2g_{\\phi\\phi}\n$$\nSince $g_{\\theta\\phi}=0$, this simplifies to $|\\boldsymbol{t}|^2 = g_{\\theta\\theta} + q^2g_{\\phi\\phi}$.\n\nThe quantity to be computed is $\\hat{\\boldsymbol{b}} \\cdot \\nabla\\theta$. Recalling that $\\nabla\\theta = \\boldsymbol{e}^\\theta$, we have:\n$$\n\\hat{\\boldsymbol{b}} \\cdot \\nabla\\theta = \\frac{\\boldsymbol{e}_\\theta + q\\boldsymbol{e}_\\phi}{\\sqrt{g_{\\theta\\theta} + q^2g_{\\phi\\phi}}} \\cdot \\boldsymbol{e}^\\theta = \\frac{\\boldsymbol{e}_\\theta \\cdot \\boldsymbol{e}^\\theta + q(\\boldsymbol{e}_\\phi \\cdot \\boldsymbol{e}^\\theta)}{\\sqrt{g_{\\theta\\theta} + q^2g_{\\phi\\phi}}}\n$$\nBy the definition of dual bases, $\\boldsymbol{e}_i \\cdot \\boldsymbol{e}^j = \\delta_i^j$. Thus, $\\boldsymbol{e}_\\theta \\cdot \\boldsymbol{e}^\\theta = 1$ and $\\boldsymbol{e}_\\phi \\cdot \\boldsymbol{e}^\\theta = 0$. The numerator simplifies to $1$.\nThe final expression is:\n$$\n\\hat{\\boldsymbol{b}} \\cdot \\nabla\\theta = \\frac{1}{\\sqrt{g_{\\theta\\theta} + q^2g_{\\phi\\phi}}} = \\frac{1}{\\sqrt{g_{\\theta\\theta} + q^2R^2}}\n$$\n\n### 5. Summary of Computational Formulas\n\nThe following expressions are implemented in the program:\n1.  Intermediate angle: $\\Theta = \\theta + \\delta \\sin\\theta$\n2.  Major radius: $R = R_0 + \\Delta' r + r \\cos\\Theta$\n3.  Partial derivatives:\n    -   $\\partial_r R = \\Delta' + \\cos\\Theta$\n    -   $\\partial_\\theta R = -r\\sin\\Theta(1 + \\delta \\cos\\theta)$\n    -   $\\partial_r Z = \\kappa \\sin\\theta$\n    -   $\\partial_\\theta Z = \\kappa r \\cos\\theta$\n4.  Covariant metric components:\n    -   $g_{rr} = (\\partial_r R)^2 + (\\partial_r Z)^2$\n    -   $g_{\\theta\\theta} = (\\partial_\\theta R)^2 + (\\partial_\\theta Z)^2$\n    -   $g_{r\\theta} = (\\partial_r R)(\\partial_\\theta R) + (\\partial_r Z)(\\partial_\\theta Z)$\n    -   $g_{\\phi\\phi} = R^2$\n5.  Poloidal metric determinant: $\\mathcal{G} = g_{rr}g_{\\theta\\theta} - g_{r\\theta}^2$\n6.  Final quantities:\n    -   $g^{xx} = g_{\\theta\\theta} / \\mathcal{G}$\n    -   $g^{xy} = q g_{r\\theta} / \\mathcal{G}$\n    -   $\\hat{\\boldsymbol{b}} \\cdot \\nabla \\theta = 1 / \\sqrt{g_{\\theta\\theta} + q^2 R^2}$\nThese formulas are used to compute the required values for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_geo_coeffs(params):\n    \"\"\"\n    Calculates geometric coefficients for a Miller equilibrium.\n\n    Args:\n        params (tuple): A tuple containing the equilibrium parameters:\n            (R0, r, kappa, delta, Delta_p, q, theta)\n            R0 (float): Major radius of the magnetic axis [m].\n            r (float): Minor radius of the flux surface [m].\n            kappa (float): Elongation.\n            delta (float): Triangularity.\n            Delta_p (float): Shafranov shift slope (Delta' = d(Delta)/dr).\n            q (float): Safety factor.\n            theta (float): Poloidal angle [rad].\n\n    Returns:\n        list: A list containing the three computed coefficients:\n              [g_xx, g_xy, b_dot_grad_theta]\n    \"\"\"\n    R0, r, kappa, delta, Delta_p, q, theta = params\n\n    # 1. Intermediate angle\n    Theta = theta + delta * np.sin(theta)\n    \n    cos_theta = np.cos(theta)\n    sin_theta = np.sin(theta)\n    cos_Theta = np.cos(Theta)\n    sin_Theta = np.sin(Theta)\n\n    # 2. Major radius\n    R = R0 + Delta_p * r + r * cos_Theta\n\n    # 3. Partial derivatives\n    dR_dr = Delta_p + cos_Theta\n    dR_dtheta = -r * sin_Theta * (1 + delta * cos_theta)\n    dZ_dr = kappa * sin_theta\n    dZ_dtheta = kappa * r * cos_theta\n\n    # 4. Covariant metric components\n    g_rr = dR_dr**2 + dZ_dr**2\n    g_thetatheta = dR_dtheta**2 + dZ_dtheta**2\n    g_rtheta = dR_dr * dR_dtheta + dZ_dr * dZ_dtheta\n    g_phiphi = R**2\n    \n    # 5. Poloidal metric determinant\n    poloidal_det_g = g_rr * g_thetatheta - g_rtheta**2\n\n    # 6. Final quantities\n    # g_xx = g^rr = g_thetatheta / (g_rr*g_thetatheta - g_rtheta^2)\n    g_xx = g_thetatheta / poloidal_det_g\n    \n    # g_xy = q * g_rtheta / (g_rr*g_thetatheta - g_rtheta^2)\n    g_xy = q * g_rtheta / poloidal_det_g\n\n    # b_dot_grad_theta = 1 / sqrt(g_thetatheta + q^2 * g_phiphi)\n    b_dot_grad_theta = 1.0 / np.sqrt(g_thetatheta + q**2 * g_phiphi)\n\n    return [g_xx, g_xy, b_dot_grad_theta]\n\ndef solve():\n    \"\"\"\n    Drives the calculation for the test suite and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Parameters are (R0, r, kappa, delta, Delta', q, theta)\n    test_cases = [\n        (3.0, 0.3, 1.8, 0.33, 0.25, 1.7, np.pi/3),\n        (3.0, 0.3, 1.0, 0.0, 0.0, 2.0, np.pi/2),\n        (3.0, 0.1, 2.5, 0.2, 0.4, 4.0, np.pi),\n        (3.0, 0.4, 1.4, 0.4, 0.1, 1.1, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_geo_coeffs(case)\n        results.append(result)\n\n    # The string representation of a Python list includes spaces after commas.\n    # The required format is [[item, item], [item, item]], which is what\n    # str(list_of_lists) produces, but the problem's skeleton code sample\n    # implies a format where the outer lists are joined by only a comma. We\n    # follow the skeleton code's format. E.g., `[[1, 2],[3, 4]]`\n    \n    # The str() of a list like [1.1, 2.2] is '[1.1, 2.2]'.\n    # map(str, results) will create an iterator of these string representations.\n    # ','.join() will join them with a comma.\n    # The outer f-string adds the final brackets.\n    output_string = f\"[{','.join(map(str, results))}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        }
    ]
}