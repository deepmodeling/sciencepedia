{
    "hands_on_practices": [
        {
            "introduction": "A critical first step in designing any fusion experiment is to estimate the energy required to bring the fuel to thermonuclear temperatures. This exercise guides you through a foundational energy balance calculation for the preheat stage of a Magnetized Liner Inertial Fusion (MagLIF) concept . By accounting for the plasma's internal energy and fundamental losses like bremsstrahlung radiation, you will develop a lower-bound estimate for the driver energy, a crucial parameter in assessing the viability of the entire scheme.",
            "id": "3950883",
            "problem": "A cylindrical deuterium–tritium fuel column is preheated in a Magnetized Liner Inertial Fusion (MagLIF) configuration, representative of Magneto-Inertial Fusion (MIF). The fuel is assumed spatially uniform, fully ionized, and optically thin to its own bremsstrahlung. The cylinder has length $L = 5\\,\\mathrm{mm}$, radius $R = 2\\,\\mathrm{mm}$, and total particle number density (electrons plus ions) $n = 1.0\\times 10^{23}\\,\\mathrm{m}^{-3}$. The ion charge is $Z=1$. The preheat driver raises the plasma temperature from $0$ to a final value $T = 5\\,\\mathrm{keV}$ over a pulse duration $\\tau = 100\\,\\mathrm{ns}$, with a linear temperature ramp $T(t) = T\\, t/\\tau$ for $0 \\le t \\le \\tau$. Non-radiative losses such as conduction and end losses are neglected to obtain a lower-bound estimate.\n\nStarting from energy conservation, the minimum driver energy is the sum of the increase in internal thermal energy and the radiative loss to bremsstrahlung over the heating time. Use the equipartition assumption $T_e = T_i = T$, so the internal energy increase is that of both species. For optically thin free–free emission, take the volumetric bremsstrahlung power density in the form $P_{\\mathrm{br}}(t) = C\\, n_e n_i Z^2 \\sqrt{T(t)}$, where $C = 1.69\\times 10^{-38} g_B\\,\\mathrm{W\\,m^3\\,K^{-1/2}}$ with Gaunt factor $g_B = 1.2$, and $n_e = n_i = n/2$ by quasineutrality for $Z=1$. Treat the plasma volume as $V = \\pi R^2 L$, and convert $T$ from $\\mathrm{keV}$ to $\\mathrm{K}$ using $k_B T = (\\text{energy per particle})$ with $1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$ and Boltzmann’s constant $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$.\n\nDerive the expression for the required driver energy and evaluate it numerically for the given parameters. Express the final energy in $\\mathrm{kJ}$ and round your answer to three significant figures.",
            "solution": "The problem asks for the minimum driver energy required to preheat a cylindrical deuterium-tritium fuel column. This energy is the sum of the increase in the plasma's internal thermal energy and the energy lost to bremsstrahlung radiation during the heating process. We begin by stating the governing energy conservation equation:\n$$\nE_{\\mathrm{driver}} = \\Delta E_{\\mathrm{thermal}} + E_{\\mathrm{rad}}\n$$\nwhere $\\Delta E_{\\mathrm{thermal}}$ is the change in the total internal energy of the plasma and $E_{\\mathrm{rad}}$ is the total energy radiated away. We will derive an expression for each term and then sum them to find the total driver energy.\n\nFirst, we calculate the change in internal thermal energy, $\\Delta E_{\\mathrm{thermal}}$. The plasma is composed of electrons and ions, and for an ideal gas, the internal energy is given by $E_{\\mathrm{thermal}} = \\frac{3}{2} N k_B T$, where $N$ is the total number of particles, $k_B$ is the Boltzmann constant, and $T$ is the temperature. The total number of particles is the total number density $n$ multiplied by the plasma volume $V$. The volume of the cylinder is $V = \\pi R^2 L$. Therefore, $N = nV = n\\pi R^2 L$.\n\nThe change in internal energy is the final energy minus the initial energy:\n$$\n\\Delta E_{\\mathrm{thermal}} = E_{\\mathrm{thermal, final}} - E_{\\mathrm{thermal, initial}} = \\frac{3}{2} N k_B T_f - \\frac{3}{2} N k_B T(0)\n$$\nThe problem states the heating starts from a temperature of $0$, so $T(0) = 0$. The final temperature is denoted as $T_f$. Thus, the change in internal energy is simply the final internal energy:\n$$\n\\Delta E_{\\mathrm{thermal}} = \\frac{3}{2} N k_B T_f = \\frac{3}{2} (n \\pi R^2 L) k_B T_f\n$$\nNote that the quantity $k_B T_f$ represents the final thermal energy per particle, which is given as $5\\,\\mathrm{keV}$.\n\nNext, we calculate the total radiated energy, $E_{\\mathrm{rad}}$. This energy is the time integral of the total radiated power, $P_{\\mathrm{rad}}(t)$, over the heating pulse duration $\\tau$.\n$$\nE_{\\mathrm{rad}} = \\int_0^\\tau P_{\\mathrm{rad}}(t)\\,dt\n$$\nThe total power is the volumetric power density, $P_{\\mathrm{br}}(t)$, multiplied by the plasma volume $V$.\n$$\nP_{\\mathrm{rad}}(t) = V \\cdot P_{\\mathrm{br}}(t) = (\\pi R^2 L) P_{\\mathrm{br}}(t)\n$$\nThe volumetric bremsstrahlung power density is given by $P_{\\mathrm{br}}(t) = C n_e n_i Z^2 \\sqrt{T(t)}$. For a quasineutral plasma with singly charged ions ($Z=1$), the electron density $n_e$ and ion density $n_i$ are both equal to half the total particle density $n$, so $n_e = n_i = n/2$. Substituting these into the power density expression gives:\n$$\nP_{\\mathrm{br}}(t) = C \\left(\\frac{n}{2}\\right) \\left(\\frac{n}{2}\\right) (1)^2 \\sqrt{T(t)} = \\frac{1}{4} C n^2 \\sqrt{T(t)}\n$$\nThe temperature increases linearly with time according to $T(t) = T_f \\frac{t}{\\tau}$ for $0 \\le t \\le \\tau$. Substituting this into the expression for $P_{\\mathrm{br}}(t)$ yields:\n$$\nP_{\\mathrm{br}}(t) = \\frac{1}{4} C n^2 \\sqrt{T_f \\frac{t}{\\tau}} = \\frac{C n^2 \\sqrt{T_f}}{4\\sqrt{\\tau}} t^{1/2}\n$$\nNow, we can integrate the total power $P_{\\mathrm{rad}}(t) = V \\cdot P_{\\mathrm{br}}(t)$ from $t=0$ to $t=\\tau$:\n$$\nE_{\\mathrm{rad}} = \\int_0^\\tau (\\pi R^2 L) \\left( \\frac{C n^2 \\sqrt{T_f}}{4\\sqrt{\\tau}} t^{1/2} \\right) dt\n$$\nThe terms independent of $t$ can be moved outside the integral:\n$$\nE_{\\mathrm{rad}} = \\frac{\\pi R^2 L C n^2 \\sqrt{T_f}}{4\\sqrt{\\tau}} \\int_0^\\tau t^{1/2} dt\n$$\nThe integral of $t^{1/2}$ is $\\frac{2}{3} t^{3/2}$. Evaluating this from $0$ to $\\tau$:\n$$\n\\int_0^\\tau t^{1/2} dt = \\left[ \\frac{2}{3} t^{3/2} \\right]_0^\\tau = \\frac{2}{3} \\tau^{3/2}\n$$\nSubstituting this result back into the expression for $E_{\\mathrm{rad}}$:\n$$\nE_{\\mathrm{rad}} = \\frac{\\pi R^2 L C n^2 \\sqrt{T_f}}{4\\sqrt{\\tau}} \\left( \\frac{2}{3} \\tau^{3/2} \\right) = \\frac{2}{12} (\\pi R^2 L) C n^2 \\sqrt{T_f} \\frac{\\tau^{3/2}}{\\tau^{1/2}}\n$$\n$$\nE_{\\mathrm{rad}} = \\frac{1}{6} (\\pi R^2 L) C n^2 \\tau \\sqrt{T_f}\n$$\nThe total required driver energy is the sum of these two components:\n$$\nE_{\\mathrm{driver}} = \\frac{3}{2} n (\\pi R^2 L) k_B T_f + \\frac{1}{6} (\\pi R^2 L) C n^2 \\tau \\sqrt{T_f}\n$$\nThis is the final analytical expression for the driver energy.\n\nWe now evaluate this expression numerically. First, we list the given parameters in SI units:\n- Length: $L = 5\\,\\mathrm{mm} = 5 \\times 10^{-3}\\,\\mathrm{m}$\n- Radius: $R = 2\\,\\mathrm{mm} = 2 \\times 10^{-3}\\,\\mathrm{m}$\n- Total particle density: $n = 1.0 \\times 10^{23}\\,\\mathrm{m}^{-3}$\n- Final temperature (energy per particle): $E_p = 5\\,\\mathrm{keV} = 5 \\times 10^3\\,\\mathrm{eV} \\times (1.602176634\\times 10^{-19}\\,\\mathrm{J/eV}) = 8.01088 \\times 10^{-16}\\,\\mathrm{J}$. This term is equivalent to $k_B T_f$.\n- Pulse duration: $\\tau = 100\\,\\mathrm{ns} = 1.0 \\times 10^{-7}\\,\\mathrm{s}$\n- Bremsstrahlung constant coefficient: $C_{base} = 1.69\\times 10^{-38}\\,\\mathrm{W\\,m^3\\,K^{-1/2}}$\n- Gaunt factor: $g_B = 1.2$\n- Boltzmann constant: $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n\nFirst, we calculate the constants and derived quantities:\n- Plasma volume: $V = \\pi R^2 L = \\pi (2\\times 10^{-3}\\,\\mathrm{m})^2 (5\\times 10^{-3}\\,\\mathrm{m}) = 2\\pi \\times 10^{-8}\\,\\mathrm{m}^3$.\n- Final temperature in Kelvin: $T_f = E_p / k_B = (8.01088 \\times 10^{-16}\\,\\mathrm{J}) / (1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\approx 5.8021 \\times 10^7\\,\\mathrm{K}$.\n- Bremsstrahlung constant with Gaunt factor: $C = C_{base} \\times g_B = (1.69\\times 10^{-38}) \\times 1.2 = 2.028 \\times 10^{-38}\\,\\mathrm{W\\,m^3\\,K^{-1/2}}$.\n\nNow we calculate the two energy terms:\n- Internal energy increase:\n$\\Delta E_{\\mathrm{thermal}} = \\frac{3}{2} n V (k_B T_f) = \\frac{3}{2} (1.0 \\times 10^{23}\\,\\mathrm{m}^{-3}) (2\\pi \\times 10^{-8}\\,\\mathrm{m}^3) (8.01088 \\times 10^{-16}\\,\\mathrm{J}) \\approx 7.5498\\,\\mathrm{J}$.\n\n- Radiated energy:\n$E_{\\mathrm{rad}} = \\frac{1}{6} V C n^2 \\tau \\sqrt{T_f}$\n$E_{\\mathrm{rad}} = \\frac{1}{6} (2\\pi \\times 10^{-8}) (2.028 \\times 10^{-38}) (1.0 \\times 10^{23})^2 (1.0 \\times 10^{-7}) \\sqrt{5.8021 \\times 10^7}$\n$E_{\\mathrm{rad}} \\approx \\frac{\\pi}{3} (10^{-8}) (2.028 \\times 10^{-38}) (10^{46}) (10^{-7}) (7.617 \\times 10^3) \\approx 0.001618\\,\\mathrm{J}$.\n\nThe total driver energy is the sum:\n$E_{\\mathrm{driver}} = \\Delta E_{\\mathrm{thermal}} + E_{\\mathrm{rad}} \\approx 7.5498\\,\\mathrm{J} + 0.001618\\,\\mathrm{J} \\approx 7.5514\\,\\mathrm{J}$.\n\nThe problem requires the answer in kilojoules ($\\mathrm{kJ}$) rounded to three significant figures.\n$E_{\\mathrm{driver}} = 7.5514\\,\\mathrm{J} = 0.0075514\\,\\mathrm{kJ}$.\nRounding to three significant figures, we get $0.00755\\,\\mathrm{kJ}$.",
            "answer": "$$\\boxed{0.00755}$$"
        },
        {
            "introduction": "For a fusion plasma to become self-sustaining, it must effectively trap and utilize the energy from fusion-born alpha particles. This computational practice explores the delicate balance between collisional energy transfer and particle loss due to magnetic field geometry . You will build a model combining alpha particle slowing-down physics with the magnetic mirror effect to estimate the energy deposition fraction, a key performance metric applicable across a range of alternative concepts including Z-pinches and spherical tokamaks.",
            "id": "3950849",
            "problem": "Consider a magnetized deuterium–tritium fuel relevant to alternative fusion concepts including Magnetized Inertial Fusion (MIF), Magnetized Liner Inertial Fusion (MagLIF), Z-pinch, Reversed Field Pinch (RFP), spherical tokamaks, and heavy-ion drivers. A fusion-produced alpha particle is born with kinetic energy and an isotropic pitch-angle distribution at a location of minimum magnetic field along the confining field line. The objective is to estimate the fraction of the alpha energy that is deposited within the fuel and to determine the corresponding contribution to the thermal energy balance, using first-principles models for collisional stopping and magnetic mirroring.\n\nStarting from fundamental bases:\n\n- Coulomb collisions between charged particles transfer energy from a fast ion to background electrons and ions. Alpha slowing-down is governed by energy loss due to Coulomb scattering with electrons in the high-speed limit.\n- The adiabatic magnetic moment invariance and conservation of total energy in a slowly varying magnetic field determine the magnetic mirroring condition for charged particle motion along the field.\n\nAssumptions to be used:\n\n- The alpha particle initial kinetic energy is $E_0$.\n- The alpha charge number is $Z_\\alpha = 2$ and mass is $m_\\alpha$.\n- The electron number density is $n_e$ and electron mass is $m_e$.\n- The Coulomb logarithm is $\\ln\\Lambda$.\n- The electron and ion temperatures are equal and denoted $T$.\n- The ion number density satisfies $n_i = n_e$.\n- The magnetic field has a minimum $B_{\\min}$ and maximum $B_{\\max}$ along the field line, defining the mirror ratio $R_m = B_{\\max}/B_{\\min} \\ge 1$.\n- The pitch-angle $\\theta$ is measured in radians.\n- The characteristic parallel distance to an end loss region is $L_\\parallel$ (in meters).\n- The alpha birth pitch-angle distribution is isotropic at $B_{\\min}$.\n- The deposited energy is added to the thermal energy of the plasma; the thermal energy density is $U_{\\mathrm{th}} = \\frac{3}{2} n_e k_B T + \\frac{3}{2} n_i k_B T$.\n- The alpha source rate per unit volume is $S_\\alpha$ (in $\\mathrm{s^{-1}\\,m^{-3}}$).\n- The thermalization threshold energy is $E_{\\mathrm{th}} = 3 k_B T$.\n\nDefine the following computational tasks:\n\n1. Derive the collisional energy slowing-down time $\\tau_s$ required for an alpha born at energy $E_0$ to slow to $E_{\\mathrm{th}}$ in a background plasma of electrons with density $n_e$ and temperature $T$, using a high-speed Coulomb collision model. Express all quantities in SI units.\n2. Derive the magnetic loss cone half-angle at $B_{\\min}$ from magnetic mirroring invariants and compute the confined fraction of alpha pitch angles $f_{\\mathrm{conf}}$ for an isotropic distribution.\n3. Estimate the average escape time $\\tau_{\\mathrm{esc}}$ for alphas that are in the loss cone, by averaging the parallel transit time to the end loss region over the loss cone distribution. Use $L_\\parallel$ and the initial alpha speed $v_0 = \\sqrt{2 E_0 / m_\\alpha}$ for this estimate.\n4. Compute the alpha energy deposition fraction $f_{\\mathrm{dep}}$ as the sum of:\n   - Complete deposition by the magnetically confined fraction $f_{\\mathrm{conf}}$, and\n   - Partial deposition by the loss-cone fraction $(1 - f_{\\mathrm{conf}})$, approximated by $\\min(1, \\tau_{\\mathrm{esc}} / \\tau_s)$.\n5. Compute the volumetric alpha heating rate $Q_\\alpha = f_{\\mathrm{dep}} E_0 S_\\alpha$ and the heating rate relative to the existing thermal energy density $r = Q_\\alpha / U_{\\mathrm{th}}$ (in $\\mathrm{s^{-1}}$).\n\nUnits and outputs:\n\n- Use SI units throughout. Energies must be in joules, magnetic fields in tesla, lengths in meters, number densities in $\\mathrm{m^{-3}}$, temperatures in joules via $k_B T$, and time in seconds.\n- Angles are in radians.\n- The program must output, for each test case, two values: the energy deposition fraction $f_{\\mathrm{dep}}$ (dimensionless) and the heating rate ratio $r$ (in $\\mathrm{s^{-1}}$).\n- Express each output value as a decimal rounded to $6$ significant figures.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[f_{\\mathrm{dep},1}, r_1, f_{\\mathrm{dep},2}, r_2, f_{\\mathrm{dep},3}, r_3, f_{\\mathrm{dep},4}, r_4]$.\n\nPhysical constants to be used (in SI):\n\n- Elementary charge $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$.\n- Electron mass $m_e = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$.\n- Alpha mass $m_\\alpha = 6.6446573357 \\times 10^{-27}\\,\\mathrm{kg}$.\n- Boltzmann constant $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$.\n- Coulomb constant $k_e = 1/(4\\pi\\epsilon_0) = 8.9875517923 \\times 10^{9}\\,\\mathrm{N\\,m^2\\,C^{-2}}$.\n- Alpha birth energy $E_0 = 3.5\\,\\mathrm{MeV}$.\n\nTest suite:\n\nProvide the following four test cases, each specified by $(n_e, T, R_m, L_\\parallel, \\ln\\Lambda, S_\\alpha)$:\n\n- Case $1$ (Magnetized Liner Inertial Fusion cylinder):\n  - $n_e = 1.0 \\times 10^{26}\\,\\mathrm{m^{-3}}$,\n  - $T = 3.0\\,\\mathrm{keV}$,\n  - $R_m = 10.0$,\n  - $L_\\parallel = 0.01\\,\\mathrm{m}$,\n  - $\\ln\\Lambda = 10.0$,\n  - $S_\\alpha = 1.0 \\times 10^{29}\\,\\mathrm{s^{-1}\\,m^{-3}}$.\n- Case $2$ (spherical tokamak-like parameters):\n  - $n_e = 5.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$,\n  - $T = 10.0\\,\\mathrm{keV}$,\n  - $R_m = 1.5$,\n  - $L_\\parallel = 5.0\\,\\mathrm{m}$,\n  - $\\ln\\Lambda = 17.0$,\n  - $S_\\alpha = 1.0 \\times 10^{22}\\,\\mathrm{s^{-1}\\,m^{-3}}$.\n- Case $3$ (Z-pinch-like dense column):\n  - $n_e = 5.0 \\times 10^{27}\\,\\mathrm{m^{-3}}$,\n  - $T = 1.0\\,\\mathrm{keV}$,\n  - $R_m = 5.0$,\n  - $L_\\parallel = 0.005\\,\\mathrm{m}$,\n  - $\\ln\\Lambda = 8.0$,\n  - $S_\\alpha = 5.0 \\times 10^{30}\\,\\mathrm{s^{-1}\\,m^{-3}}$.\n- Case $4$ (heavy-ion driver magnetized target):\n  - $n_e = 1.0 \\times 10^{25}\\,\\mathrm{m^{-3}}$,\n  - $T = 5.0\\,\\mathrm{keV}$,\n  - $R_m = 2.0$,\n  - $L_\\parallel = 0.02\\,\\mathrm{m}$,\n  - $\\ln\\Lambda = 12.0$,\n  - $S_\\alpha = 1.0 \\times 10^{28}\\,\\mathrm{s^{-1}\\,m^{-3}}$.\n\nYour program must implement the above physics, compute $f_{\\mathrm{dep}}$ and $r$ for each case, and output a single line as specified.",
            "solution": "The problem statement is scientifically grounded, well-posed, and self-contained, presenting a valid classical physics problem in plasma confinement and energetic particle transport. It provides all necessary physical constants, parameters, and a clear set of computational tasks based on established principles of plasma physics. We proceed with a step-by-step derivation of the requested quantities.\n\nThe core of the problem lies in the interplay between two characteristic timescales: the collisional slowing-down time, $\\tau_s$, and the particle loss time, which is determined by magnetic confinement geometry. We analyze the behavior of fusion-born alpha particles by partitioning them into two populations: a magnetically confined fraction and an escaping (loss-cone) fraction.\n\n**1. Collisional Energy Slowing-Down Time, $\\tau_s$**\n\nAn energetic alpha particle traversing a plasma loses energy primarily through Coulomb collisions with the background electrons and ions. The problem specifies the high-speed limit, where the alpha speed $v_\\alpha$ is much greater than the thermal speed of the background electrons. In this regime, the energy loss is dominated by drag from the electrons. The rate of energy loss is given by:\n$$ \\frac{dE}{dt} = -\\frac{n_e Z_\\alpha^2 e^4 \\ln\\Lambda}{4\\pi\\epsilon_0^2 m_e v_\\alpha} $$\nHere, $E = \\frac{1}{2} m_\\alpha v_\\alpha^2$ is the kinetic energy of the alpha particle, $Z_\\alpha = 2$ is its charge number, $m_\\alpha$ its mass, $n_e$ is the electron density, $m_e$ is the electron mass, $e$ is the elementary charge, and $\\ln\\Lambda$ is the Coulomb logarithm. We can express the velocity as $v_\\alpha = \\sqrt{2E/m_\\alpha}$. Substituting this into the energy loss equation and using the Coulomb constant $k_e = 1/(4\\pi\\epsilon_0)$ (which implies $1/\\epsilon_0^2 = 16\\pi^2 k_e^2$), we get:\n$$ \\frac{dE}{dt} = -\\frac{4\\pi k_e^2 n_e Z_\\alpha^2 e^4 \\ln\\Lambda}{m_e} \\sqrt{\\frac{m_\\alpha}{2E}} = -C \\frac{1}{\\sqrt{E}} $$\nwhere the constant $C$ is given by $C = \\frac{4\\pi k_e^2 n_e Z_\\alpha^2 e^4 \\ln\\Lambda \\sqrt{m_\\alpha}}{m_e \\sqrt{2}}$. This is a separable ordinary differential equation for the energy $E(t)$. To find the time $\\tau_s$ it takes for an alpha particle to slow from its birth energy $E_0$ to a thermalization energy $E_{\\mathrm{th}} = 3k_B T$, we integrate:\n$$ \\int_{E_0}^{E_{\\mathrm{th}}} E^{1/2} dE = -\\int_0^{\\tau_s} C dt $$\n$$ \\left[ \\frac{2}{3} E^{3/2} \\right]_{E_0}^{E_{\\mathrm{th}}} = -C \\tau_s $$\n$$ \\frac{2}{3} (E_{\\mathrm{th}}^{3/2} - E_0^{3/2}) = -C \\tau_s $$\nSolving for the slowing-down time $\\tau_s$:\n$$ \\tau_s = \\frac{2(E_0^{3/2} - E_{\\mathrm{th}}^{3/2})}{3C} = \\frac{\\sqrt{2} m_e (E_0^{3/2} - E_{\\mathrm{th}}^{3/2})}{6\\pi k_e^2 n_e Z_\\alpha^2 e^4 \\ln\\Lambda \\sqrt{m_\\alpha}} $$\nThis expression for $\\tau_s$ will be implemented using the provided parameters, all in SI units.\n\n**2. Magnetic Loss Cone and Confined Fraction, $f_{\\mathrm{conf}}$**\n\nIn a magnetic mirror configuration, charged particle motion is governed by the conservation of kinetic energy $E$ and the first adiabatic invariant, the magnetic moment $\\mu = \\frac{m_\\alpha v_\\perp^2}{2B}$, where $v_\\perp$ is the velocity component perpendicular to the magnetic field $\\vec{B}$. Given a pitch angle $\\theta$ such that $v_\\perp = v \\sin\\theta$, conservation of $\\mu$ and $E$ implies:\n$$ \\frac{\\sin^2\\theta}{B} = \\text{constant} $$\nA particle starting at the magnetic field minimum $B_{\\min}$ with pitch angle $\\theta_{\\min}$ will be reflected where its pitch angle becomes $\\pi/2$. Let the field at this reflection point be $B_{\\mathrm{refl}}$. Then, $\\frac{\\sin^2\\theta_{\\min}}{B_{\\min}} = \\frac{\\sin^2(\\pi/2)}{B_{\\mathrm{refl}}} = \\frac{1}{B_{\\mathrm{refl}}}$.\nA particle is confined if it reflects before reaching the maximum field $B_{\\max}$, i.e., if $B_{\\mathrm{refl}} \\le B_{\\max}$. This implies $\\sin^2\\theta_{\\min} \\le \\frac{B_{\\min}}{B_{\\max}} = \\frac{1}{R_m}$, where $R_m$ is the mirror ratio.\nParticles that do not satisfy this condition are in the \"loss cone\" and escape. The loss cone half-angle, $\\theta_L$, is defined by the boundary of this condition: $\\sin\\theta_L = 1/\\sqrt{R_m}$.\nFor an isotropic pitch-angle distribution at birth, the particle distribution is uniform over the solid angle $4\\pi$. The fraction of particles that are confined corresponds to the fraction of the total solid angle outside the two loss cones (one at each end of the velocity sphere). This fraction is given by:\n$$ f_{\\mathrm{conf}} = \\frac{\\int_{\\theta_L}^{\\pi-\\theta_L} 2\\pi \\sin\\theta d\\theta}{\\int_0^\\pi 2\\pi \\sin\\theta d\\theta} = \\frac{[-\\cos\\theta]_{\\theta_L}^{\\pi-\\theta_L}}{2} = \\frac{\\cos\\theta_L - \\cos(\\pi-\\theta_L)}{2} = \\cos\\theta_L $$\nUsing the identity $\\cos\\theta_L = \\sqrt{1-\\sin^2\\theta_L}$, we find the confined fraction to be:\n$$ f_{\\mathrm{conf}} = \\sqrt{1 - \\frac{1}{R_m}} $$\n\n**3. Average Escape Time, $\\tau_{\\mathrm{esc}}$**\n\nFor particles born in the loss cone ($0 \\le \\theta < \\theta_L$), we estimate their escape time. The parallel velocity is $v_\\parallel(\\theta) = v_0 \\cos\\theta$, where $v_0 = \\sqrt{2E_0/m_\\alpha}$ is the initial speed. The transit time to escape over a distance $L_\\parallel$ is $t(\\theta) = L_\\parallel / v_\\parallel(\\theta)$. To find the average escape time, we average $t(\\theta)$ over the loss-cone pitch-angle distribution. The probability distribution for $\\theta$ is $p(\\theta) = \\frac{1}{2}\\sin\\theta$.\nThe average time, considering one loss cone ($0 \\le \\theta < \\theta_L$), is:\n$$ \\tau_{\\mathrm{esc}} = \\frac{\\int_0^{\\theta_L} t(\\theta) p(\\theta) d\\theta}{\\int_0^{\\theta_L} p(\\theta) d\\theta} = \\frac{\\int_0^{\\theta_L} \\frac{L_\\parallel}{v_0 \\cos\\theta} \\frac{1}{2}\\sin\\theta d\\theta}{\\int_0^{\\theta_L} \\frac{1}{2}\\sin\\theta d\\theta} $$\nThe numerator integral is $\\frac{L_\\parallel}{2v_0} \\int_0^{\\theta_L} \\tan\\theta d\\theta = \\frac{L_\\parallel}{2v_0} [-\\ln(\\cos\\theta)]_0^{\\theta_L} = -\\frac{L_\\parallel}{2v_0} \\ln(\\cos\\theta_L)$.\nThe denominator integral is $\\frac{1}{2}[-\\cos\\theta]_0^{\\theta_L} = \\frac{1}{2}(1 - \\cos\\theta_L)$.\nCombining these results gives the average escape time:\n$$ \\tau_{\\mathrm{esc}} = \\frac{-\\frac{L_\\parallel}{2v_0} \\ln(\\cos\\theta_L)}{\\frac{1}{2}(1 - \\cos\\theta_L)} = \\frac{L_\\parallel}{v_0} \\frac{-\\ln(\\cos\\theta_L)}{1 - \\cos\\theta_L} $$\nUsing $\\cos\\theta_L = \\sqrt{1-1/R_m}$, we can calculate $\\tau_{\\mathrm{esc}}$. For $R_m=1$, this expression is undefined, but the provided test cases all have $R_m > 1$.\n\n**4. Total Alpha Energy Deposition Fraction, $f_{\\mathrm{dep}}$**\n\nThe total fraction of deposited alpha energy is the sum of contributions from the confined and escaping populations.\n- The confined fraction, $f_{\\mathrm{conf}}$, is assumed to deposit its entire energy. Its contribution is $f_{\\mathrm{conf}} \\times 1$.\n- The loss-cone fraction, $(1 - f_{\\mathrm{conf}})$, escapes in an average time $\\tau_{\\mathrm{esc}}$. During this time, it deposits a fraction of its energy approximated by the ratio of timescales $\\tau_{\\mathrm{esc}}/\\tau_s$. This fractional deposition is capped at $1$, as a particle cannot deposit more than its total energy. So the contribution is $(1-f_{\\mathrm{conf}}) \\times \\min(1, \\tau_{\\mathrm{esc}}/\\tau_s)$.\nSumming these contributions gives the total deposition fraction:\n$$ f_{\\mathrm{dep}} = f_{\\mathrm{conf}} + (1 - f_{\\mathrm{conf}}) \\min(1, \\frac{\\tau_{\\mathrm{esc}}}{\\tau_s}) $$\n\n**5. Volumetric Heating Rate, $Q_\\alpha$, and Relative Heating Rate, $r$**\n\nThe volumetric alpha heating power density, $Q_\\alpha$, is the product of the alpha source rate per unit volume $S_\\alpha$, the energy per alpha $E_0$, and the fraction of that energy which is deposited, $f_{\\mathrm{dep}}$:\n$$ Q_\\alpha = f_{\\mathrm{dep}} E_0 S_\\alpha $$\nThe thermal energy density of the background plasma, assuming equal electron and ion temperatures ($T_e=T_i=T$) and charge neutrality for a deuterium-tritium plasma ($n_i=n_e$), is:\n$$ U_{\\mathrm{th}} = \\frac{3}{2} n_e k_B T + \\frac{3}{2} n_i k_B T = 3 n_e k_B T $$\nThe heating rate relative to the existing thermal energy density, $r$, is the ratio of the heating power density to the thermal energy density. This quantity has units of $\\mathrm{s^{-1}}$ and represents a characteristic inverse time for plasma heating by alpha particles.\n$$ r = \\frac{Q_\\alpha}{U_{\\mathrm{th}}} = \\frac{f_{\\mathrm{dep}} E_0 S_\\alpha}{3 n_e k_B T} $$\nThese formulae provide the basis for the numerical computation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for alpha particle energy deposition fraction and relative heating rate\n    for several alternative fusion concept scenarios.\n    \"\"\"\n\n    # Physical constants in SI units\n    E_CHARGE = 1.602176634e-19  # Elementary charge in C\n    M_E = 9.1093837015e-31      # Electron mass in kg\n    M_ALPHA = 6.6446573357e-27  # Alpha particle mass in kg\n    K_B = 1.380649e-23          # Boltzmann constant in J/K\n    K_E = 8.9875517923e9        # Coulomb constant in N m^2 C^-2\n    \n    # Problem-specific constants\n    E0_MEV = 3.5                # Alpha birth energy in MeV\n    E0_J = E0_MEV * 1e6 * E_CHARGE  # Alpha birth energy in Joules\n    Z_ALPHA = 2.0                 # Alpha charge number\n\n    def calculate_metrics(n_e, T_keV, R_m, L_parallel, ln_Lambda, S_alpha):\n        \"\"\"\n        Computes f_dep and r for a single test case.\n        \n        Args:\n            n_e (float): Electron number density (m^-3)\n            T_keV (float): Plasma temperature (k_B*T) in keV\n            R_m (float): Mirror ratio (B_max / B_min)\n            L_parallel (float): Parallel distance to end loss region (m)\n            ln_Lambda (float): Coulomb logarithm\n            S_alpha (float): Alpha source rate per unit volume (s^-1 m^-3)\n\n        Returns:\n            tuple: (f_dep, r)\n        \"\"\"\n        \n        # Convert temperature to Joules\n        kBT_J = T_keV * 1e3 * E_CHARGE\n        \n        # --- Task 1: Calculate collisional slowing-down time tau_s ---\n        E_th = 3.0 * kBT_J  # Thermalization energy\n        \n        # Ensure E0 > E_th to avoid math domain errors\n        if E0_J <= E_th:\n             tau_s = 0.0\n        else:\n            # Constant part of the tau_s formula\n            C1 = (np.sqrt(2.0) * M_E) / (6.0 * np.pi * K_E**2 * E_CHARGE**4)\n            # Variable part\n            C2 = (E0_J**1.5 - E_th**1.5) / (n_e * ln_Lambda * Z_ALPHA**2 * np.sqrt(M_ALPHA))\n            tau_s = C1 * C2\n\n        # --- Task 2: Calculate confined fraction f_conf ---\n        if R_m < 1.0:\n            # Physically R_m should be >= 1. If not, handle as no confinement.\n            f_conf = 0.0\n        else:\n            f_conf = np.sqrt(1.0 - 1.0 / R_m)\n\n        # --- Task 3: Calculate average escape time tau_esc ---\n        v0 = np.sqrt(2.0 * E0_J / M_ALPHA)\n        cos_theta_L = f_conf # As derived: f_conf = cos(theta_L)\n        \n        # Handle the case R_m = 1 (cos_theta_L = 0) where log(0) is -inf\n        if np.isclose(cos_theta_L, 0):\n            # Model breaks down, escape time is effectively infinite for some particles\n            # but for the average, it is very large compared to tau_s.\n            # Using a very large number to ensure min(1, tau_esc/tau_s) = 1\n            tau_esc = np.inf\n        else:\n            tau_esc = (L_parallel / v0) * (-np.log(cos_theta_L) / (1.0 - cos_theta_L))\n\n        # --- Task 4: Compute alpha energy deposition fraction f_dep ---\n        if tau_s > 0:\n            deposition_ratio = tau_esc / tau_s\n        else: # If tau_s is effectively zero (instant slowing), deposition is immediate\n             deposition_ratio = np.inf\n\n        partial_deposition = min(1.0, deposition_ratio)\n        f_dep = f_conf + (1.0 - f_conf) * partial_deposition\n        \n        # --- Task 5: Compute volumetric heating rate Q_alpha and relative rate r ---\n        U_th = 3.0 * n_e * kBT_J\n        Q_alpha = f_dep * E0_J * S_alpha\n        \n        if U_th > 0:\n            r = Q_alpha / U_th\n        else:\n            r = np.inf # If thermal energy is zero, any heating is infinite relative rate\n\n        return f_dep, r\n\n    # Test suite from the problem description\n    test_cases = [\n        # Case 1 (MagLIF)\n        (1.0e26, 3.0, 10.0, 0.01, 10.0, 1.0e29),\n        # Case 2 (spherical tokamak)\n        (5.0e19, 10.0, 1.5, 5.0, 17.0, 1.0e22),\n        # Case 3 (Z-pinch)\n        (5.0e27, 1.0, 5.0, 0.005, 8.0, 5.0e30),\n        # Case 4 (heavy-ion driver)\n        (1.0e25, 5.0, 2.0, 0.02, 12.0, 1.0e28),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_dep, r = calculate_metrics(*case)\n        # Format to 6 significant figures\n        results.append(f\"{f_dep:.6g}\")\n        results.append(f\"{r:.6g}\")\n\n    # Print the final output in the specified single-line format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Achieving a hot, dense plasma is only half the battle; maintaining its configuration against powerful instabilities is paramount. This practice delves into the magnetohydrodynamic (MHD) stability of a Reversed Field Pinch (RFP), a concept that relies on a complex magnetic field structure . You will solve the fundamental force-balance equation to determine the plasma's equilibrium and then apply stability criteria to identify regions susceptible to resistive tearing modes, providing direct insight into the operational limits of such devices.",
            "id": "3950831",
            "problem": "You are given a cylindrical, axisymmetric representation of a Reversed Field Pinch (RFP) plasma, which is an alternative fusion concept. Work within single-fluid Magnetohydrodynamics (MHD), with static equilibrium described by the balance of Lorentz force and pressure gradient, and currents given by Ampère's law. Your task is to compute the safety factor profile and identify radial regions susceptible to resistive tearing instabilities, given an edge reversal parameter and a pressure profile.\n\nAssume a cylinder of minor radius $a$ and effective major radius $R_0$ with purely radial dependence of fields. Let the toroidal magnetic field be $B_{\\phi}(r)$ and the poloidal magnetic field be $B_{\\theta}(r)$. The plasma pressure is $p(r)$. Use the following fundamental laws and definitions as your starting point:\n\n- Magnetostatic force balance (from Magnetohydrodynamics (MHD)): $\\nabla p = \\mathbf{j} \\times \\mathbf{B}$.\n- Magnetostatic Ampère's law: $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j}$.\n- Cylindrical symmetry with $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + B_{\\phi}(r)\\,\\hat{\\boldsymbol{\\phi}}$ and $\\partial/\\partial z = \\partial/\\partial \\theta = 0$.\n- Safety factor definition in cylindrical approximation: $q(r) = \\dfrac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}$.\n\nFrom these, derive a computational method to obtain $B_{\\theta}(r)$ consistent with force balance for a given $p(r)$ and $B_{\\phi}(r)$, then compute $q(r)$ and identify resistive tearing susceptibility.\n\nModel specifications to be used:\n1. Toroidal field profile parameterized by an edge reversal parameter $\\eta$:\n   $$B_{\\phi}(r) = B_0 \\left[ 1 + (\\eta - 1) \\left( \\dfrac{r}{a} \\right)^s \\right],$$\n   where $B_0$ is the on-axis toroidal field, $s$ is a shape exponent, and $\\eta = \\dfrac{B_{\\phi}(a)}{B_{\\phi}(0)}$ may be negative for reversed edge field.\n2. Pressure profile:\n   $$p(r) = p_0 \\left[ 1 - \\left( \\dfrac{r}{a} \\right)^{\\beta} \\right],$$\n   with $p_0$ the on-axis pressure and $\\beta$ a positive exponent.\n\nUse the cylindrical radial force balance and Ampère's law to formulate a well-posed ordinary differential equation that determines $B_{\\theta}(r)$ given $p(r)$ and $B_{\\phi}(r)$, respecting regularity at $r=0$.\n\nResistive tearing susceptibility identification:\n- Tearing modes resonate on rational surfaces where $q(r_\\ast) = \\dfrac{m}{n}$ for selected low-order mode numbers. For this problem, restrict to $m=1$ and $n \\in \\{4,5,6,7,8,9,10\\}$.\n- A radial location $r_\\ast$ is flagged as susceptible if all of the following hold:\n  1. $| q(r_\\ast) - \\dfrac{m}{n} | \\le \\varepsilon_q$ with tolerance $\\varepsilon_q = 0.005$.\n  2. The local magnetic shear $s(r) = \\dfrac{r}{q(r)} \\dfrac{dq}{dr}$ satisfies $|s(r_\\ast)| \\le s_{\\max}$ with $s_{\\max} = 0.3$.\n  3. The normalized magnitude of the toroidal current density gradient, defined by $\\Gamma_j(r) = \\dfrac{| d j_{\\phi}(r)/dr |}{\\max_{0<r\\le a} | d j_{\\phi}(r)/dr |}$, satisfies $\\Gamma_j(r_\\ast) \\ge \\Gamma_{\\min}$ with $\\Gamma_{\\min} = 0.4$.\n- Here $j_{\\phi}(r)$ is obtained from Ampère's law under the cylindrical symmetry.\n\nPhysical constants and units:\n- Use vacuum permeability $\\mu_0$ in SI units: $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$.\n- $a$ and $R_0$ are in $\\mathrm{m}$.\n- $B_0$ and fields are in $\\mathrm{T}$.\n- $p_0$ and pressure are in $\\mathrm{Pa}$.\n- The safety factor $q(r)$ is dimensionless. Report radii normalized to $a$ (dimensionless).\n\nNumerical requirements:\n- Discretize $r \\in [0,a]$ on a uniform grid fine enough to identify rational surfaces and compute numerical derivatives reliably.\n- Implement a numerically stable method consistent with the regularity condition at $r=0$ for $B_{\\theta}(r)$.\n- Use consistent one-dimensional finite differences for radial derivatives, and robust clustering of multiple adjacent grid points satisfying the susceptibility criteria into unique radial locations to avoid duplicate detections.\n\nTest suite:\nProvide results for the following three parameter sets, designed to test typical, boundary, and edge-case behaviors:\n\n- Case $1$ (typical reversed-field): $a = 0.5\\,\\mathrm{m}$, $R_0 = 1.5\\,\\mathrm{m}$, $B_0 = 0.5\\,\\mathrm{T}$, $\\eta = -0.2$, $s = 2$, $p_0 = 1.0\\times 10^5\\,\\mathrm{Pa}$, $\\beta = 2$.\n- Case $2$ (no reversal boundary): $a = 0.5\\,\\mathrm{m}$, $R_0 = 1.5\\,\\mathrm{m}$, $B_0 = 0.5\\,\\mathrm{T}$, $\\eta = 0.0$, $s = 2$, $p_0 = 8.0\\times 10^4\\,\\mathrm{Pa}$, $\\beta = 4$.\n- Case $3$ (strong reversal with steeper pressure): $a = 0.5\\,\\mathrm{m}$, $R_0 = 1.5\\,\\mathrm{m}$, $B_0 = 0.5\\,\\mathrm{T}$, $\\eta = -0.5$, $s = 2$, $p_0 = 1.2\\times 10^5\\,\\mathrm{Pa}$, $\\beta = 3$.\n\nFinal output specification:\n- For each test case, produce the list of normalized radii $\\left[ r_\\ast/a \\right]$ where susceptibility is detected, rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list of these three lists, enclosed in square brackets and with no spaces, for example: $\\left[ [0.123,0.456],[0.234],[\\,] \\right]$ becomes the single line string \"[[0.123,0.456],[0.234],[]]\".",
            "solution": "The user has provided a problem in computational plasma physics, specifically concerning the equilibrium and stability of a Reversed Field Pinch (RFP) plasma configuration. The problem is to be analyzed within the framework of single-fluid magnetohydrodynamics (MHD).\n\n### Problem Validation\n\nThe problem statement has been validated against the specified criteria and is found to be **valid**.\n\n1.  **Scientific Grounding**: The problem is based on the standard and well-established equations of magnetostatic equilibrium in MHD ($\\nabla p = \\mathbf{j} \\times \\mathbf{B}$ and $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j}$) applied to a cylindrical plasma, which is a common and valid simplification in fusion plasma theory. The parameterized profiles for pressure and magnetic field are standard ad-hoc models used in the field. The criteria for resistive tearing mode susceptibility (resonance at rational surfaces, low magnetic shear, and large current density gradient) are physically motivated and consistent with tearing mode theory.\n2.  **Well-Posedness**: The problem of finding the magnetic field profile can be formulated as a first-order linear ordinary differential equation (ODE) for the square of the poloidal magnetic field, $B_{\\theta}^2(r)$. With the physically motivated regularity condition that $B_{\\theta}(r) \\to 0$ as $r \\to 0$, the ODE is well-posed and admits a unique solution.\n3.  **Completeness and Consistency**: The problem provides all necessary physical parameters, model definitions, numerical requirements, and stability criteria. There are no contradictions in the provided information.\n\nThe problem is a standard exercise in computational MHD equilibrium and stability analysis. It is scientifically sound, well-posed, and all necessary information is provided. We may now proceed with the solution.\n\n### Derivation of the Governing Equation\n\nWe begin with the fundamental equations for magnetostatic equilibrium in cylindrical coordinates, assuming axisymmetry ($\\partial/\\partial\\theta = 0$) and uniformity along the z-axis ($\\partial/\\partial z = 0$), with fields depending only on the radial coordinate $r$. The magnetic field is $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + B_{\\phi}(r)\\,\\hat{\\boldsymbol{\\phi}}$, and the pressure is $p(r)$.\n\nThe equilibrium force balance equation is:\n$$ \\nabla p = \\mathbf{j} \\times \\mathbf{B} $$\nIn cylindrical coordinates, the radial component is:\n$$ \\dfrac{dp}{dr} = j_{\\theta} B_{\\phi} - j_{\\phi} B_{\\theta} $$\nThe current density $\\mathbf{j}$ is related to $\\mathbf{B}$ by Ampère's Law:\n$$ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j} $$\nThe components of the current density are:\n$$ j_{\\theta} = -\\dfrac{1}{\\mu_0} \\dfrac{dB_{\\phi}}{dr} $$\n$$ j_{\\phi} = \\dfrac{1}{\\mu_0 r} \\dfrac{d(r B_{\\theta})}{dr} $$\nSubstituting these into the force balance equation:\n$$ \\dfrac{dp}{dr} = \\left(-\\dfrac{1}{\\mu_0} \\dfrac{dB_{\\phi}}{dr}\\right) B_{\\phi} - \\left(\\dfrac{1}{\\mu_0 r} \\dfrac{d(r B_{\\theta})}{dr}\\right) B_{\\theta} $$\nThis equation can be rearranged to solve for the poloidal field $B_{\\theta}(r)$. Let us group the terms:\n$$ \\mu_0 \\dfrac{dp}{dr} = -B_{\\phi} \\dfrac{dB_{\\phi}}{dr} - \\dfrac{B_{\\theta}}{r} \\dfrac{d(r B_{\\theta})}{dr} $$\n$$ \\mu_0 \\dfrac{dp}{dr} + \\dfrac{1}{2} \\dfrac{d(B_{\\phi}^2)}{dr} = -\\dfrac{B_{\\theta}}{r} \\left(B_{\\theta} + r \\dfrac{dB_{\\theta}}{dr}\\right) = -\\dfrac{B_{\\theta}^2}{r} - B_{\\theta} \\dfrac{dB_{\\theta}}{dr} = -\\dfrac{B_{\\theta}^2}{r} - \\dfrac{1}{2}\\dfrac{d(B_{\\theta}^2)}{dr} $$\nLet $Y(r) = B_{\\theta}^2(r)$. The equation becomes:\n$$ \\dfrac{1}{2}\\dfrac{dY}{dr} + \\dfrac{1}{r} Y = -\\mu_0 \\dfrac{dp}{dr} - \\dfrac{1}{2}\\dfrac{d(B_{\\phi}^2)}{dr} $$\nMultiplying by $2$, we obtain a first-order linear ODE for $Y(r)$:\n$$ \\dfrac{dY}{dr} + \\dfrac{2}{r} Y(r) = Q(r) $$\nwhere $Q(r) = -2\\mu_0 \\dfrac{dp}{dr} - \\dfrac{d(B_{\\phi}^2)}{dr}$.\n\nThis ODE can be solved using an integrating factor $I(r) = \\exp\\left(\\int \\frac{2}{r} dr\\right) = r^2$.\n$$ \\dfrac{d}{dr}(r^2 Y) = r^2 Q(r) $$\nIntegrating from $0$ to $r$ yields:\n$$ r^2 Y(r) - \\lim_{\\rho\\to 0}(\\rho^2 Y(\\rho)) = \\int_0^r \\rho^2 Q(\\rho) d\\rho $$\nPhysical regularity at the origin ($r=0$) requires the axial current density $j_{\\phi}(0)$ to be finite. From Ampère's law, $B_{\\theta}(r) \\approx (\\mu_0 j_{\\phi}(0)/2)r$ for small $r$. Therefore, $Y(r) = B_{\\theta}^2(r) \\approx (\\mu_0 j_{\\phi}(0)/2)^2 r^2$, which implies $\\lim_{r\\to 0}(r^2 Y(r)) = 0$. The solution for $Y(r)$ is thus:\n$$ Y(r) = \\dfrac{1}{r^2} \\int_0^r \\rho^2 Q(\\rho) d\\rho $$\nThe poloidal magnetic field is then $B_{\\theta}(r) = \\sqrt{Y(r)}$. We take the positive root by convention.\n\n### Numerical Implementation\n\n1.  **Discretization**: The radial domain $r \\in [0, a]$ is discretized into a fine, uniform grid.\n\n2.  **Profile Calculation**:\n    -   The functions for $p(r)$, $B_{\\phi}(r)$, and their analytical derivatives $dp/dr$ and $dB_{\\phi}/dr$ are implemented based on the given parametric forms.\n    -   The term $Q(r)$ is computed at each grid point.\n    -   The integral $\\int_0^r \\rho^2 Q(\\rho) d\\rho$ is evaluated numerically for all grid points using a cumulative integration method, such as the cumulative trapezoidal rule.\n    -   $Y(r) = B_{\\theta}^2(r)$ is calculated from the integral. At $r=0$, the value is determined by the limit, which is $Y(0)=0$.\n    -   $B_{\\theta}(r) = \\sqrt{Y(r)}$ is computed. Physical consistency requires $Y(r) \\ge 0$.\n\n3.  **Stability-Related Quantities**:\n    -   **Safety Factor, $q(r)$**: Calculated using its definition $q(r) = r B_{\\phi}(r) / (R_0 B_{\\theta}(r))$. At $r=0$, this form is indeterminate ($0/0$). The limit is finite and can be approximated by the value at the first grid point, $q(r_1)$, for a sufficiently fine grid.\n    -   **Magnetic Shear, $s(r)$**: Calculated as $s(r) = \\frac{r}{q(r)}\\frac{dq}{dr}$. The derivative $dq/dr$ is computed numerically from the $q(r)$ profile using a finite-difference method.\n    -   **Toroidal Current Density, $j_{\\phi}(r)$**: To avoid numerical differentiation of $B_{\\theta}(r)$, we use the force balance equation: $j_{\\phi} = (j_{\\theta} B_{\\phi} - dp/dr) / B_{\\theta}$. Substituting $j_{\\theta} = (-1/\\mu_0)dB_{\\phi}/dr$ provides a more robust calculation which can be derived to be equivalent to $j_{\\phi}(r) = Q(r) / (2 \\mu_0 B_{\\theta}(r))$. The limit at $r=0$ is finite and can be handled by extrapolation from nearby points.\n    -   **Current Gradient Factor, $\\Gamma_j(r)$**: The derivative $dj_{\\phi}/dr$ is computed numerically from the $j_{\\phi}(r)$ profile. Its maximum absolute value over $(0, a]$ is found, and $\\Gamma_j(r)$ is calculated as the ratio $| d j_{\\phi}(r)/dr | / \\max| d j_{\\phi}/dr |$.\n\n4.  **Susceptibility Analysis**:\n    -   The code iterates through the specified rational surfaces $q_{mn} = m/n$ for $m=1$ and $n \\in \\{4, ..., 10\\}$.\n    -   For each grid point $r_i$, it checks if all three susceptibility criteria are met for any of the target $q_{mn}$ values:\n        1.  $|q(r_i) - q_{mn}| \\le \\varepsilon_q = 0.005$\n        2.  $|s(r_i)| \\le s_{\\max} = 0.3$\n        3.  $\\Gamma_j(r_i) \\ge \\Gamma_{\\min} = 0.4$\n    -   All radial locations $r_i$ that satisfy these conditions are collected.\n\n5.  **Clustering**: The collected susceptible radii are sorted. Adjacent points (closer than twice the grid spacing) are grouped into clusters. The mean normalized radius ($r/a$) for each cluster is computed and reported, rounded to three decimal places. This ensures that a single resonant surface region is reported as a single location.\n\nThe solution is implemented in Python, using the `numpy` library for numerical array operations and `scipy.integrate.cumulative_trapezoid` for stable numerical integration.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (typical reversed-field)\n        {'a': 0.5, 'R0': 1.5, 'B0': 0.5, 'eta': -0.2, 's': 2, 'p0': 1.0e5, 'beta': 2},\n        # Case 2 (no reversal boundary)\n        {'a': 0.5, 'R0': 1.5, 'B0': 0.5, 'eta': 0.0, 's': 2, 'p0': 8.0e4, 'beta': 4},\n        # Case 3 (strong reversal with steeper pressure)\n        {'a': 0.5, 'R0': 1.5, 'B0': 0.5, 'eta': -0.5, 's': 2, 'p0': 1.2e5, 'beta': 3},\n    ]\n\n    # Global parameters and settings\n    MU0 = 4 * np.pi * 1e-7\n    NUM_POINTS = 4001\n    \n    # Stability criteria parameters\n    EPS_Q = 0.005\n    S_MAX = 0.3\n    GAMMA_MIN = 0.4\n    M_MODE = 1\n    N_MODES = np.arange(4, 11)\n\n    all_results = []\n    \n    for params in test_cases:\n        susceptible_radii = find_susceptible_regions(params, MU0, NUM_POINTS, M_MODE, N_MODES, EPS_Q, S_MAX, GAMMA_MIN)\n        all_results.append(susceptible_radii)\n\n    # Format the final output string\n    list_strs = []\n    for res_list in all_results:\n        if not res_list:\n            list_strs.append(\"[]\")\n        else:\n            list_strs.append(f\"[{','.join([f'{r:.3f}' for r in res_list])}]\")\n    \n    print(f\"[{','.join(list_strs)}]\")\n\ndef find_susceptible_regions(params, mu0, num_points, m_mode, n_modes, eps_q, s_max, gamma_min):\n    \"\"\"\n    Calculates equilibrium profiles and finds regions susceptible to tearing modes for a given parameter set.\n    \"\"\"\n    a = params['a']\n    R0 = params['R0']\n    B0 = params['B0']\n    eta = params['eta']\n    s_exp = params['s']\n    p0 = params['p0']\n    beta = params['beta']\n\n    r = np.linspace(0, a, num_points)\n    delta_r = r[1] - r[0]\n\n    # Handle r=0 for analytical expressions\n    r_nz = r[1:]\n    \n    # Pressure profile and its derivative\n    p_profile = p0 * (1 - (r / a)**beta)\n    dp_dr = np.zeros_like(r)\n    dp_dr[1:] = -p0 * beta * (r_nz / a)**(beta - 1) / a\n\n    # Toroidal field profile and its derivative\n    B_phi = B0 * (1 + (eta - 1) * (r / a)**s_exp)\n    dB_phi_dr = np.zeros_like(r)\n    dB_phi_dr[1:] = B0 * (eta - 1) * s_exp * (r_nz / a)**(s_exp - 1) / a\n\n    # Calculate Q(r) for the ODE\n    Q = -2 * mu0 * dp_dr - 2 * B_phi * dB_phi_dr\n    \n    # Solve for Y(r) = B_theta^2(r) by integration\n    integrand = r**2 * Q\n    integral_vals = cumulative_trapezoid(integrand, r, initial=0)\n    \n    Y = np.zeros_like(r)\n    Y[1:] = integral_vals[1:] / r_nz**2\n    if np.any(Y < 0): # Check for physical consistency\n        # This case should not happen with the given parameters but is a good sanity check\n        return []\n    \n    B_theta = np.sqrt(Y)\n\n    # Calculate safety factor q(r)\n    q = np.zeros_like(r)\n    # For r > 0\n    q[1:] = (r_nz * B_phi[1:]) / (R0 * B_theta[1:])\n    # At r = 0, q has a finite limit. Approximate with the first grid point's value.\n    q[0] = q[1] \n    \n    # Calculate magnetic shear s(r)\n    dq_dr = np.gradient(q, delta_r)\n    s = np.zeros_like(r)\n    # Avoid division by zero if q=0\n    q_is_zero = np.abs(q) < 1e-12\n    s[~q_is_zero] = (r[~q_is_zero] / q[~q_is_zero]) * dq_dr[~q_is_zero]\n    \n    # Calculate toroidal current density j_phi(r)\n    j_phi = np.zeros_like(r)\n    # For r > 0, using the more stable formula j_phi = Q / (2 * mu0 * B_theta)\n    j_phi[1:] = Q[1:] / (2 * mu0 * B_theta[1:])\n    # At r = 0, j_phi has a finite limit. Approximate with first grid point.\n    j_phi[0] = j_phi[1]\n    \n    # Calculate normalized current density gradient Gamma_j(r)\n    dj_phi_dr = np.gradient(j_phi, delta_r)\n    # Maximum is taken over 0 < r <= a as per problem description\n    max_abs_dj_phi_dr = np.max(np.abs(dj_phi_dr[1:]))\n\n    gamma_j = np.zeros_like(r)\n    if max_abs_dj_phi_dr > 1e-12:\n        gamma_j = np.abs(dj_phi_dr) / max_abs_dj_phi_dr\n    \n    # Identify all susceptible grid points\n    all_susceptible_points_r = []\n    q_targets = m_mode / n_modes\n    \n    for i in range(1, num_points): # Iterate from r > 0\n        is_susceptible = False\n        # Check resonance condition\n        for q_target in q_targets:\n            if abs(q[i] - q_target) <= eps_q:\n                # If resonant, check other conditions\n                if abs(s[i]) <= s_max and gamma_j[i] >= gamma_min:\n                    is_susceptible = True\n                    break # Found a reason, no need to check other n_modes\n        \n        if is_susceptible:\n            all_susceptible_points_r.append(r[i])\n\n    if not all_susceptible_points_r:\n        return []\n        \n    # Cluster adjacent points\n    clusters = []\n    sorted_radii = sorted(list(set(all_susceptible_points_r)))\n    \n    current_cluster = [sorted_radii[0]]\n    for i in range(1, len(sorted_radii)):\n        # Group if points are within 2 grid spacings\n        if (sorted_radii[i] - sorted_radii[i-1]) < 2.0 * delta_r:\n            current_cluster.append(sorted_radii[i])\n        else:\n            clusters.append(current_cluster)\n            current_cluster = [sorted_radii[i]]\n    clusters.append(current_cluster)\n\n    # Calculate mean normalized radius for each cluster\n    final_radii = [np.mean(c) / a for c in clusters]\n    \n    return sorted(final_radii)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}