{
    "hands_on_practices": [
        {
            "introduction": "任何数值模拟都必须充分解析其背后的物理过程。本练习将等离子体中的基本物理尺度（如回旋半径 $\\rho_i$ 和德拜长度 $\\lambda_{De}$）与网格间距和时间步长的实际选择联系起来。通过完成这个练习，你将掌握从第一性原理出发验证模拟设置有效性的核心技能，以确保你的计算结果具有物理意义。",
            "id": "3964506",
            "problem": "您的任务是从第一性原理出发，证明一个用于分布函数微扰 (delta-f) 模拟的指定数值设置能够解析相关的物理尺度。目标是从核心定义和经过充分检验的公式中推导出分辨率要求，然后针对几个给定的参数集，计算该设置是否足够。分析必须基于无碰撞动理学等离子体理论和标准采样约束。\n\n所有输入均以国际单位制 (SI) 表示。温度以电子伏特 (electronvolts) 为单位提供，必须使用 $1\\,\\mathrm{eV} = e \\, \\mathrm{J}$ 将其转换为焦耳 (joules)，其中 $e$ 是元电荷。时间单位为秒，距离单位为米，磁场单位为特斯拉，数密度单位为 $\\mathrm{m^{-3}}$。角度单位不适用。您的程序必须为每个测试用例返回一个布尔值，以指示其适定性。\n\n从无碰撞的 Vlasov-Poisson-Maxwell 系统和以下核心定义开始：\n\n- 离子热速度：$v_{thi} = \\sqrt{\\dfrac{2 k_B T_i}{m_i}}$。\n- 电子热速度：$v_{the} = \\sqrt{\\dfrac{2 k_B T_e}{m_e}}$。\n- 离子回旋频率：$\\Omega_{ci} = \\dfrac{|q_i| B}{m_i}$。\n- 电子回旋频率：$\\Omega_{ce} = \\dfrac{|q_e| B}{m_e}$。\n- 电子等离子体频率：$\\omega_{pe} = \\sqrt{\\dfrac{n_e q_e^2}{\\epsilon_0 m_e}}$。\n- 电子德拜长度：$\\lambda_{De} = \\sqrt{\\dfrac{\\epsilon_0 k_B T_e}{n_e q_e^2}}$。\n- 离子回旋半径：$\\rho_i = \\dfrac{v_{thi}}{\\Omega_{ci}}$。\n- 密度梯度标长：$L_n = \\left|\\dfrac{d \\ln n}{dr}\\right|^{-1}$；在本问题中，$L_n$ 是一个单位为米的输入参数。\n\n对于每个方向上域长度为 $L_x$ 和 $L_y$、网格数为 $N_x$ 和 $N_y$ 的均匀网格，网格间距为 $dx = \\dfrac{L_x}{N_x}$ 和 $dy = \\dfrac{L_y}{N_y}$。要解析一个物理尺度 $\\ell$，每个尺度上必须有最小数量的网格点，记为 $N_p$，使得 $\\dfrac{\\ell}{dx} \\ge N_p$ 和 $\\dfrac{\\ell}{dy} \\ge N_p$，这与奈奎斯特采样定理以及精确表示梯度的需求相一致。\n\n对于时间分辨率，设 $dt$ 为时间步长。适定性要求 $dt$ 远小于最快相关线性频率的倒数。这通过形如 $dt \\,\\omega \\le \\beta$ 的界限来施加，其中 $\\omega$ 是一个特征频率，$\\beta$ 是一个小的无量纲常数（例如，$\\beta = 0.1$）。\n\n考虑两种 delta-f 模型体系：\n\n- 回旋动理学 delta-f（静电，准中性序）：需要解析的相关空间尺度是 $ \\rho_i $ 和 $ L_n $。对于动态相关的垂直波数 $k_\\perp$，准中性要求 $k_\\perp \\lambda_{De} \\ll 1$。对于 $k_\\perp \\sim 1/\\rho_i$ 的模式，这简化为 $\\dfrac{\\lambda_{De}}{\\rho_i} \\ll 1$。一个充分的序检验是 $\\dfrac{\\lambda_{De}}{\\rho_i} \\le \\epsilon$，其中 $\\epsilon$ 是一个小的输入常数（例如，$\\epsilon = 0.1$）。时间分辨率要求 $dt \\,\\Omega_{ci} \\le \\beta_{GK}$，其中 $\\beta_{GK}$ 是一个输入参数（例如，$\\beta_{GK} = 0.1$）。域必须包含梯度尺度，$L_x \\ge L_n$ 和 $L_y \\ge L_n$。\n\n- 粒子模拟 (Particle-In-Cell) delta-f（静电，解析屏蔽）：网格必须解析电子德拜长度，即 $\\dfrac{\\lambda_{De}}{dx} \\ge N_p$ 和 $\\dfrac{\\lambda_{De}}{dy} \\ge N_p$，并且通常还必须解析 $\\rho_i$ 以捕捉存在的有限拉莫尔半径效应，即 $\\dfrac{\\rho_i}{dx} \\ge N_p$ 和 $\\dfrac{\\rho_i}{dy} \\ge N_p$。时间分辨率要求 $dt \\,\\omega_{pe} \\le \\beta_{pe}$ 和 $dt \\,\\Omega_{ce} \\le \\beta_{ce}$，其中 $\\beta_{pe}$ 和 $\\beta_{ce}$ 是输入参数（例如，$\\beta_{pe} = \\beta_{ce} = 0.1$）。域必须包含梯度尺度，$L_x \\ge L_n$ 和 $L_y \\ge L_n$。\n\n必须通过为每个测试用例计算以下内容来证明其适定性：\n\n- $x$ 和 $y$ 方向上每个离子回旋半径的点数：$\\dfrac{\\rho_i}{dx}$ 和 $\\dfrac{\\rho_i}{dy}$。\n- $x$ 和 $y$ 方向上每个德拜长度的点数：$\\dfrac{\\lambda_{De}}{dx}$ 和 $\\dfrac{\\lambda_{De}}{dy}$。\n- $x$ 和 $y$ 方向上每个梯度标长的点数：$\\dfrac{L_n}{dx}$ 和 $\\dfrac{L_n}{dy}$。\n- 时间步长乘积 $dt \\,\\Omega_{ci}$、$dt \\,\\omega_{pe}$ 和 $dt \\,\\Omega_{ce}$。\n\n根据模型类型应用适当的判据。一个用例当且仅当其模型类型的所有判据都得到满足时，才被认为是适定的。\n\n测试套件（四个用例）：\n\n- 用例 1（回旋动理学 delta-f，适定）：\n  - 模型：gyrokinetic。\n  - 磁场 $B = 3.0\\,\\mathrm{T}$。\n  - 离子温度 $T_i = 1000\\,\\mathrm{eV}$。\n  - 电子温度 $T_e = 1000\\,\\mathrm{eV}$。\n  - 电子密度 $n_e = 1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$。\n  - 域 $L_x = 0.5\\,\\mathrm{m}$，$L_y = 0.5\\,\\mathrm{m}$。\n  - 网格 $N_x = 8192$，$N_y = 8192$。\n  - 梯度标长 $L_n = 0.1\\,\\mathrm{m}$。\n  - 时间步长 $dt = 5.0\\times 10^{-10}\\,\\mathrm{s}$。\n  - 每尺度点数要求 $N_p = 20$。\n  - 序公差 $\\epsilon = 0.1$。\n  - 时间步长公差 $\\beta_{GK} = 0.1$。\n\n- 用例 2（回旋动理学 delta-f，因空间分辨率不足而不适定）：\n  - 模型：gyrokinetic。\n  - 磁场 $B = 3.0\\,\\mathrm{T}$。\n  - 离子温度 $T_i = 1000\\,\\mathrm{eV}$。\n  - 电子温度 $T_e = 1000\\,\\mathrm{eV}$。\n  - 电子密度 $n_e = 1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$。\n  - 域 $L_x = 0.5\\,\\mathrm{m}$，$L_y = 0.5\\,\\mathrm{m}$。\n  - 网格 $N_x = 256$，$N_y = 256$。\n  - 梯度标长 $L_n = 0.1\\,\\mathrm{m}$。\n  - 时间步长 $dt = 5.0\\times 10^{-10}\\,\\mathrm{s}$。\n  - 每尺度点数要求 $N_p = 10$。\n  - 序公差 $\\epsilon = 0.1$。\n  - 时间步长公差 $\\beta_{GK} = 0.1$。\n\n- 用例 3（粒子模拟 delta-f，适定）：\n  - 模型：particle-in-cell。\n  - 磁场 $B = 0.5\\,\\mathrm{T}$。\n  - 离子温度 $T_i = 1000\\,\\mathrm{eV}$。\n  - 电子温度 $T_e = 1000\\,\\mathrm{eV}$。\n  - 电子密度 $n_e = 1.0\\times 10^{18}\\,\\mathrm{m^{-3}}$。\n  - 域 $L_x = 0.3\\,\\mathrm{m}$，$L_y = 0.3\\,\\mathrm{m}$。\n  - 网格 $N_x = 16384$，$N_y = 16384$。\n  - 梯度标长 $L_n = 0.05\\,\\mathrm{m}$。\n  - 时间步长 $dt = 1.0\\times 10^{-12}\\,\\mathrm{s}$。\n  - 每尺度点数要求 $N_p = 10$。\n  - 时间步长公差 $\\beta_{pe} = 0.1$，$\\beta_{ce} = 0.1$。\n\n- 用例 4（粒子模拟 delta-f，因时间步长不适定）：\n  - 模型：particle-in-cell。\n  - 磁场 $B = 0.5\\,\\mathrm{T}$。\n  - 离子温度 $T_i = 1000\\,\\mathrm{eV}$。\n  - 电子温度 $T_e = 1000\\,\\mathrm{eV}$。\n  - 电子密度 $n_e = 1.0\\times 10^{18}\\,\\mathrm{m^{-3}}$。\n  - 域 $L_x = 0.3\\,\\mathrm{m}$，$L_y = 0.3\\,\\mathrm{m}$。\n  - 网格 $N_x = 16384$，$N_y = 16384$。\n  - 梯度标长 $L_n = 0.05\\,\\mathrm{m}$。\n  - 时间步长 $dt = 1.0\\times 10^{-10}\\,\\mathrm{s}$。\n  - 每尺度点数要求 $N_p = 10$。\n  - 时间步长公差 $\\beta_{pe} = 0.1$，$\\beta_{ce} = 0.1$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是一个布尔值，表示相应案例的适定性。",
            "solution": "该问题陈述被评估为有效、自洽且具有科学依据。它提出了一个定义明确的任务：基于动理学理论的基本原理和标准计算实践，验证 delta-f 等离子体模拟的数值分辨率判据。每个测试用例都提供了所有必需的参数。将作出一个标准的假设：离子种类为氘，这在磁约束聚变问题中是典型的。温度的表示法，$T_i$ 和 $T_e$，以电子伏特（$eV$）为单位给出，被解释为热能，因此所提供公式中的量 $k_B T$ 被替换为 $T [\\mathrm{eV}] \\times e$，其中 $e$ 是元电荷。\n\n解决方案首先定义必要的物理常数，然后从提供的公式中推导出所需的物理尺度和频率。随后，为回旋动理学模型和粒子模拟模型建立具体的分辨率判据。最后，设计一个算法将这些判据应用于每个测试用例，以确定其适定性。\n\n计算中将使用以下国际单位制 (SI) 的物理常数：\n- 元电荷, $e = 1.602176634 \\times 10^{-19} \\, \\mathrm{C}$\n- 真空介电常数, $\\epsilon_0 = 8.8541878128 \\times 10^{-12} \\, \\mathrm{F/m}$\n- 电子质量, $m_e = 9.1093837015 \\times 10^{-31} \\, \\mathrm{kg}$\n- 氘核质量（假定的离子种类）, $m_i = 3.3444947 \\times 10^{-27} \\, \\mathrm{kg}$\n- 离子电荷为 $|q_i| = e$，电子电荷为 $|q_e| = e$。\n\n首先，我们根据域长度（$L_x, L_y$）和网格点数（$N_x, N_y$）定义 $x$ 和 $y$ 方向上的计算网格间距：\n$$\ndx = \\frac{L_x}{N_x}\n$$\n$$\ndy = \\frac{L_y}{N_y}\n$$\n\n接下来，我们为一组给定的等离子体参数计算基本的物理尺度和频率。温度 $T_i$ 和 $T_e$ 从电子伏特转换为焦耳以便在公式中使用，\n$E_i = T_i[\\mathrm{eV}] \\times e$ 和 $E_e = T_e[\\mathrm{eV}] \\times e$。\n\n离子和电子的热速度为：\n$$\nv_{thi} = \\sqrt{\\frac{2 E_i}{m_i}} = \\sqrt{\\frac{2 T_i[\\mathrm{eV}] e}{m_i}}\n$$\n$$\nv_{the} = \\sqrt{\\frac{2 E_e}{m_e}} = \\sqrt{\\frac{2 T_e[\\mathrm{eV}] e}{m_e}}\n$$\n\n在磁场 $B$ 中，离子和电子的回旋频率为：\n$$\n\\Omega_{ci} = \\frac{e B}{m_i}\n$$\n$$\n\\Omega_{ce} = \\frac{e B}{m_e}\n$$\n\n表征集体电子振荡的电子等离子体频率为：\n$$\n\\omega_{pe} = \\sqrt{\\frac{n_e e^2}{\\epsilon_0 m_e}}\n$$\n\n特征长度尺度——电子德拜长度 $\\lambda_{De}$ 和离子回旋半径 $\\rho_i$——为：\n$$\n\\lambda_{De} = \\sqrt{\\frac{\\epsilon_0 E_e}{n_e e^2}} = \\sqrt{\\frac{\\epsilon_0 T_e[\\mathrm{eV}]}{n_e e}}\n$$\n$$\n\\rho_i = \\frac{v_{thi}}{\\Omega_{ci}}\n$$\n\n有了这些量，我们现在可以陈述每种模拟模型的完整适定性判据。\n\n**回旋动理学 (GK) Delta-f 模型适定性判据：**\n回旋动理学模型的有效性基于一个序假设，即时间变化缓慢（与 $\\Omega_{ci}$ 相比），空间尺度大（与 $\\rho_i$ 相比），同时强制执行准中性。数值分辨率必须尊重这些假设。\n1.  **序条件：** 对于垂直波数 $k_\\perp \\sim 1/\\rho_i$ 的模式，准中性要求 $\\lambda_{De} \\ll \\rho_i$。检验方式为：\n    $$\n    \\frac{\\lambda_{De}}{\\rho_i} \\le \\epsilon\n    $$\n2.  **域大小：** 模拟域必须足够大，以包含平衡密度梯度标长 $L_n$：\n    $$\n    L_x \\ge L_n \\quad \\text{和} \\quad L_y \\ge L_n\n    $$\n3.  **空间分辨率：** 网格必须解析模型的基本物理尺度，即离子回旋半径 $\\rho_i$ 和梯度标长 $L_n$。每个尺度需要最少 $N_p$ 个点来解析：\n    $$\n    \\frac{\\rho_i}{dx} \\ge N_p \\quad \\text{和} \\quad \\frac{\\rho_i}{dy} \\ge N_p\n    $$\n    $$\n    \\frac{L_n}{dx} \\ge N_p \\quad \\text{和} \\quad \\frac{L_n}{dy} \\ge N_p\n    $$\n4.  **时间分辨率：** 时间步长 $dt$ 必须足够小，以解析模型的特征频率，即离子回旋频率 $\\Omega_{ci}$：\n    $$\n    dt \\cdot \\Omega_{ci} \\le \\beta_{GK}\n    $$\n一个回旋动理学模拟设置当且仅当所有四个条件都满足时，才被视为适定。\n\n**粒子模拟 (PIC) Delta-f 模型适定性判据：**\nPIC 模型解析电子动力学和电荷分离效应。因此，它需要解析比回旋动理学模型小得多的空间和时间尺度。\n1.  **域大小：** 与 GK 模型类似，模拟域必须足够大，以容纳驱动系统的梯度尺度：\n    $$\n    L_x \\ge L_n \\quad \\text{和} \\quad L_y \\ge L_n\n    $$\n2.  **空间分辨率：** 网格必须解析电子德拜长度 $\\lambda_{De}$ 以正确捕捉静电屏蔽。它通常还必须解析离子回旋半径 $\\rho_i$ 以捕捉有限拉莫尔半径效应。两者都必须由至少 $N_p$ 个网格点解析：\n    $$\n    \\frac{\\lambda_{De}}{dx} \\ge N_p \\quad \\text{和} \\quad \\frac{\\lambda_{De}}{dy} \\ge N_p\n    $$\n    $$\n    \\frac{\\rho_i}{dx} \\ge N_p \\quad \\text{和} \\quad \\frac{\\rho_i}{dy} \\ge N_p\n    $$\n3.  **时间分辨率：** 时间步长 $dt$ 必须足够小，以解析系统中最快的频率，即电子等离子体频率 $\\omega_{pe}$ 和电子回旋频率 $\\Omega_{ce}$：\n    $$\n    dt \\cdot \\omega_{pe} \\le \\beta_{pe}\n    $$\n    $$\n    dt \\cdot \\Omega_{ce} \\le \\beta_{ce}\n    $$\n一个 PIC 模拟设置当且仅当所有三个条件都满足时，才被视为适定。\n\n最终答案中实现的算法将对测试套件中提供的每个用例执行这些检查，并返回一个布尔值，指示其总体适定性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates numerical setups for delta-f plasma simulations based on first principles.\n    The function processes a test suite of simulation parameters and determines\n    for each case whether the resolution criteria for the specified model (gyrokinetic\n    or particle-in-cell) are met.\n    \"\"\"\n\n    # Physical constants in SI units\n    CONSTANTS = {\n        'e': 1.602176634e-19,      # Elementary charge (C)\n        'epsilon_0': 8.8541878128e-12, # Vacuum permittivity (F/m)\n        'm_e': 9.1093837015e-31,      # Electron mass (kg)\n        'm_i': 3.3444947e-27,         # Ion mass (Deuterium) (kg)\n    }\n\n    test_cases = [\n        # Case 1 (Gyrokinetic delta-f, adequate)\n        {\n            \"model\": \"gyrokinetic\", \"B\": 3.0, \"T_i\": 1000.0, \"T_e\": 1000.0,\n            \"n_e\": 1.0e19, \"L_x\": 0.5, \"L_y\": 0.5, \"N_x\": 8192, \"N_y\": 8192,\n            \"L_n\": 0.1, \"dt\": 5.0e-10, \"N_p\": 20, \"epsilon\": 0.1, \"beta_GK\": 0.1\n        },\n        # Case 2 (Gyrokinetic delta-f, inadequate due to spatial resolution)\n        {\n            \"model\": \"gyrokinetic\", \"B\": 3.0, \"T_i\": 1000.0, \"T_e\": 1000.0,\n            \"n_e\": 1.0e19, \"L_x\": 0.5, \"L_y\": 0.5, \"N_x\": 256, \"N_y\": 256,\n            \"L_n\": 0.1, \"dt\": 5.0e-10, \"N_p\": 10, \"epsilon\": 0.1, \"beta_GK\": 0.1\n        },\n        # Case 3 (Particle-In-Cell delta-f, adequate)\n        {\n            \"model\": \"particle-in-cell\", \"B\": 0.5, \"T_i\": 1000.0, \"T_e\": 1000.0,\n            \"n_e\": 1.0e18, \"L_x\": 0.3, \"L_y\": 0.3, \"N_x\": 16384, \"N_y\": 16384,\n            \"L_n\": 0.05, \"dt\": 1.0e-12, \"N_p\": 10, \"beta_pe\": 0.1, \"beta_ce\": 0.1\n        },\n        # Case 4 (Particle-In-Cell delta-f, inadequate due to time step)\n        {\n            \"model\": \"particle-in-cell\", \"B\": 0.5, \"T_i\": 1000.0, \"T_e\": 1000.0,\n            \"n_e\": 1.0e18, \"L_x\": 0.3, \"L_y\": 0.3, \"N_x\": 16384, \"N_y\": 16384,\n            \"L_n\": 0.05, \"dt\": 1.0e-10, \"N_p\": 10, \"beta_pe\": 0.1, \"beta_ce\": 0.1\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        # Calculate grid spacings\n        dx = params[\"L_x\"] / params[\"N_x\"]\n        dy = params[\"L_y\"] / params[\"N_y\"]\n\n        # Convert temperatures from eV to Joules\n        E_i = params[\"T_i\"] * CONSTANTS['e']\n        E_e = params[\"T_e\"] * CONSTANTS['e']\n\n        # Calculate physical scales and frequencies\n        v_thi = np.sqrt(2 * E_i / CONSTANTS['m_i'])\n        Omega_ci = CONSTANTS['e'] * params[\"B\"] / CONSTANTS['m_i']\n        Omega_ce = CONSTANTS['e'] * params[\"B\"] / CONSTANTS['m_e']\n        omega_pe = np.sqrt(params[\"n_e\"] * CONSTANTS['e']**2 / (CONSTANTS['epsilon_0'] * CONSTANTS['m_e']))\n        rho_i = v_thi / Omega_ci\n        lambda_De = np.sqrt(CONSTANTS['epsilon_0'] * E_e / (params[\"n_e\"] * CONSTANTS['e']**2))\n\n        is_adequate = False\n        if params[\"model\"] == \"gyrokinetic\":\n            # 1. Ordering condition\n            cond1 = (lambda_De / rho_i) = params[\"epsilon\"]\n            # 2. Domain size\n            cond2 = (params[\"L_x\"] = params[\"L_n\"]) and (params[\"L_y\"] = params[\"L_n\"])\n            # 3. Spatial resolution\n            cond3_rho_i = (rho_i / dx = params[\"N_p\"]) and (rho_i / dy = params[\"N_p\"])\n            cond3_L_n = (params[\"L_n\"] / dx = params[\"N_p\"]) and (params[\"L_n\"] / dy = params[\"N_p\"])\n            # 4. Temporal resolution\n            cond4 = (params[\"dt\"] * Omega_ci) = params[\"beta_GK\"]\n            \n            is_adequate = cond1 and cond2 and cond3_rho_i and cond3_L_n and cond4\n\n        elif params[\"model\"] == \"particle-in-cell\":\n            # 1. Domain size\n            cond1 = (params[\"L_x\"] = params[\"L_n\"]) and (params[\"L_y\"] = params[\"L_n\"])\n            # 2. Spatial resolution\n            cond2_lambda_De = (lambda_De / dx = params[\"N_p\"]) and (lambda_De / dy = params[\"N_p\"])\n            cond2_rho_i = (rho_i / dx = params[\"N_p\"]) and (rho_i / dy = params[\"N_p\"])\n            # 3. Temporal resolution\n            cond3_pe = (params[\"dt\"] * omega_pe) = params[\"beta_pe\"]\n            cond3_ce = (params[\"dt\"] * Omega_ce) = params[\"beta_ce\"]\n\n            is_adequate = cond1 and cond2_lambda_De and cond2_rho_i and cond3_pe and cond3_ce\n        \n        results.append(is_adequate)\n\n    # Format and print the final results\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "粒子模拟方法（Particle-In-Cell）的精度受到有限数量标记点所带来的统计噪声的限制。本练习探讨了不同标记点加载方案（“安静启动”与“随机启动”）的统计特性如何影响物理量估计值的方差。这项实践让你对数值噪声有一个定量的理解，使你能够在初始化策略上做出明智的决策，从而在给定的计算成本下优化模拟的保真度。",
            "id": "3964422",
            "problem": "在计算聚变科学与工程的δ扰动粒子方法（delta-$f$）中，考虑使用箱型沉积法估算单个体积为 $V$ 的位形空间单元中的扰动数密度 $\\delta n$。该估计量定义为 $$\\hat{\\delta n} = \\frac{1}{V} \\sum_{i=1}^{N_c} w_i,$$ 其中 $N_c$ 是单元中的标记粒子数，$w_i$ 是感兴趣时刻的标记粒子权重。假设权重 $\\{w_i\\}$ 独立同分布，其均值为 $\\mu_w$，方差为 $\\sigma_w^2$。在静态启动下，位置是确定性分层的，因此每个单元的 $N_c = N$ 是固定的；在随机启动下，标记粒子是独立放置的，因此 $N_c$ 是一个均值为 $\\bar{N}$ 的泊松随机变量，并且位置在单元内是独立同分布的。$\\mu_w$ 的符号与相对误差的规定无关。\n\n从估计量的定义、独立随机变量和的方差基本性质，以及泊松分布计数的复合和方差定律出发，推导在静态启动和随机启动这两种初始化策略下，为达到目标相对均方根误差 $$\\epsilon = \\frac{\\sqrt{\\mathrm{Var}(\\hat{\\delta n})}}{|\\delta n|}$$ 所需的每个单元的标记粒子数表达式。然后，使用以下参数评估您的表达式：$$\\mu_w = 2.0 \\times 10^{-3}, \\qquad \\sigma_w^2 = 3.0 \\times 10^{-6}, \\qquad \\epsilon = 1.00 \\times 10^{-2}.$$ 假设单元上为箱型沉积，并将真实的 $\\delta n$ 取为相应初始化策略下 $\\hat{\\delta n}$ 的均值。将您的两个答案都四舍五入到 $3$ 位有效数字。按静态启动和随机启动的顺序，分别给出所需的每个单元的标记粒子数作为最终结果。计数无需物理单位。",
            "solution": "该问题要求在δ-$f$模拟中，针对静态启动和随机启动这两种不同的初始化策略，为达到目标相对均方根误差 $\\epsilon$ 所需的每个单元的标记粒子数。\n\n在体积为 $V$ 的位形空间单元中，扰动数密度 $\\delta n$ 的估计量由下式给出\n$$\n\\hat{\\delta n} = \\frac{1}{V} \\sum_{i=1}^{N_c} w_i\n$$\n其中 $N_c$ 是单元中的标记粒子数，$\\{w_i\\}$ 是标记粒子权重。假设权重是独立同分布（i.i.d.）的随机变量，其均值为 $E[w_i] = \\mu_w$，方差为 $\\mathrm{Var}(w_i) = \\sigma_w^2$。\n\n目标相对误差定义为\n$$\n\\epsilon = \\frac{\\sqrt{\\mathrm{Var}(\\hat{\\delta n})}}{|\\delta n|}\n$$\n题目要求我们假设，对于每种情况，扰动密度 $\\delta n$ 的真值是其估计量的统计期望，即 $\\delta n = E[\\hat{\\delta n}]$。我们将分别分析这两种初始化策略。\n\n情况1：静态启动\n在静态启动中，每个单元的标记粒子数是一个固定的确定性常数，因此 $N_c = N$。\n首先，我们求出估计量的期望，并令其等于真实密度 $\\delta n$。\n$$\n\\delta n = E[\\hat{\\delta n}] = E\\left[\\frac{1}{V} \\sum_{i=1}^{N} w_i\\right] = \\frac{1}{V} \\sum_{i=1}^{N} E[w_i] = \\frac{1}{V} \\sum_{i=1}^{N} \\mu_w = \\frac{N \\mu_w}{V}\n$$\n接下来，我们确定估计量的方差。由于权重 $\\{w_i\\}$ 是独立的，且 $N$ 是一个常数，所以和的方差等于方差的和。\n$$\n\\mathrm{Var}(\\hat{\\delta n}) = \\mathrm{Var}\\left(\\frac{1}{V} \\sum_{i=1}^{N} w_i\\right) = \\frac{1}{V^2} \\mathrm{Var}\\left(\\sum_{i=1}^{N} w_i\\right) = \\frac{1}{V^2} \\sum_{i=1}^{N} \\mathrm{Var}(w_i) = \\frac{1}{V^2} \\sum_{i=1}^{N} \\sigma_w^2 = \\frac{N \\sigma_w^2}{V^2}\n$$\n现在我们可以通过代入 $\\delta n$ 和 $\\mathrm{Var}(\\hat{\\delta n})$ 的表达式来写出相对误差的平方 $\\epsilon^2$。请注意，由于我们使用了 $\\mu_w$ 的平方，因此对 $\\mu_w$ 符号的依赖性消失了。\n$$\n\\epsilon^2 = \\frac{\\mathrm{Var}(\\hat{\\delta n})}{(\\delta n)^2} = \\frac{\\frac{N \\sigma_w^2}{V^2}}{\\left(\\frac{N \\mu_w}{V}\\right)^2} = \\frac{N \\sigma_w^2}{V^2} \\frac{V^2}{N^2 \\mu_w^2} = \\frac{\\sigma_w^2}{N \\mu_w^2}\n$$\n解出 $N$，即静态启动所需的每个单元的标记粒子数，我们得到：\n$$\nN = \\frac{1}{\\epsilon^2} \\frac{\\sigma_w^2}{\\mu_w^2}\n$$\n\n情况2：随机启动\n在随机启动中，单元中的标记粒子数 $N_c$ 是一个服从均值为 $\\bar{N}$ 的泊松分布的随机变量，即 $N_c \\sim \\mathrm{Poisson}(\\bar{N})$。估计量 $\\hat{\\delta n}$ 现在是一个复合和（或随机和），因为求和中的项数本身就是一个随机变量。\n首先，我们使用全期望定律求出估计量的期望。\n$$\n\\delta n = E[\\hat{\\delta n}] = E\\left[\\frac{1}{V} \\sum_{i=1}^{N_c} w_i\\right] = \\frac{1}{V} E\\left[\\sum_{i=1}^{N_c} w_i\\right]\n$$\n对于独立同分布变量的随机和，其期望为 $E[\\sum_{i=1}^{N_c} w_i] = E[N_c] E[w_i]$。对于泊松分布，$E[N_c] = \\bar{N}$。\n$$\n\\delta n = \\frac{1}{V} (\\bar{N} \\mu_w) = \\frac{\\bar{N} \\mu_w}{V}\n$$\n接下来，我们求估计量的方差。我们使用全方差定律，对于随机和（即Blackwell-Girshick方程），其公式为 $\\mathrm{Var}(\\sum_{i=1}^{N_c} w_i) = E[N_c]\\mathrm{Var}(w_i) + \\mathrm{Var}(N_c)(E[w_i])^2$。对于泊松分布，$\\mathrm{Var}(N_c) = E[N_c] = \\bar{N}$。\n$$\n\\mathrm{Var}\\left(\\sum_{i=1}^{N_c} w_i\\right) = \\bar{N} \\sigma_w^2 + \\bar{N} \\mu_w^2 = \\bar{N} (\\sigma_w^2 + \\mu_w^2)\n$$\n则估计量的方差为：\n$$\n\\mathrm{Var}(\\hat{\\delta n}) = \\mathrm{Var}\\left(\\frac{1}{V} \\sum_{i=1}^{N_c} w_i\\right) = \\frac{1}{V^2} \\mathrm{Var}\\left(\\sum_{i=1}^{N_c} w_i\\right) = \\frac{\\bar{N} (\\sigma_w^2 + \\mu_w^2)}{V^2}\n$$\n现在，我们构建相对误差的平方 $\\epsilon^2$：\n$$\n\\epsilon^2 = \\frac{\\mathrm{Var}(\\hat{\\delta n})}{(\\delta n)^2} = \\frac{\\frac{\\bar{N} (\\sigma_w^2 + \\mu_w^2)}{V^2}}{\\left(\\frac{\\bar{N} \\mu_w}{V}\\right)^2} = \\frac{\\bar{N} (\\sigma_w^2 + \\mu_w^2)}{V^2} \\frac{V^2}{\\bar{N}^2 \\mu_w^2} = \\frac{\\sigma_w^2 + \\mu_w^2}{\\bar{N} \\mu_w^2}\n$$\n解出 $\\bar{N}$，即随机启动所需的每个单元的平均标记粒子数，我们得到：\n$$\n\\bar{N} = \\frac{1}{\\epsilon^2} \\frac{\\sigma_w^2 + \\mu_w^2}{\\mu_w^2} = \\frac{1}{\\epsilon^2} \\left(1 + \\frac{\\sigma_w^2}{\\mu_w^2}\\right)\n$$\n与静态启动相比，由单元中随机粒子数（泊松噪声）产生的额外方差导致了对标记粒子数更高的要求。\n\n数值计算\n给定参数如下：\n$\\mu_w = 2.0 \\times 10^{-3}$\n$\\sigma_w^2 = 3.0 \\times 10^{-6}$\n$\\epsilon = 1.00 \\times 10^{-2}$\n\n首先，我们计算必要的中间量：\n$\\mu_w^2 = (2.0 \\times 10^{-3})^2 = 4.0 \\times 10^{-6}$\n$\\frac{1}{\\epsilon^2} = \\frac{1}{(1.00 \\times 10^{-2})^2} = \\frac{1}{1.00 \\times 10^{-4}} = 1.00 \\times 10^4$\n方差之比为：\n$\\frac{\\sigma_w^2}{\\mu_w^2} = \\frac{3.0 \\times 10^{-6}}{4.0 \\times 10^{-6}} = 0.75$\n\n对于静态启动，我们计算 $N$：\n$N = \\frac{1}{\\epsilon^2} \\frac{\\sigma_w^2}{\\mu_w^2} = (1.00 \\times 10^4) \\times (0.75) = 7500$\n四舍五入到 $3$ 位有效数字，$N = 7.50 \\times 10^3$。\n\n对于随机启动，我们计算 $\\bar{N}$：\n$\\bar{N} = \\frac{1}{\\epsilon^2} \\left(1 + \\frac{\\sigma_w^2}{\\mu_w^2}\\right) = (1.00 \\times 10^4) \\times (1 + 0.75) = (1.00 \\times 10^4) \\times (1.75) = 17500$\n四舍五入到 $3$ 位有效数字，$\\bar{N} = 1.75 \\times 10^4$。\n\n所需的每个单元的标记粒子数分别为静态启动的 $7.50 \\times 10^3$ 和随机启动的 $1.75 \\times 10^4$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.50 \\times 10^3  1.75 \\times 10^4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在 $\\delta f$ 模拟中，一个重大挑战是粒子权重 $w$ 可能出现不受控制的增长，从而导致数值不稳定性。本问题将引导你推导标准的权重演化方程，揭示其固有的乘性不稳定性，并演示一种强大的变量变换技术 $\\phi(w) = \\ln(1+w)$ 来恢复其稳定性。掌握这一概念对于开发能够处理强梯度和长时间模拟而不会出现数值溢出的稳健 $\\delta f$ 代码至关重要。",
            "id": "3964533",
            "problem": "考虑一个由相空间中的弗拉索夫方程描述的无碰撞等离子体，其中相空间坐标用 $\\boldsymbol{Z}$ 表示，特征流用 $\\dot{\\boldsymbol{Z}}(\\boldsymbol{Z},t)$ 表示。无碰撞弗拉索夫方程表述为 $D f / D t = 0$，其中 $D/Dt \\equiv \\partial/\\partial t + \\dot{\\boldsymbol{Z}} \\cdot \\nabla_{\\boldsymbol{Z}}$。在 $\\delta f$（delta-f）粒子模拟（PIC, Particle-In-Cell）方法中，分布函数 $f$ 被分解为一个平衡部分 $f_{0}(\\boldsymbol{Z},t)$ 和一个微扰 $\\delta f(\\boldsymbol{Z},t)$，即 $f = f_{0} + \\delta f$。定义粒子权重 $w$ 为 $w \\equiv \\delta f / f_{0}$，并假设标记粒子沿着特征流 $\\dot{\\boldsymbol{Z}}(\\boldsymbol{Z},t)$ 推进，而 $f_{0}(\\boldsymbol{Z},t)$ 可能在空间和时间上具有大梯度。\n\n从无碰撞弗拉索夫方程和定义 $\\delta f = w f_{0}$ 出发，推导权重 $w$ 沿着标记粒子特征线的演化方程，该方程用 $\\ln f_{0}$ 的随体导数表示，并分析当 $D \\ln f_{0} / D t$ 的值很大时此演化的稳定性。特别地，明确展示 $w$ 的乘性放大是如何产生的，以及在 $|D \\ln f_{0} / D t|$ 很大时，在什么条件下会导致数值溢出。\n\n然后，提出对权重变量的一种归一化或重标度 $\\phi(w)$，使得重标度后变量的演化方程对 $D \\ln f_{0}/Dt$ 是线性的，并且不包含对 $w$ 的乘性依赖。通过要求重标度后变量沿着特征线的演化为 $D \\phi / D t = - D \\ln f_{0} / D t$ 且与 $w$ 无关来推导此 $\\phi(w)$，并选择积分常数使得 $\\phi(0) = 0$。将您的最终答案表示为 $\\phi(w)$ 的单个封闭形式解析表达式。无需进行数值舍入，最终答案也无需物理单位。",
            "solution": "用户提供了一个需要验证和解决的问题陈述。\n\n### 第1步：提取已知条件\n-   系统是一个由弗拉索夫方程描述的无碰撞等离子体。\n-   相空间坐标用 $\\boldsymbol{Z}$ 表示。\n-   特征流为 $\\dot{\\boldsymbol{Z}}(\\boldsymbol{Z}, t)$。\n-   弗拉索夫方程为 $\\frac{D f}{D t} = 0$。\n-   沿特征线的随体导数为 $D/Dt \\equiv \\partial/\\partial t + \\dot{\\boldsymbol{Z}} \\cdot \\nabla_{\\boldsymbol{Z}}$。\n-   分布函数 $f$ 分解为 $f = f_{0} + \\delta f$，其中 $f_0$ 是平衡部分，$\\delta f$ 是微扰。\n-   粒子权重 $w$ 定义为 $w \\equiv \\frac{\\delta f}{f_{0}}$。\n-   标记粒子（计算粒子）沿特征流 $\\dot{\\boldsymbol{Z}}(\\boldsymbol{Z}, t)$ 推进。\n-   $f_{0}(\\boldsymbol{Z}, t)$ 在空间和时间上可能具有大梯度。\n-   **任务1：**推导 $w$ 沿标记粒子特征线的演化方程，用 $\\frac{D \\ln f_{0}}{D t}$ 表示。\n-   **任务2：**分析此方程的稳定性，展示 $w$ 的乘性放大是如何产生的，尤其是在 $|\\frac{D \\ln f_{0}}{D t}|$ 很大时。\n-   **任务3：**提出一个重标度 $\\phi(w)$，使其演化方程为 $\\frac{D \\phi}{D t} = - \\frac{D \\ln f_{0}}{D t}$，且与 $w$ 无关。\n-   **任务4：**使用积分常数条件 $\\phi(0) = 0$ 确定 $\\phi(w)$ 的具体形式。\n-   **最终答案要求：**$\\phi(w)$ 的单个封闭形式解析表达式。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据：**该问题牢固地植根于等离子体动理学理论和计算物理学的原理。弗拉索夫方程、$\\delta f$ 方法以及粒子权重的概念是该领域的标准和基础。由大背景梯度引起的数值不稳定性问题（“抵消问题”）是 $\\delta f$ 模拟中一个众所周知且关键的研究课题。该问题在科学上是有效且符合实际的。\n-   **适定性：**该问题结构清晰，包含一系列的推导和分析。它提供了所有必要的定义和一个带有边界条件的特定微分方程来求解函数 $\\phi(w)$，从而确保存在唯一且有意义的解。\n-   **客观性：**该问题使用精确、正式且无偏见的科学语言陈述。没有主观或模棱两可的术语。\n-   **结论：**该问题不违反任何无效标准。它在科学上是合理的、适定的、客观的、完整的，并提出了一个对其指定的计算聚变科学领域至关重要的非平凡问题。\n\n### 第3步：裁定与行动\n问题是**有效**的。将提供完整解答。\n\n### 解答推导\n\n分析始于无碰撞弗拉索夫方程，该方程指出总分布函数 $f$ 沿着相空间中的特征轨迹是守恒的：\n$$\n\\frac{D f}{D t} = 0\n$$\n分布函数 $f$ 分解为一个已知的、大的背景或平衡部分 $f_0$ 和一个小的微扰 $\\delta f$：\n$$\nf(\\boldsymbol{Z}, t) = f_0(\\boldsymbol{Z}, t) + \\delta f(\\boldsymbol{Z}, t)\n$$\n将此分解代入弗拉索夫方程，并利用随体导数算子的线性性质，可得：\n$$\n\\frac{D}{D t} (f_0 + \\delta f) = \\frac{D f_0}{D t} + \\frac{D \\delta f}{D t} = 0\n$$\n这就得出了微扰 $\\delta f$ 的演化方程：\n$$\n\\frac{D \\delta f}{D t} = - \\frac{D f_0}{D t}\n$$\n粒子权重 $w$ 定义为微扰与背景分布的比值，即 $w \\equiv \\frac{\\delta f}{f_0}$。这意味着 $\\delta f = w f_0$。我们将此定义代入 $\\delta f$ 的演化方程：\n$$\n\\frac{D (w f_0)}{D t} = - \\frac{D f_0}{D t}\n$$\n对左侧应用随体导数的乘积法则，我们得到：\n$$\n\\left(\\frac{D w}{D t}\\right) f_0 + w \\left(\\frac{D f_0}{D t}\\right) = - \\frac{D f_0}{D t}\n$$\n为了求解 $\\frac{D w}{D t}$，我们首先重新整理方程：\n$$\n\\left(\\frac{D w}{D t}\\right) f_0 = - \\frac{D f_0}{D t} - w \\left(\\frac{D f_0}{D t}\\right) = - (1 + w) \\left(\\frac{D f_0}{D t}\\right)\n$$\n假设 $f_0 \\neq 0$，这对于表示一个物理分布是必须成立的，我们可以两边同除以 $f_0$：\n$$\n\\frac{D w}{D t} = - (1 + w) \\left(\\frac{1}{f_0} \\frac{D f_0}{D t}\\right)\n$$\n使用导数的链式法则，我们知道 $\\frac{d(\\ln x)}{dt} = \\frac{1}{x} \\frac{dx}{dt}$。将其应用于随体导数，我们有 $\\frac{D \\ln f_0}{Dt} = \\frac{1}{f_0} \\frac{D f_0}{Dt}$。将此代入 $\\frac{D w}{D t}$ 的方程，我们便得到了所需的权重 $w$ 的演化方程：\n$$\n\\frac{D w}{D t} = - (1 + w) \\frac{D \\ln f_0}{D t}\n$$\n这就完成了问题的第一部分。\n\n对于第二部分，我们分析此方程的稳定性。让我们用 $G(t) = \\frac{D \\ln f_0}{D t}$ 表示沿标记粒子轨迹计算的值。方程为 $\\frac{D w}{D t} = - (1 + w) G(t)$。将其展开得到：\n$$\n\\frac{D w}{D t} = -G(t) - w G(t)\n$$\n项 $-w G(t)$ 表明，权重的变化率 $\\frac{D w}{D t}$ 本身依赖于权重的当前值 $w$。这是一种乘性关系。如果 $|G(t)| = |\\frac{D \\ln f_0}{D t}|$ 很大，这一项可能导致数值不稳定性。具体来说，如果 $G(t)$ 是一个大的负数，比如 $G(t) = -A$，其中 $A  0$ 是一个大常数，则方程变为 $\\frac{D w}{D t} \\approx A w$。这是指数增长的典型方程，$w(t) \\propto \\exp(At)$。权重 $w$ 会指数级快速增长，导致其值变得非常大，可能超出计算机的浮点数表示范围，从而引起数值溢出。标记粒子权重的这种乘性放大是 $\\delta f$ 模拟中的一个重大数值挑战，尤其是在背景分布 $f_0$ 沿着粒子路径快速变化的区域（例如，陡峭的密度或温度梯度区域）。\n\n为解决此不稳定性，问题的第三部分要求进行变量替换，从 $w$ 变为一个新变量 $\\phi(w)$，使其演化是线性的并且不含此乘性项。为 $\\phi$ 指定的演化方程是：\n$$\n\\frac{D \\phi}{D t} = - \\frac{D \\ln f_0}{D t}\n$$\n为了求出函数 $\\phi(w)$，我们使用链式法则将 $\\phi$ 的时间导数与 $w$ 的时间导数联系起来：\n$$\n\\frac{D \\phi}{D t} = \\frac{d \\phi}{d w} \\frac{D w}{D t}\n$$\n现在我们代入已有的 $\\frac{D \\phi}{D t}$ 和 $\\frac{D w}{D t}$ 的表达式：\n$$\n- \\frac{D \\ln f_0}{D t} = \\frac{d \\phi}{d w} \\left[ - (1 + w) \\frac{D \\ln f_0}{D t} \\right]\n$$\n对于非平凡演化（即 $\\frac{D \\ln f_0}{D t} \\neq 0$），我们可以从方程两边消去 $-\\frac{D \\ln f_0}{D t}$ 项。这就留下一个关于 $\\phi$ 作为 $w$ 的函数的简单常微分方程：\n$$\n1 = \\frac{d \\phi}{d w} (1 + w)\n$$\n求解 $\\frac{d \\phi}{d w}$ 可得：\n$$\n\\frac{d \\phi}{d w} = \\frac{1}{1 + w}\n$$\n为了求出 $\\phi(w)$，我们将此表达式对 $w$ 积分：\n$$\n\\phi(w) = \\int \\frac{1}{1 + w} dw = \\ln|1 + w| + C\n$$\n其中 $C$ 是积分常数。由于 $f = f_0 + \\delta f = f_0(1+w)$ 必须是一个非负分布函数，且 $f_0$ 通常是一个正函数（如麦克斯韦分布），因此要求 $1+w \\geq 0$。我们在 $1+w  0$ 的定义域内操作，因此可以去掉绝对值符号：\n$$\n\\phi(w) = \\ln(1 + w) + C\n$$\n问题指定了条件 $\\phi(0) = 0$ 来确定常数 $C$。应用此条件：\n$$\n\\phi(0) = \\ln(1 + 0) + C = \\ln(1) + C = 0 + C\n$$\n因此，我们得到 $C = 0$。重标度后变量的最终表达式为：\n$$\n\\phi(w) = \\ln(1 + w)\n$$\n这个变量 $\\phi$ 根据 $\\frac{D \\phi}{D t} = - \\frac{D \\ln f_0}{D t}$ 演化，该方程是稳定的，因为右侧纯粹是一个源项，与 $\\phi$ 本身无关。$\\phi$ 的演化可以通过简单地沿着特征线对源项进行积分得到。",
            "answer": "$$\\boxed{\\ln(1+w)}$$"
        }
    ]
}