{
    "hands_on_practices": [
        {
            "introduction": "Before embarking on a complex simulation, a crucial first step is to estimate the computational resources required. This practical exercise demonstrates how to calculate the memory footprint for a high-dimensional Eulerian Vlasov simulation, translating grid parameters directly into hardware needs. This provides a tangible sense of the \"curse of dimensionality\" that is a central challenge in kinetic modeling .",
            "id": "3986987",
            "problem": "A grid-based Eulerian solver for the Vlasov equation is used to evolve a distribution function in two-dimensional physical space and two-dimensional velocity space (2D2V). The distribution function $f(x,y,v_x,v_y)$ is represented on a uniform Cartesian grid as a single contiguous array of shape $(N_x,N_y,N_{v_x},N_{v_y})$. Electrostatic fields are represented by a scalar potential $\\phi(x,y)$ and electric field components $E_x(x,y)$ and $E_y(x,y)$, each stored on the same configuration-space grid $(N_x,N_y)$. All arrays are stored in double precision (binary64), with exactly $8$ bytes per stored scalar. Assume no ghost cells, no padding, one copy per array, and neglect any additional temporary work arrays.\n\nUse the fundamental definitions that the number of discrete cells equals the product of the grid extents and that a gibibyte (GiB) equals $2^{30}$ bytes to compute the following for the specific grid sizes $N_x = 256$, $N_y = 256$, $N_{v_x} = 128$, and $N_{v_y} = 128$:\n- The total number of discrete phase-space cells for $f$.\n- The total memory footprint for the combined storage of $f$, $\\phi$, $E_x$, and $E_y$, expressed in gibibytes (GiB).\n\nRound the memory value to four significant figures. Express the final answer in GiB. Provide as your final reported value only the total memory footprint in GiB rounded as specified.",
            "solution": "The Eulerian representation of the distribution function $f(x,y,v_x,v_y)$ on a uniform Cartesian grid results in a discrete set of phase-space cells whose total count is the product of the grid extents. Using the given sizes, the number of cells is\n$$\nN_{\\text{cells}} = N_x N_y N_{v_x} N_{v_y} = 256 \\times 256 \\times 128 \\times 128.\n$$\nRecognizing that $256 = 2^{8}$ and $128 = 2^{7}$, we obtain\n$$\nN_{\\text{cells}} = 2^{8} \\times 2^{8} \\times 2^{7} \\times 2^{7} = 2^{30}.\n$$\nEach stored scalar is double precision with $8$ bytes. Therefore, the memory required for $f$ is\n$$\nM_f = N_{\\text{cells}} \\times 8 \\;\\text{bytes} = 2^{30} \\times 8 \\;\\text{bytes} = 8 \\times 2^{30} \\;\\text{bytes}.\n$$\nNext, consider the electrostatic field storage on the configuration-space grid $(N_x,N_y)$. The scalar potential $\\phi$ is one array of size $N_x N_y$, and the electric field has two components $E_x$ and $E_y$, giving a total of $3$ arrays of size $N_x N_y$. Thus, the number of stored scalars for the fields is\n$$\nN_{\\text{field, scalars}} = 3 \\times N_x N_y = 3 \\times (256 \\times 256) = 3 \\times 65536 = 196608.\n$$\nThe corresponding memory in bytes is\n$$\nM_{\\text{fields}} = N_{\\text{field, scalars}} \\times 8 \\;\\text{bytes} = 196608 \\times 8 \\;\\text{bytes} = 1572864 \\;\\text{bytes}.\n$$\nThe total memory footprint (distribution plus fields) is\n$$\nM_{\\text{total, bytes}} = M_f + M_{\\text{fields}} = \\left(8 \\times 2^{30}\\right) + 1572864 \\;\\text{bytes}.\n$$\nTo express this in gibibytes (GiB), recall that $1$ GiB $= 2^{30}$ bytes. Therefore,\n$$\nM_{\\text{total, GiB}} = \\frac{M_{\\text{total, bytes}}}{2^{30}} = \\frac{8 \\times 2^{30}}{2^{30}} + \\frac{1572864}{2^{30}} = 8 + \\frac{1572864}{1073741824}.\n$$\nCompute the fractional term exactly:\n$$\n\\frac{1572864}{1073741824} = 0.00146484375.\n$$\nHence,\n$$\nM_{\\text{total, GiB}} = 8 + 0.00146484375 = 8.00146484375.\n$$\nRounding to four significant figures yields\n$$\nM_{\\text{total, GiB}} \\approx 8.001.\n$$\nThus, the total number of discrete phase-space cells is $2^{30}$, and the requested total memory footprint in gibibytes is $8.001$ GiB to four significant figures. The final reported value should be the memory footprint in GiB as specified.",
            "answer": "$$\\boxed{8.001}$$"
        },
        {
            "introduction": "With the scale of the simulation established, the next critical step is to select numerical parameters that ensure a stable and physically meaningful result. This practice explores the constraints on the time step $\\Delta t$ in a Vlasov-Poisson simulation, revealing the interplay between resolving the fastest physical timescale—the plasma frequency $\\omega_p$—and satisfying the stability criteria of the numerical time-integration scheme .",
            "id": "3987008",
            "problem": "Consider an electrostatic, one-dimensional Vlasov–Poisson system for electrons with charge $-e$ and mass $m_e$ in the presence of a uniform, immobile ion background of number density $n_0$. The electron distribution function $f(x,v,t)$ evolves according to the Vlasov equation\n$$\n\\partial_t f + v\\,\\partial_x f - \\frac{e}{m_e} E(x,t)\\,\\partial_v f = 0,\n$$\nand the electric field $E(x,t)$ is obtained at each time step from the electrostatic potential $\\phi(x,t)$ via Poisson’s equation,\n$$\n-\\partial_x^2 \\phi = \\frac{\\rho(x,t)}{\\varepsilon_0}, \\quad E = -\\partial_x \\phi, \\quad \\rho(x,t) = e\\,n_i(x,t) - e \\int_{-\\infty}^{\\infty} f(x,v,t)\\,dv,\n$$\nwhere $\\varepsilon_0$ is the vacuum permittivity and ions are fixed so that $n_i(x,t) = n_0$. A grid-based Eulerian algorithm advances time with a centered, second-order explicit scheme (a leapfrog-type update for the characteristic dynamics of $f$), and computes $E$ from Poisson’s equation using the charge density at each step. You are asked to determine the constraint on the time step $\\Delta t$ required to both temporally resolve the natural plasma oscillation and to maintain linear stability of the field evolution implied by the Vlasov–Poisson coupling in the cold-electron limit.\n\nStart from appropriate governing conservation laws and constitutive relations for small-amplitude perturbations about the spatially uniform equilibrium, and show that the discrete, centered-in-time update for the electric field is subject to a stability limit that depends on the electron plasma frequency $\\omega_p$. For temporal resolution, suppose the algorithm design requirement is to have at least $M$ samples per period of the dominant electrostatic plasma oscillation. No additional information about spatial discretization or velocity-space resolution is needed for this question. Based on these considerations, which of the following constraints on $\\Delta t$ correctly enforces both linear stability and temporal resolution in terms of $\\omega_p$ and $M$?\n\nA. $\\Delta t \\le \\min\\!\\left(\\dfrac{2}{\\omega_p},\\,\\dfrac{2\\pi}{M\\,\\omega_p}\\right)$\n\nB. $\\Delta t \\le \\dfrac{2\\pi}{M\\,\\omega_p}$\n\nC. $\\Delta t \\le \\dfrac{2}{\\omega_p}$\n\nD. $\\Delta t \\ge \\min\\!\\left(\\dfrac{2}{\\omega_p},\\,\\dfrac{2\\pi}{M\\,\\omega_p}\\right)$\n\nHere $\\omega_p$ denotes the electron plasma frequency, defined by fundamental plasma parameters, and $M$ is a prescribed positive integer that quantifies the desired number of temporal samples per plasma period. The focus is specifically on the plasma-oscillation timescale and the stability of the centered-in-time field update implied by the Vlasov–Poisson coupling; any Courant–Friedrichs–Lewy (CFL) conditions associated with phase-space advection can be ignored for the purpose of this question.",
            "solution": "The problem statement is critically validated before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **System**: Electrostatic, one-dimensional Vlasov–Poisson system for electrons.\n- **Electron parameters**: charge $-e$, mass $m_e$.\n- **Ion background**: Uniform, immobile, number density $n_0$.\n- **Vlasov equation**: $\\partial_t f + v\\,\\partial_x f - \\frac{e}{m_e} E(x,t)\\,\\partial_v f = 0$.\n- **Poisson's equation**: $-\\partial_x^2 \\phi = \\frac{\\rho(x,t)}{\\varepsilon_0}$.\n- **Electric field definition**: $E = -\\partial_x \\phi$.\n- **Charge density**: $\\rho(x,t) = e\\,n_i(x,t) - e \\int_{-\\infty}^{\\infty} f(x,v,t)\\,dv$.\n- **Ion density**: $n_i(x,t) = n_0$.\n- **Numerical algorithm**:\n  - Grid-based Eulerian.\n  - Time advance: Centered, second-order explicit scheme (leapfrog-type).\n  - $E$ is computed from Poisson’s equation at each step.\n- **Objective**: Determine the constraint on the time step $\\Delta t$ to satisfy two conditions:\n  1. **Temporal resolution**: At least $M$ samples per period of the dominant electrostatic plasma oscillation.\n  2. **Linear stability**: Stability of the field evolution from the Vlasov–Poisson coupling in the cold-electron limit.\n- **Assumptions/Simplifications**:\n  - Analysis is for small-amplitude perturbations about a uniform equilibrium.\n  - The analysis should be performed in the cold-electron limit.\n  - Courant–Friedrichs–Lewy (CFL) conditions associated with phase-space advection are to be ignored.\n- **Parameters**: $\\omega_p$ (electron plasma frequency), $M$ (positive integer samples per period).\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the Vlasov-Poisson equations, which are a fundamental model in plasma physics. The analysis of plasma oscillations, numerical stability of leapfrog schemes, and temporal resolution are all standard, well-established concepts in computational plasma physics.\n- **Well-Posed**: The problem is well-posed. It asks for a stability and resolution constraint on the time step $\\Delta t$ for a specific numerical method applied to a well-defined physical system. The use of the cold-electron limit and the instruction to ignore other CFL conditions appropriately focuses the problem on a specific, solvable aspect of the numerical scheme. A unique, meaningful answer is expected.\n- **Objective**: The problem is stated in precise, objective, and technical language. There are no subjective or ambiguous terms.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. It is scientifically sound, well-posed, and objective. A solution will be derived.\n\n### Derivation\n\nThe problem requires us to find a single constraint on the time step $\\Delta t$ that satisfies both a numerical stability limit and a temporal resolution requirement. We will derive each constraint separately and then combine them.\n\n**1. Linear Stability Constraint**\n\nWe are asked to consider the linear stability of the field evolution in the cold-electron limit. We begin by linearizing the fluid equations that can be derived as moments of the Vlasov equation. The equilibrium state is a uniform, neutral plasma with electron density $n_e = n_0$, mean velocity $u_e = 0$, and electric field $E = 0$. We introduce small perturbations: $n_e(x,t) = n_0 + n_1(x,t)$, $u_e(x,t) = u_1(x,t)$, and $E(x,t) = E_1(x,t)$.\n\nThe cold-electron fluid equations are the continuity and momentum equations, which are moments of the Vlasov equation with the pressure term neglected.\n- **Continuity equation**: $\\partial_t n_e + \\partial_x (n_e u_e) = 0$.\n- **Momentum equation**: $m_e (\\partial_t u_e + u_e \\partial_x u_e) = -e E$.\n\nLinearizing these equations around the equilibrium state gives:\n1. $\\partial_t n_1 + n_0 \\partial_x u_1 = 0$\n2. $m_e \\partial_t u_1 = -e E_1$\n\nThese are coupled through Poisson's equation. For the perturbations, Poisson's equation is $\\partial_x E_1 = \\rho_1 / \\varepsilon_0$. The charge density perturbation is $\\rho_1 = e n_{i,1} - e n_{e,1}$. Since ions are a fixed background, $n_{i,1} = 0$, so $\\rho_1 = -e n_1$.\n3. $\\partial_x E_1 = - \\frac{e}{\\varepsilon_0} n_1$\n\nTo find the time evolution of the system, we combine these three linearized equations. Take the time derivative of the continuity equation (1):\n$$\n\\partial_t^2 n_1 + n_0 \\partial_x (\\partial_t u_1) = 0\n$$\nSubstitute $\\partial_t u_1$ from the momentum equation (2):\n$$\n\\partial_t^2 n_1 + n_0 \\partial_x \\left( -\\frac{e}{m_e} E_1 \\right) = 0 \\implies \\partial_t^2 n_1 - \\frac{e n_0}{m_e} \\partial_x E_1 = 0\n$$\nSubstitute $\\partial_x E_1$ from Poisson's equation (3):\n$$\n\\partial_t^2 n_1 - \\frac{e n_0}{m_e} \\left( - \\frac{e}{\\varepsilon_0} n_1 \\right) = 0\n$$\n$$\n\\partial_t^2 n_1 + \\left( \\frac{n_0 e^2}{m_e \\varepsilon_0} \\right) n_1 = 0\n$$\nThis is the equation for a simple harmonic oscillator. The term in parenthesis is the square of the electron plasma frequency, $\\omega_p^2 = \\frac{n_0 e^2}{m_e \\varepsilon_0}$. So, the governing equation for density perturbations is $\\partial_t^2 n_1 + \\omega_p^2 n_1 = 0$.\nSince $E_1$ is linearly related to $n_1$ (via integration of Poisson's equation), the electric field perturbation also obeys this oscillation equation:\n$$\n\\partial_t^2 E_1 + \\omega_p^2 E_1 = 0\n$$\nThe problem states that a centered, second-order explicit scheme (leapfrog) is used. We discretize the second time derivative using a centered difference formula:\n$$\n\\frac{E^{n+1} - 2E^n + E^{n-1}}{(\\Delta t)^2} + \\omega_p^2 E^n = 0\n$$\nwhere $E^k$ denotes the field at time $t_k = k \\Delta t$. This is a linear recurrence relation for the electric field:\n$$\nE^{n+1} = (2 - \\omega_p^2 (\\Delta t)^2) E^n - E^{n-1}\n$$\nTo analyze the stability, we assume a solution of the form $E^n = g^n E^0$, where $g$ is the amplification factor. Substituting this into the recurrence yields the characteristic equation for $g$:\n$$\ng^2 - (2 - \\omega_p^2 (\\Delta t)^2) g + 1 = 0\n$$\nFor the numerical scheme to be stable, the solutions for $g$ must not have a magnitude greater than $1$, i.e., $|g| \\le 1$. The roots of this quadratic equation are:\n$$\ng = \\frac{(2 - \\omega_p^2 (\\Delta t)^2) \\pm \\sqrt{(2 - \\omega_p^2 (\\Delta t)^2)^2 - 4}}{2}\n$$\nThe scheme is stable if the roots are complex conjugates of magnitude $1$, which occurs when the discriminant is non-positive:\n$$\n(2 - \\omega_p^2 (\\Delta t)^2)^2 - 4 \\le 0\n$$\n$$\n(2 - \\omega_p^2 (\\Delta t)^2)^2 \\le 4\n$$\nTaking the square root of both sides gives:\n$$\n|2 - \\omega_p^2 (\\Delta t)^2| \\le 2\n$$\nThis inequality is equivalent to $-2 \\le 2 - \\omega_p^2 (\\Delta t)^2 \\le 2$.\nThe right-hand side, $2 - \\omega_p^2 (\\Delta t)^2 \\le 2$, implies $-\\omega_p^2 (\\Delta t)^2 \\le 0$, which is always true.\nThe left-hand side, $-2 \\le 2 - \\omega_p^2 (\\Delta t)^2$, implies $\\omega_p^2 (\\Delta t)^2 \\le 4$.\nSince $\\omega_p$ and $\\Delta t$ are positive, this gives:\n$$\n\\omega_p \\Delta t \\le 2 \\implies \\Delta t \\le \\frac{2}{\\omega_p}\n$$\nThis is the numerical stability constraint for the centered-difference time integration of plasma oscillations.\n\n**2. Temporal Resolution Constraint**\n\nThe problem requires that the simulation must have at least $M$ samples (time steps) per period of the dominant plasma oscillation. The angular frequency of this oscillation is $\\omega_p$. The period is $T_p = \\frac{2\\pi}{\\omega_p}$.\nThe number of time steps in one period is given by $N_{samples} = \\frac{T_p}{\\Delta t}$. The constraint is $N_{samples} \\ge M$.\n$$\n\\frac{T_p}{\\Delta t} \\ge M \\implies \\frac{2\\pi / \\omega_p}{\\Delta t} \\ge M\n$$\nSolving for $\\Delta t$ gives the resolution constraint:\n$$\n\\Delta t \\le \\frac{2\\pi}{M \\omega_p}\n$$\n\n**3. Combined Constraint**\n\nThe time step $\\Delta t$ must satisfy both the stability constraint and the resolution constraint simultaneously. Therefore, $\\Delta t$ must be less than or equal to both upper bounds. This is expressed using the minimum function:\n$$\n\\Delta t \\le \\min\\left( \\frac{2}{\\omega_p}, \\frac{2\\pi}{M \\omega_p} \\right)\n$$\n\n### Option-by-Option Analysis\n\nBased on the derived combined constraint, we evaluate the given options.\n\n**A. $\\Delta t \\le \\min\\!\\left(\\dfrac{2}{\\omega_p},\\,\\dfrac{2\\pi}{M\\,\\omega_p}\\right)$**\nThis expression perfectly matches our derived result. It correctly incorporates the stability limit ($\\Delta t \\le 2/\\omega_p$) and the temporal resolution limit ($\\Delta t \\le 2\\pi/(M\\omega_p)$). The choice of the minimum of the two values ensures that the stricter of the two conditions is always met.\n**Verdict: Correct.**\n\n**B. $\\Delta t \\le \\dfrac{2\\pi}{M\\,\\omega_p}$**\nThis is only the temporal resolution constraint. It neglects the numerical stability constraint. For a small number of samples per period, for instance $M=1$ or $M=2$, we have $2\\pi/M > 2$. In this case, the stability criterion $\\Delta t \\le 2/\\omega_p$ would be the more restrictive one and would be violated if one only followed this option's constraint. Therefore, this option is incomplete.\n**Verdict: Incorrect.**\n\n**C. $\\Delta t \\le \\dfrac{2}{\\omega_p}$**\nThis is only the numerical stability constraint. It neglects the temporal resolution requirement. For physically meaningful simulations, one typically wants good resolution, e.g., $M \\ge 10$. Since $2\\pi \\approx 6.28$, if $M > \\pi$, the resolution constraint $\\Delta t \\le 2\\pi/(M\\omega_p)$ becomes more restrictive than the stability constraint. This option fails to enforce the required resolution in such common cases. Therefore, this option is incomplete.\n**Verdict: Incorrect.**\n\n**D. $\\Delta t \\ge \\min\\!\\left(\\dfrac{2}{\\omega_p},\\,\\dfrac{2\\pi}{M\\,\\omega_p}\\right)$**\nThis option uses the wrong inequality sign. Both stability and resolution impose an upper bound on $\\Delta t$, requiring it to be *less than or equal to* some value. A time step that is too large leads to instability or poor resolution. This constraint suggests choosing a large time step, which is fundamentally wrong.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "The final and most comprehensive practice is to construct and validate a complete Vlasov-Poisson solver. This exercise guides you through the implementation of a 1D1V code, applying a semi-Lagrangian algorithm and a spectral Poisson solver. To verify the correctness of your implementation, you will track the total energy of the simulated system, a fundamental conserved quantity whose numerical preservation serves as a powerful diagnostic of the solver's accuracy .",
            "id": "3987034",
            "problem": "Consider a one-dimensional, electrostatic, collisionless plasma described by the Vlasov–Poisson system in a periodic domain. Let $x \\in [0,L]$ be the spatial coordinate and $v \\in \\mathbb{R}$ the velocity coordinate. The phase-space distribution function $f(x,v,t)$ evolves according to the Vlasov equation\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + a(x,t)\\frac{\\partial f}{\\partial v} = 0,\n$$\nwhere the acceleration is given by $a(x,t) = E(x,t)$ in non-dimensional units (electron mass and charge equal to unity), and the electric field $E(x,t)$ satisfies the Poisson equation\n$$\n\\frac{\\partial^2 \\phi}{\\partial x^2} = -\\big(\\rho(x,t) - \\rho_0\\big), \\quad E(x,t) = -\\frac{\\partial \\phi}{\\partial x}, \\quad \\rho(x,t) = \\int_{-\\infty}^{\\infty} f(x,v,t)\\, dv,\n$$\nwith a uniform, neutralizing background density $\\rho_0$ equal to the spatial average of $\\rho(x,t)$ so that total net charge in the periodic domain is zero. The total energy of the continuous system,\n$$\n\\mathcal{E}(t) = \\underbrace{\\frac{1}{2}\\int_0^L \\int_{-\\infty}^{\\infty} v^2 f(x,v,t)\\, dv\\, dx}_{\\text{kinetic energy}} + \\underbrace{\\frac{1}{2}\\int_0^L E(x,t)^2\\, dx}_{\\text{field energy}},\n$$\nis conserved in time for exact solutions.\n\nYour task is to implement a grid-based Eulerian solver for the Vlasov–Poisson system using a Strang-splitting semi-Lagrangian approach in one spatial dimension and one velocity dimension, with a spectral (Fast Fourier Transform) Poisson solver and periodic boundary conditions in $x$. The solver must compute a time-resolved energy budget separating kinetic and field energies and verify that the total energy remains approximately constant up to discretization error. Use non-dimensional variables and express all angles in radians. The spatial domain length is $L = 2\\pi$, and the initial condition is a spatially modulated Maxwellian,\n$$\nf(x,v,0) = \\frac{1}{\\sqrt{2\\pi} v_{\\mathrm{th}}}\\exp\\!\\left(-\\frac{v^2}{2 v_{\\mathrm{th}}^2}\\right)\\left[1 + \\alpha \\cos(k x)\\right],\n$$\nwith thermal speed $v_{\\mathrm{th}} = 1$, perturbation amplitude $\\alpha > 0$, and wavenumber $k = 1$.\n\nDiscretize the phase space uniformly: $x_i = i\\, \\Delta x$ for $i=0,\\dots,N_x-1$, with $\\Delta x = L/N_x$, and $v_j = v_{\\min} + j\\, \\Delta v$ for $j=0,\\dots,N_v-1$, with $v_{\\min} = -v_{\\max}$, $v_{\\max} > 0$, and $\\Delta v = (2 v_{\\max})/N_v$. Use periodic boundary conditions in $x$ and non-periodic clamped boundaries in $v$ where the semi-Lagrangian interpolation samples outside the velocity grid. Compute the charge density by numerical quadrature as $\\rho(x_i,t) \\approx \\sum_{j=0}^{N_v-1} f(x_i,v_j,t)\\, \\Delta v$, subtract its spatial average to enforce neutrality, solve Poisson’s equation spectrally with $\\phi_k = -\\rho_k/k^2$ for $k \\neq 0$ and $\\phi_{k=0} = 0$, and compute $E$ via $E_k = -\\mathrm{i} k \\phi_k$ and inverse transform to $x$ space. The semi-Lagrangian Strang splitting for a time step $\\Delta t$ should be\n$$\nf^{(1)}(x,v) = f\\big(x - v \\tfrac{\\Delta t}{2}, v, t\\big), \\quad\nf^{(2)}(x,v) = f^{(1)}\\big(x, v - E(x,t+\\tfrac{\\Delta t}{2}) \\Delta t\\big), \\quad\nf^{\\text{new}}(x,v) = f^{(2)}\\big(x - v \\tfrac{\\Delta t}{2}, v\\big),\n$$\nimplemented with linear interpolation on the $x$ and $v$ grids as described above.\n\nDefine the discrete kinetic energy at time $t_n$ by\n$$\nK_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_v-1} v_j^2 f(x_i,v_j,t_n)\\, \\Delta v\\, \\Delta x,\n$$\nand the discrete field energy by\n$$\nU_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1} E(x_i,t_n)^2\\, \\Delta x.\n$$\nThe discrete total energy is $E_n = K_n + U_n$. For each simulation, compute the maximum absolute relative deviation of $E_n$ from its initial value $E_0$ over the entire simulated time interval:\n$$\n\\delta = \\max_{n} \\left|\\frac{E_n - E_0}{E_0}\\right|.\n$$\nReport this quantity $\\delta$ as the scalar diagnostic for energy conservation (expressed as a decimal number, not a percentage).\n\nImplement your solver and evaluate it on the following test suite to assess energy conservation across different resolutions and time steps. Use $v_{\\mathrm{th}} = 1$, $k = 1$, $L = 2\\pi$, $v_{\\max} = 6$, and run for a final time $T$ given per case. For all cases, use angles in radians:\n\n- Case $1$: $N_x = 64$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.02$, $T = 0.5$.\n- Case $2$: $N_x = 32$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.05$, $T = 0.5$.\n- Case $3$: $N_x = 64$, $N_v = 32$, $\\alpha = 0.05$, $\\Delta t = 0.02$, $T = 0.5$.\n- Case $4$: $N_x = 64$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.005$, $T = 0.5$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$), where each entry equals the maximum absolute relative deviation $\\delta$ for the corresponding test case, expressed as a decimal number.",
            "solution": "The problem requires the implementation of a grid-based Eulerian solver for the one-dimensional Vlasov-Poisson system to study energy conservation. The chosen numerical method is a Strang-splitting semi-Lagrangian scheme with a spectral Poisson solver. We will first formalize the numerical algorithm and then implement it to evaluate its performance on the given test cases.\n\n### 1. Problem Formulation and Discretization\n\nThe Vlasov-Poisson system describes the evolution of the phase-space distribution function $f(x,v,t)$ of a collisionless plasma:\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + E(x,t)\\frac{\\partial f}{\\partial v} = 0\n$$\n$$\n\\frac{\\partial E}{\\partial x} = \\rho(x,t) - \\rho_0, \\quad \\rho(x,t) = \\int_{-\\infty}^{\\infty} f(x,v,t)\\, dv\n$$\nThe system is defined on a periodic spatial domain $x \\in [0,L]$ with $L=2\\pi$. The phase space is discretized on a uniform grid:\n- **Spatial grid**: $x_i = i \\Delta x$ for $i = 0, \\dots, N_x-1$, with grid spacing $\\Delta x = L/N_x$.\n- **Velocity grid**: $v_j = v_{\\min} + j \\Delta v$ for $j = 0, \\dots, N_v-1$, with $v_{\\min} = -v_{\\max}$ and $\\Delta v = (v_{\\max} - v_{\\min})/N_v = 2v_{\\max}/N_v$.\n\nThe distribution function is represented by its values on this grid, $f_{i,j}(t_n) \\approx f(x_i, v_j, t_n)$.\n\n### 2. The Strang-Splitting Semi-Lagrangian Method\n\nThe Vlasov equation is an advection equation in phase space. The Strang-splitting method decomposes the full time step $\\Delta t$ into a sequence of simpler advection steps, providing second-order accuracy in time. The operator $\\mathcal{L} = -v \\frac{\\partial}{\\partial x} - E(x,t) \\frac{\\partial}{\\partial v}$ is split into a spatial advection part $\\mathcal{L}_x = -v \\frac{\\partial}{\\partial x}$ and a velocity advection part $\\mathcal{L}_v = -E(x,t) \\frac{\\partial}{\\partial v}$. The evolution over one time step is approximated as:\n$$\nf(t+\\Delta t) \\approx e^{\\mathcal{L}_x \\Delta t/2} e^{\\mathcal{L}_v \\Delta t} e^{\\mathcal{L}_x \\Delta t/2} f(t)\n$$\nwhere the electric field $E$ in the velocity advection operator is evaluated at the midpoint of the time interval, $t + \\Delta t/2$. Each exponential operator corresponds to solving a pure advection equation for a specific duration. These are solved using a semi-Lagrangian approach.\n\n### 3. Algorithm for a Single Time Step\n\nGiven the distribution $f(t_n)$ at time $t_n$, we compute $f(t_{n+1})$ at $t_n + \\Delta t$ as follows:\n\n**Step 1: Spatial Advection for $\\Delta t/2$**\nWe solve $\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} = 0$ for a time $\\Delta t/2$. In the semi-Lagrangian method, we trace characteristics backward in time. For each grid point $(x_i, v_j)$, the value of the distribution function is updated by finding its value at the departure point $(x',v') = (x_i - v_j \\Delta t/2, v_j)$:\n$$\nf^{(1)}(x_i, v_j) = f(x_i - v_j \\Delta t/2, v_j, t_n)\n$$\nSince the departure point $x' = x_i - v_j \\Delta t/2$ generally does not lie on a grid point, the value is computed via linear interpolation using the values of $f(t_n)$ at the neighboring spatial grid points. Periodicity in $x$ is handled by wrapping indices around the domain.\n\n**Step 2: Velocity Advection for $\\Delta t$**\nThis step solves $\\frac{\\partial f}{\\partial t} + E(x, t_n+\\Delta t/2) \\frac{\\partial f}{\\partial v} = 0$ for a time $\\Delta t$. It requires the electric field at the half-time step, which is computed from the distribution function $f^{(1)}$ obtained in Step 1.\n\n**2a. Poisson Solver:**\nThe electric field $E(t_n+\\Delta t/2)$ is calculated from $f^{(1)}$:\n1.  **Compute charge density**: The integral for $\\rho$ is approximated by a sum over the discrete velocities:\n    $$\n    \\rho(x_i) = \\sum_{j=0}^{N_v-1} f^{(1)}(x_i, v_j) \\Delta v\n    $$\n2.  **Enforce neutrality**: The background density $\\rho_0$ is set to the spatial average of $\\rho(x_i)$, so we work with the net charge density $\\rho(x_i) - \\langle\\rho\\rangle$.\n3.  **Solve in Fourier space**: Poisson's equation, $\\frac{\\partial^2 \\phi}{\\partial x^2} = -(\\rho - \\rho_0)$, becomes an algebraic equation in Fourier space. Let $\\hat{\\rho}_k$ be the Discrete Fourier Transform (DFT) of the net charge density. The DFT of the potential is:\n    $$\n    \\hat{\\phi}_k = \\frac{-\\hat{\\rho}_k}{k^2} \\quad \\text{for } k \\neq 0\n    $$\n    Here, $k$ are the discrete wavenumbers corresponding to the spatial grid, given by $k_m = \\frac{2\\pi m}{L}$ for $m \\in \\{-N_x/2, \\dots, N_x/2-1\\}$. For the mean-free potential, we set $\\hat{\\phi}_{k=0} = 0$.\n4.  **Compute electric field**: The electric field $E = -\\frac{\\partial \\phi}{\\partial x}$ is computed in Fourier space as $\\hat{E}_k = -i k \\hat{\\phi}_k$. An inverse DFT then yields $E(x_i)$ in real space.\n\n**2b. Advect in Velocity:**\nWith the field $E(x_i)$ computed, we perform the semi-Lagrangian update for velocity advection:\n$$\nf^{(2)}(x_i, v_j) = f^{(1)}(x_i, v_j - E(x_i) \\Delta t)\n$$\nThe value is found by linear interpolation on the velocity grid using values from $f^{(1)}$. Since the velocity domain is bounded, if a departure point $v' = v_j - E(x_i) \\Delta t$ falls outside $[v_{\\min}, v_{\\max}]$, we use the value at the nearest boundary grid point (clamped boundary condition).\n\n**Step 3: Spatial Advection for $\\Delta t/2$**\nFinally, we perform another spatial advection step identical to Step 1, but applied to the distribution $f^{(2)}$ from Step 2:\n$$\nf(x_i, v_j, t_{n+1}) = f^{(2)}(x_i - v_j \\Delta t/2, v_j)\n$$\nThis completes the update for one time step.\n\n### 4. Energy Conservation Diagnostic\n\nTo verify the solver's accuracy, we monitor the total discrete energy, which should be conserved for the continuous system. At each time step $t_n$, we compute:\n- **Discrete Kinetic Energy**:\n$$\nK_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_v-1} v_j^2 f(x_i,v_j,t_n)\\, \\Delta v\\, \\Delta x\n$$\n- **Discrete Field Energy**:\n$$\nU_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1} E(x_i,t_n)^2\\, \\Delta x\n$$\nThe total energy is $E_n = K_n + U_n$. The diagnostic for conservation is the maximum absolute relative deviation from the initial energy $E_0$:\n$$\n\\delta = \\max_{n} \\left|\\frac{E_n - E_0}{E_0}\\right|\n$$\nA small value of $\\delta$ indicates a high-quality numerical solution. The implementation will proceed by coding these steps and running the specified test cases to compute $\\delta$ for each.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Vlasov-Poisson simulation for all test cases\n    and print the results in the specified format.\n    \"\"\"\n    \n    # Test cases defined in the problem statement.\n    # Format: (Nx, Nv, alpha, dt, T)\n    test_cases = [\n        (64, 64, 0.05, 0.02, 0.5),   # Case 1\n        (32, 64, 0.05, 0.05, 0.5),   # Case 2\n        (64, 32, 0.05, 0.02, 0.5),   # Case 3\n        (64, 64, 0.05, 0.005, 0.5),  # Case 4\n    ]\n\n    # Shared physical and simulation parameters.\n    v_th = 1.0\n    k_wave = 1.0\n    L = 2.0 * np.pi\n    v_max = 6.0\n    \n    results = []\n\n    def run_simulation(Nx, Nv, alpha, dt, T):\n        \"\"\"\n        Executes a single Vlasov-Poisson simulation for a given set of parameters.\n        \"\"\"\n        # --- 1. Grid and Initial Condition Setup ---\n        dx = L / Nx\n        x = np.arange(Nx) * dx\n        \n        dv = 2.0 * v_max / Nv\n        vmin = -v_max\n        v = vmin + np.arange(Nv) * dv\n\n        X, V = np.meshgrid(x, v, indexing='ij')\n\n        # Initial distribution function f(x, v, 0)\n        f = (1.0 / (np.sqrt(2 * np.pi) * v_th)) * \\\n            np.exp(-V**2 / (2.0 * v_th**2)) * \\\n            (1.0 + alpha * np.cos(k_wave * X))\n\n        # Fourier-space wavenumbers for the spectral Poisson solver\n        k_modes = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n        k_modes_sq_inv = np.zeros_like(k_modes)\n        nonzero_k = k_modes != 0\n        k_modes_sq_inv[nonzero_k] = 1.0 / k_modes[nonzero_k]**2\n        \n        # --- 2. Helper-Functions for Physics and Numerics ---\n\n        def advect_x(f_in, v_mesh, dt_step):\n            \"\"\"Performs semi-Lagrangian advection in the x-direction.\"\"\"\n            x_departure = np.arange(Nx)[:, np.newaxis] * dx - v_mesh * dt_step\n            x_indices = x_departure / dx\n            i_floor = np.floor(x_indices)\n            w = x_indices - i_floor\n            \n            i0 = i_floor.astype(int) % Nx\n            i1 = (i_floor.astype(int) + 1) % Nx\n            \n            # Using advanced indexing for vectorized interpolation\n            f_val0 = f_in[i0, np.arange(Nv)]\n            f_val1 = f_in[i1, np.arange(Nv)]\n\n            return f_val0 * (1.0 - w) + f_val1 * w\n\n        def advect_v(f_in, E_field, dt_step):\n            \"\"\"Performs semi-Lagrangian advection in the v-direction.\"\"\"\n            v_grid = vmin + np.arange(Nv) * dv\n            v_departure = v_grid[np.newaxis, :] - E_field[:, np.newaxis] * dt_step\n            \n            v_indices = (v_departure - vmin) / dv\n            j_floor = np.floor(v_indices)\n            w = v_indices - j_floor\n            \n            j0 = j_floor.astype(int)\n            j1 = j0 + 1\n            \n            # Clamp indices to handle boundaries\n            j0_c = np.clip(j0, 0, Nv - 1)\n            j1_c = np.clip(j1, 0, Nv - 1)\n\n            # Using advanced indexing for vectorized interpolation\n            f_val0 = f_in[np.arange(Nx)[:, np.newaxis], j0_c]\n            f_val1 = f_in[np.arange(Nx)[:, np.newaxis], j1_c]\n            \n            return f_val0 * (1.0 - w) + f_val1 * w\n\n        def solve_poisson(f_in):\n            \"\"\"Solves Poisson's equation using a spectral method.\"\"\"\n            rho = np.sum(f_in, axis=1) * dv\n            rho -= np.mean(rho)\n            \n            rho_k = np.fft.fft(rho)\n            \n            phi_k = -rho_k * k_modes_sq_inv\n            \n            E_k = -1j * k_modes * phi_k\n            return np.fft.ifft(E_k).real\n            \n        def calculate_energy(f_in, E_field):\n            \"\"\"Computes the total discrete energy (kinetic + field).\"\"\"\n            kinetic = 0.5 * np.sum(V**2 * f_in) * dx * dv\n            field = 0.5 * np.sum(E_field**2) * dx\n            return kinetic, field\n\n        # --- 3. Main Time Evolution Loop ---\n        \n        # Calculate initial energy\n        E = solve_poisson(f)\n        K0, U0 = calculate_energy(f, E)\n        E0 = K0 + U0\n        energy_history = [E0]\n        \n        num_steps = int(round(T / dt))\n        dt_half = dt / 2.0\n\n        for _ in range(num_steps):\n            # Strang splitting steps:\n            # Step 1: Advect x for dt/2\n            f = advect_x(f, V, dt_half)\n            \n            # Step 2: Compute E at t+dt/2 and advect v for dt\n            E = solve_poisson(f)\n            f = advect_v(f, E, dt)\n\n            # Step 3: Advect x for dt/2\n            f = advect_x(f, V, dt_half)\n\n            # Calculate energy at end of step for diagnostics\n            E_final = solve_poisson(f)\n            Kn, Un = calculate_energy(f, E_final)\n            energy_history.append(Kn + Un)\n\n        # --- 4. Post-processing and Result ---\n        energy_history = np.array(energy_history)\n        delta = np.max(np.abs((energy_history - E0) / E0))\n        return delta\n\n    # Run simulation for all test cases and collect results.\n    for case_params in test_cases:\n        delta = run_simulation(*case_params)\n        results.append(delta)\n\n    # Print the final output in the required format.\n    # Using a high precision format to avoid rounding issues.\n    print(f\"[{','.join(f'{res:.12f}' for res in results)}]\")\n\n# Execute the main function.\nsolve()\n```"
        }
    ]
}