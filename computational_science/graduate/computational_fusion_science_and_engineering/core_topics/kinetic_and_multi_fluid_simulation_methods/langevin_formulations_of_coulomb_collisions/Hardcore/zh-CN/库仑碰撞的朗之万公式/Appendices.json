{
    "hands_on_practices": [
        {
            "introduction": "简单地将随机微分方程离散化，尤其在使用像欧拉-丸山（Euler-Maruyama）这样的显式方法时，可能会引入一个微妙但严重的误差：数值加热。这个练习将探讨这种现象，即模拟的粒子系综会错误地松弛到一个高于背景等离子体真实温度的稳态温度。通过分析和量化这种能量偏差，你将学习如何构建和验证能够精确保持涨落-耗散平衡的数值方案，确保你的模拟在物理上是可靠的 。",
            "id": "4001111",
            "problem": "考虑一个质量为 $m$ 的测试粒子，沉浸在温度为 $T_\\mathrm{b}$ 的各向同性麦克斯韦背景中，并经历小角度库仑碰撞。在计算聚变科学与工程领域，一个广泛使用的简化模型是速度空间中库仑碰撞的朗之万表示，其中粒子速度的随机化由一个随机微分方程（SDE）来描述。假设以下物理上合理的依据，这对于背景被视为静态麦克斯韦分布时的小角度库仑碰撞是标准处理：\n\n- 测试粒子的速度 $\\mathbf{v}(t) \\in \\mathbb{R}^3$ 在速率为 $\\nu$ 的线性拖拽和与涨落-耗散关系一致的各向同性扩散作用下演化，使得稳态分布是麦克斯韦分布，其每个分量的方差等于 $k_\\mathrm{B} T_\\mathrm{b}/m$，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数。\n\n- 该连续时间模型是一个三维 Ornstein–Uhlenbeck 过程（OU），由具有上述物理参数的标准维纳过程驱动。\n\n你的任务是量化由基本显式时间离散化产生的数值加热效应，并从第一性原理出发，设计能够消除这种加热效应的无偏差替代方案或后处理方法：\n\n1. 从上述连续时间基础出发，推导时间步长为 $\\Delta t$ 的三维 OU 速度 SDE 的显式 Euler–Maruyama 离散化。然后，仅使用线性、各向同性和涨落-耗散关系，从第一性原理推导该离散格式预测的稳态均方速率 $S_\\infty = \\mathbb{E}\\left[\\,\\|\\mathbf{v}\\|^2\\,\\right]$ 的闭式表达式，该表达式是 $m$、$k_\\mathrm{B}$、$T_\\mathrm{b}$、$\\nu$ 和 $\\Delta t$ 的函数。由此，得到无量纲相对偏差 $R_\\mathrm{EM}(\\nu \\Delta t)$，其定义为 Euler–Maruyama 稳态均方速率与精确麦克斯韦值之比。将 $R_\\mathrm{EM}$ 严格地用无量纲参数 $a = \\nu \\Delta t$ 表示。\n\n2. 使用相同的基础，构建至少两种无偏差的替代方案，并通过追踪二阶矩来数学地证明其合理性：\n   - 通过在一个时间步长 $\\Delta t$ 上求解线性 SDE 得到的精确离散时间 OU 更新。\n   - 一种改进的显式 Euler–Maruyama 格式，通过调整每一步的噪声振幅来在离散时间内保持精确的麦克斯韦方差，同时保持相同的拖拽项。\n   可选地，提出一种在每个显式步骤后重新缩放速度以消除任何能量偏差的后处理操作，并证明它如何确保正确的二阶矩。\n\n3. 实现一个程序，对下面组中的每个测试用例，计算以下无量纲量：\n   - $R_\\mathrm{EM}$，第 1 部分中推导的 Euler–Maruyama 相对偏差。\n   - $R_\\mathrm{OU}$，第 2 部分中精确 OU 更新的相对偏差。\n   - $R_\\mathrm{bal}$，第 2 部分中带调整噪声的改进显式格式的相对偏差。\n   如果你提出了可选的后处理重缩放，可以在推导中对其进行评论，但无需将其包含在输出中。所有输出必须是无量纲浮点数，并四舍五入到 6 位小数。\n\n程序必须使用以下测试组。每个元组指定 $(m,\\;T_\\mathrm{b},\\;\\nu,\\;\\Delta t)$，其中 $m$ 的单位是 $\\mathrm{kg}$，$T_\\mathrm{b}$ 的单位是 $\\mathrm{K}$，$\\nu$ 的单位是 $\\mathrm{s}^{-1}$，$\\Delta t$ 的单位是 $\\mathrm{s}$：\n\n- 用例 1（理想路径）：$(3.345\\times 10^{-27},\\;1.16045\\times 10^{8},\\;1.0\\times 10^{5},\\;1.0\\times 10^{-6})$。\n- 用例 2（中等时间步长）：$(3.345\\times 10^{-27},\\;1.16045\\times 10^{8},\\;3.0\\times 10^{5},\\;2.0\\times 10^{-6})$。\n- 用例 3（接近稳定性边界）：$(3.345\\times 10^{-27},\\;1.16045\\times 10^{8},\\;1.0\\times 10^{5},\\;1.9\\times 10^{-5})$。\n- 用例 4（极小时间步长）：$(3.345\\times 10^{-27},\\;1.16045\\times 10^{8},\\;2.0\\times 10^{5},\\;5.0\\times 10^{-9})$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按用例和方法排序，格式为 $[R_\\mathrm{EM}^{(1)},R_\\mathrm{OU}^{(1)},R_\\mathrm{bal}^{(1)},R_\\mathrm{EM}^{(2)},R_\\mathrm{OU}^{(2)},R_\\mathrm{bal}^{(2)},R_\\mathrm{EM}^{(3)},R_\\mathrm{OU}^{(3)},R_\\mathrm{bal}^{(3)},R_\\mathrm{EM}^{(4)},R_\\mathrm{OU}^{(4)},R_\\mathrm{bal}^{(4)}]$。\n\n所有输出必须是无量纲浮点数，并四舍五入到 6 位小数。不应打印任何其他文本。请确保你的推导和数值设计具有科学真实性，并且除了所述的基础和 Ornstein–Uhlenbeck 过程及高斯白噪声的标准属性外，不要假设任何其他关系。",
            "solution": "所述问题在科学上是合理的、良定的，并包含了严谨求解所需的所有信息。这是计算统计力学和等离子体物理学领域一个标准但重要的练习。因此，我们可以进行推导和实现。\n\n该物理系统是一个质量为 $m$ 的测试粒子，处于温度为 $T_\\mathrm{b}$ 的热浴中。其速度 $\\mathbf{v}(t)$ 由三维 Ornstein-Uhlenbeck (OU) 过程控制，该过程模拟了线性拖拽和随机驱动力。相应的随机微分方程 (SDE) 是：\n$$d\\mathbf{v}(t) = -\\nu \\mathbf{v}(t) dt + \\sigma d\\mathbf{W}(t)$$\n在此，$\\nu$ 是代表拖拽的碰撞频率，$\\mathbf{W}(t)$ 是一个三维标准维纳过程，$\\sigma$ 是扩散系数。涨落-耗散定理规定了拖拽与扩散之间的关系，以确保系统弛豫到温度为 $T_\\mathrm{b}$ 的麦克斯韦分布。稳态速度分布是均值为 $\\mathbf{0}$、协方差为 $\\mathbb{E}[\\mathbf{v}\\mathbf{v}^T] = \\frac{k_\\mathrm{B} T_\\mathrm{b}}{m}\\mathbf{I}$ 的高斯分布，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数，$\\mathbf{I}$ 是单位矩阵。令 $V_{th}^2 = k_\\mathrm{B} T_\\mathrm{b}/m$ 为每个速度分量的方差。稳态协方差 $C = V_{th}^2 \\mathbf{I}$ 必须满足 OU 过程的连续李雅普诺夫方程 $-2\\nu C + \\sigma^2 \\mathbf{I} = 0$。代入 $C$，我们得到 $\\sigma^2 = 2\\nu V_{th}^2 = 2\\nu \\frac{k_\\mathrm{B} T_\\mathrm{b}}{m}$。\n\n精确的稳态均方速率，对应于平均动能，为 $S_{\\infty, \\text{exact}} = \\mathbb{E}[\\|\\mathbf{v}\\|^2] = \\mathbb{E}[v_x^2+v_y^2+v_z^2] = 3 V_{th}^2 = 3 \\frac{k_\\mathrm{B} T_\\mathrm{b}}{m}$。\n\n### 第 1 部分：Euler–Maruyama 离散化与数值加热\n\n该 SDE 使用时间步长为 $\\Delta t$ 的显式 Euler-Maruyama 格式进行离散化。第 $n+1$ 步的速度由第 $n$ 步的速度更新得到：\n$$\\mathbf{v}_{n+1} = \\mathbf{v}_n - \\nu \\mathbf{v}_n \\Delta t + \\sigma \\sqrt{\\Delta t} \\mathbf{Z}_n$$\n其中 $\\mathbf{v}_n \\equiv \\mathbf{v}(n\\Delta t)$，$\\mathbf{Z}_n$ 是一个由三个独立的标准正态随机变量 $N(0,1)$ 组成的向量。代入 $\\sigma$ 的表达式：\n$$\\mathbf{v}_{n+1} = (1 - \\nu \\Delta t) \\mathbf{v}_n + \\sqrt{2\\nu \\frac{k_\\mathrm{B} T_\\mathrm{b}}{m} \\Delta t} \\mathbf{Z}_n$$\n为了求出此离散过程的稳态均方速率 $S_{\\infty, \\text{EM}} = \\lim_{n\\to\\infty} \\mathbb{E}[\\|\\mathbf{v}_n\\|^2]$，我们分析二阶矩 $S_n = \\mathbb{E}[\\|\\mathbf{v}_n\\|^2]$ 的演化。\n$$\\|\\mathbf{v}_{n+1}\\|^2 = \\mathbf{v}_{n+1}^T \\mathbf{v}_{n+1} = \\left\\| (1 - \\nu \\Delta t) \\mathbf{v}_n + \\sqrt{2\\nu V_{th}^2 \\Delta t} \\mathbf{Z}_n \\right\\|^2$$\n$$= (1 - \\nu \\Delta t)^2 \\|\\mathbf{v}_n\\|^2 + 2(1 - \\nu \\Delta t)\\sqrt{2\\nu V_{th}^2 \\Delta t} (\\mathbf{v}_n^T \\mathbf{Z}_n) + (2\\nu V_{th}^2 \\Delta t) \\|\\mathbf{Z}_n\\|^2$$\n取期望，并利用 $\\mathbf{Z}_n$ 独立于 $\\mathbf{v}_n$、$\\mathbb{E}[\\mathbf{Z}_n]=\\mathbf{0}$ 和 $\\mathbb{E}[\\|\\mathbf{Z}_n\\|^2] = 3$ 这些事实，我们得到二阶矩的映射关系：\n$$S_{n+1} = (1 - \\nu \\Delta t)^2 S_n + 6\\nu V_{th}^2 \\Delta t$$\n在稳态下，$S_{n+1} = S_n = S_{\\infty, \\text{EM}}$。\n$$S_{\\infty, \\text{EM}} = (1 - \\nu \\Delta t)^2 S_{\\infty, \\text{EM}} + 6\\nu V_{th}^2 \\Delta t$$\n$$S_{\\infty, \\text{EM}} [1 - (1 - \\nu \\Delta t)^2] = 6\\nu V_{th}^2 \\Delta t$$\n$$S_{\\infty, \\text{EM}} [2\\nu \\Delta t - (\\nu \\Delta t)^2] = 6\\nu V_{th}^2 \\Delta t$$\n假设 $\\nu\\Delta t \\neq 0$ 且稳定性条件 $|1 - \\nu\\Delta t|  1$（即 $0  \\nu\\Delta t  2$）成立，我们可以两边同除以 $\\nu\\Delta t$：\n$$S_{\\infty, \\text{EM}} (2 - \\nu \\Delta t) = 6 V_{th}^2$$\n因此，Euler-Maruyama 格式的稳态均方速率为：\n$$S_{\\infty, \\text{EM}}(m, k_\\mathrm{B}, T_\\mathrm{b}, \\nu, \\Delta t) = \\frac{6 V_{th}^2}{2 - \\nu \\Delta t} = \\frac{6 k_\\mathrm{B} T_\\mathrm{b}}{m(2 - \\nu \\Delta t)}$$\n无量纲相对偏差 $R_\\mathrm{EM}$ 是该数值结果与精确结果的比值：\n$$R_\\mathrm{EM} = \\frac{S_{\\infty, \\text{EM}}}{S_{\\infty, \\text{exact}}} = \\frac{6 V_{th}^2 / (2 - \\nu \\Delta t)}{3 V_{th}^2} = \\frac{2}{2 - \\nu \\Delta t}$$\n用无量纲参数 $a = \\nu \\Delta t$ 表示：\n$$R_\\mathrm{EM}(a) = \\frac{2}{2 - a}$$\n这个结果清楚地显示了“数值加热”：对于任何 $a>0$，$R_\\mathrm{EM}(a) > 1$，意味着数值格式导致一个比物理平衡态更“热”的稳态。对于小的 $a$，误差是 $a$ 的一阶，因为 $R_\\mathrm{EM}(a) \\approx 1 + a/2$。\n\n### 第 2 部分：无偏差数值格式\n\n我们构建了两种能够保持精确稳态二阶矩的替代方案。\n\n**替代方案 1：精确离散时间 OU 更新**\nOU 过程的线性 SDE 可以在一个时间步长 $\\Delta t$ 上解析求解。其解为：\n$$\\mathbf{v}((n+1)\\Delta t) = e^{-\\nu \\Delta t} \\mathbf{v}(n\\Delta t) + \\int_{n\\Delta t}^{(n+1)\\Delta t} e^{-\\nu((n+1)\\Delta t - s)} \\sigma d\\mathbf{W}(s)$$\n积分项代表一个均值为零的高斯随机变量。其协方差矩阵为 $\\text{Var} \\cdot \\mathbf{I}$，其中方差由 Itō 等距定理给出：\n$$\\text{Var} = \\sigma^2 \\int_0^{\\Delta t} (e^{-\\nu u})^2 du = (2\\nu V_{th}^2) \\left[ \\frac{1-e^{-2\\nu \\Delta t}}{2\\nu} \\right]_0^{\\Delta t} = V_{th}^2 (1 - e^{-2\\nu \\Delta t})$$\n因此，精确的离散时间更新规则是：\n$$\\mathbf{v}_{n+1} = e^{-\\nu \\Delta t} \\mathbf{v}_n + \\sqrt{V_{th}^2(1-e^{-2\\nu \\Delta t})} \\mathbf{Z}_n$$\n根据构造，这是在离散时间点上对 OU 过程路径的精确采样。该格式的稳态分布与连续过程的相同。稳态均方速率 $S_{\\infty, \\text{OU}}$ 满足：\n$$S_{\\infty, \\text{OU}} = (e^{-\\nu\\Delta t})^2 S_{\\infty, \\text{OU}} + 3V_{th}^2(1-e^{-2\\nu\\Delta t})$$\n$$S_{\\infty, \\text{OU}}(1 - e^{-2\\nu\\Delta t}) = 3V_{th}^2(1-e^{-2\\nu\\Delta t}) \\implies S_{\\infty, \\text{OU}} = 3V_{th}^2 = S_{\\infty, \\text{exact}}$$\n因此，该格式的相对偏差 $R_\\mathrm{OU}$ 恒等于 1。\n\n**替代方案 2：改进的（平衡的）显式格式**\n我们可以修改显式 Euler-Maruyama 格式中的噪声项，以在保留简单的 $(1-\\nu\\Delta t)$ 拖拽项的同时，保证正确的稳态方差。设改进后的格式为：\n$$\\mathbf{v}_{n+1} = (1 - \\nu \\Delta t) \\mathbf{v}_n + C_{\\text{noise}} \\mathbf{Z}_n$$\n二阶矩的演化为 $S_{n+1} = (1 - \\nu \\Delta t)^2 S_n + 3C_{\\text{noise}}^2$。我们要求在稳态下，$S_n = S_{n+1} = S_{\\infty, \\text{exact}} = 3V_{th}^2$。\n$$3V_{th}^2 = (1 - \\nu \\Delta t)^2 (3V_{th}^2) + 3C_{\\text{noise}}^2$$\n$$C_{\\text{noise}}^2 = V_{th}^2 [1 - (1-\\nu \\Delta t)^2] = V_{th}^2 [2\\nu \\Delta t - (\\nu \\Delta t)^2]$$\n我们称之为“平衡的”改进格式是：\n$$\\mathbf{v}_{n+1} = (1 - \\nu \\Delta t) \\mathbf{v}_n + \\sqrt{V_{th}^2(2\\nu\\Delta t - (\\nu\\Delta t)^2)} \\mathbf{Z}_n$$\n根据构造，该格式确保了当 $n\\to\\infty$ 时 $\\mathbb{E}[\\|\\mathbf{v}\\|^2] \\to 3V_{th}^2$。因此，其相对偏差 $R_\\mathrm{bal}$ 恒等于 1。该格式是一种方差修正的显式方法，并且与原始 Euler-Maruyama 格式在相同的范围 $0  \\nu\\Delta t  2$ 内稳定。\n\n**可选的后处理重缩放**\n修改格式的一种替代方法是应用一个修正性的后处理步骤。在一个标准的 Euler-Maruyama 步骤产生 $\\mathbf{v}'_{n+1}$ 后，可以重新缩放速度：$\\mathbf{v}_{n+1} = c \\cdot \\mathbf{v}'_{n+1}$。为了保证正确的稳态方差，我们要求 $\\mathbb{E}[\\|\\mathbf{v}_{n+1}\\|^2] = c^2 \\mathbb{E}[\\|\\mathbf{v}'_{n+1}\\|^2] = c^2 S_{\\infty, \\text{EM}} = S_{\\infty, \\text{exact}}$。这意味着缩放因子必须是 $c = \\sqrt{S_{\\infty, \\text{exact}} / S_{\\infty, \\text{EM}}} = \\sqrt{1/R_\\mathrm{EM}} = \\sqrt{(2-a)/2}$。这在平均意义上消除了能量偏差。\n\n### 第 3 部分：实现\n实现需要为给定的测试用例计算 $R_\\mathrm{EM}$、$R_\\mathrm{OU}$ 和 $R_\\mathrm{bal}$。正如所推导的，这些量仅依赖于无量纲参数 $a = \\nu \\Delta t$。\n- $R_\\mathrm{EM}(a) = 2/(2-a)$\n- $R_\\mathrm{OU}(a) = 1$\n- $R_\\mathrm{bal}(a) = 1$\n\n物理常数 $m$ 和 $T_\\mathrm{b}$ 对于计算这些无量纲相对量是无关紧要的，这证明了量纲分析在物理建模中的威力。下面的程序为指定的测试组计算这些值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the relative bias for three different numerical schemes for the\n    Ornstein-Uhlenbeck process, based on analytical derivations.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple represents (mass, temperature, collision_freq, timestep).\n    # The physical values m and T_b are not needed for the relative bias calculation.\n    test_cases = [\n        # (m, T_b, nu, dt)\n        (3.345e-27, 1.16045e8, 1.0e5, 1.0e-6),  # Case 1\n        (3.345e-27, 1.16045e8, 3.0e5, 2.0e-6),  # Case 2\n        (3.345e-27, 1.16045e8, 1.0e5, 1.9e-5),  # Case 3\n        (3.345e-27, 1.16045e8, 2.0e5, 5.0e-9),  # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        _m, _T_b, nu, dt = case\n        \n        # The relevant parameter is the dimensionless product a = nu * dt\n        a = nu * dt\n\n        # 1. Euler-Maruyama relative bias (R_EM).\n        # Derived in the solution as R_EM = 2 / (2 - a).\n        # This formula is valid for 0  a  2, which holds for all test cases.\n        r_em = 2.0 / (2.0 - a)\n\n        # 2. Exact Ornstein-Uhlenbeck update relative bias (R_OU).\n        # This scheme is exact by construction, so its bias is identically 1.\n        r_ou = 1.0\n\n        # 3. Balanced (variance-corrected) explicit scheme relative bias (R_bal).\n        # This scheme is also correct by construction, so its bias is identically 1.\n        r_bal = 1.0\n\n        # Append results for the current case.\n        results.extend([r_em, r_ou, r_bal])\n\n    # Format the final output string as a comma-separated list of floats\n    # rounded to 6 decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在等离子体中，碰撞过程的特征时间尺度会随粒子速度发生巨大变化。使用固定的时间步长 $\\Delta t$ 不仅效率低下，而且可能导致在快变区域的数值不稳定或在慢变区域的精度浪费。本练习将指导你从第一性原理出发，为朗之万方程的漂移项和扩散项推导基于精度的自适应时间步长约束，从而设计出一个能够根据局部碰撞率和扩散张量动态调整 $\\Delta t$ 的智能算法 。",
            "id": "4001155",
            "problem": "考虑一个由朗之万方程描述的、在均匀、平稳、各向同性等离子体背景中的检验粒子库仑碰撞。设检验粒子的速度为向量 $\\mathbf{v}\\in\\mathbb{R}^3$。关于 $\\mathbf{v}$ 的伊东随机微分方程 (SDE) 形式如下\n$$\n\\mathrm{d}\\mathbf{v} \\;=\\; \\mathbf{a}(\\mathbf{v})\\,\\mathrm{d}t \\;+\\; \\mathbf{B}(\\mathbf{v})\\,\\mathrm{d}\\mathbf{W}_t,\n$$\n其中 $\\mathbf{a}(\\mathbf{v})$ 是确定性漂移，$\\mathbf{B}(\\mathbf{v})$ 是扩散振幅，$\\mathbf{W}_t$ 是一个分量独立同分布 (i.i.d.) 的三维维纳过程。相关的对称扩散张量为 $\\mathbf{D}(\\mathbf{v}) = \\tfrac{1}{2}\\,\\mathbf{B}(\\mathbf{v})\\,\\mathbf{B}(\\mathbf{v})^{\\mathsf{T}}$。在一个标准的库仑碰撞投掷角和能量散射模型中，有两个有效速率控制着时间尺度：能量减速率 $\\nu_s(\\mathbf{v})$ 和投掷角散射率 $\\nu_D(\\mathbf{v})$，它们的物理单位均为 $\\mathrm{s}^{-1}$。假设使用前向 Euler–Maruyama 离散化方法以时间步长 $\\Delta t$推进该 SDE：\n$$\n\\mathbf{v}_{n+1} \\;=\\; \\mathbf{v}_n \\;+\\; \\mathbf{a}(\\mathbf{v}_n)\\,\\Delta t \\;+\\; \\sqrt{2}\\,\\mathbf{R}_n,\n$$\n其中 $\\mathbf{R}_n$ 是一个均值为零的高斯随机向量，其协方差为 $\\mathbb{E}[\\mathbf{R}_n \\mathbf{R}_n^{\\mathsf{T}}] = \\mathbf{D}(\\mathbf{v}_n)\\,\\Delta t$。为了同时控制显式漂移离散化带来的弱偏差和随机项带来的抽样方差，必须对 $\\Delta t$ 相对于局部碰撞时间尺度和局部扩散几何形状施加限制。设局部扩散张量用单位向量 $\\widehat{\\mathbf{v}} = \\mathbf{v}/\\|\\mathbf{v}\\|$ 表示为\n$$\n\\mathbf{D}(\\mathbf{v}) \\;=\\; D_{\\perp}(\\mathbf{v})\\,\\mathbf{I} \\;+\\; \\bigl(D_{\\parallel}(\\mathbf{v}) - D_{\\perp}(\\mathbf{v})\\bigr)\\,\\widehat{\\mathbf{v}}\\,\\widehat{\\mathbf{v}}^{\\mathsf{T}},\n$$\n其中 $D_{\\parallel}$ 和 $D_{\\perp}$ 分别是平行和垂直于速度方向的速度空间扩散系数，物理单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$。用 $\\lambda_{\\max}(\\mathbf{v})$ 表示 $\\mathbf{D}(\\mathbf{v})$ 的最大特征值。\n\n你的任务是：\n- 仅从 SDE 定义、量纲分析以及 Euler–Maruyama 方法的性质出发，推导对时间步长 $\\Delta t$ 的原则性约束，以确保：(i) 相对于速率 $\\nu_s$ 和 $\\nu_D$，显式漂移偏差较小；(ii) 在扩散最强的方向上，单步随机增量的标准差是局部速率 $\\|\\mathbf{v}\\|$ 的一小部分。引入两个用户选择的无量纲容差：漂移偏差容差 $\\delta_b\\in(0,1)$ 和方差容差 $\\delta_v\\in(0,1)$，并用 $\\nu_s$、$\\nu_D$、$\\lambda_{\\max}$、$\\|\\mathbf{v}\\|$、$\\delta_b$ 和 $\\delta_v$ 表示这些约束。\n- 提出一个 $\\Delta t$ 的自适应选择规则，该规则仅使用步长开始时的局部量，便能同时满足这两个约束。\n\n然后，实现一个程序，对于下面的每个测试用例，该程序能根据 $D_{\\parallel}$ 和 $D_{\\perp}$ 构建扩散张量 $\\mathbf{D}(\\mathbf{v})$，计算 $\\lambda_{\\max}$，应用你的自适应选择规则，并返回所选的 $\\Delta t$（以秒为单位）。数值输入已给定，所有输出必须以秒为单位表示。对于数值输出格式，将每个 $\\Delta t$ 四舍五入到六位有效数字。\n\n测试套件（每个用例是一个元组，包含 $(\\mathbf{v},\\nu_s,\\nu_D,D_{\\parallel},D_{\\perp},\\delta_b,\\delta_v)$，其中 $\\mathbf{v}$ 的单位是 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，$\\nu_s$ 和 $\\nu_D$ 的单位是 $\\mathrm{s}^{-1}$，$D_{\\parallel}$ 和 $D_{\\perp}$ 的单位是 $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$）：\n- 用例 A（一般情况，漂移限制）：$\\bigl([\\;10^6,\\,0,\\,0\\;],\\; 50,\\; 30,\\; 10^{10},\\; 5\\times 10^9,\\; 0.1,\\; 0.05\\bigr)$。\n- 用例 B（高速率漂移限制）：$\\bigl([\\;2\\times 10^6,\\,2\\times 10^6,\\,0\\;],\\; 400,\\; 100,\\; 10^8,\\; 10^8,\\; 0.05,\\; 0.2\\bigr)$。\n- 用例 C（强各向异性扩散，扩散限制）：$\\bigl([\\;5\\times 10^5,\\,-5\\times 10^5,\\,10^6\\;],\\; 1,\\; 1,\\; 10^7,\\; 2\\times 10^{11},\\; 0.5,\\; 0.05\\bigr)$。\n- 用例 D（低速率，方差敏感）：$\\bigl([\\;3\\times 10^3,\\,0,\\,0\\;],\\; 0.1,\\; 0.2,\\; 10^5,\\; 10^5,\\; 0.5,\\; 0.01\\bigr)$。\n- 用例 E（弱碰撞，中等扩散下的偏差限制）：$\\bigl([\\;3\\times 10^6,\\,4\\times 10^6,\\,0\\;],\\; 0.5,\\; 0.05,\\; 2\\times 10^9,\\; 2\\times 10^9,\\; 0.1,\\; 0.2\\bigr)$。\n\n最终输出格式：你的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来，按用例 A 到 E 的顺序排列结果。每个列表元素必须是所选的时间步长 $\\Delta t$（以秒为单位），四舍五入到六位有效数字（例如，$[0.00123456,0.00234567,\\dots]$）。",
            "solution": "用户提供的问题被评估为有效。它在科学上基于库仑碰撞的物理学和随机微分方程的数值分析。该问题提法得当、客观，并包含了推导出唯一且有意义的解所需的所有信息。\n\n我们的任务是推导并实现一个自适应时间步长选择规则，用于朗之万方程的 Euler-Maruyama 离散化，该方程模拟了检验粒子的库仑碰撞。粒子速度 $\\mathbf{v} \\in \\mathbb{R}^3$ 的伊东随机微分方程 (SDE) 为\n$$\n\\mathrm{d}\\mathbf{v} \\;=\\; \\mathbf{a}(\\mathbf{v})\\,\\mathrm{d}t \\;+\\; \\mathbf{B}(\\mathbf{v})\\,\\mathrm{d}\\mathbf{W}_t\n$$\n相应的前向 Euler-Maruyama 格式通过以下方式将速度从时间步 $n$ 推进到 $n+1$：\n$$\n\\mathbf{v}_{n+1} \\;=\\; \\mathbf{v}_n \\;+\\; \\mathbf{a}(\\mathbf{v}_n)\\,\\Delta t \\;+\\; \\sqrt{2}\\,\\mathbf{R}_n,\n$$\n其中随机向量 $\\mathbf{R}_n$ 的协方差为 $\\mathbb{E}[\\mathbf{R}_n \\mathbf{R}_n^{\\mathsf{T}}] = \\mathbf{D}(\\mathbf{v}_n)\\,\\Delta t$，对称扩散张量为 $\\mathbf{D}(\\mathbf{v}) = \\tfrac{1}{2}\\,\\mathbf{B}(\\mathbf{v})\\,\\mathbf{B}(\\mathbf{v})^{\\mathsf{T}}$。\n\n推导过程分三步进行：从漂移项推导约束，从扩散项推导约束，以及将它们组合成一个单一的自适应规则。\n\n### 1. 漂移偏差约束\n\n第一个约束旨在控制来自漂移项 $\\mathbf{a}(\\mathbf{v})$ 显式离散化的误差。问题要求选择时间步长 $\\Delta t$，使得弱偏差相对于特征碰撞率 $\\nu_s(\\mathbf{v})$ 和 $\\nu_D(\\mathbf{v})$ 较小。在微分方程的数值方法中，对于像前向欧拉法这样的显式格式，一个标准的准确性和稳定性要求是时间步长必须小于系统的特征时间尺度。\n\n所提供的速率，即能量减速率 $\\nu_s$ 和投掷角散射率 $\\nu_D$，代表了作用于粒子速度的两个主要碰撞效应的逆时间尺度。为了在数值上解析这些过程中最快的一个，时间步长 $\\Delta t$ 必须是最短特征时间 $1/\\max(\\nu_s, \\nu_D)$ 的一小部分。\n\n我们引入无量纲的漂移偏差容差 $\\delta_b \\in (0,1)$，作为单步中允许占用的特征时间的“分数”上限。这导致了类似 Courant-Friedrichs-Lewy (CFL) 的条件：\n$$\n\\Delta t \\cdot \\max(\\nu_s(\\mathbf{v}), \\nu_D(\\mathbf{v})) \\le \\delta_b\n$$\n这确保了在一个时间步长内由漂移引起的变化，是相对于最快碰撞过程特征时间内发生的变化的一个受控部分。对 $\\Delta t$ 求解，得到第一个约束：\n$$\n\\Delta t_{\\text{bias}} = \\frac{\\delta_b}{\\max(\\nu_s(\\mathbf{v}), \\nu_D(\\mathbf{v}))}\n$$\n\n### 2. 方差约束\n\n第二个约束限制了单步中随机速度增量的大小。问题要求，在扩散最强的方向上，单步增量的标准差是局部粒子速率 $\\|\\mathbf{v}\\|$ 的一小部分。\n\nEuler-Maruyama 步长中的随机增量为 $\\Delta\\mathbf{v}_{\\text{stoch}} = \\sqrt{2}\\,\\mathbf{R}_n$。这个随机向量的协方差为：\n$$\n\\mathbb{E}[\\Delta\\mathbf{v}_{\\text{stoch}} (\\Delta\\mathbf{v}_{\\text{stoch}})^{\\mathsf{T}}] = 2\\,\\mathbb{E}[\\mathbf{R}_n \\mathbf{R}_n^{\\mathsf{T}}] = 2\\,\\mathbf{D}(\\mathbf{v}_n)\\,\\Delta t\n$$\n沿着由单位向量 $\\widehat{\\mathbf{u}}$ 给出的任意方向的速度变化的方差是 $\\widehat{\\mathbf{u}}^{\\mathsf{T}} (2\\,\\mathbf{D}(\\mathbf{v}_n)\\,\\Delta t) \\widehat{\\mathbf{u}}$。“扩散最强的方向”对应于协方差矩阵 $2\\,\\mathbf{D}(\\mathbf{v}_n)\\,\\Delta t$ 与其最大特征值相关联的特征向量。设 $\\lambda_{\\max}(\\mathbf{v})$ 是扩散张量 $\\mathbf{D}(\\mathbf{v})$ 的最大特征值。那么随机增量的最大方差为 $2\\,\\lambda_{\\max}(\\mathbf{v}_n)\\,\\Delta t$。\n\n这个方向上的标准差是方差的平方根：\n$$\n\\sigma_{\\max} = \\sqrt{2\\,\\lambda_{\\max}(\\mathbf{v}_n)\\,\\Delta t}\n$$\n这个标准差被约束为粒子速率 $\\|\\mathbf{v}_n\\|$ 的一小部分 $\\delta_v \\in (0,1)$：\n$$\n\\sqrt{2\\,\\lambda_{\\max}(\\mathbf{v}_n)\\,\\Delta t} \\le \\delta_v \\|\\mathbf{v}_n\\|\n$$\n两边平方并对 $\\Delta t$ 求解，得到第二个约束：\n$$\n\\Delta t \\le \\frac{\\delta_v^2 \\|\\mathbf{v}_n\\|^2}{2\\,\\lambda_{\\max}(\\mathbf{v}_n)}\n$$\n因此，受方差限制的时间步长为：\n$$\n\\Delta t_{\\text{var}} = \\frac{\\delta_v^2 \\|\\mathbf{v}\\|^2}{2\\,\\lambda_{\\max}(\\mathbf{v})}\n$$\n我们必须首先确定 $\\lambda_{\\max}(\\mathbf{v})$。扩散张量由下式给出：\n$$\n\\mathbf{D}(\\mathbf{v}) \\;=\\; D_{\\perp}(\\mathbf{v})\\,\\mathbf{I} \\;+\\; \\bigl(D_{\\parallel}(\\mathbf{v}) - D_{\\perp}(\\mathbf{v})\\bigr)\\,\\widehat{\\mathbf{v}}\\,\\widehat{\\mathbf{v}}^{\\mathsf{T}}\n$$\n其中 $\\widehat{\\mathbf{v}} = \\mathbf{v}/\\|\\mathbf{v}\\|$ 是沿 $\\mathbf{v}$ 方向的单位向量。这是一个对称矩阵，表示对一个缩放单位矩阵的秩-1 更新。它的特征值可以通过考虑平行和垂直于 $\\widehat{\\mathbf{v}}$ 的特征向量来找到。\n- 对于一个平行于 $\\widehat{\\mathbf{v}}$ 的特征向量 $\\mathbf{x}$（即 $\\mathbf{x} = \\widehat{\\mathbf{v}}$），并使用 $\\widehat{\\mathbf{v}}^{\\mathsf{T}}\\widehat{\\mathbf{v}}=1$：\n$$\n\\mathbf{D}\\widehat{\\mathbf{v}} = D_{\\perp}\\widehat{\\mathbf{v}} + (D_{\\parallel} - D_{\\perp})\\widehat{\\mathbf{v}}(\\widehat{\\mathbf{v}}^{\\mathsf{T}}\\widehat{\\mathbf{v}}) = D_{\\perp}\\widehat{\\mathbf{v}} + (D_{\\parallel} - D_{\\perp})\\widehat{\\mathbf{v}} = D_{\\parallel}\\widehat{\\mathbf{v}}\n$$\n因此，一个特征值为 $\\lambda_1 = D_{\\parallel}(\\mathbf{v})$。\n- 对于任何垂直于 $\\widehat{\\mathbf{v}}$ 的特征向量 $\\mathbf{x}$（即 $\\widehat{\\mathbf{v}}^{\\mathsf{T}}\\mathbf{x}=0$）：\n$$\n\\mathbf{D}\\mathbf{x} = D_{\\perp}\\mathbf{x} + (D_{\\parallel} - D_{\\perp})\\widehat{\\mathbf{v}}(\\widehat{\\mathbf{v}}^{\\mathsf{T}}\\mathbf{x}) = D_{\\perp}\\mathbf{x} + (D_{\\parallel} - D_{\\perp})\\widehat{\\mathbf{v}}(0) = D_{\\perp}\\mathbf{x}\n$$\n因此，在垂直于 $\\widehat{\\mathbf{v}}$ 的平面中的任何向量都是特征值为 $\\lambda_{2,3} = D_{\\perp}(\\mathbf{v})$ 的特征向量。\n$\\mathbf{D}(\\mathbf{v})$ 的特征值为 $\\{ D_{\\parallel}, D_{\\perp}, D_{\\perp} \\}$。因此，最大特征值为：\n$$\n\\lambda_{\\max}(\\mathbf{v}) = \\max(D_{\\parallel}(\\mathbf{v}), D_{\\perp}(\\mathbf{v}))\n$$\n这极大地简化了计算。\n\n### 3. 自适应时间步长选择规则\n\n为了确保同时满足漂移偏差和方差约束，下一步积分的时间步长 $\\Delta t$ 必须小于或等于 $\\Delta t_{\\text{bias}}$ 和 $\\Delta t_{\\text{var}}$。满足此条件的最通用和最稳健的选择是两者的最小值。\n\n在一个步长开始时（状态为 $\\mathbf{v}_n$），所提出的 $\\Delta t$ 自适应选择规则是：\n$$\n\\Delta t = \\min(\\Delta t_{\\text{bias}}, \\Delta t_{\\text{var}}) = \\min\\left( \\frac{\\delta_b}{\\max(\\nu_s, \\nu_D)}, \\frac{\\delta_v^2 \\|\\mathbf{v}\\|^2}{2 \\max(D_{\\parallel}, D_{\\perp})} \\right)\n$$\n该规则仅使用状态 $\\mathbf{v}_n$ 下可用的局部量来确定推进到 $\\mathbf{v}_{n+1}$ 的合适时间步长。在零扩散的情况下（$\\max(D_{\\parallel}, D_{\\perp}) = 0$），方差约束被认为是不活跃的（即 $\\Delta t_{\\text{var}} \\to \\infty$）。在零速度的情况下（$\\|\\mathbf{v}\\|=0$），我们假设扩散是各向同性的（$D_{\\parallel}=D_{\\perp}$），并注意到如果存在扩散，方差约束变为 $\\Delta t_{\\text{var}} = 0$。所有测试用例都具有非零速度和非零扩散。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef format_to_significant_figures(value, sig_figs):\n    \"\"\"\n    Rounds and formats a number to a specified number of significant figures,\n    avoiding scientific notation as requested by the output format.\n    \"\"\"\n    if value == 0:\n        return f\"0.{'0' * (sig_figs-1)}\"\n\n    # Round to the correct number of significant figures\n    order_of_magnitude = math.floor(math.log10(abs(value)))\n    decimals_to_round = sig_figs - 1 - order_of_magnitude\n    rounded_value = round(value, int(decimals_to_round))\n\n    # Format the rounded value to display trailing zeros\n    # This ensures the output string has the correct number of significant digits\n    decimals_to_format = max(0, decimals_to_round)\n    return f\"{rounded_value:.{int(decimals_to_format)}f}\"\n\ndef solve():\n    \"\"\"\n    Calculates the adaptive time step for Langevin simulations of Coulomb collisions\n    based on derived constraints for drift-bias and stochastic variance.\n    \"\"\"\n    \n    # Test suite from the problem statement.\n    # Each case is a tuple: (v, nu_s, nu_D, D_parallel, D_perp, delta_b, delta_v)\n    test_cases = [\n        # Case A: general, drift-limited\n        (np.array([1e6, 0, 0]), 50, 30, 1e10, 5e9, 0.1, 0.05),\n        # Case B: high-rate drift limit\n        (np.array([2e6, 2e6, 0]), 400, 100, 1e8, 1e8, 0.05, 0.2),\n        # Case C: strongly anisotropic diffusion, diffusion-limited\n        (np.array([5e5, -5e5, 1e6]), 1, 1, 1e7, 2e11, 0.5, 0.05),\n        # Case D: small speed, variance-sensitive\n        (np.array([3e3, 0, 0]), 0.1, 0.2, 1e5, 1e5, 0.5, 0.01),\n        # Case E: weak collisions, bias-limited with moderate diffusion\n        (np.array([3e6, 4e6, 0]), 0.5, 0.05, 2e9, 2e9, 0.1, 0.2),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        v, nu_s, nu_D, D_parallel, D_perp, delta_b, delta_v = case\n        \n        # 1. Drift-Bias Constraint\n        # The time step must resolve the fastest collisional process.\n        max_nu = max(nu_s, nu_D)\n        # Avoid division by zero if collision rates are zero.\n        if max_nu  0:\n            dt_bias = delta_b / max_nu\n        else:\n            dt_bias = float('inf')\n            \n        # 2. Variance Constraint\n        # The stochastic step size should be a small fraction of the particle speed.\n        v_norm = np.linalg.norm(v)\n        lambda_max = max(D_parallel, D_perp)\n        \n        # Avoid division by zero if there is no diffusion.\n        # Handle the case where v_norm is zero.\n        if lambda_max  0 and v_norm  0:\n            dt_var = (delta_v**2 * v_norm**2) / (2 * lambda_max)\n        elif v_norm == 0 and lambda_max  0:\n            # At zero speed, any stochastic kick is infinitely large relative to the speed.\n            # The time step must be zero to satisfy the constraint.\n            dt_var = 0.0\n        else: # No diffusion\n            dt_var = float('inf')\n            \n        # 3. Adaptive Time-Step Selection Rule\n        # The final time step must satisfy both constraints.\n        delta_t = min(dt_bias, dt_var)\n        \n        results.append(delta_t)\n\n    # Format results to exactly six significant digits.\n    formatted_results = [format_to_significant_figures(r, 6) for r in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何计算模拟的最终结果都受到两种基本误差源的影响：由有限时间步长 $\\Delta t$ 引起的离散化偏差，以及由有限粒子数 $N$ 造成的统计噪声。为了得到一个可靠的物理预测，我们必须确保总误差在可接受的范围内。这个实践练习将引导你分析这两种误差，并建立一个量化标准，以确定在给定的离散化偏差下，需要多少粒子才能将系综平均值的统计不确定性控制在指定的容差之内 。",
            "id": "4001134",
            "problem": "考虑磁化等离子体中库仑碰撞的一维朗之万公式，该公式为质量为 $m$ 的测试粒子与温度为 $T$ 的热背景相互作用时的速度分量 $v(t)$ 建模。其随机动力学由以下随机微分方程（SDE）描述\n$$\n\\mathrm{d}v = -\\nu\\, v\\, \\mathrm{d}t + \\sqrt{2\\, \\nu\\, v_{\\mathrm{th}}^2}\\, \\mathrm{d}W_t,\n$$\n其中 $\\nu$ 是碰撞摩擦（减速）率，$v_{\\mathrm{th}}^2$ 是由爱因斯坦关系式 $v_{\\mathrm{th}}^2 = \\frac{k_{\\mathrm{B}} T}{m}$ 给出的热速度平方（$k_{\\mathrm{B}}$ 为玻尔兹曼常数），而 $W_t$ 是一个标准维纳过程。您将使用 $N$ 个数值标记点，通过欧拉-丸山格式进行积分，来估计系综平均速度，\n$$\nv_{n+1} = v_n - \\nu\\, v_n\\, \\Delta t + \\sqrt{2\\, \\nu\\, v_{\\mathrm{th}}^2\\, \\Delta t}\\, \\xi_n,\n$$\n其中 $\\xi_n$ 是独立的标准正态随机变量，$\\Delta t$ 是时间步长。在时间 $t = M \\Delta t$ 时的均值估计量是样本均值 $\\bar{v}_M = \\frac{1}{N}\\sum_{i=1}^N v_M^{(i)}$。\n\n从基本定义和公认事实出发，即线性 SDE、欧拉-丸山离散化以及涨落-耗散的爱因斯坦关系式，推导出以下量：\n- 由上述 SDE 表示的 Ornstein–Uhlenbeck 过程的精确均值 $\\mathbb{E}[v(t)]$ 和精确方差 $\\mathrm{Var}[v(t)]$。\n- 经过 $M$ 步后由欧拉-丸山格式产生的离散时间均值，及其在 $t = M \\Delta t$ 时的时间离散化偏差，定义为 $b_{\\Delta t} = \\left|\\mathbb{E}_{\\mathrm{EM}}[v_M] - \\mathbb{E}[v(t)]\\right|$，其中 $\\mathbb{E}_{\\mathrm{EM}}[v_M]$ 表示在欧拉-丸山格式下的期望。\n- 在第 $M$ 步的欧拉-丸山方差，以及使用 $N$ 个独立标记点的样本均值估计量 $\\bar{v}_M$ 的抽样方差。\n\n利用这些推导，在置信水平为 $p$（例如，$p = 0.95$）和以米/秒（m/s）表示的均值估计的绝对容差 $\\varepsilon$ 的条件下，为系综大小 $N$ 设定一个充分性准则。具体来说，要求绝对离散化偏差 $b_{\\Delta t}$ 与 $\\bar{v}_M$ 的正态近似置信区间的半宽度之和以 $\\varepsilon$ 为界。使用所选置信水平的标准高斯分位数 $z_p$，求得满足以下条件的最小整数 $N_{\\min}$：\n$$\nb_{\\Delta t} + z_p \\sqrt{\\frac{\\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N}} \\le \\varepsilon.\n$$\n如果 $\\varepsilon \\le b_{\\Delta t}$，则声明该要求无法满足，并将该情况下的 $N_{\\min}$ 设置为 -1。\n\n编写一个完整、可运行的程序，该程序：\n- 使用推导出的公式，为下面的每个测试用例计算 $N_{\\min}$。\n- 输出一行，其中包含所有测试用例的结果，格式为逗号分隔的列表，用方括号括起来，且不含空格，例如，“[n1,n2,n3,n4]”。\n- 对所有基于速度的容差和量使用米/秒（m/s）作为单位。最终输出为不带单位符号的整数。\n\n在您的程序中使用以下常量和假设：\n- 玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$。\n- 电子伏特-焦耳转换 $E_{\\mathrm{eV}} = 1.602176634 \\times 10^{-19}\\ \\mathrm{J}$。\n- 使用 $z_{0.95} = 1.95996398454005$ 作为双侧 $95\\%$ 置信水平的正态分位数。\n\n测试套件（每个用例必须满足 $M = t_{\\mathrm{final}}/\\Delta t$ 是一个整数）：\n1. 用例 1（理想路径，类离子）：$m = 3.343 \\times 10^{-27}\\ \\mathrm{kg}$，$T = 10{,}000\\ \\mathrm{eV}$，$\\nu = 5.0 \\times 10^{4}\\ \\mathrm{s}^{-1}$，$v_0 = 2\\, v_{\\mathrm{th}}$，$t_{\\mathrm{final}} = 2.0 \\times 10^{-3}\\ \\mathrm{s}$，$\\Delta t = 2.0 \\times 10^{-6}\\ \\mathrm{s}$，$\\varepsilon = 5.0 \\times 10^{4}\\ \\mathrm{m/s}$，$p = 0.95$。\n2. 用例 2（粗时间步长，偏差主导）：$m = 3.343 \\times 10^{-27}\\ \\mathrm{kg}$，$T = 2{,}000\\ \\mathrm{eV}$，$\\nu = 1.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$，$v_0 = 1.5\\, v_{\\mathrm{th}}$，$t_{\\mathrm{final}} = 1.0 \\times 10^{-5}\\ \\mathrm{s}$，$\\Delta t = 5.0 \\times 10^{-6}\\ \\mathrm{s}$，$\\varepsilon = 3.0 \\times 10^{4}\\ \\mathrm{m/s}$，$p = 0.95$。\n3. 用例 3（类电子，高碰撞性）：$m = 9.10938356 \\times 10^{-31}\\ \\mathrm{kg}$，$T = 500\\ \\mathrm{eV}$，$\\nu = 2.0 \\times 10^{6}\\ \\mathrm{s}^{-1}$，$v_0 = 1.0\\, v_{\\mathrm{th}}$，$t_{\\mathrm{final}} = 1.0 \\times 10^{-5}\\ \\mathrm{s}$，$\\Delta t = 1.0 \\times 10^{-8}\\ \\mathrm{s}$，$\\varepsilon = 2.0 \\times 10^{5}\\ \\mathrm{m/s}$，$p = 0.95$。\n4. 用例 4（接近步长稳定性边界）：$m = 5.008 \\times 10^{-27}\\ \\mathrm{kg}$，$T = 20{,}000\\ \\mathrm{eV}$，$\\nu = 2.0 \\times 10^{5}\\ \\mathrm{s}^{-1}$，$v_0 = 0.5\\, v_{\\mathrm{th}}$，$t_{\\mathrm{final}} = 9.0 \\times 10^{-4}\\ \\mathrm{s}$，$\\Delta t = 9.0 \\times 10^{-6}\\ \\mathrm{s}$，$\\varepsilon = 1.0 \\times 10^{5}\\ \\mathrm{m/s}$，$p = 0.95$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4]”）。",
            "solution": "该问题要求推导一维 Ornstein-Uhlenbeck 过程及其欧拉-丸山离散化的统计量的解析表达式，然后计算为使系综均值达到指定精度所需的最小样本量 $N_{\\min}$。\n\n控制随机微分方程（SDE）为：\n$$ \\mathrm{d}v(t) = -\\nu v(t) \\mathrm{d}t + \\sqrt{2 \\nu v_{\\mathrm{th}}^2} \\mathrm{d}W_t $$\n初始条件为 $v(0) = v_0$。这是一个标准的 Ornstein-Uhlenbeck 过程，可以写成 $\\mathrm{d}X_t = \\theta (\\mu - X_t) \\mathrm{d}t + \\sigma \\mathrm{d}W_t$ 的形式。通过比较形式，我们确定以下参数：\n- 回复率：$\\theta = \\nu$\n- 长期均值：$\\mu = 0$\n- 波动率：$\\sigma = \\sqrt{2 \\nu v_{\\mathrm{th}}^2}$\n热速度平方由爱因斯坦关系式定义为 $v_{\\mathrm{th}}^2 = \\frac{k_{\\mathrm{B}} T}{m}$。\n\n**1. 连续过程的精确均值和方差**\n\n从 $v_0$ 开始的 Ornstein-Uhlenbeck 过程的通解由下式给出：\n$$ v(t) = v_0 e^{-\\theta t} + \\mu (1 - e^{-\\theta t}) + \\int_0^t \\sigma e^{-\\theta(t-s)} \\mathrm{d}W_s $$\n代入此问题的特定参数（$\\theta = \\nu, \\mu = 0$），我们得到：\n$$ v(t) = v_0 e^{-\\nu t} + \\int_0^t \\sqrt{2 \\nu v_{\\mathrm{th}}^2} e^{-\\nu(t-s)} \\mathrm{d}W_s $$\n\n精确均值 $\\mathbb{E}[v(t)]$ 是通过对解取期望得到的。Itô 积分的期望为零。\n$$ \\mathbb{E}[v(t)] = \\mathbb{E}[v_0 e^{-\\nu t}] = v_0 e^{-\\nu t} $$\n平均速度从其初始值 $v_0$ 指数衰减到长期均值 0。\n\n精确方差 $\\mathrm{Var}[v(t)]$ 使用 Itô 等距性质计算，该性质指出 $\\mathrm{Var}\\left[\\int_0^t f(s) \\mathrm{d}W_s\\right] = \\int_0^t \\mathbb{E}[f(s)^2] \\mathrm{d}s$。\n$$ \\mathrm{Var}[v(t)] = \\mathrm{Var}\\left[\\int_0^t \\sigma e^{-\\nu(t-s)} \\mathrm{d}W_s\\right] = \\int_0^t \\left(\\sigma e^{-\\nu(t-s)}\\right)^2 \\mathrm{d}s $$\n$$ \\mathrm{Var}[v(t)] = \\sigma^2 \\int_0^t e^{-2\\nu(t-s)} \\mathrm{d}s = \\sigma^2 \\left[ \\frac{e^{-2\\nu(t-s)}}{2\\nu} \\right]_0^t = \\frac{\\sigma^2}{2\\nu} (1 - e^{-2\\nu t}) $$\n代入 $\\sigma^2 = 2 \\nu v_{\\mathrm{th}}^2$：\n$$ \\mathrm{Var}[v(t)] = \\frac{2 \\nu v_{\\mathrm{th}}^2}{2\\nu} (1 - e^{-2\\nu t}) = v_{\\mathrm{th}}^2 (1 - e^{-2\\nu t}) $$\n当 $t \\to \\infty$ 时，方差趋近于 $v_{\\mathrm{th}}^2$，这与系统达到热平衡一致。\n\n**2. 欧拉-丸山离散化的均值和方差**\n\n该 SDE 的欧拉-丸山（EM）格式如下：\n$$ v_{n+1} = v_n - \\nu v_n \\Delta t + \\sqrt{2 \\nu v_{\\mathrm{th}}^2 \\Delta t} \\xi_n = (1 - \\nu \\Delta t) v_n + \\sqrt{2 \\nu v_{\\mathrm{th}}^2 \\Delta t} \\xi_n $$\n其中 $\\xi_n$ 是独立的标准正态随机变量（$\\mathbb{E}[\\xi_n]=0$, $\\mathrm{Var}[\\xi_n]=1$）。\n\n经过 $M$ 步后，EM 格式的均值 $\\mathbb{E}_{\\mathrm{EM}}[v_M]$ 通过对递推关系取期望得到：\n$$ \\mathbb{E}_{\\mathrm{EM}}[v_{n+1}] = \\mathbb{E}_{\\mathrm{EM}}[(1 - \\nu \\Delta t) v_n] + \\mathbb{E}_{\\mathrm{EM}}[\\sqrt{2 \\nu v_{\\mathrm{th}}^2 \\Delta t} \\xi_n] = (1 - \\nu \\Delta t) \\mathbb{E}_{\\mathrm{EM}}[v_n] $$\n这形成了一个几何级数。从确定性初始条件 $\\mathbb{E}_{\\mathrm{EM}}[v_0] = v_0$ 开始，经过 $M$ 步后我们得到：\n$$ \\mathbb{E}_{\\mathrm{EM}}[v_M] = (1 - \\nu \\Delta t)^M v_0 $$\n\n在时间 $t = M \\Delta t$ 的时间离散化偏差定义为 $b_{\\Delta t} = |\\mathbb{E}_{\\mathrm{EM}}[v_M] - \\mathbb{E}[v(t)]|$。\n$$ b_{\\Delta t} = |v_0 (1 - \\nu \\Delta t)^M - v_0 e^{-\\nu M \\Delta t}| = |v_0| \\left| (1 - \\nu \\Delta t)^M - e^{-\\nu M \\Delta t} \\right| $$\n\nEM 格式的方差 $\\mathrm{Var}[v_M]_{\\mathrm{EM}}$ 也可从递推关系中求得。设 $V_n = \\mathrm{Var}[v_n]_{\\mathrm{EM}}$。由于 $v_n$（依赖于 $\\xi_0, \\dots, \\xi_{n-1}$）和 $\\xi_n$ 是独立的：\n$$ V_{n+1} = \\mathrm{Var}[(1 - \\nu \\Delta t) v_n] + \\mathrm{Var}[\\sqrt{2 \\nu v_{\\mathrm{th}}^2 \\Delta t} \\xi_n] = (1 - \\nu \\Delta t)^2 V_n + 2 \\nu v_{\\mathrm{th}}^2 \\Delta t $$\n这是一个形式为 $V_{n+1} = aV_n + b$ 的线性递推关系，其中 $a = (1-\\nu\\Delta t)^2$ 且 $b = 2\\nu v_{\\mathrm{th}}^2 \\Delta t$。从 $V_0 = 0$（因为 $v_0$ 是确定性的）开始，经过 $M$ 步后的解是一个几何级数的和：\n$$ V_M = b \\sum_{k=0}^{M-1} a^k = b \\frac{1-a^M}{1-a} $$\n代入 $a$ 和 $b$：\n$$ 1-a = 1 - (1 - 2\\nu\\Delta t + (\\nu\\Delta t)^2) = 2\\nu\\Delta t - (\\nu\\Delta t)^2 = \\nu\\Delta t (2-\\nu\\Delta t) $$\n因此，在第 $M$ 步的方差为：\n$$ \\mathrm{Var}[v_M]_{\\mathrm{EM}} = \\frac{2 \\nu v_{\\mathrm{th}}^2 \\Delta t}{\\nu \\Delta t (2-\\nu\\Delta t)} (1 - (1-\\nu\\Delta t)^{2M}) = \\frac{2 v_{\\mathrm{th}}^2}{2 - \\nu\\Delta t} \\left(1 - (1 - \\nu\\Delta t)^{2M}\\right) $$\n为保证方差的数值稳定性，我们需要 $|a|1$，这意味着 $|1-\\nu\\Delta t|1$，即 $0  \\nu\\Delta t  2$。\n\n**3. 抽样方差和最小系综大小 ($N_{\\min}$)**\n\n样本均值 $\\bar{v}_M$ 是 $\\mathbb{E}_{\\mathrm{EM}}[v_M]$ 的一个估计量。对于 $N$ 个独立的标记点，其方差为：\n$$ \\mathrm{Var}[\\bar{v}_M] = \\mathrm{Var}\\left[\\frac{1}{N}\\sum_{i=1}^N v_M^{(i)}\\right] = \\frac{1}{N^2} \\sum_{i=1}^N \\mathrm{Var}[v_M^{(i)}] = \\frac{N \\cdot \\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N^2} = \\frac{\\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N} $$\n均值的标准误为 $\\sqrt{\\mathrm{Var}[\\bar{v}_M]} = \\sqrt{\\mathrm{Var}[v_M]_{\\mathrm{EM}} / N}$。\n\n问题要求总误差，包括绝对离散化偏差 $b_{\\Delta t}$ 和统计不确定性，必须以容差 $\\varepsilon$ 为界。统计不确定性由正态近似置信区间的半宽度 $z_p \\sqrt{\\mathrm{Var}[\\bar{v}_M]}$ 表示。准则为：\n$$ b_{\\Delta t} + z_p \\sqrt{\\frac{\\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N}} \\le \\varepsilon $$\n其中 $z_p$ 是双侧置信水平为 $p$ 的标准高斯分位数。\n\n首先，只有当固定偏差小于总允许误差，即 $b_{\\Delta t}  \\varepsilon$ 时，才可能存在 $N$ 的解。如果 $\\varepsilon \\le b_{\\Delta t}$，无论系综大小 $N$ 如何，该要求都无法满足。在这种情况下，我们设置 $N_{\\min} = -1$。\n\n如果 $\\varepsilon > b_{\\Delta t}$，我们可以重新整理不等式以求解 $N$：\n$$ z_p \\sqrt{\\frac{\\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N}} \\le \\varepsilon - b_{\\Delta t} $$\n$$ \\frac{\\mathrm{Var}[v_M]_{\\mathrm{EM}}}{N} \\le \\left(\\frac{\\varepsilon - b_{\\Delta t}}{z_p}\\right)^2 $$\n$$ N \\ge \\mathrm{Var}[v_M]_{\\mathrm{EM}} \\left(\\frac{z_p}{\\varepsilon - b_{\\Delta t}}\\right)^2 $$\n由于 $N$ 必须是整数，我们对右侧取上整，以找到所需标记点的最小数量：\n$$ N_{\\min} = \\left\\lceil \\mathrm{Var}[v_M]_{\\mathrm{EM}} \\left(\\frac{z_p}{\\varepsilon - b_{\\Delta t}}\\right)^2 \\right\\rceil $$\n这些推导出的公式将被实现以解决测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum ensemble size N_min for several test cases based on derived formulas\n    for the Langevin formulation of Coulomb collisions.\n    \"\"\"\n    KB = 1.380649e-23  # Boltzmann constant in J/K\n    E_EV = 1.602176634e-19  # Electronvolt in J\n    Z_095 = 1.95996398454005  # Gaussian quantile for 95% confidence\n\n    test_cases = [\n        # Case 1 (happy path, ion-like)\n        {'m': 3.343e-27, 'T_eV': 10000.0, 'nu': 5.0e4, 'v0_factor': 2.0, 't_final': 2.0e-3, 'dt': 2.0e-6, 'epsilon': 5.0e4, 'p': 0.95},\n        # Case 2 (coarse time step, bias-dominated)\n        {'m': 3.343e-27, 'T_eV': 2000.0, 'nu': 1.0e5, 'v0_factor': 1.5, 't_final': 1.0e-5, 'dt': 5.0e-6, 'epsilon': 3.0e4, 'p': 0.95},\n        # Case 3 (electron-like, high collisionality)\n        {'m': 9.10938356e-31, 'T_eV': 500.0, 'nu': 2.0e6, 'v0_factor': 1.0, 't_final': 1.0e-5, 'dt': 1.0e-8, 'epsilon': 2.0e5, 'p': 0.95},\n        # Case 4 (near-step-stability boundary)\n        {'m': 5.008e-27, 'T_eV': 20000.0, 'nu': 2.0e5, 'v0_factor': 0.5, 't_final': 9.0e-4, 'dt': 9.0e-6, 'epsilon': 1.0e5, 'p': 0.95},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        m, T_eV, nu, v0_factor, t_final, dt, epsilon, p = \\\n            case['m'], case['T_eV'], case['nu'], case['v0_factor'], case['t_final'], case['dt'], case['epsilon'], case['p']\n\n        # Pre-calculations\n        v_th_sq = (T_eV * E_EV) / m\n        v_th = np.sqrt(v_th_sq)\n        v0 = v0_factor * v_th\n        \n        # Consistent time and number of steps\n        M = int(round(t_final / dt))\n        t = M * dt\n        \n        # Quantile for the given confidence level (only p=0.95 used here)\n        z_p = Z_095\n\n        # 1. Calculate time-discretization bias (b_delta_t)\n        # Exact mean\n        E_exact = v0 * np.exp(-nu * t)\n        \n        # Euler-Maruyama mean\n        # Need to handle potential for large M causing underflow if v0 is large,\n        # but numpy handles large exponents.\n        base = 1.0 - nu * dt\n        E_em = v0 * (base ** M)\n        \n        bias = np.abs(E_em - E_exact)\n\n        # 2. Check sufficiency criterion\n        if epsilon = bias:\n            results.append(-1)\n            continue\n\n        # 3. Calculate Euler-Maruyama variance (Var[v_M]_EM)\n        nu_dt = nu * dt\n        # The term (1 - nu*dt) can be negative if nu*dt > 1\n        # The power is 2M, so the result is always positive.\n        term_pow = (1.0 - nu_dt) ** (2 * M)\n        \n        # Stability condition: 0  nu*dt  2 implies (2-nu*dt) > 0.\n        # Test cases respect this.\n        var_em = (2.0 * v_th_sq) / (2.0 - nu_dt) * (1.0 - term_pow)\n\n        # 4. Calculate N_min\n        n_raw = var_em * (z_p / (epsilon - bias))**2\n        n_min = int(np.ceil(n_raw))\n        \n        results.append(n_min)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}