{
    "hands_on_practices": [
        {
            "introduction": "Before we can model complex phenomena like resonance and mode conversion, we must first understand the limits of our basic propagation models. This exercise explores the validity of the Wentzel-Kramers-Brillouin (WKB) approximation, a cornerstone of wave theory in inhomogeneous media, by calculating where it breaks down near the steep density gradient of a tokamak pedestal . Mastering this concept is essential for determining when a simple ray-tracing picture is sufficient and when more sophisticated full-wave analysis is required.",
            "id": "3962805",
            "problem": "A radio frequency (RF) wave is launched from the low-density edge of a slab-model tokamak plasma into a region of increasing electron density. The magnetic field is approximately uniform and the wave is launched with its wave vector perpendicular to the magnetic field, so that the ordinary mode (O-mode) is excited. In the cold-plasma approximation, the O-mode refractive index satisfies $n^{2} = 1 - \\omega_{pe}^{2}/\\omega^{2}$, where $\\omega$ is the angular frequency and $\\omega_{pe}^{2}(x) = n_{e}(x) e^{2}/(\\varepsilon_{0} m_{e})$ is the local electron plasma frequency squared, with $n_{e}(x)$ the electron density, $e$ the elementary charge, $\\varepsilon_{0}$ the vacuum permittivity, and $m_{e}$ the electron mass. Assume the local electron density near the pedestal region is well approximated by a linear profile $n_{e}(x) = n_{c}\\left(1 + x/L_{n}\\right)$, where $x=0$ is the location where $n_{e}(x)$ equals the O-mode cutoff density $n_{c}$, and $L_{n}>0$ is a constant characterizing the sharpness of the pedestal gradient. The Wentzel–Kramers–Brillouin (WKB) validity condition for the perpendicular wavenumber $k_{\\perp}(x)$ is $|k_{\\perp}(x) L_{k}(x)| \\gg 1$, with $L_{k}(x) = \\left|k_{\\perp}(x) / \\left(\\mathrm{d}k_{\\perp}/\\mathrm{d}x\\right)\\right|$. For the O-mode in this geometry, $k_{\\perp}(x) = (\\omega/c)\\,n(x)$ where $c$ is the speed of light in vacuum and $n(x) = \\sqrt{1 - \\omega_{pe}^{2}(x)/\\omega^{2}}$. Derive from fundamental definitions and well-tested formulas the analytic expression for the distance $x_{b}<0$ into the propagating region (i.e., $x<0$) where the WKB approximation breaks down according to the threshold condition $|k_{\\perp}(x_{b}) L_{k}(x_{b})| = 1$. Then evaluate $|x_{b}|$ numerically for $\\omega/(2\\pi) = 170\\,\\mathrm{GHz}$ and $L_{n} = 5\\,\\mathrm{mm}$. Express the final answer in meters and round your answer to three significant figures. For clarity, note that while magnetic shear layers can strongly influence mode conversion and accessibility for other polarizations, the O-mode dispersion used here is independent of the magnetic field, so magnetic shear does not enter the present calculation.",
            "solution": "The problem is first validated against the required criteria.\n\n### Step 1: Extract Givens\n-   **Model**: Slab-model tokamak plasma with a wave launched from the low-density edge.\n-   **Wave Type**: Ordinary mode (O-mode) with wave vector perpendicular to a uniform magnetic field.\n-   **Approximation**: Cold-plasma approximation.\n-   **O-mode Refractive Index**: $n^{2} = 1 - \\omega_{pe}^{2}/\\omega^{2}$.\n-   **Wave Angular Frequency**: $\\omega$.\n-   **Electron Plasma Frequency Squared**: $\\omega_{pe}^{2}(x) = n_{e}(x) e^{2}/(\\varepsilon_{0} m_{e})$, where $n_{e}(x)$ is the electron density, $e$ is the elementary charge, $\\varepsilon_{0}$ is the vacuum permittivity, and $m_{e}$ is the electron mass.\n-   **Electron Density Profile**: $n_{e}(x) = n_{c}\\left(1 + x/L_{n}\\right)$, where $L_{n} > 0$ is the density gradient scale length.\n-   **Cutoff Location**: $x=0$ is where $n_{e}(x)$ equals the O-mode cutoff density $n_{c}$.\n-   **Perpendicular Wavenumber**: $k_{\\perp}(x) = (\\omega/c)\\,n(x)$, where $c$ is the speed of light in vacuum.\n-   **WKB Validity Condition**: $|k_{\\perp}(x) L_{k}(x)| \\gg 1$.\n-   **WKB Scale Length**: $L_{k}(x) = \\left|k_{\\perp}(x) / \\left(\\mathrm{d}k_{\\perp}/\\mathrm{d}x\\right)\\right|$.\n-   **WKB Breakdown Threshold**: The problem is to find $x_b < 0$ where $|k_{\\perp}(x_{b}) L_{k}(x_{b})| = 1$.\n-   **Numerical Values**:\n    -   Wave frequency: $\\omega/(2\\pi) = 170\\,\\mathrm{GHz}$.\n    -   Density gradient scale length: $L_{n} = 5\\,\\mathrm{mm}$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on standard cold plasma wave theory, a fundamental topic in plasma physics and fusion science. The O-mode dispersion relation, the definition of the plasma frequency, and the WKB approximation are all well-established concepts.\n-   **Well-Posed**: The problem provides a clear objective (find $x_b$), a complete set of equations, and sufficient data to derive a unique analytic and numerical solution.\n-   **Objective**: The language is precise and quantitative. No subjective or opinion-based statements are present.\n-   **Completeness and Consistency**: The provided information is self-contained and consistent. The definition of the cutoff at $x=0$ implies $n(0)=0$, which is consistent with the given expression for $n^2$ when $\\omega_{pe}^2(0) = \\omega^2$. The density profile is a standard linear approximation. No contradictions are found.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of the Breakdown Position $x_b$\n\nThe analysis begins by determining the spatial profile of the refractive index $n(x)$. The O-mode refractive index is given by:\n$$n^2(x) = 1 - \\frac{\\omega_{pe}^2(x)}{\\omega^2}$$\nThe electron plasma frequency squared, $\\omega_{pe}^2(x)$, depends on the local electron density $n_e(x)$. We are given a linear density profile:\n$$n_e(x) = n_c\\left(1 + \\frac{x}{L_n}\\right)$$\nThe location $x=0$ corresponds to the O-mode cutoff, where the refractive index is zero, $n(0)=0$. This implies that at $x=0$, the wave frequency equals the local plasma frequency: $\\omega = \\omega_{pe}(0)$. The density at this point is the cutoff density, $n_e(0) = n_c$. Thus, the cutoff condition defines a relationship between the wave frequency $\\omega$ and the cutoff density $n_c$:\n$$\\omega^2 = \\omega_{pe}^2(0) = \\frac{n_c e^2}{\\varepsilon_0 m_e}$$\nUsing this relationship, we can express the spatially varying plasma frequency in terms of the wave frequency $\\omega$:\n$$\\omega_{pe}^2(x) = \\frac{n_e(x) e^2}{\\varepsilon_0 m_e} = \\frac{n_c(1 + x/L_n) e^2}{\\varepsilon_0 m_e} = \\left(\\frac{n_c e^2}{\\varepsilon_0 m_e}\\right)\\left(1 + \\frac{x}{L_n}\\right) = \\omega^2\\left(1 + \\frac{x}{L_n}\\right)$$\nSubstituting this expression into the formula for the refractive index gives:\n$$n^2(x) = 1 - \\frac{\\omega^2(1 + x/L_n)}{\\omega^2} = 1 - \\left(1 + \\frac{x}{L_n}\\right) = -\\frac{x}{L_n}$$\nFor the wave to propagate, its wavenumber must be real, which means $n^2(x)$ must be positive. Since $L_n > 0$, this requires $x \\le 0$. The region $x < 0$ is the propagating region, while $x > 0$ is the evanescent region. In the propagating region, the refractive index is:\n$$n(x) = \\sqrt{-\\frac{x}{L_n}}$$\nThe perpendicular wavenumber is $k_{\\perp}(x) = (\\omega/c)n(x)$:\n$$k_{\\perp}(x) = \\frac{\\omega}{c}\\sqrt{-\\frac{x}{L_n}}$$\nThe WKB approximation is valid when the wavenumber changes slowly over a wavelength. The breakdown condition is given as $|k_{\\perp}(x_b) L_k(x_b)| = 1$, where $L_k(x) = |k_{\\perp}(x) / (dk_{\\perp}/dx)|$. This condition can be rewritten as $|k_{\\perp}^2(x_b) / (dk_{\\perp}/dx)| = 1$.\n\nFirst, we calculate the derivative of $k_{\\perp}(x)$ with respect to $x$:\n$$\\frac{dk_{\\perp}}{dx} = \\frac{d}{dx}\\left(\\frac{\\omega}{c\\sqrt{L_n}}(-x)^{1/2}\\right) = \\frac{\\omega}{c\\sqrt{L_n}} \\cdot \\frac{1}{2}(-x)^{-1/2} \\cdot (-1) = -\\frac{\\omega}{2c\\sqrt{L_n}\\sqrt{-x}}$$\nNext, we calculate the WKB parameter $|k_{\\perp}^2(x) / (dk_{\\perp}/dx)|$:\n$$\n\\left|\\frac{k_{\\perp}^2(x)}{dk_{\\perp}/dx}\\right| = \\left| \\frac{\\left(\\frac{\\omega}{c}\\sqrt{-\\frac{x}{L_n}}\\right)^2}{-\\frac{\\omega}{2c\\sqrt{L_n}\\sqrt{-x}}} \\right| = \\left| \\frac{\\frac{\\omega^2}{c^2}\\left(-\\frac{x}{L_n}\\right)}{-\\frac{\\omega}{2c\\sqrt{L_n}\\sqrt{-x}}} \\right|\n= \\left| \\left(-\\frac{\\omega^2 x}{c^2 L_n}\\right) \\left(-\\frac{2c\\sqrt{L_n}\\sqrt{-x}}{\\omega}\\right) \\right|\n$$\nSince we are in the propagating region $x < 0$, we can write $x = -|x|$:\n$$\n= \\frac{2\\omega}{c} \\frac{|x|}{\\sqrt{L_n}} \\sqrt{|x|} = \\frac{2\\omega}{c\\sqrt{L_n}} |x|^{3/2}\n$$\nThe WKB breakdown occurs at $x=x_b$, where this expression equals $1$:\n$$\\frac{2\\omega}{c\\sqrt{L_n}}|x_b|^{3/2} = 1$$\nSolving for $|x_b|$ gives the distance into the propagating region where breakdown occurs:\n$$|x_b|^{3/2} = \\frac{c\\sqrt{L_n}}{2\\omega}$$\n$$|x_b| = \\left(\\frac{c\\sqrt{L_n}}{2\\omega}\\right)^{2/3}$$\nThis can also be written in the equivalent form:\n$$|x_b| = \\left(\\frac{c^2 L_n}{4\\omega^2}\\right)^{1/3}$$\n\n### Numerical Evaluation\n\nWe are given the following values:\n-   $f = \\omega/(2\\pi) = 170\\,\\mathrm{GHz} = 1.7 \\times 10^{11}\\,\\mathrm{Hz}$\n-   $L_n = 5\\,\\mathrm{mm} = 5 \\times 10^{-3}\\,\\mathrm{m}$\n-   The speed of light in vacuum is $c \\approx 2.99792458 \\times 10^8\\,\\mathrm{m/s}$.\n\nFirst, we calculate the angular frequency $\\omega$:\n$$\\omega = 2\\pi f = 2\\pi(1.7 \\times 10^{11}\\,\\mathrm{s}^{-1}) = 3.4\\pi \\times 10^{11}\\,\\mathrm{rad/s}$$\nNow we substitute the values into the analytic expression for $|x_b|$:\n$$|x_b| = \\left(\\frac{c^2 L_n}{4\\omega^2}\\right)^{1/3} = \\left(\\frac{c^2 L_n}{4(2\\pi f)^2}\\right)^{1/3} = \\left(\\frac{c^2 L_n}{16\\pi^2 f^2}\\right)^{1/3}$$\n$$|x_b| = \\left(\\frac{(2.99792458 \\times 10^8\\,\\mathrm{m/s})^2 (5 \\times 10^{-3}\\,\\mathrm{m})}{16\\pi^2 (1.7 \\times 10^{11}\\,\\mathrm{s}^{-1})^2}\\right)^{1/3}$$\n$$|x_b| = \\left(\\frac{(8.98755 \\times 10^{16}\\,\\mathrm{m^2/s^2}) (5 \\times 10^{-3}\\,\\mathrm{m})}{16\\pi^2 (2.89 \\times 10^{22}\\,\\mathrm{s}^{-2})}\\right)^{1/3}$$\n$$|x_b| = \\left(\\frac{4.49377 \\times 10^{14}\\,\\mathrm{m^3/s^2}}{4.56623 \\times 10^{24}\\,\\mathrm{s}^{-2}}\\right)^{1/3}$$\n$$|x_b| = (9.84131 \\times 10^{-11}\\,\\mathrm{m^3})^{1/3}$$\n$$|x_b| \\approx 4.6179 \\times 10^{-4}\\,\\mathrm{m}$$\nRounding to three significant figures, the breakdown distance is $4.62 \\times 10^{-4}\\,\\mathrm{m}$.",
            "answer": "$$\\boxed{4.62 \\times 10^{-4}}$$"
        },
        {
            "introduction": "A successful RF system must efficiently couple power from an antenna into the plasma across a vacuum gap. This computational practice models this critical interface, accounting for the antenna's radiation pattern and the presence of the conducting vessel wall . By analyzing the wave's angular spectrum, you will determine how the geometry of the launcher filters the launched power, a crucial first step in assessing wave accessibility.",
            "id": "3962756",
            "problem": "You are asked to implement a computational model, grounded in first principles, to assess the Radio Frequency (RF) wave accessibility from an antenna through a finite vacuum gap to a plasma interface in a two-dimensional slab geometry. The antenna is placed at a finite distance from a perfectly conducting wall, and the vacuum gap separates the antenna aperture from the plasma boundary. The goal is to determine, for several specified parameter sets, the fraction of the launched spectral power that reaches the plasma interface without being eliminated by vacuum evanescence to below a specified amplitude threshold. All calculations must be based on physically consistent modeling of the near-field using the angular spectrum representation and propagation in vacuum using Maxwell's equations.\n\nAssume the following simplified, scientifically realistic configuration:\n- A two-dimensional geometry with coordinates $(x,z)$, where $z$ is normal to the plasma boundary and $x$ is tangential.\n- The antenna aperture is located at $z=0$ and radiates a real-valued, monochromatic, time-harmonic electric field in vacuum at angular frequency $\\omega = 2\\pi f$, with $f$ specified per test case. The vacuum gap of thickness $g$ separates the antenna aperture from the plasma interface at $z=g$.\n- A perfectly conducting wall is located at a distance $a$ behind the aperture in the $-z$ direction. Its presence modifies the near-field spectrum through constructive or destructive interference depending on the axial wavenumber.\n- The aperture field distribution is a Gaussian $E(x)$ with spatial width parameter $w$:\n$$\nE(x) = \\exp\\left(-\\frac{x^2}{2w^2}\\right).\n$$\n\nFoundational base and modeling requirements:\n1. In homogeneous vacuum, Maxwell's equations with time-harmonic dependence $\\exp(-i\\omega t)$ imply the homogeneous Helmholtz equation for each Cartesian component of the electric field:\n$$\n\\nabla^2 E + k_0^2 E = 0, \\quad k_0 = \\frac{\\omega}{c} = \\frac{2\\pi f}{c},\n$$\nwhere $c$ is the speed of light in vacuum.\n2. Use the angular spectrum representation to model near-field and propagation along $z$: express the field as a superposition of plane-wave components with transverse wavenumber $k_x$. For each spectral component $k_x$, define the axial wavenumber\n$$\nk_z(k_x) = \n\\begin{cases}\n\\sqrt{k_0^2 - k_x^2}, & |k_x| \\le k_0 \\quad \\text{(propagating)} \\\\\ni\\sqrt{k_x^2 - k_0^2}, & |k_x| > k_0 \\quad \\text{(evanescent)}.\n\\end{cases}\n$$\n3. Model the effect of the finite conducting wall distance by an interference factor that modifies the launched spectrum magnitude. Using a physically motivated image-field superposition for a perfectly conducting wall, apply the spectral multiplier\n$$\nF(k_x, a) = \\left|1 + \\exp\\left(2 i k_z(k_x) a\\right)\\right|,\n$$\nwhich yields constructive interference when $k_z(k_x)a$ is an integer multiple of $\\pi$ and yields attenuation otherwise. For evanescent components, note that $k_z = i\\alpha$ implies $F = |1 + \\exp(-2\\alpha a)|$.\n4. Propagation across the vacuum gap $g$ from $z=0$ to $z=g$ is governed by the axial propagation factor. For propagating components $|k_x| \\le k_0$, the magnitude is preserved. For evanescent components $|k_x| > k_0$, the magnitude is attenuated by\n$$\n\\exp\\left(-\\alpha g\\right), \\quad \\alpha = \\sqrt{k_x^2 - k_0^2}.\n$$\n5. Define an accessibility criterion based on a dimensionless amplitude threshold $t \\in (0,1)$. A spectral component is deemed accessible if either it is propagating ($|k_x| \\le k_0$) or if it is evanescent but its attenuation across the gap leaves its magnitude at least $t$, i.e.,\n$$\n\\exp(-\\alpha g) \\ge t.\n$$\n\nNumerical implementation requirements:\n- Discretize the aperture field $E(x)$ on a uniform grid in $x$ of length $L_x$ and $N_x$ points, with $L_x = 10w$ and $N_x = 4096$ for all test cases. Use the Fast Fourier Transform to compute the angular spectrum $S(k_x)$ as a discrete approximation to the continuous Fourier transform of $E(x)$. Use the standard relation between the sample spacing and Fourier frequencies to obtain the $k_x$ grid, with $k_x$ in radians per meter. You may use any consistent numerical normalization, since only ratios of spectral powers are requested.\n- Compute the modified spectrum $S_{\\text{eff}}(k_x) = S(k_x)\\,F(k_x,a)$.\n- Define the accessibility mask\n$$\n\\chi(k_x) =\n\\begin{cases}\n1, & |k_x| \\le k_0 \\\\\n1, & |k_x| > k_0 \\ \\text{and} \\ \\exp(-\\alpha g) \\ge t \\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nand compute the accessible spectral power fraction\n$$\nP_{\\text{acc}} = \\frac{\\sum_{k_x} |S_{\\text{eff}}(k_x)|^2 \\, \\chi(k_x)}{\\sum_{k_x} |S_{\\text{eff}}(k_x)|^2}.\n$$\n\nUnits and output specification:\n- Use $f$ in hertz (Hz), distances $w$, $a$, and $g$ in meters (m), and $c = 299{,}792{,}458 \\ \\text{m/s}$.\n- The final output must be a dimensionless float for each test case, equal to $P_{\\text{acc}}$, rounded to six decimal places.\n\nTest suite:\nImplement your program to evaluate $P_{\\text{acc}}$ for the following four parameter sets:\n1. Case A (happy path): $f = 3.7\\times 10^9 \\ \\text{Hz}$, $w = 0.05 \\ \\text{m}$, $a = 0.015 \\ \\text{m}$, $g = 0.03 \\ \\text{m}$, $t = 0.01$.\n2. Case B (large vacuum gap boundary): $f = 3.7\\times 10^9 \\ \\text{Hz}$, $w = 0.05 \\ \\text{m}$, $a = 0.015 \\ \\text{m}$, $g = 0.30 \\ \\text{m}$, $t = 0.01$.\n3. Case C (low frequency edge case): $f = 5.5\\times 10^7 \\ \\text{Hz}$, $w = 0.05 \\ \\text{m}$, $a = 0.015 \\ \\text{m}$, $g = 0.03 \\ \\text{m}$, $t = 0.01$.\n4. Case D (finite wall distance tuned near constructive interference at normal incidence): $f = 3.7\\times 10^9 \\ \\text{Hz}$, $w = 0.05 \\ \\text{m}$, $a = 0.0405 \\ \\text{m}$, $g = 0.03 \\ \\text{m}$, $t = 0.01$.\n\nFinal output format:\n- Your program should produce a single line of output containing the four computed values of $P_{\\text{acc}}$ for the cases A–D, as a comma-separated list enclosed in square brackets, with no spaces, and each value rounded to six decimal places. For example:\n\"[0.XXXXX,0.XXXXX,0.XXXXX,0.XXXXX]\".",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of wave propagation and Fourier optics, is well-posed with a complete and consistent set of parameters, and is objective in its formulation. The provided model, including the specific form of the wall interference factor, is taken as a given for the system to be simulated.\n\nThe solution computes the fraction of accessible spectral power, $P_{\\text{acc}}$, by modeling the propagation of an electromagnetic wave from an antenna aperture through a vacuum gap. The methodology follows these steps:\n\n1.  **System Parameters**: For each test case, we are given the wave frequency $f$, the Gaussian aperture width $w$, the distance to the conducting wall $a$, the vacuum gap thickness $g$, and the amplitude attenuation threshold $t$. The speed of light is $c = 299,792,458 \\, \\text{m/s}$. From these, we calculate the angular frequency $\\omega = 2\\pi f$ and the vacuum wavenumber $k_0 = \\omega/c$.\n\n2.  **Spatial and Spectral domains**: The aperture electric field, $E(x) = \\exp(-x^2/(2w^2))$, is discretized on a spatial grid. The problem specifies a grid of length $L_x = 10w$ with $N_x = 4096$ points. The spatial sampling interval is $\\Delta x = L_x / N_x$. The corresponding grid in the transverse wavenumber domain, $k_x$, is determined using the properties of the Discrete Fourier Transform (DFT). The wavenumbers are given by $k_x = 2\\pi \\nu_k$, where $\\nu_k$ are the spatial frequencies obtained via `numpy.fft.fftfreq`.\n\n3.  **Angular Spectrum**: The angular spectrum of the aperture field, $S(k_x)$, is computed using the Fast Fourier Transform (FFT) of the discretized field $E(x_j)$.\n    $$\n    S(k_x) \\propto \\text{FFT}\\{E(x)\\}\n    $$\n    Since the final quantity $P_{\\text{acc}}$ is a ratio of powers, the normalization constant of the FFT is irrelevant as it cancels out. For numerical convenience, the spectra are shifted to center the $k_x=0$ component.\n\n4.  **Axial Wavenumber**: For each transverse wavenumber $k_x$, the axial wavenumber $k_z$ in vacuum is determined by the dispersion relation derived from the Helmholtz equation, $\\nabla^2 E + k_0^2 E = 0$. This gives $k_x^2 + k_z^2 = k_0^2$.\n    $$\n    k_z(k_x) = \\sqrt{k_0^2 - k_x^2}\n    $$\n    This expression is evaluated using complex arithmetic. For propagating waves ($|k_x| \\le k_0$), $k_z$ is real. For evanescent waves ($|k_x| > k_0$), $k_z$ is purely imaginary, i.e., $k_z = i\\alpha$, where $\\alpha = \\sqrt{k_x^2 - k_0^2}$ is the attenuation rate.\n\n5.  **Wall Interference**: The perfectly conducting wall at $z=-a$ modifies the field at the aperture plane $z=0$ via reflection. According to the problem statement, this effect is modeled by a spectral multiplier $F(k_x, a)$, which is applied to the amplitude of the launched spectrum.\n    $$\n    F(k_x, a) = |1 + \\exp(2i k_z(k_x) a)|\n    $$\n    The effective launched spectrum is thus $S_{\\text{eff}}(k_x) = S(k_x) F(k_x, a)$. The corresponding spectral power is proportional to $|S_{\\text{eff}}(k_x)|^2$.\n\n6.  **Accessibility Criterion**: A spectral component $k_x$ is considered \"accessible\" if it can reach the plasma interface at $z=g$ without significant decay. The criterion is formalized by an accessibility mask, $\\chi(k_x)$:\n    - If $|k_x| \\le k_0$, the wave is propagating and experiences no attenuation in vacuum. It is always accessible, so $\\chi(k_x) = 1$.\n    - If $|k_x| > k_0$, the wave is evanescent and its amplitude decays as $\\exp(-\\alpha z)$, where $\\alpha = \\text{Im}\\{k_z\\}$. The wave is accessible only if its amplitude at $z=g$ remains above a fraction $t$ of its initial amplitude. This condition is $\\exp(-\\alpha g) \\ge t$.\n    The mask is therefore:\n    $$\n    \\chi(k_x) =\n    \\begin{cases}\n    1, & |k_x| \\le k_0 \\\\\n    1, & |k_x| > k_0 \\ \\text{and} \\ \\exp(-\\sqrt{k_x^2 - k_0^2} \\, g) \\ge t \\\\\n    0, & \\text{otherwise}\n    \\end{cases}\n    $$\n    This condition on evanescent waves can be rewritten as $\\sqrt{k_x^2 - k_0^2} \\le -\\ln(t)/g$.\n\n7.  **Accessible Power Fraction**: The final quantity, $P_{\\text{acc}}$, is the ratio of the total accessible spectral power to the total effective launched spectral power. Both are calculated by summing over all discrete $k_x$ components.\n    $$\n    P_{\\text{acc}} = \\frac{\\sum_{k_x} |S_{\\text{eff}}(k_x)|^2 \\, \\chi(k_x)}{\\sum_{k_x} |S_{\\text{eff}}(k_x)|^2}\n    $$\n    This value is computed for each of the four test cases provided, and the results are rounded to six decimal places.\n\nThe numerical implementation uses the `numpy` library for array operations and the FFT. Complex number capabilities are used to handle $k_z$ for both propagating and evanescent regimes seamlessly.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RF wave accessibility fraction for given antenna and vacuum parameters.\n    \"\"\"\n    # Define physical constants and numerical parameters\n    c = 299792458.0  # Speed of light in m/s\n    Nx = 4096       # Number of points in spatial grid\n    Lx_factor = 10.0  # Domain size in units of aperture width w\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Happy path\n        {'f': 3.7e9, 'w': 0.05, 'a': 0.015, 'g': 0.03, 't': 0.01},\n        # Case B: Large vacuum gap\n        {'f': 3.7e9, 'w': 0.05, 'a': 0.015, 'g': 0.30, 't': 0.01},\n        # Case C: Low frequency\n        {'f': 5.5e7, 'w': 0.05, 'a': 0.015, 'g': 0.03, 't': 0.01},\n        # Case D: Tuned wall distance\n        {'f': 3.7e9, 'w': 0.05, 'a': 0.0405, 'g': 0.03, 't': 0.01},\n    ]\n\n    results = []\n    for params in test_cases:\n        f = params['f']\n        w = params['w']\n        a = params['a']\n        g = params['g']\n        t = params['t']\n\n        # 1. Calculate derived parameters\n        omega = 2.0 * np.pi * f\n        k0 = omega / c\n        Lx = Lx_factor * w\n        dx = Lx / Nx\n\n        # 2. Create spatial grid and aperture field distribution\n        x = dx * (np.arange(Nx) - Nx / 2)\n        E_x = np.exp(-x**2 / (2.0 * w**2))\n\n        # 3. Compute the angular spectrum S(k_x) using FFT\n        # The kx grid is obtained from fftfreq and scaled by 2*pi\n        kx_unsh = 2.0 * np.pi * np.fft.fftfreq(Nx, d=dx)\n        S_unsh = np.fft.fft(E_x)\n\n        # Shift spectra to have zero frequency at the center for easier analysis\n        kx = np.fft.fftshift(kx_unsh)\n        S = np.fft.fftshift(S_unsh)\n\n        # 4. Calculate axial wavenumber k_z for each k_x\n        # Using complex numbers takes care of both propagating and evanescent cases\n        kz_squared = k0**2 - kx**2\n        kz = np.sqrt(kz_squared.astype(complex))\n\n        # 5. Calculate wall interference factor F and effective spectrum S_eff\n        F = np.abs(1.0 + np.exp(2.0j * kz * a))\n        S_eff = S * F\n        \n        # 6. Define the accessibility mask chi(k_x)\n        propagating_mask = np.abs(kx) <= k0\n        \n        # For evanescent waves, calculate attenuation rate alpha\n        alpha = kz.imag  # alpha = Im(k_z) > 0 for evanescent waves\n        \n        # Evanescent accessibility condition: exp(-alpha * g) >= t\n        # This is more numerically stable as -alpha*g >= log(t)\n        # We need to handle alpha=0 to avoid issues.\n        # Only apply condition where alpha > 0\n        evanescent_mask = np.abs(kx) > k0\n        evanescent_accessible_mask = np.zeros_like(kx, dtype=bool)\n        \n        # Filter for evanescent components to apply the condition\n        valid_evanescent_indices = np.where(evanescent_mask)[0]\n        if valid_evanescent_indices.size > 0:\n            alpha_ev = alpha[valid_evanescent_indices]\n            # Use log inequality for better numerical stability with small t\n            # -alpha * g >= log(t)  =>  alpha * g <= -log(t)\n            evanescent_accessible_mask[valid_evanescent_indices] = (alpha_ev * g <= -np.log(t))\n\n        chi = propagating_mask | evanescent_accessible_mask\n\n        # 7. Compute the accessible power fraction P_acc\n        S_eff_power = np.abs(S_eff)**2\n        \n        total_power = np.sum(S_eff_power)\n        accessible_power = np.sum(S_eff_power[chi])\n\n        if total_power > 0:\n            p_acc = accessible_power / total_power\n        else:\n            p_acc = 0.0\n\n        results.append(p_acc)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Once a wave enters the plasma, its properties are governed by the complex, spatially varying magnetic field structure. This exercise provides a computational framework for exploring how magnetic field shear can rotate a wave's polarization, a key mechanism that can couple it to another wave mode . By numerically integrating the mode-coupling equations, you will investigate the conditions under which this conversion is efficient, a process that is fundamental to the accessibility of certain resonances in fusion plasmas.",
            "id": "3962823",
            "problem": "Consider a high-frequency Radio Frequency (RF) electromagnetic wave propagating through a cold, magnetized plasma with spatially varying electron density and magnetic field direction. In the Wentzel-Kramers-Brillouin (WKB) approximation, the electric field can be written as $\\mathbf{E}(\\mathbf{x}) = A(\\mathbf{x}) \\mathbf{e}(\\mathbf{x}) \\exp(i S(\\mathbf{x}))$, where $A(\\mathbf{x})$ is the amplitude, $S(\\mathbf{x})$ is the eikonal phase, and $\\mathbf{e}(\\mathbf{x})$ is a unit polarization vector. The cold plasma dielectric tensor depends on the local electron density and magnetic field, making the local eigenmodes (e.g., ordinary and extraordinary modes) polarization-dependent and spatially varying. When the wave crosses a cutoff or resonance layer, the accessibility of the resonance and the fraction of mode conversion are controlled by the polarization evolution and its rotation due to inhomogeneities and shear.\n\nStarting from Maxwell's equations in a cold plasma and using the WKB approximation, one can derive a transport equation for the polarization that, in a two-mode subspace (e.g., a pair of uncoupled local eigenmodes subject to slow rotation of the polarization basis), reduces to a first-order system for the mode amplitudes $a(s)$ and $b(s)$ along an arclength-like ray coordinate $s$:\n$$\n\\frac{d}{ds} \\begin{pmatrix} a \\\\ b \\end{pmatrix} = -i \\left[ \\frac{\\Delta(s)}{2} \\sigma_z + g(s) \\sigma_x \\right] \\begin{pmatrix} a \\\\ b \\end{pmatrix},\n$$\nwhere $\\sigma_x$ and $\\sigma_z$ are Pauli matrices, $\\Delta(s)$ is a detuning representing the difference in local propagation constants (or phase velocities) between the two modes due to the plasma inhomogeneity and the proximity to cutoff/resonance, and $g(s)$ is a coupling rate proportional to the rotation rate of the polarization basis driven by shear and inhomogeneity. The quantity $g(s)$ has units of inverse length and is taken to be the magnitude of the rate of change of a polarization rotation angle $\\theta(s)$, i.e., $g(s) = \\left| d\\theta(s)/ds \\right|$, where $\\theta(s)$ is measured in radians. The conversion fraction into the second mode at the end of the ray segment $s = s_{\\text{end}}$ is $P_{\\text{conv}} = |b(s_{\\text{end}})|^2$.\n\nYour task is to numerically integrate this transport equation along a prescribed ray segment $s \\in [-S, +S]$, for several parameter sets representing different combinations of inhomogeneity and shear. The physics is encoded in the functions $\\Delta(s)$ and $\\theta(s)$:\n- The detuning is linear in $s$: $\\Delta(s) = \\alpha s + \\delta_0$, where $\\alpha$ is a constant detuning gradient (units of $\\mathrm{m}^{-2}$) and $\\delta_0$ is an offset (units of $\\mathrm{m}^{-1}$) determining whether a crossing near $\\Delta = 0$ (cutoff/resonance) occurs within the integration interval. The crossing is related to accessibility.\n- The shear-induced polarization rotation angle $\\theta(s)$ determines the coupling $g(s) = |d\\theta(s)/ds|$. You will consider both constant-slope rotation and zero rotation.\n\nUse the following initial condition, representing a pure first mode (e.g., an ordinary-like local eigenmode) launched far from the mode crossing:\n$$\na(-S) = 1, \\quad b(-S) = 0.\n$$\nIntegrate to $s=+S$ and compute $P_{\\text{conv}} = |b(+S)|^2$.\n\nNumerical and physical units:\n- The coordinate $s$ is in meters.\n- The detuning parameters are $\\alpha$ in $\\mathrm{m}^{-2}$ and $\\delta_0$ in $\\mathrm{m}^{-1}$.\n- The rotation angle $\\theta(s)$ is in radians, and its derivative $d\\theta/ds$ is in $\\mathrm{m}^{-1}$.\n- The conversion fraction $P_{\\text{conv}}$ is dimensionless; report it as a float rounded to six decimal places.\n\nImplement a robust numerical integrator (for example, a fourth-order Runge–Kutta method) suitable for complex-valued amplitudes, ensuring numerical stability when $\\Delta(s)$ can be large outside the resonance region. The code should produce results for the following test suite; these cases explore the effect of polarization rotation and accessibility:\n\nTest suite (each tuple is $(S, \\alpha, \\delta_0, \\sigma)$, where $\\sigma$ defines a constant polarization rotation rate via $\\theta(s) = \\theta_0 + \\sigma s$ and $g(s) = |\\sigma|$; set $\\theta_0 = 0$):\n1. $(0.20, 100.0, 0.0, 0.0)$: No shear, linear detuning crossing $\\Delta=0$ at $s=0$; expect negligible conversion due to zero coupling.\n2. $(0.20, 100.0, 0.0, 5.0)$: Moderate constant shear; crossing occurs; expect nontrivial conversion.\n3. $(0.20, 100.0, 0.0, 10.0)$: Strong constant shear; crossing occurs; expect near-complete conversion.\n4. $(0.20, 100.0, 50.0, 10.0)$: Strong shear, but detuning offset $\\delta_0$ prevents crossing within $[-S, S]$ (no local resonance/cutoff within interval); expect suppressed conversion due to lack of accessibility.\n\nAlgorithmic requirements:\n- Integrate the complex system for $[a(s), b(s)]^\\top$ using a fixed-step fourth-order Runge–Kutta method from $s=-S$ to $s=+S$ with a sufficiently small step to resolve oscillations.\n- For each test case, compute $P_{\\text{conv}} = |b(+S)|^2$ and round to six decimal places.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite, for example, \"[result1,result2,result3,result4]\". Each result must be a float rounded to six decimal places.",
            "solution": "The problem statement describes the evolution of the amplitudes of two coupled electromagnetic modes, $a(s)$ and $b(s)$, propagating through an inhomogeneous magnetized plasma. This physical situation is mathematically modeled by a system of two linear, first-order, coupled ordinary differential equations (ODEs) with a spatially varying coefficient matrix. The task is to numerically solve this system for a given set of parameters and initial conditions.\n\nThe problem is scientifically well-posed and grounded in the established theory of wave propagation and mode conversion, specifically relating to the Landau-Zener-Stückelberg problem framework. The provided equations, definitions, and parameters are self-consistent, complete (with the standard caveat that a numerical step size must be chosen appropriately), and physically relevant to the field of computational fusion science. Therefore, the problem is deemed valid and a solution can be constructed.\n\nThe governing equation for the state vector $\\mathbf{y}(s) = [a(s), b(s)]^\\top$ is given as:\n$$\n\\frac{d}{ds} \\begin{pmatrix} a \\\\ b \\end{pmatrix} = -i \\left[ \\frac{\\Delta(s)}{2} \\sigma_z + g(s) \\sigma_x \\right] \\begin{pmatrix} a \\\\ b \\end{pmatrix}\n$$\nwhere $s$ is the spatial coordinate along the ray path. The Pauli matrices are $\\sigma_z = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\end{pmatrix}$ and $\\sigma_x = \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}$. Substituting these matrices, we obtain the explicit form of the system:\n$$\n\\frac{d}{ds} \\begin{pmatrix} a \\\\ b \\end{pmatrix} = -i \\begin{pmatrix} \\frac{\\Delta(s)}{2} & g(s) \\\\ g(s) & -\\frac{\\Delta(s)}{2} \\end{pmatrix} \\begin{pmatrix} a \\\\ b \\end{pmatrix}\n$$\nThis expands into two coupled scalar equations for the complex-valued amplitudes $a(s)$ and $b(s)$:\n$$\n\\frac{da}{ds} = -i \\left( \\frac{\\Delta(s)}{2} a(s) + g(s) b(s) \\right)\n$$\n$$\n\\frac{db}{ds} = -i \\left( g(s) a(s) - \\frac{\\Delta(s)}{2} b(s) \\right)\n$$\nThe functions $\\Delta(s)$ and $g(s)$ are defined by the problem's physics. The detuning $\\Delta(s) = \\alpha s + \\delta_0$ varies linearly, representing the changing difference in propagation constants. The coupling $g(s)$ arises from the polarization basis rotation, $\\theta(s) = \\sigma s$, leading to a constant coupling rate $g(s) = |d\\theta/ds| = |\\sigma|$.\n\nThe problem requires integrating this system from an initial point $s = -S$ to a final point $s = +S$, starting with the initial condition that the wave is purely in the first mode: $a(-S) = 1$ and $b(-S) = 0$. The objective is to compute the conversion fraction to the second mode, $P_{\\text{conv}} = |b(+S)|^2$.\n\nTo solve this initial value problem for a system of ODEs, we employ the fourth-order Runge-Kutta (RK4) method, as specified. This method is an excellent choice due to its high accuracy, good stability properties, and straightforward implementation. The state vector $\\mathbf{y}(s) = [a(s), b(s)]^\\top$ is complex, so the arithmetic must be handled accordingly. The RK4 algorithm proceeds by taking a series of steps of size $h$. For each step from $s_n$ to $s_{n+1} = s_n + h$, the state vector $\\mathbf{y}_n$ is updated to $\\mathbf{y}_{n+1}$ using the following procedure, where $f(s, \\mathbf{y})$ represents the right-hand side of the ODE system:\n$$\n\\mathbf{k}_1 = f(s_n, \\mathbf{y}_n)\n$$\n$$\n\\mathbf{k}_2 = f(s_n + \\frac{h}{2}, \\mathbf{y}_n + \\frac{h}{2} \\mathbf{k}_1)\n$$\n$$\n\\mathbf{k}_3 = f(s_n + \\frac{h}{2}, \\mathbf{y}_n + \\frac{h}{2} \\mathbf{k}_2)\n$$\n$$\n\\mathbf{k}_4 = f(s_n + h, \\mathbf{y}_n + h \\mathbf{k}_3)\n$$\n$$\n\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\nA crucial aspect of any numerical integration is the choice of the step size, $h$. It must be small enough to accurately resolve the fastest oscillations in the solution. The characteristic \"wavenumber\" of oscillations is determined by the eigenvalues of the coefficient matrix, which are roughly proportional to $|\\Delta(s)|$ and $|g(s)|$. For the given test cases, the maximum value of $|\\Delta(s)|/2$ is approximately $35 \\, \\mathrm{m}^{-1}$. To ensure convergence and accuracy, we choose a number of steps, $N$, sufficiently large to make the step size $h = 2S/N$ much smaller than the shortest \"wavelength\" $2\\pi/35$. A choice of $N=4000$ steps over the integration interval of length $2S=0.4 \\, \\mathrm{m}$ gives a step size $h = 0.0001 \\, \\mathrm{m}$, which is more than adequate.\n\nThe implementation will proceed by defining a function for the right-hand side of the ODE system. A second function will implement the RK4 algorithm to step the solution forward. The main function will iterate through the provided test cases. For each case, it initializes the state vector to $[1, 0]^\\top$ at $s=-S$, performs the integration over the specified number of steps until $s=+S$, and then calculates the conversion probability $P_{\\text{conv}}$ from the squared magnitude of the final complex amplitude $b(+S)$. The result for each case is rounded to six decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the mode conversion problem for the given test suite\n    and prints the results in the specified format.\n    \"\"\"\n\n    test_cases = [\n        # (S, alpha, delta_0, sigma)\n        (0.20, 100.0, 0.0, 0.0),   # Case 1: No coupling\n        (0.20, 100.0, 0.0, 5.0),   # Case 2: Moderate coupling, with crossing\n        (0.20, 100.0, 0.0, 10.0),  # Case 3: Strong coupling, with crossing\n        (0.20, 100.0, 50.0, 10.0), # Case 4: Strong coupling, no crossing\n    ]\n\n    results = []\n    for case in test_cases:\n        S, alpha, delta_0, sigma = case\n        \n        # Numerically integrate the system for the given case.\n        p_conv = integrate_mode_conversion(S, alpha, delta_0, sigma)\n        \n        # Round and store the result.\n        results.append(f\"{p_conv:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef rk4_step(f, s, y, h):\n    \"\"\"\n    Performs a single step of the fourth-order Runge-Kutta method.\n    \n    Args:\n        f (callable): The function defining the ODE, dy/ds = f(s, y).\n        s (float): The current value of the independent variable.\n        y (np.ndarray): The current value of the dependent variable vector (complex).\n        h (float): The step size.\n        \n    Returns:\n        np.ndarray: The new value of y at s + h.\n    \"\"\"\n    k1 = f(s, y)\n    k2 = f(s + 0.5 * h, y + 0.5 * h * k1)\n    k3 = f(s + 0.5 * h, y + 0.5 * h * k2)\n    k4 = f(s + h, y + h * k3)\n    return y + (h / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\ndef integrate_mode_conversion(S, alpha, delta_0, sigma):\n    \"\"\"\n    Integrates the mode conversion ODE system using a fixed-step RK4 method.\n\n    Args:\n        S (float): Half-width of the integration interval [-S, S].\n        alpha (float): Gradient of the detuning.\n        delta_0 (float): Offset of the detuning.\n        sigma (float): Constant rate of polarization rotation.\n        \n    Returns:\n        float: The conversion probability P_conv = |b(+S)|^2.\n    \"\"\"\n    # Integration parameters\n    s_start = -S\n    s_end = S\n    # Choose a number of steps sufficient for convergence.\n    # The highest wavenumber is ~max(|alpha*S+delta_0|/2, |sigma|), which is\n    # max(|100*0.2+50|/2, 10) = 35. Wavelength ~ 2*pi/35 = 0.18.\n    # A step size of 0.0001 resolves this well.\n    num_steps = 4000\n    h = (s_end - s_start) / num_steps\n\n    # The coupling term g(s) is constant since theta(s) is linear.\n    g = abs(sigma)\n\n    def rhs(s, y):\n        \"\"\"\n        Calculates the right-hand side of the ODE system.\n        dy/ds = f(s, y)\n        \"\"\"\n        a, b = y\n        delta_s = alpha * s + delta_0\n        \n        # da/ds = -i * (0.5 * delta_s * a + g * b)\n        # db/ds = -i * (g * a - 0.5 * delta_s * b)\n        da_ds = -1j * (0.5 * delta_s * a + g * b)\n        db_ds = -1j * (g * a - 0.5 * delta_s * b)\n        \n        return np.array([da_ds, db_ds], dtype=np.complex128)\n\n    # Initial condition: y(-S) = [a(-S), b(-S)] = [1, 0]\n    y = np.array([1.0, 0.0], dtype=np.complex128)\n    s = s_start\n    \n    # Integration loop\n    for _ in range(num_steps):\n        y = rk4_step(rhs, s, y, h)\n        s += h\n            \n    # Final conversion probability P_conv = |b(+S)|^2\n    p_conv = np.abs(y[1])**2\n    \n    return p_conv\n\nsolve()\n```"
        }
    ]
}