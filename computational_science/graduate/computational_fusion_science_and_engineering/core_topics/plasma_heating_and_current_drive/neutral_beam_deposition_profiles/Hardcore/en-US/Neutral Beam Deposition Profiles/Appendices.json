{
    "hands_on_practices": [
        {
            "introduction": "The foundation of modeling neutral beam deposition lies in the Beer-Lambert law, which describes exponential attenuation. A core skill for any fusion scientist is applying this law to plasmas with non-uniform density profiles. This first practice challenges you to derive the beam shine-through fraction for a plasma with a parabolic density profile, a common and instructive model for tokamak plasmas. By performing this analytical line integral, you will build a first-principles understanding of how beam geometry and plasma structure collectively determine beam penetration .",
            "id": "4019509",
            "problem": "A collimated Neutral Beam Injection (NBI) line passes through a circular cross-section tokamak plasma of minor radius $a$, following a straight chord with minimum radial offset (impact parameter) $b$, where $0 \\leq b < a$. The electron density profile is parabolic, $n(r) = n_{0}\\left[1 - \\left(\\frac{r}{a}\\right)^{2}\\right]$. Assume an energy-independent, spatially uniform effective attenuation cross-section $\\sigma$ that accounts for collisional ionization and charge exchange, negligible scattering, and negligible re-neutralization. Let the beam-line coordinate $s$ be defined along the chord, with $s=0$ at the point of closest approach to the magnetic axis, and let the radial mapping be $r(s) = \\sqrt{b^{2} + s^{2}}$ inside the plasma, with the beam entering and exiting the plasma at $s = -\\sqrt{a^{2} - b^{2}}$ and $s = +\\sqrt{a^{2} - b^{2}}$, respectively. Using first principles of exponential attenuation of a collimated beam along its path through a medium, derive the closed-form expression for the shine-through fraction $I(L)/I_{0}$, where $I_{0}$ is the incident beam intensity at the entry point, $I(L)$ is the transmitted intensity at the exit point, and $L = 2\\sqrt{a^{2} - b^{2}}$ is the in-plasma chord length. Express your final answer as a single analytic expression in terms of $n_{0}$, $a$, $b$, and $\\sigma$. No numerical evaluation or rounding is required.",
            "solution": "The problem statement has been validated and is deemed self-contained, scientifically grounded in the principles of particle-matter interaction, and well-posed. All provided parameters, functions, and boundary conditions are physically consistent and sufficient to derive a unique analytical solution.\n\nThe fundamental principle governing the attenuation of a collimated beam of neutral particles through a medium is the Beer-Lambert law. The differential change in beam intensity, $dI$, over an infinitesimal path length, $ds$, is proportional to the local intensity $I(s)$, the local number density of attenuating particles $n(s)$, and the effective interaction cross-section $\\sigma$. This relationship is expressed as:\n$$\n\\frac{dI}{I(s)} = - \\sigma n(s) ds\n$$\nThe negative sign indicates that the intensity decreases as the beam penetrates the medium. Integrating this equation from the beam's entry point, $s_{entry}$, to its exit point, $s_{exit}$, yields the ratio of the transmitted intensity $I_{exit}$ to the incident intensity $I_{inc}$. Let the intensity at the entry point $s_{entry}$ be $I_0$. The intensity $I(s_{exit})$ at the exit point is then given by:\n$$\n\\ln\\left(\\frac{I(s_{exit})}{I_{0}}\\right) = - \\sigma \\int_{s_{entry}}^{s_{exit}} n(s) ds\n$$\nThe shine-through fraction, which is the ratio of the transmitted intensity at the exit point to the incident intensity at the entry point, is therefore:\n$$\n\\frac{I(s_{exit})}{I_{0}} = \\exp\\left(-\\sigma \\int_{s_{entry}}^{s_{exit}} n(s) ds \\right)\n$$\nThe problem defines the beam path as a chord through a circular plasma of radius $a$ with an impact parameter $b$. The beam-line coordinate $s$ is measured along this chord, with $s=0$ at the point of closest approach to the center. The beam enters and exits the plasma where the radial position $r$ equals the minor radius $a$. The relationship between the radial coordinate $r$ and the path coordinate $s$ is given by $r(s) = \\sqrt{b^{2} + s^{2}}$. Thus, the entry and exit points correspond to $r(s)=a$, which means $a^{2} = b^{2} + s^{2}$, or $s = \\pm\\sqrt{a^{2}-b^{2}}$. The entry point is $s_{entry} = -\\sqrt{a^{2}-b^{2}}$ and the exit point is $s_{exit} = +\\sqrt{a^{2}-b^{2}}$. The total in-plasma chord length is $L = 2\\sqrt{a^2-b^2}$, and the transmitted intensity is denoted as $I(L)$.\n\nThe shine-through fraction is thus:\n$$\n\\frac{I(L)}{I_{0}} = \\exp\\left(-\\sigma \\int_{-\\sqrt{a^{2}-b^{2}}}^{\\sqrt{a^{2}-b^{2}}} n(r(s)) ds \\right)\n$$\nThe electron density profile is given as $n(r) = n_{0}\\left[1 - \\left(\\frac{r}{a}\\right)^{2}\\right]$. We must express this density as a function of the path coordinate $s$ by substituting $r(s) = \\sqrt{b^{2} + s^{2}}$:\n$$\nn(s) = n_{0}\\left[1 - \\frac{b^{2} + s^{2}}{a^{2}}\\right]\n$$\nThe integral in the exponent, often called the optical depth $\\tau$, is the line integral of the density along the chord:\n$$\n\\tau = \\sigma \\int_{-\\sqrt{a^{2}-b^{2}}}^{\\sqrt{a^{2}-b^{2}}} n_{0}\\left(1 - \\frac{b^{2}}{a^{2}} - \\frac{s^{2}}{a^{2}}\\right) ds\n$$\nThe integrand $n(s)$ is an even function of $s$ because it only contains terms in $s^{2}$. The interval of integration is symmetric about $s=0$. We can therefore simplify the integral:\n$$\n\\tau = 2 \\sigma n_{0} \\int_{0}^{\\sqrt{a^{2}-b^{2}}} \\left(1 - \\frac{b^{2}}{a^{2}} - \\frac{s^{2}}{a^{2}}\\right) ds\n$$\nPerforming the integration with respect to $s$:\n$$\n\\tau = 2 \\sigma n_{0} \\left[ \\left(1 - \\frac{b^{2}}{a^{2}}\\right)s - \\frac{s^{3}}{3a^{2}} \\right]_{0}^{\\sqrt{a^{2}-b^{2}}}\n$$\nEvaluating the expression at the upper limit $s = \\sqrt{a^{2}-b^{2}}$ (the lower limit $s=0$ yields $0$):\n$$\n\\tau = 2 \\sigma n_{0} \\left[ \\left(\\frac{a^{2}-b^{2}}{a^{2}}\\right)\\sqrt{a^{2}-b^{2}} - \\frac{\\left(\\sqrt{a^{2}-b^{2}}\\right)^{3}}{3a^{2}} \\right]\n$$\nWe can rewrite $(\\sqrt{a^{2}-b^{2}})^{3}$ as $(a^{2}-b^{2})\\sqrt{a^{2}-b^{2}}$, which is equal to $(a^{2}-b^{2})^{3/2}$.\n$$\n\\tau = 2 \\sigma n_{0} \\left[ \\frac{(a^{2}-b^{2})^{3/2}}{a^{2}} - \\frac{(a^{2}-b^{2})^{3/2}}{3a^{2}} \\right]\n$$\nFactoring out the common term:\n$$\n\\tau = 2 \\sigma n_{0} \\frac{(a^{2}-b^{2})^{3/2}}{a^{2}} \\left(1 - \\frac{1}{3}\\right)\n$$\n$$\n\\tau = 2 \\sigma n_{0} \\frac{(a^{2}-b^{2})^{3/2}}{a^{2}} \\left(\\frac{2}{3}\\right)\n$$\n$$\n\\tau = \\frac{4}{3} \\sigma n_{0} \\frac{(a^{2}-b^{2})^{3/2}}{a^{2}}\n$$\nSubstituting this expression for the optical depth $\\tau$ back into the formula for the shine-through fraction gives the final closed-form expression:\n$$\n\\frac{I(L)}{I_{0}} = \\exp(-\\tau) = \\exp\\left(-\\frac{4}{3} \\sigma n_{0} \\frac{(a^{2}-b^{2})^{3/2}}{a^{2}}\\right)\n$$\nThis expression is in terms of the given parameters $n_{0}$, $a$, $b$, and $\\sigma$, as required.",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{4}{3} \\sigma n_{0} \\frac{\\left(a^{2}-b^{2}\\right)^{3/2}}{a^{2}}\\right)}\n$$"
        },
        {
            "introduction": "Building on the principle of beam attenuation, this next practice shifts our focus from pure physics to practical engineering constraints. In a real fusion device, excessive neutral beam shine-through can damage vessel components, necessitating strict operational limits on plasma density. This exercise requires you to calculate the minimum plasma density needed to keep the shine-through fraction below a given safety threshold, introducing realistic, energy-dependent cross-sections for ionization and charge exchange . This bridges the gap between fundamental theory and the operational realities of fusion experiments.",
            "id": "4019505",
            "problem": "A line-of-sight Neutral Beam Injection (NBI) system launches monoenergetic deuterium neutrals of beam energy $E_{b}$ through a uniform, singly ionized, quasi-neutral plasma slab of thickness $L$. The fraction of beam power that exits the plasma without being ionized or charge-exchanged, called the shine-through fraction $\\phi_{\\mathrm{st}}$, must remain below a prescribed safety limit $\\phi_{\\mathrm{safe}}$ to avoid excessive wall loading downstream. Starting from the kinetic picture that the removal of beam neutrals per unit length is proportional to the product of plasma density and an energy-dependent effective cross section, derive an expression for the minimum uniform plasma density $n_{\\min}$ that guarantees $\\phi_{\\mathrm{st}} \\le \\phi_{\\mathrm{safe}}$ for given $E_{b}$ and $L$.\n\nModel the effective removal cross section as the sum of electron-impact ionization and charge-exchange contributions,\n$$\n\\sigma_{\\mathrm{eff}}(E_{b}) \\equiv \\sigma_{i}(E_{b}) + \\sigma_{\\mathrm{cx}}(E_{b}),\n$$\nwith power-law scalings about a reference energy $E_{\\mathrm{ref}}$,\n$$\n\\sigma_{i}(E_{b}) = \\sigma_{i0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{i}}, \\quad \\sigma_{\\mathrm{cx}}(E_{b}) = \\sigma_{\\mathrm{cx}0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{\\mathrm{cx}}}.\n$$\nAssume quasi-neutrality with singly charged ions so that the electron density equals the ion density and can be represented by a single uniform value $n$ throughout the path; neglect angular scattering and energy loss of the surviving neutrals so that the power fraction equals the surviving particle fraction.\n\nGiven the following parameters: $E_{b} = 80\\,\\mathrm{keV}$, $L = 1.4\\,\\mathrm{m}$, $\\phi_{\\mathrm{safe}} = 0.03$, $E_{\\mathrm{ref}} = 100\\,\\mathrm{keV}$, $\\sigma_{i0} = 1.0 \\times 10^{-20}\\,\\mathrm{m^{2}}$, $\\alpha_{i} = 0.50$, $\\sigma_{\\mathrm{cx}0} = 2.0 \\times 10^{-20}\\,\\mathrm{m^{2}}$, and $\\alpha_{\\mathrm{cx}} = 0.80$.\n\nExpress your final density threshold $n_{\\min}$ in $\\mathrm{m^{-3}}$ and round your answer to four significant figures.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n- **System**: A line-of-sight Neutral Beam Injection (NBI) system.\n- **Beam**: Monoenergetic deuterium neutrals with energy $E_{b}$.\n- **Plasma**: A uniform, singly ionized, quasi-neutral plasma slab of thickness $L$.\n- **Shine-through fraction**: $\\phi_{\\mathrm{st}}$, the fraction of beam power exiting the plasma without interaction.\n- **Safety limit**: $\\phi_{\\mathrm{st}} \\le \\phi_{\\mathrm{safe}}$.\n- **Objective**: Derive an expression for the minimum uniform plasma density $n_{\\min}$ to satisfy the safety limit.\n- **Physical Model**: The removal of beam neutrals per unit length is proportional to the product of plasma density $n$ and an effective cross section $\\sigma_{\\mathrm{eff}}(E_{b})$.\n- **Cross Section Definition**: $\\sigma_{\\mathrm{eff}}(E_{b}) \\equiv \\sigma_{i}(E_{b}) + \\sigma_{\\mathrm{cx}}(E_{b})$.\n- **Cross Section Scalings**:\n  - Electron-impact ionization: $\\sigma_{i}(E_{b}) = \\sigma_{i0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{i}}$.\n  - Charge-exchange: $\\sigma_{\\mathrm{cx}}(E_{b}) = \\sigma_{\\mathrm{cx}0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{\\mathrm{cx}}}$.\n- **Assumptions**:\n  1. Quasi-neutrality with singly charged ions: electron density $n_e$ equals ion density $n_i$, and both are represented by a single value $n$.\n  2. The plasma density $n$ is uniform.\n  3. Angular scattering and energy loss of surviving neutrals are neglected, so the power fraction equals the surviving particle fraction.\n- **Given Parameters**:\n  - $E_{b} = 80\\,\\mathrm{keV}$\n  - $L = 1.4\\,\\mathrm{m}$\n  - $\\phi_{\\mathrm{safe}} = 0.03$\n  - $E_{\\mathrm{ref}} = 100\\,\\mathrm{keV}$\n  - $\\sigma_{i0} = 1.0 \\times 10^{-20}\\,\\mathrm{m^{2}}$\n  - $\\alpha_{i} = 0.50$\n  - $\\sigma_{\\mathrm{cx}0} = 2.0 \\times 10^{-20}\\,\\mathrm{m^{2}}$\n  - $\\alpha_{\\mathrm{cx}} = 0.80$\n- **Required Output**: $n_{\\min}$ in units of $\\mathrm{m^{-3}}$, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the principles of particle-matter interaction, specifically neutral beam attenuation in a plasma, which is a standard topic in fusion science and engineering. The use of a Beer-Lambert-like law for attenuation is a valid and common first-order model. The power-law scalings for cross sections are empirical but represent realistic approximations in the given energy range. The problem is well-posed, providing all necessary physical relationships, assumptions, and numerical constants to derive a unique solution for $n_{\\min}$. The language is objective and precise. The provided numerical values are physically realistic for a tokamak NBI system. The problem does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Solution Derivation\nLet $I(x)$ be the flux of neutral beam particles at a distance $x$ into the plasma slab. The problem states that the rate of removal of beam neutrals is proportional to the local neutral flux $I(x)$, the plasma density $n$, and the effective removal cross section $\\sigma_{\\mathrm{eff}}$. For a differential slab of thickness $dx$, the change in flux $dI$ is given by:\n$$\ndI = -I(x) \\, n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, dx\n$$\nThis is a first-order ordinary differential equation for $I(x)$. Since the plasma is uniform ($n$ is constant) and the beam is monoenergetic ($E_b$ is constant), the cross section $\\sigma_{\\mathrm{eff}}(E_{b})$ is also constant along the beam's path. We can rewrite the equation and integrate it across the plasma slab from $x=0$ to $x=L$.\n$$\n\\frac{dI}{I} = -n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, dx\n$$\nIntegrating from the entrance of the plasma ($x=0$, where flux is $I_0$) to the exit ($x=L$, where flux is $I_L$):\n$$\n\\int_{I_0}^{I_L} \\frac{dI}{I} = \\int_{0}^{L} -n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, dx\n$$\n$$\n[\\ln(I)]_{I_0}^{I_L} = -n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, [x]_{0}^{L}\n$$\n$$\n\\ln(I_L) - \\ln(I_0) = -n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\n$$\n$$\n\\ln\\left(\\frac{I_L}{I_0}\\right) = -n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\n$$\nExponentiating both sides gives the attenuation law:\n$$\n\\frac{I_L}{I_0} = \\exp\\left(-n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\\right)\n$$\nThe shine-through fraction $\\phi_{\\mathrm{st}}$ is defined as the fraction of beam power that exits, which, by the problem's assumption, is equal to the fraction of surviving particles, $I_L/I_0$.\n$$\n\\phi_{\\mathrm{st}} = \\exp\\left(-n \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\\right)\n$$\nThe safety requirement is $\\phi_{\\mathrm{st}} \\le \\phi_{\\mathrm{safe}}$. To find the minimum density $n_{\\min}$ that achieves this, we set $\\phi_{\\mathrm{st}}$ to its maximum allowed value, $\\phi_{\\mathrm{safe}}$:\n$$\n\\phi_{\\mathrm{safe}} = \\exp\\left(-n_{\\min} \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\\right)\n$$\nSolving for $n_{\\min}$, we take the natural logarithm of both sides:\n$$\n\\ln(\\phi_{\\mathrm{safe}}) = -n_{\\min} \\, \\sigma_{\\mathrm{eff}}(E_{b}) \\, L\n$$\n$$\nn_{\\min} = -\\frac{\\ln(\\phi_{\\mathrm{safe}})}{\\sigma_{\\mathrm{eff}}(E_{b}) \\, L}\n$$\nNow, we must compute the numerical value of $\\sigma_{\\mathrm{eff}}(E_{b})$. First, we calculate the individual cross sections using the given power-law scalings. The energy ratio is:\n$$\n\\frac{E_{b}}{E_{\\mathrm{ref}}} = \\frac{80\\,\\mathrm{keV}}{100\\,\\mathrm{keV}} = 0.8\n$$\nThe electron-impact ionization cross section is:\n$$\n\\sigma_{i}(E_{b}) = \\sigma_{i0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{i}} = (1.0 \\times 10^{-20}\\,\\mathrm{m^{2}}) \\times (0.8)^{-0.50}\n$$\n$$\n\\sigma_{i}(E_{b}) \\approx (1.0 \\times 10^{-20}) \\times 1.118034\\,\\mathrm{m^{2}} = 1.118034 \\times 10^{-20}\\,\\mathrm{m^{2}}\n$$\nThe charge-exchange cross section is:\n$$\n\\sigma_{\\mathrm{cx}}(E_{b}) = \\sigma_{\\mathrm{cx}0}\\left(\\frac{E_{b}}{E_{\\mathrm{ref}}}\\right)^{-\\alpha_{\\mathrm{cx}}} = (2.0 \\times 10^{-20}\\,\\mathrm{m^{2}}) \\times (0.8)^{-0.80}\n$$\n$$\n\\sigma_{\\mathrm{cx}}(E_{b}) \\approx (2.0 \\times 10^{-20}) \\times 1.195430\\,\\mathrm{m^{2}} = 2.390860 \\times 10^{-20}\\,\\mathrm{m^{2}}\n$$\nThe total effective cross section is the sum of these two:\n$$\n\\sigma_{\\mathrm{eff}}(E_{b}) = \\sigma_{i}(E_{b}) + \\sigma_{\\mathrm{cx}}(E_{b}) \\approx (1.118034 + 2.390860) \\times 10^{-20}\\,\\mathrm{m^{2}}\n$$\n$$\n\\sigma_{\\mathrm{eff}}(E_{b}) \\approx 3.508894 \\times 10^{-20}\\,\\mathrm{m^{2}}\n$$\nFinally, we substitute the values for $\\phi_{\\mathrm{safe}}$, $L$, and $\\sigma_{\\mathrm{eff}}(E_{b})$ into the expression for $n_{\\min}$:\n$$\nn_{\\min} = -\\frac{\\ln(0.03)}{(3.508894 \\times 10^{-20}\\,\\mathrm{m^{2}}) \\times (1.4\\,\\mathrm{m})}\n$$\n$$\nn_{\\min} \\approx -\\frac{-3.506558}{4.912452 \\times 10^{-20}\\,\\mathrm{m^{3}}}\n$$\n$$\nn_{\\min} \\approx 0.713809 \\times 10^{20}\\,\\mathrm{m^{-3}}\n$$\n$$\nn_{\\min} \\approx 7.13809 \\times 10^{19}\\,\\mathrm{m^{-3}}\n$$\nRounding the result to four significant figures gives:\n$$\nn_{\\min} = 7.138 \\times 10^{19}\\,\\mathrm{m^{-3}}\n$$",
            "answer": "$$\n\\boxed{7.138 \\times 10^{19}}\n$$"
        },
        {
            "introduction": "Our previous models treated the neutral beam as an idealized, infinitesimally thin 'pencil beam'. In reality, beams have a finite cross-section and divergence, which broadens the deposition profile and reduces its peak value. This computational practice introduces convolution as the mathematical framework for modeling this physical broadening effect. You will implement a numerical convolution of an idealized deposition profile with a Gaussian kernel to calculate the realistic, broadened profile and quantify the reduction in its peak power density .",
            "id": "4019522",
            "problem": "Consider Neutral Beam Injection (NBI) heating in a toroidal fusion plasma, approximated along the minor-radius line by a one-dimensional, signed radial coordinate $r$ in meters. A pencil-beam volumetric deposition profile $S_0(r)$ in $\\mathrm{W\\,m^{-3}}$ represents the idealized centerline deposition without beam divergence. The finite angular divergence and optical blur of the neutral beam are modeled by a Gaussian envelope $G(r)$ with standard deviation $\\sigma_G$ in meters, normalized to unit area. The broadened deposition profile $S(r)$ is defined by the convolution integral\n$$\nS(r) = \\int_{-\\infty}^{\\infty} S_0(r')\\,G(r - r')\\,dr' \\quad ,\n$$\nwith\n$$\nG(r) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_G}\\,\\exp\\left(-\\frac{r^2}{2\\sigma_G^2}\\right) \\quad ,\n$$\nso that $\\int_{-\\infty}^{\\infty} G(r)\\,dr = 1$. The peak reduction factor $\\mathcal{R}$ is the dimensionless ratio\n$$\n\\mathcal{R} = \\frac{S(0)}{S_0(0)} \\quad .\n$$\nFrom first principles, you must implement the convolution by numerical quadrature using a discretized grid and compute $\\mathcal{R}$ for each test case. Your program must sample $r$ uniformly over $[-0.5,\\,0.5]\\,\\mathrm{m}$ with $N = 65536$ points and use a Riemann-sum approximation to the integral. Only the peak reduction factor $\\mathcal{R}$ (dimensionless) is required as the final quantity for each test case.\n\nUse the following test suite of pencil-beam profiles $S_0(r)$ and Gaussian envelope widths $\\sigma_G$, with all amplitudes in $\\mathrm{W\\,m^{-3}}$ and all lengths in $\\mathrm{m}$:\n\n- Test case $1$ (\"Gaussian pencil-beam\"):\n  - $S_0(r) = S_{00}\\,\\exp\\left(-\\frac{r^2}{2\\sigma_0^2}\\right)$\n  - $S_{00} = 2.0\\times 10^{6}\\,\\mathrm{W\\,m^{-3}}$\n  - $\\sigma_0 = 0.015\\,\\mathrm{m}$\n  - $\\sigma_G = 0.010\\,\\mathrm{m}$\n\n- Test case $2$ (\"Top-hat pencil-beam\"):\n  - $S_0(r) = S_{00}$ for $|r| \\le \\frac{w_0}{2}$, and $S_0(r) = 0$ otherwise\n  - $S_{00} = 1.5\\times 10^{6}\\,\\mathrm{W\\,m^{-3}}$\n  - $w_0 = 0.010\\,\\mathrm{m}$\n  - $\\sigma_G = 0.015\\,\\mathrm{m}$\n\n- Test case $3$ (\"Near-delta envelope limit\"):\n  - $S_0(r) = S_{00}\\,\\exp\\left(-\\frac{r^2}{2\\sigma_0^2}\\right)$\n  - $S_{00} = 1.0\\times 10^{6}\\,\\mathrm{W\\,m^{-3}}$\n  - $\\sigma_0 = 0.008\\,\\mathrm{m}$\n  - $\\sigma_G = 1.0\\times 10^{-4}\\,\\mathrm{m}$\n\n- Test case $4$ (\"Strong blur limit\"):\n  - $S_0(r) = S_{00}\\,\\exp\\left(-\\frac{r^2}{2\\sigma_0^2}\\right)$\n  - $S_{00} = 2.0\\times 10^{6}\\,\\mathrm{W\\,m^{-3}}$\n  - $\\sigma_0 = 0.005\\,\\mathrm{m}$\n  - $\\sigma_G = 0.050\\,\\mathrm{m}$\n\nImplementation requirements and assumptions:\n- Discretize $r$ over $[-0.5,\\,0.5]\\,\\mathrm{m}$ using $N = 65536$ samples. Let $\\Delta r$ be the grid spacing in meters.\n- Construct $S_0(r)$ according to each test case definition.\n- Construct the Gaussian envelope $G(r)$ as given, ensuring unit-area normalization on the continuous domain. On the discrete grid, approximate the integral by a Riemann sum, so that $S(0) \\approx \\Delta r \\sum_{k=0}^{N-1} S_0(r_k)\\,G(r_k)$.\n- Compute $S_0(0)$ from the sampled $S_0(r)$ at $r=0$.\n- Compute the peak reduction factor $\\mathcal{R} = S(0)/S_0(0)$ for each test case.\n\nYour program should produce a single line of output containing the four $\\mathcal{R}$ values as a comma-separated list enclosed in square brackets, with each value formatted to six decimal places (e.g., $[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4]$). The output $\\mathcal{R}$ values must be dimensionless. No other text should be printed.",
            "solution": "The problem asks for the computation of the peak reduction factor, $\\mathcal{R}$, for a neutral beam deposition profile in a fusion plasma that is broadened by physical effects. The solution requires developing a numerical algorithm based on the provided physical model and implementation specifications.\n\nThe core physical process is the broadening of an idealized pencil-beam deposition profile, $S_0(r)$, into a more realistic profile, $S(r)$, due to effects like beam divergence. This broadening is mathematically modeled as a convolution of the initial profile $S_0(r)$ with a Gaussian blurring kernel $G(r)$. The convolution is given by the integral:\n$$\nS(r) = (S_0 * G)(r) = \\int_{-\\infty}^{\\infty} S_0(r')\\,G(r - r')\\,dr'\n$$\nThe Gaussian kernel $G(r)$ is defined as:\n$$\nG(r) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_G}\\,\\exp\\left(-\\frac{r^2}{2\\sigma_G^2}\\right)\n$$\nwhere $\\sigma_G$ is the standard deviation representing the extent of the blur. This function is normalized such that its integral over the entire domain is unity, $\\int_{-\\infty}^{\\infty} G(r)\\,dr = 1$.\n\nThe quantity of interest is the peak reduction factor $\\mathcal{R}$, defined as the ratio of the peak of the broadened profile to the peak of the original profile:\n$$\n\\mathcal{R} = \\frac{S(0)}{S_0(0)}\n$$\nTo calculate $\\mathcal{R}$, we first need an expression for $S(0)$. By substituting $r=0$ into the convolution integral, we get:\n$$\nS(0) = \\int_{-\\infty}^{\\infty} S_0(r')\\,G(0 - r')\\,dr' = \\int_{-\\infty}^{\\infty} S_0(r')\\,G(-r')\\,dr'\n$$\nThe Gaussian function is an even function, meaning $G(-r') = G(r')$. This property simplifies the expression for $S(0)$ to:\n$$\nS(0) = \\int_{-\\infty}^{\\infty} S_0(r')\\,G(r')\\,dr'\n$$\nThis result is significant because it shows that to find the peak of the broadened profile, $S(0)$, we do not need to compute the full convolution for all $r$. Instead, we only need to compute a single definite integral of the product of the two original functions.\n\nThe problem requires a numerical approach to compute this integral. We will use a Riemann sum approximation on a discrete grid. The steps for the numerical implementation are as follows:\n\n1.  **Grid Discretization**: The continuous radial coordinate $r$ is discretized over the interval $[-0.5, 0.5]\\,\\mathrm{m}$ into $N = 65536$ points. The problem statement requires sampling at $r=0$ to obtain $S_0(0)$. With an even number of points $N$, a standard grid including both endpoints (like `numpy.linspace(start, stop, N)`) would not contain a point at $r=0$. Therefore, to ensure consistency with all stated requirements, the interval is interpreted as $[-0.5, 0.5)$, excluding the right endpoint. This defines a grid with spacing $\\Delta r = (0.5 - (-0.5))/N = 1/N$, and the grid points are $r_k = -0.5 + k \\cdot \\Delta r$ for $k \\in \\{0, 1, \\dots, N-1\\}$. For $N=65536$, the point $r=0$ corresponds to the index $k = N/2 = 32768$.\n\n2.  **Function Sampling**: The functions $S_0(r)$ and $G(r)$ are evaluated at each point $r_k$ on the discrete grid to create arrays of their values, which we denote as $S_{0,k}$ and $G_k$. For each test case, the specific form and parameters of $S_0(r)$ are used.\n\n3.  **Numerical Integration**: The integral for $S(0)$ is approximated by a Riemann sum:\n    $$\n    S(0) \\approx \\sum_{k=0}^{N-1} S_0(r_k)\\,G(r_k)\\,\\Delta r\n    $$\n    This is a direct application of the numerical integration rule specified. The chosen integration domain of $[-0.5, 0.5]\\,\\mathrm{m}$ is a valid approximation for the infinite integral because the characteristic widths of the functions (in the range of $0.005\\,\\mathrm{m}$ to $0.05\\,\\mathrm{m}$) ensure that the function values are negligible at the domain boundaries.\n\n4.  **Peak Value Calculation**: The value $S_0(0)$ is the peak of the unbroadened profile. Since the grid is constructed to include $r=0$, this value can be directly obtained by sampling $S_0(r)$ at $r=0$. For all test cases provided, the analytical form of $S_0(r)$ is centered at $r=0$ and its peak value is given by the parameter $S_{00}$. Thus, $S_0(0) = S_{00}$.\n\n5.  **Ratio Computation**: Finally, the peak reduction factor $\\mathcal{R}$ is calculated by dividing the numerically computed $S(0)$ by the peak value $S_0(0)$.\n\nThis procedure is applied to each of the four test cases specified:\n- **Case 1**: A Gaussian pencil-beam convolved with a Gaussian envelope. The result is analytically known to be another Gaussian, providing a means to verify the numerical implementation.\n- **Case 2**: A top-hat (rectangular) pencil-beam convolved with a Gaussian. This tests the algorithm with a discontinuous function.\n- **Case 3**: A Gaussian pencil-beam convolved with a very narrow Gaussian envelope, approaching a Dirac delta function. In this limit, the convolution should return the original function, so $\\mathcal{R}$ should be very close to $1$.\n- **Case 4**: A narrow Gaussian pencil-beam convolved with a very wide Gaussian envelope. This represents a strong blurring effect, which should lead to a significant peak reduction, i.e., a small value of $\\mathcal{R}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the peak reduction factor for neutral beam deposition profiles\n    based on a convolution model, computed via numerical quadrature.\n    \"\"\"\n    \n    # Define grid parameters as per the problem statement.\n    N = 65536\n    r_min, r_max = -0.5, 0.5  # meters\n    \n    # Discretize the radial coordinate r.\n    # The interval is interpreted as [r_min, r_max) to ensure r=0 is a grid point\n    # for an even N, which is required to sample S0(0) directly as instructed.\n    # The grid spacing dr will be (r_max - r_min) / N.\n    r, dr = np.linspace(r_min, r_max, N, endpoint=False, retstep=True)\n\n    # Define the test cases from the problem statement.\n    # Units: S00 in W/m^3; sigma0, w0, sigmaG in m.\n    test_cases = [\n        # Case 1: Gaussian pencil-beam\n        {'type': 'gaussian', 'S00': 2.0e6, 'sigma0': 0.015, 'sigmaG': 0.010},\n        # Case 2: Top-hat pencil-beam\n        {'type': 'tophat', 'S00': 1.5e6, 'w0': 0.010, 'sigmaG': 0.015},\n        # Case 3: Near-delta envelope limit\n        {'type': 'gaussian', 'S00': 1.0e6, 'sigma0': 0.008, 'sigmaG': 1.0e-4},\n        # Case 4: Strong blur limit\n        {'type': 'gaussian', 'S00': 2.0e6, 'sigma0': 0.005, 'sigmaG': 0.050},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Construct the pencil-beam profile S0(r) on the discrete grid.\n        if case['type'] == 'gaussian':\n            S0_r = case['S00'] * np.exp(-r**2 / (2 * case['sigma0']**2))\n        elif case['type'] == 'tophat':\n            S0_r = np.where(np.abs(r) <= case['w0'] / 2, case['S00'], 0.0)\n\n        # Construct the Gaussian envelope G(r) on the discrete grid.\n        sigmaG = case['sigmaG']\n        G_r = (1 / (np.sqrt(2 * np.pi) * sigmaG)) * np.exp(-r**2 / (2 * sigmaG**2))\n\n        # Calculate S(0) via Riemann sum approximation of the integral:\n        # S(0) = integral(S0(r) * G(r) dr)\n        S_at_0 = np.sum(S0_r * G_r) * dr\n\n        # The peak of the original profile, S0(0), is the amplitude S00, as\n        # all profiles are centered at r=0 and the grid includes r=0.\n        S0_peak = case['S00']\n        \n        # Calculate the dimensionless peak reduction factor R.\n        R_factor = S_at_0 / S0_peak\n        results.append(R_factor)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'{res:.6f}' for res in results])}]\")\n\nsolve()\n```"
        }
    ]
}