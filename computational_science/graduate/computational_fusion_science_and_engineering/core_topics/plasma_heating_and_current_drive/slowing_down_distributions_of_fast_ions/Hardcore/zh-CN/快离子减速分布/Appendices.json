{
    "hands_on_practices": [
        {
            "introduction": "宏观的慢化模型，如福克-普朗克方程，其有效性根植于对微观碰撞物理的深刻理解。库仑对数项中的最小碰撞参数 $b_{\\min}$ 是一个关键参数，其取值由经典和量子效应的竞争决定。本练习将引导你通过第一性原理推导这两个物理机制对应的 $b_{\\min}$ 表达式，并确定量子衍射效应开始占主导地位的能量阈值，从而加深对动理学模型中输运系数物理起源的理解。",
            "id": "4045187",
            "problem": "在磁约束的氘氚等离子体中，快阿尔法粒子的减速过程由小角度库仑碰撞主导。在动力学处理中，双体碰撞的库仑对数在小尺度上通过一个最小碰撞参数进行正则化。两个相互竞争的物理机制设定了这个下限截止值：经典的最近距离和量子衍射。对于一个速度为 $v$ 的阿尔法粒子与背景电子发生弹性碰撞，考虑其相对运动，其折合质量为 $m_{r}$，背景电荷数（绝对值）为 $Z_{2}$，与阿尔法粒子的电荷数 $Z_{1}=2$ 相互作用。\n\n- 从库仑散射和波粒二象性的第一性原理出发，利用 Rutherford 散射中近似直角偏转的判据，写出经典小尺度截止值 $b_{\\mathrm{c}}(v)$；并利用相对运动的德布罗意波长，写出量子衍射截止值 $b_{\\mathrm{q}}(v)$。\n- 通过求解 $b_{\\mathrm{c}}(v_{\\ast})=b_{\\mathrm{q}}(v_{\\ast})$，确定两个截止值相等时的阈值速度 $v_{\\ast}$。\n- 针对电子靶（$Z_{2}=1$）的特殊情况，找出相应的阿尔法粒子动能阈值 $E_{\\ast}=\\frac{1}{2}m_{\\alpha}v_{\\ast}^{2}$。当能量高于此阈值时，量子衍射效应决定了最小碰撞参数。\n- 将你的最终答案 $E_{\\ast}$ 以千电子伏（keV）为单位表示，并四舍五入到四位有效数字。\n\n按需使用以下基本常数：精细结构常数 $\\alpha=\\frac{e^{2}}{4\\pi\\varepsilon_{0}\\hbar c}=7.2973525693\\times 10^{-3}$，以及阿尔法粒子的静止能量 $m_{\\alpha}c^{2}=3727.379378~\\mathrm{MeV}$。假设在阈值处为非相对论性运动学，且相对速度由阿尔法粒子的速度决定（即，在你确定的阈值处，电子的热速度与 $v_{\\ast}$ 相比可以忽略不计）。",
            "solution": "问题陈述被认为是有效的。它具有科学依据，内部一致且提法恰当，允许基于经典力学和量子力学的基本原理得出一个唯一且有意义的解。所提供的假设虽然简化了真实的等离子体环境，但陈述清晰，有助于对核心物理问题进行集中分析。\n\n我们首先推导库仑碰撞中最小碰撞参数的两个相互竞争的截止值的表达式。问题考虑一个阿尔法粒子（电荷为 $Z_1 e$，质量为 $m_{\\alpha}$）与一个背景电子（电荷为 $-Z_2 e$，$Z_2=1$，质量为 $m_e$）发生碰撞。该相互作用在双粒子系统的质心坐标系中进行分析，该系统由折合质量 $m_r$ 和相对速度 $v$ 来表征。问题指明相对速度约等于阿尔法粒子的速度 $v$。\n\n首先，我们确定经典截止值 $b_{\\mathrm{c}}(v)$。它由导致大角度散射的碰撞参数定义，通常取偏转角为 $\\theta = \\frac{\\pi}{2}$ 弧度（$90^{\\circ}$）。根据 Rutherford 散射公式，碰撞参数 $b$、质心散射角 $\\theta$ 和相对运动动能 $E_{r}$ 之间的关系是：\n$$ \\tan\\left(\\frac{\\theta}{2}\\right) = \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0} \\frac{1}{2 E_{r} b} $$\n相对动能为 $E_{r} = \\frac{1}{2}m_{r}v^2$。对于 $90^{\\circ}$ 的偏转，$\\theta = \\frac{\\pi}{2}$，且 $\\tan(\\frac{\\pi}{4}) = 1$。将这些代入公式，得到经典截止值 $b_{\\mathrm{c}}(v)$：\n$$ 1 = \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0} \\frac{1}{2 \\left(\\frac{1}{2}m_{r}v^2\\right) b_{\\mathrm{c}}(v)} = \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0 m_{r}v^2 b_{\\mathrm{c}}(v)} $$\n解出 $b_{\\mathrm{c}}(v)$：\n$$ b_{\\mathrm{c}}(v) = \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0 m_{r} v^2} $$\n\n其次，我们确定量子衍射截止值 $b_{\\mathrm{q}}(v)$。这个截止值由粒子的波动性设定。当碰撞参数小于相对运动的德布罗意波长时，由于不确定性原理，经典轨道概念失效。相关的长度尺度是约化德布罗意波长 $\\lambdabar_r$，它与相对动量 $p_r = m_r v$ 相关联。\n$$ b_{\\mathrm{q}}(v) = \\lambdabar_r = \\frac{\\hbar}{p_r} = \\frac{\\hbar}{m_r v} $$\n\n阈值速度 $v_{\\ast}$ 是这两个截止值相等时的速度，即 $b_{\\mathrm{c}}(v_{\\ast}) = b_{\\mathrm{q}}(v_{\\ast})$。\n$$ \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0 m_{r} v_{\\ast}^2} = \\frac{\\hbar}{m_r v_{\\ast}} $$\n我们可以从等式两边消去一个因子 $m_r v_{\\ast}$（因为 $m_r \\neq 0$ 且 $v_{\\ast} \\neq 0$）。值得注意的是，折合质量 $m_r$ 完全消去了，这意味着阈值速度与粒子质量无关。\n$$ \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0 v_{\\ast}} = \\hbar $$\n解出 $v_{\\ast}$：\n$$ v_{\\ast} = \\frac{Z_1 Z_2 e^2}{4\\pi\\varepsilon_0 \\hbar} $$\n这个表达式可以用精细结构常数 $\\alpha = \\frac{e^2}{4\\pi\\varepsilon_0 \\hbar c}$ 优雅地重写。\n$$ v_{\\ast} = Z_1 Z_2 \\left(\\frac{e^2}{4\\pi\\varepsilon_0 \\hbar c}\\right) c = Z_1 Z_2 \\alpha c $$\n\n问题要求的是阿尔法粒子在该阈值速度下的动能 $E_{\\ast}$。对于非相对论性速度，动能由 $E = \\frac{1}{2}m_{\\alpha}v^2$ 给出。\n$$ E_{\\ast} = \\frac{1}{2}m_{\\alpha}v_{\\ast}^2 = \\frac{1}{2}m_{\\alpha} (Z_1 Z_2 \\alpha c)^2 $$\n我们可以用阿尔法粒子的静止能量 $m_{\\alpha}c^2$ 来重新整理这个表达式：\n$$ E_{\\ast} = \\frac{1}{2} (Z_1 Z_2)^2 \\alpha^2 (m_{\\alpha}c^2) $$\n\n现在，我们针对给定的碰撞粒子进行具体化：一个阿尔法粒子（$Z_1=2$）和一个电子（$Z_2=1$）。\n$$ E_{\\ast} = \\frac{1}{2} (2 \\times 1)^2 \\alpha^2 (m_{\\alpha}c^2) = \\frac{1}{2} (4) \\alpha^2 (m_{\\alpha}c^2) = 2 \\alpha^2 (m_{\\alpha}c^2) $$\n对于阿尔法粒子能量 $E > E_{\\ast}$，量子衍射效应占主导地位，因为更高的能量（因此更高的速度）使得经典最近距离 $b_c \\propto 1/v^2$ 的减小速度快于量子波长 $b_q \\propto 1/v$ 的减小速度。\n\n最后，我们代入给定的数值，以千电子伏（keV）为单位计算 $E_{\\ast}$。\n已知：\n$m_{\\alpha}c^2 = 3727.379378~\\mathrm{MeV} = 3727379.378~\\mathrm{keV}$\n$\\alpha = 7.2973525693 \\times 10^{-3}$\n\n首先，我们计算 $\\alpha^2$：\n$$ \\alpha^2 = (7.2973525693 \\times 10^{-3})^2 \\approx 5.32513556 \\times 10^{-5} $$\n现在，我们计算 $E_{\\ast}$：\n$$ E_{\\ast} = 2 \\times (5.32513556 \\times 10^{-5}) \\times (3727379.378~\\mathrm{keV}) $$\n$$ E_{\\ast} \\approx (1.06502711 \\times 10^{-4}) \\times (3727379.378~\\mathrm{keV}) $$\n$$ E_{\\ast} \\approx 396.99641~\\mathrm{keV} $$\n按要求四舍五入到四位有效数字，得到：\n$$ E_{\\ast} \\approx 397.0~\\mathrm{keV} $$\n非相对论性假设是合理的，因为 $v_{\\ast} = 2 \\alpha c \\approx 0.0146 c$，远小于光速。",
            "answer": "$$\n\\boxed{397.0}\n$$"
        },
        {
            "introduction": "从微观物理过渡到宏观模型，我们可以使用简化的福克-普朗克方程来描述高能离子群由于与背景等离子体碰撞阻力而逐渐减速的过程。本练习是计算物理学中的一个核心实践：首先为理想化的慢化模型推导解析解，然后构建一个数值求解器来复现该解并进行基准测试。这个验证过程对于开发可靠的模拟工具至关重要，也是连接理论分析与计算模拟的关键桥梁。",
            "id": "4045191",
            "problem": "考虑一个各向同性的快离子布居，以单能速率 $v_0$ 注入到均匀等离子体中。令 $f(v,t)$ 表示各向同性速度分布函数，其中 $v$ 是粒子速率。定义速率空间密度 $n(v,t) = 4\\pi v^2 f(v,t)$，因此粒子数密度为 $\\int_0^\\infty n(v,t)\\,\\mathrm{d}v$。忽略速度空间扩散和螺距角散射，并假设存在经典库仑减速阻力。$n(v,t)$ 的时间演化由速率空间中的一维守恒律控制：\n$$\n\\frac{\\partial n(v,t)}{\\partial t} + \\frac{\\partial}{\\partial v}\\Big(A(v)\\,n(v,t)\\Big) = S(v),\n$$\n其中 $A(v) = \\frac{\\mathrm{d}v}{\\mathrm{d}t}$ 是速率空间漂移（阻力），$S(v)$ 是单位速率的各向同性源密度。在经典临界速率模型中，取\n$$\nA(v) = -\\Gamma\\,\\frac{v^3 + v_c^3}{v^2},\n$$\n其中 $\\Gamma>0$ 是一个单位为 $\\mathrm{s}^{-1}$ 的常数，$v_c>0$ 是临界速率（单位为 $\\mathrm{m/s}$），它表征了从电子主导减速到离子主导减速的过渡。单能各向同性源表示为\n$$\nS(v) = S_0\\,\\delta(v - v_0),\n$$\n其中 $S_0$ 是单位体积、单位时间的注入率，单位为 $\\mathrm{m}^{-3}\\mathrm{s}^{-1}$，$\\delta(\\cdot)$ 是狄拉克δ函数。计算域为 $v\\in[v_{\\min},v_{\\max}]$，其中 $v_{\\min}>0$。\n\n您的任务是为上述守恒律设计并实现一个数值求解器，以获得稳态解 $f(v)$，并将其与从同一模型推导出的经典减速分布的解析稳态解进行基准测试。具体而言：\n\n1. 从守恒律和给定的 $A(v)$ 和 $S(v)$ 出发，使用第一性原理推导解析稳态解 $f(v)$。不要假设或引用任何目标公式；从基本方程出发进行逻辑推导。\n\n2. 在具有 $N$ 个单元的均匀网格上，实现一个速率空间中的有限体积、一阶迎风格式，对时间相关方程进行积分直至达到稳态。使用以下边界条件：在 $v=v_{\\min}$ 处为吸收性流出（无来自 $v  v_{\\min}$ 的流入），在上边界 $v_{\\max}$ 处为零流入。将源项在包含 $v_0$ 的单个单元格中离散化为 $S_i = S_0/\\Delta v$。使用显式时间积分，其步长 $\\Delta t$ 满足CFL条件 $\\Delta t \\le \\mathrm{CFL}\\cdot \\Delta v / \\max_v |A(v)|$，其中CFL因子小于1。积分足够长的时间（例如，几个输运时间 $\\tau = \\int_{v_{\\min}}^{v_0}\\mathrm{d}v/|A(v)|$）以达到稳态。\n\n3. 针对下表中给出的四种测试情况，运行您的求解器。对于每种情况，通过计算均方根相对误差（RMSE）和最大相对误差（$E_{\\infty}$）来量化数值解与解析解之间的一致性。误差应在减速域 $v \\le v_0$ 的网格点上进行评估。\n\n测试情况：\n| 参数 | 情况 1 | 情况 2 | 情况 3 | 情况 4 |\n| :--- | :---: | :---: | :---: | :---: |\n| $v_{\\min}$ | $2.0 \\times 10^5$ | $2.0 \\times 10^5$ | $2.0 \\times 10^5$ | $2.0 \\times 10^5$ |\n| $v_{\\max}$ | $2.0 \\times 10^6$ | $2.0 \\times 10^6$ | $2.0 \\times 10^6$ | $2.0 \\times 10^6$ |\n| $N$ | 400 | 400 | 400 | 400 |\n| $v_0$ | $1.2 \\times 10^6$ | $1.9 \\times 10^6$ | $1.2 \\times 10^6$ | $2.3 \\times 10^5$ |\n| $v_c$ | $5.0 \\times 10^5$ | $5.0 \\times 10^5$ | $1.0 \\times 10^5$ | $5.0 \\times 10^5$ |\n| $\\Gamma$ | 50.0 | 50.0 | 50.0 | 50.0 |\n| $S_0$ | $1.0 \\times 10^{19}$ | $1.0 \\times 10^{19}$ | $1.0 \\times 10^{19}$ | $1.0 \\times 10^{19}$ |\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的列表，列表由四个形如 `[rmse, e_inf]` 的子列表组成，每个子列表对应一种测试情况的结果。",
            "solution": "用户提供了一个来自计算聚变科学的问题，涉及等离子体中快离子的减速过程。任务是推导快离子分布函数的解析稳态解，为时间相关的控制方程实现一个数值求解器，并将数值稳态结果与解析解进行基准测试。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n- **控制方程：** 速率空间密度 $n(v,t)$ 的时间演化由守恒律给出：\n$$\n\\frac{\\partial n(v,t)}{\\partial t} + \\frac{\\partial}{\\partial v}\\Big(A(v)\\,n(v,t)\\Big) = S(v)\n$$\n- **分布函数：** 速率空间密度 $n(v,t)$ 通过 $n(v,t) = 4\\pi v^2 f(v,t)$ 与各向同性速度分布函数 $f(v,t)$ 相关。\n- **速率空间漂移（阻力）：** 阻力项由经典临界速率模型给出：\n$$\nA(v) = -\\Gamma\\,\\frac{v^3 + v_c^3}{v^2}\n$$\n其中常数 $\\Gamma > 0$ 和 $v_c > 0$。\n- **源项：** 单能各向同性源由以下公式给出：\n$$\nS(v) = S_0\\,\\delta(v - v_0)\n$$\n其中 $S_0$ 是注入率。\n- **计算域：** $v \\in [v_{\\min}, v_{\\max}]$，其中 $v_{\\min} > 0$。\n- **边界条件：** 在 $v=v_{\\min}$ 处为吸收性流出，在 $v=v_{\\max}$ 处为零流入。\n- **数值格式：** 在具有 $N$ 个单元的均匀网格上采用一阶迎风有限体积法。\n- **源离散化：** 源项在包含 $v_0$ 的单个单元中离散化为 $S_i = S_0/\\Delta v$，在其他地方 $S_i=0$，其中 $\\Delta v$ 是网格间距。\n- **时间步进：** 采用显式时间积分，步长 $\\Delta t$ 满足 CFL 条件 $\\Delta t \\le \\mathrm{CFL}\\cdot \\Delta v / \\max_v |A(v)|$，其中 $\\mathrm{CFL}  1$。\n- **模拟时间：** 积分进行到一个平流输运时间 $\\tau = \\int_{v_{\\min}}^{v_0}\\mathrm{d}v/|A(v)|$ 的倍数为止。\n- **误差度量：** 均方根相对误差（$\\mathrm{RMSE}$）和最大相对误差（$E_{\\infty}$）将在 $v \\le v_0$ 的网格点上计算。\n- **测试用例：** 提供了四组参数 $(v_{\\min}, v_{\\max}, N, v_0, v_c, \\Gamma, S_0)$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n- **科学依据：** 该问题基于通过库仑碰撞实现快离子经典减速的标准、成熟模型。控制方程是一个简化的（仅含漂移项）Fokker-Planck方程，阻力项 $A(v)$ 正确地表示了在背景离子（$v^3$ 项）和电子（$v_c^3$ 项）上的综合减速效应。整个设置是等离子体物理和聚变科学中的一个教科书级示例。\n- **良构性：** 该问题是一个带源项的线性一阶双曲型偏微分方程。给定初始条件（例如，$n(v,0)=0$）、边界条件和源，存在唯一解。相应的稳态问题是一个一阶常微分方程，可以直接求解。所用的数值格式（一阶迎风）在指定的CFL条件下对此类方程是稳定的。\n- **客观性：** 所有参数和方程都以数学精度定义。没有主观性或模糊性。\n- **完整性和一致性：** 该问题是自洽的，提供了所有必要的物理和数值参数，包括域、边界条件、源的离散化方法和误差度量。\n- **可行性：** 测试用例中给出的物理参数对于聚变环境（例如，中性束注入离子）是现实的。数值任务是标准的，并且在计算上是可行的。\n\n**步骤3：结论与行动**\n\n该问题在科学上是合理的、良构的且完整的。它代表了计算物理学中一个标准的验证和确认练习。该问题是**有效的**。我们继续进行求解。\n\n---\n\n### 解答\n\n解答是按照问题陈述中概述的步骤进行的。\n\n**1. 解析稳态解**\n\n在稳态下，$\\frac{\\partial n}{\\partial t} = 0$。守恒律简化为关于通量 $F(v) = A(v)n(v)$ 的常微分方程：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}v}\\Big(A(v)\\,n(v)\\Big) = S(v) = S_0\\,\\delta(v - v_0)\n$$\n我们将此方程对 $v$ 从速率 $v$ 积分到上边界 $v_{\\max}$。\n$$\n\\int_{v}^{v_{\\max}} \\frac{\\mathrm{d}}{\\mathrm{d}v'} \\Big(A(v')\\,n(v')\\Big) \\, \\mathrm{d}v' = \\int_{v}^{v_{\\max}} S_0\\,\\delta(v' - v_0) \\, \\mathrm{d}v'\n$$\n这得到：\n$$\n\\Big[A(v')\\,n(v')\\Big]_{v}^{v_{\\max}} = S_0 \\int_{v}^{v_{\\max}} \\delta(v' - v_0) \\, \\mathrm{d}v'\n$$\n$$\nA(v_{\\max})n(v_{\\max}) - A(v)n(v) = S_0 \\cdot \\begin{cases} 1  \\text{if } v  v_0  v_{\\max} \\\\ 0  \\text{if } v > v_0 \\end{cases}\n$$\n源在 $v=v_0$ 处注入粒子，而漂移 $A(v)=-\\Gamma(v^3+v_c^3)/v^2$ 对于 $v>0$ 总是负的，导致粒子减速（向更低的 $v$ 移动）。因此，在大于注入速率的速率下不应存在粒子，即对于 $v > v_0$，$n(v) = 0$。这意味着 $n(v_{\\max}) = 0$，所以上边界的通量 $A(v_{\\max})n(v_{\\max})$ 为零。方程简化为：\n$$\n-A(v)n(v) = S_0 H(v_0 - v)\n$$\n其中 $H$ 是亥维赛阶跃函数。对于减速区域 $v \\le v_0$，我们有：\n$$\nn(v) = -\\frac{S_0}{A(v)} = -\\frac{S_0}{-\\Gamma\\,\\frac{v^3 + v_c^3}{v^2}} = \\frac{S_0}{\\Gamma} \\frac{v^2}{v^3 + v_c^3} \\quad (\\text{对于 } v_{\\min} \\le v \\le v_0)\n$$\n对于 $v>v_0$，$n(v) = 0$。使用关系式 $f(v) = n(v) / (4\\pi v^2)$，我们得到经典减速分布的解析稳态解 $f_{\\mathrm{cl}}(v)$:\n$$\nf_{\\mathrm{cl}}(v) = \\begin{cases} \\frac{S_0}{4\\pi\\Gamma} \\frac{1}{v^3 + v_c^3}  \\text{for } v_{\\min} \\le v \\le v_0 \\\\ 0  \\text{for } v > v_0 \\end{cases}\n$$\n在 $v=v_0$ 处，分布是不连续的。\n\n**2. 有限体积数值格式**\n\n我们将域 $[v_{\\min}, v_{\\max}]$ 离散化为 $N$ 个宽度为 $\\Delta v = (v_{\\max} - v_{\\min}) / N$ 的均匀单元。单元中心为 $v_i = v_{\\min} + (i+0.5)\\Delta v$，其中 $i=0, \\dots, N-1$。对控制方程在单元 $i$ 上积分得到：\n$$\n\\frac{\\mathrm{d}n_i}{\\mathrm{d}t} \\Delta v + F_{i+1/2} - F_{i-1/2} = S_i \\Delta v\n$$\n其中 $n_i$ 是单元平均密度，$F_{i\\pm1/2}$ 是单元面上的通量。半离散形式为 $\\frac{\\mathrm{d}n_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta v}(F_{i+1/2} - F_{i-1/2}) + S_i$。\n对于一阶迎风格式，面上的数值通量由迎风单元的值确定。由于对于所有 $v>0$，$A(v)  0$，流动总是从较高的 $v$ 到较低的 $v$（在网格上从右到左）。因此，对于位于 $v_{i+1/2}$ 的面，其通量由右侧单元 $i+1$ 的值决定。使用时间上向前欧拉法对 $n_i$ 的更新格式为：\n$$\nn_i^{k+1} = n_i^k - \\frac{\\Delta t}{\\Delta v} (F_{i+1/2} - F_{i-1/2}) + \\Delta t S_i\n$$\n其中 $F_{i+1/2} = A(v_{i+1/2}) n_{i+1}^k$ 而 $F_{i-1/2} = A(v_{i-1/2}) n_i^k$。此过程以向量化方式实现。源 $S_0$ 被放置在包含 $v_0$ 的单个单元 $i_{\\mathrm{src}}$ 中，为 $S_{i_{\\mathrm{src}}} = S_0/\\Delta v$。\n\n**3. 时间步长和模拟时长**\n\n时间步长 $\\Delta t$ 必须满足此显式格式的 Courant–Friedrichs–Lewy (CFL) 稳定性条件：\n$$\n\\Delta t = \\mathrm{CFL} \\frac{\\Delta v}{\\max_{j} |A(v_{j})|}\n$$\n其中最大值取自域中所有单元面 $v_j$，为保证鲁棒性，我们选择 $\\mathrm{CFL}=0.5$。模拟运行总时间 $T_{\\mathrm{sim}}$，该时间需足以达到稳态。我们估计这个时间为一个粒子从 $v_0$ 减速到 $v_{\\min}$ 所需时间的倍数（例如，$k=5$）。这个输运时间 $\\tau$ 通过在 $v_{\\min}$ 和 $v_0$ 之间的网格单元上进行黎曼和来数值逼近：\n$$\n\\tau = \\int_{v_{\\min}}^{v_0} \\frac{\\mathrm{d}v}{|A(v)|} \\approx \\sum_{i | v_i \\in [v_{\\min}, v_0]} \\frac{\\Delta v}{|A(v_i)|}\n$$\n总时间步数为 $N_t = \\lceil T_{\\mathrm{sim}} / \\Delta t \\rceil$。\n\n**4. 分布的计算**\n\n经过 $N_t$ 个时间步后，获得速率空间密度 $n_{\\mathrm{num}}$ 的数值解。然后在每个单元中心 $v_i$ 计算数值分布函数：\n$$\nf_{\\mathrm{num}}(v_i) = \\frac{n_{\\mathrm{num}}(v_i)}{4\\pi v_i^2}\n$$\n解析分布 $f_{\\mathrm{cl}}(v_i)$ 使用步骤1中推导的公式在相同的网格点上进行评估。在离散网格上，我们根据 $v_i \\le v_0$ 是否成立来定义 $f_{\\mathrm{cl}}(v_i)$，以与评估范围保持一致。\n\n**5. 误差量化**\n在 $v_i \\le v_0$ 的网格点子集上计算以下误差度量。设该点集的大小为 $M$。\n- 均方根相对误差：\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{M}\\sum_{i=1}^{M}\\left(\\frac{|f_{\\mathrm{num}}(v_i) - f_{\\mathrm{cl}}(v_i)|}{\\max(f_{\\mathrm{cl}}(v_i),\\varepsilon)}\\right)^2}\n$$\n- 最大相对误差：\n$$\nE_{\\infty} = \\max_{i\\in\\{v_i\\le v_0\\}}\\left(\\frac{|f_{\\mathrm{num}}(v_i) - f_{\\mathrm{cl}}(v_i)|}{\\max(f_{\\mathrm{cl}}(v_i),\\varepsilon)}\\right)\n$$\n使用一个小的常数 $\\varepsilon=10^{-16}$ 来防止除以零，尽管在所有测试用例中，对于 $v_i \\le v_0$，$f_{\\mathrm{cl}}(v_i)$ 都是非零的。这些度量量化了数值稳态解的准确性。",
            "answer": "```python\nimport numpy as np\n\ndef run_case(v_min, v_max, N, v0, vc, Gamma, S0):\n    \"\"\"\n    Solves the slowing-down problem for a single set of parameters.\n    \"\"\"\n    # --- 1. Setup Grid and Physical Parameters ---\n    dv = (v_max - v_min) / N\n    v_faces = np.linspace(v_min, v_max, N + 1)\n    v_centers = v_faces[:-1] + 0.5 * dv\n    \n    # Drag function A(v)\n    def A_func(v):\n        return -Gamma * (v**3 + vc**3) / v**2\n\n    # Drag evaluated at cell faces\n    A_at_faces = A_func(v_faces)\n    \n    # --- 2. Time Step and Simulation Duration ---\n    CFL = 0.5\n    max_abs_A = np.max(np.abs(A_at_faces))\n    dt = CFL * dv / max_abs_A\n    \n    # Numerically approximate transit time from v0 to v_min\n    tau_mask = (v_centers >= v_min)  (v_centers = v0)\n    if not np.any(tau_mask):\n        # This case occurs if v0 is very close to v_min, falling outside any cell center.\n        # A single step transit time is a reasonable approximation.\n        tau = dv / np.abs(A_func(v0)) if np.abs(A_func(v0)) > 0 else float('inf')\n    else:\n        v_for_tau = v_centers[tau_mask]\n        A_for_tau = A_func(v_for_tau)\n        tau = np.sum(dv / np.abs(A_for_tau))\n\n    # Simulate for 5 transit times to ensure steady state\n    T_sim = 5.0 * tau\n    N_t = int(np.ceil(T_sim / dt))\n    \n    # --- 3. Initialize Source and State Vector ---\n    S_arr = np.zeros(N)\n    # Find the cell index containing v0\n    v0_idx = np.searchsorted(v_faces, v0, side='right') - 1\n    if 0 = v0_idx  N:\n        S_arr[v0_idx] = S0 / dv\n        \n    n = np.zeros(N) # Initial condition n(v, 0) = 0\n    \n    # --- 4. Time-Stepping Loop ---\n    for _ in range(N_t):\n        # Apply upwinding. Since A(v)  0, the wind is from the right (higher v).\n        # The flux at face j depends on n in cell j (to its right).\n        # Pad n with a ghost cell at the right (n_N = 0 for zero inflow at v_max)\n        n_padded_right = np.append(n, 0)\n        \n        # Calculate flux at all N+1 faces\n        F_at_faces = A_at_faces * n_padded_right\n        \n        # Calculate flux divergence for each cell i: F_{i+1/2} - F_{i-1/2}\n        flux_divergence = F_at_faces[1:] - F_at_faces[:-1]\n\n        # Update n using forward Euler\n        n = n - (dt / dv) * flux_divergence + dt * S_arr\n\n    # --- 5. Calculate Analytic and Numerical Solutions for f(v) ---\n    # Numerical solution for f(v)\n    f_num = n / (4 * np.pi * v_centers**2)\n    \n    # Analytic solution f_cl(v)\n    f_cl = np.zeros(N)\n    # Mask for the slowing-down region v = v0\n    analytic_mask = v_centers = v0\n    vc_cubed = vc**3\n    f_cl[analytic_mask] = (S0 / (4 * np.pi * Gamma)) / (v_centers[analytic_mask]**3 + vc_cubed)\n    \n    # --- 6. Compute Error Metrics ---\n    # Evaluation is restricted to v = v0\n    eval_mask = v_centers = v0\n    f_num_eval = f_num[eval_mask]\n    f_cl_eval = f_cl[eval_mask]\n    \n    if len(f_num_eval) == 0:\n        return [0.0, 0.0]\n\n    epsilon = 1e-16\n    \n    # Relative error\n    rel_err = np.abs(f_num_eval - f_cl_eval) / np.maximum(np.abs(f_cl_eval), epsilon)\n    \n    # RMSE\n    rmse = np.sqrt(np.mean(rel_err**2))\n    \n    # Max relative error\n    e_inf = np.max(rel_err)\n    \n    return [rmse, e_inf]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Each test case: (v_min, v_max, N, v0, vc, Gamma, S0)\n    test_cases = [\n        (2.0e5, 2.0e6, 400, 1.2e6, 5.0e5, 50.0, 1.0e19),\n        (2.0e5, 2.0e6, 400, 1.9e6, 5.0e5, 50.0, 1.0e19),\n        (2.0e5, 2.0e6, 400, 1.2e6, 1.0e5, 50.0, 1.0e19),\n        (2.0e5, 2.0e6, 400, 2.3e5, 5.0e5, 50.0, 1.0e19),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_case(*case)\n        results.append(result)\n\n    # Format the output string exactly as specified\n    result_strings = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在实践的基础上，我们现在考虑一个更真实的福克-普朗克模型，它包含了速度空间扩散和粒子损失项。在数值求解动理学方程时，如何处理计算域的边界是一个至关重要且并非平凡的问题，不同的边界条件会显著影响最终的稳态解。本练习将探讨几种具有明确物理意义的边界条件（如吸收、反射、零梯度），并通过编程实践分析它们对稳态快离子分布的影响，让你深入掌握动理学模拟中的一个关键实用技巧。",
            "id": "4045195",
            "problem": "考虑在均匀背景等离子体中经历碰撞减速的快离子群的稳态、速度空间各向同性的福克-普朗克（FP）平衡。在无量纲变量中，令 $u = v/v_{\\mathrm{inj}}$ 表示归一化到注入速度的速度，令 $f(u)$ 表示无量纲的各向同性分布函数。假设一个一维速度空间模型，其漂移系数为 $b(u)$，扩散系数为 $D$，各向同性源为 $S(u)$，线性损失率为 $\\lambda$，因此保守稳态FP方程为\n$$\n\\frac{d}{du}\\left(-D \\frac{df}{du} + b(u) f(u)\\right) + S(u) - \\lambda f(u) = 0,\n$$\n对于 $u \\in [u_{\\min}, u_{\\max}]$，其中 $u_{\\min} > 0$ 和 $u_{\\max} > u_{\\min}$ 是归一化速度中的固定边界。取碰撞漂移系数为\n$$\nb(u) = -\\frac{a_0}{u^2},\n$$\n其中 $a_0 > 0$ 为常数，并取扩散系数 $D = d_0$，其中 $d_0 > 0$ 为常数。源项位于注入速度附近，并建模为高斯函数，\n$$\nS(u) = S_0 \\exp\\left(-\\frac{(u-1)^2}{2\\sigma^2}\\right),\n$$\n其振幅 $S_0 > 0$，宽度 $\\sigma > 0$。损失项为 $\\lambda f(u)$，其中 $\\lambda > 0$ 为常数。\n\n必须规定在低能边界 $u=u_{\\min}$ 和高能边界 $u=u_{\\max}$ 处的边界条件。考虑以下具有物理动机的边界条件类型，用 $f$ 及其导数表示：\n- 吸收（狄利克雷）边界：$f(u) = c$，通常在边界处取 $c=0$ 来表示吸收条件。\n- 零梯度（诺伊曼）边界：$\\frac{df}{du}(u) = 0$，表示在边界处梯度为零。\n- 反射（净通量为零）边界：$b(u) f(u) - D \\frac{df}{du}(u) = 0$，强加在边界处速度空间净通量为零。\n\n根据FP方程和这些边界类型，为 $f(u)$ 构建边值问题，并将其在均匀网格 $u_j = u_{\\min} + j \\Delta u$（$j=0,\\dots,N$，$ \\Delta u = (u_{\\max} - u_{\\min})/N$）上离散化。对内部点 $j=1,\\dots,N-1$ 使用二阶中心差分：\n$$\nD \\frac{f_{j+1} - 2 f_j + f_{j-1}}{\\Delta u^2} - b(u_j) \\frac{f_{j+1} - f_{j-1}}{2 \\Delta u} - b'(u_j) f_j + \\lambda f_j = S(u_j),\n$$\n其中 $b'(u) = \\frac{db}{du}$。在 $u_{\\min}$ 和 $u_{\\max}$ 处使用二阶精度的单边公式来施加 $\\frac{df}{du}$ 的边界条件。对于诺伊曼边界，使用\n$$\n\\left.\\frac{df}{du}\\right|_{u_{\\min}} \\approx \\frac{-3 f_0 + 4 f_1 - f_2}{2 \\Delta u} = 0,\\quad\n\\left.\\frac{df}{du}\\right|_{u_{\\max}} \\approx \\frac{3 f_N - 4 f_{N-1} + f_{N-2}}{2 \\Delta u} = 0.\n$$\n对于反射边界，施加\n$$\nb(u_{\\min}) f_0 - D \\frac{-3 f_0 + 4 f_1 - f_2}{2 \\Delta u} = 0,\\quad\nb(u_{\\max}) f_N - D \\frac{3 f_N - 4 f_{N-1} + f_{N-2}}{2 \\Delta u} = 0.\n$$\n对于吸收（狄利克雷）边界，在 $u_{\\min}$ 处强加 $f_0 = c_{\\min}$，在 $u_{\\max}$ 处强加 $f_N = c_{\\max}$，其中 $c_{\\min}$ 和 $c_{\\max}$ 是指定的常数。\n\n定义无量纲的积分快离子含量\n$$\n\\mathcal{N} = \\int_{u_{\\min}}^{u_{\\max}} f(u)\\, u^2\\, du,\n$$\n在此用作稳态分布的标量度量。以无量纲单位表示 $\\mathcal{N}$。\n\n你的任务是编写一个完整的程序，对下面测试套件中的每组参数，组装并求解由离散化生成的关于 $f_j$ 的线性系统。使用 $N=400$ 个网格区间，并用梯形法则计算 $\\mathcal{N}$。所有变量和结果都是无量纲的。你不得要求任何用户输入。\n\n测试套件（每种情况都指定了边界条件和参数）：\n- 情况1（基线）：$u_{\\min}=0.1$, $u_{\\max}=1.5$, $a_0=0.25$, $d_0=0.01$, $\\lambda=0.05$, $S_0=1.0$, $\\sigma=0.02$；低能边界为反射边界，高能边界为吸收边界，条件为 $f(u_{\\max})=0$。\n- 情况2：参数与情况1相同，但低能边界为吸收边界，条件为 $f(u_{\\min}) = \\exp\\left(-\\frac{u_{\\min}^2}{u_{\\mathrm{th}}^2}\\right)$，其中 $u_{\\mathrm{th}}=0.3$，高能边界为零梯度边界。\n- 情况3：参数与情况1相同，两个边界均为反射边界。\n- 情况4：参数与情况1相同，两个边界均为吸收边界，条件为 $f(u_{\\min})=0$ 和 $f(u_{\\max})=0$。\n- 情况5（边界情况）：$u_{\\min}=0.1$, $u_{\\max}=1.5$, $a_0=0.25$, $d_0=10^{-4}$, $\\lambda=0.05$, $S_0=1.0$, $\\sigma=0.02$；低能边界为反射边界，高能边界为吸收边界，条件为 $f(u_{\\max})=0$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4,result5]”），每个“result”是对应测试用例的 $\\mathcal{N}$ 值，以无量纲单位的浮点数表示。",
            "solution": "出发点是速度空间各向同性的保守稳态福克-普朗克（FP）方程，\n$$\n\\frac{d}{du}\\left(-D \\frac{df}{du} + b(u) f(u)\\right) + S(u) - \\lambda f(u) = 0,\n$$\n其中 $u = v/v_{\\mathrm{inj}}$ 是无量纲速度，$f(u)$ 是无量纲分布函数，$D$ 是扩散系数，$b(u)$ 是漂移系数，$S(u)$ 是源项，$\\lambda$ 是线性损失参数。该方程表示在漂移、扩散、注入和损失作用下，速度空间中概率密度的守恒。\n\n我们用确定性漂移 $b(u) = - a_0 / u^2$ 和常数扩散 $D=d_0$ 来模拟碰撞减速。源项 $S(u)$ 通过高斯函数 $S(u) = S_0 \\exp[-(u-1)^2/(2\\sigma^2)]$ 局域在 $u \\approx 1$ 处。损失项 $\\lambda f(u)$ 模拟了速率为 $\\lambda$ 的净移除。\n\n为了计算稳态，我们在均匀网格 $u_j = u_{\\min} + j \\Delta u$（$j=0,\\dots,N$，$ \\Delta u = (u_{\\max}-u_{\\min})/N$）上进行离散化。展开通量项的导数 $\\frac{d}{du}(-D \\frac{df}{du} + b f) = -D \\frac{d^2f}{du^2} + b(u)\\frac{df}{du} + b'(u)f(u)$，代入原方程得到 $-D f'' + b f' + b' f + S - \\lambda f = 0$。整理后，边值问题化为：\n$$\nD \\frac{d^2 f}{du^2} - b(u) \\frac{df}{du} - \\left(b'(u) - \\lambda\\right) f(u) = S(u)\n$$\n对于 $b(u) = - a_0 u^{-2}$，我们有 $b'(u) = 2 a_0 u^{-3}$。\n\n使用二阶中心差分，内部节点 $j=1,\\dots,N-1$ 的离散方程为\n$$\nD \\frac{f_{j+1} - 2 f_j + f_{j-1}}{\\Delta u^2}\n- b(u_j) \\frac{f_{j+1} - f_{j-1}}{2 \\Delta u}\n- (b'(u_j) - \\lambda) f_j\n= S(u_j).\n$$\n这产生了一个关于 $f_j$ 的三对角线性系统，其系数为：\n- 下对角线（与 $f_{j-1}$ 相关）：$c_{j,-} = \\frac{D}{\\Delta u^2} + \\frac{b(u_j)}{2 \\Delta u}$。\n- 主对角线（与 $f_j$ 相关）：$c_{j,0} = -\\frac{2D}{\\Delta u^2} - b'(u_j) + \\lambda$。\n- 上对角线（与 $f_{j+1}$ 相关）：$c_{j,+} = \\frac{D}{\\Delta u^2} - \\frac{b(u_j)}{2 \\Delta u}$。\n\n通过用适当的离散边界方程替换 $j=0$ 和 $j=N$ 处的偏微分方程行来实现边界条件：\n\n1. 吸收（狄利克雷）边界（在边界 $u_b$ 处）：强加 $f(u_b) = c$，其离散形式在 $u_{\\min}$ 处即为 $f_0 = c$，或在 $u_{\\max}$ 处为 $f_N = c$。\n\n2. 零梯度（诺伊曼）边界（在 $u_{\\min}$ 处）：通过二阶单边近似强加 $\\frac{df}{du} = 0$\n$$\n\\frac{-3 f_0 + 4 f_1 - f_2}{2 \\Delta u} = 0 \\quad \\Rightarrow \\quad -3 f_0 + 4 f_1 - f_2 = 0,\n$$\n在 $u_{\\max}$ 处类似：\n$$\n\\frac{3 f_N - 4 f_{N-1} + f_{N-2}}{2 \\Delta u} = 0 \\quad \\Rightarrow \\quad 3 f_N - 4 f_{N-1} + f_{N-2} = 0.\n$$\n这些边界方程替换了 $j=0$ 和 $j=N$ 处的偏微分方程行。\n\n3. 反射（净通量为零）边界（在边界 $u_b$ 处）：强加 $b(u_b) f(u_b) - D \\frac{df}{du}(u_b) = 0$。在 $u_{\\min}$ 处使用二阶单边差分近似导数，\n$$\nb(u_{\\min}) f_0 - D \\frac{-3 f_0 + 4 f_1 - f_2}{2 \\Delta u} = 0,\n$$\n在 $u_{\\max}$ 处，\n$$\nb(u_{\\max}) f_N - D \\frac{3 f_N - 4 f_{N-1} + f_{N-2}}{2 \\Delta u} = 0.\n$$\n这些是边界值与相邻值之间的线性关系。\n\n通过以下步骤组装完整的 $(N+1) \\times (N+1)$ 线性系统 $\\mathbf{A} \\mathbf{f} = \\mathbf{s}$：\n- 将内部行 $j=1,\\dots,N-1$ 设置为三对角系数，右侧为 $S(u_j)$。\n- 用相应的边界条件方程替换边界行 $j=0$ 和 $j=N$，其右侧等于它们的常数（诺伊曼和反射边界为零；狄利克雷边界为指定值）。\n\n使用直接线性求解器求解 $\\mathbf{f}$。计算积分快离子含量\n$$\n\\mathcal{N} = \\int_{u_{\\min}}^{u_{\\max}} f(u) u^2 \\, du\n$$\n通过网格上的梯形法则。所有量都是无量纲的；因此 $\\mathcal{N}$ 是一个无量纲标量。\n\n为分析 $u_{\\min}$ 和 $u_{\\max}$ 处的边界条件对计算出的稳态的影响，我们对测试套件中的五种情况评估 $\\mathcal{N}$：\n- 情况1在低能端使用反射边界，在高能端使用吸收边界；这通常允许粒子在低 $u$ 附近累积，同时移除高能粒子，从而产生比完全吸收边界相对更大的 $\\mathcal{N}$。\n- 情况2在低能端施加一个与麦克斯韦分布代理匹配的有限狄利克雷值，并在高能端施加零梯度；这倾向于维持一个更平滑的尾部和一个非零的低 $u$ 基底，与吸收性高能条件相比，可能会增加 $\\mathcal{N}$。\n- 情况3在两端都使用反射边界；在有损失 $\\lambda>0$ 的情况下，解保持有界，并且由于两端的粒子保留，可能会产生更大的 $\\mathcal{N}$。\n- 情况4在两端都使用吸收边界，这抑制了在低 $u$ 和高 $u$ 处的粒子累积，因此相对于反射或零梯度条件，通常会减小 $\\mathcal{N}$。\n- 情况5显著减小了扩散系数 $d_0$，从而强调了平流漂移；边界条件因此对两端附近的形状有更强的影响，积分后的 $\\mathcal{N}$ 可能会因平滑作用减弱而发生变化。\n\n该程序实现了这些情况，求解了边值问题，并以规定格式输出了 $\\mathcal{N}$ 值的列表。",
            "answer": "```python\nimport numpy as np\n\ndef build_system(u_min, u_max, N, a0, d0, lam, S0, sigma, bc_left, bc_right, f_left=None, f_right=None, u_th=None):\n    \"\"\"\n    Build the (A, s, u) linear system for the steady-state FP equation with specified boundary conditions.\n    \"\"\"\n    # Grid\n    u = np.linspace(u_min, u_max, N + 1)\n    du = (u_max - u_min) / N\n\n    # Coefficients and source\n    # Add a small epsilon to avoid division by zero at u=0, though not strictly needed for u_min > 0\n    u_safe = u + 1e-12\n    b = -a0 / (u_safe**2)            # drift\n    bp = 2.0 * a0 / (u_safe**3)      # derivative of drift\n    S = S0 * np.exp(-((u - 1.0) ** 2) / (2.0 * sigma ** 2))\n\n    # Initialize system\n    A = np.zeros((N + 1, N + 1))\n    s = np.zeros(N + 1)\n\n    # Interior rows: j = 1..N-1\n    # PDE is D f'' - b f' - (b' - lam) f = S\n    for j in range(1, N):\n        # Corresponds to D * (f_{j-1} - 2f_j + f_{j+1})/du^2\n        A[j, j - 1] += d0 / du**2\n        A[j, j]     -= 2.0 * d0 / du**2\n        A[j, j + 1] += d0 / du**2\n        \n        # Corresponds to -b * (f_{j+1} - f_{j-1})/(2*du)\n        A[j, j - 1] += b[j] / (2.0 * du)\n        A[j, j + 1] -= b[j] / (2.0 * du)\n\n        # Corresponds to -(b' - lam) * f_j\n        A[j, j] -= (bp[j] - lam)\n        \n        s[j] = S[j]\n\n    # Left boundary row j = 0\n    if bc_left == 'dirichlet':\n        if f_left is None:\n            raise ValueError(\"Dirichlet left boundary requires f_left.\")\n        A[0, 0] = 1.0\n        s[0] = f_left\n    elif bc_left == 'neumann':\n        # (-3 f0 + 4 f1 - f2)/(2 du) = 0 -> -3 f0 + 4 f1 - f2 = 0\n        A[0, 0] = -3.0\n        A[0, 1] =  4.0\n        A[0, 2] = -1.0\n        s[0] = 0.0\n    elif bc_left == 'reflecting':\n        # b(u_min) f0 - d0 * (-3 f0 + 4 f1 - f2)/(2 du) = 0\n        A[0, 0] = b[0] - d0 * (-3.0 / (2.0 * du))\n        A[0, 1] = -d0 * (4.0 / (2.0 * du))\n        A[0, 2] = -d0 * (-1.0 / (2.0 * du))\n        s[0] = 0.0\n    else:\n        raise ValueError(\"Unknown left boundary condition type.\")\n\n    # Right boundary row j = N\n    if bc_right == 'dirichlet':\n        if f_right is None:\n            raise ValueError(\"Dirichlet right boundary requires f_right.\")\n        A[N, N] = 1.0\n        s[N] = f_right\n    elif bc_right == 'neumann':\n        # (3 fN - 4 f_{N-1} + f_{N-2})/(2 du) = 0 -> 3 fN - 4 f_{N-1} + f_{N-2} = 0\n        A[N, N]     =  3.0\n        A[N, N - 1] = -4.0\n        A[N, N - 2] =  1.0\n        s[N] = 0.0\n    elif bc_right == 'reflecting':\n        # b(u_max) fN - d0 * (3 fN - 4 f_{N-1} + f_{N-2})/(2 du) = 0\n        A[N, N]     = b[N] - d0 * (3.0 / (2.0 * du))\n        A[N, N - 1] = -d0 * (-4.0 / (2.0 * du))\n        A[N, N - 2] = -d0 * (1.0 / (2.0 * du))\n        s[N] = 0.0\n    else:\n        raise ValueError(\"Unknown right boundary condition type.\")\n\n    return A, s, u\n\ndef solve_case(params):\n    # Unpack parameters\n    u_min = params['u_min']\n    u_max = params['u_max']\n    N     = params['N']\n    a0    = params['a0']\n    d0    = params['d0']\n    lam   = params['lam']\n    S0    = params['S0']\n    sigma = params['sigma']\n    bc_left  = params['bc_left']\n    bc_right = params['bc_right']\n    f_left   = params.get('f_left', None)\n    f_right  = params.get('f_right', None)\n    u_th     = params.get('u_th', None)\n\n    # Build system\n    A, s, u = build_system(u_min, u_max, N, a0, d0, lam, S0, sigma, bc_left, bc_right, f_left, f_right, u_th)\n    # Solve\n    f = np.linalg.solve(A, s)\n    # Compute integrated content N = ∫ f(u) u^2 du by trapezoidal rule\n    Nu = np.trapz(f * (u ** 2), u)\n    return float(Nu)\n\ndef solve():\n    # Common settings\n    u_min = 0.1\n    u_max = 1.5\n    N = 400\n    a0 = 0.25\n    lam = 0.05\n    S0 = 1.0\n    sigma = 0.02\n\n    # Maxwellian value at low energy for Case 2\n    u_th = 0.3\n    f_min_case2 = np.exp(-(u_min ** 2) / (u_th ** 2))\n\n    test_cases = [\n        # Case 1\n        { 'u_min': u_min, 'u_max': u_max, 'N': N, 'a0': a0, 'd0': 0.01, 'lam': lam, 'S0': S0, 'sigma': sigma, 'bc_left': 'reflecting', 'bc_right': 'dirichlet', 'f_right': 0.0 },\n        # Case 2\n        { 'u_min': u_min, 'u_max': u_max, 'N': N, 'a0': a0, 'd0': 0.01, 'lam': lam, 'S0': S0, 'sigma': sigma, 'bc_left': 'dirichlet', 'f_left': f_min_case2, 'bc_right': 'neumann', 'u_th': u_th },\n        # Case 3\n        { 'u_min': u_min, 'u_max': u_max, 'N': N, 'a0': a0, 'd0': 0.01, 'lam': lam, 'S0': S0, 'sigma': sigma, 'bc_left': 'reflecting', 'bc_right': 'reflecting' },\n        # Case 4\n        { 'u_min': u_min, 'u_max': u_max, 'N': N, 'a0': a0, 'd0': 0.01, 'lam': lam, 'S0': S0, 'sigma': sigma, 'bc_left': 'dirichlet', 'f_left': 0.0, 'bc_right': 'dirichlet', 'f_right': 0.0 },\n        # Case 5\n        { 'u_min': u_min, 'u_max': u_max, 'N': N, 'a0': a0, 'd0': 1e-4, 'lam': lam, 'S0': S0, 'sigma': sigma, 'bc_left': 'reflecting', 'bc_right': 'dirichlet', 'f_right': 0.0 },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(case)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}