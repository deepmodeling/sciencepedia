{
    "hands_on_practices": [
        {
            "introduction": "Understanding how energy from external sources is transferred to plasma particles is fundamental to transport modeling. This first exercise  delves into the physics of Radio Frequency (RF) heating, a key technique for achieving fusion conditions. By working with the plasma's dielectric tensor, you will calculate how the injected wave power, represented by the term $\\langle \\mathbf{J} \\cdot \\mathbf{E} \\rangle$, is distributed among different species, providing a direct link between electromagnetic theory and plasma thermodynamics.",
            "id": "4057536",
            "problem": "A uniform, magnetized, multi-species plasma is driven by a monochromatic Radio Frequency (RF) electric field. The plasma response is modeled linearly by a complex dielectric tensor. You are asked to compute the species-resolved time-averaged electromagnetic work density and infer the heating deposition split among the species.\n\nAssume the following:\n\n- The electric field phasor is spatially uniform and equal to $\\mathbf{E} = \\left(4.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{x}} + \\left(3.00 \\times 10^{3}\\,i\\right)\\,\\hat{\\mathbf{y}} + \\left(2.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{z}}$ in the International System of Units (SI), with angular frequency $\\omega = 2\\pi \\times 80 \\times 10^{6}$.\n- The vacuum permittivity is $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$ in SI units.\n- The total dielectric tensor is $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_{s} \\boldsymbol{\\chi}_{s}$, where $s$ indexes the species. The plasma has three species: electrons ($e$), deuterium ions ($\\text{D}^{+}$), and helium ash ($\\text{He}^{2+}$).\n- The species susceptibilities are diagonal in this basis and given by:\n  - Electrons: $\\boldsymbol{\\chi}_{e} = \\mathrm{diag}\\!\\left(-4.5 + i\\,1.5 \\times 10^{-3},\\,-3.8 + i\\,1.0 \\times 10^{-3},\\,-0.2 + i\\,2.0 \\times 10^{-4}\\right)$,\n  - Deuterium: $\\boldsymbol{\\chi}_{\\text{D}} = \\mathrm{diag}\\!\\left(0.6 + i\\,0.6 \\times 10^{-3},\\,0.4 + i\\,0.8 \\times 10^{-3},\\,0.05 + i\\,0.1 \\times 10^{-3}\\right)$,\n  - Helium: $\\boldsymbol{\\chi}_{\\text{He}} = \\mathrm{diag}\\!\\left(0.3 + i\\,0.3 \\times 10^{-3},\\,0.2 + i\\,0.2 \\times 10^{-3},\\,0.01 + i\\,0.05 \\times 10^{-3}\\right)$.\n\nStarting from the Poynting theorem and the linear constitutive relation $\\mathbf{D} = \\varepsilon_{0}\\,\\boldsymbol{\\varepsilon}\\,\\mathbf{E}$, derive an expression for the species-resolved, time-averaged electromagnetic work density $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$ in terms of the anti-Hermitian (imaginary) part of $\\boldsymbol{\\chi}_{s}$ and the field phasor. Use this expression to compute $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$ for each species using the data above, and then infer the deposition split fractions $f_{s} = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\big/ \\sum_{r} \\left\\langle \\mathbf{J}_{r} \\cdot \\mathbf{E} \\right\\rangle$ for $s \\in \\{e, \\text{D}, \\text{He}\\}$.\n\nProvide the final deposition split as a row vector $(f_{e}, f_{\\text{D}}, f_{\\text{He}})$ with each entry rounded to four significant figures. The deposition split is dimensionless; do not include units in your final answer.",
            "solution": "The problem is deemed valid as it is scientifically grounded in plasma physics and electromagnetism, well-posed, objective, and internally consistent. All necessary data for a unique solution are provided.\n\nThe first step is to derive an expression for the species-resolved, time-averaged electromagnetic work density, denoted as $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$. Let the physical, real-valued electric field and current density for species $s$ be $\\mathbf{e}(t)$ and $\\mathbf{j}_s(t)$, respectively. Assuming a monochromatic wave with angular frequency $\\omega$, these can be represented by complex phasors $\\mathbf{E}$ and $\\mathbf{J}_s$ as:\n$$ \\mathbf{e}(t) = \\mathrm{Re}(\\mathbf{E} \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{E} \\exp(-i\\omega t) + \\mathbf{E}^* \\exp(i\\omega t)) $$\n$$ \\mathbf{j}_s(t) = \\mathrm{Re}(\\mathbf{J}_s \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{J}_s \\exp(-i\\omega t) + \\mathbf{J}_s^* \\exp(i\\omega t)) $$\nThe instantaneous work density (power per unit volume) done by the electric field on the particles of species $s$ is $\\mathbf{j}_s(t) \\cdot \\mathbf{e}(t)$. The time-averaged work density is the average of this quantity over one wave period $T = 2\\pi/\\omega$:\n$$ \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\equiv \\left\\langle P_s \\right\\rangle = \\frac{1}{T} \\int_0^T \\mathbf{j}_s(t) \\cdot \\mathbf{e}(t) dt $$\nSubstituting the phasor expressions and integrating, the terms oscillating at frequency $2\\omega$ average to zero, leaving:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{4}(\\mathbf{J}_s^\\dagger \\mathbf{E} + \\mathbf{J}_s^\\intercal \\mathbf{E}^*) = \\frac{1}{2} \\mathrm{Re}(\\mathbf{J}_s^\\dagger \\mathbf{E}) $$\nwhere $\\mathbf{J}_s^\\dagger$ is the conjugate transpose (Hermitian conjugate) of the vector $\\mathbf{J}_s$.\n\nNext, we relate the current density phasor $\\mathbf{J}_s$ to the electric field phasor $\\mathbf{E}$. The total displacement field $\\mathbf{D}$ is related to $\\mathbf{E}$ by the dielectric tensor $\\boldsymbol{\\varepsilon}$ as $\\mathbf{D} = \\varepsilon_0 \\boldsymbol{\\varepsilon} \\mathbf{E}$. The constitutive relation is given as $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_s \\boldsymbol{\\chi}_s$, where $\\boldsymbol{\\chi}_s$ is the susceptibility of species $s$. The polarization Density $\\mathbf{P}$ is $\\mathbf{P} = \\mathbf{D} - \\varepsilon_0 \\mathbf{E} = \\varepsilon_0 (\\sum_s \\boldsymbol{\\chi}_s) \\mathbf{E}$. The polarization of a single species $s$ is $\\mathbf{P}_s = \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E}$. The current density of species $s$ is the time derivative of its polarization, $\\mathbf{j}_s(t) = \\frac{\\partial \\mathbf{P}_s(t)}{\\partial t}$. In the frequency domain, this corresponds to multiplication by $-i\\omega$:\n$$ \\mathbf{J}_s = -i\\omega \\mathbf{P}_s = -i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E} $$\nSubstituting this into the expression for the time-averaged power density:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{2} \\mathrm{Re}\\left( (-i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{1}{2} \\mathrm{Re}\\left( i\\omega \\varepsilon_0 (\\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_s^\\dagger \\mathbf{E} \\right) $$\nThe susceptibility tensor $\\boldsymbol{\\chi}_s$ can be decomposed into its real and imaginary parts, $\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_{s,R} + i\\boldsymbol{\\chi}_{s,I}$, where $\\boldsymbol{\\chi}_{s,R}$ and $\\boldsymbol{\\chi}_{s,I}$ are real matrices. Since the given $\\boldsymbol{\\chi}_s$ is diagonal, it is symmetric ($\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_s^\\intercal$), so its Hermitian conjugate is its complex conjugate: $\\boldsymbol{\\chi}_s^\\dagger = \\boldsymbol{\\chi}_s^* = \\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}$.\nSubstituting this into the power expression:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger (\\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}) \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i(\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}) + (\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}) \\right) $$\nFor a real symmetric matrix $\\mathbf{M}$, the quadratic form $\\mathbf{E}^\\dagger \\mathbf{M} \\mathbf{E}$ is always a real number. Since $\\boldsymbol{\\chi}_{s,R}$ and $\\boldsymbol{\\chi}_{s,I}$ are real and diagonal (thus symmetric), both $\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}$ and $\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$ are real. Therefore, the real part of the expression in the parentheses is simply the second term:\n$$ \\left\\langle P_s \\right\\rangle = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} $$\nThis expression gives the power deposition in terms of the imaginary part of the susceptibility tensor. The anti-Hermitian part of $\\boldsymbol{\\chi}_s$ is $\\boldsymbol{\\chi}_{s,A} = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^\\dagger) = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^*) = i\\boldsymbol{\\chi}_{s,I}$. Thus, $\\boldsymbol{\\chi}_{s,I} = -i \\boldsymbol{\\chi}_{s,A}$, and the power deposition can also be written in terms of the anti-Hermitian part as $\\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger (-i\\boldsymbol{\\chi}_{s,A}) \\mathbf{E}$, satisfying the problem's requirement.\n\nNow we compute the numerical values. The electric field phasor is $\\mathbf{E} = (4.00 \\times 10^{3})\\,\\hat{\\mathbf{x}} + (3.00 \\times 10^{3}\\,i)\\,\\hat{\\mathbf{y}} + (2.00 \\times 10^{3})\\,\\hat{\\mathbf{z}}$. The squared magnitudes of its components are:\n$$ |E_x|^2 = |4.00 \\times 10^3|^2 = 1.60 \\times 10^{7} $$\n$$ |E_y|^2 = |3.00 \\times 10^3 i|^2 = 9.00 \\times 10^{6} $$\n$$ |E_z|^2 = |2.00 \\times 10^3|^2 = 4.00 \\times 10^{6} $$\nThe susceptibility tensors are diagonal, so $\\boldsymbol{\\chi}_{s,I} = \\mathrm{diag}(\\mathrm{Im}(\\chi_{s,xx}), \\mathrm{Im}(\\chi_{s,yy}), \\mathrm{Im}(\\chi_{s,zz}))$. The quadratic form simplifies to:\n$$ \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} = |E_x|^2 \\mathrm{Im}(\\chi_{s,xx}) + |E_y|^2 \\mathrm{Im}(\\chi_{s,yy}) + |E_z|^2 \\mathrm{Im}(\\chi_{s,zz}) $$\nLet's calculate this quantity for each species, which we denote as $W_s = \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$.\nFor electrons ($s=e$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_e) = \\mathrm{diag}(1.5 \\times 10^{-3}, 1.0 \\times 10^{-3}, 2.0 \\times 10^{-4}) $$\n$$ W_e = (1.60 \\times 10^7)(1.5 \\times 10^{-3}) + (9.00 \\times 10^6)(1.0 \\times 10^{-3}) + (4.00 \\times 10^6)(2.0 \\times 10^{-4}) $$\n$$ W_e = 24000 + 9000 + 800 = 33800 $$\nFor deuterium ($s=\\text{D}$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_{\\text{D}}) = \\mathrm{diag}(0.6 \\times 10^{-3}, 0.8 \\times 10^{-3}, 0.1 \\times 10^{-3}) $$\n$$ W_{\\text{D}} = (1.60 \\times 10^7)(0.6 \\times 10^{-3}) + (9.00 \\times 10^6)(0.8 \\times 10^{-3}) + (4.00 \\times 10^6)(0.1 \\times 10^{-3}) $$\n$$ W_{\\text{D}} = 9600 + 7200 + 400 = 17200 $$\nFor helium ($s=\\text{He}$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_{\\text{He}}) = \\mathrm{diag}(0.3 \\times 10^{-3}, 0.2 \\times 10^{-3}, 0.05 \\times 10^{-3}) $$\n$$ W_{\\text{He}} = (1.60 \\times 10^7)(0.3 \\times 10^{-3}) + (9.00 \\times 10^6)(0.2 \\times 10^{-3}) + (4.00 \\times 10^6)(0.05 \\times 10^{-3}) $$\n$$ W_{\\text{He}} = 4800 + 1800 + 200 = 6800 $$\nThe deposition split fraction for species $s$ is $f_s = \\left\\langle P_s \\right\\rangle \\big/ \\sum_r \\left\\langle P_r \\right\\rangle$. The common factor $\\frac{\\omega\\varepsilon_0}{2}$ cancels, so $f_s = W_s \\big/ \\sum_r W_r$.\nThe sum is $W_{\\text{total}} = W_e + W_{\\text{D}} + W_{\\text{He}} = 33800 + 17200 + 6800 = 57800$.\nThe fractions are:\n$$ f_e = \\frac{33800}{57800} = \\frac{338}{578} \\approx 0.5847750865 $$\n$$ f_{\\text{D}} = \\frac{17200}{57800} = \\frac{172}{578} \\approx 0.2975778546 $$\n$$ f_{\\text{He}} = \\frac{6800}{57800} = \\frac{68}{578} \\approx 0.1176470588 $$\nRounding each to four significant figures as requested:\n$$ f_e \\approx 0.5848 $$\n$$ f_{\\text{D}} \\approx 0.2976 $$\n$$ f_{\\text{He}} \\approx 0.1176 $$\nThe final answer is the row vector $(f_e, f_{\\text{D}}, f_{\\text{He}})$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.5848  0.2976  0.1176 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Once the microscopic heating physics is understood, the next challenge is to determine the spatial distribution of this heating within the plasma volume. This practice  guides you through a complete modeling workflow, from simulating power deposition with a Monte Carlo code to coupling this source to a transport solver. You will implement a conservative mapping scheme to ensure that the total energy is preserved when transferring data between different numerical grids, a crucial step for building robust, multi-physics simulations.",
            "id": "4057586",
            "problem": "You are tasked with implementing a conservative coupling between a Monte Carlo (MC) deposition model and a one-dimensional finite volume method (FVM) transport solver for steady-state heat conduction in a slab geometry. The goal is to map MC tallies of deposited power to FVM volumetric sources in a way that preserves total energy to within floating-point roundoff, then verify global energy conservation by comparing the total deposited power to the sum of outward conductive heat fluxes at the slab boundaries.\n\nFundamental basis:\n- Attenuation of injected beam power along the path is modeled using the Beer–Lambert law. For a unidirectional beam injected at position $x=0$ and traveling along the $+x$ direction through a homogeneous medium with attenuation coefficient $\\sigma$ in units of $\\mathrm{m}^{-1}$, the survival probability along distance $x$ is $\\exp(-\\sigma x)$, and the absorption distance is exponentially distributed with probability density function $p(x) = \\sigma \\exp(-\\sigma x)$ for $x \\ge 0$.\n- Conservation of energy for steady conduction in one spatial dimension states that the integrated volumetric heating equals the total outward conductive flux through the boundaries. Let $T(x)$ be temperature in $\\mathrm{K}$, thermal conductivity $k$ in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$, and volumetric heating $Q(x)$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$. The steady-state equation is $\\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0$. Integrating over the domain $x\\in[0,L]$ yields $\\int_0^L Q(x)\\,dx = q_{\\text{out}}(0) + q_{\\text{out}}(L)$, where $q_{\\text{out}}(0) = k \\left.\\frac{dT}{dx}\\right|_{x=0}$ and $q_{\\text{out}}(L) = -k \\left.\\frac{dT}{dx}\\right|_{x=L}$ are outward conductive fluxes in $\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n\nTask details to be implemented in your program:\n- Geometry and units: a one-dimensional slab of length $L$ in $\\mathrm{m}$ with unit cross-sectional area $A=1\\,\\mathrm{m}^2$. Temperatures at both ends are held at $T(0)=0\\,\\mathrm{K}$ and $T(L)=0\\,\\mathrm{K}$. The thermal conductivity $k$ is constant and specified in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$.\n- Monte Carlo deposition: inject total beam power $P_0$ in $\\mathrm{W}$ from $x=0$ along $+x$. Simulate $N_p$ independent histories. Each history carries equal power weight $w=P_0/N_p$ in $\\mathrm{W}$. For each history, sample an absorption distance $x$ from the exponential distribution with rate $\\sigma$ in $\\mathrm{m}^{-1}$. If $xL$, deposit the history’s power $w$ at that location; otherwise, it exits without depositing in the domain. Tally deposits onto a uniform fine grid of $N_f$ bins across $[0,L]$, forming a fine-grid power-per-bin vector in $\\mathrm{W}$; the corresponding fine-grid volumetric source is power per bin divided by bin volume $A\\Delta x_f$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$ with $\\Delta x_f = L/N_f$.\n- Tally-to-source mapping: conservatively map the fine-grid power tallies to a coarse FVM grid of $N_c$ control volumes by control-volume averaging. Assume $N_f$ is an integer multiple of $N_c$ so that each coarse cell aggregates an integer number of fine bins. Let $\\Delta x_c = L/N_c$. The coarse volumetric source $Q_i$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$ for cell $i$ is the total power aggregated into that cell divided by $A\\Delta x_c$. This mapping must satisfy $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c = \\sum_{\\text{fine bins}} \\text{power}_{\\text{fine}}$ to floating-point roundoff.\n- FVM transport solve: Solve the steady heat equation on the coarse grid with the mapped source $Q_i$ using a conservative FVM discretization with Dirichlet boundary conditions $T(0)=0$ and $T(L)=0$. Use uniform cells of width $\\Delta x_c$ and constant $k$. Construct the linear system from facewise conductive fluxes with face conductance $G = k/\\Delta x_c$ for interior faces and boundary-face conductance $G_b = k/(\\Delta x_c/2)=2k/\\Delta x_c$ for boundary faces with Dirichlet data. Solve for cell-centered temperatures $T_i$.\n- Flux-based conservation verification: Compute outward boundary fluxes using one-sided gradients consistent with the discretization, namely $q_{\\text{out}}(0) = k \\frac{T_1 - T_{\\text{bc}}}{\\Delta x_c/2}$ and $q_{\\text{out}}(L) = k \\frac{T_{N_c} - T_{\\text{bc}}}{\\Delta x_c/2}$ with $T_{\\text{bc}}=0\\,\\mathrm{K}$. The total outward power in $\\mathrm{W}$ is $P_{\\text{flux}} = A\\left(q_{\\text{out}}(0)+q_{\\text{out}}(L)\\right)$. Let $P_{\\text{dep}}$ be the total deposited power in $\\mathrm{W}$ from the MC tally within the domain. Report two relative errors per test case:\n  - Source-mapping conservation error $e_{\\text{map}} = \\left|\\sum_{i=1}^{N_c} Q_i A \\Delta x_c - P_{\\text{dep}}\\right|/\\max(P_{\\text{dep}},\\epsilon)$.\n  - Flux balance error $e_{\\text{flux}} = \\left|P_{\\text{flux}} - P_{\\text{dep}}\\right|/\\max(P_{\\text{dep}},\\epsilon)$.\n  Use $\\epsilon = 10^{-16}\\,\\mathrm{W}$ only to avoid division by zero.\n\nNumerical requirements:\n- All lengths must be in $\\mathrm{m}$, powers in $\\mathrm{W}$, volumetric sources in $\\mathrm{W}\\,\\mathrm{m}^{-3}$, thermal conductivity in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$, and temperatures in $\\mathrm{K}$. The relative errors $e_{\\text{map}}$ and $e_{\\text{flux}}$ are dimensionless and must be reported as decimals.\n\nProvide a program that implements the above and evaluates the following test suite. For each test case, the parameters are given as a tuple $(L,\\sigma,P_0,k,N_p,N_f,N_c,\\text{seed})$:\n- Test $1$ (happy path, strong attenuation, fine-to-coarse ratio moderate): $(1.0,\\,3.0,\\,1000.0,\\,10.0,\\,200000,\\,400,\\,50,\\,42)$.\n- Test $2$ (weak attenuation, significant transmission): $(1.0,\\,0.2,\\,1000.0,\\,5.0,\\,100000,\\,300,\\,30,\\,123)$.\n- Test $3$ (very localized deposition near the source, coarse FVM grid): $(1.0,\\,50.0,\\,500.0,\\,1.0,\\,300000,\\,500,\\,10,\\,777)$.\n- Test $4$ (low-count Monte Carlo to stress variance): $(1.0,\\,5.0,\\,800.0,\\,20.0,\\,500,\\,240,\\,60,\\,999)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order of $8$ floating-point numbers: $[e_{\\text{map},1},e_{\\text{flux},1},e_{\\text{map},2},e_{\\text{flux},2},e_{\\text{map},3},e_{\\text{flux},3},e_{\\text{map},4},e_{\\text{flux},4}]$.",
            "solution": "The user has provided a valid problem statement. The task is to implement a coupled Monte Carlo (MC) and Finite Volume Method (FVM) simulation to model heat deposition and transport in a one-dimensional slab, and to verify the numerical conservation of energy. The problem is scientifically grounded, well-posed, and all parameters are clearly defined.\n\nThe solution is implemented by following a sequence of steps for each test case provided: (1) Monte Carlo simulation of power deposition, (2) conservative mapping of power tallies to a coarse FVM grid, (3) solution of the steady-state heat equation using the FVM, and (4) verification of global energy conservation.\n\n### 1. Monte Carlo Power Deposition\n\nThe deposition of power from a unidirectional beam is modeled as a stochastic process governed by the Beer-Lambert law. The probability density function for a particle's absorption distance $x$ is given by $p(x) = \\sigma \\exp(-\\sigma x)$, where $\\sigma$ is the attenuation coefficient.\n\nFor a total injected power $P_0$ simulated with $N_p$ particle histories, each history carries a power weight of $w = P_0/N_p$. To simulate the deposition process, we sample an absorption distance $x$ for each of the $N_p$ histories. This is accomplished using inverse transform sampling. The cumulative distribution function is $F(x) = \\int_0^x p(t) dt = 1 - \\exp(-\\sigma t)$. Setting $F(x) = u$, where $u$ is a random variate from a uniform distribution $U(0,1)$, and solving for $x$ yields $x = -\\frac{1}{\\sigma}\\ln(1-u)$. Since $1-u$ is also uniformly distributed on $(0,1)$, this is equivalent to sampling from $x = -\\frac{1}{\\sigma}\\ln(u')$, where $u' \\sim U(0,1)$. Numerically, one can use a library function to draw samples from an exponential distribution with a scale parameter $\\beta = 1/\\sigma$.\n\nThe simulation domain is a slab of length $L$, discretized into a fine grid of $N_f$ bins, each of width $\\Delta x_f = L/N_f$. For each history, if the sampled absorption distance $x$ is less than $L$, the particle deposits its power $w$ into the corresponding fine-grid bin. The bin index $j$ is determined by $j = \\lfloor x / \\Delta x_f \\rfloor$. If $x \\ge L$, the particle is considered transmitted and deposits no power within the domain.\n\nAfter all $N_p$ histories are simulated, the total power deposited in each bin is tallied. The total deposited power in the domain, $P_{\\text{dep}}$, is the sum of power in all fine-grid bins:\n$$ P_{\\text{dep}} = \\sum_{j=0}^{N_f-1} P_{\\text{fine}, j} $$\nwhere $P_{\\text{fine}, j}$ is the total power tallied in fine bin $j$.\n\n### 2. Conservative Tally-to-Source Mapping\n\nThe power deposited on the fine grid must be mapped to the a coarse FVM grid with $N_c$ cells, each of width $\\Delta x_c = L/N_c$. The problem specifies that $N_f$ is an integer multiple of $N_c$, so each coarse cell perfectly contains an integer number of fine bins, $N_f/N_c$.\n\nThe mapping must be conservative, meaning the total power on the coarse grid must equal the total power on the fine grid. The volumetric source term $Q_i$ for the $i$-th coarse cell (for $i \\in \\{1, \\dots, N_c\\}$) is calculated by summing the power from all fine bins that fall within coarse cell $i$ and dividing by the volume of the coarse cell, $V_c = A \\Delta x_c$, where $A=1\\,\\mathrm{m}^2$ is the cross-sectional area.\n$$ Q_i = \\frac{\\sum_{j \\in \\text{bins in cell } i} P_{\\text{fine}, j}}{A \\Delta x_c} $$\nThe total power accounted for on the coarse grid, $P_{\\text{dep\\_coarse}}$, is then $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c$. The source-mapping conservation error, $e_{\\text{map}}$, verifies this step:\n$$ e_{\\text{map}} = \\frac{\\left| \\sum_{i=1}^{N_c} Q_i A \\Delta x_c - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\nwhere $\\epsilon = 10^{-16}\\,\\mathrm{W}$ prevents division by zero. Due to the nature of the summation, this error is expected to be near machine precision.\n\n### 3. Finite Volume Method (FVM) Solution\n\nThe FVM is used to solve the one-dimensional steady-state heat conduction equation with the calculated source term $Q(x)$:\n$$ \\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0 $$\nwith Dirichlet boundary conditions $T(0)=0\\,\\mathrm{K}$ and $T(L)=0\\,\\mathrm{K}$. Integrating this equation over the $i$-th control volume (from $x_{i-1/2}$ to $x_{i+1/2}$) yields a balance of fluxes:\n$$ \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i+1/2}} - \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i-1/2}} + \\int_{x_{i-1/2}}^{x_{i+1/2}} Q(x) dx = 0 $$\nApproximating the fluxes at cell faces and the integrated source term, we obtain a system of linear equations for the cell-centered temperatures $T_i$.\nFor an interior cell $i \\in \\{2, \\dots, N_c-1\\}$:\n$$ k\\frac{T_{i-1} - T_i}{\\Delta x_c} + k\\frac{T_{i+1} - T_i}{\\Delta x_c} + Q_i \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{i-1} + 2T_i - T_{i+1}) = Q_i \\Delta x_c $$\nFor the first cell ($i=1$), with boundary condition $T(0)=0$:\n$$ k\\frac{T(0) - T_1}{\\Delta x_c/2} + k\\frac{T_2 - T_1}{\\Delta x_c} + Q_1 \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(3T_1 - T_2) = Q_1 \\Delta x_c $$\nFor the last cell ($i=N_c$), with boundary condition $T(L)=0$:\n$$ k\\frac{T_{N_c-1} - T_{N_c}}{\\Delta x_c} + k\\frac{T(L) - T_{N_c}}{\\Delta x_c/2} + Q_{N_c} \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{N_c-1} + 3T_{N_c}) = Q_{N_c} \\Delta x_c $$\nThis forms a symmetric, tridiagonal linear system $M\\mathbf{T}=\\mathbf{b}$, where $\\mathbf{T}$ is the vector of cell-centered temperatures. The matrix $M$ is defined by the coefficients of $T_i$ and the vector $\\mathbf{b}$ by the source terms. This system can be solved efficiently for $\\mathbf{T}$.\n\n### 4. Flux-Based Conservation Verification\n\nGlobal energy conservation requires that the total power deposited within the domain, $P_{\\text{dep}}$, must be balanced by the total power conducted out through the boundaries. The total outward power flux, $P_{\\text{flux}}$, is the sum of the power leaving through the left and right boundaries: $P_{\\text{flux}} = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$.\n\nThe outward heat fluxes are calculated using one-sided finite differences consistent with the FVM discretization:\n$$ q_{\\text{out}}(0) = k \\frac{T_1 - T(0)}{\\Delta x_c/2} = \\frac{2k T_1}{\\Delta x_c} $$\n$$ q_{\\text{out}}(L) = -k \\frac{T(L) - T_{N_c}}{\\Delta x_c/2} = \\frac{2k T_{N_c}}{\\Delta x_c} $$\nNote that the problem statement defined $q_{\\text{out}}(L) = k \\frac{T_{N_c} - T_{\\text{bc}}}{\\Delta x_c/2}$, which for $T_{\\text{bc}}=0$ is identical to the standard definition used here.\n\nSumming the FVM equations over all cells demonstrates that the discretized system is inherently conservative: $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$. Thus, $P_{\\text{dep\\_coarse}} = P_{\\text{flux}}$ must hold to within the numerical precision of the linear solver. The flux balance error, $e_{\\text{flux}}$, compares this calculated total flux with the original deposited power from the MC simulation:\n$$ e_{\\text{flux}} = \\frac{\\left| P_{\\text{flux}} - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\nThis error should be nearly identical to $e_{\\text{map}}$, reflecting the excellent conservation properties of the chosen numerical methods.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 3.0, 1000.0, 10.0, 200000, 400, 50, 42),\n        (1.0, 0.2, 1000.0, 5.0, 100000, 300, 30, 123),\n        (1.0, 50.0, 500.0, 1.0, 300000, 500, 10, 777),\n        (1.0, 5.0, 800.0, 20.0, 500, 240, 60, 999),\n    ]\n\n    results = []\n    for params in test_cases:\n        e_map, e_flux = run_case(*params)\n        results.extend([e_map, e_flux])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(L, sigma, P0, k, Np, Nf, Nc, seed):\n    \"\"\"\n    Executes a single test case for the coupled MC-FVM simulation.\n    \n    Args:\n        L (float): Length of the slab [m].\n        sigma (float): Attenuation coefficient [m^-1].\n        P0 (float): Total injected beam power [W].\n        k (float): Thermal conductivity [W m^-1 K^-1].\n        Np (int): Number of Monte Carlo histories.\n        Nf (int): Number of fine-grid bins for MC tally.\n        Nc (int): Number of coarse-grid cells for FVM.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        tuple[float, float]: A tuple containing the source-mapping conservation \n                             error (e_map) and the flux balance error (e_flux).\n    \"\"\"\n    # --- Constants and Derived Parameters ---\n    A = 1.0  # Unit cross-sectional area [m^2]\n    epsilon = 1e-16  # Small number to prevent division by zero [W]\n    dx_f = L / Nf  # Fine-grid bin width [m]\n    dx_c = L / Nc  # Coarse-grid cell width [m]\n    power_per_history = P0 / Np  # Power weight per MC history [W]\n    T_bc = 0.0 # Boundary temperature [K]\n\n    # --- 1. Monte Carlo Power Deposition ---\n    rng = np.random.default_rng(seed)\n    # The scale parameter beta for numpy's exponential is 1/lambda, \n    # where lambda is the rate. Here, rate is sigma.\n    absorption_distances = rng.exponential(scale=1.0/sigma, size=Np)\n\n    fine_power_tally = np.zeros(Nf)\n    for x_abs in absorption_distances:\n        if x_abs  L:\n            # Determine which fine bin the deposition occurs in\n            bin_idx = int(x_abs / dx_f)\n            # Ensure index is within bounds (can happen with x_abs close to L)\n            if bin_idx  Nf:\n                fine_power_tally[bin_idx] += power_per_history\n\n    P_dep = np.sum(fine_power_tally)\n\n    # --- 2. Conservative Tally-to-Source Mapping ---\n    Q_coarse = np.zeros(Nc)\n    agg_factor = Nf // Nc  # Number of fine bins per coarse cell\n    \n    coarse_power_tally = np.zeros(Nc)\n    for i in range(Nc):\n        start_idx = i * agg_factor\n        end_idx = (i + 1) * agg_factor\n        power_in_cell = np.sum(fine_power_tally[start_idx:end_idx])\n        coarse_power_tally[i] = power_in_cell\n        cell_volume = A * dx_c\n        Q_coarse[i] = power_in_cell / cell_volume\n\n    # --- Error Calculation: Source Mapping ---\n    P_dep_coarse = np.sum(coarse_power_tally)\n    e_map = abs(P_dep_coarse - P_dep) / max(P_dep, epsilon)\n    \n    if P_dep  epsilon: # Handle case where no power is deposited\n        return e_map, 0.0\n\n    # --- 3. FVM Solution ---\n    # We solve M * T = b for temperatures T\n    # where M is the tridiagonal matrix and b is the source vector.\n    # The system is (k/dx_c) * M' * T = b_Q, where M' is dimensionless \n    # and b_Q_i = Q_i * dx_c\n    # This simplifies to M' * T = b', with b'_i = Q_i * (dx_c**2) / k\n    \n    # Construct the M' matrix\n    diag_main = np.full(Nc, 2.0)\n    diag_main[0] = 3.0\n    diag_main[-1] = 3.0\n    diag_off = np.full(Nc - 1, -1.0)\n    M_prime = np.diag(diag_main) + np.diag(diag_off, k=1) + np.diag(diag_off, k=-1)\n\n    # Construct the b' vector\n    b_prime = Q_coarse * (dx_c**2) / k\n    \n    # Solve the linear system for cell-centered temperatures\n    T_cell_centers = np.linalg.solve(M_prime, b_prime)\n\n    # --- 4. Flux-Based Conservation Verification ---\n    T1 = T_cell_centers[0]\n    T_Nc = T_cell_centers[-1]\n\n    # Outward flux per unit area [W/m^2]\n    q_out_0 = k * (T1 - T_bc) / (dx_c / 2.0)\n    q_out_L = k * (T_Nc - T_bc) / (dx_c / 2.0)\n    \n    # Total outward power [W]\n    P_flux = A * (q_out_0 + q_out_L)\n    \n    # --- Error Calculation: Flux Balance ---\n    e_flux = abs(P_flux - P_dep) / max(P_dep, epsilon)\n\n    return e_map, e_flux\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "A computational model is only reliable if it is correctly implemented, and verification is the process of ensuring this. This final hands-on practice  introduces a fundamental verification test for any transport code: checking for global energy conservation. You will formulate and apply a robust numerical test to confirm that the total energy added by a source term, such as $\\mathbf{J} \\cdot \\mathbf{E}$, is precisely balanced by the energy fluxes handled by the solver, ensuring the code's internal consistency and adherence to physical law.",
            "id": "4057530",
            "problem": "Consider a one-dimensional slab model of a magnetically confined fusion plasma for verifying electromagnetic heating deposition in a transport solver. Let the spatial coordinate be $x \\in [0,L]$ with uniform cross-sectional area $A$ and the time coordinate be $t \\in [0,T]$. The volumetric electrical current density is $\\mathbf{J}(x,t)$ (units $\\text{A}/\\text{m}^2$), the electric field is $\\mathbf{E}(x,t)$ (units $\\text{V}/\\text{m}$), and the transport solver deposits a volumetric heat source $S_E(x,t)$ (units $\\text{W}/\\text{m}^3$). The fundamental basis is the Poynting theorem and the definition of resistive heating:\n- Poynting theorem: $\\dfrac{\\partial u_{\\text{em}}}{\\partial t} + \\nabla \\cdot \\mathbf{S} + \\mathbf{J}\\cdot \\mathbf{E} = 0$, where $u_{\\text{em}}$ is electromagnetic energy density and $\\mathbf{S}$ is the Poynting vector.\n- Resistive (Joule) heating rate density: $q_{\\text{ohm}} = \\mathbf{J}\\cdot \\mathbf{E}$.\n\nAssume a closed domain with negligible net Poynting flux through the boundary and negligible net change in electromagnetic energy over $[0,T]$. Under these assumptions, the total electromagnetic work done on the plasma equals the total heat deposited in the transport model, expressed as\n$$\nQ_{\\mathbf{J}\\cdot\\mathbf{E}} \\equiv \\int_0^T \\int_V \\mathbf{J}\\cdot \\mathbf{E}\\,\\mathrm{d}V\\,\\mathrm{d}t,\\quad\nQ_{S_E} \\equiv \\int_0^T \\int_V S_E\\,\\mathrm{d}V\\,\\mathrm{d}t,\n$$\nand the verification test compares $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ to $Q_{S_E}$. Both $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ and $Q_{S_E}$ must be expressed in Joules ($\\text{J}$). Use angles in radians for any trigonometric functions.\n\nYou must derive a tolerance criterion in terms of a relative error and implement it numerically for a discretized domain. Let the discrete grids be $x_i$ for $i=1,\\dots,N_x$ uniformly covering $[0,L]$ and $t_j$ for $j=1,\\dots,N_t$ uniformly covering $[0,T]$. Use the trapezoidal rule to approximate both integrals, with spatial element $\\mathrm{d}V = A\\,\\mathrm{d}x$ and temporal element $\\mathrm{d}t$. The relative error must be defined so that it is robust when $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ is very small or zero; specify and justify any small positive floor you use in the denominator, expressed in Joules.\n\nYour program shall implement the following test suite of parameter sets. In all cases use $N_x=100$ and $N_t=80$, uniform grids; $L=1\\ \\text{m}$, $A=10\\ \\text{m}^2$, $T=0.1\\ \\text{s}$; and a tolerance threshold $\\tau=0.01$ (a decimal). Use an energy floor $E_{\\min}=10^{-12}\\ \\text{J}$ in the denominator of the relative error. For each case, define $\\mathbf{J}(x,t)$, $\\mathbf{E}(x,t)$, and $S_E(x,t)$ as follows:\n\n- Case 1 (happy path, exact match):\n  - $J_0 = 2\\times 10^6\\ \\text{A}/\\text{m}^2$, $E_0 = 5\\ \\text{V}/\\text{m}$.\n  - $\\mathbf{J}(x,t) = J_0$.\n  - $\\mathbf{E}(x,t) = E_0$.\n  - $S_E(x,t) = J_0\\,E_0$.\n\n- Case 2 (small consistent scaling error, should pass):\n  - $J_0 = 2\\times 10^6\\ \\text{A}/\\text{m}^2$, $E_0 = 5\\ \\text{V}/\\text{m}$, $\\sigma = 0.25\\,L$, $\\delta = 0.005$.\n  - $\\mathbf{J}(x,t) = J_0\\left(1 + 0.2\\sin\\left(\\dfrac{2\\pi x}{L}\\right)\\right)\\left(1 + 0.1\\cos\\left(\\dfrac{2\\pi t}{T}\\right)\\right)$.\n  - $\\mathbf{E}(x,t) = E_0\\exp\\left(-\\dfrac{(x - L/2)^2}{2\\sigma^2}\\right)\\left(1 + 0.05\\sin\\left(\\dfrac{2\\pi t}{T}\\right)\\right)$.\n  - $S_E(x,t) = (1+\\delta)\\,\\mathbf{J}(x,t)\\cdot \\mathbf{E}(x,t)$.\n\n- Case 3 (zero fields, boundary condition for denominator, should pass):\n  - $\\mathbf{J}(x,t) = 0$.\n  - $\\mathbf{E}(x,t) = 0$.\n  - $S_E(x,t) = 0$.\n\n- Case 4 (boundary tolerance, exactly at threshold):\n  - Same $\\mathbf{J}(x,t)$ and $\\mathbf{E}(x,t)$ as Case 2, but $\\delta = 0.01$.\n  - $S_E(x,t) = (1+\\delta)\\,\\mathbf{J}(x,t)\\cdot \\mathbf{E}(x,t)$.\n\n- Case 5 (significant mismatch, should fail):\n  - Same $\\mathbf{J}(x,t)$ and $\\mathbf{E}(x,t)$ as Case 2, but $\\delta = 0.05$.\n  - $S_E(x,t) = (1+\\delta)\\,\\mathbf{J}(x,t)\\cdot \\mathbf{E}(x,t)$.\n\nTasks:\n1. Starting from the stated fundamental laws, derive a relative error criterion that is physically justified and numerically well-posed for this verification test. The criterion must compare $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ and $Q_{S_E}$ and return a boolean indicating whether the case passes the tolerance threshold $\\tau$; define pass as the relative error being less than or equal to $\\tau$.\n2. Implement the trapezoidal rule to compute $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ and $Q_{S_E}$ for each case, and apply your tolerance criterion using the specified $E_{\\min}$ and $\\tau$.\n3. Express all intermediate physical quantities in the International System of Units (SI). Angles in trigonometric functions must be in radians.\n4. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3]\"). Each element must be a boolean indicating pass ($\\text{True}$) or fail ($\\text{False}$) for the corresponding case, in the order Cases 1 through 5.",
            "solution": "The problem requires the development and implementation of a verification test for electromagnetic heating deposition in a computational transport solver. The test compares the total energy deposited as a heat source, $Q_{S_E}$, to the total electromagnetic work done on the plasma, $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$, over a specified domain and time interval.\n\nThe fundamental physical principle is the conservation of energy, articulated by the Poynting theorem for electromagnetic fields:\n$$\n\\dfrac{\\partial u_{\\text{em}}}{\\partial t} + \\nabla \\cdot \\mathbf{S} + \\mathbf{J}\\cdot \\mathbf{E} = 0\n$$\nHere, $u_{\\text{em}}$ is the electromagnetic energy density, $\\mathbf{S}$ is the Poynting vector representing energy flux, and $\\mathbf{J}\\cdot \\mathbf{E}$ is the volumetric rate at which the electromagnetic field does work on charges (the power density). The term $\\mathbf{J}\\cdot \\mathbf{E}$ represents the energy transferred from the fields to the plasma particles, which manifests as heating. In a transport model, this heating must be represented by a source term, $S_E(x,t)$.\n\nThe problem states to assume a closed domain with negligible net Poynting flux through the boundary and a negligible net change in stored electromagnetic energy over the simulation time $[0,T]$. Integrating the Poynting theorem over the volume $V$ and time $T$ yields:\n$$\n\\int_0^T \\int_V \\dfrac{\\partial u_{\\text{em}}}{\\partial t}\\,\\mathrm{d}V\\,\\mathrm{d}t + \\int_0^T \\oint_{\\partial V} \\mathbf{S} \\cdot \\mathrm{d}\\mathbf{A}\\,\\mathrm{d}t + \\int_0^T \\int_V \\mathbf{J}\\cdot \\mathbf{E}\\,\\mathrm{d}V\\,\\mathrm{d}t = 0\n$$\nThe first term represents the net change in stored electromagnetic energy, $\\Delta U_{\\text{em}}$, which is assumed to be negligible. The second term, by Gauss's theorem, is the integral of $\\nabla \\cdot \\mathbf{S}$ over the volume, representing net energy flux out of the domain, also assumed negligible. This leaves:\n$$\n\\int_0^T \\int_V \\mathbf{J}\\cdot \\mathbf{E}\\,\\mathrm{d}V\\,\\mathrm{d}t \\approx 0\n$$\nThe equation represents energy conservation where the work done by the field on the charges is balanced by a change in sources/sinks, which is implicitly what $S_E$ models. Therefore, the verification test compares the total work done by the fields, $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$, with the total energy deposited by the source term, $Q_{S_E}$.\n$$\nQ_{\\mathbf{J}\\cdot\\mathbf{E}} = \\int_0^T \\int_V \\mathbf{J}\\cdot \\mathbf{E}\\,\\mathrm{d}V\\,\\mathrm{d}t \\quad \\text{and} \\quad Q_{S_E} = \\int_0^T \\int_V S_E\\,\\mathrm{d}V\\,\\mathrm{d}t\n$$\nFor the one-dimensional slab model with spatial coordinate $x \\in [0,L]$ and uniform cross-sectional area $A$, the volume element is $\\mathrm{d}V = A\\,\\mathrm{d}x$. The integrals become:\n$$\nQ = A \\int_0^T \\left( \\int_0^L f(x,t)\\,\\mathrm{d}x \\right) \\mathrm{d}t\n$$\nwhere $f(x,t)$ is the relevant power density, either $\\mathbf{J}\\cdot\\mathbf{E}$ or $S_E$. Since $\\mathbf{J}$ and $\\mathbf{E}$ are given as scalar functions of $(x,t)$, their dot product simplifies to scalar multiplication $J(x,t)E(x,t)$.\n\nTo perform the calculation numerically, we discretize the domain. The spatial domain $[0,L]$ is divided into $N_x$ points, forming a grid $\\{x_i\\}$ for $i=0, \\dots, N_x-1$, with uniform spacing $\\Delta x = L/(N_x-1)$. The temporal domain $[0,T]$ is divided into $N_t$ points, $\\{t_j\\}$ for $j=0, \\dots, N_t-1$, with spacing $\\Delta t = T/(N_t-1)$.\n\nThe two-dimensional integral is computed using the trapezoidal rule. First, we integrate over space for each discrete time point $t_j$:\n$$\nP(t_j) = \\int_0^L f(x,t_j)\\,\\mathrm{d}x \\approx \\sum_{i=0}^{N_x-2} \\frac{1}{2} (f(x_{i+1}, t_j) + f(x_i, t_j)) \\Delta x\n$$\nThis is equivalent to `trapz(f[:, j], x)`. After obtaining the total power per unit area, $P(t_j)$, at each time step, we integrate over time:\n$$\n\\int_0^T P(t)\\,\\mathrm{d}t \\approx \\sum_{j=0}^{N_t-2} \\frac{1}{2} (P(t_{j+1}) + P(t_j)) \\Delta t\n$$\nThis corresponds to `trapz(P, t)`. Combining these and multiplying by the area $A$ gives the total energy $Q$.\n\nThe core of the verification is the tolerance criterion. A simple relative error, $|Q_{\\mathbf{J}\\cdot\\mathbf{E}} - Q_{S_E}| / |Q_{\\mathbf{J}\\cdot\\mathbf{E}}|$, is ill-posed if $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ is zero or close to zero, as this can lead to division by zero or an artificially large error for a small, physically insignificant absolute discrepancy.\n\nTo create a robust criterion, we normalize the absolute error, $\\Delta Q = |Q_{\\mathbf{J}\\cdot\\mathbf{E}} - Q_{S_E}|$, by a factor that reflects the energy scale of the problem but avoids instability. A suitable normalization factor is $\\max(|Q_{\\mathbf{J}\\cdot\\mathbf{E}}|, E_{\\min})$, where $E_{\\min}$ is a small, positive energy floor. The quantity $|Q_{\\mathbf{J}\\cdot\\mathbf{E}}|$ serves as the natural energy scale. When $|Q_{\\mathbf{J}\\cdot\\mathbf{E}}|$ is large, the criterion behaves as a standard relative error. When $|Q_{\\mathbf{J}\\cdot\\mathbf{E}}|$ is smaller than $E_{\\min}$, the denominator is fixed at $E_{\\min}$, turning the test into a scaled absolute error check, $\\Delta Q / E_{\\min}$. This prevents spurious failures when both $Q_{\\mathbf{J}\\cdot\\mathbf{E}}$ and $Q_{S_E}$ are correctly calculated to be near zero.\n\nThe final verification criterion is defined as follows: the test passes if the relative error $\\varepsilon_{\\text{rel}}$ is less than or equal to a given tolerance threshold $\\tau$.\n$$\n\\varepsilon_{\\text{rel}} = \\frac{|Q_{\\mathbf{J}\\cdot\\mathbf{E}} - Q_{S_E}|}{\\max(|Q_{\\mathbf{J}\\cdot\\mathbf{E}}|, E_{\\min})} \\le \\tau\n$$\nFor the given problem, $N_x=100$, $N_t=80$, $L=1\\ \\text{m}$, $A=10\\ \\text{m}^2$, $T=0.1\\ \\text{s}$, $\\tau=0.01$, and $E_{\\min}=10^{-12}\\ \\text{J}$. We will apply this procedure to each of the five test cases specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a verification test for electromagnetic heating deposition.\n    \"\"\"\n    \n    # Common parameters for all test cases\n    Nx = 100\n    Nt = 80\n    L = 1.0  # meters\n    A = 10.0  # meters^2\n    T = 0.1  # seconds\n    tau = 0.01  # tolerance threshold\n    E_min = 1e-12  # Joules, energy floor\n\n    # Discretized domain\n    x_grid = np.linspace(0, L, Nx)\n    t_grid = np.linspace(0, T, Nt)\n    xx, tt = np.meshgrid(x_grid, t_grid, indexing='ij')\n\n    results = []\n\n    for case_num in range(1, 6):\n        # Define functions for J, E, and S_E for each case\n        if case_num == 1:\n            # Case 1: happy path, exact match\n            J0 = 2.0e6\n            E0 = 5.0\n            J_vals = np.full_like(xx, J0)\n            E_vals = np.full_like(xx, E0)\n            SE_vals = np.full_like(xx, J0 * E0)\n        \n        elif case_num in [2, 4, 5]:\n            # Cases 2, 4, 5: varying consistent scaling error\n            J0 = 2.0e6\n            E0 = 5.0\n            sigma = 0.25 * L\n            \n            if case_num == 2:\n                delta = 0.005 # small consistent scaling error\n            elif case_num == 4:\n                delta = 0.01 # boundary tolerance\n            else: # case_num == 5\n                delta = 0.05 # significant mismatch\n\n            J_vals = J0 * (1.0 + 0.2 * np.sin(2 * np.pi * xx / L)) * \\\n                     (1.0 + 0.1 * np.cos(2 * np.pi * tt / T))\n            \n            E_vals = E0 * np.exp(-((xx - L/2.0)**2) / (2.0 * sigma**2)) * \\\n                     (1.0 + 0.05 * np.sin(2 * np.pi * tt / T))\n            \n            SE_vals = (1.0 + delta) * J_vals * E_vals\n\n        elif case_num == 3:\n            # Case 3: zero fields\n            J_vals = np.zeros_like(xx)\n            E_vals = np.zeros_like(xx)\n            SE_vals = np.zeros_like(xx)\n            \n        # Calculate power density from J and E\n        P_JE_vals = J_vals * E_vals\n\n        # Integrate using the trapezoidal rule\n        # Q = A * integral over time of (integral over space)\n        \n        # Q_J.E\n        # Integrate over space (axis=0) for each time step\n        power_vs_time_JE = np.trapz(P_JE_vals, x_grid, axis=0)\n        # Integrate power over time (axis=0) and multiply by area\n        Q_J_E = A * np.trapz(power_vs_time_JE, t_grid, axis=0)\n        \n        # Q_S_E\n        # Integrate over space (axis=0) for each time step\n        power_vs_time_SE = np.trapz(SE_vals, x_grid, axis=0)\n        # Integrate power over time (axis=0) and multiply by area\n        Q_S_E = A * np.trapz(power_vs_time_SE, t_grid, axis=0)\n\n        # Apply the robust relative error criterion\n        absolute_error = abs(Q_J_E - Q_S_E)\n        denominator = max(abs(Q_J_E), E_min)\n        relative_error = absolute_error / denominator\n        \n        # Check if the test passes\n        passes_test = relative_error = tau\n        results.append(passes_test)\n\n    # Final print statement in the exact required format.\n    # The output format requests Python's boolean literals as strings\n    print(f\"[{','.join(map(lambda b: str(b), results))}]\")\n\nsolve()\n```"
        }
    ]
}