{
    "hands_on_practices": [
        {
            "introduction": "在多物种等离子体中，理解辅助加热功率如何在电子和各种离子之间分配至关重要。这种分配直接影响它们各自的温度分布和等离子体的整体性能。本练习提供了一种基于等离子体介电响应直接计算这种加热分配的方法，将波-粒子相互作用的微观物理（体现在介电张量中）与宏观加热结果联系起来。",
            "id": "4057536",
            "problem": "一个均匀、磁化的多组分等离子体由一个单色射频（RF）电场驱动。等离子体响应通过一个复介电张量进行线性建模。要求您计算按组分分辨的时间平均电磁功密度，并推断各组分之间的加热沉积分配。\n\n假设如下：\n\n- 电场相量在空间上是均匀的，在国际单位制（SI）中等于 $\\mathbf{E} = \\left(4.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{x}} + \\left(3.00 \\times 10^{3}\\,i\\right)\\,\\hat{\\mathbf{y}} + \\left(2.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{z}}$，角频率为 $\\omega = 2\\pi \\times 80 \\times 10^{6}$。\n- 真空介电常数为 $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$（SI 单位）。\n- 总介电张量为 $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_{s} \\boldsymbol{\\chi}_{s}$，其中 $s$ 为组分索引。该等离子体有三个组分：电子（$e$）、氘离子（$D^{+}$）和氦灰（$\\mathrm{He}^{2+}$）。\n- 各组分的电极化率在此基底下是对角的，并由下式给出：\n  - 电子：$\\boldsymbol{\\chi}_{e} = \\mathrm{diag}\\!\\left(-4.5 + i\\,1.5 \\times 10^{-3},\\,-3.8 + i\\,1.0 \\times 10^{-3},\\,-0.2 + i\\,2.0 \\times 10^{-4}\\right)$，\n  - 氘：$\\boldsymbol{\\chi}_{D} = \\mathrm{diag}\\!\\left(0.6 + i\\,0.6 \\times 10^{-3},\\,0.4 + i\\,0.8 \\times 10^{-3},\\,0.05 + i\\,0.1 \\times 10^{-3}\\right)$，\n  - 氦：$\\boldsymbol{\\chi}_{\\mathrm{He}} = \\mathrm{diag}\\!\\left(0.3 + i\\,0.3 \\times 10^{-3},\\,0.2 + i\\,0.2 \\times 10^{-3},\\,0.01 + i\\,0.05 \\times 10^{-3}\\right)$。\n\n从 Poynting 定理和线性本构关系 $\\mathbf{D} = \\varepsilon_{0}\\,\\boldsymbol{\\varepsilon}\\,\\mathbf{E}$ 出发，推导按组分分辨的时间平均电磁功密度 $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$ 的表达式，该表达式用 $\\boldsymbol{\\chi}_{s}$ 的反厄米（虚）部分和场相量表示。使用此表达式和上述数据计算每个组分的 $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$，然后推断沉积分配分数 $f_{s} = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\big/ \\sum_{r} \\left\\langle \\mathbf{J}_{r} \\cdot \\mathbf{E} \\right\\rangle$ (其中 $s \\in \\{e, D, \\mathrm{He}\\}$)。\n\n以行向量 $(f_{e}, f_{D}, f_{\\mathrm{He}})$ 的形式提供最终的沉积分配，每个条目保留四位有效数字。沉积分配是无量纲的；最终答案中不要包含单位。",
            "solution": "该问题被认为是有效的，因为它在等离子体物理学和电磁学方面有科学依据，是适定的、客观的且内部一致的。所有得出唯一解所需的数据均已提供。\n\n第一步是推导按组分分辨的时间平均电磁功密度的表达式，记为 $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$。设组分 $s$ 的物理实值电场和电流密度分别为 $\\mathbf{e}(t)$ 和 $\\mathbf{j}_s(t)$。假设一个角频率为 $\\omega$ 的单色波，这些量可以用复相量 $\\mathbf{E}$ 和 $\\mathbf{J}_s$ 表示如下：\n$$ \\mathbf{e}(t) = \\mathrm{Re}(\\mathbf{E} \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{E} \\exp(-i\\omega t) + \\mathbf{E}^* \\exp(i\\omega t)) $$\n$$ \\mathbf{j}_s(t) = \\mathrm{Re}(\\mathbf{J}_s \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{J}_s \\exp(-i\\omega t) + \\mathbf{J}_s^* \\exp(i\\omega t)) $$\n电场对组分 $s$ 的粒子所做的瞬时功密度（单位体积的功率）为 $\\mathbf{j}_s(t) \\cdot \\mathbf{e}(t)$。时间平均功密度是此量在一个波周期 $T = 2\\pi/\\omega$ 内的平均值：\n$$ \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\equiv \\left\\langle P_s \\right\\rangle = \\frac{1}{T} \\int_0^T \\mathbf{j}_s(t) \\cdot \\mathbf{e}(t) dt $$\n代入相量表达式并积分，以频率 $2\\omega$ 振荡的项的平均值为零，剩下：\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{4}(\\mathbf{J}_s^\\dagger \\mathbf{E} + \\mathbf{J}_s^\\intercal \\mathbf{E}^*) = \\frac{1}{2} \\mathrm{Re}(\\mathbf{J}_s^\\dagger \\mathbf{E}) $$\n其中 $\\mathbf{J}_s^\\dagger$ 是向量 $\\mathbf{J}_s$ 的共轭转置（厄米共轭）。\n\n接下来，我们将电流密度相量 $\\mathbf{J}_s$ 与电场相量 $\\mathbf{E}$ 联系起来。总位移场 $\\mathbf{D}$ 通过介电张量 $\\boldsymbol{\\varepsilon}$ 与 $\\mathbf{E}$ 相关，关系为 $\\mathbf{D} = \\varepsilon_0 \\boldsymbol{\\varepsilon} \\mathbf{E}$。本构关系由 $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_s \\boldsymbol{\\chi}_s$ 给出，其中 $\\boldsymbol{\\chi}_s$ 是组分 $s$ 的电极化率。极化密度 $\\mathbf{P}$ 为 $\\mathbf{P} = \\mathbf{D} - \\varepsilon_0 \\mathbf{E} = \\varepsilon_0 (\\sum_s \\boldsymbol{\\chi}_s) \\mathbf{E}$。单个组分 $s$ 的极化为 $\\mathbf{P}_s = \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E}$。组分 $s$ 的电流密度是其极化的时间导数，$\\mathbf{j}_s(t) = \\frac{\\partial \\mathbf{P}_s(t)}{\\partial t}$。在频域中，这对应于乘以 $-i\\omega$：\n$$ \\mathbf{J}_s = -i\\omega \\mathbf{P}_s = -i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E} $$\n将此代入时间平均功率密度的表达式中：\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{2} \\mathrm{Re}\\left( (-i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{1}{2} \\mathrm{Re}\\left( i\\omega \\varepsilon_0 (\\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_s^\\dagger \\mathbf{E} \\right) $$\n电极化率张量 $\\boldsymbol{\\chi}_s$ 可以分解为其复实部和虚部，$\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_{s,R} + i\\boldsymbol{\\chi}_{s,I}$，其中 $\\boldsymbol{\\chi}_{s,R}$ 和 $\\boldsymbol{\\chi}_{s,I}$ 是实矩阵。由于给定的 $\\boldsymbol{\\chi}_s$ 是对角的，所以它是对称的（$\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_s^\\intercal$），因此其厄米共轭就是其复共轭：$\\boldsymbol{\\chi}_s^\\dagger = \\boldsymbol{\\chi}_s^* = \\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}$。\n将此代入功率表达式中：\n$$ \\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger (\\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}) \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i(\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}) + (\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}) \\right) $$\n对于一个实对称矩阵 $\\mathbf{M}$，二次型 $\\mathbf{E}^\\dagger \\mathbf{M} \\mathbf{E}$ 恒为实数。由于 $\\boldsymbol{\\chi}_{s,R}$ 和 $\\boldsymbol{\\chi}_{s,I}$ 是实的且对角的（因此是对称的），$\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}$ 和 $\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$ 都是实数。因此，括号中表达式的实部就是第二项：\n$$ \\left\\langle P_s \\right\\rangle = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} $$\n该表达式以电极化率张量的虚部给出了功率沉积。$\\boldsymbol{\\chi}_s$ 的反厄米部分是 $\\boldsymbol{\\chi}_{s,A} = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^\\dagger) = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^*) = i\\boldsymbol{\\chi}_{s,I}$。因此，$\\boldsymbol{\\chi}_{s,I} = -i \\boldsymbol{\\chi}_{s,A}$，功率沉积也可以用反厄米部分表示为 $\\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger (-i\\boldsymbol{\\chi}_{s,A}) \\mathbf{E}$，这满足了问题的要求。\n\n现在我们计算数值。电场相量为 $\\mathbf{E} = (4.00 \\times 10^{3})\\,\\hat{\\mathbf{x}} + (3.00 \\times 10^{3}\\,i)\\,\\hat{\\mathbf{y}} + (2.00 \\times 10^{3})\\,\\hat{\\mathbf{z}}$。其分量的模的平方为：\n$$ |E_x|^2 = |4.00 \\times 10^3|^2 = 1.60 \\times 10^{7} $$\n$$ |E_y|^2 = |3.00 \\times 10^3 i|^2 = 9.00 \\times 10^{6} $$\n$$ |E_z|^2 = |2.00 \\times 10^3|^2 = 4.00 \\times 10^{6} $$\n电极化率张量是对角的，所以 $\\boldsymbol{\\chi}_{s,I} = \\mathrm{diag}(\\mathrm{Im}(\\chi_{s,xx}), \\mathrm{Im}(\\chi_{s,yy}), \\mathrm{Im}(\\chi_{s,zz}))$。二次型简化为：\n$$ \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} = |E_x|^2 \\mathrm{Im}(\\chi_{s,xx}) + |E_y|^2 \\mathrm{Im}(\\chi_{s,yy}) + |E_z|^2 \\mathrm{Im}(\\chi_{s,zz}) $$\n我们来计算每个组分的这个量，记为 $W_s = \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$。\n对于电子（$s=e$）：\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_e) = \\mathrm{diag}(1.5 \\times 10^{-3}, 1.0 \\times 10^{-3}, 2.0 \\times 10^{-4}) $$\n$$ W_e = (1.60 \\times 10^7)(1.5 \\times 10^{-3}) + (9.00 \\times 10^6)(1.0 \\times 10^{-3}) + (4.00 \\times 10^6)(2.0 \\times 10^{-4}) $$\n$$ W_e = 24000 + 9000 + 800 = 33800 $$\n对于氘（$s=D$）：\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_D) = \\mathrm{diag}(0.6 \\times 10^{-3}, 0.8 \\times 10^{-3}, 0.1 \\times 10^{-3}) $$\n$$ W_D = (1.60 \\times 10^7)(0.6 \\times 10^{-3}) + (9.00 \\times 10^6)(0.8 \\times 10^{-3}) + (4.00 \\times 10^6)(0.1 \\times 10^{-3}) $$\n$$ W_D = 9600 + 7200 + 400 = 17200 $$\n对于氦（$s=\\mathrm{He}$）：\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_{\\mathrm{He}}) = \\mathrm{diag}(0.3 \\times 10^{-3}, 0.2 \\times 10^{-3}, 0.05 \\times 10^{-3}) $$\n$$ W_{\\mathrm{He}} = (1.60 \\times 10^7)(0.3 \\times 10^{-3}) + (9.00 \\times 10^6)(0.2 \\times 10^{-3}) + (4.00 \\times 10^6)(0.05 \\times 10^{-3}) $$\n$$ W_{\\mathrm{He}} = 4800 + 1800 + 200 = 6800 $$\n组分 $s$ 的沉积分配分数为 $f_s = \\left\\langle P_s \\right\\rangle \\big/ \\sum_r \\left\\langle P_r \\right\\rangle$。公共因子 $\\frac{\\omega\\varepsilon_0}{2}$ 消掉了，所以 $f_s = W_s \\big/ \\sum_r W_r$。\n总和为 $W_{\\text{total}} = W_e + W_D + W_{\\mathrm{He}} = 33800 + 17200 + 6800 = 57800$。\n分数为：\n$$ f_e = \\frac{33800}{57800} = \\frac{338}{578} \\approx 0.5847750865 $$\n$$ f_D = \\frac{17200}{57800} = \\frac{172}{578} \\approx 0.2975778546 $$\n$$ f_{\\mathrm{He}} = \\frac{6800}{57800} = \\frac{68}{578} \\approx 0.1176470588 $$\n按要求将每个数四舍五入到四位有效数字：\n$$ f_e \\approx 0.5848 $$\n$$ f_D \\approx 0.2976 $$\n$$ f_{\\mathrm{He}} \\approx 0.1176 $$\n最终答案是行向量 $(f_e, f_D, f_{\\mathrm{He}})$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.5848  0.2976  0.1176 \\end{pmatrix} } $$"
        },
        {
            "introduction": "在确定了热源之后，下一步是模拟它们对等离子体温度演化的影响。由于源项和汇项可能很大且对温度有强烈的依赖性，因此描述能量平衡的控制方程通常是“刚性”的。本练习通过推导一个简单显式积分格式的稳定性极限，深入探讨了这一关键的数值挑战，阐明了为何时间步长的选择对于稳定和准确的输运模拟至关重要。",
            "id": "4057577",
            "problem": "考虑一个空间均匀的环形等离子体，其电子温度的演化由零维电子能量平衡方程建模\n$$\n\\frac{3}{2} n_{e} k_{B} \\frac{d T_{e}}{d t} \\;=\\; S_{\\mathrm{RF}}(T_{e}) \\;-\\; Q_{\\mathrm{cond}}(T_{e}) ,\n$$\n其中，$n_{e}$ 是电子数密度，$k_{B}$ 是玻尔兹曼常数，$T_{e}$ 是电子温度，$S_{\\mathrm{RF}}(T_{e})$ 是体射频（RF）加热沉积项，$Q_{\\mathrm{cond}}(T_{e})$ 是由单一有效能量约束时间 $\\tau_{E}$ 建模的体传导损失项。假设射频加热沉积具有一个由碰撞性决定的吸收因子，其模型为\n$$\nS_{\\mathrm{RF}}(T_{e}) \\;=\\; \\alpha \\,\\frac{P_{\\mathrm{RF}}}{V}\\,\\left(\\frac{T_{\\mathrm{ref}}}{T_{e}}\\right)^{1/2} ,\n$$\n并且传导损失为\n$$\nQ_{\\mathrm{cond}}(T_{e}) \\;=\\; \\frac{3}{2}\\,n_{e}\\,k_{B}\\,\\frac{T_{e}}{\\tau_{E}} .\n$$\n此处，$\\alpha$ 是一个无量纲吸收系数，$P_{\\mathrm{RF}}$ 是外部注入的射频功率，$V$ 是等离子体体积，$T_{\\mathrm{ref}}$ 是一个固定的参考温度。\n\n您将使用前向欧拉法对能量方程进行显式积分，\n$$\nT_{e}^{n+1} \\;=\\; T_{e}^{n} \\;+\\; \\Delta t\\, f(T_{e}^{n}) ,\n$$\n其中 $f(T_{e}) \\equiv \\big(S_{\\mathrm{RF}}(T_{e}) - Q_{\\mathrm{cond}}(T_{e})\\big)\\big/\\big(\\tfrac{3}{2}n_{e}k_{B}\\big)$。\n\n任务：\n1. 从以上定义和应用于线性化标量测试问题的前向欧拉法的绝对稳定性要求出发，推导该显式积分器的时间步长稳定性判据，该判据应以在当前温度下求值的雅可比导数 $\\partial f/\\partial T_{e}$ 表示。\n2. 使用推导出的判据，在 $T_{e} = T_{0}$ 时计算允许的 $\\Delta t$，参数如下：\n   - $n_{e} = 5.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，\n   - $k_{B} = 1.380\\,649 \\times 10^{-23}\\ \\mathrm{J/K}$，\n   - $\\tau_{E} = 0.030\\ \\mathrm{s}$，\n   - $\\alpha = 0.35$，\n   - $P_{\\mathrm{RF}} = 4.0 \\times 10^{6}\\ \\mathrm{W}$，\n   - $V = 25\\ \\mathrm{m}^{3}$，\n   - $T_{\\mathrm{ref}} = 1000\\ \\mathrm{eV}$，\n   - $T_{0} = 200\\ \\mathrm{eV}$，\n   - 以及温度到开尔文的转换关系 $T\\,[\\mathrm{K}] = 11604.518 \\times T\\,[\\mathrm{eV}]$。\n以毫秒为单位表示最终的时间步长，并将您的答案四舍五入至三位有效数字。",
            "solution": "用户希望找到应用于零维电子能量平衡模型的前向欧拉法的稳定性极限，并为一组给定的参数计算最大允许时间步长。\n\n### 第1部分：稳定性判据的推导\n\n该问题通过一个形如下式的一阶常微分方程（ODE）来描述电子温度 $T_e$ 的演化：\n$$\n\\frac{d y}{d t} = f(y)\n$$\n其中 $y(t)$ 对应于电子温度 $T_e(t)$。\n\n前向欧拉法是一种显式单步数值积分格式，其形式如下：\n$$\ny^{n+1} = y^n + \\Delta t f(y^n)\n$$\n为了分析该方法的数值稳定性，我们考虑将其应用于一个线性标量测试问题，该问题通过将原始ODE在一个点 $y^*$ 附近线性化得到。令 $y(t) = y^* + \\delta y(t)$，其中 $\\delta y(t)$ 是一个小扰动。扰动的演化由以下方程控制：\n$$\n\\frac{d(\\delta y)}{dt} \\approx \\left( \\frac{\\partial f}{\\partial y} \\bigg|_{y^*} \\right) \\delta y = \\lambda \\delta y\n$$\n此处，$\\lambda = \\partial f / \\partial y |_{y^*}$ 是系统在线性化点求值的雅可比。将前向欧拉法应用于此线性测试方程，得到：\n$$\n\\delta y^{n+1} = \\delta y^n + \\Delta t (\\lambda \\delta y^n) = (1 + \\lambda \\Delta t) \\delta y^n\n$$\n项 $g = 1 + \\lambda \\Delta t$ 是放大因子。为了使数值解稳定（即，扰动不会无界增长），放大因子的模必须小于或等于一：\n$$\n|g| = |1 + \\lambda \\Delta t| \\le 1\n$$\n在这样一个物理稳定的系统中，温度扰动预期会衰减，因此特征值 $\\lambda$ 必须是实数且为负（$\\lambda  0$）。对于实数 $\\lambda  0$，稳定性要求 $|1 + \\lambda \\Delta t| \\le 1$ 展开为：\n$$\n-1 \\le 1 + \\lambda \\Delta t \\le 1\n$$\n不等式的右侧 $1 + \\lambda \\Delta t \\le 1$ 意味着 $\\lambda \\Delta t \\le 0$。由于 $\\Delta t > 0$ 且我们假设 $\\lambda  0$，此条件总是满足。\n不等式的左侧 $-1 \\le 1 + \\lambda \\Delta t$ 得到 $-2 \\le \\lambda \\Delta t$。由于 $\\lambda$ 是负数，两边同除以它会反转不等号：\n$$\n\\Delta t \\le \\frac{-2}{\\lambda}\n$$\n由于 $\\lambda$ 是负数，$-\\lambda = |\\lambda|$。因此，稳定性判据可以写为：\n$$\n\\Delta t \\le \\frac{2}{|\\lambda|} = \\frac{2}{\\left| \\frac{\\partial f}{\\partial T_e} \\right|}\n$$\n这就是应用于此问题的前向欧拉法所需的时间步长稳定性判据。\n\n### 第2部分：允许的时间步长 $\\Delta t$ 的计算\n\n为了应用此判据，我们必须首先计算雅可比 $\\lambda = \\partial f/\\partial T_e$。与其使用需要重复转换的开尔文温度，不如直接用电子伏特（$\\mathrm{eV}$）为单位的温度来表述问题，我们将其记为 $\\mathcal{T}_e$。\n问题给出了温度转换关系：$T\\,[\\mathrm{K}] = 11604.518 \\times T\\,[\\mathrm{eV}]$。这个转换因子是 $c_K = e/k_B$，其中 $e$ 是基本电荷。因此，每个粒子的热能是 $k_B T_e = k_B (c_K \\mathcal{T}_e) = k_B (e/k_B) \\mathcal{T}_e = e \\mathcal{T}_e$。在这里，$e$ 代表与 $1\\,\\mathrm{eV}$ 对应的焦耳能量，即 $e \\approx 1.602 \\times 10^{-19}\\ \\mathrm{J}$。我们使用 $E_{eV}$ 表示这个转换因子，以免与电子电荷符号混淆。$E_{eV}$ 的值可以从给定的常数中导出：$E_{eV} = k_B \\times c_K = (1.380649 \\times 10^{-23}\\ \\mathrm{J/K}) \\times (11604.518\\ \\mathrm{K/eV}) \\approx 1.6021764 \\times 10^{-19}\\ \\mathrm{J/eV}$。\n\n电子能量密度为 $U_e = \\frac{3}{2} n_e (k_B T_e) = \\frac{3}{2} n_e E_{eV} \\mathcal{T}_e$。能量平衡方程为 $\\frac{dU_e}{dt} = S_{\\mathrm{RF}} - Q_{\\mathrm{cond}}$。代入含 $\\mathcal{T}_e$ 的表达式：\n$$\n\\frac{d}{dt} \\left(\\frac{3}{2} n_e E_{eV} \\mathcal{T}_e\\right) = \\alpha \\frac{P_{\\mathrm{RF}}}{V} \\left(\\frac{\\mathcal{T}_{\\mathrm{ref}}}{\\mathcal{T}_e}\\right)^{1/2} - \\frac{3}{2} n_e E_{eV} \\frac{\\mathcal{T}_e}{\\tau_E}\n$$\n对左侧求导并重新整理，得到关于 $\\mathcal{T}_e$ 的ODE：\n$$\n\\frac{d\\mathcal{T}_e}{dt} = \\frac{2 \\alpha P_{\\mathrm{RF}}}{3 n_e V E_{eV}} \\frac{\\mathcal{T}_{\\mathrm{ref}}^{1/2}}{\\mathcal{T}_e^{1/2}} - \\frac{\\mathcal{T}_e}{\\tau_E}\n$$\n此方程的形式为 $\\frac{d\\mathcal{T}_e}{dt} = h(\\mathcal{T}_e)$。其雅可比为 $\\lambda_{\\mathcal{T}} = \\frac{\\partial h}{\\partial \\mathcal{T}_e}$。\n$$\n\\lambda_{\\mathcal{T}} = \\frac{2 \\alpha P_{\\mathrm{RF}} \\mathcal{T}_{\\mathrm{ref}}^{1/2}}{3 n_e V E_{eV}} \\frac{d}{d\\mathcal{T}_e}(\\mathcal{T}_e^{-1/2}) - \\frac{d}{d\\mathcal{T}_e}\\left(\\frac{\\mathcal{T}_e}{\\tau_E}\\right)\n$$\n$$\n\\lambda_{\\mathcal{T}} = \\frac{2 \\alpha P_{\\mathrm{RF}} \\mathcal{T}_{\\mathrm{ref}}^{1/2}}{3 n_e V E_{eV}} \\left(-\\frac{1}{2}\\mathcal{T}_e^{-3/2}\\right) - \\frac{1}{\\tau_E}\n$$\n$$\n\\lambda_{\\mathcal{T}} = - \\left( \\frac{\\alpha P_{\\mathrm{RF}} \\mathcal{T}_{\\mathrm{ref}}^{1/2}}{3 n_e V E_{eV} \\mathcal{T}_e^{3/2}} + \\frac{1}{\\tau_E} \\right)\n$$\n稳定性判据是 $\\Delta t \\le \\frac{2}{|\\lambda_{\\mathcal{T}}|}$。我们现在使用给定的参数，在 $\\mathcal{T}_e = T_0 = 200\\ \\mathrm{eV}$ 时计算 $|\\lambda_{\\mathcal{T}}|$ 的值。\n\n参数如下：\n- $n_{e} = 5.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$\n- $\\tau_{E} = 0.030\\ \\mathrm{s}$\n- $\\alpha = 0.35$\n- $P_{\\mathrm{RF}} = 4.0 \\times 10^{6}\\ \\mathrm{W}$\n- $V = 25\\ \\mathrm{m}^{3}$\n- $\\mathcal{T}_{\\mathrm{ref}} = 1000\\ \\mathrm{eV}$\n- $\\mathcal{T}_{e} = T_0 = 200\\ \\mathrm{eV}$\n- $E_{eV} = 1.6021764 \\times 10^{-19}\\ \\mathrm{J/eV}$\n\n我们计算 $|\\lambda_{\\mathcal{T}}|$ 括号内的两个项：\n1.  约束损失项：\n    $$\n    \\frac{1}{\\tau_E} = \\frac{1}{0.030\\ \\mathrm{s}} = \\frac{100}{3}\\ \\mathrm{s}^{-1} \\approx 33.3333\\ \\mathrm{s}^{-1}\n    $$\n2.  射频加热导数项：\n    $$\n    \\frac{\\alpha P_{\\mathrm{RF}} \\mathcal{T}_{\\mathrm{ref}}^{1/2}}{3 n_e V E_{eV} \\mathcal{T}_e^{3/2}}\n    $$\n    我们先计算系数：\n    $$\n    \\frac{\\alpha P_{\\mathrm{RF}}}{3 n_e V E_{eV}} = \\frac{0.35 \\times (4.0 \\times 10^6\\ \\mathrm{W})}{3 \\times (5.0 \\times 10^{19}\\ \\mathrm{m}^{-3}) \\times (25\\ \\mathrm{m}^3) \\times (1.6021764 \\times 10^{-19}\\ \\mathrm{J/eV})} \\approx 2330.15\\ \\mathrm{eV/s}\n    $$\n    现在，乘以与温度相关的部分：\n    $$\n    (\\dots) \\times \\frac{\\mathcal{T}_{\\mathrm{ref}}^{1/2}}{\\mathcal{T}_e^{3/2}} \\bigg|_{\\mathcal{T}_e=200} = 2330.15 \\times \\frac{(1000\\ \\mathrm{eV})^{1/2}}{(200\\ \\mathrm{eV})^{3/2}} = 2330.15 \\times \\frac{\\sqrt{1000}}{200\\sqrt{200}}\\ \\mathrm{s}^{-1}\n    $$\n    $$\n    = 2330.15 \\times \\frac{31.622776}{2828.4271}\\ \\mathrm{s}^{-1} \\approx 2330.15 \\times 0.0111803\\ \\mathrm{s}^{-1} \\approx 26.0526\\ \\mathrm{s}^{-1}\n    $$\n将这两项相加得到雅可比的模：\n$$\n|\\lambda_{\\mathcal{T}}| \\approx 26.0526\\ \\mathrm{s}^{-1} + 33.3333\\ \\mathrm{s}^{-1} = 59.3859\\ \\mathrm{s}^{-1}\n$$\n稳定性判据给出了最大允许时间步长 $\\Delta t_{\\mathrm{max}}$：\n$$\n\\Delta t_{\\mathrm{max}} = \\frac{2}{|\\lambda_{\\mathcal{T}}|} \\approx \\frac{2}{59.3859\\ \\mathrm{s}^{-1}} \\approx 0.033677\\ \\mathrm{s}\n$$\n问题要求答案以毫秒为单位，并四舍五入到三位有效数字。\n$$\n\\Delta t_{\\mathrm{max}} \\approx 33.677\\ \\mathrm{ms}\n$$\n四舍五入到三位有效数字，我们得到 $33.7\\ \\mathrm{ms}$。",
            "answer": "$$\\boxed{33.7}$$"
        },
        {
            "introduction": "最后的这项练习将前面的概念整合到一个全面而真实的计算任务中。复杂的加热模型（如中性束注入模型）通常使用蒙特卡洛方法来计算功率沉积。本练习将指导您完成将这类模型的离散输出与连续介质输运求解器进行“守恒耦合”的关键过程，确保能量在不同的数值网格和方法之间传递时不会被人为地创造或损失——这是高保真度模拟的基石。",
            "id": "4057586",
            "problem": "您的任务是实现蒙特卡洛（MC）沉积模型与一维有限体积法（FVM）输运求解器之间的保守耦合，用于求解板状几何结构中的稳态热传导问题。目标是将MC统计的沉积功率映射到FVM的体积源，并保证总能量守恒在浮点舍入误差范围内，然后通过比较总沉积功率与板边界处的总外向传导热通量之和来验证全局能量守恒。\n\n基本原理：\n- 注入束流功率沿路径的衰减使用比尔-朗伯定律建模。对于在位置 $x=0$ 处注入、沿 $+x$ 方向穿过衰减系数为 $\\sigma$（单位为 $\\mathrm{m}^{-1}$）的均匀介质的单向束流，其沿距离 $x$ 的存活概率为 $\\exp(-\\sigma x)$，吸收距离呈指数分布，其概率密度函数为 $p(x) = \\sigma \\exp(-\\sigma x)$（对于 $x \\ge 0$）。\n- 一维空间稳态热传导的能量守恒指出，积分体积热等于通过边界的总外向传导通量。设 $T(x)$ 为温度（单位 $\\mathrm{K}$），$k$ 为热导率（单位 $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$），$Q(x)$ 为体积热源（单位 $\\mathrm{W}\\,\\mathrm{m}^{-3}$）。稳态方程为 $\\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0$。在域 $x\\in[0,L]$ 上积分可得 $\\int_0^L Q(x)\\,dx = q_{\\text{out}}(0) + q_{\\text{out}}(L)$，其中 $q_{\\text{out}}(0) = k \\left.\\frac{dT}{dx}\\right|_{x=0}$ 和 $q_{\\text{out}}(L) = -k \\left.\\frac{dT}{dx}\\right|_{x=L}$ 是外向传导通量（单位 $\\mathrm{W}\\,\\mathrm{m}^{-2}$）。\n\n程序中需要实现的具体任务：\n- 几何与单位：长度为 $L$（单位 $\\mathrm{m}$）、单位横截面积 $A=1\\,\\mathrm{m}^2$ 的一维板。两端温度保持在 $T(0)=0\\,\\mathrm{K}$ 和 $T(L)=0\\,\\mathrm{K}$。热导率 $k$ 为常数，单位为 $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$。\n- 蒙特卡洛沉积：从 $x=0$ 处沿 $+x$ 方向注入总束流功率 $P_0$（单位 $\\mathrm{W}$）。模拟 $N_p$ 个独立历史。每个历史携带相等的功率权重 $w=P_0/N_p$（单位 $\\mathrm{W}$）。对每个历史，从率为 $\\sigma$（单位 $\\mathrm{m}^{-1}$）的指数分布中采样一个吸收距离 $x$。如果 $x  L$，粒子会将其功率权重沉积到相应的细网格单元中。如果 $x \\ge L$，则粒子透射，不沉积能量。\n- FVM求解器：为具有狄利克雷边界条件 $T(0)=0$ 和 $T(L)=0$ 的 $N_c$ 个单元的 FVM 网格构建线性系统。\n- 守恒验证：\n  - 计算源映射守恒误差 $e_{\\text{map}} = \\frac{\\left| P_{\\text{dep\\_coarse}} - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)}$，其中 $P_{\\text{dep}}$ 是 MC 统计的总沉积功率，$P_{\\text{dep\\_coarse}}$ 是从 FVM 源项重建的总功率，$\\epsilon=10^{-16}$。\n  - 计算通量平衡误差 $e_{\\text{flux}} = \\frac{\\left| P_{\\text{flux}} - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)}$，其中 $P_{\\text{flux}}$ 是从 FVM 温度解计算出的边界总外向热通量。\n\n对于以下每个测试用例，运行您的模拟并计算 $(e_{\\text{map}}, e_{\\text{flux}})$。以 `[e_map1, e_flux1, e_map2, e_flux2, ...]` 的格式将所有8个浮点数收集到一个列表中作为最终答案。\n- `test_case_1`: (L=1.0, sigma=3.0, P0=1000.0, k=10.0, Np=200000, Nf=400, Nc=50, seed=42)\n- `test_case_2`: (L=1.0, sigma=0.2, P0=1000.0, k=5.0, Np=100000, Nf=300, Nc=30, seed=123)\n- `test_case_3`: (L=1.0, sigma=50.0, P0=500.0, k=1.0, Np=300000, Nf=500, Nc=10, seed=777)\n- `test_case_4`: (L=1.0, sigma=5.0, P0=800.0, k=20.0, Np=500, Nf=240, Nc=60, seed=999)",
            "solution": "用户提供了一个有效的问题陈述。任务是实现一个蒙特卡洛（MC）和有限体积法（FVM）的耦合模拟，以模拟一维板中的热量沉积和输运，并验证能量的数值守恒性。该问题具有科学依据，是适定的，并且所有参数都已明确定义。\n\n解决方案通过为每个提供的测试用例执行一系列步骤来实现：（1）蒙特卡洛功率沉积模拟，（2）将功率统计保守地映射到粗 FVM 网格，（3）使用 FVM 求解稳态热传导方程，以及（4）验证全局能量守恒。\n\n### 1. 蒙特卡洛功率沉积\n\n单向束流的功率沉积被建模为一个由比尔-朗伯定律控制的随机过程。粒子吸收距离 $x$ 的概率密度函数由 $p(x) = \\sigma \\exp(-\\sigma x)$ 给出，其中 $\\sigma$ 是衰减系数。\n\n对于用 $N_p$ 个粒子历史模拟的总注入功率 $P_0$，每个历史携带的功率权重为 $w = P_0/N_p$。为模拟沉积过程，我们为 $N_p$ 个历史中的每一个采样一个吸收距离 $x$。这通过逆变换采样完成。累积分布函数是 $F(x) = \\int_0^x p(t) dt = 1 - \\exp(-\\sigma x)$。设 $F(x) = u$，其中 $u$ 是来自均匀分布 $U(0,1)$ 的随机变量，解出 $x$ 可得 $x = -\\frac{1}{\\sigma}\\ln(1-u)$。由于 $1-u$ 也均匀分布在 $(0,1)$ 上，这等价于从 $x = -\\frac{1}{\\sigma}\\ln(u')$ 中采样，其中 $u' \\sim U(0,1)$。在数值上，可以使用库函数从尺度参数为 $\\beta = 1/\\sigma$ 的指数分布中抽取样本。\n\n模拟域是一个长度为 $L$ 的板，被离散化为一个包含 $N_f$ 个单元的细网格，每个单元的宽度为 $\\Delta x_f = L/N_f$。对于每个历史，如果采样的吸收距离 $x$ 小于 $L$，粒子会将其功率 $w$ 沉积到相应的细网格单元中。单元索引 $j$ 由 $j = \\lfloor x / \\Delta x_f \\rfloor$ 确定。如果 $x \\ge L$，则粒子被视为透射，不在域内沉积功率。\n\n在所有 $N_p$ 个历史模拟完毕后，统计每个单元中沉积的总功率。域内总沉积功率 $P_{\\text{dep}}$ 是所有细网格单元中功率的总和：\n$$ P_{\\text{dep}} = \\sum_{j=0}^{N_f-1} P_{\\text{fine}, j} $$\n其中 $P_{\\text{fine}, j}$ 是在细网格单元 $j$ 中统计的总功率。\n\n### 2. 保守的统计到源映射\n\n沉积在细网格上的功率必须映射到具有 $N_c$ 个单元的粗 FVM 网格上，每个单元的宽度为 $\\Delta x_c = L/N_c$。问题指定 $N_f$ 是 $N_c$ 的整数倍，所以每个粗网格单元完美地包含整数个细网格单元，即 $N_f/N_c$ 个。\n\n该映射必须是保守的，即粗网格上的总功率必须等于细网格上的总功率。第 $i$ 个粗网格单元（对于 $i \\in \\{1, \\dots, N_c\\}$）的体积源项 $Q_i$ 通过将所有位于粗网格单元 $i$ 内的细网格单元的功率相加，然后除以粗网格单元的体积 $V_c = A \\Delta x_c$ 来计算，其中 $A=1\\,\\mathrm{m}^2$ 是横截面积。\n$$ Q_i = \\frac{\\sum_{j \\in \\text{bins in cell } i} P_{\\text{fine}, j}}{A \\Delta x_c} $$\n粗网格上计算的总功率 $P_{\\text{dep\\_coarse}}$ 则是 $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c$。源映射守恒误差 $e_{\\text{map}}$ 验证了这一步骤：\n$$ e_{\\text{map}} = \\frac{\\left| \\sum_{i=1}^{N_c} Q_i A \\Delta x_c - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\n其中 $\\epsilon = 10^{-16}\\,\\mathrm{W}$ 用于防止除以零。由于求和的性质，该误差预期会接近机器精度。\n\n### 3. 有限体积法（FVM）求解\n\nFVM 用于求解具有计算出的源项 $Q(x)$ 的一维稳态热传导方程：\n$$ \\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0 $$\n边界条件为狄利克雷边界条件 $T(0)=0\\,\\mathrm{K}$ 和 $T(L)=0\\,\\mathrm{K}$。将此方程在第 $i$ 个控制体（从 $x_{i-1/2}$ 到 $x_{i+1/2}$）上积分，得到通量平衡：\n$$ \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i+1/2}} - \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i-1/2}} + \\int_{x_{i-1/2}}^{x_{i+1/2}} Q(x) dx = 0 $$\n通过近似单元面上的通量和积分源项，我们得到了一个关于单元中心温度 $T_i$ 的线性方程组。\n对于内部单元 $i \\in \\{2, \\dots, N_c-1\\}$：\n$$ k\\frac{T_{i-1} - T_i}{\\Delta x_c} + k\\frac{T_{i+1} - T_i}{\\Delta x_c} + Q_i \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{i-1} + 2T_i - T_{i+1}) = Q_i \\Delta x_c $$\n对于第一个单元（$i=1$），边界条件为 $T(0)=0$：\n$$ k\\frac{T(0) - T_1}{\\Delta x_c/2} + k\\frac{T_2 - T_1}{\\Delta x_c} + Q_1 \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(3T_1 - T_2) = Q_1 \\Delta x_c $$\n对于最后一个单元（$i=N_c$），边界条件为 $T(L)=0$：\n$$ k\\frac{T_{N_c-1} - T_{N_c}}{\\Delta x_c} + k\\frac{T(L) - T_{N_c}}{\\Delta x_c/2} + Q_{N_c} \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{N_c-1} + 3T_{N_c}) = Q_{N_c} \\Delta x_c $$\n这构成一个对称、三对角的线性系统 $M\\mathbf{T}=\\mathbf{b}$，其中 $\\mathbf{T}$ 是单元中心温度的向量。矩阵 $M$ 由 $T_i$ 的系数定义，向量 $\\mathbf{b}$ 由源项定义。这个系统可以被高效地求解以得到 $\\mathbf{T}$。\n\n### 4. 基于通量的守恒验证\n\n全局能量守恒要求域内总沉积功率 $P_{\\text{dep}}$ 必须与通过边界传导出去的总功率相平衡。总外向功率通量 $P_{\\text{flux}}$ 是离开左边界和右边界的功率之和：$P_{\\text{flux}} = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$。\n\n外向热通量使用与 FVM 离散化一致的单边有限差分计算：\n$$ q_{\\text{out}}(0) = k \\left.\\frac{dT}{dx}\\right|_{x=0} \\approx k \\frac{T_1 - T(0)}{\\Delta x_c/2} = \\frac{2k T_1}{\\Delta x_c} $$\n$$ q_{\\text{out}}(L) = -k \\left.\\frac{dT}{dx}\\right|_{x=L} \\approx -k \\frac{T(L) - T_{N_c}}{\\Delta x_c/2} = \\frac{2k T_{N_c}}{\\Delta x_c} $$\n将所有单元的 FVM 方程求和表明，离散化系统是内在保守的：$\\sum_{i=1}^{N_c} Q_i A \\Delta x_c = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$。因此，$P_{\\text{dep\\_coarse}} = P_{\\text{flux}}$ 必须在线性求解器的数值精度范围内成立。通量平衡误差 $e_{\\text{flux}}$ 将计算出的总通量与 MC 模拟的原始沉积功率进行比较：\n$$ e_{\\text{flux}} = \\frac{\\left| P_{\\text{flux}} - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\n此误差应与 $e_{\\text{map}}$ 基本相同，反映了所选数值方法优异的守恒特性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 3.0, 1000.0, 10.0, 200000, 400, 50, 42),\n        (1.0, 0.2, 1000.0, 5.0, 100000, 300, 30, 123),\n        (1.0, 50.0, 500.0, 1.0, 300000, 500, 10, 777),\n        (1.0, 5.0, 800.0, 20.0, 500, 240, 60, 999),\n    ]\n\n    results = []\n    for params in test_cases:\n        e_map, e_flux = run_case(*params)\n        results.extend([e_map, e_flux])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(L, sigma, P0, k, Np, Nf, Nc, seed):\n    \"\"\"\n    Executes a single test case for the coupled MC-FVM simulation.\n    \n    Args:\n        L (float): Length of the slab [m].\n        sigma (float): Attenuation coefficient [m^-1].\n        P0 (float): Total injected beam power [W].\n        k (float): Thermal conductivity [W m^-1 K^-1].\n        Np (int): Number of Monte Carlo histories.\n        Nf (int): Number of fine-grid bins for MC tally.\n        Nc (int): Number of coarse-grid cells for FVM.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        tuple[float, float]: A tuple containing the source-mapping conservation \n                             error (e_map) and the flux balance error (e_flux).\n    \"\"\"\n    # --- Constants and Derived Parameters ---\n    A = 1.0  # Unit cross-sectional area [m^2]\n    epsilon = 1e-16  # Small number to prevent division by zero [W]\n    dx_f = L / Nf  # Fine-grid bin width [m]\n    dx_c = L / Nc  # Coarse-grid cell width [m]\n    power_per_history = P0 / Np  # Power weight per MC history [W]\n    T_bc = 0.0 # Boundary temperature [K]\n\n    # --- 1. Monte Carlo Power Deposition ---\n    rng = np.random.default_rng(seed)\n    # The scale parameter beta for numpy's exponential is 1/lambda, \n    # where lambda is the rate. Here, rate is sigma.\n    absorption_distances = rng.exponential(scale=1.0/sigma, size=Np)\n\n    fine_power_tally = np.zeros(Nf)\n    for x_abs in absorption_distances:\n        if x_abs  L:\n            # Determine which fine bin the deposition occurs in\n            bin_idx = int(x_abs / dx_f)\n            # Ensure index is within bounds (can happen with x_abs close to L)\n            if bin_idx  Nf:\n                fine_power_tally[bin_idx] += power_per_history\n\n    P_dep = np.sum(fine_power_tally)\n\n    # --- 2. Conservative Tally-to-Source Mapping ---\n    Q_coarse = np.zeros(Nc)\n    agg_factor = Nf // Nc  # Number of fine bins per coarse cell\n    \n    coarse_power_tally = np.zeros(Nc)\n    for i in range(Nc):\n        start_idx = i * agg_factor\n        end_idx = (i + 1) * agg_factor\n        power_in_cell = np.sum(fine_power_tally[start_idx:end_idx])\n        coarse_power_tally[i] = power_in_cell\n        cell_volume = A * dx_c\n        Q_coarse[i] = power_in_cell / cell_volume\n\n    # --- Error Calculation: Source Mapping ---\n    P_dep_coarse = np.sum(coarse_power_tally)\n    e_map = abs(P_dep_coarse - P_dep) / max(P_dep, epsilon)\n    \n    if P_dep  epsilon: # Handle case where no power is deposited\n        return e_map, 0.0\n\n    # --- 3. FVM Solution ---\n    # We solve M * T = b for temperatures T\n    # where M is the tridiagonal matrix and b is the source vector.\n    # The system is (k/dx_c) * M' * T = b_Q, where M' is dimensionless \n    # and b_Q_i = Q_i * dx_c\n    # This simplifies to M' * T = b', with b'_i = Q_i * (dx_c**2) / k\n    \n    # Construct the M' matrix\n    diag_main = np.full(Nc, 2.0)\n    diag_main[0] = 3.0\n    diag_main[-1] = 3.0\n    diag_off = np.full(Nc - 1, -1.0)\n    M_prime = np.diag(diag_main) + np.diag(diag_off, k=1) + np.diag(diag_off, k=-1)\n\n    # Construct the b' vector\n    b_prime = Q_coarse * (dx_c**2) / k\n    \n    # Solve the linear system for cell-centered temperatures\n    T_cell_centers = np.linalg.solve(M_prime, b_prime)\n\n    # --- 4. Flux-Based Conservation Verification ---\n    T1 = T_cell_centers[0]\n    T_Nc = T_cell_centers[-1]\n\n    # Outward flux per unit area [W/m^2]\n    q_out_0 = k * (T1 - T_bc) / (dx_c / 2.0)\n    q_out_L = k * (T_Nc - T_bc) / (dx_c / 2.0)\n    \n    # Total outward power [W]\n    P_flux = A * (q_out_0 + q_out_L)\n    \n    # --- Error Calculation: Flux Balance ---\n    e_flux = abs(P_flux - P_dep) / max(P_dep, epsilon)\n\n    return e_map, e_flux\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}