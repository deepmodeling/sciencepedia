{
    "hands_on_practices": [
        {
            "introduction": "To model fast wave current drive, we must first understand the properties of the wave itself. This practice guides you through the foundational derivation of the cold plasma dispersion relation, starting from Maxwell's equations. Mastering this derivation  is essential for identifying the different wave modes that can exist in a magnetized plasma and for selecting the fast wave branch that is central to this current drive scheme.",
            "id": "3978891",
            "problem": "Consider a homogeneous, magnetized, collisionless, cold plasma composed of electrons and a single ion species with charge number $Z=1$ (deuterium). The equilibrium magnetic field is $\\mathbf{B}_{0}$ aligned with the $\\hat{\\mathbf{z}}$-axis. A monochromatic plane wave with angular frequency $\\omega$ propagates in the $x$-$z$ plane, making an angle $\\theta$ with $\\mathbf{B}_{0}$. The system is intended to model the fast magnetosonic wave used in Radio Frequency (RF) fast wave current drive in computational fusion science and engineering.\n\nStarting from Maxwell’s equations in the frequency domain and the cold plasma constitutive relation $\\mathbf{J}(\\omega)=\\underline{\\underline{\\sigma}}(\\omega)\\cdot \\mathbf{E}(\\omega)$, where $\\underline{\\underline{\\sigma}}$ is the conductivity tensor, and equivalently $\\underline{\\underline{\\epsilon}}=\\underline{\\underline{I}}+\\frac{i}{\\omega\\epsilon_{0}}\\underline{\\underline{\\sigma}}$ is the dielectric tensor, derive the plane-wave dispersion relation in terms of the Stix parameters for oblique propagation. Adopt the Stix frame where $\\hat{\\mathbf{z}}\\parallel \\mathbf{B}_{0}$ and the cold plasma dielectric tensor is diagonal in the Stix representation except for the gyrotropic off-diagonal elements. Define the index of refraction $n$ by $n^{2}=\\frac{c^{2}k^{2}}{\\omega^{2}}$.\n\nYou must:\n- Derive, from the fundamental laws and definitions above, the oblique dispersion relation written as a quadratic polynomial in $n^{2}$ whose coefficients depend only on the Stix parameters and the propagation angle $\\theta$.\n- Express the Stix parameters $P$, $R$, $L$, $S$, and $D$ for a two-species cold plasma (electrons $e$ with cyclotron frequency $\\Omega_{e}0$ and ions $i$ with cyclotron frequency $\\Omega_{i}0$) in terms of the species plasma frequencies $\\omega_{p s}=\\sqrt{\\frac{n_{s} q_{s}^{2}}{\\epsilon_{0} m_{s}}}$ and cyclotron frequencies $\\Omega_{s}=\\frac{q_{s} B_{0}}{m_{s}}$ at the wave frequency $\\omega$. Do not assume any ordering such as $\\omega\\ll |\\Omega_{s}|$ or $\\omega\\gg \\omega_{p s}$ in the derivation; keep the expressions general.\n- Identify, on physical grounds, which root of the quadratic in $n^{2}$ corresponds to the fast magnetosonic branch relevant for fast wave current drive, and provide its closed-form expression in terms of $P$, $S$, $R$, $L$, $D$, and $\\theta$.\n- Your final reported answer must be the single closed-form analytic expression for $n_{\\text{fast}}^{2}(\\theta;P,S,R,L,D)$, expressed only in terms of the Stix parameters and $\\theta$. No numerical substitution is required.\n\nAll mathematical quantities, including numbers, symbols, functions, operators, and units appearing as part of mathematical expressions, must be written in LaTeX between dollar signs. The final answer must be a single closed-form expression. If any intermediate numerical evaluation is shown, round it only if explicitly instructed, but the final reported answer should remain an exact analytic expression without units inside the box.",
            "solution": "The problem statement is a standard derivation in plasma physics and is scientifically sound, well-posed, and objective. It is based on fundamental principles (Maxwell's equations) and established models (cold plasma dielectric tensor). All data and definitions required for the derivation are provided and are internally consistent. Therefore, the problem is valid.\n\nThe derivation proceeds in three stages as requested: deriving the general dispersion relation, defining the Stix parameters for the specified plasma, and identifying the fast wave branch.\n\n**1. Derivation of the Oblique Dispersion Relation**\n\nWe begin with Maxwell's curl equations in the frequency domain for a medium with no external sources:\n$$ \\nabla \\times \\mathbf{E} = i\\omega \\mathbf{B} $$\n$$ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J} - i\\frac{\\omega}{c^2}\\mathbf{E} $$\nWe consider a monochromatic plane wave of the form $\\mathbf{E}(\\mathbf{r}, t) = \\mathbf{E}_0 \\exp(i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t))$. For such waves, the spatial derivative operator $\\nabla$ can be replaced by $i\\mathbf{k}$.\nThe first equation gives $\\mathbf{B} = \\frac{\\mathbf{k} \\times \\mathbf{E}}{\\omega}$. Substituting this into the second equation yields:\n$$ i\\mathbf{k} \\times \\left(\\frac{\\mathbf{k} \\times \\mathbf{E}}{\\omega}\\right) = \\mu_0 \\mathbf{J} - i\\frac{\\omega}{c^2}\\mathbf{E} $$\nUsing the constitutive relation $\\mathbf{J} = \\underline{\\underline{\\sigma}}\\cdot \\mathbf{E}$ and the definition of the dielectric tensor $\\underline{\\underline{\\epsilon}}=\\underline{\\underline{I}}+\\frac{i}{\\omega\\epsilon_{0}}\\underline{\\underline{\\sigma}}$, we can express the current density as $\\mathbf{J} = -i\\omega\\epsilon_0 (\\underline{\\underline{\\epsilon}} - \\underline{\\underline{I}})\\cdot\\mathbf{E}$. Also noting that $\\mu_0\\epsilon_0 = 1/c^2$, the term $\\mu_0\\mathbf{J}$ becomes:\n$$ \\mu_0 \\mathbf{J} = -i\\frac{\\omega}{c^2}(\\underline{\\underline{\\epsilon}} - \\underline{\\underline{I}})\\cdot\\mathbf{E} $$\nSubstituting this back into the wave equation gives:\n$$ \\frac{i}{\\omega}\\mathbf{k} \\times (\\mathbf{k} \\times \\mathbf{E}) = -i\\frac{\\omega}{c^2}(\\underline{\\underline{\\epsilon}} - \\underline{\\underline{I}})\\cdot\\mathbf{E} - i\\frac{\\omega}{c^2}\\mathbf{E} $$\n$$ \\frac{i}{\\omega}\\mathbf{k} \\times (\\mathbf{k} \\times \\mathbf{E}) = -i\\frac{\\omega}{c^2}\\underline{\\underline{\\epsilon}}\\cdot\\mathbf{E} $$\nMultiplying by $\\frac{\\omega c^2}{i}$ and rearranging, we get the wave equation:\n$$ c^2 \\mathbf{k} \\times (\\mathbf{k} \\times \\mathbf{E}) + \\omega^2 \\underline{\\underline{\\epsilon}}\\cdot\\mathbf{E} = 0 $$\nLet's define the index of refraction vector as $\\mathbf{n} = \\frac{c}{\\omega}\\mathbf{k}$, with magnitude $n = |\\mathbf{n}| = \\frac{ck}{\\omega}$. The equation becomes:\n$$ \\mathbf{n} \\times (\\mathbf{n} \\times \\mathbf{E}) + \\underline{\\underline{\\epsilon}}\\cdot\\mathbf{E} = 0 $$\nThe propagation is in the $x$-$z$ plane, with the magnetic field $\\mathbf{B}_0$ along the $\\hat{\\mathbf{z}}$ axis. The angle of propagation is $\\theta$ with respect to $\\mathbf{B}_0$. Thus, the wave vector components are $k_x = k\\sin\\theta$ and $k_z = k\\cos\\theta$, so $\\mathbf{n} = (n\\sin\\theta, 0, n\\cos\\theta)$. The vector operator $\\mathbf{n} \\times (\\mathbf{n} \\times \\cdot)$ can be written in matrix form as:\n$$ \\mathbf{n}\\mathbf{n} - n^2\\underline{\\underline{I}} = \\begin{pmatrix} n_x^2-n^2  0  n_x n_z \\\\ 0  -n^2  0 \\\\ n_z n_x  0  n_z^2-n^2 \\end{pmatrix} = \\begin{pmatrix} -n^2\\cos^2\\theta  0  n^2\\sin\\theta\\cos\\theta \\\\ 0  -n^2  0 \\\\ n^2\\sin\\theta\\cos\\theta  0  -n^2\\sin^2\\theta \\end{pmatrix} $$\nIn the Stix frame, the cold plasma dielectric tensor is:\n$$ \\underline{\\underline{\\epsilon}} = \\begin{pmatrix} S  -iD  0 \\\\ iD  S  0 \\\\ 0  0  P \\end{pmatrix} $$\nThe full wave equation can be written as $(\\underline{\\underline{M}})\\cdot\\mathbf{E} = 0$, where the matrix $\\underline{\\underline{M}}$ is:\n$$ \\underline{\\underline{M}} = \\begin{pmatrix} S - n^2\\cos^2\\theta  -iD  n^2\\sin\\theta\\cos\\theta \\\\ iD  S - n^2  0 \\\\ n^2\\sin\\theta\\cos\\theta  0  P - n^2\\sin^2\\theta \\end{pmatrix} $$\nFor a non-trivial solution ($\\mathbf{E} \\neq 0$), the determinant of this matrix must be zero, $\\det(\\underline{\\underline{M}}) = 0$. Expanding the determinant gives:\n$$ (S - n^2\\cos^2\\theta) \\left[ (S-n^2)(P-n^2\\sin^2\\theta) \\right] - (-iD) \\left[ (iD)(P-n^2\\sin^2\\theta) \\right] + (n^2\\sin\\theta\\cos\\theta) \\left[ -(S-n^2) (n^2\\sin\\theta\\cos\\theta) \\right] = 0 $$\nThis can be rearranged to:\n$$ (P-n^2\\sin^2\\theta) \\left[ (S-n^2\\cos^2\\theta)(S-n^2) - D^2 \\right] - n^4\\sin^2\\theta\\cos^2\\theta(S-n^2) = 0 $$\nUsing the Stix parameters $R=S+D$ and $L=S-D$, we have $S^2-D^2=RL$. Let's expand the term in the square brackets:\n$$ S^2 - Sn^2 - Sn^2\\cos^2\\theta + n^4\\cos^2\\theta - D^2 = (S^2-D^2) - S n^2(1+\\cos^2\\theta) + n^4\\cos^2\\theta = RL - Sn^2(1+\\cos^2\\theta) + n^4\\cos^2\\theta $$\nSubstituting this back into the determinant equation:\n$$ (P-n^2\\sin^2\\theta) \\left( RL - Sn^2(1+\\cos^2\\theta) + n^4\\cos^2\\theta \\right) - (S-n^2)n^4\\sin^2\\theta\\cos^2\\theta = 0 $$\nExpanding and collecting terms by powers of $n^2$:\nThe $n^6$ terms are $-n^6\\sin^2\\theta\\cos^2\\theta + n^6\\sin^2\\theta\\cos^2\\theta = 0$.\nThe remaining terms form a quadratic equation in $n^2$, which we write as $An^4 - Bn^2 + C = 0$:\nThe coefficient of $n^4$ is $A$:\n$$ A = P\\cos^2\\theta + S\\sin^2\\theta(1+\\cos^2\\theta) - S\\sin^2\\theta\\cos^2\\theta = P\\cos^2\\theta + S\\sin^2\\theta $$\nThe coefficient of $n^2$ is $-B$:\n$$ -B = -PS(1+\\cos^2\\theta) - RL\\sin^2\\theta \\implies B = PS(1+\\cos^2\\theta) + RL\\sin^2\\theta $$\nThe coefficient of $n^0$ is $C$:\n$$ C = PRL $$\nThus, the dispersion relation is a quadratic in $n^2$:\n$$ (S\\sin^2\\theta+P\\cos^2\\theta)n^4 - (RL\\sin^2\\theta + PS(1+\\cos^2\\theta))n^2 + PRL = 0 $$\n\n**2. Stix Parameters for a Two-Species Plasma**\n\nFor a cold plasma consisting of electrons ($s=e$) and a single ion species ($s=i$) with charge $Z=1$, the elements of the dielectric tensor are sums over species:\n$$ S = 1 - \\sum_{s=e,i} \\frac{\\omega_{ps}^2}{\\omega^2 - \\Omega_s^2} = 1 - \\frac{\\omega_{pe}^2}{\\omega^2 - \\Omega_e^2} - \\frac{\\omega_{pi}^2}{\\omega^2 - \\Omega_i^2} $$\n$$ D = \\sum_{s=e,i} \\frac{\\Omega_s}{\\omega} \\frac{\\omega_{ps}^2}{\\omega^2 - \\Omega_s^2} = \\frac{\\Omega_e}{\\omega}\\frac{\\omega_{pe}^2}{\\omega^2 - \\Omega_e^2} + \\frac{\\Omega_i}{\\omega}\\frac{\\omega_{pi}^2}{\\omega^2 - \\Omega_i^2} $$\n$$ P = 1 - \\sum_{s=e,i} \\frac{\\omega_{ps}^2}{\\omega^2} = 1 - \\frac{\\omega_{pe}^2}{\\omega^2} - \\frac{\\omega_{pi}^2}{\\omega^2} $$\nThe parameters $R$ and $L$ are defined as $R=S+D$ and $L=S-D$:\n$$ R = S+D = 1 - \\sum_s \\frac{\\omega_{ps}^2}{\\omega(\\omega+\\Omega_s)} = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega+\\Omega_e)} - \\frac{\\omega_{pi}^2}{\\omega(\\omega+\\Omega_i)} $$\n$$ L = S-D = 1 - \\sum_s \\frac{\\omega_{ps}^2}{\\omega(\\omega-\\Omega_s)} = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega-\\Omega_e)} - \\frac{\\omega_{pi}^2}{\\omega(\\omega-\\Omega_i)} $$\nThese expressions are general for a two-species cold plasma. Note that $\\Omega_e  0$ and $\\Omega_i  0$.\n\n**3. Identification of the Fast Wave Branch**\n\nThe dispersion relation $An^4 - Bn^2 + C = 0$ has two solutions for $n^2$:\n$$ n^2 = \\frac{B \\pm \\sqrt{B^2 - 4AC}}{2A} $$\nThe terms \"fast\" and \"slow\" refer to the wave's phase velocity, $v_p=c/n$. The \"fast\" wave has the smaller refractive index $n$, and thus the larger phase velocity. The \"slow\" wave has the larger refractive index $n$ and smaller phase velocity. In the typical frequency range for fast wave current drive ($\\Omega_i \\lesssim \\omega \\ll |\\Omega_e|, \\omega_{pe}$), the plasma parameters $A$, $B$, and $C$ are positive. Therefore, the smaller root for $n^2$ is obtained by taking the minus sign in the numerator. This corresponds to the fast magnetosonic wave. The root with the plus sign corresponds to the slow wave (shear Alfvén or ion cyclotron wave, depending on the frequency range).\n\nThe expression for the squared refractive index of the fast wave is therefore:\n$$ n_{\\text{fast}}^2 = \\frac{B - \\sqrt{B^2 - 4AC}}{2A} $$\nSubstituting the expressions for $A$, $B$, and $C$:\n$$ n_{\\text{fast}}^2 = \\frac{ (RL\\sin^2\\theta + PS(1+\\cos^2\\theta)) - \\sqrt{(RL\\sin^2\\theta + PS(1+\\cos^2\\theta))^2 - 4(S\\sin^2\\theta+P\\cos^2\\theta)(PRL)} } {2(S\\sin^2\\theta+P\\cos^2\\theta)} $$\nThis expression is in terms of the Stix parameters $P, S, R, L$ and the propagation angle $\\theta$, as required. The parameter $D$ is implicitly included via $R = S+D$ and $L = S-D$.",
            "answer": "$$\\boxed{\\frac{ \\left[RL\\sin^2\\theta + PS\\left(1+\\cos^2\\theta\\right)\\right] - \\sqrt{\\left[RL\\sin^2\\theta + PS\\left(1+\\cos^2\\theta\\right)\\right]^2 - 4\\left(S\\sin^2\\theta+P\\cos^2\\theta\\right)\\left(PRL\\right)} } {2\\left(S\\sin^2\\theta+P\\cos^2\\theta\\right)}}$$"
        },
        {
            "introduction": "The efficiency of wave-driven currents is not just a property of the wave, but also of the plasma environment, particularly the magnetic geometry of a tokamak. This exercise explores how the variation of the magnetic field along a field line divides the electron population into two distinct classes: passing and trapped particles. Understanding the physics of particle trapping  is crucial, as trapped electrons are generally ineffective at carrying toroidal current and their interaction with the wave can alter the absorption profile.",
            "id": "3978878",
            "problem": "Consider a large-aspect-ratio tokamak with circular flux surfaces, major radius $R_0$, minor radius $r$, and inverse aspect ratio $\\epsilon = r/R_0$, with $0  \\epsilon \\ll 1$. The magnetic field magnitude along a field line as a function of poloidal angle $\\theta$ is modeled by $B(\\theta) = B_0 \\frac{R_0}{R(\\theta)}$ with $R(\\theta) = R_0 + r \\cos\\theta$, so that $B(\\theta) = \\frac{B_0}{1 + \\epsilon \\cos\\theta}$. In computational models of Radio-Frequency (RF) fast wave current drive, bounce averaging is used to separate contributions from trapped and passing electrons. Electrons are assumed to have fixed speed $v$ and an isotropic velocity-space pitch angle distribution evaluated at the outboard midplane ($\\theta = 0$), where $B$ attains its minimum.\n\nStarting from conservation of particle energy and magnetic moment, derive the criterion that separates trapped from passing electrons in terms of the pitch angle $\\alpha$ (defined at the outboard midplane) and the minimum and maximum magnetic field strengths along the orbit. Then, using this criterion and the fact that an isotropic distribution implies a uniform distribution of $\\xi = \\cos\\alpha$ over the interval $[-1,1]$ at the outboard midplane, compute the total fraction of electrons that are trapped as a function of $\\epsilon$. Express your final result as a single closed-form analytic expression in terms of $\\epsilon$ only. No numerical approximation or rounding is required. The fraction must be reported as a dimensionless number (i.e., as a pure decimal or a symbolic expression without a percentage sign).",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- Tokamak geometry: Large-aspect-ratio, circular flux surfaces.\n- Major radius: $R_0$.\n- Minor radius: $r$.\n- Inverse aspect ratio: $\\epsilon = r/R_0$, with $0  \\epsilon \\ll 1$.\n- Magnetic field model: $B(\\theta) = B_0 \\frac{R_0}{R(\\theta)}$ with $R(\\theta) = R_0 + r \\cos\\theta$. This simplifies to $B(\\theta) = \\frac{B_0}{1 + \\epsilon \\cos\\theta}$.\n- Particle properties: Electrons with fixed speed $v$.\n- Distribution function: Isotropic velocity-space pitch angle distribution at the outboard midplane ($\\theta = 0$).\n- Definition: Pitch angle $\\alpha$ is defined at the outboard midplane.\n- Property of distribution: An isotropic distribution implies a uniform distribution of $\\xi = \\cos\\alpha$ over the interval $[-1,1]$ at the outboard midplane.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on fundamental principles of plasma physics, namely the motion of charged particles in magnetic fields. The conservation of energy and magnetic moment are cornerstone concepts. The model for the magnetic field in a tokamak, $B \\propto 1/R$, is a standard and valid approximation for large-aspect-ratio circular plasmas. The concept of trapped and passing particles is central to neoclassical transport and wave-particle interactions in tokamaks. The problem is scientifically sound.\n- **Well-Posed**: The problem provides all necessary information and definitions to derive a unique analytical solution. The goal is clearly stated.\n- **Objective**: The problem is stated in a clear, precise, and unbiased manner, using standard terminology from plasma physics.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe motion of an electron in the tokamak's magnetic field is governed by the conservation of two quantities: its kinetic energy, $E$, and its magnetic moment, $\\mu$.\n\nThe kinetic energy is given by $E = \\frac{1}{2} m v^2$, where $m$ is the electron mass and $v$ is its speed. The problem states that the speed $v$ is fixed, so energy is trivially conserved. The velocity vector $\\vec{v}$ can be decomposed into components parallel ($v_{\\parallel}$) and perpendicular ($v_{\\perp}$) to the magnetic field line, such that $v^2 = v_{\\parallel}^2 + v_{\\perp}^2$.\n\nThe magnetic moment is an adiabatic invariant, given by $\\mu = \\frac{m v_{\\perp}^2}{2B}$. Its conservation implies that as an electron moves along a field line to a region of different magnetic field strength $B$, its perpendicular velocity $v_{\\perp}$ must change according to $v_{\\perp}^2 = \\frac{2\\mu B}{m}$.\n\nWe can express the parallel velocity using these conserved quantities:\n$$v_{\\parallel}^2 = v^2 - v_{\\perp}^2 = v^2 - \\frac{2\\mu B}{m}$$\nThe magnetic moment $\\mu$ is constant for a given particle's orbit. We can evaluate it at a reference point. The problem specifies that the pitch angle distribution is known at the outboard midplane, where the poloidal angle $\\theta=0$. At this location, the major radius is $R(\\theta=0) = R_0 + r = R_0(1+\\epsilon)$, and the magnetic field strength is at its minimum:\n$$B_{\\min} = B(\\theta=0) = \\frac{B_0}{1 + \\epsilon \\cos(0)} = \\frac{B_0}{1+\\epsilon}$$\nLet the velocity components at this location be $v_{\\parallel,0}$ and $v_{\\perp,0}$. The pitch angle $\\alpha$ is defined here, so $v_{\\perp,0} = v \\sin\\alpha$ and $v_{\\parallel,0} = v \\cos\\alpha$. The magnetic moment can be expressed in terms of these initial conditions:\n$$\\mu = \\frac{m v_{\\perp,0}^2}{2B_{\\min}} = \\frac{m (v \\sin\\alpha)^2}{2B_{\\min}}$$\nSubstituting this expression for $\\mu$ back into the equation for $v_{\\parallel}^2$ at an arbitrary point with field strength $B(\\theta)$:\n$$v_{\\parallel}^2(\\theta) = v^2 - \\frac{2}{m} \\left( \\frac{m (v \\sin\\alpha)^2}{2B_{\\min}} \\right) B(\\theta) = v^2 - v^2 \\sin^2\\alpha \\frac{B(\\theta)}{B_{\\min}} = v^2 \\left( 1 - \\sin^2\\alpha \\frac{B(\\theta)}{B_{\\min}} \\right)$$\nA particle is \"trapped\" if its parallel motion is reversed at some point. This occurs at a \"bounce point\", where $v_{\\parallel}=0$. Setting $v_{\\parallel}^2(\\theta)=0$, we find the condition on the magnetic field at the bounce point, $B_{\\text{bounce}}$:\n$$1 - \\sin^2\\alpha \\frac{B_{\\text{bounce}}}{B_{\\min}} = 0 \\implies \\sin^2\\alpha = \\frac{B_{\\min}}{B_{\\text{bounce}}}$$\nFor a particle to be trapped, a bounce point must exist. This means there must be a location on the field line where the magnetic field strength $B$ satisfies this condition. The magnetic field strength varies from $B_{\\min}$ at $\\theta=0$ to a maximum value, $B_{\\max}$, at the inboard midplane ($\\theta=\\pi$):\n$$B_{\\max} = B(\\theta=\\pi) = \\frac{B_0}{1 + \\epsilon \\cos(\\pi)} = \\frac{B_0}{1-\\epsilon}$$\nA particle will be trapped if its bounce point occurs for some $B_{\\text{bounce}} \\le B_{\\max}$. This leads to the criterion for trapping:\n$$\\sin^2\\alpha \\ge \\frac{B_{\\min}}{B_{\\max}}$$\nParticles with $\\sin^2\\alpha  B_{\\min}/B_{\\max}$ have enough parallel velocity to overcome the magnetic mirror and are called \"passing\" particles.\n\nNow, we compute the ratio $B_{\\min}/B_{\\max}$:\n$$\\frac{B_{\\min}}{B_{\\max}} = \\frac{B_0/(1+\\epsilon)}{B_0/(1-\\epsilon)} = \\frac{1-\\epsilon}{1+\\epsilon}$$\nThe trapping condition is therefore:\n$$\\sin^2\\alpha \\ge \\frac{1-\\epsilon}{1+\\epsilon}$$\nThe problem states that the variable $\\xi = \\cos\\alpha$ is uniformly distributed over the interval $[-1,1]$ at the outboard midplane. We need to express the trapping condition in terms of $\\xi$. Using the identity $\\sin^2\\alpha = 1 - \\cos^2\\alpha = 1-\\xi^2$:\n$$1 - \\xi^2 \\ge \\frac{1-\\epsilon}{1+\\epsilon}$$\nRearranging the inequality to solve for $\\xi^2$:\n$$\\xi^2 \\le 1 - \\frac{1-\\epsilon}{1+\\epsilon} = \\frac{(1+\\epsilon) - (1-\\epsilon)}{1+\\epsilon} = \\frac{2\\epsilon}{1+\\epsilon}$$\nThis means that particles are trapped if their pitch-angle cosine $\\xi$ at the outboard midplane falls within the range:\n$$-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} \\le \\xi \\le \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}$$\nThe total fraction of trapped electrons, $f_{\\text{trapped}}$, is the probability that a randomly chosen electron has a value of $\\xi$ in this range. Since the distribution of $\\xi$ is uniform on $[-1,1]$, its probability density function is $p(\\xi) = \\frac{1}{1 - (-1)} = \\frac{1}{2}$ for $\\xi \\in [-1,1]$.\n\nThe fraction is calculated by integrating the probability density function over the trapping region:\n$$f_{\\text{trapped}} = \\int_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} p(\\xi) d\\xi = \\int_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} \\frac{1}{2} d\\xi$$\n$$f_{\\text{trapped}} = \\frac{1}{2} \\left[ \\xi \\right]_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} = \\frac{1}{2} \\left( \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} - \\left(-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}\\right) \\right)$$\n$$f_{\\text{trapped}} = \\frac{1}{2} \\left( 2\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} \\right) = \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}$$\nThis is the closed-form analytic expression for the total fraction of trapped electrons as a function of the inverse aspect ratio $\\epsilon$.",
            "answer": "$$\\boxed{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}$$"
        },
        {
            "introduction": "Ultimately, modeling fast wave current drive requires quantifying its efficiency. The adjoint method offers a powerful and computationally efficient framework for this task, directly linking the wave's momentum input to the resulting plasma current. In this computational exercise , you will implement a numerical solver for the adjoint kinetic equation, providing a direct look at how current drive efficiency is determined by the interplay between wave properties, particle velocity, and collisions.",
            "id": "3978893",
            "problem": "You are modeling fast wave current drive in a homogeneous magnetized plasma using the adjoint method. The goal is to compute a dimensionless local efficiency defined completely within a one-dimensional velocity-space model that obeys scientific realism while remaining mathematically well-posed and computationally tractable. Consider the steady-state, linearized electron kinetics in the parallel velocity coordinate, defined by $u$ and normalized as $x = u / v_{\\mathrm{th}}$, where $v_{\\mathrm{th}}$ is the electron thermal speed. Let the adjoint function $h(x)$ be the solution of a one-dimensional self-adjoint second-order ordinary differential equation derived from the adjoint formulation of the linearized Fokker–Planck equation. The governing equation for $h(x)$ is\n$$\n- \\frac{d}{dx} \\left( D(x) \\frac{d h}{dx} \\right) + \\nu(x) h(x) = S_J(x),\n$$\nwhere $D(x)$ and $\\nu(x)$ are strictly positive functions modeling effective velocity-space diffusion and effective collisional relaxation, respectively, and $S_J(x)$ is the source associated with the current moment. Assume the following physically plausible and simple forms:\n$$\nD(x) = \\frac{D_0}{1 + x^3}, \\quad \\nu(x) = \\frac{\\nu_0}{1 + x^3}, \\quad S_J(x) = x,\n$$\nwith $D_0  0$ and $\\nu_0  0$. The boundary conditions are Dirichlet: $h(0) = 0$ and $h(x_{\\max}) = 0$, with $x_{\\max}  0$ sufficiently large to represent the truncation of velocity space. The Radio Frequency (RF) momentum deposition profile, representing the quasilinear fast wave interaction localized near a resonance $x_{\\mathrm{res}}$, is modeled as\n$$\nS_{\\mathrm{RF}}(x) = A \\exp\\left( - \\frac{(x - x_{\\mathrm{res}})^2}{2 \\sigma^2} \\right),\n$$\nwith amplitude $A  0$, resonance location $x_{\\mathrm{res}}  0$, and width $\\sigma  0$. The adjoint reciprocity then gives the dimensionless driven current functional\n$$\nJ = \\int_{0}^{x_{\\max}} h(x)\\, S_{\\mathrm{RF}}(x)\\, dx,\n$$\nand the dimensionless absorbed power (in this simplified model) is\n$$\nP_{\\mathrm{abs}} = \\int_{0}^{x_{\\max}} x\\, S_{\\mathrm{RF}}(x)\\, dx.\n$$\nDefine the dimensionless local efficiency as\n$$\n\\eta = \\frac{J}{P_{\\mathrm{abs}}},\n$$\nwhich is a pure number without physical units in this normalized model. Your task is to compute $\\eta$ for several parameter sets by numerically solving for $h(x)$ on a uniform grid using a finite-volume or conservative finite-difference discretization of the differential operator. Use a grid of $N$ points on $[0, x_{\\max}]$, with $N \\ge 3$ an integer, uniform spacing $\\Delta x$, and mid-point diffusion $D_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(D(x_i) + D(x_{i+1})\\right)$. The discrete interior equation at node $i$ for $i = 1, 2, \\ldots, N-2$ must take the conservative form\n$$\n- \\frac{1}{\\Delta x} \\left[ D_{i+\\frac{1}{2}} \\frac{h_{i+1} - h_i}{\\Delta x} - D_{i-\\frac{1}{2}} \\frac{h_i - h_{i-1}}{\\Delta x} \\right] + \\nu(x_i) h_i = S_J(x_i),\n$$\nwith $h_0 = 0$ and $h_{N-1} = 0$. Compute the discrete approximation of the integrals using the midpoint or trapezoidal rule consistent with the node-centered representation.\n\nImplement a complete, runnable program that:\n- Constructs the grid and coefficients.\n- Solves the resulting tri-diagonal linear system for $h(x)$.\n- Evaluates $J$ and $P_{\\mathrm{abs}}$ and returns $\\eta$ for each test case.\n\nUse the following test suite, which includes a general case, strong collisionality, weak collisionality, a narrow RF spectrum, and a near-thermal resonance. In all cases, set $N = 400$ grid points.\n\n- Case $1$ (general): $D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$.\n- Case $2$ (strong collisionality): $D_0 = 2.0$, $\\nu_0 = 5.0$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$.\n- Case $3$ (weak collisionality): $D_0 = 0.2$, $\\nu_0 = 0.05$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$.\n- Case $4$ (narrow RF spectrum at higher speed): $D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 4.0$, $\\sigma = 0.05$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$.\n- Case $5$ (near-thermal resonance): $D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 0.5$, $\\sigma = 0.2$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$.\n\nFinal output format specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the five cases listed above, for example, $\\left[ \\eta_1, \\eta_2, \\eta_3, \\eta_4, \\eta_5 \\right]$. Each entry must be a floating-point number with no unit.",
            "solution": "The user-provided problem has been validated and is deemed a valid, well-posed problem in computational science. It is scientifically grounded in the physics of plasma kinetic theory, specifically the adjoint Fokker-Planck modeling of radio-frequency current drive. The problem is mathematically self-contained, with all necessary equations, parameters, and boundary conditions provided. The numerical method is specified, leading to a unique and stable solution. There are no contradictions, ambiguities, or factual inaccuracies. We may therefore proceed with the solution.\n\nThe problem requires the computation of a dimensionless current drive efficiency, $\\eta$, defined as the ratio of the driven current, $J$, to the absorbed power, $P_{\\mathrm{abs}}$. These quantities are determined by solving a one-dimensional, second-order ordinary differential equation (ODE) for an adjoint function, $h(x)$, and then evaluating two integrals involving $h(x)$ and a given radio-frequency (RF) source term, $S_{\\mathrm{RF}}(x)$.\n\nThe governing ODE for the adjoint function $h(x)$ on the normalized velocity domain $x \\in [0, x_{\\max}]$ is:\n$$\n- \\frac{d}{dx} \\left( D(x) \\frac{d h}{dx} \\right) + \\nu(x) h(x) = S_J(x)\n$$\nwith homogeneous Dirichlet boundary conditions $h(0) = 0$ and $h(x_{\\max}) = 0$. The coefficients are given by $D(x) = D_0/(1 + x^3)$, $\\nu(x) = \\nu_0/(1 + x^3)$, and the source term is $S_J(x) = x$.\n\nWe will solve this problem numerically following a four-step process:\n1.  Discretize the domain and the ODE using a conservative finite-difference scheme.\n2.  Assemble the resulting tri-diagonal linear system of equations.\n3.  Solve this linear system to find the values of the adjoint function $h(x)$ on the grid.\n4.  Numerically integrate to compute $J$ and $P_{\\mathrm{abs}}$, and their ratio $\\eta$.\n\n**1. Discretization of the Domain and Equation**\n\nWe discretize the domain $[0, x_{\\max}]$ into a uniform grid of $N$ points, $x_i = i \\cdot \\Delta x$ for $i = 0, 1, \\dots, N-1$, where the grid spacing is $\\Delta x = x_{\\max} / (N-1)$. The value of the function $h$ at each grid point is denoted $h_i = h(x_i)$. The boundary conditions impose $h_0 = 0$ and $h_{N-1} = 0$, leaving $N-2$ unknown interior values, $h_1, h_2, \\dots, h_{N-2}$.\n\nThe problem specifies a conservative finite-difference (or finite-volume) discretization for the self-adjoint differential operator. At each interior grid point $x_i$ for $i = 1, 2, \\dots, N-2$, the ODE is approximated as:\n$$\n- \\frac{1}{\\Delta x} \\left[ D_{i+\\frac{1}{2}} \\frac{h_{i+1} - h_i}{\\Delta x} - D_{i-\\frac{1}{2}} \\frac{h_i - h_{i-1}}{\\Delta x} \\right] + \\nu(x_i) h_i = S_J(x_i)\n$$\nHere, $D_{i \\pm \\frac{1}{2}}$ represents the diffusion coefficient evaluated at the midpoint between grid nodes, given by $D_{i+\\frac{1}{2}} = \\frac{1}{2}(D(x_i) + D(x_{i+1}))$.\n\n**2. Assembling the Linear System**\n\nRearranging the discretized equation reveals a linear system of the form $\\mathbf{A} \\mathbf{h} = \\mathbf{b}$, where $\\mathbf{h} = [h_1, h_2, \\dots, h_{N-2}]^T$ is the vector of unknown function values. For each row $i$ (corresponding to grid point $x_i$, $i=1, \\dots, N-2$), the equation can be written as:\n$$\n\\left(-\\frac{D_{i-\\frac{1}{2}}}{\\Delta x^2}\\right) h_{i-1} + \\left(\\frac{D_{i+\\frac{1}{2}} + D_{i-\\frac{1}{2}}}{\\Delta x^2} + \\nu_i\\right) h_i + \\left(-\\frac{D_{i+\\frac{1}{2}}}{\\Delta x^2}\\right) h_{i+1} = S_J(x_i)\n$$\nThe boundary conditions $h_0=0$ and $h_{N-1}=0$ are incorporated by noting that for the first equation ($i=1$), the term involving $h_0$ vanishes, and for the last equation ($i=N-2$), the term involving $h_{N-1}$ vanishes.\n\nThis structure defines a $(N-2) \\times (N-2)$ matrix $\\mathbf{A}$ which is:\n- **Tri-diagonal**: Each equation only links $h_i$ to its immediate neighbors $h_{i-1}$ and $h_{i+1}$.\n- **Symmetric**: The coefficient of $h_{i+1}$ in row $i$ is $-D_{i+1/2}/\\Delta x^2$, and the coefficient of $h_i$ in row $i+1$ is $-D_{(i+1)-1/2}/\\Delta x^2 = -D_{i+1/2}/\\Delta x^2$. The off-diagonal entries are symmetric, $A_{i,j} = A_{j,i}$.\n- **Strictly Diagonally Dominant**: Since $D(x)  0$ and $\\nu(x)  0$, the absolute value of the main diagonal element is strictly greater than the sum of the absolute values of the off-diagonal elements in that row. This guarantees that the matrix $\\mathbf{A}$ is non-singular and the system has a unique, stable solution.\n\nThe three non-zero diagonals of the matrix $\\mathbf{A}$ (for matrix indices $k=0, \\dots, N-3$) are:\n- Main diagonal: $A_{k,k} = \\frac{D_{k+3/2} + D_{k+1/2}}{\\Delta x^2} + \\nu_{k+1}$\n- Upper diagonal: $A_{k, k+1} = -D_{k+3/2}/\\Delta x^2$\n- Lower diagonal: $A_{k+1, k} = -D_{k+3/2}/\\Delta x^2$\n\nThe right-hand side vector is $\\mathbf{b} = [S_J(x_1), S_J(x_2), \\dots, S_J(x_{N-2})]^T$.\n\n**3. Solving the Linear System**\n\nGiven the tri-diagonal and symmetric positive-definite nature of $\\mathbf{A}$, the system $\\mathbf{A} \\mathbf{h} = \\mathbf{b}$ can be solved very efficiently. We use the `scipy.linalg.solve_banded` function, which is optimized for banded matrices. This function requires the diagonals to be stored in a specific format. After solving for the interior points $\\mathbf{h} = [h_1, \\dots, h_{N-2}]$, we reconstruct the full solution vector by prepending $h_0=0$ and appending $h_{N-1}=0$.\n\n**4. Calculation of Efficiency**\n\nWith the discrete solution for $h_i$ obtained, we compute the total dimensionless current $J$ and absorbed power $P_{\\mathrm{abs}}$. The integrals are approximated numerically using the trapezoidal rule, which is a suitable choice for data known at discrete grid points.\nThe RF source term is first evaluated on the grid:\n$$\nS_{\\mathrm{RF}}(x_i) = A \\exp\\left( - \\frac{(x_i - x_{\\mathrm{res}})^2}{2 \\sigma^2} \\right)\n$$\nThe integrals are then computed as:\n$$\nJ = \\int_{0}^{x_{\\max}} h(x) S_{\\mathrm{RF}}(x) dx \\approx \\sum_{i=0}^{N-2} \\frac{h_i S_{\\mathrm{RF}}(x_i) + h_{i+1} S_{\\mathrm{RF}}(x_{i+1})}{2} \\Delta x\n$$\n$$\nP_{\\mathrm{abs}} = \\int_{0}^{x_{\\max}} x S_{\\mathrm{RF}}(x) dx \\approx \\sum_{i=0}^{N-2} \\frac{x_i S_{\\mathrm{RF}}(x_i) + x_{i+1} S_{\\mathrm{RF}}(x_{i+1})}{2} \\Delta x\n$$\nThese summations are implemented using `numpy.trapz`. Finally, the dimensionless efficiency is calculated as the ratio $\\eta = J / P_{\\mathrm{abs}}$. This entire procedure is repeated for each of the five test cases provided.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It iterates through each case, computes the efficiency, and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general): D0=1.0, nu0=0.3, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 2 (strong collisionality): D0=2.0, nu0=5.0, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (2.0, 5.0, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 3 (weak collisionality): D0=0.2, nu0=0.05, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (0.2, 0.05, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 4 (narrow RF spectrum at higher speed): D0=1.0, nu0=0.3, x_res=4.0, sigma=0.05, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 4.0, 0.05, 1.0, 6.0, 400),\n        # Case 5 (near-thermal resonance): D0=1.0, nu0=0.3, x_res=0.5, sigma=0.2, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 0.5, 0.2, 1.0, 6.0, 400),\n    ]\n\n    results = []\n    for case in test_cases:\n        D0, nu0, x_res, sigma, A, x_max, N = case\n        eta = compute_efficiency(D0, nu0, x_res, sigma, A, x_max, N)\n        results.append(f\"{eta:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_efficiency(D0, nu0, x_res, sigma, A, x_max, N):\n    \"\"\"\n    Computes the dimensionless efficiency for a single set of parameters.\n\n    Args:\n        D0 (float): Amplitude of the diffusion coefficient.\n        nu0 (float): Amplitude of the collision frequency.\n        x_res (float): Resonance location for the RF source.\n        sigma (float): Width of the RF source.\n        A (float): Amplitude of the RF source.\n        x_max (float): Maximum value of the normalized velocity space.\n        N (int): Number of grid points.\n\n    Returns:\n        float: The computed dimensionless efficiency eta.\n    \"\"\"\n    \n    # 1. Grid setup\n    x = np.linspace(0, x_max, N)\n    dx = x[1] - x[0]\n\n    # 2. Define coefficient functions\n    def D_func(x_val):\n        return D0 / (1.0 + x_val**3)\n\n    def nu_func(x_val):\n        return nu0 / (1.0 + x_val**3)\n\n    def S_J_func(x_val):\n        return x_val\n\n    # 3. Evaluate coefficients on the grid\n    D_vals = D_func(x)\n    nu_vals = nu_func(x)\n    S_J_vals = S_J_func(x)\n\n    # 4. Assemble the tri-diagonal system for h_1, ..., h_{N-2}\n    # Number of interior points (unknowns)\n    M = N - 2\n    if M = 0:\n        raise ValueError(\"N must be = 3 to have interior points.\")\n\n    # Mid-point diffusion coefficients D_{i+1/2}\n    D_mid = 0.5 * (D_vals[:-1] + D_vals[1:])\n    \n    # Diagonals of the matrix A for Ax=b system\n    # Main diagonal for matrix rows k=0..M-1, corresponding to grid points i=1..N-2\n    main_diag = (D_mid[1:N-1] + D_mid[0:N-2]) / dx**2 + nu_vals[1:N-1]\n    \n    # Off-diagonals are symmetric.\n    # Coeff of h_{i+1} in eq for h_i is -D_{i+1/2}/dx**2.\n    # Coeff of h_{i-1} in eq for h_i is -D_{i-1/2}/dx**2.\n    # A is symmetric because the operator is self-adjoint.\n    # Upper/lower diagonal elements A_{k,k+1} and A_{k+1,k} are both -D_{k+3/2}/dx**2.\n    off_diag = -D_mid[1:N-2] / dx**2\n    \n    # Assemble banded matrix for scipy.linalg.solve_banded\n    # (l, u) = (1, 1) for tri-diagonal\n    ab = np.zeros((3, M))\n    ab[0, 1:] = off_diag  # Super-diagonal\n    ab[1, :] = main_diag    # Main diagonal\n    ab[2, :-1] = off_diag # Sub-diagonal\n\n    # Right-hand side vector b\n    b = S_J_vals[1:N-1]\n\n    # 5. Solve the linear system for h on interior points\n    h_interior = solve_banded((1, 1), ab, b)\n    \n    # Reconstruct full solution h(x) with boundary conditions h(0)=h(x_max)=0\n    h = np.zeros(N)\n    h[1:N-1] = h_interior\n\n    # 6. Compute J and P_abs\n    def S_RF_func(x_val):\n        return A * np.exp(-(x_val - x_res)**2 / (2 * sigma**2))\n\n    S_RF_vals = S_RF_func(x)\n    \n    # Integrands\n    integrand_J = h * S_RF_vals\n    integrand_P = x * S_RF_vals\n\n    # Integrate using the trapezoidal rule\n    J = np.trapz(integrand_J, x=x)\n    P_abs = np.trapz(integrand_P, x=x)\n\n    # 7. Compute efficiency\n    if P_abs == 0:\n        return np.nan # Should not happen with given parameters\n    \n    eta = J / P_abs\n    return eta\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}