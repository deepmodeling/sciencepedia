{
    "hands_on_practices": [
        {
            "introduction": "有效的快波电流驱动始于将具有正确频谱的波耦合进等离子体。这个练习将探讨天线物理结构（此处用高斯分布建模）与成功进入等离子体的功率份额之间的关系。这个计算基于波的可及性这一基本条件，是任何射频模拟中的基础步骤，它帮助我们理解天线设计如何决定了哪些波分量能够用于驱动电流。",
            "id": "3978879",
            "problem": "考虑一个用于在射频（RF）电流驱动中激发快磁声波（快波）的直磁力线平板模型。一个半无限的冷磁化等离子体占据半空间 $x>0$，其中存在均匀磁场 $\\boldsymbol{B}_0 = B_0 \\hat{\\boldsymbol{z}}$。位于 $x=0$ 处的一个外部驱动的射频天线，沿着环向（平行）坐标 $z$ 产生一个切向平行电场包络，由 $E_{\\parallel}(z,t) = \\Re\\{E_0 \\exp(-z^{2}/(2\\sigma^{2})) \\exp(-i \\omega t)\\}$ 给出，其中 $E_0$ 是一个恒定振幅，$\\sigma$ 是孔径场的高斯标准差，$\\omega = 2 \\pi f$ 是角频率。工作频率为 $f = 55\\,\\mathrm{MHz}$。\n\n在固定 $\\omega$ 的冷等离子体快波近似下，与给定平行波数 $k_{\\parallel}$ 相关联的垂直波数 $k_{\\perp}$ 满足可及性条件\n$$\nk_{\\perp}^{2} = k_{0}^{2} n_{f}^{2} - k_{\\parallel}^{2} \\, ,\n$$\n其中 $k_{0} = \\omega / c$，$c$ 为光速，$n_{f}$ 是一个正常数模指数，它包含了在选定的 $\\omega$ 和 $\\boldsymbol{B}_0$ 下的冷等离子体介电响应。在此模型中，波要在等离子体中传播需要满足 $k_{\\perp}^{2} > 0$，即 $|k_{\\parallel}|  k_{c}$，其中 $k_{c} = k_{0} n_{f}$。假设一个简化的耦合模型，其中所有具有实数 $k_{\\perp}$ 的发射频谱分量都完全耦合（无反射），而所有具有虚数 $k_{\\perp}$ 的分量都不耦合（全反射）。\n\n利用场的谱表示，以及由给定 $k_{\\parallel}$ 分量携带的谱功率密度与孔径场沿 $z$ 的空间傅里叶变换的模平方成正比这一事实，从第一性原理推导出发射射频功率的耦合分数 $F$ 的解析表达式，\n$$\nF = \\frac{\\text{power carried by modes with } |k_{\\parallel}|  k_{c}}{\\text{total launched power}} \\, ,\n$$\n用 $\\sigma$ 和 $k_{c}$ 表示。然后，对于特定情况 $n_{f} = 8.0$，$c = 2.99792458 \\times 10^{8}\\,\\mathrm{m/s}$，以及天线设计选择 $\\sigma = 1/k_{c}$，对 $F$ 进行数值计算。将最终答案表示为四舍五入到四位有效数字的小数。最终答案是无量纲的；不要在最终的方框值中包含任何单位。",
            "solution": "目标是在给定冷等离子体中快磁声波的可及性条件 $|k_{\\parallel}|  k_{c}$ 的情况下，计算耦合到等离子体中的发射射频功率的分数。\n\n从孔径场的谱表示开始。平行电场包络 $E_{\\parallel}(z)$ 沿 $z$ 的空间傅里叶变换 $\\tilde{E}_{\\parallel}(k_{\\parallel})$ 定义为\n$$\n\\tilde{E}_{\\parallel}(k_{\\parallel}) = \\int_{-\\infty}^{\\infty} E_{\\parallel}(z) \\exp(-i k_{\\parallel} z) \\, dz \\, .\n$$\n对于给定的高斯包络 $E_{\\parallel}(z) = E_0 \\exp(-z^{2}/(2\\sigma^{2}))$，其傅里叶变换可利用高斯函数的成熟性质计算得出：\n$$\n\\tilde{E}_{\\parallel}(k_{\\parallel}) = E_0 \\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{z^{2}}{2\\sigma^{2}}\\right) \\exp(-i k_{\\parallel} z) \\, dz = E_0 \\sigma \\sqrt{2\\pi}\\, \\exp\\!\\left(-\\frac{\\sigma^{2} k_{\\parallel}^{2}}{2}\\right) \\, .\n$$\n与每个 $k_{\\parallel}$ 相关联的谱功率密度与傅里叶振幅的模平方成正比，因此在相差一个恒定的归一化因子的情况下，\n$$\n\\mathcal{P}(k_{\\parallel}) \\propto |\\tilde{E}_{\\parallel}(k_{\\parallel})|^{2} = E_0^{2} (2\\pi) \\sigma^{2} \\exp(-\\sigma^{2} k_{\\parallel}^{2}) \\, .\n$$\n由于比例常数在定义分数的比值中被消掉，我们可以完全用归一化的高斯谱来表示耦合分数 $F$：\n$$\nF = \\frac{\\int_{-k_{c}}^{k_{c}} \\exp(-\\sigma^{2} k_{\\parallel}^{2}) \\, dk_{\\parallel}}{\\int_{-\\infty}^{\\infty} \\exp(-\\sigma^{2} k_{\\parallel}^{2}) \\, dk_{\\parallel}} \\, .\n$$\n计算高斯积分。分母是标准高斯积分：\n$$\n\\int_{-\\infty}^{\\infty} \\exp(-\\sigma^{2} k_{\\parallel}^{2}) \\, dk_{\\parallel} = \\frac{\\sqrt{\\pi}}{\\sigma} \\, .\n$$\n分子是截断高斯积分，可以用误差函数表示：\n$$\n\\int_{-k_{c}}^{k_{c}} \\exp(-\\sigma^{2} k_{\\parallel}^{2}) \\, dk_{\\parallel} = \\frac{\\sqrt{\\pi}}{\\sigma}\\, \\mathrm{erf}(\\sigma k_{c}) \\, ,\n$$\n其中 $\\mathrm{erf}(x)$ 是误差函数，定义为 $\\mathrm{erf}(x) = \\frac{2}{\\sqrt{\\pi}} \\int_{0}^{x} \\exp(-t^{2}) \\, dt$。\n\n因此，耦合分数为\n$$\nF = \\mathrm{erf}(\\sigma k_{c}) \\, ,\n$$\n其中 $k_{c} = k_{0} n_{f} = \\frac{\\omega}{c} n_{f} = \\frac{2\\pi f}{c}\\, n_{f} \\, .\n$$\n\n现在对指定参数进行数值计算。我们有 $n_{f} = 8.0$，$c = 2.99792458 \\times 10^{8}\\,\\mathrm{m/s}$，$f = 55\\,\\mathrm{MHz}$，以及设计选择 $\\sigma = 1/k_{c}$。当 $\\sigma = 1/k_{c}$ 时，误差函数的自变量为\n$$\n\\sigma k_{c} = 1 \\, .\n$$\n因此，\n$$\nF = \\mathrm{erf}(1) \\, .\n$$\n误差函数在 1 处的数值是一个众所周知的常数\n$$\n\\mathrm{erf}(1) \\approx 0.842700792949\\ldots \\, .\n$$\n四舍五入到四位有效数字，耦合分数为\n$$\nF \\approx 0.8427 \\, .\n$$\n这个值是无量纲的，符合要求。",
            "answer": "$$\\boxed{0.8427}$$"
        },
        {
            "introduction": "一旦波进入等离子体，它便与电子相互作用。然而，在托卡马克环形磁场中，并非所有电子的行为都相同。这个练习  深入探讨了捕获电子与通行电子之间的关键区别，这是环形等离子体物理学的基石。通过计算捕获电子的比例，我们可以理解哪些电子能够真正承载由波驱动的电流，这对精确的动理学建模至关重要。",
            "id": "3978878",
            "problem": "考虑一个大环径比托卡马克，其具有圆形磁通面、大半径 $R_0$、小半径 $r$ 和反环径比 $\\epsilon = r/R_0$，其中 $0  \\epsilon \\ll 1$。沿磁力线的磁场强度大小作为极向角 $\\theta$ 的函数，其模型为 $B(\\theta) = B_0 \\frac{R_0}{R(\\theta)}$，其中 $R(\\theta) = R_0 + r \\cos\\theta$，因此 $B(\\theta) = \\frac{B_0}{1 + \\epsilon \\cos\\theta}$。在射频（RF）快波电流驱动的计算模型中，使用弹跳平均来区分捕获电子和穿行电子的贡献。假设电子具有恒定速率 $v$，并在磁场 $B$ 达到最小值的外侧中平面（$\\theta = 0$）处，其速度空间螺距角分布是各向同性的。\n\n从粒子能量和磁矩守恒出发，根据螺距角 $\\alpha$（定义于外侧中平面）以及沿轨道最小和最大磁场强度，推导区分捕获电子和穿行电子的判据。然后，利用此判据以及各向同性分布意味着在外侧中平面上 $\\xi = \\cos\\alpha$ 在区间 $[-1,1]$ 上均匀分布这一事实，计算被捕获电子的总份额，将其表示为 $\\epsilon$ 的函数。请将最终结果表示为仅含 $\\epsilon$ 的单一闭式解析表达式。无需数值近似或四舍五入。该份额必须以无量纲数的形式报告（即，纯小数或不带百分号的符号表达式）。",
            "solution": "首先对问题进行验证，以确保其科学根据充分、提法恰当且客观。\n\n### 第1步：提取已知条件\n- 托卡马克几何：大环径比，圆形磁通面。\n- 大半径：$R_0$。\n- 小半径：$r$。\n- 反环径比：$\\epsilon = r/R_0$，其中 $0  \\epsilon \\ll 1$。\n- 磁场模型：$B(\\theta) = B_0 \\frac{R_0}{R(\\theta)}$，其中 $R(\\theta) = R_0 + r \\cos\\theta$。这可以简化为 $B(\\theta) = \\frac{B_0}{1 + \\epsilon \\cos\\theta}$。\n- 粒子性质：电子速率 $v$ 恒定。\n- 分布函数：在外侧中平面（$\\theta=0$）处，速度空间螺距角分布是各向同性的。\n- 定义：螺距角 $\\alpha$ 定义于外侧中平面。\n- 分布性质：各向同性分布意味着在外侧中平面上 $\\xi = \\cos\\alpha$ 在区间 $[-1,1]$ 上均匀分布。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学根据**：该问题基于等离子体物理学的基本原理，即带电粒子在磁场中的运动。能量守恒和磁矩守恒是基石概念。托卡马克中的磁场模型 $B \\propto 1/R$ 是对大环径比圆形等离子体的标准且有效的近似。捕获粒子和穿行粒子的概念在托卡马克的新经典输运和波-粒子相互作用中至关重要。该问题具有科学合理性。\n- **提法恰当**：问题提供了推导唯一解析解所需的所有必要信息和定义。目标陈述明确。\n- **客观性**：问题以清晰、精确、无偏见的方式陈述，使用了等离子体物理学的标准术语。\n\n### 第3步：结论与行动\n该问题有效。将提供完整解答。\n\n电子在托卡马克磁场中的运动受两个守恒量的支配：其动能 $E$ 和磁矩 $\\mu$。\n\n动能由 $E = \\frac{1}{2} m v^2$ 给出，其中 $m$ 是电子质量，$v$ 是其速率。问题陈述速率 $v$ 是固定的，因此能量是自然守恒的。速度矢量 $\\vec{v}$ 可以分解为平行于磁力线的分量（$v_{\\parallel}$）和垂直于磁力线的分量（$v_{\\perp}$），使得 $v^2 = v_{\\parallel}^2 + v_{\\perp}^2$。\n\n磁矩是一个绝热不变量，由 $\\mu = \\frac{m v_{\\perp}^2}{2B}$ 给出。其守恒性意味着当电子沿磁力线移动到磁场强度 $B$ 不同的区域时，其垂直速度 $v_{\\perp}$ 必须根据 $v_{\\perp}^2 = \\frac{2\\mu B}{m}$ 变化。\n\n我们可以利用这些守恒量来表示平行速度：\n$$v_{\\parallel}^2 = v^2 - v_{\\perp}^2 = v^2 - \\frac{2\\mu B}{m}$$\n对于给定粒子的轨道，磁矩 $\\mu$ 是恒定的。我们可以在一个参考点上对其进行评估。问题指明螺距角分布在外侧中平面（极向角 $\\theta=0$）处是已知的。在此位置，大半径为 $R(\\theta=0) = R_0 + r = R_0(1+\\epsilon)$，磁场强度达到最小值：\n$$B_{\\min} = B(\\theta=0) = \\frac{B_0}{1 + \\epsilon \\cos(0)} = \\frac{B_0}{1+\\epsilon}$$\n设此位置的速度分量为 $v_{\\parallel,0}$ 和 $v_{\\perp,0}$。螺距角 $\\alpha$ 在此定义，因此 $v_{\\perp,0} = v \\sin\\alpha$ 和 $v_{\\parallel,0} = v \\cos\\alpha$。磁矩可以用这些初始条件表示：\n$$\\mu = \\frac{m v_{\\perp,0}^2}{2B_{\\min}} = \\frac{m (v \\sin\\alpha)^2}{2B_{\\min}}$$\n将此 $\\mu$ 的表达式代回到场强为 $B(\\theta)$ 的任意点的 $v_{\\parallel}^2$ 方程中：\n$$v_{\\parallel}^2(\\theta) = v^2 - \\frac{2}{m} \\left( \\frac{m (v \\sin\\alpha)^2}{2B_{\\min}} \\right) B(\\theta) = v^2 - v^2 \\sin^2\\alpha \\frac{B(\\theta)}{B_{\\min}} = v^2 \\left( 1 - \\sin^2\\alpha \\frac{B(\\theta)}{B_{\\min}} \\right)$$\n如果一个粒子的平行运动在某一点发生反转，则该粒子被“捕获”。这发生在“反弹点”，此处 $v_{\\parallel}=0$。设 $v_{\\parallel}^2(\\theta)=0$，我们找到反弹点磁场的条件 $B_{\\text{bounce}}$：\n$$1 - \\sin^2\\alpha \\frac{B_{\\text{bounce}}}{B_{\\min}} = 0 \\implies \\sin^2\\alpha = \\frac{B_{\\min}}{B_{\\text{bounce}}}$$\n要使一个粒子被捕获，必须存在一个反弹点。这意味着在磁力线上必须有一个位置，其磁场强度 $B$ 满足这个条件。磁场强度从 $\\theta=0$ 处的 $B_{\\min}$ 变化到内侧中平面（$\\theta=\\pi$）处的最大值 $B_{\\max}$：\n$$B_{\\max} = B(\\theta=\\pi) = \\frac{B_0}{1 + \\epsilon \\cos(\\pi)} = \\frac{B_0}{1-\\epsilon}$$\n如果一个粒子的反弹点发生在某个 $B_{\\text{bounce}} \\le B_{\\max}$ 处，它将被捕获。这导出了捕获判据：\n$$\\sin^2\\alpha \\ge \\frac{B_{\\min}}{B_{\\max}}$$\n$\\sin^2\\alpha  B_{\\min}/B_{\\max}$ 的粒子具有足够的平行速度来克服磁镜，被称为“穿行”粒子。\n\n现在，我们计算比值 $B_{\\min}/B_{\\max}$：\n$$\\frac{B_{\\min}}{B_{\\max}} = \\frac{B_0/(1+\\epsilon)}{B_0/(1-\\epsilon)} = \\frac{1-\\epsilon}{1+\\epsilon}$$\n因此，捕获条件为：\n$$\\sin^2\\alpha \\ge \\frac{1-\\epsilon}{1+\\epsilon}$$\n问题陈述变量 $\\xi = \\cos\\alpha$ 在外侧中平面上的区间 $[-1,1]$ 内均匀分布。我们需要用 $\\xi$ 来表示捕获条件。使用恒等式 $\\sin^2\\alpha = 1 - \\cos^2\\alpha = 1-\\xi^2$：\n$$1 - \\xi^2 \\ge \\frac{1-\\epsilon}{1+\\epsilon}$$\n重新整理不等式以解出 $\\xi^2$：\n$$\\xi^2 \\le 1 - \\frac{1-\\epsilon}{1+\\epsilon} = \\frac{(1+\\epsilon) - (1-\\epsilon)}{1+\\epsilon} = \\frac{2\\epsilon}{1+\\epsilon}$$\n这意味着，如果粒子在外侧中平面的螺距角余弦 $\\xi$ 落在以下范围内，它们就会被捕获：\n$$-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} \\le \\xi \\le \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}$$\n被捕获电子的总份额 $f_{\\text{trapped}}$ 是随机选择的电子其 $\\xi$ 值落在此范围内的概率。由于 $\\xi$ 的分布在 $[-1,1]$ 上是均匀的，其概率密度函数为 $p(\\xi) = \\frac{1}{1 - (-1)} = \\frac{1}{2}$，对于 $\\xi \\in [-1,1]$。\n\n该份额通过对捕获区域上的概率密度函数进行积分来计算：\n$$f_{\\text{trapped}} = \\int_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} p(\\xi) d\\xi = \\int_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} \\frac{1}{2} d\\xi$$\n$$f_{\\text{trapped}} = \\frac{1}{2} \\left[ \\xi \\right]_{-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}^{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}} = \\frac{1}{2} \\left( \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} - \\left(-\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}\\right) \\right)$$\n$$f_{\\text{trapped}} = \\frac{1}{2} \\left( 2\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}} \\right) = \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}$$\n这就是被捕获电子总份额作为反环径比 $\\epsilon$ 的函数的闭式解析表达式。",
            "answer": "$$\\boxed{\\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}}$$"
        },
        {
            "introduction": "快波电流驱动建模的最终目标是量化波功率到等离子体电流的转换效率。这个高级练习  介绍了一种强大的计算技术——伴随方法，用于求解线性化的Fokker-Planck方程。通过实现这一数值解法，你将直接计算电流驱动效率，从而将动理学理论与实际的模拟结果联系起来。",
            "id": "3978893",
            "problem": "您正在使用伴随方法模拟均匀磁化等离子体中的快波电流驱动。目标是计算一个完全在一维速度空间模型内定义的无量纲局域效率，该模型需遵循科学真实性，同时保持数学上的适定性和计算上的可处理性。考虑由平行速度坐标 $u$ 定义的稳态、线性化电子动理学，并将其归一化为 $x = u / v_{\\mathrm{th}}$，其中 $v_{\\mathrm{th}}$ 是电子热速度。设伴随函数 $h(x)$ 是一个一维自伴二阶常微分方程的解，该方程源自线性化Fokker–Planck方程的伴随形式。$h(x)$ 的控制方程为\n$$\n- \\frac{d}{dx} \\left( D(x) \\frac{d h}{dx} \\right) + \\nu(x) h(x) = S_J(x),\n$$\n其中 $D(x)$ 和 $\\nu(x)$ 是严格为正的函数，分别模拟有效速度空间扩散和有效碰撞弛豫，$S_J(x)$ 是与电流矩相关的源项。假设以下物理上合理且形式简单的函数：\n$$\nD(x) = \\frac{D_0}{1 + x^3}, \\quad \\nu(x) = \\frac{\\nu_0}{1 + x^3}, \\quad S_J(x) = x,\n$$\n其中 $D_0  0$ 且 $\\nu_0  0$。边界条件为狄利克雷（Dirichlet）边界条件：$h(0) = 0$ 和 $h(x_{\\max}) = 0$，其中 $x_{\\max}  0$ 足够大，以表示对速度空间的截断。射频（RF）动量沉积剖面，代表了局域在共振点 $x_{\\mathrm{res}}$ 附近的准线性快波相互作用，其模型为\n$$\nS_{\\mathrm{RF}}(x) = A \\exp\\left( - \\frac{(x - x_{\\mathrm{res}})^2}{2 \\sigma^2} \\right),\n$$\n其振幅 $A  0$，共振位置 $x_{\\mathrm{res}}  0$，宽度 $\\sigma  0$。然后，根据伴随互易性，可得到无量纲驱动电流泛函\n$$\nJ = \\int_{0}^{x_{\\max}} h(x)\\, S_{\\mathrm{RF}}(x)\\, dx,\n$$\n以及无量纲吸收功率（在此简化模型中）为\n$$\nP_{\\mathrm{abs}} = \\int_{0}^{x_{\\max}} x\\, S_{\\mathrm{RF}}(x)\\, dx.\n$$\n将无量纲局域效率定义为\n$$\n\\eta = \\frac{J}{P_{\\mathrm{abs}}},\n$$\n在此归一化模型中，这是一个没有物理单位的纯数。您的任务是，通过在均匀网格上使用有限体积法或守恒有限差分格式对微分算子进行离散化，数值求解 $h(x)$，从而计算几组参数下的 $\\eta$。在 $[0, x_{\\max}]$ 上使用一个包含 $N$ 个点的网格，其中 $N \\ge 3$ 为整数，步长 $\\Delta x$ 均匀，中点扩散系数为 $D_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(D(x_i) + D(x_{i+1})\\right)$。对于 $i = 1, 2, \\ldots, N-2$，内部节点 $i$ 处的离散方程必须采用守恒形式\n$$\n- \\frac{1}{\\Delta x} \\left[ D_{i+\\frac{1}{2}} \\frac{h_{i+1} - h_i}{\\Delta x} - D_{i-\\frac{1}{2}} \\frac{h_i - h_{i-1}}{\\Delta x} \\right] + \\nu(x_i) h_i = S_J(x_i),\n$$\n其中 $h_0 = 0$ 且 $h_{N-1} = 0$。使用与节点中心表示相一致的中点或梯形法则，计算积分的离散近似值。\n\n实现一个完整、可运行的程序，该程序：\n- 构建网格和系数。\n- 求解得到的三对角线性系统以获得 $h(x)$。\n- 对每个测试案例，计算 $J$ 和 $P_{\\mathrm{abs}}$ 并返回 $\\eta$。\n\n使用以下测试集，其中包括一般情况、强碰撞性、弱碰撞性、窄射频频谱和近热共振。在所有情况下，设置 $N = 400$ 个网格点。\n\n- 案例1（一般情况）：$D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$。\n- 案例2（强碰撞性）：$D_0 = 2.0$, $\\nu_0 = 5.0$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$。\n- 案例3（弱碰撞性）：$D_0 = 0.2$, $\\nu_0 = 0.05$, $x_{\\mathrm{res}} = 2.0$, $\\sigma = 0.3$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$。\n- 案例4（高速下的窄射频频谱）：$D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 4.0$, $\\sigma = 0.05$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$。\n- 案例5（近热共振）：$D_0 = 1.0$, $\\nu_0 = 0.3$, $x_{\\mathrm{res}} = 0.5$, $\\sigma = 0.2$, $A = 1.0$, $x_{\\max} = 6.0$, $N = 400$。\n\n最终输出格式规范：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表用方括号括起来，结果按上述五个案例的顺序列出，例如 $\\left[ \\eta_1, \\eta_2, \\eta_3, \\eta_4, \\eta_5 \\right]$。每个条目必须是一个没有单位的浮点数。",
            "solution": "用户提供的问题已经过验证，被确认为一个有效的、适定的计算科学问题。它在科学上基于等离子体动理学理论，特别是射频电流驱动的伴随Fokker-Planck模型。该问题在数学上是自洽的，提供了所有必要的方程、参数和边界条件。指定的数值方法可以导出一个唯一且稳定的解。问题中没有矛盾、歧义或事实错误。因此，我们可以着手求解。\n\n该问题要求计算无量纲电流驱动效率 $\\eta$，其定义为驱动电流 $J$ 与吸收功率 $P_{\\mathrm{abs}}$ 的比值。这些量是通过求解伴随函数 $h(x)$ 的一维二阶常微分方程（ODE），然后计算两个涉及 $h(x)$ 和给定的射频（RF）源项 $S_{\\mathrm{RF}}(x)$ 的积分来确定的。\n\n在归一化速度域 $x \\in [0, x_{\\max}]$ 上，伴随函数 $h(x)$ 的控制ODE为：\n$$\n- \\frac{d}{dx} \\left( D(x) \\frac{d h}{dx} \\right) + \\nu(x) h(x) = S_J(x)\n$$\n边界条件为齐次狄利克雷边界条件 $h(0) = 0$ 和 $h(x_{\\max}) = 0$。系数由 $D(x) = D_0/(1 + x^3)$ 和 $\\nu(x) = \\nu_0/(1 + x^3)$ 给出，源项为 $S_J(x) = x$。\n\n我们将通过以下四个步骤来数值求解此问题：\n1.  使用守恒有限差分格式对求解域和ODE进行离散化。\n2.  组装所得到的三对角线性方程组。\n3.  求解此线性系统，以求得伴随函数 $h(x)$ 在网格上的值。\n4.  通过数值积分计算 $J$ 和 $P_{\\mathrm{abs}}$，以及它们的比值 $\\eta$。\n\n**1. 求解域与方程的离散化**\n\n我们将求解域 $[0, x_{\\max}]$ 离散化为一个包含 $N$ 个点的均匀网格，$x_i = i \\cdot \\Delta x$，其中 $i = 0, 1, \\dots, N-1$，网格间距为 $\\Delta x = x_{\\max} / (N-1)$。函数 $h$ 在每个网格点上的值表示为 $h_i = h(x_i)$。边界条件施加了 $h_0 = 0$ 和 $h_{N-1} = 0$，剩下 $N-2$ 个未知的内部值 $h_1, h_2, \\dots, h_{N-2}$。\n\n问题指定了对自伴微分算子使用守恒有限差分（或有限体积）离散化。在每个内部网格点 $x_i$（对于 $i = 1, 2, \\dots, N-2$），ODE近似为：\n$$\n- \\frac{1}{\\Delta x} \\left[ D_{i+\\frac{1}{2}} \\frac{h_{i+1} - h_i}{\\Delta x} - D_{i-\\frac{1}{2}} \\frac{h_i - h_{i-1}}{\\Delta x} \\right] + \\nu(x_i) h_i = S_J(x_i)\n$$\n这里，$D_{i \\pm \\frac{1}{2}}$ 表示在网格节点中点处计算的扩散系数，由 $D_{i+\\frac{1}{2}} = \\frac{1}{2}(D(x_i) + D(x_{i+1}))$ 给出。\n\n**2. 组装线性系统**\n\n整理离散化后的方程，可以得到一个形如 $\\mathbf{A} \\mathbf{h} = \\mathbf{b}$ 的线性系统，其中 $\\mathbf{h} = [h_1, h_2, \\dots, h_{N-2}]^T$ 是未知函数值的向量。对于每一行 $i$（对应于网格点 $x_i$，$i=1, \\dots, N-2$），方程可以写成：\n$$\n\\left(-\\frac{D_{i-\\frac{1}{2}}}{\\Delta x^2}\\right) h_{i-1} + \\left(\\frac{D_{i+\\frac{1}{2}} + D_{i-\\frac{1}{2}}}{\\Delta x^2} + \\nu_i\\right) h_i + \\left(-\\frac{D_{i+\\frac{1}{2}}}{\\Delta x^2}\\right) h_{i+1} = S_J(x_i)\n$$\n边界条件 $h_0=0$ 和 $h_{N-1}=0$ 被并入考虑：对于第一个方程（$i=1$），涉及 $h_0$ 的项消失；对于最后一个方程（$i=N-2$），涉及 $h_{N-1}$ 的项消失。\n\n此结构定义了一个 $(N-2) \\times (N-2)$ 的矩阵 $\\mathbf{A}$，它具有以下特性：\n- **三对角**：每个方程只将 $h_i$ 与其直接相邻的 $h_{i-1}$ 和 $h_{i+1}$ 联系起来。\n- **对称**：第 $i$ 行中 $h_{i+1}$ 的系数是 $-D_{i+1/2}/\\Delta x^2$，而第 $i+1$ 行中 $h_i$ 的系数是 $-D_{(i+1)-1/2}/\\Delta x^2 = -D_{i+1/2}/\\Delta x^2$。非对角线元素是对称的，$A_{i,j} = A_{j,i}$。\n- **严格对角占优**：由于 $D(x)  0$ 和 $\\nu(x)  0$，主对角线元素的绝对值严格大于该行非对角线元素绝对值之和。这保证了矩阵 $\\mathbf{A}$ 是非奇异的，并且该系统有唯一且稳定的解。\n\n矩阵 $\\mathbf{A}$ 的三条非零对角线（对于矩阵索引 $k=0, \\dots, N-3$）是：\n- 主对角线：$A_{k,k} = \\frac{D_{k+3/2} + D_{k+1/2}}{\\Delta x^2} + \\nu_{k+1}$\n- 上对角线：$A_{k, k+1} = -D_{k+3/2}/\\Delta x^2$\n- 下对角线：$A_{k+1, k} = -D_{k+3/2}/\\Delta x^2$\n\n右侧向量是 $\\mathbf{b} = [S_J(x_1), S_J(x_2), \\dots, S_J(x_{N-2})]^T$。\n\n**3. 求解线性系统**\n\n鉴于 $\\mathbf{A}$ 是三对角、对称正定矩阵，系统 $\\mathbf{A} \\mathbf{h} = \\mathbf{b}$ 可以被非常高效地求解。我们使用 `scipy.linalg.solve_banded` 函数，该函数针对带状矩阵进行了优化。此函数要求对角线以特定格式存储。求解出内部点 $\\mathbf{h} = [h_1, \\dots, h_{N-2}]$ 后，我们通过在前面加上 $h_0=0$ 和在后面追加 $h_{N-1}=0$ 来重建完整的解向量。\n\n**4. 效率计算**\n\n获得 $h_i$ 的离散解后，我们计算总无量纲电流 $J$ 和吸收功率 $P_{\\mathrm{abs}}$。使用梯形法则对积分进行数值近似，这对于在离散网格点上已知的数据是一个合适的选择。\n首先在网格上计算射频源项：\n$$\nS_{\\mathrm{RF}}(x_i) = A \\exp\\left( - \\frac{(x_i - x_{\\mathrm{res}})^2}{2 \\sigma^2} \\right)\n$$\n然后计算积分：\n$$\nJ = \\int_{0}^{x_{\\max}} h(x) S_{\\mathrm{RF}}(x) dx \\approx \\sum_{i=0}^{N-2} \\frac{h_i S_{\\mathrm{RF}}(x_i) + h_{i+1} S_{\\mathrm{RF}}(x_{i+1})}{2} \\Delta x\n$$\n$$\nP_{\\mathrm{abs}} = \\int_{0}^{x_{\\max}} x S_{\\mathrm{RF}}(x) dx \\approx \\sum_{i=0}^{N-2} \\frac{x_i S_{\\mathrm{RF}}(x_i) + x_{i+1} S_{\\mathrm{RF}}(x_{i+1})}{2} \\Delta x\n$$\n这些求和是使用 `numpy.trapz` 实现的。最后，无量纲效率计算为比值 $\\eta = J / P_{\\mathrm{abs}}$。对所提供的五个测试案例中的每一个都重复此完整过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It iterates through each case, computes the efficiency, and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general): D0=1.0, nu0=0.3, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 2 (strong collisionality): D0=2.0, nu0=5.0, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (2.0, 5.0, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 3 (weak collisionality): D0=0.2, nu0=0.05, x_res=2.0, sigma=0.3, A=1.0, x_max=6.0, N=400\n        (0.2, 0.05, 2.0, 0.3, 1.0, 6.0, 400),\n        # Case 4 (narrow RF spectrum at higher speed): D0=1.0, nu0=0.3, x_res=4.0, sigma=0.05, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 4.0, 0.05, 1.0, 6.0, 400),\n        # Case 5 (near-thermal resonance): D0=1.0, nu0=0.3, x_res=0.5, sigma=0.2, A=1.0, x_max=6.0, N=400\n        (1.0, 0.3, 0.5, 0.2, 1.0, 6.0, 400),\n    ]\n\n    results = []\n    for case in test_cases:\n        D0, nu0, x_res, sigma, A, x_max, N = case\n        eta = compute_efficiency(D0, nu0, x_res, sigma, A, x_max, N)\n        results.append(f\"{eta:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_efficiency(D0, nu0, x_res, sigma, A, x_max, N):\n    \"\"\"\n    Computes the dimensionless efficiency for a single set of parameters.\n\n    Args:\n        D0 (float): Amplitude of the diffusion coefficient.\n        nu0 (float): Amplitude of the collision frequency.\n        x_res (float): Resonance location for the RF source.\n        sigma (float): Width of the RF source.\n        A (float): Amplitude of the RF source.\n        x_max (float): Maximum value of the normalized velocity space.\n        N (int): Number of grid points.\n\n    Returns:\n        float: The computed dimensionless efficiency eta.\n    \"\"\"\n    \n    # 1. Grid setup\n    x = np.linspace(0, x_max, N)\n    dx = x[1] - x[0]\n\n    # 2. Define coefficient functions\n    def D_func(x_val):\n        return D0 / (1.0 + x_val**3)\n\n    def nu_func(x_val):\n        return nu0 / (1.0 + x_val**3)\n\n    def S_J_func(x_val):\n        return x_val\n\n    # 3. Evaluate coefficients on the grid\n    D_vals = D_func(x)\n    nu_vals = nu_func(x)\n    S_J_vals = S_J_func(x)\n\n    # 4. Assemble the tri-diagonal system for h_1, ..., h_{N-2}\n    # Number of interior points (unknowns)\n    M = N - 2\n    if M = 0:\n        raise ValueError(\"N must be >= 3 to have interior points.\")\n\n    # Mid-point diffusion coefficients D_{i+1/2}\n    D_mid = 0.5 * (D_vals[:-1] + D_vals[1:])\n    \n    # Diagonals of the matrix A for Ax=b system\n    # Main diagonal for matrix rows k=0..M-1, corresponding to grid points i=1..N-2\n    main_diag = (D_mid[1:N-1] + D_mid[0:N-2]) / dx**2 + nu_vals[1:N-1]\n    \n    # Off-diagonals are symmetric.\n    # Coeff of h_{i+1} in eq for h_i is -D_{i+1/2}/dx**2.\n    # Coeff of h_{i-1} in eq for h_i is -D_{i-1/2}/dx**2.\n    # A is symmetric because the operator is self-adjoint.\n    # Upper/lower diagonal elements A_{k,k+1} and A_{k+1,k} are both -D_{k+3/2}/dx**2.\n    off_diag = -D_mid[1:N-2] / dx**2\n    \n    # Assemble banded matrix for scipy.linalg.solve_banded\n    # (l, u) = (1, 1) for tri-diagonal\n    ab = np.zeros((3, M))\n    ab[0, 1:] = off_diag  # Super-diagonal\n    ab[1, :] = main_diag    # Main diagonal\n    ab[2, :-1] = off_diag # Sub-diagonal\n\n    # Right-hand side vector b\n    b = S_J_vals[1:N-1]\n\n    # 5. Solve the linear system for h on interior points\n    h_interior = solve_banded((1, 1), ab, b)\n    \n    # Reconstruct full solution h(x) with boundary conditions h(0)=h(x_max)=0\n    h = np.zeros(N)\n    h[1:N-1] = h_interior\n\n    # 6. Compute J and P_abs\n    def S_RF_func(x_val):\n        return A * np.exp(-(x_val - x_res)**2 / (2 * sigma**2))\n\n    S_RF_vals = S_RF_func(x)\n    \n    # Integrands\n    integrand_J = h * S_RF_vals\n    integrand_P = x * S_RF_vals\n\n    # Integrate using the trapezoidal rule\n    J = np.trapz(integrand_J, x=x)\n    P_abs = np.trapz(integrand_P, x=x)\n\n    # 7. Compute efficiency\n    if P_abs == 0:\n        return np.nan # Should not happen with given parameters\n    \n    eta = J / P_abs\n    return eta\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}