{
    "hands_on_practices": [
        {
            "introduction": "要对中性束注入进行建模，核心在于量化束流中的中性原子与等离子体中粒子之间的相互作用。本练习将引导您从基本动力学理论出发，计算电子碰撞电离这一关键过程的麦克斯韦平均反应速率系数 $\\langle\\sigma v\\rangle$。通过完成这个从第一性原理出发的计算，您将掌握准确模拟中性束在等离子体中衰减的基础，这是连接微观碰撞物理与宏观束流行为的关键一步 。",
            "id": "4014438",
            "problem": "一束单能氘中性束（$\\mathrm{D}^{0}$）穿过托卡马克中性束注入线中的一段均匀、静止的等离子体区域。等离子体中的电子是各向同性的，并服从麦克斯韦分布，电子温度为 $T_{e} = 2$ keV。在这段区域中，中性束的衰减主要由$\\mathrm{D}^{0}$的电子碰撞电离主导。\n\n从动理论和反应速率系数定义（即$\\sigma v$乘积的速度空间平均）出发，推导在电子温度为$T_{e}$时，电子对$\\mathrm{D}^{0}$的电子碰撞电离的麦克斯韦平均速率系数$\\langle \\sigma v \\rangle$。假设电子碰撞电离截面由适用于类氢原子的Lotz公式建模，\n$$\n\\sigma_{i}(E_{e}) = \n\\begin{cases}\n\\dfrac{a_{L} \\ln\\!\\left( \\dfrac{E_{e}}{I} \\right)}{E_{e} I}, & E_{e} \\ge I, \\\\\n0, & E_{e} < I,\n\\end{cases}\n$$\n其中$E_{e}$是以电子伏特（eV）为单位的电子动能，$I$是以eV为单位的电离阈值，$a_{L}$是Lotz系数。使用$I = 13.6$ eV和$a_{L} = 4.5 \\times 10^{-18}$ m$^{2}$ eV$^{2}$。\n\n然后，使用你计算出的$\\langle \\sigma v \\rangle$，评估中性束在长度为$L = 3.0$ m、均匀电子密度为$n_{e} = 1.0 \\times 10^{19}$ m$^{-3}$的直线束线段上的透射分数。将中性束速度视为恒定，其值由束能量$E_{b} = 80$ keV和氘原子质量$m_{D} = 3.3436 \\times 10^{-27}$ kg确定。假设在电子-中性粒子碰撞中，相对速度主要由电子的热运动决定，并忽略任何其他衰减过程（例如与离子的电荷交换或与残余气体的相互作用）。\n\n你可以假设以下物理常数：电子质量$m_{e} = 9.1093837015 \\times 10^{-31}$ kg和元电荷$e = 1.602176634 \\times 10^{-19}$ C。在适当的情况下，使用电子伏特表示中间能量，并确保最终$\\langle \\sigma v \\rangle$的单位一致性。\n\n计算最终的透射分数$N(L)/N(0)$，结果为无量纲小数。将你的最终答案四舍五入到三位有效数字。",
            "solution": "首先对问题进行验证。\n\n### 步骤1：提取已知条件\n-   目标粒子：单能氘中性束（$\\mathrm{D}^{0}$）。\n-   等离子体组分：具有各向同性麦克斯韦分布电子的均匀、静止等离子体。\n-   电子温度：$T_{e} = 2$ keV。\n-   主要衰减过程：$\\mathrm{D}^{0}$的电子碰撞电离。\n-   电子碰撞电离截面模型（Lotz公式）：\n    $$\n    \\sigma_{i}(E_{e}) = \n    \\begin{cases}\n    \\dfrac{a_{L} \\ln\\!\\left( \\dfrac{E_{e}}{I} \\right)}{E_{e} I}, & E_{e} \\ge I, \\\\\n    0, & E_{e} < I,\n    \\end{cases}\n    $$\n    其中$E_{e}$是以eV为单位的电子动能。\n-   电离阈值：$I = 13.6$ eV。\n-   Lotz系数：$a_{L} = 4.5 \\times 10^{-18}$ m$^{2}$ eV$^{2}$。\n-   束线段长度：$L = 3.0$ m。\n-   均匀电子密度：$n_{e} = 1.0 \\times 10^{19}$ m$^{-3}$。\n-   中性束能量：$E_{b} = 80$ keV。\n-   氘原子质量：$m_{D} = 3.3436 \\times 10^{-27}$ kg。\n-   电子质量：$m_{e} = 9.1093837015 \\times 10^{-31}$ kg。\n-   元电荷：$e = 1.602176634 \\times 10^{-19}$ C。\n-   假设：电子-中性粒子碰撞中的相对速度由电子热运动主导。\n-   假设：其他衰减过程被忽略。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题在等离子体物理和动理论方面有充分的依据。中性束注入是聚变能的核心技术。对电子使用麦克斯韦分布、对电离截面使用Lotz公式，以及麦克斯韦平均速率系数的概念，都是该领域的标准且成熟的方法。给定的参数（$T_e, n_e, E_b, L$）对于托卡马克聚变装置是物理上现实的。\n-   **适定性**：问题定义清晰，提供了所有必要的参数和合理的假设，足以推导和计算出唯一的解。\n-   **客观性**：语言精确且定量，不包含主观或基于观点的陈述。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整的解答。\n\n解答分为两个主要部分：首先，推导和计算麦克斯韦平均速率系数$\\langle \\sigma v \\rangle$；其次，计算中性束的衰减和透射分数。\n\n**第一部分：麦克斯韦平均速率系数$\\langle \\sigma v \\rangle$的推导**\n\n两种粒子1和2之间反应的麦克斯韦平均速率系数定义为其相对速度$v_{rel} = |\\mathbf{v}_1 - \\mathbf{v}_2|$与反应截面$\\sigma(v_{rel})$的乘积在它们速度分布上的平均值。\n$$ \\langle \\sigma v \\rangle = \\iint f_1(\\mathbf{v}_1) f_2(\\mathbf{v}_2) |\\mathbf{v}_1 - \\mathbf{v}_2| \\sigma(|\\mathbf{v}_1 - \\mathbf{v}_2|) d^3\\mathbf{v}_1 d^3\\mathbf{v}_2 $$\n在这里，粒子1是电子（$e$），粒子2是氘中性原子（$\\mathrm{D}^0$）。中性束是单能的，因此其速度分布是一个狄拉克δ函数，$f_D(\\mathbf{v}_D) = \\delta(\\mathbf{v}_D - \\mathbf{v}_b)$，其中$\\mathbf{v}_b$是恒定的束速度。电子服从麦克斯韦分布，其归一化分布函数为\n$$ f_e(\\mathbf{v}_e) = \\left(\\frac{m_e}{2\\pi k_B T_e}\\right)^{3/2} \\exp\\left(-\\frac{m_e v_e^2}{2 k_B T_e}\\right) $$\n将$f_D$的δ函数代入，简化了$\\langle \\sigma v \\rangle$的表达式：\n$$ \\langle \\sigma v \\rangle = \\int f_e(\\mathbf{v}_e) |\\mathbf{v}_e - \\mathbf{v}_b| \\sigma(|\\mathbf{v}_e - \\mathbf{v}_b|) d^3\\mathbf{v}_e $$\n问题陈述假设相对速度由电子热运动主导。这意味着电子热速度远大于中性束速度（$v_{th,e} \\gg v_b$）。我们来验证这一点：\n给定的电子热能为$T_e = 2$ keV。特征热速度为$v_{th,e} = \\sqrt{2 k_B T_e / m_e}$。\n$k_B T_e = 2000 \\text{ eV} \\times (1.602 \\times 10^{-19} \\text{ J/eV}) \\approx 3.204 \\times 10^{-16} \\text{ J}$。\n$v_{th,e} \\approx \\sqrt{2 (3.204 \\times 10^{-16} \\text{ J}) / (9.109 \\times 10^{-31} \\text{ kg})} \\approx 2.65 \\times 10^7 \\text{ m/s}$。\n束能量为$E_b = 80$ keV。束速度为$v_b = \\sqrt{2 E_b / m_D}$。\n$E_b = 80000 \\text{ eV} \\times (1.602 \\times 10^{-19} \\text{ J/eV}) \\approx 1.282 \\times 10^{-14} \\text{ J}$。\n$v_b = \\sqrt{2 (1.282 \\times 10^{-14} \\text{ J}) / (3.3436 \\times 10^{-27} \\text{ kg})} \\approx 2.77 \\times 10^6 \\text{ m/s}$。\n由于$v_b \\approx 0.1 v_{th,e}$，假设$v_b \\ll v_{th,e}$是合理的，因此我们可以将相对速度近似为$|\\mathbf{v}_e - \\mathbf{v}_b| \\approx v_e$。积分变为：\n$$ \\langle \\sigma v \\rangle \\approx \\int f_e(\\mathbf{v}_e) v_e \\sigma(v_e) d^3\\mathbf{v}_e $$\n在速度空间中转换到球坐标（$d^3\\mathbf{v}_e = 4\\pi v_e^2 dv_e$）并对角度部分积分，得到：\n$$ \\langle \\sigma v \\rangle = \\int_0^\\infty 4\\pi v_e^2 f_e(v_e) v_e \\sigma(v_e) dv_e = 4\\pi \\left(\\frac{m_e}{2\\pi k_B T_e}\\right)^{3/2} \\int_0^\\infty v_e^3 \\sigma(v_e) \\exp\\left(-\\frac{m_e v_e^2}{2 k_B T_e}\\right) dv_e $$\n我们将积分变量从速度$v_e$更改为动能$E_e = \\frac{1}{2}m_e v_e^2$。这意味着$v_e = \\sqrt{2E_e/m_e}$且$dv_e = (1/\\sqrt{2m_e E_e}) dE_e$。项$v_e^3 dv_e$变为$(2E_e/m_e) (dE_e/m_e) = (2E_e/m_e^2) dE_e$。将这些代入积分中，我们得到速率系数作为能量积分的标准公式：\n$$ \\langle \\sigma v \\rangle = \\sqrt{\\frac{8}{\\pi m_e}} (k_B T_e)^{-3/2} \\int_0^\\infty E_e \\sigma(E_e) \\exp\\left(-\\frac{E_e}{k_B T_e}\\right) dE_e $$\nLotz截面$\\sigma_i(E_e)$是以混合单位（m$^2$, eV）给出的。为了正确执行计算，所有量都必须使用国际单位制（SI）单位。\n以SI单位表示的给定值：\n- 元电荷$e = 1.602176634 \\times 10^{-19}$ C 给出换算关系$1 \\text{ eV} = 1.602176634 \\times 10^{-19}$ J。\n- 电离阈值$I_{SI} = 13.6 \\text{ eV} \\times e = 2.17896 \\times 10^{-18}$ J。\n- 电子热能$k_B T_e = 2000 \\text{ eV} \\times e = 3.20435 \\times 10^{-16}$ J。\n- Lotz系数$a_{L,SI} = 4.5 \\times 10^{-18} \\text{ m}^2 \\text{eV}^2 \\times e^2 = 1.15514 \\times 10^{-55} \\text{ m}^2 \\text{J}^2$。\n- 电子质量$m_e = 9.1093837 \\times 10^{-31}$ kg。\n\n在SI单位中，截面为$\\sigma_i(E_e) = \\frac{a_{L,SI} \\ln(E_e/I_{SI})}{E_e I_{SI}}$（当$E_e \\ge I_{SI}$时），否则为0。\n将其代入$\\langle \\sigma v \\rangle$的积分中：\n$$ \\langle \\sigma v \\rangle = \\sqrt{\\frac{8}{\\pi m_e}} (k_B T_e)^{-3/2} \\int_{I_{SI}}^\\infty E_e \\left[ \\frac{a_{L,SI} \\ln(E_e/I_{SI})}{E_e I_{SI}} \\right] \\exp\\left(-\\frac{E_e}{k_B T_e}\\right) dE_e $$\n被积函数中的$E_e$项相互抵消。\n$$ \\langle \\sigma v \\rangle = \\frac{a_{L,SI}}{I_{SI}} \\sqrt{\\frac{8}{\\pi m_e}} (k_B T_e)^{-3/2} \\int_{I_{SI}}^\\infty \\ln\\left(\\frac{E_e}{I_{SI}}\\right) \\exp\\left(-\\frac{E_e}{k_B T_e}\\right) dE_e $$\n我们来求解这个积分。令$x = E_e/k_B T_e$和$x_I = I_{SI}/k_B T_e$。则$E_e = x k_B T_e$且$dE_e = k_B T_e dx$。\n$$ \\int_{x_I}^\\infty \\ln\\left(\\frac{x k_B T_e}{I_{SI}}\\right) \\exp(-x) (k_B T_e) dx = (k_B T_e) \\int_{x_I}^\\infty \\ln\\left(\\frac{x}{x_I}\\right) e^{-x} dx $$\n积分$\\int_{x_I}^\\infty (\\ln x - \\ln x_I) e^{-x} dx$可以与指数积分函数$E_1(z) = \\int_z^\\infty (e^{-t}/t) dt$相关联。使用分部积分法，可以证明$\\int_z^\\infty \\ln(t) e^{-t} dt = \\ln(z)e^{-z} + E_1(z)$。该积分变为：\n$$ \\int_{x_I}^\\infty \\ln(x/x_I) e^{-x} dx = E_1(x_I) $$\n因此，原始的能量积分结果为$(k_B T_e) E_1(x_I)$。\n将此结果代回$\\langle \\sigma v \\rangle$的表达式中：\n$$ \\langle \\sigma v \\rangle = \\frac{a_{L,SI}}{I_{SI}} \\sqrt{\\frac{8}{\\pi m_e}} (k_B T_e)^{-3/2} (k_B T_e) E_1\\left(\\frac{I_{SI}}{k_B T_e}\\right) $$\n$$ \\langle \\sigma v \\rangle = \\frac{a_{L,SI}}{I_{SI}} \\sqrt{\\frac{8}{\\pi m_e k_B T_e}} E_1\\left(\\frac{I_{SI}}{k_B T_e}\\right) $$\n现在，我们计算数值。$E_1$的自变量是$x_I = I_{SI}/(k_B T_e) = (13.6 \\text{ eV})/(2000 \\text{ eV}) = 0.0068$。\n对于小的$z$，指数积分有级数展开$E_1(z) \\approx -\\gamma - \\ln(z)$，其中$\\gamma \\approx 0.57721566$是欧拉-马歇罗尼常数。\n$E_1(0.0068) \\approx -0.577216 - \\ln(0.0068) = -0.577216 - (-4.99003) \\approx 4.4128$。\n我们来计算前置因子：\n$$ \\frac{a_{L,SI}}{I_{SI}} = \\frac{1.15514 \\times 10^{-55} \\text{ m}^2\\text{J}^2}{2.17896 \\times 10^{-18} \\text{ J}} = 5.3013 \\times 10^{-38} \\text{ m}^2\\text{J} $$\n$$ \\sqrt{\\frac{8}{\\pi m_e k_B T_e}} = \\sqrt{\\frac{8}{\\pi (9.10938 \\times 10^{-31})(3.20435 \\times 10^{-16})}} \\approx \\sqrt{8.7221 \\times 10^{45}} \\approx 9.3392 \\times 10^{22} (\\text{kg J})^{-1/2} $$\n将这些组合起来：\n$$ \\langle \\sigma v \\rangle \\approx (5.3013 \\times 10^{-38}) \\times (9.3392 \\times 10^{22}) \\times 4.4128 $$\n$$ \\langle \\sigma v \\rangle \\approx (4.9510 \\times 10^{-15}) \\times 4.4128 \\approx 2.1847 \\times 10^{-14} \\text{ m}^3\\text{s}^{-1} $$\n\n**第二部分：透射中性束分数的计算**\n中性束密度$n_b$沿其路径长度$z$的衰减由以下微分方程描述：\n$$ \\frac{d n_b(z)}{dt} = -n_b(z) n_e \\langle \\sigma v \\rangle $$\n使用关系式$dz = v_b dt$，其中$v_b$是恒定的束速度，我们得到：\n$$ \\frac{d n_b(z)}{dz} = -\\frac{n_b(z) n_e \\langle \\sigma v \\rangle}{v_b} $$\n对于均匀等离子体（$n_e$是常数），我们将此方程在路径长度$L$上积分：\n$$ \\int_{n_b(0)}^{n_b(L)} \\frac{dn_b}{n_b} = -\\frac{n_e \\langle \\sigma v \\rangle}{v_b} \\int_0^L dz $$\n$$ \\ln\\left(\\frac{n_b(L)}{n_b(0)}\\right) = -\\frac{n_e \\langle \\sigma v \\rangle L}{v_b} $$\n透射分数是$N(L)/N(0) = n_b(L)/n_b(0)$。\n$$ \\frac{N(L)}{N(0)} = \\exp\\left(-\\frac{n_e \\langle \\sigma v \\rangle L}{v_b}\\right) $$\n我们需要从束能量$E_b = 80$ keV计算束速度$v_b$。\n$E_{b,SI} = 80 \\times 10^3 \\text{ eV} \\times (1.6021766 \\times 10^{-19} \\text{ J/eV}) = 1.28174 \\times 10^{-14}$ J。\n$m_D = 3.3436 \\times 10^{-27}$ kg。\n$$ v_b = \\sqrt{\\frac{2 E_{b,SI}}{m_D}} = \\sqrt{\\frac{2(1.28174 \\times 10^{-14} \\text{ J})}{3.3436 \\times 10^{-27} \\text{ kg}}} \\approx 2.7688 \\times 10^6 \\text{ m/s} $$\n现在我们计算衰减公式中的指数：\n$$ \\text{Exponent} = \\frac{n_e \\langle \\sigma v \\rangle L}{v_b} = \\frac{(1.0 \\times 10^{19} \\text{ m}^{-3})(2.1847 \\times 10^{-14} \\text{ m}^3\\text{s}^{-1})(3.0 \\text{ m})}{2.7688 \\times 10^6 \\text{ m/s}} $$\n$$ \\text{Exponent} \\approx \\frac{6.5541 \\times 10^5}{2.7688 \\times 10^6} \\approx 0.23671 $$\n透射分数为：\n$$ \\frac{N(L)}{N(0)} = \\exp(-0.23671) \\approx 0.78923 $$\n将最终答案四舍五入到三位有效数字，我们得到$0.789$。",
            "answer": "$$\\boxed{0.789}$$"
        },
        {
            "introduction": "在将中性束注入等离子体之前，我们必须先制造出中性束，这通常是通过在气体中和室中中和一束加速的离子束来完成的。本练习探讨了当束流穿过中和室时，不同粒子组分（离子、中性原子和被再电离的离子）的动态演化过程。您将建立并求解一个描述这些竞争过程的耦合速率方程组，从而深入理解决定中和室最终中性束产额和效率的关键因素 。",
            "id": "4014511",
            "problem": "用于中性束注入 (NBI) 的准直束流穿过一个长度为 $L$、气体数密度为 $n_g$ 的均匀气体中性化器，并经历两个主要的碰撞过程：将入射离子转化为中性粒子的电荷交换，以及将中性粒子转化为残余离子的剥离（电离）。假设束流为单一种类，且中性化器在空间上是均匀的。其基本理论基础是双体碰撞动力学理论：一个以速度 $v$ 运动的粒子，在数密度为 $n_g$、反应截面为 $\\sigma$ 的背景中，单位时间的反应概率为 $n_g \\sigma v$。对于沿中性化器轴向位置 $x$ 协调的束流，使用 $dt = dx / v$ 将时间变化率方程转换为空间变化率方程。设离子、中性粒子和残余离子的组分分数分别为 $f_i(x)$、$f_n(x)$ 和 $f_r(x)$，初始条件为 $f_i(0) = f_{i0}$，$f_n(0) = f_{n0}$，$f_r(0) = f_{r0}$，且 $f_{i0} + f_{n0} + f_{r0} = 1$。设电荷交换截面为 $\\sigma_{in}$，剥离截面为 $\\sigma_{nr}$。\n\n任务：\n1. 从组分分数的连续性和上述碰撞率模型出发，推导在均匀中性化器中控制 $f_i(x)$、$f_n(x)$ 和 $f_r(x)$ 的关于 $x$ 的耦合微分方程。\n2. 解析地求解这些耦合方程，得到以 $n_g$、$L$、$\\sigma_{in}$、$\\sigma_{nr}$ 及初始分数 $f_{i0}$、$f_{n0}$、$f_{r0}$ 表示的 $f_i(L)$、$f_n(L)$ 和 $f_r(L)$。您必须通过取适当的数学极限来处理 $n_g \\sigma_{in} = n_g \\sigma_{nr}$ 的特殊情况。\n3. 实现一个完整的、可运行的程序，使用您推导的解析解为以下测试套件计算出口处的组分分数。截面单位使用 $\\mathrm{m}^2$，$n_g$ 单位使用 $\\mathrm{m}^{-3}$，$L$ 单位使用 $\\mathrm{m}$。所有报告的组分分数均为无量纲。将每个分数表示为四舍五入到八位小数的浮点数。\n\n测试套件（每个元组列出 $(n_g, L, \\sigma_{in}, \\sigma_{nr}, f_{i0}, f_{n0}, f_{r0})$）：\n- 案例 A（一般情况）：$(1.0 \\times 10^{20}, 1.0, 1.2 \\times 10^{-19}, 2.0 \\times 10^{-20}, 1.0, 0.0, 0.0)$\n- 案例 B（等式边界情况，$n_g \\sigma_{in} = n_g \\sigma_{nr}$）：$(5.0 \\times 10^{19}, 0.5, 1.0 \\times 10^{-19}, 1.0 \\times 10^{-19}, 1.0, 0.0, 0.0)$\n- 案例 C（混合初始分数，低密度）：$(1.0 \\times 10^{18}, 1.0, 1.2 \\times 10^{-19}, 2.0 \\times 10^{-20}, 0.7, 0.3, 0.0)$\n- 案例 D（长中性化器，高密度）：$(2.0 \\times 10^{20}, 3.0, 8.0 \\times 10^{-20}, 3.0 \\times 10^{-20}, 1.0, 0.0, 0.0)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，每个案例的三元组包含在方括号内，无空格，且每个分数四舍五入到八位小数。例如，一个包含两个案例的输出应如下所示：\"[[f_iA,f_nA,f_rA],[f_iB,f_nB,f_rB]]\"。",
            "solution": "该问题的解答需要推导并求解一个描述中和室内粒子组分演化的耦合常微分方程（ODE）系统。\n\n**1. 微分方程的推导**\n\n设 $f_i(x)$、$f_n(x)$ 和 $f_r(x)$ 分别为在沿中和室轴向距离 $x$ 处，入射离子、中性粒子和残余离子的分数。在单位距离 $dx$ 内，每个组分分数的变化由碰撞过程决定。\n- 入射离子分数 $f_i$ 因电荷交换而减少（速率 $k_{in} = n_g \\sigma_{in}$）。\n- 中性粒子分数 $f_n$ 因离子的电荷交换而增加，并因自身的剥离（电离）而减少（速率 $k_{nr} = n_g \\sigma_{nr}$）。\n- 残余离子分数 $f_r$ 因中性粒子的剥离而增加。\n\n这构成了一个线性ODE系统：\n$$\n\\begin{align*}\n\\frac{df_i}{dx} &= -k_{in} f_i \\\\\n\\frac{df_n}{dx} &= k_{in} f_i - k_{nr} f_n \\\\\n\\frac{df_r}{dx} &= k_{nr} f_n\n\\end{align*}\n$$\n系统满足粒子数守恒 $f_i(x) + f_n(x) + f_r(x) = 1$，初始条件为 $f_i(0)=f_{i0}$、$f_n(0)=f_{n0}$ 和 $f_r(0)=f_{r0}$。\n\n**2. 解析解**\n\n该ODE系统可以依次求解。\n- **求解 $f_i(x)$:** 第一个方程是简单的指数衰减，其积分为：\n  $$ f_i(x) = f_{i0} e^{-k_{in} x} $$\n- **求解 $f_n(x)$:** 将 $f_i(x)$ 的解代入第二个方程，得到一个一阶线性非齐次ODE：\n  $$ \\frac{df_n}{dx} + k_{nr} f_n = k_{in} f_{i0} e^{-k_{in} x} $$\n  使用积分因子法求解该方程。解的形式取决于 $k_{in}$ 和 $k_{nr}$ 是否相等。\n\n  **情况 1：$k_{in} \\neq k_{nr}$**\n  解为：\n  $$ f_n(x) = f_{n0} e^{-k_{nr} x} + \\frac{k_{in} f_{i0}}{k_{nr} - k_{in}} (e^{-k_{in} x} - e^{-k_{nr} x}) $$\n\n  **情况 2：$k_{in} = k_{nr} = k$**\n  在此退化情况下，解变为：\n  $$ f_n(x) = (f_{n0} + k f_{i0} x) e^{-k x} $$\n- **求解 $f_r(x)$:** 残余离子的分数可以通过守恒定律最方便地求得：\n  $$ f_r(x) = 1 - f_i(x) - f_n(x) $$\n\n**3. 最终表达式与实现**\n为了求得中和室出口（$x=L$）处的组分分数，我们将 $x=L$ 代入解中。定义无量纲的“光学厚度”参数 $\\tau_{in} = k_{in}L$ 和 $\\tau_{nr} = k_{nr}L$ 会很方便。提供的Python代码实现了这些最终的解析表达式，用于计算每个测试用例的出口分数，并正确处理了一般情况和截面相等的特殊情况。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the exit species fractions for a neutral beam passing through a uniform gas neutralizer.\n    The solution is based on the analytical solution of the coupled rate equations.\n    \"\"\"\n\n    test_cases = [\n        # Case A (general case)\n        (1.0e20, 1.0, 1.2e-19, 2.0e-20, 1.0, 0.0, 0.0),\n        # Case B (equality edge case)\n        (5.0e19, 0.5, 1.0e-19, 1.0e-19, 1.0, 0.0, 0.0),\n        # Case C (mixed initial fractions, low density)\n        (1.0e18, 1.0, 1.2e-19, 2.0e-20, 0.7, 0.3, 0.0),\n        # Case D (long neutralizer, high density)\n        (2.0e20, 3.0, 8.0e-20, 3.0e-20, 1.0, 0.0, 0.0),\n    ]\n\n    def calculate_fractions(ng, L, sig_in, sig_nr, f_i0, f_n0, f_r0):\n        \"\"\"\n        Computes the final fractions (f_i, f_n, f_r) based on derived analytical solutions.\n        \n        Args:\n            ng (float): Gas number density (m^-3).\n            L (float): Length of the neutralizer (m).\n            sig_in (float): Charge exchange cross section (m^2).\n            sig_nr (float): Stripping cross section (m^2).\n            f_i0 (float): Initial incident ion fraction.\n            f_n0 (float): Initial neutral fraction.\n            f_r0 (float): Initial residual ion fraction.\n            \n        Returns:\n            tuple: A tuple containing the final fractions (f_i, f_n, f_r).\n        \"\"\"\n        tau_in = ng * sig_in * L\n        tau_nr = ng * sig_nr * L\n\n        # To handle numerical stability, check if tau_in and tau_nr are very close.\n        # A small tolerance is better than direct equality for floating-point numbers.\n        if abs(tau_in - tau_nr)  1e-12:\n            # Special case: tau_in = tau_nr = tau\n            tau = tau_in\n            f_i = f_i0 * np.exp(-tau)\n            f_n = (f_n0 + tau * f_i0) * np.exp(-tau)\n        else:\n            # General case: tau_in != tau_nr\n            exp_in = np.exp(-tau_in)\n            exp_nr = np.exp(-tau_nr)\n            \n            f_i = f_i0 * exp_in\n            f_n = f_n0 * exp_nr + (tau_in * f_i0 / (tau_nr - tau_in)) * (exp_in - exp_nr)\n\n        # f_r is determined by conservation\n        f_r = 1.0 - f_i - f_n\n\n        return f_i, f_n, f_r\n\n    results = []\n    for case in test_cases:\n        f_i, f_n, f_r = calculate_fractions(*case)\n        # Format each triplet of fractions as \"[f_i,f_n,f_r]\" with 8 decimal places\n        result_str = f\"[{f_i:.8f},{f_n:.8f},{f_r:.8f}]\"\n        results.append(result_str)\n\n    # Combine all case strings into the final output format \"[[...],[...],...]\"\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "掌握了如何计算反应速率和模拟中和过程后，我们便可以将这些知识应用于中性束的主要任务：在等离子体中沉积能量和动量。本练习要求您构建一个数值模型，以追踪中性束在不同磁约束位形（轴对称的托卡马克与非轴对称的仿星器）中的衰减和功率沉积。通过这个计算实践，您将实现一个“笔形束”代码，从而直观地比较复杂等离子体几何形状如何影响能量沉积剖面，连接了理论模型与聚变工程的实际应用 。",
            "id": "4014483",
            "problem": "考虑向环形等离子体中进行中性束注入（NBI; Neutral Beam Injection）。通过模拟快中性粒子沿直线束流轨迹穿过环体时的衰减和沉积，比较轴对称托卡马克平衡与简单的非轴对称仿星器式平衡。假设中性粒子不直接受磁场影响。沉积差异完全源于沿路径的几何形状和平衡密度的变化。使用以下基本原理：路径长度定义为 $s$；直线运动的牛顿运动学 $d\\vec{x}/ds = \\hat{u}$，其中 $\\hat{u}$ 为恒定单位矢量；由碰撞动力学推导出的用于描述衰减的比尔-朗伯定律 $dJ/ds = -n_e(s)\\,\\sigma(E)\\,J(s)$，其中 $J(s)$ 是中性粒子通量，$n_e$ 是电子密度，$\\sigma(E)$ 是依赖于能量的电离截面；以及将沉积功率与损失的中性粒子通量相关联的能量守恒关系 $dP_{\\mathrm{dep}}/ds = E\\,n_e(s)\\,\\sigma(E)\\,J(s)$。假设环体大半径为 $R_0$，小半径为 $a$，环体边界由条件 $r \\le a$ 定义，其中 $r = \\sqrt{\\left(R - R_0\\right)^2 + z^2}$ 且 $R = \\sqrt{x^2 + y^2}$。\n\n将轴对称托卡马克密度分布定义为 $n_e^{\\mathrm{tok}}(r) = n_0\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)$（对于 $0 \\le r \\le a$）和 $n_e^{\\mathrm{tok}}(r) = 0$（对于 $r  a$）。将简单的非轴对称仿星器式密度分布定义为 $n_e^{\\mathrm{stel}}(r,\\theta,\\phi) = n_0\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)\\max\\left(0, 1 + \\varepsilon \\cos\\left(m\\,\\theta - N\\,\\phi\\right)\\right)$，其中角向角 $\\theta = \\arctan2\\left(z, R - R_0\\right)$，环向角 $\\phi = \\arctan2(y,x)$，以及调制参数 $\\varepsilon$、$m$ 和 $N$。使用电离截面 $\\sigma(E) = \\sigma_0 \\left(\\frac{E}{E_0}\\right)^{-\\alpha}$，其中 $\\sigma_0$、$E_0$ 和 $\\alpha$ 为给定常数。设注入的中性束每个粒子的能量为 $E$（单位：焦耳），总功率为 $P_0$（单位：瓦特），因此初始中性粒子通量为 $J_0 = \\frac{P_0}{E}$（单位：粒子数/秒）。束流从位置 $\\vec{x}_0 = (x_0,y_0,z_0)$ 开始，并沿着恒定的单位方向 $\\hat{u}$ 行进，因此轨迹为 $\\vec{x}(s) = \\vec{x}_0 + s\\,\\hat{u}$。\n\n通过使用恒定步长 $\\Delta s$ 离散化路径 $s$ 来模拟沉积过程。在轨迹位于环体内部（$r(s) \\le a$）的每一步，根据 $J(s+\\Delta s) = J(s)\\exp\\left(-n_e(s)\\,\\sigma(E)\\,\\Delta s\\right)$ 对 $J$ 进行衰减，并累积沉积功率 $\\Delta P_{\\mathrm{dep}} = E\\,n_e(s)\\,\\sigma(E)\\,J(s)\\,\\Delta s$。在路径的末端，穿透（未沉积）功率为 $P_{\\mathrm{shine}} = E\\,J(s_{\\mathrm{end}})$。将沉积功率划分到三个小半径区间：核心区（$0 \\le r \\le a/3$）、中半径区（$a/3 \\le r \\le 2a/3$）和边界区（$2a/3 \\le r \\le a$）。同时，基于环向角扇区计算环向不对称比：$A = \\frac{P_{\\mathrm{dep}}^{\\phi \\in [0,\\pi)}}{P_{\\mathrm{dep}}^{\\phi \\in [\\pi,2\\pi)}}$，其中 $P_{\\mathrm{dep}}^{\\phi \\in [\\cdot]}$ 是当局部 $\\phi(s)$ 落在指定区间内时累积的总沉积功率。如果分母为零，则使用一个小的正则化值来定义 $A$，以避免除以零。\n\n所有距离以米表示，密度以 $\\mathrm{m^{-3}}$ 表示，截面以 $\\mathrm{m^2}$ 表示，能量以焦耳表示，功率以瓦特表示，角度以弧度表示。程序应输出每个区间内的沉积功率分数和穿透分数（均通过 $P_0$ 进行归一化），以及不对称比。分数必须是无单位的小数值。每个测试用例的最终输出应为列表 $[f_{\\mathrm{core}}, f_{\\mathrm{mid}}, f_{\\mathrm{edge}}, f_{\\mathrm{shine}}, A]$。\n\n对所有测试用例使用以下常数和步长：$\\sigma_0 = 1.0\\times 10^{-20}\\,\\mathrm{m^2}$，$E_0 = 50{,}000\\,\\mathrm{eV}$，$\\alpha = 0.5$，使用 $1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$ 将注入能量从 $\\mathrm{eV}$ 转换为焦耳，以及 $\\Delta s = 2.0\\times 10^{-3}\\,\\mathrm{m}$。使用最大路径长度 $s_{\\max} = 6.0\\,\\mathrm{m}$。\n\n实现以下包含三组参数的测试套件，以探究不同的行为：\n\n- 测试用例 $1$（轴对称托卡马克基准线，理想情况）：$R_0 = 1.7\\,\\mathrm{m}$，$a = 0.5\\,\\mathrm{m}$，$n_0 = 5.0\\times 10^{19}\\,\\mathrm{m^{-3}}$，$\\varepsilon = 0$，$m = 0$，$N = 0$，束流能量 $E = 60{,}000\\,\\mathrm{eV}$，总束流功率 $P_0 = 2.0\\times 10^{6}\\,\\mathrm{W}$，起始点 $\\vec{x}_0 = (R_0 + a + 0.2, 0, 0)$，单位方向 $\\hat{u}$ 在 $\\phi = 0$ 处与环向相切，并带有一个轻微的向内径向分量：$\\hat{u} = \\mathrm{normalize}\\left(\\hat{e}_\\phi - 0.15\\,\\hat{e}_R\\right)$（在 $\\phi = 0$ 处），其中 $\\hat{e}_R = (\\cos\\phi,\\sin\\phi,0)$ 且 $\\hat{e}_\\phi = (-\\sin\\phi,\\cos\\phi,0)$。\n- 测试用例 $2$（非轴对称仿星器式，螺旋调制）：$R_0 = 1.7\\,\\mathrm{m}$，$a = 0.5\\,\\mathrm{m}$，$n_0 = 5.0\\times 10^{19}\\,\\mathrm{m^{-3}}$，$\\varepsilon = 0.2$，$m = 2$，$N = 5$，束流能量 $E = 60{,}000\\,\\mathrm{eV}$，总束流功率 $P_0 = 2.0\\times 10^{6}\\,\\mathrm{W}$，起始点和方向与测试用例 $1$ 相同。\n- 测试用例 $3$（强非轴对称性和低密度的边缘情况，穿透增加）：$R_0 = 1.7\\,\\mathrm{m}$，$a = 0.5\\,\\mathrm{m}$，$n_0 = 2.0\\times 10^{19}\\,\\mathrm{m^{-3}}$，$\\varepsilon = 0.5$，$m = 3$，$N = 6$，束流能量 $E = 60{,}000\\,\\mathrm{eV}$，总束流功率 $P_0 = 2.0\\times 10^{6}\\,\\mathrm{W}$，起始点 $\\vec{x}_0 = (R_0 + a + 0.2, 0, 0)$，单位方向 $\\hat{u} = \\mathrm{normalize}\\left(\\hat{e}_\\phi - 0.05\\,\\hat{e}_R\\right)$（在 $\\phi = 0$ 处）。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也是相同格式的列表。例如，输出应类似于 $[[f_{\\mathrm{core}},f_{\\mathrm{mid}},f_{\\mathrm{edge}},f_{\\mathrm{shine}},A],[\\cdots],[\\cdots]]$，每个浮点值格式化为六位小数。",
            "solution": "该问题通过开发一个数值“笔形束”（pencil beam）模拟来解决，该模拟沿中性束穿过等离子体的直线轨迹追踪其衰减和功率沉积。该算法在提供的Python代码中实现。\n\n**1. 模拟设置**\n- **常数与参数**：定义了物理常数（eV到焦耳的转换因子）、截面参数（$\\sigma_0, E_0, \\alpha$）和数值参数（$\\Delta s, s_{\\max}$）。\n- **束流初始化**：对于每个测试用例，都设置了束流的起始位置 $\\vec{x}_0$ 和单位方向矢量 $\\hat{u}$。初始粒子通量 $J_0$ 由总功率 $P_0$ 和粒子能量 $E$ 计算得出。能量相关的电离截面 $\\sigma(E)$ 也被预先计算。\n- **累加器**：将变量初始化为零，用于累积在不同径向区域（核心区、中半径区、边界区）和环向扇区沉积的功率。\n\n**2. 数值积分算法**\n模拟的核心是一个循环，它沿着束流路径 $s$ 从0到 $s_{\\max}$ 以 $\\Delta s$ 为步长前进。在每一步 $i$：\n1.  **位置更新**：计算束流当前的笛卡尔坐标位置：$\\vec{x}(s_i) = \\vec{x}_0 + s_i\\,\\hat{u}$。\n2.  **坐标变换**：将该位置变换为环坐标 $(R, r, \\theta, \\phi)$，以便评估等离子体密度和对沉积功率进行分区。\n3.  **密度评估**：如果束流在等离子体边界内部（$r(s_i) \\le a$），则使用适当的模型（托卡马克情况为轴对称模型，仿星器情况为调制模型）计算局部电子密度 $n_e(s_i)$。\n4.  **功率沉积**：使用对沉积方程积分的一阶近似来计算在小路径段 $\\Delta s$ 中沉积的功率：$\\Delta P_{\\mathrm{dep},i} \\approx E\\,n_e(s_i)\\,\\sigma(E)\\,J(s_i)\\,\\Delta s$。\n5.  **数据累积**：根据局部小半径 $r(s_i)$ 和环向角 $\\phi(s_i)$，将计算出的 $\\Delta P_{\\mathrm{dep},i}$ 加到相应的功率累加器中。\n6.  **通量衰减**：使用比尔-朗伯定律在路径段上的积分形式来衰减粒子通量，以用于下一步计算：$J(s_{i+1}) = J(s_i)\\exp(-n_e(s_i)\\,\\sigma(E)\\,\\Delta s)$。对于给定的步长，此方法比简单的欧拉前向步进在数值上更稳定和准确。\n\n**3. 后处理与输出**\n循环完成后，计算最终结果：\n- 将核心区、中半径区和边界区累积的功率通过初始总功率 $P_0$ 进行归一化，得到沉积分数（$f_{\\mathrm{core}}, f_{\\mathrm{mid}}, f_{\\mathrm{edge}}$）。\n- 使用最终剩余通量 $J(s_{\\max})$ 计算穿透功率分数，$f_{\\mathrm{shine}} = (E \\cdot J(s_{\\max}))/P_0$。\n- 根据在两个环向半平面中沉积的功率计算环向不对称比 $A$，分母中加入一个小的正则化项以按要求防止除以零。\n\nPython代码实现了这整个过程，为每个测试用例计算并格式化包含五个元素的矢量结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants as per the problem statement\nEV_TO_J = 1.602176634e-19\nSIGMA_0 = 1.0e-20  # m^2\nE_0 = 50000.0      # eV\nALPHA = 0.5\nDELTA_S = 2.0e-3   # m\nS_MAX = 6.0        # m\n\ndef simulate_beam(params):\n    \"\"\"\n    Simulates neutral beam deposition for a given set of plasma and beam parameters.\n    \"\"\"\n    # Unpack parameters\n    R0 = params[\"R0\"]\n    a = params[\"a\"]\n    n0 = params[\"n0\"]\n    epsilon = params[\"epsilon\"]\n    m = params[\"m\"]\n    N = params[\"N\"]\n    E_eV = params[\"E_eV\"]\n    P0 = params[\"P0\"]\n    x0_vec = np.array(params[\"x0\"])\n    \n    # Calculate the unit direction vector u_hat\n    u_vec_unnormalized = np.array(params[\"u_vec\"])\n    u_hat = u_vec_unnormalized / np.linalg.norm(u_vec_unnormalized)\n\n    # Pre-calculations based on given parameters\n    E_J = E_eV * EV_TO_J\n    cross_section = SIGMA_0 * (E_eV / E_0)**(-ALPHA)\n    J0 = P0 / E_J\n\n    # Initialize simulation variables\n    J = J0\n    p_core, p_mid, p_edge = 0.0, 0.0, 0.0\n    p_sector1, p_sector2 = 0.0, 0.0  # sector1 for phi in [0, pi), sector2 for [pi, 2pi)\n    \n    # Main integration loop along the beam path\n    s_values = np.arange(0.0, S_MAX, DELTA_S)\n    for s in s_values:\n        x_vec = x0_vec + s * u_hat\n        x, y, z = x_vec[0], x_vec[1], x_vec[2]\n\n        # Convert Cartesian coordinates to toroidal/flux coordinates\n        R = np.sqrt(x**2 + y**2)\n        r = np.sqrt((R - R0)**2 + z**2)\n        \n        # If outside the plasma, no deposition occurs\n        if r >= a:\n            continue\n\n        # Calculate local electron density n_e\n        # Poloidal angle theta\n        theta = np.arctan2(z, R - R0)\n        # Toroidal angle phi, mapped to the range [0, 2*pi)\n        phi = np.arctan2(y, x)\n        if phi  0:\n            phi += 2.0 * np.pi\n\n        n_e_parabolic = n0 * (1.0 - (r / a)**2)\n        \n        if epsilon == 0.0:  # Axisymmetric tokamak case\n            n_e = n_e_parabolic\n        else:  # Non-axisymmetric stellarator-like case\n            mod_factor = 1.0 + epsilon * np.cos(m * theta - N * phi)\n            n_e = n_e_parabolic * max(0.0, mod_factor)\n        \n        if n_e = 0.0:\n            continue\n            \n        # Calculate deposited power in this path step\n        delta_p_dep = E_J * n_e * cross_section * J * DELTA_S\n        \n        # Accumulate power into radial bins\n        if r  a / 3.0:\n            p_core += delta_p_dep\n        elif r = 2.0 * a / 3.0:\n            p_mid += delta_p_dep\n        else:\n            p_edge += delta_p_dep\n            \n        # Accumulate power into toroidal sectors\n        if 0.0 = phi  np.pi:\n            p_sector1 += delta_p_dep\n        else:\n            p_sector2 += delta_p_dep\n            \n        # Attenuate the beam flux for the next step\n        J *= np.exp(-n_e * cross_section * DELTA_S)\n    \n    # Calculate final shine-through power\n    p_shine = E_J * J\n    \n    # Normalize power values to get fractions of total power P0\n    f_core = p_core / P0\n    f_mid = p_mid / P0\n    f_edge = p_edge / P0\n    f_shine = p_shine / P0\n    \n    # Calculate asymmetry ratio with regularization for the denominator\n    A = p_sector1 / (p_sector2 + 1e-12)\n\n    return [f_core, f_mid, f_edge, f_shine, A]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (axisymmetric tokamak baseline)\n        {\n            \"R0\": 1.7, \"a\": 0.5, \"n0\": 5.0e19,\n            \"epsilon\": 0.0, \"m\": 0, \"N\": 0,\n            \"E_eV\": 60000.0, \"P0\": 2.0e6,\n            \"x0\": (1.7 + 0.5 + 0.2, 0.0, 0.0), # (2.4, 0, 0)\n            \"u_vec\": (-0.15, 1.0, 0.0)\n        },\n        # Test case 2 (non-axisymmetric stellarator-like)\n        {\n            \"R0\": 1.7, \"a\": 0.5, \"n0\": 5.0e19,\n            \"epsilon\": 0.2, \"m\": 2, \"N\": 5,\n            \"E_eV\": 60000.0, \"P0\": 2.0e6,\n            \"x0\": (1.7 + 0.5 + 0.2, 0.0, 0.0),\n            \"u_vec\": (-0.15, 1.0, 0.0)\n        },\n        # Test case 3 (edge case with high non-axisymmetry)\n        {\n            \"R0\": 1.7, \"a\": 0.5, \"n0\": 2.0e19,\n            \"epsilon\": 0.5, \"m\": 3, \"N\": 6,\n            \"E_eV\": 60000.0, \"P0\": 2.0e6,\n            \"x0\": (1.7 + 0.5 + 0.2, 0.0, 0.0),\n            \"u_vec\": (-0.05, 1.0, 0.0)\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = simulate_beam(params)\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [\n        \"[\" + \",\".join([f\"{val:.6f}\" for val in res]) + \"]\" for res in all_results\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}