{
    "hands_on_practices": [
        {
            "introduction": "Understanding magnetohydrodynamic (MHD) stability begins with connecting the global plasma equilibrium to the local parameters that drive instabilities. This practice focuses on deriving the fundamental magnetic shear ($s$) and ballooning drive ($\\alpha$) parameters from first principles for a model tokamak equilibrium. Mastering this analytical exercise  is crucial for building an intuition of how the shape of pressure and current profiles influences the onset of pressure-driven modes.",
            "id": "3997568",
            "problem": "Consider a large-aspect-ratio, circular-cross-section tokamak equilibrium with concentric flux surfaces, constant major radius $R_0$, minor radius coordinate $r \\in [0,a]$, and a toroidal magnetic field that is radially uniform, $B(r)=B_0$. The plasma is in ideal magnetohydrodynamics (MHD) equilibrium under the force balance $\\mathbf{J} \\times \\mathbf{B} = \\nabla p$. The safety factor and scalar pressure profiles are prescribed analytically by $q(r) = q_0 + q_1 r^2$, with $q_0  0$ and $q_1 \\ge 0$, and $p(r) = p_0 \\left( 1 - \\frac{r^2}{a^2} \\right)$ with $p_0  0$. Starting from the fundamental definitions used in the local $s$-$\\alpha$ ballooning framework in such geometries:\n- magnetic shear $s(r)$, defined by the radial variation of the field-line pitch,\n- ballooning drive parameter $\\alpha(r)$, defined via the local pressure gradient and magnetic curvature in the large-aspect-ratio limit in terms of the dimensionless plasma beta $\\beta(r)$ and $q(r)$,\nderive analytic expressions for $s(r)$ and $\\alpha(r)$ using only the given equilibrium and the standard large-aspect-ratio assumptions stated above. Then, based on these derived expressions and first-principles reasoning, determine the radial location $r_\\star \\in [0,a]$ at which the local ballooning drive is most likely to be strongest along the minor radius. Report $s(r)$ and $\\alpha(r)$ as functions of $r$ and the parameters $\\{q_0,q_1,p_0,a,B_0,R_0,\\mu_0\\}$, and report $r_\\star$ in meters. No numerical values are needed; provide closed-form expressions. Express $r_\\star$ in meters. The final answer must be a single row matrix containing $s(r)$, $\\alpha(r)$, and $r_\\star$ in that order.",
            "solution": "The problem requires the derivation of the magnetic shear, $s(r)$, and the ballooning drive parameter, $\\alpha(r)$, for a large-aspect-ratio, circular-cross-section tokamak with prescribed safety factor and pressure profiles. Subsequently, the radial location, $r_\\star$, of the maximum ballooning drive must be determined. The analysis proceeds from the standard definitions of these quantities in ideal Magnetohydrodynamics (MHD).\n\nThe problem specifies the following profiles:\nSafety factor: $q(r) = q_0 + q_1 r^2$, with $q_0  0$ and $q_1 \\ge 0$.\nScalar pressure: $p(r) = p_0 \\left( 1 - \\frac{r^2}{a^2} \\right)$, with $p_0  0$.\nThe toroidal magnetic field is given as radially uniform, $B(r) = B_0$. The geometry is defined by the major radius $R_0$ and the minor radius $a$.\n\nFirst, we establish the standard definitions for the magnetic shear and the ballooning parameter in the specified limit. The magnetic shear, $s(r)$, quantifies the radial rate of change of the field line pitch and is defined as:\n$$s(r) = \\frac{r}{q(r)} \\frac{dq(r)}{dr}$$\nThe ballooning drive parameter, $\\alpha(r)$, is related to the pressure gradient and the magnetic field curvature. In the large-aspect-ratio, circular-flux-surface limit, it is defined as:\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 q(r)^2}{B^2} \\frac{dp(r)}{dr}$$\nGiven that $B(r) = B_0$, this becomes:\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 q(r)^2}{B_0^2} \\frac{dp(r)}{dr}$$\n\nWe proceed to derive the analytical expression for $s(r)$. We first compute the derivative of the safety factor profile with respect to the minor radius $r$:\n$$\\frac{dq}{dr} = \\frac{d}{dr}(q_0 + q_1 r^2) = 2 q_1 r$$\nSubstituting this and the given $q(r)$ into the definition of $s(r)$:\n$$s(r) = \\frac{r}{q_0 + q_1 r^2} (2 q_1 r) = \\frac{2 q_1 r^2}{q_0 + q_1 r^2}$$\nThis is the analytical expression for the magnetic shear.\n\nNext, we derive the analytical expression for $\\alpha(r)$. We first compute the pressure gradient:\n$$\\frac{dp}{dr} = \\frac{d}{dr} \\left[ p_0 \\left( 1 - \\frac{r^2}{a^2} \\right) \\right] = p_0 \\left( - \\frac{2r}{a^2} \\right) = - \\frac{2 p_0 r}{a^2}$$\nNow, we substitute the expressions for $\\frac{dp}{dr}$ and $q(r)$ into the definition of $\\alpha(r)$:\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 (q_0 + q_1 r^2)^2}{B_0^2} \\left( - \\frac{2 p_0 r}{a^2} \\right)$$\nSimplifying the expression yields:\n$$\\alpha(r) = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2$$\nThis is the analytical expression for the ballooning drive parameter.\n\nFinally, we must determine the radial location $r_\\star \\in [0, a]$ where the local ballooning drive, $\\alpha(r)$, is strongest. This corresponds to finding the value of $r$ that maximizes $\\alpha(r)$ on the interval $[0, a]$. We can find the extrema of $\\alpha(r)$ by finding its critical points, which are solutions to $\\frac{d\\alpha}{dr} = 0$. Let the constant pre-factor be $C = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2}$. Note that $C  0$.\nThe function to maximize is $\\alpha(r) = C r (q_0 + q_1 r^2)^2$.\nUsing the product rule for differentiation:\n$$\\frac{d\\alpha}{dr} = C \\left[ \\frac{d(r)}{dr} (q_0 + q_1 r^2)^2 + r \\frac{d}{dr} (q_0 + q_1 r^2)^2 \\right]$$\n$$\\frac{d\\alpha}{dr} = C \\left[ 1 \\cdot (q_0 + q_1 r^2)^2 + r \\cdot 2(q_0 + q_1 r^2) \\cdot (2 q_1 r) \\right]$$\nFactoring out the common term $(q_0 + q_1 r^2)$:\n$$\\frac{d\\alpha}{dr} = C (q_0 + q_1 r^2) [ (q_0 + q_1 r^2) + 4 q_1 r^2 ]$$\n$$\\frac{d\\alpha}{dr} = C (q_0 + q_1 r^2) (q_0 + 5 q_1 r^2)$$\nWe set the derivative to zero to find the critical points in the domain $r \\in [0, a]$. The constant $C$ is non-zero. The term $(q_0 + q_1 r^2)$ is equal to $q(r)$. Given $q_0  0$ and $q_1 \\ge 0$, this term is strictly positive for all $r \\ge 0$. Therefore, $(q_0 + q_1 r^2)$ cannot be zero.\nThe only remaining possibility for a critical point is:\n$$q_0 + 5 q_1 r^2 = 0$$\n$$r^2 = - \\frac{q_0}{5 q_1}$$\nGiven the constraints $q_0  0$ and $q_1 \\ge 0$, we consider two cases for $q_1$:\nCase 1: $q_1  0$. The right-hand side, $-\\frac{q_0}{5 q_1}$, is strictly negative. Thus, there are no real solutions for $r$ other than the trivial $r=0$ boundary case, meaning there are no critical points in the open interval $(0, a)$.\nCase 2: $q_1 = 0$. The equation becomes $q_0 = 0$, which contradicts the given condition $q_0  0$.\nIn both cases, there are no critical points in the interior of the domain $(0, a)$.\n\nSince there are no local maxima in the interior of the domain, the maximum value of $\\alpha(r)$ on the closed interval $[0, a]$ must occur at one of the boundaries, i.e., at $r=0$ or $r=a$. Let us evaluate $\\frac{d\\alpha}{dr}$ for $r  0$. Since $C  0$, $(q_0 + q_1 r^2)  0$, and $(q_0 + 5 q_1 r^2)  0$ for all $r0$ under the given conditions, the derivative $\\frac{d\\alpha}{dr}$ is strictly positive for $r \\in (0, a]$. This indicates that $\\alpha(r)$ is a monotonically increasing function of $r$ on the interval $[0, a]$.\nThe function's value at the lower boundary is $\\alpha(0) = 0$. Since the function is monotonically increasing, its maximum value must be attained at the upper boundary, $r=a$.\nTherefore, the radial location at which the local ballooning drive is strongest is $r_\\star = a$. The problem asks for this in meters; since $a$ is the minor radius, it has units of meters.\n\nThe final expressions are:\n$s(r) = \\frac{2 q_1 r^2}{q_0 + q_1 r^2}$\n$\\alpha(r) = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2$\n$r_\\star = a$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2 q_1 r^2}{q_0 + q_1 r^2}  \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2  a \\end{pmatrix}}$$"
        },
        {
            "introduction": "Once the local parameters $s$ and $\\alpha$ are known, the next step is to determine whether the plasma is stable, which is achieved by solving the one-dimensional ballooning eigenvalue equation. This equation balances the stabilizing effect of magnetic field line bending against the destabilizing pressure-curvature drive. In this hands-on practice , you will implement a finite-difference solver to find the lowest eigenvalue, which directly corresponds to the mode's stability, and see how varying $s$ and $\\alpha$ traces out the critical stability boundary.",
            "id": "3997593",
            "problem": "Consider ideal magnetohydrodynamics (MHD) in the high-toroidal-mode-number limit where the local ballooning representation applies. The stability of pressure-driven modes in a toroidal plasma with magnetic shear is commonly analyzed by studying the sign of the ideal MHD energy functional for a displacement field along a magnetic field line. In this local model, the problem reduces to a one-dimensional Sturm–Liouville eigenvalue problem along a field-aligned coordinate, where the competition between field-line bending and pressure–curvature drive determines stability. The stability boundary in the shear–pressure space, known as the $s$–$\\alpha$ diagram, is obtained by identifying parameter combinations for which the lowest eigenvalue of the associated self-adjoint operator is zero. Angles must be treated in radians.\n\nStarting from the energy principle that stable equilibria have positive definite potential energy variation and neutral stability occurs at zero, formulate the eigenvalue problem for the displacement amplitude $\\,\\xi(\\theta)\\,$ along the extended poloidal angle coordinate $\\,\\theta\\in\\mathbb{R}\\,$. Use the canonical simplified local $s$–$\\alpha$ model in large-aspect-ratio circular geometry, in which the operator takes the Schrödinger form\n$$\n\\mathcal{L}\\xi \\equiv -\\frac{d^2\\xi}{d\\theta^2} + U(\\theta)\\,\\xi,\n$$\nwith an effective potential\n$$\nU(\\theta) = s^2\\,\\theta^2 - \\alpha\\,\\cos\\theta,\n$$\nwhere $\\,s\\,$ is the magnetic shear (dimensionless) and $\\,\\alpha\\,$ is the normalized pressure-gradient drive (dimensionless). For a given pair $\\, (s,\\alpha) \\,$, the lowest eigenvalue $\\,\\lambda_{\\min}(s,\\alpha)\\,$ of $\\,\\mathcal{L}\\,$ characterizes stability: $\\,\\lambda_{\\min}0\\,$ indicates stability, $\\,\\lambda_{\\min}0\\,$ indicates instability, and $\\,\\lambda_{\\min}=0\\,$ is the neutral (marginal) stability boundary.\n\nYour tasks are:\n- Derive, from the ideal MHD energy principle and the local ballooning representation, why the operator $\\,\\mathcal{L}\\,$ above captures the competition between field-line bending and pressure–curvature drive, and explain why the stability boundary in the $\\,s$–$\\,\\alpha$ diagram is given by $\\,\\lambda_{\\min}(s,\\alpha)=0\\,$.\n- Explain the role of toroidal periodicity and why, in the ballooning representation, the physical boundary condition for localized modes is $\\,\\xi(\\theta)\\to 0\\,$ as $\\,|\\theta|\\to\\infty\\,$, and how this is approximated numerically on a finite interval using Dirichlet boundary conditions at large $\\,|\\theta|\\,$.\n- Implement a numerical solver that, for each specified $\\, (s,\\alpha) \\,$, constructs a finite-difference tridiagonal discretization of $\\,\\mathcal{L}\\,$ on the interval $\\,[-\\theta_{\\max},\\theta_{\\max}] \\,$ with $\\,\\xi(-\\theta_{\\max})=\\xi(\\theta_{\\max})=0\\,$, computes $\\,\\lambda_{\\min}(s,\\alpha)\\,$, and returns it as a floating-point number. All angles must be in radians. The output values are dimensionless.\n\nNumerical specification:\n- Use a uniform grid with $\\,N\\,$ interior points on $\\,[-\\theta_{\\max},\\theta_{\\max}] \\,$, spacing $\\,h=2\\theta_{\\max}/(N+1)\\,$.\n- Discretize $\\, -d^2/d\\theta^2 \\,$ by the standard second-order central difference, so the discrete operator is symmetric tridiagonal with main diagonal entries $\\,2/h^2 + U(\\theta_i)\\,$ and off-diagonal entries $\\, -1/h^2\\,$.\n- Impose Dirichlet boundary conditions $\\,\\xi(-\\theta_{\\max})=\\xi(\\theta_{\\max})=0\\,$ to emulate $\\,\\xi(\\theta)\\to 0\\,$ at large $\\,|\\theta|\\,$.\n- Use $\\,\\theta_{\\max}=10\\,$ radians and $\\,N=1024\\,$ for all test cases.\n\nTest suite and required output:\n- Test cases are the following pairs $\\, (s,\\alpha) \\,$:\n    1. $\\, (0.0,\\,0.2) \\,$\n    2. $\\, (1.0,\\,0.5) \\,$\n    3. $\\, (0.7,\\,3.0) \\,$\n    4. $\\, (2.5,\\,1.2) \\,$\n    5. $\\, (2.0,\\,5.0) \\,$\n- For each test case, compute $\\,\\lambda_{\\min}(s,\\alpha)\\,$ as a float. Angles are in radians; the eigenvalues are dimensionless.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), with each floating-point value rounded to six decimal places.\n\nDiscuss, in your derivation, the interplay of $\\,s\\,$ and $\\,\\alpha\\,$ in shaping $\\,U(\\theta)\\,$, the localization of eigenfunctions due to the $\\,s^2\\theta^2\\,$ term at large $\\,|\\theta|\\,$, and the implications of using Dirichlet conditions versus periodic conditions for representing physical ballooning modes. Also explain why identifying the sign change of $\\,\\lambda_{\\min}\\,$ across parameter space traces the stability boundary in the $\\,s$–$\\,\\alpha$ diagram.",
            "solution": "The problem posed is a valid and well-posed boundary value problem rooted in the principles of ideal Magnetohydrodynamics (MHD) stability theory for magnetically confined plasmas. It asks for a theoretical derivation and numerical solution of the one-dimensional ballooning equation in the simplified $s$-$\\alpha$ model. The problem statement is scientifically sound, self-contained, and objective. All parameters required for the numerical solution are explicitly provided.\n\n### Theoretical Foundation and Derivation\n\nThe stability of an ideal MHD plasma equilibrium is determined by the sign of the change in potential energy, $\\delta W$, resulting from a small fluid displacement $\\vec{\\xi}(\\vec{r})$. An equilibrium is stable if and only if $\\delta W  0$ for all possible displacements that satisfy the boundary conditions. Marginal stability occurs when the minimum value of $\\delta W$ is exactly zero for some non-trivial displacement.\n\nThe potential energy functional $\\delta W$ is an integral over the plasma volume, containing terms that represent different physical effects:\n$$\n\\delta W = \\frac{1}{2} \\int_V \\left[ \\frac{|\\vec{Q}|^2}{\\mu_0} - (\\vec{j} \\cdot \\vec{Q} \\times \\vec{\\xi}^*) + (\\vec{\\xi}^* \\cdot \\nabla p)(\\nabla \\cdot \\vec{\\xi}) + \\gamma p |\\nabla \\cdot \\vec{\\xi}|^2 \\right] dV\n$$\nwhere $\\vec{Q} = \\nabla \\times (\\vec{\\xi} \\times \\vec{B})$ is the perturbed magnetic field, $\\vec{B}$ is the equilibrium magnetic field, $\\vec{j}$ is the equilibrium current density, $p$ is the pressure, and $\\gamma$ is the ratio of specific heats.\n\nIn a toroidal plasma, modes with high toroidal mode number $n \\gg 1$ are often the most unstable. These modes are highly localized perpendicular to the magnetic field, but extend along the field lines. The \"ballooning representation\" is a mathematical formalism that exploits this structure. A displacement $\\vec{\\xi}$ is written in a form that separates the rapid variation across field lines from the slower variation along them. This leads to a simplified one-dimensional problem along an extended poloidal angle coordinate $\\theta \\in \\mathbb{R}$, which follows a single magnetic field line as it winds around the torus.\n\nAfter a lengthy derivation involving minimization of $\\delta W$ with respect to the perpendicular components of the displacement, the energy functional for the remaining parallel displacement amplitude, which we denote $\\xi(\\theta)$, reduces to a one-dimensional integral:\n$$\n\\delta W[\\xi] \\propto \\int_{-\\infty}^{\\infty} \\left[ \\left|\\frac{d\\xi}{d\\theta}\\right|^2 + V(\\theta) |\\xi|^2 \\right] d\\theta\n$$\nThis form reveals the core physics competition.\n1.  **Field-Line Bending (Stabilizing):** The term $|d\\xi/d\\theta|^2$ represents the energy cost of bending magnetic field lines. The magnetic field acts like a stiff string, resisting deformation. This term is always non-negative and is a primary stabilizing mechanism.\n2.  **Pressure-Curvature Drive (Potentially Destabilizing):** The term $V(\\theta)$ is an effective potential energy. In a toroidal device, the magnetic field curvature $\\vec{\\kappa}$ is not uniform. On the outboard side of the torus (where the major radius is largest), the curvature is \"unfavorable,\" meaning a plasma element displaced outwards moves into a region of weaker magnetic field, allowing it to expand and release energy. The pressure gradient $\\nabla p$ drives this expansion. Conversely, on the inboard side, the curvature is \"favorable\" and works to stabilize the plasma.\n\nThe $s$-$\\alpha$ model provides a simplified but canonical form for this potential in a large-aspect-ratio, circular-flux-surface tokamak:\n$$\nV(\\theta) = - \\alpha \\cos\\theta + s^2\\theta^2\n$$\n-   The term $-\\alpha \\cos\\theta$ models the pressure-curvature drive. The parameter $\\alpha$ is proportional to the plasma pressure gradient ($-\\nabla p$), and is thus the \"instability drive.\" The $\\cos\\theta$ factor models the variation of curvature along the field line: it is unfavorable (destabilizing, potential is negative) on the outboard side ($\\theta \\approx 0, \\pm 2\\pi, \\dots$) and favorable (stabilizing, potential is positive) on the inboard side ($\\theta \\approx \\pm \\pi, \\pm 3\\pi, \\dots$).\n-   The term $s^2\\theta^2$ arises from magnetic shear, $s = (r/q) dq/dr$, which describes the rate at which the magnetic field line pitch ($q$) changes with minor radius $r$. Shear connects neighboring flux surfaces, increasing the effective stiffness of the field lines against ballooning-type displacements. For large $|\\theta|$, this parabolic term dominates, forming a potential well that confines the mode along the field line. This is a powerful stabilizing effect.\n\nTo find the stability boundary, we seek the state of minimum energy. Applying the variational principle, $\\delta(\\delta W) / \\delta \\xi = 0$, to the energy functional leads to the Euler-Lagrange equation for $\\xi(\\theta)$:\n$$\n-\\frac{d^2\\xi}{d\\theta^2} + V(\\theta)\\xi = \\lambda \\xi\n$$\nThis is a Schrödinger-like equation where the operator is $\\mathcal{L} \\equiv -d^2/d\\theta^2 + V(\\theta)$, and the eigenvalue $\\lambda$ is directly proportional to the potential energy $\\delta W$ of the mode. The stability of the system is thus determined by the sign of the lowest eigenvalue, $\\lambda_{\\min}$, of the operator $\\mathcal{L}$.\n-   If $\\lambda_{\\min}  0$, all eigenmodes have positive energy, implying $\\delta W  0$ for any displacement. The system is stable.\n-   If $\\lambda_{\\min}  0$, there exists at least one mode (the one corresponding to $\\lambda_{\\min}$) with negative energy. The plasma can lower its energy by developing this instability ($\\delta W  0$).\n-   If $\\lambda_{\\min} = 0$, the system is at the threshold of instability, known as marginal stability. Tracing the locus of points in the $(s, \\alpha)$ parameter space where $\\lambda_{\\min}(s, \\alpha) = 0$ yields the stability boundary, which is the famous $s$-$\\alpha$ diagram.\n\n### Boundary Conditions and Numerical Implementation\n\nThe physical nature of a ballooning mode is that it is localized along the magnetic field line around the region of most unfavorable curvature ($\\theta \\approx 0$). Far from this region, the stabilizing effects of shear and favorable curvature dominate, and the displacement must decay. The mathematical boundary condition is therefore $\\xi(\\theta) \\to 0$ as $|\\theta| \\to \\infty$. The confining potential $s^2\\theta^2$ for $s \\neq 0$ ensures that the eigenfunctions of $\\mathcal{L}$ are square-integrable and decay at infinity, consistent with this physical picture. Using periodic boundary conditions would describe a different class of instabilities (kink or interchange-like modes) that are not localized by shear and are periodic over the connection length of the torus (e.g., from $\\theta=0$ to $\\theta=2\\pi$).\n\nFor a numerical solution, we cannot use an infinite domain. We must truncate the domain to a finite interval $[-\\theta_{\\max}, \\theta_{\\max}]$. We then impose homogeneous Dirichlet boundary conditions, $\\xi(-\\theta_{\\max}) = \\xi(\\theta_{\\max}) = 0$. This is a good approximation if $\\theta_{\\max}$ is chosen large enough such that the true eigenfunction has already decayed to a negligible amplitude at these boundaries.\n\nWe discretize the operator $\\mathcal{L}$ on a uniform grid of $N$ interior points $\\theta_i = -\\theta_{\\max} + i \\cdot h$ for $i=1, \\dots, N$, where the grid spacing is $h=2\\theta_{\\max}/(N+1)$. The second derivative is approximated using a second-order central difference:\n$$\n\\left. \\frac{d^2\\xi}{d\\theta^2} \\right|_{\\theta_i} \\approx \\frac{\\xi(\\theta_{i+1}) - 2\\xi(\\theta_i) + \\xi(\\theta_{i-1})}{h^2} = \\frac{\\xi_{i+1} - 2\\xi_i + \\xi_{i-1}}{h^2}\n$$\nSubstituting this into the eigenvalue equation $\\mathcal{L}\\xi = \\lambda\\xi$ gives a discrete system for each grid point $\\theta_i$:\n$$\n-\\frac{\\xi_{i-1} - 2\\xi_i + \\xi_{i+1}}{h^2} + U(\\theta_i)\\xi_i = \\lambda \\xi_i\n$$\nRearranging this yields a matrix eigenvalue problem, $A\\vec{\\xi} = \\lambda \\vec{\\xi}$:\n$$\n\\left( \\frac{2}{h^2} + U(\\theta_i) \\right) \\xi_i - \\frac{1}{h^2}\\xi_{i-1} - \\frac{1}{h^2}\\xi_{i+1} = \\lambda \\xi_i\n$$\nThe resulting matrix $A$ is a real, symmetric, tridiagonal matrix. Its main diagonal entries are $A_{ii} = 2/h^2 + U(\\theta_i) = 2/h^2 + s^2\\theta_i^2 - \\alpha\\cos(\\theta_i)$, and its first off-diagonal entries are $A_{i, i-1} = A_{i, i+1} = -1/h^2$. The Dirichlet boundary conditions $\\xi_0 = \\xi_{N+1} = 0$ are incorporated naturally into the equations for the first ($i=1$) and last ($i=N$) interior points. We can then use a highly efficient numerical algorithm, such as one provided by the `scipy.linalg.eigh_tridiagonal` function, to compute the eigenvalues of this matrix. The smallest of these eigenvalues is our numerical approximation for $\\lambda_{\\min}(s, \\alpha)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Solves the 1D ballooning mode eigenvalue problem for a set of (s, alpha) pairs.\n\n    The problem is to find the minimum eigenvalue of the Sturm-Liouville operator\n    L = -d^2/d(theta)^2 + U(theta), where U(theta) = s^2*theta^2 - alpha*cos(theta).\n    This is solved by discretizing the operator on a finite domain with Dirichlet\n    boundary conditions, resulting in a tridiagonal matrix eigenvalue problem.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.2),\n        (1.0, 0.5),\n        (0.7, 3.0),\n        (2.5, 1.2),\n        (2.0, 5.0),\n    ]\n\n    # Numerical parameters specified in the problem.\n    # Angle extent for the numerical domain.\n    theta_max = 10.0  # radians\n    # Number of interior grid points.\n    N = 1024\n\n    results = []\n    for s, alpha in test_cases:\n        # Step 1: Set up the spatial grid.\n        # The domain is [-theta_max, theta_max]. With N interior points, there are\n        # N+2 total points including boundaries, and thus N+1 intervals.\n        # Grid spacing h.\n        h = 2.0 * theta_max / (N + 1)\n        \n        # Create the grid of N interior points theta_i.\n        # theta_i = -theta_max + i*h for i = 1, ..., N.\n        theta = np.linspace(-theta_max + h, theta_max - h, N)\n\n        # Step 2: Construct the tridiagonal matrix representing the discretized operator.\n        # The eigenvalue problem is A*xi = lambda*xi, where A is the matrix.\n        # A has entries:\n        # A_ii = 2/h^2 + U(theta_i)\n        # A_{i, i+1} = A_{i+1, i} = -1/h^2\n        \n        # Calculate the potential U(theta) on the grid.\n        potential = s**2 * theta**2 - alpha * np.cos(theta)\n        \n        # Main diagonal of the tridiagonal matrix A.\n        main_diagonal = (2.0 / h**2) + potential\n        \n        # Off-diagonal elements of A. It is a constant vector.\n        off_diagonal = -1.0 / h**2 * np.ones(N - 1)\n\n        # Step 3: Solve the eigenvalue problem.\n        # We use scipy.linalg.eigh_tridiagonal which is highly optimized for\n        # finding eigenvalues of real symmetric tridiagonal matrices.\n        # It returns eigenvalues sorted in ascending order. We only need the minimum.\n        # The 'eigvals_only=True' argument makes the computation faster as we\n        # don't need the eigenvectors.\n        eigenvalues = eigh_tridiagonal(main_diagonal, off_diagonal, eigvals_only=True)\n        \n        # The minimum eigenvalue is the first element of the sorted array.\n        lambda_min = eigenvalues[0]\n        \n        results.append(lambda_min)\n\n    # Final print statement in the exact required format.\n    # The output must be a single line, with floating-point values rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Solving the stability equations often yields complex eigenfunctions, and a critical task for a physicist is to identify the nature of the predicted instability. Ballooning, kink, and interchange modes each possess characteristic spatial symmetries and localization properties along the magnetic field. This computational exercise  guides you to develop a robust analysis tool that computes quantitative metrics for parity and localization, enabling you to automatically classify numerical eigenfunctions and diagnose the underlying physics.",
            "id": "3997572",
            "problem": "You are given discrete complex eigenfunctions sampled along the field-line (poloidal) angle, to be analyzed for symmetry and spatial concentration. The aim is to design and implement a program that computes parity and localization metrics from first principles and uses them to classify modes as interchange-like, ballooning-like, or kink-like. Work in a periodic angle domain and treat the samples as periodic.\n\nStart from the following foundational bases:\n\n- Symmetry under reflection: a function $f(\\theta)$ is even if $f(\\theta)=f(-\\theta)$ and odd if $f(\\theta)=-f(-\\theta)$.\n- Energy density from a complex field: the physically relevant weight for localization is $w(\\theta)=\\lvert f(\\theta)\\rvert^{2}$.\n- Statistical localization quantification: for a weighted distribution on a circle, the location can be defined by a circular mean, and spread by a second central moment using wrapped angular differences.\n\nFrom these bases, implement the following metrics and classification logic.\n\n1. Discrete setting and notation. Let the grid be $\\theta_{j}$ for $j=0,\\dots,N-1$, with uniform spacing $\\Delta\\theta$ and period $2\\pi$. Let $f_{j}=f(\\theta_{j})\\in\\mathbb{C}$. Define the reflected sequence by $f^{\\mathrm{mir}}_{j}=f(-\\theta_{j})$, using periodicity to map $-\\theta_{j}$ back onto the discrete grid.\n\n2. Parity metrics. Define the evenness score $E$ and oddness score $O$ using the discrete $\\ell_{2}$ norm,\n$$\n\\lVert g\\rVert_{2}=\\left(\\sum_{j=0}^{N-1}\\lvert g_{j}\\rvert^{2}\\right)^{1/2}.\n$$\nLet\n$$\nE=\\frac{\\lVert f+f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}},\\qquad\nO=\\frac{\\lVert f-f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}.\n$$\nFor a perfectly even (respectively odd) sequence, $E=1$ and $O=0$ (respectively $E=0$ and $O=1$).\n\n3. Localization center (circular mean). Using the amplitude-squared weight $w_{j}=\\lvert f_{j}\\rvert^{2}$, define the circular mean angle $\\theta_{c}$ by\n$$\nC=\\sum_{j=0}^{N-1}w_{j}\\cos\\theta_{j},\\quad S=\\sum_{j=0}^{N-1}w_{j}\\sin\\theta_{j},\\quad \\theta_{c}=\\mathrm{atan2}(S,C).\n$$\nThis yields $\\theta_{c}\\in(-\\pi,\\pi]$.\n\n4. Wrapped deviations and moments. Define the wrapped deviation $\\delta_{j}$ as the unique element in $(-\\pi,\\pi]$ congruent to $\\theta_{j}-\\theta_{c}$ modulo $2\\pi$. Using these $\\delta_{j}$ and weights $w_{j}$, define the weighted central moments\n$$\n\\mu_{2}=\\frac{\\sum_{j}w_{j}\\,\\delta_{j}^{2}}{\\sum_{j}w_{j}},\\qquad\n\\sigma=\\sqrt{\\mu_{2}},\\qquad\n\\mu_{3}=\\frac{\\sum_{j}w_{j}\\,\\delta_{j}^{3}}{\\sum_{j}w_{j}},\\qquad\n\\gamma_{1}=\\frac{\\mu_{3}}{\\sigma^{3}},\n$$\nwhere $\\sigma$ is a localization width (in radians) and $\\gamma_{1}$ is a skewness.\n\n5. Localization fraction. For a chosen window half-width $w_{0}$, define the fraction of the weighted energy contained within that window:\n$$\nF_{w}=\\frac{\\sum_{j:\\lvert\\delta_{j}\\rvert\\le w_{0}}w_{j}}{\\sum_{j}w_{j}}.\n$$\n\n6. Classification logic. Based on widely used signatures in magnetohydrodynamics (MHD), adopt the following rule set using thresholds grounded in radians and dimensionless norms:\n- Kink-like: odd global structure. Require $O\\ge 0.8$ and $\\sigma\\ge 1.0$.\n- Interchange-like: even global (flute-like) structure. Require $E\\ge 0.8$ and $\\sigma\\ge 1.0$.\n- Ballooning-like: strongly localized near the outboard midplane taken at $\\theta=0$. Require $\\sigma1.0$, $\\lvert\\theta_{c}\\rvert0.6$, and $F_{w}\\ge 0.6$ with window $w_{0}=0.7$.\n- Otherwise: unclassified.\n\nMap these classes to integer labels as follows: interchange-like $\\to 0$, ballooning-like $\\to 1$, kink-like $\\to 2$, unclassified $\\to 3$.\n\nAngles must be treated in radians, and any reported angle-like intermediate quantities, if printed for debugging, must be in radians; however, the final required output contains only the classification labels.\n\nTest suite. Use $N=2048$ points and the uniform grid $\\theta_{j}=-\\pi+j\\,\\Delta\\theta$ with $\\Delta\\theta=2\\pi/N$ and endpoint excluded (periodic). Construct four synthetic eigenfunctions $f^{(k)}(\\theta)$ as follows, with all angles in radians:\n\n- Case A (ballooning-like prototype): $f^{(A)}(\\theta)=\\exp\\!\\left(-(\\theta/w)^{2}\\right)\\,\\exp\\!\\left(\\mathrm{i}\\,a\\,\\theta\\right)$ with $w=0.35$ and $a=0.3$.\n- Case B (kink-like prototype): $f^{(B)}(\\theta)=\\sin(\\theta)\\,\\exp\\!\\left(\\mathrm{i}\\,b\\,\\theta\\right)$ with $b=0.1$.\n- Case C (interchange-like prototype): $f^{(C)}(\\theta)=1+0.1\\cos(3\\theta)+\\mathrm{i}\\,0.05\\sin(2\\theta)$.\n- Case D (localized away from outboard midplane): $f^{(D)}(\\theta)=\\exp\\!\\left(-\\left(\\frac{\\theta-\\theta_{0}}{w}\\right)^{2}\\right)\\,\\exp\\!\\left(\\mathrm{i}\\,c\\,\\theta\\right)$ with $\\theta_{0}=1.2$, $w=0.35$, and $c=-0.2$.\n\nImplement the metrics and classification logic for each case using the same grid and report the class labels for cases A, B, C, D, in this order.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, in the form $[r_{A},r_{B},r_{C},r_{D}]$, where each $r_{\\cdot}$ is an integer label as specified above. No additional text should be printed. All angles must be handled in radians internally, but no angles are to be printed. The outputs are pure integers. The expected types are integers only, no floats or booleans, and the printed list must contain exactly four integers.",
            "solution": "The user-provided problem is rigorously validated and found to be scientifically grounded, well-posed, and objective. It specifies a clear set of computational tasks based on established principles in computational plasma physics and signal analysis. All necessary definitions, parameters, and test cases are provided, forming a self-contained and solvable problem. No inconsistencies, ambiguities, or factual errors were detected. Therefore, a complete solution is presented.\n\nThe solution is implemented by first defining the discrete computational domain and then systematically calculating a set of metrics to characterize the symmetry and localization of a given complex eigenfunction. These metrics are then used in a rule-based classification algorithm. The process is broken down into the following steps, which are applied to each of the four provided test cases.\n\n**1. Discretization and Reflection**\nThe continuous periodic domain $\\theta \\in [-\\pi, \\pi)$ is discretized into $N=2048$ points using the grid $\\theta_{j} = -\\pi + j \\Delta\\theta$ for $j=0, \\dots, N-1$, where the uniform spacing is $\\Delta\\theta = 2\\pi/N$. A given complex eigenfunction $f(\\theta)$ is represented as a vector of its samples $f_{j} = f(\\theta_j)$.\n\nThe core of the symmetry analysis rests on comparing the function $f$ with its reflection, $f^{\\mathrm{mir}}$. The reflected sequence is defined by $f^{\\mathrm{mir}}_{j}=f(-\\theta_{j})$. We must map $-\\theta_j$ back to a point on our discrete grid. The grid index $k$ corresponding to the angle $-\\theta_j$ is found by the congruence relation $k \\equiv -j \\pmod{N}$. This means that for a vector `f` of length $N$, the reflected vector `f_mir` is constructed such that `f_mir[0] = f[0]` and `f_mir[j] = f[N-j]` for $j=1, \\dots, N-1$. Computationally, this is equivalent to fixing the first element and reversing the rest of the array.\n\n**2. Parity Score Calculation**\nThe evenness score $E$ and oddness score $O$ quantify the symmetry of the eigenfunction. They are defined based on the projection of $f$ onto the subspaces of even and odd functions. The even and odd components of $f$ are $f_{\\mathrm{even}} = (f+f^{\\mathrm{mir}})/2$ and $f_{\\mathrm{odd}} = (f-f^{\\mathrm{mir}})/2$, respectively. The scores are defined using the discrete $\\ell_2$ norm, $\\lVert g\\rVert_{2}=\\left(\\sum_{j=0}^{N-1}\\lvert g_{j}\\rvert^{2}\\right)^{1/2}$:\n$$\nE=\\frac{\\lVert f+f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}, \\qquad O=\\frac{\\lVert f-f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}\n$$\nA key property, derived from the parallelogram law, is $E^2+O^2=1$, which ensures that a function cannot simultaneously have high evenness and high oddness scores. These norms are computed efficiently using vectorized operations on the complex arrays representing $f$ and $f^{\\mathrm{mir}}$.\n\n**3. Localization Metrics Calculation**\nTo quantify the spatial concentration of the eigenfunction, we use the amplitude-squared values, $w_j = \\lvert f_j \\rvert^2$, as a statistical weight distribution on the circle.\n\nThe **localization center**, or circular mean angle $\\theta_c$, is computed to identify the \"center of mass\" of the mode on the poloidal cross-section. It is determined by the angle of the resultant vector from summing unit vectors weighted by $w_j$:\n$$\nC = \\sum_{j=0}^{N-1}w_{j}\\cos\\theta_{j}, \\quad S = \\sum_{j=0}^{N-1}w_{j}\\sin\\theta_{j}, \\quad \\theta_{c} = \\mathrm{atan2}(S,C)\n$$\nThe `atan2` function correctly computes the angle in the range $(-\\pi, \\pi]$.\n\nThe **localization width**, $\\sigma$, is the circular analog of the standard deviation. It is derived from the second central moment, $\\mu_2$, of the wrapped angular deviations. The wrapped deviation for each point, $\\delta_j$, is the shortest arc from $\\theta_c$ to $\\theta_j$, defined as the unique value in $(-\\pi, \\pi]$ congruent to $\\theta_j - \\theta_c$ modulo $2\\pi$. This is computed as $\\delta_j = ((\\theta_j - \\theta_c + \\pi) \\pmod{2\\pi}) - \\pi$. The width $\\sigma$ is then:\n$$\n\\sigma = \\sqrt{\\mu_2} = \\sqrt{\\frac{\\sum_{j=0}^{N-1}w_{j}\\,\\delta_{j}^{2}}{\\sum_{j=0}^{N-1}w_{j}}}\n$$\n\nThe **localization fraction**, $F_w$, measures the fraction of the total \"energy\" (sum of weights $w_j$) contained within a symmetric window of half-width $w_0$ centered at $\\theta_c$:\n$$\nF_{w}=\\frac{\\sum_{j:\\lvert\\delta_{j}\\rvert\\le w_{0}}w_{j}}{\\sum_{j}w_{j}}\n$$\nFor this problem, $w_0=0.7$ radians. This calculation is implemented by creating a boolean mask to select the grid points within the window.\n\n**4. Classification Algorithm**\nThe computed metrics ($E$, $O$, $\\sigma$, $\\theta_c$, $F_w$) are fed into a deterministic classification algorithm based on the provided thresholds. The logic follows a sequential set of checks:\n1.  A mode is classified as **kink-like** (label $2$) if it has a dominant odd structure ($O \\ge 0.8$) and is spatially broad ($\\sigma \\ge 1.0$).\n2.  If not, it is classified as **interchange-like** (label $0$) if it has a dominant even structure ($E \\ge 0.8$) and is spatially broad ($\\sigma \\ge 1.0$).\n3.  If not, it is classified as **ballooning-like** (label $1$) if it is strongly localized ($\\sigma  1.0$) near the outboard midplane ($|\\theta_c|  0.6$) and a significant fraction of its energy is concentrated there ($F_w \\ge 0.6$ for $w_0=0.7$).\n4.  If none of these conditions are met, the mode is **unclassified** (label $3$).\n\nThe conditions for the three defined classes are mutually exclusive, so the order of evaluation does not alter the final classification. This logic is implemented as an `if-elif-else` structure. The entire process is encapsulated in a function that is called for each of the four synthetic test cases, and the resulting integer labels are collected for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes metrics and classifies MHD-like modes based on their poloidal structure.\n    \"\"\"\n\n    def analyze_and_classify(f, theta, w0):\n        \"\"\"\n        Calculates all metrics for a given eigenfunction and returns its classification label.\n\n        Args:\n            f (np.ndarray): The complex eigenfunction values on the grid.\n            theta (np.ndarray): The grid of poloidal angles in radians.\n            w0 (float): Window half-width for the localization fraction calculation.\n\n        Returns:\n            int: The classification label (0, 1, 2, or 3).\n        \"\"\"\n        # Ensure the input array is not empty\n        if f.size == 0:\n            return 3 # Unclassified\n\n        # 1. Parity Metrics\n        # Construct the reflected sequence f_mir_j = f(-theta_j).\n        # The index mapping is j - (-j) mod N. This corresponds to f[0] followed by reversed f[1:].\n        f_mir = np.concatenate(([f[0]], f[1:][::-1]))\n\n        norm_f = np.linalg.norm(f)\n        if norm_f == 0:\n            return 3 # Unclassified for a zero function\n\n        norm_f_plus_fmir = np.linalg.norm(f + f_mir)\n        norm_f_minus_fmir = np.linalg.norm(f - f_mir)\n\n        E = norm_f_plus_fmir / (2 * norm_f)\n        O = norm_f_minus_fmir / (2 * norm_f)\n\n        # 2. Localization Metrics\n        w = np.abs(f)**2\n        W_total = np.sum(w)\n        \n        if W_total  1e-15: # Effectively zero\n            return 3 # Unclassified if total weight is zero\n\n        # Circular mean angle theta_c\n        C = np.sum(w * np.cos(theta))\n        S = np.sum(w * np.sin(theta))\n        theta_c = np.arctan2(S, C)\n\n        # Wrapped deviations\n        dev = theta - theta_c\n        # Wrap deviations to the interval (-pi, pi]\n        delta = (dev + np.pi) % (2 * np.pi) - np.pi\n        \n        # Localization width sigma\n        mu_2 = np.sum(w * delta**2) / W_total\n        sigma = np.sqrt(mu_2)\n        \n        # Localization fraction F_w\n        mask = np.abs(delta) = w0\n        F_w = np.sum(w[mask]) / W_total\n        \n        # 3. Classification Logic\n        label = 3 # Default to unclassified\n        if O = 0.8 and sigma = 1.0:\n            label = 2  # Kink-like\n        elif E = 0.8 and sigma = 1.0:\n            label = 0  # Interchange-like\n        elif sigma  1.0 and np.abs(theta_c)  0.6 and F_w = 0.6:\n            label = 1  # Ballooning-like\n        \n        return label\n\n    # Common parameters for all test cases\n    N = 2048\n    theta = np.linspace(-np.pi, np.pi, N, endpoint=False)\n    window_half_width = 0.7\n    \n    results = []\n\n    # Case A: Ballooning-like prototype\n    w_A, a_A = 0.35, 0.3\n    f_A = np.exp(-(theta / w_A)**2) * np.exp(1j * a_A * theta)\n    results.append(analyze_and_classify(f_A, theta, window_half_width))\n\n    # Case B: Kink-like prototype\n    b_B = 0.1\n    f_B = np.sin(theta) * np.exp(1j * b_B * theta)\n    results.append(analyze_and_classify(f_B, theta, window_half_width))\n\n    # Case C: Interchange-like prototype\n    f_C = 1 + 0.1 * np.cos(3 * theta) + 1j * 0.05 * np.sin(2 * theta)\n    results.append(analyze_and_classify(f_C, theta, window_half_width))\n\n    # Case D: Localized away from outboard midplane\n    theta0_D, w_D, c_D = 1.2, 0.35, -0.2\n    f_D = np.exp(-((theta - theta0_D) / w_D)**2) * np.exp(1j * c_D * theta)\n    results.append(analyze_and_classify(f_D, theta, window_half_width))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}