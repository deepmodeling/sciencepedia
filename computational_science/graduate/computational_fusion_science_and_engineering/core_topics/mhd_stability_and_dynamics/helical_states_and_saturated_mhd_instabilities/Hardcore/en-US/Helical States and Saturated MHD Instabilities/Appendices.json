{
    "hands_on_practices": [
        {
            "introduction": "Understanding saturated MHD instabilities begins with identifying where they can form. This first practice focuses on the crucial concept of a rational magnetic surface, the birthplace of instabilities like tearing modes. By deriving the resonance condition $q(r_s) = m/n$ and applying it to a model safety factor profile, you will build a foundational skill for analyzing MHD stability in toroidal plasmas .",
            "id": "3990708",
            "problem": "Consider a large-aspect-ratio tokamak with circular concentric magnetic flux surfaces of minor radius $a$ and major radius $R$, supporting an equilibrium magnetic field $\\mathbf{B}(r)$ that is axisymmetric. Let the field lines lie on nested flux surfaces and define the safety factor $q(r)$ as the ratio of toroidal turns to poloidal turns a field line makes, which in a large-aspect-ratio tokamak can be written as $q(r) = \\frac{r B_{\\phi}(r)}{R B_{\\theta}(r)}$, where $B_{\\phi}(r)$ and $B_{\\theta}(r)$ are the toroidal and poloidal components of the magnetic field, respectively. In Magnetohydrodynamics (MHD), a single-helicity perturbation with poloidal mode number $m$ and toroidal mode number $n$ has spatial dependence $\\exp\\!\\left[i (m \\theta - n \\phi)\\right]$. A resonant (rational) surface for such a perturbation is defined by the condition that the perturbation phase is stationary along equilibrium magnetic field lines, which is equivalent to vanishing parallel wave number for the helical mode.\n\nStarting from the parallel wave number definition for a helical perturbation and the field-line relation for equilibrium magnetic fields, derive the resonance condition in terms of the safety factor $q(r)$ and the integers $m$ and $n$, and then use it to determine the resonance radius $r_{s}$ for the $(m,n)=(2,1)$ mode in a plasma whose safety factor profile is given by $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$ for $0 \\le r \\le a$.\n\nExpress the resonance radius in meters in terms of $a$. The final answer must be a single closed-form symbolic expression.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n**Step 1: Extract Givens**\n-   Tokamak geometry: large-aspect-ratio, circular concentric flux surfaces, minor radius $a$, major radius $R$.\n-   Equilibrium magnetic field: $\\mathbf{B}(r)$, axisymmetric.\n-   Safety factor definition: $q(r) = \\frac{r B_{\\phi}(r)}{R B_{\\theta}(r)}$.\n-   Single-helicity perturbation: spatial dependence $\\exp\\!\\left[i (m \\theta - n \\phi)\\right]$, with poloidal mode number $m$ and toroidal mode number $n$.\n-   Resonance condition: The perturbation phase is stationary along equilibrium magnetic field lines, which is equivalent to a vanishing parallel wave number ($k_{||}=0$).\n-   Specific mode numbers: $(m,n)=(2,1)$.\n-   Specific safety factor profile: $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$ for $0 \\le r \\le a$.\n-   Objective: Derive the resonance condition in terms of $q(r)$, $m$, and $n$, and then determine the resonance radius $r_{s}$ for the given mode and profile.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded**: The problem statement is based on fundamental principles of Magnetohydrodynamics (MHD) as applied to tokamak plasmas. The definitions of the safety factor $q$, helical perturbations, and the resonance condition are standard in fusion plasma physics. The given parabolic-like $q$-profile is a common and physically reasonable model. The problem is scientifically valid.\n-   **Well-Posed**: The problem is clearly defined and provides all necessary information and constraints to arrive at a unique solution. The given functions and parameters are sufficient for the required derivation and calculation.\n-   **Objective**: The language is precise, technical, and free of any subjective or ambiguous terminology.\n-   **Conclusion**: The problem is valid as it is self-contained, consistent, and scientifically sound.\n\n**Step 3: Verdict and Action**\n-   The problem is valid. A complete solution will be provided.\n\n**Derivation of the Resonance Condition**\n\nThe resonance condition for a helical perturbation occurs where the perturbation has a constant phase along an equilibrium magnetic field line. This is equivalent to the condition that the component of the perturbation's wave vector parallel to the equilibrium magnetic field, denoted $k_{||}$, is zero.\n\nThe phase of the perturbation is given by $\\alpha(r, \\theta, \\phi) = m \\theta - n \\phi$. The wave vector $\\mathbf{k}$ is the gradient of this phase, $\\mathbf{k} = \\nabla \\alpha$. In a large-aspect-ratio tokamak approximation with coordinates $(r, \\theta, \\phi)$, the gradient operator is $\\nabla = \\mathbf{e}_r \\frac{\\partial}{\\partial r} + \\mathbf{e}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\mathbf{e}_{\\phi} \\frac{1}{R} \\frac{\\partial}{\\partial \\phi}$.\nTherefore, the wave vector of the perturbation is:\n$$ \\mathbf{k} = \\nabla(m \\theta - n \\phi) = \\frac{m}{r} \\mathbf{e}_{\\theta} - \\frac{n}{R} \\mathbf{e}_{\\phi} $$\nThe equilibrium magnetic field $\\mathbf{B}(r)$ in an axisymmetric tokamak with nested circular flux surfaces has components only in the poloidal ($\\theta$) and toroidal ($\\phi$) directions:\n$$ \\mathbf{B}(r) = B_{\\theta}(r) \\mathbf{e}_{\\theta} + B_{\\phi}(r) \\mathbf{e}_{\\phi} $$\nThe parallel wave number is defined as $k_{||} = \\frac{\\mathbf{k} \\cdot \\mathbf{B}}{|\\mathbf{B}|}$. The resonance condition $k_{||}=0$ implies that the numerator must be zero:\n$$ \\mathbf{k} \\cdot \\mathbf{B} = 0 $$\nLet's evaluate the dot product at a given radius $r$:\n$$ \\mathbf{k} \\cdot \\mathbf{B} = \\left(\\frac{m}{r} \\mathbf{e}_{\\theta} - \\frac{n}{R} \\mathbf{e}_{\\phi}\\right) \\cdot \\left(B_{\\theta}(r) \\mathbf{e}_{\\theta} + B_{\\phi}(r) \\mathbf{e}_{\\phi}\\right) $$\nUsing the orthogonality of the unit vectors ($\\mathbf{e}_{\\theta} \\cdot \\mathbf{e}_{\\theta} = 1$, $\\mathbf{e}_{\\phi} \\cdot \\mathbf{e}_{\\phi} = 1$, $\\mathbf{e}_{\\theta} \\cdot \\mathbf{e}_{\\phi} = 0$), the expression simplifies to:\n$$ \\mathbf{k} \\cdot \\mathbf{B} = \\frac{m}{r} B_{\\theta}(r) - \\frac{n}{R} B_{\\phi}(r) $$\nThe resonance occurs at a specific radius $r_s$, known as the rational surface radius, where this expression is zero:\n$$ \\frac{m}{r_s} B_{\\theta}(r_s) - \\frac{n}{R} B_{\\phi}(r_s) = 0 $$\nRearranging this equation gives:\n$$ \\frac{m}{r_s} B_{\\theta}(r_s) = \\frac{n}{R} B_{\\phi}(r_s) $$\nTo relate this to the safety factor $q(r)$, we can isolate the ratio of the magnetic field components:\n$$ \\frac{m}{n} = \\frac{r_s B_{\\phi}(r_s)}{R B_{\\theta}(r_s)} $$\nThe right-hand side of this equation is, by definition, the safety factor $q(r)$ evaluated at the radius $r = r_s$. Thus, the general resonance condition for a helical mode with poloidal and toroidal mode numbers $m$ and $n$ is:\n$$ q(r_s) = \\frac{m}{n} $$\n\n**Calculation of the Resonance Radius**\n\nWe are asked to find the resonance radius $r_s$ for the $(m, n)=(2, 1)$ mode in a plasma with the safety factor profile:\n$$ q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2} \\quad \\text{for } 0 \\le r \\le a $$\nApplying the resonance condition for the $(m,n)=(2,1)$ mode:\n$$ q(r_s) = \\frac{m}{n} = \\frac{2}{1} = 2 $$\nWe set the expression for the safety factor profile equal to $2$ and solve for $r_s$:\n$$ 1 + \\left(\\frac{r_s}{a}\\right)^{2} = 2 $$\nSubtracting $1$ from both sides of the equation yields:\n$$ \\left(\\frac{r_s}{a}\\right)^{2} = 1 $$\nTaking the square root of both sides gives:\n$$ \\frac{r_s}{a} = \\pm 1 $$\nSince the radius $r_s$ must be a non-negative physical quantity, we select the positive solution:\n$$ \\frac{r_s}{a} = 1 $$\nTherefore, the resonance radius $r_s$ is equal to the minor radius $a$:\n$$ r_s = a $$\nThis result is physically valid as it falls within the domain $0 \\le r \\le a$ where the $q$-profile is defined. It signifies that the resonant surface for the $(2,1)$ mode is located at the plasma edge.",
            "answer": "$$\\boxed{a}$$"
        },
        {
            "introduction": "Once an instability grows and saturates, it fundamentally alters the magnetic topology, creating a 'magnetic island.' This computational exercise provides a powerful tool—the Poincaré map—to visualize this complex, non-linear helical state . By numerically integrating the Hamiltonian equations of motion for magnetic field lines, you will construct the phase-space portrait of an island, clearly distinguishing between trapped, circulating, and separatrix trajectories.",
            "id": "3990755",
            "problem": "Consider a saturated single-helicity magnetohydrodynamic (MHD) magnetic island near a rational surface in a toroidal device, where the safety factor satisfies $q = m/n$ and the dominant helical perturbation has the phase $\\chi = m \\theta - n \\phi$. In the vicinity of the resonance, model the field-line dynamics on a poloidal cross-section using the canonical coordinates $(\\chi,\\Delta)$ and the integrable, normalized pendulum Hamiltonian\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + 2 W \\sin^2\\!\\left(\\frac{\\chi}{2}\\right),\n$$\nwhere $W \\ge 0$ is the island strength parameter and all angles are in radians. The associated canonical equations are\n$$\n\\frac{d\\chi}{d\\zeta} = \\Delta, \\qquad \\frac{d\\Delta}{d\\zeta} = - W \\sin\\chi,\n$$\nwith $\\zeta$ a dimensionless field-line arclength parameter. A Poincaré map is obtained by stroboscopically sampling the $(\\chi,\\Delta)$ trajectory at fixed increments of $\\zeta$.\n\nYour tasks are:\n- Construct the stroboscopic Poincaré map by numerically integrating the canonical equations and sampling the resulting $(\\chi,\\Delta)$ points every fixed step in $\\zeta$. Use a symplectic scheme to ensure scientific realism in the preservation of area and near-constancy of the Hamiltonian for this integrable system.\n- Derive, from first principles of Hamiltonian dynamics, the invariant curves and their classification into trapped (inside the island), separatrix, and circulating (outside the island) based on the value of $H'(\\Delta,\\chi)$ relative to the separatrix energy.\n- Compute the island half-width and the separatrix lobe area in $(\\chi,\\Delta)$ phase space.\n- For trapped invariant curves with energy $h = H'(\\Delta,\\chi)$ such that $0 \\le h \\le 2W$ and $W  0$, compute the area enclosed by the invariant curve using complete elliptic integrals and report it. For circulating or separatrix initial conditions, report $0$ for this quantity.\n\nImplement a program that:\n1. Uses the symplectic leapfrog method to generate the stroboscopic Poincaré map for a specified number of steps $N$ and step size $\\Delta \\zeta = s$.\n2. Classifies each provided initial condition $(\\Delta_0,\\chi_0)$ by computing $h_0 = H'(\\Delta_0,\\chi_0)$ and comparing it to the separatrix energy $h_{\\mathrm{sep}} = 2W$.\n3. Computes the island half-width $w = 2\\sqrt{W}$ (dimensionless) and the separatrix lobe area $A_{\\mathrm{lobe}} = 8\\sqrt{W}$ (in the canonical phase-space units).\n4. For trapped initial conditions ($h_0  2W$), computes the area enclosed by the corresponding invariant curve\n$$\nA(h_0,W) = 8\\sqrt{W}\\left[ E(m) - \\big(1 - m\\big) K(m) \\right],\n$$\nwhere $m = \\frac{h_0}{2W}$, and $K(m)$ and $E(m)$ are the complete elliptic integrals of the first and second kinds, respectively. For circulating or separatrix initial conditions, report $A(h_0,W) = 0$.\n5. Verifies numerically the invariance of $H'$ along the symplectically integrated trajectory by checking that the maximum deviation of $H'$ from its initial value does not exceed a small tolerance. Report a single boolean per test case indicating whether all provided initial conditions preserve $H'$ within tolerance over the entire stroboscopic integration.\n\nAll angles must be in radians. No physical units are required for any quantity in this problem.\n\nUse the following test suite, which spans a general case, boundary conditions, and edge cases:\n- Test case $1$: $W = 0$, $N = 64$, $s = 1$, initial conditions $(\\Delta_0,\\chi_0)$:\n  - $(0.5,\\frac{\\pi}{2})$,\n  - $(0,0)$,\n  - $(0.1,\\pi)$.\n- Test case $2$: $W = \\frac{1}{16}$, $N = 128$, $s = 1$, initial conditions:\n  - $(0,\\pi)$,\n  - $(0,0)$,\n  - $(1,\\pi)$.\n- Test case $3$: $W = 10^{-6}$, $N = 64$, $s = 1$, initial conditions:\n  - $(0,\\pi)$,\n  - $(0,0)$,\n  - $(0.002,\\frac{\\pi}{2})$.\n- Test case $4$: $W = 1$, $N = 128$, $s = 1$, initial conditions:\n  - $(0,\\pi)$,\n  - $(0,0)$,\n  - $(3,\\frac{\\pi}{3})$.\n\nFor classification, use the following integer encoding: trapped $= 1$, separatrix $= 0$, circulating $= 2$. For the Hamiltonian invariance check, use a tolerance of $10^{-6}$ on the absolute deviation of $H'$ over all stroboscopic steps and initial conditions within a test case.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case must produce a list of the form\n$$\n[w,\\;A_{\\mathrm{lobe}},\\;\\text{areas},\\;\\text{classes},\\;\\text{invariance}],\n$$\nwhere $w$ and $A_{\\mathrm{lobe}}$ are floats, $\\text{areas}$ is a list of floats (one per initial condition), $\\text{classes}$ is a list of integers (one per initial condition), and $\\text{invariance}$ is a boolean. Aggregate the four test case lists into a single top-level list and print it exactly in one line, for example\n$$\n[[w_1,A_{\\mathrm{lobe},1},\\text{areas}_1,\\text{classes}_1,\\text{invariance}_1],\\ldots,[w_4,A_{\\mathrm{lobe},4},\\text{areas}_4,\\text{classes}_4,\\text{invariance}_4]].\n$$",
            "solution": "The problem requires an analysis of the dynamics of a saturated single-helicity magnetohydrodynamic (MHD) magnetic island, modeled by a canonical pendulum Hamiltonian. The solution involves deriving key physical parameters, classifying particle trajectories, implementing a symplectic numerical integration scheme, and applying special functions to compute geometric properties of the phase space.\n\n### 1. Theoretical Framework: The Pendulum Hamiltonian\n\nThe field-line dynamics near a rational surface in a toroidally confined plasma are described by the normalized Hamiltonian:\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + 2 W \\sin^2\\!\\left(\\frac{\\chi}{2}\\right)\n$$\nHere, $(\\chi, \\Delta)$ are canonical coordinates representing the helical angle and a normalized radial coordinate, respectively. $W \\ge 0$ is the island strength parameter, proportional to the squared amplitude of the magnetic perturbation. Using the identity $2\\sin^2(x) = 1 - \\cos(2x)$, the Hamiltonian can be written in the standard pendulum form:\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + W(1 - \\cos\\chi)\n$$\nThis represents a particle of unit mass with momentum $\\Delta$ in a potential $V(\\chi) = W(1 - \\cos\\chi)$. The corresponding canonical equations of motion are:\n$$\n\\frac{d\\chi}{d\\zeta} = \\frac{\\partial H'}{\\partial \\Delta} = \\Delta\n$$\n$$\n\\frac{d\\Delta}{d\\zeta} = -\\frac{\\partial H'}{\\partial \\chi} = -W \\sin\\chi\n$$\nwhere $\\zeta$ is a dimensionless parameter along the field line.\n\n### 2. Invariant Curves and Trajectory Classification\n\nThe Hamiltonian $H'$ is an integral of motion, meaning its value is constant along any given trajectory (field line). These constant-energy contours, $H'(\\Delta,\\chi) = h$, are the invariant curves of the system. The topology of these curves depends on the energy level $h$ relative to the energy of the separatrix.\n\nThe potential energy $V(\\chi)$ has stable fixed points at $\\chi = 2k\\pi$ (where $V=0$) and unstable fixed points at $\\chi = (2k+1)\\pi$ (where $V=2W$), for integer $k$. The trajectory passing through the unstable fixed point $(\\Delta, \\chi) = (0, \\pi)$ is the separatrix. Its energy is:\n$$\nh_{\\mathrm{sep}} = H'(0, \\pi) = \\frac{1}{2}(0)^2 + 2 W \\sin^2\\left(\\frac{\\pi}{2}\\right) = 2W\n$$\n\nThe trajectories are classified based on their energy $h_0 = H'(\\Delta_0, \\chi_0)$:\n- **Trapped (inside island)**: $0 \\le h_0  2W$. These trajectories are confined in the potential well, oscillating around the stable fixed point $(\\Delta, \\chi) = (0, 0)$. In phase space, they form closed loops centered at the origin.\n- **Separatrix**: $h_0 = 2W$. This special trajectory separates the trapped and circulating regions. It defines the boundary of the magnetic island.\n- **Circulating (outside island)**: $h_0  2W$. These trajectories are not confined in the potential well; the angle $\\chi$ increases or decreases without bound.\n\n### 3. Island Half-Width and Separatrix Area\n\nThe **island half-width**, denoted $w$, is the maximum extent of the separatrix in the $\\Delta$ coordinate. This occurs at $\\chi = 0$, where the potential energy is minimum. On the separatrix, $H'=2W$:\n$$\n\\frac{1}{2}\\Delta_{\\mathrm{max}}^2 + 2W\\sin^2(0) = 2W \\implies \\frac{1}{2}\\Delta_{\\mathrm{max}}^2 = 2W \\implies \\Delta_{\\mathrm{max}} = \\pm 2\\sqrt{W}\n$$\nThus, the half-width is $w = 2\\sqrt{W}$.\n\nThe **separatrix lobe area**, $A_{\\mathrm{lobe}}$, is the area enclosed by one of the two lobes of the separatrix (e.g., for $\\Delta  0$). It is calculated by the phase space integral $\\oint \\Delta \\,d\\chi$.\n$$\n\\Delta(\\chi) = \\sqrt{2(h_{\\mathrm{sep}} - V(\\chi))} = \\sqrt{2(2W - W(1-\\cos\\chi))} = \\sqrt{2W(1+\\cos\\chi)} = 2\\sqrt{W}|\\cos(\\chi/2)|\n$$\nIntegrating over one full period of the island from $\\chi=-\\pi$ to $\\chi=\\pi$:\n$$\nA_{\\mathrm{lobe}} = \\int_{-\\pi}^{\\pi} 2\\sqrt{W}\\cos(\\chi/2) \\, d\\chi = 2\\sqrt{W} \\left[2\\sin(\\chi/2)\\right]_{-\\pi}^{\\pi} = 4\\sqrt{W}(1 - (-1)) = 8\\sqrt{W}\n$$\n\n### 4. Area Enclosed by Trapped Trajectories\n\nFor a trapped trajectory with energy $h_0  2W$, the enclosed area $A(h_0, W)$ is also given by the action integral $\\oint \\Delta \\,d\\chi$. This integral can be evaluated in terms of the complete elliptic integrals of the first kind, $K(m)$, and second kind, $E(m)$. The result, provided in the problem, is a standard one from classical mechanics for pendulum-like motion:\n$$\nA(h_0,W) = 8\\sqrt{W}\\left[ E(m) - \\big(1 - m\\big) K(m) \\right]\n$$\nwhere $m = h_0 / (2W) = h_0 / h_{\\mathrm{sep}}$ is the normalized energy, satisfying $0 \\le m  1$. For circulating or separatrix trajectories ($m \\ge 1$), the concept of a finite enclosed area is not applicable in the same way, and the area is reported as $0$. The case $W=0$ results in $h_{\\mathrm{sep}}=0$; since $H' \\ge 0$, no trajectories are trapped ($h_0  0$), so the area is always $0$.\n\n### 5. Algorithmic Design: Symplectic Integration\n\nTo generate the Poincaré map, the canonical equations must be integrated numerically. Since this is a Hamiltonian system, a symplectic integrator is required to preserve the phase space volume and ensure the numerical trajectory stays close to the true constant-energy surface over long times. The leapfrog (or Störmer-Verlet) method is a simple and effective second-order symplectic scheme. For the given first-order system, it can be implemented as follows, with step size $s = \\Delta\\zeta$:\n\n1.  **Kick (half-step)**: Update momentum $\\Delta$ using the force at the current position $\\chi_n$.\n    $$ \\Delta_{n+1/2} = \\Delta_n + \\frac{s}{2} F(\\chi_n) = \\Delta_n - \\frac{s}{2}W\\sin\\chi_n $$\n2.  **Drift (full-step)**: Update position $\\chi$ using the new momentum $\\Delta_{n+1/2}$.\n    $$ \\chi_{n+1} = \\chi_n + s \\cdot \\Delta_{n+1/2} $$\n3.  **Kick (half-step)**: Update momentum $\\Delta$ again using the force at the new position $\\chi_{n+1}$.\n    $$ \\Delta_{n+1} = \\Delta_{n+1/2} + \\frac{s}{2} F(\\chi_{n+1}) = \\Delta_{n+1/2} - \\frac{s}{2}W\\sin\\chi_{n+1} $$\n\nThis method guarantees near-perfect conservation of the Hamiltonian $H'$ over many steps, which is numerically verified by checking that the maximum deviation $|H'(\\Delta_k, \\chi_k) - H'(\\Delta_0, \\chi_0)|$ remains below a small tolerance of $10^{-6}$.\n\n### 6. Implementation Summary\n\nThe solution is implemented as a Python program that processes each test case in sequence.\n1.  For a given $W$, the island half-width $w$ and separatrix lobe area $A_{\\mathrm{lobe}}$ are computed using the derived formulas.\n2.  For each initial condition $(\\Delta_0, \\chi_0)$:\n    a. The initial energy $h_0 = H'(\\Delta_0, \\chi_0)$ is calculated.\n    b. The trajectory is classified as trapped (1), separatrix (0), or circulating (2) by comparing $h_0$ to $h_{\\mathrm{sep}} = 2W$. A small numerical tolerance is used for the separatrix equality check.\n    c. If the trajectory is trapped and $W0$, the enclosed area $A(h_0,W)$ is computed using the elliptic integral formula, relying on `scipy.special.ellipk` and `scipy.special.ellipe`. Otherwise, the area is $0$.\n3.  The Hamiltonian invariance is checked by running the leapfrog integrator for $N$ steps for all initial conditions in a test case and tracking the maximum absolute deviation of $H'$ from its initial value.\n4.  The results for each test case—$[w, A_{\\mathrm{lobe}}, \\text{areas}, \\text{classes}, \\text{invariance}]$—are collected and formatted into a single-line string as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\n\ndef solve():\n    \"\"\"\n    Solves the MHD magnetic island problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"W\": 0.0, \"N\": 64, \"s\": 1.0,\n            \"ics\": [(0.5, np.pi/2), (0.0, 0.0), (0.1, np.pi)]\n        },\n        {\n            \"W\": 1.0/16.0, \"N\": 128, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (1.0, np.pi)]\n        },\n        {\n            \"W\": 1e-6, \"N\": 64, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (0.002, np.pi/2)]\n        },\n        {\n            \"W\": 1.0, \"N\": 128, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (3.0, np.pi/3)]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_test_case(case[\"W\"], case[\"N\"], case[\"s\"], case[\"ics\"])\n        all_results.append(result)\n\n    # Format the final output string according to the problem specification\n    # (a list of lists, printed on a single line, with no extra spaces).\n    outer_list_str = []\n    for res in all_results:\n        w, A_lobe, areas, classes, invariance = res\n        \n        # Format lists of numbers with controlled precision and no spaces\n        areas_str = f\"[{','.join(f'{a:.8g}' for a in areas)}]\"\n        classes_str = f\"[{','.join(map(str, classes))}]\"\n        \n        # Format boolean as lowercase 'true' or 'false'\n        invariance_str = str(invariance).lower()\n        \n        inner_list_str = f\"[{w:.8g},{A_lobe:.8g},{areas_str},{classes_str},{invariance_str}]\"\n        outer_list_str.append(inner_list_str)\n\n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\ndef hamiltonian(delta, chi, W):\n    \"\"\"Computes the normalized pendulum Hamiltonian.\"\"\"\n    return 0.5 * delta**2 + 2.0 * W * np.sin(chi / 2.0)**2\n\ndef leapfrog_step(delta, chi, W, s):\n    \"\"\"Performs a single step of the symplectic leapfrog integrator.\"\"\"\n    # Kick (half-step for momentum)\n    delta_half = delta - (s / 2.0) * W * np.sin(chi)\n    # Drift (full-step for position)\n    chi_next = chi + s * delta_half\n    # Kick (half-step for momentum)\n    delta_next = delta_half - (s / 2.0) * W * np.sin(chi_next)\n    return delta_next, chi_next\n\ndef process_test_case(W, N, s, initial_conditions):\n    \"\"\"\n    Processes a single test case, calculating all required quantities.\n    \"\"\"\n    # Calculate island half-width and separatrix lobe area\n    if W == 0.0:\n        w = 0.0\n        A_lobe = 0.0\n    else:\n        w = 2.0 * np.sqrt(W)\n        A_lobe = 8.0 * np.sqrt(W)\n        \n    h_sep = 2.0 * W\n    \n    areas = []\n    classes = []\n    max_total_h_deviation = 0.0\n    \n    for delta_0, chi_0 in initial_conditions:\n        # 1. Calculate initial energy and classify trajectory\n        h_0 = hamiltonian(delta_0, chi_0, W)\n        \n        if np.isclose(h_0, h_sep, atol=1e-12, rtol=0):\n            cls = 0  # separatrix\n        elif h_0  h_sep:\n            cls = 1  # trapped\n        else:  # h_0  h_sep\n            cls = 2  # circulating\n        classes.append(cls)\n        \n        # 2. Calculate enclosed area for trapped particles\n        area = 0.0\n        if cls == 1 and W  0:\n            m = h_0 / h_sep\n            # Ensure m is strictly less than 1 for ellipk\n            m = min(m, 1.0 - 1e-15) \n            K_m = ellipk(m)\n            E_m = ellipe(m)\n            area = 8.0 * np.sqrt(W) * (E_m - (1.0 - m) * K_m)\n        areas.append(area)\n\n        # 3. Perform numerical integration to check Hamiltonian invariance\n        delta, chi = delta_0, chi_0\n        max_h_dev_for_ic = 0.0\n        for _ in range(N):\n            delta, chi = leapfrog_step(delta, chi, W, s)\n            h_current = hamiltonian(delta, chi, W)\n            max_h_dev_for_ic = max(max_h_dev_for_ic, abs(h_current - h_0))\n            \n        max_total_h_deviation = max(max_total_h_deviation, max_h_dev_for_ic)\n\n    invariance_tolerance = 1e-6\n    invariance = max_total_h_deviation = invariance_tolerance\n    \n    return [w, A_lobe, areas, classes, invariance]\n\nsolve()\n```"
        },
        {
            "introduction": "In experimental settings, magnetic islands are not static; they rotate. This rotation is governed by subtle two-fluid effects, such as the electron diamagnetic drift. This final practice challenges you to derive the electron diamagnetic drift frequency, $\\omega_{*e}$, from first principles and compare it to a given island rotation frequency, providing a direct link between kinetic-scale physics and macroscopic MHD phenomena .",
            "id": "3990687",
            "problem": "Consider a large-aspect-ratio tokamak with circular flux surfaces. A saturated helical magnetohydrodynamic (MHD) magnetic island in a steady state resides at the rational surface of the safety factor with poloidal/toroidal mode numbers $m/n = 3/2$ at minor radius $r_s = 0.60\\ \\mathrm{m}$. Near the rational surface, adopt a local slab model with $\\mathbf{B} = B\\,\\hat{\\mathbf{z}}$, $B = 2.4\\ \\mathrm{T}$, and a density profile $n(x)$ that decreases radially outward with scale length $L_n = 0.18\\ \\mathrm{m}$ so that $\\nabla n = -\\hat{\\mathbf{x}}\\,n/L_n$. Let the coordinate $\\hat{\\mathbf{y}}$ be chosen in the electron diamagnetic drift direction. The poloidal wavenumber is approximated by $k_y = m/r_s$. The electron temperature is $T_e = 2.0\\ \\mathrm{keV}$. The measured saturated island rotation frequency is $\\omega_I = 1.40 \\times 10^{4}\\ \\mathrm{rad/s}$ in the electron diamagnetic direction.\n\nUsing first principles of drift-ordered magnetized plasma dynamics to obtain the electron diamagnetic drift from the electron pressure-gradient force and the definition of angular frequency as the phase advection rate of a plane wave, derive the signed electron diamagnetic drift frequency $\\omega_{*e}$ appropriate to this local slab geometry. Evaluate $\\omega_{*e}$ numerically in $\\mathrm{rad/s}$ for the given parameters. Then compute the signed dimensionless ratio $\\mathcal{R} = \\omega_{*e}/\\omega_I$. Round your final ratio to four significant figures. Express only this final ratio as your answer; no units.",
            "solution": "The problem is valid as it is scientifically grounded in established principles of plasma physics, is well-posed with sufficient and consistent data, and is expressed in objective, formal language. We proceed with the solution.\n\nThe problem requires the derivation of the electron diamagnetic drift frequency, $\\omega_{*e}$, from first principles. We begin with the electron fluid momentum equation in the drift approximation, where inertia is neglected. In a steady state and in the absence of an electric field, the Lorentz force balances the electron pressure gradient force:\n$$-\\nabla p_e - e n_e (\\mathbf{v}_e \\times \\mathbf{B}) = \\mathbf{0}$$\nHere, $p_e$ is the electron pressure, $n_e$ is the electron number density, $e$ is the elementary charge, $\\mathbf{v}_e$ is the electron fluid velocity, and $\\mathbf{B}$ is the magnetic field. The velocity $\\mathbf{v}_e$ in this context is the electron diamagnetic drift velocity, denoted $\\mathbf{v}_{de}$. The equation is thus:\n$$\\nabla p_e = -e n_e (\\mathbf{v}_{de} \\times \\mathbf{B})$$\nTo solve for $\\mathbf{v}_{de}$, which is perpendicular to $\\mathbf{B}$, we take the cross product of this equation with $\\mathbf{B}$:\n$$\\nabla p_e \\times \\mathbf{B} = -e n_e ((\\mathbf{v}_{de} \\times \\mathbf{B}) \\times \\mathbf{B})$$\nUsing the vector triple product identity $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$ and the fact that $\\mathbf{v}_{de}$ is perpendicular to $\\mathbf{B}$ (i.e., $\\mathbf{v}_{de} \\cdot \\mathbf{B} = 0$), the right-hand side simplifies:\n$$(\\mathbf{v}_{de} \\times \\mathbf{B}) \\times \\mathbf{B} = \\mathbf{B}(\\mathbf{v}_{de} \\cdot \\mathbf{B}) - \\mathbf{v}_{de}(\\mathbf{B} \\cdot \\mathbf{B}) = -B^2 \\mathbf{v}_{de}$$\nSubstituting this back, we get:\n$$\\nabla p_e \\times \\mathbf{B} = -e n_e (-B^2 \\mathbf{v}_{de}) = e n_e B^2 \\mathbf{v}_{de}$$\nSolving for $\\mathbf{v}_{de}$ yields the general expression for the electron diamagnetic drift velocity:\n$$\\mathbf{v}_{de} = \\frac{\\nabla p_e \\times \\mathbf{B}}{e n_e B^2}$$\nNow, we apply the parameters given for the local slab model. The magnetic field is $\\mathbf{B} = B \\hat{\\mathbf{z}}$, where $B = 2.4\\ \\mathrm{T}$. The electron pressure is $p_e = n_e T_e$. Assuming the electron temperature $T_e$ is constant near the rational surface, the pressure gradient is dominated by the density gradient:\n$$\\nabla p_e = T_e \\nabla n_e$$\nThe problem states that the density profile $n(x)$ gives a gradient $\\nabla n = -\\hat{\\mathbf{x}}\\,n/L_n$, where $L_n = 0.18\\ \\mathrm{m}$ is the density scale length. Using $n_e \\equiv n$, the pressure gradient is:\n$$\\nabla p_e = -T_e \\frac{n_e}{L_n} \\hat{\\mathbf{x}}$$\nWe now compute the cross product $\\nabla p_e \\times \\mathbf{B}$:\n$$\\nabla p_e \\times \\mathbf{B} = \\left(-T_e \\frac{n_e}{L_n} \\hat{\\mathbf{x}}\\right) \\times (B \\hat{\\mathbf{z}}) = -T_e \\frac{n_e B}{L_n} (\\hat{\\mathbf{x}} \\times \\hat{\\mathbf{z}})$$\nFor a right-handed coordinate system, $\\hat{\\mathbf{x}} \\times \\hat{\\mathbf{z}} = -\\hat{\\mathbf{y}}$. Therefore:\n$$\\nabla p_e \\times \\mathbf{B} = -T_e \\frac{n_e B}{L_n} (-\\hat{\\mathbf{y}}) = T_e \\frac{n_e B}{L_n} \\hat{\\mathbf{y}}$$\nSubstituting this result into the expression for $\\mathbf{v}_{de}$:\n$$\\mathbf{v}_{de} = \\frac{T_e \\frac{n_e B}{L_n} \\hat{\\mathbf{y}}}{e n_e B^2} = \\frac{T_e}{e B L_n} \\hat{\\mathbf{y}}$$\nThe positive sign confirms that the drift is in the $+\\hat{\\mathbf{y}}$ direction, which is consistent with the problem statement that $\\hat{\\mathbf{y}}$ is chosen to be in the electron diamagnetic drift direction.\n\nThe electron diamagnetic drift frequency, $\\omega_{*e}$, is defined as the Doppler shift caused by the diamagnetic drift acting on a wave with wavevector $\\mathbf{k}$. For a plane wave, this is $\\omega_{*e} = \\mathbf{k} \\cdot \\mathbf{v}_{de}$. The MHD mode has poloidal mode number $m$, which in the local slab model corresponds to a wavevector $\\mathbf{k} = k_y \\hat{\\mathbf{y}}$ with $k_y = m/r_s$.\n$$\\omega_{*e} = (k_y \\hat{\\mathbf{y}}) \\cdot \\left(\\frac{T_e}{e B L_n} \\hat{\\mathbf{y}}\\right) = \\frac{k_y T_e}{e B L_n}$$\nSince all quantities on the right-hand side are positive ($k_y > 0$), the signed frequency $\\omega_{*e}$ is positive. This is consistent with the measured island rotation frequency $\\omega_I$ being in the electron diamagnetic direction, which is assigned a positive value.\n\nWe now evaluate $\\omega_{*e}$ numerically using the given values:\nMode number: $m = 3$\nRational surface radius: $r_s = 0.60\\ \\mathrm{m}$\nElectron temperature: $T_e = 2.0\\ \\mathrm{keV} = 2.0 \\times 10^3\\ \\mathrm{eV}$\nMagnetic field: $B = 2.4\\ \\mathrm{T}$\nDensity scale length: $L_n = 0.18\\ \\mathrm{m}$\n\nFirst, we calculate the poloidal wavenumber $k_y$:\n$$k_y = \\frac{m}{r_s} = \\frac{3}{0.60\\ \\mathrm{m}} = 5.0\\ \\mathrm{m}^{-1}$$\nNext, we calculate $\\omega_{*e}$. We must use consistent SI units. The temperature $T_e$ in Joules is related to its value in electron-volts, $T_{e, \\text{eV}}$, by $T_e = T_{e, \\text{eV}} \\cdot e$, where $e$ is the elementary charge.\n$$\\omega_{*e} = \\frac{k_y (T_{e, \\text{eV}} \\cdot e)}{e B L_n} = \\frac{k_y T_{e, \\text{eV}}}{B L_n}$$\nThe elementary charge $e$ cancels, simplifying the calculation. Substituting the numerical values:\n$$\\omega_{*e} = \\frac{(5.0\\ \\mathrm{m}^{-1})(2.0 \\times 10^3\\ \\mathrm{eV})}{(2.4\\ \\mathrm{T})(0.18\\ \\mathrm{m})} = \\frac{10000}{0.432}\\ \\mathrm{rad/s} \\approx 23148.148\\ \\mathrm{rad/s}$$\nThe result has units of $\\mathrm{s}^{-1}$ (or $\\mathrm{rad/s}$), as required for an angular frequency.\n\nFinally, we compute the dimensionless ratio $\\mathcal{R} = \\omega_{*e}/\\omega_I$. The given saturated island rotation frequency is $\\omega_I = 1.40 \\times 10^4\\ \\mathrm{rad/s}$.\n$$\\mathcal{R} = \\frac{\\omega_{*e}}{\\omega_I} = \\frac{23148.148... \\ \\mathrm{rad/s}}{1.40 \\times 10^4\\ \\mathrm{rad/s}} \\approx 1.653439...$$\nRounding the result to four significant figures, as requested:\n$$\\mathcal{R} \\approx 1.653$$",
            "answer": "$$\\boxed{1.653}$$"
        }
    ]
}