{
    "hands_on_practices": [
        {
            "introduction": "Our exploration of error fields begins at their source: the engineering imperfections in the magnetic confinement system. This practice provides a foundational, hands-on experience in calculating the vacuum error field spectrum that a plasma would experience. By implementing the Biot-Savart law for a set of misaligned coils and then performing a spatial Fourier decomposition, you will learn to translate tangible physical displacements into the language of resonant magnetic perturbations, which is the first essential step in predicting their impact .",
            "id": "3976851",
            "problem": "You are asked to build a complete program that computes the vacuum error-field spectrum in cylindrical geometry from misaligned filamentary coils using the Biot–Savart law, and then identifies the dominant resonant harmonics at a specified plasma radius. The program must implement the following specification and produce results for a fixed test suite.\n\nBegin from the fundamental law for the magnetic field produced by a thin current-carrying wire, the Biot–Savart law:\n$$\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0}{4\\pi} \\oint I \\frac{d\\boldsymbol{\\ell} \\times (\\mathbf{r} - \\mathbf{r'})}{\\lVert \\mathbf{r} - \\mathbf{r'} \\rVert^3},$$\nwhere $\\mu_0$ is the vacuum permeability, $I$ is the current, $d\\boldsymbol{\\ell}$ is the vector line element along the filament, $\\mathbf{r'}$ is the source position on the filament, and $\\mathbf{r}$ is the field evaluation point. Use cylindrical geometry with the axis of symmetry along the $z$ axis and define cylindrical coordinates $(r,\\theta,z)$ with the radial unit vector\n$$\\hat{\\mathbf{e}}_r(\\theta) = [\\cos\\theta, \\sin\\theta, 0].$$\n\nModel each coil as a thin circular loop of radius $a$ lying in a plane perpendicular to the $z$ axis. For a coil with nominal center radius $R_0$, nominal poloidal angle $\\theta_c$, and axial position $z_c$, include misalignments $\\delta r$, $\\delta \\theta$, and $\\delta z$ so that the actual center coordinates are\n$$r_{\\text{center}} = R_0 + \\delta r, \\quad \\theta_{\\text{center}} = \\theta_c + \\delta \\theta, \\quad z_{\\text{center}} = z_c + \\delta z.$$\nThe Cartesian coordinates of the coil center are\n$$x_c = r_{\\text{center}} \\cos\\theta_{\\text{center}}, \\quad y_c = r_{\\text{center}} \\sin\\theta_{\\text{center}}, \\quad z_c' = z_{\\text{center}}.$$\nParameterize the loop by an angle $\\phi \\in [0, 2\\pi)$ with points\n$$\\mathbf{r'}(\\phi) = [x_c + a \\cos\\phi, \\; y_c + a \\sin\\phi, \\; z_c'],$$\nand tangent element\n$$d\\boldsymbol{\\ell} = a[-\\sin\\phi, \\cos\\phi, 0]\\, d\\phi.$$\nApproximate the Biot–Savart integral by discretizing $\\phi$ into $N_{\\phi}$ uniform segments and summing contributions.\n\nAt a fixed plasma radius $r_{\\text{eval}}$, compute the radial magnetic field component\n$$B_r(r_{\\text{eval}}, \\theta, z) = \\mathbf{B}(\\mathbf{r}) \\cdot \\hat{\\mathbf{e}}_r(\\theta), \\quad \\mathbf{r} = [r_{\\text{eval}}\\cos\\theta, \\; r_{\\text{eval}}\\sin\\theta, \\; z].$$\nConstruct the two-dimensional spectrum by discrete Fourier coefficients over a uniform grid in $(\\theta, z)$ with $N_{\\theta}$ and $N_z$ points, respectively. For poloidal mode number $m$ and axial (toroidal-substitute) mode number $n$, define the amplitude\n$$b_r^{m/n}(r_{\\text{eval}}) = \\left| \\frac{1}{N_{\\theta} N_z} \\sum_{j=0}^{N_{\\theta}-1} \\sum_{k=0}^{N_z-1} B_r(r_{\\text{eval}}, \\theta_j, z_k)\\, e^{-i(m \\theta_j - k_n z_k)} \\right|,$$\nwhere $k_n = \\frac{2\\pi n}{L_z}$, $\\theta_j = \\frac{2\\pi j}{N_{\\theta}}$, and $z_k = \\frac{L_z k}{N_z}$. Use radians for all angles.\n\nFor resonance identification, use the magnetic safety factor $q(r)$ and the standard cylindrical resonance condition in the form\n$$\\left| m - n\\, q(r_{\\text{eval}}) \\right| \\le \\delta,$$\nwith a specified tolerance $\\delta$. Among all mode pairs $(m,n)$ in a provided set that satisfy the resonance criterion, identify the pair with the largest $b_r^{m/n}(r_{\\text{eval}})$ and report it as the dominant resonant harmonic. If no pair satisfies the criterion, return $[0, 0, 0.0]$.\n\nAll distances must be treated in meters, currents in Amperes, magnetic field in Tesla, and angles in radians. Your program must round each reported amplitude to $8$ decimal places. The vacuum permeability is $\\mu_0 = 4\\pi \\times 10^{-7}$ (in $\\text{N}\\cdot\\text{A}^{-2}$), so $\\mu_0/(4\\pi) = 10^{-7}$.\n\nImplement the computation specified above and produce results for the following test suite. For all cases, use $N_{\\phi} = 120$ segments per coil loop, $N_{\\theta} = 32$, and $N_z = 32$.\n\nTest Case A (general multi-coil configuration with small misalignments):\n- Coil parameters: $N_{\\text{coils}} = 6$ coils, each with current $I = 5000$ (A), loop radius $a = 0.08$ (m), nominal center radius $R_0 = 1.2$ (m).\n- Axial periodic length: $L_z = 6.0$ (m).\n- Plasma evaluation radius: $r_{\\text{eval}} = 1.0$ (m).\n- Coil nominal positions: poloidal angles $\\theta_c^k = \\frac{2\\pi k}{6}$ for $k = 0,1,2,3,4,5$, axial positions $z_c^k = \\frac{L_z k}{6}$.\n- Misalignments:\n  - $\\delta r$ list (m): $[0.005, -0.003, 0.004, -0.002, 0.0, 0.006]$,\n  - $\\delta \\theta$ list (rad): $[0.01, -0.015, 0.02, -0.005, 0.0, 0.012]$,\n  - $\\delta z$ list (m): $[0.02, -0.01, 0.0, 0.015, -0.02, 0.005]$.\n- Spectrum evaluation sets: $m \\in \\{1,2,3\\}$, $n \\in \\{1,2\\}$.\n- Safety factor: $q(r_{\\text{eval}}) = 1.5$ (dimensionless), tolerance $\\delta = 0.05$.\n\nTest Case B (symmetric cancellation scenario):\n- Coil parameters: $N_{\\text{coils}} = 2$ coils with currents $I_1 = 5000$ (A) and $I_2 = -5000$ (A), loop radius $a = 0.08$ (m), nominal center radius $R_0 = 1.2$ (m).\n- Axial periodic length: $L_z = 4.0$ (m).\n- Plasma evaluation radius: $r_{\\text{eval}} = 1.0$ (m).\n- Coil nominal positions: $(\\theta_c^1, z_c^1) = (0, 0)$, $(\\theta_c^2, z_c^2) = (\\pi, L_z/2)$.\n- Misalignments: all zero, i.e., $\\delta r = 0$ (m), $\\delta \\theta = 0$ (rad), $\\delta z = 0$ (m) for both coils.\n- Spectrum evaluation sets: $m \\in \\{1,2\\}$, $n \\in \\{1\\}$.\n- Safety factor: $q(r_{\\text{eval}}) = 2.0$ (dimensionless), tolerance $\\delta = 0.02$.\n\nTest Case C (single misaligned coil producing a strong low-order harmonic):\n- Coil parameters: $N_{\\text{coils}} = 1$ coil with current $I = 8000$ (A), loop radius $a = 0.10$ (m), nominal center radius $R_0 = 1.25$ (m).\n- Axial periodic length: $L_z = 5.0$ (m).\n- Plasma evaluation radius: $r_{\\text{eval}} = 0.9$ (m).\n- Coil nominal position: $(\\theta_c, z_c) = (\\pi/4, L_z/3)$.\n- Misalignments: $\\delta r = 0.02$ (m), $\\delta \\theta = 0.05$ (rad), $\\delta z = -0.03$ (m).\n- Spectrum evaluation sets: $m \\in \\{1,2,3,4\\}$, $n \\in \\{1,2,3\\}$.\n- Safety factor: $q(r_{\\text{eval}}) = 1.0$ (dimensionless), tolerance $\\delta = 0.10$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is a three-element list `[m, n, b]` with $m$ and $n$ integers and $b$ the dominant resonant amplitude $b_r^{m/n}(r_{\\text{eval}})$ in Tesla rounded to $8$ decimal places. For example, the output format must be\n$$`[\\[m_1,n_1,b_1],\\,[m_2,n_2,b_2],\\,[m_3,n_3,b_3]\\]`.$$",
            "solution": "The problem requires the computation of the vacuum error-field spectrum from a set of misaligned filamentary coils in cylindrical geometry. The solution proceeds by first calculating the magnetic field using a numerical approximation of the Biot–Savart law, then performing a two-dimensional Fourier analysis on the radial component of this field, and finally identifying the dominant resonant harmonic based on a given safety factor $q$.\n\nThe foundational principle is the Biot–Savart law, which gives the magnetic field $\\mathbf{B}$ at a position $\\mathbf{r}$ due to a current $I$ flowing along a path $\\mathcal{C}$:\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0}{4\\pi} \\int_{\\mathcal{C}} I \\frac{d\\boldsymbol{\\ell} \\times (\\mathbf{r} - \\mathbf{r'})}{\\lVert \\mathbf{r} - \\mathbf{r'} \\rVert^3}\n$$\nHere, $\\mu_0$ is the vacuum permeability, $d\\boldsymbol{\\ell}$ is an infinitesimal vector element of the path at source position $\\mathbf{r'}$, and $\\mathbf{r}$ is the field evaluation point. The constant factor is given as $\\frac{\\mu_0}{4\\pi} = 10^{-7} \\, \\text{T}\\cdot\\text{m}/\\text{A}$.\n\nEach coil is modeled as a circular loop of radius $a$. A coil with nominal center radius $R_0$, poloidal angle $\\theta_c$, and axial position $z_c$ is subject to misalignments $\\delta r$, $\\delta \\theta$, and $\\delta z$. The actual Cartesian coordinates of the coil's center $(x_c, y_c, z_c')$ are determined as:\n$$\n\\begin{aligned}\nr_{\\text{center}} &= R_0 + \\delta r \\\\\n\\theta_{\\text{center}} &= \\theta_c + \\delta \\theta \\\\\nz_{\\text{center}} &= z_c + \\delta z \\\\\nx_c &= r_{\\text{center}} \\cos(\\theta_{\\text{center}}) \\\\\ny_c &= r_{\\text{center}} \\sin(\\theta_{\\text{center}}) \\\\\nz_c' &= z_{\\text{center}}\n\\end{aligned}\n$$\nThe source points $\\mathbf{r'}$ on the coil filament are parameterized by an angle $\\phi \\in [0, 2\\pi)$:\n$$\n\\mathbf{r'}(\\phi) = [x_c + a \\cos\\phi, \\; y_c + a \\sin\\phi, \\; z_c']\n$$\nThe integral in the Biot–Savart law is approximated by a discrete sum over $N_{\\phi}$ segments. We discretize the angle $\\phi$ into $N_{\\phi}$ points $\\phi_i = \\frac{2\\pi i}{N_{\\phi}}$ for $i = 0, \\dots, N_{\\phi}-1$, with step size $\\Delta\\phi = \\frac{2\\pi}{N_{\\phi}}$. The differential line element $d\\boldsymbol{\\ell}$ is approximated by a finite vector $\\Delta\\boldsymbol{\\ell}_i$ for each segment:\n$$\n\\Delta\\boldsymbol{\\ell}_i = \\frac{d\\mathbf{r'}}{d\\phi}\\bigg|_{\\phi_i} \\Delta\\phi = a[-\\sin\\phi_i, \\cos\\phi_i, 0] \\Delta\\phi\n$$\nThe magnetic field from a single coil is then the sum of contributions from all segments:\n$$\n\\mathbf{B}(\\mathbf{r}) \\approx \\frac{\\mu_0 I}{4\\pi} \\sum_{i=0}^{N_{\\phi}-1} \\frac{\\Delta\\boldsymbol{\\ell}_i \\times (\\mathbf{r} - \\mathbf{r'}(\\phi_i))}{\\lVert \\mathbf{r} - \\mathbf{r'}(\\phi_i) \\rVert^3}\n$$\nThe total magnetic field is the vector sum of the fields produced by each of the $N_{\\text{coils}}$ coils.\n\nThe field is evaluated on a two-dimensional grid in $(\\theta, z)$ at a fixed evaluation radius $r_{\\text{eval}}$. The grid points are $(\\theta_j, z_k)$, where $\\theta_j = \\frac{2\\pi j}{N_{\\theta}}$ for $j=0, \\dots, N_{\\theta}-1$ and $z_k = \\frac{L_z k}{N_z}$ for $k=0, \\dots, N_z-1$. The Cartesian coordinates for each field evaluation point $\\mathbf{r}_{jk}$ are:\n$$\n\\mathbf{r}_{jk} = [r_{\\text{eval}}\\cos\\theta_j, \\; r_{\\text{eval}}\\sin\\theta_j, \\; z_k]\n$$\nAt each point $\\mathbf{r}_{jk}$, we compute the total magnetic field vector $\\mathbf{B}(\\mathbf{r}_{jk})$. Subsequently, we project this vector onto the local radial unit vector $\\hat{\\mathbf{e}}_r(\\theta_j) = [\\cos\\theta_j, \\sin\\theta_j, 0]$ to obtain the radial field component:\n$$\nB_r(r_{\\text{eval}}, \\theta_j, z_k) = \\mathbf{B}(\\mathbf{r}_{jk}) \\cdot \\hat{\\mathbf{e}}_r(\\theta_j)\n$$\nThis results in a $N_{\\theta} \\times N_z$ matrix of radial field values.\n\nWith the radial field map $B_r(\\theta_j, z_k)$ constructed, we compute its two-dimensional discrete Fourier spectrum. For a specified poloidal mode number $m$ and axial (toroidal-substitute) mode number $n$, the complex amplitude is given by the discrete Fourier transform:\n$$\nc_r^{m/n} = \\frac{1}{N_{\\theta} N_z} \\sum_{j=0}^{N_{\\theta}-1} \\sum_{k=0}^{N_z-1} B_r(r_{\\text{eval}}, \\theta_j, z_k)\\, e^{-i(m \\theta_j - k_n z_k)}\n$$\nwhere $k_n = \\frac{2\\pi n}{L_z}$ is the axial wavenumber. The real-valued amplitude of the mode is the magnitude of this complex coefficient: $b_r^{m/n} = |c_r^{m/n}|$.\n\nFinally, we identify the dominant resonant harmonic. A mode $(m, n)$ is considered resonant if it satisfies the condition:\n$$\n|m - n \\, q(r_{\\text{eval}})| \\le \\delta\n$$\nwhere $q(r_{\\text{eval}})$ is the magnetic safety factor at the evaluation radius and $\\delta$ is a specified tolerance. We evaluate this condition for all pairs $(m, n)$ in the provided set. Among those that satisfy the resonance condition, the one with the largest amplitude $b_r^{m/n}$ is selected as the dominant resonant harmonic. Its mode numbers $(m, n)$ and rounded amplitude are reported. If no modes in the set are resonant, a default value of $[0, 0, 0.0]$ is returned. The entire procedure is implemented using vectorized computations with NumPy for efficiency.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute results.\n    \"\"\"\n    \n    # Global numerical parameters\n    N_PHI = 120\n    N_THETA = 32\n    N_Z = 32\n    MU0_4PI = 1e-7\n\n    test_cases = [\n        # Test Case A\n        {\n            \"coils\": [\n                {\n                    \"I\": 5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": (2 * np.pi * k) / 6,\n                    \"z_c\": (6.0 * k) / 6,\n                    \"misalignments\": [\n                        [0.005, -0.003, 0.004, -0.002, 0.0, 0.006][k],\n                        [0.01, -0.015, 0.02, -0.005, 0.0, 0.012][k],\n                        [0.02, -0.01, 0.0, 0.015, -0.02, 0.005][k]\n                    ]\n                } for k in range(6)\n            ],\n            \"L_z\": 6.0, \"r_eval\": 1.0,\n            \"mode_set\": [(m, n) for m in [1, 2, 3] for n in [1, 2]],\n            \"q_eval\": 1.5, \"delta\": 0.05\n        },\n        # Test Case B\n        {\n            \"coils\": [\n                {\n                    \"I\": 5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": 0.0, \"z_c\": 0.0, \"misalignments\": [0.0, 0.0, 0.0]\n                },\n                {\n                    \"I\": -5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": np.pi, \"z_c\": 4.0 / 2, \"misalignments\": [0.0, 0.0, 0.0]\n                }\n            ],\n            \"L_z\": 4.0, \"r_eval\": 1.0,\n            \"mode_set\": [(m, n) for m in [1, 2] for n in [1]],\n            \"q_eval\": 2.0, \"delta\": 0.02\n        },\n        # Test Case C\n        {\n            \"coils\": [\n                {\n                    \"I\": 8000.0, \"a\": 0.10, \"R0\": 1.25,\n                    \"theta_c\": np.pi / 4, \"z_c\": 5.0 / 3,\n                    \"misalignments\": [0.02, 0.05, -0.03]\n                }\n            ],\n            \"L_z\": 5.0, \"r_eval\": 0.9,\n            \"mode_set\": [(m, n) for m in [1, 2, 3, 4] for n in [1, 2, 3]],\n            \"q_eval\": 1.0, \"delta\": 0.10\n        }\n    ]\n\n    def calculate_dominant_harmonic(case_params):\n        \"\"\"\n        Computes the dominant resonant harmonic for a single test case.\n        \"\"\"\n        coils = case_params['coils']\n        L_z, r_eval = case_params['L_z'], case_params['r_eval']\n        mode_set = case_params['mode_set']\n        q_eval, delta = case_params['q_eval'], case_params['delta']\n\n        # 1. Setup evaluation grid\n        theta_j = np.linspace(0, 2 * np.pi, N_THETA, endpoint=False)\n        z_k = np.linspace(0, L_z, N_Z, endpoint=False)\n        theta_grid, z_grid = np.meshgrid(theta_j, z_k, indexing='ij')\n\n        x_eval = r_eval * np.cos(theta_grid)\n        y_eval = r_eval * np.sin(theta_grid)\n        r_vec = np.stack([x_eval, y_eval, z_grid], axis=-1)\n        e_r_vec = np.stack([np.cos(theta_grid), np.sin(theta_grid), np.zeros_like(theta_grid)], axis=-1)\n        \n        # 2. Calculate total B field from all coils\n        total_B_vec = np.zeros_like(r_vec)\n        phi_l = np.linspace(0, 2 * np.pi, N_PHI, endpoint=False)\n        delta_phi = 2 * np.pi / N_PHI\n\n        for coil in coils:\n            I, a, R0 = coil['I'], coil['a'], coil['R0']\n            theta_c_nom, z_c_nom = coil['theta_c'], coil['z_c']\n            dr, d_theta, dz = coil['misalignments']\n\n            r_center = R0 + dr\n            theta_center = theta_c_nom + d_theta\n            z_center = z_c_nom + dz\n            x_c = r_center * np.cos(theta_center)\n            y_c = r_center * np.sin(theta_center)\n\n            r_prime_x = x_c + a * np.cos(phi_l)\n            r_prime_y = y_c + a * np.sin(phi_l)\n            r_prime_z = np.full_like(phi_l, z_center)\n            r_prime_vec = np.stack([r_prime_x, r_prime_y, r_prime_z], axis=-1)\n\n            dl_x = -a * np.sin(phi_l) * delta_phi\n            dl_y = a * np.cos(phi_l) * delta_phi\n            dl_vec = np.stack([dl_x, dl_y, np.zeros_like(dl_y)], axis=-1)\n\n            R_vec = r_vec[:, :, np.newaxis, :] - r_prime_vec[np.newaxis, np.newaxis, :, :]\n            R_norm_cubed = np.linalg.norm(R_vec, axis=-1)**3\n            \n            # Avoid division by zero if evaluation point is on the filament (unlikely)\n            R_norm_cubed[R_norm_cubed == 0] = 1e-12\n\n            cross_prod = np.cross(dl_vec[np.newaxis, np.newaxis, :, :], R_vec)\n            integrand = cross_prod / R_norm_cubed[..., np.newaxis]\n            B_vec_coil = MU0_4PI * I * np.sum(integrand, axis=2)\n            total_B_vec += B_vec_coil\n\n        # 3. Calculate radial component of the B-field\n        B_r_grid = np.sum(total_B_vec * e_r_vec, axis=-1)\n\n        # 4. Find dominant resonant harmonic\n        max_b = -1.0\n        dominant_mode = [0, 0, 0.0]\n\n        for m, n in mode_set:\n            if abs(m - n * q_eval) = delta:\n                k_n = 2 * np.pi * n / L_z\n                phase = m * theta_grid - k_n * z_grid\n                fourier_term = B_r_grid * np.exp(-1j * phase)\n                b_r_mn = np.abs(np.sum(fourier_term)) / (N_THETA * N_Z)\n\n                if b_r_mn > max_b:\n                    max_b = b_r_mn\n                    dominant_mode = [m, n, round(b_r_mn, 8)]\n\n        return dominant_mode\n\n    results = [calculate_dominant_harmonic(case) for case in test_cases]\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "Once an error field is present, its ability to penetrate the plasma is mediated by both the plasma's own response and the behavior of surrounding conductive structures. This analytical exercise delves into this interaction by modeling the screening effect of a resistive wall and the torque balance within the plasma. By deriving the critical field amplitude required for penetration, you will gain a first-principles understanding of the key scaling laws that govern error field locking, particularly the crucial roles of plasma rotation $\\omega$ and the resistive wall time $\\tau_w$ .",
            "id": "3976844",
            "problem": "Consider a single-helicity resonant magnetic perturbation (RMP) applied to a toroidal plasma, resonant at a rational surface of radius $r_s$. The plasma rotates toroidally with angular frequency $\\omega$ relative to a thin, axisymmetric resistive wall of characteristic resistive wall time $\\tau_w$. The external coils apply a vacuum normal field harmonic at the wall with complex amplitude $b_v$ at angular frequency $\\omega$ (equal to the plasma rotation frequency in the wall frame). The wall screens the applied field via eddy currents driven by electromagnetic induction. Inside the plasma, the resonant layer generates an electromagnetic torque that scales quadratically with the resonant normal field amplitude at the rational surface.\n\nStarting from the following fundamental bases:\n- Faraday's law, $\\nabla \\times \\mathbf{E} = -\\partial \\mathbf{B}/\\partial t$, Ohm's law in a stationary conductor, $\\mathbf{E} = \\eta \\mathbf{J}$, and magnetic flux conservation across a thin resistive wall, adopt a thin-wall average to model the wall response to a sinusoidal applied field as that of a single real pole characterized by a resistive wall time $\\tau_w$, and derive the magnitude of the frequency response (screening factor) that relates the complex normal field just inside the wall, $b_{\\text{in}}$, to the vacuum-applied field, $b_v$, as a function of $\\omega \\tau_w$.\n- In the plasma, model the helical Maxwell stress torque at the rational surface as $T_{\\text{EM}} = \\Lambda \\, |b_{\\text{in}}|^{2}$, where $\\Lambda > 0$ lumps geometric and layer-response factors, and model the opposing flow-damping torque as $T_{\\text{damp}} = D \\, \\omega$, where $D > 0$ is an effective linear damping coefficient. The penetration (locking) threshold is defined by $T_{\\text{EM}} = T_{\\text{damp}}$.\n\nTasks:\n1) Using the thin-wall single-pole model derived from the fundamental laws above, obtain a closed-form analytic expression for the critical vacuum field amplitude $b_{v,\\text{crit}}(\\omega,\\tau_w,\\Lambda,D)$ required for penetration as a function of $\\omega$, $\\tau_w$, $\\Lambda$, and $D$.\n2) Specialize your result to the regime where the wall time is comparable to the plasma rotation period, i.e., $\\omega \\tau_w = 1$, and provide the resulting analytic expression for $b_{v,\\text{crit}}$ in this case.\n3) Briefly discuss, based on your expression, how the penetration threshold scales in the limits $\\omega \\tau_w \\ll 1$ (plasma-dominated screening) and $\\omega \\tau_w \\gg 1$ (wall-dominated screening), identifying the transition behavior near $\\omega \\tau_w \\sim 1$.\n\nExpress your final answer for task $2$ as a single closed-form symbolic expression in terms of $\\omega$, $\\Lambda$, and $D$. Do not substitute numerical values. Do not include units in the final boxed answer. If evaluated numerically, $b_{v,\\text{crit}}$ would be in tesla. No rounding is required.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of magnetohydrodynamics and plasma physics, specifically addressing the well-established topic of error field penetration in tokamaks. The models provided (single-pole wall response, torque balance) are standard, albeit simplified, representations used in fusion science. The problem is well-posed, objective, and contains sufficient information for a unique solution.\n\nThe solution is structured into three parts, corresponding to the tasks outlined in the problem statement.\n\nFirst, we address the derivation of the wall screening factor and the critical vacuum field amplitude for penetration. The problem dictates that the wall's electromagnetic response to a sinusoidal applied field should be modeled as a single real pole characterized by the resistive wall time $\\tau_w$. This corresponds to a low-pass filter behavior for the magnetic field penetrating the wall. Let $b_v$ be the complex amplitude of the vacuum normal field harmonic applied at the wall, and let $b_{\\text{in}}$ be the complex amplitude of the total normal field just inside the wall. The single-pole model for the transfer function relating these two quantities is:\n$$\n\\frac{b_{\\text{in}}}{b_v} = \\frac{1}{1 + i\\omega\\tau_w}\n$$\nwhere $\\omega$ is the angular frequency of the applied field in the wall's reference frame. This model correctly captures the physics that at zero frequency ($\\omega=0$), the field penetrates completely ($b_{\\text{in}}=b_v$), and at very high frequency ($\\omega \\to \\infty$), the wall acts as a perfect conductor, completely screening the field ($b_{\\text{in}} \\to 0$).\n\nThe problem asks for the magnitude of this frequency response, which we term the screening factor. Taking the magnitude of the complex transfer function gives:\n$$\n\\left| \\frac{b_{\\text{in}}}{b_v} \\right| = \\left| \\frac{1}{1 + i\\omega\\tau_w} \\right| = \\frac{1}{\\sqrt{1^2 + (\\omega\\tau_w)^2}} = \\frac{1}{\\sqrt{1 + (\\omega\\tau_w)^2}}\n$$\nThis relates the magnitude of the field just inside the wall, $|b_{\\text{in}}|$, to the magnitude of the applied vacuum field, $|b_v|$:\n$$\n|b_{\\text{in}}| = \\frac{|b_v|}{\\sqrt{1 + (\\omega\\tau_w)^2}}\n$$\n\nNext, we establish the condition for mode penetration, or \"locking\". This occurs when the applied electromagnetic torque, $T_{\\text{EM}}$, balances the plasma's natural flow-damping torque, $T_{\\text{damp}}$. The problem provides the following models for these torques:\n$$\nT_{\\text{EM}} = \\Lambda \\, |b_{\\text{in}}|^{2}\n$$\n$$\nT_{\\text{damp}} = D \\, \\omega\n$$\nwhere $\\Lambda  0$ and $D  0$ are positive constants. The penetration threshold is defined by the condition $T_{\\text{EM}} = T_{\\text{damp}}$:\n$$\n\\Lambda \\, |b_{\\text{in}}|^{2} = D \\, \\omega\n$$\nFrom this, we can solve for the critical amplitude of the normal field at the resonant surface (which we approximate as $|b_{\\text{in}}|$ at the wall) required to cause locking:\n$$\n|b_{\\text{in}}|_{\\text{crit}}^2 = \\frac{D \\omega}{\\Lambda} \\implies |b_{\\text{in}}|_{\\text{crit}} = \\sqrt{\\frac{D \\omega}{\\Lambda}}\n$$\nThis is the field that must exist *inside* the plasma. To find the required *external* applied field, we must account for the wall screening. We denote the critical external vacuum field amplitude as $b_{v,\\text{crit}} \\equiv |b_v|_{\\text{crit}}$. Using the screening factor relation derived earlier:\n$$\nb_{v,\\text{crit}} = |b_{\\text{in}}|_{\\text{crit}} \\sqrt{1 + (\\omega\\tau_w)^2}\n$$\nSubstituting the expression for $|b_{\\text{in}}|_{\\text{crit}}$ gives the final closed-form expression for the critical vacuum field amplitude as a function of the given parameters. This completes Task $1$.\n$$\nb_{v,\\text{crit}}(\\omega, \\tau_w, \\Lambda, D) = \\sqrt{\\frac{D \\omega}{\\Lambda}} \\sqrt{1 + (\\omega\\tau_w)^2} = \\sqrt{\\frac{D \\omega}{\\Lambda} \\left(1 + (\\omega\\tau_w)^2\\right)}\n$$\n\nFor Task $2$, we specialize this result to the regime where the wall time is comparable to the plasma rotation period, specifically $\\omega \\tau_w = 1$. Substituting this condition into the general expression for $b_{v,\\text{crit}}$:\n$$\nb_{v,\\text{crit}} = \\sqrt{\\frac{D \\omega}{\\Lambda} \\left(1 + (1)^2\\right)} = \\sqrt{\\frac{D \\omega}{\\Lambda} (2)} = \\sqrt{\\frac{2 D \\omega}{\\Lambda}}\n$$\nThis provides the analytic expression for the penetration threshold under the condition $\\omega \\tau_w = 1$.\n\nFinally, for Task $3$, we discuss the scaling of the penetration threshold in different limits based on the general expression $b_{v,\\text{crit}} = \\sqrt{\\frac{D \\omega}{\\Lambda} (1 + (\\omega\\tau_w)^2)}$.\n\nIn the limit of low frequency, $\\omega \\tau_w \\ll 1$, the wall is electromagnetically \"slow\" or \"thin\", offering little screening. This is the plasma-dominated screening regime. The term $(\\omega \\tau_w)^2$ is negligible compared to $1$.\n$$\nb_{v,\\text{crit}} \\approx \\sqrt{\\frac{D \\omega}{\\Lambda} (1)} = \\sqrt{\\frac{D \\omega}{\\Lambda}}\n$$\nIn this limit, the critical field scales as $b_{v,\\text{crit}} \\propto \\omega^{1/2}$. The required applied field increases with frequency simply because a larger damping torque must be overcome.\n\nIn the limit of high frequency, $\\omega \\tau_w \\gg 1$, the wall is electromagnetically \"fast\" or \"thick\", providing significant screening. This is the wall-dominated screening regime. The term $(\\omega \\tau_w)^2$ dominates over $1$.\n$$\nb_{v,\\text{crit}} \\approx \\sqrt{\\frac{D \\omega}{\\Lambda} (\\omega \\tau_w)^2} = \\sqrt{\\frac{D \\tau_w^2}{\\Lambda} \\omega^3} = \\tau_w \\sqrt{\\frac{D}{\\Lambda}} \\, \\omega^{3/2}\n$$\nIn this limit, the critical field scales as $b_{v,\\text{crit}} \\propto \\omega^{3/2}$. The required field increases much more steeply with frequency. This is a combined effect: not only does the plasma damping torque increase (requiring $|b_{\\text{in}}| \\propto \\omega^{1/2}$), but the wall's screening becomes more effective (requiring $|b_v| \\propto \\omega |b_{\\textin}|$), leading to the composite $\\omega^{1/2} \\times \\omega = \\omega^{3/2}$ scaling.\n\nThe transition between these two scaling laws occurs smoothly near $\\omega \\tau_w \\sim 1$. At this point, the wall's contribution to screening becomes comparable to $1$, and the dependence of the required applied field on frequency steepens. The function $b_{v,\\text{crit}}(\\omega)$ is monotonically increasing for $\\omega  0$, indicating that a faster rotating plasma is always more resilient to mode locking by a static error field.",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2 D \\omega}{\\Lambda}}}\n$$"
        },
        {
            "introduction": "To capture the rich, non-linear nature of the transition from a screened to a penetrated state, we now move from static analysis to a dynamical systems perspective. This computational practice uses the forced Stuart-Landau equation, a reduced model that describes the evolution of the magnetic island's amplitude $A$ and phase $\\phi$. By numerically integrating this system, you will directly observe the bifurcation from a stable, phase-slipping limit cycle (screening) to a phase-locked fixed point (penetration), providing a deeper intuition for the abrupt nature of mode locking phenomena in tokamaks .",
            "id": "3976855",
            "problem": "Consider a single-helicity magnetic island in a toroidal plasma subject to an externally applied error field. Using Resistive Magnetohydrodynamics (MHD) and standard dynamical systems reduction near onset, the island dynamics can be represented by a forced amplitude equation for a complex mode amplitude. Let the complex amplitude be written as $Z(t) = A(t) e^{i \\phi(t)}$, where $A(t)$ is the real, nonnegative island amplitude and $\\phi(t)$ is the phase relative to the fixed phase of the external error field. The external error field acts as a constant-phase forcing, and the plasma rotation manifests as a Doppler shift of the phase dynamics. In dimensionless form, a reduced model consistent with Ohm's law, the induction equation, and a normal form expansion near marginal tearing stability is the forced Stuart–Landau system:\n$$\n\\frac{dA}{dt} = \\sigma A - \\kappa A^3 + H \\cos\\phi,\n$$\n$$\n\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A} \\sin\\phi,\n$$\nwhere $A(t) \\ge 0$ is the island amplitude (dimensionless), $\\phi(t)$ is the phase (radians), $\\sigma$ is the linear stability parameter (dimensionless), $\\kappa$ is the nonlinear saturation coefficient (dimensionless), $H$ is the dimensionless strength of the external error field (proportional to the resonant component of the radial magnetic field), and $\\Omega$ is the dimensionless rotation rate (representing the Doppler shift of the tearing layer due to plasma rotation). This model captures error field screening and penetration as a bifurcation in the fixed points of the coupled amplitude–phase dynamics as $\\Omega$ is varied. Screening corresponds to small $A$ with persistent phase slip (no phase locking), while penetration corresponds to finite $A$ with phase locking (steady phase relative to the error field).\n\nStarting from the above dynamical system, implement a numerical solver that integrates the system forward in time from an initial condition $A(0) = A_0$ and $\\phi(0) = \\phi_0$, and determines, for each case in the test suite, whether the system reaches a penetrated, phase-locked state or remains in a screened, phase-slipping state. Use the following principles:\n\n- The integration must be performed for a sufficiently long duration to reach the attractor of the dynamics for the chosen parameters.\n- The phase locking diagnostic must be based on the time-average of $|\\frac{d\\phi}{dt}|$ over a late-time window; specifically, declare the system locked if the late-time average of $|\\frac{d\\phi}{dt}|$ is less than a small threshold $\\epsilon_\\phi$ and the late-time average amplitude $\\bar{A}$ exceeds a minimal threshold $A_{\\min}$, both dimensionless.\n- All angles must be treated in radians.\n- All quantities are dimensionless; express all returned amplitudes as dimensionless numbers.\n\nDerive the algorithm from the fundamental bases of Resistive Magnetohydrodynamics (MHD), Ohm's law, and dynamical systems reduction near marginal stability, explaining how an external, fixed-phase error field leads to the forcing terms above and how plasma rotation enters the phase equation.\n\nYour program must implement the solver and produce, for each test case in the suite below, a result of the form `[\\bar{A}, L]`, where $\\bar{A}$ is the late-time average amplitude (a float) and $L$ is a lock indicator (an integer where $L = 1$ if locked and $L = 0$ otherwise). The final output must be a single line containing a comma-separated list of these per-test-case results, enclosed in square brackets, with no spaces (for example, `[\\[0.123,1\\],\\[0.045,0\\]]`). Choose $A_0 = 0.01$ and $\\phi_0 = 0$ for all cases. Use a regularization in the computation of $\\frac{d\\phi}{dt}$ when $A$ is extremely small to prevent division by zero; this regularization must not change the long-time behavior qualitatively.\n\nTest suite:\n\n- Case $1$: $\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 1.2$.\n- Case $2$: $\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 0.2$.\n- Case $3$: $\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 0.35$.\n- Case $4$: $\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.0$, $\\Omega = 0.5$.\n- Case $5$: $\\sigma = -0.5$, $\\kappa = 1.0$, $H = 1.0$, $\\Omega = 1.5$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[[\\bar{A}_1,L_1],[\\bar{A}_2,L_2],[\\bar A}_3,L_3],[\\bar{A}_4,L_4],[\\bar{A}_5,L_5]]`, where each $\\bar{A}_i$ is a float and each $L_i$ is either $0$ or $1$. Use radians for phases and dimensionless units for amplitudes and parameters. The choice of numerical thresholds for locking, total integration time, and late-time averaging window must be justified by the model scales and ensure accurate identification of the regime (screened versus penetrated).",
            "solution": "The problem is assessed as valid. It is scientifically grounded in the principles of Resistive Magnetohydrodynamics (MHD) and bifurcation theory, specifically using the Stuart-Landau equation as a normal form for island dynamics. It is well-posed, with all necessary parameters and conditions provided to define a solvable initial value problem. The language is objective and the request is formalizable into a computational task.\n\nThe solution proceeds by first deriving the physical and mathematical basis of the model, then detailing the design of a robust numerical algorithm to solve the equations and diagnose the system's state.\n\n**1. Physical and Mathematical Basis of the Model**\n\nThe provided system of equations describes the dynamics of a magnetic island amplitude and phase under the influence of an external, static magnetic perturbation (an \"error field\"). This model is a cornerstone in the study of error field penetration in tokamaks and other magnetically confined fusion plasmas.\n\n**From Resistive MHD to an Amplitude Equation:**\nIn a high-temperature plasma, resistivity $\\eta$ is typically small but non-zero. According to Ohm's Law, $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j}$. In ideal MHD ($\\eta=0$), magnetic field lines are \"frozen\" into the plasma flow. However, in localized regions, such as at rational magnetic surfaces where the field line closes on itself after a rational number of toroidal/poloidal transits, resistivity can become important. It enables a change in magnetic topology, allowing for magnetic reconnection and the formation of \"magnetic islands\". The instability responsible for this is the tearing mode.\n\nThe linear stability of a tearing mode is governed by the parameter $\\Delta'$. A mode is unstable if $\\Delta'  0$. Near the marginal stability point ($\\Delta' \\approx 0$), the evolution of the mode's amplitude can be described by a simplified \"normal form\" equation. This is a general technique in dynamical systems theory for studying systems near a bifurcation. For the tearing mode, the natural amplitude is the reconnected magnetic flux $\\Psi$ or the island width $W$, where $W \\propto \\sqrt{|\\Psi|}$. For convenience, we use a mode amplitude $A \\propto |\\Psi|$, so $W \\propto \\sqrt{A}$.\n\n**Inclusion of Forcing and Rotation:**\nAn external, static magnetic field perturbation that has the same spatial structure (helicity) as the natural tearing mode acts as a direct drive. This introduces an additive forcing term, denoted by $H$, into the amplitude equation.\n\nTokamak plasmas typically rotate. From the perspective of the static external error field, the tearing mode (which is embedded in the rotating plasma) rotates past it. Conversely, in a frame co-rotating with the plasma, the tearing mode is stationary, but the external field appears to oscillate. This relative rotation introduces a frequency shift, which we denote by $\\Omega$, into the dynamics of the mode's phase.\n\n**The Forced Stuart-Landau Equation:**\nCombining these elements—linear stability, nonlinear saturation, external forcing, and plasma rotation—leads to a general complex amplitude equation for the mode amplitude $Z(t) = A(t) e^{i \\phi(t)}$:\n$$\n\\frac{dZ}{dt} = (\\sigma + i\\Omega) Z - \\kappa |Z|^2 Z + H\n$$\nHere, $Z$ is the complex amplitude where $A$ is the magnitude and $\\phi$ is the phase relative to the external field. $\\sigma$ is the linear growth rate (related to $\\Delta'$), $\\kappa$ is a positive coefficient describing nonlinear saturation (the term $-\\kappa |Z|^2 Z$ or $-\\kappa A^3$ prevents unbounded growth), $H$ represents the constant-phase external error field, and $\\Omega$ is the natural frequency of the mode due to plasma rotation.\n\nTo obtain the real-valued system given in the problem, we substitute $Z = A e^{i\\phi}$ into the complex equation and separate the real and imaginary parts. Note that $\\frac{dZ}{dt} = \\frac{d}{dt}(A e^{i\\phi}) = (\\frac{dA}{dt} + iA\\frac{d\\phi}{dt})e^{i\\phi}$.\n$$\n(\\frac{dA}{dt} + iA\\frac{d\\phi}{dt})e^{i\\phi} = (\\sigma + i\\Omega) A e^{i\\phi} - \\kappa A^3 e^{i\\phi} + H\n$$\nMultiplying by $e^{-i\\phi}$ gives:\n$$\n\\frac{dA}{dt} + iA\\frac{d\\phi}{dt} = (\\sigma + i\\Omega) A - \\kappa A^3 + H e^{-i\\phi}\n$$\nUsing Euler's formula $e^{-i\\phi} = \\cos\\phi - i\\sin\\phi$, we get:\n$$\n\\frac{dA}{dt} + iA\\frac{d\\phi}{dt} = (\\sigma A - \\kappa A^3 + H \\cos\\phi) + i(\\Omega A - H \\sin\\phi)\n$$\nEquating the real and imaginary parts yields the two coupled ordinary differential equations (ODEs) presented in the problem:\n$$\n\\frac{dA}{dt} = \\sigma A - \\kappa A^3 + H \\cos\\phi\n$$\n$$\n\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A} \\sin\\phi\n$$\nThis system captures the essential physics: island growth/damping, nonlinear saturation, forcing by the error field, and phase dynamics due to rotation. The phenomenon of error field \"penetration\" corresponds to a fixed point of this system where $A$ is large and $\\frac{d\\phi}{dt}=0$ (phase-locking). \"Screening\" corresponds to a limit cycle where $A$ remains small and $\\phi$ continuously increases (phase-slipping), with $\\langle\\frac{d\\phi}{dt}\\rangle \\approx \\Omega$.\n\n**2. Algorithmic Design and Implementation**\n\n**Numerical Integration Strategy:**\nThe provided system is an initial value problem for a set of two coupled nonlinear ODEs. The equation for $\\frac{d\\phi}{dt}$ contains a singularity at $A=0$. While the problem specifies using a regularization, a more robust and elegant approach is to solve the system in Cartesian coordinates, which is free of this singularity. We define $Z_x(t) = A(t)\\cos\\phi(t)$ and $Z_y(t) = A(t)\\sin\\phi(t)$. The ODEs for these variables are derived from the complex Stuart-Landau equation:\n$$\n\\frac{dZ_x}{dt} = \\sigma Z_x - \\Omega Z_y - \\kappa (Z_x^2 + Z_y^2) Z_x + H\n$$\n$$\n\\frac{dZ_y}{dt} = \\sigma Z_y + \\Omega Z_x - \\kappa (Z_x^2 + Z_y^2) Z_y\n$$\nThis system is numerically well-behaved for all values of $Z_x$ and $Z_y$. We can integrate this system using a standard, high-quality adaptive step-size solver, such as a 4th-5th order Runge-Kutta method (RK45), which is conveniently available in `scipy.integrate.solve_ivp`. After obtaining the solution for $Z_x(t)$ and $Z_y(t)$, we can recover the amplitude and phase as $A(t) = \\sqrt{Z_x(t)^2 + Z_y(t)^2}$ and $\\phi(t) = \\operatorname{atan2}(Z_y(t), Z_x(t))$.\n\n**Choice of Numerical Parameters:**\nTo accurately determine the long-term behavior (the attractor), several numerical parameters must be chosen and justified.\n- **Integration Time ($t_{end}$):** The system has characteristic timescales, such as the damping time $1/|\\sigma| = 1/|-0.5| = 2$ and the rotation period $2\\pi/\\Omega$. To ensure the system has settled onto its attractor, we must integrate for a duration much longer than these timescales. A total integration time of $t_{end}=200$ is chosen, which corresponds to $100$ damping times and dozens of rotation periods for the given parameters, providing ample time to discard initial transients.\n- **Late-Time Averaging Window:** Diagnostics should be computed on the final state, after transients have decayed. We will use the final $50\\%$ of the integration time, from $t=100$ to $t=200$, for this analysis.\n- **Diagnostic Thresholds:** To classify the state, we need thresholds for the average amplitude $\\bar{A}$ and the average phase rotation rate $|\\frac{d\\phi}{dt}|$.\n    - **$A_{\\min}$:** Penetration implies a significant island has formed. The initial amplitude is $A_0 = 0.01$. We set a minimum amplitude threshold of $A_{\\min} = 0.05$ to distinguish a genuinely penetrated state from the small, screened state.\n    - **$\\epsilon_{\\phi}$:** Phase locking means the phase rotation rate is nearly zero. In a slipping state, the average rate is close to $\\Omega$. The values of $\\Omega$ in the test suite range from $0.2$ to $1.5$. A threshold of $\\epsilon_{\\phi} = 0.01$ is chosen, which is an order of magnitude smaller than the slowest rotation rate, providing a clear distinction between a locked and a slipping state.\n\n**State Classification Logic:**\nFor each test case, the system is integrated from the initial condition $A(0) = 0.01$ and $\\phi(0) = 0$. The late-time averages, $\\bar{A}$ and $\\langle|\\frac{d\\phi}{dt}|\\rangle$, are computed. A state is classified as phase-locked and penetrated ($L=1$) if and only if both conditions are met: $\\bar{A} > A_{\\min}$ AND $\\langle|\\frac{d\\phi}{dt}|\\rangle  \\epsilon_{\\phi}$. Otherwise, it is classified as screened or decaying ($L=0$). When computing $\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A}\\sin\\phi$ for the diagnostic, a small regularization constant $\\epsilon_{reg} = 10^{-9}$ is added to the denominator ($A + \\epsilon_{reg}$) to prevent division by zero in cases where $A$ becomes vanishingly small.\n\nThis principled approach ensures a scientifically sound and numerically robust solution to the problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the forced Stuart-Landau system for several test cases to determine\n    if the plasma state is phase-locked (penetrated) or phase-slipping (screened).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, kappa, H, Omega)\n    test_cases = [\n        (-0.5, 1.0, 0.15, 1.2),\n        (-0.5, 1.0, 0.15, 0.2),\n        (-0.5, 1.0, 0.15, 0.35),\n        (-0.5, 1.0, 0.0, 0.5),\n        (-0.5, 1.0, 1.0, 1.5),\n    ]\n\n    # --- Numerical and Physical Parameters ---\n    A0 = 0.01  # Initial island amplitude\n    phi0 = 0.0  # Initial island phase\n\n    # Integration and analysis parameters, justified in the solution text.\n    T_END = 200.0  # Total integration time to reach the attractor\n    AVG_FRAC = 0.5  # Fraction of late time to average over for diagnostics\n    EPSILON_PHI = 0.01  # Locking threshold for the time-average of |d(phi)/dt|\n    A_MIN = 0.05  # Minimum average amplitude for a state to be considered penetrated\n    REG_EPS = 1e-9  # Regularization constant to prevent division by zero\n\n    results = []\n    for case in test_cases:\n        sigma, kappa, H, Omega = case\n\n        # Define the ODE system in Cartesian coordinates Z(t) = zx(t) + i*zy(t)\n        # This avoids the singularity at A=0 in the polar coordinate formulation.\n        # d(zx)/dt = sigma*zx - Omega*zy - kappa*(zx^2+zy^2)*zx + H\n        # d(zy)/dt = sigma*zy + Omega*zx - kappa*(zx^2+zy^2)*zy\n        def odesystem(t, z):\n            zx, zy = z\n            A_sq = zx**2 + zy**2\n            dzx_dt = sigma * zx - Omega * zy - kappa * A_sq * zx + H\n            dzy_dt = sigma * zy + Omega * zx - kappa * A_sq * zy\n            return [dzx_dt, dzy_dt]\n\n        # Set initial conditions in Cartesian coordinates\n        z0 = [A0 * np.cos(phi0), A0 * np.sin(phi0)]\n\n        # Use a high-quality adaptive ODE solver\n        sol = solve_ivp(\n            odesystem,\n            [0, T_END],\n            z0,\n            method='RK45',\n            dense_output=True,\n            rtol=1e-6,\n            atol=1e-9\n        )\n\n        # We need to evaluate the solution at several points during the\n        # late-time window to perform averaging.\n        t_eval = np.linspace(T_END * (1.0 - AVG_FRAC), T_END, 2000)\n        z_eval = sol.sol(t_eval)\n        zx_late, zy_late = z_eval[0], z_eval[1]\n\n        # Recover amplitude A and phase phi from Cartesian solution\n        A_late = np.sqrt(zx_late**2 + zy_late**2)\n        phi_late = np.arctan2(zy_late, zx_late)\n\n        # Calculate d(phi)/dt using the original formula with regularization\n        # d(phi)/dt = Omega - (H/A) * sin(phi)\n        dphidt_late = Omega - (H / (A_late + REG_EPS)) * np.sin(phi_late)\n\n        # Calculate late-time averages for diagnostics\n        avg_A = np.mean(A_late)\n        avg_abs_dphidt = np.mean(np.abs(dphidt_late))\n\n        # Apply locking criteria to determine the lock indicator L\n        # Locked (L=1) if phase rotation is negligible AND amplitude is significant.\n        is_locked = 1 if (avg_abs_dphidt  EPSILON_PHI and avg_A > A_MIN) else 0\n\n        # Store the result pair [average_amplitude, lock_indicator]\n        results.append([avg_A, is_locked])\n\n    # Convert the list of lists to the required string format\n    # e.g., [[0.123,1],[0.045,0]] with no spaces.\n    final_output_string = str(results).replace(\" \", \"\")\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}