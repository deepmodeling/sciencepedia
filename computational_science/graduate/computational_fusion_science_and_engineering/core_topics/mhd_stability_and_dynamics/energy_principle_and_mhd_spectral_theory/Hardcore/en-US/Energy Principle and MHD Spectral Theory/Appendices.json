{
    "hands_on_practices": [
        {
            "introduction": "Before analyzing the stability of a plasma, we must first define a valid equilibrium configuration. This foundational exercise  centers on the magnetohydrodynamic (MHD) force balance equation, $\\boldsymbol{J} \\times \\boldsymbol{B} = \\boldsymbol{\\nabla}p$, which requires the magnetic Lorentz force to precisely counteract the plasma pressure gradient. By working through the specific case of a cylindrical Z-pinch, you will gain hands-on practice applying Ampere's law to derive the plasma current and verifying the conditions necessary for a static equilibrium.",
            "id": "3973950",
            "problem": "Consider a straight, axisymmetric cylindrical plasma column of radius $a$ with equilibrium pressure and magnetic field profiles given by $p(r)=p_0\\left(1-\\frac{r^2}{a^2}\\right)$ and $\\boldsymbol{B}(r)=B_{\\theta}(r)\\,\\boldsymbol{e}_{\\theta}$ with $B_{\\theta}(r)=\\frac{B_0 r}{a}$ for $0\\le r\\le a$. Assume static ideal Magnetohydrodynamics (MHD), that is, $\\boldsymbol{v}=\\boldsymbol{0}$ and infinite conductivity, and adopt the magnetostatic Maxwell–Ampère law $\\boldsymbol{\\nabla}\\times\\boldsymbol{B}=\\mu_0 \\boldsymbol{J}$ with vacuum permeability $\\mu_0$. Starting only from these fundamental relations and the MHD equilibrium force balance $\\boldsymbol{J}\\times\\boldsymbol{B}=\\boldsymbol{\\nabla}p$, compute the equilibrium current density vector $\\boldsymbol{J}(r)$ and verify the force balance condition throughout $0ra$. Deduce the resulting constraint that must relate the constants $p_0$ and $B_0$ for exact force balance to hold everywhere in $0ra$. Indicate the direction of $\\boldsymbol{J}$. Express the current density in ampere per square meter ($\\mathrm{A\\,m^{-2}}$) and the pressure in pascals ($\\mathrm{Pa}$). Report your final result as the pair consisting of the axial current density component and the required value of $p_0$, in closed-form symbolic expressions. No numerical rounding is required.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It represents a standard analysis of a Z-pinch equilibrium in ideal Magnetohydrodynamics (MHD). All necessary information is provided, and the problem is free of contradictions or ambiguities. We may proceed with the solution.\n\nThe problem requires us to compute the equilibrium current density $\\boldsymbol{J}(r)$, verify the MHD force balance equation, and deduce a constraint relating the constants $p_0$ and $B_0$. The analysis is performed in a cylindrical coordinate system $(r, \\theta, z)$.\n\nFirst, we calculate the current density vector $\\boldsymbol{J}(r)$ from the magnetostatic Maxwell–Ampère law, $\\boldsymbol{\\nabla} \\times \\boldsymbol{B} = \\mu_0 \\boldsymbol{J}$. This gives $\\boldsymbol{J} = \\frac{1}{\\mu_0} \\boldsymbol{\\nabla} \\times \\boldsymbol{B}$. The magnetic field is given as $\\boldsymbol{B}(r) = B_{\\theta}(r) \\, \\boldsymbol{e}_{\\theta} = \\frac{B_0 r}{a} \\boldsymbol{e}_{\\theta}$.\n\nIn cylindrical coordinates, the curl of a vector field $\\boldsymbol{B} = B_r \\boldsymbol{e}_r + B_{\\theta} \\boldsymbol{e}_{\\theta} + B_z \\boldsymbol{e}_z$ is given by:\n$$\n\\boldsymbol{\\nabla} \\times \\boldsymbol{B} = \\left( \\frac{1}{r}\\frac{\\partial B_z}{\\partial \\theta} - \\frac{\\partial B_{\\theta}}{\\partial z} \\right) \\boldsymbol{e}_r + \\left( \\frac{\\partial B_r}{\\partial z} - \\frac{\\partial B_z}{\\partial r} \\right) \\boldsymbol{e}_{\\theta} + \\frac{1}{r} \\left( \\frac{\\partial (r B_{\\theta})}{\\partial r} - \\frac{\\partial B_r}{\\partial \\theta} \\right) \\boldsymbol{e}_z\n$$\nGiven that $\\boldsymbol{B}$ has only a $\\theta$-component, $B_r = 0$ and $B_z = 0$. Furthermore, $B_{\\theta}$ depends only on $r$, so derivatives with respect to $\\theta$ and $z$ are zero. The expression for the curl simplifies to:\n$$\n\\boldsymbol{\\nabla} \\times \\boldsymbol{B} = \\frac{1}{r} \\frac{\\partial (r B_{\\theta})}{\\partial r} \\boldsymbol{e}_z\n$$\nSubstituting the given expression for $B_{\\theta}(r) = \\frac{B_0 r}{a}$:\n$$\nr B_{\\theta}(r) = r \\left( \\frac{B_0 r}{a} \\right) = \\frac{B_0 r^2}{a}\n$$\nNow, we take the partial derivative with respect to $r$:\n$$\n\\frac{\\partial (r B_{\\theta})}{\\partial r} = \\frac{\\partial}{\\partial r} \\left( \\frac{B_0 r^2}{a} \\right) = \\frac{2 B_0 r}{a}\n$$\nSubstituting this back into the curl expression:\n$$\n\\boldsymbol{\\nabla} \\times \\boldsymbol{B} = \\frac{1}{r} \\left( \\frac{2 B_0 r}{a} \\right) \\boldsymbol{e}_z = \\frac{2 B_0}{a} \\boldsymbol{e}_z\n$$\nThe current density is therefore:\n$$\n\\boldsymbol{J}(r) = \\frac{1}{\\mu_0} ( \\boldsymbol{\\nabla} \\times \\boldsymbol{B} ) = \\frac{2 B_0}{\\mu_0 a} \\boldsymbol{e}_z\n$$\nThis result shows that the current density is uniform throughout the plasma column and is directed purely along the axial direction, $\\boldsymbol{e}_z$.\n\nNext, we verify the MHD equilibrium force balance equation, $\\boldsymbol{J} \\times \\boldsymbol{B} = \\boldsymbol{\\nabla}p$. We compute the left-hand side (LHS) and right-hand side (RHS) separately.\n\nThe LHS is the Lorentz force density, $\\boldsymbol{J} \\times \\boldsymbol{B}$:\n$$\n\\boldsymbol{J} \\times \\boldsymbol{B} = \\left( \\frac{2 B_0}{\\mu_0 a} \\boldsymbol{e}_z \\right) \\times \\left( \\frac{B_0 r}{a} \\boldsymbol{e}_{\\theta} \\right) = \\frac{2 B_0^2 r}{\\mu_0 a^2} (\\boldsymbol{e}_z \\times \\boldsymbol{e}_{\\theta})\n$$\nIn a right-handed cylindrical coordinate system, the cross product of the basis vectors is $\\boldsymbol{e}_z \\times \\boldsymbol{e}_{\\theta} = -\\boldsymbol{e}_r$. Thus, the Lorentz force is:\n$$\n\\boldsymbol{J} \\times \\boldsymbol{B} = - \\frac{2 B_0^2 r}{\\mu_0 a^2} \\boldsymbol{e}_r\n$$\nThis is an inward-directed radial force, consistent with the pinching effect of an axial current.\n\nThe RHS is the pressure gradient force, $\\boldsymbol{\\nabla}p$. The pressure profile is given as $p(r) = p_0 \\left(1 - \\frac{r^2}{a^2}\\right)$. Since $p$ is a function of $r$ only, its gradient is:\n$$\n\\boldsymbol{\\nabla}p = \\frac{dp}{dr} \\boldsymbol{e}_r\n$$\nWe compute the derivative of $p(r)$:\n$$\n\\frac{dp}{dr} = \\frac{d}{dr} \\left[ p_0 \\left(1 - \\frac{r^2}{a^2}\\right) \\right] = p_0 \\left( 0 - \\frac{2r}{a^2} \\right) = - \\frac{2 p_0 r}{a^2}\n$$\nSo, the pressure gradient force is:\n$$\n\\boldsymbol{\\nabla}p = - \\frac{2 p_0 r}{a^2} \\boldsymbol{e}_r\n$$\nThis force is also directed radially inward because the pressure decreases with radius.\n\nFor force balance to be satisfied for all $r$ in the range $0  r  a$, the LHS must equal the RHS:\n$$\n- \\frac{2 B_0^2 r}{\\mu_0 a^2} \\boldsymbol{e}_r = - \\frac{2 p_0 r}{a^2} \\boldsymbol{e}_r\n$$\nEquating the scalar components of this vector equation, we have:\n$$\n\\frac{2 B_0^2 r}{\\mu_0 a^2} = \\frac{2 p_0 r}{a^2}\n$$\nFor $r  0$, we can divide both sides by the common factor $\\frac{2r}{a^2}$:\n$$\n\\frac{B_0^2}{\\mu_0} = p_0\n$$\nThis is the required constraint that must relate the constants $p_0$ and $B_0$ for this specific equilibrium to exist.\n\nThe problem asks for the pair consisting of the axial current density component, which we found to be $J_z = \\frac{2 B_0}{\\mu_0 a}$, and the required value of $p_0$, which is $p_0 = \\frac{B_0^2}{\\mu_0}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2 B_0}{\\mu_0 a}  \\frac{B_0^2}{\\mu_0}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Once an equilibrium is established, we can probe its stability against small perturbations using the MHD energy principle. This practice  isolates one of the most important stabilizing contributions to the potential energy change, $\\delta W$: the magnetic line-bending energy. This term quantifies the energy required to bend magnetic field lines, which is often a significant barrier to instability, and the calculation will familiarize you with the crucial directional derivative operator along the magnetic field, $\\boldsymbol{B} \\cdot \\nabla$, and its role in determining the stability of helical perturbations.",
            "id": "3973927",
            "problem": "Consider a straight, circular cylindrical plasma of radius $a$ and axial period $L$ in cylindrical coordinates $(r,\\theta,z)$ with an axisymmetric equilibrium magnetic field $\\boldsymbol{B}_0(r)=B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}$, where $B_{\\theta}(r)$ and $B_{z}(r)$ are smooth functions of $r$ and $B_{r}(r)=0$. Let the displacement be an ideal Magnetohydrodynamics (MHD) perturbation that is everywhere perpendicular to $\\boldsymbol{B}_0$, of the form $\\boldsymbol{\\xi}_{\\perp}(r,\\theta,z)=\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)$, where $m\\in\\mathbb{Z}$ is the poloidal mode number, $k\\in\\mathbb{R}$ is the axial wavenumber, $\\xi(r)$ is a real radial amplitude, and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector satisfying $\\hat{\\boldsymbol{e}}_{\\perp}(r)\\cdot\\boldsymbol{B}_0(r)=0$ and depending only on $r$. Assume ideal MHD and use the energy principle to isolate the magnetic line-bending contribution\n$$\n\\delta W_{\\text{bend}}=\\frac{1}{2\\,\\mu_{0}}\\int|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^{2}\\,d^{3}x,\n$$\nwhere $\\mu_{0}$ is the permeability of free space and $d^{3}x=r\\,dr\\,d\\theta\\,dz$. Starting from first principles, compute $\\delta W_{\\text{bend}}$ explicitly in terms of $m$, $k$, $L$, $\\mu_{0}$, $B_{\\theta}(r)$, $B_{z}(r)$, and $\\xi(r)$, performing the integrals over $\\theta$ and $z$ but leaving the radial integral unevaluated. State any geometric identities you use. Express the final energy in Joules. Do not provide any numerical evaluation; your final expression must be closed-form and depend only on the specified symbols. Do not include units in your boxed final answer.",
            "solution": "The problem is valid as it is scientifically grounded in ideal Magnetohydrodynamics (MHD) theory, specifically concerning the energy principle for plasma stability analysis. The setup is well-defined, self-contained, and free of contradictions or ambiguities. It poses a standard, solvable problem in computational fusion science.\n\nThe objective is to compute the magnetic line-bending energy contribution, given by the expression:\n$$\n\\delta W_{\\text{bend}}=\\frac{1}{2\\,\\mu_{0}}\\int|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^{2}\\,d^{3}x\n$$\nThe integration is over the volume of the cylindrical plasma, which has a radius $a$ and an axial period $L$. The volume element in cylindrical coordinates $(r, \\theta, z)$ is $d^3x = r\\,dr\\,d\\theta\\,dz$. The integration limits are $r \\in [0, a]$, $\\theta \\in [0, 2\\pi]$, and $z \\in [0, L]$.\n\nThe core of the calculation is to evaluate the term $|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2$. The expression $\\boldsymbol{B}_0\\cdot\\nabla$ represents the directional derivative operator along the magnetic field $\\boldsymbol{B}_0$. In cylindrical coordinates, the gradient operator is $\\nabla = \\hat{\\boldsymbol{e}}_r \\frac{\\partial}{\\partial r} + \\hat{\\boldsymbol{e}}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\hat{\\boldsymbol{e}}_z \\frac{\\partial}{\\partial z}$.\nThe equilibrium magnetic field is given as $\\boldsymbol{B}_0(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}$.\nThe directional derivative operator is therefore:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla = \\left(B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}\\right) \\cdot \\left(\\hat{\\boldsymbol{e}}_r \\frac{\\partial}{\\partial r} + \\hat{\\boldsymbol{e}}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\hat{\\boldsymbol{e}}_z \\frac{\\partial}{\\partial z}\\right)\n$$\nUsing the orthonormality of the cylindrical basis vectors ($\\hat{\\boldsymbol{e}}_i \\cdot \\hat{\\boldsymbol{e}}_j = \\delta_{ij}$), this operator simplifies to:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla = \\frac{B_{\\theta}(r)}{r} \\frac{\\partial}{\\partial \\theta} + B_{z}(r) \\frac{\\partial}{\\partial z}\n$$\nThis is the primary geometric identity used in this derivation.\n\nWe apply this operator to the plasma displacement vector $\\boldsymbol{\\xi}_{\\perp}$, which is given as:\n$$\n\\boldsymbol{\\xi}_{\\perp}(r,\\theta,z)=\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nwhere $\\xi(r)$ is the radial amplitude and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector that depends only on the radial coordinate $r$. Therefore, the vector part $\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is constant with respect to the derivatives $\\frac{\\partial}{\\partial \\theta}$ and $\\frac{\\partial}{\\partial z}$. The derivatives act only on the exponential term.\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = \\left(\\frac{B_{\\theta}(r)}{r} \\frac{\\partial}{\\partial \\theta} + B_{z}(r) \\frac{\\partial}{\\partial z}\\right) \\left(\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\\right)\n$$\nApplying the chain rule:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r) \\left[ \\left(\\frac{B_{\\theta}(r)}{r}\\right) (i\\,m) + B_{z}(r) (i\\,k) \\right] \\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nFactoring out the imaginary unit $i$:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = i \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right) \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nThis resulting quantity is a complex vector. We now compute its squared magnitude, $|\\cdot|^2$, which is the dot product of the vector with its complex conjugate.\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = \\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right) \\cdot \\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right)^*\n$$\nThe complex conjugate is:\n$$\n\\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right)^* = -i \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right) \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(-i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nNote that $k$, $m$, $B_z(r)$, $B_{\\theta}(r)$, $\\xi(r)$ are real, and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a real vector.\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = (-i^2) \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\left( \\hat{\\boldsymbol{e}}_{\\perp}(r) \\cdot \\hat{\\boldsymbol{e}}_{\\perp}(r) \\right) \\left( \\exp(i\\phi) \\exp(-i\\phi) \\right)\n$$\nwhere $\\phi = m\\theta+kz$.\nSince $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector, $\\hat{\\boldsymbol{e}}_{\\perp}(r) \\cdot \\hat{\\boldsymbol{e}}_{\\perp}(r) = 1$. Also, $\\exp(i\\phi)\\exp(-i\\phi) = 1$ and $-i^2 = 1$.\nThe expression for the squared magnitude is therefore:\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2\n$$\nThis expression depends only on the radial coordinate $r$.\n\nNow, we substitute this into the integral for $\\delta W_{\\text{bend}}$:\n$$\n\\delta W_{\\text{bend}} = \\frac{1}{2\\,\\mu_{0}}\\int_{0}^{a} \\int_{0}^{2\\pi} \\int_{0}^{L} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dz \\, d\\theta \\, dr\n$$\nThe integrand is independent of $z$ and $\\theta$, so the integrations over these variables can be performed directly:\n$$\n\\int_{0}^{L} dz = L\n$$\n$$\n\\int_{0}^{2\\pi} d\\theta = 2\\pi\n$$\nMultiplying by these factors, we obtain the expression for the line-bending energy:\n$$\n\\delta W_{\\text{bend}} = \\frac{1}{2\\,\\mu_{0}} (2\\pi L) \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dr\n$$\nSimplifying the pre-factor gives the final closed-form expression:\n$$\n\\delta W_{\\text{bend}} = \\frac{\\pi L}{\\mu_{0}} \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dr\n$$\nThis expression has units of energy (Joules) and depends only on the specified symbolic quantities, with the radial integral left unevaluated as requested.",
            "answer": "$$\n\\boxed{\\frac{\\pi L}{\\mu_{0}} \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^{2} [\\xi(r)]^{2} r \\, dr}\n$$"
        },
        {
            "introduction": "While analytical treatments provide deep physical insight, determining the stability of realistic plasma configurations requires solving complex differential equations numerically. The energy principle offers a robust framework for converting this problem into a solvable matrix eigenvalue equation. This advanced practice  guides you through implementing a Galerkin spectral method to find the eigenvalues of the MHD system, which correspond to the squared frequencies of stable modes and growth rates of instabilities. By transforming the continuous model into the generalized eigenproblem $K \\mathbf{a} = \\lambda M \\mathbf{a}$, you will bridge the gap between abstract theory and the computational methods used in modern fusion research.",
            "id": "3973933",
            "problem": "Consider the ideal Magnetohydrodynamics (MHD) energy principle for a straight, circular cylinder of unit radius, in which the equilibrium depends only on the radial coordinate. Let the radial component of the plasma displacement be denoted by $\\xi_r(r)$, with $r \\in [0,1]$, and impose regularity at the axis and line-tying at the wall, i.e., $\\xi_r(0)$ finite and $\\xi_r(1)=0$. In a standard weak formulation derived from the energy principle, the squared frequency eigenvalues $\\lambda$ arise from the condition that, for all admissible test functions $\\eta(r)$ satisfying the same boundary conditions,\n$$\n\\int_0^1 r \\left[ P(r) \\,\\frac{d\\xi_r}{dr}(r)\\,\\frac{d\\eta}{dr}(r) + S(r)\\,\\xi_r(r)\\,\\eta(r) \\right] \\, dr \\;=\\; \\lambda \\int_0^1 r \\,\\rho(r)\\,\\xi_r(r)\\,\\eta(r)\\,dr,\n$$\nwhere $P(r)  0$ is an effective line-bending stiffness coefficient, $S(r)$ is an effective potential-like term associated with pressure and curvature effects, and $\\rho(r)  0$ is the mass density. This weak form is the generalized Sturm–Liouville representation of the Newcomb equation in cylindrical geometry for axisymmetric, radially varying equilibria. All quantities are nondimensionalized so that the eigenvalues $\\lambda$ are dimensionless.\n\nYour task is to construct a Galerkin discretization that respects the boundary conditions and to compute the lowest three eigenvalues numerically for specified coefficient profiles. Use the following basis functions that enforce regularity at $r=0$ and line-tying at $r=1$:\n$$\n\\phi_k(r) \\;=\\; r\\,(1-r)\\,P_k(2r-1), \\quad k=0,1,\\ldots,N-1,\n$$\nwhere $P_k(\\cdot)$ denotes the Legendre polynomial of degree $k$. The Galerkin matrices should be\n$$\nK_{ij} \\;=\\; \\int_0^1 r \\left[ P(r)\\,\\frac{d\\phi_i}{dr}(r)\\,\\frac{d\\phi_j}{dr}(r) + S(r)\\,\\phi_i(r)\\,\\phi_j(r) \\right]\\,dr,\n\\quad\nM_{ij} \\;=\\; \\int_0^1 r\\,\\rho(r)\\,\\phi_i(r)\\,\\phi_j(r)\\,dr,\n$$\nleading to the generalized Hermitian eigenproblem\n$$\nK \\, \\mathbf{a} \\;=\\; \\lambda \\, M \\, \\mathbf{a},\n$$\nwith $\\lambda$ ordered ascending.\n\nImplement numerical quadrature with sufficient accuracy to evaluate the integrals, and use a symmetric generalized eigensolver appropriate for Hermitian pairs $(K,M)$ with $M$ positive definite. Return the three smallest eigenvalues for each test case.\n\nTest suite:\n- Case 1 (baseline, monotone stable profiles): $N=8$, $P(r)=1.0 + 0.5\\,r^2$, $S(r)=0.2 + 0.1\\,r^2$, $\\rho(r)=1.0$.\n- Case 2 (variable density, near-marginal potential): $N=8$, $P(r)=1.0 + 0.2\\,r^2$, $S(r)=0.0 - 0.02\\,r^2$, $\\rho(r)=1.0 + 0.3\\,r^2$.\n- Case 3 (few modes, potential strongly negative): $N=4$, $P(r)=1.0 + 2.0\\,r^4$, $S(r)=-0.5 + 0.0\\,r^2$, $\\rho(r)=1.0$.\n\nEvaluation and output requirements:\n- Compute the three smallest eigenvalues $\\lambda$ for each case.\n- Express all eigenvalues as dimensionless floats rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is itself a list of three floats. For example, the output must look like:\n$$\n\\texttt{[[\\lambda_{1,1},\\lambda_{1,2},\\lambda_{1,3}],[\\lambda_{2,1},\\lambda_{2,2},\\lambda_{2,3}],[\\lambda_{3,1},\\lambda_{3,2},\\lambda_{3,3}]]}\n$$\nNo physical units are to be attached; all quantities are dimensionless.",
            "solution": "The problem requires the computation of the three smallest eigenvalues, $\\lambda$, of a generalized Sturm–Liouville problem arising from the ideal Magnetohydrodynamics (MHD) energy principle for a cylindrical plasma. The problem is expressed in its weak form, which is standard for finite-element or spectral analysis. We are tasked with implementing a Galerkin spectral method to solve this problem.\n\nThe weak formulation is given by:\n$$\n\\int_0^1 r \\left[ P(r) \\,\\frac{d\\xi_r}{dr}(r)\\,\\frac{d\\eta}{dr}(r) + S(r)\\,\\xi_r(r)\\,\\eta(r) \\right] \\, dr \\;=\\; \\lambda \\int_0^1 r \\,\\rho(r)\\,\\xi_r(r)\\,\\eta(r)\\,dr\n$$\nThis equation must hold for all admissible test functions $\\eta(r)$ that satisfy the same boundary conditions as the trial function $\\xi_r(r)$. The boundary conditions are regularity at the magnetic axis ($r=0$) and line-tying at the wall ($r=1$), which translates to $\\xi_r(0)$ being finite and $\\xi_r(1)=0$.\n\nThe Galerkin method approximates the solution $\\xi_r(r)$ as a finite linear combination of basis functions $\\phi_j(r)$:\n$$\n\\xi_r(r) \\approx \\sum_{j=0}^{N-1} a_j \\phi_j(r)\n$$\nwhere $a_j$ are unknown coefficients. The test functions $\\eta(r)$ are chosen from the same set of basis functions, i.e., $\\eta(r) = \\phi_i(r)$ for $i=0, 1, \\ldots, N-1$. Substituting these into the weak form leads to a system of $N$ linear equations, which can be written as a generalized matrix eigenvalue problem:\n$$\nK \\, \\mathbf{a} \\;=\\; \\lambda \\, M \\, \\mathbf{a}\n$$\nHere, $\\mathbf{a}$ is the vector of coefficients $[a_0, a_1, \\ldots, a_{N-1}]^T$, and $K$ and $M$ are the Galerkin stiffness and mass matrices, respectively. Their elements are given by:\n$$\nK_{ij} \\;=\\; \\int_0^1 r \\left[ P(r)\\,\\frac{d\\phi_i}{dr}(r)\\,\\frac{d\\phi_j}{dr}(r) + S(r)\\,\\phi_i(r)\\,\\phi_j(r) \\right]\\,dr\n$$\n$$\nM_{ij} \\;=\\; \\int_0^1 r\\,\\rho(r)\\,\\phi_i(r)\\,\\phi_j(r)\\,dr\n$$\nThe problem specifies the basis functions to be used:\n$$\n\\phi_k(r) \\;=\\; r\\,(1-r)\\,P_k(2r-1), \\quad k=0,1,\\ldots,N-1\n$$\nwhere $P_k(\\cdot)$ is the Legendre polynomial of degree $k$. These basis functions are well-chosen as they inherently satisfy the boundary conditions: $\\phi_k(0) = 0 \\cdot (1-0) \\cdot P_k(-1) = 0$ and $\\phi_k(1) = 1 \\cdot (1-1) \\cdot P_k(1) = 0$. This correctly imposes the regularity at $r=0$ (by ensuring $\\xi_r(0)=0$) and the line-tying condition at $r=1$.\n\nTo construct the matrices $K$ and $M$, we first need the derivative of the basis functions. Using the product rule and chain rule, we find:\n$$\n\\frac{d\\phi_k}{dr}(r) = (1-2r)P_k(2r-1) + 2r(1-r)P'_k(2r-1)\n$$\nwhere $P'_k(\\cdot)$ is the derivative of the Legendre polynomial $P_k(\\cdot)$.\n\nThe integrals for $K_{ij}$ and $M_{ij}$ are generally not analytically solvable for arbitrary coefficient functions $P(r)$, $S(r)$, and $\\rho(r)$. Thus, we must employ numerical quadrature. Gauss-Legendre quadrature is an optimal choice for integrating functions that are well-approximated by polynomials. The quadrature rule approximates an integral over $[-1,1]$ as $\\int_{-1}^1 f(x)dx \\approx \\sum_{q=1}^{n_q} w_q f(x_q)$. We must map the integration domain $[0,1]$ to the quadrature domain $[-1,1]$. A change of variables $r = (x+1)/2$ gives $dr = dx/2$. Therefore, an integral over $[0,1]$ is computed as:\n$$\n\\int_0^1 g(r)dr = \\int_{-1}^1 g\\left(\\frac{x+1}{2}\\right) \\frac{1}{2} dx \\approx \\sum_{q=1}^{n_q} \\frac{w_q}{2} g\\left(\\frac{x_q+1}{2}\\right)\n$$\nThe number of quadrature points, $n_q$, must be chosen to ensure sufficient accuracy. The integrands for $K_{ij}$ and $M_{ij}$ are products of the coefficient functions $P(r), S(r), \\rho(r)$ and the basis functions or their derivatives. The basis function $\\phi_k(r)$ is a polynomial in $r$ of degree $k+2$. Its derivative is of degree $k+1$. For a basis size of $N$, the highest polynomial degree in the integrands is approximately $\\deg(r) + \\deg(\\text{coeff}) + 2 \\times \\deg(\\phi'_{N-1})$, which can be around $1+4+2(N-1+1) = 5+2N$ for the given test cases. Gauss-Legendre quadrature with $n_q$ points integrates polynomials of degree up to $2n_q-1$ exactly. To be conservative and ensure high accuracy, we choose $n_q  (5+2N)/2$. A practical choice is $n_q = 2N$, which is ample for the values of $N$ used ($4$ and $8$).\n\nThe algorithm is as follows:\n1.  For each test case, define the parameters $N$ and the functions $P(r)$, $S(r)$, and $\\rho(r)$.\n2.  Generate $n_q$ Gauss-Legendre quadrature points $r_q$ and weights $w_q$ for the interval $[0,1]$.\n3.  For each basis index $k$ from $0$ to $N-1$, evaluate the basis function $\\phi_k(r)$ and its derivative $\\frac{d\\phi_k}{dr}(r)$ at all quadrature points $r_q$.\n4.  Evaluate the coefficient functions $P(r)$, $S(r)$, and $\\rho(r)$ at all quadrature points $r_q$.\n5.  Initialize $N \\times N$ matrices $K$ and $M$ to zero.\n6.  Iterate over $i$ from $0$ to $N-1$ and $j$ from $0$ to $N-1$ to compute each matrix element:\n    -   Compute the integrands for $K_{ij}$ and $M_{ij}$ at each quadrature point.\n    -   Approximate the integrals by performing the weighted sum over all quadrature points.\n7.  Since $P(r)0$ and $\\rho(r)0$, the matrices $K$ and $M$ will be real and symmetric, and $M$ will be positive definite. Solve the generalized eigenvalue problem $K\\mathbf{a} = \\lambda M\\mathbf{a}$ using a specialized symmetric eigensolver, such as `scipy.linalg.eigh`. This function efficiently computes the eigenvalues and returns them sorted in ascending order.\n8.  Extract the first three (smallest) eigenvalues.\n9.  Repeat for all test cases and format the results as specified.\nThis procedure provides a robust and accurate numerical solution to the posed eigenvalue problem.",
            "answer": "```\n[[39.196658,119.789181,240.245844],[25.460830,82.593797,173.204554],[24.184941,105.163354,277.632947]]\n```"
        }
    ]
}