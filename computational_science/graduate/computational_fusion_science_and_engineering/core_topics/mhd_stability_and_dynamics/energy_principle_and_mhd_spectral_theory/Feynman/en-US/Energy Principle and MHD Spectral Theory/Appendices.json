{
    "hands_on_practices": [
        {
            "introduction": "The MHD energy principle provides a powerful tool for assessing plasma stability by evaluating the change in potential energy, $\\delta W$, resulting from a plasma displacement $\\boldsymbol{\\xi}$. This energy change is composed of several distinct physical effects, including plasma compression, magnetic field line bending, and pressure-driven curvature effects. This first practice  isolates the compressional energy term to clarify its physical meaning and demonstrate a key simplification: for incompressible motions where $\\nabla \\cdot \\boldsymbol{\\xi} = 0$, there is no work done against pressure forces, and this energy contribution vanishes entirely.",
            "id": "3973953",
            "problem": "Consider an ideal magnetohydrodynamic (MHD) plasma in a periodic cubic domain $\\Omega=[0,L]^{3}$ with uniform equilibrium pressure $p_{0}$ and constant adiabatic index $\\gamma$. The Lagrangian fluid displacement is denoted by $\\boldsymbol{\\xi}(\\boldsymbol{x})$, and the compressional contribution to the potential energy functional in the MHD energy principle is defined by\n$$\n\\delta W_{\\text{comp}}=\\frac{1}{2}\\int_{\\Omega}\\gamma\\,p_{0}\\,|\\nabla\\cdot\\boldsymbol{\\xi}|^{2}\\,\\mathrm{d}^{3}x.\n$$\nAssume a small-amplitude, incompressible trial displacement field of the form\n$$\n\\boldsymbol{\\xi}(\\boldsymbol{x})=\\xi_{0}\\left[\\cos(k x)\\,\\hat{\\boldsymbol{y}}-\\cos(k y)\\,\\hat{\\boldsymbol{x}}\\right],\n$$\nwith $k=\\frac{2\\pi n}{L}$ for some positive integer $n$, constant amplitude $\\xi_{0}$, and $\\hat{\\boldsymbol{x}},\\hat{\\boldsymbol{y}}$ unit vectors. Starting only from the conservation of mass in ideal MHD and the definition of incompressibility, justify the condition imposed on $\\nabla\\cdot\\boldsymbol{\\xi}$ and evaluate $\\delta W_{\\text{comp}}$ for the given $\\boldsymbol{\\xi}(\\boldsymbol{x})$. Clearly articulate the physical reason for your result in terms of pressure–volume work. Express your final answer in Joules. No rounding is required.",
            "solution": "### Part 1: Justification of the Incompressibility Condition\n\nThe condition of incompressibility for a fluid displacement $\\boldsymbol{\\xi}$ is that its divergence is zero, i.e., $\\nabla \\cdot \\boldsymbol{\\xi} = 0$. We will justify this starting from the conservation of mass in ideal MHD.\n\nThe continuity equation, which expresses the conservation of mass for a fluid, is:\n$$\n\\frac{\\partial\\rho}{\\partial t} + \\nabla \\cdot (\\rho \\boldsymbol{v}) = 0\n$$\nwhere $\\rho$ is the mass density and $\\boldsymbol{v}$ is the fluid velocity.\n\nWe linearize this equation for small perturbations around a static ($\\boldsymbol{v}_0 = 0$) and uniform ($\\rho_0 = \\text{constant}$) equilibrium state. We express the density and velocity as the sum of their equilibrium and first-order perturbation values:\n$$\n\\rho(\\boldsymbol{x}, t) = \\rho_0 + \\rho_1(\\boldsymbol{x}, t)\n$$\n$$\n\\boldsymbol{v}(\\boldsymbol{x}, t) = \\boldsymbol{v}_0 + \\boldsymbol{v}_1(\\boldsymbol{x}, t) = \\boldsymbol{v}_1(\\boldsymbol{x}, t)\n$$\nSubstituting these into the continuity equation gives:\n$$\n\\frac{\\partial}{\\partial t}(\\rho_0 + \\rho_1) + \\nabla \\cdot ((\\rho_0 + \\rho_1)\\boldsymbol{v}_1) = 0\n$$\nExpanding the divergence term:\n$$\n\\frac{\\partial \\rho_1}{\\partial t} + \\nabla \\cdot (\\rho_0 \\boldsymbol{v}_1) + \\nabla \\cdot (\\rho_1 \\boldsymbol{v}_1) = 0\n$$\nThe term $\\nabla \\cdot (\\rho_1 \\boldsymbol{v}_1)$ is a product of two first-order quantities, so it is a second-order term that can be neglected in the linearization. Since $\\rho_0$ is a constant, we have:\n$$\n\\frac{\\partial \\rho_1}{\\partial t} + \\rho_0 (\\nabla \\cdot \\boldsymbol{v}_1) = 0\n$$\nThis is the linearized continuity equation. The first-order fluid velocity $\\boldsymbol{v}_1$ is the time derivative of the Lagrangian displacement field $\\boldsymbol{\\xi}$:\n$$\n\\boldsymbol{v}_1 = \\frac{\\partial \\boldsymbol{\\xi}}{\\partial t}\n$$\nSubstituting this relation into the linearized continuity equation yields:\n$$\n\\frac{\\partial \\rho_1}{\\partial t} + \\rho_0 \\nabla \\cdot \\left(\\frac{\\partial \\boldsymbol{\\xi}}{\\partial t}\\right) = 0 \\quad \\implies \\quad \\frac{\\partial}{\\partial t}(\\rho_1 + \\rho_0 \\nabla \\cdot \\boldsymbol{\\xi}) = 0\n$$\nIntegrating with respect to time, we find that $\\rho_1 + \\rho_0 \\nabla \\cdot \\boldsymbol{\\xi}$ is constant in time. For a system that starts from an unperturbed state (where $\\rho_1 = 0$ and $\\boldsymbol{\\xi} = 0$), this constant must be zero. Therefore, we obtain the key relationship between the first-order density perturbation and the displacement:\n$$\n\\rho_1 = -\\rho_0 \\nabla \\cdot \\boldsymbol{\\xi}\n$$\nIncompressibility is the physical constraint that the density of a fluid element does not change as it moves with the flow. This is expressed by stating that the Lagrangian derivative of the density is zero:\n$$\n\\frac{D\\rho}{Dt} = \\frac{\\partial \\rho}{\\partial t} + \\boldsymbol{v} \\cdot \\nabla \\rho = 0\n$$\nTo first order, for a perturbation about a static ($\\boldsymbol{v}_0=0$) and uniform ($\\nabla\\rho_0=0$) equilibrium, this condition becomes:\n$$\n\\frac{\\partial (\\rho_0 + \\rho_1)}{\\partial t} + \\boldsymbol{v}_1 \\cdot \\nabla (\\rho_0 + \\rho_1) \\approx \\frac{\\partial \\rho_1}{\\partial t} = 0\n$$\nThus, an incompressible perturbation is one for which the Eulerian density perturbation does not change in time. Combining this with the result from the continuity equation, $\\frac{\\partial \\rho_1}{\\partial t} + \\rho_0 (\\nabla \\cdot \\boldsymbol{v}_1) = 0$, the condition $\\frac{\\partial \\rho_1}{\\partial t}=0$ directly implies that:\n$$\n\\rho_0 (\\nabla \\cdot \\boldsymbol{v}_1) = 0\n$$\nSince $\\rho_0 \\neq 0$, we must have $\\nabla \\cdot \\boldsymbol{v}_1 = 0$. Substituting $\\boldsymbol{v}_1 = \\frac{\\partial \\boldsymbol{\\xi}}{\\partial t}$, we get:\n$$\n\\nabla \\cdot \\left(\\frac{\\partial \\boldsymbol{\\xi}}{\\partial t}\\right) = \\frac{\\partial}{\\partial t}(\\nabla \\cdot \\boldsymbol{\\xi}) = 0\n$$\nThis means that $\\nabla \\cdot \\boldsymbol{\\xi}$ is constant in time. For any perturbation that grows from an initial state of $\\boldsymbol{\\xi} = 0$, this constant must be zero. Therefore, the condition for an incompressible displacement is $\\nabla \\cdot \\boldsymbol{\\xi} = 0$.\n\n### Part 2: Evaluation of $\\delta W_{\\text{comp}}$\n\nThe compressional component of the potential energy is given by:\n$$\n\\delta W_{\\text{comp}}=\\frac{1}{2}\\int_{\\Omega}\\gamma\\,p_{0}\\,|\\nabla\\cdot\\boldsymbol{\\xi}|^{2}\\,\\mathrm{d}^{3}x\n$$\nWe must evaluate this for the given trial displacement field:\n$$\n\\boldsymbol{\\xi}(\\boldsymbol{x})=\\xi_{0}\\left[\\cos(k x)\\,\\hat{\\boldsymbol{y}}-\\cos(k y)\\,\\hat{\\boldsymbol{x}}\\right]\n$$\nThe components of $\\boldsymbol{\\xi}$ are:\n$$\n\\xi_x = -\\xi_0 \\cos(k y)\n$$\n$$\n\\xi_y = \\xi_0 \\cos(k x)\n$$\n$$\n\\xi_z = 0\n$$\nWe now compute the divergence of $\\boldsymbol{\\xi}$:\n$$\n\\nabla\\cdot\\boldsymbol{\\xi} = \\frac{\\partial \\xi_x}{\\partial x} + \\frac{\\partial \\xi_y}{\\partial y} + \\frac{\\partial \\xi_z}{\\partial z}\n$$\nCalculating each term:\n$$\n\\frac{\\partial \\xi_x}{\\partial x} = \\frac{\\partial}{\\partial x}(-\\xi_0 \\cos(k y)) = 0\n$$\n$$\n\\frac{\\partial \\xi_y}{\\partial y} = \\frac{\\partial}{\\partial y}(\\xi_0 \\cos(k x)) = 0\n$$\n$$\n\\frac{\\partial \\xi_z}{\\partial z} = \\frac{\\partial}{\\partial z}(0) = 0\n$$\nTherefore, the divergence of the given displacement field is identically zero:\n$$\n\\nabla \\cdot \\boldsymbol{\\xi} = 0\n$$\nThis confirms that the provided field is indeed incompressible, as stated in the problem.\n\nNow, we substitute this result into the expression for $\\delta W_{\\text{comp}}$:\n$$\n\\delta W_{\\text{comp}} = \\frac{1}{2}\\int_{\\Omega}\\gamma\\,p_{0}\\,|0|^{2}\\,\\mathrm{d}^{3}x = \\frac{1}{2}\\int_{\\Omega} 0 \\,\\mathrm{d}^{3}x = 0\n$$\nThe value of the compressional potential energy for this displacement is $0$ Joules.\n\n### Part 3: Physical Reason for the Result\n\nThe term $\\delta W_{\\text{comp}}$ represents the change in potential energy due to the work done in compressing the plasma. In thermodynamics, the work done on a fluid via compression is related to the product of pressure and the change in volume, often expressed as $-p\\,\\mathrm{d}V$.\n\nIn the context of a continuous fluid, the local fractional change in volume, $\\frac{\\delta V}{V}$, associated with a fluid displacement $\\boldsymbol{\\xi}$ is given by its divergence, $\\nabla \\cdot \\boldsymbol{\\xi}$. The condition $\\nabla \\cdot \\boldsymbol{\\xi} = 0$ signifies that the displacement is volume-preserving. Although the fluid elements are moved and deformed, their local volume does not change. This is the definition of an incompressible motion.\n\nThe change in pressure, $\\delta p$, is related to the compression via the adiabatic law, which, in linearized form, is $\\delta p = -\\gamma p_0 (\\nabla \\cdot \\boldsymbol{\\xi})$. Since $\\nabla \\cdot \\boldsymbol{\\xi} = 0$ for the given displacement, there is no pressure perturbation, $\\delta p = 0$.\n\nBecause there is no change in volume ($\\nabla \\cdot \\boldsymbol{\\xi} = 0$) and consequently no change in pressure ($\\delta p = 0$), no \"pressure-volume\" work is done on or by the plasma. The displacement merely rearranges the fluid elements at constant volume. As a result, the energy stored in the form of compression, $\\delta W_{\\text{comp}}$, must be exactly zero. The integrand $\\gamma p_0 |\\nabla \\cdot \\boldsymbol{\\xi}|^2$ can be physically interpreted as an energy density associated with compression, which is zero everywhere for an incompressible motion.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Having examined plasma compression, we now turn to a crucial stabilizing mechanism in magnetized plasmas: the energy cost of bending magnetic field lines. This restoring force is fundamental to the existence of Alfvén waves and plays a key role in the stability of many MHD modes. The following exercise  provides direct experience in calculating this line-bending energy for a helical perturbation, introducing the vital $\\boldsymbol{B} \\cdot \\nabla$ operator which mathematically represents variation along the equilibrium magnetic field lines.",
            "id": "3973927",
            "problem": "Consider a straight, circular cylindrical plasma of radius $a$ and axial period $L$ in cylindrical coordinates $(r,\\theta,z)$ with an axisymmetric equilibrium magnetic field $\\boldsymbol{B}_0(r)=B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}$, where $B_{\\theta}(r)$ and $B_{z}(r)$ are smooth functions of $r$ and $B_{r}(r)=0$. Let the displacement be an ideal Magnetohydrodynamics (MHD) perturbation that is everywhere perpendicular to $\\boldsymbol{B}_0$, of the form $\\boldsymbol{\\xi}_{\\perp}(r,\\theta,z)=\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)$, where $m\\in\\mathbb{Z}$ is the poloidal mode number, $k\\in\\mathbb{R}$ is the axial wavenumber, $\\xi(r)$ is a real radial amplitude, and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector satisfying $\\hat{\\boldsymbol{e}}_{\\perp}(r)\\cdot\\boldsymbol{B}_0(r)=0$ and depending only on $r$. Assume ideal MHD and use the energy principle to isolate the magnetic line-bending contribution\n$$\n\\delta W_{\\text{bend}}=\\frac{1}{2\\,\\mu_{0}}\\int|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^{2}\\,d^{3}x,\n$$\nwhere $\\mu_{0}$ is the permeability of free space and $d^{3}x=r\\,dr\\,d\\theta\\,dz$. Starting from first principles, compute $\\delta W_{\\text{bend}}$ explicitly in terms of $m$, $k$, $L$, $\\mu_{0}$, $B_{\\theta}(r)$, $B_{z}(r)$, and $\\xi(r)$, performing the integrals over $\\theta$ and $z$ but leaving the radial integral unevaluated. State any geometric identities you use. Express the final energy in Joules. Do not provide any numerical evaluation; your final expression must be closed-form and depend only on the specified symbols. Do not include units in your boxed final answer.",
            "solution": "The objective is to compute the magnetic line-bending energy contribution, given by the expression:\n$$\n\\delta W_{\\text{bend}}=\\frac{1}{2\\,\\mu_{0}}\\int|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^{2}\\,d^{3}x\n$$\nThe integration is over the volume of the cylindrical plasma, which has a radius $a$ and an axial period $L$. The volume element in cylindrical coordinates $(r, \\theta, z)$ is $d^3x = r\\,dr\\,d\\theta\\,dz$. The integration limits are $r \\in [0, a]$, $\\theta \\in [0, 2\\pi]$, and $z \\in [0, L]$.\n\nThe core of the calculation is to evaluate the term $|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2$. The expression $\\boldsymbol{B}_0\\cdot\\nabla$ represents the directional derivative operator along the magnetic field $\\boldsymbol{B}_0$. In cylindrical coordinates, the gradient operator is $\\nabla = \\hat{\\boldsymbol{e}}_r \\frac{\\partial}{\\partial r} + \\hat{\\boldsymbol{e}}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\hat{\\boldsymbol{e}}_z \\frac{\\partial}{\\partial z}$.\nThe equilibrium magnetic field is given as $\\boldsymbol{B}_0(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}$.\nThe directional derivative operator is therefore:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla = \\left(B_{\\theta}(r)\\,\\hat{\\boldsymbol{e}}_{\\theta}+B_{z}(r)\\,\\hat{\\boldsymbol{e}}_{z}\\right) \\cdot \\left(\\hat{\\boldsymbol{e}}_r \\frac{\\partial}{\\partial r} + \\hat{\\boldsymbol{e}}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\hat{\\boldsymbol{e}}_z \\frac{\\partial}{\\partial z}\\right)\n$$\nUsing the orthonormality of the cylindrical basis vectors ($\\hat{\\boldsymbol{e}}_i \\cdot \\hat{\\boldsymbol{e}}_j = \\delta_{ij}$), this operator simplifies to:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla = \\frac{B_{\\theta}(r)}{r} \\frac{\\partial}{\\partial \\theta} + B_{z}(r) \\frac{\\partial}{\\partial z}\n$$\nThis is the primary geometric identity used in this derivation.\n\nWe apply this operator to the plasma displacement vector $\\boldsymbol{\\xi}_{\\perp}$, which is given as:\n$$\n\\boldsymbol{\\xi}_{\\perp}(r,\\theta,z)=\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nwhere $\\xi(r)$ is the radial amplitude and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector that depends only on the radial coordinate $r$. Therefore, the vector part $\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is constant with respect to the derivatives $\\frac{\\partial}{\\partial \\theta}$ and $\\frac{\\partial}{\\partial z}$. The derivatives act only on the exponential term.\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = \\left(\\frac{B_{\\theta}(r)}{r} \\frac{\\partial}{\\partial \\theta} + B_{z}(r) \\frac{\\partial}{\\partial z}\\right) \\left(\\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\\right)\n$$\nApplying the chain rule:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r) \\left[ \\left(\\frac{B_{\\theta}(r)}{r}\\right) (i\\,m) + B_{z}(r) (i\\,k) \\right] \\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nFactoring out the imaginary unit $i$:\n$$\n\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} = i \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right) \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nThis resulting quantity is a complex vector. We now compute its squared magnitude, $|\\cdot|^2$, which is the dot product of the vector with its complex conjugate.\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = \\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right) \\cdot \\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right)^*\n$$\nThe complex conjugate is:\n$$\n\\left( \\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp} \\right)^* = -i \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right) \\xi(r)\\,\\hat{\\boldsymbol{e}}_{\\perp}(r)\\,\\exp\\!\\big(-i\\,[m\\,\\theta+k\\,z]\\big)\n$$\nNote that $k$, $m$, $B_z(r)$, $B_{\\theta}(r)$, $\\xi(r)$ are real, and $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a real vector.\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = (-i^2) \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\left( \\hat{\\boldsymbol{e}}_{\\perp}(r) \\cdot \\hat{\\boldsymbol{e}}_{\\perp}(r) \\right) \\left( \\exp(i\\phi) \\exp(-i\\phi) \\right)\n$$\nwhere $\\phi = m\\theta+kz$.\nSince $\\hat{\\boldsymbol{e}}_{\\perp}(r)$ is a unit vector, $\\hat{\\boldsymbol{e}}_{\\perp}(r) \\cdot \\hat{\\boldsymbol{e}}_{\\perp}(r) = 1$. Also, $\\exp(i\\phi)\\exp(-i\\phi) = 1$ and $-i^2 = 1$.\nThe expression for the squared magnitude is therefore:\n$$\n|\\boldsymbol{B}_0\\cdot\\nabla\\boldsymbol{\\xi}_{\\perp}|^2 = \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2\n$$\nThis expression depends only on the radial coordinate $r$.\n\nNow, we substitute this into the integral for $\\delta W_{\\text{bend}}$:\n$$\n\\delta W_{\\text{bend}} = \\frac{1}{2\\,\\mu_{0}}\\int_{0}^{a} \\int_{0}^{2\\pi} \\int_{0}^{L} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dz \\, d\\theta \\, dr\n$$\nThe integrand is independent of $z$ and $\\theta$, so the integrations over these variables can be performed directly:\n$$\n\\int_{0}^{L} dz = L\n$$\n$$\n\\int_{0}^{2\\pi} d\\theta = 2\\pi\n$$\nMultiplying by these factors, we obtain the expression for the line-bending energy:\n$$\n\\delta W_{\\text{bend}} = \\frac{1}{2\\,\\mu_{0}} (2\\pi L) \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dr\n$$\nSimplifying the pre-factor gives the final closed-form expression:\n$$\n\\delta W_{\\text{bend}} = \\frac{\\pi L}{\\mu_{0}} \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^2 [\\xi(r)]^2 \\, r \\, dr\n$$\nThis expression has units of energy (Joules) and depends only on the specified symbolic quantities, with the radial integral left unevaluated as requested.",
            "answer": "$$\n\\boxed{\\frac{\\pi L}{\\mu_{0}} \\int_{0}^{a} \\left( k B_{z}(r) + \\frac{m}{r} B_{\\theta}(r) \\right)^{2} [\\xi(r)]^{2} r \\, dr}\n$$"
        },
        {
            "introduction": "The previous practices focused on calculating individual contributions to the total potential energy $\\delta W$. The ultimate goal of stability analysis, however, is to find the specific mode structures $\\boldsymbol{\\xi}(\\boldsymbol{x})$ and their corresponding squared frequencies $\\lambda = \\omega^2$ by solving the full spectral problem derived from the energy principle. This final hands-on practice  transitions from analytical calculation to computational physics, guiding you through the process of discretizing the MHD stability equations using a Galerkin method to numerically compute the eigenvalue spectrum.",
            "id": "3973933",
            "problem": "Consider the ideal Magnetohydrodynamics (MHD) energy principle for a straight, circular cylinder of unit radius, in which the equilibrium depends only on the radial coordinate. Let the radial component of the plasma displacement be denoted by $\\xi_r(r)$, with $r \\in [0,1]$, and impose regularity at the axis and line-tying at the wall, i.e., $\\xi_r(0)$ finite and $\\xi_r(1)=0$. In a standard weak formulation derived from the energy principle, the squared frequency eigenvalues $\\lambda$ arise from the condition that, for all admissible test functions $\\eta(r)$ satisfying the same boundary conditions,\n$$\n\\int_0^1 r \\left[ P(r) \\,\\frac{d\\xi_r}{dr}(r)\\,\\frac{d\\eta}{dr}(r) + S(r)\\,\\xi_r(r)\\,\\eta(r) \\right] \\, dr \\;=\\; \\lambda \\int_0^1 r \\,\\rho(r)\\,\\xi_r(r)\\,\\eta(r)\\,dr,\n$$\nwhere $P(r)  0$ is an effective line-bending stiffness coefficient, $S(r)$ is an effective potential-like term associated with pressure and curvature effects, and $\\rho(r)  0$ is the mass density. This weak form is the generalized Sturm–Liouville representation of the Newcomb equation in cylindrical geometry for axisymmetric, radially varying equilibria. All quantities are nondimensionalized so that the eigenvalues $\\lambda$ are dimensionless.\n\nYour task is to construct a Galerkin discretization that respects the boundary conditions and to compute the lowest three eigenvalues numerically for specified coefficient profiles. Use the following basis functions that enforce regularity at $r=0$ and line-tying at $r=1$:\n$$\n\\phi_k(r) \\;=\\; r\\,(1-r)\\,P_k(2r-1), \\quad k=0,1,\\ldots,N-1,\n$$\nwhere $P_k(\\cdot)$ denotes the Legendre polynomial of degree $k$. The Galerkin matrices should be\n$$\nK_{ij} \\;=\\; \\int_0^1 r \\left[ P(r)\\,\\frac{d\\phi_i}{dr}(r)\\,\\frac{d\\phi_j}{dr}(r) + S(r)\\,\\phi_i(r)\\,\\phi_j(r) \\right]\\,dr,\n\\quad\nM_{ij} \\;=\\; \\int_0^1 r\\,\\rho(r)\\,\\phi_i(r)\\,\\phi_j(r)\\,dr,\n$$\nleading to the generalized Hermitian eigenproblem\n$$\nK \\, \\mathbf{a} \\;=\\; \\lambda \\, M \\, \\mathbf{a},\n$$\nwith $\\lambda$ ordered ascending.\n\nImplement numerical quadrature with sufficient accuracy to evaluate the integrals, and use a symmetric generalized eigensolver appropriate for Hermitian pairs $(K,M)$ with $M$ positive definite. Return the three smallest eigenvalues for each test case.\n\nTest suite:\n- Case 1 (baseline, monotone stable profiles): $N=8$, $P(r)=1.0 + 0.5\\,r^2$, $S(r)=0.2 + 0.1\\,r^2$, $\\rho(r)=1.0$.\n- Case 2 (variable density, near-marginal potential): $N=8$, $P(r)=1.0 + 0.2\\,r^2$, $S(r)=0.0 - 0.02\\,r^2$, $\\rho(r)=1.0 + 0.3\\,r^2$.\n- Case 3 (few modes, potential strongly negative): $N=4$, $P(r)=1.0 + 2.0\\,r^4$, $S(r)=-0.5 + 0.0\\,r^2$, $\\rho(r)=1.0$.\n\nEvaluation and output requirements:\n- Compute the three smallest eigenvalues $\\lambda$ for each case.\n- Express all eigenvalues as dimensionless floats rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is itself a list of three floats. For example, the output must look like:\n$$\n\\texttt{[[\\lambda_{1,1},\\lambda_{1,2},\\lambda_{1,3}],[\\lambda_{2,1},\\lambda_{2,2},\\lambda_{2,3}],[\\lambda_{3,1},\\lambda_{3,2},\\lambda_{3,3}]]}\n$$\nNo physical units are to be attached; all quantities are dimensionless.",
            "solution": "The problem requires the computation of the three smallest eigenvalues, $\\lambda$, of a generalized Sturm–Liouville problem arising from the ideal Magnetohydrodynamics (MHD) energy principle for a cylindrical plasma. The problem is expressed in its weak form. We are tasked with implementing a Galerkin spectral method to solve this problem.\n\nThe Galerkin method approximates the solution $\\xi_r(r)$ as a finite linear combination of basis functions $\\phi_j(r)$:\n$$\n\\xi_r(r) \\approx \\sum_{j=0}^{N-1} a_j \\phi_j(r)\n$$\nwhere $a_j$ are unknown coefficients. The test functions $\\eta(r)$ are chosen from the same set of basis functions, i.e., $\\eta(r) = \\phi_i(r)$ for $i=0, 1, \\ldots, N-1$. Substituting these into the weak form leads to a system of $N$ linear equations, which can be written as a generalized matrix eigenvalue problem:\n$$\nK \\, \\mathbf{a} \\;=\\; \\lambda \\, M \\, \\mathbf{a}\n$$\nHere, $\\mathbf{a}$ is the vector of coefficients $[a_0, a_1, \\ldots, a_{N-1}]^T$, and $K$ and $M$ are the Galerkin stiffness and mass matrices, respectively. Their elements are given by:\n$$\nK_{ij} \\;=\\; \\int_0^1 r \\left[ P(r)\\,\\frac{d\\phi_i}{dr}(r)\\,\\frac{d\\phi_j}{dr}(r) + S(r)\\,\\phi_i(r)\\,\\phi_j(r) \\right]\\,dr\n$$\n$$\nM_{ij} \\;=\\; \\int_0^1 r\\,\\rho(r)\\,\\phi_i(r)\\,\\phi_j(r)\\,dr\n$$\nThe problem specifies the basis functions to be used:\n$$\n\\phi_k(r) \\;=\\; r\\,(1-r)\\,P_k(2r-1), \\quad k=0,1,\\ldots,N-1\n$$\nwhere $P_k(\\cdot)$ is the Legendre polynomial of degree $k$. These basis functions are well-chosen as they inherently satisfy the boundary conditions: $\\phi_k(0) = 0 \\cdot (1-0) \\cdot P_k(-1) = 0$ and $\\phi_k(1) = 1 \\cdot (1-1) \\cdot P_k(1) = 0$. This correctly imposes the regularity at $r=0$ (by ensuring $\\xi_r(0)=0$) and the line-tying condition at $r=1$.\n\nTo construct the matrices $K$ and $M$, we first need the derivative of the basis functions. Using the product rule and chain rule, we find:\n$$\n\\frac{d\\phi_k}{dr}(r) = (1-2r)P_k(2r-1) + 2r(1-r)P'_k(2r-1)\n$$\nwhere $P'_k(\\cdot)$ is the derivative of the Legendre polynomial $P_k(\\cdot)$.\n\nThe integrals for $K_{ij}$ and $M_{ij}$ are generally not analytically solvable for arbitrary coefficient functions $P(r)$, $S(r)$, and $\\rho(r)$. Thus, we must employ numerical quadrature. Gauss-Legendre quadrature is an optimal choice for integrating functions that are well-approximated by polynomials. The quadrature rule approximates an integral over $[-1,1]$ as $\\int_{-1}^1 f(x)dx \\approx \\sum_{q=1}^{n_q} w_q f(x_q)$. We must map the integration domain $[0,1]$ to the quadrature domain $[-1,1]$. A change of variables $r = (x+1)/2$ gives $dr = dx/2$. Therefore, an integral over $[0,1]$ is computed as:\n$$\n\\int_0^1 g(r)dr = \\int_{-1}^1 g\\left(\\frac{x+1}{2}\\right) \\frac{1}{2} dx \\approx \\sum_{q=1}^{n_q} \\frac{w_q}{2} g\\left(\\frac{x_q+1}{2}\\right)\n$$\nThe number of quadrature points, $n_q$, must be chosen to ensure sufficient accuracy. The integrands for $K_{ij}$ and $M_{ij}$ are products of the coefficient functions $P(r), S(r), \\rho(r)$ and the basis functions or their derivatives. The basis function $\\phi_k(r)$ is a polynomial in $r$ of degree $k+2$. Its derivative is of degree $k+1$. For a basis size of $N$, the highest polynomial degree in the integrands is approximately $\\deg(r) + \\deg(\\text{coeff}) + 2 \\times \\deg(\\phi'_{N-1})$, which can be around $1+4+2(N-1+1) = 5+2N$ for the given test cases. Gauss-Legendre quadrature with $n_q$ points integrates polynomials of degree up to $2n_q-1$ exactly. To be conservative and ensure high accuracy, we choose $n_q > (5+2N)/2$. A practical choice is $n_q = 2N$, which is ample for the values of $N$ used ($4$ and $8$).\n\nThe algorithm is as follows:\n1.  For each test case, define the parameters $N$ and the functions $P(r)$, $S(r)$, and $\\rho(r)$.\n2.  Generate $n_q$ Gauss-Legendre quadrature points $r_q$ and weights $w_q$ for the interval $[0,1]$.\n3.  For each basis index $k$ from $0$ to $N-1$, evaluate the basis function $\\phi_k(r)$ and its derivative $\\frac{d\\phi_k}{dr}(r)$ at all quadrature points $r_q$.\n4.  Evaluate the coefficient functions $P(r)$, $S(r)$, and $\\rho(r)$ at all quadrature points $r_q$.\n5.  Initialize $N \\times N$ matrices $K$ and $M$ to zero.\n6.  Iterate over $i$ from $0$ to $N-1$ and $j$ from $0$ to $N-1$ to compute each matrix element:\n    -   Compute the integrands for $K_{ij}$ and $M_{ij}$ at each quadrature point.\n    -   Approximate the integrals by performing the weighted sum over all quadrature points.\n7.  Since $P(r)0$ and $\\rho(r)0$, the matrices $K$ and $M$ will be real and symmetric, and $M$ will be positive definite. Solve the generalized eigenvalue problem $K\\mathbf{a} = \\lambda M\\mathbf{a}$ using a specialized symmetric eigensolver, such as `scipy.linalg.eigh`. This function efficiently computes the eigenvalues and returns them sorted in ascending order.\n8.  Extract the first three (smallest) eigenvalues.\n9.  Repeat for all test cases and format the results as specified.\nThis procedure provides a robust and accurate numerical solution to the posed eigenvalue problem.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom scipy.special import legendre\n\ndef solve():\n    \"\"\"\n    Main function to solve the MHD eigenvalue problem for the given test cases.\n    \"\"\"\n\n    def calculate_eigenvalues(N, P_func, S_func, rho_func):\n        \"\"\"\n        Constructs and solves the generalized eigenvalue problem for a given set of profiles.\n\n        Args:\n            N (int): Number of basis functions.\n            P_func (callable): Function P(r).\n            S_func (callable): Function S(r).\n            rho_func (callable): Function rho(r).\n\n        Returns:\n            np.ndarray: The three smallest eigenvalues.\n        \"\"\"\n        # 1. Set up numerical quadrature\n        # Use a number of quadrature points sufficient for polynomial accuracy.\n        # 2*N points are more than enough for the polynomial degrees involved.\n        n_quad = 2 * N\n        # Get standard Gauss-Legendre points and weights for [-1, 1]\n        x_q, w_q_std = np.polynomial.legendre.leggauss(n_quad)\n        # Transform to interval [0, 1]\n        r_q = (x_q + 1.0) / 2.0\n        w_q = w_q_std / 2.0\n\n        # 2. Evaluate basis functions and their derivatives at quadrature points\n        phi_vals = np.zeros((N, n_quad))\n        dphi_vals = np.zeros((N, n_quad))\n\n        # Pre-calculate r-dependent terms at quadrature points\n        r_term = r_q * (1.0 - r_q)\n        dr_term = 1.0 - 2.0 * r_q\n        x_map = 2.0 * r_q - 1.0\n\n        for k in range(N):\n            leg_poly = legendre(k)\n            leg_poly_deriv = leg_poly.deriv()\n            \n            Pk_vals = leg_poly(x_map)\n            dPk_vals = leg_poly_deriv(x_map)\n\n            phi_vals[k, :] = r_term * Pk_vals\n            dphi_vals[k, :] = dr_term * Pk_vals + 2.0 * r_term * dPk_vals\n\n        # 3. Evaluate coefficient functions at quadrature points\n        P_vals = P_func(r_q)\n        S_vals = S_func(r_q)\n        rho_vals = rho_func(r_q)\n\n        # 4. Assemble the K and M matrices\n        K = np.zeros((N, N))\n        M = np.zeros((N, N))\n\n        # Weight the basis function values by quadrature weights for summation\n        # This simplifies the inner loop. The integrand is evaluated and then summed.\n        for i in range(N):\n            for j in range(i, N): # Exploit symmetry\n                # Integrand for K_ij: r * [P * d(phi_i)/dr * d(phi_j)/dr + S * phi_i * phi_j]\n                k_integrand = r_q * (\n                    P_vals * dphi_vals[i, :] * dphi_vals[j, :] +\n                    S_vals * phi_vals[i, :] * phi_vals[j, :]\n                )\n                # Integrand for M_ij: r * rho * phi_i * phi_j\n                m_integrand = r_q * rho_vals * phi_vals[i, :] * phi_vals[j, :]\n\n                K[i, j] = np.sum(w_q * k_integrand)\n                M[i, j] = np.sum(w_q * m_integrand)\n\n                # Assign symmetric part\n                if i != j:\n                    K[j, i] = K[i, j]\n                    M[j, i] = M[i, j]\n        \n        # 5. Solve the generalized eigenvalue problem K a = lambda M a\n        # eigh is for symmetric/Hermitian matrices and returns sorted eigenvalues.\n        eigenvalues = eigh(K, M, eigvals_only=True)\n\n        # 6. Return the three smallest eigenvalues\n        return eigenvalues[:3]\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"N\": 8,\n            \"P\": lambda r: 1.0 + 0.5 * r**2,\n            \"S\": lambda r: 0.2 + 0.1 * r**2,\n            \"rho\": lambda r: 1.0\n        },\n        {\n            \"N\": 8,\n            \"P\": lambda r: 1.0 + 0.2 * r**2,\n            \"S\": lambda r: 0.0 - 0.02 * r**2,\n            \"rho\": lambda r: 1.0 + 0.3 * r**2\n        },\n        {\n            \"N\": 4,\n            \"P\": lambda r: 1.0 + 2.0 * r**4,\n            \"S\": lambda r: -0.5 + 0.0 * r**2,\n            \"rho\": lambda r: 1.0\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        eigenvalues = calculate_eigenvalues(case[\"N\"], case[\"P\"], case[\"S\"], case[\"rho\"])\n        all_results.append(eigenvalues)\n\n    # Format the output as specified: [[a,b,c],[d,e,f],...]\n    formatted_results = [\n        f\"[{','.join(f'{val:.6f}' for val in res)}]\" for res in all_results\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}