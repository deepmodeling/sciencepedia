{
    "hands_on_practices": [
        {
            "introduction": "Magnetic islands in fusion plasmas do not form arbitrarily; they are seeded at specific locations where the magnetic field lines have a resonant helical structure. This practice provides the fundamental skill of identifying these \"resonant surfaces\" by connecting the plasma's safety factor profile, $q(r)$, to the mode numbers $(m,n)$ of a potential instability. Mastering this calculation is the essential first step in predicting where a plasma is vulnerable to the growth of tearing modes. ",
            "id": "4006721",
            "problem": "Consider an axisymmetric toroidal confinement device operating in the resistive Magnetohydrodynamics (MHD) regime, with minor radius $a=0.50$ meters. The field-line safety factor $q(r)$ is defined as the ratio of toroidal to poloidal field-line winding, and rational surfaces arise where the field-line closes after an integer number of poloidal and toroidal transits. Such a rational (resonant) surface occurs where $q(r)$ equals a rational value $m/n$, with $m$ and $n$ coprime integers.\n\nAssume that the safety factor profile is quadratic in the minor radius $r$, given by $q(r)=q_0+\\alpha r^2$, where $q_0$ and $\\alpha$ are positive constants. For a tearing mode characterized by poloidal mode number $m=2$ and toroidal mode number $n=1$, determine the radial location $r_s$ of the $m/n$ resonant surface by starting from the fundamental definition of a rational surface and the given $q(r)$ profile. Explicitly establish any mathematical conditions required for the existence and uniqueness of $r_s$ within the plasma column $0 \\leq r \\leq a$, then evaluate $r_s$ for $q_0=1.10$ and $\\alpha=10.0$ meters$^{-2}$.\n\nRound your final numerical result to $3$ significant figures. Express your final numerical result in meters.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution. The concepts of safety factor, rational surfaces, and tearing modes are fundamental to magnetohydrodynamics (MHD) in toroidal fusion plasmas. The quadratic safety factor profile is a common and valid approximation. All provided parameters are physically reasonable. Therefore, the problem is valid, and we may proceed with the solution.\n\nThe fundamental definition of a resonant (or rational) magnetic surface is that the safety factor $q$ at the radial location $r_s$ of that surface is equal to a rational number $m/n$, where $m$ and $n$ are the poloidal and toroidal mode numbers, respectively. This condition is expressed as:\n$$q(r_s) = \\frac{m}{n}$$\n\nThe problem provides a specific quadratic profile for the safety factor as a function of the minor radius $r$:\n$$q(r) = q_0 + \\alpha r^2$$\nwhere $q_0$ and $\\alpha$ are positive constants.\n\nTo find the radial location $r_s$ of the resonant surface, we substitute the given $q(r)$ profile into the defining condition:\n$$q_0 + \\alpha r_s^2 = \\frac{m}{n}$$\n\nWe can now solve this equation for $r_s$. Rearranging the terms to isolate $r_s^2$:\n$$\\alpha r_s^2 = \\frac{m}{n} - q_0$$\n$$r_s^2 = \\frac{\\frac{m}{n} - q_0}{\\alpha}$$\n\nSince $r_s$ represents a physical radius, it must be a non-negative real number. We take the positive square root of the expression for $r_s^2$:\n$$r_s = \\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}}$$\n\nNext, we establish the mathematical conditions required for the existence and uniqueness of $r_s$ within the plasma column, which is defined by the domain $0 \\leq r \\leq a$.\n\n1.  **Existence of a real solution:** For $r_s$ to be a real number, the argument of the square root must be non-negative.\n    $$\\frac{\\frac{m}{n} - q_0}{\\alpha} \\geq 0$$\n    The problem states that $\\alpha$ is a positive constant ($\\alpha  0$). Therefore, the numerator must also be non-negative:\n    $$\\frac{m}{n} - q_0 \\geq 0 \\implies \\frac{m}{n} \\geq q_0$$\n    This condition means that the resonant value $m/n$ must be greater than or equal to the safety factor at the magnetic axis ($q_0 = q(0)$).\n\n2.  **Uniqueness of the solution:** The equation for $r_s^2$ is linear. If a real solution exists (i.e., if the condition above is met), there is exactly one non-negative value for $r_s$. Therefore, if a resonant surface exists, its location is unique.\n\n3.  **Location within the plasma column:** The resonant surface must be located within the physical boundaries of the plasma, $0 \\leq r_s \\leq a$.\n    The condition $r_s \\geq 0$ is already satisfied by the first condition and by taking the positive root. We must also ensure that $r_s \\leq a$:\n    $$\\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}} \\leq a$$\n    Since both sides of the inequality are non-negative, we can square them without changing the direction of the inequality:\n    $$\\frac{\\frac{m}{n} - q_0}{\\alpha} \\leq a^2$$\n    Multiplying by $\\alpha$ (which is positive):\n    $$\\frac{m}{n} - q_0 \\leq \\alpha a^2$$\n    $$\\frac{m}{n} \\leq q_0 + \\alpha a^2$$\n    Recognizing that the right-hand side is the safety factor at the plasma edge, $q(a) = q_0 + \\alpha a^2$, the condition becomes:\n    $$\\frac{m}{n} \\leq q(a)$$\n\nCombining these conditions, a unique resonant surface for the $(m, n)$ tearing mode exists within the plasma column if and only if the mode's rational value $m/n$ lies between the on-axis safety factor and the edge safety factor:\n$$q_0 \\leq \\frac{m}{n} \\leq q(a)$$\n\nNow, we evaluate $r_s$ using the given numerical values:\nPoloidal mode number $m=2$.\nToroidal mode number $n=1$.\nSafety factor on-axis $q_0 = 1.10$.\nProfile parameter $\\alpha = 10.0$ meters$^{-2}$.\nMinor radius $a = 0.50$ meters.\n\nFirst, we calculate the rational value $m/n$:\n$$\\frac{m}{n} = \\frac{2}{1} = 2$$\n\nNext, we verify that the conditions for existence are met.\n1.  Check if $\\frac{m}{n} \\geq q_0$:\n    $$2 \\geq 1.10$$\n    This condition is satisfied.\n2.  Check if $\\frac{m}{n} \\leq q(a)$. We first compute $q(a)$:\n    $$q(a) = q_0 + \\alpha a^2 = 1.10 + (10.0)(0.50)^2 = 1.10 + (10.0)(0.25) = 1.10 + 2.50 = 3.60$$\n    Now, check the condition:\n    $$2 \\leq 3.60$$\n    This condition is also satisfied.\nSince $1.10 \\leq 2 \\leq 3.60$, a unique resonant surface exists within the plasma.\n\nFinally, we compute the value of $r_s$:\n$$r_s = \\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}} = \\sqrt{\\frac{2 - 1.10}{10.0}}$$\n$$r_s = \\sqrt{\\frac{0.90}{10.0}} = \\sqrt{0.09}$$\n$$r_s = 0.3 \\text{ meters}$$\n\nThe problem requires the final answer to be rounded to $3$ significant figures. The value $0.3$ is exact, so to express it with $3$ significant figures, we write it as $0.300$.",
            "answer": "$$\\boxed{0.300}$$"
        },
        {
            "introduction": "Once the location of a resonant surface is known, the next step is to understand the structure of the magnetic island that can form there. This practice introduces the elegant formalism of Hamiltonian mechanics to describe the topology of perturbed magnetic field lines, allowing you to analytically derive an island's characteristic shape and size. By implementing a Poincaré plotter to visualize the field line trajectories, you will develop a direct, visual intuition for these structures that is indispensable for any computational fusion scientist. ",
            "id": "4006671",
            "problem": "Consider a reduced model of magnetic field-line flow in an axisymmetric torus with a single-helicity perturbation. Let the field-line variables be the poloidal angle $\\theta$, the toroidal angle $\\phi$, and a dimensionless radial-like flux coordinate $\\psi$. Assume an ideal Magnetohydrodynamics (MHD) equilibrium with a safety factor $q(\\psi)$, and a single helical perturbation with mode numbers $m$ and $n$, amplitude $\\varepsilon$, and a constant radial envelope $B$. Work in dimensionless units throughout, and use radians for all angles.\n\nThe field-line equations in the Hamiltonian form are to be taken as the fundamental base:\n- The field-line flow is generated by a scalar Hamiltonian $H(\\psi,\\theta,\\phi)$ such that the canonical equations with $\\phi$ as the independent variable are\n$$\n\\frac{d\\psi}{d\\phi}=-\\frac{\\partial H}{\\partial \\theta},\\qquad\n\\frac{d\\theta}{d\\phi}=\\frac{\\partial H}{\\partial \\psi}.\n$$\n- For the unperturbed axisymmetric equilibrium, use the well-tested relation\n$$\n\\frac{d\\theta}{d\\phi}=\\frac{1}{q(\\psi)}.\n$$\n- Introduce a single-helicity perturbation with phase $m\\theta-n\\phi$ and constant envelope $B$, so that near resonance the dominant radial drive is\n$$\n\\frac{d\\psi}{d\\phi}=\\varepsilon\\,m\\,B\\,\\sin\\!\\big(m\\theta-n\\phi\\big),\n$$\nand retain the unperturbed poloidal advance $d\\theta/d\\phi=1/q(\\psi)$.\n\nAssume a locally linear safety factor profile near a resonant surface $\\psi_s$ where $q(\\psi_s)=m/n$:\n$$\nq(\\psi)=q_s+q'(\\psi-\\psi_s),\\quad \\text{with}\\quad q_s=\\frac{m}{n},\\quad q'0.\n$$\n\nYour tasks:\n1. Starting from the canonical field-line equations above and the definition of the resonant phase $\\chi=m\\theta-n\\phi$, derive the near-resonant reduced Hamiltonian description for $(\\psi,\\chi)$ and the corresponding separatrix contour. You must base your derivation on first principles (canonical equations and linearization near $\\psi_s$), and you must not invoke any pre-remembered shortcut formulas. Explicitly show how the separatrix contour emerges from the reduced Hamiltonian.\n2. Implement a program that:\n   - Integrates the field-line ordinary differential equations for many initial conditions near $\\psi_s$ using a fixed-step fourth-order Runge–Kutta method over toroidal angle $\\phi$.\n   - Constructs a Poincaré map by strobing the trajectories at fixed $\\phi$ modulo $2\\pi$; that is, record $(\\theta \\bmod 2\\pi,\\psi)$ at $\\phi=2\\pi k$ for integer $k$.\n   - Computes the separatrix contour implied by the reduced Hamiltonian from Task 1 by evaluating the contour condition on a grid of the resonant phase $\\chi$ in $[0,2\\pi]$, and numerically extracts the island half-width $w$ as the maximum radial excursion $|\\,\\psi-\\psi_s\\,|$ along the separatrix contour. Report $w$ in dimensionless $\\psi$-units as a float.\n3. Use the following test suite of parameter sets. For each case, compute the island half-width $w$ from the separatrix contour derived in Task 1. Use angles in radians and dimensionless units for all quantities. The test cases are:\n   - Case A (happy path near-resonant, small amplitude): $m=2$, $n=1$, $\\varepsilon=10^{-3}$, $B=1$, $q'=3/4$, $\\psi_s=0$, $q_s=m/n$.\n   - Case B (no perturbation boundary): $m=2$, $n=1$, $\\varepsilon=0$, $B=1$, $q'=3/4$, $\\psi_s=0$, $q_s=m/n$.\n   - Case C (different helicity, moderate amplitude): $m=3$, $n=2$, $\\varepsilon=2\\times 10^{-3}$, $B=4/5$, $q'=1/2$, $\\psi_s=0$, $q_s=m/n$.\n   - Case D (small shear edge case): $m=2$, $n=1$, $\\varepsilon=2\\times 10^{-3}$, $B=1$, $q'=1/10$, $\\psi_s=0$, $q_s=m/n$.\n\nProgram requirements and output specification:\n- Implement the numerical integrator for the Poincaré map as described, even if the final numerical value of $w$ is extracted from the separatrix contour rather than directly from the map points.\n- For numerical extraction of $w$, compute the separatrix contour using the reduced Hamiltonian derived in Task 1 and evaluate the maximum $|\\,\\psi-\\psi_s\\,|$ along this contour over a uniform grid of $\\chi$ values.\n- Your program must produce a single line of output containing a comma-separated list enclosed in square brackets with the four $w$ values corresponding to Cases A–D, each rounded to six decimal places, like $[w_A,w_B,w_C,w_D]$.",
            "solution": "The problem statement has been critically validated and is deemed to be scientifically grounded, well-posed, objective, and self-contained. It presents a standard, simplified model of magnetic island formation in a toroidal plasma, based on Hamiltonian mechanics. The parameters provided are consistent and sufficient for a unique solution. The tasks are clearly defined and formalizable.\n\nThe solution proceeds in two parts. First, a theoretical derivation of the reduced Hamiltonian and the separatrix contour, leading to an analytical expression for the island half-width, $w$. Second, an explanation of the numerical implementation that computes $w$ based on the derived contour equation.\n\n### Part 1: Derivation of the Reduced Hamiltonian and Separatrix\n\nWe are given the field-line equations of motion with toroidal angle $\\phi$ as the independent variable:\n$$\n\\frac{d\\psi}{d\\phi} = \\varepsilon\\,m\\,B\\,\\sin(m\\theta - n\\phi)\n$$\n$$\n\\frac{d\\theta}{d\\phi} = \\frac{1}{q(\\psi)}\n$$\nHere, $\\psi$ is the radial flux coordinate, $\\theta$ is the poloidal angle, $q(\\psi)$ is the safety factor, $\\varepsilon$ is the perturbation amplitude, and $m$ and $n$ are the poloidal and toroidal mode numbers, respectively.\n\nThe key to analyzing the system near a resonance is to transform to a reference frame that rotates with the perturbation. We define the resonant phase angle $\\chi$ as:\n$$\n\\chi = m\\theta - n\\phi\n$$\nDifferentiating $\\chi$ with respect to $\\phi$ gives the equation for its evolution:\n$$\n\\frac{d\\chi}{d\\phi} = m \\frac{d\\theta}{d\\phi} - n = \\frac{m}{q(\\psi)} - n\n$$\nThe equation for $\\psi$ can be written directly in terms of $\\chi$:\n$$\n\\frac{d\\psi}{d\\phi} = \\varepsilon\\,m\\,B\\,\\sin(\\chi)\n$$\nWe now have an autonomous system of two first-order ordinary differential equations for the variables $(\\psi, \\chi)$.\n\nThe problem requests a reduced Hamiltonian description for $(\\psi, \\chi)$. Let this Hamiltonian be $K(\\psi, \\chi)$. The canonical equations of motion for these variables would be:\n$$\n\\frac{d\\psi}{d\\phi} = -\\frac{\\partial K}{\\partial \\chi}, \\qquad \\frac{d\\chi}{d\\phi} = \\frac{\\partial K}{\\partial \\psi}\n$$\nComparing with our derived system:\n1.  From the $d\\psi/d\\phi$ equation:\n    $$\n    -\\frac{\\partial K}{\\partial \\chi} = \\varepsilon\\,m\\,B\\,\\sin(\\chi)\n    $$\n    Integrating with respect to $\\chi$ yields:\n    $$\n    K(\\psi, \\chi) = \\varepsilon\\,m\\,B\\,\\cos(\\chi) + f(\\psi)\n    $$\n    where $f(\\psi)$ is an arbitrary function of $\\psi$.\n\n2.  From the $d\\chi/d\\phi$ equation:\n    $$\n    \\frac{\\partial K}{\\partial \\psi} = \\frac{d f(\\psi)}{d\\psi} = \\frac{m}{q(\\psi)} - n\n    $$\n    To proceed, we linearize the term $m/q(\\psi) - n$ around the resonant surface $\\psi_s$, where by definition $q(\\psi_s) = q_s = m/n$. We are given the linear profile $q(\\psi) = q_s + q'(\\psi - \\psi_s)$.\n    Let $g(\\psi) = m/q(\\psi) - n$. At the resonance, $g(\\psi_s) = m/q_s - n = m/(m/n) - n = 0$.\n    The first derivative is $g'(\\psi) = -m q' / q(\\psi)^2$.\n    At $\\psi = \\psi_s$, this becomes $g'(\\psi_s) = -m q' / q_s^2 = -m q' / (m/n)^2 = -n^2 q' / m$.\n    A first-order Taylor expansion of $g(\\psi)$ around $\\psi_s$ is:\n    $$\n    \\frac{m}{q(\\psi)} - n \\approx g(\\psi_s) + g'(\\psi_s)(\\psi - \\psi_s) = -\\frac{n^2 q'}{m}(\\psi - \\psi_s)\n    $$\n    Substituting this into the equation for $f'(\\psi)$:\n    $$\n    \\frac{d f(\\psi)}{d\\psi} = -\\frac{n^2 q'}{m}(\\psi - \\psi_s)\n    $$\n    Integrating with respect to $\\psi$ gives $f(\\psi)$:\n    $$\n    f(\\psi) = \\int -\\frac{n^2 q'}{m}(\\psi - \\psi_s) \\,d\\psi = -\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + C\n    $$\n    Setting the integration constant $C$ to $0$ without loss of generality, we obtain the reduced Hamiltonian:\n    $$\n    K(\\psi, \\chi) = -\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\chi)\n    $$\nThis Hamiltonian describes the dynamics of the system near the resonant surface. The trajectories of the field lines are the level curves of this Hamiltonian, $K(\\psi, \\chi) = \\text{constant}$.\n\nThe magnetic island structure is delineated by the separatrix, which is the specific level curve that passes through the unstable fixed points (X-points) of the Hamiltonian system. Fixed points are locations where the dynamics cease, i.e., $d\\psi/d\\phi = 0$ and $d\\chi/d\\phi = 0$.\n-   $d\\psi/d\\phi = \\varepsilon\\,m\\,B\\,\\sin(\\chi) = 0 \\implies \\chi = 0$ or $\\chi = \\pi$.\n-   $d\\chi/d\\phi = -\\frac{n^2 q'}{m}(\\psi - \\psi_s) = 0 \\implies \\psi = \\psi_s$.\n\nThe fixed points are located at $(\\psi, \\chi) = (\\psi_s, 0)$ and $(\\psi, \\chi) = (\\psi_s, \\pi)$. The stable fixed point (O-point, island center) corresponds to a maximum of $K$, which is at $\\chi=0$ since $\\varepsilon0, m0, B0$ and $q'0, m0, n0$ implies $-\\frac{n^2 q'}{2m}  0$. The unstable fixed point (X-point, saddle) is at $\\chi = \\pi$.\n\nThe separatrix contour is determined by the value of the Hamiltonian at the X-point, $K_X = K(\\psi_s, \\pi)$.\n$$\nK_X = -\\frac{n^2 q'}{2m}(\\psi_s - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\pi) = -\\varepsilon\\,m\\,B\n$$\nThe equation for the separatrix is $K(\\psi, \\chi) = K_X$:\n$$\n-\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\chi) = -\\varepsilon\\,m\\,B\n$$\nRearranging to solve for the radial excursion $(\\psi - \\psi_s)$:\n$$\n\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 = \\varepsilon\\,m\\,B\\,(1 + \\cos(\\chi))\n$$\n$$\n(\\psi - \\psi_s)^2 = \\frac{2m}{n^2 q'} \\varepsilon\\,m\\,B\\,(1 + \\cos(\\chi)) = \\frac{2 \\varepsilon m^2 B}{n^2 q'}(1 + \\cos(\\chi))\n$$\nUsing the identity $1+\\cos(\\chi)=2\\cos^2(\\chi/2)$, we get:\n$$\n(\\psi - \\psi_s)^2 = \\frac{4 \\varepsilon m^2 B}{n^2 q'} \\cos^2(\\frac{\\chi}{2})\n$$\nTaking the square root gives the radial position on the separatrix as a function of phase $\\chi$:\n$$\n|\\psi - \\psi_s| = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} \\left|\\cos(\\frac{\\chi}{2})\\right|\n$$\nThe island half-width, $w$, is defined as the maximum value of the radial excursion $|\\psi - \\psi_s|$ along the separatrix. This maximum occurs when $|\\cos(\\chi/2)| = 1$ (i.e., at $\\chi=0$, the O-point). Therefore, the island half-width is:\n$$\nw = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} = 2\\frac{m}{n}\\sqrt{\\frac{\\varepsilon B}{q'}}\n$$\n\n### Part 2: Algorithmic Design and Implementation\n\nThe program must calculate the island half-width $w$ for four given test cases. Per the problem specification, the calculation of $w$ is done by \"numerically\" extracting the maximum excursion from the derived separatrix contour equation. This is implemented by evaluating the expression for $|\\psi - \\psi_s|$ a large number of times over the domain $\\chi \\in [0, 2\\pi]$ and finding the maximum value.\n\nThe algorithm for each test case is as follows:\n1.  Receive the parameters: $m$, $n$, $\\varepsilon$, $B$, $q'$, and $\\psi_s$.\n2.  Handle the boundary case where $\\varepsilon=0$. In this case, there is no perturbation, so the island width $w$ is exactly $0$.\n3.  For $\\varepsilon  0$, create a fine, uniform grid of $\\chi$ values from $0$ to $2\\pi$. A `numpy` array of $1000$ points is sufficient for precision.\n4.  For each value in the $\\chi$ grid, calculate the corresponding radial excursion along the separatrix, $|\\psi - \\psi_s|$, using the derived formula:\n    $$\n    |\\psi - \\psi_s|(\\chi) = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} \\left|\\cos(\\frac{\\chi}{2})\\right|\n    $$\n5.  Find the maximum value of the computed excursions. This value is the island half-width $w$.\n6.  Store the result and format it to six decimal places.\n\nAdditionally, the problem requires the implementation of a fourth-order Runge-Kutta (RK4) integrator for the original field-line ODEs to generate a Poincaré map, even though this is not used to compute the final answer. The code includes two functions, `ode_rhs` and `rk4_step`, for this purpose. The `ode_rhs` function defines the system of equations for $(\\psi, \\theta)$ as a function of $\\phi$, and `rk4_step` implements a single step of the RK4 algorithm for a non-autonomous system. These functions are provided to satisfy the problem requirements but are not called by the main solution logic.\nThe final output is a list of the computed $w$ values for all test cases, formatted as a single-line string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n#\n# Per problem specification, these functions for integrating the field-line ODEs\n# and generating a Poincaré map are implemented but not used to compute the final\n# island width `w`, which is derived from the separatrix contour equation.\n#\n\ndef ode_rhs(phi, y, m, n, epsilon, B, q_prime, psi_s):\n    \"\"\"\n    Computes the right-hand side of the field-line ODEs.\n\n    The system is d(y)/d(phi) = f(phi, y), with y = [psi, theta].\n    d(psi)/d(phi) = epsilon * m * B * sin(m*theta - n*phi)\n    d(theta)/d(phi) = 1 / q(psi)\n    q(psi) = q_s + q_prime * (psi - psi_s), where q_s = m/n.\n    \"\"\"\n    psi, theta = y\n    q_s = m / n\n    q_psi = q_s + q_prime * (psi - psi_s)\n    \n    # Avoid division by zero if q(psi) happens to be zero, though unlikely for typical parameters.\n    if abs(q_psi)  1e-12:\n        return np.array([0.0, np.inf])\n\n    d_psi_d_phi = epsilon * m * B * np.sin(m * theta - n * phi)\n    d_theta_d_phi = 1.0 / q_psi\n    \n    return np.array([d_psi_d_phi, d_theta_d_phi])\n\ndef rk4_step(f, phi, y, dt, *args):\n    \"\"\"\n    Performs a single step of the 4th-order Runge-Kutta method.\n    For a non-autonomous system dy/dt = f(t, y).\n    \"\"\"\n    k1 = dt * f(phi, y, *args)\n    k2 = dt * f(phi + 0.5 * dt, y + 0.5 * k1, *args)\n    k3 = dt * f(phi + 0.5 * dt, y + 0.5 * k2, *args)\n    k4 = dt * f(phi + dt, y + k3, *args)\n    y_new = y + (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n    return y_new\n\ndef solve():\n    \"\"\"\n    Main function to compute island widths for the specified test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (m, n, epsilon, B, q_prime, psi_s)\n        (2.0, 1.0, 1e-3, 1.0, 3.0/4.0, 0.0),\n        # Case B: Epsilon = 0\n        (2.0, 1.0, 0.0, 1.0, 3.0/4.0, 0.0),\n        # Case C: 3/2 mode\n        (3.0, 2.0, 2e-3, 4.0/5.0, 1.0/2.0, 0.0),\n        # Case D: Small shear\n        (2.0, 1.0, 2e-3, 1.0, 1.0/10.0, 0.0)\n    ]\n\n    results = []\n    \n    # Process each test case to find the island half-width w.\n    for case in test_cases:\n        m, n, epsilon, B, q_prime, psi_s = case\n\n        # Handle the trivial case of no perturbation.\n        if epsilon == 0.0:\n            w = 0.0\n            results.append(w)\n            continue\n            \n        # Per problem specification, numerically extract w from the derived separatrix contour equation.\n        # This involves evaluating the radial excursion over a grid of the resonant phase `chi`\n        # and finding the maximum.\n        #\n        # Derived contour equation:\n        # |psi - psi_s| = sqrt(4 * epsilon * m^2 * B / (n^2 * q_prime)) * |cos(chi/2)|\n        \n        # Create a grid for the resonant phase `chi` from 0 to 2*pi.\n        # 1000 points are sufficient for accurate extraction of the maximum.\n        chi_grid = np.linspace(0, 2 * np.pi, 1000)\n\n        # The term under the square root is the square of the maximum width.\n        w_max_sq = (4 * epsilon * m**2 * B) / (n**2 * q_prime)\n        \n        # Calculate the radial excursion |psi - psi_s| for each chi in the grid.\n        radial_excursion = np.sqrt(w_max_sq) * np.abs(np.cos(chi_grid / 2.0))\n        \n        # The island half-width `w` is the maximum of these excursions.\n        w = np.max(radial_excursion)\n        \n        results.append(w)\n\n    # Format the final output as a comma-separated list in brackets,\n    # with each value rounded to six decimal places.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Magnetic islands are not static objects; their width evolves dynamically, influencing plasma confinement and stability. This exercise advances from a static picture to a dynamic one by using the Modified Rutherford Equation (MRE), a powerful reduced model that describes the nonlinear evolution of the island width over time. By numerically solving this equation, you will learn to model the crucial competition between destabilizing forces, like the bootstrap current, and stabilizing effects that ultimately determine an island's growth, saturation, or decay. ",
            "id": "4006709",
            "problem": "You are tasked with developing a complete, runnable program to compute the evolution of the dimensionless magnetic island half-width $w(\\tau)$ by time-stepping a simplified, dimensionless form of the Modified Rutherford Equation (MRE), and to compare the computational results with provided benchmark outputs that represent nonlinear Magnetohydrodynamics (MHD) simulation data for three cases. The goal is to demonstrate an algorithm that is derived from a defensible physical base in computational fusion science and engineering and to quantify predictive accuracy.\n\nScientific context and fundamental base: Magnetic islands arise from tearing modes in resistive Magnetohydrodynamics (MHD). The island dynamics at the rational surface are governed at long times by a balance of resistive reconnection drive and neoclassical effects. The Modified Rutherford Equation (MRE) reformulates the classical Rutherford model to include additional terms, such as bootstrap current drive and polarization current stabilization, as well as curvature/shear effects, yielding a tractable evolution equation for the island half-width. In dimensionless form, using time normalized to the resistive diffusion time $\\tau_{R} = \\mu_{0} a^{2} / \\eta$ (with $\\mu_{0}$ the vacuum permeability, $a$ the minor radius, and $\\eta$ the plasma resistivity), and width normalized to the minor radius $a$, the MRE can be modeled as\n$$\n\\frac{d w}{d \\tau} = \\Delta' + \\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right) - \\frac{C_{\\mathrm{pol}}}{w^{3}} - C_{\\mathrm{curv}} \\, w,\n$$\nwhere $w$ is the dimensionless island half-width, $\\tau$ is dimensionless time, $\\Delta'$ is the dimensionless tearing drive, $C_{\\mathrm{bs}}$ is the bootstrap-current coefficient capturing neoclassical drive, $C_{\\mathrm{pol}}$ is the polarization-current stabilization coefficient important at small $w$, $C_{\\mathrm{curv}}$ is a curvature/shear stabilization coefficient that grows with $w$, and $w_{c}$ is a finite-banana-width scale that regularizes the bootstrap drive as the island grows. This representation is commonly used to capture the qualitative balance between drives and stabilizers in resistive MHD and neoclassical regimes, without introducing unrealistic or untested physics. All quantities are dimensionless in this problem.\n\nNumerical design requirement: You must derive and implement an explicit, stable time-stepping scheme starting from the fundamental definitions of an ordinary differential equation $d w / d \\tau = F(w)$ and the definition of numerical integration for initial value problems. Use a fixed-step explicit fourth-order Runge–Kutta method to integrate $w(\\tau)$ forward in time, and ensure numerical regularization so that divisions by $w$ and $w^{3}$ remain finite by imposing $w \\ge \\varepsilon$ for a small positive $\\varepsilon$. The island half-width $w$ must be non-negative at all times.\n\nComparison requirement: For each benchmark case, you are provided a discrete sequence of times and corresponding dimensionless magnetic island half-widths representing nonlinear MHD simulation outputs. You must compute the model-predicted $w(\\tau)$ at these same times and quantify the mean absolute relative error (MARE), defined for a set of times $\\{\\tau_{i}\\}$ with corresponding widths $\\{w_{i}^{\\mathrm{model}}\\}$ and $\\{w_{i}^{\\mathrm{bench}}\\}$ by\n$$\n\\mathrm{MARE} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{\\left| w_{i}^{\\mathrm{model}} - w_{i}^{\\mathrm{bench}} \\right|}{\\max\\!\\left(w_{i}^{\\mathrm{bench}}, \\varepsilon\\right)},\n$$\nwith $N$ the number of comparison points and $\\varepsilon$ the same small regularization constant used to prevent division by zero. All quantities are dimensionless. The mean absolute relative error must be reported as a floating-point number for each case.\n\nTime grid and output specification: For all cases, evaluate at integer times $\\tau \\in \\{\\, 0, 1, 2, \\ldots, 10 \\,\\}$. Use a fixed time step $\\Delta \\tau = 10^{-3}$ for the integration. The final output must be a single line containing a comma-separated list of three floating-point numbers, each rounded to six decimal places, enclosed in square brackets, in the order of the cases below.\n\nTest suite and benchmark cases:\n- Case A (unstable drive, saturation due to curvature):\n  - Parameters: $\\Delta' = 0.3$, $C_{\\mathrm{bs}} = 0.015$, $C_{\\mathrm{pol}} = 10^{-6}$, $C_{\\mathrm{curv}} = 0.05$, $w_{c} = 0.02$, initial width $w(0) = 0.005$.\n  - Benchmark times: $\\tau \\in \\{\\, 0, 1, 2, \\ldots, 10 \\,\\}$.\n  - Benchmark widths (dimensionless): $[\\, 0.005, 0.012, 0.022, 0.034, 0.048, 0.063, 0.078, 0.092, 0.104, 0.113, 0.119 \\,]$.\n- Case B (near-threshold behavior with small saturation):\n  - Parameters: $\\Delta' = 0.05$, $C_{\\mathrm{bs}} = 0.01$, $C_{\\mathrm{pol}} = 3 \\times 10^{-5}$, $C_{\\mathrm{curv}} = 0.08$, $w_{c} = 0.015$, initial width $w(0) = 0.006$.\n  - Benchmark times: $\\tau \\in \\{\\, 0, 1, 2, \\ldots, 10 \\,\\}$.\n  - Benchmark widths (dimensionless): $[\\, 0.006, 0.007, 0.009, 0.011, 0.013, 0.0145, 0.0155, 0.016, 0.0164, 0.0166, 0.0167 \\,]$.\n- Case C (stable, decaying island due to negative tearing drive and strong stabilization):\n  - Parameters: $\\Delta' = -0.15$, $C_{\\mathrm{bs}} = 0.01$, $C_{\\mathrm{pol}} = 10^{-4}$, $C_{\\mathrm{curv}} = 0.10$, $w_{c} = 0.02$, initial width $w(0) = 0.01$.\n  - Benchmark times: $\\tau \\in \\{\\, 0, 1, 2, \\ldots, 10 \\,\\}$.\n  - Benchmark widths (dimensionless): $[\\, 0.01, 0.009, 0.0078, 0.0066, 0.0055, 0.0046, 0.0038, 0.0031, 0.0026, 0.0022, 0.0019 \\,]$.\n\nProgram requirements:\n- Implement a function to compute the right-hand side $F(w)$ of the MRE for given parameters.\n- Implement an explicit fourth-order Runge–Kutta method with fixed step size $\\Delta \\tau = 10^{-3}$ from $\\tau = 0$ to $\\tau = 10$. Enforce $w \\ge \\varepsilon$ with $\\varepsilon = 10^{-9}$ at all steps to prevent division by zero.\n- For each case, compute $w(\\tau)$ at the specified times and evaluate the mean absolute relative error (MARE) against the provided benchmark widths.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\, \\text{resultA}, \\text{resultB}, \\text{resultC} \\,]$), with each value rounded to six decimal places.\nAll quantities are dimensionless; no physical units are required. No angles are used. The benchmark arrays represent dimensionless outputs from nonlinear Magnetohydrodynamics (MHD) simulations for the purposes of this computational benchmark.",
            "solution": "The problem requires the numerical integration of a dimensionless form of the Modified Rutherford Equation (MRE) to model the time evolution of a magnetic island half-width, $w(\\tau)$. The solution will be obtained using a fourth-order Runge-Kutta (RK4) method. The results are then compared against provided benchmark data to assess the model's accuracy via the Mean Absolute Relative Error (MARE).\n\nThe governing ordinary differential equation (ODE) for the island half-width $w$ as a function of dimensionless time $\\tau$ is given by:\n$$\n\\frac{d w}{d \\tau} = \\Delta' + \\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right) - \\frac{C_{\\mathrm{pol}}}{w^{3}} - C_{\\mathrm{curv}} \\, w\n$$\nThis equation models the balance of several physical effects:\n- $\\Delta'$: The classical tearing mode stability index, representing the free energy available from the equilibrium magnetic field gradient. A positive $\\Delta'$ drives the island growth.\n- $\\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right)$: The contribution from the bootstrap current. This term is typically destabilizing ($C_{\\mathrm{bs}}  0$) and is a key feature of Neoclassical Tearing Modes (NTMs). The $\\tanh$ function, with the scale $w_c$, models the saturation of this effect for island widths larger than the ion banana width.\n- $\\frac{C_{\\mathrm{pol}}}{w^{3}}$: A stabilizing term arising from the polarization current, which becomes significant at very small island widths and can create a threshold for NTM onset.\n- $C_{\\mathrm{curv}} \\, w$: A stabilizing term related to the effects of magnetic field line curvature and magnetic shear, which becomes more dominant as the island width $w$ increases.\n\nThe problem is an initial value problem of the form $\\frac{dw}{d\\tau} = F(w)$, with an initial condition $w(\\tau=0) = w_0$. Since the right-hand side, $F(w)$, does not explicitly depend on time $\\tau$, the ODE is autonomous. We are tasked to solve this ODE using an explicit fourth-order Runge-Kutta (RK4) method with a fixed time step of $\\Delta\\tau = 10^{-3}$.\n\nThe RK4 method advances the solution from time $\\tau_n$ to $\\tau_{n+1} = \\tau_n + \\Delta\\tau$ as follows:\n$$\n\\begin{aligned}\nk_1 = \\Delta\\tau \\, F(w_n) \\\\\nk_2 = \\Delta\\tau \\, F(w_n + \\frac{1}{2} k_1) \\\\\nk_3 = \\Delta\\tau \\, F(w_n + \\frac{1}{2} k_2) \\\\\nk_4 = \\Delta\\tau \\, F(w_n + k_3) \\\\\nw_{n+1} = w_n + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n\\end{aligned}\n$$\nwhere $w_n$ is the numerical approximation of $w(\\tau_n)$.\n\nA critical aspect of the numerical implementation is handling the singularities in the $C_{\\mathrm{bs}}/w$ and $C_{\\mathrm{pol}}/w^3$ terms as $w \\to 0$. The problem specifies a regularization scheme where the island width $w$ is bounded below by a small positive constant $\\varepsilon = 10^{-9}$. This is implemented in two stages for robustness:\n1.  Inside the function $F(w)$ that computes the ODE's right-hand side, the input width $w$ is first regularized to $w_{\\mathrm{reg}} = \\max(w, \\varepsilon)$ before it is used in any calculation involving division. This ensures that the intermediate evaluations within an RK4 step (e.g., $F(w_n + k_1/2)$) do not cause floating-point exceptions even if the argument becomes zero or negative.\n2.  After each full RK4 step, the newly computed width $w_{n+1}$ is also clamped: $w_{n+1} \\leftarrow \\max(w_{n+1}, \\varepsilon)$. This guarantees that the island width remains physical (non-negative) and provides a regularized input for the subsequent time step.\n\nThe integration is performed from $\\tau=0$ to $\\tau=10$ for three distinct cases, each with a specific set of parameters $\\{\\Delta', C_{\\mathrm{bs}}, C_{\\mathrm{pol}}, C_{\\mathrm{curv}}, w_c\\}$ and an initial width $w(0)$. The model-predicted widths $w^{\\mathrm{model}}$ are recorded at integer times $\\tau_i \\in \\{0, 1, 2, \\ldots, 10\\}$.\n\nThe accuracy of the model is quantified by the Mean Absolute Relative Error (MARE), which compares the model results $w_{i}^{\\mathrm{model}}$ with the provided benchmark data $w_{i}^{\\mathrm{bench}}$ at $N=11$ time points. The MARE is defined as:\n$$\n\\mathrm{MARE} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{\\left| w_{i}^{\\mathrm{model}} - w_{i}^{\\mathrm{bench}} \\right|}{\\max\\!\\left(w_{i}^{\\mathrm{bench}}, \\varepsilon\\right)}\n$$\nThe use of $\\max(w_{i}^{\\mathrm{bench}}, \\varepsilon)$ in the denominator provides robustness against division by zero if benchmark data points were close to zero.\n\nThe algorithm proceeds as follows:\n1.  For each of the three test cases, initialize the island width $w$ with its given initial condition $w(0)$. Store this as the first data point $w^{\\mathrm{model}}_0$.\n2.  Iterate for the total number of time steps required to reach $\\tau=10$ with $\\Delta\\tau = 10^{-3}$, which is $10 / 10^{-3} = 10000$ steps.\n3.  In each step, calculate the new width $w_{n+1}$ using the RK4 scheme.\n4.  If the current time step corresponds to an integer time $\\tau \\in \\{1, 2, \\ldots, 10\\}$, store the computed width $w$.\n5.  After the integration is complete, compute a single MARE value for the case using the collected set of model widths and the corresponding benchmark widths.\n6.  Repeat for all three cases and report the resulting MARE values in the specified format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the evolution of the magnetic island half-width by solving the\n    Modified Rutherford Equation and calculates the Mean Absolute Relative Error\n    against benchmark data for three test cases.\n    \"\"\"\n\n    # --- Constants and Numerical Parameters ---\n    epsilon = 1e-9\n    dt = 1e-3\n    t_start = 0.0\n    t_end = 10.0\n    n_steps = int((t_end - t_start) / dt)\n    output_interval = int(1.0 / dt)\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"params\": {\n                'delta_prime': 0.3,\n                'c_bs': 0.015,\n                'c_pol': 1e-6,\n                'c_curv': 0.05,\n                'w_c': 0.02\n            },\n            \"w0\": 0.005,\n            \"bench_widths\": np.array([0.005, 0.012, 0.022, 0.034, 0.048, 0.063, 0.078, 0.092, 0.104, 0.113, 0.119])\n        },\n        {\n            \"name\": \"Case B\",\n            \"params\": {\n                'delta_prime': 0.05,\n                'c_bs': 0.01,\n                'c_pol': 3e-5,\n                'c_curv': 0.08,\n                'w_c': 0.015\n            },\n            \"w0\": 0.006,\n            \"bench_widths\": np.array([0.006, 0.007, 0.009, 0.011, 0.013, 0.0145, 0.0155, 0.016, 0.0164, 0.0166, 0.0167])\n        },\n        {\n            \"name\": \"Case C\",\n            \"params\": {\n                'delta_prime': -0.15,\n                'c_bs': 0.01,\n                'c_pol': 1e-4,\n                'c_curv': 0.10,\n                'w_c': 0.02\n            },\n            \"w0\": 0.01,\n            \"bench_widths\": np.array([0.01, 0.009, 0.0078, 0.0066, 0.0055, 0.0046, 0.0038, 0.0031, 0.0026, 0.0022, 0.0019])\n        }\n    ]\n\n    def mre_rhs(w, params, eps):\n        \"\"\"\n        Computes the right-hand side of the Modified Rutherford Equation F(w).\n        \"\"\"\n        w_reg = max(w, eps)\n        \n        delta_prime_term = params['delta_prime']\n        bootstrap_term = params['c_bs'] / w_reg * np.tanh(w_reg / params['w_c'])\n        polarization_term = params['c_pol'] / (w_reg**3)\n        curvature_term = params['c_curv'] * w_reg\n        \n        return delta_prime_term + bootstrap_term - polarization_term - curvature_term\n\n    def rk4_step(w, params, step_size, eps):\n        \"\"\"\n        Performs a single explicit fourth-order Runge-Kutta step.\n        \"\"\"\n        k1 = step_size * mre_rhs(w, params, eps)\n        k2 = step_size * mre_rhs(w + 0.5 * k1, params, eps)\n        k3 = step_size * mre_rhs(w + 0.5 * k2, params, eps)\n        k4 = step_size * mre_rhs(w + k3, params, eps)\n        \n        w_new = w + (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n        \n        return max(w_new, eps)\n\n    def calculate_mare(model_widths, bench_widths, eps):\n        \"\"\"\n        Calculates the Mean Absolute Relative Error (MARE).\n        \"\"\"\n        errors = np.abs(model_widths - bench_widths) / np.maximum(bench_widths, eps)\n        return np.mean(errors)\n\n    mare_results = []\n    \n    for case in test_cases:\n        params = case['params']\n        w = case['w0']\n        bench_widths = case['bench_widths']\n        \n        model_widths = [w]\n        \n        # Time integration loop\n        for step in range(1, n_steps + 1):\n            w = rk4_step(w, params, dt, epsilon)\n            \n            # Store result at integer time points\n            if step % output_interval == 0:\n                model_widths.append(w)\n        \n        # Convert to numpy array for calculation\n        model_widths_np = np.array(model_widths)\n        \n        # Calculate and store MARE\n        mare = calculate_mare(model_widths_np, bench_widths, epsilon)\n        mare_results.append(mare)\n\n    # Format and print the final results\n    formatted_results = [f\"{r:.6f}\" for r in mare_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}