{
    "hands_on_practices": [
        {
            "introduction": "The first step in devising any field error correction strategy is to understand which magnetic perturbations are most harmful to plasma confinement. The most dangerous components are those that resonate with the plasma's natural magnetic structure, particularly on \"rational surfaces\" where the magnetic field lines close back on themselves. This exercise  provides essential practice in identifying these resonant harmonics using the safety factor $q$ and mode numbers $m$ and $n$, solidifying the physical principles that motivate the need for error field correction.",
            "id": "3979168",
            "problem": "Consider a circular, large aspect-ratio tokamak in the edge region where static intrinsic error fields are corrected by external error field correction coils. The magnetic safety factor $q$ is defined as the number of toroidal turns a field line makes per poloidal turn. Rational surfaces occur at locations where the field line map closes after a finite number of poloidal and toroidal transits, which implies the existence of integers $m$ and $n$ such that field lines satisfy $q = m/n$ at that surface. In linear magnetohydrodynamics (MHD), a helical magnetic perturbation harmonic labeled by the integer poloidal mode number $m$ and toroidal mode number $n$ couples resonantly to the plasma at surfaces where the perturbation helicity matches the field line pitch, and this resonance condition is the origin of enhanced electromagnetic braking torque on plasma rotation.\n\nAssume the edge safety factor is $q = 2.5$ over the narrow annulus where the dominant error-field–plasma coupling occurs, and consider applied static error-field harmonics with poloidal mode numbers $m \\in \\{1,2,3,4,5\\}$ and integer toroidal mode numbers $n \\in \\mathbb{Z}^{+}$. Using only the definition of the safety factor and the rational-surface closure condition, determine which $n$ harmonics are exactly resonant for the specified $m$ values. Additionally, argue, based on first principles of linear viscous-resistive plasma response and the structure of Maxwell stress, which resonant harmonic is most likely to be deleterious for sustaining toroidal rotation and why, referencing generic scaling trends with respect to $n$ implied by the structure of the rational layer response.\n\nProvide your final answer as the single integer $n$ that resonates among the given $m$ values. No rounding is required. Express the final answer as a dimensionless integer.",
            "solution": "The problem statement is evaluated to be scientifically grounded, well-posed, and contains sufficient information for a unique solution. We may therefore proceed with the analysis.\n\nThe problem requires us to identify resonant magnetic perturbation harmonics in a tokamak plasma and to provide physical reasoning for their relative impact on plasma rotation. A resonant interaction occurs when the helicity of an external magnetic perturbation, characterized by poloidal mode number $m$ and toroidal mode number $n$, matches the helicity of the magnetic field lines on a specific magnetic flux surface. This condition is mathematically expressed by the safety factor $q$ at that surface being equal to the ratio of the mode numbers.\n\nThe fundamental condition for a resonant harmonic is given by:\n$$\nq = \\frac{m}{n}\n$$\nwhere $q$ is the safety factor, $m$ is the poloidal mode number, and $n$ is the toroidal mode number.\n\nThe problem provides the following data:\n- The safety factor in the edge region of interest is $q = 2.5$.\n- The set of possible poloidal mode numbers is $m \\in \\{1, 2, 3, 4, 5\\}$.\n- The toroidal mode number $n$ must be a positive integer, i.e., $n \\in \\mathbb{Z}^{+}$.\n\nWe can substitute the value of $q$ into the resonance condition. It is convenient to express the decimal value of $q$ as a rational number:\n$$\nq = 2.5 = \\frac{5}{2}\n$$\nThe resonance condition thus becomes:\n$$\n\\frac{5}{2} = \\frac{m}{n}\n$$\nWe can rearrange this equation to solve for $n$ in terms of $m$:\n$$\nn = \\frac{2m}{5}\n$$\nNow, we must find the value(s) of $m$ from the given set $\\{1, 2, 3, 4, 5\\}$ for which $n$ is a positive integer. We test each possible value of $m$:\n- For $m=1$: $n = \\frac{2(1)}{5} = \\frac{2}{5}$. This is not an integer.\n- For $m=2$: $n = \\frac{2(2)}{5} = \\frac{4}{5}$. This is not an integer.\n- For $m=3$: $n = \\frac{2(3)}{5} = \\frac{6}{5}$. This is not an integer.\n- For $m=4$: $n = \\frac{2(4)}{5} = \\frac{8}{5}$. This is not an integer.\n- For $m=5$: $n = \\frac{2(5)}{5} = 2$. This is a positive integer.\n\nTherefore, within the specified constraints, there is only one resonant harmonic, which is the $(m, n) = (5, 2)$ mode. The corresponding toroidal mode number is $n=2$.\n\nThe second part of the problem asks for an argument, based on first principles, as to which resonant harmonic is most likely to be deleterious for sustaining toroidal rotation, with reference to scaling trends with respect to $n$. A resonant harmonic is deleterious because it can induce magnetic reconnection, forming a magnetic island at the rational surface. This island interacts with the static external field, producing an electromagnetic torque that brakes the plasma rotation. If the torque is sufficiently large, it can lock the mode to the wall frame (i.e., stop its rotation), which often leads to a plasma disruption.\n\nThe magnitude of this braking torque is the primary measure of how deleterious a harmonic is. The torque arises from the toroidal component of the Lorentz force, $\\mathbf{J} \\times \\mathbf{B}$, integrated over the plasma volume. From the structure of Maxwell's equations and the definition of the toroidal angle $\\phi$, the toroidal dependence of a single harmonic helical perturbation goes as $\\exp(-in\\phi)$. The toroidal component of the force density involves terms quadratic in the perturbation fields and currents. For example, the radial current $J_r$ coupled with the poloidal field perturbation $\\delta B_\\theta$ will have a toroidal component. In Fourier space, operators like the gradient involve derivatives with respect to spatial coordinates. The toroidal component of the curl, for instance, which is used in Ampere's law to relate current to the magnetic field, involves the operator $\\frac{1}{R}\\frac{\\partial}{\\partial\\phi}$, which becomes a factor of $-\\frac{in}{R}$ when acting on a mode. Consequently, the resulting electromagnetic torque, $T_{m,n}$, for a given harmonic scales with the square of the toroidal mode number, $n$. A simplified scaling for the linear response torque is often of the form:\n$$\nT_{m,n} \\propto n^2 |\\psi_{res, m,n}|^2\n$$\nwhere $|\\psi_{res, m,n}|$ is the amplitude of the reconnected magnetic flux at the $q=m/n$ surface. This $n^2$ scaling suggests that, for a fixed reconnected flux amplitude, higher-$n$ modes would exert a stronger torque and thus be more deleterious.\n\nHowever, this is only part of the physics. The reconnected flux $|\\psi_{res, m,n}|$ is itself a result of the plasma's response to the externally applied error field, $|\\psi_{ext, m,n}|$. The amplitude of these external error fields, which arise from imperfections in the magnet coils, is not constant across all mode numbers. Based on the fundamental properties of fields generated by localized sources, the amplitude of field harmonics decays rapidly as the mode numbers $m$ and $n$ increase. This is because higher mode numbers correspond to shorter wavelengths, and such fields are more evanescent, meaning they decay more quickly away from their source. A typical, albeit simplified, scaling for the external field amplitude is exponential decay: $|\\psi_{ext, m,n}| \\propto \\exp(-m d/a)$, where $d$ is a characteristic distance from the source coils to the rational surface and $a$ is a machine scale length.\n\nTherefore, the overall deleteriousness of a mode results from a competition between two opposing effects:\n1. The intrinsic strength of the electromagnetic torque, which scales as $n^2$.\n2. The amplitude of the source error field, which decays rapidly with increasing $m$ and $n$.\n\nIn virtually all practical cases in tokamaks, the rapid decay of the error field spectrum is the dominant factor. This means that the lowest-$m$ and lowest-$n$ resonant harmonics are the ones with the largest amplitudes and therefore pose the greatest threat to plasma stability and confinement, despite the $n^2$ factor in the torque expression.\n\nIn the context of this specific problem, only one resonant harmonic, $(m, n)=(5, 2)$, was found. While $m=5$ is the highest poloidal mode number in the allowed set, the corresponding toroidal mode number $n=2$ is relatively low. If, for instance, a hypothetical $(m, n) = (10, 4)$ harmonic were also resonant (which it would be, as $10/4=2.5$), the $(5, 2)$ harmonic would almost certainly be the more deleterious of the two, as the amplitude of the external error field for $(10, 4)$ would be significantly smaller than that for $(5, 2)$. The problem asks for the single integer $n$ that resonates, which our initial calculation has uniquely determined.",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "Once problematic error fields are identified, a control system must calculate the optimal currents to apply to a set of correction coils. This is often a complex balancing act, as modern tokamaks require satisfying multiple objectives simultaneously—for instance, cancelling error fields in the plasma core while actively applying fields at the edge. This exercise  demonstrates how to formulate and solve this challenge as a multi-objective, regularized optimization problem, a core technique in computational control for fusion devices.",
            "id": "3979108",
            "problem": "A non-axisymmetric magnetic field in a toroidal fusion device is controlled by external coils. Under linear superposition and the quasi-static approximation of Maxwell's equations, the harmonic content of the magnetic normal field at specified regions (a core region and an edge region) depends linearly on the coil current vector. Let the coil current vector be denoted by $I \\in \\mathbb{R}^N$ with entries in Amperes (A). Let $G_{m1} \\in \\mathbb{R}^{p \\times N}$ be the sensitivity matrix mapping coil currents to the $p$ core-region harmonic amplitudes in Tesla (T), and $G_{m2} \\in \\mathbb{R}^{q \\times N}$ be the sensitivity matrix mapping coil currents to the $q$ edge-region harmonic amplitudes in Tesla (T). The desired core-region harmonics are zero, i.e., $b_{m1}^{\\ast} = 0 \\in \\mathbb{R}^p$, and the desired edge-region harmonic targets are $b_{m2}^{\\ast} \\in \\mathbb{R}^q$ in Tesla (T). Using scalarization with positive weights $\\alpha$ and $\\beta$ and a Tikhonov regularization parameter $\\lambda$ with units Tesla squared per Ampere squared (T$^2$/A$^2$), determine the coil current vector $I$ in Amperes (A) that minimizes a convex objective which penalizes deviations from the core and edge targets along with the coil effort.\n\nStarting from the principle of linear magnetic response and superposition, derive an algorithmic formulation that computes the optimal $I$ by solving a well-posed least-squares system constructed from $G_{m1}$, $G_{m2}$, $b_{m2}^{\\ast}$, $\\alpha$, $\\beta$, and $\\lambda$. The method must be applicable to any $N$, $p$, and $q$, and must produce currents in Amperes (A).\n\nYou are given the following test suite of parameter values. In each case, $N = 4$ coils, $p = 2$ core harmonics, and $q = 3$ edge harmonics. All entries of the matrices $G_{m1}$ and $G_{m2}$ are in Tesla per Ampere (T/A), and all entries of $b_{m2}^{\\ast}$ are in Tesla (T).\n\nUse the same $G_{m1}$, $G_{m2}$, and $b_{m2}^{\\ast}$ for all test cases:\n- $G_{m1} = \\begin{bmatrix} 2\\times 10^{-4}  -1\\times 10^{-4}  0.5\\times 10^{-4}  0.0\\times 10^{-4} \\\\ 1.5\\times 10^{-4}  2.5\\times 10^{-4}  -1.0\\times 10^{-4}  0.8\\times 10^{-4} \\end{bmatrix}$\n- $G_{m2} = \\begin{bmatrix} 3\\times 10^{-4}  1.0\\times 10^{-4}  -0.5\\times 10^{-4}  0.2\\times 10^{-4} \\\\ -1.0\\times 10^{-4}  2.0\\times 10^{-4}  1.2\\times 10^{-4}  -0.3\\times 10^{-4} \\\\ 0.0\\times 10^{-4}  -0.8\\times 10^{-4}  2.2\\times 10^{-4}  1.0\\times 10^{-4} \\end{bmatrix}$\n- $b_{m2}^{\\ast} = \\begin{bmatrix} 1.0\\times 10^{-4} \\\\ -0.5\\times 10^{-4} \\\\ 0.8\\times 10^{-4} \\end{bmatrix}$\n\nDefine four test cases with different scalarization weights and regularization, all with $b_{m1}^{\\ast} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$:\n- Case $1$: $\\alpha = 1.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-8}$.\n- Case $2$: $\\alpha = 10.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-8}$.\n- Case $3$: $\\alpha = 0.5$, $\\beta = 10.0$, $\\lambda = 1.0\\times 10^{-10}$.\n- Case $4$: $\\alpha = 1.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-6}$.\n\nYour program must compute, for each case, the optimal coil current vector $I \\in \\mathbb{R}^4$ in Amperes (A). Angle units are not involved. Express the coil currents in Amperes (A) as floating-point numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a comma-separated list of the $4$ coil currents in Amperes (A) for a given case, in order from Case $1$ to Case $4$. For example, the output format should be like $[\\,[I_{1},I_{2},I_{3},I_{4}],\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$ with numeric values replacing the symbols.\n\nThe final answers for each test case must be lists of floating-point numbers in Amperes (A).",
            "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Variables and Definitions**:\n  - Coil current vector: $I \\in \\mathbb{R}^N$, units: Amperes ($A$).\n  - Core-region sensitivity matrix: $G_{m1} \\in \\mathbb{R}^{p \\times N}$, units: Tesla per Ampere ($T/A$).\n  - Edge-region sensitivity matrix: $G_{m2} \\in \\mathbb{R}^{q \\times N}$, units: Tesla per Ampere ($T/A$).\n  - Desired core-region harmonic amplitudes: $b_{m1}^{\\ast} = 0 \\in \\mathbb{R}^p$, units: Tesla ($T$).\n  - Desired edge-region harmonic amplitudes: $b_{m2}^{\\ast} \\in \\mathbb{R}^q$, units: Tesla ($T$).\n  - Scalarization weights: $\\alpha, \\beta$ (positive and dimensionless).\n  - Tikhonov regularization parameter: $\\lambda$, units: Tesla squared per Ampere squared ($T^2/A^2$).\n- **Objective**:\n  - Minimize a convex objective function that penalizes deviations from core and edge targets and the coil effort.\n- **Problem Constants for all Test Cases**:\n  - $N = 4$ coils.\n  - $p = 2$ core harmonics.\n  - $q = 3$ edge harmonics.\n  - $G_{m1} = \\begin{bmatrix} 2\\times 10^{-4}  -1\\times 10^{-4}  0.5\\times 10^{-4}  0.0\\times 10^{-4} \\\\ 1.5\\times 10^{-4}  2.5\\times 10^{-4}  -1.0\\times 10^{-4}  0.8\\times 10^{-4} \\end{bmatrix}$ ($T/A$).\n  - $G_{m2} = \\begin{bmatrix} 3\\times 10^{-4}  1.0\\times 10^{-4}  -0.5\\times 10^{-4}  0.2\\times 10^{-4} \\\\ -1.0\\times 10^{-4}  2.0\\times 10^{-4}  1.2\\times 10^{-4}  -0.3\\times 10^{-4} \\\\ 0.0\\times 10^{-4}  -0.8\\times 10^{-4}  2.2\\times 10^{-4}  1.0\\times 10^{-4} \\end{bmatrix}$ ($T/A$).\n  - $b_{m2}^{\\ast} = \\begin{bmatrix} 1.0\\times 10^{-4} \\\\ -0.5\\times 10^{-4} \\\\ 0.8\\times 10^{-4} \\end{bmatrix}$ ($T$).\n  - $b_{m1}^{\\ast} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$ ($T$).\n- **Test Case Parameters**:\n  - Case $1$: $\\alpha = 1.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-8}$.\n  - Case $2$: $\\alpha = 10.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-8}$.\n  - Case $3$: $\\alpha = 0.5$, $\\beta = 10.0$, $\\lambda = 1.0\\times 10^{-10}$.\n  - Case $4$: $\\alpha = 1.0$, $\\beta = 1.0$, $\\lambda = 1.0\\times 10^{-6}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is scientifically sound. It describes a standard method in computational plasma physics and fusion engineering for magnetic field error correction. The use of sensitivity matrices, linear superposition, and Tikhonov-regularized least-squares optimization is a well-established and valid technique.\n- **Well-Posedness**: The problem is well-posed. It involves minimizing a convex objective function. The Tikhonov regularization term, with $\\lambda  0$, ensures the problem has a unique and stable solution.\n- **Objectivity**: The problem is stated in precise, objective mathematical and physical terms, free of ambiguity or subjective claims.\n- **Consistency**: The dimensions of all matrices and vectors are consistent ($G_{m1} \\in \\mathbb{R}^{2 \\times 4}$, $G_{m2} \\in \\mathbb{R}^{3 \\times 4}$, $b_{m1}^{\\ast} \\in \\mathbb{R}^2$, $b_{m2}^{\\ast} \\in \\mathbb{R}^3$, $I \\in \\mathbb{R}^4$). The physical units are also consistent throughout. The objective function terms all have units of $T^2$.\n- **Completeness**: All necessary data and parameters for solving the problem are provided.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, consistent, and complete. A solution will be derived.\n\n### Derivation of the Solution\n\nThe core principle is linear superposition under a quasi-static approximation. The magnetic field harmonic amplitudes, $b_{m1}$ and $b_{m2}$, are linear functions of the coil current vector $I$:\n$$ b_{m1} = G_{m1} I $$\n$$ b_{m2} = G_{m2} I $$\nThe goal is to find the current vector $I$ that minimizes a composite objective function, $J(I)$, which represents a weighted sum of penalties. These penalties correspond to the deviation from target harmonics and the magnitude of the required currents (coil effort). The objective function is formulated using the squared Euclidean norm ($\\|\\cdot\\|_2^2$) as:\n$$ J(I) = \\alpha \\|b_{m1} - b_{m1}^{\\ast}\\|_2^2 + \\beta \\|b_{m2} - b_{m2}^{\\ast}\\|_2^2 + \\lambda \\|I\\|_2^2 $$\nSubstituting the linear relationships and the given target $b_{m1}^{\\ast} = 0$, we get:\n$$ J(I) = \\alpha \\|G_{m1}I\\|_2^2 + \\beta \\|G_{m2}I - b_{m2}^{\\ast}\\|_2^2 + \\lambda \\|I\\|_2^2 $$\nThe parameters $\\alpha$, $\\beta$, and $\\lambda$ are all positive, which makes $J(I)$ a strictly convex function, guaranteeing a unique minimum.\n\nTo find the minimum, we can use calculus by setting the gradient of $J(I)$ with respect to $I$ to zero, $\\nabla_I J(I) = 0$. Alternatively, and more constructively for implementation, we can reformulate the problem into a standard linear least-squares form, $\\min_x \\|Ax-b\\|_2^2$.\n\nWe can rewrite $J(I)$ as a single squared norm by stacking the components into augmented matrices and vectors. The objective function is equivalent to:\n$$ J(I) = \\|\\sqrt{\\alpha} G_{m1} I - 0\\|_2^2 + \\|\\sqrt{\\beta} G_{m2} I - \\sqrt{\\beta} b_{m2}^{\\ast}\\|_2^2 + \\|\\sqrt{\\lambda} I_N I - 0\\|_2^2 $$\nwhere $I_N$ is the $N \\times N$ identity matrix. This sum of squares can be expressed as the squared norm of a single block vector:\n$$ J(I) = \\left\\| \\begin{pmatrix} \\sqrt{\\alpha} G_{m1} \\\\ \\sqrt{\\beta} G_{m2} \\\\ \\sqrt{\\lambda} I_N \\end{pmatrix} I - \\begin{pmatrix} \\mathbf{0}_{p \\times 1} \\\\ \\sqrt{\\beta} b_{m2}^{\\ast} \\\\ \\mathbf{0}_{N \\times 1} \\end{pmatrix} \\right\\|_2^2 $$\nThis is a least-squares problem of the form $\\min_I \\|A I - b\\|_2^2$, where:\n$$ A = \\begin{pmatrix} \\sqrt{\\alpha} G_{m1} \\\\ \\sqrt{\\beta} G_{m2} \\\\ \\sqrt{\\lambda} I_N \\end{pmatrix} \\quad \\text{and} \\quad b = \\begin{pmatrix} \\mathbf{0}_{p \\times 1} \\\\ \\sqrt{\\beta} b_{m2}^{\\ast} \\\\ \\mathbf{0}_{N \\times 1} \\end{pmatrix} $$\nThe solution $I$ to this problem is found by solving the normal equations:\n$$ (A^T A) I = A^T b $$\nLet's compute the components of the normal equations.\nThe matrix $A^T A$ is:\n$$ A^T A = \\begin{pmatrix} (\\sqrt{\\alpha} G_{m1})^T  (\\sqrt{\\beta} G_{m2})^T  (\\sqrt{\\lambda} I_N)^T \\end{pmatrix} \\begin{pmatrix} \\sqrt{\\alpha} G_{m1} \\\\ \\sqrt{\\beta} G_{m2} \\\\ \\sqrt{\\lambda} I_N \\end{pmatrix} $$\n$$ A^T A = \\alpha G_{m1}^T G_{m1} + \\beta G_{m2}^T G_{m2} + \\lambda I_N $$\nThe vector $A^T b$ is:\n$$ A^T b = \\begin{pmatrix} (\\sqrt{\\alpha} G_{m1})^T  (\\sqrt{\\beta} G_{m2})^T  (\\sqrt{\\lambda} I_N)^T \\end{pmatrix} \\begin{pmatrix} \\mathbf{0}_{p \\times 1} \\\\ \\sqrt{\\beta} b_{m2}^{\\ast} \\\\ \\mathbf{0}_{N \\times 1} \\end{pmatrix} $$\n$$ A^T b = \\beta G_{m2}^T b_{m2}^{\\ast} $$\nThe normal equations thus form the following $N \\times N$ linear system for the optimal current vector $I$:\n$$ (\\alpha G_{m1}^T G_{m1} + \\beta G_{m2}^T G_{m2} + \\lambda I_N) I = \\beta G_{m2}^T b_{m2}^{\\ast} $$\nThe matrix on the left-hand side, $M = \\alpha G_{m1}^T G_{m1} + \\beta G_{m2}^T G_{m2} + \\lambda I_N$, is symmetric and positive definite because $G_{m1}^T G_{m1}$ and $G_{m2}^T G_{m2}$ are positive semi-definite and $\\lambda I_N$ is positive definite (since $\\lambda  0$). Therefore, $M$ is invertible, and the unique solution is:\n$$ I = (\\alpha G_{m1}^T G_{m1} + \\beta G_{m2}^T G_{m2} + \\lambda I_N)^{-1} (\\beta G_{m2}^T b_{m2}^{\\ast}) $$\nAlgorithmically, instead of computing the inverse directly, it is more numerically stable and efficient to solve the linear system $MI = v$, where $v = \\beta G_{m2}^T b_{m2}^{\\ast}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the optimal coil currents for magnetic field error correction\n    by solving a Tikhonov-regularized least-squares problem.\n    \"\"\"\n\n    # Define the constant matrices and vectors from the problem statement.\n    # All matrix entries are in Tesla/Ampere (T/A).\n    # All target vector entries are in Tesla (T).\n    G_m1 = np.array([\n        [2e-4, -1e-4, 0.5e-4, 0.0e-4],\n        [1.5e-4, 2.5e-4, -1.0e-4, 0.8e-4]\n    ])\n\n    G_m2 = np.array([\n        [3e-4, 1.0e-4, -0.5e-4, 0.2e-4],\n        [-1.0e-4, 2.0e-4, 1.2e-4, -0.3e-4],\n        [0.0e-4, -0.8e-4, 2.2e-4, 1.0e-4]\n    ])\n    \n    b_m2_star = np.array([1.0e-4, -0.5e-4, 0.8e-4])\n\n    # Test cases with different scalarization and regularization parameters.\n    # (alpha, beta, lambda)\n    # alpha, beta are dimensionless.\n    # lambda is in T^2/A^2.\n    test_cases = [\n        (1.0, 1.0, 1.0e-8),   # Case 1\n        (10.0, 1.0, 1.0e-8),  # Case 2\n        (0.5, 10.0, 1.0e-10), # Case 3\n        (1.0, 1.0, 1.0e-6),   # Case 4\n    ]\n\n    all_results = []\n\n    # Get dimensions and pre-compute transposed matrices.\n    N = G_m1.shape[1] # Number of coils\n    I_N = np.identity(N)\n    G_m1_T = G_m1.T\n    G_m2_T = G_m2.T\n\n    for alpha, beta, lam in test_cases:\n        # Construct the matrix M for the linear system M*I = v\n        # M = alpha * G_m1^T * G_m1 + beta * G_m2^T * G_m2 + lambda * I_N\n        M = (alpha * (G_m1_T @ G_m1) + \n             beta * (G_m2_T @ G_m2) + \n             lam * I_N)\n\n        # Construct the vector v for the linear system M*I = v\n        # v = beta * G_m2^T * b_m2_star\n        v = beta * (G_m2_T @ b_m2_star)\n        \n        # Solve the linear system M*I = v for the coil current vector I.\n        # The result I will have units of Amperes (A).\n        I = np.linalg.solve(M, v)\n        \n        all_results.append(I.tolist())\n\n    # Format the output as a string representing a list of lists.\n    # e.g., [[c1,c2,...],[d1,d2,...]]\n    inner_lists_str = []\n    for result_list in all_results:\n        # Each inner list is formatted as '[val1,val2,...]'\n        inner_lists_str.append(f\"[{','.join(map(str, result_list))}]\")\n    \n    # The final output is a comma-separated list of the inner list strings,\n    # all enclosed in a single pair of square brackets.\n    final_output_str = f\"[{','.join(inner_lists_str)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "The optimization frameworks used to design correction coil currents, such as the one in the previous exercise, often lead to an ill-conditioned linear inverse problem. A naive solution can be exquisitely sensitive to measurement noise or model inaccuracies, demanding unphysically large currents. This practice  delves into the essential numerical methods used to overcome this, allowing you to directly compare two workhorse regularization techniques: Truncated Singular Value Decomposition (TSVD) and Tikhonov regularization, providing insight into how to obtain stable and physically meaningful solutions.",
            "id": "3979121",
            "problem": "In computational fusion science and engineering, magnetic field error correction on a toroidal device can be posed as a linear inverse problem. Let $\\mathbf{A} \\in \\mathbb{R}^{m \\times n}$ be the linear response operator mapping coil currents $\\mathbf{x} \\in \\mathbb{R}^{n}$ to the measured normal field error $\\mathbf{b} \\in \\mathbb{R}^{m}$, and suppose we have a measurement $\\mathbf{b}^{\\ast} \\in \\mathbb{R}^{m}$ of the error field we wish to cancel by choosing $\\mathbf{x}$. Consider the singular value decomposition (SVD) of $\\mathbf{A}$, $\\mathbf{A} = \\mathbf{U} \\boldsymbol{\\Sigma} \\mathbf{V}^{\\top}$, where $\\mathbf{U} = [\\mathbf{u}_{1}, \\mathbf{u}_{2}, \\mathbf{u}_{3}] \\in \\mathbb{R}^{m \\times 3}$ and $\\mathbf{V} = [\\mathbf{v}_{1}, \\mathbf{v}_{2}, \\mathbf{v}_{3}] \\in \\mathbb{R}^{n \\times 3}$ have orthonormal columns and $\\boldsymbol{\\Sigma} = \\operatorname{diag}(s_{1}, s_{2}, s_{3})$ with singular values $s_{1} \\ge s_{2} \\ge s_{3}  0$. Assume the dominant controllable subspace is three-dimensional with singular values $s = \\{5, 1, 0.1\\}$ and measured projections $c_{i} \\equiv \\mathbf{u}_{i}^{\\top} \\mathbf{b}^{\\ast} = \\{2, 1, 1\\}$.\n\nTwo field error correction strategies are considered:\n1. Truncated singular value decomposition (TSVD), in which only components with $s_{i} \\ge 1$ are retained.\n2. Tikhonov regularization, obtained by minimizing $\\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}^{\\ast}\\|_{2}^{2} + \\lambda \\|\\mathbf{x}\\|_{2}^{2}$ with regularization parameter $\\lambda = 0.2$.\n\nFrom first principles starting with the least-squares and regularized formulations and the SVD, derive the correction coil-current vectors $\\mathbf{x}_{\\text{TSVD}}$ and $\\mathbf{x}_{\\lambda}$ in the $\\{\\mathbf{v}_{i}\\}$ basis and then compute the Euclidean norm of their difference, $\\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2}$. Express your final answer in amperes and round your answer to four significant figures. Provide no intermediate rounded values; perform the rounding only on the final answer.",
            "solution": "The problem is to find two different solutions for the coil currents $\\mathbf{x}$ that cancel a measured magnetic field error $\\mathbf{b}^{\\ast}$ and then to compute the Euclidean norm of their difference. The relationship between coil currents $\\mathbf{x} \\in \\mathbb{R}^{n}$ and the field error $\\mathbf{b} \\in \\mathbb{R}^{m}$ is given by the linear system $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$. We are given the singular value decomposition (SVD) of the response matrix $\\mathbf{A}$ as $\\mathbf{A} = \\mathbf{U} \\boldsymbol{\\Sigma} \\mathbf{V}^{\\top}$. The problem is cast in a $3$-dimensional dominant subspace, so we have $\\mathbf{U} = [\\mathbf{u}_{1}, \\mathbf{u}_{2}, \\mathbf{u}_{3}]$, $\\mathbf{V} = [\\mathbf{v}_{1}, \\mathbf{v}_{2}, \\mathbf{v}_{3}]$, and $\\boldsymbol{\\Sigma} = \\operatorname{diag}(s_{1}, s_{2}, s_{3})$. The vectors $\\{\\mathbf{u}_i\\}$ and $\\{\\mathbf{v}_i\\}$ form orthonormal sets. The singular values are given as $s_1 = 5$, $s_2 = 1$, and $s_3 = 0.1$. The projections of the measured error field $\\mathbf{b}^{\\ast}$ onto the left singular vectors are $c_i \\equiv \\mathbf{u}_{i}^{\\top} \\mathbf{b}^{\\ast}$, with given values $c_1=2$, $c_2=1$, and $c_3=1$.\n\nWe seek a solution $\\mathbf{x}$ in the basis of the right singular vectors $\\{\\mathbf{v}_i\\}$, so we write $\\mathbf{x} = \\sum_{j=1}^{3} \\alpha_j \\mathbf{v}_j$. The coefficients $\\alpha_j$ are to be determined.\n\nThe general least-squares problem is to find $\\mathbf{x}$ that minimizes $\\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}^{\\ast}\\|_{2}^{2}$. Substituting the SVD of $\\mathbf{A}$ and the expansion of $\\mathbf{x}$:\n$$ \\mathbf{A}\\mathbf{x} = (\\mathbf{U} \\boldsymbol{\\Sigma} \\mathbf{V}^{\\top}) \\left(\\sum_{j=1}^{3} \\alpha_j \\mathbf{v}_j\\right) = \\mathbf{U} \\boldsymbol{\\Sigma} \\sum_{j=1}^{3} \\alpha_j (\\mathbf{V}^{\\top}\\mathbf{v}_j) $$\nSince $\\mathbf{V}^{\\top}\\mathbf{v}_j = \\mathbf{e}_j$ (the $j$-th standard basis vector), this simplifies to:\n$$ \\mathbf{A}\\mathbf{x} = \\mathbf{U} \\boldsymbol{\\Sigma} \\sum_{j=1}^{3} \\alpha_j \\mathbf{e}_j = \\mathbf{U} \\sum_{j=1}^{3} s_j \\alpha_j \\mathbf{e}_j = \\sum_{i=1}^{3} s_i \\alpha_i \\mathbf{u}_i $$\nThe measurement vector $\\mathbf{b}^{\\ast}$ can be expanded in the basis of $\\{\\mathbf{u}_i\\}$ plus a residual component $\\mathbf{b}^{\\ast}_{\\perp}$ orthogonal to the span of $\\{\\mathbf{u}_i\\}$: $\\mathbf{b}^{\\ast} = \\sum_{i=1}^{3} (\\mathbf{u}_i^{\\top}\\mathbf{b}^{\\ast}) \\mathbf{u}_i + \\mathbf{b}^{\\ast}_{\\perp} = \\sum_{i=1}^{3} c_i \\mathbf{u}_i + \\mathbf{b}^{\\ast}_{\\perp}$.\nThe squared norm to minimize becomes:\n$$ \\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}^{\\ast}\\|_{2}^{2} = \\left\\| \\sum_{i=1}^{3} s_i \\alpha_i \\mathbf{u}_i - \\left( \\sum_{i=1}^{3} c_i \\mathbf{u}_i + \\mathbf{b}^{\\ast}_{\\perp} \\right) \\right\\|_{2}^{2} = \\left\\| \\sum_{i=1}^{3} (s_i \\alpha_i - c_i) \\mathbf{u}_i - \\mathbf{b}^{\\ast}_{\\perp} \\right\\|_{2}^{2} $$\nDue to the orthogonality of the $\\{\\mathbf{u}_i\\}$ and $\\mathbf{b}^{\\ast}_{\\perp}$, the squared norm separates:\n$$ \\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}^{\\ast}\\|_{2}^{2} = \\sum_{i=1}^{3} (s_i \\alpha_i - c_i)^2 + \\|\\mathbf{b}^{\\ast}_{\\perp}\\|_{2}^{2} $$\nThe standard pseudo-inverse solution minimizes this expression by setting $s_i \\alpha_i - c_i = 0$ for each $i$, yielding $\\alpha_i = c_i / s_i$.\n\nStrategy 1: Truncated Singular Value Decomposition (TSVD)\nThe TSVD solution retains only components for which the singular value $s_i$ is greater than or equal to a threshold. Here, the threshold is $1$. The singular values are $s_1=5$, $s_2=1$, and $s_3=0.1$. Thus, we keep components for $i=1$ and $i=2$, and truncate the component for $i=3$.\nThe coefficients for $\\mathbf{x}_{\\text{TSVD}} = \\sum_{j=1}^{3} \\alpha_{j, \\text{TSVD}} \\mathbf{v}_j$ are:\n$$ \\alpha_{1, \\text{TSVD}} = \\frac{c_1}{s_1} = \\frac{2}{5} = 0.4 $$\n$$ \\alpha_{2, \\text{TSVD}} = \\frac{c_2}{s_2} = \\frac{1}{1} = 1 $$\n$$ \\alpha_{3, \\text{TSVD}} = 0 \\quad (\\text{truncated}) $$\nSo, the TSVD solution is $\\mathbf{x}_{\\text{TSVD}} = 0.4 \\mathbf{v}_1 + 1 \\mathbf{v}_2 + 0 \\mathbf{v}_3$.\n\nStrategy 2: Tikhonov Regularization\nTikhonov regularization seeks to minimize the functional $J(\\mathbf{x}) = \\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}^{\\ast}\\|_{2}^{2} + \\lambda \\|\\mathbf{x}\\|_{2}^{2}$ with regularization parameter $\\lambda=0.2$.\nUsing the SVD expansion, the functional becomes:\n$$ J(\\{\\alpha_i\\}) = \\sum_{i=1}^{3} (s_i \\alpha_i - c_i)^2 + \\|\\mathbf{b}^{\\ast}_{\\perp}\\|_{2}^{2} + \\lambda \\left\\| \\sum_{j=1}^{3} \\alpha_j \\mathbf{v}_j \\right\\|_{2}^{2} $$\nSince the vectors $\\{\\mathbf{v}_j\\}$ are orthonormal, $\\|\\sum_{j=1}^{3} \\alpha_j \\mathbf{v}_j\\|_{2}^{2} = \\sum_{j=1}^{3} \\alpha_j^2$.\n$$ J(\\{\\alpha_i\\}) = \\sum_{i=1}^{3} \\left[ (s_i \\alpha_i - c_i)^2 + \\lambda \\alpha_i^2 \\right] + \\|\\mathbf{b}^{\\ast}_{\\perp}\\|_{2}^{2} $$\nTo minimize $J$, we can minimize each term in the sum independently by taking the derivative with respect to $\\alpha_i$ and setting it to zero:\n$$ \\frac{\\partial}{\\partial \\alpha_i} \\left[ (s_i \\alpha_i - c_i)^2 + \\lambda \\alpha_i^2 \\right] = 2(s_i \\alpha_i - c_i)s_i + 2\\lambda\\alpha_i = 0 $$\n$$ \\alpha_i(s_i^2 + \\lambda) = s_i c_i \\implies \\alpha_i = \\frac{s_i c_i}{s_i^2 + \\lambda} $$\nThe coefficients for $\\mathbf{x}_{\\lambda} = \\sum_{j=1}^{3} \\alpha_{j, \\lambda} \\mathbf{v}_j$ are:\n$$ \\alpha_{1, \\lambda} = \\frac{s_1 c_1}{s_1^2 + \\lambda} = \\frac{5 \\times 2}{5^2 + 0.2} = \\frac{10}{25.2} = \\frac{100}{252} = \\frac{25}{63} $$\n$$ \\alpha_{2, \\lambda} = \\frac{s_2 c_2}{s_2^2 + \\lambda} = \\frac{1 \\times 1}{1^2 + 0.2} = \\frac{1}{1.2} = \\frac{10}{12} = \\frac{5}{6} $$\n$$ \\alpha_{3, \\lambda} = \\frac{s_3 c_3}{s_3^2 + \\lambda} = \\frac{0.1 \\times 1}{(0.1)^2 + 0.2} = \\frac{0.1}{0.01 + 0.2} = \\frac{0.1}{0.21} = \\frac{10}{21} $$\nSo, the Tikhonov solution is $\\mathbf{x}_{\\lambda} = \\frac{25}{63} \\mathbf{v}_1 + \\frac{5}{6} \\mathbf{v}_2 + \\frac{10}{21} \\mathbf{v}_3$.\n\nDifference and Norm\nWe need to compute $\\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2}$. The difference vector is:\n$$ \\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda} = (\\alpha_{1, \\text{TSVD}} - \\alpha_{1, \\lambda})\\mathbf{v}_1 + (\\alpha_{2, \\text{TSVD}} - \\alpha_{2, \\lambda})\\mathbf{v}_2 + (\\alpha_{3, \\text{TSVD}} - \\alpha_{3, \\lambda})\\mathbf{v}_3 $$\nLet's compute the difference in coefficients:\n$$ \\Delta\\alpha_1 = \\alpha_{1, \\text{TSVD}} - \\alpha_{1, \\lambda} = \\frac{2}{5} - \\frac{25}{63} = \\frac{2 \\times 63 - 25 \\times 5}{5 \\times 63} = \\frac{126 - 125}{315} = \\frac{1}{315} $$\n$$ \\Delta\\alpha_2 = \\alpha_{2, \\text{TSVD}} - \\alpha_{2, \\lambda} = 1 - \\frac{5}{6} = \\frac{1}{6} $$\n$$ \\Delta\\alpha_3 = \\alpha_{3, \\text{TSVD}} - \\alpha_{3, \\lambda} = 0 - \\frac{10}{21} = -\\frac{10}{21} $$\nSince the basis $\\{\\mathbf{v}_i\\}$ is orthonormal, the Euclidean norm of the difference vector is the square root of the sum of the squares of its coefficients:\n$$ \\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2} = \\sqrt{(\\Delta\\alpha_1)^2 + (\\Delta\\alpha_2)^2 + (\\Delta\\alpha_3)^2} $$\n$$ \\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2}^2 = \\left(\\frac{1}{315}\\right)^2 + \\left(\\frac{1}{6}\\right)^2 + \\left(-\\frac{10}{21}\\right)^2 $$\n$$ \\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2}^2 = \\frac{1}{99225} + \\frac{1}{36} + \\frac{100}{441} $$\nUsing a common denominator of $396900$:\n$$ \\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2}^2 = \\frac{4}{396900} + \\frac{11025}{396900} + \\frac{90000}{396900} = \\frac{4+11025+90000}{396900} = \\frac{101029}{396900} $$\nNow we take the square root. The resulting value will be in units of amperes.\n$$ \\|\\mathbf{x}_{\\text{TSVD}} - \\mathbf{x}_{\\lambda}\\|_{2} = \\sqrt{\\frac{101029}{396900}} \\approx \\sqrt{0.2545452255...} \\approx 0.5045247519... $$\nRounding to four significant figures, we get $0.5045$.",
            "answer": "$$\\boxed{0.5045}$$"
        }
    ]
}