{
    "hands_on_practices": [
        {
            "introduction": "Reduced transport models simplify the three-dimensional reality of a fusion plasma into a one-dimensional problem by averaging physical quantities over magnetic flux surfaces. This foundational exercise () tasks you with deriving the flux-surface average of a poloidally asymmetric heat flux from first principles. By working through the surface integral on a torus, you will gain a concrete understanding of how geometric factors, such as the major and minor radii, directly influence the macroscopic transport properties in a reduced model.",
            "id": "3964867",
            "problem": "In reduced transport modeling of axisymmetric tokamak plasmas, the flux-surface average (FSA) of a scalar field is used to close one-dimensional balance equations. Consider a circular, concentric magnetic flux surface in cylindrical coordinates, characterized by major radius $R_{0}$ and minor radius $r$ with $0rR_{0}$. The toroidal angle is $\\phi \\in [0,2\\pi)$ and the poloidal angle is $\\theta \\in [0,2\\pi)$, with all angles measured in radians. The surface is parameterized by the standard geometry of a circular torus, where the distance from the symmetry axis is $R(\\theta) = R_{0} + r \\cos\\theta$. The local heat flux density on this flux surface is postulated to be poloidally asymmetric,\n$$\nq(\\theta) = q_0 \\left(1 + \\delta \\cos\\theta\\right),\n$$\nwith $q_00$ a constant reference amplitude and $\\delta$ a dimensionless asymmetry parameter satisfying $|\\delta|1$.\n\nStarting from the fundamental definition of the flux-surface average of a scalar field as the surface-area average,\n$$\n\\langle q \\rangle \\equiv \\frac{1}{A}\\iint_{\\mathcal{S}} q \\,\\mathrm{d}S, \\quad A \\equiv \\iint_{\\mathcal{S}} \\mathrm{d}S,\n$$\nand using only the geometry of a circular torus and the fact that $q$ depends solely on $\\theta$, derive a closed-form expression for the dimensionless, normalized flux-surface average $\\langle q \\rangle / q_0$ in terms of $\\delta$, $r$, and $R_{0}$.\n\nYour final answer must be a single closed-form analytic expression for $\\langle q \\rangle/q_0$. Do not include units in your final answer. Angles must be treated in radians.",
            "solution": "The problem asks for the derivation of the normalized flux-surface average $\\langle q \\rangle / q_0$ of a poloidally varying scalar field $q(\\theta)$ on a circular toroidal surface.\n\nThe flux-surface average (FSA) is defined as a surface-area average:\n$$\n\\langle q \\rangle \\equiv \\frac{1}{A}\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S\n$$\nwhere $A$ is the total surface area of the flux surface $\\mathcal{S}$, given by $A = \\iint_{\\mathcal{S}} \\mathrm{d}S$. The problem requires us to find $\\langle q \\rangle / q_0$.\n\nFirst, we must determine the differential surface area element $\\mathrm{d}S$. The toroidal surface is parameterized using the poloidal angle $\\theta \\in [0, 2\\pi)$ and the toroidal angle $\\phi \\in [0, 2\\pi)$. In a Cartesian coordinate system $(x,y,z)$ where the $z$-axis is the axis of symmetry, the position vector $\\vec{p}(\\theta, \\phi)$ for a point on the torus is:\n$$\n\\vec{p}(\\theta, \\phi) = \\begin{pmatrix} x \\\\ y \\\\ z \\end{pmatrix} = \\begin{pmatrix} (R_{0} + r \\cos\\theta) \\cos\\phi \\\\ (R_{0} + r \\cos\\theta) \\sin\\phi \\\\ r \\sin\\theta \\end{pmatrix}\n$$\nHere, $R(\\theta) = R_{0} + r \\cos\\theta$ is the distance from the symmetry axis. The surface element $\\mathrm{d}S$ is given by the magnitude of the cross product of the tangent vectors $\\frac{\\partial\\vec{p}}{\\partial\\theta}$ and $\\frac{\\partial\\vec{p}}{\\partial\\phi}$.\n\nThe partial derivatives are:\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\theta} = \\begin{pmatrix} -r \\sin\\theta \\cos\\phi \\\\ -r \\sin\\theta \\sin\\phi \\\\ r \\cos\\theta \\end{pmatrix}\n$$\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\phi} = \\begin{pmatrix} -(R_{0} + r \\cos\\theta) \\sin\\phi \\\\ (R_{0} + r \\cos\\theta) \\cos\\phi \\\\ 0 \\end{pmatrix}\n$$\n\nThe cross product is:\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi} = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ -r \\sin\\theta \\cos\\phi  -r \\sin\\theta \\sin\\phi  r \\cos\\theta \\\\ -(R_{0} + r \\cos\\theta) \\sin\\phi  (R_{0} + r \\cos\\theta) \\cos\\phi  0 \\end{vmatrix}\n$$\n$$\n= \\mathbf{i} \\left( 0 - r \\cos\\theta (R_{0} + r \\cos\\theta) \\cos\\phi \\right) - \\mathbf{j} \\left( 0 - r \\cos\\theta (-(R_{0} + r \\cos\\theta) \\sin\\phi) \\right) + \\mathbf{k} \\left( -r \\sin\\theta \\cos\\phi (R_{0} + r \\cos\\theta) \\cos\\phi - (-r \\sin\\theta \\sin\\phi) (-(R_{0} + r \\cos\\theta) \\sin\\phi) \\right)\n$$\n$$\n= -r(R_{0} + r \\cos\\theta) \\cos\\theta \\cos\\phi \\, \\mathbf{i} - r(R_{0} + r \\cos\\theta) \\cos\\theta \\sin\\phi \\, \\mathbf{j} - r(R_{0} + r \\cos\\theta) \\sin\\theta (\\cos^2\\phi + \\sin^2\\phi) \\, \\mathbf{k}\n$$\n$$\n= -r(R_{0} + r \\cos\\theta) \\begin{pmatrix} \\cos\\theta \\cos\\phi \\\\ \\cos\\theta \\sin\\phi \\\\ \\sin\\theta \\end{pmatrix}\n$$\n\nThe magnitude of this vector is:\n$$\n\\left|\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi}\\right| = | -r(R_{0} + r \\cos\\theta) | \\sqrt{(\\cos\\theta \\cos\\phi)^2 + (\\cos\\theta \\sin\\phi)^2 + (\\sin\\theta)^2}\n$$\nGiven $R_{0} > r > 0$, the term $R_{0} + r \\cos\\theta$ is always positive. Thus,\n$$\n\\left|\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi}\\right| = r(R_{0} + r \\cos\\theta) \\sqrt{\\cos^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + \\sin^2\\theta}\n$$\n$$\n= r(R_{0} + r \\cos\\theta) \\sqrt{\\cos^2\\theta + \\sin^2\\theta} = r(R_{0} + r \\cos\\theta)\n$$\nSo, the surface area element is $\\mathrm{d}S = r(R_{0} + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$.\n\nNow we compute the total surface area $A$, which is the denominator of the FSA expression.\n$$\nA = \\iint_{\\mathcal{S}} \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} r(R_{0} + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\nThe integrand does not depend on $\\phi$, so the integration over $\\phi$ yields a factor of $2\\pi$:\n$$\nA = 2\\pi r \\int_0^{2\\pi} (R_{0} + r \\cos\\theta) \\, \\mathrm{d}\\theta = 2\\pi r \\left[ R_{0}\\theta + r \\sin\\theta \\right]_0^{2\\pi}\n$$\n$$\nA = 2\\pi r ( (R_{0} \\cdot 2\\pi + r \\sin(2\\pi)) - (0 + 0) ) = 4\\pi^2 R_{0} r\n$$\nThis is the well-known formula for the surface area of a torus.\n\nNext, we compute the numerator of the FSA expression, which is the integral of $q(\\theta)$ over the surface.\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} q(\\theta) \\, \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} q_0(1 + \\delta \\cos\\theta) r(R_{0} + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\nAgain, integrating over $\\phi$ gives a factor of $2\\pi$. We also factor out the constants $q_0$ and $r$.\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = 2\\pi q_0 r \\int_0^{2\\pi} (1 + \\delta \\cos\\theta)(R_{0} + r \\cos\\theta) \\, \\mathrm{d}\\theta\n$$\nWe expand the integrand:\n$$\n(1 + \\delta \\cos\\theta)(R_{0} + r \\cos\\theta) = R_{0} + r \\cos\\theta + \\delta R_{0} \\cos\\theta + \\delta r \\cos^2\\theta = R_{0} + (r + \\delta R_{0})\\cos\\theta + \\delta r \\cos^2\\theta\n$$\nNow we integrate this expression with respect to $\\theta$ from $0$ to $2\\pi$:\n$$\n\\int_0^{2\\pi} \\left( R_{0} + (r + \\delta R_{0})\\cos\\theta + \\delta r \\cos^2\\theta \\right) \\mathrm{d}\\theta\n$$\nWe evaluate the integral term by term:\n$$\n\\int_0^{2\\pi} R_{0} \\, \\mathrm{d}\\theta = R_{0} [\\theta]_0^{2\\pi} = 2\\pi R_{0}\n$$\n$$\n\\int_0^{2\\pi} (r + \\delta R_{0})\\cos\\theta \\, \\mathrm{d}\\theta = (r + \\delta R_{0})[\\sin\\theta]_0^{2\\pi} = 0\n$$\nFor the last term, we use the identity $\\cos^2\\theta = \\frac{1}{2}(1 + \\cos(2\\theta))$:\n$$\n\\int_0^{2\\pi} \\delta r \\cos^2\\theta \\, \\mathrm{d}\\theta = \\delta r \\int_0^{2\\pi} \\frac{1 + \\cos(2\\theta)}{2} \\, \\mathrm{d}\\theta = \\frac{\\delta r}{2} \\left[ \\theta + \\frac{1}{2}\\sin(2\\theta) \\right]_0^{2\\pi} = \\frac{\\delta r}{2} (2\\pi) = \\pi \\delta r\n$$\nSumming these results, the integral over $\\theta$ is $2\\pi R_{0} + 0 + \\pi \\delta r$.\nThe numerator is therefore:\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = 2\\pi q_0 r (2\\pi R_{0} + \\pi \\delta r) = 2\\pi^2 q_0 r (2R_{0} + \\delta r)\n$$\n\nNow we can compute the flux-surface average $\\langle q \\rangle$:\n$$\n\\langle q \\rangle = \\frac{\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S}{A} = \\frac{2\\pi^2 q_0 r (2R_{0} + \\delta r)}{4\\pi^2 R_{0} r}\n$$\nCanceling common factors of $2\\pi^2 r$:\n$$\n\\langle q \\rangle = q_0 \\frac{2R_{0} + \\delta r}{2R_{0}} = q_0 \\left( 1 + \\frac{\\delta r}{2R_{0}} \\right)\n$$\nFinally, the problem asks for the normalized quantity $\\langle q \\rangle / q_0$.\n$$\n\\frac{\\langle q \\rangle}{q_0} = 1 + \\frac{\\delta r}{2R_{0}}\n$$\nThis expression is dimensionless, as required, since $\\delta$ is dimensionless and $r/R_{0}$ is a ratio of lengths.",
            "answer": "$$\n\\boxed{1 + \\frac{\\delta r}{2R_{0}}}\n$$"
        },
        {
            "introduction": "Once the one-dimensional framework is established, reduced models are used to describe the evolution of plasma profiles based on local conservation laws. This practice () challenges you to apply the steady-state particle continuity equation, a cornerstone of transport modeling, to a plasma with defined diffusive and convective fluxes. By integrating the local equation, you will determine the global particle source required to maintain a specific density profile, reinforcing the connection between local transport physics and global machine operation.",
            "id": "3964888",
            "problem": "Consider a large-aspect-ratio tokamak with circular cross-section and major radius $R_{0}$, whose minor radius coordinate is $r \\in [0,a]$. Let $\\mathcal{V}(r)$ denote the volume enclosed by the flux surface labeled by $r$, and let $\\mathcal{V}'(r) \\equiv d\\mathcal{V}/dr$ denote the corresponding flux-surface area. In the large-aspect-ratio, circular-geometry approximation, take $\\mathcal{V}'(r) = 4 \\pi^{2} R_{0} r$. The flux-surface-averaged, steady-state particle continuity equation relates the divergence of the radial particle flux to the volumetric particle source density. Adopt a reduced transport closure in which the radial particle flux is the sum of a diffusive contribution and a convective (pinch) contribution, with coefficients that may depend on $r$. Specifically, let the radial particle flux be of the form $\\Gamma_{r}(r) = - D(r) \\, d n(r)/dr + V(r) \\, n(r)$, where $n(r)$ is the target density profile, $D(r)$ is the particle diffusivity, and $V(r)$ is the convective pinch velocity.\n\nYou are given the following profiles:\n- $D(r) = D_{0} \\left[ 1 + \\alpha \\left( \\frac{r}{a} \\right)^{2} \\right]$,\n- $V(r) = V_{0} \\left( \\frac{r}{a} \\right)$,\n- $n(r) = n_{0} \\left[ 1 - \\left( \\frac{r}{a} \\right)^{2} \\right]$,\n\nwith $D_{0} > 0$, $\\alpha \\ge 0$, $V_{0}$, $n_{0} > 0$, and $a > 0$ constants. Assume regularity at the magnetic axis $r=0$ so that the radial particle flux $\\Gamma_{r}(r)$ remains finite as $r \\to 0$, and take the last closed flux surface (LCFS) to be at $r=a$.\n\nStarting from the steady-state flux-surface-averaged particle continuity equation and the above closure for $\\Gamma_{r}(r)$, use an integral constraint over $0 \\le r \\le a$ to determine the total particle source (the total fueling rate) $\\Phi_{\\text{tot}} \\equiv \\int_{0}^{a} S(r) \\, \\mathcal{V}'(r) \\, dr$ required to sustain the given target density profile. Express your final answer as a single closed-form analytic expression in terms of $n_{0}$, $D_{0}$, $\\alpha$, $V_{0}$, $a$, and $R_{0}$. The physical unit of $\\Phi_{\\text{tot}}$ is $\\text{s}^{-1}$ (particles per second). Do not insert any numerical values, and do not include units in your final boxed answer.",
            "solution": "The problem requires the determination of the total particle source rate, $\\Phi_{\\text{tot}}$, needed to sustain a given steady-state density profile in a tokamak plasma. The starting point is the flux-surface-averaged, steady-state particle continuity equation, which represents the local conservation of particles:\n$$ \\frac{1}{\\mathcal{V}'(r)} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) = S(r) $$\nHere, $r$ is the minor radius coordinate, $S(r)$ is the volumetric particle source density, $\\Gamma_{r}(r)$ is the radial particle flux, and $\\mathcal{V}'(r)$ is the flux-surface area, given by $\\mathcal{V}'(r) = 4 \\pi^{2} R_{0} r$ in the large-aspect-ratio, circular-geometry approximation.\n\nThe total particle source rate, $\\Phi_{\\text{tot}}$, is the integral of the volumetric source density over the entire plasma volume, from the magnetic axis ($r=0$) to the last closed flux surface (LCFS) at $r=a$. The volume element is $d\\mathcal{V} = \\mathcal{V}'(r) dr$. Thus, $\\Phi_{\\text{tot}}$ is defined as:\n$$ \\Phi_{\\text{tot}} \\equiv \\int_{0}^{a} S(r) \\mathcal{V}'(r) dr $$\nSubstituting the expression for $S(r)$ from the continuity equation into this definition, we obtain:\n$$ \\Phi_{\\text{tot}} = \\int_{0}^{a} \\left[ \\frac{1}{\\mathcal{V}'(r)} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) \\right] \\mathcal{V}'(r) dr $$\nThe $\\mathcal{V}'(r)$ terms cancel, leaving a simple integral of a total derivative:\n$$ \\Phi_{\\text{tot}} = \\int_{0}^{a} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) dr $$\nBy the Fundamental Theorem of Calculus, this integral evaluates to the difference of the integrand at the boundaries of the integration domain:\n$$ \\Phi_{\\text{tot}} = \\left[ \\mathcal{V}'(r) \\Gamma_{r}(r) \\right]_{r=0}^{r=a} = \\mathcal{V}'(a) \\Gamma_{r}(a) - \\mathcal{V}'(0) \\Gamma_{r}(0) $$\nWe must now evaluate the two boundary terms.\nAt the magnetic axis, $r=0$, the flux-surface area is $\\mathcal{V}'(0) = 4 \\pi^{2} R_{0} (0) = 0$. The problem also states that the radial particle flux $\\Gamma_{r}(r)$ must remain finite as $r \\to 0$. Therefore, the term at the lower boundary vanishes:\n$$ \\mathcal{V}'(0) \\Gamma_{r}(0) = 0 $$\nThis simplifies the expression for the total source rate to the particle flux out of the LCFS, multiplied by the area of the LCFS:\n$$ \\Phi_{\\text{tot}} = \\mathcal{V}'(a) \\Gamma_{r}(a) $$\nThis is a statement of global particle balance in steady state: the total number of particles sourced within the volume must equal the total number of particles flowing out across its boundary.\n\nNext, we must calculate the quantities $\\mathcal{V}'(a)$ and $\\Gamma_{r}(a)$.\nThe flux-surface area at $r=a$ is:\n$$ \\mathcal{V}'(a) = 4 \\pi^{2} R_{0} a $$\nThe radial particle flux $\\Gamma_{r}(r)$ is given by the transport closure:\n$$ \\Gamma_{r}(r) = - D(r) \\frac{dn(r)}{dr} + V(r) n(r) $$\nWe need to evaluate this expression at $r=a$ using the provided profiles.\nThe density profile is $n(r) = n_{0} \\left[ 1 - \\left( \\frac{r}{a} \\right)^{2} \\right]$. At the LCFS, $r=a$, the density is:\n$$ n(a) = n_{0} \\left[ 1 - \\left( \\frac{a}{a} \\right)^{2} \\right] = n_{0} (1 - 1) = 0 $$\nThe density gradient is $\\frac{dn}{dr} = \\frac{d}{dr} \\left( n_{0} - \\frac{n_{0}r^{2}}{a^{2}} \\right) = - \\frac{2 n_{0} r}{a^{2}}$. At $r=a$, the gradient is:\n$$ \\frac{dn}{dr}\\bigg|_{r=a} = - \\frac{2 n_{0}}{a} $$\nThe diffusivity at $r=a$ is obtained from $D(r) = D_{0} \\left[ 1 + \\alpha \\left( \\frac{r}{a} \\right)^{2} \\right]$:\n$$ D(a) = D_{0} (1 + \\alpha) $$\nThe convective pinch velocity at $r=a$ is obtained from $V(r) = V_{0} \\frac{r}{a}$:\n$$ V(a) = V_{0} $$\nNow we assemble the expression for the flux at the edge, $\\Gamma_{r}(a)$:\n$$ \\Gamma_{r}(a) = - D(a) \\left( \\frac{dn}{dr}\\bigg|_{r=a} \\right) + V(a) n(a) $$\nSubstituting the calculated values:\n$$ \\Gamma_{r}(a) = - \\left[ D_{0} (1 + \\alpha) \\right] \\left( - \\frac{2 n_{0}}{a} \\right) + (V_{0}) (0) $$\n$$ \\Gamma_{r}(a) = \\frac{2 n_{0} D_{0} (1 + \\alpha)}{a} $$\nNotice that the convective part of the flux, $V(r)n(r)$, vanishes at the boundary because the density $n(a)$ is zero.\n\nFinally, we compute the total particle source rate $\\Phi_{\\text{tot}}$ by substituting the expressions for $\\mathcal{V}'(a)$ and $\\Gamma_{r}(a)$:\n$$ \\Phi_{\\text{tot}} = \\mathcal{V}'(a) \\Gamma_{r}(a) = \\left( 4 \\pi^{2} R_{0} a \\right) \\left( \\frac{2 n_{0} D_{0} (1 + \\alpha)}{a} \\right) $$\nThe minor radius $a$ cancels from the expression:\n$$ \\Phi_{\\text{tot}} = 8 \\pi^{2} R_{0} n_{0} D_{0} (1 + \\alpha) $$\nThis is the final closed-form analytic expression for the total fueling rate required to sustain the specified density profile under the given transport model. The result depends on the major radius, central density, central diffusivity, and the diffusivity shape parameter $\\alpha$, but is independent of the minor radius $a$ and the pinch velocity parameter $V_{0}$ due to the specific boundary condition $n(a)=0$.",
            "answer": "$$ \\boxed{8 \\pi^{2} R_{0} n_{0} D_{0} (1 + \\alpha)} $$"
        },
        {
            "introduction": "A central task in developing reduced transport models is to determine the effective transport coefficients that encapsulate complex microphysics. This computational exercise () simulates this process by having you fit a simple Fourier's law model, $q = -\\kappa \\nabla T$, to synthetic data from a more fundamental, first-principles simulation. Through this hands-on fitting procedure, you will learn how to derive a reduced coefficient via least-squares minimization and how to assess the model's fidelity by calculating the residual error.",
            "id": "3964885",
            "problem": "You are tasked with constructing and validating a reduced transport model for heat conduction in a magnetized fusion plasma by fitting an effective thermal conductivity using synthetic data that represent gyrokinetic-computed heat flux at fixed plasma beta and normalized gyroradius. You must implement a complete, runnable program that reads no external inputs and uses the provided synthetic data inside the program.\n\nFundamental base: In the reduced transport model, Fourier’s law for heat conduction posits that the heat flux vector is given by $q = - \\kappa \\nabla T$, where $q$ is the heat flux, $\\kappa$ is the scalar isotropic thermal conductivity, and $\\nabla T$ is the temperature gradient. In a fixed equilibrium characterized by plasma beta $\\beta$ and normalized gyroradius $\\rho_\\ast$, assume that gyrokinetic heat-flux data $Q$ depends on $\\nabla T$ through an effective isotropic $\\kappa$ with possible non-diffusive components. Given $N$ samples $\\{(\\nabla T_i, Q_i)\\}_{i=1}^N$, with $Q_i \\in \\mathbb{R}^d$ and $\\nabla T_i \\in \\mathbb{R}^d$, you will fit a single scalar $\\kappa$ by least squares to minimize the residual error between the measured fluxes $Q_i$ and the model $- \\kappa \\nabla T_i$.\n\nMathematical objective: For a dataset at fixed $\\beta$ and $\\rho_\\ast$, define the least-squares objective\n$$\nJ(\\kappa) = \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2,\n$$\nand find the value of $\\kappa$ that minimizes $J(\\kappa)$. Compute and report the residual error norm\n$$\n\\|r\\|_2 = \\left( \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2 \\right)^{1/2}.\n$$\nIf the data provide no information on $\\kappa$ (that is, if $\\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2 = 0$), set $\\kappa = 0$ and compute the residual norm as $\\left( \\sum_{i=1}^{N} \\|Q_i\\|_2^2 \\right)^{1/2}$.\n\nUnits: Report $\\kappa$ in International System of Units (SI) as watts per meter-kelvin ($\\mathrm{W/(m \\cdot K)}$) and the residual norm in watts per square meter ($\\mathrm{W/m^2}$). The program should output numerical values without unit strings, but all computations must be consistent with these units.\n\nTest suite: Implement the following four datasets (each dataset is independently at fixed $\\beta$ and $\\rho_\\ast$), all in two spatial dimensions $d = 2$:\n\n- Case $1$ (happy path, perfectly diffusive): Fixed $\\beta = 0.02$ and $\\rho_\\ast = 10^{-3}$. Use $N = 4$ samples with\n  - $\\nabla T_1 = (10.0, 0.0)$, $Q_1 = (-50.0, 0.0)$,\n  - $\\nabla T_2 = (0.0, 8.0)$, $Q_2 = (0.0, -40.0)$,\n  - $\\nabla T_3 = (6.0, 6.0)$, $Q_3 = (-30.0, -30.0)$,\n  - $\\nabla T_4 = (-4.0, 5.0)$, $Q_4 = (20.0, -25.0)$.\n  These are consistent with an exact $\\kappa_{\\text{true}} = 5.0$ and no non-diffusive components.\n\n- Case $2$ (perpendicular non-diffusive flux components): Fixed $\\beta = 0.03$ and $\\rho_\\ast = 2 \\times 10^{-3}$. Use $N = 4$ samples with\n  - $\\nabla T_1 = (12.0, 0.0)$, $Q_1 = (-24.0, 1.0)$,\n  - $\\nabla T_2 = (9.0, 0.0)$, $Q_2 = (-18.0, -1.0)$,\n  - $\\nabla T_3 = (6.0, 0.0)$, $Q_3 = (-12.0, 0.5)$,\n  - $\\nabla T_4 = (3.0, 0.0)$, $Q_4 = (-6.0, -0.5)$.\n  These are consistent with $\\kappa_{\\text{true}} = 2.0$ and added non-diffusive components perpendicular to $\\nabla T$.\n\n- Case $3$ (no gradient information, pure non-diffusive flux): Fixed $\\beta = 0.015$ and $\\rho_\\ast = 8 \\times 10^{-4}$. Use $N = 2$ samples with\n  - $\\nabla T_1 = (0.0, 0.0)$, $Q_1 = (1.0, -2.0)$,\n  - $\\nabla T_2 = (0.0, 0.0)$, $Q_2 = (-0.5, 0.5)$.\n\n- Case $4$ (mixed alignment, one zero-gradient sample, small non-diffusive components): Fixed $\\beta = 0.025$ and $\\rho_\\ast = 1.5 \\times 10^{-3}$. Use $N = 5$ samples with\n  - $\\nabla T_1 = (5.0, 1.0)$, $Q_1 = (-14.8, -3.1)$,\n  - $\\nabla T_2 = (-4.0, 2.0)$, $Q_2 = (12.0, -6.0)$,\n  - $\\nabla T_3 = (0.0, 0.0)$, $Q_3 = (1.0, -1.0)$,\n  - $\\nabla T_4 = (3.0, -3.0)$, $Q_4 = (-8.5, 9.5)$,\n  - $\\nabla T_5 = (2.0, 4.0)$, $Q_5 = (-6.2, -11.9)$.\n\nAlgorithmic task: For each dataset, compute the least-squares $\\kappa$ that minimizes $J(\\kappa)$ and then compute the residual error norm $\\|r\\|_2$, both reported as real numbers (floating-point). All datasets are independent and must be processed sequentially in the program.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each dataset’s result is represented as a two-element list $[\\kappa,\\|r\\|_2]$. For the four cases above, the output must therefore have the format\n$$\n[[\\kappa_1,\\|r_1\\|_2],[\\kappa_2,\\|r_2\\|_2],[\\kappa_3,\\|r_3\\|_2],[\\kappa_4,\\|r_4\\|_2]],\n$$\nwith no spaces. All values must be expressed in SI units as specified above.",
            "solution": "The problem statement is evaluated for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **Model:** The heat flux vector $q$ is related to the temperature gradient $\\nabla T$ via Fourier's law, $q = - \\kappa \\nabla T$, where $\\kappa$ is a scalar isotropic thermal conductivity.\n- **Data:** A set of $N$ samples $\\{(\\nabla T_i, Q_i)\\}_{i=1}^N$ is provided, where $Q_i \\in \\mathbb{R}^d$ is the measured heat flux and $\\nabla T_i \\in \\mathbb{R}^d$ is the temperature gradient. The spatial dimension is $d=2$.\n- **Objective:** Find the scalar $\\kappa$ that minimizes the least-squares objective function $J(\\kappa) = \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2$.\n- **Quantity to Compute:** The residual error norm, defined as $\\|r\\|_2 = \\left( \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2 \\right)^{1/2}$, where $\\kappa$ is the optimal value.\n- **Special Condition:** If $\\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2 = 0$, then set $\\kappa = 0$ and the residual norm is calculated as $\\|r\\|_2 = \\left( \\sum_{i=1}^{N} \\|Q_i\\|_2^2 \\right)^{1/2}$.\n- **Units:** $\\kappa$ is in watts per meter-kelvin ($\\mathrm{W/(m \\cdot K)}$) and $\\|r\\|_2$ is in watts per square meter ($\\mathrm{W/m^2}$).\n- **Datasets ($d=2$):**\n    - **Case 1:** $N = 4$. Data points: $(\\nabla T_1, Q_1) = ((10.0, 0.0), (-50.0, 0.0))$, $(\\nabla T_2, Q_2) = ((0.0, 8.0), (0.0, -40.0))$, $(\\nabla T_3, Q_3) = ((6.0, 6.0), (-30.0, -30.0))$, $(\\nabla T_4, Q_4) = ((-4.0, 5.0), (20.0, -25.0))$.\n    - **Case 2:** $N = 4$. Data points: $(\\nabla T_1, Q_1) = ((12.0, 0.0), (-24.0, 1.0))$, $(\\nabla T_2, Q_2) = ((9.0, 0.0), (-18.0, -1.0))$, $(\\nabla T_3, Q_3) = ((6.0, 0.0), (-12.0, 0.5))$, $(\\nabla T_4, Q_4) = ((3.0, 0.0), (-6.0, -0.5))$.\n    - **Case 3:** $N = 2$. Data points: $(\\nabla T_1, Q_1) = ((0.0, 0.0), (1.0, -2.0))$, $(\\nabla T_2, Q_2) = ((0.0, 0.0), (-0.5, 0.5))$.\n    - **Case 4:** $N = 5$. Data points: $(\\nabla T_1, Q_1) = ((5.0, 1.0), (-14.8, -3.1))$, $(\\nabla T_2, Q_2) = ((-4.0, 2.0), (12.0, -6.0))$, $(\\nabla T_3, Q_3) = ((0.0, 0.0), (1.0, -1.0))$, $(\\nabla T_4, Q_4) = ((3.0, -3.0), (-8.5, 9.5))$, $(\\nabla T_5, Q_5) = ((2.0, 4.0), (-6.2, -11.9))$.\n- **Required Output Format:** A single-line string `[[k1,r1],[k2,r2],[k3,r3],[k4,r4]]`.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to validation against the established criteria.\n- **Scientifically Grounded:** The problem is grounded in the well-established principles of heat transfer (Fourier's Law) and numerical model reduction, a standard practice in computational physics and engineering. The context of fitting a reduced transport model for a fusion plasma using gyrokinetic data is scientifically authentic.\n- **Well-Posed:** The task is to solve a linear least-squares problem for a single parameter. The objective function $J(\\kappa)$ is a quadratic in $\\kappa$, which has a unique global minimum. The problem explicitly addresses the singular case where the gradient data is null, ensuring a well-defined procedure for all provided inputs.\n- **Objective:** The problem is stated using precise mathematical language and provides explicit, numerical data. There are no subjective or opinion-based components.\n- **Completeness and Consistency:** All necessary data, formulae, and boundary conditions (in the form of the special case) are provided. The datasets are self-contained and do not contradict the stated objective.\n- **Realism:** The numerical values, while synthetic, are plausible in the context of normalized simulations within fusion science. The units and quantities are physically consistent.\n\n### Step 3: Verdict and Action\nThe problem is scientifically and mathematically sound, well-posed, and complete. It is therefore deemed **valid**. A solution will be developed.\n\n### Principle-Based Design and Solution\n\nThe core of the problem is to find the scalar thermal conductivity $\\kappa$ that minimizes the sum of squared residuals between observed heat fluxes $Q_i$ and the model prediction $- \\kappa \\nabla T_i$. The objective function to be minimized is:\n$$\nJ(\\kappa) = \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2\n$$\nTo find the minimum, we must find the value of $\\kappa$ for which the derivative of $J(\\kappa)$ with respect to $\\kappa$ is zero. First, we expand the squared L2-norm term. The squared norm of a vector is its dot product with itself.\n$$\n\\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2 = (Q_i + \\kappa \\nabla T_i) \\cdot (Q_i + \\kappa \\nabla T_i)\n$$\nUsing the distributive property of the dot product:\n$$\n(Q_i + \\kappa \\nabla T_i) \\cdot (Q_i + \\kappa \\nabla T_i) = Q_i \\cdot Q_i + 2\\kappa (Q_i \\cdot \\nabla T_i) + \\kappa^2 (\\nabla T_i \\cdot \\nabla T_i)\n$$\nRecognizing that $v \\cdot v = \\|v\\|_2^2$, this becomes:\n$$\n\\left\\| Q_i + \\kappa \\nabla T_i \\right\\|_2^2 = \\|Q_i\\|_2^2 + 2\\kappa (Q_i \\cdot \\nabla T_i) + \\kappa^2 \\|\\nabla T_i\\|_2^2\n$$\nSubstituting this back into the expression for $J(\\kappa)$ and distributing the summation:\n$$\nJ(\\kappa) = \\sum_{i=1}^{N} \\left( \\|Q_i\\|_2^2 + 2\\kappa (Q_i \\cdot \\nabla T_i) + \\kappa^2 \\|\\nabla T_i\\|_2^2 \\right) = \\left( \\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2 \\right) \\kappa^2 + 2 \\left( \\sum_{i=1}^{N} Q_i \\cdot \\nabla T_i \\right) \\kappa + \\left( \\sum_{i=1}^{N} \\|Q_i\\|_2^2 \\right)\n$$\nThis is a standard quadratic function of $\\kappa$ of the form $A\\kappa^2 + B\\kappa + C$. To find the minimum, we compute the derivative with respect to $\\kappa$ and set it to zero:\n$$\n\\frac{dJ}{d\\kappa} = 2 \\left( \\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2 \\right) \\kappa + 2 \\left( \\sum_{i=1}^{N} Q_i \\cdot \\nabla T_i \\right) = 0\n$$\nSolving for $\\kappa$:\n$$\n\\left( \\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2 \\right) \\kappa = - \\sum_{i=1}^{N} Q_i \\cdot \\nabla T_i\n$$\nProvided that the denominator is non-zero, the optimal value of $\\kappa$ is:\n$$\n\\kappa_{\\text{opt}} = - \\frac{\\sum_{i=1}^{N} Q_i \\cdot \\nabla T_i}{\\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2}\n$$\nThe denominator, $\\sum_{i=1}^{N} \\|\\nabla T_i\\|_2^2$, is zero if and only if all gradient vectors $\\nabla T_i$ are zero vectors. This condition corresponds exactly to the special case defined in the problem statement. In this situation, the data provide no information to determine a diffusive transport coefficient, and the problem correctly prescribes setting $\\kappa = 0$.\n\nOnce the optimal $\\kappa$ is determined, the residual error norm $\\|r\\|_2$ is computed by substituting this value back into its definition:\n$$\n\\|r\\|_2 = \\sqrt{J(\\kappa_{\\text{opt}})} = \\left( \\sum_{i=1}^{N} \\left\\| Q_i + \\kappa_{\\text{opt}} \\nabla T_i \\right\\|_2^2 \\right)^{1/2}\n$$\nIf the special case applies ($\\kappa=0$), this simplifies to:\n$$\n\\|r\\|_2 = \\left( \\sum_{i=1}^{N} \\|Q_i\\|_2^2 \\right)^{1/2}\n$$\nThe algorithm for each case is as follows:\n1. Initialize a numerator sum $S_{\\text{num}} = 0$ and a denominator sum $S_{\\text{den}} = 0$.\n2. For each sample $(\\nabla T_i, Q_i)$:\n   a. Compute the dot product $d_i = Q_i \\cdot \\nabla T_i$ and add it to $S_{\\text{num}}$.\n   b. Compute the squared norm $n_i = \\|\\nabla T_i\\|_2^2$ and add it to $S_{\\text{den}}$.\n3. Check if $S_{\\text{den}}$ is effectively zero. If so, set $\\kappa = 0$. Otherwise, compute $\\kappa = -S_{\\text{num}} / S_{\\text{den}}$.\n4. Initialize a sum of squared residuals, $E^2 = 0$.\n5. For each sample $(\\nabla T_i, Q_i)$:\n   a. Compute the residual vector $r_i = Q_i + \\kappa \\nabla T_i$.\n   b. Compute the squared norm $\\|r_i\\|_2^2$ and add it to $E^2$.\n6. The final residual norm is $\\|r\\|_2 = \\sqrt{E^2}$.\nThis procedure is applied to each of the four datasets provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the effective thermal conductivity and residual error norm\n    for four different synthetic datasets from a fusion plasma simulation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a list of tuples, where each tuple contains\n    # a temperature gradient vector and a heat flux vector.\n    test_cases = [\n        # Case 1: Happy path, perfectly diffusive\n        [\n            (np.array([10.0, 0.0]), np.array([-50.0, 0.0])),\n            (np.array([0.0, 8.0]), np.array([0.0, -40.0])),\n            (np.array([6.0, 6.0]), np.array([-30.0, -30.0])),\n            (np.array([(-4.0), 5.0]), np.array([20.0, -25.0])),\n        ],\n        # Case 2: Perpendicular non-diffusive flux\n        [\n            (np.array([12.0, 0.0]), np.array([-24.0, 1.0])),\n            (np.array([9.0, 0.0]), np.array([-18.0, -1.0])),\n            (np.array([6.0, 0.0]), np.array([-12.0, 0.5])),\n            (np.array([3.0, 0.0]), np.array([-6.0, -0.5])),\n        ],\n        # Case 3: No gradient information\n        [\n            (np.array([0.0, 0.0]), np.array([1.0, -2.0])),\n            (np.array([0.0, 0.0]), np.array([-0.5, 0.5])),\n        ],\n        # Case 4: Mixed alignment, non-diffusive components\n        [\n            (np.array([5.0, 1.0]), np.array([-14.8, -3.1])),\n            (np.array([-4.0, 2.0]), np.array([12.0, -6.0])),\n            (np.array([0.0, 0.0]), np.array([1.0, -1.0])),\n            (np.array([3.0, -3.0]), np.array([-8.5, 9.5])),\n            (np.array([2.0, 4.0]), np.array([-6.2, -11.9])),\n        ],\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        numerator_sum = 0.0\n        denominator_sum = 0.0\n\n        # First pass: calculate sums for kappa\n        for grad_T, Q in case:\n            numerator_sum += np.dot(Q, grad_T)\n            denominator_sum += np.dot(grad_T, grad_T)\n\n        kappa = 0.0\n        # Check for the special case where no gradient information is available.\n        # A small tolerance is used for floating-point comparison.\n        if abs(denominator_sum) > 1e-15:\n            kappa = -numerator_sum / denominator_sum\n        else:\n            # As per problem spec, if sum of ||grad T_i||^2 = 0, kappa is 0.\n            kappa = 0.0\n\n        # Second pass: calculate residual norm using the computed kappa\n        residual_sq_sum = 0.0\n        if abs(denominator_sum) = 1e-15:\n            # Special case calculation for the residual norm\n            for _, Q in case:\n                residual_sq_sum += np.dot(Q, Q)\n        else:\n            for grad_T, Q in case:\n                residual_vector = Q + kappa * grad_T\n                residual_sq_sum += np.dot(residual_vector, residual_vector)\n                \n        residual_norm = np.sqrt(residual_sq_sum)\n        \n        results.append([kappa, residual_norm])\n\n    # Format the output string to match the exact requirement:\n    # [[k1,r1],[k2,r2],...] with no spaces.\n    # Using a list comprehension and join is a clean way to achieve this.\n    output_str = f\"[{','.join([f'[{k},{r}]' for k, r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}