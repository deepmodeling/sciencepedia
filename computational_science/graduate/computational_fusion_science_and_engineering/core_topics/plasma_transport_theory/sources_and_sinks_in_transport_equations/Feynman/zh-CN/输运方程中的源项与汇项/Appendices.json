{
    "hands_on_practices": [
        {
            "introduction": "在我们着手模拟一个物理过程之前，必须先理解其基本属性。第一个练习聚焦于量纲分析，这是一个确保我们所用方程在物理和数学上保持一致性的强大工具。通过分析粒子连续性方程中每一项的单位，我们可以推断出源项的物理性质，并确认其在局部粒子守恒中的作用 。",
            "id": "4045974",
            "problem": "在磁约束聚变等离子体中，单一粒子种类的粒子连续性方程为 $\\partial_{t} n + \\nabla \\cdot \\Gamma = S_{n}$，其中 $n$ 是数密度，$\\Gamma$ 是粒子通量密度。假设 $n$ 的单位是 $\\mathrm{m^{-3}}$，$\\Gamma$ 的单位是 $\\mathrm{m^{-2}\\,s^{-1}}$。从局域粒子守恒原理以及通量和源的定义出发，使用量纲分析确定 $S_{n}$ 的量纲形式，并用基本量纲长度 $L$ 和时间 $T$ 表示。然后，在聚变等离子体的背景下，通过考虑固定控制体积 $V$（其边界为 $\\partial V$）上的积分形式来验证其一致性，并证明 $\\int_{V} S_{n}\\,\\mathrm{d}V$ 的量纲形式与粒子数的时间变化率加上净边界流出量相匹配。最后，讨论当典型的体积源项（源于电离）和体积汇项（源于复合）建模为 $S_{n} = n_{e} n_{n} \\langle \\sigma v \\rangle - n_{e} n_{i} \\alpha$ 时，是否与您的结果在量纲上一致。其中 $n_{e}$、$n_{n}$ 和 $n_{i}$ 是数密度，$\\langle \\sigma v \\rangle$ 是反应速率系数，$\\alpha$ 是复合系数。请仅使用基本量纲 $L$ 和 $T$ 来表示 $S_{n}$ 的最终量纲结果（最终表达式中不包含任何物理单位）。",
            "solution": "该问题已经过验证，被认为是有效的，因为它科学地基于粒子守恒原理，问题设定良好、客观且内部一致。因此，我们可以进行完整解答。\n\n该问题要求完成三项任务：首先，根据粒子连续性方程确定源项 $S_{n}$ 的量纲形式；其次，使用该方程的积分形式验证此结果；第三，检查其与聚变等离子体中典型的源和汇模型的量纲一致性。我们将依次解决这些问题。\n\n粒子连续性方程如下：\n$$\n\\frac{\\partial n}{\\partial t} + \\nabla \\cdot \\Gamma = S_{n}\n$$\n其中 $n$ 是数密度，$\\Gamma$ 是粒子通量密度，$S_{n}$ 是单位体积的粒子源率。\n\n根据量纲齐次性原理，一个物理方程中所有相加的项必须具有相同的物理量纲。我们将确定方程左侧各项的量纲，以推导出 $S_{n}$ 的量纲。令 $[X]$ 表示量 $X$ 的量纲。基本量纲是长度 $L$ 和时间 $T$。\n\n数密度 $n$ 的单位是 $\\mathrm{m^{-3}}$（单位体积内的粒子数）。因此其量纲为：\n$$\n[n] = L^{-3}\n$$\n第一项 $\\frac{\\partial n}{\\partial t}$ 表示数密度的时间变化率。其量纲为：\n$$\n\\left[\\frac{\\partial n}{\\partial t}\\right] = \\frac{[n]}{[t]} = \\frac{L^{-3}}{T} = L^{-3} T^{-1}\n$$\n\n粒子通量密度 $\\Gamma$ 的单位是 $\\mathrm{m^{-2}\\,s^{-1}}$（单位面积单位时间内的粒子数）。其量纲为：\n$$\n[\\Gamma] = L^{-2} T^{-1}\n$$\n散度算子 $\\nabla \\cdot$ 涉及空间导数，所以其量纲是长度的倒数：\n$$\n[\\nabla] = L^{-1}\n$$\n因此，通量的散度 $\\nabla \\cdot \\Gamma$ 的量纲为：\n$$\n[\\nabla \\cdot \\Gamma] = [\\nabla] [\\Gamma] = (L^{-1}) (L^{-2} T^{-1}) = L^{-3} T^{-1}\n$$\n\n由于连续性方程左侧的两项量纲均为 $L^{-3} T^{-1}$，为保证齐次性，源项 $S_{n}$ 必须具有相同的量纲：\n$$\n[S_{n}] = \\left[\\frac{\\partial n}{\\partial t}\\right] = [\\nabla \\cdot \\Gamma] = L^{-3} T^{-1}\n$$\n这个量纲形式对应于单位体积单位时间内的粒子数，这正是一个体积源率的物理意义。\n\n接下来，我们使用守恒律的积分形式来验证这种一致性。我们将连续性方程在一个固定的控制体积 $V$（其边界为 $\\partial V$）上积分：\n$$\n\\int_{V} \\left( \\frac{\\partial n}{\\partial t} + \\nabla \\cdot \\Gamma \\right) \\,\\mathrm{d}V = \\int_{V} S_{n}\\,\\mathrm{d}V\n$$\n利用积分的线性性质，并对通量项应用高斯散度定理，我们得到：\n$$\n\\int_{V} \\frac{\\partial n}{\\partial t} \\,\\mathrm{d}V + \\oint_{\\partial V} \\Gamma \\cdot \\mathrm{d}\\mathbf{A} = \\int_{V} S_{n}\\,\\mathrm{d}V\n$$\n由于控制体积 $V$ 是固定的，时间导数可以移到积分符号之外：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V} n \\,\\mathrm{d}V + \\oint_{\\partial V} \\Gamma \\cdot \\mathrm{d}\\mathbf{A} = \\int_{V} S_{n}\\,\\mathrm{d}V\n$$\n项 $\\int_{V} n \\,\\mathrm{d}V$ 表示体积 $V$ 内的总粒子数，这是一个无量纲的量（纯数）。它的时间导数 $\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V} n \\,\\mathrm{d}V$ 是总粒子数的时间变化率，其量纲为 $T^{-1}$。项 $\\oint_{\\partial V} \\Gamma \\cdot \\mathrm{d}\\mathbf{A}$ 是穿过边界的净粒子流出率，其量纲为 $[\\Gamma] \\times [\\text{Area}] = (L^{-2} T^{-1})(L^{2}) = T^{-1}$。\n因此，积分方程的左侧量纲为 $T^{-1}$。右侧代表体积内粒子的总生成率，也必须具有此量纲。使用我们推导出的 $S_{n}$ 的量纲：\n$$\n\\left[ \\int_{V} S_{n}\\,\\mathrm{d}V \\right] = [S_{n}] [\\mathrm{d}V] = (L^{-3} T^{-1}) (L^{3}) = T^{-1}\n$$\n量纲匹配，这证实了我们推导出的量纲形式 $[S_{n}] = L^{-3} T^{-1}$ 与积分守恒律的物理解释是一致的。\n\n最后，我们讨论给定源/汇模型的量纲一致性：\n$$\nS_{n} = n_{e} n_{n} \\langle \\sigma v \\rangle - n_{e} n_{i} \\alpha\n$$\n该表达式是一个电离源项和一个复合汇项之和。为使方程有效，两项都必须具有 $S_{n}$ 的量纲，即 $L^{-3} T^{-1}$。\n\n我们来分析电离项 $n_{e} n_{n} \\langle \\sigma v \\rangle$。量 $n_{e}$（电子密度）和 $n_{n}$（中性粒子密度）是数密度，所以 $[n_{e}] = [n_{n}] = L^{-3}$。项 $\\langle \\sigma v \\rangle$ 是反应速率系数。它是反应截面 $\\sigma$ 和相对速度 $v$ 的乘积在速度分布上的平均值。截面（一个有效面积）的量纲是 $[\\sigma] = L^{2}$，速度的量纲是 $[v] = L T^{-1}$。平均过程不改变量纲。因此：\n$$\n[\\langle \\sigma v \\rangle] = [\\sigma][v] = (L^{2})(L T^{-1}) = L^{3} T^{-1}\n$$\n于是电离项的量纲为：\n$$\n[n_{e} n_{n} \\langle \\sigma v \\rangle] = [n_{e}] [n_{n}] [\\langle \\sigma v \\rangle] = (L^{-3}) (L^{-3}) (L^{3} T^{-1}) = L^{-3} T^{-1}\n$$\n这与 $S_{n}$ 所要求的量纲相匹配。\n\n现在，我们来分析复合项 $n_{e} n_{i} \\alpha$。量 $n_{e}$ 和 $n_{i}$（离子密度）是数密度，$[n_{e}] = [n_{i}] = L^{-3}$。为使该项在量纲上一致，它也必须具有量纲 $L^{-3} T^{-1}$。这使我们能够确定复合系数 $\\alpha$ 的量纲：\n$$\n[n_{e} n_{i} \\alpha] = L^{-3} T^{-1}\n$$\n$$\n(L^{-3})(L^{-3})[\\alpha] = L^{-3} T^{-1}\n$$\n$$\nL^{-6} [\\alpha] = L^{-3} T^{-1}\n$$\n解出 $[\\alpha]$：\n$$\n[\\alpha] = \\frac{L^{-3} T^{-1}}{L^{-6}} = L^{-3 - (-6)} T^{-1} = L^{3} T^{-1}\n$$\n因此，复合系数 $\\alpha$ 的量纲必须是体积除以时间。这对于一个双体复合系数来说是标准的、物理上正确的量纲，类似于电离速率系数 $\\langle \\sigma v \\rangle$。\n\n模型 $S_{n} = n_{e} n_{n} \\langle \\sigma v \\rangle - n_{e} n_{i} \\alpha$ 中的两项都与连续性方程在量纲上一致。题目要求的最终结果是 $S_{n}$ 的量纲形式。根据分析的第一部分，这个结果是 $L^{-3} T^{-1}$。",
            "answer": "$$\\boxed{L^{-3} T^{-1}}$$"
        },
        {
            "introduction": "输运方程是连续的，但计算模拟却在离散的网格上进行。本练习旨在解决一个关键步骤：如何将一个连续的物理源（例如来自中性束注入的源）转化为有限体积模拟中对应的离散形式。你将推导在环形几何中一个特定分布的单元平均源，这是任何计算等离子体物理学家都需掌握的核心技能 。",
            "id": "4045945",
            "problem": "考虑托卡马克中典型的轴对称、大环径比环形等离子体中的粒子数守恒，该问题被建模为一个一维径向输运问题，描述粒子密度 $n(r,t)$，其中径向坐标 $r \\in [0,a]$，大半径 $R_0$ 为常数。基本平衡定律是局域粒子连续性方程 $\\,\\partial n/\\partial t + \\nabla \\cdot \\boldsymbol{\\Gamma} = S_n\\,$，其中 $\\boldsymbol{\\Gamma}$ 是粒子通量密度，$S_n$ 是体源密度。\n\n使用有限体积法（FVM），考虑一个由位于 $r = r_{i-1/2}$ 和 $r = r_{i+1/2}$ 的磁通量面所界定的环形控制体积，其中 $0 \\le r_{i-1/2}  r_{i+1/2} \\le a$。假设轴对称性和大环径比近似，从而微分体积元和径向面面积由环形几何确定。从上述基本连续性方程出发，推导网格平均密度的守恒型半离散平衡方程，该方程关联了网格中总粒子数的时间变化率、跨越两个径向面的净通量以及在网格上积分的体源。\n\n然后，设连续源分布为 $S_n(r) = S_0 \\exp\\!\\big(-r^2/\\ell^2\\big)$，其中常数 $S_0  0$ 和 $\\ell  0$，并计算相应的网格平均源 $S_{n,i}$，作为 $S_n(r)$ 在该环形区域上的适当体积平均。使用大环径比环形几何，其中环向线元取为 $2\\pi R_0$，极向周长取为 $2\\pi r$，因此微分体积为 $\\,\\mathrm{d}V = 4\\pi^2 R_0\\, r\\, \\mathrm{d}r\\,$。\n\n请以仅含 $S_0$、$\\ell$、$r_{i-1/2}$ 和 $r_{i+1/2}$ 的单个闭式解析表达式的形式给出您的最终结果。以国际单位制（SI）中的 $\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$ 表示其值。最终的方框答案中不要包含单位，也不要包含等号。如果简化为纯数值，请四舍五入到四位有效数字。",
            "solution": "该问题已经过验证，被认为是有效的。它在科学上基于输运现象的原理，特别是等离子体物理中的粒子守恒。该问题是适定的，为得到唯一解提供了所有必要信息。语言是客观的，其设置是计算聚变科学中使用的标准（尽管是简化的）表示。\n\n根据问题陈述的要求，求解过程分为两部分。首先，使用有限体积法（FVM）推导守恒型半离散平衡方程。其次，针对给定的源分布计算特定的网格平均源项。\n\n**第 1 部分：推导半离散平衡方程**\n\n出发点是局域粒子连续性方程，它表示粒子数密度 $n(r,t)$ 的守恒：\n$$\n\\frac{\\partial n}{\\partial t} + \\nabla \\cdot \\boldsymbol{\\Gamma} = S_n\n$$\n此处，$\\boldsymbol{\\Gamma}$ 是粒子通量密度，$S_n$ 是体积粒子源密度。\n\n对于有限体积法，我们在一个控制体积 $V_i$ 上对该方程进行积分。在这种轴对称环形几何中，控制体积是一个由半径 $r=r_{i-1/2}$ 和 $r=r_{i+1/2}$ 处的磁通量面界定的环形区域（环形壳层）。\n$$\n\\int_{V_i} \\frac{\\partial n}{\\partial t} \\, \\mathrm{d}V + \\int_{V_i} \\nabla \\cdot \\boldsymbol{\\Gamma} \\, \\mathrm{d}V = \\int_{V_i} S_n \\, \\mathrm{d}V\n$$\n我们来逐项分析。\n\n第一项表示控制体积 $V_i$ 内总粒子数 $N_i$ 的时间变化率。假设控制体积不随时间变化，我们可以交换积分和微分的顺序：\n$$\n\\int_{V_i} \\frac{\\partial n}{\\partial t} \\, \\mathrm{d}V = \\frac{d}{dt} \\int_{V_i} n \\, \\mathrm{d}V = \\frac{d N_i}{dt}\n$$\n总粒子数 $N_i$ 与网格平均密度 $n_i$ 通过 $N_i = n_i V_i$ 相关联。\n\n第二项使用散度定理（高斯定理）转换为在控制体积边界 $\\partial V_i$ 上的面积分：\n$$\n\\int_{V_i} \\nabla \\cdot \\boldsymbol{\\Gamma} \\, \\mathrm{d}V = \\oint_{\\partial V_i} \\boldsymbol{\\Gamma} \\cdot d\\mathbf{A}\n$$\n在这个一维径向模型中，粒子通量是纯径向的，$\\boldsymbol{\\Gamma} = \\Gamma_r(r) \\hat{\\mathbf{r}}$。边界 $\\partial V_i$ 由位于 $r_{i-1/2}$（内侧）和 $r_{i+1/2}$（外侧）的两个环形面组成。内侧表面上的外法向矢量为 $-\\hat{\\mathbf{r}}$，外侧表面上的为 $+\\hat{\\mathbf{r}}$。在大环径比近似下，小半径为 $r$、大半径为 $R_0$ 的环面的表面积为 $A(r) = (2\\pi r)(2\\pi R_0) = 4\\pi^2 R_0 r$。因此，面积分变为流出网格的净通量：\n$$\n\\oint_{\\partial V_i} \\boldsymbol{\\Gamma} \\cdot d\\mathbf{A} = (\\Gamma_r A(r))|_{r=r_{i+1/2}} - (\\Gamma_r A(r))|_{r=r_{i-1/2}} = A_{i+1/2}\\Gamma_{r, i+1/2} - A_{i-1/2}\\Gamma_{r, i-1/2}\n$$\n其中 $A_{i\\pm1/2} = A(r_{i\\pm1/2})$ 且 $\\Gamma_{r, i\\pm1/2} = \\Gamma_r(r_{i\\pm1/2})$。\n\n第三项是单位时间内在网格体积内产生的总粒子数，我们可以将其表示为 $\\mathcal{S}_i$：\n$$\n\\mathcal{S}_i = \\int_{V_i} S_n \\, \\mathrm{d}V\n$$\n这可以用网格平均源 $S_{n,i}$ 表示为 $\\mathcal{S}_i = S_{n,i} V_i$。\n\n综合这些项，得到网格 $i$ 中总粒子数的守恒型半离散平衡方程：\n$$\n\\frac{d N_i}{dt} + \\left( A_{i+1/2}\\Gamma_{r, i+1/2} - A_{i-1/2}\\Gamma_{r, i-1/2} \\right) = \\mathcal{S}_i\n$$\n该方程精确地关联了网格中总粒子数的时间变化率 ($d N_i/dt$)、跨越两个径向面的净通量（括号中的项）以及在网格上积分的体源 ($\\mathcal{S}_i$)。\n\n**第 2 部分：计算网格平均源**\n\n网格平均源 $S_{n,i}$ 定义为连续源分布 $S_n(r)$ 在网格体积 $V_i$ 上的体积平均：\n$$\nS_{n,i} = \\frac{\\int_{V_i} S_n(r) \\, \\mathrm{d}V}{\\int_{V_i} \\, \\mathrm{d}V} = \\frac{\\mathcal{S}_i}{V_i}\n$$\n给定的微分体积元为 $\\mathrm{d}V = 4\\pi^2 R_0 r \\, \\mathrm{d}r$。\n\n首先，我们计算网格的体积 $V_i$：\n$$\nV_i = \\int_{r_{i-1/2}}^{r_{i+1/2}} 4\\pi^2 R_0 r \\, \\mathrm{d}r = 4\\pi^2 R_0 \\left[ \\frac{r^2}{2} \\right]_{r_{i-1/2}}^{r_{i+1/2}} = 2\\pi^2 R_0 (r_{i+1/2}^2 - r_{i-1/2}^2)\n$$\n接下来，我们使用给定的源分布 $S_n(r) = S_0 \\exp(-r^2/\\ell^2)$ 计算积分源 $\\mathcal{S}_i$：\n$$\n\\mathcal{S}_i = \\int_{r_{i-1/2}}^{r_{i+1/2}} S_0 \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) (4\\pi^2 R_0 r \\, \\mathrm{d}r) = 4\\pi^2 R_0 S_0 \\int_{r_{i-1/2}}^{r_{i+1/2}} r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r\n$$\n为了求解这个积分，我们使用换元法，令 $u = -r^2/\\ell^2$。其微分为 $du = -2r/\\ell^2 \\, \\mathrm{d}r$，这意味着 $r \\, \\mathrm{d}r = -\\frac{\\ell^2}{2} \\, du$。积分变为：\n$$\n\\int r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r = \\int \\exp(u) \\left(-\\frac{\\ell^2}{2} \\, du\\right) = -\\frac{\\ell^2}{2} \\exp(u) = -\\frac{\\ell^2}{2} \\exp\\left(-\\frac{r^2}{\\ell^2}\\right)\n$$\n计算从 $r_{i-1/2}$ 到 $r_{i+1/2}$ 的定积分：\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r = \\left[ -\\frac{\\ell^2}{2} \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\right]_{r_{i-1/2}}^{r_{i+1/2}}\n= -\\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) \\right]\n$$\n$$\n= \\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]\n$$\n将此结果代回 $\\mathcal{S}_i$ 的表达式：\n$$\n\\mathcal{S}_i = 4\\pi^2 R_0 S_0 \\left( \\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right] \\right)\n$$\n$$\n\\mathcal{S}_i = 2\\pi^2 R_0 S_0 \\ell^2 \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]\n$$\n最后，我们将 $\\mathcal{S}_i$ 除以 $V_i$ 来计算网格平均源 $S_{n,i}$：\n$$\nS_{n,i} = \\frac{2\\pi^2 R_0 S_0 \\ell^2 \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]}{2\\pi^2 R_0 (r_{i+1/2}^2 - r_{i-1/2}^2)}\n$$\n公共因子 $2\\pi^2 R_0$ 被消去，得到网格平均源的最终表达式：\n$$\nS_{n,i} = S_0 \\ell^2 \\frac{\\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right)}{r_{i+1/2}^2 - r_{i-1/2}^2}\n$$\n这是用给定参数表示的 $S_{n,i}$ 的闭式解析表达式。单位是一致的，因为 $(m^{-3}s^{-1}) \\cdot m^2 / m^2 = m^{-3}s^{-1}$。",
            "answer": "$$\\boxed{S_0 \\ell^2 \\frac{\\exp\\left(-\\frac{r_{i-1/2}^{2}}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^{2}}{\\ell^2}\\right)}{r_{i+1/2}^{2} - r_{i-1/2}^{2}}}$$"
        },
        {
            "introduction": "编写代码只是完成了一半的工作；我们如何才能确定代码是正确的？这最后一个练习将介绍“人造解方法”（Method of Manufactured Solutions），这是一种用于软件验证的严谨技术。通过设计一个具有已知解析解的问题，我们可以精确地量化数值实现的误差，并验证我们的代码是否准确地求解了包含源项和汇项的目标输运方程 。",
            "id": "4045995",
            "problem": "考虑在一维平板中，标量粒子密度 $n(x,t)$ 沿坐标 $x \\in [0,L]$ 在一个周期性域中的输运问题，该问题代表了计算聚变科学与工程中的一个磁通管段。其基本依据是包含扩散通量以及线性的源和汇的连续性方程：\n$$\\frac{\\partial n}{\\partial t} + \\frac{\\partial \\Gamma}{\\partial x} = S(x) - \\sigma n(x,t),$$ \n其中扩散通量由 Fick 定律给出 $\\Gamma(x,t) = -D \\frac{\\partial n}{\\partial x}$，标量扩散系数 $D0$ 是均匀的，$S(x)$ 是一个外部施加的源密度分布，而 $\\sigma \\ge 0$ 是一个均匀的线性汇率。在稳态下，控制方程简化为二阶常微分方程\n$$D \\frac{d^2 n}{dx^2} - \\sigma n + S(x) = 0,$$ \n并服从周期性边界条件 $n(0) = n(L)$ 和 $\\frac{dn}{dx}(0) = \\frac{dn}{dx}(L)$。\n\n您必须设计并实现一个验证测试，该测试使用已知的解析源分布来产生一个可预测的稳态密度分布，然后用它来验证一个输运代码的源项实现。使用解析源\n$$S(x) = s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x),$$ \n其中 $\\kappa_m = \\frac{2\\pi k_m}{L}$ 且整数 $k_m \\in \\mathbb{Z}^+$，以确保周期性。该验证方法应基于第一性原理：在不使用简化公式的情况下，从基本依据推导出预期的稳态 $n(x)$，并独立地对相同的源，使用带有周期性边界条件的二阶中心有限差分离散化方法，在一个包含 $N$ 个等距点的网格上数值求解稳态方程。计算数值解与解析预测之间的相对 $\\ell_2$ 误差，以量化源项实现的正确性：\n$$\\varepsilon = \\frac{\\left\\| n_{\\mathrm{num}} - n_{\\mathrm{ana}} \\right\\|_2}{\\left\\| n_{\\mathrm{ana}} \\right\\|_2}.$$\n\n实现要求：\n- 将区间 $[0,L]$ 离散化为 $N$ 个等距点 $x_j = j h$，其中 $h = L/N$ 且 $j \\in \\{0,1,\\dots,N-1\\}$。\n- 使用周期性二阶中心差分拉普拉斯算子 $\\mathcal{L}_h n_j = \\frac{n_{j+1} - 2 n_j + n_{j-1}}{h^2}$（使用周期性索引）来构建稳态离散方程 $D \\mathcal{L}_h n_j - \\sigma n_j + S_j = 0$。\n- 使用适合周期性问题的方法，精确且稳定地求解离散稳态问题以得到 $n_{\\mathrm{num}}$。\n- 根据第一性原理推导，在同一网格上独立地构建 $n_{\\mathrm{ana}}$。\n- 将相对 $\\ell_2$ 误差 $\\varepsilon$ 计算为一个无量纲浮点数。输出中不需要物理单位。\n\n测试套件：\n使用以下参数集，这些参数集用于测试一般情况、粗网格行为、高扩散、高汇项以及近奈奎斯特内容。对于每种情况，按规定定义 $(L,D,\\sigma,N,k_1,k_2,s_1,s_2)$：\n- 案例 1 (一般“顺利”情况): $L = 2\\pi$, $D = 0.3$, $\\sigma = 0.7$, $N = 256$, $k_1 = 3$, $k_2 = 5$, $s_1 = 1.0$, $s_2 = 0.5$。\n- 案例 2 (粗网格边界覆盖): $L = 2\\pi$, $D = 0.3$, $\\sigma = 0.7$, $N = 16$, $k_1 = 3$, $k_2 = 5$, $s_1 = 1.0$, $s_2 = 0.5$。\n- 案例 3 (重要边缘案例：高扩散): $L = 2\\pi$, $D = 5.0$, $\\sigma = 0.1$, $N = 128$, $k_1 = 1$, $k_2 = 2$, $s_1 = 2.0$, $s_2 = 1.0$。\n- 案例 4 (重要边缘案例：高汇项): $L = 2\\pi$, $D = 0.01$, $\\sigma = 10.0$, $N = 128$, $k_1 = 4$, $k_2 = 7$, $s_1 = 1.0$, $s_2 = 2.0$。\n- 案例 5 (无混叠的近奈奎斯特内容): $L = 2\\pi$, $D = 0.2$, $\\sigma = 0.5$, $N = 64$, $k_1 = 8$, $k_2 = 16$, $s_1 = 1.5$, $s_2 = 0.75$。\n\n最终输出规范：\n您的程序应生成单行输出，其中包含五个案例的相对 $\\ell_2$ 误差，形式为方括号内以逗号分隔的浮点数列表，案例按 1 到 5 的顺序排列，例如 $[e_1,e_2,e_3,e_4,e_5]$。",
            "solution": "该问题陈述已经过验证，并被认为是合理的。它具有科学依据，是适定的，并为计算输运建模中的验证测试提供了一套完整且一致的规范。所有测试案例都定义了 $\\sigma  0$，确保相应的连续和离散问题都有唯一解。\n\n根据要求，求解过程分三个阶段进行：首先，推导连续问题的精确解析解；其次，构建离散化问题的数值解；第三，计算两者之间的相对误差以验证实现。\n\n**1. 解析解的推导**\n\n控制方程是稳态一维反应扩散方程：\n$$D \\frac{d^2 n}{dx^2} - \\sigma n + S(x) = 0$$\n这是一个线性、二阶、常系数常微分方程，其中 $D  0$ 且 $\\sigma  0$。定义域为 $x \\in [0, L]$，带有周期性边界条件。源项指定为：\n$$S(x) = s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x)$$\n其中 $\\kappa_m = \\frac{2\\pi k_m}{L}$， $k_m$ 为正整数。这种形式确保 $S(x)$ 在区间 $[0, L]$ 上满足周期性边界条件。\n\n由于微分算子 $\\mathcal{L} \\equiv D \\frac{d^2}{dx^2} - \\sigma$ 的线性性，我们可以应用叠加原理。我们通过独立考虑源项的正弦和余弦分量的贡献来寻找一个特解 $n_p(x)$。函数 $\\sin(\\kappa x)$ 和 $\\cos(\\kappa x)$ 是二阶导数算子 $\\frac{d^2}{dx^2}$ 的特征函数。因此，我们提出一个与源项函数形式相同的解的拟设：\n$$n_{\\mathrm{ana}}(x) = C_1 \\sin(\\kappa_1 x) + C_2 \\cos(\\kappa_2 x)$$\n我们将此拟设代入控制方程。首先，我们计算 $n_{\\mathrm{ana}}(x)$ 的二阶导数：\n$$\\frac{d^2 n_{\\mathrm{ana}}}{dx^2} = -C_1 \\kappa_1^2 \\sin(\\kappa_1 x) - C_2 \\kappa_2^2 \\cos(\\kappa_2 x)$$\n将 $n_{\\mathrm{ana}}$ 及其二阶导数代入常微分方程得到：\n$$D \\left( -C_1 \\kappa_1^2 \\sin(\\kappa_1 x) - C_2 \\kappa_2^2 \\cos(\\kappa_2 x) \\right) - \\sigma \\left( C_1 \\sin(\\kappa_1 x) + C_2 \\cos(\\kappa_2 x) \\right) + \\left( s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x) \\right) = 0$$\n对每个三角函数合并同类项：\n$$\\left( -D C_1 \\kappa_1^2 - \\sigma C_1 + s_1 \\right) \\sin(\\kappa_1 x) + \\left( -D C_2 \\kappa_2^2 - \\sigma C_2 + s_2 \\right) \\cos(\\kappa_2 x) = 0$$\n为使此方程对所有 $x \\in [0, L]$ 成立，基函数 $\\sin(\\kappa_1 x)$ 和 $\\cos(\\kappa_2 x)$ 的系数必须独立为零（假设 $k_1 \\ne k_2$；如果 $k_1 = k_2$，通过合并项，逻辑仍然成立）。\n$$-C_1 (D \\kappa_1^2 + \\sigma) + s_1 = 0 \\implies C_1 = \\frac{s_1}{D \\kappa_1^2 + \\sigma}$$\n$$-C_2 (D \\kappa_2^2 + \\sigma) + s_2 = 0 \\implies C_2 = \\frac{s_2}{D \\kappa_2^2 + \\sigma}$$\n给定 $D0$，$\\sigma0$ 和实数 $\\kappa_m$，分母 $(D \\kappa_m^2 + \\sigma)$ 严格为正。因此，这些系数是良定义的。最终的解析解为：\n$$n_{\\mathrm{ana}}(x) = \\frac{s_1}{D \\kappa_1^2 + \\sigma} \\sin(\\kappa_1 x) + \\frac{s_2}{D \\kappa_2^2 + \\sigma} \\cos(\\kappa_2 x)$$\n根据其构造，此解是周期性的，并且是给定条件下的唯一稳态解。\n\n**2. 数值解的构建**\n\n该问题在一个包含 $N$ 个点的均匀网格 $x_j = j h$ 上进行离散化，其中 $j \\in \\{0, 1, \\dots, N-1\\}$，网格间距 $h = L/N$。稳态方程使用拉普拉斯算子的二阶中心差分进行离散化，得到一个代数方程组：\n$$D \\left( \\frac{n_{j+1} - 2n_j + n_{j-1}}{h^2} \\right) - \\sigma n_j + S_j = 0$$\n其中 $n_j = n(x_j)$ 且 $S_j = S(x_j)$。索引按周期性处理，即 $n_{N} \\equiv n_0$ 和 $n_{-1} \\equiv n_{N-1}$。这组 $N$ 个线性方程可以写成矩阵形式 $A \\mathbf{n}_{\\mathrm{num}} = -\\mathbf{S}$。由于周期性边界条件，代表离散算子 $D \\mathcal{L}_h - \\sigma I$ 的矩阵 $A$ 是一个循环矩阵。\n\n求解涉及循环矩阵的线性系统最有效和最稳定的方法是离散傅里叶变换 (DFT)。DFT 可以对角化任何循环矩阵。将 DFT（表示为 $\\mathcal{F}$）应用于离散方程，将有限差分模板所代表的卷积转换为傅里叶空间中的简单乘法。设 $\\hat{n}_q = \\mathcal{F}\\{n_j\\}$ 和 $\\hat{S}_q = \\mathcal{F}\\{S_j\\}$ 分别是密度和源的 DFT，其中 $q$ 是离散模数索引。\n\n离散拉普拉斯算子作用于 $n_j$ 的 DFT 由其与特征值 $\\lambda_q$ 的乘积给出：\n$$\\mathcal{F}\\{\\mathcal{L}_h n_j\\} = \\lambda_q \\hat{n}_q = \\frac{2}{h^2} \\left( \\cos\\left(\\frac{2\\pi q}{N}\\right) - 1 \\right) \\hat{n}_q, \\quad q \\in \\{0, 1, \\dots, N-1\\}$$\n傅里叶空间中的完整方程成为关于每个模式 $\\hat{n}_q$ 的代数方程：\n$$\\left( D \\lambda_q - \\sigma \\right) \\hat{n}_q + \\hat{S}_q = 0$$\n求解 $\\hat{n}_q$：\n$$\\hat{n}_q = \\frac{-\\hat{S}_q}{D \\lambda_q - \\sigma} = \\frac{-\\hat{S}_q}{D \\frac{2}{h^2} \\left( \\cos\\left(\\frac{2\\pi q}{N}\\right) - 1 \\right) - \\sigma}$$\n对于 $\\sigma0$，分母始终非零，因此 $\\hat{\\mathbf{n}}$ 存在唯一解。然后，通过对傅里叶系数向量 $\\hat{\\mathbf{n}}$ 应用逆离散傅里叶变换 ($\\mathcal{F}^{-1}$)，可以恢复实空间中的数值解 $\\mathbf{n}_{\\mathrm{num}}$：\n$$n_{\\mathrm{num}, j} = \\mathcal{F}^{-1}\\{\\hat{n}_q\\}$$\n\n**3. 误差量化**\n\n为验证数值实现的正确性，我们将数值解 $n_{\\mathrm{num}}$ 与在相同网格上求值的解析解 $n_{\\mathrm{ana}}$ 进行比较。偏差使用相对 $\\ell_2$ 误差 $\\varepsilon$ 进行量化：\n$$\\varepsilon = \\frac{\\left\\| \\mathbf{n}_{\\mathrm{num}} - \\mathbf{n}_{\\mathrm{ana}} \\right\\|_2}{\\left\\| \\mathbf{n}_{\\mathrm{ana}} \\right\\|_2}$$\n其中，长度为 $N$ 的向量 $\\mathbf{v}$ 的离散 $\\ell_2$ 范数定义为 $\\left\\| \\mathbf{v} \\right\\|_2 = \\sqrt{\\sum_{j=0}^{N-1} v_j^2}$。此误差主要归因于有限差分近似的截断误差，其阶数为 $\\mathcal{O}(h^2)$。一个小的 $\\varepsilon$ 值证实了数值求解器正确地实现了连续模型所描述的物理过程。该实现将为每个提供的测试案例计算此误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady-state diffusion-reaction equation for a series of test cases,\n    compares the numerical solution to the analytic solution, and computes the relative l2 error.\n    \"\"\"\n    # (L, D, sigma, N, k1, k2, s1, s2)\n    test_cases = [\n        # Case 1 (general \"happy path\"):\n        (2 * np.pi, 0.3, 0.7, 256, 3, 5, 1.0, 0.5),\n        # Case 2 (coarse grid boundary coverage):\n        (2 * np.pi, 0.3, 0.7, 16, 3, 5, 1.0, 0.5),\n        # Case 3 (significant edge case: high diffusion):\n        (2 * np.pi, 5.0, 0.1, 128, 1, 2, 2.0, 1.0),\n        # Case 4 (significant edge case: high sink):\n        (2 * np.pi, 0.01, 10.0, 128, 4, 7, 1.0, 2.0),\n        # Case 5 (near-Nyquist content without aliasing):\n        (2 * np.pi, 0.2, 0.5, 64, 8, 16, 1.5, 0.75),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, D, sigma, N, k1, k2, s1, s2 = case\n        \n        # 1. Grid and Parameter Setup\n        h = L / N\n        x = np.arange(N) * h\n        kappa1 = 2 * np.pi * k1 / L\n        kappa2 = 2 * np.pi * k2 / L\n        \n        # 2. Analytic Solution Construction\n        # n_ana(x) = c1*sin(k1*x) + c2*cos(k2*x), where coefficients c1 and c2 are\n        # derived from the ODE: c_m = s_m / (D*kappa_m^2 + sigma).\n        c1 = s1 / (D * kappa1**2 + sigma)\n        c2 = s2 / (D * kappa2**2 + sigma)\n        n_ana = c1 * np.sin(kappa1 * x) + c2 * np.cos(kappa2 * x)\n        \n        # 3. Numerical Solution via FFT\n        # The equation D*n'' - sigma*n = -S is solved in Fourier space.\n        \n        # Evaluate source term on the grid\n        S = s1 * np.sin(kappa1 * x) + s2 * np.cos(kappa2 * x)\n        \n        # Fourier transform the source\n        S_hat = fft.fft(S)\n        \n        # Define eigenvalues of the discrete Laplacian operator in Fourier space.\n        # q represents the discrete mode number from 0 to N-1.\n        q = np.arange(N)\n        # Eigenvalues of second-order central difference periodic Laplacian:\n        # lambda_q = (2/h^2)*(cos(2*pi*q/N) - 1)\n        discrete_laplacian_eigvals = (2 / h**2) * (np.cos(2 * np.pi * q / N) - 1)\n        \n        # Solve for n_hat in Fourier space: (D*lambda_q - sigma)*n_hat = -S_hat\n        # The denominator is guaranteed non-zero since D0 and sigma0.\n        denominator = D * discrete_laplacian_eigvals - sigma\n        n_hat = -S_hat / denominator\n        \n        # Inverse Fourier transform to get the solution in real space.\n        # The result should be real; the small imaginary part is numerical noise.\n        n_num = np.real(fft.ifft(n_hat))\n        \n        # 4. Error Calculation\n        # Compute the relative l2 error between numerical and analytic solutions.\n        error_norm = np.linalg.norm(n_num - n_ana)\n        ana_norm = np.linalg.norm(n_ana)\n        \n        # Avoid division by zero if the analytic solution is identically zero.\n        # This is not expected for the given test cases but is good practice.\n        if ana_norm == 0.0:\n            relative_error = 0.0 if error_norm == 0.0 else np.inf\n        else:\n            relative_error = error_norm / ana_norm\n            \n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}