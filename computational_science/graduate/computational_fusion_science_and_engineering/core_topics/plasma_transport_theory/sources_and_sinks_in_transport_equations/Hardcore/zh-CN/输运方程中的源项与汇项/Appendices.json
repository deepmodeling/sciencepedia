{
    "hands_on_practices": [
        {
            "introduction": "在许多物理场景中，例如中性束注入或射频加热，能量和粒子源都高度集中在空间中的特定区域。本练习介绍狄拉克 $\\delta$ 函数，这是一个用于模拟此类局部源的强大数学工具。通过本练习，你将推导出一个点源如何在稳态输运方程中引起通量的不连续性，这对于理解局部现象如何在连续模型中产生尖锐特征至关重要 。",
            "id": "4045944",
            "problem": "考虑在磁约束聚变等离子体中，无源标量密度 $n(x)$ 沿直线磁通管段的一维稳态输运。横截面积恒定，通量方向取为 $+x$ 方向。输运过程由稳态粒子数守恒和具有恒定系数的线性扩散-对流本构关系决定。假设：\n- 守恒定律的形式为 $\\frac{d}{dx}\\,\\Gamma(x) = S(x)$，其中 $\\Gamma(x)$ 是粒子通量，$S(x)$ 是单位体积的体积源密度。\n- 本构关系为 $\\Gamma(x) = -D\\,\\frac{dn}{dx} + u\\,n(x)$，其中 $D0$ 是恒定的扩散系数，$u$ 是恒定的对流速度。\n- 局域源被建模为狄拉克δ分布 $S(x) = s_{0}\\,\\delta(x-x_{0})$，其中 $s_{0}$ 是表示净源强度的常数。\n\n利用局域守恒原理和狄拉克δ分布的性质，通过对稳态守恒定律在 $x_{0}$ 周围的无穷小控制体积上积分，推导粒子通量跨越点 $x_{0}$ 的跳跃条件，然后用此条件确定密度空间梯度的跳跃。定义函数 $f$ 跨越 $x_{0}$ 的跳跃为 $[f]_{x_{0}} \\equiv f(x_{0}^{+}) - f(x_{0}^{-})$，其中 $x_{0}^{\\pm}$ 分别表示从右侧和左侧趋近于 $x_{0}$ 的极限。假设 $n(x)$ 在 $x_{0}$ 处保持有限且连续。\n\n用参数 $s_{0}$ 和 $D$ 表示跳跃 $[\\frac{dn}{dx}]_{x_{0}}$ 的闭式解析表达式是什么？请以单一表达式的形式给出答案。不需要进行数值计算或四舍五入。最终表达式中不要包含单位。",
            "solution": "该问题陈述经评估为有效。它在科学上基于连续介质输运理论的原理，在数学上是适定的，并且陈述客观。所用的物理模型，即带有由狄拉克δ分布表示的局域源的一维对流-扩散方程，是物理学和工程学中一个标准且严谨的框架。推导所要求的跳跃条件所需的所有必要参数和条件均已提供。\n\n推导过程如下。\n\n无源标量密度 $n(x)$ 稳态输运的控制方程是守恒定律：\n$$\n\\frac{d}{dx}\\Gamma(x) = S(x)\n$$\n其中 $\\Gamma(x)$ 是粒子通量，$S(x)$ 是体积源项。源在 $x=x_{0}$ 处给定为一个局域点源，由狄拉克δ分布建模：\n$$\nS(x) = s_{0}\\,\\delta(x-x_{0})\n$$\n其中 $s_{0}$ 是源强度。\n\n为了推导通量 $\\Gamma(x)$ 在点 $x_{0}$ 处的跳跃条件，我们在某个小的 $\\epsilon  0$ 的无穷小区间 $[x_{0}-\\epsilon, x_{0}+\\epsilon]$ 上对守恒定律进行积分。\n$$\n\\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} \\frac{d}{dx}\\Gamma(x) \\,dx = \\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} S(x) \\,dx\n$$\n我们分别计算该方程的左侧（LHS）和右侧（RHS）。\n\n左侧积分可以使用微积分基本定理进行计算：\n$$\n\\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} \\frac{d\\Gamma}{dx} \\,dx = \\Gamma(x_{0}+\\epsilon) - \\Gamma(x_{0}-\\epsilon)\n$$\n当 $\\epsilon \\to 0^{+}$ 时取极限，该表达式成为 $\\Gamma(x)$ 在 $x_{0}$ 处的跳跃的定义：\n$$\n\\lim_{\\epsilon \\to 0^{+}} \\left[ \\Gamma(x_{0}+\\epsilon) - \\Gamma(x_{0}-\\epsilon) \\right] = \\Gamma(x_{0}^{+}) - \\Gamma(x_{0}^{-}) \\equiv [\\Gamma]_{x_{0}}\n$$\n\n右侧积分通过代入 $S(x)$ 的表达式来计算：\n$$\n\\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} S(x) \\,dx = \\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} s_{0}\\,\\delta(x-x_{0}) \\,dx\n$$\n利用狄拉克δ函数的筛选性质，即对于 $a  c  b$，有 $\\int_{a}^{b} f(x)\\delta(x-c)dx = f(c)$，其中 $f(x)=s_0$（一个常数），我们得到：\n$$\n\\int_{x_{0}-\\epsilon}^{x_{0}+\\epsilon} s_{0}\\,\\delta(x-x_{0}) \\,dx = s_{0}\n$$\n只要 $\\epsilon  0$，这个结果就与 $\\epsilon$ 无关。\n\n在 $\\epsilon \\to 0^{+}$ 的极限下，令左侧和右侧的结果相等，得到粒子通量的跳跃条件：\n$$\n[\\Gamma]_{x_{0}} = s_{0}\n$$\n这表明通量 $\\Gamma(x)$ 在点源位置处必须有一个大小为 $s_{0}$ 的不连续性。\n\n接下来，我们使用给定的本构关系，将此通量跳跃与密度 $n(x)$ 的性质联系起来：\n$$\n\\Gamma(x) = -D\\,\\frac{dn}{dx} + u\\,n(x)\n$$\n其中 $D$ 是恒定的扩散系数，$u$ 是恒定的对流速度。我们现在计算这个表达式在 $x_{0}$ 处的跳跃：\n$$\n[\\Gamma]_{x_{0}} = \\left( -D\\,\\frac{dn}{dx}\\bigg|_{x_{0}^{+}} + u\\,n(x_{0}^{+}) \\right) - \\left( -D\\,\\frac{dn}{dx}\\bigg|_{x_{0}^{-}} + u\\,n(x_{0}^{-}) \\right)\n$$\n根据所求跳跃的属性重新整理各项，我们得到：\n$$\n[\\Gamma]_{x_{0}} = -D \\left( \\frac{dn}{dx}\\bigg|_{x_{0}^{+}} - \\frac{dn}{dx}\\bigg|_{x_{0}^{-}} \\right) + u \\left( n(x_{0}^{+}) - n(x_{0}^{-}) \\right)\n$$\n使用跳跃符号 $[f]_{x_{0}} = f(x_{0}^{+}) - f(x_{0}^{-})$，这变为：\n$$\n[\\Gamma]_{x_{0}} = -D \\left[ \\frac{dn}{dx} \\right]_{x_{0}} + u [n]_{x_{0}}\n$$\n我们现在可以令我们得到的两个关于 $[\\Gamma]_{x_{0}}$ 的表达式相等：\n$$\n-D \\left[ \\frac{dn}{dx} \\right]_{x_{0}} + u [n]_{x_{0}} = s_{0}\n$$\n问题陈述提供了一个关键假设，即密度 $n(x)$ 在 $x=x_{0}$ 处是连续的。在数学上，这意味着 $n(x_{0}^{+}) = n(x_{0}^{-})$，这表明密度的跳跃为零：\n$$\n[n]_{x_{0}} = n(x_{0}^{+}) - n(x_{0}^{-}) = 0\n$$\n将此条件代入我们的方程，对流项消失：\n$$\n-D \\left[ \\frac{dn}{dx} \\right]_{x_{0}} + u(0) = s_{0}\n$$\n这可以简化为：\n$$\n-D \\left[ \\frac{dn}{dx} \\right]_{x_{0}} = s_{0}\n$$\n最后，我们求解所需量，即密度空间梯度的跳跃 $\\left[ \\frac{dn}{dx} \\right]_{x_{0}}$：\n$$\n\\left[ \\frac{dn}{dx} \\right]_{x_{0}} = -\\frac{s_{0}}{D}\n$$\n这个结果表明，虽然密度本身是连续的，但它的一阶导数（即梯度）在点源位置处是不连续的。这种不连续性是由通量的扩散部分引起的，并且与源强度 $s_{0}$ 成正比，与扩散系数 $D$ 成反比。",
            "answer": "$$\\boxed{-\\frac{s_{0}}{D}}$$"
        },
        {
            "introduction": "将连续的偏微分方程转化为数值算法，需要将源项在离散的网格单元上进行积分。本练习演示了在广泛使用的有限体积法 (FVM) 中，如何在真实的环形几何下完成这一过程。掌握如何计算单元平均源是开发或使用基于 FVM 的输运代码的一项关键实践技能 。",
            "id": "4045945",
            "problem": "考虑典型的托卡马克中的轴对称、大环径比环形等离子体中的粒子数守恒，该问题被建模为一个关于粒子密度 $n(r,t)$ 的一维径向输运问题，其中径向坐标为 $r \\in [0,a]$，大半径为常数 $R_0$。其基本平衡法则是局域粒子连续性方程 $\\,\\partial n/\\partial t + \\nabla \\cdot \\boldsymbol{\\Gamma} = S_n\\,$，其中 $\\boldsymbol{\\Gamma}$ 是粒子通量密度，$S_n$ 是体源密度。\n\n使用有限体积法 (FVM)，考虑一个由 $r = r_{i-1/2}$ 和 $r = r_{i+1/2}$ 处的磁通面为边界的环形控制体积，其中 $0 \\le r_{i-1/2}  r_{i+1/2} \\le a$。假设轴对称性和大环径比近似，因此体积微元和径向面面积由环形几何确定。从上述基本连续性方程出发，推导单元平均密度的守恒型半离散平衡关系，该关系关联了单元内总粒子数的时间变化率、跨越两个径向面的净通量以及在单元上积分的体源。\n\n然后，取连续源分布为 $S_n(r) = S_0 \\exp\\!\\big(-r^2/\\ell^2\\big)$，其中常数 $S_0  0$ 且 $\\ell  0$，并计算相应的单元平均源 $S_{n,i}$，作为 $S_n(r)$ 在环形区域上的适当体积平均。使用大环径比环形几何，其中环向线元取为 $2\\pi R_0$，极向周长取为 $2\\pi r$，因此体积微元为 $\\,\\mathrm{d}V = 4\\pi^2 R_0\\, r\\, \\mathrm{d}r\\,$。\n\n请仅用 $S_0$、$\\ell$、$r_{i-1/2}$ 和 $r_{i+1/2}$ 给出 $S_{n,i}$ 的单一闭式解析表达式作为最终结果。数值以国际单位制 (SI) 表示为 $\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$。最终的方框答案中不要包含单位，也不要包含等号。如果简化为纯数值，请四舍五入到四位有效数字。",
            "solution": "该问题已经过验证，被认为是有效的。它在科学上基于输运现象的原理，特别是等离子体物理中的粒子守恒。该问题是适定的，为得到唯一解提供了所有必要信息。其语言客观，设定是计算聚变科学中使用的标准（尽管简化了）表示方法。\n\n根据问题陈述的要求，解答分为两部分。首先，使用有限体积法 (FVM) 推导守恒型半离散平衡方程。其次，针对给定的源分布，计算特定的单元平均源项。\n\n**第 1 部分：半离散平衡方程的推导**\n\n出发点是局域粒子连续性方程，它表示了粒子数密度 $n(r,t)$ 的守恒：\n$$\n\\frac{\\partial n}{\\partial t} + \\nabla \\cdot \\boldsymbol{\\Gamma} = S_n\n$$\n此处，$\\boldsymbol{\\Gamma}$ 是粒子通量密度，$S_n$ 是体粒子源密度。\n\n对于有限体积法，我们将此方程在一个控制体积 $V_i$ 上积分。在这种轴对称环形几何中，控制体积是一个由半径 $r=r_{i-1/2}$ 和 $r=r_{i+1/2}$ 处的磁通面为边界的环形区域（环形壳层）。\n$$\n\\int_{V_i} \\frac{\\partial n}{\\partial t} \\, \\mathrm{d}V + \\int_{V_i} \\nabla \\cdot \\boldsymbol{\\Gamma} \\, \\mathrm{d}V = \\int_{V_i} S_n \\, \\mathrm{d}V\n$$\n我们来分析每一项。\n\n第一项表示控制体积 $V_i$ 内总粒子数 $N_i$ 的时间变化率。假设控制体积不随时间变化，我们可以交换积分和微分的次序：\n$$\n\\int_{V_i} \\frac{\\partial n}{\\partial t} \\, \\mathrm{d}V = \\frac{d}{dt} \\int_{V_i} n \\, \\mathrm{d}V = \\frac{d N_i}{dt}\n$$\n总粒子数 $N_i$ 通过 $N_i = n_i V_i$ 与单元平均密度 $n_i$ 相关。\n\n第二项使用散度定理（高斯定理）转换为在控制体积边界 $\\partial V_i$ 上的面积分：\n$$\n\\int_{V_i} \\nabla \\cdot \\boldsymbol{\\Gamma} \\, \\mathrm{d}V = \\oint_{\\partial V_i} \\boldsymbol{\\Gamma} \\cdot d\\mathbf{A}\n$$\n在这个一维径向模型中，粒子通量是纯径向的，$\\boldsymbol{\\Gamma} = \\Gamma_r(r) \\hat{\\mathbf{r}}$。边界 $\\partial V_i$ 由位于 $r_{i-1/2}$（内侧）和 $r_{i+1/2}$（外侧）的两个环形面组成。外法线向量在内侧面上是 $-\\hat{\\mathbf{r}}$，在外侧面上是 $+\\hat{\\mathbf{r}}$。在大环径比近似下，小半径为 $r$、大半径为 $R_0$ 的环面的表面积是 $A(r) = (2\\pi r)(2\\pi R_0) = 4\\pi^2 R_0 r$。因此，面积分变为流出单元的净通量：\n$$\n\\oint_{\\partial V_i} \\boldsymbol{\\Gamma} \\cdot d\\mathbf{A} = (\\Gamma_r A(r))|_{r=r_{i+1/2}} - (\\Gamma_r A(r))|_{r=r_{i-1/2}} = A_{i+1/2}\\Gamma_{r, i+1/2} - A_{i-1/2}\\Gamma_{r, i-1/2}\n$$\n其中 $A_{i\\pm1/2} = A(r_{i\\pm1/2})$ 且 $\\Gamma_{r, i\\pm1/2} = \\Gamma_r(r_{i\\pm1/2})$。\n\n第三项是单位时间内在单元体积内产生的总粒子数，我们可以将其表示为 $\\mathcal{S}_i$：\n$$\n\\mathcal{S}_i = \\int_{V_i} S_n \\, \\mathrm{d}V\n$$\n这可以用单元平均源 $S_{n,i}$ 表示为 $\\mathcal{S}_i = S_{n,i} V_i$。\n\n结合这些项，得到单元 $i$ 中总粒子数的守恒型半离散平衡方程：\n$$\n\\frac{d N_i}{dt} + \\left( A_{i+1/2}\\Gamma_{r, i+1/2} - A_{i-1/2}\\Gamma_{r, i-1/2} \\right) = \\mathcal{S}_i\n$$\n该方程精确地关联了单元内总粒子数的时间变化率 ($d N_i/dt$)、跨越两个径向面的净通量（括号中的项）以及在单元上积分的体源 ($\\mathcal{S}_i$)。\n\n**第 2 部分：单元平均源的计算**\n\n单元平均源 $S_{n,i}$ 定义为连续源分布 $S_n(r)$ 在单元体积 $V_i$ 上的体积平均：\n$$\nS_{n,i} = \\frac{\\int_{V_i} S_n(r) \\, \\mathrm{d}V}{\\int_{V_i} \\, \\mathrm{d}V} = \\frac{\\mathcal{S}_i}{V_i}\n$$\n体积微元由 $\\mathrm{d}V = 4\\pi^2 R_0 r \\, \\mathrm{d}r$ 给出。\n\n首先，我们计算单元 $V_i$ 的体积：\n$$\nV_i = \\int_{r_{i-1/2}}^{r_{i+1/2}} 4\\pi^2 R_0 r \\, \\mathrm{d}r = 4\\pi^2 R_0 \\left[ \\frac{r^2}{2} \\right]_{r_{i-1/2}}^{r_{i+1/2}} = 2\\pi^2 R_0 (r_{i+1/2}^2 - r_{i-1/2}^2)\n$$\n接下来，我们使用给定的源分布 $S_n(r) = S_0 \\exp(-r^2/\\ell^2)$ 来计算积分源 $\\mathcal{S}_i$：\n$$\n\\mathcal{S}_i = \\int_{r_{i-1/2}}^{r_{i+1/2}} S_0 \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) (4\\pi^2 R_0 r \\, \\mathrm{d}r) = 4\\pi^2 R_0 S_0 \\int_{r_{i-1/2}}^{r_{i+1/2}} r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r\n$$\n为了求解该积分，我们使用换元法，令 $u = -r^2/\\ell^2$。其微分为 $du = -2r/\\ell^2 \\, \\mathrm{d}r$，这意味着 $r \\, \\mathrm{d}r = -\\frac{\\ell^2}{2} \\, du$。积分变为：\n$$\n\\int r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r = \\int \\exp(u) \\left(-\\frac{\\ell^2}{2} \\, du\\right) = -\\frac{\\ell^2}{2} \\exp(u) = -\\frac{\\ell^2}{2} \\exp\\left(-\\frac{r^2}{\\ell^2}\\right)\n$$\n计算从 $r_{i-1/2}$ 到 $r_{i+1/2}$ 的定积分：\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} r \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\, \\mathrm{d}r = \\left[ -\\frac{\\ell^2}{2} \\exp\\left(-\\frac{r^2}{\\ell^2}\\right) \\right]_{r_{i-1/2}}^{r_{i+1/2}}\n= -\\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) \\right]\n$$\n$$\n= \\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]\n$$\n将此结果代回到 $\\mathcal{S}_i$ 的表达式中：\n$$\n\\mathcal{S}_i = 4\\pi^2 R_0 S_0 \\left( \\frac{\\ell^2}{2} \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right] \\right)\n$$\n$$\n\\mathcal{S}_i = 2\\pi^2 R_0 S_0 \\ell^2 \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]\n$$\n最后，我们将 $\\mathcal{S}_i$ 除以 $V_i$ 来计算单元平均源 $S_{n,i}$：\n$$\nS_{n,i} = \\frac{2\\pi^2 R_0 S_0 \\ell^2 \\left[ \\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right) \\right]}{2\\pi^2 R_0 (r_{i+1/2}^2 - r_{i-1/2}^2)}\n$$\n公共因子 $2\\pi^2 R_0$ 被消去，得到单元平均源的最终表达式：\n$$\nS_{n,i} = S_0 \\ell^2 \\frac{\\exp\\left(-\\frac{r_{i-1/2}^2}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^2}{\\ell^2}\\right)}{r_{i+1/2}^2 - r_{i-1/2}^2}\n$$\n这就是用给定参数表示的 $S_{n,i}$ 的闭式解析表达式。单位是一致的，因为 $(m^{-3}s^{-1}) \\cdot m^2 / m^2 = m^{-3}s^{-1}$。",
            "answer": "$$\\boxed{S_0 \\ell^2 \\frac{\\exp\\left(-\\frac{r_{i-1/2}^{2}}{\\ell^2}\\right) - \\exp\\left(-\\frac{r_{i+1/2}^{2}}{\\ell^2}\\right)}{r_{i+1/2}^{2} - r_{i-1/2}^{2}}}$$"
        },
        {
            "introduction": "在计算模拟中，正确实现源项对保证结果的准确性至关重要。本练习将引导你完成一个完整的代码验证流程，即“人造解方法”(Method of Manufactured Solutions)，通过构造一个已知的解析解来检验数值求解器的正确性。这种方法是计算科学领域中严谨的代码开发与验证过程的基石 。",
            "id": "4045995",
            "problem": "考虑一个一维平板中的标量粒子密度 $n(x,t)$ 沿着坐标 $x \\in [0,L]$ 在周期性域中的输运问题，该问题代表了计算聚变科学与工程中的一个磁通管段。其基本方程是包含扩散通量以及线性的源和汇的连续性方程：\n$$\\frac{\\partial n}{\\partial t} + \\frac{\\partial \\Gamma}{\\partial x} = S(x) - \\sigma n(x,t),$$ \n其中，扩散通量由 Fick 定律给出：$\\Gamma(x,t) = -D \\frac{\\partial n}{\\partial x}$，标量扩散系数 $D0$ 是均匀的，$S(x)$ 是一个外部施加的源密度分布，而 $\\sigma \\ge 0$ 是一个均匀的线性汇率。在稳态下，控制方程简化为二阶常微分方程\n$$D \\frac{d^2 n}{dx^2} - \\sigma n + S(x) = 0,$$ \n该方程满足周期性边界条件 $n(0) = n(L)$ 和 $\\frac{dn}{dx}(0) = \\frac{dn}{dx}(L)$。\n\n您必须设计并实现一个验证测试，该测试使用已知的解析源分布来产生可预测的稳态密度分布，然后用它来验证输运代码中源项的实现。使用解析源\n$$S(x) = s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x),$$ \n其中 $\\kappa_m = \\frac{2\\pi k_m}{L}$ 且整数 $k_m \\in \\mathbb{Z}^+$，以确保周期性。验证方法应基于第一性原理：在不使用简便公式的情况下，从基本方程推导出预期的稳态 $n(x)$；并独立地在包含 $N$ 个等距点的网格上，使用周期性边界条件的二阶中心有限差分格式，对相同的源项进行稳态方程的数值求解。计算数值解与解析预测之间的相对 $\\ell_2$ 误差，以量化源项实现的正确性：\n$$\\varepsilon = \\frac{\\left\\| n_{\\mathrm{num}} - n_{\\mathrm{ana}} \\right\\|_2}{\\left\\| n_{\\mathrm{ana}} \\right\\|_2}.$$\n\n实现要求：\n- 将区间 $[0,L]$ 离散为 $N$ 个等距点 $x_j = j h$，其中 $h = L/N$ 且 $j \\in \\{0,1,\\dots,N-1\\}$。\n- 使用周期性的二阶中心差分拉普拉斯算子 $\\mathcal{L}_h n_j = \\frac{n_{j+1} - 2 n_j + n_{j-1}}{h^2}$（采用周期性索引）来构建稳态离散方程 $D \\mathcal{L}_h n_j - \\sigma n_j + S_j = 0$。\n- 使用适用于周期性问题的方法，准确且稳定地求解离散稳态问题以得到 $n_{\\mathrm{num}}$。\n- 根据第一性原理推导，在相同网格上独立地构建 $n_{\\mathrm{ana}}$。\n- 计算相对 $\\ell_2$ 误差 $\\varepsilon$ 作为无量纲浮点数。输出中不需要物理单位。\n\n测试套件：\n使用以下参数集，这些参数集涵盖了一般情况、粗网格行为、高扩散、高汇以及近 Nyquist 内容。对每种情况，按指定定义 $(L,D,\\sigma,N,k_1,k_2,s_1,s_2)$：\n- 情况 1 (一般的“理想路径”)：$L = 2\\pi$，$D = 0.3$，$\\sigma = 0.7$，$N = 256$，$k_1 = 3$，$k_2 = 5$，$s_1 = 1.0$，$s_2 = 0.5$。\n- 情况 2 (粗网格边界覆盖)：$L = 2\\pi$，$D = 0.3$，$\\sigma = 0.7$，$N = 16$，$k_1 = 3$，$k_2 = 5$，$s_1 = 1.0$，$s_2 = 0.5$。\n- 情况 3 (重要边界情况：高扩散)：$L = 2\\pi$，$D = 5.0$，$\\sigma = 0.1$，$N = 128$，$k_1 = 1$，$k_2 = 2$，$s_1 = 2.0$，$s_2 = 1.0$。\n- 情况 4 (重要边界情况：高汇)：$L = 2\\pi$，$D = 0.01$，$\\sigma = 10.0$，$N = 128$，$k_1 = 4$，$k_2 = 7$，$s_1 = 1.0$，$s_2 = 2.0$。\n- 情况 5 (无混叠的近 Nyquist 内容)：$L = 2\\pi$，$D = 0.2$，$\\sigma = 0.5$，$N = 64$，$k_1 = 8$，$k_2 = 16$，$s_1 = 1.5$，$s_2 = 0.75$。\n\n最终输出规范：\n您的程序应生成单行输出，其中包含五个测试用例的相对 $\\ell_2$ 误差，格式为方括号内由逗号分隔的浮点数列表，并按 1 到 5 的顺序排列，例如 $[e_1,e_2,e_3,e_4,e_5]$。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据，问题提法恰当，并为计算输运建模中的验证测试提供了一套完整且一致的规范。所有测试用例都定义了 $\\sigma  0$，确保相应的连续和离散问题都有唯一解。\n\n按要求，求解过程分三个阶段进行：首先，推导连续问题的精确解析解；其次，构建离散化问题的数值解；第三，计算两者之间的相对误差以验证实现。\n\n**1. 解析解的推导**\n\n控制方程是稳态一维反应扩散方程：\n$$D \\frac{d^2 n}{dx^2} - \\sigma n + S(x) = 0$$\n这是一个线性、二阶常微分方程，具有常数系数 $D  0$ 和 $\\sigma  0$。定义域为 $x \\in [0, L]$，具有周期性边界条件。源项被指定为：\n$$S(x) = s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x)$$\n其中 $\\kappa_m = \\frac{2\\pi k_m}{L}$，对于正整数 $k_m$。这种形式确保 $S(x)$ 在区间 $[0, L]$ 上满足周期性边界条件。\n\n由于微分算子 $\\mathcal{L} \\equiv D \\frac{d^2}{dx^2} - \\sigma$ 的线性性质，我们可以应用叠加原理。我们通过独立考虑源项中正弦和余弦分量的贡献来寻找一个特解 $n_p(x)$。函数 $\\sin(\\kappa x)$ 和 $\\cos(\\kappa x)$ 是二阶导数算子 $\\frac{d^2}{dx^2}$ 的特征函数。因此，我们提出一个与源项函数形式相同的解的拟设：\n$$n_{\\mathrm{ana}}(x) = C_1 \\sin(\\kappa_1 x) + C_2 \\cos(\\kappa_2 x)$$\n我们将此拟设代入控制方程。首先，我们计算 $n_{\\mathrm{ana}}(x)$ 的二阶导数：\n$$\\frac{d^2 n_{\\mathrm{ana}}}{dx^2} = -C_1 \\kappa_1^2 \\sin(\\kappa_1 x) - C_2 \\kappa_2^2 \\cos(\\kappa_2 x)$$\n将 $n_{\\mathrm{ana}}$ 及其二阶导数代入常微分方程，得到：\n$$D \\left( -C_1 \\kappa_1^2 \\sin(\\kappa_1 x) - C_2 \\kappa_2^2 \\cos(\\kappa_2 x) \\right) - \\sigma \\left( C_1 \\sin(\\kappa_1 x) + C_2 \\cos(\\kappa_2 x) \\right) + \\left( s_1 \\sin(\\kappa_1 x) + s_2 \\cos(\\kappa_2 x) \\right) = 0$$\n对每个三角函数收集项：\n$$\\left( -D C_1 \\kappa_1^2 - \\sigma C_1 + s_1 \\right) \\sin(\\kappa_1 x) + \\left( -D C_2 \\kappa_2^2 - \\sigma C_2 + s_2 \\right) \\cos(\\kappa_2 x) = 0$$\n为使此方程对所有 $x \\in [0, L]$ 成立，基函数 $\\sin(\\kappa_1 x)$ 和 $\\cos(\\kappa_2 x)$ 的系数必须独立为零（假设 $k_1 \\ne k_2$；如果 $k_1 = k_2$，通过合并项，该逻辑仍然成立）。\n$$-C_1 (D \\kappa_1^2 + \\sigma) + s_1 = 0 \\implies C_1 = \\frac{s_1}{D \\kappa_1^2 + \\sigma}$$\n$$-C_2 (D \\kappa_2^2 + \\sigma) + s_2 = 0 \\implies C_2 = \\frac{s_2}{D \\kappa_2^2 + \\sigma}$$\n给定 $D0$，$\\sigma0$ 和实数 $\\kappa_m$，分母 $(D \\kappa_m^2 + \\sigma)$ 是严格为正的。因此，这些系数是良定义的。最终的解析解是：\n$$n_{\\mathrm{ana}}(x) = \\frac{s_1}{D \\kappa_1^2 + \\sigma} \\sin(\\kappa_1 x) + \\frac{s_2}{D \\kappa_2^2 + \\sigma} \\cos(\\kappa_2 x)$$\n根据构造，该解是周期性的，并且是给定条件下的唯一稳态解。\n\n**2. 数值解的构建**\n\n问题在 $N$ 个点的均匀网格上离散化，$x_j = j h$，$j \\in \\{0, 1, \\dots, N-1\\}$，网格间距为 $h = L/N$。使用二阶中心差分对拉普拉斯算子进行离散化，稳态方程变成一个代数方程组：\n$$D \\left( \\frac{n_{j+1} - 2n_j + n_{j-1}}{h^2} \\right) - \\sigma n_j + S_j = 0$$\n其中 $n_j = n(x_j)$ 和 $S_j = S(x_j)$。索引是周期性处理的，即 $n_{N} \\equiv n_0$ 和 $n_{-1} \\equiv n_{N-1}$。这 $N$ 个线性方程可以写成矩阵形式 $A \\mathbf{n}_{\\mathrm{num}} = -\\mathbf{S}$。由于周期性边界条件，代表离散算子 $D \\mathcal{L}_h - \\sigma I$ 的矩阵 $A$ 是一个循环矩阵。\n\n求解涉及循环矩阵的线性系统最有效和最稳定的方法是离散傅里叶变换 (DFT)。DFT 可以对角化任何循环矩阵。将表示为 $\\mathcal{F}$ 的 DFT 应用于离散方程，将有限差分模板所代表的卷积转换为傅里叶空间中的简单乘法。设 $\\hat{n}_q = \\mathcal{F}\\{n_j\\}$ 和 $\\hat{S}_q = \\mathcal{F}\\{S_j\\}$ 分别为密度和源项的 DFT，其中 $q$ 是离散模式指数。\n\n作用于 $n_j$ 的离散拉普拉斯算子的 DFT 由其特征值 $\\lambda_q$ 的乘法给出：\n$$\\mathcal{F}\\{\\mathcal{L}_h n_j\\} = \\lambda_q \\hat{n}_q = \\frac{2}{h^2} \\left( \\cos\\left(\\frac{2\\pi q}{N}\\right) - 1 \\right) \\hat{n}_q, \\quad q \\in \\{0, 1, \\dots, N-1\\}$$\n傅里叶空间中的完整方程变为每个模式 $\\hat{n}_q$ 的代数方程：\n$$\\left( D \\lambda_q - \\sigma \\right) \\hat{n}_q + \\hat{S}_q = 0$$\n求解 $\\hat{n}_q$：\n$$\\hat{n}_q = \\frac{-\\hat{S}_q}{D \\lambda_q - \\sigma} = \\frac{-\\hat{S}_q}{D \\frac{2}{h^2} \\left( \\cos\\left(\\frac{2\\pi q}{N}\\right) - 1 \\right) - \\sigma}$$\n对于 $\\sigma0$，分母始终非零，因此 $\\hat{\\mathbf{n}}$ 存在唯一解。然后通过对傅里叶系数向量 $\\hat{\\mathbf{n}}$ 应用逆 DFT ($\\mathcal{F}^{-1}$)，可以恢复实空间中的数值解 $\\mathbf{n}_{\\mathrm{num}}$：\n$$n_{\\mathrm{num}, j} = \\mathcal{F}^{-1}\\{\\hat{n}_q\\}$$\n\n**3. 误差量化**\n\n为了验证数值实现的正确性，我们将数值解 $n_{\\mathrm{num}}$ 与在同一网格上求值的解析解 $n_{\\mathrm{ana}}$ 进行比较。偏差使用相对 $\\ell_2$ 误差 $\\varepsilon$ 进行量化：\n$$\\varepsilon = \\frac{\\left\\| \\mathbf{n}_{\\mathrm{num}} - \\mathbf{n}_{\\mathrm{ana}} \\right\\|_2}{\\left\\| \\mathbf{n}_{\\mathrm{ana}} \\right\\|_2}$$\n其中，长度为 $N$ 的向量 $\\mathbf{v}$ 的离散 $\\ell_2$ 范数定义为 $\\left\\| \\mathbf{v} \\right\\|_2 = \\sqrt{\\sum_{j=0}^{N-1} v_j^2}$。此误差主要归因于有限差分近似的截断误差，其阶数为 $\\mathcal{O}(h^2)$。一个小的 $\\varepsilon$ 值证实了数值求解器正确地实现了由连续模型描述的物理过程。该实现将为每个提供的测试用例计算此误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady-state diffusion-reaction equation for a series of test cases,\n    compares the numerical solution to the analytic solution, and computes the relative l2 error.\n    \"\"\"\n    # (L, D, sigma, N, k1, k2, s1, s2)\n    test_cases = [\n        # Case 1 (general \"happy path\"):\n        (2 * np.pi, 0.3, 0.7, 256, 3, 5, 1.0, 0.5),\n        # Case 2 (coarse grid boundary coverage):\n        (2 * np.pi, 0.3, 0.7, 16, 3, 5, 1.0, 0.5),\n        # Case 3 (significant edge case: high diffusion):\n        (2 * np.pi, 5.0, 0.1, 128, 1, 2, 2.0, 1.0),\n        # Case 4 (significant edge case: high sink):\n        (2 * np.pi, 0.01, 10.0, 128, 4, 7, 1.0, 2.0),\n        # Case 5 (near-Nyquist content without aliasing):\n        (2 * np.pi, 0.2, 0.5, 64, 8, 16, 1.5, 0.75),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, D, sigma, N, k1, k2, s1, s2 = case\n        \n        # 1. Grid and Parameter Setup\n        h = L / N\n        x = np.arange(N) * h\n        kappa1 = 2 * np.pi * k1 / L\n        kappa2 = 2 * np.pi * k2 / L\n        \n        # 2. Analytic Solution Construction\n        # n_ana(x) = c1*sin(k1*x) + c2*cos(k2*x), where coefficients c1 and c2 are\n        # derived from the ODE: c_m = s_m / (D*kappa_m^2 + sigma).\n        c1 = s1 / (D * kappa1**2 + sigma)\n        c2 = s2 / (D * kappa2**2 + sigma)\n        n_ana = c1 * np.sin(kappa1 * x) + c2 * np.cos(kappa2 * x)\n        \n        # 3. Numerical Solution via FFT\n        # The equation D*n'' - sigma*n = -S is solved in Fourier space.\n        \n        # Evaluate source term on the grid\n        S = s1 * np.sin(kappa1 * x) + s2 * np.cos(kappa2 * x)\n        \n        # Fourier transform the source\n        S_hat = fft.fft(S)\n        \n        # Define eigenvalues of the discrete Laplacian operator in Fourier space.\n        # q represents the discrete mode number from 0 to N-1.\n        q = np.arange(N)\n        # Eigenvalues of second-order central difference periodic Laplacian:\n        # lambda_q = (2/h^2)*(cos(2*pi*q/N) - 1)\n        discrete_laplacian_eigvals = (2 / h**2) * (np.cos(2 * np.pi * q / N) - 1)\n        \n        # Solve for n_hat in Fourier space: (D*lambda_q - sigma)*n_hat = -S_hat\n        # The denominator is guaranteed non-zero since D0 and sigma0.\n        denominator = D * discrete_laplacian_eigvals - sigma\n        n_hat = -S_hat / denominator\n        \n        # Inverse Fourier transform to get the solution in real space.\n        # The result should be real; the small imaginary part is numerical noise.\n        n_num = np.real(fft.ifft(n_hat))\n        \n        # 4. Error Calculation\n        # Compute the relative l2 error between numerical and analytic solutions.\n        error_norm = np.linalg.norm(n_num - n_ana)\n        ana_norm = np.linalg.norm(n_ana)\n        \n        # Avoid division by zero if the analytic solution is identically zero.\n        # This is not expected for the given test cases but is good practice.\n        if ana_norm == 0.0:\n            relative_error = 0.0 if error_norm == 0.0 else np.inf\n        else:\n            relative_error = error_norm / ana_norm\n            \n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}