{
    "hands_on_practices": [
        {
            "introduction": "托卡马克中的输运理论极大地依赖于在磁通量面上对物理量进行平均。本练习将从第一性原理出发，构建这一基本工具，揭示非均匀磁场如何通过几何权重影响平均过程。这是将复杂的三维问题简化为更易于处理的一维输运方程的第一步。",
            "id": "4027971",
            "problem": "考虑一个大环径比的轴对称托卡马克，其圆形磁通面由极向角 $\\theta \\in [0,2\\pi)$ 和环向角 $\\zeta \\in [0,2\\pi)$ 参数化。令大半径为 $R(\\theta) = R_{0} + r \\cos\\theta$，其中 $r \\ll R_{0}$ 且 $\\varepsilon \\equiv r/R_{0}$ 为反环径比。假设磁场以环向分量为主，因此在 $\\varepsilon$ 的领头阶上，$B(\\theta) = B_{0} R_{0} / R(\\theta)$，并且磁通面上的面元为 $dS = r R(\\theta)\\, d\\theta\\, d\\zeta$。\n\n(a) 从磁场的无散特性 $\\nabla \\cdot \\boldsymbol{B} = 0$ 和细磁通管中的磁通量守恒出发，构建一个在给定磁通面上标量场 $A(\\theta,\\zeta)$ 的磁通面平均（记为 $\\langle A \\rangle$）的坐标无关定义。该构建必须从第一性原理推导得出，并明确阐述由磁场引起的几何权重。\n\n(b) 使用 (a) 部分的结果和给定的大环径比圆形几何，计算磁通面平均 $\\langle \\cos\\theta \\rangle$ 至 $\\varepsilon$ 的领头阶。你的推导应清楚地展示极向变化量 $R(\\theta)$ 和 $B(\\theta)$ 如何通过几何权重进入 Pfirsch–Schlüter 流的计算。\n\n将你的最终答案表示为关于 $\\varepsilon$ 的单个闭式解析表达式。不需要数值近似或四舍五入。明确说明该量是无量纲的。",
            "solution": "问题陈述需经过验证。\n\n### 第1步：提取已知条件\n-   系统：轴对称托卡马克，大环径比，圆形磁通面。\n-   坐标：极向角 $\\theta \\in [0, 2\\pi)$，环向角 $\\zeta \\in [0, 2\\pi)$。\n-   大半径：$R(\\theta) = R_{0} + r \\cos\\theta$。\n-   反环径比：$\\varepsilon \\equiv r/R_{0} \\ll 1$。\n-   磁场（领头阶）：$B(\\theta) = B_{0} R_{0} / R(\\theta)$。\n-   面元：$dS = r R(\\theta)\\, d\\theta\\, d\\zeta$。\n-   (a)部分目标：从第一性原理（$\\nabla \\cdot \\boldsymbol{B} = 0$，磁通管守恒）出发，构建磁通面平均 $\\langle A \\rangle$ 的坐标无关定义。\n-   (b)部分目标：使用(a)部分的定义和所提供的几何形状，计算 $\\langle \\cos\\theta \\rangle$ 至 $\\varepsilon$ 的领头阶。\n-   最终答案格式：一个关于 $\\varepsilon$ 的单一闭式解析表达式，并说明其为无量纲。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于托卡马克的一个标准（尽管简化了）模型，托卡马克是聚变能研究的核心装置。磁通面平均、环向磁场对 $1/R$ 的依赖关系以及与 Pfirsch–Schlüter 流的联系等概念，在磁流体力学（MHD）和新经典输运理论中都是基础且公认的。\n-   **适定性**：该问题是适定的。(a)部分要求推导一个标准定义，(b)部分要求基于该定义进行一个具体、可解的计算。给定的输入足以确定唯一答案。\n-   **客观性**：问题以精确、客观和技术性的语言陈述。\n-   **完整性与一致性**：问题是自洽的。所有必要的函数（$R(\\theta)$、$B(\\theta)$）、几何形状（$dS$）和参数（$\\varepsilon$）都已提供。给定的形式与大环径比、圆形磁通面近似相符。\n-   **真实性与可行性**：该模型是等离子体物理学中一个物理上真实且广泛使用的近似。所指定的关系在量纲上和物理上都是一致的。\n-   **结构与清晰度**：问题结构清晰，分为两部分，第一部分为第二部分建立了必要的理论工具。在等离子体物理学领域，所用术语没有歧义。\n-   **其他缺陷**：该问题并非无关紧要、比喻性或无法验证。它探讨了等离子体输运中的一个核心概念。\n\n### 第3步：结论与行动\n问题被判定为**有效**。将提供完整解答。\n\n***\n\n### (a)部分：磁通面平均定义的构建\n\n标量 $A$ 的磁通面平均是等离子体输运理论的基石。其定义必须具有物理意义，并在数学上与磁场的性质（特别是其无散特性 $\\nabla \\cdot \\boldsymbol{B} = 0$）相一致。\n\n磁通面平均（记为 $\\langle A \\rangle$）的一个稳健定义源于这样一个要求：磁通面上任意单值函数 $f$ 的平行梯度的平均值必须为零。这就是所谓的可解性条件 $\\langle \\boldsymbol{B} \\cdot \\nabla f \\rangle = 0$，它对于求解各种输运方程至关重要。\n\n让我们提出一个在磁通面 $S$ 上的通用加权平均：\n$$\n\\langle A \\rangle = \\frac{\\int_S A w \\, dS}{\\int_S w \\, dS}\n$$\n其中 $w$ 是一个待定的权重函数。可解性条件要求：\n$$\n\\int_S (\\boldsymbol{B} \\cdot \\nabla f) w \\, dS = 0\n$$\n根据矢量恒等式 $\\nabla \\cdot (f \\boldsymbol{C}) = (\\nabla f) \\cdot \\boldsymbol{C} + f (\\nabla \\cdot \\boldsymbol{C})$ 以及已知条件 $\\nabla \\cdot \\boldsymbol{B} = 0$，我们可以写出 $\\boldsymbol{B} \\cdot \\nabla f = \\nabla \\cdot (f \\boldsymbol{B})$。该积分变为：\n$$\n\\int_S \\nabla \\cdot (f \\boldsymbol{B}) w \\, dS = 0\n$$\n这个表达式不是立即可用的，因为散度定理适用于对体积的积分，而不是加权曲面。\n\n一个更直接的物理和数学论证来自于考虑磁场的结构。条件 $\\nabla \\cdot \\boldsymbol{B} = 0$ 意味着量 $dS/B$ 与磁通管的体积有关。考虑一个具有小的、恒定磁通量 $d\\Phi$ 的细磁通管。其垂直于 $\\boldsymbol{B}$ 的横截面积为 $dA_{\\perp} = d\\Phi/B$。该磁通管沿磁力线长度为 $dl$ 的一段的体积为 $dV = dA_{\\perp} dl = (d\\Phi/B) dl$。\n\n另一个关键见解是，算子 $\\boldsymbol{B} \\cdot \\nabla$ 在不同坐标系中，对于权重为 $1/B^2$ 或 $1/|\\nabla\\psi|$ 的内积是反厄米的。然而，一个被广泛采用且物理上直观的定义（尤其是在动理学理论的背景下）是使用 $1/B$ 进行加权。这种加权解释了这样一个事实：沿磁力线运动的带电粒子在磁场较弱的区域停留的时间更长，这是磁矩守恒的结果。\n\n这导出了标量场 $A$ 的磁通面平均的坐标无关定义为：\n$$\n\\langle A \\rangle \\equiv \\frac{\\oint_S A \\frac{dS}{B}}{\\oint_S \\frac{dS}{B}}\n$$\n此处，积分是在整个闭合磁通面 $S$ 上进行的，$dS$ 是面元，$B = |\\boldsymbol{B}|$ 是磁场的大小。这个定义正确地捕捉了由于磁通面上的磁场结构而产生的几何权重。算子 $\\boldsymbol{B} \\cdot \\nabla$ 对于简单的曲面积分不是自伴的，但这个加权平均定义确保了 $\\langle \\boldsymbol{B} \\cdot \\nabla f \\rangle = 0$，正如所要求的。这可以通过写作 $\\int_S (\\boldsymbol{B} \\cdot \\nabla f)/B \\, dS = \\int_S \\boldsymbol{b} \\cdot \\nabla f \\, dS = \\int_S \\nabla_S \\cdot (f \\boldsymbol{b}) \\, dS - \\int_S f (\\nabla_S \\cdot \\boldsymbol{b}) \\, dS$ 来证明。第一项根据闭合曲面上的曲面散度定理为零。在对曲面几何和条件 $\\nabla \\cdot \\boldsymbol{B} = 0$ 进行更详细的分析后，第二项也为零。\n\n### (b)部分：$\\langle \\cos\\theta \\rangle$ 的计算\n\n我们现在应用(a)部分的定义来计算给定的大环径比托卡马克模型下的 $\\langle \\cos\\theta \\rangle$。该平均值为：\n$$\n\\langle \\cos\\theta \\rangle = \\frac{\\int_0^{2\\pi} \\int_0^{2\\pi} \\cos\\theta \\frac{dS}{B(\\theta)}}{\\int_0^{2\\pi} \\int_0^{2\\pi} \\frac{dS}{B(\\theta)}}\n$$\n已知条件是：\n-   $dS = r R(\\theta) d\\theta d\\zeta$\n-   $R(\\theta) = R_0(1 + \\varepsilon \\cos\\theta)$\n-   $B(\\theta) = \\frac{B_0 R_0}{R(\\theta)} = \\frac{B_0}{1 + \\varepsilon \\cos\\theta}$\n\n被积函数中的权重因子是 $\\frac{dS}{B(\\theta)}$：\n$$\n\\frac{dS}{B(\\theta)} = \\frac{r R(\\theta) d\\theta d\\zeta}{B_0 R_0 / R(\\theta)} = \\frac{r [R(\\theta)]^2}{B_0 R_0} d\\theta d\\zeta\n$$\n代入 $R(\\theta) = R_0(1 + \\varepsilon \\cos\\theta)$：\n$$\n\\frac{dS}{B(\\theta)} = \\frac{r [R_0(1 + \\varepsilon \\cos\\theta)]^2}{B_0 R_0} d\\theta d\\zeta = \\frac{r R_0}{B_0} (1 + \\varepsilon \\cos\\theta)^2 d\\theta d\\zeta\n$$\n对 $\\zeta$ 从 $0$ 到 $2\\pi$ 的积分在分子和分母中都产生一个因子 $2\\pi$，该因子被消掉。常数前因子 $\\frac{r R_0}{B_0}$ 也被消掉。平均值的表达式简化为对 $\\theta$ 的积分：\n$$\n\\langle \\cos\\theta \\rangle = \\frac{\\int_0^{2\\pi} \\cos\\theta (1 + \\varepsilon \\cos\\theta)^2 d\\theta}{\\int_0^{2\\pi} (1 + \\varepsilon \\cos\\theta)^2 d\\theta}\n$$\n这一步清楚地显示了大半径 $R(\\theta)$ 和磁场 $B(\\theta)$ 的极向变化如何组合成一个几何权重因子 $(1 + \\varepsilon \\cos\\theta)^2$。一个未加权的平均值 $\\int \\cos\\theta d\\theta / \\int d\\theta$ 将为零。非零结果的出现是因为环体的外侧（$\\theta \\approx 0$，其中 $\\cos\\theta > 0$）具有较大的 $R$ 和较小的 $B$，从而导致较大的权重。\n\n我们现在计算这些积分。首先，展开被积函数：\n-   分子被积函数：$\\cos\\theta (1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta) = \\cos\\theta + 2\\varepsilon \\cos^2\\theta + \\varepsilon^2 \\cos^3\\theta$\n-   分母被积函数：$1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta$\n\n接下来，我们使用以下在周期 $[0, 2\\pi]$ 上的标准定积分：\n$$\n\\int_0^{2\\pi} d\\theta = 2\\pi\n$$\n$$\n\\int_0^{2\\pi} \\cos(n\\theta) d\\theta = 0 \\quad \\text{for any integer } n \\neq 0\n$$\n$$\n\\int_0^{2\\pi} \\cos^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{1 + \\cos(2\\theta)}{2} d\\theta = \\pi\n$$\n$$\n\\int_0^{2\\pi} \\cos^3\\theta d\\theta = \\int_0^{2\\pi} \\frac{3\\cos\\theta + \\cos(3\\theta)}{4} d\\theta = 0\n$$\n\n计算分子积分：\n$$\n\\int_0^{2\\pi} (\\cos\\theta + 2\\varepsilon \\cos^2\\theta + \\varepsilon^2 \\cos^3\\theta) d\\theta = \\int_0^{2\\pi} \\cos\\theta d\\theta + 2\\varepsilon \\int_0^{2\\pi} \\cos^2\\theta d\\theta + \\varepsilon^2 \\int_0^{2\\pi} \\cos^3\\theta d\\theta\n$$\n$$\n= 0 + 2\\varepsilon(\\pi) + \\varepsilon^2(0) = 2\\pi\\varepsilon\n$$\n\n计算分母积分：\n$$\n\\int_0^{2\\pi} (1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta) d\\theta = \\int_0^{2\\pi} 1 d\\theta + 2\\varepsilon \\int_0^{2\\pi} \\cos\\theta d\\theta + \\varepsilon^2 \\int_0^{2\\pi} \\cos^2\\theta d\\theta\n$$\n$$\n= 2\\pi + 2\\varepsilon(0) + \\varepsilon^2(\\pi) = 2\\pi + \\pi\\varepsilon^2 = \\pi(2 + \\varepsilon^2)\n$$\n\n最后，我们计算比率：\n$$\n\\langle \\cos\\theta \\rangle = \\frac{2\\pi\\varepsilon}{\\pi(2 + \\varepsilon^2)} = \\frac{2\\varepsilon}{2 + \\varepsilon^2}\n$$\n这是给定模型的精确结果。问题要求结果精确到“$\\varepsilon$ 的领头阶”。由于 $\\varepsilon \\ll 1$，我们可以将此表达式展开为泰勒级数：\n$$\n\\frac{2\\varepsilon}{2 + \\varepsilon^2} = \\frac{\\varepsilon}{1 + \\varepsilon^2/2} = \\varepsilon \\left(1 - \\frac{\\varepsilon^2}{2} + O(\\varepsilon^4) \\right) = \\varepsilon - \\frac{\\varepsilon^3}{2} + O(\\varepsilon^5)\n$$\n领头阶项，即展开式中第一个非零项，是 $\\varepsilon$。\n\n量 $\\varepsilon = r/R_0$ 是长度之比，因此是无量纲的。结果 $\\langle \\cos\\theta \\rangle$ 是一个纯数，也如预期是无量纲的。",
            "answer": "$$\n\\boxed{\\varepsilon}\n$$"
        },
        {
            "introduction": "数值求解漂移动理学方程充满挑战，其中一个关键步骤是在速度空间中（特别是螺距角坐标上）离散化碰撞算符。本练习旨在设计一种专用网格，以解析被捕获粒子和通行粒子之间的临界边界，并构建一个稳定的数值算符。这些对于在 Pfirsch–Schlüter 和平台区中进行精确模拟至关重要。",
            "id": "4028039",
            "problem": "您的任务是设计并实现一个计算程序，该程序能够构建一个非均匀的螺距角网格和一个保守的速度空间离散化方法。这套方法需适用于解析平台输运区中的捕获-通行边界，并在强碰撞的 Pfirsch–Schlüter 极限下保持稳定。目标背景是环形磁化等离子体，在 neoclassical kinetic theory（新经典动理学理论）的层面上进行建模，但您的解决方案必须纯粹以数学和算法术语来表达。\n\n在您的推理和设计中，必须使用的起点和基本依据：\n- 碰撞动理学方程的守恒律：粒子数守恒和螺距角散射下朝向各向同性的单调趋近。\n- 由磁通面上沿磁力线的磁场强度变化引起的几何捕获，其中磁场由大环径比模型下的一阶傅里叶谐波给出。\n- Lorentz 螺距角散射算子，它是描述磁化等离子体中各向同性化碰撞的标准自伴极限，其负算子定义了一个关于螺距角坐标的类扩散生成元。\n- 捕获-通行边界是由磁场不均匀性产生的磁镜点导致平行运动沿磁力线变号的螺距角值的集合。\n\n您的程序必须：\n1. 为螺距变量 $\\xi = v_{\\parallel}/v \\in [-1,1]$ 构建一个螺距角网格，该网格能够解析位于 $\\pm \\xi_{t}$ 的捕获-通行边界，其中 $\\xi_{t}$ 由磁通面上的大环径比磁场变化确定。该网格必须通过等分布原理生成，使用一个监控函数，该函数在边界 $\\pm \\xi_{t}$ 附近聚集点，同时保持对称性并精确包含端点 $-1$ 和 $1$。\n2. 针对与 Lorentz 算子自伴形式相对应的变系数螺距角扩散算子，建立一个保守的、二阶的、对称的离散化方法（基于通量差分）。该离散算子必须守恒均匀分布，并且是负半定的，以反映在强碰撞 Pfirsch–Schlüter 极限下的稳定性。\n3. 对每个测试用例，计算两个量化指标：\n   - 分辨率度量 $\\rho$，定义为位于捕获-通行边界 $\\pm \\xi_{t}$ 周围两个半宽为 $w$ 的对称区间并集内的网格节点所占的比例。如果 $\\xi_{t} = 0$，则只考虑一个以 $\\xi = 0$ 为中心的区间，以避免重复计数。\n   - 离散算子矩阵的最大特征值 $\\lambda_{\\max}$。在 Pfirsch–Schlüter 极限下的数值稳定性由 $\\lambda_{\\max} \\le 0$ 表示。\n\n几何模型和捕获-通行边界确定要求：\n- 在大环径比托卡马克的一个磁通面上，假设磁场强度可以建模为 $B(\\theta) = B_{0} (1 + \\varepsilon \\cos \\theta)$，其中 $\\theta$ 是极向角，$\\varepsilon \\in [0,1)$ 是逆环径比参数。由此确定 $B_{\\min}$ 和 $B_{\\max}$，并使用第一性原理推导出捕获-通行边界 $\\xi_{t}$ 作为 $\\varepsilon$ 的函数。\n\n算子离散化要求：\n- 在非均匀的 $\\xi$ 网格上以守恒形式离散化自伴螺距角扩散算子，在 $\\xi = \\pm 1$ 处强制施加零通量自然边界条件。离散化必须使得最终得到的实对称矩阵具有非正特征值和一个由常数向量张成的一维零空间，代表粒子数守恒。\n\n测试套件：\n实现您的程序以处理以下四个测试用例。每个测试用例由一个元组 $( \\varepsilon, N, \\alpha, \\delta, w )$ 给出，其中 $\\varepsilon$ 是逆环径比参数， $N$ 是包括端点在内的网格节点数，$\\alpha$ 控制监控函数中点聚集的强度，$\\delta$ 是一个小的正则化项以避免奇异聚集， $w$ 是分辨率度量中使用的半宽：\n- 用例 1 (理想情况，中等逆环径比): $(0.3, 81, 10.0, 10^{-3}, 0.02)$\n- 用例 2 (边界条件情况，捕获消失): $(0.0, 81, 10.0, 10^{-3}, 0.02)$\n- 用例 3 (接近极端的捕获边界，靠近 $\\xi=\\pm 1$): $(0.9, 81, 10.0, 10^{-3}, 0.02)$\n- 用例 4 (粗网格边缘情况): $(0.3, 9, 10.0, 10^{-3}, 0.02)$\n\n最终输出格式：\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个元素本身是对应测试用例的 $[\\rho, \\lambda_{\\max}]$ 形式的双元素列表，顺序与测试套件相同。例如，一个有效的输出形式为\n$$\n[[\\rho_{1}, \\lambda_{\\max,1}],[\\rho_{2}, \\lambda_{\\max,2}],[\\rho_{3}, \\lambda_{\\max,3}],[\\rho_{4}, \\lambda_{\\max,4}]]\n$$\n不需要物理单位，所有角度都不能以度表示；所有量都是无量纲的。程序必须是自包含的，不得读取任何输入或写入任何文件。",
            "solution": "该问题要求设计并实现一个计算程序，用于创建一个螺距角网格及相应的离散碰撞算子，该算子适用于环形等离子体在平台区和 Pfirsch–Schlüter 区的动理学模拟。该程序必须通过计算几个测试用例的网格分辨率度量 $\\rho$ 和离散算子的最大特征值 $\\lambda_{\\max}$ 来进行验证。整个过程基于新经典动理学理论的原理，特别是关于粒子捕获和螺距角散射的部分。\n\n首先，我们确定捕获-通行边界 $\\xi_t$。在大环径比托卡马克中，给定磁通面上的磁场强度建模为 $B(\\theta) = B_{0}(1 + \\varepsilon \\cos\\theta)$，其中 $\\varepsilon$ 是逆环径比，$\\theta$ 是极向角。最大和最小场强分别为 $B_{\\max} = B_{0}(1+\\varepsilon)$（在 $\\theta=0$ 处）和 $B_{\\min} = B_{0}(1-\\varepsilon)$（在 $\\theta=\\pi$ 处）。粒子运动受能量守恒 $E = \\frac{1}{2}mv^2$ 和磁矩守恒 $\\mu = \\frac{1}{2}mv_{\\perp}^2/B$ 的支配。螺距角变量定义为 $\\xi = v_{\\parallel}/v$。由此，我们推导出不变量 $\\mu/E = (1-\\xi^2)/B$。如果一个粒子在到达最大磁场区域之前，其平行速度 $v_{\\parallel}$（因而 $\\xi$）变为零，则该粒子被捕获。转折点发生在场强为 $B_{\\text{turn}}$ 的位置。在该点，$\\xi=0$，因此 $\\mu/E = 1/B_{\\text{turn}}$。一个在场强为 $B$ 的位置具有螺距角 $\\xi$ 的粒子，如果 $B_{\\text{turn}}  B_{\\max}$，则被捕获，这意味着 $(1-\\xi^2)/B = 1/B_{\\text{turn}} > 1/B_{\\max}$，或 $1-\\xi^2 > B/B_{\\max}$。捕获-通行边界 $\\xi_t$ 通常定义为在最小磁场位置（$\\theta=\\pi$）处，区分捕获轨道和通行轨道的 $|\\xi|$ 的临界值。在该位置，条件变为 $1-\\xi_t^2 = B_{\\min}/B_{\\max}$。解出 $\\xi_t$ 可得：\n$$\n\\xi_t = \\sqrt{1 - \\frac{B_{\\min}}{B_{\\max}}} = \\sqrt{1 - \\frac{1-\\varepsilon}{1+\\varepsilon}} = \\sqrt{\\frac{(1+\\varepsilon) - (1-\\varepsilon)}{1+\\varepsilon}} = \\sqrt{\\frac{2\\varepsilon}{1+\\varepsilon}}\n$$\n此表达式提供了网格必须解析的边界层的位置。对于 $\\varepsilon=0$，$\\xi_t=0$，表示没有捕获粒子。当 $\\varepsilon \\to 1$ 时，$\\xi_t \\to 1$。\n\n其次，我们在区间 $[-1, 1]$ 上为 $i=0, \\dots, N-1$ 构建非均匀螺距角网格 $\\xi_i$。该网格必须在边界 $\\pm\\xi_t$ 附近聚集点。我们采用基于监控函数 $M(\\xi)$ 的等分布原理。该原理规定，网格点 $\\xi_i$ 通过求解 $\\int_{-1}^{\\xi_i} M(x) dx = \\frac{i}{N-1} \\int_{-1}^{1} M(x) dx$ 来确定。一个合适的、对称的、并使用给定参数 $\\alpha$ 和 $\\delta$ 在 $\\pm\\xi_t$ 附近聚集点的监控函数是：\n$$\nM(\\xi) = 1 + \\frac{\\alpha}{(\\xi-\\xi_t)^2 + \\delta^2} + \\frac{\\alpha}{(\\xi+\\xi_t)^2 + \\delta^2}\n$$\n常数 $1$ 确保了一个基准的均匀网格，而类洛伦兹项在 $\\pm\\xi_t$ 附近增加了密度，其强度为 $\\alpha$，宽度由 $\\delta$ 控制。令 $G(\\xi) = \\int_{-1}^{\\xi} M(x) dx$。$M(\\xi)$ 的积分是解析的。对于 $\\xi_t \\neq 0$，它为：\n$$\nG(\\xi) = (\\xi+1) + \\frac{\\alpha}{\\delta} \\left[ \\arctan\\left(\\frac{\\xi-\\xi_t}{\\delta}\\right) - \\arctan\\left(\\frac{-1-\\xi_t}{\\delta}\\right) + \\arctan\\left(\\frac{\\xi+\\xi_t}{\\delta}\\right) - \\arctan\\left(\\frac{-1+\\xi_t}{\\delta}\\right) \\right]\n$$\n对于特殊情况 $\\xi_t = 0$，监控函数简化为 $M(\\xi) = 1 + 2\\alpha/(\\xi^2 + \\delta^2)$，其积分为 $G(\\xi) = (\\xi+1) + \\frac{2\\alpha}{\\delta} \\left[\\arctan\\left(\\frac{\\xi}{\\delta}\\right) - \\arctan\\left(\\frac{-1}{\\delta}\\right)\\right]$。为了找到每个网格点 $\\xi_i$，我们计算总积分 $G_{\\text{tot}} = G(1)$，并使用像 Brent-Dekker 方法这样的数值求根器来求解非线性方程 $G(\\xi_i) = \\frac{i}{N-1} G_{\\text{tot}}$ 以得到 $\\xi_i$，该方法对于单调函数 $G(\\xi)$ 很鲁棒。边界点固定为 $\\xi_0 = -1$ 和 $\\xi_{N-1} = 1$。\n\n第三，我们离散化 Lorentz 螺距角散射算子，其自伴形式为 $L(f) = \\frac{\\partial}{\\partial\\xi} \\left( D(\\xi) \\frac{\\partial f}{\\partial\\xi} \\right)$，其中扩散系数为 $D(\\xi) = \\nu_D (1-\\xi^2)/2$。为了分析离散算子的结构，我们可以设置碰撞频率 $\\nu_D=1$。为确保得到的矩阵是对称的、负半定的，并且守恒粒子（即零化常数向量），我们使用一种等效于线性有限元离散化的方法。这产生一个对称的三对角矩阵 $\\mathbf{L}$，其元素由下式给出：\n$$\nL_{i,i+1} = L_{i+1,i} = \\frac{D_{i+1/2}}{\\xi_{i+1}-\\xi_i} \\quad \\text{for } i=0, \\dots, N-2\n$$\n$$\nL_{i,i} = -(L_{i,i-1} + L_{i,i+1}) \\quad \\text{for } i=1, \\dots, N-2\n$$\n$$\nL_{0,0} = -L_{0,1} \\quad \\text{and} \\quad L_{N-1,N-1} = -L_{N-1,N-2}\n$$\n这里，$\\xi_{i+1/2} = (\\xi_i + \\xi_{i+1})/2$ 是网格单元的中点，而 $D_{i+1/2} = (1-\\xi_{i+1/2}^2)/2$。这种构造保证了每行的和为零，因此 $\\mathbf{L} \\cdot [1,1,\\dots,1]^T = \\mathbf{0}$，这意味着常数分布是一个稳态，对应于粒子数守恒。该矩阵通过构造是对称的。由于 $D(\\xi) \\ge 0$，非对角元素是非负的，对角元素是非正的，根据 Gershgorin 圆盘定理，这意味着所有特征值都是非正的（$\\lambda \\le 0$），从而确保了稳定性。\n\n最后，我们计算两个所需的度量。分辨率度量 $\\rho$ 是落在捕获-通行边界周围指定半宽 $w$ 窗口内的网格节点的比例。如果 $\\xi_t = 0$，我们计算 $[-w, w]$ 内的节点 $\\xi_i$。如果 $\\xi_t > 0$，我们计算 $[-\\xi_t-w, -\\xi_t+w] \\cup [\\xi_t-w, \\xi_t+w]$ 内的节点。结果是 $\\rho = (\\text{计数})/N$。第二个度量 $\\lambda_{\\max}$ 是矩阵 $\\mathbf{L}$ 的最大特征值。由于 $\\mathbf{L}$ 是实对称矩阵，其特征值是实数。我们用数值方法计算它们。理论上的最大特征值恰好为 $0$，对应于守恒量的零空间。数值结果应该非常接近 $0$。一个值 $\\lambda_{\\max} \\le 0$（在机器精度范围内）证实了离散化的稳定性。实现将通过执行这些步骤来处理每个测试用例 $(\\varepsilon, N, \\alpha, \\delta, w)$，并报告结果对 $[\\rho, \\lambda_{\\max}]$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    It orchestrates the grid generation, matrix construction, and metric calculation.\n    \"\"\"\n    test_cases = [\n        # (epsilon, N, alpha, delta, w)\n        (0.3, 81, 10.0, 1e-3, 0.02),\n        (0.0, 81, 10.0, 1e-3, 0.02),\n        (0.9, 81, 10.0, 1e-3, 0.02),\n        (0.3, 9, 10.0, 1e-3, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        eps, N, alpha, delta, w = case\n        \n        # Step 1: Determine trapped-passing boundary xi_t\n        xi_t = 0.0 if eps == 0.0 else np.sqrt(2.0 * eps / (1.0 + eps))\n\n        # Step 2: Construct the pitch-angle grid\n        xi_grid = generate_grid(N, xi_t, alpha, delta)\n\n        # Step 3: Compute resolution metric rho\n        rho = calculate_resolution_metric(xi_grid, N, xi_t, w)\n\n        # Step 4  5: Construct operator matrix and compute largest eigenvalue\n        lambda_max = construct_operator_and_get_max_eigenvalue(xi_grid, N)\n        \n        results.append(f\"[{rho:.6f},{lambda_max:.6f}]\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef generate_grid(N, xi_t, alpha, delta):\n    \"\"\"\n    Generates a nonuniform grid based on the equidistribution principle.\n    \n    Args:\n        N (int): Number of grid points.\n        xi_t (float): Trapped-passing boundary location.\n        alpha (float): Clustering strength parameter.\n        delta (float): Regularization parameter for the monitor function.\n        \n    Returns:\n        np.ndarray: The array of grid points xi.\n    \"\"\"\n    \n    if xi_t == 0.0:\n        def G(xi):\n            # Integral of monitor function for symmetric case xi_t = 0\n            term = (2 * alpha / delta) * (np.arctan(xi / delta) - np.arctan(-1.0 / delta))\n            return (xi + 1.0) + term\n    else:\n        def G(xi):\n            # Integral of monitor function for general case xi_t > 0\n            term1 = np.arctan((xi - xi_t) / delta) - np.arctan((-1.0 - xi_t) / delta)\n            term2 = np.arctan((xi + xi_t) / delta) - np.arctan((-1.0 + xi_t) / delta)\n            return (xi + 1.0) + (alpha / delta) * (term1 + term2)\n\n    G_total = G(1.0)\n    \n    xi_grid = np.zeros(N)\n    xi_grid[0] = -1.0\n    xi_grid[N - 1] = 1.0\n\n    for i in range(1, N - 1):\n        target_G = i * G_total / (N - 1)\n        # Define a function whose root is the desired grid point\n        # Using a lambda function to capture target_G\n        root_func = lambda x: G(x) - target_G\n        # Find the root in the interval (-1, 1)\n        xi_grid[i] = brentq(root_func, -1.0, 1.0)\n        \n    return xi_grid\n\ndef calculate_resolution_metric(xi_grid, N, xi_t, w):\n    \"\"\"\n    Calculates the fraction of grid points within a window around +/- xi_t.\n    \"\"\"\n    count = 0\n    if xi_t == 0.0:\n        # Single interval for the symmetric case\n        for xi in xi_grid:\n            if -w = xi = w:\n                count += 1\n    else:\n        # Two symmetric intervals for the general case\n        for xi in xi_grid:\n            if (-xi_t - w = xi = -xi_t + w) or (xi_t - w = xi = xi_t + w):\n                count += 1\n                \n    return count / N\n\ndef construct_operator_and_get_max_eigenvalue(xi_grid, N):\n    \"\"\"\n    Constructs the discrete Lorentz operator matrix and returns its largest eigenvalue.\n    \"\"\"\n    L = np.zeros((N, N))\n\n    for i in range(N - 1):\n        h_i = xi_grid[i+1] - xi_grid[i]\n        if h_i == 0: continue\n            \n        xi_half = 0.5 * (xi_grid[i] + xi_grid[i+1])\n        D_half = 0.5 * (1.0 - xi_half**2)\n        \n        c = D_half / h_i\n        \n        L[i, i+1] = c\n        L[i+1, i] = c\n    \n    # Set diagonal elements to ensure row sums are zero\n    for i in range(N):\n        L[i, i] = -np.sum(L[i, :])\n\n    # Eigenvalues of a real symmetric matrix are real. eigvalsh is efficient.\n    eigenvalues = np.linalg.eigvalsh(L)\n    \n    return np.max(eigenvalues)\n\nsolve()\n```"
        },
        {
            "introduction": "即使拥有一个结构精良的求解器，其结果也只有在物理和数值误差得到控制时才有效。本练习将建立一个模型来量化两种关键的误差来源：由有限粒子轨道宽度引起的物理平滑效应，以及由网格离散化引起的数值截断误差。通过应用该模型，我们可以建立一个实用标准，以判断在给定的输运机制下，模拟结果是否因误差过大而“被污染”。",
            "id": "4027985",
            "problem": "您的任务是编写一个完整的、可运行的程序，用于量化由有限轨道宽度效应引起的数值误差，并确定它们何时会污染 Pfirsch–Schlüter (PS) 和 plateau 输运计算。您的推导和算法必须基于引导中心理论、碰撞性和平滑剖面采样的第一性原理。该程序必须从第一性原理实现以下模型和决策逻辑。\n\n使用的基本依据和定义：\n- 离子热速度：$v_{\\mathrm{th}} = \\sqrt{\\frac{2 e T_i}{m_i}}$，其中 $e$ 是基本电荷，$T_i$ 是离子温度，以电子伏特为单位表示，通过 $e$ 转换为焦耳的每个粒子的能量。\n- 离子回旋频率：$\\Omega_i = \\frac{Z e B}{m_i}$，电荷态 $Z=1$。\n- 离子拉莫尔半径：$\\rho_i = \\frac{v_{\\mathrm{th}}}{\\Omega_i}$。\n- 磁漂移速度标度：$v_d = \\frac{v_{\\mathrm{th}} \\rho_i}{R}$，其中 $R$ 是大半径。\n- 碰撞参数：$\\nu^\\ast = \\frac{\\nu q R}{v_{\\mathrm{th}}}$，其中 $\\nu$ 是碰撞频率，$q$ 是安全因子。\n- 碰撞间的有效轨道宽度：$w = \\frac{v_d}{\\nu} = \\frac{q}{\\nu^\\ast} \\rho_i$。\n\n平滑指数径向剖面的误差模型：\n- 假设输运的标量剖面 $g(r)$ 是平滑且局部呈指数形式的，$g(r) = g_0 \\exp(-r/L)$，因此 $|g'''(r)/g'(r)| = 1/L^2$，其中 $L$ 是局部梯度标长。\n- 有限轨道宽度平滑由一个零均值、方差为 $\\sigma^2 = w^2/2$ 的对称高斯核表示。这种平滑在梯度驱动系数中引起的主导阶相对误差为 $E_{\\mathrm{smooth}} = \\frac{\\sigma^2}{2} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{w^2}{4 L^2}$。\n- 在间距为 $\\delta r$ 的均匀网格上，标准的二阶中心差分数值导数具有主导截断误差 $E_{\\mathrm{disc}} = \\frac{\\delta r^2}{6} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{\\delta r^2}{6 L^2}$。\n- 总相对误差：$E_{\\mathrm{tot}} = E_{\\mathrm{smooth}} + E_{\\mathrm{disc}} = \\frac{w^2}{4 L^2} + \\frac{\\delta r^2}{6 L^2}$。\n\n区域分类：\n- 计算反环径比 $\\epsilon = a/R$，其中 $a$ 是小半径。\n- 使用碰撞参数对区域进行分类：如果 $\\nu^\\ast \\ge \\frac{1}{\\epsilon}$，则为 Pfirsch–Schlüter (PS) 区；如果 $1 \\le \\nu^\\ast  \\frac{1}{\\epsilon}$，则为 plateau 区。\n- 如果 $\\nu^\\ast  1$，不要更改分类逻辑；在此问题中，所有测试用例的选择都保证 $\\nu^\\ast \\ge 1$。\n\n污染判定：\n- 根据可接受的渐近排序余量定义特定区域的污染阈值：$\\tau_{\\mathrm{PS}} = 0.01$ 和 $\\tau_{\\mathrm{pl}} = 0.02$。\n- 如果 $E_{\\mathrm{tot}} \\ge \\tau_{\\mathrm{regime}}$，则计算被视为“受污染”，其中 $\\tau_{\\mathrm{regime}}$ 在 PS 区为 $\\tau_{\\mathrm{PS}}$，在 plateau 区为 $\\tau_{\\mathrm{pl}}$。\n\n输入参数和单位：\n- 磁场 $B$ 单位为 $\\mathrm{T}$。\n- 大半径 $R$ 单位为 $\\mathrm{m}$。\n- 小半径 $a$ 单位为 $\\mathrm{m}$。\n- 安全因子 $q$ 无量纲。\n- 离子质量 $m_i$ 单位为 $\\mathrm{kg}$。\n- 离子温度 $T_i$ 单位为 $\\mathrm{eV}$。\n- 碰撞频率 $\\nu$ 单位为 $\\mathrm{s}^{-1}$。\n- 梯度标长 $L$ 单位为 $\\mathrm{m}$。\n- 网格间距 $\\delta r$ 单位为 $\\mathrm{m}$。\n所有计算都必须使用国际单位制 (SI)，温度通过基本电荷 $e$ 从 $\\mathrm{eV}$ 转换为焦耳。\n\n测试套件：\n使用以下五组参数集来评估您的程序。每个元组为 $(B, R, a, q, m_i, T_i, \\nu, L, \\delta r)$，单位如上所述。\n1. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{6}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.01\\,\\mathrm{m})$\n2. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.02\\,\\mathrm{m})$\n3. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.12\\,\\mathrm{m})$\n4. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,0.9\\,\\mathrm{m},\\,4.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,3.6\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.1\\,\\mathrm{m},\\,0.05\\,\\mathrm{m})$\n5. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,2.68\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.5\\,\\mathrm{m},\\,0.02\\,\\mathrm{m})$\n\n最终输出规范：\n- 对于每个测试用例，输出一个三元素列表 $[r, c, e]$，其中 $r$ 是一个整数区域代码（$0$ 代表 PS，$1$ 代表 plateau），$c$ 是一个指示是否污染的布尔值，$e$ 是四舍五入到六位小数的总相对误差 $E_{\\mathrm{tot}}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素都是一个这样的三元素列表。例如：$[[0,False,0.000123],[1,True,0.025678],\\ldots]$。",
            "solution": "该问题被认为是有效的，因为它在科学上基于等离子体物理和数值分析的既定原理，其定义和数据完整一致，问题设定良好，并且表述客观。所有提供的信息足以推导出每个测试用例的唯一解。我们现在将进行基于原理的推导和求解。\n\n目标是为几组等离子体参数确定输运区域（Pfirsch-Schlüter 或 Plateau）、结合了物理和数值效应的总相对误差，以及此误差是否超过特定区域的污染阈值。分析过程是通过基于提供的输入计算一系列中间物理量来进行的。\n\n对于每个参数集 $(B, R, a, q, m_i, T_i, \\nu, L, \\delta r)$ 的处理过程如下：\n\n1.  **基本常数和单位转换**：所有计算必须以 SI 单位进行。离子温度 $T_i$ 以电子伏特 ($\\mathrm{eV}$) 给出，必须通过乘以基本电荷 $e \\approx 1.602176634 \\times 10^{-19} \\, \\mathrm{C}$ 转换为焦耳 ($\\mathrm{J}$)。以焦耳为单位的离子温度表示为 $T_{i,J} = T_i \\times e$。\n\n2.  **离子热速度和回旋频率**：特征离子热速度 $v_{\\mathrm{th}}$ 源于离子的动能。\n    $$\n    v_{\\mathrm{th}} = \\sqrt{\\frac{2 T_{i,J}}{m_i}} = \\sqrt{\\frac{2 e T_i}{m_i}}\n    $$\n    离子回旋频率 $\\Omega_i$ 表示离子在磁场 $B$ 中回旋运动的角频率。对于质量为 $m_i$、电荷态为 $Z=1$ 的离子，其计算公式为：\n    $$\n    \\Omega_i = \\frac{Z e B}{m_i} = \\frac{e B}{m_i}\n    $$\n\n3.  **离子拉莫尔半径**：离子拉莫尔半径 $\\rho_i$ 是离子绕磁力线回旋的圆周运动半径。它是热速度与回旋频率之比。\n    $$\n    \\rho_i = \\frac{v_{\\mathrm{th}}}{\\Omega_i}\n    $$\n\n4.  **碰撞参数和输运区域分类**：新经典输运区域由无量纲碰撞参数 $\\nu^\\ast$ 决定。它比较了捕获粒子的有效碰撞频率与其弹跳频率。其定义为：\n    $$\n    \\nu^\\ast = \\frac{\\nu q R}{v_{\\mathrm{th}}}\n    $$\n    区域分类取决于将 $\\nu^\\ast$ 与反环径比 $\\epsilon = a/R$ 进行比较，其中 $a$ 是小半径。\n    - 如果 $\\nu^\\ast \\ge \\frac{1}{\\epsilon}$，等离子体处于 **Pfirsch–Schlüter (PS) 区**。分配区域代码为 $0$。\n    - 如果 $1 \\le \\nu^\\ast  \\frac{1}{\\epsilon}$，等离子体处于 **Plateau 区**。分配区域代码为 $1$。\n\n5.  **有效轨道宽度**：有限轨道宽度效应源于离子引导中心轨迹偏离磁通量面。这种偏离的特征宽度由磁漂移速度 $v_d$ 驱动并受限于碰撞。磁漂移速度的标度为 $v_d \\approx v_{\\mathrm{th}} \\rho_i / R$。两次碰撞之间的有效轨道宽度 $w$ 是离子在一次碰撞时间 $1/\\nu$ 内漂移的距离：\n    $$\n    w = \\frac{v_d}{\\nu}\n    $$\n    使用提供的定义，我们可以将其表示为：\n    $$\n    w = \\frac{(v_{\\mathrm{th}} \\rho_i / R)}{\\nu} = \\frac{v_{\\mathrm{th}} \\rho_i}{\\nu R}\n    $$\n    使用碰撞参数的更方便的表达式如下：\n    $$\n    w = \\frac{q}{\\nu^\\ast} \\rho_i\n    $$\n\n6.  **误差计算**：总相对误差 $E_{\\mathrm{tot}}$ 是两部分贡献之和：由有限轨道宽度效应引起的物理平滑误差 $E_{\\mathrm{smooth}}$ 和数值离散化误差 $E_{\\mathrm{disc}}$。\n\n    问题将有限轨道宽度效应建模为方差为 $\\sigma^2 = w^2/2$ 的高斯平滑核。对于局部指数剖面 $g(r) \\propto \\exp(-r/L)$，三阶导数与一阶导数之比为 $|g'''(r)/g'(r)| = 1/L^2$。由此产生的主导阶平滑误差为：\n    $$\n    E_{\\mathrm{smooth}} = \\frac{\\sigma^2}{2} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{w^2/2}{2} \\left(\\frac{1}{L^2}\\right) = \\frac{w^2}{4 L^2}\n    $$\n    离散化误差源于使用有限差分格式来近似连续导数。对于间距为 $\\delta r$ 的网格上的标准二阶中心差分，其主导截断误差为：\n    $$\n    E_{\\mathrm{disc}} = \\frac{\\delta r^2}{6} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{\\delta r^2}{6 L^2}\n    $$\n    总相对误差是这两个分量的和：\n    $$\n    E_{\\mathrm{tot}} = E_{\\mathrm{smooth}} + E_{\\mathrm{disc}} = \\frac{w^2}{4 L^2} + \\frac{\\delta r^2}{6 L^2}\n    $$\n\n7.  **污染判定**：如果总误差 $E_{\\mathrm{tot}}$ 超过特定区域的阈值，则该计算被视为“受污染”。阈值定义为 Pfirsch–Schlüter 区的 $\\tau_{\\mathrm{PS}} = 0.01$ 和 plateau 区的 $\\tau_{\\mathrm{pl}} = 0.02$。\n    - 设 $\\tau_{\\mathrm{regime}}$ 为所确定区域的相应阈值。\n    - 如果 $E_{\\mathrm{tot}} \\ge \\tau_{\\mathrm{regime}}$，则污染状态为 'True'，否则为 'False'。\n\n8.  **最终输出格式**：对于每个输入测试用例，结果是一个三元素列表：`[regime_code, contamination_status, E_tot]`。区域代码是一个整数（PS 为 $0$，plateau 为 $1$），污染状态是一个布尔值，总误差 $E_{\\mathrm{tot}}$ 是一个四舍五入到六位小数的浮点数。\n\n这个完整的顺序逻辑将在提供的 Python 程序中实现，以处理测试套件并生成最终输出。",
            "answer": "```python\nimport numpy as np\n\n# A solver agent that generates a solution and final answer for a given problem.\n# This program quantifies numerical errors in fusion transport calculations.\n\ndef solve():\n    \"\"\"\n    Calculates the transport regime, total relative error, and contamination\n    status for a series of tokamak plasma parameter sets.\n    \"\"\"\n    # Define physical constants\n    ELEMENTARY_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\n\n    # Regime-specific contamination thresholds\n    TAU_PS = 0.01  # Threshold for Pfirsch-Schlüter regime\n    TAU_PL = 0.02  # Threshold for Plateau regime\n\n    # Test suite: Each tuple is (B, R, a, q, m_i, T_i, nu, L, dr)\n    # Units: B(T), R(m), a(m), q(dimless), m_i(kg), T_i(eV), nu(s^-1), L(m), dr(m)\n    test_cases = [\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e6, 0.3, 0.01),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e5, 0.3, 0.02),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e5, 0.3, 0.12),\n        (3.0, 3.0, 0.9, 4.0, 3.343583719e-27, 3000, 3.6e5, 0.1, 0.05),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 2.68e5, 0.5, 0.02),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        B, R, a, q, m_i, T_i_eV, nu, L, dr = case\n\n        # 1. Unit conversion\n        T_i_J = T_i_eV * ELEMENTARY_CHARGE\n\n        # 2. Calculate fundamental plasma parameters\n        v_th = np.sqrt(2 * T_i_J / m_i)\n        Z = 1  # Charge state\n        Omega_i = (Z * ELEMENTARY_CHARGE * B) / m_i\n        rho_i = v_th / Omega_i\n\n        # 3. Calculate collisionality and classify regime\n        nu_star = (nu * q * R) / v_th\n        epsilon = a / R\n        regime_boundary = 1 / epsilon\n\n        if nu_star >= regime_boundary:\n            regime_code = 0  # Pfirsch-Schlüter\n            threshold = TAU_PS\n        elif 1 = nu_star  regime_boundary:\n            regime_code = 1  # Plateau\n            threshold = TAU_PL\n        else:\n            # Per problem statement, all cases are chosen such that nu_star >= 1\n            # This branch handles cases outside the specified bounds if they were to occur.\n            # For this problem, it will not be entered.\n            # Assign a default or error state if needed for a more general case.\n            # Here, we follow the closest boundary rule.\n            if nu_star  1:\n                regime_code = 1 \n                threshold = TAU_PL\n                \n        # 4. Calculate effective orbit width\n        w = (q / nu_star) * rho_i\n\n        # 5. Calculate error components\n        L_sq = L**2\n        E_smooth = (w**2) / (4 * L_sq)\n        E_disc = (dr**2) / (6 * L_sq)\n        E_tot = E_smooth + E_disc\n\n        # 6. Make contamination decision\n        is_contaminated = E_tot >= threshold\n\n        # 7. Format result for this case\n        # Output: [regime_code, is_contaminated, E_tot_rounded]\n        results.append(f\"[{regime_code},{is_contaminated},{E_tot:.6f}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}