{
    "hands_on_practices": [
        {
            "introduction": "第一个动手实践将我们从理论的探讨带入具体的计算中。我们将逐步完成不连续伽辽金谱元法（DGSEM）中的几个核心步骤：从推导特定的求积法则，到组装质量矩阵，再到在弯曲边界上计算通量积分。这项练习将突显DGSEM方法的精妙与高效，特别是当基函数节点与求积点重合时，能够实现“质量集中”（mass lumping）这一重要特性。",
            "id": "3967527",
            "problem": "在一个与计算聚变科学与工程相关的高阶间断伽辽金 (DG) 离散化的等离子体偏微分方程 (PDE) 中，考虑一个一维参考单元 $\\hat{K}=[-1,1]$，其节点拉格朗日基的多项式阶数为 $p=2$。选择节点与高斯-洛巴托-勒让德 (GLL) 求积节点重合，并在间断伽辽金谱元法 (DGSEM) 中使用相同的 GLL 法则来组装单元积分。\n\n任务1 (参考单元上的 GLL 求积)：从 GLL 求积的定义性质出发——即包含区间的端点，并且对于 $N$ 个节点的多项式，其精确度达到 $2N-3$ 阶——推导在 $\\hat{K}=[-1,1]$ 上，当 $p=2$ (因此 $N=p+1=3$) 时的节点和权重。不要引用预先制定的公式；而是通过使用阶数为 $p$ 的勒让德多项式的导数来确定内部节点，并通过对单项式强制精确性来确定权重。\n\n任务2 (DGSEM 质量矩阵组装)：设 $\\{\\ell_i(s)\\}_{i=0}^{2}$ 是在 $\\hat{K}$ 上的 GLL 节点上建立的节点拉格朗日基。使用任务1中的 GLL 求积来近似积分，组装基于求积的单元质量矩阵 $\\mathbf{M}$，其矩阵元为\n$$\nM_{ij}\\equiv \\int_{-1}^{1}\\ell_i(s)\\,\\ell_j(s)\\,\\mathrm{d}s\n$$\n该积分由任务1中的 GLL 法则近似。计算 $\\det(\\mathbf{M})$。\n\n任务3 (与 DG 通量相关的弯曲几何上的面积分)：考虑托卡马克装置极向截面中的一个弯曲边界段 $\\Gamma$，其模型为半径为 $R$、圆心角为 $\\Theta$ (以弧度计) 的圆弧，弧长 $L=R\\,\\Theta$。设从参考坐标 $s\\in[-1,1]$到 $\\Gamma$ 的映射由弧长参数化，使得几何雅可比为常数，$J_{\\Gamma}(s)=\\left|\\frac{\\mathrm{d}\\boldsymbol{r}}{\\mathrm{d}s}\\right|=\\frac{L}{2}$。假设由回旋动理学边界算子的多项式重构产生的垂直于 $\\Gamma$ 的数值通量密度在 $\\Gamma$ 上近似为\n$$\nq(s)=\\alpha+\\beta\\,s+\\gamma\\,s^{2},\n$$\n系数为 $\\alpha=\\frac{5}{4}$，$\\beta=-\\frac{3}{2}$，以及 $\\gamma=\\frac{7}{6}$。在 $s$ 上使用与任务1中相同的 $N=3$ GLL 求积，计算面积分\n$$\nI\\equiv \\int_{\\Gamma} q\\,\\mathrm{d}\\sigma \\;=\\;\\int_{-1}^{1} q(s)\\,J_{\\Gamma}(s)\\,\\mathrm{d}s.\n$$\n你可以假设 $R0$ 和 $\\Theta0$ 在物理上是现实的，但必要时答案必须以 $L$ 的符号形式表示。\n\n最终需要报告的量：计算\n$$\nS\\equiv \\det(\\mathbf{M})+\\frac{I}{L}.\n$$\n将你的最终答案表示为一个无单位的最简有理数。无需四舍五入。角度以弧度为单位。",
            "solution": "在尝试任何解答之前，对问题陈述进行了严格验证。\n\n### 步骤1：提取已知条件\n- **背景**：用于计算聚变科学与工程中等离子体偏微分方程 (PDE) 的间断伽辽金 (DG) 离散化。\n- **参考单元**：$\\hat{K} = [-1,1]$。\n- **多项式阶数**：$p=2$。\n- **基**：节点拉格朗日基。\n- **求积节点**：高斯-洛巴托-勒让德 (GLL) 节点。\n- **节点数**：$N = p+1 = 3$。\n- **积分法则**：与 $N=3$ 节点对应的 GLL 求积。\n- **方法**：间断伽辽金谱元法 (DGSEM)。\n\n- **任务1：GLL 求积推导**\n  - 推导在 $\\hat{K}=[-1,1]$ 上 $N=3$ GLL 求积的节点和权重。\n  - GLL 性质：包含端点 $[-1,1]$；对阶数不超过 $2N-3$ 的多项式精确。\n  - 节点推导方法：内部节点是阶数为 $p=2$ 的勒让德多项式导数，即 $P_2'(s)$ 的根。\n  - 权重推导方法：对单项式强制精确性。\n\n- **任务2：质量矩阵组装**\n  - 基函数：在 GLL 节点上构建的节点拉格朗日基 $\\{\\ell_i(s)\\}_{i=0}^{2}$。\n  - 质量矩阵定义：$M_{ij} \\equiv \\int_{-1}^{1}\\ell_i(s)\\,\\ell_j(s)\\,\\mathrm{d}s$。\n  - 组装方法：使用任务1中的 GLL 求积来近似积分。\n  - 要求计算：$\\det(\\mathbf{M})$。\n\n- **任务3：面积分计算**\n  - 几何：半径为 $R$、圆心角为 $\\Theta$、弧长为 $L=R\\Theta$ 的圆弧 $\\Gamma$。\n  - 映射：从参考坐标 $s \\in [-1,1]$到 $\\Gamma$。\n  - 雅可比：常数，$J_{\\Gamma}(s) = \\frac{L}{2}$。\n  - 通量函数：$q(s) = \\alpha+\\beta\\,s+\\gamma\\,s^2$。\n  - 系数：$\\alpha=\\frac{5}{4}$，$\\beta=-\\frac{3}{2}$，$\\gamma=\\frac{7}{6}$。\n  - 积分定义：$I \\equiv \\int_{\\Gamma} q\\,\\mathrm{d}\\sigma = \\int_{-1}^{1} q(s)\\,J_{\\Gamma}(s)\\,\\mathrm{d}s$。\n  - 积分方法：使用任务1中的 $N=3$ GLL 求积。\n\n- **最终量**：$S \\equiv \\det(\\mathbf{M})+\\frac{I}{L}$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n- **科学依据**：该问题在数值方法理论，特别是使用谱元和高斯-洛巴托-勒让德求积的间断伽辽金方法中，有坚实的基础。这些是计算科学与工程中广泛使用的标准技术，包括用于聚变研究中的等离子体物理模拟。所有概念在数学上都是合理的。\n- **良构性**：问题被构造成一系列明确定义的任务。每个任务都有明确的目标和足够的信息以获得唯一解。最终量 $S$ 是各任务结果的确定性组合。\n- **客观性**：问题以精确、客观的数学语言陈述。没有歧义、主观性或意见。\n- **一致性与完整性**：所提供的信息是自洽且充分的。阶数 $p=2$ 正确地意味着 $N=3$ 个节点。推导求积法则和组装矩阵的方法已明确规定。所有必要的系数和函数都已定义。\n- **现实性**：该设置是 DG 代码中执行的计算的一个标准（尽管简化了）的表示。使用一维参考单元、GLL 节点、拉格朗日基以及用于质量和通量积分的数值求积是经典的。对于按其归一化长度参数化的弧，常数雅可比是一个有效的简化。\n\n### 步骤3：结论与行动\n问题是**有效的**，因为它是科学上合理的、良构的、客观的和自洽的。现在开始求解过程。\n\n#### 任务1：$p=2$ ($N=3$) 的 GLL 求积推导\n\n对于多项式阶数 $p=2$，GLL 节点数为 $N=p+1=3$。参考区间 $[-1,1]$ 上的 GLL 节点包括端点 $s=-1$ 和 $s=1$，以及作为阶数为 $p$ 的勒让德多项式导数的根的内部节点。这里，$p=2$。\n\n阶数为 $p=2$ 的勒让德多项式是 $P_2(s) = \\frac{1}{2}(3s^2-1)$。\n其导数是 $P_2'(s) = 3s$。\n令导数为零，$3s=0$，得到唯一的内部根 $s=0$。\n因此，三个 GLL 节点是 $s_0 = -1$，$s_1 = 0$ 和 $s_2 = 1$。\n\n求积法则是 $\\int_{-1}^{1} f(s)\\,\\mathrm{d}s \\approx \\sum_{i=0}^{2} w_i f(s_i)$。对于 $N=3$ 个节点，该法则必须对所有阶数不超过 $2N-3 = 2(3)-3 = 3$ 的多项式都精确。我们对单项式基 $\\{1, s, s^2\\}$ 强制施加此条件来找到权重 $w_0, w_1, w_2$。\n\n对于 $f(s)=1$：\n$\\int_{-1}^{1} 1\\,\\mathrm{d}s = 2$。\n求积和为 $w_0 f(s_0) + w_1 f(s_1) + w_2 f(s_2) = w_0(1) + w_1(1) + w_2(1) = w_0+w_1+w_2$。\n所以，$w_0+w_1+w_2 = 2$。\n\n对于 $f(s)=s$：\n$\\int_{-1}^{1} s\\,\\mathrm{d}s = 0$。\n求积和为 $w_0(-1) + w_1(0) + w_2(1) = -w_0+w_2$。\n所以，$-w_0+w_2 = 0 \\implies w_0 = w_2$。\n\n对于 $f(s)=s^2$：\n$\\int_{-1}^{1} s^2\\,\\mathrm{d}s = \\left[\\frac{s^3}{3}\\right]_{-1}^{1} = \\frac{1}{3} - (-\\frac{1}{3}) = \\frac{2}{3}$。\n求积和为 $w_0(-1)^2 + w_1(0)^2 + w_2(1)^2 = w_0+w_2$。\n所以，$w_0+w_2 = \\frac{2}{3}$。\n\n我们现在求解以下线性方程组：\n1. $w_0+w_1+w_2 = 2$\n2. $w_0 = w_2$\n3. $w_0+w_2 = \\frac{2}{3}$\n\n从(2)和(3)，我们得到 $2w_0 = \\frac{2}{3}$，这给出 $w_0=\\frac{1}{3}$。因此，$w_2=\\frac{1}{3}$。\n将这些代入(1)：$\\frac{1}{3} + w_1 + \\frac{1}{3} = 2 \\implies w_1 = 2 - \\frac{2}{3} = \\frac{4}{3}$。\n$N=3$ 的 GLL 求积节点和权重是：\n节点：$s_0=-1, s_1=0, s_2=1$。\n权重：$w_0=\\frac{1}{3}, w_1=\\frac{4}{3}, w_2=\\frac{1}{3}$。\n\n#### 任务2：DGSEM 质量矩阵组装\n\n单元质量矩阵的矩阵元使用 GLL 求积近似：\n$M_{ij} = \\int_{-1}^{1}\\ell_i(s)\\,\\ell_j(s)\\,\\mathrm{d}s \\approx \\sum_{k=0}^{2} w_k \\ell_i(s_k) \\ell_j(s_k)$。\n节点拉格朗日基函数 $\\{\\ell_i(s)\\}_{i=0}^2$ 由性质 $\\ell_i(s_j) = \\delta_{ij}$ 定义，其中 $\\delta_{ij}$ 是克罗内克 δ。\n\n利用此性质，求和可以大大简化。乘积 $\\ell_i(s_k)\\ell_j(s_k)$ 仅在 $k=i$ 且 $k=j$ 时非零。这只可能在 $i=j$ 时发生。\n如果 $i \\neq j$，$M_{ij} \\approx \\sum_{k=0}^{2} w_k (0) = 0$。\n如果 $i = j$，求和中只有一个非零项，出现在 $k=i$ 时：\n$M_{ii} \\approx \\sum_{k=0}^{2} w_k \\ell_i(s_k) \\ell_i(s_k) = w_i (\\ell_i(s_i))^2 = w_i(1)^2 = w_i$。\n\n因此，基于求积的质量矩阵 $\\mathbf{M}$ 是一个对角矩阵，其对角元是求积权重。这被称为质量集中 (mass lumping)，是 DGSEM 的一个关键特性。\n$$\n\\mathbf{M} = \n\\begin{pmatrix}\nw_0  0  0 \\\\\n0  w_1  0 \\\\\n0  0  w_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{1}{3}  0  0 \\\\\n0  \\frac{4}{3}  0 \\\\\n0  0  \\frac{1}{3}\n\\end{pmatrix}\n$$\n这个对角矩阵的行列式是其对角元素的乘积：\n$\\det(\\mathbf{M}) = w_0 w_1 w_2 = \\left(\\frac{1}{3}\\right) \\left(\\frac{4}{3}\\right) \\left(\\frac{1}{3}\\right) = \\frac{4}{27}$。\n\n#### 任务3：面积分计算\n\n需要计算的积分是 $I = \\int_{-1}^{1} q(s)\\,J_{\\Gamma}(s)\\,\\mathrm{d}s$。我们已知 $J_{\\Gamma}(s) = \\frac{L}{2}$。\n被积函数是 $q(s)J_{\\Gamma}(s) = \\frac{L}{2}(\\alpha+\\beta s+\\gamma s^2)$，这是一个二次多项式。由于 $N=3$ 的 GLL 法则对阶数不超过3的多项式是精确的，因此求积得到的是精确的积分值。\n$I = \\sum_{k=0}^{2} w_k q(s_k) J_{\\Gamma}(s_k) = \\frac{L}{2} \\sum_{k=0}^{2} w_k q(s_k)$。\n\n通量函数是 $q(s) = \\frac{5}{4} - \\frac{3}{2}s + \\frac{7}{6}s^2$。我们在 GLL 节点上计算它的值：\n$q(s_0) = q(-1) = \\frac{5}{4} - \\frac{3}{2}(-1) + \\frac{7}{6}(-1)^2 = \\frac{5}{4} + \\frac{3}{2} + \\frac{7}{6} = \\frac{15+18+14}{12} = \\frac{47}{12}$。\n$q(s_1) = q(0) = \\frac{5}{4}$。\n$q(s_2) = q(1) = \\frac{5}{4} - \\frac{3}{2}(1) + \\frac{7}{6}(1)^2 = \\frac{5}{4} - \\frac{3}{2} + \\frac{7}{6} = \\frac{15-18+14}{12} = \\frac{11}{12}$。\n\n现在，我们计算这个和：\n$\\sum_{k=0}^{2} w_k q(s_k) = w_0 q(s_0) + w_1 q(s_1) + w_2 q(s_2)$\n$= \\frac{1}{3}\\left(\\frac{47}{12}\\right) + \\frac{4}{3}\\left(\\frac{5}{4}\\right) + \\frac{1}{3}\\left(\\frac{11}{12}\\right)$\n$= \\frac{47}{36} + \\frac{20}{12} + \\frac{11}{36} = \\frac{47}{36} + \\frac{60}{36} + \\frac{11}{36} = \\frac{47+60+11}{36} = \\frac{118}{36} = \\frac{59}{18}$。\n\n所以，积分 $I$ 是：\n$I = \\frac{L}{2} \\left(\\frac{59}{18}\\right) = \\frac{59L}{36}$。\n\n问题要求计算量 $\\frac{I}{L}$：\n$\\frac{I}{L} = \\frac{1}{L}\\left(\\frac{59L}{36}\\right) = \\frac{59}{36}$。\n\n#### 最终量计算\n\n最终任务是计算 $S \\equiv \\det(\\mathbf{M})+\\frac{I}{L}$。\n使用前面任务的结果：\n$S = \\frac{4}{27} + \\frac{59}{36}$。\n为了将这些分数相加，我们找到分母 $27 = 3^3$ 和 $36 = 2^2 \\times 3^2$ 的最小公倍数。最小公倍数是 $2^2 \\times 3^3 = 4 \\times 27 = 108$。\n$S = \\frac{4 \\times 4}{27 \\times 4} + \\frac{59 \\times 3}{36 \\times 3} = \\frac{16}{108} + \\frac{177}{108}$。\n$S = \\frac{16 + 177}{108} = \\frac{193}{108}$。\n分子 $193$ 是一个质数，所以这个分数是最简形式。",
            "answer": "$$\\boxed{\\frac{193}{108}}$$"
        },
        {
            "introduction": "高阶DG方法在提供卓越精度的同时，也带来了新的数值挑战。本实践将深入探讨矩阵条件数这一关键问题，它直接影响求解器的鲁棒性和性能。通过分析模态勒让德基下的质量矩阵，我们将揭示其条件数如何随着多项式次数 $p$ 的增加而恶化，并推导一种对角缩放策略来改善此问题，从而深刻理解显式时间积分格式的稳定性约束。",
            "id": "3967498",
            "problem": "考虑在一维周期性区间 $\\Omega = [0,L]$ 上，具有恒定速度 $a0$ 的一维线性平流方程 $\\partial_{t} u + a \\,\\partial_{x} u = 0$。将 $\\Omega$ 划分为一个由 $N$ 个长度为 $h = L/N$ 的单元组成的均匀网格。在每个单元上，使用一个 $p$次间断 Galerkin (DG) 方法来近似 $u$。该方法采用模态 Legendre 多项式基，并通过仿射映射 $x(\\xi) = x_{e} + \\frac{h}{2} \\,\\xi$ 从参考区间 $[-1,1]$ 映射到每个物理单元，其中 $x_{e}$ 表示单元中心，$\\xi \\in [-1,1]$ 是参考坐标。设试验空间和测试空间由集合 $\\{\\phi_{n}(\\xi)\\}_{n=0}^{p}$ 张成，其中每个 $\\phi_{n}$ 是 $n$ 次的映射后 Legendre 多项式。\n\n在交界面处使用带有迎风数值通量的标准 DG 弱形式。设单元局部质量矩阵 $M$ 和体刚度贡献 $K_{v}$ 定义为 $M_{mn} = \\int_{K} \\phi_{m}(x) \\,\\phi_{n}(x) \\,\\mathrm{d}x$ 和 $(K_{v})_{mn} = \\int_{K} \\phi_{m}(x) \\, a\\,\\partial_{x}\\phi_{n}(x) \\,\\mathrm{d}x$，其中 $K$ 表示单个物理单元。来自迎风通量的交界面（表面）贡献会产生附加项，已知对于高多项式次数 $p$，这些项与 $a/h$ 成比例。\n\n从 Legendre 多项式的基本性质和 DG 变分形式出发，分析当多项式次数 $p$ 很大时单元局部质量矩阵 $M$ 的条件数。然后，提出一种对角模态缩放策略 $D = \\mathrm{diag}(s_{0}, s_{1}, \\dots, s_{p})$，使得在每个单元上，缩放后的质量矩阵 $D M D$ 等于单位矩阵。在 $p$ 的主阶渐近性层面上，讨论这种缩放如何影响组合刚度贡献（包括 $K_{v}$ 和迎风表面项）的谱范数，并将其与使用 Gauss–Lobatto 求积的节点基中的质量集中效应进行对比。\n\n你的最终答案必须是关于对角缩放因子 $s_{n}$ 的单个闭式解析表达式，用 $n$ 和 $h$ 表示，该表达式使得在每个单元上 $D M D = I$。不需要任何数值。",
            "solution": "问题要求分析使用模态 Legendre 基的间断 Galerkin (DG) 方法的质量矩阵条件数，推导用于正交化基的对角缩放，并讨论其对系统刚度算子的影响。\n\n设参考区间为 $\\xi \\in [-1, 1]$。标准 Legendre 多项式（记为 $P_n(\\xi)$）在该区间上关于 $L^2$ 内积是正交的。其关键的正交性质由下式给出：\n$$\n\\int_{-1}^{1} P_m(\\xi) P_n(\\xi) \\, \\mathrm{d}\\xi = \\frac{2}{2n+1} \\delta_{mn}\n$$\n其中 $\\delta_{mn}$ 是 Kronecker delta。\n\n问题指出，在长度为 $h$ 的单元 $K$ 上的物理基函数是映射后的 Legendre 多项式。设物理坐标为 $x \\in K$。从参考坐标 $\\xi$ 到物理坐标 $x$ 的仿射映射为 $x(\\xi) = x_e + \\frac{h}{2}\\xi$，其中 $x_e$ 是单元中心。微分映射为 $\\mathrm{d}x = \\frac{h}{2}\\mathrm{d}\\xi$。物理单元 $K$ 上的基函数为 $\\phi_n(x) = P_n(\\xi(x))$。\n\n首先，我们计算单元局部质量矩阵 $M$ 的元素。其定义为：\n$$\nM_{mn} = \\int_{K} \\phi_m(x) \\phi_n(x) \\, \\mathrm{d}x\n$$\n我们从物理坐标 $x$ 换元到参考坐标 $\\xi$：\n$$\nM_{mn} = \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) \\left(\\frac{h}{2}\\right) \\mathrm{d}\\xi\n$$\n使用 Legendre 多项式的正交性，我们得到：\n$$\nM_{mn} = \\frac{h}{2} \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) \\, \\mathrm{d}\\xi = \\frac{h}{2} \\left( \\frac{2}{2n+1} \\delta_{mn} \\right) = \\frac{h}{2n+1} \\delta_{mn}\n$$\n这个结果表明，对于模态 Legendre 基，质量矩阵 $M$ 内在地是对角的。其对角元素为 $M_{nn} = \\frac{h}{2n+1}$，其中 $n \\in \\{0, 1, \\dots, p\\}$。\n\n接下来，我们分析当多项式次数 $p$ 很大时 $M$ 的条件数。由于 $M$ 是一个对角矩阵，其特征值就是其对角元素，即 $\\lambda_n = M_{nn} = \\frac{h}{2n+1}$。在 2-范数下的条件数 $\\kappa_2(M)$ 是最大特征值与最小特征值的比值。\n最大特征值对应于 $n=0$：\n$$\n\\lambda_{\\max} = \\lambda_0 = \\frac{h}{2(0)+1} = h\n$$\n最小特征值对应于 $n=p$：\n$$\n\\lambda_{\\min} = \\lambda_p = \\frac{h}{2p+1}\n$$\n因此条件数为：\n$$\n\\kappa_2(M) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{h}{h/(2p+1)} = 2p+1\n$$\n对于 $p$ 较大的高阶方法，条件数随 $p$ 线性增长，即 $\\kappa_2(M) = O(p)$。这表明随着多项式次数的增加，质量矩阵变得越来越病态，这会给求解包含 $M$ 的线性系统带来问题。\n\n接着，问题要求找到一种对角缩放策略，使得质量矩阵等于单位矩阵。设 $D = \\mathrm{diag}(s_0, s_1, \\dots, s_p)$ 为对角缩放矩阵。我们希望找到缩放因子 $s_n$，使得缩放后的质量矩阵 $D M D$ 为单位矩阵 $I$。\n缩放后矩阵的第 $(m,n)$ 个元素是 $(D M D)_{mn} = s_m M_{mn} s_n$。由于 $M$ 是对角的，这可以简化为：\n$$\n(D M D)_{nn} = s_n M_{nn} s_n = s_n^2 M_{nn}\n$$\n我们要求对所有的 $n \\in \\{0, 1, \\dots, p\\}$，都有 $(D M D)_{nn} = 1$。\n$$\ns_n^2 M_{nn} = 1 \\implies s_n^2 \\left( \\frac{h}{2n+1} \\right) = 1\n$$\n求解 $s_n$（并按缩放因子的惯例取正根）：\n$$\ns_n^2 = \\frac{2n+1}{h} \\implies s_n = \\sqrt{\\frac{2n+1}{h}}\n$$\n这就给出了所需缩放因子的闭式表达式。这些因子定义了一组新的基函数 $\\tilde{\\phi}_n(x) = s_n \\phi_n(x)$，它们在单元 $K$ 上是标准正交的：\n$$\n\\int_K \\tilde{\\phi}_m(x) \\tilde{\\phi}_n(x) \\, \\mathrm{d}x = \\int_K s_m \\phi_m(x) s_n \\phi_n(x) \\, \\mathrm{d}x = s_n^2 M_{nn} \\delta_{mn} = \\delta_{mn}\n$$\n\n最后，我们讨论这种缩放对刚度贡献的影响。单元上的半离散 DG 系统的形式为 $M \\frac{d\\mathbf{u}}{dt} = K \\mathbf{u}$，其中 $K$ 是结合了体积分和面积分项的刚度矩阵。设 $\\mathbf{u}$ 是在 $\\phi_n$ 基下的系数向量。\n通过定义一个对应于标准正交基 $\\tilde{\\phi}_n$ 的新系数向量 $\\tilde{\\mathbf{u}}$，变换关系为 $\\mathbf{u} = D^{-1}\\tilde{\\mathbf{u}}$。系统变为：\n$$\nM D^{-1} \\frac{d\\tilde{\\mathbf{u}}}{dt} = K D^{-1} \\tilde{\\mathbf{u}} \\implies D M D^{-1} \\frac{d\\tilde{\\mathbf{u}}}{dt} = D K D^{-1} \\tilde{\\mathbf{u}}\n$$\n由于 $D$ 是对角的，$D^{-1}$ 也是对角的，又因为 $M$ 是对角的，它们可以交换。所以 $D M D^{-1} = M$。再次乘以 $D$：\n$D M \\frac{d\\tilde{\\mathbf{u}}}{dt} = D K D^{-1} \\tilde{\\mathbf{u}} \\implies (DMD)\\frac{d\\tilde{\\mathbf{u}}}{dt} = (DKD^{-1}) D \\tilde{\\mathbf{u}}$ 哦，一个更简单的方法是在新基 $\\tilde{\\phi}_n$ 中重新推导该系统。\n新系统为 $\\tilde{M} \\frac{d\\tilde{\\mathbf{u}}}{dt} = \\tilde{K}\\tilde{\\mathbf{u}}$。根据构造，$\\tilde{M} = I$。新的刚度矩阵是 $\\tilde{K} = D K D$。系统是 $\\frac{d\\tilde{\\mathbf{u}}}{dt} = \\tilde{K}\\tilde{\\mathbf{u}}$。\n对该系统，显式时间积分格式的稳定性由 $\\tilde{K}$ 的谱性质（例如，谱半径或谱范数）决定。矩阵 $\\tilde{K}$ 是 DG 空间算子（$-a\\partial_x$ 加上通量修正）在标准正交基 $\\{\\tilde{\\phi}_n\\}$ 中的表示。该矩阵的谱范数 $\\|\\tilde{K}\\|_2$ 等于限制在 $p$ 次多项式试验空间上的 DG 算子的算子范数。\n多项式逼近理论中的一个基本结果是逆不等式，它指出对于长度为 $h$ 的区间上的任意 $p$ 次多项式 $v_p$，存在某个常数 $C$ 使得 $\\|\\partial_x v_p\\|_{L^2(K)} \\le C \\frac{p^2}{h} \\|v_p\\|_{L^2(K)}$。用于平流的 DG 算子由微分算子主导，其范数也表现出相同的缩放关系。因此，缩放后刚度矩阵的谱范数缩放关系为：\n$$\n\\|\\tilde{K}\\|_2 \\sim O\\left(\\frac{a p^2}{h}\\right)\n$$\n这导致了对显式格式的严格时间步长限制，$\\Delta t \\le \\frac{C}{\\|\\tilde{K}\\|_2} \\sim O\\left(\\frac{h}{a p^2}\\right)$。\n\n这种情况可以与节点 DG 框架中的质量集中进行对比。在使用定义在 Gauss-Lobatto 点上的 Lagrange 多项式的节点基中，质量矩阵 $M$ 不是天然对角的。但是，如果使用相同的 Gauss-Lobatto 求积法则来近似计算质量矩阵的元素，由于性质 $l_i(\\xi_j) = \\delta_{ij}$，得到的矩阵 $M_{\\mathrm{lumped}}$ 会变成对角矩阵。这个过程是一种近似，而模态缩放是一种精确的代数变换。\n质量集中后，系统变为 $M_{\\mathrm{lumped}} \\frac{d\\mathbf{u}}{dt} = K \\mathbf{u}$，其求解形式为 $\\frac{d\\mathbf{u}}{dt} = M_{\\mathrm{lumped}}^{-1} K \\mathbf{u}$。算子 $M_{\\mathrm{lumped}}^{-1} K$ 的谱半径决定了时间步长的限制。一个公认的结论是，对于节点平流算子，这个谱半径也具有 $\\rho(M_{\\mathrm{lumped}}^{-1} K) \\sim O\\left(\\frac{a p^2}{h}\\right)$ 的缩放关系。\n总之，尽管模态缩放为获得单位质量矩阵提供了一条数学上精确且分析清晰的途径，而质量集中为实现同样目的提供了一种计算上方便的近似方法，但这两种方法最终都导致系统算子的谱范数/谱半径按 $O(p^2/h)$ 缩放，从而对高阶 DG 方法产生相同的严格 CFL 条件限制。",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2n+1}{h}}}\n$$"
        },
        {
            "introduction": "我们最后的实践是一项综合性计算任务，它将多个概念融会贯通，以解决一个经典的等离子体物理问题——Brio-Wu激波管。你将亲手实现一个有限体积法程序（即分片常数DG方法），并比较两种不同的数值通量格式，直观地观察它们对激波和不连续面模拟效果的影响。这个编程任务展示了DG原理在捕捉磁流体力学（MHD）复杂波系结构时的实际应用。",
            "id": "3967471",
            "problem": "考虑用于激波管的一维理想磁流体动力学（MHD）方程组，其纵向磁场为常数。每个单元中的未知守恒状态是向量 $q = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]$，其中 $\\rho$ 是质量密度，$u, v, w$ 是速度分量，$B_y, B_z$ 是横向磁场分量，$E$ 是总能量。纵向磁场 $B_x$ 是均匀且恒定的。原始变量为 $[\\rho, u, v, w, p, B_x, B_y, B_z]$，其中压力 $p$ 通过 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2+v^2+w^2) - \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)$ 从守恒状态恢复，绝热指数 $\\gamma  1$。一维空间维度 $x$ 下的理想 MHD 方程组的守恒形式为\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{\\partial F(q)}{\\partial x} = 0,\n$$\n其通量 $F(q) = [F_1, F_2, F_3, F_4, F_5, F_6, F_7]$ 由下式给出\n$$\nF_1 = \\rho u, \\quad F_2 = \\rho u^2 + p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2) - B_x^2,\n$$\n$$\nF_3 = \\rho u v - B_x B_y, \\quad F_4 = \\rho u w - B_x B_z, \\quad F_5 = u B_y - v B_x, \\quad F_6 = u B_z - w B_x,\n$$\n$$\nF_7 = \\left(E + p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right) u - B_x (u B_x + v B_y + w B_z).\n$$\nBrio–Wu 激波管初始条件定义在域 $x \\in [0,1]$ 上，在 $x_0 = 0.5$ 处存在一个间断。对于 $x  x_0$，左态为\n$$\n\\rho_L = 1, \\quad u_L=v_L=w_L=0, \\quad p_L = 1, \\quad B_{x,L} = 0.75, \\quad B_{y,L} = 1, \\quad B_{z,L} = 0,\n$$\n对于 $x \\ge x_0$，右态为\n$$\n\\rho_R = 0.125, \\quad u_R=v_R=w_R=0, \\quad p_R = 0.1, \\quad B_{x,R} = 0.75, \\quad B_{y,R} = -1, \\quad B_{z,R} = 0,\n$$\n绝热指数 $\\gamma = 2$。纵向磁场 $B_x$ 在任何地方都恒为 $0.75$。\n\n您的任务是：在均匀网格上，为一维理想 MHD 方程组实现一个分段常数间断 Galerkin (DG) 离散化方案（该方案等效于有限体积法）。对于分段常数近似 $q_i(t)$，每个单元 $I_i = [x_{i-\\tfrac{1}{2}}, x_{i+\\tfrac{1}{2}}]$ 上的半离散 DG 弱形式为\n$$\n\\frac{d q_i}{d t} = -\\frac{1}{\\Delta x}\\left(\\hat{F}_{i+\\tfrac{1}{2}} - \\hat{F}_{i-\\tfrac{1}{2}}\\right),\n$$\n其中 $\\Delta x$ 是均匀的单元尺寸，$\\hat{F}_{i\\pm \\tfrac{1}{2}}$ 是根据每个界面处的左右状态计算出的数值通量。使用强稳定保持 (SSP) 三阶 Runge–Kutta 方法将解在时间上推进。通过将定义域两端的边缘状态复制到虚拟单元中，施加透射（零梯度）边界条件。\n\n实现并比较以下两种数值通量：\n- Rusanov（局部 Lax–Friedrichs）通量，定义为\n$$\n\\hat{F}^{\\mathrm{Rus}}(q_L, q_R) = \\tfrac{1}{2}\\left(F(q_L) + F(q_R)\\right) - \\tfrac{1}{2}s_{\\max}(q_R - q_L),\n$$\n其中 $s_{\\max} = \\max\\left(|u_L| + c_{f,L}, |u_R| + c_{f,R}\\right)$，$c_f$ 是快磁声速。\n- Harten–Lax–van Leer Einfeldt (HLLE) 通量，一个满足熵条件的双波求解器，定义为\n$$\nS_L = \\min(u_L - c_{f,L}, u_R - c_{f,R}), \\quad S_R = \\max(u_L + c_{f,L}, u_R + c_{f,R}),\n$$\n$$\n\\hat{F}^{\\mathrm{HLLE}}(q_L, q_R) =\n\\begin{cases}\nF(q_L),   S_L \\ge 0,\\\\\nF(q_R),   S_R \\le 0,\\\\\n\\dfrac{S_R F(q_L) - S_L F(q_R) + S_L S_R (q_R - q_L)}{S_R - S_L},   \\text{otherwise}.\n\\end{cases}\n$$\n使用标准的一维快磁声速公式\n$$\na^2 = \\frac{\\gamma p}{\\rho}, \\quad c_a^2 = \\frac{B_x^2 + B_y^2 + B_z^2}{\\rho}, \\quad c_{a,x}^2 = \\frac{B_x^2}{\\rho},\n$$\n$$\nc_f^2 = \\tfrac{1}{2}\\left(a^2 + c_a^2 + \\sqrt{\\left(a^2 + c_a^2\\right)^2 - 4 a^2 c_{a,x}^2}\\right).\n$$\n\n定义两个定量诊断指标，以测量激波后区域横向磁场 $B_y$ 中的数值伪影：\n- 过冲幅值 $\\mathcal{O}$：令 $R = \\{x \\in [0.7, 0.9]\\}$ 表示最终时刻的采样区域。令 $m$ 为 $R$ 上 $B_y$ 的中位数。定义\n$$\n\\mathcal{O} = \\max_{x \\in R} B_y(x) - m.\n$$\n- 激波后振荡幅度 $\\sigma$：定义\n$$\n\\sigma = \\sqrt{\\frac{1}{|R|}\\int_{R} \\left(B_y(x) - m\\right)^2 \\, dx},\n$$\n其通过 $R$ 中所选单元上的样本标准差来近似。\n\n所有运行均采用以下数值设置：在 $[0,1]$ 上的均匀网格，使用上述 Brio–Wu 初始数据，恒定的 $B_x = 0.75$，绝热指数 $\\gamma = 2$，透射边界条件，以及使用 Courant–Friedrichs–Lewy (CFL) 数的三阶 SSP Runge–Kutta 时间步进。在最终时间 $t_{\\mathrm{final}} = 0.1$ 停止每次模拟。单位是无量纲的；所有输出均以无量纲实数报告。\n\n测试套件：\n- 情况 1：单元数量 $N = 200$，CFL $= 0.4$，通量类型 Rusanov。\n- 情况 2：单元数量 $N = 200$，CFL $= 0.4$，通量类型 HLLE。\n- 情况 3：单元数量 $N = 100$，CFL $= 0.4$，通量类型 Rusanov。\n- 情况 4：单元数量 $N = 100$，CFL $= 0.4$，通量类型 HLLE。\n\n对于每种情况，计算上面定义的配对 $[\\mathcal{O}, \\sigma]$。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，其本身就是一个列表 $[\\mathcal{O},\\sigma]$。例如，输出格式必须严格遵循以下形式\n$$\n[\\,[\\mathcal{O}_1,\\sigma_1],[\\mathcal{O}_2,\\sigma_2],[\\mathcal{O}_3,\\sigma_3],[\\mathcal{O}_4,\\sigma_4]\\,].\n$$",
            "solution": "所呈现的问题是一个针对一维理想磁流体动力学（MHD）方程组的良定义初值问题，这是计算等离子体物理学中的一个标准模型。它详细说明了控制方程、一个经典的基准初始条件（Brio–Wu 激波管）、数值域和参数、离散化方法（分段常数间断 Galerkin，等效于有限体积方案）、时间积分方案（SSP-RK3）、特定的数值通量函数（Rusanov 和 HLLE）、边界条件（透射）以及用于分析的精确诊断指标。所有组成部分在科学上都是合理的，数学上是一致的，并且在计算上是可行的。因此，该问题被认为是有效的，可以构建一个解。\n\n任务的核心是为双曲守恒律方程组 $\\frac{\\partial q}{\\partial t} + \\frac{\\partial F(q)}{\\partial x} = 0$ 实现一个有限体积求解器。解采用线方法在时间上推进，其中空间和时间离散化是分开处理的。\n\n**1. 状态变量和转换**\n\n求解器对守恒变量向量 $q = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]^T$ 进行操作。然而，通量函数 $F(q)$ 和特征波速的计算需要原始变量 $W = [\\rho, u, v, w, p, B_y, B_z]^T$。纵向磁场 $B_x$ 和绝热指数 $\\gamma$ 是恒定参数。\n\n从守恒变量 $q$ 到原始变量 $W$ 的转换：\n给定一个状态向量 $q=(q_1, ..., q_7)^T$：\n- 质量密度: $\\rho = q_1$\n- 速度分量: $u = q_2/\\rho$, $v = q_3/\\rho$, $w = q_4/\\rho$\n- 横向磁场分量: $B_y = q_5$, $B_z = q_6$\n- 总能量密度: $E = q_7$\n- 热压力 $p$ 由总能量导出：\n$$p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho(u^2+v^2+w^2) - \\frac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)$$\n\n从原始变量 $W$ 到守恒变量 $q$ 的转换：\n给定一个原始向量 $W=[\\rho, u, v, w, p, B_y, B_z]^T$：\n- $q_1 = \\rho$\n- $q_2 = \\rho u$\n- $q_3 = \\rho v$\n- $q_4 = \\rho w$\n- $q_5 = B_y$\n- $q_6 = B_z$\n- 总能量密度 $E$ 被计算并存储在 $q_7$ 中：\n$$E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho(u^2+v^2+w^2) + \\frac{1}{2}(B_x^2 + B_y^2 + B_z^2)$$\n\n在整个模拟过程中必须保持密度 $\\rho$ 和压力 $p$ 的正性，以确保物理可实现性。\n\n**2. 空间离散化：有限体积法**\n\n将域 $x \\in [0,1]$ 划分为 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀单元 $I_i = [x_{i-1/2}, x_{i+1/2}]$。每个单元内的解由一个分段常数值 $q_i(t)$ 近似，该值代表守恒状态的单元平均值。单元 $I_i$ 的控制方程的半离散形式是：\n$$ \\frac{d q_i}{d t} = L(q)_i = -\\frac{1}{\\Delta x}\\left(\\hat{F}_{i+1/2} - \\hat{F}_{i-1/2}\\right) $$\n此处，$\\hat{F}_{i \\pm 1/2}$ 是单元界面 $x_{i \\pm 1/2}$ 处的数值通量，它是使用相邻单元 $q_i$ 和 $q_{i \\pm 1}$ 的状态计算得出的。\n\n**3. 数值通量**\n\n数值通量函数近似了每个单元界面上 Riemann 问题的解。该问题要求实现两种常见的近似 Riemann 求解器。\n\n**a. 快磁声速计算**\n两种通量函数都依赖于快磁声速 $c_f$，即 MHD 系统的最大特征速度。对于给定状态，其计算公式为：\n$$ c_f = \\sqrt{\\frac{1}{2}\\left(a^2 + c_a^2 + \\sqrt{(a^2 + c_a^2)^2 - 4 a^2 c_{a,x}^2}\\right)} $$\n其中 $a^2 = \\gamma p / \\rho$ 是声速平方，$c_a^2 = (B_x^2+B_y^2+B_z^2)/\\rho$ 是总 Alfvén 速平方，$c_{a,x}^2 = B_x^2/\\rho$ 是纵向 Alfvén 速平方。\n\n**b. Rusanov (局部 Lax-Friedrichs) 通量**\n这是一种耗散通量，由下式给出：\n$$ \\hat{F}^{\\mathrm{Rus}}(q_L, q_R) = \\frac{1}{2}\\left(F(q_L) + F(q_R)\\right) - \\frac{1}{2}s_{\\max}(q_R - q_L) $$\n耗散由 $s_{\\max} = \\max\\left(|u_L| + c_{f,L}, |u_R| + c_{f,R}\\right)$ 控制，这是基于左 ($L$) 和右 ($R$) 状态的界面处最大信号速度。\n\n**c. Harten-Lax-van Leer-Einfeldt (HLLE) 通量**\nHLLE 通量是一种更复杂的双波近似 Riemann 求解器，能更好地解析接触间断。它基于对界面处最小 ($S_L$) 和最大 ($S_R$) 信号速度的估计来构建：\n$$ S_L = \\min(u_L - c_{f,L}, u_R - c_{f,R}), \\quad S_R = \\max(u_L + c_{f,L}, u_R + c_{f,R}) $$\n通量则为：\n$$ \\hat{F}^{\\mathrm{HLLE}}(q_L, q_R) =\n\\begin{cases}\nF(q_L),   S_L \\ge 0 \\\\\nF(q_R),   S_R \\le 0 \\\\\n\\frac{S_R F(q_L) - S_L F(q_R) + S_L S_R (q_R - q_L)}{S_R - S_L},   \\text{otherwise}\n\\end{cases}\n$$\n前两种情况对应于超音速流，其中 Riemann 扇完全位于界面的一侧，因此通量就是简单的迎风通量。\n\n**4. 时间积分：SSP Runge-Kutta 3**\n\n为了在时间上推进解，我们使用三阶强稳定保持 (SSP) Runge-Kutta 方法。给定时间 $t_n$ 的解 $q^n$，通过三个阶段找到时间 $t_{n+1} = t_n + \\Delta t$ 的解：\n$$ q^{(1)} = q^n + \\Delta t L(q^n) $$\n$$ q^{(2)} = \\frac{3}{4}q^n + \\frac{1}{4}\\left(q^{(1)} + \\Delta t L(q^{(1)})\\right) $$\n$$ q^{n+1} = \\frac{1}{3}q^n + \\frac{2}{3}\\left(q^{(2)} + \\Delta t L(q^{(2)})\\right) $$\n其中 $L(q)$ 是前面定义的空间算子。时间步长 $\\Delta t$ 受 Courant-Friedrichs-Lewy (CFL) 条件的限制：\n$$ \\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{\\max_i(|u_i| + c_{f,i})} $$\n最大值取自计算域中的所有单元。\n\n**5. 边界和初始条件**\n\n初始条件是 Brio-Wu 激波管，它包含两个由 $x=0.5$ 处的间断分开的分段常数状态。每个单元中的初始守恒状态由相应的原始变量计算得出。通过将虚拟单元中的状态设置为与相邻内部单元的状态相等，来施加透射（零梯度或出流）边界条件。对于一个有 $N$ 个单元且每侧有一个虚拟单元的网格，这意味着 $q_0 = q_1$ 和 $q_{N+1} = q_N$。\n\n**6. 诊断**\n\n在最终时间 $t_{\\mathrm{final}} = 0.1$，计算两个诊断指标，以量化空间区域 $R = [0.7, 0.9]$ 内横向磁场 $B_y$ 的数值伪影。\n- **过冲 $\\mathcal{O}$**：区域 $R$ 中 $B_y(x)$ 的最大值减去 $R$ 中 $B_y(x)$ 的中位数 $m$。这用于测量非物理振荡的峰值。\n- **振荡幅度 $\\sigma$**：区域 $R$ 上 $B_y(x)$ 相对于中位数 $m$ 的标准差，对于所有中心 $x_i$ 位于 $R$ 内的单元 $i$，计算为 $\\sigma = \\sqrt{\\text{mean}((B_y(x_i) - m)^2)}$。这量化了总体的振荡能量。\n\n实现过程将是：设置初始状态，进入一个时间循环，该循环使用所选的数值通量重复应用 SSP-RK3 更新，最后从最终解的状态计算所需的诊断指标。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the MHD simulations and print the results.\n    \"\"\"\n    \n    # Global physical parameters\n    GAMMA = 2.0\n    BX_CONST = 0.75\n\n    def conserved_to_primitives(q):\n        \"\"\"\n        Converts a matrix of conserved variables Q to primitive variables W.\n        q: (..., 7) array for [rho, rho*u, rho*v, rho*w, By, Bz, E]\n        Returns: (..., 7) array for [rho, u, v, w, p, By, Bz]\n        \"\"\"\n        W = np.zeros_like(q)\n        rho = q[..., 0]\n        \n        # Avoid division by zero for vacuum states if any\n        inv_rho = np.divide(1.0, rho, out=np.zeros_like(rho), where=rho > 1e-12)\n\n        W[..., 0] = rho\n        W[..., 1] = q[..., 1] * inv_rho  # u\n        W[..., 2] = q[..., 2] * inv_rho  # v\n        W[..., 3] = q[..., 3] * inv_rho  # w\n        W[..., 5] = q[..., 4]  # By\n        W[..., 6] = q[..., 5]  # Bz\n\n        u, v, w = W[..., 1], W[..., 2], W[..., 3]\n        By, Bz = W[..., 5], W[..., 6]\n        \n        kin_energy = 0.5 * rho * (u**2 + v**2 + w**2)\n        mag_energy = 0.5 * (BX_CONST**2 + By**2 + Bz**2)\n        \n        pressure = (GAMMA - 1.0) * (q[..., 6] - kin_energy - mag_energy)\n        W[..., 4] = np.maximum(pressure, 1e-12) # Pressure floor\n\n        return W\n\n    def primitives_to_conserved(W):\n        \"\"\"\n        Converts a matrix of primitive variables W to conserved variables Q.\n        W: (..., 7) array for [rho, u, v, w, p, By, Bz]\n        Returns: (..., 7) array for [rho, rho*u, rho*v, rho*w, By, Bz, E]\n        \"\"\"\n        Q = np.zeros_like(W)\n        rho, u, v, w, p, By, Bz = [W[..., i] for i in range(7)]\n\n        Q[..., 0] = rho\n        Q[..., 1] = rho * u\n        Q[..., 2] = rho * v\n        Q[..., 3] = rho * w\n        Q[..., 4] = By\n        Q[..., 5] = Bz\n        \n        kin_energy = 0.5 * rho * (u**2 + v**2 + w**2)\n        mag_energy = 0.5 * (BX_CONST**2 + By**2 + Bz**2)\n        \n        Q[..., 6] = p / (GAMMA - 1.0) + kin_energy + mag_energy\n        return Q\n\n    def get_flux(q):\n        \"\"\"Computes the analytical flux F(q).\"\"\"\n        W = conserved_to_primitives(q)\n        rho, u, v, w, p, By, Bz = [W[..., i] for i in range(7)]\n        \n        B_sq = BX_CONST**2 + By**2 + Bz**2\n        p_tot = p + 0.5 * B_sq\n        \n        F = np.zeros_like(q)\n        F[..., 0] = rho * u\n        F[..., 1] = rho * u**2 + p_tot - BX_CONST**2\n        F[..., 2] = rho * u * v - BX_CONST * By\n        F[..., 3] = rho * u * w - BX_CONST * Bz\n        F[..., 4] = u * By - v * BX_CONST\n        F[..., 5] = u * Bz - w * BX_CONST\n\n        E = q[..., 6]\n        v_dot_B = u * BX_CONST + v * By + w * Bz\n        F[..., 6] = (E + p_tot) * u - BX_CONST * v_dot_B\n        \n        return F\n\n    def get_fast_magnetosonic_speed(q):\n        \"\"\"Computes the fast magnetosonic speed.\"\"\"\n        W = conserved_to_primitives(q)\n        rho, u, v, w, p, By, Bz = [W[..., i] for i in range(7)]\n        \n        # Avoid division by zero\n        inv_rho = np.divide(1.0, rho, out=np.zeros_like(rho), where=rho > 1e-12)\n\n        p = np.maximum(p, 1e-12)\n        a_sq = GAMMA * p * inv_rho\n        \n        B_sq = BX_CONST**2 + By**2 + Bz**2\n        ca_sq = B_sq * inv_rho\n        cax_sq = (BX_CONST**2) * inv_rho\n        \n        term = np.sqrt(np.maximum((a_sq + ca_sq)**2 - 4 * a_sq * cax_sq, 0))\n        cf_sq = 0.5 * (a_sq + ca_sq + term)\n        \n        return np.sqrt(cf_sq)\n\n    def rusanov_flux(q_L, q_R):\n        F_L = get_flux(q_L)\n        F_R = get_flux(q_R)\n        \n        W_L = conserved_to_primitives(q_L)\n        W_R = conserved_to_primitives(q_R)\n        \n        cf_L = get_fast_magnetosonic_speed(q_L)\n        cf_R = get_fast_magnetosonic_speed(q_R)\n        \n        s_max = np.maximum(np.abs(W_L[..., 1]) + cf_L, np.abs(W_R[..., 1]) + cf_R)\n        \n        return 0.5 * (F_L + F_R) - 0.5 * s_max[..., np.newaxis] * (q_R - q_L)\n\n    def hlle_flux(q_L, q_R):\n        F_L = get_flux(q_L)\n        F_R = get_flux(q_R)\n        \n        W_L = conserved_to_primitives(q_L)\n        W_R = conserved_to_primitives(q_R)\n        \n        u_L, u_R = W_L[..., 1], W_R[..., 1]\n        \n        cf_L = get_fast_magnetosonic_speed(q_L)\n        cf_R = get_fast_magnetosonic_speed(q_R)\n\n        S_L = np.minimum(u_L - cf_L, u_R - cf_R)\n        S_R = np.maximum(u_L + cf_L, u_R + cf_R)\n\n        S_L_ge_0 = (S_L >= 0)\n        S_R_le_0 = (S_R = 0)\n        \n        # Vectorized conditional logic\n        num = (S_R[..., np.newaxis] * F_L - S_L[..., np.newaxis] * F_R + \n               (S_L * S_R)[..., np.newaxis] * (q_R - q_L))\n        den = S_R - S_L\n        den[den == 0] = 1.0 # Avoid division by zero, num will be zero there\n        \n        F_hlle = num / den[..., np.newaxis]\n        \n        F_hat = np.where(S_L_ge_0[..., np.newaxis], F_L, F_hlle)\n        F_hat = np.where(S_R_le_0[..., np.newaxis], F_R, F_hat)\n        \n        return F_hat\n\n    def run_simulation(N, cfl_number, flux_type):\n        # Setup grid\n        num_ghost = 1\n        x_min, x_max = 0.0, 1.0\n        dx = (x_max - x_min) / N\n        # Grid with ghost cells\n        x = np.linspace(x_min - (num_ghost - 0.5) * dx, x_max + (num_ghost - 0.5) * dx, N + 2 * num_ghost)\n        \n        # Initial conditions\n        W_L = np.array([1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0]) # rho, u, v, w, p, By, Bz\n        W_R = np.array([0.125, 0.0, 0.0, 0.0, 0.1, -1.0, 0.0])\n\n        q = np.zeros((N + 2 * num_ghost, 7))\n        q[x  0.5, :] = primitives_to_conserved(W_L)\n        q[x >= 0.5, :] = primitives_to_conserved(W_R)\n\n        flux_func = rusanov_flux if flux_type == \"Rusanov\" else hlle_flux\n\n        def compute_rhs(q_state):\n            q_current = np.copy(q_state)\n            \n            # Apply transmissive boundary conditions\n            q_current[0, :] = q_current[1, :]\n            q_current[-1, :] = q_current[-2, :]\n            \n            # States at interfaces\n            q_L = q_current[:-1, :]\n            q_R = q_current[1:, :]\n            \n            # Numerical flux at interfaces\n            F_hat = flux_func(q_L, q_R)\n            \n            # RHS: -1/dx * (F_{i+1/2} - F_{i-1/2})\n            rhs = np.zeros_like(q_current)\n            rhs[1:-1, :] = -1.0/dx * (F_hat[1:, :] - F_hat[:-1, :])\n            return rhs\n\n        t = 0.0\n        t_final = 0.1\n\n        while t  t_final:\n            # Calculate dt from CFL condition\n            W = conserved_to_primitives(q[1:-1, :])\n            speeds = np.abs(W[..., 1]) + get_fast_magnetosonic_speed(q[1:-1, :])\n            max_speed = np.max(speeds)\n            \n            dt = cfl_number * dx / max_speed\n            if t + dt > t_final:\n                dt = t_final - t\n\n            # SSP-RK3 steps\n            q_n = np.copy(q)\n            \n            k1 = compute_rhs(q_n)\n            q1 = q_n + dt * k1\n            \n            k2 = compute_rhs(q1)\n            q2 = 0.75 * q_n + 0.25 * (q1 + dt * k2)\n\n            k3 = compute_rhs(q2)\n            q = (1.0/3.0) * q_n + (2.0/3.0) * (q2 + dt * k3)\n            \n            t += dt\n\n        # Post-processing and diagnostics\n        x_centers = np.linspace(x_min + 0.5 * dx, x_max - 0.5 * dx, N)\n        sample_indices = np.where((x_centers >= 0.7)  (x_centers = 0.9))[0]\n        \n        # Get final By from interior cells\n        By_final = conserved_to_primitives(q[1:-1, :])[..., 5]\n        By_sample = By_final[sample_indices]\n\n        if len(By_sample) == 0:\n            return [0.0, 0.0]\n\n        m = np.median(By_sample)\n        overshoot = np.max(By_sample) - m\n        oscillation = np.sqrt(np.mean((By_sample - m)**2)) # std with ddof=0\n\n        return [overshoot, oscillation]\n\n    # Test suite\n    test_cases = [\n        {'N': 200, 'CFL': 0.4, 'flux_type': 'Rusanov'},\n        {'N': 200, 'CFL': 0.4, 'flux_type': 'HLLE'},\n        {'N': 100, 'CFL': 0.4, 'flux_type': 'Rusanov'},\n        {'N': 100, 'CFL': 0.4, 'flux_type': 'HLLE'}\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case['N'], case['CFL'], case['flux_type'])\n        results.append(result)\n    \n    # Format the final output string\n    # Convert each inner list to its string representation\n    result_strings = [str(res) for res in results]\n    # Join them with commas and enclose in brackets\n    output_string = f\"[{','.join(result_strings)}]\"\n    print(output_string)\n\nsolve()\n```"
        }
    ]
}