{
    "hands_on_practices": [
        {
            "introduction": "本练习构成了理解黎曼求解器的理论基石。通过推导理想磁流体力学（MHD）系统的特征速度，您将深入了解携带信息并构成数值通量基础的七种不同波动。理解这些波速的排序及其简并条件是构建稳健求解器的第一步。",
            "id": "4041206",
            "problem": "考虑一维理想磁流体动力学 (MHD) 系统，该系统描述了沿 $x$ 方向的可压缩、理想导电等离子体，并满足理想气体状态方程。守恒态为 $(\\rho, \\rho u, \\rho v, \\rho w, B_x, B_y, B_z, E)$，其中 $\\rho$ 是质量密度，$(u,v,w)$ 是速度分量，$(B_x,B_y,B_z)$ 是磁场分量，$E$ 是总能量密度。根据无散约束和一维通量守恒，假设 $B_x$ 在 $x$ 和 $t$ 上是常数。令 $a \\equiv \\sqrt{\\gamma p/\\rho}$ 表示绝热声速（其中 $\\gamma$ 为比热比），令 $c_A \\equiv |B_x|/\\sqrt{\\rho}$ 表示基于法向场的阿尔芬速度，令 $c_f$ 和 $c_s$ 表示沿 $x$ 方向传播的快、慢磁声速（根据定义，二者均为非负）。在为一维理想 MHD 方程构建近似黎曼求解器的背景下，以下哪个陈述正确地给出了用 $u$、$c_f$、$c_s$ 和 $c_A$ 表示的全套特征速度（特征值），并给出了它们的排序和对可能出现的简并情况的正确描述？\n\n选择一个选项。\n\nA. 七个特征值为 $u - c_f$, $u - c_A$, $u - c_s$, $u$, $u + c_s$, $u + c_A$, $u + c_f$。对于 $|B_x|  0$ 和 $\\sqrt{B_y^2 + B_z^2}  0$，有 $c_f \\ge c_A \\ge c_s \\ge 0$，因此 $u - c_f \\le u - c_A \\le u - c_s \\le u \\le u + c_s \\le u + c_A \\le u + c_f$。若 $a  0$ 且 $\\sqrt{B_y^2 + B_z^2}  0$，则为严格不等式。若 $\\sqrt{B_y^2 + B_z^2} = 0$，则 $c_f = \\max(a,c_A)$ 且 $c_s = \\min(a,c_A)$，因此 $c_A$ 与 $c_f$ 或 $c_s$ 重合。若 $B_x = 0$，则 $c_A = 0$ 且 $c_s = 0$，因此两个阿尔芬波、两个慢波和接触波都以速度 $u$ 传播。\n\nB. 七个特征值为 $u - c_f$, $u - c_{A,\\mathrm{tot}}$, $u - c_s$, $u$, $u + c_s$, $u + c_{A,\\mathrm{tot}}$, $u + c_f$，其中 $c_{A,\\mathrm{tot}} \\equiv |B|/\\sqrt{\\rho}$，$|B| = \\sqrt{B_x^2 + B_y^2 + B_z^2}$。对于所有状态，排序满足 $c_f \\ge c_s \\ge c_{A,\\mathrm{tot}} \\ge 0$，且仅当 $|B| = 0$ 时才会发生简并。\n\nC. 七个特征值为 $u - c_f$, $u - a$, $u - c_s$, $u$, $u + c_s$, $u + a$, $u + c_f$，其中 $a \\equiv \\sqrt{\\gamma p/\\rho}$。对于所有状态，排序满足 $c_f \\ge a \\ge c_s \\ge 0$，且当且仅当 $a = c_s$ 时发生简并。\n\nD. 七个特征值为 $u - c_f$, $u - c_A$, $u - c_s$, $u$, $u + c_s$, $u + c_A$, $u + c_f$。对于所有状态，排序满足 $c_f \\ge c_s \\ge c_A \\ge 0$，且只要 $a  0$ 就是严格不等式。若 $B_x = 0$，则 $c_A = 0$ 但 $c_s = a  0$，因此不会与接触波合并。\n\nE. 存在六个不同的波速：$u \\pm c_f$, $u \\pm c_A$, $u \\pm c_s$。在理想 MHD 中，接触（熵）模不贡献独立的特征速度，因此不会发生涉及 $u$ 的简并。",
            "solution": "我们从一维理想磁流体动力学 (MHD) 的控制守恒律以及理想气体闭合关系开始。在一维情况下，根据 $\\nabla \\cdot \\mathbf{B} = 0$ 和带有理想欧姆定律的法拉第定律，法向磁场 $B_x$ 是一个常数，且通量雅可比矩阵有七个特征场。为了获得特征速度，我们在均匀态附近进行线性化，并考虑小振幅平面波 $\\propto \\exp\\{ i (k x - \\omega t) \\}$。\n\n标准的极化解耦在流体静止坐标系（$u = 0$）中产生三族波：熵/接触波、阿尔芬波和磁声波。熵/接触模对应于随流体平流的 $\\rho$ 和 $p$ 的扰动，在实验室坐标系中给出的特征速度为 $u$。阿尔芬波对应于横向速度-磁场扰动，其中 $\\delta \\rho = \\delta p = \\delta u = \\delta B_x = 0$，满足 $\\omega^2 = k^2 c_A^2$，$c_A \\equiv |B_x|/\\sqrt{\\rho}$，因此在实验室坐标系中，两个阿尔芬速度为 $u \\pm c_A$。余下的压缩模是快、慢磁声波，其在流体静止坐标系中的色散关系为\n$$\n\\frac{\\omega^2}{k^2} = c_{f,s}^2 = \\frac{1}{2}\\Big( a^2 + b^2 \\pm \\sqrt{(a^2 + b^2)^2 - 4 a^2 c_A^2} \\Big),\n$$\n其中 $a \\equiv \\sqrt{\\gamma p/\\rho}$ 是绝热声速，$b^2 \\equiv |\\mathbf{B}|^2/\\rho = (B_x^2 + B_y^2 + B_z^2)/\\rho$。通过双曲系统的伽利略不变性变换到实验室坐标系会增加一个速度 $u$，因此磁声速为 $u \\pm c_f$ 和 $u \\pm c_s$。\n\n因此，完整的七个特征值集合是\n$$\nu - c_f,\\quad u - c_A,\\quad u - c_s,\\quad u,\\quad u + c_s,\\quad u + c_A,\\quad u + c_f.\n$$\n\n接下来，我们从第一性原理出发，确定其排序和简并情况。快、慢波速度的平方是以下二次方程的两个正根\n$$\nX^2 - (a^2 + b^2)\\,X + a^2 c_A^2 = 0,\n$$\n因此它们满足\n$$\nc_f^2 + c_s^2 = a^2 + b^2,\\qquad c_f^2\\,c_s^2 = a^2 c_A^2.\n$$\n定义 $b_t^2 \\equiv (B_y^2 + B_z^2)/\\rho = b^2 - c_A^2 \\ge 0$。将 $X = c_A^2$ 代入该二次多项式：\n$$\nP(c_A^2) = c_A^4 - (a^2 + b^2)\\,c_A^2 + a^2 c_A^2 = c_A^2(c_A^2 - b^2) = -\\,c_A^2 b_t^2 \\le 0.\n$$\n因为 $P$ 是一个关于 $X$ 的凸抛物线，其根为 $X = c_s^2$ 和 $X = c_f^2$，不等式 $P(c_A^2) \\le 0$ 意味着\n$$\nc_s^2 \\le c_A^2 \\le c_f^2,\n$$\n当且仅当 $b_t^2 > 0$（即切向磁场非零）时为严格不等式。由于 $c_s, c_A, c_f \\ge 0$，在实验室坐标系中特征速度的排序是\n$$\nu - c_f \\le u - c_A \\le u - c_s \\le u \\le u + c_s \\le u + c_A \\le u + c_f,\n$$\n当 $a > 0$、$|B_x| > 0$ 且 $\\sqrt{B_y^2 + B_z^2} > 0$ 时为严格不等式。\n\n我们现在描述简并情况：\n- 如果 $\\sqrt{B_y^2 + B_z^2} = 0$（磁场完全沿传播方向），则 $b^2 = c_A^2$，快/慢波速度简化为 $c_f = \\max(a, c_A)$ 和 $c_s = \\min(a, c_A)$。在这种情况下，$c_A$ 等于 $c_f$ 或 $c_s$ 中的一个，相应的阿尔芬模式与一个磁声模式简并。\n- 如果 $B_x = 0$，则 $c_A = 0$。二次方程给出 $c_s = 0$ 和 $c_f^2 = a^2 + b_t^2$。因此，两个阿尔芬速度都坍缩到 $u$，两个慢波速度也坍缩到 $u$。连同速度为 $u$ 的接触波，这在 $u$ 处产生了一个五重简并。\n- 如果 $a = 0$（冷等离子体），则 $c_s = 0$ 且 $c_f^2 = b^2$，因此两个慢波速度与在 $u$ 处的接触波重合。\n\n这些结论为理想 MHD 的黎曼求解器提供了正确的特征值集合、排序和简并结构。\n\n逐项分析选项：\n- 选项 A 与推导出的特征值相符，正确陈述了在一般条件下 $c_f \\ge c_A \\ge c_s \\ge 0$ 的排序，并在 $a > 0$ 和切向场非零时为严格不等式，并且列出了 $\\sqrt{B_y^2 + B_z^2} = 0$ 和 $B_x = 0$ 时的正确简并情况。这是正确的。\n- 选项 B 使用 $c_{A,\\mathrm{tot}} \\equiv |\\mathbf{B}|/\\sqrt{\\rho}$ 作为阿尔芬速度，这对于沿 $x$ 方向的传播是不正确的；相关的阿尔芬速度是 $c_A = |B_x|/\\sqrt{\\rho}$。其排序和简并性的论断也是错误的。这是不正确的。\n- 选项 C 用声速 $a$ 替换了中间的阿尔芬速度，这不符合理想 MHD 特征波的结构；中间波是阿尔芬波，而不是声波。这是不正确的。\n- 选项 D 给出了正确的特征值集合，但其排序 $c_f \\ge c_s \\ge c_A$ 与已确立的 $c_s \\le c_A \\le c_f$ 相矛盾。它还错误地陈述了 $B_x = 0$ 时的简并情况：实际上 $c_s = 0$ 并与在 $u$ 处的接触波重合。这是不正确的。\n- 选项 E 错误地断言没有接触波特征值；理想 MHD 有七个波，包括接触（熵）波。这是不正确的。\n\n因此，正确选项是 A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "本练习在特征速度概念的基础上将理论付诸实践。您将使用 Harten-Lax-van Leer-Einfeldt (HLLE) 方法为一个特定且具有挑战性的黎曼问题计算数值通量，该方法因其稳健性而备受推崇。此任务突显了如何处理法向磁场消失的简并情况，这是磁流体力学模拟中的一个常见难题。",
            "id": "4041169",
            "problem": "考虑沿 $x$ 方向的笛卡尔坐标系中的一维理想磁流体动力学（MHD）黎曼问题，采用无量纲单位，其中磁导率为1，所有量均以程序单位表示。$x$ 方向上的理想 MHD 守恒状态向量和通量由标准守恒律定义，总能量、动量和磁场与无散度磁场（$\\partial B_x/\\partial x = 0$）一致。绝热指数为 $\\gamma = 5/3$。在界面 $x=0$ 处的左右原始状态是对称的，由下式给出\n$$\n\\rho_L = 1,\\quad p_L = 1,\\quad u_{x,L} = \\frac{1}{2},\\quad u_{y,L} = 0,\\quad u_{z,L} = 0,\\quad B_{x} = 0,\\quad B_{y,L} = 1,\\quad B_{z,L} = 0,\n$$\n$$\n\\rho_R = 1,\\quad p_R = 1,\\quad u_{x,R} = -\\frac{1}{2},\\quad u_{y,R} = 0,\\quad u_{z,R} = 0,\\quad B_{x} = 0,\\quad B_{y,R} = -1,\\quad B_{z,R} = 0.\n$$\n从理想 MHD 方程的守恒形式和特征波族出发，解释在 $B_x \\to 0$ 极限下的退化和预期的复合波行为，并论证在此退化极限下使用双波 Harten–Lax–van Leer–Einfeldt (HLLE) 黎曼求解器以保证鲁棒性的原因。然后，使用从给定的左右状态自洽计算出的快磁声边界速度，计算在 $x=0$ 处，守恒变量按以下顺序排列的 HLLE 数值通量向量\n$$\n\\left[\\rho,\\ \\rho u_x,\\ \\rho u_y,\\ \\rho u_z,\\ B_y,\\ B_z,\\ E\\right],\n$$\n其中总能量为 $E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho\\left(u_x^2 + u_y^2 + u_z^2\\right) + \\frac{1}{2}\\left(B_x^2 + B_y^2 + B_z^2\\right)$，总能量的 $x$ 方向通量为 $(E + p_t)u_x - B_x(u_x B_x + u_y B_y + u_z B_z)$，其中 $p_t = p + \\frac{1}{2}(B_x^2 + B_y^2 + B_z^2)$。以精确的解析形式表示最终通量。最终答案不包含单位，也不要四舍五入。",
            "solution": "该问题被评估为有效。这是一个来自计算磁流体动力学领域的、提法恰当且具有科学依据的问题，提供了所有必要数据，且无内部矛盾。\n\n求解过程分为两部分。首先，解释在引导场为零（$B_x \\to 0$）极限下的波退化现象，并论证使用 HLLE 求解器的合理性。其次，详细计算给定初始条件下的 HLLE 通量向量。\n\n一维理想 MHD 方程的守恒形式如下：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}}{\\partial x} = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量向量，$\\mathbf{F}$ 是通量向量。对于此问题，它们是：\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u_x \\\\ \\rho u_y \\\\ \\rho u_z \\\\ B_y \\\\ B_z \\\\ E \\end{pmatrix}, \\quad \n\\mathbf{F} = \\begin{pmatrix} \\rho u_x \\\\ \\rho u_x^2 + p_t - B_x^2 \\\\ \\rho u_x u_y - B_x B_y \\\\ \\rho u_x u_z - B_x B_z \\\\ u_x B_y - u_y B_x \\\\ u_x B_z - u_z B_x \\\\ (E + p_t) u_x - B_x (\\mathbf{u} \\cdot \\mathbf{B}) \\end{pmatrix}\n$$\n该系统包含七个特征波族。这些波的速度是雅可比矩阵 $\\mathbf{A} = \\partial \\mathbf{F} / \\partial \\mathbf{U}$ 的特征值。七个特征速度是：\n$$\n\\lambda_{1,7} = u_x \\mp c_f, \\quad \\lambda_{2,6} = u_x \\mp c_{A}, \\quad \\lambda_{3,5} = u_x \\mp c_{s}, \\quad \\lambda_4 = u_x\n$$\n其中 $u_x$ 是流体速度，$c_{A} = |B_x|/\\sqrt{\\rho}$ 是阿尔芬速度，$c_f$ 和 $c_{s}$ 分别是快磁声速和慢磁声速。这些速度由下式给出：\n$$\nc_{f,s}^2 = \\frac{1}{2} \\left( c_s^2 + c_b^2 \\pm \\sqrt{(c_s^2 + c_b^2)^2 - 4 c_s^2 c_{A}^2} \\right)\n$$\n其中声速 $c_s^2 = \\gamma p / \\rho$，总磁速 $c_b^2 = (B_x^2 + B_y^2 + B_z^2)/\\rho = c_{A}^2 + (B_y^2 + B_z^2)/\\rho$。\n\n在 $B_x \\to 0$ 的极限下，阿尔芬速度 $c_{A}$ 消失。这导致波速出现关键的退化：\n1. 平方根项变为 $\\sqrt{(c_s^2 + c_b^2)^2} = c_s^2 + c_b^2$。\n2. 快磁声速简化为 $c_f^2 = c_s^2 + c_b^2 = c_s^2 + (B_y^2 + B_z^2)/\\rho$。\n3. 慢磁声速变为 $c_{s}^2 = 0$。\n4. 阿尔芬速度变为 $c_{A} = 0$。\n\n结果，七个特征速度的集合塌缩为：\n$$\n\\{ u_x - c_f, \\ u_x, \\ u_x, \\ u_x, \\ u_x, \\ u_x, \\ u_x + c_f \\}\n$$\n两个阿尔芬波、两个慢波和熵波都以流体速度 $u_x$ 传播。这种五重退化意味着相应的特征向量不再是线性无关的，并且系统的雅可比矩阵是不可对角化的。精确黎曼求解器和依赖于完全特征分解的近似求解器（如 Roe 求解器）在此极限下会失效，因为它们需要一个完备的线性无关特征向量集来投影状态向量的跳跃。\n\nHarten–Lax–van Leer–Einfeldt (HLLE) 求解器是一个鲁棒的替代方案。它不试图解析黎曼扇的详细波结构。相反，它假设一个简化的双波结构，由最快的左行（$S_L$）和右行（$S_R$）信号速度界定。这两个信号之间的区域被视为一个单一的平均状态。HLLE 通量公式为：\n$$\n\\mathbf{F}_{HLLE} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\n这种公式仅需要对边界速度（通常是最快的磁声速）进行估计，而不依赖于中间波的特征向量。其鲁棒性源于这种简化，使其对 $B_x=0$ 时发生的波退化不敏感。\n\n现在，我们为给定问题计算 HLLE 通量。\n\n**步骤 1：计算左右状态和通量向量**\n绝热指数为 $\\gamma = 5/3$。\n左侧状态（L）的原始变量为：$\\rho_L=1, p_L=1, u_{x,L}=1/2, u_{y,L}=0, u_{z,L}=0, B_x=0, B_{y,L}=1, B_{z,L}=0$。\n右侧状态（R）的原始变量为：$\\rho_R=1, p_R=1, u_{x,R}=-1/2, u_{y,R}=0, u_{z,R}=0, B_x=0, B_{y,R}=-1, B_{z,R}=0$。\n\n每个状态的总能量 $E$ 为：\n$E_L = \\frac{p_L}{\\gamma-1} + \\frac{1}{2}\\rho_L(u_{x,L}^2+u_{y,L}^2+u_{z,L}^2) + \\frac{1}{2}(B_x^2+B_{y,L}^2+B_{z,L}^2) = \\frac{1}{2/3} + \\frac{1}{2}(1)(\\frac{1}{4}) + \\frac{1}{2}(1) = \\frac{3}{2} + \\frac{1}{8} + \\frac{1}{2} = \\frac{17}{8}$。\n由于对称性，$E_R = E_L = 17/8$。\n\n守恒状态向量 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 为：\n$\\mathbf{U}_L = [1, 1/2, 0, 0, 1, 0, 17/8]^T$。\n$\\mathbf{U}_R = [1, -1/2, 0, 0, -1, 0, 17/8]^T$。\n\n总压 $p_t = p + \\frac{1}{2}(B_x^2+B_y^2+B_z^2)$:\n$p_{t,L} = 1 + \\frac{1}{2}(0^2+1^2+0^2) = 3/2$。\n$p_{t,R} = 1 + \\frac{1}{2}(0^2+(-1)^2+0^2) = 3/2$。\n\n通量向量 $\\mathbf{F}_L$ 和 $\\mathbf{F}_R$ （其中 $B_x=0$）：\n$\\mathbf{F}_L = [\\rho_L u_{x,L}, \\rho_L u_{x,L}^2+p_{t,L}, \\dots]^T = [1/2, 1(1/4)+3/2, 0, 0, (1/2)(1), 0, (17/8+3/2)(1/2)]^T = [1/2, 7/4, 0, 0, 1/2, 0, 29/16]^T$。\n$\\mathbf{F}_R = [\\rho_R u_{x,R}, \\rho_R u_{x,R}^2+p_{t,R}, \\dots]^T = [-1/2, 1(-1/4)+3/2, 0, 0, (-1/2)(-1), 0, (17/8+3/2)(-1/2)]^T = [-1/2, 7/4, 0, 0, 1/2, 0, -29/16]^T$。\n\n**步骤 2：计算信号速度**\n边界速度 $S_L$ 和 $S_R$ 由快磁声速确定。\n$S_L = \\min(u_{x,L} - c_{f,L}, u_{x,R} - c_{f,R})$\n$S_R = \\max(u_{x,L} + c_{f,L}, u_{x,R} + c_{f,R})$\n对于 $B_x=0$，$c_f^2 = (\\gamma p + B_y^2 + B_z^2)/\\rho$。\n$c_{f,L}^2 = ((5/3)(1) + 1^2)/1 = 8/3$。所以 $c_{f,L} = \\sqrt{8/3}$。\n$c_{f,R}^2 = ((5/3)(1) + (-1)^2)/1 = 8/3$。所以 $c_{f,R} = \\sqrt{8/3}$。\n$S_L = \\min(1/2 - \\sqrt{8/3}, -1/2 - \\sqrt{8/3}) = -1/2 - \\sqrt{8/3}$。\n$S_R = \\max(1/2 + \\sqrt{8/3}, -1/2 + \\sqrt{8/3}) = 1/2 + \\sqrt{8/3}$。\n注意由于对称性，$S_L = -S_R$。\n\n**步骤 3：计算 HLLE 通量**\n使用 $S_L = -S_R$，HLLE 通量公式简化为：\n$$\n\\mathbf{F}_{HLLE} = \\frac{S_R \\mathbf{F}_L + S_R \\mathbf{F}_R - S_R^2 (\\mathbf{U}_R - \\mathbf{U}_L)}{2S_R} = \\frac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R) - \\frac{S_R}{2}(\\mathbf{U}_R - \\mathbf{U}_L)\n$$\n首先，计算向量的和/差：\n$\\mathbf{F}_L + \\mathbf{F}_R = [1/2 - 1/2, 7/4 + 7/4, 0, 0, 1/2 + 1/2, 0, 29/16 - 29/16]^T = [0, 7/2, 0, 0, 1, 0, 0]^T$。\n$\\mathbf{U}_R - \\mathbf{U}_L = [1-1, -1/2 - 1/2, 0, 0, -1 - 1, 0, 17/8 - 17/8]^T = [0, -1, 0, 0, -2, 0, 0]^T$。\n\n现在，将这些代入简化的 HLLE 通量公式中：\n$$\n\\mathbf{F}_{HLLE} = \\frac{1}{2} \\begin{pmatrix} 0 \\\\ 7/2 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{1/2 + \\sqrt{8/3}}{2} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ -2 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$\\rho u_x$ 的通量分量为：$F_{\\rho u_x} = \\frac{1}{2}(\\frac{7}{2}) - \\frac{S_R}{2}(-1) = \\frac{7}{4} + \\frac{1}{2}(\\frac{1}{2} + \\sqrt{\\frac{8}{3}}) = \\frac{7}{4} + \\frac{1}{4} + \\frac{1}{2}\\frac{2\\sqrt{2}}{\\sqrt{3}} = 2 + \\frac{\\sqrt{6}}{3}$。\n$B_y$ 的通量分量为：$F_{B_y} = \\frac{1}{2}(1) - \\frac{S_R}{2}(-2) = \\frac{1}{2} + S_R = \\frac{1}{2} + \\frac{1}{2} + \\sqrt{\\frac{8}{3}} = 1 + \\frac{2\\sqrt{6}}{3}$。\n其他分量都是 0。\n\n最终的 HLLE 数值通量向量是：\n$$\n\\mathbf{F}_{HLLE} = \\left[ 0, \\ 2 + \\frac{\\sqrt{6}}{3}, \\ 0, \\ 0, \\ 1 + \\frac{2\\sqrt{6}}{3}, \\ 0, \\ 0 \\right]^T\n$$\n这些分量对应于 $(\\rho, \\rho u_x, \\rho u_y, \\rho u_z, B_y, B_z, E)$ 的通量。",
            "answer": "$$\n\\boxed{\\left[ 0, 2 + \\frac{\\sqrt{6}}{3}, 0, 0, 1 + \\frac{2\\sqrt{6}}{3}, 0, 0 \\right]^T}\n$$"
        },
        {
            "introduction": "最后的这个练习弥合了手动计算与计算实现之间的鸿沟。您将设计并实现一套诊断程序，用以监控黎曼求解器在面对经典的 Brio-Wu 激波管问题时的行为，该问题以暴露数值方法的脆弱性而闻名。本练习强调了在代码中构建稳健检查以检测和处理挑战性物理区域的重要性。",
            "id": "4041223",
            "problem": "考虑沿$x$方向的一维理想磁流体动力学（Magnetohydrodynamics (MHD)）黎曼问题，该问题适用于计算聚变科学与工程中使用的磁化激波管配置。守恒状态向量为 $U = (\\rho, \\rho v_x, \\rho v_y, \\rho v_z, E, B_x, B_y, B_z)$，其中 $\\rho$ 是质量密度，$(v_x, v_y, v_z)$ 是速度，$(B_x, B_y, B_z)$ 是磁场，$E$ 是总能量。假设理想气体定律成立，比热比为 $\\gamma$，并使用无量纲单位（无需物理单位）。沿 $x$ 方向的一维通量 $F(U)$ 由理想磁流体动力学（MHD）方程确定。设气体压力为 $p$，总压力为 $p_t = p + \\frac{1}{2} \\lVert B \\rVert^2$，并定义 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho \\lVert v \\rVert^2 + \\frac{1}{2}\\lVert B \\rVert^2$，其中 $\\lVert v \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ 且 $\\lVert B \\rVert^2 = B_x^2 + B_y^2 + B_z^2$。沿 $x$ 方向的通量分量为：\n$$F_\\rho = \\rho v_x,$$\n$$F_{\\rho v_x} = \\rho v_x^2 + p_t - B_x^2,$$\n$$F_{\\rho v_y} = \\rho v_x v_y - B_x B_y,$$\n$$F_{\\rho v_z} = \\rho v_x v_z - B_x B_z,$$\n$$F_E = (E + p_t) v_x - B_x (v_x B_x + v_y B_y + v_z B_z),$$\n$$F_{B_x} = 0,$$\n$$F_{B_y} = B_y v_x - B_x v_y,$$\n$$F_{B_z} = B_z v_x - B_x v_z.$$\n沿 $x$ 方向的一维理想磁流体动力学（MHD）本征结构包含七个特征速度。设声速的平方为 $a^2 = \\gamma p/\\rho$，基于总场的阿尔芬速度的平方为 $v_A^2 = \\lVert B \\rVert^2/\\rho$，沿 $x$ 方向的阿尔芬速度的平方为 $v_{Ax}^2 = B_x^2/\\rho$。快磁声速和慢磁声速由以下根求得：\n$$c_{f,s}^2 = \\frac{1}{2}\\left[a^2 + v_A^2 \\pm \\sqrt{(a^2 + v_A^2)^2 - 4 a^2 v_{Ax}^2}\\right],$$\n沿 $x$ 方向的阿尔芬速度为 $c_A = \\sqrt{v_{Ax}^2}$。七个特征速度为 $v_x \\pm c_f$、$v_x \\pm c_A$、$v_x \\pm c_s$ 和 $v_x$。当平方根的判别式趋近于零，或当特征速度合并时，会发生简并，这在 Brio–Wu 激波管配置附近、$B_x$ 很小或切向磁分量反转时很常见。\n\n任务。从上述守恒形式、通量形式以及理想磁流体动力学（MHD）本征结构定义出发，使用 Harten–Lax–van Leer (HLL) 双波近似实现一个近似黎曼求解器，并采用 Davis 波速估计 $S_L = \\min(v_{x,L} - c_{f,L}, v_{x,R} - c_{f,R})$ 和 $S_R = \\max(v_{x,L} + c_{f,L}, v_{x,R} + c_{f,R})$，其中下标 $L$ 和 $R$ 分别表示左态和右态。仅当 $S_L  0  S_R$ 时构造 HLL 中间状态 $U^\\star$，否则使用迎风通量。从 $U^\\star$ 计算隐含的中间密度 $\\rho^\\star$ 和气体压力 $p^\\star = (\\gamma - 1)\\left(E^\\star - \\frac{1}{2}\\rho^\\star \\lVert v^\\star \\rVert^2 - \\frac{1}{2}\\lVert B^\\star \\rVert^2\\right)$。\n\n为每个测试案例设计并计算以下诊断量：\n- 一个特征值间距诊断量，定义为左态和右态排序后特征速度之间的最小间隙，并用两个状态上最大绝对速度进行归一化：$$g = \\frac{\\min\\left(\\Delta \\lambda_L, \\Delta \\lambda_R\\right)}{\\max\\left(\\max|\\lambda_L|, \\max|\\lambda_R|, \\varepsilon\\right)},$$ 其中 $\\Delta \\lambda$ 是七个速度排序列表中的最小相邻差，$\\varepsilon$ 是为避免除以零而选择的一个小正数，取为 $\\varepsilon = 10^{-12}$。\n- 一个正性诊断量 $q$，当 HLL 中间状态存在时，若 $\\rho^\\star  0$ 且 $p^\\star  0$ 则等于 $1$；若未构造中间状态（即，纯粹使用迎风通量）也等于 $1$。否则置 $q = 0$。\n- 一个切向反转诊断量 $r$，如果 $B_{y,L} B_{y,R}  0$ 或 $B_{z,L} B_{z,R}  0$，则等于 $1$，否则为 $0$。\n- 一个特殊处理标志 $h$，如果 $g  10^{-3}$，或 $q = 0$，或（$r = 1$ 且 $|B_x|  10^{-2}$）中任意一个条件成立，则等于 $1$，否则为 $0$。\n\n您的程序必须为以下一系列左-右状态计算这些诊断量，所有案例中 $\\gamma = 2$ 且每个案例共享相同的 $B_x$，这些案例代表了典型、近简并和边界行为的测试套件：\n- 案例 $1$ (典型的类 Brio–Wu 问题): 左态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 1, 0)$；右态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 0.1, 0, 0, 0, 0.75, -1, 0)$。\n- 案例 $2$ (近简并 $B_x$): 与案例 $1$ 相同，但左、右态的 $B_x = 10^{-6}$。\n- 案例 $3$ (低压压力测试): 左态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 10^{-3}, 0, 0, 0, 0.75, 1, 0)$；右态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 10^{-6}, 0, 0, 0, 0.75, -1, 0)$。\n- 案例 $4$ (无切向场): 左态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 0, 0)$；右态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 0.1, 0, 0, 0, 0.75, 0, 0)$。\n- 案例 $5$ (状态相等): 左态等于右态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 0, 0)$。\n\n所有量均为无量纲。您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表形式的结果，其中每个测试案例贡献一个四元素列表 $[g, q, r, h]$，$g$ 以浮点数形式打印并四舍五入到六位小数，$q$、$r$、$h$ 以整数形式打印。因此，总的输出格式是一个列表的列表，例如 $[[g_1,q_1,r_1,h_1],[g_2,q_2,r_2,h_2],\\dots]$。",
            "solution": "问题陈述已经过仔细验证，并被确定是合理的。它在科学上基于理想磁流体动力学（MHD）的原理，在数学和算法上是适定的，并且表述客观。该问题提出了一个清晰、自洽的任务：实现一个标准的数值方法（HLL近似黎曼求解器），并为一系列与计算等离子体物理学相关的测试案例计算明确定义的诊断量。\n\n解决方案通过以结构化的方式实现指定的计算来推进。任务的核心是为每一对左（$L$）和右（$R$）初始状态，计算四个诊断量：一个特征值间距度量 $g$、一个解的正性度量 $q$、一个切向场反转度量 $r$ 以及一个复合的特殊处理标志 $h$。\n\n处理每个测试案例的逻辑流程如下：\n\n首先，我们必须表示流体状态。问题以原始变量 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z)$ 的形式提供了初始状态，其中 $\\rho$ 是质量密度，$p$ 是气体压力，$\\vec{v} = (v_x, v_y, v_z)$ 是速度矢量，$\\vec{B} = (B_x, B_y, B_z)$ 是磁场矢量。MHD 方程以守恒状态向量 $U = (\\rho, \\rho v_x, \\rho v_y, \\rho v_z, E, B_x, B_y, B_z)^T$ 的形式表述。总能量密度 $E$ 通过理想气体定律与原始变量相关联，比热比为 $\\gamma$：\n$$E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho \\lVert \\vec{v} \\rVert^2 + \\frac{1}{2}\\lVert \\vec{B} \\rVert^2$$\n其中 $\\lVert \\vec{v} \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ 且 $\\lVert \\vec{B} \\rVert^2 = B_x^2 + B_y^2 + B_z^2$。一个必要的初始步骤是将给定的左、右原始状态转换为它们的守恒向量形式 $U_L$ 和 $U_R$。\n\n其次，我们计算左、右两个状态的特征波速。这些速度是雅可比矩阵 $\\partial F / \\partial U$ 的特征值，决定了系统中信息的传播。问题提供了沿 $x$ 方向七个一维特征速度的标准公式：$v_x$、$v_x \\pm c_s$、$v_x \\pm c_A$ 和 $v_x \\pm c_f$。计算这些速度需要每个状态的几个中间物理量：\n1.  声速的平方，$a^2 = \\gamma p / \\rho$。\n2.  总磁场大小的平方，$\\lVert \\vec{B} \\rVert^2$。\n3.  总阿尔芬速度的平方，$v_A^2 = \\lVert \\vec{B} \\rVert^2 / \\rho$。\n4.  与法向磁场分量相关的阿尔芬速度的平方，$v_{Ax}^2 = B_x^2 / \\rho$。\n5.  快（$c_f$）和慢（$c_s$）磁声速由特征多项式的根导出：\n    $$c_{f,s}^2 = \\frac{1}{2}\\left[a^2 + v_A^2 \\pm \\sqrt{(a^2 + v_A^2)^2 - 4 a^2 v_{Ax}^2}\\right]$$\n    正根对应于 $c_f^2$，负根对应于 $c_s^2$。\n6.  沿 $x$ 方向的阿尔芬波速是 $c_A = \\sqrt{v_{Ax}^2} = |B_x|/\\sqrt{\\rho}$。\n\n为左、右两个状态都计算这七个速度。HLL 求解器的波速估计明确需要快磁声速 $c_{f,L}$ 和 $c_{f,R}$。\n\n第三，我们计算指定的四个诊断量，这需要实现 Harten-Lax-van Leer (HLL) 黎曼求解器逻辑。\n\n1.  **特征值间距诊断量 $g$**：该度量量化了特征速度之间的简并程度，这是数值困难的一个常见来源。对于每个状态（$L$ 和 $R$），我们形成一个包含七个特征值的排序列表 $\\lambda$。然后我们找到相邻特征值之间的最小差值，$\\Delta \\lambda = \\min_i (\\lambda_{i+1} - \\lambda_i)$。然后按如下方式计算诊断量 $g$：\n    $$g = \\frac{\\min\\left(\\Delta \\lambda_L, \\Delta \\lambda_R\\right)}{\\max\\left(\\max|\\lambda_L|, \\max|\\lambda_R|, \\varepsilon\\right)}$$\n    其中 $\\varepsilon$ 是一个小的正则化参数，给定为 $10^{-12}$。$g$ 值小表示两个或更多波速几乎相同。\n\n2.  **切向反转诊断量 $r$**：这是一个简单的检查，用于检测跨界面磁场切向分量是否存在符号变化：\n    $$r = 1 \\text{ if } (B_{y,L} B_{y,R}  0) \\text{ or } (B_{z,L} B_{z,R}  0), \\text{ otherwise } r = 0.$$\n    这种配置，特别是当与小的法向场 $B_x$ 结合时，可能对 MHD 求解器构成挑战。\n\n3.  **正性诊断量 $q$**：此诊断量验证 HLL 求解器是否保持密度和压力的物理正性。我们首先使用 Davis 估计计算 HLL 信号速度：\n    $$S_L = \\min(v_{x,L} - c_{f,L}, v_{x,R} - c_{f,R})$$\n    $$S_R = \\max(v_{x,L} + c_{f,L}, v_{x,R} + c_{f,R})$$\n    如果 $S_L  0  S_R$，则左、右状态被黎曼扇分开，必须计算一个中间 HLL 状态 $U^\\star$。该状态是从守恒定律的积分形式导出的平均值：\n    $$U^\\star = \\frac{S_R U_R - S_L U_L - (F_R - F_L)}{S_R - S_L}$$\n    其中 $F_L = F(U_L)$ 和 $F_R = F(U_R)$ 是使用所提供公式计算的通量向量。从 $U^\\star = (\\rho^\\star, (\\rho v_x)^\\star, \\dots, E^\\star, B_x^\\star, \\dots)^T$ 的分量中，我们提取中间密度 $\\rho^\\star$ 并计算中间速度 $\\vec{v}^\\star$ 和磁场 $\\vec{B}^\\star$。然后通过反转总能量关系找到中间气体压力 $p^\\star$：\n    $$p^\\star = (\\gamma - 1)\\left(E^\\star - \\frac{1}{2}\\rho^\\star \\lVert \\vec{v}^\\star \\rVert^2 - \\frac{1}{2}\\lVert \\vec{B}^\\star \\rVert^2\\right)$$\n    如果 $\\rho^\\star > 0$ 和 $p^\\star > 0$ 都成立，则诊断量 $q$ 设置为 $1$。否则，$q$ 为 $0$。如果不满足条件 $S_L  0  S_R$，则流动在一个方向上是超音速的，没有中间状态形成，根据问题定义，$q$ 设置为 $1$。\n\n4.  **特殊处理标志 $h$**：这是一个复合标志，聚合了由其他诊断量检测到的数值困难指标。如果以下任一条件满足，则设置为 $1$，否则为 $0$：\n    $$h = 1 \\text{ if } (g  10^{-3}) \\text{ or } (q = 0) \\text{ or } (r = 1 \\text{ and } |B_x|  10^{-2})$$\n\n这个完整的逻辑框架被应用于所提供的五个测试案例中的每一个，并将得到的四分量诊断向量 $[g, q, r, h]$ 按规定格式化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    gamma = 2.0\n    epsilon = 1e-12\n\n    test_cases = [\n        # Case 1: Canonical Brio-Wu-like\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 1.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 0.75, -1.0, 0.0)},\n        # Case 2: Near-degenerate Bx\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 1e-6, 1.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 1e-6, -1.0, 0.0)},\n        # Case 3: Low-pressure stress test\n        {'p_left': (1.0, 1e-3, 0.0, 0.0, 0.0, 0.75, 1.0, 0.0),\n         'p_right': (0.125, 1e-6, 0.0, 0.0, 0.0, 0.75, -1.0, 0.0)},\n        # Case 4: No tangential field\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0)},\n        # Case 5: Equal states\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0),\n         'p_right': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0)}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = compute_diagnostics(case['p_left'], case['p_right'], gamma, epsilon)\n        all_results.append(result)\n\n    formatted_results = []\n    for res in all_results:\n        g, q, r, h = res\n        formatted_results.append(f\"[{g:.6f},{q},{r},{h}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\ndef primitive_to_conservative(prim, gamma):\n    \"\"\"\n    Converts primitive variables to conservative variables.\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    v_sq = vx**2 + vy**2 + vz**2\n    B_sq = Bx**2 + By**2 + Bz**2\n    E = p / (gamma - 1) + 0.5 * rho * v_sq + 0.5 * B_sq\n    return np.array([rho, rho * vx, rho * vy, rho * vz, E, Bx, By, Bz])\n\ndef calculate_flux(prim, cons, gamma):\n    \"\"\"\n    Calculates the 1D MHD flux vector F(U).\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    E = cons[4]\n    B_sq = Bx**2 + By**2 + Bz**2\n    pt = p + 0.5 * B_sq\n    v_dot_B = vx * Bx + vy * By + vz * Bz\n    F = np.zeros(8)\n    F[0] = rho * vx\n    F[1] = rho * vx**2 + pt - Bx**2\n    F[2] = rho * vx * vy - Bx * By\n    F[3] = rho * vx * vz - Bx * Bz\n    F[4] = (E + pt) * vx - Bx * v_dot_B\n    F[5] = 0\n    F[6] = By * vx - Bx * vy\n    F[7] = Bz * vx - Bx * vz\n    return F\n\ndef calculate_speeds(prim, gamma):\n    \"\"\"\n    Calculates the seven characteristic speeds.\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    if rho = 0:\n        return np.zeros(7), 0.0\n    a2 = gamma * p / rho\n    B_sq = Bx**2 + By**2 + Bz**2\n    va2 = B_sq / rho\n    vax2 = Bx**2 / rho\n    term = (a2 + va2)**2 - 4 * a2 * vax2\n    discriminant_sqrt = np.sqrt(max(0, term))\n    cf2 = 0.5 * (a2 + va2 + discriminant_sqrt)\n    cs2 = 0.5 * (a2 + va2 - discriminant_sqrt)\n    cf = np.sqrt(cf2)\n    cs = np.sqrt(cs2)\n    ca = np.sqrt(vax2)\n    speeds = sorted([vx - cf, vx + cf, vx - ca, vx + ca, vx - cs, vx + cs, vx])\n    return np.array(speeds), cf\n\ndef compute_diagnostics(p_left, p_right, gamma, epsilon):\n    \"\"\"\n    Computes the diagnostics g, q, r, h for a given left/right state.\n    \"\"\"\n    rho_L, p_L, vx_L, vy_L, vz_L, Bx_L, By_L, Bz_L = p_left\n    rho_R, p_R, vx_R, vy_R, vz_R, Bx_R, By_R, Bz_R = p_right\n    \n    speeds_L, cf_L = calculate_speeds(p_left, gamma)\n    speeds_R, cf_R = calculate_speeds(p_right, gamma)\n    \n    diff_L = np.diff(speeds_L)\n    diff_R = np.diff(speeds_R)\n    delta_lambda_L = np.min(diff_L) if diff_L.size > 0 else np.inf\n    delta_lambda_R = np.min(diff_R) if diff_R.size > 0 else np.inf\n    \n    min_delta_lambda = min(delta_lambda_L, delta_lambda_R)\n    max_abs_speed = max(np.max(np.abs(speeds_L)), np.max(np.abs(speeds_R)), epsilon)\n    g = min_delta_lambda / max_abs_speed\n\n    r = 1 if (By_L * By_R  0) or (Bz_L * Bz_R  0) else 0\n\n    S_L = min(vx_L - cf_L, vx_R - cf_R)\n    S_R = max(vx_L + cf_L, vx_R + cf_R)\n    \n    q = 1\n    if S_L  0  S_R:\n        U_L = primitive_to_conservative(p_left, gamma)\n        U_R = primitive_to_conservative(p_right, gamma)\n        F_L = calculate_flux(p_left, U_L, gamma)\n        F_R = calculate_flux(p_right, U_R, gamma)\n        U_star = (S_R * U_R - S_L * U_L - (F_R - F_L)) / (S_R - S_L)\n\n        rho_star = U_star[0]\n        if rho_star = 0:\n            q = 0\n        else:\n            mom_x_star, mom_y_star, mom_z_star = U_star[1:4]\n            E_star, Bx_star, By_star, Bz_star = U_star[4:8]\n            v_sq_star = (mom_x_star**2 + mom_y_star**2 + mom_z_star**2) / rho_star**2\n            B_sq_star = Bx_star**2 + By_star**2 + Bz_star**2\n            p_star = (gamma - 1) * (E_star - 0.5 * rho_star * v_sq_star - 0.5 * B_sq_star)\n            if p_star = 0:\n                q = 0\n    \n    Bx = Bx_L \n    h = 1 if (g  1e-3) or (q == 0) or (r == 1 and abs(Bx)  1e-2) else 0\n\n    return [g, q, r, h]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}