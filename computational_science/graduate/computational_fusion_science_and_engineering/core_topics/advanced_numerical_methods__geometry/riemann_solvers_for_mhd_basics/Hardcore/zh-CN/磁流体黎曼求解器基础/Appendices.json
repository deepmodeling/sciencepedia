{
    "hands_on_practices": [
        {
            "introduction": "在我们着手数值求解磁流体动力学（MHD）方程之前，我们必须首先理解其解中出现的物理结构。本练习将引导你推导Rankine-Hugoniot跳跃关系，这些关系是控制等离子体中激波和其他间断的基本“交通规则”。掌握这些关系是正确解读模拟结果和理解黎曼求解器物理基础的关键。",
            "id": "4041150",
            "problem": "考虑理想磁流体力学（MHD），针对磁导率被缩放为 $\\mu_0 = 1$ 的理想导电等离子体。其控制方程的守恒形式由质量守恒、动量守恒、磁感应守恒和总能量守恒，以及磁场的无散约束给出。假设存在一个平面间断，其单位法向量为 $\\boldsymbol{n}$，以恒定速度 $S$ 传播。用下标 L 和 R 表示左、右两边的状态，相对于 $\\boldsymbol{n}$ 的法向和切向分量分别用下标 n 和 t 表示。利用穿过与间断相交的移动控制体的积分守恒定律，根据跳跃量 $[q] \\equiv q_R - q_L$ 和沿法向投影的通量，推导理想 MHD 的 Rankine–Hugoniot 跳跃条件。然后，利用这些跳跃关系，指明用于区分理想 MHD 中激波、接触间断和旋转间断的速度和磁场法向分量的定义条件。\n\n选择正确陈述了跳跃关系和分类条件的选项。\n\nA) 对于一个以速度 $S$ 沿法线 $\\boldsymbol{n}$（选择坐标系使得 $\\boldsymbol{n} = \\hat{\\boldsymbol{x}}$）移动的间断，其跳跃条件为\n- 质量：$S\\,[\\rho] = [\\rho v_n]$。\n- 法向动量：$S\\,[\\rho v_n] = [\\rho v_n^2 + p + \\tfrac{1}{2} B^2 - B_n^2]$。\n- 切向动量：$S\\,[\\rho v_t] = [\\rho v_n v_t - B_n B_t]$，对每个切向方向成立。\n- 感应方程（法向）：$S\\,[B_n] = 0$，意味着 $[B_n] = 0$。\n- 感应方程（切向）：$S\\,[B_t] = [v_n B_t - B_n v_t]$，对每个切向方向成立。\n- 能量：$S\\,[E] = \\big[(E + p + \\tfrac{1}{2} B^2)\\,v_n - B_n (\\boldsymbol{B}\\cdot \\boldsymbol{v})\\big]$，\n其中 $E = \\tfrac{p}{\\gamma - 1} + \\tfrac{1}{2} \\rho v^2 + \\tfrac{1}{2} B^2$ 且 $p_t \\equiv p + \\tfrac{1}{2} B^2$ 是总（气体加磁）压强。按法向分量分类：\n- 激波：非零质量通量 $m \\equiv \\rho\\,(v_n - S) \\neq 0$，且 $[B_n] = 0$，通常 $[v_n] \\neq 0$。\n- 接触间断：零质量通量 $m = 0$，等价于两边都有 $v_n = S$，且 $[B_n] = 0$。\n- 旋转间断：非零质量通量 $m \\neq 0$，法向磁场连续且非零 $[B_n] = 0$ 且 $B_n \\neq 0$，法向速度连续 $[v_n] = 0$（切向 $\\boldsymbol{v}$ 和 $\\boldsymbol{B}$ 旋转，满足 Walén 关系）。\n\nB) 跳跃条件为\n- 质量：$S\\,[\\rho] = [\\rho v_n]$。\n- 法向动量：$S\\,[\\rho v_n] = [\\rho v_n^2 + p - \\tfrac{1}{2} B^2]$。\n- 切向动量：$S\\,[\\rho v_t] = [\\rho v_n v_t + B_n B_t]$。\n- 感应方程（法向）：$S\\,[B_n] = [v_n B_n]$，所以 $[B_n]$ 可以非零。\n- 感应方程（切向）：$S\\,[B_t] = [v_t B_t]$。\n- 能量：$S\\,[E] = \\big[(E + p)\\,v_n\\big]$。\n按法向分量分类：\n- 激波：$[v_n] = 0$ 且 $[B_n] \\neq 0$。\n- 接触间断：$v_n = S$ 且 $B_n = 0$。\n- 旋转间断：$[v_n] \\neq 0$ 且 $B_n = 0$。\n\nC) 跳跃条件为\n- 质量：$S\\,[\\rho] = [\\rho v_n]$。\n- 法向动量：$S\\,[\\rho v_n] = [\\rho v_n^2 + p]$。\n- 切向动量：$S\\,[\\rho v_t] = [\\rho v_n v_t]$。\n- 感应方程（法向）：$[B_n] = 0$。\n- 感应方程（切向）：$S\\,[B_t] = [B_n v_t - v_n B_t]$。\n- 能量：$S\\,[E] = [(E + p)\\,v_n]$。\n按法向分量分类：\n- 激波：$m \\equiv \\rho (v_n - S) = 0$，$[B_n] = 0$。\n- 接触间断：$m \\neq 0$，$[B_n] = 0$。\n- 旋转间断：$m \\neq 0$ 且 $B_n = 0$ 和 $[v_n] \\neq 0$。\n\nD) 跳跃条件为\n- 质量：$S\\,[\\rho] = [\\rho v_n]$。\n- 法向动量：$S\\,[\\rho v_n] = [\\rho v_n^2 + p + \\tfrac{1}{2} B^2]$。\n- 切向动量：$S\\,[\\rho v_t] = [\\rho v_n v_t - B_t^2]$。\n- 感应方程（法向）：$S\\,[B_n] = 0$。\n- 感应方程（切向）：$S\\,[B_t] = [v_n B_t + B_n v_t]$。\n- 能量：$S\\,[E] = \\big[(E + p + \\tfrac{1}{2} B^2)\\,v_n\\big]$。\n按法向分量分类：\n- 激波：$m \\neq 0$ 且 $[B_n] \\neq 0$。\n- 接触间断：$m = 0$ 且 $[v_n] \\neq 0$。\n- 旋转间断：$m = 0$，$B_n \\neq 0$ 且 $[v_n] = 0$。\n\n选择正确的选项。",
            "solution": "用户要求推导理想磁流体力学（MHD）的 Rankine-Hugoniot 跳跃条件，并基于这些条件对间断进行分类。\n\n### 第1部分：Rankine-Hugoniot 条件的推导\n\n理想 MHD 方程的守恒形式为：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\nabla \\cdot \\boldsymbol{F} = \\boldsymbol{0}\n$$\n其中 $\\boldsymbol{U}$ 是守恒状态变量的向量，$\\boldsymbol{F}$ 是通量张量。对于一个沿单位法向量 $\\boldsymbol{n}$ 方向以恒定速度 $S$ 传播的平面间断，Rankine-Hugoniot 跳跃条件由作用在随间断移动的微小控制体上的积分形式守恒定律推导得出。这得到了普适关系：\n$$\nS [q] = [F_n(q)]\n$$\n其中 $[q] \\equiv q_R - q_L$ 表示物理量 $q$ 穿过间断（从左态 L 到右态 R）的跳跃，而 $F_n(q) = \\boldsymbol{F}(q) \\cdot \\boldsymbol{n}$ 是垂直于间断面的通量分量。我们建立一个坐标系，其中 $\\boldsymbol{n} = \\hat{\\boldsymbol{x}}$，所以法向是 x 方向。法向速度是 $v_n$，法向磁场是 $B_n$。\n\n我们来推导每个守恒量的跳跃条件。磁导率设为 $\\mu_0 = 1$。\n\n1.  **质量守恒：**\n    守恒量是质量密度 $\\rho$，质量通量是 $\\rho \\boldsymbol{v}$。\n    跳跃条件是 $S[\\rho] = [\\rho v_n]$。\n\n2.  **动量守恒：**\n    守恒量是动量密度 $\\rho \\boldsymbol{v}$。动量通量张量是 $\\boldsymbol{\\Pi} = \\rho \\boldsymbol{v} \\boldsymbol{v} + p_{tot}\\boldsymbol{I} - \\boldsymbol{B}\\boldsymbol{B}$，其中 $p_{tot} = p + \\frac{1}{2}B^2$ 是总压强（气体压强加磁压强），$\\boldsymbol{I}$ 是单位张量。\n    穿过该面的动量通量是 $\\boldsymbol{\\Pi} \\cdot \\boldsymbol{n}$。\n    -   **法向动量：** 垂直于该面的动量分量是 $\\rho v_n$。相应的法向通量是 $\\boldsymbol{n} \\cdot (\\boldsymbol{\\Pi} \\cdot \\boldsymbol{n}) = \\rho v_n^2 + p_{tot} - B_n^2$。代入 $p_{tot} = p + \\frac{1}{2}B^2$，通量为 $\\rho v_n^2 + p + \\frac{1}{2}B^2 - B_n^2$。\n        跳跃条件是 $S[\\rho v_n] = [\\rho v_n^2 + p + \\frac{1}{2}B^2 - B_n^2]$。\n    -   **切向动量：** 平行于该面的动量分量是 $\\rho \\boldsymbol{v}_t$。对于任意切向方向 $\\boldsymbol{t}$，相应的法向通量是 $\\boldsymbol{t} \\cdot (\\boldsymbol{\\Pi} \\cdot \\boldsymbol{n}) = \\rho v_n \\boldsymbol{v}_t - B_n \\boldsymbol{B}_t$。\n        跳跃条件是 $S[\\rho \\boldsymbol{v}_t] = [\\rho v_n \\boldsymbol{v}_t - B_n \\boldsymbol{B}_t]$。\n\n3.  **磁通量守恒（感应方程）：**\n    理想导体的感应方程是 $\\frac{\\partial \\boldsymbol{B}}{\\partial t} = \\nabla \\times (\\boldsymbol{v} \\times \\boldsymbol{B})$。这可以写成守恒形式 $\\frac{\\partial \\boldsymbol{B}}{\\partial t} + \\nabla \\cdot (\\boldsymbol{v}\\boldsymbol{B} - \\boldsymbol{B}\\boldsymbol{v}) = \\boldsymbol{0}$。\n    -   **法向分量：** 守恒量是 $B_n$。法向通量是 $(\\boldsymbol{v}\\boldsymbol{B} - \\boldsymbol{B}\\boldsymbol{v}) \\cdot \\boldsymbol{n}$ 的法向分量，即 $v_n B_n - B_n v_n = 0$。\n        跳跃条件是 $S[B_n] = [0] = 0$。这意味着 $[B_n] = 0$，即磁场的法向分量在穿过间断时总是连续的。这也可以通过对跨越界面的一个“药丸盒”体积积分无散约束 $\\nabla \\cdot \\boldsymbol{B} = 0$ 直接得出。\n    -   **切向分量：** 守恒量是 $\\boldsymbol{B}_t$。法向通量是 $(\\boldsymbol{v}\\boldsymbol{B} - \\boldsymbol{B}\\boldsymbol{v}) \\cdot \\boldsymbol{n}$ 的切向分量，即 $v_n \\boldsymbol{B}_t - B_n \\boldsymbol{v}_t$。\n        跳跃条件是 $S[\\boldsymbol{B}_t] = [v_n \\boldsymbol{B}_t - B_n \\boldsymbol{v}_t]$。\n\n4.  **能量守恒：**\n    守恒量是总能量密度 $E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho v^2 + \\frac{1}{2}B^2$。能量通量向量是 $\\boldsymbol{F}_E = (E + p + \\frac{1}{2}B^2)\\boldsymbol{v} - (\\boldsymbol{v} \\cdot \\boldsymbol{B})\\boldsymbol{B}$。\n    能量通量的法向分量是 $F_{E,n} = (E + p + \\frac{1}{2}B^2)v_n - (\\boldsymbol{v} \\cdot \\boldsymbol{B})B_n$。\n    跳跃条件是 $S[E] = [(E + p + \\frac{1}{2}B^2)v_n - (\\boldsymbol{v} \\cdot \\boldsymbol{B})B_n]$。\n\n### 第2部分：间断的分类\n\n在与间断共同移动的参考系中分析跳跃条件会很方便。在这个参考系中，速度为 $\\boldsymbol{u} = \\boldsymbol{v} - S\\boldsymbol{n}$，因此法向速度为 $u_n = v_n - S$。间断是静止的，因此跳跃条件简化为 $[\\boldsymbol{F}_n - S\\boldsymbol{U}] = 0$。一个关键量是穿过间断的质量通量，$m = \\rho u_n = \\rho(v_n - S)$，它必须在界面两边保持不变：$[\\rho u_n] = 0 \\implies m_L = m_R = m$。\n\n间断的分类基于 $m$、$B_n$ 以及法向速度跳跃量 $[v_n]$ 的性质。\n\n1.  **接触间断（和切向间断）：**\n    它们的特征是穿过间断的质量通量为零，$m = 0$。由于密度 $\\rho$ 必须是有限且非零的，这意味着在两边都有 $u_n = v_n - S = 0$。因此，流体垂直于界面的速度等于界面的速度，$v_n = S$，且法向速度没有跳跃，$[v_n] = 0$。等离子体不穿过该表面。密度、温度、压强以及速度和磁场的切向分量可能存在跳跃，但需满足总法向压强连续 $[p + \\frac{1}{2}B_t^2] = 0$（如果 $B_n=0$）及其他约束。定义条件是 $m = 0$。\n\n2.  **激波（快激波和慢激波）：**\n    激波是压缩性间断，其特征是质量通量非零，$m \\neq 0$。等离子体流过间断，其热力学性质（密度 $\\rho$、压强 $p$）会突然改变。根据质量守恒关系 $[\\rho u_n] = 0$，密度的跳跃 $[\\rho] \\neq 0$ 意味着在波参考系中法向速度存在跳跃 $[u_n] \\neq 0$。由于 $u_n = v_n - S$，这意味着 $[v_n] \\neq 0$。激波是不可逆的，并伴随着熵的增加。定义条件是 $m \\neq 0$ 和 $[v_n] \\neq 0$。\n\n3.  **旋转间断（Alfvén 波）：**\n    旋转间断的特征也是质量通量非零，$m \\neq 0$。然而，与激波不同，它们是非压缩性的。这意味着密度在界面上是连续的，$[\\rho] = 0$。根据质量守恒关系 $[\\rho u_n] = 0$，如果 $[\\rho]=0$ 且 $\\rho \\neq 0$，则必然有 $[u_n] = 0$，这意味着 $[v_n] = 0$。要存在一个非平凡的旋转间断，法向磁场必须非零，$B_n \\neq 0$。穿过间断时，磁场 $\\boldsymbol{B}_t$ 和速度 $\\boldsymbol{v}_t$ 的切向分量发生旋转。定义条件是 $m \\neq 0$、$[v_n] = 0$ 和 $B_n \\neq 0$。\n\n### 逐项分析\n\n-   **选项 A：**\n    -   **跳跃条件：** 所列出的质量、动量（法向和切向）、磁感应（法向和切向）和能量的所有跳跃条件都与我们的推导完全匹配。\n    -   **分类：**\n        -   激波：$m \\neq 0$ 且 $[v_n] \\neq 0$。正确。\n        -   接触间断：$m = 0$。正确。\n        -   旋转间断：$m \\neq 0$，$B_n \\neq 0$ 且 $[v_n] = 0$。正确。\n    -   **结论：** **正确**。\n\n-   **选项 B：**\n    -   **跳跃条件：** 法向动量通量缺少 $-B_n^2$ 项。切向动量通量的磁场项符号错误。法向感应条件错误地允许 $[B_n] \\neq 0$，这违反了 $\\nabla \\cdot \\boldsymbol{B} = 0$。切向感应通量不正确。能量通量缺少所有磁场项。\n    -   **分类：** 分类标准存在根本性错误。激波有 $[v_n] \\neq 0$，而不是 $[v_n]=0$。旋转间断有 $[v_n]=0$ 和 $B_n \\neq 0$。\n    -   **结论：** **不正确**。\n\n-   **选项 C：**\n    -   **跳跃条件：** 动量和能量通量是纯流体力学的表达式，完全忽略了磁效应。切向感应条件的符号不正确。\n    -   **分类：** 激波和接触间断关于 $m$ 的作用被颠倒了。旋转间断的条件不正确（$B_n=0$ 会使其成为垂直激波或切向间断）。\n    -   **结论：** **不正确**。\n\n-   **选项 D：**\n    -   **跳跃条件：** 法向动量通量缺少 $-B_n^2$ 项。切向动量通量不正确。切向感应通量的符号不正确。能量通量缺少磁功/坡印亭通量项 $-B_n(\\boldsymbol{B} \\cdot \\boldsymbol{v})$。\n    -   **分类：** 激波的条件 $[B_n] \\neq 0$ 是错误的。接触间断的条件（$m=0$ 和 $[v_n] \\neq 0$）是相互矛盾的。旋转间断的条件 $m=0$ 是错误的。\n    -   **结论：** **不正确**。\n\n基于详细的推导和分析，只有选项 A 同时给出了理想 MHD 正确的 Rankine-Hugoniot 跳跃条件和主要间断类型的正确分类。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在理解了间断的物理性质之后，我们转向其数值近似问题。本练习将探讨一个MHD中常见且具有挑战性的情况：法向磁场$B_x$趋近于零，这会导致波速的简并。你将应用一个为此类情况设计的鲁棒求解器——Harten-Lax-van Leer-Einfeldt (HLLE)方法，为一个特定的黎曼问题计算数值通量。",
            "id": "4041169",
            "problem": "考虑沿 $x$ 方向的笛卡尔坐标系中的一维理想磁流体力学（MHD）黎曼问题，使用无量纲单位，其中磁导率为1，所有物理量均以程序单位表示。理想MHD的守恒状态向量和沿 $x$ 方向的通量由标准守恒律定义，其总能量、动量和磁场与无散磁场（$\\partial B_x/\\partial x = 0$）条件一致。绝热指数为 $\\gamma = 5/3$。在界面 $x=0$ 处的左右原始变量状态是对称的，由下式给出：\n$$\n\\rho_L = 1,\\quad p_L = 1,\\quad u_{x,L} = \\frac{1}{2},\\quad u_{y,L} = 0,\\quad u_{z,L} = 0,\\quad B_{x} = 0,\\quad B_{y,L} = 1,\\quad B_{z,L} = 0,\n$$\n$$\n\\rho_R = 1,\\quad p_R = 1,\\quad u_{x,R} = -\\frac{1}{2},\\quad u_{y,R} = 0,\\quad u_{z,R} = 0,\\quad B_{x} = 0,\\quad B_{y,R} = -1,\\quad B_{z,R} = 0.\n$$\n从理想MHD方程的守恒形式和特征波族出发，解释在 $B_x \\to 0$ 极限下的简并性及预期的复合波行为，并论证在此简并极限下使用双波 Harten–Lax–van Leer–Einfeldt (HLLE) 黎曼求解器以保证鲁棒性的原因。然后，使用根据给定的左右状态自洽计算出的快磁声波边界速度，计算在 $x=0$ 处 HLLE 数值通量向量，其守恒变量的顺序为：\n$$\n\\left[\\rho,\\ \\rho u_x,\\ \\rho u_y,\\ \\rho u_z,\\ B_y,\\ B_z,\\ E\\right],\n$$\n其中总能量为 $E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho\\left(u_x^2 + u_y^2 + u_z^2\\right) + \\frac{1}{2}\\left(B_x^2 + B_y^2 + B_z^2\\right)$，总能量的 $x$ 方向通量为 $(E + p_t)u_x - B_x(u_x B_x + u_y B_y + u_z B_z)$，其中 $p_t = p + \\frac{1}{2}(B_x^2 + B_y^2 + B_z^2)$。以精确解析形式表示最终通量。最终答案不包含单位，且不要四舍五入。",
            "solution": "该问题被评估为有效。这是一个来自计算磁流体力学领域的适定、有科学依据的问题，提供了所有必要数据，且没有内部矛盾。\n\n解答过程分为两部分。首先，解释在引导场为零（$B_x \\to 0$）极限下的波的简并性，并说明使用HLLE求解器的理由。其次，详细计算给定初始条件下的HLLE通量向量。\n\n一维理想MHD方程的守恒形式如下：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}}{\\partial x} = 0\n$$\n其中 $\\mathbf{U}$ 是守恒变量向量，$\\mathbf{F}$ 是通量向量。对于本问题，它们是：\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u_x \\\\ \\rho u_y \\\\ \\rho u_z \\\\ B_y \\\\ B_z \\\\ E \\end{pmatrix}, \\quad \n\\mathbf{F} = \\begin{pmatrix} \\rho u_x \\\\ \\rho u_x^2 + p_t - B_x^2 \\\\ \\rho u_x u_y - B_x B_y \\\\ \\rho u_x u_z - B_x B_z \\\\ u_x B_y - u_y B_x \\\\ u_x B_z - u_z B_x \\\\ (E + p_t) u_x - B_x (\\mathbf{u} \\cdot \\mathbf{B}) \\end{pmatrix}\n$$\n该系统包含七个特征波族。这些波的速度是雅可比矩阵 $\\mathbf{A} = \\partial \\mathbf{F} / \\partial \\mathbf{U}$ 的特征值。七个特征速度是：\n$$\n\\lambda_{1,7} = u_x \\mp c_f, \\quad \\lambda_{2,6} = u_x \\mp v_{Ax}, \\quad \\lambda_{3,5} = u_x \\mp c_{ms}, \\quad \\lambda_4 = u_x\n$$\n其中 $u_x$ 是流体速度，$v_{Ax} = |B_x|/\\sqrt{\\rho}$ 是阿尔芬速度，$c_f$ 和 $c_{ms}$ 分别是快磁声速和慢磁声速。这些速度由以下公式给出：\n$$\nc_{f,ms}^2 = \\frac{1}{2} \\left( c_s^2 + c_b^2 \\pm \\sqrt{(c_s^2 + c_b^2)^2 - 4 c_s^2 v_{Ax}^2} \\right)\n$$\n其中声速为 $c_s^2 = \\gamma p / \\rho$，总磁场速度为 $c_b^2 = (B_x^2 + B_y^2 + B_z^2)/\\rho = v_{Ax}^2 + (B_y^2 + B_z^2)/\\rho$。\n\n在 $B_x \\to 0$ 的极限下，阿尔芬速度 $v_{Ax}$ 消失。这导致波速出现关键的简并：\n1. 平方根项变为 $\\sqrt{(c_s^2 + c_b^2)^2} = c_s^2 + c_b^2$。\n2. 快磁声速简化为 $c_f^2 = c_s^2 + c_b^2 = c_s^2 + (B_y^2 + B_z^2)/\\rho$。\n3. 慢磁声速变为 $c_{ms}^2 = 0$。\n4. 阿尔芬速度变为 $v_{Ax} = 0$。\n\n结果，七个特征速度的集合坍缩为：\n$$\n\\{ u_x - c_f, \\ u_x, \\ u_x, \\ u_x, \\ u_x, \\ u_x, \\ u_x + c_f \\}\n$$\n两个阿尔芬波、两个慢波和熵波都以流体速度 $u_x$ 传播。这种五重简并意味着相应的特征向量不再线性无关，系统的雅可比矩阵变得不可对角化。精确黎曼求解器和依赖于完全特征分解的近似求解器（如 Roe 求解器）在此极限下会失效，因为它们需要一套完整的线性无关的特征向量来投影状态向量的跳跃。\n\nHarten–Lax–van Leer–Einfeldt (HLLE) 求解器是一个鲁棒的替代方案。它不试图解析黎曼扇的详细波结构。相反，它假设一个简化的双波结构，由最快的向左传播（$S_L$）和向右传播（$S_R$）的信号速度界定。这两个信号之间的区域被视为一个单一的平均状态。HLLE 通量公式为：\n$$\n\\mathbf{F}_{HLLE} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\n这个公式只需要对边界速度（通常是最快的磁声速）进行估计，并且不依赖于中间波的特征向量。其鲁棒性源于这种简化，这使得它对 $B_x=0$ 时发生的波的简并不敏感。\n\n现在，我们为给定的问题计算 HLLE 通量。\n\n**第1步：计算左右状态向量和通量向量**\n绝热指数为 $\\gamma = 5/3$。\n左状态（$L$）的原始变量为：$\\rho_L=1, p_L=1, u_{x,L}=1/2, u_{y,L}=0, u_{z,L}=0, B_x=0, B_{y,L}=1, B_{z,L}=0$。\n右状态（$R$）的原始变量为：$\\rho_R=1, p_R=1, u_{x,R}=-1/2, u_{y,R}=0, u_{z,R}=0, B_x=0, B_{y,R}=-1, B_{z,R}=0$。\n\n每个状态的总能量 $E$ 为：\n$E_L = \\frac{p_L}{\\gamma-1} + \\frac{1}{2}\\rho_L(u_{x,L}^2+u_{y,L}^2+u_{z,L}^2) + \\frac{1}{2}(B_x^2+B_{y,L}^2+B_{z,L}^2) = \\frac{1}{2/3} + \\frac{1}{2}(1)(\\frac{1}{4}) + \\frac{1}{2}(1) = \\frac{3}{2} + \\frac{1}{8} + \\frac{1}{2} = \\frac{17}{8}$。\n由于对称性，$E_R = E_L = 17/8$。\n\n守恒状态向量 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 是：\n$\\mathbf{U}_L = [\\rho_L, \\rho_L u_{x,L}, \\rho_L u_{y,L}, \\rho_L u_{z,L}, B_{y,L}, B_{z,L}, E_L]^T = [1, 1/2, 0, 0, 1, 0, 17/8]^T$。\n$\\mathbf{U}_R = [\\rho_R, \\rho_R u_{x,R}, \\rho_R u_{y,R}, \\rho_R u_{z,R}, B_{y,R}, B_{z,R}, E_R]^T = [1, -1/2, 0, 0, -1, 0, 17/8]^T$。\n\n总压强 $p_t = p + \\frac{1}{2}(B_x^2+B_y^2+B_z^2)$：\n$p_{t,L} = 1 + \\frac{1}{2}(0^2+1^2+0^2) = 3/2$。\n$p_{t,R} = 1 + \\frac{1}{2}(0^2+(-1)^2+0^2) = 3/2$。\n\n通量向量 $\\mathbf{F}_L$ 和 $\\mathbf{F}_R$（$B_x=0$）：\n$\\mathbf{F}_L = [\\rho_L u_{x,L}, \\rho_L u_{x,L}^2+p_{t,L}, \\dots]^T = [1/2, 1(1/2)^2+3/2, 0, 0, (1/2)(1), 0, (17/8+3/2)(1/2)]^T = [1/2, 7/4, 0, 0, 1/2, 0, 29/16]^T$。\n$\\mathbf{F}_R = [\\rho_R u_{x,R}, \\rho_R u_{x,R}^2+p_{t,R}, \\dots]^T = [-1/2, 1(-1/2)^2+3/2, 0, 0, (-1/2)(-1), 0, (17/8+3/2)(-1/2)]^T = [-1/2, 7/4, 0, 0, 1/2, 0, -29/16]^T$。\n\n**第2步：计算信号速度**\n边界速度 $S_L$ 和 $S_R$ 由快磁声速确定。\n$S_L = \\min(u_{x,L} - c_{f,L}, u_{x,R} - c_{f,R})$\n$S_R = \\max(u_{x,L} + c_{f,L}, u_{x,R} + c_{f,R})$\n对于 $B_x=0$，$c_f^2 = (\\gamma p + B_y^2 + B_z^2)/\\rho$。\n$c_{f,L}^2 = ((5/3)(1) + 1^2)/1 = 8/3$。所以 $c_{f,L} = \\sqrt{8/3}$。\n$c_{f,R}^2 = ((5/3)(1) + (-1)^2)/1 = 8/3$。所以 $c_{f,R} = \\sqrt{8/3}$。\n$S_L = \\min(1/2 - \\sqrt{8/3}, -1/2 - \\sqrt{8/3}) = -1/2 - \\sqrt{8/3}$。\n$S_R = \\max(1/2 + \\sqrt{8/3}, -1/2 + \\sqrt{8/3}) = 1/2 + \\sqrt{8/3}$。\n注意，由于对称性，$S_L = -S_R$。\n\n**第3步：计算HLLE通量**\n使用 $S_L = -S_R$，HLLE 通量公式简化为：\n$$\n\\mathbf{F}_{HLLE} = \\frac{S_R \\mathbf{F}_L + S_R \\mathbf{F}_R - S_R^2 (\\mathbf{U}_R - \\mathbf{U}_L)}{2S_R} = \\frac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R) - \\frac{S_R}{2}(\\mathbf{U}_R - \\mathbf{U}_L)\n$$\n首先，计算向量的和/差：\n$\\mathbf{F}_L + \\mathbf{F}_R = [1/2 - 1/2, 7/4 + 7/4, 0, 0, 1/2 + 1/2, 0, 29/16 - 29/16]^T = [0, 7/2, 0, 0, 1, 0, 0]^T$。\n$\\mathbf{U}_R - \\mathbf{U}_L = [1-1, -1/2 - 1/2, 0, 0, -1 - 1, 0, 17/8 - 17/8]^T = [0, -1, 0, 0, -2, 0, 0]^T$。\n\n现在，将这些代入简化的 HLLE 通量公式中：\n$$\n\\mathbf{F}_{HLLE} = \\frac{1}{2} \\begin{pmatrix} 0 \\\\ 7/2 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{1/2 + \\sqrt{8/3}}{2} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ -2 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\mathbf{F}_{HLLE} = \\begin{pmatrix} 0 \\\\ 7/4 \\\\ 0 \\\\ 0 \\\\ 1/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\frac{1/2 + \\sqrt{8/3}}{2} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 7/4 + 1/4 + \\frac{1}{2}\\sqrt{8/3} \\\\ 0 \\\\ 0 \\\\ 1/2 + 1/2 + \\sqrt{8/3} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n简化非零分量：\n$\\rho u_x$ 的通量：$7/4 + 1/4 + \\frac{1}{2}\\frac{2\\sqrt{2}}{\\sqrt{3}} = 2 + \\frac{\\sqrt{2}}{\\sqrt{3}} = 2 + \\frac{\\sqrt{6}}{3}$。\n$B_y$ 的通量：$1/2 + 1/2 + \\sqrt{8/3} = 1 + \\frac{2\\sqrt{2}}{\\sqrt{3}} = 1 + \\frac{2\\sqrt{6}}{3}$。\n\n最终的 HLLE 数值通量向量为：\n$$\n\\mathbf{F}_{HLLE} = \\left[ 0, \\ 2 + \\frac{\\sqrt{6}}{3}, \\ 0, \\ 0, \\ 1 + \\frac{2\\sqrt{6}}{3}, \\ 0, \\ 0 \\right]^T\n$$\n这些分量对应于 $(\\rho, \\rho u_x, \\rho u_y, \\rho u_z, B_y, B_z, E)$ 的通量。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  2 + \\frac{\\sqrt{6}}{3}  0  0  1 + \\frac{2\\sqrt{6}}{3}  0  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最后的练习将从单个的通量计算，扩展到构建和验证一个可靠数值工具的综合挑战。你将为一个著名的基准问题——Brio-Wu激波管问题——实现一个求解器，该问题能检验代码处理复杂波结构的能力。更重要的是，你将设计并计算一套诊断程序，以自动检测数值计算中可能出现的困难，例如波速简并和非物理状态，这是任何计算科学家都需具备的关键技能。",
            "id": "4041223",
            "problem": "考虑沿 $x$ 方向的一维理想磁流体动力学（MHD）黎曼问题，该问题适用于计算聚变科学与工程中使用的磁化激波管构型。守恒状态向量为 $U = (\\rho, \\rho v_x, \\rho v_y, \\rho v_z, E, B_x, B_y, B_z)$，其中 $\\rho$ 是质量密度，$(v_x, v_y, v_z)$ 是速度，$(B_x, B_y, B_z)$ 是磁场， $E$ 是总能量。假设使用理想气体定律，比热比为 $\\gamma$，并采用无量纲单位（不需要物理单位）。$x$ 方向上的一维通量为 $F(U)$，由理想磁流体动力学（MHD）方程确定。设气体压力为 $p$，总压力为 $p_t = p + \\frac{1}{2} \\lVert B \\rVert^2$，并定义 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho \\lVert v \\rVert^2 + \\frac{1}{2}\\lVert B \\rVert^2$，其中 $\\lVert v \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ 且 $\\lVert B \\rVert^2 = B_x^2 + B_y^2 + B_z^2$。沿 $x$ 方向的通量分量为：\n$$F_\\rho = \\rho v_x,$$\n$$F_{\\rho v_x} = \\rho v_x^2 + p_t - B_x^2,$$\n$$F_{\\rho v_y} = \\rho v_x v_y - B_x B_y,$$\n$$F_{\\rho v_z} = \\rho v_x v_z - B_x B_z,$$\n$$F_E = (E + p_t) v_x - B_x (v_x B_x + v_y B_y + v_z B_z),$$\n$$F_{B_x} = 0,$$\n$$F_{B_y} = B_y v_x - B_x v_y,$$\n$$F_{B_z} = B_z v_x - B_x v_z.$$\n沿 $x$ 方向的一维理想磁流体动力学（MHD）特征结构包含七个特征速度。设声速的平方为 $a^2 = \\gamma p/\\rho$，基于总场的阿尔芬速度的平方为 $v_A^2 = \\lVert B \\rVert^2/\\rho$，沿 $x$ 方向的阿尔芬速度的平方为 $v_{Ax}^2 = B_x^2/\\rho$。快、慢磁声波速度由以下方程的根得出\n$$c_{f,s}^2 = \\frac{1}{2}\\left[a^2 + v_A^2 \\pm \\sqrt{(a^2 + v_A^2)^2 - 4 a^2 v_{Ax}^2}\\right],$$\n沿 $x$ 方向的阿尔芬速度为 $c_A = \\sqrt{v_{Ax}^2}$。七个特征速度为 $v_x \\pm c_f$、$v_x \\pm c_A$、$v_x \\pm c_s$ 和 $v_x$。当平方根的判别式趋近于零，或特征速度合并时，会发生简并现象。这种情况在 $B_x$ 很小或切向磁场分量反向的 Brio–Wu 激波管构型附近很常见。\n\n任务。从上述守恒形式、通量形式和理想磁流体动力学（MHD）特征结构定义出发，使用 Harten–Lax–van Leer (HLL) 双波近似方法实现一个近似黎曼求解器，其中波速估计采用 Davis 的方法：$S_L = \\min(v_{x,L} - c_{f,L}, v_{x,R} - c_{f,R})$ 和 $S_R = \\max(v_{x,L} + c_{f,L}, v_{x,R} + c_{f,R})$，下标 $L$ 和 $R$ 分别表示左、右状态。仅在 $S_L  0  S_R$ 时构造 HLL 中间状态 $U^\\star$，否则使用迎风通量。根据 $U^\\star$ 计算隐含的中间密度 $\\rho^\\star$ 和气体压力 $p^\\star = (\\gamma - 1)\\left(E^\\star - \\frac{1}{2}\\rho^\\star \\lVert v^\\star \\rVert^2 - \\frac{1}{2}\\lVert B^\\star \\rVert^2\\right)$。\n\n为每个测试用例设计并计算以下诊断量：\n- 一个特征值间距诊断量，定义为左、右状态排序后特征速度之间的最小间隙，并用两个状态的最大绝对速度进行归一化：$$g = \\frac{\\min\\left(\\Delta \\lambda_L, \\Delta \\lambda_R\\right)}{\\max\\left(\\max|\\lambda_L|, \\max|\\lambda_R|, \\varepsilon\\right)},$$ 其中 $\\Delta \\lambda$ 是七个速度排序列表中的最小相邻差值，$\\varepsilon$ 是一个为避免除以零而选择的小正数，取 $\\varepsilon = 10^{-12}$。\n- 一个正性诊断量 $q$，当 HLL 中间状态存在时，如果 $\\rho^\\star  0$ 和 $p^\\star  0$ 同时成立，则等于 $1$；如果未构造中间状态（即，纯粹使用迎风通量），也等于 $1$。否则，将 $q$ 设置为 $0$。\n- 一个切向反转诊断量 $r$，如果 $B_{y,L} B_{y,R}  0$ 或 $B_{z,L} B_{z,R}  0$，则等于 $1$，否则为 $0$。\n- 一个特殊处理标志 $h$，如果 $g  10^{-3}$，或 $q = 0$，或 $(r = 1$ 且 $|B_x|  10^{-2})$，则等于 $1$，否则为 $0$。\n\n您的程序必须为以下左-右状态集计算这些诊断量，所有用例中 $\\gamma = 2$ 且每个用例共享 $B_x$，这代表了一个测试套件，用于检验典型、近简并和边界行为：\n- 用例 1（典型的类 Brio–Wu）：左状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 1, 0)$；右状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 0.1, 0, 0, 0, 0.75, -1, 0)$。\n- 用例 2（近简并的 $B_x$）：与用例 1 相同，但左、右状态的 $B_x = 10^{-6}$。\n- 用例 3（低压压力测试）：左状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 10^{-3}, 0, 0, 0, 0.75, 1, 0)$；右状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 10^{-6}, 0, 0, 0, 0.75, -1, 0)$。\n- 用例 4（无切向场）：左状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 0, 0)$；右状态 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (0.125, 0.1, 0, 0, 0, 0.75, 0, 0)$。\n- 用例 5（相等状态）：左、右状态相等 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z) = (1, 1, 0, 0, 0, 0.75, 0, 0)$。\n\n所有量均为无量纲。您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个测试用例贡献一个四元素列表 $[g, q, r, h]$，$g$ 以浮点数形式打印并四舍五入到六位小数，$q$、$r$、$h$ 以整数形式打印。因此，整体输出格式是一个列表的列表，例如 $[[g_1,q_1,r_1,h_1],[g_2,q_2,r_2,h_2],\\dots]$。",
            "solution": "问题陈述经过了仔细验证，被确定是合理的。它在科学上基于理想磁流体动力学（MHD）的原理，在数学和算法上是适定的，并且表述客观。该问题提出了一个清晰、独立完整的任务：实现一个标准的数值方法（HLL近似黎曼求解器），并为一系列与计算等离子体物理相关的测试用例计算明确定义的诊断量。\n\n解决方案通过以结构化的方式实现指定的计算来推进。任务的核心是为每一对左（$L$）和右（$R$）初始状态，计算四个诊断量：特征值间距度量 $g$、解的正性度量 $q$、切向场反转度量 $r$ 以及一个复合的特殊处理标志 $h$。\n\n处理每个测试用例的逻辑流程如下：\n\n首先，我们必须表示流体状态。问题以原始变量 $(\\rho, p, v_x, v_y, v_z, B_x, B_y, B_z)$ 的形式提供了初始状态，其中 $\\rho$ 是质量密度，$p$ 是气体压力，$\\vec{v} = (v_x, v_y, v_z)$ 是速度矢量，$\\vec{B} = (B_x, B_y, B_z)$ 是磁场矢量。MHD 方程是根据守恒状态向量 $U = (\\rho, \\rho v_x, \\rho v_y, \\rho v_z, E, B_x, B_y, B_z)^T$ 来制定的。总能量密度 $E$ 通过理想气体定律与原始变量相关联，其中比热比为 $\\gamma$：\n$$E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho \\lVert \\vec{v} \\rVert^2 + \\frac{1}{2}\\lVert \\vec{B} \\rVert^2$$\n其中 $\\lVert \\vec{v} \\rVert^2 = v_x^2 + v_y^2 + v_z^2$ 且 $\\lVert \\vec{B} \\rVert^2 = B_x^2 + B_y^2 + B_z^2$。一个必要的初始步骤是将给定的左、右原始状态转换为它们的守恒向量形式 $U_L$ 和 $U_R$。\n\n其次，我们计算左、右两个状态的特征波速。这些速度是雅可比矩阵 $\\partial F / \\partial U$ 的特征值，决定了系统中信息的传播。问题提供了沿 $x$ 方向的七个一维特征速度的标准公式：$v_x$、$v_x \\pm c_s$、$v_x \\pm c_A$ 和 $v_x \\pm c_f$。计算这些速度需要每个状态的几个中间物理量：\n1.  声速的平方，$a^2 = \\gamma p / \\rho$。\n2.  总磁场大小的平方，$\\lVert \\vec{B} \\rVert^2$。\n3.  总阿尔芬速度的平方，$v_A^2 = \\lVert \\vec{B} \\rVert^2 / \\rho$。\n4.  与法向磁场分量相关的阿尔芬速度的平方，$v_{Ax}^2 = B_x^2 / \\rho$。\n5.  快 ($c_f$) 和慢 ($c_s$) 磁声波速度由一个特征多项式的根导出：\n    $$c_{f,s}^2 = \\frac{1}{2}\\left[a^2 + v_A^2 \\pm \\sqrt{(a^2 + v_A^2)^2 - 4 a^2 v_{Ax}^2}\\right]$$\n    正根对应于 $c_f^2$，负根对应于 $c_s^2$。\n6.  沿 $x$ 方向的阿尔芬波速为 $c_A = \\sqrt{v_{Ax}^2} = |B_x|/\\sqrt{\\rho}$。\n\n为左、右两个状态计算这七个速度。HLL 求解器的波速估计特别需要快磁声波速度 $c_{f,L}$ 和 $c_{f,R}$。\n\n第三，我们计算四个指定的诊断量，这需要实现 Harten-Lax-van Leer (HLL) 黎曼求解器逻辑。\n\n1.  **特征值间距诊断量 $g$**：此度量量化了特征速度之间的简并程度，这是数值困难的一个常见来源。对于每个状态（$L$ 和 $R$），我们形成一个包含七个特征值 $\\lambda$ 的排序列表。然后我们找到相邻特征值之间的最小差值，$\\Delta \\lambda = \\min_i (\\lambda_{i+1} - \\lambda_i)$。诊断量 $g$ 的计算公式如下：\n    $$g = \\frac{\\min\\left(\\Delta \\lambda_L, \\Delta \\lambda_R\\right)}{\\max\\left(\\max|\\lambda_L|, \\max|\\lambda_R|, \\varepsilon\\right)}$$\n    其中 $\\varepsilon$ 是一个小的正则化参数，给定为 $10^{-12}$。$g$ 值小表示两个或多个波速几乎相同。\n\n2.  **切向反转诊断量 $r$**：这是一个简单的检查，用于判断磁场切向分量在界面两侧是否存在符号变化：\n    $$r = 1 \\text{ if } (B_{y,L} B_{y,R}  0) \\text{ or } (B_{z,L} B_{z,R}  0), \\text{ otherwise } r = 0.$$\n    这种构型，特别是当与一个小的法向场 $B_x$ 结合时，可能对 MHD 求解器构成挑战。\n\n3.  **正性诊断量 $q$**：此诊断量验证 HLL 求解器是否保持了密度和压力的物理正性。我们首先使用 Davis 估计计算 HLL 信号速度：\n    $$S_L = \\min(v_{x,L} - c_{f,L}, v_{x,R} - c_{f,R})$$\n    $$S_R = \\max(v_{x,L} + c_{f,L}, v_{x,R} + c_{f,R})$$\n    如果 $S_L  0  S_R$，则左、右状态被黎曼扇分开，必须计算一个中间 HLL 状态 $U^\\star$。这个状态是从守恒律的积分形式导出的平均值：\n    $$U^\\star = \\frac{S_R U_R - S_L U_L - (F_R - F_L)}{S_R - S_L}$$\n    其中 $F_L = F(U_L)$ 和 $F_R = F(U_R)$ 是通量向量，使用提供的公式计算。从 $U^\\star = (\\rho^\\star, (\\rho v_x)^\\star, \\dots, E^\\star, B_x^\\star, \\dots)^T$ 的分量中，我们提取中间密度 $\\rho^\\star$ 并计算中间速度 $\\vec{v}^\\star$ 和磁场 $\\vec{B}^\\star$。然后通过反转总能量关系式求得中间气体压力 $p^\\star$：\n    $$p^\\star = (\\gamma - 1)\\left(E^\\star - \\frac{1}{2}\\rho^\\star \\lVert \\vec{v}^\\star \\rVert^2 - \\frac{1}{2}\\lVert \\vec{B}^\\star \\rVert^2\\right)$$\n    如果 $\\rho^\\star  0$ 和 $p^\\star  0$ 同时成立，则诊断量 $q$ 设置为 $1$。否则，$q$ 为 $0$。如果不满足 $S_L  0  S_R$ 的条件，则流动在一个方向上是超音速的，不会形成中间状态，根据问题定义，$q$ 设置为 $1$。\n\n4.  **特殊处理标志 $h$**：这是一个复合标志，它汇总了由其他诊断量检测到的数值困难指标。如果满足以下任一条件，则设置为 $1$，否则为 $0$：\n    $$h = 1 \\text{ if } (g  10^{-3}) \\text{ or } (q = 0) \\text{ or } (r = 1 \\text{ and } |B_x|  10^{-2})$$\n\n这个完整的逻辑框架被应用于所提供的五个测试用例中的每一个，并且生成的四分量诊断向量 $[g, q, r, h]$ 按指定格式输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    gamma = 2.0\n    epsilon = 1e-12\n\n    test_cases = [\n        # Case 1: Canonical Brio-Wu-like\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 1.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 0.75, -1.0, 0.0)},\n        # Case 2: Near-degenerate Bx\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 1e-6, 1.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 1e-6, -1.0, 0.0)},\n        # Case 3: Low-pressure stress test\n        {'p_left': (1.0, 1e-3, 0.0, 0.0, 0.0, 0.75, 1.0, 0.0),\n         'p_right': (0.125, 1e-6, 0.0, 0.0, 0.0, 0.75, -1.0, 0.0)},\n        # Case 4: No tangential field\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0),\n         'p_right': (0.125, 0.1, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0)},\n        # Case 5: Equal states\n        {'p_left': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0),\n         'p_right': (1.0, 1.0, 0.0, 0.0, 0.0, 0.75, 0.0, 0.0)}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = compute_diagnostics(case['p_left'], case['p_right'], gamma, epsilon)\n        all_results.append(result)\n\n    formatted_results = []\n    for res in all_results:\n        g, q, r, h = res\n        formatted_results.append(f\"[{g:.6f},{q},{r},{h}]\")\n    \n    print(f\"[[{','.join(formatted_results)}]]\")\n\ndef primitive_to_conservative(prim, gamma):\n    \"\"\"\n    Converts primitive variables (rho, p, vx, vy, vz, Bx, By, Bz)\n    to conservative variables (rho, rho*vx, rho*vy, rho*vz, E, Bx, By, Bz).\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    v_sq = vx**2 + vy**2 + vz**2\n    B_sq = Bx**2 + By**2 + Bz**2\n    \n    E = p / (gamma - 1) + 0.5 * rho * v_sq + 0.5 * B_sq\n    \n    return np.array([rho, rho * vx, rho * vy, rho * vz, E, Bx, By, Bz])\n\ndef calculate_flux(prim, cons, gamma):\n    \"\"\"\n    Calculates the 1D MHD flux vector F(U) in the x-direction.\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    E = cons[4]\n    \n    B_sq = Bx**2 + By**2 + Bz**2\n    pt = p + 0.5 * B_sq\n    v_dot_B = vx * Bx + vy * By + vz * Bz\n\n    F = np.zeros(8)\n    F[0] = rho * vx\n    F[1] = rho * vx**2 + pt - Bx**2\n    F[2] = rho * vx * vy - Bx * By\n    F[3] = rho * vx * vz - Bx * Bz\n    F[4] = (E + pt) * vx - Bx * v_dot_B\n    F[5] = 0\n    F[6] = By * vx - Bx * vy\n    F[7] = Bz * vx - Bx * vz\n    \n    return F\n\ndef calculate_speeds(prim, gamma):\n    \"\"\"\n    Calculates the seven characteristic speeds for a given state.\n    Returns a sorted list of speeds and the fast magnetosonic speed cf.\n    \"\"\"\n    rho, p, vx, vy, vz, Bx, By, Bz = prim\n    \n    if rho = 0:\n        return np.zeros(7), 0.0\n\n    a2 = gamma * p / rho\n    B_sq = Bx**2 + By**2 + Bz**2\n    va2 = B_sq / rho\n    vax2 = Bx**2 / rho\n    \n    # Ensure discriminant is non-negative\n    term = (a2 + va2)**2 - 4 * a2 * vax2\n    discriminant_sqrt = np.sqrt(max(0, term))\n    \n    cf2 = 0.5 * (a2 + va2 + discriminant_sqrt)\n    cs2 = 0.5 * (a2 + va2 - discriminant_sqrt)\n    \n    cf = np.sqrt(cf2)\n    cs = np.sqrt(cs2)\n    ca = np.sqrt(vax2)\n    \n    speeds = sorted([vx - cf, vx + cf, vx - ca, vx + ca, vx - cs, vx + cs, vx])\n    return np.array(speeds), cf\n\ndef compute_diagnostics(p_left, p_right, gamma, epsilon):\n    \"\"\"\n    Computes the diagnostics g, q, r, h for a given left/right state.\n    \"\"\"\n    # Unpack primitives\n    rho_L, p_L, vx_L, vy_L, vz_L, Bx_L, By_L, Bz_L = p_left\n    rho_R, p_R, vx_R, vy_R, vz_R, Bx_R, By_R, Bz_R = p_right\n    \n    # Diagnostic g: Eigenvalue spacing\n    speeds_L, cf_L = calculate_speeds(p_left, gamma)\n    speeds_R, cf_R = calculate_speeds(p_right, gamma)\n    \n    delta_lambda_L = np.min(np.diff(speeds_L)) if len(speeds_L)  1 else np.inf\n    delta_lambda_R = np.min(np.diff(speeds_R)) if len(speeds_R)  1 else np.inf\n    \n    min_delta_lambda = min(delta_lambda_L, delta_lambda_R)\n    max_abs_speed = max(np.max(np.abs(speeds_L)), np.max(np.abs(speeds_R)), epsilon)\n    \n    g = min_delta_lambda / max_abs_speed\n\n    # Diagnostic r: Tangential reversal\n    r = 1 if (By_L * By_R  0) or (Bz_L * Bz_R  0) else 0\n\n    # Diagnostic q: Positivity\n    S_L = min(vx_L - cf_L, vx_R - cf_R)\n    S_R = max(vx_L + cf_L, vx_R + cf_R)\n    \n    q = 1 # Default value\n    if S_L  0  S_R:\n        U_L = primitive_to_conservative(p_left, gamma)\n        U_R = primitive_to_conservative(p_right, gamma)\n        \n        F_L = calculate_flux(p_left, U_L, gamma)\n        F_R = calculate_flux(p_right, U_R, gamma)\n        \n        U_star = (S_R * U_R - S_L * U_L - (F_R - F_L)) / (S_R - S_L)\n\n        rho_star = U_star[0]\n        if rho_star = 0:\n            q = 0\n        else:\n            mom_x_star, mom_y_star, mom_z_star = U_star[1], U_star[2], U_star[3]\n            E_star = U_star[4]\n            Bx_star, By_star, Bz_star = U_star[5], U_star[6], U_star[7]\n            \n            v_sq_star = (mom_x_star**2 + mom_y_star**2 + mom_z_star**2) / rho_star**2\n            B_sq_star = Bx_star**2 + By_star**2 + Bz_star**2\n            \n            p_star = (gamma - 1) * (E_star - 0.5 * rho_star * v_sq_star - 0.5 * B_sq_star)\n            \n            if p_star = 0:\n                q = 0\n    else:\n        # Per problem, upwind case considered positive\n        q = 1\n\n    # Diagnostic h: Special handling flag\n    # Bx is common to left and right states\n    Bx = Bx_L \n    h = 1 if (g  1e-3) or (q == 0) or (r == 1 and abs(Bx)  1e-2) else 0\n\n    return [g, q, r, h]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}