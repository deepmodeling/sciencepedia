{
    "hands_on_practices": [
        {
            "introduction": "这项练习回归到连续理想磁流体动力学（MHD）方程的基础。在构建数值格式之前，理解其底层物理模型的性质至关重要。本实践将通过线性化MHD方程来推导基本的波族，并分析它们的熵特性，从而巩固理想连续等离子体流是等熵的这一关键原则。",
            "id": "3974517",
            "problem": "考虑一个均匀、完全电离的单流体等离子体，该等离子体由理想磁流体力学 (MHD) 描述，且无电阻率、粘性或热传导。背景平衡态具有恒定的密度 $ \\rho_{0} $、压强 $ p_{0} $、磁场 $ \\mathbf{B}_{0} $ 和零速度 $ \\mathbf{u}_{0} = \\mathbf{0} $。该等离子体遵循理想气体状态方程，其绝热指数为 $ \\gamma > 1 $，定容比热为 $ c_{v} $。真空磁导率为 $ \\mu_{0} $。定义声速 $ c_{s} = \\sqrt{\\gamma p_{0}/\\rho_{0}} $ 和 Alfvén 速度 $ v_{A} = |\\mathbf{B}_{0}|/\\sqrt{\\mu_{0}\\rho_{0}} $。考虑形式为 $ \\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right) $ 的小振幅（$ O(\\epsilon) $）平面波扰动，其波数大小为 $ k = |\\mathbf{k}| $，与背景磁场 $ \\mathbf{B}_{0} $ 的夹角为 $ \\theta \\in [0,\\pi] $。\n\n仅从基本的理想 MHD 方程出发，即质量守恒方程 $ \\partial_{t}\\rho + \\nabla\\cdot(\\rho \\mathbf{u}) = 0 $、动量守恒方程 $ \\rho \\partial_{t}\\mathbf{u} + \\rho (\\mathbf{u}\\cdot\\nabla)\\mathbf{u} = -\\nabla p + \\frac{1}{\\mu_{0}}(\\nabla\\times\\mathbf{B})\\times\\mathbf{B} $、感应方程 $ \\partial_{t}\\mathbf{B} = \\nabla\\times(\\mathbf{u}\\times\\mathbf{B}) $、磁场无散条件 $ \\nabla\\cdot\\mathbf{B} = 0 $，以及理想气体的热力学关系（单位质量比熵 $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $），完成以下任务：\n\n1. 对理想 MHD 方程在均匀平衡态附近进行线性化，并推导出三种线性波族及其色散关系：Alfvén 波、慢磁声波和快磁声波。你得到的 $ \\omega^{2} $ 表达式必须是 $ k $、$ c_{s} $、$ v_{A} $ 和 $ \\theta $ 的函数。\n\n2. 使用比熵的热力学定义 $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $，对第1部分中得到的三种波族，计算在单个波长内比熵的变化量 $ \\Delta s $，计算到 $ \\epsilon $ 的主导阶。将 $ \\Delta s $ 解释为沿传播方向上线性波剖面的波峰和波谷之间 $ s $ 的差值。用 $ p' $、$ \\rho' $、$ p_{0} $、$ \\rho_{0} $、$ \\gamma $ 和 $ c_{v} $ 表示你的中间结果，然后在所述的理想、无耗散假设下，将其简化为明确的最终值。\n\n3. 以单行矩阵 $ \\begin{pmatrix} \\Delta s_{\\mathrm{A}}  \\Delta s_{\\mathrm{S}}  \\Delta s_{\\mathrm{F}} \\end{pmatrix} $ 的形式给出你的最终答案，其中下标 $ \\mathrm{A} $、$ \\mathrm{S} $ 和 $ \\mathrm{F} $ 分别表示 Alfvén 波、慢磁声波和快磁声波。\n\n不需要数值近似，也不需要四舍五入。最终答案必须以精确的解析表达式给出。",
            "solution": "该问题要求在理想磁流体力学 (MHD) 中推导线性波的性质，并计算与这些波相关的熵变。验证过程已确认该问题是适定的、有科学依据且自洽的。\n\n### 第1部分：理想 MHD 方程的线性化与色散关系\n\n我们从无电阻率、粘性或热传导的等离子体的基本理想 MHD 方程开始。平衡态的特征是密度 $\\rho_0$、压强 $p_0$、磁场 $\\mathbf{B}_0$ 恒定，且速度 $\\mathbf{u}_0 = \\mathbf{0}$。我们考虑形如 $X = X_0 + X'$ 的小扰动，其中 $X'$ 是一阶量。这些变量是：\n- 密度：$\\rho = \\rho_0 + \\rho'$\n- 压强：$p = p_0 + p'$\n- 速度：$\\mathbf{u} = \\mathbf{u}_0 + \\mathbf{u}' = \\mathbf{u}'$\n- 磁场：$\\mathbf{B} = \\mathbf{B}_0 + \\mathbf{B}'$\n\n通过代入这些形式并忽略 $O(\\epsilon^2)$ 及更高阶的项，来对控制方程进行线性化。\n\n1.  **质量守恒**: $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$\n    线性化得到：$\\partial_t \\rho' + \\nabla \\cdot (\\rho_0 \\mathbf{u}') = 0 \\implies \\partial_t \\rho' + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0$。\n\n2.  **动量守恒**: $\\rho(\\partial_t \\mathbf{u} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u}) = -\\nabla p + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n    线性化得到：$\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}[(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0 + (\\nabla \\times \\mathbf{B}_0) \\times \\mathbf{B}']$。由于 $\\mathbf{B}_0$ 是常数，$\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$。\n    因此：$\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0$。\n\n3.  **感应方程**: $\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$\n    线性化得到：$\\partial_t \\mathbf{B}' = \\nabla \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$。\n\n4.  **热力学**: 对于理想无耗散流体，比熵 $s$ 沿着流体路径线守恒，即 $Ds/Dt = 0$，其中 $D/Dt = \\partial_t + \\mathbf{u} \\cdot \\nabla$。给定 $s = c_v \\ln(p/\\rho^\\gamma)$，这意味着 $D(p/\\rho^\\gamma)/Dt = 0$。\n    线性化此方程：$\\partial_t (p\\rho^{-\\gamma})' + (\\mathbf{u}' \\cdot \\nabla)(p_0\\rho_0^{-\\gamma}) = 0$。由于平衡态是均匀的，第二项为零。\n    $(p\\rho^{-\\gamma})' = (p_0+p')(\\rho_0+\\rho')^{-\\gamma} - p_0\\rho_0^{-\\gamma} = p_0\\rho_0^{-\\gamma}(1+p'/p_0)(1-\\gamma\\rho'/\\rho_0+\\dots) - p_0\\rho_0^{-\\gamma} \\approx p_0\\rho_0^{-\\gamma}(p'/p_0 - \\gamma\\rho'/\\rho_0)$。\n    所以，$\\partial_t(p'/p_0 - \\gamma\\rho'/\\rho_0) = 0$。对于频率 $\\omega \\neq 0$ 的振荡解，这意味着 $p'/p_0 - \\gamma\\rho'/\\rho_0 = 0$，或 $p' = \\gamma(p_0/\\rho_0)\\rho'$。使用声速的定义 $c_s^2 = \\gamma p_0/\\rho_0$，我们有 $p' = c_s^2 \\rho'$。\n\n5.  **磁场无散条件**: $\\nabla \\cdot \\mathbf{B} = 0 \\implies \\nabla \\cdot \\mathbf{B}' = 0$。\n\n我们假设形式为 $\\exp(i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t))$ 的平面波解。这将微分算子转换为 $\\partial_t \\to -i\\omega$ 和 $\\nabla \\to i\\mathbf{k}$。线性化方程变为代数方程：\n(i) $-i\\omega \\rho' + i\\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}') = 0 \\implies \\omega\\rho' = \\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}')$\n(ii) $-i\\omega\\rho_0 \\mathbf{u}' = -i\\mathbf{k}p' + \\frac{1}{\\mu_0}(i\\mathbf{k} \\times \\mathbf{B}') \\times \\mathbf{B}_0$\n(iii) $-i\\omega\\mathbf{B}' = i\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$\n(iv) $p' = c_s^2 \\rho'$\n(v) $i\\mathbf{k} \\cdot \\mathbf{B}' = 0$\n\n结合 (i) 和 (iv)：$p' = c_s^2 \\frac{\\rho_0}{\\omega}(\\mathbf{k} \\cdot \\mathbf{u}')$。\n由 (iii) 可得：$\\omega\\mathbf{B}' = -\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0) = -[(\\mathbf{k} \\cdot \\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k} \\cdot \\mathbf{u}')\\mathbf{B}_0]$。\n\n我们建立一个坐标系。设 $\\mathbf{B}_0$ 沿 $\\hat{\\mathbf{z}}$ 轴方向，$\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$。设波矢 $\\mathbf{k}$位于 $x-z$ 平面内，$\\mathbf{k} = k_x \\hat{\\mathbf{x}} + k_z \\hat{\\mathbf{z}} = k\\sin\\theta\\hat{\\mathbf{x}} + k\\cos\\theta\\hat{\\mathbf{z}}$。那么 $\\mathbf{k} \\cdot \\mathbf{B}_0 = k_z B_0 = k B_0 \\cos\\theta$。\n\n傅里叶变换后的线性方程的分量形式为：\n从动量方程 (ii) 出发，乘以 $\\omega\\mu_0$ 后得到：\n$\\omega^2\\mu_0\\rho_0 \\mathbf{u}' = \\omega\\mu_0 \\mathbf{k} p' - (\\mathbf{k}\\times(\\omega\\mathbf{B}'))\\times\\mathbf{B}_0$\n代入 $p'$ 和 $\\omega\\mathbf{B}'$：\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\omega} (\\mathbf{k}\\times((\\mathbf{k}\\cdot\\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k}\\cdot\\mathbf{u}')\\mathbf{B}_0))\\times\\mathbf{B}_0$\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\mu_0}[(\\mathbf{k}\\cdot\\mathbf{B}_0)(\\mathbf{k}\\times\\mathbf{u}')\\times\\mathbf{B}_0 - (\\mathbf{k}\\cdot\\mathbf{u}')(\\mathbf{k}\\times\\mathbf{B}_0)\\times\\mathbf{B}_0]$。\n这可以写成一个矩阵方程 $\\mathbf{M}\\cdot\\mathbf{u}'=0$。$\\mathbf{M}$ 的行列式必须为零。基于分量的推导更为直接。\n根据之前的思考步骤，关于 $(u_x', u_y', u_z')$ 的方程组是：\n$(\\omega^2 - k_z^2 v_A^2)u_y' = 0$\n$\\begin{pmatrix} \\omega^2 - k^2 v_A^2 - k_x^2 c_s^2  -k_x k_z c_s^2 \\\\ -k_x k_z c_s^2  \\omega^2 - k_z^2 c_s^2 \\end{pmatrix} \\begin{pmatrix} u_x' \\\\ u_z' \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\n其中 $v_A = B_0/\\sqrt{\\mu_0\\rho_0}$ 是 Alfvén 速度。\n\n**Alfvén 波**\n从关于 $u_y'$ 的解耦方程可知，如果系数为零，则存在非平凡解（$u_y' \\neq 0$）：\n$\\omega^2 - k_z^2 v_A^2 = 0 \\implies \\omega^2 = (k\\cos\\theta)^2 v_A^2$\n这就是 Alfvén 波的色散关系。对于此模式，$u_x'=u_z'=0$，这意味着 $\\mathbf{k}\\cdot\\mathbf{u}'=0$。根据方程 (i)，这表示 $\\rho'=0$，再根据 (iv)，$p'=0$。Alfvén 波是横波且不可压缩的。\n$$ \\omega_A^2 = k^2 v_A^2 \\cos^2\\theta $$\n\n**磁声波（快波和慢波）**\n对于 $u_x'$ 和 $u_z'$ 的耦合系统，存在非平凡解要求矩阵的行列式为零：\n$(\\omega^2 - k^2 v_A^2 - k_x^2 c_s^2)(\\omega^2 - k_z^2 c_s^2) - (k_x k_z c_s^2)^2 = 0$\n用 $k_x = k\\sin\\theta$ 和 $k_z = k\\cos\\theta$ 展开并简化：\n$\\omega^4 - \\omega^2(k_z^2 c_s^2 + k^2 v_A^2 + k_x^2 c_s^2) + (k^2 v_A^2)(k_z^2 c_s^2) = 0$\n$\\omega^4 - \\omega^2(k^2 c_s^2 + k^2 v_A^2) + k^4 c_s^2 v_A^2 \\cos^2\\theta = 0$\n两边同除以 $k^4$，我们得到一个关于相速度平方 $v_{ph}^2 = \\omega^2/k^2$ 的二次方程：\n$(v_{ph}^2)^2 - (c_s^2 + v_A^2) v_{ph}^2 + c_s^2 v_A^2 \\cos^2\\theta = 0$\n$\\omega^2 = k^2 v_{ph}^2$ 的解是：\n$$ \\omega^2 = \\frac{k^2}{2} \\left[ (c_s^2 + v_A^2) \\pm \\sqrt{(c_s^2 + v_A^2)^2 - 4c_s^2 v_A^2 \\cos^2\\theta} \\right] $$\n正根对应**快磁声波**（$\\omega_F^2$），负根对应**慢磁声波**（$\\omega_S^2$）。这些波是可压缩的（$\\rho'\\neq 0$，$p'\\neq 0$）。\n\n### 第2部分：比熵变化\n\n比熵由 $s = c_v \\ln(p/\\rho^\\gamma)$ 给出。我们希望计算每种波的 $\\Delta s = s(\\text{波峰}) - s(\\text{波谷})$，计算到波幅 $\\epsilon$ 的主导阶。\n熵扰动 $s' = s - s_0$ 是：\n$s' = c_v \\ln\\left(\\frac{p_0+p'}{(\\rho_0+\\rho')^\\gamma}\\right) - c_v \\ln\\left(\\frac{p_0}{\\rho_0^\\gamma}\\right) = c_v \\left[ \\ln(1+p'/p_0) - \\gamma\\ln(1+\\rho'/\\rho_0) \\right]$\n使用泰勒级数 $\\ln(1+x) = x - x^2/2 + O(x^3)$：\n$s' = c_v \\left[ \\left(\\frac{p'}{p_0} - \\frac{1}{2}\\left(\\frac{p'}{p_0}\\right)^2\\right) - \\gamma\\left(\\frac{\\rho'}{\\rho_0} - \\frac{1}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right) + O(\\epsilon^3) \\right]$\n$s' = c_v\\left(\\frac{p'}{p_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) - \\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] + O(\\epsilon^3)$\n第一项是一阶熵扰动 $s_1'$，第二项是二阶熵扰动 $s_2'$。\n\n量 $\\Delta s$ 是波峰和波谷处的熵之差。设线性扰动为正弦形式，例如 $\\rho' = \\rho'_1 \\cos(\\phi)$，其中 $\\phi = \\mathbf{k}\\cdot\\mathbf{x}-\\omega t$。\n波峰：$\\phi = 0 \\implies \\rho'=\\rho'_1$, $p'=p'_1$。\n波谷：$\\phi = \\pi \\implies \\rho'=-\\rho'_1$, $p'=-p'_1$。\n$\\Delta s = s'(\\text{波峰}) - s'(\\text{波谷})$。\n$\\Delta s$ 展开式中的主导阶项来自 $s_1'$：\n$\\Delta s = \\left[ c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) \\right] - \\left[ c_v\\left(\\frac{-p'_1}{p_0} - \\gamma\\frac{-\\rho'_1}{\\rho_0}\\right) \\right] + O(\\epsilon^3)$\n$\\Delta s = 2c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) + O(\\epsilon^3)$。\n所要求的主导阶熵变的中间结果与一阶扰动项 $s'_1 = c_v(p'/p_0 - \\gamma\\rho'/\\rho_0)$ 有关。\n\n现在我们对每种波模式进行计算。\n正如在第1部分中确立的，对于任何 $\\omega \\neq 0$ 的模式，理想 MHD 中的熵守恒线性化为 $p'/p_0 = \\gamma\\rho'/\\rho_0$。\n\n**对于快磁声波和慢磁声波：**\n这些是可压缩波，因此 $\\rho'$ 和 $p'$ 非零。它们通过绝热定律 $p' = c_s^2 \\rho' = (\\gamma p_0/\\rho_0)\\rho'$ 相关联，这与 $p'/p_0 = \\gamma \\rho'/rho_0$ 是等价的。\n将此代入一阶熵扰动的表达式中：\n$s'_1 = c_v\\left(\\gamma\\frac{\\rho'}{\\rho_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) = 0$。\n由于一阶扰动 $s'_1$ 为零，$\\Delta s$ 的主导阶项也为零。这意味着 $\\Delta s = 0 + O(\\epsilon^3)$。熵变在比朴素预期更高阶上为零。\n为严谨起见，我们可以检查下一阶。熵扰动由二阶项主导：\n$s' \\approx s'_2 = -\\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v}{2}\\left[\\left(\\gamma\\frac{\\rho'}{\\rho_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v\\gamma(\\gamma-1)}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2$。\n在波峰处，$\\rho'=\\rho'_1$，所以 $s'(\\text{波峰}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (\\rho'_1/\\rho_0)^2$。\n在波谷处，$\\rho'=-\\rho'_1$，所以 $s'(\\text{波谷}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (-\\rho'_1/\\rho_0)^2 = s'(\\text{波峰})$。\n因此，$\\Delta s = s'(\\text{波峰}) - s'(\\text{波谷}) = 0$。\n对于快磁声波和慢磁声波，跨一个波长的比熵变化均为零。\n$$ \\Delta s_S = 0 $$\n$$ \\Delta s_F = 0 $$\n\n**对于 Alfvén 波：**\n如第1部分所述，在理想 MHD 中，Alfvén 波是不可压缩的，意味着一阶密度和压强扰动为零：$\\rho'=0$ 且 $p'=0$。\n将这些代入熵扰动 $s'$ 的表达式中：\n$s' = c_v \\left[ \\ln(1+0/p_0) - \\gamma\\ln(1+0/\\rho_0) \\right] = 0$。\n对于线性 Alfvén 波，熵扰动精确为零。因此，跨一个波长的熵变也恒等于零。\n$$ \\Delta s_A = 0 $$\n\n所有三种理想 MHD 波族都是等熵的。对于所有这些波，波峰和波谷之间的比熵变化均为零。\n\n### 第3部分：最终答案的构建\n\n最终答案要求以单行矩阵 $\\begin{pmatrix} \\Delta s_{\\mathrm{A}}  \\Delta s_{\\mathrm{S}}  \\Delta s_{\\mathrm{F}} \\end{pmatrix}$ 的形式给出。\n根据以上分析：\n$\\Delta s_A = 0$\n$\\Delta s_S = 0$\n$\\Delta s_F = 0$\n\n因此，最终的矩阵是 $\\begin{pmatrix} 0  0  0 \\end{pmatrix}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然理想的连续流动是等熵的，但其数值离散格式并不能自动继承这一特性。这个动手编程练习通过比较两种不同的二阶重构方法，展示了这一关键点。通过实现和测试基于标准原始变量的重构和基于熵变量的重构，您将直接观察到重构变量的选择如何影响数值格式的熵稳定性。",
            "id": "3974470",
            "problem": "要求您实现并比较两种高阶重构方法，用于模拟由理想气体欧拉方程建模的一维、无量纲、可压缩等离子体流。数学基础必须从第一性原理出发。物理背景是计算聚变科学与工程，但为确保普适性，该问题以纯数学和算法的形式进行阐述。所有量均为无量纲；无需物理单位。\n\n控制守恒律是用于单组分等离子体的一维理想气体欧拉系统，在该系统中，所考虑的时间步长内磁效应可以忽略不计。守恒状态向量为 $U = [\\rho, \\rho u, E]^{\\top}$，其中 $\\rho$ 是质量密度，$u$ 是速度，$E$ 是总能量密度。通量向量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$，其中压力 $p$ 由理想气体闭合关系 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ 给出，$\\gamma$ 是比热比。守恒律为 $\\partial_t U + \\partial_x F(U) = 0$。\n\n定义欧拉方程的数学熵函数为 $\\eta(U) = -\\rho s / (\\gamma - 1)$，其中 $s = \\ln(p) - \\gamma \\ln(\\rho)$ 是无量纲比熵。相关的熵通量为 $q(U) = -\\rho u s / (\\gamma - 1)$。熵变量定义为 $v = \\partial \\eta / \\partial U$，并作为一个凸坐标系，可在其中构造熵稳定算法。对于理想气体欧拉系统，可以通过引入 $\\beta = \\rho/p$ 并使用以下公式将 $v$ 用原始变量 $(\\rho,u,p)$ 表示\n$v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$，\n$v_2 = \\beta u$，\n$v_3 = -\\beta$。\n从 $v$ 到 $U$ 的逆映射由这些定义和 $s = \\ln(p) - \\gamma \\ln(\\rho)$ 导出：\n$\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp\\left(\\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)\\right)$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$。\n\n您将实现一个单步前向欧拉有限体积更新，并在每个单元交界面处使用局部Lax-Friedrichs (LLF) 数值通量。对于具有重构的左右状态 $U_L$ 和 $U_R$ 的交界面，LLF通量为 $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$，其中 $\\alpha$ 是交界面处的最大信号速度，计算公式为 $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$，$c = \\sqrt{\\gamma p / \\rho}$ 是无量纲声速。时间步长 $\\Delta t$ 必须满足Courant–Friedrichs–Lewy (CFL) 条件，系数 $0  \\text{CFL}  1$：$\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$，其中最大值取自整个计算域。\n\n您将比较两种用于交界面状态的二阶线性重构方法：\n- 原始变量重构：使用中心差分斜率从单元平均值线性重构 $(\\rho, u, p)$，以获得交界面左右状态；然后映射到 $U$。\n- 熵变量重构：使用中心差分斜率从单元平均值线性重构熵变量 $v$，以获得交界面左右状态；然后通过逆映射将其映射回 $U$。\n\n为确保科学真实性，必要时通过对 $\\rho$ 和 $p$ 应用下限值来强制重构状态的正定性：使用 $\\rho \\ge \\epsilon_{\\rho}$ 和 $p \\ge \\epsilon_{p}$，其中无量纲下限值为 $\\epsilon_{\\rho} = 10^{-12}$ 和 $\\epsilon_{p} = 10^{-12}$。\n\n对于每种重构变体，在具有周期性边界条件的均匀网格上执行恰好一个前向欧拉时间步。计算更新前后的离散总数学熵 $S = \\sum_i \\eta(U_i)\\,\\Delta x$。报告每种变体的离散熵变 $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$。如果在该步长内，熵变 $\\Delta S \\le 0$（在数值容差 $\\tau = 10^{-12}$ 范围内），则认为该重构是熵稳定的。\n\n实现程序，为每个测试用例计算指示熵变量重构和原始变量重构是否熵稳定的布尔标志，以及相应的熵变 $\\Delta S$（浮点数）。\n\n全程使用无量纲变量。不涉及角度。不涉及百分比。\n\n测试套件和参数：\n- 案例1（光滑压缩波，理想路径）：计算域长度 $L = 1$，单元数量 $N = 200$，$\\gamma = 1.4$，CFL系数 $\\text{CFL} = 0.4$，初始条件为在 $x \\in [0,1]$ 上 $\\rho(x) = 1 + 0.2\\sin(2\\pi x)$，$u(x) = 0$，$p(x) = 1$，采用周期性边界条件。\n- 案例2（间断黎曼问题，激波管类似物）：计算域长度 $L = 1$，$N = 400$，$\\gamma = 1.4$，$\\text{CFL} = 0.4$，对于 $x  0.5$ 的初始左状态为 $(\\rho,u,p) = (1, 0, 1)$，对于 $x \\ge 0.5$ 的初始右状态为 $(\\rho,u,p) = (0.125, 0, 0.1)$，采用周期性边界条件。\n- 案例3（带密度脉冲的高马赫数平流，边缘案例）：计算域长度 $L = 1$，$N = 200$，$\\gamma = 1.4$，$\\text{CFL} = 0.2$，背景场为 $(\\rho,u,p) = (1, 2, 0.1)$，在 $x=0.5$ 处有一个振幅为 $0.5$、宽度为 $\\sigma = 0.05$ 的高斯密度脉冲，因此 $\\rho(x) = 1 + 0.5\\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对应一个子列表，形式为 $[\\text{stable\\_v}, \\text{stable\\_prim}, \\Delta S_{\\text{v}}, \\Delta S_{\\text{prim}}]$。例如，输出必须类似于 $[[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}]]$，不含任何额外文本。",
            "solution": "用户提供了一个问题，要求实现并比较应用于理想气体欧拉方程的一维有限体积法的两种二阶空间重构格式。首先评估问题陈述的有效性。\n\n### 步骤 1：提取给定信息\n- **控制律**：一维欧拉方程，$\\partial_t U + \\partial_x F(U) = 0$。\n- **状态向量**：$U = [\\rho, \\rho u, E]^{\\top}$。\n- **通量向量**：$F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$。\n- **状态方程**：理想气体，$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。\n- **熵函数**：$\\eta(U) = -\\rho s / (\\gamma - 1)$，其中 $s = \\ln(p) - \\gamma \\ln(\\rho)$。\n- **熵变量**：$v = \\partial \\eta / \\partial U$。\n- **映射（原始变量到熵变量）**：其中 $\\beta = \\rho/p$：\n  $v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$，\n  $v_2 = \\beta u$，\n  $v_3 = -\\beta$。\n- **映射（熵变量到守恒变量）**：\n  $\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp(\\ln(\\rho))$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$。\n- **数值格式**：\n    - 方法：采用单步前向欧拉时间步的有限体积法。\n    - 网格：具有周期性边界条件的均匀网格。\n    - 数值通量：局部Lax-Friedrichs (LLF)，$F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$。\n    - 耗散系数：$\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$，其中声速 $c = \\sqrt{\\gamma p / \\rho}$。\n    - 时间步长：$\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$。\n- **重构变体**：\n    1.  使用中心差分斜率对原始变量 $(\\rho, u, p)$ 进行线性重构。\n    2.  使用中心差分斜率对熵变量 $v$ 进行线性重构。\n- **约束条件**：正定性下限：$\\rho \\ge \\epsilon_{\\rho} = 10^{-12}$，$p \\ge \\epsilon_{p} = 10^{-12}$。\n- **分析**：计算总熵变 $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$，其中 $S = \\sum_i \\eta(U_i)\\,\\Delta x$。\n- **稳定性判据**：$\\Delta S \\le \\tau = 10^{-12}$。\n- **测试用例**：\n    - **案例1**：光滑波；$L=1, N=200, \\gamma=1.4, \\text{CFL}=0.4$；初始条件(IC)：$\\rho(x) = 1 + 0.2\\sin(2\\pi x), u(x)=0, p(x)=1$。\n    - **案例2**：黎曼问题；$L=1, N=400, \\gamma=1.4, \\text{CFL}=0.4$；初始条件(IC)：$x  0.5$ 时为 $(\\rho,u,p)=(1,0,1)$，$x \\ge 0.5$ 时为 $(0.125,0,0.1)$。\n    - **案例3**：高马赫数平流；$L=1, N=200, \\gamma=1.4, \\text{CFL}=0.2$；初始条件(IC)：背景场为 $(\\rho,u,p) = (1,2,0.1)$，并附加高斯密度脉冲 $\\rho(x)|_{\\text{pert}} = 0.5\\exp(-\\frac{(x-0.5)^2}{2(0.05)^2})$。\n- **输出**：一个列表的列表：`[[stable_v, stable_prim, dS_v, dS_prim], ...]`，对应三个案例。\n\n### 步骤 2：使用提取的给定信息进行验证\n- **科学依据**：该问题基于欧拉方程，这是流体动力学中的一个基本模型。熵稳定性、熵变量和有限体积法（特别是LLF通量和线性重构）等概念是计算气体动力学和磁流体动力学(MHD)中的标准且有据可查的课题。所有提供的数学公式在此背景下都是正确且标准的。\n- **适定性**：该问题描述了一个完整的数值实验。它明确了控制方程、初始和边界条件、数值算法以及要计算的量。任务是明确的。对于给定的CFL系数，数值格式预期在标准线性意义下是稳定的。唯一数值解的存在性得到保证。\n- **客观性**：问题以纯数学和算法术语陈述。成功标准（熵稳定性）由一个精确的数值不等式定义。不需要主观解释。\n- **完整性**：所有必要的参数（$\\gamma$, CFL, $L$, $N$）、初始条件和数值程序都已完全指定。该表述是自洽的。\n- **一致性**：原始变量、守恒变量和熵变量之间的变量变换是内部一致的。问题设置不包含矛盾。\n\n### 步骤 3：结论与行动\n该问题在科学上是合理的、适定的、客观的和完整的。它是在计算物理领域一个标准但非平凡的练习，适合用来演示守恒律数值格式的重要性质。该问题是**有效的**。将构建一个解决方案。\n\n### 基于原理的设计\n解决方案将通过首先建立一组辅助函数来实现，这些函数执行流体不同状态表示（原始变量、守恒变量和熵变量）之间的转换，计算压力和声速等物理量，并计算数学熵。这种模块化的方法确保了清晰性和正确性。\n\n实现的核心是执行有限体积格式单个时间步的函数。该函数将具有足够的通用性，可以接受原始变量或熵变量形式的单元平均数据。\n\n单个时间步的过程如下：\n1.  **重构**：对于每个单元交界面，我们重构左右状态。这是通过取交界面相邻单元的单元平均值，并对交界面位置应用线性外插来完成的。用于此外插的斜率是使用单元平均数据的中心差分公式计算的。此过程应用于所选的变量集（原始变量或熵变量）。\n2.  **状态转换和正定性**：以重构变量表示的重构左右状态被转换为守恒变量向量 $U = [\\rho, \\rho u, E]^{\\top}$。对于熵变量重构，这涉及到非平凡的逆映射 $v \\to U$。一个基本的物理约束是密度 $\\rho$ 和压力 $p$ 的正定性。在重构之后、用于通量计算之前，这些原始量被强制置于一个小的正下限值之上。这一步对于数值鲁棒性至关重要，特别是当格式产生振荡时。\n3.  **通量计算**：在每个交界面，计算局部Lax-Friedrichs (LLF) 数值通量。LLF通量是一种近似黎曼求解器，它由左右状态通量的平均值，外加一个与守恒状态跳跃 $(U_R - U_L)$ 成正比的耗散项组成。耗散由交界面处的最大特征速度控制，确保足够的数值粘性以维持稳定性，特别是在跨越激波和接触间断时。\n4.  **守恒更新**：最后，使用数值通量的散度更新每个单元中的单元平均守恒状态。对于均匀网格，这简化为 $U_i^{n+1} = U_i^n - (\\Delta t / \\Delta x)(F^*_{i+1/2} - F^*_{i-1/2})$。通过对通量数组进行适当的索引来处理周期性边界条件。\n\n对两种重构策略中的每一种都执行这整个过程。在时间步前后计算系统的总离散熵，以确定熵变 $\\Delta S$。对于连续欧拉方程的物理正确解，总熵不应减少（热力学第二定律）。然而，对于一个数值格式要成为“熵稳定”的，其离散熵必不能增加。也就是说，格式中固有的数值耗散必须足以在激波处以符合熵条件的方式耗散能量，而不在光滑区域产生伪熵。这个性质，$\\Delta S \\le 0$，是比较的关键指标。熵变量重构是专门为实现这一目标而设计的，而标准的原始变量重构则不能保证做到这一点，并且预计会在此测试中失败，尤其是在有激波或强梯度的挑战性案例中。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n\n    # Helper functions for state conversions and physical quantities\n    def prim_to_U(rho, u, p, gamma):\n        E = p / (gamma - 1.0) + 0.5 * rho * u**2\n        return np.stack([rho, rho * u, E], axis=-1)\n\n    def U_to_prim(U, gamma, rho_floor=1e-12, p_floor=1e-12):\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        E = U[..., 2]\n        p = (gamma - 1.0) * (E - 0.5 * rho * u**2)\n        # Apply floors to prevent non-physical states from subsequent calculations\n        rho = np.maximum(rho, rho_floor)\n        p = np.maximum(p, p_floor)\n        return rho, u, p\n\n    def get_flux(U, gamma):\n        rho, u, p = U_to_prim(U, gamma)\n        E = U[..., 2]\n        F1 = rho * u\n        F2 = rho * u**2 + p\n        F3 = u * (E + p)\n        return np.stack([F1, F2, F3], axis=-1)\n    \n    def get_sound_speed(rho, p, gamma):\n        return np.sqrt(gamma * p / rho)\n\n    def get_entropy_density(U, gamma):\n        # Use floors to prevent log of non-positive numbers\n        rho, _, p = U_to_prim(U, gamma, rho_floor=1e-14, p_floor=1e-14)\n        s = np.log(p) - gamma * np.log(rho)\n        eta = -rho * s / (gamma - 1.0)\n        return eta\n        \n    def prim_to_v(rho, u, p, gamma):\n        beta = rho / p\n        s = np.log(p) - gamma * np.log(rho)\n        v1 = (gamma - s) / (gamma - 1.0) - 0.5 * beta * u**2\n        v2 = beta * u\n        v3 = -beta\n        return np.stack([v1, v2, v3], axis=-1)\n\n    def v_to_prim(v, gamma):\n        v1, v2, v3 = v[..., 0], v[..., 1], v[..., 2]\n        beta = -v3\n        \n        # Initialize output arrays with NaN for invalid states\n        rho = np.full_like(v1, np.nan)\n        u = np.full_like(v1, np.nan)\n        p = np.full_like(v1, np.nan)\n\n        # Only compute for physical beta  0\n        valid_mask = beta > 1e-14\n\n        if np.any(valid_mask):\n            beta_v = beta[valid_mask]\n            v1_v = v1[valid_mask]\n            v2_v = v2[valid_mask]\n\n            u_v = v2_v / beta_v\n            s_v = gamma - (gamma - 1.0) * (v1_v + 0.5 * beta_v * u_v**2)\n            log_rho_v = (-s_v - np.log(beta_v)) / (gamma - 1.0)\n            rho_v = np.exp(log_rho_v)\n            p_v = rho_v / beta_v\n            \n            # Place valid results into output arrays\n            rho[valid_mask] = rho_v\n            u[valid_mask] = u_v\n            p[valid_mask] = p_v\n            \n        return rho, u, p\n\n    def take_one_step(U_initial, W_cell_avg, recon_type, gamma, dx, dt, rho_floor, p_floor):\n        N = U_initial.shape[0]\n        \n        # Centered reconstruction to get left/right states at interfaces i+1/2\n        W_im1 = np.roll(W_cell_avg, 1, axis=0)\n        W_ip1 = np.roll(W_cell_avg, -1, axis=0)\n        W_ip2 = np.roll(W_cell_avg, -2, axis=0)\n        \n        # Using slope_i = (W_{i+1}-W_{i-1})/(2*dx), value = W_i + slope_i * dx/2 simplifies to...\n        W_L = W_cell_avg + (W_ip1 - W_im1) / 4.0\n        # Reconstructing from cell i+1 for the right state at interface i+1/2\n        W_R = W_ip1 - (W_ip2 - W_cell_avg) / 4.0\n        \n        if recon_type == 'primitive':\n            rho_L, u_L, p_L = W_L[..., 0], W_L[..., 1], W_L[..., 2]\n            rho_R, u_R, p_R = W_R[..., 0], W_R[..., 1], W_R[..., 2]\n        elif recon_type == 'entropy':\n            rho_L, u_L, p_L = v_to_prim(W_L, gamma)\n            rho_R, u_R, p_R = v_to_prim(W_R, gamma)\n        else:\n            raise ValueError(\"Invalid reconstruction type\")\n\n        # Positivity enforcement\n        rho_L = np.maximum(rho_L, rho_floor)\n        p_L = np.maximum(p_L, p_floor)\n        rho_R = np.maximum(rho_R, rho_floor)\n        p_R = np.maximum(p_R, p_floor)\n\n        U_L = prim_to_U(rho_L, u_L, p_L, gamma)\n        U_R = prim_to_U(rho_R, u_R, p_R, gamma)\n        \n        # LLF Flux Calculation\n        F_L = get_flux(U_L, gamma)\n        F_R = get_flux(U_R, gamma)\n        \n        c_L = get_sound_speed(rho_L, p_L, gamma)\n        c_R = get_sound_speed(rho_R, p_R, gamma)\n        \n        alpha = np.maximum(np.abs(u_L) + c_L, np.abs(u_R) + c_R)\n        alpha = alpha[..., np.newaxis] # for broadcasting\n        \n        F_star = 0.5 * (F_L + F_R) - 0.5 * alpha * (U_R - U_L)\n        \n        # Update\n        F_star_im1 = np.roll(F_star, 1, axis=0)\n        U_final = U_initial - (dt / dx) * (F_star - F_star_im1)\n        \n        return U_final\n\n    def run_case(params):\n        L, N, gamma, CFL = params['L'], params['N'], params['gamma'], params['CFL']\n        ic_type = params['ic_type']\n        \n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        \n        # Initial Conditions\n        if ic_type == 1:\n            rho = 1.0 + 0.2 * np.sin(2 * np.pi * x / L)\n            u = np.zeros(N)\n            p = np.ones(N)\n        elif ic_type == 2:\n            rho = np.ones(N)\n            u = np.zeros(N)\n            p = np.ones(N)\n            mask = x >= 0.5 * L\n            rho[mask] = 0.125\n            p[mask] = 0.1\n        elif ic_type == 3:\n            sigma = 0.05\n            rho = 1.0 + 0.5 * np.exp(-((x - 0.5 * L)**2) / (2 * sigma**2))\n            u = np.full(N, 2.0)\n            p = np.full(N, 0.1)\n\n        U_initial = prim_to_U(rho, u, p, gamma)\n        c_initial = get_sound_speed(rho, p, gamma)\n        dt = CFL * dx / np.max(np.abs(u) + c_initial)\n        \n        S_initial = np.sum(get_entropy_density(U_initial, gamma)) * dx\n        rho_floor, p_floor, stability_tol = 1e-12, 1e-12, 1e-12\n\n        # Entropy-variable reconstruction\n        W_v = prim_to_v(rho, u, p, gamma)\n        U_final_v = take_one_step(U_initial, W_v, 'entropy', gamma, dx, dt, rho_floor, p_floor)\n        S_final_v = np.sum(get_entropy_density(U_final_v, gamma)) * dx\n        dS_v = S_final_v - S_initial\n        stable_v = (not np.isnan(dS_v)) and (dS_v = stability_tol)\n\n        # Primitive-variable reconstruction\n        W_prim = np.stack([rho, u, p], axis=-1)\n        U_final_prim = take_one_step(U_initial, W_prim, 'primitive', gamma, dx, dt, rho_floor, p_floor)\n        S_final_prim = np.sum(get_entropy_density(U_final_prim, gamma)) * dx\n        dS_prim = S_final_prim - S_initial\n        stable_prim = (not np.isnan(dS_prim)) and (dS_prim = stability_tol)\n        \n        return [stable_v, stable_prim, dS_v, dS_prim]\n\n    # --- Test Suite ---\n    test_cases = [\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 1},\n        {'L': 1.0, 'N': 400, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 2},\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.2, 'ic_type': 3, 'sigma': 0.05}\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(run_case(case))\n        \n    # Format output as specified\n    string_results = ','.join(map(str, results))\n    print(f\"[{string_results}]\")\n\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "先进的数值格式力求在光滑区域达到高精度，同时能稳健地处理激波。这需要动态地识别需要施加耗散的“问题”网格。本实践将指导您实现一个强大的诊断工具——一个基于局部熵产生率的激波传感器，它提供了一种有物理依据的方法来区分光滑流动和像激波这样的耗散结构。",
            "id": "3974549",
            "problem": "考虑一个由可压缩欧拉方程和理想气体闭合关系建模的一维单流体理想等离子体，这是计算聚变科学中用于在无强磁化条件下设计和评估保熵格式的标准代理模型。令比热比为 $\\gamma  1$，并假设使用无量綱变量，因此无需报告物理单位。热力学比熵（不计一个可加常数）定义为 $s = \\ln(p) - \\gamma \\ln(\\rho)$，其中 $\\rho$ 是质量密度， $u$ 是速度， $p$ 是压力。熵密度为 $S = \\rho s$，熵通量为 $F = \\rho s u$。在欧拉方程的光滑无粘解中，第二定律蕴含熵不等式\n$$\n\\partial_t (\\rho s) + \\partial_x (\\rho s u) \\ge 0,\n$$\n在光滑区域取等号，仅在激波处或存在耗散时严格为正。一个保熵数值方法应遵循该不等式的离散版本。\n\n您需要构建一个全离散的单元诊断，用于测量熵的变化，并将其与用于基于熵的动态限制的激波传感器阈值联系起来。具体来说，对于一个具有 $N$ 个单元、单元宽度为 $\\Delta x$、以及两个连续时间层 $t^n$ 和 $t^{n+1} = t^n + \\Delta t$ 的空间均匀网格，为每个单元索引 $i \\in \\{0,1,\\dots,N-1\\}$ 定义以下离散诊断：\n1. 计算每个时间层的比熵：\n$$\ns_i^n = \\ln(p_i^n) - \\gamma \\ln(\\rho_i^n), \\quad s_i^{n+1} = \\ln(p_i^{n+1}) - \\gamma \\ln(\\rho_i^{n+1}).\n$$\n2. 构建熵密度及其算术时间平均值：\n$$\nS_i^n = \\rho_i^n s_i^n, \\quad S_i^{n+1} = \\rho_i^{n+1} s_i^{n+1}, \\quad S_i^\\ast = \\tfrac{1}{2}(S_i^n + S_i^{n+1}).\n$$\n3. 构建熵通量及其算术时间平均值：\n$$\nF_i^n = \\rho_i^n s_i^n u_i^n, \\quad F_i^{n+1} = \\rho_i^{n+1} s_i^{n+1} u_i^{n+1}, \\quad F_i^\\ast = \\tfrac{1}{2}(F_i^n + F_i^{n+1}).\n$$\n4. 使用时间上的前向差分和空间上的中心差分（采用周期性边界条件）来定义离散熵残差：\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x},\n$$\n其中索引为周期性而进行模 $N$ 环绕。\n5. 通过基于最大伪可压缩性 $\\max_j \\gamma p_j^\\ast$ 的全局热力学尺度对残差进行归一化，其中 $p_j^\\ast = \\tfrac{1}{2}(p_j^n + p_j^{n+1})$：\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon},\n$$\n其中有一个小的正常数 $\\varepsilon = 10^{-14}$ 以防止除以零。量 $\\sigma_i$ 是一个无量纲传感器，在光滑、近等熵区域值很小，而在激波或强耗散事件附近值会增大。\n\n使用传感器 $\\sigma_i$ 来定义一个由两个阈值 $0 \\le \\tau_{\\text{low}}  \\tau_{\\text{high}}$ 控制的动态熵基限制器系数 $\\theta_i \\in [0,1]$：\n$$\n\\theta_i = \n\\begin{cases}\n0,  \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}},  \\tau_{\\text{low}}  \\sigma_i  \\tau_{\\text{high}}, \\\\\n1,  \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\n\n实现一个程序，使用固定的参数 $N = 100$, $\\Delta x = 1/N$, $\\Delta t = 10^{-3}$ 和 $\\gamma = 1.4$ 来计算以下测试套件的 $\\sigma_i$ 和 $\\theta_i$。所有测试都定义在周期性域 $x \\in [0,1)$ 上，单元中心为 $x_i = (i + 0.5)\\Delta x$，其中 $i \\in \\{0,\\dots,N-1\\}$。阈值固定为 $\\tau_{\\text{low}} = 0.02$ 和 $\\tau_{\\text{high}} = 0.2$。\n\n测试 A（静止的光滑等熵）：\n- 设 $K = 1$。定义 $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = 0$ 和 $p_i^n = K (\\rho_i^n)^\\gamma$。设置 $\\rho_i^{n+1} = \\rho_i^n$, $u_i^{n+1} = u_i^n$ 和 $p_i^{n+1} = p_i^n$。\n\n测试 B（光滑等熵平流）：\n- 设 $K = 1$ 和恒定平流速度 $u_0 = 0.5$。定义 $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = u_0$, $p_i^n = K (\\rho_i^n)^\\gamma$。通过将 $\\rho^n$ 平移距离 $u_0 \\Delta t$ 来获得 $\\rho_i^{n+1}$，即 $\\rho^{n+1}(x) = \\rho^n(x - u_0 \\Delta t)$，使用线性插值和周期性环绕；设置 $u_i^{n+1} = u_0$ 和 $p_i^{n+1} = K (\\rho_i^{n+1})^\\gamma$。\n\n测试 C（初始的类激波加热，定常流）：\n- 定义一个中心在 $x_c = 0.5$、宽度为 $w = 0.05$ 的高斯凸起。令 $\\rho_i^n = 1$, $u_i^n = 0$ 和 $p_i^n = 1 + 0.20 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$。在下一时刻，仅增加压力幅值至 $p_i^{n+1} = 1 + 0.25 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$，同时保持 $\\rho_i^{n+1} = 1$ 和 $u_i^{n+1} = 0$。这模拟了与熵产生一致的局部不可逆加热。\n\n对于每个测试用例，计算：\n- 最大传感器值 $\\max_i \\sigma_i$（一个浮点数）。\n- $\\sigma_i \\ge \\tau_{\\text{high}}$ 的单元数量（一个整数）。\n- $\\tau_{\\text{low}} \\le \\sigma_i  \\tau_{\\text{high}}$ 的单元数量（一个整数）。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含结果，形式为逗号分隔的三个方括号括起来的三元组列表。每个三元组按 A、B、C 的顺序对应一个测试，且每个三元组的格式为 [max_sigma,count_high,count_mid]，不含空格。例如，输出应如下所示：\n[[maxA,countHighA,countMidA],[maxB,countHighB,countMidB],[maxC,countHighC,countMidC]]\n所有输出都是无量纲的，必须以原始数字形式报告，不带任何单位符号或百分号。此问题不涉及角度。",
            "solution": "该问题要求实现一个用于一维理想等离子体流中熵产生的数值诊断，该流体由可压缩欧拉方程建模。这种诊断工具，通常称为激波传感器或问题指示器，对于现代高分辨率数值格式至关重要。此类格式旨在流场的光滑区域达到高精度，但必须在具有强梯度的区域（如激波）引入人工耗散，以防止非物理振荡并保持稳定性。热力学第二定律，表现为熵不等式，为指导这一过程提供了坚实的物理原则。一个保熵格式必须确保域中的总熵不随时间减少。此处开发的诊断工具 $\\sigma_i$ 用于测量局部的、单元级别的熵产生率。\n\n该诊断的核心是离散熵残差 $R_i$。它是熵守恒方程 $\\partial_t S + \\partial_x F = 0$ 的一个有限差分近似，其中 $S = \\rho s$ 是熵密度，$F = \\rho s u$ 是熵通量。问题指定了一种特定的离散化方法：时间上使用前向差分，空间上使用中心差分。\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x}\n$$\n在这里，带上标 $n$ 和 $n+1$ 的量表示在两个连续时间层的值，下标 $i$ 表示空间单元索引。通量 $F^\\ast$ 是一个时间平均值，$F^\\ast = \\frac{1}{2}(F^n + F^{n+1})$，这样选择是为了时间中心化和一致性。在流场的光滑、等熵区域，连续熵方程等号成立。因此，一个一致的数值离散化应该产生一个接近于零的残差 $R_i$，其大小仅受限于有限差分格式的截断误差。然而，在激波处，会产生物理熵，熵方程变为不等式 $\\partial_t S + \\partial_x F  0$。在这类区域，$R_i$ 将显著为正，标志着一个物理耗散过程。\n\n原始残差 $R_i$ 是有量纲的。为了创建一个稳健的、无量纲的传感器，需要对其进行归一化。归一化因子 $\\gamma \\max_j p_j^\\ast$ 基于域中的最大压力，它可作为特征热力学能量尺度的代理。因子 $\\gamma p^\\ast$ 与声速的平方等量相关，提供了一个具有物理意义的尺度。得到的无量纲传感器是：\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon}\n$$\n$\\sigma_i$ 的值在光滑流场区域预期很小，而在激波或其他强耗散特征附近预期很大。\n\n然后，这个传感器被用来通过一个由两个阈值 $\\tau_{\\text{low}}$ 和 $\\tau_{\\text{high}}$ 控制的分段函数来定义一个限制器系数 $\\theta_i$。\n$$\n\\theta_i = \n\\begin{cases}\n0,  \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}},  \\tau_{\\text{low}}  \\sigma_i  \\tau_{\\text{high}}, \\\\\n1,  \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\n如果 $\\sigma_i$低于 $\\tau_{\\text{low}}$，流场被认为是光滑的，$\\theta_i=0$，表示不需要额外的耗散。如果 $\\sigma_i$ 高于 $\\tau_{\\text{high}}$，流场被认为存在激波，$\\theta_i=1$，表示应施加最大耗散。中间区域提供了一个平滑的过渡。\n\n实现将首先设置计算网格和物理常数。将创建一个函数，用于为给定的一对状态 $(\\rho^n, u^n, p^n)$ 和 $(\\rho^{n+1}, u^{n+1}, p^{n+1})$ 计算诊断量（$\\sigma_i$ 和派生的计数）。该函数将应用于三个指定的测试用例。\n\n- **测试 A** 描述了一个静态的等熵状态。因为状态不随时间变化（$S^{n+1}=S^n$）且速度为零（$F=0$），所以残差 $R_i$ 必须恒等于零。因此，所有单元的 $\\sigma_i$ 都将为零。\n\n- **测试 B** 模拟一个以恒定速度平流的光滑波。状态是等熵的，因此任何非零的熵残差都纯粹来自于数值误差，特别是用于平流密度分布的线性插值误差以及 $R_i$ 有限差分公式的截断误差。这些误差预期会很小，导致 $\\sigma_i$ 的值也很小。\n\n- **测试 C** 模拟一个在恒定密度和零速度下的局部加热事件。这是熵产生的直接模型，因为在恒定密度下增加压力（$p_i^{n+1}  p_i^n, \\rho_i^{n+1}=\\rho_i^n$）会增加比熵 $s_i = \\ln(p_i/\\rho_i^\\gamma)$。由于 $u=0$， $R_i$ 中的通量项为零，残差为 $R_i = (S_i^{n+1}-S_i^n)/\\Delta t  0$，集中在加热发生的区域。这个案例旨在产生较大的 $\\sigma_i$ 值，从而激活限制器。\n\n代码将使用 `numpy` 库进行高效的基于数组的计算，使用 `np.roll` 处理中心差分中的周期性边界条件，并使用带 `period` 参数的 `np.interp` 来实现测试 B 中的周期性平流。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a shock sensor diagnostic for three test cases in 1D fluid dynamics.\n    \"\"\"\n    # Define global parameters and grid\n    N = 100\n    dx = 1.0 / N\n    dt = 1e-3\n    gamma = 1.4\n    tau_low = 0.02\n    tau_high = 0.2\n    epsilon = 1e-14\n    x = (np.arange(N) + 0.5) * dx\n\n    def compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1):\n        \"\"\"\n        Calculates the entropy residual sensor and limiter activation counts.\n\n        Args:\n            rho_n, u_n, p_n: State variables at time n.\n            rho_np1, u_np1, p_np1: State variables at time n+1.\n\n        Returns:\n            A list containing [max_sigma, count_high, count_mid].\n        \"\"\"\n        # 1. Compute specific entropy\n        # Add a small value to log arguments to avoid log(0) for generality, though not strictly needed for these tests.\n        log_rho_n = np.log(rho_n + epsilon)\n        log_p_n = np.log(p_n + epsilon)\n        s_n = log_p_n - gamma * log_rho_n\n        \n        log_rho_np1 = np.log(rho_np1 + epsilon)\n        log_p_np1 = np.log(p_np1 + epsilon)\n        s_np1 = log_p_np1 - gamma * log_rho_np1\n\n        # 2. Form entropy density\n        S_n = rho_n * s_n\n        S_np1 = rho_np1 * s_np1\n\n        # 3. Form entropy flux and its arithmetic time average\n        F_n = S_n * u_n\n        F_np1 = S_np1 * u_np1\n        F_star = 0.5 * (F_n + F_np1)\n\n        # 4. Define the discrete entropy residual R_i\n        # Forward difference in time\n        time_derivative = (S_np1 - S_n) / dt\n        # Centered difference in space with periodic boundaries\n        F_star_ip1 = np.roll(F_star, -1)\n        F_star_im1 = np.roll(F_star, 1)\n        space_derivative = (F_star_ip1 - F_star_im1) / (2 * dx)\n        R = time_derivative + space_derivative\n\n        # 5. Normalize the residual to get the sensor sigma_i\n        p_star = 0.5 * (p_n + p_np1)\n        normalization_factor = gamma * np.max(p_star) + epsilon\n        sigma = (dx * np.abs(R)) / normalization_factor\n\n        # Use the sensor to calculate required outputs\n        max_sigma = np.max(sigma)\n        count_high = np.sum(sigma >= tau_high)\n        count_mid = np.sum((sigma >= tau_low)  (sigma  tau_high))\n\n        return [max_sigma, int(count_high), int(count_mid)]\n\n    test_cases = []\n\n    # === Test A: Smooth isentropic at rest ===\n    K_A = 1.0\n    rho_n_A = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_A = np.zeros(N)\n    p_n_A = K_A * (rho_n_A)**gamma\n    rho_np1_A, u_np1_A, p_np1_A = rho_n_A, u_n_A, p_n_A\n    test_cases.append(('A', rho_n_A, u_n_A, p_n_A, rho_np1_A, u_np1_A, p_np1_A))\n\n    # === Test B: Smooth isentropic advection ===\n    K_B = 1.0\n    u0_B = 0.5\n    rho_n_B = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_B = np.full(N, u0_B)\n    p_n_B = K_B * (rho_n_B)**gamma\n    \n    # Advect rho using periodic linear interpolation\n    x_shifted = x - u0_B * dt\n    rho_np1_B = np.interp(x_shifted, x, rho_n_B, period=1.0)\n    \n    u_np1_B = np.full(N, u0_B)\n    p_np1_B = K_B * (rho_np1_B)**gamma\n    test_cases.append(('B', rho_n_B, u_n_B, p_n_B, rho_np1_B, u_np1_B, p_np1_B))\n    \n    # === Test C: Incipient shock-like heating ===\n    xc_C = 0.5\n    w_C = 0.05\n    gaussian = np.exp(-((x - xc_C)**2) / w_C**2)\n    rho_n_C = np.ones(N)\n    u_n_C = np.zeros(N)\n    p_n_C = 1.0 + 0.20 * gaussian\n    rho_np1_C = np.ones(N)\n    u_np1_C = np.zeros(N)\n    p_np1_C = 1.0 + 0.25 * gaussian\n    test_cases.append(('C', rho_n_C, u_n_C, p_n_C, rho_np1_C, u_np1_C, p_np1_C))\n\n    # Run all tests and collect results\n    results = []\n    for _, rho_n, u_n, p_n, rho_np1, u_np1, p_np1 in test_cases:\n        result = compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1)\n        results.append(result)\n\n    # Format the final output string\n    formatted_results = []\n    for res in results:\n        # res[0] is float, res[1] and res[2] are ints.\n        formatted_results.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}