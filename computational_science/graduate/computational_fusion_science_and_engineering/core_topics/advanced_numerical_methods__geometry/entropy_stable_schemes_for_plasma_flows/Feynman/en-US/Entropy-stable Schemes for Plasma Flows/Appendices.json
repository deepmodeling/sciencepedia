{
    "hands_on_practices": [
        {
            "introduction": "Before designing numerical schemes to handle entropy production at shocks, it is crucial to understand the behavior of entropy in smooth, ideal plasma flows. This exercise takes you back to the fundamental equations of ideal Magnetohydrodynamics (MHD) to demonstrate a cornerstone principle: linear wave modes are isentropic. By deriving the entropy change across the fundamental wave families of MHD, you will confirm that in the ideal, dissipation-free limit, these waves do not generate entropy, providing a vital baseline for evaluating the physical and numerical dissipation of any computational model .",
            "id": "3974517",
            "problem": "Consider a uniform, fully ionized, single-fluid plasma described by ideal Magnetohydrodynamics (MHD) with no resistivity, viscosity, or heat conduction. The background equilibrium has constant density $ \\rho_{0} $, pressure $ p_{0} $, magnetic field $ \\mathbf{B}_{0} $, and zero velocity $ \\mathbf{u}_{0} = \\mathbf{0} $. The plasma obeys an ideal-gas equation of state with adiabatic index $ \\gamma > 1 $, and specific heat at constant volume $ c_{v} $. The vacuum permeability is $ \\mu_{0} $. Define the sound speed $ c_{s} = \\sqrt{\\gamma p_{0}/\\rho_{0}} $ and the Alfvén speed $ v_{A} = |\\mathbf{B}_{0}|/\\sqrt{\\mu_{0}\\rho_{0}} $. Consider small-amplitude ($ O(\\epsilon) $) plane-wave disturbances of the form $ \\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right) $ with wavenumber magnitude $ k = |\\mathbf{k}| $ that make an angle $ \\theta \\in [0,\\pi] $ with the background magnetic field $ \\mathbf{B}_{0} $.\n\nStarting only from the fundamental ideal MHD equations, namely mass conservation $ \\partial_{t}\\rho + \\nabla\\cdot(\\rho \\mathbf{u}) = 0 $, momentum conservation $ \\rho \\partial_{t}\\mathbf{u} + \\rho (\\mathbf{u}\\cdot\\nabla)\\mathbf{u} = -\\nabla p + \\frac{1}{\\mu_{0}}(\\nabla\\times\\mathbf{B})\\times\\mathbf{B} $, induction $ \\partial_{t}\\mathbf{B} = \\nabla\\times(\\mathbf{u}\\times\\mathbf{B}) $, solenoidal field $ \\nabla\\cdot\\mathbf{B} = 0 $, and thermodynamics for an ideal gas with specific entropy per unit mass $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $, perform the following:\n\n1. Linearize the ideal MHD equations about the uniform equilibrium and derive the three linear wave families and their dispersion relations: the Alfvén wave, the slow magnetosonic wave, and the fast magnetosonic wave. Your expressions for $ \\omega^{2} $ must be functions of $ k $, $ c_{s} $, $ v_{A} $, and $ \\theta $.\n\n2. Using the thermodynamic definition of specific entropy $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $, compute, to leading order in $ \\epsilon $, the specific entropy change $ \\Delta s $ across a single wavelength crest for each of the three wave families obtained in part 1. Interpret $ \\Delta s $ as the difference in $ s $ between the peak and the trough of the linear wave profile along the propagation direction. Express your intermediate result in terms of $ p' $, $ \\rho' $, $ p_{0} $, $ \\rho_{0} $, $ \\gamma $, and $ c_{v} $, and then simplify to the explicit final value under the ideal, dissipation-free assumptions stated.\n\n3. Provide your final answer as a single row matrix $ \\begin{pmatrix} \\Delta s_{\\mathrm{A}} & \\Delta s_{\\mathrm{S}} & \\Delta s_{\\mathrm{F}} \\end{pmatrix} $, where the subscripts $ \\mathrm{A} $, $ \\mathrm{S} $, and $ \\mathrm{F} $ denote Alfvén, slow magnetosonic, and fast magnetosonic waves, respectively.\n\nNo numerical approximation is required, and no rounding is necessary. The final answer must be expressed as an exact analytic expression.",
            "solution": "The problem requires the derivation of linear wave properties in ideal Magnetohydrodynamics (MHD) and the calculation of the entropy change associated with these waves. The validation process has confirmed that the problem is well-posed, scientifically grounded, and self-contained.\n\n### Part 1: Linearization of Ideal MHD Equations and Dispersion Relations\n\nWe begin with the fundamental equations of ideal MHD for a plasma with no resistivity, viscosity, or heat conduction. The equilibrium state is characterized by constant density $\\rho_0$, pressure $p_0$, magnetic field $\\mathbf{B}_0$, and zero velocity $\\mathbf{u}_0 = \\mathbf{0}$. We consider small perturbations of the form $X = X_0 + X'$, where $X'$ is a first-order quantity. The variables are:\n- Density: $\\rho = \\rho_0 + \\rho'$\n- Pressure: $p = p_0 + p'$\n- Velocity: $\\mathbf{u} = \\mathbf{u}_0 + \\mathbf{u}' = \\mathbf{u}'$\n- Magnetic field: $\\mathbf{B} = \\mathbf{B}_0 + \\mathbf{B}'$\n\nThe governing equations are linearized by substituting these forms and neglecting terms of order $O(\\epsilon^2)$ and higher.\n\n1.  **Mass Conservation**: $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$\n    Linearizing gives: $\\partial_t \\rho' + \\nabla \\cdot (\\rho_0 \\mathbf{u}') = 0 \\implies \\partial_t \\rho' + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0$.\n\n2.  **Momentum Conservation**: $\\rho(\\partial_t \\mathbf{u} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u}) = -\\nabla p + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n    Linearizing gives: $\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}[(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0 + (\\nabla \\times \\mathbf{B}_0) \\times \\mathbf{B}']$. Since $\\mathbf{B}_0$ is constant, $\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$.\n    Thus: $\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0$.\n\n3.  **Induction Equation**: $\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$\n    Linearizing gives: $\\partial_t \\mathbf{B}' = \\nabla \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$.\n\n4.  **Thermodynamics**: For an ideal, dissipationless fluid, the specific entropy $s$ is conserved along fluid pathlines, i.e., $Ds/Dt = 0$, where $D/Dt = \\partial_t + \\mathbf{u} \\cdot \\nabla$. Given $s = c_v \\ln(p/\\rho^\\gamma)$, this implies $D(p/\\rho^\\gamma)/Dt = 0$.\n    Linearizing this equation: $\\partial_t (p\\rho^{-\\gamma})' + (\\mathbf{u}' \\cdot \\nabla)(p_0\\rho_0^{-\\gamma}) = 0$. Since the equilibrium is uniform, the second term is zero.\n    $(p\\rho^{-\\gamma})' = (p_0+p')(\\rho_0+\\rho')^{-\\gamma} - p_0\\rho_0^{-\\gamma} = p_0\\rho_0^{-\\gamma}(1+p'/p_0)(1-\\gamma\\rho'/\\rho_0+\\dots) - p_0\\rho_0^{-\\gamma} \\approx p_0\\rho_0^{-\\gamma}(p'/p_0 - \\gamma\\rho'/\\rho_0)$.\n    So, $\\partial_t(p'/p_0 - \\gamma\\rho'/\\rho_0) = 0$. For oscillatory solutions with frequency $\\omega \\neq 0$, this implies $p'/p_0 - \\gamma\\rho'/\\rho_0 = 0$, or $p' = \\gamma(p_0/\\rho_0)\\rho'$. Using the definition of the sound speed $c_s^2 = \\gamma p_0/\\rho_0$, we have $p' = c_s^2 \\rho'$.\n\n5.  **Solenoidal Field**: $\\nabla \\cdot \\mathbf{B} = 0 \\implies \\nabla \\cdot \\mathbf{B}' = 0$.\n\nWe assume plane-wave solutions of the form $\\exp(i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t))$. This transforms the differential operators as $\\partial_t \\to -i\\omega$ and $\\nabla \\to i\\mathbf{k}$. The linearized equations become algebraic:\n(i) $-i\\omega \\rho' + i\\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}') = 0 \\implies \\omega\\rho' = \\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}')$\n(ii) $-i\\omega\\rho_0 \\mathbf{u}' = -i\\mathbf{k}p' + \\frac{1}{\\mu_0}(i\\mathbf{k} \\times \\mathbf{B}') \\times \\mathbf{B}_0$\n(iii) $-i\\omega\\mathbf{B}' = i\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$\n(iv) $p' = c_s^2 \\rho'$\n(v) $i\\mathbf{k} \\cdot \\mathbf{B}' = 0$\n\nCombining (i) and (iv): $p' = c_s^2 \\frac{\\rho_0}{\\omega}(\\mathbf{k} \\cdot \\mathbf{u}')$.\nFrom (iii): $\\omega\\mathbf{B}' = -\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0) = -[(\\mathbf{k} \\cdot \\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k} \\cdot \\mathbf{u}')\\mathbf{B}_0]$.\n\nLet's set up a coordinate system. Let $\\mathbf{B}_0$ be along the $\\hat{\\mathbf{z}}$-axis, $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$. Let the wavevector $\\mathbf{k}$ lie in the $x-z$ plane, $\\mathbf{k} = k_x \\hat{\\mathbf{x}} + k_z \\hat{\\mathbf{z}} = k\\sin\\theta\\hat{\\mathbf{x}} + k\\cos\\theta\\hat{\\mathbf{z}}$. Then $\\mathbf{k} \\cdot \\mathbf{B}_0 = k_z B_0 = k B_0 \\cos\\theta$.\n\nThe Fourier-transformed linear equations in component form are:\nFrom momentum equation (ii), after multiplying by $\\omega\\mu_0$:\n$\\omega^2\\mu_0\\rho_0 \\mathbf{u}' = \\omega\\mu_0 \\mathbf{k} p' - (\\mathbf{k}\\times(\\omega\\mathbf{B}'))\\times\\mathbf{B}_0$\nSubstituting $p'$ and $\\omega\\mathbf{B}'$:\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\omega} (\\mathbf{k}\\times((\\mathbf{k}\\cdot\\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k}\\cdot\\mathbf{u}')\\mathbf{B}_0))\\times\\mathbf{B}_0$\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\mu_0}[(\\mathbf{k}\\cdot\\mathbf{B}_0)(\\mathbf{k}\\times\\mathbf{u}')\\times\\mathbf{B}_0 - (\\mathbf{k}\\cdot\\mathbf{u}')(\\mathbf{k}\\times\\mathbf{B}_0)\\times\\mathbf{B}_0]$.\nThis can be written as a matrix equation, $\\mathbf{M}\\cdot\\mathbf{u}'=0$. The determinant of $\\mathbf{M}$ must be zero. A component-based derivation is more direct.\nFrom the previous steps in thought process, the system for $(u_x', u_y', u_z')$ is:\n$(\\omega^2 - k_z^2 v_A^2)u_y' = 0$\n$\\begin{pmatrix} \\omega^2 - k^2 v_A^2 - k_x^2 c_s^2 & -k_x k_z c_s^2 \\\\ -k_x k_z c_s^2 & \\omega^2 - k_z^2 c_s^2 \\end{pmatrix} \\begin{pmatrix} u_x' \\\\ u_z' \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\nwhere $v_A = B_0/\\sqrt{\\mu_0\\rho_0}$ is the Alfvén speed.\n\n**Alfvén Wave**\nFrom the decoupled equation for $u_y'$, a non-trivial solution ($u_y' \\neq 0$) exists if the coefficient is zero:\n$\\omega^2 - k_z^2 v_A^2 = 0 \\implies \\omega^2 = (k\\cos\\theta)^2 v_A^2$\nThis is the dispersion relation for the Alfvén wave. For this mode, $u_x'=u_z'=0$, which implies $\\mathbf{k}\\cdot\\mathbf{u}'=0$. From equation (i), this means $\\rho'=0$, and from (iv), $p'=0$. The Alfvén wave is transverse and incompressible.\n$$ \\omega_A^2 = k^2 v_A^2 \\cos^2\\theta $$\n\n**Magnetosonic Waves (Fast and Slow)**\nFor the coupled system in $u_x'$ and $u_z'$, a non-trivial solution requires the determinant of the matrix to be zero:\n$(\\omega^2 - k^2 v_A^2 - k_x^2 c_s^2)(\\omega^2 - k_z^2 c_s^2) - (k_x k_z c_s^2)^2 = 0$\nExpanding and simplifying with $k_x = k\\sin\\theta$ and $k_z = k\\cos\\theta$:\n$\\omega^4 - \\omega^2(k_z^2 c_s^2 + k^2 v_A^2 + k_x^2 c_s^2) + (k^2 v_A^2)(k_z^2 c_s^2) = 0$\n$\\omega^4 - \\omega^2(k^2 c_s^2 + k^2 v_A^2) + k^4 c_s^2 v_A^2 \\cos^2\\theta = 0$\nDividing by $k^4$, we get a quadratic equation for the phase speed squared, $v_{ph}^2 = \\omega^2/k^2$:\n$(v_{ph}^2)^2 - (c_s^2 + v_A^2) v_{ph}^2 + c_s^2 v_A^2 \\cos^2\\theta = 0$\nThe solutions for $\\omega^2 = k^2 v_{ph}^2$ are:\n$$ \\omega^2 = \\frac{k^2}{2} \\left[ (c_s^2 + v_A^2) \\pm \\sqrt{(c_s^2 + v_A^2)^2 - 4c_s^2 v_A^2 \\cos^2\\theta} \\right] $$\nThe positive root corresponds to the **fast magnetosonic wave** ($\\omega_F^2$) and the negative root to the **slow magnetosonic wave** ($\\omega_S^2$). These waves are compressible ($\\rho'\\neq 0$, $p'\\neq 0$).\n\n### Part 2: Specific Entropy Change\n\nThe specific entropy is given by $s = c_v \\ln(p/\\rho^\\gamma)$. We want to compute $\\Delta s = s(\\text{peak}) - s(\\text{trough})$ for each wave, to leading order in the wave amplitude $\\epsilon$.\nThe entropy perturbation $s' = s - s_0$ is:\n$s' = c_v \\ln\\left(\\frac{p_0+p'}{(\\rho_0+\\rho')^\\gamma}\\right) - c_v \\ln\\left(\\frac{p_0}{\\rho_0^\\gamma}\\right) = c_v \\left[ \\ln(1+p'/p_0) - \\gamma\\ln(1+\\rho'/\\rho_0) \\right]$\nUsing the Taylor series $\\ln(1+x) = x - x^2/2 + O(x^3)$:\n$s' = c_v \\left[ \\left(\\frac{p'}{p_0} - \\frac{1}{2}\\left(\\frac{p'}{p_0}\\right)^2\\right) - \\gamma\\left(\\frac{\\rho'}{\\rho_0} - \\frac{1}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right) + O(\\epsilon^3) \\right]$\n$s' = c_v\\left(\\frac{p'}{p_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) - \\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] + O(\\epsilon^3)$\nThe first term is the first-order entropy perturbation, $s_1'$, and the second is the second-order, $s_2'$.\n\nThe quantity $\\Delta s$ is the difference between entropy at a wave crest and a wave trough. Let the linear perturbations be sinusoidal, e.g., $\\rho' = \\rho'_1 \\cos(\\phi)$ where $\\phi = \\mathbf{k}\\cdot\\mathbf{x}-\\omega t$.\nPeak: $\\phi = 0 \\implies \\rho'=\\rho'_1$, $p'=p'_1$.\nTrough: $\\phi = \\pi \\implies \\rho'=-\\rho'_1$, $p'=-p'_1$.\n$\\Delta s = s'(\\text{peak}) - s'(\\text{trough})$.\nThe leading-order term in the expansion for $\\Delta s$ comes from $s_1'$:\n$\\Delta s = \\left[ c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) \\right] - \\left[ c_v\\left(\\frac{-p'_1}{p_0} - \\gamma\\frac{-\\rho'_1}{\\rho_0}\\right) \\right] + O(\\epsilon^3)$\n$\\Delta s = 2c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) + O(\\epsilon^3)$.\nThe intermediate result requested for the leading-order entropy change relates to the first-order perturbation term $s'_1 = c_v(p'/p_0 - \\gamma\\rho'/\\rho_0)$.\n\nNow we evaluate this for each wave mode.\nAs established in Part 1, the conservation of entropy in ideal MHD linearizes to $p'/p_0 = \\gamma\\rho'/\\rho_0$ for any mode with $\\omega \\neq 0$.\n\n**For Fast and Slow Magnetosonic Waves:**\nThese are compressible waves, so $\\rho'$ and $p'$ are non-zero. They are related by the adiabatic law $p' = c_s^2 \\rho' = (\\gamma p_0/\\rho_0)\\rho'$, which is identical to $p'/p_0 = \\gamma \\rho'/rho_0$.\nSubstituting this into the expression for the first-order entropy perturbation:\n$s'_1 = c_v\\left(\\gamma\\frac{\\rho'}{\\rho_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) = 0$.\nSince the first-order perturbation $s'_1$ is zero, the leading-order term for $\\Delta s$ is also zero. This implies $\\Delta s = 0 + O(\\epsilon^3)$. The entropy change is zero to a higher order than might be naively expected.\nTo be thorough, we can check the next order. The entropy perturbation is dominated by the second-order term:\n$s' \\approx s'_2 = -\\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v}{2}\\left[\\left(\\gamma\\frac{\\rho'}{\\rho_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v\\gamma(\\gamma-1)}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2$.\nAt a wave peak, $\\rho'=\\rho'_1$, so $s'(\\text{peak}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (\\rho'_1/\\rho_0)^2$.\nAt a wave trough, $\\rho'=-\\rho'_1$, so $s'(\\text{trough}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (-\\rho'_1/\\rho_0)^2 = s'(\\text{peak})$.\nTherefore, $\\Delta s = s'(\\text{peak}) - s'(\\text{trough}) = 0$.\nThe specific entropy change across a wavelength is zero for both the fast and slow magnetosonic waves.\n$$ \\Delta s_S = 0 $$\n$$ \\Delta s_F = 0 $$\n\n**For the Alfvén Wave:**\nAs found in Part 1, the Alfvén wave is incompressible in ideal MHD, meaning the first-order density and pressure perturbations are zero: $\\rho'=0$ and $p'=0$.\nSubstituting these into the expression for the entropy perturbation $s'$:\n$s' = c_v \\left[ \\ln(1+0/p_0) - \\gamma\\ln(1+0/\\rho_0) \\right] = 0$.\nThe entropy perturbation is exactly zero for a linear Alfvén wave. Consequently, the change in entropy across a wavelength is also identically zero.\n$$ \\Delta s_A = 0 $$\n\nAll three ideal MHD wave families are isentropic. The specific entropy change between a crest and a trough is zero for all of them.\n\n### Part 3: Final Answer Formulation\n\nThe final answer is required in the form of a single row matrix $\\begin{pmatrix} \\Delta s_{\\mathrm{A}} & \\Delta s_{\\mathrm{S}} & \\Delta s_{\\mathrm{F}} \\end{pmatrix}$.\nBased on the analysis above:\n$\\Delta s_A = 0$\n$\\Delta s_S = 0$\n$\\Delta s_F = 0$\n\nThus, the final matrix is $\\begin{pmatrix} 0 & 0 & 0 \\end{pmatrix}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The core challenge in developing high-resolution schemes is achieving accuracy in smooth regions without introducing non-physical oscillations or violating fundamental conservation laws at discontinuities. This practice guides you through the implementation and comparison of two distinct second-order reconstruction strategies: a standard approach using primitive variables $(\\rho, u, p)$ and an advanced method based on entropy variables $v$. By applying these to challenging test cases, you will directly investigate a key theoretical result: reconstructing in entropy variables can guarantee the entropy stability that is often violated by more conventional methods, providing a robust path toward creating physically consistent, high-order schemes .",
            "id": "3974470",
            "problem": "You are asked to implement and compare two high-order reconstructions for a one-dimensional, nondimensional, compressible plasma flow modeled by the ideal-gas Euler equations. The mathematical foundation must begin from first principles. The physical context is computational fusion science and engineering, but the problem is framed in purely mathematical and algorithmic terms to ensure universal applicability. All quantities are nondimensional; no physical units are required.\n\nThe governing conservation law is the one-dimensional ideal-gas Euler system for a single-component plasma in a regime where magnetic effects are negligible over the considered time step. The conserved state vector is $U = [\\rho, \\rho u, E]^{\\top}$, where $\\rho$ is the mass density, $u$ is the velocity, and $E$ is the total energy density. The flux vector is $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$, where the pressure $p$ is given by the ideal-gas closure $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$, and $\\gamma$ is the ratio of specific heats. The conservation law is $\\partial_t U + \\partial_x F(U) = 0$.\n\nDefine the mathematical entropy function for the Euler equations as $\\eta(U) = -\\rho s / (\\gamma - 1)$, where $s = \\ln(p) - \\gamma \\ln(\\rho)$ is the nondimensional specific entropy. The associated entropy flux is $q(U) = -\\rho u s / (\\gamma - 1)$. The entropy variables are defined by $v = \\partial \\eta / \\partial U$ and serve as a convex coordinate system in which entropy-stable algorithms can be constructed. For the ideal-gas Euler system, one can express $v$ in terms of the primitive variables $(\\rho,u,p)$ by introducing $\\beta = \\rho/p$ and using\n$v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n$v_2 = \\beta u$,\n$v_3 = -\\beta$.\nThe inverse mapping from $v$ to $U$ is derived from these definitions and from $s = \\ln(p) - \\gamma \\ln(\\rho)$:\n$\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp\\left(\\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)\\right)$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$.\n\nYou will implement a single forward-Euler finite-volume update with a Local Lax-Friedrichs (LLF) numerical flux at each cell interface. For an interface with reconstructed left and right states $U_L$ and $U_R$, the LLF flux is $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$, where $\\alpha$ is the maximum signal speed at the interface computed as $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$ and $c = \\sqrt{\\gamma p / \\rho}$ is the nondimensional sound speed. The time step $\\Delta t$ must satisfy the Courant–Friedrichs–Lewy (CFL) condition with factor $0 < \\text{CFL} < 1$: $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$ over the domain.\n\nYou will compare two second-order linear reconstructions for interface states:\n- Primitive-variable reconstruction: reconstruct $(\\rho, u, p)$ linearly from cell averages using centered slopes to obtain left/right interface states; then map to $U$.\n- Entropy-variable reconstruction: reconstruct entropy variables $v$ linearly from cell averages using centered slopes to obtain left/right interface states; then map back to $U$ via the inverse mapping.\n\nTo ensure scientific realism, enforce positivity of reconstructed states by applying floors to $\\rho$ and $p$ if necessary: use $\\rho \\ge \\epsilon_{\\rho}$ and $p \\ge \\epsilon_{p}$ with small nondimensional floors $\\epsilon_{\\rho} = 10^{-12}$ and $\\epsilon_{p} = 10^{-12}$.\n\nFor each reconstruction variant, perform exactly one forward-Euler time step on a uniform grid with periodic boundary conditions. Compute the discrete total mathematical entropy $S = \\sum_i \\eta(U_i)\\,\\Delta x$ before and after the update. Report the discrete entropy change $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$ for each variant. A reconstruction is considered entropy-stable over that step if $\\Delta S \\le 0$ within a numerical tolerance $\\tau = 10^{-12}$.\n\nImplement the program to compute, for each test case, the boolean flags indicating entropy stability for the entropy-variable reconstruction and primitive-variable reconstruction, together with the corresponding entropy changes $\\Delta S$ as floats.\n\nUse nondimensional variables throughout. Angles are not involved. No percentages are involved.\n\nTest Suite and Parameters:\n- Case $1$ (smooth compressive wave, happy path): domain length $L = 1$, number of cells $N = 200$, $\\gamma = 1.4$, CFL factor $\\text{CFL} = 0.4$, initial conditions $\\rho(x) = 1 + 0.2\\sin(2\\pi x)$, $u(x) = 0$, $p(x) = 1$ on $x \\in [0,1]$ with periodic boundary conditions.\n- Case $2$ (discontinuous Riemann problem, shock tube analogue): domain length $L = 1$, $N = 400$, $\\gamma = 1.4$, $\\text{CFL} = 0.4$, initial left state for $x < 0.5$: $(\\rho,u,p) = (1, 0, 1)$, initial right state for $x \\ge 0.5$: $(\\rho,u,p) = (0.125, 0, 0.1)$, periodic boundary conditions.\n- Case $3$ (high-Mach advection with density bump, edge case): domain length $L = 1$, $N = 200$, $\\gamma = 1.4$, $\\text{CFL} = 0.2$, background $(\\rho,u,p) = (1, 2, 0.1)$ with a Gaussian density bump centered at $x = 0.5$ of amplitude $0.5$ and width $\\sigma = 0.05$, so $\\rho(x) = 1 + 0.5\\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sublist in the form $[\\text{stable\\_v}, \\text{stable\\_prim}, \\Delta S_{\\text{v}}, \\Delta S_{\\text{prim}}]$. For example, the output must look like $[[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}]]$ with no additional text.",
            "solution": "The user has provided a problem requesting the implementation and comparison of two second-order spatial reconstruction schemes for a one-dimensional finite-volume method applied to the ideal-gas Euler equations. The validity of the problem statement is assessed first.\n\n### Step 1: Extract Givens\n- **Governing Law**: 1D Euler equations, $\\partial_t U + \\partial_x F(U) = 0$.\n- **State Vector**: $U = [\\rho, \\rho u, E]^{\\top}$.\n- **Flux Vector**: $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$.\n- **Equation of State**: Ideal gas, $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n- **Entropy Function**: $\\eta(U) = -\\rho s / (\\gamma - 1)$, where $s = \\ln(p) - \\gamma \\ln(\\rho)$.\n- **Entropy Variables**: $v = \\partial \\eta / \\partial U$.\n- **Mapping (Primitive to Entropy)**: With $\\beta = \\rho/p$:\n  $v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n  $v_2 = \\beta u$,\n  $v_3 = -\\beta$.\n- **Mapping (Entropy to Conserved)**:\n  $\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp(\\ln(\\rho))$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$.\n- **Numerical Scheme**:\n    - Method: Finite-volume with a single forward-Euler time step.\n    - Grid: Uniform with periodic boundary conditions.\n    - Numerical Flux: Local Lax-Friedrichs (LLF), $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$.\n    - Dissipation coefficient: $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$, with sound speed $c = \\sqrt{\\gamma p / \\rho}$.\n    - Time Step: $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$.\n- **Reconstruction Variants**:\n    1.  Linear reconstruction of primitive variables $(\\rho, u, p)$ using centered slopes.\n    2.  Linear reconstruction of entropy variables $v$ using centered slopes.\n- **Constraints**: Positivity floors: $\\rho \\ge \\epsilon_{\\rho} = 10^{-12}$, $p \\ge \\epsilon_{p} = 10^{-12}$.\n- **Analysis**: Compute total entropy change $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$, where $S = \\sum_i \\eta(U_i)\\,\\Delta x$.\n- **Stability Criterion**: $\\Delta S \\le \\tau = 10^{-12}$.\n- **Test Cases**:\n    - **Case 1**: Smooth wave; $L=1, N=200, \\gamma=1.4, \\text{CFL}=0.4$; IC: $\\rho(x) = 1 + 0.2\\sin(2\\pi x), u(x)=0, p(x)=1$.\n    - **Case 2**: Riemann problem; $L=1, N=400, \\gamma=1.4, \\text{CFL}=0.4$; IC: $(\\rho,u,p)=(1,0,1)$ for $x<0.5$, and $(0.125,0,0.1)$ for $x \\ge 0.5$.\n    - **Case 3**: High-Mach advection; $L=1, N=200, \\gamma=1.4, \\text{CFL}=0.2$; IC: $(\\rho,u,p)$ background of $(1,2,0.1)$ with Gaussian density bump $\\rho(x)|_{\\text{pert}} = 0.5\\exp(-\\frac{(x-0.5)^2}{2(0.05)^2})$.\n- **Output**: A list of lists: `[[stable_v, stable_prim, dS_v, dS_prim], ...]` for the three cases.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is based on the Euler equations, a fundamental model in fluid dynamics. The concepts of entropy stability, entropy variables, and finite-volume methods (specifically LLF flux and linear reconstruction) are standard and well-documented topics in computational gas dynamics and MHD. All provided mathematical formulas are correct and standard in this context.\n- **Well-Posedness**: The problem describes a complete numerical experiment. It specifies the governing equations, initial and boundary conditions, numerical algorithm, and the quantities to be computed. The task is unambiguous. For the given CFL factors, the numerical scheme is expected to be stable in the standard linear sense. The existence of a unique numerical result is guaranteed.\n- **Objectivity**: The problem is stated in purely mathematical and algorithmic terms. The success criterion (entropy stability) is defined by a precise numerical inequality. No subjective interpretation is required.\n- **Completeness**: All necessary parameters ($\\gamma$, CFL, $L$, $N$), initial conditions, and numerical procedures are fully specified. The formulation is self-contained.\n- **Consistency**: The variable transformations between primitive, conserved, and entropy variables are internally consistent. The problem setup does not contain contradictions.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It presents a standard but non-trivial exercise in computational physics, suitable for demonstrating important properties of numerical schemes for conservation laws. The problem is **valid**. A solution will be constructed.\n\n### Principle-Based Design\nThe solution will be implemented by first establishing a set of helper functions that perform the transformations between different representations of the fluid state (primitive, conserved, and entropy variables), calculate physical quantities like pressure and sound speed, and compute the mathematical entropy. This modular approach ensures clarity and correctness.\n\nThe core of the implementation is a function that performs a single time step of the finite-volume scheme. This function will be generic enough to accept cell-average data in either primitive or entropy variables.\n\nThe process for a single time step is as follows:\n1.  **Reconstruction**: For each cell interface, we reconstruct the left and right states. This is done by taking the cell-average values in the cells neighboring the interface and applying a linear extrapolation to the interface location. The slope for this extrapolation is computed using a centered difference formula on the cell-average data. This process is applied to the chosen set of variables (either primitive or entropy).\n2.  **State Conversion and Positivity**: The reconstructed left and right states, which are given in terms of the reconstruction variables, are converted to the conserved variable vector $U = [\\rho, \\rho u, E]^{\\top}$. For the entropy-variable reconstruction, this involves the non-trivial inverse mapping $v \\to U$. An essential physical constraint is the positivity of density $\\rho$ and pressure $p$. After reconstruction and before their use in flux calculations, these primitive quantities are enforced to be above a small positive floor value. This step is critical for numerical robustness, especially when the scheme produces oscillations.\n3.  **Flux Calculation**: At each interface, the Local Lax-Friedrichs (LLF) numerical flux is computed. The LLF flux is an approximate Riemann solver that consists of an average of the fluxes from the left and right states, plus a dissipation term proportional to the jump in the conserved states $(U_R - U_L)$. The dissipation is controlled by the maximum characteristic speed at the interface, ensuring sufficient numerical viscosity to maintain stability, particularly across shock waves and contact discontinuities.\n4.  **Conservative Update**: Finally, the cell-average conserved state in each cell is updated using the divergence of the numerical flux. For a uniform grid, this simplifies to $U_i^{n+1} = U_i^n - (\\Delta t / \\Delta x)(F^*_{i+1/2} - F^*_{i-1/2})$. Periodic boundary conditions are handled by appropriate indexing of the flux array.\n\nThis entire process is performed for each of the two reconstruction strategies. The total discrete entropy of the system is calculated before and after the time step to determine the entropy change, $\\Delta S$. For a physically correct solution of the continuous Euler equations, the total entropy should not decrease (Second Law of Thermodynamics). However, for a numerical scheme to be 'entropy-stable', its discrete entropy must not increase. That is, the numerical dissipation inherent in the scheme must be sufficient to dissipate energy in a way that is consistent with the entropy condition at shocks, without generating spurious entropy in smooth regions. This property, $\\Delta S \\le 0$, is the key metric of comparison. The entropy-variable reconstruction is specifically designed to achieve this, while the standard primitive-variable reconstruction is not guaranteed to do so, and is expected to fail this test, especially for challenging cases with shocks or strong gradients.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n\n    # Helper functions for state conversions and physical quantities\n    def prim_to_U(rho, u, p, gamma):\n        E = p / (gamma - 1.0) + 0.5 * rho * u**2\n        return np.stack([rho, rho * u, E], axis=-1)\n\n    def U_to_prim(U, gamma, rho_floor=1e-12, p_floor=1e-12):\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        E = U[..., 2]\n        p = (gamma - 1.0) * (E - 0.5 * rho * u**2)\n        # Apply floors to prevent non-physical states from subsequent calculations\n        rho = np.maximum(rho, rho_floor)\n        p = np.maximum(p, p_floor)\n        return rho, u, p\n\n    def get_flux(U, gamma):\n        rho, u, p = U_to_prim(U, gamma)\n        E = U[..., 2]\n        F1 = rho * u\n        F2 = rho * u**2 + p\n        F3 = u * (E + p)\n        return np.stack([F1, F2, F3], axis=-1)\n    \n    def get_sound_speed(rho, p, gamma):\n        return np.sqrt(gamma * p / rho)\n\n    def get_entropy_density(U, gamma):\n        # Use floors to prevent log of non-positive numbers\n        rho, _, p = U_to_prim(U, gamma, rho_floor=1e-14, p_floor=1e-14)\n        s = np.log(p) - gamma * np.log(rho)\n        eta = -rho * s / (gamma - 1.0)\n        return eta\n        \n    def prim_to_v(rho, u, p, gamma):\n        beta = rho / p\n        s = np.log(p) - gamma * np.log(rho)\n        v1 = (gamma - s) / (gamma - 1.0) - 0.5 * beta * u**2\n        v2 = beta * u\n        v3 = -beta\n        return np.stack([v1, v2, v3], axis=-1)\n\n    def v_to_prim(v, gamma):\n        v1, v2, v3 = v[..., 0], v[..., 1], v[..., 2]\n        beta = -v3\n        \n        # Initialize output arrays with NaN for invalid states\n        rho = np.full_like(v1, np.nan)\n        u = np.full_like(v1, np.nan)\n        p = np.full_like(v1, np.nan)\n\n        # Only compute for physical beta > 0\n        valid_mask = beta > 1e-14\n\n        if np.any(valid_mask):\n            beta_v = beta[valid_mask]\n            v1_v = v1[valid_mask]\n            v2_v = v2[valid_mask]\n\n            u_v = v2_v / beta_v\n            s_v = gamma - (gamma - 1.0) * (v1_v + 0.5 * beta_v * u_v**2)\n            log_rho_v = (-s_v - np.log(beta_v)) / (gamma - 1.0)\n            rho_v = np.exp(log_rho_v)\n            p_v = rho_v / beta_v\n            \n            # Place valid results into output arrays\n            rho[valid_mask] = rho_v\n            u[valid_mask] = u_v\n            p[valid_mask] = p_v\n            \n        return rho, u, p\n\n    def take_one_step(U_initial, W_cell_avg, recon_type, gamma, dx, dt, rho_floor, p_floor):\n        N = U_initial.shape[0]\n        \n        # Centered reconstruction to get left/right states at interfaces i+1/2\n        W_im1 = np.roll(W_cell_avg, 1, axis=0)\n        W_ip1 = np.roll(W_cell_avg, -1, axis=0)\n        W_ip2 = np.roll(W_cell_avg, -2, axis=0)\n        \n        # Using slope_i = (W_{i+1}-W_{i-1})/(2*dx), value = W_i + slope_i * dx/2 simplifies to...\n        W_L = W_cell_avg + (W_ip1 - W_im1) / 4.0\n        # Reconstructing from cell i+1 for the right state at interface i+1/2\n        W_R = W_ip1 - (W_ip2 - W_cell_avg) / 4.0\n        \n        if recon_type == 'primitive':\n            rho_L, u_L, p_L = W_L[..., 0], W_L[..., 1], W_L[..., 2]\n            rho_R, u_R, p_R = W_R[..., 0], W_R[..., 1], W_R[..., 2]\n        elif recon_type == 'entropy':\n            rho_L, u_L, p_L = v_to_prim(W_L, gamma)\n            rho_R, u_R, p_R = v_to_prim(W_R, gamma)\n        else:\n            raise ValueError(\"Invalid reconstruction type\")\n\n        # Positivity enforcement\n        rho_L = np.maximum(rho_L, rho_floor)\n        p_L = np.maximum(p_L, p_floor)\n        rho_R = np.maximum(rho_R, rho_floor)\n        p_R = np.maximum(p_R, p_floor)\n\n        U_L = prim_to_U(rho_L, u_L, p_L, gamma)\n        U_R = prim_to_U(rho_R, u_R, p_R, gamma)\n        \n        # LLF Flux Calculation\n        F_L = get_flux(U_L, gamma)\n        F_R = get_flux(U_R, gamma)\n        \n        c_L = get_sound_speed(rho_L, p_L, gamma)\n        c_R = get_sound_speed(rho_R, p_R, gamma)\n        \n        alpha = np.maximum(np.abs(u_L) + c_L, np.abs(u_R) + c_R)\n        alpha = alpha[..., np.newaxis] # for broadcasting\n        \n        F_star = 0.5 * (F_L + F_R) - 0.5 * alpha * (U_R - U_L)\n        \n        # Update\n        F_star_im1 = np.roll(F_star, 1, axis=0)\n        U_final = U_initial - (dt / dx) * (F_star - F_star_im1)\n        \n        return U_final\n\n    def run_case(params):\n        L, N, gamma, CFL = params['L'], params['N'], params['gamma'], params['CFL']\n        ic_type = params['ic_type']\n        \n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        \n        # Initial Conditions\n        if ic_type == 1:\n            rho = 1.0 + 0.2 * np.sin(2 * np.pi * x / L)\n            u = np.zeros(N)\n            p = np.ones(N)\n        elif ic_type == 2:\n            rho = np.ones(N)\n            u = np.zeros(N)\n            p = np.ones(N)\n            mask = x >= 0.5 * L\n            rho[mask] = 0.125\n            p[mask] = 0.1\n        elif ic_type == 3:\n            sigma = 0.05\n            rho = 1.0 + 0.5 * np.exp(-((x - 0.5 * L)**2) / (2 * sigma**2))\n            u = np.full(N, 2.0)\n            p = np.full(N, 0.1)\n\n        U_initial = prim_to_U(rho, u, p, gamma)\n        c_initial = get_sound_speed(rho, p, gamma)\n        dt = CFL * dx / np.max(np.abs(u) + c_initial)\n        \n        S_initial = np.sum(get_entropy_density(U_initial, gamma)) * dx\n        rho_floor, p_floor, stability_tol = 1e-12, 1e-12, 1e-12\n\n        # Entropy-variable reconstruction\n        W_v = prim_to_v(rho, u, p, gamma)\n        U_final_v = take_one_step(U_initial, W_v, 'entropy', gamma, dx, dt, rho_floor, p_floor)\n        S_final_v = np.sum(get_entropy_density(U_final_v, gamma)) * dx\n        dS_v = S_final_v - S_initial\n        stable_v = (not np.isnan(dS_v)) and (dS_v <= stability_tol)\n\n        # Primitive-variable reconstruction\n        W_prim = np.stack([rho, u, p], axis=-1)\n        U_final_prim = take_one_step(U_initial, W_prim, 'primitive', gamma, dx, dt, rho_floor, p_floor)\n        S_final_prim = np.sum(get_entropy_density(U_final_prim, gamma)) * dx\n        dS_prim = S_final_prim - S_initial\n        stable_prim = (not np.isnan(dS_prim)) and (dS_prim <= stability_tol)\n        \n        return [stable_v, stable_prim, dS_v, dS_prim]\n\n    # --- Test Suite ---\n    test_cases = [\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 1},\n        {'L': 1.0, 'N': 400, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 2},\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.2, 'ic_type': 3, 'sigma': 0.05}\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(run_case(case))\n        \n    # Format output as specified\n    string_results = ','.join(map(str, results))\n    print(f\"[{string_results}]\")\n\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "Theoretical principles of entropy stability find their power in practical application, guiding the design of robust and adaptive simulation tools. This exercise tasks you with constructing a numerical diagnostic, or \"shock sensor,\" based on the local entropy production rate within a flow. By implementing a discrete measure of the entropy residual, you will create a tool that can distinguish smooth, isentropic regions from dissipative shocks, forming the basis for sophisticated hybrid schemes that apply high accuracy where appropriate and high stability where needed .",
            "id": "3974549",
            "problem": "Consider a one-dimensional single-fluid ideal plasma modeled by the compressible Euler equations with an ideal-gas closure, a standard proxy used in computational fusion science to design and assess entropy-stable schemes in regimes without strong magnetization. Let the ratio of specific heats be $\\gamma > 1$, and assume nondimensional variables so that physical units need not be reported. The thermodynamic specific entropy (up to an additive constant) is defined by $s = \\ln(p) - \\gamma \\ln(\\rho)$, where $\\rho$ is the mass density, $u$ is the velocity, and $p$ is the pressure. The entropy density is $S = \\rho s$, and the entropy flux is $F = \\rho s u$. In smooth, inviscid solutions of the Euler equations, the second law implies the entropy inequality\n$$\n\\partial_t (\\rho s) + \\partial_x (\\rho s u) \\ge 0,\n$$\nwith equality in smooth regions and strict positivity only at shocks or in the presence of dissipation. An entropy-stable numerical method should respect a discrete version of this inequality.\n\nYou are asked to construct a fully discrete cell-wise diagnostic that measures the change in entropy and to relate it to shock sensor thresholds for dynamic entropy-based limiting. Specifically, for a spatially uniform grid with $N$ cells, cell width $\\Delta x$, and two consecutive time levels $t^n$ and $t^{n+1} = t^n + \\Delta t$, define the following discrete diagnostic for each cell index $i \\in \\{0,1,\\dots,N-1\\}$:\n1. Compute the specific entropy at each time level:\n$$\ns_i^n = \\ln(p_i^n) - \\gamma \\ln(\\rho_i^n), \\quad s_i^{n+1} = \\ln(p_i^{n+1}) - \\gamma \\ln(\\rho_i^{n+1}).\n$$\n2. Form the entropy density and its arithmetic time average:\n$$\nS_i^n = \\rho_i^n s_i^n, \\quad S_i^{n+1} = \\rho_i^{n+1} s_i^{n+1}, \\quad S_i^\\ast = \\tfrac{1}{2}(S_i^n + S_i^{n+1}).\n$$\n3. Form the entropy flux and its arithmetic time average:\n$$\nF_i^n = \\rho_i^n s_i^n u_i^n, \\quad F_i^{n+1} = \\rho_i^{n+1} s_i^{n+1} u_i^{n+1}, \\quad F_i^\\ast = \\tfrac{1}{2}(F_i^n + F_i^{n+1}).\n$$\n4. Define the discrete entropy residual using a forward difference in time and a centered difference in space with periodic boundary conditions:\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x},\n$$\nwhere indices wrap modulo $N$ for periodicity.\n5. Normalize the residual by a global thermodynamic scale based on the maximum pseudo-compressibility $\\max_j \\gamma p_j^\\ast$, where $p_j^\\ast = \\tfrac{1}{2}(p_j^n + p_j^{n+1})$:\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon},\n$$\nwith a small positive $\\varepsilon = 10^{-14}$ to prevent division by zero. The quantity $\\sigma_i$ is a dimensionless sensor that is small in smooth, near-isentropic regions and increases near shocks or strong dissipative events.\n\nUse the sensor $\\sigma_i$ to define a dynamic entropy-based limiter coefficient $\\theta_i \\in [0,1]$ controlled by two thresholds $0 \\le \\tau_{\\text{low}} < \\tau_{\\text{high}}$:\n$$\n\\theta_i = \n\\begin{cases}\n0, & \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}}, & \\tau_{\\text{low}} < \\sigma_i < \\tau_{\\text{high}}, \\\\\n1, & \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\n\nImplement a program that computes $\\sigma_i$ and $\\theta_i$ for the following test suite, using the fixed parameters $N = 100$, $\\Delta x = 1/N$, $\\Delta t = 10^{-3}$, and $\\gamma = 1.4$. All tests are defined on the periodic domain $x \\in [0,1)$ with cell centers $x_i = (i + 0.5)\\Delta x$ for $i \\in \\{0,\\dots,N-1\\}$. The thresholds are fixed as $\\tau_{\\text{low}} = 0.02$ and $\\tau_{\\text{high}} = 0.2$.\n\nTest A (smooth isentropic at rest):\n- Let $K = 1$. Define $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = 0$, and $p_i^n = K (\\rho_i^n)^\\gamma$. Set $\\rho_i^{n+1} = \\rho_i^n$, $u_i^{n+1} = u_i^n$, and $p_i^{n+1} = p_i^n$.\n\nTest B (smooth isentropic advection):\n- Let $K = 1$ and constant advection speed $u_0 = 0.5$. Define $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = u_0$, $p_i^n = K (\\rho_i^n)^\\gamma$. Obtain $\\rho_i^{n+1}$ by periodic advection of $\\rho^n$ over a distance $u_0 \\Delta t$, i.e., $\\rho^{n+1}(x) = \\rho^n(x - u_0 \\Delta t)$ using linear interpolation and periodic wrapping; set $u_i^{n+1} = u_0$ and $p_i^{n+1} = K (\\rho_i^{n+1})^\\gamma$.\n\nTest C (incipient shock-like heating, stationary flow):\n- Define a Gaussian bump centered at $x_c = 0.5$ with width $w = 0.05$. Let $\\rho_i^n = 1$, $u_i^n = 0$, and $p_i^n = 1 + 0.20 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$. At the next time, increase only the pressure amplitude to $p_i^{n+1} = 1 + 0.25 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$, keeping $\\rho_i^{n+1} = 1$ and $u_i^{n+1} = 0$. This models localized irreversible heating consistent with entropy production.\n\nFor each test case, compute:\n- The maximum sensor value $\\max_i \\sigma_i$ (a float).\n- The count of cells with $\\sigma_i \\ge \\tau_{\\text{high}}$ (an integer).\n- The count of cells with $\\tau_{\\text{low}} \\le \\sigma_i < \\tau_{\\text{high}}$ (an integer).\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list of three bracketed triplets, each triplet corresponding to one test in the order A, B, C, and each triplet formatted as [max_sigma,count_high,count_mid] with no spaces. For example, the output should look like:\n[[maxA,countHighA,countMidA],[maxB,countHighB,countMidB],[maxC,countHighC,countMidC]]\nAll outputs are nondimensional and must be reported as raw numbers without any unit symbols or percentage signs. Angles are not involved in this problem.",
            "solution": "The problem requires the implementation of a numerical diagnostic for entropy production in a one-dimensional ideal plasma flow, modeled by the compressible Euler equations. This diagnostic, often called a shock sensor or trouble indicator, is crucial for modern high-resolution numerical schemes. Such schemes aim to be highly accurate in smooth regions of the flow but must introduce artificial dissipation in regions with strong gradients, such as shocks, to prevent non-physical oscillations and maintain stability. The second law of thermodynamics, manifested as an entropy inequality, provides a robust physical principle to guide this process. An entropy-stable scheme must ensure that the total entropy in the domain does not decrease over time. The diagnostic developed here, $\\sigma_i$, measures the local, cell-wise entropy production rate.\n\nThe core of the diagnostic is the discrete entropy residual, $R_i$. It is a finite-difference approximation of the entropy conservation equation, $\\partial_t S + \\partial_x F = 0$, where $S = \\rho s$ is the entropy density and $F = \\rho s u$ is the entropy flux. The problem specifies a particular discretization: a forward difference in time and a centered difference in space.\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x}\n$$\nHere, quantities with superscript $n$ and $n+1$ represent the values at two consecutive time levels, and the subscript $i$ denotes the spatial cell index. The flux $F^\\ast$ is a time-averaged value, $F^\\ast = \\frac{1}{2}(F^n + F^{n+1})$, chosen for time-centering and consistency. In smooth, isentropic regions of the flow, the continuous entropy equation holds with equality. A consistent numerical discretization should therefore produce a residual $R_i$ that is close to zero, limited only by the truncation error of the finite-difference scheme. At a shock, however, physical entropy is produced, and the entropy equation becomes an inequality, $\\partial_t S + \\partial_x F > 0$. In such regions, $R_i$ will be significantly positive, signaling a physical dissipation process.\n\nThe raw residual $R_i$ is dimensional. To create a robust, dimensionless sensor, it is normalized. The normalization factor, $\\gamma \\max_j p_j^\\ast$, is based on the maximum pressure in the domain, which serves as a proxy for the characteristic thermodynamic energy scale. The factor $\\gamma p^\\ast$ is related to quantities like the square of the sound speed, providing a physically meaningful scale. The resulting dimensionless sensor is:\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon}\n$$\nThe value of $\\sigma_i$ is expected to be small in smooth flow regions and large near shocks or other strong dissipative features.\n\nThis sensor is then used to define a limiter coefficient, $\\theta_i$, via a piecewise function controlled by two thresholds, $\\tau_{\\text{low}}$ and $\\tau_{\\text{high}}$.\n$$\n\\theta_i = \n\\begin{cases}\n0, & \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}}, & \\tau_{\\text{low}} < \\sigma_i < \\tau_{\\text{high}}, \\\\\n1, & \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\nIf $\\sigma_i$ is below $\\tau_{\\text{low}}$, the flow is considered smooth, and $\\theta_i=0$, indicating that no extra dissipation is needed. If $\\sigma_i$ is above $\\tau_{\\text{high}}$, the flow is considered shocked, and $\\theta_i=1$, indicating that maximum dissipation should be applied. The intermediate region provides a smooth transition.\n\nThe implementation will proceed by first setting up the computational grid and physical constants. A function will be created to compute the diagnostic quantities ($\\sigma_i$ and the derived counts) for a given pair of states $(\\rho^n, u^n, p^n)$ and $(\\rho^{n+1}, u^{n+1}, p^{n+1})$. This function will be applied to the three specified test cases.\n\n- **Test A** describes a static, isentropic state. Because the state does not change in time ($S^{n+1}=S^n$) and the velocity is zero ($F=0$), the residual $R_i$ must be identically zero. Consequently, $\\sigma_i$ will be zero for all cells.\n\n- **Test B** models a smooth wave advecting at a constant speed. The state is isentropic, so any non-zero entropy residual arises purely from numerical error, specifically the error from the linear interpolation used to advect the density profile and the truncation error of the finite-difference formula for $R_i$. These errors are expected to be small, resulting in small values of $\\sigma_i$.\n\n- **Test C** models a localized heating event at constant density and zero velocity. This is a direct model of entropy production, as increasing pressure at constant density ($p_i^{n+1} > p_i^n, \\rho_i^{n+1}=\\rho_i^n$) increases the specific entropy $s_i = \\ln(p_i/\\rho_i^\\gamma)$. Since $u=0$, the flux term in $R_i$ is zero, and the residual is $R_i = (S_i^{n+1}-S_i^n)/\\Delta t > 0$, concentrated where the heating occurs. This case is designed to produce large values of $\\sigma_i$, thereby activating the limiter.\n\nThe code will use the `numpy` library for efficient array-based computations, `np.roll` for handling periodic boundary conditions in the centered difference, and `np.interp` with the `period` argument for the periodic advection in Test B.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a shock sensor diagnostic for three test cases in 1D fluid dynamics.\n    \"\"\"\n    # Define global parameters and grid\n    N = 100\n    dx = 1.0 / N\n    dt = 1e-3\n    gamma = 1.4\n    tau_low = 0.02\n    tau_high = 0.2\n    epsilon = 1e-14\n    x = (np.arange(N) + 0.5) * dx\n\n    def compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1):\n        \"\"\"\n        Calculates the entropy residual sensor and limiter activation counts.\n\n        Args:\n            rho_n, u_n, p_n: State variables at time n.\n            rho_np1, u_np1, p_np1: State variables at time n+1.\n\n        Returns:\n            A list containing [max_sigma, count_high, count_mid].\n        \"\"\"\n        # 1. Compute specific entropy\n        # Add a small value to log arguments to avoid log(0) for generality, though not strictly needed for these tests.\n        log_rho_n = np.log(rho_n + epsilon)\n        log_p_n = np.log(p_n + epsilon)\n        s_n = log_p_n - gamma * log_rho_n\n        \n        log_rho_np1 = np.log(rho_np1 + epsilon)\n        log_p_np1 = np.log(p_np1 + epsilon)\n        s_np1 = log_p_np1 - gamma * log_rho_np1\n\n        # 2. Form entropy density\n        S_n = rho_n * s_n\n        S_np1 = rho_np1 * s_np1\n\n        # 3. Form entropy flux and its arithmetic time average\n        F_n = S_n * u_n\n        F_np1 = S_np1 * u_np1\n        F_star = 0.5 * (F_n + F_np1)\n\n        # 4. Define the discrete entropy residual R_i\n        # Forward difference in time\n        time_derivative = (S_np1 - S_n) / dt\n        # Centered difference in space with periodic boundaries\n        F_star_ip1 = np.roll(F_star, -1)\n        F_star_im1 = np.roll(F_star, 1)\n        space_derivative = (F_star_ip1 - F_star_im1) / (2 * dx)\n        R = time_derivative + space_derivative\n\n        # 5. Normalize the residual to get the sensor sigma_i\n        p_star = 0.5 * (p_n + p_np1)\n        normalization_factor = gamma * np.max(p_star) + epsilon\n        sigma = (dx * np.abs(R)) / normalization_factor\n\n        # Use the sensor to calculate required outputs\n        max_sigma = np.max(sigma)\n        count_high = np.sum(sigma >= tau_high)\n        count_mid = np.sum((sigma >= tau_low) & (sigma < tau_high))\n\n        return [max_sigma, int(count_high), int(count_mid)]\n\n    test_cases = []\n\n    # === Test A: Smooth isentropic at rest ===\n    K_A = 1.0\n    rho_n_A = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_A = np.zeros(N)\n    p_n_A = K_A * (rho_n_A)**gamma\n    rho_np1_A, u_np1_A, p_np1_A = rho_n_A, u_n_A, p_n_A\n    test_cases.append(('A', rho_n_A, u_n_A, p_n_A, rho_np1_A, u_np1_A, p_np1_A))\n\n    # === Test B: Smooth isentropic advection ===\n    K_B = 1.0\n    u0_B = 0.5\n    rho_n_B = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_B = np.full(N, u0_B)\n    p_n_B = K_B * (rho_n_B)**gamma\n    \n    # Advect rho using periodic linear interpolation\n    x_shifted = x - u0_B * dt\n    rho_np1_B = np.interp(x_shifted, x, rho_n_B, period=1.0)\n    \n    u_np1_B = np.full(N, u0_B)\n    p_np1_B = K_B * (rho_np1_B)**gamma\n    test_cases.append(('B', rho_n_B, u_n_B, p_n_B, rho_np1_B, u_np1_B, p_np1_B))\n    \n    # === Test C: Incipient shock-like heating ===\n    xc_C = 0.5\n    w_C = 0.05\n    gaussian = np.exp(-((x - xc_C)**2) / w_C**2)\n    rho_n_C = np.ones(N)\n    u_n_C = np.zeros(N)\n    p_n_C = 1.0 + 0.20 * gaussian\n    rho_np1_C = np.ones(N)\n    u_np1_C = np.zeros(N)\n    p_np1_C = 1.0 + 0.25 * gaussian\n    test_cases.append(('C', rho_n_C, u_n_C, p_n_C, rho_np1_C, u_np1_C, p_np1_C))\n\n    # Run all tests and collect results\n    results = []\n    for _, rho_n, u_n, p_n, rho_np1, u_np1, p_np1 in test_cases:\n        result = compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1)\n        results.append(result)\n\n    # Format the final output string\n    formatted_results = []\n    for res in results:\n        # res[0] is float, res[1] and res[2] are ints.\n        formatted_results.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}