{
    "hands_on_practices": [
        {
            "introduction": "在深入研究用于湍流模拟的复杂场向坐标系之前，我们首先需要对磁场线的几何结构有一个坚实的基本理解。本练习通过从第一性原理出发，推导托卡马克中一个关键的物理量——安全因子 $q$，来帮助我们建立这种理解。这项分析性练习将加强您在磁约束聚变中连接抽象数学表述与关键物理参数（如决定等离子体稳定性的场线缠绕数）的能力。",
            "id": "3980015",
            "problem": "考虑一个轴对称托卡马克平衡，其磁通量面为圆形同心面，小半径为$r$，大半径为$R_{0}$，在柱坐标系中描述为$R(\\theta) = R_{0} + r \\cos\\theta$和$Z(\\theta) = r \\sin\\theta$，其中$\\theta$是极向角，$\\zeta$是环向角。角度均以弧度为单位。假设磁场$\\boldsymbol{B}$由标准的轴对称形式给出：\n$$\n\\boldsymbol{B} = F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi,\n$$\n其中$F(\\psi)$是环向场函数，$\\psi$是仅依赖于$r$的极向磁通量标签，即$\\psi = \\psi(r)$且$\\frac{d\\psi}{dr}  0$。在正交环向坐标系$(r,\\theta,\\zeta)$中，尺度因子满足$|\\nabla r| = 1$、$|\\nabla \\theta| = \\frac{1}{r}$和$|\\nabla \\zeta| = \\frac{1}{R}$，其中$R(\\theta) = R_{0} + r \\cos\\theta$，并且该坐标系是正交的，因此$\\nabla \\theta \\cdot \\nabla \\zeta = 0$。\n\n从第一性原理出发——即磁力线的定义（作为$\\boldsymbol{B}$的积分曲线，由微分关系$d\\boldsymbol{x} \\times \\boldsymbol{B} = \\boldsymbol{0}$给出）和场线螺距关系$\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta}$——推导安全因子$q(\\psi)$的显式闭合形式表达式，其定义为\n$$\nq(\\psi) = \\frac{1}{2\\pi}\\oint_{0}^{2\\pi} \\frac{d\\zeta}{d\\theta}\\, d\\theta,\n$$\n其中积分是在固定的$\\psi$下，沿一个完整的极向回路进行，$\\theta$从$0$到$2\\pi$弧度。\n\n请将您的最终答案表示为一个以$F(\\psi)$、$R_{0}$、$r$和在由$\\psi$标记的磁通量面上求值的$\\frac{d\\psi}{dr}$表示的闭合形式解析表达式。您可以将$r$视为对应于磁通量面$\\psi = \\psi(r)$的小半径，并且可以使用由给定几何结构导出的任何标准矢量微积分和正交坐标恒等式。不需要进行数值近似；请提供精确表达式。最后，解释$q(\\psi)$在此轴对称平衡中作为场线缠绕数的物理意义。\n\n您的最终答案必须是一个单一的闭合形式表达式。最终的方框答案中不应包含任何单位。",
            "solution": "本问题要求从第一性原理推导轴对称托卡马克中的安全因子 $q(\\psi)$。\n\n安全因子$q(\\psi)$定义为场线螺距在一个完整极向回路上的平均值：\n$$\nq(\\psi) = \\frac{1}{2\\pi}\\oint_{0}^{2\\pi} \\frac{d\\zeta}{d\\theta}\\, d\\theta, \\quad \\text{其中} \\quad \\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta}\n$$\n推导过程是分别计算螺距表达式的分子和分母。\n\n首先，我们计算分子$\\boldsymbol{B}\\cdot \\nabla \\zeta$。将磁场表达式$\\boldsymbol{B} = F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi$与$\\nabla \\zeta$做点积：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\zeta = F(\\psi) (\\nabla \\zeta \\cdot \\nabla \\zeta) + (\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\zeta\n$$\n第二项是带有重复向量的标量三重积，其值恒为零。利用给定的尺度因子$|\\nabla \\zeta| = 1/R$，分子变为：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\zeta = F(\\psi) |\\nabla \\zeta|^2 = \\frac{F(\\psi)}{R^2}\n$$\n接下来，我们计算分母$\\boldsymbol{B}\\cdot \\nabla \\theta$：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = F(\\psi) (\\nabla \\zeta \\cdot \\nabla \\theta) + (\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\theta\n$$\n由于坐标系是正交的，$\\nabla \\zeta \\cdot \\nabla \\theta = 0$。利用标量三重积的轮换性质$(\\boldsymbol{A} \\times \\boldsymbol{B}) \\cdot \\boldsymbol{C} = (\\boldsymbol{C} \\times \\boldsymbol{A}) \\cdot \\boldsymbol{B}$，分母变为：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = (\\nabla \\theta \\times \\nabla \\zeta) \\cdot \\nabla \\psi\n$$\n在正交坐标系$(r, \\theta, \\zeta)$中，$\\nabla \\theta = \\hat{\\boldsymbol{e}}_\\theta/r$ 和 $\\nabla \\zeta = \\hat{\\boldsymbol{e}}_\\zeta/R$，因此它们的叉积为 $\\nabla \\theta \\times \\nabla \\zeta = \\frac{1}{rR} \\hat{\\boldsymbol{e}}_r$。又因为$\\psi$仅依赖于$r$，其梯度为$\\nabla \\psi = \\frac{d\\psi}{dr} \\nabla r = \\frac{d\\psi}{dr} \\hat{\\boldsymbol{e}}_r$。代入可得：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = \\left( \\frac{1}{rR} \\hat{\\boldsymbol{e}}_r \\right) \\cdot \\left( \\frac{d\\psi}{dr} \\hat{\\boldsymbol{e}}_r \\right) = \\frac{1}{rR} \\frac{d\\psi}{dr}\n$$\n组合分子和分母得到场线螺距：\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta} = \\frac{F(\\psi)/R^2}{(1/rR) (d\\psi/dr)} = \\frac{r F(\\psi)}{R(d\\psi/dr)}\n$$\n将此表达式代入$q(\\psi)$的定义式中。由于积分是在一个磁通面上进行，$r$、$F(\\psi)$和$d\\psi/dr$均为常数，可以移到积分号外：\n$$\nq(\\psi) = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\int_{0}^{2\\pi} \\frac{1}{R(\\theta)} d\\theta = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\int_{0}^{2\\pi} \\frac{d\\theta}{R_0 + r \\cos\\theta}\n$$\n这是一个标准定积分，对于$R_0 > r$，其值为$\\int_{0}^{2\\pi} \\frac{d\\theta}{R_0 + r \\cos\\theta} = \\frac{2\\pi}{\\sqrt{R_0^2 - r^2}}$。代入积分结果：\n$$\nq(\\psi) = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\left( \\frac{2\\pi}{\\sqrt{R_0^2 - r^2}} \\right) = \\frac{r F(\\psi)}{(d\\psi/dr) \\sqrt{R_0^2 - r^2}}\n$$\n这就是安全因子的最终闭合形式表达式。\n\n**$q(\\psi)$的物理意义**\n\n安全因子$q(\\psi)$代表了在由$\\psi$标记的特定磁通量面上磁力线的缠绕数。简单来说，$q(\\psi)$是磁力线沿极向（短程）环绕一周时，其沿环向（长程）环绕环体的次数。例如，在某个磁通量面上$q$值为3，意味着该面上的磁力线必须沿环向方向环绕环体3次才能完成一次极向的环绕。\n\n$q$的值是影响等离子体稳定性的关键参数。如果$q(\\psi)$是一个有理数，即对于整数$m$和$n$，$q = m/n$，那么磁力线是闭合的——它在经过$n$次极向穿行和$m$次环向穿行后会精确地回到其起点。这些“有理面”特别容易受到磁流体动力学（MHD）不稳定性的影响，例如撕裂模，这会降低等离子体约束性能。因此，在托卡马克运行中，需要仔细控制$q$在等离子体半径上的剖面，以避免可触及的低阶有理面。",
            "answer": "$$\n\\boxed{\\frac{r F(\\psi)}{\\frac{d\\psi}{dr} \\sqrt{R_{0}^{2} - r^{2}}}}\n$$"
        },
        {
            "introduction": "场向坐标系在回旋动理学模拟中至关重要，因为它们能有效地将沿着磁场线的快运动与垂直于磁场线的慢运动分离开。然而，在具有磁剪切的实际系统中，这种坐标系会带来独特的后果。该练习通过一个简化的剪切平板模型，阐明了在场向坐标系下一个最基本也是最重要的效应：径向波矢 $k_x$ 如何随着平行坐标 $z$ 线性变化 。掌握这一概念对于理解磁剪切如何影响湍流结构以及通量管模拟的设置至关重要。",
            "id": "3980025",
            "problem": "在一个磁化等离子体的局域磁通管回旋动理学模型中，考虑一个剪切平板、直磁力线坐标系，其标准正交坐标为 $(x,y,z)$，其中 $x$ 是径向坐标，$y$ 是副法向坐标，$z$ 是场向（平行）坐标。假设磁剪切 $\\hat{s}$ 是均匀的，并采用由经过充分检验的剪切平板近似 $\\alpha = y + \\hat{s} x z$ 定义的类Clebsch磁力线标签，该标签沿磁力线为常数。考虑一个标量微扰，其在每个 $z$ 处的垂直傅里叶结构表示为 $\\varphi(x,y,z) = \\tilde{\\varphi}(z)\\exp\\!\\big(i[k_x(z) x + k_y y]\\big)$，其中 $k_y$ 与 $z$ 无关。仅利用这些基础以及“$\\alpha$沿磁力线为常数”这一事实（该事实约束了垂直相位可以写成 $k_y \\alpha + k_{x0} x$ 的形式，其中 $k_{x0}$ 与 $z$ 无关），推导 $k_x(z)$ 对 $z$ 的依赖关系，并由此计算径向波数在长度为 $L_z$ 的平行域上的净变化，定义为 $\\Delta k_x \\equiv k_x(+L_z/2) - k_x(-L_z/2)$。您的最终结果必须是仅用 $\\hat{s}$、$k_y$ 和 $L_z$ 表示的单个闭式表达式。同时，请结合 $\\alpha$ 的定义以及 $k_x$ 随 $z$ 的演化，简要解释此位移的物理起源。不需要进行数值计算，最终表达式中也不应包含单位。",
            "solution": "本问题要求在剪切平板磁场几何中，推导径向波数 $\\Delta k_x$ 在长度为 $L_z$ 的平行域上的变化。推导基于标量微扰的垂直相位的两种等效表示。\n\n相位的第一种表示由微扰定义 $\\varphi(x,y,z) = \\tilde{\\varphi}(z)\\exp\\!\\big(i[k_x(z) x + k_y y]\\big)$ 中指数的宗量给出。我们将此相位表示为 $\\Phi_1$：\n$$ \\Phi_1(x, y, z) = k_x(z) x + k_y y $$\n此处，$k_y$ 是常数，而径向波数 $k_x$ 是平行坐标 $z$ 的函数。\n\n第二种表示基于沿磁力线为常数的磁力线标签 $\\alpha = y + \\hat{s} x z$。问题陈述指出，垂直相位也可以写成以下形式：\n$$ \\Phi_2(x, y, z) = k_y \\alpha + k_{x0} x $$\n其中 $k_{x0}$ 是一个与 $z$ 无关的恒定参考径向波数。这种形式的构造使得相位与磁力线共转。\n\n为了找到 $k_x(z)$ 对 $z$ 的依赖关系，我们将这两种物理上等效的相位表达式相等，即 $\\Phi_1 = \\Phi_2$：\n$$ k_x(z) x + k_y y = k_y \\alpha + k_{x0} x $$\n现在，我们将磁力线标签的定义 $\\alpha = y + \\hat{s} x z$ 代入方程的右侧：\n$$ k_x(z) x + k_y y = k_y (y + \\hat{s} x z) + k_{x0} x $$\n将右侧的 $k_y$ 乘开，得到：\n$$ k_x(z) x + k_y y = k_y y + k_y \\hat{s} x z + k_{x0} x $$\n$k_y y$ 项出现在等式两侧，可以消去：\n$$ k_x(z) x = k_y \\hat{s} x z + k_{x0} x $$\n此等式必须对径向坐标 $x$ 的所有值都成立。因此，我们可以将整个方程除以 $x$（假设 $x \\neq 0$，这是有效的，因为这是一个关于函数形式的恒等式），从而分离出 $k_x(z)$ 的表达式：\n$$ k_x(z) = k_{x0} + k_y \\hat{s} z $$\n这个方程明确给出了径向波数 $k_x$ 对平行坐标 $z$ 的线性依赖关系。$k_x$ 相对于 $z$ 的变化率为 $\\frac{d k_x}{dz} = k_y \\hat{s}$。\n\n问题要求计算径向波数在长度为 $L_z$ 的平行域上的净变化 $\\Delta k_x$。该域以 $z=0$ 为中心，从 $z = -L_z/2$ 延伸到 $z = +L_z/2$。这个变化定义为：\n$$ \\Delta k_x \\equiv k_x\\left(+\\frac{L_z}{2}\\right) - k_x\\left(-\\frac{L_z}{2}\\right) $$\n我们使用推导出的 $k_x(z)$ 表达式来计算其在域的两个端点处的值。\n在 $z = +L_z/2$ 处：\n$$ k_x\\left(+\\frac{L_z}{2}\\right) = k_{x0} + k_y \\hat{s} \\left(\\frac{L_z}{2}\\right) $$\n在 $z = -L_z/2$ 处：\n$$ k_x\\left(-\\frac{L_z}{2}\\right) = k_{x0} + k_y \\hat{s} \\left(-\\frac{L_z}{2}\\right) = k_{x0} - k_y \\hat{s} \\frac{L_z}{2} $$\n现在，我们计算差值：\n$$ \\Delta k_x = \\left( k_{x0} + k_y \\hat{s} \\frac{L_z}{2} \\right) - \\left( k_{x0} - k_y \\hat{s} \\frac{L_z}{2} \\right) $$\n$$ \\Delta k_x = k_{x0} + \\frac{1}{2} k_y \\hat{s} L_z - k_{x0} + \\frac{1}{2} k_y \\hat{s} L_z $$\n常数项 $k_{x0}$ 消去，剩下：\n$$ \\Delta k_x = k_y \\hat{s} L_z $$\n这就是径向波数净变化的最终表达式。\n\n这种位移的物理起源在于剪切磁场的几何结构。磁力线标签 $\\alpha = y + \\hat{s} x z$ 沿磁力线为常数意味着磁力线不与 $z$ 轴平行，而是被剪切的。磁力线在 $(x, y)$ 平面上的投影斜率依赖于 $z$：对于常数 $\\alpha$，有 $d\\alpha = 0 = dy + \\hat{s}z dx$，给出局部斜率为 $dy/dx = -\\hat{s}z$。一个“长笛状”（即沿磁场伸长）的微扰，其垂直结构必须扭曲以跟随剪切的磁力线。因此，一个具有固定副法向波数 $k_y$ 的傅里叶模式在沿平行坐标 $z$ 传播时，必须不断调整其径向波数 $k_x$。表达式 $k_x(z) = k_{x0} + k_y \\hat{s} z$ 从数学上描述了波矢 $\\vec{k}_\\perp(z) = (k_x(z), k_y)$ 的这种“剪切”过程。这种剪切的速率与磁剪切 $\\hat{s}$ 和副法向波数 $k_y$ 成正比。在平行距离 $L_z$ 上，$k_x$ 的这种连续移动累积起来，总变化量为 $\\Delta k_x = k_y \\hat{s} L_z$。",
            "answer": "$$\\boxed{k_y \\hat{s} L_z}$$"
        },
        {
            "introduction": "将物理理论转化为可靠的计算模型，是计算聚变科学中的一项核心技能。场向坐标系通常是非正交的，这在数值离散化过程中引入了必须正确处理的复杂性。本练习  是一个动手实践的编程任务，您将学习如何在非正交坐标系中正确地构建拉普拉斯算子，并会看到忽略非正交性（即混合导数项）所引入的误差。通过使用“人造解方法”，您将能够量化这种忽略所带来的各向异性误差，这是验证聚变模拟代码准确性的一个强大而标准的技巧。",
            "id": "3980026",
            "problem": "考虑在环形磁约束装置中，回旋动理学（GK）理论中所使用的场向坐标的一种局部直场线近似。设垂直于磁场的物理平面为欧几里得平面，其笛卡尔坐标为 $(x,y)$。通过线性剪切映射 $x = u$ 和 $y = v + \\sigma u$ 定义曲线场向垂直坐标 $(u,v)$，其中 $\\sigma$ 是一个无量纲的恒定剪切参数，用于模拟由磁剪切和磁通管倾斜引起的非正交性。在此映射下，$(u,v)$ 中的线元为 $ds^2 = dx^2 + dy^2$，这给出了一个恒定的度规张量 $g_{ij}$，其分量为 $g_{uu} = 1 + \\sigma^2$，$g_{uv} = g_{vu} = \\sigma$ 和 $g_{vv} = 1$。该度规的行列式为 $\\det(g) = 1$，其逆 $g^{ij}$ 的分量为 $g^{uu} = 1$，$g^{uv} = g^{vu} = -\\sigma$ 和 $g^{vv} = 1 + \\sigma^2$。\n\n从黎曼流形上广义曲线坐标中拉普拉斯算子的基本定义出发，在当前二维、恒定度规的情况下，该算子简化为具有恒定系数的亥姆霍兹型算子，\n$$\n\\nabla_\\perp^2 f = \\partial_i \\left( g^{ij} \\partial_j f \\right),\n$$\n其中索引 $i,j \\in \\{u,v\\}$，并隐含使用爱因斯坦求和约定。利用此定义，推导在 $(u,v)$ 中的显式连续算子，并在均匀周期性网格上构建一个二阶精度的有限差分模板，该模板包含由非正交性引起的混合导数。在矩形域 $u \\in [0, 2\\pi)$ 和 $v \\in [0, 2\\pi)$ 上使用中心差分和周期性边界条件，在 $u$ 和 $v$ 方向上分别有 $N_u$ 和 $N_v$ 个网格点。记网格间距为 $h_u = 2\\pi/N_u$ 和 $h_v = 2\\pi/N_v$。\n\n为量化各向异性和非正交性误差，采用“人造解方法”（Method of Manufactured Solutions）。对于整数 $n$ 和 $m$，定义人造解\n$$\nf(u,v) = \\sin(n u + m v),\n$$\n连续算子作用于 $f$ 可得到\n$$\n\\nabla_\\perp^2 f = -\\lambda f, \\quad \\lambda = n^2 - 2\\sigma n m + (1 + \\sigma^2) m^2.\n$$\n构建两个离散算子：\n- “混合”算子 $\\mathcal{L}_{\\text{mixed}}$：对 $\\partial_{uu} f$、$\\partial_{vv} f$ 和 $\\partial_{uv} f$ 使用中心差分，并结合连续算子的推导系数。\n- “朴素”算子 $\\mathcal{L}_{\\text{naive}}$：忽略混合导数项，仅使用 $\\partial_{uu} f$ 和 $\\partial_{vv} f$ 及相应的系数。\n\n对于每种情况，计算离散算子与精确连续算子之间的相对均方根误差，\n$$\nE_{\\text{mixed}} = \\frac{\\left\\| \\mathcal{L}_{\\text{mixed}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}, \\quad\nE_{\\text{naive}} = \\frac{\\left\\| \\mathcal{L}_{\\text{naive}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示网格上的离散 $\\ell_2$ 范数。将因忽略非正交性而产生的各向异性误差增量定义为\n$$\n\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}.\n$$\n使用双向周期性边界条件和由以下经过充分检验的公式给出的中心差分模板，\n$$\n\\partial_{uu} f\\big|_{i,j} \\approx \\frac{f_{i+1,j} - 2 f_{i,j} + f_{i-1,j}}{h_u^2}, \\quad\n\\partial_{vv} f\\big|_{i,j} \\approx \\frac{f_{i,j+1} - 2 f_{i,j} + f_{i,j-1}}{h_v^2},\n$$\n$$\n\\partial_{uv} f\\big|_{i,j} \\approx \\frac{f_{i+1,j+1} - f_{i+1,j-1} - f_{i-1,j+1} + f_{i-1,j-1}}{4 h_u h_v}.\n$$\n您的程序必须实现这些模板，以计算 $\\mathcal{L}_{\\text{mixed}}$ 和 $\\mathcal{L}_{\\text{naive}}$，并对以下每个测试用例评估 $\\Delta E$。所有量均为无量纲。\n\n测试套件（每个用例由 $(\\sigma, n, m, N_u, N_v)$ 指定）：\n- 用例 1：$(0.0, 4, 3, 128, 128)$，一个正交基准，其中混合项消失，用作边界条件检查。\n- 用例 2：$(0.3, 8, 0, 128, 128)$，一个沿 $u$ 方向传播的波，具有中等剪切。\n- 用例 3：$(0.3, 7, 7, 128, 128)$，在中等剪切下，$u$ 和 $v$ 方向的波数相等。\n- 用例 4：$(0.7, 9, 4, 128, 256)$，较强的剪切，网格间距为各向异性 $h_u \\neq h_v$。\n- 用例 5：$(1.2, 12, 5, 192, 96)$，高剪切，网格具有相反的各向异性。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_k$ 是对应情况 $k$ 的 $\\Delta E$ 的单精度或双精度浮点值，并计算到运行时环境的完整机器精度。",
            "solution": "该问题要求在一个非正交剪切坐标系中，对垂直拉普拉斯算子的有限差分离散化中的各向异性误差进行量化。误差 $\\Delta E$ 定义为一个忽略混合导数项的朴素离散化与一个包含该项的更完整离散化之间的相对均方根误差之差。“人造解方法”（Method of Manufactured Solutions）为本次验证练习提供了一个框架。\n\n首先，我们推导连续拉普拉斯算子 $\\nabla_\\perp^2 f$ 的显式形式。问题给出了在广义曲线坐标系中的基本定义 $\\nabla_\\perp^2 f = \\partial_i (g^{ij} \\partial_j f)$，其中隐含对索引 $i,j \\in \\{u,v\\}$ 的求和。逆度规张量 $g^{ij}$ 的分量为常数：$g^{uu} = 1$，$g^{uv} = g^{vu} = -\\sigma$ 和 $g^{vv} = 1 + \\sigma^2$。由于度规分量是常数，偏导数 $\\partial_i$ 可以移到它们的前面：\n$$\n\\nabla_\\perp^2 f = g^{ij} \\partial_i \\partial_j f\n$$\n展开求和，并利用光滑函数 $f$ 的二阶偏导数的对称性（即 $\\partial_u \\partial_v f = \\partial_v \\partial_u f$），我们得到：\n$$\n\\nabla_\\perp^2 f = g^{uu} \\frac{\\partial^2 f}{\\partial u^2} + (g^{uv} + g^{vu}) \\frac{\\partial^2 f}{\\partial u \\partial v} + g^{vv} \\frac{\\partial^2 f}{\\partial v^2}\n$$\n$$\n\\nabla_\\perp^2 f = g^{uu} \\partial_{uu} f + 2 g^{uv} \\partial_{uv} f + g^{vv} \\partial_{vv} f\n$$\n代入给定的逆度规分量值，得到显式的连续算子：\n$$\n\\nabla_\\perp^2 f = (1) \\partial_{uu} f + 2(-\\sigma) \\partial_{uv} f + (1 + \\sigma^2) \\partial_{vv} f = \\partial_{uu} f - 2\\sigma \\partial_{uv} f + (1 + \\sigma^2) \\partial_{vv} f\n$$\n该表达式表明，由剪切 $\\sigma$ 参数化的坐标系非正交性引入了一个混合偏导数项 $\\partial_{uv} f$。\n\n接下来，我们构建离散算子。计算域是一个具有周期性边界条件的均匀网格。设 $f_{i,j} = f(u_i, v_j)$ 为在网格点 $(i,j)$ 上的函数值。我们使用提供的二阶精度中心差分模板来近似偏导数。将这些离散导数算子记为 $D_{uu}$、$D_{vv}$ 和 $D_{uv}$。\n\n“混合”离散算子 $\\mathcal{L}_{\\text{mixed}}$ 是通过直接离散化完整的连续算子来构建的：\n$$\n\\mathcal{L}_{\\text{mixed}} f_{i,j} = D_{uu}f_{i,j} - 2\\sigma D_{uv}f_{i,j} + (1 + \\sigma^2)D_{vv}f_{i,j}\n$$\n其中\n$$\nD_{uu}f_{i,j} = \\frac{f_{i+1,j} - 2 f_{i,j} + f_{i-1,j}}{h_u^2}\n$$\n$$\nD_{vv}f_{i,j} = \\frac{f_{i,j+1} - 2 f_{i,j} + f_{i,j-1}}{h_v^2}\n$$\n$$\nD_{uv}f_{i,j} = \\frac{f_{i+1,j+1} - f_{i+1,j-1} - f_{i-1,j+1} + f_{i-1,j-1}}{4 h_u h_v}\n$$\n\n“朴素”离散算子 $\\mathcal{L}_{\\text{naive}}$ 被定义为“忽略混合导数项，仅使用 $\\partial_{uu} f$ 和 $\\partial_{vv} f$ 及相应系数”的算子。这对应于忽略算子展开式中的 $g^{uv}$ 和 $g^{vu}$ 项。剩余项的相应系数是逆度规的对角分量 $g^{uu}=1$ 和 $g^{vv}=1+\\sigma^2$。因此，朴素算子为：\n$$\n\\mathcal{L}_{\\text{naive}} f_{i,j} = (1)D_{uu}f_{i,j} + (1 + \\sigma^2)D_{vv}f_{i,j}\n$$\n\n为评估这些离散算子的精度，我们使用人造解 $f(u,v) = \\sin(n u + m v)$。如问题陈述中所验证，连续算子作用于此函数产生一个本征函数关系 $\\nabla_\\perp^2 f = -\\lambda f$，其本征值为 $\\lambda = n^2 - 2\\sigma n m + (1 + \\sigma^2) m^2$。\n\n离散算子 $\\mathcal{L}$ 的误差由残差的相对均方根范数来量化，残差是离散算子作用于网格函数的结果与精确解析结果之间的差。算子 $\\mathcal{L}$ 的残差为 $\\mathcal{L}f - \\nabla_\\perp^2 f = \\mathcal{L}f - (-\\lambda f) = \\mathcal{L}f + \\lambda f$。于是相对误差为：\n$$\nE_{\\text{mixed}} = \\frac{\\left\\| \\mathcal{L}_{\\text{mixed}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}, \\quad\nE_{\\text{naive}} = \\frac{\\left\\| \\mathcal{L}_{\\text{naive}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}\n$$\n其中 $\\|\\cdot\\|_2$ 是整个网格上的标准离散 $\\ell_2$ 范数（弗罗贝尼乌斯范数）。最终需要计算的量是各向异性误差增量 $\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}$。\n\n对于每个测试用例 $(\\sigma, n, m, N_u, N_v)$，算法如下：\n1. 定义网格参数 $h_u = 2\\pi/N_u$ 和 $h_v = 2\\pi/N_v$。创建二维网格坐标，并在每个网格点上评估人造解 $f(u,v)$ 以获得网格函数 $f_{i,j}$。\n2. 计算解析本征值 $\\lambda$。\n3. 使用遵守周期性边界条件的数组操作（例如 `numpy.roll`）计算网格上的离散偏导数 $D_{uu}f$、$D_{vv}f$ 和 $D_{uv}f$。\n4. 组装离散算子 $\\mathcal{L}_{\\text{mixed}}f$ 和 $\\mathcal{L}_{\\text{naive}}f$。\n5. 计算残差 $\\mathcal{L}_{\\text{mixed}}f + \\lambda f$ 和 $\\mathcal{L}_{\\text{naive}}f + \\lambda f$。\n6. 计算残差的 $\\ell_2$ 范数和归一化项 $\\|\\lambda f\\|_2$。\n7. 计算 $E_{\\text{mixed}}$ 和 $E_{\\text{naive}}$。\n8. 计算最终结果 $\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}$。\n\n对于用例 1（$\\sigma = 0.0$），连续算子中的混合导数项消失。因此，$\\mathcal{L}_{\\text{mixed}}$ 和 $\\mathcal{L}_{\\text{naive}}$ 变得相同，这意味着 $E_{\\text{mixed}} = E_{\\text{naive}}$ 且 $\\Delta E = 0.0$。\n对于用例 2（$m=0$），人造解 $f(u,v) = \\sin(nu)$ 仅依赖于 $u$。当应用于此类函数时，混合导数的中心差分模板 $D_{uv}$ 将精确地得到零。因此，$\\mathcal{L}_{\\text{mixed}}$ 中的 $-2\\sigma D_{uv}f$ 项为零，再次使得 $\\mathcal{L}_{\\text{mixed}}$ 与 $\\mathcal{L}_{\\text{naive}}$ 相同，从而导致 $\\Delta E = 0.0$。这两个用例可作为实现的关键验证检查。\n对于用例 3、4 和 5，$\\sigma \\neq 0$ 和 $m \\neq 0$ 均成立，因此我们预期会得到一个非零的正值 $\\Delta E$，它量化了因忽略非正交混合导数项而引入的误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the anisotropy error increment for a finite-difference Laplacian\n    in sheared coordinates for a series of test cases.\n    \"\"\"\n    # Test suite: (sigma, n, m, Nu, Nv)\n    test_cases = [\n        (0.0, 4, 3, 128, 128),\n        (0.3, 8, 0, 128, 128),\n        (0.3, 7, 7, 128, 128),\n        (0.7, 9, 4, 128, 256),\n        (1.2, 12, 5, 192, 96),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma, n, m, Nu, Nv = case\n        \n        # 1. Setup Grid and Parameters\n        hu = 2.0 * np.pi / Nu\n        hv = 2.0 * np.pi / Nv\n        \n        u_vec = np.linspace(0.0, 2.0 * np.pi, Nu, endpoint=False)\n        v_vec = np.linspace(0.0, 2.0 * np.pi, Nv, endpoint=False)\n        \n        # U varies along axis 1 (columns), V varies along axis 0 (rows)\n        U, V = np.meshgrid(u_vec, v_vec)\n\n        # 2. Manufactured Solution and Analytical Result\n        # The manufactured solution grid function\n        F = np.sin(n * U + m * V)\n        \n        # The analytical eigenvalue of the continuous operator\n        lambda_val = n**2 - 2*sigma*n*m + (1 + sigma**2)*m**2\n        \n        # Analytical result of the operator acting on the function, used for normalization\n        analytical_op_F = -lambda_val * F\n        \n        # The norm of lambda*f, which is the denominator for relative error.\n        # Note that norm(-lambda*f) = norm(lambda*f).\n        norm_denom = np.linalg.norm(analytical_op_F)\n\n        # Handle cases where the denominator is zero, to prevent division by zero.\n        # This occurs if lambda=0 or f=0 everywhere. For the given test cases,\n        # lambda is non-zero. If the error numerator is also zero, the relative error is 0.\n        if norm_denom == 0.0:\n            results.append(0.0)\n            continue\n\n        # 3. Finite Difference Operators using periodic shifts (np.roll)\n        # D_uu: Second derivative with respect to u (axis 1)\n        F_up1 = np.roll(F, -1, axis=1)\n        F_um1 = np.roll(F, 1, axis=1)\n        Duu_F = (F_up1 - 2*F + F_um1) / (hu**2)\n\n        # D_vv: Second derivative with respect to v (axis 0)\n        F_vp1 = np.roll(F, -1, axis=0)\n        F_vm1 = np.roll(F, 1, axis=0)\n        Dvv_F = (F_vp1 - 2*F + F_vm1) / (hv**2)\n\n        # D_uv: Mixed derivative\n        F_up1_vp1 = np.roll(F_up1, -1, axis=0)\n        F_up1_vm1 = np.roll(F_up1, 1, axis=0)\n        F_um1_vp1 = np.roll(F_um1, -1, axis=0)\n        F_um1_vm1 = np.roll(F_um1, 1, axis=0)\n        Duv_F = (F_up1_vp1 - F_up1_vm1 - F_um1_vp1 + F_um1_vm1) / (4.0 * hu * hv)\n\n        # 4. Construct Discrete Laplacians\n        # Operator with mixed derivative term\n        L_mixed_F = Duu_F - 2.0*sigma*Duv_F + (1.0 + sigma**2)*Dvv_F\n        \n        # Naive operator neglecting the mixed derivative term\n        L_naive_F = Duu_F + (1.0 + sigma**2)*Dvv_F\n        \n        # 5. Calculate Errors\n        # The residual is the difference between the numerical operator and the analytical operator's result.\n        # residual = L_discrete(f) - nabla^2(f) = L_discrete(f) - (-lambda*f) = L_discrete(f) + lambda*f\n        residual_mixed = L_mixed_F + lambda_val * F\n        residual_naive = L_naive_F + lambda_val * F\n        \n        E_mixed = np.linalg.norm(residual_mixed) / norm_denom\n        E_naive = np.linalg.norm(residual_naive) / norm_denom\n        \n        # 6. Final Result for the case\n        delta_E = E_naive - E_mixed\n        results.append(delta_E)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.16f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}