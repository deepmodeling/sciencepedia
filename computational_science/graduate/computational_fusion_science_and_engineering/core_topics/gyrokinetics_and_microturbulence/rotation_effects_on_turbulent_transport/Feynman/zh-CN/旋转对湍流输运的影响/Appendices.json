{
    "hands_on_practices": [
        {
            "introduction": "理解旋转如何影响湍流输运的一个核心任务是，在给定外部扭矩源和湍流输运系数的情况下，预测等离子体的稳态旋转剖面。本实践将指导您通过求解一维输运方程，来模拟中性束注入（NBI）等外部扭矩源所驱动的环向角动量响应。这个练习让您亲身体验如何将湍流粘滞和动量箍缩等理论概念应用于宏观输运建模，从而加深对旋转剖面形成的理解。",
            "id": "4042051",
            "problem": "考虑在经受中性束注入 (NBI) 的托卡马克等离子体中，稳态、磁面平均的环向角动量输运。令 $r$ 表示小半径坐标，其定义域为 $r \\in (0,a)$，并令 $\\Pi(r)$ 表示环向角动量密度。假设为一维圆柱对称，因此环向角动量的守恒可简化为以下稳态平衡方程：\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r\\,\\Gamma_\\Pi(r)\\right) = S_\\Pi(r),\n$$\n其中 $\\Gamma_\\Pi(r)$ 是环向角动量的径向通量，而 $S_\\Pi(r)$ 是一个给定的局部转矩密度（单位体积），表示由中性束注入 (NBI) 提供的外部驱动。湍流引起的动量通量模型为\n$$\n\\Gamma_\\Pi(r) = -\\nu_t(r)\\,\\frac{d\\Pi}{dr} + V_\\Pi(r)\\,\\Pi(r),\n$$\n其中 $\\nu_t(r)$ 是湍流粘滞系数，$V_\\Pi(r)$ 是动量对流内向夹缩速度。环向旋转角速度 $\\omega(r)$ 与 $\\Pi(r)$ 的关系如下\n$$\n\\Pi(r) = n_i\\,m_i\\,R^2\\,\\omega(r),\n$$\n其中 $n_i$ 是离子数密度，$m_i$ 是离子质量，$R$ 是大半径。施加以下具有物理动机的边界条件：$r=0$ 处的正则性条件以及 $r=a$ 处固定的边界旋转角速度 $\\omega(a)=\\omega_{\\text{edge}}$。您必须为每个测试案例计算稳态 $\\omega(r)$，并为每个案例返回三个诊断量：\n- 中心旋转角速度 $\\,\\omega(0)\\,$，单位为弧度/秒。\n- 最大旋转角速度 $\\,\\max_{r\\in(0,a)} \\omega(r)\\,$，单位为弧度/秒。\n- 面积加权平均旋转角速度\n$$\n\\langle \\omega \\rangle = \\frac{\\int_0^a \\omega(r)\\,r\\,dr}{\\int_0^a r\\,dr}\n$$\n单位为弧度/秒。\n\n在包含 $N$ 个单元的均匀网格上使用有限体积法进行离散化，单元中心位于 $r_i = (i+\\tfrac{1}{2})\\Delta r$，$i=0,\\dots,N-1$，单元界面位于 $r_{i+\\tfrac{1}{2}}=(i+1)\\Delta r$，且 $\\Delta r = a/N$。对于每个内部界面 $i+\\tfrac{1}{2}$，使用中心差分计算通量：\n$$\n\\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}.\n$$\n通过在 $r_{N+\\tfrac{1}{2}}=a$ 处引入一个虚单元值 $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$，并对最外层界面应用相同的通量公式（其中 $\\Pi_{N}$ 被 $\\Pi_b$ 替换），来施加 $r=a$ 处的边界条件。在 $r=0$ 处，正则性条件意味着最内层界面的贡献消失，因为 $r_{-\\tfrac{1}{2}}=0$。每个单元 $i$ 中的稳态离散方程为\n$$\n\\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_\\Pi(r_i).\n$$\n\n所有测试案例均采用以下物理常数：\n- $n_i = 1.0\\times 10^{20}\\,\\text{m}^{-3}$，\n- $m_i = 3.34\\times 10^{-27}\\,\\text{kg}$ （氘离子质量），\n- $R = 3.0\\,\\text{m}$。\n\n所有旋转角速度必须以弧度/秒表示。所有湍流粘滞系数必须以 $\\text{m}^2/\\text{s}$ 表示。所有对流速度必须以 $\\text{m}/\\text{s}$ 表示。所有转矩密度必须以 $\\text{N}\\cdot\\text{m}/\\text{m}^3$ 表示。所有半径必须以米表示。\n\n您的程序必须实现上述离散化方法，并为以下每个测试案例计算 $\\omega(r)$：\n\n- 测试案例 1（常规顺利路径）：\n  - $a = 1.0\\,\\text{m}$，$N = 200$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 1.0\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.5\\,(r/a)^2\\right)$。\n  - $V_\\Pi(r) = -0.5\\,\\text{m}/\\text{s}\\,\\times \\left(1 - r/a\\right)$。\n  - $S_\\Pi(r) = 5.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.5)^2}{2\\,\\times 0.08^2}\\right)$。\n\n- 测试案例 2（无内向夹缩）：\n  - $a = 1.0\\,\\text{m}$，$N = 200$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 1.5\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.2\\,(r/a)\\right)$。\n  - $V_\\Pi(r) = 0.0\\,\\text{m}/\\text{s}$。\n  - $S_\\Pi(r) = 3.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.7)^2}{2\\,\\times 0.05^2}\\right)$。\n\n- 测试案例 3（向外对流和低粘滞边界情况）：\n  - $a = 1.0\\,\\text{m}$，$N = 400$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 0.3\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.1\\,(r/a)^2\\right)$。\n  - $V_\\Pi(r) = +0.2\\,\\text{m}/\\text{s}\\,\\times \\left(r/a\\right)$。\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.3)^2}{2\\,\\times 0.06^2}\\right)$。\n\n- 测试案例 4（平衡双峰转矩，内向夹缩）：\n  - $a = 1.0\\,\\text{m}$，$N = 300$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 0.8\\,\\text{m}^2/\\text{s}$。\n  - $V_\\Pi(r) = -0.3\\,\\text{m}/\\text{s}$。\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\left[\\exp\\left(-\\frac{(r - 0.35)^2}{2\\,\\times 0.05^2}\\right) - \\exp\\left(-\\frac{(r - 0.75)^2}{2\\,\\times 0.05^2}\\right)\\right]$。\n\n对于每个测试案例，计算 $\\omega(r)$，然后返回单行输出，其中包含一个用方括号括起来的逗号分隔列表，内含 12 个数字，按测试案例 1 的 $[\\omega(0),\\max \\omega,\\langle \\omega \\rangle]$、其后跟着测试案例 2、测试案例 3 和测试案例 4 的相同三元组的顺序排列。所有报告的旋转角速度单位必须是弧度/秒，输出中不含单位符号，且数值必须是原始十进制浮点数。",
            "solution": "用户希望我求解托卡马克等离子体中的一维稳态环向角动量输运方程。\n\n这是我的计划：\n1.  **问题验证**：我需要完成强制性的验证步骤。\n    *   **步骤 1：提取已知条件**：我将列出所有方程、常数、参数、边界条件和所需的输出格式。\n    *   **步骤 2：验证**：我将检查其科学合理性、适定性、客观性等。该问题来自计算聚变科学，这是一个成熟的领域。所提供的方程是圆柱几何中一维输运的标准表示。所描述的有限体积法也是一种标准的数值技术。粘滞系数、内向夹缩和源的剖面是物理上合理的函数。边界条件（核心处的正则性和边缘处的固定值）是标准的。该问题似乎是适定的。它需要为每个网格单元求解一个关于未知动量密度的线性方程组。\n    *   **步骤 3：结论**：基于验证，我预计该问题是有效的。\n\n2.  **求解推导（如果有效）**：\n    *   **目标**：求解环向旋转剖面 $\\omega(r)$ 并计算三个诊断量：$\\omega(0)$、$\\max \\omega(r)$ 和 $\\langle \\omega \\rangle$。\n    *   **核心方程**：核心部分是离散化的稳态方程：\n        $$\n        \\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_\\Pi(r_i)\n        $$\n        对于 $i = 0, \\dots, N-1$。\n    *   **通量表达式**：单元界面的通量由下式给出：\n        $$\n        \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}\n        $$\n    *   **方程组**：我需要将通量表达式代入核心方程。这将得到一个关于单元中心动量密度值 $\\Pi_i$ 的线性方程组。让我们把它写出来。\n        *   令 $C_i = n_i m_i R^2$。那么 $\\Pi_i = C_i \\omega_i$。如果 $n_i$ 是常数，那么 $C_i$ 就是一个常数 $C$。问题指出 $n_i$ 是一个常数，所以 $\\Pi(r) = (n_i m_i R^2) \\omega(r)$。我们可以解出 $\\Pi_i$，然后除以这个常数因子得到 $\\omega_i$。\n        *   让我们用 $\\Pi_i$ 和 $\\Pi_{i+1}$ 重写通量表达式：\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = \\left( -\\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} + \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} \\right) \\Pi_i + \\left( \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} + \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} \\right) \\Pi_{i+1}\n            $$\n            这是不正确的。让我们重新组合这些项：\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = \\left( \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} - \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} \\right) \\Pi_i + \\left( \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} + \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} \\right) \\Pi_{i+1}\n            $$\n            不对，通量的定义是：\n            $$ \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2} $$\n            让我们按 $\\Pi_i$ 和 $\\Pi_{i+1}$ 分组：\n            $\\Gamma_{\\Pi,i+1/2} = \\Pi_i \\left(\\frac{\\nu_{t,i+1/2}}{\\Delta r} - \\frac{V_{\\Pi,i+1/2}}{2}\\right) + \\Pi_{i+1} \\left(-\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2}\\right)$。\n            这似乎与问题陈述不符。问题陈述是：\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}\n            $$\n            不，等等，我们要小心。\n            - 来自扩散的项：$-\\nu_t (\\Pi_{i+1} - \\Pi_i)/\\Delta r = (\\nu_t/\\Delta r) \\Pi_i - (\\nu_t/\\Delta r) \\Pi_{i+1}$。\n            - 来自对流的项：$V_\\Pi (\\Pi_{i+1} + \\Pi_i)/2 = (V_\\Pi/2) \\Pi_i + (V_\\Pi/2) \\Pi_{i+1}$。\n            - 把它们加起来，乘以 $\\Pi_i$ 的项是：$(\\nu_t/\\Delta r + V_\\Pi/2)$。\n            - 把它们加起来，乘以 $\\Pi_{i+1}$ 的项是：$(-\\nu_t/\\Delta r + V_\\Pi/2)$。\n            我最新的展开似乎是正确的。这对矩阵系数来说是一个至关重要的细节。\n            让我们定义一些简写：$D_{i+1/2} = \\nu_{t,i+1/2}/\\Delta r$ 和 $C_{i+1/2} = V_{\\Pi, i+1/2}/2$。\n            那么 $\\Gamma_{\\Pi,i+1/2} = (D_{i+1/2} + C_{i+1/2})\\Pi_i + (-D_{i+1/2} + C_{i+1/2})\\Pi_{i+1}$。\n\n    *   **构建线性系统**：让我们把这个代入平衡方程：\n        $$\n        \\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_{\\Pi,i}\n        $$\n        单元 $i$ 的方程连接了 $\\Pi_{i-1}$、$\\Pi_i$ 和 $\\Pi_{i+1}$。这将形成一个三对角矩阵系统。\n        让我们写出通用内部单元 $i \\in \\{1, \\dots, N-2\\}$ 的方程。\n        $$\n        r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}} = (r_i\\,\\Delta r) S_{\\Pi,i}\n        $$\n        代入通量表达式：\n        $$\n        r_{i+\\tfrac{1}{2}} \\left[ (D_{i+1/2} + C_{i+1/2})\\Pi_i + (-D_{i+1/2} + C_{i+1/2})\\Pi_{i+1} \\right] - r_{i-\\tfrac{1}{2}} \\left[ (D_{i-1/2} + C_{i-1/2})\\Pi_{i-1} + (-D_{i-1/2} + C_{i-1/2})\\Pi_i \\right] = (r_i\\,\\Delta r) S_{\\Pi,i}\n        $$\n        现在，按 $\\Pi_{i-1}$、$\\Pi_i$、$\\Pi_{i+1}$ 分组各项：\n        - $\\Pi_{i-1}$ 的系数：\n          $A_i = -r_{i-1/2} (D_{i-1/2} + C_{i-1/2})$\n        - $\\Pi_{i+1}$ 的系数：\n          $C_i = r_{i+1/2} (-D_{i+1/2} + C_{i+1/2})$\n        - $\\Pi_i$ 的系数：\n          $B_i = r_{i+1/2} (D_{i+1/2} + C_{i+1/2}) - r_{i-1/2} (-D_{i-1/2} + C_{i-1/2})$\n          $B_i = r_{i+1/2} D_{i+1/2} + r_{i+1/2} C_{i+1/2} + r_{i-1/2} D_{i-1/2} - r_{i-1/2} C_{i-1/2}$\n          $B_i = (r_{i+1/2} D_{i+1/2} + r_{i-1/2} D_{i-1/2}) + (r_{i+1/2} C_{i+1/2} - r_{i-1/2} C_{i-1/2})$\n\n        所以单元 $i$ 的方程是：\n        $A_i \\Pi_{i-1} + B_i \\Pi_i + C_i \\Pi_{i+1} = (r_i\\,\\Delta r) S_{\\Pi,i}$\n        这是一个三对角系统 $M\\vec{\\Pi} = \\vec{S'}$，其中 $\\vec{\\Pi} = [\\Pi_0, ..., \\Pi_{N-1}]^T$。\n\n    *   **边界条件**：\n        - **在 $r=0$ 处（对于单元 $i=0$）**：\n          平衡方程是 $\\frac{r_{1/2}\\Gamma_{1/2} - r_{-1/2}\\Gamma_{-1/2}}{r_0 \\Delta r} = S_0$。\n          问题指出 $r_{-1/2}=0$，所以 $r_{-1/2}\\Gamma_{-1/2}$ 项消失。这实现了正则性条件（通过原点的通量为零）。\n          $i=0$ 的方程变为：\n          $$ \\frac{r_{1/2}\\Gamma_{1/2}}{r_0 \\Delta r} = S_0 $$\n          $$ r_{1/2} \\left[ (D_{1/2} + C_{1/2})\\Pi_0 + (-D_{1/2} + C_{1/2})\\Pi_1 \\right] = (r_0 \\Delta r) S_0 $$\n          这给出了矩阵的第一行：\n          $\\Pi_0$ 系数：$B_0 = r_{1/2}(D_{1/2}+C_{1/2})$\n          $\\Pi_1$ 系数：$C_0 = r_{1/2}(-D_{1/2}+C_{1/2})$\n          右侧项 (RHS)：$(r_0 \\Delta r) S_0$。\n          这对应于选择 $A_0 = 0$。\n\n        - **在 $r=a$ 处（对于单元 $i=N-1$）**：\n          平衡方程是针对单元 $i=N-1$：\n          $$ \\frac{r_{N-1/2+1}\\Gamma_{N-1/2+1} - r_{N-1/2}\\Gamma_{N-1/2}}{r_{N-1} \\Delta r} = S_{N-1} $$\n          即 $\\frac{r_{N+1/2}\\Gamma_{N+1/2} - r_{N-1/2}\\Gamma_{N-1/2}}{r_{N-1} \\Delta r} = S_{N-1}$。\n          问题指定了如何处理外界面 $r_{N-1/2+1} = r_{N+1/2} = a$ 处的通量。\n          它说“对最外层界面应用相同的通量公式（其中 $\\Pi_{N}$ 被虚单元值 $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$ 在 $r_{N+\\tfrac{1}{2}}=a$ 处替换）”。\n          这部分有点令人困惑。我们重读一下网格的定义。\n          单元中心 $r_i = (i+0.5)\\Delta r$，对于 $i=0,...,N-1$。\n          界面 $r_{i+0.5} = (i+1)\\Delta r$，对于 $i= -1, 0, ..., N-1$。所以 $r_{-0.5} = 0$ 且 $r_{N-0.5} = a$。\n          那么界面由 $i+1/2$ 索引。界面从 $r_{-1/2}$ 到 $r_{N-1/2}$。\n          单元 $i$ 由界面 $r_{i-1/2}$ 和 $r_{i+1/2}$ 界定。让我们检查一下我的单元索引。\n          对于 $i=0$，界面是 $r_{-1/2}=0$ 和 $r_{1/2}=\\Delta r$。\n          对于 $i=N-1$，界面是 $r_{N-3/2} = (N-1)\\Delta r$ 和 $r_{N-1/2} = N\\Delta r = a$。\n          好的，所以最外层的物理界面是 $r_{N-1/2} = a$。\n          我之前写的最后一个单元的方程是错的。对于 $i=N-1$：\n          $$ \\frac{r_{N-1/2} \\Gamma_{N-1/2} - r_{N-3/2} \\Gamma_{N-3/2}}{r_{N-1} \\Delta r} = S_{N-1} $$\n          需要处理 $\\Gamma_{N-1/2}$ 项。\n          问题说：“对最外层界面应用相同的通量公式（其中 $\\Pi_{N}$ 被 $\\Pi_b$ 替换）”。我们假设“最外层界面”指的是单元 $N-1$ 和边界之间的通量。这应该是界面 $N-1/2$。\n          所以 $\\Gamma_{N-1/2}$ 是用 $\\Pi_{N-1}$ 和 $\\Pi_{N}$ 计算的，其中 $\\Pi_N$ 是虚单元值 $\\Pi_b$。\n          $ \\Gamma_{N-1/2} = (D_{N-1/2} + C_{N-1/2})\\Pi_{N-1} + (-D_{N-1/2} + C_{N-1/2})\\Pi_b $\n          现在我可以写出 $i=N-1$ 的完整方程：\n          $ A_{N-1} \\Pi_{N-2} + B_{N-1} \\Pi_{N-1} = (r_{N-1}\\Delta r) S_{N-1} - C'_{N-1} $\n          其中 $C'_{N-1}$ 是包含已知 $\\Pi_b$ 的项。\n          展开：\n          $r_{N-1/2} \\left[ (D_{N-1/2} + C_{N-1/2})\\Pi_{N-1} + (-D_{N-1/2} + C_{N-1/2})\\Pi_b \\right] - r_{N-3/2} \\left[ (D_{N-3/2} + C_{N-3/2})\\Pi_{N-2} + (-D_{N-3/2} + C_{N-3/2})\\Pi_{N-1} \\right] = (r_{N-1}\\Delta r) S_{N-1}$。\n          分组各项：\n          - $\\Pi_{N-2}$ 的系数：\n            $A_{N-1} = -r_{N-3/2} (D_{N-3/2} + C_{N-3/2})$。这与 $i=N-1$ 的 $A_i$ 公式相同。\n          - $\\Pi_{N-1}$ 的系数：\n            $B_{N-1} = r_{N-1/2}(D_{N-1/2} + C_{N-1/2}) - r_{N-3/2}(-D_{N-3/2} + C_{N-3/2})$。这与 $i=N-1$ 的 $B_i$ 公式相同。\n          - 包含 $\\Pi_b$ 的已知项移到右侧：\n            $i=N-1$ 的右侧项是：$(r_{N-1}\\Delta r) S_{N-1} - r_{N-1/2} (-D_{N-1/2} + C_{N-1/2})\\Pi_b$。\n          这看起来是一致的。最后一个方程只涉及 $\\Pi_{N-2}$ 和 $\\Pi_{N-1}$，所以 $\\Pi_N$ 的系数 $C_{N-1}$ 为零。\n\n    *   **线性系统 $M\\vec{\\Pi} = \\vec{b}$ 的总结**：\n        - $\\vec{\\Pi} = [\\Pi_0, \\Pi_1, ..., \\Pi_{N-1}]^T$ 是未知数向量。\n        - 矩阵 $M$ 是一个 $N \\times N$ 的三对角矩阵。\n        - 非零对角线是：\n            - 主对角线 $d_i = B_i$ for $i=0,...,N-1$。\n            - 上对角线 $u_i = C_i$ for $i=0,...,N-2$。\n            - 下对角线 $l_i = A_{i+1}$ for $i=0,...,N-2$。\n        - 让我们再次检查系数的定义。\n          对于 $i \\in \\{1, ..., N-2\\}$：\n          $A_i = -r_{i-1/2} (D_{i-1/2} + C_{i-1/2})$\n          $C_i = r_{i+1/2} (-D_{i+1/2} + C_{i+1/2})$\n          $B_i = r_{i+1/2} (D_{i+1/2} + C_{i+1/2}) - r_{i-1/2}(-D_{i-1/2} + C_{i-1/2})$\n        - 对于 $i=0$：\n          $A_0=0$\n          $C_0 = r_{1/2} (-D_{1/2} + C_{1/2})$\n          $B_0 = r_{1/2} (D_{1/2} + C_{1/2})$\n          右侧项：$b_0 = r_0 \\Delta r S_0$\n        - 对于 $i \\in \\{1, ..., N-2\\}$：\n          $A_i, B_i, C_i$ 如上所述。\n          右侧项：$b_i = r_i \\Delta r S_i$\n        - 对于 $i=N-1$：\n          $A_{N-1} = -r_{N-3/2} (D_{N-3/2} + C_{N-3/2})$\n          $C_{N-1} = 0$\n          $B_{N-1} = r_{N-1/2} (D_{N-1/2} + C_{N-1/2}) - r_{N-3/2}(-D_{N-3/2} + C_{N-3/2})$\n          右侧项：$b_{N-1} = r_{N-1}\\Delta r S_{N-1} - r_{N-1/2}(-D_{N-1/2} + C_{N-1/2})\\Pi_b$。\n\n    *   **数值实现**：\n        1.  定义常数：$n_i, m_i, R$。计算 $C_{factor} = n_i m_i R^2$。\n        2.  对于每个测试案例：\n            a. 设置参数：$a, N, \\omega_{\\text{edge}}$。\n            b. 定义 $\\nu_t(r), V_\\Pi(r), S_\\Pi(r)$ 的函数。\n            c. 创建网格：\n               - $\\Delta r = a/N$。\n               - 单元中心：$r_i = (i+0.5)\\Delta r$ for $i=0,...,N-1$。\n               - 单元界面：$r_{i+0.5} = (i+1)\\Delta r$ for $i=-1,...,N-1$。我们称它们为 `r_face`。中心点称为 `r_cell`。\n            d. 在网格上评估物理量：\n               - $\\nu_{t,i+0.5} = \\nu_t(r_{i+0.5})$\n               - $V_{\\Pi,i+0.5} = V_\\Pi(r_{i+0.5})$\n               - $S_{\\Pi,i} = S_\\Pi(r_i)$\n            e. 计算边界项：$\\Pi_b = C_{factor} \\times \\omega_{\\text{edge}}$。\n            f. 预计算矩阵的项：\n               - $D_{i+0.5} = \\nu_{t,i+0.5} / \\Delta r$\n               - $C_{i+0.5} = V_{\\Pi,i+0.5} / 2$\n            g. 构建三对角矩阵 $M$（作为主、上、下对角线的3个向量）和右侧向量 $b$。\n               - 从 $i=0$ 到 $N-1$ 循环。\n               - 对于 $i=0$：主对角线元素，上对角线元素。右侧项元素。\n               - 对于 $i=1$ 到 $N-2$：下、主、上对角线元素。右侧项元素。\n               - 对于 $i=N-1$：下、主对角线元素。右侧项元素（带边界项）。\n            h. 求解线性系统 $M\\vec{\\Pi} = \\vec{b}$。`scipy.linalg.solve_banded` 非常适合这个任务。\n            i. 将动量密度 $\\Pi_i$ 转换为旋转角速度 $\\omega_i = \\Pi_i / C_{factor}$。\n            j. 计算所需的诊断量：\n               - $\\omega(0)$：即 $\\omega_0$。\n               - $\\max_{r \\in (0,a)} \\omega(r)$：即 `np.max(omega_values)`。\n               - $\\langle \\omega \\rangle$：这需要数值积分。\n                 $$ \\langle \\omega \\rangle = \\frac{\\int_0^a \\omega(r)\\,r\\,dr}{\\int_0^a r\\,dr} $$\n                 分母很简单：$\\int_0^a r\\,dr = [r^2/2]_0^a = a^2/2$。\n                 分子可以用对所有单元的求和来近似：\n                 $$ \\int_0^a \\omega(r)\\,r\\,dr \\approx \\sum_{i=0}^{N-1} \\omega_i r_i \\Delta r $$\n                 所以，$\\langle \\omega \\rangle \\approx \\frac{\\sum_{i=0}^{N-1} \\omega_i r_i \\Delta r}{a^2/2}$。\n                 这是一个简单的求和。\n\n    *   **仔细检查逻辑**：\n        - 网格：$r_i$ 是单元中心，$r_{i+1/2}$ 是单元界面。这是一个标准的交错网格设置。\n        - 离散化：似乎是标准的有限体积法。我的系数推导现在看来是正确的。\n        - 边界条件：\n          - $r=0$：通过 $r_{-1/2}=0$ 正确处理。\n          - $r=a$：用一个虚单元处理，似乎是正确的。值 $\\Pi_b$ 是固定的已知值，所以它只对右侧向量有贡献。\n        - 线性求解器：`solve_banded` 对于三对角系统是高效的。该矩阵不保证对称，但它很可能是对角占优的（因为扩散系数 $\\nu_t$ 是正的），这确保了唯一解的存在。\n        - 诊断量：\n          - $\\omega(0)$ 是 $\\omega_0$。\n          - $\\max(\\omega)$ 很直接。\n          - $\\langle\\omega\\rangle$ 的计算对于一阶（中点）法则是正确的，这与有限体积格式是一致的。\n\n让我们重写矩阵系数以确保万无一失。\n单元 $i$ 的方程是：\n$A_i' \\Pi_{i-1} + B_i' \\Pi_i + C_i' \\Pi_{i+1} = S_{\\Pi,i}$，其中系数被 $1/(r_i \\Delta r)$ 缩放。\n我们还是使用未缩放的版本，$A_i \\Pi_{i-1} + B_i \\Pi_i + C_i \\Pi_{i+1} = (r_i \\Delta r) S_{\\Pi,i}$。\n\n令 $alpha_{i+1/2} = r_{i+1/2} \\left[ \\frac{\\nu_t(r_{i+1/2})}{\\Delta r} + \\frac{V_\\Pi(r_{i+1/2})}{2} \\right]$\n令 $beta_{i+1/2} = r_{i+1/2} \\left[ -\\frac{\\nu_t(r_{i+1/2})}{\\Delta r} + \\frac{V_\\Pi(r_{i+1/2})}{2} \\right]$\n那么 $r_{i+1/2} \\Gamma_{i+1/2} = alpha_{i+1/2} \\Pi_i + beta_{i+1/2} \\Pi_{i+1}$。\n\n单元 $i$ 的方程：\n$(alpha_{i+1/2} \\Pi_i + beta_{i+1/2} \\Pi_{i+1}) - (alpha_{i-1/2} \\Pi_{i-1} + beta_{i-1/2} \\Pi_i) = r_i \\Delta r S_i$\n\n按 $\\Pi_k$ 分组：\n$(-alpha_{i-1/2})\\Pi_{i-1} + (alpha_{i+1/2} - beta_{i-1/2})\\Pi_i + (beta_{i+1/2})\\Pi_{i+1} = r_i \\Delta r S_i$。\n\n这给出了第 $i$ 行的矩阵系数。\n- 下对角线（$\\Pi_{i-1}$ 的系数）：$L_i = -alpha_{i-1/2}$\n- 主对角线（$\\Pi_i$ 的系数）：$D_i = alpha_{i+1/2} - beta_{i-1/2}$\n- 上对角线（$\\Pi_{i+1}$ 的系数）：$U_i = beta_{i+1/2}$\n\n让我们将其应用于边界。\n- 对于 $i=0$：\n  平衡是 $r_{1/2}\\Gamma_{1/2} = r_0 \\Delta r S_0$。带有 $\\Gamma_{-1/2}$ 的项消失，因为 $r_{-1/2}=0$，这意味着 $alpha_{-1/2}=0$ 和 $beta_{-1/2}=0$。所以，通用公式在这种理解下是可行的。\n  $D_0 = alpha_{1/2} - beta_{-1/2} = alpha_{1/2}$。\n  $U_0 = beta_{1/2}$。\n  $L_0$ 未使用。方程是 $D_0 \\Pi_0 + U_0 \\Pi_1 = r_0 \\Delta r S_0$。\n- 对于 $i=N-1$：\n  这是最后一个单元。方程是关于 $\\Pi_{N-1}$ 的。\n  $(-alpha_{N-3/2})\\Pi_{N-2} + (alpha_{N-1/2} - beta_{N-3/2})\\Pi_{N-1} + (beta_{N-1/2})\\Pi_N = r_{N-1} \\Delta r S_{N-1}$。\n  这里，$\\Pi_N$ 是虚单元值 $\\Pi_b$。所以我们将该项移到右侧。\n  $L_{N-1} = -alpha_{N-3/2}$\n  $D_{N-1} = alpha_{N-1/2} - beta_{N-3/2}$\n  右侧项是 $r_{N-1} \\Delta r S_{N-1} - beta_{N-1/2} \\Pi_b$。\n\n这种表述似乎更紧凑，也更不容易出错。\n我们基于此写下算法。\n\n**算法**\n1. 初始化常数：$n_i$、 $m_i$、 $R$。\n2. 对于每个测试案例：\n   a. 获取参数：$a, N, \\omega_{edge}$。\n   b. 定义输运系数和源的函数。\n   c. 设置网格：\n      $\\Delta r = a/N$\n      `r_face` 的索引为 $i+1/2$，从 $i=-1$ 到 $N-1$。所以 $r_{i+1/2} = (i+1)\\Delta r$。\n      `r_cell` 的索引为 $i$，从 $0$ 到 $N-1$。所以 $r_i = (i+0.5)\\Delta r$。\n   d. 在网格上评估剖面：\n      `nu_t_face` 将在界面 $r_{1/2}, \\dots, r_{N-1/2}$ 处评估。\n      `V_pi_face` 将在界面 $r_{1/2}, \\dots, r_{N-1/2}$ 处评估。\n      `S_pi_cell` = $S_\\Pi(\\text{r\\_cell})$。\n   e. 计算辅助项：\n      `C_factor` = $n_i m_i R^2$\n      `Pi_b` = $C_{factor} \\omega_{edge}$\n   f. 在界面上计算 `alpha` 和 `beta`。\n      `r_face_p` 对应于 $r_{1/2}, \\dots, r_{N-1/2}$。即 `(np.arange(N) + 1) * dr`。\n      `nu_t_p`, `V_pi_p` 在 `r_face_p` 上评估。\n      `alpha` 和 `beta` 将是大小为 $N$ 的数组。\n      `alpha = r_face_p * (nu_t_p/dr + V_pi_p/2)`\n      `beta = r_face_p * (-nu_t_p/dr + V_pi_p/2)`\n   g. 构建三对角系统矩阵数组。\n      `l` 用于下对角线（大小 $N-1$），`d` 用于主对角线（大小 $N$），`u` 用于上对角线（大小 $N-1$）。\n      - `d[0] = alpha[0]`\n      - `u[0] = beta[0]`\n      - 我们需要 `alpha_{i-1/2}`。让我们将 `alpha` 和 `beta` 的大小设为 $N+1$，对应于界面 $r_{-1/2}$ 到 $r_{N-1/2}$。\n      `r_face = (np.arange(N + 1)) * dr` ($r_0, \\dots, r_N$)。这些是我的 $r_{i+1/2}$，其中 $i=-1, \\dots, N-1$。\n      为了更安全，我们用一个循环来构建矩阵。\n   h. 求解系统：`scipy.linalg.solve_banded` 是最佳选择。\n   i. 后处理并计算诊断量。\n3. 打印结果。\n\n用 alpha 和 beta 项重新评估的方法似乎更稳健。\n我将实现 `alpha`/`beta` 方法。问题指定 `r_{i+1/2} = (i+1)dr`。界面 $i+1/2$ 是单元 $i$ 右侧的界面。\n对于 `i=0`，左界面是 $r_{-1/2}=0$，右界面是 $r_{1/2}=dr$。\n对于 `i=N-1`，左界面是 $r_{N-3/2}=(N-1)dr$，右界面是 $r_{N-1/2}=Ndr=a$。\n这似乎是一致的。\n\n为 `solve_banded` 构建带状矩阵的逻辑：`ab` 有 `l+u+1` 行。这里 $l=1, u=1$，所以是3行。\n第0行：上对角线，开头用0填充。\n第1行：主对角线。\n第2行：下对角线，结尾用0填充。\n所以 `ab[0, 1:] = u`, `ab[1, :] = d`, `ab[2, :-1] = l`。这是正确的。\n\n看起来不错。我准备好了。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases\n    and prints the final result.\n    \"\"\"\n    # Physical constants\n    n_i = 1.0e20  # m^-3\n    m_i = 3.34e-27 # kg (deuterium)\n    R = 3.0       # m\n    \n    # Pre-calculate the constant factor relating momentum density and rotation\n    # Pi = (n_i * m_i * R^2) * omega\n    C_factor = n_i * m_i * R**2\n\n    test_cases = [\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.0 * (1.0 + 0.5 * (r / a)**2),\n            \"V_pi\": lambda r, a: -0.5 * (1.0 - r / a),\n            \"S_pi\": lambda r: 5.0e-3 * np.exp(-(r - 0.5)**2 / (2 * 0.08**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.5 * (1.0 + 0.2 * (r / a)),\n            \"V_pi\": lambda r, a: 0.0,\n            \"S_pi\": lambda r: 3.0e-3 * np.exp(-(r - 0.7)**2 / (2 * 0.05**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 400, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.3 * (1.0 + 0.1 * (r / a)**2),\n            \"V_pi\": lambda r, a: 0.2 * (r / a),\n            \"S_pi\": lambda r: 4.0e-3 * np.exp(-(r - 0.3)**2 / (2 * 0.06**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 300, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.8,\n            \"V_pi\": lambda r, a: -0.3,\n            \"S_pi\": lambda r: 4.0e-3 * (np.exp(-(r - 0.35)**2 / (2 * 0.05**2)) - np.exp(-(r - 0.75)**2 / (2 * 0.05**2)))\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = solve_case(case, C_factor)\n        all_results.extend(results)\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef solve_case(case_params, C_factor):\n    \"\"\"\n    Solves the transport equation for a single test case.\n    \"\"\"\n    # Unpack case parameters\n    a = case_params[\"a\"]\n    N = case_params[\"N\"]\n    omega_edge = case_params[\"omega_edge\"]\n    nu_t_func = case_params[\"nu_t\"]\n    V_pi_func = case_params[\"V_pi\"]\n    S_pi_func = case_params[\"S_pi\"]\n\n    # 1. Setup grid\n    dr = a / N\n    # Cell centers: r_i = (i + 1/2) * dr for i=0,...,N-1\n    r_cell = (np.arange(N) + 0.5) * dr\n    # Cell faces: r_{i+1/2} = (i+1) * dr for i=-1,..,N-1\n    # We will need faces from r_{-1/2} to r_{N-1/2}, total N+1 faces.\n    # r_face[i] corresponds to face at (i)*dr, so we use indices 0 to N.\n    r_face = np.arange(N + 1) * dr\n\n    # 2. Evaluate physical profiles on the grid\n    # For nu_t and V_pi, if the lambda takes two arguments, pass both a and r\n    try:\n        nu_t_at_faces = nu_t_func(r_face, a)\n    except TypeError:\n        nu_t_at_faces = np.full_like(r_face, nu_t_func(r_face, a))\n    try:\n        V_pi_at_faces = V_pi_func(r_face, a)\n    except TypeError:\n        V_pi_at_faces = np.full_like(r_face, V_pi_func(r_face, a))\n        \n    S_pi_at_cells = S_pi_func(r_cell)\n\n    # 3. Calculate coefficients for the linear system\n    # alpha_{i+1/2} and beta_{i+1/2} are defined at faces r_{i+1/2}\n    # Index j in these arrays corresponds to face r_{j-1/2}\n    alpha = r_face * (nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n    beta = r_face * (-nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n\n    # 4. Construct the tridiagonal matrix M (as 3 diagonals) and RHS vector b\n    # M is N x N. Diagonals are lower, main, upper.\n    lower = np.zeros(N - 1)\n    main = np.zeros(N)\n    upper = np.zeros(N - 1)\n    \n    b = r_cell * dr * S_pi_at_cells\n\n    # Equation for cell i=0 (first row)\n    # (alpha_{1/2} - beta_{-1/2})*Pi_0 + beta_{1/2}*Pi_1 = b_0\n    # beta_{-1/2} is 0 since r_{-1/2}=0.\n    main[0] = alpha[1] # alpha at face r_{1/2}\n    upper[0] = beta[1]  # beta at face r_{1/2}\n    \n    # Interior cells i = 1 to N-2\n    # -alpha_{i-1/2}*Pi_{i-1} + (alpha_{i+1/2} - beta_{i-1/2})*Pi_i + beta_{i+1/2}*Pi_{i+1} = b_i\n    # For cell i, the left face is r_{i-1/2} (index i in r_face)\n    # and right face is r_{i+1/2} (index i+1 in r_face).\n    for i in range(1, N - 1):\n        lower[i-1] = -alpha[i]\n        main[i] = alpha[i+1] - beta[i]\n        upper[i] = beta[i+1]\n        \n    # Equation for cell i=N-1 (last row)\n    # -alpha_{N-3/2}*Pi_{N-2} + (alpha_{N-1/2} - beta_{N-3/2})*Pi_{N-1} = b_{N-1} - beta_{N-1/2}*Pi_b\n    lower[N-2] = -alpha[N-1]\n    main[N-1] = alpha[N] - beta[N-1]\n\n    # Boundary condition at r=a\n    Pi_b = C_factor * omega_edge\n    b[N-1] -= beta[N] * Pi_b\n\n    # 5. Solve the linear system M * Pi = b\n    # The matrix for solve_banded must be in a specific layout\n    # For l=1, u=1 bands:\n    # row 0: [*, u_0, u_1, ..., u_{N-2}]\n    # row 1: [d_0, d_1, ..., d_{N-1}]\n    # row 2: [l_0, l_1, ..., l_{N-2}, *]\n    ab = np.zeros((3, N))\n    ab[0, 1:] = upper\n    ab[1, :] = main\n    ab[2, :-1] = lower\n    \n    Pi_solution = solve_banded((1, 1), ab, b)\n    \n    # 6. Convert to rotation and compute diagnostics\n    omega_solution = Pi_solution / C_factor\n    \n    omega_0 = omega_solution[0]\n    omega_max = np.max(omega_solution)\n    \n    # Area-weighted average: integral(omega*r*dr) / integral(r*dr)\n    # Denominator: integral from 0 to a of r*dr = a^2 / 2\n    # Numerator approximation: sum(omega_i * r_i * dr)\n    integral_rdr = 0.5 * a**2\n    integral_omega_rdr = np.sum(omega_solution * r_cell * dr)\n    omega_avg = integral_omega_rdr / integral_rdr\n\n    return [omega_0, omega_max, omega_avg]\n\nsolve()\n```"
        },
        {
            "introduction": "在上一节的宏观模型中，我们直接使用了湍流粘滞等参数，但这些输运效应的根源在于微观的湍流涨落。本实践将带您深入一步，探索湍流如何驱动宏观流动，通过计算雷诺胁强来实现。您将从第一性原理出发，推导雷诺胁强与湍流电势谱的各向异性（谱倾斜）之间的关系，并计算在平行速度梯度（PVG）效应影响下的雷诺胁强大小，从而揭示微观湍流特性与宏观动量输运之间的深刻联系。",
            "id": "4042033",
            "problem": "你的任务是通过计算雷诺应力，在一个简化的、存在剪切流的静电回旋动理学设定中，量化平行速度梯度（PVG）对带状流生成的影响。假设存在一个均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$，以及标量势涨落为 $\\phi(\\mathbf{x}, t)$ 的稳态、均匀、随机相位的静电湍流。\n\n从第一性原理出发，使用以下基于物理的假设和定义：\n\n- 在垂直于 $\\mathbf{B}$ 的平面内，$\\mathbf{E} \\times \\mathbf{B}$ 漂移速度在国际单位制（SI）中由 $\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2}$ 给出，其中 $\\mathbf{E} = -\\nabla \\phi$。在笛卡尔坐标系中，当 $\\mathbf{B}$ 沿 $\\hat{\\mathbf{z}}$ 方向时，这意味着 $v_x$ 和 $v_y$ 由 $\\phi$ 的空间导数确定。\n- 与动量输运和带状流驱动相关的雷诺应力分量定义为 $\\Pi_{xy} = \\langle v_x v_y \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示对湍流场的系综和/或时空平均。\n- 将垂直波矢空间 $\\mathbf{k} = (k_x, k_y)$ 中 $\\phi$ 的谱功率密度建模为一个零均值、归一化的二元高斯分布，其协方差矩阵为 $\\boldsymbol{\\Sigma}_k \\in \\mathbb{R}^{2 \\times 2}$，总方差为 $\\langle |\\phi|^2 \\rangle = E_\\phi$。也就是说，谱密度 $P_\\phi(\\mathbf{k})$ 对全空间积分得到 $E_\\phi$，并具有由 $\\boldsymbol{\\Sigma}_k$ 表征的高斯形状。对角线元素设定了谱宽，而非对角线元素 $\\Sigma_{xy}$ 捕捉了各向异性的谱倾斜。\n- 通过非对角协方差 $\\Sigma_{xy}$ 来表示由 PVG 引起的各向异性，该协方差由一个无量纲的 PVG 强度 $\\Lambda_p$ 和一个平衡态 $\\mathbf{E} \\times \\mathbf{B}$ 剪切率 $\\gamma_E$ 参数化，并受到一个参考线性增长率尺度 $\\gamma_0$ 的抑制。使用以下具有物理动机的形式\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\n其中 $\\eta$ 是一个单位为 $\\mathrm{m}^{-2}$ 的常数。通过选择 $\\eta$ 和谱宽以满足 $|\\Sigma_{xy}|  \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$，确保协方差矩阵保持正定。\n\n你的任务是基于这些基础，推导出一个仅用指定的物理参数和谱协方差结构表示的 $\\Pi_{xy}$ 表达式，然后为以下测试套件计算数值。你必须将所有最终的雷诺应力值以 $\\mathrm{m}^2/\\mathrm{s}^2$ 为单位表示。\n\n假设以下固定的对角谱宽（用于定义物理上一致的高斯分布，但不会直接作为输入提供给程序）：$\\Sigma_{xx} = \\sigma_x^2$ (其中 $\\sigma_x = 800\\,\\mathrm{m}^{-1}$)，以及 $\\Sigma_{yy} = \\sigma_y^2$ (其中 $\\sigma_y = 1200\\,\\mathrm{m}^{-1}$)。\n\n测试套件（每行是一个测试用例，指定为 $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$）：\n1. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n2. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 0\\,\\mathrm{s}^{-1},\\; \\Lambda_p = -0.5,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n3. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 2.0 \\times 10^5\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n4. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 1.5 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.0,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n\n要求：\n- 从给定的定律和模型假设出发，逐步推导雷诺应力 $\\Pi_{xy}$，不得跳过核心推理过程使用任何简便公式。\n- 对每个测试用例，计算相应的 $\\Pi_{xy}$，并将结果集输出为单行：一个用方括号括起来的逗号分隔列表（例如，$[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$）。每个结果必须是代表 $\\Pi_{xy}$（单位为 $\\mathrm{m}^2/\\mathrm{s}^2$）的实数（浮点数）。",
            "solution": "我们从国际单位制 (SI) 中的基本 $\\mathbf{E} \\times \\mathbf{B}$ 漂移开始。对于一个均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 和静电场 $\\mathbf{E} = -\\nabla \\phi$，漂移速度为\n$$\n\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2} = -\\frac{\\hat{\\mathbf{z}} \\times \\nabla \\phi}{B}.\n$$\n使用 $\\hat{\\mathbf{z}} \\times \\nabla \\phi = \\left(-\\frac{\\partial \\phi}{\\partial y}, \\frac{\\partial \\phi}{\\partial x}, 0\\right)$ 明确写出分量，我们得到\n$$\nv_x = \\frac{1}{B} \\frac{\\partial \\phi}{\\partial y}, \\quad v_y = -\\frac{1}{B} \\frac{\\partial \\phi}{\\partial x}.\n$$\n与垂直动量输运和带状流驱动相关的雷诺应力分量为\n$$\n\\Pi_{xy} = \\langle v_x v_y \\rangle = -\\frac{1}{B^2} \\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle.\n$$\n接下来，我们使用随机相位、稳态、均匀场的谱表示来表达相关性 $\\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle$。设 $\\phi(\\mathbf{x})$ 的傅里叶振幅为 $\\phi_{\\mathbf{k}}$，谱功率密度为 $P_\\phi(\\mathbf{k}) = \\langle |\\phi_{\\mathbf{k}}|^2 \\rangle$，因此\n$$\n\\langle |\\phi|^2 \\rangle = \\int_{\\mathbb{R}^2} P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k} \\equiv E_\\phi.\n$$\n在相位的统计均匀性和各向同性条件下，两点导数相关性简化为\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle = \\int_{\\mathbb{R}^2} k_x k_y \\, P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k}.\n$$\n我们将 $P_\\phi(\\mathbf{k})$ 建模为一个在 $\\mathbf{k} = (k_x, k_y)$ 中零均值、协方差矩阵为 $\\boldsymbol{\\Sigma}_k$ 的归一化二元高斯分布：\n$$\nP_\\phi(\\mathbf{k}) = E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k), \\quad\nG(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) = \\frac{1}{2\\pi \\sqrt{\\det \\boldsymbol{\\Sigma}_k}} \\exp\\left(-\\frac{1}{2}\\mathbf{k}^\\mathsf{T} \\boldsymbol{\\Sigma}_k^{-1} \\mathbf{k}\\right),\n$$\n使得 $\\int G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k)\\, d^2\\mathbf{k} = 1$。对于一个协方差为 $\\boldsymbol{\\Sigma}_k$ 的零均值多元高斯概率密度函数，其二阶矩由 $\\boldsymbol{\\Sigma}_k$ 本身的元素给出：\n$$\n\\int k_i k_j \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k} = (\\boldsymbol{\\Sigma}_k)_{ij}.\n$$\n由此可得\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle\n= \\int k_x k_y \\, E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k}\n= E_\\phi \\, (\\boldsymbol{\\Sigma}_k)_{xy} \\equiv E_\\phi \\, \\Sigma_{xy}.\n$$\n代入雷诺应力的表达式中，得到紧凑而基本的关系式\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\n这个表达式将动量输运与 $\\mathbf{k}$ 空间中湍流谱的各向异性倾斜直接联系起来。为了用旋转效应来封闭模型，我们将平行速度梯度（PVG）和 $\\mathbf{E} \\times \\mathbf{B}$ 剪切纳入谱倾斜中。一个广泛使用且具有物理动机的非对角协方差形式是\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\n其中 $\\Lambda_p$ 是一个无量纲的 PVG 强度参数，$\\gamma_E$ 是剪切率，$\\gamma_0$ 是一个参考线性增长率尺度，而 $\\eta$ 是一个单位为 $\\mathrm{m}^{-2}$ 的量纲系数。这种选择捕捉了 PVG 对倾斜的线性驱动以及流动剪切对其的抑制作用。通过选择对角元素 $\\Sigma_{xx} = \\sigma_x^2$ 和 $\\Sigma_{yy} = \\sigma_y^2$ 并满足 $|\\Sigma_{xy}|  \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$，可以确保 $\\boldsymbol{\\Sigma}_k$ 的正定性。\n\n计算每个测试用例 $\\Pi_{xy}$ 的算法：\n1. 读取参数 $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$。\n2. 计算非对角谱协方差\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2}.\n$$\n3. 计算雷诺应力\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\n4. 报告 $\\Pi_{xy}$，单位为 $\\mathrm{m}^2/\\mathrm{s}^2$。\n\n将此算法应用于提供的测试套件：\n- 用例 1: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = \\frac{2.0 \\times 0.8}{1 + (1)^2} = 0.8\\,\\mathrm{m}^{-2}$ 和 $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times 0.8 = -3.2\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 用例 2: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 0, \\Lambda_p = -0.5, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = \\frac{2.0 \\times (-0.5)}{1 + 0} = -1.0\\,\\mathrm{m}^{-2}$ 和 $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times (-1.0) = 4.0\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 用例 3: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 2.0\\times 10^5\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\frac{\\gamma_E}{\\gamma_0} \\approx 6.666\\dots$，因此 $\\Sigma_{xy} \\approx \\frac{1.6}{1 + 44.444\\dots} \\approx 0.035225\\,\\mathrm{m}^{-2}$ 且 $\\Pi_{xy} \\approx -4 \\times 0.035225 \\approx -0.140900\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 用例 4: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 1.5\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.0, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = 0$ 和 $\\Pi_{xy} = 0$。\n\n最终程序将实现这些计算，并打印一行包含四个结果的输出，结果以逗号分隔，并用方括号括起来，每个结果的单位为 $\\mathrm{m}^2/\\mathrm{s}^2$。",
            "answer": "```python\n# Python 3.12 program to compute Reynolds stress Pi_xy due to PVG-induced spectral tilt\n# under E x B shear, using a Gaussian spectral model.\n# Libraries: numpy 1.23.5 (used minimally), no external input.\n\nimport numpy as np\n\ndef compute_sigma_xy(eta, Lambda_p, gamma_E, gamma0):\n    \"\"\"\n    Compute the off-diagonal spectral covariance Sigma_xy due to PVG and shear.\n    Sigma_xy = eta * Lambda_p / (1 + (gamma_E/gamma0)^2)\n    Units: eta in m^-2, gamma in s^-1, Lambda_p dimensionless = Sigma_xy in m^-2.\n    \"\"\"\n    ratio = gamma_E / gamma0\n    return eta * Lambda_p / (1.0 + ratio * ratio)\n\ndef compute_reynolds_stress(B, Ephi, sigma_xy):\n    \"\"\"\n    Compute Reynolds stress Pi_xy = -(Ephi/B^2) * sigma_xy\n    Units: B in T, Ephi in V^2, sigma_xy in m^-2 = Pi_xy in m^2/s^2 (SI consistency).\n    \"\"\"\n    return -(Ephi / (B * B)) * sigma_xy\n\ndef solve():\n    # Define the test cases: (B [T], E_phi [V^2], gamma0 [s^-1], gamma_E [s^-1], Lambda_p, eta [m^-2])\n    test_cases = [\n        (2.5, 25.0, 3.0e4, 3.0e4, 0.8, 2.0),      # Case 1\n        (2.5, 25.0, 3.0e4, 0.0,   -0.5, 2.0),     # Case 2\n        (2.5, 25.0, 3.0e4, 2.0e5, 0.8, 2.0),      # Case 3\n        (2.5, 25.0, 3.0e4, 1.5e4, 0.0, 2.0),      # Case 4\n    ]\n\n    results = []\n    for B, Ephi, gamma0, gammaE, Lambda_p, eta in test_cases:\n        sigma_xy = compute_sigma_xy(eta, Lambda_p, gammaE, gamma0)\n        Pi_xy = compute_reynolds_stress(B, Ephi, sigma_xy)\n        results.append(Pi_xy)\n\n    # Print single-line output as specified: comma-separated list enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "通过直接数值模拟（DNS）从第一性原理研究湍流和输运现象，是计算聚变科学中的前沿方法。为了确保模拟的准确性，必须满足严格的数值分辨率要求，尤其是在处理旋转剪切对湍流的影响时。本实践将引导您推导并应用一个关键的数值约束条件——保证能够解析剪切流对湍流涡的拉伸动力学所需的时间步长，这对于任何旨在精确捕捉旋转效应的数值模拟都至关重要。",
            "id": "4042058",
            "problem": "考虑在磁化等离子体中，由较差自转引起的湍流涡的剪切。在适用于磁约束聚变等离子体的局域平板近似中，与跨场漂移相关的背景流被建模为线性剪切，这导致谱含量在波数空间中演化。对于直接数值模拟 (DNS)，确定一个能够忠实解析此剪切过程的时间步长至关重要。从线性剪切流对被动标量的平流出发，并使用标准的数值稳定性和采样考虑，推导一个关于时间步长的数学上严格的条件，以保证离散化谱栅格上剪切动力学的解析度。然后，实现这个条件，为一组给定的参数值计算所需的时间分辨率。\n\n使用以下基本依据：\n- 二维被动标量平流方程，由守恒律 $\\,\\partial_t a + \\boldsymbol{u}\\cdot\\nabla a = 0\\,$ 表示，其中 $\\,a(x,y,t)\\,$ 是一个标量场，$\\,\\boldsymbol{u}\\,$ 是一个给定的速度场。\n- $y$ 方向上的线性剪切流，由 $\\,\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}\\,$ 给出，其中 $\\,\\gamma_E\\,$ 是恒定的剪切率，单位为 inverse seconds ($\\mathrm{s}^{-1}$)。\n- 在波数空间中有限栅格上的离散谱表示，具有 $\\,k_x\\,$ 和 $\\,k_y\\,$ 值的列表，单位为 $\\mathrm{m}^{-1}$。\n- 在 $k$ 空间中相关平流的显式时间推进需要一个基于离散化坐标中特征速度的 Courant–Friedrichs–Lewy (CFL) 型界限。\n\n基于这些基础，执行以下操作：\n1. 从第一性原理出发，推导线性剪切下傅里葉模的演化，使得 $k$ 空间中的谱含量发生平流。确定 $k$ 空间中的特征速度，并构建一个涉及 $\\,k_x\\,$ 栅格最小间距、$\\,k_y\\,$ 栅格最大幅值以及剪切率大小 $\\,|\\gamma_E|\\,$ 的 CFL 型稳定性条件。引入一个用户指定的稳定性系数 $\\,C_{\\mathrm{adv}}$，其中 $0  C_{\\mathrm{adv}} \\le 1$。\n2. 此外，建立一个基于充分采样剪切时间 $\\,\\tau_E=1/|\\gamma_E|\\,$ 的物理约束，要求每个剪切时间至少有 $\\,N_s\\,$ 个样本。\n3. 组合这两个约束，以获得最大允许时间步长 $\\,\\Delta t_{\\max}\\,$ 的通用表达式。此表达式必须能处理特殊情况，例如 $\\,\\gamma_E=0\\,$ 或 $\\,k_y\\,$ 栅格没有非零元素。对于 $\\,\\gamma_E=0\\,$ 的情况，时间步长不受剪切约束，因此应返回哨兵值 $\\,-1.0\\,$。\n4. 为以下测试套件计算 $\\,\\Delta t_{\\max}\\,$，其中每个套件定义为 $(\\gamma_E, k_x\\text{-list}, k_y\\text{-list}, C_{\\mathrm{adv}}, N_s)$：\n   - 用例 1：$\\,(5.0\\times 10^4, [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10], [0, 1, 2, 3], 0.5, 16)\\,$\n   - 用例 2：$\\,(5.0\\times 10^4, [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10], [0.0], 0.5, 16)\\,$\n   - 用例 3：$\\,(1.0\\times 10^5, [-0.60, -0.55, -0.40, -0.10, 0.00, 0.03], [2.0, 6.0, 10.0], 0.5, 16)\\,$\n   - 用例 4：$\\,(-2.0\\times 10^4, [-2.0, -1.0, 0.0, 1.0, 2.0], [2.0], 0.7, 16)\\,$\n   - 用例 5：$\\,(0.0, [0.0, 1.0, 2.0, 3.0], [3.0], 0.5, 16)\\,$\n   - 用例 6：$\\,(3.0\\times 10^4, [-3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0], [0.0, 0.0], 0.5, 16)\\,$\n\n将结果集输出为单行：一个用方括号括起来的逗号分隔列表。对于每个测试用例，将最终的 $\\,\\Delta t_{\\max}\\,$ 时间步长值，用科学记数法表示，保留六位有效数字。",
            "solution": "该问题要求推导出一个最大允许时间步长 $\\Delta t_{\\max}$，用于数值模拟线性剪切流对被动标量的平流。此推导必须同时考虑由波数空间中谱模的平流引起的数值稳定性（一种 Courant–Friedrichs–Lewy 型条件），以及解析剪切流特征时间尺度的物理采样要求。\n\n分析始于被动标量场 $a(x,y,t)$ 在线性剪切流 $\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}$ 下平流的控制偏微分方程：\n$$\n\\partial_t a + \\boldsymbol{u} \\cdot \\nabla a = 0\n$$\n代入速度场，方程变为：\n$$\n\\frac{\\partial a}{\\partial t} + \\gamma_E x \\frac{\\partial a}{\\partial y} = 0\n$$\n这里，$\\gamma_E$ 是恒定的剪切率。为了在谱表示中分析动力学，我们对此方程进行傅里葉变换。设 $\\hat{a}(k_x, k_y, t)$ 是 $a(x,y,t)$ 的二维傅里葉变换。时间导数的变换是直接的：$\\mathcal{F}[\\partial_t a] = \\partial_t \\hat{a}$。对于平流项，我们使用傅里葉变换性质 $\\mathcal{F}[\\partial_y f] = i k_y \\hat{f}$ 和 $\\mathcal{F}[x f] = i \\partial_{k_x} \\hat{f}$。应用这些性质可得：\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\mathcal{F}\\left[x \\left(\\frac{\\partial a}{\\partial y}\\right)\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) \\mathcal{F}\\left[\\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) [i k_y \\hat{a}(k_x, k_y, t)]\n$$\n假设 $k_y$ 与 $k_x$ 无关，我们可以写出：\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E (i^2 k_y) \\frac{\\partial \\hat{a}}{\\partial k_x} = -\\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x}\n$$\n因此，傅里葉空间中的完整方程是：\n$$\n\\frac{\\partial \\hat{a}}{\\partial t} - \\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x} = 0\n$$\n这是一个关于谱振幅 $\\hat{a}$ 在一维坐标 $k_x$ 中的一阶线性平流方程。$k$ 空间中的“平流速度”是 $v_{k_x} = \\gamma_E k_y$。这个方程描述了剪切流如何导致谱能量以与 $k_y$ 成正比的速率沿 $k_x$ 轴连续传输。\n\n**1. CFL 型平流约束**\n\n对于在 $k$ 空间离散网格上使用时间步长为 $\\Delta t$ 的显式时间推进方案的数值模拟，必须满足 Courant–Friedrichs–Lewy (CFL) 条件以确保数值稳定性。CFL 条件指出，数值依赖域必须包含物理依赖域。对于一维平流方程，这意味着信息在一个时间步内不能传播超过一个网格单元。将此应用于我们在 $k$ 空间中的平流方程，可得：\n$$\n|v_{k_x}| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\n其中 $\\Delta k_x$ 是 $k_x$ 方向上的网格间距，而 $C_{\\mathrm{adv}}$ 是一个数值稳定性系数，通常 $0  C_{\\mathrm{adv}} \\le 1$。代入 $v_{k_x}$ 的表达式：\n$$\n|\\gamma_E k_y| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\n为了找到最严格的时间步长，我们必须考虑整个离散网格上的最坏情况。这对应于使用最小的网格间距 $\\Delta k_{x, \\min}$ 和最大的平流速度，后者发生在 $k_y$ 的最大幅值处，记为 $k_{y, \\max} = \\max(|k_y|)$。因此，对 $\\Delta t$ 的约束是：\n$$\n\\Delta t \\le C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\n这给出了时间步长的第一个界限，我们将其表示为 $\\Delta t_1$：\n$$\n\\Delta t_1 = C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\n如果 $|\\gamma_E|=0$ 或 $k_{y, \\max}=0$，则此约束是无界的（无穷大），因为在这些情况下 $k$ 空间中没有平流。如果 $k_x$ 网格少于两个不同的点，使得 $\\Delta k_{x, \\min}$ 未定义或无穷大，它也是无界的。\n\n**2. 物理采样约束**\n\n独立于数值稳定性，模拟必须能够解析底层的物理过程。剪切的特征时间尺度是剪切时间 $\\tau_E = 1/|\\gamma_E|$。为了充分解析在此时间尺度上发生的动力学，我们必须在一个特征时间内采取多个时间步。问题规定每个剪切时间至少有 $N_s$ 个样本。这对时间步长施加了第二个约束：\n$$\nN_s \\Delta t \\le \\tau_E \\quad \\implies \\quad \\Delta t \\le \\frac{\\tau_E}{N_s}\n$$\n代入 $\\tau_E = 1/|\\gamma_E|$，我们得到第二个时间步长界限 $\\Delta t_2$：\n$$\n\\Delta t_2 = \\frac{1}{N_s |\\gamma_E|}\n$$\n如果 $|\\gamma_E|=0$，此约束是无界的。\n\n**3. 组合时间步长规定**\n\n一个有效的数值模拟必须同时满足所有约束。因此，最大允许时间步长 $\\Delta t_{\\max}$ 是上述所有适用（即有限）界限的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_1, \\Delta t_2)\n$$\n我们现在处理问题陈述中概述的特殊情况：\n- 如果剪切率 $\\gamma_E = 0$，则 $\\Delta t_1$ 和 $\\Delta t_2$ 都是无界的。由于剪切，时间步长没有约束。在这种情况下，指定的输出是哨兵值 $-1.0$。\n- 如果 $|\\gamma_E| > 0$ 但 $k_{y, \\max} = 0$，CFL 约束 $\\Delta t_1$ 变为无界，但采样约束 $\\Delta t_2$ 保持有限。因此，最终约束仅由采样要求决定：$\\Delta t_{\\max} = \\Delta t_2$。\n- 如果 $|\\gamma_E| > 0$ 且 $k_{y, \\max} > 0$，两个约束都可能是有限的，最终时间步长是两者的最小值：\n$$\n\\Delta t_{\\max} = \\min \\left( C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}, \\frac{1}{N_s |\\gamma_E|} \\right)\n$$\n这个全面的规定为在数值模拟中忠实捕捉剪切动力学所需的时间分辨率提供了严格的条件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef format_to_sig_figs(value, sig_figs):\n    \"\"\"\n    Formats a floating-point number to a specified number of significant figures\n    in scientific notation, with special handling for the sentinel value -1.0.\n    \"\"\"\n    if value == -1.0:\n        return \"-1.0\"\n    \n    # Format to scientific notation with sig_figs-1 digits after the decimal.\n    return f\"{value:.{sig_figs - 1}e}\"\n\ndef calculate_dt_max(gamma_E, kx_list, ky_list, C_adv, Ns):\n    \"\"\"\n    Calculates the maximum allowable time step based on CFL and sampling constraints.\n    \"\"\"\n    # Case 1: Zero shear rate. No constraint from shear.\n    if gamma_E == 0.0:\n        return -1.0\n\n    abs_gamma_E = np.abs(gamma_E)\n\n    # Calculate the sampling constraint (dt_2)\n    # This bound is always applicable if gamma_E is non-zero.\n    dt_sampling = 1.0 / (Ns * abs_gamma_E)\n    \n    bounds = [dt_sampling]\n\n    # Calculate the advection (CFL) constraint (dt_1)\n    # This bound is applicable only if k_y_max  0 and there are at least two kx grid points.\n    \n    # Find k_y_max\n    if not ky_list:\n        k_y_max = 0.0\n    else:\n        k_y_max = np.max(np.abs(np.array(ky_list)))\n    \n    # Find delta_kx_min\n    unique_kx = sorted(list(set(kx_list)))\n    if len(unique_kx)  2:\n        delta_kx_min = np.inf\n    else:\n        diffs = np.diff(unique_kx)\n        delta_kx_min = np.min(diffs)\n\n    # If CFL constraint is applicable (finite), add it to the list of bounds.\n    if k_y_max > 0 and np.isfinite(delta_kx_min):\n        dt_cfl = (C_adv * delta_kx_min) / (abs_gamma_E * k_y_max)\n        bounds.append(dt_cfl)\n    \n    # The final dt_max is the minimum of all applicable bounds.\n    dt_max = np.min(bounds)\n    \n    return dt_max\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0,1,2,3], 0.5, 16),\n        # Case 2 (no perpendicular content except ky=0)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0.0], 0.5, 16),\n        # Case 3 (nonuniform kx with tight spacing)\n        (1.0e5, [-0.60,-0.55,-0.40,-0.10,0.00,0.03], [2.0,6.0,10.0], 0.5, 16),\n        # Case 4 (negative shear rate)\n        (-2.0e4, [-2.0,-1.0,0.0,1.0,2.0], [2.0], 0.7, 16),\n        # Case 5 (zero shear rate)\n        (0.0, [0.0,1.0,2.0,3.0], [3.0], 0.5, 16),\n        # Case 6 (nonzero shear with ky=0 only)\n        (3.0e4, [-3.0,-2.0,-1.0,0.0,1.0,2.0,3.0], [0.0, 0.0], 0.5, 16)\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma_E, kx, ky, C_adv, Ns = case\n        result_val = calculate_dt_max(gamma_E, kx, ky, C_adv, Ns)\n        # Format the result to 6 significant figures.\n        formatted_result = format_to_sig_figs(result_val, 6)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}