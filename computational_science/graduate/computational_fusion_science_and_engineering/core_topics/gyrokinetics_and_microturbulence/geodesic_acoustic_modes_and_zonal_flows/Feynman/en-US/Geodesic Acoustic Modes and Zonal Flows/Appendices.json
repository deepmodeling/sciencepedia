{
    "hands_on_practices": [
        {
            "introduction": "This first practice establishes a cornerstone of zonal flow physics: the concept of the Rosenbluth-Hinton (RH) residual. When a zonal perturbation is introduced in a toroidal plasma, not all of its energy is converted into transient oscillations like Geodesic Acoustic Modes (GAMs). This exercise guides you through a first-principles derivation to quantify how the initial energy partitions between the oscillatory GAM and a steady, non-oscillatory residual zonal flow, a key mechanism for long-term turbulence regulation.",
            "id": "3984894",
            "problem": "Consider a large-aspect-ratio tokamak plasma with circular concentric magnetic flux surfaces. The inverse aspect ratio is $\\epsilon$, the safety factor is $q$, and the equilibrium magnetic field magnitude is $B$. An axisymmetric zonal potential perturbation with a single radial wavenumber $k_r$ is imposed at $t=0^{+}$, generating a flux-surface-averaged electrostatic potential $\\phi(r,t)$ with initial condition $\\phi(r,0^{+})=\\phi_0 \\cos(k_r r)$ and no initial parallel motion. Assume collisionless ions described by drift-kinetic theory, adiabatic electrons, and the long-wavelength limit $k_r \\rho_i \\ll 1$, where $\\rho_i$ is the ion Larmor radius. The zonal flow couples to the Geodesic Acoustic Mode (GAM) through geodesic curvature and ion compressibility.\n\nUsing kinetic theory, derive how the initial zonal potential perturbation partitions into a non-oscillatory residual zonal flow component and an oscillatory Geodesic Acoustic Mode (GAM) component in the collisionless limit. Adopt the following modeling choices:\n\n- The energy norm to be partitioned is the zonal-flow $\\mathbf{E}\\times\\mathbf{B}$ kinetic energy density, defined as $W_E = \\frac{n_i m_i}{2} |\\mathbf{u}_E|^2$, where $\\mathbf{u}_E = \\frac{c}{B}\\,\\hat{\\mathbf{b}}\\times\\nabla \\phi$, with $\\hat{\\mathbf{b}}$ the unit vector along the magnetic field, $n_i$ the ion density, and $m_i$ the ion mass. For a single-$k_r$ zonal perturbation, $W_E \\propto k_r^2 \\phi^2$.\n- In the large-aspect-ratio, circular-surface limit, the neoclassical polarization inertia associated with trapped-ion dynamics enhances the static zonal-flow response by an amount characterized by the dimensionless parameter $\\Lambda(q,\\epsilon)$, which is proportional to $q^2/\\sqrt{\\epsilon}$ for adiabatic electrons and $k_r \\rho_i \\ll 1$. Specifically, take $\\Lambda(q,\\epsilon) = \\alpha\\,\\frac{q^2}{\\sqrt{\\epsilon}}$ with $\\alpha=1.6$ for circular concentric flux surfaces.\n\nFrom first principles, determine the residual zonal-flow potential amplitude $\\phi_{\\infty}$ in terms of $\\phi_0$ and $\\Lambda$, and then use the specified energy norm to compute the fraction of the initial $\\mathbf{E}\\times\\mathbf{B}$ kinetic energy that remains in the residual zonal flow, denoted $f_{\\mathrm{res}}$, and the complementary fraction that goes into the oscillatory GAM component, denoted $f_{\\mathrm{GAM}}$. Evaluate these fractions numerically for $q=1.5$ and $\\epsilon=0.16$.\n\nRound your numerical answers to four significant figures. Express the final energy fractions as decimal numbers without a percent sign. The final answer should report $(f_{\\mathrm{res}}, f_{\\mathrm{GAM}})$ as two numbers in that order.",
            "solution": "The user-provided problem has been validated and is determined to be a scientifically grounded, well-posed, and objective question from the field of computational fusion science and engineering.\n\nThe problem asks for the partitioning of energy from an initial zonal potential perturbation into a long-time residual zonal flow and an oscillatory Geodesic Acoustic Mode (GAM). The core of the problem lies in the concept of neoclassical polarization shielding in a tokamak plasma.\n\nFirst, we address the evolution of the flux-surface-averaged electrostatic potential, $\\phi(t)$. An initial potential perturbation $\\phi(r, 0^+) = \\phi_0 \\cos(k_r r)$ is imposed on the plasma. In a toroidal geometry, the response to this perturbation is governed by both classical and neoclassical polarization effects. In the long-time limit ($t \\rightarrow \\infty$), after the oscillatory GAM components have damped away via collisionless phase-mixing, a steady-state residual zonal flow potential, $\\phi_{\\infty}$, remains.\n\nThe relationship between the initial potential $\\phi_0$ and the residual potential $\\phi_{\\infty}$ is a classic result from kinetic theory (popularized by Rosenbluth and Hinton). It arises from the conservation of the initial charge that establishes the potential. Initially, at $t=0^+$, the plasma has not had time for the toroidicity-induced (neoclassical) effects to manifest. The system's response is governed by the high-frequency or classical dielectric capacitance, which is related to the classical ion polarization drift. Let's denote the effective dielectric constant for this fast timescale as $\\epsilon_{cl}$. The initial \"unshielded\" charge density perturbation $\\rho_0$ is proportional to $\\epsilon_{cl}\\nabla^2\\phi_0$.\n\nAs time progresses, the system evolves towards a new steady state. In this final state, the same initial charge density $\\rho_0$ is now shielded by the full static dielectric response of the plasma, $\\epsilon_{st}$. This static response includes both the classical polarization and the additional neoclassical polarization arising from the dynamics of trapped ions in the toroidal magnetic field. The problem parameterizes this neoclassical enhancement with the factor $\\Lambda$. The static dielectric constant is thus enhanced by a factor of $(1+\\Lambda)$, so $\\epsilon_{st} = (1+\\Lambda)\\epsilon_{cl}$. The final potential $\\phi_{\\infty}$ is related to the charge $\\rho_0$ by $\\rho_0 \\propto \\epsilon_{st}\\nabla^2\\phi_{\\infty}$.\n\nBy conservation of the polarizing charge, we have:\n$$ \\epsilon_{cl}\\nabla^2\\phi_0 = \\epsilon_{st}\\nabla^2\\phi_{\\infty} = (1+\\Lambda)\\epsilon_{cl}\\nabla^2\\phi_{\\infty} $$\nFor a single radial mode, this simplifies to:\n$$ \\phi_0 = (1+\\Lambda)\\phi_{\\infty} $$\nFrom this, we derive the amplitude of the residual zonal-flow potential:\n$$ \\phi_{\\infty} = \\frac{1}{1+\\Lambda}\\phi_0 $$\n\nNext, we calculate the partitioning of energy. The problem specifies the energy norm to be the $\\mathbf{E}\\times\\mathbf{B}$ kinetic energy density, $W_E$. For a single-$k_r$ perturbation, this energy is proportional to the square of the potential amplitude: $W_E \\propto \\phi^2$. Let the constant of proportionality be $C$.\n\nThe initial energy at $t=0^+$ is associated with the potential $\\phi_0$:\n$$ W_{E,0} = C \\phi_0^2 $$\nThe problem states that there is no initial parallel motion, so this represents the total energy of the system at $t=0^+$.\n\nThe energy remaining in the residual zonal flow in the $t \\rightarrow \\infty$ limit is associated with the potential $\\phi_{\\infty}$:\n$$ W_{E,\\mathrm{res}} = C \\phi_{\\infty}^2 = C \\left(\\frac{1}{1+\\Lambda}\\phi_0\\right)^2 = \\frac{1}{(1+\\Lambda)^2} C \\phi_0^2 $$\n\nThe fraction of the initial energy that remains in the residual zonal flow, $f_{\\mathrm{res}}$, is the ratio of the residual energy to the initial energy:\n$$ f_{\\mathrm{res}} = \\frac{W_{E,\\mathrm{res}}}{W_{E,0}} = \\frac{\\frac{1}{(1+\\Lambda)^2} C \\phi_0^2}{C \\phi_0^2} = \\frac{1}{(1+\\Lambda)^2} $$\n\nThe total energy of the system is conserved. The initial energy $W_{E,0}$ is partitioned between the final, steady residual flow energy $W_{E,\\mathrm{res}}$ and the energy transferred to the oscillatory GAM components, $W_{E,\\mathrm{GAM}}$. Therefore, the energy in the GAM is the difference between the initial energy and the residual energy.\n$$ W_{E,\\mathrm{GAM}} = W_{E,0} - W_{E,\\mathrm{res}} $$\nThe fraction of the initial energy that goes into the GAM, $f_{\\mathrm{GAM}}$, is:\n$$ f_{\\mathrm{GAM}} = \\frac{W_{E,\\mathrm{GAM}}}{W_{E,0}} = \\frac{W_{E,0} - W_{E,\\mathrm{res}}}{W_{E,0}} = 1 - \\frac{W_{E,\\mathrm{res}}}{W_{E,0}} = 1 - f_{\\mathrm{res}} $$\nSubstituting the expression for $f_{\\mathrm{res}}$:\n$$ f_{\\mathrm{GAM}} = 1 - \\frac{1}{(1+\\Lambda)^2} $$\n\nNow, we evaluate these fractions for the given parameters: $q=1.5$, $\\epsilon=0.16$, and $\\alpha=1.6$.\nFirst, we calculate the dimensionless neoclassical polarization parameter $\\Lambda$:\n$$ \\Lambda = \\alpha \\frac{q^2}{\\sqrt{\\epsilon}} = 1.6 \\times \\frac{(1.5)^2}{\\sqrt{0.16}} = 1.6 \\times \\frac{2.25}{0.4} $$\n$$ \\Lambda = 4 \\times 2.25 = 9 $$\nThe value of $\\Lambda$ is exactly $9$.\n\nNow we can calculate the energy fractions:\n$$ f_{\\mathrm{res}} = \\frac{1}{(1+\\Lambda)^2} = \\frac{1}{(1+9)^2} = \\frac{1}{10^2} = \\frac{1}{100} = 0.01 $$\n$$ f_{\\mathrm{GAM}} = 1 - f_{\\mathrm{res}} = 1 - 0.01 = 0.99 $$\n\nThe problem requires the numerical answers to be rounded to four significant figures.\n$$ f_{\\mathrm{res}} = 0.01000 $$\n$$ f_{\\mathrm{GAM}} = 0.9900 $$\n\nThe final answer is the pair $(f_{\\mathrm{res}}, f_{\\mathrm{GAM}})$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.01000 & 0.9900 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Building upon the foundational understanding of the collisionless residual flow , this exercise explores the impact of realistic magnetic geometry. Modern tokamaks utilize shaped cross-sections, such as elongation, to enhance plasma performance. This practice delves into how such shaping modifies the geodesic curvature and, consequently, the neoclassical polarization that determines the residual zonal flow level, bridging the gap between idealized circular models and more realistic fusion-relevant configurations.",
            "id": "3985311",
            "problem": "Consider a large-aspect-ratio axisymmetric tokamak plasma with inverse aspect ratio $\\epsilon = r/R_{0} \\ll 1$, safety factor $q$, and electrostatic perturbations dominated by axisymmetric, poloidally and toroidally symmetric zonal flows. Assume collisionless thermal ions and adiabatic electrons, and take the long-wavelength limit $k_{r}\\rho_{i} \\to 0$, where $\\rho_{i}$ is the ion Larmor radius. Neglect collisions, magnetic shear variation on the flux surface, and any non-axisymmetric shaping.\n\nIn the collisionless limit, the long-time residual of a zonal perturbation of electrostatic potential arises from the balance between $\\mathbf{E}\\times\\mathbf{B}$ zonal flow and the excitation of parallel flows through geodesic curvature, which produces a net polarization that reduces the residual zonal flow potential relative to its initial value. The residual level is defined as the dimensionless ratio $\\gamma \\equiv \\phi(\\infty)/\\phi(0)$, where $\\phi$ is the flux-surface-averaged electrostatic potential. In a circular cross-section equilibrium, the geodesic curvature coupling produces a well-tested large-aspect-ratio collisionless polarization with a known dimensionless coefficient, and the residual level $\\gamma_{\\text{circ}}$ depends on $q$ and $\\epsilon$ accordingly.\n\nNow suppose the same plasma parameters $(q,\\epsilon)$ are realized in a shaped equilibrium whose flux surfaces are elliptical with constant elongation $\\kappa \\geq 1$ and negligible triangularity. Parameterize the poloidal cross-section by $(x,y) = (r\\cos\\theta,\\,\\kappa r\\sin\\theta)$, with $\\theta$ the poloidal angle, so that the poloidal metric factor is $g_{\\theta\\theta}(\\theta) = r^{2}\\left(\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta\\right)$. In the same collisionless, long-wavelength limit, the geodesic curvature drive enters the flux-surface-averaged inertia through a geometric weight proportional to a poloidal-angle average of the form\n$$\n\\left\\langle \\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta} \\right\\rangle \\equiv \\frac{1}{2\\pi}\\int_{0}^{2\\pi}\\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta}\\,\\mathrm{d}\\theta,\n$$\nwhich reduces to $\\left\\langle \\cos^{2}\\theta \\right\\rangle = 1/2$ in the circular limit $\\kappa=1$.\n\nStarting from the fundamental gyrokinetic response in the long-wavelength limit, the quasi-neutrality condition with adiabatic electrons, and flux-surface-averaged momentum conservation, show how the geodesic curvature produces a dimensionless polarization that scales with the above geometric weight, and hence derive the shaped-residual level $\\gamma_{\\text{shape}}$ in terms of the circular-residual level $\\gamma_{\\text{circ}}$ and the elongation $\\kappa$. Use $q$ and $\\epsilon$ explicitly, and parameterize the well-tested circular-case kinetic coefficient as a positive dimensionless constant $C_{0}$ that multiplies $q^{2}/\\sqrt{\\epsilon}$ in the large-aspect-ratio, adiabatic-electron limit.\n\nCompute the closed-form analytic expression for the comparison of residual levels under otherwise identical parameters, specifically the ratio\n$$\n\\frac{\\gamma_{\\text{shape}}}{\\gamma_{\\text{circ}}}\n$$\nas a function of $\\kappa$, $q$, $\\epsilon$, and $C_{0}$. Express your final answer as a single dimensionless analytic expression. No numerical substitution is required, and no rounding is necessary.",
            "solution": "The problem asks for the ratio of the residual zonal flow level in an elliptically shaped tokamak plasma, $\\gamma_{\\text{shape}}$, to that in a circular plasma, $\\gamma_{\\text{circ}}$, under otherwise identical conditions.\n\n### Step 0: Problem Validation\nThe problem statement is first validated against the required criteria.\n\n**Givens:**\n*   Large-aspect-ratio axisymmetric tokamak: $\\epsilon = r/R_{0} \\ll 1$.\n*   Safety factor: $q$.\n*   Perturbations: Axisymmetric zonal flows.\n*   Plasma model: Collisionless thermal ions, adiabatic electrons.\n*   Limit: Long-wavelength, $k_{r}\\rho_{i} \\to 0$.\n*   Neglected effects: Collisions, magnetic shear variation, non-axisymmetric shaping.\n*   Residual level definition: $\\gamma \\equiv \\phi(\\infty)/\\phi(0)$.\n*   Circular case residual: $\\gamma_{\\text{circ}}$.\n*   Shaped equilibrium: Elliptical with elongation $\\kappa \\geq 1$.\n*   Poloidal metric factor: $g_{\\theta\\theta}(\\theta) = r^{2}(\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta)$.\n*   Geometric weight modifying geodesic curvature drive: $\\left\\langle \\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta} \\right\\rangle$.\n*   Circular case kinetic coefficient scales as $C_{0} q^{2}/\\sqrt{\\epsilon}$, where $C_0$ is a positive dimensionless constant.\n*   Objective: Compute the ratio $\\frac{\\gamma_{\\text{shape}}}{\\gamma_{\\text{circ}}}$.\n\n**Validation:**\n1.  **Scientific Grounding**: The problem is well-grounded in the established theory of zonal flows in fusion plasmas, specifically the Rosenbluth-Hinton residual flow mechanism. The model simplifications (large aspect ratio, collisionless, adiabatic electrons) are standard in theoretical plasma physics.\n2.  **Well-Posedness**: The problem is well-posed. It provides clear definitions, specifies the exact mathematical form of the geometric modification due to shaping, and requests a uniquely defined analytical expression.\n3.  **Objectivity**: The language is precise, technical, and free of subjective elements.\n\n**Verdict:** The problem is deemed valid. A solution will be formulated.\n\n### Step 1: Fundamental Principle of Residual Zonal Flow\nIn the collisionless, long-wavelength limit, the residual level of a zonal flow potential perturbation, $\\gamma = \\phi(\\infty)/\\phi(0)$, is determined by the plasma's polarization response. The final potential is shielded by the polarization charge that develops in response to the initial potential. The relationship is given by:\n$$\n\\gamma = \\frac{1}{1 + \\mathcal{P}}\n$$\nwhere $\\mathcal{P}$ is a dimensionless coefficient representing the enhancement of the polarization beyond the classical vacuum capacitance. This polarization arises from the geodesic curvature of the magnetic field lines coupling the zonal $\\mathbf{E}\\times\\mathbf{B}$ drift to parallel ion flows.\n\n### Step 2: Polarization in Circular and Shaped Geometries\nFor a circular cross-section tokamak, the problem states that the polarization factor, which we denote $\\mathcal{P}_{\\text{circ}}$, is given by the well-tested scaling:\n$$\n\\mathcal{P}_{\\text{circ}} = C_{0} \\frac{q^{2}}{\\sqrt{\\epsilon}}\n$$\nwhere $C_{0}$ is a given dimensionless kinetic coefficient. The residual level in the circular case is therefore:\n$$\n\\gamma_{\\text{circ}} = \\frac{1}{1 + \\mathcal{P}_{\\text{circ}}} = \\frac{1}{1 + C_{0} \\frac{q^{2}}{\\sqrt{\\epsilon}}}\n$$\nThe problem states that in a shaped plasma, the geodesic curvature drive, and thus the polarization, is modified by a geometric weight. This implies that the polarization factor is directly proportional to this weight. Let us define the geometric weight as $W(\\kappa)$:\n$$\nW(\\kappa) \\equiv \\left\\langle \\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta} \\right\\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi}\\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta}\\,\\mathrm{d}\\theta\n$$\nThe polarization factor for any elongation $\\kappa$ can be written as $\\mathcal{P}(\\kappa) = K \\cdot W(\\kappa)$, where $K$ is a constant of proportionality that contains all other physical parameters.\nFor the circular case, $\\kappa=1$, the weight is:\n$$\nW(1) = \\frac{1}{2\\pi}\\int_{0}^{2\\pi}\\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\sin^{2}\\theta}\\,\\mathrm{d}\\theta = \\frac{1}{2\\pi}\\int_{0}^{2\\pi}\\cos^{2}\\theta\\,\\mathrm{d}\\theta = \\frac{1}{2\\pi}\\left[\\frac{\\theta}{2} + \\frac{\\sin(2\\theta)}{4}\\right]_{0}^{2\\pi} = \\frac{1}{2}\n$$\nSo, $\\mathcal{P}_{\\text{circ}} = \\mathcal{P}(1) = K \\cdot W(1) = K/2$. This allows us to determine $K = 2\\mathcal{P}_{\\text{circ}}$.\nThe polarization factor for the shaped case, $\\mathcal{P}_{\\text{shape}}$, is then given by:\n$$\n\\mathcal{P}_{\\text{shape}} = \\mathcal{P}(\\kappa) = K \\cdot W(\\kappa) = (2\\mathcal{P}_{\\text{circ}}) \\cdot W(\\kappa)\n$$\n\n### Step 3: Calculation of the Geometric Weight $W(\\kappa)$\nTo proceed, we must evaluate the integral for $W(\\kappa)$. The integrand is symmetric, so we can change the integration limits.\n$$\nW(\\kappa) = \\frac{4}{2\\pi}\\int_{0}^{\\pi/2}\\frac{\\cos^{2}\\theta}{\\cos^{2}\\theta + \\kappa^{2}\\sin^{2}\\theta}\\,\\mathrm{d}\\theta = \\frac{2}{\\pi}\\int_{0}^{\\pi/2}\\frac{1}{1 + \\kappa^{2}\\tan^{2}\\theta}\\,\\mathrm{d}\\theta\n$$\nWe use the substitution $u = \\tan\\theta$, for which $\\mathrm{d}u = \\sec^{2}\\theta\\,\\mathrm{d}\\theta = (1+\\tan^{2}\\theta)\\,\\mathrm{d}\\theta$, so $\\mathrm{d}\\theta = \\frac{\\mathrm{d}u}{1+u^{2}}$. The limits of integration become $0$ to $\\infty$.\n$$\nW(\\kappa) = \\frac{2}{\\pi}\\int_{0}^{\\infty}\\frac{1}{1 + \\kappa^{2}u^{2}} \\frac{\\mathrm{d}u}{1+u^{2}}\n$$\nWe solve this integral using partial fraction decomposition for the integrand:\n$$\n\\frac{1}{(1+u^{2})(1+\\kappa^{2}u^{2})} = \\frac{A}{1+u^{2}} + \\frac{B}{1+\\kappa^{2}u^{2}}\n$$\nSolving for $A$ and $B$ (assuming $\\kappa^2 \\neq 1$) yields:\n$$\nA = \\frac{1}{1-\\kappa^{2}}, \\quad B = \\frac{\\kappa^{2}}{\\kappa^{2}-1}\n$$\nThe integral becomes:\n$$\n\\int_{0}^{\\infty} \\left( \\frac{1}{1-\\kappa^{2}}\\frac{1}{1+u^{2}} + \\frac{\\kappa^{2}}{\\kappa^{2}-1}\\frac{1}{1+\\kappa^{2}u^{2}} \\right) \\mathrm{d}u = \\frac{1}{\\kappa^{2}-1} \\int_{0}^{\\infty} \\left( \\frac{\\kappa^{2}}{1+(\\kappa u)^{2}} - \\frac{1}{1+u^{2}} \\right) \\mathrm{d}u\n$$\nUsing the standard result $\\int_{0}^{\\infty}\\frac{\\mathrm{d}x}{1+a^{2}x^{2}} = \\frac{\\pi}{2a}$:\n$$\n= \\frac{1}{\\kappa^{2}-1} \\left( \\kappa^{2}\\frac{\\pi}{2\\kappa} - \\frac{\\pi}{2} \\right) = \\frac{1}{\\kappa^{2}-1} \\left( \\frac{\\kappa\\pi}{2} - \\frac{\\pi}{2} \\right) = \\frac{\\pi}{2}\\frac{\\kappa-1}{(\\kappa-1)(\\kappa+1)} = \\frac{\\pi}{2(\\kappa+1)}\n$$\nSubstituting this back into the expression for $W(\\kappa)$:\n$$\nW(\\kappa) = \\frac{2}{\\pi} \\left( \\frac{\\pi}{2(\\kappa+1)} \\right) = \\frac{1}{\\kappa+1}\n$$\nThis result also correctly reproduces $W(1) = 1/2$.\n\n### Step 4: Derivation of the Ratio $\\gamma_{\\text{shape}}/\\gamma_{\\text{circ}}$\nNow we can express $\\mathcal{P}_{\\text{shape}}$ in terms of $\\mathcal{P}_{\\text{circ}}$ and $\\kappa$:\n$$\n\\mathcal{P}_{\\text{shape}} = (2\\mathcal{P}_{\\text{circ}}) \\cdot W(\\kappa) = (2\\mathcal{P}_{\\text{circ}}) \\left(\\frac{1}{\\kappa+1}\\right) = \\frac{2}{\\kappa+1}\\mathcal{P}_{\\text{circ}}\n$$\nThe residual level for the shaped case is:\n$$\n\\gamma_{\\text{shape}} = \\frac{1}{1 + \\mathcal{P}_{\\text{shape}}} = \\frac{1}{1 + \\frac{2}{\\kappa+1}\\mathcal{P}_{\\text{circ}}}\n$$\nThe desired ratio is $\\gamma_{\\text{shape}}/\\gamma_{\\text{circ}}$:\n$$\n\\frac{\\gamma_{\\text{shape}}}{\\gamma_{\\text{circ}}} = \\frac{1/(1 + \\mathcal{P}_{\\text{shape}})}{1/(1 + \\mathcal{P}_{\\text{circ}})} = \\frac{1 + \\mathcal{P}_{\\text{circ}}}{1 + \\mathcal{P}_{\\text{shape}}} = \\frac{1 + \\mathcal{P}_{\\text{circ}}}{1 + \\frac{2}{\\kappa+1}\\mathcal{P}_{\\text{circ}}}\n$$\nFinally, we substitute the explicit expression for $\\mathcal{P}_{\\text{circ}}$:\n$$\n\\frac{\\gamma_{\\text{shape}}}{\\gamma_{\\text{circ}}} = \\frac{1 + C_{0}\\frac{q^{2}}{\\sqrt{\\epsilon}}}{1 + \\frac{2}{\\kappa+1} C_{0}\\frac{q^{2}}{\\sqrt{\\epsilon}}}\n$$\nThis expression provides the ratio of the residual zonal flow levels as a function of the elongation $\\kappa$ and the other fundamental plasma parameters $q$, $\\epsilon$, and $C_0$. As a check, in the circular limit $\\kappa \\to 1$, the ratio becomes $1$, as expected.\n$$\n\\lim_{\\kappa \\to 1} \\frac{\\gamma_{\\text{shape}}}{\\gamma_{\\text{circ}}} = \\frac{1 + C_{0}\\frac{q^{2}}{\\sqrt{\\epsilon}}}{1 + \\frac{2}{1+1} C_{0}\\frac{q^{2}}{\\sqrt{\\epsilon}}} = 1\n$$",
            "answer": "$$\\boxed{\\frac{1 + C_{0}\\frac{q^{2}}{\\sqrt{\\epsilon}}}{1 + \\frac{2C_{0}q^{2}}{(\\kappa+1)\\sqrt{\\epsilon}}}}$$"
        },
        {
            "introduction": "Having analytically derived the properties of the residual zonal flow in both simple and shaped geometries  , we now turn to the practical challenge of its measurement. In both simulations and experiments, the residual flow signal is mixed with transient oscillations, drifts, and noise. This computational exercise tasks you with designing and implementing a robust numerical diagnostic to extract the Rosenbluth-Hinton residual from a synthetic time series, developing essential skills in signal processing and data analysis that are critical for modern fusion research.",
            "id": "3985290",
            "problem": "Design a self-contained numerical experiment that measures the Rosenbluth–Hinton residual (RH residual) from a synthetic gyrokinetic diagnostic of zonal-flow relaxation in the presence of a Geodesic Acoustic Mode (GAM). The Rosenbluth–Hinton residual is the finite, collisionless long-time remainder of the zonal-flow-associated flux-surface-averaged electrostatic potential after the transient oscillatory GAM response has phase-mixed away. The synthetic diagnostic emulates the time history of the flux-surface average of the electrostatic potential, constructed to reflect fundamental gyrokinetic behavior without requiring an actual gyrokinetic solver.\n\nBegin from the following foundational principles:\n- The collisionless, linear, axisymmetric gyrokinetic response for a zonal perturbation separates into an oscillatory component at the geodesic acoustic mode frequency and a non-oscillatory component associated with the residual zonal flow. Mathematically, the diagnostic signal may be idealized as the sum of a constant offset representing the residual, a damped oscillation at the geodesic acoustic mode frequency, and small auxiliary terms (e.g., numerical drift and noise).\n- A frequency-domain filter can remove the GAM band from the signal without distorting the constant residual offset, provided that the filter is applied in a non-causal, zero-phase manner.\n\nThe synthetic signal to be analyzed is defined, for time $t \\in [0, T)$, as\n$$\n\\phi(t) = \\phi_0 \\left[ R + (1 - R) \\exp(-\\alpha t) \\cos(\\omega_G t) \\right] + \\phi_0 \\, d \\, \\frac{t}{T} + \\phi_0 \\, r_{\\mathrm{noise}} \\left[ \\tfrac{1}{2} \\sin(2\\pi f_{n1} t) + \\tfrac{1}{2} \\sin(2\\pi f_{n2} t) \\right],\n$$\nwhere $R$ is the true residual fraction to be measured, $\\phi_0$ is the initial electrostatic potential amplitude, $\\alpha$ is a damping rate, $\\omega_G$ is the geodesic acoustic mode angular frequency, $d$ is a dimensionless linear drift fraction over the interval $[0, T)$, $r_{\\mathrm{noise}}$ is a dimensionless noise amplitude fraction, and $f_{n1}$ and $f_{n2}$ are deterministic noise frequencies chosen as fixed fractions of the sampling rate. The measurement objective is to estimate the dimensionless residual fraction $R$ from $\\phi(t)$ using a filter-based diagnostic and to check convergence of the measurement with respect to time resolution and filter bandwidth.\n\nYou must implement the following measurement procedure:\n- Sampling and units:\n  - Generate the discrete time series with uniform sampling at frequency $f_s$ (in $\\mathrm{Hz}$), over total duration $T$ (in $\\mathrm{s}$). Use angles in radians and angular frequencies in $\\mathrm{rad/s}$. The final residual fraction must be dimensionless.\n  - Define the two deterministic noise frequencies as $f_{n1} = 0.12 f_s$ and $f_{n2} = 0.20 f_s$, in $\\mathrm{Hz}$, to ensure reproducibility across sampling rates.\n- Filter design:\n  - Compute the geodesic acoustic mode linear frequency $f_0 = \\omega_G/(2\\pi)$ in $\\mathrm{Hz}$, and the Nyquist frequency $f_N = f_s/2$ in $\\mathrm{Hz}$.\n  - Design a Butterworth band-stop (notch) filter of order $n$ with lower and upper normalized cutoffs\n    $$\n    w_1 = \\frac{(1 - \\beta) f_0}{f_N}, \\quad w_2 = \\frac{(1 + \\beta) f_0}{f_N},\n    $$\n    clipped to the open interval $(0, 1)$ so the filter is well-defined. Apply the filter bidirectionally (forward-backward) to achieve zero phase shift.\n- Residual estimation and stationarity:\n  - After filtering, compute the residual estimate $\\widehat{R}$ as the mean over the last window of duration $T_{\\mathrm{win}}$ seconds:\n    $$\n    \\widehat{R} = \\frac{1}{\\phi_0} \\, \\frac{1}{|\\mathcal{I}|} \\sum_{t_i \\in \\mathcal{I}} \\phi_{\\mathrm{filt}}(t_i), \\quad \\mathcal{I} = \\{ t_i \\mid t_i \\in [T - T_{\\mathrm{win}}, T) \\},\n    $$\n    where $\\phi_{\\mathrm{filt}}(t)$ is the filtered signal and $|\\mathcal{I}|$ is the number of samples in the window.\n  - Assess stationarity of the residual within the window by fitting a line to $\\phi_{\\mathrm{filt}}(t)$ over $[T - T_{\\mathrm{win}}, T)$ and computing the slope $s$ (in $\\mathrm{V/s}$). Define the dimensionless slope ratio\n    $$\n    \\rho_s = \\frac{|s|}{\\phi_0 / T_{\\mathrm{win}}}.\n    $$\n    If $\\rho_s \\ge \\epsilon_s$, iteratively reduce $T_{\\mathrm{win}}$ by a factor of $2$ (down to a minimum of $0.05 T$), refilter if needed, and recompute until $\\rho_s < \\epsilon_s$ or the minimum window is reached. Use $\\epsilon_s$ as a dimensionless threshold.\n- Convergence checks:\n  - Time-resolution convergence: recompute $\\widehat{R}$ with doubled sampling rate $2 f_s$ (keeping $T$ and all other physical parameters the same), and declare convergence if\n    $$\n    \\left| \\widehat{R}(2 f_s) - \\widehat{R}(f_s) \\right| < \\tau_{\\mathrm{time}},\n    $$\n    where $\\tau_{\\mathrm{time}}$ is a dimensionless tolerance.\n  - Filter-bandwidth convergence: recompute $\\widehat{R}$ with a second band parameter $\\beta_2$ (keeping the original sampling rate $f_s$) and declare convergence if\n    $$\n    \\left| \\widehat{R}(\\beta_2) - \\widehat{R}(\\beta_1) \\right| < \\tau_{\\mathrm{band}},\n    $$\n    where $\\beta_1$ is the primary band parameter, and $\\tau_{\\mathrm{band}}$ is a dimensionless tolerance.\n\nImplement the above as a single, complete program that constructs the synthetic signal, performs the filtering and residual estimation, and outputs, for each test case, a list containing the estimated residual fraction and two booleans indicating the results of the time-resolution and filter-bandwidth convergence checks, respectively.\n\nUse the following test suite of parameter sets. For each test case, the parameters are $(\\phi_0, \\, \\omega_G, \\, \\alpha, \\, R, \\, r_{\\mathrm{noise}}, \\, f_s, \\, T, \\, d)$, with fixed filter and convergence control parameters $n = 4$, $\\beta_1 = 0.15$, $\\beta_2 = 0.25$, $T_{\\mathrm{win}} = 0.25 T$, $\\epsilon_s = 0.02$, $\\tau_{\\mathrm{time}} = 10^{-3}$, and $\\tau_{\\mathrm{band}} = 2 \\times 10^{-3}$:\n- Test case $1$: $(1.0, \\, 60000, \\, 50, \\, 0.6, \\, 0.01, \\, 200000, \\, 0.2, \\, 0.005)$.\n- Test case $2$: $(1.0, \\, 40000, \\, 5, \\, 0.3, \\, 0.05, \\, 100000, \\, 0.4, \\, 0.01)$.\n- Test case $3$: $(0.5, \\, 80000, \\, 50, \\, 0.8, \\, 0.0, \\, 150000, \\, 0.2, \\, 0.0)$.\n- Test case $4$: $(2.0, \\, 30000, \\, 20, \\, 0.5, \\, 0.2, \\, 100000, \\, 0.3, \\, 0.02)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the form $[\\widehat{R}, \\mathrm{time\\_conv}, \\mathrm{band\\_conv}]$, with $\\widehat{R}$ a floating-point number and the two convergence indicators as booleans. For example, the output format should be\n$$\n\\texttt{[[r1,True,False],[r2,True,True],[r3,False,True],[r4,True,True]]}.\n$$\nAll physical units must be respected as specified, frequencies expressed in $\\mathrm{rad/s}$ for $\\omega_G$ and in $\\mathrm{Hz}$ for $f_s$, times in $\\mathrm{s}$, and angles in radians. The residual fraction is dimensionless. No user input is permitted; all parameters are hard-coded as shown above.",
            "solution": "The problem requires the design and implementation of a numerical experiment to measure the Rosenbluth–Hinton (RH) residual from a synthetic diagnostic signal representing zonal-flow relaxation in the presence of a Geodesic Acoustic Mode (GAM). The procedure is validated as scientifically sound, well-posed, and objective. It constitutes a well-defined computational task based on established principles of plasma physics and digital signal processing. We proceed with a detailed description of the solution methodology, which will be implemented as a self-contained program.\n\nThe core of the methodology is to isolate the constant (DC) component of a time-series signal, which represents the RH residual, by filtering out the primary oscillatory component, the GAM. The process involves four main stages: (1) generation of the synthetic signal, (2) design and application of a digital filter, (3) estimation of the residual from the filtered signal, including a check for stationarity, and (4) performing convergence studies with respect to time resolution and filter bandwidth.\n\nFirst, a synthetic diagnostic signal $\\phi(t)$ is generated over a time interval $t \\in [0, T)$. This signal is defined by the equation:\n$$\n\\phi(t) = \\phi_0 \\left[ R + (1 - R) \\exp(-\\alpha t) \\cos(\\omega_G t) \\right] + \\phi_0 \\, d \\, \\frac{t}{T} + \\phi_0 \\, r_{\\mathrm{noise}} \\left[ \\tfrac{1}{2} \\sin(2\\pi f_{n1} t) + \\tfrac{1}{2} \\sin(2\\pi f_{n2} t) \\right]\n$$\nHere, $\\phi_0$ is the initial potential amplitude, $R$ is the true dimensionless residual fraction, $\\alpha$ is the damping rate of the GAM, $\\omega_G$ is the GAM angular frequency, $d$ is a linear drift coefficient, and $r_{\\mathrm{noise}}$ controls the amplitude of two deterministic, high-frequency noise terms at frequencies $f_{n1}$ and $f_{n2}$. For the numerical implementation, this continuous signal is discretized into a time series with a uniform sampling frequency $f_s$, resulting in a set of points $\\phi(t_i)$ where $t_i$ are the discrete time steps. The noise frequencies are defined relative to the sampling rate as $f_{n1} = 0.12 f_s$ and $f_{n2} = 0.20 f_s$ to ensure their spectral location is consistent across different time resolutions.\n\nSecond, a digital filter is employed to remove the GAM oscillation from the signal. The GAM's linear frequency is $f_0 = \\omega_G / (2\\pi)$. A Butterworth band-stop (or \"notch\") filter is chosen for this purpose due to its maximally flat passband response. The filter is of order $n$. Its stopband is centered around $f_0$ with a relative width controlled by the parameter $\\beta$. The lower and upper cutoff frequencies of the stopband, normalized to the Nyquist frequency $f_N = f_s/2$, are given by:\n$$\nw_1 = \\frac{(1 - \\beta) f_0}{f_N}, \\quad w_2 = \\frac{(1 + \\beta) f_0}{f_N}\n$$\nThese normalized frequencies must lie in the open interval $(0, 1)$ for the filter to be well-defined, and are numerically clipped to a small distance from the boundaries if necessary. To prevent introducing phase distortion that could corrupt the time-domain features of the signal, the filter is applied in a forward-backward pass using a zero-phase filtering technique. This non-causal filtering effectively removes the frequency components within the stopband without shifting the remaining components in time. The output of this step is the filtered signal, $\\phi_{\\mathrm{filt}}(t)$.\n\nThird, the residual fraction $\\widehat{R}$ is estimated from the filtered signal. The theoretical residual is the non-oscillatory, long-time limit of the potential. We estimate this by averaging $\\phi_{\\mathrm{filt}}(t)$ over a time window at the end of the simulation, from $t=T-T_{\\mathrm{win}}$ to $t=T$. The estimated residual fraction is calculated as:\n$$\n\\widehat{R} = \\frac{1}{\\phi_0} \\, \\frac{1}{|\\mathcal{I}|} \\sum_{t_i \\in \\mathcal{I}} \\phi_{\\mathrm{filt}}(t_i), \\quad \\text{where } \\mathcal{I} = \\{ t_i \\mid t_i \\in [T - T_{\\mathrm{win}}, T) \\}\n$$\nA critical aspect of this estimation is ensuring that the signal within the averaging window is sufficiently stationary (i.e., constant). Any residual slope could indicate incomplete damping of the GAM transient or the influence of the linear drift term. Stationarity is assessed by fitting a linear function to $\\phi_{\\mathrm{filt}}(t)$ within the window $[T-T_{\\mathrm{win}}, T)$ to obtain its slope, $s$. A dimensionless slope ratio, $\\rho_s$, is computed:\n$$\n\\rho_s = \\frac{|s|}{\\phi_0 / T_{\\mathrm{win}}}\n$$\nIf $\\rho_s$ is greater than or equal to a prescribed tolerance $\\epsilon_s$, the window duration $T_{\\mathrm{win}}$ is deemed too long and is iteratively halved. This process continues until either $\\rho_s < \\epsilon_s$ or $T_{\\mathrm{win}}$ reaches a specified minimum size (here, $0.05 T$). The filtering step is performed once on the full signal; the stationarity check concerns only the post-processing of the filtered data.\n\nFourth, two convergence checks are performed to validate the numerical robustness of the measurement.\nThe time-resolution convergence check assesses the sensitivity of $\\widehat{R}$ to the sampling rate $f_s$. The entire calculation is repeated with a doubled sampling rate, $2f_s$, while keeping all other physical parameters constant. The measurement is considered converged if the absolute difference between the new estimate, $\\widehat{R}(2f_s)$, and the original estimate, $\\widehat{R}(f_s)$, is below a tolerance $\\tau_{\\mathrm{time}}$: $|\\widehat{R}(2f_s) - \\widehat{R}(f_s)| < \\tau_{\\mathrm{time}}$.\nThe filter-bandwidth convergence check assesses the sensitivity to the filter's stopband width. The calculation is repeated using the original sampling rate $f_s$ but with a different bandwidth parameter, $\\beta_2$. Convergence is declared if the absolute difference between the estimate with the new bandwidth, $\\widehat{R}(\\beta_2)$, and the original one, $\\widehat{R}(\\beta_1)$, is below a tolerance $\\tau_{\\mathrm{band}}$: $|\\widehat{R}(\\beta_2) - \\widehat{R}(\\beta_1)| < \\tau_{\\mathrm{band}}$.\n\nThe final program implements this entire procedure, iterating through a suite of test cases. For each case, it computes the primary residual estimate $\\widehat{R}$ and the two boolean convergence indicators, outputting the results in the specified list format.",
            "answer": "```python\nimport numpy as np\nfrom scipy import signal\n\ndef calculate_residual(params, fs_override=None, beta_override=None):\n    \"\"\"\n    Calculates the RH residual for a single parameter configuration.\n    \"\"\"\n    # Unpack parameters\n    phi0, omega_G, alpha, R, r_noise, fs_base, T, d = params\n    \n    # Fixed analysis parameters\n    n = 4\n    beta1 = 0.15\n    T_win_initial_frac = 0.25\n    T_win_min_frac = 0.05\n    eps_s = 0.02\n\n    # Apply overrides for convergence checks\n    fs = fs_override if fs_override is not None else fs_base\n    beta = beta_override if beta_override is not None else beta1\n\n    # 1. Generate Signal\n    num_points = int(T * fs)\n    t = np.linspace(0, T, num_points, endpoint=False)\n    \n    # GAM frequency in Hz\n    f0 = omega_G / (2.0 * np.pi)\n    \n    # Noise frequencies\n    f_n1 = 0.12 * fs\n    f_n2 = 0.20 * fs\n    \n    # Synthetic signal formula\n    gam_component = phi0 * (1 - R) * np.exp(-alpha * t) * np.cos(omega_G * t)\n    residual_component = phi0 * R\n    drift_component = phi0 * d * (t / T)\n    noise_component = phi0 * r_noise * (0.5 * np.sin(2 * np.pi * f_n1 * t) + 0.5 * np.sin(2 * np.pi * f_n2 * t))\n    \n    phi_t = residual_component + gam_component + drift_component + noise_component\n\n    # 2. Design and Apply Filter\n    f_nyquist = 0.5 * fs\n    \n    # Normalized cutoff frequencies, clipped to (0, 1)\n    w1 = (1 - beta) * f0 / f_nyquist\n    w2 = (1 + beta) * f0 / f_nyquist\n    w1 = max(1e-9, w1)\n    w2 = min(1.0 - 1e-9, w2)\n    \n    # Design Butterworth band-stop filter using second-order sections for stability\n    sos = signal.butter(n, [w1, w2], btype='bandstop', output='sos')\n    \n    # Apply zero-phase filter\n    phi_filt = signal.sosfiltfilt(sos, phi_t)\n\n    # 3. Stationarity Check and Residual Estimation loop\n    current_T_win = T * T_win_initial_frac\n    min_T_win = T * T_win_min_frac\n\n    while True:\n        win_samples = int(current_T_win * fs)\n        if win_samples < 2: # Need at least 2 points for a line fit\n            break\n\n        t_window = t[-win_samples:]\n        phi_window = phi_filt[-win_samples:]\n        \n        # Fit a line to the data in the window\n        slope, _ = np.polyfit(t_window, phi_window, 1)\n\n        # Dimensionless slope ratio\n        rho_s = abs(slope) / (phi0 / current_T_win)\n\n        if rho_s < eps_s:\n            break\n        \n        if (current_T_win / 2.0) < min_T_win:\n            break\n        \n        current_T_win /= 2.0\n\n    # 4. Final Residual Calculation\n    final_win_samples = int(current_T_win * fs)\n    final_phi_window = phi_filt[-final_win_samples:]\n    \n    R_hat = np.mean(final_phi_window) / phi0\n    \n    return R_hat\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test cases: (phi0, omega_G, alpha, R, r_noise, fs, T, d)\n    test_cases = [\n        (1.0, 60000, 50, 0.6, 0.01, 200000, 0.2, 0.005),\n        (1.0, 40000, 5, 0.3, 0.05, 100000, 0.4, 0.01),\n        (0.5, 80000, 50, 0.8, 0.0, 150000, 0.2, 0.0),\n        (2.0, 30000, 20, 0.5, 0.2, 100000, 0.3, 0.02),\n    ]\n\n    # Convergence parameters\n    beta2 = 0.25\n    tau_time = 1e-3\n    tau_band = 2e-3\n\n    results = []\n    for params in test_cases:\n        fs_base = params[5]\n\n        # Base calculation\n        R_hat_base = calculate_residual(params)\n        \n        # Time-resolution convergence check\n        R_hat_time_conv = calculate_residual(params, fs_override=2 * fs_base)\n        time_conv = abs(R_hat_time_conv - R_hat_base) < tau_time\n\n        # Filter-bandwidth convergence check\n        R_hat_band_conv = calculate_residual(params, beta_override=beta2)\n        band_conv = abs(R_hat_band_conv - R_hat_base) < tau_band\n\n        results.append([R_hat_base, time_conv, band_conv])\n\n    # Format the output as specified\n    # Using map(str, ...) on the list of lists correctly formats each inner list\n    # e.g., str([0.6, True, False]) -> '[0.6, True, False]'\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}