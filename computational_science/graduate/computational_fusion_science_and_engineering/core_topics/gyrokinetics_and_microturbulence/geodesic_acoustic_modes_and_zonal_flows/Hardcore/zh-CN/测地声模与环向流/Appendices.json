{
    "hands_on_practices": [
        {
            "introduction": "带状流在聚变等离子体中对约束湍流起着至关重要的作用。本练习将探讨“剪切去相关”这一核心机制，即带状流的速度剪切能够撕裂和抑制湍流涡旋。通过推导抑制湍流不稳定性所需的阈值剪切率，您将对这一基本调控过程建立一个定量的物理图像。",
            "id": "3985283",
            "problem": "在一个环形等离子体中，考虑离子温度梯度（ITG）漂移波湍流与轴对称纬向流（极向模数和环向模数均为零）相互作用，这些纬向流可包含测地声模（GAM）分量。假设单个漂移波包具有局域程函表示，其径向波数为 $k_x(t)$，极向波数为 $k_y$。设背景电场叉磁场（E×B）流具有恒定的径向剪切率 $\\gamma_E$，使得波矢根据k空间平流定律 $\\mathrm{d}k_x/\\mathrm{d}t = k_y \\gamma_E$ 演化。在 $k_x = 0$ 附近，将未剪切的线性ITG增长率建模为一个常数 $\\gamma_L > 0$。\n\n采用 $k_x$ 剪切退相干模型，在该模型中，当 $k_x$ 扫过其内禀谱宽 $\\Delta k_x$ 时，波包发生退相干，从而产生一个由 $\\gamma_{\\mathrm{sh}} \\doteq |(\\mathrm{d}k_x/\\mathrm{d}t)| / \\Delta k_x$ 定义的退相干率。对于具有漂移波湍流典型的各向异性谱的ITG波包，取 $\\Delta k_x \\sim |k_y|$，因此退相干是由剪切引起的 $k_x$ 扫过其自身径向谱支撑区而产生的。在早期线性阶段，设涨落振幅 $A(t)$ 遵循线性驱动与退相干之间的竞争关系，\n$$\n\\frac{\\mathrm{d}A}{\\mathrm{d}t} = \\left(\\gamma_L - \\gamma_{\\mathrm{sh}}\\right) A，\n$$\n其中 $\\gamma_{\\mathrm{sh}}$ 由上述 $k_x$ 的剪切确定。\n\n从这些原理出发，推导将有效线性ITG增长率降低一半所需的阈值纬向流剪切率 $\\gamma_E$。将最终答案表示为关于 $\\gamma_L$ 的单个闭式解析表达式。在你的推理中，$\\gamma_E$ 的单位使用 $\\mathrm{s}^{-1}$。无需进行数值计算。",
            "solution": "问题要求推导阈值纬向流剪切率 $\\gamma_E$，该剪切率将有效线性离子温度梯度（ITG）增长率降低一半。我们首先分析给定模型中涨落振幅 $A(t)$ 的演化。\n\n涨落振幅的演化由以下常微分方程描述：\n$$\n\\frac{\\mathrm{d}A}{\\mathrm{d}t} = \\left(\\gamma_L - \\gamma_{\\mathrm{sh}}\\right) A\n$$\n从该方程可知，有效增长率（我们记为 $\\gamma_{\\mathrm{eff}}$）是括号中的项，它决定了振幅的指数增长或衰减。因此，我们有：\n$$\n\\gamma_{\\mathrm{eff}} = \\gamma_L - \\gamma_{\\mathrm{sh}}\n$$\n此处，$\\gamma_L$ 是恒定的、未剪切的线性ITG增长率，$\\gamma_{\\mathrm{sh}}$ 是剪切退相干率。所有率，包括 $\\gamma_L$、$\\gamma_{\\mathrm{sh}}$ 和 $\\gamma_E$，都以秒的倒数 $\\mathrm{s}^{-1}$ 为单位。\n\n问题指定了有效增长率降低一半的条件。这个降低是相对于没有抑制机制（即剪切流）时的增长率而言的。在没有剪切的情况下，剪切率 $\\gamma_E = 0$。这意味着径向波数的平流为零，$\\mathrm{d}k_x/\\mathrm{d}t = 0$，导致退相干率 $\\gamma_{\\mathrm{sh}} = 0$。在这种基准情况下，有效增长率就是 $\\gamma_{\\mathrm{eff}} = \\gamma_L$。\n\n因此，阈值剪切率的条件是新的有效增长率为该基准率的一半：\n$$\n\\gamma_{\\mathrm{eff}} = \\frac{1}{2} \\gamma_L\n$$\n将 $\\gamma_{\\mathrm{eff}}$ 的表达式代入此条件，我们得到：\n$$\n\\gamma_L - \\gamma_{\\mathrm{sh}} = \\frac{1}{2} \\gamma_L\n$$\n解出所需的退相干率 $\\gamma_{\\mathrm{sh}}$，得到：\n$$\n\\gamma_{\\mathrm{sh}} = \\gamma_L - \\frac{1}{2} \\gamma_L = \\frac{1}{2} \\gamma_L\n$$\n接下来，我们必须将退相干率 $\\gamma_{\\mathrm{sh}}$ 与纬向流剪切率 $\\gamma_E$ 联系起来。问题给出了剪切退相干率的定义为：\n$$\n\\gamma_{\\mathrm{sh}} \\doteq \\frac{|\\frac{\\mathrm{d}k_x}{\\mathrm{d}t}|}{\\Delta k_x}\n$$\n我们还已知径向波数 $k_x$ 的k空间平流定律：\n$$\n\\frac{\\mathrm{d}k_x}{\\mathrm{d}t} = k_y \\gamma_E\n$$\n其中 $k_y$ 是极向波数，$\\gamma_E$ 是E×B流的恒定径向剪切率。\n\n此外，模型指定ITG波包的内禀谱宽 $\\Delta k_x$ 与极向波数 $|k_y|$ 同量级。根据问题的表述，我们将其视为等式：\n$$\n\\Delta k_x = |k_y|\n$$\n将 $\\mathrm{d}k_x/\\mathrm{d}t$ 和 $\\Delta k_x$ 的表达式代入 $\\gamma_{\\mathrm{sh}}$ 的定义中，我们发现：\n$$\n\\gamma_{\\mathrm{sh}} = \\frac{|k_y \\gamma_E|}{|k_y|} = \\frac{|k_y| |\\gamma_E|}{|k_y|}\n$$\n对于漂移波，极向波数 $k_y$ 必须非零，因此我们可以通过约去分子和分母中的 $|k_y|$ 来简化表达式：\n$$\n\\gamma_{\\mathrm{sh}} = |\\gamma_E|\n$$\n由于 $\\gamma_E$ 代表一个剪切率，物理上它被认为是一个非负量。因此，我们可以写成 $|\\gamma_E| = \\gamma_E$。所以退相干率等于纬向流剪切率：\n$$\n\\gamma_{\\mathrm{sh}} = \\gamma_E\n$$\n这个结果展示了该剪切模型的一个关键特征：退相干率与湍流涡旋的具体波数无关，仅取决于背景流剪切。\n\n最后，为了求得阈值剪切率 $\\gamma_E$，我们令我们得到的两个 $\\gamma_{\\mathrm{sh}}$ 表达式相等。我们发现所需的退相干率为 $\\gamma_{\\mathrm{sh}} = \\frac{1}{2} \\gamma_L$，并且该率等于流剪切率 $\\gamma_{\\mathrm{sh}} = \\gamma_E$。因此，阈值剪切率为：\n$$\n\\gamma_E = \\frac{1}{2} \\gamma_L\n$$\n这是将有效线性ITG增长率降低一半所需的阈值纬向流剪切率 $\\gamma_E$ 的闭式解析表达式，用未剪切的增长率 $\\gamma_L$ 表示。",
            "answer": "$$\\boxed{\\frac{1}{2}\\gamma_L}$$"
        },
        {
            "introduction": "理解了带状流的重要性之后，我们转向其自身的动力学行为。在托卡马克环形几何中，一个初始的带状流扰动并不会简单地保持不变，而是会分裂成一个稳态的、长期存在的“剩余”带状流（即Rosenbluth-Hinton剩余流）和一个振荡分量，即测地声学模（GAM）。本练习将运用动理学理论，具体计算初始能量如何在这两个关键分量之间进行分配，从而加深对带状流物理核心概念的理解。",
            "id": "3984894",
            "problem": "考虑一个具有圆形同心磁通面的大环径比托卡马克等离子体。其逆环径比为 $\\epsilon$，安全因子为 $q$，平衡磁场强度为 $B$。在 $t=0^{+}$ 时，施加一个具有单一径向波数 $k_r$ 的轴对称带状势扰动，产生一个磁通面平均的静电势 $\\phi(r,t)$，其初始条件为 $\\phi(r,0^{+})=\\phi_0 \\cos(k_r r)$，且没有初始平行运动。假设无碰撞离子由漂移动理学理论描述，电子为绝热的，并处于长波极限 $k_r \\rho_i \\ll 1$，其中 $\\rho_i$ 是离子拉莫尔半径。带状流通过测地曲率和离子可压缩性与测地声学模 (GAM) 耦合。\n\n使用动理学理论，推导在无碰撞极限下，初始带状势扰动如何划分为非振荡的剩余带状流分量和振荡的测地声学模 (GAM) 分量。采用以下模型选择：\n\n- 用于划分的能量范数是带状流的 $\\mathbf{E}\\times\\mathbf{B}$ 动能密度，定义为 $W_E = \\frac{n_i m_i}{2} |\\mathbf{u}_E|^2$，其中 $\\mathbf{u}_E = \\frac{c}{B}\\,\\hat{\\mathbf{b}}\\times\\nabla \\phi$，$\\hat{\\mathbf{b}}$ 是沿磁场的单位矢量，$n_i$ 是离子密度，$m_i$ 是离子质量。对于单一 $k_r$ 的带状扰动，$W_E \\propto k_r^2 \\phi^2$。\n- 在大环径比、圆形磁面的极限下，与捕获离子动力学相关的新经典极化惯性会增强静态带状流响应，其增强量由无量纲参数 $\\Lambda(q,\\epsilon)$ 表征。对于绝热电子和 $k_r \\rho_i \\ll 1$ 的情况，该参数与 $q^2/\\sqrt{\\epsilon}$ 成正比。具体来说，对于圆形同心磁通面，取 $\\Lambda(q,\\epsilon) = \\alpha\\,\\frac{q^2}{\\sqrt{\\epsilon}}$，其中 $\\alpha=1.6$。\n\n从第一性原理出发，用 $\\phi_0$ 和 $\\Lambda$ 表示剩余带状流的势振幅 $\\phi_{\\infty}$，然后使用指定的能量范数计算初始 $\\mathbf{E}\\times\\mathbf{B}$ 动能中保留在剩余带状流中的分数（记为 $f_{\\mathrm{res}}$）以及进入振荡 GAM 分量的互补分数（记为 $f_{\\mathrm{GAM}}$）。对 $q=1.5$ 和 $\\epsilon=0.16$ 的情况，数值计算这些分数。\n\n将您的数值答案四舍五入到四位有效数字。将最终的能量分数表示为不带百分号的小数。最终答案应按顺序报告 $(f_{\\mathrm{res}}, f_{\\mathrm{GAM}})$ 这两个数。",
            "solution": "用户提供的问题已经过验证，被确定为计算聚变科学与工程领域中一个有科学依据、适定且客观的问题。\n\n该问题要求计算初始带状势扰动的能量如何划分为长时间的剩余带状流和振荡的测地声学模（GAM）。问题的核心在于托卡马克等离子体中的新经典极化屏蔽概念。\n\n首先，我们讨论磁通面平均静电势 $\\phi(t)$ 的演化。一个初始势扰动 $\\phi(r, 0^+) = \\phi_0 \\cos(k_r r)$ 被施加到等离子体上。在环形几何中，对该扰动的响应由经典和新经典极化效应共同决定。在长时间极限（$t \\rightarrow \\infty$）下，当振荡的 GAM 分量通过无碰撞相混合而衰减后，会留下一个稳态的剩余带状流势 $\\phi_{\\infty}$。\n\n初始势 $\\phi_0$ 和剩余势 $\\phi_{\\infty}$ 之间的关系是动理学理论的一个经典结果（由 Rosenbluth 和 Hinton 推广）。它源于建立电势的初始电荷的守恒。最初，在 $t=0^+$ 时，等离子体还没有足够的时间来表现出由环形效应引起的（新经典）效应。系统的响应由高频或经典介电电容决定，这与经典离子极化漂移有关。我们将此快速时间尺度上的有效介电常数表示为 $\\epsilon_{cl}$。初始的“未屏蔽”电荷密度扰动 $\\rho_0$ 与 $\\epsilon_{cl}\\nabla^2\\phi_0$ 成正比。\n\n随着时间的推移，系统向一个新的稳态演化。在这个最终状态下，相同的初始电荷密度 $\\rho_0$ 现在被等离子体的完全静态介电响应 $\\epsilon_{st}$ 所屏蔽。这种静态响应既包括经典极化，也包括由环形磁场中捕获离子的动力学引起的额外的新经典极化。问题用因子 $\\Lambda$ 来参数化这种新经典增强效应。因此，静态介电常数被增强了一个因子 $(1+\\Lambda)$，即 $\\epsilon_{st} = (1+\\Lambda)\\epsilon_{cl}$。最终势 $\\phi_{\\infty}$ 通过 $\\rho_0 \\propto \\epsilon_{st}\\nabla^2\\phi_{\\infty}$ 与电荷 $\\rho_0$ 相关联。\n\n根据极化电荷守恒，我们有：\n$$ \\epsilon_{cl}\\nabla^2\\phi_0 = \\epsilon_{st}\\nabla^2\\phi_{\\infty} = (1+\\Lambda)\\epsilon_{cl}\\nabla^2\\phi_{\\infty} $$\n对于单一径向模式，这简化为：\n$$ \\phi_0 = (1+\\Lambda)\\phi_{\\infty} $$\n由此，我们推导出剩余带状流势的振幅：\n$$ \\phi_{\\infty} = \\frac{1}{1+\\Lambda}\\phi_0 $$\n\n接下来，我们计算能量的划分。问题指定能量范数为 $\\mathbf{E}\\times\\mathbf{B}$ 动能密度 $W_E$。对于单一 $k_r$ 扰动，该能量与势振幅的平方成正比：$W_E \\propto \\phi^2$。设比例常数为 $C$。\n\n在 $t=0^+$ 时的初始能量与势 $\\phi_0$ 相关：\n$$ W_{E,0} = C \\phi_0^2 $$\n问题指出没有初始平行运动，因此这代表了系统在 $t=0^+$ 时的总能量。\n\n在 $t \\rightarrow \\infty$ 极限下，保留在剩余带状流中的能量与势 $\\phi_{\\infty}$ 相关：\n$$ W_{E,\\mathrm{res}} = C \\phi_{\\infty}^2 = C \\left(\\frac{1}{1+\\Lambda}\\phi_0\\right)^2 = \\frac{1}{(1+\\Lambda)^2} C \\phi_0^2 $$\n\n保留在剩余带状流中的初始能量分数 $f_{\\mathrm{res}}$ 是剩余能量与初始能量之比：\n$$ f_{\\mathrm{res}} = \\frac{W_{E,\\mathrm{res}}}{W_{E,0}} = \\frac{\\frac{1}{(1+\\Lambda)^2} C \\phi_0^2}{C \\phi_0^2} = \\frac{1}{(1+\\Lambda)^2} $$\n\n系统的总能量是守恒的。初始能量 $W_{E,0}$ 被划分到最终的稳态剩余流能量 $W_{E,\\mathrm{res}}$ 和转移到振荡 GAM 分量的能量 $W_{E,\\mathrm{GAM}}$ 之间。因此，GAM 中的能量是初始能量与剩余能量之差。\n$$ W_{E,\\mathrm{GAM}} = W_{E,0} - W_{E,\\mathrm{res}} $$\n进入 GAM 的初始能量分数 $f_{\\mathrm{GAM}}$ 是：\n$$ f_{\\mathrm{GAM}} = \\frac{W_{E,\\mathrm{GAM}}}{W_{E,0}} = \\frac{W_{E,0} - W_{E,\\mathrm{res}}}{W_{E,0}} = 1 - \\frac{W_{E,\\mathrm{res}}}{W_{E,0}} = 1 - f_{\\mathrm{res}} $$\n代入 $f_{\\mathrm{res}}$ 的表达式：\n$$ f_{\\mathrm{GAM}} = 1 - \\frac{1}{(1+\\Lambda)^2} $$\n\n现在，我们对给定的参数进行计算这些分数：$q=1.5$、$\\epsilon=0.16$ 以及 $\\alpha=1.6$。\n首先，我们计算无量纲新经典极化参数 $\\Lambda$：\n$$ \\Lambda = \\alpha \\frac{q^2}{\\sqrt{\\epsilon}} = 1.6 \\times \\frac{(1.5)^2}{\\sqrt{0.16}} = 1.6 \\times \\frac{2.25}{0.4} $$\n$$ \\Lambda = 4 \\times 2.25 = 9 $$\n$\\Lambda$ 的值恰好为 $9$。\n\n现在我们可以计算能量分数：\n$$ f_{\\mathrm{res}} = \\frac{1}{(1+\\Lambda)^2} = \\frac{1}{(1+9)^2} = \\frac{1}{10^2} = \\frac{1}{100} = 0.01 $$\n$$ f_{\\mathrm{GAM}} = 1 - f_{\\mathrm{res}} = 1 - 0.01 = 0.99 $$\n\n问题要求将数值答案四舍五入到四位有效数字。\n$$ f_{\\mathrm{res}} = 0.01000 $$\n$$ f_{\\mathrm{GAM}} = 0.9900 $$\n\n最终答案是序对 $(f_{\\mathrm{res}}, f_{\\mathrm{GAM}})$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.01000  0.9900 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在理论上计算了能量分配之后，计算科学家的一个关键技能是从模拟数据中测量这些物理量。本练习通过分析一个模拟回旋动理学程序输出的合成信号来实践这一任务。您将需要运用信号处理技术（如数字滤波）来从振荡的GAM和其他噪声中分离出稳态的剩余流分量，从而掌握数据分析、滤波器设计和数值收敛性检查等解释复杂模拟结果所必需的实用技能。",
            "id": "3985290",
            "problem": "设计一个独立的数值实验，用于测量 Rosenbluth–Hinton 残余（RH 残余）。该测量基于对存在测地声模（GAM）时环带流弛豫的合成回旋动理学诊断。Rosenbluth–Hinton 残余是指，在瞬态振荡的 GAM 响应经历相位混合而消失后，与环带流相关的、在磁通量面上平均的静电势在无碰撞情况下的有限长时间余量。合成诊断模拟了静电势的磁通量面平均值的时间历史，其构造旨在反映基本的回旋动理学行为，而无需实际的回旋动理学求解器。\n\n从以下基本原则开始：\n- 对于环带扰动，无碰撞、线性、轴对称的回旋动理学响应分解为一个在测地声模频率上振荡的分量和一个与残余环带流相关的非振荡分量。在数学上，诊断信号可以理想化为一个代表残余的恒定偏移量、一个在测地声模频率上的阻尼振荡以及一些小的辅助项（例如，数值漂移和噪声）之和。\n- 频域滤波器可以从信号中移除 GAM 频带，而不会扭曲恒定的残余偏移量，前提是该滤波器以非因果、零相位的方式应用。\n\n待分析的合成信号定义为，对于时间 $t \\in [0, T)$：\n$$\n\\phi(t) = \\phi_0 \\left[ R + (1 - R) \\exp(-\\alpha t) \\cos(\\omega_G t) \\right] + \\phi_0 \\, d \\, \\frac{t}{T} + \\phi_0 \\, r_{\\mathrm{noise}} \\left[ \\tfrac{1}{2} \\sin(2\\pi f_{n1} t) + \\tfrac{1}{2} \\sin(2\\pi f_{n2} t) \\right],\n$$\n其中 $R$ 是待测量的真实残余分数，$\\phi_0$ 是初始静电势振幅，$\\alpha$ 是阻尼率，$\\omega_G$ 是测地声模角频率， $d$ 是区间 $[0, T)$ 上的无量纲线性漂移分数， $r_{\\mathrm{noise}}$ 是无量纲噪声振幅分数， $f_{n1}$ 和 $f_{n2}$ 是确定性噪声频率，被选为采样率的固定分数。测量的目标是使用基于滤波器的诊断方法从 $\\phi(t)$ 中估计无量纲的残余分数 $R$，并检验测量结果关于时间分辨率和滤波器带宽的收敛性。\n\n您必须实现以下测量步骤：\n- 采样和单位：\n  - 以频率 $f_s$（单位 $\\mathrm{Hz}$）在总时长 $T$（单位 $\\mathrm{s}$）上进行均匀采样，生成离散时间序列。角度使用弧度，角频率使用 $\\mathrm{rad/s}$。最终的残余分数必须是无量纲的。\n  - 将两个确定性噪声频率定义为 $f_{n1} = 0.12 f_s$ 和 $f_{n2} = 0.20 f_s$（单位 $\\mathrm{Hz}$），以确保在不同采样率下的可复现性。\n- 滤波器设计：\n  - 计算测地声模的线性频率 $f_0 = \\omega_G/(2\\pi)$（单位 $\\mathrm{Hz}$）和奈奎斯特频率 $f_N = f_s/2$（单位 $\\mathrm{Hz}$）。\n  - 设计一个 $n$ 阶 Butterworth 带阻（陷波）滤波器，其归一化下限和上限截止频率为\n    $$\n    w_1 = \\frac{(1 - \\beta) f_0}{f_N}, \\quad w_2 = \\frac{(1 + \\beta) f_0}{f_N},\n    $$\n    裁剪到开区间 $(0, 1)$ 内以确保滤波器是良定义的。双向（前向-后向）应用该滤波器以实现零相移。\n- 残余估计和稳态性：\n  - 滤波后，计算残余估计值 $\\widehat{R}$，即在时长为 $T_{\\mathrm{win}}$ 秒的最后一个窗口上的平均值：\n    $$\n    \\widehat{R} = \\frac{1}{\\phi_0} \\, \\frac{1}{|\\mathcal{I}|} \\sum_{t_i \\in \\mathcal{I}} \\phi_{\\mathrm{filt}}(t_i), \\quad \\mathcal{I} = \\{ t_i \\mid t_i \\in [T - T_{\\mathrm{win}}, T) \\},\n    $$\n    其中 $\\phi_{\\mathrm{filt}}(t)$ 是滤波后的信号， $|\\mathcal{I}|$ 是窗口中的样本数。\n  - 通过在 $[T - T_{\\mathrm{win}}, T)$ 上对 $\\phi_{\\mathrm{filt}}(t)$ 进行线性拟合，计算斜率 $s$（单位 $\\mathrm{V/s}$），从而评估窗口内残余的稳态性。定义无量纲斜率比\n    $$\n    \\rho_s = \\frac{|s|}{\\phi_0 / T_{\\mathrm{win}}}.\n    $$\n    若 $\\rho_s \\ge \\epsilon_s$，则迭代地将 $T_{\\mathrm{win}}$ 减半（直至最小值 $0.05 T$），如果需要则重新滤波，并重新计算，直到 $\\rho_s  \\epsilon_s$ 或达到最小窗口。使用 $\\epsilon_s$ 作为无量纲阈值。\n- 收敛性检验：\n  - 时间分辨率收敛性：使用双倍采样率 $2 f_s$ 重新计算 $\\widehat{R}$ （保持 $T$ 和所有其他物理参数不变），如果满足以下条件，则宣布收敛：\n    $$\n    |\\widehat{R}(2 f_s) - \\widehat{R}(f_s)|  \\tau_{\\mathrm{time}}，\n    $$\n    其中 $\\tau_{\\mathrm{time}}$ 是一个无量纲容差。\n  - 滤波器带宽收敛性：使用第二个频带参数 $\\beta_2$ 重新计算 $\\widehat{R}$（保持原始采样率 $f_s$ 不变），如果满足以下条件，则宣布收敛：\n    $$\n    |\\widehat{R}(\\beta_2) - \\widehat{R}(\\beta_1)|  \\tau_{\\mathrm{band}}。\n    $$\n    其中 $\\beta_1$ 是主频带参数， $\\tau_{\\mathrm{band}}$ 是一个无量纲容差。\n\n将上述过程实现为一个完整的独立程序。该程序构建合成信号，执行滤波和残余估计，并为每个测试用例输出一个列表，其中包含估计的残余分数和两个布尔值，分别表示时间分辨率和滤波器带宽收敛性检查的结果。\n\n使用以下参数集测试套件。对于每个测试用例，参数为 $(\\phi_0 \\, [\\mathrm{V}], \\, \\omega_G \\, [\\mathrm{rad/s}], \\, \\alpha \\, [\\mathrm{s}^{-1}], \\, R, \\, r_{\\mathrm{noise}}, \\, f_s \\, [\\mathrm{Hz}], \\, T \\, [\\mathrm{s}], \\, d)$，并固定滤波器和收敛控制参数为 $n = 4$, $\\beta_1 = 0.15$, $\\beta_2 = 0.25$, $T_{\\mathrm{win}} = 0.25 T$, $\\epsilon_s = 0.02$, $\\tau_{\\mathrm{time}} = 10^{-3}$, and $\\tau_{\\mathrm{band}} = 2 \\times 10^{-3}$：\n- 测试用例 1: $(1.0, \\, 60000, \\, 50, \\, 0.6, \\, 0.01, \\, 200000, \\, 0.2, \\, 0.005)$.\n- 测试用例 2: $(1.0, \\, 40000, \\, 5, \\, 0.3, \\, 0.05, \\, 100000, \\, 0.4, \\, 0.01)$.\n- 测试用例 3: $(0.5, \\, 80000, \\, 50, \\, 0.8, \\, 0.0, \\, 150000, \\, 0.2, \\, 0.0)$.\n- 测试用例 4: $(2.0, \\, 30000, \\, 20, \\, 0.5, \\, 0.2, \\, 100000, \\, 0.3, \\, 0.02)$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的列表。列表中的每个元素对应一个测试用例，并且本身也是一个形式为 $[\\widehat{R}, \\mathrm{time\\_conv}, \\mathrm{band\\_conv}]$ 的列表，其中 $\\widehat{R}$ 是一个浮点数，两个收敛性指标是布尔值。例如，输出格式应为：\n`[[r1,True,False],[r2,True,True],[r3,False,True],[r4,True,True]]`。\n所有物理单位必须按规定使用，$\\omega_G$ 的频率单位为 $\\mathrm{rad/s}$，$f_s$ 的频率单位为 $\\mathrm{Hz}$，时间单位为 $\\mathrm{s}$，角度单位为弧度。残余分数为无量纲。不允许用户输入；所有参数均按上文所示硬编码。",
            "solution": "该问题要求设计并实现一个数值实验，从一个代表存在测地声模（GAM）时环带流弛豫的合成诊断信号中测量 Rosenbluth–Hinton (RH) 残余。该过程被验证为科学上合理、适定且客观。它构成了一项明确的计算任务，基于等离子体物理和数字信号处理的既定原则。我们接下来详细描述将作为一个独立程序实现的求解方法。\n\n该方法的核心是通过滤除主要的振荡分量（即 GAM），来分离出代表 RH 残余的时间序列信号中的恒定（DC）分量。该过程包括四个主要阶段：（1）生成合成信号，（2）设计和应用数字滤波器，（3）从滤波后的信号中估计残余（包括稳态性检查），以及（4）进行关于时间分辨率和滤波器带宽的收敛性研究。\n\n首先，在时间区间 $t \\in [0, T)$ 上生成一个合成诊断信号 $\\phi(t)$。该信号由以下方程定义：\n$$\n\\phi(t) = \\phi_0 \\left[ R + (1 - R) \\exp(-\\alpha t) \\cos(\\omega_G t) \\right] + \\phi_0 \\, d \\, \\frac{t}{T} + \\phi_0 \\, r_{\\mathrm{noise}} \\left[ \\tfrac{1}{2} \\sin(2\\pi f_{n1} t) + \\tfrac{1}{2} \\sin(2\\pi f_{n2} t) \\right]\n$$\n此处，$\\phi_0$ 是初始电势振幅，$R$ 是真实的无量纲残余分数，$\\alpha$ 是 GAM 的阻尼率，$\\omega_G$ 是 GAM 角频率，$d$ 是线性漂移系数，$r_{\\mathrm{noise}}$ 控制着频率为 $f_{n1}$ 和 $f_{n2}$ 的两个确定性高频噪声项的振幅。在数值实现中，该连续信号被离散化为一个时间序列，其均匀采样频率为 $f_s$，从而得到一组点 $\\phi(t_i)$，其中 $t_i$ 是离散时间步。噪声频率相对于采样率定义为 $f_{n1} = 0.12 f_s$ 和 $f_{n2} = 0.20 f_s$，以确保其频谱位置在不同时间分辨率下保持一致。\n\n其次，采用数字滤波器从信号中移除 GAM 振荡。GAM 的线性频率为 $f_0 = \\omega_G / (2\\pi)$。为此目的，选择了 Butterworth 带阻（或“陷波”）滤波器，因其具有最大平坦的通带响应。该滤波器为 $n$ 阶。其阻带以 $f_0$ 为中心，相对宽度由参数 $\\beta$ 控制。阻带的下限和上限截止频率（归一化到奈奎斯特频率 $f_N = f_s/2$）由下式给出：\n$$\nw_1 = \\frac{(1 - \\beta) f_0}{f_N}, \\quad w_2 = \\frac{(1 + \\beta) f_0}{f_N}\n$$\n这些归一化频率必须位于开区间 $(0, 1)$ 内，以确保滤波器是良定义的，并且在必要时会在数值上裁剪到离边界一小段距离处。为防止引入可能破坏信号时域特征的相位失真，使用零相位滤波技术，通过前向-后向传递方式应用滤波器。这种非因果滤波有效地移除了阻带内的频率分量，而不会使剩余分量在时间上发生偏移。此步骤的输出是滤波后的信号 $\\phi_{\\mathrm{filt}}(t)$。\n\n第三，从滤波后的信号中估计残余分数 $\\widehat{R}$。理论上的残余是电势的非振荡、长时间极限。我们通过在仿真结束时的一个时间窗口（从 $t=T-T_{\\mathrm{win}}$ 到 $t=T$）上对 $\\phi_{\\mathrm{filt}}(t)$ 进行平均来估计该值。估计的残余分数计算如下：\n$$\n\\widehat{R} = \\frac{1}{\\phi_0} \\, \\frac{1}{|\\mathcal{I}|} \\sum_{t_i \\in \\mathcal{I}} \\phi_{\\mathrm{filt}}(t_i), \\quad \\text{where } \\mathcal{I} = \\{ t_i \\mid t_i \\in [T - T_{\\mathrm{win}}, T) \\}\n$$\n此估计的一个关键方面是确保平均窗口内的信号足够平稳（即恒定）。任何残余斜率都可能表示 GAM 瞬态的阻尼不完全或线性漂移项的影响。通过在窗口 $[T-T_{\\mathrm{win}}, T)$ 内对 $\\phi_{\\mathrm{filt}}(t)$ 进行线性函数拟合以获得其斜率 $s$，来评估稳态性。计算无量纲斜率比 $\\rho_s$：\n$$\n\\rho_s = \\frac{|s|}{\\phi_0 / T_{\\mathrm{win}}}\n$$\n如果 $\\rho_s$ 大于或等于预设容差 $\\epsilon_s$，则认为窗口持续时间 $T_{\\mathrm{win}}$ 过长，并将其迭代减半。此过程持续进行，直到 $\\rho_s  \\epsilon_s$ 或 $T_{\\mathrm{win}}$ 达到指定的最小尺寸（此处为 $0.05 T$）。滤波步骤对整个信号执行一次；稳态性检查仅涉及对滤波后数据的后处理。\n\n第四，执行两项收敛性检查以验证测量的数值鲁棒性。\n时间分辨率收敛性检查评估 $\\widehat{R}$ 对采样率 $f_s$ 的敏感性。在保持所有其他物理参数不变的情况下，使用双倍采样率 $2f_s$ 重复整个计算过程。如果新估计值 $\\widehat{R}(2f_s)$ 与原始估计值 $\\widehat{R}(f_s)$ 之间的绝对差小于容差 $\\tau_{\\mathrm{time}}$，即 $|\\widehat{R}(2f_s) - \\widehat{R}(f_s)|  \\tau_{\\mathrm{time}}$，则认为测量收敛。\n滤波器带宽收敛性检查评估对滤波器阻带宽度的敏感性。使用原始采样率 $f_s$ 但使用不同的带宽参数 $\\beta_2$ 重复计算。如果使用新带宽的估计值 $\\widehat{R}(\\beta_2)$ 与原始估计值 $\\widehat{R}(\\beta_1)$ 之间的绝对差小于容差 $\\tau_{\\mathrm{band}}$，即 $|\\widehat{R}(\\beta_2) - \\widehat{R}(\\beta_1)|  \\tau_{\\mathrm{band}}$，则宣布收敛。\n\n最终程序实现了这整个过程，并对一系列测试用例进行迭代。对于每个用例，它计算主残余估计值 $\\widehat{R}$ 和两个布尔收敛指标，并以指定的列表格式输出结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy import signal\n\ndef calculate_residual(params, fs_override=None, beta_override=None):\n    \"\"\"\n    Calculates the RH residual for a single parameter configuration.\n    \"\"\"\n    # Unpack parameters\n    phi0, omega_G, alpha, R, r_noise, fs_base, T, d = params\n    \n    # Fixed analysis parameters\n    n = 4\n    beta1 = 0.15\n    T_win_initial_frac = 0.25\n    T_win_min_frac = 0.05\n    eps_s = 0.02\n\n    # Apply overrides for convergence checks\n    fs = fs_override if fs_override is not None else fs_base\n    beta = beta_override if beta_override is not None else beta1\n\n    # 1. Generate Signal\n    num_points = int(T * fs)\n    t = np.linspace(0, T, num_points, endpoint=False)\n    \n    # GAM frequency in Hz\n    f0 = omega_G / (2.0 * np.pi)\n    \n    # Noise frequencies\n    f_n1 = 0.12 * fs\n    f_n2 = 0.20 * fs\n    \n    # Synthetic signal formula\n    gam_component = phi0 * (1 - R) * np.exp(-alpha * t) * np.cos(omega_G * t)\n    residual_component = phi0 * R\n    drift_component = phi0 * d * (t / T)\n    noise_component = phi0 * r_noise * (0.5 * np.sin(2 * np.pi * f_n1 * t) + 0.5 * np.sin(2 * np.pi * f_n2 * t))\n    \n    phi_t = residual_component + gam_component + drift_component + noise_component\n\n    # 2. Design and Apply Filter\n    f_nyquist = 0.5 * fs\n    \n    # Normalized cutoff frequencies, clipped to (0, 1)\n    w1 = (1 - beta) * f0 / f_nyquist\n    w2 = (1 + beta) * f0 / f_nyquist\n    w1 = max(1e-9, w1)\n    w2 = min(1.0 - 1e-9, w2)\n    \n    # Design Butterworth band-stop filter using second-order sections for stability\n    sos = signal.butter(n, [w1, w2], btype='bandstop', output='sos')\n    \n    # Apply zero-phase filter\n    phi_filt = signal.sosfiltfilt(sos, phi_t)\n\n    # 3. Stationarity Check and Residual Estimation loop\n    current_T_win = T * T_win_initial_frac\n    min_T_win = T * T_win_min_frac\n\n    while True:\n        win_samples = int(current_T_win * fs)\n        if win_samples > 2: # Need at least 2 points for a line fit\n            t_window = t[-win_samples:]\n            phi_window = phi_filt[-win_samples:]\n            \n            # Fit a line to the data in the window\n            slope, _ = np.polyfit(t_window, phi_window, 1)\n\n            # Dimensionless slope ratio\n            rho_s = abs(slope) / (phi0 / current_T_win)\n\n            if rho_s  eps_s:\n                break\n            \n            if (current_T_win / 2.0)  min_T_win:\n                break\n            \n            current_T_win /= 2.0\n        else:\n            break\n\n    # 4. Final Residual Calculation\n    final_win_samples = int(current_T_win * fs)\n    final_phi_window = phi_filt[-final_win_samples:]\n    \n    R_hat = np.mean(final_phi_window) / phi0\n    \n    return R_hat\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test cases: (phi0, omega_G, alpha, R, r_noise, fs, T, d)\n    test_cases = [\n        (1.0, 60000, 50, 0.6, 0.01, 200000, 0.2, 0.005),\n        (1.0, 40000, 5, 0.3, 0.05, 100000, 0.4, 0.01),\n        (0.5, 80000, 50, 0.8, 0.0, 150000, 0.2, 0.0),\n        (2.0, 30000, 20, 0.5, 0.2, 100000, 0.3, 0.02),\n    ]\n\n    # Convergence parameters\n    beta2 = 0.25\n    tau_time = 1e-3\n    tau_band = 2e-3\n\n    results = []\n    for params in test_cases:\n        fs_base = params[5]\n\n        # Base calculation\n        R_hat_base = calculate_residual(params)\n        \n        # Time-resolution convergence check\n        R_hat_time_conv = calculate_residual(params, fs_override=2 * fs_base)\n        time_conv = abs(R_hat_time_conv - R_hat_base)  tau_time\n\n        # Filter-bandwidth convergence check\n        R_hat_band_conv = calculate_residual(params, beta_override=beta2)\n        band_conv = abs(R_hat_band_conv - R_hat_base)  tau_band\n\n        results.append([R_hat_base, time_conv, band_conv])\n\n    # Format the output as specified\n    # Using map(str, ...) on the list of lists correctly formats each inner list\n    # e.g., str([0.6, True, False]) -> '[0.6, True, False]'\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}