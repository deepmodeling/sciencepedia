{
    "hands_on_practices": [
        {
            "introduction": "Before simulating plasma turbulence, one must first define the background magnetic \"container\" in which the plasma resides. This foundational exercise guides you through the process of constructing a simplified tokamak equilibrium from the Grad-Shafranov equation, the cornerstone of magnetohydrodynamic (MHD) equilibrium theory . By deriving essential parameters like the safety factor, $q$, and key geometric factors, you will gain a practical understanding of how the macroscopic magnetic structure provides the stage for microscopic gyrokinetic phenomena.",
            "id": "3981627",
            "problem": "In axisymmetric, static, ideal Magnetohydrodynamics (MHD), equilibria in a tokamak satisfy the Grad–Shafranov equation for the poloidal flux function $\\psi(R,Z)$,\n$$\n\\Delta^{*}\\psi \\equiv R \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = - \\mu_{0} R^{2} \\frac{d p}{d \\psi} - F(\\psi)\\,\\frac{d F}{d \\psi},\n$$\nwhere $R$ is the cylindrical major-radius coordinate, $Z$ is the vertical coordinate, $\\mu_{0}$ is the vacuum permeability, $p(\\psi)$ is the scalar pressure, and $F(\\psi) \\equiv R B_{\\phi}$ with $B_{\\phi}$ the toroidal magnetic field.\n\nConstruct a simple large-aspect-ratio, concentric-circular tokamak equilibrium by prescribing a linear pressure profile $p(\\psi) = p_{a} - \\alpha \\psi$ with constant $\\alpha > 0$ and a constant toroidal field function $F^{2}(\\psi) = F_{0}^{2}$, where $p_{a}$ and $F_{0}$ are constants. Assume small inverse aspect ratio $\\epsilon \\equiv r/R_{0} \\ll 1$, where $r$ is the minor radius labeling the concentric flux surfaces and $R_{0}$ is the major radius at the magnetic axis, and retain only leading-order terms in $\\epsilon$. Use the coordinate relations $R(\\theta) = R_{0} + r\\cos\\theta$ and $Z(\\theta) = r\\sin\\theta$ for the flux surface with poloidal angle $\\theta$. Treat $\\psi$ as a function of $r$ to leading order and impose regularity at $r=0$.\n\nStarting from the Grad–Shafranov equation, derive the leading-order $\\psi(r)$ consistent with the prescribed $p(\\psi)$ and $F(\\psi)$. Then, using the magnetic-field representation $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\phi + F(\\psi)\\,\\nabla\\phi$, where $\\phi$ is the toroidal angle, derive the safety factor $q(\\psi)$ from its first-principles definition as the field-line helicity, $q = \\frac{1}{2\\pi}\\oint \\frac{d\\phi}{d\\theta}\\,d\\theta$, with $d\\phi/d\\theta = \\frac{\\mathbf{B}\\cdot\\nabla\\phi}{\\mathbf{B}\\cdot\\nabla\\theta}$. In the same ordering, identify the leading-order expressions for the geometric factors most relevant to flux-tube gyrokinetics, namely $|\\nabla\\psi|$ on a given surface and the magnetic-field strength variation $B(\\theta)$ along that surface.\n\nProvide the final answer as a single closed-form analytic expression for $q(\\psi)$ in terms of $\\mu_{0}$, $\\alpha$, $F_{0}$, and $R_{0}$. The safety factor is dimensionless; no units are required in the final answer. Do not provide intermediate results in the final answer.",
            "solution": "This problem asks for a derivation of key equilibrium quantities for a simplified large-aspect-ratio tokamak, starting from the Grad-Shafranov equation. The derivation is a standard exercise in MHD theory.\n\nFirst, we simplify the Grad–Shafranov equation using the prescribed profiles for pressure $p(\\psi)$ and the toroidal field function $F(\\psi)$. Given $p(\\psi) = p_{a} - \\alpha \\psi$, the pressure gradient term is $\\frac{dp}{d\\psi} = -\\alpha$. Given $F^{2}(\\psi) = F_{0}^{2}$, where $F_0$ is a constant, the corresponding term is $F(\\psi)\\frac{dF}{d\\psi} = \\frac{1}{2}\\frac{d(F^{2})}{d\\psi} = \\frac{1}{2}\\frac{d(F_{0}^{2})}{d\\psi} = 0$. Substituting these into the Grad–Shafranov equation yields:\n$$\n\\Delta^{*}\\psi = - \\mu_{0} R^{2} (-\\alpha) - 0 = \\mu_{0} \\alpha R^{2}\n$$\nThe problem specifies a large-aspect-ratio expansion, $\\epsilon \\equiv r/R_0 \\ll 1$, and that $\\psi$ should be treated as a function of the minor radius $r$ only at leading order, i.e., $\\psi = \\psi(r)$. The operator $\\Delta^{*}$ in toroidal coordinates $(r, \\theta)$ acting on a function $\\psi(r)$ is, to leading order:\n$$\n\\Delta^{*}\\psi \\approx \\frac{1}{r}\\frac{d}{dr}\\left(r \\frac{d\\psi}{dr}\\right)\n$$\nWe also approximate the right-hand side to leading order by setting $R \\approx R_0$. This yields the leading-order equation for the equilibrium:\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r \\frac{d\\psi}{dr}\\right) = \\mu_{0} \\alpha R_{0}^{2}\n$$\nIntegrating this ordinary differential equation once with respect to $r$:\n$$\nr \\frac{d\\psi}{dr} = \\int \\mu_{0} \\alpha R_{0}^{2} r \\,dr = \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r^2 + C_1\n$$\nDividing by $r$ gives $\\frac{d\\psi}{dr} = \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r + \\frac{C_1}{r}$. The condition of regularity at the magnetic axis ($r=0$) requires that physical quantities like the magnetic field do not diverge. Since the poloidal magnetic field is proportional to $\\frac{1}{R}|\\nabla\\psi| \\sim \\frac{1}{R_0}\\frac{d\\psi}{dr}$, we must have $\\frac{d\\psi}{dr}$ be finite at $r=0$. This implies we must set the integration constant $C_1=0$. Thus:\n$$\n\\frac{d\\psi}{dr} = \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r\n$$\nIntegrating a second time gives $\\psi(r)$:\n$$\n\\psi(r) = \\int \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r \\,dr = \\frac{1}{4}\\mu_{0} \\alpha R_{0}^{2} r^2 + C_2\n$$\nWe can define the poloidal flux to be zero at the magnetic axis, $\\psi(0)=0$, which sets $C_2=0$. The leading-order poloidal flux function is therefore:\n$$\n\\psi(r) = \\frac{1}{4}\\mu_{0} \\alpha R_{0}^{2} r^2\n$$\nNext, we derive the safety factor $q(\\psi)$ from its definition $q = \\frac{1}{2\\pi}\\oint \\frac{d\\phi}{d\\theta}\\,d\\theta$, where the differential ratio follows the magnetic field line. This ratio is given by $\\frac{d\\phi}{d\\theta} = \\frac{\\mathbf{B}\\cdot\\nabla\\phi}{\\mathbf{B}\\cdot\\nabla\\theta}$.\nThe magnetic field is $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\phi + F(\\psi)\\nabla\\phi$. The numerator is $\\mathbf{B}\\cdot\\nabla\\phi = F(\\psi)|\\nabla\\phi|^2 = F(\\psi)/R^2$.\nThe denominator is $\\mathbf{B}\\cdot\\nabla\\theta = (\\nabla\\psi \\times \\nabla\\phi)\\cdot\\nabla\\theta = \\frac{1}{Rr}\\frac{d\\psi}{dr}$.\nThus, the integrand is $\\frac{d\\phi}{d\\theta} = \\frac{F/R^2}{(1/Rr)(d\\psi/dr)} = \\frac{F r}{R (d\\psi/dr)}$.\nThe safety factor is the integral over a flux surface (constant $r$):\n$$\nq(r) = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} \\frac{F(r) r}{R(\\theta) \\frac{d\\psi}{dr}} \\,d\\theta\n$$\nSubstituting $F=F_0$, $R=R_0+r\\cos\\theta$, and $d\\psi/dr = \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r$:\n$$\nq(r) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{F_0 r}{(R_0+r\\cos\\theta) (\\frac{1}{2}\\mu_0 \\alpha R_0^2 r)} \\,d\\theta = \\frac{2 F_0}{\\mu_0 \\alpha R_0^2} \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{d\\theta}{R_0+r\\cos\\theta}\n$$\nThe integral is $\\int_{0}^{2\\pi} \\frac{d\\theta}{a+b\\cos\\theta} = \\frac{2\\pi}{\\sqrt{a^2-b^2}}$. Here $a=R_0$ and $b=r$.\n$$\nq(r) = \\frac{2 F_0}{\\mu_0 \\alpha R_0^2} \\frac{1}{\\sqrt{R_0^2-r^2}} = \\frac{2 F_0}{\\mu_0 \\alpha R_0^3 \\sqrt{1-(r/R_0)^2}}\n$$\nWe are asked for the leading-order expression in $\\epsilon=r/R_0$. We expand the result for small $\\epsilon$:\n$$\nq(r) = \\frac{2 F_0}{\\mu_0 \\alpha R_0^3} (1 - \\epsilon^2)^{-1/2} = \\frac{2 F_0}{\\mu_0 \\alpha R_0^3} (1 + O(\\epsilon^2))\n$$\nTo leading order, the safety factor is constant:\n$$\nq \\approx \\frac{2 F_0}{\\mu_0 \\alpha R_0^3}\n$$\nSince this expression is independent of $r$, it is also independent of $\\psi$. Thus, $q(\\psi)$ is this constant value.\n\nFor completeness, we identify the other requested geometric factors.\nThe magnitude of the poloidal flux gradient on a flux surface is:\n$$\n|\\nabla\\psi| = \\left|\\frac{d\\psi}{dr}\\right| = \\frac{1}{2}\\mu_{0} \\alpha R_{0}^{2} r\n$$\nThe magnetic field strength variation along a flux surface is $B(\\theta) = |\\mathbf{B}| = \\sqrt{B_p^2 + B_T^2}$.\n$B_T = B_\\phi = \\frac{F_0}{R} = \\frac{F_0}{R_0+r\\cos\\theta}$.\n$B_p = \\frac{|\\nabla\\psi|}{R} = \\frac{(1/2)\\mu_0 \\alpha R_0^2 r}{R_0+r\\cos\\theta}$.\nIn the large-aspect-ratio limit, $B_p/B_T = \\frac{\\mu_0 \\alpha R_0^2 r}{2F_0} = \\frac{r}{R_0 q} = \\epsilon/q \\ll 1$. Thus $B_p^2$ is negligible compared to $B_T^2$.\n$$\nB(\\theta) \\approx |B_T| = \\frac{F_0}{R_0+r\\cos\\theta} = \\frac{F_0}{R_0(1+\\epsilon\\cos\\theta)} \\approx \\frac{F_0}{R_0}(1-\\epsilon\\cos\\theta) = \\frac{F_0}{R_0}\\left(1-\\frac{r}{R_0}\\cos\\theta\\right)\n$$\nThe final answer required is the expression for $q(\\psi)$.",
            "answer": "$$\n\\boxed{\\frac{2F_0}{\\mu_0 \\alpha R_0^3}}\n$$"
        },
        {
            "introduction": "With the magnetic geometry established, we can now examine the behavior of individual particles within it. The toroidal shape of a tokamak causes the magnetic field strength to vary, leading to a crucial phenomenon where some particles become \"trapped\" in regions of weak field . This exercise delves into this single-particle dynamic, using the fundamental invariants of motion—energy and magnetic moment—to derive the condition for particle trapping and to calculate the fraction of the particle population that is trapped, a critical parameter that governs the existence and strength of trapped-particle instabilities.",
            "id": "3981597",
            "problem": "Consider a circular, concentric, large-aspect-ratio (LAR) tokamak of major radius $R_{0}$ and minor radius $r \\ll R_{0}$, with inverse aspect ratio $\\epsilon = r / R_{0}$. In the local flux-tube (FT) gyrokinetic (GK) formulation, one follows a single magnetic field line on a given flux surface, parameterized by the poloidal angle $\\theta$. The magnitude of the magnetic field on that flux surface is determined by toroidal geometry as\n$$\nB(\\theta) = \\frac{B_{0}}{1 + \\epsilon \\cos \\theta},\n$$\nwhere $B_{0}$ is the toroidal field at $R_{0}$. The minimum field is at the outboard midplane $\\theta = 0$, $B_{\\min} = B_{0}/(1+\\epsilon)$, and the maximum field is at the inboard midplane $\\theta = \\pi$, $B_{\\max} = B_{0}/(1-\\epsilon)$.\n\nAssume the gyrokinetic invariants of motion hold along the field line: conservation of total kinetic energy $E = \\tfrac{1}{2} m v^{2}$ and conservation of magnetic moment $\\mu = \\tfrac{m v_{\\perp}^{2}}{2 B}$. Define the pitch-angle parameter at the outboard midplane reference location $\\theta = 0$ by $\\lambda \\equiv v_{\\perp}^{2}(\\theta=0)/v^{2}$, and introduce the normalized field\n$$\nb(\\theta) \\equiv \\frac{B(\\theta)}{B_{\\min}} = \\frac{1+\\epsilon}{1+\\epsilon \\cos \\theta},\n$$\nso that $b_{\\min} = 1$ and $b_{\\max} = \\frac{1+\\epsilon}{1-\\epsilon}$.\n\nStarting from the stated invariants and definitions, derive the condition for a particle to be magnetically trapped along the field line in terms of $\\lambda$ and $b_{\\max}$, showing that the trapping condition can be written as $\\lambda\\, b_{\\max} > 1$. Then, assuming an isotropic distribution of velocity directions at $\\theta=0$ (so that the cosine of the pitch angle, $u \\equiv \\cos \\alpha_{0}$, is uniformly distributed on $[-1,1]$), compute the exact trapped fraction $f_{t}(\\epsilon)$ of particles on the flux surface as a function of $\\epsilon$.\n\nFinally, evaluate $f_{t}$ for $\\epsilon = 0.2$, and report the numerical value as a dimensionless decimal. Round your answer to four significant figures.",
            "solution": "The problem asks for two main results derived from a standard model of particle motion in a large-aspect-ratio tokamak: first, the condition for a particle to be magnetically trapped, and second, the fraction of trapped particles on a given flux surface assuming an isotropic velocity distribution, evaluated for a specific inverse aspect ratio $\\epsilon$.\n\nFirst, we derive the condition for magnetic trapping. A particle's motion along a magnetic field line is governed by the conservation of its total kinetic energy, $E$, and its magnetic moment, $\\mu$. These are given as:\n$$\nE = \\frac{1}{2} m (v_{\\perp}^{2} + v_{\\|}^{2}) = \\text{constant}\n$$\n$$\n\\mu = \\frac{m v_{\\perp}^{2}}{2 B} = \\text{constant}\n$$\nHere, $m$ is the particle mass, $v_{\\perp}$ is the component of velocity perpendicular to the magnetic field $\\vec{B}$, $v_{\\|}$ is the component parallel to $\\vec{B}$, and $B=|\\vec{B}|$. From the definition of $\\mu$, we can express the perpendicular kinetic energy as $\\frac{1}{2}m v_{\\perp}^{2} = \\mu B$. Substituting this into the energy conservation equation yields:\n$$\nE = \\mu B(\\theta) + \\frac{1}{2} m v_{\\|}^{2}(\\theta)\n$$\nwhere we have explicitly noted the dependence of $B$ and $v_{\\|}$ on the poloidal angle $\\theta$. We can solve for $v_{\\|}^{2}$:\n$$\nv_{\\|}^{2}(\\theta) = \\frac{2}{m}(E - \\mu B(\\theta))\n$$\nA particle is considered \"trapped\" if its parallel motion reverses direction at some point along the field line before completing a full poloidal circuit. This reversal point, known as a bounce point or turning point $\\theta_b$, is where $v_{\\|}(\\theta_b) = 0$. From the equation for $v_{\\|}^{2}$, this occurs when the particle's total energy equals its perpendicular energy:\n$$\nE = \\mu B(\\theta_b)\n$$\nSince $v_{\\|}^{2}$ must be non-negative, a particle with given $E$ and $\\mu$ can only access regions where $E \\ge \\mu B(\\theta)$. The magnetic field $B(\\theta)$ varies along the field line, reaching a maximum value $B_{\\max}$ at the inboard midplane ($\\theta = \\pi$). If a particle's energy $E$ is less than the maximum possible \"potential\" energy $\\mu B_{\\max}$, it will be reflected before it reaches the point of maximum field. Thus, the condition for a particle to be trapped is:\n$$\nE < \\mu B_{\\max}\n$$\nTo make this condition more practical, we express $E$ and $\\mu$ in terms of quantities at a reference location, which is the outboard midplane ($\\theta=0$) where the magnetic field is minimum, $B(0) = B_{\\min}$. At this location, the total velocity is $v$, and the perpendicular velocity is $v_{\\perp}(0)$. The conserved quantities are:\n$$\nE = \\frac{1}{2} m v^{2}\n$$\n$$\n\\mu = \\frac{m v_{\\perp}^{2}(0)}{2 B_{\\min}}\n$$\nSubstituting these expressions into the trapping inequality $E < \\mu B_{\\max}$ gives:\n$$\n\\frac{1}{2} m v^{2} < \\left(\\frac{m v_{\\perp}^{2}(0)}{2 B_{\\min}}\\right) B_{\\max}\n$$\nWe can cancel the term $\\frac{1}{2}m$ from both sides, which is valid since $m>0$:\n$$\nv^{2} < \\frac{v_{\\perp}^{2}(0)}{B_{\\min}} B_{\\max}\n$$\nRearranging this inequality to group dimensionless quantities, we get:\n$$\n1 < \\frac{v_{\\perp}^{2}(0)}{v^{2}} \\frac{B_{\\max}}{B_{\\min}}\n$$\nThe problem defines the pitch-angle parameter at the outboard midplane as $\\lambda \\equiv v_{\\perp}^{2}(0)/v^{2}$ and the normalized field maximum as $b_{\\max} \\equiv B_{\\max}/B_{\\min}$. Using these definitions, the condition for a particle to be trapped becomes:\n$$\n\\lambda b_{\\max} > 1\n$$\nNext, we calculate the fraction of trapped particles, $f_t(\\epsilon)$. The problem specifies an isotropic velocity distribution at the reference location $\\theta=0$. This implies that the cosine of the pitch angle at $\\theta=0$, denoted $u \\equiv \\cos \\alpha_{0} = v_{\\|}(0)/v$, is uniformly distributed over the interval $[-1, 1]$.\nThe pitch-angle parameter $\\lambda$ can be expressed in terms of $u$:\n$$\n\\lambda = \\frac{v_{\\perp}^{2}(0)}{v^{2}} = \\frac{v^{2} - v_{\\|}^{2}(0)}{v^{2}} = 1 - \\frac{v_{\\|}^{2}(0)}{v^{2}} = 1 - \\left(\\frac{v_{\\|}(0)}{v}\\right)^{2} = 1 - u^{2}\n$$\nSubstituting this into the trapping condition $\\lambda b_{\\max} > 1$:\n$$\n(1 - u^{2}) b_{\\max} > 1\n$$\nWe solve for the range of $u$ that corresponds to trapped particles:\n$$\n1 - u^{2} > \\frac{1}{b_{\\max}}\n$$\n$$\nu^{2} < 1 - \\frac{1}{b_{\\max}}\n$$\nThis inequality holds if $-\\sqrt{1 - 1/b_{\\max}} < u < \\sqrt{1 - 1/b_{\\max}}$.\nThe fraction of trapped particles is the probability that $u$ falls within this interval. Since $u$ is uniformly distributed on $[-1, 1]$, its probability density function is $p(u) = 1/2$ for $u \\in [-1, 1]$ and $0$ otherwise. The trapped fraction $f_t$ is found by integrating this probability density over the trapped region:\n$$\nf_t = \\int_{-\\sqrt{1 - 1/b_{\\max}}}^{\\sqrt{1 - 1/b_{\\max}}} p(u) \\, du = \\int_{-\\sqrt{1 - 1/b_{\\max}}}^{\\sqrt{1 - 1/b_{\\max}}} \\frac{1}{2} \\, du = \\frac{1}{2} \\left[ u \\right]_{-\\sqrt{1 - 1/b_{\\max}}}^{\\sqrt{1 - 1/b_{\\max}}}\n$$\n$$\nf_t = \\frac{1}{2} \\left[ \\sqrt{1 - \\frac{1}{b_{\\max}}} - \\left(-\\sqrt{1 - \\frac{1}{b_{\\max}}}\\right) \\right] = \\sqrt{1 - \\frac{1}{b_{\\max}}}\n$$\nNow, we express this fraction in terms of the inverse aspect ratio $\\epsilon$. The normalized maximum field is given by $b_{\\max} = \\frac{1+\\epsilon}{1-\\epsilon}$. Substituting this into the expression for $f_t$:\n$$\nf_t(\\epsilon) = \\sqrt{1 - \\frac{1}{(1+\\epsilon)/(1-\\epsilon)}} = \\sqrt{1 - \\frac{1-\\epsilon}{1+\\epsilon}}\n$$\nSimplifying the term inside the square root:\n$$\nf_t(\\epsilon) = \\sqrt{\\frac{(1+\\epsilon) - (1-\\epsilon)}{1+\\epsilon}} = \\sqrt{\\frac{1+\\epsilon-1+\\epsilon}{1+\\epsilon}} = \\sqrt{\\frac{2\\epsilon}{1+\\epsilon}}\n$$\nThis is the exact analytical expression for the trapped fraction as a function of $\\epsilon$.\n\nFinally, we evaluate $f_t$ for the given value $\\epsilon = 0.2$:\n$$\nf_t(0.2) = \\sqrt{\\frac{2 \\times 0.2}{1 + 0.2}} = \\sqrt{\\frac{0.4}{1.2}} = \\sqrt{\\frac{1}{3}}\n$$\nTo obtain the numerical value, we compute:\n$$\nf_t(0.2) = \\frac{1}{\\sqrt{3}} \\approx 0.577350269...\n$$\nRounding this result to four significant figures as requested gives $0.5774$.",
            "answer": "$$\n\\boxed{0.5774}\n$$"
        },
        {
            "introduction": "The ultimate goal of many gyrokinetic simulations is to understand and predict plasma turbulence, which arises from the complex, nonlinear interactions between a multitude of waves and flows. This practice dives into the heart of turbulence by tasking you with computing the rate of energy transfer between drift-wave fluctuations and self-generated zonal flows . By implementing the spectral triad interaction formalism, you will gain direct, hands-on experience with the fundamental mechanism that governs how energy cascades and is redistributed in a turbulent plasma, a central topic in fusion energy science.",
            "id": "3981576",
            "problem": "Consider a local \"flux-tube\" spectral representation of an electrostatic, magnetized plasma, in which the perpendicular dynamics are treated on a two-dimensional periodic domain in the radial coordinate $x$ and the binormal coordinate $y$. Work within the electrostatic, low-frequency, gyrokinetic limit where the perpendicular velocity field is given by the electric cross magnetic (E×B) drift, and the perpendicular dynamics can be represented by an incompressible streamfunction. In normalized gyrokinetic units, let the electrostatic potential be the streamfunction $\\,\\phi(x,y,t)\\,$, and define the vorticity $\\,\\zeta(x,y,t)\\,$ by the Laplacian of the streamfunction. Take the fundamental definitions:\n- $\\,\\mathbf{v}_{E\\times B} = \\hat{\\mathbf{z}} \\times \\nabla \\phi\\,$,\n- $\\,\\zeta = \\nabla^2 \\phi\\,$,\n- $\\,J(\\phi,\\zeta) = \\partial_x \\phi\\,\\partial_y \\zeta - \\partial_y \\phi\\,\\partial_x \\zeta\\,$,\n- The perpendicular energy density associated with the E×B flow at mode $(k_x,k_y)$ is proportional to $\\,k_\\perp^2\\,|\\phi_{k_x,k_y}|^2\\,$, where $\\,k_\\perp^2 = k_x^2 + k_y^2\\,$.\n\nUsing only the above foundational definitions and the properties of Fourier transforms on a periodic domain, derive the spectral triad interaction form of the nonlinear term and, from it, the spectral expression for the nonlinear energy transfer rate into a given mode $(k_x,k_y)$. A \"triad\" refers to a triple of wavevectors $(\\mathbf{k},\\mathbf{p},\\mathbf{q})$ satisfying $\\,\\mathbf{k}=\\mathbf{p}+\\mathbf{q}\\,$. A \"zonal flow\" denotes a mode with $\\,k_y=0\\,$ and $\\,k_x\\neq 0\\,$. A \"drift wave\" denotes a mode with $\\,k_y\\neq 0\\,$. Your task is to algorithmically compute the instantaneous nonlinear energy transfer rate from drift waves to zonal flows by summing, for each zonal mode $\\mathbf{k}$, only the triad contributions whose interacting partners $\\mathbf{p}$ and $\\mathbf{q}$ are both drift-wave modes. Express all rates in normalized, dimensionless units.\n\nImplementation details to respect:\n- Use a discrete spectral set of integer wave numbers $\\,k_x, k_y \\in \\mathbb{Z}\\,$ consistent with a $\\,2\\pi\\,$-periodic domain in both $x$ and $y$, so that derivatives in real space correspond to multiplication by $\\,i k_x\\,$ or $\\,i k_y\\,$ in spectral space.\n- Let $\\,\\phi_{k_x,k_y}\\,$ be complex amplitudes of the spectral modes.\n- The vorticity in spectral space satisfies $\\,\\zeta_{k_x,k_y} = -k_\\perp^2\\,\\phi_{k_x,k_y}\\,$.\n- The nonlinear energy transfer rate into a zonal mode $\\mathbf{k}$ is computed by contracting the mode's complex amplitude with the nonlinear spectral term obtained from the triad sum, taking the real part to produce a physically meaningful rate. The total drift-to-zonal transfer is the sum over all zonal target modes.\n\nYour program must use the following test suite of spectral configurations, each specified as a list of mode tuples $\\,[(k_x,k_y),\\phi_{k_x,k_y}]\\,$. For all cases, treat modes not listed as having zero amplitude. Compute, for each case, a single scalar representing the total nonlinear energy transfer rate from drift waves into all zonal modes present in that case, using only triads whose two interacting partners are both drift-wave modes.\n\nTest Suite:\n1. Case A (two drift waves forming a single zonal target):\n   - Modes: $\\,[(1,1),\\,1.0+0.5i],\\,[(1,-1),\\,0.7-0.2i],\\,[(2,0),\\,0.05+0.01i]\\,$.\n2. Case B (zonal-only configuration, no drift waves):\n   - Modes: $\\,[(1,0),\\,0.4+0.0i],\\,[(2,0),\\,-0.3+0.1i],\\,[(-1,0),\\,0.1-0.2i]\\,$.\n3. Case C (single drift wave plus a zonal, insufficient for a drift-drift triad):\n   - Modes: $\\,[(1,1),\\,0.6-0.5i],\\,[(2,0),\\,0.2+0.05i]\\,$.\n4. Case D (multiple drift waves forming multiple zonal targets, plus extras):\n   - Modes: $\\,[(2,2),\\,0.8+0.3i],\\,[(-1,-2),\\,-0.5+0.1i],\\,[(0,3),\\,0.4+0.9i],\\,[(1,-3),\\,0.3-0.6i],\\,[(1,2),\\,0.6-0.1i],\\,[(1,-2),\\,-0.2+0.4i],\\,[(3,2),\\,0.2+0.2i],\\,[(1,0),\\,0.15-0.05i],\\,[(2,0),\\,-0.1+0.05i],\\,[(3,0),\\,0.12-0.07i]\\,$.\n\nFinal output format:\n- Your program should produce a single line of output containing the four scalar results for Cases A–D as a comma-separated list enclosed in square brackets (e.g., \"[rA,rB,rC,rD]\"). Each scalar must be a float representing the drift-to-zonal nonlinear energy transfer rate for that case, in normalized, dimensionless units.\n\nNo external input is permitted. The program must be self-contained and compute the requested quantities directly from the provided spectral data. Angles are not involved in this problem; no angle units are required. Physical units are not required because all quantities are in normalized, dimensionless form.",
            "solution": "The problem asks to compute the nonlinear energy transfer rate from drift-wave modes to zonal-flow modes in a 2D fluid model of plasma turbulence. This requires implementing the spectral triad interaction formalism for the vorticity advection equation.\n\nThe fundamental equation governing the evolution of vorticity $\\,\\zeta(x,y,t)\\,$ in this system is the vorticity advection equation, which in the absence of linear terms and dissipation is:\n$$\n\\frac{\\partial \\zeta}{\\partial t} + \\mathbf{v}_{E\\times B} \\cdot \\nabla \\zeta = 0\n$$\nThe nonlinear advection term can be written using the Jacobian operator, $\\,J(\\phi,\\zeta)\\,$:\n$$\n\\mathbf{v}_{E\\times B} \\cdot \\nabla \\zeta = (\\hat{\\mathbf{z}} \\times \\nabla \\phi) \\cdot \\nabla \\zeta = \\frac{\\partial \\phi}{\\partial x}\\frac{\\partial \\zeta}{\\partial y} - \\frac{\\partial \\phi}{\\partial y}\\frac{\\partial \\zeta}{\\partial x} = J(\\phi, \\zeta)\n$$\nThus, the governing equation is $\\,\\partial_t \\zeta = -J(\\phi, \\zeta)\\,$.\nWe represent the fields $\\,\\phi\\,$ and $\\,\\zeta\\,$ by their complex Fourier amplitudes on a doubly periodic domain:\n$$\n\\phi(x,y) = \\sum_{\\mathbf{k}} \\phi_{\\mathbf{k}} e^{i(k_x x + k_y y)} \\quad , \\quad \\zeta(x,y) = \\sum_{\\mathbf{k}} \\zeta_{\\mathbf{k}} e^{i(k_x x + k_y y)}\n$$\nwhere $\\,\\mathbf{k}=(k_x, k_y)\\,$ is the wavevector with integer components.\nIn spectral space, the relationship $\\,\\zeta = \\nabla^2\\phi\\,$ becomes $\\,\\zeta_{\\mathbf{k}} = -k_\\perp^2 \\phi_{\\mathbf{k}}\\,$.\nThe Fourier transform of the nonlinear Jacobian term $\\,J(\\phi, \\zeta)\\,$ is a convolution over all wavevector pairs $\\,(\\mathbf{p}, \\mathbf{q})\\,$ that sum to the target wavevector $\\,\\mathbf{k}\\,$. A common, symmetric form for this convolution is:\n$$\nJ_{\\mathbf{k}} = \\frac{1}{2} \\sum_{\\mathbf{p}+\\mathbf{q}=\\mathbf{k}} (p_y q_x - p_x q_y) (p_\\perp^2 - q_\\perp^2) \\phi_{\\mathbf{p}} \\phi_{\\mathbf{q}}\n$$\nThe evolution equation for the potential $\\,\\phi_{\\mathbf{k}}\\,$ is $\\,\\partial_t \\phi_{\\mathbf{k}} = J_{\\mathbf{k}}/k_\\perp^2\\,$.\nThe perpendicular kinetic energy of mode $\\,\\mathbf{k}\\,$ is $\\,E_{\\mathbf{k}} = \\frac{1}{2} k_\\perp^2 |\\phi_{\\mathbf{k}}|^2\\,$. The nonlinear energy transfer rate into this mode, $\\,T_{\\mathbf{k}}\\,$, is its time derivative:\n$$\nT_{\\mathbf{k}} = \\frac{dE_{\\mathbf{k}}}{dt} = k_\\perp^2 \\text{Re}\\left( \\frac{\\partial \\phi_{\\mathbf{k}}}{\\partial t} \\phi_{\\mathbf{k}}^* \\right) = \\text{Re}( J_{\\mathbf{k}} \\phi_{\\mathbf{k}}^* )\n$$\nThe problem requires computing the total energy transfer rate from drift waves (modes with $\\,k_y\\neq 0\\,$) to zonal flows (modes with $\\,k_y=0, k_x \\neq 0\\,$). This is done by summing $\\,T_{\\mathbf{k}}\\,$ over all zonal modes $\\,\\mathbf{k}\\,$, with the additional constraint that the interacting partners $\\,\\mathbf{p}\\,$ and $\\,\\mathbf{q}\\,$ in the sum for $\\,J_{\\mathbf{k}}\\,$ must both be drift-wave modes.\n\nThe algorithm is as follows:\n1. For each test case, store the mode amplitudes in a dictionary.\n2. Identify the set of zonal modes and drift-wave modes.\n3. For each zonal target mode $\\mathbf{k}$, initialize its nonlinear drive term $\\,J_{\\mathbf{k}}\\,$ to zero.\n4. Iterate through all possible pairs of drift-wave modes $\\,(\\mathbf{p}, \\mathbf{q})\\,$ from the provided list.\n5. If $\\,\\mathbf{p}+\\mathbf{q}=\\mathbf{k}\\,$, calculate the contribution from this triad to $\\,J_{\\mathbf{k}}\\,$ using the formula above and add it to the total for $\\,J_{\\mathbf{k}}\\,$.\n6. After summing over all valid triads, compute the energy transfer $\\,T_{\\mathbf{k}} = \\text{Re}(\\phi_{\\mathbf{k}}^* J_{\\mathbf{k}})\\,$.\n7. The total transfer for the case is the sum of $\\,T_{\\mathbf{k}}\\,$ over all zonal targets $\\,\\mathbf{k}\\,$.\n\nThe provided Python script correctly implements this logic. It iterates through each zonal target mode and, for each, constructs the nonlinear term by summing over all valid drift-wave pairs that satisfy the triad condition. It correctly uses the symmetric coupling coefficient and accounts for double counting. The final result is the sum of the real part of the contraction of the nonlinear term with the conjugate of the zonal mode amplitude, as derived.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the nonlinear energy transfer rate from drift waves to zonal flows\n    for a series of test cases in a 2D gyrokinetic model.\n    \"\"\"\n\n    test_cases = [\n        # Case A: two drift waves forming a single zonal target\n        [((1, 1), 1.0 + 0.5j), ((1, -1), 0.7 - 0.2j), ((2, 0), 0.05 + 0.01j)],\n        # Case B: zonal-only configuration, no drift waves\n        [((1, 0), 0.4 + 0.0j), ((2, 0), -0.3 + 0.1j), ((-1, 0), 0.1 - 0.2j)],\n        # Case C: single drift wave plus a zonal, insufficient for a drift-drift triad\n        [((1, 1), 0.6 - 0.5j), ((2, 0), 0.2 + 0.05j)],\n        # Case D: multiple drift waves forming multiple zonal targets\n        [\n            ((2, 2), 0.8 + 0.3j), ((-1, -2), -0.5 + 0.1j), ((0, 3), 0.4 + 0.9j),\n            ((1, -3), 0.3 - 0.6j), ((1, 2), 0.6 - 0.1j), ((1, -2), -0.2 + 0.4j),\n            ((3, 2), 0.2 + 0.2j), ((1, 0), 0.15 - 0.05j), ((2, 0), -0.1 + 0.05j),\n            ((3, 0), 0.12 - 0.07j)\n        ],\n    ]\n\n    results = []\n    for case_modes in test_cases:\n        phi_map = {k_vec: amp for k_vec, amp in case_modes}\n        \n        all_k_vecs = set(phi_map.keys())\n        zonal_k_vecs = {k for k in all_k_vecs if k[1] == 0 and k[0] != 0}\n        drift_k_vecs = {k for k in all_k_vecs if k[1] != 0}\n\n        total_transfer_case = 0.0\n\n        if not drift_k_vecs:\n            results.append(0.0)\n            continue\n\n        for k_vec in zonal_k_vecs:\n            kx, ky = k_vec\n            \n            # This is the spectral representation of the Jacobian J(phi, zeta) for mode k.\n            J_k = 0.0j\n            \n            # Sum over all interacting drift-wave modes p.\n            for p_vec in drift_k_vecs:\n                px, py = p_vec\n                \n                # Determine the required partner mode q.\n                q_vec = (kx - px, ky - py)\n                \n                # Check if q is a drift wave and exists in the system.\n                # Since ky=0 and py!=0, qy=-py!=0, so q is automatically a drift wave.\n                # We only need to check if it's in the provided modes.\n                if q_vec not in drift_k_vecs:\n                    continue\n\n                qx, qy = q_vec\n                \n                phi_p = phi_map[p_vec]\n                phi_q = phi_map[q_vec]\n                \n                p_perp_sq = px**2 + py**2\n                q_perp_sq = qx**2 + qy**2\n                \n                # Symmetrized coupling coefficient for the triad (k, p, q)\n                # C(p,q) = (py*qx - px*qy) * (p_perp^2 - q_perp^2)\n                coupling_coeff = (py * qx - px * qy) * (p_perp_sq - q_perp_sq)\n                \n                J_k += coupling_coeff * phi_p * phi_q\n\n            # The loop over p_vec counts each (p,q) pair a second time as (q,p).\n            # The symmetric form of J_k requires a 1/2 factor to correct this.\n            J_k *= 0.5\n            \n            # Calculate energy transfer rate for mode k: T_k = Re(phi_k^* * J_k)\n            phi_k_conj = phi_map[k_vec].conjugate()\n            T_k = (phi_k_conj * J_k).real\n            \n            total_transfer_case += T_k\n\n        results.append(total_transfer_case)\n\n    # Output formatting as requested by the problem\n    # The actual problem output is just the list, not the function call.\n    # [0.0,0.0,0.0,-1.3349]\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]}]\")\n\nsolve()\n```"
        }
    ]
}