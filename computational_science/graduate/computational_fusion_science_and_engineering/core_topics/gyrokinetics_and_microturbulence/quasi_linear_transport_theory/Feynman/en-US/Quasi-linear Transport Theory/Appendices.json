{
    "hands_on_practices": [
        {
            "introduction": "The foundation of quasi-linear transport theory lies in understanding how small-scale turbulent fluctuations can produce a net, macroscopic flux of particles or heat. This first exercise guides you through the fundamental calculation of the turbulent particle flux, starting from the ubiquitous $\\mathbf{E}\\times\\mathbf{B}$ drift velocity . By working through this derivation, you will uncover the critical roles that wave geometry and the cross-phase between density and potential fluctuations play in enabling transport.",
            "id": "4198800",
            "problem": "Consider a slab plasma with uniform magnetic field $\\mathbf{B}=B\\,\\mathbf{b}$, where $\\mathbf{b}=\\hat{\\mathbf{z}}$ is a constant unit vector. Let $\\tilde{n}(\\mathbf{r},t)$ and $\\tilde{\\phi}(\\mathbf{r},t)$ denote small-amplitude turbulent fluctuations of density and electrostatic potential, respectively. The Electric Cross Magnetic (E$\\times$B) drift is defined by $\\mathbf{v}_{E}=(\\mathbf{b}\\times\\nabla\\phi)/B$. In slab geometry with coordinates $(x,y,z)$, take $x$ to be the radial direction, $y$ the binormal (poloidal-like) direction, and $z$ the direction along $\\mathbf{B}$. The quasilinear radial particle flux is defined by $\\Gamma=\\langle \\tilde{n}\\,\\tilde{v}_{E,x}\\rangle$, where the average $\\langle\\cdot\\rangle$ is over time and over the perpendicular plane.\n\nAssume the fluctuations are homogeneous and can be represented as single Fourier plane waves,\n$\\tilde{n}(\\mathbf{r},t)=\\Re\\{\\tilde{n}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}$ and $\\tilde{\\phi}(\\mathbf{r},t)=\\Re\\{\\tilde{\\phi}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}$, with wavevector $\\mathbf{k}=(k_{x},k_{y},k_{\\parallel})$. Let $\\Delta\\theta=\\arg(\\tilde{n}_{\\mathbf{k}})-\\arg(\\tilde{\\phi}_{\\mathbf{k}})$ denote the cross-phase between density and potential fluctuations.\n\nStarting from the definition of $\\mathbf{v}_{E}$ and the above representation of fluctuations, derive the quasilinear expression for the single-mode radial particle flux $\\Gamma_{\\mathbf{k}}$ that makes explicit its dependence on the binormal wavenumber $k_{y}$ and the cross-phase $\\Delta\\theta$. Express your final answer as a closed-form analytic expression in terms of $k_{y}$, $B$, $|\\tilde{n}_{\\mathbf{k}}|$, $|\\tilde{\\phi}_{\\mathbf{k}}|$, and $\\Delta\\theta$. Do not introduce any additional constants or parameters beyond those stated. No numerical evaluation is required.",
            "solution": "The problem has been validated and is deemed a well-posed, scientifically sound problem in plasma physics. I will now proceed with the derivation.\n\nThe objective is to derive the expression for the single-mode quasilinear radial particle flux, $\\Gamma_{\\mathbf{k}}$, which is defined as $\\Gamma_{\\mathbf{k}} = \\langle \\tilde{n}\\,\\tilde{v}_{E,x}\\rangle$. The average $\\langle\\cdot\\rangle$ is taken over time and the spatial plane perpendicular to the magnetic field. The fluctuations are given as single Fourier modes.\n\nFirst, we determine the radial component of the E$\\times$B drift velocity, $\\tilde{v}_{E,x}$. The E$\\times$B velocity is defined as $\\mathbf{v}_{E} = (\\mathbf{b}\\times\\nabla\\phi)/B$. For the fluctuating components, this becomes $\\tilde{\\mathbf{v}}_{E} = (\\mathbf{b}\\times\\nabla\\tilde{\\phi})/B$.\nThe magnetic field is uniform and directed along $\\hat{\\mathbf{z}}$, so $\\mathbf{b} = \\hat{\\mathbf{z}}$. The coordinates are $(x, y, z)$. The gradient of the electrostatic potential is $\\nabla\\tilde{\\phi} = \\frac{\\partial\\tilde{\\phi}}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial\\tilde{\\phi}}{\\partial y}\\hat{\\mathbf{y}} + \\frac{\\partial\\tilde{\\phi}}{\\partial z}\\hat{\\mathbf{z}}$.\nThe cross product is:\n$$\n\\mathbf{b}\\times\\nabla\\tilde{\\phi} = \\hat{\\mathbf{z}} \\times \\left( \\frac{\\partial\\tilde{\\phi}}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial\\tilde{\\phi}}{\\partial y}\\hat{\\mathbf{y}} + \\frac{\\partial\\tilde{\\phi}}{\\partial z}\\hat{\\mathbf{z}} \\right) = \\frac{\\partial\\tilde{\\phi}}{\\partial x}(\\hat{\\mathbf{z}}\\times\\hat{\\mathbf{x}}) + \\frac{\\partial\\tilde{\\phi}}{\\partial y}(\\hat{\\mathbf{z}}\\times\\hat{\\mathbf{y}}) = \\frac{\\partial\\tilde{\\phi}}{\\partial x}\\hat{\\mathbf{y}} - \\frac{\\partial\\tilde{\\phi}}{\\partial y}\\hat{\\mathbf{x}}\n$$\nThe fluctuating E$\\times$B velocity is therefore:\n$$\n\\tilde{\\mathbf{v}}_{E} = \\frac{1}{B}\\left(-\\frac{\\partial\\tilde{\\phi}}{\\partial y}\\hat{\\mathbf{x}} + \\frac{\\partial\\tilde{\\phi}}{\\partial x}\\hat{\\mathbf{y}}\\right)\n$$\nThe radial component is the $x$-component, so:\n$$\n\\tilde{v}_{E,x} = -\\frac{1}{B}\\frac{\\partial\\tilde{\\phi}}{\\partial y}\n$$\nThe problem specifies that the fluctuations are single Fourier plane waves:\n$$\n\\tilde{n}(\\mathbf{r},t) = \\Re\\{\\tilde{n}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}\n$$\n$$\n\\tilde{\\phi}(\\mathbf{r},t) = \\Re\\{\\tilde{\\phi}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}\n$$\nwhere $\\tilde{n}_{\\mathbf{k}}$ and $\\tilde{\\phi}_{\\mathbf{k}}$ are the complex amplitudes of the density and potential fluctuations for the wavevector $\\mathbf{k}=(k_x, k_y, k_\\parallel)$. We need to calculate the partial derivative of $\\tilde{\\phi}$ with respect to $y$. The spatial derivative of the real part of a complex function is the real part of its derivative.\n$$\n\\frac{\\partial\\tilde{\\phi}}{\\partial y} = \\frac{\\partial}{\\partial y} \\Re\\{\\tilde{\\phi}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\} = \\Re\\left\\{\\frac{\\partial}{\\partial y} (\\tilde{\\phi}_{\\mathbf{k}}\\exp[i(k_x x + k_y y + k_\\parallel z - \\omega t)])\\right\\}\n$$\n$$\n\\frac{\\partial\\tilde{\\phi}}{\\partial y} = \\Re\\{i k_y \\tilde{\\phi}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}\n$$\nSubstituting this into the expression for $\\tilde{v}_{E,x}$:\n$$\n\\tilde{v}_{E,x} = -\\frac{1}{B} \\Re\\{i k_y \\tilde{\\phi}_{\\mathbf{k}}\\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}\n$$\nNow we must compute the average of the product $\\langle \\tilde{n}\\,\\tilde{v}_{E,x}\\rangle$. A general result for the average of the product of two real oscillatory quantities $A(t) = \\Re\\{A_0 e^{-i\\omega t}\\}$ and $B(t) = \\Re\\{B_0 e^{-i\\omega t}\\}$ is $\\langle A(t) B(t) \\rangle = \\frac{1}{2}\\Re\\{A_0 B_0^*\\}$, where $A_0$ and $B_0$ are the complex amplitudes and the average is over one period. This formula generalizes to spatiotemporal averages for plane waves.\n\nIn our case, the two quantities are $\\tilde{n}$ and $\\tilde{v}_{E,x}$. Let us identify their complex amplitudes.\nFor the density fluctuation $\\tilde{n}$, the complex amplitude is $\\tilde{n}_{\\mathbf{k}}$.\nFor the radial velocity fluctuation $\\tilde{v}_{E,x}$, the expression is $\\Re\\{A_0 \\exp[i(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t)]\\}$ where the complex amplitude $A_0$ is $-\\frac{ik_y}{B}\\tilde{\\phi}_{\\mathbf{k}}$. Let's call this amplitude $\\tilde{v}_{E,x,\\mathbf{k}}$.\n$$\n\\tilde{v}_{E,x,\\mathbf{k}} = -\\frac{i k_y}{B}\\tilde{\\phi}_{\\mathbf{k}}\n$$\nUsing the averaging formula, the radial particle flux for the mode $\\mathbf{k}$ is:\n$$\n\\Gamma_{\\mathbf{k}} = \\langle \\tilde{n}\\,\\tilde{v}_{E,x}\\rangle = \\frac{1}{2}\\Re\\{\\tilde{n}_{\\mathbf{k}} (\\tilde{v}_{E,x,\\mathbf{k}})^*\\}\n$$\nwhere $(\\cdot)^*$ denotes the complex conjugate. We compute the conjugate of $\\tilde{v}_{E,x,\\mathbf{k}}$:\n$$\n(\\tilde{v}_{E,x,\\mathbf{k}})^* = \\left(-\\frac{i k_y}{B}\\tilde{\\phi}_{\\mathbf{k}}\\right)^* = \\left(\\frac{-i k_y}{B}\\right)^* (\\tilde{\\phi}_{\\mathbf{k}})^* = \\frac{i k_y}{B} \\tilde{\\phi}_{\\mathbf{k}}^*\n$$\nSubstituting this into the expression for $\\Gamma_{\\mathbf{k}}$:\n$$\n\\Gamma_{\\mathbf{k}} = \\frac{1}{2}\\Re\\left\\{\\tilde{n}_{\\mathbf{k}} \\left(\\frac{i k_y}{B} \\tilde{\\phi}_{\\mathbf{k}}^*\\right)\\right\\} = \\frac{k_y}{2B}\\Re\\{i\\, \\tilde{n}_{\\mathbf{k}} \\tilde{\\phi}_{\\mathbf{k}}^*\\}\n$$\nThe problem defines the cross-phase $\\Delta\\theta$ between density and potential fluctuations as $\\Delta\\theta = \\arg(\\tilde{n}_{\\mathbf{k}}) - \\arg(\\tilde{\\phi}_{\\mathbf{k}})$. Let's express the complex amplitudes in polar form:\n$$\n\\tilde{n}_{\\mathbf{k}} = |\\tilde{n}_{\\mathbf{k}}|\\exp(i\\arg(\\tilde{n}_{\\mathbf{k}}))\n$$\n$$\n\\tilde{\\phi}_{\\mathbf{k}} = |\\tilde{\\phi}_{\\mathbf{k}}|\\exp(i\\arg(\\tilde{\\phi}_{\\mathbf{k}})) \\implies \\tilde{\\phi}_{\\mathbf{k}}^* = |\\tilde{\\phi}_{\\mathbf{k}}|\\exp(-i\\arg(\\tilde{\\phi}_{\\mathbf{k}}))\n$$\nThe product $\\tilde{n}_{\\mathbf{k}}\\tilde{\\phi}_{\\mathbf{k}}^*$ is then:\n$$\n\\tilde{n}_{\\mathbf{k}}\\tilde{\\phi}_{\\mathbf{k}}^* = |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\exp(i(\\arg(\\tilde{n}_{\\mathbf{k}})-\\arg(\\tilde{\\phi}_{\\mathbf{k}}))) = |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\exp(i\\Delta\\theta)\n$$\nNow, substitute this into the expression for the flux:\n$$\n\\Gamma_{\\mathbf{k}} = \\frac{k_y}{2B}\\Re\\{i |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\exp(i\\Delta\\theta)\\}\n$$\nUsing Euler's formula, $\\exp(i\\Delta\\theta) = \\cos(\\Delta\\theta) + i\\sin(\\Delta\\theta)$, we get:\n$$\ni \\exp(i\\Delta\\theta) = i\\cos(\\Delta\\theta) + i^2\\sin(\\Delta\\theta) = i\\cos(\\Delta\\theta) - \\sin(\\Delta\\theta)\n$$\nThe real part of this expression is:\n$$\n\\Re\\{i \\exp(i\\Delta\\theta)\\} = -\\sin(\\Delta\\theta)\n$$\nTherefore, the argument of the real part operator in the flux expression becomes:\n$$\n\\Re\\{i |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\exp(i\\Delta\\theta)\\} = |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\Re\\{i \\exp(i\\Delta\\theta)\\} = -|\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\sin(\\Delta\\theta)\n$$\nFinally, substituting this back into the expression for $\\Gamma_{\\mathbf{k}}$ gives the desired result:\n$$\n\\Gamma_{\\mathbf{k}} = \\frac{k_y}{2B} \\left( -|\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|\\sin(\\Delta\\theta) \\right)\n$$\n$$\n\\Gamma_{\\mathbf{k}} = -\\frac{k_y |\\tilde{n}_{\\mathbf{k}}||\\tilde{\\phi}_{\\mathbf{k}}|}{2B}\\sin(\\Delta\\theta)\n$$\nThis expression shows the explicit dependence of the single-mode radial particle flux on the binormal wavenumber $k_y$, the magnetic field strength $B$, the amplitudes of the density and potential fluctuations $|\\tilde{n}_{\\mathbf{k}}|$ and $|\\tilde{\\phi}_{\\mathbf{k}}|$, and their cross-phase $\\Delta\\theta$.",
            "answer": "$$\n\\boxed{-\\frac{k_y |\\tilde{n}_{\\mathbf{k}}| |\\tilde{\\phi}_{\\mathbf{k}}|}{2B} \\sin(\\Delta\\theta)}\n$$"
        },
        {
            "introduction": "While the previous problem established how a flux can exist, a predictive theory must also estimate its magnitude. This practice  bridges the gap between abstract linear stability analysis and a concrete transport coefficient by having you construct a quasi-linear model for the ion heat diffusivity, $\\chi_i$. You will synthesize concepts like mixing-length estimates, linear growth rates, and Finite-Larmor-Radius (FLR) effects into a computable formula, demonstrating a core skill in building practical transport models.",
            "id": "4034363",
            "problem": "Consider an electrostatic Ion Temperature Gradient (ITG) mode in a magnetized plasma, and assume a regime with $k_{\\perp} \\rho_i \\sim O(1)$, where $k_{\\perp}$ is the perpendicular wavenumber and $\\rho_i$ is the ion Larmor radius. Quasi-linear transport theory estimates the ion heat diffusivity $ \\chi_i $ by aggregating statistically independent contributions from a spectrum of modes indexed by the binormal wavenumber $k_y$. Begin your derivation from the following fundamental bases:\n\n- The gyrofrequency definition $ \\Omega_i = \\frac{q_i B}{m_i} $, where $q_i$ is the ion charge, $B$ is the magnetic field strength in $\\mathrm{Tesla}$, and $m_i$ is the ion mass in $\\mathrm{kg}$.\n- The ion thermal speed $ v_{\\mathrm{thi}} = \\sqrt{\\frac{2 T_i}{m_i}} $, where $T_i$ is the ion temperature in $\\mathrm{J}$.\n- The ion Larmor radius $ \\rho_i = \\frac{v_{\\mathrm{thi}}}{\\Omega_i} $.\n- The random phase approximation and decorrelation argument for diffusive transport of a passive scalar (background ion temperature), implying a random-walk with step size set by the perpendicular correlation length and step time set by the inverse linear growth rate.\n\nUse these principles to derive a computable quasi-linear expression for $ \\chi_i $ as a weighted sum over discrete $k_y$ modes. The weights must arise from physically justified linear eigenfunction properties of the ITG mode: explicitly include the effect of finite-Larmor-radius averaging through the zeroth-order Bessel function of the first kind $J_0(k_{\\perp} \\rho_i)$ and a cross-phase angle $ \\theta_k $ (in radians) between the fluctuating electrostatic potential and the fluctuating ion temperature that emerges from the linear eigenfunction. The final expression must be dimensionally consistent, and the final numerical values of $ \\chi_i $ must be expressed in $\\mathrm{m}^2/\\mathrm{s}$.\n\nYou must implement your derived formula into a complete, runnable program that, for each test case below, computes $ \\chi_i $ by summing over the provided discrete set of modes. Take the perpendicular wavenumber in each mode to be $ k_{\\perp} = \\sqrt{k_x^2 + k_y^2} $, and model the spectral anisotropy by a constant ratio $ \\alpha = \\frac{k_x}{k_y} $ supplied per test case, so that $ k_{\\perp} = k_y \\sqrt{1 + \\alpha^2} $. For each mode, you are given the dimensionless parameter $ s_j = k_{\\perp j} \\rho_i $, the linear growth rate $ \\gamma_j $ in $\\mathrm{s}^{-1}$, and the cross-phase angle $ \\theta_j $ in radians. The ion species is deuterium with charge $ q_i = e $ and mass $ m_i $ explicitly specified. Convert $ T_i $ from $\\mathrm{keV}$ to $\\mathrm{J}$ using $ 1\\,\\mathrm{eV} = 1.602\\,176\\,634 \\times 10^{-19}\\,\\mathrm{J} $.\n\nTest suite and data (each bullet is one test case):\n- Case $1$ (happy path):\n  - $B = 2.0\\,\\mathrm{T}$, $T_i = 2.5\\,\\mathrm{keV}$, $m_i = 3.343 \\times 10^{-27}\\,\\mathrm{kg}$, $\\alpha = 1.0$\n  - Modes: $s = [0.6, 1.0, 1.4]$, $\\gamma = [4.0 \\times 10^{5}, 1.2 \\times 10^{6}, 8.0 \\times 10^{5}]\\,\\mathrm{s}^{-1}$, $\\theta = [0.35, 0.50, 0.40]\\,\\mathrm{rad}$\n- Case $2$ (strong magnetic field; finite-Larmor-radius suppression more pronounced):\n  - $B = 5.0\\,\\mathrm{T}$, $T_i = 1.5\\,\\mathrm{keV}$, $m_i = 3.343 \\times 10^{-27}\\,\\mathrm{kg}$, $\\alpha = 0.7$\n  - Modes: $s = [0.8, 1.2]$, $\\gamma = [3.0 \\times 10^{5}, 7.0 \\times 10^{5}]\\,\\mathrm{s}^{-1}$, $\\theta = [0.30, 0.45]\\,\\mathrm{rad}$\n- Case $3$ (boundary condition with a marginally stable mode):\n  - $B = 3.0\\,\\mathrm{T}$, $T_i = 3.0\\,\\mathrm{keV}$, $m_i = 3.343 \\times 10^{-27}\\,\\mathrm{kg}$, $\\alpha = 1.3$\n  - Modes: $s = [0.5, 1.0, 2.0]$, $\\gamma = [0.0, 9.0 \\times 10^{5}, 4.0 \\times 10^{5}]\\,\\mathrm{s}^{-1}$, $\\theta = [0.40, 0.60, 0.20]\\,\\mathrm{rad}$\n- Case $4$ (edge case with strong anisotropy):\n  - $B = 1.5\\,\\mathrm{T}$, $T_i = 1.0\\,\\mathrm{keV}$, $m_i = 3.343 \\times 10^{-27}\\,\\mathrm{kg}$, $\\alpha = 3.0$\n  - Modes: $s = [1.0]$, $\\gamma = [1.0 \\times 10^{5}]\\,\\mathrm{s}^{-1}$, $\\theta = [0.50]\\,\\mathrm{rad}$\n\nAngle inputs must be interpreted in radians. Your program must compute $ \\chi_i $ for each test case and produce a single line of output containing the results as a comma-separated list enclosed in square brackets in units of $\\mathrm{m}^2/\\mathrm{s}$ (for example, $[x_1,x_2,x_3,x_4]$ where each $x_i$ is a floating-point number).",
            "solution": "The problem requires the derivation and implementation of a computable quasi-linear expression for the ion heat diffusivity, $\\chi_i$, in a magnetized plasma with Ion Temperature Gradient (ITG) turbulence. The derivation must be grounded in the provided physical principles.\n\n### Derivation of the Quasi-linear Ion Heat Diffusivity $\\chi_i$\n\n1.  **Random-Walk Model for Diffusion**\n    The problem statement establishes the framework of a random-walk process for diffusive transport. In such a model, the diffusion coefficient, here the ion heat diffusivity $\\chi_i$, is approximated by the relation:\n    $$ \\chi_i \\approx \\frac{(\\Delta x)^2}{\\Delta t} $$\n    where $\\Delta x$ is the characteristic spatial step size of the random walk, and $\\Delta t$ is the characteristic time between steps.\n\n2.  **Identification of Characteristic Scales**\n    The problem guides the identification of these scales within the context of plasma turbulence:\n    -   The step time $\\Delta t$ is the decorrelation time of the turbulent fluctuations. For a linear instability, this is reasonably approximated by the inverse of its linear growth rate, $\\gamma$. Thus, for a mode with index $j$, we have $\\Delta t_j = 1/\\gamma_j$.\n    -   The step size $\\Delta x$ is the perpendicular correlation length of the turbulent eddies. In mixing-length theory, this is taken to be proportional to the inverse of the perpendicular wavenumber, $k_{\\perp}$. Thus, for a mode $j$, $\\Delta x_j \\sim 1/k_{\\perp j}$.\n\n3.  **Basic Mixing-Length Diffusivity**\n    Substituting these scales into the random-walk formula gives the fundamental mixing-length estimate for the diffusivity contribution from a single mode $j$:\n    $$ \\chi_{i,j} \\sim \\frac{(1/k_{\\perp j})^2}{1/\\gamma_j} = \\frac{\\gamma_j}{k_{\\perp j}^2} $$\n    This expression is dimensionally consistent, with units of $(\\mathrm{s}^{-1}) / (\\mathrm{m}^{-1})^2 = \\mathrm{m}^2/\\mathrm{s}$.\n\n4.  **Incorporation of Physical Weighting Factors**\n    The problem requires the explicit inclusion of two additional physical effects that modulate the transport efficiency:\n    -   **Finite-Larmor-Radius (FLR) Averaging**: An ion does not experience the point value of the fluctuating electric field, but rather the field averaged over its gyromotion orbit. This averaging effect reduces the ion's response to short-wavelength fluctuations. For a wave with perpendicular wavenumber $k_{\\perp j}$, this reduction is mathematically described by the zeroth-order Bessel function of the first kind, $J_0(k_{\\perp j} \\rho_i)$, where $\\rho_i$ is the ion Larmor radius. Since the flux and diffusivity are quadratic in the fluctuating fields or particle responses, the diffusivity is scaled by a factor of $J_0^2(k_{\\perp j} \\rho_i)$.\n    -   **Cross-Phase Angle**: Net transport of heat requires a phase difference between the fluctuating radial velocity (driven by the electrostatic potential fluctuation $\\tilde{\\phi}$) and the ion temperature fluctuation $\\tilde{T}_i$. The radial heat flux $Q_r$ is proportional to the time-average $\\langle \\tilde{v}_{Er} \\tilde{T}_i \\rangle$. This average is non-zero only if there is a phase shift. The magnitude of the resulting flux is proportional to $\\sin(\\theta_j)$, where $\\theta_j$ is the cross-phase angle between the potential and temperature fluctuations. Therefore, the diffusivity must be weighted by a factor of $\\sin(\\theta_j)$.\n\n5.  **Assembling the Complete Formula for a Single Mode**\n    Combining the mixing-length estimate with the physical weighting factors, and assuming a leading dimensionless constant of order unity (which we set to $1$ as is common in such estimates), the diffusivity contribution from a single mode $j$ is:\n    $$ \\chi_{i,j} = \\frac{\\gamma_j}{k_{\\perp j}^2} J_0^2(k_{\\perp j} \\rho_i) \\sin(\\theta_j) $$\n\n6.  **Total Diffusivity and Final Computable Expression**\n    The total heat diffusivity $\\chi_i$ is the sum of contributions from all statistically independent modes in the turbulent spectrum. For the discrete set of modes provided:\n    $$ \\chi_i = \\sum_j \\chi_{i,j} = \\sum_j \\frac{\\gamma_j}{k_{\\perp j}^2} J_0^2(k_{\\perp j} \\rho_i) \\sin(\\theta_j) $$\n    The problem provides the dimensionless parameter $s_j = k_{\\perp j} \\rho_i$. We can express $k_{\\perp j}$ as $s_j / \\rho_i$. Substituting this into the sum gives:\n    $$ \\chi_i = \\sum_j \\frac{\\gamma_j}{(s_j / \\rho_i)^2} J_0^2(s_j) \\sin(\\theta_j) = \\sum_j \\frac{\\gamma_j \\rho_i^2}{s_j^2} J_0^2(s_j) \\sin(\\theta_j) $$\n    Factoring out the constant $\\rho_i^2$, we arrive at the final computational formula:\n    $$ \\chi_i = \\rho_i^2 \\sum_j \\frac{\\gamma_j}{s_j^2} J_0^2(s_j) \\sin(\\theta_j) $$\n    Note that the spectral anisotropy parameter $\\alpha = k_x/k_y$ is provided as physical context but is not required for the calculation, as the effective perpendicular mode structure is already encapsulated in the given parameter $s_j = k_{\\perp j} \\rho_i$.\n\n### Calculation of Auxiliary Parameters\n\nThe ion Larmor radius $\\rho_i$ must be calculated from the given plasma parameters.\n- The ion temperature $T_i$ is given in $\\mathrm{keV}$ and must be converted to Joules ($J$):\n  $T_i\\,(\\mathrm{J}) = T_i\\,(\\mathrm{keV}) \\times 1000 \\times (1.602\\,176\\,634 \\times 10^{-19}\\,\\mathrm{J/eV})$.\n- The ion thermal speed $v_{\\mathrm{thi}}$ is given by:\n  $v_{\\mathrm{thi}} = \\sqrt{\\frac{2 T_i}{m_i}}$.\n- The ion gyrofrequency $\\Omega_i$ is given by:\n  $\\Omega_i = \\frac{q_i B}{m_i}$, where $q_i = e = 1.602\\,176\\,634 \\times 10^{-19}\\,\\mathrm{C}$.\n- The ion Larmor radius $\\rho_i$ is therefore:\n  $$ \\rho_i = \\frac{v_{\\mathrm{thi}}}{\\Omega_i} = \\frac{\\sqrt{2 T_i / m_i}}{q_i B / m_i} = \\frac{\\sqrt{2 T_i m_i}}{q_i B} $$\nAll quantities in this expression must be in base SI units ($T_i$ in J, $m_i$ in kg, $q_i$ in C, $B$ in T) to yield $\\rho_i$ in meters.\n\n### Algorithm Summary\nFor each test case:\n1.  Define the physical constants $e$ and the eV-to-J conversion factor.\n2.  Convert the input ion temperature $T_i$ from $\\mathrm{keV}$ to Joules.\n3.  Calculate the ion Larmor radius $\\rho_i$ using the formula above.\n4.  Initialize a sum variable, e.g., `sum_val`, to $0.0$.\n5.  Iterate through each mode $j$ with parameters $(s_j, \\gamma_j, \\theta_j)$:\n    -   If $\\gamma_j = 0$ or $s_j = 0$, the contribution is $0$.\n    -   Otherwise, calculate the term $T_j = \\frac{\\gamma_j}{s_j^2} J_0^2(s_j) \\sin(\\theta_j)$.\n    -   Add $T_j$ to `sum_val`.\n6.  Calculate the final diffusivity as $\\chi_i = \\rho_i^2 \\times \\text{sum\\_val}$.\n7.  The result is in units of $\\mathrm{m}^2/\\mathrm{s}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j0\n\ndef solve():\n    \"\"\"\n    Solves the quasi-linear transport problem for all test cases.\n    \"\"\"\n    \n    # Define fundamental constants\n    E_CHARGE = 1.602176634e-19  # Elementary charge in C\n    EV_TO_JOULE = 1.602176634e-19 # eV to Joule conversion factor\n    KEV_TO_JOULE = EV_TO_JOULE * 1000.0\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary for clarity.\n    test_cases = [\n        {\n            \"B\": 2.0, \"Ti_keV\": 2.5, \"mi\": 3.343e-27, \"alpha\": 1.0,\n            \"modes\": {\n                \"s\": [0.6, 1.0, 1.4],\n                \"gamma\": [4.0e5, 1.2e6, 8.0e5],\n                \"theta\": [0.35, 0.50, 0.40]\n            }\n        },\n        {\n            \"B\": 5.0, \"Ti_keV\": 1.5, \"mi\": 3.343e-27, \"alpha\": 0.7,\n            \"modes\": {\n                \"s\": [0.8, 1.2],\n                \"gamma\": [3.0e5, 7.0e5],\n                \"theta\": [0.30, 0.45]\n            }\n        },\n        {\n            \"B\": 3.0, \"Ti_keV\": 3.0, \"mi\": 3.343e-27, \"alpha\": 1.3,\n            \"modes\": {\n                \"s\": [0.5, 1.0, 2.0],\n                \"gamma\": [0.0, 9.0e5, 4.0e5],\n                \"theta\": [0.40, 0.60, 0.20]\n            }\n        },\n        {\n            \"B\": 1.5, \"Ti_keV\": 1.0, \"mi\": 3.343e-27, \"alpha\": 3.0,\n            \"modes\": {\n                \"s\": [1.0],\n                \"gamma\": [1.0e5],\n                \"theta\": [0.50]\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_chi_i(case, E_CHARGE, KEV_TO_JOULE)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef calculate_chi_i(case_data, q_i, kev_to_j):\n    \"\"\"\n    Calculates the ion heat diffusivity chi_i for a single test case.\n\n    The formula used is derived from quasi-linear theory and mixing-length arguments:\n    chi_i = rho_i^2 * sum_j [ (gamma_j / s_j^2) * J_0(s_j)^2 * sin(theta_j) ]\n    where rho_i = sqrt(2 * T_i * m_i) / (q_i * B)\n    \"\"\"\n    B = case_data[\"B\"]          # Magnetic field in Tesla\n    Ti_keV = case_data[\"Ti_keV\"]  # Ion temperature in keV\n    m_i = case_data[\"mi\"]         # Ion mass in kg\n    modes = case_data[\"modes\"]    # Dictionary of mode arrays for s, gamma, theta\n\n    # Convert ion temperature from keV to Joules\n    T_i_J = Ti_keV * kev_to_j\n\n    # Calculate the ion Larmor radius (rho_i) in meters\n    # rho_i = (v_thi) / Omega_i = (sqrt(2*Ti/mi)) / (q*B/mi) = sqrt(2*Ti*mi)/(q*B)\n    numerator = np.sqrt(2 * T_i_J * m_i)\n    denominator = q_i * B\n    rho_i = numerator / denominator\n\n    # Sum the contributions from each mode\n    sum_val = 0.0\n    num_modes = len(modes[\"s\"])\n    \n    for j in range(num_modes):\n        s_j = modes[\"s\"][j]\n        gamma_j = modes[\"gamma\"][j]\n        theta_j = modes[\"theta\"][j]\n\n        # A marginally stable mode (gamma=0) or a k_perp=0 mode (s=0) does not contribute to transport.\n        if gamma_j == 0.0 or s_j == 0.0:\n            continue\n        \n        # Calculate single mode contribution to the sum\n        j0_val = j0(s_j)\n        sin_theta = np.sin(theta_j)\n        \n        term = (gamma_j / s_j**2) * (j0_val**2) * sin_theta\n        sum_val += term\n        \n    # Final diffusivity calculation\n    chi_i = rho_i**2 * sum_val\n    \n    return chi_i\n\nsolve()\n```"
        },
        {
            "introduction": "Quasi-linear theory is a powerful but ultimately simplified description of a complex nonlinear system. This final practice  introduces a research-level task: critically evaluating the fidelity of a quasi-linear model against a synthetic \"ground truth\" from a nonlinear simulation. You will implement a diagnostic framework that decomposes the prediction error into distinct physical components, providing deep insight into the limitations of the theory and the nature of turbulent saturation mechanisms.",
            "id": "4198772",
            "problem": "Consider electrostatic, ion-scale turbulence dominated by the Ion Temperature Gradient (ITG) instability in a magnetized fusion plasma, modeled within the gyrokinetic framework. The goal is to compare quasilinear predictions of the radial particle flux and heat flux against synthetic nonlinear gyrokinetic simulation outputs, and analyze discrepancies in terms of spectral mismatches and cross-phase (linear response) mismatches.\n\nStart from the following fundamental physical base:\n- The E cross B drift velocity is given by $\\mathbf{v}_{E} = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^{2}}$, and the radial component in Fourier space for mode $\\mathbf{k}$ is proportional to $k_{y} \\tilde{\\phi}_{\\mathbf{k}}$ in standard gyrokinetic normalization.\n- Define the fluctuation fields in Fourier space $\\tilde{\\phi}_{\\mathbf{k}}$, $\\tilde{n}_{\\mathbf{k}}$, and $\\tilde{T}_{\\mathbf{k}}$, where $\\tilde{\\phi}$ is the electrostatic potential, $\\tilde{n}$ is the density fluctuation, and $\\tilde{T}$ is the temperature fluctuation.\n- The spectral particle flux density for mode $\\mathbf{k}$ in normalized units is $k_{y} \\,\\mathrm{Im}\\left[\\tilde{n}_{\\mathbf{k}} \\tilde{\\phi}_{\\mathbf{k}}^{*}\\right]$, and the spectral heat flux density is $k_{y} \\,\\mathrm{Im}\\left[\\tilde{T}_{\\mathbf{k}} \\tilde{\\phi}_{\\mathbf{k}}^{*}\\right]$. The total fluxes are sums over modes.\n\nUnder the quasilinear approximation for ITG-dominated, electrostatic turbulence in normalized gyro-Bohm units (dimensionless), assume linear response relations\n$$\\tilde{n}_{\\mathbf{k}} = C_{n}(\\mathbf{k}) \\tilde{\\phi}_{\\mathbf{k}}, \\quad \\tilde{T}_{\\mathbf{k}} = C_{T}(\\mathbf{k}) \\tilde{\\phi}_{\\mathbf{k}},$$\nwith complex response coefficients $C_{n}(\\mathbf{k})$ and $C_{T}(\\mathbf{k})$. Then the quasilinear fluxes can be written in terms of the potential spectrum $S(\\mathbf{k}) = |\\tilde{\\phi}_{\\mathbf{k}}|^{2}$ as\n$$\\Gamma_{\\mathrm{QL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\, S(\\mathbf{k}), \\quad Q_{\\mathrm{QL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\, S(\\mathbf{k}).$$\n\nUse a mixing-length estimate for the quasilinear potential spectrum,\n$$S_{\\mathrm{QL}}(\\mathbf{k}) = \\frac{\\gamma_{\\mathbf{k}}}{k_{\\perp}^{2}},$$\nwith linear growth rate $\\gamma_{\\mathbf{k}}$ and perpendicular wavenumber $k_{\\perp}$; assume $k_{\\perp}^{2} = k_{y}^{2}$ for these electrostatic ITG cases.\n\nTo represent synthetic nonlinear gyrokinetic simulation outputs, you are provided with nonlinear response coefficients $C_{n,\\mathrm{NL}}(\\mathbf{k})$, $C_{T,\\mathrm{NL}}(\\mathbf{k})$, and a nonlinear potential spectrum $S_{\\mathrm{NL}}(\\mathbf{k})$. The nonlinear fluxes are\n$$\\Gamma_{\\mathrm{NL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n,\\mathrm{NL}}(\\mathbf{k})\\right] \\, S_{\\mathrm{NL}}(\\mathbf{k}), \\quad Q_{\\mathrm{NL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T,\\mathrm{NL}}(\\mathbf{k})\\right] \\, S_{\\mathrm{NL}}(\\mathbf{k}).$$\n\nDefine the discrepancy decomposition into two additive contributions:\n- Spectrum contribution:\n$$\\Delta \\Gamma_{\\mathrm{spec}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\left[ S_{\\mathrm{NL}}(\\mathbf{k}) - S_{\\mathrm{QL}}(\\mathbf{k}) \\right], \\quad \\Delta Q_{\\mathrm{spec}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\left[ S_{\\mathrm{NL}}(\\mathbf{k}) - S_{\\mathrm{QL}}(\\mathbf{k}) \\right],$$\n- Cross-phase (response) contribution:\n$$\\Delta \\Gamma_{\\mathrm{phase}} = \\sum_{\\mathbf{k}} k_{y} \\left\\{ \\mathrm{Im}\\left[C_{n,\\mathrm{NL}}(\\mathbf{k})\\right] - \\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\right\\} S_{\\mathrm{NL}}(\\mathbf{k}), \\quad \\Delta Q_{\\mathrm{phase}} = \\sum_{\\mathbf{k}} k_{y} \\left\\{ \\mathrm{Im}\\left[C_{T,\\mathrm{NL}}(\\mathbf{k})\\right] - \\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\right\\} S_{\\mathrm{NL}}(\\mathbf{k}).$$\n\nThese satisfy\n$$\\left(\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}\\right) = \\Delta \\Gamma_{\\mathrm{spec}} + \\Delta \\Gamma_{\\mathrm{phase}}, \\quad \\left(Q_{\\mathrm{NL}} - Q_{\\mathrm{QL}}\\right) = \\Delta Q_{\\mathrm{spec}} + \\Delta Q_{\\mathrm{phase}}.$$\n\nDefine the relative error metrics\n$$r_{\\Gamma} = \\frac{\\Gamma_{\\mathrm{QL}} - \\Gamma_{\\mathrm{NL}}}{\\Gamma_{\\mathrm{NL}}}, \\quad r_{Q} = \\frac{Q_{\\mathrm{QL}} - Q_{\\mathrm{NL}}}{Q_{\\mathrm{NL}}},$$\nand the signed attribution fractions\n$$f_{\\Gamma,\\mathrm{spec}} = \\frac{\\Delta \\Gamma_{\\mathrm{spec}}}{\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}}, \\quad f_{\\Gamma,\\mathrm{phase}} = \\frac{\\Delta \\Gamma_{\\mathrm{phase}}}{\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}},$$\n$$f_{Q,\\mathrm{spec}} = \\frac{\\Delta Q_{\\mathrm{spec}}}{Q_{\\mathrm{NL}} - Q_{\\mathrm{QL}}}, \\quad f_{Q,\\mathrm{phase}} = \\frac{\\Delta Q_{\\mathrm{phase}}}{Q_{\\mathrm{NL}} - Q_{\\mathrm{QL}}}.$$\nNote that these signed fractions can be negative or exceed unity if contributions partially cancel or reinforce.\n\nAll fluxes must be expressed in dimensionless normalized gyro-Bohm units. When the denominator in a relative error or attribution fraction is smaller than the tolerance $10^{-12}$ in magnitude, define the output for that metric as $0.0$.\n\nImplement a program that, for each test case, computes $\\Gamma_{\\mathrm{QL}}$, $Q_{\\mathrm{QL}}$, $\\Gamma_{\\mathrm{NL}}$, $Q_{\\mathrm{NL}}$, $r_{\\Gamma}$, $r_{Q}$, $f_{\\Gamma,\\mathrm{spec}}$, $f_{\\Gamma,\\mathrm{phase}}$, $f_{Q,\\mathrm{spec}}$, and $f_{Q,\\mathrm{phase}}$, and returns for each case the list\n$$[r_{\\Gamma}, r_{Q}, f_{\\Gamma,\\mathrm{spec}}, f_{\\Gamma,\\mathrm{phase}}, f_{Q,\\mathrm{spec}}, f_{Q,\\mathrm{phase}}].$$\n\nUse the following test suite that probes a typical ITG \"happy path,\" a near-zero cross-phase boundary case, and a sign-reversal edge case. For each case, a one-dimensional list of $k_{y}$ modes is provided, with $k_{\\perp}^{2} = k_{y}^{2}$, along with quasilinear and nonlinear response coefficients and spectra inputs:\n\nTest case $1$ (ITG-dominated, moderate cross-phase):\n- $k_{y}$: $[0.1, 0.2, 0.3, 0.4, 0.5]$,\n- $\\gamma_{\\mathbf{k}}$: $[0.05, 0.10, 0.12, 0.09, 0.04]$,\n- $C_{n}(\\mathbf{k})$: $[0.50 + 0.10 i, 0.40 + 0.12 i, 0.35 + 0.15 i, 0.30 + 0.12 i, 0.25 + 0.08 i]$,\n- $C_{T}(\\mathbf{k})$: $[1.00 + 0.25 i, 0.90 + 0.30 i, 0.85 + 0.35 i, 0.80 + 0.30 i, 0.70 + 0.20 i]$,\n- $C_{n,\\mathrm{NL}}(\\mathbf{k})$: $[0.48 + 0.08 i, 0.38 + 0.10 i, 0.33 + 0.12 i, 0.28 + 0.09 i, 0.24 + 0.06 i]$,\n- $C_{T,\\mathrm{NL}}(\\mathbf{k})$: $[0.95 + 0.20 i, 0.85 + 0.28 i, 0.80 + 0.32 i, 0.75 + 0.27 i, 0.65 + 0.18 i]$,\n- $S_{\\mathrm{NL}}(\\mathbf{k})$ defined by $S_{\\mathrm{NL}}(\\mathbf{k}) = S_{\\mathrm{QL}}(\\mathbf{k}) \\times [1.0, 0.8, 1.2, 1.1, 0.9]$.\n\nTest case $2$ (boundary case of near-zero cross-phase):\n- $k_{y}$: $[0.1, 0.2, 0.3]$,\n- $\\gamma_{\\mathbf{k}}$: $[0.02, 0.03, 0.01]$,\n- $C_{n}(\\mathbf{k})$: $[0.50 + 0.00 i, 0.40 + 0.00 i, 0.30 + 0.00 i]$,\n- $C_{T}(\\mathbf{k})$: $[1.00 + 0.00 i, 0.80 + 0.00 i, 0.60 + 0.00 i]$,\n- $C_{n,\\mathrm{NL}}(\\mathbf{k})$: $[0.50 + 0.005 i, 0.40 + 0.004 i, 0.30 + 0.003 i]$,\n- $C_{T,\\mathrm{NL}}(\\mathbf{k})$: $[1.00 + 0.010 i, 0.80 + 0.008 i, 0.60 + 0.006 i]$,\n- $S_{\\mathrm{NL}}(\\mathbf{k})$ identical to $S_{\\mathrm{QL}}(\\mathbf{k})$.\n\nTest case $3$ (edge case with sign reversal due to cross-phase and spectral shift):\n- $k_{y}$: $[0.2, 0.4, 0.6, 0.8]$,\n- $\\gamma_{\\mathbf{k}}$: $[0.06, 0.08, 0.05, 0.03]$,\n- $C_{n}(\\mathbf{k})$: $[0.30 + 0.10 i, 0.28 + 0.12 i, 0.25 + 0.10 i, 0.22 + 0.08 i]$,\n- $C_{T}(\\mathbf{k})$: $[0.80 + 0.25 i, 0.75 + 0.28 i, 0.70 + 0.26 i, 0.65 + 0.22 i]$,\n- $C_{n,\\mathrm{NL}}(\\mathbf{k})$: $[0.30 - 0.05 i, 0.28 - 0.07 i, 0.25 - 0.09 i, 0.22 - 0.10 i]$,\n- $C_{T,\\mathrm{NL}}(\\mathbf{k})$: $[0.80 - 0.12 i, 0.75 - 0.15 i, 0.70 - 0.18 i, 0.65 - 0.20 i]$,\n- $S_{\\mathrm{NL}}(\\mathbf{k})$ defined by $S_{\\mathrm{NL}}(\\mathbf{k}) = S_{\\mathrm{QL}}(\\mathbf{k}) \\times [0.8, 1.0, 1.3, 1.5]$.\n\nAlgorithmic requirements:\n- Compute $S_{\\mathrm{QL}}(\\mathbf{k}) = \\gamma_{\\mathbf{k}}/k_{y}^{2}$ for each case.\n- Compute the quasilinear and nonlinear fluxes as sums over the provided $k_{y}$ modes.\n- Compute the discrepancy decomposition terms $\\Delta \\Gamma_{\\mathrm{spec}}$, $\\Delta \\Gamma_{\\mathrm{phase}}$, $\\Delta Q_{\\mathrm{spec}}$, $\\Delta Q_{\\mathrm{phase}}$.\n- Compute the relative errors $r_{\\Gamma}$, $r_{Q}$ and the signed attribution fractions $f_{\\Gamma,\\mathrm{spec}}$, $f_{\\Gamma,\\mathrm{phase}}$, $f_{Q,\\mathrm{spec}}$, $f_{Q,\\mathrm{phase}}$, applying the tolerance rule with $10^{-12}$.\n- Express all fluxes and metrics as dimensionless floats.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a comma-separated list of the six floats $[r_{\\Gamma}, r_{Q}, f_{\\Gamma,\\mathrm{spec}}, f_{\\Gamma,\\mathrm{phase}}, f_{Q,\\mathrm{spec}}, f_{Q,\\mathrm{phase}}]$. For example, an output for two cases would resemble $[[0.1,0.2,0.3,0.4,0.5,0.6],[\\ldots]]$.",
            "solution": "The user has provided a problem statement that is scientifically sound, self-contained, and well-posed. It is grounded in the established principles of gyrokinetic theory for turbulent transport in magnetized fusion plasmas, specifically focusing on the comparison between quasilinear models and nonlinear simulation data. All required definitions, formulas, and data are provided, and there are no internal contradictions or ambiguities. The problem is a valid and rigorous computational task.\n\nThe problem requires a quantitative comparison between the quasilinear (QL) and nonlinear (NL) predictions of particle and heat fluxes in a model of Ion Temperature Gradient (ITG) turbulence. The core of the analysis is to decompose the total discrepancy between the QL and NL fluxes, $\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}$ and $Q_{\\mathrm{NL}} - Q_{\\mathrm{QL}}$, into two distinct physical contributions: one arising from the mismatch in the fluctuation power spectrum, and the other from the mismatch in the cross-phase between fluctuating quantities. This decomposition serves as a powerful diagnostic tool in plasma theory to understand the specific ways in which the simplified quasilinear approximation fails to capture the full nonlinear physics.\n\nThe fundamental definitions for the turbulent fluxes are based on the correlation between density/temperature fluctuations and the radial component of the $\\mathbf{E} \\times \\mathbf{B}$ drift velocity, which is driven by the fluctuating electrostatic potential $\\tilde{\\phi}_{\\mathbf{k}}$. In normalized gyro-Bohm units and Fourier space, the spectral densities of the particle flux $\\Gamma$ and heat flux $Q$ for a given mode with poloidal wavenumber $k_y$ are:\n$$\n\\text{Spectral Particle Flux} = k_{y} \\,\\mathrm{Im}\\left[\\tilde{n}_{\\mathbf{k}} \\tilde{\\phi}_{\\mathbf{k}}^{*}\\right]\n$$\n$$\n\\text{Spectral Heat Flux} = k_{y} \\,\\mathrm{Im}\\left[\\tilde{T}_{\\mathbf{k}} \\tilde{\\phi}_{\\mathbf{k}}^{*}\\right]\n$$\n\nThe analysis proceeds by defining linear and nonlinear response coefficients, $C_{\\mathbf{k}}$, which relate density and temperature fluctuations to the potential fluctuation: $\\tilde{n}_{\\mathbf{k}} = C_{n}(\\mathbf{k}) \\tilde{\\phi}_{\\mathbf{k}}$ and $\\tilde{T}_{\\mathbf{k}} = C_{T}(\\mathbf{k}) \\tilde{\\phi}_{\\mathbf{k}}$. The imaginary part of these coefficients, $\\mathrm{Im}[C_{\\mathbf{k}}]$, represents the out-of-phase component of the response that leads to net transport. Using these, the total fluxes are obtained by summing over all modes $\\mathbf{k}$, with the potential fluctuation power spectrum defined as $S(\\mathbf{k}) = |\\tilde{\\phi}_{\\mathbf{k}}|^2$.\n\nThe calculation workflow involves the following steps for each test case:\n\n1.  **Calculate Spectra**: First, we compute the quasilinear potential spectrum, $S_{\\mathrm{QL}}(\\mathbf{k})$, using the provided mixing-length estimate, $S_{\\mathrm{QL}}(\\mathbf{k}) = \\gamma_{\\mathbf{k}} / k_{\\perp}^{2}$, where $\\gamma_{\\mathbf{k}}$ is the linear growth rate of the instability and we assume $k_{\\perp}^{2} = k_y^2$. The corresponding nonlinear spectrum, $S_{\\mathrm{NL}}(\\mathbf{k})$, is given as a modification of $S_{\\mathrm{QL}}(\\mathbf{k})$.\n\n2.  **Calculate Fluxes**: We compute the four total fluxes by summing over the provided $k_y$ modes.\n    - Quasilinear fluxes, using linear response coefficients and the QL spectrum:\n      $$ \\Gamma_{\\mathrm{QL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\, S_{\\mathrm{QL}}(\\mathbf{k}) $$\n      $$ Q_{\\mathrm{QL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\, S_{\\mathrm{QL}}(\\mathbf{k}) $$\n    - Nonlinear fluxes, using nonlinear response coefficients and the NL spectrum:\n      $$ \\Gamma_{\\mathrm{NL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n,\\mathrm{NL}}(\\mathbf{k})\\right] \\, S_{\\mathrm{NL}}(\\mathbf{k}) $$\n      $$ Q_{\\mathrm{NL}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T,\\mathrm{NL}}(\\mathbf{k})\\right] \\, S_{\\mathrm{NL}}(\\mathbf{k}) $$\n\n3.  **Decompose Discrepancy**: The total difference between NL and QL fluxes is decomposed into two additive parts as defined in the problem.\n    - Spectrum contribution ($\\Delta \\Gamma_{\\mathrm{spec}}$, $\\Delta Q_{\\mathrm{spec}}$), which quantifies the flux difference caused by using the NL spectrum instead of the QL spectrum, while keeping the linear response function.\n      $$ \\Delta \\Gamma_{\\mathrm{spec}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\left[ S_{\\mathrm{NL}}(\\mathbf{k}) - S_{\\mathrm{QL}}(\\mathbf{k}) \\right] $$\n      $$ \\Delta Q_{\\mathrm{spec}} = \\sum_{\\mathbf{k}} k_{y} \\,\\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\left[ S_{\\mathrm{NL}}(\\mathbf{k}) - S_{\\mathrm{QL}}(\\mathbf{k}) \\right] $$\n    - Cross-phase contribution ($\\Delta \\Gamma_{\\mathrm{phase}}$, $\\Delta Q_{\\mathrm{phase}}$), which quantifies the flux difference caused by using theNL response function instead of the linear one, evaluated with the NL spectrum.\n      $$ \\Delta \\Gamma_{\\mathrm{phase}} = \\sum_{\\mathbf{k}} k_{y} \\left\\{ \\mathrm{Im}\\left[C_{n,\\mathrm{NL}}(\\mathbf{k})\\right] - \\mathrm{Im}\\left[C_{n}(\\mathbf{k})\\right] \\right\\} S_{\\mathrm{NL}}(\\mathbf{k}) $$\n      $$ \\Delta Q_{\\mathrm{phase}} = \\sum_{\\mathbf{k}} k_{y} \\left\\{ \\mathrm{Im}\\left[C_{T,\\mathrm{NL}}(\\mathbf{k})\\right] - \\mathrm{Im}\\left[C_{T}(\\mathbf{k})\\right] \\right\\} S_{\\mathrm{NL}}(\\mathbf{k}) $$\n      It is a mathematical identity that $(\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}) = \\Delta \\Gamma_{\\mathrm{spec}} + \\Delta \\Gamma_{\\mathrm{phase}}$ and similarly for $Q$.\n\n4.  **Compute Final Metrics**: Using the calculated fluxes and their decomposed differences, we compute the final diagnostic metrics.\n    - Relative Errors: These measure the overall discrepancy of the QL model relative to the NL benchmark.\n      $$ r_{\\Gamma} = \\frac{\\Gamma_{\\mathrm{QL}} - \\Gamma_{\\mathrm{NL}}}{\\Gamma_{\\mathrm{NL}}}, \\quad r_{Q} = \\frac{Q_{\\mathrm{QL}} - Q_{\\mathrm{NL}}}{Q_{\\mathrm{NL}}} $$\n    - Signed Attribution Fractions: These show what fraction of the total error is attributable to the spectrum mismatch versus the cross-phase mismatch. Their sum for a given flux channel is unity.\n      $$ f_{\\Gamma,\\mathrm{spec}} = \\frac{\\Delta \\Gamma_{\\mathrm{spec}}}{\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}}, \\quad f_{\\Gamma,\\mathrm{phase}} = \\frac{\\Delta \\Gamma_{\\mathrm{phase}}}{\\Gamma_{\\mathrm{NL}} - \\Gamma_{\\mathrm{QL}}} $$\n      The corresponding fractions for the heat flux $Q$ are defined analogously.\n\nA numerical tolerance of $10^{-12}$ is applied to the denominators of these fractions. If the magnitude of a denominator is below this threshold, the resulting metric is set to $0.0$ to avoid division by zero and handle cases where the QL and NL results are nearly identical. This procedure is implemented for each of the three test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes quasilinear vs. nonlinear flux discrepancies for given test cases\n    in fusion plasma gyrokinetic theory.\n    \"\"\"\n\n    TOL = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"ky\": np.array([0.1, 0.2, 0.3, 0.4, 0.5]),\n            \"gamma\": np.array([0.05, 0.10, 0.12, 0.09, 0.04]),\n            \"Cn_L\": np.array([0.50 + 0.10j, 0.40 + 0.12j, 0.35 + 0.15j, 0.30 + 0.12j, 0.25 + 0.08j]),\n            \"CT_L\": np.array([1.00 + 0.25j, 0.90 + 0.30j, 0.85 + 0.35j, 0.80 + 0.30j, 0.70 + 0.20j]),\n            \"Cn_NL\": np.array([0.48 + 0.08j, 0.38 + 0.10j, 0.33 + 0.12j, 0.28 + 0.09j, 0.24 + 0.06j]),\n            \"CT_NL\": np.array([0.95 + 0.20j, 0.85 + 0.28j, 0.80 + 0.32j, 0.75 + 0.27j, 0.65 + 0.18j]),\n            \"SNL_factor\": np.array([1.0, 0.8, 1.2, 1.1, 0.9])\n        },\n        {\n            \"ky\": np.array([0.1, 0.2, 0.3]),\n            \"gamma\": np.array([0.02, 0.03, 0.01]),\n            \"Cn_L\": np.array([0.50 + 0.00j, 0.40 + 0.00j, 0.30 + 0.00j]),\n            \"CT_L\": np.array([1.00 + 0.00j, 0.80 + 0.00j, 0.60 + 0.00j]),\n            \"Cn_NL\": np.array([0.50 + 0.005j, 0.40 + 0.004j, 0.30 + 0.003j]),\n            \"CT_NL\": np.array([1.00 + 0.010j, 0.80 + 0.008j, 0.60 + 0.006j]),\n            \"SNL_factor\": np.array([1.0, 1.0, 1.0])\n        },\n        {\n            \"ky\": np.array([0.2, 0.4, 0.6, 0.8]),\n            \"gamma\": np.array([0.06, 0.08, 0.05, 0.03]),\n            \"Cn_L\": np.array([0.30 + 0.10j, 0.28 + 0.12j, 0.25 + 0.10j, 0.22 + 0.08j]),\n            \"CT_L\": np.array([0.80 + 0.25j, 0.75 + 0.28j, 0.70 + 0.26j, 0.65 + 0.22j]),\n            \"Cn_NL\": np.array([0.30 - 0.05j, 0.28 - 0.07j, 0.25 - 0.09j, 0.22 - 0.10j]),\n            \"CT_NL\": np.array([0.80 - 0.12j, 0.75 - 0.15j, 0.70 - 0.18j, 0.65 - 0.20j]),\n            \"SNL_factor\": np.array([0.8, 1.0, 1.3, 1.5])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        ky = case[\"ky\"]\n        gamma_k = case[\"gamma\"]\n        Cn_L = case[\"Cn_L\"]\n        CT_L = case[\"CT_L\"]\n        Cn_NL = case[\"Cn_NL\"]\n        CT_NL = case[\"CT_NL\"]\n        SNL_factor = case[\"SNL_factor\"]\n\n        # Step 1: Calculate Spectra\n        S_QL = gamma_k / (ky**2)\n        S_NL = S_QL * SNL_factor\n\n        # Step 2: Calculate Fluxes\n        Gamma_QL = np.sum(ky * Cn_L.imag * S_QL)\n        Q_QL = np.sum(ky * CT_L.imag * S_QL)\n        Gamma_NL = np.sum(ky * Cn_NL.imag * S_NL)\n        Q_NL = np.sum(ky * CT_NL.imag * S_NL)\n\n        # Step 3: Decompose Discrepancy\n        delta_Gamma_spec = np.sum(ky * Cn_L.imag * (S_NL - S_QL))\n        delta_Q_spec = np.sum(ky * CT_L.imag * (S_NL - S_QL))\n        \n        delta_Gamma_phase = np.sum(ky * (Cn_NL.imag - Cn_L.imag) * S_NL)\n        delta_Q_phase = np.sum(ky * (CT_NL.imag - CT_L.imag) * S_NL)\n\n        # Step 4: Compute Final Metrics\n        # Relative errors\n        r_Gamma = (Gamma_QL - Gamma_NL) / Gamma_NL if abs(Gamma_NL) > TOL else 0.0\n        r_Q = (Q_QL - Q_NL) / Q_NL if abs(Q_NL) > TOL else 0.0\n\n        # Total differences for attribution fractions\n        delta_Gamma_tot = Gamma_NL - Gamma_QL\n        delta_Q_tot = Q_NL - Q_QL\n\n        # Attribution fractions\n        f_Gamma_spec  = delta_Gamma_spec / delta_Gamma_tot if abs(delta_Gamma_tot) > TOL else 0.0\n        f_Gamma_phase = delta_Gamma_phase / delta_Gamma_tot if abs(delta_Gamma_tot) > TOL else 0.0\n        f_Q_spec  = delta_Q_spec / delta_Q_tot if abs(delta_Q_tot) > TOL else 0.0\n        f_Q_phase = delta_Q_phase / delta_Q_tot if abs(delta_Q_tot) > TOL else 0.0\n        \n        case_results = [r_Gamma, r_Q, f_Gamma_spec, f_Gamma_phase, f_Q_spec, f_Q_phase]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # Manually construct the string to match the no-space format `[[r1,r2,...],[...]]`\n    case_strings = [f\"[{','.join(map(str, r))}]\" for r in results]\n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        }
    ]
}