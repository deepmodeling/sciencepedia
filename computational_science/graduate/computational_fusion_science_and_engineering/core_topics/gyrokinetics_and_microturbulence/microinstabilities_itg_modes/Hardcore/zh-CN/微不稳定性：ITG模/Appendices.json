{
    "hands_on_practices": [
        {
            "introduction": "第一个练习是等离子体稳定性分析的基石。通过求解离子温度梯度（ITG）模式的色散关系，我们可以计算出它的基本性质：振荡频率和增长率。本练习将指导您为简化的流体模型和更精确的动理学模型实现数值求解器，从而直接了解兰道阻尼等关键动力学效应如何改变不稳定性的行为 ()。",
            "id": "4011595",
            "problem": "考虑在标度分离和局域均匀背景梯度的假设下，静电、低贝塔、磁化等离子体中离子温度梯度（ITG）模的线性稳定性。通过计算各自线性色散关系在指定参数集下的复频率根（实频率和增长率），比较简化流体闭合与漂移动理学（回旋动理学）闭合。所有物理量都基于离子抗磁频率进行无量纲归一化处理。你必须实现一个程序，对每个测试案例，数值求解两种色散关系的复数根 $\\omega = \\omega_{\\mathrm{r}} + i \\gamma$，并以规定的单行格式输出比较结果。\n\n基本框架和设定：\n- 采用静电涨落和绝热电子响应，即 $\\delta n_{e}/n_{0} = (e \\phi / T_{e})$。\n- 使用局域平板-环形近似，其中曲率漂移由常数驱动频率 $\\omega_{d}$ 表示，背景密度和离子温度梯度通过离子抗磁频率 $\\omega_{\\ast i}$ 和梯度比 $\\eta_{i} = L_{n}/L_{T_{i}}$ 表示。\n- 将所有频率用离子抗磁频率进行归一化，使得 $\\hat{\\omega} = \\omega / \\omega_{\\ast i}$，$\\hat{\\omega}_{d} = \\omega_{d}/\\omega_{\\ast i}$，$\\hat{k}_{\\parallel} = k_{\\parallel} v_{ti}/\\omega_{\\ast i}$，并定义有限拉莫尔半径参数 $b = k_{\\perp}^{2} \\rho_{i}^{2}$，其中 $v_{ti} = \\sqrt{2 T_{i}/m_{i}}$ 和 $\\rho_{i} = v_{ti}/\\Omega_{i}$ 分别是离子热速度和拉莫尔半径。令 $\\tau = T_{e}/T_{i}$，归一化的离子声速为 $\\hat{c}_{s} = \\sqrt{\\tau}$。\n\n待求解的色散关系：\n1. 流体闭合（三场反应性ITG模型）：推导并求解三次多项式中的 $\\omega$\n   $$D_{f}(\\omega) \\equiv \\omega^{3} - \\omega^{2}\\,\\omega_{\\ast i}\\,(1 + \\eta_{i}) + \\omega\\left(k_{\\parallel}^{2} c_{s}^{2} + \\omega_{d}\\,\\omega_{\\ast i}\\,\\eta_{i}\\right) - k_{\\parallel}^{2} c_{s}^{2}\\,\\omega_{\\ast i}\\,\\eta_{i} = 0,$$\n   用归一化变量表示为\n   $$\\hat{D}_{f}(\\hat{\\omega}) = \\hat{\\omega}^{3} - \\hat{\\omega}^{2}\\,(1 + \\eta_{i}) + \\hat{\\omega}\\left(\\hat{k}_{\\parallel}^{2}\\,\\hat{c}_{s}^{2} + \\hat{\\omega}_{d}\\,\\eta_{i}\\right) - \\hat{k}_{\\parallel}^{2}\\,\\hat{c}_{s}^{2}\\,\\eta_{i} = 0.$$\n   选择物理上相关的不稳定根，即具有最大正虚部 $\\gamma = \\operatorname{Im}(\\omega)$ 的根（如果存在），并报告 $\\omega_{\\mathrm{r}}$ 和 $\\gamma$。\n\n2. 动理学闭合（包含朗道共振和有限拉莫尔半径的漂移动理学离子响应）：推导并求解超越方程\n   $$D_{k}(\\omega) \\equiv 1 + \\tau - \\Gamma_{0}(b)\\left[1 + \\frac{\\omega_{\\ast i}}{\\omega}\\left(1 + \\eta_{i}\\left(1 + \\xi\\,Z(\\xi)\\right)\\right) + \\frac{\\omega_{d}}{\\omega}\\right] = 0,$$\n   其中 $\\Gamma_{0}(b) = I_{0}(b)\\,e^{-b}$ 是回旋平均因子，$I_{0}$ 是零阶第一类修正贝塞尔函数，$\\xi = \\omega / (|k_{\\parallel}| v_{ti}) = \\hat{\\omega}/|\\hat{k}_{\\parallel}|$，而 $Z(\\xi)$ 是通过Faddeeva函数定义的等离子体色散函数，$Z(\\xi) = i\\sqrt{\\pi}\\,w(\\xi)$，其中 $w$ 是Faddeeva函数。用归一化变量表示为\n   $$\\hat{D}_{k}(\\hat{\\omega}) = 1 + \\tau - \\Gamma_{0}(b)\\left[1 + \\frac{1}{\\hat{\\omega}}\\left(1 + \\eta_{i}\\left(1 + \\hat{\\xi}\\,Z(\\hat{\\xi})\\right)\\right) + \\frac{\\hat{\\omega}_{d}}{\\hat{\\omega}}\\right] = 0,$$\n   其中 $\\hat{\\xi} = \\hat{\\omega}/|\\hat{k}_{\\parallel}|$。通过同时满足实部和虚部来求解复数根 $\\hat{\\omega}$，并以原始归一化报告 $\\omega_{\\mathrm{r}}$ 和 $\\gamma$（即 $\\omega_{\\mathrm{r}} = \\hat{\\omega}_{\\mathrm{r}}\\,\\omega_{\\ast i}$ 和 $\\gamma = \\operatorname{Im}(\\hat{\\omega})\\,\\omega_{\\ast i}$）。由于 $\\omega_{\\ast i}$ 是归一化频率，在所有测试案例中设置 $\\omega_{\\ast i} = 1$，因此报告的值是无量纲的。\n\n算法要求：\n- 对于流体闭合，计算三次多项式的所有三个根，并选择具有最大正虚部的根。如果没有根具有正虚部，则报告具有最小虚部绝对值的根，并将增长率设置为零（即将 $\\gamma$ 截断为零）。\n- 对于动理学闭合，使用鲁棒的多维求根器求解非线性方程组 $\\operatorname{Re}\\,\\hat{D}_{k}(\\hat{\\omega}) = 0$ 和 $\\operatorname{Im}\\,\\hat{D}_{k}(\\hat{\\omega}) = 0$ 以得到 $(\\hat{\\omega}_{\\mathrm{r}}, \\operatorname{Im}\\hat{\\omega})$。使用流体根作为初始猜测值以改善收敛性。如果求解器未能收敛，则实施一个后备方案：在 $(\\hat{\\omega}_{\\mathrm{r}}, \\operatorname{Im}\\hat{\\omega})$ 的粗网格上最小化 $|\\hat{D}_{k}(\\hat{\\omega})|$ 并进行局部细化；如果仍不成功，则报告 $\\gamma = 0$ 和与流体实频率相等的 $\\omega_{\\mathrm{r}}$。\n\n测试套件：\n为以下四个测试案例提供结果（所有参数均为无量纲，且 $\\omega_{\\ast i}=1$）：\n- 案例1（基准不稳定）：$\\tau = 1.0$, $\\eta_{i} = 3.0$, $\\hat{k}_{\\parallel} = 0.20$, $b = 0.20$, $\\hat{\\omega}_{d} = 0.30$.\n- 案例2（近阈值）：$\\tau = 1.0$, $\\eta_{i} = 1.0$, $\\hat{k}_{\\parallel} = 0.20$, $b = 0.20$, $\\hat{\\omega}_{d} = 0.10$.\n- 案例3（强平行朗道阻尼）：$\\tau = 1.0$, $\\eta_{i} = 3.0$, $\\hat{k}_{\\parallel} = 1.00$, $b = 0.20$, $\\hat{\\omega}_{d} = 0.30$.\n- 案例4（强有限拉莫尔半径稳定化）：$\\tau = 1.0$, $\\eta_{i} = 3.0$, $\\hat{k}_{\\parallel} = 0.20$, $b = 2.00$, $\\hat{\\omega}_{d} = 0.30$.\n\n答案规范：\n- 由于在所有案例中 $\\omega_{\\ast i} = 1$，$\\omega_{\\mathrm{r}}$ 和 $\\gamma$ 均为无量纲。将每个案例的结果报告为一个列表，其中包含流体模型的 $\\omega_{\\mathrm{r}}$ 和 $\\gamma$，然后是动理学模型的 $\\omega_{\\mathrm{r}}$ 和 $\\gamma$，按此顺序排列。\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试案例，并且本身也是一个用方括号括起来的逗号分隔列表：例如，\"[[fluid_omega_r,fluid_gamma,kinetic_omega_r,kinetic_gamma],[...],[...],[...]]\"。",
            "solution": "用户提供了一个来自计算等离子体物理学的问题，具体涉及离子温度梯度（ITG）模的线性稳定性。任务是通过为几个参数集计算该模式的复频率，来比较两种理论模型——一种简化的流体模型和一种更全面的动理学模型。\n\n### 步骤1：问题验证\n首先根据所需标准对问题进行验证。\n\n**提取的已知条件：**\n- **物理系统**：在局域平板-环形近似下的静电、低贝塔、磁化等离子体。\n- **电子模型**：绝热响应，$\\delta n_{e}/n_{0} = (e \\phi / T_{e})$。\n- **关键参数**：\n    - 温度比：$\\tau = T_{e}/T_{i}$。\n    - 离子温度梯度参数：$\\eta_{i} = L_{n}/L_{T_{i}}$。\n    - 归一化平行波数：$\\hat{k}_{\\parallel} = k_{\\parallel} v_{ti}/\\omega_{\\ast i}$。\n    - 有限拉莫尔半径（FLR）参数：$b = k_{\\perp}^{2} \\rho_{i}^{2}$。\n    - 归一化曲率漂移频率：$\\hat{\\omega}_{d} = \\omega_{d}/\\omega_{\\ast i}$。\n- **归一化**：频率以离子抗磁频率 $\\omega_{\\ast i}$ 进行归一化。在所有计算中，$\\omega_{\\ast i} = 1$。复频率为 $\\hat{\\omega} = \\hat{\\omega}_{\\mathrm{r}} + i \\hat{\\gamma}$。\n- **流体色散关系（归一化）**：\n  $$ \\hat{D}_{f}(\\hat{\\omega}) = \\hat{\\omega}^{3} - \\hat{\\omega}^{2}\\,(1 + \\eta_{i}) + \\hat{\\omega}\\left(\\hat{k}_{\\parallel}^{2}\\,\\tau + \\hat{\\omega}_{d}\\,\\eta_{i}\\right) - \\hat{k}_{\\parallel}^{2}\\,\\tau\\,\\eta_{i} = 0 $$\n- **动理学色散关系（归一化）**：\n  $$ \\hat{D}_{k}(\\hat{\\omega}) = 1 + \\tau - \\Gamma_{0}(b)\\left[1 + \\frac{1}{\\hat{\\omega}}\\left(1 + \\eta_{i}\\left(1 + \\hat{\\xi}\\,Z(\\hat{\\xi})\\right)\\right) + \\frac{\\hat{\\omega}_{d}}{\\hat{\\omega}}\\right] = 0 $$\n  其中 $\\Gamma_{0}(b) = I_{0}(b)\\,e^{-b}$，$\\hat{\\xi} = \\hat{\\omega}/|\\hat{k}_{\\parallel}|$，而 $Z(\\hat{\\xi})$ 是等离子体色散函数。\n- **算法要求**：\n    1.  **流体**：求解 $\\hat{\\omega}$ 的三次多项式。选择具有最大正虚部（$\\hat{\\gamma}$）的根。如果不存在这样的根，选择虚部绝对值最小的根，并报告其实部，同时 $\\hat{\\gamma}=0$。\n    2.  **动理学**：使用多维求根器求解超越方程 $\\hat{D}_{k}(\\hat{\\omega})=0$ 以获得复数根 $\\hat{\\omega}$，以流体根作为初始猜测值。如果求解器失败，需要特定的后备程序。\n- **测试案例**：提供了四组特定的无量纲参数 $(\\tau, \\eta_{i}, \\hat{k}_{\\parallel}, b, \\hat{\\omega}_{d})$。\n- **输出格式**：一个表示列表的列表的单行字符串，例如 `[[fluid_wr,fluid_gamma,kinetic_wr,kinetic_gamma],...]`。\n\n**验证结论：**\n1.  **科学依据**：该问题基于等离子体物理学中ITG不稳定性的标准、成熟模型。方程和概念（朗道阻尼、有限拉莫尔半径效应、绝热电子）是该领域的基础。\n2.  **良态问题**：问题定义明确。求解三次多项式是直接的。求解超越动理学方程是一项标准的数值任务，提供初始猜测和后备策略确保了寻找唯一、有意义解（最不稳定的模式）的鲁棒程序。\n3.  **客观性**：语言精确、数学化，没有主观性。提供了所有需要的数据和定义。\n4.  **完整性和一致性**：问题是自洽的，内部一致。\n\n问题被判定为**有效**。\n\n### 步骤2：求解设计与实现\n解决方案涉及按规定实现两种色散关系的数值求解器。\n\n**流体模型求解器：**\n归一化的流体色散关系是一个关于 $\\hat{\\omega}$ 的三次多项式：\n$$ \\hat{\\omega}^{3} + c_2 \\hat{\\omega}^{2} + c_1 \\hat{\\omega} + c_0 = 0 $$\n其中系数为：\n- $c_2 = -(1 + \\eta_{i})$\n- $c_1 = \\hat{k}_{\\parallel}^{2}\\,\\tau + \\hat{\\omega}_{d}\\,\\eta_{i}$\n- $c_0 = -\\hat{k}_{\\parallel}^{2}\\,\\tau\\,\\eta_{i}$\n将使用 `numpy.roots` 函数来找到三个复数根。然后我们遍历这些根，以找到具有最大正虚部（增长率 $\\hat{\\gamma}$）的那个。如果没有根具有正虚部，问题规定选择虚部绝对值最小的根，并将其增长率设置为 $0$。\n\n**动理学模型求解器：**\n动理学色散关系是一个复超越方程。为了数值求解，它被重构为一个包含两个实变量 $\\hat{\\omega}_{\\mathrm{r}}$ 和 $\\hat{\\gamma}$ 的两个实方程组：\n$$ \\operatorname{Re}[\\hat{D}_{k}(\\hat{\\omega}_{\\mathrm{r}} + i\\hat{\\gamma})] = 0 $$\n$$ \\operatorname{Im}[\\hat{D}_{k}(\\hat{\\omega}_{\\mathrm{r}} + i\\hat{\\gamma})] = 0 $$\n为了增强数值稳定性，特别是对于求根算法，我们将方程乘以 $\\hat{\\omega}$ 以消除分母：\n$$ \\hat{\\omega}(1 + \\tau) - \\Gamma_{0}(b)\\left[\\hat{\\omega} + \\left(1 + \\eta_{i}\\left(1 + \\hat{\\xi}\\,Z(\\hat{\\xi})\\right)\\right) + \\hat{\\omega}_{d}\\right] = 0 $$\n该系统使用 `scipy.optimize.root` 函数求解，这是一个鲁棒的多维求解器。所需的特殊函数由 `scipy.special` 提供：$\\Gamma_{0}(b)$ 是 `i0e(b)`，等离子体色散函数 $Z(\\hat{\\xi})$ 使用Faddeeva函数构建，$Z(\\hat{\\xi}) = i\\sqrt{\\pi}\\,w(\\hat{\\xi})$，其中 $w(\\hat{\\xi})$ 由 `wofz(xi_hat)` 计算。\n\n流体模型的根是动理学求解器的一个极好的初始猜测，因为动理学根是流体根的一个微扰。如果 `scipy.optimize.root` 未能收敛，则实施规定的后备方案：我们首先使用 `scipy.optimize.minimize` 通过最小化残差的模平方 $|\\hat{D}_k(\\hat{\\omega})|^2$ 来找到一个更好的猜测值。如果这个精炼的猜测值能让 `root` 收敛，我们就接受该解。如果所有尝试都失败，我们按照问题的指示，报告来自流体模型的实频率和零增长率。与关注不稳定性的焦点一致，如果求解器收敛到一个稳定（阻尼）根，我们报告动理学增长率为 $\\max(0, \\hat{\\gamma})$。\n\n整个过程是遍历每个测试案例，求解两种模型，收集四个结果值（$\\omega_{\\mathrm{r,fluid}}, \\gamma_{\\mathrm{fluid}}, \\omega_{\\mathrm{r,kinetic}}, \\gamma_{\\mathrm{kinetic}}$），并将它们格式化为指定的单行输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz, i0e\nfrom scipy.optimize import root, minimize\n\ndef solve():\n    \"\"\"\n    Solves for the complex roots of fluid and kinetic ITG dispersion relations\n    for a given set of test cases and formats the output as specified.\n    \"\"\"\n\n    def solve_fluid_model(params):\n        \"\"\"\n        Solves the cubic fluid dispersion relation for the most unstable ITG mode.\n\n        Args:\n            params (dict): A dictionary of physical parameters for the model.\n\n        Returns:\n            tuple: A tuple containing the real frequency (omega_r) and growth rate (gamma).\n        \"\"\"\n        eta_i = params['eta_i']\n        k_par_hat = params['k_par_hat']\n        tau = params['tau']\n        omega_d_hat = params['omega_d_hat']\n\n        c_s_hat_sq = tau\n        \n        # Coefficients for the polynomial: p(x) = x^3 + c2*x^2 + c1*x + c0 = 0\n        c2 = -(1 + eta_i)\n        c1 = k_par_hat**2 * c_s_hat_sq + omega_d_hat * eta_i\n        c0 = -k_par_hat**2 * c_s_hat_sq * eta_i\n        \n        coeffs = [1, c2, c1, c0]\n        roots = np.roots(coeffs)\n\n        # Find roots with a positive imaginary part (unstable modes)\n        unstable_roots = [r for r in roots if r.imag  1e-9]\n        \n        if unstable_roots:\n            # Select the most unstable root (largest positive imaginary part)\n            best_root = max(unstable_roots, key=lambda r: r.imag)\n            return best_root.real, best_root.imag\n        else:\n            # No unstable root found, follow the problem's rule for stable cases\n            least_damped_root = min(roots, key=lambda r: abs(r.imag))\n            # Report the real part of the least damped root and a growth rate of zero\n            return least_damped_root.real, 0.0\n\n    def solve_kinetic_model(params, initial_guess):\n        \"\"\"\n        Solves the transcendental kinetic dispersion relation using a root finder.\n\n        Args:\n            params (dict): A dictionary of physical parameters for the model.\n            initial_guess (tuple): An initial guess (omega_r, gamma) for the solver.\n\n        Returns:\n            tuple: A tuple containing the real frequency (omega_r) and growth rate (gamma).\n        \"\"\"\n        tau = params['tau']\n        eta_i = params['eta_i']\n        k_par_hat = np.abs(params['k_par_hat'])\n        b = params['b']\n        omega_d_hat = params['omega_d_hat']\n        gamma0_b = i0e(b)\n\n        def kinetic_residual_func(omega_vec):\n            \"\"\"The function F(x)=0 to be solved, where x=[omega_r, gamma].\"\"\"\n            omega_hat = omega_vec[0] + 1j * omega_vec[1]\n            \n            # Avoid division by zero if k_par_hat is very small\n            if k_par_hat  1e-12:\n                xi_hat_z = 0.0j # Asymptotic limit for large xi: 1 + xi*Z(xi) - 0\n            else:\n                xi_hat = omega_hat / k_par_hat\n                z_func = 1j * np.sqrt(np.pi) * wofz(xi_hat)\n                xi_hat_z = xi_hat * z_func\n\n            # Use form multiplied by omega_hat to avoid poles at omega_hat=0\n            residual = (omega_hat * (1 + tau) - \n                        gamma0_b * (omega_hat + 1 + eta_i * (1 + xi_hat_z) + omega_d_hat))\n            \n            return [residual.real, residual.imag]\n\n        # First attempt with the fluid root as an initial guess\n        sol = root(kinetic_residual_func, initial_guess, method='hybr', tol=1e-9)\n\n        if sol.success:\n            wr, w_imag = sol.x\n            # Report instability growth rate; clip damping to zero\n            return wr, max(0.0, w_imag)\n\n        # Fallback 1: If root() fails, use a minimizer to find a better guess\n        def objective_func(omega_vec):\n             res_vec = kinetic_residual_func(omega_vec)\n             return res_vec[0]**2 + res_vec[1]**2\n\n        min_sol = minimize(objective_func, initial_guess, method='Nelder-Mead', tol=1e-10)\n        \n        if min_sol.success and min_sol.fun  1e-9:\n            new_guess = min_sol.x\n            # Second attempt with the new guess from the minimizer\n            sol2 = root(kinetic_residual_func, new_guess, method='hybr', tol=1e-9)\n            if sol2.success:\n                wr, w_imag = sol2.x\n                return wr, max(0.0, w_imag)\n\n        # Final fallback: return fluid frequency and zero growth rate\n        fluid_wr, _ = initial_guess\n        return fluid_wr, 0.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (baseline unstable)\n        {'tau': 1.0, 'eta_i': 3.0, 'k_par_hat': 0.20, 'b': 0.20, 'omega_d_hat': 0.30},\n        # Case 2 (near threshold)\n        {'tau': 1.0, 'eta_i': 1.0, 'k_par_hat': 0.20, 'b': 0.20, 'omega_d_hat': 0.10},\n        # Case 3 (strong parallel Landau damping)\n        {'tau': 1.0, 'eta_i': 3.0, 'k_par_hat': 1.00, 'b': 0.20, 'omega_d_hat': 0.30},\n        # Case 4 (strong finite Larmor radius stabilization)\n        {'tau': 1.0, 'eta_i': 3.0, 'k_par_hat': 0.20, 'b': 2.00, 'omega_d_hat': 0.30},\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        # Solve fluid model\n        fluid_wr, fluid_gamma = solve_fluid_model(case_params)\n        \n        # Use fluid root as initial guess for kinetic model\n        initial_guess = (fluid_wr, fluid_gamma)\n        \n        # Solve kinetic model\n        kinetic_wr, kinetic_gamma = solve_kinetic_model(case_params, initial_guess)\n\n        # Store results for this case\n        all_results.append([fluid_wr, fluid_gamma, kinetic_wr, kinetic_gamma])\n\n    # Final print statement in the exact required format.\n    result_str = ','.join([str(r).replace(' ', '') for r in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "不稳定性并不会在所有条件下都增长；它通常需要一个驱动梯度超过某个阈值。本练习聚焦于聚变研究中的一个关键问题：触发ITG不稳定性的临界离子温度梯度（$\\eta_i$）是多少？您将编写一个程序来扫描一系列垂直波数（$k_y$），并确定定义等离子体稳定性边界的最小阈值 ()。",
            "id": "4011609",
            "problem": "考虑在磁约束等离子体中，由离子温度梯度（ITG）驱动的一种无碰撞、静电、低频微观不稳定性。在局域、线性、磁通管近似的框架下进行分析，并假设离子为麦克斯韦分布，电子响应为绝热响应。目标是确定一个临界离子温度梯度，超过该值后，ITG模将变得线性不稳定，并通过参数扫描来计算该临界值。\n\n您必须从计算聚变科学与工程的一个有效基础出发：离子的线性回旋动理学方程、包含绝热电子的准中性条件，以及从回旋动理学自由能不变量推导出的能量平衡。假设以下标准且经过科学充分检验的要素：\n\n- 绝热电子响应意味着准中性条件 $n_{e1}/n_{e0} = e \\phi / T_e$。\n- 离子的回旋平均函数是修正贝塞尔函数加权的函数 $\\Gamma_n(b) = e^{-b} I_n(b)$，其中 $I_n(b)$ 是 $n$ 阶第一类修正贝塞尔函数，$b = k_\\perp^2 \\rho_i^2$，$k_\\perp$ 是垂直波数，$\\rho_i$ 是离子拉莫尔半径。\n- 与线性增长率 $\\gamma$ 相关的自由能平衡关系在固定波数下由 $dW/dt = 2 \\gamma W = \\text{驱动} - \\text{阻尼}$ 给出。曲率驱动的ITG自由能注入与抗磁频率、曲率漂移耦合和温度梯度的乘积成正比，并通过回旋平均函数受到有限拉莫尔半径（FLR）效应的削弱。平行相混合（朗道阻尼）通过一个朗道流体闭合来建模，其无量纲系数由 Hammett–Perkins 闭合推断得出。\n\n定义适用于局域分析的无量纲参数和物理量：\n- 离子与电子的温度比 $\\tau = T_i / T_e$。\n- 垂直谱参数 $k_y \\rho_i$，其中 $k_x \\rho_i = 0$，因此 $b = (k_y \\rho_i)^2$。\n- 无量纲抗磁频率，归一化后使得 $\\omega_{*i} \\propto k_y$（将比例常数吸收到所选的归一化中），以及曲率耦合参数 $\\kappa$，使得 $\\omega_{Di} = \\kappa \\, \\omega_{*i}$。\n- 以梯度尺度长度为单位的平行波数 $k_\\parallel L_n$，其中 $L_n$ 是密度梯度尺度长度。\n- 在所选单位下，归一化后的离子热速度为 $v_{thi} \\propto \\sqrt{\\tau}$。\n\n在这些假设下，临界稳定点附近的线性增长率可以写为\n$$\n\\gamma(k_y, \\eta_i) \\approx \\mathcal{D}_\\text{drive}(k_y) \\, \\eta_i - \\mathcal{D}_\\text{damp}(k_\\parallel, \\tau),\n$$\n其中 $\\eta_i = L_n / L_{Ti}$ 是无量纲离子温度梯度参数，$L_{Ti}$ 是离子温度梯度尺度长度，且\n$$\n\\mathcal{D}_\\text{drive}(k_y) = \\omega_{*i}(k_y) \\, \\kappa \\, S(b), \\quad S(b) \\equiv \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right],\n$$\n其中 $\\Gamma_n(b) = e^{-b} I_n(b)$ 如上定义，并且\n$$\n\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau) = \\beta \\, |k_\\parallel| \\, \\sqrt{\\tau},\n$$\n其中 Hammett–Perkins 闭合系数在无量纲单位下取为 $\\beta = 2/\\sqrt{\\pi}$。临界条件 $\\gamma = 0$ 产生一个临界梯度\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau)}{\\mathcal{D}_\\text{drive}(k_y)} = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, \\omega_{*i}(k_y) \\, S(b)}.\n$$\n假设采用的归一化为 $\\omega_{*i}(k_y) = k_y$，表达式简化为\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, k_y \\, S\\big((k_y \\rho_i)^2\\big)}.\n$$\n在本问题中，使用 $\\rho_i$ 作为单位长度，从而使 $k_y \\rho_i$ 无量纲化，并在数值计算中设置 $\\rho_i = 1$，因此 $b = k_y^2$。\n\n您的计算任务是：\n1. 对于每个指定的参数集，在给定的区间内对 $k_y$ 进行参数扫描，以评估 $\\eta_i^\\text{crit}(k_y)$，并返回该区间内的最小值作为该情况下的总临界梯度。\n2. 如果 $\\kappa = 0$ 或在扫描区间内所有的 $k_y$ 都满足 $S(b) \\le 0$，则驱动项为零或不符合物理意义；在这种情况下，返回一个“非数值”（not-a-number）来表示在该模型假设下无法确定临界梯度。该“非数值”表示必须是 IEEE 浮点数 $\\text{NaN}$。\n\n输出不需要物理单位，因为所有量都已通过归一化处理为无量纲。角度不出现。所有类百分比的量必须表示为不带百分号的小数。最终输出必须是浮点数。\n\n测试套件和覆盖范围：\n使用以下四个覆盖不同区域的参数集：\n- 情况 1（理想路径）：$\\tau = 1.0$，$\\kappa = 0.2$，$k_\\parallel L_n = 0.05$，在 $k_y \\in [0.1, 1.5]$ 区间内进行扫描，均匀采样 200 个点。\n- 情况 2（增大的 FLR 范围）：$\\tau = 1.5$，$\\kappa = 0.25$，$k_\\parallel L_n = 0.03$，在 $k_y \\in [0.05, 2.0]$ 区间内进行扫描，均匀采样 400 个点。\n- 情况 3（更强的平行阻尼）：$\\tau = 0.7$，$\\kappa = 0.05$，$k_\\parallel L_n = 0.1$，在 $k_y \\in [0.2, 1.2]$ 区间内进行扫描，均匀采样 200 个点。\n- 情况 4（弱曲率驱动，边缘情况）：$\\tau = 1.0$，$\\kappa = 0.01$，$k_\\parallel L_n = 0.05$，在 $k_y \\in [0.1, 1.5]$ 区间内进行扫描，均匀采样 200 个点。\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按四种情况的顺序排列结果，每个浮点数四舍五入到六位小数（例如，$[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$）。如果某个情况无法确定，则对应的条目必须是 $\\text{nan}$（不允许不区分大小写：必须精确使用 $\\text{nan}$）。",
            "solution": "我们从磁化等离子体中静电、无碰撞涨落的线性回旋动理学描述开始。离子遵循线性回旋动理学方程，电子被视为绝热的，这导致了准中性条件 $n_{e1}/n_{e0} = e \\phi / T_e$。离子的响应在回旋平均后，引入了函数 $\\Gamma_n(b) = e^{-b} I_n(b)$，其中 $I_n$ 是第一类修正贝塞尔函数，$b = k_\\perp^2 \\rho_i^2$。这些函数捕捉了有限拉莫尔半径（FLR）效应。\n\n确定线性稳定性的一个基本方法是利用与回旋动理学不变量相关的自由能平衡。对于一个具有复频率 $\\omega = \\omega_r + i \\gamma$ 的模式，二次自由能 $W$ 的变化率满足 $dW/dt = 2 \\gamma W$，其中 $\\gamma$ 是增长率。这个变化率可以分解为一个源于梯度和曲率的驱动项，以及一个源于平行相混合（朗道阻尼）的阻尼项。因此\n$$\n2 \\gamma W = \\text{Drive} - \\text{Damping}.\n$$\n在临界稳定点，根据定义 $\\gamma = 0$，等式“驱动 = 阻尼”给出了不稳定的阈值条件。\n\n曲率驱动的ITG模通过背景离子温度梯度与曲率漂移的耦合获得能量。抗磁频率设定了基本的漂移时间尺度，曲率引入了一个耦合参数。我们在所选单位中将抗磁频率归一化以满足 $\\omega_{*i}(k_y) = k_y$。驱动项因FLR效应而减小，在线性回旋动理学中，这通过以下组合进入：\n$$\nS(b) \\equiv \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right],\n$$\n其中 $\\Gamma_n(b) = e^{-b} I_n(b)$。这一特定组合源于准中性关系和能量平衡中的回旋平均密度和温度加权矩，它是从回旋动理学展开得到的流体极限中一个经过充分检验的形式。\n\n平行相混合由一个朗道流体闭合捕捉，这是由 Hammett 和 Perkins 引入的一种方法，用于在流体模型中近似动理学朗道阻尼。在线性理论中，平行热通量闭合引入了一个与 $|k_\\parallel| v_{thi}$ 成正比的项，其无量纲系数 $\\beta$ 通过与动理学理论匹配来确定。对于静电、低频条件下的麦克斯韦等离子体，一个常见的近似是\n$$\n\\mathcal{D}_\\text{damp} = \\beta \\, |k_\\parallel| \\, v_{thi},\n$$\n并且，在我们选择的归一化中，$v_{thi} \\propto \\sqrt{\\tau}$，其中 $\\tau = T_i/T_e$。我们采用 $\\beta = 2/\\sqrt{\\pi}$，这是一个标准的 Hammett–Perkins 闭合系数（在无量纲单位下），适用于对朗道阻尼进行定性上正确且定量上合理的估计。\n\n综合这些要素，我们将临界点附近的线性增长率写为\n$$\n\\gamma(k_y, \\eta_i) \\approx \\underbrace{\\omega_{*i}(k_y) \\, \\kappa \\, S(b)}_{\\mathcal{D}_\\text{drive}(k_y)} \\, \\eta_i \\;-\\; \\underbrace{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}_{\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau)}.\n$$\n通过设置 $\\gamma = 0$ 得到临界梯度，即\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, \\omega_{*i}(k_y) \\, S(b)}.\n$$\n采用归一化 $\\omega_{*i}(k_y) = k_y$ 和选择 $\\rho_i = 1$，我们有 $b = k_y^2$，因此\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, k_y \\, S(k_y^2)}.\n$$\n\n算法设计：\n- 使用 $\\Gamma_n(b) = e^{-b} I_n(b)$ 计算扫描区间内每个 $k_y$ 对应的 $\\Gamma_0(b)$ 和 $\\Gamma_1(b)$。\n- 计算 $S(b) = \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right]$。\n- 使用给定的 $\\tau$、$\\kappa$、$k_\\parallel$ 和 $\\beta = 2/\\sqrt{\\pi}$，为每个 $k_y$ 评估 $\\eta_i^\\text{crit}(k_y)$。\n- 该参数集的总临界梯度是扫描区间上 $\\eta_i^\\text{crit}(k_y)$ 的最小值。\n- 边缘情况：\n  - 如果 $\\kappa = 0$，则无论 $\\eta_i$ 为何值，驱动项都为零，模型无法预测有限的阈值。返回 $\\text{NaN}$。\n  - 如果对于所有采样的 $k_y$，$S(b) \\le 0$（在这个简化模型中，这对应于不符合物理意义或极大的FLR区域），则驱动项为零或为负。返回 $\\text{NaN}$。\n\n数值考虑：\n- 修正贝塞尔函数 $I_n(b)$ 使用可靠的特殊函数库计算。函数 $S(b)$ 在 $b \\ge 0$ 时是平滑的，并且在物理相关范围内通常为正。我们在指定区间内对 $k_y$ 进行均匀采样，采样点数需确保覆盖小FLR和大FLR区域。\n- 最小值通过在离散的 $k_y$ 值上进行直接搜索来计算，这是足够的，因为 $\\eta_i^\\text{crit}(k_y)$ 是一个平滑函数，且扫描区间适中。\n\n测试套件实现：\n- 情况 1：$\\tau = 1.0$，$\\kappa = 0.2$，$k_\\parallel L_n = 0.05$，$k_y \\in [0.1, 1.5]$，采样 200 个点。\n- 情况 2：$\\tau = 1.5$，$\\kappa = 0.25$，$k_\\parallel L_n = 0.03$，$k_y \\in [0.05, 2.0]$，采样 400 个点。\n- 情况 3：$\\tau = 0.7$，$\\kappa = 0.05$，$k_\\parallel L_n = 0.1$，$k_y \\in [0.2, 1.2]$，采样 200 个点。\n- 情况 4：$\\tau = 1.0$，$\\kappa = 0.01$，$k_\\parallel L_n = 0.05$，$k_y \\in [0.1, 1.5]$，采样 200 个点。\n\n最终输出规范：\n生成单行输出，包含一个Python列表字面量，内有对应四种情况的四个浮点数，四舍五入到六位小数。精确使用格式 $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$。如果某个情况产生无法确定的值，则该条目使用 $\\text{nan}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import iv\n\ndef gamma0(b):\n    # Gamma_0(b) = e^{-b} I_0(b)\n    return np.exp(-b) * iv(0, b)\n\ndef gamma1(b):\n    # Gamma_1(b) = e^{-b} I_1(b)\n    return np.exp(-b) * iv(1, b)\n\ndef S_of_b(b):\n    # S(b) = Gamma0(b) + b*(Gamma0(b) - Gamma1(b))\n    G0 = gamma0(b)\n    G1 = gamma1(b)\n    return G0 + b * (G0 - G1)\n\ndef eta_crit_for_params(tau, kappa, kpar, ky_min, ky_max, n_samples):\n    # Constants and normalization\n    beta = 2.0 / np.sqrt(np.pi)  # Hammett–Perkins closure coefficient\n    # Handle zero curvature drive edge case\n    if kappa == 0.0:\n        return np.nan\n    # Sample ky uniformly\n    kys = np.linspace(ky_min, ky_max, n_samples)\n    # Avoid ky=0 to prevent division by zero; ky_min is positive by specification\n    # Compute eta_crit(ky) and return the minimum over the scan\n    eta_vals = []\n    for ky in kys:\n        b = ky**2  # with rho_i = 1\n        Sb = S_of_b(b)\n        # If S(b) = 0, skip as unphysical in this simplified model\n        if Sb = 0.0:\n            continue\n        # omega_*i normalized as ky\n        denom = kappa * ky * Sb\n        if denom = 0.0:\n            continue\n        eta_val = (beta * abs(kpar) * np.sqrt(tau)) / denom\n        eta_vals.append(eta_val)\n    if len(eta_vals) == 0:\n        return np.nan\n    return float(np.min(eta_vals))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (tau, kappa, kpar, ky_min, ky_max, n_samples)\n    test_cases = [\n        (1.0, 0.2, 0.05, 0.1, 1.5, 200),   # Case 1\n        (1.5, 0.25, 0.03, 0.05, 2.0, 400), # Case 2\n        (0.7, 0.05, 0.1, 0.2, 1.2, 200),   # Case 3\n        (1.0, 0.01, 0.05, 0.1, 1.5, 200),  # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        tau, kappa, kpar, ky_min, ky_max, n_samples = case\n        crit = eta_crit_for_params(tau, kappa, kpar, ky_min, ky_max, n_samples)\n        if np.isnan(crit):\n            results.append(\"nan\")\n        else:\n            # Round to six decimal places\n            results.append(f\"{crit:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "我们之前的分析是局域的，忽略了模式的空间结构。这个高级练习将引入强大的“球栅”变换方法，它将磁通面上复杂的二维问题转化为沿延伸磁力线的可解的一维本征值问题。通过离散化并求解该问题 ()，您不仅可以计算不稳定性的增长率，还可以可视化其特征空间形状，即“本征模”，从而更深入地理解其在环形几何中的结构。",
            "id": "3704973",
            "problem": "考虑环形约束装置中的无碰撞、静电、低贝塔、磁化等离子体。关注有理面附近的局域、线性、气球模空间表示下的离子温度梯度（ITG）模。假设电子是绝热的，波长相对于离子拉莫尔半径为长波，并使用涨落电势较小的标准回旋动理学级数。从基本的线性离子回旋动理学方程和沿磁力线的线约束准中性条件出发，通过气球模变换将问题简化为气球模角坐标下的一维本征值问题。基于有界能量密度的要求，在大绝对值的气球模角处施加具有物理动机的边界条件。\n\n您的任务是：\n- 从第一性原理出发，推导在上述假设下有效的、针对无量纲单位下静电势包络 $\\,\\phi(\\theta)\\,$ 的一维线性气球模空间本征值问题。清晰地定义大 $\\,|\\theta|\\,$ 处的边界条件，并从平行可压缩性、磁剪切以及曲率驱动的离子温度梯度驱动的角度解释简化方程中的每一项。\n- 解释如何将无限域截断为有限区间，并选择与 $\\,\\phi(\\theta)\\,$ 的物理衰减行为一致的边界条件。\n- 详细描述一种有限差分方法，将连续本征值问题转换为适合数值求解的广义矩阵本征值问题。\n\n为进行数值验证，在推导后采用以下简化模型：取有效势为 $\\,U(\\theta) = s^2 \\theta^2\\,$，其中 $\\,s\\,$ 是无量纲磁剪切；包含一个曲率/驱动位移 $\\,\\Lambda\\,$；并将本征频率的线性耦合建模为一个标量复数因子。以无量纲形式，待离散化的简化本征值问题为\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi,\n$$\n其中 $\\,\\omega\\,$ 是归一化到特征漂移频率的复本征频率，$\\,a\\,\\in\\mathbb{R}\\,$ 代表电抗耦合系数，$\\,b\\,\\in\\mathbb{R}_{\\ge 0}\\,$ 代表一个耗散或非厄米贡献，当与负的算子本征值结合时可导致增长。使用边界条件 $\\,\\phi(\\theta) \\to 0\\,$ 当 $\\,|\\theta|\\to\\infty\\,$，在截断的有限区间上通过均匀狄利克雷条件近似。所有量均为无量纲；将 $\\,\\theta\\,$ 视为弧度。\n\n离散化要求：\n- 将域截断为 $\\,\\theta \\in [-\\theta_{\\max},\\,\\theta_{\\max}]\\,$，包含 $\\,N\\,$ 个内点，并在端点施加均匀狄利克雷边界条件，以模拟大 $\\,|\\theta|\\,$ 处的衰减。\n- 在间距为 $\\,h = \\frac{2\\,\\theta_{\\max}}{N+1}\\,$ 的均匀网格上，对二阶导数使用二阶中心有限差分，得到 $\\,\\frac{d^2}{d\\theta^2}\\,$ 的标准三对角近似。\n- 构建广义矩阵本征值问题\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} \\;=\\; \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi},\n$$\n其中\n$$\n\\mathbf{A} \\;=\\; \\mathbf{L} \\;+\\; \\operatorname{diag}\\!\\big(U(\\theta_j)\\big) \\;-\\; \\Lambda\\,\\mathbf{I},\n\\qquad\n\\mathbf{L} \\;=\\; -\\,\\mathbf{D}_2,\n\\qquad\n\\mathbf{B} \\;=\\; (a + i\\,b)\\,\\mathbf{I},\n$$\n其中 $\\,\\mathbf{D}_2\\,$ 是带均匀狄利克雷边界条件的二阶导数有限差分矩阵，$\\,\\mathbf{I}\\,$ 是单位矩阵，$\\,\\theta_j\\,$ 是内部网格点。\n\n算法输出要求：\n- 对于下方的每个测试用例，计算所有广义本征值 $\\,\\omega_k\\,$，并选择具有最大虚部 $\\,\\max_k \\operatorname{Im}(\\omega_k)\\,$ 的本征值。将该最大虚部作为线性增长率的数值代理进行报告。如果所有 $\\,\\operatorname{Im}(\\omega_k)\\le 0\\,$，则该模是稳定的，报告的值将为非正数。\n- 您的程序应生成单行输出，其中包含用逗号分隔并用方括号括起来的结果（例如，“[result1,result2,result3]”）。\n\n测试套件：\n- 用例 $\\,1\\,$ (预期在强驱动下不稳定): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 120.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- 用例 $\\,2\\,$ (预期在弱驱动下稳定): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 5.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- 用例 $\\,3\\,$ (近阈值行为): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.2\\,$.\n- 用例 $\\,4\\,$ (纯保守耦合): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.0\\,$.\n\n以上所有数值均为无量纲。角度 $\\,\\theta\\,$ 应按弧度处理。最终输出应为指定格式的单行四个浮点数列表 $\\,\\left[\\operatorname{Im}(\\omega_{\\text{dom},1}), \\operatorname{Im}(\\omega_{\\text{dom},2}), \\operatorname{Im}(\\omega_{\\text{dom},3}), \\operatorname{Im}(\\omega_{\\text{dom},4})\\right]\\,$。",
            "solution": "该问题要求在气球模空间中推导离子温度梯度（ITG）模的一维本征值方程，然后对一个简化的模型方程进行数值求解。验证确认了该问题在等离子体物理学方面有科学依据，是适定的，并为数值任务提供了一套清晰、独立的指令。所有假设和简化在学术界中为了教学和研究目的都是标准的。该问题有效。\n\n**第一部分：推导与解释**\n\n我们从具有嵌套磁通量面的环形磁约束系统（如托卡马克）开始。ITG 模是由离子温度的空间梯度驱动的微观不稳定性。我们考虑无碰撞、静电、低贝塔等离子体。分析局限于单个有理磁面上。\n\n出发点是针对扰动离子分布函数 $\\delta f_i$ 的线性离子回旋动理学方程，以及准中性条件 $\\delta n_i = \\delta n_e$。假设电子对涨落的静电势 $\\phi$ 作绝热响应，因此其扰动密度由玻尔兹曼关系 $\\delta n_e = n_0 \\frac{e \\phi}{T_e}$ 给出，其中 $n_0$ 是平衡密度， $T_e$ 是电子温度。\n\n导心分布函数 $f_i$ 的线性弗拉索夫方程为\n$$\n\\frac{\\partial f_i}{\\partial t} + (\\mathbf{v}_\\parallel + \\mathbf{v}_D) \\cdot \\nabla f_i - \\frac{e}{m_i} \\nabla_\\parallel \\phi \\frac{\\partial F_{0i}}{\\partial E} = 0\n$$\n其中 $F_{0i}$ 是背景麦克斯韦分布，$\\mathbf{v}_D$ 是磁漂移（曲率和 $\\nabla B$）。我们对形式为 $\\phi(\\mathbf{r}, t) = \\phi(\\mathbf{r}) e^{-i\\omega t}$ 的扰动将此方程线性化。\n\n在环中分析模的核心困难在于磁场强度和曲率在磁通量面上变化。这会耦合不同的角向谐波。气球模变换是处理此问题的一种数学工具。它将磁通量面上径向 ($r$) 和角向 ($\\theta$) 的二维问题转换为一个扩展的、无限的角向角坐标（也表示为 $\\theta$）下的一维问题。一个涨落量 $\\Phi(r, \\theta, \\zeta)$（其中 $\\zeta$ 是环向角）表示为：\n$$\n\\Phi(r, \\theta, \\zeta) = e^{-in\\zeta} \\sum_{m} e^{im\\theta} \\phi_m(r) \\rightarrow e^{-in\\zeta} \\int_{-\\infty}^{\\infty} d\\theta_k e^{inq\\theta_k} \\hat{\\phi}(\\theta_k, r)\n$$\n假设模强烈局域于有理面 $r=r_0$（其中 $q(r_0)=m_0/n_0$）附近，则模结构由扩展气球模坐标 $\\theta \\in (-\\infty, \\infty)$ 中的单个包络函数 $\\phi(\\theta)$ 表示。在此表示中，平行和垂直波矢变为算子：\n$$\nk_\\parallel \\rightarrow \\frac{1}{q R_0} (-i \\frac{\\partial}{\\partial \\theta})\n$$\n$$\nk_\\perp^2 \\rightarrow k_y^2 [1 + (s\\theta - \\alpha \\sin\\theta)^2]\n$$\n其中 $k_y = nq/r$ 是副法线波矢， $q$ 是安全因子， $R_0$ 是大半径， $s = (r/q) (dq/dr)$ 是磁剪切，而 $\\alpha = -2(r/R_0)(1-q^{-2})$ 与气球模参数相关。\n\n离子密度扰动 $\\delta n_i = \\int d^3v \\, \\delta f_i$ 是通过求解回旋动理学方程得到 $\\delta f_i$ 并对速度空间积分来计算的。在长波极限（$k_\\perp \\rho_i \\ll 1$，其中 $\\rho_i$ 是离子拉莫尔半径）下，并利用问题中的假设，准中性条件 $\\delta n_e = \\delta n_i$ 产生一个关于电势包络 $\\phi(\\theta)$ 的二阶常微分方程：\n$$\n\\left[ \\frac{\\partial^2}{\\partial \\theta^2} + k_y^2 \\rho_s^2 (s\\theta)^2 + \\frac{q^2}{\\tau} \\left( \\frac{\\omega_{*e}}{\\omega} - 1 - \\frac{\\omega_{Di}}{\\omega} \\left( 1 + \\eta_i \\right) \\right) \\right] \\phi(\\theta) = 0\n$$\n这里，$\\tau=T_e/T_i$，$\\omega_{*e}$ 是电子抗磁漂移频率，$\\omega_{Di} \\approx 2 \\epsilon_n \\omega_{*e} (\\cos\\theta + s\\theta \\sin\\theta)$ 是包含曲率效应的离子磁漂移频率，而 $\\eta_i = d(\\ln T_i)/d(\\ln n_i)$ 是密度与温度梯度标长之比。这个方程仍然很复杂。问题提供了一个简化的唯象模型，它抓住了基本物理：\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi\n$$\n这是一个类薛定谔本征值方程。让我们解释它的各项：\n1.  $-\\frac{d^2\\phi}{d\\theta^2}$：该项源于 $k_\\parallel^2$ 算子，代表离子沿磁力线运动的效应。它对应于平行离子可压缩性和声波传播。这种效应倾向于沿磁力线“短路”电势涨落，是一种稳定机制。\n2.  $U(\\theta) = s^2 \\theta^2$：该项是 $k_\\perp^2$ 变化的简化表示。磁剪切 $s$ 导致模的有效径向波矢在 $|\\theta|$ 较大时增加，从而增强了各种阻尼机制（未明确包含但由该项建模）并使模局域化。它充当一个势阱，将本征函数 $\\phi(\\theta)$ 限制在 $\\theta=0$ 附近。\n3.  $\\Lambda$：该项代表不稳定性驱动，对于 ITG 模，它源于不利磁曲率和离子压力梯度（与 $1+\\eta_i$ 成正比）的组合。较大的 $\\Lambda$ 对应于更强的驱动。它有效地降低了势能基底，使得束缚态（即不稳定的模）更容易存在。在完整的物理模型中，此项与频率 $\\omega$ 耦合。\n4.  $\\omega(a + i b)\\phi$：这是本征值项。$\\omega$ 是复模频率，其中 $\\operatorname{Re}(\\omega)$ 是振荡频率，$\\operatorname{Im}(\\omega)$ 是增长率。复数因子 $(a+ib)$ 建模了完整等离子体响应的复杂频率依赖性，这种依赖性在方程左侧已被简化掉。虚部 $b$ 代表了增长所必需的非厄米效应，如动理学波-粒子共振。正的增长率 $\\operatorname{Im}(\\omega)  0$ 表示一个不稳定的模。\n\n**边界条件与离散化**\n\n一个具有物理意义的模必须是空间局域的，这意味着其能量密度（与 $|\\phi|^2$ 成正比）必须是可积的。这要求本征函数 $\\phi(\\theta)$ 在 $|\\theta| \\to \\infty$ 时必须衰减到零。势 $U(\\theta)=s^2\\theta^2$ 确保了所有解确实是局域的并呈指数衰减。\n\n为了进行数值求解，我们将无限域 $\\theta \\in (-\\infty, \\infty)$ 截断为有限区间 $[-\\theta_{\\max}, \\theta_{\\max}]$。如果 $\\theta_{\\max}$ 选得足够大，本征函数在边界处将小到可以忽略不计。因此，我们可以用均匀狄利克雷边界条件来近似衰减条件：$\\phi(-\\theta_{\\max}) = 0$ 和 $\\phi(\\theta_{\\max}) = 0$。\n\n我们使用有限差分格式来离散化这个连续问题。我们定义一个包含 $N$ 个内点的均匀网格 $\\theta_j = -\\theta_{\\max} + j h$（其中 $j=1, \\dots, N$），网格间距为 $h = \\frac{2\\theta_{\\max}}{N+1}$。这些点上的函数值向量为 $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2, \\dots, \\phi_N]^T$。二阶导数使用二阶中心差分格式来近似：\n$$\n\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_j} \\approx \\frac{\\phi_{j-1} - 2\\phi_j + \\phi_{j+1}}{h^2}\n$$\n在边界条件 $\\phi_0 = \\phi_{N+1} = 0$下，算子 $-\\frac{d^2}{d\\theta^2}$ 变为一个 $N \\times N$ 矩阵 $\\mathbf{L}$：\n$$\n\\mathbf{L} = \\frac{1}{h^2} \\begin{pmatrix} 2  -1  0  \\cdots  0 \\\\ -1  2  -1   0 \\\\ 0  -1  \\ddots  \\ddots  \\vdots \\\\ \\vdots   \\ddots  2  -1 \\\\ 0  \\cdots  0  -1  2 \\end{pmatrix}\n$$\n势项 $U(\\theta)\\phi$ 变为一个乘以 $\\boldsymbol{\\phi}$ 的对角矩阵，其元素为 $\\operatorname{diag}(U(\\theta_j)) = \\operatorname{diag}(s^2\\theta_j^2)$。常数项 $-\\Lambda\\phi$ 变为 $-\\Lambda\\mathbf{I}$，其中 $\\mathbf{I}$ 是单位矩阵。因此，该本征值问题被转换为一个广义矩阵本征值问题：\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} = \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi}\n$$\n其中矩阵 $\\mathbf{A}$ 和 $\\mathbf{B}$ 由下式给出：\n$$\n\\mathbf{A} = \\mathbf{L} + \\operatorname{diag}(s^2 \\theta_j^2) - \\Lambda\\mathbf{I}\n$$\n$$\n\\mathbf{B} = (a + i b)\\mathbf{I}\n$$\n这个系统可以通过数值方法求解，得到本征值 $\\omega$ 及其对应的本征向量 $\\boldsymbol{\\phi}$。不稳定性增长率是所有本征值中找到的最大虚部。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Solves the generalized eigenvalue problem for a simplified ITG mode model\n    for a series of test cases and reports the maximum growth rate for each.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, theta_max, s, Lambda, a, b)\n        (64, 6.0, 0.6, 120.0, 1.0, 0.3),\n        (64, 6.0, 0.6, 5.0, 1.0, 0.3),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.2),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, theta_max, s, Lambda, a, b = case\n\n        # 1. Set up the grid\n        # Grid spacing for N interior points. The total number of intervals is N+1.\n        h = 2.0 * theta_max / (N + 1)\n        # Interior grid points from -theta_max+h to theta_max-h\n        theta_j = np.linspace(-theta_max + h, theta_max - h, N)\n\n        # 2. Construct the matrices A and B for the problem A*phi = omega*B*phi\n\n        # Construct matrix L = -D_2, representing the -d^2/d(theta)^2 operator\n        # with homogeneous Dirichlet boundary conditions.\n        # This is a tridiagonal matrix.\n        main_diag_L = np.full(N, 2.0 / h**2)\n        off_diag_L = np.full(N - 1, -1.0 / h**2)\n        L = np.diag(main_diag_L) + np.diag(off_diag_L, k=1) + np.diag(off_diag_L, k=-1)\n        \n        # Construct the potential matrix U_mat = diag(U(theta_j))\n        U_theta = s**2 * theta_j**2\n        U_mat = np.diag(U_theta)\n\n        # Construct matrix A = L + U_mat - Lambda*I\n        I = np.eye(N)\n        A = L + U_mat - Lambda * I\n\n        # Construct matrix B = (a + i*b)*I\n        B = (a + 1j * b) * I\n\n        # 3. Solve the generalized eigenvalue problem\n        # scipy.linalg.eig solves A*v = w*B*v, where w are the eigenvalues.\n        try:\n            eigenvalues, _ = eig(A, b=B)\n        except np.linalg.LinAlgError:\n            # Should not happen with the given B matrix as it's non-singular.\n            # But as a safeguard:\n            results.append(np.nan)\n            continue\n            \n        # 4. Find the dominant growth rate\n        # The growth rate is the imaginary part of the eigenvalue omega.\n        # We are looking for the most unstable mode, which has the largest growth rate.\n        if eigenvalues is not None and len(eigenvalues)  0:\n            max_growth_rate = np.max(np.imag(eigenvalues))\n        else:\n            max_growth_rate = 0.0 # Or handle as an error\n            \n        results.append(max_growth_rate)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}