{
    "hands_on_practices": [
        {
            "introduction": "The concept of a \"Finite Larmor Radius\" begins with understanding the Larmor radius itself—the characteristic scale of a charged particle's gyration in a magnetic field. This foundational exercise guides you through deriving the gyroradius, $r_L$, from the Lorentz force and calculating its value for a typical fusion plasma particle . Mastering this calculation is the first step toward appreciating when and why the particle's finite orbital size becomes a critical factor in plasma dynamics.",
            "id": "3963559",
            "problem": "A singly ionized hydrogen nucleus (proton) with charge $q=+e$ and mass $m=m_{p}$ moves in a uniform magnetic field of magnitude $B$ such that its velocity component perpendicular to the magnetic field is $v_{\\perp}$. In the context of magnetized plasma dynamics and wave–particle interaction basics relevant to computational fusion science and engineering, the perpendicular motion of the charged particle in a uniform magnetic field is circular due to the Lorentz force. Starting from the Lorentz force law $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$ and the kinematic description of uniform circular motion, derive an expression for the gyroradius (also called the Larmor radius) $r_{L}$ in terms of $m$, $q$, $v_{\\perp}$, and $B$. Then, compute $r_{L}$ for a proton with $v_{\\perp} = 2.50\\times 10^{6}\\,\\mathrm{m/s}$ in a uniform field $B = 6.00\\,\\mathrm{T}$. Use $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$ and $m_{p} = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$. Assume nonrelativistic motion. Express your final numerical answer for $r_{L}$ in meters and round your result to four significant figures.\n\nFinally, based on your derived expression, discuss the scaling of $r_{L}$ with particle mass $m$, charge magnitude $|q|$, and magnetic field strength $B$, connecting to the notion of cyclotron frequency as it arises from first principles.",
            "solution": "The problem asks for the derivation of the gyroradius for a charged particle in a uniform magnetic field, its numerical calculation for a specific case, and a discussion of its scaling properties.\n\n**Problem Validation**\n\nFirst, I will validate the provided problem statement.\n\n**Step 1: Extract Givens**\n-   Particle: Singly ionized hydrogen nucleus (proton).\n-   Charge: $q = +e$.\n-   Mass: $m = m_p$.\n-   Magnetic Field: Uniform, with magnitude $B$.\n-   Velocity: Perpendicular component to the magnetic field is $v_{\\perp}$.\n-   Governing Equation: Lorentz force law, $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$.\n-   Motion Type: Uniform circular motion for the perpendicular component.\n-   Task 1: Derive an expression for the gyroradius $r_{L}$ in terms of $m$, $q$, $v_{\\perp}$, and $B$.\n-   Task 2: Compute $r_{L}$ for a proton with $v_{\\perp} = 2.50\\times 10^{6}\\,\\mathrm{m/s}$ in a uniform field $B = 6.00\\,\\mathrm{T}$.\n-   Constants: $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$, $m_{p} = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$.\n-   Assumption: Nonrelativistic motion.\n-   Requirement: Express numerical answer in meters, rounded to four significant figures.\n-   Task 3: Discuss the scaling of $r_L$ with $m$, $|q|$, and $B$, and connect to the cyclotron frequency.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is a classic and fundamental exercise in plasma physics and electromagnetism, based on the well-established Lorentz force law and Newtonian mechanics. The context of fusion science is appropriate and the physical parameters are realistic. The proton energy is $(1/2)m_p v_{\\perp}^2 \\approx 32.7\\,\\mathrm{keV}$ and the magnetic field strength of $6.00\\,\\mathrm{T}$ is typical for high-field fusion experiments. The velocity $v_{\\perp} = 2.50\\times 10^6\\,\\mathrm{m/s}$ is approximately $0.83\\%$ of the speed of light, so the nonrelativistic assumption is valid.\n-   **Well-Posed:** The problem is clearly stated, with all necessary data and constraints provided to derive a unique analytical expression and compute a specific numerical result.\n-   **Objective:** The language is formal, precise, and free of subjective or ambiguous statements.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is scientifically sound, well-posed, and objective. I will now proceed with the solution.\n\n**Part 1: Derivation of the Gyroradius ($r_L$)**\n\nThe motion of a charged particle with mass $m$ and charge $q$ in a magnetic field $\\mathbf{B}$ is governed by the Lorentz force, given by Newton's second law:\n$$m \\frac{d\\mathbf{v}}{dt} = q(\\mathbf{v} \\times \\mathbf{B})$$\nLet's decompose the velocity vector $\\mathbf{v}$ into components parallel ($\\mathbf{v}_{\\parallel}$) and perpendicular ($\\mathbf{v}_{\\perp}$) to the magnetic field $\\mathbf{B}$. So, $\\mathbf{v} = \\mathbf{v}_{\\parallel} + \\mathbf{v}_{\\perp}$.\nSubstituting this into the equation of motion:\n$$m \\frac{d}{dt}(\\mathbf{v}_{\\parallel} + \\mathbf{v}_{\\perp}) = q((\\mathbf{v}_{\\parallel} + \\mathbf{v}_{\\perp}) \\times \\mathbf{B})$$\n$$m \\frac{d\\mathbf{v}_{\\parallel}}{dt} + m \\frac{d\\mathbf{v}_{\\perp}}{dt} = q(\\mathbf{v}_{\\parallel} \\times \\mathbf{B}) + q(\\mathbf{v}_{\\perp} \\times \\mathbf{B})$$\nSince $\\mathbf{v}_{\\parallel}$ is parallel to $\\mathbf{B}$, their cross product is zero: $\\mathbf{v}_{\\parallel} \\times \\mathbf{B} = \\mathbf{0}$. The equation simplifies to:\n$$m \\frac{d\\mathbf{v}_{\\parallel}}{dt} + m \\frac{d\\mathbf{v}_{\\perp}}{dt} = q(\\mathbf{v}_{\\perp} \\times \\mathbf{B})$$\nThis shows that there is no force component parallel to $\\mathbf{B}$, so the parallel velocity $\\mathbf{v}_{\\parallel}$ remains constant. The force acts entirely in the plane perpendicular to $\\mathbf{B}$. The equation for the perpendicular motion is:\n$$m \\frac{d\\mathbf{v}_{\\perp}}{dt} = q(\\mathbf{v}_{\\perp} \\times \\mathbf{B})$$\nThe force $\\mathbf{F}_{\\perp} = q(\\mathbf{v}_{\\perp} \\times \\mathbf{B})$ is always perpendicular to both $\\mathbf{v}_{\\perp}$ and $\\mathbf{B}$. A force that is constant in magnitude and always perpendicular to the velocity vector results in uniform circular motion. The magnitude of this force is:\n$$F_{\\perp} = |q| v_{\\perp} B \\sin(\\theta)$$\nwhere $v_{\\perp} = |\\mathbf{v}_{\\perp}|$ and $\\theta$ is the angle between $\\mathbf{v}_{\\perp}$ and $\\mathbf{B}$. By definition, $\\theta = \\frac{\\pi}{2}$, so $\\sin(\\theta) = 1$. The force magnitude is therefore:\n$$F_{\\perp} = |q| v_{\\perp} B$$\nFor uniform circular motion with radius $r_L$ (the gyroradius) and speed $v_{\\perp}$, the centripetal force required is given by:\n$$F_{c} = m a_{c} = m \\frac{v_{\\perp}^2}{r_L}$$\nEquating the magnitude of the magnetic Lorentz force with the required centripetal force:\n$$m \\frac{v_{\\perp}^2}{r_L} = |q| v_{\\perp} B$$\nAssuming $v_{\\perp} \\neq 0$, we can divide both sides by $v_{\\perp}$ and solve for $r_L$:\n$$r_L = \\frac{m v_{\\perp}}{|q| B}$$\nThis is the desired expression for the gyroradius.\n\n**Part 2: Numerical Calculation of $r_L$**\n\nWe are given the following values for a proton:\n-   Mass $m = m_p = 1.67262192369 \\times 10^{-27}\\,\\mathrm{kg}$\n-   Charge $q = +e$, so $|q| = e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n-   Perpendicular velocity $v_{\\perp} = 2.50 \\times 10^{6}\\,\\mathrm{m/s}$\n-   Magnetic field strength $B = 6.00\\,\\mathrm{T}$\n\nSubstituting these values into the derived expression for $r_L$:\n$$r_L = \\frac{(1.67262192369 \\times 10^{-27}\\,\\mathrm{kg}) \\cdot (2.50 \\times 10^{6}\\,\\mathrm{m/s})}{(1.602176634 \\times 10^{-19}\\,\\mathrm{C}) \\cdot (6.00\\,\\mathrm{T})}$$\n$$r_L = \\frac{4.181554809225 \\times 10^{-21}}{9.613059804 \\times 10^{-19}}\\,\\mathrm{m}$$\n$$r_L = 0.43499039... \\times 10^{-2}\\,\\mathrm{m}$$\n$$r_L \\approx 0.0043499\\,\\mathrm{m}$$\nThe problem requires the result to be rounded to four significant figures. The first four significant figures are $4$, $3$, $4$, $9$. The fifth digit is $9$, so we round up the fourth digit.\n$$r_L \\approx 0.004350\\,\\mathrm{m}$$\nExpressed in scientific notation, this is $4.350 \\times 10^{-3}\\,\\mathrm{m}$.\n\n**Part 3: Scaling and Connection to Cyclotron Frequency**\n\nThe derived expression for the gyroradius is $r_L = \\frac{m v_{\\perp}}{|q| B}$.\nFrom this expression, we can analyze the scaling of $r_L$:\n-   **Scaling with mass ($m$):** $r_L \\propto m$. The gyroradius is directly proportional to the particle's mass. A more massive particle has greater inertia, making it more resistant to the bending effect of the magnetic force, thus resulting in a larger orbit for the same velocity and field.\n-   **Scaling with charge magnitude ($|q|$):** $r_L \\propto \\frac{1}{|q|}$. The gyroradius is inversely proportional to the magnitude of the particle's charge. A larger charge leads to a stronger Lorentz force ($F_{\\perp} \\propto |q|$), which curves the particle's path more sharply, resulting in a smaller gyroradius.\n-   **Scaling with magnetic field strength ($B$):** $r_L \\propto \\frac{1}{B}$. The gyroradius is inversely proportional to the magnetic field strength. A stronger magnetic field also increases the Lorentz force ($F_{\\perp} \\propto B$), leading to tighter confinement and a smaller gyroradius.\n\nThe **cyclotron frequency**, $\\omega_c$, is the angular frequency of the particle's gyration. For uniform circular motion, the tangential velocity $v_{\\perp}$ is related to the angular frequency $\\omega_c$ and radius $r_L$ by $v_{\\perp} = \\omega_c r_L$.\nWe can substitute this into our gyroradius equation:\n$$r_L = \\frac{m (\\omega_c r_L)}{|q| B}$$\nCanceling $r_L$ from both sides (since $r_L \\neq 0$), we can solve for $\\omega_c$:\n$$\\omega_c = \\frac{|q| B}{m}$$\nThis is the cyclotron (or gyro-) frequency. A key result of nonrelativistic theory is that $\\omega_c$ is independent of the particle's velocity $v_{\\perp}$ and its energy.\nWe can now express the gyroradius in terms of the cyclotron frequency by rearranging the above relation:\n$$r_L = \\frac{v_{\\perp}}{\\omega_c}$$\nThis relationship provides a clear physical picture: the size of the orbit ($r_L$) is determined by how far the particle travels at speed $v_{\\perp}$ during one characteristic radian of its rotation (which happens in a time $1/\\omega_c$). A higher cyclotron frequency (from a stronger field $B$, larger charge $|q|$, or smaller mass $m$) means the particle gyrates faster, completing its circular path in a shorter time, which for a given speed $v_{\\perp}$ corresponds to a smaller radius. This elegantly connects the concepts of gyroradius, particle properties, field strength, and the fundamental frequency of motion.",
            "answer": "$$\n\\boxed{4.350 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "In reality, a gyrating particle does not experience a field at its guiding center, but rather an average over its circular path. This exercise provides direct, hands-on experience with this crucial \"gyroaveraging\" process by having you implement it numerically for a simple plasma wave . By comparing your numerical result to the exact analytical solution involving a Bessel function, you will gain a concrete understanding of how FLR effects filter out short-wavelength spatial variations.",
            "id": "3980332",
            "problem": "You are given a uniform magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$ and a charged particle of charge $q$ and mass $m$ undergoing circular motion in the plane perpendicular to $\\mathbf{B}$ due to the Lorentz force. The cyclotron angular frequency is defined by $\\Omega = \\lvert q \\rvert B / m$, and the Larmor radius is defined by $\\rho_{\\mathrm{L}} = v_{\\perp} / \\Omega$, where $v_{\\perp}$ is the magnitude of the perpendicular velocity. Consider a two-dimensional real scalar field $f(x,y) = \\cos(k_x x + k_y y)$, where $k_x$ and $k_y$ are the components of the perpendicular wavevector $\\mathbf{k}_{\\perp}$ with magnitude $k_{\\perp} = \\sqrt{k_x^2 + k_y^2}$. Let the guiding-center position be $\\mathbf{R} = (R_x, R_y)$, and let the instantaneous particle position be $\\mathbf{r}(\\theta) = \\mathbf{R} + \\rho_{\\mathrm{L}} (\\cos \\theta, \\sin \\theta)$, where $\\theta$ is the gyrophase angle.\n\nDefine the gyrophase average of $f$ at the guiding center $\\mathbf{R}$ by\n$$\\langle f \\rangle(\\mathbf{R}) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} f\\big(\\mathbf{r}(\\theta)\\big)\\, d\\theta,$$\nwith $\\theta$ expressed in radians. This quantity represents the finite Larmor radius (FLR) correction commonly used in gyrokinetic (GK) and reduced fluid models in computational fusion science and engineering.\n\nYour task is to write a complete, runnable program that:\n- Computes the numerical gyrophase average $\\langle f \\rangle(\\mathbf{R})$ using an equispaced quadrature over $\\theta \\in [0,2\\pi)$ with a sufficiently fine resolution.\n- Computes the exact analytical gyrophase average $\\langle f \\rangle_{\\text{exact}}(\\mathbf{R})$ derived from first principles in your solution.\n- Computes the second-order small-FLR approximation $\\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R})$ derived from a Taylor expansion of $f$ about $\\mathbf{R}$ and the circular average over $\\theta$.\n\nFor each test case, the program must return two floating-point numbers:\n- The absolute error between the numerical gyrophase average and the exact analytical result, $\\lvert \\langle f \\rangle(\\mathbf{R}) - \\langle f \\rangle_{\\text{exact}}(\\mathbf{R}) \\rvert$.\n- The absolute error between the numerical gyrophase average and the second-order small-FLR approximation, $\\lvert \\langle f \\rangle(\\mathbf{R}) - \\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R}) \\rvert$.\n\nUse the International System of Units (SI units) for all quantities: charge in coulombs, mass in kilograms, magnetic field in tesla, velocity in meters per second, wavevector components in inverse meters, and positions in meters. Angles must be in radians.\n\nImplement the numerical quadrature over $\\theta$ using at least $M = 4096$ equispaced points to ensure adequate accuracy for all test cases.\n\nTest suite:\n- Case $1$: $(q, m, B, v_{\\perp}, k_x, k_y, R_x, R_y) = (1.602176634\\times 10^{-19}, 3.344\\times 10^{-27}, 5, 1\\times 10^{5}, 200, 200, 0.01, -0.02)$.\n- Case $2$: $(q, m, B, v_{\\perp}, k_x, k_y, R_x, R_y) = (1.602176634\\times 10^{-19}, 9.10938356\\times 10^{-31}, 5, 2\\times 10^{6}, 2000, 0, 0.001, 0.002)$.\n- Case $3$: $(q, m, B, v_{\\perp}, k_x, k_y, R_x, R_y) = (1.602176634\\times 10^{-19}, 3.344\\times 10^{-27}, 5, 1\\times 10^{5}, 5000, 0, 0.0, 0.0)$.\n- Case $4$: $(q, m, B, v_{\\perp}, k_x, k_y, R_x, R_y) = (1.602176634\\times 10^{-19}, 3.344\\times 10^{-27}, 5, 0, 1000, 1000, 0.05, 0.05)$.\n- Case $5$: $(q, m, B, v_{\\perp}, k_x, k_y, R_x, R_y) = (1.602176634\\times 10^{-19}, 6.64\\times 10^{-27}, 1, 5\\times 10^{5}, 10, 10, -0.03, 0.04)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as:\n$$[\\;e_{\\text{exact},1},\\; e_{\\text{FLR2},1},\\; e_{\\text{exact},2},\\; e_{\\text{FLR2},2},\\; e_{\\text{exact},3},\\; e_{\\text{FLR2},3},\\; e_{\\text{exact},4},\\; e_{\\text{FLR2},4},\\; e_{\\text{exact},5},\\; e_{\\text{FLR2},5}\\;],$$\nwhere $e_{\\text{exact},i} = \\lvert \\langle f \\rangle(\\mathbf{R}) - \\langle f \\rangle_{\\text{exact}}(\\mathbf{R}) \\rvert$ and $e_{\\text{FLR2},i} = \\lvert \\langle f \\rangle(\\mathbf{R}) - \\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R}) \\rvert$ for test case $i$.",
            "solution": "The problem statement submitted for consideration is valid. It is scientifically grounded in the principles of plasma physics, specifically the motion of charged particles in magnetic fields and the associated finite Larmor radius (FLR) effects. The problem is well-posed, providing all necessary definitions, parameters, and constraints to arrive at a unique, meaningful solution. The quantities and models involved—the gyrophase average, the Bessel function solution, and the Taylor series approximation—are standard and verifiable formalisms in computational fusion science. Therefore, I will proceed with a full solution.\n\nThe central task is to evaluate the gyrophase average of a scalar field $f(x,y) = \\cos(k_x x + k_y y)$ experienced by a charged particle gyrating in a uniform magnetic field. The gyrophase average, denoted by $\\langle f \\rangle(\\mathbf{R})$, is defined by the integral:\n$$ \\langle f \\rangle(\\mathbf{R}) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} f\\big(\\mathbf{r}(\\theta)\\big)\\, d\\theta $$\nwhere $\\mathbf{R}=(R_x, R_y)$ is the guiding-center position, and $\\mathbf{r}(\\theta)$ is the instantaneous particle position given by:\n$$ \\mathbf{r}(\\theta) = (x(\\theta), y(\\theta)) = (R_x + \\rho_{\\mathrm{L}}\\cos\\theta, R_y + \\rho_{\\mathrm{L}}\\sin\\theta) $$\nHere, $\\rho_{\\mathrm{L}} = v_{\\perp} / \\Omega$ is the Larmor radius, with $v_{\\perp}$ being the particle's speed perpendicular to the magnetic field and $\\Omega = \\lvert q \\rvert B / m$ being the cyclotron frequency. We must derive the exact analytical form of this average, $\\langle f \\rangle_{\\text{exact}}(\\mathbf{R})$, and a second-order approximation, $\\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R})$, and compare them against a direct numerical evaluation, $\\langle f \\rangle(\\mathbf{R})$.\n\n### Derivation of the Exact Analytical Solution, $\\langle f \\rangle_{\\text{exact}}(\\mathbf{R})$\n\nTo derive the exact solution, we substitute the expression for the particle position $\\mathbf{r}(\\theta)$ into the function $f(x,y)$. The argument of the cosine becomes:\n$$ k_x x(\\theta) + k_y y(\\theta) = k_x (R_x + \\rho_{\\mathrm{L}}\\cos\\theta) + k_y (R_y + \\rho_{\\mathrm{L}}\\sin\\theta) $$\nRearranging the terms, we get:\n$$ (k_x R_x + k_y R_y) + \\rho_{\\mathrm{L}} (k_x \\cos\\theta + k_y \\sin\\theta) $$\nThis expression can be written compactly using the perpendicular wavevector $\\mathbf{k}_{\\perp} = (k_x, k_y)$ and the guiding-center position vector $\\mathbf{R} = (R_x, R_y)$. The first term is the dot product $\\mathbf{k}_{\\perp} \\cdot \\mathbf{R}$. For the second term, we represent $\\mathbf{k}_{\\perp}$ in polar coordinates, $k_x = k_{\\perp}\\cos\\alpha$ and $k_y = k_{\\perp}\\sin\\alpha$, where $k_{\\perp} = \\sqrt{k_x^2 + k_y^2}$ is the magnitude of the wavevector and $\\alpha$ is its polar angle. The term becomes:\n$$ \\rho_{\\mathrm{L}} (k_{\\perp}\\cos\\alpha \\cos\\theta + k_{\\perp}\\sin\\alpha \\sin\\theta) = k_{\\perp} \\rho_{\\mathrm{L}} \\cos(\\theta - \\alpha) $$\nThus, the gyrophase average integral is:\n$$ \\langle f \\rangle(\\mathbf{R}) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\cos\\left[ \\mathbf{k}_{\\perp} \\cdot \\mathbf{R} + k_{\\perp}\\rho_{\\mathrm{L}}\\cos(\\theta - \\alpha) \\right] d\\theta $$\nUsing the cosine angle addition identity, $\\cos(A+B) = \\cos A \\cos B - \\sin A \\sin B$, with $A = \\mathbf{k}_{\\perp} \\cdot \\mathbf{R}$ and $B = k_{\\perp}\\rho_{\\mathrm{L}}\\cos(\\theta - \\alpha)$, we get:\n$$ \\langle f \\rangle(\\mathbf{R}) = \\cos(\\mathbf{k}_{\\perp} \\cdot \\mathbf{R}) \\left( \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\cos(k_{\\perp}\\rho_{\\mathrm{L}}\\cos(\\theta - \\alpha)) d\\theta \\right) - \\sin(\\mathbf{k}_{\\perp} \\cdot \\mathbf{R}) \\left( \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\sin(k_{\\perp}\\rho_{\\mathrm{L}}\\cos(\\theta - \\alpha)) d\\theta \\right) $$\nThe second integral evaluates to zero due to the symmetry of the integrand. The integrand $\\sin(z \\cos\\phi)$ is anti-symmetric about $\\phi=\\pi$ over a $2\\pi$ interval, so its integral is zero. The first integral is a standard integral representation of the zeroth-order Bessel function of the first kind, $J_0(z)$:\n$$ J_0(z) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\cos(z\\cos\\phi) d\\phi $$\nSince the integration is over a full period, the phase shift $\\alpha$ does not change the value of the integral. Setting $z = k_{\\perp}\\rho_{\\mathrm{L}}$, we arrive at the exact analytical expression for the gyrophase average:\n$$ \\langle f \\rangle_{\\text{exact}}(\\mathbf{R}) = J_0(k_{\\perp} \\rho_{\\mathrm{L}}) \\cos(\\mathbf{k}_{\\perp} \\cdot \\mathbf{R}) $$\n\n### Derivation of the Second-Order Small-FLR Approximation, $\\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R})$\n\nThe second-order approximation is derived by performing a Taylor expansion of the field $f(\\mathbf{r})$ around the guiding-center position $\\mathbf{R}$. Let $\\boldsymbol{\\rho}(\\theta) = \\mathbf{r}(\\theta) - \\mathbf{R} = (\\rho_{\\mathrm{L}}\\cos\\theta, \\rho_{\\mathrm{L}}\\sin\\theta)$ be the gyroradius vector. The expansion up to second order is:\n$$  f(\\mathbf{R} + \\boldsymbol{\\rho}) \\approx f(\\mathbf{R}) + \\boldsymbol{\\rho} \\cdot \\nabla f(\\mathbf{R}) + \\frac{1}{2} (\\boldsymbol{\\rho} \\cdot \\nabla)^2 f(\\mathbf{R}) $$\nTo find the gyrophase average, we average each term over $\\theta \\in [0, 2\\pi)$. The derivatives of $f$ are evaluated at $\\mathbf{R}$ and are constant with respect to $\\theta$. We need the averages of components of $\\boldsymbol{\\rho}$:\n$$ \\langle \\rho_x \\rangle = \\langle \\rho_{\\mathrm{L}}\\cos\\theta \\rangle = 0 $$\n$$ \\langle \\rho_y \\rangle = \\langle \\rho_{\\mathrm{L}}\\sin\\theta \\rangle = 0 $$\n$$ \\langle \\rho_x^2 \\rangle = \\langle \\rho_{\\mathrm{L}}^2\\cos^2\\theta \\rangle = \\rho_{\\mathrm{L}}^2 \\langle \\frac{1+\\cos(2\\theta)}{2} \\rangle = \\frac{\\rho_{\\mathrm{L}}^2}{2} $$\n$$ \\langle \\rho_y^2 \\rangle = \\langle \\rho_{\\mathrm{L}}^2\\sin^2\\theta \\rangle = \\rho_{\\mathrm{L}}^2 \\langle \\frac{1-\\cos(2\\theta)}{2} \\rangle = \\frac{\\rho_{\\mathrm{L}}^2}{2} $$\n$$ \\langle \\rho_x \\rho_y \\rangle = \\langle \\rho_{\\mathrm{L}}^2\\cos\\theta\\sin\\theta \\rangle = \\rho_{\\mathrm{L}}^2 \\langle \\frac{\\sin(2\\theta)}{2} \\rangle = 0 $$\nTaking the average of the Taylor series:\n$$ \\langle f(\\mathbf{R} + \\boldsymbol{\\rho}) \\rangle \\approx f(\\mathbf{R}) + \\frac{1}{2} \\left( \\langle \\rho_x^2 \\rangle \\frac{\\partial^2 f}{\\partial x^2} + 2\\langle \\rho_x \\rho_y \\rangle \\frac{\\partial^2 f}{\\partial x \\partial y} + \\langle \\rho_y^2 \\rangle \\frac{\\partial^2 f}{\\partial y^2} \\right) \\bigg|_{\\mathbf{R}} $$\n$$ \\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R}) = f(\\mathbf{R}) + \\frac{1}{2} \\left( \\frac{\\rho_{\\mathrm{L}}^2}{2} \\frac{\\partial^2 f}{\\partial x^2} + 0 + \\frac{\\rho_{\\mathrm{L}}^2}{2} \\frac{\\partial^2 f}{\\partial y^2} \\right) \\bigg|_{\\mathbf{R}} = f(\\mathbf{R}) + \\frac{\\rho_{\\mathrm{L}}^2}{4} \\nabla^2_{\\perp} f(\\mathbf{R}) $$\nFor the given function $f(x,y) = \\cos(k_x x + k_y y)$, the perpendicular Laplacian is:\n$$ \\nabla^2_{\\perp} f = \\frac{\\partial^2 f}{\\partial x^2} + \\frac{\\partial^2 f}{\\partial y^2} = -k_x^2 \\cos(k_x x + k_y y) - k_y^2 \\cos(k_x x + k_y y) = -(k_x^2 + k_y^2) f = -k_{\\perp}^2 f $$\nSubstituting this into the approximation yields:\n$$ \\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R}) = f(\\mathbf{R}) - \\frac{k_{\\perp}^2 \\rho_{\\mathrm{L}}^2}{4} f(\\mathbf{R}) $$\n$$ \\langle f \\rangle_{\\text{FLR2}}(\\mathbf{R}) = \\left(1 - \\frac{k_{\\perp}^2 \\rho_{\\mathrm{L}}^2}{4}\\right) \\cos(\\mathbf{k}_{\\perp} \\cdot \\mathbf{R}) $$\nThis result is consistent with the second-order Taylor expansion of $J_0(k_{\\perp} \\rho_{\\mathrm{L}})$ for small arguments, which is $J_0(z) \\approx 1 - z^2/4$.\n\n### Numerical Implementation\n\nThe numerical gyrophase average $\\langle f \\rangle(\\mathbf{R})$ is computed using a simple quadrature rule, specifically the rectangle method with $M=4096$ equispaced points $\\theta_j = 2\\pi j / M$ for $j=0, \\dots, M-1$. The discrete average is:\n$$ \\langle f \\rangle(\\mathbf{R}) \\approx \\frac{1}{M} \\sum_{j=0}^{M-1} f\\big(\\mathbf{r}(\\theta_j)\\big) = \\frac{1}{M} \\sum_{j=0}^{M-1} \\cos\\left( k_x(R_x+\\rho_{\\mathrm{L}}\\cos\\theta_j) + k_y(R_y+\\rho_{\\mathrm{L}}\\sin\\theta_j) \\right) $$\nThe algorithm calculates this numerical value and compares it to the results from the two derived analytical formulas, $\\langle f \\rangle_{\\text{exact}}$ and $\\langle f \\rangle_{\\text{FLR2}}$, for each test case provided. The absolute errors are then reported. The special case where $v_{\\perp}=0$ implies $\\rho_{\\mathrm{L}}=0$, which simplifies all three expressions to $f(\\mathbf{R}) = \\cos(\\mathbf{k}_{\\perp} \\cdot \\mathbf{R})$, resulting in zero error as expected.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j0\n\ndef solve():\n    \"\"\"\n    Computes and compares numerical, analytical, and approximate gyrophase averages\n    for a charged particle in a magnetic field.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Deuteron, moderate k_perp * rho_L\n        (1.602176634e-19, 3.344e-27, 5, 1e5, 200, 200, 0.01, -0.02),\n        # Case 2: Positron, small k_perp * rho_L\n        (1.602176634e-19, 9.10938356e-31, 5, 2e6, 2000, 0, 0.001, 0.002),\n        # Case 3: Deuteron, large k_perp * rho_L\n        (1.602176634e-19, 3.344e-27, 5, 1e5, 5000, 0, 0.0, 0.0),\n        # Case 4: Deuteron, zero v_perp (zero rho_L)\n        (1.602176634e-19, 3.344e-27, 5, 0, 1000, 1000, 0.05, 0.05),\n        # Case 5: Singly ionized Helium-4 ion, moderate rho_L, small k_perp\n        (1.602176634e-19, 6.64e-27, 1, 5e5, 10, 10, -0.03, 0.04),\n    ]\n\n    results = []\n    \n    # Number of points for numerical quadrature\n    M = 4096\n\n    for case in test_cases:\n        q_charge, m_mass, B_field, v_perp, kx, ky, Rx, Ry = case\n\n        # Calculate cyclotron frequency and Larmor radius\n        # Use abs(q) as per definition Omega = |q|B/m\n        # The formula rho_L = v_perp * m / (|q|*B) avoids division by zero if B=0,\n        # but B is always positive in test cases.\n        q_abs = abs(q_charge)\n        if q_abs == 0.0 or B_field == 0.0 or m_mass == 0.0:\n            # Handle cases that would lead to division by zero, though not in test suite.\n            # A particle with no charge or in no B field has infinite Larmor radius.\n            # If v_perp is zero, rho_L is zero anyway.\n            if v_perp == 0.0:\n                 rho_L = 0.0\n            else:\n                 # This case is physically ill-defined for this problem structure.\n                 # Let's assume it doesn't occur.\n                 rho_L = float('inf')\n        else:\n            Omega = q_abs * B_field / m_mass\n            rho_L = v_perp / Omega\n        \n        # Calculate wavevector magnitude and dot product with guiding center position\n        k_perp = np.sqrt(kx**2 + ky**2)\n        k_dot_R = kx * Rx + ky * Ry\n\n        # 1. Numerical gyrophase average\n        theta = np.linspace(0, 2 * np.pi, M, endpoint=False)\n        particle_x = Rx + rho_L * np.cos(theta)\n        particle_y = Ry + rho_L * np.sin(theta)\n        \n        field_values = np.cos(kx * particle_x + ky * particle_y)\n        f_numeric = np.mean(field_values)\n\n        # 2. Exact analytical gyrophase average\n        # <f>_exact = J0(k_perp * rho_L) * cos(k_perp . R)\n        f_exact = j0(k_perp * rho_L) * np.cos(k_dot_R)\n        \n        # 3. Second-order small-FLR approximation\n        # <f>_FLR2 = (1 - (k_perp*rho_L)^2 / 4) * cos(k_perp . R)\n        flr_factor = 1.0 - 0.25 * (k_perp * rho_L)**2\n        f_flr2 = flr_factor * np.cos(k_dot_R)\n\n        # Calculate absolute errors\n        error_exact = np.abs(f_numeric - f_exact)\n        error_flr2 = np.abs(f_numeric - f_flr2)\n\n        results.extend([error_exact, error_flr2])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With an understanding of the Larmor radius and gyroaveraging, we can now investigate their physical consequences. This practice problem demonstrates how FLR corrections modify a key transport mechanism in the edge region of fusion plasmas: the propagation of coherent density structures known as \"blobs\" . You will use a simplified gyrofluid model to estimate how FLR effects alter the blob's velocity, providing a tangible link between the mathematical formalism and observable plasma behavior.",
            "id": "4200222",
            "problem": "Consider a two-dimensional slab model of the edge region of a magnetized fusion plasma, with Cartesian coordinates $(x,y)$ across and along the curvature drift direction, respectively, and a uniform magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$. A coherent filament (\"blob\") of characteristic perpendicular wavenumber $k_{\\perp}$ and density perturbation amplitude $\\delta n$ moves radially due to the Electric cross Magnetic ($E\\times B$) drift generated by an electrostatic potential $\\phi(x,y,t)$. Assume isothermal electrons and ions with equal temperatures, $T_e = T_i$, and define the ion sound Larmor radius $\\rho_s = c_s/\\Omega_i$, where $c_s = \\sqrt{T_e/m_i}$ and $\\Omega_i = eB/m_i$. The electron response is adiabatic along the magnetic field, so that the normalized electron density perturbation satisfies $\\tilde{n}_e \\equiv \\delta n_e/n_0 \\approx \\tilde{\\phi} \\equiv e \\phi/T_e$. \n\nTo describe finite ion Larmor radius effects at perpendicular scale $k_{\\perp}$, use a standard gyrofluid quasi-neutrality closure in Fourier space with the zeroth-order gyroaveraging operator $\\Gamma_0(b)$, where $b \\equiv k_{\\perp}^{2}\\rho_s^{2}$. For a single-$k_{\\perp}$ perturbation, the quasi-neutrality condition yields\n$$\n\\tilde{n}_e - \\tilde{n}_i = \\left(1 - \\Gamma_0(b)\\right)\\tilde{\\phi} \\, ,\n$$\nwhich implies $\\tilde{n}_i = \\Gamma_0(b)\\tilde{\\phi}$ when $\\tilde{n}_e = \\tilde{\\phi}$ holds.\n\nIn the drift-ordering limit $k_{\\perp}\\rho_s \\ll 1$, a baseline inertial blob speed scaling $V_0$ follows from $E\\times B$ advection by $\\phi_0$ determined under $\\Gamma_0(b) \\to 1$. Now test the sensitivity of this blob speed scaling to the breakdown of drift ordering by estimating the correction when $k_{\\perp}\\rho_s \\sim 0.5$. Specifically:\n\n- Starting from the above quasi-neutrality and the $E\\times B$ drift velocity magnitude $V \\sim (c/B) k_{\\perp}\\phi$, derive the multiplicative correction factor $F(b)$ such that $V = F(b) V_0$, expressed in terms of $b$.\n- To make $F(b)$ explicit, use the widely employed Padé approximation for the gyroaveraging operator, $\\Gamma_0(b) \\approx \\frac{1}{1+b}$.\n- Evaluate $F(b)$ at $b = (0.5)^2$.\n\nIn addition, identify (qualitatively, without calculation) which terms that are neglected under drift ordering become non-negligible as $k_{\\perp}\\rho_s$ approaches $0.5$ in the drift-reduced Braginskii fluid equations, focusing on the vorticity (polarization) and continuity dynamics.\n\nGive the multiplicative correction factor $F(b)$ evaluated at $b = (0.5)^2$ as a single dimensionless number. No rounding is required; provide the exact value. Do not include any units in your final numerical answer.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of plasma physics, specifically the theory of drift-wave turbulence and transport in magnetized plasmas. It is well-posed, objective, and internally consistent, providing all necessary relations and approximations to derive a unique solution. The model and parameters, including the gyrofluid closure and Padé approximation, are standard in the field of fusion plasma simulation.\n\nThe primary objective is to find a multiplicative correction factor, $F(b)$, for the blob velocity scaling, accounting for finite Larmor radius (FLR) effects beyond the strict drift-ordering limit. The blob velocity, $V$, is driven by the $\\mathbf{E} \\times \\mathbf{B}$ drift, with a magnitude scaling as $V \\sim (c/B) k_{\\perp}\\phi$. The potential $\\phi$ is determined by the plasma dynamics, specifically the balance between charge-separating source terms and the inertial response of the plasma, which is described by the vorticity equation.\n\nThe vorticity equation is fundamentally derived from the quasi-neutrality condition, or more precisely, the charge conservation law $\\nabla \\cdot \\mathbf{J} = 0$. The polarization current, $\\mathbf{J}_{pol}$, represents the inertial response of the ions to a time-varying electric field. Its divergence is given by the rate of change of the charge density associated with the polarization of the medium. From charge conservation, this is related to the ion density evolution: $\\nabla \\cdot \\mathbf{J}_{pol} = -e \\frac{\\partial(\\delta n_i)}{\\partial t}$.\n\nUsing normalized quantities and the given gyrofluid relation for the ion density perturbation, $\\tilde{n}_i = \\Gamma_0(b)\\tilde{\\phi}$, we can write the ion density perturbation as $\\delta n_i = n_0 \\tilde{n}_i = n_0 \\Gamma_0(b) \\tilde{\\phi}$. Here, $b = k_{\\perp}^2 \\rho_s^2$ is the normalized squared perpendicular wavenumber. The divergence of the polarization current is then:\n$$\n\\nabla \\cdot \\mathbf{J}_{pol} = -e n_0 \\frac{\\partial}{\\partial t} \\left( \\Gamma_0(b) \\tilde{\\phi} \\right)\n$$\nAssuming a wave-like perturbation with time dependence $\\partial/\\partial t \\rightarrow -i\\omega$, and associating the blob's radial propagation with this frequency via $\\omega \\sim k_x V$, we get a scaling for the polarization response. However, a more direct scaling argument is sufficient. The vorticity (or polarization) part of the dynamic equation that determines $\\phi$ is proportional to the ion density response to the potential. The problem states that the ion density response is $\\tilde{n}_i = \\Gamma_0(b)\\tilde{\\phi}$. The actual charge separation that drives the polarization current is given by $\\tilde{n}_i - \\tilde{n}_e = (\\Gamma_0(b)-1)\\tilde{\\phi}$. The dynamics balance a source term (e.g., from curvature drifts, assumed constant for this scaling) against this polarization response. In a steady propagation picture, this balance yields a scaling for the velocity $V$:\n$$\nV \\propto \\frac{\\text{Source Term}}{\\text{Inertial Response}} \\propto \\frac{1}{|\\Gamma_0(b) - 1|}\n$$\nThe problem defines a baseline speed $V_0$ in the drift-ordering limit, $k_{\\perp}\\rho_s \\ll 1$, which corresponds to $b \\ll 1$. In this limit, the gyroaveraging operator $\\Gamma_0(b)$ can be expanded. A standard expansion for $\\Gamma_0(b)$ is $\\Gamma_0(b) \\approx 1 - b + \\mathcal{O}(b^2)$. Therefore, in the small-$b$ limit, the denominator becomes $|\\Gamma_0(b) - 1| \\approx |(1-b)-1| = b$.\nThe baseline velocity scaling is thus:\n$$\nV_0 \\propto \\frac{1}{b}\n$$\nThe velocity scaling including FLR effects is:\n$$\nV \\propto \\frac{1}{1 - \\Gamma_0(b)}\n$$\nNote that since $\\Gamma_0(b) \\le 1$, we can write $1 - \\Gamma_0(b)$ without the absolute value. The multiplicative correction factor $F(b) = V/V_0$ is the ratio of these scalings:\n$$\nF(b) = \\frac{V}{V_0} = \\frac{1/(1-\\Gamma_0(b))}{1/b} = \\frac{b}{1-\\Gamma_0(b)}\n$$\nThe problem specifies using the Padé approximation for the gyroaveraging operator:\n$$\n\\Gamma_0(b) \\approx \\frac{1}{1+b}\n$$\nSubstituting this approximation into the expression for $F(b)$:\n$$\nF(b) = \\frac{b}{1 - \\frac{1}{1+b}} = \\frac{b}{\\frac{(1+b) - 1}{1+b}} = \\frac{b}{\\frac{b}{1+b}} = 1+b\n$$\nSo the correction factor is simply $F(b) = 1+b$. We are asked to evaluate this factor at $k_{\\perp}\\rho_s = 0.5$. First, we calculate the corresponding value of $b$:\n$$\nb = (k_{\\perp}\\rho_s)^2 = (0.5)^2 = 0.25\n$$\nNow we evaluate $F(b)$ at this value:\n$$\nF(0.25) = 1 + 0.25 = 1.25\n$$\nThis indicates that for $k_{\\perp}\\rho_s = 0.5$, the blob speed is $25\\%$ larger than the prediction from the simple drift-ordered model. This enhancement is a consequence of FLR effects reducing the effective inertia of the ions.\n\nFor the second part of the question, we identify terms neglected under drift ordering ($k_{\\perp}\\rho_s \\ll 1$) that become non-negligible as $k_{\\perp}\\rho_s$ approaches $0.5$ in the drift-reduced Braginskii fluid equations.\n\nIn **vorticity/polarization dynamics**, the primary neglected terms are higher-order Finite Larmor Radius (FLR) corrections. The standard drift-fluid polarization term, proportional to $\\frac{d}{dt}\\nabla_{\\perp}^2\\phi$, is an approximation of the full ion polarization response valid only for long wavelengths. As $k_{\\perp}\\rho_s$ increases, this approximation fails. The gyrofluid model used in the first part of this problem replaces this term with a more accurate form based on $\\Gamma_0(b)$, but a full fluid model would need to include higher-order derivative terms. Furthermore, the **ion gyro-viscous stress tensor**, which is responsible for momentum transport, contains FLR terms of higher order in $(k_{\\perp}\\rho_s)^2$ that are typically omitted. These terms act as a form of hyper-viscosity, damping small-scale structures, and are crucial for correctly describing the dynamics at the scales where $k_{\\perp}\\rho_s \\sim 0.5$.\n\nIn **continuity dynamics**, the primary advection of density is by the $\\mathbf{E}\\times\\mathbf{B}$ drift, $\\mathbf{v}_E$. In drift-ordering, it is assumed that ions and electrons are advected by the same fluid velocity $\\mathbf{v}_E$. However, ions have finite Larmor radii and thus experience a gyro-averaged electric field. The true ion advecting velocity is the gyro-averaged $\\mathbf{E}\\times\\mathbf{B}$ velocity, $\\langle \\mathbf{v}_E \\rangle_{gyro}$, not the local value $\\mathbf{v}_E$. The difference, $\\langle \\mathbf{v}_E \\rangle_{gyro} - \\mathbf{v}_E$, constitutes an FLR correction to the advection term in the continuity equation (e.g., in $\\nabla \\cdot (n_i \\mathbf{v}_i)$) that becomes significant as $k_{\\perp}\\rho_s \\to 0.5$. Similarly, the ion diamagnetic drift also acquires FLR corrections that are neglected in the basic drift-ordered model.",
            "answer": "$$\\boxed{1.25}$$"
        }
    ]
}