{
    "hands_on_practices": [
        {
            "introduction": "The first step in analyzing turbulence suppression is to compute the $E \\times B$ shearing rate, $\\gamma_E$, from the plasma's underlying profiles. This foundational exercise guides you through this \"forward problem\" by providing analytical profiles for density, temperature, and rotation within a tokamak pedestal. By applying the ion radial force balance to find the radial electric field and then calculating its shear, you will determine if the conditions for turbulence suppression are met in this critical region where transport barriers form .",
            "id": "3969600",
            "problem": "A large-aspect-ratio, axisymmetric tokamak has dominant toroidal magnetic field and a pedestal extending from minor radius $r_{\\mathrm{ped,min}} = 0.45~\\mathrm{m}$ to $r_{\\mathrm{ped,max}} = 0.50~\\mathrm{m}$. Assume that the electric field cross magnetic field ($E \\times B$) flow is dominantly poloidal due to the radial electric field. The poloidal $E \\times B$ flow speed is $v_{\\theta}(r) \\approx E_r(r)/B_{\\phi}$, where $B_{\\phi}$ is the toroidal magnetic field. Define the $E \\times B$ shear rate as the magnitude\n$$\\gamma_E(r) \\equiv \\left| r \\frac{d}{dr}\\left(\\frac{v_{\\theta}(r)}{r}\\right) \\right|.$$\nAssume the radial electric field $E_r(r)$ is given by the steady-state ion radial force balance neglecting poloidal rotation and viscosity,\n$$E_r(r) = \\frac{1}{n_i(r) e} \\frac{d p_i(r)}{dr} + V_{\\phi}(r) B_{\\theta}(r),$$\nwith ion pressure $p_i(r) = n_i(r) k_B T_i(r)$. For convenience, the ion temperature is specified in electron-volts, so that $p_i(r) = n_i(r) e T_i(r)$ and \n$$\\frac{1}{n_i e}\\frac{d p_i}{dr} = \\frac{d T_i}{dr} + \\frac{T_i}{n_i}\\frac{dn_i}{dr},$$\nnumerically in $\\mathrm{V/m}$ when $T_i$ is expressed in $\\mathrm{eV}$. The poloidal field is related to the safety factor $q(r)$ by $B_{\\theta}(r) = r B_{\\phi}/(q(r) R)$, where $R$ is the major radius.\n\nSuppression of turbulent transport is expected when the $E \\times B$ shear decorrelation rate exceeds a representative local linear growth rate. Model the threshold as\n$\\gamma_{\\mathrm{thr}}(r) = k_y \\frac{c_s(r)}{L_{T_i}(r)}$,\nwhere $k_y$ is a fixed binormal wavenumber, $c_s(r) = \\sqrt{\\frac{e T_e(r)}{m_i}}$ is the ion sound speed with $T_e(r) = T_i(r)$ the electron temperature, $m_i$ the ion mass, and $L_{T_i}(r) = \\frac{T_i(r)}{|dT_i/dr|}$ is the ion temperature scale length.\n\nUse the following pedestal profiles and constants:\n- Minor radius coordinate $r \\in [0.45, 0.50]~\\mathrm{m}$.\n- Toroidal magnetic field $B_{\\phi} = 2.5~\\mathrm{T}$, major radius $R = 1.7~\\mathrm{m}$.\n- Ion mass $m_i = 3.344 \\times 10^{-27}~\\mathrm{kg}$ (deuterium), elementary charge $e = 1.602 \\times 10^{-19}~\\mathrm{C}$.\n- Safety factor $q(r) = q_0 + \\alpha_q (r - r_0)$ with $q_0 = 3.8$, $\\alpha_q = 4.0~\\mathrm{m}^{-1}$, and $r_0 = 0.45~\\mathrm{m}$.\n- Ion density $n_i(r) = n_0 - \\alpha_n (r - r_0)$ with $n_0 = 6.0 \\times 10^{19}~\\mathrm{m}^{-3}$, $\\alpha_n = 2.0 \\times 10^{20}~\\mathrm{m}^{-4}$.\n- Ion temperature $T_i(r) = T_0 - \\alpha_T (r - r_0)$ with $T_0 = 1500~\\mathrm{eV}$, $\\alpha_T = 14000~\\mathrm{eV/m}$.\n- Toroidal rotation $V_{\\phi}(r) = V_0 - \\alpha_V (r - r_0)$ with $V_0 = 1.20 \\times 10^{5}~\\mathrm{m/s}$, $\\alpha_V = 1.00 \\times 10^{6}~\\mathrm{s}^{-1}$.\n- Binormal wavenumber $k_y = 0.05~\\mathrm{m}^{-1}$.\n\nTask:\n1. Starting from the definitions above, derive an explicit expression for $\\gamma_E(r)$ in terms of the given profiles, and construct $\\gamma_{\\mathrm{thr}}(r)$ from the model.\n2. Compute the dimensionless suppression ratio $S(r) \\equiv \\gamma_E(r)/\\gamma_{\\mathrm{thr}}(r)$ across the pedestal and determine its maximum value over $r \\in [0.45, 0.50]~\\mathrm{m}$.\n\nExpress the final answer as the single maximum value $\\max_{r \\in [0.45,0.50]} S(r)$, rounded to four significant figures. Since this is a ratio, it is dimensionless and should be reported with no units.",
            "solution": "The user has provided a problem from the field of computational fusion science to be validated and solved.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **Domain:** Axisymmetric tokamak pedestal from $r_{\\mathrm{ped,min}} = 0.45~\\mathrm{m}$ to $r_{\\mathrm{ped,max}} = 0.50~\\mathrm{m}$.\n-   **E×B Flow Speed:** $v_{\\theta}(r) \\approx E_r(r)/B_{\\phi}$.\n-   **E×B Shear Rate:** $\\gamma_E(r) \\equiv \\left| r \\frac{d}{dr}\\left(\\frac{v_{\\theta}(r)}{r}\\right) \\right|$.\n-   **Radial Electric Field:** $E_r(r) = \\frac{1}{n_i(r) e} \\frac{d p_i(r)}{dr} + V_{\\phi}(r) B_{\\theta}(r)$.\n-   **Ion Pressure Term:** $\\frac{1}{n_i e}\\frac{d p_i}{dr} = \\frac{d T_i}{dr} + \\frac{T_i}{n_i}\\frac{dn_i}{dr}$, where $T_i$ is in electron-volts ($\\mathrm{eV}$) and the result is in $\\mathrm{V/m}$.\n-   **Poloidal Magnetic Field:** $B_{\\theta}(r) = r B_{\\phi}/(q(r) R)$.\n-   **Turbulence Threshold:** $\\gamma_{\\mathrm{thr}}(r) = k_y \\frac{c_s(r)}{L_{T_i}(r)}$.\n-   **Ion Sound Speed:** $c_s(r) = \\sqrt{\\frac{e T_e(r)}{m_i}}$ with $T_e(r) = T_i(r)$. So, $c_s(r) = \\sqrt{e T_i(r) / m_i}$, where $T_i$ is expressed in $\\mathrm{eV}$ and $e$ is the elementary charge in Coulombs.\n-   **Ion Temperature Scale Length:** $L_{T_i}(r) = \\frac{T_i(r)}{|dT_i/dr|}$.\n-   **Constants:**\n    -   $B_{\\phi} = 2.5~\\mathrm{T}$\n    -   $R = 1.7~\\mathrm{m}$\n    -   $m_i = 3.344 \\times 10^{-27}~\\mathrm{kg}$\n    -   $e = 1.602 \\times 10^{-19}~\\mathrm{C}$\n    -   $k_y = 0.05~\\mathrm{m}^{-1}$\n-   **Profiles ($r_0 = 0.45~\\mathrm{m}$):**\n    -   $q(r) = q_0 + \\alpha_q (r - r_0)$ with $q_0 = 3.8$, $\\alpha_q = 4.0~\\mathrm{m}^{-1}$.\n    -   $n_i(r) = n_0 - \\alpha_n (r - r_0)$ with $n_0 = 6.0 \\times 10^{19}~\\mathrm{m}^{-3}$, $\\alpha_n = 2.0 \\times 10^{20}~\\mathrm{m}^{-4}$.\n    -   $T_i(r) = T_0 - \\alpha_T (r - r_0)$ with $T_0 = 1500~\\mathrm{eV}$, $\\alpha_T = 14000~\\mathrm{eV/m}$.\n    -   $V_{\\phi}(r) = V_0 - \\alpha_V (r - r_0)$ with $V_0 = 1.20 \\times 10^{5}~\\mathrm{m/s}$, $\\alpha_V = 1.00 \\times 10^{6}~\\mathrm{s}^{-1}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in standard plasma transport theory for tokamaks. The provided equations—radial force balance for $E_r$, the definition of E×B shear rate, and the ion temperature gradient (ITG) turbulence growth rate proxy for the threshold—are standard models. The specified profiles are linear, a common simplification for pedestal modeling. The parameter values are physically realistic for a medium-sized tokamak. The problem is well-posed, providing all necessary information and asking for a specific, calculable quantity (the maximum of a ratio over an interval). There are no internal contradictions; the units and variable definitions (e.g., $T_i$ in $\\mathrm{eV}$) are explicitly handled. The problem is objective, non-trivial, and verifiable.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A full solution will be provided.\n\n### Solution\n\nThe task is to derive expressions for the E×B shear rate $\\gamma_E(r)$ and the turbulence threshold rate $\\gamma_{\\mathrm{thr}}(r)$, and then to compute the maximum value of their ratio, $S(r) = \\gamma_E(r)/\\gamma_{\\mathrm{thr}}(r)$, over the radial domain $r \\in [0.45, 0.50]~\\mathrm{m}$.\n\n**1. Derivation of the Threshold Rate $\\gamma_{\\mathrm{thr}}(r)$**\n\nThe threshold rate is given by $\\gamma_{\\mathrm{thr}}(r) = k_y \\frac{c_s(r)}{L_{T_i}(r)}$.\nThe ion temperature profile is $T_i(r) = T_0 - \\alpha_T(r-r_0)$, so its derivative is $\\frac{dT_i}{dr} = -\\alpha_T$.\nThe temperature scale length is $L_{T_i}(r) = \\frac{T_i(r)}{|dT_i/dr|} = \\frac{T_i(r)}{\\alpha_T}$.\nThe ion sound speed is $c_s(r) = \\sqrt{e T_i(r)/m_i}$, where the numerical value of $T_i(r)$ in $\\mathrm{eV}$ is used along with the elementary charge $e$ in Coulombs to give the energy in Joules.\nSubstituting these into the expression for $\\gamma_{\\mathrm{thr}}(r)$:\n$$ \\gamma_{\\mathrm{thr}}(r) = k_y \\frac{\\sqrt{e T_i(r)/m_i}}{T_i(r)/\\alpha_T} = \\frac{k_y \\alpha_T}{\\sqrt{T_i(r)}} \\sqrt{\\frac{e}{m_i}} $$\nSince $T_i(r)$ is a decreasing function of $r$, $\\gamma_{\\mathrm{thr}}(r)$ is a monotonically increasing function of $r$.\n\n**2. Derivation of the E×B Shear Rate $\\gamma_E(r)$**\n\nThe E×B shear rate is defined as $\\gamma_E(r) = \\left| r \\frac{d}{dr}\\left(\\frac{v_{\\theta}(r)}{r}\\right) \\right|$.\nUsing $v_{\\theta}(r) \\approx E_r(r)/B_{\\phi}$ and assuming $B_{\\phi}$ is constant:\n$$ \\gamma_E(r) = \\left| r \\frac{d}{dr}\\left(\\frac{E_r(r)}{r B_{\\phi}}\\right) \\right| = \\left| \\frac{r}{B_{\\phi}} \\left( \\frac{1}{r}\\frac{dE_r}{dr} - \\frac{E_r}{r^2} \\right) \\right| = \\left| \\frac{1}{B_{\\phi}} \\left( \\frac{dE_r}{dr} - \\frac{E_r(r)}{r} \\right) \\right| $$\nTo evaluate this, we need expressions for $E_r(r)$ and its derivative $\\frac{dE_r}{dr}$.\n\nThe radial electric field $E_r(r)$ is composed of a diamagnetic term and a flow term:\n$$ E_r(r) = \\underbrace{\\left(\\frac{d T_i}{dr} + \\frac{T_i(r)}{n_i(r)}\\frac{dn_i}{dr}\\right)}_{E_{r,\\mathrm{dia}}(r)} + \\underbrace{V_{\\phi}(r) B_{\\theta}(r)}_{E_{r,V \\times B}(r)} $$\nThe profile derivatives are constants: $\\frac{dn_i}{dr} = -\\alpha_n$, $\\frac{dT_i}{dr} = -\\alpha_T$, $\\frac{dV_{\\phi}}{dr} = -\\alpha_V$, and $\\frac{dq}{dr} = \\alpha_q$.\nSo, the components of $E_r(r)$ are:\n$$ E_{r,\\mathrm{dia}}(r) = -\\alpha_T - \\alpha_n \\frac{T_i(r)}{n_i(r)} $$\n$$ E_{r,V \\times B}(r) = V_{\\phi}(r) \\frac{r B_{\\phi}}{R q(r)} $$\nNext, we find the derivatives of these components:\n$$ \\frac{dE_{r,\\mathrm{dia}}}{dr} = -\\alpha_n \\frac{d}{dr}\\left(\\frac{T_i}{n_i}\\right) = -\\alpha_n \\frac{\\frac{dT_i}{dr}n_i(r) - T_i(r)\\frac{dn_i}{dr}}{n_i(r)^2} = -\\alpha_n \\frac{-\\alpha_T n_i(r) + \\alpha_n T_i(r)}{n_i(r)^2} $$\n$$ \\frac{dE_{r,V \\times B}}{dr} = \\frac{B_{\\phi}}{R} \\frac{d}{dr}\\left(\\frac{r V_\\phi(r)}{q(r)}\\right) = \\frac{B_{\\phi}}{R} \\left( \\frac{\\left(V_\\phi(r) + r \\frac{dV_{\\phi}}{dr}\\right)q(r) - rV_\\phi(r)\\frac{dq}{dr}}{q(r)^2} \\right) = \\frac{B_{\\phi}}{R} \\left( \\frac{(V_\\phi(r) - \\alpha_V r)q(r) - \\alpha_q r V_\\phi(r)}{q(r)^2} \\right) $$\nThe total derivative is $\\frac{dE_r}{dr} = \\frac{dE_{r,\\mathrm{dia}}}{dr} + \\frac{dE_{r,V \\times B}}{dr}$.\n\n**3. Maximization of the Suppression Ratio $S(r)$**\n\nThe suppression ratio is $S(r) = \\gamma_E(r)/\\gamma_{\\mathrm{thr}}(r)$. The full analytical expression for $S(r)$ is complex. We analyze its behavior to find the maximum. We have already established that the denominator, $\\gamma_{\\mathrm{thr}}(r)$, is a strictly increasing function of $r$.\nBy evaluating $\\gamma_E(r)$ at the boundaries and midpoint of the interval, we observe that it is a decreasing function of $r$.\n- At $r=0.45~\\mathrm{m}$, $\\gamma_E \\approx 4.96 \\times 10^4~\\mathrm{s}^{-1}$.\n- At $r=0.475~\\mathrm{m}$, $\\gamma_E \\approx 4.90 \\times 10^4~\\mathrm{s}^{-1}$.\n- At $r=0.50~\\mathrm{m}$, $\\gamma_E \\approx 4.77 \\times 10^4~\\mathrm{s}^{-1}$.\nSince $S(r)$ is a ratio of a monotonically decreasing function ($\\gamma_E(r)$) to a monotonically increasing function ($\\gamma_{\\mathrm{thr}}(r)$), $S(r)$ must be a monotonically decreasing function over the interval. Therefore, its maximum value occurs at the minimum value of $r$, which is $r = r_{\\mathrm{ped,min}} = 0.45~\\mathrm{m}$.\n\n**4. Calculation of $S(0.45)$**\n\nWe evaluate all quantities at $r = 0.45~\\mathrm{m}$. At this point, $r - r_0 = 0$, so the profiles take their initial values:\n- $n_i(0.45) = n_0 = 6.0 \\times 10^{19}~\\mathrm{m}^{-3}$\n- $T_i(0.45) = T_0 = 1500~\\mathrm{eV}$\n- $V_{\\phi}(0.45) = V_0 = 1.20 \\times 10^{5}~\\mathrm{m/s}$\n- $q(0.45) = q_0 = 3.8$\n\nFirst, calculate $\\gamma_{\\mathrm{thr}}(0.45)$:\n$$ \\gamma_{\\mathrm{thr}}(0.45) = \\frac{k_y \\alpha_T}{\\sqrt{T_0}} \\sqrt{\\frac{e}{m_i}} = \\frac{(0.05) (14000)}{\\sqrt{1500}} \\sqrt{\\frac{1.602 \\times 10^{-19}}{3.344 \\times 10^{-27}}} $$\n$$ \\gamma_{\\mathrm{thr}}(0.45) = \\frac{700}{38.7298} \\sqrt{4.7907 \\times 10^7} \\approx (18.073)(6921.5) \\approx 125090~\\mathrm{s}^{-1} $$\nNext, calculate $E_r(0.45)$ and $\\frac{dE_r}{dr}(0.45)$:\n$$ E_r(0.45) = \\left(-\\alpha_T - \\alpha_n \\frac{T_0}{n_0}\\right) + V_0 \\frac{(0.45) B_{\\phi}}{R q_0} $$\n$$ E_r(0.45) = \\left(-14000 - (2.0 \\times 10^{20}) \\frac{1500}{6.0 \\times 10^{19}}\\right) + (1.20 \\times 10^5) \\frac{(0.45)(2.5)}{(1.7)(3.8)} $$\n$$ E_r(0.45) = (-14000 - 5000) + (1.20 \\times 10^5)(0.17415) \\approx -19000 + 20898 = 1898~\\mathrm{V/m} $$\nNow the derivative:\n$$ \\frac{dE_r}{dr}(0.45) = -\\alpha_n \\frac{-\\alpha_T n_0 + \\alpha_n T_0}{n_0^2} + \\frac{B_{\\phi}}{R} \\left( \\frac{(V_0 - \\alpha_V(0.45))q_0 - \\alpha_q (0.45) V_0}{q_0^2} \\right) $$\n$$ \\frac{dE_{r,\\mathrm{dia}}}{dr}(0.45) = -2.0 \\times 10^{20} \\frac{-(14000)(6.0 \\times 10^{19}) + (2.0 \\times 10^{20})(1500)}{(6.0 \\times 10^{19})^2} = -2.0 \\times 10^{20} \\frac{-8.4 \\times 10^{23} + 3.0 \\times 10^{23}}{36 \\times 10^{38}} = 30000~\\mathrm{V/m^2} $$\n$$ V_0 - \\alpha_V(0.45) = 1.20 \\times 10^5 - (1.00 \\times 10^6)(0.45) = -3.3 \\times 10^5~\\mathrm{m/s} $$\n$$ \\frac{dE_{r,V \\times B}}{dr}(0.45) = \\frac{2.5}{1.7} \\left( \\frac{(-3.3 \\times 10^5)(3.8) - (4.0)(0.45)(1.20 \\times 10^5)}{3.8^2} \\right) $$\n$$ \\frac{dE_{r,V \\times B}}{dr}(0.45) = 1.4706 \\left( \\frac{-1.254 \\times 10^6 - 2.16 \\times 10^5}{14.44} \\right) = 1.4706 (-101800) \\approx -149707~\\mathrm{V/m^2} $$\nTotal derivative:\n$$ \\frac{dE_r}{dr}(0.45) \\approx 30000 - 149707 = -119707~\\mathrm{V/m^2} $$\nNow assemble $\\gamma_E(0.45)$:\n$$ \\gamma_E(0.45) = \\left| \\frac{1}{2.5} \\left( -119707 - \\frac{1898}{0.45} \\right) \\right| = \\left| 0.4 \\left( -119707 - 4218 \\right) \\right| = |0.4(-123925)| \\approx 49570~\\mathrm{s}^{-1} $$\nFinally, compute the ratio $S(0.45)$:\n$$ S(0.45) = \\frac{\\gamma_E(0.45)}{\\gamma_{\\mathrm{thr}}(0.45)} \\approx \\frac{49570}{125090} \\approx 0.39628 $$\nRounding to four significant figures, the maximum value of the suppression ratio is $0.3963$.",
            "answer": "$$\\boxed{0.3963}$$"
        },
        {
            "introduction": "In a real experiment, the profiles used to calculate $\\gamma_E$ are not known perfectly but are derived from measurements with inherent uncertainties. This practice addresses the crucial question of how reliable our estimate of the shearing rate is. You will learn to apply standard error propagation techniques to quantify how uncertainties in measured quantities, like the ion pressure gradient and flow velocity, translate into uncertainty in the final calculated value of $\\gamma_E$ .",
            "id": "3969584",
            "problem": "Consider a magnetically confined axisymmetric plasma in a tokamak, modeled locally in a narrow radial interval around a flux surface at radius $r_0$. The $E \\times B$ shearing rate $ \\gamma_E(r) $ is defined as the radial derivative of the poloidal component of the $E \\times B$ flow, and in a slab-like local approximation where the radial electric field $E_r(r)$ drives the poloidal $E \\times B$ velocity $v_{E\\theta}(r) = E_r(r)/B_\\phi(r)$, one has $ \\gamma_E(r) \\equiv \\frac{d}{dr}\\left(\\frac{E_r(r)}{B_\\phi(r)}\\right) $. The ion radial force balance in steady state relates $E_r(r)$ to measured profiles according to\n$$\nE_r(r) = \\frac{1}{e\\,n_i(r)}\\frac{dp_i}{dr}(r) + V_\\phi(r)\\,B_\\theta(r) - V_\\theta(r)\\,B_\\phi(r),\n$$\nwhere $e$ is the elementary charge, $n_i(r)$ is the ion density, $p_i(r)$ is the ion pressure, $V_\\phi(r)$ and $V_\\theta(r)$ are the toroidal and poloidal flows, and $B_\\phi(r)$ and $B_\\theta(r)$ are the toroidal and poloidal magnetic field components. In many regimes, the ion poloidal flow term $V_\\theta(r)\\,B_\\phi(r)$ is negligible relative to the other terms in the narrow interval considered. Assume this is the case.\n\nYou are given that $n_i(r)$, $B_\\phi(r)$, and $B_\\theta(r)$ vary slowly across the interval and can be treated as radially constant and known over $[r_0-\\Delta, r_0+\\Delta]$. The quantities $\\frac{dp_i}{dr}(r)$ and $V_\\phi(r)$ are measured at the two radii $r_0-\\Delta$ and $r_0+\\Delta$ with independent, zero-mean, Gaussian uncertainties having standard deviations $\\sigma_{p'}$ (for $\\frac{dp_i}{dr}$) and $\\sigma_V$ (for $V_\\phi$) at each radius. Using these measurements, define the standard central-difference estimators\n$$\n\\left.\\frac{d^2 p_i}{dr^2}\\right|_{r_0} \\approx \\frac{\\left.\\frac{dp_i}{dr}\\right|_{r_0+\\Delta} - \\left.\\frac{dp_i}{dr}\\right|_{r_0-\\Delta}}{2\\Delta},\n\\qquad\n\\left.\\frac{dV_\\phi}{dr}\\right|_{r_0} \\approx \\frac{V_\\phi(r_0+\\Delta)-V_\\phi(r_0-\\Delta)}{2\\Delta},\n$$\nand compute the corresponding estimator of the $E \\times B$ shearing rate at $r_0$,\n$$\n\\hat{\\gamma}_E(r_0) = \\left.\\frac{d}{dr}\\left(\\frac{E_r}{B_\\phi}\\right)\\right|_{r_0} \\approx \\frac{1}{B_\\phi}\\left[\\frac{1}{e\\,n_i}\\left.\\frac{d^2 p_i}{dr^2}\\right|_{r_0} + B_\\theta \\left.\\frac{dV_\\phi}{dr}\\right|_{r_0}\\right].\n$$\n\nUnder the assumptions above, treat $n_i$, $B_\\phi$, $B_\\theta$, and $\\Delta$ as exact constants and assume the four measurements $\\left.\\frac{dp_i}{dr}\\right|_{r_0\\pm\\Delta}$ and $V_\\phi(r_0\\pm\\Delta)$ are statistically independent. Propagate the measurement uncertainties to obtain the standard deviation $\\sigma_{\\gamma_E}$ of the estimator $\\hat{\\gamma}_E(r_0)$ due to the given uncertainties in $\\frac{dp_i}{dr}$ and $V_\\phi$. Express your final answer as a single closed-form analytic expression for $\\sigma_{\\gamma_E}$ in terms of $\\Delta$, $e$, $n_i$, $B_\\theta$, $B_\\phi$, $\\sigma_{p'}$, and $\\sigma_V$. State the units of your expression as s$^{-1}$. No numerical rounding is required.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and internally consistent. It is a valid problem of uncertainty propagation in the context of fusion plasma physics. Therefore, a solution will be derived.\n\nThe objective is to compute the standard deviation $\\sigma_{\\gamma_E}$ of the estimator $\\hat{\\gamma}_E(r_0)$ for the E×B shearing rate. The estimator is given by:\n$$\n\\hat{\\gamma}_E(r_0) = \\frac{1}{B_\\phi}\\left[\\frac{1}{e\\,n_i}\\left.\\frac{d^2 p_i}{dr^2}\\right|_{r_0} + B_\\theta \\left.\\frac{dV_\\phi}{dr}\\right|_{r_0}\\right]\n$$\nThe problem provides central-difference estimators for the second derivative of the ion pressure and the first derivative of the toroidal flow at the radius $r_0$:\n$$\n\\left.\\frac{d^2 p_i}{dr^2}\\right|_{r_0} \\approx \\frac{\\left.\\frac{dp_i}{dr}\\right|_{r_0+\\Delta} - \\left.\\frac{dp_i}{dr}\\right|_{r_0-\\Delta}}{2\\Delta}\n$$\n$$\n\\left.\\frac{dV_\\phi}{dr}\\right|_{r_0} \\approx \\frac{V_\\phi(r_0+\\Delta)-V_\\phi(r_0-\\Delta)}{2\\Delta}\n$$\nLet us denote the measured quantities as follows for clarity:\n-   $p'_+ \\equiv \\left.\\frac{dp_i}{dr}\\right|_{r_0+\\Delta}$\n-   $p'_- \\equiv \\left.\\frac{dp_i}{dr}\\right|_{r_0-\\Delta}$\n-   $V_+ \\equiv V_\\phi(r_0+\\Delta)$\n-   $V_- \\equiv V_\\phi(r_0-\\Delta)$\n\nSubstituting these into the expression for $\\hat{\\gamma}_E(r_0)$:\n$$\n\\hat{\\gamma}_E(r_0) = \\frac{1}{B_\\phi}\\left[ \\frac{1}{e\\,n_i} \\left( \\frac{p'_+ - p'_-}{2\\Delta} \\right) + B_\\theta \\left( \\frac{V_+ - V_-}{2\\Delta} \\right) \\right]\n$$\nWe can rearrange this expression to show $\\hat{\\gamma}_E(r_0)$ as a linear combination of the four measured quantities $p'_+$, $p'_-$, $V_+$, and $V_-$:\n$$\n\\hat{\\gamma}_E(r_0) = \\left( \\frac{1}{2 \\Delta B_\\phi e n_i} \\right) p'_+ - \\left( \\frac{1}{2 \\Delta B_\\phi e n_i} \\right) p'_- + \\left( \\frac{B_\\theta}{2 \\Delta B_\\phi} \\right) V_+ - \\left( \\frac{B_\\theta}{2 \\Delta B_\\phi} \\right) V_-\n$$\nThe problem states that these four measurements are statistically independent random variables. The standard deviation for a generic function $f(X_1, X_2, \\dots, X_N)$ of independent random variables $X_i$ is given by the error propagation formula:\n$$\n\\sigma_f^2 = \\sum_{i=1}^{N} \\left(\\frac{\\partial f}{\\partial X_i}\\right)^2 \\sigma_{X_i}^2\n$$\nIn our case, $\\hat{\\gamma}_E(r_0)$ is a linear function of the measurements. For a linear combination $f = \\sum_{i} a_i X_i$, the variance is $\\sigma_f^2 = \\sum_{i} a_i^2 \\sigma_{X_i}^2$. The partial derivatives are the constant coefficients of each variable.\n\nThe standard deviations of the measurements are given as:\n-   $\\sigma_{p'_+} = \\sigma_{p'_-} = \\sigma_{p'}$\n-   $\\sigma_{V_+} = \\sigma_{V_-} = \\sigma_V$\n\nThe constants $e$, $n_i$, $B_\\phi$, $B_\\theta$, and $\\Delta$ are treated as exact. The variance of $\\hat{\\gamma}_E(r_0)$, denoted as $\\sigma_{\\gamma_E}^2$, is therefore:\n$$\n\\sigma_{\\gamma_E}^2 = \\left( \\frac{\\partial \\hat{\\gamma}_E}{\\partial p'_+} \\right)^2 \\sigma_{p'}^2 + \\left( \\frac{\\partial \\hat{\\gamma}_E}{\\partial p'_-} \\right)^2 \\sigma_{p'}^2 + \\left( \\frac{\\partial \\hat{\\gamma}_E}{\\partial V_+} \\right)^2 \\sigma_V^2 + \\left( \\frac{\\partial \\hat{\\gamma}_E}{\\partial V_-} \\right)^2 \\sigma_V^2\n$$\nThe partial derivatives are the coefficients in the linear combination:\n-   $\\frac{\\partial \\hat{\\gamma}_E}{\\partial p'_+} = \\frac{1}{2 \\Delta B_\\phi e n_i}$\n-   $\\frac{\\partial \\hat{\\gamma}_E}{\\partial p'_-} = -\\frac{1}{2 \\Delta B_\\phi e n_i}$\n-   $\\frac{\\partial \\hat{\\gamma}_E}{\\partial V_+} = \\frac{B_\\theta}{2 \\Delta B_\\phi}$\n-   $\\frac{\\partial \\hat{\\gamma}_E}{\\partial V_-} = -\\frac{B_\\theta}{2 \\Delta B_\\phi}$\n\nSubstituting these into the variance formula:\n$$\n\\sigma_{\\gamma_E}^2 = \\left(\\frac{1}{2 \\Delta B_\\phi e n_i}\\right)^2 \\sigma_{p'}^2 + \\left(-\\frac{1}{2 \\Delta B_\\phi e n_i}\\right)^2 \\sigma_{p'}^2 + \\left(\\frac{B_\\theta}{2 \\Delta B_\\phi}\\right)^2 \\sigma_V^2 + \\left(-\\frac{B_\\theta}{2 \\Delta B_\\phi}\\right)^2 \\sigma_V^2\n$$\nSquaring the coefficients gives:\n$$\n\\sigma_{\\gamma_E}^2 = \\frac{1}{4 \\Delta^2 B_\\phi^2 e^2 n_i^2}\\sigma_{p'}^2 + \\frac{1}{4 \\Delta^2 B_\\phi^2 e^2 n_i^2}\\sigma_{p'}^2 + \\frac{B_\\theta^2}{4 \\Delta^2 B_\\phi^2}\\sigma_V^2 + \\frac{B_ \\theta^2}{4 \\Delta^2 B_\\phi^2}\\sigma_V^2\n$$\nCombining like terms:\n$$\n\\sigma_{\\gamma_E}^2 = 2 \\left( \\frac{\\sigma_{p'}^2}{4 \\Delta^2 B_\\phi^2 e^2 n_i^2} \\right) + 2 \\left( \\frac{B_\\theta^2 \\sigma_V^2}{4 \\Delta^2 B_\\phi^2} \\right)\n$$\n$$\n\\sigma_{\\gamma_E}^2 = \\frac{\\sigma_{p'}^2}{2 \\Delta^2 B_\\phi^2 e^2 n_i^2} + \\frac{B_\\theta^2 \\sigma_V^2}{2 \\Delta^2 B_\\phi^2}\n$$\nWe can factor out the common denominator:\n$$\n\\sigma_{\\gamma_E}^2 = \\frac{1}{2 \\Delta^2 B_\\phi^2} \\left( \\frac{\\sigma_{p'}^2}{e^2 n_i^2} + B_\\theta^2 \\sigma_V^2 \\right)\n$$\nThe desired quantity is the standard deviation $\\sigma_{\\gamma_E}$, which is the square root of the variance. Assuming $\\Delta > 0$ and $B_\\phi$ can be taken as positive (as is convention), we have:\n$$\n\\sigma_{\\gamma_E} = \\sqrt{\\frac{1}{2 \\Delta^2 B_\\phi^2} \\left( \\frac{\\sigma_{p'}^2}{e^2 n_i^2} + B_\\theta^2 \\sigma_V^2 \\right)}\n$$\n$$\n\\sigma_{\\gamma_E} = \\frac{1}{\\sqrt{2} \\Delta B_\\phi} \\sqrt{\\frac{\\sigma_{p'}^2}{e^2 n_i^2} + B_\\theta^2 \\sigma_V^2}\n$$\nThis expression can be rewritten to group terms as they appear in the radial electric field equation:\n$$\n\\sigma_{\\gamma_E} = \\frac{1}{\\sqrt{2} \\Delta B_\\phi} \\sqrt{\\left(\\frac{\\sigma_{p'}}{e n_i}\\right)^2 + (B_\\theta \\sigma_V)^2}\n$$\nThe problem states that the units of the final expression should be s$^{-1}$. We can verify this. In SI units: $\\Delta$ is in m; $B_\\phi$ and $B_\\theta$ are in T; $e$ is in C; $n_i$ is in m$^{-3}$; $\\sigma_V$ is in m s$^{-1}$; and $\\sigma_{p'}$ (for $\\frac{dp_i}{dr}$) is in Pa m$^{-1}$ or kg m$^{-2}$ s$^{-2}$.\nThe term $\\frac{\\sigma_{p'}}{e n_i}$ has units of $\\frac{\\text{kg m}^{-2} \\text{s}^{-2}}{\\text{C m}^{-3}} = \\frac{\\text{kg m s}^{-2}}{\\text{C}} = \\frac{\\text{N}}{\\text{C}}$, which are units of an electric field.\nThe term $B_\\theta \\sigma_V$ has units of T m s$^{-1}$, which from the Lorentz force law is also equivalent to N C$^{-1}$.\nThus, the term under the square root has units of (N C$^{-1})^2$. Its square root has units of N C$^{-1}$.\nThe pre-factor $\\frac{1}{\\Delta B_\\phi}$ has units of (m T)$^{-1}$. Since T = N C$^{-1}$ m$^{-1}$ s, the pre-factor has units of (m (N C$^{-1}$ m$^{-1}$ s))$^{-1}$ = (N C$^{-1}$ s)$^{-1}$.\nThe overall units are (N C$^{-1}$ s)$^{-1} \\cdot $(N C$^{-1}$) = s$^{-1}$, which is correct.\nThe final expression is a closed-form analytic expression for $\\sigma_{\\gamma_E}$ in terms of the specified parameters.",
            "answer": "$$\n\\boxed{\\frac{1}{\\sqrt{2} \\Delta B_\\phi} \\sqrt{\\left(\\frac{\\sigma_{p'}}{e n_i}\\right)^2 + \\left(B_\\theta \\sigma_V\\right)^2}}\n$$"
        },
        {
            "introduction": "Moving beyond direct calculation, this advanced practice introduces an \"inverse problem\" approach that is common in modern data analysis. Instead of computing $\\gamma_E$ from profile measurements, you will infer its value by observing its suppressive effect on turbulent transport. Using a shear-modified transport model and mock experimental data, you will implement a Bayesian inference framework to estimate the most probable value of $\\gamma_E$ and its associated credible interval, showcasing a powerful method for model validation and parameter estimation in fusion science .",
            "id": "3969578",
            "problem": "You are given dimensionless experimental pairs of ion heat flux and the ion temperature gradient in a magnetized plasma, together with a simplified shear-suppressed turbulent transport closure. Your task is to implement a Bayesian inference to estimate the $E \\times B$ shearing rate $\\gamma_E$ by fitting the model to the data and quantifying uncertainty. The final output must aggregate results for multiple datasets into one line as specified below.\n\nThe $E \\times B$ shearing rate $\\gamma_E$ is assumed to suppress turbulent transport by decorrelation. Begin from the ion heat flux law $Q_i = - n_i T_i \\chi_i \\nabla T_i$, define the normalized dimensionless flux $q_i = Q_i / Q_{\\mathrm{gB}}$, where $Q_{\\mathrm{gB}}$ denotes gyro-Bohm (gB) normalization, and denote the dimensionless ion temperature gradient as $\\kappa \\equiv R/L_{T_i}$ with $L_{T_i}^{-1} = -\\frac{\\partial \\ln T_i}{\\partial r}$ and $R$ the major radius. Adopt the following shear-modified closure for the turbulent diffusivity expressed directly in terms of the normalized flux:\n$$\nq_i(\\kappa; \\gamma_E) = A \\left[(\\kappa - \\kappa_c)_+\\right]^\\alpha \\left[1 + \\left(\\frac{\\gamma_E}{\\gamma_{\\mathrm{lin}}(\\kappa)}\\right)^\\beta\\right]^{-1},\n$$\nwhere $(x)_+ \\equiv \\max(x, 0)$, $\\gamma_{\\mathrm{lin}}(\\kappa) = B \\left[(\\kappa - \\kappa_c)_+\\right]$, and $A$, $\\alpha$, $\\beta$, $\\kappa_c$, $B$ are known positive model constants. Assume independent Gaussian measurement errors: for data points $(\\kappa_j, y_j)$ with known standard deviations $\\sigma_j$, the likelihood is\n$$\ny_j \\sim \\mathcal{N}(q_i(\\kappa_j; \\gamma_E), \\sigma_j^2).\n$$\nUse a uniform prior on $\\gamma_E$ over the interval $[0, \\gamma_{\\max}]$ and zero probability outside. Infer the posterior for $\\gamma_E$ and report the posterior mean and central $95\\%$ credible interval.\n\nAll quantities are dimensionless under gyro-Bohm normalization; report $\\gamma_E$ in units of $c_s/R$ as a dimensionless number. Angles do not appear, so no angle unit is required. Express credible interval bounds as decimals.\n\nImplement the inference by numerically integrating the posterior over a grid in $\\gamma_E$ on $[0, \\gamma_{\\max}]$; do not use Markov Chain Monte Carlo. Your program must, for each dataset, compute:\n- the posterior mean $\\mathbb{E}[\\gamma_E \\mid \\{\\kappa_j, y_j, \\sigma_j\\}]$,\n- the lower and upper bounds of the central $95\\%$ credible interval for $\\gamma_E$.\n\nUse the following fixed model constants and prior bound:\n- $A = 1.2$,\n- $\\alpha = 1.5$,\n- $\\beta = 2.0$,\n- $\\kappa_c = 5.0$,\n- $B = 0.3$,\n- $\\gamma_{\\max} = 4.0$.\n\nTest Suite:\nProvide results for the following three datasets, which include three points each:\n- Dataset $1$ (moderate drive, moderate suppression): $\\kappa$ values $[6.0, 7.0, 8.0]$, observed $y$ values $[0.12, 0.82, 2.85]$, standard deviations $\\sigma$ values $[0.10, 0.10, 0.10]$.\n- Dataset $2$ (near threshold, weak drive): $\\kappa$ values $[5.2, 5.5, 5.8]$, observed $y$ values $[0.02, 0.17, 0.49]$, standard deviations $\\sigma$ values $[0.05, 0.05, 0.05]$.\n- Dataset $3$ (strong drive, strong suppression): $\\kappa$ values $[9.0, 10.0, 11.0]$, observed $y$ values $[1.90, 3.40, 6.30]$, standard deviations $\\sigma$ values $[0.20, 0.20, 0.20]$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one dataset and is a list of three floats in the order $[\\text{posterior\\_mean}, \\text{lower\\_95}, \\text{upper\\_95}]$. Round each float to three decimal places. For example, the output should look like\n$$\n\\text{[[m_1,\\ell_1,u_1],[m_2,\\ell_2,u_2],[m_3,\\ell_3,u_3]]}.\n$$",
            "solution": "The problem is scientifically and mathematically well-posed, providing a complete set of data, a physical model, and a statistical framework to perform Bayesian inference. The model for shear-suppressed turbulent transport is a standard simplified form used in plasma physics, and the task of inverting a model parameter from data is a conventional problem in data analysis. Therefore, a solution can be constructed.\n\nThe core of the problem is to determine the posterior probability distribution for the $E\\times B$ shearing rate, $\\gamma_E$, given a set of experimental measurements $D = \\{(\\kappa_j, y_j, \\sigma_j)\\}_{j=1}^N$. According to Bayes' theorem, the posterior probability density function (PDF) $P(\\gamma_E | D)$ is proportional to the product of the likelihood function $P(D | \\gamma_E)$ and the prior probability distribution $P(\\gamma_E)$:\n$$ P(\\gamma_E | D) \\propto P(D | \\gamma_E) P(\\gamma_E) $$\nThe full posterior PDF is obtained by normalizing this product:\n$$ P(\\gamma_E | D) = \\frac{P(D | \\gamma_E) P(\\gamma_E)}{\\int P(D | \\gamma_E') P(\\gamma_E') d\\gamma_E'} $$\nwhere the integral in the denominator, known as the marginal likelihood or evidence, is taken over the entire parameter space of $\\gamma_E$.\n\nThe problem specifies a uniform prior for $\\gamma_E$ over the interval $[0, \\gamma_{\\max}]$. The PDF is:\n$$ P(\\gamma_E) = \\begin{cases} 1/\\gamma_{\\max} & \\text{if } 0 \\le \\gamma_E \\le \\gamma_{\\max} \\\\ 0 & \\text{otherwise} \\end{cases} $$\nwith $\\gamma_{\\max} = 4.0$. Since the prior is constant over the domain of interest, the posterior is directly proportional to the likelihood within this domain, $P(\\gamma_E|D) \\propto P(D|\\gamma_E)$.\n\nThe experimental measurements $y_j$ are assumed to be independent and corrupted by Gaussian noise with known standard deviations $\\sigma_j$. The likelihood of observing a single data point $y_j$ for a given $\\gamma_E$ is given by the Gaussian PDF:\n$$ P(y_j | \\kappa_j, \\sigma_j, \\gamma_E) = \\frac{1}{\\sqrt{2\\pi}\\sigma_j^2} \\exp \\left( - \\frac{(y_j - q_i(\\kappa_j; \\gamma_E))^2}{2\\sigma_j^2} \\right) $$\nwhere $q_i(\\kappa_j; \\gamma_E)$ is the model prediction for the normalized heat flux. The model is given by:\n$$ q_i(\\kappa; \\gamma_E) = A \\left[(\\kappa - \\kappa_c)_+\\right]^\\alpha \\left[1 + \\left(\\frac{\\gamma_E}{\\gamma_{\\mathrm{lin}}(\\kappa)}\\right)^\\beta\\right]^{-1} $$\nwith $\\gamma_{\\mathrm{lin}}(\\kappa) = B \\left[(\\kappa - \\kappa_c)_+\\right]$ and $(x)_+ \\equiv \\max(x, 0)$. The constants are $A=1.2$, $\\alpha=1.5$, $\\beta=2.0$, $\\kappa_c=5.0$, and $B=0.3$. For cases where $\\kappa \\le \\kappa_c$, the term $(\\kappa - \\kappa_c)_+$ is zero, which means the turbulent drive is absent and the flux must be zero, $q_i=0$. The implementation must handle this case correctly to avoid a division by zero in the expression for $\\gamma_{\\mathrm{lin}}(\\kappa)$.\n\nSince the measurements are independent, the total likelihood for the entire dataset $D$ is the product of the individual likelihoods:\n$$ P(D | \\gamma_E) = \\prod_{j=1}^N P(y_j | \\kappa_j, \\sigma_j, \\gamma_E) $$\nFor numerical stability, it is preferable to work with the log-likelihood. The unnormalized posterior is proportional to the likelihood, $\\mathcal{L}(\\gamma_E) = \\exp \\left( -\\frac{1}{2} \\sum_{j=1}^N \\frac{(y_j - q_i(\\kappa_j; \\gamma_E))^2}{\\sigma_j^2} \\right)$. Due to the uniform prior, the unnormalized posterior PDF $\\tilde{P}(\\gamma_E|D)$ is simply $\\mathcal{L}(\\gamma_E)$ for $\\gamma_E \\in [0, \\gamma_{\\max}]$ and zero otherwise.\n\nThe posterior distribution is determined by evaluating $\\tilde{P}(\\gamma_E|D)$ on a fine grid of points $\\{\\gamma_{E,k}\\}$ spanning the interval $[0, \\gamma_{\\max}]$. To prevent numerical underflow, it is standard practice to compute the log-likelihood, subtract its maximum value, and then exponentiate. Let $\\ln \\mathcal{L}_k = \\ln \\mathcal{L}(\\gamma_{E,k})$. We compute numerically stable unnormalized posterior values $p_k = \\exp(\\ln \\mathcal{L}_k - \\max_i(\\ln \\mathcal{L}_i))$.\n\nOnce the unnormalized posterior is tabulated on the grid, we compute the required statistical properties using numerical integration, for which the trapezoidal rule is a suitable choice.\n\nThe posterior mean $\\mathbb{E}[\\gamma_E | D]$ is calculated as:\n$$ \\mathbb{E}[\\gamma_E | D] = \\frac{\\int_0^{\\gamma_{\\max}} \\gamma_E \\tilde{P}(\\gamma_E|D) d\\gamma_E}{\\int_0^{\\gamma_{\\max}} \\tilde{P}(\\gamma_E'|D) d\\gamma_E'} $$\nThis is numerically approximated using the grid values, for instance with `numpy.trapz`.\n\nThe central $95\\%$ credible interval $[\\ell, u]$ is defined by the values that enclose $95\\%$ of the posterior probability, with $2.5\\%$ in each tail. This requires computing the cumulative distribution function (CDF) of the posterior: \n$$ F(\\gamma) = \\frac{\\int_0^{\\gamma} \\tilde{P}(\\gamma_E'|D) d\\gamma_E'}{\\int_0^{\\gamma_{\\max}} \\tilde{P}(\\gamma_E'|D) d\\gamma_E'} $$\nThe bounds are found by solving $F(\\ell) = 0.025$ and $F(u) = 0.975$. Numerically, we compute the CDF on the grid (using `scipy.integrate.cumulative_trapezoid` for accuracy), normalize it, and then use linear interpolation (`numpy.interp`) to find the values of $\\gamma_E$ corresponding to the desired quantiles. The following implementation carries out this procedure for each of the three provided datasets.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Performs Bayesian inference to estimate the ExB shearing rate gamma_E\n    for three datasets and formats the results.\n    \"\"\"\n    # Model constants and prior bounds\n    A = 1.2\n    ALPHA = 1.5\n    BETA = 2.0\n    KAPPA_C = 5.0\n    B = 0.3\n    GAMMA_MAX = 4.0\n    \n    # Grid for numerical integration\n    N_GRID = 10000\n    gamma_grid = np.linspace(0, GAMMA_MAX, N_GRID)\n\n    def q_model(kappa_vals, gamma_E):\n        \"\"\"\n        Calculates the predicted normalized heat flux q_i.\n        Vectorized for an array of kappa values and a scalar gamma_E.\n        \"\"\"\n        # Ensure kappa_vals is a numpy array for vectorized operations\n        kappa_vals = np.asarray(kappa_vals)\n        \n        # Calculate effective kappa above the critical gradient\n        kappa_eff = np.maximum(0, kappa_vals - KAPPA_C)\n        q_pred = np.zeros_like(kappa_eff, dtype=float)\n        \n        # Identify indices where turbulence is driven (kappa > kappa_c)\n        driven_mask = kappa_eff > 0\n        \n        # If no points are above threshold, flux is zero everywhere\n        if not np.any(driven_mask):\n            return q_pred\n            \n        keff_driven = kappa_eff[driven_mask]\n        \n        # Calculate the linear growth rate proxy\n        gamma_lin = B * keff_driven\n        \n        # Calculate the suppression factor\n        suppression = 1.0 + (gamma_E / gamma_lin)**BETA\n        \n        # Calculate flux for the driven points\n        q_pred[driven_mask] = A * (keff_driven**ALPHA) / suppression\n        \n        return q_pred\n\n    def analyze_dataset(kappa, y, sigma):\n        \"\"\"\n        Computes the posterior mean and 95% credible interval for gamma_E\n        for a single dataset.\n        \"\"\"\n        log_likelihood = np.zeros_like(gamma_grid)\n\n        # Iterate over the parameter grid to compute the likelihood\n        for i, gamma_E in enumerate(gamma_grid):\n            q_pred = q_model(kappa, gamma_E)\n            # Sum of squared residuals, normalized by variance\n            chi2 = np.sum(((y - q_pred) / sigma)**2)\n            log_likelihood[i] = -0.5 * chi2\n\n        # Stabilize numerically by subtracting the max log-likelihood\n        # This makes the max of the unnormalized posterior equal to 1, preventing underflow\n        log_likelihood -= np.max(log_likelihood)\n        posterior_unnorm = np.exp(log_likelihood)\n\n        # Calculate posterior mean using trapezoidal rule for integration\n        # Normalization constant Z = integral of posterior_unnorm\n        Z = np.trapz(posterior_unnorm, x=gamma_grid)\n        # Mean = integral of gamma_E * posterior_unnorm / Z\n        posterior_mean = np.trapz(gamma_grid * posterior_unnorm, x=gamma_grid) / Z\n\n        # Calculate the cumulative distribution function (CDF)\n        cdf = cumulative_trapezoid(posterior_unnorm, x=gamma_grid, initial=0)\n        # Normalize the CDF to have a maximum value of 1\n        cdf /= cdf[-1]\n\n        # Interpolate the CDF to find the 2.5% and 97.5% quantiles\n        lower_95 = np.interp(0.025, cdf, gamma_grid)\n        upper_95 = np.interp(0.975, cdf, gamma_grid)\n\n        return [posterior_mean, lower_95, upper_95]\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Dataset 1\n        (np.array([6.0, 7.0, 8.0]), np.array([0.12, 0.82, 2.85]), np.array([0.10, 0.10, 0.10])),\n        # Dataset 2\n        (np.array([5.2, 5.5, 5.8]), np.array([0.02, 0.17, 0.49]), np.array([0.05, 0.05, 0.05])),\n        # Dataset 3\n        (np.array([9.0, 10.0, 11.0]), np.array([1.90, 3.40, 6.30]), np.array([0.20, 0.20, 0.20])),\n    ]\n\n    # Process all datasets\n    results = []\n    for case in test_cases:\n        kappa, y, sigma = case\n        result = analyze_dataset(kappa, y, sigma)\n        results.append(result)\n\n    # Format the final output string as specified\n    formatted_parts = []\n    for res in results:\n        # Format each float to three decimal places\n        formatted_res = f\"[{res[0]:.3f},{res[1]:.3f},{res[2]:.3f}]\"\n        formatted_parts.append(formatted_res)\n    \n    final_output = f\"[{','.join(formatted_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}