{
    "hands_on_practices": [
        {
            "introduction": "在我们模拟引导中心运动之前，必须先理解其基本动力学。这个练习探讨了磁镜的经典例子，其中粒子被非均匀磁场俘获。通过推导平行运动方程和弹跳频率，你将从第一性原理层面理解“磁镜力”以及控制粒子约束的有效势 。",
            "id": "3987292",
            "problem": "考虑一个质量为 $m$、电荷为 $q$ 的单电荷粒子在一个静磁场中运动，该磁场的大小 $B(s)$ 仅沿磁力线的弧长坐标 $s$ 变化。假设电场可忽略不计，磁场在粒子拉莫尔半径的尺度上变化缓慢，且导心 (GC) 近似适用。设粒子的磁矩 $\\mu$ 近似不变量，其运动被限制在一个对称磁阱中，该磁阱在 $s=0$ 处有 $B(s)$ 的最小值，在 $s=\\pm s_{m}$ 处有磁镜点，其中 $v_{\\parallel}=0$。\n\n从洛伦兹力定律和磁矩的不变性出发，\n- 推导与无电场情况下的能量守恒一致的、关于导心坐标 $s(t)$ 和平行速度 $v_{\\parallel}(t)$ 的等效平行运动方程；\n- 接着，通过对 $B(s)$ 在 $s_{m}$ 附近进行关于 $(s-s_{m})$ 的二阶局部泰勒展开，分析 $v_{\\parallel}$ 在单个磁镜点 $s=s_{m}$ 附近的小振幅行为。仔细确定 $v_{\\parallel}$ 对 $(s-s_{m})$ 的主导阶依赖关系，以及在磁镜点附近相应的短时行为 $s(t)$；\n- 最后，假设磁阱底部附近的磁场是二次的，即 $B(s)=B_{0}+\\frac{1}{2}\\kappa s^{2}$，其中 $\\kappa=\\left.\\frac{d^{2}B}{ds^{2}}\\right|_{s=0}0$。仅使用从你推导出的平行运动方程出发的第一性原理推导，证明导心沿 $s$ 方向的小振幅反弹运动是简谐的，并确定角反弹频率的解析表达式。\n\n将最终答案表示为角反弹频率的一个闭式解析表达式，用 $\\mu$、$m$ 和局部二阶导数 $\\left.\\frac{d^{2}B}{ds^{2}}\\right|_{s=0}$ 表示。角频率的单位为弧度/秒。不需要进行数值计算或四舍五入。",
            "solution": "该问题被评估为有效，因为它在科学上基于等离子体物理原理，特别是导心理论，并且提法恰当、内容自洽、客观。\n\n按照问题陈述的要求，解答分为三个部分。\n\n**第1部分：平行运动方程的推导**\n\n带电粒子的总能量 $E$ 纯粹是动能，因为磁场不做功，且假定电场可忽略不计。能量由下式给出：\n$$E = \\frac{1}{2}m(v_{\\perp}^2 + v_{\\parallel}^2)$$\n其中 $m$ 是粒子质量，$v_{\\perp}$ 是垂直于磁场 $\\vec{B}$ 的速度分量，$v_{\\parallel}$ 是平行于 $\\vec{B}$ 的速度分量。当粒子运动时，$E$ 是一个守恒量。\n\n问题陈述指出磁矩 $\\mu$ 是一个绝热不变量。磁矩定义为：\n$$\\mu = \\frac{m v_{\\perp}^2}{2 B}$$\n其中 $B = |\\vec{B}|$ 是磁场的大小。由于 $\\mu$ 是常数，垂直动能可以表示为 $\\frac{1}{2}m v_{\\perp}^2 = \\mu B(s)$，其中 $B$ 是沿磁力线的弧长 $s$ 的函数。\n\n将此代入能量守恒方程，得到：\n$$E = \\mu B(s) + \\frac{1}{2}m v_{\\parallel}^2$$\n该方程将平行速度 $v_{\\parallel}$ 与粒子沿磁力线的位置 $s$ 联系起来。\n\n为了推导运动方程，我们考虑作用在导心上的力。对于在磁场中具有磁矩 $\\mu$ 的粒子，存在一个等效力，称为磁镜力，由 $\\vec{F} = -\\mu \\nabla B$ 给出。该力平行于磁力线的分量 $F_{\\parallel}$ 驱动导心沿 $s$ 运动。沿磁力线的单位矢量是 $\\hat{b} = \\vec{B}/B$。\n$$F_{\\parallel} = \\vec{F} \\cdot \\hat{b} = (-\\mu \\nabla B) \\cdot \\hat{b}$$\n由于给定的磁场大小 $B(s)$ 仅沿弧长坐标 $s$ 变化，其沿磁力线的梯度分量就是关于 $s$ 的导数：$(\\nabla B) \\cdot \\hat{b} = \\frac{dB}{ds}$。\n因此，平行力为：\n$$F_{\\parallel} = -\\mu \\frac{dB}{ds}$$\n根据牛顿第二定律，导心沿磁力线的加速度 $a_{\\parallel} = \\frac{d v_{\\parallel}}{dt} = \\frac{d^2s}{dt^2}$ 由 $F_{\\parallel} = m a_{\\parallel}$ 给出。\n这得到了关于导心坐标 $s(t)$ 的平行运动方程：\n$$m \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds}$$\n该方程表明，导心的运动就像一个质量为 $m$ 的粒子在等效势 $U_{eff}(s) = \\mu B(s)$ 中运动。这个表述与能量守恒是一致的，可以通过将运动方程乘以 $v_{\\parallel} = \\frac{ds}{dt}$ 来验证：\n$$m \\frac{ds}{dt} \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds} \\frac{ds}{dt}$$\n$$\\frac{d}{dt}\\left(\\frac{1}{2}m\\left(\\frac{ds}{dt}\\right)^2\\right) = -\\mu \\frac{dB}{dt} = \\frac{d}{dt}(-\\mu B(s))$$\n$$\\frac{d}{dt}\\left(\\frac{1}{2}m v_{\\parallel}^2 + \\mu B(s)\\right) = 0$$\n这证实了总能量 $E = \\frac{1}{2}m v_{\\parallel}^2 + \\mu B(s)$ 是守恒的。\n\n**第2部分：磁镜点附近运动的分析**\n\n在磁镜点 $s = s_m$ 处，粒子的平行运动发生反向，因此 $v_{\\parallel}(s_m)=0$。根据能量守恒方程，总能量由磁镜点处的场强决定：\n$$E = \\mu B(s_m)$$\n对于任意位置 $s$，平行速度的平方可以通过重新整理能量方程得到：\n$$\\frac{1}{2}m v_{\\parallel}^2 = E - \\mu B(s) = \\mu B(s_m) - \\mu B(s)$$\n$$v_{\\parallel}^2(s) = \\frac{2\\mu}{m} (B(s_m) - B(s))$$\n为了分析 $s_m$ 附近的行为，我们对 $B(s)$ 在 $s=s_m$ 附近进行泰勒级数展开：\n$$B(s) = B(s_m) + \\left.\\frac{dB}{ds}\\right|_{s_m} (s - s_m) + \\frac{1}{2}\\left.\\frac{d^2B}{ds^2}\\right|_{s_m} (s - s_m)^2 + \\dots$$\n我们记 $B'(s_m) = \\left.\\frac{dB}{ds}\\right|_{s_m}$。为了使粒子被捕获，$B(s)$ 必须在远离 $s=0$ 处的最小值时增加，因此对于 $s_m > 0$，有 $B'(s_m) > 0$。\n将展开式代入 $v_{\\parallel}^2$ 的表达式中：\n$$v_{\\parallel}^2(s) = \\frac{2\\mu}{m} \\left(B(s_m) - \\left[B(s_m) + B'(s_m)(s - s_m) + O((s - s_m)^2)\\right]\\right)$$\n$$v_{\\parallel}^2(s) \\approx -\\frac{2\\mu B'(s_m)}{m} (s - s_m)$$\n粒子从 $s  s_m$（对于 $s_m > 0$）接近磁镜点，因此 $(s - s_m)  0$。这保证了 $v_{\\parallel}^2 \\ge 0$。平行速度的大小对离磁镜点的距离 $(s_m - s)$ 的主导阶依赖关系是：\n$$|v_{\\parallel}(s)| \\propto \\sqrt{s_m - s}$$\n为了找到 $s_m$ 附近 $s(t)$ 的短时行为，设粒子在 $t=t_m$ 时到达磁镜点。当粒子在 $t  t_m$ 时接近磁镜点，其速度为 $v_{\\parallel} = \\frac{ds}{dt} > 0$。而当粒子在 $t > t_m$ 时离开磁镜点，其速度为 $v_{\\parallel} = \\frac{ds}{dt}  0$。我们有：\n$$\\frac{ds}{dt} = -\\sqrt{\\frac{2\\mu B'(s_m)}{m}(s_m-s)}$$\n这是一个可分离微分方程。设 $C = \\sqrt{\\frac{2\\mu B'(s_m)}{m}}$。\n$$\\frac{ds}{\\sqrt{s_m - s}} = -C dt$$\n从 $t_m$ 到 $t$（并相应地从 $s_m$ 到 $s(t)$）积分：\n$$\\int_{s_m}^{s(t)} \\frac{du}{\\sqrt{s_m - u}} = \\int_{t_m}^{t} -C d\\tau$$\n$$\\left[ -2\\sqrt{s_m - u} \\right]_{s_m}^{s(t)} = -C(t-t_m)$$\n$$-2\\sqrt{s_m - s(t)} - (-2\\sqrt{s_m-s_m}) = -C(t-t_m)$$\n$$2\\sqrt{s_m - s(t)} = C(t-t_m)$$\n两边平方并求解 $s(t)$：\n$$4(s_m - s(t)) = C^2(t-t_m)^2$$\n$$s(t) = s_m - \\frac{C^2}{4}(t-t_m)^2 = s_m - \\frac{1}{4}\\left(\\frac{2\\mu B'(s_m)}{m}\\right)(t-t_m)^2$$\n$$s(t) = s_m - \\frac{\\mu B'(s_m)}{2m}(t-t_m)^2$$\n这表明在磁镜点附近，位置相对于反射时间呈二次方变化，这是匀加速运动的一个特征。\n\n**第3部分：反弹运动和频率**\n\n在磁阱底部 $s=0$ 附近，磁场近似为二次函数：\n$$B(s) = B_0 + \\frac{1}{2}\\kappa s^2$$\n其中 $\\kappa = \\left.\\frac{d^2B}{ds^2}\\right|_{s=0} > 0$。\n为了分析 $s=0$ 附近的小振幅反弹运动，我们使用第1部分推导出的平行运动方程：\n$$m \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds}$$\n我们首先计算给定磁场分布的导数：\n$$\\frac{dB}{ds} = \\frac{d}{ds} \\left(B_0 + \\frac{1}{2}\\kappa s^2\\right) = \\kappa s$$\n将此代入运动方程：\n$$m \\frac{d^2s}{dt^2} = -\\mu (\\kappa s)$$\n重新整理各项，我们得到：\n$$\\frac{d^2s}{dt^2} + \\left(\\frac{\\mu \\kappa}{m}\\right)s = 0$$\n这是简谐振子方程 $\\ddot{x} + \\omega^2 x = 0$ 的典范形式。通过将我们的 $s(t)$ 方程与标准形式进行比较，我们可以确定角反弹频率的平方 $\\omega_b^2$：\n$$\\omega_b^2 = \\frac{\\mu \\kappa}{m}$$\n因此，在磁阱中小振幅振荡的角反弹频率为：\n$$\\omega_b = \\sqrt{\\frac{\\mu \\kappa}{m}}$$\n问题要求用 $\\mu$、$m$ 和 $B$ 在 $s=0$ 处的二阶导数来表示这个表达式。代入 $\\kappa = \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}$ 的定义：\n$$\\omega_b = \\sqrt{\\frac{\\mu}{m} \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}}$$\n这就是角反弹频率的最终解析表达式。",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\mu}{m} \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}}}$$"
        },
        {
            "introduction": "掌握了解析理论之后，我们现在转向计算。这项练习将挑战你从头开始构建一个数值积分器，以模拟引导中心的轨迹。通过将运动分解为平行和漂移分量，你将实现一个时间中心格式的方案，并测试其保持物理不变量的能力，这是计算物理学中的一项关键技能 。",
            "id": "3987359",
            "problem": "你的任务是在计算聚变科学与工程的背景下，为带电粒子在给定静态电磁场中的导心运动构建并分析一个数值积分器。该积分器必须是一种类似 Boris 算法的时间推进格式，通过将平行运动和漂移运动分离以适应导心动力学。请从基本的、经过充分检验的方程和定义出发来推导你的方法；不要依赖任何记忆的最终更新公式。你的任务是实现该算法，并量化其在变化磁场中守恒磁矩的误差。\n\n假设一个质量为 $m$、电荷为 $q$ 的非相对论性带电粒子在静态磁场 $\\mathbf{B}(\\mathbf{x})$ 和静态电场 $\\mathbf{E}(\\mathbf{x})$ 中运动。在导心描述中，状态变量为导心位置 $\\mathbf{x}(t)$、平行速度 $v_{\\parallel}(t)$ 和磁矩 $\\mu(t)$。使用以下基本依据：\n\n- 导心速度由下式给出\n$$\n\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}} + \\mathbf{v}_{d},\n$$\n其中 $\\hat{\\mathbf{b}} = \\mathbf{B}/\\|\\mathbf{B}\\|$ 是沿磁场方向的单位矢量，$\\mathbf{v}_{d}$ 是垂直于 $\\hat{\\mathbf{b}}$ 的漂移速度之和。\n\n- 对于静态场和缓慢变化的磁场强度，两种标准的漂移是：\n$$\n\\mathbf{v}_{E} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{\\|\\mathbf{B}\\|^{2}}, \\quad\n\\mathbf{v}_{\\nabla B} = \\frac{\\mu}{q}\\,\\frac{\\hat{\\mathbf{b}}\\times\\nabla \\|\\mathbf{B}\\|}{\\|\\mathbf{B}\\|^{2}}.\n$$\n\n- 由磁镜力引起的平行加速度为\n$$\n\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}\\cdot\\nabla \\|\\mathbf{B}\\|.\n$$\n\n- 在没有时变场和碰撞的情况下，磁矩是一个绝热不变量：\n$$\n\\frac{d\\mu}{dt} = 0,\n$$\n并且总能量守恒：\n$$\n\\mathcal{W} = \\frac{m}{2}\\,v_{\\parallel}^{2} + \\mu \\,\\|\\mathbf{B}\\| = \\text{常数}.\n$$\n\n为导心方程构建一个类似 Boris 算法的积分器，该积分器在一个时间步长 $\\Delta t$ 内，将沿 $\\hat{\\mathbf{b}}$ 的平行运动和跨场漂移运动拆分为独立的子步。该格式必须是时间中心和对称的（二阶精度），在精神上类似于 Boris 算法的速度更新分离，但应用于导心动力学。不要提供或依赖现有的更新公式；从给定的基本方程推导它们。你的程序必须使用这种分离方法在指定的时间区间内演化 $\\mathbf{x}$ 和 $v_{\\parallel}$，并通过构造保持 $\\mu$ 恒定。然后，为评估算法在空间变化的磁场中守恒磁矩的保真度，请使用能量不变量计算最终时刻的有效磁矩，\n$$\n\\mu_{\\mathrm{eff}} = \\frac{\\mathcal{W}_{0} - \\frac{m}{2}\\,v_{\\parallel}(t_{\\mathrm{final}})^{2}}{\\|\\mathbf{B}(\\mathbf{x}(t_{\\mathrm{final}}))\\|},\n$$\n其中 $\\mathcal{W}_{0}$ 是初始能量 $\\mathcal{W}_{0} = \\frac{m}{2}\\,v_{\\parallel}(t_{0})^{2} + \\mu_{0}\\,\\|\\mathbf{B}(\\mathbf{x}(t_{0}))\\|$。将守恒磁矩的相对误差报告为\n$$\n\\epsilon_{\\mu} = \\frac{\\left|\\mu_{\\mathrm{eff}} - \\mu_{0}\\right|}{\\mu_{0}},\n$$\n以十进制数表示。\n\n对测试套件使用以下科学上合理且内部一致的场模型和参数。磁场处处沿 $\\hat{\\mathbf{z}}$ 方向，但其大小在 $x$ 和 $z$ 方向上线性变化：\n$$\n\\mathbf{B}(\\mathbf{x}) = B_{0}\\,\\left(1 + \\alpha\\,x + \\beta\\,z\\right)\\,\\hat{\\mathbf{z}},\n$$\n并且电场为零：\n$$\n\\mathbf{E}(\\mathbf{x}) = \\mathbf{0}.\n$$\n所有量都必须在国际单位制 (SI) 中处理。在此模型中，单位矢量为 $\\hat{\\mathbf{b}} = \\hat{\\mathbf{z}}$，梯度为 $\\nabla \\|\\mathbf{B}\\| = B_{0}\\,\\left(\\alpha, 0, \\beta\\right)$。\n\n实现你的积分器，并为以下四个测试案例计算 $\\epsilon_{\\mu}$。在每个案例中，从 $\\mathbf{x}_{0} = (x_{0}, y_{0}, z_{0})$、$v_{\\parallel,0}$ 和 $\\mu_{0}$ 开始初始化，然后积分到 $t_{\\mathrm{final}} = N\\,\\Delta t$。对单电荷离子使用给定的常数 $q$ 和 $m$。\n\n- 案例1（均匀磁场，基准）：\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 0.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$。\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$。\n    - $v_{\\parallel,0} = 2.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$。\n    - $\\Delta t = 1.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 1000$。\n\n- 案例2（弱 $x$ 梯度，中等时间步长）：\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 1.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$。\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$。\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$。\n    - $\\Delta t = 5.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 2000$。\n\n- 案例3（强 $x$ 梯度，大时间步长，压力测试）：\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 10.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$。\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$。\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$。\n    - $\\Delta t = 5.0\\times 10^{-7}\\,\\mathrm{s}$, $N = 1000$。\n\n- 案例4（组合的 $x$ 和 $z$ 梯度，磁镜力激活）：\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 1.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.01\\,\\mathrm{m}^{-1}$。\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$。\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$。\n    - $\\Delta t = 1.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 3000$。\n\n使用 $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$ 和 $m = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$。所有距离单位必须是 $\\mathrm{m}$，速度单位是 $\\mathrm{m/s}$，时间单位是 $\\mathrm{s}$，磁场单位是 $\\mathrm{T}$，能量相关量的单位是 $\\mathrm{J}$。\n\n你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的条目是按顺序排列的案例1-4的相对误差 $\\epsilon_{\\mu}$，表示为无单位的十进制数。例如，输出应采用以下形式\n$$\n[\\epsilon_{\\mu,1},\\epsilon_{\\mu,2},\\epsilon_{\\mu,3},\\epsilon_{\\mu,4}].\n$$",
            "solution": "问题陈述要求开发和分析一个用于带电粒子导心运动的数值积分器。该积分器必须基于基本原理和指定的平行运动与垂直（漂移）运动的分离方法来构建。要求对该算法在守恒磁矩 $\\mu$ 方面的保真度进行定量评估。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n- **状态变量：** 导心位置 $\\mathbf{x}(t)$，平行速度 $v_{\\parallel}(t)$，磁矩 $\\mu(t)$。\n- **粒子参数：** 质量 $m = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$，电荷 $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$。\n- **控制方程：**\n  - 导心速度：$\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}} + \\mathbf{v}_{d}$，其中 $\\hat{\\mathbf{b}} = \\mathbf{B}/\\|\\mathbf{B}\\|$。\n  - 漂移速度之和 $\\mathbf{v}_d = \\mathbf{v}_E + \\mathbf{v}_{\\nabla B}$。\n  - 电漂移：$\\mathbf{v}_{E} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{\\|\\mathbf{B}\\|^{2}}$。\n  - 梯度B漂移：$\\mathbf{v}_{\\nabla B} = \\frac{\\mu}{q}\\,\\frac{\\hat{\\mathbf{b}}\\times\\nabla \\|\\mathbf{B}\\|}{\\|\\mathbf{B}\\|^{2}}$。\n  - 平行加速度：$\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}\\cdot\\nabla \\|\\mathbf{B}\\|$。\n- **不变量：**\n  - 磁矩：$\\frac{d\\mu}{dt} = 0$，因此 $\\mu(t) = \\mu_0$ 是一个常数参数。\n  - 能量：$\\mathcal{W} = \\frac{m}{2}\\,v_{\\parallel}^{2} + \\mu \\,\\|\\mathbf{B}\\| = \\text{常数}$。\n- **场模型：**\n  - $\\mathbf{E}(\\mathbf{x}) = \\mathbf{0}$。\n  - $\\mathbf{B}(\\mathbf{x}) = B_{0}\\,\\left(1 + \\alpha\\,x + \\beta\\,z\\right)\\,\\hat{\\mathbf{z}}$。\n- **误差度量：**\n  - 相对误差：$\\epsilon_{\\mu} = \\frac{\\left|\\mu_{\\mathrm{eff}} - \\mu_{0}\\right|}{\\mu_{0}}$。\n  - 有效磁矩：$\\mu_{\\mathrm{eff}} = \\frac{\\mathcal{W}_{0} - \\frac{m}{2}\\,v_{\\parallel}(t_{\\mathrm{final}})^{2}}{\\|\\mathbf{B}(\\mathbf{x}(t_{\\mathrm{final}}))\\|}$。\n  - 初始能量：$\\mathcal{W}_{0} = \\frac{m}{2}\\,v_{\\parallel}(t_{0})^{2} + \\mu_{0}\\,\\|\\mathbf{B}(\\mathbf{x}(t_{0}))\\|$。\n- **测试案例：** 指定了四个案例，提供了所有参数（$B_0, \\alpha, \\beta, \\mathbf{x}_0, v_{\\parallel,0}, \\mu_0, \\Delta t, N$）。\n\n**步骤2：验证给定条件**\n该问题在等离子体物理学中成熟的导心运动理论上具有科学依据。所提供的方程在所述的静态、非相对论性假设下是标准且正确的。该问题是适定的，提供了一套完整的常微分方程组、初始条件和物理常数。语言精确客观。使用一个简单但非平凡的磁场模型，可以对数值方法的属性进行集中分析。推导数值格式并测试其守恒性质的任务是计算科学中一项标准且有意义的练习。所选的误差度量利用已知的能量守恒定律来检查影响不变量（$\\mu$）的数值伪影，这是一种有效且富有洞察力的技术。该问题是自洽、一致且科学上合理的。\n\n**步骤3：结论**\n问题是**有效的**。我们可以继续进行求解。\n\n### 算法推导与设计\n\n任务是通过分离导心动力学中的平行运动和漂移运动，构建一个类似 Boris 算法的、时间中心的、对称的积分器。这提示我们使用 Strang 分裂法，这是一种从低阶格式构造二阶精度格式的通用技术。\n\n系统状态是数对 $(\\mathbf{x}, v_{\\parallel})$。运动方程为：\n$$\n\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}(t)\\,\\hat{\\mathbf{b}}(\\mathbf{x}) + \\mathbf{v}_{d}(\\mathbf{x})\n$$\n$$\n\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}(\\mathbf{x})\\cdot\\nabla \\|\\mathbf{B}(\\mathbf{x})\\|\n$$\n\n我们将演化过程分为两部分：\n1.  **平行运动 (算子 $\\mathcal{P}$):** 这部分包括沿磁力线的运动和平行加速度。\n    $$\n    \\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}}(\\mathbf{x}), \\quad \\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}(\\mathbf{x})\\cdot\\nabla \\|\\mathbf{B}(\\mathbf{x})\\|\n    $$\n2.  **漂移运动 (算子 $\\mathcal{D}$):** 这部分描述跨场漂移。\n    $$\n    \\frac{d\\mathbf{x}}{dt} = \\mathbf{v}_{d}(\\mathbf{x}), \\quad \\frac{dv_{\\parallel}}{dt} = 0\n    $$\n\n将状态从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$ 的二阶对称 Strang 分裂格式构建如下：\n$$\n(\\mathbf{x}_{n+1}, v_{\\parallel, n+1}) = \\Phi_{\\mathcal{D}}^{\\Delta t/2} \\circ \\Phi_{\\mathcal{P}}^{\\Delta t} \\circ \\Phi_{\\mathcal{D}}^{\\Delta t/2} (\\mathbf{x}_n, v_{\\parallel, n})\n$$\n其中 $\\Phi^{\\delta t}$ 表示时间步长为 $\\delta t$ 的流算子。我们现在需要为这些算子定义数值近似。\n\n**特定场模型的分析：**\n对于给定的场，$\\mathbf{E}=\\mathbf{0}$，$\\mathbf{B}(\\mathbf{x}) = B_{0}\\,(1 + \\alpha\\,x + \\beta\\,z)\\,\\hat{\\mathbf{z}}$，我们有：\n- 磁场单位矢量是恒定的：$\\hat{\\mathbf{b}} = \\hat{\\mathbf{z}}$。\n- 磁场大小为 $\\|\\mathbf{B}\\| = B_0(1+\\alpha x + \\beta z)$。\n- 大小的梯度是恒定的：$\\nabla\\|\\mathbf{B}\\| = B_0(\\alpha, 0, \\beta)$。\n- 平行加速度是恒定的：$A_{\\parallel} = -\\frac{\\mu_0}{m}\\,\\hat{\\mathbf{z}}\\cdot (B_0(\\alpha, 0, \\beta)) = -\\frac{\\mu_0 B_0 \\beta}{m}$。\n- 唯一的非零漂移是 $\\nabla B$ 漂移，因为 $\\mathbf{v}_E=0$：\n$$\n\\mathbf{v}_d = \\mathbf{v}_{\\nabla B} = \\frac{\\mu_0}{q} \\frac{\\hat{\\mathbf{z}} \\times B_0(\\alpha, 0, \\beta)}{B_0^2(1+\\alpha x + \\beta z)^2} = \\frac{\\mu_0 \\alpha}{q B_0 (1+\\alpha x + \\beta z)^2} \\hat{\\mathbf{y}}\n$$\n漂移速度纯粹在 $\\hat{\\mathbf{y}}$ 方向，并依赖于位置坐标 $x$ 和 $z$。\n\n**算子的离散化：**\n基于这些简化，我们设计数值步骤：\n\n1.  **算子 $\\Phi_{\\mathcal{D}}^{\\delta t}$ (漂移步):** 我们求解 $\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}_d(\\mathbf{x})$。一个简单的显式欧拉步是 $\\mathbf{x}(t+\\delta t) = \\mathbf{x}(t) + \\mathbf{v}_d(\\mathbf{x}(t)) \\delta t$。这是一阶的，但在 Strang 分裂中的对称组合恢复了二阶精度。\n\n2.  **算子 $\\Phi_{\\mathcal{P}}^{\\Delta t}$ (平行步):** 该系统为 $\\frac{dv_{\\parallel}}{dt} = A_{\\parallel}$ 和 $\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\hat{\\mathbf{z}}$。由于 $A_{\\parallel}$ 是常数，我们可以在区间 $\\Delta t$ 上精确积分该系统。\n    速度更新为：\n    $$ v_{\\parallel}(t+\\Delta t) = v_{\\parallel}(t) + A_{\\parallel}\\Delta t $$\n    位置更新通过积分得到：\n    $$ z(t+\\Delta t) = z(t) + \\int_{t}^{t+\\Delta t} v_{\\parallel}(\\tau) d\\tau = z(t) + \\int_{t}^{t+\\Delta t} (v_{\\parallel}(t) + A_{\\parallel}(\\tau-t)) d\\tau $$\n    $$ z(t+\\Delta t) = z(t) + v_{\\parallel}(t)\\Delta t + \\frac{1}{2}A_{\\parallel}(\\Delta t)^2 $$\n    这可以表示为时间中心 (Verlet) 形式：\n    $$ z(t+\\Delta t) = z(t) + \\left(v_{\\parallel}(t) + \\frac{A_{\\parallel}\\Delta t}{2}\\right) \\Delta t $$\n\n**完整的更新算法：**\n为了在一个时间步长 $\\Delta t$ 内将状态 $(\\mathbf{x}_n, v_{\\parallel,n})$ 推进到 $(\\mathbf{x}_{n+1}, v_{\\parallel,n+1})$，我们执行以下序列：\n\n1.  **第一个漂移半步 $(\\Phi_{\\mathcal{D}}^{\\Delta t/2})$:**\n    - 计算初始位置的漂移速度：$\\mathbf{v}_{d,n} = \\mathbf{v}_d(\\mathbf{x}_n)$。\n    - 将位置更新到中间状态 $\\mathbf{x}'$：\n      $$ \\mathbf{x}' = \\mathbf{x}_n + \\mathbf{v}_{d,n} \\frac{\\Delta t}{2} $$\n\n2.  **完整平行步 $(\\Phi_{\\mathcal{P}}^{\\Delta t})$:**\n    - 使用时间中心的平行速度将位置从 $\\mathbf{x}'$ 更新到第二个中间状态 $\\mathbf{x}''$：\n      $$ \\mathbf{x}'' = \\mathbf{x}' + \\left(v_{\\parallel,n} + \\frac{A_{\\parallel}\\Delta t}{2}\\right) \\hat{\\mathbf{z}} \\Delta t $$\n    - 更新整个时间步的平行速度：\n      $$ v_{\\parallel,n+1} = v_{\\parallel,n} + A_{\\parallel} \\Delta t $$\n\n3.  **第二个漂移半步 $(\\Phi_{\\mathcal{D}}^{\\Delta t/2})$:**\n    - 计算第二个中间位置 $\\mathbf{x}''$ 的漂移速度：$\\mathbf{v}_{d,n+1} = \\mathbf{v}_d(\\mathbf{x}'')$。\n    - 将位置更新到其最终状态 $\\mathbf{x}_{n+1}$：\n      $$ \\mathbf{x}_{n+1} = \\mathbf{x}'' + \\mathbf{v}_{d,n+1} \\frac{\\Delta t}{2} $$\n\n这为给定的导心系统构成了一个完整的、二阶精度的对称算法。积分执行 $N$ 步，之后使用最终状态 $(\\mathbf{x}_{N}, v_{\\parallel, N})$ 计算指定的相对误差 $\\epsilon_{\\mu}$。导致非零 $\\epsilon_{\\mu}$ 的数值误差源于漂移速度 $\\mathbf{v}_d$ 依赖于位置，并且分裂近似在每个子步中将平行运动和漂移运动视为独立的。预计只有当这两种运动强耦合时（即当 $\\alpha$ 和 $\\beta$ 均不为零时），该误差才会显著。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the relative error in magnetic moment conservation for four\n    guiding-center motion test cases using a derived Boris-like integrator.\n    \"\"\"\n    \n    # Constants\n    q = 1.602176634e-19  # Elementary charge in C\n    m = 1.67262192369e-27 # Proton mass in kg\n\n    # Test case definitions\n    test_cases = [\n        # Case 1: uniform magnetic field, baseline\n        {\n            \"B0\": 3.0, \"alpha\": 0.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 2.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 1.0e-8, \"N\": 1000,\n        },\n        # Case 2: weak x-gradient, moderate time step\n        {\n            \"B0\": 3.0, \"alpha\": 1.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 5.0e-8, \"N\": 2000,\n        },\n        # Case 3: strong x-gradient, large time step, stress test\n        {\n            \"B0\": 3.0, \"alpha\": 10.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 5.0e-7, \"N\": 1000,\n        },\n        # Case 4: combined x- and z-gradient, mirror force active\n        {\n            \"B0\": 3.0, \"alpha\": 1.0, \"beta\": 0.01,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 1.0e-8, \"N\": 3000,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        B0 = case[\"B0\"]\n        alpha = case[\"alpha\"]\n        beta = case[\"beta\"]\n        x = case[\"x0\"].copy()\n        v_parallel = case[\"v_parallel_0\"]\n        mu0 = case[\"mu0\"]\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n\n        def get_B_mag(pos):\n            # B(x) = B0 * (1 + alpha*x + beta*z)\n            return B0 * (1.0 + alpha * pos[0] + beta * pos[2])\n\n        def get_v_drift(pos):\n            # v_d is purely in y-direction for this field model\n            # v_d = (mu/q) * (b_hat x grad|B|) / |B|^2\n            # b_hat x grad|B| = (0, B0*alpha, 0)\n            B_mag_val = get_B_mag(pos)\n            vy_drift = (mu0 * alpha) / (q * B_mag_val**2 / B0)\n            return np.array([0.0, vy_drift, 0.0])\n\n        # Parallel acceleration is constant for this field model\n        A_parallel = -mu0 * B0 * beta / m\n        \n        # Unit vector for parallel motion is constant\n        b_hat = np.array([0.0, 0.0, 1.0])\n\n        # Calculate initial energy for later error calculation\n        B_initial = get_B_mag(case[\"x0\"])\n        W0 = 0.5 * m * case[\"v_parallel_0\"]**2 + mu0 * B_initial\n\n        # Main integration loop\n        for _ in range(N):\n            # 1. First drift half-step\n            v_d_n = get_v_drift(x)\n            x_prime = x + v_d_n * dt / 2.0\n            \n            # 2. Full parallel step (Verlet-style)\n            # Position update uses time-centered parallel velocity\n            v_parallel_centered = v_parallel + A_parallel * dt / 2.0\n            x_double_prime = x_prime + v_parallel_centered * b_hat * dt\n            # Velocity update is for the full step\n            v_parallel = v_parallel + A_parallel * dt\n            \n            # 3. Second drift half-step\n            v_d_n_plus_1 = get_v_drift(x_double_prime)\n            x = x_double_prime + v_d_n_plus_1 * dt / 2.0\n        \n        v_parallel_final = v_parallel\n        x_final = x\n\n        # Calculate effective magnetic moment and relative error\n        B_final = get_B_mag(x_final)\n        \n        # Avoid division by zero if B_final is zero, which is not expected here\n        if B_final == 0:\n            results.append(np.inf)\n            continue\n            \n        mu_eff = (W0 - 0.5 * m * v_parallel_final**2) / B_final\n        \n        # Avoid division by zero if mu0 is zero\n        if mu0 == 0:\n            if mu_eff == 0:\n                results.append(0.0)\n            else:\n                results.append(np.inf)\n        else:\n            epsilon_mu = abs(mu_eff - mu0) / mu0\n            results.append(epsilon_mu)\n\n    # Format and print the final results\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "引导中心模型是一个近似，而任何近似都有其适用范围。这个最终练习将通过与“基准真相”的全轨道模拟进行比较，来直面其局限性。通过实现一个包含有限拉莫半径 (FLR) 修正的更精确的回旋中心模型，你将研究该近似的准确性如何依赖于电磁场的空间尺度，这是将这些模型应用于实际聚变场景中的一个关键概念 。",
            "id": "3987379",
            "problem": "考虑一个电荷量为 $q$、质量为 $m$ 的带电粒子，在匀强磁场 $\\mathbf{B} = B_0 \\,\\hat{\\mathbf{z}}$ 和一个静态二维电场 $\\mathbf{E}(x,y)$ 中运动。粒子动力学由洛伦兹力和运动学关系决定，具体基础包括：$m\\,d\\mathbf{v}/dt = q\\,(\\mathbf{E} + \\mathbf{v}\\times\\mathbf{B})$、$d\\mathbf{r}/dt = \\mathbf{v}$、回旋（陀螺）频率 $\\omega_c = |q|\\,B_0/m$ 和拉莫尔回旋半径 $\\rho = v_\\perp/\\omega_c$，其中 $v_\\perp$ 是垂直于 $\\mathbf{B}$ 的速度分量的大小。您将对比一个包含有限拉莫尔半径（FLR）修正的陀螺中心积分器和一个全轨道积分器在剪切电场中的表现，并量化其差异随电场变化的垂直波数 $k_\\perp$ 与拉莫尔半径 $\\rho$ 的乘积 $k_\\perp \\rho$ 的变化情况。缩写 FLR 必须理解为有限拉莫尔半径（Finite Larmor Radius, FLR）。\n\n定义电场由 $x$ 方向的线性剪切和 $y$ 方向的正弦变化组成：\n$$\n\\mathbf{E}(x,y) = \\big(S\\,x,\\; E_1\\,\\sin(k\\,y),\\; 0\\big),\n$$\n其中 $S$ 是一个恒定的剪切系数，$E_1$ 是一个恒定的振幅，$k$ 是垂直波数。磁场为 $\\mathbf{B} = (0,0,B_0)$，其中 $B_0$ 为常数。\n\n实现以下两种积分器：\n\n- 全轨道积分器：数值求解耦合常微分方程 $d\\mathbf{r}/dt = \\mathbf{v}$ 和 $m\\,d\\mathbf{v}/dt = q\\,(\\mathbf{E}(\\mathbf{r}) + \\mathbf{v}\\times\\mathbf{B})$。根据全轨道解，通过标准关系式 $\\boldsymbol{\\rho}(t) = \\mathbf{v}_\\perp(t)\\times\\hat{\\mathbf{z}}/\\omega_c$ 和 $\\mathbf{R}(t) = \\mathbf{r}(t) - \\boldsymbol{\\rho}(t)$ 定义瞬时导心位置 $\\mathbf{R}(t)$，其中 $\\mathbf{v}_\\perp(t)$ 是垂直于 $\\mathbf{B}$ 的速度分量。计算时间平均的导心漂移速度，即在指定时长 $T$ 内的有限时间平均值 $\\mathbf{V}_{\\text{full}} = \\big(\\mathbf{R}(T) - \\mathbf{R}(0)\\big)/T$。\n\n- 包含有限拉莫尔半径（FLR）修正的陀螺中心积分器：在静态场中使用导心近似来演化陀螺中心位置 $\\mathbf{R}_{\\text{gc}}(t)=(X(t),Y(t))$，并对垂直波数为 $k$ 的静电场中 $y$ 方向的正弦变化部分进行 FLR 修正。对于剪切分量 $S\\,x$，不进行 FLR 修正（视为大尺度）。陀螺中心方程必须从第一性原理推导并实现，以产生时间平均的漂移速度 $\\mathbf{V}_{\\text{gc}} = \\big(\\mathbf{R}_{\\text{gc}}(T) - \\mathbf{R}_{\\text{gc}}(0)\\big)/T$。初始导心位置必须通过 $\\mathbf{R}(0) = \\mathbf{r}(0) - \\boldsymbol{\\rho}(0)$ 与全轨道初始条件保持一致，并且有限拉莫尔半径修正的应用方式必须适用于空间变化由 $k$ 表征的静态静电场。\n\n通过时间平均漂移速度之差的模长来量化两种积分器之间的差异，单位为米/秒：\n$$\n\\Delta = \\left\\|\\mathbf{V}_{\\text{full}} - \\mathbf{V}_{\\text{gc}}\\right\\| \\quad \\text{(单位：m/s)}。\n$$\n您必须以弧度表示所有角度。所有数值答案必须以米/秒（m/s）为单位，并四舍五入到六位小数。\n\n两种积分器均使用显式固定步长的四阶龙格－库塔方案。选择总积分时间 $T$ 为 $N_{\\text{gyro}}$ 个回旋周期，其中回旋周期为 $T_c = 2\\pi/\\omega_c$，并选择时间步长为 $T_c/100$。假设初始垂直速率 $v_{\\perp 0}$ 和初始回旋相位 $\\varphi_0$（以弧度为单位）使得初始速度为 $(v_x(0),v_y(0)) = \\big(v_{\\perp 0}\\cos\\varphi_0,\\; v_{\\perp 0}\\sin\\varphi_0\\big)$，初始位置为 $\\mathbf{r}(0)=(0,0)$。\n\n测试套件：\n您必须为以下参数集运行程序（每个元组列出 $(q, m, B_0, E_1, S, v_{\\perp 0}, k, \\varphi_0, N_{\\text{gyro}})$）：\n- 情况A（理想情况，小 $k_\\perp\\rho$）：$(q = 1.602\\times 10^{-19}\\,\\text{C},\\; m = 3.344\\times 10^{-27}\\,\\text{kg},\\; B_0 = 3.0\\,\\text{T},\\; E_1 = 1000.0\\,\\text{V/m},\\; S = 1.0\\times 10^{4}\\,\\text{V/m}^2,\\; v_{\\perp 0} = 1.0\\times 10^{5}\\,\\text{m/s},\\; k = 150.0\\,\\text{m}^{-1},\\; \\varphi_0 = \\pi/3,\\; N_{\\text{gyro}} = 200)$。\n\n- 情况B（中等 $k_\\perp\\rho$）：$(q = 1.602\\times 10^{-19}\\,\\text{C},\\; m = 3.344\\times 10^{-27}\\,\\text{kg},\\; B_0 = 3.0\\,\\text{T},\\; E_1 = 1000.0\\,\\text{V/m},\\; S = 1.0\\times 10^{4}\\,\\text{V/m}^2,\\; v_{\\perp 0} = 1.0\\times 10^{5}\\,\\text{m/s},\\; k = 1500.0\\,\\text{m}^{-1},\\; \\varphi_0 = \\pi/3,\\; N_{\\text{gyro}} = 200)$。\n\n- 情况C（大 $k_\\perp\\rho$）：$(q = 1.602\\times 10^{-19}\\,\\text{C},\\; m = 3.344\\times 10^{-27}\\,\\text{kg},\\; B_0 = 3.0\\,\\text{T},\\; E_1 = 1000.0\\,\\text{V/m},\\; S = 1.0\\times 10^{4}\\,\\text{V/m}^2,\\; v_{\\perp 0} = 1.0\\times 10^{5}\\,\\text{m/s},\\; k = 4500.0\\,\\text{m}^{-1},\\; \\varphi_0 = \\pi/3,\\; N_{\\text{gyro}} = 200)$。\n\n- 情况D（边界情况，无波动，因此 $E_1=0$）：$(q = 1.602\\times 10^{-19}\\,\\text{C},\\; m = 3.344\\times 10^{-27}\\,\\text{kg},\\; B_0 = 3.0\\,\\text{T},\\; E_1 = 0.0\\,\\text{V/m},\\; S = 1.0\\times 10^{4}\\,\\text{V/m}^2,\\; v_{\\perp 0} = 1.0\\times 10^{5}\\,\\text{m/s},\\; k = 1500.0\\,\\text{m}^{-1},\\; \\varphi_0 = \\pi/3,\\; N_{\\text{gyro}} = 200)$。\n\n对于每种情况，计算如上定义的标量差异 $\\Delta$（单位为 $\\text{m/s}$）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[d_A,d_B,d_C,d_D]$），每个条目都按要求四舍五入到六位小数并以 $\\text{m/s}$ 表示。",
            "solution": "该问题是有效的，因为它在科学上基于经典粒子动力学和等离子体物理学，其参数和初始条件完整且一致，问题本身是适定的，并且表述客观。我们的任务是量化全轨道粒子模拟与一个包含有限拉莫尔半径（FLR）修正的简化陀螺中心模型之间的差异。该差异通过每种模型计算出的时间平均导心漂移速度之差的模长来衡量。\n\n分析过程首先定义每种模型的运动方程，然后详细说明数值积分方案，最后描述差异度量的计算方法。数值积分使用四阶龙格－库塔（RK4）方法。\n\n**1. 全轨道模型**\n\n带电粒子的运动由洛伦兹力决定。在任意时刻 $t$，粒子的状态可由其位置 $\\mathbf{r}(t) = (x(t), y(t))$ 和速度 $\\mathbf{v}(t) = (v_x(t), v_y(t))$ 描述，因为场和初始速度没有 $z$ 分量。运动方程是一个耦合的一阶常微分方程（ODE）组：\n$$\n\\frac{d\\mathbf{r}}{dt} = \\mathbf{v}\n$$\n$$\n\\frac{d\\mathbf{v}}{dt} = \\frac{q}{m}(\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B})\n$$\n给定场 $\\mathbf{E} = (S\\,x, E_1\\,\\sin(k\\,y), 0)$ 和 $\\mathbf{B} = (0, 0, B_0)$，加速度的矢量分量为：\n$$\n\\frac{dv_x}{dt} = \\frac{q}{m}(S\\,x + v_y B_0)\n$$\n$$\n\\frac{dv_y}{dt} = \\frac{q}{m}(E_1\\,\\sin(k\\,y) - v_x B_0)\n$$\nRK4积分器的状态向量为 $\\mathbf{y}_{\\text{fo}}(t) = (x(t), y(t), v_x(t), v_y(t))$。初始条件为 $\\mathbf{r}(0) = (0,0)$ 和 $\\mathbf{v}(0) = (v_{\\perp 0}\\cos\\varphi_0, v_{\\perp 0}\\sin\\varphi_0)$。\n\n**2. 带FLR修正的陀螺中心模型**\n\n陀螺中心近似将快速的回旋运动与较慢的导心漂移分离开来。导心速度 $\\mathbf{V}_{\\text{gc}}$ 主要由 $\\mathbf{E}\\times\\mathbf{B}$ 漂移驱动，其中电场是在粒子的回旋轨道上进行平均的。这个平均过程引入了FLR修正。陀螺中心速度由下式给出：\n$$\n\\mathbf{V}_{\\text{gc}} = \\frac{d\\mathbf{R}_{\\text{gc}}}{dt} = \\frac{\\langle\\mathbf{E}\\rangle \\times \\mathbf{B}}{B_0^2}\n$$\n其中 $\\mathbf{R}_{\\text{gc}}(t) = (X(t), Y(t))$ 是陀螺中心位置，$\\langle\\mathbf{E}\\rangle$ 是回旋平均电场。粒子位置 $\\mathbf{r}$ 表示为 $\\mathbf{r} = \\mathbf{R}_{\\text{gc}} + \\boldsymbol{\\rho}$，其中 $\\boldsymbol{\\rho}$ 是回旋半径矢量。一个量 $f(\\mathbf{r})$ 的回旋平均为 $\\langle f \\rangle = \\frac{1}{2\\pi}\\int_0^{2\\pi} f(\\mathbf{R}_{\\text{gc}} + \\boldsymbol{\\rho}(\\alpha))\\,d\\alpha$，其中 $\\alpha$ 是回旋角。\n\n回旋平均电场的分量为：\n- 对于 $x$ 分量，其在 $x$ 上是线性的，平均是精确的：\n$$\n\\langle E_x \\rangle = \\langle S\\,x \\rangle = \\langle S\\,(X + \\rho_x) \\rangle = S\\,X + S\\,\\langle \\rho_x \\rangle = S\\,X\n$$\n因为 $\\langle \\rho_x \\rangle = 0$。\n- 对于 $y$ 分量，场在 $y = Y + \\rho_y$ 处求值。平均值为：\n$$\n\\langle E_y \\rangle = \\langle E_1 \\sin(k(Y + \\rho_y)) \\rangle = E_1 \\langle \\sin(kY)\\cos(k\\rho_y) + \\cos(kY)\\sin(k\\rho_y) \\rangle\n$$\n使用涉及回旋角的三角函数平均恒等式 $\\langle \\cos(k\\rho\\cos\\alpha) \\rangle = J_0(k\\rho)$ 和 $\\langle \\sin(k\\rho\\cos\\alpha) \\rangle = 0$，其中 $J_0$ 是第一类零阶贝塞尔函数，$\\rho = v_\\perp/\\omega_c$ 是拉莫尔半径，我们得到：\n$$\n\\langle E_y \\rangle = E_1 \\sin(kY) J_0(k\\rho)\n$$\n因子 $J_0(k\\rho)$ 就是FLR修正。在这个简化模型中，我们假设在匀强磁场中磁矩是守恒的，这意味着 $v_\\perp$ 是常数。因此，我们使用初始拉莫尔半径 $\\rho_0 = v_{\\perp 0}/\\omega_c$ 作为常数。\n\n最终得到的陀螺中心位置 $\\mathbf{R}_{\\text{gc}} = (X, Y)$ 的ODE系统为：\n$$\n\\frac{dX}{dt} = \\frac{1}{B_0} \\langle E_y \\rangle = \\frac{E_1}{B_0} \\sin(kY) J_0(k\\rho_0)\n$$\n$$\n\\frac{dY}{dt} = -\\frac{1}{B_0} \\langle E_x \\rangle = -\\frac{S}{B_0} X\n$$\nRK4积分器的状态向量为 $\\mathbf{y}_{\\text{gc}}(t) = (X(t), Y(t))$。\n\n**3. 数值实现与差异计算**\n\n两个ODE系统都在总时间 $T = N_{\\text{gyro}} T_c$ 内进行积分，使用固定时间步长 $dt = T_c/100$，其中 $T_c = 2\\pi/\\omega_c$ 是回旋周期，$\\omega_c = |q|B_0/m$。\n\n- **初始条件**：\n初始粒子位置和速度为 $\\mathbf{r}(0) = (0,0)$ 和 $\\mathbf{v}(0) = (v_{\\perp 0}\\cos\\varphi_0, v_{\\perp 0}\\sin\\varphi_0)$。为了确保一致的起点，两种模型都需要初始导心位置 $\\mathbf{R}(0)$。它是根据初始粒子状态，使用定义 $\\mathbf{R}(t) = \\mathbf{r}(t) - \\boldsymbol{\\rho}(t)$ 计算的，其中 $\\boldsymbol{\\rho}(t) = \\mathbf{v}_\\perp(t)\\times\\hat{\\mathbf{z}}/\\omega_c = (v_y(t)/\\omega_c, -v_x(t)/\\omega_c)$。\n$$\n\\mathbf{R}(0) = \\mathbf{r}(0) - \\boldsymbol{\\rho}(0) = (0,0) - (v_y(0)/\\omega_c, -v_x(0)/\\omega_c) = (-v_{\\perp 0}\\sin\\varphi_0/\\omega_c, v_{\\perp 0}\\cos\\varphi_0/\\omega_c)\n$$\n这个 $\\mathbf{R}(0)$ 作为陀螺中心积分器的初始条件，即 $\\mathbf{R}_{\\text{gc}}(0) = \\mathbf{R}(0)$。\n\n- **时间平均速度**：\n在最终时刻 $T$，全轨道模拟得到粒子状态 $(\\mathbf{r}(T), \\mathbf{v}(T))$。由此计算出最终的导心位置：$\\mathbf{R}(T) = \\mathbf{r}(T) - \\mathbf{v}_\\perp(T)\\times\\hat{\\mathbf{z}}/\\omega_c$。然后，时间平均的漂移速度为：\n$$\n\\mathbf{V}_{\\text{full}} = \\frac{\\mathbf{R}(T) - \\mathbf{R}(0)}{T}\n$$\n陀螺中心模拟直接得到最终的陀螺中心位置 $\\mathbf{R}_{\\text{gc}}(T)$。相应的时间平均速度为：\n$$\n\\mathbf{V}_{\\text{gc}} = \\frac{\\mathbf{R}_{\\text{gc}}(T) - \\mathbf{R}_{\\text{gc}}(0)}{T}\n$$\n\n- **差异**：\n差异 $\\Delta$ 计算为这两个平均速度之差的欧几里得范数：\n$$\n\\Delta = \\left\\| \\mathbf{V}_{\\text{full}} - \\mathbf{V}_{\\text{gc}} \\right\\|\n$$\n\n所提供的代码为测试套件中的每个参数集实现了这些步骤，计算并报告标量差异 $\\Delta$，单位为 m/s，四舍五入到六位小数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import j0\n\ndef solve():\n    \"\"\"\n    Computes the discrepancy between a full-orbit and a gyrocenter particle integrator.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains: (q, m, B0, E1, S, v_perp0, k, phi0, N_gyro)\n    test_cases = [\n        (1.602e-19, 3.344e-27, 3.0, 1000.0, 1.0e4, 1.0e5, 150.0, np.pi / 3, 200),\n        (1.602e-19, 3.344e-27, 3.0, 1000.0, 1.0e4, 1.0e5, 1500.0, np.pi / 3, 200),\n        (1.602e-19, 3.344e-27, 3.0, 1000.0, 1.0e4, 1.0e5, 4500.0, np.pi / 3, 200),\n        (1.602e-19, 3.344e-27, 3.0, 0.0, 1.0e4, 1.0e5, 1500.0, np.pi / 3, 200),\n    ]\n\n    results = []\n    for params in test_cases:\n        q, m, B0, E1, S, v_perp0, k, phi0, N_gyro = params\n\n        # Derived physical quantities. For q  0, |q| = q.\n        omega_c = q * B0 / m\n        T_c = 2.0 * np.pi / omega_c\n\n        # Integration parameters\n        T = N_gyro * T_c\n        dt = T_c / 100.0\n        n_steps = int(round(T / dt))\n\n        def rk4_step(f, y, t, dt, *args):\n            \"\"\"A single step of the 4th-order Runge-Kutta method.\"\"\"\n            k1 = f(y, t, *args)\n            k2 = f(y + 0.5 * dt * k1, t + 0.5 * dt, *args)\n            k3 = f(y + 0.5 * dt * k2, t + 0.5 * dt, *args)\n            k4 = f(y + dt * k3, t + dt, *args)\n            return y + (dt / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\n        # --- Full-orbit integrator ---\n        def full_orbit_derivs(y, t, q, m, B0, E1, S, k):\n            \"\"\"ODEs for the full-orbit model: d/dt([x, y, vx, vy]).\"\"\"\n            x, y, vx, vy = y\n            ax = (q / m) * (S * x + vy * B0)\n            ay = (q / m) * (E1 * np.sin(k * y) - vx * B0)\n            return np.array([vx, vy, ax, ay])\n\n        # Initial conditions for full-orbit\n        r0 = np.array([0.0, 0.0])\n        v0 = np.array([v_perp0 * np.cos(phi0), v_perp0 * np.sin(phi0)])\n        y_fo = np.concatenate((r0, v0))\n\n        # Calculate initial guiding-center position R(0)\n        # rho(t) = v_perp(t) x z_hat / omega_c = [vy/omega_c, -vx/omega_c]\n        rho_vec_0 = np.array([v0[1] / omega_c, -v0[0] / omega_c])\n        R0_full = r0 - rho_vec_0\n\n        # Run full-orbit simulation\n        time = 0.0\n        current_y_fo = y_fo.copy()\n        for _ in range(n_steps):\n            current_y_fo = rk4_step(full_orbit_derivs, current_y_fo, time, dt, q, m, B0, E1, S, k)\n            time += dt\n        \n        rT_fo = current_y_fo[:2]\n        vT_fo = current_y_fo[2:]\n        \n        # Calculate final guiding-center position R(T)\n        rho_vec_T = np.array([vT_fo[1] / omega_c, -vT_fo[0] / omega_c])\n        RT_full = rT_fo - rho_vec_T\n        \n        V_full = (RT_full - R0_full) / T\n\n        # --- Gyrocenter integrator ---\n        rho0 = v_perp0 / omega_c\n\n        def gyro_center_derivs(Y_gc, t, B0, E1, S, k, rho0):\n            \"\"\"ODEs for the gyrocenter model: d/dt([X, Y]).\"\"\"\n            X, Y = Y_gc\n            J0_k_rho = j0(k * rho0)\n            Vx = (E1 / B0) * np.sin(k * Y) * J0_k_rho\n            Vy = (-S / B0) * X\n            return np.array([Vx, Vy])\n\n        # Initial conditions for gyrocenter are consistent with full-orbit\n        y_gc = R0_full.copy()\n        R0_gc = y_gc.copy()\n\n        # Run gyrocenter simulation\n        time = 0.0\n        current_y_gc = y_gc.copy()\n        for _ in range(n_steps):\n            current_y_gc = rk4_step(gyro_center_derivs, current_y_gc, time, dt, B0, E1, S, k, rho0)\n            time += dt\n\n        RT_gc = current_y_gc\n        \n        V_gc = (RT_gc - R0_gc) / T\n        \n        # --- Discrepancy calculation ---\n        delta_V = V_full - V_gc\n        discrepancy = np.sqrt(delta_V[0]**2 + delta_V[1]**2)\n        results.append(f\"{discrepancy:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}