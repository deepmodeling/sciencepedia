{
    "hands_on_practices": [
        {
            "introduction": "Electron Cyclotron Resonance Heating (ECRH) is a cornerstone of modern fusion research, but its efficiency hinges on the wave's interaction with plasma, which is exquisitely sensitive to the local magnetic field. This practice delves into the heart of this sensitivity by examining the right-hand circularly polarized wave, the workhorse of ECRH. By analytically deriving the sensitivity of the refractive index to changes in the magnetic field , you will gain a concrete understanding of the resonant behavior that makes ECRH both powerful and challenging to implement.",
            "id": "4064584",
            "problem": "In a high-temperature magnetized fusion plasma relevant to electron cyclotron resonance heating (ECRH), consider a cold, collisionless electron-ion plasma with a uniform background magnetic field $\\mathbf{B}_0$ and electron number density $n_{\\mathrm{e}}$. A plane electromagnetic wave of angular frequency $\\omega$ propagates parallel to $\\mathbf{B}_0$. Assume the ion response is negligible in the electron cyclotron frequency range and that the cold-plasma approximation applies.\n\nStarting from Maxwellâ€™s equations and the cold-plasma constitutive relations, the parallel-propagating electromagnetic modes decompose into right-hand and left-hand circularly polarized waves. The right-hand circularly polarized mode (the one that resonates at the electron cyclotron frequency) has a refractive index squared $n^2$ that can be expressed in terms of the dimensionless parameters $X \\equiv \\omega_{pe}^2/\\omega^2$ and $Y \\equiv \\Omega_{e}/\\omega$, where $\\omega_{pe} \\equiv \\sqrt{n_{\\mathrm{e}} e^2/(\\varepsilon_0 m_e)}$ is the electron plasma frequency and $\\Omega_{e} \\equiv e B_0/m_e$ is the electron cyclotron frequency. Using the well-tested cold-plasma dispersion for the right-hand circularly polarized branch corresponding to parallel propagation, derive an analytic expression for the sensitivity of $n^2$ to small changes in $B_0$ near the electron cyclotron resonance by computing the partial derivative $\\partial n^2/\\partial \\Omega_{e}$ at fixed $\\omega$ and $n_{\\mathrm{e}}$.\n\nExpress your final result as a closed-form symbolic expression in terms of $X$, $Y$, and $\\omega$. Report $\\partial n^2/\\partial \\Omega_{e}$ in units of seconds. The final answer must be a single closed-form expression.",
            "solution": "The problem asks for the sensitivity of the refractive index squared, $n^2$, of the right-hand circularly polarized (R-wave) electromagnetic mode to small changes in the background magnetic field $B_0$, quantified by the partial derivative $\\partial n^2/\\partial \\Omega_e$. The propagation is parallel to the magnetic field in a cold, collisionless electron-ion plasma.\n\nFirst, we must validate the problem statement.\nThe givens are:\n- A cold, collisionless electron-ion plasma.\n- A uniform background magnetic field $\\mathbf{B}_0$.\n- Electron number density $n_{\\mathrm{e}}$.\n- A plane electromagnetic wave with angular frequency $\\omega$ propagating parallel to $\\mathbf{B}_0$.\n- The ion response is negligible.\n- The cold-plasma approximation is applicable.\n- The mode of interest is the right-hand circularly polarized (R-wave), defined as the mode that resonates at the electron cyclotron frequency, $\\Omega_e$.\n- Dimensionless parameters: $X \\equiv \\omega_{pe}^2/\\omega^2$ and $Y \\equiv \\Omega_{e}/\\omega$.\n- Definitions: electron plasma frequency $\\omega_{pe} \\equiv \\sqrt{n_{\\mathrm{e}} e^2/(\\varepsilon_0 m_e)}$ and electron cyclotron frequency $\\Omega_{e} \\equiv e B_0/m_e$.\n- The task is to compute $\\partial n^2/\\partial \\Omega_{e}$ at fixed $\\omega$ and $n_{\\mathrm{e}}$, expressing the result in terms of $X$, $Y$, and $\\omega$.\n\nValidation:\nThe problem is scientifically grounded in the established theory of wave propagation in plasmas, a core topic in plasma physics and fusion science. The concepts and approximations (cold plasma, negligible ion response, parallel propagation) are standard idealizations used to derive fundamental wave properties. The problem is well-posed, asking for a specific derivative of a well-defined physical quantity. The language is objective and precise. All required physical quantities and relationships are either provided or are standard, well-known results in the field (e.g., the cold-plasma dispersion relation). The request for units of seconds for the derivative $\\partial n^2/\\partial \\Omega_{e}$ is physically consistent, as $n^2$ is dimensionless and $\\Omega_e$ has units of inverse seconds ($s^{-1}$). The problem is therefore valid.\n\nSolution:\nThe dispersion relation for electromagnetic waves in a magnetized plasma is derived from Maxwell's equations and the plasma's constitutive relation, which is described by the dielectric tensor $\\boldsymbol{\\varepsilon}$. For a cold plasma with a magnetic field $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$ and neglecting ion motion, the dielectric tensor components relevant for propagation parallel to $\\mathbf{B}_0$ lead to two distinct modes, the left-hand (L) and right-hand (R) circularly polarized waves. Their refractive indices squared, $n_{L,R}^2$, are given by:\n$$n_{L,R}^2 = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega \\pm \\Omega_e)}$$\nThe problem specifies the right-hand circularly polarized mode as \"the one that resonates at the electron cyclotron frequency,\" which occurs when the wave frequency $\\omega$ matches the electron gyrofrequency $\\Omega_e$. A resonance corresponds to the refractive index becoming infinite, which requires the denominator of the fractional term to approach zero. This occurs for the expression:\n$$n^2 = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega - \\Omega_e)}$$\nThis is the dispersion relation for the mode of interest, as defined in the problem. The resonance is clearly visible at $\\omega = \\Omega_e$.\n\nWe are asked to express the result in terms of the dimensionless parameters $X$ and $Y$. We can rewrite the expression for $n^2$ using these parameters:\n$$n^2 = 1 - \\frac{\\omega_{pe}^2/\\omega^2}{1 - \\Omega_e/\\omega}$$\nSubstituting $X = \\omega_{pe}^2/\\omega^2$ and $Y = \\Omega_e/\\omega$, we obtain a compact form for the refractive index squared:\n$$n^2 = 1 - \\frac{X}{1-Y}$$\nThe task is to compute the partial derivative $\\partial n^2 / \\partial \\Omega_e$ while holding $\\omega$ and $n_{\\mathrm{e}}$ constant. Since $n_{\\mathrm{e}}$ is constant, $\\omega_{pe}$ is constant. Since $\\omega$ is also constant, the parameter $X$ is constant with respect to the differentiation. The parameter $Y$, however, depends linearly on $\\Omega_e$.\n$$Y = \\frac{\\Omega_e}{\\omega}$$\nWe can use the chain rule to compute the derivative:\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = \\frac{\\partial n^2}{\\partial Y} \\frac{\\partial Y}{\\partial \\Omega_e}$$\nFirst, we compute the derivative of $n^2$ with respect to $Y$:\n$$\\frac{\\partial n^2}{\\partial Y} = \\frac{\\partial}{\\partial Y} \\left( 1 - \\frac{X}{1-Y} \\right) = \\frac{\\partial}{\\partial Y} \\left( 1 - X(1-Y)^{-1} \\right)$$\nApplying the power rule and chain rule for differentiation:\n$$\\frac{\\partial n^2}{\\partial Y} = -X \\cdot \\left(-1 \\cdot (1-Y)^{-2} \\cdot \\frac{\\partial(1-Y)}{\\partial Y} \\right)$$\n$$\\frac{\\partial n^2}{\\partial Y} = -X \\cdot \\left(-1 \\cdot (1-Y)^{-2} \\cdot (-1) \\right) = -X (1-Y)^{-2}$$\n$$\\frac{\\partial n^2}{\\partial Y} = -\\frac{X}{(1-Y)^2}$$\nNext, we compute the derivative of $Y$ with respect to $\\Omega_e$:\n$$\\frac{\\partial Y}{\\partial \\Omega_e} = \\frac{\\partial}{\\partial \\Omega_e} \\left( \\frac{\\Omega_e}{\\omega} \\right) = \\frac{1}{\\omega}$$\nFinally, we multiply the two results to obtain the desired partial derivative:\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = \\left( -\\frac{X}{(1-Y)^2} \\right) \\cdot \\left( \\frac{1}{\\omega} \\right)$$\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = -\\frac{X}{\\omega(1-Y)^2}$$\nThis expression gives the sensitivity of $n^2$ to changes in the electron cyclotron frequency $\\Omega_e$ (and thus to the magnetic field $B_0$) in terms of the fundamental dimensionless parameters $X$ and $Y$ and the wave frequency $\\omega$. As required, the units of this expression are seconds ($s$), since $X$ and $Y$ are dimensionless and $\\omega$ has units of $s^{-1}$.",
            "answer": "$$\\boxed{-\\frac{X}{\\omega(1-Y)^{2}}}$$"
        },
        {
            "introduction": "Analytical expressions for the refractive index are often limited to special cases, like propagation exactly parallel or perpendicular to the magnetic field. To get the full picture, we must turn to computation to map out the complete solution space of the dispersion relation. This exercise guides you through the process of building a numerical tool to construct the refractive index surfaces from the fundamental cold-plasma dielectric tensor . Mastering this practice is a crucial first step toward developing sophisticated wave propagation codes used in fusion research.",
            "id": "4064599",
            "problem": "You are tasked with constructing refractive-index surfaces ($n$-surfaces) for plane electromagnetic waves in a cold, magnetized, quasi-neutral fusion plasma by numerically sampling the dispersion condition over propagation directions. Begin from the macroscopic electromagnetic field equations and plane-wave ansatz. Consider a homogeneous, static magnetic field $\\boldsymbol{B}_0$ aligned with the $\\hat{\\boldsymbol{z}}$ axis, and adopt the cold plasma model with electrons and a single ion species. Work in the International System of Units (SI), assume collisionless response, and treat the dielectric response tensor as frequency-dependent but spatially uniform.\n\nFundamental base to start from:\n- Maxwell's equations in matter, and the plane-wave ansatz $\\boldsymbol{E}(\\boldsymbol{r},t) = \\Re\\{\\boldsymbol{E}_0 e^{i(\\boldsymbol{k}\\cdot\\boldsymbol{r}-\\omega t)}\\}$.\n- The source-free wave equation in a dispersive medium $\\nabla \\times \\nabla \\times \\boldsymbol{E} - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega) \\cdot \\boldsymbol{E} = \\boldsymbol{0}$.\n- The definition of the dimensionless refractive-index vector $\\boldsymbol{N} = \\dfrac{c\\,\\boldsymbol{k}}{\\omega}$, where $c = (\\mu_0 \\epsilon_0)^{-1/2}$.\n\nFrom this base, the plane-wave condition yields a $3 \\times 3$ dispersion tensor $\\mathbf{K}(\\boldsymbol{N},\\omega)$ whose determinant must vanish for nontrivial $\\boldsymbol{E}_0$. For a fixed propagation direction $\\hat{\\boldsymbol{k}}$ and fixed angular frequency $\\omega$, the scalar refractive index $n = \\|\\boldsymbol{N}\\|$ solves $\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = 0$. The goal is to computationally construct the $n$-surfaces by sampling directions $\\hat{\\boldsymbol{k}}$ and extracting all real, positive roots for $n$.\n\nYour tasks:\n1. Derive, from the stated base, a computationally implementable form of the dispersion tensor $\\mathbf{K}(\\boldsymbol{N},\\omega)$ for the cold, magnetized plasma, explicitly identifying how the dielectric tensor $\\boldsymbol{\\varepsilon}(\\omega)$ depends on species parameters. Clearly argue why $\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)$ is real-valued for collisionless plasma at real $\\omega$ and real $n$.\n2. Design an algorithm that, given $\\hat{\\boldsymbol{k}}$, $\\omega$, background magnetic field magnitude $B_0$, and species data (density, charge, and mass), samples the scalar $n$ along the given direction and robustly extracts all real, positive roots of $\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)=0$. Your algorithm must address bracketing and root isolation in the presence of resonant features.\n3. Implement the algorithm as a complete, runnable program that produces outputs for the provided test suite. The program must require no input and must only print the final results.\n\nModel assumptions and definitions to use in your derivation and program:\n- The background magnetic field is $\\boldsymbol{B}_0 = B_0 \\hat{\\boldsymbol{z}}$.\n- The cold-plasma dielectric tensor in the $\\{\\hat{\\boldsymbol{x}},\\hat{\\boldsymbol{y}},\\hat{\\boldsymbol{z}}\\}$ basis aligned with $\\boldsymbol{B}_0$ is of the Stix form\n$$\n\\boldsymbol{\\varepsilon} = \n\\begin{pmatrix}\nS  -i D  0 \\\\\ni D  S  0 \\\\\n0  0  P\n\\end{pmatrix},\n$$\nwhere, for species index $s$ with charge $q_s$, mass $m_s$, number density $n_s$, plasma frequency $\\omega_{p s}^2 = \\dfrac{n_s q_s^2}{\\epsilon_0 m_s}$, and cyclotron frequency $\\Omega_s = \\dfrac{q_s B_0}{m_s}$,\n$$\nS = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nD = \\sum_s \\frac{\\Omega_s}{\\omega} \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nP = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2}.\n$$\n- The dispersion tensor is constructed from the plane-wave operator and dielectric response as\n$$\n\\mathbf{K}(\\boldsymbol{N},\\omega) = \\boldsymbol{N}\\boldsymbol{N} - N^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega),\n$$\nwhere $\\mathbf{I}$ is the $3 \\times 3$ identity and $N^2 = \\boldsymbol{N}\\cdot\\boldsymbol{N}$.\n\nNumerical and output requirements:\n- Physical units: use $B_0$ in $\\mathrm{T}$, species densities $n_s$ in $\\mathrm{m}^{-3}$, angular frequency $\\omega$ in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$, masses in $\\mathrm{kg}$, and charges in $\\mathrm{C}$.\n- Angle unit: specify propagation direction by a polar angle $\\theta$ in radians relative to $\\boldsymbol{B}_0$ (i.e., $\\hat{\\boldsymbol{k}} = (\\sin\\theta,0,\\cos\\theta)$).\n- Express each root $n$ as a float rounded to six decimal places.\n- For each test case, return a list of the real, positive roots $n$ found.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of the found roots, for example, $[\\,[n_{1,1},n_{1,2}],\\,[n_{2,1}],\\,\\ldots\\,]$ rendered as a single line.\n\nTest suite:\nCompute the roots for the following four cases. Use a single ion species with charge number $Z=1$ and mass $m_i = 2 m_p$ (deuterium), where $m_p$ is the proton mass. Assume quasi-neutrality $n_i = n_e$.\n- Case $1$ (happy path): $B_0 = 5.0\\,\\mathrm{T}$, $n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$, $\\theta = 0.0\\,\\mathrm{rad}$.\n- Case $2$ (oblique): $B_0 = 5.0\\,\\mathrm{T}$, $n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$, $\\theta = \\dfrac{\\pi}{4}\\,\\mathrm{rad}$.\n- Case $3$ (perpendicular): $B_0 = 5.0\\,\\mathrm{T}$, $n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$, $\\theta = \\dfrac{\\pi}{2}\\,\\mathrm{rad}$.\n- Case $4$ (near cutoff edge case): $B_0 = 5.0\\,\\mathrm{T}$, $n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $\\omega = 4.20\\times 10^{11}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$, $\\theta = \\dfrac{\\pi}{3}\\,\\mathrm{rad}$.\n\nYour program must implement a systematic sampling and robust root-finding strategy over $n0$ to extract all distinct real roots for each case, and print the final results in the exact required format as a single line.",
            "solution": "We start from Maxwell's equations in matter and the plane-wave ansatz $\\boldsymbol{E}(\\boldsymbol{r},t) = \\Re\\{\\boldsymbol{E}_0 e^{i(\\boldsymbol{k}\\cdot\\boldsymbol{r}-\\omega t)}\\}$. In a homogeneous, linear, dispersive medium, the source-free wave equation reads\n$$\n\\nabla \\times \\nabla \\times \\boldsymbol{E} - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega) \\cdot \\boldsymbol{E} = \\boldsymbol{0}.\n$$\nApplying $\\nabla \\to i\\boldsymbol{k}$ to the plane wave gives\n$$\n-\\,\\boldsymbol{k} \\times (\\boldsymbol{k} \\times \\boldsymbol{E}_0) - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega)\\cdot \\boldsymbol{E}_0 = \\boldsymbol{0}.\n$$\nUsing the vector identity $\\boldsymbol{a}\\times(\\boldsymbol{b}\\times\\boldsymbol{c}) = \\boldsymbol{b}(\\boldsymbol{a}\\cdot\\boldsymbol{c}) - \\boldsymbol{c}(\\boldsymbol{a}\\cdot\\boldsymbol{b})$ with $\\boldsymbol{a}=\\boldsymbol{k}$, $\\boldsymbol{b}=\\boldsymbol{k}$, $\\boldsymbol{c}=\\boldsymbol{E}_0$ yields\n$$\n\\left[\\boldsymbol{k}\\boldsymbol{k} - k^2 \\mathbf{I} + \\omega^2 \\mu_0 \\epsilon_0\\,\\boldsymbol{\\varepsilon}(\\omega)\\right]\\cdot \\boldsymbol{E}_0 = \\boldsymbol{0}.\n$$\nDefine the dimensionless refractive-index vector $\\boldsymbol{N} = \\dfrac{c\\,\\boldsymbol{k}}{\\omega}$, with $c = (\\mu_0\\epsilon_0)^{-1/2}$. Then $\\boldsymbol{k} = \\dfrac{\\omega}{c} \\boldsymbol{N}$, $k^2 = \\dfrac{\\omega^2}{c^2} N^2$, and $\\boldsymbol{k}\\boldsymbol{k} = \\dfrac{\\omega^2}{c^2} \\boldsymbol{N}\\boldsymbol{N}$. Dividing the operator by $\\dfrac{\\omega^2}{c^2}$, we obtain the dispersion tensor\n$$\n\\mathbf{K}(\\boldsymbol{N},\\omega) = \\boldsymbol{N}\\boldsymbol{N} - N^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega).\n$$\nNontrivial $\\boldsymbol{E}_0$ requires\n$$\n\\det \\mathbf{K}(\\boldsymbol{N},\\omega) = 0.\n$$\nFor a fixed direction $\\hat{\\boldsymbol{k}}$ and fixed $\\omega$, we seek $n = \\|\\boldsymbol{N}\\|$ such that\n$$\n\\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = 0.\n$$\n\nCold plasma dielectric tensor. For a magnetized, collisionless, cold plasma with species $s$ characterized by charge $q_s$, mass $m_s$, number density $n_s$, cyclotron frequency $\\Omega_s = \\dfrac{q_s B_0}{m_s}$, and plasma frequency $\\omega_{p s}^2 = \\dfrac{n_s q_s^2}{\\epsilon_0 m_s}$, the dielectric tensor in the basis aligned with $\\boldsymbol{B}_0 \\parallel \\hat{\\boldsymbol{z}}$ is\n$$\n\\boldsymbol{\\varepsilon}(\\omega) =\n\\begin{pmatrix}\nS  -i D  0 \\\\\ni D  S  0 \\\\\n0  0  P\n\\end{pmatrix},\n$$\nwith Stix parameters\n$$\nS = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nD = \\sum_s \\frac{\\Omega_s}{\\omega} \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nP = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2}.\n$$\nThese are well-tested expressions in the cold plasma model. In the collisionless limit, the dielectric tensor is Hermitian: the off-diagonal elements are purely imaginary and antisymmetric, while the diagonal elements are real. Therefore, $\\boldsymbol{\\varepsilon}(\\omega)$ is Hermitian for real $\\omega$, and $\\mathbf{K}(\\boldsymbol{N},\\omega)$, being the sum of Hermitian matrices $\\boldsymbol{N}\\boldsymbol{N}$ (rank-$1$ projector), $-N^2\\mathbf{I}$ (diagonal real), and $\\boldsymbol{\\varepsilon}$ (Hermitian), is itself Hermitian. A Hermitian matrix has a real determinant. Consequently, for real $n$ and real $\\omega$, $\\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) \\in \\mathbb{R}$, which enables the use of scalar root-finding on the real line.\n\nAlgorithmic design. For each test case with specified $(B_0, n_e, \\omega, \\theta)$ and species set (electrons and deuterium ions with $Z=1$ and $m_i = 2 m_p$, and quasi-neutral $n_i = n_e$), proceed as follows:\n1. Compute species parameters:\n   - Electrons: $q_e = -e$, $m_e$ given, $n_e$ given, $\\Omega_e = \\dfrac{q_e B_0}{m_e}$, $\\omega_{pe}^2 = \\dfrac{n_e q_e^2}{\\epsilon_0 m_e}$.\n   - Ions: $q_i = +e$, $m_i = 2 m_p$, $n_i = n_e$, $\\Omega_i = \\dfrac{q_i B_0}{m_i}$, $\\omega_{pi}^2 = \\dfrac{n_i q_i^2}{\\epsilon_0 m_i}$.\n2. Evaluate the Stix parameters $S$, $D$, and $P$ at the given $\\omega$ using the above sums.\n3. Form $\\boldsymbol{\\varepsilon}(\\omega)$ and choose the propagation direction unit vector $\\hat{\\boldsymbol{k}} = (\\sin\\theta, 0, \\cos\\theta)$.\n4. Define the scalar function $f(n) = \\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)$, with\n   $$\n   \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = (n\\hat{\\boldsymbol{k}})(n\\hat{\\boldsymbol{k}}) - n^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega).\n   $$\n5. Sample $f(n)$ on a sufficiently dense grid over $n \\in (0, n_{\\max}]$ with $n_{\\max}$ chosen large enough to capture expected branches (for the provided parameters, a value such as $n_{\\max}$ on the order of $10$ is adequate). Identify intervals $[n_j, n_{j+1}]$ where $f(n)$ changes sign, which bracket simple real roots by the Intermediate Value Theorem.\n6. Apply a robust bracketing root-finder, such as the Brent method, on each sign-change interval to compute the root $n$. Filter out duplicates by clustering within a small tolerance and discard nonpositive or complex results (the latter will not occur since $f(n)$ is real and bracketing ensures real roots).\n7. Sort the resulting real, positive roots for each case. Round each root to six decimal places for output.\n\nJustification of robustness:\n- The function $f(n)$ is smooth except at resonances in $S$ and $D$ where denominators $\\omega^2 - \\Omega_s^2$ vanish; the provided test cases avoid direct singularities by choosing $\\omega$ not equal to $\\pm \\Omega_s$. Near cutoffs where $P \\approx 0$ or at strong anisotropy, $f(n)$ can exhibit steep features. Dense sampling and bracketing ensure that sign changes are captured. Brent's method guarantees convergence for continuous functions with bracketing.\n- For the cold plasma with axisymmetric $\\boldsymbol{\\varepsilon}$, the refractive index depends only on $\\theta$, so choosing azimuth $\\phi=0$ incurs no loss of generality.\n\nComplexity and implementation notes:\n- Each evaluation of $f(n)$ requires a $3 \\times 3$ determinant, which is $\\mathcal{O}(1)$ cost, so sampling across a grid of size $M$ is $\\mathcal{O}(M)$ per angle. Root-finding per bracket is negligible overhead.\n- Numerical constants to use include $\\epsilon_0$, $\\mu_0$, $e$, $m_e$, and $m_p$ in SI units.\n\nThe program instantiates the four test cases, computes the lists of roots for each, and prints a single line containing a list of lists of floats, each rounded to six decimal places, as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\n# Physical constants (SI units)\nepsilon0 = 8.854187817e-12  # F/m\nmu0 = 1.2566370614e-6       # H/m\nc = 1.0 / np.sqrt(epsilon0 * mu0)\ne_charge = 1.602176634e-19  # C\nm_e = 9.1093837015e-31      # kg\nm_p = 1.67262192369e-27     # kg\n\ndef stix_parameters(n_e, B0, omega, ion_mass_factor=2.0):\n    \"\"\"\n    Compute Stix cold plasma parameters S, D, P for electrons and a single ion species.\n    Assumes quasi-neutrality n_i = n_e and Z = 1. Ion mass = ion_mass_factor * m_p.\n    \"\"\"\n    # Electrons\n    q_e = -e_charge\n    me = m_e\n    ne = n_e\n    omega_pe2 = ne * q_e * q_e / (epsilon0 * me)  # note q^2 - positive\n    Omega_e = q_e * B0 / me  # signed\n\n    # Ions (deuterium by default)\n    q_i = e_charge\n    mi = ion_mass_factor * m_p\n    ni = n_e\n    omega_pi2 = ni * q_i * q_i / (epsilon0 * mi)\n    Omega_i = q_i * B0 / mi\n\n    # S, D, P\n    # Avoid division by zero at exact resonances; test suite avoids exact singularities.\n    S = 1.0 - (omega_pe2 / (omega**2 - Omega_e**2) + omega_pi2 / (omega**2 - Omega_i**2))\n    D = (Omega_e / omega) * (omega_pe2 / (omega**2 - Omega_e**2)) + (Omega_i / omega) * (omega_pi2 / (omega**2 - Omega_i**2))\n    P = 1.0 - (omega_pe2 + omega_pi2) / (omega**2)\n    return S, D, P\n\ndef epsilon_tensor(S, D, P):\n    \"\"\"\n    Construct the cold plasma dielectric tensor (Stix form) in the (x,y,z) basis aligned to B0 || z.\n    \"\"\"\n    return np.array([\n        [S, -1j * D, 0.0],\n        [1j * D,  S,  0.0],\n        [0.0,  0.0,  P]\n    ], dtype=complex)\n\ndef det_dispersion(n, khat, eps_tensor):\n    \"\"\"\n    Compute the real determinant of the dispersion tensor K(N,omega) = N N - N^2 I + epsilon,\n    with N = n * khat.\n    \"\"\"\n    Nvec = n * khat\n    N2 = n * n\n    # Outer product N N\n    NN = np.outer(Nvec, Nvec)\n    I = np.eye(3, dtype=complex)\n    K = NN - N2 * I + eps_tensor\n    detK = np.linalg.det(K)\n    # For collisionless plasma, K is Hermitian; det is real. Return real part for numerical robustness.\n    return float(np.real(detK))\n\ndef find_roots_for_case(B0, n_e, omega, theta, n_min=1e-6, n_max=10.0, grid_points=4000):\n    \"\"\"\n    For a given case, compute the real positive roots n of det K(n k_hat, omega) = 0.\n    Uses sign-change bracketing and Brent's method.\n    \"\"\"\n    # Species and dielectric parameters\n    S, D, P = stix_parameters(n_e, B0, omega, ion_mass_factor=2.0)\n    eps = epsilon_tensor(S, D, P)\n    # Direction khat in axisymmetric cold plasma (phi=0 suffices)\n    khat = np.array([np.sin(theta), 0.0, np.cos(theta)], dtype=float)\n\n    # Sample f(n) on a grid\n    ns = np.linspace(n_min, n_max, grid_points)\n    fvals = np.array([det_dispersion(n, khat, eps) for n in ns])\n\n    # Identify sign changes\n    roots = []\n    for i in range(len(ns) - 1):\n        f1 = fvals[i]\n        f2 = fvals[i + 1]\n        n1 = ns[i]\n        n2 = ns[i + 1]\n        # Skip NaNs or infs\n        if not np.isfinite(f1) or not np.isfinite(f2):\n            continue\n        # Check for sign change or very close to zero\n        if f1 == 0.0:\n            candidate = n1\n            if candidate  0:\n                roots.append(candidate)\n        elif f2 == 0.0:\n            candidate = n2\n            if candidate  0:\n                roots.append(candidate)\n        elif f1 * f2  0.0:\n            try:\n                r = brentq(lambda n: det_dispersion(n, khat, eps), n1, n2, maxiter=100, xtol=1e-12, rtol=1e-10)\n                if r  0:\n                    roots.append(r)\n            except Exception:\n                # If Brent fails, skip this interval\n                pass\n\n    # Deduplicate roots within tolerance\n    roots_sorted = sorted(roots)\n    unique_roots = []\n    tol = 1e-3  # merge roots closer than this\n    for r in roots_sorted:\n        if len(unique_roots) == 0 or abs(r - unique_roots[-1])  tol:\n            unique_roots.append(r)\n\n    # Round to six decimals\n    rounded = [float(f\"{r:.6f}\") for r in unique_roots]\n    return rounded\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (B0 [T], n_e [m^-3], omega [rad/s], theta [rad])\n        (5.0, 5.0e19, 1.20e12, 0.0),             # Case 1: happy path, parallel\n        (5.0, 5.0e19, 1.20e12, np.pi / 4.0),     # Case 2: oblique\n        (5.0, 5.0e19, 1.20e12, np.pi / 2.0),     # Case 3: perpendicular\n        (5.0, 5.0e19, 4.20e11, np.pi / 3.0),     # Case 4: near cutoff edge case\n    ]\n\n    results = []\n    for B0, n_e, omega, theta in test_cases:\n        roots = find_roots_for_case(B0, n_e, omega, theta)\n        results.append(roots)\n\n    # Format the final output: single line, list of lists with comma-separated floats.\n    # Build string representation manually to control formatting.\n    def format_list(lst):\n        return \"[\" + \",\".join(f\"{x:.6f}\" if isinstance(x, float) else str(x) for x in lst) + \"]\"\n\n    outer = \"[\" + \",\".join(format_list(r) for r in results) + \"]\"\n    print(outer)\n\nsolve()\n```"
        },
        {
            "introduction": "In the complex environment of a fusion plasma, waves don't just propagate; they can transform. Near a mode conversion layer, two different wave types can become nearly degenerate, leading to a rapid rotation of the wave's polarization and an exchange of energy. This exercise provides a hands-on look at the numerical challenges this physical phenomenon presents . By analyzing a simplified model, you will derive a concrete numerical stability criterion, revealing the essential link between the physical scales of the problem and the design of a robust computational solver.",
            "id": "4064617",
            "problem": "Consider wave propagation in a magnetized cold plasma in the context of computational fusion science and engineering. Starting from Maxwell's equations in an anisotropic medium, the cold plasma dielectric response leads to multiple refractive index surfaces and mode polarization states. Near a mode conversion layer, two branches of the dispersion relation approach degeneracy and couple, causing rapid rotation of the local polarization vector. In a reduced two-mode description valid near the conversion layer, the local eigenproblem for the dominant coupled subspace can be modeled by a Hermitian operator $H(s)$ of the form\n$$\nH(s) = \\begin{pmatrix}\n\\Delta(s)/2  g \\\\\ng  -\\Delta(s)/2\n\\end{pmatrix},\n$$\nwhere $s$ is the path coordinate along the ray (in meters), $\\Delta(s)$ is the local detuning representing the difference of the uncoupled refractive index surfaces, taken to be linear as $\\Delta(s) = a \\,(s - s_c)$ with $a$ in $\\text{m}^{-1}$ and $s_c$ the conversion layer location in meters, and $g$ is a real coupling coefficient that parameterizes the strength of interaction between the two modes. Let the upper-branch eigenvalue of $H(s)$ be denoted by $\\lambda_{+}(s)$, with the corresponding eigenvector defining a local polarization mixing angle $\\theta(s)$ between the uncoupled basis modes.\n\nTasks:\n- Using a principle-based derivation grounded in Maxwell's equations and the reduced-mode Hermitian operator $H(s)$, obtain the polarization mixing angle $\\theta(s)$ for the upper branch as a function of $\\Delta(s)$ and $g$, and derive its spatial derivative $d\\theta/ds$.\n- Using the derived $d\\theta/ds$, obtain a step-size requirement $h_{\\max}$ that ensures the per-step change in $\\theta$ does not exceed a specified bound $\\varepsilon_{\\theta}$ (in radians) at the point of most rapid polarization rotation along $s$. Provide the formula for $h_{\\max}$ in terms of $a$, $g$, and $\\varepsilon_{\\theta}$.\n- Define the local refractive index for the upper branch as $n_{+}(s) = n_b + \\alpha \\,\\lambda_{+}(s)$, where $n_b$ is a baseline refractive index (dimensionless) and $\\alpha$ is a dimensionless scaling factor that maps the eigenvalue to a refractive index correction. The local wavenumber is $k(s) = k_0 \\, n_{+}(s)$, where $k_0$ is a constant baseline wavenumber in $\\text{rad}/\\text{m}$. Derive a closed-form expression for the accumulated phase $\\phi_{\\text{exact}} = \\int_{s_0}^{s_1} k(s)\\, ds$ in radians using the upper-branch eigenvalue of $H(s)$, and design a trapezoidal-rule numerical integration to compute $\\phi_{\\text{num}}$ using a uniform step $h \\le h_{\\max}$.\n- Quantify the absolute phase error $|\\phi_{\\text{num}} - \\phi_{\\text{exact}}|$ (in radians) and the maximum absolute polarization angle error $\\max_{s \\in [s_0,s_1]} |\\theta_{\\text{num}}(s) - \\theta_{\\text{exact}}(s)|$ (in radians), where $\\theta_{\\text{num}}(s)$ is obtained by forward Euler integration of $d\\theta/ds$ with step $h$ starting from $\\theta_{\\text{exact}}(s_0)$.\n\nYour program must implement the above and produce numerical results for the following test suite. All angles must be in radians, lengths in meters, and wavenumbers in $\\text{rad}/\\text{m}$. For each test case, use $h = (s_1 - s_0)/N$ with $N = \\lceil (s_1 - s_0)/h_{\\max} \\rceil$.\n\nTest suite:\n1. Case A (happy path): $a = 200.0$, $g = 0.25$, $s_0 = -0.05$, $s_1 = 0.05$, $s_c = 0.0$, $k_0 = 2\\pi/0.03$, $n_b = 1.7$, $\\alpha = 0.12$, $\\varepsilon_{\\theta} = 0.01$.\n2. Case B (boundary, sharp rotation): $a = 500.0$, $g = 0.02$, $s_0 = -0.05$, $s_1 = 0.05$, $s_c = 0.0$, $k_0 = 2\\pi/0.03$, $n_b = 1.4$, $\\alpha = 0.09$, $\\varepsilon_{\\theta} = 0.01$.\n3. Case C (edge, broad rotation and longer path): $a = 100.0$, $g = 0.60$, $s_0 = -0.10$, $s_1 = 0.10$, $s_c = 0.0$, $k_0 = 2\\pi/0.06$, $n_b = 2.0$, $\\alpha = 0.08$, $\\varepsilon_{\\theta} = 0.01$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets. For each test case, output the triple $[h_{\\max}, |\\phi_{\\text{num}} - \\phi_{\\text{exact}}|, \\max|\\theta_{\\text{num}} - \\theta_{\\text{exact}}|]$. The final printed line must have the format\n$[[h_{\\max}^{(A)}, \\text{phase\\_error}^{(A)}, \\text{theta\\_error}^{(A)}],[h_{\\max}^{(B)}, \\text{phase\\_error}^{(B)}, \\text{theta\\_error}^{(B)}],[h_{\\max}^{(C)}, \\text{phase\\_error}^{(C)}, \\text{theta\\_error}^{(C)}]]$.",
            "solution": "The problem statement has been critically validated and is deemed to be self-contained, scientifically grounded, and well-posed. It presents a standard reduced model for wave mode conversion in plasma physics, a topic of significance in computational fusion science. All parameters are clearly defined, and the tasks are mathematically and computationally tractable. There are no contradictions, ambiguities, or violations of physical principles.\n\nWe proceed with a principle-based derivation of the required quantities.\n\n1.  **Derivation of Polarization Angle $\\theta(s)$ and its Derivative $d\\theta/ds$**\n\nThe local eigenproblem is defined by the Hermitian operator $H(s)$:\n$$\nH(s) = \\begin{pmatrix}\n\\Delta(s)/2  g \\\\\ng  -\\Delta(s)/2\n\\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are found by solving the characteristic equation $\\det(H(s) - \\lambda I) = 0$:\n$$\n\\left(\\frac{\\Delta(s)}{2} - \\lambda\\right)\\left(-\\frac{\\Delta(s)}{2} - \\lambda\\right) - g^2 = 0 \\implies \\lambda^2 - \\left(\\frac{\\Delta(s)}{2}\\right)^2 - g^2 = 0\n$$\nThis gives the eigenvalues $\\lambda_{\\pm}(s) = \\pm\\sqrt{g^2 + (\\Delta(s)/2)^2}$. The upper-branch eigenvalue is:\n$$\n\\lambda_{+}(s) = \\sqrt{g^2 + \\left(\\frac{\\Delta(s)}{2}\\right)^2}\n$$\nThe corresponding eigenvector $v_+ = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$ can be parametrized by the polarization mixing angle $\\theta(s)$ as $v_+ \\propto \\begin{pmatrix} \\cos\\theta(s) \\\\ \\sin\\theta(s) \\end{pmatrix}$. The eigen-equation $(H(s) - \\lambda_+ I)v_+ = 0$ gives the relation:\n$$\ng v_1 + \\left(-\\frac{\\Delta(s)}{2} - \\lambda_{+}(s)\\right) v_2 = 0 \\implies \\tan\\theta(s) = \\frac{v_2}{v_1} = \\frac{g}{\\lambda_{+}(s) + \\Delta(s)/2}\n$$\nTo obtain a continuous representation of $\\theta(s)$ that correctly transitions through the conversion layer at $s=s_c$ (where $\\Delta(s_c)=0$), we define an angle $\\phi(s)$ such that $\\sin\\phi(s) = g/\\lambda_{+}(s)$ and $\\cos\\phi(s) = (\\Delta(s)/2)/\\lambda_{+}(s)$. Then the eigenvector is proportional to $\\begin{pmatrix} \\cos(\\phi/2) \\\\ \\sin(\\phi/2) \\end{pmatrix}$, which implies $\\theta(s) = \\phi(s)/2$. The angle $\\phi(s)$ spans from $\\pi$ (for $s \\to -\\infty$) to $0$ (for $s \\to \\infty$), assuming $g0$. Thus, $2\\theta(s)$ can be uniquely identified using the arccosine function:\n$$\n2\\theta(s) = \\arccos\\left(\\frac{\\Delta(s)/2}{\\lambda_{+}(s)}\\right) = \\arccos\\left(\\frac{\\Delta(s)}{\\sqrt{4g^2 + \\Delta(s)^2}}\\right)\n$$\nTherefore, the polarization mixing angle for the upper branch is:\n$$\n\\theta(s) = \\frac{1}{2} \\arccos\\left(\\frac{\\Delta(s)}{\\sqrt{4g^2 + \\Delta(s)^2}}\\right)\n$$\nTo find the spatial derivative $d\\theta/ds$, we use the chain rule: $d\\theta/ds = (d\\theta/d\\Delta) \\cdot (d\\Delta/ds)$. Given $\\Delta(s) = a(s-s_c)$, we have $d\\Delta/ds = a$. Using the alternative form $\\tan(2\\theta) = 2g/\\Delta$, we differentiate with respect to $\\Delta$:\n$$\n\\sec^2(2\\theta) \\cdot 2\\frac{d\\theta}{d\\Delta} = -\\frac{2g}{\\Delta^2}\n$$\nSince $\\tan^2(2\\theta) = (2g/\\Delta)^2$, we have $\\sec^2(2\\theta) = 1 + \\tan^2(2\\theta) = 1 + 4g^2/\\Delta^2 = (\\Delta^2+4g^2)/\\Delta^2$.\n$$\n\\frac{\\Delta^2+4g^2}{\\Delta^2} \\cdot 2\\frac{d\\theta}{d\\Delta} = -\\frac{2g}{\\Delta^2} \\implies \\frac{d\\theta}{d\\Delta} = -\\frac{g}{\\Delta^2+4g^2}\n$$\nMultiplying by $d\\Delta/ds = a$, we get the spatial derivative:\n$$\n\\frac{d\\theta}{ds} = \\frac{-ag}{[a(s-s_c)]^2 + 4g^2}\n$$\n\n2.  **Derivation of Step-Size Requirement $h_{\\max}$**\n\nThe rate of polarization rotation $|d\\theta/ds|$ is maximum when the denominator of the expression is minimum. This occurs at $s=s_c$, where $\\Delta(s)=0$:\n$$\n\\left|\\frac{d\\theta}{ds}\\right|_{\\max} = \\left|\\frac{-ag}{4g^2}\\right| = \\frac{a}{4|g|}\n$$\nAssuming $g0$ as implied by it being a coupling strength, this is $a/(4g)$. The problem requires the per-step change in $\\theta$ to be bounded by $\\varepsilon_{\\theta}$. Using a first-order approximation, $|\\Delta\\theta| \\approx |d\\theta/ds| \\cdot h$. At the point of most rapid rotation, we must satisfy:\n$$\n\\left|\\frac{d\\theta}{ds}\\right|_{\\max} h_{\\max} \\le \\varepsilon_{\\theta} \\implies \\left(\\frac{a}{4g}\\right)h_{\\max} \\le \\varepsilon_{\\theta}\n$$\nSolving for $h_{\\max}$, we obtain the step-size requirement:\n$$\nh_{\\max} = \\frac{4g\\varepsilon_{\\theta}}{a}\n$$\n\n3.  **Derivation of Accumulated Phase $\\phi_{\\text{exact}}$**\n\nThe local wavenumber is $k(s) = k_0 n_{+}(s)$, with $n_{+}(s) = n_b + \\alpha\\lambda_{+}(s)$. Substituting the expressions for $\\lambda_+(s)$ and $\\Delta(s)$:\n$$\nk(s) = k_0 \\left( n_b + \\alpha \\sqrt{g^2 + \\frac{a^2}{4}(s-s_c)^2} \\right)\n$$\nThe total accumulated phase $\\phi_{\\text{exact}}$ from $s_0$ to $s_1$ is the integral of $k(s)$:\n$$\n\\phi_{\\text{exact}} = \\int_{s_0}^{s_1} k(s) ds = \\int_{s_0}^{s_1} k_0 n_b ds + \\int_{s_0}^{s_1} k_0 \\alpha \\sqrt{g^2 + \\frac{a^2}{4}(s-s_c)^2} ds\n$$\nThe first integral is trivial: $k_0 n_b (s_1 - s_0)$. For the second integral, let $u = s-s_c$ and $b=2g/a$. The integral becomes:\n$$\nk_0 \\alpha \\int_{s_0-s_c}^{s_1-s_c} \\sqrt{g^2 + \\frac{a^2}{4}u^2} du = k_0 \\alpha \\frac{a}{2} \\int_{s_0-s_c}^{s_1-s_c} \\sqrt{\\left(\\frac{2g}{a}\\right)^2 + u^2} du\n$$\nUsing the standard integral $\\int \\sqrt{b^2+u^2}du = \\frac{u}{2}\\sqrt{b^2+u^2} + \\frac{b^2}{2}\\text{arcsinh}\\left(\\frac{u}{b}\\right)$, we find the closed-form expression for the second part of the phase:\n$$\nI_2(s) = k_0 \\alpha \\left[ \\frac{(s-s_c)\\lambda_+(s)}{2} + \\frac{g^2}{a}\\text{arcsinh}\\left(\\frac{a(s-s_c)}{2g}\\right) \\right]\n$$\nThe total exact phase is then $\\phi_{\\text{exact}} = k_0 n_b (s_1 - s_0) + I_2(s_1) - I_2(s_0)$.\n\n4.  **Numerical Error Quantification**\n\nThe algorithm for solving the problem is as follows:\n- For each test case, calculate $h_{\\max}$ using the derived formula.\n- Determine the number of steps $N = \\lceil (s_1-s_0)/h_{\\max} \\rceil$ and the uniform step size $h = (s_1-s_0)/N$.\n- Create a grid of $N+1$ points $s_i = s_0 + ih$ for $i=0, \\dots, N$.\n- Calculate the exact phase $\\phi_{\\text{exact}}$ using the analytical formula derived in step 3.\n- Calculate the numerical phase $\\phi_{\\text{num}}$ by applying the trapezoidal rule to the function $k(s)$ over the grid $s_i$. The phase error is $|\\phi_{\\text{num}} - \\phi_{\\text{exact}}|$.\n- Calculate the exact polarization angle $\\theta_{\\text{exact}}(s_i)$ at each grid point using the `arccos` formula from step 1.\n- Calculate the numerical polarization angle $\\theta_{\\text{num}}(s_i)$ by applying the forward Euler method: $\\theta_{\\text{num}}(s_{i+1}) = \\theta_{\\text{num}}(s_i) + h \\cdot (d\\theta/ds)(s_i)$, starting with $\\theta_{\\text{num}}(s_0) = \\theta_{\\text{exact}}(s_0)$.\n- The maximum polarization angle error is $\\max_{i} |\\theta_{\\text{num}}(s_i) - \\theta_{\\text{exact}}(s_i)|$.\n\nThis structured approach, combining analytical derivations with standard numerical methods, will be implemented to generate the required results.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the wave propagation problem for the given test suite.\n    \"\"\"\n\n    test_cases = [\n        # Case A: Happy path\n        {'a': 200.0, 'g': 0.25, 's0': -0.05, 's1': 0.05, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.03, 'nb': 1.7, 'alpha': 0.12, 'epsilon_theta': 0.01},\n        # Case B: Boundary, sharp rotation\n        {'a': 500.0, 'g': 0.02, 's0': -0.05, 's1': 0.05, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.03, 'nb': 1.4, 'alpha': 0.09, 'epsilon_theta': 0.01},\n        # Case C: Edge, broad rotation and longer path\n        {'a': 100.0, 'g': 0.60, 's0': -0.10, 's1': 0.10, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.06, 'nb': 2.0, 'alpha': 0.08, 'epsilon_theta': 0.01},\n    ]\n\n    all_results = []\n    for params in test_cases:\n        a = params['a']\n        g = params['g']\n        s0 = params['s0']\n        s1 = params['s1']\n        sc = params['sc']\n        k0 = params['k0']\n        nb = params['nb']\n        alpha = params['alpha']\n        epsilon_theta = params['epsilon_theta']\n\n        # Task 2: Calculate h_max\n        h_max = (4 * g * epsilon_theta) / a\n\n        # Setup numerical grid\n        N = int(np.ceil((s1 - s0) / h_max))\n        h = (s1 - s0) / N\n        s_grid = np.linspace(s0, s1, N + 1)\n\n        # Helper functions based on derivations\n        def delta_s(s):\n            return a * (s - sc)\n\n        def lambda_plus(s):\n            return np.sqrt(g**2 + (delta_s(s) / 2)**2)\n\n        def k_s(s):\n            return k0 * (nb + alpha * lambda_plus(s))\n\n        def theta_exact(s):\n            ds = delta_s(s)\n            denominator = np.sqrt(4 * g**2 + ds**2)\n            # handle case where denominator is zero (g=0, s=sc) to avoid division by zero\n            # In this problem g  0, so denominator is never zero.\n            arg = ds / denominator\n            # Clip argument for arccos to handle potential floating point inaccuracies\n            arg = np.clip(arg, -1.0, 1.0)\n            return 0.5 * np.arccos(arg)\n\n        def dtheta_ds(s):\n            return (-a * g) / (delta_s(s)**2 + 4 * g**2)\n\n        # Task 3: Calculate exact and numerical phase\n        def phase_integral_term(s):\n            if g == 0:  # Avoid division by zero in arcsinh\n                return k0 * alpha * (s - sc) * lambda_plus(s) / 2\n            return k0 * alpha * (\n                (s - sc) * lambda_plus(s) / 2 +\n                (g**2 / a) * np.arcsinh(a * (s - sc) / (2 * g))\n            )\n\n        phi_exact = k0 * nb * (s1 - s0) + (phase_integral_term(s1) - phase_integral_term(s0))\n        \n        k_values = k_s(s_grid)\n        phi_num = np.trapz(k_values, dx=h) # or np.trapz(k_values, s_grid)\n        phase_error = np.abs(phi_num - phi_exact)\n\n        # Task 4: Calculate polarization angle error\n        theta_exact_values = theta_exact(s_grid)\n\n        theta_num_values = np.zeros(N + 1)\n        theta_num_values[0] = theta_exact_values[0]\n\n        for i in range(N):\n            s_i = s_grid[i]\n            theta_num_values[i+1] = theta_num_values[i] + h * dtheta_ds(s_i)\n        \n        theta_error = np.max(np.abs(theta_num_values - theta_exact_values))\n        \n        all_results.append([h_max, phase_error, theta_error])\n\n    # Format the final output string\n    # e.g., [[val1, val2, val3],[val4,val5,val6]]\n    result_str = \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in all_results])\n    print(f\"[{result_str}]\")\n\n\nsolve()\n```"
        }
    ]
}