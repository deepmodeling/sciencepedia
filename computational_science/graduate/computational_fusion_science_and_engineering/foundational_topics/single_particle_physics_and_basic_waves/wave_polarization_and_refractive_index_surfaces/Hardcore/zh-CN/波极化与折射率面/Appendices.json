{
    "hands_on_practices": [
        {
            "introduction": "电子回旋共振是托卡马克等离子体中波加热的关键机制。这项练习将通过解析推导，帮助你量化波的折射率在共振点附近对磁场变化的敏感度。这个练习能让你深入理解色散关系中的共振特性，并为精确控制波加热方案提供理论基础。",
            "id": "4064584",
            "problem": "在与电子回旋共振加热 (ECRH) 相关的高温磁化聚变等离子体中，考虑一个具有均匀背景磁场 $\\mathbf{B}_0$ 和电子数密度 $n_{\\mathrm{e}}$ 的冷、无碰撞电子-离子等离子体。一个角频率为 $\\omega$ 的平面电磁波平行于 $\\mathbf{B}_0$ 传播。假设在电子回旋频率范围内，离子响应可以忽略不计，并且冷等离子体近似适用。\n\n从麦克斯韦方程组和冷等离子体本构关系出发，平行传播的电磁模式分解为右旋和左旋圆偏振波。右旋圆偏振模式（在电子回旋频率处发生共振的模式）的折射率平方 $n^2$ 可以用无量纲参数 $X \\equiv \\omega_{pe}^2/\\omega^2$ 和 $Y \\equiv \\Omega_{e}/\\omega$ 来表示，其中 $\\omega_{pe} \\equiv \\sqrt{n_{\\mathrm{e}} e^2/(\\varepsilon_0 m_e)}$ 是电子等离子体频率，而 $\\Omega_{e} \\equiv e B_0/m_e$ 是电子回旋频率。利用经过充分检验的、对应于平行传播的右旋圆偏振分支的冷等离子体色散关系，通过在固定 $\\omega$ 和 $n_{\\mathrm{e}}$ 的条件下计算偏导数 $\\partial n^2/\\partial \\Omega_{e}$，推导出一个解析表达式来描述在电子回旋共振附近 $n^2$ 对 $B_0$ 微小变化的灵敏度。\n\n将您的最终结果以 $X$、$Y$ 和 $\\omega$ 的封闭形式符号表达式表示。以秒为单位报告 $\\partial n^2/\\partial \\Omega_{e}$。最终答案必须是单一的封闭形式表达式。",
            "solution": "问题要求计算在冷的、无碰撞的电子-离子等离子体中，平行于磁场传播的右旋圆偏振（R波）电磁模式的折射率平方 $n^2$ 对背景磁场 $B_0$ 微小变化的灵敏度，该灵敏度由偏导数 $\\partial n^2/\\partial \\Omega_e$ 来量化。\n\n首先，我们必须验证问题陈述的有效性。\n给定条件如下：\n- 一个冷的、无碰撞的电子-离子等离子体。\n- 一个均匀的背景磁场 $\\mathbf{B}_0$。\n- 电子数密度 $n_{\\mathrm{e}}$。\n- 一个角频率为 $\\omega$ 的平面电磁波平行于 $\\mathbf{B}_0$ 传播。\n- 离子响应可以忽略不计。\n- 冷等离子体近似适用。\n- 关注的模式是右旋圆偏振（R波），定义为在电子回旋频率 $\\Omega_e$ 处共振的模式。\n- 无量纲参数：$X \\equiv \\omega_{pe}^2/\\omega^2$ 和 $Y \\equiv \\Omega_{e}/\\omega$。\n- 定义：电子等离子体频率 $\\omega_{pe} \\equiv \\sqrt{n_{\\mathrm{e}} e^2/(\\varepsilon_0 m_e)}$ 和电子回旋频率 $\\Omega_{e} \\equiv e B_0/m_e$。\n- 任务是在 $\\omega$ 和 $n_{\\mathrm{e}}$ 固定的条件下计算 $\\partial n^2/\\partial \\Omega_{e}$，并用 $X$、$Y$ 和 $\\omega$ 表示结果。\n\n有效性验证：\n该问题在科学上基于已建立的等离子体中波传播理论，这是等离子体物理和聚变科学的核心课题。所涉及的概念和近似（冷等离子体、可忽略的离子响应、平行传播）是用于推导基本波动特性的标准理想化方法。该问题提法明确，要求计算一个明确定义的物理量的特定导数。语言客观而精确。所有必需的物理量和关系，或已在问题中给出，或为该领域的标准、众所周知的结果（例如，冷等离子体色散关系）。要求导数 $\\partial n^2/\\partial \\Omega_{e}$ 的单位为秒，这在物理上是一致的，因为 $n^2$ 是无量纲的，而 $\\Omega_e$ 的单位是秒的倒数 ($s^{-1}$)。因此，该问题是有效的。\n\n解答：\n磁化等离子体中电磁波的色散关系由麦克斯韦方程组和等离子体的本构关系导出，该本构关系由介电张量 $\\boldsymbol{\\varepsilon}$ 描述。对于磁场为 $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$ 且忽略离子运动的冷等离子体，与平行于 $\\mathbf{B}_0$ 传播相关的介电张量分量导致两种不同的模式，即左旋（L）和右旋（R）圆偏振波。它们的折射率平方 $n_{L,R}^2$ 由下式给出：\n$$n_{L,R}^2 = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega \\pm \\Omega_e)}$$\n问题将右旋圆偏振模式指定为“在电子回旋频率处共振的模式”，这发生在波频率 $\\omega$ 与电子回旋频率 $\\Omega_e$ 相匹配时。共振对应于折射率趋于无穷大，这要求分数项的分母趋于零。这对于以下表达式发生：\n$$n^2 = 1 - \\frac{\\omega_{pe}^2}{\\omega(\\omega - \\Omega_e)}$$\n这就是问题中所定义的我们所关注模式的色散关系。在 $\\omega = \\Omega_e$ 处可以清楚地看到共振。\n\n我们被要求用无量纲参数 $X$ 和 $Y$ 来表示结果。我们可以使用这些参数重写 $n^2$ 的表达式：\n$$n^2 = 1 - \\frac{\\omega_{pe}^2/\\omega^2}{1 - \\Omega_e/\\omega}$$\n代入 $X = \\omega_{pe}^2/\\omega^2$ 和 $Y = \\Omega_e/\\omega$，我们得到折射率平方的紧凑形式：\n$$n^2 = 1 - \\frac{X}{1-Y}$$\n任务是在保持 $\\omega$ 和 $n_{\\mathrm{e}}$ 不变的情况下计算偏导数 $\\partial n^2 / \\partial \\Omega_e$。由于 $n_{\\mathrm{e}}$ 是常数，$\\omega_{pe}$ 也是常数。由于 $\\omega$ 也是常数，参数 $X$ 在微分过程中是常数。然而，参数 $Y$ 线性地依赖于 $\\Omega_e$。\n$$Y = \\frac{\\Omega_e}{\\omega}$$\n我们可以使用链式法则来计算该导数：\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = \\frac{\\partial n^2}{\\partial Y} \\frac{\\partial Y}{\\partial \\Omega_e}$$\n首先，我们计算 $n^2$ 对 $Y$ 的导数：\n$$\\frac{\\partial n^2}{\\partial Y} = \\frac{\\partial}{\\partial Y} \\left( 1 - \\frac{X}{1-Y} \\right) = \\frac{\\partial}{\\partial Y} \\left( 1 - X(1-Y)^{-1} \\right)$$\n应用幂法则和链式法则进行微分：\n$$\\frac{\\partial n^2}{\\partial Y} = -X \\cdot \\left(-1 \\cdot (1-Y)^{-2} \\cdot \\frac{\\partial(1-Y)}{\\partial Y} \\right)$$\n$$\\frac{\\partial n^2}{\\partial Y} = -X \\cdot \\left(-1 \\cdot (1-Y)^{-2} \\cdot (-1) \\right) = -X (1-Y)^{-2}$$\n$$\\frac{\\partial n^2}{\\partial Y} = -\\frac{X}{(1-Y)^2}$$\n接下来，我们计算 $Y$ 对 $\\Omega_e$ 的导数：\n$$\\frac{\\partial Y}{\\partial \\Omega_e} = \\frac{\\partial}{\\partial \\Omega_e} \\left( \\frac{\\Omega_e}{\\omega} \\right) = \\frac{1}{\\omega}$$\n最后，我们将两个结果相乘以获得所需的偏导数：\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = \\left( -\\frac{X}{(1-Y)^2} \\right) \\cdot \\left( \\frac{1}{\\omega} \\right)$$\n$$\\frac{\\partial n^2}{\\partial \\Omega_e} = -\\frac{X}{\\omega(1-Y)^2}$$\n该表达式用基本无量纲参数 $X$ 和 $Y$ 以及波频率 $\\omega$ 表示了 $n^2$ 对电子回旋频率 $\\Omega_e$（并因此对磁场 $B_0$）变化的灵敏度。按要求，该表达式的单位是秒 ($s$)，因为 $X$ 和 $Y$ 是无量纲的，而 $\\omega$ 的单位是 $s^{-1}$。",
            "answer": "$$\\boxed{-\\frac{X}{\\omega(1-Y)^{2}}}$$"
        },
        {
            "introduction": "折射率表面是描述波在各向异性等离子体中传播行为的基本“路线图”。这个动手编程练习将指导你设计一个算法，以数值方式求解冷等离子体色散关系，从而构建这些复杂的表面。通过将理论方程转化为实际的计算工具，你将掌握分析波传播路径的核心技能。",
            "id": "4064599",
            "problem": "您的任务是通过对传播方向上的色散条件进行数值采样，为冷的、磁化的、准中性聚变等离子体中的平面电磁波构建折射率曲面（$n$-曲面）。请从宏观电磁场方程和平面波拟设开始。考虑一个沿 $\\hat{\\boldsymbol{z}}$ 轴方向的均匀静磁场 $\\boldsymbol{B}_0$，并采用包含电子和单一离子种类的冷等离子体模型。请在国际单位制（SI）下进行计算，假设响应是无碰撞的，并将介电响应张量视为频率相关但空间均匀的。\n\n出发的基本原理：\n- 物质中的麦克斯韦方程组，以及平面波拟设 $\\boldsymbol{E}(\\boldsymbol{r},t) = \\Re\\{\\boldsymbol{E}_0 e^{i(\\boldsymbol{k}\\cdot\\boldsymbol{r}-\\omega t)}\\}$。\n- 色散介质中的无源波动方程 $\\nabla \\times \\nabla \\times \\boldsymbol{E} - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega) \\cdot \\boldsymbol{E} = \\boldsymbol{0}$。\n- 无量纲折射率矢量 $\\boldsymbol{N} = \\dfrac{c\\,\\boldsymbol{k}}{\\omega}$ 的定义，其中 $c = (\\mu_0 \\epsilon_0)^{-1/2}$。\n\n基于此，平面波条件产生了一个 $3 \\times 3$ 的色散张量 $\\mathbf{K}(\\boldsymbol{N},\\omega)$，对于非平凡的 $\\boldsymbol{E}_0$，其行列式必须为零。对于固定的传播方向 $\\hat{\\boldsymbol{k}}$ 和固定的角频率 $\\omega$，标量折射率 $n = \\|\\boldsymbol{N}\\|$ 是方程 $\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = 0$ 的解。目标是通过对方向 $\\hat{\\boldsymbol{k}}$ 进行采样并提取 $n$ 的所有正实数根，从而用计算方法构建 $n$-曲面。\n\n您的任务：\n1. 从上述基本原理出发，推导出一个可计算实现的冷磁化等离子体色散张量 $\\mathbf{K}(\\boldsymbol{N},\\omega)$ 的形式，并明确指出介电张量 $\\boldsymbol{\\varepsilon}(\\omega)$ 如何依赖于粒子种类参数。清晰地论证为何对于无碰撞等离子体，当 $\\omega$ 和 $n$ 为实数时，$\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)$ 是实值的。\n2. 设计一个算法，在给定 $\\hat{\\boldsymbol{k}}$、$\\omega$、背景磁场大小 $B_0$ 和粒子种类数据（密度、电荷和质量）的情况下，沿给定方向对标量 $n$ 进行采样，并稳健地提取 $\\det\\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)=0$ 的所有正实数根。您的算法必须能处理存在共振特征时的根的区间限定和隔离问题。\n3. 将该算法实现为一个完整、可运行的程序，为提供的测试套件生成输出。该程序不得要求任何输入，且只打印最终结果。\n\n在您的推导和程序中要使用的模型假设和定义：\n- 背景磁场为 $\\boldsymbol{B}_0 = B_0 \\hat{\\boldsymbol{z}}$。\n- 在与 $\\boldsymbol{B}_0$ 对齐的 $\\{\\hat{\\boldsymbol{x}},\\hat{\\boldsymbol{y}},\\hat{\\boldsymbol{z}}\\}$ 基中，冷等离子体介电张量具有 Stix 形式\n$$\n\\boldsymbol{\\varepsilon} = \n\\begin{pmatrix}\nS  &-i D  &0 \\\\\ni D  &S  &0 \\\\\n0  &0  &P\n\\end{pmatrix},\n$$\n其中，对于粒子种类索引为 $s$，电荷为 $q_s$，质量为 $m_s$，数密度为 $n_s$，等离子体频率为 $\\omega_{p s}^2 = \\dfrac{n_s q_s^2}{\\epsilon_0 m_s}$，以及回旋频率为 $\\Omega_s = \\dfrac{q_s B_0}{m_s}$，\n$$\nS = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nD = \\sum_s \\frac{\\Omega_s}{\\omega} \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nP = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2}.\n$$\n- 色散张量由平面波算子和介电响应构建如下\n$$\n\\mathbf{K}(\\boldsymbol{N},\\omega) = \\boldsymbol{N}\\boldsymbol{N} - N^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega),\n$$\n其中 $\\mathbf{I}$ 是 $3 \\times 3$ 单位矩阵，且 $N^2 = \\boldsymbol{N}\\cdot\\boldsymbol{N}$。\n\n数值和输出要求：\n- 物理单位：$B_0$ 使用 $\\mathrm{T}$，粒子密度 $n_s$ 使用 $\\mathrm{m}^{-3}$，角频率 $\\omega$ 使用 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$，质量使用 $\\mathrm{kg}$，电荷使用 $\\mathrm{C}$。\n- 角度单位：通过相对于 $\\boldsymbol{B}_0$ 的极角 $\\theta$（以弧度为单位）指定传播方向（即 $\\hat{\\boldsymbol{k}} = (\\sin\\theta,0,\\cos\\theta)$）。\n- 将每个根 $n$ 表示为四舍五入到六位小数的浮点数。\n- 对于每个测试用例，返回找到的正实数根 $n$ 的列表。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目对应一个测试用例，并且本身也是一个找到的根的列表，例如 $[\\,[n_{1,1},n_{1,2}],\\,[n_{2,1}],\\,\\ldots\\,]$，渲染为单行。\n\n测试套件：\n计算以下四种情况的根。使用电荷数为 $Z=1$ 且质量为 $m_i = 2 m_p$（氘）的单一离子种类，其中 $m_p$ 是质子质量。假设准中性条件 $n_i = n_e$。\n- 情况 1（理想情况）：$B_0 = 5.0\\,\\mathrm{T}$，$n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$，$\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$\\theta = 0.0\\,\\mathrm{rad}$。\n- 情况 2（斜向传播）：$B_0 = 5.0\\,\\mathrm{T}$，$n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$，$\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$\\theta = \\dfrac{\\pi}{4}\\,\\mathrm{rad}$。\n- 情况 3（垂直传播）：$B_0 = 5.0\\,\\mathrm{T}$，$n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$，$\\omega = 1.20\\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$\\theta = \\dfrac{\\pi}{2}\\,\\mathrm{rad}$。\n- 情况 4（接近截止的边界情况）：$B_0 = 5.0\\,\\mathrm{T}$，$n_e = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$，$\\omega = 4.20\\times 10^{11}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$\\theta = \\dfrac{\\pi}{3}\\,\\mathrm{rad}$。\n\n您的程序必须实现一种在 $n>0$ 范围内的系统性采样和稳健的求根策略，以提取每种情况下的所有不同实数根，并以所要求的精确格式将最终结果打印为单行。",
            "solution": "我们从物质中的麦克斯韦方程组和平面波拟设 $\\boldsymbol{E}(\\boldsymbol{r},t) = \\Re\\{\\boldsymbol{E}_0 e^{i(\\boldsymbol{k}\\cdot\\boldsymbol{r}-\\omega t)}\\}$ 开始。在均匀、线性、色散的介质中，无源波动方程为\n$$\n\\nabla \\times \\nabla \\times \\boldsymbol{E} - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega) \\cdot \\boldsymbol{E} = \\boldsymbol{0}。\n$$\n将 $\\nabla \\to i\\boldsymbol{k}$ 应用于平面波，得到\n$$\n-\\,\\boldsymbol{k} \\times (\\boldsymbol{k} \\times \\boldsymbol{E}_0) - \\omega^2 \\mu_0 \\epsilon_0 \\,\\boldsymbol{\\varepsilon}(\\omega)\\cdot \\boldsymbol{E}_0 = \\boldsymbol{0}。\n$$\n使用矢量恒等式 $\\boldsymbol{a}\\times(\\boldsymbol{b}\\times\\boldsymbol{c}) = \\boldsymbol{b}(\\boldsymbol{a}\\cdot\\boldsymbol{c}) - \\boldsymbol{c}(\\boldsymbol{a}\\cdot\\boldsymbol{b})$，其中 $\\boldsymbol{a}=\\boldsymbol{k}$、$\\boldsymbol{b}=\\boldsymbol{k}$、$\\boldsymbol{c}=\\boldsymbol{E}_0$，得到\n$$\n\\left[\\boldsymbol{k}\\boldsymbol{k} - k^2 \\mathbf{I} + \\omega^2 \\mu_0 \\epsilon_0\\,\\boldsymbol{\\varepsilon}(\\omega)\\right]\\cdot \\boldsymbol{E}_0 = \\boldsymbol{0}。\n$$\n定义无量纲折射率矢量 $\\boldsymbol{N} = \\dfrac{c\\,\\boldsymbol{k}}{\\omega}$，其中 $c = (\\mu_0\\epsilon_0)^{-1/2}$。那么 $\\boldsymbol{k} = \\dfrac{\\omega}{c} \\boldsymbol{N}$，$k^2 = \\dfrac{\\omega^2}{c^2} N^2$，且 $\\boldsymbol{k}\\boldsymbol{k} = \\dfrac{\\omega^2}{c^2} \\boldsymbol{N}\\boldsymbol{N}$。将算子除以 $\\dfrac{\\omega^2}{c^2}$，我们得到色散张量\n$$\n\\mathbf{K}(\\boldsymbol{N},\\omega) = \\boldsymbol{N}\\boldsymbol{N} - N^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega)。\n$$\n非平凡的 $\\boldsymbol{E}_0$ 要求\n$$\n\\det \\mathbf{K}(\\boldsymbol{N},\\omega) = 0。\n$$\n对于固定的方向 $\\hat{\\boldsymbol{k}}$ 和固定的 $\\omega$，我们求解 $n = \\|\\boldsymbol{N}\\|$ 使得\n$$\n\\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = 0。\n$$\n\n冷等离子体介电张量。对于一个磁化的、无碰撞的冷等离子体，其中粒子种类 s 的特征为电荷 $q_s$、质量 $m_s$、数密度 $n_s$、回旋频率 $\\Omega_s = \\dfrac{q_s B_0}{m_s}$ 和等离子体频率 $\\omega_{p s}^2 = \\dfrac{n_s q_s^2}{\\epsilon_0 m_s}$，在与 $\\boldsymbol{B}_0 \\parallel \\hat{\\boldsymbol{z}}$ 对齐的基中，介电张量为\n$$\n\\boldsymbol{\\varepsilon}(\\omega) =\n\\begin{pmatrix}\nS  &-i D  &0 \\\\\ni D  &S  &0 \\\\\n0  &0  &P\n\\end{pmatrix},\n$$\n其中 Stix 参数为\n$$\nS = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nD = \\sum_s \\frac{\\Omega_s}{\\omega} \\frac{\\omega_{p s}^2}{\\omega^2 - \\Omega_s^2}, \n\\quad\nP = 1 - \\sum_s \\frac{\\omega_{p s}^2}{\\omega^2}。\n$$\n这些是冷等离子体模型中经过充分检验的表达式。在无碰撞极限下，介电张量是厄米（Hermitian）的：非对角元是纯虚数且反对称的，而对角元是实数。因此，对于实数 $\\omega$，$\\boldsymbol{\\varepsilon}(\\omega)$ 是厄米的，而 $\\mathbf{K}(\\boldsymbol{N},\\omega)$ 作为厄米矩阵 $\\boldsymbol{N}\\boldsymbol{N}$（秩-1 投影算子）、$-N^2\\mathbf{I}$（对角实矩阵）和 $\\boldsymbol{\\varepsilon}$（厄米矩阵）的总和，其本身也是厄米的。厄米矩阵的行列式是实数。因此，对于实数 $n$ 和实数 $\\omega$，$\\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) \\in \\mathbb{R}$，这使得我们可以在实数轴上使用标量求根方法。\n\n算法设计。对于每个具有指定 $(B_0, n_e, \\omega, \\theta)$ 和粒子种类集合（电子和电荷数 $Z=1$、质量 $m_i = 2 m_p$ 的氘离子，以及准中性条件 $n_i = n_e$）的测试用例，按以下步骤进行：\n1. 计算粒子种类参数：\n   - 电子：$q_e = -e$，$m_e$ 给定，$n_e$ 给定，$\\Omega_e = \\dfrac{q_e B_0}{m_e}$，$\\omega_{pe}^2 = \\dfrac{n_e q_e^2}{\\epsilon_0 m_e}$。\n   - 离子：$q_i = +e$，$m_i = 2 m_p$，$n_i = n_e$，$\\Omega_i = \\dfrac{q_i B_0}{m_i}$，$\\omega_{pi}^2 = \\dfrac{n_i q_i^2}{\\epsilon_0 m_i}$。\n2. 使用上述求和公式，在给定的 $\\omega$ 处计算 Stix 参数 $S$、$D$ 和 $P$。\n3. 构建 $\\boldsymbol{\\varepsilon}(\\omega)$ 并选择传播方向单位矢量 $\\hat{\\boldsymbol{k}} = (\\sin\\theta, 0, \\cos\\theta)$。\n4. 定义标量函数 $f(n) = \\det \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega)$，其中\n   $$\n   \\mathbf{K}(n\\hat{\\boldsymbol{k}},\\omega) = (n\\hat{\\boldsymbol{k}})(n\\hat{\\boldsymbol{k}}) - n^2 \\mathbf{I} + \\boldsymbol{\\varepsilon}(\\omega)。\n   $$\n5. 在 $n \\in (0, n_{\\max}]$ 的足够密集的网格上对 $f(n)$ 进行采样，其中 $n_{\\max}$ 选择得足够大以捕捉预期的分支（对于所提供的参数，$n_{\\max}$ 取 $10$ 左右的值是足够的）。根据介值定理，确定 $f(n)$ 变号的区间 $[n_j, n_{j+1}]$，这些区间限定了简单的实数根。\n6. 对每个变号区间应用稳健的区间求根算法（如 Brent 方法）来计算根 $n$。通过在小容差范围内聚类来滤除重复根，并舍弃非正或复数结果（后者不会出现，因为 $f(n)$ 是实函数且区间限定确保了实数根）。\n7. 对每种情况得到的所有正实数根进行排序。将每个根四舍五入到六位小数以便输出。\n\n稳健性论证：\n- 函数 $f(n)$ 是光滑的，除了在分母 $\\omega^2 - \\Omega_s^2$ 为零的共振点；所提供的测试用例通过选择 $\\omega$ 不等于 $\\pm \\Omega_s$ 来避免了直接的奇点。在 $P \\approx 0$ 的截止点附近或在强各向异性处，$f(n)$ 可能会表现出陡峭的特征。密集的采样和区间限定确保能够捕捉到符号变化。对于有界定的连续函数，Brent 方法保证收敛。\n- 对于具有轴对称 $\\boldsymbol{\\varepsilon}$ 的冷等离子体，折射率仅依赖于 $\\theta$，因此选择方位角 $\\phi=0$ 不失一般性。\n\n复杂度和实现说明：\n- 每次计算 $f(n)$ 需要一个 $3 \\times 3$ 行列式，其成本为 $\\mathcal{O}(1)$，因此在大小为 $M$ 的网格上采样，每个角度的成本为 $\\mathcal{O}(M)$。每个区间的求根开销可以忽略不计。\n- 需要使用的数值常数包括 $\\epsilon_0$、$\\mu_0$、$e$、$m_e$ 和 $m_p$，均采用国际单位制。\n\n该程序实例化四个测试用例，为每个用例计算根列表，并按要求打印一行包含浮点数列表的列表，每个浮点数四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\n# Physical constants (SI units)\nepsilon0 = 8.854187817e-12  # F/m\nmu0 = 1.2566370614e-6       # H/m\nc = 1.0 / np.sqrt(epsilon0 * mu0)\ne_charge = 1.602176634e-19  # C\nm_e = 9.1093837015e-31      # kg\nm_p = 1.67262192369e-27     # kg\n\ndef stix_parameters(n_e, B0, omega, ion_mass_factor=2.0):\n    \"\"\"\n    Compute Stix cold plasma parameters S, D, P for electrons and a single ion species.\n    Assumes quasi-neutrality n_i = n_e and Z = 1. Ion mass = ion_mass_factor * m_p.\n    \"\"\"\n    # Electrons\n    q_e = -e_charge\n    me = m_e\n    ne = n_e\n    omega_pe2 = ne * q_e * q_e / (epsilon0 * me)  # note q^2 -> positive\n    Omega_e = q_e * B0 / me  # signed\n\n    # Ions (deuterium by default)\n    q_i = e_charge\n    mi = ion_mass_factor * m_p\n    ni = n_e\n    omega_pi2 = ni * q_i * q_i / (epsilon0 * mi)\n    Omega_i = q_i * B0 / mi\n\n    # S, D, P\n    # Avoid division by zero at exact resonances; test suite avoids exact singularities.\n    S = 1.0 - (omega_pe2 / (omega**2 - Omega_e**2) + omega_pi2 / (omega**2 - Omega_i**2))\n    D = (Omega_e / omega) * (omega_pe2 / (omega**2 - Omega_e**2)) + (Omega_i / omega) * (omega_pi2 / (omega**2 - Omega_i**2))\n    P = 1.0 - (omega_pe2 + omega_pi2) / (omega**2)\n    return S, D, P\n\ndef epsilon_tensor(S, D, P):\n    \"\"\"\n    Construct the cold plasma dielectric tensor (Stix form) in the (x,y,z) basis aligned to B0 || z.\n    \"\"\"\n    return np.array([\n        [S, -1j * D, 0.0],\n        [1j * D,  S,  0.0],\n        [0.0,  0.0,  P]\n    ], dtype=complex)\n\ndef det_dispersion(n, khat, eps_tensor):\n    \"\"\"\n    Compute the real determinant of the dispersion tensor K(N,omega) = N N - N^2 I + epsilon,\n    with N = n * khat.\n    \"\"\"\n    Nvec = n * khat\n    N2 = n * n\n    # Outer product N N\n    NN = np.outer(Nvec, Nvec)\n    I = np.eye(3, dtype=complex)\n    K = NN - N2 * I + eps_tensor\n    detK = np.linalg.det(K)\n    # For collisionless plasma, K is Hermitian; det is real. Return real part for numerical robustness.\n    return float(np.real(detK))\n\ndef find_roots_for_case(B0, n_e, omega, theta, n_min=1e-6, n_max=10.0, grid_points=4000):\n    \"\"\"\n    For a given case, compute the real positive roots n of det K(n k_hat, omega) = 0.\n    Uses sign-change bracketing and Brent's method.\n    \"\"\"\n    # Species and dielectric parameters\n    S, D, P = stix_parameters(n_e, B0, omega, ion_mass_factor=2.0)\n    eps = epsilon_tensor(S, D, P)\n    # Direction khat in axisymmetric cold plasma (phi=0 suffices)\n    khat = np.array([np.sin(theta), 0.0, np.cos(theta)], dtype=float)\n\n    # Sample f(n) on a grid\n    ns = np.linspace(n_min, n_max, grid_points)\n    fvals = np.array([det_dispersion(n, khat, eps) for n in ns])\n\n    # Identify sign changes\n    roots = []\n    for i in range(len(ns) - 1):\n        f1 = fvals[i]\n        f2 = fvals[i + 1]\n        n1 = ns[i]\n        n2 = ns[i + 1]\n        # Skip NaNs or infs\n        if not np.isfinite(f1) or not np.isfinite(f2):\n            continue\n        # Check for sign change or very close to zero\n        if f1 == 0.0:\n            candidate = n1\n            if candidate > 0:\n                roots.append(candidate)\n        elif f2 == 0.0:\n            candidate = n2\n            if candidate > 0:\n                roots.append(candidate)\n        elif f1 * f2 < 0.0:\n            try:\n                r = brentq(lambda n: det_dispersion(n, khat, eps), n1, n2, maxiter=100, xtol=1e-12, rtol=1e-10)\n                if r > 0:\n                    roots.append(r)\n            except Exception:\n                # If Brent fails, skip this interval\n                pass\n\n    # Deduplicate roots within tolerance\n    roots_sorted = sorted(roots)\n    unique_roots = []\n    tol = 1e-3  # merge roots closer than this\n    for r in roots_sorted:\n        if len(unique_roots) == 0 or abs(r - unique_roots[-1]) > tol:\n            unique_roots.append(r)\n\n    # Round to six decimals\n    rounded = [float(f\"{r:.6f}\") for r in unique_roots]\n    return rounded\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (B0 [T], n_e [m^-3], omega [rad/s], theta [rad])\n        (5.0, 5.0e19, 1.20e12, 0.0),             # Case 1: happy path, parallel\n        (5.0, 5.0e19, 1.20e12, np.pi / 4.0),     # Case 2: oblique\n        (5.0, 5.0e19, 1.20e12, np.pi / 2.0),     # Case 3: perpendicular\n        (5.0, 5.0e19, 4.20e11, np.pi / 3.0),     # Case 4: near cutoff edge case\n    ]\n\n    results = []\n    for B0, n_e, omega, theta in test_cases:\n        roots = find_roots_for_case(B0, n_e, omega, theta)\n        results.append(roots)\n\n    # Format the final output: single line, list of lists with comma-separated floats.\n    # Build string representation manually to control formatting.\n    def format_list(lst):\n        return \"[\" + \",\".join(f\"{x:.6f}\" if isinstance(x, float) else str(x) for x in lst) + \"]\"\n\n    outer = \"[\" + \",\".join(format_list(r) for r in results) + \"]\"\n    print(outer)\n\nsolve()\n```"
        },
        {
            "introduction": "模式转换是一种复杂但重要的物理现象，波的能量可以在不同模式之间转移，这在等离子体波加热和电流驱动中至关重要。这项高级练习旨在解决在这些区域中数值解析快速极化变化所带来的实际挑战。你将通过分析一个简化模型来推导自适应步长选择的判据，并量化数值积分误差，从而掌握确保波传播模拟准确性的关键技术。",
            "id": "4064617",
            "problem": "在计算聚变科学与工程的背景下，考虑波在磁化冷等离子体中的传播。从各向异性介质中的麦克斯韦方程组出发，冷等离子体的介电响应导致了多个折射率曲面和模式偏振态。在模式转换层附近，色散关系的两个分支趋于简并并发生耦合，导致局部偏振矢量的快速旋转。在一个在转换层附近有效的简化双模描述中，主导耦合子空间的局部本征问题可以用一个形式如下的厄米算符 $H(s)$ 来建模：\n$$\nH(s) = \\begin{pmatrix}\n\\Delta(s)/2  g \\\\\ng  -\\Delta(s)/2\n\\end{pmatrix},\n$$\n其中 $s$ 是沿射线的路径坐标（单位为米），$\\Delta(s)$ 是局部失谐，表示非耦合折射率曲面之间的差异，被视为线性关系 $\\Delta(s) = a \\,(s - s_c)$，其中 $a$ 的单位是 $\\text{m}^{-1}$，$s_c$ 是转换层的位置（单位为米），而 $g$ 是一个实数耦合系数，用于参数化两个模式之间相互作用的强度。设 $H(s)$ 的上分支本征值表示为 $\\lambda_{+}(s)$，其对应的本征矢量定义了非耦合基模之间的局部偏振混合角 $\\theta(s)$。\n\n任务：\n- 基于麦克斯韦方程组和简化模式厄米算符 $H(s)$，通过基于原理的推导，获得上分支的偏振混合角 $\\theta(s)$ 作为 $\\Delta(s)$ 和 $g$ 的函数，并推导其空间导数 $d\\theta/ds$。\n- 使用推导出的 $d\\theta/ds$，获得一个步长要求 $h_{\\max}$，以确保在沿 $s$ 的最快偏振旋转点处，$\\theta$ 的每步变化不超过指定的界限 $\\varepsilon_{\\theta}$（单位为弧度）。提供 $h_{\\max}$ 关于 $a$、$g$ 和 $\\varepsilon_{\\theta}$ 的公式。\n- 将上分支的局部折射率定义为 $n_{+}(s) = n_b + \\alpha \\,\\lambda_{+}(s)$，其中 $n_b$ 是一个基线折射率（无量纲），$\\alpha$ 是一个无量纲缩放因子，用于将本征值映射到折射率修正。局部波数为 $k(s) = k_0 \\, n_{+}(s)$，其中 $k_0$ 是一个恒定的基线波数，单位为 $\\text{rad}/\\text{m}$。使用 $H(s)$ 的上分支本征值，推导累积相位 $\\phi_{\\text{exact}} = \\int_{s_0}^{s_1} k(s)\\, ds$（单位为弧度）的闭式表达式，并设计一个梯形法则数值积分，使用均匀步长 $h \\le h_{\\max}$ 来计算 $\\phi_{\\text{num}}$。\n- 量化绝对相位误差 $|\\phi_{\\text{num}} - \\phi_{\\text{exact}}|$（单位为弧度）和最大绝对偏振角误差 $\\max_{s \\in [s_0,s_1]} |\\theta_{\\text{num}}(s) - \\theta_{\\text{exact}}(s)|$（单位为弧度），其中 $\\theta_{\\text{num}}(s)$ 是通过从 $\\theta_{\\text{exact}}(s_0)$ 开始，使用步长 $h$ 对 $d\\theta/ds$ 进行前向欧拉积分得到的。\n\n您的程序必须实现上述任务，并为以下测试套件生成数值结果。所有角度单位必须是弧度，长度单位为米，波数单位为 $\\text{rad}/\\text{m}$。对于每个测试用例，使用 $h = (s_1 - s_0)/N$，其中 $N = \\lceil (s_1 - s_0)/h_{\\max} \\rceil$。\n\n测试套件：\n1. 情况 A (正常路径): $a = 200.0$, $g = 0.25$, $s_0 = -0.05$, $s_1 = 0.05$, $s_c = 0.0$, $k_0 = 2\\pi/0.03$, $n_b = 1.7$, $\\alpha = 0.12$, $\\varepsilon_{\\theta} = 0.01$。\n2. 情况 B (边界，急剧旋转): $a = 500.0$, $g = 0.02$, $s_0 = -0.05$, $s_1 = 0.05$, $s_c = 0.0$, $k_0 = 2\\pi/0.03$, $n_b = 1.4$, $\\alpha = 0.09$, $\\varepsilon_{\\theta} = 0.01$。\n3. 情况 C (边缘，宽旋转和更长路径): $a = 100.0$, $g = 0.60$, $s_0 = -0.10$, $s_1 = 0.10$, $s_c = 0.0$, $k_0 = 2\\pi/0.06$, $n_b = 2.0$, $\\alpha = 0.08$, $\\varepsilon_{\\theta} = 0.01$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的列表的逗号分隔列表形式的结果。对于每个测试用例，输出三元组 $[h_{\\max}, |\\phi_{\\text{num}} - \\phi_{\\text{exact}}|, \\max|\\theta_{\\text{num}} - \\theta_{\\text{exact}}|]$。最终打印的行必须具有以下格式：\n$[[h_{\\max}^{(A)}, \\text{phase\\_error}^{(A)}, \\text{theta\\_error}^{(A)}],[h_{\\max}^{(B)}, \\text{phase\\_error}^{(B)}, \\text{theta\\_error}^{(B)}],[h_{\\max}^{(C)}, \\text{phase\\_error}^{(C)}, \\text{theta\\_error}^{(C)}]]$。",
            "solution": "问题陈述已经过严格验证，被认为是自洽的、有科学依据且定义明确的。它提出了一个用于等离子体物理中波模转换的标准简化模型，这是计算聚变科学中的一个重要课题。所有参数都已明确定义，且任务在数学上和计算上都是可行的。不存在矛盾、歧义或违反物理原理之处。\n\n我们接下来对所需量进行基于原理的推导。\n\n1.  **偏振角 $\\theta(s)$ 及其导数 $d\\theta/ds$ 的推导**\n\n局部本征问题由厄米算符 $H(s)$ 定义：\n$$\nH(s) = \\begin{pmatrix}\n\\Delta(s)/2  g \\\\\ng  -\\Delta(s)/2\n\\end{pmatrix}\n$$\n通过求解特征方程 $\\det(H(s) - \\lambda I) = 0$ 来找到本征值 $\\lambda$：\n$$\n\\left(\\frac{\\Delta(s)}{2} - \\lambda\\right)\\left(-\\frac{\\Delta(s)}{2} - \\lambda\\right) - g^2 = 0 \\implies \\lambda^2 - \\left(\\frac{\\Delta(s)}{2}\\right)^2 - g^2 = 0\n$$\n这给出了本征值 $\\lambda_{\\pm}(s) = \\pm\\sqrt{g^2 + (\\Delta(s)/2)^2}$。上分支的本征值为：\n$$\n\\lambda_{+}(s) = \\sqrt{g^2 + \\left(\\frac{\\Delta(s)}{2}\\right)^2}\n$$\n对应的本征矢量 $v_+ = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$ 可以通过偏振混合角 $\\theta(s)$ 参数化为 $v_+ \\propto \\begin{pmatrix} \\cos\\theta(s) \\\\ \\sin\\theta(s) \\end{pmatrix}$。本征方程 $(H(s) - \\lambda_+ I)v_+ = 0$ 给出以下关系：\n$$\ng v_1 + \\left(-\\frac{\\Delta(s)}{2} - \\lambda_{+}(s)\\right) v_2 = 0 \\implies \\tan\\theta(s) = \\frac{v_2}{v_1} = \\frac{g}{\\lambda_{+}(s) + \\Delta(s)/2}\n$$\n为了获得一个能正确通过转换层 $s=s_c$（此处 $\\Delta(s_c)=0$）的 $\\theta(s)$ 的连续表示，我们定义一个角度 $\\phi(s)$，使得 $\\sin\\phi(s) = g/\\lambda_{+}(s)$ 且 $\\cos\\phi(s) = (\\Delta(s)/2)/\\lambda_{+}(s)$。那么本征矢量正比于 $\\begin{pmatrix} \\cos(\\phi/2) \\\\ \\sin(\\phi/2) \\end{pmatrix}$，这意味着 $\\theta(s) = \\phi(s)/2$。假设 $g>0$，角度 $\\phi(s)$ 的范围从 $\\pi$（当 $s \\to -\\infty$）到 $0$（当 $s \\to \\infty$）。因此，可以使用反余弦函数唯一地确定 $2\\theta(s)$：\n$$\n2\\theta(s) = \\arccos\\left(\\frac{\\Delta(s)/2}{\\lambda_{+}(s)}\\right) = \\arccos\\left(\\frac{\\Delta(s)}{\\sqrt{4g^2 + \\Delta(s)^2}}\\right)\n$$\n因此，上分支的偏振混合角为：\n$$\n\\theta(s) = \\frac{1}{2} \\arccos\\left(\\frac{\\Delta(s)}{\\sqrt{4g^2 + \\Delta(s)^2}}\\right)\n$$\n为了求空间导数 $d\\theta/ds$，我们使用链式法则：$d\\theta/ds = (d\\theta/d\\Delta) \\cdot (d\\Delta/ds)$。给定 $\\Delta(s) = a(s-s_c)$，我们有 $d\\Delta/ds = a$。使用另一种形式 $\\tan(2\\theta) = 2g/\\Delta$，我们对 $\\Delta$ 求导：\n$$\n\\sec^2(2\\theta) \\cdot 2\\frac{d\\theta}{d\\Delta} = -\\frac{2g}{\\Delta^2}\n$$\n由于 $\\tan^2(2\\theta) = (2g/\\Delta)^2$，我们有 $\\sec^2(2\\theta) = 1 + \\tan^2(2\\theta) = 1 + 4g^2/\\Delta^2 = (\\Delta^2+4g^2)/\\Delta^2$。\n$$\n\\frac{\\Delta^2+4g^2}{\\Delta^2} \\cdot 2\\frac{d\\theta}{d\\Delta} = -\\frac{2g}{\\Delta^2} \\implies \\frac{d\\theta}{d\\Delta} = -\\frac{g}{\\Delta^2+4g^2}\n$$\n乘以 $d\\Delta/ds = a$，我们得到空间导数：\n$$\n\\frac{d\\theta}{ds} = \\frac{-ag}{[a(s-s_c)]^2 + 4g^2}\n$$\n\n2.  **步长要求 $h_{\\max}$ 的推导**\n\n偏振旋转速率 $|d\\theta/ds|$ 在表达式分母最小时达到最大值。这发生在 $s=s_c$ 处，此时 $\\Delta(s)=0$：\n$$\n\\left|\\frac{d\\theta}{ds}\\right|_{\\max} = \\left|\\frac{-ag}{4g^2}\\right| = \\frac{a}{4|g|}\n$$\n假设 $g>0$（因为它是一个耦合强度），则最大值为 $a/(4g)$。问题要求 $\\theta$ 的每步变化量受 $\\varepsilon_{\\theta}$ 限制。使用一阶近似，有 $|\\Delta\\theta| \\approx |d\\theta/ds| \\cdot h$。在旋转最快的点，我们必须满足：\n$$\n\\left(\\frac{a}{4g}\\right)h_{\\max} \\le \\varepsilon_{\\theta}\n$$\n求解 $h_{\\max}$，我们得到步长要求：\n$$\nh_{\\max} = \\frac{4g\\varepsilon_{\\theta}}{a}\n$$\n\n3.  **累积相位 $\\phi_{\\text{exact}}$ 的推导**\n\n局部波数为 $k(s) = k_0 n_{+}(s)$，其中 $n_{+}(s) = n_b + \\alpha\\lambda_{+}(s)$。代入 $\\lambda_+(s)$ 和 $\\Delta(s)$ 的表达式：\n$$\nk(s) = k_0 \\left( n_b + \\alpha \\sqrt{g^2 + \\frac{a^2}{4}(s-s_c)^2} \\right)\n$$\n从 $s_0$到 $s_1$ 的总累积相位 $\\phi_{\\text{exact}}$ 是 $k(s)$ 的积分：\n$$\n\\phi_{\\text{exact}} = \\int_{s_0}^{s_1} k(s) ds = \\int_{s_0}^{s_1} k_0 n_b ds + \\int_{s_0}^{s_1} k_0 \\alpha \\sqrt{g^2 + \\frac{a^2}{4}(s-s_c)^2} ds\n$$\n第一个积分很简单：$k_0 n_b (s_1 - s_0)$。对于第二个积分，令 $u = s-s_c$ 和 $b=2g/a$。该积分变为：\n$$\nk_0 \\alpha \\int_{s_0-s_c}^{s_1-s_c} \\sqrt{g^2 + \\frac{a^2}{4}u^2} du = k_0 \\alpha \\frac{a}{2} \\int_{s_0-s_c}^{s_1-s_c} \\sqrt{\\left(\\frac{2g}{a}\\right)^2 + u^2} du\n$$\n使用标准积分 $\\int \\sqrt{b^2+u^2}du = \\frac{u}{2}\\sqrt{b^2+u^2} + \\frac{b^2}{2}\\text{arcsinh}\\left(\\frac{u}{b}\\right)$，我们找到相位第二部分的闭式表达式：\n$$\nI_2(s) = k_0 \\alpha \\left[ \\frac{(s-s_c)\\lambda_+(s)}{2} + \\frac{g^2}{a}\\text{arcsinh}\\left(\\frac{a(s-s_c)}{2g}\\right) \\right]\n$$\n那么总的精确相位是 $\\phi_{\\text{exact}} = k_0 n_b (s_1 - s_0) + I_2(s_1) - I_2(s_0)$。\n\n4.  **数值误差量化**\n\n解决该问题的算法如下：\n- 对于每个测试用例，使用推导出的公式计算 $h_{\\max}$。\n- 确定步数 $N = \\lceil (s_1-s_0)/h_{\\max} \\rceil$ 和均匀步长 $h = (s_1-s_0)/N$。\n- 创建一个包含 $N+1$ 个点的网格 $s_i = s_0 + ih$，其中 $i=0, \\dots, N$。\n- 使用步骤3中推导的解析公式计算精确相位 $\\phi_{\\text{exact}}$。\n- 通过在网格 $s_i$ 上对函数 $k(s)$ 应用梯形法则来计算数值相位 $\\phi_{\\text{num}}$。相位误差为 $|\\phi_{\\text{num}} - \\phi_{\\text{exact}}|$。\n- 使用步骤1中的 `arccos` 公式计算每个网格点上的精确偏振角 $\\theta_{\\text{exact}}(s_i)$。\n- 通过应用前向欧拉方法计算数值偏振角 $\\theta_{\\text{num}}(s_i)$：$\\theta_{\\text{num}}(s_{i+1}) = \\theta_{\\text{num}}(s_i) + h \\cdot (d\\theta/ds)(s_i)$，从 $\\theta_{\\text{num}}(s_0) = \\theta_{\\text{exact}}(s_0)$ 开始。\n- 最大偏振角误差为 $\\max_{i} |\\theta_{\\text{num}}(s_i) - \\theta_{\\text{exact}}(s_i)|$。\n\n这种结合了解析推导和标准数值方法的结构化方法将被用来生成所需的结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the wave propagation problem for the given test suite.\n    \"\"\"\n\n    test_cases = [\n        # Case A: Happy path\n        {'a': 200.0, 'g': 0.25, 's0': -0.05, 's1': 0.05, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.03, 'nb': 1.7, 'alpha': 0.12, 'epsilon_theta': 0.01},\n        # Case B: Boundary, sharp rotation\n        {'a': 500.0, 'g': 0.02, 's0': -0.05, 's1': 0.05, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.03, 'nb': 1.4, 'alpha': 0.09, 'epsilon_theta': 0.01},\n        # Case C: Edge, broad rotation and longer path\n        {'a': 100.0, 'g': 0.60, 's0': -0.10, 's1': 0.10, 'sc': 0.0,\n         'k0': 2 * np.pi / 0.06, 'nb': 2.0, 'alpha': 0.08, 'epsilon_theta': 0.01},\n    ]\n\n    all_results = []\n    for params in test_cases:\n        a = params['a']\n        g = params['g']\n        s0 = params['s0']\n        s1 = params['s1']\n        sc = params['sc']\n        k0 = params['k0']\n        nb = params['nb']\n        alpha = params['alpha']\n        epsilon_theta = params['epsilon_theta']\n\n        # Task 2: Calculate h_max\n        h_max = (4 * g * epsilon_theta) / a\n\n        # Setup numerical grid\n        N = int(np.ceil((s1 - s0) / h_max))\n        h = (s1 - s0) / N\n        s_grid = np.linspace(s0, s1, N + 1)\n\n        # Helper functions based on derivations\n        def delta_s(s):\n            return a * (s - sc)\n\n        def lambda_plus(s):\n            return np.sqrt(g**2 + (delta_s(s) / 2)**2)\n\n        def k_s(s):\n            return k0 * (nb + alpha * lambda_plus(s))\n\n        def theta_exact(s):\n            ds = delta_s(s)\n            denominator = np.sqrt(4 * g**2 + ds**2)\n            # handle case where denominator is zero (g=0, s=sc) to avoid division by zero\n            # In this problem g > 0, so denominator is never zero.\n            arg = ds / denominator\n            # Clip argument for arccos to handle potential floating point inaccuracies\n            arg = np.clip(arg, -1.0, 1.0)\n            return 0.5 * np.arccos(arg)\n\n        def dtheta_ds(s):\n            return (-a * g) / (delta_s(s)**2 + 4 * g**2)\n\n        # Task 3: Calculate exact and numerical phase\n        def phase_integral_term(s):\n            if g == 0:  # Avoid division by zero in arcsinh\n                return k0 * alpha * (s - sc) * lambda_plus(s) / 2\n            return k0 * alpha * (\n                (s - sc) * lambda_plus(s) / 2 +\n                (g**2 / a) * np.arcsinh(a * (s - sc) / (2 * g))\n            )\n\n        phi_exact = k0 * nb * (s1 - s0) + (phase_integral_term(s1) - phase_integral_term(s0))\n        \n        k_values = k_s(s_grid)\n        phi_num = np.trapz(k_values, dx=h) # or np.trapz(k_values, s_grid)\n        phase_error = np.abs(phi_num - phi_exact)\n\n        # Task 4: Calculate polarization angle error\n        theta_exact_values = theta_exact(s_grid)\n\n        theta_num_values = np.zeros(N + 1)\n        theta_num_values[0] = theta_exact_values[0]\n\n        for i in range(N):\n            s_i = s_grid[i]\n            theta_num_values[i+1] = theta_num_values[i] + h * dtheta_ds(s_i)\n        \n        theta_error = np.max(np.abs(theta_num_values - theta_exact_values))\n        \n        all_results.append([h_max, phase_error, theta_error])\n\n    # Format the final output string\n    # e.g., [[val1, val2, val3],[val4,val5,val6]]\n    result_str = \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in all_results])\n    print(f\"[{result_str}]\")\n\n\nsolve()\n```"
        }
    ]
}