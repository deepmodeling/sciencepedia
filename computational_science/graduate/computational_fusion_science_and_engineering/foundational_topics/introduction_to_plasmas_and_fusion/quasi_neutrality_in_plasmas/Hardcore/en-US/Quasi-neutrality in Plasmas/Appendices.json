{
    "hands_on_practices": [
        {
            "introduction": "The concept of quasi-neutrality is a powerful approximation, but it is not exact, as a small charge imbalance must exist to support electric fields. This foundational exercise  explores this by having you derive the fractional space charge required to balance an electron pressure gradient. The result reveals the crucial scaling for charge imbalance, on the order of $\\frac{\\lambda_{De}^{2}}{L_{n}^{2}}$, providing deep insight into why the approximation is so effective for large-scale plasmas.",
            "id": "4034988",
            "problem": "Consider a collisionless, electrostatic plasma in a slab geometry with spatial variation only along the $x$-direction and an electric field $\\mathbf{E}(x) = E_{x}(x)\\,\\hat{\\mathbf{x}}$. Assume steady state, so that time derivatives vanish. Let the charge density be $\\rho(x) = e\\left(\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x)\\right)$, where $e$ is the elementary charge, $Z_{s}$ and $n_{s}(x)$ are the charge state and number density of ion species $s$, and $n_{e}(x)$ is the electron number density. The electric field is determined self-consistently by Gauss’s law in the International System of Units (SI), $\\nabla \\cdot \\mathbf{E} = \\rho/\\varepsilon_{0}$, where $\\varepsilon_{0}$ is the vacuum permittivity.\n\nSuppose that the electrons are isothermal with temperature $T_{e}$ and satisfy steady, inertialess force balance in the $x$-direction, so that the electron pressure gradient balances the electrostatic force. Let the electron pressure be $p_{e}(x) = n_{e}(x)\\,k_{B}T_{e}$, where $k_{B}$ is the Boltzmann constant. Define the electron Debye length $\\lambda_{De}$ by $\\lambda_{De}^{2} \\equiv \\varepsilon_{0} k_{B} T_{e}/(e^{2} n_{e})$, and define a characteristic density scale length $L_{n}$ by $L_{n}^{-1} \\equiv \\left| \\partial_{x} \\ln n_{e} \\right|$. Treat $L_{n}$ as the local characteristic scale and use order-of-magnitude reasoning to estimate derivatives.\n\nStarting from the fundamental relations stated above, use Gauss’s law together with the electron force balance to obtain an order-of-magnitude expression for the fractional residual space charge,\n\n$$\n\\frac{\\left|\\sum_{s} Z_{s} n_{s} - n_{e}\\right|}{n_{e}}\\,,\n$$\n\nin terms of $\\lambda_{De}$ and $L_{n}$. Provide your final answer as a single closed-form analytical expression. Also indicate, in words within your derivation, the condition under which the residual space charge is negligible (the quasi-neutrality condition), but your final boxed answer must be only the requested analytical expression without units.",
            "solution": "The derivation begins by utilizing the two key physical laws provided: Gauss's law and the electron force balance equation.\n\nIn the one-dimensional slab geometry where quantities vary only along the $x$-direction, Gauss's law, $\\nabla \\cdot \\mathbf{E} = \\rho/\\varepsilon_{0}$, reduces to a scalar equation involving the derivative of the electric field component $E_x(x)$:\n$$\n\\frac{dE_x}{dx} = \\frac{\\rho(x)}{\\varepsilon_0}\n$$\nSubstituting the given expression for the charge density, $\\rho(x) = e\\left(\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x)\\right)$, into Gauss's law, we obtain:\n$$\n\\frac{dE_x}{dx} = \\frac{e}{\\varepsilon_0} \\left( \\sum_{s} Z_{s} n_{s}(x) - n_{e}(x) \\right)\n$$\nThis equation establishes a direct relationship between the spatial gradient of the electric field and the local net charge separation in the plasma.\n\nNext, we formulate the steady, inertialess force balance for the electron fluid. The problem states that the electrostatic force on the electrons is balanced by the electron pressure gradient. In one dimension, the electrostatic force density (force per unit volume) is given by $-en_e(x)E_x(x)$, and the force density due to the pressure gradient is $-\\frac{dp_e}{dx}$. The equilibrium condition is thus expressed as:\n$$\n-en_e(x)E_x(x) - \\frac{dp_e}{dx} = 0\n$$\nThe electron pressure is given by the ideal gas law for an isothermal species, $p_e(x) = n_e(x)k_B T_e$, where the electron temperature $T_e$ is a constant. Substituting this into the force balance equation yields:\n$$\n-en_e(x)E_x(x) - \\frac{d}{dx}\\left(n_e(x)k_B T_e\\right) = 0\n$$\nSince $k_B$ and $T_e$ are constants, they can be factored out of the derivative:\n$$\n-en_e(x)E_x(x) - k_B T_e \\frac{dn_e}{dx} = 0\n$$\nWe can solve this equation for the electric field $E_x(x)$:\n$$\nE_x(x) = -\\frac{k_B T_e}{e n_e(x)} \\frac{dn_e}{dx}\n$$\nThis expression is commonly known as the Boltzmann relation for electrons. It is often useful to rewrite it using the identity for the derivative of a natural logarithm, $\\frac{d(\\ln u)}{dx} = \\frac{1}{u}\\frac{du}{dx}$, which gives:\n$$\nE_x(x) = -\\frac{k_B T_e}{e} \\frac{d}{dx} \\left( \\ln n_e(x) \\right)\n$$\nTo find the net charge density, we must connect the force balance equation with Gauss's law. We do this by differentiating the expression for $E_x(x)$ with respect to $x$:\n$$\n\\frac{dE_x}{dx} = \\frac{d}{dx} \\left[ -\\frac{k_B T_e}{e} \\frac{d}{dx} \\left( \\ln n_e(x) \\right) \\right] = -\\frac{k_B T_e}{e} \\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right)\n$$\nNow we have two distinct expressions for $\\frac{dE_x}{dx}$. Equating them allows us to eliminate the electric field:\n$$\n\\frac{e}{\\varepsilon_0} \\left( \\sum_{s} Z_{s} n_{s}(x) - n_{e}(x) \\right) = -\\frac{k_B T_e}{e} \\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right)\n$$\nWe can now isolate the net charge density term, $\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x)$:\n$$\n\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x) = -\\frac{\\varepsilon_0 k_B T_e}{e^2} \\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right)\n$$\nTo find the fractional residual space charge, we divide both sides by the electron number density, $n_e(x)$:\n$$\n\\frac{\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x)}{n_{e}(x)} = -\\frac{\\varepsilon_0 k_B T_e}{e^2 n_e(x)} \\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right)\n$$\nWe recognize the prefactor as the square of the electron Debye length, which is defined as $\\lambda_{De}^{2} \\equiv \\frac{\\varepsilon_0 k_B T_e}{e^{2} n_{e}}$. Substituting this definition yields the Poisson-Boltzmann equation in this context:\n$$\n\\frac{\\sum_{s} Z_{s} n_{s}(x) - n_{e}(x)}{n_{e}(x)} = -\\lambda_{De}^2 \\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right)\n$$\nThe final step is to perform an order-of-magnitude estimation as requested. The characteristic density scale length $L_n$ is defined by $L_n^{-1} \\equiv \\left| \\partial_x \\ln n_e \\right|$. For an order-of-magnitude analysis, a derivative operator like $\\frac{d}{dx}$ can be approximated as division by the characteristic length scale of the variation, which is $L_n$. Therefore, we have:\n$$\n\\frac{d}{dx} \\left( \\ln n_e(x) \\right) \\sim \\mathcal{O}\\left(\\frac{1}{L_n}\\right)\n$$\nConsequently, the second derivative is estimated as:\n$$\n\\frac{d^2}{dx^2} \\left( \\ln n_e(x) \\right) = \\frac{d}{dx} \\left[ \\frac{d}{dx}\\left( \\ln n_e(x) \\right) \\right] \\sim \\frac{1}{L_n} \\mathcal{O}\\left(\\frac{1}{L_n}\\right) = \\mathcal{O}\\left(\\frac{1}{L_n^2}\\right)\n$$\nSubstituting this order-of-magnitude estimate into our equation for the fractional charge imbalance gives:\n$$\n\\frac{\\sum_{s} Z_{s} n_{s} - n_{e}}{n_{e}} \\sim \\mathcal{O}\\left(-\\lambda_{De}^2 \\frac{1}{L_n^2}\\right)\n$$\nThe problem asks for the magnitude of this quantity, which is found by taking the absolute value:\n$$\n\\frac{\\left|\\sum_{s} Z_{s} n_{s} - n_{e}\\right|}{n_{e}} \\sim \\frac{\\lambda_{De}^2}{L_n^2}\n$$\nThe residual space charge is considered negligible, and the plasma is said to be quasi-neutral, when this fractional quantity is much less than unity. This leads to the well-known quasi-neutrality condition: that the electron Debye length must be much smaller than the characteristic scale length of density variations, or $\\lambda_{De} \\ll L_n$.",
            "answer": "$$\n\\boxed{\\frac{\\lambda_{De}^{2}}{L_{n}^{2}}}\n$$"
        },
        {
            "introduction": "Building on the previous theoretical insight, this exercise transitions to a practical application where the Debye length serves as a key diagnostic. In this practice , you will calculate the Debye length, $\\lambda_D$, for realistic fusion plasma parameters. You will then use this value to test the validity of the quasi-neutral approximation for a specific plasma wave, demonstrating how this fundamental parameter is used as a critical litmus test in plasma modeling.",
            "id": "4035035",
            "problem": "Consider an electrostatic perturbation in the core of a tokamak plasma, where singly ionized ions are treated as an immobile, neutralizing background on the fast electron response timescale. Let the unperturbed electron density be $n_{0}$ and the electron temperature be $T_{e}$. Use Gauss’s law (Poisson’s equation) and the linearized Boltzmann response of electrons to derive the characteristic electrostatic screening length (Debye length) $\\,\\lambda_{D}\\,$ as a function of $n_{0}$ and $T_{e}$, starting from first principles. Then, for representative core tokamak values $\\,n_{e} = 10^{20}\\,\\mathrm{m}^{-3}\\,$ and $\\,T_{e} = 5\\,\\mathrm{keV}\\,$, compute $\\,\\lambda_{D}\\,$ and evaluate the dimensionless parameter $\\,k \\lambda_{D}\\,$ for a perturbation wavenumber $\\,k = 10\\,\\mathrm{m}^{-1}\\,$ to assess the validity of the quasi-neutral approximation at that scale.\n\nUse the following physical constants: elementary charge $\\,e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}\\,$, vacuum permittivity $\\,\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}\\,$, and the energy conversion $\\,1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}\\,$. The electron temperature is $T_e = 5\\,\\mathrm{keV}$; this notation, common in plasma physics, indicates that the thermal energy $k_B T_e$ is equal to $5\\,\\mathrm{keV}$.\n\nExpress the final Debye length in meters and the product $\\,k \\lambda_{D}\\,$ as a unitless decimal. Round both results to four significant figures. The final answer must contain only the two requested values.",
            "solution": "The derivation begins with Poisson's equation, which relates the electrostatic potential $\\phi$ to the net charge density $\\rho_c$:\n$$ \\varepsilon_0 \\nabla^2 \\phi = -\\rho_c $$\nThe net charge density is the sum of the charge densities of ions and electrons. The ions are singly ionized, so their charge is $+e$, and their density is $n_i$. The electrons have charge $-e$ and density $n_e$. Thus,\n$$ \\rho_c = e n_i - e n_e $$\nThe problem states that the ions form an immobile, neutralizing background. This implies that the ion density is constant and equal to the unperturbed electron density, $n_i = n_0$. The plasma is assumed to be neutral in its unperturbed state.\nPoisson's equation becomes:\n$$ \\varepsilon_0 \\nabla^2 \\phi = -e(n_i - n_e) = e(n_e - n_0) $$\nNext, we employ the Boltzmann response for the electrons. In thermal equilibrium, the electron density in the presence of an electrostatic potential $\\phi$ is given by:\n$$ n_e(\\mathbf{r}) = n_0 \\exp\\left(\\frac{e\\phi(\\mathbf{r})}{k_B T_e}\\right) $$\nwhere $k_B$ is the Boltzmann constant and $T_e$ is the electron temperature.\nWe are asked to linearize this response, which is valid for small potential perturbations where the potential energy is much smaller than the thermal energy, i.e., $|e\\phi| \\ll k_B T_e$. We can use the Taylor series expansion for the exponential, $\\exp(x) \\approx 1 + x$ for small $x$:\n$$ n_e \\approx n_0 \\left(1 + \\frac{e\\phi}{k_B T_e}\\right) $$\nSubstituting this linearized electron density back into Poisson's equation gives:\n$$ \\varepsilon_0 \\nabla^2 \\phi = e \\left[ n_0 \\left(1 + \\frac{e\\phi}{k_B T_e}\\right) - n_0 \\right] $$\n$$ \\varepsilon_0 \\nabla^2 \\phi = e \\left[ n_0 + \\frac{n_0 e\\phi}{k_B T_e} - n_0 \\right] = \\frac{n_0 e^2 \\phi}{k_B T_e} $$\nRearranging this equation yields the screened Poisson equation (or Helmholtz equation):\n$$ \\nabla^2 \\phi - \\frac{n_0 e^2}{\\varepsilon_0 k_B T_e} \\phi = 0 $$\nThis equation describes how the electrostatic potential from a test charge is screened by the surrounding plasma. The characteristic length scale of this screening is the Debye length, $\\lambda_D$. By comparing our result to the canonical form $\\nabla^2 \\phi - \\frac{1}{\\lambda_D^2} \\phi = 0$, we can identify the expression for $\\lambda_D$:\n$$ \\frac{1}{\\lambda_D^2} = \\frac{n_0 e^2}{\\varepsilon_0 k_B T_e} $$\nTherefore, the Debye length is given by:\n$$ \\lambda_D = \\sqrt{\\frac{\\varepsilon_0 k_B T_e}{n_0 e^2}} $$\nThis completes the derivation from first principles.\n\nNow, we compute the numerical value of $\\lambda_D$. We are given:\n- Unperturbed electron density, $n_0 = n_e = 10^{20}\\,\\mathrm{m}^{-3}$.\n- The thermal energy $k_B T_e$ is $5\\,\\mathrm{keV}$. We convert this to Joules:\n$$ k_B T_e = 5\\,\\mathrm{keV} = 5 \\times 10^3\\,\\mathrm{eV} $$\nUsing the conversion $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$:\n$$ k_B T_e = (5 \\times 10^3) \\times (1.602176634 \\times 10^{-19}) \\,\\mathrm{J} = 8.01088317 \\times 10^{-16}\\,\\mathrm{J} $$\nThe other constants are:\n- $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$\n- $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n\nSubstituting these values into the expression for $\\lambda_D$:\n$$ \\lambda_D = \\sqrt{\\frac{(8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}) \\times (8.01088317 \\times 10^{-16}\\,\\mathrm{J})}{(10^{20}\\,\\mathrm{m}^{-3}) \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})^2}} $$\n$$ \\lambda_D = \\sqrt{\\frac{7.0911504 \\times 10^{-27}}{2.56696996 \\times 10^{-18}}} \\,\\mathrm{m} $$\n$$ \\lambda_D = \\sqrt{2.7620614 \\times 10^{-9}} \\,\\mathrm{m} \\approx 5.2555317 \\times 10^{-5}\\,\\mathrm{m} $$\nRounding to four significant figures, the Debye length is $\\lambda_D = 5.256 \\times 10^{-5}\\,\\mathrm{m}$.\n\nFinally, we compute the dimensionless parameter $k \\lambda_D$ for a perturbation with wavenumber $k = 10\\,\\mathrm{m}^{-1}$:\n$$ k \\lambda_D = (10\\,\\mathrm{m}^{-1}) \\times (5.2555317 \\times 10^{-5}\\,\\mathrm{m}) = 5.2555317 \\times 10^{-4} $$\nRounding to four significant figures, $k \\lambda_D = 5.256 \\times 10^{-4}$.\n\nThe quasi-neutral approximation is valid when the length scale of the plasma phenomenon, $L$, is much larger than the Debye length, $L \\gg \\lambda_D$. For a wave-like perturbation, the characteristic length scale is the wavelength, $L = 2\\pi/k$, or simply $L \\sim 1/k$. The condition for quasi-neutrality thus becomes $1/k \\gg \\lambda_D$, which is equivalent to $k \\lambda_D \\ll 1$. Our calculated value is $k \\lambda_D \\approx 5.256 \\times 10^{-4}$, which is indeed much less than $1$. This confirms that for a perturbation with a wavenumber of $10\\,\\mathrm{m}^{-1}$ (corresponding to a wavelength of approximately $0.63\\,\\mathrm{m}$), the plasma can be considered quasi-neutral, as charge separation effects are confined to the much smaller Debye scale.",
            "answer": "$$\n\\boxed{5.256 \\times 10^{-5}, \\quad 5.256 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "The final practice bridges the gap between theory and numerical simulation, a vital skill in computational science. In many models, quasi-neutrality is an enforced constraint, replacing the differential Poisson's equation with a simpler algebraic condition. This exercise  guides you through implementing an algorithm that enforces the condition $n_e = \\sum_s Z_s n_s$ to machine precision and computes the self-consistent electrostatic potential, a core task for any computational plasma physicist.",
            "id": "4035039",
            "problem": "You are tasked with designing and implementing a computational procedure to initialize a quasi-neutral electrostatic simulation for a magnetically confined fusion plasma. The initialization must enforce quasi-neutrality to machine precision and compute an electrostatic potential consistent with an isothermal electron closure. The procedure must start from fundamental physical laws and core definitions and be expressed in purely mathematical and logical terms. The implementation must be fully general but the program you produce will execute on a small set of predefined test cases to demonstrate correctness and robustness.\n\nFundamental base:\n- Use Gauss’s law from electromagnetism, expressed as $\\,\\nabla \\cdot \\mathbf{E} = \\rho / \\varepsilon_0\\,$. In the quasi-neutral limit applicable to many fusion-relevant regimes, the charge density satisfies $\\,\\rho \\approx 0\\,$, which implies the neutrality condition $\\,\\sum_s Z_s e\\,n_s - e\\,n_e \\approx 0\\,$. Dividing by $\\,e\\,$ yields $\\,\\sum_s Z_s n_s \\approx n_e\\,$.\n- Use the isothermal Boltzmann electron closure, $\\,n_e = n_{e0}\\,\\exp\\!\\big(e\\,\\phi/(k_B T_e)\\big)\\,$. When the electron temperature is expressed in electron-volts, $\\,T_e\\,$ in $\\,$electron-volts (eV)$\\,$, the closure reduces to $\\,n_e = n_{e0}\\,\\exp\\!\\big(\\phi/T_e\\big)\\,$ because $\\,e\\,\\phi/(k_B T_e) = \\phi/T_e\\,$ with $\\,\\phi\\,$ in $\\,$Volts (V)$\\,$ and $\\,T_e\\,$ in $\\,$electron-volts (eV)$\\,$.\n\nTask requirements:\n- Implement a numerical procedure that, for each spatial index $\\,i\\,$ on a one-dimensional (One-Dimensional (1D)) grid, computes $\\,n_e[i]\\,$ such that $\\,\\sum_s Z_s n_s[i] = n_e[i]\\,$ to machine precision using compensated summation to minimize floating-point round-off.\n- Compute an initial electrostatic potential $\\,\\phi[i]\\,$ consistent with the isothermal Boltzmann electron relation by solving $\\,\\phi[i] = T_e \\,\\ln\\!\\big(n_e[i]/n_{e0}[i]\\big)\\,$.\n- Validate the computed $\\,\\phi[i]\\,$ by reconstructing $\\,\\tilde{n}_e[i] = n_{e0}[i] \\exp\\!\\big(\\phi[i]/T_e\\big)\\,$ and comparing $\\,\\tilde{n}_e[i]\\,$ to $\\,n_e[i]\\,$.\n- Use double-precision arithmetic throughout.\n\nUnits and outputs:\n- Species densities $\\,n_s\\,$ and electron densities $\\,n_e\\,$ must be treated as number densities in $\\,$per cubic meter (m$^{-3}$)$\\,$.\n- Electron temperature $\\,T_e\\,$ is specified in $\\,$electron-volts (eV)$\\,$.\n- The electrostatic potential $\\,\\phi\\,$ must be expressed in $\\,$Volts (V)$\\,$.\n- Angles do not appear; no angle unit is required.\n- For each test case, compute and report a quadruple consisting of:\n  1. The maximum absolute neutrality residual $\\,r_{\\max} = \\max_i \\big|\\sum_s Z_s n_s[i] - n_e[i]\\big|\\,$ in $\\,$per cubic meter (m$^{-3}$)$\\,$.\n  2. The maximum relative Boltzmann consistency error $\\,\\epsilon_{\\max} = \\max_i \\big| \\tilde{n}_e[i] - n_e[i] \\big|/n_e[i]\\,$ as a dimensionless float.\n  3. The minimum potential $\\,\\min_i \\phi[i]\\,$ in $\\,$Volts (V)$\\,$.\n  4. The maximum potential $\\,\\max_i \\phi[i]\\,$ in $\\,$Volts (V)$\\,$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list of lists enclosed in square brackets (for example, $\\,[[a_1,a_2,a_3,a_4],[b_1,b_2,b_3,b_4]]\\,$). The individual list entries must be floating-point numbers.\n\nAlgorithmic constraints:\n- The program must implement compensated summation (for example, Kahan summation) for the computation of $\\,\\sum_s Z_s n_s[i]\\,$ at each grid point $\\,i\\,$ to ensure quasi-neutrality to machine precision.\n- The program must use only double-precision floating-point arithmetic (the default for the selected libraries).\n- No external input or output beyond the final required line is permitted.\n\nTest suite:\n- Use the following four test cases, each defined on a five-point 1D grid indexed by $\\,i \\in \\{0,1,2,3,4\\}\\,$. All densities are in $\\,$per cubic meter (m$^{-3}$)$\\,$, $\\,T_e\\,$ is in $\\,$electron-volts (eV)$\\,$, and $\\,\\phi\\,$ must be in $\\,$Volts (V)$\\,$.\n\n  - Test case $\\,1\\,$ (core-like plasma with deuterium and helium):\n    - Species charges: $\\,Z = [1,2]\\,$.\n    - Species densities: $\\,n_{\\mathrm{D}^+}[i] = [1.00 \\times 10^{19},\\,1.05 \\times 10^{19},\\,1.10 \\times 10^{19},\\,1.08 \\times 10^{19},\\,1.02 \\times 10^{19}]\\,,$ $\\,n_{\\mathrm{He}^{2+}}[i] = [2.00 \\times 10^{18},\\,1.80 \\times 10^{18},\\,1.90 \\times 10^{18},\\,2.10 \\times 10^{18},\\,2.20 \\times 10^{18}]\\,.$\n    - Electron reference density: $\\,n_{e0}[i] = [1.35 \\times 10^{19},\\,1.35 \\times 10^{19},\\,1.35 \\times 10^{19},\\,1.35 \\times 10^{19},\\,1.35 \\times 10^{19}]\\,.$\n    - Electron temperature: $\\,T_e = 2000.0\\,$.\n\n  - Test case $\\,2\\,$ (edge-like plasma with deuterium and carbon impurity):\n    - Species charges: $\\,Z = [1,6]\\,$.\n    - Species densities: $\\,n_{\\mathrm{D}^+}[i] = [8.00 \\times 10^{18},\\,7.50 \\times 10^{18},\\,7.00 \\times 10^{18},\\,6.50 \\times 10^{18},\\,6.00 \\times 10^{18}]\\,,$ $\\,n_{\\mathrm{C}^{6+}}[i] = [1.00 \\times 10^{17},\\,1.20 \\times 10^{17},\\,1.40 \\times 10^{17},\\,1.30 \\times 10^{17},\\,1.10 \\times 10^{17}]\\,.$\n    - Electron reference density: $\\,n_{e0}[i] = [8.60 \\times 10^{18},\\,8.20 \\times 10^{18},\\,7.80 \\times 10^{18},\\,7.30 \\times 10^{18},\\,6.90 \\times 10^{18}]\\,.$\n    - Electron temperature: $\\,T_e = 300.0\\,$.\n\n  - Test case $\\,3\\,$ (uniform hydrogen; potential expected zero):\n    - Species charges: $\\,Z = [1]\\,$.\n    - Species densities: $\\,n_{\\mathrm{H}^+}[i] = [1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19}]\\,.$\n    - Electron reference density: $\\,n_{e0}[i] = [1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19},\\,1.00 \\times 10^{19}]\\,.$\n    - Electron temperature: $\\,T_e = 1000.0\\,$.\n\n  - Test case $\\,4\\,$ (multi-species including tungsten impurity):\n    - Species charges: $\\,Z = [1,2,40]\\,$.\n    - Species densities: $\\,n_{\\mathrm{D}^+}[i] = [9.00 \\times 10^{19},\\,8.80 \\times 10^{19},\\,8.50 \\times 10^{19},\\,8.30 \\times 10^{19},\\,8.10 \\times 10^{19}]\\,,$ $\\,n_{\\mathrm{He}^{2+}}[i] = [1.20 \\times 10^{19},\\,1.10 \\times 10^{19},\\,1.00 \\times 10^{19},\\,9.00 \\times 10^{18},\\,8.00 \\times 10^{18}]\\,,$ $\\,n_{\\mathrm{W}^{40+}}[i] = [2.00 \\times 10^{16},\\,2.20 \\times 10^{16},\\,2.40 \\times 10^{16},\\,2.10 \\times 10^{16},\\,2.30 \\times 10^{16}]\\,.$\n    - Electron reference density: $\\,n_{e0}[i] = [1.14 \\times 10^{20},\\,1.11 \\times 10^{20},\\,1.08 \\times 10^{20},\\,1.05 \\times 10^{20},\\,1.02 \\times 10^{20}]\\,.$\n    - Electron temperature: $\\,T_e = 15000.0\\,$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with one sublist per test case. Each sublist must contain four floating-point numbers in the order specified above: $\\,r_{\\max}\\,$, $\\,\\epsilon_{\\max}\\,$, $\\,\\min \\phi\\,$, $\\,\\max \\phi\\,$. For example: $\\,[[r_1,\\epsilon_1,\\phi_{1,\\min},\\phi_{1,\\max}],[r_2,\\epsilon_2,\\phi_{2,\\min},\\phi_{2,\\max}],\\dots]\\,$.",
            "solution": "The objective is to design and implement a numerical procedure for initializing a quasi-neutral electrostatic simulation. This involves calculating a self-consistent electron density, $n_e$, and electrostatic potential, $\\phi$, from a given set of ion species densities, $n_s$. The procedure must rigorously enforce quasi-neutrality to machine precision and be validated through defined error metrics.\n\nThe solution is developed in three stages, following core physical principles.\n\n**1. Quasi-Neutrality and Electron Density Calculation**\n\nThe foundation of this problem is the principle of quasi-neutrality in a plasma. On macroscopic scales, the net charge density, $\\rho$, is approximately zero. Gauss's law, $\\nabla \\cdot \\mathbf{E} = \\rho / \\varepsilon_0$, thus simplifies to $\\nabla \\cdot \\mathbf{E} \\approx 0$. The charge density is contributed by ions and electrons: $\\rho = \\sum_s Z_s e n_s - e n_e$, where $e$ is the elementary charge, $n_s$ is the number density of ion species $s$ with charge number $Z_s$, and $n_e$ is the electron number density. Setting $\\rho \\approx 0$ yields the algebraic quasi-neutrality condition:\n$$\n\\sum_s Z_s e n_s = e n_e\n$$\nDividing by $e$ gives the direct relationship for the electron density in terms of the ion densities:\n$$\nn_e = \\sum_s Z_s n_s\n$$\nOn a one-dimensional discrete grid with spatial index $i$, this becomes a local condition at each grid point:\n$$\nn_e[i] = \\sum_s Z_s n_s[i]\n$$\nThe direct summation of floating-point numbers can accumulate round-off errors, especially when summing terms of disparate magnitudes. To enforce quasi-neutrality to machine precision as required, a compensated summation algorithm must be used. The Kahan summation algorithm is a suitable choice for this purpose. It maintains a running compensation term, $c$, to account for the low-order bits lost in each addition. For a sequence of values $x_k$, the algorithm is:\n1. Initialize sum $S = 0.0$ and compensation $c = 0.0$.\n2. For each term $x_k$ in the sequence:\n   a. Set $y = x_k - c$.\n   b. Set $t = S + y$.\n   c. The lost low-order part is recovered by $c = (t - S) - y$.\n   d. Update the sum: $S = t$.\n3. The final result is $S$.\n\nFor each grid point $i$, we compute $n_e[i]$ by applying this algorithm to the sequence of ion charge densities, $\\{Z_s n_s[i]\\}_{s}$.\n\n**2. Electrostatic Potential from Isothermal Electrons**\n\nThe problem specifies an isothermal electron fluid, where the electron density profile is related to the electrostatic potential, $\\phi$, via the Boltzmann relation. For a temperature $T_e$ given in energy units (electron-volts, eV), this relation is:\n$$\nn_e[i] = n_{e0}[i] \\exp\\left(\\frac{\\phi[i]}{T_e}\\right)\n$$\nHere, $n_{e0}[i]$ is a reference electron density, and $\\phi[i]$ is the potential in Volts. To find the potential that is consistent with the electron density $n_e[i]$ computed in the previous step, we must invert this equation for $\\phi[i]$:\n$$\n\\frac{n_e[i]}{n_{e0}[i]} = \\exp\\left(\\frac{\\phi[i]}{T_e}\\right)\n$$\nTaking the natural logarithm of both sides yields:\n$$\n\\ln\\left(\\frac{n_e[i]}{n_{e0}[i]}\\right) = \\frac{\\phi[i]}{T_e}\n$$\nSolving for $\\phi[i]$ gives the explicit formula for the electrostatic potential at each grid point:\n$$\n\\phi[i] = T_e \\ln\\left(\\frac{n_e[i]}{n_{e0}[i]}\\right)\n$$\nThis calculation is performed for all grid points $i$ using the previously computed $n_e[i]$ array.\n\n**3. Verification and Error Quantification**\n\nThe final step is to compute four metrics to validate the numerical results and characterize the solution. All computations use double-precision floating-point arithmetic.\n\n- **Maximum Absolute Neutrality Residual ($r_{\\max}$):** This metric verifies that the computed electron density $n_e[i]$ indeed enforces quasi-neutrality. It is defined as:\n  $$\n  r_{\\max} = \\max_i \\left| \\left(\\sum_s Z_s n_s[i]\\right) - n_e[i] \\right|\n  $$\n  Here, $n_e[i]$ is the value calculated and stored using compensated summation. To perform a meaningful check, the sum $\\sum_s Z_s n_s[i]$ is re-calculated, also using compensated summation. The difference quantifies any error inherent in storing and re-using floating-point numbers, and is expected to be near the machine-epsilon limit, typically zero.\n\n- **Maximum Relative Boltzmann Consistency Error ($\\epsilon_{\\max}$):** This metric verifies the numerical stability of the potential calculation and its inversion. First, the electron density is reconstructed from the computed potential, $\\tilde{n}_e[i] = n_{e0}[i] \\exp(\\phi[i]/T_e)$. Mathematically, $\\tilde{n}_e[i]$ should be identical to $n_e[i]$. Numerically, the round-trip operation $\\exp(\\ln(x))$ can introduce small errors. The relative error is computed as:\n  $$\n  \\epsilon_{\\max} = \\max_i \\frac{|\\tilde{n}_e[i] - n_e[i]|}{n_e[i]}\n  $$\n\n- **Minimum and Maximum Potential ($\\min \\phi$, $\\max \\phi$):** These values provide a summary of the resulting potential profile's extent. They are computed as:\n  $$\n  \\min \\phi = \\min_i \\phi[i] \\quad \\text{and} \\quad \\max \\phi = \\max_i \\phi[i]\n  $$\n\nThe overall procedure is to process each test case by applying these three steps, calculating the four required metrics, and aggregating the results into the specified final output format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It initializes plasma state based on quasi-neutrality and Boltzmann electrons,\n    then computes required validation metrics.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"core-like plasma with deuterium and helium\",\n            \"Z\": np.array([1, 2], dtype=np.float64),\n            \"n_s\": np.array([\n                [1.00e19, 1.05e19, 1.10e19, 1.08e19, 1.02e19], # n_D+\n                [2.00e18, 1.80e18, 1.90e18, 2.10e18, 2.20e18]  # n_He2+\n            ], dtype=np.float64),\n            \"n_e0\": np.array([1.35e19, 1.35e19, 1.35e19, 1.35e19, 1.35e19], dtype=np.float64),\n            \"T_e\": 2000.0,\n        },\n        {\n            \"name\": \"edge-like plasma with deuterium and carbon impurity\",\n            \"Z\": np.array([1, 6], dtype=np.float64),\n            \"n_s\": np.array([\n                [8.00e18, 7.50e18, 7.00e18, 6.50e18, 6.00e18], # n_D+\n                [1.00e17, 1.20e17, 1.40e17, 1.30e17, 1.10e17]  # n_C6+\n            ], dtype=np.float64),\n            \"n_e0\": np.array([8.60e18, 8.20e18, 7.80e18, 7.30e18, 6.90e18], dtype=np.float64),\n            \"T_e\": 300.0,\n        },\n        {\n            \"name\": \"uniform hydrogen; potential expected zero\",\n            \"Z\": np.array([1], dtype=np.float64),\n            \"n_s\": np.array([\n                [1.00e19, 1.00e19, 1.00e19, 1.00e19, 1.00e19]  # n_H+\n            ], dtype=np.float64),\n            \"n_e0\": np.array([1.00e19, 1.00e19, 1.00e19, 1.00e19, 1.00e19], dtype=np.float64),\n            \"T_e\": 1000.0,\n        },\n        {\n            \"name\": \"multi-species including tungsten impurity\",\n            \"Z\": np.array([1, 2, 40], dtype=np.float64),\n            \"n_s\": np.array([\n                [9.00e19, 8.80e19, 8.50e19, 8.30e19, 8.10e19], # n_D+\n                [1.20e19, 1.10e19, 1.00e19, 9.00e18, 8.00e18], # n_He2+\n                [2.00e16, 2.20e16, 2.40e16, 2.10e16, 2.30e16]  # n_W40+\n            ], dtype=npá.float64),\n            \"n_e0\": np.array([1.14e20, 1.11e20, 1.08e20, 1.05e20, 1.02e20], dtype=np.float64),\n            \"T_e\": 15000.0,\n        },\n    ]\n\n    def kahan_sum(arr):\n        \"\"\"\n        Computes the sum of an array of floats using the Kahan summation algorithm\n        to minimize floating-point round-off error. All inputs must be float64.\n        \"\"\"\n        s = 0.0\n        c = 0.0  # A running compensation for lost low-order bits.\n        for x in arr:\n            y = x - c\n            t = s + y\n            c = (t - s) - y\n            s = t\n        return s\n\n    results = []\n    for case in test_cases:\n        Z = case[\"Z\"]\n        n_s = case[\"n_s\"]\n        n_e0 = case[\"n_e0\"]\n        T_e = case[\"T_e\"]\n        \n        num_grid_points = n_s.shape[1]\n        n_e = np.zeros(num_grid_points, dtype=np.float64)\n\n        # 1. Compute electron density n_e[i] using compensated summation\n        for i in range(num_grid_points):\n            # Form the array of ion charge densities at grid point i\n            ion_charge_densities = Z * n_s[:, i]\n            n_e[i] = kahan_sum(ion_charge_densities)\n\n        # 2. Compute electrostatic potential phi[i]\n        phi = T_e * np.log(n_e / n_e0)\n\n        # 3. Compute verification metrics\n        \n        # 3.1. Maximum absolute neutrality residual (r_max)\n        # Recalculate the sum and compare to the stored n_e\n        residual = np.zeros(num_grid_points, dtype=np.float64)\n        for i in range(num_grid_points):\n            ion_charge_densities = Z * n_s[:, i]\n            recalculated_sum = kahan_sum(ion_charge_densities)\n            residual[i] = np.abs(recalculated_sum - n_e[i])\n        r_max = np.max(residual)\n\n        # 3.2. Maximum relative Boltzmann consistency error (epsilon_max)\n        # Reconstruct n_e from phi and compare to the original n_e\n        n_e_tilde = n_e0 * np.exp(phi / T_e)\n        # Handle potential division by zero if n_e[i] can be zero.\n        # In these test cases, densities are all positive.\n        rel_error = np.abs(n_e_tilde - n_e) / n_e\n        epsilon_max = np.max(rel_error)\n\n        # 3.3. Minimum and maximum potential\n        min_phi = np.min(phi)\n        max_phi = np.max(phi)\n        \n        # Collect results for this case\n        case_results = [r_max, epsilon_max, min_phi, max_phi]\n        results.append(case_results)\n\n    # Format the final output string as a list of lists.\n    # The str() representation of a list is '[...]', so joining these\n    # with commas and wrapping with brackets produces the required format.\n    result_strings = [str(res) for res in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}