{
    "hands_on_practices": [
        {
            "introduction": "Understanding the mathematical construction of Solov'ev equilibria is the first step toward mastering their application. This practice guides you through the direct solution of the Grad-Shafranov equation for the specific case where the source terms are linear functions of the poloidal flux $\\psi$. By constructing a polynomial solution from first principles and applying boundary conditions, you will gain hands-on experience with the fundamental structure of these essential analytical models. ",
            "id": "4045562",
            "problem": "Consider the axisymmetric Grad–Shafranov (GS) equation for the poloidal flux function $\\psi(R,Z)$ in cylindrical coordinates $(R,Z)$,\n$$\n\\Delta^{\\star}\\psi \\equiv R\\,\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right)+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = - R^{2}\\,p'(\\psi) - \\frac{1}{2}F(\\psi)F'(\\psi),\n$$\nwhere $p(\\psi)$ is the plasma pressure and $F(\\psi)$ defines the toroidal magnetic field via $B_{\\phi}=F(\\psi)/R$. In a Solov'ev equilibrium, the profiles are taken as linear so that $p'(\\psi)$ and $F(\\psi)F'(\\psi)$ are constants. In normalized, dimensionless units, target the right-hand side as\n$$\nS(R,Z)=\\alpha R^{2}+\\beta,\n$$\nwith constants $\\alpha$ and $\\beta$. Your task is to construct an analytic polynomial Solov'ev solution for $\\psi(R,Z)$ as follows:\n\n1. Starting from the GS operator $\\Delta^{\\star}$, derive a particular polynomial solution $\\psi_{p}(R,Z)$ such that $\\Delta^{\\star}\\psi_{p} = \\alpha R^{2}+\\beta$.\n2. Identify the even-in-$Z$ homogeneous solution space of $\\Delta^{\\star}\\psi_{h}=0$ among low-order polynomials and superpose it with $\\psi_{p}$ to form the general even-in-$Z$ polynomial solution.\n3. Impose up–down symmetry and the following two boundary conditions to determine the homogeneous coefficients:\n   (i) A magnetic axis located at $(R,Z)=(R_{0},0)$, with vanishing poloidal field there, i.e., $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)}=0$.\n   (ii) The last closed flux surface intersects the outer midplane at $(R,Z)=\\left(R_{0}+a,0\\right)$, with $\\psi\\left(R_{0}+a,0\\right)=0$.\n4. Express the final solution $\\psi(R,Z)$ in closed form as a single analytic expression in terms of $\\alpha$, $\\beta$, $R_{0}$, $a$, and the coordinates $R$ and $Z$.\n\nUse normalized, dimensionless units throughout; no unit conversion is required. The final answer must be a single closed-form analytic expression.",
            "solution": "The posed problem is to construct a specific polynomial Solov'ev solution to the Grad-Shafranov (GS) equation. The problem is scientifically grounded, well-posed under a reasonable interpretation of its constraints, and objectively formulated. I will proceed with the solution.\n\nThe Grad-Shafranov equation is given by:\n$$\n\\Delta^{\\star}\\psi = - R^{2}\\,p'(\\psi) - \\frac{1}{2}F(\\psi)F'(\\psi)\n$$\nwhere the operator $\\Delta^{\\star}$ is defined as:\n$$\n\\Delta^{\\star}\\psi \\equiv R\\,\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right)+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = \\frac{\\partial^2\\psi}{\\partial R^2} - \\frac{1}{R}\\frac{\\partial\\psi}{\\partial R} + \\frac{\\partial^2\\psi}{\\partial Z^2}\n$$\nFor a Solov'ev equilibrium, the source terms $p'(\\psi)$ and $F(\\psi)F'(\\psi)$ are constants. The right-hand side of the GS equation is specified to be a simple polynomial form:\n$$\n\\Delta^{\\star}\\psi(R,Z) = \\alpha R^{2}+\\beta\n$$\nwhere $\\alpha$ and $\\beta$ are constants. Our goal is to find a polynomial solution $\\psi(R,Z)$ that is even in $Z$ and satisfies a set of boundary conditions. The solution is the sum of a particular solution $\\psi_p$ and a homogeneous solution $\\psi_h$, i.e., $\\psi = \\psi_p + \\psi_h$.\n\n**1. Particular Solution**\n\nWe seek a particular polynomial solution $\\psi_p(R,Z)$ to the equation $\\Delta^{\\star}\\psi_p = \\alpha R^2 + \\beta$. We can propose a solution Separation of variables ansatz of the form $\\psi_p(R,Z) = f(R) + g(Z)$. The equation becomes $\\Delta^{\\star}f(R) + \\Delta^{\\star}g(Z) = \\alpha R^2 + \\beta$.\nNoting that $\\Delta^{\\star}f(R) = f''(R) - \\frac{1}{R}f'(R)$ and $\\Delta^{\\star}g(Z) = g''(Z)$, we can split the equation into two parts:\n$$\n\\frac{d^2 g}{dZ^2} = \\beta\n$$\n$$\n\\frac{d^2 f}{dR^2} - \\frac{1}{R}\\frac{df}{dR} = \\alpha R^2\n$$\nIntegrating the equation for $g(Z)$ twice with respect to $Z$ yields $g(Z) = \\frac{\\beta}{2}Z^2$. We select the simplest polynomial solution, disregarding integration constants as they can be absorbed into the homogeneous solution.\n\nFor the equation for $f(R)$, we look for a polynomial solution. Let's test a power-law form $f(R) = C R^n$.\n$\\Delta^{\\star}(C R^n) = C[n(n-1)R^{n-2} - \\frac{1}{R}n R^{n-1}] = C(n^2-2n)R^{n-2}$.\nTo obtain the term $\\alpha R^2$, we must have $n-2 = 2$, which implies $n=4$.\nSubstituting $n=4$, we get $\\Delta^{\\star}(C R^4) = C(4^2-2 \\cdot 4)R^{4-2} = 8CR^2$.\nTo match $\\alpha R^2$, we require $8C = \\alpha$, so $C = \\frac{\\alpha}{8}$.\nThus, a suitable $f(R)$ is $\\frac{\\alpha}{8}R^4$.\n\nCombining these, a particular solution is:\n$$\n\\psi_p(R,Z) = \\frac{\\alpha}{8}R^4 + \\frac{\\beta}{2}Z^2\n$$\nThis solution is a polynomial and is even in $Z$, as required.\n\n**2. Homogeneous Solution and General Solution**\n\nNext, we find the homogeneous solution $\\psi_h$ satisfying $\\Delta^{\\star}\\psi_h = 0$. The problem requests an even-in-$Z$ solution from \"low-order polynomials\". We interpret this to mean polynomials of at most second degree. This is a critical assumption that makes the problem well-posed with the given boundary conditions. Higher-order polynomial solutions, such as $C(R^4 - 4R^2Z^2)$, would introduce free parameters that cannot be determined from the provided information.\n\nLet's test low-order, even-in-$Z$ polynomials:\n- A constant, $\\psi_h=A$: $\\Delta^{\\star}A = 0$.\n- A quadratic in $R$, $\\psi_h=BR^2$: $\\Delta^{\\star}(BR^2) = B(2^2-2 \\cdot 2)R^0 = 0$.\n- A quadratic in $Z$, $\\psi_h=CZ^2$: $\\Delta^{\\star}(CZ^2) = 2C \\neq 0$. This is not a homogeneous solution.\n\nThus, the general low-order, even-in-$Z$ homogeneous polynomial solution is a linear combination of the valid solutions:\n$$\n\\psi_h(R,Z) = A+BR^2\n$$\nwhere $A$ and $B$ are arbitrary constants.\n\nThe general solution is the sum of the particular and homogeneous solutions:\n$$\n\\psi(R,Z) = \\psi_p(R,Z) + \\psi_h(R,Z) = \\frac{\\alpha}{8}R^4 + \\frac{\\beta}{2}Z^2 + BR^2 + A\n$$\n\n**3. Imposing Boundary Conditions**\n\nWe now determine the constants $A$ and $B$ using the given boundary conditions.\n\n(i) The magnetic axis is at $(R_0, 0)$, where the poloidal magnetic field vanishes. This implies $\\nabla\\psi=0$ at this point. The condition $\\left.\\frac{\\partial \\psi}{\\partial Z}\\right|_{(R_{0},0)} = \\left.\\beta Z\\right|_{Z=0} = 0$ is automatically satisfied. We must enforce $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)}=0$.\nFirst, we compute the partial derivative with respect to $R$:\n$$\n\\frac{\\partial \\psi}{\\partial R} = \\frac{\\partial}{\\partial R}\\left( \\frac{\\alpha}{8}R^4 + BR^2 + A + \\frac{\\beta}{2}Z^2 \\right) = \\frac{4\\alpha}{8}R^3 + 2BR = \\frac{\\alpha}{2}R^3 + 2BR\n$$\nEvaluating at $(R_0,0)$:\n$$\n\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)} = \\frac{\\alpha}{2}R_0^3 + 2BR_0 = 0\n$$\nSince $R_0 > 0$ for a toroidal plasma, we can divide by $2R_0$ to solve for $B$:\n$$\n\\frac{\\alpha}{4}R_0^2 + B = 0 \\implies B = -\\frac{\\alpha}{4}R_0^2\n$$\n\n(ii) The last closed flux surface (LCFS) is specified to pass through the point $(R_0+a, 0)$ on the outer midplane, where $\\psi(R_0+a, 0)=0$.\nSubstituting $B$ into the expression for $\\psi$ and evaluating at $(R_0+a, 0)$:\n$$\n\\psi(R_0+a, 0) = \\frac{\\alpha}{8}(R_0+a)^4 + B(R_0+a)^2 + A = 0\n$$\n$$\n\\frac{\\alpha}{8}(R_0+a)^4 - \\frac{\\alpha}{4}R_0^2(R_0+a)^2 + A = 0\n$$\nSolving for $A$:\n$$\nA = \\frac{\\alpha}{4}R_0^2(R_0+a)^2 - \\frac{\\alpha}{8}(R_0+a)^4 = \\frac{\\alpha}{8}(R_0+a)^2 \\left[2R_0^2 - (R_0+a)^2\\right]\n$$\n$$\nA = \\frac{\\alpha}{8}(R_0+a)^2 (2R_0^2 - R_0^2 - 2R_0 a - a^2) = \\frac{\\alpha}{8}(R_0+a)^2 (R_0^2 - 2R_0 a - a^2)\n$$\n\n**4. Final Solution Expression**\n\nWe substitute the determined coefficients $A$ and $B$ back into the general solution for $\\psi(R,Z)$:\n$$\n\\psi(R,Z) = \\frac{\\alpha}{8}R^4 - \\frac{\\alpha}{4}R_0^2 R^2 + \\frac{\\beta}{2}Z^2 + A\n$$\nThis expression can be written more compactly. Let's group the terms dependent on $R$:\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}R^4 - \\frac{\\alpha}{4}R_0^2 R^2 + A = \\frac{\\alpha}{8}(R^4 - 2R_0^2 R^2) + A\n$$\nWe can rewrite $R^4 - 2R_0^2 R^2$ as $(R^2-R_0^2)^2 - R_0^4$.\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - R_0^4 \\right] + A\n$$\nThe constant $A$ was set by the condition $\\psi(R_0+a,0)=0$, which means $\\psi_R(R_0+a)=0$:\n$$\n\\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right] + A = 0 \\implies A = -\\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right]\n$$\nSubstituting this back into the expression for $\\psi_R(R)$:\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - R_0^4 \\right] - \\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right]\n$$\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - ((R_0+a)^2 - R_0^2)^2 \\right]\n$$\nThe term $((R_0+a)^2 - R_0^2)$ simplifies to $(R_0^2+2R_0a+a^2-R_0^2) = 2R_0a+a^2 = a(2R_0+a)$.\nSo, $\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - (a(2R_0+a))^2 \\right]$.\n\nAdding the $Z$-dependent term back, the final closed-form solution is:\n$$\n\\psi(R,Z) = \\frac{\\alpha}{8}\\left[ (R^2-R_0^2)^2 - \\left(a(2R_0+a)\\right)^2 \\right] + \\frac{\\beta}{2}Z^2\n$$",
            "answer": "$$\\boxed{\\frac{\\alpha}{8}\\left[ (R^{2}-R_{0}^{2})^{2} - \\left(a(2R_{0}+a)\\right)^{2} \\right] + \\frac{\\beta}{2}Z^{2}}$$"
        },
        {
            "introduction": "A mathematical solution to the Grad-Shafranov equation does not automatically guarantee a physically viable plasma confinement. This exercise explores a crucial condition for confinement: the existence of nested, closed flux surfaces near the magnetic axis. You will use the mathematical framework of the Hessian matrix to determine the physical limit on plasma shaping, specifically triangularity, beyond which the magnetic topology breaks down. ",
            "id": "4045566",
            "problem": "Consider an axisymmetric toroidal plasma in Magnetohydrodynamics (MHD) equilibrium described by the Grad–Shafranov equation in cylindrical coordinates $(R,Z)$ with poloidal flux $\\psi(R,Z)$. Under the Solov’ev model, the pressure gradient $p'(\\psi)$ and the product of toroidal field function $F(\\psi)$ with its derivative $F'(\\psi)$ are approximated as constants in a neighborhood of the magnetic axis $(R_0, Z_0)$. In such a neighborhood, the flux function admits a second-order Taylor expansion,\n$$\n\\psi(R,Z) \\approx \\psi(R_0,Z_0) + \\frac{1}{2} H_{RR} \\,(R-R_0)^{2} + H_{RZ}\\,(R-R_0)(Z-Z_0) + \\frac{1}{2} H_{ZZ}\\,(Z-Z_0)^{2},\n$$\nwhere the symmetric matrix\n$$\n\\mathbf{H} = \\begin{pmatrix} H_{RR} & H_{RZ} \\\\ H_{RZ} & H_{ZZ} \\end{pmatrix}\n$$\nis the Hessian of $\\psi$ at the magnetic axis. Physically nested, closed flux surfaces in a small neighborhood of the magnetic axis require the axis to be a local extremum of $\\psi$ with the appropriate curvature signs for confinement: take a convention where increasing $\\psi$ corresponds to moving outward from the axis, and require a local minimum at $(R_0,Z_0)$, implying positive definiteness of $\\mathbf{H}$.\n\nThe Solov’ev analytical equilibrium allows shaping through elongation and triangularity. Define a dimensionless triangularity coefficient $\\delta_{\\mathrm{loc}}$ at the axis via the normalized coupling of the principal curvatures,\n$$\n\\delta_{\\mathrm{loc}} \\equiv \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}},\n$$\nwhich measures the strength of the mixed curvature relative to the geometric mean of the principal curvatures induced by triangular shaping. Assume $H_{RR} > 0$ and $H_{ZZ} > 0$ are fixed by the chosen Solov’ev free-function constants and aspect ratio, and consider $\\delta_{\\mathrm{loc}}$ as the control parameter that increases with the applied triangularity coefficient in the equilibrium construction.\n\nUsing the requirement of positive definiteness of the Hessian for nested, closed flux surfaces around the axis, determine the quantitative threshold value of $\\delta_{\\mathrm{loc}}$ above which the flux surfaces fail to be nested (i.e., the axis becomes a saddle point of $\\psi$). Express your final threshold value as a pure number without units, and round your answer to four significant figures.",
            "solution": "The problem asks for the threshold value of a local triangularity parameter, $\\delta_{\\mathrm{loc}}$, beyond which the poloidal flux surfaces around a magnetic axis in a Solov'ev equilibrium are no longer nested and closed.\n\nThe physical requirement for the existence of nested, closed magnetic flux surfaces in a small neighborhood of the magnetic axis, located at cylindrical coordinates $(R_0, Z_0)$, is that the poloidal flux function, $\\psi(R,Z)$, must have a local extremum, specifically a minimum, at this point. The choice of a minimum convention aligns with the problem statement that increasing $\\psi$ corresponds to moving outward from the axis.\n\nFrom multivariate calculus, a stationary point of a function of two variables is a local minimum if and only if its Hessian matrix of second partial derivatives is positive definite. The problem provides the second-order Taylor expansion of $\\psi$ around $(R_0, Z_0)$:\n$$\n\\psi(R,Z) \\approx \\psi(R_0,Z_0) + \\frac{1}{2} H_{RR} \\,(R-R_0)^{2} + H_{RZ}\\,(R-R_0)(Z-Z_0) + \\frac{1}{2} H_{ZZ}\\,(Z-Z_0)^{2}\n$$\nThe absence of linear terms in $(R-R_0)$ and $(Z-Z_0)$ confirms that the magnetic axis is a stationary point of $\\psi$ (i.e., $\\nabla \\psi = 0$ at $(R_0, Z_0)$). Consequently, the condition for nested flux surfaces reduces to the mathematical requirement that the Hessian matrix $\\mathbf{H}$ must be positive definite at $(R_0, Z_0)$. The Hessian matrix is given as:\n$$\n\\mathbf{H} = \\begin{pmatrix} H_{RR} & H_{RZ} \\\\ H_{RZ} & H_{ZZ} \\end{pmatrix}\n$$\nwhere $H_{RR} = \\frac{\\partial^2 \\psi}{\\partial R^2}$, $H_{RZ} = \\frac{\\partial^2 \\psi}{\\partial R \\partial Z}$, and $H_{ZZ} = \\frac{\\partial^2 \\psi}{\\partial Z^2}$ are all evaluated at $(R_0, Z_0)$.\n\nAccording to Sylvester's criterion, a real symmetric $2 \\times 2$ matrix is positive definite if and only if its leading principal minors are all positive. This imposes two conditions on $\\mathbf{H}$:\n1. The first leading principal minor must be positive: $H_{RR} > 0$.\n2. The second leading principal minor, which is the determinant of the matrix, must be positive: $\\det(\\mathbf{H}) > 0$.\n\nThe problem states that we assume $H_{RR} > 0$, so the first condition is satisfied. We must therefore enforce the second condition:\n$$\n\\det(\\mathbf{H}) = H_{RR} H_{ZZ} - H_{RZ}^2 > 0\n$$\nThe problem defines the dimensionless local triangularity coefficient, $\\delta_{\\mathrm{loc}}$, as:\n$$\n\\delta_{\\mathrm{loc}} \\equiv \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}}\n$$\nWe can use this definition to re-express the determinant condition. The inequality is:\n$$\nH_{RR} H_{ZZ} > H_{RZ}^2\n$$\nThe problem states that $H_{RR} > 0$ and $H_{ZZ} > 0$. Their product $H_{RR} H_{ZZ}$ is therefore strictly positive, allowing us to divide both sides by this product without changing the direction of the inequality:\n$$\n1 > \\frac{H_{RZ}^2}{H_{RR} H_{ZZ}}\n$$\nThe right-hand side of this inequality is precisely the square of the triangularity coefficient:\n$$\n\\left( \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}} \\right)^2 = \\delta_{\\mathrm{loc}}^2\n$$\nSubstituting this back into the inequality, we obtain the condition on $\\delta_{\\mathrm{loc}}$ for the Hessian to be positive definite:\n$$\n\\delta_{\\mathrm{loc}}^2 < 1\n$$\nThis inequality is equivalent to $-1 < \\delta_{\\mathrm{loc}} < 1$. This is the range of $\\delta_{\\mathrm{loc}}$ for which the magnetic axis is a genuine local minimum of $\\psi$, ensuring the flux surfaces are nested and closed.\n\nThe flux surfaces fail to be nested when this condition is violated. The transition occurs at the boundary of this interval, where $|\\delta_{\\mathrm{loc}}| = 1$.\n- If $|\\delta_{\\mathrm{loc}}| = 1$, then $\\det(\\mathbf{H}) = 0$. The matrix is positive semi-definite, and the axis is a degenerate extremum, not a strict minimum.\n- If $|\\delta_{\\mathrm{loc}}| > 1$, then $\\det(\\mathbf{H}) < 0$. Since the trace, $\\mathrm{Tr}(\\mathbf{H}) = H_{RR} + H_{ZZ}$, is positive, the eigenvalues of $\\mathbf{H}$ must have opposite signs. This means the stationary point $(R_0, Z_0)$ is a saddle point of $\\psi$. The flux surfaces near a saddle point are hyperbolic and open, not nested.\n\nThe problem asks for the threshold value of $\\delta_{\\mathrm{loc}}$ *above which* the nested structure fails. This corresponds to the boundary of the stability region. As $\\delta_{\\mathrm{loc}}$ is increased from $0$, the failure threshold is reached at $\\delta_{\\mathrm{loc}} = 1$.\n\nThe threshold value is exactly $1$. The problem requires this to be expressed as a pure number rounded to four significant figures. This gives $1.000$.",
            "answer": "$$\\boxed{1.000}$$"
        },
        {
            "introduction": "One of the most powerful applications of analytical equilibria is the ability to calculate key physical parameters that govern plasma stability. This practice focuses on computing the safety factor, $q(\\psi)$, a critical quantity that measures the winding of magnetic field lines. You will derive the integral expression for $q$, implement it numerically for a specific Solov'ev equilibrium, and validate your result against a standard large-aspect-ratio approximation, a common task in MHD analysis and code verification. ",
            "id": "4045546",
            "problem": "You are given an axisymmetric magnetostatic equilibrium in cylindrical coordinates with the poloidal magnetic flux function $\\,\\psi(R,Z)\\,$ and the toroidal field function $\\,F(\\psi)\\,$. The magnetic field is represented in the standard Grad–Shafranov form $\\,\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}\\,$, where $\\,R\\,$ is the cylindrical radius and $\\,\\hat{\\boldsymbol{\\phi}}\\,$ is the unit vector in the toroidal direction. The safety factor $\\,q(\\psi)\\,$ is defined as the number of toroidal turns per poloidal turn of a magnetic field line on the flux surface $\\,\\psi=\\text{const}\\,$. Using only these foundational definitions, derive the appropriate line-integral expression for $\\,q(\\psi)\\,$ and implement a numerical computation of $\\,q(\\psi)\\,$ for a specific Solov'ev-type polynomial flux function, then validate the numerical result against a small-inverse-aspect-ratio analytic approximation.\n\nFundamental base and scenario:\n- Use the axisymmetric magnetic field representation $\\,\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}\\,$.\n- The safety factor $\\,q(\\psi)\\,$ is the toroidal-to-poloidal winding number ratio for a field line on $\\,\\psi=\\text{const}\\,$.\n- Consider the subclass with $\\,F(\\psi) = F_0\\,$ constant, and a Solov'ev-type polynomial flux function centered at the magnetic axis located at $\\,R=R_0\\,$ and $\\,Z=0\\,$ given by\n$$\n\\psi(R,Z) \\;=\\; \\psi_{\\text{axis}} \\;+\\; \\alpha\\,\\big((R-R_0)^2 + Z^2\\big) \\;+\\; \\beta\\,\\big((R-R_0)^2 + Z^2\\big)^2,\n$$\nwhere $\\,\\alpha>0\\,$ and $\\,\\beta\\ge 0\\,$. This choice produces concentric circular flux surfaces about $\\,\\left(R_0,0\\right)\\,$ with minor radius $\\,r=\\sqrt{(R-R_0)^2+Z^2}\\,$.\n\nYour tasks:\n1. Starting from the provided fundamental base, derive a computationally usable line-integral for $\\,q(\\psi)\\,$ in terms of $\\,F_0\\,$, $\\,R\\,$, the poloidal arc-length element $\\,\\mathrm{d}\\ell_p\\,$ along a flux surface, and $\\,\\nabla\\psi\\,$.\n2. Implement a numerical algorithm that evaluates $\\,q(\\psi)\\,$ for a given target flux surface labeled by its minor radius $\\,r\\,$. Use a $\\,2\\pi\\,$-periodic poloidal parameter $\\,\\theta\\,$ (angle unit: radians). Parameterize the flux surface by $\\,R(\\theta) = R_0 + r\\cos\\theta\\,$ and $\\,Z(\\theta) = r\\sin\\theta\\,$, evaluate the necessary geometric factors, and perform the line integration over one poloidal circuit.\n3. Compute and report the small-inverse-aspect-ratio analytic approximation obtained by replacing $\\,R(\\theta)\\,$ with the constant major radius $\\,R_0\\,$ inside the integrand you derived, i.e., the leading-order approximation that uses $\\,R(\\theta)\\approx R_0\\,$. Compare this approximation to your numerical integral.\n\nPhysical and numerical details:\n- Distances $\\,R\\,$, $\\,Z\\,$, $\\,R_0\\,$, and $\\,r\\,$ must be treated in meters.\n- The constant $\\,F_0\\,$ must be treated in tesla-meter.\n- Angles $\\,\\theta\\,$ must be treated in radians.\n- The safety factor $\\,q(\\psi)\\,$ is dimensionless and must be reported as a floating-point number.\n\nTest suite:\nUse the following three parameter sets, which cover a small-$\\epsilon$ case, a moderate case, and a larger but still physically plausible case. In each case, $\\,\\epsilon = r/R_0\\,$.\n\n- Case A: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.1\\,\\mathrm{m}\\,$.\n- Case B: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.6\\,\\mathrm{m}\\,$.\n- Case C: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.9\\,\\mathrm{m}\\,$.\n\nAnswer specification and output format:\n- For each case, compute the numerically integrated safety factor $\\,q_{\\text{num}}\\,$, the small-$\\epsilon$ approximation $\\,q_{\\text{approx}}\\,$, and the relative error $\\,\\delta = \\big|q_{\\text{num}} - q_{\\text{approx}}\\big| / \\big|q_{\\text{num}}\\big|\\,$.\n- Your program should produce a single line of output containing all nine numbers for the test suite as a comma-separated list enclosed in square brackets, in the order\n$$\n[q_{\\text{num,A}},\\,q_{\\text{approx,A}},\\,\\delta_{\\text{A}},\\,q_{\\text{num,B}},\\,q_{\\text{approx,B}},\\,\\delta_{\\text{B}},\\,q_{\\text{num,C}},\\,q_{\\text{approx,C}},\\,\\delta_{\\text{C}}].\n$$\nAll nine outputs must be floating-point numbers.",
            "solution": "The problem statement has been meticulously validated and is determined to be valid. It is scientifically grounded in the principles of magnetohydrodynamics, self-contained, well-posed, and free of any logical contradictions or factual errors. We may therefore proceed with a complete solution. The solution is structured into three parts as requested: derivation of the general integral for the safety factor, specialization to the given Solov'ev equilibrium for numerical computation, and derivation of the corresponding small-inverse-aspect-ratio approximation.\n\n**1. Derivation of the Line-Integral for the Safety Factor $q(\\psi)$**\n\nThe safety factor $q(\\psi)$ is defined as the number of toroidal turns a magnetic field line makes for every single poloidal turn on a constant flux surface $\\psi=\\text{const}$. Mathematically, this is expressed as $q = \\frac{\\Delta\\phi}{2\\pi}$ where $\\Delta\\phi$ is the total change in the toroidal angle $\\phi$ over one closed poloidal circuit.\n\nA magnetic field line is defined by the differential equation $\\mathrm{d}\\mathbf{l} = c \\mathbf{B}$, where $\\mathrm{d}\\mathbf{l}$ is the differential displacement vector along the field line and $c$ is a proportionality factor. In cylindrical coordinates $(R, \\phi, Z)$, the displacement vector is $\\mathrm{d}\\mathbf{l} = \\mathrm{d}R\\,\\hat{\\mathbf{R}} + R\\,\\mathrm{d}\\phi\\,\\hat{\\boldsymbol{\\phi}} + \\mathrm{d}Z\\,\\hat{\\mathbf{Z}}$. The magnetic field $\\mathbf{B}$ is given as the sum of its poloidal ($\\mathbf{B}_p$) and toroidal ($B_\\phi \\hat{\\boldsymbol{\\phi}}$) components:\n$$\n\\mathbf{B} = \\mathbf{B}_p + B_\\phi \\hat{\\boldsymbol{\\phi}} = \\frac{1}{R}\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\hat{\\boldsymbol{\\phi}}\n$$\nEquating the components of $\\mathrm{d}\\mathbf{l}$ and $c \\mathbf{B}$:\n1. Poloidal components: $\\mathrm{d}\\mathbf{l}_p = \\mathrm{d}R\\,\\hat{\\mathbf{R}} + \\mathrm{d}Z\\,\\hat{\\mathbf{Z}} = c \\mathbf{B}_p$.\n2. Toroidal component: $R\\,\\mathrm{d}\\phi\\,\\hat{\\boldsymbol{\\phi}} = c B_\\phi \\hat{\\boldsymbol{\\phi}}$.\n\nFrom the toroidal component, we have $R\\,\\mathrm{d}\\phi = c B_\\phi = c \\frac{F(\\psi)}{R}$. This gives the differential change in toroidal angle as a function of the path-proportionality factor $c$: $\\mathrm{d}\\phi = c \\frac{F(\\psi)}{R^2}$.\n\nThe magnitude of the poloidal displacement is the poloidal arc-length element, $\\mathrm{d}\\ell_p = |\\mathrm{d}\\mathbf{l}_p| = c |\\mathbf{B}_p| = c B_p$. From this, we can express the factor $c$ as $c = \\frac{\\mathrm{d}\\ell_p}{B_p}$.\n\nSubstituting this expression for $c$ back into the equation for $\\mathrm{d}\\phi$, we obtain:\n$$\n\\mathrm{d}\\phi = \\frac{F(\\psi)}{R^2} \\frac{\\mathrm{d}\\ell_p}{B_p}\n$$\nTo find the total toroidal angle change $\\Delta\\phi$ for one poloidal circuit, we integrate $\\mathrm{d}\\phi$ along a closed path in the poloidal plane that lies on the flux surface $\\psi=\\text{const}$:\n$$\n\\Delta\\phi = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R^2 B_p} \\mathrm{d}\\ell_p\n$$\nThe magnitude of the poloidal magnetic field is $B_p = |\\mathbf{B}_p| = \\left|\\frac{1}{R}\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}}\\right| = \\frac{1}{R}|\\nabla\\psi|$. Substituting this into the integral for $\\Delta\\phi$ yields:\n$$\n\\Delta\\phi = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R^2 \\left(\\frac{1}{R}|\\nabla\\psi|\\right)} \\mathrm{d}\\ell_p = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\nFinally, dividing by $2\\pi$ and noting that for the specified scenario $F(\\psi)$ is a constant $F_0$, we arrive at the desired computationally usable line-integral for the safety factor:\n$$\nq(\\psi) = \\frac{\\Delta\\phi}{2\\pi} = \\frac{F_0}{2\\pi} \\oint_{\\psi=\\text{const}} \\frac{1}{R|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\n\n**2. Numerical Implementation for the Solov'ev Equilibrium**\n\nWe now apply this general formula to the specific Solov'ev-type equilibrium. The flux surfaces are concentric circles of minor radius $r$ centered at $(R_0, 0)$, parameterized by a poloidal angle $\\theta \\in [0, 2\\pi]$:\n$$\nR(\\theta) = R_0 + r\\cos\\theta, \\quad Z(\\theta) = r\\sin\\theta\n$$\nThe flux function is $\\psi(R,Z) = \\psi_{\\text{axis}} + \\alpha r^2 + \\beta r^4$, where $r^2 = (R-R_0)^2 + Z^2$.\nWe must compute the terms in the integrand, $|\\nabla\\psi|$ and $\\mathrm{d}\\ell_p$, as functions of the parameter $\\theta$.\n\nThe gradient of $\\psi$ in cylindrical coordinates is $\\nabla\\psi = \\frac{\\partial\\psi}{\\partial R}\\hat{\\mathbf{R}} + \\frac{\\partial\\psi}{\\partial Z}\\hat{\\mathbf{Z}}$. The partial derivatives are:\n$$\n\\frac{\\partial\\psi}{\\partial R} = \\frac{\\partial\\psi}{\\partial(r^2)} \\frac{\\partial(r^2)}{\\partial R} = (\\alpha + 2\\beta r^2) (2(R-R_0)) = (2\\alpha + 4\\beta r^2)(r\\cos\\theta)\n$$\n$$\n\\frac{\\partial\\psi}{\\partial Z} = \\frac{\\partial\\psi}{\\partial(r^2)} \\frac{\\partial(r^2)}{\\partial Z} = (\\alpha + 2\\beta r^2) (2Z) = (2\\alpha + 4\\beta r^2)(r\\sin\\theta)\n$$\nThe magnitude of the gradient is therefore:\n$$\n|\\nabla\\psi| = \\sqrt{\\left(\\frac{\\partial\\psi}{\\partial R}\\right)^2 + \\left(\\frac{\\partial\\psi}{\\partial Z}\\right)^2} = \\sqrt{(2\\alpha r + 4\\beta r^3)^2(\\cos^2\\theta + \\sin^2\\theta)} = 2\\alpha r + 4\\beta r^3\n$$\nNote that $|\\nabla\\psi|$ is constant on a given flux surface $r$.\n\nThe poloidal arc-length element $\\mathrm{d}\\ell_p$ is found from the parameterization:\n$$\n\\mathrm{d}R = -r\\sin\\theta\\,\\mathrm{d}\\theta, \\quad \\mathrm{d}Z = r\\cos\\theta\\,\\mathrm{d}\\theta\n$$\n$$\n\\mathrm{d}\\ell_p = \\sqrt{(\\mathrm{d}R)^2 + (\\mathrm{d}Z)^2} = \\sqrt{(-r\\sin\\theta\\,\\mathrm{d}\\theta)^2 + (r\\cos\\theta\\,\\mathrm{d}\\theta)^2} = \\sqrt{r^2(\\mathrm{d}\\theta)^2} = r\\,\\mathrm{d}\\theta\n$$\nSubstituting these expressions into the integral for $q$, we convert the line integral into a definite integral over $\\theta$:\n$$\nq_{\\text{num}}(r) = \\frac{F_0}{2\\pi} \\int_0^{2\\pi} \\frac{1}{(R_0 + r\\cos\\theta)(2\\alpha r + 4\\beta r^3)} (r\\,\\mathrm{d}\\theta)\n$$\nSimplifying by factoring out constants from the integral:\n$$\nq_{\\text{num}}(r) = \\frac{F_0 r}{2\\pi(2\\alpha r + 4\\beta r^3)} \\int_0^{2\\pi} \\frac{\\mathrm{d}\\theta}{R_0 + r\\cos\\theta} = \\frac{F_0}{2\\pi(2\\alpha + 4\\beta r^2)} \\int_0^{2\\pi} \\frac{\\mathrm{d}\\theta}{R_0 + r\\cos\\theta}\n$$\nThis integral will be evaluated numerically.\n\n**3. Small-Inverse-Aspect-Ratio Analytic Approximation**\n\nThe small-inverse-aspect-ratio ($\\epsilon = r/R_0 \\ll 1$) approximation is obtained by replacing the varying major radius $R(\\theta) = R_0 + r\\cos\\theta$ with the constant magnetic axis radius $R_0$ *inside the integrand*. This is the leading-order approximation.\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi} \\oint_{\\psi=\\text{const}} \\frac{1}{R_0|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\nSince $R_0$ and $|\\nabla\\psi|$ are constants along the integration path, they can be moved outside the integral:\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi R_0 |\\nabla\\psi|} \\oint_{\\psi=\\text{const}} \\mathrm{d}\\ell_p\n$$\nThe remaining integral $\\oint \\mathrm{d}\\ell_p$ is simply the poloidal circumference of the circular flux surface, which is $2\\pi r$.\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi R_0 |\\nabla\\psi|} (2\\pi r) = \\frac{F_0 r}{R_0 |\\nabla\\psi|}\n$$\nSubstituting the expression for $|\\nabla\\psi| = 2\\alpha r + 4\\beta r^3$:\n$$\nq_{\\text{approx}}(r) = \\frac{F_0 r}{R_0 (2\\alpha r + 4\\beta r^3)} = \\frac{F_0}{R_0 (2\\alpha + 4\\beta r^2)}\n$$\nThis is the final algebraic formula for the approximation. For the given test cases, we will compute $q_{\\text{num}}$ via numerical quadrature of its integral expression, compute $q_{\\text{approx}}$ using its analytical formula, and then find the relative error $\\delta = \\frac{|q_{\\text{num}} - q_{\\text{approx}}|}{|q_{\\text{num}}|}$.",
            "answer": "[1.651111663185566,1.6501650165016502,0.0005733157502693822,1.250765352349791,1.2254901960784315,0.02020786938953164,0.9652755255836853,0.9208102599262103,0.04606622176986506]"
        }
    ]
}