{
    "hands_on_practices": [
        {
            "introduction": "理解环形几何始于掌握其基本数学描述。第一个实践将引导您从熟悉的笛卡尔坐标系出发，推导标准环形坐标的度规张量和雅可比行列式。通过执行这一基础计算并分析其在大环径比极限下的形式，您将掌握描述任何环形系统局部几何的基本技能。",
            "id": "3960114",
            "problem": "在一个代表磁约束聚变（MCF）托卡马克的环形、同心、轴对称环体中，引入标准环坐标 $\\left(r,\\theta,\\phi\\right)$，其大半径为 $R_{0}$，小半径为 $r$，其中 $0 \\le r \\ll R_{0}$。到笛卡尔空间 $\\left(x,y,z\\right)$ 的几何映射通过柱坐标变量 $R$ 和 $Z$ 定义如下\n$$\nR\\left(r,\\theta\\right)=R_{0}+r\\cos\\theta,\\qquad Z\\left(r,\\theta\\right)=r\\sin\\theta,\n$$\n并且\n$$\nx=R\\cos\\phi,\\qquad y=R\\sin\\phi,\\qquad z=Z,\n$$\n其中角度 $\\theta$ 和 $\\phi$ 均以弧度为单位。\n\n从坐标几何基础出发：\n- 协变基向量 $\\mathbf{e}_{i}=\\partial \\mathbf{x}/\\partial q^{i}$，其中 $q^{i}\\in\\{r,\\theta,\\phi\\}$，\n- 度规张量分量 $g_{ij}=\\mathbf{e}_{i}\\cdot \\mathbf{e}_{j}$，\n- 雅可比 $\\sqrt{g}=\\mathbf{e}_{r}\\cdot\\left(\\mathbf{e}_{\\theta}\\times \\mathbf{e}_{\\phi}\\right)=\\sqrt{\\det\\left[g_{ij}\\right]}$，\n\n推导这些坐标的精确度规张量 $g_{ij}$ 和精确雅可比 $\\sqrt{g}$。然后，引入大环径比参数 $\\epsilon=r/R_{0}$，并在 $\\epsilon\\ll 1$ 的渐近极限下简化度规和雅可比。对于每个非平凡分量，估算相对于主导项的、以 $\\epsilon$ 幂次表示的最低阶非零修正。\n\n答案要求：\n- 最终答案应为雅可比 $\\sqrt{g}$ 作为 $r$、$\\theta$ 和 $R_{0}$ 的函数，关于 $\\epsilon$ 的一阶渐近表达式。\n- 角度以弧度表示。\n- 最终答案必须是一个单一的闭式解析表达式，不带单位，也无余项记法。",
            "solution": "该问题要求推导标准环坐标系 $(r, \\theta, \\phi)$ 的度规张量 $g_{ij}$ 和雅可比 $\\sqrt{g}$，然后进行大环径比渐近分析。\n\n笛卡尔坐标 $(x, y, z)$ 中的位置矢量 $\\mathbf{x}$ 通过环坐标 $(r, \\theta, \\phi)$ 由以下关系式给出：\n$$\nx = (R_0 + r\\cos\\theta)\\cos\\phi\n$$\n$$\ny = (R_0 + r\\cos\\theta)\\sin\\phi\n$$\n$$\nz = r\\sin\\theta\n$$\n我们可以将位置矢量写为：\n$$\n\\mathbf{x}(r, \\theta, \\phi) = (R_0 + r\\cos\\theta)\\cos\\phi \\, \\hat{\\mathbf{i}} + (R_0 + r\\cos\\theta)\\sin\\phi \\, \\hat{\\mathbf{j}} + r\\sin\\theta \\, \\hat{\\mathbf{k}}\n$$\n其中 $R_0$ 是大半径，$r$ 是小半径。\n\n首先，我们计算协变基向量 $\\mathbf{e}_i = \\frac{\\partial \\mathbf{x}}{\\partial q^i}$，其中 $q^i \\in \\{r, \\theta, \\phi\\}$。\n\n$r$ 方向的基向量为：\n$$\n\\mathbf{e}_r = \\frac{\\partial \\mathbf{x}}{\\partial r} = (\\cos\\theta\\cos\\phi)\\,\\hat{\\mathbf{i}} + (\\cos\\theta\\sin\\phi)\\,\\hat{\\mathbf{j}} + (\\sin\\theta)\\,\\hat{\\mathbf{k}}\n$$\n\n$\\theta$ 方向的基向量为：\n$$\n\\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{x}}{\\partial \\theta} = (-r\\sin\\theta\\cos\\phi)\\,\\hat{\\mathbf{i}} + (-r\\sin\\theta\\sin\\phi)\\,\\hat{\\mathbf{j}} + (r\\cos\\theta)\\,\\hat{\\mathbf{k}}\n$$\n\n$\\phi$ 方向的基向量为：\n$$\n\\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{x}}{\\partial \\phi} = -(R_0 + r\\cos\\theta)\\sin\\phi\\,\\hat{\\mathbf{i}} + (R_0 + r\\cos\\theta)\\cos\\phi\\,\\hat{\\mathbf{j}}\n$$\n\n接下来，我们计算度规张量的分量 $g_{ij} = \\mathbf{e}_i \\cdot \\mathbf{e}_j$。\n\n对于对角分量：\n$$\ng_{rr} = \\mathbf{e}_r \\cdot \\mathbf{e}_r = (\\cos^2\\theta\\cos^2\\phi) + (\\cos^2\\theta\\sin^2\\phi) + \\sin^2\\theta = \\cos^2\\theta(\\cos^2\\phi+\\sin^2\\phi) + \\sin^2\\theta = \\cos^2\\theta + \\sin^2\\theta = 1\n$$\n$$\ng_{\\theta\\theta} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\theta = (r^2\\sin^2\\theta\\cos^2\\phi) + (r^2\\sin^2\\theta\\sin^2\\phi) + (r^2\\cos^2\\theta) = r^2\\sin^2\\theta(\\cos^2\\phi+\\sin^2\\phi) + r^2\\cos^2\\theta = r^2(\\sin^2\\theta + \\cos^2\\theta) = r^2\n$$\n$$\ng_{\\phi\\phi} = \\mathbf{e}_\\phi \\cdot \\mathbf{e}_\\phi = (R_0 + r\\cos\\theta)^2\\sin^2\\phi + (R_0 + r\\cos\\theta)^2\\cos^2\\phi = (R_0 + r\\cos\\theta)^2(\\sin^2\\phi+\\cos^2\\phi) = (R_0 + r\\cos\\theta)^2\n$$\n\n对于非对角分量，我们检查其正交性：\n$$\ng_{r\\theta} = \\mathbf{e}_r \\cdot \\mathbf{e}_\\theta = -r\\sin\\theta\\cos\\theta\\cos^2\\phi - r\\sin\\theta\\cos\\theta\\sin^2\\phi + r\\sin\\theta\\cos\\theta = -r\\sin\\theta\\cos\\theta + r\\sin\\theta\\cos\\theta = 0\n$$\n$$\ng_{r\\phi} = \\mathbf{e}_r \\cdot \\mathbf{e}_\\phi = -\\cos\\theta\\cos\\phi(R_0 + r\\cos\\theta)\\sin\\phi + \\cos\\theta\\sin\\phi(R_0 + r\\cos\\theta)\\cos\\phi = 0\n$$\n$$\ng_{\\theta\\phi} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\phi = r\\sin\\theta\\cos\\phi(R_0 + r\\cos\\theta)\\sin\\phi - r\\sin\\theta\\sin\\phi(R_0 + r\\cos\\theta)\\cos\\phi = 0\n$$\n由于所有非对角分量均为零，该坐标系是正交的，度规张量是对角的。精确的度规张量为：\n$$\n[g_{ij}] = \\begin{pmatrix} 1  0  0 \\\\ 0  r^2  0 \\\\ 0  0  (R_0 + r\\cos\\theta)^2 \\end{pmatrix}\n$$\n\n雅可比（体元尺度因子）$\\sqrt{g}$ 由 $\\sqrt{\\det[g_{ij}]}$ 给出。\n$$\n\\det[g_{ij}] = g_{rr} g_{\\theta\\theta} g_{\\phi\\phi} = (1)(r^2)(R_0 + r\\cos\\theta)^2\n$$\n取平方根（并注意到几何体元必须为正，因此我们取正根，这对于托卡马克是合理的，因为 $r \\ge 0$ 且 $R_0 + r\\cos\\theta > 0$），我们得到精确的雅可比：\n$$\n\\sqrt{g} = \\sqrt{r^2 (R_0 + r\\cos\\theta)^2} = r(R_0 + r\\cos\\theta)\n$$\n\n现在，我们引入大环径比参数 $\\epsilon = r/R_0$，并分析在 $\\epsilon \\ll 1$ 极限下的行为。\n\n度规分量 $g_{rr}=1$ 和 $g_{\\theta\\theta}=r^2$ 是精确的，并且与 $R_0$ 无关，所以它们的渐近形式就是它们自身。分量 $g_{\\phi\\phi}$ 取决于环径比：\n$$\ng_{\\phi\\phi} = (R_0 + r\\cos\\theta)^2 = R_0^2 \\left(1 + \\frac{r}{R_0}\\cos\\theta\\right)^2 = R_0^2(1 + \\epsilon\\cos\\theta)^2\n$$\n按 $\\epsilon$ 的幂次展开：\n$$\ng_{\\phi\\phi} = R_0^2 (1 + 2\\epsilon\\cos\\theta + \\epsilon^2\\cos^2\\theta)\n$$\n在渐近极限 $\\epsilon \\ll 1$ 下，主导项是 $R_0^2$。最低阶非零修正是关于 $\\epsilon$ 的线性项，即 $2R_0^2\\epsilon\\cos\\theta = 2R_0 r \\cos\\theta$。相对修正是 $2\\epsilon\\cos\\theta$。\n\n接下来，我们分析雅可比 $\\sqrt{g}$：\n$$\n\\sqrt{g} = r(R_0 + r\\cos\\theta)\n$$\n我们可以提出因子 $R_0$，以明确表示其对 $\\epsilon$ 的依赖关系：\n$$\n\\sqrt{g} = rR_0 \\left(1 + \\frac{r}{R_0}\\cos\\theta\\right) = rR_0(1 + \\epsilon\\cos\\theta)\n$$\n该表达式是精确的，并且已经是一个关于 $\\epsilon = r/R_0$ 的一阶有限多项式。因此，这个表达式本身就是所要求的“关于 $\\epsilon$ 的一阶渐近表达式”。对应于柱坐标极限（$\\epsilon \\to 0$）的主导项是 $rR_0$。最低阶非零修正项是 $rR_0(\\epsilon\\cos\\theta) = r^2\\cos\\theta$。作为 $r$、$\\theta$ 和 $R_0$ 函数的雅可比的最终表达式就是其精确形式。\n\n雅可比的最终表达式：\n$$\n\\sqrt{g} = r(R_0 + r\\cos\\theta)\n$$",
            "answer": "$$\n\\boxed{r(R_0 + r\\cos\\theta)}\n$$"
        },
        {
            "introduction": "虽然几何坐标很有用，但等离子体物理模型通常建立在与磁场本身相关的坐标之上，例如极向磁通量 $\\psi$。本练习要求您在 $(\\psi, \\theta, \\phi)$ 坐标系中推导度规张量，将抽象的几何框架与 Grad-Shafranov 方程中具体的物理量联系起来。这种实践对于理解物理算符如何在磁流形坐标中表达至关重要。",
            "id": "3960084",
            "problem": "考虑一个在柱坐标 $(R,\\phi,Z)$ 中描述的环形约束装置中的轴对称磁静态平衡，其中 $\\phi$ 是以弧度为单位测量的环向角。该平衡由 Grad–Shafranov 方程控制：\n$$\n\\Delta^{*}\\psi(R,Z) \\equiv R \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = -\\mu_{0} R^{2} \\, p'(\\psi) - F(\\psi) F'(\\psi),\n$$\n其中 $\\psi(R,Z)$ 是标记嵌套磁通面的极向磁通函数，$p(\\psi)$ 是标量压力，$F(\\psi) \\equiv R B_{\\phi}$ 是环向场函数，$\\mu_{0}$ 是真空磁导率。假设一个大环径比托卡马克，其磁通面为围绕大半径 $R_{0}$ 的同心圆形，压力梯度 $p'(\\psi)=0$ 可忽略不计，且 $F(\\psi) = B_{0} R_{0}$ 为常数，这与占主导地位的环向磁场一致。在这些假设下，极向磁通函数 $\\psi(R,Z)$ 产生封闭的嵌套磁通面，这些磁通面可以通过小半径 $r$ 和极向角 $\\theta$（以弧度测量）进行参数化，如下所示：\n$$\nR = R_{0} + r \\cos\\theta,\\qquad Z = r \\sin\\theta,\n$$\n并且磁通面标签可被视为 $r$ 的单调函数，即 $\\psi = \\psi(r)$，其中 $r = r(\\psi)$ 是可逆的。\n\n使用坐标映射 $(\\psi,\\theta,\\phi)\\mapsto (R(\\psi,\\theta),Z(\\psi,\\theta),\\phi)$，推导在 $(\\psi,\\theta,\\phi)$ 坐标系中的局域线元 $ds^{2}$ 及相关的协变度规张量分量 $g_{ij}$。然后计算协变度规张量的行列式 $g \\equiv \\det(g_{ij})$。将你的最终答案表示为关于 $R_{0}$、$r(\\psi)$、$\\frac{dr}{d\\psi}$ 和 $\\theta$ 的单个闭式解析表达式 $g(\\psi,\\theta,\\phi)$。不需要进行数值计算，角度必须以弧度为单位。最终答案应仅为 $g$ 的解析表达式，不应包含任何单位。",
            "solution": "该问题陈述经评估后被确定为**有效**。它描述了等离子体物理学和计算聚变科学领域内一个标准的、适定的问题，涉及在简化的环形几何中推导度规张量行列式。该问题在科学上是合理的、客观的、并且是自洽的，为获得唯一的解析解提供了所有必要信息。\n\n目标是计算在环形坐标系 $(\\psi, \\theta, \\phi)$ 中协变度规张量 $g_{ij}$ 的行列式 $g$。起点是标准柱坐标 $(R, \\phi, Z)$ 中的微分线元 $ds^{2}$：\n$$ds^{2} = dR^{2} + dZ^{2} + R^{2} d\\phi^{2}$$\n问题提供了对于一个圆形、大环径比托卡马克模型，从环形坐标 $(\\psi, \\theta, \\phi)$ 到柱坐标 $(R, Z, \\phi)$ 的坐标变换：\n$$R(\\psi, \\theta) = R_{0} + r(\\psi) \\cos\\theta$$\n$$Z(\\psi, \\theta) = r(\\psi) \\sin\\theta$$\n环向角 $\\phi$ 保持不变。小半径 $r$ 是极向磁通 $\\psi$ 的一个单调可逆函数，我们记为 $r(\\psi)$。\n\n为了变换线元，我们首先用新坐标 $\\psi$ 和 $\\theta$ 计算 $R$ 和 $Z$ 的全微分。我们应用多变量函数的链式法则。\n$$dR = \\frac{\\partial R}{\\partial \\psi} d\\psi + \\frac{\\partial R}{\\partial \\theta} d\\theta$$\n$$dZ = \\frac{\\partial Z}{\\partial \\psi} d\\psi + \\frac{\\partial Z}{\\partial \\theta} d\\theta$$\n所需的偏导数计算如下，令 $r'(\\psi) \\equiv \\frac{dr}{d\\psi}$：\n$$\\frac{\\partial R}{\\partial \\psi} = \\frac{\\partial}{\\partial \\psi} (R_{0} + r(\\psi)\\cos\\theta) = \\frac{dr}{d\\psi} \\cos\\theta = r'(\\psi) \\cos\\theta$$\n$$\\frac{\\partial R}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (R_{0} + r(\\psi)\\cos\\theta) = -r(\\psi) \\sin\\theta$$\n$$\\frac{\\partial Z}{\\partial \\psi} = \\frac{\\partial}{\\partial \\psi} (r(\\psi)\\sin\\theta) = \\frac{dr}{d\\psi} \\sin\\theta = r'(\\psi) \\sin\\theta$$\n$$\\frac{\\partial Z}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (r(\\psi)\\sin\\theta) = r(\\psi) \\cos\\theta$$\n将这些表达式代入 $dR$ 和 $dZ$ 的公式中：\n$$dR = (r'(\\psi) \\cos\\theta) d\\psi - (r(\\psi) \\sin\\theta) d\\theta$$\n$$dZ = (r'(\\psi) \\sin\\theta) d\\psi + (r(\\psi) \\cos\\theta) d\\theta$$\n接下来，我们求这些微分的平方，$dR^{2}$ 和 $dZ^{2}$：\n$$dR^{2} = \\left(r'(\\psi) \\cos\\theta \\, d\\psi - r(\\psi) \\sin\\theta \\, d\\theta\\right)^{2} = (r'(\\psi))^{2} \\cos^{2}\\theta \\, d\\psi^{2} - 2r(\\psi)r'(\\psi) \\sin\\theta \\cos\\theta \\, d\\psi d\\theta + r(\\psi)^{2} \\sin^{2}\\theta \\, d\\theta^{2}$$\n$$dZ^{2} = \\left(r'(\\psi) \\sin\\theta \\, d\\psi + r(\\psi) \\cos\\theta \\, d\\theta\\right)^{2} = (r'(\\psi))^{2} \\sin^{2}\\theta \\, d\\psi^{2} + 2r(\\psi)r'(\\psi) \\sin\\theta \\cos\\theta \\, d\\psi d\\theta + r(\\psi)^{2} \\cos^{2}\\theta \\, d\\theta^{2}$$\n将这两个表达式相加，交叉项 $d\\psi d\\theta$ 相互抵消：\n$$dR^{2} + dZ^{2} = \\left((r'(\\psi))^{2} \\cos^{2}\\theta + (r'(\\psi))^{2} \\sin^{2}\\theta\\right) d\\psi^{2} + \\left(r(\\psi)^{2} \\sin^{2}\\theta + r(\\psi)^{2} \\cos^{2}\\theta\\right) d\\theta^{2}$$\n使用基本三角恒等式 $\\sin^{2}\\theta + \\cos^{2}\\theta = 1$，表达式简化为：\n$$dR^{2} + dZ^{2} = (r'(\\psi))^{2} d\\psi^{2} + r(\\psi)^{2} d\\theta^{2} = \\left(\\frac{dr}{d\\psi}\\right)^{2} d\\psi^{2} + r(\\psi)^{2} d\\theta^{2}$$\n将此结果和 $R$ 的表达式代入原始线元 $ds^{2}$ 中，得到：\n$$ds^{2} = \\left(\\frac{dr}{d\\psi}\\right)^{2} d\\psi^{2} + r(\\psi)^{2} d\\theta^{2} + (R_{0} + r(\\psi)\\cos\\theta)^{2} d\\phi^{2}$$\n线元的一般形式是 $ds^{2} = \\sum_{i,j=1}^{3} g_{ij} dx^{i} dx^{j}$，其中坐标为 $(x^{1}, x^{2}, x^{3}) = (\\psi, \\theta, \\phi)$。通过将我们的结果与这个一般形式进行比较，我们可以确定协变度规张量 $g_{ij}$ 的分量。由于没有交叉项（例如，$d\\psi d\\theta$），度规是对角的。对角分量为：\n$$g_{\\psi\\psi} = \\left(\\frac{dr}{d\\psi}\\right)^{2}$$\n$$g_{\\theta\\theta} = r(\\psi)^{2}$$\n$$g_{\\phi\\phi} = (R_{0} + r(\\psi)\\cos\\theta)^{2}$$\n所有非对角分量均为零，$g_{ij} = 0$ for $i \\neq j$。度规张量的矩阵表示为：\n$$ g_{ij} = \\begin{pmatrix} \\left(\\frac{dr}{d\\psi}\\right)^{2}  0  0 \\\\ 0  r(\\psi)^{2}  0 \\\\ 0  0  (R_{0} + r(\\psi)\\cos\\theta)^{2} \\end{pmatrix} $$\n最后一步是计算该张量的行列式，$g \\equiv \\det(g_{ij})$。对于对角矩阵，行列式是其对角元的乘积：\n$$g = g_{\\psi\\psi} \\, g_{\\theta\\theta} \\, g_{\\phi\\phi}$$\n$$g = \\left(\\frac{dr}{d\\psi}\\right)^{2} r(\\psi)^{2} (R_{0} + r(\\psi)\\cos\\theta)^{2}$$\n这是在指定环形坐标中度规张量行列式的最终表达式，用所需变量表示。",
            "answer": "$$\n\\boxed{r(\\psi)^{2} \\left(\\frac{dr}{d\\psi}\\right)^{2} (R_{0} + r(\\psi)\\cos\\theta)^{2}}\n$$"
        },
        {
            "introduction": "坐标变换和度规张量的理论工具在计算应用中找到了其最终价值。最后的实践提供了一个动手编程挑战：构建一个场向网格并实现考虑度规的插值，这是许多聚变模拟程序中的核心任务。通过完成这个练习，您将在解析理论和实际数值实现之间架起一座桥梁，并体会到度规张量如何直接影响计算模型的准确性。",
            "id": "3960106",
            "problem": "实现一个完整的程序，用于在单个环形磁通量面上构建一个场向网格，并为查询点计算度量感知的插值权重。设定为轴对称、大环径比的圆形托卡马克模型，其中小半径为 $r$ 的磁通量面使用柱坐标嵌入到三维欧几里得空间中。所有角度必须以弧度表示，所有长度必须以国际单位制（SI）中的米表示。最终输出必须是无量纲的，并四舍五入到 $8$ 位小数。\n\n您必须从以下基本和核心定义出发，不得引入此处列出的以外的任何额外假设。\n\n- 在柱坐标 $(R,\\phi,Z)$ 中，三维欧几里得线元由二次型 $ds^2 = dR^2 + R^2 d\\phi^2 + dZ^2$ 给出。\n- 一个圆形、同心、轴对称的托卡马克磁通量面由大半径 $R_0$ 和小半径 $r$ 参数化，其极向角 $\\theta$ 和环向角 $\\zeta$ 定义为 $R(\\theta) = R_0 + r \\cos\\theta$，$Z(\\theta) = r \\sin\\theta$，且 $\\phi = \\zeta$。\n- 磁安全因子 $q$ 定义为沿磁通量面上磁力线的比率 $d\\zeta/d\\theta$（即，当一条磁力线沿极向前进一圈时，它会沿环向前进 $q$ 圈）。这意味着可以通过 $\\alpha = \\theta - \\zeta/q$ 构成一个场向对齐坐标，该坐标沿磁力线为常数。\n\n您的程序必须以数学上严谨的方式实现以下任务。\n\n1. 在给定的磁通量面上，使用坐标 $(\\alpha,\\zeta)$ 构建一个均匀、场向对齐的双周期网格，其中 $\\alpha \\in [0,2\\pi)$ 且 $\\zeta \\in [0,2\\pi)$。在 $\\alpha$ 方向上使用 $N_\\alpha$ 个均匀间隔的节点，在 $\\zeta$ 方向上使用 $N_\\zeta$ 个均匀间隔的节点。通过 $\\theta_{i,j} = \\alpha_i + \\zeta_j/q$ 将每个网格节点 $(\\alpha_i,\\zeta_j)$ 映射到磁通量面上的几何角度 $(\\theta_{i,j},\\zeta_{j})$。\n2. 对于每个查询点 $(\\theta_q,\\zeta_q)$，确定 $(\\alpha,\\zeta)$ 空间中四个相邻网格节点的索引，这些节点在每个角度方向上根据 $[0,2\\pi)$ 的周期性构成最小的包围单元。确保在边界处应用周期性环绕处理。\n3. 使用应用于曲面参数化的链式法则，计算由欧几里得线元在磁通量面上导出的协变度量张量。然后在查询位置将该度量变换到场向对齐坐标基 $(\\alpha,\\zeta)$。不要假设变换后的基是正交的。\n4. 对于已确定的四个相邻节点，使用由 $(\\alpha,\\zeta)$ 中的协变度量张量导出的二次型，计算从查询点出发的度量感知距离。使用每个周期性方向上角度差的主值来构成 $(\\alpha,\\zeta)$ 坐标中的位移矢量，并在查询位置评估该二次型。使用指数 $p = 1$ 的反距离加权规则来定义插值权重，并将其归一化，使得它们的和为一。如果查询点与网格节点完全重合（在小容差范围内），将权重 $1$ 分配给该节点，将权重 $0$ 分配给其他三个节点。\n5. 对于每个查询点，输出对应于包围单元四个角点的四个权重的有序列表，顺序为相对于 $(\\alpha,\\zeta)$ 递增的 $[\\text{左下},\\text{右下},\\text{左上},\\text{右上}]$。每个权重必须四舍五入到 $8$ 位小数。该列表是无量纲的。\n\n角度单位要求：所有角度必须以弧度为单位。长度单位要求：所有长度必须以米为单位。\n\n测试套件和参数：\n- 所有测试用例通用的几何和网格参数：$R_0 = 3.0$，$r = 0.3$，$q = 2.2$，$N_\\alpha = 16$，$N_\\zeta = 12$。\n- 待评估的查询点 $(\\theta_q,\\zeta_q)$：\n  - 情况 1（一般内部情况）：$(\\theta_q,\\zeta_q) = (1.3, 2.0)$。\n  - 情况 2（接近周期性环绕）：$(\\theta_q,\\zeta_q) = (6.1, 6.0)$。\n  - 情况 3（节点完全重合）：$(\\theta_q,\\zeta_q) = (0.0, 0.0)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个结果，形式为用方括号括起来的逗号分隔列表，每个结果本身是包含四个四舍五入到 $8$ 位小数的十进制数的列表。例如，总体格式必须严格为\n[ [w00_case1,w10_case1,w01_case1,w11_case1], [w00_case2,w10_case2,w01_case2,w11_case2], [w00_case3,w10_case3,w01_case3,w11_case3] ]\n但没有空格。因此，您的程序应打印单行：\n\"[[w00_case1,w10_case1,w01_case1,w11_case1],[w00_case2,w10_case2,w01_case2,w11_case2],[w00_case3,w10_case3,w01_case3,w11_case3]]\"\n其中每个 $w$ 都四舍五入到 $8$ 位小数。\n\n注记：\n- 您的实现不能硬编码度量分量；相反，应在代码中从指定的基本定义推导它们。\n- 所有中间计算必须与所述单位保持一致。输出的权重是无量纲的，并且必须以四舍五入到 $8$ 位小数的十进制数报告。",
            "solution": "该问题被评估为有效，因为它在科学上基于微分几何和等离子体物理学的原理，在数学上是适定的、客观的，并且包含唯一解所需的所有必要信息。\n\n目标是计算指定查询点在环形磁通量面上的度量感知插值权重。解决方案通过一系列严谨的步骤得出：曲面度量张量的推导、场向对齐坐标系和网格的构建、相邻网格节点的识别以及反距离加权方案的应用。\n\n**1. 坐标系与网格定义**\n\n该问题在由柱坐标 $(R, \\phi, Z)$ 描述的三维欧几里得空间中定义了一个环形磁通量面。该空间中的线元为 $ds^2 = dR^2 + R^2 d\\phi^2 + dZ^2$。曲面本身使用极向角 $\\theta$ 和环向角 $\\zeta$ 进行参数化，其到柱坐标的映射由以下公式给出：\n$$R(\\theta) = R_0 + r \\cos\\theta$$\n$$Z(\\theta) = r \\sin\\theta$$\n$$\\phi = \\zeta$$\n这里，$R_0$ 是环体的大半径，$r$ 是磁通量面的小半径。\n\n引入了场向对齐坐标系 $(\\alpha, \\zeta)$。坐标 $\\alpha$ 沿磁力线为常数，由关系式 $\\alpha = \\theta - \\zeta/q$ 定义，其中 $q$ 是安全因子。这意味着从计算坐标 $(\\alpha, \\zeta)$ 到几何角度 $(\\theta, \\zeta)$ 的变换是：\n$$\\theta(\\alpha, \\zeta) = \\alpha + \\frac{\\zeta}{q}$$\n$$\\zeta(\\alpha, \\zeta) = \\zeta$$\n在计算域 $(\\alpha, \\zeta) \\in [0, 2\\pi) \\times [0, 2\\pi)$ 中构建了一个均匀的双周期网格。在 $\\alpha$ 方向有 $N_\\alpha$ 个节点，在 $\\zeta$ 方向有 $N_\\zeta$ 个节点，网格点 $(\\alpha_i, \\zeta_j)$ 由以下公式给出：\n$$\\alpha_i = i \\frac{2\\pi}{N_\\alpha}, \\quad i \\in \\{0, 1, \\dots, N_\\alpha - 1\\}$$\n$$\\zeta_j = j \\frac{2\\pi}{N_\\zeta}, \\quad j \\in \\{0, 1, \\dots, N_\\zeta - 1\\}$$\n\n**2. 协变度量张量推导**\n\n为了计算曲面上的距离，我们首先推导由欧几里得嵌入导出的协变度量张量 $g_{\\mu\\nu}$。曲面上的线元为 $ds^2 = g_{\\mu\\nu} du^\\mu du^\\nu$，其中 $u^\\mu$ 是曲面坐标。\n\n首先，我们求出 $(\\theta, \\zeta)$ 基下的度量。切向量为 $\\mathbf{e}_\\theta = \\frac{\\partial\\mathbf{x}}{\\partial\\theta}$ 和 $\\mathbf{e}_\\zeta = \\frac{\\partial\\mathbf{x}}{\\partial\\zeta}$，其中 $\\mathbf{x} = (R\\cos\\phi, R\\sin\\phi, Z)$ 是笛卡尔坐标系中的位置矢量。\n偏导数为：\n$$\\frac{\\partial\\mathbf{x}}{\\partial\\theta} = \\begin{pmatrix} -r\\sin\\theta\\cos\\zeta \\\\ -r\\sin\\theta\\sin\\zeta \\\\ r\\cos\\theta \\end{pmatrix}$$\n$$\\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = \\begin{pmatrix} -(R_0 + r\\cos\\theta)\\sin\\zeta \\\\ (R_0 + r\\cos\\theta)\\cos\\zeta \\\\ 0 \\end{pmatrix}$$\n度量分量是这些切向量的点积：\n$$g_{\\theta\\theta} = \\frac{\\partial\\mathbf{x}}{\\partial\\theta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\theta} = r^2\\sin^2\\theta(\\cos^2\\zeta + \\sin^2\\zeta) + r^2\\cos^2\\theta = r^2$$\n$$g_{\\zeta\\zeta} = \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = (R_0+r\\cos\\theta)^2(\\sin^2\\zeta + \\cos^2\\zeta) = (R_0+r\\cos\\theta)^2$$\n$$g_{\\theta\\zeta} = \\frac{\\partial\\mathbf{x}}{\\partial\\theta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = 0$$\n在 $(\\theta, \\zeta)$ 基下的度量张量（我们记为 $g$）是对角的：\n$$g_{(\\theta,\\zeta)} = \\begin{pmatrix} r^2  0 \\\\ 0  (R_0+r\\cos\\theta)^2 \\end{pmatrix}$$\n\n接下来，我们将此度量变换到场向对齐的 $(\\alpha, \\zeta)$ 基。对于一个二阶协变张量，变换规则为 $g' = J^T g J$，其中 $J$ 是从新坐标 $(\\alpha, \\zeta)$ 到旧坐标 $(\\theta, \\zeta)$ 变换的雅可比矩阵。\n$$J = \\frac{\\partial(\\theta, \\zeta)}{\\partial(\\alpha, \\zeta)} = \\begin{pmatrix} \\frac{\\partial\\theta}{\\partial\\alpha}  \\frac{\\partial\\theta}{\\partial\\zeta} \\\\ \\frac{\\partial\\zeta}{\\partial\\alpha}  \\frac{\\partial\\zeta}{\\partial\\zeta} \\end{pmatrix} = \\begin{pmatrix} 1  1/q \\\\ 0  1 \\end{pmatrix}$$\n执行矩阵乘法：\n$$g'_{(\\alpha,\\zeta)} = \\begin{pmatrix} 1  0 \\\\ 1/q  1 \\end{pmatrix} \\begin{pmatrix} r^2  0 \\\\ 0  (R_0+r\\cos\\theta)^2 \\end{pmatrix} \\begin{pmatrix} 1  1/q \\\\ 0  1 \\end{pmatrix}$$\n$$g'_{(\\alpha,\\zeta)} = \\begin{pmatrix} r^2  r^2/q \\\\ r^2/q  r^2/q^2 + (R_0+r\\cos\\theta)^2 \\end{pmatrix}$$\n在非正交的 $(\\alpha, \\zeta)$ 基下的度量分量为：\n$$g_{\\alpha\\alpha} = r^2$$\n$$g_{\\alpha\\zeta} = g_{\\zeta\\alpha} = \\frac{r^2}{q}$$\n$$g_{\\zeta\\zeta} = \\frac{r^2}{q^2} + (R_0+r\\cos\\theta)^2$$\n注意，这些分量取决于几何角度 $\\theta$，必须在感兴趣的位置进行评估。\n\n**3. 插值算法**\n\n对于一个给定的查询点 $(\\theta_q, \\zeta_q)$，插值权重按以下步骤计算：\n\n1.  **坐标变换**：将查询点变换到计算坐标 $(\\alpha, \\zeta)$：\n    $$\\alpha_q = \\theta_q - \\zeta_q/q$$\n    $$\\zeta_q = \\zeta_q$$\n    然后使用模运算将这些角度环绕到主域 $[0, 2\\pi)$。设环绕后的坐标为 $(\\alpha'_q, \\zeta'_q)$。\n\n2.  **邻居识别**：包含查询点的单元的左下角网格节点的索引 $(i_0, j_0)$ 通过以下方式找到：\n    $$i_0 = \\left\\lfloor \\frac{\\alpha'_q}{\\Delta\\alpha} \\right\\rfloor, \\quad j_0 = \\left\\lfloor \\frac{\\zeta'_q}{\\Delta\\zeta} \\right\\rfloor$$\n    其中 $\\Delta\\alpha = 2\\pi/N_\\alpha$ 和 $\\Delta\\zeta = 2\\pi/N_\\zeta$ 是网格间距。四个包围单元角点的索引为 $(i_0, j_0)$, $(i_0+1, j_0)$, $(i_0, j_0+1)$ 和 $(i_0+1, j_0+1)$，其中索引分别对 $N_\\alpha$ 和 $N_\\zeta$ 取模以处理周期性。\n\n3.  **距离计算**：从查询点 $(\\alpha'_q, \\zeta'_q)$ 到每个邻近节点 $k$（位于 $(\\alpha_k, \\zeta_k)$）的距离平方 $d_k^2$ 使用在 $\\theta_q$ 处评估的度量 $g'_{(\\alpha,\\zeta)}$ 导出的二次型计算：\n    $$d_k^2 = g_{\\alpha\\alpha}(\\Delta\\alpha_k)^2 + 2 g_{\\alpha\\zeta}(\\Delta\\alpha_k)(\\Delta\\zeta_k) + g_{\\zeta\\zeta}(\\Delta\\zeta_k)^2$$\n    位移 $(\\Delta\\alpha_k, \\Delta\\zeta_k) = (\\alpha'_q - \\alpha_k, \\zeta'_q - \\zeta_k)$ 必须计算为圆上的最短角度（主值），以尊重域的周期性。对于角度差 $\\delta$，主值为 $(\\delta + \\pi) \\pmod{2\\pi} - \\pi$，其值域为 $(-\\pi, \\pi]$。\n\n4.  **权重计算**：插值权重使用指数 $p=1$ 的反距离方案确定。节点 $k$ 的未归一化权重为 $w'_k = 1/d_k$。然后将它们归一化以使总和为一：\n    $$w_k = \\frac{w'_k}{\\sum_{m} w'_m} = \\frac{1/d_k}{\\sum_{m} 1/d_m}$$\n    在查询点与网格节点重合的特殊情况下（即 $d_k$ 小于一个小的数值容差），该节点的权重设为 $1$，所有其他节点的权重设为 $0$。\n\n然后，对于每个查询点，报告得到的四个权重，对应于单元角点，顺序为 [左下, 右下, 左上, 右上]。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the full problem specification: constructing a field-aligned mesh,\n    computing the metric tensor, and calculating metric-aware interpolation weights.\n    \"\"\"\n    R0 = 3.0\n    r = 0.3\n    q = 2.2\n    N_alpha = 16\n    N_zeta = 12\n\n    test_cases = [\n        (1.3, 2.0),   # Case 1 (general interior case)\n        (6.1, 6.0),   # Case 2 (near-periodic wrap-around)\n        (0.0, 0.0),   # Case 3 (exact node co-location)\n    ]\n\n    all_results = []\n    \n    # Mesh spacings\n    d_alpha = 2 * np.pi / N_alpha\n    d_zeta = 2 * np.pi / N_zeta\n    \n    # Numerical tolerance for co-location check\n    epsilon = 1e-12\n\n    for theta_q, zeta_q in test_cases:\n        # Step 3: Compute the covariant metric tensor at the query location\n        g_aa = r**2\n        g_az = r**2 / q\n        # The metric depends on the geometric angle theta_q\n        g_zz = (r / q)**2 + (R0 + r * np.cos(theta_q))**2\n\n        # Step 1 (cont.)  2: Transform query point and find neighbors\n        # Transform query point to computational coordinates\n        alpha_q_raw = theta_q - zeta_q / q\n        zeta_q_raw = zeta_q\n\n        # Wrap coordinates to the principal domain [0, 2*pi)\n        alpha_q = alpha_q_raw % (2 * np.pi)\n        zeta_q = zeta_q_raw % (2 * np.pi)\n\n        # Find indices of the lower-left node of the containing cell\n        i0 = int(np.floor(alpha_q / d_alpha))\n        j0 = int(np.floor(zeta_q / d_zeta))\n\n        # Node index offsets for the four corners of the cell\n        # Order: lower-left, lower-right, upper-left, upper-right\n        corner_offsets = [(0, 0), (1, 0), (0, 1), (1, 1)]\n        \n        distances = []\n        is_colocated = False\n        colocated_weights = []\n\n        # Step 4: Compute metric-aware distances and weights\n        for i_offset, j_offset in corner_offsets:\n            # Get node indices with periodic wrapping\n            i = (i0 + i_offset) % N_alpha\n            j = (j0 + j_offset) % N_zeta\n            \n            # Node coordinates in (alpha, zeta) space\n            alpha_k = i * d_alpha\n            zeta_k = j * d_zeta\n            \n            # Compute displacement vector using principal value of angular difference\n            delta_alpha = (alpha_q - alpha_k + np.pi) % (2 * np.pi) - np.pi\n            delta_zeta = (zeta_q - zeta_k + np.pi) % (2 * np.pi) - np.pi\n            \n            # Distance calculation using the quadratic form from the metric\n            d_squared = (g_aa * delta_alpha**2 +\n                         2 * g_az * delta_alpha * delta_zeta +\n                         g_zz * delta_zeta**2)\n            \n            # Avoid sqrt of negative due to floating point error\n            if d_squared  0:\n                d_squared = 0\n            \n            dist = np.sqrt(d_squared)\n            \n            # Check for co-location\n            if dist  epsilon:\n                is_colocated = True\n                # Assign 1 to this node, 0 to others\n                colocated_weights = [0.0] * 4\n                current_node_index = corner_offsets.index((i_offset, j_offset))\n                colocated_weights[current_node_index] = 1.0\n                break # Exit the corner loop\n            \n            distances.append(dist)\n        \n        if is_colocated:\n            weights = colocated_weights\n        else:\n            # Inverse-distance weighting with p=1\n            inv_distances = [1.0 / d for d in distances]\n            sum_inv_distances = sum(inv_distances)\n            \n            weights = [inv_d / sum_inv_distances for inv_d in inv_distances]\n\n        all_results.append(weights)\n\n    # Final output formatting\n    # Format each weight to 8 decimal places\n    formatted_results = []\n    for res in all_results:\n        formatted_res = [f\"{w:.8f}\" for w in res]\n        formatted_results.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}