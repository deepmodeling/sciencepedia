{
    "hands_on_practices": [
        {
            "introduction": "计算物理学的基础是对其背后分析理论的扎实掌握。本练习将挑战你从第一性原理出发，推导等离子体位形的关键参数（如拉长率 $\\kappa$ 和三角形变 $\\delta$）如何直接影响磁阱量 $V''(\\psi)$。通过研究 Miller 平衡模型，你将对稳定或破坏等离子体稳定性的几何因素获得关键的直觉理解 。",
            "id": "4008040",
            "problem": "考虑一个大环径比的轴对称托卡马克平衡，其磁通面由Miller平衡模型进行局域参数化。设由极向磁通坐标 $\\psi$ 标记的磁通面，在柱坐标 $(R,\\phi,Z)$ 中的参数表示为\n$$\nR(\\theta;\\psi) = R_{0} + \\Delta(\\psi) + r(\\psi)\\,\\cos\\!\\big(\\Theta(\\theta)\\big), \\qquad Z(\\theta;\\psi) = \\kappa(\\psi)\\,r(\\psi)\\,\\sin\\theta,\n$$\n其中 $\\theta$ 是极向角，$\\phi$ 是环向角，$r(\\psi)$ 是小半径，$\\kappa(\\psi)$ 是拉长率，$\\Delta(\\psi)$ 是Shafranov位移，而三角形变则通过Miller角位移 $\\Theta(\\theta) = \\theta + \\delta(\\psi)\\,\\sin\\theta$引入。假设 $\\delta(\\psi)$ 足够小，使得关于 $\\delta(\\psi)$ 的一阶展开是准确的，并且 $\\kappa(\\psi)$ 和 $\\delta(\\psi)$ 在所选磁通面上是常数，且随 $\\psi$ 变化缓慢，以至于在最终的主阶表达式中可以忽略它们对 $\\psi$ 的导数。在大环径比极限下进行计算，此时 $R(\\theta;\\psi)$ 严格为正，并将 $\\Delta(\\psi)$ 在主阶上视作与 $\\psi$ 无关。\n\n从体积和磁通面微分的基本定义出发，使用\n$$\nV(\\psi) = \\int_{\\psi' \\le \\psi} d^{3}x,\n$$\n以及恒等式\n$$\nV'(\\psi) = \\oint_{\\psi=\\text{const}} \\frac{dS}{|\\nabla \\psi|},\n$$\n其中 $dS$ 是 $\\psi=\\text{const}$ 曲面的面积元，$|\\nabla\\psi|$ 是该曲面法向梯度的模。采用坐标雅可比定义\n$$\n\\sqrt{g} = \\frac{\\partial \\vec{x}}{\\partial \\psi} \\cdot \\left( \\frac{\\partial \\vec{x}}{\\partial \\theta} \\times \\frac{\\partial \\vec{x}}{\\partial \\phi} \\right),\n$$\n并利用环向切线 $\\partial \\vec{x}/\\partial \\phi$ 与极向平面的正交性，用极向雅可比式来表示 $V'(\\psi)$\n$$\nJ_{\\text{pol}}(r,\\theta) \\equiv \\left| \\frac{\\partial \\vec{x}}{\\partial r} \\times \\frac{\\partial \\vec{x}}{\\partial \\theta} \\right|.\n$$\n假设一个二次的磁通-半径映射关系\n$$\n\\psi = \\beta\\, r^{2},\n$$\n其中常数 $\\beta0$ 设定了极向磁通坐标的归一化。\n\n推导 $V''(\\psi)$ 的主阶（$\\delta$ 的一阶）解析表达式，该表达式应明确显示拉长率 $\\kappa$ 和三角形变 $\\delta$ 如何修正磁通面度规元，并从而在Miller平衡模型中影响 $V''(\\psi)$。将你的最终答案表示为包含 $\\psi$、$\\beta$、$\\kappa$ 和 $\\delta$ 的闭合解析表达式。不需要进行数值计算。如果使用了近似，必须根据给定的假设进行说明。最终答案必须是单一的解析表达式。",
            "solution": "用户希望我扮演一位严谨的STEM教授，并解决这个关于托卡马克中Miller平衡的问题。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n-   **系统：** 一个大环径比的轴对称托卡马克平衡。\n-   **参数化（Miller模型）：** 磁通面由极向磁通坐标 $\\psi$ 和极向角 $\\theta$ 参数化。在柱坐标 $(R, \\phi, Z)$ 中，这些曲面由以下公式给出：\n    $$\n    R(\\theta;\\psi) = R_{0} + \\Delta(\\psi) + r(\\psi)\\,\\cos\\!\\big(\\Theta(\\theta)\\big)\n    $$\n    $$\n    Z(\\theta;\\psi) = \\kappa(\\psi)\\,r(\\psi)\\,\\sin\\theta\n    $$\n-   **定义：**\n    -   $r(\\psi)$: 小半径\n    -   $\\kappa(\\psi)$: 拉长率\n    -   $\\Delta(\\psi)$: Shafranov位移\n    -   $\\delta(\\psi)$: 三角形变，通过角位移 $\\Theta(\\theta) = \\theta + \\delta(\\psi)\\,\\sin\\theta$ 引入。\n-   **假设与约束：**\n    1.  小三角形变：$\\delta(\\psi)$ 足够小，使得一阶展开是准确的。\n    2.  缓慢变化的形状参数：$\\kappa(\\psi)$ 和 $\\delta(\\psi)$ 在给定的磁通面上是常数。它们对 $\\psi$ 的导数 $\\frac{d\\kappa}{d\\psi}$ 和 $\\frac{d\\delta}{d\\psi}$ 在最终的主阶表达式中可以被忽略。\n    3.  大环径比极限：$R(\\theta;\\psi)  0$。\n    4.  Shafranov位移 $\\Delta(\\psi)$ 在主阶上被视作与 $\\psi$ 无关。\n    5.  二次磁通-半径映射：$\\psi = \\beta\\, r^{2}$，其中 $\\beta  0$ 是一个常数。\n-   **提供的公式：**\n    -   体积定义：$V(\\psi) = \\int_{\\psi' \\le \\psi} d^{3}x$。\n    -   体积导数：$V'(\\psi) = \\oint_{\\psi=\\text{const}} \\frac{dS}{|\\nabla \\psi|}$。\n    -   坐标雅可比式：$\\sqrt{g} = \\frac{\\partial \\vec{x}}{\\partial \\psi} \\cdot \\left( \\frac{\\partial \\vec{x}}{\\partial \\theta} \\times \\frac{\\partial \\vec{x}}{\\partial \\phi} \\right)$。\n    -   提示使用极向雅可比式：$J_{\\text{pol}}(r,\\theta) \\equiv \\left| \\frac{\\partial \\vec{x}}{\\partial r} \\times \\frac{\\partial \\vec{x}}{\\partial \\theta} \\right|$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n-   **科学依据：**该问题基于Miller平衡模型，这是聚变科学中用于托卡马克等离子体形状的一种标准且广泛使用的解析参数化方法。磁通面、拉长率、三角形变、Shafranov位移以及量 $V''(\\psi)$（与磁阱/磁山有关）等概念是磁流体动（MHD）稳定性理论的基础。该问题牢固地植根于已建立的等离子体物理学。\n-   **适定性：**该问题要求一个特定的量 $V''(\\psi)$，并提供了一套清晰的几何定义和简化假设（小 $\\delta$、大环径比、形状参数的导数可忽略），这些使得推导过程易于处理，并能得出一个唯一的解析表达式。\n-   **客观性：**该问题以精确的数学和物理语言陈述，没有模糊性、主观性或观点。\n-   **完整性与一致性：**给出的信息足以进行推导。这些假设与在指定小参数下的主阶计算是一致的。不存在矛盾的约束条件。\n-   **现实性与可行性：**Miller参数化是偏滤器和限制器等离子体形状的现实模型。这些假设在解析托卡马克理论中是标准的。计算是可行的。\n-   **结构与严谨性：**该问题要求从第一性原理进行严谨的推导，而非简单的计算。几何形状与稳定性相关的量 $V''(\\psi)$ 之间的关系是一个核心概念，而不是一个伪深奥的构想。\n\n**步骤3：结论与行动**\n\n该问题在科学上是合理的，适定的，客观的，且内部一致。它代表了计算聚变科学中一个标准的、不平凡的计算。因此，该问题是**有效的**。我将继续进行解答。\n\n### 解答推导\n\n目标是计算 $V''(\\psi) = \\frac{d^2 V}{d\\psi^2}$。我们首先寻找 $V'(\\psi) = \\frac{dV}{d\\psi}$ 的表达式。在任意坐标系 $(\\alpha^1, \\alpha^2, \\alpha^3)$ 中，体积元为 $d^3x = \\sqrt{g} \\, d\\alpha^1 d\\alpha^2 d\\alpha^3$，其中 $\\sqrt{g}$ 是到笛卡尔坐标变换的雅可比行列式。根据定义 $V(\\psi) = \\int_{\\psi' \\le \\psi} d^3x$，我们可以将体积写成对磁通坐标 $(\\psi, \\theta, \\phi)$ 的积分：\n$$\nV(\\psi) = \\int_0^\\psi d\\psi' \\int_0^{2\\pi} d\\theta \\int_0^{2\\pi} d\\phi \\, \\sqrt{g}(\\psi', \\theta)\n$$\n对 $\\psi$ 求导得到：\n$$\nV'(\\psi) = \\int_0^{2\\pi} d\\theta \\int_0^{2\\pi} d\\phi \\, \\sqrt{g}(\\psi, \\theta)\n$$\n在 $(\\psi, \\theta, \\phi)$ 坐标系中的雅可比式 $\\sqrt{g}$ 与在 $(r, \\theta, \\phi)$ 坐标系中的雅可比式相关。在柱坐标系中，体积元为 $d^3x = R \\, dR \\, dZ \\, d\\phi$。从 $(r, \\theta)$ 到 $(R, Z)$ 的变换有一个极向雅可比式，由以下公式给出：\n$$\n\\mathcal{J} = \\frac{\\partial R}{\\partial r}\\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial Z}{\\partial r}\n$$\n因此体积元为 $d^3x = R |\\mathcal{J}| \\, dr \\, d\\theta \\, d\\phi$。利用磁通-半径映射 $\\psi = \\beta r^2$，我们有 $dr = \\frac{dr}{d\\psi} d\\psi = \\frac{1}{2\\beta r} d\\psi$。代入此式可得：\n$$\nd^3x = R |\\mathcal{J}| \\frac{1}{2\\beta r} \\, d\\psi \\, d\\theta \\, d\\phi\n$$\n由此，我们确定在 $(\\psi, \\theta, \\phi)$ 坐标系中的雅可比式为 $\\sqrt{g} = \\frac{R |\\mathcal{J}|}{2\\beta r}$。\n由于几何结构是轴对称的，$V'(\\psi)$ 的被积函数与 $\\phi$ 无关，对 $\\phi$ 的积分产生一个因子 $2\\pi$。\n$$\nV'(\\psi) = 2\\pi \\int_0^{2\\pi} \\frac{R(r, \\theta) |\\mathcal{J}(r, \\theta)|}{2\\beta r} d\\theta = \\frac{\\pi}{\\beta r} \\int_0^{2\\pi} R(r, \\theta) |\\mathcal{J}(r, \\theta)| d\\theta\n$$\n我们现在计算极向雅可比式 $\\mathcal{J}$。首先，我们需要 $R$ 和 $Z$ 对 $r$ 和 $\\theta$ 的偏导数。给定 $\\Theta(\\theta) = \\theta + \\delta \\sin\\theta$，所以 $\\Theta'(\\theta) = \\frac{d\\Theta}{d\\theta} = 1 + \\delta \\cos\\theta$。\n$$\n\\frac{\\partial R}{\\partial r} = \\cos(\\Theta)\n\\qquad\n\\frac{\\partial R}{\\partial \\theta} = -r \\sin(\\Theta) \\Theta'(\\theta)\n$$\n$$\n\\frac{\\partial Z}{\\partial r} = \\kappa \\sin\\theta\n\\qquad\n\\frac{\\partial Z}{\\partial \\theta} = \\kappa r \\cos\\theta\n$$\n雅可比式为：\n$$\n\\mathcal{J} = \\big(\\cos(\\Theta)\\big) \\big(\\kappa r \\cos\\theta\\big) - \\big(-r \\sin(\\Theta) \\Theta'(\\theta)\\big) \\big(\\kappa \\sin\\theta\\big) = \\kappa r \\left( \\cos\\theta \\cos(\\Theta) + \\sin\\theta \\sin(\\Theta) \\Theta'(\\theta) \\right)\n$$\n我们将其按小参数 $\\delta$ 展开到一阶。\n$$\n\\cos(\\Theta) \\approx \\cos\\theta - \\delta \\sin^2\\theta\n$$\n$$\n\\sin(\\Theta) \\approx \\sin\\theta + \\delta \\sin\\theta \\cos\\theta\n$$\n$$\n\\Theta'(\\theta) \\sin(\\Theta) \\approx (1+\\delta\\cos\\theta)(\\sin\\theta + \\delta\\sin\\theta\\cos\\theta) \\approx \\sin\\theta + 2\\delta\\sin\\theta\\cos\\theta + \\mathcal{O}(\\delta^2)\n$$\n将这些代入 $\\mathcal{J}$ 的表达式中：\n$$\n\\mathcal{J} \\approx \\kappa r \\left( \\cos\\theta (\\cos\\theta - \\delta\\sin^2\\theta) + \\sin\\theta (\\sin\\theta + 2\\delta\\sin\\theta\\cos\\theta) \\right)\n$$\n$$\n\\mathcal{J} \\approx \\kappa r \\left( \\cos^2\\theta - \\delta\\sin^2\\theta\\cos\\theta + \\sin^2\\theta + 2\\delta\\sin^2\\theta\\cos\\theta \\right) = \\kappa r (1 + \\delta \\sin^2\\theta \\cos\\theta)\n$$\n因为 $\\delta$ 很小，所以 $\\mathcal{J}$ 是正的，因此 $|\\mathcal{J}| = \\mathcal{J}$。\n\n接下来，我们展开大半径 $R$。令 $R_c = R_0 + \\Delta$。根据给定的假设，$R_c$ 被视为一个常数。\n$$\nR(r, \\theta) = R_c + r \\cos(\\Theta) \\approx R_c + r(\\cos\\theta - \\delta \\sin^2\\theta)\n$$\n现在我们构成乘积 $R |\\mathcal{J}|$，并保留到 $\\delta$ 的一阶：\n$$\nR|\\mathcal{J}| \\approx \\left( R_c + r(\\cos\\theta - \\delta \\sin^2\\theta) \\right) \\left( \\kappa r (1 + \\delta \\sin^2\\theta \\cos\\theta) \\right)\n$$\n$$\nR|\\mathcal{J}| \\approx \\kappa r \\left[ (R_c + r\\cos\\theta)(1 + \\delta \\sin^2\\theta \\cos\\theta) - r\\delta\\sin^2\\theta \\right] + \\mathcal{O}(\\delta^2)\n$$\n$$\nR|\\mathcal{J}| \\approx \\kappa r \\left[ R_c + r\\cos\\theta + R_c\\delta\\sin^2\\theta\\cos\\theta + r\\delta\\sin^2\\theta\\cos^2\\theta - r\\delta\\sin^2\\theta \\right]\n$$\n$$\nR|\\mathcal{J}| \\approx \\kappa r R_c + \\kappa r^2 \\cos\\theta + \\kappa r\\delta \\left( R_c\\sin^2\\theta\\cos\\theta - r\\sin^2\\theta(1-\\cos^2\\theta) \\right)\n$$\n$$\nR|\\mathcal{J}| \\approx \\kappa r R_c + \\kappa r^2 \\cos\\theta + \\kappa r\\delta \\left( R_c\\sin^2\\theta\\cos\\theta - r\\sin^4\\theta \\right)\n$$\n现在，我们将此表达式对 $\\theta$ 从 $0$ 到 $2\\pi$ 进行积分。\n$$\n\\int_0^{2\\pi} (\\kappa r R_c) d\\theta = 2\\pi \\kappa r R_c\n$$\n$$\n\\int_0^{2\\pi} (\\kappa r^2 \\cos\\theta) d\\theta = 0\n$$\n$$\n\\int_0^{2\\pi} (\\kappa r\\delta R_c\\sin^2\\theta\\cos\\theta) d\\theta = \\kappa r\\delta R_c \\int_0^{2\\pi} \\sin^2\\theta \\, d(\\sin\\theta) = \\kappa r\\delta R_c \\left[\\frac{\\sin^3\\theta}{3}\\right]_0^{2\\pi} = 0\n$$\n$$\n\\int_0^{2\\pi} (-\\kappa r^2\\delta\\sin^4\\theta) d\\theta = -\\kappa r^2\\delta \\int_0^{2\\pi} \\sin^4\\theta d\\theta\n$$\n最后一个积分是标准结果：$\\int_0^{2\\pi} \\sin^4\\theta d\\theta = \\frac{3\\pi}{4}$。\n所以，$R|\\mathcal{J}|$ 的积分是：\n$$\n\\int_0^{2\\pi} R|\\mathcal{J}| d\\theta \\approx 2\\pi \\kappa r R_c - \\frac{3\\pi}{4} \\kappa r^2 \\delta\n$$\n将此结果代入 $V'(\\psi)$ 的表达式中：\n$$\nV'(\\psi) = \\frac{\\pi}{\\beta r} \\left( 2\\pi \\kappa r R_c - \\frac{3\\pi}{4} \\kappa r^2 \\delta \\right) = \\frac{2\\pi^2 \\kappa R_c}{\\beta} - \\frac{3\\pi^2 \\kappa \\delta}{4\\beta} r\n$$\n题目要求 $V''(\\psi)$ 并用 $\\psi$ 表示结果。我们使用 $r = (\\psi/\\beta)^{1/2}$。\n$$\nV'(\\psi) = \\frac{2\\pi^2 \\kappa R_c}{\\beta} - \\frac{3\\pi^2 \\kappa \\delta}{4\\beta} \\left(\\frac{\\psi}{\\beta}\\right)^{1/2} = \\frac{2\\pi^2 \\kappa R_c}{\\beta} - \\frac{3\\pi^2 \\kappa \\delta}{4\\beta^{3/2}} \\psi^{1/2}\n$$\n现在我们对 $\\psi$ 求导。根据假设，我们可以忽略 $\\kappa$ 和 $\\delta$ 对 $\\psi$ 的导数。第一项相对于 $\\psi$ 是常数。\n$$\nV''(\\psi) = \\frac{d}{d\\psi} \\left( \\frac{2\\pi^2 \\kappa R_c}{\\beta} - \\frac{3\\pi^2 \\kappa \\delta}{4\\beta^{3/2}} \\psi^{1/2} \\right)\n$$\n$$\nV''(\\psi) = 0 - \\frac{3\\pi^2 \\kappa \\delta}{4\\beta^{3/2}} \\left( \\frac{1}{2}\\psi^{-1/2} \\right)\n$$\n$$\nV''(\\psi) = - \\frac{3\\pi^2 \\kappa \\delta}{8\\beta^{3/2} \\psi^{1/2}}\n$$\n这就是 $V''(\\psi)$ 的主阶表达式。$\\delta$ 的零阶项为零。因此，这个 $\\delta$ 的一阶项就是主导项。它表明 $V''(\\psi)$ 与拉长率 $\\kappa$ 和三角形变 $\\delta$ 都成正比。在一个典型的D形截面托卡马克中，$\\kappa1$ 且 $\\delta0$，这会得到 $V''(\\psi)0$，对应于一个磁山，这对MHD稳定性有重要影响。",
            "answer": "$$\n\\boxed{- \\frac{3\\pi^2 \\kappa \\delta}{8\\beta^{3/2} \\psi^{1/2}}}\n$$"
        },
        {
            "introduction": "从分析模型转向数值实践，本练习专注于为更复杂的成形等离子体边界计算 $V''(\\psi)$。你将实现一个数值算法，根据等离子体的参数化定义计算其体积。此任务强调了应用理论概念的一个关键方面：理解其有效性的边界，特别是在等离子体边界附近，那里的分界线和刮削层拓扑结构会使简单的磁阱度量失效 。",
            "id": "4008057",
            "problem": "考虑一个环向轴对称的磁静力学平衡，其内部有由无量纲极向磁通坐标 $\\psi \\in [0,1]$ 标记的嵌套闭合磁通量面，其中 $\\psi = 1$ 表示偏滤器位形的分界面。令 $V(\\psi)$ 表示由磁通量面 $\\psi$ 包围的物理体积。“磁阱”或“磁山”的概念与二阶导数 $V''(\\psi)$ 的符号相关：如果 $V''(\\psi)  0$，则称装置在 $\\psi$ 处有磁阱；如果 $V''(\\psi)  0$，则有磁山。在位于闭合磁通量面之外的刮削层 (SOL) 中，$\\psi$ 不是一个明确定义的曲面标签，$V(\\psi)$ 也没有意义。\n\n您需要计算边缘区域附近的 $V''(\\psi)$，并评估刮削层几何形状和X点拓扑结构是否改变了磁阱/磁山度量的适用性。\n\n基本基础和建模假设：\n- 磁通量面在极向截面中通过一个光滑的参数化边界 $(R(\\theta;\\psi), Z(\\theta;\\psi))$ 围绕对称轴旋转来建模，其中 $\\theta \\in [0, 2\\pi)$ 是以弧度为单位的极向角。\n- 对于 $\\psi \\in [0,1]$，小半径依赖于磁通标签，即 $a(\\psi) = a_{\\text{edge}} \\sqrt{\\psi}$。这捕捉了随着 $\\psi$ 向分界面增加，极向截面尺寸增大的特点，同时保持 $\\psi$ 为无量纲。\n- 成形的边界由以下公式给出：\n$$\nR(\\theta;\\psi) = R_0 + a(\\psi)\\cos\\!\\big(\\theta + \\delta \\sin\\theta\\big) + \\xi\\,a(\\psi)\\cos(2\\theta),\n$$\n$$\nZ(\\theta;\\psi) = \\kappa\\,a(\\psi)\\sin\\theta - \\xi\\,\\kappa\\,a(\\psi)\\sin(2\\theta),\n$$\n其中 $R_0$ 是大半径，$a_{\\text{edge}}$ 是边缘小半径尺度，$\\kappa$ 是拉伸度，$\\delta$ 是三角形成形度参数，$\\xi$ 是一个X点拓扑强度参数，随着 $\\xi$ 的增加，它使边界变形为类似分界面的形状。\n- 由磁通量面包围的体积使用帕普斯-古尔丁定理计算，基于横截面积 $A(\\psi)$ 和极向截面的质心半径 $R_c(\\psi)$：\n$$\nV(\\psi) = 2\\pi\\,A(\\psi)\\,R_c(\\psi),\n$$\n其中 $A(\\psi)$ 和 $R_c(\\psi)$ 是通过在 $\\theta$ 中密集采样 $(R(\\theta;\\psi), Z(\\theta;\\psi))$ 形成的多边形，使用鞋带公式和标准多边形质心公式计算得出。\n- 二阶导数 $V''(\\psi)$ 使用中心有限差分近似：\n$$\nV''(\\psi_0) \\approx \\frac{V(\\psi_0+h) - 2V(\\psi_0) + V(\\psi_0-h)}{h^2},\n$$\n其中步长 $h0$ 很小。\n- 磁阱/磁山度量的适用性仅限于远离分界面和X点的闭合磁通量面。为实现此操作，如果满足以下任一条件，则声明该度量不适用：\n  1. 提供的标志表明这是一个开放磁力线的SOL区域（没有闭合磁通量面）。\n  2. 参数化边界表明接近X点，这通过边界速度趋于零来检测。具体来说，定义边界速度\n  $$\n  s(\\theta;\\psi) = \\sqrt{\\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2}\n  $$\n  如果对于一个小的无量纲阈值 $\\tau$，有 $\\min_{\\theta \\in [0,2\\pi)} s(\\theta;\\psi_0)  \\tau\\,a_{\\text{edge}}$，则认为该度量在 $\\psi_0$ 处不适用。\n\n计算任务：\n1. 对于每个指定的测试用例，计算在 $\\psi_0-h$、$\\psi_0$ 和 $\\psi_0+h$ 处的 $V(\\psi)$，单位为立方米 (m$^3$)，然后使用上述中心有限差分公式计算 $V''(\\psi_0)$。使用以弧度为单位的极向角 $\\theta$。\n2. 使用给定的SOL标志和X点邻近性准则评估适用性。\n3. 如果适用，当 $V''(\\psi_0)  0$ 时将结果分类为“磁阱”，当 $V''(\\psi_0)  0$ 时分类为“磁山”。如果不适用，则返回一个布尔值表示不适用，并将 $V''(\\psi_0)$ 设置为 $0$，分类“磁阱”为假（因为该度量未定义）。\n\n实现细节：\n- 在 $[0, 2\\pi)$ 上使用至少 $N = 720$ 个点的均匀 $\\theta$ 离散化来计算面积和质心。\n- 使用鞋带公式从采样多边形计算 $A(\\psi)$ 和 $(R_c(\\psi), Z_c(\\psi))$；体积为 $V(\\psi) = 2\\pi\\,A(\\psi)\\,R_c(\\psi)$。将 $V''(\\psi_0)$ 以 m$^3$ 表示，因为这里的 $\\psi$ 是无量纲的。\n- 使用检测阈值 $\\tau = 10^{-3}$。\n\n测试套件：\n每个测试用例是一个元组 $(R_0, a_{\\text{edge}}, \\kappa, \\delta, \\xi, \\psi_0, h, \\text{closed\\_flux})$，其中几何参数的单位为米，角度单位为弧度：\n- 情况1（正常路径，中度成形，闭合曲面）：\n  - $(R_0, a_{\\text{edge}}, \\kappa, \\delta, \\xi, \\psi_0, h, \\text{closed\\_flux}) = (3.0, 0.6, 1.6, 0.3, 0.0, 0.95, 0.01, \\text{True})$。\n- 情况2（强成形，闭合曲面，近边缘）：\n  - $(3.0, 0.6, 2.2, 0.6, 0.0, 0.98, 0.005, \\text{True})$。\n- 情况3（近X点拓扑，闭合曲面但因拓扑结构导致度量不适用）：\n  - $(3.0, 0.6, 1.8, 0.4, 0.25, 0.99, 0.005, \\text{True})$。\n- 情况4（刮削层几何，开放磁力线）：\n  - $(3.0, 0.6, 1.7, 0.3, 0.0, 1.02, 0.01, \\text{False})$。\n\n最终输出格式：\n- 对于每个测试用例，生成一个三元组 $[\\text{applicable}, V''(\\psi_0), \\text{is\\_well}]$，其中 $\\text{applicable}$ 是一个布尔值，$V''(\\psi_0)$ 是一个以 m$^3$ 为单位的浮点数，$\\text{is\\_well}$ 是一个布尔值，在适用时指示 $V''(\\psi_0)  0$（否则为假）。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，\"[[True,0.123,True],[False,0.0,False],...]\"）。",
            "solution": "我们从嵌套磁通量面的定义和极向磁通坐标 $\\psi$ 开始，后者在磁静力学环向轴对称平衡中将这些曲面参数化。由位于 $\\psi$ 处的磁通量面所包围的体积为\n$$\nV(\\psi) = \\iiint_{\\text{inside flux surface}} d^3x,\n$$\n磁阱/磁山启发式判据使用 $V''(\\psi)$ 的符号：$V''(\\psi)  0$ 表示磁阱，$V''(\\psi)  0$ 表示磁山。这个启发式判据与更高级判据中的交换模不稳定性项有关，但在这里我们纯粹将其用作几何诊断工具。\n\n为了从第一性原理数值计算 $V(\\psi)$，我们使用帕普斯-古尔丁定理计算旋转体体积：如果由磁通量面包围的区域的极向截面积为 $A(\\psi)$，其质心的柱坐标半径为 $R_c(\\psi)$，那么将此面积绕对称轴旋转所生成的体积为\n$$\nV(\\psi) = 2\\pi\\,A(\\psi)\\,R_c(\\psi).\n$$\n因此，问题简化为从极向平面中的边界曲线 $(R(\\theta;\\psi), Z(\\theta;\\psi))$ 计算 $A(\\psi)$ 和 $R_c(\\psi)$。我们将极向角 $\\theta \\in [0, 2\\pi)$（以弧度为单位）均匀离散化：\n$$\n\\theta_j = \\frac{2\\pi j}{N},\\quad j = 0, 1, \\dots, N-1,\n$$\n并形成一个顶点为 $(R_j, Z_j) = (R(\\theta_j;\\psi), Z(\\theta_j;\\psi))$ 的多边形。\n\n使用鞋带公式，有向面积为\n$$\nA(\\psi) = \\frac{1}{2}\\sum_{j=0}^{N-1} \\left(R_j Z_{j+1} - R_{j+1} Z_j\\right),\\quad \\text{with } (R_N, Z_N) \\equiv (R_0, Z_0),\n$$\n多边形的质心 $(R_c(\\psi), Z_c(\\psi))$ 由下式给出\n$$\nR_c(\\psi) = \\frac{1}{6A(\\psi)}\\sum_{j=0}^{N-1} (R_j + R_{j+1})\\left(R_j Z_{j+1} - R_{j+1} Z_j\\right),\n$$\n$$\nZ_c(\\psi) = \\frac{1}{6A(\\psi)}\\sum_{j=0}^{N-1} (Z_j + Z_{j+1})\\left(R_j Z_{j+1} - R_{j+1} Z_j\\right).\n$$\n如果多边形方向导致 $A(\\psi)  0$，我们在计算 $V(\\psi)$ 时使用 $|A(\\psi)|$ 作为物理面积：\n$$\nV(\\psi) = 2\\pi\\,|A(\\psi)|\\,R_c(\\psi),\n$$\n因为 $R_c(\\psi)$ 是一个与方向无关的几何属性，且 $V(\\psi)$ 必须为正。\n\n边界模型捕捉了标准的成形和X点拓扑趋势：\n- 小半径 $a(\\psi) = a_{\\text{edge}}\\sqrt{\\psi}$ 在边缘附近随 $\\psi$ 缩放极向尺寸，同时保持 $\\psi$ 无量纲。\n- 边界通过谐波项包含了三角形成形度 $\\delta$ 和拉伸度 $\\kappa$，以及一个X点拓扑强度 $\\xi$：\n$$\nR(\\theta;\\psi) = R_0 + a(\\psi)\\cos\\!\\big(\\theta + \\delta \\sin\\theta\\big) + \\xi\\,a(\\psi)\\cos(2\\theta),\n$$\n$$\nZ(\\theta;\\psi) = \\kappa\\,a(\\psi)\\sin\\theta - \\xi\\,\\kappa\\,a(\\psi)\\sin(2\\theta).\n$$\n这个模型是光滑的，并捕捉了当 $\\xi$ 较大时边界发展出类分界面特征的定性趋势。关于 $\\theta$ 的导数为\n$$\n\\frac{\\partial R}{\\partial \\theta}(\\theta;\\psi) = -a(\\psi)\\,\\sin\\!\\big(\\theta + \\delta \\sin\\theta\\big)\\,\\big(1 + \\delta\\cos\\theta\\big) - 2\\xi\\,a(\\psi)\\,\\sin(2\\theta),\n$$\n$$\n\\frac{\\partial Z}{\\partial \\theta}(\\theta;\\psi) = \\kappa\\,a(\\psi)\\,\\cos\\theta - 2\\xi\\,\\kappa\\,a(\\psi)\\,\\cos(2\\theta).\n$$\n我们将边界速度定义为\n$$\ns(\\theta;\\psi) = \\sqrt{\\left(\\frac{\\partial R}{\\partial \\theta}\\right)^2 + \\left(\\frac{\\partial Z}{\\partial \\theta}\\right)^2},\n$$\n为了检测与X点的接近程度，我们检查对于小的阈值 $\\tau = 10^{-3}$，是否有 $\\min_\\theta s(\\theta;\\psi_0)  \\tau\\,a_{\\text{edge}}$。\n\n在由多边形和质心计算出 $V(\\psi)$ 后，我们通过中心有限差分近似 $V''(\\psi_0)$：\n$$\nV''(\\psi_0) \\approx \\frac{V(\\psi_0+h) - 2 V(\\psi_0) + V(\\psi_0-h)}{h^2}.\n$$\n\n适用性评估：\n- 在刮削层 (SOL) 中，没有闭合磁通量面，坐标 $\\psi$ 不是一个有效的内部标签；因此该度量不适用。我们通过一个指示开放磁力线几何的布尔标志来编码这一点。\n- 在X点（分界面）附近，拓扑结构发生变化，$V(\\psi)$ 的变化方式与嵌套闭合曲面不同，不是平滑的。如果违反了边界速度阈值，我们将该度量标记为不适用。\n\n每个测试用例的算法步骤：\n1. 读取 $(R_0, a_{\\text{edge}}, \\kappa, \\delta, \\xi, \\psi_0, h, \\text{closed\\_flux})$。\n2. 如果 $\\text{closed\\_flux} = \\text{False}$，直接返回 $[\\text{False}, 0.0, \\text{False}]$。\n3. 否则，在 $\\psi_0$ 处评估边界并计算 $\\min_\\theta s(\\theta;\\psi_0)$。如果 $\\min s  \\tau a_{\\text{edge}}$，由于接近X点，返回 $[\\text{False}, 0.0, \\text{False}]$。\n4. 如果适用，通过多边形面积和质心计算 $\\psi_0-h$、$\\psi_0$ 和 $\\psi_0+h$ 处的 $V(\\psi)$，在 $\\theta$ 中使用 $N = 720$ 个点。\n5. 通过中心差分表达式计算 $V''(\\psi_0)$。如果 $V''(\\psi_0)  0$ 则分类为“磁阱”，否则为“磁山”。返回 $[\\text{True}, V''(\\psi_0), \\text{is\\_well}]$。\n\n单位与输出：\n- 几何量 $R_0$ 和 $a_{\\text{edge}}$ 的单位是米，$\\theta$ 的单位是弧度，$V''(\\psi_0)$ 以立方米 (m$^3$) 表示，因为 $\\psi$ 是无量纲的。\n- 最终程序输出一行，其中包含所有测试用例结果的逗号分隔列表，格式为 \"[[applicable,Vpp,is_well], ...]\"。\n\n这种方法从基本的几何和磁静力学定义出发，使用经过充分测试的计算几何（鞋带公式和质心公式）和帕普斯-古尔丁定理来获得 $V(\\psi)$，然后使用有限差分来计算 $V''(\\psi)$，并使用一个具有物理动机的适用性测试来判断X点邻近度和SOL条件。它从而评估了刮削层几何和X点拓扑是否改变了磁阱/磁山度量的适用性：是的，当检测到开放磁力线拓扑或近分界面简并时，通过不适用标志体现了这种改变。",
            "answer": "```python\n# Python 3.12\n# Required libraries: numpy==1.23.5; scipy is not used.\nimport numpy as np\n\ndef boundary_points(R0, a_edge, kappa, delta, xi, psi, N=720):\n    \"\"\"\n    Generate boundary points (R, Z) for the given flux label psi and shaping parameters.\n    theta is in radians over [0, 2*pi).\n    \"\"\"\n    # Minor radius scaling\n    a = a_edge * np.sqrt(psi)\n    theta = np.linspace(0.0, 2.0*np.pi, N, endpoint=False)\n    # Parametric boundary\n    R = R0 + a*np.cos(theta + delta*np.sin(theta)) + xi*a*np.cos(2.0*theta)\n    Z = kappa*a*np.sin(theta) - xi*kappa*a*np.sin(2.0*theta)\n    return R, Z, theta, a\n\ndef boundary_speed(R0, a_edge, kappa, delta, xi, psi, N=720):\n    \"\"\"\n    Compute s(theta;psi) = sqrt((dR/dtheta)^2 + (dZ/dtheta)^2) over theta and return its minimum.\n    \"\"\"\n    a = a_edge * np.sqrt(psi)\n    theta = np.linspace(0.0, 2.0*np.pi, N, endpoint=False)\n    # Derivatives with respect to theta\n    dR = -a*np.sin(theta + delta*np.sin(theta))*(1.0 + delta*np.cos(theta)) - 2.0*xi*a*np.sin(2.0*theta)\n    dZ = kappa*a*np.cos(theta) - 2.0*xi*kappa*a*np.cos(2.0*theta)\n    s = np.sqrt(dR*dR + dZ*dZ)\n    return np.min(s)\n\ndef polygon_area_centroid(R, Z):\n    \"\"\"\n    Compute oriented area A and centroid (Rc, Zc) of a polygon defined by vertices (R_i, Z_i).\n    Uses shoelace formula and centroid formulas for polygons.\n    Returns (A, Rc, Zc).\n    \"\"\"\n    N = len(R)\n    # Shifted indices\n    R_next = np.roll(R, -1)\n    Z_next = np.roll(Z, -1)\n    cross = R * Z_next - R_next * Z\n    A = 0.5 * np.sum(cross)\n    # Centroid formulas\n    Rc = (1.0 / (6.0 * A)) * np.sum((R + R_next) * cross)\n    Zc = (1.0 / (6.0 * A)) * np.sum((Z + Z_next) * cross)\n    return A, Rc, Zc\n\ndef volume_from_boundary(R0, a_edge, kappa, delta, xi, psi, N=720):\n    \"\"\"\n    Compute V(psi) = 2*pi*|A|*Rc using boundary sampling and centroid.\n    \"\"\"\n    R, Z, _, _ = boundary_points(R0, a_edge, kappa, delta, xi, psi, N=N)\n    A, Rc, _ = polygon_area_centroid(R, Z)\n    V = 2.0 * np.pi * abs(A) * Rc\n    return V\n\ndef compute_Vpp(R0, a_edge, kappa, delta, xi, psi0, h, closed_flux, tau=1e-3, N=720):\n    \"\"\"\n    Compute the applicability flag, V''(psi0) via central finite differences, and classification is_well.\n    Applicability requires closed_flux True and not near X-point (min boundary speed  tau * a_edge).\n    \"\"\"\n    # SOL/open geometry: inapplicable\n    if not closed_flux:\n        return False, 0.0, False\n\n    # X-point proximity detection at psi0\n    s_min = boundary_speed(R0, a_edge, kappa, delta, xi, psi0, N=N)\n    if s_min  tau * a_edge:\n        return False, 0.0, False\n\n    # Central difference for V'' with psi dimensionless\n    V_minus = volume_from_boundary(R0, a_edge, kappa, delta, xi, psi0 - h, N=N)\n    V_0 = volume_from_boundary(R0, a_edge, kappa, delta, xi, psi0, N=N)\n    V_plus = volume_from_boundary(R0, a_edge, kappa, delta, xi, psi0 + h, N=N)\n    Vpp = (V_plus - 2.0*V_0 + V_minus) / (h*h)\n\n    is_well = Vpp > 0.0\n    return True, float(Vpp), bool(is_well)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (R0, a_edge, kappa, delta, xi, psi0, h, closed_flux)\n    test_cases = [\n        (3.0, 0.6, 1.6, 0.3, 0.0, 0.95, 0.01, True),   # Case 1: happy path\n        (3.0, 0.6, 2.2, 0.6, 0.0, 0.98, 0.005, True),  # Case 2: strong shaping\n        (3.0, 0.6, 1.8, 0.4, 0.25, 0.99, 0.005, True), # Case 3: near X-point topology\n        (3.0, 0.6, 1.7, 0.3, 0.0, 1.02, 0.01, False),  # Case 4: SOL, open field lines\n    ]\n\n    results = []\n    for case in test_cases:\n        R0, a_edge, kappa, delta, xi, psi0, h, closed_flux = case\n        applicable, Vpp, is_well = compute_Vpp(R0, a_edge, kappa, delta, xi, psi0, h, closed_flux)\n        results.append([applicable, Vpp, is_well])\n\n    # Final print statement in the exact required format.\n    # Produce a single line containing the results as a comma-separated list enclosed in square brackets.\n    def fmt_item(item):\n        # item is [bool, float, bool]\n        # Ensure Python booleans and floats as strings without extra spaces.\n        return f\"[{str(item[0])},{repr(item[1])},{str(item[2])}]\"\n\n    print(f\"[{','.join(fmt_item(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "一个数值结果的价值取决于其误差估计。本练习在前一个计算实践的基础上，探讨了数值收敛性与可靠性这一核心主题。你将开发一个程序来评估计算出的 $V''(\\psi)$ 对网格分辨率的敏感性，并建立判据以确保“磁阱”或“磁山”的分类是稳健的物理结论，而非离散化产生的伪影 。",
            "id": "4008084",
            "problem": "考虑一个由归一化环向磁通坐标 $\\psi \\in [0,\\psi_{\\max}]$ 标记的嵌套环向磁通面族。假设角度由 Boozer 坐标 $(\\theta,\\zeta)$ 表示，并以弧度为单位。为解决此问题，我们采用这些磁通面在三维欧几里得空间中的一个参数化嵌入，该嵌入由映射 $(\\psi,\\theta,\\zeta) \\mapsto (x,y,z)$ 给出，并由柱坐标 $(R,\\phi,Z)$ 按如下方式构造：\n- $R(\\psi,\\theta,\\zeta) = R_0 + a(\\psi)\\cos\\theta + \\varepsilon(\\psi)\\cos(m\\theta - n\\zeta)$,\n- $Z(\\psi,\\theta,\\zeta) = a(\\psi)\\sin\\theta + \\varepsilon(\\psi)\\sin(m\\theta - n\\zeta)$,\n- $\\phi(\\psi,\\theta,\\zeta) = \\zeta$,\n- $x = R\\cos\\zeta$, $y = R\\sin\\zeta$, $z = Z$。\n\n此处，$R_0$ 是大半径，$a(\\psi)$ 是小半径剖面，$\\varepsilon(\\psi)$ 是一个小的螺旋整形振幅，$(m,n)$ 是整数模数。\n\n根据矢量微积分，与坐标 $(\\psi,\\theta,\\zeta)$ 相关的局域体积元由雅可比行列式给出\n$$\nJ(\\psi,\\theta,\\zeta) = \\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\psi}\\right)\\cdot\\left[\\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\theta}\\right)\\times\\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta}\\right)\\right],\n$$\n其中 $\\boldsymbol{r}=(x,y,z)$。\n\n给定磁通面 $\\psi$ 内包围的体积满足\n$$\nV(\\psi) = \\int_{0}^{\\psi}\\int_{0}^{2\\pi}\\int_{0}^{2\\pi} J(\\psi',\\theta,\\zeta)\\, d\\zeta\\, d\\theta\\, d\\psi',\n$$\n因此\n$$\nV'(\\psi) = \\int_{0}^{2\\pi}\\int_{0}^{2\\pi} J(\\psi,\\theta,\\zeta)\\, d\\zeta\\, d\\theta,\\quad\nV''(\\psi) = \\frac{d}{d\\psi}V'(\\psi).\n$$\n\n在计算聚变科学与工程中，交换不稳定性评估的一个必要环节是可靠地区分“磁阱”与“磁山”行为。对于本问题，该分类纯粹由 $V''(\\psi)$ 的符号定义：\n- “类磁阱”行为，如果 $V''(\\psi)0$，\n- “类磁山”行为，如果 $V''(\\psi)0$。\n如果 $|V''(\\psi)|$ 足够小，由于数值敏感性，该分类被认为是不确定的。\n\n你的任务是实现一个程序，该程序：\n1. 使用具有 $N_\\theta$ 和 $N_\\zeta$ 个点的均匀周期性网格，通过对 $J(\\psi,\\theta,\\zeta)$ 在 $(\\theta,\\zeta)\\in[0,2\\pi]\\times[0,2\\pi]$ 上进行数值积分来计算 $V'(\\psi)$，并使用在 $[0,\\psi_{\\max}]$ 区间上具有 $N_\\psi$ 个采样点的均匀径向网格上的二阶中心差分法，计算目标点 $\\psi=\\psi_\\mathrm{t}$ 处的 $V''(\\psi)$。\n2. 通过执行两次独立的分辨率加密，评估计算出的 $V''(\\psi_\\mathrm{t})$ 对 Boozer 坐标网格数值分辨率的敏感性：\n   - 角向加密：$(N_\\theta,N_\\zeta)\\to(2N_\\theta,2N_\\zeta)$，其中 $N_\\psi$ 固定，\n   - 径向加密：$N_\\psi\\to(2N_\\psi-1)$，其中 $(N_\\theta,N_\\zeta)$ 固定，\n   并重新计算 $V''(\\psi_\\mathrm{t})$。\n3. 应用以下收敛标准以确保分类的可靠性：\n   - 角向收敛：相对变化 $|V''_{\\mathrm{ref,ang}}-V''_{\\mathrm{base}}|/\\max(|V''_{\\mathrm{ref,ang}}|,|V''_{\\mathrm{base}}|, \\delta)$ 小于或等于容差 $\\tau_{\\mathrm{ang}}$，\n   - 径向收敛：相对变化 $|V''_{\\mathrm{ref,rad}}-V''_{\\mathrm{base}}|/\\max(|V''_{\\mathrm{ref,rad}}|,|V''_{\\mathrm{base}}|, \\delta)$ 小于或等于容差 $\\tau_{\\mathrm{rad}}$，\n   - 符号稳定性：$V''_{\\mathrm{base}}$、$V''_{\\mathrm{ref,ang}}$ 和 $V''_{\\mathrm{ref,rad}}$ 的符号相同（忽略任何 $|V''|  \\tau_{\\mathrm{mag}}$ 的情况），\n   - 幅值下限：$|V''_{\\mathrm{base}}|\\ge \\tau_{\\mathrm{mag}}$、$|V''_{\\mathrm{ref,ang}}|\\ge \\tau_{\\mathrm{mag}}$ 和 $|V''_{\\mathrm{ref,rad}}|\\ge \\tau_{\\mathrm{mag}}$。\n   此处 $\\delta$ 是一个小的正则化参数，用于避免除以零；设置 $\\delta$ 等于 $\\tau_{\\mathrm{mag}}$。\n4. 对每个测试用例返回一个布尔结果，指示收敛标准是否同时满足，即在 $\\psi_\\mathrm{t}$ 处的磁阱/磁山分类被认为是可靠的。\n\n使用以下无量纲参数化剖面：\n- $a(\\psi) = a_1\\,\\psi + a_2\\,\\psi^2$,\n- $\\varepsilon(\\psi) = e_1\\,\\psi$。\n\n所有角度均以弧度为单位。所有量均为无量纲。$(\\theta,\\zeta)$ 的积分域为 $[0,2\\pi]\\times[0,2\\pi]$。\n\n实现程序以处理以下测试套件。每个测试用例指定 $(R_0,a_1,a_2,e_1,m,n,\\psi_{\\max},\\psi_\\mathrm{t},N_\\psi,N_\\theta,N_\\zeta,\\tau_{\\mathrm{ang}},\\tau_{\\mathrm{rad}},\\tau_{\\mathrm{mag}})$：\n- 测试 1（理想路径，均衡高分辨率）：$(R_0,a_1,a_2,e_1,m,n,\\psi_{\\max},\\psi_\\mathrm{t},N_\\psi,N_\\theta,N_\\zeta,\\tau_{\\mathrm{ang}},\\tau_{\\mathrm{rad}},\\tau_{\\mathrm{mag}}) = (3.0,0.8,0.3,0.05,2,1,0.6,0.30,101,64,64,10^{-3},5\\times 10^{-3},10^{-4})$。\n- 测试 2（粗角向网格）：$(3.0,0.8,0.3,0.05,2,1,0.6,0.30,101,12,12,10^{-3},5\\times 10^{-3},10^{-4})$。\n- 测试 3（接近不确定的曲率）：$(3.0,0.6,0.0,0.02,2,1,0.5,0.05,101,64,64,10^{-3},5\\times 10^{-3},10^{-3})$。\n- 测试 4（各向异性角向网格）：$(3.0,0.8,0.3,0.05,2,1,0.6,0.30,101,8,64,10^{-4},5\\times 10^{-3},10^{-4})$。\n- 测试 5（不同整形，均衡高分辨率）：$(3.0,0.7,0.2,0.04,3,2,0.6,0.35,101,64,64,10^{-3},5\\times 10^{-3},10^{-4})$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[result_1,result_2,\\ldots]$），其中每个 $result_i$ 是一个布尔值，指示该测试用例的收敛标准是否满足。不允许有其他输出。",
            "solution": "该问题要求对一个模型环向等离子体位形的磁阱/磁山分类的数值可靠性进行评估。该分类基于 $V''(\\psi)$ 的符号，即等离子体体积 $V$ 对环向磁通坐标 $\\psi$ 的二阶导数。正号表示“磁阱”（对交换模稳定），而负号表示“磁山”（不稳定）。核心任务是在特定位置 $\\psi=\\psi_\\mathrm{t}$ 计算 $V''(\\psi)$，并测试结果是否对数值网格分辨率的变化具有鲁棒性。\n\n首先，我们必须确定待计算量的解析表达式。体积导数 $V'(\\psi)$ 定义为坐标系雅可比行列式 $J$ 在角坐标 $(\\theta, \\zeta)$ 上的积分：\n$$\nV'(\\psi) = \\int_{0}^{2\\pi}\\int_{0}^{2\\pi} J(\\psi,\\theta,\\zeta)\\, d\\zeta\\, d\\theta\n$$\n雅可比行列式 $J$ 将逻辑坐标 $(\\psi,\\theta,\\zeta)$ 与笛卡尔空间 $(x,y,z)$ 中的物理体积元联系起来。给定位置矢量 $\\boldsymbol{r}(\\psi,\\theta,\\zeta)=(x,y,z)$，雅可比行列式由标量三重积给出：\n$$\nJ(\\psi,\\theta,\\zeta) = \\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\psi}\\right)\\cdot\\left[\\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\theta}\\right)\\times\\left(\\frac{\\partial \\boldsymbol{r}}{\\partial \\zeta}\\right)\\right] = \\det\\left(\\frac{\\partial(x,y,z)}{\\partial(\\psi,\\theta,\\zeta)}\\right)\n$$\n问题通过到柱坐标 $(R,\\phi,Z)$ 的映射来定义几何构型，其中 $\\phi=\\zeta$。\n$$\nx = R\\cos\\zeta, \\quad y = R\\sin\\zeta, \\quad z=Z\n$$\n使用行列式的链式法则，雅可比行列式可以表示为：\n$$\nJ = \\det\\left(\\frac{\\partial(x,y,z)}{\\partial(R,Z,\\zeta)}\\right) \\det\\left(\\frac{\\partial(R,Z,\\zeta)}{\\partial(\\psi,\\theta,\\zeta)}\\right)\n$$\n第一个行列式是从柱坐标到笛卡尔坐标变换的雅可比行列式，它就是 $R$。第二个行列式展开为：\n$$\n\\det\\begin{pmatrix} \\frac{\\partial R}{\\partial \\psi}  \\frac{\\partial R}{\\partial \\theta}  \\frac{\\partial R}{\\partial \\zeta} \\\\ \\frac{\\partial Z}{\\partial \\psi}  \\frac{\\partial Z}{\\partial \\theta}  \\frac{\\partial Z}{\\partial \\zeta} \\\\ \\frac{\\partial \\zeta}{\\partial \\psi}  \\frac{\\partial \\zeta}{\\partial \\theta}  \\frac{\\partial \\zeta}{\\partial \\zeta} \\end{pmatrix} = \\det\\begin{pmatrix} \\frac{\\partial R}{\\partial \\psi}  \\frac{\\partial R}{\\partial \\theta}  \\frac{\\partial R}{\\partial \\zeta} \\\\ \\frac{\\partial Z}{\\partial \\psi}  \\frac{\\partial Z}{\\partial \\theta}  \\frac{\\partial Z}{\\partial \\zeta} \\\\ 0  0  1 \\end{pmatrix} = \\frac{\\partial R}{\\partial \\psi}\\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial Z}{\\partial \\psi}\n$$\n对于一个良态的右手坐标系，雅可比行列式（以及 $V'(\\psi)$）必须为正。按照惯例，我们选择适当的定向以确保这一点。雅可比行列式的最终表达式为：\n$$\nJ(\\psi, \\theta, \\zeta) = R(\\psi, \\theta, \\zeta) \\left( \\frac{\\partial R}{\\partial \\psi}\\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial Z}{\\partial \\psi} \\right)\n$$\n我们将给定的 $R$ 和 $Z$ 的参数化形式及其导数代入此表达式。剖面为 $a(\\psi) = a_1\\,\\psi + a_2\\,\\psi^2$ 和 $\\varepsilon(\\psi) = e_1\\,\\psi$。它们的导数是 $a'(\\psi) = a_1 + 2a_2\\psi$ 和 $\\varepsilon'(\\psi) = e_1$。令 $\\alpha = m\\theta - n\\zeta$。所需的偏导数是：\n- $\\frac{\\partial R}{\\partial \\psi} = a'(\\psi)\\cos\\theta + \\varepsilon'(\\psi)\\cos\\alpha$\n- $\\frac{\\partial Z}{\\partial \\psi} = a'(\\psi)\\sin\\theta + \\varepsilon'(\\psi)\\sin\\alpha$\n- $\\frac{\\partial R}{\\partial \\theta} = -a(\\psi)\\sin\\theta - m\\varepsilon(\\psi)\\sin\\alpha$\n- $\\frac{\\partial Z}{\\partial \\theta} = a(\\psi)\\cos\\theta + m\\varepsilon(\\psi)\\cos\\alpha$\n雅可比行列式表达式中括号内的项 $K(\\psi,\\theta,\\zeta) \\equiv \\frac{\\partial R}{\\partial \\psi}\\frac{\\partial Z}{\\partial \\theta} - \\frac{\\partial R}{\\partial \\theta}\\frac{\\partial Z}{\\partial \\psi}$ 简化为：\n$$\nK(\\psi,\\theta,\\zeta) = a'(\\psi)a(\\psi) + m\\varepsilon(\\psi)\\varepsilon'(\\psi) + (m a'(\\psi)\\varepsilon(\\psi) + a(\\psi)\\varepsilon'(\\psi))\\cos((1-m)\\theta + n\\zeta)\n$$\n因此，被积函数的完整表达式为 $J(\\psi,\\theta,\\zeta) = R(\\psi,\\theta,\\zeta) \\cdot K(\\psi,\\theta,\\zeta)$。\n\n数值算法流程如下：\n1. 我们实现一个函数来为给定的 $\\psi$ 计算 $V'(\\psi)$。这涉及在 $(\\theta, \\zeta) \\in [0, 2\\pi] \\times [0, 2\\pi]$ 上的二维数值积分。由于被积函数在两个角度上都是周期的，我们使用在均匀网格上的简单求和，这等效于梯形法则并提供高精度。对于一个 $N_\\theta \\times N_\\zeta$ 点的网格，积分近似为：\n$$\nV'(\\psi) \\approx \\frac{4\\pi^2}{N_\\theta N_\\zeta} \\sum_{i=0}^{N_\\theta-1} \\sum_{j=0}^{N_\\zeta-1} J(\\psi, \\theta_i, \\zeta_j)\n$$\n其中 $\\theta_i = 2\\pi i/N_\\theta$ 且 $\\zeta_j = 2\\pi j/N_\\zeta$。为提高效率，此过程使用 `numpy` 进行了向量化。\n\n2. 我们实现一个函数来计算 $V''(\\psi_\\mathrm{t})$。这是通过使用二阶中心有限差分公式实现的：\n$$\nV''(\\psi_\\mathrm{t}) \\approx \\frac{V'(\\psi_\\mathrm{t} + h) - 2V'(\\psi_\\mathrm{t}) + V'(\\psi_\\mathrm{t} - h)}{h^2}\n$$\n步长 $h$ 由径向网格分辨率决定，$h = \\psi_{\\max} / (N_\\psi - 1)$。此计算需要对 $V'(\\psi)$ 积分进行三次求值。\n\n3. 为评估可靠性，我们对 $V''(\\psi_\\mathrm{t})$ 进行三次计算：\n   - $V''_{\\mathrm{base}}$：使用基础分辨率 $(N_\\psi, N_\\theta, N_\\zeta)$。径向步长为 $h_{\\mathrm{base}} = \\psi_{\\max}/(N_\\psi-1)$。\n   - $V''_{\\mathrm{ref,ang}}$：使用角向加密的网格 $(2N_\\theta, 2N_\\zeta)$，但径向分辨率 $N_\\psi$ 相同，因此步长也为 $h_{\\mathrm{base}}$。\n   - $V''_{\\mathrm{ref,rad}}$：使用具有 $2N_\\psi-1$ 个点的径向加密网格，这对应于将步长减半为 $h_{\\mathrm{rad}} = \\psi_{\\max}/(2(N_\\psi-1)) = h_{\\mathrm{base}}/2$。角向网格为基础网格 $(N_\\theta, N_\\zeta)$。\n\n4. 最后，我们将四个指定的收敛标准应用于这三个结果。一个测试用例当且仅当所有四个条件同时满足时，才被视为可靠（True）：\n   - **幅值下限**：$|V''_{\\mathrm{base}}|$、$|V''_{\\mathrm{ref,ang}}|$ 和 $|V''_{\\mathrm{ref,rad}}|$ 必须全部大于或等于阈值 $\\tau_{\\mathrm{mag}}$。\n   - **符号稳定性**：三个 $V''$ 值的符号必须相同。此项在确认满足幅值标准后进行检查。\n   - **角向收敛**：$V''_{\\mathrm{base}}$ 和 $V''_{\\mathrm{ref,ang}}$ 之间的相对差异必须低于容差 $\\tau_{\\mathrm{ang}}$。该差异由 $\\max(|V''_{\\mathrm{base}}|, |V''_{\\mathrm{ref,ang}}|, \\tau_{\\mathrm{mag}})$ 进行归一化。\n   - **径向收敛**：类似地，$V''_{\\mathrm{base}}$ 和 $V''_{\\mathrm{ref,rad}}$ 之间的相对差异必须低于容差 $\\tau_{\\mathrm{rad}}$。\n\n程序遍历每个测试用例，执行这些计算，并将布尔结果汇总成最终所需的列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the final result.\n    \"\"\"\n    test_cases = [\n        # (R0, a1, a2, e1, m, n, psi_max, psi_t, N_psi, N_theta, N_zeta, tau_ang, tau_rad, tau_mag)\n        (3.0, 0.8, 0.3, 0.05, 2, 1, 0.6, 0.30, 101, 64, 64, 1e-3, 5e-3, 1e-4),\n        (3.0, 0.8, 0.3, 0.05, 2, 1, 0.6, 0.30, 101, 12, 12, 1e-3, 5e-3, 1e-4),\n        (3.0, 0.6, 0.0, 0.02, 2, 1, 0.5, 0.05, 101, 64, 64, 1e-3, 5e-3, 1e-3),\n        (3.0, 0.8, 0.3, 0.05, 2, 1, 0.6, 0.30, 101, 8, 64, 1e-4, 5e-3, 1e-4),\n        (3.0, 0.7, 0.2, 0.04, 3, 2, 0.6, 0.35, 101, 64, 64, 1e-3, 5e-3, 1e-4),\n    ]\n\n    results = []\n    for params in test_cases:\n        is_reliable = check_reliability(params)\n        results.append(is_reliable)\n    \n    # Final print statement in the exact required format.\n    # The boolean values are capitalized in Python, so they need to be converted to lowercase strings.\n    print(f\"[{','.join(map(lambda b: str(b).lower(), results))}]\")\n\ndef jacobian(psi, theta_grid, zeta_grid, params):\n    \"\"\"\n    Calculates the Jacobian J(psi, theta, zeta) on a grid of angles.\n    \"\"\"\n    R0, a1, a2, e1, m, n, _, _, _, _, _, _, _, _ = params\n    \n    if psi == 0:\n        return np.zeros_like(theta_grid)\n\n    # Profile functions and their derivatives at psi\n    a = a1 * psi + a2 * psi**2\n    a_prime = a1 + 2 * a2 * psi\n    eps = e1 * psi\n    eps_prime = e1\n\n    # R term in cylindrical coordinates\n    alpha = m * theta_grid - n * zeta_grid\n    R_val = R0 + a * np.cos(theta_grid) + eps * np.cos(alpha)\n\n    # K term, which is the determinant part of the Jacobian in (R, Z, phi)\n    K_val = (a_prime * a + m * eps * eps_prime +\n             (m * a_prime * eps + a * eps_prime) * np.cos((1 - m) * theta_grid + n * zeta_grid))\n    \n    return R_val * K_val\n    \ndef calculate_v_prime(psi, N_theta, N_zeta, params):\n    \"\"\"\n    Computes V'(psi) by numerically integrating the Jacobian over theta and zeta.\n    \"\"\"\n    if psi  0: # Physical coordinate psi must be non-negative\n        return 0.0\n        \n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    zeta = np.linspace(0, 2 * np.pi, N_zeta, endpoint=False)\n    theta_grid, zeta_grid = np.meshgrid(theta, zeta)\n\n    j_values = jacobian(psi, theta_grid, zeta_grid, params)\n    \n    # Integrate using the trapezoidal rule for periodic functions (simple sum)\n    d_theta = 2 * np.pi / N_theta\n    d_zeta = 2 * np.pi / N_zeta\n    integral = np.sum(j_values) * d_theta * d_zeta\n    \n    return integral\n\ndef calculate_v_double_prime(psi_t, h, N_theta, N_zeta, params):\n    \"\"\"\n    Computes V''(psi_t) using a second-order central difference formula.\n    \"\"\"\n    vp_plus = calculate_v_prime(psi_t + h, N_theta, N_zeta, params)\n    vp_mid = calculate_v_prime(psi_t, N_theta, N_zeta, params)\n    vp_minus = calculate_v_prime(psi_t - h, N_theta, N_zeta, params)\n    \n    # Avoid division by zero for h, though h should always be positive here.\n    if h == 0:\n        return 0.0\n        \n    return (vp_plus - 2 * vp_mid - vp_minus) / (h**2)\n\ndef check_reliability(params):\n    \"\"\"\n    Performs the full reliability check for a given set of parameters.\n    \"\"\"\n    _, _, _, _, _, _, psi_max, psi_t, N_psi, N_theta, N_zeta, tau_ang, tau_rad, tau_mag = params\n    \n    # Base calculation\n    h_base = psi_max / (N_psi - 1)\n    v_pp_base = calculate_v_double_prime(psi_t, h_base, N_theta, N_zeta, params)\n\n    # Angular refinement calculation\n    v_pp_ref_ang = calculate_v_double_prime(psi_t, h_base, 2 * N_theta, 2 * N_zeta, params)\n\n    # Radial refinement calculation\n    h_rad_ref = psi_max / ((2 * N_psi - 1) - 1)\n    v_pp_ref_rad = calculate_v_double_prime(psi_t, h_rad_ref, N_theta, N_zeta, params)\n\n    # --- Apply convergence criteria ---\n    \n    # 1. Magnitude floor criterion\n    mag_ok = (abs(v_pp_base) >= tau_mag and\n              abs(v_pp_ref_ang) >= tau_mag and\n              abs(v_pp_ref_rad) >= tau_mag)\n              \n    # 2. Sign stability criterion\n    # This check is only meaningful if the magnitude criterion is met.\n    # The final `and` takes care of combining the conditions.\n    signs = [np.sign(v) for v in [v_pp_base, v_pp_ref_ang, v_pp_ref_rad]]\n    sign_ok = (signs[0] == signs[1] and signs[1] == signs[2])\n    \n    # Regularization parameter for relative difference\n    delta = tau_mag\n    \n    # 3. Angular convergence criterion\n    denom_ang = max(abs(v_pp_ref_ang), abs(v_pp_base), delta)\n    rel_change_ang = abs(v_pp_ref_ang - v_pp_base) / denom_ang\n    ang_ok = rel_change_ang = tau_ang\n    \n    # 4. Radial convergence criterion\n    denom_rad = max(abs(v_pp_ref_rad), abs(v_pp_base), delta)\n    rel_change_rad = abs(v_pp_ref_rad - v_pp_base) / denom_rad\n    rad_ok = rel_change_rad = tau_rad\n    \n    return mag_ok and sign_ok and ang_ok and rad_ok\n\nsolve()\n```"
        }
    ]
}