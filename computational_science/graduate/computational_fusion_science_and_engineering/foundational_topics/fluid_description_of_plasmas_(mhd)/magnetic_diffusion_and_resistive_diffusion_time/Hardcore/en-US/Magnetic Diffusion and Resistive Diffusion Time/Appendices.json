{
    "hands_on_practices": [
        {
            "introduction": "Understanding magnetic diffusion begins with mastering its behavior in the simplest possible configuration. This foundational exercise explores the resistive decay of a magnetic field in a one-dimensional conducting slab, providing a clear illustration of the core physical process. By solving the diffusion equation using an eigenfunction expansion, you will practice a powerful mathematical technique and derive the fundamental timescale that governs the dissipation of magnetic energy in a resistive plasma. ",
            "id": "4005285",
            "problem": "Consider a one-dimensional conducting slab occupying the interval $0 \\le x \\le L$, with uniform electrical conductivity $\\sigma$ and magnetic permeability equal to the permeability of free space $\\mu_{0}$. Assume a stationary medium with no fluid motion and no externally imposed electromotive forces. Let the magnetic field be aligned with the $z$-direction and depend only on $x$ and $t$, so that $\\mathbf{B}(x,t) = B_{z}(x,t)\\,\\hat{\\mathbf{z}}$. The boundaries at $x=0$ and $x=L$ are such that the tangential magnetic field inside the slab satisfies homogeneous Dirichlet conditions $B_{z}(0,t)=0$ and $B_{z}(L,t)=0$ for all $t \\ge 0$. Starting from Maxwell-Faraday’s law and Ohm’s law for a stationary conductor, together with Ampère’s law neglecting displacement current, derive the governing diffusion equation for $B_{z}(x,t)$. Then, by separation of variables, formulate the associated Sturm-Liouville eigenvalue problem for the magnetic diffusion operator in this geometry with the given boundary conditions, and determine its complete set of eigenfunctions and eigenvalues. Finally, from the temporal evolution of each mode, compute the fundamental mode decay time $\\tau_{1}$ (the longest time constant) in closed form. Express the final decay time in seconds as a function of $L$, $\\sigma$, and $\\mu_{0}$. No numerical evaluation is required, and no rounding is needed. Your final answer must be a single closed-form analytic expression.",
            "solution": "The problem asks for the derivation of the governing magnetic diffusion equation in a one-dimensional conducting slab, the formulation and solution of the associated Sturm-Liouville problem, and the calculation of the fundamental mode decay time.\n\nWe begin with the specified laws of electromagnetism for a stationary conductor, neglecting the displacement current.\nMaxwell-Faraday's law of induction is:\n$$ \\nabla \\times \\mathbf{E} = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nAmpère's law (in the magnetostatic approximation) is:\n$$ \\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J} $$\nOhm's law for a stationary conductor with uniform conductivity $\\sigma$ is:\n$$ \\mathbf{J} = \\sigma \\mathbf{E} $$\nWe seek to combine these three equations to obtain a single equation for the magnetic field $\\mathbf{B}$. First, we substitute Ohm's law into Ampère's law to express the electric field $\\mathbf{E}$ in terms of $\\mathbf{B}$:\n$$ \\mathbf{E} = \\frac{\\mathbf{J}}{\\sigma} = \\frac{1}{\\mu_{0} \\sigma} (\\nabla \\times \\mathbf{B}) $$\nNext, we substitute this expression for $\\mathbf{E}$ into Maxwell-Faraday's law:\n$$ \\nabla \\times \\left( \\frac{1}{\\mu_{0} \\sigma} (\\nabla \\times \\mathbf{B}) \\right) = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nSince $\\mu_{0}$ and $\\sigma$ are constants, we can move them outside the curl operator:\n$$ \\frac{1}{\\mu_{0} \\sigma} \\nabla \\times (\\nabla \\times \\mathbf{B}) = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nUsing the vector calculus identity $\\nabla \\times (\\nabla \\times \\mathbf{A}) = \\nabla(\\nabla \\cdot \\mathbf{A}) - \\nabla^2 \\mathbf{A}$, we get:\n$$ \\frac{1}{\\mu_{0} \\sigma} \\left( \\nabla(\\nabla \\cdot \\mathbf{B}) - \\nabla^2 \\mathbf{B} \\right) = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nFrom another of Maxwell's equations (Gauss's law for magnetism), we know that $\\nabla \\cdot \\mathbf{B} = 0$. The equation thus simplifies to:\n$$ \\frac{1}{\\mu_{0} \\sigma} (-\\nabla^2 \\mathbf{B}) = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nRearranging gives the general magnetic diffusion equation:\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = \\frac{1}{\\mu_{0} \\sigma} \\nabla^2 \\mathbf{B} $$\nThe quantity $D_m = 1/(\\mu_0 \\sigma)$ is the magnetic diffusivity.\n\nThe problem specifies a one-dimensional geometry where the magnetic field is $\\mathbf{B}(x,t) = B_{z}(x,t)\\,\\hat{\\mathbf{z}}$. The Laplacian operator $\\nabla^2$ acting on this vector field becomes:\n$$ \\nabla^2 \\mathbf{B} = \\nabla^2 (B_{z}(x,t)\\,\\hat{\\mathbf{z}}) = \\left( \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2} + \\frac{\\partial^2}{\\partial z^2} \\right) B_{z}(x,t)\\,\\hat{\\mathbf{z}} $$\nSince $B_{z}$ depends only on $x$ and $t$, the partial derivatives with respect to $y$ and $z$ are zero. The Laplacian simplifies to $\\nabla^2 \\mathbf{B} = \\frac{\\partial^2 B_{z}}{\\partial x^2} \\hat{\\mathbf{z}}$. The vector PDE reduces to a scalar PDE for the component $B_{z}(x,t)$:\n$$ \\frac{\\partial B_{z}}{\\partial t} = \\frac{1}{\\mu_{0} \\sigma} \\frac{\\partial^2 B_{z}}{\\partial x^2} $$\nThis is the governing diffusion equation for the magnetic field in the slab.\n\nWe solve this equation using the method of separation of variables. Let $B_{z}(x,t) = X(x)T(t)$. Substituting this into the PDE yields:\n$$ X(x) \\frac{dT(t)}{dt} = \\frac{1}{\\mu_{0} \\sigma} T(t) \\frac{d^2 X(x)}{dx^2} $$\nDividing by $X(x)T(t)$ separates the variables:\n$$ \\frac{1}{T(t)} \\frac{dT(t)}{dt} = \\frac{1}{\\mu_{0} \\sigma} \\frac{1}{X(x)} \\frac{d^2 X(x)}{dx^2} $$\nSince the left side depends only on $t$ and the right side depends only on $x$, both sides must be equal to a constant. Let this separation constant be $-\\lambda$.\nThe temporal equation is:\n$$ \\frac{dT}{dt} = -\\lambda T(t) \\implies T(t) = C e^{-\\lambda t} $$\nThis shows that $\\lambda$ represents the decay rate of the magnetic field modes.\nThe spatial equation is:\n$$ \\frac{1}{\\mu_{0} \\sigma} \\frac{1}{X(x)} \\frac{d^2 X(x)}{dx^2} = -\\lambda \\implies \\frac{d^2 X}{dx^2} + (\\mu_{0} \\sigma \\lambda) X(x) = 0 $$\nThe problem asks to formulate the Sturm-Liouville eigenvalue problem for the magnetic diffusion operator. From the separated equations, we can identify the operator as $L = -\\frac{1}{\\mu_{0}\\sigma}\\frac{d^2}{dx^2}$. The eigenvalue problem is $L X(x) = \\lambda X(x)$, which is precisely the spatial ODE we derived:\n$$ -\\frac{1}{\\mu_{0}\\sigma}\\frac{d^2 X}{dx^2} = \\lambda X(x) $$\nThe boundary conditions for $B_{z}(x,t)$ are $B_{z}(0,t)=0$ and $B_{z}(L,t)=0$. For a non-trivial solution, $T(t)$ cannot be zero for all $t$. Thus, the spatial part must satisfy the boundary conditions: $X(0)=0$ and $X(L)=0$.\nThe complete Sturm-Liouville problem is:\n- Differential Equation: $\\frac{d^2 X}{dx^2} + k^2 X = 0$, where we define $k^2 = \\mu_{0} \\sigma \\lambda$.\n- Domain: $x \\in [0, L]$.\n- Boundary Conditions: $X(0)=0$, $X(L)=0$.\n\nThe general solution to the differential equation is $X(x) = A \\sin(kx) + C \\cos(kx)$.\nApplying the boundary condition at $x=0$:\n$$ X(0) = A \\sin(0) + C \\cos(0) = C = 0 $$\nSo, the solution must be of the form $X(x) = A \\sin(kx)$.\nApplying the boundary condition at $x=L$:\n$$ X(L) = A \\sin(kL) = 0 $$\nFor a non-trivial solution ($A \\ne 0$), we must have $\\sin(kL)=0$. This condition is met when $kL = n\\pi$ for any integer $n$. Since $n=0$ gives the trivial solution $X(x)=0$, and negative integers produce the same eigenfunctions as positive integers (up to a sign), we consider $n = 1, 2, 3, \\ldots$.\nThe possible values for $k$ are quantized:\n$$ k_{n} = \\frac{n\\pi}{L}, \\quad n=1, 2, 3, \\ldots $$\nThe eigenfunctions of the problem are therefore:\n$$ X_{n}(x) = \\sin\\left(\\frac{n\\pi x}{L}\\right) $$\nThe corresponding eigenvalues $\\lambda_{n}$ are found from the relation $k_{n}^2 = \\mu_{0} \\sigma \\lambda_{n}$:\n$$ \\lambda_{n} = \\frac{k_{n}^2}{\\mu_{0} \\sigma} = \\frac{1}{\\mu_{0} \\sigma} \\left(\\frac{n\\pi}{L}\\right)^2 = \\frac{n^2 \\pi^2}{\\mu_{0} \\sigma L^2} $$\nThe solution for each mode $n$ is $B_{z,n}(x,t) = C_n \\sin\\left(\\frac{n\\pi x}{L}\\right) e^{-\\lambda_n t}$. The temporal evolution of each mode is characterized by a decay time $\\tau_{n} = 1/\\lambda_{n}$.\n$$ \\tau_{n} = \\frac{\\mu_{0} \\sigma L^2}{n^2 \\pi^2} $$\nThe fundamental mode is the one with the longest decay time. This corresponds to the smallest eigenvalue, which occurs for the lowest possible value of $n$, i.e., $n=1$. The fundamental mode decay time, $\\tau_{1}$, is:\n$$ \\tau_{1} = \\frac{\\mu_{0} \\sigma L^2}{(1)^2 \\pi^2} = \\frac{\\mu_{0} \\sigma L^2}{\\pi^2} $$\nThis expression represents the characteristic time for the magnetic field to diffuse out of the conducting slab.",
            "answer": "$$\\boxed{\\frac{\\mu_{0} \\sigma L^{2}}{\\pi^{2}}}$$"
        },
        {
            "introduction": "Building on the Cartesian slab model, we now move to a more realistic geometry for fusion devices: the axisymmetric cylinder. This practice challenges you to reformulate the magnetic diffusion problem in cylindrical coordinates, a crucial step in modeling plasmas in tokamaks and other cylindrical machines. The analysis will lead you from familiar trigonometric functions to Bessel functions, highlighting how geometry dictates the mathematical form of the solution and providing a more accurate estimate of diffusion times in practical scenarios. ",
            "id": "4005300",
            "problem": "Consider a straight, axisymmetric plasma column of radius $a$ surrounded by vacuum, with uniform scalar resistivity $\\eta$ (in SI units), and no flows. The toroidal (axial) current density $J(r,t)$ is initially peaked at the axis and decays resistively toward a flatter profile. Neglect displacement current and any Hall or pressure-gradient terms. Assume the plasma is long enough that end effects are negligible, and model the evolution as two-dimensional in radius under the magnetoquasistatic limit. Treat the vacuum outside the plasma as enforcing the condition that the current density vanishes at the plasma edge.\n\nStarting from electromagnetic fundamentals and appropriate closures for a resistive plasma, formulate the governing partial differential equation for the resistive evolution of $J(r,t)$ in this cylindrical geometry. Impose regularity at $r=0$ and the boundary condition $J(a,t)=0$. Use separation of variables to obtain the radial eigenvalue problem and identify the lowest eigenvalue of the radial Laplacian operator consistent with these constraints. Using that lowest eigenvalue, estimate the characteristic resistive diffusion time for the flattening of the peaked current profile (i.e., the slowest decay time scale of $J$), and evaluate it numerically for the parameters\n$a = 0.90\\,\\mathrm{m}$ and $\\eta = 1.20 \\times 10^{-7}\\,\\Omega\\cdot\\mathrm{m}$.\nRound your final answer to four significant figures and express the time in seconds.",
            "solution": "### Derivation of the Governing Equation\nWe begin with the fundamental equations of electromagnetism in the magnetoquasistatic approximation, where the displacement current is neglected.\nFaraday's Law of Induction:\n$$ \\nabla \\times \\vec{E} = -\\frac{\\partial \\vec{B}}{\\partial t} $$\nAmpere's Law:\n$$ \\nabla \\times \\vec{B} = \\mu_0 \\vec{J} $$\nThe plasma is described by a simplified form of Ohm's law, with no flows and neglecting Hall and pressure-gradient terms, where the resistivity $\\eta$ is a uniform scalar:\n$$ \\vec{E} = \\eta \\vec{J} $$\nWe seek an evolution equation for the current density, $\\vec{J}$. We can take the curl of Ampere's law:\n$$ \\nabla \\times (\\nabla \\times \\vec{B}) = \\mu_0 (\\nabla \\times \\vec{J}) $$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\vec{A}) = \\nabla(\\nabla \\cdot \\vec{A}) - \\nabla^2 \\vec{A}$ and noting that $\\nabla \\cdot \\vec{B} = 0$, we get:\n$$ -\\nabla^2 \\vec{B} = \\mu_0 (\\nabla \\times \\vec{J}) $$\nNow, substitute Ohm's law into Faraday's law. Since $\\eta$ is constant, we can write:\n$$ \\nabla \\times \\vec{E} = \\nabla \\times (\\eta \\vec{J}) = \\eta (\\nabla \\times \\vec{J}) = -\\frac{\\partial \\vec{B}}{\\partial t} $$\nThis gives an expression for $\\nabla \\times \\vec{J}$:\n$$ \\nabla \\times \\vec{J} = -\\frac{1}{\\eta} \\frac{\\partial \\vec{B}}{\\partial t} $$\nSubstituting this into the curled Ampere's law equation:\n$$ -\\nabla^2 \\vec{B} = \\mu_0 \\left(-\\frac{1}{\\eta} \\frac{\\partial \\vec{B}}{\\partial t}\\right) $$\nRearranging gives the magnetic diffusion equation for $\\vec{B}$:\n$$ \\frac{\\partial \\vec{B}}{\\partial t} = \\frac{\\eta}{\\mu_0} \\nabla^2 \\vec{B} $$\nTo obtain the equation for $\\vec{J}$, we can take the time derivative of Ampere's law:\n$$ \\frac{\\partial}{\\partial t}(\\nabla \\times \\vec{B}) = \\nabla \\times \\left(\\frac{\\partial \\vec{B}}{\\partial t}\\right) = \\mu_0 \\frac{\\partial \\vec{J}}{\\partial t} $$\nSubstituting the diffusion equation for $\\vec{B}$:\n$$ \\nabla \\times \\left(\\frac{\\eta}{\\mu_0} \\nabla^2 \\vec{B}\\right) = \\mu_0 \\frac{\\partial \\vec{J}}{\\partial t} $$\nSince $\\eta$ and $\\mu_0$ are constants, and the curl and Laplacian operators commute:\n$$ \\frac{\\eta}{\\mu_0} \\nabla^2 (\\nabla \\times \\vec{B}) = \\mu_0 \\frac{\\partial \\vec{J}}{\\partial t} $$\nUsing Ampere's law again, $\\nabla \\times \\vec{B} = \\mu_0 \\vec{J}$:\n$$ \\frac{\\eta}{\\mu_0} \\nabla^2 (\\mu_0 \\vec{J}) = \\mu_0 \\frac{\\partial \\vec{J}}{\\partial t} $$\n$$ \\eta \\nabla^2 \\vec{J} = \\mu_0 \\frac{\\partial \\vec{J}}{\\partial t} $$\nThis yields the diffusion equation for the current density $\\vec{J}$:\n$$ \\frac{\\partial \\vec{J}}{\\partial t} = \\frac{\\eta}{\\mu_0} \\nabla^2 \\vec{J} $$\nThe problem is set in a cylindrical coordinate system $(r, \\phi, z)$. The current is purely axial, $\\vec{J} = J(r,t) \\hat{z}$, due to axisymmetry and the assumption of a long cylinder (no $\\phi$ or $z$ dependence). The Laplacian operator acting on this vector field becomes $\\nabla^2 \\vec{J} = (\\nabla^2 J) \\hat{z}$. The scalar Laplacian for a function $J(r,t)$ is:\n$$ \\nabla^2 J = \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left(r \\frac{\\partial J}{\\partial r}\\right) $$\nThus, the governing partial differential equation for $J(r,t)$ is:\n$$ \\frac{\\partial J}{\\partial t} = \\frac{\\eta}{\\mu_0} \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left(r \\frac{\\partial J}{\\partial r}\\right) $$\n\n### Separation of Variables and Eigenvalue Problem\nWe use the method of separation of variables, assuming a solution of the form $J(r,t) = R(r)T(t)$. Substituting into the PDE:\n$$ R(r) \\frac{dT(t)}{dt} = \\frac{\\eta}{\\mu_0} T(t) \\frac{1}{r} \\frac{d}{dr}\\left(r \\frac{dR(r)}{dr}\\right) $$\nDividing by $J(r,t) = R(r)T(t)$ separates the variables:\n$$ \\frac{1}{T(t)}\\frac{dT(t)}{dt} = \\frac{\\eta}{\\mu_0} \\frac{1}{R(r)} \\frac{1}{r} \\frac{d}{dr}\\left(r \\frac{dR(r)}{dr}\\right) = -\\lambda $$\nWe set both sides equal to a separation constant, $-\\lambda$, where $\\lambda > 0$ to represent temporal decay.\n\nThe temporal equation is $\\frac{dT}{dt} = -\\lambda T$, with solution $T(t) = T(0) \\exp(-\\lambda t)$. The inverse of the eigenvalue, $\\tau=1/\\lambda$, represents the characteristic decay time of the mode.\n\nThe radial equation gives the eigenvalue problem:\n$$ \\frac{\\eta}{\\mu_0} \\frac{1}{R(r)} \\frac{1}{r} \\frac{d}{dr}\\left(r \\frac{dR}{dr}\\right) = -\\lambda $$\n$$ \\frac{1}{r} \\frac{d}{dr}\\left(r \\frac{dR}{dr}\\right) + \\frac{\\mu_0 \\lambda}{\\eta} R = 0 $$\nLet's define a constant $k^2 = \\frac{\\mu_0 \\lambda}{\\eta}$. The equation becomes:\n$$ \\frac{d^2 R}{dr^2} + \\frac{1}{r} \\frac{dR}{dr} + k^2 R = 0 $$\nThis is Bessel's differential equation of order $0$. Its general solution is a linear combination of Bessel functions of the first and second kind, order $0$:\n$$ R(r) = c_1 J_0(kr) + c_2 Y_0(kr) $$\n\n### Application of Boundary Conditions\nWe apply the boundary conditions to find the allowed eigenvalues.\n1.  **Regularity at $r=0$**: The function $Y_0(kr)$ diverges as $r \\to 0$. Since the current density must remain finite at the axis, we must set its coefficient to zero, $c_2 = 0$. The solution is therefore of the form $R(r) = c_1 J_0(kr)$.\n2.  **Vanishing current at the edge, $J(a,t)=0$**: This implies $R(a)=0$.\n    $$ J_0(ka) = 0 $$\nThis condition quantizes the possible values of $k$. The values of $ka$ must be the roots (zeros) of the Bessel function $J_0(x)$. Let these roots be denoted by $x_{0,n}$ for $n=1, 2, 3, \\ldots$.\n$$ k_n a = x_{0,n} \\implies k_n = \\frac{x_{0,n}}{a} $$\nThe eigenvalues $\\lambda_n$ are then given by:\n$$ \\lambda_n = \\frac{\\eta k_n^2}{\\mu_0} = \\frac{\\eta}{\\mu_0} \\left(\\frac{x_{0,n}}{a}\\right)^2 $$\nThe radial operator is the radial part of the Laplacian, $\\nabla^2_r = \\frac{1}{r}\\frac{d}{dr}(r\\frac{d}{dr})$. The eigenvalue problem is $\\nabla^2_r R = -k^2 R$. The lowest eigenvalue of this operator (consistent with the constraints) is $-k_1^2 = -(x_{0,1}/a)^2$.\n\n### Characteristic Resistive Diffusion Time\nThe overall solution is a superposition of eigenmodes $J(r,t) = \\sum_{n=1}^{\\infty} c_n J_0(k_n r) \\exp(-\\lambda_n t)$. The characteristic time for the flattening of an initially peaked profile is governed by the slowest decaying mode, which corresponds to the smallest eigenvalue, $\\lambda_1$. This time is the resistive diffusion time $\\tau_R$.\n$$ \\tau_R = \\frac{1}{\\lambda_1} = \\frac{\\mu_0 a^2}{\\eta x_{0,1}^2} $$\nHere, $x_{0,1}$ is the first positive root of the Bessel function $J_0(x)$. Its value is approximately $x_{0,1} \\approx 2.4048255577$.\n\n### Numerical Evaluation\nWe are given the following parameters:\n- $a = 0.90\\,\\mathrm{m}$\n- $\\eta = 1.20 \\times 10^{-7}\\,\\Omega\\cdot\\mathrm{m}$\n- The vacuum permeability is $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$.\n- The first zero of $J_0(x)$ is $x_{0,1} \\approx 2.4048$.\n\nWe can now calculate $\\tau_R$:\n$$ \\tau_R = \\frac{(4\\pi \\times 10^{-7}\\,\\mathrm{H/m}) \\times (0.90\\,\\mathrm{m})^2}{(1.20 \\times 10^{-7}\\,\\Omega\\cdot\\mathrm{m}) \\times (2.4048255577)^2} $$\nThe factors of $10^{-7}$ cancel out:\n$$ \\tau_R = \\frac{4\\pi \\times (0.90)^2}{1.20 \\times (2.4048255577)^2}\\,\\mathrm{s} $$\n$$ \\tau_R = \\frac{4\\pi \\times 0.81}{1.20 \\times 5.78318596} \\,\\mathrm{s} $$\n$$ \\tau_R = \\frac{10.1787602}{6.93982315} \\,\\mathrm{s} $$\n$$ \\tau_R \\approx 1.4667180\\,\\mathrm{s} $$\nRounding the result to four significant figures as requested:\n$$ \\tau_R \\approx 1.467\\,\\mathrm{s} $$",
            "answer": "$$\n\\boxed{1.467}\n$$"
        },
        {
            "introduction": "While analytical solutions provide essential physical insight, most complex problems in fusion science demand numerical methods. This practice bridges the gap between theory and computation by tasking you with building and verifying a numerical solver for the magnetic diffusion equation. Using the method of manufactured solutions—where the analytical result from a simple case is used as a benchmark—you will implement the Crank-Nicolson scheme and perform a convergence study, a critical skill for developing reliable and accurate simulation tools. ",
            "id": "4005307",
            "problem": "Design and implement a self-contained program to verify the accuracy and order of convergence of a one-dimensional magnetic diffusion solver using a manufactured solution with known analytical decay. The numerical model must be derived from first principles of resistive Magnetohydrodynamics (MHD) and implemented with scientifically consistent parameters. The solver will integrate the one-dimensional magnetic diffusion equation in space and in time, and compare the discrete numerical solution to an exact analytical solution to estimate the observed order of convergence under spatial grid refinement.\n\nThe starting point is the induction equation for resistive MHD with uniform scalar electrical resistivity and no flow, reduced to the magnetic diffusion equation for a single Cartesian component:\n$$\n\\frac{\\partial B}{\\partial t} = D_m \\frac{\\partial^2 B}{\\partial x^2},\n$$\nwhere $B = B_z(x,t)$ is the out-of-plane magnetic field, $x \\in [0,L]$ is the spatial coordinate, $t \\ge 0$ is time, and $D_m$ is the magnetic diffusivity with physical unit $\\mathrm{m^2/s}$. Assume homogeneous Dirichlet boundary conditions,\n$$\nB(0,t) = 0, \\quad B(L,t) = 0,\n$$\nand an initial condition given by a single sine eigenmode,\n$$\nB(x,0) = B_0 \\sin\\!\\left(\\frac{n\\pi x}{L}\\right),\n$$\nwith integer mode index $n \\ge 1$ and amplitude $B_0$ in Teslas. For this configuration, the exact solution is\n$$\nB_{\\text{exact}}(x,t) = B_0 \\sin\\!\\left(\\frac{n\\pi x}{L}\\right)\\exp\\!\\left(-D_m \\left(\\frac{n\\pi}{L}\\right)^2 t\\right).\n$$\nThe slowest-decaying mode ($n=1$) defines a mode-specific resistive diffusion time scale:\n$$\n\\tau_{R,1} = \\frac{L^2}{\\pi^2 D_m}.\n$$\n\nYour task is to:\n- Discretize the spatial domain $[0,L]$ with $N_x$ uniformly spaced grid points (including boundaries), grid spacing $\\Delta x = L/(N_x-1)$, and enforce the homogeneous Dirichlet boundary conditions at $x=0$ and $x=L$.\n- Advance in time from $t=0$ to a prescribed final time $t = t_f$ using the Crank-Nicolson method (which is second-order accurate in time) applied to the semi-discrete equation, with time step $\\Delta t$ chosen proportional to $\\Delta x^2$ as\n$$\n\\Delta t = \\theta \\frac{\\Delta x^2}{D_m},\n$$\nfor a fixed dimensionless constant $\\theta > 0$. This choice ensures that the temporal truncation error scales as $\\mathcal{O}(\\Delta x^4)$, so that the overall error is dominated by the spatial second-order truncation error $\\mathcal{O}(\\Delta x^2)$.\n- At the final time $t_f$, compute the discrete $L^2$-norm of the error between the numerical solution $B_{\\text{num}}$ and the exact solution $B_{\\text{exact}}$, defined as\n$$\n\\|e\\|_{2} = \\left(\\sum_{i=0}^{N_x-1} \\left[B_{\\text{num}}(x_i,t_f) - B_{\\text{exact}}(x_i,t_f)\\right]^2 \\Delta x \\right)^{1/2}.\n$$\n- For each test case, estimate the observed order of convergence $p$ by computing the error on a sequence of grid refinements with $N_x$ doubled each time, and using the two finest grids $(h, h/2)$:\n$$\np \\approx \\frac{\\log\\left(\\|e\\|_{2,h} / \\|e\\|_{2,h/2}\\right)}{\\log(2)}.\n$$\n\nImplementation requirements:\n- Use the Crank-Nicolson scheme with second-order central differences for the spatial second derivative. Angles in trigonometric functions must be in radians.\n- Use the following discrete $L^2$-norm definition with $\\Delta x$ weighting, as given above.\n- The final time $t_f$ must be expressed in seconds. If $t_f$ is specified via a fraction of the mode-$n=1$ resistive diffusion time $\\tau_{R,1}$, compute $t_f$ accordingly in seconds.\n- The constant $\\theta$ must be treated as a fixed parameter of the algorithm; you must ensure that the final step exactly reaches $t_f$ by uniformly distributing the total time over an integer number of steps $N_t$ so that $\\Delta t = t_f/N_t$ while respecting the proportionality $\\Delta t \\propto \\Delta x^2$ (choose $N_t$ as the nearest integer greater than or equal to $t_f / (\\theta \\Delta x^2/D_m)$).\n\nTest suite:\nFor all test cases, take $B_0 = 1$ Tesla, $L = 1$ meter. For each test case, compute the observed order $p$ using four grids with $N_x \\in \\{65,129,257,513\\}$, and the two-finest-grid estimate defined above. Use $\\theta = 2.0$ (dimensionless).\n\n- Test case 1 (happy path): $D_m = 10^{-3}$ $\\mathrm{m^2/s}$, $n = 1$, $t_f = 0.2 \\,\\tau_{R,1}$ seconds.\n- Test case 2 (sharper gradients): $D_m = 10^{-3}$ $\\mathrm{m^2/s}$, $n = 3$, $t_f = 0.05 \\,\\tau_{R,1}$ seconds.\n- Test case 3 (lower diffusivity, stiffer physics): $D_m = 10^{-4}$ $\\mathrm{m^2/s}$, $n = 2$, $t_f = 0.02 \\,\\tau_{R,1}$ seconds.\n\nRequired final output format:\nYour program should produce a single line of output containing the three observed orders of convergence for the test cases in the order given above, as a comma-separated list of floating-point numbers enclosed in square brackets (for example, $[p_1,p_2,p_3]$). Each $p_k$ is unitless. No other text should be printed. The program must be self-contained and must not read any input.",
            "solution": "The problem requires the design and implementation of a numerical solver for the one-dimensional magnetic diffusion equation, followed by a verification study to confirm its second-order spatial accuracy. The verification is performed using the method of manufactured solutions, where an analytical solution is known and can be used to precisely quantify the numerical error.\n\nThe governing equation is the magnetic diffusion equation for an out-of-plane magnetic field component $B(x,t)$:\n$$\n\\frac{\\partial B}{\\partial t} = D_m \\frac{\\partial^2 B}{\\partial x^2}\n$$\nThis equation is defined on a spatial domain $x \\in [0,L]$ and for time $t \\ge 0$. The parameter $D_m$ is the constant magnetic diffusivity. The system is subject to homogeneous Dirichlet boundary conditions, $B(0,t) = 0$ and $B(L,t) = 0$, and a sinusoidal initial condition, $B(x,0) = B_0 \\sin(n\\pi x/L)$.\n\nTo solve this partial differential equation numerically, we proceed by discretizing both space and time.\n\n**1. Spatial Discretization**\n\nThe spatial domain $[0,L]$ is discretized into a uniform grid with $N_x$ points, denoted by $x_i = i \\Delta x$ for $i = 0, 1, \\dots, N_x-1$, where the grid spacing is $\\Delta x = L/(N_x-1)$. The value of the magnetic field at a grid point $x_i$ and time $t$ is denoted by $B_i(t) = B(x_i, t)$.\n\nThe second partial derivative with respect to space, $\\partial^2 B / \\partial x^2$, is approximated at each interior grid point $x_i$ (for $i=1, \\dots, N_x-2$) using a second-order accurate central difference formula:\n$$\n\\frac{\\partial^2 B}{\\partial x^2}\\bigg|_{x_i} \\approx \\frac{B(x_{i+1}, t) - 2B(x_i, t) + B(x_{i-1}, t)}{\\Delta x^2} = \\frac{B_{i+1}(t) - 2B_i(t) + B_{i-1}(t)}{\\Delta x^2}\n$$\nSubstituting this into the governing equation yields a system of ordinary differential equations (ODEs) for the values of $B$ at the interior grid points, a method known as the method of lines:\n$$\n\\frac{d B_i}{d t} = \\frac{D_m}{\\Delta x^2} (B_{i+1} - 2B_i + B_{i-1})\n$$\n\n**2. Temporal Discretization: The Crank-Nicolson Method**\n\nTo discretize in time, we use the Crank-Nicolson method, which is an implicit method known for its A-stability and second-order accuracy in time. The time domain is discretized into steps of size $\\Delta t$, such that $t_k = k \\Delta t$. The solution at time $t_k$ and grid point $x_i$ is denoted $B_i^k$.\n\nThe Crank-Nicolson scheme approximates the time derivative at the midpoint of a time interval $[t_k, t_{k+1}]$ and averages the spatial derivative over the beginning and end of the interval:\n$$\n\\frac{B_i^{k+1} - B_i^k}{\\Delta t} = \\frac{D_m}{2} \\left[ \\left(\\frac{B_{i+1}^{k+1} - 2B_i^{k+1} + B_{i-1}^{k+1}}{\\Delta x^2}\\right) + \\left(\\frac{B_{i+1}^{k} - 2B_i^{k} + B_{i-1}^{k}}{\\Delta x^2}\\right) \\right]\n$$\nOur goal is to solve for the unknown state $B_i^{k+1}$ at the next time step, given the known state $B_i^k$ at the current time step. We rearrange the equation by moving all terms involving $B^{k+1}$ to the left-hand side and all terms involving $B^k$ to the right-hand side. Let us define a dimensionless parameter $\\alpha = \\frac{D_m \\Delta t}{2 \\Delta x^2}$. The equation becomes:\n$$\n-\\alpha B_{i-1}^{k+1} + (1+2\\alpha)B_i^{k+1} - \\alpha B_{i+1}^{k+1} = \\alpha B_{i-1}^{k} + (1-2\\alpha)B_i^{k} + \\alpha B_{i+1}^{k}\n$$\nThis equation holds for all interior grid points, $i = 1, 2, \\dots, N_x-2$. The boundary conditions $B_0^k = 0$ and $B_{N_x-1}^k = 0$ are enforced for all time steps $k$.\n\n**3. Matrix Formulation**\n\nThe system of equations for the interior points can be expressed in matrix form. Let $\\mathbf{B}^k$ be the column vector of solutions at the interior points at time $t_k$, i.e., $\\mathbf{B}^k = [B_1^k, B_2^k, \\dots, B_{N_x-2}^k]^T$. The system can be written as:\n$$\n\\mathbf{M}_{LHS} \\mathbf{B}^{k+1} = \\mathbf{M}_{RHS} \\mathbf{B}^k\n$$\nwhere $\\mathbf{M}_{LHS}$ and $\\mathbf{M}_{RHS}$ are $(N_x-2) \\times (N_x-2)$ tridiagonal matrices:\n$$\n\\mathbf{M}_{LHS} = \n\\begin{pmatrix}\n1+2\\alpha & -\\alpha & 0 & \\dots \\\\\n-\\alpha & 1+2\\alpha & -\\alpha & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & -\\alpha & 1+2\\alpha\n\\end{pmatrix}\n$$\n$$\n\\mathbf{M}_{RHS} = \n\\begin{pmatrix}\n1-2\\alpha & \\alpha & 0 & \\dots \\\\\n\\alpha & 1-2\\alpha & \\alpha & \\dots \\\\\n0 & \\ddots & \\ddots & \\ddots \\\\\n\\dots & 0 & \\alpha & 1-2\\alpha\n\\end{pmatrix}\n$$\nTo advance the solution from time $t_k$ to $t_{k+1}$, we must solve the linear system for $\\mathbf{B}^{k+1}$. Since $\\mathbf{M}_{LHS}$ is a tridiagonal matrix, this system can be solved very efficiently in $\\mathcal{O}(N_x)$ operations using a specialized algorithm such as the Thomas algorithm, often available in scientific computing libraries.\n\n**4. Algorithm and Convergence Analysis**\n\nThe overall algorithm is as follows:\n1.  For each test case, define the physical parameters $B_0, L, D_m, n$, the numerical parameter $\\theta$, and the final time specification $t_f$. Calculate the mode-1 resistive time $\\tau_{R,1} = L^2/(\\pi^2 D_m)$ and subsequently the final time $t_f$ in seconds.\n2.  Iterate through a sequence of grid resolutions, $N_x \\in \\{65, 129, 257, 513\\}$. For each $N_x$:\n    a.  Calculate the grid spacing $\\Delta x = L/(N_x-1)$.\n    b.  Determine the number of time steps $N_t$ and the time step size $\\Delta t$. As specified, we first compute an ideal time step $\\Delta t_{ideal} = \\theta \\Delta x^2/D_m$. Then, the number of steps is $N_t = \\lceil t_f / \\Delta t_{ideal} \\rceil$, and the actual time step is adjusted to $\\Delta t = t_f / N_t$ to ensure the simulation ends exactly at $t_f$.\n    c.  Initialize the numerical solution vector $\\mathbf{B}^0$ using the initial condition $B(x,0)$ on the discrete grid.\n    d.  Construct the matrices $\\mathbf{M}_{LHS}$ and $\\mathbf{M}_{RHS}$ (or their representations for a banded solver).\n    e.  Iterate $N_t$ times: in each step, calculate the right-hand side vector $\\mathbf{v} = \\mathbf{M}_{RHS} \\mathbf{B}^k$ and solve the linear system $\\mathbf{M}_{LHS} \\mathbf{B}^{k+1} = \\mathbf{v}$ for $\\mathbf{B}^{k+1}$.\n3.  After the final time step, the numerical solution $B_{\\text{num}}(x_i, t_f)$ is obtained. Compute the exact solution $B_{\\text{exact}}(x_i, t_f)$ on the same grid.\n4.  Calculate the discrete $L^2$-norm of the error $e = B_{\\text{num}} - B_{\\text{exact}}$:\n    $$\n    \\|e\\|_{2} = \\left(\\sum_{i=0}^{N_x-1} \\left[B_{\\text{num}}(x_i,t_f) - B_{\\text{exact}}(x_i,t_f)\\right]^2 \\Delta x \\right)^{1/2}\n    $$\n5.  Store the error for each resolution $N_x$.\n6.  Using the errors calculated on the two finest grids (corresponding to grid spacings $h$ and $h/2$), estimate the order of convergence $p$ as:\n    $$\n    p \\approx \\frac{\\log\\left(\\|e\\|_{2,h} / \\|e\\|_{2,h/2}\\right)}{\\log(2)}\n    $$\n\nSince the Crank-Nicolson method is second-order accurate in space ($\\mathcal{O}(\\Delta x^2)$) and time ($\\mathcal{O}(\\Delta t^2)$), and the time step is chosen such that $\\Delta t \\propto \\Delta x^2$, the temporal truncation error scales as $\\mathcal{O}(\\Delta t^2) \\propto \\mathcal{O}(\\Delta x^4)$. The total error is therefore dominated by the spatial error, and we expect the observed order of convergence $p$ to approach $2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the verification test for the 1D magnetic diffusion equation.\n    \"\"\"\n    # Test cases as defined in the problem statement.\n    test_cases = [\n        # (Dm, n, tf_fraction_of_tau_R1)\n        (1e-3, 1, 0.2),\n        (1e-3, 3, 0.05),\n        (1e-4, 2, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        Dm, n, tf_frac_tau = case\n        p = compute_convergence_order(\n            Dm=Dm, \n            n=n, \n            tf_frac_tau=tf_frac_tau\n        )\n        results.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\ndef compute_convergence_order(Dm, n, tf_frac_tau):\n    \"\"\"\n    Computes the observed order of convergence for a single test case.\n\n    Args:\n        Dm (float): Magnetic diffusivity.\n        n (int): Initial condition mode number.\n        tf_frac_tau (float): Final time as a fraction of the resistive time.\n\n    Returns:\n        float: Observed order of convergence p.\n    \"\"\"\n    # Fixed parameters\n    B0 = 1.0  # Tesla\n    L = 1.0   # meter\n    theta = 2.0 # dimensionless constant for dt\n    Nx_list = [65, 129, 257, 513]\n\n    # Calculate resistive time and final time\n    tau_R1 = L**2 / (np.pi**2 * Dm)\n    tf = tf_frac_tau * tau_R1\n    \n    errors = []\n\n    for Nx in Nx_list:\n        # Spatial grid\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n\n        # Time grid\n        # As per problem: choose Nt to ensure dt is proportional to dx^2\n        # and the simulation ends exactly at tf.\n        dt_ideal = theta * dx**2 / Dm\n        Nt = int(np.ceil(tf / dt_ideal))\n        dt = tf / Nt\n        \n        # Crank-Nicolson parameter\n        alpha = Dm * dt / (2 * dx**2)\n\n        # Initial condition\n        B_num = B0 * np.sin(n * np.pi * x / L)\n\n        # Set up Crank-Nicolson matrices for the tridiagonal solver\n        # The system is solved for interior points only.\n        num_interior_points = Nx - 2\n        \n        # M_LHS matrix in banded format for scipy.linalg.solve_banded\n        # It has 1 upper and 1 lower diagonal.\n        M_LHS_banded = np.zeros((3, num_interior_points))\n        M_LHS_banded[0, 1:] = -alpha  # Upper diagonal\n        M_LHS_banded[1, :] = 1 + 2 * alpha  # Main diagonal\n        M_LHS_banded[2, :-1] = -alpha # Lower diagonal\n        \n        # M_RHS matrix (explicit construction for clarity)\n        diag_main_rhs = (1 - 2 * alpha) * np.ones(num_interior_points)\n        diag_off_rhs = alpha * np.ones(num_interior_points - 1)\n        M_RHS = np.diag(diag_main_rhs) + np.diag(diag_off_rhs, k=1) + np.diag(diag_off_rhs, k=-1)\n\n        # Time integration loop\n        for _ in range(Nt):\n            # Extract interior points from the current solution\n            B_interior = B_num[1:-1]\n            \n            # Calculate the right-hand side vector\n            rhs = M_RHS @ B_interior\n            \n            # Solve the tridiagonal system M_LHS * B_new = rhs\n            B_new_interior = solve_banded((1, 1), M_LHS_banded, rhs)\n            \n            # Update the solution vector (boundaries remain 0)\n            B_num[1:-1] = B_new_interior\n\n        # After the loop, B_num contains the solution at t=tf\n        \n        # Calculate the exact solution at t=tf\n        decay_rate = -Dm * (n * np.pi / L)**2\n        B_exact = B0 * np.sin(n * np.pi * x / L) * np.exp(decay_rate * tf)\n\n        # Compute the discrete L2 norm of the error\n        error_L2 = np.sqrt(np.sum((B_num - B_exact)**2) * dx)\n        errors.append(error_L2)\n\n    # Estimate the order of convergence p using the two finest grids\n    # h corresponds to Nx=257, h/2 corresponds to Nx=513\n    error_h = errors[-2]\n    error_h_half = errors[-1]\n    \n    p = np.log(error_h / error_h_half) / np.log(2)\n    \n    return p\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}