{
    "hands_on_practices": [
        {
            "introduction": "Before we can model or simulate resistive phenomena, we must first understand the physical origin of resistivity itself. This exercise grounds the abstract parameter $\\eta$ in the fundamental physics of Coulomb collisions. By deriving the Spitzer resistivity from first principles and calculating its value for realistic tokamak core and edge conditions, you will gain a concrete appreciation for why resistivity is negligible in the hot core but critically important in the cooler plasma edge .",
            "id": "4039149",
            "problem": "In Resistive Magnetohydrodynamics (MHD), the collisional electrical resistivity that enters the generalized Ohm’s law arises from electron momentum loss to ions via Coulomb collisions. Starting from a first-principles base, do the following:\n\n- Begin with the electron momentum balance, relate the frictional force density to a collision frequency, and define the resistivity as the proportionality between the electric field and the current density in the collisional limit of the generalized Ohm’s law.\n- Using the small-angle Coulomb collision theory in the weakly coupled, fully ionized plasma limit, derive the electron-ion collision frequency and show how it sets the resistivity’s temperature scaling. Explicitly connect the scaling to the ion charge state and the Coulomb logarithm.\n- Carefully carry the derivation in the International System of Units (SI), expressing the final resistivity as a closed-form analytic expression in terms of the electron charge $e$, electron mass $m_e$, vacuum permittivity $\\varepsilon_0$, Boltzmann constant $k_B$, the electron temperature $T_e$ (in $\\mathrm{eV}$), the effective charge number $Z$, and the Coulomb logarithm $\\ln\\Lambda$.\n\nThen, evaluate the magnitude of the resistivity for two scientifically realistic tokamak conditions:\n\n- Core: $T_e = 12\\,\\mathrm{keV}$, $Z = 1.7$, $\\ln\\Lambda = 17.5$.\n- Edge: $T_e = 150\\,\\mathrm{eV}$, $Z = 3.5$, $\\ln\\Lambda = 15.0$.\n\nAssume quasi-neutrality and full ionization. Use the following physical constants in SI units: $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$, $m_e = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$, $\\varepsilon_0 = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$, $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$. Express the final numerical resistivities in $\\Omega\\cdot\\mathrm{m}$. Round each numerical value to four significant figures. Return the final answer as the two numbers for core and edge, respectively, arranged as a single row matrix.",
            "solution": "The problem statement is a valid scientific exercise in plasma physics. It requests the derivation of the collisional electrical resistivity from first principles and its evaluation for realistic fusion plasma parameters.\n\n### Step 1: Extract Givens\n- **Task**: Derive the expression for electrical resistivity $\\eta$ in resistive MHD.\n- **Starting Point**: Electron momentum balance.\n- **Methodology**: Relate frictional force to collision frequency, define $\\eta$ via Ohm's law, use small-angle Coulomb collision theory for a weakly coupled, fully ionized plasma.\n- **Units**: International System of Units (SI).\n- **Final Expression Variables**: Electron charge $e$, electron mass $m_e$, vacuum permittivity $\\varepsilon_0$, Boltzmann constant $k_B$, electron temperature in eV $T_e$, effective charge number $Z$, and Coulomb logarithm $\\ln\\Lambda$.\n- **Assumptions**: Quasi-neutrality ($n_e = Z n_i$), full ionization.\n- **Condition 1 (Core)**: $T_e = 12\\,\\mathrm{keV}$, $Z = 1.7$, $\\ln\\Lambda = 17.5$.\n- **Condition 2 (Edge)**: $T_e = 150\\,\\mathrm{eV}$, $Z = 3.5$, $\\ln\\Lambda = 15.0$.\n- **Physical Constants (SI units)**:\n  - $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$\n  - $m_e = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$\n  - $\\varepsilon_0 = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$\n  - $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$\n- **Output Requirement**: Numerical values for $\\eta_{core}$ and $\\eta_{edge}$ in $\\Omega\\cdot\\mathrm{m}$, rounded to four significant figures, presented as a row matrix.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n- **Scientific Grounding**: The derivation of Spitzer resistivity is a canonical topic in plasma physics, based on classical electromagnetism and statistical mechanics. The problem is firmly rooted in established principles.\n- **Well-Posedness**: The request is for a standard derivation followed by a direct calculation. All necessary constants and parameters are provided. The assumptions are clearly stated. A unique solution exists.\n- **Objectivity**: The language is precise and unbiased. The parameters for the tokamak core and edge are scientifically realistic.\n- **Completeness**: The problem provides all necessary information for the derivation and calculations.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of Electrical Resistivity\n\nThe electrical resistivity $\\eta$ in a plasma quantifies the opposition to the flow of electric current. It arises primarily from the momentum lost by charge-carrying electrons in collisions with ions.\n\n**1. Resistivity from Electron Momentum Balance (Generalized Ohm's Law)**\n\nThe motion of the electron fluid is described by the electron momentum balance equation:\n$$ m_e n_e \\left( \\frac{\\partial \\mathbf{v}_e}{\\partial t} + \\mathbf{v}_e \\cdot \\nabla \\mathbf{v}_e \\right) = -n_e e (\\mathbf{E} + \\mathbf{v}_e \\times \\mathbf{B}) - \\nabla p_e + \\mathbf{R}_{ei} $$\nwhere $m_e$ is the electron mass, $n_e$ is the electron number density, $\\mathbf{v}_e$ is the electron fluid velocity, $e$ is the elementary charge, $\\mathbf{E}$ is the electric field, $\\mathbf{B}$ is the magnetic field, $p_e$ is the electron pressure, and $\\mathbf{R}_{ei}$ is the frictional force density on the electrons due to collisions with ions.\n\nIn the collisional limit for a steady state ($\\frac{\\partial}{\\partial t} = 0$) and uniform plasma ($\\nabla = 0$), neglecting the Lorentz force and pressure gradient terms (which is exact for the component parallel to $\\mathbf{B}$ or in an unmagnetized plasma), the equation simplifies to a balance between the electric force and the collisional friction:\n$$ 0 = -n_e e \\mathbf{E} + \\mathbf{R}_{ei} $$\nThe frictional force density $\\mathbf{R}_{ei}$ is proportional to the mean momentum lost per electron per unit time. This is modeled as:\n$$ \\mathbf{R}_{ei} = n_e m_e \\nu_{ei} (\\mathbf{v}_i - \\mathbf{v}_e) $$\nwhere $\\nu_{ei}$ is the momentum-transfer electron-ion collision frequency and $\\mathbf{v}_i$ is the ion fluid velocity.\n\nThe electric current density $\\mathbf{j}$ is defined as $\\mathbf{j} = q_i n_i \\mathbf{v}_i + q_e n_e \\mathbf{v}_e = Z e n_i \\mathbf{v}_i - e n_e \\mathbf{v}_e$. Using the quasi-neutrality condition $n_e = Z n_i$ and assuming stationary ions ($\\mathbf{v}_i \\approx 0$) as is typical for electron-driven currents, we have $\\mathbf{j} \\approx -n_e e \\mathbf{v}_e$. Also, $(\\mathbf{v}_i - \\mathbf{v}_e) \\approx -\\mathbf{v}_e = \\frac{\\mathbf{j}}{n_e e}$.\n\nSubstituting these relations into the force balance equation:\n$$ n_e e \\mathbf{E} = \\mathbf{R}_{ei} = n_e m_e \\nu_{ei} \\left( \\frac{\\mathbf{j}}{n_e e} \\right) = \\frac{m_e \\nu_{ei}}{e} \\mathbf{j} $$\nRearranging for $\\mathbf{E}$ yields the simple Ohm's law:\n$$ \\mathbf{E} = \\left( \\frac{m_e \\nu_{ei}}{n_e e^2} \\right) \\mathbf{j} $$\nBy definition, the resistivity $\\eta$ is the proportionality constant in $\\mathbf{E} = \\eta \\mathbf{j}$. Thus, we have:\n$$ \\eta = \\frac{m_e \\nu_{ei}}{n_e e^2} $$\nThis expression connects the macroscopic resistivity to the microscopic collision frequency $\\nu_{ei}$.\n\n**2. Electron-Ion Collision Frequency**\n\nThe electron-ion momentum transfer collision frequency, $\\nu_{ei}$, is derived from considering the cumulative effect of many small-angle Coulomb scatterings. A detailed kinetic theory calculation (averaging over Maxwellian distributions for both electrons and ions) gives the standard Braginskii/Spitzer result:\n$$ \\nu_{ei} = \\frac{4 \\sqrt{2\\pi}}{3} \\frac{n_i Z^2 e^4 \\ln\\Lambda}{(4\\pi\\varepsilon_0)^2 \\sqrt{m_e} (k_B T_e)^{3/2}} $$\nwhere $k_B$ is the Boltzmann constant, $T_e$ is the electron temperature in Kelvin, and $\\ln\\Lambda$ is the Coulomb logarithm, which accounts for the range of impact parameters in the screened Coulomb potential. Using the quasi-neutrality condition $n_e = Z n_i$, we can write $n_i = n_e/Z$:\n$$ \\nu_{ei} = \\frac{4 \\sqrt{2\\pi}}{3} \\frac{(n_e/Z) Z^2 e^4 \\ln\\Lambda}{(4\\pi\\varepsilon_0)^2 \\sqrt{m_e} (k_B T_e)^{3/2}} = \\frac{4 \\sqrt{2\\pi} n_e Z e^4 \\ln\\Lambda}{3 (4\\pi\\varepsilon_0)^2 \\sqrt{m_e} (k_B T_e)^{3/2}} $$\n\n**3. Final Expression for Resistivity**\n\nSubstituting the expression for $\\nu_{ei}$ into the formula for $\\eta$:\n$$ \\eta = \\frac{m_e}{n_e e^2} \\left[ \\frac{4 \\sqrt{2\\pi} n_e Z e^4 \\ln\\Lambda}{3 (4\\pi\\varepsilon_0)^2 \\sqrt{m_e} (k_B T_e)^{3/2}} \\right] $$\nThe electron density $n_e$ cancels out, demonstrating that resistivity is an intrinsic property of the plasma, independent of density.\n$$ \\eta = \\frac{4 \\sqrt{2\\pi}}{3} \\frac{\\sqrt{m_e} Z e^2 \\ln\\Lambda}{(4\\pi\\varepsilon_0)^2 (k_B T_e)^{3/2}} $$\nThis is the celebrated Spitzer resistivity (in the Lorentz gas approximation, which is accurate for large $Z$). It clearly shows the dependencies: $\\eta \\propto Z \\ln\\Lambda T_e^{-3/2}$.\n\nTo express this in terms of $T_e$ in electron-volts ($T_{e,eV}$), we use the relation $k_B T_e(\\mathrm{K}) = e T_{e,eV}$.\n$$ \\eta = \\frac{4 \\sqrt{2\\pi}}{3} \\frac{\\sqrt{m_e} Z e^2 \\ln\\Lambda}{(4\\pi\\varepsilon_0)^2 (e T_{e,eV})^{3/2}} = \\frac{4 \\sqrt{2\\pi}}{3 \\cdot 16\\pi^2} \\frac{\\sqrt{m_e} Z e^2 \\ln\\Lambda}{\\varepsilon_0^2 e^{3/2} T_{e,eV}^{3/2}} $$\nSimplifying the constants gives the requested closed-form analytic expression:\n$$ \\eta = \\frac{\\sqrt{2}}{12 \\pi^{3/2}} \\frac{\\sqrt{m_e} e^{1/2} Z \\ln\\Lambda}{\\varepsilon_0^2 T_{e,eV}^{3/2}} $$\n\n### Numerical Evaluation\n\nWe first evaluate the constant prefactor $C_0$:\n$$ C_0 = \\frac{\\sqrt{2m_e} e^{1/2}}{12 \\pi^{3/2} \\varepsilon_0^2} $$\nUsing the provided physical constants:\n$C_0 = \\frac{\\sqrt{2 \\cdot (9.1093837015\\times 10^{-31})} \\sqrt{1.602176634\\times 10^{-19}}}{12 \\pi^{3/2} (8.8541878128\\times 10^{-12})^2}$\n$C_0 \\approx \\frac{\\sqrt{1.82187674\\times 10^{-30}} \\cdot (4.0027199 \\times 10^{-10})}{12 \\cdot (5.568328) \\cdot (7.8396676 \\times 10^{-23})}$\n$C_0 \\approx \\frac{(1.34976915 \\times 10^{-15}) \\cdot (4.0027199 \\times 10^{-10})}{5.2410313 \\times 10^{-21}}$\n$C_0 \\approx 1.03091 \\times 10^{-4} \\, \\frac{\\Omega\\cdot\\mathrm{m}\\cdot(\\mathrm{eV})^{3/2}}{\\mathrm{unitless}}$\nThus, our working formula is:\n$$ \\eta \\approx (1.03091 \\times 10^{-4}) \\frac{Z \\ln\\Lambda}{T_{e,eV}^{3/2}} \\, \\Omega\\cdot\\mathrm{m} $$\n\n**Tokamak Core Condition:**\n- $T_e = 12\\,\\mathrm{keV} = 1.2 \\times 10^4\\,\\mathrm{eV}$\n- $Z = 1.7$\n- $\\ln\\Lambda = 17.5$\n\n$$ \\eta_{core} = (1.03091 \\times 10^{-4}) \\frac{1.7 \\times 17.5}{(1.2 \\times 10^4)^{3/2}} $$\n$$ \\eta_{core} = (1.03091 \\times 10^{-4}) \\frac{29.75}{1314534.5} \\approx 2.33314 \\times 10^{-9} \\, \\Omega\\cdot\\mathrm{m} $$\nRounding to four significant figures, $\\eta_{core} = 2.333 \\times 10^{-9} \\, \\Omega\\cdot\\mathrm{m}$.\n\n**Tokamak Edge Condition:**\n- $T_e = 150\\,\\mathrm{eV}$\n- $Z = 3.5$\n- $\\ln\\Lambda = 15.0$\n\n$$ \\eta_{edge} = (1.03091 \\times 10^{-4}) \\frac{3.5 \\times 15.0}{150^{3/2}} $$\n$$ \\eta_{edge} = (1.03091 \\times 10^{-4}) \\frac{52.5}{1837.117} \\approx 2.94605 \\times 10^{-6} \\, \\Omega\\cdot\\mathrm{m} $$\nRounding to four significant figures, $\\eta_{edge} = 2.946 \\times 10^{-6} \\, \\Omega\\cdot\\mathrm{m}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.333 \\times 10^{-9}  2.946 \\times 10^{-6} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The cornerstone of resistive MHD is the induction equation, which, in the absence of flow, reduces to a diffusion equation for the magnetic field. This hands-on practice bridges analytical theory with computational practice by tasking you to derive the numerical stability limit for this equation and then verify it through a simple simulation . Mastering this relationship between the physical diffusivity, grid spacing $\\Delta x$, and timestep $\\Delta t$ is a fundamental skill for developing and using explicit MHD codes.",
            "id": "4039209",
            "problem": "Consider the induction equation from Resistive Magnetohydrodynamics (MHD), specialized to a uniform, electrically conducting medium with constant magnetic diffusivity $\\eta_m$ (defined as the electrical resistivity divided by the magnetic permeability, with units $\\mathrm{m^2/s}$). Starting from Maxwell–Faraday law and the generalized Ohm’s law, and assuming zero fluid velocity, show that the induction equation reduces to a diffusion equation for a single magnetic field component. Then, using a spatially second-order central difference approximation and a forward Euler explicit time integrator on a one-dimensional uniform grid with periodic boundary conditions, perform a von Neumann stability analysis and derive the stability bound for the timestep. Specifically, identify the constant $C$ in the standard diffusive timestep restriction of the form where the timestep scales like $\\Delta t \\sim \\Delta x^2/\\eta_m$ for stability.\n\nAfter completing the derivation, implement a program that integrates the resistive induction equation in one spatial dimension under the following constraints and specifications:\n\n- Fundamental base for derivation:\n  - Maxwell–Faraday law: $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$.\n  - Generalized Ohm’s law (isotropic scalar resistivity): $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{J}$, with $\\mathbf{J} = \\nabla \\times \\mathbf{B} / \\mu_0$ and magnetic diffusivity $\\eta_m = \\eta / \\mu_0$.\n  - Divergence-free magnetic field: $\\nabla \\cdot \\mathbf{B} = 0$.\n- Numerical model:\n  - Reduce to one spatial dimension $x$ and a single magnetic field component $B(x,t)$ by taking zero velocity $\\mathbf{v}=\\mathbf{0}$ and constant magnetic diffusivity $\\eta_m$.\n  - The resulting partial differential equation is of diffusion type: $\\partial_t B = \\eta_m \\, \\partial_{xx} B$.\n  - Discretize space on a periodic domain of length $L$ using $N$ uniformly spaced points with spacing $\\Delta x = L/N$.\n  - Use a forward Euler explicit time integrator with a second-order central difference approximation for the Laplacian: $$B_i^{n+1} = B_i^n + \\eta_m \\, \\Delta t \\, \\frac{B_{i-1}^n - 2 B_i^n + B_{i+1}^n}{\\Delta x^2},$$ with periodic indexing for $B_{-1}^n$ and $B_{N}^n$.\n- Initial condition:\n  - Choose the highest-resolvable Fourier mode on the grid to probe the worst-case stability behavior: $B_i^0 = B_0 (-1)^i$ with $B_0 = 1$ in units of Tesla ($\\mathrm{T}$).\n- Units:\n  - Take $L$ in meters ($\\mathrm{m}$), $\\eta_m$ in $\\mathrm{m^2/s}$, $\\Delta t$ in seconds ($\\mathrm{s}$), and $B$ in Tesla ($\\mathrm{T}$).\n- Stability decision rule for the program:\n  - For each test case, integrate for the specified number of steps and compute the maximum absolute value of $B$ over the grid at the final time, $M_{\\text{final}}$.\n  - Define the case as “stable” (boolean true) if $M_{\\text{final}} \\le 10 \\, M_{\\text{initial}}$, where $M_{\\text{initial}}$ is the maximum absolute value at $t=0$. Otherwise, define it as “unstable” (boolean false).\n\nTest suite specification:\n- For each tuple in the test suite, the parameters are $(L, N, \\eta_m, r, n_{\\text{steps}})$, with $L$ in meters, $N$ an integer number of grid points, $\\eta_m$ in $\\mathrm{m^2/s}$, $r$ a dimensionless ratio used to set the timestep $\\Delta t = r \\, \\Delta x^2 / \\eta_m$, and $n_{\\text{steps}}$ the number of forward Euler steps to take.\n- Use the following test suite that covers a general case, the boundary of stability, and clearly unstable regimes, across different grid resolutions and diffusivities:\n  1. $(L, N, \\eta_m, r, n_{\\text{steps}}) = (1.0, 128, 1.0, 0.45, 500)$\n  2. $(L, N, \\eta_m, r, n_{\\text{steps}}) = (1.0, 128, 1.0, 0.50, 500)$\n  3. $(L, N, \\eta_m, r, n_{\\text{steps}}) = (1.0, 128, 1.0, 0.60, 60)$\n  4. $(L, N, \\eta_m, r, n_{\\text{steps}}) = (1.0, 16, 0.5, 0.55, 120)$\n  5. $(L, N, \\eta_m, r, n_{\\text{steps}}) = (1.0, 64, 2.0, 0.49, 400)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (e.g., “[True,False,True,False,True]”), corresponding to the five test cases in the order listed above.",
            "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of Magnetohydrodynamics (MHD) and numerical analysis, is well-posed with a clear objective, and contains all necessary information for a complete solution. The derivation path is logically sound, and the numerical task is precisely specified.\n\n### Part 1: Derivation of the Governing Equation\n\nThe derivation begins from the provided fundamental laws of resistive MHD in the absence of fluid flow.\n\n1.  **Given Equations**:\n    -   Maxwell-Faraday Law: $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$\n    -   Generalized Ohm's Law: $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{J}$\n    -   Current Density (from Ampere's Law): $\\mathbf{J} = \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B}$\n    -   Solenoidal condition: $\\nabla \\cdot \\mathbf{B} = 0$\n\n2.  **Simplification with Given Conditions**:\n    -   The problem states to assume zero fluid velocity, $\\mathbf{v} = \\mathbf{0}$. Ohm's law reduces to $\\mathbf{E} = \\eta \\mathbf{J}$.\n    -   Substituting the expression for current density $\\mathbf{J}$ into the simplified Ohm's law yields an expression for the electric field $\\mathbf{E}$ in terms of the magnetic field $\\mathbf{B}$:\n        $$ \\mathbf{E} = \\eta \\left( \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B} \\right) = \\frac{\\eta}{\\mu_0} (\\nabla \\times \\mathbf{B}) $$\n    -   The magnetic diffusivity $\\eta_m$ is defined as $\\eta_m = \\eta / \\mu_0$. Substituting this, we obtain:\n        $$ \\mathbf{E} = \\eta_m (\\nabla \\times \\mathbf{B}) $$\n\n3.  **Derivation of the Induction Equation**:\n    -   We substitute this expression for $\\mathbf{E}$ into the Maxwell-Faraday law:\n        $$ \\partial_t \\mathbf{B} = -\\nabla \\times \\left( \\eta_m (\\nabla \\times \\mathbf{B}) \\right) $$\n    -   Given that the magnetic diffusivity $\\eta_m$ is a constant scalar, it can be factored out of the curl operator:\n        $$ \\partial_t \\mathbf{B} = -\\eta_m \\nabla \\times (\\nabla \\times \\mathbf{B}) $$\n    -   We employ the vector calculus identity $\\nabla \\times (\\nabla \\times \\mathbf{A}) = \\nabla(\\nabla \\cdot \\mathbf{A}) - \\nabla^2 \\mathbf{A}$, where $\\nabla^2$ is the vector Laplacian. Applying this to our equation gives:\n        $$ \\partial_t \\mathbf{B} = -\\eta_m \\left( \\nabla(\\nabla \\cdot \\mathbf{B}) - \\nabla^2 \\mathbf{B} \\right) $$\n    -   Using the divergence-free condition $\\nabla \\cdot \\mathbf{B} = 0$, the first term on the right-hand side vanishes:\n        $$ \\partial_t \\mathbf{B} = -\\eta_m (0 - \\nabla^2 \\mathbf{B}) = \\eta_m \\nabla^2 \\mathbf{B} $$\n    -   This is the magnetic induction equation, which takes the form of a vector diffusion equation. For a one-dimensional system varying only in the $x$-direction, considering a single component $B(x,t)$, this equation simplifies to the scalar diffusion equation:\n        $$ \\frac{\\partial B}{\\partial t} = \\eta_m \\frac{\\partial^2 B}{\\partial x^2} $$\nThis completes the derivation of the governing PDE.\n\n### Part 2: Von Neumann Stability Analysis\n\nWe analyze the stability of the specified numerical scheme for the 1D diffusion equation.\n\n1.  **Numerical Scheme**: The problem specifies a Forward-Time Central-Space (FTCS) discretization:\n    $$ B_i^{n+1} = B_i^n + \\eta_m \\frac{\\Delta t}{\\Delta x^2} \\left( B_{i-1}^n - 2 B_i^n + B_{i+1}^n \\right) $$\n    where $B_i^n \\approx B(i\\Delta x, n\\Delta t)$.\n\n2.  **Fourier Mode Analysis**: We use the standard von Neumann analysis by substituting a single Fourier mode ansatz, $B_i^n = G^n e^{\\mathrm{i} k x_i} = G^n e^{\\mathrm{i} k i \\Delta x}$, into the difference equation. Here, $G$ is the amplification factor for wavenumber $k$, and $\\mathrm{i}$ is the imaginary unit.\n    $$ G^{n+1} e^{\\mathrm{i} k i \\Delta x} = G^n e^{\\mathrm{i} k i \\Delta x} + \\frac{\\eta_m \\Delta t}{\\Delta x^2} \\left( G^n e^{\\mathrm{i} k (i-1) \\Delta x} - 2 G^n e^{\\mathrm{i} k i \\Delta x} + G^n e^{\\mathrm{i} k (i+1) \\Delta x} \\right) $$\n\n3.  **Derivation of the Amplification Factor**: Dividing by $G^n e^{\\mathrm{i} k i \\Delta x}$ yields the expression for $G$:\n    $$ G = 1 + \\frac{\\eta_m \\Delta t}{\\Delta x^2} \\left( e^{-\\mathrm{i} k \\Delta x} - 2 + e^{\\mathrm{i} k \\Delta x} \\right) $$\n    Using the identity $e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta} = 2 \\cos(\\theta)$, this simplifies to:\n    $$ G = 1 + \\frac{2\\eta_m \\Delta t}{\\Delta x^2} \\left( \\cos(k \\Delta x) - 1 \\right) $$\n    With the half-angle identity $1 - \\cos(\\theta) = 2 \\sin^2(\\theta/2)$, we get:\n    $$ G = 1 - \\frac{4\\eta_m \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) $$\n\n4.  **Stability Condition**: For the scheme to be stable, the magnitude of the amplification factor must be less than or equal to one, $|G| \\le 1$. Since $G$ is real, this is equivalent to $-1 \\le G \\le 1$.\n    -   The term $4 \\frac{\\eta_m \\Delta t}{\\Delta x^2} \\sin^2(\\frac{k \\Delta x}{2})$ is always non-negative, so $G \\le 1$ is always satisfied.\n    -   The non-trivial constraint arises from the lower bound, $G \\ge -1$:\n        $$ -1 \\le 1 - \\frac{4\\eta_m \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) $$\n        $$ \\frac{4\\eta_m \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 2 $$\n        $$ \\frac{\\eta_m \\Delta t}{\\Delta x^2} \\le \\frac{1}{2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)} $$\n    This condition must hold for all wavenumbers $k$. The most restrictive case (the \"worst case\") occurs when $\\sin^2\\left(\\frac{k \\Delta x}{2}\\right)$ is maximum, which is $1$. This corresponds to the highest resolvable frequency on the grid, the Nyquist mode, where $k \\Delta x = \\pi$.\n    -   Substituting this maximum value yields the Courant-Friedrichs-Lewy (CFL) stability condition for this scheme:\n        $$ \\frac{\\eta_m \\Delta t}{\\Delta x^2} \\le \\frac{1}{2} $$\n    The problem formulates the timestep as $\\Delta t = r \\frac{\\Delta x^2}{\\eta_m}$, where $r$ is a dimensionless ratio. Substituting this into our condition gives $r \\le 1/2$. The problem asks for the constant $C$ in the scaling, which our analysis identifies as $C=1/2$. Therefore, the scheme is stable for $r \\le 0.5$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Integrates the 1D resistive induction equation and determines the numerical\n    stability for a set of test cases.\n    \"\"\"\n    # Test suite specification:\n    # Each tuple contains (L, N, eta_m, r, n_steps)\n    # L: domain length (m)\n    # N: number of grid points\n    # eta_m: magnetic diffusivity (m^2/s)\n    # r: dimensionless ratio for timestep, r = eta_m * dt / dx^2\n    # n_steps: number of integration steps\n    test_cases = [\n        (1.0, 128, 1.0, 0.45, 500), # Stable (r  0.5)\n        (1.0, 128, 1.0, 0.50, 500), # Marginally stable (r = 0.5)\n        (1.0, 128, 1.0, 0.60, 60),  # Unstable (r > 0.5)\n        (1.0, 16, 0.5, 0.55, 120),  # Unstable (r > 0.5)\n        (1.0, 64, 2.0, 0.49, 400),  # Stable (r  0.5)\n    ]\n\n    results = []\n    for case in test_cases:\n        L, N, eta_m, r, n_steps = case\n        \n        # Spatial grid spacing\n        dx = L / N\n        \n        # The problem defines the timestep via r = eta_m * dt / dx^2.\n        # This dimensionless number, r, is what governs stability.\n        \n        # Initial condition: B(x,0) = B_0 * (-1)^i, with B_0 = 1.\n        # This corresponds to the highest-resolvable (Nyquist) Fourier mode on the\n        # grid, which is the most unstable mode for this scheme.\n        B = np.array([(-1.0)**i for i in range(N)], dtype=np.float64)\n        \n        # The initial maximum absolute value of B is M_initial = 1.0.\n        # The stability decision rule is M_final = 10 * M_initial.\n        # The threshold is therefore 10.0.\n        stability_threshold = 10.0\n\n        # Main time-integration loop using a Forward-Time Central-Space (FTCS) scheme.\n        for _ in range(n_steps):\n            # The update rule is B_i^{n+1} = B_i^n + r * (B_{i-1}^n - 2*B_i^n + B_{i+1}^n).\n            # We use np.roll for an efficient implementation of the finite difference\n            # operator with periodic boundary conditions.\n            # np.roll(B, 1) provides the B_{i-1} term for all i.\n            # np.roll(B, -1) provides the B_{i+1} term for all i.\n            laplacian_B = np.roll(B, 1) + np.roll(B, -1) - 2 * B\n            B += r * laplacian_B\n            \n            # This check prevents numerical overflow for very unstable cases.\n            # It will not alter the final stability decision, as the value will\n            # have already far exceeded the stability_threshold.\n            if np.max(np.abs(B)) > 1e12:\n                break\n\n        # After integration, determine stability based on the specified rule.\n        M_final = np.max(np.abs(B))\n        is_stable = M_final = stability_threshold\n        results.append(is_stable)\n\n    # Format and print the final output as a single line.\n    # The output should be a comma-separated list of booleans, e.g., \"[True,True,False,False,True]\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond diffusion, magnetohydrodynamics is fundamentally about the transport, or advection, of conserved quantities by a fluid flow. This exercise focuses on the numerical implementation of the continuity equation, which governs mass conservation, using a foundational finite-volume method . By implementing an upwind scheme, you will demonstrate exact mass conservation in a discrete system and directly quantify the scheme's inherent numerical diffusion, a critical numerical artifact that every computational scientist must understand and manage.",
            "id": "4039194",
            "problem": "Consider the continuity equation from resistive Magnetohydrodynamics (MHD), which states local conservation of mass for a conducting plasma. The fundamental law is that the rate of change of mass within any fixed control volume equals the net mass flux through its boundary. In one spatial dimension, the conserved quantity is the mass density $ \\rho $, and the advecting velocity field is $ u(x,t) $. Starting from this conservation law, derive a consistent finite-volume update for $ \\rho $ on a uniform grid with periodic boundaries in one spatial dimension. Implement this update in a program that uses a first-order upwind choice for the mass flux at cell faces, and demonstrate that the scheme exactly conserves total mass for periodic boundaries, while quantifying the numerical diffusion introduced by upwinding.\n\nYour implementation must adhere to the following setup and tasks:\n\n- Domain and grid: Use a one-dimensional periodic domain of length $ L $ in $ \\mathrm{m} $, discretized into $ N $ uniform cells of width $ \\Delta x = L/N $. Take cell centers at positions $ x_i = (i+\\tfrac{1}{2}) \\Delta x $ for integer $ i $ from $ 0 $ to $ N-1 $.\n- Initial condition: For each test case, initialize the density field as $ \\rho(x) = \\rho_0 + A \\sin\\left( \\dfrac{2\\pi x}{L} \\right) $, where $ \\rho_0 $ and $ A $ are constants in $ \\mathrm{kg/m^3} $. This is a single-mode perturbation with wavenumber magnitude $ \\kappa = \\dfrac{2\\pi}{L} $ in $ \\mathrm{rad/m} $. The velocity $ u $ is constant across the domain and time for each test case.\n- Time step: For test cases that specify the Courant–Friedrichs–Lewy (CFL) number $ \\lambda $, compute $ \\Delta t $ as $ \\Delta t = \\lambda \\, \\Delta x / |u| $ in $ \\mathrm{s} $. For test cases that directly specify $ \\Delta t $, use that value and compute $ \\lambda = |u| \\Delta t / \\Delta x $.\n- Finite-volume update: Use a single forward-Euler update that applies the upwind mass flux at cell faces. The upwind mass flux at a face indexed by $ i+\\tfrac{1}{2} $ must use the upstream density consistent with the sign of $ u $ and periodic indexing. Do not assume any special treatment other than strict periodicity at the boundaries.\n- Mass conservation check: Compute the total mass $ M = \\sum_{i=0}^{N-1} \\rho_i \\Delta x $ before and after the update. The scheme must conserve mass exactly for periodic boundaries in the discrete sense, modulo round-off. Report a boolean indicating whether $ |M_{\\text{after}} - M_{\\text{before}}| $ is smaller than $ 10^{-12} \\times \\max(1, M_{\\text{before}}) $.\n- Numerical diffusion quantification: Let $ A_{\\text{old}} $ and $ A_{\\text{new}} $ be the amplitudes of the fundamental mode with wavenumber $ \\kappa $ before and after one time step, obtained by projecting the zero-mean density field onto the sine and cosine basis and taking the resultant amplitude. Estimate the effective numerical diffusion coefficient $ D_{\\text{meas}} $ in $ \\mathrm{m^2/s} $ due to upwinding by assuming that the amplitude decays as $ \\exp(-D \\kappa^2 \\Delta t) $; that is, compute\n$$\nD_{\\text{meas}} = -\\dfrac{1}{\\Delta t} \\dfrac{\\ln\\left( \\dfrac{A_{\\text{new}}}{A_{\\text{old}}} \\right)}{\\kappa^2}.\n$$\nAlso compute the theoretical leading-order numerical diffusion $ D_{\\text{theory}} $ in $ \\mathrm{m^2/s} $ associated with first-order upwind for linear advection using a forward-Euler update, which depends on $ \\Delta x $, $ u $, and $ \\lambda $. Finally, compute the absolute error $ |D_{\\text{meas}} - D_{\\text{theory}}| $ in $ \\mathrm{m^2/s} $.\n\nUnits requirement:\n- All lengths must be treated in $ \\mathrm{m} $.\n- All times must be treated in $ \\mathrm{s} $.\n- All densities must be treated in $ \\mathrm{kg/m^3} $.\n- All diffusion coefficients must be reported in $ \\mathrm{m^2/s} $.\n\nTest suite:\nFor each of the following parameter sets, run exactly one update step and produce the corresponding results:\n1. $ N = 128 $, $ L = 1.0 $ $ \\mathrm{m} $, $ u = 100.0 $ $ \\mathrm{m/s} $, $ \\lambda = 0.4 $, $ \\rho_0 = 1.0 $ $ \\mathrm{kg/m^3} $, $ A = 0.1 $ $ \\mathrm{kg/m^3} $.\n2. $ N = 128 $, $ L = 1.0 $ $ \\mathrm{m} $, $ u = -250.0 $ $ \\mathrm{m/s} $, $ \\lambda = 0.7 $, $ \\rho_0 = 1.0 $ $ \\mathrm{kg/m^3} $, $ A = 0.05 $ $ \\mathrm{kg/m^3} $.\n3. $ N = 64 $, $ L = 1.0 $ $ \\mathrm{m} $, $ u = 0.0 $ $ \\mathrm{m/s} $, $ \\Delta t = 1.0 \\times 10^{-6} $ $ \\mathrm{s} $, $ \\rho_0 = 1.0 $ $ \\mathrm{kg/m^3} $, $ A = 0.2 $ $ \\mathrm{kg/m^3} $.\n4. $ N = 128 $, $ L = 1.0 $ $ \\mathrm{m} $, $ u = 100.0 $ $ \\mathrm{m/s} $, $ \\lambda = 1.0 $, $ \\rho_0 = 1.0 $ $ \\mathrm{kg/m^3} $, $ A = 0.1 $ $ \\mathrm{kg/m^3} $.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case contributes a sub-list formatted as $ [D_{\\text{meas}}, D_{\\text{theory}}, |D_{\\text{meas}} - D_{\\text{theory}}|, \\text{mass\\_conserved}] $, in that order. Booleans must be printed in the native programming language boolean format. For the four test cases, the final output must look like $ [[\\ldots],[\\ldots],[\\ldots],[\\ldots]] $ with no additional text.",
            "solution": "The supplied problem is scientifically sound, well-posed, and internally consistent. It outlines a standard numerical exercise in computational fluid dynamics: implementing and analyzing a first-order finite-volume scheme for the linear advection equation. All parameters and procedures are specified unambiguously, allowing for a unique and verifiable solution.\n\nThe derivation and implementation proceed as follows.\n\n**1. Governing Equation and Finite-Volume Discretization**\n\nThe problem starts with the principle of mass conservation, which is mathematically expressed by the continuity equation. In one spatial dimension $x$, for a mass density $\\rho(x, t)$ and velocity field $u(x, t)$, the equation is:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} (\\rho u) = 0\n$$\nThis is a partial differential equation (PDE) in conservation form, where $F = \\rho u$ is the mass flux.\n\nTo obtain a finite-volume discretization, we integrate this PDE over a control volume, or cell. On a uniform grid with cell width $\\Delta x$, cell $i$ spans the interval $[x_{i-1/2}, x_{i+1/2}]$. The integration yields:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial \\rho}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} \\,dx = 0\n$$\nDefining the cell-averaged density as $\\rho_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(x, t) \\,dx$ and applying the fundamental theorem of calculus to the flux term, we get:\n$$\n\\frac{d(\\rho_i \\Delta x)}{dt} + F(x_{i+1/2}) - F(x_{i-1/2}) = 0\n$$\nSince $\\Delta x$ is constant, this simplifies to the semi-discrete form:\n$$\n\\frac{d\\rho_i}{dt} = -\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x}\n$$\nwhere $F_{i \\pm 1/2}$ represents the mass flux evaluated at the cell faces.\n\n**2. Temporal and Spatial Discretization: Forward-Euler and Upwinding**\n\nThe problem specifies a forward-Euler method for the time derivative and a first-order upwind scheme for the spatial flux.\n\nApplying a forward-Euler step with time step $\\Delta t$, the update for the cell-averaged density $\\rho_i$ from time step $n$ to $n+1$ is:\n$$\n\\frac{\\rho_i^{n+1} - \\rho_i^n}{\\Delta t} = -\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x}\n$$\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nThe first-order upwind scheme determines the flux $F_{i+1/2}$ at the interface between cells $i$ and $i+1$ based on the direction of flow, given by the sign of the constant velocity $u$. The flux is $F = \\rho u$.\n- If $u  0$, information flows from left to right. The \"upwind\" density at face $i+1/2$ is the density in cell $i$, so $F_{i+1/2} = \\rho_i^n u$.\n- If $u  0$, information flows from right to left. The \"upwind\" density at face $i+1/2$ is the density in cell $i+1$, so $F_{i+1/2} = \\rho_{i+1}^n u$.\n- If $u = 0$, the flux is zero, and no update occurs.\n\nThis can be expressed compactly. Let the Courant-Friedrichs-Lewy (CFL) number be $\\lambda = |u|\\Delta t / \\Delta x$.\n- For $u  0$, the update becomes:\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x}(u \\rho_i^n - u \\rho_{i-1}^n) = \\rho_i^n - \\frac{u \\Delta t}{\\Delta x}(\\rho_i^n - \\rho_{i-1}^n) = \\rho_i^n - \\lambda(\\rho_i^n - \\rho_{i-1}^n)\n$$\n- For $u  0$, the update becomes:\n$$\n\\rho_i^{n+1} = \\rho_i^n - \\frac{\\Delta t}{\\Delta x}(u \\rho_{i+1}^n - u \\rho_i^n) = \\rho_i^n - \\frac{u \\Delta t}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n) = \\rho_i^n + \\lambda(\\rho_{i+1}^n - \\rho_i^n)\n$$\nIndices are handled with periodic boundary conditions, meaning that for cell $i=0$, the left neighbor is cell $N-1$, and for cell $i=N-1$, the right neighbor is cell $0$.\n\n**3. Mass Conservation**\n\nThe finite-volume method is \"conservative by construction.\" To verify this, we sum the update equation over all $N$ cells in the periodic domain:\n$$\n\\sum_{i=0}^{N-1} \\rho_i^{n+1} = \\sum_{i=0}^{N-1} \\rho_i^n - \\frac{\\Delta t}{\\Delta x} \\sum_{i=0}^{N-1} (F_{i+1/2} - F_{i-1/2})\n$$\nThe final term is a telescoping sum:\n$$\n\\sum_{i=0}^{N-1} (F_{i+1/2} - F_{i-1/2}) = (F_{1/2} - F_{-1/2}) + (F_{3/2} - F_{1/2}) + \\dots + (F_{N-1/2} - F_{N-3/2})\n$$\nWith periodic boundaries, the face at index $-1/2$ is identical to the face at $N-1/2$. A more formal re-indexing shows that the sum collapses to zero. For instance, $\\sum_{i=0}^{N-1} F_{i+1/2} = \\sum_{j=1}^{N} F_{j-1/2}$. With periodicity $F_{N-1/2} = F_{-1/2}$, the sum is zero.\nTherefore, $\\sum_{i=0}^{N-1} \\rho_i^{n+1} = \\sum_{i=0}^{N-1} \\rho_i^n$.\nMultiplying by the constant cell volume $\\Delta x$ shows that the total mass $M = \\sum \\rho_i \\Delta x$ is conserved exactly, apart from floating-point round-off error.\n\n**4. Numerical Diffusion Analysis**\n\nThe first-order upwind scheme is known to introduce numerical error that resembles a physical diffusion process. The leading term in the truncation error of this scheme is proportional to $\\partial^2 \\rho / \\partial x^2$. The modified equation that the scheme actually solves is approximately:\n$$\n\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} \\approx D_{\\text{theory}} \\frac{\\partial^2 \\rho}{\\partial x^2}\n$$\nThrough a Taylor series analysis of the discrete scheme, the theoretical leading-order numerical diffusion coefficient is found to be:\n$$\nD_{\\text{theory}} = \\frac{|u|\\Delta x}{2}(1 - \\lambda) = \\frac{|u|\\Delta x}{2}\\left(1 - \\frac{|u|\\Delta t}{\\Delta x}\\right)\n$$\nThis diffusion causes the amplitude of spatial modes to decay. For a sinusoidal mode with wavenumber $\\kappa$, the amplitude $A$ is expected to decay as $A(t) = A(0) \\exp(-D \\kappa^2 t)$. After one time step $\\Delta t$, we have $A_{\\text{new}} = A_{\\text{old}} \\exp(-D \\kappa^2 \\Delta t)$.\n\nTo measure this effect, we first project the numerical density field $\\rho_i$ onto the fundamental sinusoidal mode with wavenumber $\\kappa=2\\pi/L$. The sine and cosine components of the zero-mean density field $\\delta\\rho = \\rho - \\langle\\rho\\rangle$ are computed:\n$$\nC_s = \\frac{2}{N}\\sum_{i=0}^{N-1} \\delta\\rho_i \\sin(\\kappa x_i), \\quad C_c = \\frac{2}{N}\\sum_{i=0}^{N-1} \\delta\\rho_i \\cos(\\kappa x_i)\n$$\nThe mode amplitude is $A_{\\text{mode}} = \\sqrt{C_s^2 + C_c^2}$. By computing this amplitude before ($A_{\\text{old}}$) and after ($A_{\\text{new}}$) the time step, we can estimate the measured diffusion coefficient $D_{\\text{meas}}$ by inverting the decay law:\n$$\nD_{\\text{meas}} = -\\frac{\\ln(A_{\\text{new}}/A_{\\text{old}})}{\\kappa^2 \\Delta t}\n$$\nThe implementation will calculate $D_{\\text{theory}}$ and $D_{\\text{meas}}$ and report their absolute difference, demonstrating the validity of the theoretical model. Cases where $u=0$ or $\\lambda=1$ result in $D_{\\text{theory}}=0$, which should be matched by $D_{\\text{meas}}=0$ since the amplitude does not decay.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a first-order upwind finite-volume scheme for the 1D advection equation.\n    \"\"\"\n    test_cases = [\n        {'N': 128, 'L': 1.0, 'u': 100.0, 'rho0': 1.0, 'A': 0.1, 'lambda': 0.4},\n        {'N': 128, 'L': 1.0, 'u': -250.0, 'rho0': 1.0, 'A': 0.05, 'lambda': 0.7},\n        {'N': 64, 'L': 1.0, 'u': 0.0, 'rho0': 1.0, 'A': 0.2, 'dt': 1.0e-6},\n        {'N': 128, 'L': 1.0, 'u': 100.0, 'rho0': 1.0, 'A': 0.1, 'lambda': 1.0},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        N = params['N']\n        L = params['L']\n        u = params['u']\n        rho0 = params['rho0']\n        A = params['A']\n\n        # Grid and constants\n        dx = L / N\n        kappa = 2 * np.pi / L\n        x = (np.arange(N) + 0.5) * dx\n\n        # Time step and CFL number\n        if 'lambda' in params:\n            lam = params['lambda']\n            if u != 0:\n                dt = lam * dx / np.abs(u)\n            else: # If lambda is given for u=0, dt is ill-defined, but simulation is trivial.\n                dt = 0.0 # Any value would do as no update happens.\n        elif 'dt' in params:\n            dt = params['dt']\n            if u != 0:\n                lam = np.abs(u) * dt / dx\n            else:\n                lam = 0.0\n\n        # Initial condition\n        rho_n = rho0 + A * np.sin(kappa * x)\n\n        # 1. Mass Conservation Check\n        M_before = np.sum(rho_n) * dx\n\n        # 2. Numerical Diffusion - Amplitude Before\n        def get_amplitude(rho, k, grid_x, num_cells):\n            rho_mean = np.mean(rho)\n            d_rho = rho - rho_mean\n            \n            # Discrete Fourier projection for mode k\n            sin_proj = np.sin(k * grid_x)\n            cos_proj = np.cos(k * grid_x)\n            \n            # Normalization factor for discrete transform\n            norm = 2.0 / num_cells\n            \n            C_s = norm * np.sum(d_rho * sin_proj)\n            C_c = norm * np.sum(d_rho * cos_proj)\n            \n            return np.sqrt(C_s**2 + C_c**2)\n\n        A_old = get_amplitude(rho_n, kappa, x, N)\n\n        # 3. Finite-Volume Update\n        if u > 0:\n            # Upstream is from the left (index i-1)\n            rho_np1 = rho_n - lam * (rho_n - np.roll(rho_n, 1))\n        elif u  0:\n            # Upstream is from the right (index i+1)\n            rho_np1 = rho_n + lam * (np.roll(rho_n, -1) - rho_n)\n        else: # u == 0\n            rho_np1 = rho_n.copy()\n\n        # 4. Mass Conservation After Update\n        M_after = np.sum(rho_np1) * dx\n        mass_conserved = np.abs(M_after - M_before)  1e-12 * max(1.0, M_before)\n\n        # 5. Numerical Diffusion - Amplitude After\n        A_new = get_amplitude(rho_np1, kappa, x, N)\n\n        # Calculate measured diffusion\n        if A_old > 0 and A_new > 0 and dt > 0:\n            # The argument to log can be close to 1, causing precision loss, but it's the required formula.\n            if np.isclose(A_new / A_old, 1.0):\n                 D_meas = 0.0\n            else:\n                 D_meas = -np.log(A_new / A_old) / (kappa**2 * dt)\n        else:\n            D_meas = 0.0\n\n        # Calculate theoretical diffusion\n        D_theory = (np.abs(u) * dx / 2.0) * (1 - lam)\n        \n        # Absolute error\n        error = np.abs(D_meas - D_theory)\n\n        results.append(f\"[{D_meas},{D_theory},{error},{mass_conserved}]\")\n\n    # Format the final output as a single string\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}