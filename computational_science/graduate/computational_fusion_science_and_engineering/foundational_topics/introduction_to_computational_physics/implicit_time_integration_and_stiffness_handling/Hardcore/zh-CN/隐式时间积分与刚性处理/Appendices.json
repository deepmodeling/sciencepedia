{
    "hands_on_practices": [
        {
            "introduction": "隐式时间积分方法的核心思想是将一个微分方程问题转化为一个代数方程问题。本练习将引导你完成关键的下一步：求解这个代数方程。通过对一个典型的刚性常微分方程模型应用后向欧拉法，你将练习如何构建并应用牛顿法，这是计算等离子体物理中求解隐式方程的一项基本技能。",
            "id": "3992852",
            "problem": "在一个集总零维模型中，用于描述聚变等离子体能量平衡中的电阻弛豫，一个线性化微扰振幅 $y(t)$ 服从标量常微分方程 (ODE) $y'(t) = f(t,y) = -\\lambda y(t) + S(t)$，其中 $\\lambda$ 代表强碰撞阻尼率，$S(t)$ 是一个外部驱动项。考虑 $\\lambda = 10^{6}$ 和 $S(t) = \\sin(t)$ 的情况，这是在隐式时间积分中离散化磁流体动力学 (MHD) 时经常遇到的典型刚性源项。为了处理刚性问题，使用常数时间步长 $\\Delta t = 10^{-2}$ 的后向欧拉法。\n\n从导数的定义和后向欧拉法所基于的隐式离散化原理出发，推导在时间 $t_{n+1} = t_n + \\Delta t$ 时 $y_{n+1}$ 关于 $y_n$ 和 $t_{n+1}$ 的代数更新方程。然后，构建以 $y_{n+1}$ 为根的非线性残差 $R(y)$，并计算其雅可比矩阵。从初始猜测 $y^{(0)} = y_n$ 开始，执行一次牛顿-拉夫逊法迭代，并使用 $\\Delta t = 10^{-2}$ 简化所得表达式。\n\n将你的最终答案表示为单步牛顿迭代解 $y^{(1)}$ 关于 $y_n$ 和 $t_{n+1}$ 的单个闭式解析表达式。无需进行数值舍入，最终表达式中也不要包含单位。",
            "solution": "首先验证问题，以确保其科学上合理、适定，并提供了所有必要信息。\n\n### 第一步：提取已知条件\n- **控制常微分方程**：$y'(t) = f(t,y) = -\\lambda y(t) + S(t)$\n- **阻尼率**：$\\lambda = 10^{6}$\n- **外部驱动**：$S(t) = \\sin(t)$\n- **数值方法**：后向欧拉法\n- **时间步长**：$\\Delta t = 10^{-2}$\n- **任务**：推导 $y_{n+1}$ 的更新方程，构建残差 $R(y)$ 及其雅可比矩阵 $J(y)$，并以初始猜测 $y^{(0)} = y_n$ 执行一次牛顿-拉夫逊迭代以求得 $y^{(1)}$。$y^{(1)}$ 的最终表达式应以 $y_n$ 和 $t_{n+1}$ 表示。\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了一个标准的刚性常微分方程，这是等离子体物理学中一个简化但具有代表性的模型。对刚性问题使用后向欧拉法以及使用牛顿-拉夫逊法求解得到的隐式方程，是数值分析和计算科学中标准的、成熟的技术。该问题是适定的，所有必要的参数（$\\lambda$, $\\Delta t$）和条件（初始猜测 $y^{(0)}=y_n$）都已指明。术语精确，目标明确。没有矛盾、歧义或事实错误。\n\n### 第三步：结论与行动\n该问题被判定为 **有效**。将推导完整解。\n\n### 推导过程\n问题要求我们使用隐式后向欧拉法求解刚性常微分方程 (ODE) $y'(t) = -\\lambda y(t) + \\sin(t)$。\n\n对于一个常微分方程 $y'(t) = f(t, y(t))$，后向欧拉法的一般形式由以下离散化给出：\n$$ \\frac{y_{n+1} - y_n}{\\Delta t} = f(t_{n+1}, y_{n+1}) $$\n其中 $y_n \\approx y(t_n)$，$y_{n+1} \\approx y(t_{n+1})$，以及 $t_{n+1} = t_n + \\Delta t$。\n\n对于给定的常微分方程，右侧的函数是 $f(t, y) = -\\lambda y + \\sin(t)$。应用后向欧拉格式，我们得到：\n$$ \\frac{y_{n+1} - y_n}{\\Delta t} = -\\lambda y_{n+1} + \\sin(t_{n+1}) $$\n这是一个关于未知数 $y_{n+1}$ 的隐式代数方程。\n\n问题要求我们使用牛顿-拉夫逊法求解此方程。首先，我们构建残差函数 $R(y)$，其根为 $y_{n+1}$。我们将方程重排为 $R(y_{n+1}) = 0$ 的形式。设 $y$ 是我们要求解的变量，在根处它将等于 $y_{n+1}$。\n$$ R(y) = y - y_n - \\Delta t(-\\lambda y + \\sin(t_{n+1})) $$\n展开此表达式得到残差：\n$$ R(y) = y - y_n + \\lambda \\Delta t y - \\Delta t \\sin(t_{n+1}) $$\n$$ R(y) = (1 + \\lambda \\Delta t)y - y_n - \\Delta t \\sin(t_{n+1}) $$\n\n接下来，我们计算残差的雅可比矩阵 $J(y)$，对于标量函数，它就是其关于 $y$ 的导数：\n$$ J(y) = \\frac{dR}{dy} $$\n$$ J(y) = \\frac{d}{dy} \\left[ (1 + \\lambda \\Delta t)y - y_n - \\Delta t \\sin(t_{n+1}) \\right] $$\n由于在求解第 $(n+1)$ 步的 $y$ 时，$y_n$ 和 $t_{n+1}$ 是常数，因此导数为：\n$$ J(y) = 1 + \\lambda \\Delta t $$\n注意，因为原始常微分方程是关于 $y$ 线性的，所以残差 $R(y)$ 也是关于 $y$ 线性的，其雅可比矩阵是一个与 $y$ 无关的常数。\n\n用于寻找 $R(y)$ 根的牛顿-拉夫逊更新公式是：\n$$ y^{(k+1)} = y^{(k)} - [J(y^{(k)})]^{-1} R(y^{(k)}) $$\n对于我们的标量问题，这简化为：\n$$ y^{(k+1)} = y^{(k)} - \\frac{R(y^{(k)})}{J(y^{(k)})} $$\n我们被要求从初始猜测 $y^{(0)} = y_n$ 开始执行一次迭代。第一次迭代的结果 $y^{(1)}$ 是：\n$$ y^{(1)} = y^{(0)} - \\frac{R(y^{(0)})}{J(y^{(0)})} = y_n - \\frac{R(y_n)}{J(y_n)} $$\n我们在 $y=y_n$ 处计算残差 $R(y)$：\n$$ R(y_n) = (1 + \\lambda \\Delta t)y_n - y_n - \\Delta t \\sin(t_{n+1}) = \\lambda \\Delta t y_n - \\Delta t \\sin(t_{n+1}) $$\n雅可比矩阵是常数：$J(y_n) = 1 + \\lambda \\Delta t$。\n将这些表达式代入 $y^{(1)}$ 的公式中：\n$$ y^{(1)} = y_n - \\frac{\\lambda \\Delta t y_n - \\Delta t \\sin(t_{n+1})}{1 + \\lambda \\Delta t} $$\n为了简化，我们通分：\n$$ y^{(1)} = \\frac{y_n (1 + \\lambda \\Delta t) - (\\lambda \\Delta t y_n - \\Delta t \\sin(t_{n+1}))}{1 + \\lambda \\Delta t} $$\n$$ y^{(1)} = \\frac{y_n + \\lambda \\Delta t y_n - \\lambda \\Delta t y_n + \\Delta t \\sin(t_{n+1})}{1 + \\lambda \\Delta t} $$\n包含 $\\lambda \\Delta t y_n$ 的项相互抵消，得到：\n$$ y^{(1)} = \\frac{y_n + \\Delta t \\sin(t_{n+1})}{1 + \\lambda \\Delta t} $$\n因为残差函数 $R(y)$ 是线性的，牛顿-拉夫逊法在单次迭代中收敛。因此，$y^{(1)}$ 是后向欧拉步骤中 $y_{n+1}$ 的精确解。\n\n最后，我们代入给定的数值：$\\lambda = 10^6$ 和 $\\Delta t = 10^{-2}$。\n$$ \\lambda \\Delta t = 10^6 \\times 10^{-2} = 10^4 $$\n分母变为 $1 + \\lambda \\Delta t = 1 + 10^4 = 10001$。\n$y^{(1)}$ 的表达式则为：\n$$ y^{(1)} = \\frac{y_n + 10^{-2} \\sin(t_{n+1})}{10001} $$\n这就是单步牛顿迭代解 $y^{(1)}$ 关于 $y_n$ 和 $t_{n+1}$ 的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{y_n + 10^{-2} \\sin(t_{n+1})}{10001}}\n$$"
        },
        {
            "introduction": "虽然像后向欧拉这样的方法对刚性问题是稳定的，但它们通常只有一阶精度。Crank-Nicolson方法提供了二阶精度，但在处理刚性问题时，其稳定性特性有一些重要的微妙之处。本练习通过推导其放大因子，深入探讨Crank-Nicolson方法的稳定性，揭示其在模拟强耗散现象时可能产生非物理振荡的原因，这是聚变模拟中的一个关键考量。",
            "id": "3992877",
            "problem": "考虑高温磁化聚变等离子体中沿单根磁力线的平行电子热传导，该过程被建模为长度为 $L$ 的周期性域上的一维扩散。电子温度 $T(x,t)$ 服从线性扩散方程 $ \\partial T / \\partial t = \\chi \\, \\partial^{2} T / \\partial x^{2} $，其中 $\\chi  0$ 是（恒定的）平行热扩散系数。对于波数为 $k = 2 \\pi m / L$（$m$ 为整数）的单个傅里叶模 $T(x,t) = \\hat{T}(t) \\exp(i k x)$，空间算子简化为特征值问题，给出常微分方程 $ d \\hat{T} / d t = \\lambda \\, \\hat{T} $，其中 $\\lambda = - \\chi k^{2}$。\n\n一种隐式梯形时间积分方法，也称为 Crank–Nicolson (CN) 方法，通过对 $t^{n}$ 和 $t^{n+1}$ 之间的右端项取平均，将时间 $t^{n}$ 的模振幅 $\\hat{T}^{n}$ 更新到时间 $t^{n+1} = t^{n} + \\Delta t$ 的 $\\hat{T}^{n+1}$。定义无量纲步长 $z = \\lambda \\, \\Delta t$。从线性常微分方程的梯形法则基本定义出发，推导该线性模的 CN 放大因子 $G(z)$，其中 $G(z) = \\hat{T}^{n+1} / \\hat{T}^{n}$。然后，解析地验证对于纯虚数 $z$，CN 方法在 $|G(i \\beta)| = 1$（对于任意实数 $\\beta$）的意义上表现出零数值耗散，并解释这对处理聚变相关模拟中扩散动力学的刚性问题有何影响，在这些模拟中，高波数模会使 $|z|$ 变得很大且为负。\n\n将最终结果表示为 $G(z)$ 的闭式表达式。不需要进行数值计算。不需要进行四舍五入。最终表达式中不包含任何单位。",
            "solution": "该问题是适定的，具有科学依据，并包含了得到完整解所需的所有信息。它描述了将 Crank-Nicolson 数值方法应用于线性扩散方程的标准分析，这是计算科学中的一个基本课题。我们将按要求进行推导和分析。\n\n分析分为三个部分：首先，推导放大因子 $G(z)$；其次，验证其在自变量为纯虚数时的模；第三，解释其对模拟刚性系统的影响。\n\n**第一部分：放大因子 $G(z)$ 的推导**\n\n我们从控制单个傅里叶模振幅 $\\hat{T}(t)$ 时间演化的常微分方程（ODE）开始：\n$$\n\\frac{d \\hat{T}}{d t} = \\lambda \\hat{T}\n$$\n其中 $\\lambda = -\\chi k^2$ 是与波数为 $k$ 的空间模相关的特征值。\n\n隐式梯形法则，或称 Crank-Nicolson (CN) 方法，对此常微分方程进行时间离散化。新时间步的值 $\\hat{T}^{n+1}$ 与旧时间步的值 $\\hat{T}^{n}$ 相关，其关系是通过近似区间 $[t^n, t^{n+1}]$ 中点处的时间导数，并将右端项计算为其在 $t^n$ 和 $t^{n+1}$ 处值的平均值得到的。对于一个一般的常微分方程 $\\frac{dy}{dt} = f(y)$，该格式为：\n$$\n\\frac{y^{n+1} - y^{n}}{\\Delta t} = \\frac{1}{2} \\left[ f(y^{n}) + f(y^{n+1}) \\right]\n$$\n在我们的特定情况下，$y = \\hat{T}$ 且函数是线性的，$f(\\hat{T}) = \\lambda \\hat{T}$。将此代入通用形式，得到：\n$$\n\\frac{\\hat{T}^{n+1} - \\hat{T}^{n}}{\\Delta t} = \\frac{1}{2} \\left[ \\lambda \\hat{T}^{n} + \\lambda \\hat{T}^{n+1} \\right]\n$$\n此方程对于 $\\hat{T}^{n+1}$ 是隐式的，因此我们必须重新整理它以求解 $\\hat{T}^{n+1}$。\n$$\n\\hat{T}^{n+1} - \\hat{T}^{n} = \\frac{\\lambda \\Delta t}{2} \\left( \\hat{T}^{n} + \\hat{T}^{n+1} \\right)\n$$\n我们将包含 $\\hat{T}^{n+1}$ 的项归到左侧，将包含 $\\hat{T}^{n}$ 的项归到右侧：\n$$\n\\hat{T}^{n+1} - \\frac{\\lambda \\Delta t}{2} \\hat{T}^{n+1} = \\hat{T}^{n} + \\frac{\\lambda \\Delta t}{2} \\hat{T}^{n}\n$$\n提出公因子 $\\hat{T}^{n+1}$ 和 $\\hat{T}^{n}$：\n$$\n\\hat{T}^{n+1} \\left( 1 - \\frac{\\lambda \\Delta t}{2} \\right) = \\hat{T}^{n} \\left( 1 + \\frac{\\lambda \\Delta t}{2} \\right)\n$$\n放大因子 $G$ 定义为比率 $G = \\hat{T}^{n+1} / \\hat{T}^{n}$。求解该比率可得：\n$$\nG = \\frac{1 + \\frac{\\lambda \\Delta t}{2}}{1 - \\frac{\\lambda \\Delta t}{2}}\n$$\n问题定义了无量纲参数 $z = \\lambda \\Delta t$。代入此定义，我们得到放大因子的最终表达式：\n$$\nG(z) = \\frac{1 + \\frac{z}{2}}{1 - \\frac{z}{2}}\n$$\n\n**第二部分：验证 $|G(i \\beta)| = 1$**\n\n我们被要求验证，对于一个纯虚数自变量 $z = i \\beta$（其中 $\\beta$ 是任意实数），放大因子的模恰好为1。此性质是某个格式对于纯振荡（非耗散）系统保持能量守恒的特征。我们将 $z=i\\beta$ 代入 $G(z)$ 的表达式中：\n$$\nG(i\\beta) = \\frac{1 + \\frac{i\\beta}{2}}{1 - \\frac{i\\beta}{2}}\n$$\n复数之比的模等于它们模的比。一个复数 $a + ib$ 的模是 $|a+ib| = \\sqrt{a^2 + b^2}$。\n$$\n|G(i\\beta)| = \\frac{\\left| 1 + i\\frac{\\beta}{2} \\right|}{\\left| 1 - i\\frac{\\beta}{2} \\right|}\n$$\n分子的模是：\n$$\n\\left| 1 + i\\frac{\\beta}{2} \\right| = \\sqrt{1^2 + \\left(\\frac{\\beta}{2}\\right)^2} = \\sqrt{1 + \\frac{\\beta^2}{4}}\n$$\n分母的模是：\n$$\n\\left| 1 - i\\frac{\\beta}{2} \\right| = \\sqrt{1^2 + \\left(-\\frac{\\beta}{2}\\right)^2} = \\sqrt{1 + \\frac{\\beta^2}{4}}\n$$\n由于分子和分母的模相同，它们的比值为 $1$：\n$$\n|G(i\\beta)| = \\frac{\\sqrt{1 + \\frac{\\beta^2}{4}}}{\\sqrt{1 + \\frac{\\beta^2}{4}}} = 1\n$$\n这解析地证实了对于任何特征值 $\\lambda$ 为纯虚数的系统，Crank-Nicolson 方法是完全非耗散的。\n\n**第三部分：对刚性问题处理的影响**\n\n在给定的扩散问题背景下，刚性源于与不同傅里叶模相关的衰减时间尺度的巨大差异。波数为 $k$ 的模的衰减时间为 $\\tau_k = 1/|\\lambda| = 1/(\\chi k^2)$。高波数（短波长）模具有非常短的衰减时间（快动力学），而低波数（长波长）模具有很长的衰减时间（慢动力学）。数值方法必须能够处理这种差异。\n\n对于扩散问题，特征值为 $\\lambda = -\\chi k^2$，它是一个实数且非正。因此，无量纲步长为 $z = \\lambda \\Delta t = -(\\chi k^2) \\Delta t \\le 0$。如果对于所有这样的 $z$ 都有 $|G(z)| \\le 1$，则数值格式是稳定的。对于 CN 方法和实数 $z \\le 0$：\n$$\n|G(z)| = \\left| \\frac{1 + z/2}{1 - z/2} \\right|\n$$\n因为 $z \\le 0$，所以分母 $1 - z/2$ 总是 $\\ge 1$。分子 $1+z/2$ 可以是正数或负数。然而，很容易证明对于所有 $z \\le 0$，都有 $|1+z/2| \\le |1-z/2|$，这意味着 $|G(z)| \\le 1$。该格式对于扩散问题是无条件稳定的，也称为 A-稳定。这是处理刚性问题的一个主要优点，因为它允许时间步长 $\\Delta t$ 根据慢的、物理上相关的模的精度要求来选择，而不是受到最快的、通常无法解析的模的稳定性限制的约束。\n\n然而，性质 $|G(i\\beta)|=1$ 对刚性扩散动力学有一个关键后果。此性质意味着 CN 方法将连续系统的稳定边界（虚轴，$\\text{Re}(z)=0$）精确地映射到离散系统的稳定边界（单位圆，|G|=1）。对于一个非常刚性的扩散模，波数 $k$ 很大，使得 $|\\lambda|$ 非常大。如果使用一个大的时间步长 $\\Delta t$，参数 $z = -\\chi k^2 \\Delta t$ 会成为一个绝对值非常大的负数，即 $z \\to -\\infty$。\n\n让我们考察 $G(z)$ 在此极限下的行为：\n$$\n\\lim_{z \\to -\\infty} G(z) = \\lim_{z \\to -\\infty} \\frac{1 + z/2}{1 - z/2} = \\lim_{z \\to -\\infty} \\frac{z(1/z + 1/2)}{z(1/z - 1/2)} = \\frac{1/2}{-1/2} = -1\n$$\n这意味着对于非常刚性的分量，数值解不会衰减；相反，它在每个时间步都会符号反转：$\\hat{T}^{n+1} \\approx -\\hat{T}^n$。虽然这种行为是稳定的（模不增长），但它未能像物理上应有的那样阻尼高频模。这些刚性模中的能量以不符合物理的高频振荡（常称为“振铃效应”）的形式持续存在，这会破坏整体解的精度。对于刚性耗散分量，理想的行为是当 $z \\to -\\infty$ 时 $|G(z)| \\to 0$（一种称为 L-稳定性的性质），这将迅速地将它们阻尼掉。\n\n总而言之，性质 $|G(i\\beta)|=1$ 使得 CN 方法非常适合处理非耗散的波动现象，但它也直接导致了该方法对刚性扩散模的阻尼效果差。无条件稳定性允许使用大的时间步长，但这是以引入由未被阻尼的刚性分量引起的虚假数值振荡为代价的。这种权衡是在为多尺度聚变等离子体模拟选择隐式积分器时的一个核心考虑因素。",
            "answer": "$$\n\\boxed{\\frac{1 + \\frac{z}{2}}{1 - \\frac{z}{2}}}\n$$"
        },
        {
            "introduction": "实际的聚变问题通常涉及偏微分方程(PDE)，而不仅仅是单个常微分方程(ODE)。本练习旨在弥合理论与实践之间的差距，将Crank-Nicolson方法应用于热扩散方程，该方程是模拟等离子体中输运现象的模型。你将看到空间离散化如何将一个PDE转化为一个大型耦合ODE系统，以及隐式时间积分器如何最终导出一个在每个时间步都必须求解的结构化线性系统。",
            "id": "3992805",
            "problem": "考虑一维热传导作为面向等离子体部件中跨场热扩散的模型，该过程由扩散方程 $u_t = \\nu u_{xx}$ 建模，其中 $u(x,t)$ 是温度，$\\nu$ 是热扩散系数，下标表示偏导数。假设在有限区间上存在一个间距为 $h$ 的均匀网格，并且在两个端点处采用齐次狄利克雷（Dirichlet）边界条件。使用克兰克-尼科尔森（Crank–Nicolson）方法——该方法是在时间上对半离散演化应用梯形法则，在空间上使用中心二阶有限差分——来推导用于将内部节点值从时间 $t^n$ 推进到时间 $t^{n+1} = t^n + \\Delta t$ 的线性系统。您的推导必须从时间导数和中心二阶差分的定义以及时间上的梯形数值积分法则开始，不得假定任何预先推导好的格式。清晰地分离出左侧（LHS）关于时间 $t^{n+1}$ 处未知内部值的所得三对角系统的系数，并用 $\\nu$、 $h$ 和 $\\Delta t$ 表示这些系数。\n\n对于本问题，仅关注作用于时间 $t^{n+1}$ 处内部未知数的左侧三对角矩阵（即次对角线、主对角线和超对角线）。假设采用齐次狄利克雷边界条件，因此左侧系数在所有内部节点上空间恒定。\n\n您需要实现一个程序，在给定 $(\\nu, h, \\Delta t)$ 的情况下，按以下顺序计算内部方程的三对角矩阵的三个不同系数：次对角线、主对角线、超对角线。这些系数是无量纲的。将每个系数表示为四舍五入到六位小数的小数。\n\n测试套件：\n为以下参数集提供结果，每个参数集以 $(\\nu\\ \\mathrm{单位\\ m^2/s},\\ h\\ \\mathrm{单位\\ m},\\ \\Delta t\\ \\mathrm{单位\\ s})$ 的形式给出：\n- 案例A：$(\\nu, h, \\Delta t) = (1.0, 0.2, 0.01)$\n- 案例B：$(\\nu, h, \\Delta t) = (0.0, 0.1, 1.0)$\n- 案例C：$(\\nu, h, \\Delta t) = (0.01, 0.005, 1.0)$\n- 案例D：$(\\nu, h, \\Delta t) = (1.0, 0.1, 10^{-6})$\n- 案例E：$(\\nu, h, \\Delta t) = (5.0, 0.03, 0.7)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个列表的列表形式的结果，每个内部列表对应一个案例，按 A 到 E 的顺序排列。每个内部列表必须按 [次对角线, 主对角线, 超对角线] 的顺序包含三个系数，每个系数都四舍五入到六位小数，并且输出中不得有任何空格。例如，包含两个案例的输出将类似于 $[[a_1,b_1,c_1],[a_2,b_2,c_2]]$，其中每个 $a_i$、$b_i$、$c_i$ 都是一个六位小数。在本问题中，您必须按照所描述的精确格式，将五个案例的结果输出到一行上。",
            "solution": "该问题要求推导一维热方程 $u_t = \\nu u_{xx}$ 经克兰克-尼科尔森（Crank–Nicolson）离散化后产生的线性系统隐式部分的系数。推导过程必须从基本定义出发。\n\n控制偏微分方程（PDE）是热扩散方程：\n$$\n\\frac{\\partial u}{\\partial t} = \\nu \\frac{\\partial^2 u}{\\partial x^2}\n$$\n此处，$u(x,t)$ 是温度，$\\nu$ 是热扩散系数，$x$ 是空间坐标，$t$ 是时间坐标。\n\n我们引入空间和时间上的离散网格。令 $x_j = j h$ 为空间网格点，其中 $h$ 是均匀的网格间距；令 $t^n = n \\Delta t$ 为时间层级，其中 $\\Delta t$ 是时间步长。在网格点 $(x_j, t^n)$ 处的温度值记为 $u_j^n \\approx u(x_j, t^n)$。\n\n空间二阶导数 $\\frac{\\partial^2 u}{\\partial x^2}$ 在内部空间节点 $x_j$ 处使用二阶中心有限差分公式近似为：\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=x_j} \\approx \\frac{u_{j-1} - 2u_j + u_{j+1}}{h^2}\n$$\n将此公式应用于每个内部节点 $j$ 的偏微分方程，得到一个常微分方程组（ODEs），这种方法称为线法（method of lines）：\n$$\n\\frac{du_j(t)}{dt} = \\nu \\frac{u_{j-1}(t) - 2u_j(t) + u_{j+1}(t)}{h^2}\n$$\n\n接下来，我们使用克兰克-尼科尔森（Crank–Nicolson）方法在时间上进行离散化，这等同于对时间积分应用梯形法则。对于形式为 $\\frac{dy}{dt} = f(y, t)$ 的一般常微分方程，从时间 $t^n$ 推进到 $t^{n+1}$ 的梯形法则是：\n$$\n\\frac{y^{n+1} - y^n}{\\Delta t} = \\frac{1}{2} \\left[ f(y^n, t^n) + f(y^{n+1}, t^{n+1}) \\right]\n$$\n\n将此法则应用于我们的半离散热方程，我们将 $y_j$ 对应于 $u_j$，并将 $f(u_j, t)$ 对应于半离散方程的右侧。结果如下：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = \\frac{1}{2} \\left( \\nu \\frac{u_{j-1}^n - 2u_j^n + u_{j+1}^n}{h^2} + \\nu \\frac{u_{j-1}^{n+1} - 2u_j^{n+1} + u_{j+1}^{n+1}}{h^2} \\right)\n$$\n此方程将时间 $t^{n+1}$ 的未知值（在右侧）与时间 $t^n$ 的已知值耦合在一起。为了构建关于未知数的线性系统，我们必须重新排列方程，将所有时间层级为 $n+1$ 的项归到左侧（LHS），将所有时间层级为 $n$ 的项归到右侧（RHS）。\n\n首先，两边同乘以 $\\Delta t$：\n$$\nu_j^{n+1} - u_j^n = \\frac{\\nu \\Delta t}{2h^2} \\left( u_{j-1}^n - 2u_j^n + u_{j+1}^n \\right) + \\frac{\\nu \\Delta t}{2h^2} \\left( u_{j-1}^{n+1} - 2u_j^{n+1} + u_{j+1}^{n+1} \\right)\n$$\n\n现在，我们将所有上标为 $n+1$ 的项移到左侧（LHS）：\n$$\nu_j^{n+1} - \\frac{\\nu \\Delta t}{2h^2} u_{j-1}^{n+1} - \\frac{\\nu \\Delta t}{2h^2} (-2u_j^{n+1}) - \\frac{\\nu \\Delta t}{2h^2} u_{j+1}^{n+1} = u_j^n + \\frac{\\nu \\Delta t}{2h^2} \\left( u_{j-1}^n - 2u_j^n + u_{j+1}^n \\right)\n$$\n\n我们可以按空间索引 $(j-1, j, j+1)$ 对左侧的项进行分组，以揭示线性系统的结构：\n$$\n\\left(-\\frac{\\nu \\Delta t}{2h^2}\\right) u_{j-1}^{n+1} + \\left(1 + \\frac{2\\nu \\Delta t}{2h^2}\\right) u_j^{n+1} + \\left(-\\frac{\\nu \\Delta t}{2h^2}\\right) u_{j+1}^{n+1} = \\text{RHS}\n$$\n\n简化 $u_j^{n+1}$ 项的系数，得到节点 $j$ 的线性方程的最终形式：\n$$\n\\left(-\\frac{\\nu \\Delta t}{2h^2}\\right) u_{j-1}^{n+1} + \\left(1 + \\frac{\\nu \\Delta t}{h^2}\\right) u_j^{n+1} + \\left(-\\frac{\\nu \\Delta t}{2h^2}\\right) u_{j+1}^{n+1} = \\text{RHS}\n$$\n\n此方程表示一个三对角线性系统 $A \\mathbf{u}^{n+1} = \\mathbf{b}$ 中的一行，其中 $\\mathbf{u}^{n+1}$ 是时间 $t^{n+1}$ 处的未知内部节点值的向量。问题要求的是构成左侧三对角矩阵 $A$ 的三个不同系数。因为假设了齐次狄利克雷边界条件，并且系数 $\\nu$、$h$ 和 $\\Delta t$ 是常数，所以这三个值对于矩阵的所有内部行都是恒定的。\n\n这些系数是：\n1.  **次对角线系数**（$u_{j-1}^{n+1}$ 的系数）：$c_{sub} = -\\frac{\\nu \\Delta t}{2h^2}$\n2.  **主对角线系数**（$u_j^{n+1}$ 的系数）：$c_{main} = 1 + \\frac{\\nu \\Delta t}{h^2}$\n3.  **超对角线系数**（$u_{j+1}^{n+1}$ 的系数）：$c_{super} = -\\frac{\\nu \\Delta t}{2h^2}$\n\n下面的程序使用这些表达式来计算给定测试案例的数值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Crank-Nicolson LHS coefficients for 1D heat diffusion.\n    \"\"\"\n    \n    # Test cases as tuples of (nu, h, dt).\n    test_cases = [\n        (1.0, 0.2, 0.01),      # Case A\n        (0.0, 0.1, 1.0),       # Case B\n        (0.01, 0.005, 1.0),    # Case C\n        (1.0, 0.1, 1e-6),      # Case D\n        (5.0, 0.03, 0.7),      # Case E\n    ]\n    \n    # A list to store the formatted string for each case's results.\n    results_str_list = []\n    \n    for case in test_cases:\n        nu, h, dt = case\n        \n        # Avoid division by zero if h is zero, although not in test cases.\n        if h == 0.0:\n            # This case is physically ill-defined, but for robustness:\n            # Assigning infinity or NaN might be alternatives.\n            # Using very large numbers to signify singularity.\n            r_val = np.inf\n        else:\n            # Calculate the dimensionless diffusion number parameter\n            r_val = nu * dt / (h**2)\n            \n        # The problem defines the equation as u_t = nu * u_xx.\n        # The Crank-Nicolson scheme is:\n        # (I - (nu*dt/2) * D_xx) * u^{n+1} = (I + (nu*dt/2) * D_xx) * u^n\n        # where D_xx is the finite difference operator (1/h^2)*[1, -2, 1].\n        # For a row j, the LHS is:\n        # -(nu*dt / (2*h^2)) * u_{j-1}^{n+1} + (1 + nu*dt / h^2) * u_j^{n+1} - (nu*dt / (2*h^2)) * u_{j+1}^{n+1}\n\n        # Coefficient of u_{j-1}^{n+1} (sub-diagonal)\n        sub_diag = -r_val / 2.0\n        \n        # Coefficient of u_j^{n+1} (main-diagonal)\n        main_diag = 1.0 + r_val\n        \n        # Coefficient of u_{j+1}^{n+1} (super-diagonal)\n        super_diag = -r_val / 2.0\n        \n        # Format the result list for this case into a string with no spaces,\n        # with each number rounded to six decimal places.\n        case_str = f\"[{sub_diag:.6f},{main_diag:.6f},{super_diag:.6f}]\"\n        results_str_list.append(case_str)\n        \n    # Join all case strings with commas and enclose in brackets\n    # to match the final required output format.\n    final_output = f\"[{','.join(results_str_list)}]\"\n    \n    print(final_output)\n\n# Execute the solver function\nsolve()\n```"
        }
    ]
}