{
    "hands_on_practices": [
        {
            "introduction": "Understanding the spatial structure of plasma instabilities is fundamental in fusion research. This practice explores how a finite number of diagnostic probes arranged around a toroidal device limits our ability to identify the toroidal mode numbers of these instabilities. By working from first principles, you will derive the condition for spatial aliasing and determine the minimum number of probes needed to unambiguously resolve all modes up to a certain complexity, a direct application of the Nyquist-Shannon sampling theorem to a spatial domain .",
            "id": "4024285",
            "problem": "In a toroidal magnetic confinement device, a set of $N$ identical pick-up coils is installed at evenly spaced toroidal angles $\\phi_{j} = \\frac{2\\pi j}{N}$ for $j \\in \\{0,1,\\ldots,N-1\\}$. The measured signal is a toroidally periodic field $B(\\phi)$ that can be decomposed as a Fourier series in integer toroidal mode numbers $n \\in \\mathbb{Z}$, so that $B(\\phi) = \\sum_{n \\in \\mathbb{Z}} A_{n} \\exp(i n \\phi)$, where $A_{n} \\in \\mathbb{C}$ are the complex amplitudes and $\\phi$ is measured in radians. The instrument records $B(\\phi_{j})$ simultaneously at all $N$ locations, and one wishes to infer the toroidal mode number content of $B(\\phi)$ from these samples using a discrete Fourier analysis, as is standard in computational analyses and in fast Fourier transform (FFT)-based pipelines in computational fusion science and engineering.\n\nStarting only from the definitions of uniform angular sampling on a periodic domain and the integer-harmonic representation of $B(\\phi)$, and without invoking any pre-quoted aliasing formulas, answer the following:\n\n- Derive a necessary and sufficient condition under which two distinct integer toroidal mode numbers $n,n' \\in \\mathbb{Z}$ produce identical sample values at all $N$ probes. Express the full set of mode numbers $n'$ that are indistinguishable from a given $n$.\n\n- Suppose physics and diagnostic considerations imply a strict bandlimit $|n| \\le n_{\\max}$ for some known finite integer $n_{\\max} \\ge 1$. Determine the minimal integer $N_{\\min}$ such that, for every admissible mode number with $|n| \\le n_{\\max}$, no other admissible mode number is indistinguishable from it under sampling on $N_{\\min}$ probes.\n\nExpress your final answer as a closed-form analytic expression in terms of $n_{\\max}$. No units are required in the final answer. Angles are measured in radians.",
            "solution": "The problem requires us to first derive the condition under which two distinct toroidal modes are indistinguishable when sampled by a finite number of probes, and second, to determine the minimum number of probes required to uniquely identify all modes within a specified bandlimit. We shall proceed by formal derivation from the provided definitions.\n\nFirst, let us address the condition for indistinguishability. A single toroidal mode with mode number $n \\in \\mathbb{Z}$ is represented by the complex exponential function $\\exp(i n \\phi)$. Two distinct integer mode numbers, $n$ and $n'$, are said to be indistinguishable or \"aliased\" by the measurement system if their corresponding basis functions yield identical values at all $N$ sampling locations $\\phi_j = \\frac{2\\pi j}{N}$ for $j \\in \\{0, 1, \\ldots, N-1\\}$. This condition is mathematically expressed as:\n$$ \\exp(i n \\phi_j) = \\exp(i n' \\phi_j) \\quad \\forall j \\in \\{0, 1, \\ldots, N-1\\} $$\nBy dividing both sides by $\\exp(i n' \\phi_j)$ (which is always non-zero), we obtain:\n$$ \\exp(i n \\phi_j - i n' \\phi_j) = 1 $$\n$$ \\exp\\left(i (n - n') \\phi_j\\right) = 1 $$\nSubstituting the definition of the sampling angles $\\phi_j$:\n$$ \\exp\\left(i (n - n') \\frac{2\\pi j}{N}\\right) = 1 $$\nThe complex exponential $\\exp(i\\theta)$ is equal to $1$ if and only if its argument $\\theta$ is an integer multiple of $2\\pi$. Therefore, for each $j$, there must exist an integer $k_j$ such that:\n$$ (n - n') \\frac{2\\pi j}{N} = 2\\pi k_j $$\nThis simplifies to the condition that $(n - n') \\frac{j}{N}$ must be an integer for all $j \\in \\{0, 1, \\ldots, N-1\\}$.\nFor $j=0$, the condition is $0 = 0$, which is trivially satisfied and provides no constraint.\nLet us consider $j=1$. The condition requires that $(n - n') \\frac{1}{N}$ must be an integer. Let this integer be $m \\in \\mathbb{Z}$.\n$$ \\frac{n - n'}{N} = m $$\n$$ n - n' = mN $$\nThis is a necessary condition derived from the case $j=1$. We must now verify if it is sufficient for all other values of $j$. If we assume $n - n' = mN$ for some integer $m$, the left-hand side of our exponential equation becomes:\n$$ \\exp\\left(i (mN) \\frac{2\\pi j}{N}\\right) = \\exp(i m j 2\\pi) $$\nSince $m$ and $j$ are both integers, their product $mj$ is also an integer. Any integer multiple of $2\\pi i$ in the argument of an exponential function results in a value of $1$. Thus, the condition holds for all $j$.\nThe problem states that the modes are distinct, so $n \\neq n'$, which implies that $m \\neq 0$.\nTherefore, the necessary and sufficient condition for two distinct integer toroidal mode numbers $n$ and $n'$ to be indistinguishable is that their difference is a non-zero integer multiple of the number of samples $N$. The full set of mode numbers $n'$ that are indistinguishable from a given mode $n$ is given by:\n$$ \\{ n' \\in \\mathbb{Z} \\mid n' = n + mN, \\text{ for some } m \\in \\mathbb{Z} \\} $$\n\nNext, we address the second part of the problem. We are given a strict bandlimit, such that the only physically relevant modes are those with $|n| \\le n_{\\max}$ for some integer $n_{\\max} \\ge 1$. The set of admissible mode numbers is $\\mathcal{S} = \\{n \\in \\mathbb{Z} \\mid -n_{\\max} \\le n \\le n_{\\max}\\}$. We must find the minimal number of probes, $N_{\\min}$, such that no two distinct modes within this set are indistinguishable.\n\nThis means that for any two distinct modes $n, n' \\in \\mathcal{S}$ (i.e., $n \\neq n'$), they must be distinguishable. This is equivalent to requiring that the condition for indistinguishability is never met for any pair of distinct modes in $\\mathcal{S}$. From our previous derivation, this means we must ensure that:\n$$ n - n' \\neq mN \\quad \\forall n, n' \\in \\mathcal{S} \\text{ with } n \\neq n', \\text{ and } \\forall m \\in \\mathbb{Z} \\setminus \\{0\\} $$\nLet us analyze the range of possible values for the difference $n - n'$. Since $n, n' \\in [-n_{\\max}, n_{\\max}]$, the maximum possible value for the difference is $n_{\\max} - (-n_{\\max}) = 2n_{\\max}$, and the minimum value is $-n_{\\max} - n_{\\max} = -2n_{\\max}$. As $n \\neq n'$, the difference $n - n'$ is a non-zero integer. Thus, the set of all possible differences is:\n$$ \\Delta = \\{ k \\in \\mathbb{Z} \\mid -2n_{\\max} \\le k \\le 2n_{\\max}, k \\neq 0 \\} $$\nThe requirement that $n - n' \\neq mN$ for any non-zero integer $m$ means that no non-zero multiple of $N$ can be an element of the set $\\Delta$. The non-zero multiples of $N$ are $\\{ \\pm N, \\pm 2N, \\pm 3N, \\ldots \\}$. To ensure no overlap with $\\Delta$, the smallest magnitude of a non-zero multiple of $N$, which is $N$ itself (since $N \\ge 1$), must be larger than the largest magnitude of any element in $\\Delta$.\nThe maximum absolute value in $\\Delta$ is $|2n_{\\max}| = 2n_{\\max}$.\nSo, we must have the condition:\n$$ N  2n_{\\max} $$\nThe problem asks for the minimal integer $N_{\\min}$ satisfying this condition. The smallest integer strictly greater than $2n_{\\max}$ is $2n_{\\max} + 1$.\nThus, $N_{\\min} = 2n_{\\max} + 1$.\n\nTo confirm this result, let's consider the case where $N = 2n_{\\max}$. If we choose $n=n_{\\max}$ and $n'=-n_{\\max}$, both modes are in the admissible set $\\mathcal{S}$. Their difference is $n-n' = n_{\\max}-(-n_{\\max}) = 2n_{\\max} = 1 \\cdot N$. Since their difference is a multiple of $N$, these two modes would be aliased and therefore indistinguishable. This confirms that $N=2n_{\\max}$ is insufficient. Therefore, the minimal integer number of probes required is indeed $2n_{\\max} + 1$. This corresponds to the Nyquist-Shannon sampling theorem applied to a periodic signal whose Fourier spectrum is contained within the range of mode numbers $[-n_{\\max}, n_{\\max}]$, which has a total span of $2n_{\\max}$.",
            "answer": "$$\\boxed{2n_{\\max} + 1}$$"
        },
        {
            "introduction": "Once data is acquired, correctly interpreting its frequency content is paramount. A common pitfall in spectral analysis is mistaking the finely spaced frequency points from a zero-padded Fast Fourier Transform (FFT) for an improvement in true spectral resolution. This computational exercise will guide you to demonstrate that resolution is fundamentally limited by the observation time, not the FFT length, by analyzing a synthetic signal with closely spaced modes . This hands-on experience is crucial for avoiding erroneous conclusions when analyzing both experimental and simulation data.",
            "id": "4024315",
            "problem": "Consider a synthetic magnetic fluctuation signal representative of plasma modes measured in a toroidal fusion device. The signal is modeled as the sum of two coherent modes and weak broadband turbulence, sampled uniformly for a finite observation time. Let the sampling rate be $f_s$ samples per second, let the number of acquired samples be $N_0$, and let the total observation time be $T_{\\text{obs}} = N_0 / f_s$. You will compare two discrete spectra: the Discrete Fourier Transform (DFT) of the acquired $N_0$ samples, and the DFT after zero padding the time series to a longer length $N_{\\text{fft}}$ with $N_{\\text{fft}} = \\text{pad\\_factor} \\times N_0$. The goal is to demonstrate, from first principles, that zero padding only increases the spectral sampling density (more DFT points) but does not change the intrinsic resolution determined by the finite observation time.\n\nYour tasks are:\n\n1. Generate a discrete-time signal $x[n]$ for $n = 0,1,\\dots,N_0-1$ with sampling interval $\\Delta t = 1/f_s$ of the form\n$$\nx[n] = A_1 \\sin\\left(2\\pi f_1 n \\Delta t \\right) + A_2 \\sin\\left(2\\pi f_2 n \\Delta t \\right) + \\eta[n],\n$$\nwhere $A_1$ and $A_2$ are amplitudes and $\\eta[n]$ is independent identically distributed zero-mean Gaussian noise with small variance. The two coherent components can be interpreted as, for example, an Alfvénic mode and a drift-wave mode present in the plasma. Assume $f_1$ and $f_2$ are strictly below the Nyquist frequency $f_s/2$.\n\n2. Compute two one-sided magnitude spectra using a Fast Fourier Transform (FFT): one using the original length $N_0$ and one using the zero-padded length $N_{\\text{fft}}$. For both, use the real-to-complex FFT that returns nonnegative frequency components. Let the corresponding discrete frequency arrays be $f_k^{(0)}$ and $f_k^{(\\text{pad})}$, and magnitudes be $|X^{(0)}[k]|$ and $|X^{(\\text{pad})}[k]|$.\n\n3. Determine the intrinsic resolution implied by the finite observation time, denoted $\\Delta f_{\\text{intrinsic}}$, purely from the observation time $T_{\\text{obs}}$. Express $\\Delta f_{\\text{intrinsic}}$ in hertz.\n\n4. Determine the spectral sampling density, defined as the DFT bin spacing, for both the unpadded and padded spectra. Let $\\Delta f_{\\text{bin}}^{(0)}$ be the unpadded bin spacing and $\\Delta f_{\\text{bin}}^{(\\text{pad})}$ be the padded bin spacing. Express both in hertz.\n\n5. Implement a resolution-aware peak counting procedure on each spectrum as follows:\n   - Identify local maxima in the magnitude spectrum $|X[k]|$ whose values exceed a fraction of the global maximum magnitude (use a fixed fraction $0.2$ of the maximum).\n   - Convert the peak indices to frequency locations using the corresponding $f_k$ array.\n   - Cluster peaks that are separated by less than $\\Delta f_{\\text{intrinsic}}$ into a single resolvable feature. Count the number of clusters as the number of resolvable peaks.\n\n6. For each test case below, compute and report a five-element list $[\\Delta f_{\\text{intrinsic}}, \\Delta f_{\\text{bin}}^{(0)}, \\Delta f_{\\text{bin}}^{(\\text{pad})}, N_{\\text{res}}^{(0)}, N_{\\text{res}}^{(\\text{pad})}]$, where $N_{\\text{res}}^{(0)}$ and $N_{\\text{res}}^{(\\text{pad})}$ are integers representing the number of resolvable peaks in the unpadded and padded spectra, respectively.\n\nUse the following test suite, designed to probe typical, boundary, and sub-resolution cases relevant to computational fusion signal analysis. In all cases, use $A_1 = A_2 = 1$ and a noise standard deviation of $0.02$ in the same units as $x[n]$:\n- Case 1 (typical separation): $f_s = 20000$ Hz, $N_0 = 2048$, $\\text{pad\\_factor} = 8$, $f_1 = 1200$ Hz, $f_2 = f_1 + 5 \\times \\Delta f_{\\text{intrinsic}}$.\n- Case 2 (Rayleigh-like boundary): $f_s = 20000$ Hz, $N_0 = 2048$, $\\text{pad\\_factor} = 8$, $f_1 = 3000$ Hz, $f_2 = f_1 + \\Delta f_{\\text{intrinsic}}$.\n- Case 3 (sub-resolution separation): $f_s = 20000$ Hz, $N_0 = 2048$, $\\text{pad\\_factor} = 8$, $f_1 = 4500$ Hz, $f_2 = f_1 + 0.6 \\times \\Delta f_{\\text{intrinsic}}$.\n\nRequirements:\n- Express all frequency quantities in hertz.\n- The final program output must be a single line containing a comma-separated list of three five-element lists, enclosed in square brackets, in the exact order of the test cases. For example, the output must look like $[[a_1,a_2,a_3,a_4,a_5],[b_1,b_2,b_3,b_4,b_5],[c_1,c_2,c_3,c_4,c_5]]$ where each $a_i$, $b_i$, $c_i$ is a number (integers for the counts and floating-point numbers in hertz for the frequency quantities).",
            "solution": "The problem requires an analysis of discrete spectra to demonstrate that spectral resolution is a function of the total observation time, not the number of points in a Discrete Fourier Transform (DFT), which can be artificially increased through zero padding. This is a fundamental concept in signal processing, rooted in the properties of the Fourier transform.\n\n### Theoretical Principles\n\n1.  **Finite Observation and Spectral Leakage**: Any measurement is finite in duration. A signal $x(t)$ observed over a time interval $T_{\\text{obs}}$ can be mathematically modeled as the \"true\" infinite signal multiplied by a rectangular window function, $w(t)$, which is $1$ for the duration of the observation and $0$ otherwise. According to the convolution theorem, this multiplication in the time domain corresponds to a convolution in the frequency domain. The Fourier transform of the rectangular window is a sinc function: $\\text{FT}\\{w(t)\\} \\propto \\text{sinc}(\\pi f T_{\\text{obs}})$, where $f$ is frequency. Consequently, the measured spectrum of any signal component (e.g., a pure sinusoid, which is a delta function in the frequency domain) is convolved with this sinc function. This spreads the energy of the sharp spectral line into a broad peak with side lobes, a phenomenon known as spectral leakage.\n\n2.  **Intrinsic Resolution**: The ability to distinguish between two nearby frequency components is called spectral resolution. The Rayleigh criterion, adapted for this context, states that two components are just resolvable if the peak of one component's sinc pattern coincides with the first null of the other's. The first null of the $\\text{sinc}(\\pi f T_{\\text{obs}})$ function occurs at $f = \\pm 1/T_{\\text{obs}}$. Therefore, the minimum resolvable frequency separation is dictated by the observation time. This gives the intrinsic frequency resolution:\n    $$\n    \\Delta f_{\\text{intrinsic}} = \\frac{1}{T_{\\text{obs}}} = \\frac{f_s}{N_0}\n    $$\n    where $f_s$ is the sampling rate and $N_0$ is the number of samples. This resolution limit is fundamental and cannot be overcome by post-processing the acquired $N_0$ samples.\n\n3.  **DFT Bin Spacing vs. Resolution**: The Discrete Fourier Transform (DFT) calculates the spectrum at discrete frequency points, or \"bins.\" The spacing between these bins for a DFT of length $N_{\\text{fft}}$ is:\n    $$\n    \\Delta f_{\\text{bin}} = \\frac{f_s}{N_{\\text{fft}}}\n    $$\n    Zero padding a time-domain signal from its original length $N_0$ to a new length $N_{\\text{fft}} > N_0$ before performing the DFT does not add new information or increase $T_{\\text{obs}}$. It only increases $N_{\\text{fft}}$. This reduces the bin spacing $\\Delta f_{\\text{bin}}$, effectively interpolating the spectrum. It provides a more densely sampled, smoother-looking plot of the underlying sinc-shaped spectral features, but it does not alter the width of these features. Therefore, zero padding improves the *spectral sampling density*, but not the *intrinsic resolution*.\n\n### Algorithmic Procedure\n\nFollowing these principles, the problem is solved by implementing the specified procedure.\n\n1.  **Signal Generation**: For each test case, a discrete-time signal $x[n]$ is synthesized. It consists of two sinusoids with amplitudes $A_1=1$ and $A_2=1$ at frequencies $f_1$ and $f_2$, plus zero-mean Gaussian noise $\\eta[n]$ with a standard deviation of $0.02$. The time axis is defined by $n=0, 1, \\dots, N_0-1$ with a sampling interval $\\Delta t = 1/f_s$.\n\n2.  **Parameter Calculation**: The key frequency metrics are calculated for each case. Given $f_s = 20000$ Hz and $N_0 = 2048$:\n    -   Observation time: $T_{\\text{obs}} = N_0/f_s = 2048 / 20000 = 0.1024$ s.\n    -   Intrinsic resolution: $\\Delta f_{\\text{intrinsic}} = 1/T_{\\text{obs}} = 1/0.1024 \\approx 9.7656$ Hz.\n    -   Unpadded bin spacing: $\\Delta f_{\\text{bin}}^{(0)} = f_s/N_0 = 20000/2048 \\approx 9.7656$ Hz. Note that $\\Delta f_{\\text{intrinsic}} = \\Delta f_{\\text{bin}}^{(0)}$.\n    -   Padded length: $N_{\\text{fft}} = \\text{pad\\_factor} \\times N_0 = 8 \\times 2048 = 16384$.\n    -   Padded bin spacing: $\\Delta f_{\\text{bin}}^{(\\text{pad})} = f_s/N_{\\text{fft}} = 20000/16384 \\approx 1.2207$ Hz.\n\n3.  **Spectral Analysis**: For both the original signal of length $N_0$ and the zero-padded signal of length $N_{\\text{fft}}$, a one-sided magnitude spectrum is computed using the real-to-complex Fast Fourier Transform (`scipy.fft.rfft`). This yields the magnitude arrays $|X^{(0)}[k]|$ and $|X^{(\\text{pad})}[k]|$ and their corresponding frequency arrays $f_k^{(0)}$ and $f_k^{(\\text{pad})}$.\n\n4.  **Resolution-Aware Peak Counting**: A custom procedure determines the number of resolvable peaks.\n    a.  Local maxima in the magnitude spectrum are identified. A point $|X[k]|$ is a local maximum if it is greater than its immediate neighbors, $|X[k-1]|$ and $|X[k+1]|$.\n    b.  These maxima are filtered, keeping only those that exceed a threshold of $0.2$ times the global maximum of the spectrum. This step rejects minor peaks due to noise.\n    c.  The frequencies of the surviving peaks are collected.\n    d.  The peaks are clustered. Starting with the lowest-frequency peak, subsequent peaks are grouped into the same cluster if their frequency separation from the previous peak in the sorted list is less than $\\Delta f_{\\text{intrinsic}}$. If the separation is greater, a new cluster is started.\n    e.  The total number of clusters, $N_{\\text{res}}$, is the count of resolvable spectral features. This process is applied to both the unpadded and padded spectra.\n\n### Case-by-Case Results\n\nThis procedure is executed for the three specified test cases.\n\n-   **Case 1 (Typical Separation)**: $f_2 - f_1 = 5 \\times \\Delta f_{\\text{intrinsic}} \\approx 48.83$ Hz. The frequencies are well separated. The analysis correctly identifies two distinct peaks in both the unpadded and padded spectra. We expect $N_{\\text{res}}^{(0)} = 2$ and $N_{\\text{res}}^{(\\text{pad})} = 2$.\n\n-   **Case 2 (Rayleigh-like Boundary)**: $f_2 - f_1 = \\Delta f_{\\text{intrinsic}} \\approx 9.77$ Hz. The frequencies are separated by exactly the intrinsic resolution limit. The spectral features (sinc functions) overlap significantly, but a dip between the two main peaks should still be present, allowing the local maxima finder to identify two peaks. Both analyses are expected to resolve them, yielding $N_{\\text{res}}^{(0)} = 2$ and $N_{\\text{res}}^{(\\text{pad})} = 2$. The padded spectrum visually clarifies the presence of the two peaks by better sampling the continuous shape.\n\n-   **Case 3 (Sub-Resolution Separation)**: $f_2 - f_1 = 0.6 \\times \\Delta f_{\\text{intrinsic}} \\approx 5.86$ Hz. The frequencies are closer than the resolution limit. The two overlapping sinc patterns merge into a single, broader peak. The peak counting algorithm will find only one local maximum in the region of interest. Both analyses are expected to fail to resolve the two modes, yielding $N_{\\text{res}}^{(0)} = 1$ and $N_{\\text{res}}^{(\\text{pad})} = 1$. This case critically shows that zero padding, despite making the single peak's shape smoother, cannot separate the unresolvable components.\n\nThe final output will consist of the five-element list $[\\Delta f_{\\text{intrinsic}}, \\Delta f_{\\text{bin}}^{(0)}, \\Delta f_{\\text{bin}}^{(\\text{pad})}, N_{\\text{res}}^{(0)}, N_{\\text{res}}^{(\\text{pad})}]$ for each case, confirming that $N_{\\text{res}}^{(0)}$ and $N_{\\text{res}}^{(\\text{pad})}$ are identical in all scenarios, thereby validating the underlying principles.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef count_resolved_peaks(mag_spec, freq_array, delta_f_intrinsic, threshold_frac=0.2):\n    \"\"\"\n    Identifies and clusters peaks in a spectrum to count resolvable features.\n    \n    Args:\n        mag_spec (np.ndarray): The magnitude spectrum.\n        freq_array (np.ndarray): The corresponding frequency array.\n        delta_f_intrinsic (float): The intrinsic frequency resolution.\n        threshold_frac (float): Fraction of the global maximum for peak thresholding.\n        \n    Returns:\n        int: The number of resolvable peaks (clusters).\n    \"\"\"\n    if len(mag_spec)  3:\n        return 0\n\n    global_max = np.max(mag_spec)\n    if global_max == 0:\n        return 0\n    threshold = threshold_frac * global_max\n\n    # Find indices of all local maxima\n    local_max_indices = []\n    for i in range(1, len(mag_spec) - 1):\n        if mag_spec[i] > mag_spec[i-1] and mag_spec[i] > mag_spec[i+1]:\n            local_max_indices.append(i)\n\n    # Filter maxima by the amplitude threshold\n    peak_indices = [i for i in local_max_indices if mag_spec[i] > threshold]\n    \n    if not peak_indices:\n        return 0\n\n    # Get frequencies of the filtered peaks\n    peak_freqs = freq_array[peak_indices]\n    \n    # Cluster peaks based on intrinsic resolution\n    clusters = [[peak_freqs[0]]]\n    for i in range(1, len(peak_freqs)):\n        freq = peak_freqs[i]\n        # Compare with the last frequency in the last cluster\n        if freq - clusters[-1][-1]  delta_f_intrinsic:\n            clusters[-1].append(freq)\n        else:\n            # Start a new cluster\n            clusters.append([freq])\n            \n    return len(clusters)\n\ndef analyze_case(fs, N0, pad_factor, f1_base, f2_offset_factor, A1, A2, noise_stddev, seed):\n    \"\"\"\n    Performs the full analysis for a single test case.\n    \n    Args:\n        fs (float): Sampling frequency in Hz.\n        N0 (int): Number of initial samples.\n        pad_factor (int): Zero-padding factor.\n        f1_base (float): Base frequency for the first sinusoid in Hz.\n        f2_offset_factor (float): Multiplier for delta_f_intrinsic to get f2's offset.\n        A1 (float): Amplitude of the first sinusoid.\n        A2 (float): Amplitude of the second sinusoid.\n        noise_stddev (float): Standard deviation of the Gaussian noise.\n        seed (int): Seed for the random number generator.\n        \n    Returns:\n        list: A five-element list with the analysis results.\n    \"\"\"\n    # 1. Calculate intrinsic resolution and bin spacings\n    T_obs = N0 / fs\n    delta_f_intrinsic = 1.0 / T_obs\n    \n    delta_f_bin_0 = fs / N0\n    \n    N_fft = pad_factor * N0\n    delta_f_bin_pad = fs / N_fft\n\n    # Determine component frequencies for the case\n    f1 = f1_base\n    f2 = f1_base + f2_offset_factor * delta_f_intrinsic\n\n    # 2. Generate the signal\n    rng = np.random.default_rng(seed)\n    delta_t = 1.0 / fs\n    n = np.arange(N0)\n    t = n * delta_t\n    noise = rng.normal(loc=0.0, scale=noise_stddev, size=N0)\n    x = A1 * np.sin(2 * np.pi * f1 * t) + A2 * np.sin(2 * np.pi * f2 * t) + noise\n\n    # 3. Analyze unpadded spectrum\n    X0_k = fft.rfft(x)\n    mag_X0 = np.abs(X0_k)\n    freqs_0 = fft.rfftfreq(N0, d=delta_t)\n    N_res_0 = count_resolved_peaks(mag_X0, freqs_0, delta_f_intrinsic)\n\n    # 4. Analyze zero-padded spectrum\n    Xpad_k = fft.rfft(x, n=N_fft)\n    mag_Xpad = np.abs(Xpad_k)\n    freqs_pad = fft.rfftfreq(N_fft, d=delta_t)\n    N_res_pad = count_resolved_peaks(mag_Xpad, freqs_pad, delta_f_intrinsic)\n    \n    return [delta_f_intrinsic, delta_f_bin_0, delta_f_bin_pad, N_res_0, N_res_pad]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define common parameters for all test cases\n    common_params = {\n        'fs': 20000.0,\n        'N0': 2048,\n        'pad_factor': 8,\n        'A1': 1.0,\n        'A2': 1.0,\n        'noise_stddev': 0.02\n    }\n\n    # Define the specific parameters for each test case\n    test_cases = [\n        # (f1_base, f2_offset_factor, seed)\n        {'f1_base': 1200.0, 'f2_offset_factor': 5.0, 'seed': 42}, # Case 1\n        {'f1_base': 3000.0, 'f2_offset_factor': 1.0, 'seed': 43}, # Case 2\n        {'f1_base': 4500.0, 'f2_offset_factor': 0.6, 'seed': 44}  # Case 3\n    ]\n    \n    results = []\n    for case_params in test_cases:\n        # Combine common and case-specific parameters\n        params = {**common_params, **case_params}\n        res = analyze_case(**params)\n        results.append(res)\n    \n    # Format the final output string exactly as required\n    case_results_str = []\n    for case_result in results:\n        case_results_str.append(f\"[{','.join(map(str, case_result))}]\")\n    \n    final_output = f\"[{','.join(case_results_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "The principles of sampling and resolution are not just for interpreting data, but are also critical for designing stable and accurate numerical simulations. This exercise delves into the essential trade-offs when choosing a time step $\\Delta t$ for an explicit wave solver, a common task in computational fusion science. You will compare the constraint imposed by the need to resolve the highest physical frequency (the Nyquist limit) with the constraint required for numerical stability (the Courant-Friedrichs-Lewy or CFL condition), revealing how their relative importance changes with the physical regime and grid resolution .",
            "id": "4024339",
            "problem": "A one-dimensional explicit solver is used in computational fusion science and engineering to advance linear wave dynamics in a slab plasma. The domain is discretized with uniform spatial spacing $\\Delta x$ and explicit time step $\\Delta t$, giving a sampling rate $f_s = 1/\\Delta t$. To resolve the shortest wavelength corresponding to a target maximum wavenumber $k_{\\max}$, the mesh is chosen such that there are $N$ points per shortest wavelength, that is $\\Delta x = 2\\pi / (N k_{\\max})$.\n\nTwo fundamental constraints govern the choice of $\\Delta t$:\n\n- The Nyquist–Shannon sampling theorem (NSS) requires at least $2$ temporal samples per period of the fastest oscillation present, where the fastest oscillation is characterized by the maximum physical angular frequency $\\omega_{\\max}$ of the plasma model. In the nondispersive limit, one may have $\\omega(k) = c_{\\max} k$ over the resolved wavenumber band, where $c_{\\max}$ is the maximum characteristic speed (e.g., the Alfvén speed $v_A$ or ion-acoustic speed $c_s$). In contrast, in a dispersive system with an upper frequency cap, one may have $\\omega(k) \\le \\Omega_{\\max}$ with $\\Omega_{\\max}$ approximately independent of $k$ (e.g., electron cyclotron or upper-hybrid frequency).\n\n- The Courant–Friedrichs–Lewy (CFL) stability condition for explicit schemes states that information propagating at characteristic speed $c_{\\max}$ must not traverse more than one spatial cell during a single time step, implying an upper bound on $\\Delta t$ based on $\\Delta x$ and $c_{\\max}$.\n\nAssume a standard explicit scheme with Courant number threshold of order unity and consider both regimes: (i) nondispersive waves with $\\omega(k) = c_{\\max} k$ up to $k_{\\max}$, and (ii) an upper-frequency-capped regime with $\\omega(k) \\le \\Omega_{\\max}$.\n\nSelect all statements that are correct about which constraint on $\\Delta t$ (Nyquist temporal sampling versus CFL stability) is more restrictive under variations in $k_{\\max}$, $c_{\\max}$, and $N$:\n\nA. In the nondispersive regime with $\\omega(k) = c_{\\max} k$ and $N  2$, the Courant–Friedrichs–Lewy constraint on $\\Delta t$ is more restrictive than the Nyquist–Shannon temporal sampling requirement, and they coincide exactly at $N = 2$.\n\nB. In the nondispersive regime with $\\omega(k) = c_{\\max} k$ and $N = 2$, the Nyquist–Shannon temporal sampling requirement is stricter than the Courant–Friedrichs–Lewy stability constraint.\n\nC. In the upper-frequency-capped regime with $\\omega(k) \\le \\Omega_{\\max}$ independent of $k$, as $k_{\\max}$ increases (and hence $\\Delta x$ decreases at fixed $N$), the Courant–Friedrichs–Lewy constraint eventually becomes stricter than the Nyquist–Shannon temporal constraint.\n\nD. In the upper-frequency-capped regime with $\\omega(k) \\le \\Omega_{\\max}$, if $N$ is fixed and $k_{\\max}$ is sufficiently small (i.e., a coarse grid consistent with the target resolution), the Nyquist–Shannon requirement on $\\Delta t$ can dominate over the Courant–Friedrichs–Lewy constraint.\n\nE. In the nondispersive regime with fixed $k_{\\max}$ and $N$, increasing $c_{\\max}$ makes the Nyquist–Shannon constraint increasingly restrictive relative to the Courant–Friedrichs–Lewy constraint, so the dominance is controlled solely by $c_{\\max}$ and is independent of $N$ and $k_{\\max}$.",
            "solution": "### Derivation of Constraints\n\nFirst, we formalize the two constraints on the time step $\\Delta t$.\n\n1.  **Nyquist–Shannon Sampling Constraint ($\\Delta t_{\\text{NSS}}$)**\n    The theorem requires the sampling frequency $f_s$ to be at least twice the highest physical frequency $f_{\\max}$. The physical frequency is $f = \\omega/(2\\pi)$.\n    $$f_s \\ge 2 f_{\\max} \\implies \\frac{1}{\\Delta t} \\ge 2 \\frac{\\omega_{\\max}}{2\\pi} \\implies \\frac{1}{\\Delta t} \\ge \\frac{\\omega_{\\max}}{\\pi}$$\n    This gives an upper bound on $\\Delta t$:\n    $$\\Delta t \\le \\frac{\\pi}{\\omega_{\\max}}$$\n    We denote this limit as $\\Delta t_{\\text{NSS}} = \\pi/\\omega_{\\max}$.\n\n2.  **Courant–Friedrichs–Lewy Stability Constraint ($\\Delta t_{\\text{CFL}}$)**\n    The CFL condition for an explicit scheme with a characteristic speed $c_{\\max}$ and a Courant number threshold of order unity ($C \\approx 1$) is $c_{\\max} \\Delta t \\le \\Delta x$. For the strictest stability requirement, we consider the limit $C=1$.\n    $$\\Delta t \\le \\frac{\\Delta x}{c_{\\max}}$$\n    Using the given relation $\\Delta x = 2\\pi / (N k_{\\max})$, this becomes:\n    $$\\Delta t \\le \\frac{2\\pi}{N k_{\\max} c_{\\max}}$$\n    We denote this limit as $\\Delta t_{\\text{CFL}} = 2\\pi / (N k_{\\max} c_{\\max})$.\n\nThe most restrictive constraint is the one that imposes a smaller upper bound on $\\Delta t$. We must use $\\Delta t \\le \\min(\\Delta t_{\\text{NSS}}, \\Delta t_{\\text{CFL}})$. We now analyze this for the two specified regimes.\n\n### Analysis of Nondispersive Regime\nIn this regime, $\\omega(k) = c_{\\max} k$, so the maximum frequency is $\\omega_{\\max} = \\omega(k_{\\max}) = c_{\\max} k_{\\max}$.\n- The Nyquist constraint is $\\Delta t_{\\text{NSS}} = \\frac{\\pi}{\\omega_{\\max}} = \\frac{\\pi}{c_{\\max} k_{\\max}}$.\n- The CFL constraint is $\\Delta t_{\\text{CFL}} = \\frac{2\\pi}{N k_{\\max} c_{\\max}}$.\n\nTo compare them, we can take their ratio:\n$$\\frac{\\Delta t_{\\text{CFL}}}{\\Delta t_{\\text{NSS}}} = \\frac{2\\pi / (N c_{\\max} k_{\\max})}{\\pi / (c_{\\max} k_{\\max})} = \\frac{2}{N}$$\nSo, $\\Delta t_{\\text{CFL}} = \\frac{2}{N} \\Delta t_{\\text{NSS}}$.\n\nThe number of points per wavelength, $N$, must be at least $2$ to satisfy the spatial Nyquist criterion ($N \\ge 2$).\n- If $N  2$, then $2/N  1$, which implies $\\Delta t_{\\text{CFL}}  \\Delta t_{\\text{NSS}}$. The CFL constraint is more restrictive.\n- If $N = 2$ (the minimum number of points for spatial resolution), then $2/N = 1$, which implies $\\Delta t_{\\text{CFL}} = \\Delta t_{\\text{NSS}}$. The two constraints are identical.\n\n### Analysis of Upper-frequency-capped Regime\nIn this regime, $\\omega(k) \\le \\Omega_{\\max}$, so the maximum frequency is $\\omega_{\\max} = \\Omega_{\\max}$. This frequency is independent of the grid parameters $k_{\\max}$ and $N$.\n- The Nyquist constraint is $\\Delta t_{\\text{NSS}} = \\frac{\\pi}{\\Omega_{\\max}}$. This is a constant value for a given physical system.\n- The CFL constraint remains dependent on the grid: $\\Delta t_{\\text{CFL}} = \\frac{2\\pi}{N k_{\\max} c_{\\max}}$.\n\nThe CFL constraint is more restrictive than the NSS constraint if $\\Delta t_{\\text{CFL}}  \\Delta t_{\\text{NSS}}$.\n$$\\frac{2\\pi}{N k_{\\max} c_{\\max}}  \\frac{\\pi}{\\Omega_{\\max}}$$\n$$2 \\Omega_{\\max}  N k_{\\max} c_{\\max}$$\n$$k_{\\max}  \\frac{2 \\Omega_{\\max}}{N c_{\\max}}$$\nConversely, the NSS constraint is more restrictive if $k_{\\max}  \\frac{2 \\Omega_{\\max}}{N c_{\\max}}$.\n\n### Option-by-Option Evaluation\n\n**A. In the nondispersive regime with $\\omega(k) = c_{\\max} k$ and $N  2$, the Courant–Friedrichs–Lewy constraint on $\\Delta t$ is more restrictive than the Nyquist–Shannon temporal sampling requirement, and they coincide exactly at $N = 2$.**\nOur analysis of the nondispersive regime showed that $\\Delta t_{\\text{CFL}} = (2/N) \\Delta t_{\\text{NSS}}$. If $N2$, then $\\Delta t_{\\text{CFL}}  \\Delta t_{\\text{NSS}}$, meaning the CFL constraint requires a smaller time step and is thus more restrictive. If $N=2$, then $\\Delta t_{\\text{CFL}} = \\Delta t_{\\text{NSS}}$, so the constraints coincide. The statement is fully consistent with our derivation.\n**Verdict: Correct**\n\n**B. In the nondispersive regime with $\\omega(k) = c_{\\max} k$ and $N = 2$, the Nyquist–Shannon temporal sampling requirement is stricter than the Courant–Friedrichs–Lewy stability constraint.**\nAs shown for option A, when $N = 2$, we have $\\Delta t_{\\text{CFL}} = \\Delta t_{\\text{NSS}}$. The two constraints are equally strict. The statement that one is stricter than the other is false.\n**Verdict: Incorrect**\n\n**C. In the upper-frequency-capped regime with $\\omega(k) \\le \\Omega_{\\max}$ independent of $k$, as $k_{\\max}$ increases (and hence $\\Delta x$ decreases at fixed $N$), the Courant–Friedrichs–Lewy constraint eventually becomes stricter than the Nyquist–Shannon temporal constraint.**\nIn this regime, $\\Delta t_{\\text{NSS}} = \\pi/\\Omega_{\\max}$ is constant with respect to $k_{\\max}$. The CFL limit is $\\Delta t_{\\text{CFL}} = 2\\pi / (N k_{\\max} c_{\\max})$, which is proportional to $1/k_{\\max}$. As $k_{\\max}$ increases, $\\Delta t_{\\text{CFL}}$ decreases. Since $\\Delta t_{\\text{NSS}}$ is a fixed positive value, for a sufficiently large $k_{\\max}$, it is guaranteed that $\\Delta t_{\\text{CFL}}$ will become smaller than $\\Delta t_{\\text{NSS}}$. Thus, the CFL constraint eventually becomes the more restrictive one.\n**Verdict: Correct**\n\n**D. In the upper-frequency-capped regime with $\\omega(k) \\le \\Omega_{\\max}$, if $N$ is fixed and $k_{\\max}$ is sufficiently small (i.e., a coarse grid consistent with the target resolution), the Nyquist–Shannon requirement on $\\Delta t$ can dominate over the Courant–Friedrichs–Lewy constraint.**\nThe NSS requirement dominates if $\\Delta t_{\\text{NSS}}  \\Delta t_{\\text{CFL}}$. Our analysis of this regime showed this condition is equivalent to $k_{\\max}  2\\Omega_{\\max} / (N c_{\\max})$. Since the right-hand side of this inequality is a finite positive value (assuming physically meaningful parameters), it is always possible to choose a \"sufficiently small\" $k_{\\max}$ that satisfies this condition. A small $k_{\\max}$ corresponds to resolving only long wavelengths, which means a coarse grid. In such a case, the time step is limited by the need to resolve the fast physical oscillation $\\Omega_{\\max}$, not by the CFL condition which allows a large $\\Delta t$ for a large $\\Delta x$.\n**Verdict: Correct**\n\n**E. In the nondispersive regime with fixed $k_{\\max}$ and $N$, increasing $c_{\\max}$ makes the Nyquist–Shannon constraint increasingly restrictive relative to the Courant–Friedrichs–Lewy constraint, so the dominance is controlled solely by $c_{\\max}$ and is independent of $N$ and $k_{\\max}$.**\nIn the nondispersive regime, we found the ratio of the constraint limits is $\\Delta t_{\\text{CFL}} / \\Delta t_{\\text{NSS}} = 2/N$. This ratio is independent of $c_{\\max}$ and $k_{\\max}$. Therefore, the relative restrictiveness of the two constraints does not change as $c_{\\max}$ increases. The dominance is controlled solely by $N$. The statement claims the opposite, that dominance is controlled by $c_{\\max}$ and independent of $N$. This is false.\n**Verdict: Incorrect**\n\nSummary of correct statements: A, C, and D.",
            "answer": "$$\\boxed{ACD}$$"
        }
    ]
}