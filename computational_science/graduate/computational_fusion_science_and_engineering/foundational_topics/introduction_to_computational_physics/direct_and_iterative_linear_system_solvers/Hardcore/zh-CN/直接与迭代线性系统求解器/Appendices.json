{
    "hands_on_practices": [
        {
            "introduction": "区块高斯-赛德尔（Block Gauss-Seidel, BGS）方法是处理区块结构系统的一种主力求解器与平滑算子，这类系统在如磁流体动力学（MHD）等多物理场问题中十分常见。本练习将提供实现BGS算法的动手经验，更重要的是，它将引导你探索区块排序对收敛性的关键影响——这是处理非对称系统时一个核心的实践考量。",
            "id": "3967020",
            "problem": "考虑一个围绕均匀背景态的电阻磁流体动力学 (MHD) 线性化，这会产生一个关于速度、磁场和压力增量的块耦合代数系统。设未知量为向量 $x = [u \\;|\\; p \\;|\\; b]^{\\top}$，其中 $u \\in \\mathbb{R}^{n_u}$ 是离散速度，$p \\in \\mathbb{R}^{n_p}$ 是离散压力，$b \\in \\mathbb{R}^{n_b}$ 是离散磁场。该线性系统具有如下块结构：\n$$\nA x = f, \\quad \nA = \n\\begin{bmatrix}\nA_{uu}  G^{\\top}  A_{ub} \\\\\nG  -\\beta I_{p}  0 \\\\\nA_{bu}  0  A_{bb}\n\\end{bmatrix},\n$$\n其中 $A_{uu}$ 是离散黏性算子，$A_{bb}$ 是离散电阻（磁扩散）算子，$G$ 是离散梯度/散度耦合，$A_{ub}$ 表示从磁场到动量的洛伦兹力耦合，$A_{bu}$ 表示从速度到磁场的感应耦合。这里，$I_p$ 表示大小为 $n_p \\times n_p$ 的单位矩阵，$\\beta  0$ 是一个压力稳定化参数，用以确保与 $p$ 相关的块是可逆的。为了本次计算练习的目的，该系统是无量纲的。\n\n您将按以下方式构造这些块：\n- 设 $n_u = 4$，$n_p = 2$，$n_b = 4$，且 $n = n_u + n_p + n_b$。\n- 定义一维 Dirichlet 离散拉普拉斯算子 $L_m \\in \\mathbb{R}^{m \\times m}$ 如下：\n$$\nL_m = \\frac{1}{h^2}\n\\begin{bmatrix}\n2  -1   \\\\\n-1  2  -1  \\\\\n \\ddots  \\ddots  \\ddots \\\\\n  -1  2\n\\end{bmatrix}, \\quad h = \\frac{1}{m+1}.\n$$\n- 定义 $A_{uu} = \\mu I_{u} + \\nu L_{n_u}$ 和 $A_{bb} = \\sigma I_{b} + \\eta L_{n_b}$，其中 $I_u$ 和 $I_b$ 分别是大小为 $n_u \\times n_u$ 和 $n_b \\times n_b$ 的单位矩阵。参数 $\\mu, \\nu, \\sigma, \\eta  0$ 反映了类质量正则化和扩散系数。\n- 定义一个固定的离散梯度/散度耦合 $G \\in \\mathbb{R}^{n_p \\times n_u}$ 如下：\n$$\nG =\n\\begin{bmatrix}\n1  -1  0  0 \\\\\n0  1  -1  0\n\\end{bmatrix}.\n$$\n- 通过两个秩一-项构造一个确定性的低秩耦合 $S \\in \\mathbb{R}^{n_u \\times n_b}$。设\n$$\nU_1 = \\begin{bmatrix} 1 \\\\ -1 \\\\ 1 \\\\ -1 \\end{bmatrix}, \\quad\nU_2 = \\begin{bmatrix} \\tfrac{1}{2} \\\\ \\tfrac{1}{2} \\\\ -\\tfrac{1}{2} \\\\ -\\tfrac{1}{2} \\end{bmatrix}, \\quad\nV_1 = \\begin{bmatrix} 1 \\\\ 0 \\\\ -1 \\\\ 0 \\end{bmatrix}, \\quad\nV_2 = \\begin{bmatrix} \\tfrac{1}{2} \\\\ -\\tfrac{1}{2} \\\\ \\tfrac{1}{2} \\\\ -\\tfrac{1}{2} \\end{bmatrix},\n$$\n并设置\n$$\nS = U_1 V_1^{\\top} + U_2 V_2^{\\top}.\n$$\n定义 $A_{ub} = c S$ 和 $A_{bu} = -c S^{\\top}$，其中 $c \\ge 0$ 是一个耦合强度参数。\n\n设右端项为 $f = \\mathbf{1} \\in \\mathbb{R}^{n}$（一个全为 1 的向量）。考虑推广到块的经典 Gauss-Seidel (GS) 方法：对于一个选定的块排序，遍历这些块，并对每个块 $i$ 精确求解对角块系统\n$$\nA_{ii} x_i^{(k+1)} = b_i - \\sum_{j  i} A_{ij} x_j^{(k+1)} - \\sum_{j  i} A_{ij} x_j^{(k)},\n$$\n其中求和项对排序中较早的块使用更新值，对较晚的块使用旧值。这定义了从 $x^{(0)} = 0$ 开始的块 Gauss-Seidel 迭代 $x^{(k)}$。磁流体动力学 (MHD) 耦合可能使整个矩阵 $A$ 变为非对称和不定的，因此不保证收敛，且收敛性取决于耦合强度和块排序。\n\n您的任务：\n1. 为两种块排序 $(u,p,b)$ 和 $(b,u,p)$ 实现块 Gauss-Seidel 方法。\n2. 对于测试套件中的每种排序和每组参数，进行迭代，直到相对残差范数\n$$\n\\frac{\\lVert f - A x^{(k)} \\rVert_2}{\\lVert f \\rVert_2}\n$$\n低于 $10^{-10}$，或达到 1000 次迭代的上限。对向量使用欧几里得范数。\n3. 对每种排序，返回满足容差所需的迭代次数。如果方法在迭代限制内未能收敛，则对该排序返回 $-1$。\n4. 此外，在您的实现中，为每种排序构造块 Gauss-Seidel 迭代矩阵，方法是构建块下三角加对角部分并计算谱半径（特征值中的最大绝对值），以评估其是否能预测收敛。此评估是您内部计算和讨论的一部分；最终输出应仅包含如下指定的迭代次数。\n\n测试套件：\n使用以下三组参数集，它们探索了不同的物理机制：\n- 情况 1（磁扩散快于黏性扩散，弱耦合）：$\\mu = 0.1$, $\\nu = 0.5$, $\\sigma = 0.1$, $\\eta = 2.0$, $\\beta = 10.0$, $c = 0.05$。\n- 情况 2（平衡扩散，中等耦合）：$\\mu = 0.1$, $\\nu = 0.5$, $\\sigma = 0.1$, $\\eta = 0.5$, $\\beta = 10.0$, $c = 0.2$。\n- 情况 3（磁扩散慢于黏性扩散，强耦合）：$\\mu = 0.1$, $\\nu = 0.5$, $\\sigma = 0.1$, $\\eta = 0.1$, $\\beta = 10.0$, $c = 0.8$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含六个用方括号括起来的整数，顺序如下：\n$$\n[\\text{iters}_{(u,p,b),\\text{Case1}}, \\text{iters}_{(b,u,p),\\text{Case1}}, \\text{iters}_{(u,p,b),\\text{Case2}}, \\text{iters}_{(b,u,p),\\text{Case2}}, \\text{iters}_{(u,p,b),\\text{Case3}}, \\text{iters}_{(b,u,p),\\text{Case3}}].\n$$\n如果某次运行在迭代限制内未收敛，相应的条目必须为 $-1$。不涉及物理单位；所有量均为无量纲。此问题不涉及角度。",
            "solution": "该问题要求在一个线性化的电阻磁流体动力学 (MHD) 系统上，为两种不同的块排序实现并比较块 Gauss-Seidel (BGS) 迭代方法。任务的核心是根据其组成块构造系统矩阵，为指定的排序实现 BGS 迭代，并在一系列测试案例中评估其收敛性能。\n\n首先，我们构造代数系统 $A x = f$。未知向量为 $x = [u \\;|\\; p \\;|\\; b]^{\\top}$，划分为速度 $u \\in \\mathbb{R}^{n_u}$、压力 $p \\in \\mathbb{R}^{n_p}$ 和磁场 $b \\in \\mathbb{R}^{n_b}$，其维度分别为 $n_u=4$、$n_p=2$ 和 $n_b=4$。系统的总规模为 $n = n_u + n_p + n_b = 10$。右端项是一个全为 1 的向量，$f = \\mathbf{1} \\in \\mathbb{R}^{10}$。\n\n系统矩阵 $A$ 是一个 $3 \\times 3$ 的块矩阵：\n$$\nA = \n\\begin{bmatrix}\nA_{uu}  G^{\\top}  A_{ub} \\\\\nG  -\\beta I_{p}  0 \\\\\nA_{bu}  0  A_{bb}\n\\end{bmatrix}\n$$\n各个块的构造如下：\n一维离散拉普拉斯算子 $L_m \\in \\mathbb{R}^{m \\times m}$ 对扩散项至关重要。其定义为：\n$$\nL_m = \\frac{1}{h^2}\n\\begin{bmatrix}\n2  -1   \\\\\n-1  2  -1  \\\\\n \\ddots  \\ddots  \\ddots \\\\\n  -1  2\n\\end{bmatrix}, \\quad \\text{其中 } h = \\frac{1}{m+1}\n$$\n对角块 $A_{uu}$ 和 $A_{bb}$ 分别表示黏性扩散和磁扩散，并带有类质量正则化项。它们由下式给出：\n$$\nA_{uu} = \\mu I_{u} + \\nu L_{n_u} \\quad \\text{和} \\quad A_{bb} = \\sigma I_{b} + \\eta L_{n_b}\n$$\n其中 $I_u$ 和 $I_b$ 是适当大小的单位矩阵，且 $\\mu, \\nu, \\sigma, \\eta  0$。由于 $L_m$ 是对称正定 (SPD) 矩阵且参数为正，所以 $A_{uu}$ 和 $A_{bb}$ 都是对称正定且因此可逆。压力块为 $-\\beta I_p$，当 $\\beta  0$ 时也是可逆的。\n\n速度-压力耦合由固定的离散梯度/散度矩阵 $G \\in \\mathbb{R}^{2 \\times 4}$ 给出：\n$$\nG =\n\\begin{bmatrix}\n1  -1  0  0 \\\\\n0  1  -1  0\n\\end{bmatrix}\n$$\n速度-磁场耦合块 $A_{ub}$ (洛伦兹力) 和 $A_{bu}$ (感应) 是使用指定的向量 $U_1, U_2, V_1, V_2$ 从低秩矩阵 $S = U_1 V_1^{\\top} + U_2 V_2^{\\top}$ 构造的。这些块是 $A_{ub} = c S$ 和 $A_{bu} = -c S^{\\top}$，其中 $c \\ge 0$ 是耦合强度参数。请注意，$A_{bu} \\ne A_{ub}^{\\top}$，这使得整个矩阵 $A$ 非对称。\n\n块 Gauss-Seidel 方法是一种基于矩阵 $A$ 分裂的迭代求解器，该矩阵被分裂为其块对角、严格块下三角和严格块上三角部分，分别记为 $D$、$-L$ 和 $-U$，使得 $A = D - L - U$。迭代公式如下：\n$$\n(D-L) x^{(k+1)} = U x^{(k)} + f\n$$\n$D$、$L$ 和 $U$ 的结构取决于所选的块排序。我们将分析两种指定的排序。\n\n**排序 1：$(u, p, b)$**\n这是问题陈述中的自然排序。$A$ 的块分量是：\n$$\nD = \\begin{bmatrix} A_{uu}  0  0 \\\\ 0  -\\beta I_p  0 \\\\ 0  0  A_{bb} \\end{bmatrix}, \\quad\nL = \\begin{bmatrix} 0  0  0 \\\\ -G  0  0 \\\\ -A_{bu}  0  0 \\end{bmatrix}, \\quad\nU = \\begin{bmatrix} 0  -G^{\\top}  -A_{ub} \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}\n$$\n从 $x^{(0)}=0$ 开始，用于求解 $x^{(k+1)} = [u^{(k+1)} \\;|\\; p^{(k+1)} \\;|\\; b^{(k+1)}]^{\\top}$ 的 BGS 迭代按以下步骤进行：\n1. 求解 $u^{(k+1)}$：使用 $p$ 和 $b$ 的最新值，即来自第 $k$ 步的值。\n   $$A_{uu} u^{(k+1)} = f_u - G^{\\top} p^{(k)} - A_{ub} b^{(k)}$$\n2. 求解 $p^{(k+1)}$：使用新计算出的 $u^{(k+1)}$。\n   $$(-\\beta I_p) p^{(k+1)} = f_p - G u^{(k+1)} \\implies p^{(k+1)} = \\frac{1}{\\beta}(G u^{(k+1)} - f_p)$$\n3. 求解 $b^{(k+1)}$：使用新计算出的 $u^{(k+1)}$。\n   $$A_{bb} b^{(k+1)} = f_b - A_{bu} u^{(k+1)}$$\n由于 $A_{uu}$ 和 $A_{bb}$ 是可逆的，步骤 1 和 3 中的线性系统被精确求解。\n\n**排序 2：$(b, u, p)$**\n这种排序对应于对原始系统进行置换。设 $x'=[b \\;|\\; u \\;|\\; p]^{\\top}$。置换后的系统 $A'x' = f'$ 是：\n$$\nA' = \n\\begin{bmatrix}\nA_{bb}  A_{bu}  0 \\\\\nA_{ub}  A_{uu}  G^{\\top} \\\\\n0  G  -\\beta I_{p}\n\\end{bmatrix}, \\quad\nf' = \\begin{bmatrix} f_b \\\\ f_u \\\\ f_p \\end{bmatrix}\n$$\n$A'$ 的块分裂为：\n$$\nD' = \\begin{bmatrix} A_{bb}  0  0 \\\\ 0  A_{uu}  0 \\\\ 0  0  -\\beta I_p \\end{bmatrix}, \\quad\nL' = \\begin{bmatrix} 0  0  0 \\\\ -A_{ub}  0  0 \\\\ 0  -G  0 \\end{bmatrix}, \\quad\nU' = \\begin{bmatrix} 0  -A_{bu}  0 \\\\ 0  0  -G^{\\top} \\\\ 0  0  0 \\end{bmatrix}\n$$\n此排序的 BGS 迭代是：\n1. 求解 $b^{(k+1)}$：使用旧值 $u^{(k)}$。\n   $$A_{bb} b^{(k+1)} = f_b - A_{bu} u^{(k)}$$\n2. 求解 $u^{(k+1)}$：使用新的 $b^{(k+1)}$ 和旧的 $p^{(k)}$。\n   $$A_{uu} u^{(k+1)} = f_u - A_{ub} b^{(k+1)} - G^{\\top} p^{(k)}$$\n3. 求解 $p^{(k+1)}$：使用新的 $u^{(k+1)}$。\n   $$(-\\beta I_p) p^{(k+1)} = f_p - G u^{(k+1)} \\implies p^{(k+1)} = \\frac{1}{\\beta}(G u^{(k+1)} - f_p)$$\n\n对于两种排序，该过程都从 $x^{(0)}=0$ 开始重复进行，直到相对残差范数 $\\frac{\\lVert f - A x^{(k)} \\rVert_2}{\\lVert f \\rVert_2}$ 小于容差 $10^{-10}$，或达到 1000 次迭代的上限。如果未达到收敛，则报告迭代次数为 $-1$。\n\nBGS 的收敛性由其迭代矩阵 $M = (D-L)^{-1}U$ 的谱半径 $\\rho$ 决定。如果 $\\rho  1$，则该方法保证收敛。MHD 系统的非对称性和不定性意味着 $\\rho$ 可能大于或等于 $1$，特别是在强耦合（大 $c$）的情况下。块排序的选择会改变迭代矩阵及其谱半径，这可以将一个发散的方法变为一个收敛的方法。对于此问题，数值检验证实，对于最强耦合情况（情况 3），$(u,p,b)$ 排序的谱半径大于 $1$，而 $(b,u,p)$ 排序的谱半径小于 $1$，这预测了前者的发散和后者的收敛。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are imported.\n\ndef solve():\n    \"\"\"\n    Solves the resistive MHD problem using Block Gauss-Seidel for two orderings\n    across three test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (magnetic diffusion faster than viscous diffusion, weak coupling)\n        {'mu': 0.1, 'nu': 0.5, 'sigma': 0.1, 'eta': 2.0, 'beta': 10.0, 'c': 0.05},\n        # Case 2 (balanced diffusion, moderate coupling)\n        {'mu': 0.1, 'nu': 0.5, 'sigma': 0.1, 'eta': 0.5, 'beta': 10.0, 'c': 0.2},\n        # Case 3 (magnetic diffusion slower than viscous diffusion, strong coupling)\n        {'mu': 0.1, 'nu': 0.5, 'sigma': 0.1, 'eta': 0.1, 'beta': 10.0, 'c': 0.8},\n    ]\n\n    results = []\n    \n    # --- Problem constants and setup ---\n    n_u, n_p, n_b = 4, 2, 4\n    n = n_u + n_p + n_b\n    tol = 1e-10\n    max_iter = 1000\n    \n    # Slices for block access\n    s_u = slice(0, n_u)\n    s_p = slice(n_u, n_u + n_p)\n    s_b = slice(n_u + n_p, n)\n\n    # --- Fixed matrix constructions ---\n    def construct_L(m):\n        h = 1.0 / (m + 1)\n        L = np.zeros((m, m))\n        np.fill_diagonal(L, 2.0)\n        np.fill_diagonal(L[1:], -1.0)\n        np.fill_diagonal(L[:, 1:], -1.0)\n        return L / (h**2)\n\n    U1 = np.array([1, -1, 1, -1]).reshape(-1, 1)\n    U2 = np.array([0.5, 0.5, -0.5, -0.5]).reshape(-1, 1)\n    V1 = np.array([1, 0, -1, 0]).reshape(-1, 1)\n    V2 = np.array([0.5, -0.5, 0.5, -0.5]).reshape(-1, 1)\n    S = U1 @ V1.T + U2 @ V2.T\n\n    G = np.array([\n        [1, -1, 0, 0],\n        [0, 1, -1, 0]\n    ])\n\n    f = np.ones(n)\n    f_norm = np.linalg.norm(f)\n\n    # --- Main loop over test cases ---\n    for params in test_cases:\n        mu, nu, sigma, eta, beta, c = params.values()\n\n        # Construct parameter-dependent matrices\n        L_nu = construct_L(n_u)\n        L_nb = construct_L(n_b)\n        \n        A_uu = mu * np.identity(n_u) + nu * L_nu\n        A_bb = sigma * np.identity(n_b) + eta * L_nb\n        A_ub = c * S\n        A_bu = -c * S.T\n        \n        # Assemble full matrix A for residual calculation\n        A = np.zeros((n, n))\n        A[s_u, s_u] = A_uu\n        A[s_p, s_u] = G\n        A[s_u, s_p] = G.T\n        A[s_p, s_p] = -beta * np.identity(n_p)\n        A[s_b, s_b] = A_bb\n        A[s_u, s_b] = A_ub\n        A[s_b, s_u] = A_bu\n\n        # --- Ordering (u, p, b) ---\n        u = np.zeros(n_u)\n        p = np.zeros(n_p)\n        b = np.zeros(n_b)\n        \n        iters_upb = -1\n        for k in range(max_iter):\n            # Update u\n            rhs_u = f[s_u] - G.T @ p - A_ub @ b\n            u_new = np.linalg.solve(A_uu, rhs_u)\n            \n            # Update p\n            rhs_p = f[s_p] - G @ u_new\n            p_new = -(1.0/beta) * rhs_p\n            \n            # Update b\n            rhs_b = f[s_b] - A_bu @ u_new\n            b_new = np.linalg.solve(A_bb, rhs_b)\n\n            u, p, b = u_new, p_new, b_new\n            \n            x_k = np.concatenate((u, p, b))\n            rel_res = np.linalg.norm(f - A @ x_k) / f_norm\n            \n            if rel_res  tol:\n                iters_upb = k + 1\n                break\n        \n        results.append(iters_upb)\n\n        # --- Ordering (b, u, p) ---\n        u = np.zeros(n_u)\n        p = np.zeros(n_p)\n        b = np.zeros(n_b)\n\n        iters_bup = -1\n        for k in range(max_iter):\n            # Update b\n            rhs_b = f[s_b] - A_bu @ u\n            b_new = np.linalg.solve(A_bb, rhs_b)\n\n            # Update u\n            rhs_u = f[s_u] - A_ub @ b_new - G.T @ p\n            u_new = np.linalg.solve(A_uu, rhs_u)\n\n            # Update p\n            rhs_p = f[s_p] - G @ u_new\n            p_new = -(1.0/beta) * rhs_p\n\n            u, p, b = u_new, p_new, b_new\n\n            x_k = np.concatenate((u, p, b))\n            rel_res = np.linalg.norm(f - A @ x_k) / f_norm\n            \n            if rel_res  tol:\n                iters_bup = k + 1\n                break\n        \n        results.append(iters_bup)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基本实现后，我们转向策略性思考。共轭梯度（Conjugate Gradient, CG）法是求解对称正定（SPD）系统的最优迭代方法，这类系统通常源于类似扩散的物理过程。本思想实验旨在挑战你诊断CG性能不佳的一个常见原因——由物理各向异性和网格各向异性导致的病态问题——并选择一种合适的预处理策略（对称对角缩放）来恢复收敛性，同时强调了保持CG方法所需数学性质的重要性。",
            "id": "3967060",
            "problem": "在计算聚变科学中，一次环形磁约束模拟通过对一个各向异性扩散算子进行曲线有限元离散化，生成了一个线性系统 $A x = b$。物理扩散张量为 $D(\\mathbf{x}) = \\chi_{\\parallel} \\,\\mathbf{b}(\\mathbf{x}) \\mathbf{b}(\\mathbf{x})^{\\top} + \\chi_{\\perp} \\,(\\mathbf{I} - \\mathbf{b}(\\mathbf{x}) \\mathbf{b}(\\mathbf{x})^{\\top})$，其中 $\\mathbf{b}(\\mathbf{x})$ 是单位磁场方向，$\\chi_{\\parallel}/\\chi_{\\perp} \\approx 10^{6}$，并且网格映射 $\\mathbf{x}(\\boldsymbol{\\xi})$ 的度量张量为 $G(\\mathbf{x}) = J(\\boldsymbol{\\xi})^{\\top} J(\\boldsymbol{\\xi})$，其特征值之比 $\\lambda_{\\max}(G)/\\lambda_{\\min}(G) \\approx 10^{3}$。组装后的刚度矩阵 $A$ 是对称正定的 (SPD)，其元素为\n$$\nA_{ij} = \\int_{\\Omega} \\left(\\nabla \\phi_{i}(\\mathbf{x})\\right)^{\\top} D(\\mathbf{x}) \\,\\nabla \\phi_{j}(\\mathbf{x}) \\, d\\Omega,\n$$\n其中 $\\{\\phi_{i}\\}$ 是标准有限元基函数。由于网格表现出与 $\\mathbf{b}(\\mathbf{x})$ 对齐的强度量各向异性，矩阵 $A$ 的谱分布很广，导致共轭梯度 (CG) 法在没有预处理的情况下收敛缓慢。\n\n从关于 SPD 矩阵、特征值以及谱条件数与 CG 收敛性之间关系的核心事实出发，分析各向异性及度量系数如何影响 $A$ 的特征值分布。然后，选择一种策略，该策略能通过缩放最直接地产生特征值聚集，通过减小有效条件数来改善收敛性，并保留共轭梯度 (CG) 法的数学要求。\n\n哪一个选项最合适？\n\nA. 使用 $H = \\operatorname{diag}(A)$ 进行对称对角缩放，构建缩放后的系统 $\\tilde{A} = H^{-1/2} A H^{-1/2}$，用 CG 求解 $\\tilde{x}$，然后通过 $x = H^{-1/2} \\tilde{x}$ 映射回原解。\n\nB. 仅使用 $S = \\operatorname{diag}(A)$ 进行左行缩放得到 $\\tilde{A} = S^{-1} A$，并直接在 $\\tilde{A}$ 上运行 CG。\n\nC. 按平行电导率进行全局缩放，在运行 CG 前将 $A$ 替换为 $\\tilde{A} = \\chi_{\\parallel}^{-1} A$。\n\nD. 使用零填充不完全 LU 分解 (ILU($0$)) 作为 CG 的预处理器，因为 LU 因子可以平衡系统并聚集特征值。",
            "solution": "### 推导\n\n该问题涉及求解线性系统 $A x = b$，其中矩阵 $A$ 是对称正定的 (SPD)，由各向异性扩散算子 $-\\nabla \\cdot (D(\\mathbf{x}) \\nabla u)$ 的有限元离散化产生。对于此类系统，共轭梯度 (CG) 法的收敛速度主要由矩阵的谱条件数 $\\kappa(A) = \\lambda_{\\max}(A) / \\lambda_{\\min}(A)$ 决定，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是 $A$ 的最大和最小特征值。达到特定容差所需的迭代次数近似与 $\\sqrt{\\kappa(A)}$ 成正比。大的条件数对应于广泛的特征值分布，会导致收敛缓慢。\n\n问题陈述指出 $A$ 的病态性源于两个方面：\n1.  **物理各向异性**：扩散张量 $D(\\mathbf{x})$ 的特征值为 $\\chi_{\\parallel}$ 和 $\\chi_{\\perp}$，其比率 $\\chi_{\\parallel}/\\chi_{\\perp} \\approx 10^{6}$。物理算子中的这种极端各向异性被刚度矩阵 $A$ 所继承。\n2.  **几何各向异性**：网格单元被拉伸，其度量张量 $G$ 的特征值之比 $\\lambda_{\\max}(G)/\\lambda_{\\min}(G) \\approx 10^{3}$。\n\n这些因素导致刚度矩阵的对角元素 $A_{ii} = \\int_{\\Omega} (\\nabla\\phi_i)^\\top D (\\nabla\\phi_i) d\\Omega$ 的量级差异巨大。对角线上的这种巨大差异是导致条件数过大的主要原因。\n\n任务是选择一个策略，该策略能 (1) 使用缩放来聚集特征值，(2) 通过减小有效条件数来改善收敛性，以及 (3) 保留 CG 的数学要求。标准 CG 算法的基本要求是系统矩阵必须是对称正定的。\n\n预处理旨在将系统 $A x = b$ 转换为一个等价的系统 $\\tilde{A} \\tilde{x} = \\tilde{b}$，其中 $\\tilde{A}$ 的条件数要小得多。对于 CG，我们必须确保 $\\tilde{A}$ 保持对称正定。一个对称预处理器 $M$（其本身也是 SPD）可以用来构建一个对称预处理系统：\n$$\nM^{-1/2} A M^{-1/2} z = M^{-1/2} b, \\quad x = M^{-1/2} z\n$$\n新的系统矩阵是 $\\tilde{A} = M^{-1/2} A M^{-1/2}$，如果 $A$ 和 $M$ 都是 SPD，那么它保证是 SPD。\n\n我们现在基于这些原则来分析给定的选项。\n\n### 逐项分析\n\n**A. 使用 $H = \\operatorname{diag}(A)$ 进行对称对角缩放，构建缩放后的系统 $\\tilde{A} = H^{-1/2} A H^{-1/2}$，用 CG 求解 $\\tilde{x}$，然后通过 $x = H^{-1/2} \\tilde{x}$ 映射回原解。**\n\n该方法使用对角矩阵 $H = \\operatorname{diag}(A)$ 作为预处理器 $M$。由于 $A$ 是 SPD，其对角元素 $A_{ii}$ 均为正，因此 $H$ 是 SPD，其平方根 $H^{1/2} = \\operatorname{diag}(\\sqrt{A_{ii}})$ 是良定义且为实数。预处理后的矩阵是 $\\tilde{A} = H^{-1/2} A H^{-1/2}$。这是一种对称预处理方案。得到的矩阵 $\\tilde{A}$ 是 SPD 的，因此适用于 CG 方法。\n$\\tilde{A}$ 的元素是 $\\tilde{A}_{ij} = A_{ij} / \\sqrt{A_{ii} A_{jj}}$。关键在于，其对角元素为 $\\tilde{A}_{ii} = A_{ii} / \\sqrt{A_{ii} A_{ii}} = 1$。这种被称为雅可比预处理的方法，通过将 $A$ 的对角元素归一化为 1，直接解决了其对角元素差异巨大的问题。它是一种“缩放”方法，试图将特征值聚集在 1 附近，从而减小有效条件数并改善 CG 收敛性。它满足了题干的所有三个要求：它是一种缩放方法，能改善条件数，并为 CG 保留了 SPD 属性。\n- 结论：**正确**。\n\n**B. 仅使用 $S = \\operatorname{diag}(A)$ 进行左行缩放得到 $\\tilde{A} = S^{-1} A$，并直接在 $\\tilde{A}$ 上运行 CG。**\n\n该方法将系统转换为 $S^{-1} A x = S^{-1} b$。新矩阵为 $\\tilde{A} = S^{-1} A$。虽然 $A$ 是对称的，但 $S^{-1}$（一个对角矩阵）和 $A$ 通常不交换。因此，乘积 $\\tilde{A} = S^{-1} A$ 通常是**非对称的**。标准的共轭梯度算法是为对称正定系统定义的。将其应用于非对称矩阵在数学上是无效的，很可能无法收敛或产生错误的解。要解非对称系统，需要使用不同的迭代方法，如 GMRES 或 BiCGSTAB。该选项明确违反了“保留共轭梯度 (CG) 法的数学要求”这一规定。\n- 结论：**不正确**。\n\n**C. 按平行电导率进行全局缩放，在运行 CG 前将 $A$ 替换为 $\\tilde{A} = \\chi_{\\parallel}^{-1} A$。**\n\n此操作将整个矩阵 $A$ 乘以一个单一的恒定标量值 $c = \\chi_{\\parallel}^{-1}$。新矩阵为 $\\tilde{A} = cA$。如果 $\\lambda$ 是 $A$ 的一个特征值，那么 $c\\lambda$ 是 $\\tilde{A}$ 的一个特征值。新矩阵的条件数为：\n$$\n\\kappa(\\tilde{A}) = \\frac{\\lambda_{\\max}(\\tilde{A})}{\\lambda_{\\min}(\\tilde{A})} = \\frac{c \\cdot \\lambda_{\\max}(A)}{c \\cdot \\lambda_{\\min}(A)} = \\frac{\\lambda_{\\max}(A)}{\\lambda_{\\min}(A)} = \\kappa(A)\n$$\n全局标量乘法不会改变条件数。它只是缩放了整个特征值谱，使其相对间距保持不变。因此，它对 CG 方法的收敛速度没有影响，因为收敛速度取决于特征值分布和条件数。该策略未能“通过减小有效条件数来改善收敛性”。\n- 结论：**不正确**。\n\n**D. 使用零填充不完全 LU 分解 (ILU($0$)) 作为 CG 的预处理器，因为 LU 因子可以平衡系统并聚集特征值。**\n\nILU 分解产生一个近似 $M = \\tilde{L}\\tilde{U} \\approx A$，其中 $\\tilde{L}$ 是单位下三角矩阵，$\\tilde{U}$ 是上三角矩阵。如果用作左预处理器，系统矩阵将变为 $M^{-1}A = (\\tilde{L}\\tilde{U})^{-1}A$，这通常不是对称的。这与选项 B 一样，使其不适用于标准 CG 方法。对于 SPD 矩阵，相应的分解是不完全 Cholesky (IC) 分解，它寻找 $\\tilde{L}$ 使得 $A \\approx \\tilde{L}\\tilde{L}^T$。这将提供一个对称预处理器 $M = \\tilde{L}\\tilde{L}^T$。然而，该选项明确指定了“不完全 LU”。此外，题干要求选择一种*最直接*通过*缩放*产生聚类的方法。ILU 是一种近似逆方法，而不是对角缩放意义上的缩放方法。虽然它在许多情况下是更强大的预处理技术，但它不像选项 A 那样符合问题的具体标准。标准的 ILU($0$) 在强各向异性问题中（当网格与各向异性方向不一致时）也通常表现不佳。\n- 结论：**不正确**。\n\n### 结论\n选项 A 是唯一满足所有既定标准的选项。它是一种缩放方法，旨在通过平衡对角线来减小条件数，并使用对称预处理方法，保持了共轭梯度算法所需的 SPD 属性。",
            "answer": "$$\n\\boxed{A}\n$$"
        },
        {
            "introduction": "本章最后探讨最具挑战性的一类问题：由等离子体中 $\\mathbf{E}\\times\\mathbf{B}$ 漂移等平流主导现象产生的非正规线性系统。本练习深入探讨了广义最小残差（Generalized Minimal Residual, GMRES）方法——解决此类问题的标准方法——的精妙之处。它将揭示为何简单的特征值分析会失效，伪谱（pseudospectrum）所扮演的角色，重启动GMRES中的收敛停滞问题，以及为克服这些困难而设计的先进技术。",
            "id": "3966993",
            "problem": "在一个用于托卡马克边缘磁化等离子体的漂移-动理学模型的隐式时间推进中，假设每一步都必须求解一个预处理线性系统，\n$$\nM^{-1} A x = M^{-1} b,\n$$\n其中 $A = I + \\Delta t\\,L$，$I$ 是单位矩阵，$\\Delta t  0$ 是时间步长，$L$ 是一个离散算子，主要由沿着磁通面的电场叉磁场（$\\mathbf{E}\\times\\mathbf{B}$）漂移平流主导，并带有弱的垂直碰撞扩散。由于上风格式、网格度量耦合和边界条件，$L$ 是强非正规的。预条件子 $M$ 是块对角的和基于物理的，它将 $M^{-1}A$ 的特征值聚集在 $1$ 附近，但 $M^{-1}A$ 仍然是非正规的，且具有一个趋近于 $0$ 的宽泛 $\\varepsilon$-伪谱。\n\n要求您使用带重启动的广义最小残差法 (GMRES)，记为 GMRES($m$)。回顾以下基本原理和定义：\n- GMRES 构建第 $j$ 步的克雷洛夫子空间 $\\mathcal{K}_j(M^{-1}A,r_0) = \\mathrm{span}\\{r_0,(M^{-1}A)r_0,\\dots,(M^{-1}A)^{j-1}r_0\\}$，其中 $r_0 = M^{-1}(b - A x_0)$，并选择使残差范数在 $x_0 + \\mathcal{K}_j$ 上最小的 $x_j$。\n- 等价地，$r_j = p_j(M^{-1}A)\\,r_0$，其中 $p_j$ 是一个次数至多为 $j$ 且满足 $p_j(0)=1$ 的多项式。\n- 对于非正规矩阵，仅凭特征值无法确定收敛性；$\\|p(M^{-1}A)\\|$ 的行为可能由值域和伪谱控制，即使特征值位置有利，也允许某些方向出现瞬态放大。\n\n考虑在这种情况下重启动对收敛性的影响，以及在存储克雷洛夫基向量的固定内存预算下，选择 $m$ 以平衡内存和收敛性的问题。选择所有最准确的陈述。\n\nA. 对高度非正规的 $M^{-1}A$（如离散的 $\\mathbf{E}\\times\\mathbf{B}$ 平流问题）重启动 GMRES($m$) 可能导致严重的收敛停滞，因为每个循环都将残差限制在一个次数至多为 $m$ 的多项式中；重启动导致的长多项式滤波器的丢失，使得瞬态放大的分量重新进入。增加 $m$ 会在内存允许的范围内减轻这种效应。\n\nB. 对于此类问题，GMRES($m$) 的收敛性完全由 $M^{-1}A$ 的特征值位置决定；如果它们位于开放右半平面，那么无论非正规性如何，即使对于很小的 $m$ 也会发生快速收敛。\n\nC. 可以自适应地做出对 $m$ 的平衡选择：在第一个循环中估计每循环的残差缩减因子 $\\|r^{(j+1)}\\|/\\|r^{(j)}\\|$，并增加 $m$ 直到该因子低于目标值 $\\rho1$，同时确保存储 $m$ 个长度为 $n$ 的克雷洛夫向量的内存开销（在双精度下约为 $8 n m$ 字节）在内存预算 $B$ 内；如果在预算限制下未达到目标，则用紧缩重启动或更强的预条件来增强。\n\nD. 因为离散的 $\\mathbf{E}\\times\\mathbf{B}$ 平流近似于斜对称，不带重启动的 GMRES 会有崩溃的风险，因此需要重启动来保持稳定性，并且当 $m$ 较小时实际上会改善收敛性。\n\nE. 当非正规性很强时，在重启动之间保留 $k$ 个谐波里兹向量（紧缩重启动）可以保留与慢衰减模式相关的近似不变子空间；因此，在相同的内存预算下，使用一个适中的 $m$ 和 $k \\ll m$ 可以实现良好的收敛。\n\nF. GMRES($m$) 中每次迭代的正交化成本与 $m$ 无关，因此增加 $m$ 可以在不影响每次迭代成本的情况下改善收敛性；因此，应始终选择可能的最大 $m$。",
            "solution": "该问题探讨了在计算等离子体物理中常见的、由平流主导的非正规线性系统上，使用重启动GMRES($m$)方法的复杂性。非正规矩阵的收敛行为不能仅通过其特征值来预测，而必须考虑其伪谱。GMRES通过在克雷洛夫子空间中寻找一个多项式来最小化残差范数。对于非正规问题，这通常需要一个高次多项式才能有效抑制伪谱广大区域内的残差分量，特别是那些导致瞬态增长的分量。\n\n**逐项分析**\n\n**A. 对高度非正规的 $M^{-1}A$（如离散的 $\\mathbf{E}\\times\\mathbf{B}$ 平流问题）重启动 GMRES($m$) 可能导致严重的收敛停滞，因为每个循环都将残差限制在一个次数至多为 $m$ 的多项式中；重启动导致的长多项式滤波器的丢失，使得瞬态放大的分量重新进入。增加 $m$ 会在内存允许的范围内减轻这种效应。**\n\n该陈述准确描述了重启动GMRES在非正规问题上的典型失效模式。由于重启动参数 $m$ 限制了可用多项式的最大次数，算法可能无法构建一个足够强大的“滤波器”来抑制所有慢衰减模式，尤其是那些与瞬态增长相关的模式。每次重启动都会丢弃已构建的克雷洛夫子空间，迫使算法从头开始，这会导致收敛停滞（即每个重启动周期只能取得很小的进展）。增加 $m$ 可以构建更高次的多项式，从而缓解此问题，但这会增加内存和计算成本。因此，该陈述是正确的。\n\n**B. 对于此类问题，GMRES($m$) 的收敛性完全由 $M^{-1}A$ 的特征值位置决定；如果它们位于开放右半平面，那么无论非正规性如何，即使对于很小的 $m$ 也会发生快速收敛。**\n\n该陈述是错误的。这是对非正规矩阵行为的一个经典误解。对于非正规矩阵，特征值分布本身并不能保证收敛。即使所有特征值都有利地聚集（例如远离原点），矩阵的非正规性也可能导致残差在收敛之前出现显著的瞬态增长，这需要许多GMRES迭代来克服。伪谱是预测GMRES收敛性的更可靠工具。\n\n**C. 可以自适应地做出对 $m$ 的平衡选择：在第一个循环中估计每循环的残差缩减因子 $\\|r^{(j+1)}\\|/\\|r^{(j)}\\|$，并增加 $m$ 直到该因子低于目标值 $\\rho1$，同时确保存储 $m$ 个长度为 $n$ 的克雷洛夫向量的内存开销（在双精度下约为 $8 n m$ 字节）在内存预算 $B$ 内；如果在预算限制下未达到目标，则用紧缩重启动或更强的预条件来增强。**\n\n该陈述描述了一种先进且实用的策略，用于在实践中平衡GMRES($m$)的收敛性与计算资源。它正确地识别了内存成本（每个向量需要 $8n$ 字节，总共 $8nm$ 字节），并提出了一种基于观察到的收敛因子自适应选择 $m$ 的方法。此外，它正确地指出，当简单地增加 $m$ 不足以或不可行时，应考虑更高级的技术，如紧缩重启动（见选项E）或改进预处理器。这是一种复杂的、符合工程实际的解决方案。因此，该陈述是正确的。\n\n**D. 因为离散的 $\\mathbf{E}\\times\\mathbf{B}$ 平流近似于斜对称，不带重启动的 GMRES 会有崩溃的风险，因此需要重启动来保持稳定性，并且当 $m$较小时实际上会改善收敛性。**\n\n该陈述是错误的。首先，在GMRES的Arnoldi过程中发生“崩溃”是一个特定事件，意味着找到了一个不变子空间（通常是找到了一个精确解），这不是一个需要通过重启动来避免的不稳定风险。重启动的主要目的是限制内存和计算成本。其次，认为较小的 $m$ 能改善收敛性的观点与处理非正规问题的基本原理相悖。对于非正规问题，重启动通常会损害收敛，而不是改善它。\n\n**E. 当非正规性很强时，在重启动之间保留 $k$ 个谐波里兹向量（紧缩重启动）可以保留与慢衰减模式相关的近似不变子空间；因此，在相同的内存预算下，使用一个适中的 $m$ 和 $k \\ll m$ 可以实现良好的收敛。**\n\n该陈述准确地描述了GMRES-DR（带紧缩重启动的GMRES）或GCROT等高级技术背后的思想。这些方法通过保留先前循环中计算出的谐波里兹向量（它们是逼近与最小模特征值相关的特征向量的良好近似），来“增强”克雷洛夫子空间。这使得算法能够“记住”关于慢衰减模式的信息，避免在每个重启动周期中重新学习它们。这通常能够以较小的重启动参数 $m$ 实现比标准GMRES($m$) 快得多的收敛。因此，该陈述是正确的。\n\n**F. GMRES($m$) 中每次迭代的正交化成本与 $m$ 无关，因此增加 $m$ 可以在不影响每次迭代成本的情况下改善收敛性；因此，应始终选择可能的最大 $m$。**\n\n该陈述是错误的。在GMRES($m$)的一个循环中，第 $j$ 次迭代（$j=1, \\dots, m$）需要将新向量与所有 $j$ 个先前的基向量正交化。这通常使用修正的格拉姆-施密特过程完成，其计算成本与 $j$ 成正比。因此，在一个重启动周期内，每次迭代的成本会增加，总成本与 $m^2$ 成正比（不包括矩阵向量乘法）。因此，增加 $m$ 会显著增加每次迭代的平均成本和总循环成本。选择 $m$ 是收敛速度与计算资源之间的权衡，而不是一个可以无成本增加的参数。\n\n**最终结论**\n陈述A、C和E准确地描述了在非正规系统上使用GMRES($m$)所面临的挑战、实用的应对策略以及更先进的解决方案。",
            "answer": "$$\\boxed{ACE}$$"
        }
    ]
}