{
    "hands_on_practices": [
        {
            "introduction": "Beyond direct solutions, the momentum equations in a rotating frame give rise to powerful conservation principles that govern the evolution of geophysical flows. This foundational exercise guides you through the derivation of one of the most important of these principles: shallow-water Potential Vorticity (PV) . By applying this conservation law, you will explore the profound dynamic link between the stretching of a fluid column and its resulting change in relative vorticity, a key mechanism in the behavior of large-scale ocean eddies and atmospheric weather systems.",
            "id": "3815711",
            "problem": "Consider an inviscid, single-layer shallow-water ocean on an $f$-plane with constant Coriolis parameter $f$ in a rotating frame. A material fluid column is identified, and its horizontal flow is described by the momentum equations in a rotating frame and by mass conservation. There is no external torque, no frictional stress, and no diabatic effects. The free-surface displacement is permitted to adjust internally, but there is no external forcing. The column initially has layer thickness $h_0$ and relative vorticity $\\zeta_0$. Over a short time interval, the column experiences a purely vertical stretching such that its thickness becomes $h_1 = \\lambda h_0$, where $\\lambda > 0$ is a prescribed factor, without any external torque acting during this process.\n\nStarting from the fundamental laws appropriate to this context—Newton’s second law in a rotating frame for horizontal momentum, and mass conservation for the layer—derive the materially conserved scalar built from absolute vorticity and layer thickness that is relevant to the shallow-water dynamics. Use this derivation to compute the analytic expression for the change in potential vorticity (PV), denoted $\\Delta q = q_1 - q_0$, when the column stretches by the factor $\\lambda$ as described, and then determine the final relative vorticity $\\zeta_1$ in terms of $\\lambda$, $\\zeta_0$, and $f$. Express your final answer as a two-component row matrix containing, in order, the value of $\\Delta q$ and the expression for $\\zeta_1$. Additionally, deduce the sign of the change in relative vorticity in the Northern Hemisphere.\n\nNo numerical approximation is required; provide exact analytic expressions. If you introduce angles in any intermediate reasoning, express them in radians. Units need not be included in the final expressions.",
            "solution": "The problem requires the derivation of the conserved quantity known as potential vorticity (PV) for a single-layer shallow-water system on an $f$-plane, and then the application of this conservation principle to determine the change in PV and the final relative vorticity of a fluid column undergoing vertical stretching.\n\nThe fundamental laws governing the system are the horizontal momentum equations for an inviscid fluid in a rotating frame and the mass conservation equation for the fluid layer.\n\nThe horizontal momentum equations are:\n$$\n\\frac{Du}{Dt} - fv = -g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{Dv}{Dt} + fu = -g \\frac{\\partial \\eta}{\\partial y}\n$$\nwhere $\\mathbf{u} = (u,v)$ is the horizontal velocity vector, $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$ is the material derivative, $f$ is the constant Coriolis parameter, $g$ is the acceleration due to gravity, and $\\eta$ is the free-surface elevation.\n\nThe mass conservation equation, or continuity equation, for a shallow-water layer of thickness $h$ is:\n$$\n\\frac{\\partial h}{\\partial t} + \\nabla \\cdot (h\\mathbf{u}) = 0\n$$\nThis can be expanded as $\\frac{\\partial h}{\\partial t} + \\mathbf{u} \\cdot \\nabla h + h(\\nabla \\cdot \\mathbf{u}) = 0$, which can be expressed using the material derivative as:\n$$\n\\frac{Dh}{Dt} + h (\\nabla \\cdot \\mathbf{u}) = 0\n$$\nRearranging this equation gives a relationship for the horizontal divergence, $\\nabla \\cdot \\mathbf{u}$:\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{h}\\frac{Dh}{Dt}\n$$\n\nNext, we derive the vorticity equation. The vertical component of relative vorticity is defined as $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$. We take the curl of the momentum equations by taking $\\frac{\\partial}{\\partial x}$ of the $v$-equation and subtracting $\\frac{\\partial}{\\partial y}$ of the $u$-equation. The pressure gradient terms (involving $g\\eta$) cancel out, yielding:\n$$\n\\frac{D}{Dt}\\left(\\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\\right) + (\\zeta + f) \\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0\n$$\nIn terms of $\\zeta$ and the horizontal divergence $\\nabla \\cdot \\mathbf{u}$, this is:\n$$\n\\frac{D\\zeta}{Dt} + (\\zeta + f)(\\nabla \\cdot \\mathbf{u}) = 0\n$$\nSince $f$ is a constant on an $f$-plane, its material derivative is zero, $\\frac{Df}{Dt} = 0$. Thus, we can write the equation in terms of the absolute vorticity, $\\omega_a = \\zeta + f$:\n$$\n\\frac{D(\\zeta+f)}{Dt} + (\\zeta + f)(\\nabla \\cdot \\mathbf{u}) = 0\n$$\n\nNow we combine the continuity and vorticity equations. From the vorticity equation, we have:\n$$\n\\frac{D(\\zeta+f)}{Dt} = -(\\zeta + f)(\\nabla \\cdot \\mathbf{u})\n$$\nSubstituting the expression for $\\nabla \\cdot \\mathbf{u}$ from the rearranged continuity equation:\n$$\n\\frac{D(\\zeta+f)}{Dt} = -(\\zeta + f)\\left(-\\frac{1}{h}\\frac{Dh}{Dt}\\right) = \\frac{\\zeta + f}{h}\\frac{Dh}{Dt}\n$$\nRearranging this equation gives:\n$$\n\\frac{1}{\\zeta+f}\\frac{D(\\zeta+f)}{Dt} - \\frac{1}{h}\\frac{Dh}{Dt} = 0\n$$\nThis can be written as the material derivative of a logarithmic expression:\n$$\n\\frac{D}{Dt}\\left( \\ln(\\zeta+f) \\right) - \\frac{D}{Dt}\\left( \\ln(h) \\right) = 0\n$$\n$$\n\\frac{D}{Dt}\\left( \\ln\\left(\\frac{\\zeta+f}{h}\\right) \\right) = 0\n$$\nThis equation signifies that the quantity $\\ln\\left(\\frac{\\zeta+f}{h}\\right)$ is conserved following a fluid parcel. Consequently, the quantity itself, which we define as the shallow-water potential vorticity $q$, is materially conserved.\n$$\nq = \\frac{\\zeta+f}{h}\n$$\nThus, $\\frac{Dq}{Dt} = 0$. This is the materially conserved scalar built from absolute vorticity and layer thickness, as requested.\n\nThe problem states that a fluid column with initial potential vorticity $q_0$ evolves to a state with final potential vorticity $q_1$. Because potential vorticity is materially conserved for this fluid column, we must have $q_1 = q_0$. The change in potential vorticity, $\\Delta q$, is therefore:\n$$\n\\Delta q = q_1 - q_0 = 0\n$$\n\nNext, we use this conservation law to find the final relative vorticity $\\zeta_1$. The initial and final states are related by:\n$$\nq_0 = \\frac{\\zeta_0 + f}{h_0} \\quad \\text{and} \\quad q_1 = \\frac{\\zeta_1 + f}{h_1}\n$$\nSetting $q_1 = q_0$:\n$$\n\\frac{\\zeta_1 + f}{h_1} = \\frac{\\zeta_0 + f}{h_0}\n$$\nWe are given that the column is stretched such that its new thickness is $h_1 = \\lambda h_0$. Substituting this into the equation:\n$$\n\\frac{\\zeta_1 + f}{\\lambda h_0} = \\frac{\\zeta_0 + f}{h_0}\n$$\nWe can cancel $h_0$ (since $h_0 > 0$) and solve for $\\zeta_1$:\n$$\n\\zeta_1 + f = \\lambda (\\zeta_0 + f)\n$$\n$$\n\\zeta_1 = \\lambda (\\zeta_0 + f) - f\n$$\n$$\n\\zeta_1 = \\lambda \\zeta_0 + (\\lambda - 1)f\n$$\nThis is the expression for the final relative vorticity.\n\nFinally, we deduce the sign of the change in relative vorticity, $\\Delta \\zeta = \\zeta_1 - \\zeta_0$.\n$$\n\\Delta \\zeta = (\\lambda \\zeta_0 + (\\lambda - 1)f) - \\zeta_0 = (\\lambda - 1)\\zeta_0 + (\\lambda - 1)f\n$$\n$$\n\\Delta \\zeta = (\\lambda - 1)(\\zeta_0 + f)\n$$\nIn the Northern Hemisphere, the Coriolis parameter $f$ is positive ($f > 0$). For large-scale geophysical flows, the magnitude of relative vorticity is typically much smaller than the planetary vorticity, i.e., $|\\zeta_0| \\ll |f|$. Therefore, the absolute vorticity, $\\zeta_0 + f$, is positive in the Northern Hemisphere. The problem describes a \"vertical stretching,\" which implies the column becomes taller, so $h_1 > h_0$, which means the factor $\\lambda > 1$. Consequently, the term $(\\lambda - 1)$ is also positive. The change in relative vorticity, $\\Delta \\zeta$, is the product of two positive terms:\n$$\n\\Delta \\zeta = \\underbrace{(\\lambda - 1)}_{>0} \\underbrace{(\\zeta_0 + f)}_{>0} > 0\n$$\nThus, the change in relative vorticity is positive in the Northern Hemisphere. The stretching of the water column causes it to spin up in the same direction as the planetary rotation (cyclonically).\n\nThe final answer requires a two-component row matrix containing $\\Delta q$ and the expression for $\\zeta_1$.\nThe first component is $\\Delta q = 0$.\nThe second component is $\\zeta_1 = \\lambda \\zeta_0 + (\\lambda - 1)f$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & \\lambda \\zeta_0 + (\\lambda - 1)f \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While the vast ocean interior is often in a near-geostrophic balance, friction, driven by viscosity, becomes a dominant force in the boundary layers near the surface and seafloor. This practice challenges you to use scale analysis—a critical tool for any fluid dynamicist—to probe the structure of the turbulent Ekman boundary layer . You will derive its characteristic thickness from first principles and establish a criterion for when nonlinear advective effects, often neglected in textbook solutions, become important.",
            "id": "3815728",
            "problem": "Consider an incompressible, homogeneous, Newtonian ocean boundary layer adjacent to a flat surface, viewed in a frame rotating with Earth's angular velocity. Let the horizontal velocity field be $\\boldsymbol{u}=(u,v)$, the vertical coordinate be $z$ positive upward, the constant kinematic viscosity be $\\nu$, and the constant Coriolis parameter be $f>0$. Assume a statistically steady Ekman Boundary Layer (EBL) driven by a geostrophically balanced interior flow whose horizontal speed is of order $U$, and suppose horizontal property variations occur over a horizontal length scale $L$. \n\nStarting from Newton's second law per unit mass in the rotating frame, write the horizontal momentum equations, and use them as the fundamental base for a scale analysis appropriate to the EBL in which vertical viscous diffusion dominates over horizontal viscous diffusion. Under steady conditions, justify the leading-order balance that sets the vertical decay scale of the EBL and derive, without invoking shortcut formulas, the characteristic EBL thickness $\\delta_{E}$ by seeking a vertically decaying solution consistent with the steady rotating balance between Coriolis acceleration and vertical viscous diffusion. \n\nUsing the resulting $\\delta_{E}$, form the nondimensional ratio of the horizontal nonlinear advection magnitude $(U^{2}/L)$ to the vertical viscous diffusion magnitude $\\left(\\nu U/\\delta_{E}^{2}\\right)$, and from the criterion that this ratio equals unity, obtain a closed-form expression for the critical speed $U_{\\mathrm{crit}}$ at which nonlinear advection becomes as important as vertical viscous diffusion in the EBL.\n\nFinally, evaluate $U_{\\mathrm{crit}}$ for the scientifically plausible parameter values $f=1.03\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $L=1.80\\times 10^{4}\\ \\mathrm{m}$, and $\\nu=0.20\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$. Report the numerical value of $U_{\\mathrm{crit}}$ in $\\mathrm{m}\\ \\mathrm{s}^{-1}$ and round your answer to four significant figures.",
            "solution": "The user wants me to solve the following problem:\n\"Consider an incompressible, homogeneous, Newtonian ocean boundary layer adjacent to a flat surface, viewed in a frame rotating with Earth's angular velocity. Let the horizontal velocity field be $\\boldsymbol{u}=(u,v)$, the vertical coordinate be $z$ positive upward, the constant kinematic viscosity be $\\nu$, and the constant Coriolis parameter be $f>0$. Assume a statistically steady Ekman Boundary Layer (EBL) driven by a geostrophically balanced interior flow whose horizontal speed is of order $U$, and suppose horizontal property variations occur over a horizontal length scale $L$.\n\nStarting from Newton's second law per unit mass in the rotating frame, write the horizontal momentum equations, and use them as the fundamental base for a scale analysis appropriate to the EBL in which vertical viscous diffusion dominates over horizontal viscous diffusion. Under steady conditions, justify the leading-order balance that sets the vertical decay scale of the EBL and derive, without invoking shortcut formulas, the characteristic EBL thickness $\\delta_E$ from a decaying solution.\n\nUsing the resulting $\\delta_{E}$, form a non-dimensional ratio of a horizontal nonlinear advection magnitude ($U^2/L$) to a vertical viscous diffusion magnitude ($\\nu U/\\delta_E^2$).\n\nFrom the criterion that this ratio equals unity, obtain a closed-form expression for a critical speed $U_{\\text{crit}}$ at which nonlinear advection becomes as important as vertical viscous diffusion in the EBL.\n\nFinally, evaluate $U_{\\text{crit}}$ for $f=1.03\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $L=1.80\\times 10^{4}\\ \\mathrm{m}$, and $\\nu=0.20\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$.\nReport the numerical value of $U_{\\text{crit}}$ in $\\mathrm{m}\\ \\mathrm{s}^{-1}$ and round your answer to four significant figures.\"\n\nThe starting point is Newton's second law per unit mass for a homogeneous, incompressible fluid in a rotating reference frame, also known as the momentum equation component of the Navier-Stokes equations. The horizontal components are:\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} + w \\frac{\\partial u}{\\partial z} - fv = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + \\nu \\left( \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} + \\frac{\\partial^2 u}{\\partial z^2} \\right)\n$$\n$$\n\\frac{\\partial v}{\\partial t} + u \\frac{\\partial v}{\\partial x} + v \\frac{\\partial v}{\\partial y} + w \\frac{\\partial v}{\\partial z} + fu = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} + \\nu \\left( \\frac{\\partial^2 v}{\\partial x^2} + \\frac{\\partial^2 v}{\\partial y^2} + \\frac{\\partial^2 v}{\\partial z^2} \\right)\n$$\nHere, $\\boldsymbol{v}=(u,v,w)$ is the velocity vector, $p$ is the pressure, $\\rho$ is the constant density, and $f$ is the Coriolis parameter.\n\nWe apply the conditions given in the problem. The flow is \"statistically steady,\" so we set the time derivatives to zero: $\\frac{\\partial u}{\\partial t} = 0$, $\\frac{\\partial v}{\\partial t} = 0$.\nThe problem states that the flow is driven by a geostrophically balanced interior flow, $(u_g, v_g)$, which exists outside the boundary layer. For this interior flow, friction is negligible, and the balance is:\n$$\n-fv_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\n$$\n$$\nfu_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y}\n$$\nAssuming a homogeneous fluid, the Taylor-Proudman theorem implies that these horizontal pressure gradients are independent of the vertical coordinate $z$. Thus, we can substitute these into the full momentum equations.\n\nThe problem also states that for the EBL, vertical viscous diffusion dominates over horizontal viscous diffusion. This means terms like $\\nu \\frac{\\partial^2 u}{\\partial z^2}$ are much larger than $\\nu \\frac{\\partial^2 u}{\\partial x^2}$ and $\\nu \\frac{\\partial^2 u}{\\partial y^2}$. The simplified steady-state horizontal momentum equations become:\n$$\nu \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} + w \\frac{\\partial u}{\\partial z} - fv = -fv_g + \\nu \\frac{\\partial^2 u}{\\partial z^2}\n$$\n$$\nu \\frac{\\partial v}{\\partial x} + v \\frac{\\partial v}{\\partial y} + w \\frac{\\partial v}{\\partial z} + fu = fu_g + \\nu \\frac{\\partial^2 v}{\\partial z^2}\n$$\nRearranging these gives:\n$$\nu \\frac{\\partial u}{\\partial x} + v \\frac{\\partial u}{\\partial y} + w \\frac{\\partial u}{\\partial z} - f(v-v_g) = \\nu \\frac{\\partial^2 u}{\\partial z^2}\n$$\n$$\nu \\frac{\\partial v}{\\partial x} + v \\frac{\\partial v}{\\partial y} + w \\frac{\\partial v}{\\partial z} + f(u-u_g) = \\nu \\frac{\\partial^2 v}{\\partial z^2}\n$$\nThe classical Ekman layer solution is derived under the assumption of a small Rossby number, which means the nonlinear advection terms (on the left-hand side) are negligible compared to the Coriolis and viscous terms. The problem directs us to find the leading-order balance that sets the vertical decay scale, which is this linear balance. Dropping the advection terms yields the steady, linear EBL equations:\n$$\n-f(v-v_g) = \\nu \\frac{\\partial^2 u}{\\partial z^2}\n$$\n$$\nf(u-u_g) = \\nu \\frac{\\partial^2 v}{\\partial z^2}\n$$\nThis is the \"steady rotating balance between Coriolis acceleration and vertical viscous diffusion\" requested.\n\nTo derive the EBL thickness $\\delta_E$, we solve this system. We define a complex velocity deviation from geostrophy, $W(z) = (u - u_g) + i(v - v_g)$. The geostrophic velocities $u_g$ and $v_g$ are constant with respect to $z$. We can write the second derivative of $W$ as $\\frac{\\partial^2 W}{\\partial z^2} = \\frac{\\partial^2 u}{\\partial z^2} + i\\frac{\\partial^2 v}{\\partial z^2}$.\nUsing the balance equations, we substitute for the second derivatives:\n$$\n\\nu \\frac{\\partial^2 W}{\\partial z^2} = \\nu \\frac{\\partial^2 u}{\\partial z^2} + i \\nu \\frac{\\partial^2 v}{\\partial z^2} = -f(v-v_g) + i f(u-u_g) = if [ (u-u_g) + i(v-v_g) ] = ifW\n$$\nThis gives the second-order ordinary differential equation:\n$$\n\\frac{d^2 W}{d z^2} = \\frac{if}{\\nu} W\n$$\nThe characteristic equation is $k^2 = \\frac{if}{\\nu}$. The roots are $k = \\pm\\sqrt{\\frac{if}{\\nu}}$. Since $\\sqrt{i} = \\frac{1+i}{\\sqrt{2}}$, the roots are:\n$$\nk = \\pm \\sqrt{\\frac{f}{\\nu}} \\frac{1+i}{\\sqrt{2}} = \\pm \\left( \\sqrt{\\frac{f}{2\\nu}} + i\\sqrt{\\frac{f}{2\\nu}} \\right)\n$$\nThe general solution is $W(z) = C_1 \\exp(k_1 z) + C_2 \\exp(k_2 z)$, where $k_1$ has a positive real part and $k_2$ has a negative real part. The boundary conditions for the EBL are:\n1.  No-slip at the surface ($z=0$): $u=0, v=0$. This implies $W(0) = (0-u_g) + i(0-v_g) = -(u_g + iv_g)$.\n2.  Far from the boundary ($z \\to \\infty$), the flow approaches the geostrophic interior flow: $u \\to u_g, v \\to v_g$. This implies $W(z) \\to 0$ as $z \\to \\infty$.\n\nFor $W(z)$ to decay to zero as $z \\to \\infty$, we must discard the solution that grows exponentially. The term with the positive real part in the exponent, $\\exp(\\sqrt{f/2\\nu} \\cdot z)$, must be eliminated, so we set its coefficient $C_1=0$. The physically relevant solution is:\n$$\nW(z) = C_2 \\exp\\left(-\\sqrt{\\frac{f}{2\\nu}}(1+i)z\\right) = C_2 \\exp\\left(-\\sqrt{\\frac{f}{2\\nu}}z\\right) \\exp\\left(-i\\sqrt{\\frac{f}{2\\nu}}z\\right)\n$$\nThe solution decays exponentially with increasing $z$. The characteristic vertical decay scale (or e-folding depth) is the value of $z$ at which the argument of the real exponential becomes $-1$. This is conventionally defined as the Ekman depth, $\\delta_E$.\n$$\n\\sqrt{\\frac{f}{2\\nu}} z = 1 \\quad \\implies \\quad z = \\sqrt{\\frac{2\\nu}{f}}\n$$\nThus, the characteristic EBL thickness is $\\delta_E = \\sqrt{\\frac{2\\nu}{f}}$.\n\nNext, we form the nondimensional ratio of the horizontal nonlinear advection magnitude to the vertical viscous diffusion magnitude, as specified:\n$$\n\\mathcal{R} = \\frac{\\text{Horizontal nonlinear advection magnitude}}{\\text{Vertical viscous diffusion magnitude}} = \\frac{U^2/L}{\\nu U / \\delta_E^2}\n$$\nSimplifying this expression, we get:\n$$\n\\mathcal{R} = \\frac{U^2}{L} \\cdot \\frac{\\delta_E^2}{\\nu U} = \\frac{U \\delta_E^2}{L \\nu}\n$$\nNow, we substitute our derived expression for $\\delta_E^2 = \\left(\\sqrt{\\frac{2\\nu}{f}}\\right)^2 = \\frac{2\\nu}{f}$:\n$$\n\\mathcal{R} = \\frac{U}{L \\nu} \\left( \\frac{2\\nu}{f} \\right) = \\frac{2U\\nu}{fL\\nu} = \\frac{2U}{fL}\n$$\nThis ratio is twice the Rossby number, $Ro = U/(fL)$. The critical speed $U_{\\mathrm{crit}}$ is defined as the speed $U$ at which this ratio equals unity.\n$$\n\\frac{2U_{\\mathrm{crit}}}{fL} = 1\n$$\nSolving for $U_{\\mathrm{crit}}$, we obtain the closed-form expression:\n$$\nU_{\\mathrm{crit}} = \\frac{fL}{2}\n$$\nNotably, the critical speed is independent of the kinematic viscosity $\\nu$.\n\nFinally, we evaluate $U_{\\mathrm{crit}}$ using the given parameter values:\n$f=1.03\\times 10^{-4}\\ \\mathrm{s}^{-1}$\n$L=1.80\\times 10^{4}\\ \\mathrm{m}$\n$$\nU_{\\mathrm{crit}} = \\frac{(1.03 \\times 10^{-4}\\ \\mathrm{s}^{-1}) (1.80 \\times 10^{4}\\ \\mathrm{m})}{2}\n$$\n$$\nU_{\\mathrm{crit}} = \\frac{1.03 \\times 1.80}{2}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}\n$$\n$$\nU_{\\mathrm{crit}} = \\frac{1.854}{2}\\ \\mathrm{m}\\ \\mathrm{s}^{-1} = 0.927\\ \\mathrm{m}\\ \\mathrm{s}^{-1}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nU_{\\mathrm{crit}} = 0.9270\\ \\mathrm{m}\\ \\mathrm{s}^{-1}\n$$",
            "answer": "$$\n\\boxed{0.9270}\n$$"
        },
        {
            "introduction": "A primary task in computational oceanography is to initialize numerical models with physically consistent and balanced fields. This hands-on coding exercise requires you to translate the two most fundamental steady-state approximations of the momentum equations—hydrostatic and geostrophic balance—into a working numerical algorithm . By constructing pressure and velocity fields from raw density and sea surface height data, you will gain practical experience with the core numerical techniques that underpin modern ocean general circulation models.",
            "id": "3815721",
            "problem": "You are tasked with constructing geostrophically balanced three-dimensional velocity fields from prescribed density and sea surface height by consistently enforcing the hydrostatic and geostrophic relations that arise from the momentum equations in a rotating frame. Your derivation and algorithm must begin from first principles appropriate to computational oceanography and must not rely on shortcut formulas provided in this statement.\n\nStart with Newton’s Second Law in a rotating frame applied to a Boussinesq fluid, where the effect of planetary rotation is represented by the Coriolis acceleration. The fundamental base is the following: the material derivative $D\\boldsymbol{u}/Dt$, the gravitational acceleration $g$, the pressure $p$, the density $\\rho$, the reference density $\\rho_0$, and the Coriolis parameter $f$ defined from Earth’s rotation. Under the hydrostatic approximation, the vertical momentum balance reduces to the hydrostatic relation that ties the vertical pressure gradient to the local density. In large-scale, slowly varying flows, the horizontal momentum balance reduces to geostrophic balance between the Coriolis acceleration and the horizontal pressure gradient.\n\nYour program must:\n- Discretize a rectangular ocean domain with horizontal coordinates $x$ and $y$ and vertical coordinate $z$ (positive upward), with $x \\in [0,L_x]$, $y \\in [0,L_y]$, and $z \\in [-H,0]$. Use uniform grids with $N_x$, $N_y$, and $N_z$ points, respectively. You must set $L_x = 10^5\\ \\mathrm{m}$, $L_y = 10^5\\ \\mathrm{m}$, $H = 10^3\\ \\mathrm{m}$, $N_x = 64$, $N_y = 64$, and $N_z = 80$.\n- Assume the gravitational acceleration $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$ and the reference density $\\rho_0 = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$. Set atmospheric pressure at the sea surface to zero for convenience, which does not affect horizontal pressure gradients.\n- Impose periodic boundary conditions in the horizontal directions for computing horizontal derivatives. Use second-order centered differences for horizontal derivatives and for vertical derivatives in the interior (ignore vertical boundary points when computing vertical derivative-based residuals).\n\nYou are provided with horizontally varying density anomalies superimposed on a stable stratification, and a prescribed Sea Surface Height (SSH). For each test case, define the density field $\\rho(x,y,z)$ and SSH $\\eta(x,y)$ as follows:\n- Let the stratification be linear with depth: $\\rho_\\mathrm{strat}(z) = \\rho_0 + s(-z)$ with $s > 0$ constant.\n- Let the horizontal density anomaly be $\\rho_\\mathrm{anom}(x,y,z) = b \\cos\\!\\left(2\\pi x/L_x\\right)\\cos\\!\\left(2\\pi y/L_y\\right)\\exp\\!\\left(z/H_s\\right)$ with $b$ the anomaly amplitude and $H_s$ a vertical decay scale.\n- The full density is $\\rho(x,y,z) = \\rho_\\mathrm{strat}(z) + \\rho_\\mathrm{anom}(x,y,z)$.\n- The SSH field is $\\eta(x,y) = A_\\eta \\sin\\!\\left(2\\pi y/L_y\\right) + B_\\eta \\cos\\!\\left(2\\pi x/L_x\\right)$.\n\nUse the hydrostatic relation to construct the pressure field $p(x,y,z)$ throughout the water column from the upper boundary condition at $z=0$ (in the small-amplitude limit, the sea surface pressure anomaly due to SSH is represented by a barotropic contribution): $p(x,y,0) = \\rho_0 g \\eta(x,y)$, and enforce the vertical balance $+\\partial p/\\partial z + \\rho g = 0$ in discrete form. Then, on each horizontal level, enforce geostrophic balance between the Coriolis acceleration and the horizontal pressure gradient, with the Coriolis parameter (CP) $f$ specified in each test case. Construct horizontally non-divergent geostrophic velocities $\\boldsymbol{u}(x,y,z) = (u(x,y,z), v(x,y,z))$ consistent with the horizontal pressure gradients obtained from your hydrostatic reconstruction. You must not introduce any frictional or ageostrophic terms.\n\nTo quantify the consistency of your construction, compute the following residuals:\n- The hydrostatic residual\n$$\nr_h = \\max_{x,y,z\\ \\text{(interior in }z\\text{)}} \\left| \\frac{\\partial p}{\\partial z} + \\rho g \\right| \\Big/ \\rho_0,\n$$\nwhich has units of $\\mathrm{m}\\ \\mathrm{s}^{-2}$.\n- The geostrophic residual\n$$\nr_g = \\max_{x,y,z} \\left\\{ \\left[ -f v + \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} \\right]^2 + \\left[ f u + \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} \\right]^2 \\right\\}^{1/2},\n$$\nwhich also has units of $\\mathrm{m}\\ \\mathrm{s}^{-2}$.\n\nFor each test case, report the single scalar\n$$\nr = \\max(r_h, r_g),\n$$\nexpressed in $\\mathrm{m}\\ \\mathrm{s}^{-2}$.\n\nImplement your solution on the following four-test suite. Each tuple lists $(f, s, b, H_s, A_\\eta, B_\\eta)$ with units $(\\mathrm{s}^{-1}, \\mathrm{kg}\\ \\mathrm{m}^{-4}, \\mathrm{kg}\\ \\mathrm{m}^{-3}, \\mathrm{m}, \\mathrm{m}, \\mathrm{m})$:\n1. Mid-latitude mixed baroclinic-barotropic case: $(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.20, 500, 0.15, 0.10)$.\n2. Barotropic-only forcing case (horizontally uniform density, nonzero SSH gradients): $(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.00, 500, 0.20, 0.00)$.\n3. Near-equatorial case (small $f$): $(1.0\\times 10^{-6}, 5.0\\times 10^{-4}, 0.10, 300, 0.05, 0.15)$.\n4. Uniform fields case (no horizontal gradients): $(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.00, 500, 0.00, 0.00)$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$, where each $\\text{result}_i$ is the value of $r$ for the corresponding test case, expressed in $\\mathrm{m}\\ \\mathrm{s}^{-2}$.",
            "solution": "The problem requires the construction of geostrophically and hydrostatically balanced velocity fields from specified density and sea surface height fields in a discretized rectangular ocean domain. The consistency of the numerical construction is to be evaluated by computing hydrostatic and geostrophic residuals.\n\nThe governing physics is founded on a simplified form of the momentum equations for a Boussinesq fluid in a rotating frame of reference. For large-scale, slowly varying oceanic flows, the vertical momentum equation reduces to the hydrostatic balance, and the horizontal momentum equations reduce to the geostrophic balance.\n\nThe hydrostatic balance relates the vertical pressure gradient to the local fluid density $\\rho$ and gravitational acceleration $g$:\n$$\n\\frac{\\partial p}{\\partial z} = -g\\rho\n$$\nHere, $p$ is the pressure and $z$ is the vertical coordinate, positive upwards.\n\nThe geostrophic balance relates the horizontal velocity components, $(u, v)$, to the horizontal pressure gradients and the Coriolis parameter $f$. Under the Boussinesq approximation, where density variations are neglected in the inertia terms, this balance is expressed as:\n$$\n-f v = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\n$$\n$$\nf u = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial y}\n$$\nwhere $\\rho_0$ is a constant reference density. These equations can be rearranged to solve for the velocity components:\n$$\nu(x,y,z) = -\\frac{1}{\\rho_0 f} \\frac{\\partial p}{\\partial y}\n$$\n$$\nv(x,y,z) = \\frac{1}{\\rho_0 f} \\frac{\\partial p}{\\partial x}\n$$\n\nThe solution algorithm proceeds in a constructive sequence, translating these continuous equations into a discrete numerical implementation.\n\n**1. Domain Discretization and Field Initialization**\n\nThe domain is a rectangular box defined by $x \\in [0, L_x]$, $y \\in [0, L_y]$, and $z \\in [-H, 0]$. This domain is discretized using a uniform grid with $N_x, N_y, N_z$ points. The grid spacings are $\\Delta x = L_x / N_x$, $\\Delta y = L_y / N_y$, and $\\Delta z = H / (N_z - 1)$. The grid coordinates are:\n- $x_i = i \\Delta x$ for $i=0, \\dots, N_x-1$\n- $y_j = j \\Delta y$ for $j=0, \\dots, N_y-1$\n- $z_k = -H + k \\Delta z$ for $k=0, \\dots, N_z-1$\n\nOn this grid, the density field $\\rho(x,y,z)$ and sea surface height $\\eta(x,y)$ are defined for each test case according to the provided formulas:\n$$\n\\rho(x_i, y_j, z_k) = (\\rho_0 - s z_k) + b \\cos\\!\\left(\\frac{2\\pi x_i}{L_x}\\right)\\cos\\!\\left(\\frac{2\\pi y_j}{L_y}\\right)\\exp\\!\\left(\\frac{z_k}{H_s}\\right)\n$$\n$$\n\\eta(x_i, y_j) = A_\\eta \\sin\\!\\left(\\frac{2\\pi y_j}{L_y}\\right) + B_\\eta \\cos\\!\\left(\\frac{2\\pi x_i}{L_x}\\right)\n$$\n\n**2. Hydrostatic Pressure Reconstruction**\n\nThe pressure field $p(x,y,z)$ is computed by integrating the hydrostatic equation downwards from the sea surface. The pressure at the surface ($z=0$, corresponding to index $k=N_z-1$) is determined by the sea surface height anomaly $\\eta(x,y)$, representing the barotropic pressure contribution:\n$$\np(x_i, y_j, z_{N_z-1}) = \\rho_0 g \\eta(x_i, y_j)\n$$\nWe integrate the equation $\\partial p / \\partial z = -g\\rho$ from the surface downwards. Discretizing the integral $\\int_{z_k}^{z_{k+1}} dp = \\int_{z_k}^{z_{k+1}} (-g\\rho) dz'$ using the second-order accurate trapezoidal rule gives:\n$$\np_{k+1} - p_k = -g \\frac{\\rho_{k+1} + \\rho_k}{2} (z_{k+1} - z_k) = -g \\frac{\\rho_{k+1} + \\rho_k}{2} \\Delta z\n$$\nRearranging to compute pressure at level $k$ from the level $k+1$ above it yields the iterative formula:\n$$\np_{i,j,k} = p_{i,j,k+1} + \\frac{g \\Delta z}{2} \\left[ \\rho_{i,j,k+1} + \\rho_{i,j,k} \\right]\n$$\nThis calculation is performed for $k$ from $N_z-2$ down to $0$, filling the entire 3D pressure field.\n\n**3. Geostrophic Velocity Calculation**\n\nWith the pressure field established, the horizontal velocity components $(u,v)$ are computed from the geostrophic relations. The horizontal pressure gradients are approximated using second-order central differences. Given the periodic boundary conditions in the $x$ and $y$ directions, the discrete derivatives are:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j,k} = \\frac{p_{i+1, j, k} - p_{i-1, j, k}}{2\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j,k} = \\frac{p_{i, j+1, k} - p_{i, j-1, k}}{2\\Delta y}\n$$\nThe indices are handled periodically, e.g., $p_{-1,j,k} = p_{N_x-1,j,k}$ and $p_{N_x,j,k} = p_{0,j,k}$. The geostrophic velocities at each grid point are then:\n$$\nu_{i,j,k} = -\\frac{1}{\\rho_0 f} \\frac{p_{i,j+1,k} - p_{i,j-1,k}}{2\\Delta y}\n$$\n$$\nv_{i,j,k} = \\frac{1}{\\rho_0 f} \\frac{p_{i+1,j,k} - p_{i-1,j,k}}{2\\Delta x}\n$$\nThese computations are performed at all grid points $(i, j, k)$.\n\n**4. Residual Calculation**\n\nFinally, we quantify the consistency of our numerical scheme by calculating two residuals.\n\nThe hydrostatic residual, $r_h$, measures how well the computed pressure field satisfies the hydrostatic equation when the derivative is computed using a different stencil (centered difference) from the integration scheme (trapezoidal rule). It is computed on the interior vertical levels ($k=1, \\dots, N_z-2$):\n$$\n\\left(\\frac{\\partial p}{\\partial z}\\right)_{i,j,k}^{\\text{CD}} = \\frac{p_{i,j,k+1} - p_{i,j,k-1}}{2\\Delta z}\n$$\n$$\nr_h = \\max_{i,j,k \\in \\text{interior}} \\left| \\frac{p_{i,j,k+1} - p_{i,j,k-1}}{2\\Delta z} + g \\rho_{i,j,k} \\right| \\Big{/} \\rho_0\n$$\nThe non-zero value of this residual is a direct measure of the truncation error, which is expected to be proportional to $\\Delta z^2$ and the second vertical derivative of the density field.\n\nThe geostrophic residual, $r_g$, measures how well the computed velocities and pressure field satisfy the geostrophic balance.\n$$\nr_g = \\max_{i,j,k} \\left\\{ \\left[ -f v_{i,j,k} + \\frac{1}{\\rho_0}\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j,k} \\right]^2 + \\left[ f u_{i,j,k} + \\frac{1}{\\rho_0}\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j,k} \\right]^2 \\right\\}^{1/2}\n$$\nSince the velocities $(u,v)$ were explicitly defined using the same central difference operators for the pressure gradients that appear in the residual formula, the terms within the square brackets will be zero to machine precision. Therefore, we expect $r_g \\approx 0$.\n\nThe final reported value for each test case is $r = \\max(r_h, r_g)$. Given that $r_g$ is expected to be negligible, the result will be dominated by the hydrostatic residual, $r=r_h$. This serves as a verification of the correct implementation of the hydrostatic integration and the numerical differentiation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_residuals(f, s, b, Hs, A_eta, B_eta):\n    \"\"\"\n    Constructs geostrophic velocity fields and computes consistency residuals\n    for a given set of physical parameters.\n    \"\"\"\n    # 1. Domain and Constants\n    Lx, Ly, H = 1e5, 1e5, 1e3\n    Nx, Ny, Nz = 64, 64, 80\n    g = 9.81\n    rho0 = 1025.0\n\n    # 2. Grid Discretization\n    dx = Lx / Nx\n    dy = Ly / Ny\n    dz = H / (Nz - 1)\n\n    x_vec = np.linspace(0, Lx, Nx, endpoint=False)\n    y_vec = np.linspace(0, Ly, Ny, endpoint=False)\n    z_vec = np.linspace(-H, 0, Nz)\n\n    # Use 'ij' indexing for (x, y, z) to match array dimensions (Nx, Ny, Nz)\n    x, y, z = np.meshgrid(x_vec, y_vec, z_vec, indexing='ij')\n\n    # 3. Define Density and SSH fields\n    # Stratification component\n    rho_strat = rho0 + s * (-z)\n    \n    # Anomaly component\n    rho_anom = b * np.cos(2 * np.pi * x / Lx) * np.cos(2 * np.pi * y / Ly) * np.exp(z / Hs)\n    \n    # Full density field\n    rho = rho_strat + rho_anom\n    \n    # SSH field (note: z is 3D, we need a 2D grid for eta)\n    x_2d, y_2d = np.meshgrid(x_vec, y_vec, indexing='ij')\n    eta = A_eta * np.sin(2 * np.pi * y_2d / Ly) + B_eta * np.cos(2 * np.pi * x_2d / Lx)\n\n    # 4. Pressure Calculation (Hydrostatic Integration)\n    p = np.zeros_like(rho)\n    \n    # Surface boundary condition (at k = Nz-1)\n    p[:, :, -1] = rho0 * g * eta\n    \n    # Integrate downwards from z=0 using the trapezoidal rule\n    for k in range(Nz - 2, -1, -1):\n        p[:, :, k] = p[:, :, k + 1] + (g * dz / 2.0) * (rho[:, :, k] + rho[:, :, k + 1])\n\n    # 5. Velocity Calculation (Geostrophic Balance)\n    # Note: For case 3, f is small, but non-zero, so division is safe.\n    \n    # Central difference for dp/dx with periodic boundaries\n    dp_dx = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2 * dx)\n    \n    # Central difference for dp/dy with periodic boundaries\n    dp_dy = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2 * dy)\n    \n    u = -1.0 / (rho0 * f) * dp_dy\n    v =  1.0 / (rho0 * f) * dp_dx\n    \n    # 6. Residual Calculation\n    # 6.1. Hydrostatic Residual (rh)\n    # Central difference for dp/dz in the interior\n    p_interior = p[:, :, 1:-1]\n    rho_interior = rho[:, :, 1:-1]\n    dp_dz_cd = (p[:, :, 2:] - p[:, :, :-2]) / (2 * dz)\n    \n    hydrostatic_residual_field = np.abs(dp_dz_cd + g * rho_interior) / rho0\n    r_h = np.max(hydrostatic_residual_field)\n\n    # 6.2. Geostrophic Residual (rg)\n    # The pressure gradients dp_dx and dp_dy are the same as used for u and v.\n    # The residual terms are constructed to be numerically zero by definition.\n    res_g_x = -f * v + (1.0 / rho0) * dp_dx\n    res_g_y =  f * u + (1.0 / rho0) * dp_dy\n    \n    geostrophic_residual_field = np.sqrt(res_g_x**2 + res_g_y**2)\n    r_g = np.max(geostrophic_residual_field)\n\n    # For case 4 (uniform fields), all gradients are zero, so u, v are zero.\n    # The Coriolis parameter f is non-zero, but this does not cause issues.\n    # If f were zero, the definition of geostrophy would break down, but the test cases avoid this.\n    if f == 0:\n        # This case is not tested, but as a safeguard:\n        r_g = np.max(np.sqrt(((1/rho0)*dp_dx)**2 + ((1/rho0)*dp_dy)**2))\n\n    # 7. Final Result\n    return max(r_h, r_g)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple: (f, s, b, Hs, A_eta, B_eta)\n    test_cases = [\n        (1.0e-4, 5.0e-4, 0.20, 500, 0.15, 0.10),\n        (1.0e-4, 5.0e-4, 0.00, 500, 0.20, 0.00),\n        (1.0e-6, 5.0e-4, 0.10, 300, 0.05, 0.15),\n        (1.0e-4, 5.0e-4, 0.00, 500, 0.00, 0.00),\n    ]\n\n    results = []\n    for case in test_cases:\n        f, s, b, Hs, A_eta, B_eta = case\n        \n        # Handle the special case where horizontal gradients are zero\n        if b == 0.0 and A_eta == 0.0 and B_eta == 0.0:\n            results.append(0.0) # r_h and r_g will be numerically zero\n            continue\n            \n        result = calculate_residuals(f, s, b, Hs, A_eta, B_eta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}