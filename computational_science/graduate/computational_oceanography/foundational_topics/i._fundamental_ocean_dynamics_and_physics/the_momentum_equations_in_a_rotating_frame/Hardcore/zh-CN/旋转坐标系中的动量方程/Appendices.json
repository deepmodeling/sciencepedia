{
    "hands_on_practices": [
        {
            "introduction": "在计算海洋学中，一个核心任务是根据观测或理论数据为数值模型创建初始条件。这些初始条件必须在物理上是自洽的，以避免在模拟开始时产生虚假的剧烈调整。本练习将引导您完成一个基本但至关重要的过程：从给定的密度和海面高度场，通过数值方法构建静力平衡和地转平衡的流场，这是初始化大规模海洋环流模型的基础技能。",
            "id": "3815721",
            "problem": "您的任务是根据给定的密度和海面高度，构建地转平衡的三维速度场，并在此过程中一致地实施旋转坐标系中动量方程所产生的静水平衡和地转平衡关系。您的推导和算法必须从计算海洋学的第一性原理出发，不得依赖本说明中提供的简化公式。\n\n从应用于Boussinesq流体的旋转坐标系中的牛顿第二定律开始，其中行星旋转效应由科里奥利加速度表示。基本要素如下：物质导数 $D\\boldsymbol{u}/Dt$、重力加速度 $g$、压力 $p$、密度 $\\rho$、参考密度 $\\rho_0$ 以及由地球自转定义的科里奥利参数 $f$。在静水近似下，垂直动量平衡简化为将垂直压力梯度与局部密度联系起来的静水平衡关系。在大尺度、缓变流中，水平动量平衡简化为科里奥利加速度和水平压力梯度之间的地转平衡。\n\n您的程序必须：\n- 将一个矩形海洋域离散化，该域具有水平坐标 $x$ 和 $y$ 以及垂直坐标 $z$（向上为正），其中 $x \\in [0,L_x]$，$y \\in [0,L_y]$，$z \\in [-H,0]$。分别使用具有 $N_x$、$N_y$ 和 $N_z$ 个点的均匀网格。您必须设置 $L_x = 10^5\\ \\mathrm{m}$，$L_y = 10^5\\ \\mathrm{m}$，$H = 10^3\\ \\mathrm{m}$，$N_x = 64$，$N_y = 64$以及 $N_z = 80$。\n- 假设重力加速度 $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$，参考密度 $\\rho_0 = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。为方便起见，将海面的大气压力设为零，这不影响水平压力梯度。\n- 在计算水平导数时，在水平方向上施加周期性边界条件。对水平导数和内部垂直导数使用二阶中心差分（在计算基于垂直导数的残差时，忽略垂直边界点）。\n\n我们为您提供了叠加在稳定层结上的水平变化的密度异常，以及给定的海面高度（SSH）。对于每个测试用例，按如下方式定义密度场 $\\rho(x,y,z)$ 和SSH $\\eta(x,y)$：\n- 设层结随深度呈线性变化：$\\rho_\\mathrm{strat}(z) = \\rho_0 + s(-z)$，其中 $s > 0$ 为常数。\n- 设水平密度异常为 $\\rho_\\mathrm{anom}(x,y,z) = b \\cos\\!\\left(2\\pi x/L_x\\right)\\cos\\!\\left(2\\pi y/L_y\\right)\\exp\\!\\left(z/H_s\\right)$，其中 $b$ 为异常振幅，$H_s$ 为垂直衰减尺度。\n- 总密度为 $\\rho(x,y,z) = \\rho_\\mathrm{strat}(z) + \\rho_\\mathrm{anom}(x,y,z)$。\n- SSH场为 $\\eta(x,y) = A_\\eta \\sin\\!\\left(2\\pi y/L_y\\right) + B_\\eta \\cos\\!\\left(2\\pi x/L_x\\right)$。\n\n利用静水平衡关系，从 $z=0$ 处的上边界条件（在小振幅极限下，由SSH引起的海面压力异常由正压贡献表示）$p(x,y,0) = \\rho_0 g \\eta(x,y)$ 出发，构建整个水柱的压力场 $p(x,y,z)$，并以离散形式实施垂直平衡 $+\\partial p/\\partial z + \\rho g = 0$。然后，在每个水平层面上，实施科里奥利加速度和水平压力梯度之间的地转平衡，其中科里奥利参数（CP）$f$ 在每个测试用例中指定。构建与您通过静水重构获得的水平压力梯度一致的水平无辐散地转速度 $\\boldsymbol{u}(x,y,z) = (u(x,y,z), v(x,y,z))$。您不得引入任何摩擦项或非地转项。\n\n为了量化您构建的一致性，请计算以下残差：\n- 静水残差\n$$\nr_h = \\max_{x,y,z\\ \\text{(interior in }z\\text{)}} \\left| \\frac{\\partial p}{\\partial z} + \\rho g \\right| \\Big/ \\rho_0,\n$$\n其单位为 $\\mathrm{m}\\ \\mathrm{s}^{-2}$。\n- 地转残差\n$$\nr_g = \\max_{x,y,z} \\left\\{ \\left[ -f v + \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x} \\right]^2 + \\left[ f u + \\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial y} \\right]^2 \\right\\}^{1/2},\n$$\n其单位也为 $\\mathrm{m}\\ \\mathrm{s}^{-2}$。\n\n对于每个测试用例，报告单个标量\n$$\nr = \\max(r_h, r_g),\n$$\n以 $\\mathrm{m}\\ \\mathrm{s}^{-2}$ 为单位表示。\n\n在以下四个测试套件上实现您的解决方案。每个元组列出 $(f, s, b, H_s, A_\\eta, B_\\eta)$，单位为 $(\\mathrm{s}^{-1}, \\mathrm{kg}\\ \\mathrm{m}^{-4}, \\mathrm{kg}\\ \\mathrm{m}^{-3}, \\mathrm{m}, \\mathrm{m}, \\mathrm{m})$：\n1. 中纬度斜压-正压混合情况：$(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.20, 500, 0.15, 0.10)$。\n2. 仅正压强迫情况（水平均匀密度，非零SSH梯度）：$(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.00, 500, 0.20, 0.00)$。\n3. 近赤道情况（小 $f$）：$(1.0\\times 10^{-6}, 5.0\\times 10^{-4}, 0.10, 300, 0.05, 0.15)$。\n4. 均匀场情况（无水平梯度）：$(1.0\\times 10^{-4}, 5.0\\times 10^{-4}, 0.00, 500, 0.00, 0.00)$。\n\n您的程序必须生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，其中每个 $\\text{result}_i$ 是相应测试用例的 $r$ 值，以 $\\mathrm{m}\\ \\mathrm{s}^{-2}$ 为单位表示。",
            "solution": "该问题要求在一个离散化的矩形海洋域中，根据指定的密度场和海面高度场，构建地转和静水平衡的速度场。数值构建的一致性将通过计算静水和地转残差来评估。\n\n其控制物理原理建立在旋转参考系中Boussinesq流体动量方程的简化形式之上。对于大尺度、缓变的海洋流动，垂直动量方程简化为静水平衡，而水平动量方程简化为地转平衡。\n\n静水平衡将垂直压力梯度与当地流体密度 $\\rho$ 和重力加速度 $g$ 联系起来：\n$$\n\\frac{\\partial p}{\\partial z} = -g\\rho\n$$\n这里，$p$ 是压力，$z$ 是垂直坐标，向上为正。\n\n地转平衡将水平速度分量 $(u, v)$ 与水平压力梯度和科里奥利参数 $f$ 联系起来。在Boussinesq近似下，惯性项中的密度变化被忽略，该平衡表示为：\n$$\n-f v = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\n$$\n$$\nf u = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial y}\n$$\n其中 $\\rho_0$ 是一个常数参考密度。这些方程可以重新排列以求解速度分量：\n$$\nu(x,y,z) = -\\frac{1}{\\rho_0 f} \\frac{\\partial p}{\\partial y}\n$$\n$$\nv(x,y,z) = \\frac{1}{\\rho_0 f} \\frac{\\partial p}{\\partial x}\n$$\n\n求解算法按构造顺序进行，将这些连续方程转化为离散的数值实现。\n\n**1. 域离散化与场初始化**\n\n该域是一个由 $x \\in [0, L_x]$、$y \\in [0, L_y]$ 和 $z \\in [-H, 0]$ 定义的矩形框。该域使用具有 $N_x, N_y, N_z$ 个点的均匀网格进行离散化。网格间距为 $\\Delta x = L_x / N_x$、$\\Delta y = L_y / N_y$ 和 $\\Delta z = H / (N_z - 1)$。网格坐标为：\n- $x_i = i \\Delta x$，对于 $i=0, \\dots, N_x-1$\n- $y_j = j \\Delta y$，对于 $j=0, \\dots, N_y-1$\n- $z_k = -H + k \\Delta z$，对于 $k=0, \\dots, N_z-1$\n\n在该网格上，根据所提供的公式为每个测试用例定义密度场 $\\rho(x,y,z)$ 和海面高度 $\\eta(x,y)$：\n$$\n\\rho(x_i, y_j, z_k) = (\\rho_0 - s z_k) + b \\cos\\!\\left(\\frac{2\\pi x_i}{L_x}\\right)\\cos\\!\\left(\\frac{2\\pi y_j}{L_y}\\right)\\exp\\!\\left(\\frac{z_k}{H_s}\\right)\n$$\n$$\n\\eta(x_i, y_j) = A_\\eta \\sin\\!\\left(\\frac{2\\pi y_j}{L_y}\\right) + B_\\eta \\cos\\!\\left(\\frac{2\\pi x_i}{L_x}\\right)\n$$\n\n**2. 静水压力重构**\n\n压力场 $p(x,y,z)$ 通过从海面向下积分静水方程来计算。海面（$z=0$，对应于索引 $k=N_z-1$）的压力由海面高度异常 $\\eta(x,y)$ 决定，代表了正压压力贡献：\n$$\np(x_i, y_j, z_{N_z-1}) = \\rho_0 g \\eta(x_i, y_j)\n$$\n我们从海面向下积分方程 $\\partial p / \\partial z = -g\\rho$。使用二阶精度的梯形法则离散化积分 $\\int_{z_k}^{z_{k+1}} dp = \\int_{z_k}^{z_{k+1}} (-g\\rho) dz'$，得到：\n$$\np_{k+1} - p_k = -g \\frac{\\rho_{k+1} + \\rho_k}{2} (z_{k+1} - z_k) = -g \\frac{\\rho_{k+1} + \\rho_k}{2} \\Delta z\n$$\n重新排列以根据上一层 $k+1$ 的压力计算第 $k$ 层的压力，得到迭代公式：\n$$\np_{i,j,k} = p_{i,j,k+1} + \\frac{g \\Delta z}{2} \\left[ \\rho_{i,j,k+1} + \\rho_{i,j,k} \\right]\n$$\n此计算从 $k=N_z-2$ 向下执行到 $0$，填充整个三维压力场。\n\n**3. 地转速度计算**\n\n建立压力场后，根据地转关系计算水平速度分量 $(u,v)$。水平压力梯度使用二阶中心差分进行近似。考虑到 $x$ 和 $y$ 方向的周期性边界条件，离散导数为：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j,k} = \\frac{p_{i+1, j, k} - p_{i-1, j, k}}{2\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j,k} = \\frac{p_{i, j+1, k} - p_{i, j-1, k}}{2\\Delta y}\n$$\n索引是周期性处理的，例如 $p_{-1,j,k} = p_{N_x-1,j,k}$ 和 $p_{N_x,j,k} = p_{0,j,k}$。每个网格点上的地转速度为：\n$$\nu_{i,j,k} = -\\frac{1}{\\rho_0 f} \\frac{p_{i,j+1,k} - p_{i,j-1,k}}{2\\Delta y}\n$$\n$$\nv_{i,j,k} = \\frac{1}{\\rho_0 f} \\frac{p_{i+1,j,k} - p_{i-1,j,k}}{2\\Delta x}\n$$\n这些计算在所有网格点 $(i, j, k)$ 上执行。\n\n**4. 残差计算**\n\n最后，我们通过计算两个残差来量化我们数值方案的一致性。\n\n静水残差 $r_h$ 衡量了当使用与积分方案（梯形法则）不同的模板（中心差分）计算导数时，计算出的压力场满足静水方程的程度。它在内部垂直层（$k=1, \\dots, N_z-2$）上计算：\n$$\n\\left(\\frac{\\partial p}{\\partial z}\\right)_{i,j,k}^{\\text{CD}} = \\frac{p_{i,j,k+1} - p_{i,j,k-1}}{2\\Delta z}\n$$\n$$\nr_h = \\max_{i,j,k \\in \\text{interior}} \\left| \\frac{p_{i,j,k+1} - p_{i,j,k-1}}{2\\Delta z} + g \\rho_{i,j,k} \\right| \\Big{/} \\rho_0\n$$\n该残差的非零值是截断误差的直接度量，预计该误差与 $\\Delta z^2$ 和密度的二阶垂直导数成正比。\n\n地转残差 $r_g$ 衡量了计算出的速度和压力场满足地转平衡的程度。\n$$\nr_g = \\max_{i,j,k} \\left\\{ \\left[ -f v_{i,j,k} + \\frac{1}{\\rho_0}\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j,k} \\right]^2 + \\left[ f u_{i,j,k} + \\frac{1}{\\rho_0}\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j,k} \\right]^2 \\right\\}^{1/2}\n$$\n由于速度 $(u,v)$ 是使用与残差公式中出现的压力梯度相同的中心差分算子明确定义的，因此方括号内的项在机器精度下将为零。因此，我们预计 $r_g \\approx 0$。\n\n每个测试用例最终报告的值是 $r = \\max(r_h, r_g)$。鉴于 $r_g$ 预计可以忽略不计，结果将主要由静水残差决定，即 $r=r_h$。这可用于验证静水积分和数值微分的正确实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_residuals(f, s, b, Hs, A_eta, B_eta):\n    \"\"\"\n    Constructs geostrophic velocity fields and computes consistency residuals\n    for a given set of physical parameters.\n    \"\"\"\n    # 1. Domain and Constants\n    Lx, Ly, H = 1e5, 1e5, 1e3\n    Nx, Ny, Nz = 64, 64, 80\n    g = 9.81\n    rho0 = 1025.0\n\n    # 2. Grid Discretization\n    dx = Lx / Nx\n    dy = Ly / Ny\n    dz = H / (Nz - 1)\n\n    x_vec = np.linspace(0, Lx, Nx, endpoint=False)\n    y_vec = np.linspace(0, Ly, Ny, endpoint=False)\n    z_vec = np.linspace(-H, 0, Nz)\n\n    # Use 'ij' indexing for (x, y, z) to match array dimensions (Nx, Ny, Nz)\n    x, y, z = np.meshgrid(x_vec, y_vec, z_vec, indexing='ij')\n\n    # 3. Define Density and SSH fields\n    # Stratification component\n    rho_strat = rho0 + s * (-z)\n    \n    # Anomaly component\n    rho_anom = b * np.cos(2 * np.pi * x / Lx) * np.cos(2 * np.pi * y / Ly) * np.exp(z / Hs)\n    \n    # Full density field\n    rho = rho_strat + rho_anom\n    \n    # SSH field (note: z is 3D, we need a 2D grid for eta)\n    x_2d, y_2d = np.meshgrid(x_vec, y_vec, indexing='ij')\n    eta = A_eta * np.sin(2 * np.pi * y_2d / Ly) + B_eta * np.cos(2 * np.pi * x_2d / Lx)\n\n    # 4. Pressure Calculation (Hydrostatic Integration)\n    p = np.zeros_like(rho)\n    \n    # Surface boundary condition (at k = Nz-1)\n    p[:, :, -1] = rho0 * g * eta\n    \n    # Integrate downwards from z=0 using the trapezoidal rule\n    for k in range(Nz - 2, -1, -1):\n        p[:, :, k] = p[:, :, k + 1] + (g * dz / 2.0) * (rho[:, :, k] + rho[:, :, k + 1])\n\n    # 5. Velocity Calculation (Geostrophic Balance)\n    # Note: For case 3, f is small, but non-zero, so division is safe.\n    \n    # Central difference for dp/dx with periodic boundaries\n    dp_dx = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2 * dx)\n    \n    # Central difference for dp/dy with periodic boundaries\n    dp_dy = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2 * dy)\n    \n    u = -1.0 / (rho0 * f) * dp_dy\n    v =  1.0 / (rho0 * f) * dp_dx\n    \n    # 6. Residual Calculation\n    # 6.1. Hydrostatic Residual (rh)\n    # Central difference for dp/dz in the interior\n    p_interior = p[:, :, 1:-1]\n    rho_interior = rho[:, :, 1:-1]\n    dp_dz_cd = (p[:, :, 2:] - p[:, :, :-2]) / (2 * dz)\n    \n    hydrostatic_residual_field = np.abs(dp_dz_cd + g * rho_interior) / rho0\n    r_h = np.max(hydrostatic_residual_field)\n\n    # 6.2. Geostrophic Residual (rg)\n    # The pressure gradients dp_dx and dp_dy are the same as used for u and v.\n    # The residual terms are constructed to be numerically zero by definition.\n    res_g_x = -f * v + (1.0 / rho0) * dp_dx\n    res_g_y =  f * u + (1.0 / rho0) * dp_dy\n    \n    geostrophic_residual_field = np.sqrt(res_g_x**2 + res_g_y**2)\n    r_g = np.max(geostrophic_residual_field)\n\n    # For case 4 (uniform fields), all gradients are zero, so u, v are zero.\n    # The Coriolis parameter f is non-zero, but this does not cause issues.\n    # If f were zero, the definition of geostrophy would break down, but the test cases avoid this.\n    if f == 0:\n        # This case is not tested, but as a safeguard:\n        r_g = np.max(np.sqrt(((1/rho0)*dp_dx)**2 + ((1/rho0)*dp_dy)**2))\n\n    # 7. Final Result\n    return max(r_h, r_g)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple: (f, s, b, Hs, A_eta, B_eta)\n    test_cases = [\n        (1.0e-4, 5.0e-4, 0.20, 500, 0.15, 0.10),\n        (1.0e-4, 5.0e-4, 0.00, 500, 0.20, 0.00),\n        (1.0e-6, 5.0e-4, 0.10, 300, 0.05, 0.15),\n        (1.0e-4, 5.0e-4, 0.00, 500, 0.00, 0.00),\n    ]\n\n    results = []\n    for case in test_cases:\n        f, s, b, Hs, A_eta, B_eta = case\n        \n        # Handle the special case where horizontal gradients are zero\n        if b == 0.0 and A_eta == 0.0 and B_eta == 0.0:\n            results.append(0.0) # r_h and r_g will be numerically zero\n            continue\n            \n        result = calculate_residuals(f, s, b, Hs, A_eta, B_eta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "旋转框架下的动量方程不仅描述了力之间的平衡，还蕴含着深刻的守恒定律，这些定律为理解地球物理流体动力学提供了强大的工具。本练习将从第一性原理出发，推导浅水模型中的一个核心守恒量——位涡。通过这个练习，您将深入理解流体柱的拉伸或压缩如何改变其相对涡度，这是解释海洋和大气中许多现象（如涡旋的强化）的关键机制。",
            "id": "3815711",
            "problem": "考虑一个位于旋转参考系中 $f$ 平面上的无粘性单层浅水海洋，其科里奥利参数 $f$ 为常数。我们识别一个物质流体柱，其水平流动由旋转参考系中的动量方程和质量守恒定律描述。不存在外力矩、摩擦应力及非绝热效应。自由表面位移可以内部自行调整，但没有外力强迫。该流体柱的初始层厚度为 $h_0$，初始相对涡度为 $\\zeta_0$。在一个短暂的时间间隔内，该流体柱经历一次纯粹的垂直拉伸，使其厚度变为 $h_1 = \\lambda h_0$，其中 $\\lambda > 0$ 是一个给定因子，且在此过程中不受任何外力矩作用。\n\n从适用于此背景的基本定律——即用于水平动量的旋转参考系中的牛顿第二定律，以及该层的质量守恒定律——出发，推导出一个由绝对涡度和层厚度构成的、与浅水动力学相关的物质守恒标量。利用此推导，计算当流体柱如上所述以因子 $\\lambda$ 拉伸时位涡（PV）的变化量 $\\Delta q = q_1 - q_0$ 的解析表达式，然后确定最终的相对涡度 $\\zeta_1$（用 $\\lambda$、$\\zeta_0$ 和 $f$ 表示）。将你的最终答案表示为一个双分量行矩阵，其中依次包含 $\\Delta q$ 的值和 $\\zeta_1$ 的表达式。此外，推断在北半球相对涡度变化的符号。\n\n无需进行数值近似；请提供精确的解析表达式。如果在任何中间推理中引入角度，请以弧度表示。最终表达式中无需包含单位。",
            "solution": "该问题要求为 $f$ 平面上的单层浅水系统推导出一个称为位涡（PV）的守恒量，然后应用此守恒原理来确定一个经历垂直拉伸的流体柱的位涡变化量和最终相对涡度。\n\n控制该系统的基本定律是旋转参考系中无粘性流体的水平动量方程和流体层的质量守恒方程。\n\n水平动量方程为：\n$$\n\\frac{Du}{Dt} - fv = -g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{Dv}{Dt} + fu = -g \\frac{\\partial \\eta}{\\partial y}\n$$\n其中 $\\mathbf{u} = (u,v)$ 是水平速度矢量，$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$ 是物质导数，$f$ 是常数科里奥利参数，$g$ 是重力加速度，$\\eta$ 是自由表面高度。\n\n厚度为 $h$ 的浅水层的质量守恒方程（或连续性方程）为：\n$$\n\\frac{\\partial h}{\\partial t} + \\nabla \\cdot (h\\mathbf{u}) = 0\n$$\n此方程可展开为 $\\frac{\\partial h}{\\partial t} + \\mathbf{u} \\cdot \\nabla h + h(\\nabla \\cdot \\mathbf{u}) = 0$，使用物质导数可表示为：\n$$\n\\frac{Dh}{Dt} + h (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n重新整理此方程，可得到水平辐散 $\\nabla \\cdot \\mathbf{u}$ 的关系式：\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{h}\\frac{Dh}{Dt}\n$$\n\n接下来，我们推导涡度方程。相对涡度的垂直分量定义为 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。我们对动量方程取旋度，即对 $v$ 方程求 $\\frac{\\partial}{\\partial x}$，再减去对 $u$ 方程求 $\\frac{\\partial}{\\partial y}$。压力梯度项（含 $g\\eta$）相互抵消，得到：\n$$\n\\frac{D}{Dt}\\left(\\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\\right) + (\\zeta + f) \\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0\n$$\n用 $\\zeta$ 和水平辐散 $\\nabla \\cdot \\mathbf{u}$ 表示，上式为：\n$$\n\\frac{D\\zeta}{Dt} + (\\zeta + f)(\\nabla \\cdot \\mathbf{u}) = 0\n$$\n由于在 $f$ 平面上 $f$ 是常数，其物质导数为零，即 $\\frac{Df}{Dt} = 0$。因此，我们可以用绝对涡度 $\\omega_a = \\zeta + f$ 来写此方程：\n$$\n\\frac{D(\\zeta+f)}{Dt} + (\\zeta + f)(\\nabla \\cdot \\mathbf{u}) = 0\n$$\n\n现在我们结合连续性方程和涡度方程。从涡度方程，我们有：\n$$\n\\frac{D(\\zeta+f)}{Dt} = -(\\zeta + f)(\\nabla \\cdot \\mathbf{u})\n$$\n将重新整理后的连续性方程中 $\\nabla \\cdot \\mathbf{u}$ 的表达式代入：\n$$\n\\frac{D(\\zeta+f)}{Dt} = -(\\zeta + f)\\left(-\\frac{1}{h}\\frac{Dh}{Dt}\\right) = \\frac{\\zeta + f}{h}\\frac{Dh}{Dt}\n$$\n整理此方程得到：\n$$\n\\frac{1}{\\zeta+f}\\frac{D(\\zeta+f)}{Dt} - \\frac{1}{h}\\frac{Dh}{Dt} = 0\n$$\n这可以写成一个对数表达式的物质导数：\n$$\n\\frac{D}{Dt}\\left( \\ln(\\zeta+f) \\right) - \\frac{D}{Dt}\\left( \\ln(h) \\right) = 0\n$$\n$$\n\\frac{D}{Dt}\\left( \\ln\\left(\\frac{\\zeta+f}{h}\\right) \\right) = 0\n$$\n该方程表明量 $\\ln\\left(\\frac{\\zeta+f}{h}\\right)$ 跟随流体质点是守恒的。因此，这个量本身，我们定义为浅水位涡 $q$，是物质守恒的。\n$$\nq = \\frac{\\zeta+f}{h}\n$$\n因此，$\\frac{Dq}{Dt} = 0$。这就是题目所要求的，由绝对涡度和层厚度构成的物质守恒标量。\n\n题目指出，一个具有初始位涡 $q_0$ 的流体柱演化到最终位涡为 $q_1$ 的状态。由于该流体柱的位涡是物质守恒的，我们必有 $q_1 = q_0$。因此，位涡的变化量 $\\Delta q$ 为：\n$$\n\\Delta q = q_1 - q_0 = 0\n$$\n\n接下来，我们使用该守恒定律来求最终的相对涡度 $\\zeta_1$。初始和最终状态通过以下关系联系起来：\n$$\nq_0 = \\frac{\\zeta_0 + f}{h_0} \\quad \\text{和} \\quad q_1 = \\frac{\\zeta_1 + f}{h_1}\n$$\n令 $q_1 = q_0$：\n$$\n\\frac{\\zeta_1 + f}{h_1} = \\frac{\\zeta_0 + f}{h_0}\n$$\n给定流体柱被拉伸，使其新厚度为 $h_1 = \\lambda h_0$。将此代入方程：\n$$\n\\frac{\\zeta_1 + f}{\\lambda h_0} = \\frac{\\zeta_0 + f}{h_0}\n$$\n我们可以消去 $h_0$（因为 $h_0 > 0$）并解出 $\\zeta_1$：\n$$\n\\zeta_1 + f = \\lambda (\\zeta_0 + f)\n$$\n$$\n\\zeta_1 = \\lambda (\\zeta_0 + f) - f\n$$\n$$\n\\zeta_1 = \\lambda \\zeta_0 + (\\lambda - 1)f\n$$\n这就是最终相对涡度的表达式。\n\n最后，我们推断相对涡度变化量 $\\Delta \\zeta = \\zeta_1 - \\zeta_0$ 的符号。\n$$\n\\Delta \\zeta = (\\lambda \\zeta_0 + (\\lambda - 1)f) - \\zeta_0 = (\\lambda - 1)\\zeta_0 + (\\lambda - 1)f\n$$\n$$\n\\Delta \\zeta = (\\lambda - 1)(\\zeta_0 + f)\n$$\n在北半球，科里奥利参数 $f$ 是正的（$f > 0$）。对于大尺度地球物理流，相对涡度的量级通常远小于行星涡度，即 $|\\zeta_0| \\ll |f|$。因此，在北半球，绝对涡度 $\\zeta_0 + f$ 是正的。题目描述了“垂直拉伸”，这意味着流体柱变高，所以 $h_1 > h_0$，即因子 $\\lambda > 1$。因此，项 $(\\lambda - 1)$ 也是正的。相对涡度的变化量 $\\Delta \\zeta$ 是两个正项的乘积：\n$$\n\\Delta \\zeta = \\underbrace{(\\lambda - 1)}_{>0} \\underbrace{(\\zeta_0 + f)}_{>0} > 0\n$$\n因此，在北半球，相对涡度的变化是正的。水柱的拉伸使其以与行星自转相同的方向（气旋式）加速旋转。\n\n最终答案要求一个包含 $\\Delta q$ 和 $\\zeta_1$ 表达式的双分量行矩阵。\n第一个分量是 $\\Delta q = 0$。\n第二个分量是 $\\zeta_1 = \\lambda \\zeta_0 + (\\lambda - 1)f$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & \\lambda \\zeta_0 + (\\lambda - 1)f \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论物理与计算实践之间的联系是计算科学的精髓所在。动量方程所描述的物理波模态直接决定了数值模拟的计算约束。本练习探讨了旋转框架下动量方程最简单的瞬变解——惯性振荡，并揭示了其频率如何直接制约显式时间积分方案所能允许的最大时间步长，这是任何从事数值建模的人都必须掌握的实际问题。",
            "id": "3815741",
            "problem": "在固定于地球的旋转参考系中，考虑位于纬度 $\\phi = 37^\\circ \\mathrm{N}$ 的一个水平均匀的海洋水柱。假设流体为 Boussinesq 流体、不可压缩流体，忽略水平压力梯度、平流和所有摩擦力，因此唯一的水平力是科里奥利力。从旋转坐标系中的牛顿第二定律出发，推导出惯性振荡作为水平动量方程的自由解，并用科里奥利参数 $f$ 表示其特征频率。然后，对于一个显式时间步进格式，施加设计要求，即无量纲频率满足 $\\Delta t\\, |f| < 1$，以防止惯性模式的寄生放大。使用地球自转速率 $\\Omega = 7.292115 \\times 10^{-5}\\ \\mathrm{s}^{-1}$ 和定义 $f = 2 \\Omega \\sin\\phi$，估算在 $\\phi = 37^\\circ \\mathrm{N}$ 处允许的最大时间步长 $\\Delta t_{\\max}$。以秒为单位表示最终时间步长，并将答案四舍五入到四位有效数字。在整个计算过程中使用度作为角度单位。",
            "solution": "首先对用户的问题进行有效性检查。\n\n### 步骤 1：提取给定条件\n- **背景**: 在固定于地球的旋转参考系中的水平均匀海洋水柱。\n- **纬度**: $\\phi = 37^\\circ \\mathrm{N}$。\n- **流体假设**: Boussinesq 流体，不可压缩。\n- **力简化**: 忽略水平压力梯度。忽略平流。忽略所有摩擦力。唯一的水平力是科里奥利力。\n- **任务 1**: 从旋转坐标系中的牛顿第二定律出发，推导出惯性振荡作为水平动量方程的自由解。\n- **任务 2**: 用科里奥利参数 $f$ 表示特征频率。\n- **数值稳定性**: 一个显式时间步进格式要求无量纲频率满足 $\\Delta t\\, |f| < 1$。\n- **常数**:\n    - 地球自转速率: $\\Omega = 7.292115 \\times 10^{-5}\\ \\mathrm{s}^{-1}$。\n- **定义**:\n    - 科里奥利参数: $f = 2 \\Omega \\sin\\phi$。\n- **任务 3**: 估算在 $\\phi = 37^\\circ \\mathrm{N}$ 处允许的最大时间步长 $\\Delta t_{\\max}$。\n- **输出要求**: 以秒为单位表示最终时间步长，并四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的给定条件进行验证\n评估问题的有效性。\n- **科学依据**: 该问题是地球物理流体动力学中的一个标准练习，基于旋转行星上流体运动的公认原理、科里奥利效应和数值稳定性分析（CFL 条件）。所有概念在科学上都是合理的。\n- **适定性**: 问题提供了所有必要的数据（$\\phi$, $\\Omega$），一组清晰的物理假设（忽略摩擦、平流和压力梯度），以及一个特定的准则（$\\Delta t\\,|f| < 1$），以得到一个唯一的、有意义的 $\\Delta t_{\\max}$ 解。\n- **客观性**: 问题以精确的技术语言陈述，没有歧义或主观内容。\n\n### 步骤 3：结论与行动\n该问题被判定为 **有效**。将提供完整的解答。\n\n### 解答推导\n在以角速度 $\\mathbf{\\Omega}$ 旋转的参考系中，流体质点的运动由牛顿第二定律描述：\n$$ \\frac{D\\mathbf{u}}{Dt} + 2\\mathbf{\\Omega} \\times \\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\mathbf{g} + \\mathbf{F}_r $$\n其中 $\\mathbf{u}$ 是旋转坐标系中的速度矢量，$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)$ 是物质导数，$\\rho$ 是密度，$p$ 是压力，$\\mathbf{g}$ 是有效重力（引力加离心力），$\\mathbf{F}_r$ 代表摩擦力。\n\n我们考虑水平动量方程。设局部笛卡尔坐标系中，$x$ 指向东，$y$ 指向北，$z$ 指向上。水平速度为 $\\mathbf{u}_h = u\\hat{\\mathbf{i}} + v\\hat{\\mathbf{j}}$。问题指定忽略水平压力梯度（$\\nabla_h p = 0$）、平流（$(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}_h = 0$）和摩擦（$\\mathbf{F}_r = 0$）。在这些假设下，动量方程的水平分量简化为局部加速度和科里奥利力之间的平衡：\n$$ \\frac{\\partial u}{\\partial t} + (2\\mathbf{\\Omega} \\times \\mathbf{u})_x = 0 $$\n$$ \\frac{\\partial v}{\\partial t} + (2\\mathbf{\\Omega} \\times \\mathbf{u})_y = 0 $$\n科里奥利加速度项为 $2\\mathbf{\\Omega} \\times \\mathbf{u}$。在纬度 $\\phi$ 处，角速度矢量为 $\\mathbf{\\Omega} = \\Omega \\cos\\phi \\, \\hat{\\mathbf{j}} + \\Omega \\sin\\phi \\, \\hat{\\mathbf{k}}$。叉积为：\n$$ 2\\mathbf{\\Omega} \\times \\mathbf{u} = 2 \\begin{vmatrix} \\hat{\\mathbf{i}} & \\hat{\\mathbf{j}} & \\hat{\\mathbf{k}} \\\\ 0 & \\Omega \\cos\\phi & \\Omega \\sin\\phi \\\\ u & v & w \\end{vmatrix} $$\n水平分量为 $(2\\mathbf{\\Omega} \\times \\mathbf{u})_x = 2(w\\Omega \\cos\\phi - v\\Omega \\sin\\phi)$ 和 $(2\\mathbf{\\Omega} \\times \\mathbf{u})_y = 2u\\Omega \\sin\\phi$。通过应用传统近似，即对于垂直速度 $w$ 很小的大尺度地球物理流的标准做法，忽略水平动量方程中包含 $w$ 的项。这得到：\n$$ (2\\mathbf{\\Omega} \\times \\mathbf{u})_x \\approx -2v\\Omega \\sin\\phi = -fv $$\n$$ (2\\mathbf{\\Omega} \\times \\mathbf{u})_y \\approx 2u\\Omega \\sin\\phi = fu $$\n其中 $f = 2\\Omega \\sin\\phi$ 是科里奥利参数。\n这个“自由解”（惯性运动）的动量方程变为：\n$$ \\frac{du}{dt} = fv $$\n$$ \\frac{dv}{dt} = -fu $$\n这是一个一阶线性常微分方程组。为了求解它，我们将第一个方程对时间 $t$求导：\n$$ \\frac{d^2u}{dt^2} = f \\frac{dv}{dt} $$\n将第二个方程 $\\frac{dv}{dt} = -fu$ 代入上式：\n$$ \\frac{d^2u}{dt^2} = f(-fu) = -f^2 u $$\n这给出了简谐振荡器的方程：\n$$ \\frac{d^2u}{dt^2} + f^2 u = 0 $$\n这个方程的解是 $u(t) = A \\cos(ft) + B \\sin(ft)$，其中 $A$ 和 $B$ 是常数。$v(t)$ 的对应解可以通过 $v = \\frac{1}{f}\\frac{du}{dt}$ 求得：\n$$ v(t) = \\frac{1}{f}(-Af\\sin(ft) + Bf\\cos(ft)) = B\\cos(ft) - A\\sin(ft) $$\n速度矢量 $(u(t), v(t))$ 以恒定速率 $\\sqrt{u^2+v^2} = \\sqrt{A^2+B^2}$ 描绘一个圆。这个运动就是惯性振荡。该振荡的特征角频率为 $\\omega = |f|$。\n\n最后的任务是计算数值格式所允许的最大时间步长 $\\Delta t_{\\max}$。稳定性判据给出为：\n$$ \\Delta t\\, |f| < 1 $$\n最大时间步长在稳定性极限处找到：\n$$ \\Delta t_{\\max}\\, |f| = 1 \\implies \\Delta t_{\\max} = \\frac{1}{|f|} $$\n科里奥利参数 $f$ 由 $f = 2 \\Omega \\sin\\phi$ 给出。\n给定值为 $\\Omega = 7.292115 \\times 10^{-5}\\ \\mathrm{s}^{-1}$ 和 $\\phi = 37^\\circ$。\n由于纬度在北半球（$37^\\circ > 0$），$\\sin(37^\\circ)$ 为正，因此 $f$ 为正。所以 $|f| = f$。\n$$ \\Delta t_{\\max} = \\frac{1}{2 \\Omega \\sin\\phi} $$\n代入数值：\n$$ \\Delta t_{\\max} = \\frac{1}{2 \\times (7.292115 \\times 10^{-5}\\ \\mathrm{s}^{-1}) \\times \\sin(37^\\circ)} $$\n我们计算分母的值：\n$$ 2 \\times (7.292115 \\times 10^{-5}) \\times \\sin(37^\\circ) \\approx (1.458423 \\times 10^{-4}) \\times 0.60181502 \\approx 8.77835 \\times 10^{-5}\\ \\mathrm{s}^{-1} $$\n现在我们计算 $\\Delta t_{\\max}$：\n$$ \\Delta t_{\\max} = \\frac{1}{8.77835 \\times 10^{-5}}\\ \\mathrm{s} \\approx 11391.68\\ \\mathrm{s} $$\n问题要求将结果四舍五入到四位有效数字。\n$$ \\Delta t_{\\max} \\approx 11390\\ \\mathrm{s} $$",
            "answer": "$$\n\\boxed{11390}\n$$"
        }
    ]
}