{
    "hands_on_practices": [
        {
            "introduction": "在现代海水状态方程（TEOS-10）框架中，绝对盐度（$S_A$）是比实用盐度（$S_P$）更为精确的热力学变量。本练习旨在让你亲手实践如何将观测数据（给定位置的 $S_P$）转换为热力学上准确的 $S_A$，这一过程不仅涉及标准的转换因子，还需考虑海水成分空间变化所引起的异常 。掌握这一技能是进行任何现代海洋学分析的基础数据处理步骤。",
            "id": "3814871",
            "problem": "给定您在几个由地理经度和纬度（单位：度）指定的海洋位置观测到的实用盐度（$S_P$），这是一个由电导率比标准定义的无量纲量。您还有一个已知的绝对盐度异常（$\\delta S_A$）空间场，表示为经度和纬度的函数，它捕捉了海水成分与全球标准参考混合物之间的微小偏差。目标是计算每个观测点的绝对盐度（$S_A$），以克/千克（$\\mathrm{g/kg}$）为单位表示。\n\n从与2010年海水热力学方程（TEOS-$10$）一致的定义出发，参考盐度的构建方式使得在经典实用盐度值$S_P = 35$时，参考盐度（$S_R$）与标准海水中溶解物质的质量分数相匹配。这通过一个常数因子确定了$S_P$与参考质量分数之间的比例关系。绝对盐度异常$\\delta S_A$表示由于成分的空间变化而与该参考质量分数产生的偏差，此处以经度和纬度的已知函数形式给出。您的任务是根据这些原理，推导出一个从$S_P$到$S_A$的转换关系，该关系正确地包含了参考标度和异常，并对其进行数值实现。\n\n请使用以下科学上合理且自洽的规范：\n- 角度必须以度为单位处理。在计算任何三角函数之前，经度必须使用模运算换算到区间$[0^\\circ, 360^\\circ)$内，纬度必须限制在区间$[-90^\\circ, 90^\\circ]$内。\n- 参考盐度常数由TEOS-$10$固定，使得当$S_P = 35$时，质量分数为$35.16504\\,\\mathrm{g/kg}$。这决定了$S_P$与参考质量分数之间的比例关系。\n- 绝对盐度异常场由以下连续函数给出\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right),\n$$\n其中$\\lambda$是经度（单位：度），$\\phi$是纬度（单位：度），$A = 0.02\\,\\mathrm{g/kg}$是异常振幅。\n- 通过将计算出的负值设为$0$来强制执行物理约束$S_A \\ge 0$。\n\n从第一性原理推导转换关系，并实现一个数值算法，为每个观测点根据给定的$S_P$和$\\delta S_A(\\lambda,\\phi)$计算$S_A$（单位：$\\mathrm{g/kg}$），同时注意指定的角度处理和物理约束。\n\n测试套件：\n为以下五个案例提供输出，每个案例都是一个三元组$(S_P,\\lambda,\\phi)$：\n- 案例1：$(35.0, 180.0, 0.0)$\n- 案例2：$(34.8, 0.0, 30.0)$\n- 案例3：$(0.0, -10.0, -45.0)$\n- 案例4：$(40.0, 370.0, 80.0)$\n- 案例5：$(33.0, 250.0, -80.0)$\n\n答案规范：\n- 将每个得到的$S_A$（单位：$\\mathrm{g/kg}$）表示为四舍五入到$6$位小数的浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[result_1,result_2,\\dots]$）。",
            "solution": "问题陈述已经过评估并被认为是有效的。它科学地基于TEOS-$10$海水标准的原理，问题提出得当，信息充分且一致，并以客观、正式的语言表述。唯一且可验证的解决方案所需的所有组成部分都已提供。\n\n主要目标是根据给定的实用盐度（$S_P$，无量纲）和由经度（$\\lambda$）与纬度（$\\phi$）（单位：度）指定的地理位置，计算绝对盐度（$S_A$），单位为$\\mathrm{g/kg}$。解决方案要求按照问题陈述中阐述的第一性原理推导转换关系。\n\nTEOS-$10$框架的基础是绝对盐度（$S_A$），即溶解固体的真实质量分数，可以表示为参考盐度（$S_R$）和绝对盐度异常（$\\delta S_A$）之和。\n$$\nS_A = S_R + \\delta S_A\n$$\n参考盐度$S_R$是与样品具有相同实用盐度$S_P$的标准参考成分海水的质量分数。它被定义为与实用盐度成正比。我们可以用一个比例常数$u_{PS}$来表示这种关系：\n$$\nS_R = u_{PS} \\, S_P\n$$\n问题提供了确定此常数所需的信息。它指出，对于标准海水，实用盐度$S_P = 35$对应于质量分数$35.16504\\,\\mathrm{g/kg}$。对于这种参考海水，根据定义，异常$\\delta S_A$为零，因此其绝对盐度等于其参考盐度。这给了我们以下方程：\n$$\n35.16504\\,\\mathrm{g/kg} = u_{PS} \\cdot 35\n$$\n求解$u_{PS}$可得转换因子：\n$$\nu_{PS} = \\frac{35.16504}{35}\\,\\mathrm{g/kg} \\approx 1.00471542857\\,\\mathrm{g/kg}\n$$\n将$S_R$的表达式代回$S_A$的主方程，我们得到从$S_P$到$S_A$的完整转换关系：\n$$\nS_A(S_P, \\lambda, \\phi) = \\left(\\frac{35.16504}{35}\\right) S_P + \\delta S_A(\\lambda, \\phi)\n$$\n绝对盐度异常$\\delta S_A$是作为经度$\\lambda$和纬度$\\phi$的已知函数提供的：\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right)\n$$\n其中振幅给定为$A = 0.02\\,\\mathrm{g/kg}$。因子$\\frac{\\pi}{180}$用于将输入中提供的角度从度转换为弧度，以用于三角函数。\n\n对于每个测试案例$(S_P, \\lambda, \\phi)$，计算算法如下：\n$1$. 角度预处理：必须正确处理地理坐标。\n    - 经度$\\lambda$使用模运算换算到区间$[0^\\circ, 360^\\circ)$。对于输入$\\lambda$，归一化后的经度为$\\lambda' = \\lambda \\pmod{360}$。\n    - 纬度$\\phi$被限制在物理上有意义的范围$[-90^\\circ, 90^\\circ]$。对于输入$\\phi$，限制后的纬度为$\\phi' = \\max(-90, \\min(90, \\phi))$。\n\n$2$. 计算绝对盐度异常（$\\delta S_A$）：将处理后的角度代入给定函数：\n    $$\n    \\delta S_A = (0.02\\,\\mathrm{g/kg}) \\cdot \\sin\\!\\left(\\frac{\\pi\\,\\phi'}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda'}{180}\\right)\n    $$\n\n$3$. 计算参考盐度（$S_R$）：使用推导出的关系和输入的$S_P$：\n    $$\n    S_R = \\left(\\frac{35.16504}{35}\\right) S_P\n    $$\n\n$4$. 计算绝对盐度（$S_A$）：将两个分量相加：\n    $$\n    S_{A, \\text{raw}} = S_R + \\delta S_A\n    $$\n\n$5$. 应用物理约束：绝对盐度作为一个质量分数，不能为负。因此，任何计算出的负值都是不符合物理规律的，必须设为零。\n    $$\n    S_A = \\max(0, S_{A, \\text{raw}})\n    $$\n\n$6$. 最终格式化：将得到的$S_A$值按要求四舍五入到$6$位小数。\n\n这个分步过程确保了问题陈述中的所有条件都得到满足，从而产生科学上和数值上都正确的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Absolute Salinity (SA) from Practical Salinity (SP) and location\n    based on TEOS-10 principles.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (SP, longitude, latitude)\n        (35.0, 180.0, 0.0),\n        (34.8, 0.0, 30.0),\n        (0.0, -10.0, -45.0),\n        (40.0, 370.0, 80.0),\n        (33.0, 250.0, -80.0),\n    ]\n\n    # Define constants based on the problem statement\n    # The TEOS-10 conversion factor for Reference Salinity from Practical Salinity.\n    UPS = 35.16504 / 35.0\n    # The amplitude of the Absolute Salinity Anomaly field.\n    A = 0.02  # in g/kg\n\n    results = []\n    for sp, lon, lat in test_cases:\n        # Step 1: Angle Pre-processing\n        # Wrap longitude to the interval [0, 360) degrees.\n        lon_norm = lon % 360.0\n        # Clamp latitude to the interval [-90, 90] degrees.\n        lat_clamped = np.clip(lat, -90.0, 90.0)\n\n        # Step 2: Calculation of Absolute Salinity Anomaly (delta_Sa)\n        # Convert degrees to radians for trigonometric functions.\n        lon_rad = np.deg2rad(lon_norm)\n        lat_rad = np.deg2rad(lat_clamped)\n        \n        delta_sa = A * np.sin(lat_rad) * np.cos(lon_rad)\n\n        # Step 3: Calculation of Reference Salinity (Sr)\n        sr = UPS * sp\n\n        # Step 4: Calculation of Absolute Salinity (Sa)\n        sa_raw = sr + delta_sa\n\n        # Step 5: Application of Physical Constraint (SA >= 0)\n        sa = max(0.0, sa_raw)\n\n        # Step 6: Final Formatting\n        # Round the result to 6 decimal places and format as a string.\n        results.append(f\"{sa:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "本练习将理论热力学与实际计算相结合，要求你直接从吉布斯自由能函数出发，推导决定海水垂直稳定性的关键参数——绝热直减率（$\\Gamma$） 。通过这个练习，你将深化对麦克斯韦关系以及如何利用抽象的热力学势来计算海水具体物理属性的理解。",
            "id": "3814828",
            "problem": "您的任务是在2010年海水热力学方程 (TEOS-10) 的框架内，推导并实现一种适合计算评估形式的海水绝热递减率。设单位质量的比吉布斯自由能为 $g(S_A, T, p)$，其中 $S_A$ 是绝对盐度，$T$ 是现场温度，$p$ 是压力。请仅使用以下基本依据：\n- 源自吉布斯函数的热力学定义：在固定的 $S_A$ 和 $p$ 下，比熵 $\\eta = -\\partial g / \\partial T$；在固定的 $S_A$ 和 $T$ 下，比容 $v = \\partial g / \\partial p$。\n- 由吉布斯函数混合偏导数相等所隐含的麦克斯韦关系式。\n- 在比熵和绝对盐度恒定条件下的绝热递减率定义。\n\n任务：\n1. 从上述定义出发，并且在不假设任何绝热递减率简化恒等式的情况下，推导绝热递减率 $\\Gamma = \\left( \\partial T / \\partial p \\right)_{ \\eta, S_A }$ 的表达式，该表达式需用比吉布斯自由能 $g(S_A, T, p)$ 的二阶导数表示。在求导过程中将 $S_A$ 视为常数。\n2. 为进行数值评估，采用以下在典型海洋条件附近热力学一致的比吉布斯自由能局部代理模型：\n   $$g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2,$$\n   其中 $T_{\\mathrm{ref}} = 273.15\\,\\mathrm{K}$，系数如下：\n   - $c_p(S_A) = c_{p0} + c_{pS} S_A$，其中 $c_{p0} = 3985\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 且 $c_{pS} = 0.10\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}\\,(g\\,kg^{-1})^{-1}}$，\n   - $v_{00} = 9.72\\times 10^{-4}\\,\\mathrm{m^3\\,kg^{-1}}$，\n   - $v_T = 2.50\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,K^{-1}}$，\n   - $v_S = -8.00\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,(g\\,kg^{-1})^{-1}}$，\n   - $\\kappa_0 = 4.50\\times 10^{-13}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}}$，\n   - $\\kappa_T = 5.00\\times 10^{-16}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,K^{-1}}$，\n   - $\\kappa_S = -2.00\\times 10^{-15}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,(g\\,kg^{-1})^{-1}}$。\n   该代理模型通过产生在典型海水比容范围内的 $v = g_p$、正的等压热容 $c_p = - T\\, g_{TT}$ 以及微小的正压缩率来确保物理上的合理性。\n3. 使用您推导出的用 $g$ 的导数表示的 $\\Gamma$ 表达式，为下面指定的每个测试用例计算 $\\Gamma$。请严格使用指定的单位：\n   - 绝对盐度 $S_A$ 单位为 $\\mathrm{g\\,kg^{-1}}$，\n   - 现场温度 $T$ 单位为摄氏度 (ITS-90)，在使用于 $g(S_A, T_K, p)$ 之前必须转换为开尔文 $T_K = T~(\\mathrm{^\\circ C}) + 273.15$，\n   - 压力 $p$ 单位为帕斯卡 ($\\mathrm{Pa}$)，\n   - 绝热递减率 $\\Gamma$ 以 $\\mathrm{K\\,Pa^{-1}}$ 表示。\n4. 测试套件：\n   - 用例 1 (常规情况)：$(S_A, T, p) = (35.0, 15.0, 1.0\\times 10^{6})$，\n   - 用例 2 (海面边界)：$(S_A, T, p) = (35.0, 10.0, 0.0)$，\n   - 用例 3 (低温，中层深度)：$(S_A, T, p) = (34.5, 0.0, 5.0\\times 10^{6})$，\n   - 用例 4 (暖水，深层)：$(S_A, T, p) = (37.0, 25.0, 4.0\\times 10^{7})$，\n   - 用例 5 (高盐度，深渊层)：$(S_A, T, p) = (40.0, 2.0, 6.0\\times 10^{7})$。\n5. 最终输出格式：\n   您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个值必须是小数点后有十位的科学记数法浮点数（例如，$[1.2345678900\\mathrm{e}{-08},\\dots]$），单位为 $\\mathrm{K\\,Pa^{-1}}$。\n\n您的程序必须是自包含的，且不得需要用户输入。它必须使用上述代理函数 $g(S_A, T, p)$ 实现推导出的 $\\Gamma$ 表达式，并以指定的格式和单位返回测试套件的绝热递减率值。",
            "solution": "经评估，该问题是有效的。其科学基础是经典热力学，定义和数据完整，问题提法恰当，表述客观。任务是基于给定的吉布斯函数推导并计算海水的绝热递减率，这是物理海洋学中的一个标准程序。\n\n### 第1部分：绝热递减率 $\\Gamma$ 的推导\n\n绝热递减率 $\\Gamma$ 定义为与周围环境不发生热量交换的流体微团温度随压力变化的速率。这对应于一个在恒定比熵 $\\eta$ 和恒定绝对盐度 $S_A$ 下发生的过程。其数学定义为：\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta, S_A} $$\n在整个推导过程中，$S_A$ 保持恒定，为简洁起见，将从下标中省略。\n\n我们首先将比熵 $\\eta$ 视为现场温度 $T$ 和压力 $p$ 的函数，即 $\\eta = \\eta(T, p)$。其全微分为：\n$$ d\\eta = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\n对于一个等熵（绝热且可逆）过程，$d\\eta = 0$。因此：\n$$ 0 = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\n重排此方程以求解在 $\\eta$ 恒定条件下的比率 $dT/dp$，可得：\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta} = - \\frac{\\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T}{\\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p} $$\n该表达式将绝热递减率与比熵的偏导数联系起来。下一步是将这些导数用比吉布斯自由能 $g(T, p)$ 来表示。\n\n根据给定的基本热力学定义：\n- 比熵：$\\eta = -\\left( \\frac{\\partial g}{\\partial T} \\right)_p \\equiv -g_T$\n- 比容：$v = \\left( \\frac{\\partial g}{\\partial p} \\right)_T \\equiv g_p$\n\n让我们计算 $\\Gamma$ 表达式的分母：\n$$ \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = \\frac{\\partial}{\\partial T} \\left( -g_T \\right)_p = - \\frac{\\partial^2 g}{\\partial T^2} \\equiv -g_{TT} $$\n该项与等压比热容 $c_p = T \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = -T g_{TT}$ 有关。由于物理稳定性要求 $T > 0$ 和 $c_p > 0$，因此 $g_{TT}  0$。\n\n接下来，我们计算分子：\n$$ \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T = \\frac{\\partial}{\\partial p} \\left( -g_T \\right)_T = - \\frac{\\partial^2 g}{\\partial p \\partial T} \\equiv -g_{Tp} $$\n由于比吉布斯函数 $g$ 是一个状态函数，其混合偏导数相等（根据 Schwarz 定理）。这构成了一个麦克斯韦关系式：\n$$ \\frac{\\partial^2 g}{\\partial p \\partial T} = \\frac{\\partial^2 g}{\\partial T \\partial p} \\implies g_{Tp} = g_{pT} $$\n我们可以将 $g_{pT}$ 与比容的热膨胀联系起来：\n$$ g_{pT} = \\frac{\\partial}{\\partial T} \\left( \\frac{\\partial g}{\\partial p} \\right)_T = \\left( \\frac{\\partial v}{\\partial T} \\right)_p $$\n\n将这些结果代回 $\\Gamma$ 的表达式中：\n$$ \\Gamma = - \\frac{-g_{Tp}}{-g_{TT}} = - \\frac{g_{Tp}}{g_{TT}} $$\n使用麦克斯韦关系式 $g_{Tp} = g_{pT}$：\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{\\frac{\\partial^2 g}{\\partial T \\partial p}}{\\frac{\\partial^2 g}{\\partial T^2}} $$\n这就是用比吉布斯自由能的二阶导数表示的绝热递减率所要求的表达式。\n\n### 第2部分：应用于代理吉布斯函数\n\n给定以下比吉布斯自由能的代理模型，其中 $T$ 是以开尔文为单位的温度：\n$$ g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2, $$\n其中 $c_p(S_A) = c_{p0} + c_{pS} S_A$。\n\n我们必须计算二阶偏导数 $g_{TT}$ 和 $g_{pT}$。\n\n首先，对温度的偏导数 $g_T$：\n$$ g_T = \\frac{\\partial g}{\\partial T} = \\frac{\\partial}{\\partial T}\\left[-c_p(S_A) T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right)\\right] + \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p - \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + T \\cdot \\frac{1}{T} \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + 1 \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\n现在，对温度的二阶偏导数 $g_{TT}$：\n$$ g_{TT} = \\frac{\\partial g_T}{\\partial T} = -c_p(S_A) \\left[ \\frac{1}{T} \\right] = -\\frac{c_p(S_A)}{T} $$\n这个结果与热力学定义 $c_p = -T g_{TT}$ 一致。\n\n接下来，我们计算对压力的偏导数 $g_p$：\n$$ g_p = \\frac{\\partial g}{\\partial p} = \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] - \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p $$\n现在，混合偏导数 $g_{pT}$：\n$$ g_{pT} = \\frac{\\partial g_p}{\\partial T} = v_T - \\kappa_T p $$\n\n最后，我们将 $g_{TT}$ 和 $g_{pT}$ 的表达式代入 $\\Gamma$ 的公式中：\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{v_T - \\kappa_T p}{-\\frac{c_p(S_A)}{T}} $$\n$$ \\Gamma = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_p(S_A)} $$\n代入 $c_p(S_A) = c_{p0} + c_{pS} S_A$，我们得到用于数值计算的最终表达式：\n$$ \\Gamma(S_A, T, p) = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_{p0} + c_{pS} S_A} $$\n在这里，$T$ 必须是开尔文。该公式将用于为给定的测试用例解决问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the adiabatic lapse rate of seawater using a \n    surrogate Gibbs function within the TEOS-10 framework.\n    \"\"\"\n    \n    # Define the coefficients from the problem statement.\n    # The units are SI (J, kg, K, Pa, m).\n    \n    # Specific heat capacity coefficients for cp(SA) = c_p0 + c_pS * SA\n    # c_p0 in J kg^-1 K^-1\n    C_P0 = 3985.0\n    # c_pS in J kg^-1 K^-1 (g kg^-1)^-1\n    C_PS = 0.10\n    \n    # Coefficient for the temperature-dependent part of specific volume\n    # v_T in m^3 kg^-1 K^-1\n    V_T = 2.50e-7\n    \n    # Coefficient for the temperature-dependent part of compressibility\n    # kappa_T in m^3 kg^-1 Pa^-1 K^-1\n    KAPPA_T = 5.00e-16\n    \n    # Temperature conversion offset from ITS-90 (°C) to Kelvin (K)\n    T_OFFSET_KELVIN = 273.15\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (Absolute Salinity SA [g/kg], Temperature T [°C], Pressure p [Pa])\n    test_cases = [\n        (35.0, 15.0, 1.0e6),\n        (35.0, 10.0, 0.0),\n        (34.5, 0.0, 5.0e6),\n        (37.0, 25.0, 4.0e7),\n        (40.0, 2.0, 6.0e7),\n    ]\n\n    results = []\n    \n    # The derived formula for the adiabatic lapse rate is:\n    # Gamma = T_kelvin * (v_T - kappa_T * p) / (c_p0 + c_pS * SA)\n    \n    for sa, t_celsius, p in test_cases:\n        # Convert in-situ temperature from Celsius to Kelvin for use in the formula\n        t_kelvin = t_celsius + T_OFFSET_KELVIN\n        \n        # Calculate the specific heat capacity at constant pressure, c_p(SA)\n        cp_sa = C_P0 + C_PS * sa\n        \n        # Calculate the numerator of the Gamma expression\n        numerator = t_kelvin * (V_T - KAPPA_T * p)\n        \n        # Calculate the adiabatic lapse rate, Gamma\n        gamma = numerator / cp_sa\n        \n        results.append(gamma)\n\n    # Format the results into a string as specified: a comma-separated list\n    # in square brackets, with each number in scientific notation with 10 decimal places.\n    formatted_results = [f\"{res:.10e}\" for res in results]\n    \n    # The final print statement must produce only the single-line specified format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "这项高级练习深入探讨了中性面的核心概念，这对于理解海洋环流和混合至关重要。你将从状态方程的第一性原理出发，推导出一个中性面的局部几何形态，并计算其斜率 。此练习阐明了温度和盐度的空间梯度如何与压力的影响相结合，共同定义了水团能够以最小阻力移动的路径。",
            "id": "3814850",
            "problem": "给定海洋中的一个点，其局部热力学状态由绝对盐度 $S_A$、保守温度 $\\Theta$ 和压力 $p$ 描述。海水热力学方程 (TEOS-10) 将现场密度视为一个函数 $\\rho = \\rho(S_A,\\Theta,p)$。考虑物理空间中的一个微小位移矢量 $\\mathrm{d}\\mathbf{r}$。中性条件要求密度的一阶变化 $\\,\\mathrm{d}\\rho\\,$ 在此位移下为零。利用状态方程的线性化和静力平衡，构建该点的局部中性切平面，并计算对于指定的水平方向，中性方向与水平方向所成的中性角 $\\phi$（以弧度为单位）。\n\n使用的基本原理：\n- 海水状态方程的线性化，表示密度的一阶变化：\n$$\n\\mathrm{d}\\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial S_A}\\right)_{\\Theta,p} \\mathrm{d}S_A + \\left(\\frac{\\partial \\rho}{\\partial \\Theta}\\right)_{S_A,p} \\mathrm{d}\\Theta + \\left(\\frac{\\partial \\rho}{\\partial p}\\right)_{S_A,\\Theta} \\mathrm{d}p.\n$$\n- 关联压力变化与垂直位移的静力平衡：\n$$\n\\mathrm{d}p \\approx -\\rho g\\, \\mathrm{d}z,\n$$\n其中 $g$ 是重力加速度，$z$ 是向上增加的垂直坐标。\n- 空间梯度关联属性变化与位移：\n$$\n\\mathrm{d}S_A = \\nabla S_A \\cdot \\mathrm{d}\\mathbf{r}, \\quad \\mathrm{d}\\Theta = \\nabla \\Theta \\cdot \\mathrm{d}\\mathbf{r}.\n$$\n\n给定状态下 TEOS-10 偏导数的近似（假设对于小位移是局部常数）：\n- 热膨胀系数 $\\alpha$，使得 $\\left(\\frac{\\partial \\rho}{\\partial \\Theta}\\right)_{S_A,p} \\approx -\\rho \\alpha$，其中 $\\alpha$ 的单位为 $\\mathrm{K}^{-1}$。\n- 盐收缩系数 $\\beta$，使得 $\\left(\\frac{\\partial \\rho}{\\partial S_A}\\right)_{\\Theta,p} \\approx \\rho \\beta$，其中 $\\beta$ 的单位为 $(\\mathrm{g}/\\mathrm{kg})^{-1}$。\n- 等温压缩率 $\\kappa$，使得 $\\left(\\frac{\\partial \\rho}{\\partial p}\\right)_{S_A,\\Theta} \\approx \\kappa \\rho$，其中 $\\kappa$ 的单位为 $\\mathrm{Pa}^{-1}$。\n\n将单位垂直矢量定义为 $\\hat{\\mathbf{z}} = (0,0,1)$，以及 $x$–$y$ 平面中的一个水平单位方向 $\\mathbf{h}$。如果该点的局部中性切平面由一个法向量 $\\mathbf{n}$ 定义，则任何中性位移 $\\mathrm{d}\\mathbf{r}$ 都满足 $\\mathbf{n}\\cdot \\mathrm{d}\\mathbf{r} = 0$。将位移参数化为 $\\mathrm{d}\\mathbf{r} = \\mathbf{h}\\,\\mathrm{d}\\ell + \\hat{\\mathbf{z}}\\,\\mathrm{d}z$，其中 $\\mathrm{d}\\ell$ 是沿 $\\mathbf{h}$ 的水平步长。沿 $\\mathbf{h}$ 的中性斜率 $s = \\mathrm{d}z/\\mathrm{d}\\ell$ 通过 $\\phi = \\arctan(s)$ 确定了与水平方向的中性角 $\\phi$。\n\n你的任务：\n1. 从上述基本原理出发，推导局部中性切平面的法向量 $\\mathbf{n}$ 的表达式，用 $\\nabla S_A$、$\\nabla \\Theta$、$\\rho$、$g$ 以及 $\\rho$ 关于 $S_A$、$\\Theta$ 和 $p$ 的偏导数来表示。\n2. 对于下面的测试套件，使用推导出的 $\\mathbf{n}$，计算给定水平单位向量 $\\mathbf{h}$ 上的中性斜率 $s$ 和中性角 $\\phi$。\n\n所有测试用例中使用的数值：\n- 背景密度：$\\rho = 1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n- 重力加速度：$g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。\n- 热膨胀系数：$\\alpha = 2.1\\times 10^{-4}\\,\\mathrm{K}^{-1}$。\n- 盐收缩系数：$\\beta = 7.6\\times 10^{-4}\\,(\\mathrm{g}/\\mathrm{kg})^{-1}$。\n- 等温压缩率：$\\kappa = 4.5\\times 10^{-10}\\,\\mathrm{Pa}^{-1}$。\n\n测试套件（每个情况提供 $\\nabla \\Theta$ 单位为 $\\mathrm{K}\\,\\mathrm{m}^{-1}$，$\\nabla S_A$ 单位为 $(\\mathrm{g}/\\mathrm{kg})\\,\\mathrm{m}^{-1}$，以及一个水平单位方向 $\\mathbf{h}$）：\n- 情况 1 (一般情况)：\n  - $\\nabla \\Theta = (5\\times 10^{-4},\\,-3\\times 10^{-4},\\,-10^{-3})$，\n  - $\\nabla S_A = (10^{-4},\\,2\\times 10^{-4},\\,5\\times 10^{-5})$，\n  - $\\mathbf{h} = (\\cos(\\pi/6),\\,\\sin(\\pi/6),\\,0)$。\n- 情况 2 (接近垂直的中性平面分母)：\n  - $\\nabla \\Theta = (-5\\times 10^{-4},\\,2\\times 10^{-4},\\,-10^{-2})$，\n  - $\\nabla S_A = (10^{-4},\\,-10^{-4},\\,3.157\\times 10^{-3})$，\n  - $\\mathbf{h} = \\frac{1}{\\sqrt{2}}(1,\\,1,\\,0)$。\n- 情况 3 (沿 $\\mathbf{h}$ 的中性斜率为零)：\n  - $\\nabla \\Theta = (0.0010854,\\,0,\\,-2\\times 10^{-3})$，\n  - $\\nabla S_A = (3\\times 10^{-4},\\,0,\\,10^{-3})$，\n  - $\\mathbf{h} = (1,\\,0,\\,0)$。\n- 情况 4 (中等斜率，y方向)：\n  - $\\nabla \\Theta = (2\\times 10^{-4},\\,10^{-4},\\,-5\\times 10^{-4})$，\n  - $\\nabla S_A = (5\\times 10^{-4},\\,-2\\times 10^{-4},\\,0)$，\n  - $\\mathbf{h} = (0,\\,1,\\,0)$。\n- 情况 5 (精确垂直的中性平面，x方向)：\n  - $\\nabla \\Theta = (-10^{-3},\\,0,\\,-1.258\\times 10^{-2})$，\n  - $\\nabla S_A = (10^{-3},\\,0,\\,2.5\\times 10^{-3})$，\n  - $\\mathbf{h} = (1,\\,0,\\,0)$。\n\n角度单位和输出规范：\n- 将每个中性角 $\\phi$ 以弧度表示，并四舍五入到六位小数。\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，`[phi1,phi2,phi3,phi4,phi5]`）。\n\n边界情况处理：\n- 如果中性平面在推导出的法向量垂直分量为零的意义上是精确垂直的，则将角度解释为 $\\phi = \\operatorname{sgn}(-\\mathbf{n}\\cdot \\mathbf{h})\\,\\pi/2$。",
            "solution": "目标是确定局部中性角 $\\phi$，即中性位移与水平方向所成的角度。中性位移是指现场密度 $\\rho$ 在一阶上保持不变的位移，即 $\\mathrm{d}\\rho=0$。推导从这个基本的中性条件出发，使用所提供的状态方程和静力平衡的线性化。\n\n首先，我们将推导局部中性切平面的法向量 $\\mathbf{n}$ 的表达式。任何中性位移矢量 $\\mathrm{d}\\mathbf{r}$ 都必须与 $\\mathbf{n}$ 正交，满足 $\\mathbf{n}\\cdot\\mathrm{d}\\mathbf{r} = 0$。\n中性条件表示为密度的一阶变化为零：\n$$\n\\mathrm{d}\\rho = 0\n$$\n问题提供了海水的线性化状态方程，该方程用绝对盐度 $\\mathrm{d}S_A$、保守温度 $\\mathrm{d}\\Theta$ 和压力 $\\mathrm{d}p$ 的变化来表示 $\\mathrm{d}\\rho$：\n$$\n\\mathrm{d}\\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial S_A}\\right)_{\\Theta,p} \\mathrm{d}S_A + \\left(\\frac{\\partial \\rho}{\\partial \\Theta}\\right)_{S_A,p} \\mathrm{d}\\Theta + \\left(\\frac{\\partial \\rho}{\\partial p}\\right)_{S_A,\\Theta} \\mathrm{d}p = 0\n$$\n我们被给予了以下关于偏导数的近似，用盐收缩系数 $\\beta$、热膨胀系数 $\\alpha$ 和等温压缩率 $\\kappa$ 表示：\n$$\n\\left(\\frac{\\partial \\rho}{\\partial S_A}\\right)_{\\Theta,p} \\approx \\rho \\beta, \\quad \\left(\\frac{\\partial \\rho}{\\partial \\Theta}\\right)_{S_A,p} \\approx -\\rho \\alpha, \\quad \\left(\\frac{\\partial \\rho}{\\partial p}\\right)_{S_A,\\Theta} \\approx \\kappa \\rho\n$$\n将这些代入线性化的状态方程得到：\n$$\n(\\rho \\beta) \\mathrm{d}S_A - (\\rho \\alpha) \\mathrm{d}\\Theta + (\\rho \\kappa) \\mathrm{d}p = 0\n$$\n由于现场密度 $\\rho$ 非零，我们可以将整个方程除以 $\\rho$：\n$$\n\\beta \\,\\mathrm{d}S_A - \\alpha \\,\\mathrm{d}\\Theta + \\kappa \\,\\mathrm{d}p = 0\n$$\n变化量 $\\mathrm{d}S_A$、$\\mathrm{d}\\Theta$ 和 $\\mathrm{d}p$ 与空间位移矢量 $\\mathrm{d}\\mathbf{r} = (\\mathrm{d}x, \\mathrm{d}y, \\mathrm{d}z)$ 相关，通过 $S_A$ 和 $\\Theta$ 的空间梯度，以及压力的静力平衡。设 $\\hat{\\mathbf{z}} = (0,0,1)$ 为单位垂直矢量。\n$$\n\\mathrm{d}S_A = \\nabla S_A \\cdot \\mathrm{d}\\mathbf{r}\n$$\n$$\n\\mathrm{d}\\Theta = \\nabla \\Theta \\cdot \\mathrm{d}\\mathbf{r}\n$$\n$$\n\\mathrm{d}p \\approx -\\rho g\\,\\mathrm{d}z = -\\rho g (\\hat{\\mathbf{z}} \\cdot \\mathrm{d}\\mathbf{r})\n$$\n其中 $g$ 是重力加速度。\n\n将这些关系代回中性条件得到：\n$$\n\\beta (\\nabla S_A \\cdot \\mathrm{d}\\mathbf{r}) - \\alpha (\\nabla \\Theta \\cdot \\mathrm{d}\\mathbf{r}) + \\kappa (-\\rho g (\\hat{\\mathbf{z}} \\cdot \\mathrm{d}\\mathbf{r})) = 0\n$$\n根据点积的分配律，我们可以提出 $\\mathrm{d}\\mathbf{r}$：\n$$\n\\left( \\beta \\nabla S_A - \\alpha \\nabla \\Theta - \\kappa \\rho g \\hat{\\mathbf{z}} \\right) \\cdot \\mathrm{d}\\mathbf{r} = 0\n$$\n该方程的形式为 $\\mathbf{n} \\cdot \\mathrm{d}\\mathbf{r} = 0$，它定义了一个法向量为 $\\mathbf{n}$ 的平面。因此，局部中性切平面的法向量为：\n$$\n\\mathbf{n} = \\beta \\nabla S_A - \\alpha \\nabla \\Theta - \\kappa \\rho g \\hat{\\mathbf{z}}\n$$\n这完成了任务的第一部分。\n\n接下来，我们推导沿指定水平单位方向 $\\mathbf{h}$ 的中性斜率 $s$ 和角度 $\\phi$。沿此方向且带有垂直分量的位移 $\\mathrm{d}\\mathbf{r}$ 可参数化为：\n$$\n\\mathrm{d}\\mathbf{r} = \\mathbf{h}\\,\\mathrm{d}\\ell + \\hat{\\mathbf{z}}\\,\\mathrm{d}z\n$$\n其中 $\\mathrm{d}\\ell$ 是无穷小的水平步长，$\\mathrm{d}z$ 是相应的垂直变化。中性斜率定义为 $s = \\mathrm{d}z/\\mathrm{d}\\ell$。\n\n为使此位移成为中性位移，它必须满足 $\\mathbf{n} \\cdot \\mathrm{d}\\mathbf{r} = 0$。代入参数化的位移：\n$$\n\\mathbf{n} \\cdot (\\mathbf{h}\\,\\mathrm{d}\\ell + \\hat{\\mathbf{z}}\\,\\mathrm{d}z) = 0\n$$\n$$\n(\\mathbf{n} \\cdot \\mathbf{h})\\,\\mathrm{d}\\ell + (\\mathbf{n} \\cdot \\hat{\\mathbf{z}})\\,\\mathrm{d}z = 0\n$$\n重新整理以求解斜率 $s = \\mathrm{d}z/\\mathrm{d}\\ell$：\n$$\n(\\mathbf{n} \\cdot \\hat{\\mathbf{z}})\\,\\mathrm{d}z = -(\\mathbf{n} \\cdot \\mathbf{h})\\,\\mathrm{d}\\ell \\implies \\frac{\\mathrm{d}z}{\\mathrm{d}\\ell} = - \\frac{\\mathbf{n} \\cdot \\mathbf{h}}{\\mathbf{n} \\cdot \\hat{\\mathbf{z}}}\n$$\n因此，中性斜率为：\n$$\ns = - \\frac{\\mathbf{n} \\cdot \\mathbf{h}}{\\mathbf{n} \\cdot \\hat{\\mathbf{z}}}\n$$\n中性角 $\\phi$ 是其正切为该斜率的角度：\n$$\n\\phi = \\arctan(s) = \\arctan\\left(- \\frac{\\mathbf{n} \\cdot \\mathbf{h}}{\\mathbf{n} \\cdot \\hat{\\mathbf{z}}}\\right)\n$$\n$\\mathbf{n}$ 的分量是 $n_x = \\beta \\frac{\\partial S_A}{\\partial x} - \\alpha \\frac{\\partial \\Theta}{\\partial x}$，$n_y = \\beta \\frac{\\partial S_A}{\\partial y} - \\alpha \\frac{\\partial \\Theta}{\\partial y}$，以及 $n_z = \\beta \\frac{\\partial S_A}{\\partial z} - \\alpha \\frac{\\partial \\Theta}{\\partial z} - \\kappa \\rho g$。点积 $\\mathbf{n} \\cdot \\hat{\\mathbf{z}}$ 就是垂直分量 $n_z$。点积 $\\mathbf{n} \\cdot \\mathbf{h}$ 只涉及 $\\mathbf{n}$ 和 $\\mathbf{h}$ 的水平分量，因为 $\\mathbf{h}$ 是一个水平向量 ($h_z=0$)。\n\n当分母 $\\mathbf{n} \\cdot \\hat{\\mathbf{z}} = n_z$ 为零时，会出现一个边界情况。这表示法向量 $\\mathbf{n}$ 是水平的，因此中性平面是垂直的。在这种情况下，斜率 $s$ 形式上是无穷大。角度 $\\phi$ 将是 $\\pm\\pi/2$。按照规定，符号由分子决定：\n$$\n\\phi = \\operatorname{sgn}(-\\mathbf{n}\\cdot \\mathbf{h})\\frac{\\pi}{2}\n$$\n这个规定等价于在 $n_z \\to 0$ 时取 $\\arctan(s)$ 的极限。\n\n计算算法如下：\n1.  定义物理常数：$\\rho = 1027\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，$g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$，$\\alpha = 2.1\\times 10^{-4}\\,\\mathrm{K}^{-1}$，$\\beta = 7.6\\times 10^{-4}\\,(\\mathrm{g}/\\mathrm{kg})^{-1}$，$\\kappa = 4.5\\times 10^{-10}\\,\\mathrm{Pa}^{-1}$。\n2.  预先计算 $\\kappa \\rho g$ 项。\n3.  对于每个测试用例，给定 $\\nabla \\Theta$、$\\nabla S_A$ 和 $\\mathbf{h}$：\n    a. 使用推导出的公式 $\\mathbf{n} = \\beta \\nabla S_A - \\alpha \\nabla \\Theta - \\kappa \\rho g \\hat{\\mathbf{z}}$ 计算法向量 $\\mathbf{n}$ 的三个分量。\n    b. 提取垂直分量 $n_z = \\mathbf{n} \\cdot \\hat{\\mathbf{z}}$。\n    c. 检查 $|n_z|$ 是否小于一个小的容差（例如，$10^{-12}$）以处理垂直平面的边界情况。\n    d. 如果是垂直平面，计算 $\\mathbf{n} \\cdot \\mathbf{h}$ 并计算 $\\phi = \\operatorname{sgn}(-\\mathbf{n}\\cdot \\mathbf{h})\\frac{\\pi}{2}$。\n    e. 否则，计算斜率 $s = -(\\mathbf{n} \\cdot \\mathbf{h}) / n_z$ 和角度 $\\phi = \\arctan(s)$。\n    f. 将得到的角度 $\\phi$（以弧度为单位）四舍五入到六位小数。\n4. 收集结果并将其格式化为指定的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the local neutral angle in the ocean based on TEOS-10.\n    \"\"\"\n    # Define physical constants given in the problem statement.\n    RHO = 1027.0  # kg/m^3\n    G = 9.81      # m/s^2\n    ALPHA = 2.1e-4  # K^-1\n    BETA = 7.6e-4   # (g/kg)^-1\n    KAPPA = 4.5e-10 # Pa^-1\n\n    # Define the test cases from the problem statement.\n    # Each case: (grad_Theta, grad_SA, h)\n    test_cases = [\n        (\n            np.array([5e-4, -3e-4, -1e-3]),\n            np.array([1e-4, 2e-4, 5e-5]),\n            np.array([np.cos(np.pi/6), np.sin(np.pi/6), 0])\n        ),\n        (\n            np.array([-5e-4, 2e-4, -1e-2]),\n            np.array([1e-4, -1e-4, 3.157e-3]),\n            np.array([1/np.sqrt(2), 1/np.sqrt(2), 0])\n        ),\n        (\n            np.array([0.0010854, 0, -2e-3]),\n            np.array([3e-4, 0, 1e-3]),\n            np.array([1.0, 0.0, 0.0])\n        ),\n        (\n            np.array([2e-4, 1e-4, -5e-4]),\n            np.array([5e-4, -2e-4, 0]),\n            np.array([0.0, 1.0, 0.0])\n        ),\n        (\n            np.array([-1e-3, 0, -1.258e-2]),\n            np.array([1e-3, 0, 2.5e-3]),\n            np.array([1.0, 0.0, 0.0])\n        ),\n    ]\n\n    results = []\n    \n    # Pre-compute the pressure term component based on hydrostatic balance.\n    kappa_rho_g = KAPPA * RHO * G\n    \n    for grad_Theta, grad_SA, h in test_cases:\n        # Calculate the normal vector 'n' to the neutral tangent plane.\n        # n = beta * grad_SA - alpha * grad_Theta - kappa * rho * g * z_hat\n        n = BETA * grad_SA - ALPHA * grad_Theta\n        n[2] -= kappa_rho_g\n\n        # The vertical component of the normal vector.\n        n_z = n[2]\n\n        # Handle the edge case of a vertical neutral plane.\n        # This occurs when the vertical component of the normal vector is zero.\n        # A small tolerance is used to account for floating-point inaccuracies.\n        if abs(n_z)  1e-12:\n            n_dot_h = np.dot(n, h)\n            # The angle is +/- pi/2, with the sign given by the problem spec.\n            phi = np.sign(-n_dot_h) * np.pi / 2\n            # If n_dot_h is also zero, the slope is indeterminate, but sgn(0)=0, so phi=0.\n            # This specific case does not occur in the test suite.\n        else:\n            # Calculate the neutral slope 's' along the horizontal direction 'h'.\n            # s = - (n . h) / (n . z_hat)\n            n_dot_h = np.dot(n, h)\n            slope = -n_dot_h / n_z\n            \n            # The neutral angle 'phi' is the arctangent of the slope.\n            phi = np.arctan(slope)\n        \n        # Append the result, rounded to six decimal places as required.\n        results.append(round(phi, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}