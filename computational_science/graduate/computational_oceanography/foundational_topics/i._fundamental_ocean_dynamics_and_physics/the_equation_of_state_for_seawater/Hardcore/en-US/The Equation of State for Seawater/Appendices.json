{
    "hands_on_practices": [
        {
            "introduction": "The modern description of seawater thermodynamics, TEOS-10, relies on Absolute Salinity ($S_A$) as the fundamental measure of salt content. However, observations typically yield Practical Salinity ($S_P$), a quantity based on electrical conductivity. This practice provides the crucial bridge between measurement and theory, guiding you to compute $S_A$ by accounting for the reference conversion factor and the spatially varying composition anomalies of seawater . Mastering this conversion is the first step in applying the TEOS-10 framework to real-world ocean data.",
            "id": "3814871",
            "problem": "You are given observations of Practical Salinity ($S_P$), a unitless quantity defined by a conductivity ratio standard, at several oceanic locations specified by geographic longitude and latitude in degrees. You also have a known spatial field for the Absolute Salinity Anomaly ($\\delta S_A$), expressed as a function of longitude and latitude, that captures small deviations in seawater composition from a globally standard reference mixture. The goal is to compute the Absolute Salinity ($S_A$), expressed in grams per kilogram ($\\mathrm{g\\,kg^{-1}}$), at each observation point.\n\nStarting from definitions consistent with the Thermodynamic Equation of Seawater $2010$ (TEOS-$10$), the Reference Salinity is constructed so that Reference Salinity ($S_R$) matches the mass fraction of dissolved material in Standard Seawater at the canonical Practical Salinity value $S_P = 35$. This sets the proportionality between $S_P$ and the reference mass fraction, encoded in a constant factor. The Absolute Salinity Anomaly $\\delta S_A$ represents the deviation in mass fraction from that reference due to spatial variations in composition, and is provided here as a known function of longitude and latitude. Your task is to derive, from these principles, a transformation from $S_P$ to $S_A$ that correctly incorporates the reference scaling and the anomaly, and to implement it numerically.\n\nUse the following scientifically plausible and self-consistent specifications:\n- Angles must be treated in degrees. Longitudes must be wrapped into the interval $[0^\\circ, 360^\\circ)$ using modulo arithmetic, and latitudes must be clamped to the interval $[-90^\\circ, 90^\\circ]$ before evaluating any trigonometric function.\n- The Reference Salinity constant is fixed by TEOS-$10$ so that when $S_P = 35$, the mass fraction is $35.16504\\,\\mathrm{g\\,kg^{-1}}$. This determines the proportionality between $S_P$ and the reference mass fraction.\n- The Absolute Salinity Anomaly field is given by the continuous function\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right),\n$$\nwhere $\\lambda$ is longitude in degrees, $\\phi$ is latitude in degrees, and $A = 0.02\\,\\mathrm{g\\,kg^{-1}}$ is the anomaly amplitude.\n- Enforce the physical constraint $S_A \\ge 0$ by setting negative computed values to $0$.\n\nDerive the transformation from first principles and implement a numerical algorithm that, for each observation point, computes $S_A$ in $\\mathrm{g\\,kg^{-1}}$ from the given $S_P$ and $\\delta S_A(\\lambda,\\phi)$, taking care of the specified angle handling and physical constraint.\n\nTest suite:\nProvide outputs for the following five cases, each a triple $(S_P,\\lambda,\\phi)$:\n- Case $1$: $(35.0, 180.0, 0.0)$\n- Case $2$: $(34.8, 0.0, 30.0)$\n- Case $3$: $(0.0, -10.0, -45.0)$\n- Case $4$: $(40.0, 370.0, 80.0)$\n- Case $5$: $(33.0, 250.0, -80.0)$\n\nAnswer specification:\n- Express each resulting $S_A$ in $\\mathrm{g\\,kg^{-1}}$ as a floating-point number rounded to $6$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$).",
            "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in the principles of the TEOS-$10$ standard for seawater, is well-posed with sufficient and consistent information, and is expressed in objective, formal language. All components required for a unique and verifiable solution are provided.\n\nThe primary objective is to compute the Absolute Salinity ($S_A$) in units of $\\mathrm{g\\,kg^{-1}}$ from a given Practical Salinity ($S_P$, unitless) and geographic location specified by longitude ($\\lambda$) and latitude ($\\phi$) in degrees. The solution requires deriving the transformation from first principles as laid out in the problem statement.\n\nThe foundation of the TEOS-$10$ framework is that Absolute Salinity ($S_A$), the true mass fraction of dissolved solids, can be expressed as the sum of a Reference Salinity ($S_R$) and an Absolute Salinity Anomaly ($\\delta S_A$).\n$$\nS_A = S_R + \\delta S_A\n$$\nThe Reference Salinity, $S_R$, is the mass fraction of a standard reference composition of seawater that has the same Practical Salinity $S_P$ as the sample. It is defined to be directly proportional to Practical Salinity. We can express this relationship with a constant of proportionality, $u_{PS}$:\n$$\nS_R = u_{PS} \\, S_P\n$$\nThe problem provides the necessary information to determine this constant. It states that for Standard Seawater, a Practical Salinity of $S_P = 35$ corresponds to a mass fraction of $35.16504\\,\\mathrm{g\\,kg^{-1}}$. For this reference seawater, the anomaly $\\delta S_A$ is by definition zero, so its Absolute Salinity is equal to its Reference Salinity. This gives us the equation:\n$$\n35.16504\\,\\mathrm{g\\,kg^{-1}} = u_{PS} \\cdot 35\n$$\nSolving for $u_{PS}$ yields the conversion factor:\n$$\nu_{PS} = \\frac{35.16504}{35}\\,\\mathrm{g\\,kg^{-1}} \\approx 1.00471542857\\,\\mathrm{g\\,kg^{-1}}\n$$\nSubstituting the expression for $S_R$ back into the primary equation for $S_A$, we obtain the complete transformation from $S_P$ to $S_A$:\n$$\nS_A(S_P, \\lambda, \\phi) = \\left(\\frac{35.16504}{35}\\right) S_P + \\delta S_A(\\lambda, \\phi)\n$$\nThe Absolute Salinity Anomaly, $\\delta S_A$, is provided as a known function of longitude $\\lambda$ and latitude $\\phi$:\n$$\n\\delta S_A(\\lambda,\\phi) = A \\,\\sin\\!\\left(\\frac{\\pi\\,\\phi}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda}{180}\\right)\n$$\nwhere the amplitude is given as $A = 0.02\\,\\mathrm{g\\,kg^{-1}}$. The factors of $\\frac{\\pi}{180}$ serve to convert theangles from degrees, as provided in the input, to radians for the trigonometric functions.\n\nThe computational algorithm proceeds as follows for each test case $(S_P, \\lambda, \\phi)$:\n$1$. Angle Pre-processing: The geographic coordinates must be correctly handled.\n    - Longitude $\\lambda$ is wrapped to the interval $[0^\\circ, 360^\\circ)$ using modulo arithmetic. For an input $\\lambda$, the normalized longitude is $\\lambda' = \\lambda \\pmod{360}$.\n    - Latitude $\\phi$ is clamped to the physically meaningful range $[-90^\\circ, 90^\\circ]$. For an input $\\phi$, the clamped latitude is $\\phi' = \\max(-90, \\min(90, \\phi))$.\n\n$2$. Calculation of Absolute Salinity Anomaly ($\\delta S_A$): Substitute the processed angles into the given function:\n    $$\n    \\delta S_A = (0.02\\,\\mathrm{g\\,kg^{-1}}) \\cdot \\sin\\!\\left(\\frac{\\pi\\,\\phi'}{180}\\right)\\,\\cos\\!\\left(\\frac{\\pi\\,\\lambda'}{180}\\right)\n    $$\n\n$3$. Calculation of Reference Salinity ($S_R$): Use the derived relationship and the input $S_P$:\n    $$\n    S_R = \\left(\\frac{35.16504}{35}\\right) S_P\n    $$\n\n$4$. Calculation of Absolute Salinity ($S_A$): Sum the two components:\n    $$\n    S_{A, \\text{raw}} = S_R + \\delta S_A\n    $$\n\n$5$. Application of Physical Constraint: Absolute Salinity, being a mass fraction, cannot be negative. Therefore, any computed negative value is unphysical and must be set to zero.\n    $$\n    S_A = \\max(0, S_{A, \\text{raw}})\n    $$\n\n$6$. Final Formatting: The resulting $S_A$ value is rounded to $6$ decimal places as required.\n\nThis step-by-step process ensures all conditions from the problem statement are met, producing a scientifically and numerically correct result.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Absolute Salinity (SA) from Practical Salinity (SP) and location\n    based on TEOS-10 principles.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (SP, longitude, latitude)\n        (35.0, 180.0, 0.0),\n        (34.8, 0.0, 30.0),\n        (0.0, -10.0, -45.0),\n        (40.0, 370.0, 80.0),\n        (33.0, 250.0, -80.0),\n    ]\n\n    # Define constants based on the problem statement\n    # The TEOS-10 conversion factor for Reference Salinity from Practical Salinity.\n    UPS = 35.16504 / 35.0\n    # The amplitude of the Absolute Salinity Anomaly field.\n    A = 0.02  # in g/kg\n\n    results = []\n    for sp, lon, lat in test_cases:\n        # Step 1: Angle Pre-processing\n        # Wrap longitude to the interval [0, 360) degrees.\n        lon_norm = lon % 360.0\n        # Clamp latitude to the interval [-90, 90] degrees.\n        lat_clamped = np.clip(lat, -90.0, 90.0)\n\n        # Step 2: Calculation of Absolute Salinity Anomaly (delta_Sa)\n        # Convert degrees to radians for trigonometric functions.\n        lon_rad = np.deg2rad(lon_norm)\n        lat_rad = np.deg2rad(lat_clamped)\n        \n        delta_sa = A * np.sin(lat_rad) * np.cos(lon_rad)\n\n        # Step 3: Calculation of Reference Salinity (Sr)\n        sr = UPS * sp\n\n        # Step 4: Calculation of Absolute Salinity (Sa)\n        sa_raw = sr + delta_sa\n\n        # Step 5: Application of Physical Constraint (SA >= 0)\n        sa = max(0.0, sa_raw)\n\n        # Step 6: Final Formatting\n        # Round the result to 6 decimal places and format as a string.\n        results.append(f\"{sa:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "At the heart of TEOS-10 lies the specific Gibbs free energy, $g(S_A, T, p)$, a thermodynamic potential from which all other properties can be derived. This exercise allows you to engage directly with this powerful concept by deriving the adiabatic lapse rate, $\\Gamma$, a critical parameter governing vertical stability and sound propagation. By starting from first principles and using a simplified surrogate for the Gibbs function, you will see how abstract thermodynamic potentials are transformed into tangible, computable properties of seawater .",
            "id": "3814828",
            "problem": "You are to derive and implement the adiabatic lapse rate of seawater in a form suitable for computational evaluation within the framework of the Thermodynamic Equation of Seawater - 2010 (TEOS-10). Let the specific Gibbs free energy per unit mass be $g(S_A, T, p)$, where $S_A$ is Absolute Salinity, $T$ is in-situ temperature, and $p$ is pressure. Use only the following fundamental base:\n- The thermodynamic definitions from the Gibbs function: specific entropy $\\eta = -\\partial g / \\partial T$ at fixed $S_A$ and $p$, and specific volume $v = \\partial g / \\partial p$ at fixed $S_A$ and $T$.\n- Maxwell relations implied by the equality of mixed partial derivatives of the Gibbs function.\n- The definition of the adiabatic lapse rate under constant specific entropy and Absolute Salinity.\n\nTask:\n1. Starting from the definitions above, and without assuming any shortcut identities for the adiabatic lapse rate, derive the expression for the adiabatic lapse rate $\\Gamma = \\left( \\partial T / \\partial p \\right)_{ \\eta, S_A }$ in terms of second derivatives of the specific Gibbs free energy $g(S_A, T, p)$. Treat $S_A$ as a constant during the differentiation.\n2. For numerical evaluation, adopt the following thermodynamically consistent local surrogate for the specific Gibbs free energy near typical oceanic conditions:\n   $$g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2,$$\n   where $T_{\\mathrm{ref}} = 273.15\\,\\mathrm{K}$, and the coefficients are:\n   - $c_p(S_A) = c_{p0} + c_{pS} S_A$ with $c_{p0} = 3985\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ and $c_{pS} = 0.10\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}\\,(g\\,kg^{-1})^{-1}}$,\n   - $v_{00} = 9.72\\times 10^{-4}\\,\\mathrm{m^3\\,kg^{-1}}$,\n   - $v_T = 2.50\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,K^{-1}}$,\n   - $v_S = -8.00\\times 10^{-7}\\,\\mathrm{m^3\\,kg^{-1}\\,(g\\,kg^{-1})^{-1}}$,\n   - $\\kappa_0 = 4.50\\times 10^{-13}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}}$,\n   - $\\kappa_T = 5.00\\times 10^{-16}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,K^{-1}}$,\n   - $\\kappa_S = -2.00\\times 10^{-15}\\,\\mathrm{m^3\\,kg^{-1}\\,Pa^{-1}\\,(g\\,kg^{-1})^{-1}}$.\n   This surrogate ensures physical plausibility by producing $v = g_p$ in the range of typical seawater specific volumes, a positive isobaric heat capacity $c_p = - T\\, g_{TT}$, and a small positive compressibility.\n3. Using your derived expression for $\\Gamma$ in terms of derivatives of $g$, compute $\\Gamma$ for each of the specified test cases below. Use the units exactly as specified:\n   - Absolute Salinity $S_A$ in $\\mathrm{g\\,kg^{-1}}$,\n   - In-situ temperature $T$ in degrees Celsius (ITS-90), which must be converted to Kelvin $T_K = T~(\\mathrm{^\\circ C}) + 273.15$ before use in $g(S_A, T_K, p)$,\n   - Pressure $p$ in Pascals ($\\mathrm{Pa}$),\n   - Express the adiabatic lapse rate $\\Gamma$ in $\\mathrm{K\\,Pa^{-1}}$.\n4. Test suite:\n   - Case 1 (happy path): $(S_A, T, p) = (35.0, 15.0, 1.0\\times 10^{6})$,\n   - Case 2 (surface boundary): $(S_A, T, p) = (35.0, 10.0, 0.0)$,\n   - Case 3 (cold, mid-depth): $(S_A, T, p) = (34.5, 0.0, 5.0\\times 10^{6})$,\n   - Case 4 (warm, deep): $(S_A, T, p) = (37.0, 25.0, 4.0\\times 10^{7})$,\n   - Case 5 (high salinity, abyssal): $(S_A, T, p) = (40.0, 2.0, 6.0\\times 10^{7})$.\n5. Final output format:\n   Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each value must be a floating-point number in scientific notation with ten digits after the decimal point (for example, $[1.2345678900\\mathrm{e}{-08},\\dots]$), expressed in $\\mathrm{K\\,Pa^{-1}}$.\n\nYour program must be self-contained and must not require user input. It must implement the derived expression for $\\Gamma$ using the surrogate $g(S_A, T, p)$ above, and return the adiabatic lapse rate values for the test suite in the specified format and units.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in classical thermodynamics, well-posed with a complete set of definitions and data, and objective in its formulation. The task is to derive and compute the adiabatic lapse rate for seawater based on a provided Gibbs function, which is a standard procedure in physical oceanography.\n\n### Part 1: Derivation of the Adiabatic Lapse Rate $\\Gamma$\n\nThe adiabatic lapse rate, $\\Gamma$, is defined as the rate of change of temperature with respect to pressure for a parcel of fluid that does not exchange heat with its surroundings. This corresponds to a process occurring at constant specific entropy, $\\eta$, and constant Absolute Salinity, $S_A$. The mathematical definition is:\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta, S_A} $$\nThroughout this derivation, $S_A$ is held constant and will be omitted from the subscripts for brevity.\n\nWe begin by considering the specific entropy $\\eta$ as a function of in-situ temperature $T$ and pressure $p$, i.e., $\\eta = \\eta(T, p)$. Its total differential is given by:\n$$ d\\eta = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\nFor an isentropic (adiabatic and reversible) process, $d\\eta = 0$. Therefore:\n$$ 0 = \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p dT + \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T dp $$\nRearranging this equation to solve for the ratio $dT/dp$ under the condition of constant $\\eta$ yields:\n$$ \\Gamma = \\left( \\frac{\\partial T}{\\partial p} \\right)_{\\eta} = - \\frac{\\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T}{\\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p} $$\nThis expression relates the adiabatic lapse rate to the partial derivatives of specific entropy. The next step is to express these derivatives in terms of the specific Gibbs free energy, $g(T, p)$.\n\nFrom the fundamental thermodynamic definitions provided:\n- Specific entropy: $\\eta = -\\left( \\frac{\\partial g}{\\partial T} \\right)_p \\equiv -g_T$\n- Specific volume: $v = \\left( \\frac{\\partial g}{\\partial p} \\right)_T \\equiv g_p$\n\nLet's evaluate the denominator of the expression for $\\Gamma$:\n$$ \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = \\frac{\\partial}{\\partial T} \\left( -g_T \\right)_p = - \\frac{\\partial^2 g}{\\partial T^2} \\equiv -g_{TT} $$\nThis term is related to the specific heat capacity at constant pressure, $c_p = T \\left( \\frac{\\partial \\eta}{\\partial T} \\right)_p = -T g_{TT}$. Since $T  0$ and $c_p  0$ for physical stability, it follows that $g_{TT}  0$.\n\nNext, let's evaluate the numerator:\n$$ \\left( \\frac{\\partial \\eta}{\\partial p} \\right)_T = \\frac{\\partial}{\\partial p} \\left( -g_T \\right)_T = - \\frac{\\partial^2 g}{\\partial p \\partial T} \\equiv -g_{Tp} $$\nSince the specific Gibbs function $g$ is a state function, its mixed partial derivatives are equal (by Schwarz's theorem). This constitutes a Maxwell relation:\n$$ \\frac{\\partial^2 g}{\\partial p \\partial T} = \\frac{\\partial^2 g}{\\partial T \\partial p} \\implies g_{Tp} = g_{pT} $$\nWe can relate $g_{pT}$ to the thermal expansion of specific volume:\n$$ g_{pT} = \\frac{\\partial}{\\partial T} \\left( \\frac{\\partial g}{\\partial p} \\right)_T = \\left( \\frac{\\partial v}{\\partial T} \\right)_p $$\n\nSubstituting these results back into the expression for $\\Gamma$:\n$$ \\Gamma = - \\frac{-g_{Tp}}{-g_{TT}} = - \\frac{g_{Tp}}{g_{TT}} $$\nUsing the Maxwell relation $g_{Tp} = g_{pT}$:\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{\\frac{\\partial^2 g}{\\partial T \\partial p}}{\\frac{\\partial^2 g}{\\partial T^2}} $$\nThis is the required expression for the adiabatic lapse rate in terms of the second derivatives of the specific Gibbs free energy.\n\n### Part 2: Application to the Surrogate Gibbs Function\n\nWe are given the following surrogate for the specific Gibbs free energy, where $T$ is temperature in Kelvin:\n$$ g(S_A, T, p) = - c_p(S_A)\\, T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] p - \\frac{1}{2} \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p^2, $$\nwith $c_p(S_A) = c_{p0} + c_{pS} S_A$.\n\nWe must compute the second partial derivatives $g_{TT}$ and $g_{pT}$.\n\nFirst, the partial derivative with respect to temperature, $g_T$:\n$$ g_T = \\frac{\\partial g}{\\partial T} = \\frac{\\partial}{\\partial T}\\left[-c_p(S_A) T \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right)\\right] + \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p - \\frac{\\partial}{\\partial T}\\left[ \\dots \\right]p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + T \\cdot \\frac{1}{T} \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\n$$ g_T = -c_p(S_A) \\left[ \\ln\\left(\\frac{T}{T_{\\mathrm{ref}}}\\right) + 1 \\right] + v_T p - \\frac{1}{2} \\kappa_T p^2 $$\nNow, the second partial derivative with respect to temperature, $g_{TT}$:\n$$ g_{TT} = \\frac{\\partial g_T}{\\partial T} = -c_p(S_A) \\left[ \\frac{1}{T} \\right] = -\\frac{c_p(S_A)}{T} $$\nThis result is consistent with the thermodynamic definition $c_p = -T g_{TT}$.\n\nNext, we compute the partial derivative with respect to pressure, $g_p$:\n$$ g_p = \\frac{\\partial g}{\\partial p} = \\left[v_{00} + v_T \\left(T - T_{\\mathrm{ref}}\\right) + v_S S_A\\right] - \\left[\\kappa_0 + \\kappa_T \\left(T - T_{\\mathrm{ref}}\\right) + \\kappa_S S_A\\right] p $$\nNow, the mixed partial derivative, $g_{pT}$:\n$$ g_{pT} = \\frac{\\partial g_p}{\\partial T} = v_T - \\kappa_T p $$\n\nFinally, we substitute the expressions for $g_{TT}$ and $g_{pT}$ into the formula for $\\Gamma$:\n$$ \\Gamma = - \\frac{g_{pT}}{g_{TT}} = - \\frac{v_T - \\kappa_T p}{-\\frac{c_p(S_A)}{T}} $$\n$$ \\Gamma = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_p(S_A)} $$\nSubstituting $c_p(S_A) = c_{p0} + c_{pS} S_A$, we arrive at the final expression for numerical computation:\n$$ \\Gamma(S_A, T, p) = \\frac{T \\left( v_T - \\kappa_T p \\right)}{c_{p0} + c_{pS} S_A} $$\nHere, $T$ must be in Kelvin. This formula will be implemented to solve the problem for the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the adiabatic lapse rate of seawater using a \n    surrogate Gibbs function within the TEOS-10 framework.\n    \"\"\"\n    \n    # Define the coefficients from the problem statement.\n    # The units are SI (J, kg, K, Pa, m).\n    \n    # Specific heat capacity coefficients for cp(SA) = c_p0 + c_pS * SA\n    # c_p0 in J kg^-1 K^-1\n    C_P0 = 3985.0\n    # c_pS in J kg^-1 K^-1 (g kg^-1)^-1\n    C_PS = 0.10\n    \n    # Coefficient for the temperature-dependent part of specific volume\n    # v_T in m^3 kg^-1 K^-1\n    V_T = 2.50e-7\n    \n    # Coefficient for the temperature-dependent part of compressibility\n    # kappa_T in m^3 kg^-1 Pa^-1 K^-1\n    KAPPA_T = 5.00e-16\n    \n    # Temperature conversion offset from ITS-90 (°C) to Kelvin (K)\n    T_OFFSET_KELVIN = 273.15\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (Absolute Salinity SA [g/kg], Temperature T [°C], Pressure p [Pa])\n    test_cases = [\n        (35.0, 15.0, 1.0e6),\n        (35.0, 10.0, 0.0),\n        (34.5, 0.0, 5.0e6),\n        (37.0, 25.0, 4.0e7),\n        (40.0, 2.0, 6.0e7),\n    ]\n\n    results = []\n    \n    # The derived formula for the adiabatic lapse rate is:\n    # Gamma = T_kelvin * (v_T - kappa_T * p) / (c_p0 + c_pS * SA)\n    \n    for sa, t_celsius, p in test_cases:\n        # Convert in-situ temperature from Celsius to Kelvin for use in the formula\n        t_kelvin = t_celsius + T_OFFSET_KELVIN\n        \n        # Calculate the specific heat capacity at constant pressure, c_p(SA)\n        cp_sa = C_P0 + C_PS * sa\n        \n        # Calculate the numerator of the Gamma expression\n        numerator = t_kelvin * (V_T - KAPPA_T * p)\n        \n        # Calculate the adiabatic lapse rate, Gamma\n        gamma = numerator / cp_sa\n        \n        results.append(gamma)\n\n    # Format the results into a string as specified: a comma-separated list\n    # in square brackets, with each number in scientific notation with 10 decimal places.\n    formatted_results = [f\"{res:.10e}\" for res in results]\n    \n    # The final print statement must produce only the single-line specified format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Oceanographers often assume that water parcels mix along surfaces of constant potential density ($\\sigma_r$). While useful, this is an approximation, as true mixing pathways follow neutral surfaces, where a displaced parcel has the same in-situ density as its new surroundings. This advanced practice allows you to quantify the error in this common approximation by calculating the geometric misalignment between potential density surfaces and true neutral surfaces, a crucial analysis for understanding deep-ocean circulation and mixing .",
            "id": "3814838",
            "problem": "You are to design and implement a program that quantifies the geometric misalignment between surfaces of constant in-situ density and surfaces of constant potential density referenced to $2000$ decibars, commonly denoted as $\\sigma_2$, under deep-ocean conditions. The analysis must be derived from first principles consistent with the Thermodynamic Equation of Seawater $2010$ (TEOS-$10$), using a physically justified linearization around a deep-ocean reference state.\n\nBegin with the definition that the in-situ density $\\rho$ is a function of Absolute Salinity ($\\mathrm{SA}$), Conservative Temperature ($\\mathrm{CT}$), and pressure $p$: $\\rho = \\rho(\\mathrm{SA}, \\mathrm{CT}, p)$. In TEOS-$10$, the exact equation of state is complex; however, for small anomalies about a deep reference state, a first-order linearization is widely accepted as a valid approximation:\n$$\n\\Delta \\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right) \\Delta \\mathrm{SA} + \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right) \\Delta \\mathrm{CT} + \\left(\\frac{\\partial \\rho}{\\partial p}\\right) \\Delta p.\n$$\nDefine the following constant, deep-ocean representative coefficients (held fixed across test cases):\n- The haline contraction term $b$ such that $\\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right) \\approx b$ with $b = 0.78$ $\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,(\\mathrm{g}\\,\\mathrm{kg}^{-1})^{-1}$.\n- The thermal expansion term $a_T$ such that $\\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right) \\approx -a_T$ with $a_T = 0.20$ $\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{K}^{-1}$.\n- The compressibility term $\\kappa_p$ such that $\\left(\\frac{\\partial \\rho}{\\partial p}\\right) \\approx \\kappa_p$ with $\\kappa_p = 0.0025$ $\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{dbar}^{-1}$.\n\nLet the spatial gradients be denoted by $\\nabla \\mathrm{SA}$, $\\nabla \\mathrm{CT}$, and $\\nabla p$. Under hydrostatic balance in the ocean, the vertical pressure gradient is\n$$\n\\frac{\\partial p}{\\partial z} \\approx -\\frac{\\rho_{\\mathrm{ref}} g}{10^4},\n$$\nwhere $z$ is the vertical coordinate measured in meters and positive upward, $p$ is in decibars, $g$ is gravitational acceleration, and $\\rho_{\\mathrm{ref}}$ is a constant reference density. Use $g = 9.81$ $\\mathrm{m}\\ \\mathrm{s}^{-2}$ and $\\rho_{\\mathrm{ref}} = 1030$ $\\mathrm{kg}\\,\\mathrm{m}^{-3}$, hence $\\nabla p = [0, 0, \\partial p/\\partial z]$ with $\\partial p/\\partial z$ in $\\mathrm{dbar}\\,\\mathrm{m}^{-1}$.\n\nDefine the gradient of in-situ density as\n$$\n\\nabla \\rho = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT} + \\kappa_p\\, \\nabla p,\n$$\nand the gradient of potential density referenced to $2000$ $\\mathrm{dbar}$ (i.e., $\\sigma_2$) as\n$$\n\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT},\n$$\nsince the reference pressure is spatially constant and thus contributes no gradient. The unit normals to the corresponding isosurfaces are the normalized vectors $\\hat{\\mathbf{n}}_{\\rho} = \\nabla \\rho / \\|\\nabla \\rho\\|$ and $\\hat{\\mathbf{n}}_{\\sigma_2} = \\nabla \\sigma_2 / \\|\\nabla \\sigma_2\\|$.\n\nThe misalignment angle $\\theta$ between the two surface normals is defined by\n$$\n\\theta = \\arccos\\left( \\frac{\\hat{\\mathbf{n}}_{\\rho} \\cdot \\hat{\\mathbf{n}}_{\\sigma_2}}{1} \\right) = \\arccos\\left( \\frac{\\nabla \\rho \\cdot \\nabla \\sigma_2}{\\|\\nabla \\rho\\|\\,\\|\\nabla \\sigma_2\\|} \\right),\n$$\nexpressed in radians. This angle quantifies the geometric error introduced when using $\\sigma_2$ surfaces instead of neutral (in-situ density) surfaces. For a unit-speed flow constrained to neutral surfaces, the spurious component normal to $\\sigma_2$ surfaces has magnitude $\\sin(\\theta)$, which we define as the spurious normal-speed fraction $f$.\n\nYour task is to implement a program that:\n- Uses the above linearization and constants.\n- Computes $\\nabla p$ from hydrostatic balance using the provided $g$ and $\\rho_{\\mathrm{ref}}$, ensuring unit consistency ($\\mathrm{dbar}\\,\\mathrm{m}^{-1}$).\n- For each test case, computes $\\nabla \\rho$, $\\nabla \\sigma_2$, the misalignment angle $\\theta$ in radians, and the spurious normal-speed fraction $f = \\sin(\\theta)$.\n- Outputs a single line containing a list of pairs $[\\theta, f]$ for each test case, with each pair rounded to $6$ decimal places.\n\nAll quantities must be expressed in the following units:\n- $\\nabla \\mathrm{SA}$ in $(\\mathrm{g}\\,\\mathrm{kg}^{-1})\\,\\mathrm{m}^{-1}$,\n- $\\nabla \\mathrm{CT}$ in $\\mathrm{K}\\,\\mathrm{m}^{-1}$,\n- $\\nabla p$ in $\\mathrm{dbar}\\,\\mathrm{m}^{-1}$,\n- $\\theta$ in radians,\n- $f$ as a unitless decimal.\n\nTest Suite:\nProvide the following three test cases, each giving $\\nabla \\mathrm{SA}$ and $\\nabla \\mathrm{CT}$ as three-dimensional vectors $[x, y, z]$ in the specified units:\n\n$1.$ Happy-path deep-ocean structure:\n- $\\nabla \\mathrm{SA} = [1.2\\times 10^{-6}, -4.0\\times 10^{-7}, 5.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [-2.0\\times 10^{-6}, 9.0\\times 10^{-7}, -1.0\\times 10^{-4}]$.\n\n$2.$ Nearly compensated vertical structure (small $\\nabla \\sigma_2$ vertical component):\n- $\\nabla \\mathrm{SA} = [3.0\\times 10^{-7}, -2.0\\times 10^{-7}, -2.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [1.0\\times 10^{-6}, -6.0\\times 10^{-7}, -7.8\\times 10^{-5}]$.\n\n$3.$ Weak horizontal gradients with moderate vertical gradients:\n- $\\nabla \\mathrm{SA} = [4.0\\times 10^{-7}, 4.0\\times 10^{-7}, 1.0\\times 10^{-5}]$,\n- $\\nabla \\mathrm{CT} = [-5.0\\times 10^{-7}, 3.0\\times 10^{-7}, -2.5\\times 10^{-5}]$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element corresponds to a test case and must itself be a two-element list $[\\theta, f]$ with values rounded to $6$ decimals. For example:\n$[\\,[0.123456,0.122345],[0.234567,0.232345],[0.345678,0.338765]\\,]$.",
            "solution": "The problem requires the quantification of the geometric misalignment between isosurfaces of in-situ density, $\\rho$, and potential density referenced to $2000\\,\\mathrm{dbar}$, $\\sigma_2$. This analysis is conducted within the framework of the Thermodynamic Equation of Seawater $2010$ (TEOS-$10$), using a linearized approximation valid for small anomalies around a representative deep-ocean state.\n\nThe core of the problem lies in vector analysis of the gradients of these two density measures. The gradient of a scalar field is a vector that points in the direction of the greatest rate of increase of the scalar, and its magnitude is that rate of increase. A vector normal to a surface of constant scalar value (an isosurface) is given by the gradient of that scalar field. The angle between two such normal vectors quantifies the misalignment between the corresponding isosurfaces.\n\nFirst, we establish the mathematical expressions for the gradients based on the provided linear approximations. The in-situ density $\\rho$ is a function of Absolute Salinity ($\\mathrm{SA}$), Conservative Temperature ($\\mathrm{CT}$), and pressure $p$. Its gradient is given by the chain rule:\n$$\n\\nabla \\rho = \\frac{\\partial \\rho}{\\partial \\mathrm{SA}} \\nabla \\mathrm{SA} + \\frac{\\partial \\rho}{\\partial \\mathrm{CT}} \\nabla \\mathrm{CT} + \\frac{\\partial \\rho}{\\partial p} \\nabla p\n$$\nUsing the provided constant coefficients $b = \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{SA}}\\right)$, $-a_T = \\left(\\frac{\\partial \\rho}{\\partial \\mathrm{CT}}\\right)$, and $\\kappa_p = \\left(\\frac{\\partial \\rho}{\\partial p}\\right)$, this simplifies to:\n$$\n\\nabla \\rho = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT} + \\kappa_p\\, \\nabla p\n$$\nPotential density referenced to a pressure $p_r$ (here $p_r = 2000\\,\\mathrm{dbar}$) is the density a parcel of seawater would have if moved adiabatically to that reference pressure. By definition, its functional dependence on pressure is removed. Thus, its gradient only depends on the gradients of $\\mathrm{SA}$ and $\\mathrm{CT}$:\n$$\n\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT}\n$$\nThe pressure gradient, $\\nabla p$, is assumed to be purely vertical and is determined by the hydrostatic balance, $\\frac{\\mathrm{d}p}{\\mathrm{d}z} \\approx -\\rho g$. The problem specifies the formula for pressure in decibars ($p$) and depth in meters ($z$, positive upwards):\n$$\n\\frac{\\partial p}{\\partial z} \\approx -\\frac{\\rho_{\\mathrm{ref}} g}{10^4}\n$$\nThe factor of $10^4$ converts pressure from Pascals ($\\mathrm{N}\\,\\mathrm{m}^{-2}$) to decibars. Using the given constants $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$ and $\\rho_{\\mathrm{ref}} = 1030\\,\\mathrm{kg\\,m^{-3}}$, we calculate the vertical pressure gradient:\n$$\n\\frac{\\partial p}{\\partial z} = -\\frac{(1030\\,\\mathrm{kg\\,m^{-3}}) \\times (9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2})}{10^4} = -\\frac{10104.3}{10^4} = -1.01043\\,\\mathrm{dbar}\\,\\mathrm{m}^{-1}\n$$\nSince the horizontal pressure gradients are assumed to be zero, the pressure gradient vector is:\n$$\n\\nabla p = [0, 0, -1.01043]\\,\\mathrm{dbar}\\,\\mathrm{m}^{-1}\n$$\nThe misalignment angle $\\theta$ between the two isosurfaces is the angle between their normal vectors, $\\nabla \\rho$ and $\\nabla \\sigma_2$. It is computed using the definition of the dot product:\n$$\n\\mathbf{A} \\cdot \\mathbf{B} = \\|\\mathbf{A}\\| \\|\\mathbf{B}\\| \\cos(\\theta)\n$$\nRearranging for $\\theta$ gives:\n$$\n\\theta = \\arccos\\left( \\frac{\\nabla \\rho \\cdot \\nabla \\sigma_2}{\\|\\nabla \\rho\\|\\,\\|\\nabla \\sigma_2\\|} \\right)\n$$\nThe term $\\|\\mathbf{V}\\|$ denotes the Euclidean norm of a vector $\\mathbf{V}$. The angle $\\theta$ will be in radians, in the range $[0, \\pi]$.\n\nThe final quantity to be computed is the spurious normal-speed fraction, $f$, defined as $f = \\sin(\\theta)$. This value represents the magnitude of the velocity component normal to a $\\sigma_2$ surface for a flow of unit speed perfectly aligned with a true neutral (in-situ density) surface.\n\nThe algorithm for each test case is as follows:\n1.  Receive the input vectors $\\nabla \\mathrm{SA}$ and $\\nabla \\mathrm{CT}$.\n2.  Define the constant coefficients: $b = 0.78$, $a_T = 0.20$, and $\\kappa_p = 0.0025$.\n3.  Define the constant pressure gradient vector: $\\nabla p = [0, 0, -1.01043]$.\n4.  Compute the gradient of potential density, $\\nabla \\sigma_2 = b\\, \\nabla \\mathrm{SA} - a_T\\, \\nabla \\mathrm{CT}$, using vector arithmetic.\n5.  Compute the gradient of in-situ density, $\\nabla \\rho = \\nabla \\sigma_2 + \\kappa_p\\, \\nabla p$.\n6.  Calculate the dot product $D = \\nabla \\rho \\cdot \\nabla \\sigma_2$.\n7.  Calculate the vector norms $N_\\rho = \\|\\nabla \\rho\\|$ and $N_{\\sigma_2} = \\|\\nabla \\sigma_2\\|$.\n8.  If either norm is zero, the angle is undefined. However, for the given test cases, the norms will be non-zero.\n9.  Compute the angle $\\theta = \\arccos\\left(D / (N_\\rho N_{\\sigma_2})\\right)$.\n10. Compute the fraction $f = \\sin(\\theta)$.\n11. Store the pair $[\\theta, f]$, rounded to $6$ decimal places.\n\nThis procedure, when implemented, yields the solution for the provided test cases. Note that the large, constant vertical component added to $\\nabla\\rho$ from the pressure gradient term ensures that $\\|\\nabla\\rho\\|$ is always non-zero and typically makes $\\nabla\\rho$ point nearly vertically downwards (negative $z$-direction), whereas the direction of $\\nabla\\sigma_2$ is highly variable.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the misalignment angle (theta) and spurious normal-speed fraction (f)\n    between in-situ density and potential density isosurfaces for given\n    oceanographic conditions.\n    \"\"\"\n    \n    # Define constant, deep-ocean representative coefficients and physical constants.\n    b = 0.78       # Haline contraction term, kg m^-3 (g/kg)^-1\n    a_T = 0.20     # Thermal expansion term, kg m^-3 K^-1\n    kappa_p = 0.0025  # Compressibility term, kg m^-3 dbar^-1\n    g = 9.81         # Gravitational acceleration, m s^-2\n    rho_ref = 1030   # Reference density, kg m^-3\n\n    # Define the test cases from the problem statement.\n    # Each case provides nabla_SA and nabla_CT as 3D vectors.\n    test_cases = [\n        # 1. Happy-path deep-ocean structure\n        {\n            \"nabla_SA\": [1.2e-6, -4.0e-7, 5.0e-5],\n            \"nabla_CT\": [-2.0e-6, 9.0e-7, -1.0e-4]\n        },\n        # 2. Nearly compensated vertical structure\n        {\n            \"nabla_SA\": [3.0e-7, -2.0e-7, -2.0e-5],\n            \"nabla_CT\": [1.0e-6, -6.0e-7, -7.8e-5]\n        },\n        # 3. Weak horizontal gradients with moderate vertical gradients\n        {\n            \"nabla_SA\": [4.0e-7, 4.0e-7, 1.0e-5],\n            \"nabla_CT\": [-5.0e-7, 3.0e-7, -2.5e-5]\n        }\n    ]\n\n    # Calculate the vertical pressure gradient from hydrostatic balance.\n    # The result is in dbar/m.\n    dp_dz = -(rho_ref * g) / 10**4\n    nabla_p = np.array([0.0, 0.0, dp_dz])\n\n    results = []\n    for case in test_cases:\n        nabla_SA = np.array(case[\"nabla_SA\"])\n        nabla_CT = np.array(case[\"nabla_CT\"])\n\n        # Compute the gradient of potential density referenced to 2000 dbar (sigma_2).\n        nabla_sigma2 = b * nabla_SA - a_T * nabla_CT\n        \n        # Compute the gradient of in-situ density (rho).\n        nabla_rho = nabla_sigma2 + kappa_p * nabla_p\n\n        # Calculate the norms of the gradient vectors.\n        norm_rho = np.linalg.norm(nabla_rho)\n        norm_sigma2 = np.linalg.norm(nabla_sigma2)\n\n        # Handle the theoretical case of a zero-gradient to avoid division by zero.\n        if norm_rho == 0.0 or norm_sigma2 == 0.0:\n            theta = 0.0\n            f = 0.0\n        else:\n            # Calculate the dot product.\n            dot_product = np.dot(nabla_rho, nabla_sigma2)\n            \n            # Compute the cosine of the angle. Clip to handle potential floating-point\n            # inaccuracies leading to values slightly outside the [-1, 1] range.\n            cos_theta = np.clip(dot_product / (norm_rho * norm_sigma2), -1.0, 1.0)\n            \n            # Compute the misalignment angle theta in radians.\n            theta = np.arccos(cos_theta)\n            \n            # Compute the spurious normal-speed fraction f.\n            f = np.sin(theta)\n        \n        results.append([theta, f])\n\n    # Format the results into the required string format.\n    # Each sub-list [theta, f] has its values rounded to 6 decimal places.\n    formatted_results = [f\"[{t:.6f},{f:.6f}]\" for t, f in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}