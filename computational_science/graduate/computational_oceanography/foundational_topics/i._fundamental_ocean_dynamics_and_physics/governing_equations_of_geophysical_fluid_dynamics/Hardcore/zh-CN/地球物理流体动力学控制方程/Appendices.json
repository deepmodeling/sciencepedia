{
    "hands_on_practices": [
        {
            "introduction": "我们首先来探究地球自转的最纯粹动力学效应。通过分析一个不受压力梯度或摩擦力影响的流体质点，我们可以揭示仅由科里奥利力主导的运动形式。这项练习  将引导你推导出这些“惯性振荡”的频率，并计算它们的周期，这是海洋中的一个基本时间尺度，对设计观测策略具有至关重要的意义。",
            "id": "3794422",
            "problem": "考虑在纬度为 $\\phi$ 的地球局部切平面上，在地球固定旋转参考系中观测到的水平均匀、无粘性流动。从旋转参考系中的牛顿第二定律和包含科里奥利力的水平动量方程出发，假设没有水平压力梯度和摩擦力，推导惯性振荡的角频率和相应的惯性周期作为纬度 $\\phi$ 的函数。取地球自转速率为 $\\Omega = 7.2921159 \\times 10^{-5} \\, \\mathrm{s^{-1}}$，科里奥利参数为 $f(\\phi) = 2 \\Omega \\sin \\phi$。计算在 $\\phi = 0^{\\circ}$、$\\phi = 30^{\\circ}$ 和 $\\phi = 60^{\\circ}$ 时的惯性周期。将每个周期以小时为单位表示，并将数值答案四舍五入到四位有效数字。角度必须以度为单位处理。最后，利用奈奎斯特-香农采样定理，解释这些值对于旨在无混叠地解析惯性运动的均匀观测采样间隔意味着什么。",
            "solution": "该问题陈述被评估为有效，其科学基础是地球物理流体动力学原理，问题提法恰当，并包含求解所需的所有必要信息。\n\n我们从旋转f-平面上无粘性流体质点的水平动量方程开始，该方程源于旋转参考系中的牛顿第二定律。设 $u$ 和 $v$ 分别为向东（$x$）和向北（$y$）方向的速度分量。方程为：\n$$ \\frac{du}{dt} - fv = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} $$\n$$ \\frac{dv}{dt} + fu = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial y} $$\n此处，$\\frac{d}{dt}$ 是跟随流体质点的物质导数，$\\rho$ 是密度，$p$ 是压力，$f$ 是科里奥利参数，定义为 $f(\\phi) = 2 \\Omega \\sin \\phi$，其中 $\\Omega$ 是地球的角自转速率，$\\phi$ 是纬度。\n\n问题指定了水平均匀流动，且没有水平压力梯度和摩擦力。应用这些假设，等式右侧的压力梯度项消失：\n$$ \\frac{\\partial p}{\\partial x} = 0 $$\n$$ \\frac{\\partial p}{\\partial y} = 0 $$\n由此得到的描述惯性运动的简化方程为：\n$$ \\frac{du}{dt} = fv $$\n$$ \\frac{dv}{dt} = -fu $$\n这是一个由两个耦合的一阶线性常微分方程组成的方程组。为求解该方程组，我们可以将第一个方程对时间 $t$ 求导：\n$$ \\frac{d^2u}{dt^2} = f \\frac{dv}{dt} $$\n现在，我们将第二个方程 $\\frac{dv}{dt} = -fu$ 代入 $\\frac{d^2u}{dt^2}$ 的表达式中：\n$$ \\frac{d^2u}{dt^2} = f(-fu) = -f^2 u $$\n这可以改写为一个标准的用于简谐运动的二阶齐次微分方程：\n$$ \\frac{d^2u}{dt^2} + f^2 u = 0 $$\n$u(t)$ 的通解形式为 $u(t) = C_1 \\cos(\\omega t) + C_2 \\sin(\\omega t)$，其中 $\\omega$ 是角频率。通过与推导出的方程进行比较，我们确定这些惯性振荡的角频率为：\n$$ \\omega_i = |f| = |2 \\Omega \\sin \\phi| $$\n频率必须是一个非负量，因此我们取 $f$ 的绝对值。\n\n振荡的周期 $T$ 与其角频率的关系为 $T = \\frac{2\\pi}{\\omega}$。因此，惯性周期 $T_i$ 为：\n$$ T_i = \\frac{2\\pi}{\\omega_i} = \\frac{2\\pi}{|f|} = \\frac{2\\pi}{|2 \\Omega \\sin \\phi|} = \\frac{\\pi}{\\Omega |\\sin \\phi|} $$\n给定地球的自转速率 $\\Omega = 7.2921159 \\times 10^{-5} \\, \\mathrm{s^{-1}}$。我们现在可以计算指定纬度下的惯性周期。周期首先以秒为单位计算，然后除以 $3600$ 转换为小时。\n\n情况1：纬度 $\\phi = 0^{\\circ}$（赤道）\n在赤道，$\\sin(0^{\\circ}) = 0$。\n$$ T_i(0^{\\circ}) = \\frac{\\pi}{\\Omega \\sin(0^{\\circ})} = \\frac{\\pi}{0} \\to \\infty $$\n科里奥利参数为零，因此没有科里奥利力来驱动振荡。周期是无限的，意味着在赤道不存在惯性振荡。\n\n情况2：纬度 $\\phi = 30^{\\circ}$\n此处，$\\sin(30^{\\circ}) = 0.5$。\n$$ T_i(30^{\\circ}) = \\frac{\\pi}{(7.2921159 \\times 10^{-5} \\, \\mathrm{s^{-1}}) \\times \\sin(30^{\\circ})} = \\frac{\\pi}{(7.2921159 \\times 10^{-5}) \\times 0.5} \\approx 86164.09 \\, \\mathrm{s} $$\n转换为小时：\n$$ T_i(30^{\\circ}) \\approx \\frac{86164.09}{3600} \\, \\mathrm{hr} \\approx 23.93447 \\, \\mathrm{hr} $$\n四舍五入到四位有效数字，得到 $23.93$ 小时。\n\n情况3：纬度 $\\phi = 60^{\\circ}$\n此处，$\\sin(60^{\\circ}) = \\frac{\\sqrt{3}}{2}$。\n$$ T_i(60^{\\circ}) = \\frac{\\pi}{(7.2921159 \\times 10^{-5} \\, \\mathrm{s^{-1}}) \\times \\sin(60^{\\circ})} = \\frac{\\pi}{(7.2921159 \\times 10^{-5}) \\times \\frac{\\sqrt{3}}{2}} \\approx 49744.9 \\, \\mathrm{s} $$\n转换为小时：\n$$ T_i(60^{\\circ}) \\approx \\frac{49744.9}{3600} \\, \\mathrm{hr} \\approx 13.8180 \\, \\mathrm{hr} $$\n四舍五入到四位有效数字，得到 $13.82$ 小时。\n\n最后，我们考虑这对观测采样的影响。奈奎斯特-香农采样定理指出，要从离散样本中重建最高频率为 $f_{max}$ 的信号，采样频率 $f_s$ 必须严格大于最大频率的两倍，即 $f_s > 2 f_{max}$。用采样周期 $T_s = 1/f_s$ 和信号周期 $T_{signal} = 1/f_{max}$ 来表示，该条件为 $T_s  T_{signal}/2$。\n\n对于惯性运动，信号周期就是惯性周期 $T_i$。因此，为了无混叠地解析这些运动，采样间隔 $T_s$ 必须满足：\n$$ T_s  \\frac{T_i}{2} $$\n让我们将此应用于我们的结果：\n在 $\\phi = 0^{\\circ}$， $T_i$ 是无限的。没有惯性振荡，因此不必担心此类运动的混叠问题。\n在 $\\phi = 30^{\\circ}$， $T_i \\approx 23.93$ 小时。所需的采样间隔必须是 $T_s  \\frac{23.93}{2} \\approx 11.97$ 小时。\n在 $\\phi = 60^{\\circ}$， $T_i \\approx 13.82$ 小时。所需的采样间隔必须是 $T_s  \\frac{13.82}{2} = 6.91$ 小时。\n\n这意味着随着纬度的增加，惯性周期减小，需要更高的采样频率（更短的采样间隔）来解析该运动。例如，一个标准的 $12$ 小时采样间隔，在纬度 $30^{\\circ}$ 处将处于混叠惯性运动的边缘，而在纬度 $60^{\\circ}$ 处则完全不足，从而导致对观测数据的错误解释。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\infty  23.93  13.82 \\end{pmatrix} } $$"
        },
        {
            "introduction": "虽然惯性运动是基础，但大尺度海洋环流主要由压力梯度力与科里奥利力之间的近似完美平衡（即地转平衡）所控制。这项练习  要求你超越这种理想化的平衡，利用可观测数据来量化对地转平衡的偏离。通过将流体加速度与非地转速度联系起来，你将学会如何诊断海洋锋面等动力学特征，在这些区域，地转平衡开始被打破。",
            "id": "3794430",
            "problem": "考虑一个在一个 $f$ 平面上、横跨上层海洋热锋布设的快速采样的近表面拉格朗日浮标阵列。假设流动满足Boussinesq近似和静力平衡，在所关注的尺度上水平黏性应力可忽略不计，且观测到的水平加速度代表了物质加速度。在锋区内的某一特定位置和时间，估算出以下量值：\n\n- 恒定参考密度：$\\rho = 1025 \\, \\mathrm{kg\\,m^{-3}}$。\n- 来自同步水文断面的水平压力梯度矢量：$\\nabla_{h} p = \\left( \\frac{\\partial p}{\\partial x}, \\frac{\\partial p}{\\partial y} \\right) = \\left( 0.1732, \\ 0.1000 \\right) \\, \\mathrm{Pa\\,m^{-1}}$。\n- 来自浮标推算速度的水平物质加速度矢量：$\\mathbf{a} = \\left( \\frac{D u}{D t}, \\ \\frac{D v}{D t} \\right) = \\left( 1.2 \\times 10^{-5}, \\ 1.6 \\times 10^{-5} \\right) \\, \\mathrm{m\\,s^{-2}}$。\n\n从旋转坐标系中的水平动量方程和地转平衡的定义出发，推导标量比\n$$\nR \\equiv \\frac{\\left| \\mathbf{u} - \\mathbf{u}_{g} \\right|}{\\left| \\mathbf{u}_{g} \\right|},\n$$\n的闭式表达式，其中 $\\mathbf{u}$ 是水平速度，$\\mathbf{u}_{g}$ 是与给定压力梯度相关联的水平地转速度。然后使用所提供的数据计算 $R$ 的值。\n\n将 $R$ 的最终结果表示为无量纲小数，并四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据、良定、客观且自洽。所提供的数据在物理上是一致的，并且足以推导出唯一解。关于科里奥利参数 $f$ 的潜在模糊性，可以通过解析推导得到解决，该推导表明最终的比值 $R$ 与 $f$ 无关。因此，我们可以进行正式求解。\n\n在指定的假设（Boussinesq近似、静力平衡、水平黏性可忽略）下，$f$ 平面上近表面流体质点的运动由以下水平动量方程控制：\n$$\n\\frac{D \\mathbf{u}}{D t} + f \\mathbf{k} \\times \\mathbf{u} = -\\frac{1}{\\rho} \\nabla_h p\n$$\n此处，$\\mathbf{u}$ 是水平速度矢量，$\\frac{D\\mathbf{u}}{Dt}$ 是流体的物质加速度，$f$ 是科里奥利参数，$\\mathbf{k}$ 是垂直方向的单位矢量，$\\rho$ 是恒定参考密度，$\\nabla_h p$ 是水平压力梯度。题目给出了物质加速度矢量，我们将其记为 $\\mathbf{a} \\equiv \\frac{D\\mathbf{u}}{Dt}$。\n\n地转速度 $\\mathbf{u}_g$ 由科里奥利力与压力梯度力之间的精确平衡状态所定义：\n$$\nf \\mathbf{k} \\times \\mathbf{u}_g = -\\frac{1}{\\rho} \\nabla_h p\n$$\n我们可以将地转平衡方程中的压力梯度项表达式代入完整动量方程：\n$$\n\\mathbf{a} + f \\mathbf{k} \\times \\mathbf{u} = f \\mathbf{k} \\times \\mathbf{u}_g\n$$\n重新整理此方程，我们可以用对地转平衡的偏离来表示加速度：\n$$\n\\mathbf{a} = f \\mathbf{k} \\times \\mathbf{u}_g - f \\mathbf{k} \\times \\mathbf{u} = f \\mathbf{k} \\times (\\mathbf{u}_g - \\mathbf{u})\n$$\n矢量 $\\mathbf{u} - \\mathbf{u}_g$ 是非地转速度。我们可以写出：\n$$\n\\mathbf{a} = -f \\mathbf{k} \\times (\\mathbf{u} - \\mathbf{u}_g)\n$$\n为了求解非地转速度矢量 $\\mathbf{u} - \\mathbf{u}_g$，我们可以对上述方程与 $\\mathbf{k}$ 做叉积：\n$$\n\\mathbf{k} \\times \\mathbf{a} = -f \\mathbf{k} \\times (\\mathbf{k} \\times (\\mathbf{u} - \\mathbf{u}_g))\n$$\n使用矢量三重积恒等式 $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$，并注意到速度矢量是水平的（因此 $\\mathbf{k} \\cdot (\\mathbf{u} - \\mathbf{u}_g) = 0$）且 $\\mathbf{k}$ 是一个单位矢量（$\\mathbf{k} \\cdot \\mathbf{k} = 1$），我们得到：\n$$\n\\mathbf{k} \\times \\mathbf{a} = -f [ \\mathbf{k}(0) - (\\mathbf{u} - \\mathbf{u}_g)(1) ] = f(\\mathbf{u} - \\mathbf{u}_g)\n$$\n这给出了非地转速度的表达式：\n$$\n\\mathbf{u} - \\mathbf{u}_g = \\frac{1}{f} \\mathbf{k} \\times \\mathbf{a}\n$$\n因此，非地转速度的模为：\n$$\n|\\mathbf{u} - \\mathbf{u}_g| = \\left| \\frac{1}{f} \\mathbf{k} \\times \\mathbf{a} \\right| = \\frac{1}{|f|} |\\mathbf{k} \\times \\mathbf{a}|\n$$\n由于 $\\mathbf{k}$ 与水平加速度矢量 $\\mathbf{a}$ 正交，它们叉积的模为 $|\\mathbf{k} \\times \\mathbf{a}| = |\\mathbf{k}| |\\mathbf{a}| \\sin(\\frac{\\pi}{2}) = |\\mathbf{a}|$. 因此，\n$$\n|\\mathbf{u} - \\mathbf{u}_g| = \\frac{|\\mathbf{a}|}{|f|}\n$$\n接下来，我们从地转速度的定义中求其模 $|\\mathbf{u}_g|$：\n$$\n|f \\mathbf{k} \\times \\mathbf{u}_g| = \\left| -\\frac{1}{\\rho} \\nabla_h p \\right|\n$$\n$|f| |\\mathbf{k} \\times \\mathbf{u}_g| = \\frac{1}{\\rho} |\\nabla_h p|$. 同样，由于 $\\mathbf{k}$ 与 $\\mathbf{u}_g$ 正交，我们有 $|f| |\\mathbf{u}_g| = \\frac{1}{\\rho} |\\nabla_h p|$。求解 $|\\mathbf{u}_g|$ 可得：\n$$\n|\\mathbf{u}_g| = \\frac{|\\nabla_h p|}{\\rho |f|}\n$$\n现在我们可以构建所求的标量比 $R$：\n$$\nR \\equiv \\frac{|\\mathbf{u} - \\mathbf{u}_g|}{|\\mathbf{u}_g|} = \\frac{\\frac{|\\mathbf{a}|}{|f|}}{\\frac{|\\nabla_h p|}{\\rho |f|}}\n$$\n科里奥利参数 $|f|$ 被消去，得到闭式表达式：\n$$\nR = \\frac{\\rho |\\mathbf{a}|}{|\\nabla_h p|}\n$$\n现在我们将给定值代入此表达式。给定值为：\n- $\\rho = 1025 \\, \\mathrm{kg\\,m^{-3}}$\n- $\\mathbf{a} = (1.2 \\times 10^{-5}, \\, 1.6 \\times 10^{-5}) \\, \\mathrm{m\\,s^{-2}}$\n- $\\nabla_{h} p = (0.1732, \\, 0.1000) \\, \\mathrm{Pa\\,m^{-1}}$\n\n首先，我们计算矢量的模：\n$$\n|\\mathbf{a}| = \\sqrt{(1.2 \\times 10^{-5})^{2} + (1.6 \\times 10^{-5})^{2}} = \\sqrt{1.44 \\times 10^{-10} + 2.56 \\times 10^{-10}} = \\sqrt{4.00 \\times 10^{-10}} = 2.0 \\times 10^{-5} \\, \\mathrm{m\\,s^{-2}}\n$$\n$$\n|\\nabla_h p| = \\sqrt{(0.1732)^{2} + (0.1000)^{2}} = \\sqrt{0.02999824 + 0.01000000} = \\sqrt{0.03999824} \\, \\mathrm{Pa\\,m^{-1}}\n$$\n将这些值以及参考密度代入 $R$ 的表达式中：\n$$\nR = \\frac{(1025) \\times (2.0 \\times 10^{-5})}{\\sqrt{0.03999824}} = \\frac{0.0205}{\\sqrt{0.03999824}}\n$$\n计算数值表达式：\n$$\nR \\approx \\frac{0.0205}{0.1999956} \\approx 0.102502447\n$$\n题目要求结果是一个无量纲小数，并四舍五入到四位有效数字。\n$$\nR \\approx 0.1025\n$$\n这个结果代表了该流动的罗斯贝数，表明速度的非地转分量约占地转分量的 $10.25\\%$，这与一个接近但未完全处于地转平衡状态的流动是一致的，正如在锋区所预期的那样。",
            "answer": "$$\\boxed{0.1025}$$"
        },
        {
            "introduction": "现在，我们进入地球物理流体动力学中最强大的概念之一：位涡（PV）。在准地转近似下，仅从位涡场本身（加上边界条件）就可以重建整个平衡流场，这一原理被称为“PV反演”。这项计算实践  的任务是通过求解控制的椭圆型方程来实现这一反演，为你提供一项诊断和解释模型及观测中海洋环流的核心技能。",
            "id": "3794457",
            "problem": "您的任务是，从第一性原理出发，在一个矩形区域上，为单层准地转 (QG) 模型实现位涡 (PV) 反演。使用地球物理流体动力学定律和核心定义，推导出相应的椭圆问题并重建地转速度。必须对一组给定的位涡异常场执行该反演。您的程序必须求解地转流函数并重建地转速度场，并且必须为一组测试用例生成所要求的定量输出。\n\n从单层准地转 (QG) 系统中的地转平衡和位涡异常的定义开始。地转平衡是科里奥利力与气压梯度力之间的主导阶平衡。在 QG 框架中，引入一个地转流函数 $\\psi$，使得水平地转速度 $\\mathbf{u}_g$ 定义为 $\\mathbf{u}_g = \\hat{k} \\times \\nabla \\psi$，其中 $\\hat{k}$ 是垂直方向的单位向量。将单层 QG 位涡异常 $q_a(x,y)$ 定义为通过反演获得 $\\psi$ 的物理量。该反演由一个线性椭圆算子控制，该算子在区域上将 $q_a$ 与 $\\psi$ 联系起来，并遵循与固壁上无垂向流条件一致的合适边界条件。\n\n您的任务是：\n- 基于单层 QG 位涡异常的定义，用 $\\psi$ 和 $q_a(x,y)$ 来构建椭圆边值问题，其中层结参数 $F$ 为常数，且 $F$ 是斜压变形半径的平方反比。\n- 使用大小为 $L_x \\times L_y$ 的矩形区域，其中 $L_x = 1 \\times 10^6\\,\\mathrm{m}$ 且 $L_y = 1 \\times 10^6\\,\\mathrm{m}$，以及一个 $N_x \\times N_y$ 的均匀网格，其中 $N_x = 64$ 且 $N_y = 64$。在所有边界上施加齐次狄利克雷边界条件 $\\psi=0$，这对应于边界上无垂向流。\n- 在均匀网格上实现椭圆算子的二阶精确有限差分格式离散化，并使用鲁棒的线性求解器为每个测试用例求解所得的关于 $\\psi$ 的线性系统。\n- 将地转速度重建为 $\\mathbf{u}_g = \\hat{k} \\times \\nabla \\psi$，即，使用内部的二阶精确有限差分和边界上的单边差分，从 $\\psi$ 的空间导数计算水平分量 $u_g(x,y)$ 和 $v_g(x,y)$。\n- 对于每个测试用例，从得到的地转速度场计算两个标量诊断量：全域平均速率大小 $\\overline{|\\mathbf{u}_g|}$ 和全域最大速率大小 $\\max |\\mathbf{u}_g|$。两个诊断量都以 $\\mathrm{m\\,s^{-1}}$ 为单位表示，并将每个值四舍五入到 $6$ 位小数。\n\n测试套件包含四个案例，每个案例指定一个位涡异常场 $q_a(x,y)$ 和一个 $F$ 值：\n- 案例 1（光滑单极子）：$q_a(x,y) = q_0 \\exp\\left(-\\frac{(x-x_c)^2 + (y-y_c)^2}{2\\sigma^2}\\right)$，其中 $q_0 = 1 \\times 10^{-6}\\,\\mathrm{s^{-1}}$，$x_c = L_x/2$，$y_c = L_y/2$，以及 $\\sigma = 1 \\times 10^5\\,\\mathrm{m}$。使用 $L_d = 4 \\times 10^4\\,\\mathrm{m}$，因此 $F = 1/L_d^2$。\n- 案例 2（零异常）：$q_a(x,y) = 0$ 在所有地方。使用 $L_d = 4 \\times 10^4\\,\\mathrm{m}$，因此 $F = 1/L_d^2$。\n- 案例 3（偶极子）：$q_a(x,y) = q_0 \\left[\\exp\\left(-\\frac{(x-x_1)^2 + (y-y_1)^2}{2\\sigma^2}\\right) - \\exp\\left(-\\frac{(x-x_2)^2 + (y-y_2)^2}{2\\sigma^2}\\right)\\right]$，其中 $q_0 = 1 \\times 10^{-6}\\,\\mathrm{s^{-1}}$，$x_1 = 0.3 L_x$，$y_1 = 0.5 L_y$，$x_2 = 0.7 L_x$，$y_2 = 0.5 L_y$，以及 $\\sigma = 1 \\times 10^5\\,\\mathrm{m}$。使用 $L_d = 4 \\times 10^4\\,\\mathrm{m}$，因此 $F = 1/L_d^2$。\n- 案例 4（窄单极子，更强层结）：$q_a(x,y) = q_0 \\exp\\left(-\\frac{(x-x_c)^2 + (y-y_c)^2}{2\\sigma^2}\\right)$，其中 $q_0 = 2 \\times 10^{-6}\\,\\mathrm{s^{-1}}$，$x_c = 0.5 L_x$，$y_c = 0.5 L_y$，以及 $\\sigma = 5 \\times 10^4\\,\\mathrm{m}$。使用 $L_d = 2 \\times 10^4\\,\\mathrm{m}$，因此 $F = 1/L_d^2$。\n\n对于数值导数，在内部点使用二阶中心差分，在区域边界使用一阶单边差分。每个案例的最终输出是两个标量 $\\overline{|\\mathbf{u}_g|}$ 和 $\\max |\\mathbf{u}_g|$，每个都四舍五入到 $6$ 位小数。\n\n您的程序应该生成单行输出，其中包含所有测试用例的聚合结果，格式为列表的列表，每个内部列表对应一个测试用例：对于案例 $i$，内部列表的形式必须是 $[\\overline{|\\mathbf{u}_g|},\\max |\\mathbf{u}_g|]$，两个条目均以 $\\mathrm{m\\,s^{-1}}$ 表示并四舍五入到 $6$ 位小数。因此，完整的输出必须是像 $[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]$ 这样的单行，其中所有 $a_i$ 和 $b_i$ 都是以 $\\mathrm{m\\,s^{-1}}$ 为单位并四舍五入到 $6$ 位小数的十进制数。",
            "solution": "### 第一性原理推导与数值策略\n\n该问题要求在一个单层准地转 (QG) 模型中，反演位涡 (PV) 异常 $q_a$ 以求得地转流函数 $\\psi$，并随后求得地转速度场 $\\mathbf{u}_g$。\n\n1.  **控制方程**：f-平面上单层流体的 QG 位涡 $q$ 是地转相对涡度 $\\zeta_g$、行星涡度 $f_0$ 和一个伸缩项的总和。\n    $q = \\zeta_g + f_0 + \\text{伸缩项}$\n    地转相对涡度是流函数的拉普拉斯算子：$\\zeta_g = \\nabla^2 \\psi$。伸缩项说明了流体柱高度的形变。在简化重力模型中，此项与 $\\psi$ 本身成正比：$-\\frac{f_0^2}{g'H_0}\\psi$，其中 $g'$ 是简化重力，$H_0$ 是平均层厚。这可以使用斜压变形半径 $L_d = \\sqrt{g'H_0}/f_0$ 和层结参数 $F=1/L_d^2$ 来表示。因此，完整的 QG 位涡为：\n    $q = \\nabla^2\\psi + f_0 - F\\psi$\n    位涡异常 $q_a$ 是与静止状态（其中 $\\psi=0$ 且 $q=f_0$）的偏差。因此，$q_a = q - f_0$。这为 PV 反演得到了控制椭圆偏微分方程，即一个亥姆霍兹方程：\n    $$ \\nabla^2 \\psi - F \\psi = q_a $$\n\n2.  **数值离散化与求解**：该问题定义在一个矩形区域 $[0, L_x] \\times [0, L_y]$ 上，所有边界上均采用齐次狄利克雷边界条件 $\\psi=0$。我们将该区域离散化为一个具有 $N_x \\times N_y$ 个点和网格间距 $\\Delta x = L_x/(N_x-1)$ 及 $\\Delta y = L_y/(N_y-1)$ 的均匀网格。\n    亥姆霍兹算子 $\\mathcal{L} = \\nabla^2 - F$ 在每个内部网格点 $(i,j)$ 处使用拉普拉斯算子的二阶中心有限差分进行离散化：\n    $$ \\mathcal{L}\\psi \\approx \\frac{\\psi_{i+1,j} - 2\\psi_{i,j} + \\psi_{i-1,j}}{\\Delta x^2} + \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{\\Delta y^2} - F\\psi_{i,j} = (q_a)_{i,j} $$\n    此方程应用于所有 $(N_x-2) \\times (N_y-2)$ 个内部网格点。边界值 $\\psi_{i,j}$ 是已知的（$\\psi=0$），因此它们被移到右侧（在这种情况下，由于它们为零，所以没有贡献）。这就构成了一个形如 $A \\mathbf{x} = \\mathbf{b}$ 的大型稀疏线性方程组，其中 $\\mathbf{x}$ 是包含未知内部 $\\psi$ 值的向量，$\\mathbf{b}$ 是包含内部点处已知 $q_a$ 值的向量，而 $A$ 是表示离散化亥姆霍兹算子的稀疏矩阵。矩阵 $A$ 是块三对角矩阵，可以使用一维有限差分矩阵的克罗内克积高效地构建。然后使用鲁棒的稀疏线性求解器（例如 `scipy.sparse.linalg.spsolve`）求解该系统以得到 $\\mathbf{x}$。\n\n3.  **速度重建**：一旦求得流函数场 $\\psi$，地转速度分量 $(u_g, v_g)$ 就根据关系式 $\\mathbf{u}_g = \\hat{k} \\times \\nabla \\psi$ 从其偏导数计算得出：\n    $$ u_g = -\\frac{\\partial \\psi}{\\partial y}, \\qquad v_g = \\frac{\\partial \\psi}{\\partial x} $$\n    这些导数是数值计算的。根据问题说明，我们对内部网格点使用二阶中心差分，对区域边界使用一阶单边（向前或向后）差分。对于网格上的场 $f$，导数近似为：\n    *   内部点 ($k \\in [1, N-2]$): $\\frac{\\partial f}{\\partial \\xi}|_k \\approx \\frac{f_{k+1} - f_{k-1}}{2 \\Delta \\xi}$\n    *   边界点 $k=0$: $\\frac{\\partial f}{\\partial \\xi}|_0 \\approx \\frac{f_1 - f_0}{\\Delta \\xi}$\n    *   边界点 $k=N-1$: $\\frac{\\partial f}{\\partial \\xi}|_{N-1} \\approx \\frac{f_{N-1} - f_{N-2}}{\\Delta \\xi}$\n\n4.  **诊断量计算**：根据重建的速度场 $u_g(x,y)$ 和 $v_g(x,y)$，在每个网格点计算速率大小 $|\\mathbf{u}_g| = \\sqrt{u_g^2 + v_g^2}$。所需的诊断量是全域平均速率 $\\overline{|\\mathbf{u}_g|} = \\frac{1}{N_x N_y} \\sum_{i,j} |\\mathbf{u}_g|_{i,j}$ 和全域最大速率 $\\max |\\mathbf{u}_g| = \\max_{i,j} |\\mathbf{u}_g|_{i,j}$。然后将这些值四舍五入到 $6$ 位小数。\n\n此过程应用于所提供的四个测试用例中的每一个。对于案例 2，其中 $q_a=0$，带有齐次狄利克雷边界条件的齐次亥姆霍兹方程的唯一解是平凡解 $\\psi=0$。这意味着 $\\mathbf{u}_g=0$，因此两个诊断输出都必须为零，这可作为实现的一项有价值的一致性检查。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, identity, kron\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to solve the PV inversion problem for all test cases.\n    \"\"\"\n    \n    # Define qa functions for test cases\n    def qa_case1(xx, yy, p):\n        q0 = p['q0']\n        xc, yc = p['xc'], p['yc']\n        sigma = p['sigma']\n        return q0 * np.exp(-((xx - xc)**2 + (yy - yc)**2) / (2 * sigma**2))\n\n    def qa_case2(xx, yy, p):\n        return np.zeros_like(xx)\n\n    def qa_case3(xx, yy, p):\n        q0 = p['q0']\n        x1, y1 = p['x1'], p['y1']\n        x2, y2 = p['x2'], p['y2']\n        sigma = p['sigma']\n        term1 = np.exp(-((xx - x1)**2 + (yy - y1)**2) / (2 * sigma**2))\n        term2 = np.exp(-((xx - x2)**2 + (yy - y2)**2) / (2 * sigma**2))\n        return q0 * (term1 - term2)\n\n    def qa_case4(xx, yy, p):\n        q0 = p['q0']\n        xc, yc = p['xc'], p['yc']\n        sigma = p['sigma']\n        return q0 * np.exp(-((xx - xc)**2 + (yy - yc)**2) / (2 * sigma**2))\n\n    # Define the test cases from the problem statement.\n    Lx, Ly = 1e6, 1e6\n    test_cases = [\n        {\n            'qa_func': qa_case1,\n            'Ld': 4e4, 'q0': 1e-6, 'sigma': 1e5,\n            'xc': Lx/2, 'yc': Ly/2, 'Lx': Lx, 'Ly': Ly\n        },\n        {\n            'qa_func': qa_case2,\n            'Ld': 4e4, 'Lx': Lx, 'Ly': Ly\n        },\n        {\n            'qa_func': qa_case3,\n            'Ld': 4e4, 'q0': 1e-6, 'sigma': 1e5,\n            'x1': 0.3*Lx, 'y1': 0.5*Ly, 'x2': 0.7*Lx, 'y2': 0.5*Ly,\n            'Lx': Lx, 'Ly': Ly\n        },\n        {\n            'qa_func': qa_case4,\n            'Ld': 2e4, 'q0': 2e-6, 'sigma': 5e4,\n            'xc': 0.5*Lx, 'yc': 0.5*Ly, 'Lx': Lx, 'Ly': Ly\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        avg_speed, max_speed = solve_pv_inversion(case_params)\n        results.append((avg_speed, max_speed))\n\n    # Format the final output string\n    formatted_cases = [f\"[{res[0]:.6f},{res[1]:.6f}]\" for res in results]\n    print(f\"[{','.join(formatted_cases)}]\")\n\ndef solve_pv_inversion(case_params):\n    \"\"\"\n    Solves the PV inversion for a single case.\n    \"\"\"\n    # Domain and grid parameters\n    Lx, Ly = 1e6, 1e6\n    Nx, Ny = 64, 64\n\n    dx = Lx / (Nx - 1)\n    dy = Ly / (Ny - 1)\n\n    x = np.linspace(0, Lx, Nx)\n    y = np.linspace(0, Ly, Ny)\n    xx, yy = np.meshgrid(x, y, indexing='xy') # xx, yy shape (Ny, Nx)\n\n    # Physical parameters from the case\n    qa_func = case_params['qa_func']\n    Ld = case_params['Ld']\n    F = 1 / Ld**2\n\n    # Generate the potential vorticity anomaly field\n    qa = qa_func(xx, yy, case_params)\n\n    # For qa=0 case, analytical solution is psi=0, u_g=0, v_g=0\n    if np.all(qa == 0):\n        return 0.0, 0.0\n\n    # Set up the linear algebra problem A * psi_vec = b for interior points\n    Mx = Nx - 2\n    My = Ny - 2\n    M = Mx * My\n\n    # Create 1D second-derivative operator matrices\n    D2x = diags([1, -2, 1], [-1, 0, 1], shape=(Mx, Mx)) / dx**2\n    D2y = diags([1, -2, 1], [-1, 0, 1], shape=(My, My)) / dy**2\n\n    # Create 2D Laplacian operator using Kronecker products.\n    # The flattening of the 2D array psi[1:-1,1:-1] is row-major (C-style).\n    #\n    # With A=D2y and B=D2x, kron(A, Ix) applies A to rows,\n    # and kron(Iy, B) applies B to columns. This matches the equation.\n    Ix = identity(Mx)\n    Iy = identity(My)\n    laplacian_2d = kron(D2y, Ix) + kron(Iy, D2x)\n\n    # Helmholtz operator matrix for (nabla^2 - F)\n    A = laplacian_2d - F * identity(M)\n\n    # Right-hand side vector from the qa field on the interior grid\n    b = qa[1:-1, 1:-1].flatten()\n\n    # Solve the sparse linear system\n    psi_vec = spsolve(A, b)\n\n    # Reshape solution vector to a 2D grid and embed in the full domain\n    # with zero boundary conditions.\n    psi = np.zeros((Ny, Nx))\n    psi[1:-1, 1:-1] = psi_vec.reshape((My, Mx))\n\n    # Reconstruct geostrophic velocity field using specified finite differences\n    dpsi_dx = np.zeros_like(psi)\n    dpsi_dy = np.zeros_like(psi)\n\n    # y-derivative (for u_g)\n    dpsi_dy[1:-1, :] = (psi[2:, :] - psi[:-2, :]) / (2 * dy)  # Second-order central\n    dpsi_dy[0, :] = (psi[1, :] - psi[0, :]) / dy          # First-order forward\n    dpsi_dy[-1, :] = (psi[-1, :] - psi[-2, :]) / dy         # First-order backward\n\n    # x-derivative (for v_g)\n    dpsi_dx[:, 1:-1] = (psi[:, 2:] - psi[:, :-2]) / (2 * dx)  # Second-order central\n    dpsi_dx[:, 0] = (psi[:, 1] - psi[:, 0]) / dx          # First-order forward\n    dpsi_dx[:, -1] = (psi[:, -1] - psi[:, -2]) / dx         # First-order backward\n\n    ug = -dpsi_dy\n    vg = dpsi_dx\n\n    # Calculate diagnostics: domain-averaged and max speed magnitude\n    speed = np.sqrt(ug**2 + vg**2)\n    avg_speed = np.mean(speed)\n    max_speed = np.max(speed)\n    \n    return avg_speed, max_speed\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}