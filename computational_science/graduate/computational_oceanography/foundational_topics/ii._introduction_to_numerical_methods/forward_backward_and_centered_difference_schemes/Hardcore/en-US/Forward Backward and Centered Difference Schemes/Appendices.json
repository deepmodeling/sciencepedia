{
    "hands_on_practices": [
        {
            "introduction": "Understanding the accuracy of different finite difference schemes is the first step toward building reliable numerical models. This foundational exercise  solidifies the concept of truncation error by having you apply the forward, backward, and centered difference methods to a simple quadratic function. By directly calculating the error, you will see firsthand why the centered difference scheme is higher-order and, in this special case, perfectly exact.",
            "id": "3793438",
            "problem": "In a one-dimensional idealized transect used in computational oceanography to benchmark numerical differentiation algorithms, consider an analytic, nondimensional velocity profile $u(x) = x^{2}$ sampled on a uniform grid $x_{i} = x_{0} + i\\,h$ with constant grid spacing $h > 0$. You are interested in approximating the spatial derivative $u^{\\prime}(x)$ at the interior grid point $x_{i}$ using the three canonical finite difference schemes: a one-sided forward difference at $x_{i}$, a one-sided backward difference at $x_{i}$, and a centered difference at $x_{i}$.\n\nStarting from first principles, namely the definition of the derivative $u^{\\prime}(x) = \\lim_{h \\to 0} \\frac{u(x+h) - u(x)}{h}$ and the Taylor series expansion of $u(x)$ about $x_{i}$, derive the truncation error at $x_{i}$ for each of the three schemes when applied to $u(x) = x^{2}$. Define the truncation error for an approximation $\\mathcal{D}u(x_{i})$ as $\\mathcal{T}(x_{i};h) = \\mathcal{D}u(x_{i}) - u^{\\prime}(x_{i})$. Simplify each truncation error expression fully in terms of $h$ and constants, and identify which scheme is exact for this profile and which is closest to exact for nonzero $h$.\n\nReport your final answer as a row matrix containing, in order, the truncation errors for the forward, backward, and centered difference schemes evaluated at $x_{i}$, expressed in closed form as functions of $h$. No rounding is required, and no units are required.",
            "solution": "We begin by defining the given function and its derivatives, which are required for the analysis. The velocity profile is given by the function $u(x) = x^{2}$.\nThe first few derivatives are:\n- First derivative: $u^{\\prime}(x) = \\frac{d}{dx}(x^{2}) = 2x$\n- Second derivative: $u^{\\prime\\prime}(x) = \\frac{d}{dx}(2x) = 2$\n- Third derivative: $u^{\\prime\\prime\\prime}(x) = \\frac{d}{dx}(2) = 0$\nAll derivatives of order three and higher are zero for this function. The exact value of the derivative at the grid point $x_{i}$ is therefore $u^{\\prime}(x_{i}) = 2x_{i}$.\n\nThe truncation error is defined as $\\mathcal{T}(x_{i};h) = \\mathcal{D}u(x_{i}) - u^{\\prime}(x_{i})$, where $\\mathcal{D}u(x_{i})$ represents the finite difference approximation of the derivative. We will now derive this for each of the three specified schemes.\n\n**1. Forward Difference Scheme**\n\nThe one-sided forward difference approximation for $u^{\\prime}(x_{i})$ is given by:\n$$\n\\mathcal{D}_{f}u(x_{i}) = \\frac{u(x_{i}+h) - u(x_{i})}{h}\n$$\nThe grid points are defined such that $x_{i+1} = x_i + h$, so $u(x_i+h)$ is the value of the function at the next grid point. Applying this formula to the function $u(x) = x^{2}$:\n$$\n\\mathcal{D}_{f}u(x_{i}) = \\frac{(x_{i}+h)^{2} - x_{i}^{2}}{h}\n$$\nExpanding the numerator:\n$$\n\\mathcal{D}_{f}u(x_{i}) = \\frac{(x_{i}^{2} + 2x_{i}h + h^{2}) - x_{i}^{2}}{h} = \\frac{2x_{i}h + h^{2}}{h}\n$$\nSimplifying by factoring out $h$ (since $h > 0$):\n$$\n\\mathcal{D}_{f}u(x_{i}) = 2x_{i} + h\n$$\nThe truncation error $\\mathcal{T}_{f}$ for the forward difference scheme is the difference between this approximation and the exact derivative $u^{\\prime}(x_{i}) = 2x_{i}$:\n$$\n\\mathcal{T}_{f}(x_{i};h) = \\mathcal{D}_{f}u(x_{i}) - u^{\\prime}(x_{i}) = (2x_{i} + h) - 2x_{i} = h\n$$\nThus, the truncation error for the forward difference scheme is exactly $h$.\n\n**2. Backward Difference Scheme**\n\nThe one-sided backward difference approximation for $u^{\\prime}(x_{i})$ is given by:\n$$\n\\mathcal{D}_{b}u(x_{i}) = \\frac{u(x_{i}) - u(x_{i}-h)}{h}\n$$\nThe grid point $x_{i-1} = x_i - h$. Applying this formula to $u(x) = x^{2}$:\n$$\n\\mathcal{D}_{b}u(x_{i}) = \\frac{x_{i}^{2} - (x_{i}-h)^{2}}{h}\n$$\nExpanding the numerator:\n$$\n\\mathcal{D}_{b}u(x_{i}) = \\frac{x_{i}^{2} - (x_{i}^{2} - 2x_{i}h + h^{2})}{h} = \\frac{2x_{i}h - h^{2}}{h}\n$$\nSimplifying by factoring out $h$:\n$$\n\\mathcal{D}_{b}u(x_{i}) = 2x_{i} - h\n$$\nThe truncation error $\\mathcal{T}_{b}$ for the backward difference scheme is:\n$$\n\\mathcal{T}_{b}(x_{i};h) = \\mathcal{D}_{b}u(x_{i}) - u^{\\prime}(x_{i}) = (2x_{i} - h) - 2x_{i} = -h\n$$\nThus, the truncation error for the backward difference scheme is exactly $-h$.\n\n**3. Centered Difference Scheme**\n\nThe centered difference approximation for $u^{\\prime}(x_{i})$ is given by:\n$$\n\\mathcal{D}_{c}u(x_{i}) = \\frac{u(x_{i}+h) - u(x_{i}-h)}{2h}\n$$\nApplying this formula to $u(x) = x^{2}$:\n$$\n\\mathcal{D}_{c}u(x_{i}) = \\frac{(x_{i}+h)^{2} - (x_{i}-h)^{2}}{2h}\n$$\nExpanding the terms in the numerator:\n$$\n\\mathcal{D}_{c}u(x_{i}) = \\frac{(x_{i}^{2} + 2x_{i}h + h^{2}) - (x_{i}^{2} - 2x_{i}h + h^{2})}{2h} = \\frac{4x_{i}h}{2h}\n$$\nSimplifying the expression:\n$$\n\\mathcal{D}_{c}u(x_{i}) = 2x_{i}\n$$\nThe truncation error $\\mathcal{T}_{c}$ for the centered difference scheme is:\n$$\n\\mathcal{T}_{c}(x_{i};h) = \\mathcal{D}_{c}u(x_{i}) - u^{\\prime}(x_{i}) = 2x_{i} - 2x_{i} = 0\n$$\nThus, the truncation error for the centered difference scheme is exactly $0$.\n\nThis result can also be understood from the general Taylor series derivation of the centered difference error. The leading error term for a general function $u(x)$ is proportional to $u^{\\prime\\prime\\prime}(x_{i})$:\n$$\n\\mathcal{T}_{c}(x_{i};h) = \\frac{h^{2}}{6}u^{\\prime\\prime\\prime}(x_{i}) + \\mathcal{O}(h^{4})\n$$\nSince for our function $u(x) = x^{2}$, we have $u^{\\prime\\prime\\prime}(x) = 0$ for all $x$, the leading error term vanishes, as do all higher-order terms in the error expansion. This confirms the result that the scheme is exact for any quadratic polynomial.\n\n**Conclusion on Scheme Accuracy**\n\nBased on the derived truncation errors:\n- Forward difference error: $\\mathcal{T}_{f} = h$\n- Backward difference error: $\\mathcal{T}_{b} = -h$\n- Centered difference error: $\\mathcal{T}_{c} = 0$\n\nThe scheme that is exact for the profile $u(x)=x^2$ is the **centered difference scheme**, as its truncation error is identically zero. Consequently, for any nonzero grid spacing $h$, the centered difference scheme is also the **closest to exact**; its approximation equals the true derivative, whereas the forward and backward schemes have errors of magnitude $|h|$.\n\nThe final answer is the set of truncation errors for the forward, backward, and centered difference schemes, respectively, presented as a row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nh & -h & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In practical ocean modeling, grids are rarely uniform; they are often refined near coasts or other important features to capture boundary layers. This practice  moves beyond textbook formulas and challenges you to derive custom finite difference schemes for a non-uniform grid. Using the method of undetermined coefficients with Taylor series expansions, you will develop a second-order accurate one-sided formula, a crucial skill for handling boundaries in sophisticated numerical models.",
            "id": "3793418",
            "problem": "In a coastal upwelling simulation, the cross-shore coordinate $x$ is discretized on a nonuniform, one-sided grid near the western boundary (coast) to resolve a thin boundary layer. Let the first three grid points be $x_0$, $x_1 = x_0 + h_0$, and $x_2 = x_0 + h_0 + h_1$, where $h_0 > 0$ and $h_1 > 0$ are the local spacings. A scalar tracer $u(x)$ is sufficiently smooth for Taylor expansions about $x_0$. Because a centered stencil is not available at $x_0$, one must use one-sided formulas.\n\nUsing only fundamental definitions and Taylor series, do the following:\n- Derive a first-order accurate one-sided approximation for $u^{\\prime}(x_0)$ using the values $u(x_0)$ and $u(x_1)$, and determine its leading truncation error term in terms of $h_0$ and derivatives of $u$ evaluated at $x_0$.\n- Derive a second-order accurate one-sided approximation for $u^{\\prime}(x_0)$ using the values $u(x_0)$, $u(x_1)$, and $u(x_2)$ on this nonuniform grid, and determine its leading truncation error term in terms of $h_0$, $h_1$, and derivatives of $u$ evaluated at $x_0$.\n\nFinally, report the single closed-form expression for the coefficient multiplying $u^{(3)}(x_0)$ in the leading truncation error of your second-order one-sided approximation. No numerical evaluation or rounding is required. The final reported expression must be simplified in terms of $h_0$ and $h_1$ only.",
            "solution": "The solution is developed in two parts as requested: derivation of the first-order scheme and derivation of the second-order scheme, followed by the identification of the specific coefficient requested. For clarity, we use the notation $u_i = u(x_i)$ and $u_0^{(k)} = u^{(k)}(x_0)$.\n\n**Part 1: First-Order Accurate Approximation**\n\nTo derive an approximation for $u'(x_0)$ using $u_0$ and $u_1$, we begin with the Taylor series expansion of $u(x)$ at $x_1$ expanded around $x_0$:\n$$u(x_1) = u(x_0 + h_0) = u(x_0) + h_0 u'(x_0) + \\frac{h_0^2}{2!} u''(x_0) + O(h_0^3)$$\nRearranging this equation to solve for $u'(x_0)$ gives:\n$$h_0 u'(x_0) = u(x_1) - u(x_0) - \\frac{h_0^2}{2} u''(x_0) - O(h_0^3)$$\n$$u'(x_0) = \\frac{u(x_1) - u(x_0)}{h_0} - \\frac{h_0}{2} u''(x_0) - O(h_0^2)$$\nThe first-order one-sided approximation for $u'(x_0)$, which we denote $D_1(u)$, is the first term on the right-hand side:\n$$D_1(u) = \\frac{u_1 - u_0}{h_0}$$\nThis is the standard forward difference formula. The truncation error, $T_1$, is defined as the approximation minus the exact value, $T_1 = D_1(u) - u'(x_0)$. From the rearranged Taylor expansion, we find:\n$$T_1 = \\frac{h_0}{2} u''(x_0) + O(h_0^2)$$\nThe leading truncation error term is thus $\\frac{h_0}{2} u''(x_0)$, and the approximation is first-order accurate, as indicated by the error being proportional to $h_0^1$.\n\n**Part 2: Second-Order Accurate Approximation**\n\nWe seek a linear combination of $u_0$, $u_1$, and $u_2$ that approximates $u'(x_0)$:\n$$u'(x_0) \\approx D_2(u) = A u_0 + B u_1 + C u_2$$\nTo determine the coefficients $A$, $B$, and $C$, we expand $u_1$ and $u_2$ in Taylor series around $x_0$:\n$$u_1 = u(x_0 + h_0) = u_0 + h_0 u'_0 + \\frac{h_0^2}{2} u''_0 + \\frac{h_0^3}{6} u'''_0 + O(h_0^4)$$\n$$u_2 = u(x_0 + h_0 + h_1) = u_0 + (h_0 + h_1)u'_0 + \\frac{(h_0 + h_1)^2}{2} u''_0 + \\frac{(h_0 + h_1)^3}{6} u'''_0 + O((h_0+h_1)^4)$$\nSubstituting these expansions into the expression for $D_2(u)$ yields:\n$$D_2(u) = A u_0 + B\\left(u_0 + h_0 u'_0 + \\frac{h_0^2}{2} u''_0 + \\dots\\right) + C\\left(u_0 + (h_0 + h_1)u'_0 + \\frac{(h_0 + h_1)^2}{2} u''_0 + \\dots\\right)$$\nCollecting terms by the derivatives of $u$ at $x_0$:\n$$D_2(u) = (A+B+C)u_0 + (B h_0 + C(h_0+h_1))u'_0 + \\left(B \\frac{h_0^2}{2} + C \\frac{(h_0+h_1)^2}{2}\\right)u''_0 + \\left(B \\frac{h_0^3}{6} + C \\frac{(h_0+h_1)^3}{6}\\right)u'''_0 + \\dots$$\nFor $D_2(u)$ to be a second-order accurate approximation of $u'_0$, the coefficients must satisfy the following system of equations:\n1.  Coefficient of $u_0$: $A+B+C = 0$\n2.  Coefficient of $u'_0$: $B h_0 + C(h_0+h_1) = 1$\n3.  Coefficient of $u''_0$: $B h_0^2 + C(h_0+h_1)^2 = 0$\n\nFrom equation (3), we express $B$ in terms of $C$:\n$$B = -C \\frac{(h_0+h_1)^2}{h_0^2}$$\nSubstitute this into equation (2):\n$$\\left(-C \\frac{(h_0+h_1)^2}{h_0^2}\\right) h_0 + C(h_0+h_1) = 1$$\n$$-C \\frac{(h_0+h_1)^2}{h_0} + C(h_0+h_1) = 1$$\n$$C(h_0+h_1) \\left(1 - \\frac{h_0+h_1}{h_0}\\right) = 1$$\n$$C(h_0+h_1) \\left(\\frac{h_0 - h_0 - h_1}{h_0}\\right) = 1$$\n$$C(h_0+h_1) \\left(\\frac{-h_1}{h_0}\\right) = 1 \\implies C = -\\frac{h_0}{h_1(h_0+h_1)}$$\nNow, we find $B$:\n$$B = -\\left(-\\frac{h_0}{h_1(h_0+h_1)}\\right) \\frac{(h_0+h_1)^2}{h_0^2} = \\frac{h_0+h_1}{h_0 h_1}$$\nFinally, from equation (1), we find $A$:\n$$A = -B - C = -\\frac{h_0+h_1}{h_0 h_1} + \\frac{h_0}{h_1(h_0+h_1)}$$\n$$A = \\frac{-(h_0+h_1)^2 + h_0^2}{h_0 h_1 (h_0+h_1)} = \\frac{-(h_0^2 + 2h_0 h_1 + h_1^2) + h_0^2}{h_0 h_1 (h_0+h_1)} = \\frac{-2h_0 h_1 - h_1^2}{h_0 h_1 (h_0+h_1)}$$\n$$A = \\frac{-h_1(2h_0 + h_1)}{h_0 h_1 (h_0+h_1)} = -\\frac{2h_0 + h_1}{h_0(h_0+h_1)}$$\nThe second-order approximation is:\n$$D_2(u) = -\\frac{2h_0 + h_1}{h_0(h_0+h_1)} u_0 + \\frac{h_0+h_1}{h_0 h_1} u_1 - \\frac{h_0}{h_1(h_0+h_1)} u_2$$\nThe truncation error is $T_2 = D_2(u) - u'_0$. Based on our setup, the terms with $u_0$, $u'_0$, and $u''_0$ are zero or one as required, so the leading term of the error comes from the $u'''_0$ term:\n$$T_2 = \\left(B \\frac{h_0^3}{6} + C \\frac{(h_0+h_1)^3}{6}\\right)u'''_0 + O(h^3)$$\nwhere $h$ represents the scale of the grid spacings $h_0$ and $h_1$. The problem asks for the coefficient of $u^{(3)}(x_0)$ in this leading error term. Let this coefficient be $K_{err}$:\n$$K_{err} = B \\frac{h_0^3}{6} + C \\frac{(h_0+h_1)^3}{6}$$\nSubstituting the expressions for $B$ and $C$:\n$$K_{err} = \\frac{1}{6} \\left[ \\left(\\frac{h_0+h_1}{h_0 h_1}\\right) h_0^3 + \\left(-\\frac{h_0}{h_1(h_0+h_1)}\\right) (h_0+h_1)^3 \\right]$$\n$$K_{err} = \\frac{1}{6} \\left[ \\frac{(h_0+h_1)h_0^2}{h_1} - \\frac{h_0(h_0+h_1)^2}{h_1} \\right]$$\nFactoring out common terms:\n$$K_{err} = \\frac{h_0(h_0+h_1)}{6h_1} \\left[ h_0 - (h_0+h_1) \\right]$$\n$$K_{err} = \\frac{h_0(h_0+h_1)}{6h_1} [-h_1]$$\n$$K_{err} = -\\frac{h_0(h_0+h_1)}{6}$$\nThis is the coefficient requested.",
            "answer": "$$\\boxed{-\\frac{h_0(h_0+h_1)}{6}}$$"
        },
        {
            "introduction": "The ultimate goal of learning numerical methods is to solve physical equations. This comprehensive practice  brings together concepts of spatial and temporal discretization to build a working solver for the 1D diffusion equation, a cornerstone model for tracer dynamics. You will implement an unconditionally stable implicit scheme and master the critical, non-trivial technique of incorporating Dirichlet boundary conditions by modifying the linear system, translating theoretical knowledge into practical coding skill.",
            "id": "3793439",
            "problem": "Consider the one-dimensional vertical diffusion of a conservative tracer in oceanography governed by Fickian diffusion. The tracer concentration field is denoted by $C(x,t)$ with $x \\in [0,L]$ and $t \\ge 0$. The governing law combines Fick’s law and conservation of mass: the diffusive flux $J$ satisfies $J = -\\kappa \\, \\partial C / \\partial x$, and local conservation yields $\\partial C / \\partial t = -\\partial J / \\partial x$. The result is the diffusion equation\n$$\n\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2},\n$$\nwhere $\\kappa$ is the molecular or turbulent diffusivity in $\\mathrm{m}^2/\\mathrm{s}$ and $x$ is in $\\mathrm{m}$.\n\nYou are to discretize this equation in space using centered second differences on a uniform mesh and in time using an implicit backward Euler scheme. Let the spatial grid have $N$ points with uniform spacing $\\Delta x = L/(N-1)$ at locations $x_i = i \\, \\Delta x$, where $i \\in \\{0,1,\\dots,N-1\\}$. Let the time step be $\\Delta t$ in $\\mathrm{s}$. The Dirichlet boundary conditions at the two ends are prescribed values $C(0,t) = C_L(t)$ and $C(L,t) = C_R(t)$, which are to be imposed directly at the new time level within the discrete system by modifying the near-boundary stencils and the right-hand side, without introducing ghost points.\n\nStarting from the fundamental definitions above, derive the discrete implicit scheme at interior grid points $\\{x_i\\}_{i=1}^{N-2}$ that uses a centered second-difference approximation for the second derivative evaluated at the new time level, and a backward Euler approximation for the time derivative:\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\kappa \\frac{C_{i-1}^{n+1} - 2 C_i^{n+1} + C_{i+1}^{n+1}}{\\Delta x^2},\n$$\nwhere $C_i^n$ denotes the approximation to $C(x_i, t^n)$ and $t^{n+1} = t^n + \\Delta t$. Show how the Dirichlet conditions $C_0^{n+1} = C_L^{n+1}$ and $C_{N-1}^{n+1} = C_R^{n+1}$ are enforced by modifying the algebraic system for the interior unknowns $\\{C_i^{n+1}\\}_{i=1}^{N-2}$ through terms added to the right-hand side at the first and last interior equations. Explain clearly which stencil coefficients and right-hand side entries are affected and how.\n\nImplement the derived scheme in a program that:\n- Builds the tridiagonal system for the interior unknowns with centered second differences and backward Euler in time.\n- Imposes the Dirichlet boundary conditions at the new time level $t^{n+1}$ by modifying the near-boundary stencils and the right-hand side as derived.\n- Solves for $C^{n+1}$ given $C^n$, returning the full vector including boundary values.\n\nAll physical quantities must use International System of Units: $L$ in $\\mathrm{m}$, $\\Delta x$ in $\\mathrm{m}$, $\\Delta t$ in $\\mathrm{s}$, $\\kappa$ in $\\mathrm{m}^2/\\mathrm{s}$, and $C$ in $\\mathrm{kg}/\\mathrm{m}^3$. Angles do not appear in this problem.\n\nUse the following test suite to validate your implementation, and for each test compute the requested scalar quantity. Your program must assemble the results into a single line in the specified format. The grid spacing $\\Delta x$ should be computed from the given $L$ and $N$, and the ratio $r = \\kappa \\Delta t / \\Delta x^2$ should be used to form the tridiagonal coefficients.\n\nTest suite:\n- Case A (steady consistency, happy path): $L = 10{,}000\\,\\mathrm{m}$, $N = 51$, $\\kappa = 10^{-4}\\,\\mathrm{m}^2/\\mathrm{s}$, $\\Delta t = 3{,}600\\,\\mathrm{s}$, $C_L^n = 35\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^n = 35\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_L^{n+1} = 35\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^{n+1} = 35\\,\\mathrm{kg}/\\mathrm{m}^3$, and $C_i^n = 35\\,\\mathrm{kg}/\\mathrm{m}^3$ for all interior indices $i$. Compute the maximum absolute deviation of the interior values of $C^{n+1}$ from the constant $35\\,\\mathrm{kg}/\\mathrm{m}^3$ and return it as a float in $\\mathrm{kg}/\\mathrm{m}^3$.\n- Case B (gradient formation): $L = 10{,}000\\,\\mathrm{m}$, $N = 51$, $\\kappa = 10^{-4}\\,\\mathrm{m}^2/\\mathrm{s}$, $\\Delta t = 3{,}600\\,\\mathrm{s}$, $C_L^n = 10\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_L^{n+1} = 10\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^{n+1} = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, and $C_i^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$ for all interior indices $i$. Compute and return the value of $C^{n+1}$ at the midpoint grid index $i = \\lfloor N/2 \\rfloor$ as a float in $\\mathrm{kg}/\\mathrm{m}^3$.\n- Case C (minimal interior, boundary influence): $L = 100\\,\\mathrm{m}$, $N = 3$, $\\kappa = 10^{-4}\\,\\mathrm{m}^2/\\mathrm{s}$, $\\Delta t = 1{,}000\\,\\mathrm{s}$, $C_L^n = 5\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_L^{n+1} = 5\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^{n+1} = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, and the single interior value $C_1^n = 1\\,\\mathrm{kg}/\\mathrm{m}^3$. Compute and return the single interior value $C_1^{n+1}$ as a float in $\\mathrm{kg}/\\mathrm{m}^3$.\n- Case D (time-varying boundary at the new time): $L = 10{,}000\\,\\mathrm{m}$, $N = 51$, $\\kappa = 10^{-4}\\,\\mathrm{m}^2/\\mathrm{s}$, $\\Delta t = 3{,}600\\,\\mathrm{s}$, $C_L^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_L^{n+1} = 2\\,\\mathrm{kg}/\\mathrm{m}^3$, $C_R^{n+1} = 0\\,\\mathrm{kg}/\\mathrm{m}^3$, and $C_i^n = 0\\,\\mathrm{kg}/\\mathrm{m}^3$ for all interior indices $i$. Compute and return the first interior value $C_1^{n+1}$ (adjacent to the left boundary) as a float in $\\mathrm{kg}/\\mathrm{m}^3$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases given above. For example, the output format must be of the form $[\\text{result}_A,\\text{result}_B,\\text{result}_C,\\text{result}_D]$ with each entry a floating-point number in $\\mathrm{kg}/\\mathrm{m}^3$.",
            "solution": "The goal is to derive and implement a discrete implicit diffusion scheme with centered second differences in space and backward Euler in time, and to impose Dirichlet boundary conditions at the new time level via modifications to the near-boundary stencils and the right-hand side.\n\nWe begin from the fundamental laws. Fick’s law gives the flux $J = -\\kappa \\, \\partial C / \\partial x$. Conservation of mass in one dimension is $\\partial C / \\partial t + \\partial J / \\partial x = 0$. Substituting Fick’s law yields\n$$\n\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2},\n$$\nwith $C$ in $\\mathrm{kg}/\\mathrm{m}^3$, $x$ in $\\mathrm{m}$, $t$ in $\\mathrm{s}$, and $\\kappa$ in $\\mathrm{m}^2/\\mathrm{s}$.\n\nWe lay down a uniform grid $x_i = i \\Delta x$ for $i \\in \\{0,1,\\dots,N-1\\}$, where $\\Delta x = L / (N - 1)$. At discrete times $t^n$, define $C_i^n \\approx C(x_i, t^n)$, with $t^{n+1} = t^n + \\Delta t$.\n\nAt interior points $i \\in \\{1,2,\\dots,N-2\\}$, approximate the time derivative by backward Euler and the second spatial derivative by the centered second difference evaluated at the new time:\n$$\n\\frac{C_i^{n+1} - C_i^n}{\\Delta t} = \\kappa \\frac{C_{i-1}^{n+1} - 2 C_i^{n+1} + C_{i+1}^{n+1}}{\\Delta x^2}.\n$$\nIntroducing the non-dimensional ratio $r = \\kappa \\Delta t / \\Delta x^2$, multiply both sides by $\\Delta t$ and rearrange to obtain the tridiagonal linear system for the interior unknowns,\n$$\n(1 + 2 r) \\, C_i^{n+1} - r \\, C_{i-1}^{n+1} - r \\, C_{i+1}^{n+1} = C_i^n, \\quad i = 1,2,\\dots,N-2.\n$$\n\nImposing Dirichlet boundary conditions is handled by substituting the boundary values directly at the new time level into the discrete equations wherever boundary nodes would appear. The boundary conditions are\n$$\nC_0^{n+1} = C_L^{n+1}, \\qquad C_{N-1}^{n+1} = C_R^{n+1}.\n$$\nFor the first interior equation at $i = 1$, the stencil references $C_0^{n+1}$, which is not an unknown but prescribed by the Dirichlet condition. Move its contribution to the right-hand side:\n$$\n(1 + 2 r) \\, C_1^{n+1} - r \\, C_{2}^{n+1} = C_1^n + r \\, C_0^{n+1} = C_1^n + r \\, C_L^{n+1}.\n$$\nFor the last interior equation at $i = N-2$, the stencil references $C_{N-1}^{n+1}$, which is prescribed. Move its contribution to the right-hand side:\n$$\n(1 + 2 r) \\, C_{N-2}^{n+1} - r \\, C_{N-3}^{n+1} = C_{N-2}^n + r \\, C_{N-1}^{n+1} = C_{N-2}^n + r \\, C_R^{n+1}.\n$$\nFor the strictly interior equations $i \\in \\{2,3,\\dots,N-3\\}$, the standard centered second-difference stencil remains unchanged:\n$$\n(1 + 2 r) \\, C_i^{n+1} - r \\, C_{i-1}^{n+1} - r \\, C_{i+1}^{n+1} = C_i^n.\n$$\n\nAs a result, the algebraic system for the interior unknown vector $\\mathbf{u}^{n+1} = [C_1^{n+1}, C_2^{n+1}, \\dots, C_{N-2}^{n+1}]^\\top$ is tridiagonal with constant coefficients:\n- Main diagonal entries equal to $1 + 2 r$.\n- Sub- and super-diagonal entries equal to $-r$.\n\nThe right-hand side vector $\\mathbf{b}$ is constructed as follows:\n- For entries $i \\in \\{2,3,\\dots,N-3\\}$ (which correspond to interior nodes), $\\mathbf{b}_i = C_i^n$.\n- For the first entry (corresponding to $i=1$), $\\mathbf{b}_1 = C_1^n + r \\, C_L^{n+1}$.\n- For the last entry (corresponding to $i=N-2$), $\\mathbf{b}_{N-2} = C_{N-2}^n + r \\, C_R^{n+1}$.\n\nAfter solving $\\mathbf{A} \\, \\mathbf{u}^{n+1} = \\mathbf{b}$, the full vector $[C_0^{n+1}, C_1^{n+1}, \\dots, C_{N-2}^{n+1}, C_{N-1}^{n+1}]^\\top$ is assembled by placing the known boundary values $C_0^{n+1} = C_L^{n+1}$ and $C_{N-1}^{n+1} = C_R^{n+1}$ together with the solved interior entries.\n\nAlgorithmic design:\n- Compute $\\Delta x = L / (N - 1)$ and $r = \\kappa \\Delta t / \\Delta x^2$.\n- Form the tridiagonal matrix $\\mathbf{A} \\in \\mathbb{R}^{(N-2) \\times (N-2)}$ with main diagonal $1 + 2 r$ and off-diagonals $-r$.\n- Form the right-hand side $\\mathbf{b} \\in \\mathbb{R}^{N-2}$ using the interior old-time values and the boundary contributions at $i=1$ and $i=N-2$.\n- Solve for $\\mathbf{u}^{n+1} = \\mathbf{A}^{-1} \\mathbf{b}$ using a direct solver.\n- Assemble the full $C^{n+1}$ including boundaries.\n\nTest suite reasoning:\n- Case A uses constant initial and boundary values. The diffusion operator acting on a constant field is zero, and backward Euler with homogeneous second-difference terms preserves the constant. The exact discrete solution is $C_i^{n+1} = 35$ for all $i$, so the maximum absolute deviation should be $0$ up to floating-point roundoff.\n- Case B starts from a zero interior and nonzero left boundary. The implicit step yields a nonzero interior profile toward the left boundary due to the added source $r \\, C_L^{n+1}$ in the first interior equation; the midpoint value is a meaningful scalar diagnostic of the profile.\n- Case C has $N = 3$, so there is only one interior node indexed by $i=1$. Its equation reduces to\n$$\n(1 + 2 r) \\, C_1^{n+1} = C_1^n + r \\, C_L^{n+1} + r \\, C_R^{n+1},\n$$\nand thus\n$$\nC_1^{n+1} = \\frac{C_1^n + r \\, C_L^{n+1} + r \\, C_R^{n+1}}{1 + 2 r}.\n$$\nThis tests near-boundary stencil modification in the smallest interior system.\n- Case D uses a time-varying left boundary where $C_L^{n+1}$ is nonzero and $C_L^n$ is zero, demonstrating that the implicit scheme enforces the new-time boundary by adding $r \\, C_L^{n+1}$ to the first interior equation, producing a nonzero first interior value $C_1^{n+1}$.\n\nThe program implements this scheme for the specified cases and outputs a single line with the four scalar results as floats in $\\mathrm{kg}/\\mathrm{m}^3$, enclosed in square brackets and comma-separated.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef implicit_diffusion_step(L, N, kappa, dt, CL_np1, CR_np1, C_n):\n    \"\"\"\n    Perform one backward Euler time step for 1D diffusion with centered second differences.\n    Dirichlet boundary conditions at the new time level are imposed via RHS modification.\n\n    Parameters:\n        L (float): Domain length in meters.\n        N (int): Number of grid points (including boundaries).\n        kappa (float): Diffusivity in m^2/s.\n        dt (float): Time step in seconds.\n        CL_np1 (float): Left boundary value at new time level (kg/m^3).\n        CR_np1 (float): Right boundary value at new time level (kg/m^3).\n        C_n (np.ndarray): Concentration at old time level, length N (kg/m^3).\n\n    Returns:\n        C_np1 (np.ndarray): Concentration at new time level, length N (kg/m^3).\n    \"\"\"\n    # Grid spacing\n    dx = L / (N - 1)\n    # Non-dimensional ratio r\n    r = kappa * dt / (dx * dx)\n\n    if N  2:\n        raise ValueError(\"N must be at least 2.\")\n    # Handle trivial case N == 2 (no interior points)\n    if N == 2:\n        C_np1 = np.array([CL_np1, CR_np1], dtype=float)\n        return C_np1\n\n    # Number of interior points\n    M = N - 2\n\n    # Assemble tridiagonal matrix A of size MxM\n    main_diag = (1.0 + 2.0 * r) * np.ones(M, dtype=float)\n    off_diag = (-r) * np.ones(M - 1, dtype=float)\n    A = np.diag(main_diag)\n    if M > 1:\n        A += np.diag(off_diag, k=1)\n        A += np.diag(off_diag, k=-1)\n\n    # Right-hand side vector b\n    b = C_n[1:-1].astype(float).copy()\n    # Modify near-boundary RHS entries to impose Dirichlet BCs at new time level\n    b[0] += r * CL_np1\n    b[-1] += r * CR_np1\n\n    # Solve for interior unknowns at new time level\n    u_np1 = np.linalg.solve(A, b)\n\n    # Assemble full solution including boundaries\n    C_np1 = np.zeros(N, dtype=float)\n    C_np1[0] = CL_np1\n    C_np1[-1] = CR_np1\n    C_np1[1:-1] = u_np1\n    return C_np1\n\ndef solve():\n    # Define the test cases from the problem statement.\n\n    # Case A: Steady consistency, happy path\n    L_A = 10000.0  # m\n    N_A = 51\n    kappa_A = 1e-4  # m^2/s\n    dt_A = 3600.0  # s\n    CLn_A = 35.0  # kg/m^3\n    CRn_A = 35.0  # kg/m^3\n    CLnp1_A = 35.0  # kg/m^3\n    CRnp1_A = 35.0  # kg/m^3\n    Cn_A = np.full(N_A, 35.0, dtype=float)  # constant interior equals boundary\n    Cnp1_A = implicit_diffusion_step(L_A, N_A, kappa_A, dt_A, CLnp1_A, CRnp1_A, Cn_A)\n    max_dev_A = float(np.max(np.abs(Cnp1_A[1:-1] - 35.0)))  # kg/m^3\n\n    # Case B: Gradient formation\n    L_B = 10000.0  # m\n    N_B = 51\n    kappa_B = 1e-4  # m^2/s\n    dt_B = 3600.0  # s\n    CLn_B = 10.0  # kg/m^3\n    CRn_B = 0.0  # kg/m^3\n    CLnp1_B = 10.0  # kg/m^3\n    CRnp1_B = 0.0  # kg/m^3\n    Cn_B = np.zeros(N_B, dtype=float)  # zero interior initially\n    # Boundaries are enforced at new time level; old boundary values do not enter directly\n    Cnp1_B = implicit_diffusion_step(L_B, N_B, kappa_B, dt_B, CLnp1_B, CRnp1_B, Cn_B)\n    mid_index_B = N_B // 2\n    mid_value_B = float(Cnp1_B[mid_index_B])  # kg/m^3\n\n    # Case C: Minimal interior, boundary influence (N=3)\n    L_C = 100.0  # m\n    N_C = 3\n    kappa_C = 1e-4  # m^2/s\n    dt_C = 1000.0  # s\n    CLn_C = 5.0  # kg/m^3\n    CRn_C = 0.0  # kg/m^3\n    CLnp1_C = 5.0  # kg/m^3\n    CRnp1_C = 0.0  # kg/m^3\n    Cn_C = np.zeros(N_C, dtype=float)\n    Cn_C[1] = 1.0  # single interior value\n    Cnp1_C = implicit_diffusion_step(L_C, N_C, kappa_C, dt_C, CLnp1_C, CRnp1_C, Cn_C)\n    interior_value_C = float(Cnp1_C[1])  # kg/m^3\n\n    # Case D: Time-varying boundary at the new time\n    L_D = 10000.0  # m\n    N_D = 51\n    kappa_D = 1e-4  # m^2/s\n    dt_D = 3600.0  # s\n    CLn_D = 0.0  # kg/m^3\n    CRn_D = 0.0  # kg/m^3\n    CLnp1_D = 2.0  # kg/m^3\n    CRnp1_D = 0.0  # kg/m^3\n    Cn_D = np.zeros(N_D, dtype=float)  # zero interior initially\n    Cnp1_D = implicit_diffusion_step(L_D, N_D, kappa_D, dt_D, CLnp1_D, CRnp1_D, Cn_D)\n    first_interior_D = float(Cnp1_D[1])  # kg/m^3\n\n    results = [max_dev_A, mid_value_B, interior_value_C, first_interior_D]\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}