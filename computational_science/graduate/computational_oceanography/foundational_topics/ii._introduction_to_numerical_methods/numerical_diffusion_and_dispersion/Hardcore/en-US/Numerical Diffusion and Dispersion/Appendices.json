{
    "hands_on_practices": [
        {
            "introduction": "Numerical schemes are approximations of partial differential equations, but what equation do they solve exactly? This practice introduces the powerful technique of modified equation analysis to answer that question. By performing a Taylor series expansion of the first-order upwind scheme, you will derive the continuous partial differential equation that the discrete scheme represents to a higher order, revealing the origin and form of its leading error term . This exercise makes the abstract concept of numerical diffusion concrete by allowing you to derive an analytical expression for the effective diffusion coefficient.",
            "id": "4069602",
            "problem": "Consider the constant-coefficient linear advection equation, which is a standard building block for tracer transport in numerical weather prediction and climate modeling,\n$$\nu_{t} + c \\, u_{x} = 0,\n$$\nwith constant wave speed $c>0$. On a uniform spatial grid with spacing $\\Delta x$ and time step $\\Delta t$, approximate $u(x,t)$ by $u_{i}^{n} \\approx u(x_{i}, t_{n})$ and advance in time with the explicit first-order upwind method (forward Euler in time and upwind in space for $c>0$):\n$$\nu_{i}^{n+1} = u_{i}^{n} - C \\left(u_{i}^{n} - u_{i-1}^{n}\\right),\n$$\nwhere the Courant–Friedrichs–Lewy (CFL) number is $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$. Assume $u$ is sufficiently smooth and that $C$ lies in the stable range $0  C \\leq 1$, as is typical for operational advection in atmospheric dynamical cores.\n\nUsing Taylor series about $(x_{i}, t_{n})$ and the governing partial differential equation to eliminate time derivatives in favor of spatial derivatives, derive the modified equation whose left-hand side matches the continuous advection operator and whose right-hand side captures the leading truncation effects up to and including terms of order $\\mathcal{O}(\\Delta x^{2})$. Write the modified equation in the canonical form\n$$\nu_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms},\n$$\nand identify the effective diffusion coefficient $\\nu_{\\text{eff}}$ as a function of $c$, $\\Delta x$, and $C$.\n\nProvide as your final answer only the closed-form analytical expression for $\\nu_{\\text{eff}}$. No rounding is required, and no units should be included in the final answer.",
            "solution": "The goal is to derive the modified equation, which is a continuous partial differential equation whose solution approximates the numerical solution of the discrete scheme to a specified order. We begin with the constant-coefficient linear advection equation\n$$\nu_{t} + c \\, u_{x} = 0, \\quad c>0,\n$$\nand the first-order upwind scheme for $c>0$,\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} + c \\, \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = 0,\n$$\nwhich is algebraically equivalent to the update formula given.\n\nWe interpret $u_{i}^{n}$ as the exact solution sampled at $(x_{i}, t_{n})$ and expand the discrete operators in Taylor series about $(x_{i}, t_{n})$. For the forward time difference,\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} = u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3}).\n$$\nFor the backward spatial difference,\n$$\n\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3}).\n$$\nSubstituting these expansions into the discrete scheme yields\n$$\n\\left[u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3})\\right]\n+ c \\left[u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3})\\right] = 0.\n$$\nTo express the time derivatives in terms of spatial derivatives, we repeatedly differentiate the governing equation with respect to time and use commutation of partial derivatives. From $u_{t} + c \\, u_{x} = 0$ it follows that\n$$\nu_{t} = - c \\, u_{x}, \\quad\nu_{tt} = (u_{t})_{t} = - c \\, (u_{x})_{t} = - c \\, (u_{t})_{x} = - c \\, (- c \\, u_{x})_{x} = c^{2} \\, u_{xx},\n$$\nand similarly,\n$$\nu_{ttt} = (u_{tt})_{t} = \\left(c^{2} \\, u_{xx}\\right)_{t} = c^{2} \\, (u_{xx})_{t} = c^{2} \\, (u_{t})_{xx} = c^{2} \\, (- c \\, u_{x})_{xx} = - c^{3} \\, u_{xxx}.\n$$\nSubstituting these into the expanded scheme gives\n$$\nu_{t} + c \\, u_{x}\n+ \\left(\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\\right) u_{xx}\n+ \\left(- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\\right) u_{xxx}\n+ \\text{higher-order terms} = 0.\n$$\nIntroduce the Courant–Friedrichs–Lewy (CFL) number $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$ and note that $\\Delta t = \\dfrac{C \\, \\Delta x}{c}$ and $\\Delta t^{2} = \\dfrac{C^{2} \\, \\Delta x^{2}}{c^{2}}$. Then the coefficients simplify as\n$$\n\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\n= \\frac{c}{2} \\left(c \\, \\Delta t - \\Delta x\\right)\n= \\frac{c}{2} \\left(\\Delta x \\, C - \\Delta x\\right)\n= \\frac{c \\, \\Delta x}{2} (C - 1),\n$$\nand\n$$\n- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\n= - \\frac{c}{6} \\left(\\frac{C^{2} \\, \\Delta x^{2}}{c^{2}}\\right) c^{2} + \\frac{c \\, \\Delta x^{2}}{6}\n= \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}).\n$$\nTherefore, the modified equation, accurate through terms of order $\\mathcal{O}(\\Delta x^{2})$ when $C$ is treated as order $\\mathcal{O}(1)$, is\n$$\nu_{t} + c \\, u_{x}\n+ \\frac{c \\, \\Delta x}{2} (C - 1) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}) \\, u_{xxx}\n= 0,\n$$\nwhich we can equivalently write as\n$$\nu_{t} + c \\, u_{x}\n= \\frac{c \\, \\Delta x}{2} (1 - C) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (C^{2} - 1) \\, u_{xxx}\n+ \\text{higher-order terms}.\n$$\nComparing with the canonical form $u_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms}$, we identify the effective diffusion coefficient as\n$$\n\\nu_{\\text{eff}} = \\frac{c \\, \\Delta x}{2} (1 - C).\n$$\nFor $0  C \\leq 1$, this coefficient is nonnegative, reflecting the monotonicity-preserving, diffusive character of the first-order upwind scheme widely exploited to control spurious oscillations in tracer advection within atmospheric and oceanic models.",
            "answer": "$$\\boxed{\\frac{c\\,\\Delta x}{2}\\,(1-C)}$$"
        },
        {
            "introduction": "While modified equation analysis reveals error terms in physical space, Fourier analysis provides a complementary view in wavenumber space. This practice utilizes von Neumann stability analysis to explore how different numerical schemes affect waves of different lengths. You will derive the amplification factor $G(\\theta)$ for both the upwind and Lax-Friedrichs schemes, which quantifies the change in amplitude and phase for each Fourier mode per time step . This allows for a precise, scale-dependent comparison of numerical diffusion, represented by $|G(\\theta)|$, and dispersion, represented by $\\arg(G(\\theta))$, between the schemes.",
            "id": "3803230",
            "problem": "Consider the one-dimensional linear advection equation $u_t + a\\,u_x = 0$ with constant speed $a0$, discretized on a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$. Define the Courant number $\\nu = a\\,\\Delta t/\\Delta x$ and the nondimensional wavenumber $\\theta = k\\,\\Delta x$ for a Fourier mode of physical wavenumber $k$. Two explicit first-order time-advancement finite-difference schemes are considered:\n- The first-order upwind scheme for $a0$: $u_j^{n+1} = u_j^n - \\nu\\,(u_j^n - u_{j-1}^n)$.\n- The Lax–Friedrichs scheme: $u_j^{n+1} = \\tfrac{1}{2}\\left(u_{j+1}^n + u_{j-1}^n\\right) - \\tfrac{\\nu}{2}\\left(u_{j+1}^n - u_{j-1}^n\\right)$.\n\nUsing von Neumann analysis, derive the amplification factor $G(\\theta)$ for each scheme by substituting a Fourier mode $u_j^n = \\hat{u}^n \\exp(i j \\theta)$ into the corresponding update, where $i$ is the imaginary unit and $j$ is the spatial index. From these factors, quantify their dissipative properties by the amplitude reduction per time step, given by $|G(\\theta)|$. Working from these derivations and treating $\\nu$ as a parameter with $0\\nu\\le 1$, determine the nontrivial wavenumber $\\theta_c \\in (0,\\pi]$ (in radians) at which the two schemes have equal amplitude attenuation per time step, i.e., $|G_{\\mathrm{up}}(\\theta_c,\\nu)| = |G_{\\mathrm{LF}}(\\theta_c,\\nu)|$, excluding the trivial solution at $\\theta=0$. Provide an explicit analytic expression for $\\theta_c$ as a function of $\\nu$. Express the final answer in radians. No numerical evaluation is required, and no rounding should be performed.",
            "solution": "The solution proceeds by first deriving the amplification factor $G(\\theta)$ and its magnitude $|G(\\theta)|$ for each of the two schemes. Then, the magnitudes are set equal to find the desired wavenumber $\\theta_c$.\n\n**1. First-Order Upwind Scheme**\n\nThe scheme is given by $u_j^{n+1} = u_j^n - \\nu(u_j^n - u_{j-1}^n)$. We substitute the Fourier mode $u_j^n = \\hat{u}^n \\exp(i j \\theta)$:\n$$\n\\hat{u}^{n+1} \\exp(ij\\theta) = \\hat{u}^{n} \\exp(ij\\theta) - \\nu(\\hat{u}^{n} \\exp(ij\\theta) - \\hat{u}^{n} \\exp(i(j-1)\\theta))\n$$\nThe amplification factor $G_{\\mathrm{up}}(\\theta) = \\hat{u}^{n+1}/\\hat{u}^n$ is obtained by dividing the equation by $\\hat{u}^n \\exp(ij\\theta)$:\n$$\nG_{\\mathrm{up}}(\\theta) = 1 - \\nu(1 - \\exp(-i\\theta))\n$$\nTo find the magnitude $|G_{\\mathrm{up}}(\\theta)|$, we first express $G_{\\mathrm{up}}(\\theta)$ in terms of its real and imaginary parts using $\\exp(-i\\theta) = \\cos(\\theta) - i\\sin(\\theta)$:\n$$\nG_{\\mathrm{up}}(\\theta) = (1 - \\nu(1-\\cos(\\theta))) + i\\nu\\sin(\\theta)\n$$\nThe square of the magnitude is $|G_{\\mathrm{up}}(\\theta)|^2 = (\\mathrm{Re}(G_{\\mathrm{up}}))^2 + (\\mathrm{Im}(G_{\\mathrm{up}}))^2$:\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = (1 - \\nu(1-\\cos(\\theta)))^2 + (\\nu\\sin(\\theta))^2\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1-\\cos(\\theta))^2 + \\nu^2\\sin^2(\\theta)\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + \\cos^2(\\theta)) + \\nu^2\\sin^2(\\theta)\n$$\nUsing the identity $\\cos^2(\\theta) + \\sin^2(\\theta) = 1$:\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + 1)\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + 2\\nu^2(1-\\cos(\\theta))\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\nu)(1-\\cos(\\theta))\n$$\n\n**2. Lax–Friedrichs Scheme**\n\nThe scheme is $u_j^{n+1} = \\frac{1}{2}(u_{j+1}^n + u_{j-1}^n) - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n)$. Substituting the Fourier mode $u_j^n = \\hat{u}^n \\exp(i j \\theta)$:\n$$\n\\hat{u}^{n+1} \\exp(ij\\theta) = \\frac{1}{2}(\\hat{u}^{n} \\exp(i(j+1)\\theta) + \\hat{u}^{n} \\exp(i(j-1)\\theta)) - \\frac{\\nu}{2}(\\hat{u}^{n} \\exp(i(j+1)\\theta) - \\hat{u}^{n} \\exp(i(j-1)\\theta))\n$$\nDividing by $\\hat{u}^n \\exp(ij\\theta)$ gives the amplification factor $G_{\\mathrm{LF}}(\\theta)$:\n$$\nG_{\\mathrm{LF}}(\\theta) = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta)) - \\frac{\\nu}{2}(\\exp(i\\theta) - \\exp(-i\\theta))\n$$\nUsing Euler's identities, $\\cos(\\theta) = \\frac{\\exp(i\\theta) + \\exp(-i\\theta)}{2}$ and $\\sin(\\theta) = \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2i}$:\n$$\nG_{\\mathrm{LF}}(\\theta) = \\cos(\\theta) - i\\nu\\sin(\\theta)\n$$\nThe square of the magnitude is:\n$$\n|G_{\\mathrm{LF}}(\\theta)|^2 = (\\cos(\\theta))^2 + (-\\nu\\sin(\\theta))^2 = \\cos^2(\\theta) + \\nu^2\\sin^2(\\theta)\n$$\n\n**3. Equating the Amplitudes**\n\nThe condition is $|G_{\\mathrm{up}}(\\theta_c)| = |G_{\\mathrm{LF}}(\\theta_c)|$. It is more convenient to work with the squares of the magnitudes: $|G_{\\mathrm{up}}(\\theta_c)|^2 = |G_{\\mathrm{LF}}(\\theta_c)|^2$.\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = \\cos^2(\\theta_c) + \\nu^2\\sin^2(\\theta_c)\n$$\nTo solve for $\\theta_c$, we express the equation solely in terms of $\\cos(\\theta_c)$ by substituting $\\sin^2(\\theta_c) = 1 - \\cos^2(\\theta_c)$:\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = \\cos^2(\\theta_c) + \\nu^2(1 - \\cos^2(\\theta_c))\n$$\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = (1-\\nu^2)\\cos^2(\\theta_c) + \\nu^2\n$$\nLet $C = \\cos(\\theta_c)$. The equation becomes:\n$$\n1 - (2\\nu-2\\nu^2)(1-C) = (1-\\nu^2)C^2 + \\nu^2\n$$\nRearranging the terms to form a quadratic equation in $C$:\n$$\n(1-\\nu^2)C^2 + (2\\nu-2\\nu^2)(1-C) - 1 + \\nu^2 = 0\n$$\n$$\n(1-\\nu^2)C^2 + (2\\nu-2\\nu^2) - (2\\nu-2\\nu^2)C - 1 + \\nu^2 = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C + (2\\nu - 2\\nu^2 - 1 + \\nu^2) = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C - (1 - 2\\nu + \\nu^2) = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C - (1-\\nu)^2 = 0\n$$\nFor the case $\\nu=1$, this equation becomes $0=0$, because for $\\nu=1$, $|G_{\\mathrm{up}}|=1$ and $|G_{\\mathrm{LF}}|=1$ for all $\\theta$, so the equality holds trivially everywhere. For $\\nu \\in (0, 1)$, we can divide by the non-zero factor $(1-\\nu)$:\n$$\n(1+\\nu)C^2 - 2\\nu C - (1-\\nu) = 0\n$$\nWe are looking for a nontrivial solution, so we expect $\\theta_c \\neq 0$, which means $C \\neq 1$. We can check if $C=1$ is a root of this quadratic equation:\n$$\n(1+\\nu)(1)^2 - 2\\nu(1) - (1-\\nu) = 1+\\nu - 2\\nu - 1 + \\nu = 0\n$$\nSince $C=1$ is a root, $(C-1)$ is a factor of the polynomial. We can factor the quadratic:\n$$\n(C-1)((1+\\nu)C + (1-\\nu)) = 0\n$$\nThis gives two roots:\n1.  $C = 1$, which corresponds to the trivial solution $\\theta_c = 0$.\n2.  $(1+\\nu)C + (1-\\nu) = 0$, which gives the nontrivial solution.\n\nSolving for $C$ from the second factor:\n$$\n(1+\\nu)C = -(1-\\nu) = \\nu-1\n$$\n$$\nC = \\cos(\\theta_c) = \\frac{\\nu-1}{1+\\nu}\n$$\nSince $0  \\nu \\le 1$, the numerator $\\nu-1$ is in the range $(-1, 0]$, and the denominator $1+\\nu$ is in $(1, 2]$. Thus, $\\cos(\\theta_c)$ is in the range $(-1, 0]$. This corresponds to a unique angle $\\theta_c$ in the interval $[\\pi/2, \\pi)$, which is within the specified domain $(0, \\pi]$.\nThe expression for $\\theta_c$ is obtained by taking the arccosine:\n$$\n\\theta_c = \\arccos\\left(\\frac{\\nu-1}{\\nu+1}\\right)\n$$\nThis expression is also well-defined and continuous for the endpoint $\\nu=1$, where it yields $\\theta_c = \\arccos(0) = \\frac{\\pi}{2}$. This provides a single, consistent answer across the entire domain $0  \\nu \\le 1$.",
            "answer": "$$\n\\boxed{\\arccos\\left(\\frac{\\nu-1}{\\nu+1}\\right)}\n$$"
        },
        {
            "introduction": "Theoretical analysis provides indispensable insight, but seeing the effects of numerical errors in action solidifies understanding. This computational exercise bridges the gap between theory and practice by simulating the advection of a tracer pulse. You will implement both a highly diffusive first-order scheme and a more dispersive second-order scheme to observe their distinct impacts on the solution . By computing metrics for variance decay and phase shift, you will directly measure and quantify the numerical diffusion and dispersion predicted by the analytical methods.",
            "id": "3803225",
            "problem": "Consider the one-dimensional linear advection of a passive tracer governed by the partial differential equation $c_t + u c_x = 0$ on a periodic domain of length $L$ with constant velocity $u$. In the absence of physical diffusion, the exact solution transports any initial condition $c(x,0)$ without changing its shape, total mass, or spatial variance. However, discrete numerical schemes introduce numerical errors that can be decomposed into two effects: numerical diffusion (amplitude damping that reduces the variance of tracer fluctuations) and numerical dispersion (phase errors that shift or distort features without necessarily changing their amplitude). Your task is to quantify these two effects over exactly one period of advection, $T = L/u$, for a Gaussian pulse using two standard explicit schemes.\n\nImplement a program that:\n- Represents the solution on a uniform periodic grid with $N$ points, grid spacing $\\Delta x = L/N$, and time step $\\Delta t$ chosen from a specified Courant–Friedrichs–Lewy number (CFL), $\\mathrm{C} = u \\Delta t / \\Delta x$.\n- Initializes the tracer as a Gaussian pulse centered at $x_0$ with standard deviation $\\sigma$ on $[0,L)$:\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right),\n$$\nwhere $d(x;x_0)$ is the minimal periodic distance between $x$ and $x_0$ on the circle $[0,L)$, so that $d \\in \\left[-\\frac{L}{2},\\frac{L}{2}\\right]$.\n- Evolves the tracer for exactly one period $T = L/u$ using one of the following conservative, periodic, finite-difference update rules (space is discretized with index $i \\in \\{0,\\dots,N-1\\}$ and time level $n$):\n    1. First-order upwind (for $u \\ge 0$):\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\,\\left(c_i^n - c_{i-1}^n\\right),\n    $$\n    with periodic indexing $c_{-1}^n \\equiv c_{N-1}^n$.\n    2. Lax–Wendroff (second order):\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right),\n    $$\n    with periodic indexing.\n- Ensures that the number of time steps $n_T$ satisfies $n_T \\Delta t = T$ exactly. For the test suite below, this is guaranteed by choosing $\\mathrm{C}$ so that $T/\\Delta t = N/\\mathrm{C}$ is an integer.\n- Quantifies numerical diffusion by the decay in the discrete spatial variance (per unit length) of the zero-mean tracer field between $t=0$ and $t=T$. Define the discrete mean and variance at time $t^n$ by\n$$\n\\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2.\n$$\nReport the ratio\n$$\nR_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}},\n$$\nwhich should be less than $1$ if numerical diffusion is present, and equal to $1$ for a perfectly nondiffusive evolution.\n- Quantifies numerical dispersion by the residual phase shift over one period of the dominant large-scale Fourier mode of the zero-mean tracer field. Let $\\widehat{C}_1^n$ denote the discrete Fourier coefficient of the zero-mean field at wavenumber $k_1 = 2\\pi/L$ (the $k=1$ mode) at time $t^n$, computed via the discrete Fourier transform convention\n$$\n\\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right).\n$$\nThe exact continuum solution after one period has no net phase change for any integer spatial Fourier mode. Any nonzero phase change of the $k=1$ mode is therefore purely numerical. Define the wrapped phase difference\n$$\n\\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right),\n$$\nwhere $\\mathrm{wrap}(\\theta)$ maps angles to $(-\\pi,\\pi]$. Convert this phase difference to an equivalent spatial phase shift in meters by\n$$\n\\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi,\n$$\nwhich is the residual spatial shift of the dominant mode after one period. Report $\\Delta x_{\\mathrm{phase}}$ in meters.\n\nYour program must compute, for each test case, the list $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$ and aggregate the results for all test cases into a single line printed to standard output as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of two floating-point numbers. No other text should be printed.\n\nAll physical quantities must be handled in the units specified: $L$ in meters ($\\mathrm{m}$), $u$ in meters per second ($\\mathrm{m/s}$), $T$ in seconds ($\\mathrm{s}$), and $\\Delta x_{\\mathrm{phase}}$ in meters ($\\mathrm{m}$). Angles used internally for phase computation must be in radians.\n\nTest Suite:\nImplement the four cases below. For each, run exactly one period and report $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$.\n\n- Case A (first-order upwind, moderate $\\mathrm{C}$): $L = 1.0\\,\\mathrm{m}$, $N = 256$, $u = 1.0\\,\\mathrm{m/s}$, $\\mathrm{C} = 0.5$, $\\sigma = 0.05\\,L$, $x_0 = 0.3\\,L$.\n- Case B (Lax–Wendroff, moderate $\\mathrm{C}$): $L = 1.0\\,\\mathrm{m}$, $N = 256$, $u = 1.0\\,\\mathrm{m/s}$, $\\mathrm{C} = 0.5$, $\\sigma = 0.05\\,L$, $x_0 = 0.3\\,L$.\n- Case C (first-order upwind, limiting $\\mathrm{C}$): $L = 1.0\\,\\mathrm{m}$, $N = 200$, $u = 1.0\\,\\mathrm{m/s}$, $\\mathrm{C} = 1.0$, $\\sigma = 0.08\\,L$, $x_0 = 0.4\\,L$.\n- Case D (Lax–Wendroff, narrow pulse): $L = 1.0\\,\\mathrm{m}$, $N = 256$, $u = 1.0\\,\\mathrm{m/s}$, $\\mathrm{C} = 0.5$, $\\sigma = 0.01\\,L$, $x_0 = 0.25\\,L$.\n\nFinal Output Format:\nYour program should produce a single line of output containing a list with four elements, each element being a list of two floats in the order $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$, corresponding to Cases A, B, C, and D, respectively. For example:\n`[[r_A, s_A], [r_B, s_B], [r_C, s_C], [r_D, s_D]]`,\nwhere each $r_\\cdot$ and $s_\\cdot$ is a floating-point number. Do not include units in the output; all distances are implicitly in meters and all ratios are dimensionless.",
            "solution": "The problem requires the quantification of numerical diffusion and dispersion for two finite-difference schemes used to solve the one-dimensional linear advection equation, $c_t + u c_x = 0$. This equation describes the transport of a passive tracer concentration, $c(x,t)$, with a constant velocity $u$ on a one-dimensional periodic domain of length $L$. The exact solution translates the initial tracer profile $c(x,0)$ without any change in shape, amplitude, or variance. Numerical schemes, however, introduce errors that manifest as numerical diffusion (a damping of amplitudes) and numerical dispersion (phase errors leading to shape distortion). The task is to compute these errors for a Gaussian initial condition after one full advective period, $T = L/u$.\n\nThe solution is developed by first discretizing the governing equation, implementing the specified numerical schemes, and then applying well-defined metrics to the initial and final states of the simulation.\n\n**1. Discretization and Simulation Setup**\n\nThe continuous domain $[0, L)$ is discretized into a uniform grid of $N$ points, indexed by $i = 0, \\dots, N-1$. The grid points are located at $x_i = i \\Delta x$, where the grid spacing is $\\Delta x = L/N$. Time is discretized into steps of size $\\Delta t$. The relationship between spatial and temporal discretization is governed by the Courant–Friedrichs–Lewy (CFL) number, defined as $\\mathrm{C} = u \\Delta t / \\Delta x$. For the stability of the explicit schemes used, this number must be constrained.\n\nThe simulation runs for a total duration of $T = L/u$, which corresponds to the time it takes for a feature to be advected exactly once around the periodic domain. The total number of time steps, $n_T$, is chosen such that $n_T \\Delta t = T$. By substituting the definitions of $T$, $\\Delta t$, and $\\mathrm{C}$, we find $n_T = \\frac{L/u}{( \\mathrm{C} \\Delta x / u)} = \\frac{L}{\\mathrm{C} (L/N)} = N/\\mathrm{C}$. The problem guarantees that for all test cases, $N/\\mathrm{C}$ is an integer, ensuring the simulation terminates precisely at one period.\n\n**2. Initial Condition**\n\nThe initial tracer distribution is a Gaussian pulse, given by:\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right)\n$$\nHere, $x_0$ is the center of the pulse, $\\sigma$ is its standard deviation, and $d(x; x_0)$ is the minimal periodic distance between any point $x$ and the center $x_0$. This distance function correctly handles the wrap-around nature of the periodic domain and is defined on the interval $[-\\frac{L}{2}, \\frac{L}{2}]$. In a discrete implementation on the grid $\\{x_i\\}$, the distance from each $x_i$ to $x_0$ is calculated as $d(x_i; x_0) = (x_i - x_0) - L \\cdot \\mathrm{round}((x_i - x_0)/L)$. This ensures the Gaussian is centered correctly and symmetrically on the circular domain.\n\n**3. Numerical Schemes**\n\nThe evolution of the discrete tracer field $c_i^n \\approx c(x_i, t^n)$ is computed using two explicit, conservative finite-difference schemes. Periodicity is enforced by using modular arithmetic on the spatial indices, such that $c_{i \\pm N}^n = c_i^n$.\n\n*   **First-Order Upwind Scheme:** For a positive velocity $u \\ge 0$, this scheme is given by:\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\left(c_i^n - c_{i-1}^n\\right)\n    $$\n    This scheme is first-order accurate in both space and time. It is known to be numerically stable for $0 \\le \\mathrm{C} \\le 1$. Its leading-order truncation error term is proportional to the second spatial derivative, which acts as a diffusion term. Consequently, this scheme is highly dissipative, causing sharp gradients to smear out and amplitudes to decay over time. In the special case where $\\mathrm{C}=1$, the scheme becomes $c_i^{n+1} = c_{i-1}^n$, which is an exact shift operator on the grid. The discrete solution is transported without any error in this case.\n\n*   **Lax–Wendroff Scheme:** This is a second-order accurate scheme in both space and time:\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right)\n    $$\n    The Lax–Wendroff scheme is stable for $|\\mathrm{C}| \\le 1$. It is constructed to cancel the second-order truncation error term, making it significantly less diffusive than the upwind scheme. However, its dominant error term is proportional to the third spatial derivative, which introduces dispersive errors. These errors cause different Fourier components of the solution to propagate at incorrect phase velocities, leading to spurious oscillations, particularly near sharp features.\n\nFor implementation, these update rules are applied vectorially to the entire solution array $c^n$ at each time step. The periodic shifts required for terms like $c_{i\\pm 1}^n$ are efficiently handled using array-rolling operations.\n\n**4. Quantification of Numerical Errors**\n\nTwo metrics are computed to quantify the effects of numerical diffusion and dispersion after one period, $T$.\n\n*   **Numerical Diffusion Metric ($R_{\\mathrm{var}}$):** Numerical diffusion damps the amplitude of tracer fluctuations. This effect is quantified by measuring the decay in the spatial variance of the solution. The discrete mean and variance of the tracer field at time level $n$ are:\n    $$\n    \\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2\n    $$\n    The diffusion metric is the ratio of the final variance at time $t^{n_T} = T$ to the initial variance at $t=0$:\n    $$\n    R_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}}\n    $$\n    For a perfect, non-diffusive scheme, $R_{\\mathrm{var}} = 1$. The presence of numerical diffusion leads to $R_{\\mathrm{var}}  1$.\n\n*   **Numerical Dispersion Metric ($\\Delta x_{\\mathrm{phase}}$):** Numerical dispersion causes different wavelengths to travel at incorrect speeds. This is analyzed by examining the phase of a specific Fourier mode of the solution. We focus on the mode with the longest wavelength that fits the domain, which has wavenumber $k_1 = 2\\pi/L$. The complex coefficient of this mode is found using the Discrete Fourier Transform (DFT) of the zero-mean tracer field, $c_j^n - \\overline{c}^n$:\n    $$\n    \\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right)\n    $$\n    For the exact solution after one period $T=L/u$, the field returns to its original state, so the phase of any Fourier coefficient should be unchanged. Any numerical phase error is captured by the difference between the final and initial phase of the $k=1$ mode, $\\widehat{C}_1^n$. The wrapped phase difference is calculated as:\n    $$\n    \\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right)\n    $$\n    where the $\\mathrm{wrap}(\\theta)$ function maps an angle $\\theta$ into the interval $(-\\pi, \\pi]$. A phase error $\\Delta \\phi$ is equivalent to an erroneous spatial shift. A spatial shift of $\\delta x$ imparts a phase change of $-k_1 \\delta x = - (2\\pi/L) \\delta x$. Therefore, the equivalent spatial phase shift is:\n    $$\n    \\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi\n    $$\n    This value represents the residual displacement of the dominant large-scale feature of the tracer after one period. A non-zero $\\Delta x_{\\mathrm{phase}}$ is a direct measure of the scheme's cumulative dispersive error.\n\n**5. Algorithmic Implementation**\n\nThe algorithm proceeds as follows for each test case:\n1.  Initialize parameters ($L$, $N$, $u$, $\\mathrm{C}$, etc.).\n2.  Construct the spatial grid $x_i$ and the initial Gaussian profile $c^0$.\n3.  Compute the initial variance $\\mathrm{Var}^0$ and the initial phase $\\arg(\\widehat{C}_1^0)$.\n4.  Loop for $n_T = N/\\mathrm{C}$ time steps, applying the chosen numerical scheme (Upwind or Lax-Wendroff) at each step to update the solution vector.\n5.  After the loop, compute the final variance $\\mathrm{Var}^{n_T}$ and final phase $\\arg(\\widehat{C}_1^{n_T})$.\n6.  Calculate the metrics $R_{\\mathrm{var}}$ and $\\Delta x_{\\mathrm{phase}}$ using the formulas above.\n7.  Store the resulting pair $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$.\n\nThis process is repeated for all four test cases, and the results are aggregated into a final list for output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the 1D advection problem.\n    \"\"\"\n\n    def solve_case(scheme, L, N, u, C, sigma_rel, x0_rel):\n        \"\"\"\n        Solves a single case of the 1D advection problem.\n\n        Args:\n            scheme (str): 'upwind' or 'lax-wendroff'.\n            L (float): Domain length in meters.\n            N (int): Number of grid points.\n            u (float): Advection velocity in m/s.\n            C (float): Courant number.\n            sigma_rel (float): Standard deviation as a fraction of L.\n            x0_rel (float): Initial pulse center as a fraction of L.\n\n        Returns:\n            list: A list containing [R_var, delta_x_phase].\n        \"\"\"\n        # 1. Setup simulation parameters\n        dx = L / N\n        T = L / u\n        n_T = int(round(N / C))\n        # dt = T / n_T # Equivalent to C * dx / u\n\n        sigma = sigma_rel * L\n        x0 = x0_rel * L\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # 2. Set Initial Condition (Periodic Gaussian)\n        dist_x = x - x0\n        # Minimal periodic distance on the torus [0, L)\n        d = dist_x - L * np.round(dist_x / L)\n        c0 = np.exp(-(d**2) / (2 * sigma**2))\n\n        # 3. Analyze Initial State\n        var0 = np.var(c0)\n        c0_zm = c0 - np.mean(c0)\n        C_hat_0 = np.fft.fft(c0_zm)\n        # Phase of the k=1 mode\n        phi0 = np.angle(C_hat_0[1])\n\n        # 4. Time Evolution Loop\n        c_current = c0.copy()\n        if scheme == 'upwind':\n            for _ in range(n_T):\n                c_current = (1 - C) * c_current + C * np.roll(c_current, 1)\n        elif scheme == 'lax-wendroff':\n            for _ in range(n_T):\n                c_ip1 = np.roll(c_current, -1)\n                c_im1 = np.roll(c_current, 1)\n                term1 = -0.5 * C * (c_ip1 - c_im1)\n                term2 = 0.5 * C**2 * (c_ip1 - 2 * c_current + c_im1)\n                c_current = c_current + term1 + term2\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        c_final = c_current\n\n        # 5. Analyze Final State\n        var_final = np.var(c_final)\n        c_final_zm = c_final - np.mean(c_final)\n        C_hat_nT = np.fft.fft(c_final_zm)\n        # Phase of the k=1 mode\n        phi_nT = np.angle(C_hat_nT[1])\n\n        # 6. Calculate Metrics\n        # Numerical Diffusion: Variance Ratio\n        R_var = var_final / var0 if var0 > 0 else 1.0\n\n        # Numerical Dispersion: Phase Shift\n        \n        # Wrap angle to (-pi, pi]\n        def wrap_angle(angle):\n            return (angle + np.pi) % (2 * np.pi) - np.pi\n\n        delta_phi_raw = phi_nT - phi0\n        delta_phi = wrap_angle(delta_phi_raw)\n\n        delta_x_phase = -L * delta_phi / (2 * np.pi)\n\n        return [R_var, delta_x_phase]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: first-order upwind, moderate C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case B: Lax-Wendroff, moderate C\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case C: first-order upwind, limiting C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 200, 'u': 1.0, 'C': 1.0, 'sigma_rel': 0.08, 'x0_rel': 0.4},\n        # Case D: Lax-Wendroff, narrow pulse\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.01, 'x0_rel': 0.25},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(**case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}