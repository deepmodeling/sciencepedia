{
    "hands_on_practices": [
        {
            "introduction": "理论分析是理解数值误差根源的基石。本练习将通过推导修正方程来探索最基本的一维平流格式——一阶迎风格式的内在属性。通过泰勒级数展开，我们将揭示该离散格式实际上近似求解的偏微分方程，并识别出其中隐藏的、纯粹由数值方法引入的“有效扩散”项 。这项实践旨在帮助你掌握一种强大的分析工具，从根本上理解数值扩散的来源。",
            "id": "4069602",
            "problem": "考虑常系数线性平流方程，这是数值天气预报和气候模拟中示踪物输运的一个标准组成部分，\n$$\nu_{t} + c \\, u_{x} = 0,\n$$\n其中波速 $c>0$ 为常数。在一个空间间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀空间网格上，用 $u_{i}^{n} \\approx u(x_{i}, t_{n})$ 来近似 $u(x,t)$，并使用显式一阶迎风法（对于 $c>0$，时间上采用向前欧拉法，空间上采用迎风法）在时间上进行推进：\n$$\nu_{i}^{n+1} = u_{i}^{n} - C \\left(u_{i}^{n} - u_{i-1}^{n}\\right),\n$$\n其中库朗-弗里德里希斯-列维（CFL）数是 $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$。假设 $u$ 足够光滑，并且 $C$ 位于稳定范围 $0  C \\leq 1$ 内，这在用于大气动力核心的业务平流计算中是典型情况。\n\n使用关于 $(x_{i}, t_{n})$ 的泰勒级数展开，并利用控制偏微分方程将时间导数替换为空间导数，推导修正方程。该修正方程的左侧与连续平流算子匹配，右侧则捕捉了截至并包括 $\\mathcal{O}(\\Delta x^{2})$ 阶项的主导截断效应。将修正方程写成以下典范形式\n$$\nu_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms},\n$$\n并确定有效扩散系数 $\\nu_{\\text{eff}}$ 作为 $c$、$\\Delta x$ 和 $C$ 的函数。\n\n最终答案只需提供 $\\nu_{\\text{eff}}$ 的闭式解析表达式。无需四舍五入，最终答案中不应包含任何单位。",
            "solution": "目标是推导修正方程，这是一个连续偏微分方程，其解能在指定阶数上近似离散格式的数值解。我们从常系数线性平流方程开始\n$$\nu_{t} + c \\, u_{x} = 0, \\quad c>0,\n$$\n以及针对 $c>0$ 的一阶迎风格式，\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} + c \\, \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = 0,\n$$\n这在代数上等价于给定的更新公式。\n\n我们将 $u_{i}^{n}$ 解释为在 $(x_{i}, t_{n})$ 处采样的精确解，并将离散算子在 $(x_{i}, t_{n})$ 点进行泰勒级数展开。对于向前时间差分，\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} = u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3}).\n$$\n对于向后空间差分，\n$$\n\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3}).\n$$\n将这些展开式代入离散格式，得到\n$$\n\\left[u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3})\\right]\n+ c \\left[u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3})\\right] = 0.\n$$\n为了用空间导数表示时间导数，我们对控制方程重复进行关于时间的求导，并利用偏导数的可交换性。由 $u_{t} + c \\, u_{x} = 0$ 可得\n$$\nu_{t} = - c \\, u_{x}, \\quad\nu_{tt} = (u_{t})_{t} = - c \\, (u_{x})_{t} = - c \\, (u_{t})_{x} = - c \\, (- c \\, u_{x})_{x} = c^{2} \\, u_{xx},\n$$\n同样地，\n$$\nu_{ttt} = (u_{tt})_{t} = \\left(c^{2} \\, u_{xx}\\right)_{t} = c^{2} \\, (u_{xx})_{t} = c^{2} \\, (u_{t})_{xx} = c^{2} \\, (- c \\, u_{x})_{xx} = - c^{3} \\, u_{xxx}.\n$$\n将这些代入展开后的格式，得到\n$$\nu_{t} + c \\, u_{x}\n+ \\left(\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\\right) u_{xx}\n+ \\left(- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\\right) u_{xxx}\n+ \\text{higher-order terms} = 0.\n$$\n引入库朗-弗里德里希斯-列维（CFL）数 $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$，并注意到 $\\Delta t = \\dfrac{C \\, \\Delta x}{c}$ 和 $\\Delta t^{2} = \\dfrac{C^{2} \\, \\Delta x^{2}}{c^{2}}$。于是系数简化为\n$$\n\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\n= \\frac{c}{2} \\left(c \\, \\Delta t - \\Delta x\\right)\n= \\frac{c}{2} \\left(\\Delta x \\, C - \\Delta x\\right)\n= \\frac{c \\, \\Delta x}{2} (C - 1),\n$$\n以及\n$$\n- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\n= - \\frac{c}{6} \\left(\\frac{C^{2} \\, \\Delta x^{2}}{c^{2}}\\right) c^{2} + \\frac{c \\, \\Delta x^{2}}{6}\n= \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}).\n$$\n因此，当 $C$ 被视为 $\\mathcal{O}(1)$ 阶时，精确到 $\\mathcal{O}(\\Delta x^{2})$ 阶项的修正方程为\n$$\nu_{t} + c \\, u_{x}\n+ \\frac{c \\, \\Delta x}{2} (C - 1) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}) \\, u_{xxx}\n= 0,\n$$\n我们可以将其等价地写为\n$$\nu_{t} + c \\, u_{x}\n= \\frac{c \\, \\Delta x}{2} (1 - C) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (C^{2} - 1) \\, u_{xxx}\n+ \\text{higher-order terms}.\n$$\n与典范形式 $u_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms}$ 相比较，我们确定有效扩散系数为\n$$\n\\nu_{\\text{eff}} = \\frac{c \\, \\Delta x}{2} (1 - C).\n$$\n对于 $0  C \\leq 1$，该系数是非负的，这反映了一阶迎风格式的保单调性和扩散特性，该特性在大气和海洋模型中被广泛用于控制示踪物平流中的虚假振荡。",
            "answer": "$$\\boxed{\\frac{c\\,\\Delta x}{2}\\,(1-C)}$$"
        },
        {
            "introduction": "在理论分析的基础上，没有什么比亲眼观察数值误差的实际影响更具启发性了。本练习是一个计算实验，你将编写程序模拟一个高斯脉冲在周期性区域内的平流过程 。通过对比一个以数值扩散为主的格式（一阶迎风）和一个以数值频散为主的格式（Lax-Wendroff），并定量计算解的方差衰减和相位漂移，你将获得关于这两种数值误差如何具体表现的直观和量化认识。",
            "id": "3803225",
            "problem": "考虑一个被动示踪剂的一维线性平流，该过程由偏微分方程 $c_t + u c_x = 0$ 控制，定义在一个长度为 $L$、速度 $u$ 恒定的周期性域上。在没有物理扩散的情况下，精确解会输运任何初始条件 $c(x,0)$，而不会改变其形状、总质量或空间方差。然而，离散数值格式会引入数值误差，这些误差可以分解为两种效应：数值扩散（减少示踪剂波动方差的振幅衰减）和数值频散（不一定改变振幅但会移动或扭曲特征的相位误差）。您的任务是使用两种标准显式格式，对一个高斯脉冲在一个完整的平流周期 $T = L/u$ 内的这两种效应进行量化。\n\n实现一个程序，该程序：\n- 在一个包含 $N$ 个点、网格间距为 $\\Delta x = L/N$ 的均匀周期性网格上表示解，时间步长 $\\Delta t$ 根据指定的库朗–弗里德里希斯–列维数 (Courant–Friedrichs–Lewy number, CFL) $\\mathrm{C} = u \\Delta t / \\Delta x$ 选取。\n- 将示踪剂初始化为在 $[0,L)$ 上以 $x_0$ 为中心、标准差为 $\\sigma$ 的高斯脉冲：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right),\n$$\n其中 $d(x;x_0)$ 是圆环 $[0,L)$ 上 $x$ 和 $x_0$ 之间的最小周期距离，因此 $d \\in \\left[-\\frac{L}{2},\\frac{L}{2}\\right]$。\n- 使用以下守恒的、周期性的有限差分更新规则之一，将示踪剂演化一个完整的周期 $T = L/u$（空间用索引 $i \\in \\{0,\\dots,N-1\\}$ 离散，时间层为 $n$）：\n    1. 一阶迎风格式（对于 $u \\ge 0$）：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\,\\left(c_i^n - c_{i-1}^n\\right),\n    $$\n    使用周期性索引 $c_{-1}^n \\equiv c_{N-1}^n$。\n    2. Lax–Wendroff 格式（二阶）：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right),\n    $$\n    使用周期性索引。\n- 确保时间步数 $n_T$ 精确满足 $n_T \\Delta t = T$。对于下方的测试套件，通过选择 $\\mathrm{C}$ 使得 $T/\\Delta t = N/\\mathrm{C}$ 为整数来保证这一点。\n- 通过在 $t=0$ 和 $t=T$ 之间零均值示踪剂场的离散空间方差的衰减来量化数值扩散。将时间 $t^n$ 的离散均值和方差定义为\n$$\n\\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2.\n$$\n报告比率\n$$\nR_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}},\n$$\n如果存在数值扩散，该比率应小于 $1$；对于完全无扩散的演化，该比率等于 $1$。\n- 通过零均值示踪剂场的主导大尺度傅里叶模态在一个周期内的残余相移来量化数值频散。令 $\\widehat{C}_1^n$ 表示在时间 $t^n$、波数为 $k_1 = 2\\pi/L$（$k=1$ 模态）时零均值场的离散傅里葉系数，通过离散傅里叶变换约定计算\n$$\n\\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right).\n$$\n一个周期后的精确连续解对于任何整数空间傅里叶模态都没有净相位变化。因此，$k=1$ 模态的任何非零相位变化都纯粹是数值造成的。定义包裹相位差\n$$\n\\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right),\n$$\n其中 $\\mathrm{wrap}(\\theta)$ 将角度映射到 $(-\\pi,\\pi]$。通过以下公式将此相位差转换为以米为单位的等效空间相移\n$$\n\\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi,\n$$\n这是主导模态在一个周期后的残余空间位移。报告以米为单位的 $\\Delta x_{\\mathrm{phase}}$。\n\n您的程序必须为每个测试用例计算列表 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$，并将所有测试用例的结果汇总成一个单行打印到标准输出，该单行为一个方括号括起来的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个包含两个浮点数的列表。不应打印任何其他文本。\n\n所有物理量必须使用指定的单位处理：$L$ 的单位为米（$\\mathrm{m}$），$u$ 的单位为米每秒（$\\mathrm{m/s}$），$T$ 的单位为秒（$\\mathrm{s}$），$\\Delta x_{\\mathrm{phase}}$ 的单位为米（$\\mathrm{m}$）。用于相位计算的内部角度必须使用弧度。\n\n测试套件：\n实现下面的四种情况。对于每种情况，运行一个完整的周期并报告 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n- 情况 A（一阶迎风格式，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 情况 B（Lax–Wendroff 格式，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 情况 C（一阶迎风格式，极限 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 200$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 1.0$，$\\sigma = 0.08\\,L$，$x_0 = 0.4\\,L$。\n- 情况 D（Lax–Wendroff 格式，窄脉冲）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.01\\,L$，$x_0 = 0.25\\,L$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个有四个元素的列表，每个元素是按 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$ 顺序排列的两个浮点数的列表，分别对应情况 A、B、C 和 D。例如：\n$[$$[r_A,\\;s_A],\\;[r_B,\\;s_B],\\;[r_C,\\;s_C],\\;[r_D,\\;s_D]$$]$，\n其中每个 $r_\\cdot$ 和 $s_\\cdot$ 是一个浮点数。输出中不要包含单位；所有距离都隐式地以米为单位，所有比率都是无量纲的。",
            "solution": "该问题要求对用于求解一维线性平流方程 $c_t + u c_x = 0$ 的两种有限差分格式的数值扩散和数值频散进行量化。该方程描述了被动示踪剂浓度 $c(x,t)$ 在长度为 $L$ 的一维周期性域上以恒定速度 $u$ 的输运过程。精确解会将初始示踪剂廓线 $c(x,0)$ 平移，而形状、振幅或方差均不发生改变。然而，数值格式会引入误差，这些误差表现为数值扩散（振幅的衰减）和数值频散（导致形状扭曲的相位误差）。任务是在一个完整的平流周期 $T = L/u$ 之后，计算高斯初始条件下的这些误差。\n\n解决方案首先通过离散化控制方程、实现指定的数值格式，然后将明确定义的度量标准应用于模拟的初始和最终状态来展开。\n\n**1. 离散化与模拟设置**\n\n连续域 $[0, L)$ 被离散化为一个包含 $N$ 个点的均匀网格，由 $i = 0, \\dots, N-1$ 索引。网格点位于 $x_i = i \\Delta x$，其中网格间距为 $\\Delta x = L/N$。时间被离散化为大小为 $\\Delta t$ 的步长。空间和时间离散化之间的关系由库朗-弗里德里希斯-列维（CFL）数控制，定义为 $\\mathrm{C} = u \\Delta t / \\Delta x$。为保证所用显式格式的稳定性，该数值必须受到限制。\n\n模拟运行的总时长为 $T = L/u$，这对应于一个特征在周期性域上精确平流一圈所需的时间。总时间步数 $n_T$ 的选择应使 $n_T \\Delta t = T$。通过代入 $T$、$\\Delta t$ 和 $\\mathrm{C}$ 的定义，我们得到 $n_T = \\frac{L/u}{( \\mathrm{C} \\Delta x / u)} = \\frac{L}{\\mathrm{C} (L/N)} = N/\\mathrm{C}$。问题保证对于所有测试用例，$N/\\mathrm{C}$ 都是整数，从而确保模拟在一个周期后精确终止。\n\n**2. 初始条件**\n\n初始示踪剂分布是一个高斯脉冲，由下式给出：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right)\n$$\n此处，$x_0$ 是脉冲的中心，$\\sigma$ 是其标准差，$d(x; x_0)$ 是任意点 $x$ 与中心 $x_0$ 之间的最小周期距离。这个距离函数能正确处理周期性域的环绕特性，并定义在区间 $[-\\frac{L}{2}, \\frac{L}{2}]$ 上。在网格 $\\{x_i\\}$ 上的离散实现中，每个 $x_i$ 到 $x_0$ 的距离计算为 $d(x_i; x_0) = (x_i - x_0) - L \\cdot \\mathrm{round}((x_i - x_0)/L)$。这确保了高斯脉冲在环形域上正确定位且对称。\n\n**3. 数值格式**\n\n离散示踪剂场 $c_i^n \\approx c(x_i, t^n)$ 的演化是使用两种显式、守恒的有限差分格式计算的。通过对空间索引使用模运算（即 $c_{i \\pm N}^n = c_i^n$）来强制实现周期性。\n\n*   **一阶迎风格式：** 对于正速度 $u \\ge 0$，该格式由下式给出：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\left(c_i^n - c_{i-1}^n\\right)\n    $$\n    该格式在空间和时间上均为一阶精度。已知在 $0 \\le \\mathrm{C} \\le 1$ 时数值稳定。其主阶截断误差项与二阶空间导数成正比，起到扩散项的作用。因此，该格式是高度耗散的，导致陡峭梯度变得模糊，振幅随时间衰减。在 $\\mathrm{C}=1$ 的特殊情况下，格式变为 $c_i^{n+1} = c_{i-1}^n$，这是一个网格上的精确平移算子。在这种情况下，离散解的输运没有任何误差。\n\n*   **Lax–Wendroff 格式：** 这是一个在空间和时间上均为二阶精度的格式：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right)\n    $$\n    Lax–Wendroff 格式在 $|\\mathrm{C}| \\le 1$ 时是稳定的。其构造旨在消除二阶截断误差项，使其扩散性显著低于迎风格式。然而，其主导误差项与三阶空间导数成正比，这会引入频散误差。这些误差导致解的不同傅里叶分量以不正确的相速度传播，从而产生伪振荡，尤其是在陡峭特征附近。\n\n在实现中，这些更新规则在每个时间步向量化地应用于整个解数组 $c^n$。像 $c_{i\\pm 1}^n$ 这样的项所需的周期性移位可以通过数组滚动操作高效处理。\n\n**4. 数值误差的量化**\n\n计算两个度量标准，以量化在一个周期 $T$ 之后的数值扩散和频散效应。\n\n*   **数值扩散度量 ($R_{\\mathrm{var}}$)：** 数值扩散会衰减示踪剂波动的振幅。通过测量解的空间方差的衰减来量化此效应。在时间层 $n$ 的示踪剂场的离散均值和方差为：\n    $$\n    \\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2\n    $$\n    扩散度量是最终时间 $t^{n_T} = T$ 的方差与初始时间 $t=0$ 的方差之比：\n    $$\n    R_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}}\n    $$\n    对于一个完美的、无扩散的格式，$R_{\\mathrm{var}} = 1$。数值扩散的存在导致 $R_{\\mathrm{var}}  1$。\n\n*   **数值频散度量 ($\\Delta x_{\\mathrm{phase}}$)：** 数值频散导致不同波长以不正确的速度传播。通过检查解的特定傅里叶模态的相位来分析这一点。我们关注能容纳于域中的最长波长的模态，其波数为 $k_1 = 2\\pi/L$。该模态的复系数通过对零均值示踪剂场 $c_j^n - \\overline{c}^n$ 进行离散傅里叶变换（DFT）得到：\n    $$\n    \\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right)\n    $$\n    对于一个周期 $T=L/u$ 后的精确解，场返回其原始状态，因此任何傅里叶系数的相位都应保持不变。任何数值相位误差都可以通过 $k=1$ 模态 $\\widehat{C}_1^n$ 的最终相位和初始相位之差来捕捉。包裹相位差计算为：\n    $$\n    \\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right)\n    $$\n    其中 $\\mathrm{wrap}(\\theta)$ 函数将角度 $\\theta$ 映射到区间 $(-\\pi, \\pi]$。相位误差 $\\Delta \\phi$ 等效于一个错误的空间位移。$\\delta x$ 的空间位移会产生 $-k_1 \\delta x = - (2\\pi/L) \\delta x$ 的相位变化。因此，等效的空间相移是：\n    $$\n    \\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi\n    $$\n    该值表示示踪剂主导大尺度特征在一个周期后的残余位移。一个非零的 $\\Delta x_{\\mathrm{phase}}$ 是格式累积频散误差的直接度量。\n\n**5. 算法实现**\n\n对于每个测试用例，算法按以下步骤进行：\n1.  初始化参数（$L$、$N$、$u$、$\\mathrm{C}$ 等）。\n2.  构建空间网格 $x_i$ 和初始高斯廓线 $c^0$。\n3.  计算初始方差 $\\mathrm{Var}^0$ 和初始相位 $\\arg(\\widehat{C}_1^0)$。\n4.  循环 $n_T = N/\\mathrm{C}$ 个时间步，在每一步应用所选的数值格式（迎风或 Lax-Wendroff）来更新解向量。\n5.  循环结束后，计算最终方差 $\\mathrm{Var}^{n_T}$ 和最终相位 $\\arg(\\widehat{C}_1^{n_T})$。\n6.  使用上述公式计算度量 $R_{\\mathrm{var}}$ 和 $\\Delta x_{\\mathrm{phase}}$。\n7.  存储结果对 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n对所有四个测试用例重复此过程，并将结果汇总成一个最终列表以供输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the 1D advection problem.\n    \"\"\"\n\n    def solve_case(scheme, L, N, u, C, sigma_rel, x0_rel):\n        \"\"\"\n        Solves a single case of the 1D advection problem.\n\n        Args:\n            scheme (str): 'upwind' or 'lax-wendroff'.\n            L (float): Domain length in meters.\n            N (int): Number of grid points.\n            u (float): Advection velocity in m/s.\n            C (float): Courant number.\n            sigma_rel (float): Standard deviation as a fraction of L.\n            x0_rel (float): Initial pulse center as a fraction of L.\n\n        Returns:\n            list: A list containing [R_var, delta_x_phase].\n        \"\"\"\n        # 1. Setup simulation parameters\n        dx = L / N\n        T = L / u\n        n_T = int(round(N / C))\n        # dt = T / n_T # Equivalent to C * dx / u\n\n        sigma = sigma_rel * L\n        x0 = x0_rel * L\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # 2. Set Initial Condition (Periodic Gaussian)\n        dist_x = x - x0\n        # Minimal periodic distance on the torus [0, L)\n        d = dist_x - L * np.round(dist_x / L)\n        c0 = np.exp(-(d**2) / (2 * sigma**2))\n\n        # 3. Analyze Initial State\n        var0 = np.var(c0)\n        c0_zm = c0 - np.mean(c0)\n        C_hat_0 = np.fft.fft(c0_zm)\n        # Phase of the k=1 mode\n        phi0 = np.angle(C_hat_0[1])\n\n        # 4. Time Evolution Loop\n        c_current = c0.copy()\n        if scheme == 'upwind':\n            for _ in range(n_T):\n                c_current = (1 - C) * c_current + C * np.roll(c_current, 1)\n        elif scheme == 'lax-wendroff':\n            for _ in range(n_T):\n                c_ip1 = np.roll(c_current, -1)\n                c_im1 = np.roll(c_current, 1)\n                term1 = -0.5 * C * (c_ip1 - c_im1)\n                term2 = 0.5 * C**2 * (c_ip1 - 2 * c_current + c_im1)\n                c_current = c_current + term1 + term2\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        c_final = c_current\n\n        # 5. Analyze Final State\n        var_final = np.var(c_final)\n        c_final_zm = c_final - np.mean(c_final)\n        C_hat_nT = np.fft.fft(c_final_zm)\n        # Phase of the k=1 mode\n        phi_nT = np.angle(C_hat_nT[1])\n\n        # 6. Calculate Metrics\n        # Numerical Diffusion: Variance Ratio\n        R_var = var_final / var0 if var0 > 0 else 1.0\n\n        # Numerical Dispersion: Phase Shift\n        \n        # Wrap angle to (-pi, pi]\n        def wrap_angle(angle):\n            return (angle + np.pi) % (2 * np.pi) - np.pi\n\n        delta_phi_raw = phi_nT - phi0\n        delta_phi = wrap_angle(delta_phi_raw)\n\n        delta_x_phase = -L * delta_phi / (2 * np.pi)\n\n        return [R_var, delta_x_phase]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: first-order upwind, moderate C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case B: Lax-Wendroff, moderate C\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case C: first-order upwind, limiting C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 200, 'u': 1.0, 'C': 1.0, 'sigma_rel': 0.08, 'x0_rel': 0.4},\n        # Case D: Lax-Wendroff, narrow pulse\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.01, 'x0_rel': 0.25},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(**case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理解并观察到数值误差后，下一步是学习如何主动控制它们。本练习将带你进入高分辨率通量限制器（flux limiter）方案的领域，这是一种在现代计算流体动力学中广泛应用的先进技术 。这类方案通过一个依赖于局部解的光滑度的“限制器函数” $ \\phi(r) $，自适应地调整数值耗散，从而在光滑区域保持高精度，同时在激波或陡峭梯度附近抑制伪振荡。通过推导和计算，你将分析不同的限制器（如 van Leer 和 Superbee）如何调节有效数值黏性，从而深入理解设计精确且鲁棒的现代平流格式的核心思想。",
            "id": "3803246",
            "problem": "考虑由守恒律 $u_t + a u_x = 0$ 控制的、具有恒定正速度 $a$ 的被动示踪剂的一维线性平流问题，其中 $u(x,t)$ 是示踪剂浓度。在间距为 $\\,\\Delta x\\,$ 的均匀网格上使用有限体积法，并采用时间步长为 $\\,\\Delta t\\,$ 的前向欧拉时间步进。对于 $a>0$ 的情况，采用一种守恒律单调上游中心格式（Monotonic Upstream-centered Schemes for Conservation Laws, MUSCL）的通量限制重构，该方法应是总变差递减（Total Variation Diminishing, TVD）的、相容的且单调的。局部光滑度指示器是上游梯度比，定义为 $\\,r = \\dfrac{u_i - u_{i-1}}{u_{i-1} - u_{i-2}}\\,$。限制器函数 $\\,\\phi(r)\\,$ 必须满足 TVD 约束和与光滑解的相容性。\n\n从有限体积更新和上述定义出发，进行修正方程分析，该分析在 $\\,\\Delta x\\,$ 和 $\\,\\Delta t\\,$ 的最低非零阶上保持一致，以获得形如下式的等效偏微分方程\n$$\nu_t + a u_x = \\nu_{\\mathrm{eff}}(r)\\,u_{xx} + \\text{更高阶项},\n$$\n其中 $\\,\\nu_{\\mathrm{eff}}(r)\\,$ 是有效数值粘性（扩散系数），以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位，它取决于局部梯度比 $\\,r\\,$、库朗数 $\\,\\nu = \\dfrac{a\\,\\Delta t}{\\Delta x}\\,$ 以及特定的通量限制器 $\\,\\phi(r)\\,$。您必须：\n\n1. 直接根据 TVD 和相容性原理推导 van Leer 限制器和 Superbee 限制器的 $\\,\\phi(r)\\,$，而不引用问题陈述中任何预先给定的公式。清楚地论证为什么每个得到的 $\\,\\phi(r)\\,$ 在 $\\,r\\ge 0\\,$ 时满足 TVD 约束，并在 $\\,r \\le 0\\,$ 时强制保持单调性。\n\n2. 使用 $a>0$ 的 MUSCL 通量限制更新，推导 $\\,\\nu_{\\mathrm{eff}}(r)\\,$ 至 $\\,\\Delta x\\,$ 和 $\\,\\Delta t\\,$ 的最低阶。您的推導必须从离散更新方程开始，并使用空间和时间的泰勒展开来获得修正方程，将 $\\,\\nu_{\\mathrm{eff}}(r)\\,$ 明确表示为 $\\,a\\,$、$\\,\\Delta x\\,$、$\\,\\nu\\,$ 和 $\\,\\phi(r)\\,$ 的函数。\n\n3. 实现一个完整、可运行的程序，该程序：\n   - 为下面列出的每个测试用例计算 van Leer 限制器和 Superbee 限制器的 $\\,\\nu_{\\mathrm{eff}}(r)\\,$。\n   - 将所有 $\\,\\nu_{\\mathrm{eff}}(r)\\,$ 的输出表示为浮点数，单位为 $\\mathrm{m}^2/\\mathrm{s}$，并四舍五入到六位小数。\n   - 生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是 $[\\nu_{\\mathrm{eff}}^{\\text{vanLeer}},\\nu_{\\mathrm{eff}}^{\\text{Superbee}}]$ 顺序的双元素列表，因此总输出形式为 $[[\\cdot,\\cdot],[\\cdot,\\cdot],\\ldots]$。\n\n使用以下科学上合理且自洽的测试套件，其涵盖了不同的光滑度区域（例如，$r \\le 0$、 $0  r  1$、$r=1$ 和 $r > 1$）：\n- 测试用例 1：$r=-0.5, \\nu=0.2$\n- 测试用例 2：$r=0.0, \\nu=0.6$\n- 测试用例 3：$r=0.1, \\nu=0.6$\n- 测试用例 4：$r=1.0, \\nu=0.6$\n- 测试用例 5：$r=2.0, \\nu=0.6$\n- 测试用例 6：$r=5.0, \\nu=0.95$\n- 测试用例 7：$r=100.0, \\nu=0.2$",
            "solution": "此问题经评估为有效。它在计算流体动力学原理方面具有科学依据，问题陈述清晰、目标明确、信息充分，并使用了精确、客观的语言。其推导和实现是分析守恒律数值方法的标准但非平凡的练习。\n\n按照要求，解答分为三个部分：通量限制器函数的推导、有效数值粘性的推导，最后是数值计算的实现。\n\n### 第一部分：通量限制器函数 $\\phi(r)$ 的推导\n\n如果离散解的总变差不随时间增加，则该守恒律的数值格式是总变差递減（Total Variation Diminishing, TVD）的。对于采用通量限制器 $\\phi(r)$ 的守恒律单调上游中心格式（MUSCL）和显式欧拉时间步进，格式成为 TVD 的充分条件可以在 Sweby 图中可视化。对于上游梯度比 $r \\ge 0$，限制器函数 $\\phi(r)$ 必须位于由以下条件定义的 TVD 区域内：\n$$\n0 \\le \\phi(r) \\le 2 \\quad \\text{and} \\quad \\phi(r) \\le 2r\n$$\n为保证单调性（防止出现新的极值），格式在极值点必须退化为一阶迎风格式，这对应于对所有 $r \\le 0$ 设置 $\\phi(r) = 0$。\n\n为了在梯度被网格解析的光滑解区域（即 $r \\approx 1$）与二阶精度相容，限制器必须满足 $\\phi(1) = 1$。\n\n**Van Leer 限制器**\n\nvan Leer 限制器被设计为一个满足 TVD 约束的光滑函数。它通过点 $(0,0)$ 和 $(1,1)$，并且在处理梯度 $\\Delta u_1 = u_i - u_{i-1}$ 和 $\\Delta u_2 = u_{i-1} - u_{i-2}$ 时是对称的。比率是 $r = \\Delta u_1 / \\Delta u_2$。调和平均数是平均两个量的一种常用方法，它给予较小的值更大的权重，这是限制器所期望的特性。基于此推理的一个对称公式是：\n$$\n\\phi(r) \\propto \\frac{2r}{1+r}\n$$\nvan Leer 限制器具体定义为：\n$$\n\\phi_{\\text{vL}}(r) = \\frac{r + |r|}{1 + |r|}\n$$\n让我们验证这是否满足所需属性。\n1.  **单调性 ($r \\le 0$)**：如果 $r \\le 0$，则 $|r| = -r$。分子变为 $r + (-r) = 0$。因此，对所有 $r \\le 0$，$\\phi_{\\text{vL}}(r) = 0$。这确保了格式在局部极值或振荡处退化为一阶迎风格式，防止产生新的极值。\n2.  **TVD 约束 ($r > 0$)**：如果 $r > 0$，则 $|r| = r$。函数变为 $\\phi_{\\text{vL}}(r) = \\frac{r+r}{1+r} = \\frac{2r}{1+r}$。\n    -   因为 $r > 0$，显然 $\\phi_{\\text{vL}}(r) = \\frac{2r}{1+r} > 0$。\n    -   我们检查 $\\phi(r) \\le 2$：$\\frac{2r}{1+r} \\le 2 \\implies 2r \\le 2(1+r) \\implies 2r \\le 2+2r \\implies 0 \\le 2$，这总是成立的。\n    -   我们检查 $\\phi(r) \\le 2r$：$\\frac{2r}{1+r} \\le 2r$。因为 $r>0$，我们可以除以 $2r$ 得到 $\\frac{1}{1+r} \\le 1 \\implies 1 \\le 1+r \\implies 0 \\le r$，这对 $r>0$ 成立。\n3.  **相容性**：对于 $r=1$，$\\phi_{\\text{vL}}(1) = \\frac{2(1)}{1+1} = 1$。满足相容性条件。\n\n从这些原理出发的推导确立了 van Leer 限制器函数。\n\n**Superbee 限制器**\n\nSuperbee 限制器被设计为在保持 TVD 的前提下尽可能具有压缩性。这意味着它应位于由 $\\phi(r) = 2$ 和 $\\phi(r) = 2r$ 定义的 TVD 区域的上边界上。\n\n1.  **单调性 ($r \\le 0$)**：与任何 TVD 限制器一样，我们对 $r \\le 0$ 设置 $\\phi_{\\text{SB}}(r) = 0$。\n2.  **TVD 约束与构造 ($r>0$)**：我们追踪 Sweby 图的上边界。\n    -   对于小的 $r$，最紧的约束是 $\\phi(r) \\le 2r$。上边界是 $\\phi(r) = 2r$。\n    -   对于较大的 $r$，约束 $\\phi(r) \\le 2$ 变为活动的。\n    -   来自 Lax-Wendroff 格式（$\\phi(r)=r$）的线也与某些限制器相关，但 Superbee 更具侵略性。它使用从原点 $(0,0)$ 到 $(1,2)$ 的线段，即 $\\phi=2r$，该线段在 $r=1/2$ 处与水平线 $\\phi=1$ 相交。一个流行的对称限制器 MINMOD 使用 $\\phi(r)=\\min(1,r)$。Superbee 的目标是通过取应用于 $(r,r)$ 和移动后的 $(r,r)$ 的 MINMOD 的最大值来获得更强的压缩性。一种直接的构造方法是取最紧凑的可能边界。\n    -   边界由以下线段组成：\n        -   从 $r=0$ 到 $r=1/2$，边界是 $\\phi=2r$。\n        -   从 $r=1/2$ 到 $r=1$，边界是 $\\phi=1$。（这是某种特定常见构造的产物，真正的上界是混合的）。\n        -   让我们使用形成 TVD 区域上包络的标准定义：选择是在线 $\\phi=r$ 和 $\\phi=2r$ 之间，并由 $\\phi=1$ 和 $\\phi=2$ 封顶。最具压缩性的选择是取上界。\n        -   让我们根据边界约束 $0 \\le \\phi(r) \\le \\min(2, 2r)$ 来逐段构造它。众所周知，为了得到二阶格式，点 $(1,1)$很重要。当 $r>1$ 时，线 $\\phi=r$ 也是某些 TVD 区域边界的一部分。Superbee 限制器描绘了由 $\\max(0, \\min(2r, 1), \\min(r, 2))$ 给出的区域的上边界。\n        -   对于 $0  r \\le 1/2$：$\\min(2r, 1) = 2r$，$\\min(r, 2) = r$。$\\max(0, 2r, r) = 2r$。这位于 $\\phi=2r$ 边界上。\n        -   对于 $1/2  r \\le 1$：$\\min(2r, 1) = 1$，$\\min(r, 2) = r$。$\\max(0, 1, r) = 1$。这位于 $\\phi=1$ 线上。\n        -   对于 $1  r \\le 2$：$\\min(2r, 1) = 1$，$\\min(r, 2) = r$。$\\max(0, 1, r) = r$。这位于 $\\phi=r$ 线上。\n        -   对于 $r > 2$：$\\min(2r, 1) = 1$，$\\min(r, 2) = 2$。$\\max(0, 1, 2) = 2$。这位于 $\\phi=2$ 边界上。\n    -   所有这些段都位于 TVD 区域内（$ \\phi \\le 2 $ 和 $ \\phi \\le 2r $ 在任何地方都得到满足）。\n3.  **相容性**：对于 $r=1$，定义给出 $\\phi_{\\text{SB}}(1)=1$。满足相容性条件。\n\n因此，Superbee 限制器由以下分段函数给出：\n$$\n\\phi_{\\text{SB}}(r) =\n\\begin{cases}\n    0        \\text{if } r \\le 0 \\\\\n    2r       \\text{if } 0  r \\le 1/2 \\\\\n    1        \\text{if } 1/2  r \\le 1 \\\\\n    r        \\text{if } 1  r \\le 2 \\\\\n    2        \\text{if } r > 2\n\\end{cases}\n$$\n这对应于紧凑表达式 $\\phi_{\\text{SB}}(r) = \\max(0, \\min(2r, 1), \\min(r, 2))$。\n\n### 第二部分：有效数值粘性 $\\nu_{\\mathrm{eff}}(r)$ 的推导\n\n我们从网格单元 $i$ 的有限体积更新开始：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\n问题描述了一个针对 $a>0$ 的迎风偏置 MUSCL 格式。这种格式的一种常见形式是向一阶迎风格式添加一个受限的反扩散通量，其更新方程由下式给出：\n$$\nu_i^{n+1} = u_i^n - \\nu(u_i^n - u_{i-1}^n) - \\frac{1}{2}\\nu(1-\\nu) \\left[ \\phi(r_i)(u_i^n-u_{i-1}^n) - \\phi(r_{i-1})(u_{i-1}^n-u_{i-2}^n) \\right]\n$$\n其中 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 是库朗数， $r_i = \\frac{u_i - u_{i-1}}{u_{i-1} - u_{i-2}}$ 是网格单元 $i$ 处的上游梯度比。\n\n为了找到修正方程，我们围绕点 $(x_i, t_n)$ 对每一项进行泰勒级数展开，假设解 $u$ 是光滑的。让 $u(x_i, t_n)$ 简记为 $u$。\n左侧是：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = u_t + \\frac{\\Delta t}{2} u_{tt} + O((\\Delta t)^2)\n$$\n对于右侧，我们在 $x_i$ 周围展开空间项：\n$$\nu_{i-1} = u - \\Delta x u_x + \\frac{(\\Delta x)^2}{2} u_{xx} - \\frac{(\\Delta x)^3}{6} u_{xxx} + O((\\Delta x)^4)\n$$\n右侧第一项是一阶迎风通量散度：\n$$\n-\\frac{a}{\\Delta x}(u_i - u_{i-1}) = -\\frac{a}{\\Delta x} \\left( \\Delta x u_x - \\frac{(\\Delta x)^2}{2} u_{xx} + \\frac{(\\Delta x)^3}{6} u_{xxx} + \\dots \\right) = -a u_x + \\frac{a \\Delta x}{2} u_{xx} - \\frac{a (\\Delta x)^2}{6} u_{xxx} + \\dots\n$$\n右侧第二项是高分辨率修正项，我们记为 $C$：\n$$\nC = - \\frac{a(1-\\nu)}{2\\Delta x} \\left[ \\phi(r_i)(u_i-u_{i-1}) - \\phi(r_{i-1})(u_{i-1}-u_{i-2}) \\right]\n$$\n设 $G_i = \\phi(r_i)(u_i-u_{i-1})$。方括号中的项是 $G_i - G_{i-1}$。这是量 $G$ 的有限差分。我们可以近似为：\n$$\nG_i - G_{i-1} \\approx \\Delta x \\frac{\\partial G}{\\partial x}\\bigg|_{i-1/2}\n$$\n量 $G(x)$ 是 $G(x) = \\phi(r(x))(u(x) - u(x-\\Delta x))$。展开 $u(x-\\Delta x)$ 得到：\n$$\nG(x) = \\phi(r(x)) \\left( \\Delta x u_x - \\frac{(\\Delta x)^2}{2} u_{xx} + \\dots \\right)\n$$\n在 $\\Delta x$ 的最低阶上，$G(x) \\approx \\phi(r(x)) \\Delta x u_x$。那么，\n$$\nG_i - G_{i-1} \\approx \\Delta x \\frac{\\partial}{\\partial x} (\\phi(r) \\Delta x u_x) \\bigg|_{i-1/2} \\approx (\\Delta x)^2 \\frac{\\partial}{\\partial x} (\\phi(r) u_x) \\bigg|_{i} \\approx (\\Delta x)^2 \\phi(r) u_{xx}\n$$\n这里我们将 $\\phi(r)$ 视为局部常数系数，因为它的空间变化会引入更高阶的项。\n将此代入 $C$ 的表达式：\n$$\nC \\approx - \\frac{a(1-\\nu)}{2\\Delta x} \\left[ (\\Delta x)^2 \\phi(r) u_{xx} \\right] = - \\frac{a \\Delta x (1-\\nu)}{2} \\phi(r) u_{xx}\n$$\n现在，整合完整的方程：\n$$\nu_t + \\frac{\\Delta t}{2} u_{tt} + \\dots = \\left( -a u_x + \\frac{a \\Delta x}{2} u_{xx} + \\dots \\right) + \\left( - \\frac{a \\Delta x (1-\\nu)}{2} \\phi(r) u_{xx} + \\dots \\right)\n$$\n为了消除 $u_{tt}$ 项，我们对最低阶方程 $u_t + a u_x = 0$ 对时间求导：$u_{tt} + a u_{xt} = 0$。同样，对空间求导得到 $u_{tx} + a u_{xx} = 0$。假设解是光滑的（$u_{xt}=u_{tx}$），我们得到 $u_{tt} = a^2 u_{xx}$。\n将此代入我们的展开方程中：\n$$\nu_t + \\frac{\\Delta t}{2} a^2 u_{xx} = -a u_x + \\frac{a \\Delta x}{2} u_{xx} - \\frac{a \\Delta x (1-\\nu)}{2} \\phi(r) u_{xx} + O((\\Delta x)^2, \\Delta t \\Delta x)\n$$\n重新整理以匹配目标形式 $u_t + a u_x = \\nu_{\\mathrm{eff}} u_{xx} + \\dots$：\n$$\nu_t + a u_x = \\left[ \\frac{a \\Delta x}{2} - \\frac{a^2 \\Delta t}{2} - \\frac{a \\Delta x (1-\\nu)}{2} \\phi(r) \\right] u_{xx}\n$$\n我们可以通过代入 $\\nu = a \\Delta t / \\Delta x$ 来简化系数：\n$$\n\\nu_{\\mathrm{eff}}(r) = \\frac{a \\Delta x}{2} \\left[ 1 - \\frac{a \\Delta t}{\\Delta x} - (1-\\nu) \\phi(r) \\right]\n$$\n$$\n\\nu_{\\mathrm{eff}}(r) = \\frac{a \\Delta x}{2} \\left[ 1 - \\nu - (1-\\nu) \\phi(r) \\right]\n$$\n$$\n\\nu_{\\mathrm{eff}}(r) = \\frac{a \\Delta x}{2} (1 - \\nu) [1 - \\phi(r)]\n$$\n这是有效数值粘性的最低阶表达式。单位是 $(\\mathrm{m}/\\mathrm{s}) \\cdot \\mathrm{m} = \\mathrm{m}^2/\\mathrm{s}$，符合扩散系数的要求。\n- 对于一阶迎风格式，$\\phi(r)=0$，得到 $\\nu_{\\text{eff}} = \\frac{a \\Delta x}{2}(1-\\nu)$，这是已知的结果。\n- 对于光滑区域的二阶格式，$\\phi(r)=1$，得到 $\\nu_{\\text{eff}}=0$，这正确地表明最低阶误差不是耗散性的（$u_{xx}$），而是色散性的（$u_{xxx}$）。\n- 对于压缩性限制器，其中 $\\phi(r)>1$，$\\nu_{\\text{eff}}$ 变为负值，表明存在锐化梯度的反扩散行为。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the effective numerical viscosity for the van Leer and Superbee\n    limiters for a series of test cases.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    a = 1.0  # Advection velocity in m/s\n    dx = 100.0  # Grid spacing in m\n\n    # --- Test Cases: (r, nu) pairs ---\n    test_cases = [\n        (-0.5, 0.2),\n        (0.0, 0.6),\n        (0.1, 0.6),\n        (1.0, 0.6),\n        (2.0, 0.6),\n        (5.0, 0.95),\n        (100.0, 0.2),\n    ]\n\n    # --- Limiter Functions ---\n    def phi_van_leer(r):\n        \"\"\"\n        Calculates the van Leer limiter function phi(r).\n        phi(r) = (r + |r|) / (1 + |r|)\n        This form is numerically robust and equivalent to max(0, 2*r / (1+r)).\n        \"\"\"\n        # The denominator 1 + |r| is always >= 1, so no division by zero.\n        return (r + np.abs(r)) / (1 + np.abs(r))\n\n    def phi_superbee(r):\n        \"\"\"\n        Calculates the Superbee limiter function phi(r).\n        phi(r) = max(0, min(2r, 1), min(r, 2))\n        \"\"\"\n        if r = 0:\n            return 0.0\n        # The formulation below is a direct implementation of the piecewise definition\n        # derived from max(0, min(2*r, 1), min(r, 2))\n        if 0  r = 0.5:\n            return 2 * r\n        elif 0.5  r = 1.0:\n            return 1.0\n        elif 1.0  r = 2.0:\n            return r\n        else: # r > 2.0\n            return 2.0\n\n    # --- Main Calculation ---\n    results = []\n    for r, nu in test_cases:\n        # Calculate phi for both limiters\n        phi_vl = phi_van_leer(r)\n        phi_sb = phi_superbee(r)\n\n        # Calculate the derived effective numerical viscosity\n        # nu_eff = (a * dx / 2) * (1 - nu) * (1 - phi)\n        prefactor = (a * dx / 2.0) * (1.0 - nu)\n        \n        nu_eff_vl = prefactor * (1.0 - phi_vl)\n        nu_eff_sb = prefactor * (1.0 - phi_sb)\n\n        # Append rounded results for the current test case\n        results.append([round(nu_eff_vl, 6), round(nu_eff_sb, 6)])\n\n    # --- Format and Print Output ---\n    # The output must be a single line of a list of lists, e.g., [[v1,s1],[v2,s2],...]\n    # We convert each inner list to a string representation '[v,s]'\n    # then join these strings with commas, and enclose the whole thing in brackets.\n    result_strings = [f\"[{val1},{val2}]\" for val1, val2 in results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}