{
    "hands_on_practices": [
        {
            "introduction": "数值格式是对偏微分方程的近似，但这种近似并非完美。修正方程（modified equation）是理解近似误差性质的强大分析工具。本练习将引导你推导一阶迎风格式的修正方程，通过这种分析，你将揭示出数值格式为原始平流方程引入的一个“有效”扩散项，从而为该格式的耗散行为提供明确的数学解释()。",
            "id": "4069602",
            "problem": "考虑常系数线性平流方程，它是数值天气预报和气候模拟中示踪物输运的一个标准构建模块，\n$$\nu_{t} + c \\, u_{x} = 0,\n$$\n其中波速 $c>0$ 为常数。在一个空间间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀空间网格上，用 $u_{i}^{n} \\approx u(x_{i}, t_{n})$ 来近似 $u(x,t)$，并使用显式一阶迎风格式（时间上向前欧拉，对于 $c>0$ 空间上迎风）在时间上推进：\n$$\nu_{i}^{n+1} = u_{i}^{n} - C \\left(u_{i}^{n} - u_{i-1}^{n}\\right),\n$$\n其中 Courant–Friedrichs–Lewy (CFL) 数为 $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$。假设 $u$ 足够光滑，且 $C$ 位于稳定范围 $0  C \\leq 1$ 内，这在大气动力核心的业务平流计算中是典型情况。\n\n使用关于 $(x_{i}, t_{n})$ 的泰勒级数和控制偏微分方程来消去时间导数，代之以空间导数，推导出修正方程。该修正方程的左侧与连续平流算子匹配，其右侧捕捉了直到并包括 $\\mathcal{O}(\\Delta x^{2})$ 阶项的主截断效应。将修正方程写成典范形式\n$$\nu_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms},\n$$\n并确定有效扩散系数 $\\nu_{\\text{eff}}$ 作为 $c$、$\\Delta x$ 和 $C$ 的函数。\n\n最终答案只需提供 $\\nu_{\\text{eff}}$ 的闭式解析表达式。无需四舍五入，最终答案中不应包含任何单位。",
            "solution": "目标是推导修正方程，这是一个连续偏微分方程，其解能以指定阶数近似离散格式的数值解。我们从常系数线性平流方程开始\n$$\nu_{t} + c \\, u_{x} = 0, \\quad c>0,\n$$\n以及对于 $c>0$ 的一阶迎风格式，\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} + c \\, \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = 0,\n$$\n这在代数上等价于给定的更新公式。\n\n我们将 $u_{i}^{n}$ 解释为在 $(x_{i}, t_{n})$ 处采样的精确解，并将离散算子在 $(x_{i}, t_{n})$ 点展开为泰勒级数。对于向前时间差分，\n$$\n\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} = u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3}).\n$$\n对于向后空间差分，\n$$\n\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3}).\n$$\n将这些展开式代入离散格式，得到\n$$\n\\left[u_{t} + \\frac{\\Delta t}{2} \\, u_{tt} + \\frac{\\Delta t^{2}}{6} \\, u_{ttt} + \\mathcal{O}(\\Delta t^{3})\\right]\n+ c \\left[u_{x} - \\frac{\\Delta x}{2} \\, u_{xx} + \\frac{\\Delta x^{2}}{6} \\, u_{xxx} + \\mathcal{O}(\\Delta x^{3})\\right] = 0.\n$$\n为了用空间导数表示时间导数，我们对控制方程重复进行时间求导，并利用偏导数的交换性。从 $u_{t} + c \\, u_{x} = 0$ 可得\n$$\nu_{t} = - c \\, u_{x}, \\quad\nu_{tt} = (u_{t})_{t} = - c \\, (u_{x})_{t} = - c \\, (u_{t})_{x} = - c \\, (- c \\, u_{x})_{x} = c^{2} \\, u_{xx},\n$$\n类似地，\n$$\nu_{ttt} = (u_{tt})_{t} = \\left(c^{2} \\, u_{xx}\\right)_{t} = c^{2} \\, (u_{xx})_{t} = c^{2} \\, (u_{t})_{xx} = c^{2} \\, (- c \\, u_{x})_{xx} = - c^{3} \\, u_{xxx}.\n$$\n将这些代入展开后的格式，得到\n$$\nu_{t} + c \\, u_{x}\n+ \\left(\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\\right) u_{xx}\n+ \\left(- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\\right) u_{xxx}\n+ \\text{higher-order terms} = 0.\n$$\n引入 Courant–Friedrichs–Lewy (CFL) 数 $C = \\dfrac{c \\, \\Delta t}{\\Delta x}$，并注意到 $\\Delta t = \\dfrac{C \\, \\Delta x}{c}$ 以及 $\\Delta t^{2} = \\dfrac{C^{2} \\, \\Delta x^{2}}{c^{2}}$。那么系数可以简化为\n$$\n\\frac{\\Delta t}{2} c^{2} - \\frac{c \\, \\Delta x}{2}\n= \\frac{c}{2} \\left(c \\, \\Delta t - \\Delta x\\right)\n= \\frac{c}{2} \\left(\\Delta x \\, C - \\Delta x\\right)\n= \\frac{c \\, \\Delta x}{2} (C - 1),\n$$\n以及\n$$\n- \\frac{\\Delta t^{2}}{6} c^{3} + \\frac{c \\, \\Delta x^{2}}{6}\n= - \\frac{c}{6} \\left(\\frac{C^{2} \\, \\Delta x^{2}}{c^{2}}\\right) c^{2} + \\frac{c \\, \\Delta x^{2}}{6}\n= \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}).\n$$\n因此，当 $C$ 被视为 $\\mathcal{O}(1)$ 阶时，精确到 $\\mathcal{O}(\\Delta x^{2})$ 阶项的修正方程为\n$$\nu_{t} + c \\, u_{x}\n+ \\frac{c \\, \\Delta x}{2} (C - 1) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (1 - C^{2}) \\, u_{xxx}\n= 0,\n$$\n我们可以将其等价地写为\n$$\nu_{t} + c \\, u_{x}\n= \\frac{c \\, \\Delta x}{2} (1 - C) \\, u_{xx}\n+ \\frac{c \\, \\Delta x^{2}}{6} (C^{2} - 1) \\, u_{xxx}\n+ \\text{higher-order terms}.\n$$\n与典范形式 $u_{t} + c \\, u_{x} = \\nu_{\\text{eff}} \\, u_{xx} + \\text{higher-order terms}$ 比较，我们确定有效扩散系数为\n$$\n\\nu_{\\text{eff}} = \\frac{c \\, \\Delta x}{2} (1 - C).\n$$\n对于 $0  C \\leq 1$，该系数是非负的，这反映了一阶迎风格式的保单调性和扩散特性，这一特性在大气和海洋模型中被广泛用于控制示踪物平流中的虚假振荡。",
            "answer": "$$\\boxed{\\frac{c\\,\\Delta x}{2}\\,(1-C)}$$"
        },
        {
            "introduction": "修正方程在物理空间中揭示了误差的结构，而冯·诺依曼（von Neumann）稳定性分析则在频率域中提供了互补的视角。它告诉我们一个数值格式如何影响解的各个波分量。本练习要求推导并比较一阶迎风格式和拉克斯-弗里德里希斯（Lax-Friedrichs）格式的放大因子，从而量化它们在不同波数下的耗散特性()。这种实践有助于你理解数值耗散是波数的函数，即格式对短波的阻尼通常强于长波。",
            "id": "3803230",
            "problem": "考虑一维线性平流方程 $u_t + a\\,u_x = 0$，其中常数速度 $a>0$。该方程在间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上进行离散。定义库朗数 $\\nu = a\\,\\Delta t/\\Delta x$ 和无量纲波数 $\\theta = k\\,\\Delta x$，其中 $k$ 是傅里叶模态的物理波数。考虑两种显式一阶时间推进有限差分格式：\n- 针对 $a>0$ 的一阶迎风格式：$u_j^{n+1} = u_j^n - \\nu\\,(u_j^n - u_{j-1}^n)$。\n- Lax–Friedrichs 格式：$u_j^{n+1} = \\tfrac{1}{2}\\left(u_{j+1}^n + u_{j-1}^n\\right) - \\tfrac{\\nu}{2}\\left(u_{j+1}^n - u_{j-1}^n\\right)$。\n\n使用 von Neumann 分析，通过将傅里叶模态 $u_j^n = \\hat{u}^n \\exp(i j \\theta)$（其中 $i$ 是虚数单位，$j$ 是空间索引）代入相应的更新方程，推导每种格式的放大因子 $G(\\theta)$。根据这些因子，通过每个时间步长的振幅衰减（由 $|G(\\theta)|$ 给出）来量化它们的耗散性质。基于这些推导，并将 $\\nu$ 视为参数（$0  \\nu \\le 1$），确定一个非平凡波数 $\\theta_c \\in (0,\\pi]$（以弧度为单位），在该波数下两种格式每个时间步长的振幅衰减相等，即 $|G_{\\mathrm{up}}(\\theta_c,\\nu)| = |G_{\\mathrm{LF}}(\\theta_c,\\nu)|$，并排除在 $\\theta=0$ 处的平凡解。提供 $\\theta_c$ 作为 $\\nu$ 的函数的显式解析表达式。最终答案以弧度表示。不需要进行数值计算，也不应进行四舍五入。",
            "solution": "解答过程首先为两种格式分别推导放大因子 $G(\\theta)$ 及其模 $|G(\\theta)|$。然后，令两个模相等，以求得所需波数 $\\theta_c$。\n\n**1. 一阶迎风格式**\n\n该格式为 $u_j^{n+1} = u_j^n - \\nu(u_j^n - u_{j-1}^n)$。我们代入傅里叶模态 $u_j^n = \\hat{u}^n \\exp(i j \\theta)$：\n$$\n\\hat{u}^{n+1} \\exp(ij\\theta) = \\hat{u}^{n} \\exp(ij\\theta) - \\nu(\\hat{u}^{n} \\exp(ij\\theta) - \\hat{u}^{n} \\exp(i(j-1)\\theta))\n$$\n放大因子 $G_{\\mathrm{up}}(\\theta) = \\hat{u}^{n+1}/\\hat{u}^n$ 通过将方程两边同除以 $\\hat{u}^n \\exp(ij\\theta)$ 得到：\n$$\nG_{\\mathrm{up}}(\\theta) = 1 - \\nu(1 - \\exp(-i\\theta))\n$$\n为了求其模 $|G_{\\mathrm{up}}(\\theta)|$，我们首先使用 $\\exp(-i\\theta) = \\cos(\\theta) - i\\sin(\\theta)$ 将 $G_{\\mathrm{up}}(\\theta)$ 表示为其实部和虚部：\n$$\nG_{\\mathrm{up}}(\\theta) = 1 - \\nu(1 - (\\cos(\\theta) - i\\sin(\\theta))) = (1 - \\nu(1-\\cos(\\theta))) + i\\nu\\sin(\\theta)\n$$\n模的平方为 $|G_{\\mathrm{up}}(\\theta)|^2 = (\\mathrm{Re}(G_{\\mathrm{up}}))^2 + (\\mathrm{Im}(G_{\\mathrm{up}}))^2$：\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = (1 - \\nu(1-\\cos(\\theta)))^2 + (\\nu\\sin(\\theta))^2\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1-\\cos(\\theta))^2 + \\nu^2\\sin^2(\\theta)\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + \\cos^2(\\theta)) + \\nu^2\\sin^2(\\theta)\n$$\n使用恒等式 $\\cos^2(\\theta) + \\sin^2(\\theta) = 1$：\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + \\nu^2(1 - 2\\cos(\\theta) + 1)\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - 2\\nu(1-\\cos(\\theta)) + 2\\nu^2(1-\\cos(\\theta))\n$$\n$$\n|G_{\\mathrm{up}}(\\theta)|^2 = 1 - (2\\nu - 2\\nu^2)(1-\\cos(\\theta)) = 1 - 2\\nu(1-\\nu)(1-\\cos(\\theta))\n$$\n\n**2. Lax–Friedrichs 格式**\n\n该格式为 $u_j^{n+1} = \\frac{1}{2}(u_{j+1}^n + u_{j-1}^n) - \\frac{\\nu}{2}(u_{j+1}^n - u_{j-1}^n)$。代入傅里叶模态 $u_j^n = \\hat{u}^n \\exp(i j \\theta)$：\n$$\n\\hat{u}^{n+1} \\exp(ij\\theta) = \\frac{1}{2}(\\hat{u}^{n} \\exp(i(j+1)\\theta) + \\hat{u}^{n} \\exp(i(j-1)\\theta)) - \\frac{\\nu}{2}(\\hat{u}^{n} \\exp(i(j+1)\\theta) - \\hat{u}^{n} \\exp(i(j-1)\\theta))\n$$\n两边同除以 $\\hat{u}^n \\exp(ij\\theta)$ 得到放大因子 $G_{\\mathrm{LF}}(\\theta)$：\n$$\nG_{\\mathrm{LF}}(\\theta) = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta)) - \\frac{\\nu}{2}(\\exp(i\\theta) - \\exp(-i\\theta))\n$$\n使用欧拉恒等式 $\\cos(\\theta) = \\frac{\\exp(i\\theta) + \\exp(-i\\theta)}{2}$ 和 $\\sin(\\theta) = \\frac{\\exp(i\\theta) - \\exp(-i\\theta)}{2i}$：\n$$\nG_{\\mathrm{LF}}(\\theta) = \\cos(\\theta) - \\frac{\\nu}{2}(2i\\sin(\\theta)) = \\cos(\\theta) - i\\nu\\sin(\\theta)\n$$\n模的平方为：\n$$\n|G_{\\mathrm{LF}}(\\theta)|^2 = (\\cos(\\theta))^2 + (-\\nu\\sin(\\theta))^2 = \\cos^2(\\theta) + \\nu^2\\sin^2(\\theta)\n$$\n\n**3. 令振幅相等**\n\n条件是 $|G_{\\mathrm{up}}(\\theta_c)| = |G_{\\mathrm{LF}}(\\theta_c)|$。使用模的平方更为方便：$|G_{\\mathrm{up}}(\\theta_c)|^2 = |G_{\\mathrm{LF}}(\\theta_c)|^2$。\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = \\cos^2(\\theta_c) + \\nu^2\\sin^2(\\theta_c)\n$$\n为了求解 $\\theta_c$，我们通过代入 $\\sin^2(\\theta_c) = 1 - \\cos^2(\\theta_c)$ 将方程完全用 $\\cos(\\theta_c)$ 表示：\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = \\cos^2(\\theta_c) + \\nu^2(1 - \\cos^2(\\theta_c))\n$$\n$$\n1 - 2\\nu(1-\\nu)(1-\\cos(\\theta_c)) = (1-\\nu^2)\\cos^2(\\theta_c) + \\nu^2\n$$\n令 $C = \\cos(\\theta_c)$。方程变为：\n$$\n1 - (2\\nu-2\\nu^2)(1-C) = (1-\\nu^2)C^2 + \\nu^2\n$$\n重新整理各项，形成关于 C 的二次方程：\n$$\n(1-\\nu^2)C^2 + (2\\nu-2\\nu^2)(1-C) - 1 + \\nu^2 = 0\n$$\n$$\n(1-\\nu^2)C^2 + (2\\nu-2\\nu^2) - (2\\nu-2\\nu^2)C - 1 + \\nu^2 = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C + (2\\nu - 2\\nu^2 - 1 + \\nu^2) = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C - (1 - 2\\nu + \\nu^2) = 0\n$$\n$$\n(1-\\nu^2)C^2 - 2\\nu(1-\\nu)C - (1-\\nu)^2 = 0\n$$\n对于 $\\nu=1$ 的情况，该方程变为 $0=0$，因为当 $\\nu=1$ 时，对所有 $\\theta$ 都有 $|G_{\\mathrm{up}}|=1$ 和 $|G_{\\mathrm{LF}}|=1$，所以等式在任何情况下都平凡成立。对于 $\\nu \\in (0, 1)$，我们可以除以非零因子 $(1-\\nu)$：\n$$\n(1+\\nu)C^2 - 2\\nu C - (1-\\nu) = 0\n$$\n我们正在寻找一个非平凡解，因此我们期望 $\\theta_c \\neq 0$，这意味着 $C \\neq 1$。我们可以检查 $C=1$ 是否是这个二次方程的一个根：\n$$\n(1+\\nu)(1)^2 - 2\\nu(1) - (1-\\nu) = 1+\\nu - 2\\nu - 1 + \\nu = 0\n$$\n由于 $C=1$ 是一个根，所以 $(C-1)$ 是该多项式的一个因子。我们可以对这个二次多项式进行因式分解：\n$$\n(C-1)((1+\\nu)C + (1-\\nu)) = 0\n$$\n这给出两个根：\n1.  $C = 1$，对应于平凡解 $\\theta_c = 0$。\n2.  $(1+\\nu)C + (1-\\nu) = 0$，给出非平凡解。\n\n从第二个因子求解 $C$：\n$$\n(1+\\nu)C = -(1-\\nu) = \\nu-1\n$$\n$$\nC = \\cos(\\theta_c) = \\frac{\\nu-1}{1+\\nu}\n$$\n由于 $0  \\nu \\le 1$，分子 $\\nu-1$ 的范围是 $(-1, 0]$，分母 $1+\\nu$ 的范围是 $(1, 2]$。因此，$\\cos(\\theta_c)$ 的范围是 $(-1, 0]$。这对应于区间 $[\\pi/2, \\pi)$ 内的一个唯一角度 $\\theta_c$，该角度在指定的定义域 $(0, \\pi]$ 内。\n$\\theta_c$ 的表达式通过取反余弦得到：\n$$\n\\theta_c = \\arccos\\left(\\frac{\\nu-1}{\\nu+1}\\right)\n$$\n该表达式在端点 $\\nu=1$ 处也是良定义且连续的，此时它得出 $\\theta_c = \\arccos(0) = \\frac{\\pi}{2}$。这在整个定义域 $0  \\nu \\le 1$ 上提供了一个单一、一致的答案。",
            "answer": "$$\n\\boxed{\\arccos\\left(\\frac{\\nu-1}{\\nu+1}\\right)}\n$$"
        },
        {
            "introduction": "理论分析提供了关键的洞察力，但我们最终需要通过实际的计算机模拟来评估数值格式的性能。本练习将理论与实践相结合，从解析推导转向计算实验。你将通过编程实现两种平流格式，并通过计算解的方差衰减（作为数值扩散的度量）和主导傅里叶模态的相移（作为数值频散的度量），来量化它们在一个平流周期内的累积误差()。这个动手编程练习将使数值扩散和频散的抽象概念变得具体化，让你能够直接观察和测量这些误差在模拟中的表现，从而巩固对它们如何影响模型准确性的理解。",
            "id": "3803225",
            "problem": "考虑一个被动示踪剂的一维线性平流，其由偏微分方程 $c_t + u c_x = 0$ 控制，定义在一个长度为 $L$、速度为常数 $u$ 的周期性域上。在没有物理扩散的情况下，精确解会输运任何初始条件 $c(x,0)$，而不会改变其形状、总质量或空间方差。然而，离散数值格式会引入数值误差，这些误差可以分解为两种效应：数值扩散（振幅衰减，会减小示踪剂波动的方差）和数值频散（相位误差，会移动或扭曲特征，但不一定改变其振幅）。您的任务是使用两种标准的显式格式，对一个高斯脉冲在恰好一个平流周期 $T = L/u$ 内的这两种效应进行量化。\n\n实现一个程序，该程序：\n- 在具有 $N$ 个点、网格间距 $\\Delta x = L/N$ 的均匀周期性网格上表示解，时间步长 $\\Delta t$ 从指定的 Courant–Friedrichs–Lewy 数 (CFL) $\\mathrm{C} = u \\Delta t / \\Delta x$ 中选择。\n- 将示踪剂初始化为以 $x_0$ 为中心、标准差为 $\\sigma$ 的高斯脉冲，定义在 $[0,L)$ 上：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right),\n$$\n其中 $d(x;x_0)$ 是圆 $[0,L)$ 上 $x$ 和 $x_0$ 之间的最小周期距离，因此 $d \\in \\left[-\\frac{L}{2},\\frac{L}{2}\\right]$。\n- 使用以下守恒的、周期性的有限差分更新规则之一，将示踪剂演化恰好一个周期 $T = L/u$（空间用索引 $i \\in \\{0,\\dots,N-1\\}$ 离散化，时间层为 $n$）：\n    1. 一阶迎风格式（对于 $u \\ge 0$）：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\,\\left(c_i^n - c_{i-1}^n\\right),\n    $$\n    其中周期性索引为 $c_{-1}^n \\equiv c_{N-1}^n$。\n    2. Lax–Wendroff (二阶) 格式：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right),\n    $$\n    其中使用周期性索引。\n- 确保时间步数 $n_T$ 精确满足 $n_T \\Delta t = T$。对于下面的测试套件，通过选择 $\\mathrm{C}$ 使 $T/\\Delta t = N/\\mathrm{C}$ 为整数来保证这一点。\n- 通过零均值示踪剂场在 $t=0$ 和 $t=T$ 之间的离散空间方差（每单位长度）的衰减来量化数值扩散。定义时间 $t^n$ 的离散均值和方差为\n$$\n\\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2.\n$$\n报告比率\n$$\nR_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}},\n$$\n如果存在数值扩散，该比率应小于 $1$；对于完全无扩散的演化，该比率等于 $1$。\n- 通过零均值示踪剂场的主导大尺度傅里叶模态在一个周期内的残余相移来量化数值频散。令 $\\widehat{C}_1^n$ 表示在时间 $t^n$、波数为 $k_1 = 2\\pi/L$（$k=1$ 模态）的零均值场的离散傅里叶系数，通过以下离散傅里叶变换约定计算\n$$\n\\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-i \\frac{2\\pi k j}{N}\\right).\n$$\n一个周期后的精确连续解对于任何整数空间傅里叶模态都没有净相位变化。因此，$k=1$ 模态的任何非零相位变化都纯粹是数值造成的。定义包裹相位差\n$$\n\\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right),\n$$\n其中 $\\mathrm{wrap}(\\theta)$ 将角度映射到 $(-\\pi,\\pi]$。通过以下公式将此相位差转换为以米为单位的等效空间相移：\n$$\n\\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi,\n$$\n这是一周期后主导模态的残余空间位移。报告以米为单位的 $\\Delta x_{\\mathrm{phase}}$。\n\n您的程序必须为每个测试用例计算列表 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$，并将所有测试用例的结果汇总到标准输出的单行中，格式为一个由方括号括起来的逗号分隔列表，其中每个元素本身是包含两个浮点数的列表。不应打印任何其他文本。\n\n所有物理量必须使用指定的单位处理：$L$ 以米（$\\mathrm{m}$）为单位，$u$ 以米/秒（$\\mathrm{m/s}$）为单位，$T$ 以秒（$\\mathrm{s}$）为单位，$\\Delta x_{\\mathrm{phase}}$ 以米（$\\mathrm{m}$）为单位。用于相位计算的内部角度必须是弧度。\n\n测试套件：\n实现以下四个案例。对每个案例，运行恰好一个周期并报告 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n- 案例 A（一阶迎风格式，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 案例 B（Lax–Wendroff 格式，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 案例 C（一阶迎风格式，极限 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 200$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 1.0$，$\\sigma = 0.08\\,L$，$x_0 = 0.4\\,L$。\n- 案例 D（Lax–Wendroff 格式，窄脉冲）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.01\\,L$，$x_0 = 0.25\\,L$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个有四个元素的列表，每个元素都是一个按 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$ 顺序排列的包含两个浮点数的列表，分别对应于案例 A、B、C 和 D。例如：\n`[[r_A, s_A], [r_B, s_B], [r_C, s_C], [r_D, s_D]]`，\n其中每个 $r_\\cdot$ 和 $s_\\cdot$ 都是一个浮点数。输出中不要包含单位；所有距离均默认为米，所有比率均为无量纲。",
            "solution": "该问题要求量化用于求解一维线性平流方程 $c_t + u c_x = 0$ 的两种有限差分格式的数值扩散和数值频散。该方程描述了在一个长度为 $L$ 的一维周期性域上，被动示踪剂浓度 $c(x,t)$ 以恒定速度 $u$ 的输运过程。精确解会将初始示踪剂剖面 $c(x,0)$ 平移，而形状、振幅或方差均不发生任何变化。然而，数值格式会引入误差，表现为数值扩散（振幅衰减）和数值频散（导致形状扭曲的相位误差）。任务是针对高斯初始条件，在一个完整的平流周期 $T = L/u$ 后，计算这些误差。\n\n解决方案首先通过离散化控制方程，实现指定的数值格式，然后对模拟的初始和最终状态应用定义明确的度量标准来构建。\n\n**1. 离散化与模拟设置**\n\n连续域 $[0, L)$ 被离散化为一个包含 $N$ 个点的均匀网格，索引为 $i = 0, \\dots, N-1$。网格点位于 $x_i = i \\Delta x$，其中网格间距为 $\\Delta x = L/N$。时间被离散化为大小为 $\\Delta t$ 的步长。空间和时间离散化之间的关系由 Courant–Friedrichs–Lewy (CFL) 数控制，定义为 $\\mathrm{C} = u \\Delta t / \\Delta x$。为了所使用的显式格式的稳定性，该数值必须受到限制。\n\n模拟运行的总时长为 $T = L/u$，这对应于一个特征绕周期性域平流一周所需的时间。总时间步数 $n_T$ 的选择应使 $n_T \\Delta t = T$。通过代入 $T$、$\\Delta t$ 和 $\\mathrm{C}$ 的定义，我们发现 $n_T = \\frac{L/u}{( \\mathrm{C} \\Delta x / u)} = \\frac{L}{\\mathrm{C} (L/N)} = N/\\mathrm{C}$。问题保证了对于所有测试用例，$N/\\mathrm{C}$ 都是整数，确保模拟恰好在一个周期结束。\n\n**2. 初始条件**\n\n初始示踪剂分布是一个高斯脉冲，由下式给出：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right)\n$$\n这里，$x_0$ 是脉冲的中心，$\\sigma$ 是其标准差，$d(x; x_0)$ 是任意点 $x$ 与中心 $x_0$ 之间的最小周期距离。此距离函数正确处理了周期性域的环绕特性，并定义在区间 $[-\\frac{L}{2}, \\frac{L}{2}]$ 上。在网格 $\\{x_i\\}$ 上的离散实现中，每个 $x_i$ 到 $x_0$ 的距离计算为 $d(x_i; x_0) = (x_i - x_0) - L \\cdot \\mathrm{round}((x_i - x_0)/L)$。这确保了高斯函数在圆形域上正确定位且对称。\n\n**3. 数值格式**\n\n离散示踪剂场 $c_i^n \\approx c(x_i, t^n)$ 的演化是使用两种显式的、守恒的有限差分格式计算的。周期性通过对空间索引使用模运算来强制实现，使得 $c_{i \\pm N}^n = c_i^n$。\n\n*   **一阶迎风格式：** 对于正速度 $u \\ge 0$，该格式由下式给出：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\left(c_i^n - c_{i-1}^n\\right)\n    $$\n    该格式在空间和时间上都是一阶精度的。已知对于 $0 \\le \\mathrm{C} \\le 1$，它是数值稳定的。其主阶截断误差项与二阶空间导数成正比，起到扩散项的作用。因此，该格式具有很强的耗散性，会导致陡峭的梯度被抹平，振幅随时间衰减。在 $\\mathrm{C}=1$ 的特殊情况下，该格式变为 $c_i^{n+1} = c_{i-1}^n$，这是一个网格上的精确平移算子。在这种情况下，离散解被无误差地输运。\n\n*   **Lax–Wendroff 格式：** 这是一个在空间和时间上都是二階精度的格式：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right)\n    $$\n    Lax–Wendroff 格式对于 $|\\mathrm{C}| \\le 1$是稳定的。它的构建是为了抵消二阶截断误差项，使其比迎风格式的耗散性显著降低。然而，其主导误差项与三阶空间导数成正比，这会引入频散误差。这些误差导致解的不同傅里叶分量以不正确的相速度传播，从而引起伪振荡，尤其是在陡峭特征附近。\n\n在实现时，这些更新规则在每个时间步被向量化地应用于整个解数组 $c^n$。诸如 $c_{i\\pm 1}^n$ 等项所需的周期性移位可以通过数组滚动操作高效处理。\n\n**4. 数值误差的量化**\n\n计算两个度量标准来量化一个周期 $T$ 后数值扩散和频散的影响。\n\n*   **数值扩散度量 ($R_{\\mathrm{var}}$):** 数值扩散会衰减示踪剂波动的振幅。这种效应通过测量解的空间方差的衰减来量化。时间层 $n$ 的示踪剂场的离散均值和方差为：\n    $$\n    \\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2\n    $$\n    扩散度量是最终时间 $t^{n_T} = T$ 的方差与初始时间 $t=0$ 的方差之比：\n    $$\n    R_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}}\n    $$\n    对于一个完美的、无扩散的格式，$R_{\\mathrm{var}} = 1$。数值扩散的存在导致 $R_{\\mathrm{var}}  1$。\n\n*   **数值频散度量 ($\\Delta x_{\\mathrm{phase}}$):** 数值频散导致不同波长以不正确的速度传播。这通过检查解的特定傅里葉模態的相位来分析。我们关注与域匹配的最长波长模态，其波数为 $k_1 = 2\\pi/L$。该模态的复系数通过对零均值示踪剂场 $c_j^n - \\overline{c}^n$ 进行离散傅里叶变换（DFT）得到：\n    $$\n    \\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-i \\frac{2\\pi k j}{N}\\right)\n    $$\n    对于一个周期 $T=L/u$ 后的精确解，场会返回其原始状态，因此任何傅里叶系数的相位都应保持不变。任何数值相位误差都由 $k=1$ 模态 $\\widehat{C}_1^n$ 的最终相位与初始相位之差捕获。包裹相位差计算如下：\n    $$\n    \\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right)\n    $$\n    其中 $\\mathrm{wrap}(\\theta)$ 函数将角度 $\\theta$ 映射到区间 $(-\\pi, \\pi]$。相位误差 $\\Delta \\phi$ 等效于一个错误的空间位移。一个 $\\delta x$ 的空间位移会引入 $-k_1 \\delta x = - (2\\pi/L) \\delta x$ 的相位变化。因此，等效的空间相移为：\n    $$\n    \\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi\n    $$\n    该值表示示踪剂主导大尺度特征在一个周期后的残余位移。一个非零的 $\\Delta x_{\\mathrm{phase}}$ 是该格式累积频散误差的直接度量。\n\n**5. 算法实现**\n\n对于每个测试用例，算法按以下步骤进行：\n1.  初始化参数（$L$, $N$, $u$, $\\mathrm{C}$ 等）。\n2.  构建空间网格 $x_i$ 和初始高斯剖面 $c^0$。\n3.  计算初始方差 $\\mathrm{Var}^0$ 和初始相位 $\\arg(\\widehat{C}_1^0)$。\n4.  循环 $n_T = N/\\mathrm{C}$ 个时间步，在每一步应用所选的数值格式（迎风或 Lax-Wendroff）来更新解向量。\n5.  循环结束后，计算最终方差 $\\mathrm{Var}^{n_T}$ 和最终相位 $\\arg(\\widehat{C}_1^{n_T})$。\n6.  使用上述公式计算度量 $R_{\\mathrm{var}}$ 和 $\\Delta x_{\\mathrm{phase}}$。\n7.  存储结果对 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n对所有四个测试用例重复此过程，并将结果汇总到一个最终列表中以供输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the 1D advection problem.\n    \"\"\"\n\n    def solve_case(scheme, L, N, u, C, sigma_rel, x0_rel):\n        \"\"\"\n        Solves a single case of the 1D advection problem.\n\n        Args:\n            scheme (str): 'upwind' or 'lax-wendroff'.\n            L (float): Domain length in meters.\n            N (int): Number of grid points.\n            u (float): Advection velocity in m/s.\n            C (float): Courant number.\n            sigma_rel (float): Standard deviation as a fraction of L.\n            x0_rel (float): Initial pulse center as a fraction of L.\n\n        Returns:\n            list: A list containing [R_var, delta_x_phase].\n        \"\"\"\n        # 1. Setup simulation parameters\n        dx = L / N\n        T = L / u\n        n_T = int(round(N / C))\n        # dt = T / n_T # Equivalent to C * dx / u\n\n        sigma = sigma_rel * L\n        x0 = x0_rel * L\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # 2. Set Initial Condition (Periodic Gaussian)\n        dist_x = x - x0\n        # Minimal periodic distance on the torus [0, L)\n        d = dist_x - L * np.round(dist_x / L)\n        c0 = np.exp(-(d**2) / (2 * sigma**2))\n\n        # 3. Analyze Initial State\n        var0 = np.var(c0)\n        c0_zm = c0 - np.mean(c0)\n        C_hat_0 = np.fft.fft(c0_zm)\n        # Phase of the k=1 mode\n        phi0 = np.angle(C_hat_0[1])\n\n        # 4. Time Evolution Loop\n        c_current = c0.copy()\n        if scheme == 'upwind':\n            for _ in range(n_T):\n                c_current = (1 - C) * c_current + C * np.roll(c_current, 1)\n        elif scheme == 'lax-wendroff':\n            for _ in range(n_T):\n                c_ip1 = np.roll(c_current, -1)\n                c_im1 = np.roll(c_current, 1)\n                term1 = -0.5 * C * (c_ip1 - c_im1)\n                term2 = 0.5 * C**2 * (c_ip1 - 2 * c_current + c_im1)\n                c_current = c_current + term1 + term2\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        c_final = c_current\n\n        # 5. Analyze Final State\n        var_final = np.var(c_final)\n        c_final_zm = c_final - np.mean(c_final)\n        C_hat_nT = np.fft.fft(c_final_zm)\n        # Phase of the k=1 mode\n        phi_nT = np.angle(C_hat_nT[1])\n\n        # 6. Calculate Metrics\n        # Numerical Diffusion: Variance Ratio\n        R_var = var_final / var0 if var0 > 0 else 1.0\n\n        # Numerical Dispersion: Phase Shift\n        \n        # Wrap angle to (-pi, pi]\n        def wrap_angle(angle):\n            return (angle + np.pi) % (2 * np.pi) - np.pi\n\n        delta_phi_raw = phi_nT - phi0\n        delta_phi = wrap_angle(delta_phi_raw)\n\n        delta_x_phase = -L * delta_phi / (2 * np.pi)\n\n        return [R_var, delta_x_phase]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: first-order upwind, moderate C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case B: Lax-Wendroff, moderate C\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case C: first-order upwind, limiting C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 200, 'u': 1.0, 'C': 1.0, 'sigma_rel': 0.08, 'x0_rel': 0.4},\n        # Case D: Lax-Wendroff, narrow pulse\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.01, 'x0_rel': 0.25},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(**case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}