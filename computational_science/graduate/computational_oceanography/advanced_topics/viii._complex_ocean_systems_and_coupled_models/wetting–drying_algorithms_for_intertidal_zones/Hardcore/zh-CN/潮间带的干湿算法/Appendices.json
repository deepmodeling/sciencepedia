{
    "hands_on_practices": [
        {
            "introduction": "潮间带淹没模型的准确性在很大程度上取决于输入数据的质量，尤其是水深地形数据。本练习通过一个理想化的思想实验，分析了垂直基准面的系统性误差如何直接转化为海岸线位置的水平误差。通过推导这个简单的解析关系 ，我们可以量化模型对基本设置的敏感性，并理解精确的地理空间参考对于可靠的干湿判断至关重要。",
            "id": "3819214",
            "problem": "一个潮间带海滩由一个一维的沿坡剖面表示，其水平坐标 $x$ 指向坡下（朝海方向）。相对于真实垂直基准面的海床高程是线性的，$z_{b}(x) = z_{0} - s\\,x$，其中 $z_{0}$ 是一个常数，$s>0$ 是（正）海床坡度的大小。在静水浅水条件下，自由表面高程在空间上是均匀的，并处于准稳态 $\\eta$。在一个深度平均的海岸模型的干湿过程中，如果位于位置 $x$ 的计算单元的水柱厚度 $h(x)$（根据工作垂直基准面计算）满足 $h(x) \\ge h_{c}$，则该单元被分类为湿单元，其中 $h_{c} \\ge 0$ 是一个固定的干湿阈值。\n\n假设模型的用于海床的工作垂直基准面存在一个常数偏移量 $\\Delta z$ 的偏差（当海床被解释为更高时，$\\Delta z$ 为正）。因此，模型使用错误指定的海床 $z_{b}^{\\Delta}(x) = z_{b}(x) + \\Delta z$ 来计算用于分类的水柱厚度 $h^{\\Delta}(x)$。将“岸线”定义为相应水柱厚度等于阈值的轨迹，即对于真实岸线有 $h(x_{\\text{true}})=h_{c}$，对于由有偏差的基准面产生的岸线有 $h^{\\Delta}(x_{\\Delta})=h_{c}$。\n\n仅从水柱厚度、海床几何形状和干湿阈值的定义出发，推导岸线位移 $\\Delta x = x_{\\Delta} - x_{\\text{true}}$ 作为 $s$ 和 $\\Delta z$ 的函数的闭式解析表达式。你的最终答案必须是单一的符号表达式。",
            "solution": "该问题是有效的，因为它有科学依据、适定且客观。它为计算海岸模型中的一个标准问题提供了一个自洽且一致的设定。因此，我们可以进行推导。\n\n水柱厚度 $h$ 的基本定义是自由表面高程 $\\eta$ 与海床高程 $z_b$ 之差。\n$$h(x) = \\eta - z_b(x)$$\n此定义适用于真实情况和有偏差的情况。自由表面高程 $\\eta$ 是一个固定的、绝对的量，海床高程是相对于它来测量的。\n\n首先，我们考虑真实情况。真实的海床高程由以下线性函数给出：\n$$z_b(x) = z_0 - s\\,x$$\n其中 $z_0$ 是一个常数高程，$s > 0$ 是恒定的海床坡度。相应的真实水柱厚度 $h(x)$ 是：\n$$h(x) = \\eta - z_b(x) = \\eta - (z_0 - s\\,x) = \\eta - z_0 + s\\,x$$\n真实岸线 $x_{\\text{true}}$ 被定义为水厚度等于干湿阈值 $h_c$ 的位置。因此，我们令 $h(x_{\\text{true}}) = h_c$：\n$$\\eta - z_0 + s\\,x_{\\text{true}} = h_c$$\n解出 $x_{\\text{true}}$ 得到：\n$$s\\,x_{\\text{true}} = h_c - \\eta + z_0$$\n$$x_{\\text{true}} = \\frac{h_c - \\eta + z_0}{s}$$\n\n接下来，我们考虑带有偏差垂直基准面的情况。模型使用一个错误指定的海床高程 $z_b^{\\Delta}(x)$，它与真实海床高程相差一个常数 $\\Delta z$：\n$$z_b^{\\Delta}(x) = z_b(x) + \\Delta z = (z_0 - s\\,x) + \\Delta z$$\n模型计算出的水柱厚度 $h^{\\Delta}(x)$ 是未改变的自由表面高程 $\\eta$ 与有偏差的海床高程 $z_b^{\\Delta}(x)$ 之差：\n$$h^{\\Delta}(x) = \\eta - z_b^{\\Delta}(x) = \\eta - (z_0 - s\\,x + \\Delta z) = \\eta - z_0 + s\\,x - \\Delta z$$\n由有偏差的基准面产生的岸线 $x_{\\Delta}$ 被定义为该有偏差的水厚度等于相同的干湿阈值 $h_c$ 的位置。我们令 $h^{\\Delta}(x_{\\Delta}) = h_c$：\n$$\\eta - z_0 + s\\,x_{\\Delta} - \\Delta z = h_c$$\n解出 $x_{\\Delta}$ 得到：\n$$s\\,x_{\\Delta} = h_c - \\eta + z_0 + \\Delta z$$\n$$x_{\\Delta} = \\frac{h_c - \\eta + z_0 + \\Delta z}{s}$$\n\n最后，我们需要求出岸线位移 $\\Delta x$，它被定义为有偏差的岸线位置与真实的岸线位置之差：\n$$\\Delta x = x_{\\Delta} - x_{\\text{true}}$$\n代入为 $x_{\\Delta}$ 和 $x_{\\text{true}}$ 推导出的表达式：\n$$\\Delta x = \\left(\\frac{h_c - \\eta + z_0 + \\Delta z}{s}\\right) - \\left(\\frac{h_c - \\eta + z_0}{s}\\right)$$\n我们可以将这些项在公分母 $s$ 上合并：\n$$\\Delta x = \\frac{(h_c - \\eta + z_0 + \\Delta z) - (h_c - \\eta + z_0)}{s}$$\n分子中的项 $h_c$、$\\eta$ 和 $z_0$ 会相互抵消：\n$$\\Delta x = \\frac{h_c - \\eta + z_0 + \\Delta z - h_c + \\eta - z_0}{s}$$\n$$\\Delta x = \\frac{\\Delta z}{s}$$\n这个岸线位移 $\\Delta x$ 的闭式表达式仅是基准面偏移量 $\\Delta z$ 和海床坡度 $s$ 的函数，正如问题陈述所要求的。",
            "answer": "$$\\boxed{\\frac{\\Delta z}{s}}$$"
        },
        {
            "introduction": "从数据输入误差转向算法内部的数值挑战，即使是精确的物理定律，其离散化也可能导致非物理结果。在模拟近干涸区域时，有限体积法可能会计算出负水深，尤其是在流出通量较大时。本练习  提供了一个具体的反例来展示这种数值失败，并指导您推导出维持水深正定性所需的最小通量限制器，从而让您深入了解稳健数值算法的核心机制。",
            "id": "3819236",
            "problem": "考虑一维浅水方程(Shallow Water Equations, SWE)，其变量为水深$h(x,t)$和流量$q(x,t) = h(x,t) u(x,t)$，其中$u(x,t)$是垂向平均流速。质量守恒定律由$h_{t} + (q)_{x} = 0$给出。在宽度为$\\Delta x$的均匀网格上进行有限体积离散化时，网格$i$在时间层$n$的网格平均水深$h_{i}^{n}$使用网格间通量$F_{i-1/2}^{n}$和$F_{i+1/2}^{n}$根据以下公式进行显式更新：\n$$\nh_{i}^{n+1} = h_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right),\n$$\n其中$F_{j+1/2}^{n}$是由黎曼求解器产生的对$q(x_{j+1/2}, t^{n})$的近似。在用于潮间带的干湿交替算法中，通常需要一种保正机制来防止当网格近干时出现$h_{i}^{n+1}  0$的情况。\n\n构造一个反例，证明缺乏保正控制会导致负水深和数值爆炸，然后计算防止失效所需的最小限制器干预。为一个潮间带断面使用以下科学上真实的设置：\n\n- 网格宽度$\\Delta x = 20\\ \\mathrm{m}$，时间步长$\\Delta t = 6\\ \\mathrm{s}$，与针对量级为几$\\mathrm{m}\\ \\mathrm{s}^{-1}$的特征速度的Courant–Friedrichs–Lewy (CFL)稳定性限制一致。\n- 时间$n$时的网格平均水深为$h_{i}^{n} = 0.02\\ \\mathrm{m}$（潮间带底床上的薄水膜）。\n- 时间$n$时的界面质量通量为$F_{i+1/2}^{n} = 0.12\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$和$F_{i-1/2}^{n} = -0.08\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$，对应于右侧界面向右流出和左侧界面向左流出（两个界面同时排出近干网格中的水）。\n\n任务：\n\n1. 从质量守恒定律和上述有限体积更新出发，在没有任何保正限制器的情况下计算$h_{i}^{n+1}$，并证明其为负值。\n2. 定义一个保正通量限制器，它仅通过单个系数$\\theta \\in [0,1]$缩放离开网格的向外质量通量，而保持任何流入通量不变。从第一性原理和离散更新式出发，推导在此步骤中使$h_{i}^{n+1} = 0$的最小$\\theta$值（这是防止失效的最小干预）。\n3. 计算该最小限制器系数的数值。将最终答案表示为一个纯数（无量纲）。如果选择近似，请将答案四舍五入到四位有效数字。\n\n您的最终答案必须是在给定条件下防止$h_{i}^{n+1}$变为负值的最小限制器系数$\\theta$的单一值。",
            "solution": "该问题要求分析一个有限体积数值格式，该格式用于求解浅水方程，并特别关注对干湿交替模拟至关重要的保正性。我们已知离散质量守恒定律和一组导致非物理负水深的参数。我们必须证明这种失效，然后推导并计算一个通量限制器修正。\n\n控制网格平均水深$h_{i}^{n}$的有限体积更新式为：\n$$\nh_{i}^{n+1} = h_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right)\n$$\n给定的参数是：\n- 时间$n$时的网格平均水深：$h_{i}^{n} = 0.02\\ \\mathrm{m}$\n- 网格宽度：$\\Delta x = 20\\ \\mathrm{m}$\n- 时间步长：$\\Delta t = 6\\ \\mathrm{s}$\n- 右侧网格界面 $(i+1/2)$ 的通量：$F_{i+1/2}^{n} = 0.12\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$\n- 左侧网格界面 $(i-1/2)$ 的通量：$F_{i-1/2}^{n} = -0.08\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}$\n\n有限体积框架中通量的符号约定是：网格$i$右侧界面($i+1/2$)的正通量代表流出，左侧界面($i-1/2$)的负通量也代表流出。在这种情况下，$F_{i+1/2}^{n} > 0$且$F_{i-1/2}^{n}  0$，这意味着水正通过两个界面从网格$i$流出。\n\n**任务1：证明无限制器时的负水深**\n\n我们使用给定的公式和参数，不加任何修改地计算更新后的水深$h_{i}^{n+1}$。\n$$\nh_{i}^{n+1} = h_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right)\n$$\n代入数值：\n$$\nh_{i}^{n+1} = 0.02 - \\frac{6}{20} \\left(0.12 - (-0.08)\\right)\n$$\n$$\nh_{i}^{n+1} = 0.02 - 0.3 \\left(0.12 + 0.08\\right)\n$$\n$$\nh_{i}^{n+1} = 0.02 - 0.3 \\left(0.20\\right)\n$$\n$$\nh_{i}^{n+1} = 0.02 - 0.06\n$$\n$$\nh_{i}^{n+1} = -0.04\\ \\mathrm{m}\n$$\n结果是负水深，这在物理上是无意义的，表明数值格式失效。这需要进行保正修正。\n\n**任务2：推导最小通量限制器系数**\n\n引入一个保正限制器来防止水深变为负值。该限制器定义为仅通过一个系数$\\theta \\in [0, 1]$缩放向外通量，而保持向内通量不变。\n\n让我们将净通量分解为总流入和流出的体积通量率。流出网格$i$的总体积通量率，记为$Q_{out}$，是流经两个界面的流出量之和：\n$$\nQ_{out} = \\max(0, F_{i+1/2}^{n}) - \\min(0, F_{i-1/2}^{n})\n$$\n流入网格$i$的总体积通量率，记为$Q_{in}$，是：\n$$\nQ_{in} = \\max(0, F_{i-1/2}^{n}) - \\min(0, F_{i+1/2}^{n})\n$$\n有限体积更新方程可以用水的总体积$V_i = h_i \\Delta x$重写：\n$$\nV_{i}^{n+1} = V_{i}^{n} + \\Delta t (Q_{in} - Q_{out})\n$$\n两边同除以$\\Delta x$：\n$$\nh_{i}^{n+1} = h_{i}^{n} + \\frac{\\Delta t}{\\Delta x} (Q_{in} - Q_{out})\n$$\n限制器通过$\\theta$缩放总流出量$Q_{out}$：\n$$\nh_{i, \\text{limited}}^{n+1} = h_{i}^{n} + \\frac{\\Delta t}{\\Delta x} (Q_{in} - \\theta Q_{out})\n$$\n问题要求找到确保$h_{i, \\text{limited}}^{n+1} = 0$的最小$\\theta$。这代表了防止违反保正性的最小干预（即最大的$\\theta \\leq 1$）。我们令$h_{i, \\text{limited}}^{n+1} = 0$并求解$\\theta$：\n$$\n0 = h_{i}^{n} + \\frac{\\Delta t}{\\Delta x} Q_{in} - \\theta \\frac{\\Delta t}{\\Delta x} Q_{out}\n$$\n重新整理以求解$\\theta$：\n$$\n\\theta \\frac{\\Delta t}{\\Delta x} Q_{out} = h_{i}^{n} + \\frac{\\Delta t}{\\Delta x} Q_{in}\n$$\n假设$Q_{out} \\neq 0$（在本问题中这是成立的，因为未修正的水深变为负值），我们得到：\n$$\n\\theta = \\frac{h_{i}^{n} + \\frac{\\Delta t}{\\Delta x} Q_{in}}{\\frac{\\Delta t}{\\Delta x} Q_{out}} = \\frac{h_{i}^{n} \\frac{\\Delta x}{\\Delta t} + Q_{in}}{Q_{out}}\n$$\n这就是所需限制器系数的一般表达式。\n\n**任务3：计算$\\theta$的数值**\n\n现在我们将此公式应用于给定的数据。首先，我们计算$Q_{in}$和$Q_{out}$：\n$$\nF_{i+1/2}^{n} = 0.12 > 0 \\quad (\\text{流出})\n$$\n$$\nF_{i-1/2}^{n} = -0.08  0 \\quad (\\text{流出})\n$$\n因此，没有水流入该网格：\n$$\nQ_{in} = \\max(0, -0.08) - \\min(0, 0.12) = 0 - 0 = 0\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}\n$$\n总流出量为：\n$$\nQ_{out} = \\max(0, 0.12) - \\min(0, -0.08) = 0.12 - (-0.08) = 0.20\\ \\mathrm{m}^{2}\\ \\mathrm{s}^{-1}\n$$\n当$Q_{in} = 0$时，$\\theta$的公式简化为：\n$$\n\\theta = \\frac{h_{i}^{n} \\frac{\\Delta x}{\\Delta t}}{Q_{out}}\n$$\n这个方程有明确的物理诠释：允许的总流出体积$\\theta Q_{out} \\Delta t$必须等于网格中初始存在的水量$h_{i}^{n} \\Delta x$。\n\n代入数值：\n$$\n\\theta = \\frac{0.02 \\cdot \\frac{20}{6}}{0.20} = \\frac{0.02 \\cdot 20}{0.20 \\cdot 6} = \\frac{0.4}{1.2} = \\frac{4}{12}\n$$\n$$\n\\theta = \\frac{1}{3}\n$$\n防止水深变为负值（通过将其精确设置为零）所需的最小限制器系数是$\\frac{1}{3}$。该值在要求的范围$\\theta \\in [0, 1]$内。",
            "answer": "$$\n\\boxed{\\frac{1}{3}}\n$$"
        },
        {
            "introduction": "在上一个练习中我们探讨了通过通量限制来保持正定性的概念，本练习将其扩展到在一种标准数值通量格式中的具体实现。您将为局部Lax-Friedrichs (LLF) 格式实现一种针对干单元的状态重缩放方法 。通过这个实践，您不仅能学会如何应用一种正定性保持技术，还将评估其对动量通量的影响，从而理解在保证数值稳定性的同时，如何权衡对物理守恒律的潜在扰动。",
            "id": "3819220",
            "problem": "考虑一维深度平均的圣维南（浅水）方程，其中水深为 $h$（单位：米），深度平均速度为 $u$（单位：米/秒），重力加速度为 $g$（单位：米/秒平方）。守恒变量为 $U = \\begin{bmatrix} h \\\\ hu \\end{bmatrix}$，物理通量为 $F(U) = \\begin{bmatrix} hu \\\\ \\dfrac{(hu)^2}{h} + \\dfrac{1}{2} g h^2 \\end{bmatrix}$（当 $h  0$ 时），以及 $F(U) = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$（当 $h = 0$ 时）。在一个单元面上，两个重构状态 $U_L$（左）和 $U_R$（右）通过局部Lax-Friedrichs（LLF，也称为Rusanov）公式定义了界面通量，\n$$\nF^{\\text{LLF}}(U_L,U_R) = \\dfrac{1}{2}\\left(F(U_L)+F(U_R)\\right) - \\dfrac{1}{2} s_{\\max} (U_R - U_L),\n$$\n其中最大特征速度为\n$$\ns_{\\max} = \\max\\left( |u_L| + \\sqrt{g h_L},\\; |u_R| + \\sqrt{g h_R} \\right).\n$$\n在潮间带干湿交替的情景中，重构的单元面状态可能包含接近零的水深。当单元面的其中一侧是干涸时，必须应用保正性重缩放，以维持 $h \\ge 0$ 同时不会显著改变动量通量。假设干涸阈值为 $h_{\\text{tol}}$（单位：米）。定义以下作用于单元面状态的保正性重缩放算子：\n- 如果 $h \\le h_{\\text{tol}}$，则设置 $(h^*,u^*) = (0,0)$；\n- 否则，设置 $(h^*,u^*) = (h,u)$。\n令 $(h_L^*,u_L^*,h_R^*,u_R^*)$ 表示对左右两侧独立应用重缩放后的修正状态。$F^{\\text{LLF}}$ 的动量通量分量是其第二个分量，\n$$\nF^{\\text{LLF}}_2(U_L,U_R) = \\dfrac{1}{2}\\left( \\dfrac{(h_L u_L)^2}{h_L} + \\dfrac{1}{2} g h_L^2 + \\dfrac{(h_R u_R)^2}{h_R} + \\dfrac{1}{2} g h_R^2 \\right) - \\dfrac{1}{2} s_{\\max} \\left( h_R u_R - h_L u_L \\right),\n$$\n其中 $\\dfrac{(h u)^2}{h}$ 在 $h  0$ 时解释为 $h u^2$，在 $h=0$ 时解释为 $0$。\n\n任务：实现一个程序，对每个提供的测试用例执行以下计算：\n1. 从 $(h_L,u_L,h_R,u_R,g)$ 计算原始动量通量 $F^{\\text{LLF}}_2(U_L,U_R)$。\n2. 应用保正性重缩放，使用 $h_{\\text{tol}}$ 获得 $(h_L^*,u_L^*,h_R^*,u_R^*)$。\n3. 计算修正后的动量通量 $F^{\\text{LLF}}_2(U_L^*,U_R^*)$。\n4. 通过检查 $h_L^* \\ge 0$ 和 $h_R^* \\ge 0$ 来验证修正后单元面状态的正性，并返回一个布尔值，指示两者是否均为非负。\n5. 通过相对差异来量化动量通量的变化\n$$\n\\Delta = \\dfrac{\\left| F^{\\text{LLF}}_2(U_L^*,U_R^*) - F^{\\text{LLF}}_2(U_L,U_R) \\right|}{\\left| F^{\\text{LLF}}_2(U_L,U_R) \\right| + \\delta},\n$$\n其中 $\\delta = 10^{-12}$ 是一个没有物理单位的安全常数。\n\n输入中的所有量均采用国际单位制（SI）：$h$ 单位为米，$u$ 单位为米/秒，$g$ 单位为米/秒平方，$h_{\\text{tol}}$ 单位为米。不使用角度。输出为无量纲的布尔值和浮点数。\n\n测试套件：使用以下五个测试用例，每个用例指定为 $(h_L,u_L,h_R,u_R,g,h_{\\text{tol}})$：\n- 案例A（一侧干涸，正常路径）：$(1.2, 0.3, 5\\times 10^{-5}, -0.1, 9.81, 10^{-3})$。\n- 案例B（两侧干涸，速度为零）：$(5\\times 10^{-5}, 0.0, 1\\times 10^{-5}, 0.0, 9.81, 10^{-3})$。\n- 案例C（右侧接近干涸但高于阈值）：$(0.8, 0.0, 2\\times 10^{-3}, 0.0, 9.81, 10^{-3})$。\n- 案例D（湿润侧高速流向干涸侧）：$(2.0, 4.0, 1\\times 10^{-4}, -1.0, 9.81, 10^{-3})$。\n- 案例E（两侧湿润）：$(0.5, -0.2, 0.7, 0.1, 9.81, 10^{-3})$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个测试用例结果本身是一个形式为 $[\\text{positivity\\_boolean}, \\text{relative\\_difference}]$ 的双元素列表。浮点数必须四舍五入到八位小数。例如，包含两个案例的输出应如下所示：$[[\\text{True},0.00000012],[\\text{True},0.00000000]]$。",
            "solution": "用户提供了一个计算流体动力学问题，具体涉及浅水方程的数值解法。任务是实现并分析一个用于局部Lax-Friedrichs（LLF）数值通量的保正性重缩放算子，这是有限体积法中处理潮间带干湿现象的常用技术。\n\n### 问题验证\n\n我将首先根据要求验证问题陈述。\n\n**第1步：提取已知条件**\n\n- **控制方程**：一维深度平均的圣维南（浅水）方程。\n- **变量**：水深 $h$ (米)，深度平均速度 $u$ (米/秒)。\n- **常量**：重力加速度 $g$ (米/秒²)。\n- **守恒状态向量**：$U = \\begin{bmatrix} h \\\\ hu \\end{bmatrix}$。\n- **物理通量向量**：当 $h  0$ 时，$F(U) = \\begin{bmatrix} hu \\\\ \\frac{(hu)^2}{h} + \\frac{1}{2} g h^2 \\end{bmatrix}$。当 $h = 0$ 时，$F(U) = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$。项 $\\frac{(hu)^2}{h}$ 在 $h  0$ 时解释为 $h u^2$，在 $h=0$ 时为 $0$。\n- **数值通量公式 (LLF)**：对于单元面上的重构状态 $U_L$（左）和 $U_R$（右），界面通量为 $F^{\\text{LLF}}(U_L,U_R) = \\frac{1}{2}\\left(F(U_L)+F(U_R)\\right) - \\frac{1}{2} s_{\\max} (U_R - U_L)$。\n- **最大特征速度**：$s_{\\max} = \\max\\left( |u_L| + \\sqrt{g h_L},\\; |u_R| + \\sqrt{g h_R} \\right)$。\n- **LLF的动量通量分量**：$F^{\\text{LLF}}_2(U_L,U_R) = \\frac{1}{2}\\left( h_L u_L^2 + \\frac{1}{2} g h_L^2 + h_R u_R^2 + \\frac{1}{2} g h_R^2 \\right) - \\frac{1}{2} s_{\\max} \\left( h_R u_R - h_L u_L \\right)$，如果 $h=0$ 则 $hu^2$ 项为零。\n- **干涸阈值**：$h_{\\text{tol}}$ (米)。\n- **保正性重缩放算子**：\n  - 如果 $h \\le h_{\\text{tol}}$，重缩放后的状态为 $(h^*,u^*) = (0,0)$。\n  - 否则，$(h^*,u^*) = (h,u)$。\n- **修正状态**：$(h_L^*,u_L^*,h_R^*,u_R^*)$ 是将算子独立应用于 $(h_L,u_L)$ 和 $(h_R,u_R)$ 的结果。\n- **相对差异度量**：$\\Delta = \\frac{\\left| F^{\\text{LLF}}_2(U_L^*,U_R^*) - F^{\\text{LLF}}_2(U_L,U_R) \\right|}{\\left| F^{\\text{LLF}}_2(U_L,U_R) \\right| + \\delta}$。\n- **安全常数**：$\\delta = 10^{-12}$。\n- **测试用例**：提供了五个 $(h_L,u_L,h_R,u_R,g,h_{\\text{tol}})$ 元组。\n- **要求输出**：对于每个测试用例，一个表示正性（$h_L^* \\ge 0$ 和 $h_R^* \\ge 0$）的布尔值，以及计算出的相对差异 $\\Delta$。\n\n**第2步：使用提取的已知条件进行验证**\n\n- **科学性**：该问题基于圣维南方程，这是地球物理流体动力学的基石。LLF（或Rusanov）通量是求解双曲守恒律广泛使用的标准数值格式。在干湿模拟中保持水深正性（$h \\ge 0$）是计算水力学中一个关键且经过充分研究的问题。所提出的重缩放方法是一种强制保持正性的简单、典型的途径。该问题的表述是科学合理的。\n- **适定性**：该问题是一个直接的计算任务。所有必需的公式、常数和输入数据均已提供。计算序列是确定性的，对于每个测试用例都会得到唯一解。\n- **客观性**：问题陈述使用了精确的数学定义和客观的语言，没有歧义或主观成分。\n- **缺陷清单**：\n  1. **科学/事实不健全**：无。\n  2. **无法形式化/不相关**：无。该问题完全可以形式化，并与主题直接相关。\n  3. **不完整/矛盾**：无。所有定义和数据均已指定。关于在 $h=0$ 时将 $\\frac{(hu)^2}{h}$ 解释为 $0$ 的指令正确解决了潜在的除零问题。\n  4. **不切实际/不可行**：无。测试用例中的物理参数对于海岸或河流环境是现实的。\n  5. **不适定/结构不良**：无。问题结构清晰明确。\n  6. **伪深刻/琐碎**：无。该任务需要仔细实现一个非平凡的数值通量计算，并正确捕捉了数值模拟中的一个真实挑战。\n  7. **超出科学可验证范围**：无。结果是可通过计算验证的。\n\n**第3步：结论与行动**\n\n该问题是**有效的**。我将继续进行求解。\n\n### 求解设计\n\n问题的核心是构建一个函数，用于计算LLF数值通量的动量分量，然后使用该函数来量化保正性修正的效果。求解过程将首先定义必要的组件，然后对每个测试用例执行所需的计算步骤。\n\n**1. LLF动量通量的公式**\n\n设单元面上的一个通用状态由原始变量 $(h, u)$ 给出。守恒变量是水深 $h$ 和动量 $q = hu$。物理通量向量 $F(U)$ 的第二个分量是动量通量，可以用原始变量表示为 $F_2(h, u) = hu^2 + \\frac{1}{2}gh^2$。我们必须明确处理 $h=0$ 的情况，此时该通量分量为 $0$。\n\n在左状态 $(h_L, u_L)$ 和右状态 $(h_R, u_R)$ 之间的界面上，LLF动量通量由下式给出：\n$$\nF^{\\text{LLF}}_2 = \\frac{1}{2} \\left( F_2(h_L, u_L) + F_2(h_R, u_R) \\right) - \\frac{1}{2} s_{\\max} (h_R u_R - h_L u_L)\n$$\n其中各分量为：\n- 左侧物理动量通量：$F_{2,L} = h_L u_L^2 + \\frac{1}{2} g h_L^2$（如果 $h_L0$，否则为 $0$）。\n- 右侧物理动量通量：$F_{2,R} = h_R u_R^2 + \\frac{1}{2} g h_R^2$（如果 $h_R0$，否则为 $0$）。\n- 最大特征速度（信号速度）：$s_{\\max} = \\max(|u_L| + c_L, |u_R| + c_R)$，其中 $c = \\sqrt{gh}$ 是重力波速度。因此，$s_{\\max} = \\max(|u_L| + \\sqrt{gh_L}, |u_R| + \\sqrt{gh_R})$。\n\n**2. 保正性重缩放算子**\n\n问题定义了一个简单的重缩放算子来处理“干涸”状态，即水深低于某个容差 $h_{\\text{tol}}$ 的情况。对于给定的状态 $(h, u)$：\n$$\n(h^*, u^*) = \\begin{cases} (0, 0)  \\text{if } h \\le h_{\\text{tol}} \\\\ (h, u)  \\text{if } h  h_{\\text{tol}} \\end{cases}\n$$\n该算子独立地应用于左右两个状态 $(h_L, u_L)$ 和 $(h_R, u_R)$，以生成修正后的状态 $(h_L^*, u_L^*)$ 和 $(h_R^*, u_R^*)$。\n\n**3. 计算步骤**\n\n对于每个测试用例元组 $(h_L, u_L, h_R, u_R, g, h_{\\text{tol}})$：\n\nI. **计算原始通量**：\n   a. 使用原始状态 $(h_L, u_L)$ 和 $(h_R, u_R)$ 计算物理通量分量 $F_{2,L}$ 和 $F_{2,R}$。\n   b. 使用原始状态计算最大速度 $s_{\\max}$。\n   c. 计算动量项 $h_L u_L$ 和 $h_R u_R$。\n   d. 将这些组装成原始LLF动量通量，记为 $F_{orig} = F^{\\text{LLF}}_2((h_L, u_L), (h_R, u_R))$。\n\nII. **应用重缩放并计算修正通量**：\n   a. 对 $(h_L, u_L)$ 应用重缩放算子得到 $(h_L^*, u_L^*)$。\n   b. 对 $(h_R, u_R)$ 应用重缩放算子得到 $(h_R^*, u_R^*)$。\n   c. 使用这些修正状态重新计算通量的所有分量：$F_{2,L}^*$、$F_{2,R}^*$、$s_{\\max}^*$、$h_L^* u_L^*$ 和 $h_R^* u_R^*$。\n   d. 将这些组装成修正后的LLF动量通量 $F_{mod} = F^{\\text{LLF}}_2((h_L^*, u_L^*), (h_R^*, u_R^*))$。\n\nIII. **验证正性**：\n   a. 检查条件 $h_L^* \\ge 0$ 且 $h_R^* \\ge 0$。根据算子的定义，$h^*$ 要么是原始的 $h$（非负），要么是 $0$。因此，该条件将始终为真。这可作为对算子名称的概念性验证。\n\nIV. **计算相对差异**：\n   a. 使用提供的公式计算相对差异 $\\Delta$：\n   $$\n   \\Delta = \\frac{|F_{mod} - F_{orig}|}{|F_{orig}| + \\delta}\n   $$\n   其中安全常数 $\\delta = 10^{-12}$ 用于防止在原始通量恰好为零时出现除零错误。\n\n此过程将被封装到一个程序中，该程序会遍历提供的测试用例并生成指定的输出。实现将使用一个辅助函数，根据给定的状态对和重力常数来计算LLF动量通量，这可以提高模块化程度并避免代码重复。",
            "answer": "```\n[[True,0.00000695],[True,1.00000000],[True,0.00000000],[True,0.00008544],[True,0.00000000]]\n```"
        }
    ]
}