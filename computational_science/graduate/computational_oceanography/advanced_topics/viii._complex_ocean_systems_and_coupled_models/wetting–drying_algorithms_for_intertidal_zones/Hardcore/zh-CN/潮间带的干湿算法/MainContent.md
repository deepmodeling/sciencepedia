## 引言
潮间带，作为陆地与海洋的动态交界，其周期性的淹没与出露过程对海岸生态、地貌演化和工程活动至关重要。然而，在数值模型中准确捕捉这一移动的干湿锋面，即岸线，是一个长期存在的重大挑战。传统的流体动力学模型在处理水深趋近于零的区域时，往往会遭遇质量不守恒、数值不稳定以及非物理性流动等问题。为解决这一难题，计算海洋学家开发了一系列精密的干湿交替算法。

本文旨在系统性地剖析这些算法的核心。通过三个部分的递进式讲解，读者将构建一个从理论到实践的完整认知体系。在“原理与机制”部分，我们将从浅水控制方程出发，深入探讨算法为保证物理真实性与数值稳定性所必须遵循的核心原则。随后的“应用与跨学科联系”部分将展示这些算法如何在海岸建模、灾害预警等实际问题中发挥作用，并揭示其与数值分析、[物理海洋学](@entry_id:1129648)等领域的深刻联系。最后，在“动手实践”部分，读者将通过具体的编程练习，直面并解决算法实现中的关键技术难点。

现在，让我们从最基础的部分开始，深入探索干湿交替算法的内在原理与核心机制。

## 原理与机制

本章深入探讨了潮间带干湿交替算法的核心原理与关键机制。在上一章介绍背景知识的基础上，本章将从控制方程入手，系统阐述在干湿锋面处遇到的数值挑战，并详细介绍为保证数值解的物理真实性与稳定性而设计的核心算法原则与具体实现策略。

### [潮汐流](@entry_id:159520)的控制方程与基本定义

潮间带水动力学的[数值模拟](@entry_id:146043)，其基础是**浅水方程（Shallow Water Equations, SWEs）**。该方程组是通过对三维[Navier-Stokes](@entry_id:276387)方程在垂直方向上积分，并假设静水压力分布以及水平尺度远大于垂直尺度而得到的。对于一个二维水平域，忽略科里奥利力、[风应力](@entry_id:1134097)和水平粘性时，其[守恒形式](@entry_id:1122899)可以写作：

$$
\partial_t \mathbf{U} + \partial_x \mathbf{F}(\mathbf{U}) + \partial_y \mathbf{G}(\mathbf{U}) = \mathbf{S}(\mathbf{U}, z_b)
$$

其中，**守恒变量向量** $\mathbf{U}$、$x$ 和 $y$ 方向的**通量向量** $\mathbf{F}$ 和 $\mathbf{G}$，以及**源项向量** $\mathbf{S}$ 分别为：

$$
\mathbf{U} = \begin{pmatrix} h \\ hu \\ hv \end{pmatrix}, \quad \mathbf{F}(\mathbf{U}) = \begin{pmatrix} hu \\ hu^2 + \frac{1}{2}gh^2 \\ huv \end{pmatrix}, \quad \mathbf{G}(\mathbf{U}) = \begin{pmatrix} hv \\ huv \\ hv^2 + \frac{1}{2}gh^2 \end{pmatrix}, \quad \mathbf{S}(\mathbf{U}, z_b) = \begin{pmatrix} 0 \\ -gh\partial_x z_b \\ -gh\partial_y z_b \end{pmatrix}
$$

这里，各个物理量的含义如下：
- $h(x,y,t)$ 是**水深**，即水面到河床或海床的[垂直距离](@entry_id:176279)。
- $u(x,y,t)$ 和 $v(x,y,t)$ 分别是水深平均后的 $x$ 和 $y$ 方向的流速。
- $hu$ 和 $hv$ 是单位宽度的**动量**（或称为单位宽度的质量通量）。
- $g$ 是[重力加速度](@entry_id:173411)。
- $z_b(x,y)$ 是**测深**或**地形高程**，即海床相对于某个基准面的高程，通常取向上为正。

方程组的第一行是**质量守恒方程**（或连续性方程），$\partial_t h$ 表示单位面积内水体体积（即水深）的时间变化率，而 $\partial_x(hu) + \partial_y(hv)$ 描述了通过该区域边界的净质量通量。在干湿交替过程中，一个关键特性是当水深 $h \to 0$ 时，所有质量通量项都自然趋于零，这为模拟干涸过程提供了物理基础 。

方程组的第二和第三行是**动量守恒方程**。以 $x$ 方向为例，$\partial_t(hu)$ 是动量的时间变化率。通量项 $\partial_x(hu^2 + \frac{1}{2}gh^2)$ 和 $\partial_y(huv)$ 包含了动量的**平流输运**（如 $hu^2$）和由静水压力产生的**压力[梯度力](@entry_id:166847)**。其中，$\frac{1}{2}gh^2$ 是深度积分后的压力项。源项 $-gh\partial_x z_b$ 代表了因地形坡度而施加在水体上的压力分力。这个源项至关重要，因为它与压力通量梯度共同作用，以确保在**静止湖泊（lake-at-rest）**状态（即流速为零，水面持平）下力的精确平衡。

#### 定义的一致性：水深与高程基准

在上述方程中，水深 $h$ 的定义是核心：

$$
h(x,y,t) = \eta(x,y,t) - z_b(x,y)
$$

其中 $\eta(x,y,t)$ 是**自由水面高程**。这个看似简单的关系隐藏着一个至关重要的实践问题：$\eta$ 和 $z_b$ 必须在同一个**垂直基准面（vertical datum）**下进行定义。在实际的[海洋学](@entry_id:149256)应用中，数据往往来自不同来源，可能使用不同的基准面。例如，地形数据 $z_b$ 可能参考**海图基准面（Chart Datum, CD）**，而潮汐和水面高程 $\eta$ 可能参考**平均海平面（Mean Sea Level, MSL）**。

假设某区域的 MSL 比 CD 高出 $\Delta$（一个正常数），即 $z_{b,\mathrm{MSL}} = z_{b,\mathrm{CD}} + \Delta$。如果一个数值模型错误地混合使用了不同基准的数据，例如用 $\eta_{\mathrm{MSL}}$ 和 $z_{b,\mathrm{CD}}$ 来计算水深，即 $h_{\text{incorrect}} = \eta_{\mathrm{MSL}} - z_{b,\mathrm{CD}}$，会发生什么？
将 $z_{b,\mathrm{CD}}$ 转换为 MSL 基准，我们得到 $h_{\text{incorrect}} = \eta_{\mathrm{MSL}} - (z_{b,\mathrm{MSL}} - \Delta) = (\eta_{\mathrm{MSL}} - z_{b,\mathrm{MSL}}) + \Delta = h_{\text{correct}} + \Delta$。这意味着计算出的水深会系统性地比真实水深高出 $\Delta$。

考虑一个具体的例子 ：一个物理上已经干涸的单元格，其真实水深 $h_{\text{correct}} = 0$。然而，由于基准面不匹配，模型计算出的水深 $h_{\text{incorrect}}$ 可能是一个正值，甚至大于用于判断干湿状态的最小水深阈值 $\varepsilon$。这将导致模型错误地将干地判断为湿地，并允许水流进入，从而凭空制造质量，破坏模型的守恒性和稳定性。因此，任何稳健的干湿交替算法的第一步，都必须确保所有高程数据在使用前都已转换到统一的垂直基准面。

### 干湿锋面的数值挑战

**岸线（shoreline）**在物理上被定义为水体与陆地的交界，即水深 $h=0$ 的等值线。在[数值模拟](@entry_id:146043)中，这是一个移动的、不连续的锋面，它的存在给基于浅水方程的求解带来了独特的挑战。

#### 质量守恒问题

在离散的[计算网格](@entry_id:168560)上，当一个单元格从湿润变为干涸（deactivation）或从干涸变为湿润（activation）时，如何保证总水量是守恒的？这取决于数值离散的策略。

考虑**有限差分法（Finite Difference, FD）**和**[有限体积法](@entry_id:141374)（Finite Volume, FV）**两种方法 。一个朴素的[有限差分法](@entry_id:1124968)可能在每个时间步后检查水深，如果 $h  0$ 就强制将其“裁剪”为 $h=0$。当一个干单元格需要被激活时，可能会给它“播种”一个小的初始水深 $h_{\min}$。这两种操作，裁剪和播种，都是在通量计算之外对质量进行的人为修改，它们会凭空创造或销毁质量，从而破坏了系统的**质量守恒**性。

相比之下，**守恒型[有限体积法](@entry_id:141374)**在处理这个问题上具有天然的优势。在一个固定的欧拉网格上，FV方法通过计算穿过每个单元格边界的通量来更新单元格内的平均水深。一个单元格变干，是因为流出的质量通量大于流入的；一个单元格变湿，则是因为流入的质量通量大于流出的。整个过程中，一个单元格失去的质量精确地等于其邻居单元格获得的质量。只要[数值通量](@entry_id:145174)是**相容的**（即一个界面两侧的通量大小相等，方向相反），那么在整个计算域内对所有单元格的质量变化求和时，所有内部界面的通量都会相互抵消，总质量的变化仅取决于穿过计算域边界的通量。因此，在固定的FV框架下，单元格的激活与失活是质量重新分布的自然结果，不会引入虚假的质量源或汇。

#### 稳定性和动量处理

当水深 $h \to 0$ 时，浅水方程会呈现奇异性，给显式时间步长格式的稳定性带来严峻挑战 。[显式格式](@entry_id:1124773)的稳定性通常受到**Courant-Friedrichs-Lewy (CFL) 条件**的限制，该条件要求在单个时间步 $\Delta t$ 内，最快的物理信号传播距离不能超过一个网格单元的宽度 $\Delta x$。

对于浅水方程，特征信号的[传播速度](@entry_id:189384)（即通量矩阵的特征值）为 $\lambda_{\pm} = u \pm \sqrt{gh}$。因此，CFL条件要求时间步长满足：

$$
\Delta t \le \text{CFL} \cdot \min_{i} \left( \frac{\Delta x}{|u_i| + \sqrt{gh_i}} \right)
$$

其中，$\text{CFL}$ 是一个小于等于1的常数（[Courant数](@entry_id:143767)），最小值遍取所有湿润单元格 $i$。

在干湿锋面附近，当 $h_i \to 0$ 时，表面上看波速 $\sqrt{gh_i} \to 0$，似乎会放宽对 $\Delta t$ 的限制。然而，真正的危险在于流速项 $|u_i|$。流速是通过动量 $m_i = h_i u_i$ 计算的，即 $u_i = m_i/h_i$。在数值计算中，一个即将干涸的单元格可能仍保有从邻近湿润单元格输运而来的微小动量 $m_i$。当 $h_i$ 趋于零时，即使 $m_i$ 很小，其比值 $|u_i|$ 也可能变得非常大。这导致[特征速度](@entry_id:165394) $|u_i| + \sqrt{gh_i}$ 爆炸性增长，迫使 $\Delta t \to 0$，使得计算无法进行。

为了应对这一挑战，实际的干湿交替算法必须包含控制薄水层中流速的机制。一个常见的策略是引入一个**速度阈值水深** $h_{\text{vel}}$ 。当单元格的水深 $h  h_{\text{vel}}$ 时，强制将其动量（以及流速）设为零。从能量角度看，这一操作移除了该单元格的动能 $\frac{1}{2}h\|\mathbf{u}\|^2$，是一种耗散过程，不会凭空制造能量，因此是**能量相容的**。通过这种**动量重置**或“静止”策略，可以有效抑制薄水层中的非物理性加速，从而稳定[CFL条件](@entry_id:178032)，保证模拟的顺利进行。

此外，**[半隐式格式](@entry_id:1131429)**是另一种规避此问题的先进方法 。这类格式对传播速度较快的重力波项（与 $\sqrt{gh}$ 相关）进行隐式处理，从而将时间步长从重力波速中[解耦](@entry_id:160890)，使其主要受限于（通常较慢的）平流速度。

### 稳健算法的核心原则

一个成功的干湿交替算法必须内置几个核心的数学和物理原则，以确保其数值解的正确性和稳定性。

#### 正定性保持 (Positivity-Preserving)

物理上，水深 $h$ 永远不能为负。一个**正定性保持**的数值格式能够保证，如果当前时间步的所有水深 $h^n$ 均为非负，那么下一个时间步计算出的水深 $h^{n+1}$ 也将自动为非负，而无需任何事后的人为“裁剪”。

对于一个一阶有限体积格式 $h_{i}^{n+1} = h_{i}^{n} - \frac{\Delta t}{\Delta x}(F_{i+1/2}^{n} - F_{i-1/2}^{n})$，可以证明 ，要实现[正定性](@entry_id:149643)保持，需要满足两个充分条件：
1.  **通量结构**：[数值通量](@entry_id:145174)必须具有“上游”特性，即从单元格 $i$ 流出的通量（$F_{i+1/2}^{n,+}$ 和 $F_{i-1/2}^{n,-}$）应仅依赖于单元格 $i$ 的状态，并且当 $h_i^n=0$ 时，这些流出通量必须为零。
2.  **时间步限制**：时间步长 $\Delta t$ 必须足够小，以确保在一个时间步内流出单元格的总水量不超过该单元格原有的水量。具体而言，对于每个单元格 $i$：
    $$
    \Delta t \le \frac{\Delta x \cdot h_{i}^{n}}{F_{i+1/2}^{n,+} + F_{i-1/2}^{n,-}}
    $$
    其中 $F^{+}$ 和 $F^{-}$ 是对通量进行正负分解后得到的非负流出部分。

这两个条件共同确保了数值更新后的水深不会降到零以下。请注意，仅仅满足标准的CFL条件不足以保证[正定性](@entry_id:149643)，通量的具体构造方式至关重要。

#### 井平衡特性 (Well-Balanced Property)

在真实的近岸环境中，即使水体处于完全静止状态（例如，一个无风的湖泊或海湾），其水深 $h$ 由于地形 $z_b$ 的起伏也通常是不均匀的。在这种**静止湖泊**状态下，流速 $\mathbf{u}=\mathbf{0}$，自由水面高程 $\eta = h+z_b$ 是一个常数。此时，[动量方程](@entry_id:197225)简化为压力[梯度力](@entry_id:166847)与地形坡度引起的重力分力的精确平衡：

$$
\nabla \left( \frac{1}{2}gh^2 \right) = -gh\nabla z_b
$$

一个数值格式如果不能在离散层面上精确地模拟这种平衡，就会在静止的水体中产生虚假的流动，这种现象称为“数值噪音”。一个能够精确保持静止湖泊状态的格式被称为具有**井平衡特性**（或C-特性）。

实现井平衡的关键在于对动量方程中**通量梯度**和**源项**的离散化必须是耦合且一致的。如果像一些朴素格式那样，使用复杂的黎曼求解器来计算通量散度，而用一个简单的中心差分来近似源项，两者之间就会产生不匹配，从而破坏平衡。

### 现代干湿交替算法的实现机制

基于上述核心原则，现代计算海洋模型发展出了一套精密的算法来实现稳健的干湿交替模拟。

#### 单元格状态的分类

算法首先需要一个明确的规则来判断每个计算单元格是“湿”还是“干”。这不仅仅是一个简单的二元选择 。
- **几何判据**：最简单的判据是基于几何关系。如果水面高程 $\eta$ 高于地形高程 $z_b$，即 $h = \eta - z_b > 0$，则单元格被认为是湿的。这在物理上是直观的。
- **动态判据**：更复杂的动态判据旨在避免在水深极浅时遇到的数值问题。它通常引入一个**最小水深阈值** $h_{\min}$（例如 5 厘米）。
    - **湿润单元格 (Wet Cell)**：水深显著大于阈值，例如 $h > h_{\min}$，且流动状态稳定（如流速未超临界）。
    - **部分湿润单元格 (Partially Wet Cell)**：水深非常浅，例如 $0  h \le h_{\min}$，或者即使水深较大但流动已处于超临界状态（$|\mathbf{u}| > \sqrt{gh}$）。这些单元格需要特殊处理，如前面提到的动量重置策略。
    - **干涸单元格 (Dry Cell)**：水深 $h \le 0$。

通过这种多[状态分类](@entry_id:276397)，模型可以对不同状态的单元格应用不同的物理和数值规则，从而提高稳定性和准确性。

#### 先进的有限体积格式

一个先进的、井平衡且正定性保持的有限体积格式通常包含以下组件 ：

1.  **自由水面重构**：为了实现井平衡，格式不直接对可能不连续的水深 $h$ 进行重构，而是对在静止湖泊状态下平滑的**自由水面高程** $\eta$ 进行重构。
2.  **静水重构 (Hydrostatic Reconstruction)**：在计算单元格界面处的左右状态时，使用重构后的 $\eta$ 值和界面两侧地形的最大值 $z_{b, \max} = \max(z_{b,L}, z_{b,R})$ 来计算界面上的水深。例如，左侧水深为 $h_L^* = \max(0, \eta_L - z_{b, \max})$。这一步是实现井平衡和正定性保持的核心。它确保了界面上的水深非负，并且当 $\eta$ 为常数时，能够正确计算出与地形相适应的压力。
3.  **[近似黎曼求解器](@entry_id:267136) (Approximate Riemann Solver)**：使用像 HLL (Harten-Lax-van Leer) 这样的稳健求解器，根据界面两侧的重构状态（$h_{L,R}^*$, $u_{L,R}^*$, $v_{L,R}^*$）来计算穿过界面的数值通量。求解器内部需要特殊的逻辑来处理干-干、干-湿、湿-干等不同界面组合情况。
4.  **速度奇异性处理**：在从重构的动量 $hu$ 计算流速 $u$ 时，为避免除以一个极小的 $h$，通常会使用一个正则化分母，如 $u = (hu) / \max(h, \varepsilon)$，其中 $\varepsilon$ 是一个很小的正数。
5.  **耦合的源项离散**：源项的离散化与通量计算紧密耦合，使用与静水重构相一致的量，以保证井平衡性质。

#### 子单元格尺度的岸线解析

在标准的[有限体积法](@entry_id:141374)中，一个单元格要么完全湿润，要么完全干燥。对于那些被岸线部分切割的单元格，这是一种粗糙的近似。更高级的算法试图在子单元格尺度上解析岸线的位置和方向 。这可以通过引入一个**[水平集](@entry_id:751248)函数** $\phi(x,y,t) = h(x,y,t)$ 来实现。

岸线即为 $\phi=0$ 的等值线。通过在单元格内对 $\phi$ 进行线性重构（$\phi(\mathbf{x}) \approx \phi_c + \nabla \phi_c \cdot (\mathbf{x} - \mathbf{x}_c)$，其中 $\phi_c$ 和 $\nabla \phi_c$ 是单元格中心的值和梯度），我们可以在该单元格内得到一条近似的线性岸线。这条线段的[法向量](@entry_id:264185)由梯度 $\nabla \phi_c = \nabla\eta_c - \nabla z_{b,c}$ 给出，指向水深增加的方向（从干到湿）。通过计算这条线段与单元格边界的交点，可以更精确地估计湿润区域的面积和形状，从而实现更精确的通量计算，尤其适用于模拟小尺度地形上的淹没过程。

综上所述，稳健的干湿交替算法是一个多层次的系统工程，它始于对控制方程和物理定义的深刻理解，依赖于严格的数值原则如质量守恒、[正定性](@entry_id:149643)保持和井平衡特性，最终通过一系列精巧的机制如静水重构、动量重置和[状态分类](@entry_id:276397)来实现。这些原理与机制的协同工作，确保了计算海洋模型能够在复杂的潮间带环境中，准确、稳定地模拟水体的涨落、淹没与干涸过程。