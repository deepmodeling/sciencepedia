{
    "hands_on_practices": [
        {
            "introduction": "要对次中尺度锋面进行建模，首先必须从动力学上理解锋生过程，即海洋梯度（如温度或密度）如何被流场加强。锋生函数 $F$ 是一个核心诊断工具，它量化了梯度大小随流体质点运动的物质变化率。通过这个练习，你将从流体运动的基本方程出发，推导锋生函数与应变场之间的关系，并计算一个具体案例，从而将抽象的张量分析与海洋锋面演变这一关键物理过程联系起来。",
            "id": "3801116",
            "problem": "考虑海洋中一个水平二维、无粘、绝热且不可压缩的次中尺度流。设水平速度场在空间上是局部线性的，因此其在某一点的水平梯度张量为常数矩阵 $\\nabla_{h} \\mathbf{u}_{h} = \\mathbf{A} \\in \\mathbb{R}^{2 \\times 2}$。局部水平温度场也假定为线性的，$T(x,y) = T_{0} + \\alpha x + \\beta y$，其水平梯度为常数 $\\nabla_{h} T = (\\alpha, \\beta)^{\\top}$。此处，锋生函数定义为水平温度梯度量值的物质导数，$F = \\frac{D}{Dt} \\left| \\nabla_{h} T \\right|$。\n\n仅使用温度的标量平流方程 $\\frac{D T}{D t} = 0$、物质导数的定义以及将矩阵分解为其对称（应变率）和反对称（旋转率）部分的方法，推导 F 关于对称应变率张量 $\\mathbf{S} = \\frac{1}{2} \\left( \\mathbf{A} + \\mathbf{A}^{\\top} \\right)$ 和水平温度梯度 $\\nabla_{h} T$ 的精确表达式。清晰地陈述所有使用的假设。\n\n然后，在一个速度梯度张量为\n$$\n\\mathbf{A} \\;=\\; \\begin{pmatrix}\na  b - \\omega \\\\\nb + \\omega  -a\n\\end{pmatrix},\n$$\n其中 $a = 3.0 \\times 10^{-5} \\ \\mathrm{s}^{-1}$、$b = 2.0 \\times 10^{-5} \\ \\mathrm{s}^{-1}$ 和 $\\omega = 5.0 \\times 10^{-5} \\ \\mathrm{s}^{-1}$，且水平温度梯度由 $\\alpha = 2.0 \\times 10^{-4} \\ \\mathrm{K} \\ \\mathrm{m}^{-1}$ 和 $\\beta = 1.5 \\times 10^{-4} \\ \\mathrm{K} \\ \\mathrm{m}^{-1}$ 给出的点上，计算你的表达式的值。\n\n将 F 的最终数值以 $\\mathrm{K} \\ \\mathrm{m}^{-1} \\ \\mathrm{s}^{-1}$ 为单位表示，并将答案四舍五入至三位有效数字。",
            "solution": "该问题经检验具有科学依据、提法恰当且客观。这是一个关于锋生过程的地球物理流体动力学标准问题。所有必要信息均已提供，给定的物理参数一致且符合实际。因此，我们可以着手求解。\n\n问题文本中陈述或隐含的关键假设是：\n1.  流动是水平二维、无粘、绝热且不可压缩的。二维流的不可压缩条件 $\\nabla_{h} \\cdot \\mathbf{u}_{h} = 0$ 意味着速度梯度张量 $\\mathbf{A}$ 的迹必须为零，给定矩阵的结构满足此条件。\n2.  绝热条件意味着温度 $T$ 跟随流体质点守恒，这表示为其物质导数为零：$\\frac{DT}{Dt} = 0$。\n3.  水平速度场 $\\mathbf{u}_{h}$ 和温度场 $T$ 在水平坐标 $(x,y)$ 上是局部线性的。这意味着它们各自的梯度 $\\nabla_{h} \\mathbf{u}_{h} = \\mathbf{A}$ 和 $\\nabla_{h} T = \\mathbf{g}$ 在所关注的局部区域内是常数。\n4.  温度梯度的量值不为零，即 $|\\nabla_h T| \\neq 0$。\n\n锋生函数 F 定义为水平温度梯度向量 $\\mathbf{g} = \\nabla_h T$ 量值的物质导数。我们用 G 表示其量值，$G = |\\mathbf{g}| = |\\nabla_h T|$。\n$$\nF = \\frac{D G}{D t} = \\frac{D}{D t} |\\nabla_{h} T|\n$$\n我们可以将量值的平方表示为 $G^2 = \\mathbf{g} \\cdot \\mathbf{g} = g_i g_i$。对 $G^2$求物质导数：\n$$\n\\frac{D}{Dt}(G^2) = \\frac{D}{Dt}(\\mathbf{g} \\cdot \\mathbf{g}) = \\frac{D\\mathbf{g}}{Dt} \\cdot \\mathbf{g} + \\mathbf{g} \\cdot \\frac{D\\mathbf{g}}{Dt} = 2 \\mathbf{g} \\cdot \\frac{D\\mathbf{g}}{Dt}\n$$\n另外，根据链式法则，$\\frac{D}{Dt}(G^2) = 2G \\frac{DG}{Dt} = 2G F$。\n令两个表达式相等，得到：\n$$\n2G F = 2 \\mathbf{g} \\cdot \\frac{D\\mathbf{g}}{Dt} \\implies F = \\frac{1}{G} \\left(\\mathbf{g} \\cdot \\frac{D\\mathbf{g}}{Dt}\\right) = \\frac{\\mathbf{g}}{|\\mathbf{g}|^2} \\cdot \\frac{D\\mathbf{g}}{Dt}\n$$\n下一步是找到 $\\frac{D\\mathbf{g}}{Dt} = \\frac{D(\\nabla_h T)}{Dt}$ 的表达式。我们使用物质导数和梯度算符交换的标准恒等式：\n$$\n\\frac{D}{Dt}(\\nabla_h T) = \\nabla_h \\left(\\frac{DT}{Dt}\\right) - (\\nabla_h \\mathbf{u}_h)^{\\top} (\\nabla_h T)\n$$\n根据绝热假设，$\\frac{DT}{Dt} = 0$，因此 $\\nabla_h(\\frac{DT}{Dt}) = 0$。表达式简化为：\n$$\n\\frac{D\\mathbf{g}}{Dt} = -(\\nabla_h \\mathbf{u}_h)^{\\top} \\mathbf{g}\n$$\n使用问题中的符号，$\\nabla_h \\mathbf{u}_h = \\mathbf{A}$，我们有：\n$$\n\\frac{D\\mathbf{g}}{Dt} = -\\mathbf{A}^{\\top} \\mathbf{g}\n$$\n将此代回 F 的表达式中：\n$$\nF = \\frac{1}{|\\mathbf{g}|} (\\mathbf{g} \\cdot (-\\mathbf{A}^{\\top} \\mathbf{g}))\n$$\n这个点积可以用转置符号写成二次型：$\\mathbf{x} \\cdot (\\mathbf{M} \\mathbf{y}) = \\mathbf{x}^{\\top} \\mathbf{M} \\mathbf{y}$。所以，\n$$\nF = -\\frac{\\mathbf{g}^{\\top} \\mathbf{A}^{\\top} \\mathbf{g}}{|\\mathbf{g}|}\n$$\n问题要求用对称应变率张量 $\\mathbf{S}$ 来表示该表达式。我们将速度梯度张量 $\\mathbf{A}$ 分解为其对称部分 $\\mathbf{S}$ 和反对称部分 $\\mathbf{\\Omega}$（旋转率张量）：\n$$\n\\mathbf{A} = \\mathbf{S} + \\mathbf{\\Omega}, \\quad \\text{其中} \\quad \\mathbf{S} = \\frac{1}{2}(\\mathbf{A} + \\mathbf{A}^{\\top}) \\quad \\text{和} \\quad \\mathbf{\\Omega} = \\frac{1}{2}(\\mathbf{A} - \\mathbf{A}^{\\top})\n$$\n对 $\\mathbf{A}$ 取转置得到 $\\mathbf{A}^{\\top} = \\mathbf{S}^{\\top} + \\mathbf{\\Omega}^{\\top}$。根据定义，$\\mathbf{S}$ 是对称的（$\\mathbf{S}^{\\top} = \\mathbf{S}$），$\\mathbf{\\Omega}$ 是反对称的（$\\mathbf{\\Omega}^{\\top} = -\\mathbf{\\Omega}$）。因此，$\\mathbf{A}^{\\top} = \\mathbf{S} - \\mathbf{\\Omega}$。\n将此代入 F 的表达式中：\n$$\nF = -\\frac{\\mathbf{g}^{\\top} (\\mathbf{S} - \\mathbf{\\Omega}) \\mathbf{g}}{|\\mathbf{g}|} = -\\frac{\\mathbf{g}^{\\top} \\mathbf{S} \\mathbf{g} - \\mathbf{g}^{\\top} \\mathbf{\\Omega} \\mathbf{g}}{|\\mathbf{g}|}\n$$\n对于任意向量 $\\mathbf{x}$ 和任意反对称矩阵 $\\mathbf{M}$，二次型 $\\mathbf{x}^{\\top} \\mathbf{M} \\mathbf{x}$ 恒为零。这是因为 $(\\mathbf{x}^{\\top} \\mathbf{M} \\mathbf{x})^{\\top} = \\mathbf{x}^{\\top} \\mathbf{M}^{\\top} \\mathbf{x} = \\mathbf{x}^{\\top} (-\\mathbf{M}) \\mathbf{x} = -(\\mathbf{x}^{\\top} \\mathbf{M} \\mathbf{x})$。因为该量是一个标量且等于其相反数，所以它必须为零。因此，$\\mathbf{g}^{\\top} \\mathbf{\\Omega} \\mathbf{g} = 0$。\n\n锋生函数关于应变率张量和温度梯度的最终表达式为：\n$$\nF = -\\frac{\\mathbf{g}^{\\top} \\mathbf{S} \\mathbf{g}}{|\\mathbf{g}|} = -\\frac{(\\nabla_{h} T)^{\\top} \\mathbf{S} (\\nabla_{h} T)}{|\\nabla_{h} T|}\n$$\n这个结果表明，锋生是由应变场驱动的，而不是由流动的旋转部分驱动的。\n\n现在，我们用给定的参数来计算这个表达式。速度梯度张量为：\n$$\n\\mathbf{A} \\;=\\; \\begin{pmatrix}\na  b - \\omega \\\\\nb + \\omega  -a\n\\end{pmatrix}\n$$\n对称应变率张量 $\\mathbf{S}$ 为：\n$$\n\\mathbf{S} = \\frac{1}{2}(\\mathbf{A} + \\mathbf{A}^{\\top}) = \\frac{1}{2} \\left( \\begin{pmatrix} a  b - \\omega \\\\ b + \\omega  -a \\end{pmatrix} + \\begin{pmatrix} a  b + \\omega \\\\ b - \\omega  -a \\end{pmatrix} \\right) = \\frac{1}{2} \\begin{pmatrix} 2a  2b \\\\ 2b  -2a \\end{pmatrix} = \\begin{pmatrix} a  b \\\\ b  -a \\end{pmatrix}\n$$\n水平温度梯度为 $\\mathbf{g} = (\\alpha, \\beta)^{\\top}$。F 的分子中的二次型为：\n$$\n\\mathbf{g}^{\\top} \\mathbf{S} \\mathbf{g} = \\begin{pmatrix} \\alpha  \\beta \\end{pmatrix} \\begin{pmatrix} a  b \\\\ b  -a \\end{pmatrix} \\begin{pmatrix} \\alpha \\\\ \\beta \\end{pmatrix} = \\begin{pmatrix} a\\alpha + b\\beta  b\\alpha - a\\beta \\end{pmatrix} \\begin{pmatrix} \\alpha \\\\ \\beta \\end{pmatrix} = a\\alpha^2 + b\\alpha\\beta + b\\alpha\\beta - a\\beta^2 = a(\\alpha^2 - \\beta^2) + 2b\\alpha\\beta\n$$\n梯度的量值为 $|\\mathbf{g}| = \\sqrt{\\alpha^2 + \\beta^2}$。\n所以，F 的具体表达式为：\n$$\nF = - \\frac{a(\\alpha^2 - \\beta^2) + 2b\\alpha\\beta}{\\sqrt{\\alpha^2 + \\beta^2}}\n$$\n我们已知的数值为：\n$a = 3.0 \\times 10^{-5} \\ \\mathrm{s}^{-1}$\n$b = 2.0 \\times 10^{-5} \\ \\mathrm{s}^{-1}$\n$\\alpha = 2.0 \\times 10^{-4} \\ \\mathrm{K} \\ \\mathrm{m}^{-1}$\n$\\beta = 1.5 \\times 10^{-4} \\ \\mathrm{K} \\ \\mathrm{m}^{-1}$\n（注意，$\\omega$ 的值是不需要的，因为旋转对锋生没有贡献。）\n\n让我们计算各项：\n$\\alpha^2 = (2.0 \\times 10^{-4})^2 = 4.0 \\times 10^{-8} \\ \\mathrm{K}^2 \\mathrm{m}^{-2}$\n$\\beta^2 = (1.5 \\times 10^{-4})^2 = 2.25 \\times 10^{-8} \\ \\mathrm{K}^2 \\mathrm{m}^{-2}$\n$\\alpha^2 - \\beta^2 = (4.0 - 2.25) \\times 10^{-8} = 1.75 \\times 10^{-8} \\ \\mathrm{K}^2 \\mathrm{m}^{-2}$\n$\\alpha\\beta = (2.0 \\times 10^{-4})(1.5 \\times 10^{-4}) = 3.0 \\times 10^{-8} \\ \\mathrm{K}^2 \\mathrm{m}^{-2}$\n\n分子项为：\n$a(\\alpha^2 - \\beta^2) + 2b\\alpha\\beta = (3.0 \\times 10^{-5})(1.75 \\times 10^{-8}) + 2(2.0 \\times 10^{-5})(3.0 \\times 10^{-8})$\n$= 5.25 \\times 10^{-13} + 12.0 \\times 10^{-13} = 17.25 \\times 10^{-13} \\ \\mathrm{K}^2 \\mathrm{m}^{-2} \\mathrm{s}^{-1}$\n\n分母项为：\n$\\sqrt{\\alpha^2 + \\beta^2} = \\sqrt{4.0 \\times 10^{-8} + 2.25 \\times 10^{-8}} = \\sqrt{6.25 \\times 10^{-8}} = 2.5 \\times 10^{-4} \\ \\mathrm{K} \\mathrm{m}^{-1}$\n\n最后，我们计算 F：\n$$\nF = - \\frac{17.25 \\times 10^{-13} \\ \\mathrm{K}^2 \\mathrm{m}^{-2} \\mathrm{s}^{-1}}{2.5 \\times 10^{-4} \\ \\mathrm{K} \\mathrm{m}^{-1}} = -6.9 \\times 10^{-9} \\ \\mathrm{K} \\ \\mathrm{m}^{-1} \\ \\mathrm{s}^{-1}\n$$\n问题要求将答案四舍五入至三位有效数字。精确答案是 $-6.9 \\times 10^{-9}$。表示为三位有效数字，即为 $-6.90 \\times 10^{-9}$。",
            "answer": "$$\n\\boxed{-6.90 \\times 10^{-9}}\n$$"
        },
        {
            "introduction": "在掌握了锋生的核心物理机制之后，下一步便是将这些理论知识转化为实际的数值模型设置。一个成功的模拟不仅依赖于正确的物理方程，同样取决于合理的数值参数选择，如网格分辨率和时间步长。本练习将指导你如何基于无量纲数（如弗劳德数 $Fr$）和数值稳定性准则（如CFL条件），为非静力平衡锋面模型系统地确定必要的空间分辨率和稳定的时间步长。",
            "id": "3801124",
            "problem": "要求您为一个稳定分层的海洋混合层中的一个尖锐的表层锋建立一个有理论依据的非静力数值模型设置。您的任务是，从第一性原理出发，为一个能够解析平流和内波、不可压缩、Boussinesq、非静力的求解器，确定合适的水平网格分辨率、垂直离散化方案以及一个稳定的显式时间步长。推导必须从不可压缩 Boussinesq 动量和连续性方程、Froude 数的定义，以及基于 Courant–Friedrichs–Lewy (CFL) 条件的、经过充分检验的稳定性约束开始。您必须提供一个量化流程，该流程使用 Froude 数来论证分辨率的选择，并使用 CFL 约束来选择最大稳定时间步长。所有结果必须使用物理上一致的标度来表示，并且必须能够通过参考基本方程和均匀分层流体中的线性内波理论来得到合理解释。\n\n您必须使用的基本依据包括：\n- 包含非静力压力的不可压缩 Boussinesq 动量方程，其中加速度、科里奥利力、压力梯度和浮力进入动力学系统。\n- 不可压缩流的连续性方程，以及平流和扩散作用下的浮力示踪剂方程。\n- Froude 数 $Fr$ 的定义，即基于混合层深度和特征水平速度的平流时间尺度与分层时间尺度之比，也即 $Fr$ 比较 $U$ 和 $NH$。\n- 深度为 $H$ 的均匀分层流体中线性内重力波模态的存在及其特征模态速度，用于约束解析波浪的模型的显式时间步长。\n- 显式格式的 Courant–Friedrichs–Lewy (CFL) 条件，通过平流和波传播速度来约束时间步长。\n\n您的程序必须为每个测试案例实现以下总体任务：\n1. 使用给定的特征速度 $U$、浮力频率 $N$ 和混合层深度 $H$ 计算 Froude 数 $Fr$。\n2. 选择一个水平网格间距，该间距能够解析锋面宽度和一个由基本平衡推导出的、受分层控制的平流长度尺度，而不依赖于流体动力学的简化方法。该分辨率必须由以下要求来证明其合理性：当 $Fr$ 不是渐近小时，需要表示显著的尖锐水平梯度和非地转运动。\n3. 选择一个垂直网格间距，该间距足以解析深度为 $H$ 的均匀分层中第一斜压模态内重力波的结构，以最小化数值色散并解析与锋面动力学相关的垂直切变。\n4. 计算受水平和垂直平流 CFL 条件以及水平内重力波传播约束的最大稳定显式时间步长。\n5. 为每个测试案例返回一个紧凑的摘要，其中包含计算出的 $Fr$、推荐的水平网格间距、推荐的垂直网格间距、最大稳定时间步长，以及表明所选时间步长是否满足平流和重力波 CFL 约束的布尔值。\n\n物理单位和格式要求：\n- 所有长度以米表示，所有时间以秒表示。\n- 所有角度（如果出现）以弧度表示，但本任务中不需要角度。\n- 无量纲量以普通小数表示。\n- 所有浮点输出四舍五入到六位小数。\n- 布尔值必须是字面量 `True` 或 `False`。\n\n测试套件：\n为覆盖不同的动力学机制和约束，请将您的推导和算法应用于以下参数集，每个参数集描述了均匀分层混合层中的一个表层增强锋：\n\n- 案例 A（一般次中尺度锋）：\n  - 特征水平速度 $U = 0.50 \\,\\mathrm{m\\,s^{-1}}$\n  - 特征垂直速度 $W = 0.010 \\,\\mathrm{m\\,s^{-1}}$\n  - 浮力频率 $N = 1.0\\times 10^{-2} \\,\\mathrm{s^{-1}}$\n  - 混合层深度 $H = 100 \\,\\mathrm{m}$\n  - 科里奥利参数 $f = 1.0\\times 10^{-4} \\,\\mathrm{s^{-1}}$\n  - 锋面宽度（密度梯度尺度） $L_f = 2000 \\,\\mathrm{m}$\n  - 允许的 Courant 数 $C = 0.50$\n\n- 案例 B（狭窄、较弱的锋）：\n  - $U = 0.20 \\,\\mathrm{m\\,s^{-1}}$，$W = 0.005 \\,\\mathrm{m\\,s^{-1}}$，$N = 5.0\\times 10^{-3} \\,\\mathrm{s^{-1}}$，$H = 50 \\,\\mathrm{m}$，$f = 1.0\\times 10^{-4} \\,\\mathrm{s^{-1}}$，$L_f = 500 \\,\\mathrm{m}$，$C = 0.70$\n\n- 案例 C（具有强分层的非常尖锐的锋）：\n  - $U = 0.60 \\,\\mathrm{m\\,s^{-1}}$，$W = 0.030 \\,\\mathrm{m\\,s^{-1}}$，$N = 1.5\\times 10^{-2} \\,\\mathrm{s^{-1}}$，$H = 30 \\,\\mathrm{m}$，$f = 8.0\\times 10^{-5} \\,\\mathrm{s^{-1}}$，$L_f = 200 \\,\\mathrm{m}$，$C = 0.40$\n\n对于分辨率充分性目标，请使用以下必须在您的算法中编码并您的解决方案中证明其合理性的最小离散化标准：\n- 水平方向上，锋面宽度 $L_f$ 内至少有 $n_f = 10$ 个网格点。\n- 由 $U$ 和 $N$ 设定的受分层控制的平流长度尺度内至少有 $n_b = 6$ 个网格点。\n- 至少有 $s_z = 20$ 个垂直网格点解析深度 $H$，以表示第一斜压模态形状和垂直切变。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个以逗号分隔的列表形式的结果，该列表被方括号包围，其中每个元素对应一个测试案例，并且本身是以下形式的列表：\n$[Fr,\\;dx,\\;dz,\\;dt,\\;\\text{advective\\_CFL\\_ok},\\;\\text{gravitywave\\_CFL\\_ok}]$\n所有浮点值必须四舍五入到六位小数。例如，最终打印的行必须如下所示：\n`[[Fr_A,dx_A,dz_A,dt_A,advective_A,gravity_A],[Fr_B,dx_B,dz_B,dt_B,advective_B,gravity_B],[Fr_C,dx_C,dz_C,dt_C,advective_C,gravity_C]]`",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上植根于地球物理流体动力学原理，其参数集完整且一致，问题设定良好，并且其表述是客观的。任务是推导并实现一个量化流程，用于为模拟海洋锋建立数值模型配置。这涉及到从第一性原理确定网格分辨率和稳定的时间步长。\n\n分析始于不可压缩 Boussinesq 方程，该方程控制着分层流体的运动，其中密度变化很小，除非其对浮力有贡献。在旋转参考系中，动量方程为：\n$$\n\\frac{D\\mathbf{u}}{Dt} + f \\mathbf{k} \\times \\mathbf{u} = -\\frac{1}{\\rho_0} \\nabla p' + b \\mathbf{k}\n$$\n其中 $\\mathbf{u} = (u, v, w)$ 是速度矢量，$f$ 是科里奥利参数，$\\mathbf{k}$ 是垂直单位矢量，$\\rho_0$ 是一个常参考密度，$p'$ 是非静力压力扰动，$b = -g(\\rho - \\rho_0)/\\rho_0$ 是浮力。物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。该系统由不可压缩流的连续性方程 $\\nabla \\cdot \\mathbf{u} = 0$ 和浮力守恒方程 $\\frac{Db}{Dt} = 0$（为进行标度分析，忽略显式扩散）封闭。背景分层由浮力频率 $N$ 量化，对于处于静力平衡的背景状态，其定义为 $N^2 = \\frac{\\partial b}{\\partial z}$。\n\n确定数值参数的流程如下：\n\n**1. Froude 数计算**\n\n内 Froude 数 $Fr$ 比较了特征水平速度 $U$ 与长内重力波的速度（其尺度与 $NH$ 相当）。这个无量纲数表明了分层在抵抗由流动引起的垂直运动中的重要性。其定义为：\n$$\nFr = \\frac{U}{NH}\n$$\n其中 $U$ 是特征水平速度，$N$ 是浮力频率，$H$ 是混合层深度。量级为 1 或更大的 Froude 数表明，流动能量足以克服分层的恢复力，导致显著的非地转运动和潜在的混合。\n\n**2. 水平网格间距 ($\\Delta x$)**\n\n水平分辨率必须足够精细，以解析关键的物理过程和梯度。问题指定了两个需要解析的关键长度尺度。\n\n首先，锋区本身，其特征为密度梯度尺度长度 $L_f$，必须得到良好表示。为了捕捉锋的结构，我们要求在该宽度上至少有 $n_f = 10$ 个网格点。这对网格间距 $\\Delta x$ 施加了一个约束：\n$$\n\\Delta x \\le \\frac{L_f}{n_f} = \\frac{L_f}{10}\n$$\n\n其次，对于 Froude 数不可忽略的流动，非地转动力学变得重要。一个基本的长度尺度来自于平衡水平平流与分层的恢复力。分层起作用的时间尺度是浮力频率的倒数，$T_N = 1/N$。在此时间内，一个以速度 $U$ 移动的流体质点行进的水平距离为 $L_b = U/N$。这个“受分层控制的平流长度尺度”也必须被解析，以准确捕捉如锋生和垂直环流等过程。问题要求在该尺度上至少有 $n_b = 6$ 个网格点，从而得出约束：\n$$\n\\Delta x \\le \\frac{L_b}{n_b} = \\frac{U}{6N}\n$$\n\n为了同时满足这两个标准，水平网格间距 $\\Delta x$ 必须选择为两个上限中的最小值：\n$$\n\\Delta x = \\min\\left(\\frac{L_f}{10}, \\frac{U}{6N}\\right)\n$$\n\n科里奥利参数 $f$ 定义了内 Rossby 变形半径 $L_R = NH/f$，它设定了地转平衡的尺度。所提供的案例描述了次中尺度锋，其中 $L_f  L_R$ 且 Rossby 数 $Ro = U/(fL_f)$ 的量级为 1 或更大，这证明了在确定分辨率时，应关注非地转尺度（$L_b$）而非地转尺度（$L_R$）是合理的。\n\n**3. 垂直网格间距 ($\\Delta z$)**\n\n垂直网格间距必须能解析流动和内波的垂直结构。在深度为 $H$ 的均匀分层中，最低阶（$m=1$）斜压模态的内波具有与 $\\sin(\\pi z / H)$ 成正比的垂直结构。对这个半正弦波结构的充分解析对于最小化数值色散和精确表示垂直切变至关重要。问题要求在深度 $H$ 上至少有 $s_z = 20$ 个网格点，这直接导出了垂直网格间距 $\\Delta z$ 的定义：\n$$\n\\Delta z = \\frac{H}{s_z} = \\frac{H}{20}\n$$\n\n**4. 最大稳定时间步长 ($\\Delta t$)**\n\n对于显式时间步进格式，时间步长 $\\Delta t$ 受到 Courant–Friedrichs–Lewy (CFL) 条件的限制，该条件确保信息在单个时间步内不会传播超过一个网格单元。我们必须考虑所有相关的传播速度：平流和内重力波。一般条件是 $\\Delta t \\le C \\cdot (\\text{特征时间})$，其中 $C$ 是 Courant 数。\n\na. **平流约束：** 流体分别在水平和垂直方向上以速度 $U$ 和 $W$ 平流示踪剂和动量。这给出了两个约束：\n   - 水平平流： $\\Delta t_{adv,x} \\le C \\frac{\\Delta x}{U}$\n   - 垂直平流： $\\Delta t_{adv,z} \\le C \\frac{\\Delta z}{W}$\n\nb. **内重力波约束：** 一个非静力模型解析内重力波的全谱。传播最快的信号设定了最严格的稳定性限制。在深度为 $H$ 的均匀分层流体中，内重力波的最大速度对应于长波极限下（$k_h \\to 0$）第一斜压模态（$m=1$）的相速度。该速度由下式给出：\n$$\nc_{gw,max} = \\frac{NH}{\\pi}\n$$\n在水平网格上相应的 CFL 约束是：\n$$\n\\Delta t_{gw} \\le C \\frac{\\Delta x}{c_{gw,max}} = C \\frac{\\pi \\Delta x}{NH}\n$$\n\n最终的、全局稳定的时间步长 $\\Delta t$ 必须是所有这些约束中的最小值，以确保相对于所有被解析过程的数值稳定性：\n$$\n\\Delta t = \\min\\left( C \\frac{\\Delta x}{U}, C \\frac{\\Delta z}{W}, C \\frac{\\pi \\Delta x}{NH} \\right)\n$$\n\n**5. 验证布尔值**\n\n最终要求的输出是两个布尔标志，`advective_CFL_ok` 和 `gravitywave_CFL_ok`。这些标志用于确认计算出的时间步长 $\\Delta t$ 满足各自的稳定性条件。通过将 $\\Delta t$ 定义为所有约束时间尺度中的最小值，从构造上就保证了两个条件都得到满足。因此，两个布尔值都将评估为 `True`。它们作为对计算的逻辑自洽性检查。\n\n这个基于第一性原理的流程为每个测试案例生成了一套完整的数值参数（$Fr, \\Delta x, \\Delta z, \\Delta t$），这些参数直接从分层流动的基本物理学和标准数值稳定性理论中推导出来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes numerical model parameters for simulating oceanic fronts based on\n    physical principles and stability constraints.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (general submesoscale front)\n        {'U': 0.50, 'W': 0.010, 'N': 1.0e-2, 'H': 100.0, 'f': 1.0e-4, 'L_f': 2000.0, 'C': 0.50, 'n_f': 10, 'n_b': 6, 's_z': 20},\n        # Case B (narrow, weaker front)\n        {'U': 0.20, 'W': 0.005, 'N': 5.0e-3, 'H': 50.0, 'f': 1.0e-4, 'L_f': 500.0, 'C': 0.70, 'n_f': 10, 'n_b': 6, 's_z': 20},\n        # Case C (very sharp front with strong stratification)\n        {'U': 0.60, 'W': 0.030, 'N': 1.5e-2, 'H': 30.0, 'f': 8.0e-5, 'L_f': 200.0, 'C': 0.40, 'n_f': 10, 'n_b': 6, 's_z': 20},\n    ]\n\n    results = []\n    for case in test_cases:\n        U = case['U']\n        W = case['W']\n        N = case['N']\n        H = case['H']\n        L_f = case['L_f']\n        C = case['C']\n        n_f = case['n_f']\n        n_b = case['n_b']\n        s_z = case['s_z']\n\n        # 1. Compute the Froude number Fr\n        # Fr = U / (N * H)\n        fr = U / (N * H)\n\n        # 2. Choose horizontal grid spacing dx\n        # Constraint from frontal width Lf\n        dx_f = L_f / n_f\n        # Constraint from stratification-controlled advective length scale U/N\n        dx_b = U / (n_b * N)\n        # Choose the more restrictive (smaller) grid spacing\n        dx = min(dx_f, dx_b)\n\n        # 3. Choose vertical grid spacing dz\n        # Constraint from resolving the first baroclinic mode structure\n        dz = H / s_z\n\n        # 4. Compute maximum stable explicit time step dt\n        # Constraint from horizontal advection\n        dt_adv_x = C * dx / U\n        # Constraint from vertical advection\n        dt_adv_z = C * dz / W\n        \n        # Aggregate advective constraint limit\n        dt_adv_limit = min(dt_adv_x, dt_adv_z)\n        \n        # Constraint from internal gravity wave propagation\n        # Max wave speed c_gw_max = N * H / pi\n        c_gw_max = (N * H) / np.pi\n        dt_gw_limit = C * dx / c_gw_max\n        \n        # Final time step is the minimum of all constraints\n        dt = min(dt_adv_limit, dt_gw_limit)\n        \n        # 5. Check if the final dt satisfies the constraints\n        # By construction, dt will be less than or equal to both limits.\n        advective_cfl_ok = dt = dt_adv_limit\n        gravitywave_cfl_ok = dt = dt_gw_limit\n\n        # Round all floating point outputs to six decimal places\n        current_result = [\n            round(fr, 6),\n            round(dx, 6),\n            round(dz, 6),\n            round(dt, 6),\n            advective_cfl_ok,\n            gravitywave_cfl_ok\n        ]\n        results.append(current_result)\n\n    # Format the final output string as a list of lists representation\n    # The default str() for a list includes spaces, which is consistent\n    # with the provided `print` statement template.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "即使是精心设计的数值模型，其离散化方案本身也会不可避免地引入误差，这些误差有时会表现为非物理的“伪混合”。对于旨在精确模拟次中尺度过程中物质输运和混合的研究而言，量化和理解这种数值混合至关重要。本练习提供了一种基于物理第一性原理的方法，通过计算示踪剂场的熵增和有效扩散率，来评估和比较不同数值平流方案所产生的伪混合，这是模型验证和评估中的一项高级但关键的技能。",
            "id": "3801164",
            "problem": "您的任务是量化在不可压缩、周期性的亚中尺度类流中模拟被动示踪剂时，由数值平流格式引入的伪混合。从由平流扩散方程和不可压缩性约束控制的被动示踪剂守恒律开始：$$\\frac{\\partial C}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla C = \\kappa \\nabla^2 C,\\quad \\nabla\\cdot\\boldsymbol{u} = 0,$$ 其中 $C(x,y,t)$ 是示踪剂浓度，$\\boldsymbol{u}(x,y)$ 是速度场，$\\kappa$ 是分子扩散率。在理想极限 $\\kappa = 0$ 下，平流是可逆的，并保守信息含量和示踪剂方差。然而，数值离散化和插值通常会产生模仿 $\\kappa > 0$ 的不可逆混合；您的目标是使用从第一性原理推导出的两种诊断量来量化这种伪混合。\n\n定义以下域、流场和初始条件，以模拟亚中尺度锋面搅拌：\n\n- 一个边长为 $L$ 米的方形周期性域，坐标为 $(x,y)\\in[0,L)\\times[0,L)$。\n- 一个由流函数定义的稳定、周期性、不可压缩的 Taylor–Green 涡 (TGV) 流：$$\\psi(x,y) = \\frac{U_0 L}{2\\pi}\\sin\\left(\\frac{2\\pi x}{L}\\right)\\sin\\left(\\frac{2\\pi y}{L}\\right),$$ 其速度为 $$u(x,y) = \\frac{\\partial \\psi}{\\partial y} = U_0 \\sin\\left(\\frac{2\\pi x}{L}\\right)\\cos\\left(\\frac{2\\pi y}{L}\\right),\\quad v(x,y) = -\\frac{\\partial \\psi}{\\partial x} = -U_0 \\cos\\left(\\frac{2\\pi x}{L}\\right)\\sin\\left(\\frac{2\\pi y}{L}\\right).$$ 这种周期性的拉伸和旋转流是亚中尺度搅拌的标准理想化模型。\n- 一个由下式给出的锋面状、周期性初始示踪剂：$$C_0(x,y) = \\frac{1}{2}\\left[1 + \\tanh\\left(\\beta \\cos\\left(\\frac{2\\pi y}{L}\\right)\\right)\\right],$$ 其中 $\\beta> 0$ 控制锋面的锐度。这会在 $y$ 方向上产生两个交替的带状区域，具有类似锋面的陡峭梯度，并且是严格周期性的。\n\n在数值实验的控制方程中设置 $\\kappa=0$（纯平流），并使用一个半拉格朗日时间步进格式，该格式使用稳定速度沿轨迹将网格点回溯 $\\Delta t$。半拉格朗日更新将每个网格点 $(x,y)$ 映射到一个出发点 $(x',y') = \\left(x - u(x,y)\\Delta t,\\; y - v(x,y)\\Delta t\\right)$（周期性地包裹到 $[0,L)$ 内），并通过从 $(x',y')$ 插值 $C$ 来更新 $(x,y)$ 处的 $C$。使用两种插值配置：双线性周期性插值和最近邻周期性插值。双线性格式通常会平滑，因此混合更多；最近邻格式保留了分段值，但仍因面积扭曲和重映射而产生混合。\n\n从第一性原理出发，定义两种在每个时间 $t$ 计算的伪混合诊断量：\n\n1. 基于示踪剂的类玻尔兹曼熵密度的不可逆熵产生率：$$S(t) = -\\frac{1}{A}\\int_{A} C(x,y,t)\\,\\ln\\left(C(x,y,t)\\right)\\,\\mathrm{d}A,$$ 其中 $A=L^2$ 且使用自然对数。在具有完全保守数值格式的理想平流极限下，$\\mathrm{d}S/\\mathrm{d}t = 0$。数值引起的混合通常会增加 $S$。将平均不可逆熵产生率（单位为 $\\mathrm{s}^{-1}$）估计为时间平均值：$$\\overline{\\sigma_S} = \\frac{1}{T-\\Delta t}\\int_{\\Delta t}^{T} \\frac{S(t) - S(t-\\Delta t)}{\\Delta t}\\,\\mathrm{d}t,$$ 使用在长度为 $T$ 的模拟时间窗口上的有限差分进行离散化。\n2. 示踪剂方差衰减及相应的有效扩散率。定义空间平均值：$$\\overline{C}(t) = \\frac{1}{A}\\int_A C(x,y,t)\\,\\mathrm{d}A,$$ 和方差：$$\\mathrm{Var}(t) = \\frac{1}{A}\\int_A \\left(C(x,y,t) - \\overline{C}(t)\\right)^2\\,\\mathrm{d}A.$$ 在 $\\kappa = 0$ 和精确平流的连续介质中，$\\mathrm{Var}(t)$ 是守恒的。有扩散时，一个标准结果是：$$\\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t} = -2\\kappa \\frac{1}{A}\\int_A \\left|\\nabla C\\right|^2\\,\\mathrm{d}A,$$ 其中 $\\left|\\nabla C\\right|^2 = \\left(\\frac{\\partial C}{\\partial x}\\right)^2 + \\left(\\frac{\\partial C}{\\partial y}\\right)^2$。在仅有平流（$\\kappa=0$）的运行中，通过代入测得的 $\\mathrm{d}\\,\\mathrm{Var}/\\mathrm{d}t$，将此关系用作有效数值扩散率的定义：$$\\kappa_{\\mathrm{eff}}(t) = -\\frac{\\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t}}{2\\,\\Gamma(t)},\\quad \\Gamma(t) = \\frac{1}{A}\\int_A \\left|\\nabla C(x,y,t)\\right|^2\\,\\mathrm{d}A.$$ 通过对 $\\kappa_{\\mathrm{eff}}(t)$ 进行时间平均，估计平均有效扩散率 $\\overline{\\kappa}_{\\mathrm{eff}}$（单位为 $\\mathrm{m}^2/\\mathrm{s}$）。同时报告由下式定义的平均相对方差衰减率（单位为 $\\mathrm{s}^{-1}$）：$$\\overline{r_{\\mathrm{var}}} = \\frac{1}{T-\\Delta t}\\int_{\\Delta t}^{T} \\frac{\\mathrm{Var}(t) - \\mathrm{Var}(t-\\Delta t)}{\\mathrm{Var}(t-\\Delta t)\\,\\Delta t}\\,\\mathrm{d}t.$$\n\n实现以下内容：\n\n- 所有三角函数均使用弧度角。\n- 所有量均使用物理单位米和秒。将 $\\overline{\\kappa}_{\\mathrm{eff}}$ 表示为 $\\mathrm{m}^2/\\mathrm{s}$，将 $\\overline{\\sigma_S}$ 和 $\\overline{r_{\\mathrm{var}}}$ 表示为 $\\mathrm{s}^{-1}$。\n- 使用 $N\\times N$ 个点（方形网格）、均匀间距 $\\Delta x = \\Delta y = L/N$ 和周期性边界条件来离散化域。\n- 根据指定的格式，使用带有回溯位置 $(x',y')$ 和周期性插值的半拉格朗日步进。\n- 通过在模拟窗口上进行离散时间平均，计算 $\\overline{\\sigma_S}$、$\\overline{\\kappa}_{\\mathrm{eff}}$ 和 $\\overline{r_{\\mathrm{var}}}$。\n\n测试套件和参数集：\n\n设 $L = 10^4$ 米，$U_0 = 0.2$ 米/秒，$\\beta = 5$，$\\Delta t = 50$ 秒，总模拟时间 $T = 18{,}000$ 秒。评估以下四种情况：\n\n1. 双线性周期性插值, $N = 128$。\n2. 最近邻周期性插值, $N = 128$。\n3. 双线性周期性插值, $N = 64$。\n4. 双线性周期性插值, $N = 256$。\n\n最终输出规格：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。每个测试用例的结果必须是按 $[\\overline{\\sigma_S},\\overline{\\kappa}_{\\mathrm{eff}},\\overline{r_{\\mathrm{var}}}]$ 顺序排列的三元素列表。将四个测试用例的结果聚合到一个列表中，形成形如 [[case1_values],[case2_values],[case3_values],[case4_values]] 的单行，数字格式化为普通十进制浮点数，且无空格。例如：[[v11,v12,v13],[v21,v22,v23],[v31,v32,v33],[v41,v42,v43]]。",
            "solution": "推导和算法从被动标量守恒律和不可压缩性出发。控制偏微分方程为 $$\\frac{\\partial C}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla C = \\kappa \\nabla^2 C,\\quad \\nabla\\cdot\\boldsymbol{u}=0,$$ 在数值实验中 $\\kappa=0$。不可压缩条件意味着流体微团保持面积，纯平流是域上的一个保测度映射。在连续介质中，这种变换不改变 $C$ 的概率密度函数，也不改变任何仅依赖于其分布的泛函（在精确输运下）。由此推导出两个相关的诊断量。\n\n第一个诊断量是示踪剂的熵密度，$$S(t) = -\\frac{1}{A}\\int_A C(x,y,t)\\,\\ln C(x,y,t)\\,\\mathrm{d}A.$$ 对于正标量 $C$，此泛函类似于统计力学中的信息熵。在理想平流中，映射沿特征线保持 $C$ 不变，因此 $C$ 的任意函数在面积 $A$ 上的积分都是不变的；具体来说，$\\mathrm{d}S/\\mathrm{d}t = 0$。然而，数值平流结合了插值和离散重映射，这会平滑由拉伸和丝状化产生的小尺度变化。这种平滑作用会增加 $S$，因为对于 $C\\in(0,1)$，$-C\\ln C$ 是凸函数，而混合会减小梯度和锐度，从而使 $C$ 的分布更加均匀。因此，不可逆熵产生率 $$\\sigma_S(t) = \\frac{S(t) - S(t-\\Delta t)}{\\Delta t}$$ 是伪混合的一个度量，其正的平均值 $\\overline{\\sigma_S}$ 表示熵增加。\n\n第二个诊断量使用示踪剂的方差，$$\\overline{C}(t) = \\frac{1}{A}\\int_A C\\,\\mathrm{d}A,\\quad \\mathrm{Var}(t) = \\frac{1}{A}\\int_A \\left(C - \\overline{C}\\right)^2\\,\\mathrm{d}A.$$ 对于仅有平流和精确数值计算，$\\overline{C}(t)$ 和 $\\mathrm{Var}(t)$ 是守恒的，因为平流在没有扩散的情况下保守地重新分布常数。在存在扩散的情况下，方差的演化可以通过在积分号下微分并应用守恒方程和不可压缩性来推导。计算 $$\\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t} = \\frac{2}{A}\\int_A \\left(C - \\overline{C}\\right)\\frac{\\partial C}{\\partial t}\\,\\mathrm{d}A,$$ 其中对于不可压缩平流和周期性边界，$\\frac{\\mathrm{d}\\overline{C}}{\\mathrm{d}t}=0$。代入 $\\partial C/\\partial t = \\kappa \\nabla^2 C$ 并在周期性边界下使用分部积分法得到 $$\\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t} = \\frac{2\\kappa}{A}\\int_A \\left(C - \\overline{C}\\right)\\nabla^2 C\\,\\mathrm{d}A = -\\frac{2\\kappa}{A}\\int_A \\left|\\nabla C\\right|^2\\,\\mathrm{d}A.$$ 最后一个等式成立，因为根据周期性 $\\int_A \\overline{C}\\,\\nabla^2 C\\,\\mathrm{d}A = \\overline{C}\\int_A \\nabla^2 C\\,\\mathrm{d}A = 0$，并且通过无边界通量的分部积分法可得 $\\int_A C \\nabla^2 C\\,\\mathrm{d}A = -\\int_A \\left|\\nabla C\\right|^2\\,\\mathrm{d}A$。该恒等式建立了方差衰减和扩散系数之间的直接联系。在我们的纯平流数值格式中，物理上 $\\kappa=0$，但数值平滑会产生非零的 $\\mathrm{d}\\,\\mathrm{Var}/\\mathrm{d}t$。因此，我们通过以下关系定义一个有效数值扩散率：$$\\kappa_{\\mathrm{eff}}(t) = -\\frac{\\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t}}{2\\,\\Gamma(t)},\\quad \\Gamma(t) = \\frac{1}{A}\\int_A \\left|\\nabla C(x,y,t)\\right|^2\\,\\mathrm{d}A.$$ 对 $\\kappa_{\\mathrm{eff}}(t)$ 进行时间平均得到 $\\overline{\\kappa}_{\\mathrm{eff}}$，单位为 $\\mathrm{m}^2/\\mathrm{s}$，这是一个可在不同分辨率和格式之间进行比较的诊断量。此外，平均相对方差衰减率 $$\\overline{r_{\\mathrm{var}}} = \\left\\langle \\frac{\\mathrm{Var}(t) - \\mathrm{Var}(t-\\Delta t)}{\\mathrm{Var}(t-\\Delta t)\\,\\Delta t} \\right\\rangle$$ 是一个无量纲（单位为每秒）的归一化方差衰减度量。\n\n算法设计整合了这些原理：\n\n1. 将域离散化为 $[0,L)\\times[0,L)$ 上的周期性 $N\\times N$ 网格。三角函数使用弧度角，并确保所有物理单位均为米和秒。\n2. 通过流函数构建 Taylor–Green 涡速度场 $\\boldsymbol{u}(x,y)$。这确保了 $\\nabla\\cdot\\boldsymbol{u} = 0$ 和周期性。\n3. 使用带参数 $\\beta$ 的周期性锋面状函数初始化 $C_0(x,y)$，并将其裁剪到一个小的正下界以避免 $\\ln 0$。\n4. 使用半拉格朗日格式向前步进时间：对于每个网格点 $(x,y)$，计算出发点 $(x',y') = (x - u(x,y)\\Delta t,\\; y - v(x,y)\\Delta t)$ 并进行周期性包裹。使用双线性周期性插值或最近邻周期性插值在 $(x',y')$ 处插值 $C$：\n   - 双线性插值计算周围四个网格值的凸组合，其权重由小数索引确定；使用模运算的周期性索引确保环绕。\n   - 最近邻选择最近网格点的值，同样使用周期性环绕。\n   两种方法都不能精确地保守质量或能量；它们在平滑效果上的差异将反映在诊断量中。\n5. 在每个时间步，计算：\n   - 通过离散面积平均计算空间平均值 $\\overline{C}(t)$ 和方差 $\\mathrm{Var}(t)$。\n   - 通过 $-\\langle C\\ln C\\rangle$ 计算熵密度 $S(t)$，其中尖括号表示空间平均。\n   - 通过中心周期性有限差分计算梯度平方平均值 $\\Gamma(t)$：$$\\frac{\\partial C}{\\partial x} \\approx \\frac{C(x+\\Delta x,y) - C(x-\\Delta x,y)}{2\\Delta x},\\quad \\frac{\\partial C}{\\partial y} \\approx \\frac{C(x,y+\\Delta y) - C(x,y-\\Delta y)}{2\\Delta y},$$ 且 $\\Gamma(t) = \\langle |\\nabla C|^2 \\rangle$。\n6. 使用有限差分计算离散时间导数：$$\\sigma_S(t) \\approx \\frac{S(t) - S(t-\\Delta t)}{\\Delta t},\\quad \\frac{\\mathrm{d}\\,\\mathrm{Var}}{\\mathrm{d}t} \\approx \\frac{\\mathrm{Var}(t) - \\mathrm{Var}(t-\\Delta t)}{\\Delta t},$$ 以及 $$\\kappa_{\\mathrm{eff}}(t) = -\\frac{\\frac{\\mathrm{Var}(t) - \\mathrm{Var}(t-\\Delta t)}{\\Delta t}}{2\\,\\Gamma(t)},\\quad r_{\\mathrm{var}}(t) = \\frac{\\mathrm{Var}(t) - \\mathrm{Var}(t-\\Delta t)}{\\mathrm{Var}(t-\\Delta t)\\,\\Delta t}.$$\n   对这些量进行时间平均以获得 $\\overline{\\sigma_S}$、$\\overline{\\kappa}_{\\mathrm{eff}}$ 和 $\\overline{r_{\\mathrm{var}}}$。\n7. 对测试套件中的所有配置和分辨率重复此过程。预计由于平滑作用更强，双线性插值将比最近邻产生更大的 $\\overline{\\sigma_S}$ 和 $\\overline{\\kappa}_{\\mathrm{eff}}$，并且较粗的网格将比更精细的网格引起更大的伪混合。\n\n最后，根据指定的输出格式，将四个结果作为单个列表的列表发出，每个内部列表包含三个诊断量 $[\\overline{\\sigma_S},\\overline{\\kappa}_{\\mathrm{eff}},\\overline{r_{\\mathrm{var}}}]$，并格式化为无空格。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef tgv_velocity(U0, L, X, Y):\n    \"\"\"\n    Taylor-Green vortex velocity field:\n    u = U0 * sin(2*pi*x/L) * cos(2*pi*y/L)\n    v = -U0 * cos(2*pi*x/L) * sin(2*pi*y/L)\n    \"\"\"\n    k = 2.0 * np.pi / L\n    sin_kx = np.sin(k * X)\n    cos_kx = np.cos(k * X)\n    sin_ky = np.sin(k * Y)\n    cos_ky = np.cos(k * Y)\n    u = U0 * sin_kx * cos_ky\n    v = -U0 * cos_kx * sin_ky\n    return u, v\n\ndef initial_tracer(L, X, Y, beta):\n    \"\"\"\n    Periodic frontlike tracer:\n    C0(x,y) = 0.5 * [1 + tanh(beta * cos(2*pi*y/L))]\n    \"\"\"\n    k = 2.0 * np.pi / L\n    C = 0.5 * (1.0 + np.tanh(beta * np.cos(k * Y)))\n    # Avoid exact zeros or ones to keep log well-defined.\n    eps = 1e-12\n    C = np.clip(C, eps, 1.0 - eps)\n    return C\n\ndef semi_lagrangian_step(C, u, v, dt, L, dx, dy, scheme, X, Y):\n    \"\"\"\n    Semi-Lagrangian update of C using departure points computed with Euler backtrace.\n    Periodic bilinear or nearest-neighbor interpolation implemented via modulo indexing.\n    Grid is uniform with coordinates X, Y representing positions of cell centers.\n    \"\"\"\n    # Compute departure points with Euler backtrace.\n    Xd = X - u * dt\n    Yd = Y - v * dt\n    # Periodic wrap into [0, L)\n    Xd = np.mod(Xd, L)\n    Yd = np.mod(Yd, L)\n\n    # Map physical positions to fractional grid indices\n    # Grid indices: i in [0, Nx-1], j in [0, Ny-1], with x = i*dx, y = j*dy\n    Nx = C.shape[1]\n    Ny = C.shape[0]\n    ix = Xd / dx\n    iy = Yd / dy\n\n    if scheme == \"bilinear\":\n        # Lower-left indices\n        i0 = np.floor(ix).astype(np.int64) % Nx\n        j0 = np.floor(iy).astype(np.int64) % Ny\n        # Upper-right neighbor indices\n        i1 = (i0 + 1) % Nx\n        j1 = (j0 + 1) % Ny\n        # Fractional weights\n        fx = ix - np.floor(ix)\n        fy = iy - np.floor(iy)\n        # Gather corner values\n        C00 = C[j0, i0]\n        C10 = C[j0, i1]\n        C01 = C[j1, i0]\n        C11 = C[j1, i1]\n        # Bilinear interpolation\n        C_new = (1.0 - fx) * (1.0 - fy) * C00 + fx * (1.0 - fy) * C10 + (1.0 - fx) * fy * C01 + fx * fy * C11\n    elif scheme == \"nearest\":\n        i_nn = np.round(ix).astype(np.int64) % Nx\n        j_nn = np.round(iy).astype(np.int64) % Ny\n        C_new = C[j_nn, i_nn]\n    else:\n        raise ValueError(\"Unknown scheme: \" + str(scheme))\n\n    # Clip to bounds to avoid log issues\n    eps = 1e-12\n    C_new = np.clip(C_new, eps, 1.0 - eps)\n    return C_new\n\ndef compute_entropy(C):\n    # Entropy density S = -  C ln C >\n    return -np.mean(C * np.log(C))\n\ndef compute_variance(C):\n    meanC = np.mean(C)\n    return np.mean((C - meanC) ** 2), meanC\n\ndef compute_gradients_squared(C, dx, dy):\n    # Periodic centered differences\n    dCdx = (np.roll(C, -1, axis=1) - np.roll(C, 1, axis=1)) / (2.0 * dx)\n    dCdy = (np.roll(C, -1, axis=0) - np.roll(C, 1, axis=0)) / (2.0 * dy)\n    grad2 = dCdx * dCdx + dCdy * dCdy\n    return np.mean(grad2)\n\ndef run_case(L, U0, beta, N, dt, T, scheme):\n    # Grid setup\n    Nx = N\n    Ny = N\n    dx = L / Nx\n    dy = L / Ny\n    x = np.arange(Nx) * dx\n    y = np.arange(Ny) * dy\n    X, Y = np.meshgrid(x, y)  # shape (Ny, Nx)\n\n    # Velocity field (steady in time)\n    u, v = tgv_velocity(U0, L, X, Y)\n\n    # Initial tracer\n    C = initial_tracer(L, X, Y, beta)\n\n    # Time-stepping\n    steps = int(T // dt)\n    S_series = []\n    Var_series = []\n    Grad_series = []\n\n    # Diagnostics at initial time\n    S_series.append(compute_entropy(C))\n    var, meanC = compute_variance(C)\n    Var_series.append(var)\n    Grad_series.append(compute_gradients_squared(C, dx, dy))\n\n    for _ in range(steps):\n        C = semi_lagrangian_step(C, u, v, dt, L, dx, dy, scheme, X, Y)\n        S_series.append(compute_entropy(C))\n        var, meanC = compute_variance(C)\n        Var_series.append(var)\n        Grad_series.append(compute_gradients_squared(C, dx, dy))\n\n    S_series = np.array(S_series)\n    Var_series = np.array(Var_series)\n    Grad_series = np.array(Grad_series)\n\n    # Time derivatives via finite differences\n    # Use S[1:] - S[:-1], Var[1:] - Var[:-1], Grad[1:] for kappa_eff pairing\n    dSdt = (S_series[1:] - S_series[:-1]) / dt\n    dVdt = (Var_series[1:] - Var_series[:-1]) / dt\n    # Effective diffusivity at each step (use Grad at current time step)\n    # Adding a small epsilon to avoid division by zero if gradient becomes zero\n    kappa_eff_t = -dVdt / (2.0 * Grad_series[1:] + 1e-20)\n    # Fractional variance decay rate\n    # Adding a small epsilon to avoid division by zero\n    r_var_t = (Var_series[1:] - Var_series[:-1]) / ((Var_series[:-1] + 1e-20) * dt)\n\n    # Time-averages\n    sigma_S_mean = float(np.mean(dSdt))\n    kappa_eff_mean = float(np.mean(kappa_eff_t))\n    r_var_mean = float(np.mean(r_var_t))\n\n    return sigma_S_mean, kappa_eff_mean, r_var_mean\n\ndef format_results_no_spaces(results):\n    # results is a list of tuples/floats; produce nested list string with no spaces\n    inner = []\n    for trip in results:\n        inner.append(\"[\" + \",\".join(f\"{v:.8e}\" for v in trip) + \"]\")\n    return \"[\" + \",\".join(inner) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    L = 1.0e4  # meters\n    U0 = 0.2   # m/s\n    beta = 5.0\n    dt = 50.0  # seconds\n    T = 18000.0  # seconds\n\n    test_cases = [\n        (\"bilinear\", 128),\n        (\"nearest\", 128),\n        (\"bilinear\", 64),\n        (\"bilinear\", 256),\n    ]\n\n    results = []\n    for scheme, N in test_cases:\n        sigma_S_mean, kappa_eff_mean, r_var_mean = run_case(L, U0, beta, N, dt, T, scheme)\n        results.append((sigma_S_mean, kappa_eff_mean, r_var_mean))\n\n    # Final print statement in the exact required format: nested list, no spaces.\n    print(format_results_no_spaces(results))\n\nsolve()\n```"
        }
    ]
}