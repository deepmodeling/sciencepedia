{
    "hands_on_practices": [
        {
            "introduction": "海洋和大气之间的能量交换是气候系统的引擎。本实践提供了一个量化这种交换的基础练习，要求你从第一性原理出发，实现完整的海表热通量收支计算，这是任何耦合模型的核心组成部分。你将学习如何综合运用多种物理定律，以确定进入海洋的净能量流及其对海表温度的直接影响 ()。",
            "id": "3788896",
            "problem": "要求您从第一性原理出发，实现一个海-气耦合柱的地表能量平衡模型，以计算给定气象输入下的入海净地表热通量和由此产生的海表温度（SST）倾向。请使用下文详述的、有物理基础的定律和经过充分检验的经验关系，构建一个数值稳定且科学上切实的完整算法。您的程序必须为提供的一套测试用例生成结果，并以严格指定的格式单行输出。\n\n假设、定义和物理定律：\n- 设符号约定为向下（进入海洋）为正。净地表热通量，记为 $Q_{\\text{net}}$，是净短波通量 $Q_{\\text{sw,net}}$、净长波通量 $Q_{\\text{lw,net}}$、感热通量 $Q_{\\text{sen}}$ 和潜热通量 $Q_{\\text{lat}}$ 的总和：\n$$\nQ_{\\text{net}} = Q_{\\text{sw,net}} + Q_{\\text{lw,net}} + Q_{\\text{sen}} + Q_{\\text{lat}}\n$$\n- 短波分量：到达海面的向下短波辐射以 $S_{\\downarrow}$（单位 $\\mathrm{W\\,m^{-2}}$）形式给出。海洋反照率 $\\alpha(\\theta)$ 取决于太阳天顶角 $\\theta$（要求角度单位：弧度）。进入海洋的净短波通量为\n$$\nQ_{\\text{sw,net}} = \\left(1 - \\alpha(\\theta)\\right) S_{\\downarrow},\n$$\n其中反照率受角度调制的公式为\n$$\n\\alpha(\\theta) = \\mathrm{clip}\\left(\\alpha_0 + k \\left(1 - \\cos \\theta\\right), \\alpha_{\\min}, \\alpha_{\\max}\\right),\n$$\n其中常数 $\\alpha_0 = 0.06$，$k = 0.20$，$\\alpha_{\\min} = 0.02$，$\\alpha_{\\max} = 0.50$。\n- 长波分量：使用斯特藩-玻尔兹曼定律，其中大气发射率取决于云量。设 $\\sigma$ 为斯特藩-玻尔兹曼常数，$\\sigma = 5.670374419 \\times 10^{-8}\\,\\mathrm{W\\,m^{-2}\\,K^{-4}}$。设近地表气温为 $T_a$（单位 $\\mathrm{K}$），海洋表面温度（SST）为 $T_s$（单位 $\\mathrm{K}$）。大气发射率是晴空发射率和阴天发射率的线性混合：\n$$\n\\varepsilon_{\\text{atm}} = \\left(1 - C\\right)\\,\\varepsilon_{\\text{clear}} + C\\,\\varepsilon_{\\text{overcast}},\n$$\n其中 $C$ 是云量，范围在 $[0,1]$ 内，$\\varepsilon_{\\text{overcast}} = 0.98$，而 $\\varepsilon_{\\text{clear}}$ 根据近地表空气水汽压 $e_a$ 使用一个经过充分检验的经验关系来诊断：\n$$\n\\varepsilon_{\\text{clear}} = \\mathrm{clip}\\left(0.74 + 0.0049\\,e_a^{(\\mathrm{hPa})},\\,0,\\,1\\right).\n$$\n这里，$e_a^{(\\mathrm{hPa})}$ 是以 $\\mathrm{hPa}$ 为单位的 $e_a$，而 $e_a$ 是通过比湿 $q_a$ 和地表气压 $p$ 得到的：\n$$\ne_a = \\frac{q_a\\,p}{0.622 + 0.378\\,q_a}.\n$$\n设海洋发射率为 $\\varepsilon_{\\text{ocean}} = 0.97$。则\n$$\nL_{\\downarrow} = \\varepsilon_{\\text{atm}} \\,\\sigma\\, T_a^4,\\qquad\nL_{\\uparrow} = \\varepsilon_{\\text{ocean}} \\,\\sigma\\, T_s^4,\\qquad\nQ_{\\text{lw,net}} = L_{\\downarrow} - L_{\\uparrow}.\n$$\n- 感热和潜热分量：使用块体空气动力学公式，其中传输系数为中性稳定条件下的常数。设 $U$ 为 $10\\,\\mathrm{m}$ 高度的风速（单位 $\\mathrm{m\\,s^{-1}}$），$q_a$ 为近地表空气比湿（单位 $\\mathrm{kg\\,kg^{-1}}$），$T_a$ 如上文定义。空气密度 $\\rho_{\\text{air}}$ 由理想气体定律诊断得出：\n$$\n\\rho_{\\text{air}} = \\frac{p}{R_d\\, T_a},\n$$\n其中 $R_d = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，并使用 $p = 101325\\,\\mathrm{Pa}$。对于空气热容，使用 $c_{p,\\text{air}} = 1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。对于蒸发潜热，使用 $L_v = 2.5 \\times 10^6\\,\\mathrm{J\\,kg^{-1}}$。设中性传输系数为 $C_h = 1.2 \\times 10^{-3}$ 和 $C_e = 1.2 \\times 10^{-3}$。海表面的饱和比湿 $q_s$ 是根据水面上的 Tetens 公式计算出的饱和水汽压 $e_s(T_s)$ 得到的：\n$$\nT_C = T_s - 273.15,\\quad\ne_s^{(\\mathrm{hPa})} = 6.112 \\,\\exp\\!\\left(\\frac{17.67\\,T_C}{T_C + 243.5}\\right),\\quad e_s = 100\\, e_s^{(\\mathrm{hPa})},\n$$\n然后\n$$\nq_s = \\frac{0.622\\,e_s}{p - 0.378\\,e_s}.\n$$\n有了 $q_s$ 和 $q_a$，\n$$\nQ_{\\text{lat}} = -\\,\\rho_{\\text{air}}\\, L_v\\, C_e\\, U \\,\\left(q_s - q_a\\right),\\qquad\nQ_{\\text{sen}} = -\\,\\rho_{\\text{air}}\\, c_{p,\\text{air}}\\, C_h\\, U \\,\\left(T_s - T_a\\right).\n$$\n负号强制执行了这样的约定：向上的湍流通量（通常在 $T_s > T_a$ 或 $q_s > q_a$ 时出现）向下为负值。\n- SST 倾向：假设一个深度为 $h$（单位 $\\mathrm{m}$）的板块混合层，其密度为 $\\rho_w = 1025\\,\\mathrm{kg\\,m^{-3}}$，比热容为 $c_{p,w} = 3990\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。瞬时 SST 倾向为\n$$\n\\frac{d T_s}{dt} = \\frac{Q_{\\text{net}}}{\\rho_w\\, c_{p,w}\\, h},\n$$\n报告单位为 $\\mathrm{K\\,s^{-1}}$。\n\n您的任务：\n- 实现一个算法，该算法对每个测试用例，使用上述定律和定义以及给定的常数，计算 $Q_{\\text{net}}$（单位 $\\mathrm{W\\,m^{-2}}$）和瞬时 $\\frac{d T_s}{dt}$（单位 $\\mathrm{K\\,s^{-1}}$）。\n- 角度输入单位为弧度。所有其他输入均使用上述单位。请将净地表热通量表示为四舍五入到三位小数的 $\\mathrm{W\\,m^{-2}}$，将 SST 倾向表示为四舍五入到六位小数的 $\\mathrm{K\\,s^{-1}}$。\n\n测试用例：\n为以下四个测试用例提供结果，每个用例都写成一个有序元组 $(S_{\\downarrow}, C, T_a, T_s, U, q_a, \\theta, h)$：\n1. $ (650.0,\\, 0.50,\\, 298.0,\\, 299.0,\\, 7.0,\\, 0.0160,\\, 0.80,\\, 30.0) $\n2. $ (0.0,\\, 1.00,\\, 290.0,\\, 291.0,\\, 2.0,\\, 0.0100,\\, 1.30,\\, 50.0) $\n3. $ (900.0,\\, 0.10,\\, 301.0,\\, 303.0,\\, 15.0,\\, 0.0080,\\, 0.20,\\, 20.0) $\n4. $ (400.0,\\, 0.70,\\, 295.5,\\, 296.0,\\, 5.0,\\, 0.0140,\\, 1.40,\\, 5.0) $\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的数对列表，每个数对是对应一个测试用例的净地表热通量和 SST 倾向。该列表必须用方括号括起来，每个数对也必须用方括号括起来。例如：\n\"[ [Q1,dT1], [Q2,dT2], [Q3,dT3], [Q4,dT4] ]\"\n- 每个 $Q_i$ 必须是单位为 $\\mathrm{W\\,m^{-2}}$ 且四舍五入到三位小数的浮点数，每个 $\\mathrm{d}T_i$ 必须是单位为 $\\mathrm{K\\,s^{-1}}$ 且四舍五入到六位小数的浮点数。",
            "solution": "该问题要求基于一组给定的气象输入和物理公式，计算进入海洋的净地表热通量 $Q_{\\text{net}}$ 和由此产生的瞬时海表温度（SST）倾向 $\\frac{d T_s}{dt}$。解决方案是通过系统地计算地表能量平衡的每个分量，然后将热力学第一定律应用于一个板块式海洋混合层来推导得出。所有计算都严格遵守所提供的方程和常数。\n\n净热通量 $Q_{\\text{net}}$ 是四个分量的总和，符号约定为进入海洋的通量为正：\n$$\nQ_{\\text{net}} = Q_{\\text{sw,net}} + Q_{\\text{lw,net}} + Q_{\\text{sen}} + Q_{\\text{lat}}\n$$\n\n对于每个测试用例，即一个有序的输入元组 $(S_{\\downarrow}, C, T_a, T_s, U, q_a, \\theta, h)$，计算过程如下。\n\n_1. 净短波辐射 ($Q_{\\text{sw,net}}$)_\n净短波辐射是未被海面反射的入射短波辐射 $S_{\\downarrow}$。被反射的部分即为反照率 $\\alpha(\\theta)$，它取决于太阳天顶角 $\\theta$。\n首先，使用给定的经验公式和常数 $\\alpha_0 = 0.06$ 和 $k = 0.20$ 计算原始反照率：\n$$\n\\alpha_{\\text{raw}} = \\alpha_0 + k (1 - \\cos \\theta)\n$$\n然后将该值约束在一个物理上切实的范围 $[\\alpha_{\\min}, \\alpha_{\\max}]$ 内，其中 $\\alpha_{\\min} = 0.02$ 和 $\\alpha_{\\max} = 0.50$：\n$$\n\\alpha(\\theta) = \\mathrm{clip}(\\alpha_{\\text{raw}}, \\alpha_{\\min}, \\alpha_{\\max})\n$$\n于是净短波通量为：\n$$\nQ_{\\text{sw,net}} = (1 - \\alpha(\\theta)) S_{\\downarrow}\n$$\n\n_2. 净长波辐射 ($Q_{\\text{lw,net}}$)_\n净长波辐射是来自大气的向下长波辐射 $L_{\\downarrow}$ 与海洋表面发出的向上长波辐射 $L_{\\uparrow}$ 之间的差值。\n$$\nQ_{\\text{lw,net}} = L_{\\downarrow} - L_{\\uparrow}\n$$\n向上通量使用斯特藩-玻尔兹曼定律计算，其中海洋发射率 $\\varepsilon_{\\text{ocean}} = 0.97$ 为常数，SST $T_s$ 以开尔文为单位，斯特藩-玻尔兹曼常数 $\\sigma = 5.670374419 \\times 10^{-8}\\,\\mathrm{W\\,m^{-2}\\,K^{-4}}$：\n$$\nL_{\\uparrow} = \\varepsilon_{\\text{ocean}} \\sigma T_s^4\n$$\n向下通量取决于大气发射率 $\\varepsilon_{\\text{atm}}$ 和近地表气温 $T_a$：\n$$\nL_{\\downarrow} = \\varepsilon_{\\text{atm}} \\sigma T_a^4\n$$\n大气发射率是晴空发射率（$\\varepsilon_{\\text{clear}}$）和阴天发射率（$\\varepsilon_{\\text{overcast}} = 0.98$）的加权平均，权重为云量 $C$：\n$$\n\\varepsilon_{\\text{atm}} = (1 - C) \\varepsilon_{\\text{clear}} + C \\varepsilon_{\\text{overcast}}\n$$\n晴空发射率由近地表空气水汽压 $e_a$ 经验确定。首先，从比湿 $q_a$ 和地表气压 $p = 101325\\,\\mathrm{Pa}$ 推导出 $e_a$（单位为帕斯卡）：\n$$\ne_a = \\frac{q_a p}{0.622 + 0.378 q_a}\n$$\n将其转换为百帕（$e_a^{(\\mathrm{hPa})} = e_a / 100$）以用于经验公式，然后将结果截断在 $[0, 1]$ 范围内：\n$$\n\\varepsilon_{\\text{clear}} = \\mathrm{clip}\\left(0.74 + 0.0049 e_a^{(\\mathrm{hPa})}, 0, 1\\right)\n$$\n\n_3. 湍流热通量 ($Q_{\\text{sen}}$ 和 $Q_{\\text{lat}}$)_\n这些通量代表通过湍流进行的热量传递，并使用块体空气动力学公式计算。\n首先根据理想气体定律确定空气密度 $\\rho_{\\text{air}}$，使用 $p = 101325\\,\\mathrm{Pa}$、$R_d = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 和气温 $T_a$：\n$$\n\\rho_{\\text{air}} = \\frac{p}{R_d T_a}\n$$\n感热通量 $Q_{\\text{sen}}$ 取决于海面与空气之间的温差、风速 $U$ 以及空气比热（$c_{p,\\text{air}} = 1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$）和传输系数（$C_h = 1.2 \\times 10^{-3}$）等常数：\n$$\nQ_{\\text{sen}} = - \\rho_{\\text{air}} c_{p,\\text{air}} C_h U (T_s - T_a)\n$$\n潜热通量 $Q_{\\text{lat}}$ 与蒸发有关，取决于饱和海表与空气之间的比湿差。它需要蒸发潜热（$L_v = 2.5 \\times 10^6\\,\\mathrm{J\\,kg^{-1}}$）和传输系数（$C_e = 1.2 \\times 10^{-3}$）。\n$$\nQ_{\\text{lat}} = - \\rho_{\\text{air}} L_v C_e U (q_s - q_a)\n$$\n为计算此值，必须先求出海表面的饱和比湿 $q_s$。这始于饱和水汽压 $e_s$，该值使用 Tetens 公式由 SST $T_s$ 计算得出。首先，将 $T_s$ 转换为摄氏度：$T_C = T_s - 273.15$。\n$$\ne_s^{(\\mathrm{hPa})} = 6.112 \\exp\\left(\\frac{17.67 T_C}{T_C + 243.5}\\right)\n$$\n结果 $e_s^{(\\mathrm{hPa})}$ 被转换为帕斯卡（$e_s = 100 \\times e_s^{(\\mathrm{hPa})}$），然后用于求 $q_s$：\n$$\nq_s = \\frac{0.622 e_s}{p - 0.378 e_s}\n$$\n\n_4. 海表温度倾向 ($\\frac{d T_s}{dt}$)_\n将四个通量分量相加得到总净通量 $Q_{\\text{net}}$ 后，通过考虑海洋混合层（一个深度为 $h$ 的板块）的热容量来计算 SST 的瞬时变化率。给定水的密度 $\\rho_w = 1025\\,\\mathrm{kg\\,m^{-3}}$ 及其比热容 $c_{p,w} = 3990\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$：\n$$\n\\frac{d T_s}{dt} = \\frac{Q_{\\text{net}}}{\\rho_w c_{p,w} h}\n$$\n对于每个测试用例，最终结果 $Q_{\\text{net}}$ 和 $\\frac{d T_s}{dt}$ 分别四舍五入到小数点后 $3$ 位和 $6$ 位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the net surface heat flux and SST tendency for a set of test cases.\n    \"\"\"\n\n    # Define physical and model constants\n    SIGMA = 5.670374419e-8  # Stefan-Boltzmann constant (W m^-2 K^-4)\n    ALPHA_0 = 0.06          # Base albedo\n    K_ALBEDO = 0.20         # Albedo zenith angle coefficient\n    ALPHA_MIN = 0.02        # Minimum albedo\n    ALPHA_MAX = 0.50        # Maximum albedo\n    EPS_OVERCAST = 0.98     # Emissivity of overcast sky\n    EPS_OCEAN = 0.97        # Emissivity of ocean surface\n    R_d = 287.0             # Gas constant for dry air (J kg^-1 K^-1)\n    P_SURF = 101325.0       # Standard surface pressure (Pa)\n    CP_AIR = 1004.0         # Specific heat of air at constant pressure (J kg^-1 K^-1)\n    L_v = 2.5e6             # Latent heat of vaporization (J kg^-1)\n    C_h = 1.2e-3            # Neutral transfer coefficient for sensible heat\n    C_e = 1.2e-3            # Neutral transfer coefficient for latent heat (evaporation)\n    RHO_W = 1025.0          # Density of seawater (kg m^-3)\n    CP_W = 3990.0           # Specific heat of seawater (J kg^-1 K^-1)\n\n    def calculate_fluxes(S_down, C, T_a, T_s, U, q_a, theta, h):\n        \"\"\"\n        Calculates all surface flux components for a single data point.\n        \n        Args:\n            S_down (float): Downward shortwave radiation (W m^-2)\n            C (float): Cloud fraction (0-1)\n            T_a (float): Air temperature (K)\n            T_s (float): Sea surface temperature (K)\n            U (float): Wind speed (m s^-1)\n            q_a (float): Specific humidity of air (kg kg^-1)\n            theta (float): Solar zenith angle (radians)\n            h (float): Mixed layer depth (m)\n            \n        Returns:\n            tuple: A tuple containing (Q_net, dT_s_dt).\n        \"\"\"\n        # 1. Net Shortwave Radiation (Q_sw_net)\n        alpha_raw = ALPHA_0 + K_ALBEDO * (1 - np.cos(theta))\n        alpha = np.clip(alpha_raw, ALPHA_MIN, ALPHA_MAX)\n        Q_sw_net = (1 - alpha) * S_down\n\n        # 2. Net Longwave Radiation (Q_lw_net)\n        # Upward longwave radiation from the ocean\n        L_up = EPS_OCEAN * SIGMA * T_s**4\n\n        # Downward longwave radiation from the atmosphere\n        # First, calculate atmospheric emissivity\n        e_a = (q_a * P_SURF) / (0.622 + 0.378 * q_a)  # Air vapor pressure in Pa\n        e_a_hPa = e_a / 100.0  # Convert to hPa for empirical formula\n        \n        eps_clear_raw = 0.74 + 0.0049 * e_a_hPa\n        eps_clear = np.clip(eps_clear_raw, 0, 1)\n        \n        eps_atm = (1 - C) * eps_clear + C * EPS_OVERCAST\n        \n        # Now calculate downward longwave radiation\n        L_down = eps_atm * SIGMA * T_a**4\n        Q_lw_net = L_down - L_up\n\n        # 3. Turbulent Heat Fluxes (Q_sen, Q_lat)\n        # First, calculate air density\n        rho_air = P_SURF / (R_d * T_a)\n\n        # Sensible heat flux\n        Q_sen = -rho_air * CP_AIR * C_h * U * (T_s - T_a)\n\n        # Latent heat flux\n        # First, calculate saturation specific humidity at the sea surface\n        T_C = T_s - 273.15  # Convert SST to Celsius\n        e_s_hPa = 6.112 * np.exp((17.67 * T_C) / (T_C + 243.5)) # Saturation vapor pressure in hPa\n        e_s = e_s_hPa * 100.0  # Convert to Pascals\n        \n        q_s = (0.622 * e_s) / (P_SURF - 0.378 * e_s) # Saturation specific humidity\n        \n        Q_lat = -rho_air * L_v * C_e * U * (q_s - q_a)\n\n        # 4. Total Net Heat Flux (Q_net)\n        Q_net = Q_sw_net + Q_lw_net + Q_sen + Q_lat\n\n        # 5. Sea Surface Temperature Tendency (dT_s/dt)\n        denominator = RHO_W * CP_W * h\n        dT_s_dt = Q_net / denominator\n        \n        return Q_net, dT_s_dt\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (650.0, 0.50, 298.0, 299.0, 7.0, 0.0160, 0.80, 30.0),\n        (0.0, 1.00, 290.0, 291.0, 2.0, 0.0100, 1.30, 50.0),\n        (900.0, 0.10, 301.0, 303.0, 15.0, 0.0080, 0.20, 20.0),\n        (400.0, 0.70, 295.5, 296.0, 5.0, 0.0140, 1.40, 5.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        Q_net, dT_s_dt = calculate_fluxes(*case)\n        results.append((Q_net, dT_s_dt))\n\n    # Final print statement in the exact required format.\n    formatted_pairs = [f\"[{q:.3f}, {dt:.6f}]\" for q, dt in results]\n    final_output = f\"[{', '.join(formatted_pairs)}]\"\n    \n    # Per example format \"[ [Q1,dT1], [Q2,dT2], ... ]\", add spaces around the content.\n    # On re-evaluation, the `', '.join` and `f-string` naturally match the example's spacing.\n    # The spaces in the example string are after commas, which this method produces.\n    # The `str()` of a list of lists `[[1.2, 3.4]]` is `'[[1.2, 3.4]]'` without outer spaces.\n    # So I will generate the string manually as planned.\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "真正的耦合涉及双向相互作用，即系统的每个组成部分都会影响其他部分。本练习超越了简单的强迫概念，探讨了动量交换中的一个关键反馈：海表流如何改变其自身所受的风应力。通过使用*相对*风速计算风应力，你将直接量化这种耦合效应，并观察其对风生海洋环流（此处以埃克曼输送为例）的影响 ()。",
            "id": "3788880",
            "problem": "考虑一个 $f$ 平面上的正压、水平均一的耦合海洋-大气柱，其中海洋表面流速是预先设定的，近地表风速是已知的。从基本的动量通量思想和地球物理流体动力学出发，推导包含界面处空气和海洋之间相对运动的风应力表达式，然后推导垂直积分的埃克曼输送。使用这些推导出的表达式设计一个算法，为每个测试案例计算：\n- 由相对风引起的修正风应力矢量分量，单位为牛顿/平方米 (N/m^2)，\n- 埃克曼输送矢量分量，单位为平方米/秒 (m^2/s)，\n- 埃克曼输送的大小，单位为平方米/秒 (m^2/s)，\n- 一个无量纲影响度量，定义为使用相对风计算的埃克曼输送大小与仅使用大气风（忽略洋流）朴素计算的埃克曼输送大小之比。\n\n您必须使用的基本依据包括：\n- 海气动量通量与海气界面相对速度的平方成正比，且方向沿相对速度方向，\n- $f$ 平面上垂直积分的埃克曼层的科里奥利平衡，\n- 科里奥利参数定义为 $f = 2 \\Omega \\sin \\varphi$，其中 $\\Omega$ 是地球自转速率，$\\varphi$ 是纬度。\n\n在实现算法时，除了从这些基础推导出的公式外，不要使用任何快捷公式。使用以下常量：\n- 空气密度 $\\rho_{\\text{air}} = 1.225$ 千克/立方米 (kg/m^3)，\n- 海水密度 $\\rho_{\\text{water}} = 1025$ 千克/立方米 (kg/m^3)，\n- 地球自转速率 $\\Omega = 7.2921159 \\times 10^{-5}$ /秒 (s$^{-1}$)，\n- 中性拖曳系数 $C_d = 1.3 \\times 10^{-3}$ (无量纲)，假设为常数。\n\n假设一个右手坐标系，$x$ 指向东，$y$ 指向北，$z$ 指向。设近地表风速为 $\\mathbf{U}_a = (U_a, V_a)$，单位为米/秒 (m/s)；海洋表面流速为 $\\mathbf{U}_o = (U_o, V_o)$，单位为米/秒 (m/s)。所有速度以米/秒 (m/s) 表示，风应力以牛顿/平方米 (N/m^2) 表示，埃克曼输送以平方米/秒 (m^2/s) 表示。角度以度为单位指定，在计算三角函数时必须转换为弧度。所有计算出的浮点输出必须四舍五入到六位小数。\n\n您的程序必须评估以下参数值测试套件，其中纬度以度为单位，速度以米/秒 (m/s) 为单位：\n\n- 测试案例 A（一般情况，北半球）：纬度 $\\varphi = 30$，风速 $\\mathbf{U}_a = (10, 0)$，流速 $\\mathbf{U}_o = (1, 0)$。\n- 测试案例 B（逆流，北半球）：纬度 $\\varphi = 30$，风速 $\\mathbf{U}_a = (10, 0)$，流速 $\\mathbf{U}_o = (-1.5, 0)$。\n- 测试案例 C（二维情况，北半球）：纬度 $\\varphi = 45$，风速 $\\mathbf{U}_a = (5, 8)$，流速 $\\mathbf{U}_o = (0.5, 1.0)$。\n- 测试案例 D（近赤道边界）：纬度 $\\varphi = 1$，风速 $\\mathbf{U}_a = (8, 6)$，流速 $\\mathbf{U}_o = (0.2, 0.1)$。\n- 测试案例 E（南半球，退化的相对风）：纬度 $\\varphi = -45$，风速 $\\mathbf{U}_a = (6, -4)$，流速 $\\mathbf{U}_o = (6, -4)$。\n\n对于每个测试案例，计算：\n1. 修正后的风应力分量 $(\\tau_x, \\tau_y)$，单位为 N/m^2，\n2. 埃克曼输送分量 $(M_x, M_y)$，单位为 m^2/s，\n3. 埃克曼输送大小 $|\\mathbf{M}|$，单位为 m^2/s，\n4. 影响度量 $r = |\\mathbf{M}_{\\text{rel}}| / |\\mathbf{M}_{\\text{naive}}|$，为十进制数（无量纲），其中 $\\mathbf{M}_{\\text{rel}}$ 使用相对风计算，$\\mathbf{M}_{\\text{naive}}$ 使用大气风计算，不减去洋流。\n\n您的程序应该生成单行输出，包含一个由五个子列表组成的列表（每个测试案例一个），其中每个子列表是六个浮点数 $[\\tau_x, \\tau_y, M_x, M_y, |\\mathbf{M}|, r]$ 的逗号分隔列表，所有数值都四舍五入到六位小数，并用方括号括起来。例如，输出应如下所示：\n[[tau_x_A,tau_y_A,M_x_A,M_y_A,Mag_A,r_A],[tau_x_B,tau_y_B,M_x_B,M_y_B,Mag_B,r_B],[tau_x_C,tau_y_C,M_x_C,M_y_C,Mag_C,r_C],[tau_x_D,tau_y_D,M_x_D,M_y_D,Mag_D,r_D],[tau_x_E,tau_y_E,M_x_E,M_y_E,Mag_E,r_E]]",
            "solution": "## 问题验证\n\n### 步骤1：提取给定条件\n问题陈述提供了以下数据、定义和条件：\n- **物理模型**：$f$ 平面上的正压、水平均一的耦合海洋-大气柱。\n- **坐标系**：右手坐标系，$x$ 指向东，$y$ 指向北，$z$ 指向上。\n- **变量**：\n    - 近地表风速：$\\mathbf{U}_a = (U_a, V_a)$ (m/s)\n    - 海洋表面流速：$\\mathbf{U}_o = (U_o, V_o)$ (m/s)\n    - 纬度：$\\varphi$ (度)\n- **基本依据**：\n    1.  海气动量通量（风应力 $\\boldsymbol{\\tau}$）与海气相对速度的平方成正比，且方向沿相对速度方向。\n    2.  $f$ 平面上垂直积分的埃克曼层的科里奥利平衡。\n    3.  科里奥利参数：$f = 2 \\Omega \\sin \\varphi$。\n- **常量**：\n    - 空气密度：$\\rho_{\\text{air}} = 1.225$ kg/m$^3$\n    - 海水密度：$\\rho_{\\text{water}} = 1025$ kg/m$^3$\n    - 地球自转速率：$\\Omega = 7.2921159 \\times 10^{-5}$ s$^{-1}$\n    - 中性拖曳系数：$C_d = 1.3 \\times 10^{-3}$ (无量纲)\n- **每个测试案例所需计算**：\n    1.  修正后的风应力分量 $(\\tau_x, \\tau_y)$ (N/m$^2$)\n    2.  埃克曼输送分量 $(M_x, M_y)$ (m$^2$/s)\n    3.  埃克曼输送大小 $|\\mathbf{M}|$ (m$^2$/s)\n    4.  影响度量 $r = |\\mathbf{M}_{\\text{rel}}| / |\\mathbf{M}_{\\text{naive}}|$ (无量纲)\n- **测试案例**：\n    - A: $\\varphi = 30^\\circ$, $\\mathbf{U}_a = (10, 0)$, $\\mathbf{U}_o = (1, 0)$\n    - B: $\\varphi = 30^\\circ$, $\\mathbf{U}_a = (10, 0)$, $\\mathbf{U}_o = (-1.5, 0)$\n    - C: $\\varphi = 45^\\circ$, $\\mathbf{U}_a = (5, 8)$, $\\mathbf{U}_o = (0.5, 1.0)$\n    - D: $\\varphi = 1^\\circ$, $\\mathbf{U}_a = (8, 6)$, $\\mathbf{U}_o = (0.2, 0.1)$\n    - E: $\\varphi = -45^\\circ$, $\\mathbf{U}_a = (6, -4)$, $\\mathbf{U}_o = (6, -4)$\n- **格式**：所有输出必须四舍五入到六位小数。最终输出是一个子列表的列表。\n\n### 步骤2：使用提取的给定条件进行验证\n根据验证标准评估该问题：\n- **科学依据**：该问题基于地球物理流体动力学的基本原理，即风应力的整体空气动力学公式和埃克曼输送理论。这些是海洋学和大气科学中标准且成熟的概念。$f$ 平面近似是研究小于行星尺度过程的有效且常见的简化方法。所有常数都给出了标准的、物理上现实的数值。\n- **适定性**：问题定义清晰。对于每组输入，所需的输出可以通过从给定原理推导的一系列计算唯一确定。提供的测试案例是明确的。测试案例D（近赤道）将导致一个小的科里奥利参数 $f$，从而产生巨大但物理上有意义的埃克曼输送值。测试案例E代表一个有效的物理极限，其中相对风为零，导致零风应力和零埃克曼输送。影响度量 $r$ 对所有测试案例都有明确定义，因为朴素风速永不为零。\n- **客观性**：问题以精确、定量和无偏见的技术语言陈述，不含任何主观或推测性内容。\n- **缺陷清单**：该问题不违反任何无效性标准。它在科学上是合理的、可形式化的、完整的、现实的、适定的、非平凡的且可验证的。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整的解决方案。\n\n## 推导与算法设计\n\n解决方案首先从提供的基本依据推导必要的物理方程，然后构建一个算法来计算所需的量。\n\n### 1. 包含相对运动的风应力\n问题指出，风应力 $\\boldsymbol{\\tau}$ 是一种动量通量，其大小与海气相对速度的平方成正比，方向沿相对速度方向。相对速度 $\\mathbf{U}_{\\text{rel}}$ 是近地表风速 $\\mathbf{U}_a = (U_a, V_a)$ 与海洋表面流速 $\\mathbf{U}_o = (U_o, V_o)$ 之差：\n$$\n\\mathbf{U}_{\\text{rel}} = \\mathbf{U}_a - \\mathbf{U}_o = (U_a - U_o, V_a - V_o) = (U_{\\text{rel}}, V_{\\text{rel}})\n$$\n令 $|\\mathbf{U}_{\\text{rel}}|$ 为该相对速度的大小（速率）。方向由单位向量 $\\hat{\\mathbf{u}}_{\\text{rel}} = \\mathbf{U}_{\\text{rel}} / |\\mathbf{U}_{\\text{rel}}|$ 给出。\n\n“与相对速度的平方成正比...且方向沿相对速度方向”的陈述在数学上可转换为：\n$$\n\\boldsymbol{\\tau} \\propto |\\mathbf{U}_{\\text{rel}}|^2 \\hat{\\mathbf{u}}_{\\text{rel}} = |\\mathbf{U}_{\\text{rel}}|^2 \\frac{\\mathbf{U}_{\\text{rel}}}{|\\mathbf{U}_{\\text{rel}}|} = |\\mathbf{U}_{\\text{rel}}| \\mathbf{U}_{\\text{rel}}\n$$\n这是标准的整体空气动力学公式。比例常数结合了空气密度 $\\rho_{\\text{air}}$ 和一个无量纲的拖曳系数 $C_d$。因此，风应力矢量为：\n$$\n\\boldsymbol{\\tau} = \\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| \\mathbf{U}_{\\text{rel}}\n$$\n风应力矢量的分量 $\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$ 为：\n$$\n\\tau_x = \\rho_{\\text{air}} C_d \\sqrt{U_{\\text{rel}}^2 + V_{\\text{rel}}^2} \\cdot U_{\\text{rel}}\n$$\n$$\n\\tau_y = \\rho_{\\text{air}} C_d \\sqrt{U_{\\text{rel}}^2 + V_{\\text{rel}}^2} \\cdot V_{\\text{rel}}\n$$\n这是首先要计算的两个量。\n\n### 2. 垂直积分的埃克曼输送\n在 $f$ 平面上，海洋埃克曼层的稳态、水平均一动量方程，忽略压力梯度和平流，表示科里奥利力与湍流应力垂直梯度之间的平衡：\n$$\n-f v = \\frac{1}{\\rho_{\\text{water}}} \\frac{\\partial \\tau_{zx}}{\\partial z}\n$$\n$$\nf u = \\frac{1}{\\rho_{\\text{water}}} \\frac{\\partial \\tau_{zy}}{\\partial z}\n$$\n这里，$(u, v)$ 是海洋速度的分量，$f = 2 \\Omega \\sin \\varphi$ 是科里奥利参数（在 $f$ 平面上为常数），$\\rho_{\\text{water}}$ 是海水密度，$(\\tau_{zx}, \\tau_{zy})$ 是水中内剪应力的分量。\n\n为了求得总输送，我们将这些方程从埃克曼层底部 $z=-H$（此处应力消失）垂直积分到海面 $z=0$（此处水应力等于风应力 $\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$）。垂直积分的埃克曼输送定义为 $\\mathbf{M} = (M_x, M_y)$，其中 $M_x = \\int_{-H}^0 u \\,dz$ 和 $M_y = \\int_{-H}^0 v \\,dz$。\n$$\n-f \\int_{-H}^{0} v \\,dz = \\frac{1}{\\rho_{\\text{water}}} \\int_{-H}^{0} \\frac{\\partial \\tau_{zx}}{\\partial z} \\,dz \\implies -f M_y = \\frac{1}{\\rho_{\\text{water}}} [\\tau_{zx}(0) - \\tau_{zx}(-H)] = \\frac{\\tau_x}{\\rho_{\\text{water}}}\n$$\n$$\nf \\int_{-H}^{0} u \\,dz = \\frac{1}{\\rho_{\\text{water}}} \\int_{-H}^{0} \\frac{\\partial \\tau_{zy}}{\\partial z} \\,dz \\implies f M_x = \\frac{1}{\\rho_{\\text{water}}} [\\tau_{zy}(0) - \\tau_{zy}(-H)] = \\frac{\\tau_y}{\\rho_{\\text{water}}}\n$$\n求解埃克曼输送的分量，得到：\n$$\nM_x = \\frac{\\tau_y}{f \\rho_{\\text{water}}}\n$$\n$$\nM_y = -\\frac{\\tau_x}{f \\rho_{\\text{water}}}\n$$\n这是接下来要计算的两个量。埃克曼输送的总大小就是：\n$$\n|\\mathbf{M}| = \\sqrt{M_x^2 + M_y^2}\n$$\n\n### 3. 影响度量\n影响度量 $r$ 是使用相对风计算的埃克曼输送大小（$\\mathbf{M}_{\\text{rel}}$）与仅使用大气风朴素计算的埃克曼输送大小（$\\mathbf{M}_{\\text{naive}}$）之比。\n输送矢量 $\\mathbf{M}$ 的大小可以直接与应力矢量 $|\\boldsymbol{\\tau}|$ 的大小相关联：\n$$\n|\\mathbf{M}| = \\sqrt{\\left(\\frac{\\tau_y}{f \\rho_{\\text{water}}}\\right)^2 + \\left(-\\frac{\\tau_x}{f \\rho_{\\text{water}}}\\right)^2} = \\frac{\\sqrt{\\tau_x^2 + \\tau_y^2}}{|f| \\rho_{\\text{water}}} = \\frac{|\\boldsymbol{\\tau}|}{|f| \\rho_{\\text{water}}}\n$$\n应力矢量的大小是：\n$$\n|\\boldsymbol{\\tau}| = \\sqrt{(\\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| U_{\\text{rel}})^2 + (\\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| V_{\\text{rel}})^2} = \\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| \\sqrt{U_{\\text{rel}}^2 + V_{\\text{rel}}^2} = \\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}|^2\n$$\n所以，使用相对风的埃克曼输送大小为：\n$$\n|\\mathbf{M}_{\\text{rel}}| = \\frac{\\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}|^2}{|f| \\rho_{\\text{water}}}\n$$\n对于“朴素”情况，我们设 $\\mathbf{U}_o = \\mathbf{0}$，因此相对风就是 $\\mathbf{U}_a$。朴素输送的大小为：\n$$\n|\\mathbf{M}_{\\text{naive}}| = \\frac{\\rho_{\\text{air}} C_d |\\mathbf{U}_a|^2}{|f| \\rho_{\\text{water}}}\n$$\n影响度量 $r$ 是这两个量的比值。公因子相消，得到一个简单的表达式：\n$$\nr = \\frac{|\\mathbf{M}_{\\text{rel}}|}{|\\mathbf{M}_{\\text{naive}}|} = \\frac{\\frac{\\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}|^2}{|f| \\rho_{\\text{water}}}}{\\frac{\\rho_{\\text{air}} C_d |\\mathbf{U}_a|^2}{|f| \\rho_{\\text{water}}}} = \\frac{|\\mathbf{U}_{\\text{rel}}|^2}{|\\mathbf{U}_a|^2}\n$$\n这种简化的形式避免了为计算比率而直接计算输送，并且在数值上更稳定，尤其对于小的 $f$。\n\n### 4. 算法摘要\n\n对于每个测试案例 $(\\varphi, \\mathbf{U}_a, \\mathbf{U}_o)$:\n1.  将纬度 $\\varphi$ 从度转换为弧度，$\\varphi_{\\text{rad}}$。\n2.  计算科里奥利参数：$f = 2 \\Omega \\sin(\\varphi_{\\text{rad}})$。\n3.  计算相对速度分量：$U_{\\text{rel}} = U_a - U_o$ 和 $V_{\\text{rel}} = V_a - V_o$。\n4.  计算相对速度的大小：$|\\mathbf{U}_{\\text{rel}}| = \\sqrt{U_{\\text{rel}}^2 + V_{\\text{rel}}^2}$。\n5.  计算风应力分量：\n    - $\\tau_x = \\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| U_{\\text{rel}}$\n    - $\\tau_y = \\rho_{\\text{air}} C_d |\\mathbf{U}_{\\text{rel}}| V_{\\text{rel}}$\n    *若 $|\\mathbf{U}_{\\text{rel}}| = 0$，则 $\\tau_x = 0$ 且 $\\tau_y = 0$。*\n6.  计算埃克曼输送分量：\n    - $M_x = \\tau_y / (f \\rho_{\\text{water}})$\n    - $M_y = -\\tau_x / (f \\rho_{\\text{water}})$\n    *若 $f=0$，这些是未定义的，但测试案例避免了这种情况。若 $|\\mathbf{U}_{\\text{rel}}| = 0$，则 $M_x = 0$ 且 $M_y = 0$。*\n7.  计算埃克曼输送大小：$|\\mathbf{M}| = \\sqrt{M_x^2 + M_y^2}$。\n8.  计算影响度量：$r = (U_{\\text{rel}}^2 + V_{\\text{rel}}^2) / (U_a^2 + V_a^2)$。\n    *若 $|\\mathbf{U}_a| = 0$，这可能是未定义的，但测试案例避免了这种情况。*\n9.  将六个结果 $(\\tau_x, \\tau_y, M_x, M_y, |\\mathbf{M}|, r)$ 四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled ocean-atmosphere problem for a suite of test cases.\n    It derives and computes wind stress, Ekman transport, and an impact metric\n    based on fundamental geophysical fluid dynamics principles.\n    \"\"\"\n    \n    # Define physical constants as provided in the problem statement.\n    RHO_AIR = 1.225  # kg/m^3\n    RHO_WATER = 1025 # kg/m^3\n    OMEGA = 7.2921159e-5 # s^-1\n    C_D = 1.3e-3  # dimensionless\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (latitude_deg, (Ua, Va), (Uo, Vo))\n    test_cases = [\n        # A: general, NH\n        (30, (10, 0), (1, 0)),\n        # B: opposing current, NH\n        (30, (10, 0), (-1.5, 0)),\n        # C: two-dimensional, NH\n        (45, (5, 8), (0.5, 1.0)),\n        # D: near-equatorial boundary\n        (1, (8, 6), (0.2, 0.1)),\n        # E: Southern Hemisphere, degenerate relative wind\n        (-45, (6, -4), (6, -4)),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        phi_deg, (Ua, Va), (Uo, Vo) = case\n\n        # Step 1: Calculate Coriolis parameter f\n        phi_rad = np.deg2rad(phi_deg)\n        f = 2 * OMEGA * np.sin(phi_rad)\n\n        # Step 2: Calculate relative velocity\n        U_rel = Ua - Uo\n        V_rel = Va - Vo\n        U_rel_mag = np.sqrt(U_rel**2 + V_rel**2)\n\n        # Step 3: Calculate wind stress components (tau_x, tau_y)\n        # Handle the degenerate case where relative wind is zero to avoid 0*nan issues.\n        if U_rel_mag == 0:\n            tau_x = 0.0\n            tau_y = 0.0\n        else:\n            tau_x = RHO_AIR * C_D * U_rel_mag * U_rel\n            tau_y = RHO_AIR * C_D * U_rel_mag * V_rel\n        \n        # Step 4: Calculate Ekman transport components (Mx, My)\n        # Handle the degenerate case where stress is zero.\n        if tau_x == 0.0 and tau_y == 0.0:\n            Mx = 0.0\n            My = 0.0\n        else:\n            # f is non-zero for all test cases.\n            f_rho_water = f * RHO_WATER\n            Mx = tau_y / f_rho_water\n            My = -tau_x / f_rho_water\n\n        # Step 5: Calculate Ekman transport magnitude |M|\n        Mag_M = np.sqrt(Mx**2 + My**2)\n\n        # Step 6: Calculate impact metric r\n        Ua_mag_sq = Ua**2 + Va**2\n        U_rel_mag_sq = U_rel**2 + V_rel**2\n\n        # Handle case where naive wind is zero, though not in test suite.\n        if Ua_mag_sq == 0:\n            # If U_rel is also zero, result is indeterminate (0/0).\n            # If U_rel is non-zero, result is infinite.\n            # As per convention, we can use nan or handle appropriately.\n            # Here, we set to nan.\n            r = float('nan')\n        else:\n            r = U_rel_mag_sq / Ua_mag_sq\n            \n        # Compile results for the current case, rounding as required.\n        case_results = [\n            round(tau_x, 6),\n            round(tau_y, 6),\n            round(Mx, 6),\n            round(My, 6),\n            round(Mag_M, 6),\n            round(r, 6)\n        ]\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # Convert each inner list to a string representation\n    # e.g., '[1.0, 2.0]'\n    str_results = []\n    for res_list in all_results:\n        # Format each number to ensure a single decimal place for .0 values\n        # e.g., 0.0 not 0\n        formatted_nums = [f\"{x:.6f}\" for x in res_list]\n        str_results.append(f\"[{','.join(formatted_nums)}]\")\n    \n    # Join the string representations of the inner lists\n    final_output_str = f\"[{','.join(str_results)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "耦合系统拥有其固有的变率模态和调整时间尺度，如果模型的初始状态不平衡，便可能导致“气候漂移”。本实践使用一个简化的概念模型来探索这一调整过程的动力学，使你能够分析系统的基本时间尺度并比较不同的初始化策略。理解这些动力学对于解释复杂气候预测模型的输出至关重要 ()。",
            "id": "3788901",
            "problem": "考虑一个最小且科学上一致的海-气耦合能量平衡模型，用于描述在线性化海-气交换条件下近地面气温和海洋混合层温度异常的演变。令 $T_a(t)$ 表示近地面大气温度异常，$T_o(t)$ 表示海洋混合层温度异常，两者均以开尔文为单位。大气柱的单位面积有效热容为 $C_a$（单位：焦耳/平方米·开尔文），海洋混合层的单位面积热容为 $C_o$（单位：焦耳/平方米·开尔文）。大气和海洋对空间的线性化辐射阻尼分别由 $\\lambda_a$ 和 $\\lambda_o$（单位均为瓦特/平方米·开尔文）表示。海-气耦合由整体交换系数 $\\gamma$（单位：瓦特/平方米·开尔文）表征。忽略外部强迫，并假设异常是相对于完全耦合的平衡态定义的，从而得到如下控制能量守恒方程\n$$\nC_a \\frac{d T_a}{dt} = -\\lambda_a T_a - \\gamma \\left(T_a - T_o\\right),\n\\quad\nC_o \\frac{d T_o}{dt} = -\\lambda_o T_o + \\gamma \\left(T_a - T_o\\right).\n$$\n定义状态向量 $y(t) = \\begin{bmatrix}T_a(t) \\\\ T_o(t)\\end{bmatrix}$，并将该系统紧凑地写为 $\\frac{d y}{dt} = M y$，其中 $M$ 是由上述方程隐含的常系数矩阵。当初始条件与耦合平衡态不一致时，就会出现气候漂移的概念，这会在没有外部强迫的情况下引起瞬态调整。考虑在耦合大尺度环流模型（GCM）预测中两种常用的初始化策略：\n\n- 全场初始化：直接从外部估计值初始化 $y(0)$，这可能导致较大的海-气不匹配和巨大的初始通量不平衡。\n- 异常初始化：从构建的、与模型的耦合平衡近似一致的异常场来初始化 $y(0)$，这通常会减少初始的海-气不匹配。\n\n对于每种策略，“漂移轨迹”是指定时间窗口内的 $y(t)$ 时间序列。为了量化初始调整，定义海-气不匹配为 $d(t) = T_a(t) - T_o(t)$，并将给定策略的有效初始调整时间尺度定义为对于一个固定分数 $\\alpha$（$0 < \\alpha < 1$），使得 $|d(t)| \\le \\alpha |d(0)|$ 成立的最早时间 $t$。此外，将耦合线性系统的主导 e-折时间尺度定义为与 $\\frac{d y}{dt} = M y$ 的最慢衰减模态相关的时间，并将漂移振幅度量量化为指定窗口内 $|T_o(t)|$ 的最大值。\n\n从耦合海-气系统中的能量守恒、线性化 Newtonian 冷却和线性整体海-气交换等基本原理出发，推导出一个算法来计算漂移轨迹 $y(t)$ 并量化调整时间尺度，而无需依赖外部数据。您的程序必须：\n\n- 根据 $C_a$、$C_o$、$\\lambda_a$、$\\lambda_o$ 和 $\\gamma$ 构建 $M$。\n- 使用线性动力学算子 $M$ 计算主导 e-折时间尺度。\n- 对于每种初始化策略，计算不匹配度满足 $|d(t)| \\le \\alpha |d(0)|$ 的最早时间 $t$。\n- 在指定的有限分析窗口内计算 $\\max_{t \\in [0, t_{\\mathrm{end}}]} |T_o(t)|$。\n- 所有时间以天为单位表示，所有温度以开尔文为单位表示。所有角度（如果有）必须以弧度表示；此问题不使用角度。\n\n使用 $\\alpha = 0.05$（无量纲）和 $t_{\\mathrm{end}} = 2000$ 天，搜索步长为 $\\Delta t = 1$ 小时。如果在 $[0, t_{\\mathrm{end}}]$ 内未达到阈值 $|d(t)| \\le \\alpha |d(0)|$，则报告 $t_{\\mathrm{end}}$ 作为该策略的阈值时间。如果 $|d(0)| = 0$，则报告阈值时间为 $0$。\n\n测试套件。实现以下四个科学上合理的测试用例，每个用例由 $(C_a, C_o, \\lambda_a, \\lambda_o, \\gamma)$ 以及两种初始化条件——全场初始化 $y_{\\mathrm{FF}}(0)$ 和异常初始化 $y_{\\mathrm{AI}}(0)$——定义。所有热容的单位是焦耳/平方米·开尔文，所有系数的单位是瓦特/平方米·开尔文，温度单位是开尔文。\n\n- 用例 $1$（理想情况，中等耦合）：\n  - $C_a = 1.0 \\times 10^{7}$，$C_o = 4.0 \\times 10^{8}$，$\\lambda_a = 1.2$，$\\lambda_o = 0.5$，$\\gamma = 20.0$。\n  - $y_{\\mathrm{FF}}(0) = \\begin{bmatrix} 2.0 \\\\ 0.0 \\end{bmatrix}$，$y_{\\mathrm{AI}}(0) = \\begin{bmatrix} 1.0 \\\\ 1.0 \\end{bmatrix}$。\n- 用例 $2$（弱耦合，慢调整）：\n  - $C_a = 1.0 \\times 10^{7}$，$C_o = 4.0 \\times 10^{8}$，$\\lambda_a = 1.2$，$\\lambda_o = 0.5$，$\\gamma = 2.0$。\n  - $y_{\\mathrm{FF}}(0) = \\begin{bmatrix} 2.0 \\\\ 0.0 \\end{bmatrix}$，$y_{\\mathrm{AI}}(0) = \\begin{bmatrix} 1.0 \\\\ 1.0 \\end{bmatrix}$。\n- 用例 $3$（强耦合，快调整）：\n  - $C_a = 1.0 \\times 10^{7}$，$C_o = 4.0 \\times 10^{8}$，$\\lambda_a = 1.2$，$\\lambda_o = 0.5$，$\\gamma = 60.0$。\n  - $y_{\\mathrm{FF}}(0) = \\begin{bmatrix} 0.5 \\\\ 0.0 \\end{bmatrix}$，$y_{\\mathrm{AI}}(0) = \\begin{bmatrix} 0.5 \\\\ 0.5 \\end{bmatrix}$。\n- 用例 $4$（边界情况，平衡初始化）：\n  - $C_a = 1.0 \\times 10^{7}$，$C_o = 4.0 \\times 10^{8}$，$\\lambda_a = 1.2$，$\\lambda_o = 0.5$，$\\gamma = 20.0$。\n  - $y_{\\mathrm{FF}}(0) = \\begin{bmatrix} 1.0 \\\\ 1.0 \\end{bmatrix}$，$y_{\\mathrm{AI}}(0) = \\begin{bmatrix} 1.0 \\\\ 1.0 \\end{bmatrix}$。\n\n对于每个用例，您的程序必须输出一个包含四个值的列表：\n- 主导 e-折时间尺度，单位为天，\n- 全场初始化的阈值时间，单位为天，\n- 异常初始化的阈值时间，单位为天，\n- 在 $[0, t_{\\mathrm{end}}]$ 范围内 $|T_o(t)|$ 的最大漂移振幅，单位为开尔文。\n\n最终输出格式。您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号括起来的逗号分隔列表的列表，形式为\n$[ [r_{11}, r_{12}, r_{13}, r_{14}], [r_{21}, r_{22}, r_{23}, r_{24}], [r_{31}, r_{32}, r_{33}, r_{34}], [r_{41}, r_{42}, r_{43}, r_{44}] ]$，\n其中每个 $r_{ij}$ 是一个使用上述指定单位的浮点数。不应打印任何其他文本。",
            "solution": "用户提供了一个问题陈述，描述了一个用于海-气耦合温度异常的线性双箱模型。任务是验证此问题，如果问题有效，则提供一个解决方案来计算与模型行为相关的几个诊断量，即所谓的“气候漂移”。\n\n### 步骤 1：问题验证\n\n第一步是严格验证问题陈述。\n\n#### 提取已知条件\n- **状态变量**：$T_a(t)$（大气温度异常），$T_o(t)$（海洋温度异常）。\n- **状态向量**：$y(t) = \\begin{bmatrix} T_a(t) \\\\ T_o(t) \\end{bmatrix}$。\n- **物理参数**：\n    - $C_a$（大气热容，J m⁻² K⁻¹）。\n    - $C_o$（海洋混合层热容，J m⁻² K⁻¹）。\n    - $\\lambda_a$（大气辐射阻尼，W m⁻² K⁻¹）。\n    - $\\lambda_o$（海洋辐射阻尼，W m⁻² K⁻¹）。\n    - $\\gamma$（海-气交换系数，W m⁻² K⁻¹）。\n- **控制方程**：\n$$\nC_a \\frac{d T_a}{dt} = -\\lambda_a T_a - \\gamma \\left(T_a - T_o\\right)\n$$\n$$\nC_o \\frac{d T_o}{dt} = -\\lambda_o T_o + \\gamma \\left(T_a - T_o\\right)\n$$\n- **矩阵形式**：$\\frac{dy}{dt} = M y(t)$。\n- **诊断定义**：\n    - 海-气不匹配：$d(t) = T_a(t) - T_o(t)$。\n    - 调整时间尺度：$|d(t)| \\le \\alpha |d(0)|$ 的最早时间 $t$。\n    - 主导 e-折时间尺度：与系统最慢衰减模态相关的时间。\n    - 漂移振幅：$\\max_{t \\in [0, t_{\\mathrm{end}}]} |T_o(t)|$。\n- **计算参数**：\n    - $\\alpha = 0.05$。\n    - 分析窗口：$[0, t_{\\mathrm{end}}]$，其中 $t_{\\mathrm{end}} = 2000$ 天。\n    - 搜索时间步长：$\\Delta t = 1$ 小时。\n- **特殊情况规则**：\n    - 如果未达到调整阈值，报告 $t_{\\mathrm{end}}$。\n    - 如果 $|d(0)| = 0$，调整时间尺度为 $0$。\n- **单位**：所有涉及时间的输出必须以天为单位。\n- **测试用例**：提供了四个用例，每个用例都有一组物理参数和两个初始条件：$y_{\\mathrm{FF}}(0)$（全场）和 $y_{\\mathrm{AI}}(0)$（异常初始化）。\n\n#### 验证结论\n1.  **科学依据**：该问题描述了一个标准的、科学上合理的双箱能量平衡模型。这类线性化模型是概念性气候动力学的基石，用于理解基本的时间尺度和调整过程。控制方程正确地表示了线性化反馈下的能量守恒。测试用例中指定的物理参数对于地球气候系统具有现实的量级。“气候漂移”和初始化策略的概念是数值天气和气候预测领域的标准。该问题具有**科学依据**。\n2.  **适定性**：该问题是一个线性、一阶、齐次、常系数的常微分方程组。给定一个初始条件 $y(0)$，对于所有 $t$ 都存在唯一解 $y(t) = e^{Mt}y(0)$。物理参数 $C_a, C_o, \\lambda_a, \\lambda_o, \\gamma$ 均为正值。矩阵 M 可被证明是稳定的（其所有特征值的实部均为负），确保温度异常会衰减到零。待计算的诊断量在数学上都是适定的。该问题是**适定的**。\n3.  **客观性**：语言精确且定量，使用标准的科学和数学术语。没有主观或模棱两可的陈述。该问题是**客观的**。\n4.  **完整性**：所有必需的参数、初始条件和计算规则（例如，用于处理特殊情况的规则）都已提供。单位一致性得以保持，因为所有物理参数都以国际单位制（J、W、s、m、K）给出，由此可以推导出以秒为单位的时间演变。要求以天为单位报告时间，只需进行简单的单位转换。该问题是**自洽且一致的**。\n\n经判定，该问题陈述在所有标准上均**有效**。\n\n### 步骤 2：原理性解决方案设计\n\n问题的核心是求解线性常微分方程组 $\\frac{dy}{dt} = M y$ 并分析其解。\n\n#### 1. 构建系统矩阵 M\n可以重新整理控制方程以分离出时间导数：\n$$\n\\frac{d T_a}{dt} = -\\frac{\\lambda_a + \\gamma}{C_a} T_a + \\frac{\\gamma}{C_a} T_o\n$$\n$$\n\\frac{d T_o}{dt} = \\frac{\\gamma}{C_o} T_a - \\frac{\\lambda_o + \\gamma}{C_o} T_o\n$$\n这直接给出了系统 $\\frac{dy}{dt} = M y$ 的矩阵 $M$：\n$$\nM = \\begin{bmatrix}\n-\\frac{\\lambda_a + \\gamma}{C_a}  & \\frac{\\gamma}{C_a} \\\\\n\\frac{\\gamma}{C_o}  & -\\frac{\\lambda_o + \\gamma}{C_o}\n\\end{bmatrix}\n$$\n参数的单位以焦耳（J）、瓦特（W = J/s）、米（m）和开尔文（K）给出。矩阵元素的单位一致为 $s^{-1}$，因此系统的自然时间单位是秒。\n\n#### 2. 使用特征分解求解系统\n初值问题的解是 $y(t) = e^{Mt} y(0)$。一种计算上高效且分析上有洞察力的评估方法是通过对 $M$ 进行特征分解。令 $M = P D P^{-1}$，其中 $D$ 是由 $M$ 的特征值 $\\mu_i$ 构成的对角矩阵，而 $P$ 是一个列为相应特征向量 $v_i$ 的矩阵。\n于是，解可以表示为系统模态的线性组合：\n$$\ny(t) = P e^{Dt} P^{-1} y(0)\n$$\n其中 $e^{Dt}$ 是一个对角项为 $e^{\\mu_i t}$ 的对角矩阵。如果我们定义 $c = P^{-1} y(0)$ 作为初始条件 $y(0)$ 在特征向量基中的表示，那么解就变为：\n$$\ny(t) = \\sum_{i} c_i e^{\\mu_i t} v_i\n$$\n这种形式明确地将演变过程显示为指数衰减模态的叠加。\n\n#### 3. 计算所需量\n所有基于时间的计算将以国际单位制（秒）进行，并仅在最终输出时使用转换因子 $1 \\text{ 天} = 86400 \\text{ 秒}$ 转换为天。\n\n**a. 主导 e-折时间尺度：**\n系统的模态以特征值 $\\mu_i$ 的实部给出的速率衰减。由于系统是稳定的，这些实部都是负数。最慢衰减的模态对应于模最小（即最接近零）的特征值，我们记为 $\\mu_{\\text{slow}} = \\max_i(\\mathrm{Re}(\\mu_i))$。此模态的 e-折时间尺度 $\\tau_{\\text{dom}}$ 是其振幅衰减到 $e^{-1}$ 倍所需的时间，定义为 $\\tau_{\\text{dom}} = -1/\\mu_{\\text{slow}}$。这个时间尺度是系统的内在属性，与初始条件无关。\n\n**b. 初始调整时间尺度：**\n对于每种初始化策略（FF 和 AI），我们必须找到最早的时间 $t \\ge 0$，使得海-气不匹配 $d(t) = T_a(t) - T_o(t)$ 衰减到其初始值的 $\\alpha$ 分数，即 $|d(t)| \\le \\alpha |d(0)|$。\n- 首先，我们检查 $|d(0)| = |T_a(0) - T_o(0)|$ 是否为零。如果是，根据定义，调整时间为 $0$。\n- 否则，我们以 $\\Delta t = 1$ 小时的时间步长计算指定窗口 $[0, t_{\\mathrm{end}}]$ 内的解轨迹 $y(t)$。\n- 在每个时间步，我们评估 $|d(t)|$ 并将其与阈值 $\\alpha |d(0)|$ 进行比较。第一次满足该条件的时间即为结果。\n- 如果在窗口内未满足该条件，我们报告 $t_{\\mathrm{end}}$。\n\n**c. 漂移振幅度量：**\n问题要求每个测试用例提供一个单一的漂移振幅指标。气候漂移最显著地与具有大不平衡的不佳初始化相关。全场（FF）初始化旨在表示这种情况，而异常初始化（AI）旨在最小化它。因此，科学上最有意义的解释是使用由 FF 初始化产生的轨迹 $y_{\\mathrm{FF}}(t)$ 来计算漂移振幅。该度量是分析窗口内海洋温度异常绝对值的最大值：$\\max_{t \\in [0, t_{\\mathrm{end}}]} |T_o(t)|$。这可以通过在用于时间尺度搜索的相同时间网格上评估 $|T_o(t)|$ 并找到其最大值来获得。\n\n### 算法摘要\n对于每个测试用例：\n1.  根据给定的物理参数构建矩阵 $M$。\n2.  计算 $M$ 的特征值。计算以天为单位的主导 e-折时间尺度 $\\tau_{\\text{dom}}$。\n3.  计算 $M$ 的特征分解（特征值 $\\mu$ 和特征向量 $P$）。\n4.  定义一个从 0 到 2000 天的时间网格，步长为 1 小时，并转换为秒。\n5.  **对于全场初始化 $y_{\\mathrm{FF}}(0)$：**\n    a. 在时间网格上计算轨迹 $y_{\\mathrm{FF}}(t)$。\n    b. 计算以天为单位的初始调整时间尺度。\n    c. 从该轨迹计算漂移振幅度量 $\\max|T_o(t)|$。\n6.  **对于异常初始化 $y_{\\mathrm{AI}}(0)$：**\n    a. 在时间网格上计算轨迹 $y_{\\mathrm{AI}}(t)$。\n    b. 计算以天为单位的初始调整时间尺度。\n7.  收集四个结果：$[\\tau_{\\text{dom}}, t_{\\text{FF,adjust}}, t_{\\mathrm{AI,adjust}}, \\text{Drift Amplitude}_{\\mathrm{FF}}]$。\n最终输出是一个包含所有四个测试用例的结果列表的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled ocean-atmosphere model problem for the given test cases.\n    \"\"\"\n\n    # --- Constants ---\n    S_PER_DAY = 86400.0\n    S_PER_HOUR = 3600.0\n    ALPHA = 0.05\n    T_END_DAYS = 2000.0\n    DT_HOURS = 1.0\n\n    # --- Test Cases ---\n    test_cases = [\n        {\n            \"params\": (1.0e7, 4.0e8, 1.2, 0.5, 20.0), # Ca, Co, la, lo, g\n            \"y0_ff\": np.array([2.0, 0.0]),\n            \"y0_ai\": np.array([1.0, 1.0]),\n        },\n        {\n            \"params\": (1.0e7, 4.0e8, 1.2, 0.5, 2.0),\n            \"y0_ff\": np.array([2.0, 0.0]),\n            \"y0_ai\": np.array([1.0, 1.0]),\n        },\n        {\n            \"params\": (1.0e7, 4.0e8, 1.2, 0.5, 60.0),\n            \"y0_ff\": np.array([0.5, 0.0]),\n            \"y0_ai\": np.array([0.5, 0.5]),\n        },\n        {\n            \"params\": (1.0e7, 4.0e8, 1.2, 0.5, 20.0),\n            \"y0_ff\": np.array([1.0, 1.0]),\n            \"y0_ai\": np.array([1.0, 1.0]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(calculate_metrics(case, S_PER_DAY, S_PER_HOUR, ALPHA, T_END_DAYS, DT_HOURS))\n\n    # Format the final output string\n    output_str = \"[\" + \", \".join([f\"[{', '.join(f'{x:.6f}' for x in r)}]\" for r in results]) + \"]\"\n    print(output_str)\n\ndef get_trajectory(y0, mu, P, t_vals_sec):\n    \"\"\"\n    Calculates the trajectory y(t) = exp(Mt)y0 using eigendecomposition.\n    \n    Args:\n        y0 (np.ndarray): Initial condition vector [Ta(0), To(0)].\n        mu (np.ndarray): Eigenvalues of matrix M.\n        P (np.ndarray): Matrix of eigenvectors of M.\n        t_vals_sec (np.ndarray): Array of time points in seconds.\n    \n    Returns:\n        np.ndarray: Trajectory y(t) of shape (2, len(t_vals_sec)).\n    \"\"\"\n    try:\n        P_inv = np.linalg.inv(P)\n    except np.linalg.LinAlgError:\n        # P should always be invertible for distinct eigenvalues.\n        # Handle cases of non-invertible P if necessary, though unlikely here.\n        return None\n        \n    c = P_inv @ y0  # Coefficients in the eigenvector basis\n    \n    # an (N_times, 2) array where each row is [exp(mu1*t), exp(mu2*t)]\n    exp_term = np.exp(np.outer(t_vals_sec, mu))\n    \n    # Calculate components in eigenvector basis over time\n    # (N_times, 2) * (2,) -> (N_times, 2) via broadcasting\n    y_t_components = exp_term * c\n    \n    # Transform back to original basis\n    # (2, 2) @ (2, N_times) -> (2, N_times)\n    y_t = P @ y_t_components.T\n    \n    return y_t\n\ndef find_adjustment_time(y0, mu, P, t_vals_sec, alpha, t_end_days, s_per_day):\n    \"\"\"\n    Calculates the initial adjustment timescale for a given initialization.\n    \"\"\"\n    d0 = y0[0] - y0[1]\n    \n    if np.isclose(d0, 0.0):\n        return 0.0\n\n    y_t = get_trajectory(y0, mu, P, t_vals_sec)\n    d_t = y_t[0, :] - y_t[1, :]\n    \n    threshold_val = alpha * abs(d0)\n    \n    # Find the indices where the condition is met\n    indices = np.where(np.abs(d_t) = threshold_val)[0]\n    \n    if len(indices) == 0:\n        return t_end_days\n    else:\n        first_idx = indices[0]\n        t_thresh_sec = t_vals_sec[first_idx]\n        return t_thresh_sec / s_per_day\n\ndef calculate_metrics(case, s_per_day, s_per_hour, alpha, t_end_days, dt_hours):\n    \"\"\"\n    Calculates all required metrics for a single test case.\n    \"\"\"\n    Ca, Co, la, lo, g = case[\"params\"]\n    y0_ff = case[\"y0_ff\"]\n    y0_ai = case[\"y0_ai\"]\n    \n    # 1. Construct matrix M\n    M = np.array([\n        [-(la + g) / Ca, g / Ca],\n        [g / Co, -(lo + g) / Co]\n    ])\n    \n    # 2. Dominant e-folding timescale\n    mu, P = np.linalg.eig(M)\n    # Eigenvalues are negative real for a stable system\n    mu_slow = np.max(mu.real)\n    tau_dom_sec = -1.0 / mu_slow\n    tau_dom_days = tau_dom_sec / s_per_day\n\n    # 3. Setup time grid for search\n    t_end_sec = t_end_days * s_per_day\n    dt_sec = dt_hours * s_per_hour\n    t_vals_sec = np.arange(0, t_end_sec + dt_sec, dt_sec)\n\n    # 4. Adjustment timescale for Full-Field (FF)\n    t_thresh_ff_days = find_adjustment_time(y0_ff, mu, P, t_vals_sec, alpha, t_end_days, s_per_day)\n\n    # 5. Adjustment timescale for Anomaly Initialization (AI)\n    t_thresh_ai_days = find_adjustment_time(y0_ai, mu, P, t_vals_sec, alpha, t_end_days, s_per_day)\n    \n    # 6. Drift amplitude metric (from FF initialization)\n    y_t_ff = get_trajectory(y0_ff, mu, P, t_vals_sec)\n    To_t_ff = y_t_ff[1, :]\n    max_To_ff = np.max(np.abs(To_t_ff))\n\n    return [\n        round(tau_dom_days, 6),\n        round(t_thresh_ff_days, 6),\n        round(t_thresh_ai_days, 6),\n        round(max_To_ff, 6)\n    ]\n\nsolve()\n\n```"
        }
    ]
}