{
    "hands_on_practices": [
        {
            "introduction": "在研究溢流和密集水级联的动力学之前，我们必须首先量化驱动这一过程的基本力量。这个练习的核心是计算溢流和周围环境水体之间的密度差异所产生的浮力，这通常用“折减重力”$g'$来表示。通过一个关于地中海溢流的实际案例，您将学习如何利用线性状态方程，从温度和盐度异常等基本海洋学数据中推导出这一关键的动力学参数。",
            "id": "3810011",
            "problem": "一股稠密的地中海溢流羽流流出直布罗陀海峡，侵入大西洋，并开始沿大陆坡下沉。假设采用 Boussinesq 近似（即除浮力项外，参考密度为常数）、主导阶的静水力平衡，以及围绕一个参考状态的线性化状态方程。该参考状态的特征为参考密度 $\\rho_{0}$、热膨胀系数 $\\alpha$ 和盐缩系数 $\\beta$。这些系数在海槛附近的一个代表性参考状态下取值，并且对于小的异常值，它们被视为常数。根据定义，$\\alpha$ 和 $\\beta$ 满足\n$$\n\\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p}, \\qquad\n\\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p}.\n$$\n在海槛处，大西洋环境水体与溢流水源的盐度和温度异常值（溢流水减去环境水）分别为 $\\Delta S = +\\,2.5~\\text{g}~\\text{kg}^{-1}$ 和 $\\Delta T = +\\,2.0~\\text{K}$。设参考密度为 $\\rho_{0}=1027~\\text{kg}~\\text{m}^{-3}$，热膨胀系数为 $\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$，盐缩系数为 $\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$，重力加速度为 $g = 9.81~\\text{m}~\\text{s}^{-2}$。\n\n从线性化状态方程和浮力的定义 $b \\equiv -g(\\rho-\\rho_{a})/\\rho_{0}$（适用于羽流和环境水体（密度为 $\\rho_{a}$）之间的小密度差）出发，首先计算由给定的 $\\Delta S$ 和 $\\Delta T$ 所蕴含的密度差 $\\Delta \\rho \\equiv \\rho_{\\text{overflow}}-\\rho_{\\text{ambient}}$。然后，计算决定羽流初始浮力大小的约化重力 $g'$，其定义为 $|b| = g'$。对于这些小的异常值，状态方程所受的压力效应可忽略不计。\n\n只需报告约化重力 $g'$ 的值，单位为 $\\text{m}~\\text{s}^{-2}$，并四舍五入到四位有效数字。不要在最终答案中报告 $\\Delta \\rho$，尽管你必须计算它才能得到 $g'$。",
            "solution": "该问题是有效的，因为它具有科学依据，提法恰当，并且提供了所有必要的数据和定义。我们可以开始求解。\n\n第一步是使用提供的线性化状态方程来确定密度差 $\\Delta \\rho \\equiv \\rho_{\\text{overflow}} - \\rho_{\\text{ambient}}$。密度 $\\rho$ 是温度 $T$ 和盐度 $S$ 的函数。对于温度 $\\Delta T$ 和盐度 $\\Delta S$ 与环境参考状态 $(T_a, S_a)$ 的微小偏差，密度异常 $\\Delta \\rho$ 可通过一阶泰勒展开近似为：\n$$ \\Delta \\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{T_a, S_a} \\Delta T + \\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T_a, S_a} \\Delta S $$\n问题给出了热膨胀系数 $\\alpha$ 和盐缩系数 $\\beta$ 的定义：\n$$ \\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p} $$\n$$ \\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p} $$\n在这些定义中使用参考密度 $\\rho_0$ 来近似 $\\rho$（这与 Boussinesq 近似一致），我们可以将偏导数表示为：\n$$ \\left(\\frac{\\partial \\rho}{\\partial T}\\right) \\approx -\\rho_{0}\\alpha $$\n$$ \\left(\\frac{\\partial \\rho}{\\partial S}\\right) \\approx \\rho_{0}\\beta $$\n将这些代入泰勒展开式，得到密度差的表达式：\n$$ \\Delta \\rho \\approx \\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S) $$\n问题给出了以下数值：$\\rho_{0} = 1027~\\text{kg}~\\text{m}^{-3}$，$\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$，$\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$，$\\Delta T = +2.0~\\text{K}$，以及 $\\Delta S = +2.5~\\text{g}~\\text{kg}^{-1}$。\n我们首先计算括号中的项，它代表相对密度异常 $\\Delta \\rho / \\rho_0$：\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -(2.00 \\times 10^{-4}~\\text{K}^{-1})(2.0~\\text{K}) + (7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1})(2.5~\\text{g}~\\text{kg}^{-1}) $$\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -4.00 \\times 10^{-4} + 18.75 \\times 10^{-4} = 14.75 \\times 10^{-4} $$\n由于该项为正，密度差 $\\Delta \\rho$ 也为正，这意味着溢流羽流的密度大于环境水，这在物理上与其下沉的现象是一致的。\n密度差为 $\\Delta \\rho \\approx (1027~\\text{kg}~\\text{m}^{-3}) \\times (14.75 \\times 10^{-4}) \\approx 1.515~\\text{kg}~\\text{m}^{-3}$。\n\n接下来，我们计算约化重力 $g'$。它被定义为浮力的大小 $|b|$，其中浮力 $b$ 由下式给出：\n$$ b \\equiv -g\\frac{\\rho-\\rho_{a}}{\\rho_{0}} = -g\\frac{\\Delta \\rho}{\\rho_{0}} $$\n那么约化重力为：\n$$ g' = |b| = \\left| -g\\frac{\\Delta \\rho}{\\rho_{0}} \\right| = g\\frac{|\\Delta \\rho|}{\\rho_{0}} $$\n因为我们发现 $\\Delta \\rho > 0$，所以有 $|\\Delta \\rho| = \\Delta \\rho$。约化重力的表达式变为：\n$$ g' = g\\frac{\\Delta \\rho}{\\rho_{0}} $$\n代入我们关于 $\\Delta \\rho$ 的表达式：\n$$ g' = g\\frac{\\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S)}{\\rho_{0}} = g(-\\alpha \\Delta T + \\beta \\Delta S) $$\n现在我们代入数值。我们有 $g = 9.81~\\text{m}~\\text{s}^{-2}$，并且括号中表达式的值为 $14.75 \\times 10^{-4}$。\n$$ g' = (9.81~\\text{m}~\\text{s}^{-2}) \\times (14.75 \\times 10^{-4}) $$\n$$ g' = 0.01446975~\\text{m}~\\text{s}^{-2} $$\n题目要求答案保留 $4$ 位有效数字。将计算值四舍五入得到：\n$$ g' \\approx 0.01447~\\text{m}~\\text{s}^{-2} $$\n这就是约化重力的最终值。",
            "answer": "$$\n\\boxed{0.01447}\n$$"
        },
        {
            "introduction": "一旦密集水体开始流动，其行为就由惯性与浮力之间的平衡决定。这个练习将引导您推导并计算一个关键的无量纲参数——内部弗劳德数（Froude number）$Fr$。理解$Fr$的值如何区分亚临界流和超临界流，对于掌握溢流如何与海底地形相互作用以及信息（如内部波）如何在流中传播至关重要，这是水力控制理论的核心。",
            "id": "3810000",
            "problem": "一层厚度为 $h$ 的稠密溢流在一个厚得多的环境层之下沿大陆坡向下流动，该系统在静力近似、Boussinesq近似和长波（浅水）极限下被理想化为一个双层系统。在此类流动中，水力控制和稠密水瀑布的形成由一个无量纲比率决定，该比率比较了水流的平流速度与分层系统的长内重力波速。从双层浅水框架出发，推导用于描述水力控制的无量纲量度（用折减重力 $g'$ 和活跃层厚度 $h$ 表示），然后利用溢流参数 $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$、$h = 150\\,\\mathrm{m}$ 和流速 $U = 0.6\\,\\mathrm{m\\,s^{-1}}$ 对其进行计算。根据您的推导，结合稠密溢流的亚临界与超临界状态来解释计算出的值，并说明该分类在内波上游通讯方面的物理意义。将您的最终数值四舍五入至三位有效数字，并以无量纲数的形式报告。",
            "solution": "用户提供了一个地球物理流体动力学领域的问题，具体涉及双层海洋模型中的稠密溢流。问题要求推导控制水力控制的无量纲数，根据给定参数计算其值，并解释其物理意义。\n\n首先根据指定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n- 系统描述：一层厚度为 $h$ 的稠密溢流在一个厚得多的环境层之下沿大陆坡向下流动。\n- 理想化条件：双层系统、静力近似、Boussinesq近似、长波（浅水）极限。\n- 控制现象：水力控制与稠密水瀑布的形成。\n- 控制物理原理：平流速度（$U$）与长内重力波速的比较。\n- 推导项：折减重力 $g'$ 和活跃层厚度 $h$。\n- 用于计算的参数：\n  - 折减重力，$g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n  - 活跃层厚度，$h = 150\\,\\mathrm{m}$\n  - 流速，$U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n- 要求输出：\n  - 无量纲量度的推导。\n  - 该量度的计算值，四舍五入至三位有效数字。\n  - 根据流动状态（亚临界/超临界）对该值的解释及其与内波上游通讯的关系。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学性：** 该问题基于成熟的双层浅水模型，这是地球物理流体动力学研究分层流的基石。折减重力、长内波以及用于水力控制的内弗劳德数等概念都是基本且符合事实的。所提供的 $g'$、$h$ 和 $U$ 的数值对于海洋稠密水溢流是物理上现实的。\n- **适定性：** 问题陈述清晰，包含了推导所需量、计算其值并提供物理解释的所有必要信息。存在唯一的、有意义的解。假设环境层“厚得多”是一个标准且必要的条件，用以将双层系统简化为一层半（或折减重力）模型，其中上层在动力学上是不活跃的。\n- **客观性：** 问题以精确的技术语言表述，没有任何主观性或偏见。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**，因为它科学合理、适定、客观且完整。将提供完整解答。\n\n### 解答推导与解释\n\n问题要求推导控制双层系统中水力控制的无量纲量度。这个量度是内弗劳德数，即流速与长内重力波速之比。我们首先推导这些波的速度。\n\n考虑一个双层流体系统，它有一个厚度为 $h$、速度为 $u$ 的活跃、稠密的底层，以及一个深的、静止的上层。应用Boussinesq近似。在长波极限下，底层的控制方程是为双层系统修正的浅水方程。\n\n下层（活跃层）的动量方程为：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = - \\frac{1}{\\rho_1} \\frac{\\partial p}{\\partial x} $$\n其中 $\\rho_1$ 是下层的密度，$p$ 是压力。下层内深度 $z$ 处的压力由其上方流体的重量决定。设界面高度为 $h(x,t)$，自由表面高度为 $\\eta(x,t)$。假设上层无限深且静止（折减重力模型），界面处的压力梯度驱动流动。活跃层内的水平压力梯度力由界面坡度引起，可得：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = -g' \\frac{\\partial h}{\\partial x} $$\n这里，$g' = g \\frac{\\rho_1 - \\rho_2}{\\rho_0}$ 是折减重力，其中 $\\rho_2$ 是上层密度，$\\rho_0$ 是参考密度。该方程考虑了界面处的浮力。\n\n活跃层的连续性方程为：\n$$ \\frac{\\partial h}{\\partial t} + \\frac{\\partial (uh)}{\\partial x} = 0 $$\n\n为求长内波的速度，我们对这两个方程围绕静止状态（$u_0=0$）和恒定平均厚度 $h_0$ 进行小扰动线性化。设 $u = u'$，$h = h_0 + h'$，其中 $u'$ 和 $h'$ 是小扰动。\n\n线性化的动量方程变为：\n$$ \\frac{\\partial u'}{\\partial t} = -g' \\frac{\\partial h'}{\\partial x} $$\n\n线性化的连续性方程变为：\n$$ \\frac{\\partial h'}{\\partial t} + h_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\n为了得到波动方程，我们将动量方程对 $x$ 求导，将连续性方程对 $t$ 求导：\n$$ \\frac{\\partial^2 u'}{\\partial t \\partial x} = -g' \\frac{\\partial^2 h'}{\\partial x^2} $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\frac{\\partial^2 u'}{\\partial t \\partial x} = 0 $$\n\n将第一个表达式代入第二个，得到：\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\left( -g' \\frac{\\partial^2 h'}{\\partial x^2} \\right) = 0 $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} = g' h_0 \\frac{\\partial^2 h'}{\\partial x^2} $$\n这是标准的一维波动方程 $\\frac{\\partial^2 \\psi}{\\partial t^2} = c^2 \\frac{\\partial^2 \\psi}{\\partial x^2}$。通过比较，长内重力波的相速度 $c_i$ 为：\n$$ c_i = \\sqrt{g' h_0} $$\n对于本问题，相关厚度是层厚度 $h$。因此，$c_i = \\sqrt{g' h}$。\n\n用于水力控制的无量纲量度，即内弗劳德数 ($Fr$)，定义为特征流速 $U$ 与内波速度 $c_i$之比。\n$$ Fr = \\frac{U}{c_i} = \\frac{U}{\\sqrt{g' h}} $$\n这就是推导出的无量纲量度。\n\n现在，我们使用给定的参数计算这个弗劳德数：\n$g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n$h = 150\\,\\mathrm{m}$\n$U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n\n首先，我们计算内波速度 $c_i$：\n$$ c_i = \\sqrt{g' h} = \\sqrt{(0.02\\,\\mathrm{m\\,s^{-2}}) \\times (150\\,\\mathrm{m})} = \\sqrt{3.0\\,\\mathrm{m^2\\,s^{-2}}} = \\sqrt{3}\\,\\mathrm{m\\,s^{-1}} $$\n波速的数值约为 $c_i \\approx 1.732\\,\\mathrm{m\\,s^{-1}}$。\n\n接下来，我们计算弗劳德数：\n$$ Fr = \\frac{U}{c_i} = \\frac{0.6\\,\\mathrm{m\\,s^{-1}}}{\\sqrt{3}\\,\\mathrm{m\\,s^{-1}}} = \\frac{0.6}{\\sqrt{3}} $$\n数值上，这等于：\n$$ Fr \\approx 0.34641016... $$\n四舍五入至三位有效数字，弗劳德数为 $0.346$。\n\n### 解释\n\n计算出的弗劳德数为 $Fr \\approx 0.346$。流动状态根据 $Fr$ 相对于 $1$ 的值进行分类：\n- $Fr  1$：流动为**亚临界**。\n- $Fr = 1$：流动为**临界**。\n- $Fr > 1$：流动为**超临界**。\n\n由于 $Fr \\approx 0.346  1$，溢流处于**亚临界**状态。\n\n此分类的物理意义与信息的传播有关，信息以波速 $c_i$ 传播。\n- 在**亚临界**流 ($U  c_i$) 中，内波可以向上游和下游传播。这意味着关于下游条件（例如，地形变化、障碍物）的信息可以逆流向上传播。因此，流动能够对下游的控制做出调整；它与整个流动区域是“通讯连接”的。\n- 在**超临界**流 ($U > c_i$) 中，水流速度快于任何内波。因此，所有信息都被冲向下游。扰动无法向上传播，因此流动“不知道”下游的条件。其状态完全由上游条件决定。\n- **临界**流 ($U = c_i$) 代表一种特殊状态，此时流动在亚临界和超临界之间转换。这被称为水力控制，通常发生在地形收缩处，如海槛或狭窄通道。在这样的点上，流动发生“壅塞”，该条件设定了稠密水瀑布的输运率。流动通过控制点时，从亚临界状态加速到超临界状态。\n\n对于给定的参数，流动的亚临界性质意味着 $0.6\\,\\mathrm{m\\,s^{-1}}$ 的流速尚不足以阻止内波向上游通讯，内波的传播速度约为 $1.73\\,\\mathrm{m\\,s^{-1}}$。",
            "answer": "$$ \\boxed{0.346} $$"
        },
        {
            "introduction": "理论知识的最终目的是应用于实际预测。这个综合性练习要求您将之前学到的概念——如浮力驱动（$g'$）、水力控制（$Fr=1$）和卷挟过程——整合起来，从第一性原理出发，构建一个简化但动态一致的溢流参数化方案。通过这个练习，您将亲身体验如何将物理定律转化为一个计算工具，用于预测溢流在下降过程中的路径、最终注入深度和输运量，这正是大规模海洋和气候模型中表示次网格过程的核心思想。",
            "id": "3810057",
            "problem": "要求您设计并实现一个最小但动态一致的参数化方案，用于描述稠密溢流沿斜坡向下流入分层环境海洋的过程。目标是针对每个指定的源和斜坡配置，使用一个满足静力平衡和海槛处临界控制的约化重力、夹带重力流模型，计算下游的中性浮力注入深度及相关的输运量。您编写的程序必须对所有测试用例执行相同的计算，并在一个聚合输出中返回它们的结果。\n\n该参数化方案必须从以下计算海洋学的基础原理推导得出：\n- 稳定分层流体中缓慢变化的运动所满足的静力平衡。\n- 针对小密度差异的Boussinesq近似，其中动量仅通过浮力依赖于密度异常。\n- 溢流层的质量守恒，该层被视为厚度为$h$、宽度为$W$、沿斜坡向下运动速度为$U$的层。\n- 海槛处的控制条件，即顺流弗劳德数在控制点等于1，并在下游保持为1的量级。\n- 经典的重力流夹带闭合方案，其中层顶的夹带速度与层速度成正比。\n\n您必须仅从这些基础原理出发，推导出一个封闭系统，该系统能够沿下坡方向演化溢流，直至其达到中性浮力深度。中性浮力深度定义为演化中的层平均密度与同一深度的环境密度相等。您的推导和算法必须纯粹基于这些原理，不得以任何专门的溢流公式作为起点。\n\n定义、几何结构和闭合方案：\n- 设$x$为沿坡坐标，单位为$\\mathrm{m}$，从$x=0$处的海槛顶部开始测量。设$z$为深度，单位为$\\mathrm{m}$，向下为正，随着羽流下降，$z(x)$增加。底部具有恒定坡度$s = \\mathrm{d}z/\\mathrm{d}x$（无量纲）。\n- 环境密度剖面随深度呈线性变化，$\\rho_{a}(z) = \\rho_{0} + \\gamma z$，其中$\\rho_{0}$是参考密度，单位为$\\mathrm{kg\\,m^{-3}}$，$\\gamma$是恒定的密度梯度，单位为$\\mathrm{kg\\,m^{-4}}$。\n- 溢流在$x=0$处、深度$z(0)=z_{0}$处初始化，其源输运量为$Q_{s}$（单位$\\mathrm{m^{3}\\,s^{-1}}$），源层平均密度为$\\rho_{s}$（单位$\\mathrm{kg\\,m^{-3}}$），并具有固定的宽度$W$（单位$\\mathrm{m}$）。重力加速度为$g$（单位$\\mathrm{m\\,s^{-2}}$）。\n- 设$\\rho(x)$表示溢流演化中的层平均密度，其输运量为$Q(x)$（单位$\\mathrm{m^{3}\\,s^{-1}}$）。约化重力为$g'(x) = g\\left(\\rho(x) - \\rho_{a}(z(x))\\right)/\\rho_{0}$，要求当水流比环境水体更稠密时，$g'(x)\\ge 0$。\n- 设夹带速度为$w_{e} = \\alpha_{e} U$，其中$\\alpha_{e}$是一个恒定的夹带系数（无量纲），$U$是沿坡的层速度，单位为$\\mathrm{m\\,s^{-1}}$。\n- 控制条件是弗劳德数$Fr = U/\\sqrt{g'h}$为1的量级；在海槛处取其为1，并始终使用此临界性与质量守恒一起闭合系统。\n\n基于这些基础，推导出$Q(x)$、$\\rho(x)$和$z(x)$在沿坡坐标$x$上的控制演化系统，并说明如何确定中性浮力注入深度$z_{\\mathrm{inj}}$，使得$\\rho(x_{\\mathrm{inj}}) = \\rho_{a}(z_{\\mathrm{inj}})$，其中$x_{\\mathrm{inj}}$是相应的沿坡距离。如果水流在海槛顶部不比环境水体稠密，则取$z_{\\mathrm{inj}} = z_{0}$，下游输运量等于$Q_{s}$。如果水流在下降到最大允许深度$z_{\\max}$时仍然比环境水体稠密，则设$z_{\\mathrm{inj}}=z_{\\max}$，输运量等于在此处达到的输运量。\n\n实现要求：\n- 使用与上述推导系统和假设一致的显式方法，实现$x$方向的数值积分。使用固定的步长$\\Delta x$，并通过在中性条件被跨越时停止积分来确保数值稳定性。使用最后两个点之间的线性插值来估算$z_{\\mathrm{inj}}$和中性浮力处的输运量，以提高准确性。通过一旦达到中性浮力就停止积分，并在推进过程中强制约化重力的非负性，来防止除以零或对负数取实数根。\n- 对所有情况使用以下恒定参数：参考密度$\\rho_{0} = 1027.0\\,\\mathrm{kg\\,m^{-3}}$，重力加速度$g = 9.81\\,\\mathrm{m\\,s^{-2}}$，夹带系数$\\alpha_{e} = 0.001$，步长$\\Delta x = 10\\,\\mathrm{m}$，最大允许深度$z_{\\max} = 3000\\,\\mathrm{m}$。\n- 您的程序必须为每个案例计算由注入深度和相应输运量组成的对，单位均为国际单位制（SI）。最终注入深度以$\\mathrm{m}$表示，最终输运量以$\\mathrm{m^{3}\\,s^{-1}}$表示，每个值都四舍五入到小数点后三位。\n\n测试套件：\n对于以下每个测试用例，使用所述算法计算注入深度和输运量。每个未列出的参数都继承上述共享常数。\n\n- 案例A（理想情况，中等坡度和强源）：\n  - 宽度$W = 15000\\,\\mathrm{m}$，海槛深度$z_{0} = 600\\,\\mathrm{m}$，源密度$\\rho_{s} = 1028.2\\,\\mathrm{kg\\,m^{-3}}$，源输运量$Q_{s} = 1.2\\times 10^{6}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度$\\gamma = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度$s = 0.010$。\n- 案例B（缓坡，弱源）：\n  - 宽度$W = 20000\\,\\mathrm{m}$，海槛深度$z_{0} = 800\\,\\mathrm{m}$，源密度$\\rho_{s} = 1028.0\\,\\mathrm{kg\\,m^{-3}}$，源输运量$Q_{s} = 6.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度$\\gamma = 6.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度$s = 0.003$。\n- 案例C（较窄溢流，陡坡）：\n  - 宽度$W = 8000\\,\\mathrm{m}$，海槛深度$z_{0} = 500\\,\\mathrm{m}$，源密度$\\rho_{s} = 1028.5\\,\\mathrm{kg\\,m^{-3}}$，源输运量$Q_{s} = 8.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度$\\gamma = 4.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度$s = 0.020$。\n- 案例D（边界情况，勉强稠密的源）：\n  - 宽度$W = 12000\\,\\mathrm{m}$，海槛深度$z_{0} = 700\\,\\mathrm{m}$，环境梯度$\\gamma = 7.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，源密度选择为比海槛处的环境密度略大，$\\rho_{s} = \\rho_{0} + \\gamma z_{0} + 0.05\\,\\mathrm{kg\\,m^{-3}}$，源输运量$Q_{s} = 4.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，坡度$s = 0.006$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、按上述测试用例顺序排列的、逗号分隔的对列表。每个对本身必须是$[z_{\\mathrm{inj}}, Q_{\\mathrm{inj}}]$顺序的双元素列表，两个条目都按规定四舍五入到小数点后三位，并使用SI单位。例如，对于两个假设的案例，一个有效的输出将如下所示：[[1000.000,500000.000],[1200.500,750000.250]]。",
            "solution": "该问题是有效的。它提出了一个在计算海洋学领域中定义明确、有科学依据的任务，基于已建立的流体动力学基本原理。所有必要的数据和定义都已提供，并且没有内部矛盾或歧义。\n\n该问题要求推导并实现一个稠密溢流的参数化方案。目标是确定一个重力流沿斜坡下降的中性浮力注入深度$z_{\\mathrm{inj}}$和相应的输运量$Q_{\\mathrm{inj}}$。推导将基于质量和密度守恒、Boussinesq近似下的静力平衡、临界弗劳德数条件以及夹带闭合等原理。\n\n溢流的状态由其输运量$Q(x)$、层平均密度$\\rho(x)$和深度$z(x)$描述，其中$x$是沿坡坐标。我们将为这些变量推导出一个常微分方程（ODEs）系统。\n\n**1. 几何与运动学关系**\n\n几何结构由恒定的底坡$s = \\mathrm{d}z/\\mathrm{d}x$定义。结合初始条件$z(0) = z_0$对此进行积分，得到羽流深度作为沿坡距离的函数：\n$$\nz(x) = z_0 + s x\n$$\n输运量$Q(x)$定义为流经溢流横截面的体积通量，该横截面宽度为$W$，厚度为$h(x)$，层平均速度为$U(x)$：\n$$\nQ(x) = U(x) W h(x)\n$$\n\n**2. 质量守恒与夹带**\n\n问题陈述，溢流以夹带速度$w_e = \\alpha_e U$的速率夹带环境水。在距离$dx$上，输运量的增加量$dQ$是在该段上夹带的水的体积，该段的表面积为$W dx$。\n$$\ndQ = w_e (W dx) = (\\alpha_e U) W dx\n$$\n这给出了第一个用于输运量演化的ODE：\n$$\n\\frac{dQ}{dx} = \\alpha_e W U(x)\n$$\n\n**3. 密度演化**\n\n溢流的密度$\\rho(x)$因夹带了密度为$\\rho_a(z(x))$的环境水而改变。我们考虑密度示踪剂的守恒。控制体积中的“密度物质”总量为$\\rho Q$。该量的变化$d(\\rho Q)$必须等于由夹带增加的密度物质的量，即$\\rho_a(z) dQ$。\n$$\nd(\\rho Q) = \\rho_a(z) dQ\n$$\n两边除以$dx$并对左侧使用微分的乘积法则：\n$$\n\\rho \\frac{dQ}{dx} + Q \\frac{d\\rho}{dx} = \\rho_a(z) \\frac{dQ}{dx}\n$$\n整理得到密度演化的方程，我们获得第二个ODE：\n$$\n\\frac{d\\rho}{dx} = \\frac{\\rho_a(z(x)) - \\rho(x)}{Q(x)} \\frac{dQ}{dx}\n$$\n环境密度由线性剖面$\\rho_a(z) = \\rho_0 + \\gamma z$给出。\n\n**4. 动力学闭合：临界弗劳德数**\n\n由于速度$U(x)$未知，该系统尚未闭合。问题通过陈述水流是临界控制的，且弗劳德数为1，来提供一个动力学闭合：\n$$\nFr = \\frac{U}{\\sqrt{g'h}} = 1\n$$\n这意味着$U^2 = g'h$。在Boussinesq近似下，约化重力$g'$定义为：\n$$\ng'(x) = g \\frac{\\rho(x) - \\rho_a(z(x))}{\\rho_0}\n$$\n我们需要用演化中的状态变量$Q$和$\\rho$来表示$U$。从输运量关系式中，我们有$h = Q / (UW)$。将其代入弗劳德数条件：\n$$\nU^2 = g' \\left(\\frac{Q}{UW}\\right) \\implies U^3 = \\frac{g'Q}{W}\n$$\n这得出了速度的表达式：\n$$\nU(x) = \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n这个方程使系统闭合。有了它，输运量的变化率变为：\n$$\n\\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n\n**5. 控制系统的综合与数值实现**\n\n为了数值稳定性和简洁性，直接演化密度异常$\\Delta\\rho(x) = \\rho(x) - \\rho_a(z(x))$会很方便。注意$g'(x) = g \\Delta\\rho(x) / \\rho_0$。$\\Delta\\rho$的导数是：\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a(z(x))}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a}{dz}\\frac{dz}{dx} = \\frac{d\\rho}{dx} - \\gamma s\n$$\n代入$d\\rho/dx$的表达式：\n$$\n\\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s\n$$\n因此，要在$x$上积分的完整ODE系统是：\n1.  $\\displaystyle \\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho(x) Q(x)}{W}\\right)^{1/3}$\n2.  $\\displaystyle \\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s$\n\n**算法：**\n该系统使用步长为$\\Delta x$的显式前向欧拉法求解。\n1.  **初始化**：在$x_0=0$处，设置初始条件：$Q_0 = Q_s$，$z_0 = z_0$，并计算初始密度异常$\\Delta\\rho_0 = \\rho_s - (\\rho_0 + \\gamma z_0)$。\n2.  **初始检查**：如果$\\Delta\\rho_0 \\le 0$，则溢流在海槛处不比环境水体稠密。过程终止，注入参数为$z_{\\mathrm{inj}} = z_0$和$Q_{\\mathrm{inj}} = Q_s$。\n3.  **积分循环**：对于$i = 0, 1, 2, ...$\n    a. 检查终止条件：如果$\\Delta\\rho_i \\le 0$或$z_i \\ge z_{\\max}$，停止积分。\n    b. 计算第$i$步的导数：\n       i. $\\displaystyle \\left(\\frac{dQ}{dx}\\right)_i = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho_i Q_i}{W}\\right)^{1/3}$\n       ii. $\\displaystyle \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i = -\\frac{\\Delta\\rho_i}{Q_i}\\left(\\frac{dQ}{dx}\\right)_i - \\gamma s$\n    c. 存储当前状态$(z_i, Q_i, \\Delta\\rho_i)$。\n    d. 更新状态变量以进行下一步$i+1$：\n       i. $x_{i+1} = x_i + \\Delta x$\n       ii. $z_{i+1} = z_i + s \\Delta x$\n       iii. $Q_{i+1} = Q_i + \\left(\\frac{dQ}{dx}\\right)_i \\Delta x$\n       iv. $\\Delta\\rho_{i+1} = \\Delta\\rho_i + \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i \\Delta x$\n4.  **终结**：\n    a. 如果循环因$z_i \\ge z_{\\max}$而终止，则注入参数为$z_{\\mathrm{inj}} = z_{\\max}$和$Q_{\\mathrm{inj}} = Q_i$。\n    b. 如果循环因$\\Delta\\rho_{i+1} \\le 0$而终止，则中性浮力水平在第$i$步和第$i+1$步之间被跨越。我们使用线性插值找到精确位置。设最后一个$\\Delta\\rho > 0$的状态为$(\\text{prev})$，第一个$\\Delta\\rho \\le 0$的状态为$(\\text{curr})$。插值分数是$f = \\Delta\\rho_{\\text{prev}} / (\\Delta\\rho_{\\text{prev}} - \\Delta\\rho_{\\text{curr}})$。\n    c. 最终的注入深度和输运量是：\n       i. $z_{\\mathrm{inj}} = z_{\\text{prev}} + (z_{\\text{curr}} - z_{\\text{prev}}) \\times f$\n       ii. $Q_{\\mathrm{inj}} = Q_{\\text{prev}} + (Q_{\\text{curr}} - Q_{\\text{prev}}) \\times f$\n5. 最终结果按要求四舍五入到小数点后三位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a parameterization for a dense overflow,\n    computing the neutral-buoyancy injection depth and transport.\n    \"\"\"\n    \n    # Global constants\n    RHO_0 = 1027.0  # Reference density, kg/m^3\n    G = 9.81        # Gravitational acceleration, m/s^2\n    ALPHA_E = 0.001 # Entrainment coefficient, dimensionless\n    DX = 10.0       # Step size for integration, m\n    Z_MAX = 3000.0  # Maximum allowed depth, m\n\n    # Test suite: (W, z0, rho_s, Qs, gamma, s)\n    # rho_s is 'auto' for Case D to be calculated based on other params.\n    test_cases_params = [\n        # Case A: happy path, moderate slope and strong source\n        {'W': 15000.0, 'z0': 600.0, 'rho_s': 1028.2, 'Qs': 1.2e6, 'gamma': 5.0e-4, 's': 0.010, 'case_id': 'A'},\n        # Case B: gentle slope, weaker source\n        {'W': 20000.0, 'z0': 800.0, 'rho_s': 1028.0, 'Qs': 6.0e5, 'gamma': 6.0e-4, 's': 0.003, 'case_id': 'B'},\n        # Case C: narrower overflow, steeper slope\n        {'W': 8000.0, 'z0': 500.0, 'rho_s': 1028.5, 'Qs': 8.0e5, 'gamma': 4.0e-4, 's': 0.020, 'case_id': 'C'},\n        # Case D: edge case, barely dense source\n        {'W': 12000.0, 'z0': 700.0, 'rho_s': 'auto', 'Qs': 4.0e5, 'gamma': 7.0e-4, 's': 0.006, 'case_id': 'D'}\n    ]\n\n    results = []\n\n    for params in test_cases_params:\n        W = params['W']\n        z0 = params['z0']\n        Qs = params['Qs']\n        gamma = params['gamma']\n        s = params['s']\n        \n        # Calculate rho_s for Case D\n        if params['rho_s'] == 'auto':\n            rho_s = RHO_0 + gamma * z0 + 0.05\n        else:\n            rho_s = params['rho_s']\n\n        # Initial conditions\n        x = 0.0\n        z = z0\n        Q = Qs\n        \n        rho_a_0 = RHO_0 + gamma * z0\n        delta_rho = rho_s - rho_a_0\n\n        # Check if plume is dense at the sill\n        if delta_rho = 0:\n            results.append([z0, Qs])\n            continue\n        \n        # Lists to store history for interpolation\n        history = []\n        \n        # Integration loop\n        while True:\n            # Check termination conditions\n            if delta_rho = 0 or z >= Z_MAX:\n                break\n                \n            # Store state before update\n            history.append({'z': z, 'Q': Q, 'delta_rho': delta_rho})\n\n            # Calculate reduced gravity\n            g_prime = (G / RHO_0) * delta_rho\n            \n            # Avoid root of negative number, though loop condition should prevent it\n            if g_prime * Q  0:\n                break\n\n            # Layer speed from critical Froude number condition\n            U = np.cbrt(g_prime * Q / W)\n            \n            # Derivatives\n            dQ_dx = ALPHA_E * W * U\n            d_delta_rho_dx = (-delta_rho / Q) * dQ_dx - gamma * s\n            \n            # Update variables using Forward Euler method\n            x += DX\n            z += s * DX\n            Q += dQ_dx * DX\n            delta_rho += d_delta_rho_dx * DX\n\n        # Finalization\n        if z >= Z_MAX and delta_rho > 0: # Reached max depth while still dense\n            z_inj = Z_MAX\n            q_inj = Q\n        else: # Crossed neutral buoyancy\n            if not history: # Could happen if it's not dense on the first step\n                 results.append([z0, Qs])\n                 continue\n                 \n            prev_state = history[-1]\n            z_prev, Q_prev, delta_rho_prev = prev_state['z'], prev_state['Q'], prev_state['delta_rho']\n            \n            # Current state is the one that terminated the loop\n            z_curr, Q_curr, delta_rho_curr = z, Q, delta_rho\n\n            # Linear interpolation to find where delta_rho is zero\n            if (delta_rho_prev - delta_rho_curr) == 0:\n                # This should not happen if delta_rho is changing\n                fraction = 0.5\n            else:\n                fraction = delta_rho_prev / (delta_rho_prev - delta_rho_curr)\n\n            z_inj = z_prev + (z_curr - z_prev) * fraction\n            q_inj = Q_prev + (Q_curr - Q_prev) * fraction\n            \n        results.append([z_inj, q_inj])\n\n    # Format output as required\n    formatted_pairs = []\n    for z_final, q_final in results:\n        formatted_pairs.append(f\"[{z_final:.3f},{q_final:.3f}]\")\n    \n    final_output_str = f\"[{','.join(formatted_pairs)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}