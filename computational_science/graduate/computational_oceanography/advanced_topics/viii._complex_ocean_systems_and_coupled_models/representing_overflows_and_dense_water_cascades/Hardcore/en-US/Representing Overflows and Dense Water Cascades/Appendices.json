{
    "hands_on_practices": [
        {
            "introduction": "The driving force of any dense water cascade is the excess density of the overflow water relative to the ambient ocean. This exercise  provides foundational practice in quantifying this buoyancy. By applying a linearized equation of state, you will calculate the density contrast and the resulting reduced gravity ($g'$), a parameter that effectively acts as the gravitational acceleration governing the plume's dynamics and is a crucial first step in any overflow analysis.",
            "id": "3810011",
            "problem": "A dense Mediterranean overflow plume exits the Strait of Gibraltar and intrudes into the Atlantic where it begins to descend along the continental slope. Assume the Boussinesq approximation (constant reference density except in buoyancy), hydrostatic balance at leading order, and a linearized equation of state around a reference state characterized by reference density $\\rho_{0}$, thermal expansion coefficient $\\alpha$, and haline contraction coefficient $\\beta$. The coefficients are evaluated at a representative reference state near the sill and treated as constants for small anomalies. By definition, $\\alpha$ and $\\beta$ satisfy\n$$\n\\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p}, \\qquad\n\\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p}.\n$$\nThe Atlantic ambient and the overflow source differ by salinity and temperature anomalies (overflow minus ambient) of $\\Delta S = +\\,2.5~\\text{g}~\\text{kg}^{-1}$ and $\\Delta T = +\\,2.0~\\text{K}$ at the sill. Let the reference density be $\\rho_{0}=1027~\\text{kg}~\\text{m}^{-3}$, the thermal expansion coefficient be $\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$, the haline contraction coefficient be $\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$, and gravitational acceleration be $g = 9.81~\\text{m}~\\text{s}^{-2}$.\n\nStarting from the linearized equation of state and the definition of buoyancy $b \\equiv -g(\\rho-\\rho_{a})/\\rho_{0}$ for small density contrasts between the plume and ambient ($\\rho_{a}$), first compute the density contrast $\\Delta \\rho \\equiv \\rho_{\\text{overflow}}-\\rho_{\\text{ambient}}$ implied by the given $\\Delta S$ and $\\Delta T$. Then evaluate the reduced gravity $g'$ that governs the initial buoyancy magnitude of the plume, defined by $|b| = g'$. Treat pressure effects on the equation of state as negligible for these small anomalies.\n\nReport only the value of the reduced gravity $g'$ in $\\text{m}~\\text{s}^{-2}$, rounded to four significant figures. Do not report $\\Delta \\rho$ in your final answer, although you must compute it to obtain $g'$.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and all necessary data and definitions are provided. We can proceed with the solution.\n\nThe first step is to determine the density contrast, $\\Delta \\rho \\equiv \\rho_{\\text{overflow}} - \\rho_{\\text{ambient}}$, using the provided linearized equation of state. The density $\\rho$ is a function of temperature $T$ and salinity $S$. For small deviations of temperature, $\\Delta T$, and salinity, $\\Delta S$, from an ambient reference state $(T_a, S_a)$, the density anomaly $\\Delta \\rho$ can be approximated by a first-order Taylor expansion:\n$$ \\Delta \\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{T_a, S_a} \\Delta T + \\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T_a, S_a} \\Delta S $$\nThe problem provides the definitions for the thermal expansion coefficient $\\alpha$ and the haline contraction coefficient $\\beta$:\n$$ \\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p} $$\n$$ \\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p} $$\nUsing the reference density $\\rho_0$ to approximate $\\rho$ in these definitions, as is consistent with the Boussinesq approximation, we can express the partial derivatives as:\n$$ \\left(\\frac{\\partial \\rho}{\\partial T}\\right) \\approx -\\rho_{0}\\alpha $$\n$$ \\left(\\frac{\\partial \\rho}{\\partial S}\\right) \\approx \\rho_{0}\\beta $$\nSubstituting these into the Taylor expansion yields the expression for the density contrast:\n$$ \\Delta \\rho \\approx \\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S) $$\nThe problem gives the following values: $\\rho_{0} = 1027~\\text{kg}~\\text{m}^{-3}$, $\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$, $\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$, $\\Delta T = +2.0~\\text{K}$, and $\\Delta S = +2.5~\\text{g}~\\text{kg}^{-1}$.\nLet's first evaluate the term in parentheses, which represents the fractional density anomaly $\\Delta \\rho / \\rho_0$:\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -(2.00 \\times 10^{-4}~\\text{K}^{-1})(2.0~\\text{K}) + (7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1})(2.5~\\text{g}~\\text{kg}^{-1}) $$\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -4.00 \\times 10^{-4} + 18.75 \\times 10^{-4} = 14.75 \\times 10^{-4} $$\nSince this term is positive, the density contrast $\\Delta \\rho$ is positive, meaning the overflow plume is denser than the ambient water, which is physically consistent with its descent.\nThe density contrast is $\\Delta \\rho \\approx (1027~\\text{kg}~\\text{m}^{-3}) \\times (14.75 \\times 10^{-4}) \\approx 1.515~\\text{kg}~\\text{m}^{-3}$.\n\nNext, we evaluate the reduced gravity $g'$. It is defined as the magnitude of the buoyancy, $|b|$, where the buoyancy $b$ is given by:\n$$ b \\equiv -g\\frac{\\rho-\\rho_{a}}{\\rho_{0}} = -g\\frac{\\Delta \\rho}{\\rho_{0}} $$\nThe reduced gravity is then:\n$$ g' = |b| = \\left| -g\\frac{\\Delta \\rho}{\\rho_{0}} \\right| = g\\frac{|\\Delta \\rho|}{\\rho_{0}} $$\nSince we found that $\\Delta \\rho  0$, we have $|\\Delta \\rho| = \\Delta \\rho$. The expression for the reduced gravity becomes:\n$$ g' = g\\frac{\\Delta \\rho}{\\rho_{0}} $$\nSubstituting our expression for $\\Delta \\rho$:\n$$ g' = g\\frac{\\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S)}{\\rho_{0}} = g(-\\alpha \\Delta T + \\beta \\Delta S) $$\nNow we insert the numerical values. We have $g = 9.81~\\text{m}~\\text{s}^{-2}$ and the value of the expression in parentheses is $14.75 \\times 10^{-4}$.\n$$ g' = (9.81~\\text{m}~\\text{s}^{-2}) \\times (14.75 \\times 10^{-4}) $$\n$$ g' = 0.01446975~\\text{m}~\\text{s}^{-2} $$\nThe problem requires the answer to be reported to $4$ significant figures. Rounding the calculated value gives:\n$$ g' \\approx 0.01447~\\text{m}~\\text{s}^{-2} $$\nThis is the final value for the reduced gravity.",
            "answer": "$$\n\\boxed{0.01447}\n$$"
        },
        {
            "introduction": "Once an overflow's buoyancy is established, its dynamic behavior is governed by the competition between its forward velocity and the propagation speed of internal waves. This practice  introduces the internal Froude number ($Fr$), the dimensionless ratio that quantifies this relationship. Understanding how to calculate and interpret $Fr$ is essential for diagnosing flow regimes and appreciating the concept of hydraulic control, a critical mechanism that often sets the transport of major ocean overflows as they pass through constrictions.",
            "id": "3810000",
            "problem": "A dense overflow of thickness $h$ descends along a continental slope beneath a much thicker ambient layer, idealized as a two-layer system under the hydrostatic and Boussinesq approximations and the long-wave (shallow-water) limit. In such flows, hydraulic control and the formation of dense water cascades are governed by a non-dimensional ratio that compares the advective speed of the current to the long internal gravity wave speed of the stratified system. Starting from the two-layer shallow-water framework, derive the appropriate non-dimensional measure for hydraulic control in terms of the reduced gravity $g'$ and the active-layer thickness $h$, and then evaluate it for the overflow parameters $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$, $h = 150\\,\\mathrm{m}$, and current speed $U = 0.6\\,\\mathrm{m\\,s^{-1}}$. Based on your derivation, interpret the computed value in terms of subcritical versus supercritical regimes for dense overflows and explain the physical meaning of this classification in relation to upstream communication by internal waves. Round your final numerical value to three significant figures and report it as a dimensionless number.",
            "solution": "The problem asks for the non-dimensional measure that governs hydraulic control in a two-layer system. This measure is the internal Froude number, which is the ratio of the flow speed to the speed of long internal gravity waves. We begin by deriving the speed of these waves.\n\nConsider a two-layer fluid system with an active, dense bottom layer of thickness $h$ and velocity $u$, and a deep, quiescent upper layer. The Boussinesq approximation is applied. The governing equations for the bottom layer in the long-wave limit are the shallow-water equations, modified for a two-layer system.\n\nThe momentum equation for the lower, active layer is:\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = - \\frac{1}{\\rho_1} \\frac{\\partial p}{\\partial x} $$\nwhere $\\rho_1$ is the density of the lower layer and $p$ is the pressure. The pressure at a depth $z$ within the lower layer is determined by the weight of the fluid above it. Let the interface height be $h(x,t)$ and the free surface height be $\\eta(x,t)$. Assuming the upper layer is infinitely deep and at rest (the reduced gravity model), the pressure gradient at the interface drives the flow. The horizontal pressure gradient force within the active layer is due to the slope of the interface, giving:\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = -g' \\frac{\\partial h}{\\partial x} $$\nHere, $g' = g \\frac{\\rho_1 - \\rho_2}{\\rho_0}$ is the reduced gravity, where $\\rho_2$ is the density of the upper layer and $\\rho_0$ is a reference density. This equation accounts for the buoyancy force at the interface.\n\nThe continuity equation for the active layer is:\n$$ \\frac{\\partial h}{\\partial t} + \\frac{\\partial (uh)}{\\partial x} = 0 $$\n\nTo find the speed of long internal waves, we linearize these two equations for small perturbations around a state of rest ($u_0=0$) and constant mean thickness $h_0$. Let $u = u'$ and $h = h_0 + h'$, where $u'$ and $h'$ are small perturbations.\n\nThe linearized momentum equation becomes:\n$$ \\frac{\\partial u'}{\\partial t} = -g' \\frac{\\partial h'}{\\partial x} $$\n\nThe linearized continuity equation becomes:\n$$ \\frac{\\partial h'}{\\partial t} + h_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\nTo obtain a wave equation, we differentiate the momentum equation with respect to $x$ and the continuity equation with respect to $t$:\n$$ \\frac{\\partial^2 u'}{\\partial t \\partial x} = -g' \\frac{\\partial^2 h'}{\\partial x^2} $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\frac{\\partial^2 u'}{\\partial t \\partial x} = 0 $$\n\nSubstituting the first expression into the second gives:\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\left( -g' \\frac{\\partial^2 h'}{\\partial x^2} \\right) = 0 $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} = g' h_0 \\frac{\\partial^2 h'}{\\partial x^2} $$\nThis is the standard one-dimensional wave equation, $\\frac{\\partial^2 \\psi}{\\partial t^2} = c^2 \\frac{\\partial^2 \\psi}{\\partial x^2}$. By comparison, the phase speed $c_i$ of long internal gravity waves is:\n$$ c_i = \\sqrt{g' h_0} $$\nFor the given problem, the relevant thickness is the layer thickness $h$. Thus, $c_i = \\sqrt{g' h}$.\n\nThe non-dimensional measure for hydraulic control, the internal Froude number ($Fr$), is defined as the ratio of the characteristic flow speed $U$ to the internal wave speed $c_i$.\n$$ Fr = \\frac{U}{c_i} = \\frac{U}{\\sqrt{g' h}} $$\nThis is the derived non-dimensional measure.\n\nNow, we evaluate this Froude number using the provided parameters:\n$g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n$h = 150\\,\\mathrm{m}$\n$U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n\nFirst, we calculate the internal wave speed $c_i$:\n$$ c_i = \\sqrt{g' h} = \\sqrt{(0.02\\,\\mathrm{m\\,s^{-2}}) \\times (150\\,\\mathrm{m})} = \\sqrt{3.0\\,\\mathrm{m^2\\,s^{-2}}} = \\sqrt{3}\\,\\mathrm{m\\,s^{-1}} $$\nThe numerical value of the wave speed is approximately $c_i \\approx 1.732\\,\\mathrm{m\\,s^{-1}}$.\n\nNext, we calculate the Froude number:\n$$ Fr = \\frac{U}{c_i} = \\frac{0.6\\,\\mathrm{m\\,s^{-1}}}{\\sqrt{3}\\,\\mathrm{m\\,s^{-1}}} = \\frac{0.6}{\\sqrt{3}} $$\nNumerically, this is:\n$$ Fr \\approx 0.34641016... $$\nRounding to three significant figures, the Froude number is $0.346$.\n\n### Interpretation\n\nThe computed Froude number is $Fr \\approx 0.346$. The state of the flow is classified based on the value of $Fr$ relative to $1$:\n- $Fr  1$: The flow is **subcritical**.\n- $Fr = 1$: The flow is **critical**.\n- $Fr  1$: The flow is **supercritical**.\n\nSince $Fr \\approx 0.346  1$, the overflow is in a **subcritical** regime.\n\nThe physical meaning of this classification relates to the propagation of information, which travels at the wave speed $c_i$.\n- In a **subcritical** flow ($U  c_i$), internal waves can propagate both upstream and downstream. This means that information about downstream conditions (e.g., changes in topography, obstacles) can travel upstream against the current. The flow is therefore able to adjust to downstream controls; it is \"communicatively connected\" to the entire flow domain.\n- In a **supercritical** flow ($U  c_i$), the current is faster than any internal wave. Consequently, all information is swept downstream. Disturbances cannot propagate upstream, so the flow is \"unaware\" of downstream conditions. Its state is determined entirely by upstream conditions.\n- A **critical** flow ($U = c_i$) represents a special state where the flow transitions between subcritical and supercritical. This is known as a hydraulic control, and it often occurs at a topographic constriction like a sill or a narrow channel. At such a point, the flow is \"choked,\" and this condition sets the transport rate of the dense water cascade. The flow accelerates through the control from a subcritical state to a supercritical state.\n\nFor the given parameters, the subcritical nature of the flow implies that the current speed of $0.6\\,\\mathrm{m\\,s^{-1}}$ is not yet fast enough to prevent upstream communication by internal waves, which travel at approximately $1.73\\,\\mathrm{m\\,s^{-1}}$.",
            "answer": "$$ \\boxed{0.346} $$"
        },
        {
            "introduction": "In large-scale climate models, overflows are often too small to be fully resolved and must be represented through parameterizations. This advanced practice  challenges you to synthesize the physical principles of buoyancy, entrainment, and hydraulic control into a working numerical model. By building a simple entraining plume parameterization from first principles, you will simulate the descent of an overflow and predict its final injection depth and transport, bridging the gap between fundamental theory and practical application.",
            "id": "3810057",
            "problem": "You are asked to design and implement a minimal yet dynamically consistent parameterization for a dense overflow cascading downslope into a stratified ambient ocean. The goal is to compute, for each specified source and slope configuration, the downstream neutral-buoyancy injection depth and the associated transport, using a reduced-gravity, entraining gravity current model that obeys hydrostatic balance and a critical control at the sill. The program you write must execute the same computations for all test cases and return their results in a single aggregated output.\n\nThe parameterization must be derived from the following fundamental base for computational oceanography:\n- Hydrostatic balance for slowly varying motions in a stably stratified fluid.\n- The Boussinesq approximation for small density contrasts, where momentum depends on density anomalies only through buoyancy.\n- Mass conservation for the overflow layer, treated as a layer of thickness $h$ and width $W$ moving at speed $U$ downslope.\n- A control at the sill such that the along-flow Froude number equals unity at the control, and remains order one downstream.\n- A classic entrainment closure for gravity currents, where the entrainment velocity at the top of the layer is proportional to the layer speed.\n\nYou must derive, from these bases only, a closed system that evolves the overflow along the downslope direction until it reaches a neutral-buoyancy depth, defined by the equality between the evolving layer-mean density and the ambient density at the same depth. Your derivation and algorithm must be purely from these principles and must not assume any specialized overflow formula as a starting point.\n\nDefinitions, geometry, and closures to use:\n- Let $x$ be the along-slope coordinate measured in $\\mathrm{m}$ from the sill crest at $x=0$. Let $z$ be the depth in $\\mathrm{m}$, positive downward, with $z(x)$ increasing as the plume descends. The bottom has a constant slope $s = \\mathrm{d}z/\\mathrm{d}x$ (dimensionless).\n- The ambient density profile is linear with depth, $\\rho_{a}(z) = \\rho_{0} + \\gamma z$, where $\\rho_{0}$ is a reference density in $\\mathrm{kg\\,m^{-3}}$, and $\\gamma$ is a constant density gradient in $\\mathrm{kg\\,m^{-4}}$.\n- The overflow is initialized at $x=0$ at depth $z(0)=z_{0}$, with source transport $Q_{s}$ in $\\mathrm{m^{3}\\,s^{-1}}$, source layer-mean density $\\rho_{s}$ in $\\mathrm{kg\\,m^{-3}}$, and it has a fixed width $W$ in $\\mathrm{m}$. The gravitational acceleration is $g$ in $\\mathrm{m\\,s^{-2}}$.\n- Let $\\rho(x)$ denote the evolving layer-mean density of the overflow, and $Q(x)$ its transport in $\\mathrm{m^{3}\\,s^{-1}}$. The reduced gravity is $g'(x) = g\\left(\\rho(x) - \\rho_{a}(z(x))\\right)/\\rho_{0}$, with the requirement $g'(x)\\ge 0$ while the current is denser than the ambient.\n- Let the entrainment velocity be $w_{e} = \\alpha_{e} U$, where $\\alpha_{e}$ is a constant entrainment coefficient (dimensionless), and $U$ is the along-slope layer speed in $\\mathrm{m\\,s^{-1}}$.\n- The control condition is that the Froude number defined as $Fr = U/\\sqrt{g'h}$ is of order one; at the sill take it to be unity, and use this criticality consistently to close the system together with mass conservation.\n\nFrom these bases, derive the governing evolution system in the along-slope coordinate $x$ for $Q(x)$, $\\rho(x)$, and $z(x)$, and show how to determine the neutral-buoyancy injection depth $z_{\\mathrm{inj}}$ such that $\\rho(x_{\\mathrm{inj}}) = \\rho_{a}(z_{\\mathrm{inj}})$, where $x_{\\mathrm{inj}}$ is the corresponding along-slope distance. If the current is not denser than the ambient at the sill crest, take $z_{\\mathrm{inj}} = z_{0}$ and the downstream transport equal to $Q_{s}$. If the current remains denser than ambient down to a maximum allowed depth $z_{\\max}$, then set $z_{\\mathrm{inj}}=z_{\\max}$ with the transport equal to the transport reached there.\n\nImplementation requirements:\n- Implement a numerical integration in $x$ using an explicit method that is consistent with the derived system and the assumptions above. Use a fixed step $\\Delta x$ and ensure numerical stability by stopping the integration when the neutral condition is crossed. Use linear interpolation between the last two points to estimate $z_{\\mathrm{inj}}$ and the transport at neutral buoyancy for improved accuracy. Prevent division by zero or taking real roots of negative quantities by stopping the integration once neutral buoyancy is reached and by enforcing nonnegativity of the reduced gravity during the march.\n- Use the following constant parameters for all cases: reference density $\\rho_{0} = 1027.0\\,\\mathrm{kg\\,m^{-3}}$, gravitational acceleration $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, entrainment coefficient $\\alpha_{e} = 0.001$, step size $\\Delta x = 10\\,\\mathrm{m}$, and maximum allowed depth $z_{\\max} = 3000\\,\\mathrm{m}$.\n- Your program must compute, for each case, the pair consisting of the injection depth and the corresponding transport expressed in International System of Units (SI). Express the final injection depth in $\\mathrm{m}$ and the final transport in $\\mathrm{m^{3}\\,s^{-1}}$, each rounded to three digits after the decimal point.\n\nTest suite:\nFor each of the following test cases, compute the injection depth and transport using the algorithm described. Each parameter not listed inherits the shared constants above.\n\n- Case A (happy path, moderate slope and strong source):\n  - Width $W = 15000\\,\\mathrm{m}$, sill depth $z_{0} = 600\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.2\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 1.2\\times 10^{6}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.010$.\n- Case B (gentle slope, weaker source):\n  - Width $W = 20000\\,\\mathrm{m}$, sill depth $z_{0} = 800\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.0\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 6.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 6.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.003$.\n- Case C (narrower overflow, steeper slope):\n  - Width $W = 8000\\,\\mathrm{m}$, sill depth $z_{0} = 500\\,\\mathrm{m}$, source density $\\rho_{s} = 1028.5\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 8.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, ambient gradient $\\gamma = 4.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, slope $s = 0.020$.\n- Case D (edge case, barely dense source):\n  - Width $W = 12000\\,\\mathrm{m}$, sill depth $z_{0} = 700\\,\\mathrm{m}$, ambient gradient $\\gamma = 7.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$, and source density chosen to be slightly denser than ambient at the sill, $\\rho_{s} = \\rho_{0} + \\gamma z_{0} + 0.05\\,\\mathrm{kg\\,m^{-3}}$, source transport $Q_{s} = 4.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$, slope $s = 0.006$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, in the order of the test cases above, enclosed in square brackets. Each pair must itself be a two-element list in the order $[z_{\\mathrm{inj}}, Q_{\\mathrm{inj}}]$, with both entries rounded to three digits after the decimal point and in SI units as specified. For example, a valid output for two hypothetical cases would look like: [[1000.000,500000.000],[1200.500,750000.250]].",
            "solution": "The problem requires the derivation and implementation of a parameterization for a dense overflow. The goal is to determine the neutral-buoyancy injection depth, $z_{\\mathrm{inj}}$, and the corresponding transport, $Q_{\\mathrm{inj}}$, for a gravity current descending a slope. The derivation will be based on the principles of mass and density conservation, hydrostatic balance under the Boussinesq approximation, a critical Froude number condition, and an entrainment closure.\n\nThe state of the overflow is described by its transport $Q(x)$, layer-mean density $\\rho(x)$, and depth $z(x)$, where $x$ is the along-slope coordinate. We will derive a system of ordinary differential equations (ODEs) for these variables.\n\n**1. Geometric and Kinematic Relations**\n\nThe geometry is defined by a constant bottom slope, $s = \\mathrm{d}z/\\mathrm{d}x$. Integrating this with the initial condition $z(0) = z_0$ gives the depth of the plume as a function of along-slope distance:\n$$\nz(x) = z_0 + s x\n$$\nThe transport $Q(x)$ is defined as the volume flux across a section of the overflow, which has width $W$, thickness $h(x)$, and layer-averaged speed $U(x)$:\n$$\nQ(x) = U(x) W h(x)\n$$\n\n**2. Mass Conservation and Entrainment**\n\nThe problem states that the overflow entrains ambient water at a rate determined by the entrainment velocity $w_e = \\alpha_e U$. The increase in transport $dQ$ over a distance $dx$ is the volume of water entrained over that segment, which has a surface area of $W dx$.\n$$\ndQ = w_e (W dx) = (\\alpha_e U) W dx\n$$\nThis gives the first ODE for the evolution of transport:\n$$\n\\frac{dQ}{dx} = \\alpha_e W U(x)\n$$\n\n**3. Density Evolution**\n\nThe density of the overflow, $\\rho(x)$, changes due to the entrainment of ambient water with density $\\rho_a(z(x))$. We consider the conservation of the density tracer. The total amount of \"density substance\" in a control volume is $\\rho Q$. The change in this quantity, $d(\\rho Q)$, must equal the amount of density substance added by entrainment, which is $\\rho_a(z) dQ$.\n$$\nd(\\rho Q) = \\rho_a(z) dQ\n$$\nDividing by $dx$ and using the product rule for differentiation on the left-hand side:\n$$\n\\rho \\frac{dQ}{dx} + Q \\frac{d\\rho}{dx} = \\rho_a(z) \\frac{dQ}{dx}\n$$\nRearranging for the evolution of density, we obtain the second ODE:\n$$\n\\frac{d\\rho}{dx} = \\frac{\\rho_a(z(x)) - \\rho(x)}{Q(x)} \\frac{dQ}{dx}\n$$\nThe ambient density is given by the linear profile $\\rho_a(z) = \\rho_0 + \\gamma z$.\n\n**4. Dynamical Closure: Critical Froude Number**\n\nThe system is not yet closed because the speed $U(x)$ is unknown. The problem provides a dynamical closure by stating that the flow is critically controlled, with a Froude number of unity:\n$$\nFr = \\frac{U}{\\sqrt{g'h}} = 1\n$$\nThis implies $U^2 = g'h$. The reduced gravity, $g'$, is defined under the Boussinesq approximation as:\n$$\ng'(x) = g \\frac{\\rho(x) - \\rho_a(z(x))}{\\rho_0}\n$$\nWe need to express $U$ in terms of the evolving state variables, $Q$ and $\\rho$. From the transport relation, we have $h = Q / (UW)$. Substituting this into the Froude number condition:\n$$\nU^2 = g' \\left(\\frac{Q}{UW}\\right) \\implies U^3 = \\frac{g'Q}{W}\n$$\nThis yields an expression for the velocity:\n$$\nU(x) = \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\nThis equation closes the system. With this, the rate of change of transport becomes:\n$$\n\\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n\n**5. Synthesis of the Governing System and Numerical Implementation**\n\nFor numerical stability and elegance, it is convenient to evolve the density anomaly, $\\Delta\\rho(x) = \\rho(x) - \\rho_a(z(x))$, directly. Note that $g'(x) = g \\Delta\\rho(x) / \\rho_0$. The derivative of $\\Delta\\rho$ is:\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a(z(x))}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a}{dz}\\frac{dz}{dx} = \\frac{d\\rho}{dx} - \\gamma s\n$$\nSubstituting the expression for $d\\rho/dx$:\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{-\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s\n$$\nThe complete system of ODEs to be integrated in $x$ is thus:\n1.  $\\displaystyle \\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho(x) Q(x)}{W}\\right)^{1/3}$\n2.  $\\displaystyle \\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s$\n\n**Algorithm:**\nThe system is solved using an explicit forward Euler method with a step size $\\Delta x$.\n1.  **Initialization**: At $x_0=0$, set the initial conditions: $Q_0 = Q_s$, $z_0 = z_0$, and calculate the initial density anomaly $\\Delta\\rho_0 = \\rho_s - (\\rho_0 + \\gamma z_0)$.\n2.  **Initial Check**: If $\\Delta\\rho_0 \\le 0$, the overflow is not denser than the ambient at the sill. The process terminates, and the injection parameters are $z_{\\mathrm{inj}} = z_0$ and $Q_{\\mathrm{inj}} = Q_s$.\n3.  **Integration Loop**: For $i = 0, 1, 2, ...$\n    a. Check termination conditions: If $\\Delta\\rho_i \\le 0$ or $z_i \\ge z_{\\max}$, stop the integration.\n    b. Calculate the derivatives at step $i$:\n       i. $\\displaystyle \\left(\\frac{dQ}{dx}\\right)_i = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho_i Q_i}{W}\\right)^{1/3}$\n       ii. $\\displaystyle \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i = -\\frac{\\Delta\\rho_i}{Q_i}\\left(\\frac{dQ}{dx}\\right)_i - \\gamma s$\n    c. Store the current state $(z_i, Q_i, \\Delta\\rho_i)$.\n    d. Update the state variables for the next step $i+1$:\n       i. $x_{i+1} = x_i + \\Delta x$\n       ii. $z_{i+1} = z_i + s \\Delta x$\n       iii. $Q_{i+1} = Q_i + \\left(\\frac{dQ}{dx}\\right)_i \\Delta x$\n       iv. $\\Delta\\rho_{i+1} = \\Delta\\rho_i + \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i \\Delta x$\n4.  **Finalization**:\n    a. If the loop terminated because $z_i \\ge z_{\\max}$, the injection parameters are $z_{\\mathrm{inj}} = z_{\\max}$ and $Q_{\\mathrm{inj}} = Q_i$.\n    b. If the loop terminated because $\\Delta\\rho_{i+1} \\le 0$, the neutral buoyancy level was crossed between step $i$ and $i+1$. We find the precise location using linear interpolation. Let the last state with $\\Delta\\rho  0$ be $(\\text{prev})$ and the first with $\\Delta\\rho \\le 0$ be $(\\text{curr})$. The interpolation fraction is $f = \\Delta\\rho_{\\text{prev}} / (\\Delta\\rho_{\\text{prev}} - \\Delta\\rho_{\\text{curr}})$.\n    c. The final injection depth and transport are:\n       i. $z_{\\mathrm{inj}} = z_{\\text{prev}} + (z_{\\text{curr}} - z_{\\text{prev}}) \\times f$\n       ii. $Q_{\\mathrm{inj}} = Q_{\\text{prev}} + (Q_{\\text{curr}} - Q_{\\text{prev}}) \\times f$\n5. The final results are rounded to three decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a parameterization for a dense overflow,\n    computing the neutral-buoyancy injection depth and transport.\n    \"\"\"\n    \n    # Global constants\n    RHO_0 = 1027.0  # Reference density, kg/m^3\n    G = 9.81        # Gravitational acceleration, m/s^2\n    ALPHA_E = 0.001 # Entrainment coefficient, dimensionless\n    DX = 10.0       # Step size for integration, m\n    Z_MAX = 3000.0  # Maximum allowed depth, m\n\n    # Test suite: (W, z0, rho_s, Qs, gamma, s)\n    # rho_s is 'auto' for Case D to be calculated based on other params.\n    test_cases_params = [\n        # Case A: happy path, moderate slope and strong source\n        {'W': 15000.0, 'z0': 600.0, 'rho_s': 1028.2, 'Qs': 1.2e6, 'gamma': 5.0e-4, 's': 0.010, 'case_id': 'A'},\n        # Case B: gentle slope, weaker source\n        {'W': 20000.0, 'z0': 800.0, 'rho_s': 1028.0, 'Qs': 6.0e5, 'gamma': 6.0e-4, 's': 0.003, 'case_id': 'B'},\n        # Case C: narrower overflow, steeper slope\n        {'W': 8000.0, 'z0': 500.0, 'rho_s': 1028.5, 'Qs': 8.0e5, 'gamma': 4.0e-4, 's': 0.020, 'case_id': 'C'},\n        # Case D: edge case, barely dense source\n        {'W': 12000.0, 'z0': 700.0, 'rho_s': 'auto', 'Qs': 4.0e5, 'gamma': 7.0e-4, 's': 0.006, 'case_id': 'D'}\n    ]\n\n    results = []\n\n    for params in test_cases_params:\n        W = params['W']\n        z0 = params['z0']\n        Qs = params['Qs']\n        gamma = params['gamma']\n        s = params['s']\n        \n        # Calculate rho_s for Case D\n        if params['rho_s'] == 'auto':\n            rho_s = RHO_0 + gamma * z0 + 0.05\n        else:\n            rho_s = params['rho_s']\n\n        # Initial conditions\n        x = 0.0\n        z = z0\n        Q = Qs\n        \n        rho_a_0 = RHO_0 + gamma * z0\n        delta_rho = rho_s - rho_a_0\n\n        # Check if plume is dense at the sill\n        if delta_rho = 0:\n            results.append([z0, Qs])\n            continue\n        \n        # Lists to store history for interpolation\n        history = []\n        \n        # Integration loop\n        while True:\n            # Check termination conditions\n            if delta_rho = 0 or z = Z_MAX:\n                break\n                \n            # Store state before update\n            history.append({'z': z, 'Q': Q, 'delta_rho': delta_rho})\n\n            # Calculate reduced gravity\n            g_prime = (G / RHO_0) * delta_rho\n            \n            # Avoid root of negative number, though loop condition should prevent it\n            if g_prime * Q  0:\n                break\n\n            # Layer speed from critical Froude number condition\n            U = np.cbrt(g_prime * Q / W)\n            \n            # Derivatives\n            dQ_dx = ALPHA_E * W * U\n            d_delta_rho_dx = (-delta_rho / Q) * dQ_dx - gamma * s\n            \n            # Update variables using Forward Euler method\n            x += DX\n            z += s * DX\n            Q += dQ_dx * DX\n            delta_rho += d_delta_rho_dx * DX\n\n        # Finalization\n        if z = Z_MAX and delta_rho  0: # Reached max depth while still dense\n            z_inj = Z_MAX\n            q_inj = Q\n        else: # Crossed neutral buoyancy\n            if not history: # Could happen if it's not dense on the first step\n                 results.append([z0, Qs])\n                 continue\n                 \n            prev_state = history[-1]\n            z_prev, Q_prev, delta_rho_prev = prev_state['z'], prev_state['Q'], prev_state['delta_rho']\n            \n            # Current state is the one that terminated the loop\n            z_curr, Q_curr, delta_rho_curr = z, Q, delta_rho\n\n            # Linear interpolation to find where delta_rho is zero\n            if (delta_rho_prev - delta_rho_curr) == 0:\n                # This should not happen if delta_rho is changing\n                fraction = 0.5\n            else:\n                fraction = delta_rho_prev / (delta_rho_prev - delta_rho_curr)\n\n            z_inj = z_prev + (z_curr - z_prev) * fraction\n            q_inj = Q_prev + (Q_curr - Q_prev) * fraction\n            \n        results.append([z_inj, q_inj])\n\n    # Format output as required\n    formatted_pairs = []\n    for z_final, q_final in results:\n        formatted_pairs.append(f\"[{z_final:.3f},{q_final:.3f}]\")\n    \n    final_output_str = f\"[{','.join(formatted_pairs)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}