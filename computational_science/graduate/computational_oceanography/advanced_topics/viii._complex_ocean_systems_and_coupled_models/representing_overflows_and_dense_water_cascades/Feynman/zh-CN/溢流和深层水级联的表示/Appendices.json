{
    "hands_on_practices": [
        {
            "introduction": "在模拟或分析浓水溢流之前，我们必须首先量化其驱动力。这个练习将指导您完成一个基本但至关重要的计算：如何根据源水和环境水之间的温盐特性差异，确定溢流的密度差和由此产生的浮力。通过计算约化重力 $g'$，您将掌握一个核心动力学参数，它决定了溢流的初始强度，并为后续的动力学分析奠定基础 。",
            "id": "3810011",
            "problem": "一股稠密的地中海溢出羽流流出直布罗陀海峡，侵入大西洋，并开始沿大陆坡下沉。假设Boussinesq近似（除浮力项外，参考密度为常数）、主导阶的静水平衡，以及围绕一个参考状态的线性化状态方程，该参考状态的特征为参考密度 $\\rho_{0}$、热膨胀系数 $\\alpha$ 和盐收缩系数 $\\beta$。这些系数是在海槛附近的一个代表性参考状态下评估的，对于小的异常值，它们被视为常数。根据定义，$\\alpha$ 和 $\\beta$ 满足\n$$\n\\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p}, \\qquad\n\\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p}.\n$$\n在大西洋环境水体和溢流水源之间，海槛处的盐度和温度异常（溢流水减去环境水）分别为 $\\Delta S = +\\,2.5~\\text{g}~\\text{kg}^{-1}$ 和 $\\Delta T = +\\,2.0~\\text{K}$。设参考密度为 $\\rho_{0}=1027~\\text{kg}~\\text{m}^{-3}$，热膨胀系数为 $\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$，盐收缩系数为 $\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$，重力加速度为 $g = 9.81~\\text{m}~\\text{s}^{-2}$。\n\n从线性化状态方程和浮力定义 $b \\equiv -g(\\rho-\\rho_{a})/\\rho_{0}$（适用于羽流和环境水体（$\\rho_{a}$）之间的小密度差异）出发，首先计算由给定的 $\\Delta S$ 和 $\\Delta T$ 所隐含的密度差 $\\Delta \\rho \\equiv \\rho_{\\text{overflow}}-\\rho_{\\text{ambient}}$。然后，评估决定羽流初始浮力大小的折减重力 $g'$，其定义为 $|b| = g'$。对于这些小的异常值，状态方程所受的压力效应可忽略不计。\n\n仅报告折减重力 $g'$ 的值，单位为 $\\text{m}~\\text{s}^{-2}$，并四舍五入到四位有效数字。最终答案中不要报告 $\\Delta \\rho$，尽管您必须计算它才能得到 $g'$。",
            "solution": "该问题是有效的，因为它具有科学依据，问题阐述清晰，并且提供了所有必要的数据和定义。我们可以开始求解。\n\n第一步是使用提供的线性化状态方程来确定密度差 $\\Delta \\rho \\equiv \\rho_{\\text{overflow}} - \\rho_{\\text{ambient}}$。密度 $\\rho$ 是温度 $T$ 和盐度 $S$ 的函数。对于温度 $\\Delta T$ 和盐度 $\\Delta S$ 与环境参考状态 $(T_a, S_a)$ 的微小偏差，密度异常 $\\Delta \\rho$ 可以用一阶泰勒展开式近似：\n$$ \\Delta \\rho \\approx \\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{T_a, S_a} \\Delta T + \\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T_a, S_a} \\Delta S $$\n问题中给出了热膨胀系数 $\\alpha$ 和盐收缩系数 $\\beta$ 的定义：\n$$ \\alpha \\equiv -\\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial T}\\right)_{S,p} $$\n$$ \\beta \\equiv \\frac{1}{\\rho}\\left(\\frac{\\partial \\rho}{\\partial S}\\right)_{T,p} $$\n在这些定义中，使用参考密度 $\\rho_0$ 来近似 $\\rho$，这与Boussinesq近似一致，我们可以将偏导数表示为：\n$$ \\left(\\frac{\\partial \\rho}{\\partial T}\\right) \\approx -\\rho_{0}\\alpha $$\n$$ \\left(\\frac{\\partial \\rho}{\\partial S}\\right) \\approx \\rho_{0}\\beta $$\n将这些代入泰勒展开式，得到密度差的表达式：\n$$ \\Delta \\rho \\approx \\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S) $$\n问题给出了以下数值：$\\rho_{0} = 1027~\\text{kg}~\\text{m}^{-3}$，$\\alpha = 2.00 \\times 10^{-4}~\\text{K}^{-1}$，$\\beta = 7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1}$，$\\Delta T = +2.0~\\text{K}$，以及 $\\Delta S = +2.5~\\text{g}~\\text{kg}^{-1}$。\n我们首先计算括号中的项，它代表分数密度异常 $\\Delta \\rho / \\rho_0$：\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -(2.00 \\times 10^{-4}~\\text{K}^{-1})(2.0~\\text{K}) + (7.50 \\times 10^{-4}~(\\text{g}~\\text{kg}^{-1})^{-1})(2.5~\\text{g}~\\text{kg}^{-1}) $$\n$$ -\\alpha \\Delta T + \\beta \\Delta S = -4.00 \\times 10^{-4} + 18.75 \\times 10^{-4} = 14.75 \\times 10^{-4} $$\n由于此项为正，密度差 $\\Delta \\rho$ 为正，这意味着溢出羽流比周围水体更稠密，这在物理上与其下沉的现象是一致的。\n密度差为 $\\Delta \\rho \\approx (1027~\\text{kg}~\\text{m}^{-3}) \\times (14.75 \\times 10^{-4}) \\approx 1.515~\\text{kg}~\\text{m}^{-3}$。\n\n接下来，我们计算折减重力 $g'$。它被定义为浮力的大小 $|b|$，其中浮力 $b$ 由以下公式给出：\n$$ b \\equiv -g\\frac{\\rho-\\rho_{a}}{\\rho_{0}} = -g\\frac{\\Delta \\rho}{\\rho_{0}} $$\n那么折减重力为：\n$$ g' = |b| = \\left| -g\\frac{\\Delta \\rho}{\\rho_{0}} \\right| = g\\frac{|\\Delta \\rho|}{\\rho_{0}} $$\n由于我们发现 $\\Delta \\rho > 0$，所以有 $|\\Delta \\rho| = \\Delta \\rho$。折减重力的表达式变为：\n$$ g' = g\\frac{\\Delta \\rho}{\\rho_{0}} $$\n代入我们关于 $\\Delta \\rho$ 的表达式：\n$$ g' = g\\frac{\\rho_{0}(-\\alpha \\Delta T + \\beta \\Delta S)}{\\rho_{0}} = g(-\\alpha \\Delta T + \\beta \\Delta S) $$\n现在我们代入数值。我们有 $g = 9.81~\\text{m}~\\text{s}^{-2}$ 并且括号中表达式的值为 $14.75 \\times 10^{-4}$。\n$$ g' = (9.81~\\text{m}~\\text{s}^{-2}) \\times (14.75 \\times 10^{-4}) $$\n$$ g' = 0.01446975~\\text{m}~\\text{s}^{-2} $$\n题目要求答案保留 $4$ 位有效数字。对计算结果进行四舍五入得到：\n$$ g' \\approx 0.01447~\\text{m}~\\text{s}^{-2} $$\n这就是折减重力的最终值。",
            "answer": "$$\n\\boxed{0.01447}\n$$"
        },
        {
            "introduction": "仅有驱动力的大小还不足以完全描述溢流的动态行为。流动惯性与浮力之间的相互作用同样至关重要，而这一关系可以通过内部弗劳德数 $Fr$ 来量化。这个练习将引导您推导并计算弗劳德数，并借此区分亚临界流和超临界流，这两种流态决定了信息（如地形变化）能否逆流传播，是理解海槛处水力控制现象的关键 。",
            "id": "3810000",
            "problem": "一个厚度为 $h$ 的密度溢流，在一个厚得多的环境层之下，沿着大陆坡下沉。该系统在静水和Boussinesq近似以及长波（浅水）极限下被理想化为一个双层系统。在此类流动中，水力控制和密水级联的形成由一个无量纲比率决定，该比率比较了水流的平流速度与分层系统的长内重力波速。从双层浅水框架出发，根据折减重力 $g'$ 和活动层厚度 $h$ 推导出适用于水力控制的无量纲量，然后对溢流参数 $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$，$h = 150\\,\\mathrm{m}$ 和流速 $U = 0.6\\,\\mathrm{m\\,s^{-1}}$ 进行求值。根据你的推导，结合密度溢流的亚临界与超临界状态来解释计算出的值，并说明此分类在内波上游信息传播方面的物理意义。将你的最终数值四舍五入至三位有效数字，并以无量纲数的形式报告。",
            "solution": "用户提供了一个地球物理流体动力学领域的问题，具体涉及双层海洋模型中的密度溢流。问题要求推导控制水力控制的无量纲数，为给定参数计算其值，并解释其物理意义。\n\n首先根据指定标准对问题进行验证。\n\n### 第1步：提取已知条件\n- 系统描述：一个厚度为 $h$ 的密度溢流，在一个厚得多的环境层之下，沿着大陆坡下沉。\n- 理想化条件：双层系统、静水近似、Boussinesq近似、长波（浅水）极限。\n- 控制现象：水力控制和密水级联的形成。\n- 控制物理学：平流速度（$U$）与长内重力波速的比较。\n- 推导项：折减重力 $g'$ 和活动层厚度 $h$。\n- 用于评估的参数：\n  - 折减重力, $g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n  - 活动层厚度, $h = 150\\,\\mathrm{m}$\n  - 流速, $U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n- 要求输出：\n  - 推导无量纲量。\n  - 评估该量的值，四舍五入至三位有效数字。\n  - 解释该值在流态（亚临界/超临界）方面的意义及其与上游波传播的关系。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于成熟的双层浅水模型，这是地球物理流体动力学中用于研究分层流的基石。折减重力、长内波和用于水力控制的内弗劳德数的概念都是基础且事实正确的。为 $g'$、$h$ 和 $U$ 提供的数值对于海洋密度溢流来说是物理上现实的。\n- **适定性：** 问题陈述清晰，包含了推导所需量、计算其值并提供物理解释所必需的所有信息。存在唯一且有意义的解。假设环境层“厚得多”是一个标准且必要的条件，用以将双层系统简化为一层半（或折减重力）模型，其中上层在动力学上是不活跃的。\n- **客观性：** 问题以精确的技术语言表述，没有任何主观性或偏见。\n\n### 第3步：结论与行动\n该问题被认为是**有效的**，因为它科学合理、适定、客观且完整。将提供完整的解答。\n\n### 解答推导与解释\n\n问题要求推导控制双层系统中水力控制的无量纲量。这个量是内弗劳德数，即流速与长内重力波速之比。我们首先推导这些波的速度。\n\n考虑一个双层流体系统，其中有一个厚度为 $h$、速度为 $u$ 的活跃、稠密的底层，以及一个深而静止的上层。应用了Boussinesq近似。在长波极限下，底层的控制方程是为双层系统修改过的浅水方程。\n\n下层（活动层）的动量方程为：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = - \\frac{1}{\\rho_1} \\frac{\\partial p}{\\partial x} $$\n其中 $\\rho_1$ 是下层的密度，$p$ 是压力。下层内深度为 $z$ 处的压力由其上方流体的重量决定。设界面高度为 $h(x,t)$，自由表面高度为 $\\eta(x,t)$。假设上层无限深且静止（折减重力模型），界面处的压力梯度驱动流动。活动层内的水平压力梯度力是由界面斜率引起的，给出：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = -g' \\frac{\\partial h}{\\partial x} $$\n这里，$g' = g \\frac{\\rho_1 - \\rho_2}{\\rho_0}$ 是折减重力，其中 $\\rho_2$ 是上层的密度，$\\rho_0$ 是一个参考密度。这个方程考虑了界面处的浮力。\n\n活动层的连续性方程是：\n$$ \\frac{\\partial h}{\\partial t} + \\frac{\\partial (uh)}{\\partial x} = 0 $$\n\n为了找到长内波的速度，我们对这两个方程围绕静止状态（$u_0=0$）和恒定平均厚度 $h_0$ 进行小扰动的线性化。设 $u = u'$ 和 $h = h_0 + h'$，其中 $u'$ 和 $h'$ 是小扰动。\n\n线性化动量方程变为：\n$$ \\frac{\\partial u'}{\\partial t} = -g' \\frac{\\partial h'}{\\partial x} $$\n\n线性化连续性方程变为：\n$$ \\frac{\\partial h'}{\\partial t} + h_0 \\frac{\\partial u'}{\\partial x} = 0 $$\n\n为了得到波动方程，我们对动量方程关于 $x$ 求导，对连续性方程关于 $t$ 求导：\n$$ \\frac{\\partial^2 u'}{\\partial t \\partial x} = -g' \\frac{\\partial^2 h'}{\\partial x^2} $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\frac{\\partial^2 u'}{\\partial t \\partial x} = 0 $$\n\n将第一个表达式代入第二个表达式给出：\n$$ \\frac{\\partial^2 h'}{\\partial t^2} + h_0 \\left( -g' \\frac{\\partial^2 h'}{\\partial x^2} \\right) = 0 $$\n$$ \\frac{\\partial^2 h'}{\\partial t^2} = g' h_0 \\frac{\\partial^2 h'}{\\partial x^2} $$\n这是标准的一维波动方程 $\\frac{\\partial^2 \\psi}{\\partial t^2} = c^2 \\frac{\\partial^2 \\psi}{\\partial x^2}$。通过比较，长内重力波的相速 $c_i$ 是：\n$$ c_i = \\sqrt{g' h_0} $$\n对于给定的问题，相关厚度是层厚度 $h$。因此，$c_i = \\sqrt{g' h}$。\n\n用于水力控制的无量纲量，即内弗劳德数（$Fr$），定义为特征流速 $U$ 与内波速 $c_i$ 之比。\n$$ Fr = \\frac{U}{c_i} = \\frac{U}{\\sqrt{g' h}} $$\n这就是推导出的无量纲量。\n\n现在，我们使用提供的参数来评估这个弗劳德数：\n$g' = 0.02\\,\\mathrm{m\\,s^{-2}}$\n$h = 150\\,\\mathrm{m}$\n$U = 0.6\\,\\mathrm{m\\,s^{-1}}$\n\n首先，我们计算内波速 $c_i$：\n$$ c_i = \\sqrt{g' h} = \\sqrt{(0.02\\,\\mathrm{m\\,s^{-2}}) \\times (150\\,\\mathrm{m})} = \\sqrt{3.0\\,\\mathrm{m^2\\,s^{-2}}} = \\sqrt{3}\\,\\mathrm{m\\,s^{-1}} $$\n波速的数值约为 $c_i \\approx 1.732\\,\\mathrm{m\\,s^{-1}}$。\n\n接下来，我们计算弗劳德数：\n$$ Fr = \\frac{U}{c_i} = \\frac{0.6\\,\\mathrm{m\\,s^{-1}}}{\\sqrt{3}\\,\\mathrm{m\\,s^{-1}}} = \\frac{0.6}{\\sqrt{3}} $$\n数值上，这是：\n$$ Fr \\approx 0.34641016... $$\n四舍五入到三位有效数字，弗劳德数为 $0.346$。\n\n### 解释\n\n计算出的弗劳德数是 $Fr \\approx 0.346$。流态根据 $Fr$ 相对于 $1$ 的值进行分类：\n- $Fr  1$：流动是**亚临界**的。\n- $Fr = 1$：流动是**临界**的。\n- $Fr > 1$：流动是**超临界**的。\n\n由于 $Fr \\approx 0.346  1$，该溢流处于**亚临界**状态。\n\n这种分类的物理意义与信息的传播有关，信息以波速 $c_i$ 传播。\n- 在**亚临界**流（$U  c_i$）中，内波可以向上游和下游传播。这意味着关于下游条件（例如，地形变化、障碍物）的信息可以逆流向上游传播。因此，流动能够对下游的控制做出调整；它与整个流动区域是“信息连通”的。\n- 在**超临界**流（$U > c_i$）中，水流速度快于任何内波。因此，所有信息都被冲向下游。扰动无法向上游传播，所以流动对下游条件是“不知情”的。其状态完全由上游条件决定。\n- **临界**流（$U = c_i$）代表流动在亚临界和超临界之间转换的一种特殊状态。这被称为水力控制，它经常发生在像海槛或狭窄通道这样的地形收缩处。在这样的点上，流动被“壅塞”，这个条件设定了密水级联的输运率。流动通过控制点从亚临界状态加速到超临界状态。\n\n对于给定的参数，流动的亚临界性质意味着 $0.6\\,\\mathrm{m\\,s^{-1}}$ 的流速还不足以阻止内波的上游信息传播，这些内波的传播速度约为 $1.73\\,\\mathrm{m\\,s^{-1}}$。",
            "answer": "$$ \\boxed{0.346} $$"
        },
        {
            "introduction": "在掌握了基本物理原理之后，计算海洋学家的最终目标之一是构建能够预测真实海洋现象的模型。这个综合性练习挑战您将前面学到的概念——浮力、临界弗劳德数控制——与质量守恒和夹带物理过程相结合，从第一性原理出发构建一个简化的溢流参数化方案。通过这项实践，您将体验如何将复杂的物理过程提炼为可用于大尺度气候模型的简化表示，从而预测溢流的最终注入深度和输运量 。",
            "id": "3810057",
            "problem": "要求您设计并实现一个最小但动态一致的参数化方案，用于模拟稠密溢流沿坡向下流入分层环境海洋的过程。目标是针对每个指定的源和坡度配置，使用一个遵循静水力平衡和海槛处临界控制的折减重力、卷夹重力流模型，计算下游的中性浮力注入深度及相关的输运量。您编写的程序必须对所有测试用例执行相同的计算，并在一个聚合输出中返回它们的结果。\n\n该参数化方案必须从以下计算海洋学的基础原理推导得出：\n- 稳定分层流体中缓慢变化运动的静水力平衡。\n- Boussinesq近似，适用于小密度差异的情况，其中动量仅通过浮力依赖于密度异常。\n- 溢流层的质量守恒，该层被视为厚度为$h$、宽度为$W$、并以速度$U$沿坡向下移动的流体层。\n- 海槛处的控制条件，即顺流弗劳德数在控制点等于1，并在下游保持为1的量级。\n- 重力流的经典卷夹闭合，其中层顶的卷夹速度与层速度成正比。\n\n您必须仅从这些基础出发，推导出一个封闭系统，该系统描述溢流沿下坡方向的演变，直到达到中性浮力深度。中性浮力深度定义为演变中的层平均密度与同一深度的环境密度相等。您的推导和算法必须完全基于这些原理，不得以任何专门的溢流公式作为起点。\n\n定义、几何形状和闭合方案：\n- 设$x$为沿坡坐标，从$x=0$处的海槛顶部开始测量，单位为$\\mathrm{m}$。设$z$为深度，单位为$\\mathrm{m}$，向下为正，随着羽流下降，$z(x)$会增加。底部具有恒定的坡度$s = \\mathrm{d}z/\\mathrm{d}x$（无量纲）。\n- 环境密度剖面随深度线性变化，$\\rho_{a}(z) = \\rho_{0} + \\gamma z$，其中$\\rho_{0}$是参考密度，单位为$\\mathrm{kg\\,m^{-3}}$，$\\gamma$是恒定的密度梯度，单位为$\\mathrm{kg\\,m^{-4}}$。\n- 溢流在$x=0$处初始化，深度为$z(0)=z_{0}$，源输运量为$Q_{s}$（单位$\\mathrm{m^{3}\\,s^{-1}}$），源层平均密度为$\\rho_{s}$（单位$\\mathrm{kg\\,m^{-3}}$），并具有固定的宽度$W$（单位$\\mathrm{m}$）。重力加速度为$g$（单位$\\mathrm{m\\,s^{-2}}$）。\n- 设$\\rho(x)$表示溢流演变中的层平均密度，其输运量为$Q(x)$（单位$\\mathrm{m^{3}\\,s^{-1}}$）。折减重力为$g'(x) = g\\left(\\rho(x) - \\rho_{a}(z(x))\\right)/\\rho_{0}$，要求当水流比环境水体更稠密时，$g'(x)\\ge 0$。\n- 设卷夹速度为$w_{e} = \\alpha_{e} U$，其中$\\alpha_{e}$是恒定的卷夹系数（无量纲），$U$是沿坡层速度，单位为$\\mathrm{m\\,s^{-1}}$。\n- 控制条件是弗劳德数$Fr = U/\\sqrt{g'h}$的量级为1；在海槛处取其为1，并一致地使用此临界条件与质量守恒来封闭系统。\n\n基于这些基础，推导关于$Q(x)$、$rho(x)$和$z(x)$在沿坡坐标$x$上的控制演化系统，并说明如何确定中性浮力注入深度$z_{\\mathrm{inj}}$，使得$\\rho(x_{\\mathrm{inj}}) = \\rho_{a}(z_{\\mathrm{inj}})$，其中$x_{\\mathrm{inj}}$是相应的沿坡距离。如果水流在海槛顶部不比环境水体稠密，则取$z_{\\mathrm{inj}} = z_{0}$，下游输运量等于$Q_{s}$。如果水流在下降到最大允许深度$z_{\\max}$时仍比环境水体稠密，则设$z_{\\mathrm{inj}}=z_{\\max}$，输运量等于在该处达到的输运量。\n\n实现要求：\n- 使用显式方法实现$x$方向的数值积分，该方法须与上述推导的系统和假设一致。使用固定的步长$\\Delta x$，并通过在中性条件被跨越时停止积分来确保数值稳定性。在最后两个点之间使用线性插值来估计$z_{\\mathrm{inj}}$和中性浮力时的输运量，以提高精度。通过在中性浮力达到后停止积分，并在推进过程中强制折减重力的非负性，来防止除以零或对负数取实数根。\n- 对所有案例使用以下恒定参数：参考密度$\\rho_{0} = 1027.0\\,\\mathrm{kg\\,m^{-3}}$，重力加速度$g = 9.81\\,\\mathrm{m\\,s^{-2}}$，卷夹系数$\\alpha_{e} = 0.001$，步长$\\Delta x = 10\\,\\mathrm{m}$，最大允许深度$z_{\\max} = 3000\\,\\mathrm{m}$。\n- 您的程序必须为每个案例计算一个由注入深度和相应输运量组成的对，单位为国际单位制（SI）。最终的注入深度以$\\mathrm{m}$为单位，最终的输运量以$\\mathrm{m^{3}\\,s^{-1}}$为单位，均四舍五入到小数点后三位。\n\n测试套件：\n对于以下每个测试用例，使用所述算法计算注入深度和输运量。每个未列出的参数均继承上述共享常数。\n\n- 案例A（理想路径，中等坡度与强源）：\n  - 宽度 $W = 15000\\,\\mathrm{m}$，海槛深度 $z_{0} = 600\\,\\mathrm{m}$，源密度 $\\rho_{s} = 1028.2\\,\\mathrm{kg\\,m^{-3}}$，源输运量 $Q_{s} = 1.2\\times 10^{6}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度 $\\gamma = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度 $s = 0.010$。\n- 案例B（缓坡，较弱源）：\n  - 宽度 $W = 20000\\,\\mathrm{m}$，海槛深度 $z_{0} = 800\\,\\mathrm{m}$，源密度 $\\rho_{s} = 1028.0\\,\\mathrm{kg\\,m^{-3}}$，源输运量 $Q_{s} = 6.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度 $\\gamma = 6.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度 $s = 0.003$。\n- 案例C（较窄溢流，更陡坡度）：\n  - 宽度 $W = 8000\\,\\mathrm{m}$，海槛深度 $z_{0} = 500\\,\\mathrm{m}$，源密度 $\\rho_{s} = 1028.5\\,\\mathrm{kg\\,m^{-3}}$，源输运量 $Q_{s} = 8.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，环境梯度 $\\gamma = 4.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，坡度 $s = 0.020$。\n- 案例D（边界情况，勉强稠密的源）：\n  - 宽度 $W = 12000\\,\\mathrm{m}$，海槛深度 $z_{0} = 700\\,\\mathrm{m}$，环境梯度 $\\gamma = 7.0\\times 10^{-4}\\,\\mathrm{kg\\,m^{-4}}$，源密度选择为在海槛处比环境密度略大，即 $\\rho_{s} = \\rho_{0} + \\gamma z_{0} + 0.05\\,\\mathrm{kg\\,m^{-3}}$，源输运量 $Q_{s} = 4.0\\times 10^{5}\\,\\mathrm{m^{3}\\,s^{-1}}$，坡度 $s = 0.006$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的对列表，按上述测试用例的顺序排列，并用方括号括起来。每对本身必须是一个包含两个元素的列表，顺序为$[z_{\\mathrm{inj}}, Q_{\\mathrm{inj}}]$，两个条目都四舍五入到小数点后三位，并使用指定的SI单位。例如，两个假设案例的有效输出将如下所示：[[1000.000,500000.000],[1200.500,750000.250]]。",
            "solution": "该问题是有效的。它提出了一个计算海洋学中定义明确、有科学依据的任务，基于流体动力学的既定第一性原理。所有必要的数据和定义都已提供，并且没有内部矛盾或歧义。\n\n该问题要求推导和实现一个稠密溢流的参数化方案。目标是确定重力流沿坡下降的中性浮力注入深度$z_{\\mathrm{inj}}$和相应的输运量$Q_{\\mathrm{inj}}$。推导将基于质量和密度守恒、Boussinesq近似下的静水力平衡、临界弗劳德数条件以及卷夹闭合等原理。\n\n溢流的状态由其输运量$Q(x)$、层平均密度$\\rho(x)$和深度$z(x)$描述，其中$x$是沿坡坐标。我们将为这些变量推导一个常微分方程（ODE）系统。\n\n**1. 几何与运动学关系**\n\n几何形状由恒定的底坡$s = \\mathrm{d}z/\\mathrm{d}x$定义。将其与初始条件$z(0) = z_0$积分，得到羽流深度作为沿坡距离的函数：\n$$\nz(x) = z_0 + s x\n$$\n输运量$Q(x)$定义为流经溢流某一断面的体积通量，该断面宽度为$W$，厚度为$h(x)$，层平均速度为$U(x)$：\n$$\nQ(x) = U(x) W h(x)\n$$\n\n**2. 质量守恒与卷夹**\n\n问题指出，溢流以卷夹速度$w_e = \\alpha_e U$卷入环境水。在距离$dx$上，输运量的增加量$dQ$是在该段上卷入的水的体积，其表面积为$W dx$。\n$$\ndQ = w_e (W dx) = (\\alpha_e U) W dx\n$$\n这给出了输运量演变的第一个ODE：\n$$\n\\frac{dQ}{dx} = \\alpha_e W U(x)\n$$\n\n**3. 密度演变**\n\n溢流的密度$\\rho(x)$由于卷入密度为$\\rho_a(z(x))$的环境水而改变。我们考虑密度示踪剂的守恒。控制体积中“密度物质”的总量为$\\rho Q$。该量的变化$d(\\rho Q)$必须等于由卷夹添加的密度物质的量，即$\\rho_a(z) dQ$。\n$$\nd(\\rho Q) = \\rho_a(z) dQ\n$$\n两边除以$dx$，并对左侧使用乘积法则进行微分：\n$$\n\\rho \\frac{dQ}{dx} + Q \\frac{d\\rho}{dx} = \\rho_a(z) \\frac{dQ}{dx}\n$$\n整理得到密度演变的第二个ODE：\n$$\n\\frac{d\\rho}{dx} = \\frac{\\rho_a(z(x)) - \\rho(x)}{Q(x)} \\frac{dQ}{dx}\n$$\n环境密度由线性剖面$\\rho_a(z) = \\rho_0 + \\gamma z$给出。\n\n**4. 动力学闭合：临界弗劳德数**\n\n由于速度$U(x)$未知，该系统尚未封闭。问题通过陈述流是临界控制的，即弗劳德数为1，来提供动力学闭合：\n$$\nFr = \\frac{U}{\\sqrt{g'h}} = 1\n$$\n这意味着$U^2 = g'h$。根据Boussinesq近似，折减重力$g'$定义为：\n$$\ng'(x) = g \\frac{\\rho(x) - \\rho_a(z(x))}{\\rho_0}\n$$\n我们需要用演化状态变量$Q$和$\\rho$来表示$U$。从输运量关系式中，我们有$h = Q / (UW)$。将其代入弗劳德数条件：\n$$\nU^2 = g' \\left(\\frac{Q}{UW}\\right) \\implies U^3 = \\frac{g'Q}{W}\n$$\n这得出了速度的表达式：\n$$\nU(x) = \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n这个方程封闭了系统。由此，输运量的变化率变为：\n$$\n\\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g'(x) Q(x)}{W}\\right)^{1/3}\n$$\n\n**5. 控制系统的综合与数值实现**\n\n为保证数值稳定性和简洁性，直接演化密度异常$\\Delta\\rho(x) = \\rho(x) - \\rho_a(z(x))$会更方便。注意$g'(x) = g \\Delta\\rho(x) / \\rho_0$。$\\Delta\\rho$的导数为：\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a(z(x))}{dx} = \\frac{d\\rho}{dx} - \\frac{d\\rho_a}{dz}\\frac{dz}{dx} = \\frac{d\\rho}{dx} - \\gamma s\n$$\n代入$d\\rho/dx$的表达式：\n$$\n\\frac{d(\\Delta\\rho)}{dx} = \\frac{-\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s\n$$\n因此，需要在$x$方向上积分的完整ODE系统是：\n1.  $\\displaystyle \\frac{dQ}{dx} = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho(x) Q(x)}{W}\\right)^{1/3}$\n2.  $\\displaystyle \\frac{d(\\Delta\\rho)}{dx} = -\\frac{\\Delta\\rho(x)}{Q(x)}\\frac{dQ}{dx} - \\gamma s$\n\n**算法：**\n该系统使用步长为$\\Delta x$的显式前向欧拉法求解。\n1.  **初始化**：在$x_0=0$处，设置初始条件：$Q_0 = Q_s$，$z_0 = z_0$，并计算初始密度异常$\\Delta\\rho_0 = \\rho_s - (\\rho_0 + \\gamma z_0)$。\n2.  **初始检查**：如果$\\Delta\\rho_0 \\le 0$，则溢流在海槛处不比环境水稠密。过程终止，注入参数为$z_{\\mathrm{inj}} = z_0$和$Q_{\\mathrm{inj}} = Q_s$。\n3.  **积分循环**：对于$i = 0, 1, 2, ...$\n    a. 检查终止条件：如果$\\Delta\\rho_i \\le 0$或$z_i \\ge z_{\\max}$，停止积分。\n    b. 计算第$i$步的导数：\n       i. $\\displaystyle \\left(\\frac{dQ}{dx}\\right)_i = \\alpha_e W \\left(\\frac{g}{\\rho_0} \\frac{\\Delta\\rho_i Q_i}{W}\\right)^{1/3}$\n       ii. $\\displaystyle \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i = -\\frac{\\Delta\\rho_i}{Q_i}\\left(\\frac{dQ}{dx}\\right)_i - \\gamma s$\n    c. 存储当前状态$(z_i, Q_i, \\Delta\\rho_i)$。\n    d. 更新下一步$i+1$的状态变量：\n       i. $x_{i+1} = x_i + \\Delta x$\n       ii. $z_{i+1} = z_i + s \\Delta x$\n       iii. $Q_{i+1} = Q_i + \\left(\\frac{dQ}{dx}\\right)_i \\Delta x$\n       iv. $\\Delta\\rho_{i+1} = \\Delta\\rho_i + \\left(\\frac{d(\\Delta\\rho)}{dx}\\right)_i \\Delta x$\n4.  **最终处理**：\n    a. 如果循环因为$z_i \\ge z_{\\max}$而终止，注入参数为$z_{\\mathrm{inj}} = z_{\\max}$和$Q_{\\mathrm{inj}} = Q_i$。\n    b. 如果循环因为$\\Delta\\rho_{i+1} \\le 0$而终止，说明中性浮力层在第$i$步和第$i+1$步之间被跨越。我们使用线性插值找到精确位置。设最后一个$\\Delta\\rho > 0$的状态为$(\\text{prev})$，第一个$\\Delta\\rho \\le 0$的状态为$(\\text{curr})$。插值分数$f = \\Delta\\rho_{\\text{prev}} / (\\Delta\\rho_{\\text{prev}} - \\Delta\\rho_{\\text{curr}})$。\n    c. 最终的注入深度和输运量为：\n       i. $z_{\\mathrm{inj}} = z_{\\text{prev}} + (z_{\\text{curr}} - z_{\\text{prev}}) \\times f$\n       ii. $Q_{\\mathrm{inj}} = Q_{\\text{prev}} + (Q_{\\text{curr}} - Q_{\\text{prev}}) \\times f$\n5. 最终结果按要求四舍五入到三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a parameterization for a dense overflow,\n    computing the neutral-buoyancy injection depth and transport.\n    \"\"\"\n    \n    # Global constants\n    RHO_0 = 1027.0  # Reference density, kg/m^3\n    G = 9.81        # Gravitational acceleration, m/s^2\n    ALPHA_E = 0.001 # Entrainment coefficient, dimensionless\n    DX = 10.0       # Step size for integration, m\n    Z_MAX = 3000.0  # Maximum allowed depth, m\n\n    # Test suite: (W, z0, rho_s, Qs, gamma, s)\n    # rho_s is 'auto' for Case D to be calculated based on other params.\n    test_cases_params = [\n        # Case A: happy path, moderate slope and strong source\n        {'W': 15000.0, 'z0': 600.0, 'rho_s': 1028.2, 'Qs': 1.2e6, 'gamma': 5.0e-4, 's': 0.010, 'case_id': 'A'},\n        # Case B: gentle slope, weaker source\n        {'W': 20000.0, 'z0': 800.0, 'rho_s': 1028.0, 'Qs': 6.0e5, 'gamma': 6.0e-4, 's': 0.003, 'case_id': 'B'},\n        # Case C: narrower overflow, steeper slope\n        {'W': 8000.0, 'z0': 500.0, 'rho_s': 1028.5, 'Qs': 8.0e5, 'gamma': 4.0e-4, 's': 0.020, 'case_id': 'C'},\n        # Case D: edge case, barely dense source\n        {'W': 12000.0, 'z0': 700.0, 'rho_s': 'auto', 'Qs': 4.0e5, 'gamma': 7.0e-4, 's': 0.006, 'case_id': 'D'}\n    ]\n\n    results = []\n\n    for params in test_cases_params:\n        W = params['W']\n        z0 = params['z0']\n        Qs = params['Qs']\n        gamma = params['gamma']\n        s = params['s']\n        \n        # Calculate rho_s for Case D\n        if params['rho_s'] == 'auto':\n            rho_s = RHO_0 + gamma * z0 + 0.05\n        else:\n            rho_s = params['rho_s']\n\n        # Initial conditions\n        x = 0.0\n        z = z0\n        Q = Qs\n        \n        rho_a_0 = RHO_0 + gamma * z0\n        delta_rho = rho_s - rho_a_0\n\n        # Check if plume is dense at the sill\n        if delta_rho = 0:\n            results.append([z0, Qs])\n            continue\n        \n        # Lists to store history for interpolation\n        history = []\n        \n        # Integration loop\n        while True:\n            # Check termination conditions\n            if delta_rho = 0 or z >= Z_MAX:\n                break\n                \n            # Store state before update\n            history.append({'z': z, 'Q': Q, 'delta_rho': delta_rho})\n\n            # Calculate reduced gravity\n            g_prime = (G / RHO_0) * delta_rho\n            \n            # Avoid root of negative number, though loop condition should prevent it\n            if g_prime * Q  0:\n                break\n\n            # Layer speed from critical Froude number condition\n            U = np.cbrt(g_prime * Q / W)\n            \n            # Derivatives\n            dQ_dx = ALPHA_E * W * U\n            d_delta_rho_dx = (-delta_rho / Q) * dQ_dx - gamma * s\n            \n            # Update variables using Forward Euler method\n            x += DX\n            z += s * DX\n            Q += dQ_dx * DX\n            delta_rho += d_delta_rho_dx * DX\n\n        # Finalization\n        if z >= Z_MAX and delta_rho > 0: # Reached max depth while still dense\n            z_inj = Z_MAX\n            q_inj = Q\n        else: # Crossed neutral buoyancy\n            if not history: # Could happen if it's not dense on the first step\n                 results.append([z0, Qs])\n                 continue\n                 \n            prev_state = history[-1]\n            z_prev, Q_prev, delta_rho_prev = prev_state['z'], prev_state['Q'], prev_state['delta_rho']\n            \n            # Current state is the one that terminated the loop\n            z_curr, Q_curr, delta_rho_curr = z, Q, delta_rho\n\n            # Linear interpolation to find where delta_rho is zero\n            if (delta_rho_prev - delta_rho_curr) == 0:\n                # This should not happen if delta_rho is changing\n                fraction = 0.5\n            else:\n                fraction = delta_rho_prev / (delta_rho_prev - delta_rho_curr)\n\n            z_inj = z_prev + (z_curr - z_prev) * fraction\n            q_inj = Q_prev + (Q_curr - Q_prev) * fraction\n            \n        results.append([z_inj, q_inj])\n\n    # Format output as required\n    formatted_pairs = []\n    for z_final, q_final in results:\n        formatted_pairs.append(f\"[{z_final:.3f},{q_final:.3f}]\")\n    \n    final_output_str = f\"[{','.join(formatted_pairs)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}