{
    "hands_on_practices": [
        {
            "introduction": "协方差局地化的有效性根植于一个对物理过程有意义的距离度量。在全球海洋模型中，这意味着必须准确地描述地球表面的曲率。本练习将通过推导大圆距离公式，帮助您掌握在球体上定义“距离”的几何基础，并理解为何简单的欧几里得距离不适用于全球尺度的应用。",
            "id": "3789685",
            "problem": "在一个采用集合卡尔曼滤波器（EnKF）的全球海洋数据同化系统中，协方差局地化需要在球形地球上的海洋网格点上定义的状态变量之间进行精确的间隔测量。考虑一个半径为 $a$ 的球面上的两个海洋网格点，其球面坐标由经纬度对 $(\\phi_{1}, \\lambda_{1})$ 和 $(\\phi_{2}, \\lambda_{2})$ 给出。利用球面上点的基本几何表示（即三维欧几里得空间中的位置）以及球面上弧长等于球面半径乘以所对中心角的定义，推导这两个点之间大圆距离 $d$ 的一个闭式表达式，该表达式用 $(\\phi_{1}, \\lambda_{1})$、$(\\phi_{2}, \\lambda_{2})$ 和 $a$ 表示。然后，解释为什么无论是作为三维空间中的直线弦长，还是作为经纬度坐标系中的平面距离，欧几里得距离都不适用于 EnKF 中的全球尺度协方差局地化。\n\n你的最终答案必须是 $d$ 关于 $(\\phi_{1}, \\lambda_{1})$、$(\\phi_{2}, \\lambda_{2})$ 和 $a$ 的单一解析表达式。不需要进行数值计算，也不需要四舍五入。最终的方框表达式中不要包含单位。",
            "solution": "该问题被评估为有效，因为它具有科学依据、提法明确且客观。它包含一个球面几何中的标准推导和一个与计算海洋学直接相关的概念性解释。\n\n**第一部分：大圆距离的推导**\n\n该问题要求计算半径为 $a$ 的球面上两点之间的大圆距离 $d$。这两点由其球面坐标（纬度和经度）给出，即 $(\\phi_{1}, \\lambda_{1})$ 和 $(\\phi_{2}, \\lambda_{2})$。推导过程将首先在三维笛卡尔坐标系中表示这些点，计算它们位置向量之间的中心角，然后利用给定的弧长、半径和中心角之间的关系。\n\n首先，我们建立一个笛卡尔坐标系 $(x, y, z)$，其原点位于球心。$z$ 轴穿过北极，$x$ 轴穿过本初子午线（经度 $0$）与赤道（纬度 $0$）的交点，$y$ 轴的选择构成一个右手坐标系。球面上一个半径为 $a$、纬度为 $\\phi$、经度为 $\\lambda$ 的点可以用笛卡尔坐标表示为：\n$$x = a \\cos(\\phi) \\cos(\\lambda)$$\n$$y = a \\cos(\\phi) \\sin(\\lambda)$$\n$$z = a \\sin(\\phi)$$\n这里，纬度 $\\phi$ 是位置向量与赤道（$x$-$y$）平面之间的夹角，范围从南极的 $-\\frac{\\pi}{2}$ 到北极的 $+\\frac{\\pi}{2}$。经度 $\\lambda$ 是在赤道平面内从 $x$ 轴量起的角度，通常范围从 $-\\pi$ 到 $\\pi$ 或从 $0$ 到 $2\\pi$。\n\n两个点 $P_1$ 和 $P_2$ 可以用它们从原点出发的位置向量 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$ 来表示：\n对于坐标为 $(\\phi_{1}, \\lambda_{1})$ 的点 $P_1$：\n$$ \\mathbf{r}_1 = \\begin{pmatrix} x_1 \\\\ y_1 \\\\ z_1 \\end{pmatrix} = \\begin{pmatrix} a \\cos(\\phi_1) \\cos(\\lambda_1) \\\\ a \\cos(\\phi_1) \\sin(\\lambda_1) \\\\ a \\sin(\\phi_1) \\end{pmatrix} $$\n对于坐标为 $(\\phi_{2}, \\lambda_{2})$ 的点 $P_2$：\n$$ \\mathbf{r}_2 = \\begin{pmatrix} x_2 \\\\ y_2 \\\\ z_2 \\end{pmatrix} = \\begin{pmatrix} a \\cos(\\phi_2) \\cos(\\lambda_2) \\\\ a \\cos(\\phi_2) \\sin(\\lambda_2) \\\\ a \\sin(\\phi_2) \\end{pmatrix} $$\n$P_1$ 和 $P_2$ 之间的大圆路径是球面与包含 $\\mathbf{r}_1$、$\\mathbf{r}_2$ 和原点的平面相交所形成的圆的较短弧。该弧的长度 $d$ 由 $d = a \\Delta\\sigma$ 给出，其中 $\\Delta\\sigma$ 是向量 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$ 之间的中心角。\n\n中心角 $\\Delta\\sigma$ 可以通过两个向量的点积求得：\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = |\\mathbf{r}_1| |\\mathbf{r}_2| \\cos(\\Delta\\sigma) $$\n由于两点都位于半径为 $a$ 的球面上，每个位置向量的模都为 $|\\mathbf{r}_1| = |\\mathbf{r}_2| = a$。因此，方程变为：\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = a^2 \\cos(\\Delta\\sigma) $$\n现在，我们使用笛卡尔分量计算点积：\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = x_1 x_2 + y_1 y_2 + z_1 z_2 $$\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = (a \\cos(\\phi_1) \\cos(\\lambda_1))(a \\cos(\\phi_2) \\cos(\\lambda_2)) + (a \\cos(\\phi_1) \\sin(\\lambda_1))(a \\cos(\\phi_2) \\sin(\\lambda_2)) + (a \\sin(\\phi_1))(a \\sin(\\phi_2)) $$\n提出因子 $a^2$：\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = a^2 [ \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_1)\\cos(\\lambda_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\sin(\\lambda_1)\\sin(\\lambda_2) + \\sin(\\phi_1)\\sin(\\phi_2) ] $$\n合并项并使用差角余弦恒等式 $\\cos(\\lambda_2 - \\lambda_1) = \\cos(\\lambda_1)\\cos(\\lambda_2) + \\sin(\\lambda_1)\\sin(\\lambda_2)$：\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = a^2 [ \\cos(\\phi_1)\\cos(\\phi_2)(\\cos(\\lambda_1)\\cos(\\lambda_2) + \\sin(\\lambda_1)\\sin(\\lambda_2)) + \\sin(\\phi_1)\\sin(\\phi_2) ] $$\n$$ \\mathbf{r}_1 \\cdot \\mathbf{r}_2 = a^2 [ \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1) + \\sin(\\phi_1)\\sin(\\phi_2) ] $$\n将此结果与点积的几何定义相等：\n$$ a^2 \\cos(\\Delta\\sigma) = a^2 [ \\sin(\\phi_1)\\sin(\\phi_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1) ] $$\n两边除以 $a^2$ 得到中心角余弦的表达式，这是球面余弦定律的一种形式：\n$$ \\cos(\\Delta\\sigma) = \\sin(\\phi_1)\\sin(\\phi_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1) $$\n求解中心角 $\\Delta\\sigma$：\n$$ \\Delta\\sigma = \\arccos\\left(\\sin(\\phi_1)\\sin(\\phi_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1)\\right) $$\n最后，大圆距离 $d$ 是半径 $a$ 与中心角 $\\Delta\\sigma$（以弧度为单位）的乘积：\n$$ d = a \\cdot \\Delta\\sigma $$\n代入 $\\Delta\\sigma$ 的表达式，我们得到大圆距离的闭式表达式：\n$$ d = a \\arccos\\left(\\sin(\\phi_1)\\sin(\\phi_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1)\\right) $$\n\n**第二部分：替代距离度量的不适用性**\n\n在集合卡尔曼滤波器（EnKF）中，协方差局地化是滤除由有限集合大小引起的伪长程相关性的关键步骤。局地化函数通常是状态变量之间距离的紧支函数。使用适当的距离度量对于滤波器的物理真实性和性能至关重要。\n\n1.  **作为三维空间中直线弦长的欧几里得距离：**\n    这个距离 $d_c$ 是连接两点 P$_1$ 和 P$_2$ 穿过地球内部的线段长度。虽然它在 $\\mathbb{R}^3$ 中是真实的几何距离，但由于以下两个主要原因，它不适用于海洋学中的全球尺度协方差局地化：\n    *   **物理无关性：** 洋流、波浪和热量输运等海洋学过程发生在海洋表面或近表面。两个不同位置的变量之间的相互作用和相关性是由沿表面或近表面路径的动力学决定的。大圆距离是表面上的最短路径，可作为与这些物理过程相关的间隔的一阶近似。而穿过地幔和地核的弦距离，对于任何海洋过程来说都代表了一条物理上无意义的路径。用它来模拟相关性随间隔的衰减在根本上是不合理的。\n    *   **距离失真：** 弦距离 $d_c$ 与大圆距离 $d$ 的关系为 $d_c = 2a \\sin(d/(2a))$。这是一种非线性关系。对于小间隔（$d \\ll a$），$d_c \\approx d$。然而，对于大的全球尺度间隔，该度量会严重失真。例如，对于对跖点，$d = \\pi a$ 而 $d_c = 2a$。比率 $d/d_c = \\pi/2 \\approx 1.57$。这意味着基于弦距离的局地化函数会错误地表示相关的空间尺度，可能在大表面距离上保留伪相关，或过早地切断有效的相关。\n\n2.  **经纬度坐标系中的欧几里得距离：**\n    这种方法将经纬度网格 $(\\phi, \\lambda)$ 视为一个平面笛卡尔坐标系。一个朴素的距离计算可能是 $d_p = \\sqrt{C_\\phi^2(\\phi_2 - \\phi_1)^2 + C_\\lambda^2(\\lambda_2 - \\lambda_1)^2}$，其中 $C_\\phi, C_\\lambda$ 是某些比例常数。这种度量对于全球应用存在严重缺陷：\n    *   **几何不一致性：** 这种方法从根本上忽略了地球的曲率。经度一度所对应的物理距离是纬度的函数：在赤道处最大（约 $111$ 公里），并由于经线向两极收敛而缩小至零。将 $(\\phi, \\lambda)$ 视为笛卡尔网格错误地暗示了每度经度的距离在任何地方都是恒定的。\n    *   **各向异性和非均匀性：** 该度量在物理空间中既不是各向同性（与方向无关）的，也不是均匀（与位置无关）的。在 $(\\phi, \\lambda)$ 坐标系中一个固定的“距离”，根据其在全球上的位置（特别是纬度）和方向，对应着截然不同的物理距离和形状。例如，在北极附近，两个纬度差异很小但经度差异很大的点在物理上非常接近，但平面欧几里得度量会计算出它们相距很远。协方差局地化通常（至少作为基线）假设相关性随物理距离呈各向同性衰减。使用这种平面度量会引入一种高度人为的、依赖于网格的各向异性，而这种各向异性没有物理依据。这将严重且系统地扭曲局地化协方差矩阵的结构，从而降低数据同化系统的分析和预报质量。\n\n总而言之，大圆距离正确地表示了球面上两点之间的最短间隔，这是适用于表面和近表面海洋过程的物理相关度量。替代的度量方法会引入严重且系统的误差，这些误差与协方差局地化背后的物理假设不兼容。",
            "answer": "$$\\boxed{a \\arccos(\\sin(\\phi_1)\\sin(\\phi_2) + \\cos(\\phi_1)\\cos(\\phi_2)\\cos(\\lambda_2 - \\lambda_1))}$$"
        },
        {
            "introduction": "乘性方差膨胀是应对有限规模集合中预报误差方差被低估问题的关键技术。然而，它并非没有代价，不恰当的膨胀反而会降低滤波器的性能。本练习通过推导一个量化分析误差的“退化因子”$r(\\alpha)$，让您从理论层面深刻理解为何必须审慎地调整膨胀参数，以及过度膨胀如何损害最终的分析质量。",
            "id": "3789690",
            "problem": "考虑在一个集合卡尔曼滤波器（EnKF；Ensemble Kalman Filter）中，对单个海洋格点的海表温度（SST）异常进行一维同化。设真实的海表温度异常由 $x$ 表示，并假设一个线性观测模型 $y = x + \\varepsilon$，其中 $\\varepsilon$ 是观测误差，其均值为零，方差为 $R$，且与预报误差无关。$x$ 的先验（预报）分布的均值为 $m_{f}$，方差为 $P_{f}$，并且由于集合大小有限，集合协方差被系统性地低估。为缓解离散度不足的问题，EnKF 应用了乘性协方差膨胀：它在滤波器计算中用 $\\alpha P_{f}$ 替换预报协方差 $P_{f}$，其中膨胀因子 $\\alpha \\geq 1$。协方差局地化使用一个紧支集核函数，该核函数在零距离处的值为1；因此，在这种标量设置中，局地化不改变方差。\n\n从线性高斯贝叶斯更新以及分析均值 $m_{a}$ 是预报和观测残差的线性组合的定义出发，推导乘性膨胀如何改变卡尔曼增益 $K$ 和报告的分析方差。然后，当滤波器在计算 $K$ 时使用膨胀后的协方差，但实际（真实）的先验方差是 $P_{f}$ 且观测误差方差是 $R$ 时，推导分析均值估计量的真实分析误差方差。\n\n最后，将退化因子 $r(\\alpha)$ 定义为在膨胀因子为 $\\alpha$ 时的真实分析误差方差与在最优（无膨胀）设置 $\\alpha = 1$ 时的真实分析误差方差之比。引入方差比 $\\beta = P_{f}/R$，并仅用 $\\alpha$ 和 $\\beta$ 来表示 $r(\\alpha)$。请将最终答案表示为 $r(\\alpha)$ 的单一闭式解析表达式。无需四舍五入，最终答案是无量纲的。",
            "solution": "该问题要求推导退化因子 $r(\\alpha)$，它量化了在标量卡尔曼滤波器设置中，使用乘性协方差膨胀因子 $\\alpha$ 对真实分析误差方差的影响。\n\n首先，我们建立一个最优卡尔曼滤波器的基准情况，其中不应用膨胀，即 $\\alpha = 1$。状态和观测模型是标量：真实状态为 $x$，预报均值为 $m_f$，方差为 $P_f$，观测为 $y = x + \\varepsilon$，其中 $\\varepsilon$ 是一个均值为零、方差为 $R$ 的误差。观测算子 $H$ 是单位算子，即 $H=1$。\n\n标准卡尔曼增益 $K_{opt}$ 由下式给出：\n$$K_{opt} = \\frac{P_f H}{H P_f H^T + R} = \\frac{P_f}{P_f + R}$$\n分析均值 $m_a$ 按如下方式更新：\n$$m_a = m_f + K(y - m_f)$$\n得到的最优分析误差方差，我们记为 $P_{a,opt}$，是：\n$$P_{a,opt} = (1 - K_{opt}H)P_f = \\left(1 - \\frac{P_f}{P_f + R}\\right)P_f = \\frac{R}{P_f + R} P_f = \\frac{P_f R}{P_f + R}$$\n这是我们退化因子比率的分母。\n\n接下来，我们考虑应用乘性膨胀的情况。滤波器在预报误差方差为 $\\alpha P_f$（其中 $\\alpha \\ge 1$）的假设下运行。滤波器使用这个膨胀后的方差计算其卡尔曼增益，我们记为 $K_{infl}$：\n$$K_{infl} = \\frac{\\alpha P_f}{\\alpha P_f + R}$$\n滤波器使用此增益更新其状态估计：\n$$m_a(\\alpha) = m_f + K_{infl}(y - m_f)$$\n滤波器“报告”的分析方差 $P_{a,rep}$ 也将基于膨胀后的先验方差：\n$$P_{a,rep} = (1 - K_{infl})(\\alpha P_f) = \\left(1 - \\frac{\\alpha P_f}{\\alpha P_f + R}\\right)(\\alpha P_f) = \\frac{R}{\\alpha P_f + R}(\\alpha P_f) = \\frac{\\alpha P_f R}{\\alpha P_f + R}$$\n然而，问题要求的是*真实*的分析误差方差，它必须使用*真实*的预报误差方差 $P_f$ 来计算，同时要承认更新是使用次优增益 $K_{infl}$ 执行的。\n\n分析误差为 $e_a = x - m_a(\\alpha)$。代入 $m_a(\\alpha)$ 和 $y=x+\\varepsilon$ 的表达式：\n$$e_a = x - [m_f + K_{infl}(x + \\varepsilon - m_f)]$$\n$$e_a = (x - m_f) - K_{infl}((x-m_f) + \\varepsilon)$$\n设预报误差为 $e_f = x - m_f$。$e_f$ 的方差是真实的预报方差 $P_f$。我们可以将分析误差写为：\n$$e_a = e_f - K_{infl}(e_f + \\varepsilon) = (1 - K_{infl})e_f - K_{infl}\\varepsilon$$\n真实的分析误差方差 $P_{a,true}(\\alpha)$ 是 $e_a$ 的方差。由于预报误差 $e_f$ 和观测误差 $\\varepsilon$ 是独立的，在计算方差时它们的交叉项为零：\n$$P_{a,true}(\\alpha) = \\text{Var}(e_a) = E[e_a^2] = E[((1 - K_{infl})e_f - K_{infl}\\varepsilon)^2]$$\n$$P_{a,true}(\\alpha) = (1 - K_{infl})^2 E[e_f^2] + K_{infl}^2 E[\\varepsilon^2] - 2(1 - K_{infl})K_{infl}E[e_f \\varepsilon]$$\n$$P_{a,true}(\\alpha) = (1 - K_{infl})^2 P_f + K_{infl}^2 R$$\n这是给定一个次优增益 $K_{infl}$ 时，真实分析方差的通用公式。现在，我们代入 $K_{infl}$ 的表达式：\n$$1 - K_{infl} = 1 - \\frac{\\alpha P_f}{\\alpha P_f + R} = \\frac{R}{\\alpha P_f + R}$$\n$$P_{a,true}(\\alpha) = \\left(\\frac{R}{\\alpha P_f + R}\\right)^2 P_f + \\left(\\frac{\\alpha P_f}{\\alpha P_f + R}\\right)^2 R$$\n$$P_{a,true}(\\alpha) = \\frac{R^2 P_f + \\alpha^2 P_f^2 R}{(\\alpha P_f + R)^2} = \\frac{P_f R (R + \\alpha^2 P_f)}{(\\alpha P_f + R)^2}$$\n这是使用膨胀因子 $\\alpha$ 时的真实分析误差方差。注意，当 $\\alpha=1$ 时，此表达式简化为 $P_{a,opt}$：\n$$P_{a,true}(1) = \\frac{P_f R (R + P_f)}{(P_f + R)^2} = \\frac{P_f R}{P_f + R} = P_{a,opt}$$\n\n退化因子 $r(\\alpha)$ 定义为使用膨胀时的真实分析误差方差与最优分析误差方差（即 $\\alpha=1$ 时）之比：\n$$r(\\alpha) = \\frac{P_{a,true}(\\alpha)}{P_{a,opt}} = \\frac{\\frac{P_f R (R + \\alpha^2 P_f)}{(\\alpha P_f + R)^2}}{\\frac{P_f R}{P_f + R}}$$\n项 $P_f R$ 被消去：\n$$r(\\alpha) = \\frac{R + \\alpha^2 P_f}{(\\alpha P_f + R)^2} (P_f + R)$$\n\n最后，我们用 $\\alpha$ 和方差比 $\\beta = P_f/R$ 来表示这个结果。为此，我们可以将分数的分子和分母同除以 $R^2$。\n整个表达式的分子变为：\n$$(R + \\alpha^2 P_f)(P_f + R) = R\\left(1 + \\alpha^2 \\frac{P_f}{R}\\right) R\\left(\\frac{P_f}{R} + 1\\right) = R^2(1 + \\alpha^2 \\beta)(1 + \\beta)$$\n分母变为：\n$$(\\alpha P_f + R)^2 = \\left[R\\left(\\alpha \\frac{P_f}{R} + 1\\right)\\right]^2 = R^2(\\alpha \\beta + 1)^2$$\n因此，该比率为：\n$$r(\\alpha) = \\frac{R^2(1 + \\beta)(1 + \\alpha^2 \\beta)}{R^2(1 + \\alpha \\beta)^2} = \\frac{(1 + \\beta)(1 + \\alpha^2 \\beta)}{(1 + \\alpha \\beta)^2}$$\n这是退化因子 $r(\\alpha)$ 关于 $\\alpha$ 和 $\\beta$ 的最终表达式。作为合理性检验，如果 $\\alpha=1$，则 $r(1) = \\frac{(1+\\beta)(1+\\beta)}{(1+\\beta)^2}=1$，这证实了在最优设置下没有退化。",
            "answer": "$$\\boxed{\\frac{(1+\\beta)(1+\\alpha^2\\beta)}{(1+\\alpha\\beta)^2}}$$"
        },
        {
            "introduction": "在掌握了局地化和方差膨胀的理论之后，下一步是将其应用于实际的滤波算法中。本练习提供了一个在局地集合变换卡尔曼滤波（LETKF）框架下的具体计算任务。您将通过动手计算分析权重向量$w^{a}$，直观地观察到局地化半径$L$的改变如何直接影响分析步骤，从而加深对局地化在算法层面如何工作的理解。",
            "id": "3789747",
            "problem": "考虑在局地集合变换卡尔曼滤波 (LETKF) 中对海面高度异常进行一维局地资料同化。背景集合有 $k=4$ 个成员，背景集合扰动映射到观测空间后，形成如下给定的 $3 \\times 4$ 矩阵 $Y^{b}$：\n$$\nY^{b} \\equiv \\begin{pmatrix}\n1  0  0  -1 \\\\\n0  1  0  -1 \\\\\n0  0  1  -1 \n\\end{pmatrix}.\n$$\n假设观测算子是线性的，无量纲化的观测误差协方差为 $R = I_{3}$，并且对集合扰动应用了因子为 $\\alpha = 1.2$ 的先验乘性膨胀。在三个附近的沿轨高度计点上，观测到的新息向量为\n$$\nd \\equiv \\begin{pmatrix} 1.2 \\\\ -0.6 \\\\ 0.8 \\end{pmatrix}.\n$$\n这三个观测点距离分析格点的距离分别为 $100$ km、$200$ km 和 $300$ km。LETKF 使用一种局地区域选择（局地化）方法，只保留格点周围截断半径 $L$ 内的观测。\n\n从最小方差线性高斯估计原理和卡尔曼滤波的集合表示出发，推导并计算在两个不同的局地化半径下，格点上的局地集合空间分析权重向量 $w^{a}(L)$：\n- 情况 A：$L = 250$ km，保留前两个观测（位于 $100$ km 和 $200$ km 处）。\n- 情况 B：$L = 125$ km，仅保留第一个观测（位于 $100$ km 处）。\n\n一致地使用先验膨胀因子 $\\alpha$，并将局地化处理为按距离进行的严格观测筛选。然后，通过计算比率来量化将局地化半径减半的影响\n$$\nr \\equiv \\frac{\\|w^{a}(125)\\|_{2}}{\\|w^{a}(250)\\|_{2}}.\n$$\n将最终比率表示为一个无单位的纯数，并将答案四舍五入到四位有效数字。",
            "solution": "该问题定义明确，其科学基础是集合资料同化原理，并且包含了得出唯一解所需的所有信息。因此，该问题是有效的。\n\n局地集合变换卡尔曼滤波 (LETKF) 的核心是在集合扰动张成的空间中找到一个分析权重向量 $w^a$。该向量用于计算分析增量。向量 $w^a$ 是一个线性系统的解，该系统通过平衡与背景估计的距离和与观测的距离来最小化代价函数。\n\n对于一个大小为 $k$ 的集合，观测空间中的背景扰动矩阵 $Y^b$，观测误差协方差矩阵 $R$，新息向量 $d$，以及先验乘性膨胀因子 $\\alpha$，分析权重向量 $w^a$ 由以下方程的解给出：\n$$\n\\left[ \\frac{k-1}{\\alpha^2}I_k + (Y^b)^T R^{-1} Y^b \\right] w^a = (Y^b)^T R^{-1} d\n$$\n其中 $I_k$ 是 $k \\times k$ 的单位矩阵。\n\n问题将局地化指定为在截断半径 $L$ 内对观测进行严格筛选。这意味着我们必须在每种情况下，使用与所选观测相对应的给定数据子集来求解上述方程。给定的数据如下：\n- 集合大小，$k=4$。\n- 膨胀因子，$\\alpha = 1.2$。\n- 完整的观测空间背景扰动矩阵：\n$$\nY^{b}_{full} = \\begin{pmatrix}\n1  0  0  -1 \\\\\n0  1  0  -1 \\\\\n0  0  1  -1 \n\\end{pmatrix}\n$$\n- 完整的新息向量：\n$$\nd_{full} = \\begin{pmatrix} 1.2 \\\\ -0.6 \\\\ 0.8 \\end{pmatrix}\n$$\n- 完整的观测误差协方差矩阵为 $R_{full} = I_3$，所以其逆矩阵也是 $R_{full}^{-1} = I_3$。\nLETKF 方程中的常数项为 $\\frac{k-1}{\\alpha^2} = \\frac{4-1}{1.2^2} = \\frac{3}{1.44} = \\frac{300}{144} = \\frac{25}{12}$。\n\n### 情况 A：局地化半径 $L = 250$ km\n对于此半径，保留前两个观测（位于 $100$ km 和 $200$ km 处）。我们选择 $Y^b_{full}$ 和 $d_{full}$ 的前两行，以及 $R_{full}$ 的左上角 $2 \\times 2$ 块。\n- 局地新息：$d_A = \\begin{pmatrix} 1.2 \\\\ -0.6 \\end{pmatrix}$。\n- 局地扰动：$Y^b_A = \\begin{pmatrix} 1  0  0  -1 \\\\ 0  1  0  -1 \\end{pmatrix}$。\n- 局地观测误差协方差：$R_A = I_2$，因此 $R_A^{-1} = I_2$。\n\n我们首先计算矩阵 $(Y^b_A)^T R_A^{-1} Y^b_A = (Y^b_A)^T Y^b_A$：\n$$\n(Y^b_A)^T Y^b_A = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ -1  -1 \\end{pmatrix} \\begin{pmatrix} 1  0  0  -1 \\\\ 0  1  0  -1 \\end{pmatrix} = \\begin{pmatrix} 1  0  0  -1 \\\\ 0  1  0  -1 \\\\ 0  0  0  0 \\\\ -1  -1  0  2 \\end{pmatrix}\n$$\n接下来，我们构成该线性系统的完整矩阵，记为 $M_A$：\n$$\nM_A = \\frac{25}{12}I_4 + (Y^b_A)^T Y^b_A = \\begin{pmatrix} \\frac{25}{12}+1  0  0  -1 \\\\ 0  \\frac{25}{12}+1  0  -1 \\\\ 0  0  \\frac{25}{12}  0 \\\\ -1  -1  0  \\frac{25}{12}+2 \\end{pmatrix} = \\begin{pmatrix} \\frac{37}{12}  0  0  -1 \\\\ 0  \\frac{37}{12}  0  -1 \\\\ 0  0  \\frac{25}{12}  0 \\\\ -1  -1  0  \\frac{49}{12} \\end{pmatrix}\n$$\n现在，我们计算右侧向量 $v_A = (Y^b_A)^T R_A^{-1} d_A$：\n$$\nv_A = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\\\ -1  -1 \\end{pmatrix} \\begin{pmatrix} 1.2 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} 1.2 \\\\ -0.6 \\\\ 0 \\\\ -0.6 \\end{pmatrix}\n$$\n我们求解方程组 $M_A w^a(250) = v_A$。第三个方程 $\\frac{25}{12}w_3 = 0$ 立即得出 $w_3=0$。剩下的方程构成一个关于 $w_1, w_2, w_4$ 的 $3 \\times 3$ 方程组。求解该方程组得出向量：\n$$\nw^a(250) = \\begin{pmatrix} \\frac{792}{2257} \\\\ -\\frac{2628}{11285} \\\\ 0 \\\\ -\\frac{36}{305} \\end{pmatrix} \\approx \\begin{pmatrix} 0.350908 \\\\ -0.232875 \\\\ 0 \\\\ -0.118033 \\end{pmatrix}\n$$\n\n### 情况 B：局地化半径 $L = 125$ km\n对于此半径，仅保留第一个观测（位于 $100$ km 处）。我们选择 $Y^b_{full}$ 和 $d_{full}$ 的第一行，以及 $R_{full}$ 的左上角元素。\n- 局地新息：$d_B = (1.2)$。\n- 局地扰动：$Y^b_B = \\begin{pmatrix} 1  0  0  -1 \\end{pmatrix}$。\n- 局地观测误差协方差：$R_B = (1)$，因此 $R_B^{-1} = (1)$。\n\n我们计算 $(Y^b_B)^T R_B^{-1} Y^b_B = (Y^b_B)^T Y^b_B$：\n$$\n(Y^b_B)^T Y^b_B = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix} \\begin{pmatrix} 1  0  0  -1 \\end{pmatrix} = \\begin{pmatrix} 1  0  0  -1 \\\\ 0  0  0  0 \\\\ 0  0  0  0 \\\\ -1  0  0  1 \\end{pmatrix}\n$$\n该方程组的完整矩阵 $M_B$ 是：\n$$\nM_B = \\frac{25}{12}I_4 + (Y^b_B)^T Y^b_B = \\begin{pmatrix} \\frac{25}{12}+1  0  0  -1 \\\\ 0  \\frac{25}{12}  0  0 \\\\ 0  0  \\frac{25}{12}  0 \\\\ -1  0  0  \\frac{25}{12}+1 \\end{pmatrix} = \\begin{pmatrix} \\frac{37}{12}  0  0  -1 \\\\ 0  \\frac{25}{12}  0  0 \\\\ 0  0  \\frac{25}{12}  0 \\\\ -1  0  0  \\frac{37}{12} \\end{pmatrix}\n$$\n右侧向量 $v_B = (Y^b_B)^T R_B^{-1} d_B$：\n$$\nv_B = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix} (1.2) = \\begin{pmatrix} 1.2 \\\\ 0 \\\\ 0 \\\\ -1.2 \\end{pmatrix}\n$$\n我们求解 $M_B w^a(125) = v_B$。第二个和第三个方程得出 $w_2=0$ 和 $w_3=0$。剩下的关于 $w_1$ 和 $w_4$ 的 $2 \\times 2$ 方程组的解为：\n$$\nw^a(125) = \\begin{pmatrix} \\frac{72}{245} \\\\ 0 \\\\ 0 \\\\ -\\frac{72}{245} \\end{pmatrix} \\approx \\begin{pmatrix} 0.293878 \\\\ 0 \\\\ 0 \\\\ -0.293878 \\end{pmatrix}\n$$\n\n### 比率计算\n最后，我们计算两个权重向量的欧几里得范数的比率 $r$。\n首先，计算 $w^a(125)$ 的范数：\n$$\n\\|w^a(125)\\|_2 = \\sqrt{\\left(\\frac{72}{245}\\right)^2 + 0^2 + 0^2 + \\left(-\\frac{72}{245}\\right)^2} = \\sqrt{2 \\left(\\frac{72}{245}\\right)^2} = \\frac{72\\sqrt{2}}{245} \\approx 0.415606\n$$\n接下来，计算 $w^a(250)$ 的范数：\n$$\n\\|w^a(250)\\|_2 = \\sqrt{\\left(\\frac{792}{2257}\\right)^2 + \\left(-\\frac{2628}{11285}\\right)^2 + 0^2 + \\left(-\\frac{36}{305}\\right)^2} \\approx \\sqrt{(0.350908)^2 + (-0.232875)^2 + (-0.118033)^2}\n$$\n$$\n\\|w^a(250)\\|_2 \\approx \\sqrt{0.123136 + 0.054231 + 0.013932} = \\sqrt{0.191299} \\approx 0.437378\n$$\n比率 $r$ 为：\n$$\nr = \\frac{\\|w^{a}(125)\\|_{2}}{\\|w^{a}(250)\\|_{2}} \\approx \\frac{0.415606}{0.437378} \\approx 0.950242\n$$\n四舍五入到四位有效数字，比率为 $0.9502$。",
            "answer": "$$\n\\boxed{0.9502}\n$$"
        }
    ]
}