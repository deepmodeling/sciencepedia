{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of numerical modeling is verification: ensuring your code behaves as theoretically expected. This first practice guides you through a grid refinement study, a fundamental technique to measure a model's convergence rate. By implementing a simple finite volume scheme for the advection-diffusion equation and comparing it to a known analytic solution, you will calculate the observed order of accuracy and confirm that your implementation is correct .",
            "id": "3795833",
            "problem": "Consider the one-dimensional periodic advection–diffusion of a passive tracer with constant velocity and diffusivity, a canonical model used in Computational Oceanography. Let the concentration field be denoted by $c(x,t)$ on the domain $x \\in [0,L]$, with $L$ the domain length. The governing equation is the conservation law\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) \\;=\\; \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right),\n$$\nwhere $u$ is the constant advective velocity and $\\kappa$ is the constant diffusivity. Periodic boundary conditions are imposed at $x=0$ and $x=L$, and the initial condition is a single Fourier mode,\n$$\nc(x,0) \\;=\\; \\sin\\!\\left(k\\,x\\right), \\quad k \\;=\\; \\frac{2\\pi m}{L},\n$$\nwith $m$ a positive integer ensuring periodicity.\n\nThe analytic solution of this initial value problem is given by\n$$\nc_{\\text{exact}}(x,t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x - u\\,t\\right)\\right).\n$$\nBecause the numerical method evolves cell-averaged values, the exact cell-average over a cell of width $\\Delta x$ centered at $x_i$ is\n$$\n\\bar{c}_{\\text{exact},i}(t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x_i - u\\,t\\right)\\right)\\,\\frac{2\\,\\sin\\!\\left(\\frac{k\\,\\Delta x}{2}\\right)}{k\\,\\Delta x}.\n$$\n\nYou must implement a uniform-mesh Finite Volume Method (FVM) for this equation with the following specifications, starting from the integral conservation law over a control volume and consistent face fluxes:\n\n- Mesh: divide $[0,L]$ into $N$ uniform cells of width $\\Delta x = L/N$ with periodic connectivity. Store and evolve the cell averages $\\bar{c}_i(t)$.\n- Face flux: write the total flux as $F = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}$. At a cell face $x_{i+1/2}$, approximate the advective flux as $F^{\\text{adv}}_{i+1/2} = u\\,\\hat{c}_{i+1/2}$ using first-order upwind for $\\hat{c}_{i+1/2}$ depending on the sign of $u$, and approximate the diffusive flux as $F^{\\text{diff}}_{i+1/2} = -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}$ using a second-order central difference of cell averages. The total face flux is $F_{i+1/2} = F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$.\n- Time stepping: use the forward Euler (first-order) method applied to the semi-discrete FVM update,\n$$\n\\bar{c}_i^{n+1} \\;=\\; \\bar{c}_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right),\n$$\nwith periodic indexing. Choose the time step to satisfy stability and to minimize temporal error contamination in the spatial grid refinement study by\n$$\n\\Delta t \\;=\\; \\min\\!\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right),\n$$\nwhere $c_a = 0.5$ and $c_d = 0.25$. To reach the prescribed final time $T$ exactly, take $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$ and reset $\\Delta t \\leftarrow T/n_{\\text{steps}}$.\n\nDefine the discrete root-mean-square (RMS) error at time $T$ by\n$$\nE(\\Delta x) \\;=\\; \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\bar{c}_i(T) - \\bar{c}_{\\text{exact},i}(T)\\right)^2},\n$$\nand compute the observed order of accuracy between successive grid sizes in a refinement sequence with halving $\\Delta x$ as\n$$\np \\;=\\; \\frac{\\log\\!\\left(E(\\Delta x_{\\text{coarse}})/E(\\Delta x_{\\text{fine}})\\right)}{\\log\\!\\left(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}}\\right)}.\n$$\n\nPerform a grid refinement study for the following test suite, which explores different regimes through the velocity $u$, diffusivity $\\kappa$, wavelength index $m$, and mesh sequences. All physical parameters must be used with their units as given. The reported observed orders are dimensionless.\n\n- Case $\\#1$ (advection-dominated): $L = 1000\\,\\mathrm{m}$, $u = 0.5\\,\\mathrm{m/s}$, $\\kappa = 0.01\\,\\mathrm{m^2/s}$, $m = 1$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[20,40,80,160,320]$.\n- Case $\\#2$ (diffusion-dominated): $L = 1000\\,\\mathrm{m}$, $u = 0.05\\,\\mathrm{m/s}$, $\\kappa = 5\\,\\mathrm{m^2/s}$, $m = 1$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[20,40,80,160,320]$.\n- Case $\\#3$ (mixed with coarse meshes): $L = 1000\\,\\mathrm{m}$, $u = 0.5\\,\\mathrm{m/s}$, $\\kappa = 0.5\\,\\mathrm{m^2/s}$, $m = 4$, $T = 1000\\,\\mathrm{s}$, $N$ sequence $[10,20,40,80,160]$.\n\nYour program must:\n- Initialize $\\bar{c}_i(0)$ to the exact cell average of the prescribed initial condition.\n- Advance the solution to $t=T$ using the specified FVM and time-stepping.\n- For each case, compute the error $E(\\Delta x)$ at each $N$ and the observed orders $p$ between successive grid sizes.\n- Produce a single line of output containing the results as a comma-separated list of lists, where each inner list corresponds to one case and contains the observed orders for that case in the order of successive refinements. For example, output of the form\n`[[p_{1,1},p_{1,2},p_{1,3},p_{1,4}],[p_{2,1},p_{2,2},p_{2,3},p_{2,4}],[p_{3,1},p_{3,2},p_{3,3},p_{3,4}]]`,\nwith each $p_{i,j}$ a floating-point number.\n\nAll angles (e.g., in trigonometric functions) are in radians. All physical inputs are in International System of Units (SI): $L$ in $\\mathrm{m}$, $u$ in $\\mathrm{m/s}$, $\\kappa$ in $\\mathrm{m^2/s}$, and $T$ in $\\mathrm{s}$. The final output observed orders are dimensionless floats. The study must be designed to reveal and measure the observed order of accuracy and to enable discussion of potential causes for non-asymptotic behavior on coarse meshes.",
            "solution": "The problem requires the implementation and analysis of a finite volume method (FVM) for the one-dimensional advection-diffusion equation. The analysis is to be performed via a grid refinement study to determine the observed order of accuracy of the numerical scheme.\n\nThe governing partial differential equation (PDE) for the concentration $c(x,t)$ is:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0, \\quad \\text{where } F(c) = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}\n$$\nHere, $u$ is the constant advective velocity and $\\kappa$ is the constant diffusivity. The term $F(c)$ represents the total flux, composed of an advective part, $F^{\\text{adv}} = u\\,c$, and a diffusive part, $F^{\\text{diff}} = -\\kappa\\,\\frac{\\partial c}{\\partial x}$.\n\nWe discretize the spatial domain $[0, L]$ into $N$ uniform control volumes (cells), each of width $\\Delta x = L/N$. The cell centers are located at $x_i = (i+0.5)\\Delta x$ for $i = 0, 1, \\dots, N-1$. The FVM evolves the cell-averaged concentration, defined as:\n$$\n\\bar{c}_i(t) = \\frac{1}{\\Delta x} \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} c(x,t)\\,dx\n$$\nIntegrating the PDE over the $i$-th cell gives the exact evolution equation for the cell average:\n$$\n\\frac{d\\bar{c}_i}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) = 0\n$$\nwhere $F_{i\\pm1/2}$ are the fluxes at the cell faces located at $x_{i\\pm1/2} = x_i \\pm \\Delta x/2$. We must approximate these face fluxes using the known cell-averaged values $\\bar{c}_j$.\n\nThe total flux at face $x_{i+1/2}$ is approximated as $F_{i+1/2} \\approx F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$.\n1.  **Advective Flux ($F^{\\text{adv}}$)**: The problem specifies a first-order upwind scheme. For a velocity $u > 0$ (as is true for all test cases), the value of the tracer at the face is determined by the \"upwind\" cell, which is cell $i$. Thus, the advected quantity at the face is approximated by the cell average $\\bar{c}_i$.\n    $$\n    F^{\\text{adv}}_{i+1/2} = u\\,\\bar{c}_i\n    $$\n    This scheme is first-order accurate in space.\n\n2.  **Diffusive Flux ($F^{\\text{diff}}$)**: The problem specifies a second-order central difference approximation for the gradient at the face, using the adjacent cell averages:\n    $$\n    F^{\\text{diff}}_{i+1/2} = -\\kappa \\left( \\frac{\\partial c}{\\partial x} \\right)_{i+1/2} \\approx -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n    $$\n    This scheme is second-order accurate.\n\nCombining these gives the total numerical flux at face $x_{i+1/2}$:\n$$\nF_{i+1/2} = u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n$$\nAnd similarly for the face at $x_{i-1/2}$:\n$$\nF_{i-1/2} = u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\n$$\nSubstituting these into the semi-discrete FVM equation yields:\n$$\n\\frac{d\\bar{c}_i}{dt} = -\\frac{1}{\\Delta x} \\left( \\left(u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\\right) - \\left(u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\\right) \\right)\n$$\nRearranging terms gives the spatial discretization for the right-hand side (RHS) of the ordinary differential equation system for the $\\bar{c}_i$'s:\n$$\n\\frac{d\\bar{c}_i}{dt} = -u \\left(\\frac{\\bar{c}_i - \\bar{c}_{i-1}}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1} - 2\\bar{c}_i + \\bar{c}_{i-1}}{\\Delta x^2}\\right)\n$$\nThe overall spatial accuracy of this scheme is determined by the lowest-order term, which is the first-order upwind advection. Thus, the spatial scheme is first-order accurate.\n\nFor time integration, the forward Euler method is specified. Denoting the solution at time step $n$ as $\\bar{c}_i^n$, the update is:\n$$\n\\frac{\\bar{c}_i^{n+1} - \\bar{c}_i^n}{\\Delta t} = -u \\left(\\frac{\\bar{c}_i^n - \\bar{c}_{i-1}^n}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1}^n - 2\\bar{c}_i^n + \\bar{c}_{i-1}^n}{\\Delta x^2}\\right)\n$$\nThis is an explicit scheme. The time step $\\Delta t$ must be chosen to ensure stability. The problem prescribes a Courant-Friedrichs-Lewy (CFL)-like condition:\n$$\n\\Delta t = \\min\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right)\n$$\nwith $c_a = 0.5$ and $c_d = 0.25$. These values ensure that the coefficients of $\\bar{c}_i^n$, $\\bar{c}_{i-1}^n$, and $\\bar{c}_{i+1}^n$ in the rearranged update formula are non-negative, a sufficient condition for stability of this scheme. To reach the final time $T$ exactly, the number of steps is computed as $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$, and the time step is adjusted to $\\Delta t = T/n_{\\text{steps}}$.\n\nThe initial condition for the numerical simulation must be the cell average of the continuous initial condition $c(x,0) = \\sin(kx)$. This is given by:\n$$\n\\bar{c}_i(0) = \\frac{1}{\\Delta x}\\int_{x_i-\\Delta x/2}^{x_i+\\Delta x/2} \\sin(kx)\\,dx = \\sin(kx_i)\\,\\frac{2\\sin(k\\Delta x/2)}{k\\Delta x}\n$$\nThe simulation is run for each specified grid resolution $N$. The final numerical solution $\\bar{c}_i(T)$ is compared against the exact cell-averaged solution $\\bar{c}_{\\text{exact},i}(T)$ to compute the RMS error $E(\\Delta x)$. The observed order of accuracy $p$ is then calculated from the errors of two successive resolutions, $E_{\\text{coarse}}$ and $E_{\\text{fine}}$, corresponding to grid spacings $\\Delta x_{\\text{coarse}}$ and $\\Delta x_{\\text{fine}}$ where $\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}} = 2$:\n$$\np = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}})} = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(2)} = \\log_2(E_{\\text{coarse}}/E_{\\text{fine}})\n$$\nSince the numerical scheme is first-order accurate in both space and time (with $\\Delta t$ scaling with $\\Delta x$ or $\\Delta x^2$), we anticipate that the observed order $p$ will approach $1$ as the grid is refined. Deviations from this value on coarser grids can occur due to the influence of higher-order error terms or poor resolution of the solution features, as explored in Case $\\#3$ where the wavelength is short relative to the coarsest grid spacings.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef run_refinement_study(L, u, kappa, m, T, N_list):\n    \"\"\"\n    Performs a grid refinement study for a single test case.\n\n    Args:\n        L (float): Domain length.\n        u (float): Advective velocity.\n        kappa (float): Diffusivity.\n        m (int): Wavenumber index.\n        T (float): Final time.\n        N_list (list of int): Sequence of grid sizes for the study.\n\n    Returns:\n        list of float: The observed orders of accuracy between successive refinements.\n    \"\"\"\n    errors = []\n    \n    for N in N_list:\n        # Step 1: Set up the grid and parameters\n        dx = L / N\n        # Cell centers\n        x = np.arange(0.5, N, 1.0) * dx\n        k = 2.0 * np.pi * m / L\n\n        # Step 2: Set the initial condition (exact cell-averaged)\n        # The factor accounts for averaging sin(kx) over a cell width dx\n        # sinc(z) = sin(z)/z. This is sinc(k*dx/2) * sin(k*x_i)\n        sinc_factor = (2.0 * np.sin(k * dx / 2.0)) / (k * dx)\n        c0 = np.sin(k * x) * sinc_factor\n        \n        # Step 3: Set the time step\n        ca = 0.5\n        cd = 0.25\n        # The problem guarantees u != 0 and kappa != 0 for the given cases.\n        dt_ideal = min(ca * dx / abs(u), cd * dx**2 / kappa)\n        n_steps = math.ceil(T / dt_ideal)\n        dt = T / n_steps\n\n        # Step 4: Time integration using Forward Euler\n        c = c0.copy()\n        \n        for _ in range(n_steps):\n            # Handle periodic boundaries using np.roll\n            c_im1 = np.roll(c, 1) # c_{i-1}\n            c_ip1 = np.roll(c, -1) # c_{i+1}\n            \n            # Since u  0 for all cases, advection is a backward difference\n            # d(c_i)/dt = -u * (c_i - c_{i-1}) / dx\n            advection_rhs = -u * (c - c_im1) / dx\n            \n            # Diffusion is a central difference\n            # d(c_i)/dt = kappa * (c_{i+1} - 2c_i + c_{i-1}) / dx^2\n            diffusion_rhs = kappa * (c_ip1 - 2.0 * c + c_im1) / (dx**2)\n            \n            # Update solution\n            c += dt * (advection_rhs + diffusion_rhs)\n            \n        # Step 5: Calculate the error\n        # Exact cell-averaged solution at time T\n        c_exact = np.exp(-kappa * k**2 * T) * np.sin(k * (x - u * T)) * sinc_factor\n        \n        # RMS error\n        error = np.sqrt(np.mean((c - c_exact)**2))\n        errors.append(error)\n        \n    # Step 6: Compute the observed order of accuracy\n    orders = []\n    for i in range(len(N_list) - 1):\n        # p = log(E_coarse / E_fine) / log(dx_coarse / dx_fine)\n        # Since dx_coarse / dx_fine = 2, this simplifies to log2(...)\n        order = np.log2(errors[i] / errors[i+1])\n        orders.append(order)\n        \n    return orders\n\ndef solve():\n    \"\"\"\n    Main solver function that runs all test cases and prints the final result.\n    \"\"\"\n    test_cases = [\n        # Case #1 (advection-dominated)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.01, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #2 (diffusion-dominated)\n        {'L': 1000.0, 'u': 0.05, 'kappa': 5.0, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #3 (mixed with coarse meshes)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.5, 'm': 4, 'T': 1000.0, 'N_list': [10, 20, 40, 80, 160]},\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        orders = run_refinement_study(\n            case['L'],\n            case['u'],\n            case['kappa'],\n            case['m'],\n            case['T'],\n            case['N_list']\n        )\n        all_results.append(orders)\n\n    # Format the final output string as specified\n    # e.g., [[p1,p2,p3],[q1,q2,q3],...]\n    output_str = '[' + ','.join([str(res) for res in all_results]) + ']'\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from idealized equations to real-world geophysical flows introduces new challenges, such as the influence of bathymetry. A naive finite volume scheme can generate spurious currents even in a perfectly still body of water, a failure to balance the hydrostatic pressure gradient and the bathymetric source term. This exercise tasks you with designing and implementing a \"well-balanced\" scheme for the shallow water equations, which is specifically constructed to maintain this delicate equilibrium to machine precision, a critical property for any reliable ocean or atmospheric model .",
            "id": "3795847",
            "problem": "Consider the one-dimensional shallow water equations with stationary bathymetry for a single-layer ocean model. Let $x \\in [0,L]$ denote the horizontal coordinate, $t$ denote time, $h(x,t)$ denote the water depth, $u(x,t)$ denote the depth-averaged horizontal velocity, $q(x,t) = h(x,t)\\,u(x,t)$ denote the discharge, $B(x)$ denote the bathymetry (bed elevation), and $\\eta(x,t) = h(x,t) + B(x)$ denote the free-surface elevation. The governing equations read\n$$\n\\frac{\\partial h}{\\partial t} + \\frac{\\partial (h u)}{\\partial x} = 0,\n\\qquad\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial \\left(h u^2 + \\frac{1}{2} g h^2\\right)}{\\partial x} = - g h \\frac{\\partial B}{\\partial x},\n$$\nwith gravitational acceleration $g = 9.81$ in $\\mathrm{m/s^2}$. A lake-at-rest equilibrium (also called a quiescent steady state) is defined by $u(x,t) = 0$ and constant free surface $\\eta(x,t) \\equiv \\eta_0$ for some constant $\\eta_0$, such that $h(x,t) = \\eta_0 - B(x)$ and $h(x,t) \\ge 0$.\n\nYour task is to derive from first principles and implement a well-balanced finite volume method that exactly preserves the lake-at-rest state to machine precision for complex bathymetry over long integrations. The derivation and algorithm must start from the finite volume formulation of the above conservation laws and construct a discrete flux and source term that cancel exactly under lake-at-rest conditions. You must not assume any pre-derived lake-at-rest preserving formulas; instead, begin from the continuous equations and build the discrete method step by step.\n\nYou must design the method using:\n- A uniform grid of $N$ cells covering $[0,L]$ with periodic boundary conditions.\n- A first-order explicit time-stepping scheme satisfying the Courant-Friedrichs-Lewy (CFL) condition.\n- A consistent, positivity-preserving hydrostatic reconstruction at cell interfaces.\n- A local Lax-Friedrichs (Rusanov) numerical flux.\n- A discrete source term that ensures exact flux-source balance for the hydrostatic pressure under lake-at-rest conditions.\n\nExplicitly derive the interface reconstruction, fluxes, and source term so that the discrete update of $h$ and $q$ preserves $u=0$ and $\\eta=\\eta_0$ to within machine precision for arbitrary smooth or discontinuous bathymetry $B(x)$, provided the water depth remains nonnegative.\n\nAfter implementing the method, verify its equilibrium-preserving property using the following test suite. For each test case, the initial condition is lake at rest: $u(x,0) = 0$ and $\\eta(x,0) = \\eta_0$ constant. The bathymetry functions and parameters are:\n\n- Case A (smooth multi-scale bathymetry):\n  - Domain length $L = 1000$ in $\\mathrm{m}$, number of cells $N = 100$, final time $T_{\\mathrm{end}} = 5000$ in $\\mathrm{s}$, CFL number $\\mathrm{CFL} = 0.9$, free-surface level $\\eta_0 = 1.5$ in $\\mathrm{m}$.\n  - Bathymetry\n    $$\n    B(x) = 0.3 \\sin\\!\\left(\\frac{2\\pi x}{L}\\right) + 0.15 \\sin\\!\\left(\\frac{4\\pi x}{L}\\right) + 0.1 \\exp\\!\\left(-\\frac{(x - 0.3 L)^2}{(0.06 L)^2}\\right) - 0.08 \\exp\\!\\left(-\\frac{(x - 0.7 L)^2}{(0.08 L)^2}\\right).\n    $$\n\n- Case B (discontinuous step bathymetry):\n  - Domain length $L = 1000$ in $\\mathrm{m}$, number of cells $N = 100$, final time $T_{\\mathrm{end}} = 5000$ in $\\mathrm{s}$, CFL number $\\mathrm{CFL} = 0.9$, free-surface level $\\eta_0 = 1.0$ in $\\mathrm{m}$.\n  - Bathymetry\n    $$\n    B(x) = \\begin{cases}\n    0,  0 \\le x  0.5L, \\\\\n    0.4,  0.5L \\le x \\le L.\n    \\end{cases}\n    $$\n\n- Case C (high-frequency rough bathymetry):\n  - Domain length $L = 1000$ in $\\mathrm{m}$, number of cells $N = 200$, final time $T_{\\mathrm{end}} = 3000$ in $\\mathrm{s}$, CFL number $\\mathrm{CFL} = 0.9$, free-surface level $\\eta_0 = 1.2$ in $\\mathrm{m}$.\n  - Bathymetry\n    $$\n    B(x) = 0.2 \\sin\\!\\left(\\frac{16\\pi x}{L}\\right) + 0.1 \\sin\\!\\left(\\frac{32\\pi x}{L}\\right) + 0.05 \\sin\\!\\left(\\frac{64\\pi x}{L}\\right).\n    $$\n\n- Case D (near-dry Gaussian bump):\n  - Domain length $L = 1000$ in $\\mathrm{m}$, number of cells $N = 100$, final time $T_{\\mathrm{end}} = 1000$ in $\\mathrm{s}$, CFL number $\\mathrm{CFL} = 0.9$, free-surface level $\\eta_0 = 1.2 + 10^{-12}$ in $\\mathrm{m}$.\n  - Bathymetry\n    $$\n    B(x) = 1.2 \\exp\\!\\left(-\\frac{(x - 0.5 L)^2}{(0.04 L)^2}\\right).\n    $$\n\nFor each case, run the simulation from $t=0$ to $t=T_{\\mathrm{end}}$, and report, for that case, the maximum absolute change in free-surface elevation measured in meters:\n$$\nE = \\max_{x \\in [0,L]} \\left| \\eta(x,T_{\\mathrm{end}}) - \\eta_0 \\right|.\n$$\nExpress $E$ in $\\mathrm{m}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[E_{\\mathrm{A}},E_{\\mathrm{B}},E_{\\mathrm{C}},E_{\\mathrm{D}}]$ with each entry a floating-point number in $\\mathrm{m}$.",
            "solution": "The problem requires the derivation and implementation of a well-balanced finite volume scheme for the one-dimensional shallow water equations with bathymetry. The scheme must exactly preserve the lake-at-rest steady state to machine precision.\n\n### 1. Governing Equations and Finite Volume Formulation\n\nThe shallow water equations are given in conservation form as:\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = \\mathbf{S}(h, B)\n$$\nwhere $\\mathbf{U}$, $\\mathbf{F}(\\mathbf{U})$, and $\\mathbf{S}(h, B)$ are the vector of conserved variables, the flux vector, and the source term vector, respectively:\n$$\n\\mathbf{U} = \\begin{pmatrix} h \\\\ q \\end{pmatrix}, \\quad\n\\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} q \\\\ \\frac{q^2}{h} + \\frac{1}{2}gh^2 \\end{pmatrix}, \\quad\n\\mathbf{S}(h, B) = \\begin{pmatrix} 0 \\\\ -gh \\frac{\\partial B}{\\partial x} \\end{pmatrix}\n$$\nHere, $h$ is the water depth, $q=hu$ is the discharge, $g$ is the gravitational acceleration, and $B(x)$ is the bed elevation. The free-surface elevation is $\\eta = h + B$.\n\nWe discretize the spatial domain $[0, L]$ into $N$ uniform cells $C_i = [x_{i-1/2}, x_{i+1/2}]$ of width $\\Delta x = L/N$. The cell centers are $x_i = (i+0.5)\\Delta x$ for $i=0, \\dots, N-1$. Integrating the governing equation over cell $C_i$ yields the semi-discrete finite volume formulation:\n$$\n\\frac{d\\mathbf{U}_i}{dt} + \\frac{1}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) = \\mathbf{S}_i\n$$\nwhere $\\mathbf{U}_i(t)$ is the cell-average of $\\mathbf{U}$ over $C_i$, $\\mathbf{F}^*_{i \\pm 1/2}$ is the numerical flux at the cell interfaces, and $\\mathbf{S}_i$ is the discretized source term. For time integration, a first-order explicit Euler method is used:\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\Delta t \\mathbf{S}_i\n$$\n\n### 2. The Well-Balancing Principle\n\nA scheme is \"well-balanced\" if it can exactly preserve a steady state solution. For the shallow water equations, the lake-at-rest state is a key equilibrium, defined by:\n$$\nu(x,t) = 0 \\quad \\text{and} \\quad \\eta(x,t) = h(x,t) + B(x) = \\eta_0 \\quad (\\text{constant})\n$$\nThis implies $q=hu=0$ and $h(x) = \\eta_0 - B(x)$. For this state to be a numerical steady state, the right-hand side of the semi-discrete update equation must be zero to machine precision. Specifically, for each cell $i$:\n$$\n-\\frac{1}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\mathbf{S}_i = \\mathbf{0}\n$$\nwhen evaluated for the discrete lake-at-rest condition: $u_i=0$ and $h_i+B_i=\\eta_0$ for all $i$.\n\nThe challenge is to discretize the flux $\\mathbf{F}^*$ and the source term $\\mathbf{S}_i$ in a compatible way.\n\n### 3. Derivation of the Well-Balanced Scheme\n\nThe derivation proceeds by designing the numerical building blocks—reconstruction, flux, and source term—to satisfy the well-balancing condition.\n\n#### 3.1. Hydrostatic Reconstruction\n\nA standard first-order scheme uses piecewise-constant data $\\mathbf{U}_i$ in each cell. At an interface $x_{i+1/2}$, this creates a jump from $\\mathbf{U}_i$ to $\\mathbf{U}_{i+1}$. This naive approach is not well-balanced. We must use a hydrostatic reconstruction that accounts for the bathymetry.\n\n1.  **Interface Bathymetry**: To a create a robust method, especially for discontinuous bathymetry, we define the bed elevation at the interface $x_{i+1/2}$ as $B_{i+1/2} = \\max(B_i, B_{i+1})$. This choice is crucial for ensuring the positivity of the reconstructed water depths.\n2.  **Reconstructed Depths**: The free surface from the left cell is $\\eta_i = h_i + B_i$ and from the right cell is $\\eta_{i+1} = h_{i+1} + B_{i+1}$. The reconstructed water depths at the interface are found by subtracting the interface bed elevation from the cell's free surface elevation:\n    $$\n    h_L = \\eta_i - B_{i+1/2} = h_i + B_i - \\max(B_i, B_{i+1}) \\\\\n    h_R = \\eta_{i+1} - B_{i+1/2} = h_{i+1} + B_{i+1} - \\max(B_i, B_{i+1})\n    $$\n    To guarantee positivity, as required, we take the maximum with zero:\n    $$\n    h_{L, i+1/2} = \\max(0, h_i + B_i - \\max(B_i, B_{i+1})) \\\\\n    h_{R, i+1/2} = \\max(0, h_{i+1} + B_{i+1} - \\max(B_i, B_{i+1}))\n    $$\n3.  **Reconstructed States**: The velocities are simply taken from the cells: $u_L = u_i$ and $u_R = u_{i+1}$. The reconstructed state vectors are:\n    $$\n    \\mathbf{U}_{L, i+1/2} = \\begin{pmatrix} h_L \\\\ h_L u_i \\end{pmatrix}, \\quad \\mathbf{U}_{R, i+1/2} = \\begin{pmatrix} h_R \\\\ h_R u_{i+1} \\end{pmatrix}\n    $$\n\nAt lake-at-rest, where $u_i=0$ and $\\eta_i = \\eta_0$ for all $i$, this reconstruction gives:\n$h_{L, i+1/2} = \\max(0, \\eta_0 - \\max(B_i, B_{i+1}))$\n$h_{R, i+1/2} = \\max(0, \\eta_0 - \\max(B_i, B_{i+1}))$\nCrucially, $h_L = h_R$ at the interface. Since $u_L=u_R=0$, the left and right reconstructed states are identical: $\\mathbf{U}_L = \\mathbf{U}_R$.\n\n#### 3.2. Rusanov (Local Lax-Friedrichs) Flux\n\nThe Rusanov numerical flux for the reconstructed states $\\mathbf{U}_L$ and $\\mathbf{U}_R$ at an interface is:\n$$\n\\mathbf{F}^*(\\mathbf{U}_L, \\mathbf{U}_R) = \\frac{1}{2} \\left( \\mathbf{F}(\\mathbf{U}_L) + \\mathbf{F}(\\mathbf{U}_R) \\right) - \\frac{s_{\\max}}{2} \\left( \\mathbf{U}_R - \\mathbf{U}_L \\right)\n$$\nwhere $s_{\\max}$ is the maximum local wave speed, estimated using the original cell-averaged states:\n$$\ns_{\\max, i+1/2} = \\max(|u_i| + \\sqrt{gh_i}, |u_{i+1}| + \\sqrt{gh_{i+1}})\n$$\nAt lake-at-rest, since $\\mathbf{U}_L = \\mathbf{U}_R$, the diffusive term vanishes. The flux simplifies to $\\mathbf{F}^*_{i+1/2} = \\mathbf{F}(\\mathbf{U}_L)$.\n-   For the mass equation (first component): $F_h^* = q_L = h_L u_L = 0$. The net flux for the mass equation is zero, so the mass conservation is balanced.\n-   For the momentum equation (second component): $F_q^* = \\frac{q_L^2}{h_L} + \\frac{1}{2}gh_L^2 = \\frac{1}{2}gh_L^2$.\n\n#### 3.3. Discrete Source Term\n\nThe remaining task is to define a discrete source term $\\mathbf{S}_i$ that exactly cancels the net momentum flux at rest. The net flux into cell $i$ from the pressure terms is:\n$$\n-\\frac{1}{\\Delta x} \\left( F^*_{q, i+1/2} - F^*_{q, i-1/2} \\right) \\xrightarrow{\\text{at rest}} -\\frac{1}{\\Delta x} \\left( \\frac{1}{2}g h_{L,i+1/2}^2 - \\frac{1}{2}g h_{L,i-1/2}^2 \\right)\n$$\nNotice that the value from cell $i$ contributing to the left state at $x_{i+1/2}$ is $h_{L,i+1/2}$, while the value from cell $i$ contributing to the right state at $x_{i-1/2}$ is $h_{R,i-1/2}$. At rest, these are equal, so we can write the net flux using only $h_L$.\n\nFor the well-balancing property to hold, we must define the discrete source term $S_{q,i}$ such that it cancels this net flux:\n$$\nS_{q,i} = \\frac{g}{2\\Delta x} \\left( h_{L,i+1/2}^2 - h_{R,i-1/2}^2 \\right)\n$$\nThis definition is only valid at rest. To obtain a general definition, we replace the rest-state free surface $\\eta_0$ with the local free surface $\\eta_i = h_i + B_i$. The quantities $h_{L,i+1/2}$ and $h_{R,i-1/2}$ are computed based on the state in cell $i$ projected to its interfaces:\n$$\nh \\text{ projected to } x_{i+1/2} \\text{ from cell } i: \\quad h_i + B_i - \\max(B_i,B_{i+1}) \\\\\nh \\text{ projected to } x_{i-1/2} \\text{ from cell } i: \\quad h_i + B_i - \\max(B_{i-1},B_i)\n$$\nThus, we define the momentum source term for cell $i$ as:\n$$\nS_{q,i} = \\frac{g}{2\\Delta x} \\left[ \\left(\\max(0, h_i + B_i - \\max(B_i,B_{i+1}))\\right)^2 - \\left(\\max(0, h_i + B_i - \\max(B_{i-1},B_i))\\right)^2 \\right]\n$$\nThis source term is consistent with $-ghB_x$ and, by construction, exactly balances the hydrostatic pressure gradient part of the numerical flux when the flow is at rest.\n\n### 4. Summary of the Numerical Algorithm\n\n1.  **Initialization**: Given $N, L, \\eta_0$, define the grid $x_i$ and $\\Delta x$. Set initial conditions $\\mathbf{U}_i^0$ and $B_i$ for $i=0, \\dots, N-1$:\n    $h_i^0 = \\eta_0 - B(x_i)$, $u_i^0 = 0$, $q_i^0 = 0$.\n2.  **Time Marching**: For $n=0, 1, 2, \\dots$ until $t \\ge T_{\\mathrm{end}}$:\n    a.  **CFL Condition**: Compute time step $\\Delta t = \\text{CFL} \\cdot \\Delta x / \\max_i(|u_i^n| + \\sqrt{gh_i^n})$.\n    b.  **Apply Periodic BCs**: Create ghost cells: $\\mathbf{U}_{-1}^n=\\mathbf{U}_{N-1}^n$, $B_{-1}=B_{N-1}$, $\\mathbf{U}_{N}^n=\\mathbf{U}_0^n$, $B_{N}=B_0$.\n    c.  **Flux Calculation**: For each interface $i+1/2$ (from $i=-1$ to $N-1$):\n        i.  Perform hydrostatic reconstruction to find $\\mathbf{U}_{L, i+1/2}$ and $\\mathbf{U}_{R, i+1/2}$.\n        ii. Compute the Rusanov flux $\\mathbf{F}^*_{i+1/2}$.\n    d.  **Source Term Calculation**: For each cell $i=0, \\dots, N-1$:\n        i.  Compute the well-balanced source term $S_{q,i}$ using the formula derived in Section 3.3.\n    e.  **Update**: For each cell $i=0, \\dots, N-1$:\n        $$\n        \\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\Delta t \\begin{pmatrix} 0 \\\\ S_{q,i} \\end{pmatrix}\n        $$\n3.  **Final Error**: After the final time step, compute the error $E = \\max_{i} |(h_i^{final} + B_i) - \\eta_0|$.\n\nThis completes the derivation from first principles, yielding a consistent, positivity-preserving, and well-balanced scheme as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a well-balanced finite volume method for the 1D shallow water equations.\n    \"\"\"\n    g = 9.81  # Gravitational acceleration in m/s^2\n\n    def get_bathymetry(case_params, x):\n        \"\"\"Returns the bathymetry B(x) for a given case.\"\"\"\n        L = case_params['L']\n        if case_params['name'] == 'A':\n            term1 = 0.3 * np.sin(2 * np.pi * x / L)\n            term2 = 0.15 * np.sin(4 * np.pi * x / L)\n            term3 = 0.1 * np.exp(-((x - 0.3 * L)**2) / ((0.06 * L)**2))\n            term4 = -0.08 * np.exp(-((x - 0.7 * L)**2) / ((0.08 * L)**2))\n            return term1 + term2 + term3 + term4\n        elif case_params['name'] == 'B':\n            return np.where(x  0.5 * L, 0.0, 0.4)\n        elif case_params['name'] == 'C':\n            term1 = 0.2 * np.sin(16 * np.pi * x / L)\n            term2 = 0.1 * np.sin(32 * np.pi * x / L)\n            term3 = 0.05 * np.sin(64 * np.pi * x / L)\n            return term1 + term2 + term3\n        elif case_params['name'] == 'D':\n            return 1.2 * np.exp(-((x - 0.5 * L)**2) / ((0.04 * L)**2))\n        return np.zeros_like(x)\n\n    def flux(U, g):\n        \"\"\"Computes the physical flux F(U).\"\"\"\n        h, q = U[0, :], U[1, :]\n        \n        # Handle dry cells to avoid division by zero\n        # u = q/h = 0 if h is close to zero\n        u = np.divide(q, h, out=np.zeros_like(q), where=h  1e-9)\n        \n        F = np.zeros_like(U)\n        F[0, :] = q\n        F[1, :] = h * u**2 + 0.5 * g * h**2\n        return F\n\n    def run_simulation(params):\n        \"\"\"Runs the shallow water simulation for a given set of parameters.\"\"\"\n        N = params['N']\n        L = params['L']\n        T_end = params['T_end']\n        CFL = params['CFL']\n        eta0 = params['eta0']\n\n        # Grid setup\n        dx = L / N\n        x = np.linspace(dx / 2, L - dx / 2, N)\n\n        # Initial conditions: lake at rest\n        B = get_bathymetry(params, x)\n        h = np.full_like(x, eta0) - B\n        q = np.zeros_like(x)\n        \n        if np.any(h  0):\n             # This check is important for problem validity, but a robust solver should handle it.\n             # In this problem setup, all cases start with h = 0.\n             raise ValueError(\"Initial condition has negative water depth (dry land).\")\n\n        # Conserved variables vector U = [h, q]\n        U = np.vstack((h, q))\n        t = 0.0\n\n        while t  T_end:\n            # Apply periodic boundary conditions using ghost cells\n            U_ext = np.zeros((2, N + 2))\n            U_ext[:, 1:-1] = U\n            U_ext[:, 0] = U[:, -1]\n            U_ext[:, -1] = U[:, 0]\n\n            B_ext = np.zeros(N + 2)\n            B_ext[1:-1] = B\n            B_ext[0] = B[-1]\n            B_ext[-1] = B[0]\n\n            # Time step calculation from CFL condition\n            h_vals = U_ext[0, :]\n            q_vals = U_ext[1, :]\n            u_vals = np.divide(q_vals, h_vals, out=np.zeros_like(q_vals), where=h_vals  1e-9)\n            \n            wave_speeds = np.abs(u_vals) + np.sqrt(g * np.maximum(h_vals, 0))\n            s_max_global = np.max(wave_speeds)\n            if s_max_global  1e-9: # Still water\n                dt = CFL * dx / 1e-9\n            else:\n                dt = CFL * dx / s_max_global\n\n            if t + dt  T_end:\n                dt = T_end - t\n            \n            # --- Well-balanced scheme ---\n            \n            # Left and right states for each interface (vectorized)\n            UL = U_ext[:, :-1]\n            UR = U_ext[:, 1:]\n            BL = B_ext[:-1]\n            BR = B_ext[1:]\n\n            hL_cell, qL_cell = UL[0, :], UL[1, :]\n            hR_cell, qR_cell = UR[0, :], UR[1, :]\n\n            # Hydrostatic Reconstruction at interfaces\n            B_int = np.maximum(BL, BR)\n            etaL = hL_cell + BL\n            etaR = hR_cell + BR\n            \n            h_L_recon = np.maximum(0, etaL - B_int)\n            h_R_recon = np.maximum(0, etaR - B_int)\n\n            u_L = np.divide(qL_cell, hL_cell, out=np.zeros_like(qL_cell), where=hL_cell  1e-9)\n            u_R = np.divide(qR_cell, hR_cell, out=np.zeros_like(qR_cell), wherehR_cell  1e-9)\n\n            UL_recon = np.vstack((h_L_recon, h_L_recon * u_L))\n            UR_recon = np.vstack((h_R_recon, h_R_recon * u_R))\n\n            # Rusanov (Local Lax-Friedrichs) Flux\n            s_max_int = np.maximum(\n                np.abs(u_L) + np.sqrt(g * np.maximum(hL_cell, 0)),\n                np.abs(u_R) + np.sqrt(g * np.maximum(hR_cell, 0))\n            )\n            \n            F_L = flux(UL_recon, g)\n            F_R = flux(UR_recon, g)\n            \n            F_star = 0.5 * (F_L + F_R) - 0.5 * s_max_int * (UR_recon - UL_recon)\n\n            # Well-balanced Source Term for cells i=0..N-1\n            # These are the original cell-centered values from the main grid\n            h_center = U_ext[0, 1:-1]\n            B_center = B_ext[1:-1]\n            # These are the neighboring cell values\n            B_left   = B_ext[0:-2]\n            B_right  = B_ext[2:]\n\n            h_i = h_center\n            eta_i = h_i + B_center\n\n            B_int_right = np.maximum(B_center, B_right)\n            B_int_left  = np.maximum(B_left, B_center)\n\n            # This is (h_i + B_i - max(B_i, B_i+1))^2\n            h_proj_right_sq = np.maximum(0, eta_i - B_int_right)**2\n            # This is (h_i + B_i - max(B_i-1, B_i))^2\n            h_proj_left_sq  = np.maximum(0, eta_i - B_int_left)**2\n\n            # This is the discrete source term S_i from the derivation\n            S_q = (0.5 * g / dx) * (h_proj_right_sq - h_proj_left_sq)\n\n            # Update step (first-order explicit Euler)\n            # F_star is defined over N+1 interfaces, indices 0 to N\n            # RHS for cell i needs flux at i+1/2 and i-1/2.\n            # In 0-based index, this is F_star[:,i+1] and F_star[:,i]\n            RHS_h = -(F_star[0, 1:] - F_star[0, :-1]) / dx\n            RHS_q = -(F_star[1, 1:] - F_star[1, :-1]) / dx + S_q\n            \n            U[0, :] += dt * RHS_h\n            U[1, :] += dt * RHS_q\n\n            t += dt\n\n        # Calculate final error\n        h_final = U[0, :]\n        eta_final = h_final + B\n        error = np.max(np.abs(eta_final - eta0))\n        return error\n\n    test_cases = [\n        {'name': 'A', 'L': 1000, 'N': 100, 'T_end': 5000, 'CFL': 0.9, 'eta0': 1.5},\n        {'name': 'B', 'L': 1000, 'N': 100, 'T_end': 5000, 'CFL': 0.9, 'eta0': 1.0},\n        {'name': 'C', 'L': 1000, 'N': 200, 'T_end': 3000, 'CFL': 0.9, 'eta0': 1.2},\n        {'name': 'D', 'L': 1000, 'N': 100, 'T_end': 1000, 'CFL': 0.9, 'eta0': 1.2 + 1e-12},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The design of a numerical flux in a finite volume method is not arbitrary; it is deeply rooted in the physics of the underlying equations. For hyperbolic systems like the shallow water equations, information propagates via waves. In this practice, you will derive the characteristic wave speeds that govern this information flow and explain how their properties—speed and direction—dictate the \"upwinding\" strategy in Godunov-type schemes, providing the physical justification for how these methods achieve stability and accuracy .",
            "id": "3795849",
            "problem": "You are modeling depth-averaged flow with the two-dimensional shallow water equations in a coastal shelf model using a finite volume method (FVM). Consider a single planar cell face with unit normal $\\hat{\\boldsymbol{n}} = (n_x, n_y)$ pointing from a left cell to a right cell. Let the conserved state be $\\boldsymbol{U} = [H, \\; H u, \\; H v]^{\\mathsf{T}}$, where $H$ is the total water depth and $(u, v)$ are the depth-averaged velocity components. The gravitational acceleration is $g$, assumed constant. Ignore source terms associated with bathymetry variations, Coriolis force, and friction when computing the numerical flux across this face.\n\nStarting from the integral conservation laws and the hydrostatic pressure closure for the shallow water equations, derive the characteristic wave speeds associated with the face-normal Riemann problem by:\n- expressing the face-normal flux $\\boldsymbol{F}_n(\\boldsymbol{U})$ in a rotated basis aligned with the face normal, with variables $H$, the face-normal velocity $u_n = u n_x + v n_y$, and the face-tangential velocity $u_t = -u n_y + v n_x$,\n- writing the flux components in terms of the conserved variables $H$, $m_n = H u_n$, and $m_t = H u_t$,\n- linearizing the face-normal flux about a state with $H  0$ and finite $u_n$, and\n- computing the eigenvalues of the resulting Jacobian restricted to the $\\{H, m_n\\}$ subsystem.\n\nExplain how the signs and magnitudes of these characteristic speeds inform upwinding decisions for a Godunov-type numerical flux in a finite volume method, including the cases where all waves move from left to right, all waves move from right to left, or waves straddle zero speed across the face.\n\nAnswer specification:\n- Provide the two face-normal characteristic speeds as a single closed-form analytic expression depending only on $g$, $H$, and $u_n$.\n- Write your final answer as a two-entry row vector $\\bigl[s_{-} \\; s_{+}\\bigr]$ using the LaTeX $\\texttt{pmatrix}$ environment.\n- Express the speeds in meters per second, but do not include units in your final boxed expression.\n- No numerical rounding is required.",
            "solution": "The problem requires the derivation of the characteristic wave speeds for the face-normal Riemann problem of the two-dimensional shallow water equations and an explanation of their role in constructing numerical fluxes for a finite volume method.\n\nThe two-dimensional shallow water equations in conservative form are given by:\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}_x}{\\partial x} + \\frac{\\partial \\boldsymbol{F}_y}{\\partial y} = \\boldsymbol{S}\n$$\nwhere $\\boldsymbol{U}$ is the vector of conserved variables, $\\boldsymbol{F}_x$ and $\\boldsymbol{F}_y$ are the flux vectors in the $x$ and $y$ directions respectively, and $\\boldsymbol{S}$ is a source term vector. The state and flux vectors are:\n$$\n\\boldsymbol{U} = \\begin{pmatrix} H \\\\ Hu \\\\ Hv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_x = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_y = \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix}\n$$\nHere, $H$ is the total water depth, $(u, v)$ are the depth-averaged velocity components, and $g$ is the gravitational acceleration.\n\nFor a finite volume method, we consider the flux across a cell face with unit normal vector $\\hat{\\boldsymbol{n}} = (n_x, n_y)$. The face-normal flux, $\\boldsymbol{F}_n$, is the projection of the flux tensor onto this normal:\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\boldsymbol{F}_x n_x + \\boldsymbol{F}_y n_y = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix} n_x + \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix} n_y\n$$\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\begin{pmatrix}\nH(u n_x + v n_y) \\\\\nHu(u n_x + v n_y) + \\frac{1}{2}gH^2 n_x \\\\\nHv(u n_x + v n_y) + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\nWe define the face-normal velocity $u_n = u n_x + v n_y$ and the face-tangential velocity $u_t = -u n_y + v n_x$. Inverting this rotation gives $u = u_n n_x - u_t n_y$ and $v = u_n n_y + u_t n_x$.\n\nThe analysis is simplified by rotating the momentum equations into a basis aligned with the face. We define a rotated state vector $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$, where $m_n = H u_n$ is the face-normal momentum and $m_t = H u_t$ is the face-tangential momentum. The flux vector corresponding to this rotated state vector is $\\boldsymbol{F}_{n, rot} = R \\boldsymbol{F}_n(\\boldsymbol{U})$, where $R$ is the rotation matrix for the state vector:\n$$\nR = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix}\n$$\nApplying this rotation to the flux vector $\\boldsymbol{F}_n$ expressed in terms of $u, v, H$:\n$$\n\\boldsymbol{F}_{n, rot} = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix} \\begin{pmatrix}\nH u_n \\\\\nH u u_n + \\frac{1}{2}gH^2 n_x \\\\\nH v u_n + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\nThe components of the rotated flux vector are:\n1.  Mass flux: $H u_n = m_n$.\n2.  Normal momentum flux: $n_x(H u u_n + \\frac{1}{2}gH^2 n_x) + n_y(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (u n_x + v n_y) + \\frac{1}{2}gH^2(n_x^2 + n_y^2) = H u_n^2 + \\frac{1}{2}gH^2$.\n3.  Tangential momentum flux: $-n_y(H u u_n + \\frac{1}{2}gH^2 n_x) + n_x(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (-u n_y + v n_x) + \\frac{1}{2}gH^2(-n_y n_x + n_x n_y) = H u_n u_t$.\n\nWriting these flux components in terms of the conserved variables $H$, $m_n=Hu_n$, and $m_t=Hu_t$:\n$$\n\\boldsymbol{F}_{n, rot}(\\boldsymbol{U}_{rot}) = \\begin{pmatrix} m_n \\\\ \\frac{m_n^2}{H} + \\frac{1}{2}gH^2 \\\\ \\frac{m_n m_t}{H} \\end{pmatrix}\n$$\nThe characteristic wave speeds are the eigenvalues of the flux Jacobian matrix $A_{rot} = \\frac{\\partial \\boldsymbol{F}_{n, rot}}{\\partial \\boldsymbol{U}_{rot}}$. We compute the partial derivatives with respect to $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$:\n$$\nA_{rot} = \\begin{pmatrix}\n\\frac{\\partial (m_n)}{\\partial H}  \\frac{\\partial (m_n)}{\\partial m_n}  \\frac{\\partial (m_n)}{\\partial m_t} \\\\ [1em]\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right) \\\\ [1em]\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n m_t}{H}\\right)\n\\end{pmatrix}\n$$\nEvaluating the derivatives and expressing them in terms of primitive variables $H$, $u_n$, and $u_t$ for clarity:\n$$\nA_{rot} = \\begin{pmatrix}\n0  1  0 \\\\\ngH - u_n^2  2u_n  0 \\\\\n-u_n u_t  u_t  u_n\n\\end{pmatrix}\n$$\nThe problem asks for the eigenvalues of the Jacobian restricted to the $\\{H, m_n\\}$ subsystem. This corresponds to the $2 \\times 2$ upper-left block of the full Jacobian, as the equations for $H$ and $m_n$ are independent of $m_t$. Let this sub-matrix be $A_{sub}$:\n$$\nA_{sub} = \\begin{pmatrix}\n0  1 \\\\\ngH - u_n^2  2u_n\n\\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are found by solving the characteristic equation $\\det(A_{sub} - \\lambda I) = 0$:\n$$\n\\det \\begin{pmatrix}\n-\\lambda  1 \\\\\ngH - u_n^2  2u_n - \\lambda\n\\end{pmatrix} = (-\\lambda)(2u_n - \\lambda) - (1)(gH - u_n^2) = 0\n$$\n$$\n-2u_n\\lambda + \\lambda^2 - gH + u_n^2 = 0\n$$\n$$\n\\lambda^2 - 2u_n\\lambda + (u_n^2 - gH) = 0\n$$\nUsing the quadratic formula to solve for $\\lambda$:\n$$\n\\lambda = \\frac{-(-2u_n) \\pm \\sqrt{(-2u_n)^2 - 4(1)(u_n^2 - gH)}}{2(1)} = \\frac{2u_n \\pm \\sqrt{4u_n^2 - 4u_n^2 + 4gH}}{2}\n$$\n$$\n\\lambda = \\frac{2u_n \\pm \\sqrt{4gH}}{2} = \\frac{2u_n \\pm 2\\sqrt{gH}}{2} = u_n \\pm \\sqrt{gH}\n$$\nThus, the two characteristic wave speeds associated with the $\\{H, m_n\\}$ subsystem are $s_{-} = u_n - \\sqrt{gH}$ and $s_{+} = u_n + \\sqrt{gH}$. These speeds represent the propagation of surface gravity waves, with speed $c = \\sqrt{gH}$, Doppler-shifted by the normal flow velocity $u_n$. The third eigenvalue of the full system is $\\lambda = u_n$, corresponding to the advection of tangential velocity.\n\nThese characteristic speeds are fundamental to Godunov-type finite volume methods. They determine the direction of information propagation in the solution to the local Riemann problem at a cell face, which dictates the upwinding strategy for the numerical flux $\\boldsymbol{F}^*$. Let's consider a face between a left cell (state $\\boldsymbol{U}_L$) and a right cell (state $\\boldsymbol{U}_R$), and evaluate the wave speeds at some relevant intermediate state (e.g., a Roe average).\n\n1.  **All waves move from left to right:** This occurs in right-moving supercritical flow, where $u_n  \\sqrt{gH}$. In this case, the slowest characteristic speed is positive: $s_{-} = u_n - \\sqrt{gH}  0$. All information propagates from left to right. The state at the interface is determined solely by the left state $\\boldsymbol{U}_L$. The numerical flux is purely upwinded from the left: $\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$.\n\n2.  **All waves move from right to left:** This occurs in left-moving supercritical flow, where $u_n  -\\sqrt{gH}$. The fastest characteristic speed is negative: $s_{+} = u_n + \\sqrt{gH}  0$. All information propagates from right to left. The state at the interface is determined solely by the right state $\\boldsymbol{U}_R$. The numerical flux is purely upwinded from the right: $\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$.\n\n3.  **Waves straddle zero speed:** This occurs in subcritical flow, where $|u_n|  \\sqrt{gH}$. In this regime, $s_{-}  0$ and $s_{+}  0$. Information propagates from both the left and right states towards the interface. The numerical flux must account for contributions from both $\\boldsymbol{U}_L$ and $\\boldsymbol{U}_R$. Schemes like Roe's or HLL/HLLC are designed for this case. For example, the diffusive term in a Roe solver, $\\frac{1}{2}\\sum_k |\\bar{\\lambda}_k| \\Delta W_k \\bar{\\boldsymbol{r}}_k$, uses the absolute values of the characteristic speeds $|\\lambda_k|$ to scale the dissipation applied to each wave family, ensuring stability by adding dissipation only where needed and in the correct upwind-biased manner. The signs of the eigenvalues determine how the jump in state variables across the interface is decomposed into different wave contributions.\n\nIn conclusion, the signs of the characteristic speeds determine the upwind direction(s), while their magnitudes influence the numerical dissipation required for a stable and accurate scheme.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} u_n - \\sqrt{gH}  u_n + \\sqrt{gH} \\end{pmatrix}}\n$$"
        }
    ]
}