{
    "hands_on_practices": [
        {
            "introduction": "验证是任何数值模型开发中的一个基石步骤。将数值解与已知解析解进行比较，是确认代码实现正确性并量化其精度的有力方法。本练习  将指导您如何为基本的平流-扩散方程执行网格加密研究，这是一个衡量数值方法收敛阶的基础实践。",
            "id": "3795833",
            "problem": "考虑在速度和扩散系数恒定的情况下，被动示踪剂的一维周期性平流-扩散问题，这是计算海洋学中使用的典型模型。设浓度场在区域 $x \\in [0,L]$ 上表示为 $c(x,t)$，其中 $L$ 为区域长度。控制方程为守恒律\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) \\;=\\; \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right),\n$$\n其中 $u$ 是恒定的平流速度，$\\kappa$ 是恒定的扩散系数。在 $x=0$ 和 $x=L$ 处施加周期性边界条件，初始条件为单一傅里叶模式，\n$$\nc(x,0) \\;=\\; \\sin\\!\\left(k\\,x\\right), \\quad k \\;=\\; \\frac{2\\pi m}{L},\n$$\n其中 $m$ 是确保周期性的正整数。\n\n此初值问题的解析解由下式给出\n$$\nc_{\\text{exact}}(x,t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x - u\\,t\\right)\\right).\n$$\n由于数值方法演化的是单元平均值，因此在以 $x_i$ 为中心、宽度为 $\\Delta x$ 的单元上的精确单元平均值为\n$$\n\\bar{c}_{\\text{exact},i}(t) \\;=\\; \\exp\\!\\left(-\\kappa\\,k^2\\,t\\right)\\,\\sin\\!\\left(k\\left(x_i - u\\,t\\right)\\right)\\,\\frac{2\\,\\sin\\!\\left(\\frac{k\\,\\Delta x}{2}\\right)}{k\\,\\Delta x}.\n$$\n\n您必须为此方程实现一个均匀网格的有限体积法 (FVM)，从控制体积上的积分守恒律和一致的面通量出发，并遵循以下规范：\n\n- 网格：将 $[0,L]$ 划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元，并具有周期性连接。存储并演化单元平均值 $\\bar{c}_i(t)$。\n- 面通量：将总通量写为 $F = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}$。在单元面 $x_{i+1/2}$ 处，根据 $u$ 的符号，使用一阶迎风格式为 $\\hat{c}_{i+1/2}$ 来近似平流通量为 $F^{\\text{adv}}_{i+1/2} = u\\,\\hat{c}_{i+1/2}$，并使用单元平均值的二阶中心差分来近似扩散通量为 $F^{\\text{diff}}_{i+1/2} = -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}$。总面通量为 $F_{i+1/2} = F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$。\n- 时间步进：对半离散 FVM 更新方程使用前向欧拉（一阶）方法，\n$$\n\\bar{c}_i^{n+1} \\;=\\; \\bar{c}_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right),\n$$\n并采用周期性索引。选择时间步长以满足稳定性，并通过以下方式最小化空间网格加密研究中的时间误差污染：\n$$\n\\Delta t \\;=\\; \\min\\!\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right),\n$$\n其中 $c_a = 0.5$，$c_d = 0.25$。为精确达到指定的最终时间 $T$，取 $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$ 并重置 $\\Delta t \\leftarrow T/n_{\\text{steps}}$。\n\n将时间 $T$ 的离散均方根 (RMS) 误差定义为\n$$\nE(\\Delta x) \\;=\\; \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\bar{c}_i(T) - \\bar{c}_{\\text{exact},i}(T)\\right)^2},\n$$\n并在 $\\Delta x$ 减半的加密序列中，计算连续网格尺寸之间的观测精度阶数为\n$$\np \\;=\\; \\frac{\\log\\!\\left(E(\\Delta x_{\\text{coarse}})/E(\\Delta x_{\\text{fine}})\\right)}{\\log\\!\\left(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}}\\right)}.\n$$\n\n对以下测试套件进行网格加密研究，该套件通过速度 $u$、扩散系数 $\\kappa$、波长指数 $m$ 和网格序列来探索不同区域。所有物理参数必须使用其给定单位。报告的观测阶数为无量纲。\n\n- 案例 #1 (平流主导): $L = 1000\\,\\mathrm{m}$，$u = 0.5\\,\\mathrm{m/s}$，$\\kappa = 0.01\\,\\mathrm{m^2/s}$，$m = 1$，$T = 1000\\,\\mathrm{s}$，$N$ 序列 $[20,40,80,160,320]$。\n- 案例 #2 (扩散主导): $L = 1000\\,\\mathrm{m}$，$u = 0.05\\,\\mathrm{m/s}$，$\\kappa = 5\\,\\mathrm{m^2/s}$，$m = 1$，$T = 1000\\,\\mathrm{s}$，$N$ 序列 $[20,40,80,160,320]$。\n- 案例 #3 (粗网格混合情况): $L = 1000\\,\\mathrm{m}$，$u = 0.5\\,\\mathrm{m/s}$，$\\kappa = 0.5\\,\\mathrm{m^2/s}$，$m = 4$，$T = 1000\\,\\mathrm{s}$，$N$ 序列 $[10,20,40,80,160]$。\n\n您的程序必须：\n- 将 $\\bar{c}_i(0)$ 初始化为给定初始条件的精确单元平均值。\n- 使用指定的 FVM 和时间步进方法将解推进到 $t=T$。\n- 对于每个案例，计算每个 $N$ 对应的误差 $E(\\Delta x)$ 以及连续网格尺寸之间的观测阶数 $p$。\n- 生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果。每个内部列表对应一个案例，并按连续加密的顺序包含该案例的观测阶数。例如，输出格式为\n$[[p_{1,1},p_{1,2},p_{1,3},p_{1,4}],[p_{2,1},p_{2,2},p_{2,3},p_{2,4}],[p_{3,1},p_{3,2},p_{3,3},p_{3,4}]]$,\n其中每个 $p_{i,j}$ 是一个浮点数。\n\n所有角度（例如，在三角函数中）均以弧度为单位。所有物理输入均采用国际单位制 (SI)：$L$ 的单位是 $\\mathrm{m}$，$u$ 的单位是 $\\mathrm{m/s}$，$\\kappa$ 的单位是 $\\mathrm{m^2/s}$，$T$ 的单位是 $\\mathrm{s}$。最终输出的观测阶数是无量纲浮点数。该研究的设计必须能够揭示和测量观测到的精度阶数，并为讨论粗网格上非渐近行为的潜在原因提供依据。",
            "solution": "该问题要求对一维平流-扩散方程实现并分析有限体积法 (FVM)。分析将通过网格加密研究进行，以确定数值格式的观测精度阶数。\n\n浓度 $c(x,t)$ 的控制偏微分方程 (PDE) 是：\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0, \\quad \\text{其中 } F(c) = u\\,c - \\kappa\\,\\frac{\\partial c}{\\partial x}\n$$\n此处，$u$ 是恒定的平流速度，$\\kappa$ 是恒定的扩散系数。项 $F(c)$ 代表总通量，由平流部分 $F^{\\text{adv}} = u\\,c$ 和扩散部分 $F^{\\text{diff}} = -\\kappa\\,\\frac{\\partial c}{\\partial x}$ 组成。\n\n我们将空间域 $[0, L]$ 离散为 $N$ 个均匀的控制体积（单元），每个单元的宽度为 $\\Delta x = L/N$。单元中心位于 $x_i = (i+0.5)\\Delta x$，其中 $i = 0, 1, \\dots, N-1$。FVM 演化的是单元平均浓度，定义为：\n$$\n\\bar{c}_i(t) = \\frac{1}{\\Delta x} \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} c(x,t)\\,dx\n$$\n对第 $i$ 个单元上的 PDE 进行积分，得到单元平均值的精确演化方程：\n$$\n\\frac{d\\bar{c}_i}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) = 0\n$$\n其中 $F_{i\\pm1/2}$ 是位于单元面 $x_{i\\pm1/2} = x_i \\pm \\Delta x/2$ 处的通量。我们必须使用已知的单元平均值 $\\bar{c}_j$ 来近似这些面通量。\n\n面 $x_{i+1/2}$ 处的总通量近似为 $F_{i+1/2} \\approx F^{\\text{adv}}_{i+1/2} + F^{\\text{diff}}_{i+1/2}$。\n1.  **平流通量 ($F^{\\text{adv}}$)**：问题指定了一阶迎风格式。对于速度 $u  0$（所有测试案例均如此），面上的示踪剂值由“上风向”单元决定，即单元 $i$。因此，面上的平流物理量由单元平均值 $\\bar{c}_i$ 近似。\n    $$\n    F^{\\text{adv}}_{i+1/2} = u\\,\\bar{c}_i\n    $$\n    此格式在空间上为一阶精度。\n\n2.  **扩散通量 ($F^{\\text{diff}}$)**：问题指定了使用相邻单元平均值对面上的梯度进行二阶中心差分近似：\n    $$\n    F^{\\text{diff}}_{i+1/2} = -\\kappa \\left( \\frac{\\partial c}{\\partial x} \\right)_{i+1/2} \\approx -\\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n    $$\n    此格式为二阶精度。\n\n将这些结合起来，得到面 $x_{i+1/2}$ 处的总数值通量：\n$$\nF_{i+1/2} = u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\n$$\n同理，对于面 $x_{i-1/2}$：\n$$\nF_{i-1/2} = u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\n$$\n将这些代入半离散 FVM 方程，得到：\n$$\n\\frac{d\\bar{c}_i}{dt} = -\\frac{1}{\\Delta x} \\left( \\left(u\\,\\bar{c}_i - \\kappa\\,\\frac{\\bar{c}_{i+1} - \\bar{c}_i}{\\Delta x}\\right) - \\left(u\\,\\bar{c}_{i-1} - \\kappa\\,\\frac{\\bar{c}_{i} - \\bar{c}_{i-1}}{\\Delta x}\\right) \\right)\n$$\n重新整理各项，得到 $\\bar{c}_i$ 的常微分方程组右侧 (RHS) 的空间离散化形式：\n$$\n\\frac{d\\bar{c}_i}{dt} = -u \\left(\\frac{\\bar{c}_i - \\bar{c}_{i-1}}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1} - 2\\bar{c}_i + \\bar{c}_{i-1}}{\\Delta x^2}\\right)\n$$\n此格式的整体空间精度由最低阶项决定，即一阶迎风平流。因此，该空间格式为一阶精度。\n\n对于时间积分，指定了前向欧拉法。将时间步 $n$ 的解记为 $\\bar{c}_i^n$，更新公式为：\n$$\n\\frac{\\bar{c}_i^{n+1} - \\bar{c}_i^n}{\\Delta t} = -u \\left(\\frac{\\bar{c}_i^n - \\bar{c}_{i-1}^n}{\\Delta x}\\right) + \\kappa \\left(\\frac{\\bar{c}_{i+1}^n - 2\\bar{c}_i^n + \\bar{c}_{i-1}^n}{\\Delta x^2}\\right)\n$$\n这是一个显式格式。必须选择时间步长 $\\Delta t$ 以确保稳定性。问题规定了类似 Courant-Friedrichs-Lewy (CFL) 的条件：\n$$\n\\Delta t = \\min\\left(c_a\\,\\frac{\\Delta x}{|u|}, \\; c_d\\,\\frac{\\Delta x^2}{\\kappa}\\right)\n$$\n其中 $c_a = 0.5$ 和 $c_d = 0.25$。这些值确保在重新整理后的更新公式中，$\\bar{c}_i^n$、$\\bar{c}_{i-1}^n$ 和 $\\bar{c}_{i+1}^n$ 的系数为非负，这是此格式稳定性的一个充分条件。为精确达到最终时间 $T$，计算步数 $n_{\\text{steps}} = \\lceil T/\\Delta t \\rceil$，并调整时间步长为 $\\Delta t = T/n_{\\text{steps}}$。\n\n数值模拟的初始条件必须是连续初始条件 $c(x,0) = \\sin(kx)$ 的单元平均值。这由下式给出：\n$$\n\\bar{c}_i(0) = \\frac{1}{\\Delta x}\\int_{x_i-\\Delta x/2}^{x_i+\\Delta x/2} \\sin(kx)\\,dx = \\sin(kx_i)\\,\\frac{2\\sin(k\\Delta x/2)}{k\\Delta x}\n$$\n对每个指定的网格分辨率 $N$ 运行模拟。将最终的数值解 $\\bar{c}_i(T)$ 与精确的单元平均解 $\\bar{c}_{\\text{exact},i}(T)$ 进行比较，以计算 RMS 误差 $E(\\Delta x)$。然后根据两个连续分辨率的误差 $E_{\\text{coarse}}$ 和 $E_{\\text{fine}}$（对应网格间距 $\\Delta x_{\\text{coarse}}$ 和 $\\Delta x_{\\text{fine}}$，其中 $\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}} = 2$）计算观测精度阶数 $p$：\n$$\np = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(\\Delta x_{\\text{coarse}}/\\Delta x_{\\text{fine}})} = \\frac{\\log(E_{\\text{coarse}}/E_{\\text{fine}})}{\\log(2)} = \\log_2(E_{\\text{coarse}}/E_{\\text{fine}})\n$$\n由于数值格式在空间和时间上均为一阶精度（其中 $\\Delta t$ 与 $\\Delta x$ 或 $\\Delta x^2$ 成比例），我们预计随着网格的加密，观测阶数 $p$ 将趋近于 1。在较粗的网格上，与该值的偏差可能是由高阶误差项的影响或解特征的解析度不佳所致，正如案例 #3 中所探讨的，其中相对于最粗的网格间距，波长较短。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef run_refinement_study(L, u, kappa, m, T, N_list):\n    \"\"\"\n    Performs a grid refinement study for a single test case.\n\n    Args:\n        L (float): Domain length.\n        u (float): Advective velocity.\n        kappa (float): Diffusivity.\n        m (int): Wavenumber index.\n        T (float): Final time.\n        N_list (list of int): Sequence of grid sizes for the study.\n\n    Returns:\n        list of float: The observed orders of accuracy between successive refinements.\n    \"\"\"\n    errors = []\n    \n    for N in N_list:\n        # Step 1: Set up the grid and parameters\n        dx = L / N\n        # Cell centers\n        x = np.arange(0.5, N, 1.0) * dx\n        k = 2.0 * np.pi * m / L\n\n        # Step 2: Set the initial condition (exact cell-averaged)\n        # The factor accounts for averaging sin(kx) over a cell width dx\n        # sinc(z) = sin(z)/z. This is sinc(k*dx/2) * sin(k*x_i)\n        sinc_factor = (2.0 * np.sin(k * dx / 2.0)) / (k * dx)\n        c0 = np.sin(k * x) * sinc_factor\n        \n        # Step 3: Set the time step\n        ca = 0.5\n        cd = 0.25\n        # The problem guarantees u != 0 and kappa != 0 for the given cases.\n        dt_ideal = min(ca * dx / abs(u), cd * dx**2 / kappa)\n        n_steps = math.ceil(T / dt_ideal)\n        dt = T / n_steps\n\n        # Step 4: Time integration using Forward Euler\n        c = c0.copy()\n        \n        for _ in range(n_steps):\n            # Handle periodic boundaries using np.roll\n            c_im1 = np.roll(c, 1) # c_{i-1}\n            c_ip1 = np.roll(c, -1) # c_{i+1}\n            \n            # Since u > 0 for all cases, advection is a backward difference\n            # d(c_i)/dt = -u * (c_i - c_{i-1}) / dx\n            advection_rhs = -u * (c - c_im1) / dx\n            \n            # Diffusion is a central difference\n            # d(c_i)/dt = kappa * (c_{i+1} - 2c_i + c_{i-1}) / dx^2\n            diffusion_rhs = kappa * (c_ip1 - 2.0 * c + c_im1) / (dx**2)\n            \n            # Update solution\n            c += dt * (advection_rhs + diffusion_rhs)\n            \n        # Step 5: Calculate the error\n        # Exact cell-averaged solution at time T\n        c_exact = np.exp(-kappa * k**2 * T) * np.sin(k * (x - u * T)) * sinc_factor\n        \n        # RMS error\n        error = np.sqrt(np.mean((c - c_exact)**2))\n        errors.append(error)\n        \n    # Step 6: Compute the observed order of accuracy\n    orders = []\n    for i in range(len(N_list) - 1):\n        # p = log(E_coarse / E_fine) / log(dx_coarse / dx_fine)\n        # Since dx_coarse / dx_fine = 2, this simplifies to log2(...)\n        order = np.log2(errors[i] / errors[i+1])\n        orders.append(order)\n        \n    return orders\n\ndef solve():\n    \"\"\"\n    Main solver function that runs all test cases and prints the final result.\n    \"\"\"\n    test_cases = [\n        # Case #1 (advection-dominated)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.01, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #2 (diffusion-dominated)\n        {'L': 1000.0, 'u': 0.05, 'kappa': 5.0, 'm': 1, 'T': 1000.0, 'N_list': [20, 40, 80, 160, 320]},\n        # Case #3 (mixed with coarse meshes)\n        {'L': 1000.0, 'u': 0.5, 'kappa': 0.5, 'm': 4, 'T': 1000.0, 'N_list': [10, 20, 40, 80, 160]},\n    ]\n    \n    all_results = []\n    for case in test_cases:\n        orders = run_refinement_study(\n            case['L'],\n            case['u'],\n            case['kappa'],\n            case['m'],\n            case['T'],\n            case['N_list']\n        )\n        all_results.append(orders)\n\n    # Format the final output string as specified\n    # e.g., [[p1,p2,p3],[q1,q2,q3],...]\n    output_str = '[' + ','.join([str(res) for res in all_results]) + ']'\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基本方程的验证后，我们转向更复杂的非线性浅水方程，这在海洋学中至关重要。新的挑战来自于源项（如水下地形）的存在，它必须与通量梯度精确平衡，以正确模拟物理平衡态。本练习  要求您实现一个“良态”（well-balanced）格式，它能够精确维持“静湖”（lake-at-rest）状态，这是对任何海洋或大气模型的关键测试。",
            "id": "3795847",
            "problem": "考虑用于单层海洋模型的一维浅水方程，其测深（bathymetry）是固定的。令 $x \\in [0,L]$ 表示水平坐标，$t$ 表示时间，$h(x,t)$ 表示水深，$u(x,t)$ 表示深度平均水平速度，$q(x,t) = h(x,t)\\,u(x,t)$ 表示流量，$B(x)$ 表示测深（河床高程），$\\eta(x,t) = h(x,t) + B(x)$ 表示自由表面高程。控制方程为\n$$\n\\frac{\\partial h}{\\partial t} + \\frac{\\partial (h u)}{\\partial x} = 0,\n\\qquad\n\\frac{\\partial (h u)}{\\partial t} + \\frac{\\partial \\left(h u^2 + \\frac{1}{2} g h^2\\right)}{\\partial x} = - g h \\frac{\\partial B}{\\partial x},\n$$\n其中重力加速度 $g = 9.81$ $\\mathrm{m/s^2}$。一个“静湖”平衡（也称为静止稳态）定义为 $u(x,t) = 0$ 且自由表面为常数 $\\eta(x,t) \\equiv \\eta_0$（对于某个常数 $\\eta_0$），因此 $h(x,t) = \\eta_0 - B(x)$ 且 $h(x,t) \\ge 0$。\n\n您的任务是从第一性原理出发，推导并实现一个良态平衡（well-balanced）的有限体积法，该方法能在长时间积分中，对于复杂的测深，精确地保持“静湖”状态至机器精度。推导和算法必须从上述守恒律的有限体积公式开始，并构建一个在“静湖”条件下能精确抵消的离散通量和源项。您不能假设任何预先推导出的保持“静湖”状态的公式；相反，必须从连续方程开始，逐步构建离散方法。\n\n您必须使用以下方法设计该方法：\n- 一个覆盖 $[0,L]$ 的包含 $N$ 个单元的均匀网格，并采用周期性边界条件。\n- 满足 Courant-Friedrichs-Lewy (CFL) 条件的一阶显式时间步进格式。\n- 在单元交界面处进行一致的、保正的静水压力重构。\n- 一个局部 Lax-Friedrichs (Rusanov) 数值通量。\n- 一个在“静湖”条件下确保静水压力通量-源项精确平衡的离散源项。\n\n明确推导交界面重构、通量和源项，以确保对 $h$ 和 $q$ 的离散更新能够在水深保持非负的前提下，对于任意平滑或不连续的测深 $B(x)$，将 $u=0$ 和 $\\eta=\\eta_0$ 的状态保持在机器精度范围内。\n\n在实现该方法后，使用以下测试套件验证其保持平衡的特性。对于每个测试案例，初始条件均为“静湖”状态：$u(x,0) = 0$ 且 $\\eta(x,0) = \\eta_0$ 为常数。测深函数和参数如下：\n\n- 案例 A（平滑多尺度测深）：\n  - 域长度 $L = 1000$ $\\mathrm{m}$，单元数 $N = 100$，最终时间 $T_{\\mathrm{end}} = 5000$ $\\mathrm{s}$，CFL 数 $\\mathrm{CFL} = 0.9$，自由表面水位 $\\eta_0 = 1.5$ $\\mathrm{m}$。\n  - 测深\n    $$\n    B(x) = 0.3 \\sin\\!\\left(\\frac{2\\pi x}{L}\\right) + 0.15 \\sin\\!\\left(\\frac{4\\pi x}{L}\\right) + 0.1 \\exp\\!\\left(-\\frac{(x - 0.3 L)^2}{(0.06 L)^2}\\right) - 0.08 \\exp\\!\\left(-\\frac{(x - 0.7 L)^2}{(0.08 L)^2}\\right).\n    $$\n\n- 案例 B（不连续阶梯测深）：\n  - 域长度 $L = 1000$ $\\mathrm{m}$，单元数 $N = 100$，最终时间 $T_{\\mathrm{end}} = 5000$ $\\mathrm{s}$，CFL 数 $\\mathrm{CFL} = 0.9$，自由表面水位 $\\eta_0 = 1.0$ $\\mathrm{m}$。\n  - 测深\n    $$\n    B(x) = \\begin{cases}\n    0,  0 \\le x  0.5L, \\\\\n    0.4,  0.5L \\le x \\le L.\n    \\end{cases}\n    $$\n\n- 案例 C（高频粗糙测深）：\n  - 域长度 $L = 1000$ $\\mathrm{m}$，单元数 $N = 200$，最终时间 $T_{\\mathrm{end}} = 3000$ $\\mathrm{s}$，CFL 数 $\\mathrm{CFL} = 0.9$，自由表面水位 $\\eta_0 = 1.2$ $\\mathrm{m}$。\n  - 测深\n    $$\n    B(x) = 0.2 \\sin\\!\\left(\\frac{16\\pi x}{L}\\right) + 0.1 \\sin\\!\\left(\\frac{32\\pi x}{L}\\right) + 0.05 \\sin\\!\\left(\\frac{64\\pi x}{L}\\right).\n    $$\n\n- 案例 D（近干高斯凸起）：\n  - 域长度 $L = 1000$ $\\mathrm{m}$，单元数 $N = 100$，最终时间 $T_{\\mathrm{end}} = 1000$ $\\mathrm{s}$，CFL 数 $\\mathrm{CFL} = 0.9$，自由表面水位 $\\eta_0 = 1.2 + 10^{-12}$ $\\mathrm{m}$。\n  - 测深\n    $$\n    B(x) = 1.2 \\exp\\!\\left(-\\frac{(x - 0.5 L)^2}{(0.04 L)^2}\\right).\n    $$\n\n对于每个案例，运行从 $t=0$ 到 $t=T_{\\mathrm{end}}$ 的模拟，并报告该案例中自由表面高程的最大绝对变化（以米为单位）：\n$$\nE = \\max_{x \\in [0,L]} \\left| \\eta(x,T_{\\mathrm{end}}) - \\eta_0 \\right|.\n$$\n以 $\\mathrm{m}$ 为单位表示 $E$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为 $[E_{\\mathrm{A}},E_{\\mathrm{B}},E_{\\mathrm{C}},E_{\\mathrm{D}}]$，每个条目都是一个以 $\\mathrm{m}$ 为单位的浮点数。",
            "solution": "该问题要求针对带测深的一维浅水方程，推导并实现一个良态平衡的有限体积格式。该格式必须能精确地保持“静湖”稳态至机器精度。\n\n### 1. 控制方程和有限体积公式\n\n浅水方程的守恒形式如下：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = \\mathbf{S}(h, B)\n$$\n其中 $\\mathbf{U}$、$\\mathbf{F}(\\mathbf{U})$ 和 $\\mathbf{S}(h, B)$ 分别是守恒变量向量、通量向量和源项向量：\n$$\n\\mathbf{U} = \\begin{pmatrix} h \\\\ q \\end{pmatrix}, \\quad\n\\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} q \\\\ \\frac{q^2}{h} + \\frac{1}{2}gh^2 \\end{pmatrix}, \\quad\n\\mathbf{S}(h, B) = \\begin{pmatrix} 0 \\\\ -gh \\frac{\\partial B}{\\partial x} \\end{pmatrix}\n$$\n这里，$h$ 是水深，$q=hu$ 是流量，$g$ 是重力加速度，$B(x)$ 是河床高程。自由表面高程为 $\\eta = h + B$。\n\n我们将空间域 $[0, L]$ 离散为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元 $C_i = [x_{i-1/2}, x_{i+1/2}]$。单元中心为 $x_i = (i-1/2)\\Delta x$，其中 $i=1, \\dots, N$。将控制方程在单元 $C_i$ 上积分，得到半离散的有限体积公式：\n$$\n\\frac{d\\mathbf{U}_i}{dt} + \\frac{1}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) = \\mathbf{S}_i\n$$\n其中 $\\mathbf{U}_i(t)$ 是 $\\mathbf{U}$ 在 $C_i$ 上的单元平均值，$\\mathbf{F}^*_{i \\pm 1/2}$ 是单元交界面处的数值通量，$\\mathbf{S}_i$ 是离散化的源项。对于时间积分，使用一阶显式欧拉方法：\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\Delta t \\mathbf{S}_i\n$$\n\n### 2. 良态平衡原理\n\n如果一个格式能够精确地保持一个稳态解，则称其为“良态平衡的”。对于浅水方程，“静湖”状态是一个关键的平衡态，定义为：\n$$\nu(x,t) = 0 \\quad \\text{and} \\quad \\eta(x,t) = h(x,t) + B(x) = \\eta_0 \\quad (\\text{常数})\n$$\n这意味着 $q=hu=0$ 且 $h(x) = \\eta_0 - B(x)$。要使该状态成为一个数值稳态，半离散更新方程的右侧必须在机器精度内为零。具体来说，对于每个单元 $i$：\n$$\n-\\frac{1}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\mathbf{S}_i = \\mathbf{0}\n$$\n当为离散的“静湖”条件（即对所有 $i$，$u_i=0$ 和 $h_i+B_i=\\eta_0$）求值时。\n\n挑战在于以一种相容的方式离散化通量 $\\mathbf{F}^*$ 和源项 $\\mathbf{S}_i$。\n\n### 3. 良态平衡格式的推导\n\n推导过程通过设计数值构件——重构、通量和源项——来满足良态平衡条件。\n\n#### 3.1. 静水压力重构\n\n标准的一阶格式在每个单元中使用分段常数数据 $\\mathbf{U}_i$。在交界面 $x_{i+1/2}$ 处，这会产生一个从 $\\mathbf{U}_i$ 到 $\\mathbf{U}_{i+1}$ 的跳跃。这种简单的方法不是良态平衡的。我们必须使用考虑了测深的静水压力重构。\n\n在每个交界面 $x_{i+1/2}$ 处，我们重构左（$L$）和右（$R$）状态。关键思想是重构水面高程 $\\eta$，然后找到相对于交界面处河床的水深 $h$。\n\n1.  **交界面测深**：为了创建一个鲁棒的方法，特别是对于不连续的测深，我们将交界面 $x_{i+1/2}$ 处的河床高程定义为 $B_{i+1/2} = \\max(B_i, B_{i+1})$。这个选择对于确保重构水深的保正性至关重要。\n2.  **重构水深**：左侧单元的自由表面为 $\\eta_i = h_i + B_i$，右侧单元的自由表面为 $\\eta_{i+1} = h_{i+1} + B_{i+1}$。通过从单元的自由表面高程中减去交界面的河床高程，可以得到交界面处的重构水深：\n    $$\n    h_L = \\eta_i - B_{i+1/2} = h_i + B_i - \\max(B_i, B_{i+1}) \\\\\n    h_R = \\eta_{i+1} - B_{i+1/2} = h_{i+1} + B_{i+1} - \\max(B_i, B_{i+1})\n    $$\n    为了按要求保证正性，我们取其与零的最大值：\n    $$\n    h_{L, i+1/2} = \\max(0, h_i + B_i - \\max(B_i, B_{i+1})) \\\\\n    h_{R, i+1/2} = \\max(0, h_{i+1} + B_{i+1} - \\max(B_i, B_{i+1}))\n    $$\n3.  **重构状态**：速度直接取自单元：$u_L = u_i$ 和 $u_R = u_{i+1}$。重构的状态向量为：\n    $$\n    \\mathbf{U}_{L, i+1/2} = \\begin{pmatrix} h_L \\\\ h_L u_i \\end{pmatrix}, \\quad \\mathbf{U}_{R, i+1/2} = \\begin{pmatrix} h_R \\\\ h_R u_{i+1} \\end{pmatrix}\n    $$\n\n在“静湖”状态下，其中对所有 $i$ 都有 $u_i=0$ 和 $\\eta_i = \\eta_0$，此重构给出：\n$h_{L, i+1/2} = \\max(0, \\eta_0 - \\max(B_i, B_{i+1}))$\n$h_{R, i+1/2} = \\max(0, \\eta_0 - \\max(B_i, B_{i+1}))$\n关键的是，在交界面处 $h_L = h_R$。由于 $u_L=u_R=0$，左右重构状态是相同的：$\\mathbf{U}_L = \\mathbf{U}_R$。\n\n#### 3.2. Rusanov (局部 Lax-Friedrichs) 通量\n\n在交界面处，针对重构状态 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 的 Rusanov 数值通量为：\n$$\n\\mathbf{F}^*(\\mathbf{U}_L, \\mathbf{U}_R) = \\frac{1}{2} \\left( \\mathbf{F}(\\mathbf{U}_L) + \\mathbf{F}(\\mathbf{U}_R) \\right) - \\frac{s_{\\max}}{2} \\left( \\mathbf{U}_R - \\mathbf{U}_L \\right)\n$$\n其中 $s_{\\max}$ 是最大局部波速，使用原始的单元平均状态进行估算：\n$$\ns_{\\max, i+1/2} = \\max(|u_i| + \\sqrt{gh_i}, |u_{i+1}| + \\sqrt{gh_{i+1}})\n$$\n在“静湖”状态下，由于 $\\mathbf{U}_L = \\mathbf{U}_R$，耗散项消失。通量简化为 $\\mathbf{F}^*_{i+1/2} = \\mathbf{F}(\\mathbf{U}_L)$。\n-   对于质量方程（第一个分量）：$F_h^* = q_L = h_L u_L = 0$。质量方程的净通量为零，因此质量守恒是平衡的。\n-   对于动量方程（第二个分量）：$F_q^* = \\frac{q_L^2}{h_L} + \\frac{1}{2}gh_L^2 = \\frac{1}{2}gh_L^2$。\n\n#### 3.3. 离散源项\n\n剩下的任务是定义一个离散源项 $\\mathbf{S}_i$，使其在静止状态下能精确抵消净动量通量。进入单元 $i$ 的来自压力项的净通量为：\n$$\n-\\frac{1}{\\Delta x} \\left( F^*_{q, i+1/2} - F^*_{q, i-1/2} \\right) \\xrightarrow{\\text{静止时}} -\\frac{1}{\\Delta x} \\left( \\frac{1}{2}g h_{L,i+1/2}^2 - \\frac{1}{2}g h_{L,i-1/2}^2 \\right)\n$$\n请注意，来自单元 $i$ 对 $x_{i+1/2}$ 处左状态的贡献值是 $h_{L,i+1/2}$，而来自单元 $i$ 对 $x_{i-1/2}$ 处右状态的贡献值是 $h_{R,i-1/2}$。在静止时，这两个值相等，所以我们可以只用 $h_L$ 来写出净通量。\n\n为了保持良态平衡性质，我们必须定义离散源项 $S_{q,i}$，使其能抵消这个净通量：\n$$\nS_{q,i} = \\frac{g}{2\\Delta x} \\left( h_{L,i+1/2}^2 - h_{R,i-1/2}^2 \\right)\n$$\n这个定义只在静止时有效。为了获得一个通用的定义，我们将静止状态的自由表面 $\\eta_0$ 替换为局部的自由表面 $\\eta_i = h_i + B_i$。量 $h_{L,i+1/2}$ 和 $h_{R,i-1/2}$ 是基于单元 $i$ 中投射到其交界面的状态计算的：\n$$\nh \\text{ 从单元 } i \\text{ 投射到 } x_{i+1/2} \\text{：} \\quad h_i + B_i - \\max(B_i,B_{i+1}) \\\\\nh \\text{ 从单元 } i \\text{ 投射到 } x_{i-1/2} \\text{：} \\quad h_i + B_i - \\max(B_{i-1},B_i)\n$$\n因此，我们将单元 $i$ 的动量源项定义为：\n$$\nS_{q,i} = \\frac{g}{2\\Delta x} \\left[ \\left(\\max(0, h_i + B_i - \\max(B_i,B_{i+1}))\\right)^2 - \\left(\\max(0, h_i + B_i - \\max(B_{i-1},B_i))\\right)^2 \\right]\n$$\n该源项与 $-ghB_x$ 是一致的，并且根据其构造，当水流处于静止状态时，它能精确地平衡数值通量中的静水压力梯度部分。\n\n### 4. 数值算法总结\n\n1.  **初始化**：给定 $N, L, \\eta_0$，定义网格 $x_i$ 和 $\\Delta x$。为 $i=1, \\dots, N$ 设置初始条件 $\\mathbf{U}_i^0$ 和 $B_i$：\n    $h_i^0 = \\eta_0 - B(x_i)$，$u_i^0 = 0$，$q_i^0 = 0$。\n2.  **时间推进**：对于 $n=0, 1, 2, \\dots$ 直到 $t \\ge T_{\\mathrm{end}}$：\n    a.  **CFL 条件**：计算时间步长 $\\Delta t = \\text{CFL} \\cdot \\Delta x / \\max_i(|u_i^n| + \\sqrt{gh_i^n})$。\n    b.  **应用周期性边界条件**：创建虚拟单元：$\\mathbf{U}_0^n=\\mathbf{U}_N^n$，$B_0=B_N$，$\\mathbf{U}_{N+1}^n=\\mathbf{U}_1^n$，$B_{N+1}=B_1$。\n    c.  **通量计算**：对于每个交界面 $i+1/2$（从 $i=0$ 到 $N$）：\n        i.  执行静水压力重构以找到 $\\mathbf{U}_{L, i+1/2}$ 和 $\\mathbf{U}_{R, i+1/2}$。\n        ii. 计算 Rusanov 通量 $\\mathbf{F}^*_{i+1/2}$。\n    d.  **源项计算**：对于每个单元 $i=1, \\dots, N$：\n        i.  使用第 3.3 节中推导的公式计算良态平衡源项 $S_{q,i}$。\n    e.  **更新**：对于每个单元 $i=1, \\dots, N$：\n        $$\n        \\mathbf{U}_i^{n+1} = \\mathbf{U}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathbf{F}^*_{i+1/2} - \\mathbf{F}^*_{i-1/2} \\right) + \\Delta t \\begin{pmatrix} 0 \\\\ S_{q,i} \\end{pmatrix}\n        $$\n3.  **最终误差**：在最后一个时间步之后，计算误差 $E = \\max_{i} |(h_i^{final} + B_i) - \\eta_0|$。\n\n这完成了从第一性原理出发的推导，得到了一个满足要求的一致、保正且良态平衡的格式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a well-balanced finite volume method for the 1D shallow water equations.\n    \"\"\"\n    g = 9.81  # Gravitational acceleration in m/s^2\n\n    def get_bathymetry(case_params, x):\n        \"\"\"Returns the bathymetry B(x) for a given case.\"\"\"\n        L = case_params['L']\n        if case_params['name'] == 'A':\n            term1 = 0.3 * np.sin(2 * np.pi * x / L)\n            term2 = 0.15 * np.sin(4 * np.pi * x / L)\n            term3 = 0.1 * np.exp(-((x - 0.3 * L)**2) / ((0.06 * L)**2))\n            term4 = -0.08 * np.exp(-((x - 0.7 * L)**2) / ((0.08 * L)**2))\n            return term1 + term2 + term3 + term4\n        elif case_params['name'] == 'B':\n            return np.where(x  0.5 * L, 0.0, 0.4)\n        elif case_params['name'] == 'C':\n            term1 = 0.2 * np.sin(16 * np.pi * x / L)\n            term2 = 0.1 * np.sin(32 * np.pi * x / L)\n            term3 = 0.05 * np.sin(64 * np.pi * x / L)\n            return term1 + term2 + term3\n        elif case_params['name'] == 'D':\n            return 1.2 * np.exp(-((x - 0.5 * L)**2) / ((0.04 * L)**2))\n        return np.zeros_like(x)\n\n    def flux(U, g):\n        \"\"\"Computes the physical flux F(U).\"\"\"\n        h, q = U[0, :], U[1, :]\n        \n        # Handle dry cells to avoid division by zero\n        # u = q/h = 0 if h is close to zero\n        u = np.divide(q, h, out=np.zeros_like(q), where=h  1e-9)\n        \n        F = np.zeros_like(U)\n        F[0, :] = q\n        F[1, :] = h * u**2 + 0.5 * g * h**2\n        return F\n\n    def run_simulation(params):\n        \"\"\"Runs the shallow water simulation for a given set of parameters.\"\"\"\n        N = params['N']\n        L = params['L']\n        T_end = params['T_end']\n        CFL = params['CFL']\n        eta0 = params['eta0']\n\n        # Grid setup\n        dx = L / N\n        x = np.linspace(dx / 2, L - dx / 2, N)\n\n        # Initial conditions: lake at rest\n        B = get_bathymetry(params, x)\n        h = np.full_like(x, eta0) - B\n        q = np.zeros_like(x)\n        \n        if np.any(h  0):\n             # This check is important for problem validity, but a robust solver should handle it.\n             # In this problem setup, all cases start with h >= 0.\n             raise ValueError(\"Initial condition has negative water depth (dry land).\")\n\n        # Conserved variables vector U = [h, q]\n        U = np.vstack((h, q))\n        t = 0.0\n\n        while t  T_end:\n            # Apply periodic boundary conditions using ghost cells\n            U_ext = np.zeros((2, N + 2))\n            U_ext[:, 1:-1] = U\n            U_ext[:, 0] = U[:, -1]\n            U_ext[:, -1] = U[:, 0]\n\n            B_ext = np.zeros(N + 2)\n            B_ext[1:-1] = B\n            B_ext[0] = B[-1]\n            B_ext[-1] = B[0]\n\n            # Time step calculation from CFL condition\n            h_vals = U_ext[0, :]\n            q_vals = U_ext[1, :]\n            u_vals = np.divide(q_vals, h_vals, out=np.zeros_like(q_vals), where=h_vals  1e-9)\n            \n            wave_speeds = np.abs(u_vals) + np.sqrt(g * np.maximum(h_vals, 0))\n            s_max_global = np.max(wave_speeds)\n            if s_max_global  1e-9: # Still water\n                dt = CFL * dx / 1e-9\n            else:\n                dt = CFL * dx / s_max_global\n\n            if t + dt  T_end:\n                dt = T_end - t\n            \n            # --- Well-balanced scheme ---\n            \n            # Left and right states for each interface (vectorized)\n            UL = U_ext[:, :-1]\n            UR = U_ext[:, 1:]\n            BL = B_ext[:-1]\n            BR = B_ext[1:]\n\n            hL_cell, qL_cell = UL[0, :], UL[1, :]\n            hR_cell, qR_cell = UR[0, :], UR[1, :]\n\n            # Hydrostatic Reconstruction at interfaces\n            B_int = np.maximum(BL, BR)\n            etaL = hL_cell + BL\n            etaR = hR_cell + BR\n            \n            h_L_recon = np.maximum(0, etaL - B_int)\n            h_R_recon = np.maximum(0, etaR - B_int)\n\n            u_L = np.divide(qL_cell, hL_cell, out=np.zeros_like(qL_cell), where=hL_cell  1e-9)\n            u_R = np.divide(qR_cell, hR_cell, out=np.zeros_like(qR_cell), where=hR_cell  1e-9)\n\n            UL_recon = np.vstack((h_L_recon, h_L_recon * u_L))\n            UR_recon = np.vstack((h_R_recon, h_R_recon * u_R))\n\n            # Rusanov (Local Lax-Friedrichs) Flux\n            s_max_int = np.maximum(\n                np.abs(u_L) + np.sqrt(g * hL_cell),\n                np.abs(u_R) + np.sqrt(g * hR_cell)\n            )\n            \n            F_L = flux(UL_recon, g)\n            F_R = flux(UR_recon, g)\n            \n            F_star = 0.5 * (F_L + F_R) - 0.5 * s_max_int * (UR_recon - UL_recon)\n\n            # Well-balanced Source Term for cells i=1..N\n            # For cell i, we need interfaces i-1/2 and i+1/2\n            # Which corresponds to F_star[:, i] and F_star[:, i-1] in 0-based indexing\n            h_center = U_ext[0, 1:-1]\n            B_center = B_ext[1:-1]\n            B_left   = B_ext[0:-2]\n            B_right  = B_ext[2:]\n\n            B_int_right = np.maximum(B_center, B_right)\n            B_int_left = np.maximum(B_center, B_left)\n\n            h_proj_right_sq = np.maximum(0, h_center + B_center - B_int_right)**2\n            h_proj_left_sq  = np.maximum(0, h_center + B_center - B_int_left)**2\n\n            # This discrete source term balances the hydrostatic pressure gradient part of the flux\n            S_q = 0.5 * g * (h_proj_left_sq - h_proj_right_sq) / dx\n\n            # Update step (first-order explicit Euler)\n            RHS_h = -(F_star[0, 1:] - F_star[0, :-1]) / dx\n            RHS_q = -(F_star[1, 1:] - F_star[1, :-1]) / dx + S_q\n            \n            U[0, :] += dt * RHS_h\n            U[1, :] += dt * RHS_q\n\n            t += dt\n\n        # Calculate final error\n        h_final = U[0, :]\n        eta_final = h_final + B\n        error = np.max(np.abs(eta_final - eta0))\n        return error\n\n    test_cases = [\n        {'name': 'A', 'L': 1000, 'N': 100, 'T_end': 5000, 'CFL': 0.9, 'eta0': 1.5},\n        {'name': 'B', 'L': 1000, 'N': 100, 'T_end': 5000, 'CFL': 0.9, 'eta0': 1.0},\n        {'name': 'C', 'L': 1000, 'N': 200, 'T_end': 3000, 'CFL': 0.9, 'eta0': 1.2},\n        {'name': 'D', 'L': 1000, 'N': 100, 'T_end': 1000, 'CFL': 0.9, 'eta0': 1.2 + 1e-12},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实现了数值通量之后，本练习将深入探讨其理论基础。先进的戈杜诺夫型（Godunov-type）格式建立在求解单元交界面上的局部黎曼问题的思想之上。本练习  将引导您推导浅水方程的特征波速，揭示波传播的物理学如何直接指导迎风格式数值通量的构建。",
            "id": "3795849",
            "problem": "您正在一个海岸架模型中，使用有限体积法（FVM）通过二维浅水方程模拟深度平均流。考虑一个从左单元指向右单元的平面单元面，其单位法向量为 $\\hat{\\boldsymbol{n}} = (n_x, n_y)$。设守恒状态量为 $\\boldsymbol{U} = [H, \\; H u, \\; H v]^{\\mathsf{T}}$，其中 $H$ 是总水深，$(u, v)$ 是深度平均速度分量。重力加速度为 $g$，假定为常数。在计算穿过该面的数值通量时，忽略与水深变化、科里奥利力以及摩擦力相关的源项。\n\n从浅水方程的积分守恒律和静水压闭合出发，通过以下步骤推导与面法向黎曼问题相关的特征波速：\n- 在与面法线对齐的旋转基中，用法向速度 $u_n = u n_x + v n_y$ 和切向速度 $u_t = -u n_y + v n_x$ 以及变量 $H$ 来表示面法向通量 $\\boldsymbol{F}_n(\\boldsymbol{U})$，\n- 用守恒变量 $H$、$m_n = H u_n$ 和 $m_t = H u_t$ 写出通量分量，\n- 对 $H  0$ 且 $u_n$ 为有限值的状态，将面法向通量进行线性化，以及\n- 计算所得雅可比矩阵在 $\\{H, m_n\\}$ 子系统上的特征值。\n\n解释这些特征波速的符号和大小如何为有限体积法中的 Godunov 型数值通量提供迎风决策信息，包括所有波从左向右移动、所有波从右向左移动，或波速跨越零穿过面的情况。\n\n答案要求：\n- 以仅依赖于 $g$、$H$ 和 $u_n$ 的单个闭式解析表达式提供两个面法向特征波速。\n- 使用 LaTeX 的 $\\texttt{pmatrix}$ 环境，将最终答案写成一个二元行向量 $\\bigl[s_{-} \\; s_{+}\\bigr]$。\n- 速度以米/秒为单位表示，但不要在最终的方框表达式中包含单位。\n- 无需进行数值取整。",
            "solution": "该问题要求推导二维浅水方程的面法向黎曼问题的特征波速，并解释它们在为有限体积法构建数值通量中的作用。\n\n二维浅水方程的守恒形式如下：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}_x}{\\partial x} + \\frac{\\partial \\boldsymbol{F}_y}{\\partial y} = \\boldsymbol{S}\n$$\n其中 $\\boldsymbol{U}$ 是守恒变量向量，$\\boldsymbol{F}_x$ 和 $\\boldsymbol{F}_y$ 分别是 $x$ 和 $y$ 方向的通量向量，$\\boldsymbol{S}$ 是源项向量。状态和通量向量为：\n$$\n\\boldsymbol{U} = \\begin{pmatrix} H \\\\ Hu \\\\ Hv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_x = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix}, \\quad\n\\boldsymbol{F}_y = \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix}\n$$\n此处，$H$ 是总水深，$(u, v)$ 是深度平均速度分量，$g$ 是重力加速度。\n\n对于有限体积法，我们考虑穿过一个单位法向量为 $\\hat{\\boldsymbol{n}} = (n_x, n_y)$ 的单元面的通量。面法向通量 $\\boldsymbol{F}_n$ 是通量张量在该法线上的投影：\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\boldsymbol{F}_x n_x + \\boldsymbol{F}_y n_y = \\begin{pmatrix} Hu \\\\ Hu^2 + \\frac{1}{2}gH^2 \\\\ Huv \\end{pmatrix} n_x + \\begin{pmatrix} Hv \\\\ Huv \\\\ Hv^2 + \\frac{1}{2}gH^2 \\end{pmatrix} n_y\n$$\n$$\n\\boldsymbol{F}_n(\\boldsymbol{U}) = \\begin{pmatrix}\nH(u n_x + v n_y) \\\\\nHu(u n_x + v n_y) + \\frac{1}{2}gH^2 n_x \\\\\nHv(u n_x + v n_y) + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\n我们定义面法向速度 $u_n = u n_x + v n_y$ 和面切向速度 $u_t = -u n_y + v n_x$。反转此旋转可得 $u = u_n n_x - u_t n_y$ 和 $v = u_n n_y + u_t n_x$。\n\n通过将动量方程旋转到与面平行的基中，可以简化分析。我们定义一个旋转后的状态向量 $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$，其中 $m_n = H u_n$ 是面法向动量，$m_t = H u_t$ 是面切向动量。与此旋转后状态向量对应的通量向量是 $\\boldsymbol{F}_{n, rot} = R \\boldsymbol{F}_n(\\boldsymbol{U})$，其中 $R$ 是状态向量的旋转矩阵：\n$$\nR = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix}\n$$\n将此旋转应用于以 $u, v, H$ 表示的通量向量 $\\boldsymbol{F}_n$：\n$$\n\\boldsymbol{F}_{n, rot} = \\begin{pmatrix} 1  0  0 \\\\ 0  n_x  n_y \\\\ 0  -n_y  n_x \\end{pmatrix} \\begin{pmatrix}\nH u_n \\\\\nH u u_n + \\frac{1}{2}gH^2 n_x \\\\\nH v u_n + \\frac{1}{2}gH^2 n_y\n\\end{pmatrix}\n$$\n旋转后通量向量的分量为：\n1.  质量通量：$H u_n = m_n$。\n2.  法向动量通量：$n_x(H u u_n + \\frac{1}{2}gH^2 n_x) + n_y(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (u n_x + v n_y) + \\frac{1}{2}gH^2(n_x^2 + n_y^2) = H u_n^2 + \\frac{1}{2}gH^2$。\n3.  切向动量通量：$-n_y(H u u_n + \\frac{1}{2}gH^2 n_x) + n_x(H v u_n + \\frac{1}{2}gH^2 n_y) = H u_n (-u n_y + v n_x) + \\frac{1}{2}gH^2(-n_y n_x + n_x n_y) = H u_n u_t$。\n\n用守恒变量 $H$、$m_n=Hu_n$ 和 $m_t=Hu_t$ 写出这些通量分量：\n$$\n\\boldsymbol{F}_{n, rot}(\\boldsymbol{U}_{rot}) = \\begin{pmatrix} m_n \\\\ \\frac{m_n^2}{H} + \\frac{1}{2}gH^2 \\\\ \\frac{m_n m_t}{H} \\end{pmatrix}\n$$\n特征波速是通量雅可比矩阵 $A_{rot} = \\frac{\\partial \\boldsymbol{F}_{n, rot}}{\\partial \\boldsymbol{U}_{rot}}$ 的特征值。我们计算关于 $\\boldsymbol{U}_{rot} = [H, m_n, m_t]^{\\mathsf{T}}$ 的偏导数：\n$$\nA_{rot} = \\begin{pmatrix}\n\\frac{\\partial (m_n)}{\\partial H}  \\frac{\\partial (m_n)}{\\partial m_n}  \\frac{\\partial (m_n)}{\\partial m_t} \\\\\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n^2}{H} + \\frac{1}{2}gH^2\\right) \\\\\n\\frac{\\partial}{\\partial H}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_n}\\left(\\frac{m_n m_t}{H}\\right)  \\frac{\\partial}{\\partial m_t}\\left(\\frac{m_n m_t}{H}\\right)\n\\end{pmatrix}\n$$\n为清晰起见，计算这些导数并用原始变量 $H$、$u_n$ 和 $u_t$ 表示它们：\n$$\nA_{rot} = \\begin{pmatrix}\n0  1  0 \\\\\ngH - u_n^2  2u_n  0 \\\\\n-u_n u_t  u_t  u_n\n\\end{pmatrix}\n$$\n问题要求的是限制在 $\\{H, m_n\\}$ 子系统上的雅可比矩阵的特征值。这对应于完整雅可比矩阵的左上角 $2 \\times 2$ 子块，因为 $H$ 和 $m_n$ 的方程与 $m_t$ 无关。设该子矩阵为 $A_{sub}$：\n$$\nA_{sub} = \\begin{pmatrix}\n0  1 \\\\\ngH - u_n^2  2u_n\n\\end{pmatrix}\n$$\n通过求解特征方程 $\\det(A_{sub} - \\lambda I) = 0$ 来找到特征值 $\\lambda$：\n$$\n\\det \\begin{pmatrix}\n-\\lambda  1 \\\\\ngH - u_n^2  2u_n - \\lambda\n\\end{pmatrix} = (-\\lambda)(2u_n - \\lambda) - (1)(gH - u_n^2) = 0\n$$\n$$\n-2u_n\\lambda + \\lambda^2 - gH + u_n^2 = 0\n$$\n$$\n\\lambda^2 - 2u_n\\lambda + (u_n^2 - gH) = 0\n$$\n使用二次方程求根公式求解 $\\lambda$：\n$$\n\\lambda = \\frac{-(-2u_n) \\pm \\sqrt{(-2u_n)^2 - 4(1)(u_n^2 - gH)}}{2(1)} = \\frac{2u_n \\pm \\sqrt{4u_n^2 - 4u_n^2 + 4gH}}{2}\n$$\n$$\n\\lambda = \\frac{2u_n \\pm \\sqrt{4gH}}{2} = \\frac{2u_n \\pm 2\\sqrt{gH}}{2} = u_n \\pm \\sqrt{gH}\n$$\n因此，与 $\\{H, m_n\\}$ 子系统相关的两个特征波速是 $s_{-} = u_n - \\sqrt{gH}$ 和 $s_{+} = u_n + \\sqrt{gH}$。这些速度代表了表面重力波的传播，其速度 $c = \\sqrt{gH}$ 被法向流速 $u_n$ 进行了多普勒频移。完整系统的第三个特征值是 $\\lambda = u_n$，对应于切向速度的平流。\n\n这些特征波速是 Godunov 型有限体积法的基础。它们决定了单元面上局部黎曼问题解中信息传播的方向，从而决定了数值通量 $\\boldsymbol{F}^*$ 的迎风策略。我们考虑一个位于左单元（状态 $\\boldsymbol{U}_L$）和右单元（状态 $\\boldsymbol{U}_R$）之间的面，并在某个相关的中间状态（例如 Roe 平均状态）下评估波速。\n\n1.  **所有波从左向右移动：** 这发生在向右移动的超临界流中，此时 $u_n  \\sqrt{gH}$。在这种情况下，最慢的特征波速为正：$s_{-} = u_n - \\sqrt{gH}  0$。所有信息都从左向右传播。界面上的状态完全由左侧状态 $\\boldsymbol{U}_L$ 决定。数值通量完全从左侧取迎风格式：$\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_L)$。\n\n2.  **所有波从右向左移动：** 这发生在向左移动的超临界流中，此时 $u_n  -\\sqrt{gH}$。在这种情况下，最快的特征波速为负：$s_{+} = u_n + \\sqrt{gH}  0$。所有信息都从右向左传播。界面上的状态完全由右侧状态 $\\boldsymbol{U}_R$ 决定。数值通量完全从右侧取迎风格式：$\\boldsymbol{F}^* = \\boldsymbol{F}_n(\\boldsymbol{U}_R)$。\n\n3.  **波速跨越零：** 这发生在亚临界流中，此时 $|u_n|  \\sqrt{gH}$。在这种流态下，$s_{-}  0$ 且 $s_{+}  0$。信息从左右两个状态向界面传播。数值通量必须考虑来自 $\\boldsymbol{U}_L$ 和 $\\boldsymbol{U}_R$ 两方面的贡献。像 Roe 格式或 HLL/HLLC 格式就是为此情况设计的。例如，Roe 求解器中的耗散项 $\\frac{1}{2}\\sum_k |\\bar{\\lambda}_k| \\Delta W_k \\bar{\\boldsymbol{r}}_k$，使用特征波速的绝对值 $|\\lambda_k|$ 来缩放施加于每个波族的耗散，通过仅在需要的地方并以正确的迎风偏置方式增加耗散来确保稳定性。特征值的符号决定了跨界面的状态变量跳跃如何分解为不同的波贡献。\n\n总之，特征波速的符号决定了迎风方向，而其大小则影响了为保证格式稳定和精确所需的数值耗散。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} u_n - \\sqrt{gH}  u_n + \\sqrt{gH} \\end{pmatrix}}\n$$"
        }
    ]
}