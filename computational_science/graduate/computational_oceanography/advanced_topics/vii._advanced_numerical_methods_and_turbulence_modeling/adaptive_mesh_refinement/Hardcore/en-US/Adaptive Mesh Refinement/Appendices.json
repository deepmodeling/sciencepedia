{
    "hands_on_practices": [
        {
            "introduction": "When an adaptive mesh refinement algorithm flags a region for higher resolution, new fine-grid cells are created. The first challenge is to initialize the scalar quantities (like temperature or tracer concentration) in these new cells based on the data from the parent coarse cell. This process, known as prolongation, must be designed to be both accurate and conservative to avoid introducing errors or artificially creating mass. This practice  will guide you through the derivation of a second-order accurate, conservative prolongation stencil, a cornerstone of high-fidelity AMR implementations.",
            "id": "4009052",
            "problem": "Adaptive Mesh Refinement (AMR) in Numerical Weather Prediction (NWP) and climate modeling requires prolongation operators that are both conservative and at least second-order accurate to prevent spurious creation or loss of scalar quantities such as tracer mass. Consider a finite-volume coarse cell centered at the origin, with uniform spacings $\\Delta x_c$ and $\\Delta y_c$ in the $x$- and $y$-directions, respectively. Let a dimensionless conserved scalar field be represented on the coarse level by the coarse cell average $\\bar{q}_c$. Assume a bilinear reconstruction within the coarse cell of the form\n$$\np(x,y) \\equiv \\bar{q}_c + S_x\\,x + S_y\\,y + S_{xy}\\,x\\,y,\n$$\nwhere $S_x$, $S_y$, and $S_{xy}$ are second-order accurate, coarse-level estimates of the local first derivatives and the mixed term coefficient, and $(x,y)$ are local coordinates measured from the coarse cell center with $x \\in [-\\Delta x_c/2,\\,\\Delta x_c/2]$ and $y \\in [-\\Delta y_c/2,\\,\\Delta y_c/2]$. The fine level is a factor-of-$2$ refinement in each spatial direction, producing four fine subcells by splitting at $x=0$ and $y=0$: the northeast (NE) subcell with $x \\in [0,\\,\\Delta x_c/2]$, $y \\in [0,\\,\\Delta y_c/2]$; the northwest (NW) subcell with $x \\in [-\\Delta x_c/2,\\,0]$, $y \\in [0,\\,\\Delta y_c/2]$; the southwest (SW) subcell with $x \\in [-\\Delta x_c/2,\\,0]$, $y \\in [-\\Delta y_c/2,\\,0]$; and the southeast (SE) subcell with $x \\in [0,\\,\\Delta x_c/2]$, $y \\in [-\\Delta y_c/2,\\,0]$.\n\nUsing only the finite-volume definition of a cell average and conservation principles, derive the second-order conservative prolongation stencil that maps the coarse cell average and bilinear coefficients to the four fine cell averages, defined as\n$$\n\\bar{q}_{R} \\equiv \\frac{1}{A_R} \\int_{R} p(x,y)\\, \\mathrm{d}A,\n$$\nfor each region $R \\in \\{\\mathrm{NE},\\mathrm{NW},\\mathrm{SW},\\mathrm{SE}\\}$ with area $A_R = (\\Delta x_c/2)(\\Delta y_c/2)$, and $\\mathrm{d}A = \\mathrm{d}x\\,\\mathrm{d}y$. Your final answers must be explicit analytic expressions for $\\bar{q}_{\\mathrm{NE}}$, $\\bar{q}_{\\mathrm{NW}}$, $\\bar{q}_{\\mathrm{SW}}$, and $\\bar{q}_{\\mathrm{SE}}$ in terms of $\\bar{q}_c$, $\\Delta x_c$, $\\Delta y_c$, $S_x$, $S_y$, and $S_{xy}$. Present your final answer as a single row matrix in the order $(\\bar{q}_{\\mathrm{NE}}, \\bar{q}_{\\mathrm{NW}}, \\bar{q}_{\\mathrm{SW}}, \\bar{q}_{\\mathrm{SE}})$. Express your answer exactly; no rounding or units are required.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, self-contained, consistent, and well-posed. The task is to derive the second-order conservative prolongation stencil for a finite-volume method, which maps a coarse-cell average and its reconstructed distribution to four fine-cell averages.\n\nThe fundamental principle to be used is the definition of a cell average for a conserved scalar field $q$. For any region $R$ with area $A_R$, the cell average $\\bar{q}_R$ is defined as the integral of the scalar field over the region, divided by the area of the region:\n$$\n\\bar{q}_{R} \\equiv \\frac{1}{A_R} \\int_{R} q(x,y)\\, \\mathrm{d}A\n$$\nIn this problem, the scalar field distribution within the coarse cell is given by a bilinear reconstruction polynomial $p(x,y)$:\n$$\np(x,y) = \\bar{q}_c + S_x\\,x + S_y\\,y + S_{xy}\\,x\\,y\n$$\nThe coarse cell is centered at the origin, with domain $x \\in [-\\Delta x_c/2, \\Delta x_c/2]$ and $y \\in [-\\Delta y_c/2, \\Delta y_c/2]$. The fine grid is a factor-of-$2$ refinement, resulting in four subcells (NE, NW, SW, SE) each with area $A_R = (\\Delta x_c/2)(\\Delta y_c/2) = \\frac{\\Delta x_c \\Delta y_c}{4}$.\n\nOur objective is to compute the average of $p(x,y)$ over each of these four subcells. Let's denote a generic subcell region as $R$. The average is:\n$$\n\\bar{q}_{R} = \\frac{1}{A_R} \\int_{R} (\\bar{q}_c + S_x\\,x + S_y\\,y + S_{xy}\\,x\\,y)\\, \\mathrm{d}x\\,\\mathrm{d}y\n$$\nBy linearity of integration, we can separate the terms:\n$$\n\\bar{q}_{R} = \\frac{1}{A_R} \\left( \\bar{q}_c \\int_{R} 1\\, \\mathrm{d}x\\,\\mathrm{d}y + S_x \\int_{R} x\\, \\mathrm{d}x\\,\\mathrm{d}y + S_y \\int_{R} y\\, \\mathrm{d}x\\,\\mathrm{d}y + S_{xy} \\int_{R} xy\\, \\mathrm{d}x\\,\\mathrm{d}y \\right)\n$$\nThe first integral $\\int_{R} 1\\, \\mathrm{d}x\\,\\mathrm{d}y$ is simply the area of the region, $A_R$. This simplifies the expression to:\n$$\n\\bar{q}_{R} = \\bar{q}_c + \\frac{S_x}{A_R} \\int_{R} x\\, \\mathrm{d}x\\,\\mathrm{d}y + \\frac{S_y}{A_R} \\int_{R} y\\, \\mathrm{d}x\\,\\mathrm{d}y + \\frac{S_{xy}}{A_R} \\int_{R} xy\\, \\mathrm{d}x\\,\\mathrm{d}y\n$$\nThe remaining integrals can be evaluated for a general rectangular region $[x_1, x_2] \\times [y_1, y_2]$ with area $A_R = (x_2 - x_1)(y_2 - y_1)$. The centroid of this rectangle is $(\\bar{x}_R, \\bar{y}_R) = (\\frac{x_1+x_2}{2}, \\frac{y_1+y_2}{2})$.\nThe integrals are:\n$$\n\\int_{R} x\\, \\mathrm{d}A = \\int_{y_1}^{y_2} \\int_{x_1}^{x_2} x\\, \\mathrm{d}x\\,\\mathrm{d}y = \\left[\\frac{x^2}{2}\\right]_{x_1}^{x_2} \\left[y\\right]_{y_1}^{y_2} = \\frac{x_2^2-x_1^2}{2}(y_2-y_1) = \\frac{(x_2-x_1)(x_2+x_1)}{2}(y_2-y_1) = A_R \\bar{x}_R\n$$\n$$\n\\int_{R} y\\, \\mathrm{d}A = \\int_{y_1}^{y_2} \\int_{x_1}^{x_2} y\\, \\mathrm{d}x\\,\\mathrm{d}y = (x_2-x_1)\\frac{y_2^2-y_1^2}{2} = A_R \\bar{y}_R\n$$\n$$\n\\int_{R} xy\\, \\mathrm{d}A = \\int_{y_1}^{y_2} \\int_{x_1}^{x_2} xy\\, \\mathrm{d}x\\,\\mathrm{d}y = \\left[\\frac{x^2}{2}\\right]_{x_1}^{x_2} \\left[\\frac{y^2}{2}\\right]_{y_1}^{y_2} = \\frac{x_2^2-x_1^2}{2} \\frac{y_2^2-y_1^2}{2} = (A_R \\bar{x}_R) \\bar{y}_R = A_R \\bar{x}_R \\bar{y}_R\n$$\nSubstituting these results back into the expression for $\\bar{q}_R$, we obtain a general formula for the average of the bilinear polynomial over any rectangular sub-region $R$:\n$$\n\\bar{q}_R = \\bar{q}_c + S_x \\bar{x}_R + S_y \\bar{y}_R + S_{xy} \\bar{x}_R \\bar{y}_R\n$$\nThis elegant result shows that the fine-cell average is determined by evaluating the contributions from the derivative terms at the centroid of the fine cell. Now we apply this formula to each of the four subcells by finding their centroids.\n\n1.  **Northeast (NE) subcell**: $x \\in [0, \\Delta x_c/2]$, $y \\in [0, \\Delta y_c/2]$.\n    The centroid is $(\\bar{x}_{\\mathrm{NE}}, \\bar{y}_{\\mathrm{NE}}) = (\\frac{0+\\Delta x_c/2}{2}, \\frac{0+\\Delta y_c/2}{2}) = (\\frac{\\Delta x_c}{4}, \\frac{\\Delta y_c}{4})$.\n    $$\n    \\bar{q}_{\\mathrm{NE}} = \\bar{q}_c + S_x \\left(\\frac{\\Delta x_c}{4}\\right) + S_y \\left(\\frac{\\Delta y_c}{4}\\right) + S_{xy} \\left(\\frac{\\Delta x_c}{4}\\right)\\left(\\frac{\\Delta y_c}{4}\\right) = \\bar{q}_c + \\frac{S_x \\Delta x_c}{4} + \\frac{S_y \\Delta y_c}{4} + \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}\n    $$\n\n2.  **Northwest (NW) subcell**: $x \\in [-\\Delta x_c/2, 0]$, $y \\in [0, \\Delta y_c/2]$.\n    The centroid is $(\\bar{x}_{\\mathrm{NW}}, \\bar{y}_{\\mathrm{NW}}) = (\\frac{-\\Delta x_c/2+0}{2}, \\frac{0+\\Delta y_c/2}{2}) = (-\\frac{\\Delta x_c}{4}, \\frac{\\Delta y_c}{4})$.\n    $$\n    \\bar{q}_{\\mathrm{NW}} = \\bar{q}_c + S_x \\left(-\\frac{\\Delta x_c}{4}\\right) + S_y \\left(\\frac{\\Delta y_c}{4}\\right) + S_{xy} \\left(-\\frac{\\Delta x_c}{4}\\right)\\left(\\frac{\\Delta y_c}{4}\\right) = \\bar{q}_c - \\frac{S_x \\Delta x_c}{4} + \\frac{S_y \\Delta y_c}{4} - \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}\n    $$\n\n3.  **Southwest (SW) subcell**: $x \\in [-\\Delta x_c/2, 0]$, $y \\in [-\\Delta y_c/2, 0]$.\n    The centroid is $(\\bar{x}_{\\mathrm{SW}}, \\bar{y}_{\\mathrm{SW}}) = (\\frac{-\\Delta x_c/2+0}{2}, \\frac{-\\Delta y_c/2+0}{2}) = (-\\frac{\\Delta x_c}{4}, -\\frac{\\Delta y_c}{4})$.\n    $$\n    \\bar{q}_{\\mathrm{SW}} = \\bar{q}_c + S_x \\left(-\\frac{\\Delta x_c}{4}\\right) + S_y \\left(-\\frac{\\Delta y_c}{4}\\right) + S_{xy} \\left(-\\frac{\\Delta x_c}{4}\\right)\\left(-\\frac{\\Delta y_c}{4}\\right) = \\bar{q}_c - \\frac{S_x \\Delta x_c}{4} - \\frac{S_y \\Delta y_c}{4} + \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}\n    $$\n\n4.  **Southeast (SE) subcell**: $x \\in [0, \\Delta x_c/2]$, $y \\in [-\\Delta y_c/2, 0]$.\n    The centroid is $(\\bar{x}_{\\mathrm{SE}}, \\bar{y}_{\\mathrm{SE}}) = (\\frac{0+\\Delta x_c/2}{2}, \\frac{-\\Delta y_c/2+0}{2}) = (\\frac{\\Delta x_c}{4}, -\\frac{\\Delta y_c}{4})$.\n    $$\n    \\bar{q}_{\\mathrm{SE}} = \\bar{q}_c + S_x \\left(\\frac{\\Delta x_c}{4}\\right) + S_y \\left(-\\frac{\\Delta y_c}{4}\\right) + S_{xy} \\left(\\frac{\\Delta x_c}{4}\\right)\\left(-\\frac{\\Delta y_c}{4}\\right) = \\bar{q}_c + \\frac{S_x \\Delta x_c}{4} - \\frac{S_y \\Delta y_c}{4} - \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}\n    $$\n\nTo verify the conservation property of this prolongation stencil, we check if the average of the fine-cell averages equals the coarse-cell average.\n$$\n\\frac{1}{4}(\\bar{q}_{\\mathrm{NE}} + \\bar{q}_{\\mathrm{NW}} + \\bar{q}_{\\mathrm{SW}} + \\bar{q}_{\\mathrm{SE}}) = \\frac{1}{4} \\left( 4\\bar{q}_c \\right)\n+ \\frac{1}{4}\\frac{S_x \\Delta x_c}{4}(1 - 1 - 1 + 1)\n+ \\frac{1}{4}\\frac{S_y \\Delta y_c}{4}(1 + 1 - 1 - 1)\n+ \\frac{1}{4}\\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}(1 - 1 + 1 - 1)\n$$\n$$\n= \\bar{q}_c + 0 + 0 + 0 = \\bar{q}_c\n$$\nSince the sum of the fine-cell values (weighted by area) equals the coarse-cell value, the procedure is conservative. The derived expressions constitute the desired prolongation stencil.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\bar{q}_c + \\frac{S_x \\Delta x_c}{4} + \\frac{S_y \\Delta y_c}{4} + \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}  \\bar{q}_c - \\frac{S_x \\Delta x_c}{4} + \\frac{S_y \\Delta y_c}{4} - \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}  \\bar{q}_c - \\frac{S_x \\Delta x_c}{4} - \\frac{S_y \\Delta y_c}{4} + \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}  \\bar{q}_c + \\frac{S_x \\Delta x_c}{4} - \\frac{S_y \\Delta y_c}{4} - \\frac{S_{xy} \\Delta x_c \\Delta y_c}{16}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "With coarse and fine grids coexisting, a critical challenge arises at their interface. Since the fine grid resolves fluid motion with greater detail, its calculation of the mass or energy flux across the boundary will differ from the coarse grid's estimate. This practice  demonstrates the essential 'flux correction' procedure, where this mismatch is calculated and used to adjust the coarse-grid solution, ensuring that fundamental physical principles like mass conservation are perfectly maintained across the entire domain.",
            "id": "3785227",
            "problem": "Consider a two-dimensional finite-volume discretization of a passive scalar tracer in a coastal ocean model using Adaptive Mesh Refinement (AMR), where a coarse grid cell of width $\\Delta x_{\\mathrm{c}}$ abuts a refined patch on its eastern face. The tracer mass in the coarse cell, denoted by $M$, obeys conservation under advective fluxes across cell faces: the time rate of change of $M$ equals the net outward mass flux rate integrated over time. In AMR with refinement ratio $r=2$, the fine level advances with two substeps over one coarse time step, and the coarse east face is covered by two fine faces of equal length. Assume that the vertical is already integrated and the flux rates provided are total mass flux rates integrated over the face length and depth.\n\nLet the coarse time step be $\\Delta t_{\\mathrm{c}} = 60$ seconds and the fine time step be $\\Delta t_{\\mathrm{f}} = \\Delta t_{\\mathrm{c}}/r = 30$ seconds. Assume that positive flux is oriented outward from the coarse cell into the fine patch across the shared east interface. Over the single coarse time step, the coarse-level discretization produced a constant east-face mass flux rate $F_{\\mathrm{c}} = 1.00 \\times 10^{6}$ kilograms per second. On the fine level, the two fine faces that cover the coarse east face have the following mass flux rates during the two fine substeps:\n- For substep $m=1$, the fine flux rates are $F_{\\mathrm{f},1}^{(1)} = 5.8 \\times 10^{5}$ kilograms per second and $F_{\\mathrm{f},2}^{(1)} = 6.0 \\times 10^{5}$ kilograms per second.\n- For substep $m=2$, the fine flux rates are $F_{\\mathrm{f},1}^{(2)} = 6.2 \\times 10^{5}$ kilograms per second and $F_{\\mathrm{f},2}^{(2)} = 5.9 \\times 10^{5}$ kilograms per second.\n\nAssume that there is no flux across the coarse cell’s western face during this coarse step. The coarse cell’s initial tracer mass is $M^{n} = 2.00 \\times 10^{8}$ kilograms.\n\nStarting from the finite-volume conservation principle and the definition of flux integrals over time and faces, derive the coarse-fine flux mismatch accumulated over the single coarse time step and explain how it is applied as a correction to the coarse cell to enforce conservation across the coarse-fine interface. Compute the corrected coarse-cell tracer mass at the end of the coarse time step. Round your final answer to four significant figures and express it in kilograms.",
            "solution": "The problem is valid as it describes a standard, well-posed scenario in computational fluid dynamics, specifically the flux-correction step in Adaptive Mesh Refinement (AMR) to ensure mass conservation across a coarse-fine grid interface. All necessary data are provided, and the requested calculation is based on fundamental principles of finite-volume methods.\n\nThe core principle governing the evolution of the tracer mass $M$ in the coarse finite-volume cell is the conservation law, which states that the change in mass over a time interval is equal to the negative of the total mass that has fluxed out of the cell's boundaries. In discretized form, for a single coarse time step $\\Delta t_{\\mathrm{c}}$, the mass at time $n+1$, denoted $M^{n+1}$, is related to the mass at time $n$, $M^n$, by:\n$$\nM^{n+1} = M^n - \\Delta M_{\\text{flux}}\n$$\nwhere $\\Delta M_{\\text{flux}}$ is the total net mass that exited the cell during the time step $\\Delta t_{\\mathrm{c}}$. The problem specifies no flux on the western face, so we only need to consider the flux across the eastern face.\n\nIn an AMR context, there are two different calculations for the total mass flux across the coarse-fine interface over the time interval from $t^n$ to $t^{n+1} = t^n + \\Delta t_{\\mathrm{c}}$.\n\nFirst, the coarse grid computes a total mass outflow, $\\Delta M_{\\mathrm{c}}$, based on its own flux estimate. The coarse-level flux rate, $F_{\\mathrm{c}}$, is given as constant over the coarse time step $\\Delta t_{\\mathrm{c}}$.\n$$\n\\Delta M_{\\mathrm{c}} = F_{\\mathrm{c}} \\cdot \\Delta t_{\\mathrm{c}}\n$$\nUsing the provided values:\n$$\n\\Delta M_{\\mathrm{c}} = (1.00 \\times 10^{6} \\, \\text{kg/s}) \\cdot (60 \\, \\text{s}) = 6.00 \\times 10^{7} \\, \\text{kg}\n$$\n\nSecond, the fine grid provides a more accurate calculation of the mass outflow, $\\Delta M_{\\mathrm{f}}$, by resolving the interface with higher spatial and temporal fidelity. The single coarse-face flux is resolved by two fine-face fluxes, and the single coarse time step is resolved by $r=2$ fine substeps of duration $\\Delta t_{\\mathrm{f}} = \\Delta t_{\\mathrm{c}} / r$. The total mass outflow as computed on the fine level is the sum of fluxes over all fine faces and all fine substeps.\n\nFor the first fine substep ($m=1$, time interval $\\Delta t_{\\mathrm{f}}$), the total mass outflow is:\n$$\n\\Delta M_{\\mathrm{f}}^{(1)} = \\left( F_{\\mathrm{f},1}^{(1)} + F_{\\mathrm{f},2}^{(1)} \\right) \\cdot \\Delta t_{\\mathrm{f}}\n$$\nFor the second fine substep ($m=2$, time interval $\\Delta t_{\\mathrm{f}}$), the total mass outflow is:\n$$\n\\Delta M_{\\mathrm{f}}^{(2)} = \\left( F_{\\mathrm{f},1}^{(2)} + F_{\\mathrm{f},2}^{(2)} \\right) \\cdot \\Delta t_{\\mathrm{f}}\n$$\nThe total mass outflow across the interface over the full coarse time step $\\Delta t_{\\mathrm{c}}$, according to the fine grid, is the sum of these:\n$$\n\\Delta M_{\\mathrm{f}} = \\Delta M_{\\mathrm{f}}^{(1)} + \\Delta M_{\\mathrm{f}}^{(2)} = \\left[ \\left( F_{\\mathrm{f},1}^{(1)} + F_{\\mathrm{f},2}^{(1)} \\right) + \\left( F_{\\mathrm{f},1}^{(2)} + F_{\\mathrm{f},2}^{(2)} \\right) \\right] \\cdot \\Delta t_{\\mathrm{f}}\n$$\nSubstituting the given values:\n$F_{\\mathrm{f},1}^{(1)} = 5.8 \\times 10^{5}$ kg/s, $F_{\\mathrm{f},2}^{(1)} = 6.0 \\times 10^{5}$ kg/s\n$F_{\\mathrm{f},1}^{(2)} = 6.2 \\times 10^{5}$ kg/s, $F_{\\mathrm{f},2}^{(2)} = 5.9 \\times 10^{5}$ kg/s\n$\\Delta t_{\\mathrm{f}} = 30$ s\n\n$$\n\\Delta M_{\\mathrm{f}} = \\left[ (5.8 \\times 10^{5} + 6.0 \\times 10^{5}) + (6.2 \\times 10^{5} + 5.9 \\times 10^{5}) \\right] \\frac{\\text{kg}}{\\text{s}} \\cdot (30 \\, \\text{s})\n$$\n$$\n\\Delta M_{\\mathrm{f}} = \\left[ (1.18 \\times 10^{6}) + (1.21 \\times 10^{6}) \\right] \\frac{\\text{kg}}{\\text{s}} \\cdot (30 \\, \\text{s})\n$$\n$$\n\\Delta M_{\\mathrm{f}} = (2.39 \\times 10^{6} \\, \\text{kg/s}) \\cdot (30 \\, \\text{s}) = 7.17 \\times 10^{7} \\, \\text{kg}\n$$\n\nThe coarse-fine flux mismatch, which we denote as $\\delta M_{\\text{flux}}$, is the difference between the total mass transfer computed by the fine grid and that computed by the coarse grid.\n$$\n\\delta M_{\\text{flux}} = \\Delta M_{\\mathrm{f}} - \\Delta M_{\\mathrm{c}}\n$$\n$$\n\\delta M_{\\text{flux}} = 7.17 \\times 10^{7} \\, \\text{kg} - 6.00 \\times 10^{7} \\, \\text{kg} = 1.17 \\times 10^{7} \\, \\text{kg}\n$$\nThis mismatch represents the error in the coarse grid's flux calculation. A positive value means that the more accurate fine grid calculated a greater mass outflow from the coarse cell than the coarse grid itself did.\n\nTo enforce global conservation, this mismatch must be corrected. The coarse cell's mass, which was updated using the less accurate flux $\\Delta M_{\\mathrm{c}}$ during the coarse time step, must be adjusted. The correction is applied by subtracting the flux mismatch from the coarse cell's mass. The change to the coarse cell's mass is $-\\delta M_{\\text{flux}}$.\nThe logic is as follows: A provisional update of the coarse cell mass is $M^{n+1, \\text{uncorrected}} = M^{n} - \\Delta M_{\\mathrm{c}}$. The correction is then applied to this value:\n$$\nM^{n+1, \\text{corrected}} = M^{n+1, \\text{uncorrected}} - \\delta M_{\\text{flux}} = (M^{n} - \\Delta M_{\\mathrm{c}}) - (\\Delta M_{\\mathrm{f}} - \\Delta M_{\\mathrm{c}})\n$$\nThis simplifies to:\n$$\nM^{n+1, \\text{corrected}} = M^{n} - \\Delta M_{\\mathrm{f}}\n$$\nThis result demonstrates that the flux-correction procedure ensures that the coarse cell's mass budget is consistent with the more accurate flux calculated on the fine grid, thereby maintaining conservation.\n\nWe can now compute the corrected final mass of the coarse cell using the initial mass $M^n$ and the total flux from the fine grid $\\Delta M_{\\mathrm{f}}$.\nGiven $M^n = 2.00 \\times 10^{8}$ kg:\n$$\nM^{n+1, \\text{corrected}} = 2.00 \\times 10^{8} \\, \\text{kg} - 7.17 \\times 10^{7} \\, \\text{kg}\n$$\n$$\nM^{n+1, \\text{corrected}} = 2.00 \\times 10^{8} \\, \\text{kg} - 0.717 \\times 10^{8} \\, \\text{kg}\n$$\n$$\nM^{n+1, \\text{corrected}} = (2.00 - 0.717) \\times 10^{8} \\, \\text{kg} = 1.283 \\times 10^{8} \\, \\text{kg}\n$$\nThis value is already expressed to four significant figures as requested.",
            "answer": "$$\\boxed{1.283 \\times 10^{8}}$$"
        },
        {
            "introduction": "Beyond the challenges of numerical accuracy and conservation, the practical use of AMR in large-scale ocean modeling is dominated by performance considerations. As refinement regions move, they create dynamic computational loads, causing some processors in a parallel simulation to work much harder than others, a problem known as load imbalance. This exercise  invites you to build a simple performance model to analyze a crucial strategic decision: is it more efficient to suffer the slowdown from an imbalanced load, or to pay the overhead cost of repartitioning the grid to rebalance the work?",
            "id": "3094958",
            "problem": "Consider a one-dimensional domain decomposed uniformly across $P$ identical processors running in the Bulk Synchronous Parallel (BSP) model, where each time step is dominated by the slowest processor. The base mesh has $n_b$ cells per processor, and the time to update one cell for one time step is $c$ seconds, so if a processor holds $N$ cells in a step, it takes $cN$ seconds. An Adaptive Mesh Refinement (AMR) region increases the local cell density by a factor $q1$ wherever it resides. While the AMR region resides entirely within a given processor's subdomain, it stays there for exactly $T_s$ consecutive time steps before moving to the next processor's subdomain. Assume the AMR region is small enough to be fully contained in a single subdomain during those $T_s$ steps, and that outside the AMR region the mesh remains at the base resolution.\n\nAt the instant the AMR region enters a new processor's subdomain, you may either keep the current (static) partitioning or invoke repartitioning to perfectly balance the total number of cells across processors for the next $T_s$ steps. If you do not repartition, then during those $T_s$ steps the processor that contains the AMR region holds $qn_b$ cells while every other processor holds $n_b$ cells, and the wall time per step equals $c$ times the maximum cell count across processors that step. If you do repartition, you pay a one-time repartitioning cost $C_r$ at the beginning of those $T_s$ steps, and then each processor holds exactly its equal share of the total cells for each of the $T_s$ steps. The one-time repartitioning cost is modeled as $C_r=C_0+\\alpha N_{\\text{mig}}$, where $C_0$ is a fixed overhead, $\\alpha$ is the time per migrated cell, and $N_{\\text{mig}}$ is the number of cells that must be migrated off the processor that initially contains the AMR region to achieve perfect balance.\n\nUsing only the BSP timing model and linear per-cell cost, derive from first principles the minimal integer $T_{\\star}$ such that invoking repartitioning at the entry of the AMR region yields a strictly smaller total wall time over those $T_s$ steps than not repartitioning. Then evaluate $T_{\\star}$ for the following parameters: $P=8$, $n_b=1.0\\times 10^{6}$ cells, $c=2.0\\times 10^{-8}$ s/cell/step, $q=5$, $C_0=0.40$ s, and $\\alpha=1.0\\times 10^{-7}$ s/cell. Report $T_{\\star}$ as an integer number of time steps (no units). Do not round; give the exact integer.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   Number of processors: $P$\n-   Parallel model: Bulk Synchronous Parallel (BSP), step time is determined by the slowest processor.\n-   Base number of cells per processor: $n_b$\n-   Time to update one cell for one step: $c$\n-   AMR refinement factor: $q > 1$\n-   Duration of AMR region in one subdomain: $T_s$ steps\n-   Scenario 1 (No Repartitioning):\n    -   Cells on processor with AMR: $qn_b$\n    -   Cells on other processors: $n_b$\n    -   Wall time per step: $c \\times (\\text{maximum cell count})$\n-   Scenario 2 (Repartitioning):\n    -   One-time cost at the start of $T_s$ steps: $C_r = C_0 + \\alpha N_{\\text{mig}}$\n    -   After repartitioning, all processors have an equal share of the total cells.\n    -   $C_0$: fixed overhead cost.\n    -   $\\alpha$: time per migrated cell.\n    -   $N_{\\text{mig}}$: number of cells migrated from the processor initially containing the AMR region to achieve perfect balance.\n-   Objective: Find the minimal integer $T_{\\star}$ such that repartitioning is strictly more time-efficient than not repartitioning over $T_s$ steps.\n-   Parameters for evaluation: $P=8$, $n_b=1.0 \\times 10^6$, $c=2.0 \\times 10^{-8}$ s/cell/step, $q=5$, $C_0=0.40$ s, $\\alpha=1.0 \\times 10^{-7}$ s/cell.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the domain of parallel performance modeling for computational science. The BSP model is a standard theoretical framework, and the linear cost models for computation ($cN$) and data migration ($C_0 + \\alpha N_{\\text{mig}}$) are common and valid abstractions. The problem is well-posed, providing all necessary variables and relationships to derive a unique solution. The language is objective and precise. The problem is a standard crossover-point analysis, which is neither trivial nor ill-posed. All parameters provided are physically reasonable for a high-performance computing context.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A full, reasoned solution will be provided.\n\n### Solution Derivation\nThe goal is to find the minimum integer number of steps, $T_{\\star}$, for which the total wall time with repartitioning ($W_{\\text{repart}}$) is strictly less than the total wall time without repartitioning ($W_{\\text{no-repart}}$) over a period of $T_s$ steps. The condition is:\n$$W_{\\text{repart}}  W_{\\text{no-repart}}$$\n\nFirst, we derive the expression for $W_{\\text{no-repart}}$.\nIn this scenario, one processor holds $qn_b$ cells and the other $P-1$ processors each hold $n_b$ cells. According to the BSP model, the time for each step is dictated by the slowest processor. Since $q > 1$, the processor with $qn_b$ cells is the slowest.\nThe time for a single step is $t_{\\text{step, no-repart}} = c \\times (qn_b)$.\nOver $T_s$ steps, the total wall time is:\n$$W_{\\text{no-repart}} = T_s \\cdot t_{\\text{step, no-repart}} = T_s c q n_b$$\n\nNext, we derive the expression for $W_{\\text{repart}}$.\nThis consists of a one-time repartitioning cost, $C_r$, plus the computational time over $T_s$ steps with a balanced load.\n$$W_{\\text{repart}} = C_r + T_s \\cdot t_{\\text{step, repart}}$$\n\nTo find the time per step with a balanced load, $t_{\\text{step, repart}}$, we first need the total number of cells in the simulation, $N_{\\text{total}}$.\n$$N_{\\text{total}} = (qn_b) + (P-1)n_b = (q + P - 1)n_b$$\nAfter perfect repartitioning, each of the $P$ processors holds an equal number of cells, $N_{\\text{bal}}$.\n$$N_{\\text{bal}} = \\frac{N_{\\text{total}}}{P} = \\frac{(q + P - 1)n_b}{P}$$\nThe time for a single step with a balanced load is then:\n$$t_{\\text{step, repart}} = c N_{\\text{bal}} = c \\frac{(q + P - 1)n_b}{P}$$\n\nNow, we must find the repartitioning cost, $C_r = C_0 + \\alpha N_{\\text{mig}}$. The number of migrated cells, $N_{\\text{mig}}$, is the number of cells that must be moved off the initially overloaded processor to reach the balanced state.\n$$N_{\\text{mig}} = (\\text{initial cells}) - (\\text{final cells}) = qn_b - N_{\\text{bal}}$$\n$$N_{\\text{mig}} = qn_b - \\frac{(q + P - 1)n_b}{P} = n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\n$$N_{\\text{mig}} = n_b \\left( \\frac{Pq - q - P + 1}{P} \\right) = n_b \\frac{(P-1)(q-1)}{P}$$\nSubstituting this into the expression for $C_r$:\n$$C_r = C_0 + \\alpha \\left( n_b \\frac{(P-1)(q-1)}{P} \\right)$$\n\nWe can now assemble the complete expression for $W_{\\text{repart}}$:\n$$W_{\\text{repart}} = C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c \\frac{(q + P - 1)n_b}{P}$$\n\nNow, we solve the inequality $W_{\\text{repart}}  W_{\\text{no-repart}}$ for $T_s$:\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c n_b \\frac{q + P - 1}{P}  T_s c q n_b$$\nTo isolate $T_s$, we group the terms containing $T_s$:\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s \\left( c q n_b - c n_b \\frac{q + P - 1}{P} \\right)$$\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\nThe term in the parenthesis on the right side is the same one encountered when calculating $N_{\\text{mig}}$:\n$$q - \\frac{q + P - 1}{P} = \\frac{(P-1)(q-1)}{P}$$\nThe inequality becomes:\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\frac{(P-1)(q-1)}{P}$$\nSolving for $T_s$:\n$$T_s  \\frac{C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\nWe can separate the fraction into two terms:\n$$T_s  \\frac{C_0}{c n_b \\frac{(P-1)(q-1)}{P}} + \\frac{\\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\n$$T_s  \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$$\nThe problem asks for the minimal integer $T_s$, which we call $T_{\\star}$, that satisfies this strict inequality. If we define the right-hand side as $V$, so $T_s  V$, the minimal integer value for $T_s$ is $\\lfloor V \\rfloor + 1$.\n$$T_{\\star} = \\left\\lfloor \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c} \\right\\rfloor + 1$$\n\n### Numerical Evaluation\nWe now substitute the given parameters into this derived expression:\n-   $P=8$\n-   $n_b=1.0 \\times 10^{6}$\n-   $c=2.0 \\times 10^{-8}$\n-   $q=5$\n-   $C_0=0.40$\n-   $\\alpha=1.0 \\times 10^{-7}$\n\nLet's calculate the value of the expression $V = \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$.\n\nThe second term is:\n$$\\frac{\\alpha}{c} = \\frac{1.0 \\times 10^{-7}}{2.0 \\times 10^{-8}} = 5$$\n\nThe first term is:\n$$\\frac{P C_0}{c n_b (P-1)(q-1)} = \\frac{8 \\times 0.40}{(2.0 \\times 10^{-8})(1.0 \\times 10^{6})(8-1)(5-1)}$$\n$$\\frac{3.2}{(2.0 \\times 10^{-2})(7)(4)} = \\frac{3.2}{(0.02)(28)} = \\frac{3.2}{0.56}$$\n$$\\frac{3.2}{0.56} = \\frac{320}{56} = \\frac{40 \\times 8}{7 \\times 8} = \\frac{40}{7}$$\n\nNow, we combine the terms to find $V$:\n$$V = \\frac{40}{7} + 5 = \\frac{40}{7} + \\frac{35}{7} = \\frac{75}{7}$$\nIn decimal form, $V \\approx 10.714$.\n\nFinally, we calculate $T_{\\star}$:\n$$T_{\\star} = \\left\\lfloor \\frac{75}{7} \\right\\rfloor + 1 = \\lfloor 10.714... \\rfloor + 1 = 10 + 1 = 11$$\n\nThe minimal integer number of steps for which repartitioning becomes strictly more advantageous is $11$.",
            "answer": "$$\\boxed{11}$$"
        }
    ]
}