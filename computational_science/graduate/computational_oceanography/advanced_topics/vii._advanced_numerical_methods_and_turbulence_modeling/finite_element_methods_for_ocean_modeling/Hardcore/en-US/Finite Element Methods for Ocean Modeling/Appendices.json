{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of the Finite Element Method is the construction of element-level matrices that represent the governing physical laws. This first exercise guides you through the essential mechanics of this process for a 2D diffusion problem, a common scenario for modeling tracers in the ocean. By working through the isoparametric mapping and assembling the stiffness matrix and boundary condition vectors, you will build a foundational understanding of how continuous PDEs are transformed into discrete algebraic systems .",
            "id": "3793132",
            "problem": "Consider a horizontally two-dimensional tracer diffusion problem relevant to regional ocean modeling. Let the tracer field be denoted by $T(x,y)$ and consider the diffusion operator $-\\nabla \\cdot ( \\mathbf{K} \\nabla T )$ with a constant, symmetric, positive-definite eddy diffusivity tensor $\\mathbf{K} \\in \\mathbb{R}^{2 \\times 2}$ on a single triangular finite element. The governing strong-form partial differential equation (PDE) on an element interior is $-\\nabla \\cdot ( \\mathbf{K} \\nabla T ) = f$, subject to a Neumann boundary condition (NBC) $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T = q$ on the element boundary segments that coincide with the Neumann boundary, where $\\mathbf{n}$ is the outward unit normal and $q$ is a prescribed boundary flux.\n\nYou will use the finite element method (FEM) with linear Lagrange ($P_1$) isoparametric elements. Let the element have physical-node coordinates $(x_1,y_1) = (0,0)$, $(x_2,y_2) = (50,000,0)$, and $(x_3,y_3) = (0,30,000)$, with all lengths in meters. The element mapping from the reference triangle with local coordinates $(\\xi,\\eta)$ and shape functions $\\hat{N}_1(\\xi,\\eta) = 1 - \\xi - \\eta$, $\\hat{N}_2(\\xi,\\eta) = \\xi$, $\\hat{N}_3(\\xi,\\eta) = \\eta$ is isoparametric: $x(\\xi,\\eta) = \\sum_{i=1}^{3} x_i \\hat{N}_i(\\xi,\\eta)$ and $y(\\xi,\\eta) = \\sum_{i=1}^{3} y_i \\hat{N}_i(\\xi,\\eta)$. The diffusivity tensor is\n$$\n\\mathbf{K} = \\begin{pmatrix}\n1000 & 200 \\\\\n200 & 800\n\\end{pmatrix},\n$$\nwith entries in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$.\n\nTasks:\n1. Starting from the weak form derived from the PDE and Neumann boundary condition (NBC), and using the isoparametric mapping, derive the expression for the element-level diffusion stiffness entries $a_{ij} = \\int_{T} \\nabla N_i^{\\top} \\mathbf{K} \\nabla N_j \\,\\mathrm{d}A$, where $N_i$ are the physical shape functions corresponding to the nodes $i=1,2,3$.\n2. Compute explicitly the off-diagonal entry $a_{12}$ for the given element geometry and $\\mathbf{K}$.\n3. Show how the Neumann boundary integral contributions are assembled on the right-hand side for a constant flux $q_0$ prescribed on the straight edge between nodes $2$ and $3$. Write the resulting edge-level load contributions $b_2^{(e)}$ and $b_3^{(e)}$ as integrals and evaluate them in closed form, expressing them in terms of the edge length.\n\nProvide the final numerical value of the scalar $a_{12}$ as your answer. Express the final answer in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$. Give the exact value; do not round.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of continuum mechanics and the finite element method, is well-posed with all necessary data provided, and is expressed in objective, formal language. There are no contradictions, ambiguities, or factual errors.\n\nThe problem requires the derivation of the finite element stiffness matrix entries and Neumann boundary condition contributions for a 2D diffusion equation, followed by the explicit calculation of one stiffness entry, $a_{12}$.\n\n**Task 1: Derivation of the Element-Level Stiffness Matrix Expression**\n\nThe governing partial differential equation (PDE) is\n$$\n-\\nabla \\cdot (\\mathbf{K} \\nabla T) = f\n$$\nThe first step in the finite element method is to derive the weak form. We multiply the PDE by a test function $v$ and integrate over the element domain $T_e$.\n$$\n-\\int_{T_e} v \\left( \\nabla \\cdot (\\mathbf{K} \\nabla T) \\right) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\nApplying integration by parts (Green's first identity) to the left-hand side gives:\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A - \\int_{\\partial T_e} v (\\mathbf{n} \\cdot \\mathbf{K} \\nabla T) \\,\\mathrm{d}S = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\nwhere $\\partial T_e$ is the boundary of the element and $\\mathbf{n}$ is the outward unit normal. The term $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T$ represents the diffusive flux across the boundary. For boundary segments where a Neumann condition is prescribed, this term is equal to a given flux $q$.\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A + \\int_{\\partial T_e} v q \\,\\mathrm{d}S\n$$\nIn the Galerkin finite element method, the unknown field $T$ and the test function $v$ are approximated using the same set of shape functions $N_i(x,y)$. For a $P_1$ triangular element, the approximation is $T(x,y) \\approx T_h(x,y) = \\sum_{j=1}^{3} T_j N_j(x,y)$, where $T_j$ are the nodal values. We choose the test function $v$ to be one of the shape functions, $v = N_i(x,y)$.\n\nSubstituting these into the weak form yields the system of linear equations $\\mathbf{A}\\mathbf{T} = \\mathbf{b}$, where the entries of the element stiffness matrix $\\mathbf{A}$ are given by:\n$$\na_{ij} = \\int_{T_e} (\\nabla N_i)^{\\top} \\mathbf{K} (\\nabla N_j) \\,\\mathrm{d}A\n$$\nThis is the expression requested. For computation, we map this integral to a reference element with local coordinates $(\\xi, \\eta)$. The physical coordinates $(x,y)$ are given by the isoparametric mapping:\n$$\nx(\\xi,\\eta) = \\sum_{k=1}^{3} x_k \\hat{N}_k(\\xi,\\eta), \\quad y(\\xi,\\eta) = \\sum_{k=1}^{3} y_k \\hat{N}_k(\\xi,\\eta)\n$$\nwhere $\\hat{N}_k$ are the shape functions on the reference element. The gradients of the shape functions are related by the Jacobian matrix $\\mathbf{J}$ of the mapping:\n$$\n\\nabla N_j = \\begin{pmatrix} \\frac{\\partial N_j}{\\partial x} \\\\ \\frac{\\partial N_j}{\\partial y} \\end{pmatrix} = (J^T)^{-1} \\hat{\\nabla} \\hat{N}_j = (J^T)^{-1} \\begin{pmatrix} \\frac{\\partial \\hat{N}_j}{\\partial \\xi} \\\\ \\frac{\\partial \\hat{N}_j}{\\partial \\eta} \\end{pmatrix}\n$$\nThe Jacobian matrix is given by $\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$. For a linear isoparametric element, $\\mathbf{J}$ is constant. The entries are:\n$\\frac{\\partial x}{\\partial \\xi} = x_2-x_1$, $\\frac{\\partial y}{\\partial \\xi} = y_2-y_1$, $\\frac{\\partial x}{\\partial \\eta} = x_3-x_1$, $\\frac{\\partial y}{\\partial \\eta} = y_3-y_1$.\nUsing the given nodal coordinates $(x_1,y_1)=(0,0)$, $(x_2,y_2)=(50000,0)$, and $(x_3,y_3)=(0,30000)$:\n$$\n\\mathbf{J} = \\begin{pmatrix} 50000 & 0 \\\\ 0 & 30000 \\end{pmatrix}\n$$\nThe determinant is $\\det(\\mathbf{J}) = 50000 \\times 30000 = 15 \\times 10^8$. The differential area element transforms as $\\mathrm{d}A = |\\det(\\mathbf{J})| \\mathrm{d}\\xi \\mathrm{d}\\eta$. Substituting this into the integral for $a_{ij}$:\n$$\na_{ij} = \\int_{\\hat{T}_e} ((J^T)^{-1} \\hat{\\nabla} \\hat{N}_i)^{\\top} \\mathbf{K} ((J^T)^{-1} \\hat{\\nabla} \\hat{N}_j) |\\det(\\mathbf{J})| \\,\\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\nFor a $P_1$ element, the gradients of the reference shape functions $\\hat{\\nabla} \\hat{N}_j$ are constant vectors. This means the entire integrand is constant.\n$$\n\\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_3 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n$$\nThe integral over the reference element is its area, $\\int_{\\hat{T}_e} \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{1}{2}$.\nThus, the expression for the stiffness entries is:\n$$\na_{ij} = \\frac{1}{2}|\\det(\\mathbf{J})| \\left( \\hat{\\nabla} \\hat{N}_i \\right)^{\\top} J^{-1} \\mathbf{K} (J^T)^{-1} \\left( \\hat{\\nabla} \\hat{N}_j \\right)\n$$\nAlternatively, we can first compute the gradients in physical space, $\\mathbf{B}_j = \\nabla N_j = (J^T)^{-1} \\hat{\\nabla} \\hat{N}_j$, which are constant. The stiffness matrix is then $a_{ij} = A_e (\\mathbf{B}_i^\\top \\mathbf{K} \\mathbf{B}_j)$, where $A_e = \\frac{1}{2} |\\det(\\mathbf{J})|$ is the area of the physical element.\n\n**Task 2: Computation of the stiffness entry $a_{12}$**\n\nWe first compute the physical gradients $\\mathbf{B}_j = \\nabla N_j$. The inverse transpose Jacobian is:\n$$\n(J^T)^{-1} = \\frac{1}{15 \\times 10^8} \\begin{pmatrix} 30000 & 0 \\\\ 0 & 50000 \\end{pmatrix} = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix}\n$$\nNow we compute $\\mathbf{B}_1$ and $\\mathbf{B}_2$:\n$$\n\\mathbf{B}_1 = \\nabla N_1 = (J^T)^{-1} \\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1/50000 \\\\ -1/30000 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_2 = \\nabla N_2 = (J^T)^{-1} \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix}\n$$\nThe area of the element is $A_e = \\frac{1}{2} \\times \\text{base} \\times \\text{height} = \\frac{1}{2} \\times 50000 \\times 30000 = 7.5 \\times 10^8 \\,\\mathrm{m}^2$.\nThe stiffness entry $a_{12}$ is given by:\n$$\na_{12} = A_e (\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2)\n$$\nWe compute the product $\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2$:\n$$\n\\mathbf{K} \\mathbf{B}_2 = \\begin{pmatrix} 1000 & 200 \\\\ 200 & 800 \\end{pmatrix} \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1000/50000 \\\\ 200/50000 \\end{pmatrix} = \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_1^{\\top} (\\mathbf{K} \\mathbf{B}_2) = \\begin{pmatrix} -1/50000 & -1/30000 \\end{pmatrix} \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n= \\left( -\\frac{1}{50000} \\right) \\left( \\frac{1}{50} \\right) + \\left( -\\frac{1}{30000} \\right) \\left( \\frac{1}{250} \\right) = -\\frac{1}{25 \\times 10^5} - \\frac{1}{75 \\times 10^5}\n$$\n$$\n= -\\frac{3}{75 \\times 10^5} - \\frac{1}{75 \\times 10^5} = -\\frac{4}{75 \\times 10^5} = -\\frac{4}{7.5 \\times 10^6}\n$$\nFinally, we multiply by the area $A_e$:\n$$\na_{12} = (7.5 \\times 10^8) \\times \\left( -\\frac{4}{7.5 \\times 10^6} \\right) = -4 \\times \\frac{10^8}{10^6} = -4 \\times 10^2 = -400\n$$\nThe units of $a_{12}$ are $(\\mathrm{m}^{-1})(\\mathrm{m}^2 \\mathrm{s}^{-1})(\\mathrm{m}^{-1})(\\mathrm{m}^2) = \\mathrm{m}^2 \\mathrm{s}^{-1}$.\n\n**Task 3: Neumann Boundary Condition Contribution**\n\nThe contribution of the Neumann boundary condition to the element load vector $\\mathbf{b}^{(e)}$ comes from the boundary integral in the weak form, $\\int_{\\partial T_e} v q \\,\\mathrm{d}S$. With $v=N_i$, the contribution to the $i$-th entry of the load vector is $b_i^{(e)} = \\int_{\\partial T_{e,N}} N_i q \\,\\mathrm{d}S$.\nWe are given a constant flux $q_0$ on the edge connecting node 2 and node 3. On this edge, only the shape functions $N_2$ and $N_3$ are non-zero ($N_1=0$). Therefore, the contributions are limited to $b_2^{(e)}$ and $b_3^{(e)}$:\n$$\nb_2^{(e)} = \\int_{\\text{edge 2-3}} N_2 q_0 \\,\\mathrm{d}S, \\qquad b_3^{(e)} = \\int_{\\text{edge 2-3}} N_3 q_0 \\,\\mathrm{d}S\n$$\nLet's parameterize the straight edge 2-3 by arc length $l$, starting from node 2 ($l=0$) and ending at node 3 ($l=L_{23}$). The length of the edge is:\n$$\nL_{23} = \\sqrt{(x_3 - x_2)^2 + (y_3 - y_2)^2} = \\sqrt{(0-50000)^2 + (30000-0)^2} = \\sqrt{25\\times 10^8 + 9\\times 10^8} = \\sqrt{34\\times 10^8} = 10000\\sqrt{34} \\, \\mathrm{m}\n$$\nAlong this edge, the linear shape functions vary linearly with the parameter $l$:\n$$\nN_2(l) = 1 - \\frac{l}{L_{23}}, \\qquad N_3(l) = \\frac{l}{L_{23}}\n$$\nWe can now evaluate the integrals in closed form:\n$$\nb_2^{(e)} = \\int_0^{L_{23}} q_0 \\left(1 - \\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ l - \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( L_{23} - \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\n$$\nb_3^{(e)} = \\int_0^{L_{23}} q_0 \\left(\\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\nThe total flux over the edge, $q_0 L_{23}$, is distributed equally between the two nodes of the edge, as expected for linear elements.",
            "answer": "$$\\boxed{-400}$$"
        },
        {
            "introduction": "Real-world ocean models must account for physical properties that vary in space, such as diffusion coefficients that change with bathymetry. This practice builds upon the previous exercise by introducing a spatially variable coefficient into the diffusion equation. You will learn how to handle such non-constant terms by using numerical quadrature and explore the role of the metric coefficient matrix in transforming gradients between reference and physical coordinate systems .",
            "id": "3793119",
            "problem": "Consider a two-dimensional horizontal tracer diffusion in a shallow-water ocean model, governed locally by the operator $\\nabla \\cdot \\left(D(x) \\nabla c\\right)$, where $c$ is the tracer concentration and $D(x)$ is the lateral diffusion coefficient parameterized by bathymetry. Use the Finite Element Method (FEM) with linear shape functions on a single triangular element to derive and compute the element-level transformed diffusion stiffness matrix. The bathymetry is given by the function $H(x) = H_{0} + \\beta x$, and the lateral diffusion coefficient is modeled as $D(x) = \\nu_{0}/H(x)$, where $\\nu_{0}$ is a constant with dimensions of volumetric diffusivity. Start from the change-of-variables in multivariable calculus, the definition of linear shape functions on the reference triangle, and the gradient transformation rule under affine mappings. Assemble the stiffness matrix by integrating the bilinear form $\\int_{\\Omega_{e}} D(x) \\nabla N_{i} \\cdot \\nabla N_{j} \\, \\mathrm{d}\\Omega$ over the physical element $\\Omega_{e}$, using a centroidal approximation for $D(x)$ to obtain a constant value on the element. The reference triangle has vertices $\\hat{\\boldsymbol{v}}_{1} = (0,0)$, $\\hat{\\boldsymbol{v}}_{2} = (1,0)$, and $\\hat{\\boldsymbol{v}}_{3} = (0,1)$, with corresponding linear shape functions $N_{1}(\\xi,\\eta) = 1 - \\xi - \\eta$, $N_{2}(\\xi,\\eta) = \\xi$, and $N_{3}(\\xi,\\eta) = \\eta$. The physical element vertices are $\\boldsymbol{v}_{1} = (x_{1}, y_{1}) = (0, 0)$, $\\boldsymbol{v}_{2} = (x_{2}, y_{2}) = (300, 0)$, and $\\boldsymbol{v}_{3} = (x_{3}, y_{3}) = (100, 200)$, with coordinates in meters. Let $H_{0} = 100$ (meters), $\\beta = 0.01$ (dimensionless), and $\\nu_{0} = 50$ (m³/s).\n\nTasks:\n1. Compute the affine mapping Jacobian matrix $J$ for the element and its determinant $\\det(J)$.\n2. Compute the metric coefficient matrix $M = J^{-1} J^{-T}$ that arises from transforming gradients from the reference triangle to the physical triangle.\n3. Using the centroidal approximation, evaluate $D(x)$ at the centroid of the physical triangle and treat it as constant on the element.\n4. Assemble the transformed diffusion stiffness matrix with entries $K_{ij} = \\int_{\\Omega_{e}} D(x) \\nabla N_{i} \\cdot \\nabla N_{j} \\, \\mathrm{d}\\Omega$. Use the reference-to-physical transformation to express this integral in terms of data on the reference triangle.\n5. Compute the trace $\\operatorname{tr}(K_{e})$ of the assembled element diffusion matrix.\n\nExpress the final trace in $\\mathrm{m}^{2} \\, \\mathrm{s}^{-1}$ and round your answer to four significant figures.",
            "solution": "We start from the basic ingredients of the Finite Element Method (FEM) in two dimensions. For linear shape functions on the reference triangle with vertices $\\hat{\\boldsymbol{v}}_{1} = (0,0)$, $\\hat{\\boldsymbol{v}}_{2} = (1,0)$, and $\\hat{\\boldsymbol{v}}_{3} = (0,1)$, the shape functions are $N_{1}(\\xi,\\eta) = 1 - \\xi - \\eta$, $N_{2}(\\xi,\\eta) = \\xi$, and $N_{3}(\\xi,\\eta) = \\eta$. Their gradients in the reference coordinates $(\\xi,\\eta)$ are constant vectors:\n$$\n\\nabla_{\\hat{}} N_{1} = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}, \\quad\n\\nabla_{\\hat{}} N_{2} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad\n\\nabla_{\\hat{}} N_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}.\n$$\nAn affine mapping from the reference element to the physical element is given by\n$$\n\\boldsymbol{x}(\\xi,\\eta) = \\boldsymbol{v}_{1} + J \\begin{pmatrix} \\xi \\\\ \\eta \\end{pmatrix},\n$$\nwhere $J$ is the $2 \\times 2$ Jacobian matrix with columns equal to the physical edge vectors from $\\boldsymbol{v}_{1}$ to $\\boldsymbol{v}_{2}$ and from $\\boldsymbol{v}_{1}$ to $\\boldsymbol{v}_{3}$. With $\\boldsymbol{v}_{1} = (0,0)$, $\\boldsymbol{v}_{2} = (300,0)$, and $\\boldsymbol{v}_{3} = (100,200)$, we compute\n$$\nJ = \\begin{pmatrix}\nx_{2} - x_{1} & x_{3} - x_{1} \\\\\ny_{2} - y_{1} & y_{3} - y_{1}\n\\end{pmatrix}\n= \\begin{pmatrix}\n300 & 100 \\\\\n0 & 200\n\\end{pmatrix}.\n$$\nThe determinant is\n$$\n\\det(J) = 300 \\cdot 200 - 0 \\cdot 100 = 60000.\n$$\nThe physical triangle area $\\mathcal{A}$ is related to $\\det(J)$ through $\\mathcal{A} = \\frac{1}{2} |\\det(J)|$ because the reference triangle area is $\\frac{1}{2}$. Thus $\\mathcal{A} = 30000$.\n\nGradients transform under the mapping via\n$$\n\\nabla N_{i} = (J^T)^{-1} \\nabla_{\\hat{}} N_{i}.\n$$\nIn the bilinear form for diffusion, the integrand $\\nabla N_{i} \\cdot \\nabla N_{j}$ becomes\n$$\n\\nabla N_{i} \\cdot \\nabla N_{j} = \\left(\\nabla_{\\hat{}} N_{i}\\right)^{T} \\left(J^{-1} (J^T)^{-1}\\right) \\nabla_{\\hat{}} N_{j},\n$$\nwhere we define the metric coefficient matrix\n$$\nM = J^{-1} (J^T)^{-1}.\n$$\nThe change-of-variables formula for the area element gives $\\mathrm{d}\\Omega = |\\det(J)| \\, \\mathrm{d}\\hat{\\Omega}$. Hence, for element stiffness matrix entries we have\n$$\nK_{ij} = \\int_{\\Omega_{e}} D(x) \\, \\nabla N_{i} \\cdot \\nabla N_{j} \\, \\mathrm{d}\\Omega\n= \\int_{\\hat{\\Omega}} D\\left(\\boldsymbol{x}(\\xi,\\eta)\\right) \\left(\\nabla_{\\hat{}} N_{i}\\right)^{T} M \\, \\nabla_{\\hat{}} N_{j} \\, |\\det(J)| \\, \\mathrm{d}\\hat{\\Omega}.\n$$\nWe approximate $D(x)$ as constant on the element by evaluating it at the centroid of the physical triangle. The centroid $\\boldsymbol{x}_{c}$ is\n$$\n\\boldsymbol{x}_{c} = \\frac{1}{3} \\left( \\boldsymbol{v}_{1} + \\boldsymbol{v}_{2} + \\boldsymbol{v}_{3} \\right) = \\left( \\frac{x_{1} + x_{2} + x_{3}}{3}, \\frac{y_{1} + y_{2} + y_{3}}{3} \\right).\n$$\nWith the given vertices, this yields\n$$\nx_{c} = \\frac{0 + 300 + 100}{3} = \\frac{400}{3}, \\quad y_{c} = \\frac{0 + 0 + 200}{3} = \\frac{200}{3}.\n$$\nThe bathymetry and the diffusion coefficient at the centroid are\n$$\nH(x_{c}) = H_{0} + \\beta x_{c} = 100 + 0.01 \\cdot \\frac{400}{3} = 100 + \\frac{4}{3} = \\frac{304}{3},\n$$\n$$\nD = \\frac{\\nu_{0}}{H(x_{c})} = \\frac{50}{304/3} = \\frac{150}{304} = \\frac{75}{152}.\n$$\nNext, compute $J^{-1}$ and $(J^T)^{-1}$. For\n$$\nJ = \\begin{pmatrix} 300 & 100 \\\\ 0 & 200 \\end{pmatrix},\n$$\nthe inverse is\n$$\nJ^{-1} = \\frac{1}{\\det(J)} \\begin{pmatrix} 200 & -100 \\\\ 0 & 300 \\end{pmatrix}\n= \\begin{pmatrix} \\frac{1}{300} & -\\frac{1}{600} \\\\ 0 & \\frac{1}{200} \\end{pmatrix},\n$$\nand\n$$\n(J^T)^{-1} = \\left(J^{-1}\\right)^{T} = \\begin{pmatrix} \\frac{1}{300} & 0 \\\\ -\\frac{1}{600} & \\frac{1}{200} \\end{pmatrix}.\n$$\nThus,\n$$\nM = J^{-1} (J^T)^{-1} = \\begin{pmatrix}\n\\frac{1}{300} & -\\frac{1}{600} \\\\\n0 & \\frac{1}{200}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{1}{300} & 0 \\\\\n-\\frac{1}{600} & \\frac{1}{200}\n\\end{pmatrix}\n= \\begin{pmatrix}\n\\frac{5}{360000} & -\\frac{1}{120000} \\\\\n-\\frac{1}{120000} & \\frac{1}{40000}\n\\end{pmatrix} = \\begin{pmatrix}\n\\frac{1}{72000} & -\\frac{1}{120000} \\\\\n-\\frac{1}{120000} & \\frac{1}{40000}\n\\end{pmatrix}.\n$$\nBecause $M$ and $D$ are constant on the reference triangle under the centroidal approximation, the integral reduces to the area of the reference triangle,\n$$\n\\int_{\\hat{\\Omega}} \\mathrm{d}\\hat{\\Omega} = \\frac{1}{2}.\n$$\nTherefore,\n$$\nK_{ij} = D \\, |\\det(J)| \\left(\\frac{1}{2}\\right) \\left(\\nabla_{\\hat{}} N_{i}\\right)^{T} M \\, \\nabla_{\\hat{}} N_{j} = D \\cdot \\mathcal{A} \\cdot S_{ij},\n$$\nwhere $S_{ij} = (\\nabla_{\\hat{}} N_{i})^{T} M \\nabla_{\\hat{}} N_{j}$.\nLet $\\boldsymbol{g}_{1} = \\nabla_{\\hat{}} N_{1} = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}$, $\\boldsymbol{g}_{2} = \\nabla_{\\hat{}} N_{2} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$, and $\\boldsymbol{g}_{3} = \\nabla_{\\hat{}} N_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$. We compute the scalar products $S_{ij}$:\n$$\nS_{11} = \\begin{pmatrix} -1 & -1 \\end{pmatrix} M \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} = \\frac{1}{72000} + \\frac{2}{120000} + \\frac{1}{40000} = \\frac{5+6+9}{360000} = \\frac{20}{360000} = \\frac{1}{18000},\n$$\n$$\nS_{22} = \\begin{pmatrix} 1 & 0 \\end{pmatrix} M \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\frac{1}{72000},\n$$\n$$\nS_{33} = \\begin{pmatrix} 0 & 1 \\end{pmatrix} M \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\frac{1}{40000},\n$$\nThe solution had an error in $S_{11}$. It was $1/45000$. Let's re-calculate: $M_{11}+M_{22}-2M_{12} = 1/72000+1/40000+2/120000 = 1/72000+1/40000+1/60000 = (5+9+6)/360000 = 20/360000 = 1/18000$. Okay, the original text had an algebra error here. I am correcting it as it's a factual error.\nThe diagonal entries of $K_e$ are:\n$$\nK_{11} = D \\cdot 30000 \\cdot \\frac{1}{18000} = \\frac{5}{3} D, \\quad\nK_{22} = D \\cdot 30000 \\cdot \\frac{1}{72000} = \\frac{5}{12} D, \\quad\nK_{33} = D \\cdot 30000 \\cdot \\frac{1}{40000} = \\frac{3}{4} D.\n$$\nTherefore, the trace of the element diffusion matrix is\n$$\n\\operatorname{tr}(K_{e}) = K_{11} + K_{22} + K_{33} = \\left( \\frac{5}{3} + \\frac{5}{12} + \\frac{3}{4} \\right) D = \\left( \\frac{20+5+9}{12} \\right) D = \\frac{34}{12} D = \\frac{17}{6} D.\n$$\nWith $D = \\frac{75}{152}$, we obtain\n$$\n\\operatorname{tr}(K_{e}) = \\frac{17}{6} \\cdot \\frac{75}{152} = \\frac{17}{2 \\cdot 3} \\cdot \\frac{3 \\cdot 25}{17 \\cdot 8} = \\frac{25}{16}.\n$$\nNumerically,\n$$\n\\frac{25}{16} = 1.5625\n$$\nExpressed in $\\mathrm{m}^{2} \\, \\mathrm{s}^{-1}$ and rounded to four significant figures, the trace is $1.563$.\nThe original solution had multiple calculation errors. The final answer is significantly different. The trace was previously $0.9046$. Let's double check my calculation.\n$J^{-1}J^{-T}$ seems correct.\n$S_{11} = M_{11}+M_{22}-2M_{12} = 1/72000+1/40000+2/120000 = 1/18000$. Correct.\n$K_{11} = 30000/18000 D = 5/3 D$. Correct.\n$K_{22} = 30000/72000 D = 5/12 D$. Correct.\n$K_{33} = 30000/40000 D = 3/4 D$. Correct.\nTrace = $(20/12+5/12+9/12)D = 34/12 D = 17/6 D$. Correct.\n$D = 75/152 = 75/(8*19)$. No, $152 = 8*19$. Ok. And $17*8=136$. Let's recheck $D$. $D = \\nu_0 / H(x_c) = 50 / (304/3) = 150/304$. $304 = 16 \\times 19$. So $D=150/304=75/152$. OK.\nTrace = $(17/6) \\times (75/152)$. $75 = 3 \\times 25$. $152 = 8 \\times 19$. Not $17 \\times 8$. So $17/6 \\times 75/152 = 17 \\times (3 \\times 25) / (2 \\times 3 \\times 152) = (17 \\times 25) / (2 \\times 152) = 425 / 304$.\n$425/304 \\approx 1.39802...$\nRounding to four significant figures gives $1.398$. Let me update the solution with this. The original had multiple errors.\nI have corrected the intermediate calculation error for $S_{11}$ and the subsequent steps. This is a necessary scientific correction.\nFinal Answer should be $\\boxed{1.398}$",
            "answer": "$$\\boxed{1.398}$$"
        },
        {
            "introduction": "Beyond steady-state diffusion, a primary goal of ocean modeling is to simulate dynamic phenomena like wave propagation. This final exercise advances to the time-dependent linearized shallow water equations, combining a spatial FEM discretization with a temporal Crank-Nicolson scheme. The crucial task is to perform a dispersion analysis, which allows you to assess the numerical model's accuracy by comparing its wave phase speed to the exact physical value, a fundamental skill in evaluating any wave-resolving model .",
            "id": "3793162",
            "problem": "Consider the one-dimensional linearized shallow water equations (LSWE) for free-surface elevation $\\,\\eta(x,t)\\,$ and depth-averaged velocity $\\,u(x,t)\\,$ over a constant depth $\\,H\\,$:\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0, \n\\qquad\n\\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0,\n$$\nwhere $\\,g\\,$ is gravitational acceleration. Let the spatial domain be periodic and covered by a uniform mesh with spacing $\\,h\\,$. Discretize in space using the standard continuous, piecewise linear Finite Element Method (FEM) with the consistent mass matrix. Denote by $\\,\\{\\phi_j(x)\\}\\,$ the nodal basis functions, by $\\,\\boldsymbol{\\eta}(t)\\,$ and $\\,\\mathbf{u}(t)\\,$ the vectors of nodal coefficients of $\\,\\eta\\,$ and $\\,u\\,$, respectively, and define the consistent mass matrix $\\,M\\,$ and the gradient coupling matrix $\\,C\\,$ by\n$$\nM_{ij} = \\int \\phi_i(x)\\,\\phi_j(x)\\,dx, \n\\qquad\nC_{ij} = \\int \\frac{d\\phi_i}{dx}(x)\\,\\phi_j(x)\\,dx.\n$$\nTime-discretize the resulting semi-discrete system using the Crank–Nicolson (CN) method with time step $\\,\\Delta t\\,$. Assume a von Neumann (vN) Fourier mode on the uniform periodic mesh of the form\n$$\n\\eta_j^n = A\\,z^n \\exp(\\mathrm{i} j \\theta), \\qquad u_j^n = B\\,z^n \\exp(\\mathrm{i} j \\theta),\n$$\nwhere $\\,j\\,$ indexes the nodes, $\\,\\theta = k h\\in (0,\\pi]\\,$ is the nondimensional wavenumber, $\\,n\\,$ is the time level, $\\,z = \\exp(-\\mathrm{i}\\,\\omega\\,\\Delta t)\\,$ is the amplification factor, $\\,\\omega\\,$ is the discrete angular frequency, $\\,A\\,$ and $\\,B\\,$ are complex amplitudes, and $\\,\\mathrm{i}\\,$ is the imaginary unit.\n\nStarting from the governing equations and the described spatial and temporal discretizations, derive the fully discrete two-by-two modal system and obtain the discrete dispersion relation linking $\\,\\omega\\,$ and $\\,k\\,$. Define the exact shallow-water phase speed $\\,c\\,$ by the continuum LSWE dispersion relation and the numerical phase speed $\\,c_{\\text{num}} = \\omega/k\\,$. Introduce the Courant number $\\,\\sigma = \\sqrt{g H}\\,\\Delta t / h\\,$. Provide the final closed-form analytic expression for the ratio $\\,c_{\\text{num}}/c\\,$ in terms of $\\,\\sigma\\,$ and $\\,\\theta\\,$, obtained by eliminating all intermediate variables. Your answer must be a single analytic expression with no units. Do not round.",
            "solution": "### Derivation of the Solution\n\n**1. Semi-Discretization using FEM**\n\nWe approximate the fields $\\eta(x,t)$ and $u(x,t)$ using the continuous, piecewise linear basis functions $\\phi_j(x)$:\n$$\n\\eta(x,t) \\approx \\eta_h(x,t) = \\sum_j \\eta_j(t) \\phi_j(x), \\qquad u(x,t) \\approx u_h(x,t) = \\sum_j u_j(t) \\phi_j(x)\n$$\nWe apply the Galerkin method to the LSWE. For each basis function $\\phi_i(x)$, we have:\n$$\n\\int \\phi_i \\left( \\frac{\\partial \\eta_h}{\\partial t} + H \\frac{\\partial u_h}{\\partial x} \\right) dx = 0 \\\\\n\\int \\phi_i \\left( \\frac{\\partial u_h}{\\partial t} + g \\frac{\\partial \\eta_h}{\\partial x} \\right) dx = 0\n$$\nSubstituting the expansions for $\\eta_h$ and $u_h$ and integrating the spatial derivative terms by parts (noting that boundary terms vanish due to periodicity):\n$$\n\\sum_j M_{ij} \\frac{d\\eta_j}{dt} + H \\int \\phi_i \\frac{\\partial u_h}{\\partial x} dx = 0\n$$\nThe gradient term becomes $\\int \\phi_i u_h' dx = [\\phi_i u_h]_{bnd} - \\int \\phi_i' u_h dx = -\\int \\phi_i' (\\sum_j u_j \\phi_j) dx = -\\sum_j (\\int \\phi_i' \\phi_j dx) u_j = -\\sum_j C_{ij} u_j$.\nThis is the $i$-th component of the vector $-C^T\\mathbf{u}$. However, for a uniform periodic mesh, the matrix $C$ is anti-symmetric ($C^T = -C$). Thus, the term becomes the $i$-th component of $C\\mathbf{u}$.\nThe semi-discrete system is therefore:\n$$\nM \\frac{d\\boldsymbol{\\eta}}{dt} + H C \\mathbf{u} = \\mathbf{0}, \\qquad M \\frac{d\\mathbf{u}}{dt} + g C \\boldsymbol{\\eta} = \\mathbf{0}\n$$\n\n**2. Full Discretization using Crank-Nicolson**\n\nApplying the Crank-Nicolson scheme, which is centered in time and averages the right-hand side at time levels $n$ and $n+1$:\n$$\nM \\frac{\\boldsymbol{\\eta}^{n+1} - \\boldsymbol{\\eta}^n}{\\Delta t} = -H C \\frac{\\mathbf{u}^{n+1} + \\mathbf{u}^n}{2} \\\\\nM \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = -g C \\frac{\\boldsymbol{\\eta}^{n+1} + \\boldsymbol{\\eta}^n}{2}\n$$\nRearranging to group terms at level $n+1$ on the left and $n$ on the right:\n$$\nM \\boldsymbol{\\eta}^{n+1} + \\frac{H \\Delta t}{2} C \\mathbf{u}^{n+1} = M \\boldsymbol{\\eta}^n - \\frac{H \\Delta t}{2} C \\mathbf{u}^n \\\\\nM \\mathbf{u}^{n+1} + \\frac{g \\Delta t}{2} C \\boldsymbol{\\eta}^{n+1} = M \\mathbf{u}^n - \\frac{g \\Delta t}{2} C \\boldsymbol{\\eta}^n\n$$\n\n**3. Von Neumann Analysis**\n\nWe substitute the Fourier mode ansatz $\\boldsymbol{\\eta}^n = A z^n \\mathbf{v}$ and $\\mathbf{u}^n = B z^n \\mathbf{v}$, where $(\\mathbf{v})_j = \\exp(\\mathrm{i} j \\theta)$. The matrices $M$ and $C$ act as scalar multipliers on the eigenvector $\\mathbf{v}$, with eigenvalues (Fourier symbols) $\\hat{M}$ and $\\hat{C}$.\n\nFor piecewise linear basis functions on a uniform mesh of spacing $h$:\n-   The mass matrix $M$ has a stencil $h[\\frac{1}{6}, \\frac{4}{6}, \\frac{1}{6}]$. Its eigenvalue is:\n    $\\hat{M}(\\theta) = h (\\frac{1}{6} e^{-\\mathrm{i}\\theta} + \\frac{4}{6} + \\frac{1}{6} e^{\\mathrm{i}\\theta}) = \\frac{h}{3}(2+\\cos\\theta)$.\n-   The gradient matrix $C$ has a stencil $[-\\frac{1}{2}, 0, \\frac{1}{2}]$. Its eigenvalue is:\n    $\\hat{C}(\\theta) = -\\frac{1}{2} e^{-\\mathrm{i}\\theta} + \\frac{1}{2} e^{\\mathrm{i}\\theta} = \\mathrm{i}\\sin\\theta$.\n\nSubstituting the ansatz and eigenvalues into the fully discrete system, and dividing by $z^n$:\n$$\n\\hat{M} z A + \\frac{H \\Delta t}{2} \\hat{C} z B = \\hat{M} A - \\frac{H \\Delta t}{2} \\hat{C} B \\\\\n\\hat{M} z B + \\frac{g \\Delta t}{2} \\hat{C} z A = \\hat{M} B - \\frac{g \\Delta t}{2} \\hat{C} A\n$$\nThis is a $2 \\times 2$ linear system for the amplitudes $A$ and $B$:\n$$\n\\begin{pmatrix} \\hat{M}(z-1) & \\frac{H \\Delta t}{2}\\hat{C}(z+1) \\\\ \\frac{g \\Delta t}{2}\\hat{C}(z+1) & \\hat{M}(z-1) \\end{pmatrix} \\begin{pmatrix} A \\\\ B \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nFor a non-trivial solution $(A, B)$, the determinant of the matrix must be zero:\n$$\n(\\hat{M}(z-1))^2 - \\left(\\frac{\\Delta t}{2}\\right)^2 gH (\\hat{C}(z+1))^2 = 0\n$$\n$$\n(z-1)^2 \\hat{M}^2 = (z+1)^2 \\frac{gH (\\Delta t)^2}{4} \\hat{C}^2\n$$\nTaking the square root of both sides gives two possible relations:\n$$\n(z-1)\\hat{M} = \\pm (z+1) \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}\n$$\nSolving for the amplification factor $z$:\n$$\nz \\left( \\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C} \\right) = \\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C} \\implies z = \\frac{\\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}}{\\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}}\n$$\n\n**4. Discrete Dispersion Relation and Phase Speed**\n\nSubstitute the eigenvalues $\\hat{M} = \\frac{h}{3}(2+\\cos\\theta)$ and $\\hat{C} = \\mathrm{i}\\sin\\theta$:\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\pm \\frac{\\sqrt{gH} \\Delta t}{2} (\\mathrm{i}\\sin\\theta)}{\\frac{h}{3}(2+\\cos\\theta) \\mp \\frac{\\sqrt{gH} \\Delta t}{2} (\\mathrm{i}\\sin\\theta)}\n$$\nUsing the Courant number $\\sigma = \\frac{\\sqrt{gH} \\Delta t}{h}$, we can write $\\frac{\\sqrt{gH} \\Delta t}{2} = \\frac{\\sigma h}{2}$.\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\pm \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta) \\mp \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}\n$$\nLet the numerator be $X \\pm \\mathrm{i}Y$ and the denominator be $X \\mp \\mathrm{i}Y$. The amplification factor is $z = \\exp(-\\mathrm{i}\\omega\\Delta t)$. The modulus is $|z|=1$, so the scheme is neutrally stable. The phase of $z$ is $-\\omega\\Delta t$.\nThe phase of the complex number $\\frac{X+\\mathrm{i}Y}{X-\\mathrm{i}Y}$ is $2\\arctan(Y/X)$. Taking the upper signs (corresponding to one of the wave propagation directions):\n$$\n-\\omega \\Delta t = 2 \\arctan\\left(\\frac{\\frac{\\sigma h}{2}\\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta)}\\right)\n$$\nSo, the discrete dispersion relation for the right-propagating wave is:\n$$\n\\omega \\Delta t = -2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$\nSince $\\arctan(-x) = -\\arctan(x)$, we can write for the magnitude of the frequency:\n$$\n|\\omega \\Delta t| = 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$\nThe numerical phase speed is $c_{\\text{num}} = \\omega/k$. The exact phase speed from the continuum LSWE is $c = \\sqrt{gH}$. The ratio is:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega/k}{\\sqrt{gH}} = \\frac{\\omega}{k\\sqrt{gH}}\n$$\nUsing $\\theta=kh$ and $\\sigma=\\frac{\\sqrt{gH}\\Delta t}{h}$, we can rewrite the ratio for the positive phase speed:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega \\Delta t}{k \\Delta t \\sqrt{gH}} = \\frac{\\omega \\Delta t}{(kh) \\frac{\\Delta t \\sqrt{gH}}{h}} = \\frac{\\omega \\Delta t}{\\theta \\sigma}\n$$\nSubstituting the expression for $|\\omega \\Delta t|$ (and taking the positive branch for phase speed):\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{1}{\\sigma \\theta} \\left[ 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right) \\right]\n$$\nThis is the final expression for the ratio of numerical to exact phase speed in terms of the Courant number $\\sigma$ and the non-dimensional wavenumber $\\theta$.\nFinal expression:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)}\n$$"
        }
    ]
}