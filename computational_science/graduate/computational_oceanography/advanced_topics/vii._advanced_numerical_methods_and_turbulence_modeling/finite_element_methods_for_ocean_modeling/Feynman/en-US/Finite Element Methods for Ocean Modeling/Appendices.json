{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the Finite Element Method lies in transforming a continuous partial differential equation into a system of algebraic equations. This first practice focuses on the core mechanical step: assembling the element stiffness matrix for a 2D diffusion operator, a process central to modeling tracer transport in the ocean. By working through the isoparametric mapping for a triangular element, you will gain hands-on experience with the Jacobian transformation and the assembly of both the stiffness matrix and the load vector from Neumann boundary conditions. ",
            "id": "3793132",
            "problem": "Consider a horizontally two-dimensional tracer diffusion problem relevant to regional ocean modeling. Let the tracer field be denoted by $T(x,y)$ and consider the diffusion operator $-\\nabla \\cdot ( \\mathbf{K} \\nabla T )$ with a constant, symmetric, positive-definite eddy diffusivity tensor $\\mathbf{K} \\in \\mathbb{R}^{2 \\times 2}$ on a single triangular finite element. The governing strong-form partial differential equation (PDE) on an element interior is $-\\nabla \\cdot ( \\mathbf{K} \\nabla T ) = f$, subject to a Neumann boundary condition (NBC) $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T = q$ on the element boundary segments that coincide with the Neumann boundary, where $\\mathbf{n}$ is the outward unit normal and $q$ is a prescribed boundary flux.\n\nYou will use the finite element method (FEM) with linear Lagrange ($P_1$) isoparametric elements. Let the element have physical-node coordinates $(x_1,y_1) = (0,0)$, $(x_2,y_2) = (50{,}000,0)$, and $(x_3,y_3) = (0,30{,}000)$, with all lengths in meters. The element mapping from the reference triangle with local coordinates $(\\xi,\\eta)$ and shape functions $\\hat{N}_1(\\xi,\\eta) = 1 - \\xi - \\eta$, $\\hat{N}_2(\\xi,\\eta) = \\xi$, $\\hat{N}_3(\\xi,\\eta) = \\eta$ is isoparametric: $x(\\xi,\\eta) = \\sum_{i=1}^{3} x_i \\hat{N}_i(\\xi,\\eta)$ and $y(\\xi,\\eta) = \\sum_{i=1}^{3} y_i \\hat{N}_i(\\xi,\\eta)$. The diffusivity tensor is\n$$\n\\mathbf{K} = \\begin{pmatrix}\n1000 & 200 \\\\\n200 & 800\n\\end{pmatrix},\n$$\nwith entries in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$.\n\nTasks:\n1. Starting from the weak form derived from the PDE and Neumann boundary condition (NBC), and using the isoparametric mapping, derive the expression for the element-level diffusion stiffness entries $a_{ij} = \\int_{T} \\nabla N_i^{\\top} \\mathbf{K} \\nabla N_j \\,\\mathrm{d}A$, where $N_i$ are the physical shape functions corresponding to the nodes $i=1,2,3$.\n2. Compute explicitly the off-diagonal entry $a_{12}$ for the given element geometry and $\\mathbf{K}$.\n3. Show how the Neumann boundary integral contributions are assembled on the right-hand side for a constant flux $q_0$ prescribed on the straight edge between nodes $2$ and $3$. Write the resulting edge-level load contributions $b_2^{(e)}$ and $b_3^{(e)}$ as integrals and evaluate them in closed form, expressing them in terms of the edge length.\n\nProvide the final numerical value of the scalar $a_{12}$ as your answer. Express the final answer in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$. Give the exact value; do not round.",
            "solution": "The problem requires the derivation of the finite element stiffness matrix entries and Neumann boundary condition contributions for a 2D diffusion equation, followed by the explicit calculation of one stiffness entry, $a_{12}$.\n\n**Task 1: Derivation of the Element-Level Stiffness Matrix Expression**\n\nThe governing partial differential equation (PDE) is\n$$\n-\\nabla \\cdot (\\mathbf{K} \\nabla T) = f\n$$\nThe first step in the finite element method is to derive the weak form. We multiply the PDE by a test function $v$ and integrate over the element domain $T_e$.\n$$\n-\\int_{T_e} v \\left( \\nabla \\cdot (\\mathbf{K} \\nabla T) \\right) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\nApplying integration by parts (Green's first identity) to the left-hand side gives:\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A - \\int_{\\partial T_e} v (\\mathbf{n} \\cdot \\mathbf{K} \\nabla T) \\,\\mathrm{d}S = \\int_{T_e} v f \\,\\mathrm{d}A\n$$\nwhere $\\partial T_e$ is the boundary of the element and $\\mathbf{n}$ is the outward unit normal. The term $\\mathbf{n} \\cdot \\mathbf{K} \\nabla T$ represents the diffusive flux across the boundary. For boundary segments where a Neumann condition is prescribed, this term is equal to a given flux $q$.\n$$\n\\int_{T_e} (\\nabla v)^{\\top} (\\mathbf{K} \\nabla T) \\,\\mathrm{d}A = \\int_{T_e} v f \\,\\mathrm{d}A + \\int_{\\partial T_e} v q \\,\\mathrm{d}S\n$$\nIn the Galerkin finite element method, the unknown field $T$ and the test function $v$ are approximated using the same set of shape functions $N_i(x,y)$. For a $P_1$ triangular element, the approximation is $T(x,y) \\approx T_h(x,y) = \\sum_{j=1}^{3} T_j N_j(x,y)$, where $T_j$ are the nodal values. We choose the test function $v$ to be one of the shape functions, $v = N_i(x,y)$.\n\nSubstituting these into the weak form yields the system of linear equations $\\mathbf{A}\\mathbf{T} = \\mathbf{b}$, where the entries of the element stiffness matrix $\\mathbf{A}$ are given by:\n$$\na_{ij} = \\int_{T_e} (\\nabla N_i)^{\\top} \\mathbf{K} (\\nabla N_j) \\,\\mathrm{d}A\n$$\nThis is the expression requested. For computation, we map this integral to a reference element with local coordinates $(\\xi, \\eta)$. The physical coordinates $(x,y)$ are given by the isoparametric mapping:\n$$\nx(\\xi,\\eta) = \\sum_{k=1}^{3} x_k \\hat{N}_k(\\xi,\\eta), \\quad y(\\xi,\\eta) = \\sum_{k=1}^{3} y_k \\hat{N}_k(\\xi,\\eta)\n$$\nwhere $\\hat{N}_k$ are the shape functions on the reference element. The gradients of the shape functions are related by the Jacobian matrix $\\mathbf{J}$ of the mapping:\n$$\n\\nabla N_j = \\begin{pmatrix} \\frac{\\partial N_j}{\\partial x} \\\\ \\frac{\\partial N_j}{\\partial y} \\end{pmatrix} = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j = \\mathbf{J}^{-1} \\begin{pmatrix} \\frac{\\partial \\hat{N}_j}{\\partial \\xi} \\\\ \\frac{\\partial \\hat{N}_j}{\\partial \\eta} \\end{pmatrix}\n$$\nThe Jacobian matrix is given by $\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$. For a linear isoparametric element, $\\mathbf{J}$ is constant. The entries are:\n$\\frac{\\partial x}{\\partial \\xi} = x_2-x_1$, $\\frac{\\partial y}{\\partial \\xi} = y_2-y_1$, $\\frac{\\partial x}{\\partial \\eta} = x_3-x_1$, $\\frac{\\partial y}{\\partial \\eta} = y_3-y_1$.\nUsing the given nodal coordinates $(x_1,y_1)=(0,0)$, $(x_2,y_2)=(50000,0)$, and $(x_3,y_3)=(0,30000)$:\n$$\n\\mathbf{J} = \\begin{pmatrix} 50000 - 0 & 0 - 0 \\\\ 0 - 0 & 30000 - 0 \\end{pmatrix} = \\begin{pmatrix} 50000 & 0 \\\\ 0 & 30000 \\end{pmatrix}\n$$\nThe determinant is $\\det(\\mathbf{J}) = 50000 \\times 30000 = 15 \\times 10^8$. The differential area element transforms as $\\mathrm{d}A = \\det(\\mathbf{J}) \\mathrm{d}\\xi \\mathrm{d}\\eta$. Substituting this into the integral for $a_{ij}$:\n$$\na_{ij} = \\int_{\\hat{T}_e} (\\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_i)^{\\top} \\mathbf{K} (\\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j) \\det(\\mathbf{J}) \\,\\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\nFor a $P_1$ element, the gradients of the reference shape functions $\\hat{\\nabla} \\hat{N}_j$ are constant vectors. This means the entire integrand is constant.\n$$\n\\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\hat{\\nabla} \\hat{N}_3 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n$$\nThe integral over the reference element is its area, $\\int_{\\hat{T}_e} \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{1}{2}$.\nThus, the expression for the stiffness entries is:\n$$\na_{ij} = \\frac{1}{2}\\det(\\mathbf{J}) \\left( \\hat{\\nabla} \\hat{N}_i \\right)^{\\top} (\\mathbf{J}^{-1})^{\\top} \\mathbf{K} \\mathbf{J}^{-1} \\left( \\hat{\\nabla} \\hat{N}_j \\right)\n$$\nAlternatively, we can first compute the gradients in physical space, $\\mathbf{B}_j = \\nabla N_j = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_j$, which are constant. The stiffness matrix is then $a_{ij} = A_e (\\mathbf{B}_i^\\top \\mathbf{K} \\mathbf{B}_j)$, where $A_e = \\frac{1}{2} \\det(\\mathbf{J})$ is the area of the physical element.\n\n**Task 2: Computation of the stiffness entry $a_{12}$**\n\nWe first compute the physical gradients $\\mathbf{B}_j = \\nabla N_j$. The inverse Jacobian is:\n$$\n\\mathbf{J}^{-1} = \\frac{1}{15 \\times 10^8} \\begin{pmatrix} 30000 & 0 \\\\ 0 & 50000 \\end{pmatrix} = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix}\n$$\nNow we compute $\\mathbf{B}_1$ and $\\mathbf{B}_2$:\n$$\n\\mathbf{B}_1 = \\nabla N_1 = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_1 = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1/50000 \\\\ -1/30000 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_2 = \\nabla N_2 = \\mathbf{J}^{-1} \\hat{\\nabla} \\hat{N}_2 = \\begin{pmatrix} 1/50000 & 0 \\\\ 0 & 1/30000 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix}\n$$\nThe area of the element is $A_e = \\frac{1}{2} \\times \\text{base} \\times \\text{height} = \\frac{1}{2} \\times 50000 \\times 30000 = 7.5 \\times 10^8 \\,\\mathrm{m}^2$.\nThe stiffness entry $a_{12}$ is given by:\n$$\na_{12} = A_e (\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2)\n$$\nWe compute the product $\\mathbf{B}_1^{\\top} \\mathbf{K} \\mathbf{B}_2$:\n$$\n\\mathbf{K} \\mathbf{B}_2 = \\begin{pmatrix} 1000 & 200 \\\\ 200 & 800 \\end{pmatrix} \\begin{pmatrix} 1/50000 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1000/50000 \\\\ 200/50000 \\end{pmatrix} = \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n\\mathbf{B}_1^{\\top} (\\mathbf{K} \\mathbf{B}_2) = \\begin{pmatrix} -1/50000 & -1/30000 \\end{pmatrix} \\begin{pmatrix} 1/50 \\\\ 1/250 \\end{pmatrix}\n$$\n$$\n= \\left( -\\frac{1}{50000} \\right) \\left( \\frac{1}{50} \\right) + \\left( -\\frac{1}{30000} \\right) \\left( \\frac{1}{250} \\right) = -\\frac{1}{25 \\times 10^5} - \\frac{1}{75 \\times 10^5}\n$$\n$$\n= -\\frac{3}{75 \\times 10^5} - \\frac{1}{75 \\times 10^5} = -\\frac{4}{75 \\times 10^5} = -\\frac{4}{7.5 \\times 10^6}\n$$\nFinally, we multiply by the area $A_e$:\n$$\na_{12} = (7.5 \\times 10^8) \\times \\left( -\\frac{4}{7.5 \\times 10^6} \\right) = -4 \\times \\frac{10^8}{10^6} = -4 \\times 10^2 = -400\n$$\nThe units of $a_{12}$ are $(\\mathrm{m}^{-1})(\\mathrm{m}^2 \\mathrm{s}^{-1})(\\mathrm{m}^{-1})(\\mathrm{m}^2) = \\mathrm{m}^2 \\mathrm{s}^{-1}$.\n\n**Task 3: Neumann Boundary Condition Contribution**\n\nThe contribution of the Neumann boundary condition to the element load vector $\\mathbf{b}^{(e)}$ comes from the boundary integral in the weak form, $\\int_{\\partial T_e} v q \\,\\mathrm{d}S$. With $v=N_i$, the contribution to the $i$-th entry of the load vector is $b_i^{(e)} = \\int_{\\partial T_{e,N}} N_i q \\,\\mathrm{d}S$.\nWe are given a constant flux $q_0$ on the edge connecting node 2 and node 3. On this edge, only the shape functions $N_2$ and $N_3$ are non-zero ($N_1=0$). Therefore, the contributions are limited to $b_2^{(e)}$ and $b_3^{(e)}$:\n$$\nb_2^{(e)} = \\int_{\\text{edge 2-3}} N_2 q_0 \\,\\mathrm{d}S, \\qquad b_3^{(e)} = \\int_{\\text{edge 2-3}} N_3 q_0 \\,\\mathrm{d}S\n$$\nLet's parameterize the straight edge 2-3 by arc length $l$, starting from node 2 ($l=0$) and ending at node 3 ($l=L_{23}$). The length of the edge is:\n$$\nL_{23} = \\sqrt{(x_3 - x_2)^2 + (y_3 - y_2)^2} = \\sqrt{(0-50000)^2 + (30000-0)^2} = \\sqrt{25\\times 10^8 + 9\\times 10^8} = \\sqrt{34\\times 10^8} = 10000\\sqrt{34} \\, \\mathrm{m}\n$$\nAlong this edge, the linear shape functions vary linearly with the parameter $l$:\n$$\nN_2(l) = 1 - \\frac{l}{L_{23}}, \\qquad N_3(l) = \\frac{l}{L_{23}}\n$$\nWe can now evaluate the integrals in closed form:\n$$\nb_2^{(e)} = \\int_0^{L_{23}} q_0 \\left(1 - \\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ l - \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( L_{23} - \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\n$$\nb_3^{(e)} = \\int_0^{L_{23}} q_0 \\left(\\frac{l}{L_{23}}\\right) \\mathrm{d}l = q_0 \\left[ \\frac{l^2}{2L_{23}} \\right]_0^{L_{23}} = q_0 \\left( \\frac{L_{23}^2}{2L_{23}} \\right) = \\frac{q_0 L_{23}}{2}\n$$\nThe total flux over the edge, $q_0 L_{23}$, is distributed equally between the two nodes of the edge, as expected for linear elements.",
            "answer": "$$\\boxed{-400}$$"
        },
        {
            "introduction": "Beyond simple diffusion, FEM is a powerful tool for solving eigenvalue problems that arise in the modal analysis of physical systems. This exercise applies FEM to a classic oceanographic problem: determining the vertical structure and phase speed of long internal gravity waves in a stratified ocean.  By discretizing the vertical Sturm-Liouville problem, you will see how FEM can transform a differential eigenproblem into a matrix eigenproblem and, for this specific case, exactly recover the well-known analytical solution.",
            "id": "3793152",
            "problem": "Consider a two-layer ocean of total depth $H = H_1 + H_2$ with an upper layer of thickness $H_1$ and density $\\rho_1$ overlying a lower layer of thickness $H_2$ and density $\\rho_2$, where $\\rho_2 > \\rho_1$. Let the vertical coordinate be $z$, increasing upward, with the rigid-lid surface at $z=0$, the flat bottom at $z=-H$, and the density interface at $z=-H_1$. Assume the Boussinesq and hydrostatic approximations, small-amplitude motions, and the long-wave limit. Let $g$ denote gravitational acceleration and define the reduced gravity $g' = g(\\rho_2 - \\rho_1)/\\rho_0$, where $\\rho_0$ is a constant reference density.\n\nStarting from the hydrostatic, Boussinesq primitive equations and standard separation-of-variables for long internal waves, derive an appropriate weak (variational) formulation for the baroclinic vertical structure function $\\phi(z)$ under homogeneous Dirichlet boundary conditions at $z=0$ and $z=-H$. Then, construct a vertical Finite Element Method (FEM) approximation space using continuous, piecewise linear basis functions on the partition $\\{-H, -H_1, 0\\}$, and enforce the essential boundary conditions so that only the interfacial nodal basis function remains active. Assemble the resulting discrete generalized eigenproblem and reduce it to a scalar Rayleigh quotient for the long-wave phase speed $c$.\n\nUsing your discrete formulation, compute the numerical value of the internal long-wave phase speed $c$ for the following physically plausible parameters:\n- $H_1 = 100 \\ \\mathrm{m}$,\n- $H_2 = 3900 \\ \\mathrm{m}$,\n- $\\rho_1 = 1024 \\ \\mathrm{kg \\ m^{-3}}$,\n- $\\rho_2 = 1026 \\ \\mathrm{kg \\ m^{-3}}$,\n- $\\rho_0 = 1025 \\ \\mathrm{kg \\ m^{-3}}$,\n- $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$.\n\nExpress the final speed in $\\mathrm{m \\ s^{-1}}$ and round your answer to four significant figures. Your final answer must be a single real number.",
            "solution": "The vertical structure of small-amplitude, long internal waves is governed by a Sturm-Liouville eigenvalue problem. For a Boussinesq fluid under the hydrostatic approximation, the vertical structure function $\\phi(z)$ for the pressure perturbation field $p'(x,y,z,t) = P(x,y,t)\\phi(z)$ satisfies the equation:\n$$\n\\frac{d^2\\phi}{dz^2} + \\frac{N^2(z)}{c^2}\\phi(z) = 0\n$$\nwhere $c$ is the long-wave phase speed (the eigenvalue) and $N^2(z)$ is the Brunt-Väisälä frequency squared, defined as $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$. For the given two-layer fluid with densities $\\rho_1$ and $\\rho_2$ and an interface at $z=-H_1$, the background density profile $\\bar{\\rho}(z)$ is a step function. Its derivative is a Dirac delta function: $\\frac{d\\bar{\\rho}}{dz} = -(\\rho_2 - \\rho_1)\\delta(z+H_1)$.\nThe buoyancy frequency is thus $N^2(z) = \\frac{g(\\rho_2 - \\rho_1)}{\\rho_0}\\delta(z+H_1) = g'\\delta(z+H_1)$, where $g'$ is the reduced gravity. The governing equation becomes:\n$$\n\\frac{d^2\\phi}{dz^2} + \\frac{g'}{c^2}\\delta(z+H_1)\\phi(z) = 0\n$$\nThe problem specifies homogeneous Dirichlet boundary conditions, corresponding to a rigid lid at the surface ($z=0$) and a flat, rigid bottom at $z=-H$. For the baroclinic modes, the vertical velocity vanishes at these boundaries, which translates to the conditions on the pressure mode $\\phi(z)$:\n$$\n\\phi(0) = 0, \\quad \\phi(-H) = 0\n$$\nTo derive the weak (variational) formulation, we multiply the governing equation by a test function $v(z)$ from an appropriate function space (here, the space of functions with square-integrable first derivatives that satisfy the same homogeneous boundary conditions, $H_0^1([-H,0])$) and integrate over the domain $z \\in [-H, 0]$:\n$$\n\\int_{-H}^{0} v(z) \\frac{d^2\\phi}{dz^2} dz + \\int_{-H}^{0} v(z) \\frac{g'}{c^2}\\delta(z+H_1)\\phi(z) dz = 0\n$$\nIntegrating the first term by parts:\n$$\n\\left[v(z)\\frac{d\\phi}{dz}\\right]_{-H}^{0} - \\int_{-H}^{0} \\frac{dv}{dz}\\frac{d\\phi}{dz} dz + \\frac{g'}{c^2} v(-H_1)\\phi(-H_1) = 0\n$$\nThe boundary term $\\left[v(z)\\frac{d\\phi}{dz}\\right]_{-H}^{0}$ vanishes because the test function $v(z)$ must satisfy $v(0)=0$ and $v(-H)=0$. Rearranging the equation gives the weak formulation: Find $\\phi \\in H_0^1([-H,0])$ and eigenvalue $c^2$ such that for all $v \\in H_0^1([-H,0])$,\n$$\n\\int_{-H}^{0} \\frac{d\\phi}{dz}\\frac{dv}{dz} dz = \\frac{g'}{c^2} \\phi(-H_1)v(-H_1)\n$$\nThis is a generalized eigenvalue problem of the form $a(\\phi, v) = \\lambda b(\\phi, v)$ with $\\lambda = 1/c^2$, where $a(\\phi, v) = \\int \\phi'v' dz$ and $b(\\phi, v) = g'\\phi(-H_1)v(-H_1)$.\n\nNext, we construct a Finite Element Method (FEM) approximation. The domain is partitioned by the nodes $z_0 = -H$, $z_1 = -H_1$, and $z_2 = 0$. We use continuous, piecewise linear basis functions (hat functions) $\\psi_j(z)$ such that $\\psi_j(z_k) = \\delta_{jk}$. The approximate solution $\\phi_h(z)$ is written as a linear combination of these basis functions:\n$$\n\\phi_h(z) = \\sum_{j=0}^{2} \\Phi_j \\psi_j(z)\n$$\nwhere $\\Phi_j = \\phi_h(z_j)$ are the nodal values. The essential boundary conditions $\\phi(0)=0$ and $\\phi(-H)=0$ are enforced by setting the corresponding nodal values to zero: $\\Phi_2=0$ and $\\Phi_0=0$. This leaves only one active degree of freedom, $\\Phi_1$, associated with the interfacial node $z_1 = -H_1$. The approximation becomes:\n$$\n\\phi_h(z) = \\Phi_1 \\psi_1(z)\n$$\nThe basis function $\\psi_1(z)$ is defined as:\n$$\n\\psi_1(z) = \\begin{cases} \\frac{z - z_0}{z_1 - z_0} = \\frac{z + H}{H_2} & \\text{for } z \\in [-H, -H_1] \\\\ \\frac{z_2 - z}{z_2 - z_1} = \\frac{-z}{H_1} & \\text{for } z \\in [-H_1, 0] \\end{cases}\n$$\nThe derivative $\\frac{d\\psi_1}{dz}$ is piecewise constant:\n$$\n\\frac{d\\psi_1}{dz} = \\begin{cases} \\frac{1}{H_2} & \\text{for } z \\in [-H, -H_1) \\\\ -\\frac{1}{H_1} & \\text{for } z \\in (-H_1, 0] \\end{cases}\n$$\nWe substitute $\\phi_h(z) = \\Phi_1 \\psi_1(z)$ for the trial function $\\phi$ and $\\psi_1(z)$ for the test function $v$ into the weak formulation. This yields a $1 \\times 1$ discrete generalized eigenproblem $K_{11} \\Phi_1 = \\frac{1}{c^2} M_{11} \\Phi_1$.\nThe stiffness \"matrix\" element $K_{11}$ is:\n$$\nK_{11} = \\int_{-H}^{0} \\left(\\frac{d\\psi_1}{dz}\\right)^2 dz = \\int_{-H}^{-H_1} \\left(\\frac{1}{H_2}\\right)^2 dz + \\int_{-H_1}^{0} \\left(-\\frac{1}{H_1}\\right)^2 dz\n$$\n$$\nK_{11} = \\frac{1}{H_2^2} (H_2) + \\frac{1}{H_1^2} (H_1) = \\frac{1}{H_2} + \\frac{1}{H_1}\n$$\nThe mass \"matrix\" term $M_{11}$ is derived from the right-hand side of the weak form: $g' \\psi_1(-H_1) \\psi_1(-H_1)$. By definition, $\\psi_1(-H_1) = 1$, so:\n$$\nM_{11} = g'(1)^2 = g'\n$$\nThe discrete eigenproblem is $(\\frac{1}{H_1} + \\frac{1}{H_2})\\Phi_1 = \\frac{g'}{c^2}\\Phi_1$. Since $\\Phi_1 \\neq 0$ for a non-trivial solution, we can cancel it to solve for $c^2$:\n$$\n\\frac{1}{c^2} = \\frac{\\frac{1}{H_1} + \\frac{1}{H_2}}{g'} = \\frac{H_1 + H_2}{g'H_1 H_2}\n$$\nThis gives the Rayleigh quotient for $c^2$:\n$$\nc^2 = g' \\frac{H_1 H_2}{H_1 + H_2}\n$$\nThis result is identical to the exact analytical solution for a two-layer fluid, as the true vertical structure function is piecewise linear and thus lies entirely within the chosen finite element space.\n\nNow, we compute the numerical value using the provided parameters:\n$H_1 = 100 \\ \\mathrm{m}$\n$H_2 = 3900 \\ \\mathrm{m}$\n$\\rho_1 = 1024 \\ \\mathrm{kg \\ m^{-3}}$\n$\\rho_2 = 1026 \\ \\mathrm{kg \\ m^{-3}}$\n$\\rho_0 = 1025 \\ \\mathrm{kg \\ m^{-3}}$\n$g = 9.81 \\ \\mathrm{m \\ s^{-2}}$\n\nFirst, calculate the reduced gravity $g'$:\n$$\ng' = g \\frac{\\rho_2 - \\rho_1}{\\rho_0} = 9.81 \\ \\mathrm{m \\ s^{-2}} \\times \\frac{1026 \\ \\mathrm{kg \\ m^{-3}} - 1024 \\ \\mathrm{kg \\ m^{-3}}}{1025 \\ \\mathrm{kg \\ m^{-3}}} = 9.81 \\times \\frac{2}{1025} \\ \\mathrm{m \\ s^{-2}}\n$$\n$$\ng' = \\frac{19.62}{1025} \\ \\mathrm{m \\ s^{-2}} \\approx 0.01914146 \\ \\mathrm{m \\ s^{-2}}\n$$\nNext, calculate the equivalent depth term $\\frac{H_1 H_2}{H_1 + H_2}$:\n$$\n\\frac{H_1 H_2}{H_1 + H_2} = \\frac{100 \\ \\mathrm{m} \\times 3900 \\ \\mathrm{m}}{100 \\ \\mathrm{m} + 3900 \\ \\mathrm{m}} = \\frac{390000}{4000} \\ \\mathrm{m} = 97.5 \\ \\mathrm{m}\n$$\nNow, compute $c^2$:\n$$\nc^2 = g' \\frac{H_1 H_2}{H_1 + H_2} = \\left(\\frac{19.62}{1025} \\ \\mathrm{m \\ s^{-2}}\\right) \\times (97.5 \\ \\mathrm{m}) = \\frac{19.62 \\times 97.5}{1025} \\ \\mathrm{m^2 \\ s^{-2}}\n$$\n$$\nc^2 = \\frac{1912.95}{1025} \\ \\mathrm{m^2 \\ s^{-2}} \\approx 1.86629268 \\ \\mathrm{m^2 \\ s^{-2}}\n$$\nFinally, compute the phase speed $c$ by taking the square root:\n$$\nc = \\sqrt{1.86629268} \\ \\mathrm{m \\ s^{-1}} \\approx 1.36612323 \\ \\mathrm{m \\ s^{-1}}\n$$\nRounding to four significant figures, the internal long-wave phase speed is $1.366 \\ \\mathrm{m \\ s^{-1}}$.",
            "answer": "$$\n\\boxed{1.366}\n$$"
        },
        {
            "introduction": "Ocean modeling is fundamentally about simulating dynamics, where the accurate propagation of waves is paramount. This final practice moves from static and modal problems to the analysis of a fully time-dependent system governed by the linearized shallow water equations.  You will perform a discrete dispersion analysis to derive the numerical phase speed of waves in a model that uses FEM for space and the Crank-Nicolson scheme for time, quantifying how the numerical method alters wave propagation speeds as a function of wavelength and time step.",
            "id": "3793162",
            "problem": "Consider the one-dimensional linearized shallow water equations (LSWE) for free-surface elevation $\\,\\eta(x,t)\\,$ and depth-averaged velocity $\\,u(x,t)\\,$ over a constant depth $\\,H\\,$:\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0, \n\\qquad\n\\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0,\n$$\nwhere $\\,g\\,$ is gravitational acceleration. Let the spatial domain be periodic and covered by a uniform mesh with spacing $\\,h\\,$. Discretize in space using the standard continuous, piecewise linear Finite Element Method (FEM) with the consistent mass matrix. Denote by $\\,\\{\\phi_j(x)\\}\\,$ the nodal basis functions, by $\\,\\boldsymbol{\\eta}(t)\\,$ and $\\,\\mathbf{u}(t)\\,$ the vectors of nodal coefficients of $\\,\\eta\\,$ and $\\,u\\,$, respectively, and define the consistent mass matrix $\\,M\\,$ and the gradient coupling matrix $\\,C\\,$ by\n$$\nM_{ij} = \\int \\phi_i(x)\\,\\phi_j(x)\\,dx, \n\\qquad\nC_{ij} = \\int \\frac{d\\phi_i}{dx}(x)\\,\\phi_j(x)\\,dx.\n$$\nTime-discretize the resulting semi-discrete system using the Crank–Nicolson (CN) method with time step $\\,\\Delta t\\,$. Assume a von Neumann (vN) Fourier mode on the uniform periodic mesh of the form\n$$\n\\eta_j^n = A\\,z^n \\exp(\\mathrm{i} j \\theta), \\qquad u_j^n = B\\,z^n \\exp(\\mathrm{i} j \\theta),\n$$\nwhere $\\,j\\,$ indexes the nodes, $\\,\\theta = k h\\in (0,\\pi]\\,$ is the nondimensional wavenumber, $\\,n\\,$ is the time level, $\\,z = \\exp(-\\mathrm{i}\\,\\omega\\,\\Delta t)\\,$ is the amplification factor, $\\,\\omega\\,$ is the discrete angular frequency, $\\,A\\,$ and $\\,B\\,$ are complex amplitudes, and $\\,\\mathrm{i}\\,$ is the imaginary unit.\n\nStarting from the governing equations and the described spatial and temporal discretizations, derive the fully discrete two-by-two modal system and obtain the discrete dispersion relation linking $\\,\\omega\\,$ and $\\,k\\,$. Define the exact shallow-water phase speed $\\,c\\,$ by the continuum LSWE dispersion relation and the numerical phase speed $\\,c_{\\text{num}} = \\omega/k\\,$. Introduce the Courant number $\\,\\sigma = \\sqrt{g H}\\,\\Delta t / h\\,$. Provide the final closed-form analytic expression for the ratio $\\,c_{\\text{num}}/c\\,$ in terms of $\\,\\sigma\\,$ and $\\,\\theta\\,$, obtained by eliminating all intermediate variables. Your answer must be a single analytic expression with no units. Do not round.",
            "solution": "### Derivation of the Solution\n\n**1. Semi-Discretization using FEM**\n\nWe approximate the fields $\\eta(x,t)$ and $u(x,t)$ using the continuous, piecewise linear basis functions $\\phi_j(x)$:\n$$\n\\eta(x,t) \\approx \\eta_h(x,t) = \\sum_j \\eta_j(t) \\phi_j(x), \\qquad u(x,t) \\approx u_h(x,t) = \\sum_j u_j(t) \\phi_j(x)\n$$\nWe apply the Galerkin method to the LSWE. For each basis function $\\phi_i(x)$, we have:\n$$\n\\int \\phi_i \\left( \\frac{\\partial \\eta_h}{\\partial t} + H \\frac{\\partial u_h}{\\partial x} \\right) dx = 0 \\\\\n\\int \\phi_i \\left( \\frac{\\partial u_h}{\\partial t} + g \\frac{\\partial \\eta_h}{\\partial x} \\right) dx = 0\n$$\nSubstituting the expansions for $\\eta_h$ and $u_h$ and integrating the spatial derivative terms by parts (noting that boundary terms vanish due to periodicity):\n$$\n\\int \\phi_i \\frac{\\partial \\eta_h}{\\partial t} dx = \\sum_j \\left( \\int \\phi_i \\phi_j dx \\right) \\frac{d\\eta_j}{dt} = \\sum_j M_{ij} \\frac{d\\eta_j}{dt} \\\\\n\\int \\phi_i \\frac{\\partial u_h}{\\partial x} dx = -\\int \\frac{d\\phi_i}{dx} u_h dx = -\\sum_j \\left( \\int \\frac{d\\phi_i}{dx} \\phi_j dx \\right) u_j = -\\sum_j C_{ij} u_j\n$$\nThe first equation becomes $\\sum_j M_{ij} \\frac{d\\eta_j}{dt} - H \\sum_j C_{ij} u_j = 0$. In matrix form, this is $M\\frac{d\\boldsymbol{\\eta}}{dt} - H C \\mathbf{u} = \\mathbf{0}$.\nSimilarly, the second equation becomes $M\\frac{d\\mathbf{u}}{dt} - g C \\boldsymbol{\\eta} = \\mathbf{0}$.\nThe semi-discrete system is:\n$$\nM \\frac{d\\boldsymbol{\\eta}}{dt} = H C \\mathbf{u}, \\qquad M \\frac{d\\mathbf{u}}{dt} = g C \\boldsymbol{\\eta}\n$$\n\n**2. Full Discretization using Crank-Nicolson**\n\nApplying the Crank-Nicolson scheme, which is centered in time and averages the right-hand side at time levels $n$ and $n+1$:\n$$\nM \\frac{\\boldsymbol{\\eta}^{n+1} - \\boldsymbol{\\eta}^n}{\\Delta t} = H C \\frac{\\mathbf{u}^{n+1} + \\mathbf{u}^n}{2} \\\\\nM \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = g C \\frac{\\boldsymbol{\\eta}^{n+1} + \\boldsymbol{\\eta}^n}{2}\n$$\nRearranging to group terms at level $n+1$ on the left and $n$ on the right:\n$$\nM \\boldsymbol{\\eta}^{n+1} - \\frac{H \\Delta t}{2} C \\mathbf{u}^{n+1} = M \\boldsymbol{\\eta}^n + \\frac{H \\Delta t}{2} C \\mathbf{u}^n \\\\\nM \\mathbf{u}^{n+1} - \\frac{g \\Delta t}{2} C \\boldsymbol{\\eta}^{n+1} = M \\mathbf{u}^n + \\frac{g \\Delta t}{2} C \\boldsymbol{\\eta}^n\n$$\n\n**3. Von Neumann Analysis**\n\nWe substitute the Fourier mode ansatz $\\boldsymbol{\\eta}^n = A z^n \\mathbf{v}$ and $\\mathbf{u}^n = B z^n \\mathbf{v}$, where $(\\mathbf{v})_j = \\exp(\\mathrm{i} j \\theta)$. The matrices $M$ and $C$ act as scalar multipliers on the eigenvector $\\mathbf{v}$, with eigenvalues (Fourier symbols) $\\hat{M}$ and $\\hat{C}$.\n\nFor piecewise linear basis functions on a uniform mesh of spacing $h$:\n-   The mass matrix $M$ has a stencil $h[\\frac{1}{6}, \\frac{4}{6}, \\frac{1}{6}]$. Its eigenvalue is:\n    $\\hat{M}(\\theta) = h (\\frac{1}{6} e^{-\\mathrm{i}\\theta} + \\frac{4}{6} + \\frac{1}{6} e^{\\mathrm{i}\\theta}) = \\frac{h}{3}(2+\\cos\\theta)$.\n-   The gradient matrix $C$ has a stencil $[1/2, 0, -1/2]$. Its eigenvalue is:\n    $\\hat{C}(\\theta) = \\frac{1}{2} e^{-\\mathrm{i}\\theta} - \\frac{1}{2} e^{\\mathrm{i}\\theta} = -\\mathrm{i}\\sin\\theta$.\n\nSubstituting the ansatz and eigenvalues into the fully discrete system, and dividing by $z^n$:\n$$\n\\hat{M} z A - \\frac{H \\Delta t}{2} \\hat{C} z B = \\hat{M} A + \\frac{H \\Delta t}{2} \\hat{C} B \\\\\n\\hat{M} z B - \\frac{g \\Delta t}{2} \\hat{C} z A = \\hat{M} B + \\frac{g \\Delta t}{2} \\hat{C} A\n$$\nThis is a $2 \\times 2$ linear system for the amplitudes $A$ and $B$:\n$$\n\\begin{pmatrix} \\hat{M}(z-1) & -\\frac{H \\Delta t}{2}\\hat{C}(z+1) \\\\ -\\frac{g \\Delta t}{2}\\hat{C}(z+1) & \\hat{M}(z-1) \\end{pmatrix} \\begin{pmatrix} A \\\\ B \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nFor a non-trivial solution $(A, B)$, the determinant of the matrix must be zero:\n$$\n(\\hat{M}(z-1))^2 - \\left(\\frac{\\Delta t}{2}\\right)^2 gH (\\hat{C}(z+1))^2 = 0\n$$\n$$\n(z-1)^2 \\hat{M}^2 = (z+1)^2 \\frac{gH (\\Delta t)^2}{4} \\hat{C}^2\n$$\nTaking the square root of both sides gives two possible relations:\n$$\n(z-1)\\hat{M} = \\pm (z+1) \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}\n$$\nSolving for the amplification factor $z$:\n$$\nz \\left( \\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C} \\right) = \\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C} \\implies z = \\frac{\\hat{M} \\pm \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}}{\\hat{M} \\mp \\frac{\\sqrt{gH} \\Delta t}{2} \\hat{C}}\n$$\n\n**4. Discrete Dispersion Relation and Phase Speed**\n\nSubstitute the eigenvalues $\\hat{M} = \\frac{h}{3}(2+\\cos\\theta)$ and $\\hat{C} = -\\mathrm{i}\\sin\\theta$:\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\pm \\frac{\\sqrt{gH} \\Delta t}{2} (-\\mathrm{i}\\sin\\theta)}{\\frac{h}{3}(2+\\cos\\theta) \\mp \\frac{\\sqrt{gH} \\Delta t}{2} (-\\mathrm{i}\\sin\\theta)}\n$$\nUsing the Courant number $\\sigma = \\frac{\\sqrt{gH} \\Delta t}{h}$, we can write $\\frac{\\sqrt{gH} \\Delta t}{2} = \\frac{\\sigma h}{2}$.\n$$\nz = \\frac{\\frac{h}{3}(2+\\cos\\theta) \\mp \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta) \\pm \\mathrm{i} \\frac{\\sigma h}{2} \\sin\\theta}\n$$\nLet the numerator be $X \\mp \\mathrm{i}Y$ and the denominator be $X \\pm \\mathrm{i}Y$. The amplification factor is $z = \\exp(-\\mathrm{i}\\omega\\Delta t)$. The modulus is $|z|=1$, so the scheme is neutrally stable. The phase of $z$ is $-\\omega\\Delta t$.\nThe phase of the complex number $\\frac{X-\\mathrm{i}Y}{X+\\mathrm{i}Y}$ is $-2\\arctan(Y/X)$. Taking the upper signs (corresponding to one of the wave propagation directions):\n$$\n-\\omega \\Delta t = -2 \\arctan\\left(\\frac{\\frac{\\sigma h}{2}\\sin\\theta}{\\frac{h}{3}(2+\\cos\\theta)}\\right)\n$$\nSo, the discrete dispersion relation is:\n$$\n\\omega \\Delta t = 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$\nThe numerical phase speed is $c_{\\text{num}} = \\omega/k$. The exact phase speed from the continuum LSWE is $c = \\sqrt{gH}$. The ratio is:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega/k}{\\sqrt{gH}} = \\frac{\\omega}{k\\sqrt{gH}}\n$$\nUsing $\\theta=kh$ and $\\sigma=\\frac{\\sqrt{gH}\\Delta t}{h}$, we can rewrite the ratio:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{\\omega \\Delta t}{k \\Delta t \\sqrt{gH}} = \\frac{\\omega \\Delta t}{(kh) \\frac{\\Delta t \\sqrt{gH}}{h}} = \\frac{\\omega \\Delta t}{\\theta \\sigma}\n$$\nSubstituting the expression for $\\omega \\Delta t$:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{1}{\\sigma \\theta} \\left[ 2 \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right) \\right]\n$$\nThis is the final expression for the ratio of numerical to exact phase speed in terms of the Courant number $\\sigma$ and the non-dimensional wavenumber $\\theta$.\nFinal expression:\n$$\n\\frac{c_{\\text{num}}}{c} = \\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{2}{\\sigma \\theta} \\arctan\\left(\\frac{3 \\sigma \\sin\\theta}{2(2+\\cos\\theta)}\\right)}\n$$"
        }
    ]
}