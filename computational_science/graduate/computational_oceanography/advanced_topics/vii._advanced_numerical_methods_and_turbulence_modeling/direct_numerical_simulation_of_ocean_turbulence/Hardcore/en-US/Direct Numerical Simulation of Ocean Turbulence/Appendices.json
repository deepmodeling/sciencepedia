{
    "hands_on_practices": [
        {
            "introduction": "Before embarking on a complex Direct Numerical Simulation, it is crucial to understand the fundamental physics your simulation will represent. This exercise guides you through the process of non-dimensionalizing the Boussinesq equations to reveal the key parameters governing the flow . By calculating the Reynolds, Prandtl, Froude, and Rossby numbers, you will develop the skill to predict and interpret the dominant dynamical regime of a turbulent oceanic environment.",
            "id": "3789999",
            "problem": "In Direct Numerical Simulation (DNS) of ocean turbulence under the rotating, stratified, incompressible Boussinesq approximation, the governing equations are\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u} + f\\,\\hat{\\boldsymbol{z}}\\times \\boldsymbol{u} = -\\frac{1}{\\rho_{0}}\\nabla p' + b\\,\\hat{\\boldsymbol{z}} + \\nu \\nabla^{2}\\boldsymbol{u}, \\quad \\nabla\\cdot \\boldsymbol{u} = 0,\n$$\n$$\n\\frac{\\partial b}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla b + N^{2} w = \\kappa_{T} \\nabla^{2} b,\n$$\nwhere $\\boldsymbol{u} = (u,v,w)$ is velocity, $p'$ is the kinematic pressure perturbation, $b$ is buoyancy, $\\rho_{0}$ is a constant reference density, $\\nu$ is kinematic viscosity, $\\kappa_{T}$ is thermal diffusivity, $f$ is the Coriolis parameter, and $N$ is the buoyancy frequency associated with a stable, uniform background stratification. Consider a homogeneous turbulence patch characteristic of small-scale ocean interior motions with the following representative scales and parameters suitable for DNS:\n- Velocity scale $U = 0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$,\n- Length scale $L = 0.5\\,\\mathrm{m}$,\n- Kinematic viscosity $\\nu = 10^{-6}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- Thermal diffusivity $\\kappa_{T} = 1.4\\times 10^{-7}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- Buoyancy frequency $N = 10^{-2}\\,\\mathrm{s}^{-1}$,\n- Coriolis parameter $f = 10^{-4}\\,\\mathrm{s}^{-1}$.\n\nStarting from the above equations and using the characteristic scales $L$ and $U$ to nondimensionalize space and time, and a buoyancy scale consistent with the background stratification, derive the dimensionless form that reveals the Reynolds number $Re$, the Prandtl number $Pr$, the Froude number $Fr$, and the Rossby number $Ro$ that control the balances among inertia, diffusion, stratification, and rotation. Then, using the given values, compute $Re$, $Pr$, $Fr$, and $Ro$.\n\nFinally, based on the magnitudes of these dimensionless numbers, briefly interpret the dominant dynamical regime that the DNS would resolve for this configuration, commenting on the relative importance of turbulence, stratification, rotation, and the scalar-to-momentum diffusivity contrast.\n\nExpress your four computed dimensionless numbers in the order $(Re, Pr, Fr, Ro)$ as pure numbers (dimensionless), and round each to three significant figures. No units are to be reported with the numbers in your final numerical result.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\nThe governing equations for a rotating, stratified, incompressible Boussinesq fluid are provided:\nMomentum and continuity:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u} + f\\,\\hat{\\boldsymbol{z}}\\times \\boldsymbol{u} = -\\frac{1}{\\rho_{0}}\\nabla p' + b\\,\\hat{\\boldsymbol{z}} + \\nu \\nabla^{2}\\boldsymbol{u}, \\quad \\nabla\\cdot \\boldsymbol{u} = 0\n$$\nBuoyancy transport:\n$$\n\\frac{\\partial b}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla b + N^{2} w = \\kappa_{T} \\nabla^{2} b\n$$\nThe variables are defined as: $\\boldsymbol{u} = (u,v,w)$ (velocity), $p'$ (kinematic pressure perturbation), $b$ (buoyancy), $\\rho_{0}$ (constant reference density), $\\nu$ (kinematic viscosity), $\\kappa_{T}$ (thermal diffusivity), $f$ (Coriolis parameter), and $N$ (buoyancy frequency).\n\nCharacteristic scales and parameters are given:\n- Velocity scale: $U = 0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- Length scale: $L = 0.5\\,\\mathrm{m}$\n- Kinematic viscosity: $\\nu = 10^{-6}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n- Thermal diffusivity: $\\kappa_{T} = 1.4\\times 10^{-7}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n- Buoyancy frequency: $N = 10^{-2}\\,\\mathrm{s}^{-1}$\n- Coriolis parameter: $f = 10^{-4}\\,\\mathrm{s}^{-1}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in geophysical fluid dynamics, specifically the non-dimensionalization of the Boussinesq equations.\n- **Scientifically Grounded:** The governing equations are the standard Boussinesq approximation, which is a cornerstone of oceanography and atmospheric science. The given parameter values are physically realistic for small-scale oceanic processes.\n- **Well-Posed:** The problem is clearly stated and provides all necessary information to perform the non-dimensionalization and calculate the required dimensionless numbers. The task is well-defined.\n- **Objective:** The problem is expressed in precise mathematical and physical language, free of subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of Dimensionless Equations\nWe introduce dimensionless variables, denoted by a prime (e.g., $\\boldsymbol{x}'$), using the provided characteristic scales.\n- Space: $\\boldsymbol{x} = L\\boldsymbol{x}'$\n- Velocity: $\\boldsymbol{u} = U\\boldsymbol{u}'$\n- Time: The advective time scale is $T = L/U$. Thus, $t = (L/U)t'$.\n- Buoyancy: The buoyancy scale, $B$, is chosen to balance the advection of buoyancy, $\\boldsymbol{u}\\cdot\\nabla b \\sim (U/L)B$, with the generation of buoyancy by vertical velocity against the background stratification, $N^2 w \\sim N^2 U$. This balance yields $(U/L)B \\sim N^2 U$, so we set $B = N^2 L$. Thus, $b = (N^2 L)b'$.\n- Pressure: The pressure scale is chosen to balance the pressure gradient with the inertial term. $-\\frac{1}{\\rho_0}\\nabla p' \\sim \\boldsymbol{u}\\cdot\\nabla\\boldsymbol{u} \\Rightarrow \\frac{P'}{\\rho_0 L} \\sim \\frac{U^2}{L}$. We define a kinematic pressure scale $P_k = U^2$. Let the dimensionless pressure perturbation $p'_{nd}$ be defined by $p' = (\\rho_0 U^2)p'_{nd}$.\n\nThe differential operators transform as:\n$$\n\\nabla = \\frac{1}{L}\\nabla', \\quad \\nabla^2 = \\frac{1}{L^2}\\nabla'^2, \\quad \\frac{\\partial}{\\partial t} = \\frac{U}{L}\\frac{\\partial}{\\partial t'}\n$$\n\nSubstitute these into the momentum equation:\n$$\n\\frac{U}{L}\\frac{\\partial (U\\boldsymbol{u}')}{\\partial t'} + (U\\boldsymbol{u}')\\cdot(\\frac{1}{L}\\nabla') (U\\boldsymbol{u}') + f\\,\\hat{\\boldsymbol{z}}\\times (U\\boldsymbol{u}') = -\\frac{1}{\\rho_{0}}\\frac{1}{L}\\nabla' (\\rho_0 U^2 p'_{nd}) + (N^2 L b')\\,\\hat{\\boldsymbol{z}} + \\nu \\frac{1}{L^2}\\nabla'^2 (U\\boldsymbol{u}')\n$$\nFactoring out the dimensional scales gives:\n$$\n\\left(\\frac{U^2}{L}\\right) \\frac{\\partial \\boldsymbol{u}'}{\\partial t'} + \\left(\\frac{U^2}{L}\\right) \\boldsymbol{u}'\\cdot\\nabla' \\boldsymbol{u}' + (fU)\\,\\hat{\\boldsymbol{z}}\\times \\boldsymbol{u}' = -\\left(\\frac{U^2}{L}\\right)\\nabla' p'_{nd} + (N^2 L)b'\\,\\hat{\\boldsymbol{z}} + \\left(\\frac{\\nu U}{L^2}\\right)\\nabla'^2 \\boldsymbol{u}'\n$$\nDivide the entire equation by the inertial acceleration scale, $U^2/L$:\n$$\n\\frac{\\partial \\boldsymbol{u}'}{\\partial t'} + \\boldsymbol{u}'\\cdot\\nabla' \\boldsymbol{u}' + \\frac{fU L}{U^2}\\,\\hat{\\boldsymbol{z}}\\times \\boldsymbol{u}' = -\\nabla' p'_{nd} + \\frac{N^2 L^2}{U^2} b'\\,\\hat{\\boldsymbol{z}} + \\frac{\\nu U L^2}{L^2 U^2} \\nabla'^2 \\boldsymbol{u}'\n$$\nSimplifying the coefficients and dropping the primes for notational clarity yields the dimensionless momentum equation:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla \\boldsymbol{u} + \\left(\\frac{fL}{U}\\right)\\hat{\\boldsymbol{z}}\\times \\boldsymbol{u} = -\\nabla p' + \\left(\\frac{N^2 L^2}{U^2}\\right) b\\,\\hat{\\boldsymbol{z}} + \\left(\\frac{\\nu}{UL}\\right) \\nabla^{2}\\boldsymbol{u}\n$$\nFrom this, we identify the following dimensionless numbers:\n- Rossby number: $Ro = \\frac{U}{fL}$. The coefficient is $1/Ro$.\n- Froude number: $Fr = \\frac{U}{NL}$. The coefficient is $1/Fr^2$.\n- Reynolds number: $Re = \\frac{UL}{\\nu}$. The coefficient is $1/Re$.\n\nThe continuity equation $\\nabla\\cdot\\boldsymbol{u}=0$ becomes $(\\frac{1}{L}\\nabla')\\cdot(U\\boldsymbol{u}') = 0$, which simplifies to $\\nabla'\\cdot\\boldsymbol{u}'=0$. It is form-invariant.\n\nNext, substitute the dimensionless variables into the buoyancy equation, where $w = Uw'$:\n$$\n\\frac{U}{L}\\frac{\\partial (N^2 L b')}{\\partial t'} + (U\\boldsymbol{u}')\\cdot(\\frac{1}{L}\\nabla')(N^2 L b') + N^2 (Uw') = \\kappa_{T} \\frac{1}{L^2}\\nabla'^2(N^2 L b')\n$$\nFactoring out scales:\n$$\n(U N^2) \\frac{\\partial b'}{\\partial t'} + (U N^2) \\boldsymbol{u}'\\cdot\\nabla'b' + (N^2 U)w' = \\left(\\frac{\\kappa_T N^2}{L}\\right) \\nabla'^2 b'\n$$\nDivide by the advective/source term scale, $N^2 U$:\n$$\n\\frac{\\partial b'}{\\partial t'} + \\boldsymbol{u}'\\cdot\\nabla'b' + w' = \\frac{\\kappa_T}{UL} \\nabla'^2 b'\n$$\nThe coefficient on the diffusive term is $\\frac{\\kappa_T}{UL}$. We can express this using a new dimensionless number. By convention, this is related to the Reynolds and Prandtl numbers. The Prandtl number is defined as the ratio of momentum diffusivity to thermal diffusivity:\n- Prandtl number: $Pr = \\frac{\\nu}{\\kappa_T}$\nThe coefficient can thus be rewritten as:\n$$\n\\frac{\\kappa_T}{UL} = \\frac{\\nu}{UL} \\frac{\\kappa_T}{\\nu} = \\frac{1}{Re} \\frac{1}{Pr} = \\frac{1}{Re \\cdot Pr}\n$$\nDropping the primes, the dimensionless buoyancy equation is:\n$$\n\\frac{\\partial b}{\\partial t} + \\boldsymbol{u}\\cdot\\nabla b + w = \\frac{1}{Re \\cdot Pr} \\nabla^{2} b\n$$\n\n### Calculation of Dimensionless Numbers\nUsing the given values:\n$U = 0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $L = 0.5\\,\\mathrm{m}$, $\\nu = 10^{-6}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$, $\\kappa_{T} = 1.4\\times 10^{-7}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$, $N = 10^{-2}\\,\\mathrm{s}^{-1}$, $f = 10^{-4}\\,\\mathrm{s}^{-1}$.\n\n1.  **Reynolds number ($Re$):** Ratio of inertial to viscous forces.\n    $$\n    Re = \\frac{UL}{\\nu} = \\frac{(0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1})(0.5\\,\\mathrm{m})}{10^{-6}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}} = \\frac{0.025}{10^{-6}} = 25000\n    $$\n2.  **Prandtl number ($Pr$):** Ratio of momentum diffusivity to thermal diffusivity.\n    $$\n    Pr = \\frac{\\nu}{\\kappa_{T}} = \\frac{10^{-6}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}}{1.4\\times 10^{-7}\\,\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}} = \\frac{10}{1.4} \\approx 7.142857...\n    $$\n3.  **Froude number ($Fr$):** Ratio of inertial to buoyancy forces.\n    $$\n    Fr = \\frac{U}{NL} = \\frac{0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{(10^{-2}\\,\\mathrm{s}^{-1})(0.5\\,\\mathrm{m})} = \\frac{0.05}{0.005} = 10\n    $$\n4.  **Rossby number ($Ro$):** Ratio of inertial to Coriolis forces.\n    $$\n    Ro = \\frac{U}{fL} = \\frac{0.05\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{(10^{-4}\\,\\mathrm{s}^{-1})(0.5\\,\\mathrm{m})} = \\frac{0.05}{5\\times 10^{-5}} = 1000\n    $$\n\nRounding to three significant figures, we get:\n- $Re = 2.50 \\times 10^4$\n- $Pr \\approx 7.14$\n- $Fr = 10.0$\n- $Ro = 1.00 \\times 10^3$\n\n### Interpretation of the Dynamical Regime\n- $Re = 2.50 \\times 10^4 \\gg 1$: The Reynolds number is very large, indicating that inertial forces are vastly dominant over viscous forces. This is the defining characteristic of a turbulent flow. The DNS will resolve a chaotic, multi-scale turbulent field.\n- $Fr = 10.0 \\gg 1$: The Froude number is significantly larger than unity. Since the buoyancy term in the momentum equation scales as $1/Fr^2$, this implies that inertial forces are much stronger than buoyancy (stratification) forces. The dynamics are those of weakly stratified turbulence. While stratification is not the dominant agent, it will still influence the flow, for instance by affecting the vertical motion and potentially supporting internal gravity waves.\n- $Ro = 1.00 \\times 10^3 \\gg 1$: The Rossby number is very large. Since the Coriolis term scales as $1/Ro$, this indicates that inertial forces are far stronger than Coriolis forces. The influence of Earth's rotation on the dynamics at these scales is negligible. The flow is strongly ageostrophic.\n- $Pr \\approx 7.14 > 1$: The Prandtl number is characteristic of water. Since $Pr>1$, momentum diffuses more efficiently than buoyancy (temperature/salinity). This implies that the smallest scales of variability in the buoyancy field (the Batchelor scale, $\\eta_B=\\eta_K / \\sqrt{Pr}$) will be smaller than the smallest scales in the velocity field (the Kolmogorov scale, $\\eta_K$). This poses a significant resolution requirement for the DNS, as the grid must be fine enough to resolve the small-scale structures in the scalar field.\n\nIn summary, the DNS would simulate a patch of **weakly stratified, non-rotating, high-Reynolds-number turbulence**. The dominant dynamical balance is between inertia and the pressure gradient, characteristic of classic turbulence theory. The effects of stratification and rotation are secondary, acting as weak perturbations on the turbulent cascade. The simulation's primary challenge is resolving the wide range of scales from the integral scale $L$ down to the dissipative scales, particularly the fine structures in the buoyancy field.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.50 \\times 10^4  7.14  10.0  1.00 \\times 10^3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The 'Direct' in Direct Numerical Simulation implies that we resolve all scales of motion, a task that demands highly accurate numerical methods. This practice introduces the Method of Manufactured Solutions (MMS), a rigorous technique for verifying that your code correctly solves the governing equations . By implementing a convergence test for the Laplacian operator, you will gain hands-on experience with the foundational process of ensuring your numerical engine is free of bugs and performs to its theoretical accuracy.",
            "id": "3790016",
            "problem": "You are tasked with performing verification, validation, and error quantification for a Direct Numerical Simulation (DNS) of ocean turbulence in the Boussinesq approximation. Direct Numerical Simulation (DNS) resolves all dynamically relevant scales of motion without subgrid modeling. The objective of this problem is to derive error norms for velocity and buoyancy fields and to propose and implement convergence tests under spatial grid refinement from $N=128$ to $N=256$ and to $N=512$ in a scientifically coherent, self-contained numerical experiment.\n\nConsider a two-dimensional periodic domain representing a vertical slice of the ocean, with coordinates $(x,z)$ and domain size $L_x = 2\\pi$ and $L_z = 2\\pi$. All quantities are dimensionless. The flow is incompressible under the Boussinesq approximation. Let a manufactured streamfunction $\\psi(x,z)$ define an incompressible velocity field through a vector potential formulation:\n- The velocity components are given by $u_x(x,z) = \\partial \\psi / \\partial z$ and $u_z(x,z) = -\\partial \\psi / \\partial x$.\n- The buoyancy field $b(x,z)$ is a prescribed smooth function.\n\nThe manufactured fields are defined by\n- $\\psi(x,z) = \\sin(k_x x)\\sin(k_z z)$,\n- $b(x,z) = \\cos(k_x x)\\cos(k_z z)$,\nwhere $k_x$ and $k_z$ are wavenumbers in the $x$ and $z$ directions, respectively. The resulting velocity components satisfy incompressibility automatically due to the streamfunction construction. These fields are periodic in both spatial directions.\n\nFor verification of spatial discretization accuracy relevant to DNS, focus on the diffusion operator that appears in the Boussinesq momentum and buoyancy equations. The continuous Laplacian operator is denoted by $\\nabla^2$. Your task is to:\n1. Derive the exact Laplacian of the manufactured velocity components $u_x(x,z)$ and $u_z(x,z)$ and of the buoyancy field $b(x,z)$ in the continuous setting.\n2. Implement a second-order centered finite-difference approximation of the Laplacian operator on a uniform periodic grid for both $u_x$, $u_z$, and $b$, without using any spectral method. The grid is uniform with $N$ points in each direction, grid spacings $h_x = L_x/N$ and $h_z = L_z/N$, and periodic boundary conditions in both directions. You must use a purely local stencil with second-order accuracy in space and enforce periodicity by wrapping indices.\n3. Compute the pointwise error fields for each of $u_x$, $u_z$, and $b$ by subtracting the exact Laplacian from the discrete Laplacian. For the vector velocity error, define the combined error magnitude field $e_u(x,z) = \\sqrt{e_{u_x}(x,z)^2 + e_{u_z}(x,z)^2}$, where $e_{u_x}$ and $e_{u_z}$ are the componentwise Laplacian errors. For buoyancy, the scalar error magnitude is $e_b(x,z) = |e_b(x,z)|$.\n4. Define and compute the $L_2$ and $L_\\infty$ error norms for the velocity and buoyancy fields on the discrete grid for each $N$. Use the following norm definitions on the discrete grid:\n   - $L_2$ for velocity: $\\|e_u\\|_{2} = \\sqrt{\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} e_u(x_i,z_j)^2}$,\n   - $L_\\infty$ for velocity: $\\|e_u\\|_{\\infty} = \\max_{i,j} e_u(x_i,z_j)$,\n   - $L_2$ for buoyancy: $\\|e_b\\|_{2} = \\sqrt{\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} e_b(x_i,z_j)^2}$,\n   - $L_\\infty$ for buoyancy: $\\|e_b\\|_{\\infty} = \\max_{i,j} e_b(x_i,z_j)$.\n   All quantities are dimensionless. Angles are in radians. Do not use percentage signs; any fractional reporting must be in decimal or fraction form.\n5. Quantify and report observed convergence rates under grid refinement from $N=128$ to $N=256$ and from $N=256$ to $N=512$ using the formula for observed order $p$:\n   - $p = \\frac{\\log(\\|e\\|_{N} / \\|e\\|_{2N})}{\\log(h_{N}/h_{2N})}$.\n   Since $h_{N} = L_x/N$ and $h_{2N} = L_x/(2N)$, the denominator simplifies to $\\log(2)$, but you must compute it explicitly. Report separate observed orders for $L_2$ and $L_\\infty$ norms for both velocity and buoyancy.\n6. Propose and implement a test suite that evaluates numerical behavior for different wavenumber configurations to cover a general case, anisotropy, and a near-Nyquist edge case. Use the following set of wavenumber pairs $(k_x,k_z)$:\n   - Test Case $1$: $(k_x,k_z) = (4,4)$,\n   - Test Case $2$: $(k_x,k_z) = (16,8)$,\n   - Test Case $3$: $(k_x,k_z) = (32,1)$.\n   These wavenumbers are expressed in radians per unit length and are dimensionless. The grid sizes to be used are $N \\in \\{128,256,512\\}$.\n\nYour program must compute, for each test case and each $N$, the $L_2$ and $L_\\infty$ error norms for the velocity and buoyancy fields, and the observed orders of convergence $p$ for the transitions $N=128\\to N=256$ and $N=256\\to N=512$. Express all outputs as dimensionless numbers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, append the following values in this exact order:\n- $\\|e_u\\|_{2}$ at $N=128$, $\\|e_u\\|_{2}$ at $N=256$, $\\|e_u\\|_{2}$ at $N=512$, $p$ for $\\|e_u\\|_{2}$ from $128\\to 256$, $p$ for $\\|e_u\\|_{2}$ from $256\\to 512$,\n- $\\|e_u\\|_{\\infty}$ at $N=128$, $\\|e_u\\|_{\\infty}$ at $N=256$, $\\|e_u\\|_{\\infty}$ at $N=512$, $p$ for $\\|e_u\\|_{\\infty}$ from $128\\to 256$, $p$ for $\\|e_u\\|_{\\infty}$ from $256\\to 512$,\n- $\\|e_b\\|_{2}$ at $N=128$, $\\|e_b\\|_{2}$ at $N=256$, $\\|e_b\\|_{2}$ at $N=512$, $p$ for $\\|e_b\\|_{2}$ from $128\\to 256$, $p$ for $\\|e_b\\|_{2}$ from $256\\to 512$,\n- $\\|e_b\\|_{\\infty}$ at $N=128$, $\\|e_b\\|_{\\infty}$ at $N=256$, $\\|e_b\\|_{\\infty}$ at $N=512$, $p$ for $\\|e_b\\|_{\\infty}$ from $128\\to 256$, $p$ for $\\|e_b\\|_{\\infty}$ from $256\\to 512$.\n\nThe final output must aggregate the results for Test Case $1$, then Test Case $2$, then Test Case $3$, in that order, yielding a single flat list of $60$ numbers. The program must be self-contained, require no input, and produce exactly one line of output in the specified format.",
            "solution": "The foundation is the Boussinesq approximation for incompressible stratified flow, under which the governing equations are, in dimensional form,\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla\\mathbf{u} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u} + b\\,\\hat{\\mathbf{z}},\\quad\n\\frac{\\partial b}{\\partial t} + \\mathbf{u}\\cdot\\nabla b = \\kappa \\nabla^2 b,\\quad\n\\nabla\\cdot\\mathbf{u} = 0,\n$$\nwhere $\\mathbf{u}$ is the velocity vector field, $p$ is the kinematic pressure, $\\nu$ is the kinematic viscosity, $b$ is buoyancy, $\\kappa$ is the diffusivity of buoyancy, and $\\hat{\\mathbf{z}}$ is the unit vector in the vertical. In a Direct Numerical Simulation (DNS), all terms are resolved on the computational grid. A core component of DNS verification is spatial discretization accuracy of differential operators, notably $\\nabla^2$.\n\nTo verify the discrete Laplacian operator, we employ the Method of Manufactured Solutions (MMS). We construct smooth periodic fields on a two-dimensional periodic domain $(x,z)\\in [0,2\\pi]\\times[0,2\\pi]$ with dimensionless units:\n- Define a streamfunction $\\psi(x,z) = \\sin(k_x x)\\sin(k_z z)$.\n- The incompressible velocity components are $u_x = \\partial \\psi / \\partial z$ and $u_z = -\\partial \\psi / \\partial x$, which guarantee $\\partial u_x/\\partial x + \\partial u_z/\\partial z = 0$ by construction in two dimensions.\n- Define buoyancy $b(x,z) = \\cos(k_x x)\\cos(k_z z)$.\n\nFor these trigonometric fields, we derive the exact Laplacian analytically. First observe that for a product of sines and cosines, the Laplacian satisfies\n$$\n\\nabla^2 \\left[\\sin(k_x x)\\sin(k_z z)\\right] = -\\left(k_x^2 + k_z^2\\right)\\sin(k_x x)\\sin(k_z z),\n$$\nand similarly for cosine products. The velocity components are spatial derivatives of $\\psi$, and the Laplacian commutes with differentiation for smooth fields. Hence,\n$$\n\\nabla^2 u_x = \\nabla^2\\left(\\frac{\\partial \\psi}{\\partial z}\\right) = \\frac{\\partial}{\\partial z}\\left(\\nabla^2 \\psi\\right) = -\\left(k_x^2 + k_z^2\\right)\\frac{\\partial \\psi}{\\partial z} = -\\left(k_x^2 + k_z^2\\right)u_x,\n$$\n$$\n\\nabla^2 u_z = \\nabla^2\\left(-\\frac{\\partial \\psi}{\\partial x}\\right) = -\\frac{\\partial}{\\partial x}\\left(\\nabla^2 \\psi\\right) = -\\left(k_x^2 + k_z^2\\right)\\left(-\\frac{\\partial \\psi}{\\partial x}\\right) = -\\left(k_x^2 + k_z^2\\right)u_z,\n$$\nand\n$$\n\\nabla^2 b = -\\left(k_x^2 + k_z^2\\right)b.\n$$\nTherefore, the exact Laplacian of each field is simply $-\\left(k_x^2 + k_z^2\\right)$ times the original field.\n\nWe now define the discrete Laplacian operator on a uniform grid with $N$ points in each direction, grid spacings $h_x = L_x/N$ and $h_z = L_z/N$, and periodic boundary conditions. The second-order centered finite-difference approximation for the Laplacian of a scalar field $f(x,z)$ at grid index $(i,j)$ is\n$$\n\\left(\\nabla^2 f\\right)_{i,j} \\approx \\frac{f_{i+1,j} - 2 f_{i,j} + f_{i-1,j}}{h_x^2} + \\frac{f_{i,j+1} - 2 f_{i,j} + f_{i,j-1}}{h_z^2},\n$$\nwith periodic wrapping for indices, so that $f_{-1,j} \\equiv f_{N-1,j}$, $f_{N,j} \\equiv f_{0,j}$, and similarly in $z$. This scheme is second-order accurate in space for smooth $f$, meaning its truncation error scales as $\\mathcal{O}(h_x^2 + h_z^2)$.\n\nDefine the discrete error fields by comparing the numerical and exact Laplacians:\n- For velocity components, $e_{u_x} = \\left(\\nabla^2 u_x\\right)_{\\text{num}} - \\left(\\nabla^2 u_x\\right)_{\\text{exact}}$ and $e_{u_z} = \\left(\\nabla^2 u_z\\right)_{\\text{num}} - \\left(\\nabla^2 u_z\\right)_{\\text{exact}}$. Combine them into a vector magnitude error field $e_u(x,z) = \\sqrt{e_{u_x}(x,z)^2 + e_{u_z}(x,z)^2}$.\n- For buoyancy, $e_b = \\left(\\nabla^2 b\\right)_{\\text{num}} - \\left(\\nabla^2 b\\right)_{\\text{exact}}$, and its magnitude is $|e_b|$.\n\nDefine the discrete $L_2$ and $L_\\infty$ norms over the grid:\n$$\n\\|e_u\\|_{2} = \\sqrt{\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} e_u(x_i,z_j)^2},\\quad\n\\|e_u\\|_{\\infty} = \\max_{i,j} e_u(x_i,z_j),\n$$\nand\n$$\n\\|e_b\\|_{2} = \\sqrt{\\frac{1}{N^2}\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} e_b(x_i,z_j)^2},\\quad\n\\|e_b\\|_{\\infty} = \\max_{i,j} e_b(x_i,z_j).\n$$\n\nFor convergence testing under grid refinement, use the observed order of accuracy formula:\n$$\np = \\frac{\\log\\left(\\|e\\|_{N} / \\|e\\|_{2N}\\right)}{\\log\\left(h_{N} / h_{2N}\\right)} = \\frac{\\log\\left(\\|e\\|_{N} / \\|e\\|_{2N}\\right)}{\\log(2)},\n$$\nsince $h_{N} = L_x/N$ and $h_{2N} = L_x/(2N)$, and similarly for $z$. For a second-order finite-difference stencil on smooth fields, we expect $p \\approx 2$ for both $L_2$ and $L_\\infty$ norms.\n\nAlgorithmic design:\n1. For each test case $(k_x,k_z)$ and each $N\\in\\{128,256,512\\}$, generate uniform grids $x_i = i h_x$ and $z_j = j h_z$ with $i,j\\in\\{0,\\dots,N-1\\}$ and $h_x = 2\\pi/N$, $h_z = 2\\pi/N$.\n2. Construct $\\psi(x,z)$, then evaluate $u_x = \\partial \\psi/\\partial z = k_z \\cos(k_z z)\\sin(k_x x)$ and $u_z = -\\partial \\psi/\\partial x = -k_x \\cos(k_x x)\\sin(k_z z)$, and evaluate $b(x,z) = \\cos(k_x x)\\cos(k_z z)$.\n3. Compute the numerical Laplacian using second-order centered differences with periodic wrapping. Implement this as a function that uses array shifts (circular rolls) in both directions.\n4. Compute the exact Laplacian for each field as $-\\left(k_x^2 + k_z^2\\right)$ times the field.\n5. Form the error fields $e_{u_x}$, $e_{u_z}$, and $e_b$, and the vector magnitude $e_u$.\n6. Compute $\\|e_u\\|_2$, $\\|e_u\\|_\\infty$, $\\|e_b\\|_2$, and $\\|e_b\\|_\\infty$ for each $N$.\n7. Compute the observed orders $p$ for both norms and both fields for the transitions $128\\to 256$ and $256\\to 512$ using the logarithmic formula with $h$ ratios.\n8. Aggregate the results in the specified output order for each test case and print a single line containing all values as a comma-separated list in square brackets.\n\nThe test suite is chosen to assess:\n- A general \"happy path\" case with moderate isotropy, $(k_x,k_z)=(4,4)$.\n- An anisotropic case, $(k_x,k_z)=(16,8)$, with differing scales in each direction.\n- A near-Nyquist edge case in one direction, $(k_x,k_z)=(32,1)$, close to the Nyquist limit for $N=128$ (which has Nyquist wavenumber $k_{\\text{Ny}} = N/2 = 64$ in units of radians per unit length on $[0,2\\pi]$), probing sensitivity to high wavenumbers.\n\nUnder correct implementation, the observed orders $p$ should be close to $2$, consistent with second-order accuracy, although finite precision and anisotropy may induce small deviations. The outputs are dimensionless and angles are in radians. The final program must produce only the single line of results in the exact format specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef laplacian_periodic_2d(f, hx, hz):\n    \"\"\"\n    Compute the 2D periodic Laplacian of array f using second-order centered differences.\n    Periodic wrapping is enforced via np.roll. Grid spacings are hx and hz.\n    \"\"\"\n    # second derivative in x with periodic wrap\n    d2x = (np.roll(f, -1, axis=0) - 2.0 * f + np.roll(f, 1, axis=0)) / (hx * hx)\n    # second derivative in z with periodic wrap\n    d2z = (np.roll(f, -1, axis=1) - 2.0 * f + np.roll(f, 1, axis=1)) / (hz * hz)\n    return d2x + d2z\n\ndef manufactured_fields(kx, kz, N):\n    \"\"\"\n    Generate manufactured streamfunction psi, velocity components ux, uz,\n    and buoyancy b on an NxN periodic grid over [0, 2pi] x [0, 2pi].\n    \"\"\"\n    Lx = 2.0 * np.pi\n    Lz = 2.0 * np.pi\n    hx = Lx / N\n    hz = Lz / N\n\n    # Grid coordinates\n    x = np.arange(N) * hx\n    z = np.arange(N) * hz\n    X, Z = np.meshgrid(x, z, indexing='ij')\n\n    # Manufactured streamfunction and derived fields\n    psi = np.sin(kx * X) * np.sin(kz * Z)\n    ux = kz * np.cos(kz * Z) * np.sin(kx * X)\n    uz = -kx * np.cos(kx * X) * np.sin(kz * Z)\n    b = np.cos(kx * X) * np.cos(kz * Z)\n\n    return X, Z, hx, hz, psi, ux, uz, b\n\ndef norms_and_orders_for_case(kx, kz):\n    \"\"\"\n    For a given (kx, kz) test case, compute error norms at N=128,256,512\n    and observed orders for velocity and buoyancy.\n    Returns a list of 20 floats (see specified output format).\n    \"\"\"\n    Ns = [128, 256, 512]\n    Lx = 2.0 * np.pi\n    # Store norms for each N\n    vel_L2 = []\n    vel_Linf = []\n    b_L2 = []\n    b_Linf = []\n\n    k2 = (kx ** 2) + (kz ** 2)\n\n    for N in Ns:\n        # Build fields\n        X, Z, hx, hz, psi, ux, uz, b = manufactured_fields(kx, kz, N)\n\n        # Numerical laplacians\n        lap_ux_num = laplacian_periodic_2d(ux, hx, hz)\n        lap_uz_num = laplacian_periodic_2d(uz, hx, hz)\n        lap_b_num = laplacian_periodic_2d(b, hx, hz)\n\n        # Exact laplacians\n        lap_ux_exact = -k2 * ux\n        lap_uz_exact = -k2 * uz\n        lap_b_exact = -k2 * b\n\n        # Errors\n        e_ux = lap_ux_num - lap_ux_exact\n        e_uz = lap_uz_num - lap_uz_exact\n        e_b = lap_b_num - lap_b_exact\n\n        # Velocity magnitude error\n        e_u_mag = np.sqrt(e_ux * e_ux + e_uz * e_uz)\n\n        # Norms: L2 as sqrt(mean of squared), Linf as max abs\n        vel_L2.append(float(np.sqrt(np.mean(e_u_mag * e_u_mag))))\n        vel_Linf.append(float(np.max(e_u_mag)))\n        b_L2.append(float(np.sqrt(np.mean(e_b * e_b))))\n        b_Linf.append(float(np.max(np.abs(e_b))))\n\n    # Observed orders p between successive Ns using h ratios\n    # h_N / h_{2N} = 2\n    log2 = np.log(2.0)\n\n    def observed_orders(errs):\n        p12 = np.log(errs[0] / errs[1]) / log2\n        p23 = np.log(errs[1] / errs[2]) / log2\n        return float(p12), float(p23)\n\n    p_vel_L2_128_256, p_vel_L2_256_512 = observed_orders(vel_L2)\n    p_vel_Linf_128_256, p_vel_Linf_256_512 = observed_orders(vel_Linf)\n    p_b_L2_128_256, p_b_L2_256_512 = observed_orders(b_L2)\n    p_b_Linf_128_256, p_b_Linf_256_512 = observed_orders(b_Linf)\n\n    # Assemble results in specified order for this test case\n    result = [\n        vel_L2[0], vel_L2[1], vel_L2[2], p_vel_L2_128_256, p_vel_L2_256_512,\n        vel_Linf[0], vel_Linf[1], vel_Linf[2], p_vel_Linf_128_256, p_vel_Linf_256_512,\n        b_L2[0], b_L2[1], b_L2[2], p_b_L2_128_256, p_b_L2_256_512,\n        b_Linf[0], b_Linf[1], b_Linf[2], p_b_Linf_128_256, p_b_Linf_256_512\n    ]\n    return result\n\ndef solve():\n    # Define the test cases from the problem statement: (kx, kz)\n    test_cases = [\n        (4, 4),    # Test Case 1: happy path\n        (16, 8),   # Test Case 2: anisotropic\n        (32, 1)    # Test Case 3: near-Nyquist in x, low kz\n    ]\n\n    results = []\n    for kx, kz in test_cases:\n        case_results = norms_and_orders_for_case(kx, kz)\n        results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After running a forced turbulence simulation for many eddy turnover times, a critical question arises: has the flow reached a statistically stationary state? This exercise addresses the crucial post-processing step of verifying stationarity, without which time-averaged statistics are meaningless . You will design and implement a suite of quantitative diagnostics based on key turbulent quantities, learning how to confidently determine when your simulation is ready for statistical analysis.",
            "id": "3790053",
            "problem": "Consider a forced Direct Numerical Simulation (DNS) of three-dimensional, incompressible ocean turbulence in a periodic domain. Let $E(t)$ denote the kinetic energy per unit mass in $\\mathrm{m^2/s^2}$, let $\\epsilon(t)$ denote the turbulent kinetic energy dissipation rate in $\\mathrm{m^2/s^3}$, and let $E_1(k,t)$ denote the one-dimensional energy spectrum in $\\mathrm{m^3/s^2}$ such that the discrete spectral integral approximates $E(t)$, namely $\\sum_k E_1(k,t)\\Delta k \\approx E(t)$ for uniform wavenumber spacing $\\Delta k$. The eddy turnover time $T_{\\mathrm{ed}}$ is defined by $T_{\\mathrm{ed}} = L_{\\mathrm{int}}/U_{\\mathrm{rms}}$, where $L_{\\mathrm{int}}$ is the integral length scale in $\\mathrm{m}$ and $U_{\\mathrm{rms}}$ is the root-mean-square velocity in $\\mathrm{m/s}$.\n\nYou are to design diagnostics to verify statistical stationarity over multiple eddy turnover times by evaluating running averages of $E(t)$ and $\\epsilon(t)$ and by assessing spectral stationarity. The diagnostics must be built from the following fundamental bases:\n\n- Conservation of momentum for an incompressible Newtonian fluid implies the evolution of velocity $u_i(\\mathbf{x},t)$ according to the Navier–Stokes equations, and the turbulent kinetic energy per unit mass is $E(t) = \\frac{1}{2}\\langle u_i u_i \\rangle$, where $\\langle \\cdot \\rangle$ denotes a spatial average.\n- The turbulent kinetic energy dissipation rate is $\\epsilon(t) = 2\\nu \\langle s_{ij} s_{ij} \\rangle$, where $\\nu$ is the kinematic viscosity in $\\mathrm{m^2/s}$ and $s_{ij} = \\frac{1}{2}\\left(\\partial_j u_i + \\partial_i u_j\\right)$ is the rate-of-strain tensor.\n- The one-dimensional spectrum $E_1(k,t)$ satisfies $\\int_0^\\infty E_1(k,t)\\,\\mathrm{d}k = E(t)$ in the continuous limit.\n\nDefine non-overlapping time windows of duration $T_w = N_{\\mathrm{ed}} T_{\\mathrm{ed}}$, where $N_{\\mathrm{ed}}$ is a positive real number, and compute per-window time averages $\\overline{E}_i$ and $\\overline{\\epsilon}_i$ and per-window, time-averaged spectra $\\overline{E}_{1,i}(k)$, indexed by window $i$. Using these, implement the following acceptance criteria for stationarity:\n\n1. Running-average stationarity of $E(t)$ and $\\epsilon(t)$:\n   - Range criterion: For $x \\in \\{E,\\epsilon\\}$, compute $R_x = \\left(\\max_i \\overline{x}_i - \\min_i \\overline{x}_i\\right)/\\overline{x}$, where $\\overline{x}$ is the mean of all $\\overline{x}_i$. Require $R_E \\le \\tau_{\\mathrm{rng},E}$ and $R_\\epsilon \\le \\tau_{\\mathrm{rng},\\epsilon}$.\n   - Trend criterion: Fit a least-squares line $\\overline{x}_i \\approx m_x t_i + b_x$ to window means versus window-center times $t_i$ (in $\\mathrm{s}$). Define a dimensionless slope metric $S_x = |m_x|T_{\\mathrm{ed}}/\\overline{x}$. Require $S_E \\le \\tau_{\\mathrm{slp},E}$ and $S_\\epsilon \\le \\tau_{\\mathrm{slp},\\epsilon}$.\n\n2. Spectral stationarity:\n   - Inter-window change: For consecutive windows, compute the normalized root-mean-square difference $D_i = \\sqrt{\\sum_{k\\in\\mathcal{K}} \\left(\\overline{E}_{1,i}(k) - \\overline{E}_{1,i-1}(k)\\right)^2 \\big/ \\sum_{k\\in\\mathcal{K}} \\overline{E}_{1,i-1}(k)^2}$ over an inertial-range wavenumber set $\\mathcal{K}$. Require $\\max_i D_i \\le \\tau_{\\mathrm{spec}}$.\n   - Compensated flatness: For each window, form the compensated spectrum $C_i(k) = k^{5/3}\\,\\overline{E}_{1,i}(k)$ over $k\\in\\mathcal{K}$ and compute the coefficient of variation $\\mathrm{CV}_i = \\mathrm{std}(C_i(k))/\\mathrm{mean}(C_i(k))$. Require $\\max_i \\mathrm{CV}_i \\le \\tau_{\\mathrm{comp}}$.\n\nAcceptance requires all criteria to be satisfied and that the number of windows is at least $3$; otherwise, reject stationarity.\n\nIn the absence of full DNS fields, implement a physically consistent synthetic generator for test data:\n\n- Generate $E(t)$ and $\\epsilon(t)$ as independent mean-reverting Ornstein–Uhlenbeck processes with optional slow linear drift. For a process $x(t)$ with mean $\\mu_x$, relaxation rate $\\theta_x$ in $\\mathrm{s^{-1}}$, volatility parameter $\\sigma_x$ in the same units as $x$, and fractional drift $d_x$ over the full duration $T_{\\mathrm{tot}}$, use the discrete-time update $x_{n+1} = x_n + \\theta_x\\left(\\mu_x - x_n\\right)\\Delta t + \\sigma_x\\sqrt{\\Delta t}\\,\\xi_n + \\left(d_x\\,\\mu_x/T_{\\mathrm{tot}}\\right)\\Delta t$, where $\\xi_n$ are independent standard normal variates and $\\Delta t$ is the sampling interval in $\\mathrm{s}$. Enforce positivity of $x_n$.\n- Generate $E_1(k,t)$ on a discrete wavenumber grid $k = 1,2,\\dots,k_{\\max}$ with $\\Delta k = 1\\,\\mathrm{m^{-1}}$ from a shape $F(k) = k^{-5/3}\\exp\\left[-(k/k_d)^2\\right]$ with a localized modulation $g(k) = \\exp\\left[-(k-k_0)^2/(2\\sigma_g^2)\\right]$, time-dependent shape amplitude $a(t) = A_{\\mathrm{shp}}\\sin\\left(2\\pi t/T_{\\mathrm{osc}}\\right)$, and small additive spectral noise of amplitude $A_{\\mathrm{wn}}$. Define an unnormalized shape $M(k,t) = F(k)\\left(1 + a(t) g(k) + \\eta_k(t)\\right)$ with $\\eta_k(t)$ independent, zero-mean noise, then set $E_1(k,t) = E(t)\\,M(k,t)/\\sum_{j} M(j,t)\\Delta k$ to enforce $\\sum_k E_1(k,t)\\Delta k = E(t)$; clip $M(k,t)$ to remain positive.\n\nUse the inertial-range set $\\mathcal{K} = \\{k\\in\\mathbb{N}: k_{\\min}\\le k \\le k_{\\max,\\mathrm{IR}}\\}$.\n\nTest Suite. Implement the program to evaluate the acceptance criteria for the following parameter sets. All times must be in $\\mathrm{s}$, lengths in $\\mathrm{m}$, velocities in $\\mathrm{m/s}$, energies in $\\mathrm{m^2/s^2}$, dissipation rates in $\\mathrm{m^2/s^3}$, and wavenumbers in $\\mathrm{m^{-1}}$.\n\n- Case $1$ (happy path, stationary):\n  - $T_{\\mathrm{tot}} = 300$, $\\Delta t = 0.5$, $L_{\\mathrm{int}} = 1.5$, $U_{\\mathrm{rms}} = 0.1$, so $T_{\\mathrm{ed}} = 15$.\n  - $N_{\\mathrm{ed}} = 2$ so $T_w = 30$. $k_{\\max} = 64$, $k_d = 32$, $k_{\\min} = 6$, $k_{\\max,\\mathrm{IR}} = 20$, $k_0 = 14$, $\\sigma_g = 4$.\n  - $\\mu_E = 0.005$, $\\mu_\\epsilon = 5\\times 10^{-8}$, $\\theta_E = 1/T_{\\mathrm{ed}}$, $\\theta_\\epsilon = 1/T_{\\mathrm{ed}}$, $\\sigma_E = 0.05\\,\\mu_E$, $\\sigma_\\epsilon = 0.1\\,\\mu_\\epsilon$, $d_E = 0$, $d_\\epsilon = 0$.\n  - $A_{\\mathrm{shp}} = 0.05$, $A_{\\mathrm{wn}} = 0.02$, $T_{\\mathrm{osc}} = 120$.\n  - Tolerances: $\\tau_{\\mathrm{rng},E} = 0.2$, $\\tau_{\\mathrm{rng},\\epsilon} = 0.2$, $\\tau_{\\mathrm{slp},E} = 0.05$, $\\tau_{\\mathrm{slp},\\epsilon} = 0.05$, $\\tau_{\\mathrm{spec}} = 0.25$, $\\tau_{\\mathrm{comp}} = 0.25$.\n- Case $2$ (non-stationary drift):\n  - Same as Case $1$, except $d_E = 0.3$, $d_\\epsilon = -0.3$.\n- Case $3$ (spectral oscillations):\n  - Same as Case $1$, except $A_{\\mathrm{shp}} = 0.6$, $A_{\\mathrm{wn}} = 0.1$, $T_{\\mathrm{osc}} = 60$.\n- Case $4$ (short run, insufficient windows):\n  - $T_{\\mathrm{tot}} = 40$, $\\Delta t = 0.5$, $L_{\\mathrm{int}} = 1.5$, $U_{\\mathrm{rms}} = 0.1$, $T_{\\mathrm{ed}} = 15$, $N_{\\mathrm{ed}} = 2$, and spectral parameters identical to Case $1$; tolerances identical to Case $1$.\n\nYour program should, for each case, synthesize $E(t)$, $\\epsilon(t)$, and $E_1(k,t)$ from the specified parameters, compute the diagnostics, and then return whether statistical stationarity is accepted according to the criteria. The final output format must be a single line containing the results as a comma-separated list enclosed in square brackets of booleans in Python syntax (e.g., $\\left[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False}\\right]$). No additional text may be printed.",
            "solution": "The problem requires the design and implementation of a set of diagnostics to verify the statistical stationarity of data from a Direct Numerical Simulation (DNS) of ocean turbulence. This is a critical step in the post-processing of any long-running simulation intended to produce time-averaged statistics. Statistical stationarity implies that statistical properties, such as means, variances, and spectra, are invariant under time translation. The provided methodology assesses this property through a series of quantitative checks on scalar time series and spectral data.\n\nThe core of the task is to implement a validation algorithm based on user-defined criteria and test it on synthetically generated data that mimics the behavior of real turbulence data. The synthetic data generation is a means to an end—to produce test data for the diagnostic tool itself.\n\nThe scientific principles grounding the diagnostic criteria are derived from the statistical theory of homogeneous turbulence. The key quantities are the total kinetic energy per unit mass, $E(t)$, its dissipation rate, $\\epsilon(t)$, and the one-dimensional energy spectrum, $E_1(k,t)$. For statistically stationary turbulence, the long-time averages of $E(t)$ and $\\epsilon(t)$ should converge to constant values. Furthermore, the shape of the energy spectrum $E_1(k,t)$, particularly in the inertial subrange, should also be statistically stable.\n\nThe algorithmic design proceeds in two main stages: data generation and stationarity analysis.\n\n**1. Synthetic Data Generation**\n\nTo test the diagnostic procedures without access to full DNS results, we first generate physically plausible synthetic data.\n\n-   **Scalar Time Series ($E(t)$ and $\\epsilon(t)$):** The kinetic energy $E(t)$ and dissipation rate $\\epsilon(t)$ in a forced turbulent flow fluctuate around a mean value. The Ornstein-Uhlenbeck (OU) process is an appropriate stochastic model for such mean-reverting behavior. The discrete-time update equation provided models this process with an Euler-Maruyama scheme:\n    $$x_{n+1} = x_n + \\theta_x\\left(\\mu_x - x_n\\right)\\Delta t + \\sigma_x\\sqrt{\\Delta t}\\,\\xi_n + \\left(d_x\\,\\mu_x/T_{\\mathrm{tot}}\\right)\\Delta t$$\n    Here, $x_n$ represents either $E$ or $\\epsilon$ at time step $n$. The term $\\theta_x(\\mu_x - x_n)\\Delta t$ drives the process back towards its mean $\\mu_x$ with a relaxation timescale of $1/\\theta_x$. The term $\\sigma_x\\sqrt{\\Delta t}\\,\\xi_n$ introduces stochastic fluctuations, where $\\xi_n$ is a standard normal random variable. The final term introduces a slow linear drift, proportional to the fractional drift parameter $d_x$, to model non-stationary behavior. Since both $E(t)$ and $\\epsilon(t)$ are physically non-negative, any generated value $x_{n+1}$ that falls below zero must be clipped to a small positive value or zero.\n\n-   **Energy Spectrum Time Series ($E_1(k,t)$):** The one-dimensional energy spectrum $E_1(k,t)$ is generated to conform to established turbulence theory and to satisfy the conservation constraint $\\sum_k E_1(k,t)\\Delta k = E(t)$.\n    -   The spectral shape is based on the form $F(k) = k^{-5/3}\\exp\\left[-(k/k_d)^2\\right]$. The $k^{-5/3}$ term reflects the Kolmogorov scaling for the inertial subrange of turbulence, while the exponential term models the viscous roll-off at high wavenumbers (dissipation range), characterized by the dissipation wavenumber $k_d$.\n    -   Non-stationarity and fluctuations are introduced via a time-dependent modulation, $M(k,t) = F(k)(1 + a(t) g(k) + \\eta_k(t))$, where $a(t)$ is a sinusoidal function to model periodic spectral adjustments, $g(k)$ localizes this effect in wavenumber space, and $\\eta_k(t)$ is a small-amplitude random noise field. Positivity of $M(k,t)$ is enforced by clipping.\n    -   Finally, the spectrum at each time step is normalized to ensure its integral equals the total kinetic energy $E(t)$ generated by the OU process:\n        $$E_1(k,t) = E(t)\\frac{M(k,t)}{\\sum_{j} M(j,t)\\Delta k}$$\n    This step ensures consistency between the scalar energy time series and the spectral data.\n\n**2. Stationarity Analysis**\n\nThe core of the algorithm involves analyzing the generated time series over a set of non-overlapping windows. Let the total simulation time be $T_{\\mathrm{tot}}$ and the sampling interval be $\\Delta t$. The data is partitioned into $N_w = \\lfloor T_{\\mathrm{tot}} / T_w \\rfloor$ windows, each of duration $T_w = N_{\\mathrm{ed}} T_{\\mathrm{ed}}$, where $T_{\\mathrm{ed}}$ is the eddy turnover time. An essential preliminary check is that $N_w \\ge 3$, as robust statistical analysis is not possible with fewer than three data points (window averages).\n\nFor each window $i$, we compute the time-averaged quantities $\\overline{E}_i$, $\\overline{\\epsilon}_i$, and the time-averaged spectrum $\\overline{E}_{1,i}(k)$. These windowed averages form the basis for the stationarity tests.\n\n-   **Criterion 1: Running-average stationarity:** This criterion assesses the stability of the mean energy and dissipation rate over time.\n    -   **Range criterion:** It measures the total variation in the window-averaged values. The metric $R_x = (\\max_i \\overline{x}_i - \\min_i \\overline{x}_i)/\\overline{x}$ is the range of window means normalized by the global mean $\\overline{x} = \\mathrm{mean}_i(\\overline{x}_i)$. A small value of $R_x$ indicates that the window averages do not vary wildly. The test requires $R_E \\le \\tau_{\\mathrm{rng},E}$ and $R_\\epsilon \\le \\tau_{\\mathrm{rng},\\epsilon}$.\n    -   **Trend criterion:** It checks for a systematic drift over time. A linear model $\\overline{x}_i \\approx m_x t_i + b_x$ is fitted to the window means versus their center times $t_i$ using a least-squares regression. The slope $m_x$ indicates the rate of change. The dimensionless slope metric $S_x = |m_x|T_{\\mathrm{ed}}/\\overline{x}$ normalizes this slope by the characteristic timescale ($T_{\\mathrm{ed}}$) and value ($\\overline{x}$) of the system. A small $S_x$ suggests the absence of a significant linear trend. The test requires $S_E \\le \\tau_{\\mathrm{slp},E}$ and $S_\\epsilon \\le \\tau_{\\mathrm{slp},\\epsilon}$.\n\n-   **Criterion 2: Spectral stationarity:** This criterion assesses the stability of the energy distribution across wavenumbers. The analysis is focused on a specified inertial-range wavenumber set $\\mathcal{K} = \\{k\\in\\mathbb{N}: k_{\\min}\\le k \\le k_{\\max,\\mathrm{IR}}\\}$.\n    -   **Inter-window change:** This test quantifies how much the average spectral shape changes between consecutive windows. The normalized root-mean-square difference,\n        $$D_i = \\sqrt{\\frac{\\sum_{k\\in\\mathcal{K}} \\left(\\overline{E}_{1,i}(k) - \\overline{E}_{1,i-1}(k)\\right)^2}{\\sum_{k\\in\\mathcal{K}} \\overline{E}_{1,i-1}(k)^2}}$$\n        is computed for all adjacent window pairs. A small value of $D_i$ indicates that the spectrum in window $i$ is very similar to that in window $i-1$. The criterion requires that the maximum change observed, $\\max_i D_i$, is below a threshold $\\tau_{\\mathrm{spec}}$.\n    -   **Compensated flatness:** This is a direct test of the Kolmogorov $k^{-5/3}$ scaling law. For a spectrum following this law, the compensated spectrum $C_i(k) = k^{5/3}\\,\\overline{E}_{1,i}(k)$ should be flat (constant) over the inertial range $\\mathcal{K}$. We quantify the flatness by computing the coefficient of variation, $\\mathrm{CV}_i = \\mathrm{std}_{k\\in\\mathcal{K}}(C_i(k))/\\mathrm{mean}_{k\\in\\mathcal{K}}(C_i(k))$. A small $\\mathrm{CV}_i$ indicates a flat compensated spectrum, consistent with a stable inertial range. The criterion requires $\\max_i \\mathrm{CV}_i \\le \\tau_{\\mathrm{comp}}$.\n\nA case is deemed \"stationary\" only if it passes all applicable criteria, including the initial check on the number of windows. The implementation will systematically apply these checks to each of the four test cases defined in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_ou_process(t, mu, theta, sigma, d, T_tot):\n    \"\"\"\n    Generates a time series using a mean-reverting Ornstein-Uhlenbeck process\n    with optional linear drift.\n    \"\"\"\n    num_steps = len(t)\n    dt = t[1] - t[0]\n    x = np.zeros(num_steps)\n    x[0] = mu\n    sqrt_dt = np.sqrt(dt)\n    \n    # Pre-calculate drift term per step\n    drift_term_per_step = (d * mu / T_tot) * dt if T_tot > 0 else 0\n\n    for n in range(num_steps - 1):\n        ou_term = theta * (mu - x[n]) * dt\n        random_term = sigma * sqrt_dt * np.random.randn()\n        x[n + 1] = x[n] + ou_term + random_term + drift_term_per_step\n        # Enforce positivity\n        x[n + 1] = max(1e-12, x[n + 1])\n    return x\n\ndef generate_spectrum(t, k_grid, E_t, params):\n    \"\"\"\n    Generates a time-evolving energy spectrum E_1(k,t).\n    \"\"\"\n    k_d = params['k_d']\n    k_0 = params['k_0']\n    sigma_g = params['sigma_g']\n    A_shp = params['A_shp']\n    A_wn = params['A_wn']\n    T_osc = params['T_osc']\n    dk = 1.0 # as specified, delta k = 1\n\n    num_k = len(k_grid)\n    num_t = len(t)\n    E1_k_t = np.zeros((num_k, num_t))\n\n    F_k = k_grid**(-5.0/3.0) * np.exp(-(k_grid / k_d)**2)\n    g_k = np.exp(-(k_grid - k_0)**2 / (2 * sigma_g**2))\n\n    for n in range(num_t):\n        tn = t[n]\n        a_t = A_shp * np.sin(2 * np.pi * tn / T_osc)\n        eta_k_t = np.random.uniform(-A_wn, A_wn, size=k_grid.shape)\n        \n        M_k_t = F_k * (1 + a_t * g_k + eta_k_t)\n        # Enforce positivity\n        M_k_t = np.maximum(1e-12, M_k_t)\n        \n        normalization = np.sum(M_k_t * dk)\n        if normalization > 0:\n            E1_k_t[:, n] = E_t[n] * M_k_t / normalization\n        else:\n            E1_k_t[:, n] = 0\n\n    return E1_k_t\n\ndef check_stationarity(t, E_t, eps_t, E1_k_t, k_grid, params):\n    \"\"\"\n    Performs the full stationarity analysis based on the provided criteria.\n    \"\"\"\n    T_tot = params['T_tot']\n    dt = params['dt']\n    T_ed = params['T_ed']\n    T_w = params['T_w']\n    \n    num_steps = len(t)\n    steps_per_window = int(round(T_w / dt))\n    num_windows = num_steps // steps_per_window\n\n    if num_windows  3:\n        return False\n\n    # Windowed averages\n    E_bar_i = np.zeros(num_windows)\n    eps_bar_i = np.zeros(num_windows)\n    E1_bar_i_k = np.zeros((len(k_grid), num_windows))\n    window_center_times = np.zeros(num_windows)\n\n    for i in range(num_windows):\n        start_idx = i * steps_per_window\n        end_idx = start_idx + steps_per_window\n        \n        E_bar_i[i] = np.mean(E_t[start_idx:end_idx])\n        eps_bar_i[i] = np.mean(eps_t[start_idx:end_idx])\n        E1_bar_i_k[:, i] = np.mean(E1_k_t[:, start_idx:end_idx], axis=1)\n        window_center_times[i] = np.mean(t[start_idx:end_idx])\n        \n    # --- Criterion 1: Running-average stationarity ---\n    tau_rng_E = params['tau_rng_E']\n    tau_rng_eps = params['tau_rng_eps']\n    tau_slp_E = params['tau_slp_E']\n    tau_slp_eps = params['tau_slp_eps']\n\n    # Range criterion\n    E_bar = np.mean(E_bar_i)\n    R_E = (np.max(E_bar_i) - np.min(E_bar_i)) / E_bar if E_bar > 0 else 0\n    if R_E > tau_rng_E: return False\n    \n    eps_bar = np.mean(eps_bar_i)\n    R_eps = (np.max(eps_bar_i) - np.min(eps_bar_i)) / eps_bar if eps_bar > 0 else 0\n    if R_eps > tau_rng_eps: return False\n\n    # Trend criterion\n    m_E, _ = np.polyfit(window_center_times, E_bar_i, 1)\n    S_E = abs(m_E) * T_ed / E_bar if E_bar > 0 else 0\n    if S_E > tau_slp_E: return False\n\n    m_eps, _ = np.polyfit(window_center_times, eps_bar_i, 1)\n    S_eps = abs(m_eps) * T_ed / eps_bar if eps_bar > 0 else 0\n    if S_eps > tau_slp_eps: return False\n\n    # --- Criterion 2: Spectral stationarity ---\n    tau_spec = params['tau_spec']\n    tau_comp = params['tau_comp']\n    k_min = params['k_min']\n    k_max_IR = params['k_max_IR']\n    \n    k_inertial_mask = (k_grid >= k_min)  (k_grid = k_max_IR)\n    k_inertial = k_grid[k_inertial_mask]\n\n    # Inter-window change\n    max_D = 0.0\n    for i in range(1, num_windows):\n        E1_curr = E1_bar_i_k[k_inertial_mask, i]\n        E1_prev = E1_bar_i_k[k_inertial_mask, i - 1]\n        \n        numerator = np.sum((E1_curr - E1_prev)**2)\n        denominator = np.sum(E1_prev**2)\n        \n        D_i = np.sqrt(numerator / denominator) if denominator > 0 else 0\n        if D_i > max_D:\n            max_D = D_i\n    if max_D > tau_spec: return False\n\n    # Compensated flatness\n    max_CV = 0.0\n    for i in range(num_windows):\n        E1_win = E1_bar_i_k[k_inertial_mask, i]\n        C_i_k = k_inertial**(5.0/3.0) * E1_win\n        \n        mean_C = np.mean(C_i_k)\n        std_C = np.std(C_i_k)\n        \n        CV_i = std_C / mean_C if mean_C > 0 else 0\n        if CV_i > max_CV:\n            max_CV = CV_i\n    if max_CV > tau_comp: return False\n    \n    return True\n\ndef analyze_case(params):\n    T_tot = params['T_tot']\n    dt = params['dt']\n    L_int = params['L_int']\n    U_rms = params['U_rms']\n    N_ed = params['N_ed']\n    \n    T_ed = L_int / U_rms\n    T_w = N_ed * T_ed\n\n    params['T_ed'] = T_ed\n    params['T_w'] = T_w\n    \n    num_steps = int(T_tot / dt)\n    t = np.linspace(0, T_tot - dt, num_steps)\n\n    # Generate data\n    E_t = generate_ou_process(t, params['mu_E'], params['theta_E'], params['sigma_E'], params['d_E'], T_tot)\n    eps_t = generate_ou_process(t, params['mu_eps'], params['theta_eps'], params['sigma_eps'], params['d_eps'], T_tot)\n\n    k_grid = np.arange(1, params['k_max'] + 1)\n    E1_k_t = generate_spectrum(t, k_grid, E_t, params)\n    \n    # Check for stationarity\n    return check_stationarity(t, E_t, eps_t, E1_k_t, k_grid, params)\n\n\ndef solve():\n    np.random.seed(0)\n\n    base_params = {\n        'T_tot': 300.0, 'dt': 0.5, 'L_int': 1.5, 'U_rms': 0.1,\n        'N_ed': 2.0, 'k_max': 64, 'k_d': 32, 'k_min': 6, 'k_max_IR': 20,\n        'k_0': 14, 'sigma_g': 4,\n        'mu_E': 0.005, 'mu_eps': 5e-8,\n        'theta_E': 1.0 / (1.5 / 0.1), 'theta_eps': 1.0 / (1.5 / 0.1),\n        'sigma_E': 0.05 * 0.005, 'sigma_eps': 0.1 * 5e-8,\n        'd_E': 0.0, 'd_eps': 0.0,\n        'A_shp': 0.05, 'A_wn': 0.02, 'T_osc': 120.0,\n        'tau_rng_E': 0.2, 'tau_rng_eps': 0.2, 'tau_slp_E': 0.05,\n        'tau_slp_eps': 0.05, 'tau_spec': 0.25, 'tau_comp': 0.25\n    }\n\n    # Case 1: happy path, stationary\n    case1_params = base_params.copy()\n\n    # Case 2: non-stationary drift\n    case2_params = base_params.copy()\n    case2_params.update({'d_E': 0.3, 'd_eps': -0.3})\n\n    # Case 3: spectral oscillations\n    case3_params = base_params.copy()\n    case3_params.update({'A_shp': 0.6, 'A_wn': 0.1, 'T_osc': 60.0})\n    \n    # Case 4: short run, insufficient windows\n    case4_params = base_params.copy()\n    case4_params.update({'T_tot': 40.0})\n\n    test_cases = [case1_params, case2_params, case3_params, case4_params]\n    \n    results = []\n    for case_params in test_cases:\n        result = analyze_case(case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}