{
    "hands_on_practices": [
        {
            "introduction": "实践的第一步是建立对亥姆霍兹分解数值算法的信心。本练习将指导您完成一个“往返”计算：首先从已知的流函数 $\\psi$ 和速度势 $\\phi$ 出发，构造一个精确的速度场 $\\mathbf{u}$。接着，您将利用这个速度场作为“观测”数据，通过求解泊松方程来反演计算 $\\psi$ 和 $\\phi$，并最终将重构的速度场与原始场进行比较，以量化整个过程的数值精度。这个练习对于掌握在周期性域上使用谱方法进行亥姆霍兹分解至关重要。",
            "id": "3787062",
            "problem": "考虑一个水平二维海洋表面速度场 $\\mathbf{u}(x,y,t)$，该场定义在一个长度分别为 $L_x$ 和 $L_y$ 米的矩形周期性域上。假设该场足够光滑且衰减速度不快于多项式，因此经典矢量微积分适用。使用以下基本原理：\n\n- 周期性域上的亥姆霍兹分解：任何光滑矢量场都可以表示为一个无旋分量（标量势的梯度）和一个螺线分量（流函数的斜梯度）之和。\n- 散度和垂直涡度的定义：对于 $\\mathbf{u}=(u,v)$，$\\nabla\\cdot\\mathbf{u}=\\partial_x u+\\partial_y v$（单位为 $\\mathrm{s}^{-1}$）以及 $\\zeta=\\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})=\\partial_x v-\\partial_y u$（单位也为 $\\mathrm{s}^{-1}$），其中 $\\hat{\\mathbf{k}}$ 是垂直于水平面的单位矢量。\n- 拉普拉斯算子的定义 $\\nabla^2=\\partial_x^2+\\partial_y^2$。\n\n从这些基础出发，推导如何通过求解周期性域上的泊松方程得到的势函数 $\\phi$ 和流函数 $\\psi$ 来重建 $\\mathbf{u}$，并用残余散度和残余垂直涡度来量化重建误差。\n\n您的程序必须以纯数学术语实现以下步骤：\n\n1. 通过组合由标量势 $\\phi_{\\mathrm{true}}(x,y)$ 生成的无旋分量和由流函数 $\\psi_{\\mathrm{true}}(x,y)$ 生成的螺线分量，构建一个合成的光滑“真实”速度场 $\\mathbf{u}_{\\mathrm{true}}(x,y)$。该场定义在一个 $[0,L_x)\\times[0,L_y)$ 上的 $N_x\\times N_y$ 点均匀网格上，具有周期性边界条件。使用以下形式\n   - $\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)$,\n   - $\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)$,\n   其中 $A_\\phi$ 和 $A_\\psi$ 是振幅，单位为 $\\mathrm{m}^2/\\mathrm{s}$，$n,m,p,q$ 是控制空间尺度的非负整数。根据这些，依据亥姆霍兹分解所蕴含的、连接速度与势函数的基本定义来计算 $\\mathbf{u}_{\\mathrm{true}}$（不要使用任何超出所提供基础可推导范围的快捷公式）。\n\n2. 使用尊重周期性边界条件的数学上有效的方法计算 $\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$ 和 $\\zeta_{\\mathrm{true}}$。\n\n3. 在周期性域上求解势函数和流函数的泊松方程，\n   - $\\nabla^2\\phi=\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$,\n   - $\\nabla^2\\psi=\\zeta_{\\mathrm{true}}$,\n   通过将 $\\phi$ 和 $\\psi$ 的零波数傅里叶分量设为零（即零均值）来固定规范。\n\n4. 仅根据基础定义所蕴含的分解，从计算出的 $\\phi$ 和 $\\psi$ 重建速度场 $\\mathbf{u}_{\\mathrm{rec}}$。\n\n5. 根据以下指标量化重建误差：\n   - 残余散度 $r_{\\mathrm{div}}=\\left(\\mathrm{RMS}\\left[\\nabla\\cdot(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$,\n   - 残余垂直涡度 $r_{\\mathrm{vort}}=\\left(\\mathrm{RMS}\\left[\\hat{\\mathbf{k}}\\cdot\\nabla\\times(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$。\n   $r_{\\mathrm{div}}$ 和 $r_{\\mathrm{vort}}$ 都必须以 $\\mathrm{s}^{-1}$ 为单位报告。\n\n实现约束：\n- 在 $x$ 和 $y$ 方向上均使用均匀网格和周期性边界条件。\n- 使用一种适用于周期性域的、谱方法一致的微分和泊松方程求解方法。\n\n测试套件：\n为以下四个参数集运行您的程序，每个参数集由 $(N_x,N_y,L_x,L_y,A_\\phi,A_\\psi,n,m,p,q)$ 定义：\n- 情况 1：$(128,128,1.2\\times 10^6,8.0\\times 10^5,7.5\\times 10^4,5.0\\times 10^4,4,5,3,2)$。\n- 情况 2（纯无旋）：$(128,128,1.0\\times 10^6,1.0\\times 10^6,6.0\\times 10^4,0.0,6,5,1,1)$。\n- 情况 3（纯螺线）：$(128,128,9.0\\times 10^5,1.1\\times 10^6,0.0,8.5\\times 10^4,1,1,7,4)$。\n- 情况 4（$\\phi$ 中有一个零模式的各向异性）：$(96,96,8.0\\times 10^5,6.0\\times 10^5,2.5\\times 10^4,3.0\\times 10^4,0,8,10,1)$。\n\n答案规范：\n- 对于每种情况，返回一个包含两个浮点数的列表 $[r_{\\mathrm{div}},r_{\\mathrm{vort}}]$，单位为 $\\mathrm{s}^{-1}$。\n- 您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每种情况的结果本身也是一个列表，例如 $[[r_{\\mathrm{div},1},r_{\\mathrm{vort},1}],[r_{\\mathrm{div},2},r_{\\mathrm{vort},2}],\\dots]$。",
            "solution": "用户的请求已通过验证，被认为是一个有效且适定的科学问题。尽管使用了“斜梯度”这一术语（该术语有两种符号相反的常见定义），但问题提供了明确的泊松方程 $\\nabla^2\\psi=\\zeta$。该方程消除了流函数 $\\psi$ 和速度场之间所需关系的歧义。唯一数学上一致的表述是垂直涡度 $\\zeta$ 是流函数的拉普拉斯。这需要一个特定的符号约定，我们将采用该约定。因此，该问题是内部一致且可解的。\n\n我们继续进行基于原理的详细解答。\n\n### 基于原理的设计\n\n此问题的核心是二维周期性环面上的亥姆霍兹-霍奇分解。该定理指出，任何足够光滑的矢量场 $\\mathbf{u}$ 都可以唯一地分解为一个无散度（螺线）分量和一个无旋分量。\n\n无旋分量是标量势 $\\phi$ 的梯度，记为 $\\mathbf{u}_{\\phi} = \\nabla \\phi$。根据构造，其旋度为零：$\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$。\n\n螺线分量源自流函数 $\\psi$。问题指出，该分量是“流函数的斜梯度”，并提供了泊松方程 $\\nabla^2\\psi = \\zeta$，其中 $\\zeta = \\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})$ 是垂直涡度。让我们推导其精确关系。设螺线速度分量为 $\\mathbf{u}_{\\psi} = (u_{\\psi}, v_{\\psi})$。为使该场是螺线场，其散度必须为零：$\\nabla \\cdot \\mathbf{u}_{\\psi} = \\partial_x u_{\\psi} + \\partial_y v_{\\psi} = 0$。此条件意味着存在一个标量场 $\\psi$，使得 $u_{\\psi} = -\\partial_y \\psi$ 和 $v_{\\psi} = \\partial_x \\psi$（或两者皆为负）。采用此约定，我们来计算该分量的涡度：\n$$\n\\zeta_{\\psi} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\psi}) = \\partial_x v_{\\psi} - \\partial_y u_{\\psi} = \\partial_x(\\partial_x \\psi) - \\partial_y(-\\partial_y \\psi) = \\partial_x^2 \\psi + \\partial_y^2 \\psi = \\nabla^2 \\psi\n$$\n这个结果 $\\zeta_{\\psi} = \\nabla^2 \\psi$ 与问题陈述中给出的泊松方程 $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$ 一致。另一种约定 $\\mathbf{u}_{\\psi} = (\\partial_y \\psi, -\\partial_x \\psi)$ 将导致 $\\zeta_{\\psi} = -\\nabla^2 \\psi$，与问题的表述相矛盾。因此，我们必须根据势函数 $\\phi$ 和流函数 $\\psi$ 定义总速度场 $\\mathbf{u}=(u,v)$ 如下：\n$$\n\\mathbf{u} = \\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi\n$$\n或者用分量形式表示：\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\\\\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\n完整的分解过程涉及求取总速度场的散度和旋度：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi + \\nabla \\cdot (\\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi\n$$\n$$\n\\hat{\\mathbf{k}} \\cdot (\\nabla \\times \\mathbf{u}) = \\zeta = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\nabla^2 \\psi\n$$\n因此，要从 $\\mathbf{u}$ 中求得 $\\phi$ 和 $\\psi$，必须求解问题中指定的两个泊松方程。然后，从 $\\phi$ 和 $\\psi$ 重建 $\\mathbf{u}$ 的过程使用上面推导的分量关系。\n\n数值实现将利用周期性域上傅里叶变换的性质，它为微分和求解泊松方程提供了一种谱精确的方法。\n\n#### 步骤 1：构建“真实”速度场\n\n首先，我们定义一个包含 $N_x \\times N_y$ 个点的离散网格，覆盖域 $[0, L_x) \\times [0, L_y)$。网格坐标为 $(x_i, y_j)$，其中 $i \\in \\{0, ..., N_x-1\\}$ 且 $j \\in \\{0, ..., N_y-1\\}$。\n真实标量势 $\\phi_{\\mathrm{true}}$ 和流函数 $\\psi_{\\mathrm{true}}$ 由下式给出：\n$$\n\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)\n$$\n$$\n\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n使用上面推导的一致关系，真实速度场 $\\mathbf{u}_{\\mathrm{true}} = (u_{\\mathrm{true}}, v_{\\mathrm{true}})$ 的分量解析式为：\n$$\nu_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial x} - \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial y} = -A_\\phi\\frac{2\\pi n}{L_x}\\sin\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right) - A_\\psi\\frac{2\\pi q}{L_y}\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\cos\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n$$\nv_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial y} + \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial x} = A_\\phi\\frac{2\\pi m}{L_y}\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m y}{L_y}\\right) + A_\\psi\\frac{2\\pi p}{L_x}\\cos\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n将在离散网格上对这些表达式求值，以生成合成的“真实”速度场。\n\n#### 步骤 2：计算真实场的散度和涡度\n\n对于周期性网格上的函数 $f(x,y)$，其偏导数可以通过谱方法计算。设 $\\hat{f}(k_x, k_y)$ 是 $f$ 的二维离散傅里叶变换。其偏导数的傅里叶变换为：\n$$\n\\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial x}\\right\\} = i k_x \\hat{f}(k_x, k_y) \\quad , \\quad \\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial y}\\right\\} = i k_y \\hat{f}(k_x, k_y)\n$$\n其中 $(k_x, k_y)$ 是对应于离散网格的波数。\n散度 $\\delta_{\\mathrm{true}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{true}}$ 和涡度 $\\zeta_{\\mathrm{true}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{true}})$ 通过应用此原理计算。设 $\\hat{u}_{\\mathrm{true}}$ 和 $\\hat{v}_{\\mathrm{true}}$ 是速度分量的傅里叶变换。则散度和涡度的变换为：\n$$\n\\hat{\\delta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{u}_{\\mathrm{true}} + i k_y \\hat{v}_{\\mathrm{true}}\n$$\n$$\n\\hat{\\zeta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{v}_{\\mathrm{true}} - i k_y \\hat{u}_{\\mathrm{true}}\n$$\n对 $\\hat{\\delta}_{\\mathrm{true}}$ 和 $\\hat{\\zeta}_{\\mathrm{true}}$ 进行逆傅里叶变换，即可得到物理空间中的场。\n\n#### 步骤 3：求解泊松方程\n\n我们求解 $\\nabla^2\\phi = \\delta_{\\mathrm{true}}$ 和 $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$。在傅里叶空间中，拉普拉斯算子 $\\nabla^2$ 变为乘以 $-(k_x^2 + k_y^2)$。设 $K^2 = k_x^2 + k_y^2$。方程变换为：\n$$\n-K^2 \\hat{\\phi} = \\hat{\\delta}_{\\mathrm{true}}\n$$\n$$\n-K^2 \\hat{\\psi} = \\hat{\\zeta}_{\\mathrm{true}}\n$$\n变换后势函数的解为：\n$$\n\\hat{\\phi} = -\\frac{\\hat{\\delta}_{\\mathrm{true}}}{K^2} \\quad , \\quad \\hat{\\psi} = -\\frac{\\hat{\\zeta}_{\\mathrm{true}}}{K^2}\n$$\n对于零波数模式（$k_x=0, k_y=0$），$K^2=0$，导致奇点。然而，该物理问题是适定的。在周期性域上，拉普拉斯算子的空间平均值必须为零，这意味着 $\\hat{\\delta}_{\\mathrm{true}}(0,0)=0$ 和 $\\hat{\\zeta}_{\\mathrm{true}}(0,0)=0$。这导致了 $0/0$ 的不定形式。问题陈述提供了规范条件：$\\phi$ 和 $\\psi$ 的零波数分量必须为零。这解决了歧义。我们设置 $\\hat{\\phi}(0,0)=0$ 和 $\\hat{\\psi}(0,0)=0$。然后通过对 $\\hat{\\phi}$ 和 $\\hat{\\psi}$ 进行逆傅里叶变换来找到数值解 $\\phi$ 和 $\\psi$。\n\n#### 步骤 4：重建速度场\n\n重建的速度场 $\\mathbf{u}_{\\mathrm{rec}} = (u_{\\mathrm{rec}}, v_{\\mathrm{rec}})$ 是根据最初建立的定义，使用谱微分法从数值势函数 $\\phi$ 和 $\\psi$ 计算得出的：\n$$\n\\hat{u}_{\\mathrm{rec}}(k_x, k_y) = i k_x \\hat{\\phi} - i k_y \\hat{\\psi}\n$$\n$$\n\\hat{v}_{\\mathrm{rec}}(k_x, k_y) = i k_y \\hat{\\phi} + i k_x \\hat{\\psi}\n$$\n对 $\\hat{u}_{\\mathrm{rec}}$ 和 $\\hat{v}_{\\mathrm{rec}}$ 进行逆傅里叶变换，得到物理空间中的重建速度场。由于源场是实数，所得的速度场也将是实数，任何由浮点误差引起的残余虚部都应被舍弃。\n\n#### 步骤 5：量化重建误差\n\n通过检查残余场来评估重建误差。速度误差为 $\\mathbf{u}_{\\mathrm{err}} = \\mathbf{u}_{\\mathrm{rec}} - \\mathbf{u}_{\\mathrm{true}}$。我们再次使用谱方法计算此误差场的散度和涡度：\n$$\nd_{\\mathrm{err}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{err}}\n$$\n$$\n\\zeta_{\\mathrm{err}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{err}})\n$$\n最终的误差度量是这些残余场的均方根（RMS），在所有 $N_x \\times N_y$ 个网格点上计算：\n$$\nr_{\\mathrm{div}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (d_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n$$\nr_{\\mathrm{vort}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (\\zeta_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n由于整个过程对一个光滑的解析问题使用了谱精确方法，重建应该精确到机器精度。因此，得到的残余误差 $r_{\\mathrm{div}}$ 和 $r_{\\mathrm{vort}}$ 预计会非常小。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_reconstruction_error(Nx, Ny, Lx, Ly, A_phi, A_psi, n, m, p, q):\n    \"\"\"\n    Implements the Helmholtz decomposition and reconstruction process.\n    \n    This function follows the steps outlined in the problem:\n    1. Constructs a true velocity field from analytic potentials.\n    2. Computes its divergence and vorticity using spectral methods.\n    3. Solves the Poisson equations to recover the potentials.\n    4. Reconstructs the velocity field from the computed potentials.\n    5. Quantifies the reconstruction error via residual divergence and vorticity.\n    \"\"\"\n    \n    # Grid setup\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y)\n\n    # Wavenumber grid setup\n    dx = Lx / Nx\n    dy = Ly / Ny\n    kx_1d = 2 * np.pi * fft.fftfreq(Nx, d=dx)\n    ky_1d = 2 * np.pi * fft.fftfreq(Ny, d=dy)\n    kx, ky = np.meshgrid(kx_1d, ky_1d)\n\n    # Step 1: Construct the \"True\" Velocity Field\n    # Wavenumbers for the analytic functions\n    kn_phi = 2 * np.pi * n / Lx if Lx != 0 else 0\n    km_phi = 2 * np.pi * m / Ly if Ly != 0 else 0\n    kp_psi = 2 * np.pi * p / Lx if Lx != 0 else 0\n    kq_psi = 2 * np.pi * q / Ly if Ly != 0 else 0\n\n    # Analytic forms of the potentials\n    phi_true = A_phi * np.cos(kn_phi * xx) * np.sin(km_phi * yy)\n    psi_true = A_psi * np.sin(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # True velocity field from analytic derivatives of potentials\n    # u = d(phi)/dx - d(psi)/dy\n    # v = d(phi)/dy + d(psi)/dx\n    u_true = -A_phi * kn_phi * np.sin(kn_phi * xx) * np.sin(km_phi * yy) \\\n             -A_psi * kq_psi * np.sin(kp_psi * xx) * np.cos(kq_psi * yy)\n    \n    v_true =  A_phi * km_phi * np.cos(kn_phi * xx) * np.cos(km_phi * yy) \\\n             +A_psi * kp_psi * np.cos(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # Step 2: Compute Divergence and Vorticity of the True Field\n    u_true_hat = fft.fft2(u_true)\n    v_true_hat = fft.fft2(v_true)\n\n    delta_true_hat = 1j * kx * u_true_hat + 1j * ky * v_true_hat\n    zeta_true_hat = 1j * kx * v_true_hat - 1j * ky * u_true_hat\n\n    # Step 3: Solve the Poisson Equations\n    K2 = kx**2 + ky**2\n    \n    # To avoid division by zero at kx=ky=0\n    with np.errstate(divide='ignore', invalid='ignore'):\n        phi_hat = -delta_true_hat / K2\n        psi_hat = -zeta_true_hat / K2\n\n    # Apply gauge: zero mean potential (zero-wavenumber component is zero)\n    phi_hat[0, 0] = 0.0\n    psi_hat[0, 0] = 0.0\n    \n    # Step 4: Reconstruct the Velocity Field\n    # u_rec = d(phi)/dx - d(psi)/dy\n    # v_rec = d(phi)/dy + d(psi)/dx\n    u_rec_hat = 1j * kx * phi_hat - 1j * ky * psi_hat\n    v_rec_hat = 1j * ky * phi_hat + 1j * kx * psi_hat\n\n    u_rec = fft.ifft2(u_rec_hat).real\n    v_rec = fft.ifft2(v_rec_hat).real\n    \n    # Step 5: Quantify Reconstruction Error\n    u_err = u_rec - u_true\n    v_err = v_rec - v_true\n\n    u_err_hat = fft.fft2(u_err)\n    v_err_hat = fft.fft2(v_err)\n\n    # Residual divergence\n    d_err_hat = 1j * kx * u_err_hat + 1j * ky * v_err_hat\n    d_err = fft.ifft2(d_err_hat).real\n    r_div = np.sqrt(np.mean(d_err**2))\n\n    # Residual vorticity\n    z_err_hat = 1j * kx * v_err_hat - 1j * ky * u_err_hat\n    z_err = fft.ifft2(z_err_hat).real\n    r_vort = np.sqrt(np.mean(z_err**2))\n    \n    return [r_div, r_vort]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (128, 128, 1.2e6, 8.0e5, 7.5e4, 5.0e4, 4, 5, 3, 2),\n        (128, 128, 1.0e6, 1.0e6, 6.0e4, 0.0, 6, 5, 1, 1),\n        (128, 128, 9.0e5, 1.1e6, 0.0, 8.5e4, 1, 1, 7, 4),\n        (96, 96, 8.0e5, 6.0e5, 2.5e4, 3.0e4, 0, 8, 10, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        r_div, r_vort = compute_reconstruction_error(*case)\n        results.append(f\"[{r_div:.8e},{r_vort:.8e}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理想化的周期性域之外，真实世界的海洋流动受陆地和海底地形的限制。本练习将探讨在一个有界域（如河口）中，物理守恒定律如何转化为数学问题的适定性条件。您需要为一个有源（代表河流注入）的势流问题，通过应用散度定理推导出诺伊曼（Neumann）边界条件下泊松方程的相容性条件，从而确保解的存在性。这个推导过程深刻地揭示了数学模型中的边界通量必须与域内源汇的总和相平衡的物理本质。",
            "id": "3787077",
            "problem": "考虑在一个宽度恒为 $W$、长度为 $L$ 的矩形河口域 $\\Omega = \\{(x,y) | 0 \\le x \\le L, 0 \\le y \\le W\\}$ 中的稳定、深度积分、正压流动。令深度积分输运矢量为 $\\mathbf{U}(x,y)$，并假设流动是无旋的，因此存在一个速度势 $\\phi(x,y)$，使得 $\\mathbf{U} = \\nabla \\phi$。在存在单位面积上分布的河流入流 $q(x,y)$ 的情况下，稳定的深度积分质量连续性方程为 $\\nabla \\cdot \\mathbf{U} = q(x,y)$。\n\n河流入流被建模为一个空间分布源，其在河源附近最强，并向下游衰减：\n$$\nq(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right),\n$$\n其中 $Q_{r} > 0$ 是一个给定的流量尺度，$\\ell > 0$ 是一个衰减长度尺度。在 $y=0$ 和 $y=W$ 处的不可渗透侧壁以及在 $x=0$ 处的封闭河源强制执行无垂直流边界条件。在 $x=L$ 的入海口处，单位宽度上的向外法向输运由一个诺伊曼（Neumann）边界条件规定，形式如下：\n$$\n\\frac{\\partial \\phi}{\\partial n}\\Big|_{x=L} = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right],\n$$\n其中 $\\alpha$ 是一个给定的形状参数，满足 $|\\alpha| \\le 1$，$c$ 是一个未知振幅，必须确定以确保问题的适定性。\n\n任务：\n- 从稳定的深度积分连续性方程和速度势的定义出发，构建控制 $\\phi(x,y)$ 在 $\\Omega$ 上的偏微分方程及其所有边界条件。\n- 通过应用散度定理，推导为使 $\\phi$ 存在而必须满足的诺伊曼相容性（可解性）条件。\n- 使用此条件和给定数据，确定振幅 $c$ 关于 $Q_{r}$、$L$、$W$、$\\ell$ 和 $\\alpha$ 的闭式表达式。\n\n将最终结果表示为 $c$ 的单个闭式解析表达式。不需要进行数值计算或四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题要求确定势流问题边界条件中的一个常数 $c$，以使问题是适定的。这可以通过首先为速度势 $\\phi(x,y)$ 构建控制偏微分方程（PDE）和边界条件，然后应用散度定理来建立一个可解性条件来实现。\n\n**步骤1：构建控制偏微分方程和边界条件**\n\n深度积分输运矢量 $\\mathbf{U}(x,y)$ 通过无旋流的定义与速度势 $\\phi(x,y)$ 相关联：\n$$\n\\mathbf{U} = \\nabla \\phi\n$$\n其中 $\\nabla$ 是梯度算子，因此 $\\mathbf{U} = \\frac{\\partial \\phi}{\\partial x}\\mathbf{i} + \\frac{\\partial \\phi}{\\partial y}\\mathbf{j}$。\n\n稳定的深度积分质量连续性方程给出如下：\n$$\n\\nabla \\cdot \\mathbf{U} = q(x,y)\n$$\n将速度势的定义代入连续性方程，得到 $\\phi(x,y)$ 的控制偏微分方程：\n$$\n\\nabla \\cdot (\\nabla \\phi) = q(x,y)\n$$\n这是泊松（Poisson）方程：\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = q(x,y)\n$$\n其中源项由 $q(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right)$ 给出。\n\n接下来，我们构建矩形域 $\\Omega = \\{(x,y) | 0 \\le x \\le L, 0 \\le y \\le W\\}$ 上的边界条件。无垂直流条件意味着输运矢量 $\\mathbf{U}$ 垂直于边界的分量为零。势的法向导数 $\\frac{\\partial \\phi}{\\partial n} = \\nabla \\phi \\cdot \\mathbf{n}$ 表示速度的法向分量，其中 $\\mathbf{n}$ 是向外的单位法向量。\n\n1.  **在 $x=0$ 处的河源**：向外的单位法向量是 $\\mathbf{n} = -\\mathbf{i}$。无流条件是 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{i}) = -\\frac{\\partial \\phi}{\\partial x} = 0$。因此，对于 $0 \\le y \\le W$，有 $\\frac{\\partial \\phi}{\\partial x}(0,y) = 0$。\n\n2.  **在 $y=0$ 处的侧壁**：向外的单位法向量是 $\\mathbf{n} = -\\mathbf{j}$。无流条件是 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{j}) = -\\frac{\\partial \\phi}{\\partial y} = 0$。因此，对于 $0 \\le x \\le L$，有 $\\frac{\\partial \\phi}{\\partial y}(x,0) = 0$。\n\n3.  **在 $y=W$ 处的侧壁**：向外的单位法向量是 $\\mathbf{n} = \\mathbf{j}$。无流条件是 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot \\mathbf{j} = \\frac{\\partial \\phi}{\\partial y} = 0$。因此，对于 $0 \\le x \\le L$，有 $\\frac{\\partial \\phi}{\\partial y}(x,W) = 0$。\n\n4.  **在 $x=L$ 处的入海口**：向外的单位法向量是 $\\mathbf{n} = \\mathbf{i}$。问题规定单位宽度上的向外法向输运为 $\\frac{\\partial \\phi}{\\partial n} = g(y)$。因此，对于 $0 \\le y \\le W$，有 $\\frac{\\partial \\phi}{\\partial x}(L,y) = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]$。\n\n完整的问​​题是泊松方程的诺伊曼边界值问题。\n\n**步骤2：推导诺伊曼相容性（可解性）条件**\n\n对于在域 $\\Omega$ 上的诺伊曼问题 $\\nabla^2 \\phi = f$，其边界 $\\partial \\Omega$ 上的边界条件为 $\\frac{\\partial \\phi}{\\partial n} = h$，必须满足一个相容性条件才能有解。这个条件源于散度定理（在平面中也称为格林（Green）定理）。\n\n散度定理表述如下：\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\,dA = \\oint_{\\partial \\Omega} (\\mathbf{F} \\cdot \\mathbf{n}) \\,ds\n$$\n我们选择矢量场 $\\mathbf{F} = \\nabla \\phi$。那么 $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$。通量项为 $\\mathbf{F} \\cdot \\mathbf{n} = \\nabla \\phi \\cdot \\mathbf{n} = \\frac{\\partial \\phi}{\\partial n}$。\n将这些代入散度定理得到：\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\n使用偏微分方程 $\\nabla^2 \\phi = q(x,y)$，可解性条件变为：\n$$\n\\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\n这个条件有明确的物理意义：域内源产生的总质量必须等于通过其边界流出域的总净质量通量。\n\n**步骤3：确定振幅 $c$**\n\n我们现在使用给定数据来计算相容性条件的两边。\n\n左侧（LHS）是源项在整个域上的积分：\n$$\n\\text{LHS} = \\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\int_{0}^{W} \\int_{0}^{L} \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\,dy\n$$\n由于被积函数不依赖于 $y$，我们可以分离积分：\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\left(\\int_{0}^{W} dy\\right) \\left(\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\right)\n$$\n关于 $y$ 的积分是 $W$。关于 $x$ 的积分是：\n$$\n\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx = \\left[-\\ell \\exp\\!\\left(-\\frac{x}{\\ell}\\right)\\right]_{0}^{L} = -\\ell \\exp\\!\\left(-\\frac{L}{\\ell}\\right) - (-\\ell \\exp(0)) = \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n将这些代回左侧（LHS）的表达式：\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\cdot W \\cdot \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = Q_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n\n右侧（RHS）是 $\\phi$ 的法向导数沿边界 $\\partial \\Omega$ 的线积分。边界由四段组成。\n$$\n\\text{RHS} = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds = \\int_{x=0} + \\int_{y=0} + \\int_{x=L} + \\int_{y=W}\n$$\n来自 $x=0$、$y=0$ 和 $y=W$ 边界的贡献为零，因为在这些边界上施加了无流条件 $\\frac{\\partial \\phi}{\\partial n} = 0$。唯一非零的贡献来自 $x=L$ 处的入海口：\n$$\n\\text{RHS} = \\int_{0}^{W} \\frac{\\partial \\phi}{\\partial x}(L,y) \\,dy = \\int_{0}^{W} g(y) \\,dy\n$$\n代入 $g(y)$ 的表达式：\n$$\n\\text{RHS} = \\int_{0}^{W} c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right] \\,dy\n$$\n我们计算该积分：\n$$\n\\text{RHS} = c \\left[ \\int_{0}^{W} 1 \\,dy + \\alpha \\int_{0}^{W} \\cos\\!\\left(\\frac{2\\pi y}{W}\\right) \\,dy \\right]\n$$\n$$\n\\text{RHS} = c \\left[ [y]_{0}^{W} + \\alpha \\left[\\frac{W}{2\\pi} \\sin\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]_{0}^{W} \\right]\n$$\n$$\n\\text{RHS} = c \\left[ (W-0) + \\alpha \\left(\\frac{W}{2\\pi} \\sin(2\\pi) - \\frac{W}{2\\pi} \\sin(0)\\right) \\right]\n$$\n由于 $\\sin(2\\pi) = 0$ 且 $\\sin(0) = 0$，第二项为零。\n$$\n\\text{RHS} = c W\n$$\n\n最后，我们令左侧（LHS）等于右侧（RHS）以强制执行相容性条件：\n$$\nQ_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = c W\n$$\n解出未知振幅 $c$ 得到最终表达式：\n$$\nc = \\frac{Q_{r}}{W} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{Q_{r}}{W} \\left(1 - \\exp\\left(-\\frac{L}{\\ell}\\right)\\right)}\n$$"
        },
        {
            "introduction": "在实际的海洋学研究中，我们面对的往往是充满噪声和不完整的观测数据。本练习将引导您进入变分数据同化的前沿领域，学习如何从这些不完美的观测中估计出最优的流函数和速度势。您需要构建一个约束最小二乘泛函，该泛函不仅要最小化模型速度与观测速度之间的加权误差，还要对残余的散度和涡度进行惩罚，并严格满足已知的边界通量约束。通过构建这个增广拉格朗日泛函，您将掌握一种强大的方法，用以寻找一个与观测数据最佳拟合且满足物理约束的动态一致流场。",
            "id": "3787058",
            "problem": "考虑一个在单连通海洋表面区域 $D \\subset \\mathbb{R}^2$ 中的二维水平流，其边界 $\\Gamma$ 是分段光滑的，并被划分为不相交的段 $\\Gamma_1, \\dots, \\Gamma_M$，使得 $\\Gamma = \\bigcup_{i=1}^M \\Gamma_i$。设 $(u^{\\mathrm{obs}}(x,y), v^{\\mathrm{obs}}(x,y))$ 表示在 $D$ 上对真实速度场 $(u(x,y), v(x,y))$ 的带噪声观测值。假设该流可以表示为一个无旋分量和一个无散分量的叠加。无旋分量由速度势 $\\phi(x,y)$ 的梯度给出，无散分量由流函数 $\\psi(x,y)$ 给出。因此，在 $D$ 内的每一点 $(x,y)$ 处，\n$$\nu = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}, \\quad v = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}.\n$$\n您将基于以下基本原理进行推导：\n- 速度场的散度定义为 $\\delta = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$，涡度的垂直分量定义为 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。\n- 对于上述分解，散度和涡度分别为 $\\delta = \\Delta \\phi$ 和 $\\zeta = \\Delta \\psi$，其中 $\\Delta$ 表示拉普拉斯算子 $\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$。\n- 通过边界段 $\\Gamma_i$ 的法向通量由线积分 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s$ 给出，其中 $\\boldsymbol{u} = (u,v)$，$\\boldsymbol{n}$ 是 $\\Gamma$ 上的外单位法向量。\n\n假设穿过每段边界 $\\Gamma_i$ 的净法向通量是已知的，由实数 $Q_i$ ($i = 1, \\dots, M$) 指定。引入严格正的权重函数 $w_u(x,y)$ 和 $w_v(x,y)$，以分别说明 $u^{\\mathrm{obs}}$ 和 $v^{\\mathrm{obs}}$ 中的噪声结构；并引入严格正的惩罚权重 $\\alpha(x,y)$ 和 $\\beta(x,y)$，以惩罚重构速度中的残余散度和涡度。设 $\\boldsymbol{n} = (n_x, n_y)$ 表示 $\\Gamma$ 上的外单位法向量。\n\n您的任务是根据所述的基本原理和定义，推导出一个约束最小二乘公式的显式解析表达式，用于通过最小化一个区域积分的目标函数来估计 $\\phi$ 和 $\\psi$。该目标函数：\n- 惩罚重构速度 $(u,v)$ 与观测值 $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$ 之间的加权平方失配，\n- 惩罚加权的残余散度 $\\Delta \\phi$ 和残余涡度 $\\Delta \\psi$ 的平方，\n- 使用拉格朗日乘子强制执行边界通量约束 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i$（对于所有 $i = 1, \\dots, M$）。\n\n引入拉格朗日乘子 $\\lambda_1, \\dots, \\lambda_M$ 来施加通量约束。将最终答案表示为增广拉格朗日泛函的单一闭式解析表达式，该泛函表示了该约束最小二乘问题。表达式应完全用 $\\phi$、$\\psi$、$u^{\\mathrm{obs}}$、$v^{\\mathrm{obs}}$、$w_u$、$w_v$、$\\alpha$、$\\beta$、$\\Delta$、$\\boldsymbol{n}$、$Q_i$ 和 $\\lambda_i$ 写出，并使用在 $D$ 和 $\\Gamma_i$ 上的区域积分和边界积分。不要引入任何数值。您的最终答案必须是单一的解析表达式。",
            "solution": "所述问题具有科学依据，对于指定任务是适定的，并且内部一致。所有给出的定义和原理都是流体动力学和变分法领域的标准内容。因此，该问题是有效的，我将着手推导所要求的泛函。\n\n目标是为速度势 $\\phi(x,y)$ 和流函数 $\\psi(x,y)$ 的估计构建一个增广拉格朗日泛函，我们将其记为 $\\mathcal{L}$。如规定所示，该泛函必须包含三个不同的组成部分：一个数据失配项、一个正则化项和一组约束项。我们将系统地构建每个分量，然后将它们相加，以获得 $\\mathcal{L}$ 的最终表达式。\n\n首先，我们根据给定的势函数 $\\phi$ 和 $\\psi$ 定义重构的速度场 $(u,v)$：\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}\n$$\n$$\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\n\n泛函的第一个分量，我们称之为 $J_1$，惩罚重构速度 $(u,v)$ 与带噪声的观测值 $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$ 之间的加权平方失配。这表示为在 $D$ 上的区域积分。权重 $w_u(x,y)$ 和 $w_v(x,y)$ 用于说明速度观测值的非均匀可靠性。该项的表达式为：\n$$\nJ_1 = \\iint_D \\left[ w_u(x,y) (u - u^{\\mathrm{obs}})^2 + w_v(x,y) (v - v^{\\mathrm{obs}})^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n将 $u$ 和 $v$ 关于 $\\phi$ 和 $\\psi$ 的表达式代入，我们得到：\n$$\nJ_1 = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n\n第二个分量 $J_2$ 是一个正则化项，它惩罚重构流中的残余散度和涡度。问题指出，散度为 $\\delta = \\Delta \\phi$，涡度的垂直分量为 $\\zeta = \\Delta \\psi$。惩罚项是加权散度和涡度平方的区域积分。惩罚权重由严格正函数 $\\alpha(x,y)$ 和 $\\beta(x,y)$ 给出。其公式为：\n$$\nJ_2 = \\iint_D \\left[ \\alpha(x,y) (\\delta)^2 + \\beta(x,y) (\\zeta)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n将 $\\delta$ 和 $\\zeta$ 关于势函数 $\\phi$ 和 $\\psi$ 的表达式代入，我们得到：\n$$\nJ_2 = \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n其中 $\\Delta$ 是拉普拉斯算子，$\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$。\n\n第三个分量 $J_3$ 包含了 $M$ 个边界通量约束。每个约束指定穿过边界段 $\\Gamma_i$ 的净法向通量必须等于一个给定值 $Q_i$：\n$$\n\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i \\quad \\text{for } i = 1, \\dots, M\n$$\n这里，$\\boldsymbol{u} = (u,v)$ 是速度向量，$\\boldsymbol{n} = (n_x, n_y)$ 是边界 $\\Gamma$ 上的外单位法向量。为了在最小二乘框架中施加这些约束，我们使用拉格朗日乘子法。对于每个约束 $i$，我们引入一个拉格朗日乘子 $\\lambda_i$。约束被重写为 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i = 0$。对增广拉格朗日量的贡献是这些约束方程的总和，每个方程都乘以其对应的拉格朗日乘子：\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i \\right)\n$$\n我们必须用 $\\phi$ 和 $\\psi$ 显式地表示 $\\boldsymbol{n} \\cdot \\boldsymbol{u}$。点积为 $\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x u + n_y v$。代入 $u$ 和 $v$ 的定义：\n$$\n\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right)\n$$\n因此，约束项的完整表达式是：\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\n\n完整的增广拉格朗日泛函 $\\mathcal{L}(\\phi, \\psi, \\lambda_1, \\dots, \\lambda_M)$ 是这三个分量之和，即 $\\mathcal{L} = J_1 + J_2 + J_3$。结合推导出的表达式，即可得到待最小化泛函的最终解析形式。\n$$\n\\mathcal{L} = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\n该表达式代表了所要求的完整的约束最小二乘公式。通过对该泛函关于 $\\phi$ 和 $\\psi$ 进行最小化，并找到合适的 $\\lambda_i$，将得到势场的最优估计。",
            "answer": "$$\n\\boxed{\\begin{aligned}\n \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n + \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n + \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n\\end{aligned}}\n$$"
        }
    ]
}