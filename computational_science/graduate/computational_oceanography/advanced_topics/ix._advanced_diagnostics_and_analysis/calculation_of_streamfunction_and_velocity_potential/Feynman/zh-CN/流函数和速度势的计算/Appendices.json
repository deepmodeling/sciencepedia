{
    "hands_on_practices": [
        {
            "introduction": "这项实践是验证亥姆霍兹分解数值方法的基础。通过在理想化的周期性域中构造一个精确的流场，你将练习使用谱方法（傅里叶变换）来求解泊松方程，并从流函数和速度势重构速度场。这个练习旨在建立对数值工具的信心，并展示在理想条件下，整个分解与重构过程的误差可以达到机器精度，从而验证了算法的正确性。",
            "id": "3787062",
            "problem": "考虑一个定义在矩形周期性域上的水平二维海洋表面速度场 $\\mathbf{u}(x,y,t)$，该域在 x 和 y 方向的长度分别为 $L_x$ 和 $L_y$ 米。假设该场足够平滑，且其衰减速度不快于多项式衰减，因此经典向量微积分适用。使用以下基本原理：\n\n- 周期性域上的 Helmholtz 分解：任何平滑向量场都可以表示为一个无旋分量（标量势的梯度）和一个无散分量（流函数的斜梯度）之和。\n- 散度和垂直涡度的定义：对于 $\\mathbf{u}=(u,v)$，散度为 $\\nabla\\cdot\\mathbf{u}=\\partial_x u+\\partial_y v$（单位为 $\\mathrm{s}^{-1}$），垂直涡度为 $\\zeta=\\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})=\\partial_x v-\\partial_y u$（单位也为 $\\mathrm{s}^{-1}$），其中 $\\hat{\\mathbf{k}}$ 是垂直于水平面的单位向量。\n- 拉普拉斯算子 $\\nabla^2=\\partial_x^2+\\partial_y^2$ 的定义。\n\n从这些基本原理出发，推导如何通过求解周期性域上的 Poisson 方程得到的速度势 $\\phi$ 和流函数 $\\psi$ 来重构 $\\mathbf{u}$，并以残余散度和残余垂直涡度来量化重构误差。\n\n您的程序必须以纯数学术语实现以下步骤：\n\n1. 在具有周期性边界条件的均匀网格（$N_x\\times N_y$ 个点，覆盖 $[0,L_x)\\times[0,L_y)$）上，通过组合一个由标量势 $\\phi_{\\mathrm{true}}(x,y)$ 生成的无旋分量和一个由流函数 $\\psi_{\\mathrm{true}}(x,y)$ 生成的无散分量，构建一个合成的、平滑的“真实”速度场 $\\mathbf{u}_{\\mathrm{true}}(x,y)$。使用以下形式\n   - $\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)$,\n   - $\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)$,\n   其中 $A_\\phi$ 和 $A_\\psi$ 是振幅（单位为 $\\mathrm{m}^2/\\mathrm{s}$），$n,m,p,q$ 是控制空间尺度的非负整数。基于这些，根据 Helmholtz 分解所隐含的速度与势函数之间的基本定义来计算 $\\mathbf{u}_{\\mathrm{true}}$（除从给定基础推导出的公式外，不要使用任何快捷公式）。\n\n2. 使用在数学上有效且符合周期性边界条件的微分方法，计算 $\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$ 和 $\\zeta_{\\mathrm{true}}$。\n\n3. 求解周期性域上针对速度势和流函数的 Poisson 方程，\n   - $\\nabla^2\\phi=\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$,\n   - $\\nabla^2\\psi=\\zeta_{\\mathrm{true}}$,\n   通过将 $\\phi$ 和 $\\psi$ 的零波数傅里叶分量设为零（即零平均值）来固定规范。\n\n4. 仅根据基本定义所隐含的分解，从计算出的 $\\phi$ 和 $\\psi$ 重构速度场 $\\mathbf{u}_{\\mathrm{rec}}$。\n\n5. 在以下方面量化重构误差：\n   - 残余散度 $r_{\\mathrm{div}}=\\left(\\mathrm{RMS}\\left[\\nabla\\cdot(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$,\n   - 残余垂直涡度 $r_{\\mathrm{vort}}=\\left(\\mathrm{RMS}\\left[\\hat{\\mathbf{k}}\\cdot\\nabla\\times(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$.\n   $r_{\\mathrm{div}}$ 和 $r_{\\mathrm{vort}}$ 都必须以 $\\mathrm{s}^{-1}$ 为单位报告。\n\n实现约束：\n- 在 $x$ 和 $y$ 方向均使用均匀网格和周期性边界条件。\n- 使用一种在周期性域上有效的、谱方法一致的方法进行微分和求解 Poisson 方程。\n\n测试套件：\n为以下四组参数集运行您的程序，每组由 $(N_x,N_y,L_x,L_y,A_\\phi,A_\\psi,n,m,p,q)$ 定义：\n- 情况 1：$(128,128,1.2\\times 10^6,8.0\\times 10^5,7.5\\times 10^4,5.0\\times 10^4,4,5,3,2)$。\n- 情况 2（纯无旋）：$(128,128,1.0\\times 10^6,1.0\\times 10^6,6.0\\times 10^4,0.0,6,5,1,1)$。\n- 情况 3（纯无散）：$(128,128,9.0\\times 10^5,1.1\\times 10^6,0.0,8.5\\times 10^4,1,1,7,4)$。\n- 情况 4（各向异性，$\\phi$ 中有一个零模态）：$(96,96,8.0\\times 10^5,6.0\\times 10^5,2.5\\times 10^4,3.0\\times 10^4,0,8,10,1)$。\n\n答案规格：\n- 对于每种情况，返回一个包含两个浮点数的列表 $[r_{\\mathrm{div}},r_{\\mathrm{vort}}]$，单位为 $\\mathrm{s}^{-1}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个情况的结果本身也是一个列表，例如 $[[r_{\\mathrm{div},1},r_{\\mathrm{vort},1}],[r_{\\mathrm{div},2},r_{\\mathrm{vort},2}],\\dots]$。",
            "solution": "用户的请求已通过验证，被认为是一个有效且适定的科学问题。尽管使用了术语“斜梯度”（skew-gradient），该术语有两种符号相反的常见定义，但问题提供了明确的 Poisson 方程 $\\nabla^2\\psi=\\zeta$。该方程消除了流函数 $\\psi$ 与速度场之间所需关系的歧义。唯一在数学上一致的公式是垂直涡度 $\\zeta$ 是流函数的拉普拉斯算子。这需要一个我们将采用的特定符号约定。因此，该问题是内部一致且可解的。\n\n我们继续进行基于原理的详细解答。\n\n### 基于原理的设计\n\n此问题的核心是二维周期性环面上向量场的 Helmholtz-Hodge 分解。该定理指出，任何足够平滑的向量场 $\\mathbf{u}$ 都可以唯一地分解为一个无散（solenoidal）分量和一个无旋（irrotational）分量。\n\n无旋分量是标量势 $\\phi$ 的梯度，表示为 $\\mathbf{u}_{\\phi} = \\nabla \\phi$。根据其构造，其旋度为零：$\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$。\n\n无散分量由流函数 $\\psi$ 导出。问题指出该分量是“流函数的斜梯度”，并提供了 Poisson 方程 $\\nabla^2\\psi = \\zeta$，其中 $\\zeta = \\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})$ 是垂直涡度。让我们推导其精确关系。设无散速度分量为 $\\mathbf{u}_{\\psi} = (u_{\\psi}, v_{\\psi})$。为使该场为无散场，其散度必须为零：$\\nabla \\cdot \\mathbf{u}_{\\psi} = \\partial_x u_{\\psi} + \\partial_y v_{\\psi} = 0$。此条件意味着存在一个标量场 $\\psi$，使得 $u_{\\psi} = -\\partial_y \\psi$ 和 $v_{\\psi} = \\partial_x \\psi$（或两者同时取负）。采用此约定，我们来计算该分量的涡度：\n$$\n\\zeta_{\\psi} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\psi}) = \\partial_x v_{\\psi} - \\partial_y u_{\\psi} = \\partial_x(\\partial_x \\psi) - \\partial_y(-\\partial_y \\psi) = \\partial_x^2 \\psi + \\partial_y^2 \\psi = \\nabla^2 \\psi\n$$\n此结果 $\\zeta_{\\psi} = \\nabla^2 \\psi$ 与问题陈述中给出的 Poisson 方程 $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$ 一致。另一种约定 $\\mathbf{u}_{\\psi} = (\\partial_y \\psi, -\\partial_x \\psi)$ 会导致 $\\zeta_{\\psi} = -\\nabla^2 \\psi$，这与问题的表述相矛盾。因此，我们必须根据势函数 $\\phi$ 和流函数 $\\psi$ 将总速度场 $\\mathbf{u}=(u,v)$ 定义为：\n$$\n\\mathbf{u} = \\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi\n$$\n或以分量形式表示：\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\\\\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\n完整的分解过程涉及计算总速度场的散度和旋度：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi + \\nabla \\cdot (\\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi\n$$\n$$\n\\hat{\\mathbf{k}} \\cdot (\\nabla \\times \\mathbf{u}) = \\zeta = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\nabla^2 \\psi\n$$\n因此，要从 $\\mathbf{u}$ 中求得 $\\phi$ 和 $\\psi$，必须求解问题中指定的两个 Poisson 方程。然后，从 $\\phi$ 和 $\\psi$ 重构 $\\mathbf{u}$ 的过程使用上面推导的分量关系。\n\n数值实现将利用周期性域上傅里叶变换的性质，该变换为微分和求解 Poisson 方程提供了一种谱精确的方法。\n\n#### 步骤 1：构建“真实”速度场\n\n首先，我们定义一个包含 $N_x \\times N_y$ 个点的离散网格，覆盖域 $[0, L_x) \\times [0, L_y)$。网格坐标为 $(x_i, y_j)$，其中 $i \\in \\{0, ..., N_x-1\\}$ 且 $j \\in \\{0, ..., N_y-1\\}$。\n真实的标量势 $\\phi_{\\mathrm{true}}$ 和流函数 $\\psi_{\\mathrm{true}}$ 由以下公式给出：\n$$\n\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)\n$$\n$$\n\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n使用上面推导的一致关系，真实速度场 $\\mathbf{u}_{\\mathrm{true}} = (u_{\\mathrm{true}}, v_{\\mathrm{true}})$ 的分量解析式为：\n$$\nu_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial x} - \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial y} = -A_\\phi\\frac{2\\pi n}{L_x}\\sin\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right) - A_\\psi\\frac{2\\pi q}{L_y}\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\cos\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n$$\nv_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial y} + \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial x} = A_\\phi\\frac{2\\pi m}{L_y}\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m y}{L_y}\\right) + A_\\psi\\frac{2\\pi p}{L_x}\\cos\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n这些表达式将在离散网格上求值，以生成合成的“真实”速度场。\n\n#### 步骤 2：计算真实场的散度和涡度\n\n对于周期性网格上的函数 $f(x,y)$，其偏导数可以通过谱方法计算。设 $\\hat{f}(k_x, k_y)$ 为 $f$ 的二维离散傅里叶变换。偏导数的傅里叶变换为：\n$$\n\\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial x}\\right\\} = i k_x \\hat{f}(k_x, k_y) \\quad , \\quad \\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial y}\\right\\} = i k_y \\hat{f}(k_x, k_y)\n$$\n其中 $(k_x, k_y)$ 是对应于离散网格的波数。\n散度 $\\delta_{\\mathrm{true}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{true}}$ 和涡度 $\\zeta_{\\mathrm{true}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{true}})$ 通过应用此原理计算。设 $\\hat{u}_{\\mathrm{true}}$ 和 $\\hat{v}_{\\mathrm{true}}$ 是速度分量的傅里叶变换。则散度和涡度的变换为：\n$$\n\\hat{\\delta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{u}_{\\mathrm{true}} + i k_y \\hat{v}_{\\mathrm{true}}\n$$\n$$\n\\hat{\\zeta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{v}_{\\mathrm{true}} - i k_y \\hat{u}_{\\mathrm{true}}\n$$\n对 $\\hat{\\delta}_{\\mathrm{true}}$ 和 $\\hat{\\zeta}_{\\mathrm{true}}$ 进行傅里叶逆变换，即可得到物理空间中的场。\n\n#### 步骤 3：求解 Poisson 方程\n\n我们求解 $\\nabla^2\\phi = \\delta_{\\mathrm{true}}$ 和 $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$。在傅里叶空间中，拉普拉斯算子 $\\nabla^2$ 变为乘以 $-(k_x^2 + k_y^2)$。令 $K^2 = k_x^2 + k_y^2$。方程变换为：\n$$\n-K^2 \\hat{\\phi} = \\hat{\\delta}_{\\mathrm{true}}\n$$\n$$\n-K^2 \\hat{\\psi} = \\hat{\\zeta}_{\\mathrm{true}}\n$$\n变换后势函数的解为：\n$$\n\\hat{\\phi} = -\\frac{\\hat{\\delta}_{\\mathrm{true}}}{K^2} \\quad , \\quad \\hat{\\psi} = -\\frac{\\hat{\\zeta}_{\\mathrm{true}}}{K^2}\n$$\n对于零波数模式（$k_x=0, k_y=0$），$K^2=0$，导致奇异性。然而，该物理问题是适定的。在周期性域上，拉普拉斯算子的空间平均值必须为零，这意味着 $\\hat{\\delta}_{\\mathrm{true}}(0,0)=0$ 和 $\\hat{\\zeta}_{\\mathrm{true}}(0,0)=0$。这导致了 $0/0$ 的不定形式。问题陈述提供了规范条件：$\\phi$ 和 $\\psi$ 的零波数分量必须为零。这解决了歧义。我们设置 $\\hat{\\phi}(0,0)=0$ 和 $\\hat{\\psi}(0,0)=0$。然后通过对 $\\hat{\\phi}$ 和 $\\hat{\\psi}$ 进行傅里叶逆变换来找到数值解 $\\phi$ 和 $\\psi$。\n\n#### 步骤 4：重构速度场\n\n重构的速度场 $\\mathbf{u}_{\\mathrm{rec}} = (u_{\\mathrm{rec}}, v_{\\mathrm{rec}})$ 是根据最初建立的定义，使用谱微分从数值势函数 $\\phi$ 和 $\\psi$ 计算得出的：\n$$\n\\hat{u}_{\\mathrm{rec}}(k_x, k_y) = i k_x \\hat{\\phi} - i k_y \\hat{\\psi}\n$$\n$$\n\\hat{v}_{\\mathrm{rec}}(k_x, k_y) = i k_y \\hat{\\phi} + i k_x \\hat{\\psi}\n$$\n对 $\\hat{u}_{\\mathrm{rec}}$ 和 $\\hat{v}_{\\mathrm{rec}}$ 进行傅里叶逆变换，得到物理空间中的重构速度场。由于源场是实数，得到的速度场也应是实数，任何由浮点误差引起的残余虚部都应被舍弃。\n\n#### 步骤 5：量化重构误差\n\n通过检查残余场来评估重构误差。速度误差为 $\\mathbf{u}_{\\mathrm{err}} = \\mathbf{u}_{\\mathrm{rec}} - \\mathbf{u}_{\\mathrm{true}}$。我们再次使用谱方法计算此误差场的散度和涡度：\n$$\nd_{\\mathrm{err}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{err}}\n$$\n$$\n\\zeta_{\\mathrm{err}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{err}})\n$$\n最终的误差度量是这些残余场的均方根（Root Mean Square, RMS），计算范围覆盖所有 $N_x \\times N_y$ 个网格点：\n$$\nr_{\\mathrm{div}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (d_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n$$\nr_{\\mathrm{vort}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (\\zeta_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n由于整个过程对一个平滑的解析问题使用了谱精确方法，重构应该在机器精度内是精确的。因此，所得到的残余误差 $r_{\\mathrm{div}}$ 和 $r_{\\mathrm{vort}}$ 预计将非常小。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_reconstruction_error(Nx, Ny, Lx, Ly, A_phi, A_psi, n, m, p, q):\n    \"\"\"\n    Implements the Helmholtz decomposition and reconstruction process.\n    \n    This function follows the steps outlined in the problem:\n    1. Constructs a true velocity field from analytic potentials.\n    2. Computes its divergence and vorticity using spectral methods.\n    3. Solves the Poisson equations to recover the potentials.\n    4. Reconstructs the velocity field from the computed potentials.\n    5. Quantifies the reconstruction error via residual divergence and vorticity.\n    \"\"\"\n    \n    # Grid setup\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y)\n\n    # Wavenumber grid setup\n    dx = Lx / Nx\n    dy = Ly / Ny\n    kx_1d = 2 * np.pi * fft.fftfreq(Nx, d=dx)\n    ky_1d = 2 * np.pi * fft.fftfreq(Ny, d=dy)\n    kx, ky = np.meshgrid(kx_1d, ky_1d)\n\n    # Step 1: Construct the \"True\" Velocity Field\n    # Wavenumbers for the analytic functions\n    kn_phi = 2 * np.pi * n / Lx if Lx != 0 else 0\n    km_phi = 2 * np.pi * m / Ly if Ly != 0 else 0\n    kp_psi = 2 * np.pi * p / Lx if Lx != 0 else 0\n    kq_psi = 2 * np.pi * q / Ly if Ly != 0 else 0\n\n    # Analytic forms of the potentials\n    phi_true = A_phi * np.cos(kn_phi * xx) * np.sin(km_phi * yy)\n    psi_true = A_psi * np.sin(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # True velocity field from analytic derivatives of potentials\n    # u = d(phi)/dx - d(psi)/dy\n    # v = d(phi)/dy + d(psi)/dx\n    u_true = -A_phi * kn_phi * np.sin(kn_phi * xx) * np.sin(km_phi * yy) \\\n             -A_psi * kq_psi * np.sin(kp_psi * xx) * np.cos(kq_psi * yy)\n    \n    v_true =  A_phi * km_phi * np.cos(kn_phi * xx) * np.cos(km_phi * yy) \\\n             +A_psi * kp_psi * np.cos(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # Step 2: Compute Divergence and Vorticity of the True Field\n    u_true_hat = fft.fft2(u_true)\n    v_true_hat = fft.fft2(v_true)\n\n    delta_true_hat = 1j * kx * u_true_hat + 1j * ky * v_true_hat\n    zeta_true_hat = 1j * kx * v_true_hat - 1j * ky * u_true_hat\n\n    # Step 3: Solve the Poisson Equations\n    K2 = kx**2 + ky**2\n    \n    # To avoid division by zero at kx=ky=0\n    with np.errstate(divide='ignore', invalid='ignore'):\n        phi_hat = -delta_true_hat / K2\n        psi_hat = -zeta_true_hat / K2\n\n    # Apply gauge: zero mean potential (zero-wavenumber component is zero)\n    phi_hat[0, 0] = 0.0\n    psi_hat[0, 0] = 0.0\n    \n    # Step 4: Reconstruct the Velocity Field\n    # u_rec = d(phi)/dx - d(psi)/dy\n    # v_rec = d(phi)/dy + d(psi)/dx\n    u_rec_hat = 1j * kx * phi_hat - 1j * ky * psi_hat\n    v_rec_hat = 1j * ky * phi_hat + 1j * kx * psi_hat\n\n    u_rec = fft.ifft2(u_rec_hat).real\n    v_rec = fft.ifft2(v_rec_hat).real\n    \n    # Step 5: Quantify Reconstruction Error\n    u_err = u_rec - u_true\n    v_err = v_rec - v_true\n\n    u_err_hat = fft.fft2(u_err)\n    v_err_hat = fft.fft2(v_err)\n\n    # Residual divergence\n    d_err_hat = 1j * kx * u_err_hat + 1j * ky * v_err_hat\n    d_err = fft.ifft2(d_err_hat).real\n    r_div = np.sqrt(np.mean(d_err**2))\n\n    # Residual vorticity\n    z_err_hat = 1j * kx * v_err_hat - 1j * ky * u_err_hat\n    z_err = fft.ifft2(z_err_hat).real\n    r_vort = np.sqrt(np.mean(z_err**2))\n    \n    return [r_div, r_vort]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (128, 128, 1.2e6, 8.0e5, 7.5e4, 5.0e4, 4, 5, 3, 2),\n        (128, 128, 1.0e6, 1.0e6, 6.0e4, 0.0, 6, 5, 1, 1),\n        (128, 128, 9.0e5, 1.1e6, 0.0, 8.5e4, 1, 1, 7, 4),\n        (96, 96, 8.0e5, 6.0e5, 2.5e4, 3.0e4, 0, 8, 10, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        r_div, r_vort = compute_reconstruction_error(*case)\n        results.append(f\"[{r_div:.8e},{r_vort:.8e}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从理想的周期性域过渡到更真实的有限域（如河口），我们需要考虑边界条件带来的影响。这项实践将重点从数值实现转移到物理和数学原理上，要求你推导一个良定的边值问题。你将看到，诸如质量守恒这样的物理定律如何决定了控制方程的“可解性条件”，这是确保数学模型具有物理解的必要前提。",
            "id": "3787077",
            "problem": "考虑一个稳态、深度积分的正压流，其位于一个宽度为 $W$、长度为 $L$ 的常数矩形河口区域 $\\Omega = \\{(x,y)\\,|\\, 0 \\le x \\le L,\\; 0 \\le y \\le W\\}$。设深度积分输运矢量为 $\\mathbf{U}(x,y)$，并假设流动是无旋的，因此存在一个速度势 $\\phi(x,y)$，使得 $\\mathbf{U} = \\nabla \\phi$。在存在单位面积上分布式河流入流 $q(x,y)$ 的情况下，输运的稳态深度积分质量连续性方程为 $\\nabla \\cdot \\mathbf{U} = q(x,y)$。\n\n河流入流被建模为一个空间分布的源，其在河流源头附近最强，并向下游衰减：\n$$\nq(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right),\n$$\n其中 $Q_{r} > 0$ 是一个给定的流量尺度，$\\ell > 0$ 是一个衰减长度尺度。$y=0$ 和 $y=W$ 处的不可渗透侧壁以及 $x=0$ 处的封闭河流源头强制执行法向无流边界条件。在 $x=L$ 的入海口处，单位宽度的向外法向输运由一个诺伊曼边界条件规定，其形式为\n$$\n\\frac{\\partial \\phi}{\\partial n}\\Big|_{x=L} = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right],\n$$\n其中 $\\alpha$ 是一个给定的形状参数，满足 $|\\alpha| \\le 1$，$c$ 是一个未知的振幅，必须确定它以确保问题的适定性。\n\n任务：\n- 从稳态深度积分连续性方程和速度势的定义出发，构建控制 $\\phi(x,y)$ 在 $\\Omega$ 上的偏微分方程及其所有边界条件。\n- 通过引用散度定理，推导 $\\phi$ 存在所必须满足的诺伊曼相容性（可解性）条件。\n- 利用此条件和给定数据，确定振幅 $c$ 关于 $Q_{r}$、$L$、$W$、$\\ell$ 和 $\\alpha$ 的闭式表达式。\n\n以 $c$ 的单个闭式解析表达式的形式给出最终结果。不需要进行数值计算或四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题要求确定一个势流问题的边界条件中的常数 $c$，以使问题是适定的。这可以通过首先构建速度势 $\\phi(x,y)$ 的控制偏微分方程（PDE）和边界条件，然后应用散度定理来建立一个可解性条件来实现。\n\n**步骤 1：构建控制偏微分方程和边界条件**\n\n深度积分输运矢量 $\\mathbf{U}(x,y)$ 通过无旋流的定义与速度势 $\\phi(x,y)$ 相关联：\n$$\n\\mathbf{U} = \\nabla \\phi\n$$\n其中 $\\nabla$ 是梯度算子，所以 $\\mathbf{U} = \\frac{\\partial \\phi}{\\partial x}\\mathbf{i} + \\frac{\\partial \\phi}{\\partial y}\\mathbf{j}$。\n\n稳态深度积分质量连续性方程由下式给出：\n$$\n\\nabla \\cdot \\mathbf{U} = q(x,y)\n$$\n将速度势的定义代入连续性方程，得到 $\\phi(x,y)$ 的控制偏微分方程：\n$$\n\\nabla \\cdot (\\nabla \\phi) = q(x,y)\n$$\n这就是泊松方程：\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = q(x,y)\n$$\n其中源项由 $q(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right)$ 给出。\n\n接下来，我们构建矩形区域 $\\Omega = \\{(x,y)\\,|\\, 0 \\le x \\le L,\\; 0 \\le y \\le W\\}$ 上的边界条件。法向无流条件意味着输运矢量 $\\mathbf{U}$ 垂直于边界的分量为零。势的法向导数 $\\frac{\\partial \\phi}{\\partial n} = \\nabla \\phi \\cdot \\mathbf{n}$ 表示速度的法向分量，其中 $\\mathbf{n}$ 是单位外法向矢量。\n\n1.  **$x=0$ 处的河流源头**：单位外法向矢量为 $\\mathbf{n} = -\\mathbf{i}$。无流条件为 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{i}) = -\\frac{\\partial \\phi}{\\partial x} = 0$。因此，对于 $0 \\le y \\le W$，有 $\\frac{\\partial \\phi}{\\partial x}(0,y) = 0$。\n\n2.  **$y=0$ 处的侧壁**：单位外法向矢量为 $\\mathbf{n} = -\\mathbf{j}$。无流条件为 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{j}) = -\\frac{\\partial \\phi}{\\partial y} = 0$。因此，对于 $0 \\le x \\le L$，有 $\\frac{\\partial \\phi}{\\partial y}(x,0) = 0$。\n\n3.  **$y=W$ 处的侧壁**：单位外法向矢量为 $\\mathbf{n} = \\mathbf{j}$。无流条件为 $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot \\mathbf{j} = \\frac{\\partial \\phi}{\\partial y} = 0$。因此，对于 $0 \\le x \\le L$，有 $\\frac{\\partial \\phi}{\\partial y}(x,W) = 0$。\n\n4.  **$x=L$ 处的入海口**：单位外法向矢量为 $\\mathbf{n} = \\mathbf{i}$。问题规定单位宽度的向外法向输运为 $\\frac{\\partial \\phi}{\\partial n} = g(y)$。因此，对于 $0 \\le y \\le W$，有 $\\frac{\\partial \\phi}{\\partial x}(L,y) = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]$。\n\n完整的问是一个泊松方程的诺伊曼边界值问题。\n\n**步骤 2：推导诺伊曼相容性（可解性）条件**\n\n对于区域 $\\Omega$ 上的诺伊曼问题 $\\nabla^2 \\phi = f$，其边界 $\\partial \\Omega$ 上的边界条件为 $\\frac{\\partial \\phi}{\\partial n} = h$，其解必须满足一个相容性条件。该条件源于散度定理（在平面上也称为格林公式）。\n\n散度定理表述如下：\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\,dA = \\oint_{\\partial \\Omega} (\\mathbf{F} \\cdot \\mathbf{n}) \\,ds\n$$\n我们选择矢量场 $\\mathbf{F} = \\nabla \\phi$。则 $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$。通量项为 $\\mathbf{F} \\cdot \\mathbf{n} = \\nabla \\phi \\cdot \\mathbf{n} = \\frac{\\partial \\phi}{\\partial n}$。\n将这些代入散度定理，得到：\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\n使用偏微分方程 $\\nabla^2 \\phi = q(x,y)$，可解性条件变为：\n$$\n\\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\n这个条件有明确的物理意义：区域内源所产生的总质量必须等于通过其边界流出该区域的总净质量通量。\n\n**步骤 3：确定振幅 $c$**\n\n现在我们使用给定数据计算相容性条件的两边。\n\n左侧（LHS）是源项在整个区域上的积分：\n$$\n\\text{LHS} = \\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\int_{0}^{W} \\int_{0}^{L} \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\,dy\n$$\n由于被积函数不依赖于 $y$，我们可以分离积分：\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\left(\\int_{0}^{W} dy\\right) \\left(\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\right)\n$$\n关于 $y$ 的积分是 $W$。关于 $x$ 的积分是：\n$$\n\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx = \\left[-\\ell \\exp\\!\\left(-\\frac{x}{\\ell}\\right)\\right]_{0}^{L} = -\\ell \\exp\\!\\left(-\\frac{L}{\\ell}\\right) - (-\\ell \\exp(0)) = \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n将这些代回 LHS 的表达式中：\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\cdot W \\cdot \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = Q_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n\n右侧（RHS）是 $\\phi$ 的法向导数沿边界 $\\partial \\Omega$ 的曲线积分。该边界由四段组成。\n$$\n\\text{RHS} = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds = \\int_{x=0} + \\int_{y=0} + \\int_{x=L} + \\int_{y=W}\n$$\n$x=0$、$y=0$ 和 $y=W$ 处边界的贡献为零，因为在这些边界上施加了无流条件 $\\frac{\\partial \\phi}{\\partial n} = 0$。唯一非零的贡献来自 $x=L$ 处的入海口：\n$$\n\\text{RHS} = \\int_{0}^{W} \\frac{\\partial \\phi}{\\partial x}(L,y) \\,dy = \\int_{0}^{W} g(y) \\,dy\n$$\n代入 $g(y)$ 的表达式：\n$$\n\\text{RHS} = \\int_{0}^{W} c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right] \\,dy\n$$\n我们计算该积分：\n$$\n\\text{RHS} = c \\left[ \\int_{0}^{W} 1 \\,dy + \\alpha \\int_{0}^{W} \\cos\\!\\left(\\frac{2\\pi y}{W}\\right) \\,dy \\right]\n$$\n$$\n\\text{RHS} = c \\left[ [y]_{0}^{W} + \\alpha \\left[\\frac{W}{2\\pi} \\sin\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]_{0}^{W} \\right]\n$$\n$$\n\\text{RHS} = c \\left[ (W-0) + \\alpha \\left(\\frac{W}{2\\pi} \\sin(2\\pi) - \\frac{W}{2\\pi} \\sin(0)\\right) \\right]\n$$\n由于 $\\sin(2\\pi) = 0$ 且 $\\sin(0) = 0$，第二项为零。\n$$\n\\text{RHS} = c W\n$$\n\n最后，我们令 LHS 和 RHS 相等，以强制执行相容性条件：\n$$\nQ_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = c W\n$$\n求解未知振幅 $c$ 得到最终表达式：\n$$\nc = \\frac{Q_{r}}{W} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{Q_{r}}{W} \\left(1 - \\exp\\left(-\\frac{L}{\\ell}\\right)\\right)}\n$$"
        },
        {
            "introduction": "在实际应用中，我们处理的往往是带有噪声的、不完整的观测数据。这项高级实践将带你进入数据同化领域，学习如何系统地融合观测与物理模型。你将构建一个约束最小二乘泛函，旨在找到最优的流函数和速度势，它不仅要拟合观测数据，还要满足散度和涡度的物理约束以及已知的边界通量。",
            "id": "3787058",
            "problem": "考虑一个二维水平流，其位于一个单连通的海洋表面域 $D \\subset \\mathbb{R}^2$ 中，该区域具有分段光滑的边界 $\\Gamma$，$\\Gamma$ 被划分为不相交的段 $\\Gamma_1, \\dots, \\Gamma_M$，使得 $\\Gamma = \\bigcup_{i=1}^M \\Gamma_i$。设 $(u^{\\mathrm{obs}}(x,y), v^{\\mathrm{obs}}(x,y))$ 表示在 $D$ 上对真实速度场 $(u(x,y), v(x,y))$ 的带噪声观测。假设该流可以表示为一个无旋分量和一个无辐散分量的叠加。无旋分量由速度势 $\\phi(x,y)$ 的梯度给出，无辐散分量由流函数 $\\psi(x,y)$ 给出。因此，在每个内部点 $(x,y) \\in D$，有\n$$\nu = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}, \\quad v = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}.\n$$\n您将基于以下基本原理进行推导：\n- 速度场的散度定义为 $\\delta = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$，涡度的垂直分量定义为 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。\n- 对于上述分解，散度和涡度分别为 $\\delta = \\Delta \\phi$ 和 $\\zeta = \\Delta \\psi$，其中 $\\Delta$ 表示拉普拉斯算子 $\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$。\n- 通过边界段 $\\Gamma_i$ 的法向通量由线积分 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s$ 给出，其中 $\\boldsymbol{u} = (u,v)$，$\\boldsymbol{n}$ 是 $\\Gamma$ 上的外单位法向量。\n\n假设穿过每个段 $\\Gamma_i$ 的净法向通量是已知的，由实数 $Q_i$ 指定，其中 $i = 1, \\dots, M$。引入严格为正的权重函数 $w_u(x,y)$ 和 $w_v(x,y)$ 以考虑 $u^{\\mathrm{obs}}$ 和 $v^{\\mathrm{obs}}$ 中的噪声结构，并引入严格为正的惩罚权重 $\\alpha(x,y)$ 和 $\\beta(x,y)$ 来惩罚重构速度中的残余散度和涡度。设 $\\boldsymbol{n} = (n_x, n_y)$ 表示 $\\Gamma$ 上的外单位法向量。\n\n您的任务是，根据所述的基本原理和定义，推导出一个约束最小二乘公式的显式解析表达式，用于通过最小化一个域积分目标函数来估计 $\\phi$ 和 $\\psi$。该目标函数应：\n- 惩罚重构速度 $(u,v)$ 与观测值 $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$ 之间的加权平方失配，\n- 惩罚加权的残余散度 $\\Delta \\phi$ 和残余涡度 $\\Delta \\psi$ 的平方，\n- 使用拉格朗日乘子强制执行边界通量约束 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i$（对所有 $i = 1, \\dots, M$）。\n\n引入拉格朗日乘子 $\\lambda_1, \\dots, \\lambda_M$ 来施加通量约束。将最终答案表示为增广拉格朗日泛函的单个闭式解析表达式，该泛函编码了约束最小二乘问题，完全用 $\\phi$、$\\psi$、$u^{\\mathrm{obs}}$、$v^{\\mathrm{obs}}$、$w_u$、$w_v$、$\\alpha$、$\\beta$、$\\Delta$、$\\boldsymbol{n}$、$Q_i$ 和 $\\lambda_i$ 表示，并使用在 $D$ 和 $\\Gamma_i$ 上的域积分和边界积分。不要引入任何数值。您的最终答案必须是单个解析表达式。",
            "solution": "所述问题具有科学依据，对于指定的任务是适定的，并且内部一致。所有提供的定义和原理在流体动力学和变分法领域都是标准的。因此，该问题是有效的，我将继续推导所要求的泛函。\n\n目标是为估计速度势 $\\phi(x,y)$ 和流函数 $\\psi(x,y)$ 构建一个增广拉格朗日泛函，我们将其表示为 $\\mathcal{L}$。根据规定，该泛函必须包含三个不同的组成部分：数据失配项、正则化项和一组约束项。我们将系统地构建每个组成部分，然后将它们相加，以获得 $\\mathcal{L}$ 的最终表达式。\n\n首先，我们根据给定的势函数 $\\phi$ 和 $\\psi$ 来定义重构的速度场 $(u,v)$：\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}\n$$\n$$\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\n\n泛函的第一个分量，我们称之为 $J_1$，惩罚重构速度 $(u,v)$ 与带噪声的观测值 $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$ 之间的加权平方失配。这表示为在域 $D$ 上的积分。权重 $w_u(x,y)$ 和 $w_v(x,y)$ 考虑了速度观测值的非均匀可靠性。该项的表达式为：\n$$\nJ_1 = \\iint_D \\left[ w_u(x,y) (u - u^{\\mathrm{obs}})^2 + w_v(x,y) (v - v^{\\mathrm{obs}})^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n将 $u$ 和 $v$ 用 $\\phi$ 和 $\\psi$ 的表达式代入，我们得到：\n$$\nJ_1 = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n\n第二个分量 $J_2$ 是一个正则化项，它惩罚重构流中的残余散度和涡度。问题指出，散度为 $\\delta = \\Delta \\phi$，涡度的垂直分量为 $\\zeta = \\Delta \\psi$。惩罚项是加权散度和涡度平方的域积分。惩罚权重由严格为正的函数 $\\alpha(x,y)$ 和 $\\beta(x,y)$ 给出。其公式为：\n$$\nJ_2 = \\iint_D \\left[ \\alpha(x,y) (\\delta)^2 + \\beta(x,y) (\\zeta)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n将 $\\delta$ 和 $\\zeta$ 用势函数 $\\phi$ 和 $\\psi$ 的表达式代入，我们得到：\n$$\nJ_2 = \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n其中 $\\Delta$ 是拉普拉斯算子，$\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$。\n\n第三个分量 $J_3$ 包含了 $M$ 个边界通量约束。每个约束指定穿过边界段 $\\Gamma_i$ 的净法向通量必须等于一个给定值 $Q_i$：\n$$\n\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i \\quad \\text{for } i = 1, \\dots, M\n$$\n此处，$\\boldsymbol{u} = (u,v)$ 是速度矢量，$\\boldsymbol{n} = (n_x, n_y)$ 是边界 $\\Gamma$ 上的外单位法向量。为了在最小二乘框架中强制执行这些约束，我们使用拉格朗日乘子法。对于每个约束 $i$，我们引入一个拉格朗日乘子 $\\lambda_i$。该约束被重写为 $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i = 0$。对增广拉格朗日量的贡献是这些约束方程的总和，每个方程都乘以其对应的拉格朗日乘子：\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i \\right)\n$$\n我们必须用 $\\phi$ 和 $\\psi$ 明确表示 $\\boldsymbol{n} \\cdot \\boldsymbol{u}$。点积为 $\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x u + n_y v$。代入 $u$ 和 $v$ 的定义：\n$$\n\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right)\n$$\n因此，约束项的完整表达式为：\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\n\n完整的增广拉格朗日泛函 $\\mathcal{L}(\\phi, \\psi, \\lambda_1, \\dots, \\lambda_M)$ 是这三个分量的总和，即 $\\mathcal{L} = J_1 + J_2 + J_3$。结合推导出的表达式，即可得到待最小化泛函的最终解析形式。\n$$\n\\mathcal{L} = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\n该表达式代表了所要求的完整约束最小二乘公式。通过对该泛函关于 $\\phi$ 和 $\\psi$ 进行最小化，并找到合适的 $\\lambda_i$，将得到势场的最优估计。",
            "answer": "$$\n\\boxed{\\begin{aligned}\n \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n + \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n + \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n\\end{aligned}}\n$$"
        }
    ]
}