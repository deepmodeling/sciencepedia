{
    "hands_on_practices": [
        {
            "introduction": "The most direct way to build intuition and verify your understanding of a numerical method is to apply it to a problem with a known solution. This exercise guides you through a complete cycle of the Helmholtz decomposition in an idealized setting . By first constructing a velocity field from known analytic potentials and then using numerical methods to recover those potentials, you can rigorously test your implementation and quantify its accuracy. Mastering this process on a periodic domain with spectral methods is a fundamental building block for more complex applications.",
            "id": "3787062",
            "problem": "Consider a horizontally two-dimensional ocean surface velocity field $\\mathbf{u}(x,y,t)$ on a rectangular, periodic domain with lengths $L_x$ and $L_y$ in meters. The field is assumed sufficiently smooth and decays no faster than polynomially, so that classical vector calculus applies. Use the following foundational base:\n\n- The Helmholtz decomposition on a periodic domain: any smooth vector field can be represented as the sum of an irrotational component (the gradient of a scalar potential) and a solenoidal component (the skew-gradient of a streamfunction).\n- The definitions of divergence and vertical vorticity: for $\\mathbf{u}=(u,v)$, $\\nabla\\cdot\\mathbf{u}=\\partial_x u+\\partial_y v$ (with unit $\\mathrm{s}^{-1}$) and $\\zeta=\\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})=\\partial_x v-\\partial_y u$ (also with unit $\\mathrm{s}^{-1}$), where $\\hat{\\mathbf{k}}$ is the unit vector perpendicular to the horizontal plane.\n- The definition of the Laplacian operator $\\nabla^2=\\partial_x^2+\\partial_y^2$.\n\nStarting from these bases, derive how to reconstruct $\\mathbf{u}$ from the velocity potential $\\phi$ and streamfunction $\\psi$ obtained by solving Poisson equations on the periodic domain, and quantify the reconstruction error in terms of residual divergence and residual vertical vorticity.\n\nYour program must implement the following steps in purely mathematical terms:\n\n1. Construct a synthetic, smooth “true” velocity field $\\mathbf{u}_{\\mathrm{true}}(x,y)$ by combining an irrotational component generated from a scalar potential $\\phi_{\\mathrm{true}}(x,y)$ and a solenoidal component generated from a streamfunction $\\psi_{\\mathrm{true}}(x,y)$, defined on a uniform grid with $N_x\\times N_y$ points over $[0,L_x)\\times[0,L_y)$ with periodic boundary conditions. Use the forms\n   - $\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)$,\n   - $\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)$,\n   where $A_\\phi$ and $A_\\psi$ are amplitudes in $\\mathrm{m}^2/\\mathrm{s}$, and $n,m,p,q$ are nonnegative integers controlling spatial scales. From these, compute $\\mathbf{u}_{\\mathrm{true}}$ according to the fundamental definitions linking velocity to potentials implied by the Helmholtz decomposition (do not use any shortcut formulas beyond what can be derived from the provided bases).\n\n2. Compute $\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$ and $\\zeta_{\\mathrm{true}}$ using mathematically valid differentiation that honors the periodic boundary conditions.\n\n3. Solve the Poisson equations for the velocity potential and streamfunction on the periodic domain,\n   - $\\nabla^2\\phi=\\nabla\\cdot\\mathbf{u}_{\\mathrm{true}}$,\n   - $\\nabla^2\\psi=\\zeta_{\\mathrm{true}}$,\n   fixing the gauge by setting the zero-wavenumber Fourier component of both $\\phi$ and $\\psi$ to zero (i.e., zero mean).\n\n4. Reconstruct the velocity field $\\mathbf{u}_{\\mathrm{rec}}$ from the computed $\\phi$ and $\\psi$ based solely on the decomposition implied by the foundational definitions.\n\n5. Quantify reconstruction error in terms of:\n   - residual divergence $r_{\\mathrm{div}}=\\left(\\mathrm{RMS}\\left[\\nabla\\cdot(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$,\n   - residual vertical vorticity $r_{\\mathrm{vort}}=\\left(\\mathrm{RMS}\\left[\\hat{\\mathbf{k}}\\cdot\\nabla\\times(\\mathbf{u}_{\\mathrm{rec}}-\\mathbf{u}_{\\mathrm{true}})\\right]\\right)$.\n   Both $r_{\\mathrm{div}}$ and $r_{\\mathrm{vort}}$ must be reported in $\\mathrm{s}^{-1}$.\n\nImplementation constraints:\n- Use a uniform grid and periodic boundary conditions in both $x$ and $y$ directions.\n- Use a spectrally consistent method for differentiation and solving the Poisson equations that is valid on a periodic domain.\n\nTest suite:\nRun your program for the following four parameter sets, each defined by $(N_x,N_y,L_x,L_y,A_\\phi,A_\\psi,n,m,p,q)$:\n- Case $1$: $(128,128,1.2\\times 10^6,8.0\\times 10^5,7.5\\times 10^4,5.0\\times 10^4,4,5,3,2)$.\n- Case $2$ (purely irrotational): $(128,128,1.0\\times 10^6,1.0\\times 10^6,6.0\\times 10^4,0.0,6,5,1,1)$.\n- Case $3$ (purely solenoidal): $(128,128,9.0\\times 10^5,1.1\\times 10^6,0.0,8.5\\times 10^4,1,1,7,4)$.\n- Case $4$ (anisotropic with one zero mode in $\\phi$): $(96,96,8.0\\times 10^5,6.0\\times 10^5,2.5\\times 10^4,3.0\\times 10^4,0,8,10,1)$.\n\nAnswer specification:\n- For each case, return a list of two floats $[r_{\\mathrm{div}},r_{\\mathrm{vort}}]$ in $\\mathrm{s}^{-1}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each case’s result itself a list, for example, $[[r_{\\mathrm{div},1},r_{\\mathrm{vort},1}],[r_{\\mathrm{div},2},r_{\\mathrm{vort},2}],\\dots]$.",
            "solution": "The user's request has been validated and is deemed a valid, well-posed scientific problem. Although the term \"skew-gradient\" is used, which has two common definitions with opposite signs, the problem provides the explicit Poisson equation $\\nabla^2\\psi=\\zeta$. This equation disambiguates the required relationship between the streamfunction $\\psi$ and the velocity field. The only mathematically consistent formulation is one where the vertical vorticity $\\zeta$ is the Laplacian of the streamfunction. This requires a specific sign convention which we shall adopt. The problem is thus internally consistent and solvable.\n\nWe proceed with a detailed, principle-based solution.\n\n### Principle-Based Design\n\nThe core of this problem is the Helmholtz-Hodge decomposition of a vector field on a two-dimensional periodic torus. This theorem states that any sufficiently smooth vector field $\\mathbf{u}$ can be uniquely decomposed into a divergence-free (solenoidal) component and a curl-free (irrotational) component.\n\nThe irrotational component is the gradient of a scalar potential, $\\phi$, denoted $\\mathbf{u}_{\\phi} = \\nabla \\phi$. By construction, its curl is zero: $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$.\n\nThe solenoidal component is derived from a streamfunction, $\\psi$. The problem states that this component is the \"skew-gradient of a streamfunction\" and provides the Poisson equation $\\nabla^2\\psi = \\zeta$, where $\\zeta = \\hat{\\mathbf{k}}\\cdot(\\nabla\\times\\mathbf{u})$ is the vertical vorticity. Let us derive the precise relationship. Let the solenoidal velocity component be $\\mathbf{u}_{\\psi} = (u_{\\psi}, v_{\\psi})$. For this field to be solenoidal, its divergence must be zero: $\\nabla \\cdot \\mathbf{u}_{\\psi} = \\partial_x u_{\\psi} + \\partial_y v_{\\psi} = 0$. This condition implies the existence of a scalar field $\\psi$ such that $u_{\\psi} = -\\partial_y \\psi$ and $v_{\\psi} = \\partial_x \\psi$ (or the negative of both). Adopting this convention, let us compute the vorticity of this component:\n$$\n\\zeta_{\\psi} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\psi}) = \\partial_x v_{\\psi} - \\partial_y u_{\\psi} = \\partial_x(\\partial_x \\psi) - \\partial_y(-\\partial_y \\psi) = \\partial_x^2 \\psi + \\partial_y^2 \\psi = \\nabla^2 \\psi\n$$\nThis result, $\\zeta_{\\psi} = \\nabla^2 \\psi$, is consistent with the Poisson equation $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$ given in the problem statement. The alternative convention, $\\mathbf{u}_{\\psi} = (\\partial_y \\psi, -\\partial_x \\psi)$, would lead to $\\zeta_{\\psi} = -\\nabla^2 \\psi$, contradicting the problem's formulation. Therefore, we must define the total velocity field $\\mathbf{u}=(u,v)$ in terms of the potential $\\phi$ and streamfunction $\\psi$ as:\n$$\n\\mathbf{u} = \\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi\n$$\nor in component form:\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\\\\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\nThe full decomposition process involves taking the divergence and curl of the total velocity field:\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi + \\nabla \\cdot (\\hat{\\mathbf{k}} \\times \\nabla \\psi) = \\nabla^2 \\phi\n$$\n$$\n\\hat{\\mathbf{k}} \\cdot (\\nabla \\times \\mathbf{u}) = \\zeta = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\nabla \\phi + \\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\hat{\\mathbf{k}} \\cdot (\\nabla \\times (\\hat{\\mathbf{k}} \\times \\nabla \\psi)) = \\nabla^2 \\psi\n$$\nThus, to find $\\phi$ and $\\psi$ from $\\mathbf{u}$, one must solve the two Poisson equations specified in the problem. The reconstruction of $\\mathbf{u}$ from $\\phi$ and $\\psi$ then uses the component relations derived above.\n\nThe numerical implementation will leverage the properties of the Fourier transform on a periodic domain, which provides a spectrally accurate method for differentiation and for solving the Poisson equation.\n\n#### Step 1: Construct the \"True\" Velocity Field\n\nFirst, we define a discrete grid with $N_x \\times N_y$ points spanning the domain $[0, L_x) \\times [0, L_y)$. The grid coordinates are $(x_i, y_j)$ for $i \\in \\{0, ..., N_x-1\\}$ and $j \\in \\{0, ..., N_y-1\\}$.\nThe true scalar potential $\\phi_{\\mathrm{true}}$ and streamfunction $\\psi_{\\mathrm{true}}$ are given by:\n$$\n\\phi_{\\mathrm{true}}(x,y)=A_\\phi\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right)\n$$\n$$\n\\psi_{\\mathrm{true}}(x,y)=A_\\psi\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\nUsing the consistent relationships derived above, the components of the true velocity field $\\mathbf{u}_{\\mathrm{true}} = (u_{\\mathrm{true}}, v_{\\mathrm{true}})$ are analytically:\n$$\nu_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial x} - \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial y} = -A_\\phi\\frac{2\\pi n}{L_x}\\sin\\left(\\frac{2\\pi n x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m y}{L_y}\\right) - A_\\psi\\frac{2\\pi q}{L_y}\\sin\\left(\\frac{2\\pi p x}{L_x}\\right)\\cos\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\n$$\nv_{\\mathrm{true}} = \\frac{\\partial \\phi_{\\mathrm{true}}}{\\partial y} + \\frac{\\partial \\psi_{\\mathrm{true}}}{\\partial x} = A_\\phi\\frac{2\\pi m}{L_y}\\cos\\left(\\frac{2\\pi n x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m y}{L_y}\\right) + A_\\psi\\frac{2\\pi p}{L_x}\\cos\\left(\\frac{2\\pi p x}{L_x}\\right)\\sin\\left(\\frac{2\\pi q y}{L_y}\\right)\n$$\nThese expressions will be evaluated on the discrete grid to generate the synthetic \"true\" velocity field.\n\n#### Step 2: Compute Divergence and Vorticity of the True Field\n\nFor a function $f(x,y)$ on the periodic grid, its partial derivatives can be computed spectrally. Let $\\hat{f}(k_x, k_y)$ be the 2D discrete Fourier transform of $f$. The Fourier transforms of the partial derivatives are:\n$$\n\\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial x}\\right\\} = i k_x \\hat{f}(k_x, k_y) \\quad , \\quad \\mathcal{F}\\left\\{\\frac{\\partial f}{\\partial y}\\right\\} = i k_y \\hat{f}(k_x, k_y)\n$$\nwhere $(k_x, k_y)$ are the wavenumbers corresponding to the discrete grid.\nThe divergence $\\delta_{\\mathrm{true}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{true}}$ and vorticity $\\zeta_{\\mathrm{true}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{true}})$ are computed by applying this principle. Let $\\hat{u}_{\\mathrm{true}}$ and $\\hat{v}_{\\mathrm{true}}$ be the Fourier transforms of the velocity components. Then the transforms of the divergence and vorticity are:\n$$\n\\hat{\\delta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{u}_{\\mathrm{true}} + i k_y \\hat{v}_{\\mathrm{true}}\n$$\n$$\n\\hat{\\zeta}_{\\mathrm{true}}(k_x, k_y) = i k_x \\hat{v}_{\\mathrm{true}} - i k_y \\hat{u}_{\\mathrm{true}}\n$$\nAn inverse Fourier transform on $\\hat{\\delta}_{\\mathrm{true}}$ and $\\hat{\\zeta}_{\\mathrm{true}}$ yields the fields in physical space.\n\n#### Step 3: Solve the Poisson Equations\n\nWe solve $\\nabla^2\\phi = \\delta_{\\mathrm{true}}$ and $\\nabla^2\\psi = \\zeta_{\\mathrm{true}}$. In Fourier space, the Laplacian operator $\\nabla^2$ becomes multiplication by $-(k_x^2 + k_y^2)$. Let $K^2 = k_x^2 + k_y^2$. The equations transform to:\n$$\n-K^2 \\hat{\\phi} = \\hat{\\delta}_{\\mathrm{true}}\n$$\n$$\n-K^2 \\hat{\\psi} = \\hat{\\zeta}_{\\mathrm{true}}\n$$\nThe solutions for the transformed potentials are:\n$$\n\\hat{\\phi} = -\\frac{\\hat{\\delta}_{\\mathrm{true}}}{K^2} \\quad , \\quad \\hat{\\psi} = -\\frac{\\hat{\\zeta}_{\\mathrm{true}}}{K^2}\n$$\nFor the zero-wavenumber mode ($k_x=0, k_y=0$), $K^2=0$, leading to a singularity. However, the physical problem is well-posed. The spatial average of a Laplacian must be zero on a periodic domain, which means $\\hat{\\delta}_{\\mathrm{true}}(0,0)=0$ and $\\hat{\\zeta}_{\\mathrm{true}}(0,0)=0$. This leads to a $0/0$ indeterminate form. The problem statement provides the gauge condition: the zero-wavenumber component of both $\\phi$ and $\\psi$ must be zero. This resolves the ambiguity. We set $\\hat{\\phi}(0,0)=0$ and $\\hat{\\psi}(0,0)=0$. The numerical solutions $\\phi$ and $\\psi$ are then found by taking the inverse Fourier transform of $\\hat{\\phi}$ and $\\hat{\\psi}$.\n\n#### Step 4: Reconstruct the Velocity Field\n\nThe reconstructed velocity field $\\mathbf{u}_{\\mathrm{rec}} = (u_{\\mathrm{rec}}, v_{\\mathrm{rec}})$ is computed from the numerical potentials $\\phi$ and $\\psi$ using spectral differentiation, following the definitions established initially:\n$$\n\\hat{u}_{\\mathrm{rec}}(k_x, k_y) = i k_x \\hat{\\phi} - i k_y \\hat{\\psi}\n$$\n$$\n\\hat{v}_{\\mathrm{rec}}(k_x, k_y) = i k_y \\hat{\\phi} + i k_x \\hat{\\psi}\n$$\nInverse Fourier transforms of $\\hat{u}_{\\mathrm{rec}}$ and $\\hat{v}_{\\mathrm{rec}}$ yield the reconstructed velocity field in physical space. Since the source fields are real, the resulting velocity fields will be real, and any residual imaginary part due to floating-point error should be discarded.\n\n#### Step 5: Quantify Reconstruction Error\n\nThe error in reconstruction is assessed by examining the residual fields. The velocity error is $\\mathbf{u}_{\\mathrm{err}} = \\mathbf{u}_{\\mathrm{rec}} - \\mathbf{u}_{\\mathrm{true}}$. We calculate the divergence and vorticity of this error field, again using spectral methods:\n$$\nd_{\\mathrm{err}} = \\nabla \\cdot \\mathbf{u}_{\\mathrm{err}}\n$$\n$$\n\\zeta_{\\mathrm{err}} = \\hat{\\mathbf{k}}\\cdot(\\nabla \\times \\mathbf{u}_{\\mathrm{err}})\n$$\nThe final error metrics are the Root Mean Square (RMS) of these residual fields, computed over all $N_x \\times N_y$ grid points:\n$$\nr_{\\mathrm{div}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (d_{\\mathrm{err}}(x_i, y_j))^2}\n$$\n$$\nr_{\\mathrm{vort}} = \\sqrt{\\frac{1}{N_x N_y} \\sum_{i,j} (\\zeta_{\\mathrm{err}}(x_i, y_j))^2}\n$$\nSince the entire process uses spectrally accurate methods for a smooth, analytic problem, the reconstruction should be exact up to machine precision. The resulting residual errors $r_{\\mathrm{div}}$ and $r_{\\mathrm{vort}}$ are therefore expected to be extremely small.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef compute_reconstruction_error(Nx, Ny, Lx, Ly, A_phi, A_psi, n, m, p, q):\n    \"\"\"\n    Implements the Helmholtz decomposition and reconstruction process.\n    \n    This function follows the steps outlined in the problem:\n    1. Constructs a true velocity field from analytic potentials.\n    2. Computes its divergence and vorticity using spectral methods.\n    3. Solves the Poisson equations to recover the potentials.\n    4. Reconstructs the velocity field from the computed potentials.\n    5. Quantifies the reconstruction error via residual divergence and vorticity.\n    \"\"\"\n    \n    # Grid setup\n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    xx, yy = np.meshgrid(x, y)\n\n    # Wavenumber grid setup\n    dx = Lx / Nx\n    dy = Ly / Ny\n    kx_1d = 2 * np.pi * fft.fftfreq(Nx, d=dx)\n    ky_1d = 2 * np.pi * fft.fftfreq(Ny, d=dy)\n    kx, ky = np.meshgrid(kx_1d, ky_1d)\n\n    # Step 1: Construct the \"True\" Velocity Field\n    # Wavenumbers for the analytic functions\n    kn_phi = 2 * np.pi * n / Lx if Lx != 0 else 0\n    km_phi = 2 * np.pi * m / Ly if Ly != 0 else 0\n    kp_psi = 2 * np.pi * p / Lx if Lx != 0 else 0\n    kq_psi = 2 * np.pi * q / Ly if Ly != 0 else 0\n\n    # Analytic forms of the potentials\n    phi_true = A_phi * np.cos(kn_phi * xx) * np.sin(km_phi * yy)\n    psi_true = A_psi * np.sin(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # True velocity field from analytic derivatives of potentials\n    # u = d(phi)/dx - d(psi)/dy\n    # v = d(phi)/dy + d(psi)/dx\n    u_true = -A_phi * kn_phi * np.sin(kn_phi * xx) * np.sin(km_phi * yy) \\\n             -A_psi * kq_psi * np.sin(kp_psi * xx) * np.cos(kq_psi * yy)\n    \n    v_true =  A_phi * km_phi * np.cos(kn_phi * xx) * np.cos(km_phi * yy) \\\n             +A_psi * kp_psi * np.cos(kp_psi * xx) * np.sin(kq_psi * yy)\n\n    # Step 2: Compute Divergence and Vorticity of the True Field\n    u_true_hat = fft.fft2(u_true)\n    v_true_hat = fft.fft2(v_true)\n\n    delta_true_hat = 1j * kx * u_true_hat + 1j * ky * v_true_hat\n    zeta_true_hat = 1j * kx * v_true_hat - 1j * ky * u_true_hat\n\n    # Step 3: Solve the Poisson Equations\n    K2 = kx**2 + ky**2\n    \n    # To avoid division by zero at kx=ky=0\n    with np.errstate(divide='ignore', invalid='ignore'):\n        phi_hat = -delta_true_hat / K2\n        psi_hat = -zeta_true_hat / K2\n\n    # Apply gauge: zero mean potential (zero-wavenumber component is zero)\n    phi_hat[0, 0] = 0.0\n    psi_hat[0, 0] = 0.0\n    \n    # Step 4: Reconstruct the Velocity Field\n    # u_rec = d(phi)/dx - d(psi)/dy\n    # v_rec = d(phi)/dy + d(psi)/dx\n    u_rec_hat = 1j * kx * phi_hat - 1j * ky * psi_hat\n    v_rec_hat = 1j * ky * phi_hat + 1j * kx * psi_hat\n\n    u_rec = fft.ifft2(u_rec_hat).real\n    v_rec = fft.ifft2(v_rec_hat).real\n    \n    # Step 5: Quantify Reconstruction Error\n    u_err = u_rec - u_true\n    v_err = v_rec - v_true\n\n    u_err_hat = fft.fft2(u_err)\n    v_err_hat = fft.fft2(v_err)\n\n    # Residual divergence\n    d_err_hat = 1j * kx * u_err_hat + 1j * ky * v_err_hat\n    d_err = fft.ifft2(d_err_hat).real\n    r_div = np.sqrt(np.mean(d_err**2))\n\n    # Residual vorticity\n    z_err_hat = 1j * kx * v_err_hat - 1j * ky * u_err_hat\n    z_err = fft.ifft2(z_err_hat).real\n    r_vort = np.sqrt(np.mean(z_err**2))\n    \n    return [r_div, r_vort]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (128, 128, 1.2e6, 8.0e5, 7.5e4, 5.0e4, 4, 5, 3, 2),\n        (128, 128, 1.0e6, 1.0e6, 6.0e4, 0.0, 6, 5, 1, 1),\n        (128, 128, 9.0e5, 1.1e6, 0.0, 8.5e4, 1, 1, 7, 4),\n        (96, 96, 8.0e5, 6.0e5, 2.5e4, 3.0e4, 0, 8, 10, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        r_div, r_vort = compute_reconstruction_error(*case)\n        results.append(f\"[{r_div:.8e},{r_vort:.8e}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from idealized periodic domains to more realistic bounded domains introduces new mathematical and physical challenges, particularly when specifying boundary conditions. This problem explores the crucial concept of a solvability condition for a Poisson problem with Neumann boundaries, set in the physical context of an estuary with river inflow . Deriving this condition, which is a direct consequence of the divergence theorem, ensures that the underlying physical principle—in this case, mass conservation—is satisfied, making the mathematical problem well-posed.",
            "id": "3787077",
            "problem": "Consider a steady, depth-integrated, barotropic flow in a rectangular estuary domain $\\Omega = \\{(x,y)\\,|\\, 0 < x < L,\\; 0 < y < W\\}$ of constant width $W$ and length $L$. Let the depth-integrated transport vector be $\\mathbf{U}(x,y)$, and assume irrotational flow so that there exists a velocity potential $\\phi(x,y)$ with $\\mathbf{U} = \\nabla \\phi$. The steady depth-integrated mass continuity for transport in the presence of a distributed river inflow per unit area $q(x,y)$ is $\\nabla \\cdot \\mathbf{U} = q(x,y)$.\n\nThe river inflow is modeled as a spatially distributed source that is strongest near the river head and decays downstream:\n$$\nq(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right),\n$$\nwhere $Q_{r} > 0$ is a specified discharge scale and $\\ell > 0$ is a decay length scale. The impermeable sidewalls at $y=0$ and $y=W$ and the closed river head at $x=0$ enforce no-normal-flow boundaries. At the ocean mouth $x=L$, the outward normal transport per unit width is prescribed by a Neumann boundary condition of the form\n$$\n\\frac{\\partial \\phi}{\\partial n}\\Big|_{x=L} = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right],\n$$\nwhere $\\alpha$ is a given shape parameter with $|\\alpha| < 1$, and $c$ is an unknown amplitude that must be determined to ensure well-posedness.\n\nTasks:\n- Starting from the steady depth-integrated continuity and the definition of the velocity potential, formulate the governing partial differential equation and all boundary conditions for $\\phi(x,y)$ on $\\Omega$.\n- By invoking the divergence theorem, derive the Neumann compatibility (solvability) condition that must hold for $\\phi$ to exist.\n- Using this condition and the given data, determine a closed-form expression for the amplitude $c$ in terms of $Q_{r}$, $L$, $W$, $\\ell$, and $\\alpha$.\n\nGive the final result as a single closed-form analytic expression for $c$. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The problem requires the determination of a constant $c$ in a boundary condition for a potential flow problem, such that the problem is well-posed. This is achieved by first formulating the governing partial differential equation (PDE) and boundary conditions for the velocity potential $\\phi(x,y)$, and then applying the divergence theorem to establish a solvability condition.\n\n**Step 1: Formulation of the Governing PDE and Boundary Conditions**\n\nThe depth-integrated transport vector $\\mathbf{U}(x,y)$ is related to the velocity potential $\\phi(x,y)$ by the definition of an irrotational flow:\n$$\n\\mathbf{U} = \\nabla \\phi\n$$\nwhere $\\nabla$ is the gradient operator, so $\\mathbf{U} = \\frac{\\partial \\phi}{\\partial x}\\mathbf{i} + \\frac{\\partial \\phi}{\\partial y}\\mathbf{j}$.\n\nThe steady depth-integrated mass continuity equation is given as:\n$$\n\\nabla \\cdot \\mathbf{U} = q(x,y)\n$$\nSubstituting the definition of the velocity potential into the continuity equation yields the governing PDE for $\\phi(x,y)$:\n$$\n\\nabla \\cdot (\\nabla \\phi) = q(x,y)\n$$\nThis is the Poisson equation:\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = q(x,y)\n$$\nwhere the source term is given by $q(x,y) = \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right)$.\n\nNext, we formulate the boundary conditions on the rectangular domain $\\Omega = \\{(x,y)\\,|\\, 0 < x < L,\\; 0 < y < W\\}$. The no-normal-flow condition means that the component of the transport vector $\\mathbf{U}$ normal to the boundary is zero. The normal derivative of the potential, $\\frac{\\partial \\phi}{\\partial n} = \\nabla \\phi \\cdot \\mathbf{n}$, represents the normal component of the velocity, where $\\mathbf{n}$ is the outward unit normal vector.\n\n1.  **River head at $x=0$**: The outward unit normal is $\\mathbf{n} = -\\mathbf{i}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{i}) = -\\frac{\\partial \\phi}{\\partial x} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial x}(0,y) = 0$ for $0 < y < W$.\n\n2.  **Sidewall at $y=0$**: The outward unit normal is $\\mathbf{n} = -\\mathbf{j}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot (-\\mathbf{j}) = -\\frac{\\partial \\phi}{\\partial y} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial y}(x,0) = 0$ for $0 < x < L$.\n\n3.  **Sidewall at $y=W$**: The outward unit normal is $\\mathbf{n} = \\mathbf{j}$. The no-flow condition is $\\mathbf{U} \\cdot \\mathbf{n} = (\\nabla\\phi) \\cdot \\mathbf{j} = \\frac{\\partial \\phi}{\\partial y} = 0$. Thus, $\\frac{\\partial \\phi}{\\partial y}(x,W) = 0$ for $0 < x < L$.\n\n4.  **Ocean mouth at $x=L$**: The outward unit normal is $\\mathbf{n} = \\mathbf{i}$. The problem prescribes the outward normal transport per unit width as $\\frac{\\partial \\phi}{\\partial n} = g(y)$. Therefore, $\\frac{\\partial \\phi}{\\partial x}(L,y) = g(y) = c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]$ for $0 < y < W$.\n\nThe complete problem is a Neumann boundary value problem for the Poisson equation.\n\n**Step 2: Derivation of the Neumann Compatibility (Solvability) Condition**\n\nFor a solution to the Neumann problem $\\nabla^2 \\phi = f$ on a domain $\\Omega$ with boundary condition $\\frac{\\partial \\phi}{\\partial n} = h$ on the boundary $\\partial \\Omega$, a compatibility condition must be satisfied. This condition arises from the divergence theorem (also known as Green's theorem in the plane).\n\nThe divergence theorem states:\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\,dA = \\oint_{\\partial \\Omega} (\\mathbf{F} \\cdot \\mathbf{n}) \\,ds\n$$\nLet's choose the vector field $\\mathbf{F} = \\nabla \\phi$. Then $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$. The flux term is $\\mathbf{F} \\cdot \\mathbf{n} = \\nabla \\phi \\cdot \\mathbf{n} = \\frac{\\partial \\phi}{\\partial n}$.\nSubstituting these into the divergence theorem gives:\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\nUsing the PDE $\\nabla^2 \\phi = q(x,y)$, the solvability condition becomes:\n$$\n\\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds\n$$\nThis condition has a clear physical meaning: the total mass generated by sources inside the domain must equal the total net mass flux out of the domain through its boundary.\n\n**Step 3: Determination of the Amplitude $c$**\n\nWe now evaluate both sides of the compatibility condition using the given data.\n\nThe left-hand side (LHS) is the integral of the source term over the domain:\n$$\n\\text{LHS} = \\iint_{\\Omega} q(x,y) \\,dx\\,dy = \\int_{0}^{W} \\int_{0}^{L} \\frac{Q_{r}}{W \\,\\ell}\\,\\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\,dy\n$$\nSince the integrand does not depend on $y$, we can separate the integrals:\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\left(\\int_{0}^{W} dy\\right) \\left(\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx\\right)\n$$\nThe integral with respect to $y$ is $W$. The integral with respect to $x$ is:\n$$\n\\int_{0}^{L} \\exp\\!\\left(-\\frac{x}{\\ell}\\right) \\,dx = \\left[-\\ell \\exp\\!\\left(-\\frac{x}{\\ell}\\right)\\right]_{0}^{L} = -\\ell \\exp\\!\\left(-\\frac{L}{\\ell}\\right) - (-\\ell \\exp(0)) = \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\nSubstituting these back into the expression for the LHS:\n$$\n\\text{LHS} = \\frac{Q_{r}}{W \\,\\ell} \\cdot W \\cdot \\ell \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = Q_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$\n\nThe right-hand side (RHS) is the line integral of the normal derivative of $\\phi$ along the boundary $\\partial \\Omega$. The boundary consists of four segments.\n$$\n\\text{RHS} = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\,ds = \\int_{x=0} + \\int_{y=0} + \\int_{x=L} + \\int_{y=W}\n$$\nThe contributions from the boundaries at $x=0$, $y=0$, and $y=W$ are zero because the no-flow condition $\\frac{\\partial \\phi}{\\partial n} = 0$ is imposed on them. The only non-zero contribution comes from the ocean mouth at $x=L$:\n$$\n\\text{RHS} = \\int_{0}^{W} \\frac{\\partial \\phi}{\\partial x}(L,y) \\,dy = \\int_{0}^{W} g(y) \\,dy\n$$\nSubstituting the expression for $g(y)$:\n$$\n\\text{RHS} = \\int_{0}^{W} c \\left[1 + \\alpha \\cos\\!\\left(\\frac{2\\pi y}{W}\\right)\\right] \\,dy\n$$\nWe compute the integral:\n$$\n\\text{RHS} = c \\left[ \\int_{0}^{W} 1 \\,dy + \\alpha \\int_{0}^{W} \\cos\\!\\left(\\frac{2pi y}{W}\\right) \\,dy \\right]\n$$\n$$\n\\text{RHS} = c \\left[ [y]_{0}^{W} + \\alpha \\left[\\frac{W}{2\\pi} \\sin\\!\\left(\\frac{2\\pi y}{W}\\right)\\right]_{0}^{W} \\right]\n$$\n$$\n\\text{RHS} = c \\left[ (W-0) + \\alpha \\left(\\frac{W}{2\\pi} \\sin(2\\pi) - \\frac{W}{2\\pi} \\sin(0)\\right) \\right]\n$$\nSince $\\sin(2\\pi) = 0$ and $\\sin(0) = 0$, the second term vanishes.\n$$\n\\text{RHS} = c W\n$$\n\nFinally, we equate the LHS and RHS to enforce the compatibility condition:\n$$\nQ_{r} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right) = c W\n$$\nSolving for the unknown amplitude $c$ yields the final expression:\n$$\nc = \\frac{Q_{r}}{W} \\left(1 - \\exp\\!\\left(-\\frac{L}{\\ell}\\right)\\right)\n$$",
            "answer": "$$\n\\boxed{\\frac{Q_{r}}{W} \\left(1 - \\exp\\left(-\\frac{L}{\\ell}\\right)\\right)}\n$$"
        },
        {
            "introduction": "In practice, oceanographers never work with perfect, complete velocity data; observations are inevitably noisy and spatially sparse. This advanced exercise bridges the gap between theory and application by asking you to formulate a robust method for estimating the velocity potential $\\phi$ and streamfunction $\\psi$ from imperfect data . You will construct a variational problem that seeks a solution that not only fits the observations in a least-squares sense but also adheres to physical principles by penalizing dynamically inconsistent divergence and vorticity. This approach is a cornerstone of modern data assimilation and state estimation.",
            "id": "3787058",
            "problem": "Consider a two-dimensional horizontal flow in a simply connected oceanic surface domain $D \\subset \\mathbb{R}^2$ with piecewise smooth boundary $\\Gamma$, partitioned into disjoint segments $\\Gamma_1, \\dots, \\Gamma_M$ such that $\\Gamma = \\bigcup_{i=1}^M \\Gamma_i$. Let $(u^{\\mathrm{obs}}(x,y), v^{\\mathrm{obs}}(x,y))$ denote noisy observations of the true velocity field $(u(x,y), v(x,y))$ on $D$. Assume the flow can be represented as a superposition of an irrotational component given by the gradient of a velocity potential $\\phi(x,y)$ and a nondivergent component given by the streamfunction $\\psi(x,y)$, so that at every interior point $(x,y) \\in D$,\n$$\nu = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}, \\quad v = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}.\n$$\nYou will work from the following fundamentals:\n- The divergence of the velocity field is defined by $\\delta = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$, and the vertical component of vorticity is defined by $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$.\n- For the decomposition above, the divergence and vorticity are $\\delta = \\Delta \\phi$ and $\\zeta = \\Delta \\psi$, where $\\Delta$ denotes the Laplacian $\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$.\n- The normal flux through a boundary segment $\\Gamma_i$ is given by the line integral $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s$, where $\\boldsymbol{u} = (u,v)$ and $\\boldsymbol{n}$ is the outward unit normal on $\\Gamma$.\n\nSuppose the net normal flux across each segment $\\Gamma_i$ is known and specified by real numbers $Q_i$ for $i = 1, \\dots, M$. Introduce strictly positive weight functions $w_u(x,y)$ and $w_v(x,y)$ to account for the noise structure in $u^{\\mathrm{obs}}$ and $v^{\\mathrm{obs}}$ respectively, and strictly positive penalty weights $\\alpha(x,y)$ and $\\beta(x,y)$ to penalize residual divergence and vorticity in the reconstructed velocity. Let $\\boldsymbol{n} = (n_x, n_y)$ denote the outward unit normal vector on $\\Gamma$.\n\nYour task is to derive, from the stated fundamentals and definitions, the explicit analytic expression for a constrained least-squares formulation to estimate $\\phi$ and $\\psi$ by minimizing a domain-integrated objective that:\n- penalizes the squared, weighted misfit between the reconstructed velocity $(u,v)$ and the observations $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$,\n- penalizes the squared, weighted residual divergence $\\Delta \\phi$ and residual vorticity $\\Delta \\psi$,\n- enforces the boundary flux constraints $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i$ for all $i = 1, \\dots, M$ using Lagrange multipliers.\n\nIntroduce Lagrange multipliers $\\lambda_1, \\dots, \\lambda_M$ to impose the flux constraints. Express the final answer as a single closed-form analytic expression for the augmented Lagrangian functional that encodes the constrained least-squares problem, written entirely in terms of $\\phi$, $\\psi$, $u^{\\mathrm{obs}}$, $v^{\\mathrm{obs}}$, $w_u$, $w_v$, $\\alpha$, $\\beta$, $\\Delta$, $\\boldsymbol{n}$, $Q_i$, and $\\lambda_i$, using domain and boundary integrals over $D$ and $\\Gamma_i$. Do not introduce any numerical values. Your final answer must be a single analytical expression.",
            "solution": "The problem as stated is scientifically grounded, well-posed for the specified task, and internally consistent. All provided definitions and principles are standard in the field of fluid dynamics and variational calculus. Consequently, the problem is valid and I will proceed to derive the requested functional.\n\nThe objective is to construct an augmented Lagrangian functional, which we shall denote by $\\mathcal{L}$, for the estimation of the velocity potential $\\phi(x,y)$ and the streamfunction $\\psi(x,y)$. This functional must incorporate three distinct components as stipulated: a data misfit term, a regularization term, and a set of constraint terms. We will formulate each component systematically and then sum them to obtain the final expression for $\\mathcal{L}$.\n\nFirst, we define the reconstructed velocity field $(u,v)$ in terms of the potentials $\\phi$ and $\\psi$ as given:\n$$\nu(x,y) = \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y}\n$$\n$$\nv(x,y) = \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x}\n$$\n\nThe first component of the functional, let us call it $J_1$, penalizes the squared, weighted misfit between the reconstructed velocity $(u,v)$ and the noisy observations $(u^{\\mathrm{obs}}, v^{\\mathrm{obs}})$. This is expressed as a domain integral over $D$. The weights $w_u(x,y)$ and $w_v(x,y)$ account for the non-uniform reliability of the velocity observations. The expression for this term is:\n$$\nJ_1 = \\iint_D \\left[ w_u(x,y) (u - u^{\\mathrm{obs}})^2 + w_v(x,y) (v - v^{\\mathrm{obs}})^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\nSubstituting the expressions for $u$ and $v$ in terms of $\\phi$ and $\\psi$, we obtain:\n$$\nJ_1 = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\n\nThe second component, $J_2$, is a regularization term that penalizes residual divergence and vorticity in the reconstructed flow. The problem states that the divergence is $\\delta = \\Delta \\phi$ and the vertical component of vorticity is $\\zeta = \\Delta \\psi$. The penalty term is the domain integral of the squared, weighted divergence and vorticity. The penalty weights are given by the strictly positive functions $\\alpha(x,y)$ and $\\beta(x,y)$. The formulation is:\n$$\nJ_2 = \\iint_D \\left[ \\alpha(x,y) (\\delta)^2 + \\beta(x,y) (\\zeta)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\nSubstituting the expressions for $\\delta$ and $\\zeta$ in terms of the potentials $\\phi$ and $\\psi$, we get:\n$$\nJ_2 = \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y\n$$\nwhere $\\Delta$ is the Laplacian operator, $\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$.\n\nThe third component, $J_3$, incorporates the $M$ boundary flux constraints. Each constraint specifies that the net normal flux across a boundary segment $\\Gamma_i$ must equal a given value $Q_i$:\n$$\n\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s = Q_i \\quad \\text{for } i = 1, \\dots, M\n$$\nHere, $\\boldsymbol{u} = (u,v)$ is the velocity vector and $\\boldsymbol{n} = (n_x, n_y)$ is the outward unit normal vector on the boundary $\\Gamma$. To enforce these constraints in a least-squares framework, we use the method of Lagrange multipliers. For each constraint $i$, we introduce a Lagrange multiplier $\\lambda_i$. The constraint is rewritten as $\\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i = 0$. The contribution to the augmented Lagrangian is the sum of these constraint equations, each multiplied by its corresponding Lagrange multiplier:\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\boldsymbol{n} \\cdot \\boldsymbol{u} \\, \\mathrm{d}s - Q_i \\right)\n$$\nWe must express $\\boldsymbol{n} \\cdot \\boldsymbol{u}$ explicitly in terms of $\\phi$ and $\\psi$. The dot product is $\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x u + n_y v$. Substituting the definitions of $u$ and $v$:\n$$\n\\boldsymbol{n} \\cdot \\boldsymbol{u} = n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right)\n$$\nThus, the full expression for the constraint term is:\n$$\nJ_3 = \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\n\nThe complete augmented Lagrangian functional $\\mathcal{L}(\\phi, \\psi, \\lambda_1, \\dots, \\lambda_M)$ is the sum of these three components, $\\mathcal{L} = J_1 + J_2 + J_3$. Combining the derived expressions yields the final analytic form for the functional to be minimized.\n$$\n\\mathcal{L} = \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n+ \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n$$\nThis expression represents the complete constrained least-squares formulation as required. Minimization of this functional with respect to $\\phi$ and $\\psi$, and finding the appropriate $\\lambda_i$, would yield the optimal estimates for the potential fields.",
            "answer": "$$\n\\boxed{\\begin{aligned}\n& \\iint_D \\left[ w_u \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} - u^{\\mathrm{obs}} \\right)^2 + w_v \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} - v^{\\mathrm{obs}} \\right)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n& + \\iint_D \\left[ \\alpha (\\Delta \\phi)^2 + \\beta (\\Delta \\psi)^2 \\right] \\, \\mathrm{d}x \\, \\mathrm{d}y \\\\\n& + \\sum_{i=1}^{M} \\lambda_i \\left( \\int_{\\Gamma_i} \\left[ n_x \\left( \\frac{\\partial \\phi}{\\partial x} - \\frac{\\partial \\psi}{\\partial y} \\right) + n_y \\left( \\frac{\\partial \\phi}{\\partial y} + \\frac{\\partial \\psi}{\\partial x} \\right) \\right] \\mathrm{d}s - Q_i \\right)\n\\end{aligned}}\n$$"
        }
    ]
}