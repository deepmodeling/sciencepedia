{
    "hands_on_practices": [
        {
            "introduction": "The primary motivation for employing semi-implicit free-surface formulations is computational efficiency. This exercise provides a concrete, quantitative understanding of this advantage by guiding you through a calculation of the explicit time-step limits for both fast external (barotropic) and slow internal (baroclinic) gravity waves. By comparing these time steps, you will compute the 'gain factor', a direct measure of the computational speedup afforded by treating the fast mode implicitly .",
            "id": "3810274",
            "problem": "Consider a one-dimensional hydrostatic, Boussinesq ocean on an $f$-plane with a free surface, uniform mean depth $H$, and uniform horizontal grid spacing $\\Delta x$. Neglect rotation and friction, and focus on linear, non-dispersive, long gravity waves. The horizontal velocity is $u(x,t)$ and the free-surface displacement is $\\eta(x,t)$. The governing depth-averaged linear shallow-water equations are the linear momentum balance $\\partial_t u = -g\\,\\partial_x \\eta$ and the mass continuity $\\partial_t \\eta + H\\,\\partial_x u = 0$, where $g$ is gravitational acceleration. A two-layer extension with layer thicknesses $H_1$ and $H_2$ ($H_1+H_2=H$) and densities $\\rho_1<\\rho_2$ supports a baroclinic (internal) long-wave mode controlled by the reduced gravity $g' = g(\\rho_2-\\rho_1)/\\rho_2$.\n\nUsing only these foundations together with the Courant–Friedrichs–Lewy (CFL) condition for explicit time stepping applied to linear wave propagation on a uniform grid, do the following:\n\n1. From the one-layer equations, derive the external (barotropic) long-wave phase speed and the corresponding explicit stability restriction on the time step for an explicit scheme resolving that mode. Evaluate the explicit stability-limited time step for the parameter values $\\Delta x = 5\\,\\mathrm{km}$, $H = 4000\\,\\mathrm{m}$, and $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$. Express this intermediate result in seconds.\n\n2. For the two-layer system with $H_1=500\\,\\mathrm{m}$, $H_2=3500\\,\\mathrm{m}$, $\\rho_1=1025\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, and $\\rho_2=1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, derive the internal long-wave phase speed and the corresponding explicit stability restriction on the time step for a mode-resolving explicit scheme. Explain why a semi-implicit free-surface formulation that treats the external (barotropic) mode implicitly but leaves the internal (baroclinic) dynamics explicit is not constrained by the external gravity-wave CFL condition, and estimate the semi-implicit time step by the internal-mode CFL condition for the same $\\Delta x$.\n\n3. Define the gain factor $G$ as the ratio of the semi-implicit time step estimate to the explicit external-wave-limited time step derived in part 1. Compute $G$ for the given parameters.\n\nReport only the gain factor $G$ as your final answer. Round your reported $G$ to $3$ significant figures. The reported final answer must be a pure number with no units.",
            "solution": "The problem requires an analysis of the computational efficiency gained by using a semi-implicit free-surface formulation for a shallow-water ocean model. This is quantified by the gain factor $G$, which is the ratio of the maximum allowable time step in a semi-implicit scheme to that of a fully explicit scheme. The solution will be developed in three parts as requested.\n\n### Part 1: External (Barotropic) Mode and Explicit Time Step\n\nWe begin with the one-dimensional, linearized, depth-averaged shallow-water equations provided:\n$$\n\\frac{\\partial u}{\\partial t} = -g \\frac{\\partial \\eta}{\\partial x} \\quad (1)\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0 \\quad (2)\n$$\nHere, $u(x,t)$ is the horizontal velocity, $\\eta(x,t)$ is the free-surface elevation, $g$ is the acceleration due to gravity, and $H$ is the constant mean water depth.\n\nTo find the wave propagation speed, we combine these two first-order partial differential equations into a single second-order wave equation. We differentiate equation (1) with respect to $x$ and equation (2) with respect to $t$:\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial t} = -g \\frac{\\partial^2 \\eta}{\\partial x^2}\n$$\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H \\frac{\\partial^2 u}{\\partial t \\partial x} = 0\n$$\nAssuming sufficient smoothness of the fields, we can interchange the order of differentiation, so $\\frac{\\partial^2 u}{\\partial x \\partial t} = \\frac{\\partial^2 u}{\\partial t \\partial x}$. Substituting the first expression into the second gives:\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H \\left( -g \\frac{\\partial^2 \\eta}{\\partial x^2} \\right) = 0\n$$\nThis rearranges to the canonical one-dimensional wave equation:\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} = g H \\frac{\\partial^2 \\eta}{\\partial x^2}\n$$\nThe general form of the wave equation is $\\frac{\\partial^2 \\psi}{\\partial t^2} = c^2 \\frac{\\partial^2 \\psi}{\\partial x^2}$, where $c$ is the phase speed. By comparison, the phase speed of these external (barotropic) long gravity waves is:\n$$\nc_{ext} = \\sqrt{g H}\n$$\nFor an explicit numerical scheme applied to a hyperbolic problem like the wave equation, the Courant–Friedrichs–Lewy (CFL) condition dictates the maximum stable time step, $\\Delta t$. The condition is given by $C_n \\le 1$, where $C_n = c \\frac{\\Delta t}{\\Delta x}$ is the Courant number. This gives the stability restriction:\n$$\n\\Delta t \\le \\frac{\\Delta x}{c}\n$$\nFor the explicit scheme resolving the external mode, the time step $\\Delta t_{exp}$ is therefore limited by the speed $c_{ext}$:\n$$\n\\Delta t_{exp} \\le \\frac{\\Delta x}{c_{ext}} = \\frac{\\Delta x}{\\sqrt{gH}}\n$$\nWe now evaluate the maximal value for $\\Delta t_{exp}$ using the given parameters: $\\Delta x = 5\\,\\mathrm{km} = 5000\\,\\mathrm{m}$, $H = 4000\\,\\mathrm{m}$, and $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$.\nFirst, we compute the external wave speed:\n$$\nc_{ext} = \\sqrt{(9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2})(4000\\,\\mathrm{m})} = \\sqrt{39240\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}} \\approx 198.09\\,\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\nThen, we compute the maximum explicit time step:\n$$\n\\Delta t_{exp} = \\frac{5000\\,\\mathrm{m}}{198.09\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} \\approx 25.24\\,\\mathrm{s}\n$$\n\n### Part 2: Internal (Baroclinic) Mode and Semi-Implicit Time Step\n\nFor the two-layer system, the problem states that the internal long-wave mode is governed by the reduced gravity $g' = g(\\rho_2-\\rho_1)/\\rho_2$. The phase speed of the first baroclinic mode for long internal waves is analogous to the barotropic case, but with gravity $g$ replaced by the reduced gravity $g'$ and the total depth $H$ replaced by the reduced depth $H^* = \\frac{H_1 H_2}{H_1+H_2}$. Thus, the internal wave phase speed is:\n$$\nc_{int} = \\sqrt{g' \\frac{H_1 H_2}{H_1+H_2}}\n$$\nWe use the given parameters for the two-layer system: $H_1=500\\,\\mathrm{m}$, $H_2=3500\\,\\mathrm{m}$, $\\rho_1=1025\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $\\rho_2=1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $g=9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, and $\\Delta x = 5000\\,\\mathrm{m}$.\nFirst, calculate the reduced gravity $g'$:\n$$\ng' = (9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}) \\frac{1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3} - 1025\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}}{1030\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}} = 9.81 \\times \\frac{5}{1030} \\approx 0.04762\\,\\mathrm{m}\\,\\mathrm{s}^{-2}\n$$\nNext, calculate the internal wave speed $c_{int}$:\n$$\nc_{int} = \\sqrt{(0.04762\\,\\mathrm{m}\\,\\mathrm{s}^{-2}) \\frac{(500\\,\\mathrm{m})(3500\\,\\mathrm{m})}{500\\,\\mathrm{m}+3500\\,\\mathrm{m}}} = \\sqrt{0.04762 \\times \\frac{1750000}{4000}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}} = \\sqrt{0.04762 \\times 437.5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1} \\approx \\sqrt{20.834}\\,\\mathrm{m}\\,\\mathrm{s}^{-1} \\approx 4.564\\,\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\nA semi-implicit free-surface formulation treats the terms responsible for the fast external gravity waves (the pressure gradient term $-g\\partial_x \\eta$ and the divergence term $H\\partial_x u$ for the surface elevation) implicitly in time. Implicit numerical schemes are unconditionally stable for linear wave problems, meaning the CFL condition related to those waves does not apply. Therefore, the time step is no longer restricted by the very fast external wave speed $c_{ext}$.\n\nHowever, the slower internal (baroclinic) dynamics, along with other processes like advection, are typically treated explicitly for computational efficiency. The stability of the overall scheme is then dictated by the fastest mode that is treated explicitly. In this case, this is the internal gravity wave. The maximum stable time step for the semi-implicit scheme, $\\Delta t_{si}$, is therefore determined by the CFL condition for the internal waves:\n$$\n\\Delta t_{si} \\le \\frac{\\Delta x}{c_{int}}\n$$\nUsing the calculated value of $c_{int}$ and the given $\\Delta x$:\n$$\n\\Delta t_{si} = \\frac{5000\\,\\mathrm{m}}{4.564\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} \\approx 1095.5\\,\\mathrm{s}\n$$\nThis demonstrates the significant advantage of a semi-implicit approach, allowing a much larger time step than a fully explicit scheme.\n\n### Part 3: Gain Factor\n\nThe gain factor $G$ is defined as the ratio of the semi-implicit time step estimate to the explicit external-wave-limited time step:\n$$\nG = \\frac{\\Delta t_{si}}{\\Delta t_{exp}}\n$$\nSubstituting the expressions from the CFL conditions:\n$$\nG = \\frac{\\Delta x / c_{int}}{\\Delta x / c_{ext}} = \\frac{c_{ext}}{c_{int}}\n$$\nUsing the computed values for the wave speeds:\n$$\nG = \\frac{198.09\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{4.564\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} \\approx 43.40\n$$\nRounding to $3$ significant figures, the gain factor is $43.4$. This means the semi-implicit scheme allows for a time step that is over $40$ times larger than a fully explicit scheme for the given parameters, leading to a substantial reduction in computational cost.",
            "answer": "$$\n\\boxed{43.4}\n$$"
        },
        {
            "introduction": "Having established the computational necessity of semi-implicit methods, we now delve into their theoretical properties. This practice uses von Neumann stability analysis to explore how the choice of the implicitness parameter, $\\theta$, governs the scheme's behavior. You will determine the conditions for numerical stability and find the optimal value of $\\theta$ that minimizes phase error, revealing a fundamental trade-off between numerical accuracy and dissipation .",
            "id": "3810286",
            "problem": "Consider the one-dimensional linearized barotropic shallow-water equations for small-amplitude free-surface gravity waves over constant depth, written in Fourier space for a single wavenumber $k$ as the first-order system $y_{t} = A y$ with $y = \\begin{pmatrix} u \\\\ \\eta \\end{pmatrix}$, $A = \\begin{pmatrix} 0 & -g i k \\\\ -H i k & 0 \\end{pmatrix}$, gravity acceleration $g$, and mean depth $H$. The eigenfrequencies of $A$ are purely imaginary, $\\lambda = \\pm i \\omega$, with $\\omega = c k$ and barotropic gravity-wave speed $c = \\sqrt{g H}$. In a semi-implicit free-surface formulation, a common two-level time discretization applies the generalized $\\theta$-method to the linear right-hand side, yielding\n$$\ny^{n+1} = y^{n} + \\Delta t \\left( (1 - \\theta) A y^{n} + \\theta A y^{n+1} \\right),\n$$\nwhere $\\Delta t$ is the time step and $\\theta \\in [0,1]$ is the implicitness parameter. Define the gravity-wave Courant-Friedrichs-Lewy (CFL) number $\\zeta = \\omega \\Delta t = c k \\Delta t$. For the Fourier mode associated with a single eigenfrequency $\\lambda = i \\omega$, this semi-implicit update reduces to a scalar linear recurrence with a complex amplification factor $G(\\theta,\\zeta)$ satisfying $y^{n+1} = G(\\theta,\\zeta) y^{n}$. The numerical phase per time step is the argument of $G(\\theta,\\zeta)$, denoted $\\varphi(\\theta,\\zeta)$, so that $G(\\theta,\\zeta) = |G(\\theta,\\zeta)| \\exp(i \\varphi(\\theta,\\zeta))$, whereas the exact continuous phase advance over one step is $\\zeta$.\n\nUsing only the stated physical and numerical model, derive the discrete amplification factor $G(\\theta,\\zeta)$ for the scalar eigenmode, obtain an analytic expression for the numerical phase $\\varphi(\\theta,\\zeta)$, and define the one-step phase error at a prescribed target nondimensional frequency $\\zeta_{0} > 0$ as $E(\\theta;\\zeta_{0}) = \\zeta_{0} - \\varphi(\\theta,\\zeta_{0})$. Impose the requirement that the chosen $\\theta$ ensures unconditional stability for purely imaginary eigenvalues. Determine the value of $\\theta$ that minimizes $E(\\theta;\\zeta_{0})$ subject to this stability constraint, and justify the choice analytically from first principles. Express your final answer as the value of $\\theta$. No rounding is required, and no units are to be reported for $\\theta$.",
            "solution": "The problem requires us to determine the value of the implicitness parameter $\\theta$ that minimizes the one-step numerical phase error for a given non-dimensional frequency $\\zeta_{0}$, subject to the constraint of unconditional numerical stability. The analysis will be performed using the provided semi-implicit discretization of the linearized shallow-water equations.\n\nFirst, we derive the complex amplification factor, $G(\\theta, \\zeta)$. The problem states that for a single eigenmode corresponding to the eigenvalue $\\lambda$, the discrete update equation is\n$$\ny^{n+1} = y^{n} + \\Delta t \\left( (1 - \\theta) \\lambda y^{n} + \\theta \\lambda y^{n+1} \\right)\n$$\nWe are concerned with the eigenfrequency $\\lambda = i \\omega$, where $\\omega$ is the real-valued wave frequency. Substituting this into the equation gives:\n$$\ny^{n+1} = y^{n} + \\Delta t \\left( (1 - \\theta) (i \\omega) y^{n} + \\theta (i \\omega) y^{n+1} \\right)\n$$\nThe amplification factor $G$ is defined by the relation $y^{n+1} = G y^{n}$. Substituting this into the equation yields:\n$$\nG y^{n} = y^{n} + \\Delta t \\left( (1 - \\theta) (i \\omega) y^{n} + \\theta (i \\omega) G y^{n} \\right)\n$$\nDividing by $y^{n}$ (which is non-zero for a non-trivial mode) and rearranging the terms to solve for $G$:\n$$\nG = 1 + (1 - \\theta) i \\omega \\Delta t + \\theta i \\omega \\Delta t G\n$$\n$$\nG (1 - \\theta i \\omega \\Delta t) = 1 + (1 - \\theta) i \\omega \\Delta t\n$$\nUsing the definition of the gravity-wave Courant-Friedrichs-Lewy (CFL) number, $\\zeta = \\omega \\Delta t$, we can express $G$ as a function of $\\theta$ and $\\zeta$:\n$$\nG(\\theta, \\zeta) = \\frac{1 + i (1 - \\theta) \\zeta}{1 - i \\theta \\zeta}\n$$\n\nSecond, we determine the condition for unconditional stability. For the numerical scheme to be stable, the magnitude of the amplification factor must not exceed unity, i.e., $|G| \\le 1$. We analyze its squared magnitude:\n$$\n|G(\\theta, \\zeta)|^2 = \\left| \\frac{1 + i (1 - \\theta) \\zeta}{1 - i \\theta \\zeta} \\right|^2 = \\frac{|1 + i (1 - \\theta) \\zeta|^2}{|1 - i \\theta \\zeta|^2}\n$$\nThe squared magnitude of a complex number $a + ib$ is $a^2 + b^2$. Thus,\n$$\n|G(\\theta, \\zeta)|^2 = \\frac{1^2 + ((1 - \\theta) \\zeta)^2}{1^2 + (-\\theta \\zeta)^2} = \\frac{1 + (1 - \\theta)^2 \\zeta^2}{1 + \\theta^2 \\zeta^2}\n$$\nThe stability condition $|G|^2 \\le 1$ becomes:\n$$\n\\frac{1 + (1 - \\theta)^2 \\zeta^2}{1 + \\theta^2 \\zeta^2} \\le 1\n$$\nSince the denominator $1 + \\theta^2 \\zeta^2$ is always positive, we can multiply both sides by it:\n$$\n1 + (1 - \\theta)^2 \\zeta^2 \\le 1 + \\theta^2 \\zeta^2\n$$\n$$\n(1 - \\theta)^2 \\zeta^2 \\le \\theta^2 \\zeta^2\n$$\nFor any non-zero wave mode, $\\zeta > 0$, so $\\zeta^2 > 0$. We can divide by $\\zeta^2$:\n$$\n(1 - \\theta)^2 \\le \\theta^2\n$$\n$$\n1 - 2\\theta + \\theta^2 \\le \\theta^2\n$$\n$$\n1 - 2\\theta \\le 0 \\implies 1 \\le 2\\theta \\implies \\theta \\ge \\frac{1}{2}\n$$\nThe problem specifies that $\\theta \\in [0,1]$. Therefore, the condition for unconditional stability (i.e., stability for all values of $\\zeta > 0$) is $\\theta \\in [\\frac{1}{2}, 1]$.\n\nThird, we derive the numerical phase $\\varphi(\\theta, \\zeta)$ and the phase error $E(\\theta; \\zeta_0)$. The numerical phase is the argument of the complex amplification factor $G(\\theta, \\zeta)$. For a complex number $z = z_1/z_2$, its argument is $\\arg(z) = \\arg(z_1) - \\arg(z_2)$.\nLet $z_1 = 1 + i(1 - \\theta)\\zeta$ and $z_2 = 1 - i\\theta\\zeta$.\n$$\n\\arg(z_1) = \\arctan((1-\\theta)\\zeta)\n$$\n$$\n\\arg(z_2) = \\arctan(-\\theta\\zeta) = -\\arctan(\\theta\\zeta)\n$$\nThe numerical phase is then:\n$$\n\\varphi(\\theta, \\zeta) = \\arg(z_1) - \\arg(z_2) = \\arctan((1-\\theta)\\zeta) - (-\\arctan(\\theta\\zeta)) = \\arctan((1-\\theta)\\zeta) + \\arctan(\\theta\\zeta)\n$$\nThe phase error at a prescribed target frequency $\\zeta_0 > 0$ is defined as $E(\\theta; \\zeta_0) = \\zeta_0 - \\varphi(\\theta, \\zeta_0)$.\n$$\nE(\\theta; \\zeta_0) = \\zeta_0 - \\left[ \\arctan((1-\\theta)\\zeta_0) + \\arctan(\\theta\\zeta_0) \\right]\n$$\n\nFourth, we minimize the phase error $E(\\theta; \\zeta_0)$ with respect to $\\theta$ over the stability interval $\\theta \\in [\\frac{1}{2}, 1]$. Minimizing $E(\\theta; \\zeta_0)$ is equivalent to maximizing $\\varphi(\\theta, \\zeta_0)$, since $\\zeta_0$ is a constant with respect to $\\theta$. We will find the extrema of $\\varphi(\\theta, \\zeta_0)$ by finding its derivative with respect to $\\theta$.\nLet us denote $f(\\theta) = \\varphi(\\theta, \\zeta_0)$.\n$$\n\\frac{df}{d\\theta} = \\frac{d}{d\\theta} \\left[ \\arctan((1-\\theta)\\zeta_0) + \\arctan(\\theta\\zeta_0) \\right]\n$$\nUsing the chain rule and the derivative $\\frac{d}{dx}\\arctan(u) = \\frac{1}{1+u^2}\\frac{du}{dx}$:\n$$\n\\frac{df}{d\\theta} = \\frac{1}{1 + (1-\\theta)^2\\zeta_0^2} \\cdot (-\\zeta_0) + \\frac{1}{1 + \\theta^2\\zeta_0^2} \\cdot (\\zeta_0)\n$$\n$$\n\\frac{df}{d\\theta} = \\zeta_0 \\left( \\frac{1}{1 + \\theta^2\\zeta_0^2} - \\frac{1}{1 + (1-\\theta)^2\\zeta_0^2} \\right)\n$$\nTo find critical points, we set the derivative to zero:\n$$\n\\frac{1}{1 + \\theta^2\\zeta_0^2} = \\frac{1}{1 + (1-\\theta)^2\\zeta_0^2}\n$$\nThis implies $1 + \\theta^2\\zeta_0^2 = 1 + (1-\\theta)^2\\zeta_0^2$, which simplifies to $\\theta^2 = (1-\\theta)^2$. This equation has two solutions: $\\theta = 1-\\theta$ or $\\theta = -(1-\\theta)$. The latter, $\\theta = \\theta-1$, simplifies to $0=-1$, which is false. The former, $\\theta=1-\\theta$, gives $2\\theta=1$, so $\\theta = \\frac{1}{2}$.\n\nThis critical point lies at the boundary of our interval of interest, $[\\frac{1}{2}, 1]$. To determine if this is a minimum or maximum of $\\varphi$, and thus the nature of the extremum for $E$, we examine the sign of the first derivative $\\frac{df}{d\\theta}$ on the interior of the interval, i.e., for $\\theta \\in (\\frac{1}{2}, 1]$.\nLet's rewrite the derivative by combining the fractions:\n$$\n\\frac{df}{d\\theta} = \\zeta_0 \\frac{(1+(1-\\theta)^2\\zeta_0^2) - (1+\\theta^2\\zeta_0^2)}{(1+\\theta^2\\zeta_0^2)(1+(1-\\theta)^2\\zeta_0^2)} = \\zeta_0 \\frac{((1-\\theta)^2 - \\theta^2)\\zeta_0^2}{(1+\\theta^2\\zeta_0^2)(1+(1-\\theta)^2\\zeta_0^2)}\n$$\nThe denominator is always positive. Since $\\zeta_0 > 0$, the sign of $\\frac{df}{d\\theta}$ is determined by the sign of the term $(1-\\theta)^2 - \\theta^2 = 1 - 2\\theta + \\theta^2 - \\theta^2 = 1-2\\theta$.\nFor any $\\theta$ in the open interval $(\\frac{1}{2}, 1]$, the term $1-2\\theta$ is negative. Therefore, $\\frac{df}{d\\theta} < 0$ for all $\\theta \\in (\\frac{1}{2}, 1]$.\nThis proves that the function $\\varphi(\\theta, \\zeta_0)$ is strictly decreasing with respect to $\\theta$ on the interval $[\\frac{1}{2}, 1]$. Consequently, the maximum value of $\\varphi(\\theta, \\zeta_0)$ on this interval occurs at the leftmost point, $\\theta=\\frac{1}{2}$.\nSince $E(\\theta; \\zeta_0) = \\zeta_0 - \\varphi(\\theta, \\zeta_0)$, minimizing $E$ is equivalent to maximizing $\\varphi$. Thus, the phase error $E$ is minimized at $\\theta = \\frac{1}{2}$.\n\nThis value, $\\theta = \\frac{1}{2}$, corresponds to the Crank-Nicolson method. It is the unique choice within the family of unconditionally stable $\\theta$-methods that minimizes the phase error for any given frequency $\\zeta_0 > 0$.",
            "answer": "$$\n\\boxed{\\frac{1}{2}}\n$$"
        },
        {
            "introduction": "This final practice bridges the gap between abstract theory and practical application by tasking you with a complete simulation and analysis workflow. You will implement a semi-implicit time-stepping model for the shallow-water equations, generate a time series of the sea-surface elevation, and then use harmonic analysis to diagnose the numerical solution's properties. This exercise demonstrates how theoretical concepts like numerical dispersion and damping manifest in a model's output, a crucial skill for model verification and development .",
            "id": "3810254",
            "problem": "You are given the task of analyzing the dispersion properties of linear barotropic gravity waves under a semi-implicit free-surface time integration and to quantify the phase and amplitude characteristics via harmonic analysis. Begin from the one-dimensional linearized shallow-water equations (also called the linearized barotropic equations) for a homogeneous ocean of constant depth, which are\n$$\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x}, \\quad \\frac{\\partial \\eta}{\\partial t} = - H \\frac{\\partial u}{\\partial x},$$\nwhere $u$ is the depth-averaged velocity in $\\mathrm{m/s}$, $\\eta$ is the free-surface elevation in $\\mathrm{m}$, $g$ is the gravitational acceleration in $\\mathrm{m/s^2}$, and $H$ is the constant depth in $\\mathrm{m}$. Consider a single Fourier mode in space with wavenumber $k$ in $\\mathrm{rad/m}$, such that the spatial derivative operator acts as multiplication by $i k$. Let the state vector be $U(t) = [u(t), \\eta(t)]^\\top$. Then the continuous-time dynamics can be written as\n$$\\frac{d U}{dt} = A U,$$\nwith\n$$A = \\begin{bmatrix} 0 & - g i k \\\\ - H i k & 0 \\end{bmatrix}.$$\nImplement a semi-implicit $\\theta$-method in time for this system, defined by\n$$U^{n+1} = U^n + \\Delta t \\big((1-\\theta) A U^n + \\theta A U^{n+1}\\big),$$\nwhere $\\Delta t$ is the time step in $\\mathrm{s}$ and $\\theta \\in [0,1]$ is the implicitness parameter. This method requires solving a linear system at each step,\n$$(I - \\theta \\Delta t \\, A) U^{n+1} = (I + (1-\\theta) \\Delta t \\, A) U^n.$$\nFrom first principles, for the single Fourier mode, derive the discrete-time amplification factor for the gravity-wave eigenmode and its associated discrete angular frequency, and explain how the semi-implicit weighting modifies the dispersion relative to the continuous angular frequency\n$$\\omega = \\sqrt{g H} |k|.$$\nThen, design and implement a harmonic analysis of the model sea level time series at a fixed spatial point $x=0$ to estimate the constituent amplitude and phase for a specified analysis frequency. Use least squares to fit a model of the form\n$$\\eta(t_n) \\approx C \\cos(\\omega_a t_n) + S \\sin(\\omega_a t_n),$$\nwhere $t_n = n \\Delta t$, $n=0,1,\\dots,N-1$, and $\\omega_a$ is the analysis angular frequency in $\\mathrm{rad/s}$. Report the amplitude $A_a = \\sqrt{C^2 + S^2}$ in $\\mathrm{m}$ and the phase $\\phi_a = \\operatorname{atan2}(-S, C)$ in $\\mathrm{radians}$. Use this harmonic analysis to diagnose the dispersion error introduced by the semi-implicit gravity-wave treatment by comparing the discrete angular frequency with the continuous angular frequency, and report the fractional dispersion error\n$$\\delta = \\frac{\\omega_d - \\omega}{\\omega},$$\nwhere $\\omega_d$ is the discrete angular frequency in $\\mathrm{rad/s}$. Also report the per-time-step amplitude factor for the discrete eigenmode, which quantifies numerical damping or growth.\n\nYour program must:\n- Construct the semi-implicit update for the $2 \\times 2$ system using the given $A$ matrix.\n- Generate a synthetic time series of $\\eta$ at $x=0$ by time-stepping from the initial condition $u(0)=0$, $\\eta(0)=A_0$, where $A_0$ is a given real amplitude in $\\mathrm{m}$.\n- Perform harmonic analysis via least squares at the discrete angular frequency $\\omega_d$ to estimate the amplitude in $\\mathrm{m}$ and phase in $\\mathrm{radians}$.\n- Compute the fractional dispersion error $\\delta$ and the per-step amplitude factor (a dimensionless real number).\n\nExpress all amplitudes in $\\mathrm{m}$, phases in $\\mathrm{radians}$, and dispersion error as a decimal fraction (no percentage sign). Angles must be in radians.\n\nDefine the total integration duration as $T = 10 \\times \\frac{2\\pi}{\\omega}$ and set $N = \\lfloor T / \\Delta t \\rfloor$. For each test case below, compute and report:\n- The fitted amplitude at the discrete frequency, in $\\mathrm{m}$.\n- The fitted phase at the discrete frequency, in $\\mathrm{radians}$.\n- The fractional dispersion error $\\delta$ (decimal fraction).\n- The per-step amplitude factor (dimensionless).\n\nUse the following test suite of parameter sets $(H, L, m, \\Delta t, \\theta, A_0, g)$, where $L$ is the domain length in $\\mathrm{m}$, $m$ is the Fourier mode index (so $k = 2\\pi m / L$), and $g$ is gravitational acceleration in $\\mathrm{m/s^2}$:\n- Case $1$: $(H, L, m, \\Delta t, \\theta, A_0, g) = (50, 100000, 1, 30, 0.6, 1.0, 9.81)$.\n- Case $2$: $(H, L, m, \\Delta t, \\theta, A_0, g) = (100, 200000, 1, 100, 0.5, 1.0, 9.81)$.\n- Case $3$: $(H, L, m, \\Delta t, \\theta, A_0, g) = (10, 50000, 1, 300, 0.7, 0.5, 9.81)$.\n- Case $4$: $(H, L, m, \\Delta t, \\theta, A_0, g) = (30, 150000, 2, 1, 0.55, 1.2, 9.81)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each case’s result is itself a bracketed comma-separated list with four numbers in the order described above. For example, the output should look like\n$$\n\\big[ [a_1, \\phi_1, \\delta_1, \\gamma_1], [a_2, \\phi_2, \\delta_2, \\gamma_2], [a_3, \\phi_3, \\delta_3, \\gamma_3], [a_4, \\phi_4, \\delta_4, \\gamma_4] \\big]\n$$\nwith all amplitudes in $\\mathrm{m}$, phases in $\\mathrm{radians}$, and dispersion errors as decimal fractions.",
            "solution": "The problem requires an analysis of a semi-implicit numerical scheme for the 1D linearized shallow-water equations. The analysis involves both a theoretical derivation of the scheme's properties for a single Fourier mode and a numerical implementation to verify these properties.\n\n### Theoretical Analysis: Dispersion and Damping\n\nThe continuous-time dynamics of a single Fourier mode with wavenumber $k$ are governed by the system $\\frac{d U}{dt} = A U$, where $U = [u, \\eta]^\\top$ contains the complex amplitudes of velocity and surface elevation, and the matrix $A$ is given by\n$$A = \\begin{bmatrix} 0 & - g i k \\\\ - H i k & 0 \\end{bmatrix}.$$\nThe eigenvalues of $A$ determine the behavior of the continuous system. The characteristic equation is $\\det(A - \\lambda I) = \\lambda^2 + g H k^2 = 0$, which yields the eigenvalues $\\lambda_{\\pm} = \\pm i \\sqrt{g H} |k|$. Defining the continuous angular frequency as $\\omega = \\sqrt{g H} |k|$, the eigenvalues are $\\lambda_{\\pm} = \\pm i \\omega$. These purely imaginary eigenvalues correspond to undamped wave propagation.\n\nThe semi-implicit $\\theta$-method is given by\n$$(I - \\theta \\Delta t \\, A) U^{n+1} = (I + (1-\\theta) \\Delta t \\, A) U^n.$$\nThe evolution of the state vector over one time step is thus described by the amplification matrix $G$:\n$$U^{n+1} = G U^n, \\quad \\text{where} \\quad G = (I - \\theta \\Delta t \\, A)^{-1} (I + (1-\\theta) \\Delta t \\, A).$$\nThe eigenvalues $\\mu$ of the amplification matrix $G$ determine the stability and accuracy of the numerical scheme. For an eigenvalue $\\lambda$ of $A$, the corresponding eigenvalue of $G$ is given by the rational function\n$$\\mu = \\frac{1 + (1-\\theta) \\Delta t \\lambda}{1 - \\theta \\Delta t \\lambda}.$$\nSubstituting the continuous system eigenvalues $\\lambda = \\pm i\\omega$, we find the eigenvalues for the numerical scheme:\n$$\\mu_{\\pm} = \\frac{1 \\pm i(1-\\theta)\\omega\\Delta t}{1 \\mp i\\theta\\omega\\Delta t}.$$\nThe numerical solution after one time step is multiplied by this complex factor $\\mu$. Its magnitude, $|\\mu|$, represents the per-step amplitude factor, which quantifies numerical damping or growth. Its argument, $\\arg(\\mu)$, represents the phase change over one time step, which determines the discrete angular frequency $\\omega_d$.\n\nThe per-step amplitude factor is the modulus of $\\mu_+$ (the modulus of $\\mu_-$ is identical):\n$$|\\mu| = \\frac{|1 + i(1-\\theta)\\omega\\Delta t|}{|1 - i\\theta\\omega\\Delta t|} = \\frac{\\sqrt{1^2 + ((1-\\theta)\\omega\\Delta t)^2}}{\\sqrt{1^2 + (-\\theta\\omega\\Delta t)^2}} = \\frac{\\sqrt{1 + (1-\\theta)^2(\\omega\\Delta t)^2}}{\\sqrt{1 + \\theta^2(\\omega\\Delta t)^2}}.$$\nFor stability, we require $|\\mu| \\le 1$. This condition is met for $\\theta \\ge 0.5$. If $\\theta=0.5$ (Crank-Nicolson scheme), $|\\mu|=1$, indicating no numerical damping. If $\\theta > 0.5$, $|\\mu| < 1$, the scheme is numerically dissipative, which can be desirable for damping unresolved high-frequency noise.\n\nThe discrete angular frequency $\\omega_d$ is related to the phase of $\\mu$. We equate the numerical phase change over one step, $\\arg(\\mu)$, to the phase change of a discrete wave, $\\omega_d \\Delta t$.\n$$\\omega_d \\Delta t = \\arg(\\mu_+) = \\arg(1 + i(1-\\theta)\\omega\\Delta t) - \\arg(1 - i\\theta\\omega\\Delta t).$$\nUsing the `atan2` function or the identity for the sum of arctangents, this becomes\n$$\\omega_d \\Delta t = \\arctan\\left(\\frac{(1-\\theta)\\omega\\Delta t + \\theta\\omega\\Delta t}{1 - \\theta(1-\\theta)(\\omega\\Delta t)^2}\\right) = \\arctan\\left(\\frac{\\omega\\Delta t}{1 - \\theta(1-\\theta)(\\omega\\Delta t)^2}\\right).$$\nThus, the discrete angular frequency is\n$$\\omega_d = \\frac{1}{\\Delta t} \\arctan\\left(\\frac{\\omega\\Delta t}{1 - \\theta(1-\\theta)(\\omega\\Delta t)^2}\\right).$$\nThe discrepancy between $\\omega_d$ and $\\omega$ is the numerical dispersion error, which we quantify as the fractional error $\\delta = (\\omega_d - \\omega) / \\omega$. A non-zero $\\delta$ means that waves travel at a speed different from their physical speed, a common feature of numerical schemes.\n\n### Numerical Implementation and Harmonic Analysis\n\nTo validate the theoretical findings and quantify the properties for specific parameters, we perform a numerical simulation. The simulation evolves the complex state vector $U(t) = [u(t), \\eta(t)]^\\top$ from an initial condition $u(0)=0$ and $\\eta(0)=A_0$. This initial condition excites a standing wave, where at the spatial point $x=0$, the velocity is always zero and the sea surface elevation oscillates. The theoretical continuous solution for the complex amplitude of elevation is $\\eta(t) = A_0 \\cos(\\omega t)$, and the corresponding numerical solution is $\\eta(t_n) \\approx A_0 |\\mu|^n \\cos(\\omega_d t_n)$.\n\nThe simulation proceeds by iteratively solving the linear system for $U^{n+1}$ over $N$ time steps. We record the time series of the physical sea surface elevation at $x=0$, given by $\\operatorname{Re}\\{\\eta(t_n)\\}$.\n\nThis generated time series is then analyzed using harmonic analysis to estimate the amplitude and phase of the numerical wave. We use linear least squares to fit the time series $\\eta(t_n)$ to the model\n$$f(t_n) = C \\cos(\\omega_a t_n) + S \\sin(\\omega_a t_n),$$\nwhere the analysis frequency $\\omega_a$ is set to the theoretically derived discrete frequency $\\omega_d$. The coefficients $C$ and $S$ are determined by solving the normal equations $(M^\\top M) \\mathbf{p} = M^\\top \\mathbf{y}$, where $\\mathbf{y}$ is the vector of $\\eta(t_n)$ values, $\\mathbf{p}=[C, S]^\\top$, and $M$ is the design matrix with columns $\\cos(\\omega_d t_n)$ and $\\sin(\\omega_d t_n)$.\n\nFrom the fitted coefficients, we compute the amplitude $A_a = \\sqrt{C^2 + S^2}$ and the phase $\\phi_a = \\operatorname{atan2}(-S, C)$. The phase convention corresponds to a model of the form $A_a \\cos(\\omega_a t + \\phi_a)$. The set of four computed quantities—fitted amplitude $A_a$, fitted phase $\\phi_a$, fractional dispersion error $\\delta$, and per-step amplitude factor $|\\mu|$—provides a complete characterization of the numerical scheme's performance for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the dispersion properties of a semi-implicit scheme for\n    the linearized shallow-water equations.\n    \"\"\"\n    \n    test_cases = [\n        # (H, L, m, dt, theta, A0, g)\n        (50.0, 100000.0, 1, 30.0, 0.6, 1.0, 9.81),\n        (100.0, 200000.0, 1, 100.0, 0.5, 1.0, 9.81),\n        (10.0, 50000.0, 1, 300.0, 0.7, 0.5, 9.81),\n        (30.0, 150000.0, 2, 1.0, 0.55, 1.2, 9.81),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        H, L, m, dt, theta, A0, g = case\n\n        # 1. Calculate physical and numerical properties\n        k = 2.0 * np.pi * m / L\n        omega = np.sqrt(g * H) * np.abs(k)\n\n        # Theoretical per-step amplitude factor\n        omega_dt = omega * dt\n        numerator = np.sqrt(1.0 + (1.0 - theta)**2 * omega_dt**2)\n        denominator = np.sqrt(1.0 + theta**2 * omega_dt**2)\n        amp_factor = numerator / denominator\n\n        # Theoretical discrete angular frequency and dispersion error\n        arg_atan = omega_dt / (1.0 - theta * (1.0 - theta) * omega_dt**2)\n        omega_d = (1.0 / dt) * np.arctan(arg_atan)\n        dispersion_error = (omega_d - omega) / omega\n\n        # 2. Setup and run the numerical simulation\n        T = 10.0 * (2.0 * np.pi / omega)\n        N = int(np.floor(T / dt))\n        \n        # Construct system matrices\n        A = np.array([[0, -g * 1j * k],\n                      [-H * 1j * k, 0]], dtype=np.complex128)\n        \n        I = np.eye(2, dtype=np.complex128)\n        \n        LHS = I - theta * dt * A\n        RHS = I + (1.0 - theta) * dt * A\n        \n        # Time stepping\n        U = np.array([0.0, A0], dtype=np.complex128)\n        eta_timeseries = np.zeros(N, dtype=np.float64)\n        eta_timeseries[0] = np.real(U[1])\n\n        for n in range(N - 1):\n            b = RHS @ U\n            U = np.linalg.solve(LHS, b)\n            eta_timeseries[n + 1] = np.real(U[1])\n            \n        # 3. Perform harmonic analysis using least squares\n        t_n = np.arange(N) * dt\n        \n        # Design matrix for least squares fit\n        # Model: C*cos(omega_d*t) + S*sin(omega_d*t)\n        M = np.zeros((N, 2), dtype=np.float64)\n        M[:, 0] = np.cos(omega_d * t_n)\n        M[:, 1] = np.sin(omega_d * t_n)\n        \n        # Solve for coefficients [C, S]\n        p, _, _, _ = np.linalg.lstsq(M, eta_timeseries, rcond=None)\n        C, S = p[0], p[1]\n        \n        # Fitted amplitude and phase\n        # Phase convention: atan2(-S, C)\n        fitted_amplitude = np.sqrt(C**2 + S**2)\n        fitted_phase = np.arctan2(-S, C)\n\n        # 4. Collect results for the current case\n        results = [\n            fitted_amplitude,\n            fitted_phase,\n            dispersion_error,\n            amp_factor\n        ]\n        all_results.append(results)\n\n    # Format the output string as required\n    output_str = \"[\" + \",\".join([f\"[{a},{p},{d},{g}]\" for a, p, d, g in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}