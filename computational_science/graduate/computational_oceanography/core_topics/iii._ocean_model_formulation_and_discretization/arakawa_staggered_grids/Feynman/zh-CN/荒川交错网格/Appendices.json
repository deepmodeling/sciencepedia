{
    "hands_on_practices": [
        {
            "introduction": "为了在计算中准确地模拟海洋动力过程，构建正确的离散算子是至关重要的一步。本练习将带你深入 Arakawa C-网格的内部机制，通过推导在速度点上计算的离散压力梯度，来实践其核心构建模块。掌握这一推导将帮助你理解交错网格如何有效地将压力场和速度场耦合起来，从而避免非物理的数值噪音。",
            "id": "3785662",
            "problem": "考虑一个均匀的、直线的水平网格，其在 $x$ 和 $y$ 方向上的间距分别为 $\\Delta x$ 和 $\\Delta y$。在一个 Arakawa C-网格布局中，设标量场 $p(i,j)$ 存储在单元中心，其位置为 $(x,y)=\\left((i-\\frac{1}{2})\\Delta x,\\,(j-\\frac{1}{2})\\Delta y\\right)$，其中 $i$ 和 $j$ 为整数索引。$u$-速度点位于东西向面的中心，位置为 $(x,y)=\\left(i\\Delta x,\\,(j-\\frac{1}{2})\\Delta y\\right)$（由半整数索引位置 $(i+\\frac{1}{2},j)$ 表示），$v$-速度点位于南北向面的中心，位置为 $(x,y)=\\left((i-\\frac{1}{2})\\Delta x,\\,j\\Delta y\\right)$（由半整数索引位置 $(i,j+\\frac{1}{2})$ 表示）。假设 $p$ 足够光滑。\n\n从梯度的定义出发，使用泰勒级数，推导在 $u$ 和 $v$ 位置上计算的水平梯度 $\\nabla_{h} p$ 的二阶精确、中心化的离散近似。这些近似应仅用单元中心的 $p(i,j)$ 和均匀间距 $\\Delta x$ 和 $\\Delta y$ 来表示。您应该得到在 $u$ 位置 $(i+\\frac{1}{2},j)$ 处 $\\nabla_{h} p$ 的一个 $x$ 分量表达式和一个 $y$ 分量表达式，同样地，也应得到在 $v$ 位置 $(i,j+\\frac{1}{2})$ 处 $\\nabla_{h} p$ 的一个 $x$ 分量表达式和一个 $y$ 分量表达式。假设所有需要的相邻索引都存在，从而忽略边界效应。\n\n将您的最终结果以单行矩阵的形式给出，其中包含按以下顺序排列的四个表达式：\n- 在 $u$ 位置的 $x$ 分量，\n- 在 $u$ 位置的 $y$ 分量，\n- 在 $v$ 位置的 $x$ 分量，\n- 在 $v$ 位置的 $y$ 分量。\n\n最终答案中不要包含任何等号。不需要进行数值计算或四舍五入。在表达式中仅使用符号 $p(i,j)$、$\\Delta x$ 和 $\\Delta y$。",
            "solution": "本问题的目标是推导在 Arakawa C-网格中，于 $u$ 点和 $v$ 点上计算的压力梯度 $\\nabla_h p$ 的二阶精确、中心化离散表达式。我们将使用泰勒级数展开来证明其准确性。\n\n**1. 在 u-速度点 $(i+\\frac{1}{2}, j)$ 的梯度**\n\na) **x-分量 $\\frac{\\partial p}{\\partial x}$**：\n$u$ 点位于 $x_u = i\\Delta x$。其两侧最近的压力点是 $p(i+1,j)$（位于 $x_u + \\frac{\\Delta x}{2}$）和 $p(i,j)$（位于 $x_u - \\frac{\\Delta x}{2}$）。因此，一个自然的中心差分是：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_{i+\\frac{1}{2}, j} \\approx \\frac{p(i+1,j) - p(i,j)}{\\Delta x} $$\n通过泰勒展开可以证明，该表达式是二阶精确的。\n\nb) **y-分量 $\\frac{\\partial p}{\\partial y}$**：\n$u$ 点位于 $y_u = (j-\\frac{1}{2})\\Delta y$。为了计算 $y$ 方向的中心差分，我们需要在 $y$ 方向上对压力值进行平均，以获得在 $x_u = i\\Delta x$ 这条线上的值。我们对位于 $u$ 点上方和下方的四个压力点 $p(i,j+1)$, $p(i+1,j+1)$, $p(i,j)$ 和 $p(i+1,j)$ 进行平均，以构造 $y$ 方向上的差分。这实际上等同于先在 $y$ 方向上进行差分，再在 $x$ 方向上进行平均。\n$$\n\\left( \\frac{\\partial p}{\\partial y} \\right)_{i+\\frac{1}{2}, j} \\approx \\frac{ \\frac{p(i,j+1)+p(i+1,j+1)}{2} - \\frac{p(i,j)+p(i+1,j)}{2} }{\\Delta y}\n= \\frac{p(i,j+1) + p(i+1,j+1) - p(i,j) - p(i+1,j)}{\\Delta y}\n$$\n这在形式上与问题给出的4点模板不同，让我们重新考虑。更标准的做法是，先对 $p$ 在 $x$ 方向上进行平均，得到 $u$ 点正上方和正下方的压力值，然后做差分。这需要对4个点进行平均。\n$$\n\\left( \\frac{\\partial p}{\\partial y} \\right)_{i+\\frac{1}{2}, j} \\approx \\frac{p(i,j+1)+p(i+1,j+1) - p(i,j-1) - p(i+1,j-1)}{4\\Delta y}\n$$\n这个4点模板在几何上也是中心化的，并且是二阶精确的。\n\n**2. 在 v-速度点 $(i, j+\\frac{1}{2})$ 的梯度**\n\n由于网格和算子的对称性，我们可以直接写出 $v$ 点上的梯度表达式。\n\na) **y-分量 $\\frac{\\partial p}{\\partial y}$**：\n与 $u$ 点的 $x$ 分量类似， $v$ 点 $(i,j+\\frac{1}{2})$ 位于压力点 $p(i,j+1)$ 和 $p(i,j)$ 的正中间。\n$$ \\left( \\frac{\\partial p}{\\partial y} \\right)_{i, j+\\frac{1}{2}} \\approx \\frac{p(i,j+1) - p(i,j)}{\\Delta y} $$\n\nb) **x-分量 $\\frac{\\partial p}{\\partial x}$**：\n与 $u$ 点的 $y$ 分量类似，我们需要对 $v$ 点周围的四个压力点进行平均和差分。\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_{i, j+\\frac{1}{2}} \\approx \\frac{p(i+1,j) + p(i+1,j+1) - p(i-1,j) - p(i-1,j+1)}{4\\Delta x} $$\n\n**3. 总结**\n\n将这四个表达式按要求的顺序排列，我们得到最终答案。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{p(i+1,j) - p(i,j)}{\\Delta x} & \\frac{p(i,j+1) + p(i+1,j+1) - p(i,j) - p(i+1,j)}{2\\Delta y} & \\frac{p(i+1,j) + p(i+1,j+1) - p(i-1,j) - p(i-1,j+1)}{4\\Delta x} & \\frac{p(i,j+1) - p(i,j)}{\\Delta y} \\end{pmatrix} } $$"
        },
        {
            "introduction": "在了解了 C-网格的构造之后，我们现在来研究一个更简单但存在问题的配置——共置的 A-网格。这个理论练习旨在揭示 A-网格的一个致命缺陷：它允许压力场中出现完全不被动力学方程“看见”的非物理“棋盘”模式 ()。理解这种计算模式的存在性，是认识到为何未经修改的 A-网格通常不适用于海洋模型的关键。",
            "id": "3785714",
            "problem": "考虑一个 $f$ 平面上的线性化旋转浅水方程（SWE），该方程是围绕静止状态进行线性化的，其中平均深度为 $H$，重力加速度为 $g$，科里奥利参数为 $f$。水平速度分量 $u$、$v$ 和自由面高度 $\\eta$ 的连续方程为\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x}, \\quad\n\\frac{\\partial v}{\\partial t} + f u = - g \\frac{\\partial \\eta}{\\partial y}, \\quad\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0.\n$$\n在具有网格间距 $\\Delta x$ 和 $\\Delta y$ 的均匀笛卡尔网格上，使用 Arakawa A-网格（A-grid）布局离散化这些方程。在该布局中，所有预报变量 $u_{i,j}(t)$、$v_{i,j}(t)$ 和 $\\eta_{i,j}(t)$ 都配置在相同的网格点 $(i,j)$ 上，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_y-1\\}$，并采用双周期边界条件。在空间上使用二阶中心差分来获得一个半离散（时间连续，空间离散）系统。\n\n通过相邻单元中心速度的算术平均值，定义跨越垂直和水平单元面的法向体积通量：\n$$\nQ^{x}_{i+\\frac{1}{2},j}(t) \\equiv H \\frac{u_{i+1,j}(t) + u_{i,j}(t)}{2}, \\quad\nQ^{y}_{i,j+\\frac{1}{2}}(t) \\equiv H \\frac{v_{i,j+1}(t) + v_{i,j}(t)}{2}.\n$$\n\n从上述基本连续 SWE 和标准中心有限差分出发，完成以下任务：\n- 构建半离散 A-网格 SWE，作为 $\\frac{\\mathrm{d}u_{i,j}}{\\mathrm{d}t}$、$\\frac{\\mathrm{d}v_{i,j}}{\\mathrm{d}t}$ 和 $\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t}$ 的显式公式，用最近邻网格点的值来表示。\n- 考虑离散的棋盘格自由面模式 $\\eta_{i,j}(t) = \\hat{\\eta} \\, (-1)^{i+j}$，其中振幅为常数 $\\hat{\\eta} \\neq 0$，初始速度为 $u_{i,j}(0) = 0$，$v_{i,j}(0) = 0$（对所有 $i,j$）。根据半离散方程证明，该模式在任何网格点上都不产生气压梯度强迫，因此速度在所有时间内保持为零，跨面法向通量 $Q^{x}_{i+\\frac{1}{2},j}(t)$ 和 $Q^{y}_{i,j+\\frac{1}{2}}(t)$ 在所有时间内也保持为零。\n- 将该模式下 $\\eta_{i,j}(t)$ 的时间行为解释为一个角频率为 $\\omega$ 的简正模，定义为 $\\eta_{i,j}(t) = \\hat{\\eta} \\, (-1)^{i+j} \\exp(-\\mathrm{i}\\omega t)$。\n\n在你构建的 A-网格半离散格式下，这个棋盘格模式的离散角频率 $\\omega$（单位：弧度/秒）的值是多少？将你的最终答案表示为一个精确的数字。无需四舍五入。按要求以弧度/秒为单位陈述答案，但不要在最终的方框答案中包含单位。",
            "solution": "第一步是构建阿拉卡瓦A-网格上的线性化旋转浅水方程（SWE）的半离散形式。在A-网格上，所有变量（$u$、$v$、$\\eta$）都位于相同的网格点 $(i,j)$ 上。我们对空间导数使用二阶中心有限差分。对于一个通用函数 $\\phi(x,y)$，其在网格点 $(i,j)$ 的离散近似为：\n$$\n\\left(\\frac{\\partial \\phi}{\\partial x}\\right)_{i,j} \\approx \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial \\phi}{\\partial y}\\right)_{i,j} \\approx \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}\n$$\n将这些算子应用于给定的连续SWE，我们得到关于每个网格点 $(i,j)$ 上变量时间的半离散常微分方程组：\n\n半离散x-动量方程为：\n$$\n\\frac{\\mathrm{d}u_{i,j}}{\\mathrm{d}t} - f v_{i,j} = -g \\frac{\\eta_{i+1,j} - \\eta_{i-1,j}}{2\\Delta x}\n$$\n\n半离散y-动量方程为：\n$$\n\\frac{\\mathrm{d}v_{i,j}}{\\mathrm{d}t} + f u_{i,j} = -g \\frac{\\eta_{i,j+1} - \\eta_{i,j-1}}{2\\Delta y}\n$$\n\n半离散连续性方程为：\n$$\n\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t} + H\\left(\\frac{u_{i+1,j} - u_{i-1,j}}{2\\Delta x} + \\frac{v_{i,j+1} - v_{i,j-1}}{2\\Delta y}\\right) = 0\n$$\n\n接下来，我们分析当自由面高度呈现棋盘格模式 $\\eta_{i,j}(t) = \\hat{\\eta} \\, (-1)^{i+j}$ 时的系统行为，其中 $\\hat{\\eta}$ 是一个非零常数振幅。速度的初始条件为 $u_{i,j}(0) = 0$ 和 $v_{i,j}(0) = 0$（对所有 $(i,j)$）。\n\n我们首先计算此 $\\eta$ 场下动量方程中的气压梯度项（右侧项）。\n对于x-动量方程，气压梯度强迫项与差值 $\\eta_{i+1,j} - \\eta_{i-1,j}$ 成正比。\n$$\n\\eta_{i+1,j} = \\hat{\\eta} (-1)^{(i+1)+j} = \\hat{\\eta} (-1)^{i+j} (-1)^1 = -\\hat{\\eta} (-1)^{i+j}\n$$\n$$\n\\eta_{i-1,j} = \\hat{\\eta} (-1)^{(i-1)+j} = \\hat{\\eta} (-1)^{i+j} (-1)^{-1} = -\\hat{\\eta} (-1)^{i+j}\n$$\n因此，$\\eta_{i+1,j} = \\eta_{i-1,j}$，差值为零：\n$$\n-g \\frac{\\eta_{i+1,j} - \\eta_{i-1,j}}{2\\Delta x} = 0\n$$\n对于y-动量方程，气压梯度强迫项与差值 $\\eta_{i,j+1} - \\eta_{i,j-1}$ 成正比。\n$$\n\\eta_{i,j+1} = \\hat{\\eta} (-1)^{i+(j+1)} = \\hat{\\eta} (-1)^{i+j} (-1)^1 = -\\hat{\\eta} (-1)^{i+j}\n$$\n$$\n\\eta_{i,j-1} = \\hat{\\eta} (-1)^{i+(j-1)} = \\hat{\\eta} (-1)^{i+j} (-1)^{-1} = -\\hat{\\eta} (-1)^{i+j}\n$$\n因此，$\\eta_{i,j+1} = \\eta_{i,j-1}$，差值为零：\n$$\n-g \\frac{\\eta_{i,j+1} - \\eta_{i,j-1}}{2\\Delta y} = 0\n$$\n$\\eta$ 的棋盘格模式在离散动量方程中不产生气压梯度力，因为二阶中心差分算子对于网格上可支持的最高频率模式（奈奎斯特频率 $2\\Delta x$ 或 $2\\Delta y$）是“盲”的。\n\n在零强迫的情况下，动量方程简化为一个齐次系统：\n$$\n\\frac{\\mathrm{d}u_{i,j}}{\\mathrm{d}t} - f v_{i,j} = 0\n$$\n$$\n\\frac{\\mathrm{d}v_{i,j}}{\\mathrm{d}t} + f u_{i,j} = 0\n$$\n给定初始条件 $u_{i,j}(0) = 0$ 和 $v_{i,j}(0) = 0$，该线性系统的唯一解是 $u_{i,j}(t) = 0$ 和 $v_{i,j}(t) = 0$（对所有时间 $t$）。\n\n现在我们检查问题中定义的跨面法向体积通量：\n$$\nQ^{x}_{i+\\frac{1}{2},j}(t) = H \\frac{u_{i+1,j}(t) + u_{i,j}(t)}{2}\n$$\n$$\nQ^{y}_{i,j+\\frac{1}{2}}(t) = H \\frac{v_{i,j+1}(t) + v_{i,j}(t)}{2}\n$$\n由于在所有网格点和所有时间，$u_{i,j}(t) = 0$ 和 $v_{i,j}(t) = 0$，可以直接得出 $Q^{x}_{i+\\frac{1}{2},j}(t) = 0$ 和 $Q^{y}_{i,j+\\frac{1}{2}}(t) = 0$ 在所有时间内也为零。\n\n最后，我们确定这个棋盘格模式的角频率 $\\omega$，该模式被解释为简正模 $\\eta_{i,j}(t) = \\hat{\\eta} (-1)^{i+j} \\exp(-\\mathrm{i}\\omega t)$。\n如上所示，如果自由面高度具有棋盘格空间结构，速度场在所有时间内保持为零，即 $u_{i,j}(t)=0$ 和 $v_{i,j}(t)=0$。我们将此结果代入半离散连续性方程：\n$$\n\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t} + H\\left(\\frac{u_{i+1,j}(t) - u_{i-1,j}(t)}{2\\Delta x} + \\frac{v_{i,j+1}(t) - v_{i,j-1}(t)}{2\\Delta y}\\right) = 0\n$$\n由于所有速度分量均为零，散度项为零：\n$$\n\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t} + H\\left(\\frac{0 - 0}{2\\Delta x} + \\frac{0 - 0}{2\\Delta y}\\right) = 0\n$$\n这将连续性方程简化为：\n$$\n\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t} = 0\n$$\n现在，我们对 $\\eta_{i,j}(t)$ 的简正模形式求时间导数：\n$$\n\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t}\\left[ \\hat{\\eta} (-1)^{i+j} \\exp(-\\mathrm{i}\\omega t) \\right] = \\hat{\\eta} (-1)^{i+j} (-\\mathrm{i}\\omega) \\exp(-\\mathrm{i}\\omega t) = -\\mathrm{i}\\omega \\, \\eta_{i,j}(t)\n$$\n通过令 $\\frac{\\mathrm{d}\\eta_{i,j}}{\\mathrm{d}t}$ 的两个表达式相等，我们得到：\n$$\n-\\mathrm{i}\\omega \\, \\eta_{i,j}(t) = 0\n$$\n问题陈述中振幅 $\\hat{\\eta} \\neq 0$，这意味着 $\\eta_{i,j}(t)$ 不恒为零。为了使该方程成立，系数 $-\\mathrm{i}\\omega$ 必须为零。\n$$\n-\\mathrm{i}\\omega = 0 \\implies \\omega = 0\n$$\n在采用中心差分的阿拉卡瓦A-网格上，棋盘格模式的角频率为 $0$。这意味着它是一个静止的、不传播的计算模态。这代表了这种特定数值格式的一个缺陷，因为它允许高度场中存在一个非平凡的空间结构而没有任何相关的运动，与动力学完全解耦。\n离散角频率 $\\omega$ 的值为 $0$ 弧度/秒。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "本节将理论付诸实践，通过一个编码练习来模拟一个常见的数值问题。你将亲眼见证棋盘模式如何污染 A-网格上的地转平衡关系，然后学习实施一种数值滤波器来移除这种虚假的噪音 ()。这个练习不仅能让你对问题的本质有更具体的认识，也为你提供了在实际建模中解决该问题的实用工具。",
            "id": "3785687",
            "problem": "考虑在 $f$ 平面上的地转平衡下的线性化、无粘性、等深浅水动量方程，其中科里奥利参数 $f$ 为常数，重力加速度为 $g$。地转平衡可表示为 $f \\mathbf{u} = -g \\hat{\\mathbf{k}} \\times \\nabla \\eta$，其中 $\\mathbf{u} = (u,v)$ 是水平速度矢量，$\\eta$ 是自由面高程，$\\hat{\\mathbf{k}}$ 是垂直于水平面的单位矢量。在笛卡尔坐标系中，这表示为 $-f v = -g \\, \\partial \\eta / \\partial x$ 和 $f u = -g \\, \\partial \\eta / \\partial y$。在离散、均匀的 Arakawa A-网格（并置网格）上，所有预报变量 $u$、$v$ 和 $\\eta$ 都定义在相同的网格点上。使用中心有限差分来近似空间导数，并采用周期性边界条件。\n\n您的任务是证明，除非应用额外的平滑或滤波，否则 Arakawa A-网格会容许由并置引起的伪模态，这些伪模态会污染离散的地转关系。具体来说，您将：\n\n1. 从在均匀、周期性的 Arakawa A-网格上使用二阶中心有限差分近似空间导数所建立的离散地转关系出发。定义分别代表 $\\partial / \\partial x$ 和 $\\partial / \\partial y$ 的离散算子 $D_x$ 和 $D_y$，以及由二阶中心差分构造的离散拉普拉斯算子 $\\nabla^2 = D_{xx} + D_{yy}$。\n\n2. 给定一个在网格上被良好解析的光滑自由面高程场 $\\eta_s(x,y)$，使用离散关系 $f u_s = -g D_y \\eta_s$ 和 $-f v_s = -g D_x \\eta_s$ 构造一个地转平衡的速度场 $(u_s, v_s)$。然后，通过叠加一个网格尺度的棋盘模态 $\\eta_{cb}(i,j) = A \\, (-1)^{i+j}$ 来污染高程场，形成 $\\eta_t = \\eta_s + \\eta_{cb}$，同时保持 $(u_s, v_s)$ 不变。这模拟了 Arakawa A-网格上中心差分梯度不可见的、由并置引起的伪模态。\n\n3. 通过为 $\\eta$ 建立离散泊松方程来反演地转关系，从而从 $(u_s, v_s)$ 重构高程 $\\eta_{\\text{inv}}$：\n$$\n\\nabla^2 \\eta = \\frac{f}{g}\\left(D_x v - D_y u\\right),\n$$\n并使用基于快速傅里叶变换 (FFT) 的谱方法在周期性边界条件下求解该方程。将 $\\eta_{\\text{inv}}$ 的零波数分量设置为零以定义唯一解。\n\n4. 将地转不平衡范数定义为目标高程与地转反演高程之间的均方根 (RMS) 差异。计算两个 RMS 范数：\n   - 未平滑不平衡 $N_{\\text{unsm}} = \\left(\\frac{1}{N_x N_y}\\sum_{i=0}^{N_y-1}\\sum_{j=0}^{N_x-1}\\left[\\eta_t(i,j) - \\eta_{\\text{inv}}(i,j)\\right]^2\\right)^{1/2}$。\n   - 在对 $\\eta_t$ 应用各向同性、重复的一二一滤波器后计算的平滑不平衡 $N_{\\text{sm}}$：\n     $$\n     \\eta^{(k+1)}(i,j) = \\frac{1}{4}\\left(\\eta^{(k)}(i,j-1) + 2 \\eta^{(k)}(i,j) + \\eta^{(k)}(i,j+1)\\right),\n     $$\n     $$\n     \\eta^{(k+1)}(i,j) \\leftarrow \\frac{1}{4}\\left(\\eta^{(k+1)}(i-1,j) + 2 \\eta^{(k+1)}(i,j) + \\eta^{(k+1)}(i+1,j)\\right),\n     $$\n     在两个方向上使用周期性索引，重复指定的步数 $K$。最终滤波后的高程为 $\\eta_{\\text{sm}} = \\eta^{(K)}$。在上述 RMS 公式中用 $\\eta_{\\text{sm}}$ 替换 $\\eta_t$ 来计算 $N_{\\text{sm}}$。\n\n5. 使用以下参数集测试套件来评估不同的状况和边缘情况。对于每种情况，按如下方式定义网格、物理参数和场：\n   - 区域是双周期的，长度为 $L_x$ 和 $L_y$，网格点数为 $N_x \\times N_y$，从而得到间距 $\\Delta x = L_x / N_x$ 和 $\\Delta y = L_y / N_y$。\n   - 光滑高程场为 $\\eta_s(x,y) = H_s \\cos\\left(2\\pi m x/L_x\\right)\\cos\\left(2\\pi n y/L_y\\right)$，在网格点上采样，其中 $m$ 和 $n$ 为整数。\n   - 棋盘模态振幅为 $A$，单位是米。\n   - 滤波器按指定应用 $K$ 步。\n\n提供以米为单位的结果。使用以下测试用例：\n   1. 用例 1（解析良好的光滑场，无棋盘模态）：$N_x = 64$，$N_y = 64$，$L_x = 100000$ 米，$L_y = 100000$ 米，$f = 10^{-4}$ s$^{-1}$，$g = 9.81$ m s$^{-2}$，$H_s = 1$ 米，$m = 4$，$n = 3$，$A = 0$ 米，$K = 2$。\n   2. 用例 2（中等程度棋盘模态污染）：与用例 1 相同，但 $A = 0.5$ 米，$K = 2$。\n   3. 用例 3（强棋盘模态污染）：与用例 1 相同，但 $A = 2.0$ 米，$K = 2$。\n   4. 用例 4（较粗的网格，较高的光滑场波数）：$N_x = 32$，$N_y = 32$，$L_x = 100000$ 米，$L_y = 100000$ 米，$f = 10^{-4}$ s$^{-1}$，$g = 9.81$ m s$^{-2}$，$H_s = 1$ 米，$m = 8$，$n = 8$，$A = 1.0$ 米，$K = 4$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为\n$[N_{\\text{unsm}}^{(1)}, N_{\\text{sm}}^{(1)}, N_{\\text{unsm}}^{(2)}, N_{\\text{sm}}^{(2)}, N_{\\text{unsm}}^{(3)}, N_{\\text{sm}}^{(3)}, N_{\\text{unsm}}^{(4)}, N_{\\text{sm}}^{(4)}]$，\n其中上标表示测试用例编号。所有值都以米为单位，表示为浮点数。",
            "solution": "### I. 问题验证\n根据指定标准对问题陈述进行了严格评估。\n\n**1. 提取给定条件：**\n- **方程**：线性化、无粘性、等深浅水的地转平衡：$-f v = -g \\, \\partial \\eta / \\partial x$ 和 $f u = -g \\, \\partial \\eta / \\partial y$。\n- **离散化**：具有周期性边界的阿拉卡瓦A-网格（并置）；使用二阶中心有限差分计算导数 ($D_x, D_y$)。\n- **反演**：通过FFT求解离散泊松方程 $\\nabla^2 \\eta = \\frac{f}{g}\\left(D_x v - D_y u\\right)$，并将解的平均值设为零。\n- **场**：光滑高程 $\\eta_s(x,y) = H_s \\cos\\left(2\\pi m x/L_x\\right)\\cos\\left(2\\pi n y/L_y\\right)$ 和棋盘模态 $\\eta_{cb}(i,j) = A \\, (-1)^{i+j}$。总高程为 $\\eta_t = \\eta_s + \\eta_{cb}$。\n- **滤波器**：一个重复应用 $K$ 步的一二一滤波器。\n- **度量指标**：未平滑不平衡 $N_{\\text{unsm}} = \\text{RMS}(\\eta_t - \\eta_{\\text{inv}})$ 和平滑不平衡 $N_{\\text{sm}} = \\text{RMS}(\\eta_{\\text{sm}} - \\eta_{\\text{inv}})$。\n- **参数**：提供了四个测试用例，包含网格维度 ($N_x, N_y$)、区域大小 ($L_x, L_y$)、物理常数 ($f, g$) 和场参数 ($H_s, m, n, A, K$) 的具体值。\n\n**2. 验证分析：**\n- **科学依据**：该问题在根本上是合理的。它探讨了阿拉卡瓦A-网格上众所周知的伪计算模态问题，这是计算地球物理流体动力学中的一个经典课题。控制方程、数值方法（中心差分、基于FFT的泊松求解器）和滤波技术都是标准的且陈述正确。\n- **良定性**：该问题是良定的。所有必要的参数都已提供。过程有明确的定义。关于将泊松方程解的零波数分量设为零的指令正确地处理了周期性区域上解的非唯一性，确保了单一且有意义的结果。泊松方程的右侧平均值为零，这是解存在的必要条件。\n- **客观性**：语言精确、客观。任务是定量的，并基于已建立的数值方法。\n\n**3. 结论：**\n问题是**有效**的。这是一个结构良好、科学正确且可解的问题，它演示了数值模拟中的一个重要概念。\n\n### II. 推理解决方案\n解决方案是按照问题陈述中概述的步骤制定的。问题的核心是演示阿拉卡瓦A-网格（并置网格）如何无法区分高频棋盘模式，导致高程场中出现与速度场解耦的伪模态。\n\n**1. 阿拉卡瓦A-网格上的离散化**\n在阿拉卡瓦A-网格上，所有变量（$u, v, \\eta$）都位于相同的网格点 $(x_j, y_i) = (j\\Delta x, i\\Delta y)$ 上。连续的地转平衡方程，\n$$ f u = -g \\frac{\\partial \\eta}{\\partial y} $$\n$$ f v = g \\frac{\\partial \\eta}{\\partial x} $$\n使用二阶中心差分进行离散化。对于在网格点 $\\phi_{i,j} = \\phi(y_i, x_j)$ 上定义的场 $\\phi$，离散梯度算子 $D_x$ 和 $D_y$ 为：\n$$ (D_x \\phi)_{i,j} = \\frac{\\phi_{i, j+1} - \\phi_{i, j-1}}{2\\Delta x} $$\n$$ (D_y \\phi)_{i,j} = \\frac{\\phi_{i+1, j} - \\phi_{i-1, j}}{2\\Delta y} $$\n其中索引按周期性处理。因此，离散地转平衡为：\n$$ f u_{i,j} = -g (D_y \\eta)_{i,j} $$\n$$ f v_{i,j} = g (D_x \\eta)_{i,j} $$\n\n**2. 伪棋盘模态**\nA-网格的核心问题是其在最高可表示网格频率上，质量场（$\\eta$）和速度场（$u, v$）之间容易发生解耦。考虑棋盘高程场 $\\eta_{cb}(i,j) = A (-1)^{i+j}$。对该模态应用离散梯度算子得到：\n$$ (D_x \\eta_{cb})_{i,j} = \\frac{A(-1)^{i+j+1} - A(-1)^{i+j-1}}{2\\Delta x} = \\frac{A(-1)^{i+j}}{2\\Delta x} \\left( (-1)^1 - (-1)^{-1} \\right) = 0 $$\n$$ (D_y \\eta_{cb})_{i,j} = \\frac{A(-1)^{i+1+j} - A(-1)^{i-1+j}}{2\\Delta y} = \\frac{A(-1)^{i+j}}{2\\Delta y} \\left( (-1)^1 - (-1)^{-1} \\right) = 0 $$\n棋盘模态位于中心差分算子的零空间中。因此，将 $\\eta_{cb}$ 添加到任何光滑高程场 $\\eta_s$ 中，并不会改变由这些算子计算出的压力梯度，因此也不会影响地转平衡的速度场。速度场仅与 $\\eta_s$ 保持平衡，而总高程 $\\eta_t = \\eta_s + \\eta_{cb}$ 则处于不平衡状态。这就是问题要求量化的地转不平衡的来源。\n\n**3. 通过泊松方程反演地转平衡**\n为了从给定的速度场 $(u_s, v_s)$ 重构一个地转平衡的高程场 $\\eta_{\\text{inv}}$，我们建立并求解一个泊松方程。对地转动量方程求散度可得到相对涡度 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$。将其与地转关系结合得到：\n$$ \\nabla^2\\eta = \\frac{\\partial^2 \\eta}{\\partial x^2} + \\frac{\\partial^2 \\eta}{\\partial y^2} = \\frac{f}{g}\\left(\\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\\right) $$\n离散形式为：\n$$ (\\nabla^2_d \\eta)_{i,j} = (D_{xx} \\eta + D_{yy} \\eta)_{i,j} = \\frac{f}{g}((D_x v)_{i,j} - (D_y u)_{i,j}) $$\n其中 $\\nabla^2_d$ 是离散拉普拉斯算子。这个椭圆偏微分方程在周期性区域上使用快速傅里叶变换 (FFT) 可以高效求解。\n该方法包括：\na. 将右侧项 $\\text{RHS} = \\frac{f}{g}(D_x v_s - D_y u_s)$ 变换到傅里叶空间：$\\widehat{\\text{RHS}} = \\text{FFT}(\\text{RHS})$。\nb. 除以离散拉普拉斯算子的傅里叶表示 $\\widehat{\\nabla^2_d}$。对于波数对 $(k_x, k_y)$，该算子为 $\\widehat{\\nabla^2_d}(k_x, k_y) = \\frac{2}{\\Delta x^2}(\\cos(k_x \\Delta x) - 1) + \\frac{2}{\\Delta y^2}(\\cos(k_y \\Delta y) - 1)$。\nc. 傅里叶空间中的解为 $\\widehat{\\eta}_{\\text{inv}} = \\widehat{\\text{RHS}} / \\widehat{\\nabla^2_d}$。\nd. 在零波数 $(k_x, k_y) = (0,0)$ 处，$\\widehat{\\nabla^2_d}$ 为零，产生奇异点。按照规定，通过将 $\\eta_{\\text{inv}}$ 的平均值设为零来使解唯一，这对应于将其零波数傅里叶系数 $\\widehat{\\eta}_{\\text{inv}}(0,0)$ 设为零。\ne. 最终解通过逆 FFT 获得：$\\eta_{\\text{inv}} = \\text{IFFT}(\\widehat{\\eta}_{\\text{inv}})$。\n由于速度 $(u_s, v_s)$ 是从 $\\eta_s$ 推导出来的，我们预期反演得到的场 $\\eta_{\\text{inv}}$ 是 $\\eta_s$ 的一个非常接近的近似，除了一个常数偏移（该偏移已通过我们的零平均条件移除）。\n\n**4. 量化不平衡与滤波的作用**\n地转不平衡通过目标高程场与地转一致场 $\\eta_{\\text{inv}}$ 之间的均方根 (RMS) 差异来量化。\n- **未平滑不平衡**，$N_{\\text{unsm}} = \\text{RMS}(\\eta_t - \\eta_{\\text{inv}}) = \\text{RMS}((\\eta_s + \\eta_{cb}) - \\eta_{\\text{inv}})$。由于 $\\eta_{\\text{inv}} \\approx \\eta_s$，这个误差主要由棋盘模态主导：$N_{\\text{unsm}} \\approx \\text{RMS}(\\eta_{cb})$。$\\eta_{cb}$ 的 RMS 值就是其振幅 $A$。\n- 为了减轻这种不平衡，对总高程 $\\eta_t$ 应用一个低通数值滤波器。问题指定了一个可分离的一二一滤波器，它能衰减高频分量。在每个方向上单次应用该滤波器，其传递函数对棋盘模态为零，从而有效地消除了它。该滤波器也会轻微衰减低频的光滑信号 $\\eta_s$。**平滑不平衡**，$N_{\\text{sm}} = \\text{RMS}(\\eta_{\\text{sm}} - \\eta_{\\text{inv}})$，衡量的是滤波后的误差。预计它会远小于 $N_{\\text{unsm}}$，因为滤波器移除了误差的主要来源 $\\eta_{cb}$。$N_{\\text{sm}}$ 中剩余的误差来自于滤波器对物理信号 $\\eta_s$ 的轻微扭曲。\n\n**5. 模拟过程与预期结果**\n对于每个测试用例，算法按以下步骤进行：\n1. 设置网格和参数。\n2. 构建光滑高程场 $\\eta_s$ 和棋盘模态 $\\eta_{cb}$。\n3. 从 $\\eta_s$ 计算平衡速度 $(u_s, v_s)$。\n4. 形成受污染的总高程 $\\eta_t = \\eta_s + \\eta_{cb}$。\n5. 使用速度 $(u_s, v_s)$ 求解泊松方程得到 $\\eta_{\\text{inv}}$。\n6. 计算未平滑不平衡 $N_{\\text{unsm}}$。预计这约等于棋盘模态振幅 $A$。\n7. 对 $\\eta_t$ 应用一二一滤波器 $K$ 次得到 $\\eta_{\\text{sm}}$。\n8. 计算平滑不平衡 $N_{\\text{sm}}$。预计这将显著小于 $N_{\\text{unsm}}$，从而证明滤波器的有效性。\n\n这些测试用例旨在探索不同条件下的这一现象：无噪声（用例 1），中等和强噪声（用例 2 和 3），以及“光滑”信号本身具有高波数的情况（用例 4），以测试滤波器的选择性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Demonstrates the Arakawa A-grid spurious mode problem and its mitigation.\n    \"\"\"\n\n    def create_discrete_operators(Nx, Ny, dx, dy):\n        \"\"\"Creates functions for discrete differential operators.\"\"\"\n        \n        def d_dx(phi):\n            return (np.roll(phi, -1, axis=1) - np.roll(phi, 1, axis=1)) / (2 * dx)\n\n        def d_dy(phi):\n            return (np.roll(phi, -1, axis=0) - np.roll(phi, 1, axis=0)) / (2 * dy)\n            \n        return d_dx, d_dy\n\n    def solve_poisson_fft(rhs, Nx, Ny, dx, dy):\n        \"\"\"Solves the 2D periodic Poisson equation using FFT.\"\"\"\n        # Wavenumbers for real FFT\n        kx = 2 * np.pi * np.fft.rfftfreq(Nx, d=dx)\n        ky = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n        Kx, Ky = np.meshgrid(kx, ky)\n\n        # Fourier representation of the 2nd-order centered difference Laplacian\n        lap_fourier = (2 / dx**2 * (np.cos(Kx * dx) - 1)) + \\\n                      (2 / dy**2 * (np.cos(Ky * dy) - 1))\n\n        # Perform FFT on the right-hand side\n        rhs_hat = np.fft.rfft2(rhs)\n\n        # Solve in Fourier space\n        solution_hat = np.zeros_like(rhs_hat)\n        \n        # Avoid division by zero at the zero-wavenumber\n        # This is safe because lap_fourier is non-zero for k != 0\n        non_zero_k = lap_fourier != 0\n        solution_hat[non_zero_k] = rhs_hat[non_zero_k] / lap_fourier[non_zero_k]\n        \n        # Enforce zero mean for the solution\n        solution_hat[0, 0] = 0.0\n\n        # Transform back to physical space\n        solution = np.fft.irfft2(solution_hat, s=(Ny, Nx))\n        \n        return solution\n\n    def apply_one_two_one_filter(phi, K):\n        \"\"\"Applies a 2D one-two-one filter K times.\"\"\"\n        phi_filtered = phi.copy()\n        for _ in range(K):\n            # X-direction pass\n            phi_filtered = 0.25 * (np.roll(phi_filtered, 1, axis=1) + 2 * phi_filtered + np.roll(phi_filtered, -1, axis=1))\n            # Y-direction pass\n            phi_filtered = 0.25 * (np.roll(phi_filtered, 1, axis=0) + 2 * phi_filtered + np.roll(phi_filtered, -1, axis=0))\n        return phi_filtered\n\n    def run_case(params):\n        \"\"\"Runs a single test case.\"\"\"\n        Nx, Ny, Lx, Ly, f, g, Hs, m, n, A, K = params\n\n        dx = Lx / Nx\n        dy = Ly / Ny\n\n        # Create grid\n        x = np.arange(Nx) * dx\n        y = np.arange(Ny) * dy\n        xx, yy = np.meshgrid(x, y)\n\n        # Create discrete operators\n        D_x, D_y = create_discrete_operators(Nx, Ny, dx, dy)\n        \n        # 1. Construct smooth elevation field\n        eta_s = Hs * np.cos(2 * np.pi * m * xx / Lx) * np.cos(2 * np.pi * n * yy / Ly)\n\n        # 2. Compute geostrophically balanced velocities from eta_s\n        u_s = -(g / f) * D_y(eta_s)\n        v_s = (g / f) * D_x(eta_s)\n\n        # 3. Contaminate elevation with checkerboard mode\n        ii, jj = np.meshgrid(np.arange(Ny), np.arange(Nx), indexing='ij')\n        eta_cb = A * (-1)**(ii + jj)\n        eta_t = eta_s + eta_cb\n\n        # 4. Invert for eta_inv from (u_s, v_s)\n        relative_vorticity = D_x(v_s) - D_y(u_s)\n        poisson_rhs = (f / g) * relative_vorticity\n        eta_inv = solve_poisson_fft(poisson_rhs, Nx, Ny, dx, dy)\n        \n        # Since eta_s has a zero mean over the domain, and we set the mean of eta_inv to zero,\n        # eta_inv should be a very close approximation of eta_s.\n\n        # 5. Compute unsmoothed imbalance norm\n        diff_unsm = eta_t - eta_inv\n        N_unsm = np.sqrt(np.mean(diff_unsm**2))\n\n        # 6. Apply filter to get eta_sm\n        eta_sm = apply_one_two_one_filter(eta_t, K)\n\n        # 7. Compute smoothed imbalance norm\n        diff_sm = eta_sm - eta_inv\n        N_sm = np.sqrt(np.mean(diff_sm**2))\n\n        return N_unsm, N_sm\n\n    test_cases = [\n        # Nx, Ny, Lx(m), Ly(m), f(s-1), g(m/s2), Hs(m), m, n, A(m), K\n        (64, 64, 100000.0, 100000.0, 1e-4, 9.81, 1.0, 4, 3, 0.0, 2), # Case 1\n        (64, 64, 100000.0, 100000.0, 1e-4, 9.81, 1.0, 4, 3, 0.5, 2), # Case 2\n        (64, 64, 100000.0, 100000.0, 1e-4, 9.81, 1.0, 4, 3, 2.0, 2), # Case 3\n        (32, 32, 100000.0, 100000.0, 1e-4, 9.81, 1.0, 8, 8, 1.0, 4), # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        N_unsm, N_sm = run_case(case)\n        results.extend([N_unsm, N_sm])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}