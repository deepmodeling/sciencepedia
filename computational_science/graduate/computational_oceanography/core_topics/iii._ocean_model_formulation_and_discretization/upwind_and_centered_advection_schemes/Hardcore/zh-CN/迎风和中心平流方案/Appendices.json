{
    "hands_on_practices": [
        {
            "introduction": "数值格式在求解时很少能完全精确地对应其设计的偏微分方程。修正方程分析能够揭示其求解的“有效”方程，包括那些形式上类似于物理过程的误差项。本练习  将引导您推导一阶迎风格式中固有的数值耗散，这是理解和量化其耗散特性的关键一步。",
            "id": "3818146",
            "problem": "考虑一个由均匀流平流的一维海岸示踪剂锋面。示踪剂浓度 $C(x,t)$ 服从线性平流方程 $C_{t} + u\\,C_{x} = 0$，其中 $u>0$ 是一个恒定的速度。在 $t=0$ 时，一个陡峭的锋面被初始化为跨越单个网格界面的间断：当 $x \\le 0$ 时，$C(x,0) = C_{L}$；当 $x > 0$ 时，$C(x,0) = C_{R}$，其中 $C_{L} \\neq C_{R}$。该数值模型对平流项使用一阶迎风（空间后向）离散格式，并在间距为 $\\Delta x$ 的均匀网格上采用前向欧拉时间步进。时间步长 $\\Delta t$ 的选择使得库朗-弗里德里希斯-列维（CFL）数 $C = u\\,\\Delta t/\\Delta x$ 处于稳定范围 $0  C \\leq 1$ 内。水平物理扩散率为 $\\kappa>0$，如果存在，它将在一个由扩散决定的时间尺度上使锋面变得模糊。\n\n从连续平流定律和给定的离散格式出发，进行主阶修正方程分析，以确定由一阶迎风格式引起的有效数值扩散系数 $\\nu_{\\mathrm{num}}$。使用扩散性锋面模糊时间尺度 $T \\sim L^{2}/\\nu$，其中 $L$ 取为网格尺度 $L=\\Delta x$，计算数值模糊时间尺度 $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$ 和物理模糊时间尺度 $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$。最后，对于参数 $u = 0.5\\,\\mathrm{m\\,s}^{-1}$、$\\Delta x = 500\\,\\mathrm{m}$、$C = 0.8$ 和 $\\kappa = 100\\,\\mathrm{m^{2}\\,s}^{-1}$，计算比率 $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$。\n\n将您的最终答案 $R$ 四舍五入到四位有效数字。因为 $R$ 是无量纲的，最终答案不应报告单位。",
            "solution": "用户提供了一个有效的问题陈述。\n\n### 步骤1：问题验证\n#### 步骤1.1：提取已知条件\n- **控制方程**：示踪剂浓度 $C(x,t)$ 服从线性平流方程 $C_{t} + u\\,C_{x} = 0$。\n- **速度**：$u>0$ 是一个恒定的速度。\n- **初始条件**：一个陡峭的锋面由 $C(x,0) = C_{L}$（对于 $x \\le 0$）和 $C(x,0) = C_{R}$（对于 $x>0$）给出，其中 $C_{L} \\neq C_{R}$。\n- **数值格式**：\n    - 时间步进：前向欧拉法。\n    - 空间离散：一阶迎风（由于 $u>0$，为空间后向）。\n- **网格和时间步长**：网格是均匀的，间距为 $\\Delta x$。时间步长为 $\\Delta t$。\n- **CFL数**：库朗-弗里德里希斯-列维（CFL）数为 $C = u\\,\\Delta t/\\Delta x$，且其处于稳定范围 $0  C \\leq 1$。\n- **物理扩散率**：水平物理扩散率为 $\\kappa>0$。\n- **任务1**：进行主阶修正方程分析，求出有效数值扩散系数 $\\nu_{\\mathrm{num}}$。\n- **任务2**：定义数值模糊时间尺度为 $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$，物理模糊时间尺度为 $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$。\n- **任务3**：计算比率 $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$。\n- **计算参数**：$u = 0.5\\,\\mathrm{m\\,s}^{-1}$，$\\Delta x = 500\\,\\mathrm{m}$，$C = 0.8$，以及 $\\kappa = 100\\,\\mathrm{m^{2}\\,s}^{-1}$。\n- **最终答案格式**：将 $R$ 的值四舍五入到四位有效数字。\n\n#### 步骤1.2：使用提取的已知条件进行验证\n该问题在科学上是合理的、适定的和客观的。它基于计算流体动力学的基本原理，特别是对平流方程数值格式的分析。所要求的方法，即修正方程分析，是量化有限差分格式截断误差的一种标准工具，将其表示为一个等效的微分方程。所有参数和定义都已提供，使得问题是自洽的，并且可以求解得到唯一答案。所提供的物理参数在海岸海洋学背景下是现实的。\n\n#### 步骤1.3：结论与行动\n问题有效。将提供完整的解决方案。\n\n### 步骤2：求解推导\n问题要求我们求出数值模糊时间尺度与物理模糊时间尺度之比。这始于通过修正方程分析来确定指定数值格式的数值扩散系数。\n\n控制的连续方程是一维线性平流方程：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = 0\n$$\n其中 $u > 0$ 是一个恒定的速度。\n\n数值格式对时间导数使用前向欧拉法，对空间导数使用一阶迎风格式。对于 $u > 0$，迎风方向是空间后向。令 $C_j^n$ 表示在网格点 $x_j = j\\Delta x$ 和时间 $t_n = n\\Delta t$ 处对 $C(x_j, t_n)$ 的数值近似。离散化方程为：\n$$\n\\frac{C_j^{n+1} - C_j^n}{\\Delta t} + u \\frac{C_j^n - C_{j-1}^n}{\\Delta x} = 0\n$$\n\n为了进行修正方程分析，我们围绕点 $(x_j, t_n)$ 对 $C_j^{n+1}$ 和 $C_{j-1}^n$ 使用泰勒级数展开。以下所有导数都在该点求值。\n$$\nC_j^{n+1} = C(x_j, t_n + \\Delta t) = C + \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2!} \\frac{\\partial^2 C}{\\partial t^2} + O((\\Delta t)^3)\n$$\n$$\nC_{j-1}^n = C(x_j - \\Delta x, t_n) = C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 C}{\\partial x^2} - \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 C}{\\partial x^3} + O((\\Delta x)^4)\n$$\n\n将这些展开式代入离散方程中：\n$$\n\\frac{1}{\\Delta t} \\left( \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + \\frac{u}{\\Delta x} \\left( C - \\left( C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\dots \\right) \\right) = 0\n$$\n简化此表达式得到：\n$$\n\\left( \\frac{\\partial C}{\\partial t} + \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + u \\left( \\frac{\\partial C}{\\partial x} - \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} + \\dots \\right) = 0\n$$\n整理各项，我们得到数值格式所求解的方程的表达式，即原始偏微分方程和截断误差项之和：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n为了找到主阶修正方程，我们需要将时间导数 $\\frac{\\partial^2 C}{\\partial t^2}$ 表示为空间导数的函数。我们可以通过对最低阶方程，即原始偏微分方程 $\\frac{\\partial C}{\\partial t} = -u \\frac{\\partial C}{\\partial x}$，进行重复微分来实现。\n对 $t$ 求导：\n$$\n\\frac{\\partial^2 C}{\\partial t^2} = \\frac{\\partial}{\\partial t} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = -u \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial C}{\\partial t} \\right) = -u \\frac{\\partial}{\\partial x} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = u^2 \\frac{\\partial^2 C}{\\partial x^2}\n$$\n将此代回截断误差的方程中：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 C}{\\partial x^2} \\right) + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n提取公因子：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n括号中的项是CFL数，$C = u \\Delta t / \\Delta x$。主阶修正方程是一个平流-扩散方程：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\nu_{\\mathrm{num}} \\frac{\\partial^2 C}{\\partial x^2}\n$$\n通过比较，有效数值扩散系数被确定为：\n$$\n\\nu_{\\mathrm{num}} = \\frac{u \\Delta x}{2} (1 - C)\n$$\n这是问题第一部分的答案。\n\n接下来，我们被要求求出数值模糊时间尺度 $T_{\\mathrm{num}}$ 与物理模糊时间尺度 $T_{\\mathrm{phys}}$ 之比 $R$。它们的定义为：\n$$\nT_{\\mathrm{num}} = \\frac{\\Delta x^2}{\\nu_{\\mathrm{num}}} \\quad \\text{和} \\quad T_{\\mathrm{phys}} = \\frac{\\Delta x^2}{\\kappa}\n$$\n因此，比率 $R$ 是：\n$$\nR = \\frac{T_{\\mathrm{num}}}{T_{\\mathrm{phys}}} = \\frac{\\Delta x^2 / \\nu_{\\mathrm{num}}}{\\Delta x^2 / \\kappa} = \\frac{\\kappa}{\\nu_{\\mathrm{num}}}\n$$\n代入 $\\nu_{\\mathrm{num}}$ 的表达式：\n$$\nR = \\frac{\\kappa}{\\frac{u \\Delta x}{2} (1 - C)} = \\frac{2\\kappa}{u \\Delta x (1 - C)}\n$$\n现在，我们将给定的数值代入此 $R$ 的表达式中：\n- $u = 0.5\\,\\mathrm{m\\,s}^{-1}$\n- $\\Delta x = 500\\,\\mathrm{m}$\n- $C = 0.8$\n- $\\kappa = 100\\,\\mathrm{m^{2}\\,s}^{-1}$\n\n计算过程如下：\n$$\nR = \\frac{2 \\times 100}{(0.5) \\times 500 \\times (1 - 0.8)}\n$$\n$$\nR = \\frac{200}{250 \\times 0.2}\n$$\n$$\nR = \\frac{200}{50}\n$$\n$$\nR = 4\n$$\n问题要求答案四舍五入到四位有效数字。像 $4$ 这样的整数有一位有效数字。为了将此值表示为四位有效数字，我们将其写为 $4.000$。",
            "answer": "$$\\boxed{4.000}$$"
        },
        {
            "introduction": "理论分析必须与实际编程相结合，才能完全掌握数值格式的行为特性。在这个动手编程练习  中，您将在一个具有挑战性的间断剖面上实现并比较迎风格式和中心格式。通过量化振荡的产生和总变差的变化，您将直接观察到数值扩散和数值频散之间的权衡。",
            "id": "3818209",
            "problem": "考虑一个周期性域中的一维被动标量线性平流问题，该问题由偏微分方程 $\\,\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\\,$ 控制，其中 $\\,c(x,t)\\,$ 是标量浓度，$\\,u\\,$ 是恒定的平流速度。任务是从第一性原理出发，检验在间断初始条件下，中心空间显式格式与单边迎风格式的行为，并量化单个时间步长内离散总变差的变化。Courant–Friedrichs–Lewy (CFL) 数 $\\,\\mathsf{C}\\,$ 将用于参数化时间步长，且必须视为无量纲量。\n\n您必须在一个周期性域 $\\,x \\in [0,L)\\,$ 的均匀网格上实现这两种离散化方法，该网格有 $\\,N\\,$ 个网格点，间距为 $\\,\\Delta x = L/N\\,$，单个时间步长 $\\,\\Delta t\\,$ 的选择应匹配指定的 CFL 数 $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$。使用正平流速度 $\\,u>0\\,$。对每种情况，都应用周期性边界条件。\n\n定义网格函数 $\\,\\{c_i^n\\}_{i=0}^{N-1}\\,$ 在时间层 $\\,n\\,$ 的离散总变差为\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\n由于周期性，约定 $\\,c_{N}^n \\equiv c_0^n\\,$。对于单个显式时间步 $\\,n \\to n+1\\,$，计算每种离散格式的 $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$。\n\n使用具有两个平台值 $\\,c_L\\,$ 和 $\\,c_R\\,$ 的离散阶跃函数初始条件，使得当 $i  i_0$ 时 $c_i^0 = c_L$，当 $\\,i \\ge i_0\\,$ 时 $\\,c_i^0 = c_R\\,$，其中 $\\,i_0\\,$ 是右侧平台上的第一个网格点的索引。跳跃幅度为 $\\,\\Delta c = c_R - c_L\\,$。在整个问题中，取 $\\,c_L = 0\\,$ 和 $\\,c_R = 1\\,$（无量纲）。域长度必须为 $\\,L = 100000\\,$ 米，网格点数必须为 $\\,N = 128\\,$，平流速度必须为 $\\,u = 0.5\\,$ 米/秒。使用 CFL 数 $\\,\\mathsf{C}\\,$ 计算时间步长，单位为秒，公式为 $\\,\\Delta t = \\mathsf{C}\\,\\Delta x / u\\,$。\n\n振荡将通过超出初始边界的幅度来诊断。定义一步之后的振荡幅度为\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right),\n$$\n这是一个非负实数（无量纲）。\n\n为 $\\,u>0\\,$ 实现典型的中心空间显式格式和典型的的一阶迎风格式。对每个格式应用恰好一个时间步，并计算两种格式的 $\\,\\Delta \\mathrm{TV}\\,$ 以及中心格式的 $\\,\\mathcal{O}\\,$。\n\n您的程序必须评估以下由每种情况的 $\\,(\\mathsf{C}, i_0)\\,$ 对指定的测试套件：\n\n- 情况 $\\,1\\,$：$\\,\\mathsf{C} = 0.0\\,$, $\\,i_0 = 64\\,$.\n- 情况 $\\,2\\,$：$\\,\\mathsf{C} = 0.2\\,$, $\\,i_0 = 64\\,$.\n- 情况 $\\,3\\,$：$\\,\\mathsf{C} = 0.5\\,$, $\\,i_0 = 64\\,$.\n- 情况 $\\,4\\,$：$\\,\\mathsf{C} = 0.9\\,$, $\\,i_0 = 64\\,$.\n- 情况 $\\,5\\,$：$\\,\\mathsf{C} = 0.7\\,$, $\\,i_0 = 0\\,$.\n\n对于每种情况，生成一个包含三个浮点数的列表 $\\,\\left[\\Delta \\mathrm{TV}_{\\text{centered}},\\,\\Delta \\mathrm{TV}_{\\text{upwind}},\\,\\mathcal{O}_{\\text{centered}}\\right]\\,$。您的程序应生成单行输出，其中包含所有情况的结果，格式为方括号括起来的逗号分隔列表，其中每个元素本身是一个由方括号括起来的包含三个数字的逗号分隔列表，例如 $\\,\\left[\\,[a,b,c],[d,e,f]\\,\\right]\\,$。所有输出均为无量纲；最终输出中不需要物理单位。",
            "solution": "用户提供了一个有效的问题。\n\n该问题要求分析两种数值格式，即中心空间显式格式和一阶迎风格式，应用于一维线性平流方程。分析将通过对一个间断初始条件应用单个时间步，并量化由此产生的总变差变化和振荡的出现来进行。\n\n控制性偏微分方程 (PDE) 是具有恒定正速度 $\\,u\\,$ 的标量浓度 $\\,c(x,t)\\,$ 的线性平流方程：\n$$\n\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\n$$\n域是周期性的，$\\,x \\in [0,L)\\,$，其中 $\\,L=100000\\,$ 米。空间域被离散化为 $\\,N=128\\,$ 个网格点，均匀网格间距为 $\\,\\Delta x = L/N\\,$。时间步长 $\\,\\Delta t\\,$ 由 Courant–Friedrichs–Lewy (CFL) 数 $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$ 决定。\n\n初始条件是一个离散阶跃函数：\n$$\nc_i^0 = \\begin{cases} c_L = 0  \\text{if } i  i_0 \\\\ c_R = 1  \\text{if } i \\ge i_0 \\end{cases}\n$$\n其中 $\\,i\\,$ 是网格点索引。\n\n我们将首先推导这两种格式的有限差分方程，然后分析它们在给定初始条件下的行为，以预测诊断量。\n\n**1. 离散格式**\n\n平流方程的一个通用显式时间步进格式可以从 $\\,\\partial_t c\\,$ 的前向时间离散化写出：\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} + u (\\partial_x c)_i^n = 0\n$$\n重新整理并使用 CFL 数的定义 $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$，我们得到更新公式：\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x (\\partial_x c)_i^n\n$$\n其中 $\\,(\\partial_x c)_i^n\\,$ 是在网格点 $\\,i\\,$ 和时间层 $\\,n\\,$ 处空间导数的离散近似。索引是周期性处理的，因此在 $\\,i=0\\,$ 处的 $\\,c_{i-1}\\,$ 指的是 $\\,c_{N-1}\\,$，在 $\\,i=N-1\\,$ 处的 $\\,c_{i+1}\\,$ 指的是 $\\,c_0\\,$。\n\n**中心空间格式：** 空间导数由二阶中心差分近似：\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x}\n$$\n将此代入更新公式，得到：\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x} \\right) = c_i^n - \\frac{\\mathsf{C}}{2} (c_{i+1}^n - c_{i-1}^n)\n$$\n这是前向时间中心空间 (FTCS) 格式，已知它对于纯平流问题是无条件不稳定的，但对于单个时间步是良定义的。其主阶截断误差是色散性的，表现为伪振荡。\n\n**一阶迎风格式：** 对于正速度 $\\,u>0\\,$，迎风方向来自左侧（较低索引）。空间导数由一阶后向差分近似：\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_i^n - c_{i-1}^n}{\\Delta x}\n$$\n将此代入更新公式，得到：\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_i^n - c_{i-1}^n}{\\Delta x} \\right) = c_i^n - \\mathsf{C} (c_i^n - c_{i-1}^n) = (1-\\mathsf{C})c_i^n + \\mathsf{C}c_{i-1}^n\n$$\n已知该格式具有数值耗散性，并且在 $\\,0 \\le \\mathsf{C} \\le 1\\,$ 时稳定。\n\n**2. 诊断量与理论分析**\n\n关键诊断量是离散总变差的变化量 $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$ 和振荡幅度 $\\,\\mathcal{O}\\,$。\n离散总变差由下式给出：\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\n振荡幅度定义为：\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\n对于给定的初始条件，$\\,\\max_i c_i^0 = 1\\,$ 和 $\\,\\min_i c_i^0 = 0\\,$，因此这简化为：\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - 1,\\;\\; -\\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\n\n**对于 $\\,i_0 \\in (0, N)\\,$ 的分析（情况 1-4）：**\n由于周期性，初始条件在索引 $\\,i_0\\,$ （从 $\\,c_{i_0-1}^0=0\\,$到 $\\,c_{i_0}^0=1\\,$）和索引 $\\,0\\,$ （从 $\\,c_{N-1}^0=1\\,$ 到 $\\,c_0^0=0\\,$）处有两个跳跃。\n初始总变差为 $\\,\\mathrm{TV}^0 = |c_{i_0}^0 - c_{i_0-1}^0| + |c_0^0 - c_{N-1}^0| + \\dots = |1-0| + |0-1| = 2\\,$。\n\n对于**中心格式**，解仅在两个跳跃附近发生变化。让我们分析在 $\\,i_0\\,$ 处的跳跃：\n- 在 $\\,i=i_0-1\\,$ 处：$\\,c_{i_0-1}^0=0, c_{i_0-2}^0=0, c_{i_0}^0=1\\,$.\n  $\\,c_{i_0-1}^{n+1} = c_{i_0-1}^n - \\frac{\\mathsf{C}}{2}(c_{i_0}^n - c_{i_0-2}^n) = 0 - \\frac{\\mathsf{C}}{2}(1 - 0) = -\\frac{\\mathsf{C}}{2}\\,$. 这是一个下冲。\n- 在 $\\,i=i_0\\,$ 处：$\\,c_{i_0}^0=1, c_{i_0-1}^0=0, c_{i_0+1}^0=1\\,$.\n  $\\,c_{i_0}^{n+1} = c_{i_0}^n - \\frac{\\mathsf{C}}{2}(c_{i_0+1}^n - c_{i_0-1}^n) = 1 - \\frac{\\mathsf{C}}{2}(1 - 0) = 1 - \\frac{\\mathsf{C}}{2}\\,$.\n对称地，在另一个跳跃（索引 0）附近：\n- 在 $\\,i=N-1\\,$ 处：$\\,c_{N-1}^0=1, c_{N-2}^0=1, c_0^0=0\\,$.\n  $\\,c_{N-1}^{n+1} = c_{N-1}^n - \\frac{\\mathsf{C}}{2}(c_{0}^n - c_{N-2}^n) = 1 - \\frac{\\mathsf{C}}{2}(0 - 1) = 1 + \\frac{\\mathsf{C}}{2}\\,$. 这是一个过冲。\n新的极值是 $\\,\\max_i c_i^{n+1} = 1 + \\mathsf{C}/2\\,$ 和 $\\,\\min_i c_i^{n+1} = -\\mathsf{C}/2\\,$。\n振荡幅度为 $\\,\\mathcal{O}_{\\text{centered}} = \\max((1+\\mathsf{C}/2) - 1, -(-\\mathsf{C}/2), 0) = \\mathsf{C}/2\\,$。\n新的总变差是局部跳跃的总和：$\\,\\mathrm{TV}^{n+1} = 2 \\times (|\\frac{-\\mathsf{C}}{2}| + |(1-\\frac{\\mathsf{C}}{2}) - (\\frac{-\\mathsf{C}}{2})| + |1 - (1-\\frac{\\mathsf{C}}{2})|) = 2 \\times (\\frac{\\mathsf{C}}{2} + 1 + \\frac{\\mathsf{C}}{2}) = 2 + 2\\mathsf{C}\\,$.\n因此，$\\,\\Delta \\mathrm{TV}_{\\text{centered}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = (2+2\\mathsf{C}) - 2 = 2\\mathsf{C}\\,$。\n\n对于**迎风格式**，它在 $\\,0 \\le \\mathsf{C} \\le 1\\,$ 时是单调格式，已知是总变差递减 (TVD) 的，即 $\\,\\mathrm{TV}^{n+1} \\le \\mathrm{TV}^n\\,$。让我们对阶跃函数进行验证。\n- 在 $\\,i=i_0\\,$ 处：$\\,c_{i_0}^0=1, c_{i_0-1}^0=0\\,$.\n  $\\,c_{i_0}^{n+1} = (1-\\mathsf{C})c_{i_0}^n + \\mathsf{C}c_{i_0-1}^n = (1-\\mathsf{C})(1) + \\mathsf{C}(0) = 1-\\mathsf{C}\\,$.\n- 在 $\\,i=0\\,$ 处：$\\,c_{0}^0=0, c_{N-1}^0=1\\,$.\n  $\\,c_{0}^{n+1} = (1-\\mathsf{C})c_{0}^n + \\mathsf{C}c_{N-1}^n = (1-\\mathsf{C})(0) + \\mathsf{C}(1) = \\mathsf{C}\\,$.\n所有其他值在其左邻居具有相同值的地方保持不变。新的剖面在每个跳跃处将梯度涂抹到两个点上。新的 TV 为 $\\,\\mathrm{TV}^{n+1} = |(1-\\mathsf{C})-0| + |1 - (1-\\mathsf{C})| + |\\mathsf{C}-1| + |0-\\mathsf{C}| = (1-\\mathsf{C}) + \\mathsf{C} + (1-\\mathsf{C}) + \\mathsf{C} = 2\\,$。\n因此，$\\,\\Delta \\mathrm{TV}_{\\text{upwind}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = 2 - 2 = 0\\,$。此格式不会产生新的振荡，因此 $\\,\\max_i c_i^{n+1} \\in [0,1]\\,$ 且 $\\,\\min_i c_i^{n+1} \\in [0,1]\\,$。\n\n**对于 $\\,i_0 = 0\\,$ 的分析（情况 5）：**\n如果 $\\,i_0 = 0\\,$，则 $i  i_0$ 的条件永不为真，因此所有网格点的初始条件均为 $c_i^0 = c_R = 1$。这是一个常数场。\n初始总变差为 $\\,\\mathrm{TV}^0 = \\sum_{i=0}^{N-1} |c_{i+1}^0 - c_i^0| = \\sum |1-1| = 0\\,$。\n对于一个常数场，任何合理的平流格式都应该保持该常数，因此 $\\,c_i^{n+1} = 1\\,$ 对所有 $\\,i\\,$ 都成立。\n因此，$\\,\\mathrm{TV}^{n+1} = 0\\,$，$\\,\\Delta\\mathrm{TV} = 0\\,$。\n振荡幅度 $\\,\\mathcal{O}\\,$ 也为零，因为没有新的极值产生。\n因此，对于情况 5，两种格式的预期结果都是 $\\,[0, 0, 0]\\,$。\n\n**3. 计算最终结果**\n\n根据上述分析，我们可以为每种情况计算预期的三元组 $\\,[\\Delta \\mathrm{TV}_{\\text{centered}}, \\Delta \\mathrm{TV}_{\\text{upwind}}, \\mathcal{O}_{\\text{centered}}]\\,$。\n\n-   **情况 1 ($\\,\\mathsf{C} = 0.0, i_0 = 64\\,$):**\n    -   $\\Delta \\mathrm{TV}_{\\text{centered}} = 2 \\times 0.0 = 0.0$\n    -   $\\Delta \\mathrm{TV}_{\\text{upwind}} = 0.0$\n    -   $\\mathcal{O}_{\\text{centered}} = 0.0 / 2 = 0.0$\n    -   结果: $\\,[0.0, 0.0, 0.0]\\,$\n\n-   **情况 2 ($\\,\\mathsf{C} = 0.2, i_0 = 64\\,$):**\n    -   $\\Delta \\mathrm{TV}_{\\text{centered}} = 2 \\times 0.2 = 0.4$\n    -   $\\Delta \\mathrm{TV}_{\\text{upwind}} = 0.0$\n    -   $\\mathcal{O}_{\\text{centered}} = 0.2 / 2 = 0.1$\n    -   结果: $\\,[0.4, 0.0, 0.1]\\,$\n\n-   **情况 3 ($\\,\\mathsf{C} = 0.5, i_0 = 64\\,$):**\n    -   $\\Delta \\mathrm{TV}_{\\text{centered}} = 2 \\times 0.5 = 1.0$\n    -   $\\Delta \\mathrm{TV}_{\\text{upwind}} = 0.0$\n    -   $\\mathcal{O}_{\\text{centered}} = 0.5 / 2 = 0.25$\n    -   结果: $\\,[1.0, 0.0, 0.25]\\,$\n\n-   **情况 4 ($\\,\\mathsf{C} = 0.9, i_0 = 64\\,$):**\n    -   $\\Delta \\mathrm{TV}_{\\text{centered}} = 2 \\times 0.9 = 1.8$\n    -   $\\Delta \\mathrm{TV}_{\\text{upwind}} = 0.0$\n    -   $\\mathcal{O}_{\\text{centered}} = 0.9 / 2 = 0.45$\n    -   结果: $\\,[1.8, 0.0, 0.45]\\,$\n\n-   **情况 5 ($\\,\\mathsf{C} = 0.7, i_0 = 0\\,$):**\n    -   $\\Delta \\mathrm{TV}_{\\text{centered}} = 0.0$\n    -   $\\Delta \\mathrm{TV}_{\\text{upwind}} = 0.0$\n    -   $\\mathcal{O}_{\\text{centered}} = 0.0$\n    -   结果: $\\,[0.0, 0.0, 0.0]\\,$\n\n下面的 Python 脚本将实现这些计算，以确认这些理论结果并生成所需的输出格式。由于该问题可以通过纯理论分析解决，并且其结果简单，我们不需要运行完整的数值模拟，可以直接构造输出。然而，为了严谨起见，提供的代码将通过数值计算来验证这些值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in total variation and oscillation magnitude for two\n    advection schemes over one time step for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (CFL number, index i0 of the step)\n        (0.0, 64),\n        (0.2, 64),\n        (0.5, 64),\n        (0.9, 64),\n        (0.7, 0),\n    ]\n\n    # Global parameters as defined in the problem\n    L = 100000.0  # Domain length in meters\n    N = 128       # Number of grid points\n    u = 0.5       # Advection velocity in m/s\n    c_L = 0.0     # Left plateau value (dimensionless)\n    c_R = 1.0     # Right plateau value (dimensionless)\n\n    results = []\n    \n    for case in test_cases:\n        C, i0 = case\n\n        # 1. Setup the initial condition\n        c0 = np.full(N, c_R, dtype=float)\n        if i0 > 0:\n            c0[:i0] = c_L\n\n        # 2. Calculate initial Total Variation (TV^n)\n        # Periodicity is handled by np.roll\n        tv0 = np.sum(np.abs(np.roll(c0, -1) - c0))\n\n        # 3. Apply one time step for both schemes\n        \n        # Pre-calculate rolled arrays for periodic boundaries\n        c0_im1 = np.roll(c0, 1)  # c_{i-1}\n        c0_ip1 = np.roll(c0, -1) # c_{i+1}\n        \n        # Centered-in-space scheme\n        c1_centered = c0 - (C / 2.0) * (c0_ip1 - c0_im1)\n        \n        # First-order upwind scheme (for u > 0)\n        c1_upwind = c0 - C * (c0 - c0_im1)\n\n        # 4. Calculate metrics for the centered scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_centered = np.sum(np.abs(np.roll(c1_centered, -1) - c1_centered))\n        delta_tv_centered = tv1_centered - tv0\n        \n        # Oscillation magnitude (O)\n        max_c0 = np.max(c0)\n        min_c0 = np.min(c0)\n        max_c1_centered = np.max(c1_centered)\n        min_c1_centered = np.min(c1_centered)\n        \n        o_centered = np.max([\n            max_c1_centered - max_c0, \n            min_c0 - min_c1_centered, \n            0.0\n        ])\n\n        # 5. Calculate metrics for the upwind scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_upwind = np.sum(np.abs(np.roll(c1_upwind, -1) - c1_upwind))\n        delta_tv_upwind = tv1_upwind - tv0\n        \n        # 6. Store results for the current case\n        results.append([delta_tv_centered, delta_tv_upwind, o_centered])\n\n    # 7. Final print statement in the exact required format.\n    # The output should be a single line: [[a,b,c],[d,e,f],...]\n    output_str = \",\".join(f\"[{r[0]},{r[1]},{r[2]}]\" for r in results)\n    print(f\"[{output_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "像迎风和中心差分这样的简单格式带来了一个两难选择：一个过于耗散，另一个则会产生振荡。现代计算流体动力学通过使用高分辨率混合格式来解决这个问题，这种格式能自适应局部解的特征。这个高级项目  将挑战您设计并实现一个使用通量限制器的此类格式，旨在无振荡地捕捉尖锐锋面，同时在平滑区域保持高精度。",
            "id": "3818141",
            "problem": "考虑周期性通道中标量示踪剂的一维线性平流，其由守恒律 $\\partial_t u + \\partial_x f(u) = 0$ 控制，其中线性通量 $f(u) = c\\,u$，$u(x,t)$ 是无量纲浓度，$x$ 是以米为单位的位置，$t$ 是以秒为单位的时间，$c$ 是以米/秒为单位的恒定平流速度。在间距为 $\\Delta x$ 的均匀网格和时间步长为 $\\Delta t$ 的情况下，定义 Courant–Friedrichs–Lewy (CFL) 数为 $\\mathrm{CFL} = c\\,\\Delta t / \\Delta x$。假设在区间 $[0,L]$ 上采用周期性边界条件。\n\n设计并实现一个守恒型有限体积算法，该算法使用三种数值通量选择来推进 $u$：\n- 适用于 $c>0$ 的纯上游格式，根据单调性和特征方向导出，\n- 对光滑场的线性平流在空间和时间上具有二阶精度的纯中心平流格式，\n- 一种混合高分辨率格式，该格式使用一个依赖于局部光滑度指示器的非线性通量限制器函数，混合一阶单调通量和二阶中心通量。该限制器必须在间断附近强制实现总变差递减 (TVD) 行为，在陡峭但单调的锋面附近减少数值扩散，并在足够光滑的区域恢复中心格式的行为。\n\n从有限体积更新关系和线方法视角出发，推导每个格式必须满足的离散更新，并指定混合格式中使用的限制策略。您的混合格式必须与守恒律一致，在极值点或分辨率不足的锋面附近恢复为上游格式，并在光滑区域向中心格式提高精度。使用一个在 $r=0$ 之外二次可微的限制器（其中 $r$ 是连续梯度的局部比率），并强制 $\\phi(r) \\in [0,2]$ 且 $\\phi(1)=1$。\n\n通过计算在目标时间 $T$ 时相对于周期域上的精确平移初始条件 $u_{\\mathrm{exact}}(x,T) = u_0(x - c T)$ 的归一化 $L^1$ 误差来量化性能。归一化 $L^1$ 误差定义为\n$$\nE_1 = \\frac{\\int_0^L \\left| u(x,T) - u_{\\mathrm{exact}}(x,T) \\right|\\,dx}{\\int_0^L \\left| u_{\\mathrm{exact}}(x,T) \\right|\\,dx},\n$$\n该误差是无量纲的。对于均匀网格上的离散数据，使用间距为 $\\Delta x$ 的黎曼和近似。\n\n实现以下测试套件，所有测试均使用 $L = 1\\,\\mathrm{m}$、$c = 1\\,\\mathrm{m/s}$ 和目标时间 $T = L/c$：\n- 测试用例 $\\mathbf{A}$（光滑脉冲）：$N = 256$ 个网格点，$\\mathrm{CFL} = 0.5$，初始条件为 $u_0(x) = \\exp\\!\\left(-\\frac{(x - x_0)^2}{2\\sigma^2}\\right)$，其中 $x_0 = 0.3\\,\\mathrm{m}$，$\\sigma = 0.05\\,\\mathrm{m}$。\n- 测试用例 $\\mathbf{B}$（间断锋面）：$N = 512$ 个网格点，$\\mathrm{CFL} = 0.95$，初始条件为当 $x \\in [0.25\\,\\mathrm{m}, 0.5\\,\\mathrm{m}]$ 时 $u_0(x) = 1$，否则 $u_0(x) = 0$。\n- 测试用例 $\\mathbf{C}$（光滑波）：$N = 128$ 个网格点，$\\mathrm{CFL} = 0.2$，初始条件为 $u_0(x) = \\sin\\!\\left(2\\pi x/L\\right)$。\n\n对于每个测试用例，计算纯上游格式、纯中心格式和混合格式在时间 $T$ 时的归一化 $L^1$ 误差 $E_1$。通过为每个测试用例返回以下比率来报告相对性能：\n$$\nR_{\\mathrm{up}} = \\frac{E_1^{\\mathrm{upwind}}}{E_1^{\\mathrm{hybrid}}}, \\qquad R_{\\mathrm{cen}} = \\frac{E_1^{\\mathrm{centered}}}{E_1^{\\mathrm{hybrid}}},\n$$\n以十进制浮点数形式表示。大于 $1$ 的比率表示混合格式的性能优于比较对象（误差更低）。\n\n您的程序必须生成单行输出，其中包含按以下顺序汇总的六个比率结果：$\\left[R_{\\mathrm{up}}^{\\mathbf{A}}, R_{\\mathrm{cen}}^{\\mathbf{A}}, R_{\\mathrm{up}}^{\\mathbf{B}}, R_{\\mathrm{cen}}^{\\mathbf{B}}, R_{\\mathrm{up}}^{\\mathbf{C}}, R_{\\mathrm{cen}}^{\\mathbf{C}}\\right]$。输出必须是方括号括起来的逗号分隔列表，例如 $\\left[0.0,0.0,0.0,0.0,0.0,0.0\\right]$。\n\n所有报告的量都是无量纲的；不要在最终输出中包含物理单位。三角函数中出现的角度以弧度为单位。使用周期性边界条件，并确保时间步数 $N_t$ 和时间步长 $\\Delta t$ 意味着 $T_{\\mathrm{eff}} = N_t \\Delta t$；通过在长度为 $L$ 的圆上将初始条件平移距离 $c T_{\\mathrm{eff}}$ 来计算精确参考解 $u_{\\mathrm{exact}}(x,T_{\\mathrm{eff}})$。",
            "solution": "用户想要解决一个计算流体动力学问题。\n此问题是有效的，因为它科学地基于流体动力学和数值分析的原理，所有必要条件都已给出，问题是适定的，并且使用客观、正式的语言陈述。它代表了在实现和比较守恒律数值格式方面一个标准但非平凡的练习。我现在将提供一个完整的解决方案。\n\n该问题要求设计和比较三种用于一维线性平流方程的数值格式：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial (cu)}{\\partial x} = 0\n$$\n其中 $u(x,t)$ 是一个标量浓度，$c > 0$ 是一个恒定的平流速度，$x$ 是位置，$t$ 是时间。这些格式将在一个间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上，在一个守恒型有限体积框架内实现。\n\n有限体积法近似计算浓度的单元平均值 $\\bar{u}_j(t) = \\frac{1}{\\Delta x} \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x,t) dx$。将控制方程在一个控制体 $[x_{j-1/2}, x_{j+1/2}]$ 上积分，得到单元平均值的精确演化：\n$$\n\\frac{d\\bar{u}_j}{dt} = -\\frac{1}{\\Delta x} \\left[ f(u(x_{j+1/2},t)) - f(u(x_{j-1/2},t)) \\right]\n$$\n其中 $f(u) = cu$ 是物理通量。数值格式将单元界面 $x_{j\\pm 1/2}$ 处通量的精确点值 $f(u(x_{j\\pm 1/2}, t))$ 替换为一个依赖于离散单元平均数据 $\\{u_k\\}$ 的数值通量函数 $F_{j\\pm 1/2}$。使用前向欧拉时间步，全离散更新为：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2}^n - F_{j-1/2}^n \\right)\n$$\n其中 $u_j^n \\approx \\bar{u}_j(t^n)$，Courant–Friedrichs–Lewy (CFL) 数为 $\\mathrm{CFL} = \\sigma = c \\Delta t / \\Delta x$。所要求的三种格式对应于数值通量 $F$ 的不同选择。\n\n**1. 纯上游格式**\n对于 $c>0$ 的线性平流，信息从左向右传播。迎风原理规定，界面处的通量应由“上游”单元的状态决定。对于界面 $x_{j+1/2}$，上游单元是单元 $j$。\n因此，数值通量为：\n$$\nF_{j+1/2} = f(u_j) = c u_j\n$$\n将此代入有限体积更新方程得到：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} (c u_j^n - c u_{j-1}^n) = u_j^n - \\sigma (u_j^n - u_{j-1}^n)\n$$\n该格式在空间和时间上都是一阶精度，对于 $\\sigma \\in [0,1]$ 是总变差递减 (TVD) 的，因此是非振荡的，但存在显著的数值扩散，这会模糊尖锐特征。\n\n**2. 纯中心格式 (Lax-Wendroff)**\n一个在空间和时间上均为二阶精度的格式可以从 $u$ 在时间上的泰勒级数展开推导出来：\n$$\nu(x, t^{n+1}) = u(x, t^n) + \\Delta t \\frac{\\partial u}{\\partial t} \\bigg|_{t^n} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial t^2} \\bigg|_{t^n} + \\mathcal{O}((\\Delta t)^3)\n$$\n使用控制方程，时间导数可以被替换为空间导数：\n$\\partial_t u = -c \\partial_x u$\n$\\partial_{tt} u = \\partial_t(-c \\partial_x u) = -c \\partial_x(\\partial_t u) = -c \\partial_x(-c \\partial_x u) = c^2 \\partial_{xx} u$\n将这些代入泰勒展开，得到偏微分方程：\n$$\nu(x, t^{n+1}) = u(x, t^n) - c \\Delta t \\frac{\\partial u}{\\partial x} \\bigg|_{t^n} + \\frac{c^2 (\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{t^n} + \\mathcal{O}((\\Delta t)^3)\n$$\n使用二阶中心差分在网格点 $x_j$ 处离散化空间导数，得到 Lax-Wendroff 格式：\n$$\nu_j^{n+1} = u_j^n - c \\Delta t \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} \\right) + \\frac{c^2 (\\Delta t)^2}{2} \\left( \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2} \\right)\n$$\n用 CFL 数 $\\sigma = c\\Delta t/\\Delta x$ 表示，更新为：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\sigma}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{\\sigma^2}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\n该格式是二阶精度的，但不是单调的，会在间断或陡峭梯度附近产生伪振荡（吉布斯现象）。\n\n**3. 混合高分辨率 TVD 格式**\n目标是融合上游格式的鲁棒性和高阶格式的精度。这通过使用通量限制器来实现，它根据解的局部光滑度来修正通量。数值通量 $F_{j+1/2}$ 表示为一个低阶（上游）通量加上一个受限的高阶修正：\n$$\nF_{j+1/2} = F_{j+1/2}^{\\text{low}} + \\phi(r_{j+1/2}) \\left( F_{j+1/2}^{\\text{high}} - F_{j+1/2}^{\\text{low}} \\right)\n$$\n对于线性平流，高阶通量的一个方便选择是 Lax-Wendroff 通量，低阶通量则选择上游通量。通量修正项是：\n$$\nF_{j+1/2}^{\\text{high}} - F_{j+1/2}^{\\text{low}} = F_{j+1/2}^{\\text{Lax-Wendroff}} - F_{j+1/2}^{\\text{Upwind}} = \\left( c\\frac{u_j+u_{j+1}}{2} - \\frac{c^2\\Delta t}{2\\Delta x}(u_{j+1}-u_j) \\right) - (cu_j) = \\frac{c}{2}(1-\\sigma)(u_{j+1} - u_j)\n$$\n因此，受限通量为：\n$$\nF_{j+1/2} = c u_j + \\phi(r_{j+1/2}) \\frac{c}{2}(1-\\sigma)(u_{j+1}-u_j)\n$$\n限制器函数 $\\phi(r)$ 依赖于光滑度指示器 $r$，它是连续解梯度的比率。对于界面 $x_{j+1/2}$，当 $c0$ 时，状态受上游（左侧）信息的影响。一个常见的方法将 $r$ 定义为界面上游的连续梯度与跨界面梯度之比：\n$$\nr_{j+1/2} = \\frac{u_j - u_{j-1}}{u_{j+1} - u_j}\n$$\n- 如果 $r$ 接近 $1$，解是光滑的，我们希望 $\\phi(1)=1$ 以恢复二阶行为。\n- 如果 $r \\le 0$，表示存在极值点或振荡，因此我们希望 $\\phi(r)=0$ 以恢复到具有扩散性但单调的一阶上游格式。\n- 如果 $r$ 很大，表示存在陡峭锋面，限制器应限制通量以防止过冲。\n\n该问题要求一个在 $r=0$ 之外二次可微，满足 $\\phi(1)=1$，并且其值域在 $[0,2]$ 内的限制器。van Leer 限制器是一个绝佳的选择：\n$$\n\\phi(r) = \\frac{r + |r|}{1 + |r|} = \\begin{cases} \\frac{2r}{1+r}  r > 0 \\\\ 0  r \\le 0 \\end{cases}\n$$\n该函数在 $r>0$ 时无限可微，满足 $\\phi(1) = 2(1)/(1+1) = 1$，其值域为 $[0, 2)$。它在 $r=0$ 处连续但不可微，符合“在 $r=0$ 之外可微”的标准。\n\n混合格式的更新规则是：\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2} - F_{j-1/2} \\right)\n$$\n其中 $F_{k+1/2} = c u_k^n + \\phi(r_{k+1/2}) \\frac{c}{2}(1-\\sigma)(u_{k+1}^n - u_k^n)$ 且 $r_{k+1/2} = (u_k^n - u_{k-1}^n) / (u_{k+1}^n - u_k^n)$。在计算 $r$ 时，必须在分母上加一个小数 $\\epsilon$ 以防止在零梯度区域出现除零错误。\n\n**性能评估**\n归一化的 $L^1$ 误差计算如下：\n$$\nE_1 = \\frac{\\sum_{j=0}^{N-1} \\left| u_j(T) - u_{\\mathrm{exact}}(x_j,T) \\right|}{\\sum_{j=0}^{N-1} \\left| u_{\\mathrm{exact}}(x_j,T) \\right|}\n$$\n时间 $T$ 后的精确解是初始条件的简单平移，$u_{\\mathrm{exact}}(x,T) = u_0(x - cT)$，在域 $[0,L]$ 上进行周期性回绕。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using three different finite-volume schemes\n    and computes the relative performance of a hybrid TVD scheme.\n    \"\"\"\n\n    def run_simulation(N, cfl, u0_func, L, c, T):\n        \"\"\"\n        Runs the simulation for a given test case and returns the L1 errors.\n        \"\"\"\n        # Grid and time step setup\n        dx = L / N\n        dt = cfl * dx / c\n        # Ensure the final time is an integer multiple of dt\n        Nt = int(np.ceil(T / dt))\n        T_eff = Nt * dt\n        x = np.linspace(0, L, N, endpoint=False)\n        sigma = c * dt / dx\n\n        # Initial conditions\n        u_initial = u0_func(x)\n        u_upwind = u_initial.copy()\n        u_centered = u_initial.copy()\n        u_hybrid = u_initial.copy()\n        \n        # Time-stepping loop\n        for _ in range(Nt):\n            # -------------------------------------------------------------\n            # Scheme 1: First-Order Upwind (c > 0)\n            # u_j^{n+1} = u_j^n - sigma * (u_j^n - u_{j-1}^n)\n            # -------------------------------------------------------------\n            u_jm1_upwind = np.roll(u_upwind, 1)\n            u_upwind = u_upwind - sigma * (u_upwind - u_jm1_upwind)\n\n            # -------------------------------------------------------------\n            # Scheme 2: Second-Order Centered (Lax-Wendroff)\n            # -------------------------------------------------------------\n            u_jp1_centered = np.roll(u_centered, -1)\n            u_jm1_centered = np.roll(u_centered, 1)\n            term1 = sigma / 2.0 * (u_jp1_centered - u_jm1_centered)\n            term2 = sigma**2 / 2.0 * (u_jp1_centered - 2 * u_centered + u_jm1_centered)\n            u_centered = u_centered - term1 + term2\n\n            # -------------------------------------------------------------\n            # Scheme 3: Hybrid High-Resolution TVD Scheme\n            # -------------------------------------------------------------\n            # Needed stencils with periodic boundaries\n            u_jm2_hybrid = np.roll(u_hybrid, 2)\n            u_jm1_hybrid = np.roll(u_hybrid, 1)\n            u_jp1_hybrid = np.roll(u_hybrid, -1)\n\n            # Calculate smoothness indicator r at interfaces j-1/2 and j+1/2\n            # Handle division by zero with a small epsilon\n            epsilon = 1e-12\n            \n            # For flux F_{j+1/2}\n            num_r_jp12 = u_hybrid - u_jm1_hybrid\n            den_r_jp12 = u_jp1_hybrid - u_hybrid\n            r_jp12 = np.divide(num_r_jp12, den_r_jp12, out=np.zeros_like(num_r_jp12), where=np.abs(den_r_jp12)>epsilon)\n\n            # For flux F_{j-1/2}\n            num_r_jm12 = u_jm1_hybrid - u_jm2_hybrid\n            den_r_jm12 = u_hybrid - u_jm1_hybrid\n            r_jm12 = np.divide(num_r_jm12, den_r_jm12, out=np.zeros_like(num_r_jm12), where=np.abs(den_r_jm12)>epsilon)\n            \n            # Van Leer limiter: phi(r) = (r + |r|) / (1 + |r|)\n            phi_jp12 = (r_jp12 + np.abs(r_jp12)) / (1.0 + np.abs(r_jp12))\n            phi_jm12 = (r_jm12 + np.abs(r_jm12)) / (1.0 + np.abs(r_jm12))\n\n            # Flux correction term\n            flux_corr_jp12 = phi_jp12 * (c / 2.0) * (1.0 - sigma) * (u_jp1_hybrid - u_hybrid)\n            flux_corr_jm12 = phi_jm12 * (c / 2.0) * (1.0 - sigma) * (u_hybrid - u_jm1_hybrid)\n\n            # Upwind flux\n            flux_low_jp12 = c * u_hybrid\n            flux_low_jm12 = c * u_jm1_hybrid\n\n            # Total limited flux\n            F_jp12 = flux_low_jp12 + flux_corr_jp12\n            F_jm12 = flux_low_jm12 + flux_corr_jm12\n            \n            u_hybrid = u_hybrid - (dt / dx) * (F_jp12 - F_jm12)\n\n        # -------------------------------------------------------------\n        # Error Calculation\n        # -------------------------------------------------------------\n        # Exact solution is a periodic translation\n        x_translated = (x - c * T_eff) % L\n        u_exact = u0_func(x_translated)\n\n        # Calculate normalized L1 error for each scheme\n        norm_exact = np.sum(np.abs(u_exact))\n        if norm_exact  epsilon:\n            # If the exact solution is zero everywhere, errors are absolute\n             norm_exact = 1.0\n\n        e1_upwind = np.sum(np.abs(u_upwind - u_exact)) / norm_exact\n        e1_centered = np.sum(np.abs(u_centered - u_exact)) / norm_exact\n        e1_hybrid = np.sum(np.abs(u_hybrid - u_exact)) / norm_exact\n\n        return e1_upwind, e1_centered, e1_hybrid\n\n    # Test cases definition\n    L_val = 1.0\n    c_val = 1.0\n    T_val = L_val / c_val\n    \n    # Test case A: Smooth pulse\n    def u0_A(x):\n        x0, sigma = 0.3, 0.05\n        return np.exp(-(x - x0)**2 / (2 * sigma**2))\n\n    # Test case B: Discontinuous front (square wave)\n    def u0_B(x):\n        return np.where((x >= 0.25)  (x = 0.5), 1.0, 0.0)\n\n    # Test case C: Smooth wave (sine)\n    def u0_C(x):\n        return np.sin(2 * np.pi * x / L_val)\n\n    test_cases = [\n        # (N, CFL, u0_func)\n        (256, 0.5, u0_A),\n        (512, 0.95, u0_B),\n        (128, 0.2, u0_C),\n    ]\n\n    all_results = []\n    for N_val, cfl_val, u0_func in test_cases:\n        e1_up, e1_cen, e1_hyb = run_simulation(N_val, cfl_val, u0_func, L_val, c_val, T_val)\n        \n        # Calculate ratios, handle case where hybrid error is near zero\n        epsilon = 1e-12\n        if e1_hyb  epsilon:\n            r_up = np.inf if e1_up > epsilon else 1.0\n            r_cen = np.inf if e1_cen > epsilon else 1.0\n        else:\n            r_up = e1_up / e1_hyb\n            r_cen = e1_cen / e1_hyb\n        \n        all_results.extend([r_up, r_cen])\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}