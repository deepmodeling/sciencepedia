{
    "hands_on_practices": [
        {
            "introduction": "A numerical scheme rarely solves the exact partial differential equation we intend. Instead, it solves a \"modified\" equation containing additional terms that represent the scheme's truncation error. This exercise uses the powerful tool of modified equation analysis to reveal that the leading error of the first-order upwind scheme acts as a diffusion term. By deriving this \"numerical diffusion\" and comparing its magnitude to physical diffusion, you will practice a critical skill in computational modeling: distinguishing numerical artifacts from real physical processes. ",
            "id": "3818146",
            "problem": "Consider a one-dimensional coastal tracer front advected by a uniform current. The tracer concentration $C(x,t)$ obeys the linear advection equation $C_{t} + u\\,C_{x} = 0$, where $u0$ is a constant velocity. A sharp front is initialized at $t=0$ as a discontinuity across a single grid interface: $C(x,0) = C_{L}$ for $x0$ and $C(x,0) = C_{R}$ for $x0$, with $C_{L} \\neq C_{R}$. The numerical model uses a first-order upwind (backwards in space) discretization for advection and a forward Euler time stepping on a uniform grid with spacing $\\Delta x$. The time step $\\Delta t$ is chosen to yield a Courant–Friedrichs–Lewy (CFL) number $C = u\\,\\Delta t/\\Delta x$ in the stable range $0  C \\leq 1$. The horizontal physical diffusivity is $\\kappa0$, which, if present, would smear the front over a timescale set by diffusion.\n\nStarting from the continuous advection law and the stated discrete scheme, perform a leading-order modified equation analysis to identify the effective numerical diffusion coefficient $\\nu_{\\mathrm{num}}$ induced by the first-order upwind scheme. Using the diffusive front-smearing timescale $T \\sim L^{2}/\\nu$ with $L$ taken as the grid scale $L=\\Delta x$, compute the numerical smearing timescale $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$ and the physical smearing timescale $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$. Finally, evaluate the ratio $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$ for the parameters $u = 0.5\\,\\mathrm{m\\,s^{-1}}$, $\\Delta x = 500\\,\\mathrm{m}$, $C = 0.8$, and $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$.\n\nRound your final answer for $R$ to four significant figures. Because $R$ is dimensionless, no unit should be reported for the final answer.",
            "solution": "The user has provided a valid problem statement.\n\n### Step 1: Problem Validation\n#### Step 1.1: Extract Givens\n- **Governing Equation**: The tracer concentration $C(x,t)$ obeys the linear advection equation $C_{t} + u\\,C_{x} = 0$.\n- **Velocity**: $u0$ is a constant velocity.\n- **Initial Condition**: A sharp front is given by $C(x,0) = C_{L}$ for $x0$ and $C(x,0) = C_{R}$ for $x0$, where $C_{L} \\neq C_{R}$.\n- **Numerical Scheme**:\n    - Time-stepping: Forward Euler.\n    - Spatial discretization: First-order upwind (backward in space, since $u0$).\n- **Grid and Time Step**: The grid is uniform with spacing $\\Delta x$. The time step is $\\Delta t$.\n- **CFL Number**: The Courant–Friedrichs–Lewy (CFL) number is $C = u\\,\\Delta t/\\Delta x$, and it is in the stable range $0  C \\leq 1$.\n- **Physical Diffusivity**: The horizontal physical diffusivity is $\\kappa0$.\n- **Task 1**: Perform a leading-order modified equation analysis to find the effective numerical diffusion coefficient $\\nu_{\\mathrm{num}}$.\n- **Task 2**: Define the numerical smearing timescale as $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$ and the physical smearing timescale as $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$.\n- **Task 3**: Evaluate the ratio $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$.\n- **Parameters for Evaluation**: $u = 0.5\\,\\mathrm{m\\,s^{-1}}$, $\\Delta x = 500\\,\\mathrm{m}$, $C = 0.8$, and $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$.\n- **Final Answer Format**: Round the value of $R$ to four significant figures.\n\n#### Step 1.2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It is based on fundamental principles of computational fluid dynamics, specifically the analysis of numerical schemes for the advection equation. The method requested, modified equation analysis, is a standard tool for quantifying the truncation error of a finite difference scheme in terms of an effective differential equation. All parameters and definitions are provided, making the problem self-contained and solvable for a unique answer. The provided physical parameters are realistic for a coastal oceanography context.\n\n#### Step 1.3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Step 2: Solution Derivation\nThe problem requires us to find the ratio of the numerical smearing timescale to the physical smearing timescale. This begins with a modified equation analysis to determine the numerical diffusion coefficient of the specified numerical scheme.\n\nThe governing continuous equation is the one-dimensional linear advection equation:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = 0\n$$\nwhere $u  0$ is a constant velocity.\n\nThe numerical scheme uses a forward Euler method for the time derivative and a first-order upwind scheme for the spatial derivative. For $u  0$, the upwind direction is backwards in space. Let $C_j^n$ denote the numerical approximation of $C(x_j, t_n)$ at grid point $x_j = j\\Delta x$ and time $t_n = n\\Delta t$. The discretized equation is:\n$$\n\\frac{C_j^{n+1} - C_j^n}{\\Delta t} + u \\frac{C_j^n - C_{j-1}^n}{\\Delta x} = 0\n$$\n\nTo perform the modified equation analysis, we use Taylor series expansions for $C_j^{n+1}$ and $C_{j-1}^n$ around the point $(x_j, t_n)$. All derivatives below are evaluated at this point.\n$$\nC_j^{n+1} = C(x_j, t_n + \\Delta t) = C + \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2!} \\frac{\\partial^2 C}{\\partial t^2} + O((\\Delta t)^3)\n$$\n$$\nC_{j-1}^n = C(x_j - \\Delta x, t_n) = C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 C}{\\partial x^2} - \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 C}{\\partial x^3} + O((\\Delta x)^4)\n$$\n\nSubstituting these expansions into the discrete equation:\n$$\n\\frac{1}{\\Delta t} \\left( \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + \\frac{u}{\\Delta x} \\left( C - \\left( C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\dots \\right) \\right) = 0\n$$\nSimplifying this expression gives:\n$$\n\\left( \\frac{\\partial C}{\\partial t} + \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + u \\left( \\frac{\\partial C}{\\partial x} - \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} + \\dots \\right) = 0\n$$\nRearranging the terms, we get an expression for the equation that the numerical scheme solves, which is the sum of the original PDE and the truncation error terms:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nTo find the leading-order modified equation, we need to express the time derivative $\\frac{\\partial^2 C}{\\partial t^2}$ in terms of spatial derivatives. We can do this by repeatedly differentiating the lowest-order equation, which is the original PDE, $\\frac{\\partial C}{\\partial t} = -u \\frac{\\partial C}{\\partial x}$.\nDifferentiating with respect to $t$:\n$$\n\\frac{\\partial^2 C}{\\partial t^2} = \\frac{\\partial}{\\partial t} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = -u \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial C}{\\partial t} \\right) = -u \\frac{\\partial}{\\partial x} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = u^2 \\frac{\\partial^2 C}{\\partial x^2}\n$$\nSubstituting this back into the equation for the truncation error:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 C}{\\partial x^2} \\right) + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nFactoring out a common term:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nThe term in the parenthesis is the CFL number, $C = u \\Delta t / \\Delta x$. The leading-order modified equation is an advection-diffusion equation:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\nu_{\\mathrm{num}} \\frac{\\partial^2 C}{\\partial x^2}\n$$\nBy comparison, the effective numerical diffusion coefficient is identified as:\n$$\n\\nu_{\\mathrm{num}} = \\frac{u \\Delta x}{2} (1 - C)\n$$\nThis is the answer to the first part of the problem.\n\nNext, we are asked to find the ratio $R$ of the numerical smearing timescale, $T_{\\mathrm{num}}$, to the physical smearing timescale, $T_{\\mathrm{phys}}$. These are defined as:\n$$\nT_{\\mathrm{num}} = \\frac{\\Delta x^2}{\\nu_{\\mathrm{num}}} \\quad \\text{and} \\quad T_{\\mathrm{phys}} = \\frac{\\Delta x^2}{\\kappa}\n$$\nThe ratio $R$ is therefore:\n$$\nR = \\frac{T_{\\mathrm{num}}}{T_{\\mathrm{phys}}} = \\frac{\\Delta x^2 / \\nu_{\\mathrm{num}}}{\\Delta x^2 / \\kappa} = \\frac{\\kappa}{\\nu_{\\mathrm{num}}}\n$$\nSubstituting the expression for $\\nu_{\\mathrm{num}}$:\n$$\nR = \\frac{\\kappa}{\\frac{u \\Delta x}{2} (1 - C)} = \\frac{2\\kappa}{u \\Delta x (1 - C)}\n$$\nNow, we substitute the given numerical values into this expression for $R$:\n- $u = 0.5\\,\\mathrm{m\\,s^{-1}}$\n- $\\Delta x = 500\\,\\mathrm{m}$\n- $C = 0.8$\n- $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$\n\nThe calculation proceeds as follows:\n$$\nR = \\frac{2 \\times 100}{(0.5) \\times 500 \\times (1 - 0.8)}\n$$\n$$\nR = \\frac{200}{250 \\times 0.2}\n$$\n$$\nR = \\frac{200}{50}\n$$\n$$\nR = 4\n$$\nThe problem requires the answer to be rounded to four significant figures. An integer like $4$ has one significant figure. To express this value with four significant figures, we write it as $4.000$.",
            "answer": "$$\\boxed{4.000}$$"
        },
        {
            "introduction": "Having theoretically analyzed the dissipative nature of the upwind scheme, we now turn to a practical demonstration of its behavior alongside its common alternative, the centered scheme. While upwind methods introduce artificial smearing, centered schemes are prone to non-physical oscillations due to their dispersive error. This hands-on coding practice will starkly illustrate this dichotomy, allowing you to visualize and quantify how each scheme handles a sharp discontinuity, providing a concrete understanding of the fundamental trade-off between numerical diffusion and dispersion. ",
            "id": "3818209",
            "problem": "Consider the one-dimensional linear advection of a passive scalar in a periodic domain, governed by the partial differential equation $\\,\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\\,$, where $\\,c(x,t)\\,$ is the scalar concentration and $\\,u\\,$ is a constant advection velocity. The task is to examine, from first principles, the behavior of the centered-in-space explicit scheme versus the one-sided upwind scheme under a discontinuous initial condition, and to quantify the change in discrete total variation over a single time step. The Courant–Friedrichs–Lewy (CFL) number $\\,\\mathsf{C}\\,$ will be used to parameterize the time step and must be treated as dimensionless.\n\nYou must implement both discretizations on a uniform grid in a periodic domain $\\,x \\in [0,L)\\,$ with $\\,N\\,$ grid points, spacing $\\,\\Delta x = L/N\\,$, and a single time step $\\,\\Delta t\\,$ chosen to match a specified CFL number $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$. Use positive advection velocity $\\,u0\\,$. For every case, apply periodic boundary conditions.\n\nDefine the discrete total variation at time level $\\,n\\,$ for the grid function $\\,\\{c_i^n\\}_{i=0}^{N-1}\\,$ as\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\nwith the convention $\\,c_{N}^n \\equiv c_0^n\\,$ due to periodicity. For a single explicit time step $\\,n \\to n+1\\,$, compute $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$ for each discretization scheme.\n\nUse a discrete step function initial condition with two plateau values $\\,c_L\\,$ and $\\,c_R\\,$ such that $\\,c_i^0 = c_L\\,$ for $\\,i  i_0\\,$ and $\\,c_i^0 = c_R\\,$ for $\\,i \\ge i_0\\,$, where $\\,i_0\\,$ is the index of the first grid point on the right plateau. The jump amplitude is $\\,\\Delta c = c_R - c_L\\,$. Throughout, take $\\,c_L = 0\\,$ and $\\,c_R = 1\\,$ (dimensionless). The domain length must be $\\,L = 100000\\,$ in meters, the number of grid points must be $\\,N = 128\\,$, and the advection velocity must be $\\,u = 0.5\\,$ in meters per second. Use the CFL number $\\,\\mathsf{C}\\,$ to compute the time step as $\\,\\Delta t = \\mathsf{C}\\,\\Delta x / u\\,$ in seconds.\n\nOscillations are to be diagnosed by the magnitude of violations of the initial bounds. Define the oscillation magnitude after one step as\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right),\n$$\nwhich is a nonnegative real number (dimensionless).\n\nImplement the canonical centered-in-space explicit scheme for $\\,u0\\,$ and the canonical first-order upwind scheme for $\\,u0\\,$. Apply exactly one time step for each scheme and compute $\\,\\Delta \\mathrm{TV}\\,$ for both schemes and $\\,\\mathcal{O}\\,$ for the centered scheme.\n\nYour program must evaluate the following test suite, specified by the pair $\\,(\\mathsf{C}, i_0)\\,$ for each case:\n\n- Case $\\,1\\,$: $\\,\\mathsf{C} = 0.0\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,2\\,$: $\\,\\mathsf{C} = 0.2\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,3\\,$: $\\,\\mathsf{C} = 0.5\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,4\\,$: $\\,\\mathsf{C} = 0.9\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,5\\,$: $\\,\\mathsf{C} = 0.7\\,$, $\\,i_0 = 0\\,$.\n\nFor each case, produce a list $\\,\\left[\\Delta \\mathrm{TV}_{\\text{centered}},\\,\\Delta \\mathrm{TV}_{\\text{upwind}},\\,\\mathcal{O}_{\\text{centered}}\\right]\\,$ of three floating-point numbers. Your program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, where each element is itself a bracketed comma-separated list of three numbers, for example $\\,\\left[\\,[a,b,c],[d,e,f]\\,\\right]\\,$. All outputs are dimensionless; no physical units are required in the final output.",
            "solution": "The user has provided a valid problem.\n\nThe problem asks for an analysis of two numerical schemes, the centered-in-space explicit scheme and the first-order upwind scheme, applied to the one-dimensional linear advection equation. The analysis will be conducted by applying a single time step to a discontinuous initial condition and quantifying the resulting change in total variation and the emergence of oscillations.\n\nThe governing partial differential equation (PDE) is the linear advection equation for a scalar concentration $\\,c(x,t)\\,$ with a constant, positive velocity $\\,u\\,$:\n$$\n\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\n$$\nThe domain is periodic, $\\,x \\in [0,L)\\,$, with $\\,L=100000\\,$ m. The spatial domain is discretized into $\\,N=128\\,$ grid points, with a uniform grid spacing of $\\,\\Delta x = L/N\\,$. The time step, $\\,\\Delta t\\,$, is determined by the Courant–Friedrichs–Lewy (CFL) number, $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$.\n\nThe initial condition is a discrete step function:\n$$\nc_i^0 = \\begin{cases} c_L = 0  \\text{if } i  i_0 \\\\ c_R = 1  \\text{if } i \\ge i_0 \\end{cases}\n$$\nwhere $\\,i\\,$ is the grid point index.\n\nWe will first derive the finite difference equations for the two schemes, then analyze their behavior on the given initial condition to predict the diagnostic quantities.\n\n**1. Discretization Schemes**\n\nA generic explicit time-stepping scheme for the advection equation can be written from a forward-in-time discretization of $\\,\\partial_t c\\,$:\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} + u (\\partial_x c)_i^n = 0\n$$\nRearranging and using the definition of the CFL number $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$, we get the update formula:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x (\\partial_x c)_i^n\n$$\nwhere $\\,(\\partial_x c)_i^n\\,$ is the discrete approximation of the spatial derivative at grid point $\\,i\\,$ and time level $\\,n\\,$. The indices are handled periodically, such that $\\,c_{i-1}\\,$ at $\\,i=0\\,$ refers to $\\,c_{N-1}\\,$, and $\\,c_{i+1}\\,$ at $\\,i=N-1\\,$ refers to $\\,c_0\\,$.\n\n**Centered-in-Space Scheme:** The spatial derivative is approximated by a second-order centered difference:\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x}\n$$\nSubstituting this into the update formula gives:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x} \\right) = c_i^n - \\frac{\\mathsf{C}}{2} (c_{i+1}^n - c_{i-1}^n)\n$$\nThis is the Forward-Time Centered-Space (FTCS) scheme, which is known to be unconditionally unstable for the pure advection problem but is well-defined for a single time step. Its leading-order truncation error is dispersive, which manifests as spurious oscillations.\n\n**First-Order Upwind Scheme:** For positive velocity $\\,u0\\,$, the upwind direction is from the left (lower index). The spatial derivative is approximated by a first-order backward difference:\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_i^n - c_{i-1}^n}{\\Delta x}\n$$\nSubstituting this into the update formula gives:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_i^n - c_{i-1}^n}{\\Delta x} \\right) = c_i^n - \\mathsf{C} (c_i^n - c_{i-1}^n) = (1-\\mathsf{C})c_i^n + \\mathsf{C}c_{i-1}^n\n$$\nThis scheme is known to be numerically dissipative and is stable for $\\,0 \\le \\mathsf{C} \\le 1\\,$.\n\n**2. Diagnostic Quantities and Theoretical Analysis**\n\nThe key diagnostics are the change in discrete total variation, $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$, and the oscillation magnitude, $\\,\\mathcal{O}\\,$.\nThe discrete total variation is given by:\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\nThe oscillation magnitude is defined as:\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\nFor the given initial condition, $\\,\\max_i c_i^0 = 1\\,$ and $\\,\\min_i c_i^0 = 0\\,$, so this simplifies to:\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - 1,\\;\\; -\\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\n\n**Analysis for $\\,i_0 \\in (0, N)\\,$ (Cases 1-4):**\nThe initial condition has two jumps due to periodicity: one at index $\\,i_0\\,$ (from $\\,c_{i_0-1}^0=0\\,$ to $\\,c_{i_0}^0=1\\,$) and one at index $\\,0\\,$ (from $\\,c_{N-1}^0=1\\,$ to $\\,c_0^0=0\\,$).\nThe initial total variation is $\\,\\mathrm{TV}^0 = |c_{i_0}^0 - c_{i_0-1}^0| + |c_0^0 - c_{N-1}^0| + \\dots = |1-0| + |0-1| = 2\\,$.\n\nFor the **centered scheme**, the solution changes only near the two jumps. Let's analyze the jump at $\\,i_0\\,$:\n- At $\\,i=i_0-1\\,$: $\\,c_{i_0-1}^0=0, c_{i_0-2}^0=0, c_{i_0}^0=1\\,$.\n  $\\,c_{i_0-1}^{n+1} = c_{i_0-1}^n - \\frac{\\mathsf{C}}{2}(c_{i_0}^n - c_{i_0-2}^n) = 0 - \\frac{\\mathsf{C}}{2}(1 - 0) = -\\frac{\\mathsf{C}}{2}\\,$. This is an undershoot.\n- At $\\,i=i_0\\,$: $\\,c_{i_0}^0=1, c_{i_0-1}^0=0, c_{i_0+1}^0=1\\,$.\n  $\\,c_{i_0}^{n+1} = c_{i_0}^n - \\frac{\\mathsf{C}}{2}(c_{i_0+1}^n - c_{i_0-1}^n) = 1 - \\frac{\\mathsf{C}}{2}(1 - 0) = 1 - \\frac{\\mathsf{C}}{2}\\,$.\nSymmetrically, near the other jump (at index 0):\n- At $\\,i=N-1\\,$: $\\,c_{N-1}^0=1, c_{N-2}^0=1, c_0^0=0\\,$.\n  $\\,c_{N-1}^{n+1} = c_{N-1}^n - \\frac{\\mathsf{C}}{2}(c_{0}^n - c_{N-2}^n) = 1 - \\frac{\\mathsf{C}}{2}(0 - 1) = 1 + \\frac{\\mathsf{C}}{2}\\,$. This is an overshoot.\nThe new extrema are $\\,\\max_i c_i^{n+1} = 1 + \\mathsf{C}/2\\,$ and $\\,\\min_i c_i^{n+1} = -\\mathsf{C}/2\\,$.\nThe oscillation magnitude is $\\,\\mathcal{O}_{\\text{centered}} = \\max((1+\\mathsf{C}/2) - 1, -(-\\mathsf{C}/2), 0) = \\mathsf{C}/2\\,$.\nThe new total variation is the sum of local jumps: $\\,\\mathrm{TV}^{n+1} = 2 \\times (|\\frac{-\\mathsf{C}}{2}| + |(1-\\frac{\\mathsf{C}}{2}) - (\\frac{-\\mathsf{C}}{2})| + |1 - (1-\\frac{\\mathsf{C}}{2})|) = 2 \\times (\\frac{\\mathsf{C}}{2} + 1 + \\frac{\\mathsf{C}}{2}) = 2 + 2\\mathsf{C}\\,$.\nTherefore, $\\,\\Delta \\mathrm{TV}_{\\text{centered}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = (2+2\\mathsf{C}) - 2 = 2\\mathsf{C}\\,$.\n\nFor the **upwind scheme**, which is a monotone scheme for $\\,0 \\le \\mathsf{C} \\le 1\\,$, it is known to be Total Variation Diminishing (TVD), meaning $\\,\\mathrm{TV}^{n+1} \\le \\mathrm{TV}^n\\,$. Let's verify for the step function.\n- At $\\,i=i_0\\,$: $\\,c_{i_0}^0=1, c_{i_0-1}^0=0\\,$.\n  $\\,c_{i_0}^{n+1} = (1-\\mathsf{C})c_{i_0}^n + \\mathsf{C}c_{i_0-1}^n = (1-\\mathsf{C})(1) + \\mathsf{C}(0) = 1-\\mathsf{C}\\,$.\n- At $\\,i=0\\,$: $\\,c_{0}^0=0, c_{N-1}^0=1\\,$.\n  $\\,c_{0}^{n+1} = (1-\\mathsf{C})c_{0}^n + \\mathsf{C}c_{N-1}^n = (1-\\mathsf{C})(0) + \\mathsf{C}(1) = \\mathsf{C}\\,$.\nAll other values remain unchanged where their left neighbor had the same value. The new profile has gradients smeared across two points at each jump. The new TV is $\\,\\mathrm{TV}^{n+1} = |(1-\\mathsf{C})-0| + |1 - (1-\\mathsf{C})| + |\\mathsf{C}-1| + |0-\\mathsf{C}| = (1-\\mathsf{C}) + \\mathsf{C} + (1-\\mathsf{C}) + \\mathsf{C} = 2\\,$.\nThus, $\\,\\Delta \\mathrm{TV}_{\\text{upwind}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = 2 - 2 = 0\\,$. This scheme does not generate new oscillations, so $\\,\\max_i c_i^{n+1} \\in [0,1]\\,$ and $\\,\\min_i c_i^{n+1} \\in [0,1]\\,$.\n\n**Analysis for $\\,i_0 = 0\\,$ (Case 5):**\nIf $\\,i_0 = 0\\,$, the condition $\\,ii_0\\,$ is never met, so the initial condition is $\\,c_i^0=c_R=1\\,$ for all $\\,i\\,$. The field is constant.\nTherefore, $\\,c_{i+1}^0 - c_{i-1}^0 = 0\\,$ and $\\,c_i^0 - c_{i-1}^0 = 0\\,$ for all $\\,i\\,$.\nBoth schemes yield $\\,c_i^{n+1} = c_i^n = 1\\,$. The state does not evolve.\n$\\mathrm{TV}^0 = 0\\,$, $\\mathrm{TV}^1 = 0\\,$, so $\\,\\Delta \\mathrm{TV} = 0\\,$ for both schemes.\nThe solution remains bounded by $\\,[1, 1]\\,$, so $\\,\\mathcal{O}=0\\,$.\n\n**Summary of Predictions:**\n- Case 1: ($\\,\\mathsf{C}=0, i_0=64\\,$) $\\implies [\\Delta\\mathrm{TV}_c, \\Delta\\mathrm{TV}_u, \\mathcal{O}_c] = [2(0), 0, 0/2] = [0.0, 0.0, 0.0]$\n- Case 2: ($\\,\\mathsf{C}=0.2, i_0=64\\,$) $\\implies [2(0.2), 0, 0.2/2] = [0.4, 0.0, 0.1]$\n- Case 3: ($\\,\\mathsf{C}=0.5, i_0=64\\,$) $\\implies [2(0.5), 0, 0.5/2] = [1.0, 0.0, 0.25]$\n- Case 4: ($\\,\\mathsf{C}=0.9, i_0=64\\,$) $\\implies [2(0.9), 0, 0.9/2] = [1.8, 0.0, 0.45]$\n- Case 5: ($\\,\\mathsf{C}=0.7, i_0=0\\,$) $\\implies [0.0, 0.0, 0.0]$\n\nThe implementation will follow these derivations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in total variation and oscillation magnitude for two\n    advection schemes over one time step for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (CFL number, index i0 of the step)\n        (0.0, 64),\n        (0.2, 64),\n        (0.5, 64),\n        (0.9, 64),\n        (0.7, 0),\n    ]\n\n    # Global parameters as defined in the problem\n    L = 100000.0  # Domain length in meters\n    N = 128       # Number of grid points\n    u = 0.5       # Advection velocity in m/s\n    c_L = 0.0     # Left plateau value (dimensionless)\n    c_R = 1.0     # Right plateau value (dimensionless)\n\n    results = []\n    \n    for case in test_cases:\n        C, i0 = case\n\n        # 1. Setup the initial condition\n        c0 = np.full(N, c_R, dtype=float)\n        if i0 > 0:\n            c0[:i0] = c_L\n\n        # 2. Calculate initial Total Variation (TV^n)\n        # Periodicity is handled by np.roll\n        tv0 = np.sum(np.abs(np.roll(c0, -1) - c0))\n\n        # 3. Apply one time step for both schemes\n        \n        # Pre-calculate rolled arrays for periodic boundaries\n        c0_im1 = np.roll(c0, 1)  # c_{i-1}\n        c0_ip1 = np.roll(c0, -1) # c_{i+1}\n        \n        # Centered-in-space scheme\n        c1_centered = c0 - (C / 2.0) * (c0_ip1 - c0_im1)\n        \n        # First-order upwind scheme (for u > 0)\n        c1_upwind = c0 - C * (c0 - c0_im1)\n\n        # 4. Calculate metrics for the centered scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_centered = np.sum(np.abs(np.roll(c1_centered, -1) - c1_centered))\n        delta_tv_centered = tv1_centered - tv0\n        \n        # Oscillation magnitude (O)\n        max_c0 = np.max(c0)\n        min_c0 = np.min(c0)\n        max_c1_centered = np.max(c1_centered)\n        min_c1_centered = np.min(c1_centered)\n        \n        o_centered = np.max([\n            max_c1_centered - max_c0, \n            min_c0 - min_c1_centered, \n            0.0\n        ])\n\n        # 5. Calculate metrics for the upwind scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_upwind = np.sum(np.abs(np.roll(c1_upwind, -1) - c1_upwind))\n        delta_tv_upwind = tv1_upwind - tv0\n        \n        # 6. Store results for the current case\n        results.append([delta_tv_centered, delta_tv_upwind, o_centered])\n\n    # 7. Final print statement in the exact required format.\n    # The output should be a single line: [[a,b,c],[d,e,f],...]\n    output_str = \",\".join(f\"[{r[0]},{r[1]},{r[2]}]\" for r in results)\n    print(f\"[{output_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "The previous exercises have highlighted a central dilemma in numerical advection: the stability of the upwind scheme comes at the cost of accuracy, while the higher accuracy of the centered scheme is marred by instability and oscillations. This advanced practice guides you toward a modern solution to this problem by building a \"smart\" hybrid algorithm. You will implement a high-resolution, Total Variation Diminishing (TVD) scheme that uses a flux limiter to intelligently switch between a diffusive and a higher-order flux, achieving both sharp, non-oscillatory fronts and high accuracy in smooth regions. ",
            "id": "3818141",
            "problem": "Consider the one-dimensional linear advection of a scalar tracer in a periodic channel, governed by the conservation law $\\partial_t u + \\partial_x f(u) = 0$ with linear flux $f(u) = c\\,u$, where $u(x,t)$ is a dimensionless concentration, $x$ is position in meters, $t$ is time in seconds, and $c$ is a constant advection velocity in meters per second. On a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$, define the Courant–Friedrichs–Lewy (CFL) number $\\mathrm{CFL} = c\\,\\Delta t / \\Delta x$. Assume periodic boundary conditions on the interval $[0,L]$.\n\nDesign and implement a conservative finite-volume algorithm that advances $u$ using three numerical flux choices:\n- a pure upwind scheme appropriate for $c0$, derived from monotonicity and characteristic direction,\n- a pure centered advection scheme that is second-order accurate in space and time for linear advection of a smooth field,\n- a hybrid high-resolution scheme that blends a first-order monotone flux and a second-order centered flux using a nonlinear flux limiter function that depends on a local smoothness indicator. The limiter must enforce Total Variation Diminishing (TVD) behavior near discontinuities, reduce numerical diffusion near steep but monotone fronts, and recover centered behavior in sufficiently smooth regions.\n\nStarting from the finite-volume update relation and the method-of-lines perspective, derive the discrete update that each scheme must satisfy and specify the limiting strategy used in the hybrid scheme. Your hybrid must be consistent with the conservation law, revert to the upwind scheme in the vicinity of extrema or under-resolved fronts, and increase accuracy toward the centered scheme in smooth regions. Use a limiter that is twice differentiable away from $r=0$ (where $r$ is a local ratio of successive gradients) and that enforces $\\phi(r) \\in [0,2]$ with $\\phi(1)=1$.\n\nQuantify performance by computing a normalized $L^1$ error at a target time $T$ relative to the exact translated initial condition $u_{\\mathrm{exact}}(x,T) = u_0(x - c T)$ on the periodic domain. The normalized $L^1$ error is defined as\n$$\nE_1 = \\frac{\\int_0^L \\left| u(x,T) - u_{\\mathrm{exact}}(x,T) \\right|\\,dx}{\\int_0^L \\left| u_{\\mathrm{exact}}(x,T) \\right|\\,dx},\n$$\nwhich is dimensionless. For discrete data on a uniform grid, use the Riemann-sum approximation with spacing $\\Delta x$.\n\nImplement the following test suite, all with $L = 1\\,\\mathrm{m}$, $c = 1\\,\\mathrm{m/s}$, and target time $T = L/c$:\n- Test case $\\mathbf{A}$ (smooth pulse): $N = 256$ grid points, $\\mathrm{CFL} = 0.5$, and initial condition $u_0(x) = \\exp\\!\\left(-\\frac{(x - x_0)^2}{2\\sigma^2}\\right)$ with $x_0 = 0.3\\,\\mathrm{m}$ and $\\sigma = 0.05\\,\\mathrm{m}$.\n- Test case $\\mathbf{B}$ (discontinuous front): $N = 512$ grid points, $\\mathrm{CFL} = 0.95$, and initial condition $u_0(x) = 1$ for $x \\in [0.25\\,\\mathrm{m}, 0.5\\,\\mathrm{m}]$ and $u_0(x) = 0$ otherwise.\n- Test case $\\mathbf{C}$ (smooth wave): $N = 128$ grid points, $\\mathrm{CFL} = 0.2$, and initial condition $u_0(x) = \\sin\\!\\left(2\\pi x/L\\right)$.\n\nFor each test case, compute the normalized $L^1$ error $E_1$ for the pure upwind, pure centered, and hybrid schemes at time $T$. Report relative performance by returning, for each test case, the ratios\n$$\nR_{\\mathrm{up}} = \\frac{E_1^{\\mathrm{upwind}}}{E_1^{\\mathrm{hybrid}}}, \\qquad R_{\\mathrm{cen}} = \\frac{E_1^{\\mathrm{centered}}}{E_1^{\\mathrm{hybrid}}},\n$$\nas decimal floats. Ratios greater than $1$ indicate that the hybrid scheme outperforms the comparator (lower error).\n\nYour program must produce a single line of output containing the six ratio results aggregated in the following order: $\\left[R_{\\mathrm{up}}^{\\mathbf{A}}, R_{\\mathrm{cen}}^{\\mathbf{A}}, R_{\\mathrm{up}}^{\\mathbf{B}}, R_{\\mathrm{cen}}^{\\mathbf{B}}, R_{\\mathrm{up}}^{\\mathbf{C}}, R_{\\mathrm{cen}}^{\\mathbf{C}}\\right]$. The output must be a comma-separated list enclosed in square brackets, for example $\\left[0.0,0.0,0.0,0.0,0.0,0.0\\right]$.\n\nAll reported quantities are dimensionless; do not include physical units in the final output. Angles, where they appear in trigonometric functions, are in radians. Use periodic boundary conditions and ensure that the number of time steps $N_t$ and the time step $\\Delta t$ imply $T_{\\mathrm{eff}} = N_t \\Delta t$; compute the exact reference $u_{\\mathrm{exact}}(x,T_{\\mathrm{eff}})$ by translating the initial condition by distance $c T_{\\mathrm{eff}}$ on the circle of length $L$.",
            "solution": "The user wants to solve a computational fluid dynamics problem.\nThis problem is valid as it is scientifically grounded in the principles of fluid dynamics and numerical analysis, is well-posed with all necessary conditions provided, and is stated using objective, formal language. It represents a standard but non-trivial exercise in implementing and comparing numerical schemes for conservation laws. I will now provide a complete solution.\n\nThe problem requires the design and comparison of three numerical schemes for the one-dimensional linear advection equation:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial (cu)}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is a scalar concentration, $c  0$ is a constant advection velocity, $x$ is position, and $t$ is time. The schemes are to be implemented within a conservative finite-volume framework on a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$.\n\nA finite-volume method approximates the cell-averaged value of the concentration, $\\bar{u}_j(t) = \\frac{1}{\\Delta x} \\int_{x_{j-1/2}}^{x_{j+1/2}} u(x,t) dx$. Integrating the governing equation over a control volume $[x_{j-1/2}, x_{j+1/2}]$ gives the exact evolution of the cell average:\n$$\n\\frac{d\\bar{u}_j}{dt} = -\\frac{1}{\\Delta x} \\left[ f(u(x_{j+1/2},t)) - f(u(x_{j-1/2},t)) \\right]\n$$\nwhere $f(u) = cu$ is the physical flux. A numerical scheme replaces the exact point values of the flux at cell interfaces, $f(u(x_{j\\pm 1/2}, t))$, with a numerical flux function $F_{j\\pm 1/2}$ that depends on the discrete cell-averaged data $\\{u_k\\}$. Using a forward Euler time step, the fully discrete update is:\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2}^n - F_{j-1/2}^n \\right)\n$$\nwhere $u_j^n \\approx \\bar{u}_j(t^n)$ and the Courant–Friedrichs–Lewy (CFL) number is $\\mathrm{CFL} = \\sigma = c \\Delta t / \\Delta x$. The three required schemes correspond to different choices for the numerical flux $F$.\n\n**1. Pure Upwind Scheme**\nFor linear advection with $c0$, information propagates from left to right. The upwind principle dictates that the flux at an interface should be determined by the state in the \"upwind\" cell. For the interface at $x_{j+1/2}$, the upwind cell is cell $j$.\nThe numerical flux is therefore:\n$$\nF_{j+1/2} = f(u_j) = c u_j\n$$\nSubstituting this into the finite-volume update equation gives:\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} (c u_j^n - c u_{j-1}^n) = u_j^n - \\sigma (u_j^n - u_{j-1}^n)\n$$\nThis scheme is first-order accurate in both space and time, is total variation diminishing (TVD) and thus non-oscillatory for $\\sigma \\in [0,1]$, but suffers from significant numerical diffusion, which smears sharp features.\n\n**2. Pure Centered Scheme (Lax-Wendroff)**\nA second-order accurate scheme in both space and time can be derived from a Taylor series expansion of $u$ in time:\n$$\nu(x, t^{n+1}) = u(x, t^n) + \\Delta t \\frac{\\partial u}{\\partial t} \\bigg|_{t^n} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial t^2} \\bigg|_{t^n} + \\mathcal{O}((\\Delta t)^3)\n$$\nUsing the governing equation, the time derivatives can be replaced by spatial derivatives:\n$\\partial_t u = -c \\partial_x u$\n$\\partial_{tt} u = \\partial_t(-c \\partial_x u) = -c \\partial_x(\\partial_t u) = -c \\partial_x(-c \\partial_x u) = c^2 \\partial_{xx} u$\nSubstituting these into the Taylor expansion gives the partial differential equation:\n$$\nu(x, t^{n+1}) = u(x, t^n) - c \\Delta t \\frac{\\partial u}{\\partial x} \\bigg|_{t^n} + \\frac{c^2 (\\Delta t)^2}{2} \\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{t^n} + \\mathcal{O}((\\Delta t)^3)\n$$\nDiscretizing the spatial derivatives at grid point $x_j$ using second-order centered differences leads to the Lax-Wendroff scheme:\n$$\nu_j^{n+1} = u_j^n - c \\Delta t \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} \\right) + \\frac{c^2 (\\Delta t)^2}{2} \\left( \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2} \\right)\n$$\nIn terms of the CFL number $\\sigma = c\\Delta t/\\Delta x$, the update is:\n$$\nu_j^{n+1} = u_j^n - \\frac{\\sigma}{2}(u_{j+1}^n - u_{j-1}^n) + \\frac{\\sigma^2}{2}(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\nThis scheme is second-order accurate but is not monotonic, producing spurious oscillations (Gibbs phenomenon) near discontinuities or steep gradients.\n\n**3. Hybrid High-Resolution TVD Scheme**\nThe goal is to blend the robustness of the upwind scheme with the accuracy of a higher-order scheme. This is achieved using a flux limiter, which modifies the flux based on the local smoothness of the solution. The numerical flux $F_{j+1/2}$ is expressed as a low-order (upwind) flux plus a limited high-order correction:\n$$\nF_{j+1/2} = F_{j+1/2}^{\\text{low}} + \\phi(r_{j+1/2}) \\left( F_{j+1/2}^{\\text{high}} - F_{j+1/2}^{\\text{low}} \\right)\n$$\nFor linear advection, a convenient choice for the high-order flux is the Lax-Wendroff flux, and for the low-order flux is the upwind flux. The flux correction term is:\n$$\nF_{j+1/2}^{\\text{high}} - F_{j+1/2}^{\\text{low}} = F_{j+1/2}^{\\text{Lax-Wendroff}} - F_{j+1/2}^{\\text{Upwind}} = \\left( c\\frac{u_j+u_{j+1}}{2} - \\frac{c^2\\Delta t}{2\\Delta x}(u_{j+1}-u_j) \\right) - (cu_j) = \\frac{c}{2}(1-\\sigma)(u_{j+1} - u_j)\n$$\nThe limited flux is therefore:\n$$\nF_{j+1/2} = c u_j + \\phi(r_{j+1/2}) \\frac{c}{2}(1-\\sigma)(u_{j+1}-u_j)\n$$\nThe limiter function $\\phi(r)$ depends on the smoothness indicator $r$, which is a ratio of successive solution gradients. For the interface $x_{j+1/2}$, with $c0$, the state is influenced by information upwind (to the left). We define $r$ as the ratio of the consecutive gradient upwind of the interface to the gradient across the interface:\n$$\nr_{j+1/2} = \\frac{u_j - u_{j-1}}{u_{j+1} - u_j}\n$$\n- If $r$ is close to $1$, the solution is smooth, and we want $\\phi(1)=1$ to recover the second-order behavior.\n- If $r \\le 0$, it indicates an extremum or oscillation, so we want $\\phi(r)=0$ to revert to the diffusive but monotonic first-order upwind scheme.\n- If $r$ is large, it indicates a steep front, and the limiter should restrict the flux to prevent overshoots.\n\nThe problem requires a limiter that is twice differentiable away from $r=0$, satisfies $\\phi(1)=1$, and has its range in $[0,2]$. The van Leer limiter is an excellent choice:\n$$\n\\phi(r) = \\frac{r + |r|}{1 + |r|} = \\begin{cases} \\frac{2r}{1+r}  r  0 \\\\ 0  r \\le 0 \\end{cases}\n$$\nThis function is infinitely differentiable for $r0$, satisfies $\\phi(1) = 2(1)/(1+1) = 1$, and its range is $[0, 2)$. It is continuous at $r=0$ but not differentiable, fitting the criterion \"differentiable away from $r=0$\".\n\nThe update rule for the hybrid scheme is:\n$$\nu_j^{n+1} = u_j^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{j+1/2} - F_{j-1/2} \\right)\n$$\nwith $F_{k+1/2} = c u_k^n + \\phi(r_{k+1/2}) \\frac{c}{2}(1-\\sigma)(u_{k+1}^n - u_k^n)$ and $r_{k+1/2} = (u_k^n - u_{k-1}^n) / (u_{k+1}^n - u_k^n)$. A small value $\\epsilon$ must be added to the denominator in the calculation of $r$ to prevent division by zero in regions of zero gradient.\n\n**Performance Evaluation**\nThe normalized $L^1$ error is computed as:\n$$\nE_1 = \\frac{\\sum_{j=0}^{N-1} \\left| u_j(T) - u_{\\mathrm{exact}}(x_j,T) \\right|}{\\sum_{j=0}^{N-1} \\left| u_{\\mathrm{exact}}(x_j,T) \\right|}\n$$\nThe exact solution after time $T$ is a simple translation of the initial condition, $u_{\\mathrm{exact}}(x,T) = u_0(x - cT)$, with periodic wrapping on the domain $[0,L]$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using three different finite-volume schemes\n    and computes the relative performance of a hybrid TVD scheme.\n    \"\"\"\n\n    def run_simulation(N, cfl, u0_func, L, c, T):\n        \"\"\"\n        Runs the simulation for a given test case and returns the L1 errors.\n        \"\"\"\n        # Grid and time step setup\n        dx = L / N\n        dt = cfl * dx / c\n        # Ensure the final time is an integer multiple of dt\n        Nt = int(np.round(T / dt))\n        T_eff = Nt * dt\n        x = np.linspace(0, L, N, endpoint=False)\n        sigma = c * dt / dx\n\n        # Initial conditions\n        u_initial = u0_func(x)\n        u_upwind = u_initial.copy()\n        u_centered = u_initial.copy()\n        u_hybrid = u_initial.copy()\n        \n        # Time-stepping loop\n        for _ in range(Nt):\n            # Scheme 1: First-Order Upwind (c > 0)\n            u_jm1_upwind = np.roll(u_upwind, 1)\n            u_upwind = u_upwind - sigma * (u_upwind - u_jm1_upwind)\n\n            # Scheme 2: Second-Order Centered (Lax-Wendroff)\n            u_jp1_centered = np.roll(u_centered, -1)\n            u_jm1_centered = np.roll(u_centered, 1)\n            term1 = sigma / 2.0 * (u_jp1_centered - u_jm1_centered)\n            term2 = sigma**2 / 2.0 * (u_jp1_centered - 2 * u_centered + u_jm1_centered)\n            u_centered = u_centered - term1 + term2\n\n            # Scheme 3: Hybrid High-Resolution TVD Scheme\n            u_jm1_hybrid = np.roll(u_hybrid, 1)\n            u_jp1_hybrid = np.roll(u_hybrid, -1)\n\n            # Calculate smoothness indicator r at cell interfaces\n            # Small epsilon to avoid division by zero\n            epsilon = 1e-12\n            \n            # Ratio for flux at interface j+1/2\n            grad_up = u_hybrid - u_jm1_hybrid\n            grad_down = u_jp1_hybrid - u_hybrid\n            r = np.divide(grad_up, grad_down, out=np.zeros_like(grad_up), where=np.abs(grad_down) > epsilon)\n\n            # Van Leer limiter phi(r)\n            phi = (r + np.abs(r)) / (1.0 + np.abs(r))\n            \n            # Low-order upwind flux at j+1/2 is c*u_j\n            F_low = c * u_hybrid\n            \n            # High-order Lax-Wendroff flux correction at j+1/2\n            F_corr = 0.5 * c * (1 - sigma) * (u_jp1_hybrid - u_hybrid)\n            \n            # Limited flux at j+1/2\n            F_jp12 = F_low + phi * F_corr\n            \n            # Flux at j-1/2 (by rolling the j+1/2 flux)\n            F_jm12 = np.roll(F_jp12, 1)\n            \n            u_hybrid = u_hybrid - (dt / dx) * (F_jp12 - F_jm12)\n\n\n        # Error Calculation\n        # Exact solution is a periodic translation\n        x_translated = (x - c * T_eff) % L\n        u_exact = u0_func(x_translated)\n\n        # Calculate normalized L1 error for each scheme\n        norm_exact = np.sum(np.abs(u_exact))\n        if norm_exact  epsilon:\n            norm_exact = 1.0 # Avoid division by zero for zero-solution\n\n        e1_upwind = np.sum(np.abs(u_upwind - u_exact)) / norm_exact\n        e1_centered = np.sum(np.abs(u_centered - u_exact)) / norm_exact\n        e1_hybrid = np.sum(np.abs(u_hybrid - u_exact)) / norm_exact\n        \n        return e1_upwind, e1_centered, e1_hybrid\n\n    # Test cases definition\n    L_val = 1.0\n    c_val = 1.0\n    T_val = L_val / c_val\n    \n    # Test case A: Smooth pulse\n    def u0_A(x):\n        x0, sigma_gauss = 0.3, 0.05\n        return np.exp(-(x - x0)**2 / (2 * sigma_gauss**2))\n\n    # Test case B: Discontinuous front (square wave)\n    def u0_B(x):\n        return np.where((x >= 0.25)  (x = 0.5), 1.0, 0.0)\n\n    # Test case C: Smooth wave (sine)\n    def u0_C(x):\n        return np.sin(2 * np.pi * x / L_val)\n\n    test_cases = [\n        # (N, CFL, u0_func)\n        (256, 0.5, u0_A),\n        (512, 0.95, u0_B),\n        (128, 0.2, u0_C),\n    ]\n\n    all_results = []\n    for N_val, cfl_val, u0_func in test_cases:\n        e1_up, e1_cen, e1_hyb = run_simulation(N_val, cfl_val, u0_func, L_val, c_val, T_val)\n        \n        # Calculate ratios, handle case where hybrid error is near zero\n        epsilon = 1e-12\n        if e1_hyb  epsilon:\n            r_up = np.inf if e1_up > epsilon else 1.0\n            r_cen = np.inf if e1_cen > epsilon else 1.0\n        else:\n            r_up = e1_up / e1_hyb\n            r_cen = e1_cen / e1_hyb\n        \n        all_results.extend([r_up, r_cen])\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}