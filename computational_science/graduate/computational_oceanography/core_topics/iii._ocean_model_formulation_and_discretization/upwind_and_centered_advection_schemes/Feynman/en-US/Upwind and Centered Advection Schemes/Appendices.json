{
    "hands_on_practices": [
        {
            "introduction": "A powerful tool for understanding the behavior of a numerical scheme is the modified equation analysis, which reveals the effective partial differential equation that the scheme actually solves. For the first-order upwind scheme, the leading truncation error term often manifests as a diffusion-like term, an effect known as numerical diffusion. This exercise guides you through the derivation of this numerical diffusion coefficient and challenges you to compare its magnitude to that of a physical diffusion process, a critical skill for assessing whether model errors are overwhelming the physics you intend to simulate .",
            "id": "3818146",
            "problem": "Consider a one-dimensional coastal tracer front advected by a uniform current. The tracer concentration $C(x,t)$ obeys the linear advection equation $\\partial_t C + u\\,\\partial_x C = 0$, where $u>0$ is a constant velocity. A sharp front is initialized at $t=0$ as a discontinuity across a single grid interface: $C(x,0) = C_{L}$ for $x<0$ and $C(x,0) = C_{R}$ for $x>0$, with $C_{L} \\neq C_{R}$. The numerical model uses a first-order upwind (backwards in space) discretization for advection and a forward Euler time stepping on a uniform grid with spacing $\\Delta x$. The time step $\\Delta t$ is chosen to yield a Courant–Friedrichs–Lewy (CFL) number $C = u\\,\\Delta t/\\Delta x$ in the stable range $0 < C \\leq 1$. The horizontal physical diffusivity is $\\kappa>0$, which, if present, would smear the front over a timescale set by diffusion.\n\nStarting from the continuous advection law and the stated discrete scheme, perform a leading-order modified equation analysis to identify the effective numerical diffusion coefficient $\\nu_{\\mathrm{num}}$ induced by the first-order upwind scheme. Using the diffusive front-smearing timescale $T \\sim L^{2}/\\nu$ with $L$ taken as the grid scale $L=\\Delta x$, compute the numerical smearing timescale $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$ and the physical smearing timescale $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$. Finally, evaluate the ratio $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$ for the parameters $u = 0.5\\,\\mathrm{m\\,s^{-1}}$, $\\Delta x = 500\\,\\mathrm{m}$, $C = 0.8$, and $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$.\n\nRound your final answer for $R$ to four significant figures. Because $R$ is dimensionless, no unit should be reported for the final answer.",
            "solution": "The user has provided a valid problem statement.\n\n### Step 1: Problem Validation\n#### Step 1.1: Extract Givens\n- **Governing Equation**: The tracer concentration $C(x,t)$ obeys the linear advection equation $\\partial_t C + u\\,\\partial_x C = 0$.\n- **Velocity**: $u>0$ is a constant velocity.\n- **Initial Condition**: A sharp front is given by $C(x,0) = C_{L}$ for $x<0$ and $C(x,0) = C_{R}$ for $x>0$, where $C_{L} \\neq C_{R}$.\n- **Numerical Scheme**:\n    - Time-stepping: Forward Euler.\n    - Spatial discretization: First-order upwind (backward in space, since $u>0$).\n- **Grid and Time Step**: The grid is uniform with spacing $\\Delta x$. The time step is $\\Delta t$.\n- **CFL Number**: The Courant–Friedrichs–Lewy (CFL) number is $C = u\\,\\Delta t/\\Delta x$, and it is in the stable range $0 < C \\leq 1$.\n- **Physical Diffusivity**: The horizontal physical diffusivity is $\\kappa>0$.\n- **Task 1**: Perform a leading-order modified equation analysis to find the effective numerical diffusion coefficient $\\nu_{\\mathrm{num}}$.\n- **Task 2**: Define the numerical smearing timescale as $T_{\\mathrm{num}} = \\Delta x^{2}/\\nu_{\\mathrm{num}}$ and the physical smearing timescale as $T_{\\mathrm{phys}} = \\Delta x^{2}/\\kappa$.\n- **Task 3**: Evaluate the ratio $R = T_{\\mathrm{num}}/T_{\\mathrm{phys}}$.\n- **Parameters for Evaluation**: $u = 0.5\\,\\mathrm{m\\,s^{-1}}$, $\\Delta x = 500\\,\\mathrm{m}$, $C = 0.8$, and $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$.\n- **Final Answer Format**: Round the value of $R$ to four significant figures.\n\n#### Step 1.2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It is based on fundamental principles of computational fluid dynamics, specifically the analysis of numerical schemes for the advection equation. The method requested, modified equation analysis, is a standard tool for quantifying the truncation error of a finite difference scheme in terms of an effective differential equation. All parameters and definitions are provided, making the problem self-contained and solvable for a unique answer. The provided physical parameters are realistic for a coastal oceanography context.\n\n#### Step 1.3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Step 2: Solution Derivation\nThe problem requires us to find the ratio of the numerical smearing timescale to the physical smearing timescale. This begins with a modified equation analysis to determine the numerical diffusion coefficient of the specified numerical scheme.\n\nThe governing continuous equation is the one-dimensional linear advection equation:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = 0\n$$\nwhere $u > 0$ is a constant velocity.\n\nThe numerical scheme uses a forward Euler method for the time derivative and a first-order upwind scheme for the spatial derivative. For $u > 0$, the upwind direction is backwards in space. Let $C_j^n$ denote the numerical approximation of $C(x_j, t_n)$ at grid point $x_j = j\\Delta x$ and time $t_n = n\\Delta t$. The discretized equation is:\n$$\n\\frac{C_j^{n+1} - C_j^n}{\\Delta t} + u \\frac{C_j^n - C_{j-1}^n}{\\Delta x} = 0\n$$\n\nTo perform the modified equation analysis, we use Taylor series expansions for $C_j^{n+1}$ and $C_{j-1}^n$ around the point $(x_j, t_n)$. All derivatives below are evaluated at this point.\n$$\nC_j^{n+1} = C(x_j, t_n + \\Delta t) = C + \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2!} \\frac{\\partial^2 C}{\\partial t^2} + O((\\Delta t)^3)\n$$\n$$\nC_{j-1}^n = C(x_j - \\Delta x, t_n) = C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2!} \\frac{\\partial^2 C}{\\partial x^2} - \\frac{(\\Delta x)^3}{3!} \\frac{\\partial^3 C}{\\partial x^3} + O((\\Delta x)^4)\n$$\n\nSubstituting these expansions into the discrete equation:\n$$\n\\frac{1}{\\Delta t} \\left( \\Delta t \\frac{\\partial C}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + \\frac{u}{\\Delta x} \\left( C - \\left( C - \\Delta x \\frac{\\partial C}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\dots \\right) \\right) = 0\n$$\nSimplifying this expression gives:\n$$\n\\left( \\frac{\\partial C}{\\partial t} + \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + \\dots \\right) + u \\left( \\frac{\\partial C}{\\partial x} - \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} + \\dots \\right) = 0\n$$\nRearranging the terms, we get an expression for the equation that the numerical scheme solves, which is the sum of the original PDE and the truncation error terms:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\frac{\\partial^2 C}{\\partial t^2} + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nTo find the leading-order modified equation, we need to express the time derivative $\\frac{\\partial^2 C}{\\partial t^2}$ in terms of spatial derivatives. We can do this by repeatedly differentiating the lowest-order equation, which is the original PDE, $\\frac{\\partial C}{\\partial t} = -u \\frac{\\partial C}{\\partial x}$.\nDifferentiating with respect to $t$:\n$$\n\\frac{\\partial^2 C}{\\partial t^2} = \\frac{\\partial}{\\partial t} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = -u \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial C}{\\partial t} \\right) = -u \\frac{\\partial}{\\partial x} \\left( -u \\frac{\\partial C}{\\partial x} \\right) = u^2 \\frac{\\partial^2 C}{\\partial x^2}\n$$\nSubstituting this back into the equation for the truncation error:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 C}{\\partial x^2} \\right) + u \\frac{\\Delta x}{2} \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nFactoring out a common term:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) \\frac{\\partial^2 C}{\\partial x^2} - \\text{H.O.T.}\n$$\nThe term in the parenthesis is the CFL number, $C = u \\Delta t / \\Delta x$. The leading-order modified equation is an advection-diffusion equation:\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = \\nu_{\\mathrm{num}} \\frac{\\partial^2 C}{\\partial x^2}\n$$\nBy comparison, the effective numerical diffusion coefficient is identified as:\n$$\n\\nu_{\\mathrm{num}} = \\frac{u \\Delta x}{2} (1 - C)\n$$\nThis is the answer to the first part of the problem.\n\nNext, we are asked to find the ratio $R$ of the numerical smearing timescale, $T_{\\mathrm{num}}$, to the physical smearing timescale, $T_{\\mathrm{phys}}$. These are defined as:\n$$\nT_{\\mathrm{num}} = \\frac{\\Delta x^2}{\\nu_{\\mathrm{num}}} \\quad \\text{and} \\quad T_{\\mathrm{phys}} = \\frac{\\Delta x^2}{\\kappa}\n$$\nThe ratio $R$ is therefore:\n$$\nR = \\frac{T_{\\mathrm{num}}}{T_{\\mathrm{phys}}} = \\frac{\\Delta x^2 / \\nu_{\\mathrm{num}}}{\\Delta x^2 / \\kappa} = \\frac{\\kappa}{\\nu_{\\mathrm{num}}}\n$$\nSubstituting the expression for $\\nu_{\\mathrm{num}}$:\n$$\nR = \\frac{\\kappa}{\\frac{u \\Delta x}{2} (1 - C)} = \\frac{2\\kappa}{u \\Delta x (1 - C)}\n$$\nNow, we substitute the given numerical values into this expression for $R$:\n- $u = 0.5\\,\\mathrm{m\\,s^{-1}}$\n- $\\Delta x = 500\\,\\mathrm{m}$\n- $C = 0.8$\n- $\\kappa = 100\\,\\mathrm{m^{2}\\,s^{-1}}$\n\nThe calculation proceeds as follows:\n$$\nR = \\frac{2 \\times 100}{(0.5) \\times 500 \\times (1 - 0.8)}\n$$\n$$\nR = \\frac{200}{250 \\times 0.2}\n$$\n$$\nR = \\frac{200}{50}\n$$\n$$\nR = 4\n$$\nThe problem requires the answer to be rounded to four significant figures. An integer like $4$ has one significant figure. To express this value with four significant figures, we write it as $4.000$.",
            "answer": "$$\\boxed{4.000}$$"
        },
        {
            "introduction": "Beyond identifying the *type* of error in a scheme, it is crucial to quantify its convergence rate—that is, how quickly the numerical solution approaches the exact solution as the grid is refined. This rate is known as the order of accuracy, a fundamental concept governed by the Lax-Richtmyer equivalence theorem for linear problems. In this practice, you will perform a formal truncation error analysis to determine the order of convergence for the donor-cell upwind scheme, solidifying your understanding of how to formally classify and evaluate numerical methods .",
            "id": "3818197",
            "problem": "Consider one-dimensional linear advection of a passive tracer governed by the partial differential equation (PDE) $\\partial_t u + c\\,\\partial_x u = 0$ on the periodic domain $x \\in [0,L]$ with a constant advection speed $c>0$, smooth initial data $u(x,0) \\in C^{3}([0,L])$, and a fixed final time $T>0$. The spatial grid is uniform with spacing $\\Delta x = L/M$ for some integer $M \\geq 4$, and the time step $\\Delta t$ is chosen so that the Courant–Friedrichs–Lewy (CFL) number $\\lambda = c\\,\\Delta t/\\Delta x$ is constant and equal to $\\lambda = 0.8$. The numerical scheme is the donor-cell upwind finite-volume discretization in flux form\n$$\nU_{j}^{n+1} \\;=\\; U_{j}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\,\\big(F_{j+\\frac{1}{2}}^{n} - F_{j-\\frac{1}{2}}^{n}\\big),\n$$\nwith $F_{j+\\frac{1}{2}}^{n} = c\\,U_{j}^{n}$ for $c>0$ and periodic indexing. The discrete error is $e_{j}^{n} = U_{j}^{n} - u(x_{j},t_{n})$ and its discrete $\\ell^{2}$ norm is defined by\n$$\n\\|e^{n}\\|_{2} \\;=\\; \\Big(\\Delta x \\sum_{j=0}^{M-1} \\big(e_{j}^{n}\\big)^{2}\\Big)^{\\frac{1}{2}}.\n$$\nAssume the exact solution $u$ remains in $C^{3}$ for $t \\in [0,T]$, and the donor-cell upwind scheme is $\\ell^{2}$-stable for the given $\\lambda$. Perform an analytic grid refinement study based on truncation error estimates to determine the order $p$ such that, for fixed $\\lambda=0.8$ and fixed $T$, the $\\ell^{2}$ error at time $T$ satisfies $\\|e^{N}\\|_{2} \\approx C\\,(\\Delta x)^{p}$ as $\\Delta x \\to 0$, where $N$ is the number of time steps with $N\\,\\Delta t = T$ and $C$ is independent of $\\Delta x$. Compute the single real number $p$. Express your final answer as a dimensionless number. No rounding is required.",
            "solution": "The problem is to determine the order of convergence, $p$, for the donor-cell upwind finite-volume scheme applied to the one-dimensional linear advection equation $\\partial_t u + c \\partial_x u = 0$. The order $p$ is defined by the relationship $\\|e^{N}\\|_{2} \\approx C(\\Delta x)^{p}$ for a fixed final time $T$, where $\\|e^{N}\\|_{2}$ is the discrete $\\ell^{2}$ norm of the error at time $T$.\n\nAccording to the Lax-Richtmyer equivalence theorem, for a consistent linear numerical scheme, stability is a necessary and sufficient condition for convergence. The problem states that the scheme is $\\ell^{2}$-stable for the given Courant–Friedrichs–Lewy (CFL) number $\\lambda = 0.8$. The scheme is also linear. Therefore, the order of convergence of the global error is determined by the order of the local truncation error.\n\nFirst, let us write the numerical scheme explicitly. The scheme is given in flux form as:\n$$\nU_{j}^{n+1} \\;=\\; U_{j}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\,\\big(F_{j+\\frac{1}{2}}^{n} - F_{j-\\frac{1}{2}}^{n}\\big)\n$$\nWith the upwind flux for $c>0$, we have $F_{j+\\frac{1}{2}}^{n} = c\\,U_{j}^{n}$ and consequently $F_{j-\\frac{1}{2}}^{n} = c\\,U_{j-1}^{n}$. Substituting these into the scheme gives:\n$$\nU_{j}^{n+1} = U_{j}^{n} - \\frac{\\Delta t}{\\Delta x}(c\\,U_{j}^{n} - c\\,U_{j-1}^{n})\n$$\nUsing the definition of the CFL number, $\\lambda = c\\,\\Delta t/\\Delta x$, the scheme becomes:\n$$\nU_{j}^{n+1} = U_{j}^{n} - \\lambda(U_{j}^{n} - U_{j-1}^{n})\n$$\nTo find the local truncation error, $\\tau_{j}^{n}$, we substitute the exact solution $u(x,t)$ into the discrete operator. Let $u_{j}^{n} = u(x_{j}, t_{n})$. Rearranging the scheme gives the discrete operator acting on $u$:\n$$\n\\tau_{j}^{n} = \\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x}\n$$\nWe perform Taylor series expansions of the terms in this expression around the point $(x_{j}, t_{n})$. The initial data is $u(x,0) \\in C^3$, and the solution remains in $C^3$, so these expansions are well-defined.\nThe expansion in time is:\n$$\nu_{j}^{n+1} = u(x_{j}, t_{n}+\\Delta t) = u(x_{j},t_{n}) + \\Delta t \\, \\frac{\\partial u}{\\partial t}\\bigg|_{(x_j,t_n)} + \\frac{(\\Delta t)^{2}}{2} \\, \\frac{\\partial^{2} u}{\\partial t^{2}}\\bigg|_{(x_j,t_n)} + O((\\Delta t)^{3})\n$$\nThe expansion in space is:\n$$\nu_{j-1}^{n} = u(x_{j}-\\Delta x, t_{n}) = u(x_{j},t_{n}) - \\Delta x \\, \\frac{\\partial u}{\\partial x}\\bigg|_{(x_j,t_n)} + \\frac{(\\Delta x)^{2}}{2} \\, \\frac{\\partial^{2} u}{\\partial x^{2}}\\bigg|_{(x_j,t_n)} + O((\\Delta x)^{3})\n$$\nSubstituting these expansions into the expression for $\\tau_{j}^{n}$:\n$$\n\\tau_{j}^{n} = \\frac{1}{\\Delta t}\\left(\\Delta t \\, u_{t} + \\frac{(\\Delta t)^{2}}{2} \\, u_{tt} + \\dots\\right) + \\frac{c}{\\Delta x}\\left(u - \\left(u - \\Delta x \\, u_{x} + \\frac{(\\Delta x)^{2}}{2} \\, u_{xx} + \\dots\\right)\\right)\n$$\nwhere all derivatives are evaluated at $(x_{j}, t_{n})$. Simplifying the expression:\n$$\n\\tau_{j}^{n} = \\left(u_{t} + \\frac{\\Delta t}{2}u_{tt} + \\dots\\right) + c\\left(u_{x} - \\frac{\\Delta x}{2}u_{xx} + \\dots\\right)\n$$\nGrouping the terms, we get:\n$$\n\\tau_{j}^{n} = (u_{t} + c\\,u_{x}) + \\frac{\\Delta t}{2}u_{tt} - c\\frac{\\Delta x}{2}u_{xx} + O((\\Delta t)^{2}, (\\Delta x)^{2})\n$$\nSince $u(x,t)$ is the exact solution to the PDE, the term $(u_{t} + c\\,u_{x})$ is identically zero. The leading terms of the truncation error are:\n$$\n\\tau_{j}^{n} = \\frac{\\Delta t}{2}u_{tt} - c\\frac{\\Delta x}{2}u_{xx} + \\text{H.O.T.}\n$$\nTo simplify this further, we use the PDE to express the time derivative $u_{tt}$ in terms of spatial derivatives. Differentiating $u_{t} = -c\\,u_{x}$ with respect to time gives $u_{tt} = -c\\,u_{xt}$. Assuming sufficient smoothness ($u \\in C^3$ as given), we can interchange the order of differentiation: $u_{xt} = u_{tx}$. Differentiating $u_t = -c u_x$ with respect to space gives $u_{tx} = -c u_{xx}$. Combining these, we find $u_{tt} = -c(-c\\,u_{xx}) = c^{2}u_{xx}$.\n\nSubstituting $u_{tt} = c^{2}u_{xx}$ into the truncation error expression:\n$$\n\\tau_{j}^{n} = \\frac{\\Delta t}{2}(c^{2}u_{xx}) - c\\frac{\\Delta x}{2}u_{xx} + \\text{H.O.T.} = \\frac{c u_{xx}}{2}(c\\,\\Delta t - \\Delta x) + \\text{H.O.T.}\n$$\nNow, we use the relation $\\lambda = c\\,\\Delta t/\\Delta x$, which implies $c\\,\\Delta t = \\lambda\\,\\Delta x$.\n$$\n\\tau_{j}^{n} = \\frac{c u_{xx}}{2}(\\lambda\\,\\Delta x - \\Delta x) + \\text{H.O.T.} = \\frac{c\\,\\Delta x}{2}(\\lambda - 1)u_{xx} + \\text{H.O.T.}\n$$\nThe problem specifies that $\\lambda = 0.8$. Since $\\lambda \\neq 1$ and we assume a non-trivial solution where $u_{xx}$ is not identically zero, the leading term of the truncation error is non-zero. The order of the truncation error is determined by the lowest power of $\\Delta x$ or $\\Delta t$. Since $\\Delta t = (\\lambda/c)\\Delta x$, $\\Delta t$ is proportional to $\\Delta x$. Thus, the truncation error is first order in both space and time:\n$$\n\\tau_{j}^{n} = O(\\Delta x, \\Delta t) = O(\\Delta x)\n$$\nThis demonstrates that the scheme is consistent and first-order accurate.\n\nBy the Lax-Richtmyer theorem, for this linear, stable, and consistent scheme, the global error at a fixed time $T$ converges at the same rate as the local truncation error. Thus, the pointwise error $e_{j}^{N} = U_{j}^{N} - u(x_j, T)$ is first order:\n$$\ne_{j}^{N} = O(\\Delta x)\n$$\nNow we must determine the order of convergence for the discrete $\\ell^{2}$ norm, $\\|e^{N}\\|_{2}$.\n$$\n\\|e^{N}\\|_{2}^{2} = \\Delta x \\sum_{j=0}^{M-1} (e_{j}^{N})^{2}\n$$\nSubstituting the order of the pointwise error:\n$$\n\\|e^{N}\\|_{2}^{2} = \\Delta x \\sum_{j=0}^{M-1} (O(\\Delta x))^{2} = \\Delta x \\sum_{j=0}^{M-1} O((\\Delta x)^{2})\n$$\nThe sum consists of $M$ terms, where $M = L/\\Delta x$.\n$$\n\\|e^{N}\\|_{2}^{2} = \\Delta x \\cdot M \\cdot O((\\Delta x)^{2}) = \\Delta x \\cdot \\left(\\frac{L}{\\Delta x}\\right) \\cdot O((\\Delta x)^{2}) = L \\cdot O((\\Delta x)^{2}) = O((\\Delta x)^{2})\n$$\nTaking the square root to find the norm:\n$$\n\\|e^{N}\\|_{2} = \\sqrt{O((\\Delta x)^{2})} = O(\\Delta x)\n$$\nThis shows that the $\\ell^{2}$ error converges linearly with $\\Delta x$. Therefore, the order of convergence $p$ is $1$.\n$$\n\\|e^{N}\\|_{2} \\approx C(\\Delta x)^{1}\n$$\nThe numerical value of $p$ is $1$.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "Theoretical analysis provides the foundation, but practical implementation reveals the true character of a numerical scheme, especially when faced with challenging conditions like discontinuities. Sharp fronts, such as coastal tracer boundaries or thermoclines, serve as powerful diagnostics for advection schemes. This hands-on coding exercise will allow you to directly observe the classic pathologies of basic schemes: the excessive smearing (numerical diffusion) of the upwind method and the spurious oscillations (numerical dispersion) of the centered-in-space method, and to quantify these behaviors using metrics like total variation .",
            "id": "3818209",
            "problem": "Consider the one-dimensional linear advection of a passive scalar in a periodic domain, governed by the partial differential equation $\\,\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\\,$, where $\\,c(x,t)\\,$ is the scalar concentration and $\\,u\\,$ is a constant advection velocity. The task is to examine, from first principles, the behavior of the centered-in-space explicit scheme versus the one-sided upwind scheme under a discontinuous initial condition, and to quantify the change in discrete total variation over a single time step. The Courant–Friedrichs–Lewy (CFL) number $\\,\\mathsf{C}\\,$ will be used to parameterize the time step and must be treated as dimensionless.\n\nYou must implement both discretizations on a uniform grid in a periodic domain $\\,x \\in [0,L)\\,$ with $\\,N\\,$ grid points, spacing $\\,\\Delta x = L/N\\,$, and a single time step $\\,\\Delta t\\,$ chosen to match a specified CFL number $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$. Use positive advection velocity $\\,u>0\\,$. For every case, apply periodic boundary conditions.\n\nDefine the discrete total variation at time level $\\,n\\,$ for the grid function $\\,\\{c_i^n\\}_{i=0}^{N-1}\\,$ as\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\nwith the convention $\\,c_{N}^n \\equiv c_0^n\\,$ due to periodicity. For a single explicit time step $\\,n \\to n+1\\,$, compute $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$ for each discretization scheme.\n\nUse a discrete step function initial condition with two plateau values $\\,c_L\\,$ and $\\,c_R\\,$ such that $\\,c_i^0 = c_L\\,$ for $\\,i < i_0\\,$ and $\\,c_i^0 = c_R\\,$ for $\\,i \\ge i_0\\,$, where $\\,i_0\\,$ is the index of the first grid point on the right plateau. The jump amplitude is $\\,\\Delta c = c_R - c_L\\,$. Throughout, take $\\,c_L = 0\\,$ and $\\,c_R = 1\\,$ (dimensionless). The domain length must be $\\,L = 100000\\,$ in meters, the number of grid points must be $\\,N = 128\\,$, and the advection velocity must be $\\,u = 0.5\\,$ in meters per second. Use the CFL number $\\,\\mathsf{C}\\,$ to compute the time step as $\\,\\Delta t = \\mathsf{C}\\,\\Delta x / u\\,$ in seconds.\n\nOscillations are to be diagnosed by the magnitude of violations of the initial bounds. Define the oscillation magnitude after one step as\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right),\n$$\nwhich is a nonnegative real number (dimensionless).\n\nImplement the canonical centered-in-space explicit scheme for $\\,u>0\\,$ and the canonical first-order upwind scheme for $\\,u>0\\,$. Apply exactly one time step for each scheme and compute $\\,\\Delta \\mathrm{TV}\\,$ for both schemes and $\\,\\mathcal{O}\\,$ for the centered scheme.\n\nYour program must evaluate the following test suite, specified by the pair $\\,(\\mathsf{C}, i_0)\\,$ for each case:\n\n- Case $\\,1\\,$: $\\,\\mathsf{C} = 0.0\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,2\\,$: $\\,\\mathsf{C} = 0.2\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,3\\,$: $\\,\\mathsf{C} = 0.5\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,4\\,$: $\\,\\mathsf{C} = 0.9\\,$, $\\,i_0 = 64\\,$.\n- Case $\\,5\\,$: $\\,\\mathsf{C} = 0.7\\,$, $\\,i_0 = 0\\,$.\n\nFor each case, produce a list $\\,\\left[\\Delta \\mathrm{TV}_{\\text{centered}},\\,\\Delta \\mathrm{TV}_{\\text{upwind}},\\,\\mathcal{O}_{\\text{centered}}\\right]\\,$ of three floating-point numbers. Your program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, where each element is itself a bracketed comma-separated list of three numbers, for example $\\,\\left[\\,[a,b,c],[d,e,f]\\,\\right]\\,$. All outputs are dimensionless; no physical units are required in the final output.",
            "solution": "The user has provided a valid problem.\n\nThe problem asks for an analysis of two numerical schemes, the centered-in-space explicit scheme and the first-order upwind scheme, applied to the one-dimensional linear advection equation. The analysis will be conducted by applying a single time step to a discontinuous initial condition and quantifying the resulting change in total variation and the emergence of oscillations.\n\nThe governing partial differential equation (PDE) is the linear advection equation for a scalar concentration $\\,c(x,t)\\,$ with a constant, positive velocity $\\,u\\,$:\n$$\n\\partial_t c(x,t) + u\\,\\partial_x c(x,t) = 0\n$$\nThe domain is periodic, $\\,x \\in [0,L)\\,$, with $\\,L=100000\\,$ m. The spatial domain is discretized into $\\,N=128\\,$ grid points, with a uniform grid spacing of $\\,\\Delta x = L/N\\,$. The time step, $\\,\\Delta t\\,$, is determined by the Courant–Friedrichs–Lewy (CFL) number, $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$.\n\nThe initial condition is a discrete step function:\n$$\nc_i^0 = \\begin{cases} c_L = 0 & \\text{if } i < i_0 \\\\ c_R = 1 & \\text{if } i \\ge i_0 \\end{cases}\n$$\nwhere $\\,i\\,$ is the grid point index.\n\nWe will first derive the finite difference equations for the two schemes, then analyze their behavior on the given initial condition to predict the diagnostic quantities.\n\n**1. Discretization Schemes**\n\nA generic explicit time-stepping scheme for the advection equation can be written from a forward-in-time discretization of $\\,\\partial_t c\\,$:\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} + u (\\partial_x c)_i^n = 0\n$$\nRearranging and using the definition of the CFL number $\\,\\mathsf{C} = u\\,\\Delta t / \\Delta x\\,$, we get the update formula:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x (\\partial_x c)_i^n\n$$\nwhere $\\,(\\partial_x c)_i^n\\,$ is the discrete approximation of the spatial derivative at grid point $\\,i\\,$ and time level $\\,n\\,$. The indices are handled periodically, such that $\\,c_{i-1}\\,$ at $\\,i=0\\,$ refers to $\\,c_{N-1}\\,$, and $\\,c_{i+1}\\,$ at $\\,i=N-1\\,$ refers to $\\,c_0\\,$.\n\n**Centered-in-Space Scheme:** The spatial derivative is approximated by a second-order centered difference:\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x}\n$$\nSubstituting this into the update formula gives:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_{i+1}^n - c_{i-1}^n}{2 \\Delta x} \\right) = c_i^n - \\frac{\\mathsf{C}}{2} (c_{i+1}^n - c_{i-1}^n)\n$$\nThis is the Forward-Time Centered-Space (FTCS) scheme, which is known to be unconditionally unstable for the pure advection problem but is well-defined for a single time step. Its leading-order truncation error is dispersive, which manifests as spurious oscillations.\n\n**First-Order Upwind Scheme:** For positive velocity $u>0$, the upwind direction is from the left (lower index). The spatial derivative is approximated by a first-order backward difference:\n$$\n(\\partial_x c)_i^n \\approx \\frac{c_i^n - c_{i-1}^n}{\\Delta x}\n$$\nSubstituting this into the update formula gives:\n$$\nc_i^{n+1} = c_i^n - \\mathsf{C} \\Delta x \\left( \\frac{c_i^n - c_{i-1}^n}{\\Delta x} \\right) = c_i^n - \\mathsf{C} (c_i^n - c_{i-1}^n) = (1-\\mathsf{C})c_i^n + \\mathsf{C}c_{i-1}^n\n$$\nThis scheme is known to be numerically dissipative and is stable for $0 \\le \\mathsf{C} \\le 1$.\n\n**2. Diagnostic Quantities and Theoretical Analysis**\n\nThe key diagnostics are the change in discrete total variation, $\\,\\Delta \\mathrm{TV} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^n\\,$, and the oscillation magnitude, $\\,\\mathcal{O}\\,$.\nThe discrete total variation is given by:\n$$\n\\mathrm{TV}^n = \\sum_{i=0}^{N-1} \\left|\\,c_{i+1}^n - c_i^n\\,\\right|\n$$\nThe oscillation magnitude is defined as:\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - \\max_i c_i^n,\\;\\; \\min_i c_i^n - \\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\nFor the given initial condition, $\\,\\max_i c_i^0 = 1\\,$ and $\\,\\min_i c_i^0 = 0\\,$, so this simplifies to:\n$$\n\\mathcal{O} = \\max\\!\\left( \\max_i c_i^{n+1} - 1,\\;\\; -\\min_i c_i^{n+1},\\;\\; 0 \\right)\n$$\n\n**Analysis for $\\,i_0 \\in (0, N)\\,$ (Cases 1-4):**\nThe initial condition has two jumps due to periodicity: one at index $\\,i_0\\,$ (from $\\,c_{i_0-1}^0=0\\,$ to $\\,c_{i_0}^0=1\\,$) and one at index $\\,0\\,$ (from $\\,c_{N-1}^0=1\\,$ to $\\,c_0^0=0\\,$).\nThe initial total variation is $\\,\\mathrm{TV}^0 = |c_{i_0}^0 - c_{i_0-1}^0| + |c_0^0 - c_{N-1}^0| + \\dots = |1-0| + |0-1| = 2\\,$.\n\nFor the **centered scheme**, the solution changes only near the two jumps. Let's analyze the jump at $\\,i_0\\,$:\n- At $\\,i=i_0-1\\,$: $\\,c_{i_0-1}^0=0, c_{i_0-2}^0=0, c_{i_0}^0=1\\,$.\n  $\\,c_{i_0-1}^{n+1} = c_{i_0-1}^n - \\frac{\\mathsf{C}}{2}(c_{i_0}^n - c_{i_0-2}^n) = 0 - \\frac{\\mathsf{C}}{2}(1 - 0) = -\\frac{\\mathsf{C}}{2}\\,$. This is an undershoot.\n- At $\\,i=i_0\\,$: $\\,c_{i_0}^0=1, c_{i_0-1}^0=0, c_{i_0+1}^0=1\\,$.\n  $\\,c_{i_0}^{n+1} = c_{i_0}^n - \\frac{\\mathsf{C}}{2}(c_{i_0+1}^n - c_{i_0-1}^n) = 1 - \\frac{\\mathsf{C}}{2}(1 - 0) = 1 - \\frac{\\mathsf{C}}{2}\\,$.\nSymmetrically, near the other jump (at index 0):\n- At $\\,i=N-1\\,$: $\\,c_{N-1}^0=1, c_{N-2}^0=1, c_0^0=0\\,$.\n  $\\,c_{N-1}^{n+1} = c_{N-1}^n - \\frac{\\mathsf{C}}{2}(c_{0}^n - c_{N-2}^n) = 1 - \\frac{\\mathsf{C}}{2}(0 - 1) = 1 + \\frac{\\mathsf{C}}{2}\\,$. This is an overshoot.\nThe new extrema are $\\,\\max_i c_i^{n+1} = 1 + \\mathsf{C}/2\\,$ and $\\,\\min_i c_i^{n+1} = -\\mathsf{C}/2\\,$.\nThe oscillation magnitude is $\\,\\mathcal{O}_{\\text{centered}} = \\max((1+\\mathsf{C}/2) - 1, -(-\\mathsf{C}/2), 0) = \\mathsf{C}/2\\,$.\nThe new total variation is the sum of local jumps: $\\,\\mathrm{TV}^{n+1} = 2 \\times (|\\frac{-\\mathsf{C}}{2}| + |(1-\\frac{\\mathsf{C}}{2}) - (\\frac{-\\mathsf{C}}{2})| + |1 - (1-\\frac{\\mathsf{C}}{2})|) = 2 \\times (\\frac{\\mathsf{C}}{2} + 1 + \\frac{\\mathsf{C}}{2}) = 2 + 2\\mathsf{C}\\,$.\nTherefore, $\\,\\Delta \\mathrm{TV}_{\\text{centered}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = (2+2\\mathsf{C}) - 2 = 2\\mathsf{C}\\,$.\n\nFor the **upwind scheme**, which is a monotone scheme for $0 \\le \\mathsf{C} \\le 1$, it is known to be Total Variation Diminishing (TVD), meaning $\\,\\mathrm{TV}^{n+1} \\le \\mathrm{TV}^n\\,$. Let's verify for the step function.\n- At $\\,i=i_0\\,$: $\\,c_{i_0}^0=1, c_{i_0-1}^0=0\\,$.\n  $\\,c_{i_0}^{n+1} = (1-\\mathsf{C})c_{i_0}^n + \\mathsf{C}c_{i_0-1}^n = (1-\\mathsf{C})(1) + \\mathsf{C}(0) = 1-\\mathsf{C}\\,$.\n- At $\\,i=0\\,$: $\\,c_{0}^0=0, c_{N-1}^0=1\\,$.\n  $\\,c_{0}^{n+1} = (1-\\mathsf{C})c_{0}^n + \\mathsf{C}c_{N-1}^n = (1-\\mathsf{C})(0) + \\mathsf{C}(1) = \\mathsf{C}\\,$.\nAll other values remain unchanged where their left neighbor had the same value. The new profile has gradients smeared across two points at each jump. The new TV is $\\,\\mathrm{TV}^{n+1} = |(1-\\mathsf{C})-0| + |1 - (1-\\mathsf{C})| + |\\mathsf{C}-1| + |0-\\mathsf{C}| = (1-\\mathsf{C}) + \\mathsf{C} + (1-\\mathsf{C}) + \\mathsf{C} = 2\\,$.\nThus, $\\,\\Delta \\mathrm{TV}_{\\text{upwind}} = \\mathrm{TV}^{n+1} - \\mathrm{TV}^0 = 2 - 2 = 0\\,$. This scheme does not generate new oscillations, so $\\,\\max_i c_i^{n+1} \\in [0,1]\\,$ and $\\,\\min_i c_i^{n+1} \\in [0,1]\\,$.\n\n**Analysis for $\\,i_0 = 0\\,$ (Case 5):**\nIf $\\,i_0 = 0\\,$, the condition $\\,i<i_0\\,$ is never met, so the initial condition is $\\,c_i^0=c_R=1\\,$ for all $\\,i\\,$. The field is constant.\nTherefore, $\\,c_{i+1}^0 - c_{i-1}^0 = 0\\,$ and $\\,c_i^0 - c_{i-1}^0 = 0\\,$ for all $\\,i\\,$.\nBoth schemes yield $\\,c_i^{n+1} = c_i^n = 1\\,$. The state does not evolve.\n$\\mathrm{TV}^0 = 0\\,$, $\\mathrm{TV}^1 = 0\\,$, so $\\,\\Delta \\mathrm{TV} = 0\\,$ for both schemes.\nThe solution remains bounded by $\\,[1, 1]\\,$, so $\\,\\mathcal{O}=0\\,$.\n\n**Summary of Predictions:**\n- Case 1: ($\\,\\mathsf{C}=0, i_0=64\\,$) $\\implies [\\Delta\\mathrm{TV}_c, \\Delta\\mathrm{TV}_u, \\mathcal{O}_c] = [2(0), 0, 0/2] = [0.0, 0.0, 0.0]$\n- Case 2: ($\\,\\mathsf{C}=0.2, i_0=64\\,$) $\\implies [2(0.2), 0, 0.2/2] = [0.4, 0.0, 0.1]$\n- Case 3: ($\\,\\mathsf{C}=0.5, i_0=64\\,$) $\\implies [2(0.5), 0, 0.5/2] = [1.0, 0.0, 0.25]$\n- Case 4: ($\\,\\mathsf{C}=0.9, i_0=64\\,$) $\\implies [2(0.9), 0, 0.9/2] = [1.8, 0.0, 0.45]$\n- Case 5: ($\\,\\mathsf{C}=0.7, i_0=0\\,$) $\\implies [0.0, 0.0, 0.0]$\n\nThe implementation will follow these derivations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in total variation and oscillation magnitude for two\n    advection schemes over one time step for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (CFL number, index i0 of the step)\n        (0.0, 64),\n        (0.2, 64),\n        (0.5, 64),\n        (0.9, 64),\n        (0.7, 0),\n    ]\n\n    # Global parameters as defined in the problem\n    L = 100000.0  # Domain length in meters\n    N = 128       # Number of grid points\n    u = 0.5       # Advection velocity in m/s\n    c_L = 0.0     # Left plateau value (dimensionless)\n    c_R = 1.0     # Right plateau value (dimensionless)\n\n    results = []\n    \n    for case in test_cases:\n        C, i0 = case\n\n        # 1. Setup the initial condition\n        c0 = np.full(N, c_R, dtype=float)\n        if i0 > 0:\n            c0[:i0] = c_L\n\n        # 2. Calculate initial Total Variation (TV^n)\n        # Periodicity is handled by np.roll\n        tv0 = np.sum(np.abs(np.roll(c0, -1) - c0))\n\n        # 3. Apply one time step for both schemes\n        \n        # Pre-calculate rolled arrays for periodic boundaries\n        c0_im1 = np.roll(c0, 1)  # c_{i-1}\n        c0_ip1 = np.roll(c0, -1) # c_{i+1}\n        \n        # Centered-in-space scheme\n        c1_centered = c0 - (C / 2.0) * (c0_ip1 - c0_im1)\n        \n        # First-order upwind scheme (for u > 0)\n        c1_upwind = c0 - C * (c0 - c0_im1)\n\n        # 4. Calculate metrics for the centered scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_centered = np.sum(np.abs(np.roll(c1_centered, -1) - c1_centered))\n        delta_tv_centered = tv1_centered - tv0\n        \n        # Oscillation magnitude (O)\n        max_c0 = np.max(c0)\n        min_c0 = np.min(c0)\n        max_c1_centered = np.max(c1_centered)\n        min_c1_centered = np.min(c1_centered)\n        \n        o_centered = np.max([\n            max_c1_centered - max_c0, \n            min_c0 - min_c1_centered, \n            0.0\n        ])\n\n        # 5. Calculate metrics for the upwind scheme\n        \n        # Change in Total Variation (delta_TV)\n        tv1_upwind = np.sum(np.abs(np.roll(c1_upwind, -1) - c1_upwind))\n        delta_tv_upwind = tv1_upwind - tv0\n        \n        # 6. Store results for the current case\n        results.append([delta_tv_centered, delta_tv_upwind, o_centered])\n\n    # 7. Final print statement in the exact required format.\n    # The output should be a single line: [[a,b,c],[d,e,f],...]\n    output_str = \",\".join(f\"[{r[0]},{r[1]},{r[2]}]\" for r in results)\n    print(f\"[{output_str}]\")\n\nsolve()\n\n```"
        }
    ]
}