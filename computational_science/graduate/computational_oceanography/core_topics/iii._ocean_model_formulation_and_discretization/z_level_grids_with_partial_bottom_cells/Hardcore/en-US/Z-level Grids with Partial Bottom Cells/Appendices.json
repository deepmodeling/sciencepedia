{
    "hands_on_practices": [
        {
            "introduction": "To build robust ocean models, we must first master the fundamentals of grid discretization. This initial exercise focuses on the essential geometric task of defining a partial bottom cell. By calculating the thickness and fractional size of the bottom-most grid cell for a given water depth, you will solidify your understanding of how a z-level grid with partial bottom cells accurately represents the bathymetry, a foundational skill for any computational oceanographer. ",
            "id": "3819515",
            "problem": "A three-dimensional ocean model employs a fixed vertical coordinate with depth levels of constant thickness, commonly called a z-level grid. To avoid systematic mismatches between the discrete grid and the continuous bathymetry, many models include a partial bottom cell that closes the remainder of the water column beneath the deepest full level. Consider a single water column whose bathymetric depth is $H$, discretized by $N_{\\mathrm{full}}$ full cells of uniform thickness $\\Delta z_{\\mathrm{full}}$, plus one partial bottom cell. The defining relationships for this representation are that the continuous water-column height equals the sum of the discrete layer thicknesses and that the bottom cell fraction $f$ is the ratio of the partial cell thickness to the full-cell thickness. From these principles, determine the bottom-cell fraction $f$ and the bottom-cell thickness $\\Delta z_{b}$ for the case $H=2375\\,\\mathrm{m}$, $\\Delta z_{\\mathrm{full}}=100\\,\\mathrm{m}$, and $N_{\\mathrm{full}}=23$. Then, using the constraints that the partial bottom cell must satisfy $0 \\le f  1$ in a z-level grid with partial bottom cells, provide a justification for whether an additional full level should or should not be included at this location.\n\nExpress the bottom cell thickness in meters and the fraction $f$ as a unitless number. No rounding is required; provide exact values.",
            "solution": "The problem is valid as it is scientifically grounded in the established practices of computational oceanography, is well-posed with sufficient and consistent information, and is stated objectively.\n\nThe problem asks for the determination of the partial bottom cell thickness, $\\Delta z_{b}$, and its corresponding fraction, $f$, for a z-level grid, and for a justification regarding the number of full grid cells.\n\nThe fundamental principle provided is that the total bathymetric depth, $H$, is exactly represented by the sum of the thicknesses of all discrete vertical cells. This water column is composed of $N_{\\mathrm{full}}$ full cells of uniform thickness $\\Delta z_{\\mathrm{full}}$ and one partial bottom cell of thickness $\\Delta z_{b}$. This relationship can be expressed mathematically as:\n$$H = (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}}) + \\Delta z_{b}$$\n\nWe are given the following values:\nTotal depth, $H = 2375 \\, \\mathrm{m}$.\nThickness of a full cell, $\\Delta z_{\\mathrm{full}} = 100 \\, \\mathrm{m}$.\nNumber of full cells, $N_{\\mathrm{full}} = 23$.\n\nFirst, we calculate the total thickness of the full cells:\n$$N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 23 \\times 100 \\, \\mathrm{m} = 2300 \\, \\mathrm{m}$$\n\nNext, we can solve for the thickness of the partial bottom cell, $\\Delta z_{b}$, by rearranging the first equation:\n$$\\Delta z_{b} = H - (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}})$$\nSubstituting the known values:\n$$\\Delta z_{b} = 2375 \\, \\mathrm{m} - 2300 \\, \\mathrm{m} = 75 \\, \\mathrm{m}$$\n\nThe second principle provided defines the bottom cell fraction, $f$, as the ratio of the partial cell thickness to the full-cell thickness:\n$$f = \\frac{\\Delta z_{b}}{\\Delta z_{\\mathrm{full}}}$$\nUsing the calculated value for $\\Delta z_{b}$ and the given value for $\\Delta z_{\\mathrm{full}}$:\n$$f = \\frac{75 \\, \\mathrm{m}}{100 \\, \\mathrm{m}} = 0.75$$\nThis value is unitless, as required.\n\nThe second part of the problem requires a justification for whether an additional full level should be included, given the constraint $0 \\leq f  1$.\n\nIn a z-level grid formulation, the number of full cells, $N_{\\mathrm{full}}$, is not an arbitrary choice. It is determined by the total depth $H$ and the full-cell thickness $\\Delta z_{\\mathrm{full}}$. Specifically, $N_{\\mathrm{full}}$ must be the largest integer number of full cells that can fit within the total depth. This is mathematically expressed using the floor function:\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{H}{\\Delta z_{\\mathrm{full}}} \\right\\rfloor$$\nLet's verify this for the given case:\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{2375}{100} \\right\\rfloor = \\lfloor 23.75 \\rfloor = 23$$\nThis confirms that the given value $N_{\\mathrm{full}} = 23$ is the correct one for this discretization scheme.\n\nThe constraint $0 \\leq f  1$ is a direct consequence of this definition of $N_{\\mathrm{full}}$. By definition of the floor function, for any real number $x$, we have $\\lfloor x \\rfloor \\leq x  \\lfloor x \\rfloor + 1$. Applying this with $x = H / \\Delta z_{\\mathrm{full}}$:\n$$N_{\\mathrm{full}} \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}}  N_{\\mathrm{full}} + 1$$\nSubtracting $N_{\\mathrm{full}}$ from all parts of the inequality gives:\n$$0 \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}  1$$\nRecognizing that $f = \\frac{\\Delta z_{b}}{\\Delta z_{\\mathrm{full}}} = \\frac{H - N_{\\mathrm{full}}\\Delta z_{\\mathrm{full}}}{\\Delta z_{\\mathrm{full}}} = \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}$, we see that the constraint is mathematically guaranteed:\n$$0 \\leq f  1$$\nOur calculated value $f=0.75$ correctly falls within this range.\n\nTo address the question of adding an additional full level, let us consider the hypothetical case where we set the number of full levels to $N'_{\\mathrm{full}} = N_{\\mathrm{full}} + 1 = 23 + 1 = 24$.\nThe total thickness of these $24$ full cells would be:\n$$N'_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 24 \\times 100 \\, \\mathrm{m} = 2400 \\, \\mathrm{m}$$\nThis discretized depth ($2400 \\, \\mathrm{m}$) is greater than the actual bathymetric depth ($H = 2375 \\, \\mathrm{m}$). This is a physically impossible scenario, as it would mean the model's seafloor is below the real seafloor, with the bottom grid cell extending into the solid earth.\n\nTherefore, an additional full level should not, and indeed cannot, be included. The number of full levels is fixed at $23$ by the geophysical parameters of the problem. The configuration with $N_{\\mathrm{full}}=23$ and a partial bottom cell of thickness $75 \\, \\mathrm{m}$ (with $f=0.75$) is the only valid discretization for this water column under the specified model rules.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.75  75\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having established the geometry of partial bottom cells, we now explore their dynamical importance. This practice delves into the primary reason for their use: the significant reduction of spurious horizontal pressure gradient errors that plague traditional staircase-like z-level models. By analytically deriving the magnitude of this error, you will see precisely how the partial bottom cell formulation leads to a more physically accurate representation of quiescent fluids over sloping topography. ",
            "id": "3819508",
            "problem": "Consider a hydrostatic ocean model on a $z$-level grid with Partial Bottom Cells (PBC). Two adjacent vertical columns share the same free-surface elevation $\\eta$ and the same number $N \\in \\mathbb{N}$ of full cells, each of uniform thickness $\\Delta z$. In each column, the bottom-most fluid layer is a partial cell of thickness $h_i = f_i \\Delta z$, where $f_i \\in (0,1]$ is the fractional thickness in column $i$ for $i \\in \\{1,2\\}$. The horizontal grid spacing between the two columns is $\\Delta x$. The density is constant, $\\rho = \\rho_0$, and gravitational acceleration is constant, $g$. Assume the pressure gauge is chosen such that $p(\\eta) = 0$.\n\nThe discrete horizontal pressure gradient at the center of the bottom-most layer is computed by a centered finite difference of the hydrostatic pressures evaluated at the centers of the bottom cells in the two columns, i.e., $(p_1 - p_2)/\\Delta x$.\n\nStarting only from the hydrostatic balance and these grid definitions, derive a closed-form expression for the magnitude of the spurious discrete horizontal pressure gradient at the bottom, $|(p_1 - p_2)/\\Delta x|$, in terms of $\\rho_0$, $g$, $\\Delta z$, $\\Delta x$, and $f_1, f_2$. Then, for comparison, consider a full-cell staircase representation of the same bathymetric contrast in which one column instead has one additional full $z$-level at the bottom (so the centers of the bottom-most cells in the two columns are offset by exactly $\\Delta z$). Use this to identify the reduction factor of the PBC-induced mismatch relative to the full-cell mismatch and explain how it depends on $|f_1 - f_2|$.\n\nExpress the final pressure gradient magnitude in Pascal per meter $(\\mathrm{Pa}\\ \\mathrm{m}^{-1})$. Your final answer must be a single closed-form analytic expression; do not provide intermediate steps or an equation for the reduction factor in the final answer.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is based on fundamental principles of fluid dynamics (hydrostatic balance) and standard numerical methods in computational oceanography. All necessary information is provided, and the objective is clearly stated. We may proceed with the solution.\n\nThe problem requires the derivation of the magnitude of a spurious horizontal pressure gradient that arises from the discretization of bathymetry in a $z$-level ocean model using Partial Bottom Cells (PBC).\n\nFirst, we establish the physical principle and coordinate system. The ocean is assumed to be hydrostatic, meaning the pressure $p$ at any depth is determined by the weight of the water column above it. The governing equation is the hydrostatic balance:\n$$\n\\frac{dp}{dz} = -\\rho_0 g\n$$\nwhere $z$ is the vertical coordinate (positive upwards), $\\rho_0$ is the constant water density, and $g$ is the gravitational acceleration. We are given that the pressure at the free surface, $z=\\eta$, is zero, i.e., $p(\\eta) = 0$. Integrating the hydrostatic equation from a coordinate $z$ up to $\\eta$ yields:\n$$\n\\int_{p(z)}^{p(\\eta)} dp' = \\int_{z}^{\\eta} (-\\rho_0 g) dz'\n$$\n$$\np(\\eta) - p(z) = -\\rho_0 g (\\eta - z)\n$$\nGiven $p(\\eta)=0$, the pressure at any vertical coordinate $z$ is:\n$$\np(z) = \\rho_0 g (\\eta - z)\n$$\nTo simplify the geometry, we can set the origin of the vertical axis at the free surface, such that $\\eta = 0$. The pressure equation simplifies to $p(z) = -\\rho_0 g z$ for $z \\le 0$.\n\nNext, we define the vertical grid structure for each column $i \\in \\{1, 2\\}$. Each column has $N$ full cells of uniform thickness $\\Delta z$ below the free surface, and a partial cell at the very bottom.\nThe $N$ full cells occupy the vertical range from $z=0$ down to $z=-N \\Delta z$.\nThe bottom-most cell in column $i$ is a partial cell of thickness $h_i = f_i \\Delta z$, where $f_i \\in (0, 1]$. This partial cell occupies the vertical range from $z = -N \\Delta z$ to $z = -N \\Delta z - h_i = -(N + f_i)\\Delta z$.\n\nThe problem states that the discrete pressure gradient is computed using pressures evaluated at the centers of these bottom cells. Let's find the vertical coordinate, $z_{c,i}$, of the center of the bottom cell in column $i$. The center is the midpoint of its vertical extent:\n$$\nz_{c,i} = \\frac{(-N \\Delta z) + (-(N+f_i)\\Delta z)}{2} = -\\frac{2N + f_i}{2}\\Delta z = -\\left(N + \\frac{f_i}{2}\\right)\\Delta z\n$$\nNow, we can calculate the hydrostatic pressure, $p_i$, at the center of the bottom cell in each column $i \\in \\{1, 2\\}$ using the pressure formula $p(z) = -\\rho_0 g z$:\nFor column $1$:\n$$\np_1 = p(z_{c,1}) = -\\rho_0 g z_{c,1} = -\\rho_0 g \\left[-\\left(N + \\frac{f_1}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z\n$$\nFor column $2$:\n$$\np_2 = p(z_{c,2}) = -\\rho_0 g z_{c,2} = -\\rho_0 g \\left[-\\left(N + \\frac{f_2}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\nThe pressure difference between the two cell centers is:\n$$\np_1 - p_2 = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z - \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n$$\np_1 - p_2 = \\rho_0 g \\Delta z \\left[\\left(N + \\frac{f_1}{2}\\right) - \\left(N + \\frac{f_2}{2}\\right)\\right] = \\rho_0 g \\Delta z \\left(\\frac{f_1 - f_2}{2}\\right)\n$$\nThe problem asks for the magnitude of the discrete horizontal pressure gradient, which is defined as $|(p_1 - p_2)/\\Delta x|$, where $\\Delta x$ is the horizontal distance between the column centers.\n$$\n\\left|\\frac{p_1 - p_2}{\\Delta x}\\right| = \\left|\\frac{\\rho_0 g \\Delta z (f_1 - f_2)}{2 \\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|\n$$\nThis is the closed-form expression for the magnitude of the spurious pressure gradient in a PBC model. This gradient is spurious because it arises even in a resting fluid ($\\eta=\\text{constant}$) solely due to the grid's representation of the bathymetry. Ideally, for a fluid at rest, the horizontal pressure gradient should be zero everywhere.\n\nFor comparison, we consider a full-cell staircase representation. The problem specifies that in this case, one column has one additional full cell, leading to a vertical offset of exactly $\\Delta z$ between the centers of the bottom-most cells. Let column $1$ have $K$ cells and column $2$ have $K+1$ cells.\nThe center of the bottom cell in column $1$ is at $z_{c,1,stair} = -(K - 1/2)\\Delta z$.\nThe center of the bottom cell in column $2$ is at $z_{c,2,stair} = -((K+1) - 1/2)\\Delta z = -(K + 1/2)\\Delta z$.\nThe pressure difference is $p_{1,stair} - p_{2,stair}$:\n$$\np_{1,stair} - p_{2,stair} = \\rho_0 g (K - 1/2)\\Delta z - \\rho_0 g (K + 1/2)\\Delta z = \\rho_0 g \\Delta z (K - 1/2 - K - 1/2) = -\\rho_0 g \\Delta z\n$$\nThe magnitude of the spurious pressure gradient in the staircase model is:\n$$\n\\left|\\frac{p_{1,stair} - p_{2,stair}}{\\Delta x}\\right| = \\left|\\frac{-\\rho_0 g \\Delta z}{\\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{\\Delta x}\n$$\nThe reduction factor of the PBC-induced error relative to the full-cell staircase error is the ratio of their magnitudes:\n$$\n\\text{Reduction Factor} = \\frac{\\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|}{\\frac{\\rho_0 g \\Delta z}{\\Delta x}} = \\frac{1}{2}|f_1 - f_2|\n$$\nThis factor demonstrates the principal advantage of the PBC method. The spurious pressure gradient is proportional to $|f_1 - f_2|$, the difference in the fractional thicknesses of the bottom cells. Since $f_1, f_2 \\in (0, 1]$, $|f_1-f_2|$ is in the range $[0, 1)$. Therefore, the PBC error is always less than half the staircase error (which occurs for $|f_1-f_2| \\to 1$) and is significantly smaller when the bathymetry slope is gentle, such that adjacent partial cells have similar thicknesses ($|f_1-f_2| \\ll 1$). In the ideal case of a flat bottom, $f_1=f_2$, and the PBC method correctly yields a zero spurious pressure gradient, unlike the staircase model which would still produce an error unless the bottom aligns perfectly with a grid level. The error in the staircase model is of order $\\mathcal{O}(\\rho_0 g \\Delta z / \\Delta x)$, whereas the PBC error is of order $\\mathcal{O}(\\rho_0 g \\Delta z |f_1-f_2| / \\Delta x)$, representing a substantial improvement in accuracy.",
            "answer": "$$\n\\boxed{\\frac{\\rho_0 g \\Delta z |f_1 - f_2|}{2 \\Delta x}}\n$$"
        },
        {
            "introduction": "The final step is to transition from analytical theory to computational verification. This exercise challenges you to design and implement a numerical experiment that directly quantifies the errors discussed previously. By programming a test case with a sloping bottom, you will measure the spurious velocities that arise from both a simple staircase grid and a grid with partial bottom cells, providing a concrete and powerful demonstration of the practical benefits of this advanced discretization technique. ",
            "id": "3819489",
            "problem": "You must write a complete, runnable program that constructs a two-dimensional vertical plane ocean slice in the horizontal coordinate $x$ with a linearly sloping bottom and uniform density, and then quantifies spurious pressure gradient errors that arise from a deliberately hydrostatically inconsistent diagnostic discretization, comparing the case without Partial Bottom Cells (PBC) to the case with Partial Bottom Cells (PBC). The setting is a $z$-level grid: the vertical coordinate $z$ is discretized with uniform thickness $\\Delta z$, with cell centers at depths $z_k = -(k - \\tfrac{1}{2}) \\Delta z$, $k = 1,2,\\dots$. The sea surface is fixed at $z = 0$, and the ocean bottom depth is prescribed as $D(x) = D_0 + s x$, where $D_0$ is a positive reference depth and $s$ is the constant slope in meters per meter.\n\nThe foundation is the hydrostatic balance $dp/dz = -\\rho g$, where $p$ is pressure, $\\rho$ is density, and $g$ is gravitational acceleration. With uniform density $\\rho(x,z) = \\rho_0$ and constant sea surface height, the exact continuous horizontal pressure gradient at any fixed $z$ is zero: $\\partial p / \\partial x = 0$. A hydrostatically consistent discrete horizontal pressure gradient at fixed $z$ would also yield zero under uniform density. However, to quantify hydrostatic inconsistency associated with terraced bathymetry and the use of vertical sums in $z$-level models, this problem requires you to evaluate a deliberately inconsistent diagnostic operator for the face acceleration that uses differences of column-integrated hydrostatic pressure. This operator is defined as\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right),\n$$\nwhere $i$ indexes vertical columns at horizontal positions $x_i$, $\\Delta x$ is the horizontal grid spacing, and $I_i$ is the discrete column integral of hydrostatic pressure in column $i$:\n$$\nI_i = \\sum_{k\\in \\text{wet}} p(z_k)\\,\\Delta z_k.\n$$\nUnder uniform density and hydrostatic balance with $p(z) = \\rho_0 g(-z)$, the exact continuous integral is $I(x) = \\tfrac{1}{2}\\rho_0 g D(x)^2$, but the discrete $z$-level approximation depends on how the bottom is represented.\n\nYou must implement two discrete column integrals:\n- Without Partial Bottom Cells (no-PBC): the bottom is represented by a terrace whose depth is a multiple of $\\Delta z$. If $N_i = \\lfloor D_i/\\Delta z\\rfloor$ is the number of fully wet cells, then\n$$\nI_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2.\n$$\n- With Partial Bottom Cells (PBC): the bottom cell thickness is fractional so the column integral recovers the continuous exact value,\n$$\nI_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D_i^2.\n$$\n\nUsing $a_{i+\\frac{1}{2}}$ computed from $I_i^{\\mathrm{noPBC}}$ and $I_i^{\\mathrm{PBC}}$ respectively, define the spurious face velocities at time $T$ by\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T,\n$$\nwith initial condition $u_{i+\\frac{1}{2}}(0) = 0$ and no other forces. Define the diagnostic metrics:\n- The $L^2$ norm of the spurious velocity field at faces,\n$$\n\\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2},\n$$\nwhere $N_f$ is the number of faces.\n- The mean energy growth rate per unit mass,\n$$\n\\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}}.\n$$\n\nYou must compute $\\|u\\|_2$ in meters per second and $\\gamma$ in meters squared per second cubed. The implementation must be self-contained and use the exact values of $I_i^{\\mathrm{noPBC}}$ and $I_i^{\\mathrm{PBC}}$ given above for the two configurations. Density $\\rho_0$ and gravitational acceleration $g$ must be treated as given constants with $\\rho_0$ in kilograms per cubic meter and $g$ in meters per second squared.\n\nConstruct the horizontal grid with $N_x$ columns uniformly spaced over length $L$. Use $x_i = (i-1)\\Delta x$ for $i=1,\\dots,N_x$, with $\\Delta x = L/(N_x-1)$, and faces at $i+\\tfrac{1}{2}$ for $i=1,\\dots,N_x-1$.\n\nYour program must compute the diagnostics for the following four test cases, which together form the test suite:\n1. Happy path moderate slope: $N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 10^{-6}\\,\\mathrm{m/m}$, $\\Delta z = 10\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$.\n2. Boundary condition (flat bottom): $N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 0\\,\\mathrm{m/m}$, $\\Delta z = 10\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$.\n3. Coarse vertical resolution with steeper slope: $N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 5\\times 10^{-6}\\,\\mathrm{m/m}$, $\\Delta z = 50\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$.\n4. Shorter domain with relatively steep slope: $N_x = 51$, $L = 50000\\,\\mathrm{m}$, $D_0 = 300\\,\\mathrm{m}$, $s = 2\\times 10^{-5}\\,\\mathrm{m/m}$, $\\Delta z = 25\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$.\n\nFor each test case, output a list of four floating-point numbers:\n- $\\|u\\|_2$ without PBC,\n- $\\|u\\|_2$ with PBC,\n- $\\gamma$ without PBC,\n- $\\gamma$ with PBC.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of four numbers in the order specified above. For example, the final line should look like $[\\,[a_1,b_1,c_1,d_1],\\,[a_2,b_2,c_2,d_2],\\,[a_3,b_3,c_3,d_3],\\,[a_4,b_4,c_4,d_4]\\,]$, with all values in the specified units.",
            "solution": "The user-provided problem has been validated and is determined to be a well-posed, scientifically grounded problem in computational oceanography. We will proceed with a full solution.\n\nThe problem requires a quantitative analysis of spurious pressure gradient errors in a simplified ocean model using a `$z$-level vertical coordinate system over a sloping bottom. In a continuous fluid with uniform density $\\rho_0$ at rest, the hydrostatic pressure is given by $p(z) = \\rho_0 g (-z)$, assuming the sea surface is at $z=0$ and pressure there is zero. The horizontal pressure gradient, $\\partial p / \\partial x$, is consequently zero everywhere, implying no horizontal motion should be generated. Numerical models, however, can produce spurious motions due to discretization errors, particularly in the presence of complex bathymetry. This problem investigates such errors.\n\nThe model domain is a two-dimensional vertical slice in the $(x,z)$ plane. The horizontal coordinate $x$ is discretized into $N_x$ columns with uniform spacing $\\Delta x = L/(N_x-1)$, where $L$ is the domain length. The grid column centers are at $x_i = (i-1)\\Delta x$ for $i=1, 2, \\dots, N_x$. The vertical discretization is a `$z$-level grid with uniform layer thickness $\\Delta z$. The bottom depth is a linear function of position, $D(x) = D_0 + s x$, where $D_0$ is the depth at $x=0$ and $s$ is the constant slope.\n\nThe core of the problem lies in evaluating a specific diagnostic operator for horizontal acceleration, which is deliberately formulated to be hydrostatically inconsistent. This operator acts on the interface (face) between two adjacent water columns, indexed $i$ and $i+1$, and is defined as:\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right)\n$$\nHere, $I_i$ represents the discrete column integral of hydrostatic pressure. This operator approximates the negative horizontal gradient of the integrated pressure, $-\\partial I/\\partial x$. A fully consistent formulation of the vertically integrated horizontal pressure gradient force would also account for the pressure acting on the sloping bottom, a term this operator omits. Its non-zero value, even in a state that should be at rest, is a measure of numerical error.\n\nWe must compare two different representations of the bathymetry and their impact on the pressure integral $I_i$:\n1.  **Without Partial Bottom Cells (no-PBC)**: The bottom is represented by a \"staircase\" or \"terrace\" approximation. The depth of a column $i$ is taken to be $H_i = N_i \\Delta z$, where $N_i = \\lfloor D(x_i)/\\Delta z\\rfloor$ is the number of full grid cells that are \"wet\". The vertically integrated pressure is then calculated for this terraced depth:\n    $$\n    I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2\n    $$\n    This formulation is exact for the terraced bathymetry. Errors will be localized at the \"steps\" where $N_i$ changes.\n\n2.  **With Partial Bottom Cells (PBC)**: The model conceptually allows the bottom-most cell to have a fractional thickness, such that the total water depth of the column, $D(x_i)$, is perfectly represented. The pressure integral is then the exact continuous integral over the true depth:\n    $$\n    I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D(x_i)^2\n    $$\n    While this represents the geometry perfectly, the diagnostic operator $a_{i+\\frac{1}{2}}$ is still inconsistent and will produce a non-zero, spatially varying spurious acceleration.\n\nFrom the computed accelerations $a_{i+\\frac{1}{2}}$, we find the spurious horizontal velocity at the faces after a short time $T$, assuming the system starts from rest:\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T\n$$\nTo quantify the error, two metrics are computed:\n- The $L^2$ norm of the spurious velocity field, which measures the overall magnitude of the error:\n  $$\n  \\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2}\n  $$\n  where $N_f = N_x - 1$ is the number of faces.\n- The mean rate of spurious kinetic energy generation per unit mass, which measures the rate at which the numerical scheme creates artificial energy:\n  $$\n  \\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}} = \\frac{T}{N_f}\\sum_{i=1}^{N_f} a_{i+\\frac{1}{2}}^2\n  $$\n\nThe computational procedure for each test case is as follows:\n1.  Define the physical and numerical parameters: $N_x, L, D_0, s, \\Delta z, T, \\rho_0, g$.\n2.  Construct the horizontal grid: compute $\\Delta x = L/(N_x-1)$ and the array of positions $x_i$ for $i=1, \\dots, N_x$.\n3.  Calculate the true water depth $D_i = D(x_i)$ at each grid point.\n4.  For the no-PBC case:\n    a. Determine the number of wet cells $N_i = \\lfloor D_i / \\Delta z \\rfloor$ for each column.\n    b. Compute the integrated pressure $I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\rho_0 g (N_i \\Delta z)^2$.\n5.  For the PBC case:\n    a. Compute the integrated pressure $I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\rho_0 g D_i^2$.\n6.  For both cases, compute the acceleration field $a_{i+\\frac{1}{2}}$ for $i=1, \\dots, N_x-1$ using the specified finite difference operator.\n7.  Calculate the velocity field $u_{i+\\frac{1}{2}} = a_{i+\\frac{1}{2}} T$.\n8.  Compute and store the diagnostics $\\|u\\|_2$ and $\\gamma$ for both no-PBC and PBC cases.\n\nA critical test is the case with a flat bottom ($s=0$). Here, $D(x_i)$ is constant, meaning $N_i$ is also constant. Consequently, $I_{i+1} - I_i = 0$ for both no-PBC and PBC methods, resulting in zero acceleration, velocity, and energy growth. This provides a necessary sanity check for the implementation. For sloping cases ($s \\neq 0$), we expect non-zero errors. The no-PBC case will exhibit errors concentrated at terrace steps, while the PBC case will have a smoother error profile.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious pressure gradient errors for z-level ocean models with\n    and without Partial Bottom Cells (PBC).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # 1. Happy path moderate slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 1e-6, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 2. Boundary condition (flat bottom)\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 0.0, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 3. Coarse vertical resolution with steeper slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 5e-6, 'dz': 50.0,\n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 4. Shorter domain with relatively steep slope\n        {'Nx': 51, 'L': 50000.0, 'D0': 300.0, 's': 2e-5, 'dz': 25.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        # Unpack parameters\n        Nx = params['Nx']\n        L = params['L']\n        D0 = params['D0']\n        s = params['s']\n        dz = params['dz']\n        T = params['T']\n        rho0 = params['rho0']\n        g = params['g']\n        \n        # 1. Set up horizontal grid\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n        \n        # 2. Calculate true bottom depth at each grid column center\n        D = D0 + s * x\n        \n        # --- NO-PBC Calculation ---\n        \n        # 3a. Determine number of full wet cells and compute terraced depth\n        N_no_pbc = np.floor(D / dz)\n\n        # 4a. Compute column-integrated pressure for no-PBC\n        I_no_pbc = 0.5 * rho0 * g * (N_no_pbc * dz)**2\n        \n        # 5a. Compute diagnostic accelerations at faces\n        a_no_pbc = -1.0 / (rho0 * dx) * (I_no_pbc[1:] - I_no_pbc[:-1])\n        \n        # 6a. Compute spurious velocities\n        u_no_pbc = a_no_pbc * T\n        \n        # --- PBC Calculation ---\n        \n        # 3b. (Not needed, depth is continuous)\n        \n        # 4b. Compute column-integrated pressure for PBC using true depth\n        I_pbc = 0.5 * rho0 * g * D**2\n        \n        # 5b. Compute diagnostic accelerations at faces\n        a_pbc = -1.0 / (rho0 * dx) * (I_pbc[1:] - I_pbc[:-1])\n        \n        # 6b. Compute spurious velocities\n        u_pbc = a_pbc * T\n        \n        # --- Diagnostic Metrics ---\n        \n        Nf = Nx - 1\n        \n        # L2 norm of velocity\n        u_norm_no_pbc = np.sqrt(np.sum(u_no_pbc**2) / Nf)\n        u_norm_pbc = np.sqrt(np.sum(u_pbc**2) / Nf)\n        \n        # Mean energy growth rate per unit mass\n        gamma_no_pbc = np.sum(u_no_pbc * a_no_pbc) / Nf\n        gamma_pbc = np.sum(u_pbc * a_pbc) / Nf\n        \n        # Append results for this case\n        case_results = [\n            u_norm_no_pbc,\n            u_norm_pbc,\n            gamma_no_pbc,\n            gamma_pbc,\n        ]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) correctly formats the list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}