{
    "hands_on_practices": [
        {
            "introduction": "首先，我们必须掌握部分底单元（partial bottom cells）的基本几何定义。本练习  提供了一个直接的计算任务，要求您根据总水深和标准网格分辨率，确定部分底单元的厚度及其分数表示。掌握这一基础计算是在z-level模型中准确表示海底地形的第一步。",
            "id": "3819515",
            "problem": "一个三维海洋模型采用固定的垂直坐标，其深度层具有恒定的厚度，通常称为z层网格。为了避免离散网格与连续海底地形之间的系统性不匹配，许多模型包含一个部分底层单元，该单元封闭了最深完整层之下剩余的水体。考虑一个单一水柱，其海底地形深度为 $H$，通过 $N_{\\mathrm{full}}$ 个厚度均匀为 $\\Delta z_{\\mathrm{full}}$ 的完整单元和一个部分底层单元进行离散化。此表示的定义关系是：连续水柱的高度等于离散层厚度之和，且底层单元分数 $f$ 是部分单元厚度与完整单元厚度之比。根据这些原理，对于 $H=2375\\,\\mathrm{m}$，$\\Delta z_{\\mathrm{full}}=100\\,\\mathrm{m}$ 和 $N_{\\mathrm{full}}=23$ 的情况，确定底层单元分数 $f$ 和底层单元厚度 $\\Delta z_{N}$。然后，利用在带有部分底层单元的z层网格中，部分底层单元必须满足 $0 \\le f  1$ 的约束条件，为在该位置是否应包含一个额外的完整层提供理由。\n\n底层单元的厚度以米为单位表示，分数 $f$ 为无量纲数。无需四舍五入；请提供精确值。",
            "solution": "该问题是有效的，因为它在科学上基于计算海洋学的既定实践，问题提出得当，信息充分且一致，并且陈述客观。\n\n问题要求确定z层网格的部分底层单元厚度 $\\Delta z_{N}$ 及其对应的分数 $f$，并对完整网格单元的数量给出理由。\n\n所提供的基本原理是，总海底地形深度 $H$ 完全由所有离散垂直单元的厚度之和表示。该水柱由 $N_{\\mathrm{full}}$ 个厚度均匀为 $\\Delta z_{\\mathrm{full}}$ 的完整单元和一个厚度为 $\\Delta z_{N}$ 的部分底层单元组成。这种关系可以用数学方式表示为：\n$$H = (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}}) + \\Delta z_{N}$$\n\n我们已知以下数值：\n总深度, $H = 2375 \\, \\mathrm{m}$。\n完整单元的厚度, $\\Delta z_{\\mathrm{full}} = 100 \\, \\mathrm{m}$。\n完整单元的数量, $N_{\\mathrm{full}} = 23$。\n\n首先，我们计算完整单元的总厚度：\n$$N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 23 \\times 100 \\, \\mathrm{m} = 2300 \\, \\mathrm{m}$$\n\n接下来，我们可以通过重新整理第一个方程来求解部分底层单元的厚度 $\\Delta z_{N}$：\n$$\\Delta z_{N} = H - (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}})$$\n代入已知值：\n$$\\Delta z_{N} = 2375 \\, \\mathrm{m} - 2300 \\, \\mathrm{m} = 75 \\, \\mathrm{m}$$\n\n所提供的第二个原理将底层单元分数 $f$ 定义为部分单元厚度与完整单元厚度之比：\n$$f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}}$$\n使用计算出的 $\\Delta z_{N}$ 值和给定的 $\\Delta z_{\\mathrm{full}}$ 值：\n$$f = \\frac{75 \\, \\mathrm{m}}{100 \\, \\mathrm{m}} = 0.75$$\n该值为无量纲数，符合要求。\n\n问题的第二部分要求在给定约束条件 $0 \\le f  1$ 的情况下，就是否应包含一个额外的完整层提供理由。\n\n在z层网格的构建中，完整单元的数量 $N_{\\mathrm{full}}$ 不是一个任意的选择。它由总深度 $H$ 和完整单元厚度 $\\Delta z_{\\mathrm{full}}$ 决定。具体来说，$N_{\\mathrm{full}}$ 必须是能够容纳在总深度内的最大完整单元整数数量。这可以用向下取整函数在数学上表示为：\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{H}{\\Delta z_{\\mathrm{full}}} \\right\\rfloor$$\n让我们对给定情况进行验证：\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{2375}{100} \\right\\rfloor = \\lfloor 23.75 \\rfloor = 23$$\n这证实了给定的值 $N_{\\mathrm{full}} = 23$ 对于此离散化方案是正确的。\n\n约束条件 $0 \\le f  1$ 是 $N_{\\mathrm{full}}$ 这个定义的直接结果。根据向下取整函数的定义，对于任意实数 $x$，我们有 $\\lfloor x \\rfloor \\leq x  \\lfloor x \\rfloor + 1$。将此应用于 $x = H / \\Delta z_{\\mathrm{full}}$：\n$$N_{\\mathrm{full}} \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}}  N_{\\mathrm{full}} + 1$$\n从不等式的所有部分减去 $N_{\\mathrm{full}}$，得到：\n$$0 \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}  1$$\n认识到 $f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}} = \\frac{H - N_{\\mathrm{full}}\\Delta z_{\\mathrm{full}}}{\\Delta z_{\\mathrm{full}}} = \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}$，我们看到该约束在数学上是保证成立的：\n$$0 \\leq f  1$$\n我们计算出的值 $f=0.75$ 正好落在此范围内。\n\n为了回答是否增加一个额外完整层的问题，我们考虑一个假设情况，即我们将完整层的数量设置为 $N'_{\\mathrm{full}} = N_{\\mathrm{full}} + 1 = 23 + 1 = 24$。\n这24个完整单元的总厚度将是：\n$$N'_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 24 \\times 100 \\, \\mathrm{m} = 2400 \\, \\mathrm{m}$$\n这个离散化后的深度（$2400 \\, \\mathrm{m}$）大于实际的海底地形深度（$H = 2375 \\, \\mathrm{m}$）。这是一个物理上不可能的情景，因为它意味着模型的“海底”位于真实海底之下，底部的网格单元延伸到了固态地球中。\n\n因此，不应该，也确实不能包含一个额外的完整层。完整层的数量由问题的地球物理参数固定为23。在指定的模型规则下，对于这个水柱，$N_{\\mathrm{full}}=23$ 且部分底层单元厚度为 $75 \\, \\mathrm{m}$ (其中 $f=0.75$) 的配置是唯一有效的离散化方案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.75  75\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在建立了基本几何概念后，我们现在来探讨使用部分底单元的关键动力学动机：减少虚假的水平压力梯度误差。这个理论练习  将引导您推导在阶梯状地形和部分底单元模型中这些人为误差的大小。通过完成这一推导，您将深刻理解部分底单元如何提高海洋模拟的物理真实性。",
            "id": "3819508",
            "problem": "考虑一个在 $z$ 层网格上采用部分底层单元 (PBC) 的静水海洋模型。两个相邻的垂直列共享相同的自由表面高程 $\\eta$ 和相同数量 $N \\in \\mathbb{N}$ 的完整单元，每个单元的厚度均为 $\\Delta z$。在每一列中，最底部的流体层是一个厚度为 $h_i = f_i \\Delta z$ 的部分单元，其中 $f_i \\in (0,1]$ 是第 $i$ 列（$i \\in \\{1,2\\}$）的分数厚度。两列之间的水平网格间距为 $\\Delta x$。密度为常数 $\\rho = \\rho_0$，重力加速度为常数 $g$。假设选择的压力计使得 $p(\\eta) = 0$。\n\n最底层中心的离散水平压力梯度是通过对两列中底层单元中心处计算的静水压力进行中心有限差分来计算的，即 $(p_1 - p_2)/\\Delta x$。\n\n仅从静水平衡和这些网格定义出发，推导底部虚假离散水平压力梯度大小 $|(p_1 - p_2)/\\Delta x|$ 的一个闭式表达式，用 $\\rho_0$, $g$, $\\Delta z$, $\\Delta x$ 以及 $f_1, f_2$ 表示。然后，为了比较，考虑相同水深对比度的全单元阶梯表示，其中一列在底部额外增加一个完整的 $z$ 层（因此两列中最底层单元的中心恰好偏移了 $\\Delta z$）。利用此结果，确定由 PBC 引起的失配相对于全单元失配的减小因子，并解释它如何依赖于 $|f_1 - f_2|$。\n\n将最终的压力梯度大小以帕斯卡每米 $(\\mathrm{Pa}\\ \\mathrm{m}^{-1})$ 表示。您的最终答案必须是一个单一的闭式解析表达式；不要在最终答案中提供中间步骤或减小因子的方程。",
            "solution": "该问题经验证是科学合理的、提法恰当且客观的。它基于流体动力学基本原理（静水平衡）和计算海洋学中的标准数值方法。所有必要信息均已提供，目标明确。我们可以开始求解。\n\n该问题要求推导在使用部分底层单元 (PBC) 的 $z$ 层海洋模型中，由于水深离散化而产生的虚假水平压力梯度的大小。\n\n首先，我们建立物理原理和坐标系。海洋被假定为静水的，这意味着任何深度的压力 $p$ 由其上方水柱的重量决定。控制方程为静水平衡：\n$$\n\\frac{dp}{dz} = -\\rho_0 g\n$$\n其中 $z$ 是垂直坐标（向上为正），$\\rho_0$ 是恒定的水密度， $g$ 是重力加速度。我们已知自由表面 $z=\\eta$ 处的压力为零，即 $p(\\eta) = 0$。将静水方程从坐标 $z$ 积分到 $\\eta$ 可得：\n$$\n\\int_{p(z)}^{p(\\eta)} dp' = \\int_{z}^{\\eta} (-\\rho_0 g) dz'\n$$\n$$\np(\\eta) - p(z) = -\\rho_0 g (\\eta - z)\n$$\n给定 $p(\\eta)=0$，任意垂直坐标 $z$ 处的压力为：\n$$\np(z) = \\rho_0 g (\\eta - z)\n$$\n为简化几何结构，我们可以将垂直轴的原点设置在自由表面，使得 $\\eta = 0$。压力方程简化为 $p(z) = -\\rho_0 g z$（对于 $z \\le 0$）。\n\n接下来，我们定义每一列 $i \\in \\{1, 2\\}$ 的垂直网格结构。每列在自由表面下有 $N$ 个厚度均匀为 $\\Delta z$ 的完整单元，并在最底部有一个部分单元。\n$N$ 个完整单元占据从 $z=0$ 到 $z=-N \\Delta z$ 的垂直范围。\n第 $i$ 列中最底部的单元是一个厚度为 $h_i = f_i \\Delta z$ 的部分单元，其中 $f_i \\in (0, 1]$。这个部分单元占据从 $z = -N \\Delta z$ 到 $z = -N \\Delta z - h_i = -(N + f_i)\\Delta z$ 的垂直范围。\n\n问题指出，离散压力梯度是使用在这些底层单元中心处评估的压力来计算的。我们来求第 $i$ 列中底层单元中心的垂直坐标 $z_{c,i}$。中心是其垂直范围的中点：\n$$\nz_{c,i} = \\frac{(-N \\Delta z) + (-(N+f_i)\\Delta z)}{2} = -\\frac{2N + f_i}{2}\\Delta z = -\\left(N + \\frac{f_i}{2}\\right)\\Delta z\n$$\n现在，我们可以使用压力公式 $p(z) = -\\rho_0 g z$ 计算每列 $i \\in \\{1, 2\\}$ 中底层单元中心的静水压力 $p_i$：\n对于第 1 列：\n$$\np_1 = p(z_{c,1}) = -\\rho_0 g z_{c,1} = -\\rho_0 g \\left[-\\left(N + \\frac{f_1}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z\n$$\n对于第 2 列：\n$$\np_2 = p(z_{c,2}) = -\\rho_0 g z_{c,2} = -\\rho_0 g \\left[-\\left(N + \\frac{f_2}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n两个单元中心之间的压力差为：\n$$\np_1 - p_2 = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z - \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n$$\np_1 - p_2 = \\rho_0 g \\Delta z \\left[\\left(N + \\frac{f_1}{2}\\right) - \\left(N + \\frac{f_2}{2}\\right)\\right] = \\rho_0 g \\Delta z \\left(\\frac{f_1 - f_2}{2}\\right)\n$$\n问题要求离散水平压力梯度的大小，其定义为 $|(p_1 - p_2)/\\Delta x|$，其中 $\\Delta x$ 是列中心之间的水平距离。\n$$\n\\left|\\frac{p_1 - p_2}{\\Delta x}\\right| = \\left|\\frac{\\rho_0 g \\Delta z (f_1 - f_2)}{2 \\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|\n$$\n这就是 PBC 模型中虚假压力梯度大小的闭式表达式。这个梯度是虚假的，因为它即使在静止流体（$\\eta=\\text{constant}$）中也会仅仅因为网格对水深的表示而产生。理想情况下，对于静止的流体，水平压力梯度应处处为零。\n\n为了比较，我们考虑一个全单元阶梯表示。问题指明，在这种情况下，一列会多出一个完整的单元，导致最底层单元中心之间存在恰好为 $\\Delta z$ 的垂直偏移。假设第 1 列有 $K$ 个单元，第 2 列有 $K+1$ 个单元。\n第 1 列中底层单元的中心位于 $z_{c,1,stair} = -(K - 1/2)\\Delta z$。\n第 2 列中底层单元的中心位于 $z_{c,2,stair} = -((K+1) - 1/2)\\Delta z = -(K + 1/2)\\Delta z$。\n压力差为 $p_{1,stair} - p_{2,stair}$：\n$$\np_{1,stair} - p_{2,stair} = \\rho_0 g (K - 1/2)\\Delta z - \\rho_0 g (K + 1/2)\\Delta z = \\rho_0 g \\Delta z (K - 1/2 - K - 1/2) = -\\rho_0 g \\Delta z\n$$\n阶梯模型中虚假压力梯度的大小为：\n$$\n\\left|\\frac{p_{1,stair} - p_{2,stair}}{\\Delta x}\\right| = \\left|\\frac{-\\rho_0 g \\Delta z}{\\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{\\Delta x}\n$$\n由 PBC 引起的误差相对于全单元阶梯误差的减小因子是它们大小的比值：\n$$\n\\text{减小因子} = \\frac{\\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|}{\\frac{\\rho_0 g \\Delta z}{\\Delta x}} = \\frac{1}{2}|f_1 - f_2|\n$$\n这个因子证明了 PBC 方法的主要优点。虚假压力梯度与 $|f_1 - f_2|$ 成正比，即底层单元分数厚度的差值。由于 $f_1, f_2 \\in (0, 1]$， $|f_1-f_2|$ 的范围在 $[0, 1)$ 内。因此，PBC 误差总是小于阶梯误差的一半（当 $|f_1-f_2| \\to 1$ 时发生），并且当水深坡度平缓，使得相邻部分单元的厚度相似（$|f_1-f_2| \\ll 1$）时，该误差会显著减小。在平坦底部的理想情况下，$f_1=f_2$，PBC 方法正确地产生零虚假压力梯度，而阶梯模型除非底部与网格层完美对齐，否则仍会产生误差。阶梯模型中的误差量级为 $\\mathcal{O}(\\rho_0 g \\Delta z / \\Delta x)$，而 PBC 误差的量级为 $\\mathcal{O}(\\rho_0 g \\Delta z |f_1-f_2| / \\Delta x)$，这代表了精度的显著提高。",
            "answer": "$$\n\\boxed{\\frac{\\rho_0 g \\Delta z |f_1 - f_2|}{2 \\Delta x}}\n$$"
        },
        {
            "introduction": "最后，我们将理论与实践相结合，设计一个数值验证实验。这项高级练习  要求您编写程序来模拟一个倾斜的海底，并定量地测量由不同网格表示方法产生的虚假海流。这项任务体现了计算科学中的一项核心技能：设计一个简洁的测试案例来验证数值方法的准确性并量化其优势。",
            "id": "3819489",
            "problem": "您必须编写一个完整的、可运行的程序，该程序在水平坐标 $x$ 上构建一个具有线性倾斜海底和均匀密度的二维垂直平面海洋切片，然后量化由故意设计的静力不一致诊断离散化引起的虚假压强梯度误差，并比较不使用部分底单元 (PBC) 的情况与使用部分底单元 (PBC) 的情况。设置为一个 $z$ 层网格：垂直坐标 $z$ 以均匀厚度 $\\Delta z$ 进行离散化，单元中心位于深度 $z_k = -(k - \\tfrac{1}{2}) \\Delta z$，$k = 1,2,\\dots$。海面固定在 $z = 0$ 处，海底深度规定为 $D(x) = D_0 + s x$，其中 $D_0$ 是一个正的参考深度，$s$ 是以米/米为单位的恒定坡度。\n\n其基础是静力平衡 $dp/dz = -\\rho g$，其中 $p$ 是压强，$\\rho$ 是密度，$g$ 是重力加速度。在密度均匀 $\\rho(x,z) = \\rho_0$ 且海面高度恒定的情况下，任何固定 $z$ 处的精确连续水平压强梯度均为零：$\\partial p / \\partial x = 0$。一个静力一致的离散水平压强梯度在均匀密度下也应为零。然而，为了量化与阶梯状测深和在 $z$ 层模型中使用垂直求和相关的静力不一致性，本问题要求您评估一个故意设计的、用于计算面加速度的不一致诊断算子，该算子使用柱积分静力压强的差值。该算子定义为\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right),\n$$\n其中 $i$ 是水平位置 $x_i$ 处垂直柱的索引，$\\Delta x$ 是水平网格间距，$I_i$ 是第 $i$ 柱中静力压强的离散柱积分：\n$$\nI_i = \\sum_{k\\in \\text{wet}} p(z_k)\\,\\Delta z_k.\n$$\n在均匀密度和静力平衡条件下，$p(z) = \\rho_0 g(-z)$，精确的连续积分为 $I(x) = \\tfrac{1}{2}\\rho_0 g D(x)^2$，但离散的 $z$ 层近似值取决于海底的表示方式。\n\n您必须实现两种离散柱积分：\n- 不使用部分底单元 (no-PBC)：海底由一个深度为 $\\Delta z$ 倍数的阶梯表示。如果 $N_i = \\lfloor D_i/\\Delta z\\rfloor$ 是完全湿单元的数量，则\n$$\nI_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2.\n$$\n- 使用部分底单元 (PBC)：底部单元的厚度是分数的，因此柱积分可以恢复连续的精确值，\n$$\nI_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D_i^2.\n$$\n\n分别使用从 $I_i^{\\mathrm{noPBC}}$ 和 $I_i^{\\mathrm{PBC}}$ 计算出的 $a_{i+\\frac{1}{2}}$，将时间 $T$ 时的虚假面速度定义为\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T,\n$$\n初始条件为 $u_{i+\\frac{1}{2}}(0) = 0$ 且无其他力。定义诊断指标：\n- 面上虚假速度场的 $L^2$ 范数，\n$$\n\\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2},\n$$\n其中 $N_f$ 是面的数量。\n- 单位质量的平均能量增长率，\n$$\n\\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}}.\n$$\n\n您必须计算 $\\|u\\|_2$（单位为米/秒）和 $\\gamma$（单位为米²/秒³）。实现必须是自包含的，并对两种配置使用上面给出的 $I_i^{\\mathrm{noPBC}}$ 和 $I_i^{\\mathrm{PBC}}$ 的精确值。密度 $\\rho_0$ 和重力加速度 $g$ 必须作为给定常数处理，$\\rho_0$ 的单位是千克/立方米，$g$ 的单位是米/秒²。\n\n构建具有 $N_x$ 个柱的水平网格，这些柱在长度 $L$ 上均匀分布。对于 $i=1,\\dots,N_x$，使用 $x_i = (i-1)\\Delta x$，其中 $\\Delta x = L/(N_x-1)$，面位于 $i+\\tfrac{1}{2}$ 处，对于 $i=1,\\dots,N_x-1$。\n\n您的程序必须为以下四个测试用例计算诊断指标，这些测试用例共同构成测试套件：\n1. 正常路径，中等坡度：$N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 10^{-6}\\,\\mathrm{m/m}$, $\\Delta z = 10\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$。\n2. 边界条件 (平坦海底)：$N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 0\\,\\mathrm{m/m}$, $\\Delta z = 10\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$。\n3. 粗垂直分辨率，较陡坡度：$N_x = 201$, $L = 100000\\,\\mathrm{m}$, $D_0 = 1000\\,\\mathrm{m}$, $s = 5\\times 10^{-6}\\,\\mathrm{m/m}$, $\\Delta z = 50\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$。\n4. 较短域，相对陡峭的坡度：$N_x = 51$, $L = 50000\\,\\mathrm{m}$, $D_0 = 300\\,\\mathrm{m}$, $s = 2\\times 10^{-5}\\,\\mathrm{m/m}$, $\\Delta z = 25\\,\\mathrm{m}$, $T = 60\\,\\mathrm{s}$, $\\rho_0 = 1025\\,\\mathrm{kg/m^3}$, $g = 9.81\\,\\mathrm{m/s^2}$。\n\n对于每个测试用例，输出一个包含四个浮点数的列表：\n- 不含 PBC 的 $\\|u\\|_2$,\n- 含 PBC 的 $\\|u\\|_2$,\n- 不含 PBC 的 $\\gamma$,\n- 含 PBC 的 $\\gamma$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，并且本身是按上述顺序排列的四个数字的列表。例如，最后一行应类似于 $[\\,[a_1,b_1,c_1,d_1],\\,[a_2,b_2,c_2,d_2],\\,[a_3,b_3,c_3,d_3],\\,[a_4,b_4,c_4,d_4]\\,]$，所有值均使用指定单位。",
            "solution": "用户提供的问题已经过验证，被确定为一个定义明确、具有科学依据的计算海洋学问题。我们将提供完整的解决方案。\n\n该问题要求在一个简化的海洋模型中，对使用 $z$ 层垂直坐标系并在倾斜海底上产生的虚假压强梯度误差进行定量分析。在静止的、密度均匀为 $\\rho_0$ 的连续流体中，假设海面位于 $z=0$ 且该处压强为零，则静力压强由 $p(z) = \\rho_0 g (-z)$ 给出。因此，水平压强梯度 $\\partial p / \\partial x$ 处处为零，这意味着不应产生水平运动。然而，数值模型由于离散化误差，可能会产生虚假运动，尤其是在存在复杂测深的情况下。本问题旨在研究此类误差。\n\n模型区域是 $(x,z)$ 平面中的一个二维垂直切片。水平坐标 $x$ 被离散化为 $N_x$ 个柱，间距均匀，为 $\\Delta x = L/(N_x-1)$，其中 $L$ 是区域长度。网格柱中心位于 $x_i = (i-1)\\Delta x$，其中 $i=1, 2, \\dots, N_x$。垂直离散化采用的是具有均匀层厚 $\\Delta z$ 的 $z$ 层网格。海底深度是位置的线性函数，$D(x) = D_0 + s x$，其中 $D_0$ 是 $x=0$ 处的深度，$s$ 是恒定坡度。\n\n问题的核心在于评估一个用于水平加速度的特定诊断算子，该算子被特意构造为静力不一致的。该算子作用于两个相邻水柱（索引为 $i$ 和 $i+1$）之间的界面（面）上，定义如下：\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right)\n$$\n此处，$I_i$ 表示静力压强的离散柱积分。该算子近似于积分压强的负水平梯度，即 $-\\partial I/\\partial x$。一个完全一致的垂直积分水平压强梯度力的公式还应考虑作用在倾斜海底上的压强，而该算子忽略了这一项。即使在应处于静止的状态下，其非零值也是数值误差的一种度量。\n\n我们必须比较两种不同的测深表示方法及其对压强积分 $I_i$ 的影响：\n1.  **不使用部分底单元 (no-PBC)**：海底由“阶梯”或“台阶”近似表示。第 $i$ 柱的深度取为 $H_i = N_i \\Delta z$，其中 $N_i = \\lfloor D(x_i)/\\Delta z\\rfloor$ 是“湿”的完整网格单元的数量。然后为此阶梯状深度计算垂直积分压强：\n    $$\n    I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2\n    $$\n    对于阶梯状测深，此公式是精确的。误差将局限于 $N_i$ 变化的“台阶”处。\n\n2.  **使用部分底单元 (PBC)**：模型在概念上允许最底部的单元具有分数厚度，从而完美地表示柱的总水深 $D(x_i)$。压强积分则是真实深度上的精确连续积分：\n    $$\n    I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D(x_i)^2\n    $$\n    尽管这种方法完美地表示了几何形状，但诊断算子 $a_{i+\\frac{1}{2}}$ 仍然是不一致的，并将产生一个非零的、空间变化的虚假加速度。\n\n根据计算出的加速度 $a_{i+\\frac{1}{2}}$，我们可求得在系统从静止开始经过一小段时间 $T$ 后，在各个面上的虚假水平速度：\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T\n$$\n为了量化误差，计算两个指标：\n- 虚假速度场的 $L^2$ 范数，用于衡量误差的总体大小：\n  $$\n  \\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2}\n  $$\n  其中 $N_f = N_x - 1$ 是面的数量。\n- 单位质量的平均虚假动能生成率，用于衡量数值格式产生人为能量的速率：\n  $$\n  \\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}} = \\frac{T}{N_f}\\sum_{i=1}^{N_f} a_{i+\\frac{1}{2}}^2\n  $$\n\n每个测试用例的计算步骤如下：\n1.  定义物理和数值参数：$N_x, L, D_0, s, \\Delta z, T, \\rho_0, g$。\n2.  构建水平网格：计算 $\\Delta x = L/(N_x-1)$ 和位置数组 $x_i$（对于 $i=1, \\dots, N_x$）。\n3.  计算每个网格点处的真实水深 $D_i = D(x_i)$。\n4.  对于 no-PBC 情况：\n    a. 确定每个水柱的湿单元数量 $N_i = \\lfloor D_i / \\Delta z \\rfloor$。\n    b. 计算积分压强 $I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\rho_0 g (N_i \\Delta z)^2$。\n5.  对于 PBC 情况：\n    a. 计算积分压强 $I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\rho_0 g D_i^2$。\n6.  对于两种情况，使用指定的有限差分算子计算加速度场 $a_{i+\\frac{1}{2}}$（对于 $i=1, \\dots, N_x-1$）。\n7.  计算速度场 $u_{i+\\frac{1}{2}} = a_{i+\\frac{1}{2}} T$。\n8.  计算并存储两种情况（no-PBC 和 PBC）的诊断指标 $\\|u\\|_2$ 和 $\\gamma$。\n\n一个关键的测试是平坦海底（$s=0$）的情况。此时，$D(x_i)$ 是常数，这意味着 $N_i$ 也是常数。因此，对于 no-PBC 和 PBC 两种方法，$I_{i+1} - I_i = 0$ 均成立，从而导致加速度、速度和能量增长为零。这为实现提供了一个必要的合理性检查。对于有坡度的情况（$s \\neq 0$），我们预计会出现非零误差。no-PBC 情况的误差将集中在阶梯的台阶处，而 PBC 情况的误差剖面将更平滑。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious pressure gradient errors for z-level ocean models with\n    and without Partial Bottom Cells (PBC).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # 1. Happy path moderate slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 1e-6, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 2. Boundary condition (flat bottom)\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 0.0, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 3. Coarse vertical resolution with steeper slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 5e-6, 'dz': 50.0,\n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 4. Shorter domain with relatively steep slope\n        {'Nx': 51, 'L': 50000.0, 'D0': 300.0, 's': 2e-5, 'dz': 25.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        # Unpack parameters\n        Nx = params['Nx']\n        L = params['L']\n        D0 = params['D0']\n        s = params['s']\n        dz = params['dz']\n        T = params['T']\n        rho0 = params['rho0']\n        g = params['g']\n        \n        # 1. Set up horizontal grid\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n        \n        # 2. Calculate true bottom depth at each grid column center\n        D = D0 + s * x\n        \n        # --- NO-PBC Calculation ---\n        \n        # 3a. Determine number of full wet cells and compute terraced depth\n        N_no_pbc = np.floor(D / dz)\n\n        # 4a. Compute column-integrated pressure for no-PBC\n        I_no_pbc = 0.5 * rho0 * g * (N_no_pbc * dz)**2\n        \n        # 5a. Compute diagnostic accelerations at faces\n        a_no_pbc = -1.0 / (rho0 * dx) * (I_no_pbc[1:] - I_no_pbc[:-1])\n        \n        # 6a. Compute spurious velocities\n        u_no_pbc = a_no_pbc * T\n        \n        # --- PBC Calculation ---\n        \n        # 3b. (Not needed, depth is continuous)\n        \n        # 4b. Compute column-integrated pressure for PBC using true depth\n        I_pbc = 0.5 * rho0 * g * D**2\n        \n        # 5b. Compute diagnostic accelerations at faces\n        a_pbc = -1.0 / (rho0 * dx) * (I_pbc[1:] - I_pbc[:-1])\n        \n        # 6b. Compute spurious velocities\n        u_pbc = a_pbc * T\n        \n        # --- Diagnostic Metrics ---\n        \n        Nf = Nx - 1\n        \n        # L2 norm of velocity\n        u_norm_no_pbc = np.sqrt(np.sum(u_no_pbc**2) / Nf)\n        u_norm_pbc = np.sqrt(np.sum(u_pbc**2) / Nf)\n        \n        # Mean energy growth rate per unit mass\n        gamma_no_pbc = np.sum(u_no_pbc * a_no_pbc) / Nf\n        gamma_pbc = np.sum(u_pbc * a_pbc) / Nf\n        \n        # Append results for this case\n        case_results = [\n            u_norm_no_pbc,\n            u_norm_pbc,\n            gamma_no_pbc,\n            gamma_pbc,\n        ]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) correctly formats the list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}