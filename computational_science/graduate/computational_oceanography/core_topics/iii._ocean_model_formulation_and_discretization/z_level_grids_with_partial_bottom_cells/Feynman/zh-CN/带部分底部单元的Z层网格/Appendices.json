{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习旨在巩固您对部分底层单元格基本几何定义的理解。在分析其优点之前，我们必须能够根据给定的水深和网格结构，准确计算其关键属性——厚度和分数。这项练习 () 将确保您牢固掌握这一基本计算方法。",
            "id": "3819515",
            "problem": "一个三维海洋模型采用固定的垂直坐标，其深度层具有恒定的厚度，通常称为z层网格。为避免离散网格与连续水深之间的系统性不匹配，许多模型包含一个部分底部单元，该单元封闭了最深的完整层下方的剩余水柱。考虑一个水柱，其水深深度为$H$，由$N_{\\mathrm{full}}$个厚度均匀为$\\Delta z_{\\mathrm{full}}$的完整单元和一个部分底部单元离散化。此表示的定义关系是：连续水柱的高度等于离散层厚度的总和，且底部单元分数$f$是部分单元厚度与完整单元厚度之比。根据这些原则，在$H=2375\\,\\mathrm{m}$，$\\Delta z_{\\mathrm{full}}=100\\,\\mathrm{m}$和$N_{\\mathrm{full}}=23$的情况下，确定底部单元分数$f$和底部单元厚度$\\Delta z_{N}$。然后，利用带有部分底部单元的z层网格中部分底部单元必须满足$0 \\le f  1$的约束，说明是否应在此位置包含一个额外的完整层。\n\n以米为单位表示底部单元的厚度，分数$f$为一个无单位的数。无需四舍五入，请提供精确值。",
            "solution": "该问题是有效的，因为它在科学上基于计算海洋学的既定实践，问题提出得很好，信息充分且一致，并且陈述客观。\n\n该问题要求确定z层网格的部分底部单元厚度$\\Delta z_{N}$及其对应的分数$f$，并对完整网格单元的数量给出理由。\n\n所提供的基本原则是，总水深深度$H$完全由所有离散垂直单元的厚度之和表示。该水柱由$N_{\\mathrm{full}}$个厚度均匀为$\\Delta z_{\\mathrm{full}}$的完整单元和一个厚度为$\\Delta z_{N}$的部分底部单元组成。这种关系可以用数学方式表示为：\n$$H = (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}}) + \\Delta z_{N}$$\n\n我们已知以下数值：\n总深度，$H = 2375 \\, \\mathrm{m}$。\n完整单元的厚度，$\\Delta z_{\\mathrm{full}} = 100 \\, \\mathrm{m}$。\n完整单元的数量，$N_{\\mathrm{full}} = 23$。\n\n首先，我们计算完整单元的总厚度：\n$$N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 23 \\times 100 \\, \\mathrm{m} = 2300 \\, \\mathrm{m}$$\n\n接下来，我们可以通过重新排列第一个方程来求解部分底部单元的厚度$\\Delta z_{N}$：\n$$\\Delta z_{N} = H - (N_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}})$$\n代入已知值：\n$$\\Delta z_{N} = 2375 \\, \\mathrm{m} - 2300 \\, \\mathrm{m} = 75 \\, \\mathrm{m}$$\n\n所提供的第二个原则将底部单元分数$f$定义为部分单元厚度与完整单元厚度之比：\n$$f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}}$$\n使用$\\Delta z_{N}$的计算值和$\\Delta z_{\\mathrm{full}}$的给定值：\n$$f = \\frac{75 \\, \\mathrm{m}}{100 \\, \\mathrm{m}} = 0.75$$\n此值为无单位数，符合要求。\n\n问题的第二部分要求在给定约束$0 \\le f  1$的情况下，说明是否应包含一个额外的完整层。\n\n在z层网格的公式中，完整单元的数量$N_{\\mathrm{full}}$不是任意选择的。它由总深度$H$和完整单元厚度$\\Delta z_{\\mathrm{full}}$决定。具体来说，$N_{\\mathrm{full}}$必须是能容纳在总深度内的最大完整单元整数数量。这可以用向下取整函数在数学上表示为：\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{H}{\\Delta z_{\\mathrm{full}}} \\right\\rfloor$$\n让我们在给定的情况下验证这一点：\n$$N_{\\mathrm{full}} = \\left\\lfloor \\frac{2375}{100} \\right\\rfloor = \\lfloor 23.75 \\rfloor = 23$$\n这证实了给定值$N_{\\mathrm{full}} = 23$对于此离散化方案是正确的。\n\n约束$0 \\le f  1$是$N_{\\mathrm{full}}$这一定义的直接结果。根据向下取整函数的定义，对于任何实数$x$，我们有$\\lfloor x \\rfloor \\leq x  \\lfloor x \\rfloor + 1$。将此应用于$x = H / \\Delta z_{\\mathrm{full}}$：\n$$N_{\\mathrm{full}} \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}}  N_{\\mathrm{full}} + 1$$\n从不等式的所有部分减去$N_{\\mathrm{full}}$得到：\n$$0 \\leq \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}  1$$\n认识到$f = \\frac{\\Delta z_{N}}{\\Delta z_{\\mathrm{full}}} = \\frac{H - N_{\\mathrm{full}}\\Delta z_{\\mathrm{full}}}{\\Delta z_{\\mathrm{full}}} = \\frac{H}{\\Delta z_{\\mathrm{full}}} - N_{\\mathrm{full}}$，我们看到该约束在数学上是保证成立的：\n$$0 \\le f  1$$\n我们计算出的值$f=0.75$正确地落在这个范围内。\n\n为了回答是否增加一个额外完整层的问题，让我们考虑一个假设情况，即我们将完整层的数量设置为$N'_{\\mathrm{full}} = N_{\\mathrm{full}} + 1 = 23 + 1 = 24$。\n这24个完整单元的总厚度将是：\n$$N'_{\\mathrm{full}} \\times \\Delta z_{\\mathrm{full}} = 24 \\times 100 \\, \\mathrm{m} = 2400 \\, \\mathrm{m}$$\n这个离散化深度（$2400 \\, \\mathrm{m}$）大于实际的水深深度（$H = 2375 \\, \\mathrm{m}$）。这是一个物理上不可能的情景，因为它意味着模型的基岩位于实际基岩之下，底部网格单元延伸到了固体地球中。\n\n因此，不应该，也确实不能包含一个额外的完整层。完整层的数量由问题的地球物理参数固定为23。在指定的模型规则下，对于这个水柱，具有$N_{\\mathrm{full}}=23$和厚度为$75 \\, \\mathrm{m}$（$f=0.75$）的部分底部单元的配置是唯一有效的离散化方案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.75  75\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "掌握了如何计算部分单元格的几何形状后，下一个练习将探讨其为何是一种更优越的方法。这个练习是本主题的理论核心，它将指导您推导在离散化倾斜海底时产生的伪压力梯度误差。通过这项练习 ()，您将能从解析上证明，与简单的阶梯式表示相比，部分底层单元格如何显著减小这种误差。",
            "id": "3819508",
            "problem": "考虑一个在 $z$ 层网格上使用部分底层单元 (PBC) 的静力海洋模型。两个相邻的垂直列共享相同的自由面高度 $\\eta$ 和相同数量 $N \\in \\mathbb{N}$ 的完整单元，每个单元的厚度均为 $\\Delta z$。在每一列中，最底层的流体层是一个厚度为 $h_i = f_i \\Delta z$ 的部分单元，其中 $f_i \\in (0,1]$ 是第 $i$ 列的分数厚度，$i \\in \\{1,2\\}$。两列之间的水平网格间距为 $\\Delta x$。密度为常数 $\\rho = \\rho_0$，重力加速度为常数 $g$。假设选择的压力计使得 $p(\\eta) = 0$。\n\n最底层中心的离散水平压力梯度是通过对两列底层单元中心处评估的静水压力进行中心有限差分来计算的，即 $(p_1 - p_2)/\\Delta x$。\n\n仅从静力平衡和这些网格定义出发，推导底部虚假离散水平压力梯度量级 $|(p_1 - p_2)/\\Delta x|$ 的闭式表达式，用 $\\rho_0$、$g$、$\\Delta z$、$\\Delta x$ 和 $f_1, f_2$ 表示。然后，为了进行比较，考虑相同水深对比的全单元阶梯表示法，其中一列在底部额外增加一个完整的 $z$ 层（因此两列最底层单元的中心恰好偏移了 $\\Delta z$）。利用此结果确定由 PBC 引起的误差相对于全单元误差的缩减因子，并解释其如何依赖于 $|f_1 - f_2|$。\n\n以帕斯卡/米 $(\\mathrm{Pa}\\ \\mathrm{m}^{-1})$ 为单位表示最终的压力梯度量级。你的最终答案必须是单一的闭式解析表达式；不要在最终答案中提供中间步骤或缩减因子的方程。",
            "solution": "该问题被验证为具有科学依据、问题明确且客观。它基于流体动力学（静力平衡）的基本原理和计算海洋学中的标准数值方法。所有必要的信息都已提供，目标也已明确陈述。我们可以开始求解。\n\n该问题要求推导在使用部分底层单元（PBC）的 $z$ 层海洋模型中，由于水深离散化而产生的虚假水平压力梯度的量级。\n\n首先，我们建立物理原理和坐标系。海洋被假定为静力的，这意味着任何深度的压力 $p$ 都由其上方水柱的重量决定。控制方程是静力平衡：\n$$\n\\frac{dp}{dz} = -\\rho_0 g\n$$\n其中 $z$ 是垂直坐标（向上为正），$\\rho_0$ 是恒定的水密度，$g$ 是重力加速度。我们已知在自由表面 $z=\\eta$ 处的压力为零，即 $p(\\eta) = 0$。将静力方程从坐标 $z$ 积分到 $\\eta$ 可得：\n$$\n\\int_{p(z)}^{p(\\eta)} dp' = \\int_{z}^{\\eta} (-\\rho_0 g) dz'\n$$\n$$\np(\\eta) - p(z) = -\\rho_0 g (\\eta - z)\n$$\n给定 $p(\\eta)=0$，任意垂直坐标 $z$ 处的压力为：\n$$\np(z) = \\rho_0 g (\\eta - z)\n$$\n为了简化几何结构，我们可以将垂直轴的原点设置在自由表面，使得 $\\eta = 0$。对于 $z \\le 0$，压力方程简化为 $p(z) = -\\rho_0 g z$。\n\n接下来，我们定义每一列 $i \\in \\{1, 2\\}$ 的垂直网格结构。每一列在自由表面下方有 $N$ 个厚度均匀为 $\\Delta z$ 的完整单元，并在最底部有一个部分单元。\n$N$ 个完整单元占据从 $z=0$ 到 $z=-N \\Delta z$ 的垂直范围。\n第 $i$ 列中最底层的单元是一个厚度为 $h_i = f_i \\Delta z$ 的部分单元，其中 $f_i \\in (0, 1]$。这个部分单元占据从 $z = -N \\Delta z$ 到 $z = -N \\Delta z - h_i = -(N + f_i)\\Delta z$ 的垂直范围。\n\n问题陈述，离散压力梯度是使用在这些底层单元中心处评估的压力来计算的。我们来求第 $i$ 列底层单元中心的垂直坐标 $z_{c,i}$。中心是其垂直范围的中点：\n$$\nz_{c,i} = \\frac{(-N \\Delta z) + (-(N+f_i)\\Delta z)}{2} = -\\frac{2N + f_i}{2}\\Delta z = -\\left(N + \\frac{f_i}{2}\\right)\\Delta z\n$$\n现在，我们可以使用压力公式 $p(z) = -\\rho_0 g z$ 来计算每一列 $i \\in \\{1, 2\\}$ 中底层单元中心的静水压力 $p_i$：\n对于第1列：\n$$\np_1 = p(z_{c,1}) = -\\rho_0 g z_{c,1} = -\\rho_0 g \\left[-\\left(N + \\frac{f_1}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z\n$$\n对于第2列：\n$$\np_2 = p(z_{c,2}) = -\\rho_0 g z_{c,2} = -\\rho_0 g \\left[-\\left(N + \\frac{f_2}{2}\\right)\\Delta z\\right] = \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n两个单元中心之间的压力差是：\n$$\np_1 - p_2 = \\rho_0 g \\left(N + \\frac{f_1}{2}\\right)\\Delta z - \\rho_0 g \\left(N + \\frac{f_2}{2}\\right)\\Delta z\n$$\n$$\np_1 - p_2 = \\rho_0 g \\Delta z \\left[\\left(N + \\frac{f_1}{2}\\right) - \\left(N + \\frac{f_2}{2}\\right)\\right] = \\rho_0 g \\Delta z \\left(\\frac{f_1 - f_2}{2}\\right)\n$$\n问题要求离散水平压力梯度的量级，其定义为 $|(p_1 - p_2)/\\Delta x|$，其中 $\\Delta x$ 是两列中心之间的水平距离。\n$$\n\\left|\\frac{p_1 - p_2}{\\Delta x}\\right| = \\left|\\frac{\\rho_0 g \\Delta z (f_1 - f_2)}{2 \\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|\n$$\n这是 PBC 模型中虚假压力梯度量级的闭式表达式。这个梯度是虚假的，因为它即使在静止流体（$\\eta=\\text{constant}$）中，也仅仅因为网格对水深的表示而产生。理想情况下，对于静止的流体，水平压力梯度应处处为零。\n\n为了进行比较，我们考虑全单元阶梯表示法。问题指明，在这种情况下，一列额外增加一个完整单元，导致最底层单元中心之间的垂直偏移恰好为 $\\Delta z$。假设第1列有 $K$ 个单元，第2列有 $K+1$ 个单元。\n第1列底层单元的中心位于 $z_{c,1,stair} = -(K - 1/2)\\Delta z$。\n第2列底层单元的中心位于 $z_{c,2,stair} = -((K+1) - 1/2)\\Delta z = -(K + 1/2)\\Delta z$。\n压力差为 $p_{1,stair} - p_{2,stair}$：\n$$\np_{1,stair} - p_{2,stair} = \\rho_0 g (K - 1/2)\\Delta z - \\rho_0 g (K + 1/2)\\Delta z = \\rho_0 g \\Delta z (K - 1/2 - K - 1/2) = -\\rho_0 g \\Delta z\n$$\n在阶梯模型中，虚假压力梯度的量级为：\n$$\n\\left|\\frac{p_{1,stair} - p_{2,stair}}{\\Delta x}\\right| = \\left|\\frac{-\\rho_0 g \\Delta z}{\\Delta x}\\right| = \\frac{\\rho_0 g \\Delta z}{\\Delta x}\n$$\n由 PBC 引起的误差相对于全单元阶梯误差的缩减因子是它们量级的比率：\n$$\n\\text{缩减因子} = \\frac{\\frac{\\rho_0 g \\Delta z}{2 \\Delta x}|f_1 - f_2|}{\\frac{\\rho_0 g \\Delta z}{\\Delta x}} = \\frac{1}{2}|f_1 - f_2|\n$$\n这个因子证明了 PBC方法的主要优点。虚假压力梯度与 $|f_1 - f_2|$ 成正比，即底层单元分数厚度的差值。由于 $f_1, f_2 \\in (0, 1]$，所以 $|f_1-f_2|$ 的范围是 $[0, 1)$。因此，PBC 误差总是小于阶梯误差的一半（当 $|f_1-f_2| \\to 1$ 时发生），并且当水深坡度平缓，使得相邻的部分单元厚度相似（$|f_1-f_2| \\ll 1$）时，该误差会显著减小。在平坦底部的理想情况下，$f_1=f_2$，PBC 方法正确地产生零虚假压力梯度，而阶梯模型除非底部与网格层完美对齐，否则仍会产生误差。阶梯模型中的误差量级为 $\\mathcal{O}(\\rho_0 g \\Delta z / \\Delta x)$，而 PBC 误差的量级为 $\\mathcal{O}(\\rho_0 g \\Delta z |f_1-f_2| / \\Delta x)$，这代表了精度的显著提高。",
            "answer": "$$\n\\boxed{\\frac{\\rho_0 g \\Delta z |f_1 - f_2|}{2 \\Delta x}}\n$$"
        },
        {
            "introduction": "本章的收尾练习将理论与计算实践相结合。在完成了先前的解析推导之后，这个动手编程练习 () 将通过建立一个数值实验来量化部分底层单元格方法带来的改进。通过模拟一个倾斜的海底并计算诸如伪速度之类的误差度量，您将亲眼看到部分底层单元格如何带来一个物理上更准确、数值上更稳定的模型。",
            "id": "3819489",
            "problem": "你必须编写一个完整的、可运行的程序，在水平坐标 $x$ 上构建一个具有线性倾斜底部和均匀密度的二维垂直平面海洋切片，然后量化由一个特意设置为静水力不一致的诊断离散化方案所产生的虚假压力梯度误差，并比较不使用部分底层单元格（PBC）和使用部分底层单元格（PBC）两种情况。背景设定为一个 $z$ 层网格：垂直坐标 $z$ 被离散化为均匀厚度 $\\Delta z$ 的层，单元格中心位于深度 $z_k = -(k - \\tfrac{1}{2}) \\Delta z$，其中 $k = 1,2,\\dots$。海面固定在 $z = 0$，海底深度规定为 $D(x) = D_0 + s x$，其中 $D_0$ 是一个正的参考深度，$s$ 是以米/米为单位的恒定斜率。\n\n其基础是静水力平衡 $dp/dz = -\\rho g$，其中 $p$ 是压力，$\\rho$ 是密度，$g$ 是重力加速度。在密度均匀 $\\rho(x,z) = \\rho_0$ 且海面高度恒定的情况下，任意固定深度 $z$ 处的精确连续水平压力梯度为零：$\\partial p / \\partial x = 0$。在均匀密度下，一个静水力一致的离散水平压力梯度在固定的 $z$ 处也应为零。然而，为了量化与阶梯式地形以及在 $z$ 层模型中使用垂直求和相关的静水力不一致性，本问题要求你评估一个特意设置的不一致的诊断算子。该算子用于计算界面加速度，并使用水柱积分静水压力的差值。该算子定义为\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right),\n$$\n其中 $i$ 是水平位置 $x_i$ 处垂直水柱的索引，$\\Delta x$ 是水平网格间距，$I_i$ 是水柱 $i$ 中静水压力的离散水柱积分：\n$$\nI_i = \\sum_{k\\in \\text{wet}} p(z_k)\\,\\Delta z_k.\n$$\n在均匀密度和静水力平衡（$p(z) = \\rho_0 g(-z)$）下，精确的连续积分为 $I(x) = \\tfrac{1}{2}\\rho_0 g D(x)^2$，但离散的 $z$ 层近似值取决于底部的表示方式。\n\n你必须实现两种离散水柱积分：\n- 不使用部分底层单元格（no-PBC）：底部由一个深度为 $\\Delta z$ 倍数的阶梯表示。如果 $N_i = \\lfloor D_i/\\Delta z\\rfloor$ 是完全湿润单元格的数量，则\n$$\nI_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2.\n$$\n- 使用部分底层单元格（PBC）：底层单元格的厚度是分数的，因此水柱积分恢复为连续的精确值，\n$$\nI_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D_i^2.\n$$\n\n分别使用由 $I_i^{\\mathrm{noPBC}}$ 和 $I_i^{\\mathrm{PBC}}$ 计算出的 $a_{i+\\frac{1}{2}}$，将时刻 $T$ 的虚假界面速度定义为\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T,\n$$\n初始条件为 $u_{i+\\frac{1}{2}}(0) = 0$ 且无其他力作用。定义以下诊断指标：\n- 界面上虚假速度场的 $L^2$ 范数，\n$$\n\\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2},\n$$\n其中 $N_f$ 是界面的数量。\n- 单位质量的平均能量增长率，\n$$\n\\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}}.\n$$\n\n你必须计算以米/秒为单位的 $\\|u\\|_2$ 和以米²/秒³为单位的 $\\gamma$。实现必须是自包含的，并对两种配置使用上面给出的 $I_i^{\\mathrm{noPBC}}$ 和 $I_i^{\\mathrm{PBC}}$ 的精确值。密度 $\\rho_0$ 和重力加速度 $g$ 必须视为给定常数，其中 $\\rho_0$ 的单位是千克/立方米，$g$ 的单位是米/秒²。\n\n用 $N_x$ 个均匀分布在长度 $L$ 上的水柱构建水平网格。使用 $x_i = (i-1)\\Delta x$（$i=1,\\dots,N_x$），其中 $\\Delta x = L/(N_x-1)$，界面位于 $i+\\tfrac{1}{2}$（$i=1,\\dots,N_x-1$）。\n\n你的程序必须为以下四个测试用例计算诊断指标，这些用例共同构成了测试套件：\n1. 正常情况中等斜坡：$N_x = 201$，$L = 100000\\,\\mathrm{m}$，$D_0 = 1000\\,\\mathrm{m}$，$s = 10^{-6}\\,\\mathrm{m/m}$，$\\Delta z = 10\\,\\mathrm{m}$，$T = 60\\,\\mathrm{s}$，$\\rho_0 = 1025\\,\\mathrm{kg/m^3}$，$g = 9.81\\,\\mathrm{m/s^2}$。\n2. 边界条件（平底）：$N_x = 201$，$L = 100000\\,\\mathrm{m}$，$D_0 = 1000\\,\\mathrm{m}$，$s = 0\\,\\mathrm{m/m}$，$\\Delta z = 10\\,\\mathrm{m}$，$T = 60\\,\\mathrm{s}$，$\\rho_0 = 1025\\,\\mathrm{kg/m^3}$，$g = 9.81\\,\\mathrm{m/s^2}$。\n3. 较粗垂直分辨率和较陡斜坡：$N_x = 201$，$L = 100000\\,\\mathrm{m}$，$D_0 = 1000\\,\\mathrm{m}$，$s = 5\\times 10^{-6}\\,\\mathrm{m/m}$，$\\Delta z = 50\\,\\mathrm{m}$，$T = 60\\,\\mathrm{s}$，$\\rho_0 = 1025\\,\\mathrm{kg/m^3}$，$g = 9.81\\,\\mathrm{m/s^2}$。\n4. 较短域和相对陡峭的斜坡：$N_x = 51$，$L = 50000\\,\\mathrm{m}$，$D_0 = 300\\,\\mathrm{m}$，$s = 2\\times 10^{-5}\\,\\mathrm{m/m}$，$\\Delta z = 25\\,\\mathrm{m}$，$T = 60\\,\\mathrm{s}$，$\\rho_0 = 1025\\,\\mathrm{kg/m^3}$，$g = 9.81\\,\\mathrm{m/s^2}$。\n\n对于每个测试用例，输出一个包含四个浮点数的列表：不使用 PBC 时的 $\\|u\\|_2$，使用 PBC 时的 $\\|u\\|_2$，不使用 PBC 时的 $\\gamma$，使用 PBC 时的 $\\gamma$。\n\n你的程序应该生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是一个按上述顺序排列的包含四个数字的列表。例如，最后一行应类似于 $[\\,[a_1,b_1,c_1,d_1],\\,[a_2,b_2,c_2,d_2],\\,[a_3,b_3,c_3,d_3],\\,[a_4,b_4,c_4,d_4]\\,]$，所有值均使用指定单位。",
            "solution": "用户提供的问题已经过验证，被确定为一个在计算海洋学领域中定义明确、具有科学依据的问题。我们将提供一个完整的解决方案。\n\n该问题要求在一个简化的海洋模型中，对使用 $z$ 层垂直坐标系且底部倾斜的情况下产生的虚假压力梯度误差进行定量分析。在静止的、密度均匀为 $\\rho_0$ 的连续流体中，假设海面位于 $z=0$ 且该处压力为零，则静水压力由 $p(z) = \\rho_0 g (-z)$ 给出。因此，水平压力梯度 $\\partial p / \\partial x$ 处处为零，这意味着不应产生水平运动。然而，数值模型可能会因为离散化误差而产生虚假的运动，尤其是在存在复杂水深地形的情况下。本问题旨在研究此类误差。\n\n模型区域是 $(x,z)$ 平面上的一个二维垂直切片。水平坐标 $x$ 被离散化为 $N_x$ 个水柱，均匀间距为 $\\Delta x = L/(N_x-1)$，其中 $L$ 是区域长度。网格水柱中心位于 $x_i = (i-1)\\Delta x$，其中 $i=1, 2, \\dots, N_x$。垂直离散化是一个 $z$ 层网格，层厚度均匀为 $\\Delta z$。底部深度是位置的线性函数，$D(x) = D_0 + s x$，其中 $D_0$ 是 $x=0$ 处的深度，$s$ 是恒定斜率。\n\n问题的核心在于评估一个用于计算水平加速度的特定诊断算子，该算子被特意设计为静水力不一致的。该算子作用于相邻水柱 $i$ 和 $i+1$ 之间的界面（face），定义为：\n$$\na_{i+\\frac{1}{2}} = -\\frac{1}{\\rho_0 \\Delta x}\\left(I_{i+1} - I_i\\right)\n$$\n这里，$I_i$ 表示静水压力的离散水柱积分。该算子近似于积分压力的负水平梯度 $-\\partial I/\\partial x$。一个完全一致的垂直积分水平压力梯度力的公式，还应考虑作用在倾斜底部上的压力，而这个算子忽略了这一项。即使在应处于静止的状态下，它的非零值也是衡量数值误差的一个指标。\n\n我们必须比较两种不同的水深地形表示方法及其对压力积分 $I_i$ 的影响：\n1.  **不使用部分底层单元格 (no-PBC)**：底部由“阶梯”或“台阶”近似表示。水柱 $i$ 的深度被取为 $H_i = N_i \\Delta z$，其中 $N_i = \\lfloor D(x_i)/\\Delta z\\rfloor$ 是“湿润”的完整网格单元数。然后，为此阶梯式深度计算垂直积分压力：\n    $$\n    I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\,\\rho_0 g\\,(N_i \\Delta z)^2\n    $$\n    该公式对于阶梯式地形是精确的。误差将局限在 $N_i$ 变化的“台阶”处。\n\n2.  **使用部分底层单元格 (PBC)**：模型在概念上允许最底层的单元格具有小数厚度，从而使得水柱的总水深 $D(x_i)$ 得到完美表示。此时压力积分即为真实深度下的精确连续积分：\n    $$\n    I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\,\\rho_0 g\\,D(x_i)^2\n    $$\n    虽然这完美地表示了几何形状，但诊断算子 $a_{i+\\frac{1}{2}}$ 仍然是不一致的，并将产生非零的、空间变化的虚假加速度。\n\n根据计算出的加速度 $a_{i+\\frac{1}{2}}$，我们假设系统从静止开始，得出短时间 $T$ 后界面处的虚假水平速度：\n$$\nu_{i+\\frac{1}{2}}(T) = a_{i+\\frac{1}{2}}\\,T\n$$\n为了量化误差，计算了两个指标：\n- 虚假速度场的 $L^2$ 范数，用于衡量误差的总体大小：\n  $$\n  \\|u\\|_2 = \\sqrt{\\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}^2}\n  $$\n  其中 $N_f = N_x - 1$ 是界面的数量。\n- 单位质量的虚假动能平均生成率，用于衡量数值方案产生人为能量的速率：\n  $$\n  \\gamma = \\frac{1}{N_f}\\sum_{i=1}^{N_f} u_{i+\\frac{1}{2}}\\,a_{i+\\frac{1}{2}} = \\frac{T}{N_f}\\sum_{i=1}^{N_f} a_{i+\\frac{1}{2}}^2\n  $$\n\n每个测试用例的计算步骤如下：\n1.  定义物理和数值参数：$N_x, L, D_0, s, \\Delta z, T, \\rho_0, g$。\n2.  构建水平网格：计算 $\\Delta x = L/(N_x-1)$ 和位置数组 $x_i$（$i=1, \\dots, N_x$）。\n3.  计算每个网格点处的真实水深 $D_i = D(x_i)$。\n4.  对于 no-PBC 情况：\n    a. 确定每个水柱的湿润单元格数量 $N_i = \\lfloor D_i / \\Delta z \\rfloor$。\n    b. 计算积分压力 $I_i^{\\mathrm{noPBC}} = \\frac{1}{2}\\rho_0 g (N_i \\Delta z)^2$。\n5.  对于 PBC 情况：\n    a. 计算积分压力 $I_i^{\\mathrm{PBC}} = \\frac{1}{2}\\rho_0 g D_i^2$。\n6.  对于两种情况，使用指定的有限差分算子计算加速度场 $a_{i+\\frac{1}{2}}$（$i=1, \\dots, N_x-1$）。\n7.  计算速度场 $u_{i+\\frac{1}{2}} = a_{i+\\frac{1}{2}} T$。\n8.  为 no-PBC 和 PBC 两种情况计算并存储诊断指标 $\\|u\\|_2$ 和 $\\gamma$。\n\n一个关键的测试是平底情况 ($s=0$)。在此情况下，$D(x_i)$ 是常数，意味着 $N_i$ 也是常数。因此，对于 no-PBC 和 PBC 两种方法，$I_{i+1} - I_i = 0$ 均成立，从而导致加速度、速度和能量增长为零。这为实现提供了一个必要的合理性检查。对于倾斜情况 ($s \\neq 0$)，我们预计会出现非零误差。no-PBC 情况下的误差将集中在阶梯台阶处，而 PBC 情况下的误差剖面将更平滑。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spurious pressure gradient errors for z-level ocean models with\n    and without Partial Bottom Cells (PBC).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # 1. Happy path moderate slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 1e-6, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 2. Boundary condition (flat bottom)\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 0.0, 'dz': 10.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 3. Coarse vertical resolution with steeper slope\n        {'Nx': 201, 'L': 100000.0, 'D0': 1000.0, 's': 5e-6, 'dz': 50.0,\n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n        # 4. Shorter domain with relatively steep slope\n        {'Nx': 51, 'L': 50000.0, 'D0': 300.0, 's': 2e-5, 'dz': 25.0, \n         'T': 60.0, 'rho0': 1025.0, 'g': 9.81},\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        # Unpack parameters\n        Nx = params['Nx']\n        L = params['L']\n        D0 = params['D0']\n        s = params['s']\n        dz = params['dz']\n        T = params['T']\n        rho0 = params['rho0']\n        g = params['g']\n        \n        # 1. Set up horizontal grid\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n        \n        # 2. Calculate true bottom depth at each grid column center\n        D = D0 + s * x\n        \n        # --- NO-PBC Calculation ---\n        \n        # 3a. Determine number of full wet cells and compute terraced depth\n        N_no_pbc = np.floor(D / dz)\n\n        # 4a. Compute column-integrated pressure for no-PBC\n        I_no_pbc = 0.5 * rho0 * g * (N_no_pbc * dz)**2\n        \n        # 5a. Compute diagnostic accelerations at faces\n        a_no_pbc = -1.0 / (rho0 * dx) * (I_no_pbc[1:] - I_no_pbc[:-1])\n        \n        # 6a. Compute spurious velocities\n        u_no_pbc = a_no_pbc * T\n        \n        # --- PBC Calculation ---\n        \n        # 3b. (Not needed, depth is continuous)\n        \n        # 4b. Compute column-integrated pressure for PBC using true depth\n        I_pbc = 0.5 * rho0 * g * D**2\n        \n        # 5b. Compute diagnostic accelerations at faces\n        a_pbc = -1.0 / (rho0 * dx) * (I_pbc[1:] - I_pbc[:-1])\n        \n        # 6b. Compute spurious velocities\n        u_pbc = a_pbc * T\n        \n        # --- Diagnostic Metrics ---\n        \n        Nf = Nx - 1\n        \n        # L2 norm of velocity\n        u_norm_no_pbc = np.sqrt(np.sum(u_no_pbc**2) / Nf)\n        u_norm_pbc = np.sqrt(np.sum(u_pbc**2) / Nf)\n        \n        # Mean energy growth rate per unit mass\n        gamma_no_pbc = np.sum(u_no_pbc * a_no_pbc) / Nf\n        gamma_pbc = np.sum(u_pbc * a_pbc) / Nf\n        \n        # Append results for this case\n        case_results = [\n            u_norm_no_pbc,\n            u_norm_pbc,\n            gamma_no_pbc,\n            gamma_pbc,\n        ]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) correctly formats the list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}