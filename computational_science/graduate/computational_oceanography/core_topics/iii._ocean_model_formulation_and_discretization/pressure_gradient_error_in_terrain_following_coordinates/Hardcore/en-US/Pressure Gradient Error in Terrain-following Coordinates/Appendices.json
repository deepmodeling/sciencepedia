{
    "hands_on_practices": [
        {
            "introduction": "This first exercise takes us back to first principles to understand the geometric origin of the pressure gradient error. By analyzing a simplified, linearly sloping bathymetry, you will derive an expression for the slope of the terrain-following coordinate surfaces, $\\frac{\\partial z}{\\partial x}|_s$ . This exercise demonstrates mathematically why these coordinate surfaces are not flat and how their slope, which is largest near steep topography, directly creates the two large, cancelling terms in the pressure gradient calculation.",
            "id": "3808846",
            "problem": "Consider a hydrostatic ocean model formulated in a terrain-following vertical coordinate, denoted by the dimensionless variable $s$, which is defined through the standard mapping between the physical vertical coordinate $z$ and the terrain-following coordinate $s$ as $z(x,s)=\\eta(x)+s\\left(H(x)+\\eta(x)\\right)$. Here $H(x)>0$ denotes the resting depth measured downward from mean sea level, $\\eta(x)$ denotes the sea surface height, and $s\\in[-1,0]$ spans from bottom ($s=-1$) to surface ($s=0$). Assume the sea surface is flat, so that $\\eta(x)=0$. Let the bathymetry be given by the linear profile $H(x)=H_{0}\\left(1+\\alpha x\\right)$, where $H_{0}>0$ is a constant reference depth and $\\alpha$ is a constant bottom slope parameter. \n\nStarting from the coordinate mapping and fundamental calculus (specifically, the chain rule and the definition of partial derivatives at fixed $s$), derive a closed-form expression for the horizontal derivative at constant $s$, $\\frac{\\partial z}{\\partial x}\\big|_{s}$, as a function of $s$, $\\alpha$, and $H_{0}$. Then, based on this expression and the definition of the terrain-following coordinate geometry, explain where in the water column the magnitude $|\\partial z/\\partial x|$ becomes large and why this matters for the pressure gradient error in terrain-following coordinates. \n\nExpress your final result for $\\frac{\\partial z}{\\partial x}\\big|_{s}$ as a single analytic expression in simplest form. No numerical evaluation is required. You do not need to include physical units in your final expression.",
            "solution": "The problem asks for the derivation of the horizontal derivative of the vertical coordinate at constant $s$, $\\frac{\\partial z}{\\partial x}\\big|_{s}$, in a terrain-following coordinate system, and an explanation of its relevance to the pressure gradient error.\n\nFirst, we begin with the given coordinate mapping from the physical vertical coordinate $z$ to the dimensionless terrain-following coordinate $s$:\n$$z(x,s) = \\eta(x) + s \\left( H(x) + \\eta(x) \\right)$$\nHere, $x$ is the horizontal coordinate, $\\eta(x)$ is the sea surface height, and $H(x)$ is the resting depth. The coordinate $s$ ranges from $s=-1$ at the bottom to $s=0$ at the surface.\n\nThe problem states to assume a flat sea surface, which implies $\\eta(x) = 0$. Substituting this into the mapping equation simplifies it to:\n$$z(x,s) = s H(x)$$\nThis simplified form shows that for a given $s$, the vertical position $z$ is a scaled version of the total water depth $H(x)$.\n\nNext, we are given the bathymetry profile as a linear function of $x$:\n$$H(x) = H_{0} \\left( 1 + \\alpha x \\right)$$\nwhere $H_{0} > 0$ is a constant reference depth and $\\alpha$ is a constant bottom slope parameter. We substitute this expression for $H(x)$ into our simplified mapping for $z(x,s)$:\n$$z(x,s) = s \\left[ H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\n\nThe primary objective is to find the horizontal derivative of $z$ at a constant $s$-level, denoted as $\\frac{\\partial z}{\\partial x}\\big|_{s}$. This quantity represents the slope of the terrain-following coordinate surfaces in the physical $(x, z)$ space. To compute this, we take the partial derivative of the expression for $z(x,s)$ with respect to $x$, while treating $s$ as a constant:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = \\frac{\\partial}{\\partial x} \\left[ s H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\nSince $s$ and $H_{0}$ are constants with respect to the partial differentiation with respect to $x$, we can factor them out of the derivative:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = s H_{0} \\frac{\\partial}{\\partial x} \\left( 1 + \\alpha x \\right)$$\nThe derivative of $(1 + \\alpha x)$ with respect to $x$ is simply $\\alpha$. Therefore, we arrive at the final expression for the slope of the coordinate surfaces:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = s \\alpha H_{0}$$\n\nNow, we address the second part of the problem: explaining where the magnitude of this slope, $\\left|\\frac{\\partial z}{\\partial x}\\big|_{s}\\right|$, becomes large and why this is significant for the pressure gradient error. The magnitude is:\n$$\\left|\\frac{\\partial z}{\\partial x}\\bigg|_{s}\\right| = \\left|s \\alpha H_{0}\\right| = |s| |\\alpha| H_{0}$$\nThe vertical coordinate $s$ varies in the range $s \\in [-1, 0]$. The magnitude $|s|$ is therefore largest at the bottom, where $s=-1$, and smallest (equal to zero) at the surface, where $s=0$. This means that the slope of the coordinate surfaces is steepest near the ocean floor and the surfaces become flat at the mean sea level. The magnitude of the slope is also directly proportional to the magnitude of the bottom slope parameter, $|\\alpha|$. Thus, steep bathymetry leads to steeply sloped coordinate surfaces.\n\nThe significance of this result lies in its connection to the pressure gradient error, a well-known numerical artifact in terrain-following coordinate ocean models. The horizontal pressure gradient force (PGF) in the $x$-direction is given by $-\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\big|_{z}$. When transforming this into the $s$-coordinate system, the chain rule gives:\n$$\\frac{\\partial p}{\\partial x}\\bigg|_{z} = \\frac{\\partial p}{\\partial x}\\bigg|_{s} + \\frac{\\partial p}{\\partial z}\\bigg|_{s} \\frac{\\partial z}{\\partial x}\\bigg|_{s}$$\nUnder the hydrostatic assumption, $\\frac{\\partial p}{\\partial z} = -\\rho g$, where $\\rho$ is the density and $g$ is the acceleration due to gravity. The horizontal PGF per unit mass in the $s$-system can be written (approximating the in-situ density $\\rho$ with a reference density $\\rho_0$ in the denominator) as:\n$$-\\frac{1}{\\rho_0}\\frac{\\partial p}{\\partial x}\\bigg|_{z} = -\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\bigg|_{s} + \\frac{\\rho g}{\\rho_0} \\frac{\\partial z}{\\partial x}\\bigg|_{s}$$\nIn many oceanic situations, particularly in the deep ocean, the horizontal density gradients are small, and the true horizontal pressure gradient is a small value. However, the two terms on the right-hand side of the transformed equation can be very large, especially over steep topography. The first term, $-\\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}\\big|_{s}$, reflects the pressure gradient along the tilted $s$-surface. The second term, $\\frac{\\rho g}{\\rho_0} \\frac{\\partial z}{\\partial x}\\big|_{s}$, is a correction term that accounts for the slope of the $s$-surface. These two terms are typically of opposite sign and nearly cancel each other out.\n\nThe pressure gradient error arises because numerical ocean models compute these two large terms using finite difference approximations. The truncation errors associated with these discrete approximations mean that the cancellation is not perfect. The residual, a spurious (non-physical) force, can drive artificial currents and contaminate the model solution. The magnitude of the second term is directly proportional to $\\left|\\frac{\\partial z}{\\partial x}\\big|_{s}\\right|$. Since we found that this slope is largest near the bottom ($s \\to -1$) and over steep topography (large $|\\alpha|$), the pressure gradient error is most severe in these regions. This is because the two terms to be subtracted are at their largest there, and any fixed relative error in their computation leads to a large absolute error in their difference.",
            "answer": "$$\\boxed{s \\alpha H_{0}}$$"
        },
        {
            "introduction": "Having established the geometric source of the problem, we now move to a practical demonstration. This exercise challenges you to construct and analyze a classic \"resting ocean\" test case, a standard method for diagnosing pressure gradient error in ocean models . You will first derive the exact analytical cancellation of the pressure gradient terms and then implement a short program to compute both the erroneous \"naive\" pressure gradient and the fully corrected one, providing a clear, hands-on look at the magnitude of the error and the precision required for its cancellation.",
            "id": "3808788",
            "problem": "You are asked to construct and analyze a one-dimensional resting ocean test in terrain-following coordinates to expose and resolve the pressure gradient error. Consider the horizontal coordinate $x \\in \\mathbb{R}$ and the vertical coordinate $z \\in \\mathbb{R}$ measured positive upward with the free surface at $z=0$ and the bottom at $z=-H(x)$. The free-surface elevation is fixed at $\\eta=0$ (resting ocean). The bottom topography is $H(x)=H_0(1+\\alpha x)$, where $H_0>0$ is a constant depth (in $\\mathrm{m}$) and $\\alpha$ is a small constant slope parameter (in $\\mathrm{m}^{-1}$). The density is linear in $z$: $\\rho(z)=\\rho_0+\\beta z$, where $\\rho_0>0$ is a constant reference density (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$) and $\\beta$ is a constant vertical density gradient (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), typically negative so that density increases with depth. Gravitational acceleration is $g>0$ (in $\\mathrm{m}\\,\\mathrm{s}^{-2}$).\n\nStart from the following foundational laws and definitions:\n- The hydrostatic balance: $\\partial p/\\partial z = -g \\rho$, where $p(x,z)$ is pressure (in $\\mathrm{Pa}$).\n- The Boussinesq horizontal momentum equation (no friction, no Coriolis, no external forcing): $\\partial u/\\partial t = -(1/\\rho_0)\\,\\partial p/\\partial x$, where $u(x,z,t)$ is the horizontal velocity (in $\\mathrm{m}\\,\\mathrm{s}^{-1}$).\n- The terrain-following $\\sigma$-coordinate mapping for zero free surface: $\\sigma = z/H(x)$, so that $\\sigma \\in [-1,0]$ with $\\sigma=-1$ at the bottom and $\\sigma=0$ at the surface. Use the chain rule to relate horizontal derivatives at fixed $z$ to those at fixed $\\sigma$.\n\nTask A (derivation): Derive from first principles an exact continuous expression that demonstrates the horizontal acceleration vanishes everywhere for the given resting ocean configuration. Your derivation must begin from the stated hydrostatic balance, the Boussinesq momentum equation, and the terrain-following coordinate definition, and must rigorously use the chain rule to transform derivatives between $(x,z)$ and $(x,\\sigma)$. Conclude by showing that the exact continuous horizontal pressure gradient at fixed $z$ is identically zero for any $x$, $H_0$, $\\alpha$, $\\rho_0$, and $\\beta$ under the stated conditions, implying zero horizontal acceleration $\\partial u/\\partial t=0$.\n\nTask B (program): Implement a program that, for a specified set of parameter values, computes two vertical profiles of horizontal acceleration in $\\mathrm{m}\\,\\mathrm{s}^{-2}$ at a fixed horizontal location $x=0$:\n1. A naive terrain-following profile that computes $-(1/\\rho_0)\\,\\partial p/\\partial x$ at fixed $\\sigma$ and ignores the metric correction implied by the chain rule. This profile should expose the pressure gradient error.\n2. The exact corrected profile that adds the required metric compensation to obtain $-(1/\\rho_0)\\,\\partial p/\\partial x$ at fixed $z$, showing numerical cancellation consistent with the continuous derivation.\n\nFor both profiles, sample the vertical coordinate at $N$ equally spaced midpoints of the interval $\\sigma \\in [-1,0]$. Report the maximum absolute value over the sampled vertical levels for each profile. All reported accelerations must be in $\\mathrm{m}\\,\\mathrm{s}^{-2}$.\n\nTest suite and parameters:\n- Use $g=9.81$ (in $\\mathrm{m}\\,\\mathrm{s}^{-2}$). Evaluate at $x=0$.\n- Case $1$ (happy path, linear slope and stratification): $H_0=4000$ (in $\\mathrm{m}$), $\\alpha=2.5\\times 10^{-7}$ (in $\\mathrm{m}^{-1}$) so that the bottom slope $dH/dx=\\alpha H_0=0.001$, $\\rho_0=1025$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$), $\\beta=-2.0\\times 10^{-4}$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), $N=50$.\n- Case $2$ (boundary, flat bottom): $H_0=4000$ (in $\\mathrm{m}$), $\\alpha=0$ (in $\\mathrm{m}^{-1}$), $\\rho_0=1025$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$), $\\beta=-2.0\\times 10^{-4}$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), $N=50$.\n- Case $3$ (edge, barotropic density): $H_0=4000$ (in $\\mathrm{m}$), $\\alpha=2.5\\times 10^{-7}$ (in $\\mathrm{m}^{-1}$), $\\rho_0=1025$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$), $\\beta=0$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), $N=50$.\n- Case $4$ (steeper slope, weaker stratification): $H_0=4000$ (in $\\mathrm{m}$), $\\alpha=1.0\\times 10^{-6}$ (in $\\mathrm{m}^{-1}$), $\\rho_0=1025$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$), $\\beta=-1.0\\times 10^{-4}$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), $N=100$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and grouped per test case. For each case, output a two-element list consisting of the maximum absolute naive acceleration and the maximum absolute corrected acceleration, both in $\\mathrm{m}\\,\\mathrm{s}^{-2}$. The final output must look like\n$[ [a_{1,\\mathrm{naive}}, a_{1,\\mathrm{corrected}}], [a_{2,\\mathrm{naive}}, a_{2,\\mathrm{corrected}}], [a_{3,\\mathrm{naive}}, a_{3,\\mathrm{corrected}}], [a_{4,\\mathrm{naive}}, a_{4,\\mathrm{corrected}}] ]$\nwith numeric values replacing the symbols.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective, representing a classical demonstration of the pressure gradient error in computational oceanography. We proceed with the solution, which consists of an analytical derivation (Task A) followed by a numerical implementation (Task B).\n\n### Task A: Analytical Derivation\n\nThe objective is to demonstrate that for a resting ocean with the specified linear stratification over a linearly sloping bottom, the true horizontal acceleration is zero, and to derive the expression for this acceleration in terrain-following coordinates.\n\n**1. Pressure Field in Cartesian Coordinates**\n\nWe begin with the hydrostatic balance equation:\n$$ \\frac{\\partial p}{\\partial z} = -g \\rho(z) $$\nwhere $p(x,z)$ is the pressure, $g$ is the acceleration due to gravity, and $\\rho(z)$ is the water density. The density is given as a linear function of depth $z$:\n$$ \\rho(z) = \\rho_0 + \\beta z $$\nSubstituting the density into the hydrostatic equation gives:\n$$ \\frac{\\partial p}{\\partial z} = -g (\\rho_0 + \\beta z) $$\nWe integrate this equation with respect to $z$ from a generic depth $z$ to the free surface at $z=0$, where the gauge pressure is $p=0$:\n$$ \\int_{p(x,z)}^{p(x,0)=0} dp' = \\int_{z}^{0} -g (\\rho_0 + \\beta z') dz' $$\n$$ -p(x,z) = -g \\left[ \\rho_0 z' + \\frac{1}{2}\\beta (z')^2 \\right]_{z}^{0} $$\n$$ -p(x,z) = -g \\left[ (0) - (\\rho_0 z + \\frac{1}{2}\\beta z^2) \\right] $$\n$$ p(x,z) = -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) $$\nThis expression for pressure $p$ depends only on the vertical coordinate $z$, not on the horizontal coordinate $x$.\n\n**2. Horizontal Pressure Gradient in Cartesian Coordinates**\n\nThe horizontal acceleration is given by the Boussinesq momentum equation:\n$$ \\frac{\\partial u}{\\partial t} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_z $$\nThe subscript $z$ denotes that the partial derivative is taken at a constant depth level $z$. As derived above, $p$ is a function of $z$ only. Therefore, its partial derivative with respect to $x$ at constant $z$ is identically zero:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) \\right] = 0 $$\nConsequently, the horizontal acceleration is zero everywhere, confirming that the ocean is indeed at rest:\n$$ \\frac{\\partial u}{\\partial t} = 0 $$\n\n**3. Transformation to Terrain-Following Coordinates**\n\nWe now express the horizontal pressure gradient in the terrain-following $\\sigma$-coordinate system, defined by the mapping:\n$$ x' = x, \\quad \\sigma = \\frac{z}{H(x)} $$\nwhere $H(x) = H_0(1+\\alpha x)$ is the water depth. A function $f(x,z)$ can be expressed as a function $f(x, \\sigma(x,z))$. The chain rule for partial differentiation allows us to relate the pressure gradient at constant $z$ to derivatives in the $(x, \\sigma)$ system:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $$\nThis equation is central. It shows that the true horizontal pressure gradient consists of two parts in the transformed system: the gradient along a $\\sigma$-surface, $(\\partial p / \\partial x)_\\sigma$, and a metric correction term, $(\\partial p / \\partial \\sigma)_x (\\partial \\sigma / \\partial x)_z$. The pressure gradient error arises when numerical schemes approximate $(\\partial p / \\partial x)_z$ using only the first term, $(\\partial p / \\partial x)_\\sigma$.\n\n**4. Evaluating the Terms in $\\sigma$-Coordinates**\n\nFirst, we express pressure $p$ in $(x, \\sigma)$ coordinates by substituting $z = \\sigma H(x)$:\n$$ p(x, \\sigma) = -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) $$\n\nNow, we evaluate each term in the chain rule expression.\nThe first term is the gradient along a constant $\\sigma$ surface:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_\\sigma $$\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = -g \\left( \\rho_0 \\sigma \\frac{dH}{dx} + \\beta \\sigma^2 H(x) \\frac{dH}{dx} \\right) = -g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n\nFor the second term, we first need the vertical pressure gradient in $\\sigma$-coordinates:\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = \\frac{\\partial}{\\partial \\sigma} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_x $$\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) $$\nNext, we need the metric term $(\\partial \\sigma / \\partial x)_z$, which represents the slope of the $\\sigma$-surface at a constant $z$:\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left( \\frac{z}{H(x)} \\right)_z = z \\left( - \\frac{1}{H(x)^2} \\frac{dH}{dx} \\right) = -\\frac{z}{H(x)^2} \\frac{dH}{dx} $$\nSubstituting $z=\\sigma H(x)$:\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = -\\frac{\\sigma H(x)}{H(x)^2} \\frac{dH}{dx} = -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} $$\nThe full metric correction term is the product:\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\left[ -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) \\right] \\left[ -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\right] $$\n$$ = g \\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) = g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right) $$\n\n**5. Summation and Cancellation**\n\nFinally, we sum the two components to recover the true horizontal pressure gradient:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\underbrace{-g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right)}_{\\text{Term 1: Along } \\sigma\\text{-surface}} + \\underbrace{g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right)}_{\\text{Term 2: Metric correction}} $$\nExpanding the terms:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( -g \\frac{dH}{dx} \\rho_0 \\sigma - g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) + \\left( g \\frac{dH}{dx} \\rho_0 \\sigma + g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) $$\nThe terms cancel perfectly:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = 0 $$\nThis completes the derivation. It rigorously shows that in the continuous case, the horizontal pressure gradient at a fixed depth is zero, but its representation in terrain-following coordinates is a balance between two individually non-zero terms.\n\n### Task B: Numerical Implementation Strategy\n\nThe program will compute two acceleration profiles at $x=0$:\n1.  **Naive acceleration ($a_{\\text{naive}}$)**: This is the spurious acceleration arising from considering only the pressure gradient along the $\\sigma$-surface. It corresponds to the first term in the transformed sum.\n    $$ a_{\\text{naive}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{g}{\\rho_0} \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n2.  **Corrected acceleration ($a_{\\text{corrected}}$)**: This is the true acceleration, found by adding the metric correction term to the naive term.\n    $$ a_{\\text{corrected}} = -\\frac{1}{\\rho_0} \\left[ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z \\right] = a_{\\text{naive}} + a_{\\text{metric}} $$\n    where $a_{\\text{metric}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $. As shown analytically, $a_{\\text{corrected}}$ must be zero. The program will compute this sum to demonstrate the cancellation numerically.\n\nThe calculations are performed at $x=0$, where $H(x) = H_0$ and $dH/dx = \\alpha H_0$. The vertical coordinate $\\sigma \\in [-1,0]$ is discretized into $N$ equal subintervals, and calculations are performed at the midpoints of these subintervals:\n$$ \\sigma_k = -1 + \\frac{k - 0.5}{N}, \\quad k=1, 2, \\ldots, N $$\nFor each test case, the maximum absolute value of each acceleration profile over the $N$ vertical levels is computed and reported.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the naive and corrected pressure gradient accelerations for a resting ocean\n    in a terrain-following coordinate system for several test cases.\n    \"\"\"\n    # Define physical constant and test cases as per the problem statement.\n    g = 9.81  # Gravitational acceleration in m/s^2\n\n    test_cases = [\n        # Case 1 (happy path, linear slope and stratification)\n        # H0 (m), alpha (1/m), rho0 (kg/m^3), beta (kg/m^4), N\n        (4000.0, 2.5e-7, 1025.0, -2.0e-4, 50),\n        \n        # Case 2 (boundary, flat bottom)\n        (4000.0, 0.0,    1025.0, -2.0e-4, 50),\n        \n        # Case 3 (edge, barotropic density)\n        (4000.0, 2.5e-7, 1025.0, 0.0,     50),\n        \n        # Case 4 (steeper slope, weaker stratification)\n        (4000.0, 1.0e-6, 1025.0, -1.0e-4, 100),\n    ]\n\n    results = []\n    \n    for H0, alpha, rho0, beta, N in test_cases:\n        # Generate N sigma coordinates, representing the midpoints of N equal intervals\n        # spanning from sigma = -1 (bottom) to sigma = 0 (surface).\n        sigma_profile = -1.0 + (np.arange(N) + 0.5) / N\n        \n        # Evaluate problem parameters at the horizontal location x=0.\n        # H(x) = H0 * (1 + alpha * x) => H(0) = H0\n        # dH/dx = H0 * alpha\n        H = H0\n        dHdx = alpha * H0\n        \n        # Optimization: If the bottom is flat (dHdx=0), both pressure gradient\n        # terms are zero, hence both accelerations are zero.\n        if dHdx == 0.0:\n            results.append([0.0, 0.0])\n            continue\n            \n        # Analytically derived expressions for acceleration components evaluated at x=0.\n        #\n        # Term 1: Naive acceleration from pressure gradient along sigma surfaces.\n        # This term is responsible for the pressure gradient error.\n        # a_naive = -(1/rho0) * (dp/dx)_sigma\n        # (dp/dx)_sigma = -g * dHdx * (rho0*sigma + beta*sigma^2*H)\n        # a_naive = (g * dHdx / rho0) * (rho0*sigma + beta*sigma^2*H)\n        #         = g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Term 2: Acceleration from the metric correction term.\n        # a_metric = -(1/rho0) * (dp/dsigma)_x * (dsigma/dx)_z\n        # (dp/dsigma)_x * (dsigma/dx)_z = g * sigma * dHdx * (rho0 + beta*sigma*H)\n        # a_metric = -(g * dHdx / rho0) * sigma * (rho0 + beta*sigma*H)\n        #          = -g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Analytically, a_metric = -a_naive, so their sum is zero.\n        \n        # Vectorized calculation for the acceleration profiles over all sigma levels.\n        # This common factor represents the naive acceleration profile.\n        common_factor_profile = g * dHdx * (sigma_profile + (beta * H / rho0) * sigma_profile**2)\n        \n        a_naive_profile = common_factor_profile\n        a_metric_profile = -common_factor_profile\n        \n        # The corrected acceleration is the sum of the naive part and the metric correction.\n        # Due to floating point arithmetic, this will be very close to, but not exactly, zero.\n        a_corrected_profile = a_naive_profile + a_metric_profile\n        \n        # Find the maximum absolute value for each acceleration profile.\n        max_abs_naive = np.max(np.abs(a_naive_profile))\n        max_abs_corrected = np.max(np.abs(a_corrected_profile))\n        \n        results.append([max_abs_naive, max_abs_corrected])\n\n    # Format the final output as a single-line string according to the problem specification.\n    # Example item: \"[9.712125e-03,2.220446049250313e-16]\"\n    # The final output joins these items with commas, enclosed in brackets.\n    # Example: \"[[...],[...]]\"\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A numerical error is only as important as its impact on the solution. This final practice provides a \"back-of-the-envelope\" calculation to quantify the physical consequences of the pressure gradient error . By treating the error as a small, persistent spurious force, you will calculate the magnitude of the artificial ocean currents it can generate over a short period, offering a tangible sense of why mitigating this error is critical for the accuracy of long-term climate simulations and regional ocean forecasts.",
            "id": "3808854",
            "problem": "Consider a hydrostatic ocean model formulated in terrain-following $s$-coordinates, where the vertical coordinate is defined by $s=\\frac{z-\\eta}{H+\\eta}$ with $z$ the geometric vertical coordinate, $\\eta$ the free-surface elevation, and $H$ the resting depth. The model employs a discrete $s$-grid with $N_z=30$ vertical levels and a horizontal grid spacing $\\Delta x=10\\,\\mathrm{km}$. In a horizontally homogeneous, stably stratified, inviscid test case over gentle topography, the physical horizontal pressure gradient should vanish, but the discrete representation of the pressure gradient in terrain-following coordinates is known to suffer from Pressure Gradient Error (PGE), which manifests as a spurious depth-uniform horizontal acceleration. Suppose the diagnosed PGE produces a constant and uniform acceleration of magnitude $a=10^{-7}\\,\\mathrm{m\\,s^{-2}}$ directed along the $x$-axis.\n\nStarting from Newtonâ€™s second law as applied to a fluid parcel and the hydrostatic primitive horizontal momentum equation expressed in terrain-following $s$-coordinates, treat the PGE as an effective uniform body force per unit mass. Assume an inviscid, non-rotating ($f=0$) flow, neglect horizontal advection over the duration considered, and impose the initial condition $u(x,s,0)=0$ for the $x$-velocity. Under these assumptions, derive the time evolution of the depth-averaged (barotropic) velocity induced solely by the PGE and compute the magnitude of the spurious barotropic velocity after $T=1\\,\\mathrm{hour}$.\n\nExpress your final answer in $\\mathrm{m\\,s^{-1}}$ and round to three significant figures.",
            "solution": "The problem requires us to calculate the magnitude of the depth-averaged (barotropic) horizontal velocity induced by a spurious Pressure Gradient Error (PGE) in a terrain-following coordinate model. We begin by establishing the governing equation of motion under the specified assumptions.\n\nAccording to Newton's second law for a fluid parcel, the horizontal momentum equation is given by:\n$$\n\\frac{d\\mathbf{u}}{dt} = \\mathbf{F}\n$$\nwhere $\\mathbf{u}$ is the velocity vector and $\\mathbf{F}$ represents the sum of forces per unit mass. In this problem, the system is described by the hydrostatic primitive equations. The horizontal momentum equation in the $x$-direction is:\n$$\n\\frac{du}{dt} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} - fv + \\text{Viscous terms}\n$$\nThe problem states that the flow is inviscid, so viscous terms are zero. It is also non-rotating, so the Coriolis parameter $f=0$. The material derivative is $\\frac{du}{dt} = \\frac{\\partial u}{\\partial t} + u\\frac{\\partial u}{\\partial x} + v\\frac{\\partial u}{\\partial y} + w\\frac{\\partial u}{\\partial z}$.\n\nThe core of the problem lies in the pressure gradient term. In a terrain-following coordinate system, the horizontal pressure gradient term is numerically approximated, and this approximation can be inaccurate over sloping topography, leading to a spurious force even when the physical pressure gradient is zero (as in a resting, horizontally homogeneous fluid). The problem specifies that this error, the PGE, manifests as a constant and uniform horizontal acceleration of magnitude $a=10^{-7}\\,\\mathrm{m\\,s^{-2}}$ directed along the $x$-axis. We are instructed to treat this PGE as an effective body force per unit mass.\n\nTherefore, the physical pressure gradient term is replaced by this spurious acceleration, $a$. The governing equation for the horizontal velocity $u$ simplifies significantly. We have:\n$$\n\\frac{du}{dt} = \\frac{\\partial u}{\\partial t} + \\mathbf{u} \\cdot \\nabla u = a\n$$\nThe problem further simplifies the equation by stating that we should neglect horizontal advection. As the initial state is quiescent ($u=0$) and the forcing $a$ is spatially uniform, the resulting flow will be horizontally uniform, meaning spatial gradients of velocity like $\\frac{\\partial u}{\\partial x}$ and $\\frac{\\partial u}{\\partial y}$ are zero. This makes the horizontal advection terms zero. The PGE acceleration $a$ is also stated to be \"depth-uniform,\" which means it is not a function of the vertical coordinate $s$. Consequently, the velocity $u$ that develops will not be a function of $s$, so the vertical advection term $\\omega \\frac{\\partial u}{\\partial s}$ (where $\\omega$ is the vertical velocity in $s$-coordinates) is also zero.\n\nWith these simplifications, the momentum equation in the $x$-direction reduces to a simple ordinary differential equation with respect to time $t$:\n$$\n\\frac{\\partial u}{\\partial t} = a\n$$\nWe need to solve this equation for $u(t)$ subject to the initial condition that the fluid is at rest, i.e., $u(t=0)=0$. We integrate the equation from time $t=0$ to a general time $t$:\n$$\n\\int_{0}^{t} \\frac{\\partial u}{\\partial t'} dt' = \\int_{0}^{t} a \\, dt'\n$$\nSince $a$ is a constant, the integration yields:\n$$\nu(t) - u(0) = a \\int_{0}^{t} dt'\n$$\nSubstituting the initial condition $u(0)=0$:\n$$\nu(t) = at\n$$\nThis expression describes the time evolution of the horizontal velocity $u$ at any point in the fluid, as the forcing and initial state are uniform.\n\nNext, we need to find the time evolution of the depth-averaged (barotropic) velocity, $\\bar{u}(t)$. The barotropic velocity is defined as the integral of the horizontal velocity over the depth of the water column, divided by the total depth. In the normalized $s$-coordinate system, this corresponds to integrating from $s=-1$ (bottom) to $s=0$ (surface):\n$$\n\\bar{u}(t) = \\int_{-1}^{0} u(s,t) \\, ds\n$$\nSince we found that $u(t)=at$ is not a function of the vertical coordinate $s$, we can treat it as a constant in the integration:\n$$\n\\bar{u}(t) = \\int_{-1}^{0} (at) \\, ds = at \\int_{-1}^{0} ds = at [s]_{-1}^{0} = at (0 - (-1)) = at\n$$\nThus, the time evolution of the barotropic velocity is also given by $\\bar{u}(t) = at$.\n\nFinally, we must compute the magnitude of this spurious barotropic velocity after a time $T=1\\,\\mathrm{hour}$. The given values are:\n- Acceleration $a = 10^{-7}\\,\\mathrm{m\\,s^{-2}}$\n- Time $T = 1\\,\\mathrm{hour}$\n\nWe must first convert the time $T$ into SI units (seconds):\n$$\nT = 1\\,\\mathrm{hour} \\times \\frac{60\\,\\mathrm{minutes}}{1\\,\\mathrm{hour}} \\times \\frac{60\\,\\mathrm{seconds}}{1\\,\\mathrm{minute}} = 3600\\,\\mathrm{s}\n$$\nNow, we can calculate the magnitude of the barotropic velocity at time $T$:\n$$\n|\\bar{u}(T)| = aT = (10^{-7}\\,\\mathrm{m\\,s^{-2}}) \\times (3600\\,\\mathrm{s})\n$$\n$$\n|\\bar{u}(T)| = 3600 \\times 10^{-7}\\,\\mathrm{m\\,s^{-1}} = 3.6 \\times 10^3 \\times 10^{-7}\\,\\mathrm{m\\,s^{-1}} = 3.6 \\times 10^{-4}\\,\\mathrm{m\\,s^{-1}}\n$$\nThe problem asks for the answer to be rounded to three significant figures.\n$$\n|\\bar{u}(T)| = 3.60 \\times 10^{-4}\\,\\mathrm{m\\,s^{-1}}\n$$",
            "answer": "$$\\boxed{3.60 \\times 10^{-4}}$$"
        }
    ]
}