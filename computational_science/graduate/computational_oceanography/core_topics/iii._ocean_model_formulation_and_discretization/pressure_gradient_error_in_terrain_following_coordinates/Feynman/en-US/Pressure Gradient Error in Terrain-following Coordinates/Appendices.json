{
    "hands_on_practices": [
        {
            "introduction": "The pressure gradient error (PGE) in terrain-following coordinate models arises from the numerical challenge of computing a small horizontal force as the difference between two large, cancelling terms. This foundational practice guides you through deriving this structure from first principles for a classic resting ocean test case . By first proving the exact analytical cancellation and then implementing a numerical version that exposes the error, you will gain a concrete, hands-on understanding of the origin of this pervasive numerical artifact.",
            "id": "3808788",
            "problem": "You are asked to construct and analyze a one-dimensional resting ocean test in terrain-following coordinates to expose and resolve the pressure gradient error. Consider the horizontal coordinate $x \\in \\mathbb{R}$ and the vertical coordinate $z \\in \\mathbb{R}$ measured positive upward with the free surface at $z=0$ and the bottom at $z=-H(x)$. The free-surface elevation is fixed at $\\eta=0$ (resting ocean). The bottom topography is $H(x)=H_0(1+\\alpha x)$, where $H_0>0$ is a constant depth (in $\\mathrm{m}$) and $\\alpha$ is a small constant slope parameter (in $\\mathrm{m}^{-1}$). The density is linear in $z$: $\\rho(z)=\\rho_0+\\beta z$, where $\\rho_0>0$ is a constant reference density (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$) and $\\beta$ is a constant vertical density gradient (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), typically negative so that density increases with depth. Gravitational acceleration is $g>0$ (in $\\mathrm{m}\\,\\mathrm{s}^{-2}$).\n\nStart from the following foundational laws and definitions:\n- The hydrostatic balance: $\\partial p/\\partial z = -g \\rho$, where $p(x,z)$ is pressure (in $\\mathrm{Pa}$).\n- The Boussinesq horizontal momentum equation (no friction, no Coriolis, no external forcing): $\\partial u/\\partial t = -(1/\\rho_0)\\,\\partial p/\\partial x$, where $u(x,z,t)$ is the horizontal velocity (in $\\mathrm{m}\\,\\mathrm{s}^{-1}$).\n- The terrain-following $\\sigma$-coordinate mapping for zero free surface: $\\sigma = z/H(x)$, so that $\\sigma \\in [-1,0]$ with $\\sigma=-1$ at the bottom and $\\sigma=0$ at the surface. Use the chain rule to relate horizontal derivatives at fixed $z$ to those at fixed $\\sigma$.\n\nTask A (derivation): Derive from first principles an exact continuous expression that demonstrates the horizontal acceleration vanishes everywhere for the given resting ocean configuration. Your derivation must begin from the stated hydrostatic balance, the Boussinesq momentum equation, and the terrain-following coordinate definition, and must rigorously use the chain rule to transform derivatives between $(x,z)$ and $(x,\\sigma)$. Conclude by showing that the exact continuous horizontal pressure gradient at fixed $z$ is identically zero for any $x$, $H_0$, $\\alpha$, $\\rho_0$, and $\\beta$ under the stated conditions, implying zero horizontal acceleration $\\partial u/\\partial t=0$.\n\nTask B (program): Implement a program that, for a specified set of parameter values, computes two vertical profiles of horizontal acceleration in $\\mathrm{m}\\,\\mathrm{s}^{-2}$ at a fixed horizontal location $x=0$:\n1. A naive terrain-following profile that computes $-(1/\\rho_0)\\,\\partial p/\\partial x$ at fixed $\\sigma$ and ignores the metric correction implied by the chain rule. This profile should expose the pressure gradient error.\n2. The exact corrected profile that adds the required metric compensation to obtain $-(1/\\rho_0)\\,\\partial p/\\partial x$ at fixed $z$, showing numerical cancellation consistent with the continuous derivation.\n\nFor both profiles, sample the vertical coordinate at $N$ equally spaced midpoints of the interval $\\sigma \\in [-1,0]$. Report the maximum absolute value over the sampled vertical levels for each profile. All reported accelerations must be in $\\mathrm{m}\\,\\mathrm{s}^{-2}$.\n\nTest suite and parameters:\n- Use $g=9.81$ (in $\\mathrm{m}\\,\\mathrm{s}^{-2}$). Evaluate at $x=0$.\n- Case $1$ (happy path, linear slope and stratification): $H_0=4000$ (in $\\mathrm{m}$), $\\alpha=2.5\\times 10^{-7}$ (in $\\mathrm{m}^{-1}$) so that the bottom slope $dH/dx=\\alpha H_0=0.001$, $\\rho_0=1025$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$), $\\beta=-2.0\\times 10^{-4}$ (in $\\mathrm{kg}\\,\\mathrm{m}^{-4}$), $N=50$.\n- Case $2$ (boundary, flat bottom): $H_0=4000$, $\\alpha=0$, $\\rho_0=1025$, $\\beta=-2.0\\times 10^{-4}$, $N=50$.\n- Case $3$ (edge, barotropic density): $H_0=4000$, $\\alpha=2.5\\times 10^{-7}$, $\\rho_0=1025$, $\\beta=0$, $N=50$.\n- Case $4$ (steeper slope, weaker stratification): $H_0=4000$, $\\alpha=1.0\\times 10^{-6}$, $\\rho_0=1025$, $\\beta=-1.0\\times 10^{-4}$, $N=100$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and grouped per test case. For each case, output a two-element list consisting of the maximum absolute naive acceleration and the maximum absolute corrected acceleration, both in $\\mathrm{m}\\,\\mathrm{s}^{-2}$. The final output must look like\n$[[a_{1,\\mathrm{naive}},a_{1,\\mathrm{corrected}}],[a_{2,\\mathrm{naive}},a_{2,\\mathrm{corrected}}],[a_{3,\\mathrm{naive}},a_{3,\\mathrm{corrected}}],[a_{4,\\mathrm{naive}},a_{4,\\mathrm{corrected}}]]$\nwith numeric values replacing the symbols.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective, representing a classical demonstration of the pressure gradient error in computational oceanography. We proceed with the solution, which consists of an analytical derivation (Task A) followed by a numerical implementation (Task B).\n\n### Task A: Analytical Derivation\n\nThe objective is to demonstrate that for a resting ocean with the specified linear stratification over a linearly sloping bottom, the true horizontal acceleration is zero, and to derive the expression for this acceleration in terrain-following coordinates.\n\n**1. Pressure Field in Cartesian Coordinates**\n\nWe begin with the hydrostatic balance equation:\n$$ \\frac{\\partial p}{\\partial z} = -g \\rho(z) $$\nwhere $p(x,z)$ is the pressure, $g$ is the acceleration due to gravity, and $\\rho(z)$ is the water density. The density is given as a linear function of depth $z$:\n$$ \\rho(z) = \\rho_0 + \\beta z $$\nSubstituting the density into the hydrostatic equation gives:\n$$ \\frac{\\partial p}{\\partial z} = -g (\\rho_0 + \\beta z) $$\nWe integrate this equation with respect to $z$ from a generic depth $z$ to the free surface at $z=0$, where the gauge pressure is $p=0$:\n$$ \\int_{p(x,z)}^{p(x,0)=0} dp' = \\int_{z}^{0} -g (\\rho_0 + \\beta z') dz' $$\n$$ -p(x,z) = -g \\left[ \\rho_0 z' + \\frac{1}{2}\\beta (z')^2 \\right]_{z}^{0} $$\n$$ -p(x,z) = -g \\left[ (0) - (\\rho_0 z + \\frac{1}{2}\\beta z^2) \\right] $$\n$$ p(x,z) = -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) $$\nThis expression for pressure $p$ depends only on the vertical coordinate $z$, not on the horizontal coordinate $x$.\n\n**2. Horizontal Pressure Gradient in Cartesian Coordinates**\n\nThe horizontal acceleration is given by the Boussinesq momentum equation:\n$$ \\frac{\\partial u}{\\partial t} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_z $$\nThe subscript $z$ denotes that the partial derivative is taken at a constant depth level $z$. As derived above, $p$ is a function of $z$ only. Therefore, its partial derivative with respect to $x$ at constant $z$ is identically zero:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) \\right] = 0 $$\nConsequently, the horizontal acceleration is zero everywhere, confirming that the ocean is indeed at rest:\n$$ \\frac{\\partial u}{\\partial t} = 0 $$\n\n**3. Transformation to Terrain-Following Coordinates**\n\nWe now express the horizontal pressure gradient in the terrain-following $\\sigma$-coordinate system, defined by the mapping:\n$$ x' = x, \\quad \\sigma = \\frac{z}{H(x)} $$\nwhere $H(x) = H_0(1+\\alpha x)$ is the water depth. A function $f(x,z)$ can be expressed as a function $f(x, \\sigma(x,z))$. The chain rule for partial differentiation allows us to relate the pressure gradient at constant $z$ to derivatives in the $(x, \\sigma)$ system:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $$\nThis equation is central. It shows that the true horizontal pressure gradient consists of two parts in the transformed system: the gradient along a $\\sigma$-surface, $(\\partial p / \\partial x)_\\sigma$, and a metric correction term, $(\\partial p / \\partial \\sigma)_x (\\partial \\sigma / \\partial x)_z$. The pressure gradient error arises when numerical schemes approximate $(\\partial p / \\partial x)_z$ using only the first term, $(\\partial p / \\partial x)_\\sigma$.\n\n**4. Evaluating the Terms in $\\sigma$-Coordinates**\n\nFirst, we express pressure $p$ in $(x, \\sigma)$ coordinates by substituting $z = \\sigma H(x)$:\n$$ p(x, \\sigma) = -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) $$\n\nNow, we evaluate each term in the chain rule expression.\nThe first term is the gradient along a constant $\\sigma$ surface:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_\\sigma $$\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = -g \\left( \\rho_0 \\sigma \\frac{dH}{dx} + \\beta \\sigma^2 H(x) \\frac{dH}{dx} \\right) = -g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n\nFor the second term, we first need the vertical pressure gradient in $\\sigma$-coordinates:\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = \\frac{\\partial}{\\partial \\sigma} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_x $$\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) $$\nNext, we need the metric term $(\\partial \\sigma / \\partial x)_z$, which represents the slope of the $\\sigma$-surface at a constant $z$:\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left( \\frac{z}{H(x)} \\right)_z = z \\left( - \\frac{1}{H(x)^2} \\frac{dH}{dx} \\right) = -\\frac{z}{H(x)^2} \\frac{dH}{dx} $$\nSubstituting $z=\\sigma H(x)$:\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = -\\frac{\\sigma H(x)}{H(x)^2} \\frac{dH}{dx} = -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} $$\nThe full metric correction term is the product:\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\left[ -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) \\right] \\left[ -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\right] $$\n$$ = g \\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) = g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right) $$\n\n**5. Summation and Cancellation**\n\nFinally, we sum the two components to recover the true horizontal pressure gradient:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\underbrace{-g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right)}_{\\text{Term 1: Along } \\sigma\\text{-surface}} + \\underbrace{g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right)}_{\\text{Term 2: Metric correction}} $$\nExpanding the terms:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( -g \\frac{dH}{dx} \\rho_0 \\sigma - g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) + \\left( g \\frac{dH}{dx} \\rho_0 \\sigma + g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) $$\nThe terms cancel perfectly:\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = 0 $$\nThis completes the derivation. It rigorously shows that in the continuous case, the horizontal pressure gradient at a fixed depth is zero, but its representation in terrain-following coordinates is a balance between two individually non-zero terms.\n\n### Task B: Numerical Implementation Strategy\n\nThe program will compute two acceleration profiles at $x=0$:\n1.  **Naive acceleration ($a_{\\text{naive}}$)**: This is the spurious acceleration arising from considering only the pressure gradient along the $\\sigma$-surface. It corresponds to the first term in the transformed sum.\n    $$ a_{\\text{naive}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{g}{\\rho_0} \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n2.  **Corrected acceleration ($a_{\\text{corrected}}$)**: This is the true acceleration, found by adding the metric correction term to the naive term.\n    $$ a_{\\text{corrected}} = -\\frac{1}{\\rho_0} \\left[ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z \\right] = a_{\\text{naive}} + a_{\\text{metric}} $$\n    where $ a_{\\text{metric}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $. As shown analytically, $a_{\\text{corrected}}$ must be zero. The program will compute this sum to demonstrate the cancellation numerically.\n\nThe calculations are performed at $x=0$, where $H(x) = H_0$ and $dH/dx = \\alpha H_0$. The vertical coordinate $\\sigma \\in [-1,0]$ is discretized into $N$ equal subintervals, and calculations are performed at the midpoints of these subintervals:\n$$ \\sigma_k = -1 + \\frac{k - 0.5}{N}, \\quad k=1, 2, \\ldots, N $$\nFor each test case, the maximum absolute value of each acceleration profile over the $N$ vertical levels is computed and reported.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the naive and corrected pressure gradient accelerations for a resting ocean\n    in a terrain-following coordinate system for several test cases.\n    \"\"\"\n    # Define physical constant and test cases as per the problem statement.\n    g = 9.81  # Gravitational acceleration in m/s^2\n\n    test_cases = [\n        # Case 1 (happy path, linear slope and stratification)\n        # H0 (m), alpha (1/m), rho0 (kg/m^3), beta (kg/m^4), N\n        (4000.0, 2.5e-7, 1025.0, -2.0e-4, 50),\n        \n        # Case 2 (boundary, flat bottom)\n        (4000.0, 0.0,    1025.0, -2.0e-4, 50),\n        \n        # Case 3 (edge, barotropic density)\n        (4000.0, 2.5e-7, 1025.0, 0.0,     50),\n        \n        # Case 4 (steeper slope, weaker stratification)\n        (4000.0, 1.0e-6, 1025.0, -1.0e-4, 100),\n    ]\n\n    results = []\n    \n    for H0, alpha, rho0, beta, N in test_cases:\n        # Generate N sigma coordinates, representing the midpoints of N equal intervals\n        # spanning from sigma = -1 (bottom) to sigma = 0 (surface).\n        sigma_profile = -1.0 + (np.arange(N) + 0.5) / N\n        \n        # Evaluate problem parameters at the horizontal location x=0.\n        # H(x) = H0 * (1 + alpha * x) => H(0) = H0\n        # dH/dx = H0 * alpha\n        H = H0\n        dHdx = alpha * H0\n        \n        # Optimization: If the bottom is flat (dHdx=0), both pressure gradient\n        # terms are zero, hence both accelerations are zero.\n        if dHdx == 0.0:\n            results.append([0.0, 0.0])\n            continue\n            \n        # Analytically derived expressions for acceleration components evaluated at x=0.\n        #\n        # Term 1: Naive acceleration from pressure gradient along sigma surfaces.\n        # This term is responsible for the pressure gradient error.\n        # a_naive = -(1/rho0) * (dp/dx)_sigma\n        # (dp/dx)_sigma = -g * dHdx * (rho0*sigma + beta*sigma^2*H)\n        # a_naive = (g * dHdx / rho0) * (rho0*sigma + beta*sigma^2*H)\n        #         = g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Term 2: Acceleration from the metric correction term.\n        # a_metric = -(1/rho0) * (dp/dsigma)_x * (dsigma/dx)_z\n        # (dp/dsigma)_x * (dsigma/dx)_z = g * sigma * dHdx * (rho0 + beta*sigma*H)\n        # a_metric = -(g * dHdx / rho0) * sigma * (rho0 + beta*sigma*H)\n        #          = -g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Analytically, a_metric = -a_naive, so their sum is zero.\n        \n        # Vectorized calculation for the acceleration profiles over all sigma levels.\n        # This common factor represents the naive acceleration profile.\n        common_factor_profile = g * dHdx * (sigma_profile + (beta * H / rho0) * sigma_profile**2)\n        \n        a_naive_profile = common_factor_profile\n        a_metric_profile = -common_factor_profile\n        \n        # The corrected acceleration is the sum of the naive part and the metric correction.\n        # Due to floating point arithmetic, this will be very close to, but not exactly, zero.\n        a_corrected_profile = a_naive_profile + a_metric_profile\n        \n        # Find the maximum absolute value for each acceleration profile.\n        max_abs_naive = np.max(np.abs(a_naive_profile))\n        max_abs_corrected = np.max(np.abs(a_corrected_profile))\n        \n        results.append([max_abs_naive, max_abs_corrected])\n\n    # Format the final output as a single-line string according to the problem specification.\n    # Example item: \"[9.712125e-03,2.220446049250313e-16]\"\n    # The final output joins these items with commas, enclosed in brackets.\n    # Example: \"[[...],[...]]\"\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Intuitively, one might expect that refining a model's grid would uniformly decrease numerical errors. However, for the PGE over realistic, unsmoothed bathymetry, this is often not the case; the error can persist or even grow. This advanced practice explores this counter-intuitive behavior using scaling analysis, a powerful tool in geophysical fluid dynamics . By relating the spectral characteristics of the seabed to the numerical truncation error, you will derive a condition that determines whether grid refinement actually improves the solution, providing a theoretical justification for the common practice of bathymetric smoothing.",
            "id": "3808846",
            "problem": "Consider a hydrostatic ocean model formulated in a terrain-following vertical coordinate, denoted by the dimensionless variable $s$, which is defined through the standard mapping between the physical vertical coordinate $z$ and the terrain-following coordinate $s$ as $z(x,s)=\\eta(x)+s\\left(H(x)+\\eta(x)\\right)$. Here $H(x)>0$ denotes the resting depth measured downward from mean sea level, $\\eta(x)$ denotes the sea surface height, and $s\\in[-1,0]$ spans from bottom ($s=-1$) to surface ($s=0$). Assume the sea surface is flat, so that $\\eta(x)=0$. Let the bathymetry be given by the linear profile $H(x)=H_{0}\\left(1+\\alpha x\\right)$, where $H_{0}>0$ is a constant reference depth and $\\alpha$ is a constant bottom slope parameter. \n\nStarting from the coordinate mapping and fundamental calculus (specifically, the chain rule and the definition of partial derivatives at fixed $s$), derive a closed-form expression for the horizontal derivative at constant $s$, $\\frac{\\partial z}{\\partial x}\\big|_{s}$, as a function of $s$, $\\alpha$, and $H_{0}$. Then, based on this expression and the definition of the terrain-following coordinate geometry, explain where in the water column the magnitude $|\\partial z/\\partial x|_s|$ becomes large and why this matters for the pressure gradient error in terrain-following coordinates. \n\nExpress your final result for $\\frac{\\partial z}{\\partial x}\\big|_{s}$ as a single analytic expression in simplest form. No numerical evaluation is required. You do not need to include physical units in your final expression.",
            "solution": "The problem asks for the derivation of the horizontal derivative of the vertical coordinate at constant $s$, $\\frac{\\partial z}{\\partial x}\\big|_{s}$, in a terrain-following coordinate system, and an explanation of its relevance to the pressure gradient error.\n\nFirst, we begin with the given coordinate mapping from the physical vertical coordinate $z$ to the dimensionless terrain-following coordinate $s$:\n$$z(x,s) = \\eta(x) + s \\left( H(x) + \\eta(x) \\right)$$\nHere, $x$ is the horizontal coordinate, $\\eta(x)$ is the sea surface height, and $H(x)$ is the resting depth. The coordinate $s$ ranges from $s=-1$ at the bottom to $s=0$ at the surface.\n\nThe problem states to assume a flat sea surface, which implies $\\eta(x) = 0$. Substituting this into the mapping equation simplifies it to:\n$$z(x,s) = s H(x)$$\nThis simplified form shows that for a given $s$, the vertical position $z$ is a scaled version of the total water depth $H(x)$.\n\nNext, we are given the bathymetry profile as a linear function of $x$:\n$$H(x) = H_{0} \\left( 1 + \\alpha x \\right)$$\nwhere $H_{0} > 0$ is a constant reference depth and $\\alpha$ is a constant bottom slope parameter. We substitute this expression for $H(x)$ into our simplified mapping for $z(x,s)$:\n$$z(x,s) = s \\left[ H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\n\nThe primary objective is to find the horizontal derivative of $z$ at a constant $s$-level, denoted as $\\frac{\\partial z}{\\partial x}\\big|_{s}$. This quantity represents the slope of the terrain-following coordinate surfaces in the physical $(x, z)$ space. To compute this, we take the partial derivative of the expression for $z(x,s)$ with respect to $x$, while treating $s$ as a constant:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = \\frac{\\partial}{\\partial x} \\left[ s H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\nSince $s$ and $H_{0}$ are constants with respect to the partial differentiation with respect to $x$, we can factor them out of the derivative:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = s H_{0} \\frac{\\partial}{\\partial x} \\left( 1 + \\alpha x \\right)$$\nThe derivative of $(1 + \\alpha x)$ with respect to $x$ is simply $\\alpha$. Therefore, we arrive at the final expression for the slope of the coordinate surfaces:\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{s} = s \\alpha H_{0}$$\n\nNow, we address the second part of the problem: explaining where the magnitude of this slope, $\\left|\\frac{\\partial z}{\\partial x}\\big|_{s}\\right|$, becomes large and why this is significant for the pressure gradient error. The magnitude is:\n$$\\left|\\frac{\\partial z}{\\partial x}\\bigg|_{s}\\right| = \\left|s \\alpha H_{0}\\right| = |s| |\\alpha| H_{0}$$\nThe vertical coordinate $s$ varies in the range $s \\in [-1, 0]$. The magnitude $|s|$ is therefore largest at the bottom, where $s=-1$, and smallest (equal to zero) at the surface, where $s=0$. This means that the slope of the coordinate surfaces is steepest near the ocean floor and the surfaces become flat at the mean sea level. The magnitude of the slope is also directly proportional to the magnitude of the bottom slope parameter, $|\\alpha|$. Thus, steep bathymetry leads to steeply sloped coordinate surfaces.\n\nThe significance of this result lies in its connection to the pressure gradient error, a well-known numerical artifact in terrain-following coordinate ocean models. The horizontal pressure gradient force (PGF) is proportional to $\\frac{\\partial p}{\\partial x}\\big|_{z}$. Transforming this derivative into the $s$-coordinate system using the chain rule and the hydrostatic assumption ($\\frac{\\partial p}{\\partial z} = -\\rho g$) gives:\n$$\\frac{\\partial p}{\\partial x}\\bigg|_{z} = \\frac{\\partial p}{\\partial x}\\bigg|_{s} + \\rho g \\frac{\\partial z}{\\partial x}\\bigg|_{s}$$\nIn many oceanic situations, particularly in the deep ocean, the horizontal density gradients are small, and the true horizontal pressure gradient is a small value. However, the two terms on the right-hand side of the transformed equation can be very large, especially over steep topography. The first term, $\\frac{\\partial p}{\\partial x}\\big|_{s}$, reflects the pressure gradient along the tilted $s$-surface. The second term, $\\rho g \\frac{\\partial z}{\\partial x}\\big|_{s}$, is a correction term that accounts for the slope of the $s$-surface. These two terms are typically of opposite sign and nearly cancel each other out.\n\nThe pressure gradient error arises because numerical ocean models compute these two large terms using finite difference approximations. The truncation errors associated with these discrete approximations mean that the cancellation is not perfect. The residual, a spurious (non-physical) force, can drive artificial currents and contaminate the model solution. The magnitude of the second term is directly proportional to $\\left|\\frac{\\partial z}{\\partial x}\\big|_{s}\\right|$. Since we found that this slope is largest near the bottom ($s \\to -1$) and over steep topography (large $|\\alpha|$), the pressure gradient error is most severe in these regions. This is because the two terms to be subtracted are at their largest there, and any fixed relative error in their computation leads to a large absolute error in their difference.",
            "answer": "$$\\boxed{s \\alpha H_{0}}$$"
        },
        {
            "introduction": "Intuitively, one might expect that refining a model's grid would uniformly decrease numerical errors. However, for the PGE over realistic, unsmoothed bathymetry, this is often not the case; the error can persist or even grow. This advanced practice explores this counter-intuitive behavior using scaling analysis, a powerful tool in geophysical fluid dynamics . By relating the spectral characteristics of the seabed to the numerical truncation error, you will derive a condition that determines whether grid refinement actually improves the solution, providing a theoretical justification for the common practice of bathymetric smoothing.",
            "id": "3808853",
            "problem": "In a hydrostatic, Boussinesq ocean model using terrain-following coordinates, the horizontal pressure gradient is evaluated along sloping coordinate surfaces that conform to the bathymetry. It is empirically observed that the Pressure Gradient Error (PGE) persists under mesh refinement when the bathymetry is left unsmoothed. In this problem you will build a first-principles scaling argument that explains this persistence and then derive a precise spectral condition under which mesh refinement reduces PGE faster than the bathymetric slope increases.\n\nAssume the following scientifically standard bases:\n- Hydrostatic balance is given by $\\partial p/\\partial z = -\\rho g$ and the true horizontal pressure gradient can be expressed as a vertical integral of horizontal density gradients. In terrain-following coordinates, the discrete approximation of this integral involves metric terms proportional to bathymetric slope.\n- For a scheme with nominal horizontal truncation order $p \\in \\mathbb{N}$, the leading truncation error for the discretized pressure gradient scales as $\\Delta x^{p}$ times a smooth functional of the solution fields and geometric metrics. When the coordinate surfaces slope with the bottom, the leading geometric dependence can be modeled as a power of the bathymetric slope $s(x) = |\\partial h/\\partial x|$, so that the magnitude of the leading PGE scales like $E \\sim C\\, s^{m}\\, \\Delta x^{p}$, where $m \\in \\mathbb{N}$ is a method-dependent integer and $C$ is a constant that may include stratification factors but does not depend on $\\Delta x$.\n- The bathymetry $h(x)$ is a statistically stationary rough field in one horizontal dimension with an inertial-range wavenumber spectrum $S_{h}(k) = A k^{-\\beta}$ on the band $k \\in [k_{0}, k_{\\max}]$, where $A>0$, $\\beta>0$, $k_{0}>0$, and $k_{\\max} \\sim \\pi/\\Delta x$.\n\nTasks:\n1. Starting from the definition $s(x) = |\\partial h/\\partial x|$ and the spectral model $S_{h}(k) = A k^{-\\beta}$, derive the scaling of the root-mean-square bathymetric slope $s_{\\mathrm{rms}}$ with grid spacing $\\Delta x$ in terms of $\\beta$. You may treat $k_{\\max} \\gg k_{0}$ and consider the limit $\\Delta x \\to 0$.\n2. Using the truncation error scaling $E \\sim C\\, s^{m}\\, \\Delta x^{p}$ and your result for $s_{\\mathrm{rms}}(\\Delta x)$, determine the refinement exponent $\\alpha$ such that $E \\propto \\Delta x^{\\alpha}$ as $\\Delta x \\to 0$. Explain, in words, why this implies that PGE can persist or even grow under mesh refinement if the bathymetry is not smoothed.\n3. Let the mesh be refined by a factor $r>1$, so that $\\Delta x \\mapsto \\Delta x/r$. Define the slope growth exponent $\\gamma$ by $s_{\\mathrm{rms}} \\propto \\Delta x^{-\\gamma}$. Formalize the statement “refinement reduces PGE faster than the bathymetric slope increases” as the inequality $\\alpha > \\gamma$ between refinement exponents, and solve this inequality for the bathymetric spectral exponent. Denote by $\\beta_{\\mathrm{crit}}$ the threshold value of $\\beta$ such that the condition holds if and only if $\\beta > \\beta_{\\mathrm{crit}}$.\n\nExpress your final answer as a single closed-form analytical expression for $\\beta_{\\mathrm{crit}}$ in terms of $m$ and $p$. Do not include units. Do not provide an inequality. Do not provide any intermediate steps in the final answer.",
            "solution": "We begin from hydrostatic balance $\\partial p/\\partial z = -\\rho g$ and the recognition that, in terrain-following coordinates, discrete horizontal pressure gradients inherit metric factors that are functions of the bottom slope. For a consistent, $p$-th order horizontal discretization of smooth fields, the leading truncation error amplitude scales like $\\Delta x^{p}$ times a bounded functional of the fields and geometry. When the geometry possesses a slope $s = |\\partial h/\\partial x|$, the leading coupling to geometry can be represented as a polynomial in $s$, hence the modeling ansatz $E \\sim C\\, s^{m}\\, \\Delta x^{p}$ with some integer $m \\geq 1$ that depends on the discretization (for many widely used terrain-following pressure-gradient schemes, $m=2$).\n\nTo quantify how rough bathymetry disrupts convergence, we represent $h(x)$ as a statistically stationary rough process with a one-dimensional wavenumber spectrum $S_{h}(k) = A k^{-\\beta}$ for $k \\in [k_{0}, k_{\\max}]$, with $k_{\\max} \\sim \\pi/\\Delta x$. The root-mean-square (RMS) slope is\n$$\ns_{\\mathrm{rms}}^{2} \\equiv \\Big\\langle \\Big(\\frac{\\partial h}{\\partial x}\\Big)^{2} \\Big\\rangle\n= \\int_{k_{0}}^{k_{\\max}} k^{2} S_{h}(k)\\, \\mathrm{d}k\n= A \\int_{k_{0}}^{k_{\\max}} k^{2-\\beta}\\, \\mathrm{d}k.\n$$\nFor $\\beta \\neq 3$, this integral evaluates to\n$$\ns_{\\mathrm{rms}}^{2} = \\frac{A}{3-\\beta}\\left(k_{\\max}^{3-\\beta} - k_{0}^{3-\\beta}\\right).\n$$\nIn the refinement limit $\\Delta x \\to 0$ with $k_{\\max} \\sim \\pi/\\Delta x \\gg k_{0}$ and $\\beta < 3$, the upper limit dominates, giving\n$$\ns_{\\mathrm{rms}}^{2} \\sim \\frac{A}{3-\\beta}\\, k_{\\max}^{3-\\beta} \\sim \\frac{A}{3-\\beta}\\, \\Big(\\frac{\\pi}{\\Delta x}\\Big)^{3-\\beta}.\n$$\nTherefore,\n$$\ns_{\\mathrm{rms}} \\propto \\Delta x^{-\\gamma}, \\quad \\text{with} \\quad \\gamma \\equiv \\frac{3-\\beta}{2} \\quad \\text{for} \\quad \\beta<3.\n$$\nFor $\\beta = 3$, $s_{\\mathrm{rms}}$ tends to a constant (up to logarithmic corrections), and for $\\beta>3$ it decreases with refinement; the roughness-driven challenge arises for $\\beta<3$.\n\nNext, combine the truncation error model $E \\sim C\\, s^{m}\\, \\Delta x^{p}$ with the scaling for $s_{\\mathrm{rms}}$ to obtain\n$$\nE \\propto s_{\\mathrm{rms}}^{m}\\, \\Delta x^{p} \\propto \\Delta x^{-m\\gamma}\\, \\Delta x^{p} = \\Delta x^{\\alpha}, \\quad \\text{with} \\quad \\alpha \\equiv p - m\\gamma = p - m\\,\\frac{3-\\beta}{2}.\n$$\nThus, under mesh refinement $\\Delta x \\mapsto \\Delta x/r$ with $r>1$, the error decreases by a factor $r^{\\alpha}$. If $\\alpha \\leq 0$ (i.e., $p \\leq m(3-\\beta)/2$), then the nominal truncation error decay with $\\Delta x^{p}$ is offset by the growth of unresolved slopes with refinement, causing the error to stagnate or even increase as resolution is increased. This explains why Pressure Gradient Error persists under mesh refinement when bathymetric roughness is not smoothed: the act of refining the mesh raises $k_{\\max}$ and thereby increases $s_{\\mathrm{rms}}$, which can outpace the formal order of accuracy.\n\nFinally, formalize “refinement reduces PGE faster than the bathymetric slope increases” by comparing exponents under refinement by a factor $r$: the PGE decreases as $r^{\\alpha}$ while the RMS slope increases as $r^{\\gamma}$. The stated criterion is\n$$\n\\alpha > \\gamma.\n$$\nSubstitute $\\alpha = p - m\\gamma$ to obtain\n$$\np - m\\gamma > \\gamma \\quad \\Longleftrightarrow \\quad p > (m+1)\\gamma \\quad \\Longleftrightarrow \\quad \\gamma < \\frac{p}{m+1}.\n$$\nUsing $\\gamma = (3-\\beta)/2$, this becomes\n$$\n\\frac{3-\\beta}{2} < \\frac{p}{m+1} \\quad \\Longleftrightarrow \\quad \\beta > 3 - \\frac{2p}{m+1}.\n$$\nDefine $\\beta_{\\mathrm{crit}}$ so that the condition holds if and only if $\\beta > \\beta_{\\mathrm{crit}}$. Therefore,\n$$\n\\beta_{\\mathrm{crit}} = 3 - \\frac{2p}{m+1}.\n$$\nThis expression is the requested closed-form threshold. It shows that higher truncation order $p$ and lower geometric sensitivity $m$ both relax the spectral steepness needed to guarantee that refinement suppresses PGE more rapidly than the slope field intensifies. In the practically common case $m=2$ and $p=2$, one finds $\\beta_{\\mathrm{crit}} = 3 - \\frac{4}{3} = \\frac{5}{3}$, consistent with the notion that spectra steeper than $k^{-5/3}$ favor convergence in the presence of rough bathymetry.",
            "answer": "$$\\boxed{3 - \\frac{2p}{m+1}}$$"
        }
    ]
}