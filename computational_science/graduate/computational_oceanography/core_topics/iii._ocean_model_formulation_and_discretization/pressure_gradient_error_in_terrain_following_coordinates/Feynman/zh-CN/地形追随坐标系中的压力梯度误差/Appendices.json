{
    "hands_on_practices": [
        {
            "introduction": "地形跟随坐标中的压力梯度误差（PGE）问题的核心，在于将平直的$z$坐标系转换为倾斜的$\\sigma$坐标系。本练习  提供了一种直接量化这些新坐标面斜率的方法。通过推导这个斜率，我们可以洞察转换后的压力梯度分量在何处会变得巨大，从而为理解潜在的数值误差来源奠定基础。",
            "id": "3808846",
            "problem": "考虑一个用随地形变化的垂直坐标（用无量纲变量$\\sigma$表示）建立的静力海洋模型。该坐标通过物理垂直坐标$z$和随地形变化的坐标$\\sigma$之间的标准映射来定义，即$z(x,\\sigma)=\\eta(x)+\\sigma\\left(H(x)+\\eta(x)\\right)$。此处，$H(x)>0$表示从平均海平面向下测量的静止深度，$\\eta(x)$表示海面高度，$\\sigma\\in[-1,0]$从底部（$\\sigma=-1$）延伸到表面（$\\sigma=0$）。假设海面是平的，因此$\\eta(x)=0$。设水深由线性剖面$H(x)=H_{0}\\left(1+\\alpha x\\right)$给出，其中$H_{0}>0$是一个恒定的参考深度，$\\alpha$是一个恒定的底坡参数。\n\n从坐标映射和基础微积分（特别是链式法则和固定$\\sigma$时的偏导数定义）出发，推导在常数$\\sigma$处的水平导数$\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$的一个闭式表达式，该表达式是$\\sigma$、$\\alpha$和$H_{0}$的函数。然后，基于这个表达式和随地形变化坐标几何的定义，解释在水柱的哪个位置$|\\partial z/\\partial x|$的量值会变大，以及为什么这对于随地形变化坐标中的压力梯度误差很重要。\n\n将$\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$的最终结果表示为最简形式的单个解析表达式。不需要进行数值计算。最终表达式中无需包含物理单位。",
            "solution": "题目要求在随地形变化的坐标系中，推导在常数$\\sigma$处垂直坐标的水平导数$\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$，并解释其与压力梯度误差的相关性。\n\n首先，我们从给定的从物理垂直坐标$z$到无量纲随地形变化坐标$\\sigma$的坐标映射开始：\n$$z(x,\\sigma) = \\eta(x) + \\sigma \\left( H(x) + \\eta(x) \\right)$$\n此处，$x$是水平坐标，$\\eta(x)$是海面高度，$H(x)$是静止深度。坐标$\\sigma$的范围是从底部的$\\sigma=-1$到表面的$\\sigma=0$。\n\n题目说明要假设海面是平的，这意味着$\\eta(x) = 0$。将此代入映射方程，可简化为：\n$$z(x,\\sigma) = \\sigma H(x)$$\n这个简化形式表明，对于给定的$\\sigma$，垂直位置$z$是总水深$H(x)$的一个缩放版本。\n\n接下来，我们得到水深剖面是$x$的线性函数：\n$$H(x) = H_{0} \\left( 1 + \\alpha x \\right)$$\n其中$H_{0} > 0$是一个恒定的参考深度，$\\alpha$是一个恒定的底坡参数。我们将这个$H(x)$的表达式代入我们简化的$z(x,\\sigma)$映射中：\n$$z(x,\\sigma) = \\sigma \\left[ H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\n\n主要目标是求出在常数$\\sigma$层上$z$的水平导数，记为$\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$。这个量代表了随地形变化坐标面在物理$(x, z)$空间中的斜率。为了计算它，我们对$z(x,\\sigma)$的表达式关于$x$求偏导，同时将$\\sigma$视为常数：\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ \\sigma H_{0} \\left( 1 + \\alpha x \\right) \\right]$$\n由于$\\sigma$和$H_{0}$对于关于$x$的偏微分是常数，我们可以将它们从导数中提出来：\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = \\sigma H_{0} \\frac{\\partial}{\\partial x} \\left( 1 + \\alpha x \\right)$$\n$(1 + \\alpha x)$关于$x$的导数就是$\\alpha$。因此，我们得到坐标面斜率的最终表达式：\n$$\\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = \\sigma \\alpha H_{0}$$\n\n现在，我们来解决问题的第二部分：解释这个斜率的量值$\\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$在哪里变大，以及为什么这对于压力梯度误差很重要。其量值为：\n$$\\left|\\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma}\\right| = \\left|\\sigma \\alpha H_{0}\\right| = |\\sigma| |\\alpha| H_{0}$$\n垂直坐标$\\sigma$在范围$\\sigma \\in [-1, 0]$内变化。因此，量值$|\\sigma|$在底部（$\\sigma=-1$）处最大，在表面（$\\sigma=0$）处最小（等于零）。这意味着坐标面的斜率在靠近海底处最陡，而在平均海平面处变为平坦。斜率的量值也与底坡参数的量值$|\\alpha|$成正比。因此，陡峭的水深导致陡峭的坐标面。\n\n这个结果的重要性在于它与压力梯度误差的联系，这是随地形变化坐标海洋模型中一个众所周知的数值伪影。$x$方向的水平压力梯度力(PGF)由$-\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\big|_{z}$给出。当将其转换到$\\sigma$坐标系时，严谨的推导（如正文所示）表明，物理坐标中的水平压力梯度由两部分组成：\n$$ \\left(\\frac{\\partial p}{\\partial x}\\right)_z = \\left(\\frac{\\partial p}{\\partial x}\\right)_\\sigma + \\rho g \\left(\\frac{\\partial z}{\\partial x}\\right)_\\sigma $$\n在许多海洋情况下，特别是在深海中，水平密度梯度很小，真实的水平压力梯度是一个很小的值，甚至为零。然而，转换后方程右侧的两项可能非常大，尤其是在陡峭地形上。第一项$\\frac{\\partial p}{\\partial x}\\big|_{\\sigma}$反映了沿倾斜的$\\sigma$面的压力梯度。第二项$\\rho g \\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$是一个校正项，用于说明$\\sigma$面的斜率。这两项通常符号相反，几乎相互抵消。\n\n压力梯度误差的产生是因为数值海洋模型使用有限差分近似来计算这两个大项。与这些离散近似相关的截断误差意味着抵消并不完美。残余的虚假（非物理）力可以驱动人为的洋流并污染模型解。第二项的量值与$\\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$成正比。由于我们发现这个斜率在靠近底部（$\\sigma \\to -1$）和陡峭地形（大的$|\\alpha|$）处最大，因此压力梯度误差在这些区域最为严重。这是因为在那里要相加的两项都达到最大值，它们计算中的任何固定相对误差都会导致其和的巨大绝对误差。",
            "answer": "$$\\boxed{\\sigma \\alpha H_{0}}$$"
        },
        {
            "introduction": "在前一个几何直觉的基础上，本练习  深入探讨了完整的压力梯度计算。它采用一个标准的“斜坡上的静止海洋”测试案例，从解析上证明了压力梯度的各个分量（虽然各自很大）如何精确地相互抵消。随附的计算任务通过展示“朴素”计算会产生巨大误差，而正确的公式则能恢复预期的静止状态，从而强调了度量校正项的实际重要性。",
            "id": "3808788",
            "problem": "要求您在地形跟随坐标系中构建并分析一个一维静止海洋试验，以揭示并解决压强梯度误差。考虑水平坐标$x \\in \\mathbb{R}$和垂直坐标$z \\in \\mathbb{R}$，其中$z$向上为正，自由表面位于$z=0$，底部位于$z=-H(x)$。自由面高程固定为$\\eta=0$（静止海洋）。底部地形为$H(x)=H_0(1+\\alpha x)$，其中$H_0>0$是一个恒定深度（单位：$\\mathrm{m}$），$\\alpha$是一个小的恒定斜率参数（单位：$\\mathrm{m}^{-1}$）。密度是$z$的线性函数：$\\rho(z)=\\rho_0+\\beta z$，其中$\\rho_0>0$是一个恒定参考密度（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-3}$），$\\beta$是一个恒定垂直密度梯度（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-4}$），通常为负值，以使密度随深度增加。重力加速度为$g>0$（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）。\n\n从以下基本定律和定义出发：\n- 静水平衡：$\\partial p/\\partial z = -g \\rho$，其中$p(x,z)$是压强（单位：$\\mathrm{Pa}$）。\n- Boussinesq水平动量方程（无摩擦、无科里奥利力、无外力）：$\\partial u/\\partial t = -(1/\\rho_0)\\,\\partial p/\\partial x$，其中$u(x,z,t)$是水平速度（单位：$\\mathrm{m}\\,\\mathrm{s}^{-1}$）。\n- 零自由表面下的地形跟随$\\sigma$坐标映射：$\\sigma = z/H(x)$，因此$\\sigma \\in [-1,0]$，其中$\\sigma=-1$对应底部，$\\sigma=0$对应表面。使用链式法则将固定$z$处的水平导数与固定$\\sigma$处的水平导数关联起来。\n\n任务 A（推导）：从第一性原理出发，推导一个精确的连续表达式，证明对于给定的静止海洋配置，水平加速度处处为零。您的推导必须从所述的静水平衡、Boussinesq动量方程和地形跟随坐标定义开始，并严格使用链式法则来变换$(x,z)$和$(x,\\sigma)$坐标系之间的导数。最后，通过证明在所述条件下，对于任何$x$、$H_0$、$\\alpha$、$\\rho_0$和$\\beta$，固定$z$处的精确连续水平压强梯度恒等于零，从而得出水平加速度$\\partial u/\\partial t=0$。\n\n任务 B（程序）：实现一个程序，对于一组指定的参数值，在固定的水平位置$x=0$处计算水平加速度的两个垂直剖面（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）：\n1. 一个朴素的地形跟随剖面，它在固定的$\\sigma$处计算$-(1/\\rho_0)\\,\\partial p/\\partial x$，并忽略链式法则所隐含的度量校正项。该剖面应能揭示压强梯度误差。\n2. 精确的校正后剖面，它加上了所需的度量补偿以获得固定$z$处的$-(1/\\rho_0)\\,\\partial p/\\partial x$，显示出与连续推导一致的数值抵消。\n\n对于这两个剖面，在区间$\\sigma \\in [-1,0]$的$N$个等距中点上对垂直坐标进行采样。报告每个剖面在所有采样垂直层上的最大绝对值。所有报告的加速度单位必须是$\\mathrm{m}\\,\\mathrm{s}^{-2}$。\n\n测试套件和参数：\n- 使用$g=9.81$（单位：$\\mathrm{m}\\,\\mathrm{s}^{-2}$）。在$x=0$处进行计算。\n- 案例 1（理想情况，线性的斜坡和分层）：$H_0=4000$（单位：$\\mathrm{m}$），$\\alpha=2.5\\times 10^{-7}$（单位：$\\mathrm{m}^{-1}$），使得底部斜率$dH/dx=\\alpha H_0=0.001$，$\\rho_0=1025$（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-3}$），$\\beta=-2.0\\times 10^{-4}$（单位：$\\mathrm{kg}\\,\\mathrm{m}^{-4}$），$N=50$。\n- 案例 2（边界情况，平坦底部）：$H_0=4000$，$\\alpha=0$，$\\rho_0=1025$，$\\beta=-2.0\\times 10^{-4}$，$N=50$。\n- 案例 3（边缘情况，正压密度）：$H_0=4000$，$\\alpha=2.5\\times 10^{-7}$，$\\rho_0=1025$，$\\beta=0$，$N=50$。\n- 案例 4（更陡的斜坡，更弱的分层）：$H_0=4000$，$\\alpha=1.0\\times 10^{-6}$，$\\rho_0=1025$，$\\beta=-1.0\\times 10^{-4}$，$N=100$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，并按测试案例分组。对于每个案例，输出一个包含两个元素的列表，分别是朴素加速度的最大绝对值和校正后加速度的最大绝对值，单位均为$\\mathrm{m}\\,\\mathrm{s}^{-2}$。最终输出必须类似于\n$[[a_{1,\\mathrm{naive}},a_{1,\\mathrm{corrected}}],[a_{2,\\mathrm{naive}},a_{2,\\mathrm{corrected}}],[a_{3,\\mathrm{naive}},a_{3,\\mathrm{corrected}}],[a_{4,\\mathrm{naive}},a_{4,\\mathrm{corrected}}]]$\n，其中的符号用数值替换。",
            "solution": "该问题是有效的，因为它具有科学依据、是良定的且客观，代表了计算海洋学中压强梯度误差的一个经典演示。我们开始进行解答，包括解析推导（任务 A）和随后的数值实现（任务 B）。\n\n### 任务 A：解析推导\n\n目标是证明，对于在具有线性倾斜底部的静止海洋中，指定的线性分层条件下，真实的水平加速度为零，并推导出在地形跟随坐标系中该加速度的表达式。\n\n**1. 笛卡尔坐标系中的压强场**\n\n我们从静水平衡方程开始：\n$$ \\frac{\\partial p}{\\partial z} = -g \\rho(z) $$\n其中$p(x,z)$是压强，$g$是重力加速度，$\\rho(z)$是水的密度。密度是深度$z$的线性函数：\n$$ \\rho(z) = \\rho_0 + \\beta z $$\n将密度代入静水方程得到：\n$$ \\frac{\\partial p}{\\partial z} = -g (\\rho_0 + \\beta z) $$\n我们将此方程对$z$从通用深度$z$积分到自由表面$z=0$处，此处的表压为$p=0$：\n$$ \\int_{p(x,z)}^{p(x,0)=0} dp' = \\int_{z}^{0} -g (\\rho_0 + \\beta z') dz' $$\n$$ -p(x,z) = -g \\left[ \\rho_0 z' + \\frac{1}{2}\\beta (z')^2 \\right]_{z}^{0} $$\n$$ -p(x,z) = -g \\left[ (0) - (\\rho_0 z + \\frac{1}{2}\\beta z^2) \\right] $$\n$$ p(x,z) = -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) $$\n这个压强$p$的表达式只依赖于垂直坐标$z$，而不依赖于水平坐标$x$。\n\n**2. 笛卡尔坐标系中的水平压强梯度**\n\n水平加速度由 Boussinesq 动量方程给出：\n$$ \\frac{\\partial u}{\\partial t} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_z $$\n下标$z$表示偏导数是在恒定深度$z$水平上求的。如上所述，$p$仅是$z$的函数。因此，其在恒定$z$下对$x$的偏导数恒等于零：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 z + \\frac{1}{2}\\beta z^2 \\right) \\right] = 0 $$\n因此，水平加速度处处为零，证实了海洋确实处于静止状态：\n$$ \\frac{\\partial u}{\\partial t} = 0 $$\n\n**3. 变换到地形跟随坐标系**\n\n现在，我们在地形跟随$\\sigma$坐标系中表示水平压强梯度，该坐标系通过以下映射定义：\n$$ x' = x, \\quad \\sigma = \\frac{z}{H(x)} $$\n其中$H(x) = H_0(1+\\alpha x)$是水深。函数$f(x,z)$可以表示为函数$f(x, \\sigma(x,z))$。偏导数的链式法则使我们能够将恒定$z$处的压强梯度与$(x, \\sigma)$系统中的导数关联起来：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $$\n这个方程是核心。它表明，在变换后的系统中，真实的水平压强梯度由两部分组成：沿着$\\sigma$表面的梯度$(\\partial p / \\partial x)_\\sigma$和一个度量校正项$(\\partial p / \\partial \\sigma)_x (\\partial \\sigma / \\partial x)_z$。当数值方案仅使用第一项$(\\partial p / \\partial x)_\\sigma$来近似$(\\partial p / \\partial x)_z$时，就会产生压强梯度误差。\n\n**4. 计算$\\sigma$坐标系中的各项**\n\n首先，我们通过代入$z = \\sigma H(x)$来用$(x, \\sigma)$坐标表示压强$p$：\n$$ p(x, \\sigma) = -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) $$\n\n现在，我们计算链式法则表达式中的每一项。\n第一项是沿恒定$\\sigma$表面的梯度：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{\\partial}{\\partial x} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_\\sigma $$\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = -g \\left( \\rho_0 \\sigma \\frac{dH}{dx} + \\beta \\sigma^2 H(x) \\frac{dH}{dx} \\right) = -g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n\n对于第二项，我们首先需要$\\sigma$坐标系中的垂直压强梯度：\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = \\frac{\\partial}{\\partial \\sigma} \\left[ -g \\left( \\rho_0 \\sigma H(x) + \\frac{1}{2}\\beta \\sigma^2 H(x)^2 \\right) \\right]_x $$\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x = -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) $$\n接下来，我们需要度量项$(\\partial \\sigma / \\partial x)_z$，它表示在恒定$z$处$\\sigma$表面的斜率：\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\frac{\\partial}{\\partial x} \\left( \\frac{z}{H(x)} \\right)_z = z \\left( - \\frac{1}{H(x)^2} \\frac{dH}{dx} \\right) = -\\frac{z}{H(x)^2} \\frac{dH}{dx} $$\n代入$z=\\sigma H(x)$：\n$$ \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = -\\frac{\\sigma H(x)}{H(x)^2} \\frac{dH}{dx} = -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} $$\n完整的度量校正项是两者的乘积：\n$$ \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z = \\left[ -g \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) \\right] \\left[ -\\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\right] $$\n$$ = g \\frac{\\sigma}{H(x)} \\frac{dH}{dx} \\left( \\rho_0 H(x) + \\beta \\sigma H(x)^2 \\right) = g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right) $$\n\n**5. 求和与抵消**\n\n最后，我们将这两个分量相加，以恢复真实的水平压强梯度：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\underbrace{-g \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right)}_{\\text{第1项：沿 } \\sigma\\text{-表面}} + \\underbrace{g \\sigma \\frac{dH}{dx} \\left( \\rho_0 + \\beta \\sigma H(x) \\right)}_{\\text{第2项：度量校正}} $$\n展开各项：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = \\left( -g \\frac{dH}{dx} \\rho_0 \\sigma - g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) + \\left( g \\frac{dH}{dx} \\rho_0 \\sigma + g \\frac{dH}{dx} \\beta \\sigma^2 H(x) \\right) $$\n这些项完全抵消：\n$$ \\left( \\frac{\\partial p}{\\partial x} \\right)_z = 0 $$\n推导至此完成。它严格地证明了，在连续情况下，固定深度处的水平压强梯度为零，但其在地形跟随坐标系中的表示是两个各自非零项之间的平衡。\n\n### 任务 B：数值实现策略\n\n程序将在$x=0$处计算两个加速度剖面：\n1.  **朴素加速度 ($a_{\\text{naive}}$)**：这是仅考虑沿$\\sigma$表面的压强梯度而产生的伪加速度。它对应于变换后总和中的第一项。\n    $$ a_{\\text{naive}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma = \\frac{g}{\\rho_0} \\frac{dH}{dx} \\left( \\rho_0 \\sigma + \\beta \\sigma^2 H(x) \\right) $$\n2.  **校正后加速度 ($a_{\\text{corrected}}$)**：这是真实的加速度，通过将度量校正项加到朴素项上得到。\n    $$ a_{\\text{corrected}} = -\\frac{1}{\\rho_0} \\left[ \\left( \\frac{\\partial p}{\\partial x} \\right)_\\sigma + \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z \\right] = a_{\\text{naive}} + a_{\\text{metric}} $$\n    其中$ a_{\\text{metric}} = -\\frac{1}{\\rho_0} \\left( \\frac{\\partial p}{\\partial \\sigma} \\right)_x \\left( \\frac{\\partial \\sigma}{\\partial x} \\right)_z $。如解析所示，$a_{\\text{corrected}}$必须为零。程序将计算这个和，以数值方式演示抵消。\n\n计算在$x=0$处进行，此时$H(x) = H_0$且$dH/dx = \\alpha H_0$。垂直坐标$\\sigma \\in [-1,0]$被离散化为$N$个相等的子区间，并在这些子区间的中点进行计算：\n$$ \\sigma_k = -1 + \\frac{k - 0.5}{N}, \\quad k=1, 2, \\ldots, N $$\n对于每个测试案例，将计算并报告每个加速度剖面在$N$个垂直层上的最大绝对值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the naive and corrected pressure gradient accelerations for a resting ocean\n    in a terrain-following coordinate system for several test cases.\n    \"\"\"\n    # Define physical constant and test cases as per the problem statement.\n    g = 9.81  # Gravitational acceleration in m/s^2\n\n    test_cases = [\n        # Case 1 (happy path, linear slope and stratification)\n        # H0 (m), alpha (1/m), rho0 (kg/m^3), beta (kg/m^4), N\n        (4000.0, 2.5e-7, 1025.0, -2.0e-4, 50),\n        \n        # Case 2 (boundary, flat bottom)\n        (4000.0, 0.0,    1025.0, -2.0e-4, 50),\n        \n        # Case 3 (edge, barotropic density)\n        (4000.0, 2.5e-7, 1025.0, 0.0,     50),\n        \n        # Case 4 (steeper slope, weaker stratification)\n        (4000.0, 1.0e-6, 1025.0, -1.0e-4, 100),\n    ]\n\n    results = []\n    \n    for H0, alpha, rho0, beta, N in test_cases:\n        # Generate N sigma coordinates, representing the midpoints of N equal intervals\n        # spanning from sigma = -1 (bottom) to sigma = 0 (surface).\n        sigma_profile = -1.0 + (np.arange(N) + 0.5) / N\n        \n        # Evaluate problem parameters at the horizontal location x=0.\n        # H(x) = H0 * (1 + alpha * x) => H(0) = H0\n        # dH/dx = H0 * alpha\n        H = H0\n        dHdx = alpha * H0\n        \n        # Optimization: If the bottom is flat (dHdx=0), both pressure gradient\n        # terms are zero, hence both accelerations are zero.\n        if dHdx == 0.0:\n            results.append([0.0, 0.0])\n            continue\n            \n        # Analytically derived expressions for acceleration components evaluated at x=0.\n        #\n        # Term 1: Naive acceleration from pressure gradient along sigma surfaces.\n        # This term is responsible for the pressure gradient error.\n        # a_naive = -(1/rho0) * (dp/dx)_sigma\n        # (dp/dx)_sigma = -g * dHdx * (rho0*sigma + beta*sigma^2*H)\n        # a_naive = (g / rho0) * dHdx * (rho0*sigma + beta*sigma^2*H)\n        #         = g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Term 2: Acceleration from the metric correction term.\n        # a_metric = -(1/rho0) * (dp/dsigma)_x * (dsigma/dx)_z\n        # (dp/dsigma)_x * (dsigma/dx)_z = g * sigma * dHdx * (rho0 + beta*sigma*H)\n        # a_metric = -(g / rho0) * sigma * dHdx * (rho0 + beta*sigma*H)\n        #          = -g * dHdx * (sigma + (beta*H/rho0)*sigma**2)\n        #\n        # Analytically, a_metric = -a_naive, so their sum is zero.\n        \n        # Vectorized calculation for the acceleration profiles over all sigma levels.\n        # This common factor represents the naive acceleration profile.\n        common_factor_profile = g * dHdx * (sigma_profile + (beta * H / rho0) * sigma_profile**2)\n        \n        a_naive_profile = common_factor_profile\n        a_metric_profile = -common_factor_profile\n        \n        # The corrected acceleration is the sum of the naive part and the metric correction.\n        # Due to floating point arithmetic, this will be very close to, but not exactly, zero.\n        a_corrected_profile = a_naive_profile + a_metric_profile\n        \n        # Find the maximum absolute value for each acceleration profile.\n        max_abs_naive = np.max(np.abs(a_naive_profile))\n        max_abs_corrected = np.max(np.abs(a_corrected_profile))\n        \n        results.append([max_abs_naive, max_abs_corrected])\n\n    # Format the final output as a single-line string according to the problem specification.\n    # Example item: \"[9.712125e-03,2.220446049250313e-16]\"\n    # The final output joins these items with commas, enclosed in brackets.\n    # Example: \"[[...],[...]]\"\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "尽管上一个练习在理想化情景下展示了完美的解决方案，但真实世界的海底地形并非光滑。这个高级练习  探究了一个关键且违反直觉的现象：为何在真实的粗糙地形上简单地加密模型网格可能无法减小PGE，甚至可能使其恶化。通过运用标度分析和谱方法，本问题提供了一个理论框架，用于理解数值精度与未解析的海底粗糙度之间的相互作用。",
            "id": "3808853",
            "problem": "在一个使用地形追随坐标系的静力 Boussinesq 海洋模型中，水平压力梯度是沿着与海底地形相符的倾斜坐标面进行计算的。经验观察表明，当海底地形未经平滑处理时，压力梯度误差 (PGE) 在网格加密下仍然持续存在。在本问题中，你将建立一个第一性原理标度律论证来解释这种持续性，然后推导出一个精确的谱条件，在该条件下，网格加密减小PGE的速度快于海底地形坡度的增加速度。\n\n假设以下科学标准基础：\n- 静水压平衡由$\\partial p/\\partial z = -\\rho g$给出，真实的水平压力梯度可以表示为水平密度梯度的垂直积分。在地形追随坐标系中，该积分的离散近似涉及与海底地形坡度成正比的度量项。\n- 对于一个名义水平截断阶为$p \\in \\mathbb{N}$的格式，离散化压力梯度的主要截断误差与解场和几何度量的某个光滑泛函乘以$\\Delta x^{p}$成标度关系。当坐标面随海底倾斜时，主要的几何依赖性可以建模为海底地形坡度$s(x) = |\\partial h/\\partial x|$的幂次，因此主要PGE的大小满足标度关系$E \\sim C s^{m} \\Delta x^{p}$，其中$m \\in \\mathbb{N}$是一个与方法相关的整数，$C$是一个可能包含层结因子但不依赖于$\\Delta x$的常数。\n- 海底地形$h(x)$是一个在一维水平方向上的统计平稳粗糙场，其在频带$k \\in [k_{0}, k_{\\max}]$上的惯性区波数谱为$S_{h}(k) = A k^{-\\beta}$，其中$A>0$，$\\beta>0$，$k_{0}>0$，且$k_{\\max} \\sim \\pi/\\Delta x$。\n\n任务：\n1. 从定义$s(x) = |\\partial h/\\partial x|$和谱模型$S_{h}(k) = A k^{-\\beta}$出发，推导均方根海底地形坡度$s_{\\mathrm{rms}}$与网格间距$\\Delta x$之间的标度关系（用$\\beta$表示）。你可以假定$k_{\\max} \\gg k_{0}$并考虑$\\Delta x \\to 0$的极限情况。\n2. 使用截断误差标度关系$E \\sim C s^{m} \\Delta x^{p}$以及你得到的关于$s_{\\mathrm{rms}}(\\Delta x)$的结果，确定加密指数$\\alpha$，使得当$\\Delta x \\to 0$时$E \\propto \\Delta x^{\\alpha}$。用语言解释为什么这意味着如果海底地形不进行平滑处理，PGE在网格加密下会持续存在甚至增长。\n3. 假设网格以因子$r>1$加密，即$\\Delta x \\mapsto \\Delta x/r$。通过$s_{\\mathrm{rms}} \\propto \\Delta x^{-\\gamma}$定义坡度增长指数$\\gamma$。将陈述“网格加密减小PGE的速度快于海底地形坡度的增加速度”形式化为加密指数之间的不等式$\\alpha > \\gamma$，并求解该不等式以得到海底地形谱指数。用$\\beta_{\\mathrm{crit}}$表示$\\beta$的阈值，使得该条件当且仅当$\\beta > \\beta_{\\mathrm{crit}}$时成立。\n\n将你的最终答案表示为关于$m$和$p$的$\\beta_{\\mathrm{crit}}$的单个闭式解析表达式。不要包含单位。不要提供不等式。不要在最终答案中提供任何中间步骤。",
            "solution": "我们从静水压平衡$\\partial p/\\partial z = -\\rho g$出发，并认识到在地形追随坐标系中，离散的水平压力梯度会继承作为海底坡度函数的度量因子。对于光滑场的相容 p 阶水平离散化，主截断误差幅值的标度关系为$\\Delta x^{p}$乘以场和几何的一个有界泛函。当几何具有坡度$s = |\\partial h/\\partial x|$时，与几何的主要耦合可以表示为$s$的多项式，因此有建模拟设$E \\sim C s^{m} \\Delta x^{p}$，其中$m \\geq 1$是一个依赖于离散化方案的整数（对于许多广泛使用的地形追随压力梯度格式，$m=2$）。\n\n为了量化粗糙海底地形如何破坏收敛性，我们将$h(x)$表示为一个统计平稳的粗糙过程，其一维波数谱$S_{h}(k) = A k^{-\\beta}$在$k \\in [k_{0}, k_{\\max}]$上成立，其中$k_{\\max} \\sim \\pi/\\Delta x$。均方根 (RMS) 坡度为\n$$\ns_{\\mathrm{rms}}^{2} \\equiv \\left\\langle \\left(\\frac{\\partial h}{\\partial x}\\right)^{2} \\right\\rangle\n= \\int_{k_{0}}^{k_{\\max}} k^{2} S_{h}(k)\\, \\mathrm{d}k\n= A \\int_{k_{0}}^{k_{\\max}} k^{2-\\beta}\\, \\mathrm{d}k.\n$$\n对于$\\beta \\neq 3$，该积分的计算结果为\n$$\ns_{\\mathrm{rms}}^{2} = \\frac{A}{3-\\beta}\\left(k_{\\max}^{3-\\beta} - k_{0}^{3-\\beta}\\right).\n$$\n在$\\Delta x \\to 0$的加密极限下，当$k_{\\max} \\sim \\pi/\\Delta x \\gg k_{0}$且$\\beta  3$时，积分上限起主导作用，得到\n$$\ns_{\\mathrm{rms}}^{2} \\sim \\frac{A}{3-\\beta}\\, k_{\\max}^{3-\\beta} \\sim \\frac{A}{3-\\beta}\\, \\left(\\frac{\\pi}{\\Delta x}\\right)^{3-\\beta}.\n$$\n因此，\n$$\ns_{\\mathrm{rms}} \\propto \\Delta x^{-\\gamma}, \\quad \\text{with} \\quad \\gamma \\equiv \\frac{3-\\beta}{2} \\quad \\text{for} \\quad \\beta  3.\n$$\n对于$\\beta = 3$，$s_{\\mathrm{rms}}$趋于一个常数（最多相差对数修正项），而对于$\\beta3$，它随加密而减小；由粗糙度驱动的挑战出现在$\\beta3$的情况。\n\n接下来，将截断误差模型$E \\sim C s^{m} \\Delta x^{p}$与$s_{\\mathrm{rms}}$的标度关系结合，得到\n$$\nE \\propto s_{\\mathrm{rms}}^{m}\\, \\Delta x^{p} \\propto \\Delta x^{-m\\gamma}\\, \\Delta x^{p} = \\Delta x^{\\alpha}, \\quad \\text{with} \\quad \\alpha \\equiv p - m\\gamma = p - m\\,\\frac{3-\\beta}{2}.\n$$\n因此，在网格加密$\\Delta x \\mapsto \\Delta x/r$（其中$r1$）下，误差减小一个因子$r^{\\alpha}$。如果$\\alpha \\leq 0$（即$p \\leq m(3-\\beta)/2$），那么名义上随$\\Delta x^{p}$衰减的截断误差会被随网格加密而增长的未分辨坡度所抵消，导致误差随着分辨率的增加而停滞甚至增长。这就解释了为什么当海底地形粗糙度未经平滑时，压力梯度误差在网格加密下仍然持续存在：加密网格的行为提高了$k_{\\max}$，从而增加了$s_{\\mathrm{rms}}$，其增长速度可能超过形式精度阶。\n\n最后，通过比较因子为$r$的加密下的指数来形式化“网格加密减小PGE的速度快于海底地形坡度的增加速度”：PGE以$r^{\\alpha}$减小，而RMS坡度以$r^{\\gamma}$增加。所述判据为\n$$\n\\alpha  \\gamma.\n$$\n将$\\alpha = p - m\\gamma$代入得到\n$$\np - m\\gamma  \\gamma \\quad \\Longleftrightarrow \\quad p  (m+1)\\gamma \\quad \\Longleftrightarrow \\quad \\gamma  \\frac{p}{m+1}.\n$$\n使用$\\gamma = (3-\\beta)/2$，这变为\n$$\n\\frac{3-\\beta}{2}  \\frac{p}{m+1} \\quad \\Longleftrightarrow \\quad 3-\\beta  \\frac{2p}{m+1} \\quad \\Longleftrightarrow \\quad \\beta  3 - \\frac{2p}{m+1}.\n$$\n定义$\\beta_{\\mathrm{crit}}$使得该条件当且仅当$\\beta  \\beta_{\\mathrm{crit}}$时成立。因此，\n$$\n\\beta_{\\mathrm{crit}} = 3 - \\frac{2p}{m+1}.\n$$\n这个表达式就是所要求的闭式阈值。它表明，更高的截断阶$p$和更低的几何敏感度$m$都会放宽为保证网格加密抑制PGE的速度快于坡度场增强速度所需的谱陡度。在实践中常见的$m=2$和$p=2$的情况下，可以得到$\\beta_{\\mathrm{crit}} = 3 - \\frac{4}{3} = \\frac{5}{3}$，这与在存在粗糙海底地形时，比$k^{-5/3}$更陡的谱有利于收敛的观点是一致的。",
            "answer": "$$\\boxed{3 - \\frac{2p}{m+1}}$$"
        }
    ]
}