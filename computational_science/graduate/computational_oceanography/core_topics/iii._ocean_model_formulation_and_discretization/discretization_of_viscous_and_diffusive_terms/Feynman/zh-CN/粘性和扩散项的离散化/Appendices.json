{
    "hands_on_practices": [
        {
            "introduction": "在数值求解偏微分方程时，尤其是使用显式时间积分方案时，数值稳定性是首要的考量。虽然标准的二阶差分格式很常用，但高阶格式能够以更少的网格点提供更高的精度。然而，这种高精度是有代价的——通常会带来更严格的稳定性约束。本练习将指导你对一个四阶中心差分格式进行严格的冯·诺依曼稳定性分析，以推导出其最大允许时间步长，这是设计和使用高级数值模型的必备技能。",
            "id": "3791055",
            "problem": "考虑在一个长度为 $L$ 的周期性域中，一个理想化的海洋混合层内被动示踪剂的一维扩散。该域具有均匀的网格间距 $\\Delta x$ 和恒定的扩散系数 $\\kappa$（单位为 $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$）。从菲克第一扩散定律 $J = -\\kappa\\,\\partial_{x} C$ 和局域守恒 $\\partial_{t} C + \\partial_{x} J = 0$ 出发，可得到连续扩散方程为 $\\partial_{t} C = \\kappa\\,\\partial_{x x} C$。定义 $u(x,t)$ 为示踪剂浓度，并令 $u_{i}(t)$ 表示其在周期性边界条件下网格点 $x_{i} = i\\,\\Delta x$ 处的值。使用四阶精度的五点中心有限差分格式对空间二阶导数 $\\partial_{x x} u$ 进行离散化\n$$\n\\delta_{x x}^{(4)} u_{i} \\;=\\; \\frac{-\\,u_{i-2} \\;+\\; 16\\,u_{i-1} \\;-\\; 30\\,u_{i} \\;+\\; 16\\,u_{i+1} \\;-\\; u_{i+2}}{12\\,\\Delta x^{2}}\\,,\n$$\n并构成如下半离散系统\n$$\n\\frac{\\mathrm{d} u_{i}}{\\mathrm{d} t} \\;=\\; \\kappa\\,\\delta_{x x}^{(4)} u_{i}\\,.\n$$\n使用前向欧拉法对此系统进行时间推进\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n}\\,,\n$$\n其中 $\\Delta t$ 是时间步长。使用与周期性边界条件一致的傅里叶模态拟设和严格的放大因子分析，推导该显式格式线性稳定性的最大允许时间步长 $\\Delta t_{\\max}$，并将其表示为关于 $\\kappa$ 和 $\\Delta x$ 的解析表达式。将 $\\Delta t_{\\max}$ 的最终答案以秒为单位表示。不要提供不等式；给出 $\\Delta t_{\\max}$ 的单个闭合形式表达式。",
            "solution": "该问题是有效的，因为它提出了一个在计算海洋学中应用的数值分析领域内，一个适定且有科学依据的问题。所有必要信息都已提供，问题没有矛盾或含糊之处。\n\n任务是确定一个用于近似一维扩散方程 $\\partial_{t} u = \\kappa\\,\\partial_{x x} u$ 的数值格式的线性稳定性极限。该格式对空间导数采用四阶中心差分，对时间积分采用前向欧拉法。将使用 von Neumann 稳定性分析方法来研究这个显式格式的稳定性，该方法适用于周期性域上的常系数线性问题。\n\n全离散格式由下式给出：\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\Delta t\\,\\kappa\\,\\delta_{x x}^{(4)} u_{i}^{n} $$\n代入四阶有限差分算子 $\\delta_{x x}^{(4)}$ 的定义，我们得到：\n$$ u_{i}^{n+1} \\;=\\; u_{i}^{n} \\;+\\; \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -u_{i-2}^{n} \\;+\\; 16\\,u_{i-1}^{n} \\;-\\; 30\\,u_{i}^{n} \\;+\\; 16\\,u_{i+1}^{n} \\;-\\; u_{i+2}^{n} \\right) $$\n对于 von Neumann 分析，我们考虑在网格点 $x_i = i\\Delta x$ 和时间步长 $n$ 处的数值解的单个傅里叶模态拟设：\n$$ u_{i}^{n} = G(k)^{n} \\hat{u}_{0}(k) \\exp(I k x_{i}) $$\n其中 $k$ 是波数，$I = \\sqrt{-1}$ 是虚数单位，$\\hat{u}_{0}(k)$ 是该模态的初始振幅，$G(k)$ 是放大因子，它表示每个时间步长中模态振幅所乘的因子。该格式稳定的充要条件是，对于所有可能的波数，放大因子的模长小于或等于1，即 $|G(k)| \\le 1$。\n\n将拟设代入网格点 $i-2, i-1, i, i+1, i+2$ 的离散方程中：\n\\begin{align*} u_{j}^{n} = G^{n} \\hat{u}_{0} \\exp(I k j \\Delta x) \\\\ u_{j}^{n+1} = G^{n+1} \\hat{u}_{0} \\exp(I k j \\Delta x) \\end{align*}\n离散方程变为：\n$$ G^{n+1} \\hat{u}_{0} \\exp(I k i \\Delta x) = G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x) + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} G^{n} \\hat{u}_{0} \\left( -\\exp(I k (i-2) \\Delta x) + \\dots - \\exp(I k (i+2) \\Delta x) \\right) $$\n两边同除以公共非零因子 $G^{n} \\hat{u}_{0} \\exp(I k i \\Delta x)$，得到放大因子 $G = G(k)$ 的表达式：\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( -\\exp(-2 I k \\Delta x) + 16 \\exp(-I k \\Delta x) - 30 + 16 \\exp(I k \\Delta x) - \\exp(2 I k \\Delta x) \\right) $$\n令 $\\theta = k \\Delta x$ 为无量纲波数，或每个网格单元的相角。我们对复指数项进行分组：\n$$ G = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 16(\\exp(I \\theta) + \\exp(-I \\theta)) - (\\exp(2 I \\theta) + \\exp(-2 I \\theta)) - 30 \\right) $$\n使用欧拉恒等式 $\\cos(\\phi) = \\frac{\\exp(I\\phi) + \\exp(-I\\phi)}{2}$，我们可以简化表达式：\n$$ G(\\theta) = 1 + \\frac{\\kappa \\Delta t}{12\\,\\Delta x^{2}} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\n放大因子 $G(\\theta)$ 是一个实值函数，这与将对称空间格式应用于扩散方程的预期相符。因此，稳定性条件 $|G(\\theta)| \\le 1$ 等价于双重不等式 $-1 \\le G(\\theta) \\le 1$。\n\n让我们定义扩散的 Courant-Friedrichs-Lewy (CFL) 数为 $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}}$。$G(\\theta)$ 的表达式变为：\n$$ G(\\theta) = 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) $$\n稳定性条件是：\n$$ -1 \\le 1 + \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 1 $$\n不等式各部分减去 $1$ 得到：\n$$ -2 \\le \\frac{r}{12} \\left( 32\\cos(\\theta) - 2\\cos(2\\theta) - 30 \\right) \\le 0 $$\n让我们分析三角多项式 $P(\\theta) = 32\\cos(\\theta) - 2\\cos(2\\theta) - 30$。使用二倍角恒等式 $\\cos(2\\theta) = 2\\cos^{2}(\\theta) - 1$：\n$$ P(\\theta) = 32\\cos(\\theta) - 2(2\\cos^{2}(\\theta) - 1) - 30 = -4\\cos^{2}(\\theta) + 32\\cos(\\theta) - 28 $$\n这可以因式分解为：\n$$ P(\\theta) = -4(\\cos^{2}(\\theta) - 8\\cos(\\theta) + 7) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) $$\n对于任意实数值 $\\theta$，我们有 $-1 \\le \\cos(\\theta) \\le 1$。这意味着因子 $(\\cos(\\theta) - 1)$ 总是小于或等于零，而因子 $(\\cos(\\theta) - 7)$ 总是严格为负。因此，这两个因子的乘积总是大于或等于零。因此，对于所有 $\\theta$，$P(\\theta) = -4(\\cos(\\theta) - 1)(\\cos(\\theta) - 7) \\le 0$。\n\n由于 $r = \\frac{\\kappa \\Delta t}{\\Delta x^{2}} > 0$ 且 $P(\\theta) \\le 0$，稳定性不等式的右侧 $\\frac{r}{12} P(\\theta) \\le 0$ 总是满足的。\n\n我们现在必须满足不等式的左侧：\n$$ -2 \\le \\frac{r}{12} P(\\theta) $$\n由于 $P(\\theta)$ 是非正的，我们可以写成：\n$$ r \\le \\frac{-24}{P(\\theta)} \\quad \\text{for } P(\\theta) \\neq 0 $$\n为确保对所有可能的波数都稳定，我们必须对使约束最严格的 $\\theta$ 值满足此条件。这发生在右侧最小化的地方，对应于 $P(\\theta)$ 的最小值。\n我们需要找到 $\\min_{\\theta} P(\\theta)$。令 $y = \\cos(\\theta)$。我们在区间 $y \\in [-1, 1]$ 上寻找二次函数 $p(y) = -4(y-1)(y-7) = -4y^2 + 32y - 28$ 的最小值。这是一个开口向下的抛物线，其顶点在 $y = -\\frac{32}{2(-4)} = 4$。由于顶点在区间 $[-1, 1]$ 之外，因此此区间上的最小值必定出现在端点之一。\n在 $y=1$ 处（对应于 $\\theta=0$，最长波长），$p(1) = -4(1-1)(1-7) = 0$。\n在 $y=-1$ 处（对应于 $\\theta = \\pi$，最短可分辨波长或奈奎斯特频率），$p(-1) = -4(-1-1)(-1-7) = -4(-2)(-8) = -64$。\n$P(\\theta)$ 的最小值是 $-64$。这是稳定性的“最坏情况”。\n\n将此最小值代入稳定性条件：\n$$ r \\le \\frac{-24}{\\min P(\\theta)} = \\frac{-24}{-64} = \\frac{3 \\times 8}{8 \\times 8} = \\frac{3}{8} $$\n所以，稳定性极限是 $r \\le \\frac{3}{8}$。\n当 Courant 数达到这个最大值时，就得到了最大允许时间步长 $\\Delta t_{\\max}$：\n$$ \\frac{\\kappa \\Delta t_{\\max}}{\\Delta x^{2}} = \\frac{3}{8} $$\n解出 $\\Delta t_{\\max}$ 得到：\n$$ \\Delta t_{\\max} = \\frac{3}{8} \\frac{\\Delta x^{2}}{\\kappa} $$\n这个表达式的单位是 $\\mathrm{m}^{2} / (\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}) = \\mathrm{s}$，这与时间步长的单位一致。",
            "answer": "$$\n\\boxed{\\frac{3 \\Delta x^{2}}{8 \\kappa}}\n$$"
        },
        {
            "introduction": "在掌握了均匀介质中的离散化方法后，我们转向更贴近现实的场景。许多物理系统，如层化的海洋，其物理属性（如扩散系数 $\\kappa$）会发生突变。天真地应用标准差分格式可能会违背像通量连续性这样的基本物理定律。本练习将展示如何构建一个保守的有限体积格式，通过推导界面上的有效扩散系数，来正确处理这种不连续性。",
            "id": "3790999",
            "problem": "在一个代表分层海洋的一维垂直柱中，考虑一个被动示踪剂的扩散，其浓度场 $C(z,t)$ 由菲克扩散控制。控制方程是守恒定律 $\\partial_t C = \\partial_z(\\kappa \\,\\partial_z C)$，其中菲克扩散定律为 $J = -\\kappa\\,\\partial_z C$，$\\kappa$ 是分子或湍流扩散系数。假设在位于 $z=z_I$ 处、介于两个相邻控制体积中心 $z_{i-1}$ 和 $z_i$ 之间的一个清晰的物质界面上，扩散系数是分段常数且存在不连续性：当 $z  z_I$ 时，$\\kappa = \\kappa_L$，而当 $z > z_I$ 时，$\\kappa = \\kappa_R$。在稳态条件下，通过界面的扩散通量是常数。假设在每个物质段内浓度剖面是分段线性的，推导出一个有限体积数值格式在界面 $z_I$ 处的有效扩散系数 $\\kappa_{\\mathrm{face}}$，该格式定义为 $F_{i-\\frac{1}{2}} = -\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d}$，其中 $d = z_i - z_{i-1}$。给定以下参数：$d = 1.0\\,\\mathrm{m}$，$d_L = z_I - z_{i-1} = 0.3\\,\\mathrm{m}$，$\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$ 以及 $\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$。计算 $\\kappa_{\\mathrm{face}}$ 的数值，单位为 $\\mathrm{m^{2}\\,s^{-1}}$，并四舍五入到四位有效数字。",
            "solution": "问题陈述具有科学依据，提法恰当，并为获得唯一解提供了所有必要信息。它描述了一种在有限体积框架下处理扩散方程不连续系数的标准方法。因此，我们可以开始推导。\n\n目标是确定两个控制体积之间面上的有效扩散系数 $\\kappa_{\\mathrm{face}}$，使得数值通量 $F_{i-\\frac{1}{2}}$ 在给定条件下能正确表示物理通量。在物质界面 $z=z_I$ 处的物理条件是浓度连续，$C(z_I^-) = C(z_I^+)$，以及通量连续，$J(z_I^-) = J(z_I^+)$。\n\n问题陈述要求假设在每个物质段内浓度场 $C(z)$ 的剖面是分段线性的。这意味着梯度 $\\partial_z C$ 在每个段内是常数。设单元中心位于 $z_{i-1}$ 和 $z_i$，对应的浓度为 $C_{i-1} = C(z_{i-1})$ 和 $C_i = C(z_i)$。物质界面位于 $z_I$，在 $z_{i-1}$ 和 $z_i$ 之间。\n\n在左侧段，对于 $z \\in [z_{i-1}, z_I]$，浓度剖面是线性的。梯度是常数，可以表示为：\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_L = \\frac{C_I - C_{i-1}}{z_I - z_{i-1}} = \\frac{C_I - C_{i-1}}{d_L}\n$$\n其中 $C_I$ 是界面 $z=z_I$ 处的浓度，$d_L = z_I - z_{i-1}$。\n\n在右侧段，对于 $z \\in [z_I, z_i]$，浓度剖面也是线性的。梯度是常数，可以表示为：\n$$\n\\left(\\frac{\\partial C}{\\partial z}\\right)_R = \\frac{C_i - C_I}{z_i - z_I} = \\frac{C_i - C_I}{d_R}\n$$\n其中 $d_R = z_i - z_I$。\n\n根据菲克定律，每个段内的扩散通量由 $J = -\\kappa\\,\\partial_z C$ 给出。在无源区的有限体积法中，穿过单元面的通量 $F_{i-\\frac{1}{2}}$ 在单元中心 $z_{i-1}$ 和 $z_i$ 之间的整个区间内必须是常数。这隐含地满足了在 $z=z_I$ 处的通量连续性条件。\n\n将菲克定律应用于左侧段：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_L \\left(\\frac{\\partial C}{\\partial z}\\right)_L = -\\kappa_L \\frac{C_I - C_{i-1}}{d_L}\n$$\n对此求解 $C_I$ 得：\n$$\nC_I - C_{i-1} = -\\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} \\implies C_I = C_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L}\n$$\n\n将菲克定律应用于右侧段：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_R \\left(\\frac{\\partial C}{\\partial z}\\right)_R = -\\kappa_R \\frac{C_i - C_I}{d_R}\n$$\n对此求解 $C_I$ 得：\n$$\nC_i - C_I = -\\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R} \\implies C_I = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\n\n我们现在有两个关于界面浓度 $C_I$ 的表达式。由于浓度必须是连续的，这两个表达式必须相等。将它们相等可以消去未知数 $C_I$：\n$$\nC_{i-1} - \\frac{F_{i-\\frac{1}{2}} d_L}{\\kappa_L} = C_i + \\frac{F_{i-\\frac{1}{2}} d_R}{\\kappa_R}\n$$\n现在，我们求解通量 $F_{i-\\frac{1}{2}}$：\n$$\nC_{i-1} - C_i = F_{i-\\frac{1}{2}} \\left( \\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} \\right)\n$$\n$$\nF_{i-\\frac{1}{2}} = \\frac{C_{i-1} - C_i}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n问题要求将此通量表示为以下形式：\n$$\nF_{i-\\frac{1}{2}} = -\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d}\n$$\n通过将推导出的通量表达式与要求的形式进行比较，我们可以确定 $\\kappa_{\\mathrm{face}}$ 的表达式：\n$$\n-\\kappa_{\\mathrm{face}} \\frac{C_i - C_{i-1}}{d} = - \\frac{C_i - C_{i-1}}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n这意味着：\n$$\n\\frac{\\kappa_{\\mathrm{face}}}{d} = \\frac{1}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n因此，有效的面扩散系数为：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{d}{\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R}}\n$$\n这个结果在物理上类似于计算两个串联电阻的等效电导，其中每一层对扩散的“阻力”由其厚度除以其扩散系数 ($d/\\kappa$) 给出。总阻力是各个阻力之和，而有效扩散系数与此总阻力成反比。\n\n现在，我们用给定的数值计算 $\\kappa_{\\mathrm{face}}$：\n$d = 1.0\\,\\mathrm{m}$\n$d_L = 0.3\\,\\mathrm{m}$\n$\\kappa_L = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$\n$\\kappa_R = 1.0 \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}$\n\n首先，我们确定 $d_R$：\n$d_R = d - d_L = 1.0\\,\\mathrm{m} - 0.3\\,\\mathrm{m} = 0.7\\,\\mathrm{m}$。\n\n接下来，我们将这些值代入 $\\kappa_{\\mathrm{face}}$ 的表达式中：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{\\frac{0.3}{1.0 \\times 10^{-6}} + \\frac{0.7}{1.0 \\times 10^{-5}}}\n$$\n让我们计算分母中的各项：\n$$\n\\frac{d_L}{\\kappa_L} = \\frac{0.3}{1.0 \\times 10^{-6}} = 3.0 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\n$$\n\\frac{d_R}{\\kappa_R} = \\frac{0.7}{1.0 \\times 10^{-5}} = \\frac{0.7}{10.0 \\times 10^{-6}} = 7.0 \\times 10^4\\,\\mathrm{s\\,m^{-1}}\n$$\n分母中的和是：\n$$\n\\frac{d_L}{\\kappa_L} + \\frac{d_R}{\\kappa_R} = (3.0 \\times 10^5) + (0.7 \\times 10^5) = 3.7 \\times 10^5\\,\\mathrm{s\\,m^{-1}}\n$$\n现在我们可以计算 $\\kappa_{\\mathrm{face}}$：\n$$\n\\kappa_{\\mathrm{face}} = \\frac{1.0}{3.7 \\times 10^5} = \\frac{1}{3.7} \\times 10^{-5} \\approx 0.270270... \\times 10^{-5}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\n用标准科学记数法表示，这是：\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.70270... \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$\n按照问题陈述的要求，四舍五入到四位有效数字，我们得到：\n$$\n\\kappa_{\\mathrm{face}} \\approx 2.703 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}\n$$",
            "answer": "$$\n\\boxed{2.703 \\times 10^{-6}}\n$$"
        },
        {
            "introduction": "本练习旨在架起理论与实践之间的桥梁。在探讨了稳定性分析  和界面处理  等理论问题后，你将亲手编写代码来求解扩散方程。你将实现一个显式格式 (FTCS) 和一个隐式格式 (Crank-Nicolson)，应用诺伊曼边界条件，并通过与精确解析解的比较来量化模拟的准确性，这是验证数值模型有效性的关键步骤。",
            "id": "3791011",
            "problem": "本题要求您量化在计算海洋学中，对一维空间示踪剂浓度场的扩散项进行离散化所产生的数值误差。考虑由以下线性偏微分方程 (PDE) 控制的一维示踪剂扩散：$$\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2},$$ 其中 $C(x,t)$ 是示踪剂浓度，单位为千克/立方米 ($\\mathrm{kg/m^3}$)，$x$ 是水平坐标，单位为米 ($\\mathrm{m}$)，$t$ 是时间，单位为秒 ($\\mathrm{s}$)，$\\kappa$ 是分子扩散率，单位为平方米/秒 ($\\mathrm{m^2/s}$)。初始条件为一个高斯斑：$$C(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right),$$ 其中心位于 $x_0$，振幅为 $A$，标准差为 $s_0$。计算域为有限区间 $[0,L]$，边界条件为齐次诺伊曼边界条件：$$\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0.$$ 假设计算域足够大，在所选参数和模拟时间范围内，边界不会显著干扰解。\n\n从该偏微分方程和高斯初始条件的定义出发，通过以下步骤推导出一个离散模型：\n- 在间距为 $\\Delta x$ 的均匀网格上，使用二阶中心有限差分来近似二阶导数 $\\frac{\\partial^2 C}{\\partial x^2}$，并通过镜像虚拟单元实现齐次诺伊曼边界条件。\n- 使用前向时间中心空间 (FTCS) 显式格式或 Crank-Nicolson 隐式格式进行时间推进。对于 FTCS，请注意其稳定性对时间步长 $\\Delta t$ 相对于 $\\Delta x$ 和 $\\kappa$ 存在限制。\n- 使用高斯初始条件在无限域上的解析解 $$C_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right),$$ 作为参考，以估算在最终时间 $t_f$ 的数值误差。\n\n您的程序必须：\n1. 在 $[0,L]$ 上构建空间网格，其名义间距为 $\\Delta x$，网格点数为 $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$，并将实际网格间距设置为 $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$。将高斯中心置于 $x_0 = \\frac{L}{2}$。\n2. 使用虚拟单元实现带齐次诺伊曼边界条件的离散拉普拉斯算子，其中 $C_{-1} \\equiv C_{1}$ 且 $C_{N} \\equiv C_{N-2}$，从而得到边界处的二阶导数：$$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=0} \\approx \\frac{2 C_1 - 2 C_0}{\\Delta x_{\\text{eff}}^2}, \\quad \\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i=N-1} \\approx \\frac{2 C_{N-2} - 2 C_{N-1}}{\\Delta x_{\\text{eff}}^2},$$ 以及内部点的二阶导数：$$\\left.\\frac{\\partial^2 C}{\\partial x^2}\\right|_{i} \\approx \\frac{C_{i+1} - 2 C_{i} + C_{i-1}}{\\Delta x_{\\text{eff}}^2}.$$\n3. 使用 FTCS 格式 $$C^{n+1} = C^n + \\kappa \\Delta t \\, \\Delta_x C^n,$$ (其中 $\\Delta_x$ 表示离散拉普拉斯算子) 或 Crank-Nicolson 格式 $$\\left(I - \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^{n+1} = \\left(I + \\frac{\\kappa \\Delta t}{2} \\Delta_x\\right) C^n$$ 将解推进到 $t_f$。使用 $n_{\\text{steps}} = \\mathrm{round}\\left(\\frac{t_f}{\\Delta t}\\right)$ 并设置 $\\Delta t_{\\text{eff}} = \\frac{t_f}{n_{\\text{steps}}}$ 以精确达到最终时间。\n4. 使用上述公式计算网格点上的解析解 $C_{\\text{exact}}(x,t_f)$。\n5. 报告每个测试案例的均方根 (RMS) 误差 $$E_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}$$。RMS 误差以千克/立方米 ($\\mathrm{kg/m^3}$) 为单位表示。\n\n除非另有说明，所有测试案例共享以下科学上一致的参数：$L = 100{,}000 \\, \\mathrm{m}$，$A = 1 \\, \\mathrm{kg/m^3}$，$s_0 = 5{,}000 \\, \\mathrm{m}$，$\\kappa = 100 \\, \\mathrm{m^2/s}$，$t_f = 2{,}000{,}000 \\, \\mathrm{s}$。每个案例的空间离散化和时间步长会有所不同。高斯中心位于 $x_0 = L/2$。\n\n测试套件：\n- 案例 1 (常规稳定 FTCS)：方法 FTCS，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 2{,}000 \\, \\mathrm{s}$。\n- 案例 2 (接近稳定性极限的 FTCS)：方法 FTCS，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 4{,}900 \\, \\mathrm{s}$。\n- 案例 3 (FTCS 粗空间网格)：方法 FTCS，$\\Delta x = 5{,}000 \\, \\mathrm{m}$，$\\Delta t = 120{,}000 \\, \\mathrm{s}$。\n- 案例 4 (Crank-Nicolson 大时间步长)：方法 Crank-Nicolson，$\\Delta x = 1{,}000 \\, \\mathrm{m}$，$\\Delta t = 20{,}000 \\, \\mathrm{s}$。\n\n您的程序应生成单行输出，其中包含案例 1 到案例 4 的 RMS 误差 (单位 $\\mathrm{kg/m^3}$)，按顺序排列，形式为方括号括起来的逗号分隔列表（例如，“[e1,e2,e3,e4]”）。",
            "solution": "所提出的问题是数值分析中一个定义明确的练习，具体涉及抛物型偏微分方程的求解。它在科学上是合理的，数学上是一致的，并提供了进行求解所需的所有必要信息。\n\n主导的物理过程是一维扩散，由以下线性偏微分方程 (PDE) 描述：\n$$\n\\frac{\\partial C}{\\partial t} = \\kappa \\frac{\\partial^2 C}{\\partial x^2}\n$$\n这里，$C(x,t)$ 是作为空间坐标 $x$ 和时间 $t$ 的函数的示踪剂浓度，$\\kappa$ 是常数扩散率。\n\n系统在 $t=0$ 时的初始状态是一个高斯分布：\n$$\nC(x,0) = A \\exp\\left(-\\frac{(x-x_0)^2}{2 s_0^2}\\right)\n$$\n其中 $A$ 是峰值振幅，$x_0$ 是中心，$s_0$ 是初始标准差。\n\n空间域是有限区间 $[0, L]$，边界条件为零通量（齐次诺伊曼条件）：\n$$\n\\frac{\\partial C}{\\partial x}(0,t) = 0, \\quad \\frac{\\partial C}{\\partial x}(L,t) = 0\n$$\n\n为了进行比较，问题提供了在无限域上的精确解析解，该解在边界效应对模拟时间 $t_f$ 内可以忽略不计的假设下是有效的：\n$$\nC_{\\text{exact}}(x,t) = A \\frac{s_0}{\\sqrt{s_0^2 + 2 \\kappa t}} \\exp\\left(-\\frac{(x-x_0)^2}{2 \\left(s_0^2 + 2 \\kappa t\\right)}\\right)\n$$\n\n为了数值求解该偏微分方程，我们首先将空间域离散化为一个均匀网格。根据问题的规定，网格点数为 $N = \\left\\lfloor \\frac{L}{\\Delta x} \\right\\rfloor + 1$，从而得到有效网格间距 $\\Delta x_{\\text{eff}} = \\frac{L}{N-1}$。网格点位于 $x_i = i \\cdot \\Delta x_{\\text{eff}}$，其中 $i=0, 1, \\dots, N-1$。浓度场 $C(x,t)$ 由一个长度为 $N$ 的向量 $\\mathbf{C}(t)$ 表示，其中第 $i$ 个分量 $C_i(t)$ 近似于 $C(x_i, t)$。\n\n二阶空间导数 $\\frac{\\partial^2 C}{\\partial x^2}$ 使用二阶中心有限差分格式进行近似。这可以表示为矩阵形式 $\\frac{\\partial^2 \\mathbf{C}}{\\partial x^2} \\approx \\frac{1}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}$，其中 $\\mathbf{L}$ 是离散拉普拉斯矩阵。对于内部点 ($0  i  N-1$)，近似为 $\\frac{C_{i+1} - 2C_i + C_{i-1}}{\\Delta x_{\\text{eff}}^2}$。齐次诺伊曼边界条件通过使用虚拟单元来实现，其中域外的浓度被镜像反射，即 $C_{-1} = C_1$ 和 $C_{N} = C_{N-2}$。这导致了在边界上指定的二阶导数近似：\n- 在 $i=0$ 处：$\\frac{2C_1 - 2C_0}{\\Delta x_{\\text{eff}}^2}$\n- 在 $i=N-1$ 处：$\\frac{2C_{N-2} - 2C_{N-1}}{\\Delta x_{\\text{eff}}^2}$\n\n相应的 $N \\times N$ 矩阵 $\\mathbf{L}$ 是一个三对角矩阵：\n$$\n\\mathbf{L} = \n\\begin{pmatrix}\n-2  2  0  \\cdots  0 \\\\\n1  -2  1  \\ddots  \\vdots \\\\\n0  \\ddots  \\ddots  \\ddots  0 \\\\\n\\vdots  \\ddots  1  -2  1 \\\\\n0  \\cdots  0  2  -2\n\\end{pmatrix}\n$$\n通过这种空间离散化，半离散的偏微分方程变成了关于时间向量 $\\mathbf{C}(t)$ 的常微分方程：\n$$\n\\frac{d\\mathbf{C}}{dt} = \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}\n$$\n\n然后对该系统进行时间积分。我们用步长 $\\Delta t$ 对时间进行离散化，步数为 $n_{\\text{steps}} = \\mathrm{round}(t_f/\\Delta t)$，有效时间步长为 $\\Delta t_{\\text{eff}} = t_f/n_{\\text{steps}}$。设 $\\mathbf{C}^n$ 为时间 $t_n = n \\Delta t_{\\text{eff}}$ 时的数值解。\n\n**前向时间中心空间 (FTCS)** 格式是一种显式方法，定义如下：\n$$\n\\mathbf{C}^{n+1} = \\mathbf{C}^n + \\Delta t_{\\text{eff}} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n \\right) = \\left( \\mathbf{I} + \\alpha \\mathbf{L} \\right) \\mathbf{C}^n\n$$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\alpha = \\frac{\\kappa \\Delta t_{\\text{eff}}}{\\Delta x_{\\text{eff}}^2}$ 是无量纲扩散数。该格式是条件稳定的，要求 $\\alpha \\le 1/2$。\n\n**Crank-Nicolson** 格式是一种隐式方法，通过对时间 $n$ 和 $n+1$ 的空间导数进行平均来定义：\n$$\n\\frac{\\mathbf{C}^{n+1} - \\mathbf{C}^n}{\\Delta t_{\\text{eff}}} = \\frac{1}{2} \\left( \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^n + \\frac{\\kappa}{\\Delta x_{\\text{eff}}^2} \\mathbf{L} \\mathbf{C}^{n+1} \\right)\n$$\n重新整理各项以求解 $\\mathbf{C}^{n+1}$，得到一个线性方程组：\n$$\n\\left( \\mathbf{I} - \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^{n+1} = \\left( \\mathbf{I} + \\frac{\\alpha}{2} \\mathbf{L} \\right) \\mathbf{C}^n\n$$\n对于所有 $\\alpha > 0$ 的值，该格式都是无条件稳定的。在每个时间步，都必须为未知量 $\\mathbf{C}^{n+1}$ 求解这个线性系统。\n\n每个测试案例的算法流程如下：\n1.  设置共享的物理参数：$L = 100000$，$A = 1$，$s_0 = 5000$，$\\kappa = 100$，$t_f = 2000000$，以及 $x_0 = L/2$。\n2.  对于具体案例，根据给定的名义 $\\Delta x$ 确定空间网格参数 $N$ 和 $\\Delta x_{\\text{eff}}$。\n3.  根据给定的名义 $\\Delta t$ 确定时间步进参数 $n_{\\text{steps}}$ 和 $\\Delta t_{\\text{eff}}$。\n4.  构建空间网格向量 $\\mathbf{x} = [x_0, x_1, \\dots, x_{N-1}]$。\n5.  通过在每个网格点 $x_i$ 上计算 $C(x,0)$ 来初始化浓度向量 $\\mathbf{C}^0$。\n6.  构建离散拉普拉斯矩阵 $\\mathbf{L}$。\n7.  根据指定的方法（FTCS 或 Crank-Nicolson），执行 $n_{\\text{steps}}$ 步的时间步进迭代，以找到最终的数值解 $\\mathbf{C}(t_f)$。\n    - 对于 FTCS，应用显式更新规则。\n    - 对于 Crank-Nicolson，构建左端矩阵 $\\mathbf{M}_{\\text{lhs}} = \\mathbf{I} - \\frac{\\alpha}{2}\\mathbf{L}$ 和右端矩阵 $\\mathbf{M}_{\\text{rhs}} = \\mathbf{I} + \\frac{\\alpha}{2}\\mathbf{L}$。在每一步中，计算 $\\mathbf{b} = \\mathbf{M}_{\\text{rhs}} \\mathbf{C}^n$ 并求解系统 $\\mathbf{M}_{\\text{lhs}} \\mathbf{C}^{n+1} = \\mathbf{b}$。\n8.  通过在每个网格点 $x_i$ 上计算 $C_{\\text{exact}}(x, t_f)$ 来计算精确解向量 $\\mathbf{C}_{\\text{exact}}(t_f)$。\n9.  计算最终数值解和精确解之间的均方根 (RMS) 误差：\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=0}^{N-1} \\left(C_i(t_f) - C_{\\text{exact}}(x_i,t_f)\\right)^2}\n$$\n该流程针对所提供的四个测试案例中的每一个都进行了实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are needed for this implementation.\n\ndef run_simulation(case_params, shared_params):\n    \"\"\"\n    Runs a single simulation case for the 1D diffusion equation.\n\n    Args:\n        case_params (dict): Parameters for the specific test case.\n        shared_params (dict): Parameters shared across all cases.\n\n    Returns:\n        float: The RMS error for the case.\n    \"\"\"\n    # Unpack parameters\n    method = case_params['method']\n    dx_nominal = case_params['dx']\n    dt_nominal = case_params['dt']\n    \n    L = shared_params['L']\n    A = shared_params['A']\n    s0 = shared_params['s0']\n    kappa = shared_params['kappa']\n    tf = shared_params['tf']\n    x0 = L / 2.0\n\n    # 1. Construct the spatial grid\n    N = int(np.floor(L / dx_nominal)) + 1\n    dx_eff = L / (N - 1)\n    x = np.linspace(0, L, N)\n\n    # 2. Set up initial condition\n    C = A * np.exp(-(x - x0)**2 / (2 * s0**2))\n\n    # 3. Set up time stepping\n    n_steps = int(round(tf / dt_nominal))\n    dt_eff = tf / n_steps\n\n    # 4. Construct discrete Laplacian matrix L with Neumann BCs\n    L_mat = np.zeros((N, N))\n    # Interior points\n    for i in range(1, N - 1):\n        L_mat[i, i-1] = 1\n        L_mat[i, i]   = -2\n        L_mat[i, i+1] = 1\n    # Boundary points (Neumann)\n    L_mat[0, 0] = -2\n    L_mat[0, 1] = 2\n    L_mat[N-1, N-2] = 2\n    L_mat[N-1, N-1] = -2\n\n    # 5. Perform time integration\n    alpha = kappa * dt_eff / dx_eff**2\n\n    if method == 'FTCS':\n        # FTCS stability check\n        if alpha > 0.5:\n             # This problem sets up cases that are stable, but it is good practice.\n             # In a real scenario, one would raise an error.\n             # print(f\"Warning: FTCS stability condition not met. alpha = {alpha}\")\n             pass\n        \n        M_update = np.identity(N) + alpha * L_mat\n        for _ in range(n_steps):\n            C = M_update @ C\n\n    elif method == 'Crank-Nicolson':\n        I = np.identity(N)\n        A_lhs = I - (alpha / 2.0) * L_mat\n        B_rhs = I + (alpha / 2.0) * L_mat\n        for _ in range(n_steps):\n            b = B_rhs @ C\n            C = np.linalg.solve(A_lhs, b)\n\n    # 6. Compute analytic solution at tf\n    s_tf = np.sqrt(s0**2 + 2 * kappa * tf)\n    C_exact = A * (s0 / s_tf) * np.exp(-(x - x0)**2 / (2 * s_tf**2))\n\n    # 7. Compute RMS error\n    rms_error = np.sqrt(np.mean((C - C_exact)**2))\n    \n    return rms_error\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define shared parameters from the problem statement\n    shared_params = {\n        'L': 100000.0,      # m\n        'A': 1.0,           # kg/m^3\n        's0': 5000.0,       # m\n        'kappa': 100.0,     # m^2/s\n        'tf': 2000000.0,    # s\n    }\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 2000.0},\n        {'method': 'FTCS', 'dx': 1000.0, 'dt': 4900.0},\n        {'method': 'FTCS', 'dx': 5000.0, 'dt': 120000.0},\n        {'method': 'Crank-Nicolson', 'dx': 1000.0, 'dt': 20000.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case, shared_params)\n        results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}