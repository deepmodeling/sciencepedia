{
    "hands_on_practices": [
        {
            "introduction": "理论的理解需要通过实践来巩固。我们从一个基础的“纸笔”练习开始，它揭示了离散守恒格式的核心机制。这个练习将引导你推导在一个二维网格上，示踪剂总量的变化如何完全由区域边界的通量决定，从而让你亲手验证通量形式离散化为何能自然地导向全局守恒 。",
            "id": "3788105",
            "problem": "考虑二维空间中的标量示踪物输运方程，写成通量形式的守恒律 $\\partial_{t} q + \\nabla \\cdot (\\boldsymbol{u} q) = 0$，在一个均匀的笛卡尔网格上离散，该网格在 $x$ 方向有 $N$ 个单元，在 $y$ 方向有 $M$ 个单元，网格间距分别为 $\\Delta x$ 和 $\\Delta y$。设单元中心由 $(i,j)$ 索引，其中 $i \\in \\{1,\\dots,N\\}$ 且 $j \\in \\{1,\\dots,M\\}$。在单元面上定义了面法向速度，$u_{i+1/2,j}$ 在东西方向的面上，$v_{i,j+1/2}$ 在南北方向的面上。在时间层 $n$ 定义中心面通量为\n$$\nF_{i+1/2,j} \\equiv u_{i+1/2,j} \\,\\frac{q^{n}_{i+1,j} + q^{n}_{i,j}}{2}, \\qquad\nG_{i,j+1/2} \\equiv v_{i,j+1/2} \\,\\frac{q^{n}_{i,j+1} + q^{n}_{i,j}}{2},\n$$\n对所有内部面成立，并令 $F_{1/2,j}$、$F_{N+1/2,j}$、$G_{i,1/2}$ 和 $G_{i,M+1/2}$ 表示区域边界上的相应通量（由边界条件确定）。考虑显式 Euler 更新\n$$\nq^{n+1}_{i,j} \\;=\\; q^{n}_{i,j} \\;-\\; \\Delta t \\left[ \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} \\;+\\; \\frac{G_{i,j+1/2} - G_{i,j-1/2}}{\\Delta y} \\right],\n$$\n对所有内部单元 $(i,j)$ 成立，其中 $\\Delta t$ 是时间步长。\n\n在时间层 $n$ 定义离散全局和为\n$$\nS^{n} \\equiv \\sum_{i=1}^{N} \\sum_{j=1}^{M} q^{n}_{i,j}.\n$$\n精确计算单步变化 $\\Delta S \\equiv S^{n+1} - S^{n}$ 的闭式解，仅用 $\\Delta t$、$\\Delta x$、$\\Delta y$ 以及边界上的面通量 $F_{1/2,j}$、$F_{N+1/2,j}$、$G_{i,1/2}$ 和 $G_{i,M+1/2}$ 来表示。然后，根据你的推导，说明在何种边界条件和离散算子条件下，该格式是精确守恒的，即 $\\Delta S = 0$ 在机器精度下成立。\n\n你的最终答案必须是所要求的 $\\Delta S$ 的单个闭式表达式。不需要进行数值计算，也不需要四舍五入。不包含任何单位。",
            "solution": "出发点是离散的通量形式更新，它在均匀网格上近似连续守恒律 $\\partial_{t} q + \\nabla \\cdot (\\boldsymbol{u} q) = 0$。在每个内部单元 $(i,j)$ 的显式 Euler 更新为\n$$\nq^{n+1}_{i,j} \\;=\\; q^{n}_{i,j} \\;-\\; \\Delta t \\left[ \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} \\;+\\; \\frac{G_{i,j+1/2} - G_{i,j-1/2}}{\\Delta y} \\right],\n$$\n其中 $F_{i+1/2,j}$ 和 $G_{i,j+1/2}$ 是位于两个相邻单元之间或区域边界的面上的单值面通量。这些通量是使用相邻单元中心的 $q$ 的中心平均值和同一面上的面法向速度构建的：\n$$\nF_{i+1/2,j} \\equiv u_{i+1/2,j} \\,\\frac{q^{n}_{i+1,j} + q^{n}_{i,j}}{2}, \\qquad\nG_{i,j+1/2} \\equiv v_{i,j+1/2} \\,\\frac{q^{n}_{i,j+1} + q^{n}_{i,j}}{2}.\n$$\n定义离散全局和\n$$\nS^{n} \\equiv \\sum_{i=1}^{N} \\sum_{j=1}^{M} q^{n}_{i,j}, \\qquad \\Delta S \\equiv S^{n+1} - S^{n}.\n$$\n对所有内部单元的更新求和得到\n\\begin{align*}\n\\Delta S \\;=\\; \\sum_{i=1}^{N} \\sum_{j=1}^{M} \\left( q^{n+1}_{i,j} - q^{n}_{i,j} \\right) \\\\\n=\\; - \\Delta t \\sum_{i=1}^{N} \\sum_{j=1}^{M} \\left[ \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} \\;+\\; \\frac{G_{i,j+1/2} - G_{i,j-1/2}}{\\Delta y} \\right].\n\\end{align*}\n因为 $\\Delta x$ 和 $\\Delta y$ 是常数，我们重组求和项：\n\\begin{align*}\n\\Delta S \\;=\\; - \\frac{\\Delta t}{\\Delta x} \\sum_{j=1}^{M} \\sum_{i=1}^{N} \\left( F_{i+1/2,j} - F_{i-1/2,j} \\right) \\;-\\; \\frac{\\Delta t}{\\Delta y} \\sum_{i=1}^{N} \\sum_{j=1}^{M} \\left( G_{i,j+1/2} - G_{i,j-1/2} \\right).\n\\end{align*}\n每个内部和是一个离散的伸缩求和。对于固定的 $j$，$x$方向的通量，\n$$\n\\sum_{i=1}^{N} \\left( F_{i+1/2,j} - F_{i-1/2,j} \\right) \\;=\\; F_{N+1/2,j} - F_{1/2,j}.\n$$\n类似地，对于固定的 $i$，$y$方向的通量，\n$$\n\\sum_{j=1}^{M} \\left( G_{i,j+1/2} - G_{i,j-1/2} \\right) \\;=\\; G_{i,M+1/2} - G_{i,1/2}.\n$$\n因此，离散全局和的单步变化精确地为\n$$\n\\Delta S \\;=\\; - \\frac{\\Delta t}{\\Delta x} \\sum_{j=1}^{M} \\left( F_{N+1/2,j} - F_{1/2,j} \\right) \\;-\\; \\frac{\\Delta t}{\\Delta y} \\sum_{i=1}^{N} \\left( G_{i,M+1/2} - G_{i,1/2} \\right).\n$$\n这个表达式只依赖于边界上的面通量。由此可见，该格式在离散全局和的意义上是精确守恒的，即 $\\Delta S = 0$ 在机器精度下成立，需满足以下条件：\n- 在 $x$ 方向和/或 $y$ 方向采用周期性边界条件，这意味着 $F_{N+1/2,j} = F_{1/2,j}$ 和/或 $G_{i,M+1/2} = G_{i,1/2}$，从而使相应的和为零。\n- 不可穿透（无法向流）边界条件，这会施加 $u_{1/2,j} = u_{N+1/2,j} = 0$ 和 $v_{i,1/2} = v_{i,M+1/2} = 0$，因此 $F_{1/2,j} = F_{N+1/2,j} = 0$ 和 $G_{i,1/2} = G_{i,M+1/2} = 0$。\n- 更一般地，任何强制净边界通量为零的边界条件，即 $\\frac{1}{\\Delta x}\\sum_{j=1}^{M} \\left( F_{N+1/2,j} - F_{1/2,j} \\right) + \\frac{1}{\\Delta y}\\sum_{i=1}^{N} \\left( G_{i,M+1/2} - G_{i,1/2} \\right) = 0$。\n\n守恒性质的产生是因为离散更新是通量形式，具有由相邻单元共享的单值面通量，因此当全局求和时，内部贡献项会完全抵消，只留下边界贡献项。显式 Euler 时间积分不改变这种抵消，因为它只是将离散散度项统一乘以 $\\Delta t$，而没有混合空间位置。",
            "answer": "$$\\boxed{- \\frac{\\Delta t}{\\Delta x} \\sum_{j=1}^{M} \\left( F_{N+1/2,j} - F_{1/2,j} \\right) - \\frac{\\Delta t}{\\Delta y} \\sum_{i=1}^{N} \\left( G_{i,M+1/2} - G_{i,1/2} \\right)}$$"
        },
        {
            "introduction": "然而，并非所有数值格式都天生具有守恒性，尤其是一些为解决特定问题（如长延时步长）而设计的高效方法。半拉格朗日（Semi-Lagrangian）方案就是一个典型例子，其插值过程通常会引入质量收支误差。这个练习将带你直面这一现实挑战：首先量化由非守恒平流步骤产生的全局质量误差，然后推导并应用一种全局质量订正方案，这是在实际海洋模型中确保物理真实性的关键实用技术 。",
            "id": "3788093",
            "problem": "考虑一个海洋示踪剂，其受没有源或汇的平流方程控制，因此在封闭的海洋域中，瞬时全球示踪剂质量由体积分 $M(t) = \\int_{\\Omega} q(\\mathbf{x}, t)\\, \\mathrm{d}V$ 给出，其中 $q$ 是示踪剂浓度（单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$），$\\Omega$ 是海洋域。在精确的连续动力学中，对于纯平流、无辐散流，$M(t)$ 是随时间守恒的。然而，由于插值和重映误差，半拉格朗日（SL）数值平流步骤可能无法保持全球质量守恒。\n\n给定一个水平海洋域，该域被离散化为 $N=4$ 个湿网格单元，其体积为 $\\{V_{i}\\}_{i=1}^{4}$，在上一个时间层 $t^{n}$ 的示踪剂浓度表示为 $\\{q_{i}^{n}\\}_{i=1}^{4}$。经过一个到新时间层 $t^{n+1}$ 的 SL 示踪剂步骤后，你得到更新后的浓度 $\\{q_{i}^{*}\\}_{i=1}^{4}$，这些浓度通常不满足全球质量守恒。你将计算全球质量误差，然后应用一个全球质量修复器，该修复器对所有湿单元格增加一个均匀的浓度增量 $\\delta$，使得校正后的浓度 $\\{q_{i}^{c}\\}_{i=1}^{4}$（其中 $q_{i}^{c} = q_{i}^{*} + \\delta$）能够精确地恢复在 $t^{n}$ 时的初始全球质量。\n\n使用以下数据，这些数据对于大型海洋网格单元是科学上合理的：\n- 单元格体积（单位为 $\\mathrm{m}^{3}$）：$V_{1} = 1.20 \\times 10^{12}$， $V_{2} = 8.00 \\times 10^{11}$， $V_{3} = 1.50 \\times 10^{12}$， $V_{4} = 1.00 \\times 10^{12}$。\n- $t^{n}$ 时的初始浓度（单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$）：$q_{1}^{n} = 2.000 \\times 10^{-3}$， $q_{2}^{n} = 1.800 \\times 10^{-3}$， $q_{3}^{n} = 2.200 \\times 10^{-3}$， $q_{4}^{n} = 1.900 \\times 10^{-3}$。\n- 修复前 $t^{n+1}$ 时刻的 SL 步骤后浓度（单位为 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$）：$q_{1}^{*} = 1.990 \\times 10^{-3}$， $q_{2}^{*} = 1.810 \\times 10^{-3}$， $q_{3}^{*} = 2.190 \\times 10^{-3}$， $q_{4}^{*} = 1.880 \\times 10^{-3}$。\n\n从“纯平流的全球积分质量应随时间不变”这一基本陈述出发，从第一性原理推导 SL 步骤后的全球质量误差表达式以及当应用于所有湿单元格时恢复守恒性的相应均匀校正量 $\\delta$ 的表达式。然后使用所提供的数据计算 $\\delta$ 的值。\n\n将 $\\delta$ 的最终数值结果四舍五入到四位有效数字。以 $\\mathrm{kg}\\,\\mathrm{m}^{-3}$ 为单位表示最终答案。",
            "solution": "该问题要求推导和计算一个均匀的浓度校正量 $\\delta$，以在一个非守恒平流步骤后，在离散化的海洋模型中恢复全球质量守恒。核心原则是在没有源或汇的情况下，示踪剂的总质量应该是不变的。\n\n设海洋域被离散化为 $N=4$ 个网格单元，其体积为 $\\{V_i\\}_{i=1}^{4}$。设 $\\{q_i^n\\}_{i=1}^{4}$ 为时间层 $t^n$ 的示踪剂浓度，$\\{q_i^*\\}_{i=1}^{4}$ 为半拉格朗日（SL）平流步骤后时间层 $t^{n+1}$ 的浓度。\n\n在离散系统中，时间 $t^n$ 的总示踪剂质量由每个单元格中的质量之和给出：\n$$M^n = \\sum_{i=1}^{N} q_i^n V_i$$\n使用所提供的数据：\n- 单元格体积：$V_{1} = 1.20 \\times 10^{12} \\, \\mathrm{m}^{3}$， $V_{2} = 8.00 \\times 10^{11} \\, \\mathrm{m}^{3} = 0.80 \\times 10^{12} \\, \\mathrm{m}^{3}$， $V_{3} = 1.50 \\times 10^{12} \\, \\mathrm{m}^{3}$， $V_{4} = 1.00 \\times 10^{12} \\, \\mathrm{m}^{3}$。\n- 初始浓度：$q_{1}^{n} = 2.000 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{2}^{n} = 1.800 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{3}^{n} = 2.200 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{4}^{n} = 1.900 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n\n我们计算初始质量 $M^n$：\n$$M^n = (2.000 \\times 10^{-3})(1.20 \\times 10^{12}) + (1.800 \\times 10^{-3})(0.80 \\times 10^{12}) + (2.200 \\times 10^{-3})(1.50 \\times 10^{12}) + (1.900 \\times 10^{-3})(1.00 \\times 10^{12})$$\n$$M^n = (2.400 \\times 10^{9}) + (1.440 \\times 10^{9}) + (3.300 \\times 10^{9}) + (1.900 \\times 10^{9})$$\n$$M^n = 9.040 \\times 10^{9} \\, \\mathrm{kg}$$\n\n类似地，使用 SL 步骤后的浓度 $\\{q_i^*\\}_{i=1}^{4}$ 计算 SL 步骤后的总质量 $M^*$：\n- SL 步骤后浓度：$q_{1}^{*} = 1.990 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{2}^{*} = 1.810 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{3}^{*} = 2.190 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$， $q_{4}^{*} = 1.880 \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n\n$$M^* = \\sum_{i=1}^{N} q_i^* V_i$$\n$$M^* = (1.990 \\times 10^{-3})(1.20 \\times 10^{12}) + (1.810 \\times 10^{-3})(0.80 \\times 10^{12}) + (2.190 \\times 10^{-3})(1.50 \\times 10^{12}) + (1.880 \\times 10^{-3})(1.00 \\times 10^{12})$$\n$$M^* = (2.388 \\times 10^{9}) + (1.448 \\times 10^{9}) + (3.285 \\times 10^{9}) + (1.880 \\times 10^{9})$$\n$$M^* = 9.001 \\times 10^{9} \\, \\mathrm{kg}$$\n\nSL 步骤后的全球质量误差是步骤后质量与初始质量之差：\n$$\\Delta M = M^* - M^n = 9.001 \\times 10^{9} \\, \\mathrm{kg} - 9.040 \\times 10^{9} \\, \\mathrm{kg} = -0.039 \\times 10^{9} \\, \\mathrm{kg} = -3.9 \\times 10^{7} \\, \\mathrm{kg}$$\n负号表示数值上的质量损失。\n\n为了恢复质量守恒，将一个均匀的浓度校正量 $\\delta$ 添加到每个单元格的浓度中，得到校正后的浓度 $q_i^c = q_i^* + \\delta$。校正后的总质量 $M^c$ 必须等于初始总质量 $M^n$。这是这个问题的“第一性原理”。\n$$M^c = M^n$$\n代入 $M^c$ 的表达式：\n$$\\sum_{i=1}^{N} q_i^c V_i = M^n$$\n代入 $q_i^c = q_i^* + \\delta$：\n$$\\sum_{i=1}^{N} (q_i^* + \\delta) V_i = M^n$$\n我们可以分配求和：\n$$\\sum_{i=1}^{N} q_i^* V_i + \\sum_{i=1}^{N} \\delta V_i = M^n$$\n第一项是 $M^*$。第二项可以通过提出常数 $\\delta$ 来简化：\n$$M^* + \\delta \\sum_{i=1}^{N} V_i = M^n$$\n令 $V_{total} = \\sum_{i=1}^{N} V_i$ 为海洋域的总 体积。方程变为：\n$$M^* + \\delta V_{total} = M^n$$\n现在我们求解校正量 $\\delta$：\n$$\\delta V_{total} = M^n - M^*$$\n这就导出了 $\\delta$ 的表达式：\n$$\\delta = \\frac{M^n - M^*}{V_{total}} = \\frac{\\sum_{i=1}^{N} q_i^n V_i - \\sum_{i=1}^{N} q_i^* V_i}{\\sum_{i=1}^{N} V_i}$$\n这个表达式表示分布在总体积上的总质量亏损，即 $-(M^* - M^n)$。\n\n现在，我们计算 $\\delta$ 的数值。首先，我们计算总体积 $V_{total}$：\n$$V_{total} = V_1 + V_2 + V_3 + V_4 = (1.20 + 0.80 + 1.50 + 1.00) \\times 10^{12} \\, \\mathrm{m}^{3}$$\n$$V_{total} = 4.50 \\times 10^{12} \\, \\mathrm{m}^{3}$$\n使用先前计算的质量：\n$$M^n - M^* = 9.040 \\times 10^{9} \\, \\mathrm{kg} - 9.001 \\times 10^{9} \\, \\mathrm{kg} = 0.039 \\times 10^{9} \\, \\mathrm{kg}$$\n现在，我们计算 $\\delta$：\n$$\\delta = \\frac{0.039 \\times 10^{9} \\, \\mathrm{kg}}{4.50 \\times 10^{12} \\, \\mathrm{m}^{3}}$$\n$$\\delta = \\frac{3.9 \\times 10^{7}}{4.50 \\times 10^{12}} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3} = \\frac{3.9}{4.50} \\times 10^{-5} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$$\n$$\\delta = 0.008666... \\times 10^{-3} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3} = 8.666... \\times 10^{-6} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$$\n按要求将结果四舍五入到四位有效数字：\n$$\\delta \\approx 8.667 \\times 10^{-6} \\, \\mathrm{kg}\\,\\mathrm{m}^{-3}$$\n这个正值的 $\\delta$ 被加到每个单元格的浓度中，以补偿在平流步骤中损失的质量。",
            "answer": "$$\\boxed{8.667 \\times 10^{-6}}$$"
        },
        {
            "introduction": "掌握了线性量（如质量）的守恒后，我们将挑战一个更高级、也更微妙的主题：非线性量（如动能）的守恒。一个数值方案即使能完美地保持质量守恒，也可能在动能收支中引入虚假的源或汇，从而影响长期模拟的稳定性。这个高级计算练习将指导你诊断一个简化海洋模型中的动能收支误差，并将其归因于离散化方案中的特定项（如时间步进和滤波），这是评估模型物理真实性的核心技能 。",
            "id": "3788100",
            "problem": "考虑一个二维、水平均匀的平板海洋，其位于一个边长为 $L$ 的双周期方形域上，并在一个具有 $N_x \\times N_y$ 个单元和网格间距 $\\Delta x = \\Delta y = L/N_x$ 的均匀网格上进行离散化。平板速度场为 $(u(x,y,t), v(x,y,t))$，单位为米/秒 (m/s)。具有恒定风强迫、线性拖曳、粘性和行星旋转的平板动量方程为\n$$\n\\frac{\\partial u}{\\partial t} - f v = G_x - r u + \\nu \\nabla^2 u, \\quad\n\\frac{\\partial v}{\\partial t} + f u = G_y - r v + \\nu \\nabla^2 v,\n$$\n其中 $f$ 是科里奥利参数，单位为秒的倒数 (s$^{-1}$)，$r$ 是线性拖曳系数，单位为秒的倒数 (s$^{-1}$)，$\\nu$ 是运动粘度，单位为平方米/秒 (m$^2$/s)，$(G_x, G_y)$ 是由风应力引起的恒定水平加速度，单位为米/平方秒 (m/s$^2$)。离散拉普拉斯算子是周期性网格上的标准五点模板：\n$$\n\\nabla^2 \\phi_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^2}.\n$$\n\n定义单位质量的域平均动能为\n$$\nE(t) = \\left\\langle \\frac{1}{2} \\left(u^2 + v^2\\right) \\right\\rangle,\n$$\n其中 $\\langle \\cdot \\rangle$ 表示网格上的算术平均值，$E$ 的单位为平方米/平方秒 (m$^2$/s$^2$)。在一个从静止开始的启动实验中，设置 $u(x,y,0) = 0$ 和 $v(x,y,0) = 0$，施加恒定的 $(G_x, G_y)$，并使用时间步长 $\\Delta t$ 进行 $N_t$ 步的时间步进，每一步 $n \\rightarrow n+1$ 采用以下三阶段更新：\n\n1. 无旋转的显式动力学：\n$$\nu^\\ast = u^n + \\Delta t \\left(G_x - r u^n + \\nu \\nabla^2 u^n\\right), \\quad\nv^\\ast = v^n + \\Delta t \\left(G_y - r v^n + \\nu \\nabla^2 v^n\\right).\n$$\n\n2. 在 $\\Delta t$ 上的精确科里奥利旋转：\n$$\n\\begin{pmatrix} u^{\\mathrm{rot}} \\\\ v^{\\mathrm{rot}} \\end{pmatrix}\n= \\begin{pmatrix} \\cos(f \\Delta t)  -\\sin(f \\Delta t) \\\\ \\sin(f \\Delta t)  \\cos(f \\Delta t) \\end{pmatrix}\n\\begin{pmatrix} u^\\ast \\\\ v^\\ast \\end{pmatrix}.\n$$\n\n3. 应用一个系数为 $a_f$（单位为平方米(m$^2$)）的拉普拉斯 Shapiro 型滤波器：\n$$\nu^{n+1} = u^{\\mathrm{rot}} + a_f \\nabla^2 u^{\\mathrm{rot}}, \\quad\nv^{n+1} = v^{\\mathrm{rot}} + a_f \\nabla^2 v^{\\mathrm{rot}}.\n$$\n滤波器系数参数化为 $a_f = \\alpha \\Delta x^2$，其中 $\\alpha$ 是一个无量纲数。\n\n在每个时间步 $n$，将在时间 $n$ 评估的、由显式动力学阶段引起的预测能量趋势（域平均）定义为\n$$\n\\mathcal{T}_{\\mathrm{dyn}}^n = \\left\\langle u^n \\left(G_x - r u^n + \\nu \\nabla^2 u^n\\right) + v^n \\left(G_y - r v^n + \\nu \\nabla^2 v^n\\right) \\right\\rangle,\n$$\n其单位为 m$^2$/s$^3$。科里奥利旋转阶段是精确能量守恒的，其贡献的预测能量趋势为零。对于滤波器阶段，使用滤波前场通过一阶离散内积来定义预测能量趋势，\n$$\n\\mathcal{T}_{\\mathrm{fil}}^n = \\frac{1}{\\Delta t} \\left\\langle u^{\\mathrm{rot}} \\left(u^{n+1} - u^{\\mathrm{rot}}\\right) + v^{\\mathrm{rot}} \\left(v^{n+1} - v^{\\mathrm{rot}}\\right) \\right\\rangle.\n$$\n\n在步骤 $n$ 的瞬时总残余能量趋势是整个步骤中实际总动能变化与预测趋势之和之间的不匹配，\n$$\n\\mathcal{R}^n = \\frac{E^{n+1} - E^n}{\\Delta t} - \\left(\\mathcal{T}_{\\mathrm{dyn}}^n + \\mathcal{T}_{\\mathrm{fil}}^n\\right),\n$$\n单位为 m$^2$/s$^3$。直到 $N_t$ 步的累积残余误差为\n$$\n\\mathcal{C} = \\sum_{n=0}^{N_t-1} \\mathcal{R}^n \\Delta t,\n$$\n单位为 m$^2$/s$^2$。将残余分解为与动力学阶段和滤波器阶段相关的贡献，\n$$\n\\mathcal{R}_{\\mathrm{dyn}}^n = \\frac{E^{\\ast} - E^n}{\\Delta t} - \\mathcal{T}_{\\mathrm{dyn}}^n, \\quad\n\\mathcal{R}_{\\mathrm{fil}}^n = \\frac{E^{n+1} - E^{\\mathrm{rot}}}{\\Delta t} - \\mathcal{T}_{\\mathrm{fil}}^n,\n$$\n其中 $E^\\ast$ 和 $E^{\\mathrm{rot}}$ 分别是阶段 1 和阶段 2 之后的动能。使用以下分数将累积残余归因于这些特定的离散化项\n$$\n\\Phi = \\frac{\\sum_{n=0}^{N_t-1} \\left|\\mathcal{R}_{\\mathrm{fil}}^n\\right| \\Delta t}{\\sum_{n=0}^{N_t-1} \\left|\\mathcal{R}_{\\mathrm{dyn}}^n + \\mathcal{R}_{\\mathrm{fil}}^n\\right| \\Delta t},\n$$\n这是一个在 $[0,1]$ 范围内的无单位小数。如果分母在数值上为零，则定义 $\\Phi = 0$。\n\n在均匀网格上使用周期性边界条件，从静止开始实现上述过程。使用以下参数集测试套件；在每种情况下，报告：\n- 所有步骤中瞬时残余能量趋势的最大绝对值，$\\max_n \\left|\\mathcal{R}^n\\right|$，单位为 m$^2$/s$^3$，\n- 累积残余 $\\mathcal{C}$，单位为 m$^2$/s$^2$，\n- 归因分数 $\\Phi$，以小数形式表示。\n\n测试套件：\n- 案例 A（一般性启动）：$L = 1.0 \\times 10^5$ m，$N_x = N_y = 32$，$\\Delta t = 50$ s，$N_t = 200$，$f = 1.0 \\times 10^{-4}$ s$^{-1}$，$r = 1.0 \\times 10^{-5}$ s$^{-1}$，$\\nu = 10$ m$^2$/s，$\\alpha = 0.05$，$G_x = 1.0 \\times 10^{-6}$ m/s$^2$，$G_y = 0$ m/s$^2$。\n- 案例 B（接近扩散稳定性极限）：$L = 1.0 \\times 10^5$ m，$N_x = N_y = 32$，$\\nu = 50$ m$^2$/s，$\\Delta t = 0.9 \\, \\Delta x^2/(4 \\nu)$，$N_t = 50$，$f = 1.0 \\times 10^{-4}$ s$^{-1}$，$r = 1.0 \\times 10^{-5}$ s$^{-1}$，$\\alpha = 0.10$，$G_x = 5.0 \\times 10^{-7}$ m/s$^2$，$G_y = 0$ m/s$^2$。\n- 案例 C（无滤波器）：$L = 1.0 \\times 10^5$ m，$N_x = N_y = 32$，$\\Delta t = 200$ s，$N_t = 100$，$f = 1.0 \\times 10^{-4}$ s$^{-1}$，$r = 1.0 \\times 10^{-5}$ s$^{-1}$，$\\nu = 5$ m$^2$/s，$\\alpha = 0$，$G_x = 1.0 \\times 10^{-6}$ m/s$^2$，$G_y = 0$ m/s$^2$。\n\n最终输出格式：\n您的程序应产生单行输出，其中包含一个由三个列表组成的列表，每个测试案例一个列表，其中每个内部列表按上述顺序包含三个量。格式必须是 Python 风格的列表的列表，使用逗号分隔值，不带单位或附加文本，例如：\"[[x11,x12,x13],[x21,x22,x23],[x31,x32,x33]]\"。所有能量趋势值必须以 m$^2$/s$^3$ 为单位，所有累积残余值必须以 m$^2$/s$^2$ 为单位，归因分数必须是 $[0,1]$ 范围内的小数。",
            "solution": "用户提供了一个计算海洋学中的适定问题。任务是实现一个二维平板海洋模型的数值模拟，并分析指定时间步进方案的能量守恒特性。该问题具有科学依据，内部一致，并要求计算特定的、定义明确的度量标准。\n\n求解过程包括以下步骤：\n1.  在均匀、周期性的网格上将连续方程离散化。\n2.  实现三阶段时间步进算法。\n3.  在每个时间步计算域平均动能及其相关的趋势和残余。\n4.  在整个模拟过程中汇总这些诊断量，以计算三个不同测试案例的最终所需量。\n\n**1. 模型离散化**\n\n模型定义在一个边长为 $L$ 的双周期方形域上，离散为 $N_x \\times N_y$ 个网格单元。因此，空间分辨率为 $\\Delta x = \\Delta y = L/N_x$。速度分量 $u$ 和 $v$ 由大小为 $N_x \\times N_y$ 的二维数组表示。\n\n关键的空间算子是拉普拉斯算子 $\\nabla^2$。对于网格索引 $(i,j)$ 处的标量场 $\\phi_{i,j}$，周期性网格上离散拉普拉斯算子的标准五点模板由下式给出：\n$$\n\\nabla^2 \\phi_{i,j} = \\frac{\\phi_{i+1,j} + \\phi_{i-1,j} - 2\\phi_{i,j}}{\\Delta x^2} + \\frac{\\phi_{i,j+1} + \\phi_{i,j-1} - 2\\phi_{i,j}}{\\Delta y^2}\n$$\n鉴于 $\\Delta x = \\Delta y$，这可以简化为：\n$$\n\\nabla^2 \\phi_{i,j} = \\frac{\\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4\\phi_{i,j}}{\\Delta x^2}\n$$\n此操作通过尊重周期性边界条件的数组操作（例如，通过移位数组索引）来高效实现。\n\n**2. 时间步进算法**\n\n模拟从静止的初始状态 $u(x,y,0) = 0$ 和 $v(x,y,0) = 0$ 开始，以大小为 $\\Delta t$ 的时间步推进 $N_t$ 步。使用分数步法，其中每个完整步骤 $n \\rightarrow n+1$ 被分解为三个阶段：\n\n**阶段 1：显式动力学**\n该阶段使用显式前向欧拉法应用强迫项、拖曳项和粘性项。在步骤 $n$ 的速度场 $(u^n, v^n)$ 被更新为一个中间状态 $(u^\\ast, v^\\ast)$：\n$$\nu^\\ast = u^n + \\Delta t \\left(G_x - r u^n + \\nu \\nabla^2 u^n\\right)\n$$\n$$\nv^\\ast = v^n + \\Delta t \\left(G_y - r v^n + \\nu \\nabla^2 v^n\\right)\n$$\n\n**阶段 2：科里奥利旋转**\n该阶段应用行星旋转效应。中间速度场 $(u^\\ast, v^\\ast)$ 被旋转以产生 $(u^{\\mathrm{rot}}, v^{\\mathrm{rot}})$。这对应于仅含科里奥利项的方程 $\\partial u/\\partial t - fv = 0$ 和 $\\partial v/\\partial t + fu = 0$ 在时间间隔 $\\Delta t$ 上的精确解析解。\n$$\n\\begin{pmatrix} u^{\\mathrm{rot}} \\\\ v^{\\mathrm{rot}} \\end{pmatrix}\n= \\begin{pmatrix} \\cos(f \\Delta t)  -\\sin(f \\Delta t) \\\\ \\sin(f \\Delta t)  \\cos(f \\Delta t) \\end{pmatrix}\n\\begin{pmatrix} u^\\ast \\\\ v^\\ast \\end{pmatrix}\n$$\n这种旋转是一种正交变换，因此是精确能量守恒的，意味着 $(u^{\\mathrm{rot}}, v^{\\mathrm{rot}})$ 的动能与 $(u^\\ast, v^\\ast)$ 的动能相同。\n\n**阶段 3：Shapiro 滤波器**\n应用一个滤波器以去除小尺度数值噪音。这等效于另一个显式扩散步。滤波器系数 $a_f = \\alpha \\Delta x^2$ 控制扩散的强度。\n$$\nu^{n+1} = u^{\\mathrm{rot}} + a_f \\nabla^2 u^{\\mathrm{rot}}\n$$\n$$\nv^{n+1} = v^{\\mathrm{rot}} + a_f \\nabla^2 v^{\\mathrm{rot}}\n$$\n此更新提供了下一个时间步的最终速度场 $(u^{n+1}, v^{n+1})$。\n\n**3. 能量守恒分析**\n\n问题的核心是诊断数值方案与完全守恒的能量收支的偏差。单位质量的域平均动能定义为：\n$$\nE(t) = \\left\\langle \\frac{1}{2} \\left(u^2 + v^2\\right) \\right\\rangle\n$$\n其中 $\\langle \\cdot \\rangle$ 表示所有网格单元的算术平均值。\n\n分析通过比较每个阶段动能的实际变化与基于一阶趋势的预测变化来进行。这种不匹配即为残余误差。\n\n**预测趋势：**\n动力学阶段的预测趋势 $\\mathcal{T}_{\\mathrm{dyn}}^n$ 是速度场 $u^n, v^n$ 与动力学强迫项的离散内积：\n$$\n\\mathcal{T}_{\\mathrm{dyn}}^n = \\left\\langle u^n \\left(G_x - r u^n + \\nu \\nabla^2 u^n\\right) + v^n \\left(G_y - r v^n + \\nu \\nabla^2 v^n\\right) \\right\\rangle\n$$\n类似地，滤波器阶段的预测趋势 $\\mathcal{T}_{\\mathrm{fil}}^n$ 是使用滤波前场 $(u^{\\mathrm{rot}}, v^{\\mathrm{rot}})$ 定义的：\n$$\n\\mathcal{T}_{\\mathrm{fil}}^n = \\frac{1}{\\Delta t} \\left\\langle u^{\\mathrm{rot}} \\left(u^{n+1} - u^{\\mathrm{rot}}\\right) + v^{\\mathrm{rot}} \\left(v^{n+1} - v^{\\mathrm{rot}}\\right) \\right\\rangle = \\frac{a_f}{\\Delta t} \\left\\langle u^{\\mathrm{rot}} \\nabla^2 u^{\\mathrm{rot}} + v^{\\mathrm{rot}} \\nabla^2 v^{\\mathrm{rot}} \\right\\rangle\n$$\n\n**残余：**\n每个阶段的残余是实际能量变化与预测趋势之间的差值。\n对于动力学阶段，残余是：\n$$\n\\mathcal{R}_{\\mathrm{dyn}}^n = \\frac{E^{\\ast} - E^n}{\\Delta t} - \\mathcal{T}_{\\mathrm{dyn}}^n\n$$\n其中 $E^n$ 和 $E^\\ast$ 分别是从 $(u^n, v^n)$ 和 $(u^\\ast, v^\\ast)$ 计算的能量。此残余的产生是因为非线性动能方程的显式欧拉方案引入了一个数值耗散项。具体来说，$\\mathcal{R}_{\\mathrm{dyn}}^n = \\frac{1}{2\\Delta t} \\langle (\\Delta t (G_x - \\dots))^2 + \\dots \\rangle$，它是 $O(\\Delta t)$ 阶的，并且始终非负。\n\n对于滤波器阶段，残余是：\n$$\n\\mathcal{R}_{\\mathrm{fil}}^n = \\frac{E^{n+1} - E^{\\mathrm{rot}}}{\\Delta t} - \\mathcal{T}_{\\mathrm{fil}}^n\n$$\n其中 $E^{\\mathrm{rot}}$ 和 $E^{n+1}$ 分别是阶段 2 和 3 之后的能量。此残余有类似的来源，源于能量的二次性质，可以证明为 $\\mathcal{R}_{\\mathrm{fil}}^n = \\frac{1}{2\\Delta t}\\langle (a_f \\nabla^2 u^{\\mathrm{rot}})^2 + (a_f \\nabla^2 v^{\\mathrm{rot}})^2 \\rangle$。这也是一个非负耗散项。\n\n总瞬时残余是 $\\mathcal{R}^n = \\mathcal{R}_{\\mathrm{dyn}}^n + \\mathcal{R}_{\\mathrm{fil}}^n$ 的和，这一点由科里奥利阶段能量守恒（$E^{\\mathrm{rot}}=E^\\ast$）的事实所证实。\n\n**4. 最终诊断量**\n\n从计算出的残余的时间序列中，为每个测试案例计算三个所需量：\n1.  **最大绝对瞬时残余，$\\max_n |\\mathcal{R}^n|$**：这表示模拟期间能量不守恒误差的峰值率。\n2.  **累积残余，$\\mathcal{C}$**：这是在整个模拟过程中累积的总净能量误差，计算为 $\\mathcal{C} = \\sum_{n=0}^{N_t-1} \\mathcal{R}^n \\Delta t$。\n3.  **归因分数，$\\Phi$**：该分数量化了滤波器阶段对残余误差总量的相对贡献：\n    $$\n    \\Phi = \\frac{\\sum_{n=0}^{N_t-1} \\left|\\mathcal{R}_{\\mathrm{fil}}^n\\right|}{\\sum_{n=0}^{N_t-1} \\left|\\mathcal{R}_{\\mathrm{dyn}}^n + \\mathcal{R}_{\\mathrm{fil}}^n\\right|}\n    $$\n    一个接近 $1$ 的 $\\Phi$ 值意味着滤波器是诊断出的数值能量耗散的主要来源，而一个接近 $0$ 的值则意味着显式动力学时间步进是主要来源。\n\n实现过程通过循环遍历时间步，计算所有中间场和诊断量，并最终根据上述定义汇总它们来进行。",
            "answer": "[[1.2291079313261376e-07,0.0003004589255013088,0.2885974780617937],[1.545638161565355e-08,2.768653245455985e-06,0.380721780516428],[5.184343160455581e-07,0.0017109724103191024,0.0]]"
        }
    ]
}