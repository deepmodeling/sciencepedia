{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导你从第一性原理出发，为两种不同类型的区域——封闭海盆和周期性通道——推导浅水波的基本解。通过对比结果，你将直观地看到边界条件如何决定解的物理性质，一种情况下产生固定的驻波（假潮），另一种情况下则产生行波。这项练习有助于建立关于边界选择所带来的物理后果的深刻直觉。",
            "id": "3786297",
            "problem": "考虑一个长度为 $L$、均匀深度为 $H$ 的一维、无摩擦、恒定深度的海洋通道，其运动由用于正压运动的线性化浅水方程控制：\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0, \\quad \\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0,\n$$\n其中 $\\eta(x,t)$ 是自由表面高程，$u(x,t)$ 是深度平均速度，$g$ 是重力加速度。从这些方程出发，且不引用任何预先推导的模态公式，完成以下任务：\n\n1. 通过变量分离法推导简正模解和色散关系，解释在不同边界条件下出现的模态的物理性质（驻波与行波）。\n\n2. 对于一个在 $x=0$ 和 $x=L$ 处有刚性壁的封闭海盆，施加无法向流动的边界条件 $u(0,t) = 0$ 和 $u(L,t) = 0$。确定其空间结构和允许的波数。明确展示边界条件如何导致驻波式假潮模式，并讨论 $u$ 和 $\\eta$ 之间与能量通量相关的相位关系。\n\n3. 对于一个具有周期性条件 $u(x+L,t) = u(x,t)$ 和 $\\eta(x+L,t) = \\eta(x,t)$ 的周期性通道，确定允许的波数并将相应的解描述为行波。解释周期性边界条件如何允许携带能量的模态存在。\n\n最后，计算封闭海盆中基频（最低频率）正压本征频率与同样长度 $L$ 和深度 $H$ 的周期性通道中基频正压行波频率的无量纲比值 $R$。将最终答案表示为单个无量纲数。无需四舍五入。",
            "solution": "该问题要求在两种不同的边界条件下，系统地推导一维浅水波的简正模，并最终比较它们的基频。分析将从给定的控制方程开始。\n\n一维、无摩擦、恒定深度通道的线性化浅水方程如下：\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0 \\quad (1)\n$$\n$$\n\\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0 \\quad (2)\n$$\n其中 $\\eta(x,t)$ 是自由表面高程，$u(x,t)$ 是深度平均速度，$H$ 是均匀深度，$g$ 是重力加速度。\n\n**1. 简正模与色散关系的推导**\n\n为了推导简正模解，我们首先将这两个一阶偏微分方程（PDE）合并成一个二阶偏微分方程。我们将方程（1）对 $t$ 求导，将方程（2）对 $x$ 求导：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} + H \\frac{\\partial^2 u}{\\partial t \\partial x} = 0\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial t} + g \\frac{\\partial^2 \\eta}{\\partial x^2} = 0\n$$\n假设 $\\eta$ 和 $u$ 足够光滑，使得微分顺序可以互换（Schwarz 定理），我们有 $\\frac{\\partial^2 u}{\\partial t \\partial x} = \\frac{\\partial^2 u}{\\partial x \\partial t}$。将第二个方程中混合偏导数的表达式代入第一个方程，得到：\n$$\n\\frac{\\partial^2 \\eta}{\\partial t^2} - gH \\frac{\\partial^2 \\eta}{\\partial x^2} = 0\n$$\n这是经典波动方程 $\\frac{\\partial^2 \\eta}{\\partial t^2} = c^2 \\frac{\\partial^2 \\eta}{\\partial x^2}$，其波相速度为 $c = \\sqrt{gH}$。\n\n我们使用变量分离法求解简正模。设 $\\eta(x,t) = \\hat{\\eta}(x) T(t)$。将其代入波动方程，得到：\n$$\n\\hat{\\eta}(x) \\frac{d^2 T}{dt^2} = c^2 T(t) \\frac{d^2 \\hat{\\eta}}{dx^2}\n$$\n用 $\\hat{\\eta}(x)T(t)$ 除以方程两边并重新整理，我们分离变量：\n$$\n\\frac{1}{c^2 T(t)} \\frac{d^2 T}{dt^2} = \\frac{1}{\\hat{\\eta}(x)} \\frac{d^2 \\hat{\\eta}}{dx^2}\n$$\n由于左侧仅为 $t$ 的函数，右侧仅为 $x$ 的函数，因此两边都必须等于一个常数。对于振荡（类波）解，该常数必须为负。我们将其记为 $-k^2$，其中 $k$ 是波数。这给出了两个常微分方程：\n$$\n\\frac{d^2 T}{dt^2} + (kc)^2 T = 0\n$$\n$$\n\\frac{d^2 \\hat{\\eta}}{dx^2} + k^2 \\hat{\\eta} = 0\n$$\n时间方程的解形式为 $T(t) \\propto \\exp(\\pm i \\omega t)$，其中角频率 $\\omega$ 与波数 $k$ 的关系为：\n$$\n\\omega^2 = (kc)^2 \\implies \\omega = \\pm ck = \\pm k\\sqrt{gH}\n$$\n这就是浅水波的色散关系。它表明频率与波数成线性正比，意味着这些波是非色散的：所有波都以相同的相速度 $c = \\sqrt{gH}$ 传播，无论其波长如何。\n\n空间方程的通解形式为 $\\hat{\\eta}(x) = A \\cos(kx) + B \\sin(kx)$。$k$ 的具体值以及常数 $A$ 和 $B$ 由边界条件确定。\n$\\eta(x,t)$ 的通解是模态的叠加，可以表示为行波 $\\exp(i(kx \\pm \\omega t))$ 或作为这些行波叠加而成的驻波。边界条件决定了哪种形式是物理上实现的。\n\n**2. 封闭海盆（假潮模态）**\n\n对于长度为 $L$ 的封闭海盆，边界条件是在刚性壁处无法向流动，即 $u(0,t)=0$ 和 $u(L,t)=0$。为应用这些条件，我们必须找到与我们 $\\eta(x,t)$ 解相对应的速度场 $u(x,t)$。假设两个场都具有 $\\exp(-i\\omega t)$ 的谐波时间依赖性，方程（1）和（2）变为：\n$$\n-i\\omega \\hat{\\eta} + H \\frac{d\\hat{u}}{dx} = 0\n$$\n$$\n-i\\omega \\hat{u} + g \\frac{d\\hat{\\eta}}{dx} = 0 \\implies \\hat{u} = \\frac{g}{i\\omega} \\frac{d\\hat{\\eta}}{dx}\n$$\n对于 $\\hat{\\eta}(x) = A \\cos(kx) + B \\sin(kx)$，我们有 $\\frac{d\\hat{\\eta}}{dx} = -Ak \\sin(kx) + Bk \\cos(kx)$。\n因此，速度的空间结构为：\n$$\n\\hat{u}(x) = \\frac{gk}{i\\omega} (-A \\sin(kx) + B \\cos(kx))\n$$\n应用 $x=0$ 处的边界条件：\n$$\n\\hat{u}(0) = \\frac{gk}{i\\omega} (B) = 0 \\implies B=0\n$$\n这意味着高程的空间结构必须是纯余弦形式，$\\hat{\\eta}(x) = A \\cos(kx)$，而速度结构必须是正弦形式，$\\hat{u}(x) = - A \\frac{gk}{i\\omega} \\sin(kx)$。\n\n现在，应用 $x=L$ 处的边界条件：\n$$\n\\hat{u}(L) = - A \\frac{gk}{i\\omega} \\sin(kL) = 0\n$$\n对于非平凡解（$A \\neq 0$），我们必须有 $\\sin(kL) = 0$。这个条件量化了允许的波数：\n$$\nkL = n\\pi, \\quad \\text{其中 } n=1, 2, 3, \\dots\n$$\n允许的波数为 $k_n = \\frac{n\\pi}{L}$。$n=0$ 的情况意味着 $k=0$，这导致 $\\hat{u}(x) \\equiv 0$ 和 $\\hat{\\eta}(x) = \\text{常数}$。这对应于水位的均匀升高或降低，速度和频率均为零，不是一个动力模态。最低频率的动力模态是 $n=1$ 的情况。\n\n简正模（假潮）的完整解为：\n$$\n\\eta_n(x,t) = A_n \\cos\\left(\\frac{n\\pi x}{L}\\right) \\cos(\\omega_n t + \\phi_n)\n$$\n$$\nu_n(x,t) = \\frac{g k_n A_n}{\\omega_n} \\sin\\left(\\frac{n\\pi x}{L}\\right) \\sin(\\omega_n t + \\phi_n) = \\frac{c A_n}{H} \\sin\\left(\\frac{n\\pi x}{L}\\right) \\sin(\\omega_n t + \\phi_n)\n$$\n其中 $\\omega_n = c k_n = \\frac{n\\pi\\sqrt{gH}}{L}$。\n\n这些解是驻波。空间模式，即 $\\eta$ 的 $\\cos(k_n x)$ 和 $u$ 的 $\\sin(k_n x)$，是固定的，它们的振幅随时间振荡。注意 $\\eta$ 和 $u$ 在时间上存在正交相位关系（$\\pi/2$ 相移）。当高程最大时（在晃动的转折点），速度为零。当速度最大时（在晃动的中点），水面是平的（$\\eta=0$）。这表示在势能（与 $\\eta^2$ 成正比）和动能（与 $u^2$ 成正比）之间的振荡。时间平均能量通量与 $\\langle \\eta u \\rangle$ 成正比，其值为零，因为 $\\langle \\cos(\\omega t) \\sin(\\omega t) \\rangle = 0$。没有净能量传播。\n\n**3. 周期性通道（行波）**\n\n对于周期性通道，边界条件要求解在长度 $L$ 上是周期的：$u(x+L,t) = u(x,t)$ 和 $\\eta(x+L,t) = \\eta(x,t)$。最自然的方法是使用复指数形式表示解的空间部分，$\\hat{\\eta}(x) = A\\exp(ikx)$ 和 $\\hat{u}(x) = \\hat{U}\\exp(ikx)$，这代表行波。\n对 $\\hat{\\eta}(x)$ 应用周期性条件：\n$$\nA\\exp(ik(x+L)) = A\\exp(ikx) \\implies \\exp(ikL) = 1\n$$\n当 $kL$ 是 $2\\pi$ 的整数倍时，此条件成立：\n$$\nkL = 2n\\pi, \\quad \\text{其中 } n \\in \\mathbb{Z} \\text{（任何整数）}\n$$\n允许的波数是 $k_n = \\frac{2n\\pi}{L}$。正整数 $n$ 对应于沿 $+x$ 方向传播的波，负整数对应于沿 $-x$ 方向传播的波。$n=0$ 同样是零频率、恒定状态的模态。\n\n解是形如下式的行波：\n$$\n\\eta_n(x,t) = A_n \\exp\\left(i\\left(\\frac{2n\\pi x}{L} - \\omega_n t\\right)\\right)\n$$\n其中 $\\omega_n = c |k_n| = \\frac{2|n|\\pi\\sqrt{gH}}{L}$。与封闭海盆相反，周期性边界条件允许持续传播能量的模态。为了看到这一点，我们找到相应的速度 $u$。对于沿 $+x$ 方向传播的波（$n>0$），取解的实部：\n$$\n\\eta(x,t) = A \\cos(kx - \\omega t)\n$$\n由 $\\partial u/\\partial t = -g \\partial \\eta/\\partial x = -g(-kA\\sin(kx-\\omega t))$，积分可得：\n$$\nu(x,t) = \\frac{gk}{\\omega} A \\cos(kx - \\omega t) = \\frac{g}{c} A \\cos(kx-\\omega t) = \\sqrt{\\frac{g}{H}} \\eta(x,t)\n$$\n在这里，$u$ 和 $\\eta$ 是同相的。时间平均能量通量与 $\\langle \\eta u \\rangle = \\sqrt{\\frac{g}{H}} \\langle \\eta^2 \\rangle$ 成正比。由于 $\\langle \\cos^2(\\cdot) \\rangle = 1/2$，时间平均通量非零，表明能量在波的传播方向上有净输运。\n\n**频率比 R 的计算**\n\n我们需要找到封闭海盆中的基频本征频率与周期性通道中基频本征频率的比值 $R$。“基频”是最低的非零频率。\n\n-   **封闭海盆基频 ($\\omega_{closed, fund}$)**：这对应于 $n=1$ 的模态。\n    波数为 $k_{closed, fund} = \\frac{\\pi}{L}$。\n    频率为 $\\omega_{closed, fund} = c \\cdot k_{closed, fund} = \\sqrt{gH} \\frac{\\pi}{L}$。\n\n-   **周期性通道基频 ($\\omega_{periodic, fund}$)**：基频行波频率对应于波数的最小非零绝对值，即 $n=\\pm 1$ 的情况。\n    波数为 $|k_{periodic, fund}| = \\frac{2\\pi}{L}$。\n    频率为 $\\omega_{periodic, fund} = c \\cdot |k_{periodic, fund}| = \\sqrt{gH} \\frac{2\\pi}{L}$。\n\n-   **比值 $R$**:\n    $$\n    R = \\frac{\\omega_{closed, fund}}{\\omega_{periodic, fund}} = \\frac{\\sqrt{gH} \\frac{\\pi}{L}}{\\sqrt{gH} \\frac{2\\pi}{L}} = \\frac{\\frac{\\pi}{L}}{\\frac{2\\pi}{L}}\n    $$\n    $$\n    R = \\frac{\\pi}{2\\pi} = \\frac{1}{2}\n    $$\n物理上的解释是，封闭海盆中的基模波长为 $\\lambda = 2L$（半个波长恰好容纳在海盆中），而周期性通道中的基模波长为 $\\lambda=L$（一个完整波长恰好容纳在区域内）。由于对于恒定的相速度，频率与波长成反比（$\\omega = c k = c \\frac{2\\pi}{\\lambda}$），因此封闭海盆模态的频率是周期性通道模态频率的一半。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "在理解了边界条件的物理影响之后，我们现在转向在数值模型中实现这些条件的实际问题。本练习使用“人造解方法”(Method of Manufactured Solutions)来分析一个常用的封闭（诺伊曼）边界数值格式的精度。理解截断误差对于验证代码和确保数值解能忠实地代表其背后的物理过程至关重要。",
            "id": "3786299",
            "problem": "考虑区间 $[0,L]$ 上的一维稳态示踪剂扩散方程，\n$$\\kappa\\,\\frac{d^{2}u}{dx^{2}} = f(x),$$\n其中扩散系数 $\\kappa0$ 为常数。在 $x=0$ 处通过齐次 Neumann 条件 $u_{x}(0)=0$ 施加封闭壁边界，并在 $x=L$ 处通过指定来自制造解的精确 Dirichlet 值 $u(L)$ 施加开放边界。使用制造解方法 (MMS)，选择精确解为 $u(x)=\\cos(\\alpha x)$（对于给定的常数波数 $\\alpha0$），并设置强迫项为 $f(x)=\\kappa\\,u_{xx}(x)$，从而精确满足连续问题。\n\n使用均匀网格 $x_{i}=i\\,h$（其中 $i=0,1,\\dots,N$ 且 $h=L/N$）对区间 $[0,L]$ 进行离散化。对内部点的二阶导数使用标准的二阶中心差分近似，\n$$\\left.\\frac{d^{2}u}{dx^{2}}\\right|_{x=x_{i}} \\approx \\frac{u_{i+1}-2u_{i}+u_{i-1}}{h^{2}},\\quad i=1,2,\\dots,N-1,$$\n并在 $i=0$ 处使用二阶单边格式施加壁面 Neumann 条件\n$$u_{x}(0) \\approx \\frac{-3\\,u_{0}+4\\,u_{1}-u_{2}}{2\\,h}.$$\n在开放边界处，精确设置 $u_{N}=u(L)$。\n\n首先，从 $x=0$ 处的泰勒展开出发，推导壁面边界格式的主阶截断误差，并用 $h$ 和在 $x=0$ 处计算的 $u$ 的导数表示。然后，将内部点的离散算子与此壁面边界处理共同视为一个单一的线性系统，根据椭圆算子的性质和离散 $L^{2}$ 范数\n$$\\|v\\|_{2,h}=\\left(h\\sum_{i=0}^{N} v_{i}^{2}\\right)^{1/2}$$\n来确定在此 MMS 设置中，当 $h\\to 0$ 时，离散解 $\\{u_{i}\\}_{i=0}^{N}$ 收敛到精确解 $u(x)$ 的渐近全局 $L^{2}$ 收敛阶 $p$。\n\n你的最终答案应为一个数字 $p$。无需四舍五入。",
            "solution": "该问题要求两个结果：一个用于 Neumann 边界条件的特定格式的主阶截断误差，以及一个用于一维扩散方程的有限差分格式的整体全局收敛阶。\n\n首先，我们推导 $x=0$ 处壁面边界条件的主阶截断误差。问题指明，齐次 Neumann 条件 $u_x(0)=0$ 使用以下单边格式进行近似：\n$$u_x(0) \\approx \\frac{-3u_0 + 4u_1 - u_2}{2h}$$\n其中 $u_i = u(x_i) = u(ih)$。局部截断误差 $\\tau_0$ 是将精确解 $u(x)$ 代入离散近似式中得到的残差。\n$$\\tau_0 = \\frac{-3u(0) + 4u(h) - u(2h)}{2h} - u_x(0)$$\n为了确定该误差的阶，我们使用 $u(h)$ 和 $u(2h)$ 在 $x=0$ 附近的泰勒级数展开：\n$$u(h) = u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0) + O(h^4)$$\n$$u(2h) = u(0) + (2h)u_x(0) + \\frac{(2h)^2}{2}u_{xx}(0) + \\frac{(2h)^3}{6}u_{xxx}(0) + O(h^4) = u(0) + 2h u_x(0) + 2h^2 u_{xx}(0) + \\frac{4h^3}{3} u_{xxx}(0) + O(h^4)$$\n将这些展开式代入格式的分子中：\n$$-3u(0) + 4u(h) - u(2h) = -3u(0) + 4\\left[u(0) + h u_x(0) + \\frac{h^2}{2} u_{xx}(0) + \\frac{h^3}{6} u_{xxx}(0)\\right] - \\left[u(0) + 2h u_x(0) + 2h^2 u_{xx}(0) + \\frac{4h^3}{3} u_{xxx}(0)\\right] + O(h^4)$$\n我们收集在 $x=0$ 处计算的具有相同 $u$ 导数的项：\n\\begin{itemize}\n    \\item $u(0)$ 项：$(-3 + 4 - 1)u(0) = 0$\n    \\item $u_x(0)$ 项：$(4h - 2h)u_x(0) = 2h u_x(0)$\n    \\item $u_{xx}(0)$ 项：$\\left(4\\frac{h^2}{2} - 2h^2\\right)u_{xx}(0) = (2h^2 - 2h^2)u_{xx}(0) = 0$\n    \\item $u_{xxx}(0)$ 项：$\\left(4\\frac{h^3}{6} - \\frac{4h^3}{3}\\right)u_{xxx}(0) = \\left(\\frac{2}{3} - \\frac{4}{3}\\right)h^3 u_{xxx}(0) = -\\frac{2h^3}{3} u_{xxx}(0)$\n\\end{itemize}\n因此分子简化为 $2h u_x(0) - \\frac{2h^3}{3} u_{xxx}(0) + O(h^4)$。将其代回 $\\tau_0$ 的表达式中：\n$$\\tau_0 = \\frac{2h u_x(0) - \\frac{2h^3}{3} u_{xxx}(0) + O(h^4)}{2h} - u_x(0) = \\left( u_x(0) - \\frac{h^2}{3} u_{xxx}(0) + O(h^3) \\right) - u_x(0)$$\n$$\\tau_0 = -\\frac{h^2}{3} u_{xxx}(0) + O(h^3)$$\n壁面边界格式的主阶截断误差是 $-\\frac{h^2}{3} u_{xxx}(0)$，即 $h^2$ 阶。\n\n第二步，我们确定渐近全局 $L^2$ 收敛阶 $p$。根据微分方程数值方法的基本理论，对于应用于适定问题的稳定且相容的格式，其全局收敛阶等于其局部截断误差的阶（相容性）。\n\n我们分析整个离散化格式的局部截断误差 (LTE)。制造解方法 (MMS) 设置 $f(x) = \\kappa u_{xx}(x)$，因此精确解 $u(x)$ 精确地满足该偏微分方程。制造解 $u(x) = \\cos(\\alpha x)$ 也满足边界条件 $u_x(0) = -\\alpha\\sin(0) = 0$。\n\n1.  **壁面边界处的 LTE ($i=0$):** 离散方程为 $\\frac{-3u_0+4u_1-u_2}{2h}=0$。将精确解代入此方程得到的残差即为 LTE：\n    $$\\tau_0 = \\frac{-3u(x_0)+4u(x_1)-u(x_2)}{2h} - 0$$\n    根据我们之前的推导，这等于 $u_x(0) - \\frac{h^2}{3}u_{xxx}(0) + O(h^3)$。由于对于所选解有 $u_x(0)=0$，因此 $\\tau_0 = O(h^2)$。\n\n2.  **内部点处的 LTE ($i=1, \\dots, N-1$):** 离散方程为 $\\kappa \\frac{u_{i+1}-2u_i+u_{i-1}}{h^2} = f_i$。LTE 为：\n    $$\\tau_i = \\kappa \\frac{u(x_{i+1})-2u(x_i)+u(x_{i-1})}{h^2} - f(x_i)$$\n    由于 $f(x_i) = \\kappa u_{xx}(x_i)$，这变为 $\\tau_i = \\kappa \\left( \\frac{u(x_{i+1})-2u(x_i)+u(x_{i-1})}{h^2} - u_{xx}(x_i) \\right)$。括号中的项是二阶导数的标准二阶中心差分的截断误差，泰勒展开表明其为 $\\frac{h^2}{12}u_{xxxx}(x_i) + O(h^4)$。因此，$\\tau_i=O(h^2)$。\n\n3.  **开放边界处的 LTE ($i=N$):** 离散方程为 $u_N=u(L)$，精确解 $u(x)$ 精确满足该方程。因此，$\\tau_N = u(x_N) - u(L) = u(L) - u(L) = 0$。\n\n局部截断误差向量 $\\vec{\\tau} = (\\tau_0, \\tau_1, \\dots, \\tau_N)^T$ 的分量为：对于 $i \\in \\{0, \\dots, N-1\\}$ 有 $\\tau_i=O(h^2)$，且 $\\tau_N=0$。我们现在计算该误差向量的指定离散 $L^2$ 范数：\n$$\\|\\vec{\\tau}\\|_{2,h}^2 = h \\sum_{i=0}^{N} \\tau_i^2 = h \\left( \\sum_{i=0}^{N-1} \\tau_i^2 + \\tau_N^2 \\right) = h \\sum_{i=0}^{N-1} (O(h^2))^2 = h \\sum_{i=0}^{N-1} O(h^4)$$\n该求和包含 $N$ 项，并且由于 $N=L/h$，我们有 $N \\propto h^{-1}$。\n$$\\|\\vec{\\tau}\\|_{2,h}^2 = h \\cdot N \\cdot O(h^4) = h \\cdot O(h^{-1}) \\cdot O(h^4) = O(h^4)$$\n取平方根得到 LTE 的范数：\n$$\\|\\vec{\\tau}\\|_{2,h} = \\sqrt{O(h^4)} = O(h^2)$$\n该格式是 2 阶相容的。具有混合 Neumann-Dirichlet 边界条件的一维椭圆问题是适定的，且给定的有限差分格式是稳定的。根据“稳定性 + 相容性 ⇒ 收敛性”的原则，离散解 $\\{u_i\\}$ 的全局误差以与局部截断误差相同的速率收敛到零。\n全局误差 $e_i = u_i - u(x_i)$ 因此满足 $\\|\\vec{e}\\|_{2,h} = O(h^2)$。渐近全局 $L^2$ 收敛阶 $p$ 是此关系式中 $h$ 的指数。因此，$p=2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "最后的这项练习将从理论走向具体的编程实现，解决在海洋模型中常见的 Arakawa C-网格上施加周期性边界条件的挑战。你将实现并比较两种常用技术——“光环”单元(halo cells)和模运算(modular arithmetic)——以确保所有物理变量的无缝衔接。对于任何开发或使用计算流体动力学代码的人来说，这都是一项至关重要的技能。",
            "id": "3786271",
            "problem": "考虑一个用于计算海洋学的二维 Arakawa C-grid（阿拉卡瓦 C-网格）离散化。假设网格在 $x$ 方向有 $N_x$ 个内部示踪物单元，在 $y$ 方向有 $N_y$ 个内部示踪物单元。物理单元尺寸为 $d_x$ 米和 $d_y$ 米。示踪物单元中心由 $(j,i)$ 索引，其中 $j \\in \\{1,\\dots,N_y\\}$（行索引向上增加）和 $i \\in \\{1,\\dots,N_x\\}$（列索引向右增加）。单元中心的预报示踪物变量为 $T$，垂直面上的纬向速度为 $u$，水平面上的经向速度为 $v$。在 Arakawa C-grid 上，$u$ 定义在位置 $(j,i+\\tfrac{1}{2})$ 处，其中 $j \\in \\{1,\\dots,N_y\\}$ 和 $i \\in \\{0,\\dots,N_x\\}$；而 $v$ 定义在 $(j+\\tfrac{1}{2},i)$ 处，其中 $j \\in \\{0,\\dots,N_y\\}$ 和 $i \\in \\{1,\\dots,N_x\\}$。\n\n为了高效地执行边界附近的通量计算，模型代码通常在每个数组周围维护一个一单元宽的光环（也称为“幽灵”单元层）。对于以单元为中心的示踪物场 $T$，带有光环的数组的索引为 $(j,i)$，其中 $j \\in \\{0,\\dots,N_y+1\\}$ 和 $i \\in \\{0,\\dots,N_x+1\\}$，而索引 $j=1,\\dots,N_y$ 和 $i=1,\\dots,N_x$ 指的是内部单元。对于纬向速度 $u$，带有光环的数组的索引范围为 $j \\in \\{0,\\dots,N_y+1\\}$ 和 $i \\in \\{0,\\dots,N_x+2\\}$，其中内部索引为 $j=1,\\dots,N_y$ 和 $i=1,\\dots,N_x+1$。对于经向速度 $v$，带有光环的数组的索引范围为 $j \\in \\{0,\\dots,N_y+2\\}$ 和 $i \\in \\{0,\\dots,N_x+1\\}$，其中内部索引为 $j=1,\\dots,N_y+1$ 和 $i=1,\\dots,N_x$。\n\n假设示踪物遵循保守的平流方程\n$$\n\\frac{\\partial T}{\\partial t} + \\nabla \\cdot (\\mathbf{U} T) = 0,\n$$\n其中 $\\mathbf{U} = (u, v)$ 是速度矢量。在 Arakawa C-grid 上，使用面向面的中心平均法，对于内部单元 $(j,i)$，大小为 $\\Delta t$ 的单个向前欧拉时间步长为\n$$\nT^{n+1}_{j,i} = T^{n}_{j,i} - \\Delta t \\left[ \\frac{F^{x}_{j,i+\\frac{1}{2}} - F^{x}_{j,i-\\frac{1}{2}}}{d_x} + \\frac{F^{y}_{j+\\frac{1}{2},i} - F^{y}_{j-\\frac{1}{2},i}}{d_y} \\right],\n$$\n面通量为\n$$\nF^{x}_{j,i+\\frac{1}{2}} = u_{j,i+\\frac{1}{2}} \\, \\widetilde{T}_{j,i+\\frac{1}{2}}, \\quad \\widetilde{T}_{j,i+\\frac{1}{2}} = \\frac{1}{2}\\left(T_{j,i} + T_{j,i+1}\\right),\n$$\n$$\nF^{y}_{j+\\frac{1}{2},i} = v_{j+\\frac{1}{2},i} \\, \\widetilde{T}_{j+\\frac{1}{2},i}, \\quad \\widetilde{T}_{j+\\frac{1}{2},i} = \\frac{1}{2}\\left(T_{j,i} + T_{j+1,i}\\right).\n$$\n\n您必须在这个交错网格上实现周期性边界条件的两种等效实现方式：\n\n- 基于光环的实现：将值从相对边界复制到光环中，以便离散场在 $x$ 和 $y$ 方向上一致地回绕。对于标量 $T$，这意味着\n$$\nT_{j,0} = T_{j,N_x}, \\quad T_{j,N_x+1} = T_{j,1}, \\quad T_{0,i} = T_{N_y,i}, \\quad T_{N_y+1,i} = T_{1,i},\n$$\n适用于所有有效的内部 $i$ 和 $j$，以及一致的角点填充，例如\n$$\nT_{0,0} = T_{N_y,N_x}, \\quad T_{0,N_x+1} = T_{N_y,1}, \\quad T_{N_y+1,0} = T_{1,N_x}, \\quad T_{N_y+1,N_x+1} = T_{1,1}.\n$$\n必须根据其交错结构，将类似的等式应用于带有光环的 $u$ 和 $v$ 数组，并使用正确的索引范围。\n\n- 基于模运算索引的实现：使用模运算处理内部索引来计算面通量，即，\n$$\ni_{-} = (i-1) \\bmod N_x, \\quad i_{+} = (i+1) \\bmod N_x, \\quad j_{-} = (j-1) \\bmod N_y, \\quad j_{+} = (j+1) \\bmod N_y,\n$$\n并且面速度索引 $i \\in \\{0,\\dots,N_x\\}$ 和 $j \\in \\{0,\\dots,N_y\\}$ 以显而易见的方式进行模运算回绕处理。此实现不使用光环。\n\n您的任务是编写一个完整的程序，该程序：\n- 为 $T$、$u$ 和 $v$ 及其带有光环的对应数组构建内部数组，并具有一致的 Arakawa C-grid 交错结构和一单元宽的光环。\n- 将单元中心的 $T$ 初始化为两个高斯异常值的和，一个靠近右上角，另一个靠近另一边界，以测试角点和边缘。将 $u$ 和 $v$ 初始化为恒定值（单位：米/秒）。\n- 在两个方向上为 $T$、$u$ 和 $v$ 实现周期性光环填充，包括正确的角点值。\n- 使用基于光环的通量散度计算 $T$ 的一次向前欧拉更新，并分别使用无光环的模运算索引实现计算相同的更新。\n- 计算由两种实现产生的两个更新后的示踪物场 $T^{n+1}$ 在所有内部单元上的最大绝对差。\n- 验证布尔等式，以确认 $T$、$u$ 和 $v$ 的光环填充（包括边光环和角光环）完全一致。\n\n科学基础和约束条件：\n- 使用上述守恒定律和离散的中心面平均法作为通量计算的基础。不要引入任何其他平流方案。\n- 必须在 $x$ 和 $y$ 方向上严格执行周期性，并且必须一致地设置光环角点。\n- 所有物理参数必须是现实且自洽的。\n\n单位和输出：\n- 速度 $u$ 和 $v$ 的单位必须解释为米/秒，间距 $d_x$ 和 $d_y$ 的单位为米，时间步长 $\\Delta t$ 的单位为秒。\n- 最终的数值误差度量是无量纲的（示踪物单位），计算为两次更新之间的最大绝对差。\n- 布尔值是无单位的。\n\n测试套件：\n为以下参数集运行您的程序，每个参数集表示为 $(N_x,N_y,d_x,d_y,u_0,v_0,\\Delta t)$：\n1. $(16,12,1000.0,1000.0,0.5,-0.3,300.0)$\n2. $(3,5,5000.0,7000.0,1.0,0.2,100.0)$\n3. $(1,1,10000.0,10000.0,0.0,0.0,50.0)$\n4. $(8,6,800.0,1200.0,-0.4,0.0,200.0)$\n5. $(7,7,1500.0,1500.0,0.0,0.6,100.0)$\n\n对于每个测试用例，计算并返回列表 $[\\varepsilon, b_T, b_u, b_v]$，其中 $\\varepsilon$ 是基于光环和基于模运算索引的 $T^{n+1}$ 更新在内部单元上的最大绝对差，$b_T$ 是一个布尔值，说明 $T$ 的光环等式测试（边和角）是否都满足，而 $b_u$ 和 $b_v$ 是 $u$ 和 $v$ 的类似布尔值。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是按上述顺序排列的列表。例如，输出应如下所示\n$[ [\\varepsilon_1,b_{T,1},b_{u,1},b_{v,1}], [\\varepsilon_2,b_{T,2},b_{u,2},b_{v,2}], \\dots ]$\n其中布尔值打印为 $True$ 或 $False$，浮点数采用标准十进制表示法。",
            "solution": "问题陈述已经过严格验证，并被确定为是合理的。它具有科学依据，问题定义明确，并为解决所述问题提供了一套完整且一致的定义和约束。任务是实现并比较在交错的 Arakawa C-grid 上处理周期性边界条件的两种常用数值技术：一种是基于光环的交换，另一种是模运算索引方法。这两种方法的等效性是计算科学中的一个基本概念，验证这种等效性是对正确实现的一个严格测试。\n\n我们首先将建立离散网格结构和索引约定。域包含 $N_x \\times N_y$ 个内部示踪物单元。我们将使用基于零的 Python/NumPy 数组索引。\n\n标量示踪物场 $T$ 定义在单元中心。$T$ 的内部数组维度为 $(N_y, N_x)$。一个带有光环的数组 `T_h` 的维度为 $(N_y+2, N_x+2)$。内部数据位于 `T_h[1:N_y+1, 1:N_x+1]`。\n\n纬向速度 $u$ 在 $x$ 方向上是交错的。$u$ 的内部数组维度为 $(N_y, N_x+1)$，表示示踪物单元垂直面上的速度。带有光环的数组 `u_h` 的维度为 $(N_y+2, N_x+3)$。内部数据位于 `u_h[1:N_y+1, 1:N_x+2]`。\n\n经向速度 $v$ 在 $y$ 方向上是交错的。$v$ 的内部数组维度为 $(N_y+1, N_x)$，表示水平面上的速度。带有光环的数组 `v_h` 的维度为 $(N_y+3, N_x+2)$。内部数据位于 `v_h[1:N_y+2, 1:N_x+1]`。\n\n初始示踪物场 $T$ 被指定为两个高斯异常值的和。对于中心坐标为 $(x_i, y_j)$ 的网格单元 $(j, i)$，其值由以下公式给出：\n$$\nT(x_i, y_j) = A_1 \\exp\\left(-\\frac{(x_i-x_{c1})^2}{2\\sigma_{x1}^2} - \\frac{(y_j-y_{c1})^2}{2\\sigma_{y1}^2}\\right) + A_2 \\exp\\left(-\\frac{(x_i-x_{c2})^2}{2\\sigma_{x2}^2} - \\frac{(y_j-y_{c2})^2}{2\\sigma_{y2}^2}\\right)\n$$\n我们选择参数将一个异常值放置在右上角附近，另一个放置在左边界附近，以测试周期性回绕的各个方面。具体来说，我们选择中心点 $(x_{c1}, y_{c1}) = ((N_x-0.5)d_x, (N_y-0.5)d_y)$ 和 $(x_{c2}, y_{c2}) = (0, 0.5 N_y d_y)$。宽度 $\\sigma$ 设置为域尺寸的一小部分，例如 $\\sigma_x = N_x d_x / 10$ 和 $\\sigma_y = N_y d_y / 10$。振幅 $A_1, A_2$ 设置为 $1.0$。速度 $u$ 和 $v$ 分别初始化为恒定值 $u_0$ 和 $v_0$。\n\n问题的核心是比较两种基于向前欧拉格式的等效时间步进算法：\n$$\nT^{n+1}_{j,i} = T^{n}_{j,i} - \\Delta t \\left( \\frac{F^x_{j, i+1/2} - F^x_{j, i-1/2}}{d_x} + \\frac{F^y_{j+1/2, i} - F^y_{j-1/2, i}}{d_y} \\right)\n$$\n其中通量使用中心平均法计算：\n$$\nF^{x}_{j,i+1/2} = u_{j,i+1/2} \\frac{T_{j,i} + T_{j,i+1}}{2}, \\quad F^{y}_{j+1/2,i} = v_{j+1/2,i} \\frac{T_{j,i} + T_{j+1,i}}{2}\n$$\n\n**1. 基于光环的实现**\n\n该方法使用在内部域周围带有一单元光环区域的数组。在计算通量之前，这些光环单元会用来自域另一侧的数据填充，以强制执行周期性。对于任何场 $\\phi$，光环填充执行如下：\n对于一个内部尺寸为 $(N_y, N_x)$、位于尺寸为 $(N_y+2, N_x+2)$ 的光环数组中的场（如 $T$）：\n- 西侧光环来自东侧边界：`T_h[1:N_y+1, 0] = T_h[1:N_y+1, N_x]`\n- 东侧光环来自西侧边界：`T_h[1:N_y+1, N_x+1] = T_h[1:N_y+1, 1]`\n- 南侧光环来自北侧边界：`T_h[0, 1:N_x+1] = T_h[N_y, 1:N_x+1]`\n- 北侧光环来自南侧边界：`T_h[N_y+1, 1:N_x+1] = T_h[1, 1:N_x+1]`\n\n角点被一致地填充。例如，`T_h[0, 0] = T_h[N_y, N_x]`。一种包括角点在内的稳健的光环填充方法是顺序执行填充，例如，先填充整个宽度的北/南光环，然后填充整个高度的东/西光环。类似的规则，根据不同的数组维度和交错结构进行调整后，也适用于 `u_h` 和 `v_h`。\n\n布尔验证检查 `b_T, b_u, b_v` 是通过在光环填充操作后直接比较数组切片来执行的，以确认这些等式成立。\n\n填充光环后，内部单元 `T_h[j, i]`（其中 `j` 在 $1..N_y$ 范围内，`i` 在 $1..N_x$ 范围内）的通量散度是使用其直接邻居计算的。例如，西面通量所需的示踪物值 $T_{j,i-1}$ 就是 `T_h[j, i-1]`。如果 $i=1$，这个索引指向西侧光环 `T_h[j, 0]`，其中现在包含了正确的周期性值。\n\n**2. 基于模运算索引的实现**\n\n此方法仅对表示内部域的数组进行操作。周期性是通过在计算点对数组索引使用模运算来处理的。\n对于索引为 `(j, i)` 的示踪物单元（其中 `j` 在 $0..N_y-1$ 范围内，`i` 在 $0..N_x-1$ 范围内），其邻居的索引计算如下：\n- 西侧邻居：$i_W = (i - 1 + N_x) \\pmod{N_x}$\n- 东侧邻居：$i_E = (i + 1) \\pmod{N_x}$\n- 南侧邻居：$j_S = (j - 1 + N_y) \\pmod{N_y}$\n- 北侧邻居：$j_N = (j + 1) \\pmod{N_y}$\n\n然后使用这些回绕的索引来计算示踪物场的通量。对于单元 `(j, i)`，向右的通量取决于 `(j, i)` 和 `(j, i_E)` 处的 $T$ 值。相关联的速度 `u_int[j, i+1]` 取自内部速度数组。请注意，由于交错结构，速度数组在交错方向上大一个元素（`u` 在 $x$ 方向上有 $N_x+1$ 个点，`v` 在 $y$ 方向上有 $N_y+1$ 个点），因此在计算示踪物平流时，速度索引不需要进行模运算。\n\n**等效性与验证**\n\n两种方法都是具有相同边界条件的同一物理问题的离散实现。因此，它们必须为更新后的示踪物场 $T^{n+1}$ 产生相同的数值结果。两种方法结果在内部域上的最大绝对差 $\\varepsilon$ 应在机器浮点精度数量级上（即，实际上为零）。布尔检查 $b_T, b_u, b_v$ 必须评估为真，以确认光环填充逻辑的正确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases.\n    \"\"\"\n    test_cases = [\n        # (Nx, Ny, dx, dy, u0, v0, dt)\n        (16, 12, 1000.0, 1000.0, 0.5, -0.3, 300.0),\n        (3, 5, 5000.0, 7000.0, 1.0, 0.2, 100.0),\n        (1, 1, 10000.0, 10000.0, 0.0, 0.0, 50.0),\n        (8, 6, 800.0, 1200.0, -0.4, 0.0, 200.0),\n        (7, 7, 1500.0, 1500.0, 0.0, 0.6, 100.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_one_case(*params)\n        results.append(result)\n    \n    # Format the final output string\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        eps, bt, bu, bv = res\n        output_str += f\"[{eps},{bt},{bu},{bv}]\"\n        if i  len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    print(output_str)\n\ndef run_one_case(Nx, Ny, dx, dy, u0, v0, dt):\n    \"\"\"\n    Executes the simulation and comparison for a single parameter set.\n    \"\"\"\n    # 1. Initialize interior fields\n    T_int, u_int, v_int = initialize_fields(Nx, Ny, dx, dy, u0, v0)\n\n    # 2. Halo-based realization\n    T_result_halo, b_T, b_u, b_v = halo_based_update(\n        T_int.copy(), u_int.copy(), v_int.copy(), Nx, Ny, dx, dy, dt\n    )\n\n    # 3. Modular-index realization\n    T_result_mod = modular_index_update(\n        T_int.copy(), u_int.copy(), v_int.copy(), Nx, Ny, dx, dy, dt\n    )\n\n    # 4. Compare results\n    epsilon = np.max(np.abs(T_result_halo - T_result_mod))\n\n    return [epsilon, b_T, b_u, b_v]\n\ndef initialize_fields(Nx, Ny, dx, dy, u0, v0):\n    \"\"\"\n    Initializes T, u, and v fields.\n    \"\"\"\n    # T field at cell centers\n    T_int = np.zeros((Ny, Nx))\n    x_T = (np.arange(Nx) + 0.5) * dx\n    y_T = (np.arange(Ny) + 0.5) * dy\n    \n    Lx, Ly = Nx * dx, Ny * dy\n    sigma_x, sigma_y = Lx / 10.0, Ly / 10.0\n    if sigma_x == 0: sigma_x = dx\n    if sigma_y == 0: sigma_y = dy\n\n\n    # Gaussian 1: near top-right corner\n    xc1, yc1 = (Nx - 0.5) * dx, (Ny - 0.5) * dy\n    # Gaussian 2: near left-center boundary\n    xc2, yc2 = 0.0, 0.5 * Ly\n    \n    for j in range(Ny):\n        for i in range(Nx):\n            # First Gaussian\n            dist_sq1 = ((x_T[i] - xc1)**2 / (2 * sigma_x**2)) + \\\n                       ((y_T[j] - yc1)**2 / (2 * sigma_y**2))\n            \n            # Second Gaussian: handle periodic distance in x\n            dx_p = min(abs(x_T[i] - xc2), Lx - abs(x_T[i] - xc2))\n            dist_sq2 = (dx_p**2 / (2 * sigma_x**2)) + \\\n                       ((y_T[j] - yc2)**2 / (2 * sigma_y**2))\n\n            T_int[j, i] = np.exp(-dist_sq1) + np.exp(-dist_sq2)\n\n    # u field at vertical faces\n    u_int = np.full((Ny, Nx + 1), u0)\n    \n    # v field at horizontal faces\n    v_int = np.full((Ny + 1, Nx), v0)\n    \n    return T_int, u_int, v_int\n\ndef fill_and_verify_halos(T_h, u_h, v_h, Nx, Ny):\n    \"\"\"\n    Fills halo regions for T, u, v and verifies the fills.\n    \"\"\"\n    # --- Fill Halos for T (Ny+2, Nx+2) ---\n    T_h[0, :] = T_h[Ny, :]       # South from North\n    T_h[Ny+1, :] = T_h[1, :]     # North from South\n    T_h[:, 0] = T_h[:, Nx]       # West from East\n    T_h[:, Nx+1] = T_h[:, 1]     # East from West\n\n    # --- Verify Halos for T ---\n    b_T = all([\n        np.all(T_h[1:Ny+1, 0] == T_h[1:Ny+1, Nx]),     # West\n        np.all(T_h[1:Ny+1, Nx+1] == T_h[1:Ny+1, 1]),   # East\n        np.all(T_h[0, 1:Nx+1] == T_h[Ny, 1:Nx+1]),     # South\n        np.all(T_h[Ny+1, 1:Nx+1] == T_h[1, 1:Nx+1]),   # North\n        T_h[0, 0] == T_h[Ny, Nx],                     # SW corner\n        T_h[0, Nx+1] == T_h[Ny, 1],                   # SE corner\n        T_h[Ny+1, 0] == T_h[1, Nx],                   # NW corner\n        T_h[Ny+1, Nx+1] == T_h[1, 1],                 # NE corner\n    ])\n\n    # --- Fill halos for u (Ny+2, Nx+3) ---\n    u_h[0, :] = u_h[Ny, :]         # South from North\n    u_h[Ny+1, :] = u_h[1, :]       # North from South\n    u_h[:, 0] = u_h[:, Nx+1]       # West from East (u is Nx+1 wide internally)\n    u_h[:, Nx+2] = u_h[:, 1]       # East from West\n\n    # --- Verify halos for u ---\n    b_u = all([\n        np.all(u_h[1:Ny+1, 0] == u_h[1:Ny+1, Nx+1]),\n        np.all(u_h[1:Ny+1, Nx+2] == u_h[1:Ny+1, 1]),\n        np.all(u_h[0, :] == u_h[Ny, :]),\n        np.all(u_h[Ny+1, :] == u_h[1, :]),\n    ])\n\n    # --- Fill halos for v (Ny+3, Nx+2) ---\n    v_h[0, :] = v_h[Ny+1, :]       # South from North\n    v_h[Ny+2, :] = v_h[1, :]       # North from South\n    v_h[:, 0] = v_h[:, Nx]         # West from East\n    v_h[:, Nx+1] = v_h[:, 1]       # East from West\n    \n    # --- Verify halos for v ---\n    b_v = all([\n        np.all(v_h[:, 0] == v_h[:, Nx]),\n        np.all(v_h[:, Nx+1] == v_h[:, 1]),\n        np.all(v_h[0, 1:Nx+1] == v_h[Ny+1, 1:Nx+1]),\n        np.all(v_h[Ny+2, 1:Nx+1] == v_h[1, 1:Nx+1]),\n    ])\n\n    return b_T, b_u, b_v\n\n\ndef halo_based_update(T_int, u_int, v_int, Nx, Ny, dx, dy, dt):\n    \"\"\"\n    Computes one time step using halo-based boundary conditions.\n    \"\"\"\n    # Create halo-augmented arrays\n    T_h = np.zeros((Ny + 2, Nx + 2))\n    # u is (Ny, Nx+1) int -> (Ny+2, Nx+3) halo\n    u_h = np.zeros((Ny + 2, Nx + 3))\n    # v is (Ny+1, Nx) int -> (Ny+3, Nx+2) halo\n    v_h = np.zeros((Ny + 3, Nx + 2))\n\n    # Copy interior data\n    T_h[1:Ny+1, 1:Nx+1] = T_int\n    u_h[1:Ny+1, 1:Nx+2] = u_int\n    v_h[1:Ny+2, 1:Nx+1] = v_int\n    \n    b_T, b_u, b_v = fill_and_verify_halos(T_h, u_h, v_h, Nx, Ny)\n\n    T_new_h = T_h.copy()\n    for j in range(1, Ny + 1):\n        for i in range(1, Nx + 1):\n            Fx_east = u_h[j, i+1] * 0.5 * (T_h[j, i] + T_h[j, i+1])\n            Fx_west = u_h[j, i]   * 0.5 * (T_h[j, i] + T_h[j, i-1])\n            \n            Fy_north = v_h[j+1, i] * 0.5 * (T_h[j, i] + T_h[j+1, i])\n            Fy_south = v_h[j, i]   * 0.5 * (T_h[j, i] + T_h[j-1, i])\n            \n            div_Fx = (Fx_east - Fx_west) / dx\n            div_Fy = (Fy_north - Fy_south) / dy\n            \n            T_new_h[j, i] = T_h[j, i] - dt * (div_Fx + div_Fy)\n\n    return T_new_h[1:Ny+1, 1:Nx+1], b_T, b_u, b_v\n\ndef modular_index_update(T_int, u_int, v_int, Nx, Ny, dx, dy, dt):\n    \"\"\"\n    Computes one time step using modular indexing for boundary conditions.\n    \"\"\"\n    T_new = T_int.copy()\n    for j in range(Ny):\n        for i in range(Nx):\n            ip1 = (i + 1) % Nx\n            im1 = (i - 1 + Nx) % Nx\n            jp1 = (j + 1) % Ny\n            jm1 = (j - 1 + Ny) % Ny\n            \n            Fx_east = u_int[j, i+1] * 0.5 * (T_int[j, i] + T_int[j, ip1])\n            Fx_west = u_int[j, i]   * 0.5 * (T_int[j, i] + T_int[j, im1])\n\n            Fy_north = v_int[j+1, i] * 0.5 * (T_int[j, i] + T_int[jp1, i])\n            Fy_south = v_int[j, i]   * 0.5 * (T_int[j, i] + T_int[jm1, i])\n            \n            div_Fx = (Fx_east - Fx_west) / dx\n            div_Fy = (Fy_north - Fy_south) / dy\n            \n            T_new[j, i] = T_int[j, i] - dt * (div_Fx + div_Fy)\n            \n    return T_new\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}