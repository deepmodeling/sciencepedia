{
    "hands_on_practices": [
        {
            "introduction": "稳定性是模拟波传播时的首要考量。本练习将引导您解决一个经典问题：确定一个特定数值方案的最大允许时间步长。通过傅里叶（冯·诺依曼）稳定性分析，您将把物理学（波速 $c=\\sqrt{gH}$）、空间离散化（中心差分）与时间积分器（RK4）联系起来。掌握这一推导过程，是理解 Courant-Friedrichs-Lewy (CFL) 条件的基石，而 CFL 条件是几乎所有显式流体动力学模型中的一个关键限制 。",
            "id": "3798698",
            "problem": "考虑 $f$ 平面上深度平均流的一维线性化浅水方程，其中平均深度为常数 $H$，重力加速度为 $g$，并忽略旋转以分离出自由表面重力波：\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0, \\qquad \\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0,\n$$\n其中 $\\eta(x,t)$ 是自由表面位移，$u(x,t)$ 是垂向平均速度。这些方程意味着重力波相速度为 $c=\\sqrt{gH}$。使用标准二阶中心有限差分法对 $\\partial/\\partial x$ 进行离散，在间距为 $\\Delta x$ 的均匀周期性网格上对空间进行离散化，并保持时间连续（一种线方法半离散化）。然后使用时间步长为 $\\Delta t$ 的经典显式四阶龙格-库塔方法（四阶龙格-库塔法，RK4）进行时间积分。\n\n将傅里叶（冯·诺依曼）稳定性分析应用于该半离散系统，并对所有可分辨的离散波数施加 RK4 的绝对稳定性要求，推导出最大允许时间步长 $\\Delta t_{\\max}$ 的闭式解析表达式，该表达式用 $g$、$H$ 和 $\\Delta x$ 表示。你的推导必须从上述守恒律、一阶导数的中心差分表达式以及 RK4 标量稳定性函数开始，并且必须确保对网格上支持的所有离散傅里叶模式都稳定。\n\n将 $\\Delta t_{\\max}$ 的最终结果表示为单一的简化解析表达式。不需要进行数值计算。其物理单位是秒。",
            "solution": "该问题是有效的，因为它具有科学依据、是适定的且客观的。它提出了一个偏微分方程数值分析中的标准问题，这是计算科学的一个核心课题。所有必要的信息都已提供。\n\n解决方案分以下几个步骤进行：\n1.  控制方程的空间半离散化。\n2.  对半离散系统应用傅里叶分析以求其特征值。\n3.  确定 RK4 方法在虚轴上的稳定性边界。\n4.  结合这些结果以推导时间步长 $\\Delta t$ 的稳定性约束。\n\n**步骤 1：半离散化**\n给定的一维线性化浅水方程为：\n$$\n\\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0\n$$\n$$\n\\frac{\\partial u}{\\partial t} + g \\frac{\\partial \\eta}{\\partial x} = 0\n$$\n我们将空间域离散化为点 $x_j = j \\Delta x$，其中 $j$ 为整数。连续变量 $\\eta(x,t)$ 和 $u(x,t)$ 由网格点上的值 $\\eta_j(t) = \\eta(x_j, t)$ 和 $u_j(t) = u(x_j, t)$ 近似。空间导数 $\\partial/\\partial x$ 使用二阶中心有限差分算子来近似：\n$$\n\\left. \\frac{\\partial f}{\\partial x} \\right|_{x=x_j} \\approx \\frac{f_{j+1} - f_{j-1}}{2 \\Delta x}\n$$\n将此应用于方程组，得到一组关于时间的常微分方程 (ODE)，这是一种称为线方法的技术：\n$$\n\\frac{d \\eta_j}{dt} = -H \\left( \\frac{u_{j+1} - u_{j-1}}{2 \\Delta x} \\right)\n$$\n$$\n\\frac{d u_j}{dt} = -g \\left( \\frac{\\eta_{j+1} - \\eta_{j-1}}{2 \\Delta x} \\right)\n$$\n\n**步骤 2：傅里叶（冯·诺依曼）分析**\n为了分析稳定性，我们考虑在周期性网格上的单个傅里叶模式解：\n$$\n\\eta_j(t) = \\hat{\\eta}(k, t) e^{i k x_j} = \\hat{\\eta}(k, t) e^{i k j \\Delta x}\n$$\n$$\nu_j(t) = \\hat{u}(k, t) e^{i k x_j} = \\hat{u}(k, t) e^{i k j \\Delta x}\n$$\n其中 $k$ 是波数，$\\hat{\\eta}$ 和 $\\hat{u}$ 是依赖于时间的复傅里叶振幅。将这些形式代入半离散方程：\n对于第一个方程：\n$$\n\\frac{d}{dt} \\left(\\hat{\\eta} e^{i k j \\Delta x}\\right) = -H \\left( \\frac{\\hat{u} e^{i k (j+1) \\Delta x} - \\hat{u} e^{i k (j-1) \\Delta x}}{2 \\Delta x} \\right)\n$$\n两边同除以 $e^{i k j \\Delta x}$：\n$$\n\\frac{d \\hat{\\eta}}{dt} = -\\frac{H \\hat{u}}{2 \\Delta x} \\left( e^{i k \\Delta x} - e^{-i k \\Delta x} \\right) = -\\frac{H \\hat{u}}{2 \\Delta x} (2i \\sin(k \\Delta x)) = -i \\frac{H \\sin(k \\Delta x)}{\\Delta x} \\hat{u}\n$$\n类似地，对于第二个方程：\n$$\n\\frac{d \\hat{u}}{dt} = -g \\left( \\frac{\\hat{\\eta}_{j+1} - \\hat{\\eta}_{j-1}}{2 \\Delta x} \\right) \\implies \\frac{d \\hat{u}}{dt} = -i \\frac{g \\sin(k \\Delta x)}{\\Delta x} \\hat{\\eta}\n$$\n这就构成了一个关于傅里叶振幅的线性常微分方程组：\n$$\n\\frac{d}{dt} \\begin{pmatrix} \\hat{\\eta} \\\\ \\hat{u} \\end{pmatrix} = \\begin{pmatrix} 0 & -i \\frac{H \\sin(k \\Delta x)}{\\Delta x} \\\\ -i \\frac{g \\sin(k \\Delta x)}{\\Delta x} & 0 \\end{pmatrix} \\begin{pmatrix} \\hat{\\eta} \\\\ \\hat{u} \\end{pmatrix}\n$$\n其形式为 $\\frac{d\\mathbf{v}}{dt} = \\mathbf{A} \\mathbf{v}$。时间积分格式的稳定性将取决于矩阵 $\\mathbf{A}$ 的特征值 $\\lambda$。通过求解特征方程 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$ 可以找到特征值：\n$$\n\\det \\begin{pmatrix} -\\lambda & -i \\frac{H \\sin(k \\Delta x)}{\\Delta x} \\\\ -i \\frac{g \\sin(k \\Delta x)}{\\Delta x} & -\\lambda \\end{pmatrix} = (-\\lambda)^2 - \\left(-i \\frac{H \\sin(k \\Delta x)}{\\Delta x}\\right)\\left(-i \\frac{g \\sin(k \\Delta x)}{\\Delta x}\\right) = 0\n$$\n$$\n\\lambda^2 - i^2 \\frac{gH \\sin^2(k \\Delta x)}{(\\Delta x)^2} = 0\n$$\n$$\n\\lambda^2 + \\frac{gH \\sin^2(k \\Delta x)}{(\\Delta x)^2} = 0\n$$\n令 $c = \\sqrt{gH}$ 为重力波相速度。\n$$\n\\lambda^2 = - \\frac{c^2 \\sin^2(k \\Delta x)}{(\\Delta x)^2}\n$$\n特征值是纯虚数：\n$$\n\\lambda(k) = \\pm i \\frac{c |\\sin(k \\Delta x)|}{\\Delta x}\n$$\n这些特征值代表了离散波模式的频率。\n\n**步骤 3：RK4 稳定性**\n将经典的四阶龙格-库塔 (RK4) 方法应用于标量测试方程 $y' = \\lambda y$ 时，得到更新规则 $y_{n+1} = R(\\lambda \\Delta t) y_n$，其中 $R(z)$ 是稳定性多项式：\n$$\nR(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}\n$$\n当 $z = \\lambda \\Delta t$ 且 $|R(z)| \\le 1$ 时，该格式是稳定的。由于我们的特征值 $\\lambda$ 是纯虚数，我们必须确定 RK4 在虚轴上的稳定区间。令 $z = i\\beta$，其中 $\\beta$ 为实数。\n$$\nR(i\\beta) = 1 + i\\beta + \\frac{(i\\beta)^2}{2} + \\frac{(i\\beta)^3}{6} + \\frac{(i\\beta)^4}{24} = \\left(1 - \\frac{\\beta^2}{2} + \\frac{\\beta^4}{24}\\right) + i\\left(\\beta - \\frac{\\beta^3}{6}\\right)\n$$\n稳定性条件为 $|R(i\\beta)|^2 \\le 1$：\n$$\n|R(i\\beta)|^2 = \\left(1 - \\frac{\\beta^2}{2} + \\frac{\\beta^4}{24}\\right)^2 + \\left(\\beta - \\frac{\\beta^3}{6}\\right)^2 \\le 1\n$$\n展开各项：\n$$\n\\left(1 - \\frac{\\beta^2}{2} + \\frac{\\beta^4}{24}\\right)^2 = 1 - \\beta^2 + \\frac{\\beta^4}{3} - \\frac{\\beta^6}{24} + \\frac{\\beta^8}{576}\n$$\n$$\n\\left(\\beta - \\frac{\\beta^3}{6}\\right)^2 = \\beta^2 - \\frac{\\beta^4}{3} + \\frac{\\beta^6}{36}\n$$\n将它们相加得到：\n$$\n|R(i\\beta)|^2 = 1 - \\frac{\\beta^6}{24} + \\frac{\\beta^6}{36} + \\frac{\\beta^8}{576} = 1 - \\beta^6 \\left(\\frac{1}{24} - \\frac{1}{36}\\right) + \\frac{\\beta^8}{576} = 1 - \\frac{\\beta^6}{72} + \\frac{\\beta^8}{576}\n$$\n稳定性条件变为：\n$$\n1 - \\frac{\\beta^6}{72} + \\frac{\\beta^8}{576} \\le 1 \\implies \\frac{\\beta^8}{576} - \\frac{\\beta^6}{72} \\le 0\n$$\n$$\n\\beta^6 \\left( \\frac{\\beta^2}{576} - \\frac{1}{72} \\right) \\le 0\n$$\n由于对于实数 $\\beta$，$\\beta^6 \\ge 0$，我们需要括号中的项为非正数：\n$$\n\\frac{\\beta^2}{576} \\le \\frac{1}{72} \\implies \\beta^2 \\le \\frac{576}{72} = 8\n$$\n这给出了 $\\beta$ 的稳定性极限：\n$$\n|\\beta| \\le \\sqrt{8} = 2\\sqrt{2}\n$$\n因此，对于纯虚数 $z = i\\beta$，RK4 方法是稳定的，当且仅当 $z$ 位于虚轴上的区间 $[-2i\\sqrt{2}, 2i\\sqrt{2}]$ 内。\n\n**步骤 4：最大时间步长的推导**\n稳定性条件必须对半离散系统的所有特征值 $\\lambda(k)$ 都成立。这意味着对于所有的 $k$，我们必须满足：\n$$\n|\\lambda(k) \\Delta t| \\le 2\\sqrt{2}\n$$\n这个条件必须对模最大的特征值成立。我们来求 $\\max_k |\\lambda(k)|$：\n$$\n\\max_k |\\lambda(k)| = \\max_k \\left| \\pm i \\frac{c |\\sin(k \\Delta x)|}{\\Delta x} \\right| = \\frac{c}{\\Delta x} \\max_k |\\sin(k \\Delta x)|\n$$\n由间距为 $\\Delta x$ 的网格所能解析的波数 $k$ 的范围，最高可达奈奎斯特波数 $k_{Ny} = \\pi/\\Delta x$。因此，乘积 $k \\Delta x$ 的范围是从 $-\\pi$ 到 $\\pi$。在此区间上，$|\\sin(k \\Delta x)|$ 的最大值为 $1$，这在 $k \\Delta x = \\pm \\pi/2$ 时取得。\n因此，特征值的最大模为：\n$$\n\\max_k |\\lambda(k)| = \\frac{c}{\\Delta x} \\cdot 1 = \\frac{c}{\\Delta x}\n$$\n那么时间步长 $\\Delta t$ 的稳定性约束为：\n$$\n\\left(\\frac{c}{\\Delta x}\\right) \\Delta t \\le 2\\sqrt{2}\n$$\n这给出了最大允许时间步长 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = \\frac{2\\sqrt{2} \\Delta x}{c}\n$$\n将相速度的表达式 $c=\\sqrt{gH}$ 代回：\n$$\n\\Delta t_{\\max} = \\frac{2\\sqrt{2} \\Delta x}{\\sqrt{gH}}\n$$\n这就是当空间上使用中心差分、时间上使用 RK4 时，确保对网格上支持的所有傅里叶模式都稳定的最大时间步长的最终解析表达式。该表达式代表了一个库朗-弗里德里希-列维 (CFL) 条件，其中 CFL 数为 $\\frac{c \\Delta t}{\\Delta x} \\le 2\\sqrt{2}$。",
            "answer": "$$\\boxed{\\frac{2\\sqrt{2} \\Delta x}{\\sqrt{gH}}}$$"
        },
        {
            "introduction": "单步法固然强大，但预报-校正格式在精度、稳定性和计算成本之间提供了另一种高效的平衡。本练习将深入探讨一种常用组合：二阶 Adams-Bashforth (AB2) 预报子和二阶 Adams-Moulton (AM2) 校正子。您将从多项式插值这一基本原理出发，构建一个完整的 PECE (预报-求值-校正-求值) 格式，并分析其精度阶数与稳定性，从而深入理解多步法的内在机制 。",
            "id": "3798652",
            "problem": "考虑一个半离散海洋模型的时间趋势，写成常微分方程初值问题 $y^{\\prime}(t)=f(t,y(t))$，其中右端项 $f$ 是光滑的。从积分形式 $y(t_{n+1})=y(t_{n})+\\int_{t_{n}}^{t_{n+1}} f(s,y(s))\\,\\mathrm{d}s$ 出发，并仅使用数值求积和在过去时间层上对 $f$ 进行多项式插值的原理，完成以下任务：\n\n1) 推导二阶两步 Adams–Moulton 校正子（梯形法则），以单步形式表示为关于 $f_{n+1}$ 和 $f_{n}$ 的 $y_{n+1}$ 的隐式更新，其中 $f_{k}=f(t_{k},y_{k})$ 且 $t_{k}=t_{0}+k h$，步长 $h>0$ 为定值。\n\n2) 通过用经过 $\\{(t_{n-1},f_{n-1}),(t_{n},f_{n})\\}$ 的一次插值多项式来逼近在 $[t_{n-1},t_{n}]$ 上的 $f$，推导二阶两步 Adams–Bashforth 预报子，并用它来构建在 $t_{n+1}$ 处的预报值 $y_{n+1}^{p}$。\n\n3) 将您的结果组合成一个单一的预报-求值-校正-求值（PECE）格式，其中第一次求值计算 $f_{n+1}^{p}=f(t_{n+1},y_{n+1}^{p})$，第二次求值计算 $f_{n+1}=f(t_{n+1},y_{n+1})$。基于关于 $t_{n}$ 的泰勒展开，说明并论证该 PECE 方法的全局精度阶 $p$。\n\n4) 通过将 PECE 方法应用于 Dahlquist 测试方程 $y^{\\prime}=\\lambda y$（其中 $\\lambda\\in\\mathbb{C}$）并定义 $z=h\\lambda$，来分析该方法的线性稳定性。推导 $y_{n}$ 作为 $z$ 的函数所满足的两步标量递推关系，然后确定最大的负实数 $z^{\\star}  0$，使得对于所有满足 $z\\in[z^{\\star},0]$ 的实数 $z$，该方法的特征多项式的每个根的模都小于或等于 $1$。您最终报告的答案应该是 $z^{\\star}$ 的精确值，无需四舍五入，也无单位。\n\n最终答案必须是单个实数。",
            "solution": "该问题要求推导和分析一个用于形如 $y^{\\prime}(t) = f(t, y(t))$ 的常微分方程的预报-校正数值格式。我们将按顺序解决问题的四个部分。\n\n1) 两步Adams-Moulton校正子（梯形法则）的推导\n我们从微分方程在区间 $[t_n, t_{n+1}]$ 上的积分形式开始：\n$$y(t_{n+1}) = y(t_n) + \\int_{t_n}^{t_{n+1}} f(s, y(s)) \\, \\mathrm{d}s$$\n数值积分的梯形法则将函数 $g(s)$ 在 $[a, b]$ 上的积分近似为 $\\frac{b-a}{2}(g(a)+g(b))$。将此法则应用于我们的积分，步长为 $h = t_{n+1} - t_n$，我们使用被积函数 $f(s, y(s))$ 在端点 $s=t_n$ 和 $s=t_{n+1}$ 处的值来近似它。这得到：\n$$\\int_{t_n}^{t_{n+1}} f(s, y(s)) \\, \\mathrm{d}s \\approx \\frac{h}{2} \\left[ f(t_n, y(t_n)) + f(t_{n+1}, y(t_{n+1})) \\right]$$\n用数值近似解 $y_k$ 替换精确解 $y(t_k)$，并定义 $f_k = f(t_k, y_k)$，我们得到数值格式：\n$$y_{n+1} = y_n + \\frac{h}{2} (f_n + f_{n+1})$$\n这是梯形法则的单步隐式公式，也称为二阶两步Adams-Moulton方法。术语“两步”指的是用于构造对应的 $f$ 的一次插值多项式的两个点 $(t_n, f_n)$ 和 $(t_{n+1}, f_{n+1})$。\n\n2) 两步Adams-Bashforth预报子的推导\n为了推导预报子，我们再次从积分形式出发。对于一个显式预报子，我们必须仅使用来自时间 $t_n$ 及更早时间的信息来近似积分。问题指定使用一个一次多项式 $P(s)$，它在点 $(t_{n-1}, f_{n-1})$ 和 $(t_n, f_n)$ 处对 $f$ 进行插值。使用该多项式的拉格朗日形式：\n$$P(s) = f_{n-1} \\frac{s - t_n}{t_{n-1} - t_n} + f_n \\frac{s - t_{n-1}}{t_n - t_{n-1}}$$\n由于 $t_k = t_0 + kh$，我们有 $t_n - t_{n-1} = h$。该多项式变为：\n$$P(s) = f_{n-1} \\frac{s - t_n}{-h} + f_n \\frac{s - t_{n-1}}{h} = \\frac{1}{h} \\left[ f_n(s - t_{n-1}) - f_{n-1}(s - t_n) \\right]$$\n我们现在通过对这个多项式从 $s=t_n$ 到 $s=t_{n+1}$ 进行积分来近似原积分：\n$$\\int_{t_n}^{t_{n+1}} f(s, y(s)) \\, \\mathrm{d}s \\approx \\int_{t_n}^{t_{n+1}} P(s) \\, \\mathrm{d}s$$\n为了简化积分，我们使用换元法，令 $u = s - t_n$，则 $\\mathrm{d}u = \\mathrm{d}s$。积分上下限变为 $u=0$ 到 $u=h$。此外，$s - t_{n-1} = (s - t_n) + (t_n - t_{n-1}) = u + h$。\n\\begin{align*} \\int_0^h \\frac{1}{h} \\left[ f_n(u+h) - f_{n-1}(u) \\right] \\, \\mathrm{d}u = \\frac{1}{h} \\left[ f_n\\left(\\frac{u^2}{2} + hu\\right) - f_{n-1}\\left(\\frac{u^2}{2}\\right) \\right]_0^h \\\\ = \\frac{1}{h} \\left[ f_n\\left(\\frac{h^2}{2} + h^2\\right) - f_{n-1}\\left(\\frac{h^2}{2}\\right) \\right] \\\\ = \\frac{1}{h} \\left[ \\frac{3}{2}h^2 f_n - \\frac{1}{2}h^2 f_{n-1} \\right] \\\\ = h \\left( \\frac{3}{2} f_n - \\frac{1}{2} f_{n-1} \\right)\\end{align*}\n$y_{n+1}$ 的预报值，记作 $y_{n+1}^p$，因此是：\n$$y_{n+1}^p = y_n + \\frac{h}{2} (3 f_n - f_{n-1})$$\n这是二阶两步Adams-Bashforth方法的公式。\n\n3) PECE格式和精度阶\n预报-求值-校正-求值（PECE）格式在每个时间步中按如下方式组合了前面的结果：\n(P) 预报：使用Adams-Bashforth预报子计算初步估计值 $y_{n+1}^p$。\n$$y_{n+1}^p = y_n + \\frac{h}{2} (3 f_n - f_{n-1})$$\n(E) 求值：计算在预报解处的导数。\n$$f_{n+1}^p = f(t_{n+1}, y_{n+1}^p)$$\n(C) 校正：在Adams-Moulton校正子中使用该导数估计值，以获得该步的最终值 $y_{n+1}$。\n$$y_{n+1} = y_n + \\frac{h}{2} (f_n + f_{n+1}^p)$$\n(E) 求值：计算在校正解处的导数，用于下一个时间步。\n$$f_{n+1} = f(t_{n+1}, y_{n+1})$$\n\n为了确定精度阶，我们分析局部截断误差（LTE），它是在假设步开始时解是精确的情况下，单步所产生的误差。AB2预报子的LTE为 $\\tau_p = y(t_{n+1}) - y_{n+1}^p = \\frac{5}{12}h^3 y'''(t_n) + O(h^4)$。AM2校正子的LTE为 $\\tau_c = y(t_{n+1}) - (y_n + \\frac{h}{2}(f_n + f(t_{n+1}, y(t_{n+1})))) = -\\frac{1}{12}h^3 y'''(t_n) + O(h^4)$。两个基础方法都是2阶的。\n对于PECE格式，从精确值 $y_n = y(t_n)$ 和 $f_{n-1} = f(t_{n-1}, y(t_{n-1}))$ 开始，预报值有误差：\n$$y_{n+1}^p = y(t_{n+1}) - \\frac{5}{12}h^3 y'''(t_n) + O(h^4)$$\n校正步中 $f$ 的自变量是 $f(t_{n+1}, y_{n+1}^p)$。根据泰勒定理：\n$$f_{n+1}^p = f(t_{n+1}, y(t_{n+1}) - \\frac{5}{12}h^3 y'''(t_n) + O(h^4)) = f(t_{n+1}, y(t_{n+1})) - \\frac{\\partial f}{\\partial y} \\frac{5}{12}h^3 y'''(t_n) + O(h^4)$$\n校正后的值为 $y_{n+1} = y_n + \\frac{h}{2}(f_n + f_{n+1}^p)$。代入 $f_{n+1}^p$ 的展开式：\n$$y_{n+1} = \\left(y_n + \\frac{h}{2}(f_n + f(t_{n+1}, y(t_{n+1})))\\right) - \\frac{h}{2}\\left(\\frac{5}{12}h^3 \\frac{\\partial f}{\\partial y} y'''(t_n)\\right) + O(h^5)$$\n括号中的项是隐式AM2方法应用于精确数据的结果。其值为 $y(t_{n+1}) - \\tau_c = y(t_{n+1}) + \\frac{1}{12}h^3 y'''(t_n) + O(h^4)$。\n因此，\n$$y_{n+1} = y(t_{n+1}) + \\frac{1}{12}h^3 y'''(t_n) + O(h^4)$$\n包含 $\\frac{\\partial f}{\\partial y}$ 的项被吸收到 $O(h^4)$ 项中。整个PECE步的LTE是：\n$$\\tau_{\\text{PECE}} = y(t_{n+1}) - y_{n+1} = -\\frac{1}{12}h^3 y'''(t_n) + O(h^4)$$\n由于LTE是 $O(h^3)$ 阶的，全局误差（在大约 $T/h$ 步上累积）是 $O(h^2)$ 阶的。因此，全局精度阶为 $p=2$。\n\n4) 线性稳定性分析\n我们将PECE格式应用于Dahlquist测试方程 $y' = \\lambda y$，其中 $\\lambda \\in \\mathbb{C}$。对于此方程，$f_k = f(t_k, y_k) = \\lambda y_k$。令 $z = h\\lambda$。\nPECE步骤变为：\n(P) $y_{n+1}^p = y_n + \\frac{h}{2}(3\\lambda y_n - \\lambda y_{n-1}) = y_n + \\frac{z}{2}(3y_n - y_{n-1}) = (1+\\frac{3z}{2})y_n - \\frac{z}{2}y_{n-1}$。\n(E) $f_{n+1}^p = \\lambda y_{n+1}^p$。\n(C) $y_{n+1} = y_n + \\frac{h}{2}(f_n + f_{n+1}^p) = y_n + \\frac{h}{2}(\\lambda y_n + \\lambda y_{n+1}^p) = (1+\\frac{z}{2})y_n + \\frac{z}{2}y_{n+1}^p$。\n\n现在，我们将 $y_{n+1}^p$ 的表达式代入校正子方程，以获得序列 $\\{y_k\\}$ 的单个递推关系：\n$$y_{n+1} = \\left(1+\\frac{z}{2}\\right)y_n + \\frac{z}{2}\\left[ \\left(1+\\frac{3z}{2}\\right)y_n - \\frac{z}{2}y_{n-1} \\right]$$\n$$y_{n+1} = \\left(1+\\frac{z}{2} + \\frac{z}{2} + \\frac{3z^2}{4}\\right)y_n - \\frac{z^2}{4}y_{n-1}$$\n$$y_{n+1} = \\left(1+z+\\frac{3z^2}{4}\\right)y_n - \\frac{z^2}{4}y_{n-1}$$\n这给出了两步标量递推关系：\n$$y_{n+1} - \\left(1+z+\\frac{3z^2}{4}\\right)y_n + \\frac{z^2}{4}y_{n-1} = 0$$\n为了找到稳定域，我们检验特征多项式的根，该多项式通过代入 $y_n = \\xi^n$ 得到：\n$$\\xi^2 - \\left(1+z+\\frac{3z^2}{4}\\right)\\xi + \\frac{z^2}{4} = 0$$\n为了保证稳定性，所有根 $\\xi$ 必须满足 $|\\xi|\\le 1$。我们对二次多项式 $P(\\xi) = \\xi^2+a_1\\xi+a_0=0$ 使用 Jury 稳定性判据。所有根位于单位圆内或圆上（$|\\xi| \\le 1$）的条件是：\n1) $|a_0| \\le 1$\n2) $|a_1| \\le 1+a_0$\n\n这里，$a_0 = \\frac{z^2}{4}$ 且 $a_1 = -(1+z+\\frac{3z^2}{4})$。我们对实数 $z  0$ 分析这些条件。\n\n条件1：$|a_0| \\le 1$ 给出 $|\\frac{z^2}{4}| \\le 1$，这意味着 $z^2 \\le 4$，或 $|z| \\le 2$。对于负数 $z$，这是 $-2 \\le z  0$。\n\n条件2：$|a_1| \\le 1+a_0$ 等价于 $- (1+a_0) \\le a_1 \\le 1+a_0$。\n第一个不等式：$a_1 \\le 1+a_0$\n$$-(1+z+\\frac{3z^2}{4}) \\le 1+\\frac{z^2}{4} \\implies 0 \\le 2+z+z^2$$\n二次式 $z^2+z+2$ 的判别式为 $\\Delta = 1^2 - 4(1)(2) = -7  0$。由于首项系数为正，该二次式恒为正。此不等式对所有实数 $z$ 成立。\n\n第二个不等式：$a_1 \\ge -(1+a_0)$\n$$-(1+z+\\frac{3z^2}{4}) \\ge -(1+\\frac{z^2}{4}) \\implies 1+z+\\frac{3z^2}{4} \\le 1+\\frac{z^2}{4}$$\n$$z + \\frac{2z^2}{4} \\le 0 \\implies z + \\frac{z^2}{2} \\le 0 \\implies z(1+\\frac{z}{2}) \\le 0$$\n$z(1+z/2)=0$ 的根是 $z=0$ 和 $z=-2$。抛物线 $z(1+z/2)$ 开口向上，因此在其根之间为非正值。此不等式对 $z \\in [-2, 0]$ 成立。\n\n对于实数 $z$，结合所有条件，稳定域是 $[-2, 0]$、$\\mathbb{R}$ 和 $[-2, 0]$ 的交集，即 $[-2, 0]$。\n问题要求最大的负实数 $z^{\\star}$，使得对于所有 $z \\in [z^{\\star}, 0]$，稳定性都成立。这对应于所推导出的稳定区间的左端点。因此，$z^{\\star} = -2$。",
            "answer": "$$\\boxed{-2}$$"
        },
        {
            "introduction": "真实的海洋模型通常包含多种时间尺度的物理过程，如快速的重力波和缓慢的平流，这带来了所谓的“刚性”挑战。半隐式格式是应对这一挑战的强大工具，它能对快速过程使用无条件稳定的隐式方法，同时对慢速过程使用计算成本较低的显式方法。本练习将理论付诸实践，要求您实现一个半隐式方案，并对其显式处理的平流部分进行数值稳定性分析，从而弥合理论算法与构建高效、稳健的海洋模型之间的差距 。",
            "id": "3798643",
            "problem": "考虑一维线性化浅水系统，该系统位于周期性域上，是计算海洋学中用于诊断重力波传播和平均流平流的典型模型。设 $x \\in [0,L_x]$，具有周期性边界条件和网格间距 $\\Delta x = L_x/N$。预报变量为纬向速度 $u(x,t)$ 和自由表面位移 $\\eta(x,t)$。控制方程为\n$$\n\\frac{\\partial u}{\\partial t} = - g \\frac{\\partial \\eta}{\\partial x} - U \\frac{\\partial u}{\\partial x}, \\qquad\n\\frac{\\partial \\eta}{\\partial t} = - H \\frac{\\partial u}{\\partial x} - U \\frac{\\partial \\eta}{\\partial x},\n$$\n其中 $g$ 是重力加速度，$H$ 是平均流体深度。与 $g$ 和 $H$ 成正比的项产生相速度为 $c = \\sqrt{gH}$ 的快速重力波，而与 $U$ 成正比的项表示由均匀平均流引起的慢速平流。半隐式策略是隐式处理快项，显式处理慢项。定义 $L$ 和 $S$ 如下\n$$\nL\\begin{bmatrix}u \\\\ \\eta\\end{bmatrix} = \\begin{bmatrix} - g \\partial_x \\eta \\\\ - H \\partial_x u \\end{bmatrix}, \\qquad\nS\\begin{bmatrix}u \\\\ \\eta\\end{bmatrix} = \\begin{bmatrix} - U \\partial_x u \\\\ - U \\partial_x \\eta \\end{bmatrix}.\n$$\n实现一个两步半隐式时间积分器，该积分器由一个 Adams-Bashforth (AB) 预报步和一个 Adams-Moulton (AM) 校正步组成，其中 AB 代表 Adams-Bashforth，AM 代表 Adams-Moulton。具体来说，对 $S$ 使用 AB2 预报格式，并使用一个隐式处理 $L$ 的 AM2（对 $L$ 使用梯形法则，对 $S$ 使用 AM 权重）校正格式：\n$$\n\\text{预报步:}\\quad \\mathbf{y}_{n+1}^{p} = \\mathbf{y}_n + \\Delta t\\left[\\frac{3}{2}S(\\mathbf{y}_n) - \\frac{1}{2}S(\\mathbf{y}_{n-1})\\right],\n$$\n$$\n\\text{校正步:}\\quad \\left(I - \\frac{\\Delta t}{2}L\\right)\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{\\Delta t}{2}L\\mathbf{y}_n + \\frac{\\Delta t}{12}\\left[5S(\\mathbf{y}_{n+1}^{p}) + 8S(\\mathbf{y}_n) - S(\\mathbf{y}_{n-1})\\right],\n$$\n其中 $\\mathbf{y} = [u,\\eta]^{\\top}$，$I$ 是单位算子。在空间上，用中心差分离散 $L$ 中的 $\\partial_x$，并用与 $U$ 符号一致的一阶迎风差分离散 $S$ 中的 $\\partial_x$。\n\n您的程序必须执行两项任务：\n\n- 实现上述格式，并封装 $L$ 和 $S$ 的离散线性算子。\n- 使用 von Neumann 分析法，对采用一阶迎风离散化的标量线性平流问题，分析由显式 $S$ 部分引起的时间步长稳定性约束。对于相位为 $\\theta = k \\Delta x$ 的傅里叶模，迎风符号为 $a(\\theta) = -U\\left(1 - e^{-i\\theta}\\right)/\\Delta x$。对于 AB2 预报步后接 AM2 显式校正步（设 $L = 0$），推导两步递推关系\n$$\ny_{n+1} = C_1(z)\\,y_n + C_2(z)\\,y_{n-1}, \\qquad z = \\Delta t\\,a(\\theta),\n$$\n其系数为\n$$\nC_1(z) = 1 + \\frac{13}{12}z + \\frac{5}{8}z^2, \\qquad C_2(z) = -\\frac{1}{12}z - \\frac{5}{24}z^2,\n$$\n并确定最大平流 Courant 数\n$$\n\\mathrm{CFL}_{\\max} = \\max\\left\\{\\mathrm{CFL} \\,:\\, \\max_{\\theta \\in [0,2\\pi)} \\rho\\left(\\mathcal{A}(\\theta;\\mathrm{CFL})\\right) \\le 1\\right\\},\n$$\n其中 $\\mathrm{CFL} = U\\Delta t/\\Delta x$，$\\rho$ 表示谱半径，$\\mathcal{A}$ 是与两步递推相关的 $2 \\times 2$ 放大矩阵。\n\n物理和数值单位必须明确：距离以米 ($\\mathrm{m}$) 为单位，时间以秒 ($\\mathrm{s}$) 为单位。傅里叶相位 $\\theta$ 的角度是无量纲的，应以弧度处理。所有包含分数的输出都必须表示为小数。\n\n测试套件。使用以下参数和案例来评估稳定性：\n\n- 共享参数：$L_x = 10^6\\,\\mathrm{m}$，$N = 128$，$\\Delta x = L_x/N$，$g = 9.81\\,\\mathrm{m\\,s^{-2}}$，$H = 4000\\,\\mathrm{m}$，初始条件 $\\eta(x,0) = 10^{-2}\\sin(2\\pi x/L_x)$，$u(x,0) = 0$。\n- 案例 1（仅快波）：$U = 0\\,\\mathrm{m\\,s^{-1}}$，$\\Delta t = 2\\times 10^4\\,\\mathrm{s}$。\n- 案例 2（混合，稳定）：$U = 2\\,\\mathrm{m\\,s^{-1}}$，$\\Delta t = 0.8\\,\\Delta x/U$，因此 $\\mathrm{CFL} = 0.8$。\n- 案例 3（混合，不稳定）：$U = 2\\,\\mathrm{m\\,s^{-1}}$，$\\Delta t = 1.2\\,\\Delta x/U$，因此 $\\mathrm{CFL} = 1.2$。\n\n您的程序必须计算：\n\n- 通过扫描 $\\theta$ 并对满足两步放大条件的 $\\mathrm{CFL}$ 执行二分搜索，确定的最大显式平流 $\\mathrm{CFL}_{\\max}$。\n- 分别对案例 1、案例 2 和案例 3 进行布尔稳定性分类，方法是将特定案例的 $\\mathrm{CFL}$ 与计算出的 $\\mathrm{CFL}_{\\max}$ 进行比较。\n\n最终输出格式。您的程序应生成一行输出，其中包含方括号括起来的逗号分隔列表形式的结果，顺序为\n$$\n[\\mathrm{CFL}_{\\max}, \\text{stable}_{1}, \\text{stable}_{2}, \\text{stable}_{3}],\n$$\n其中 $\\mathrm{CFL}_{\\max}$ 是一个浮点数，每个稳定性标志是一个布尔值。例如，输出行可以是 $[0.997342,True,True,False]$ 的形式。",
            "solution": "该问题要求分析应用于线性化浅水方程的半隐式预报-校正时间步进格式的数值稳定性。稳定性约束源于对平流项的显式处理，这些平流项由算子 $S$ 表示。分析是针对标量线性平流方程进行的，该方程通过将快重力波算子 $L$ 设置为零得到。\n\n标量平流方程 $\\partial_t y = S(y)$ 的数值格式由一个两步 Adams-Bashforth (AB2) 预报步和一个三步 Adams-Moulton (AM3) 校正步给出：\n$$\n\\text{预报步:}\\quad y_{n+1}^{p} = y_n + \\Delta t\\left[\\frac{3}{2}S(y_n) - \\frac{1}{2}S(y_{n-1})\\right]\n$$\n$$\n\\text{校正步:}\\quad y_{n+1} = y_n + \\frac{\\Delta t}{12}\\left[5S(y_{n+1}^{p}) + 8S(y_n) - S(y_{n-1})\\right]\n$$\n我们通过考虑单个傅里叶模 $y(x,t) \\propto e^{ikx}$ 来进行 von Neumann 稳定性分析。平流算子 $S(y) = -U\\partial_x y$ 的空间离散化是一阶迎风格式。对于 $U  0$，有限差分算子为 $S(y_j) = -U(y_j - y_{j-1})/\\Delta x$。将其应用于傅里叶模 $y_j = \\hat{y} e^{ij\\theta}$（其中 $\\theta = k\\Delta x$ 是无量纲波数），得到 $S(y_j) = a(\\theta)y_j$。复值函数 $a(\\theta)$ 是离散算子的符号：\n$$\na(\\theta) = -U \\frac{1-e^{-i\\theta}}{\\Delta x}\n$$\n假设解的形式为 $y_n = \\hat{y}(n\\Delta t) e^{ij\\theta}$，时间步进格式变为振幅 $\\hat{y}$ 的递推关系。将 $S(y_n) = a(\\theta)y_n$ 代入格式并定义无量纲复数 $z = \\Delta t \\, a(\\theta)$，我们得到问题中给出的两步线性递推关系 $y_{n+1} = C_1(z) y_n + C_2(z) y_{n-1}$，其系数为：\n$$\nC_1(z) = 1 + \\frac{13}{12}z + \\frac{5}{8}z^2 \\approx 1 + 1.0833z + 0.625z^2\n$$\n$$\nC_2(z) = -\\frac{1}{12}z - \\frac{5}{24}z^2 \\approx -0.0833z - 0.2083z^2\n$$\n通过定义状态向量 $\\mathbf{Y}_n = [y_n, y_{n-1}]^\\top$，该递推关系可以写成矩阵形式：\n$$\n\\mathbf{Y}_{n+1} = \\begin{bmatrix} y_{n+1} \\\\ y_n \\end{bmatrix} = \\begin{bmatrix} C_1(z)  C_2(z) \\\\ 1  0 \\end{bmatrix} \\begin{bmatrix} y_n \\\\ y_{n-1} \\end{bmatrix} = \\mathcal{A}(z) \\mathbf{Y}_n\n$$\n矩阵 $\\mathcal{A}(z)$ 是放大矩阵。为使格式稳定，对于所有可能的 $\\theta$ 值，$\\mathcal{A}(z)$ 的特征值的模不得超过 $1$。特征值 $\\lambda$ 是特征多项式 $\\det(\\mathcal{A} - \\lambda I) = 0$ 的根，即：\n$$\n\\lambda^2 - C_1(z)\\lambda - C_2(z) = 0\n$$\n稳定性要求是谱半径 $\\rho(\\mathcal{A}(z)) = \\max(|\\lambda_1|, |\\lambda_2|) \\le 1$。\n\n参数 $z$ 取决于波数 $\\theta$ 和平流 Courant-Friedrichs-Lewy (CFL) 数，$\\mathrm{CFL} = |U|\\Delta t/\\Delta x$。假设 $U  0$，我们有：\n$$\nz(\\theta, \\mathrm{CFL}) = \\Delta t \\left(-U \\frac{1-e^{-i\\theta}}{\\Delta x}\\right) = -\\mathrm{CFL}(1-e^{-i\\theta})\n$$\n当 $\\theta$ 从 $0$ 变化到 $2\\pi$ 时，对于固定的 $\\mathrm{CFL}$， $z$ 的值在复平面上描绘出一个圆心为 $(-\\mathrm{CFL}, 0)$、半径为 $\\mathrm{CFL}$ 的圆。\n\n为了找到最大稳定 CFL 数 $\\mathrm{CFL}_{\\max}$，我们必须找到 $\\mathrm{CFL}$ 的最大值，使得由 $z(\\theta, \\mathrm{CFL})$ 描绘的整个圆都位于该格式的稳定区域内（即满足 $\\rho(\\mathcal{A}(z)) \\le 1$ 的复数 $z$ 的集合）。这是一个数值问题，我们通过在一个范围（例如 $[0, 2]$）内对 $\\mathrm{CFL}_{\\max}$ 使用二分搜索算法来解决。在二分搜索中，对于 $\\mathrm{CFL}$ 的每个试验值，我们通过将角度 $\\theta \\in [0, 2\\pi)$ 离散化为一个精细网格来进行稳定性检查。对于该网格上的每个 $\\theta_j$，我们计算 $z_j = z(\\theta_j, \\mathrm{CFL})$、系数 $C_1(z_j)$ 和 $C_2(z_j)$，以及特征多项式的根。如果对于任何 $\\theta_j$，任何根的模超过 1，则该试验 $\\mathrm{CFL}$ 是不稳定的。如果所有 $\\theta_j$ 的所有根的模都小于或等于 1，则该试验 $\\mathrm{CFL}$ 是稳定的。二分搜索不断细化 $\\mathrm{CFL}$ 的区间，直到以所需精度收敛到 $\\mathrm{CFL}_{\\max}$。\n\n最后，我们根据这个计算出的最大值对三个测试案例进行分类：\n- 案例 1：$U = 0 \\implies \\mathrm{CFL} = 0$。由于 $0 \\le \\mathrm{CFL}_{\\max}$，此案例是稳定的。\n- 案例 2：$\\mathrm{CFL} = 0.8$。如果 $0.8 \\le \\mathrm{CFL}_{\\max}$，则此案例稳定。\n- 案例 3：$\\mathrm{CFL} = 1.2$。如果 $1.2 \\le \\mathrm{CFL}_{\\max}$，则此案例稳定。\n\n数值搜索将得出 $\\mathrm{CFL}_{\\max}$ 的一个特定值，从而可以对每个案例进行明确的分类。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum explicit advective CFL number for the given scheme\n    and classifies the stability of three test cases.\n    \"\"\"\n\n    def is_stable(cfl, num_theta_points=1000):\n        \"\"\"\n        Checks if a given CFL number is stable for the numerical scheme.\n        \n        The stability is determined by ensuring that the spectral radius of the\n        amplification matrix is less than or equal to 1 for all Fourier modes.\n\n        Args:\n            cfl (float): The Courant-Friedrichs-Lewy number to test.\n            num_theta_points (int): The number of points to discretize the angle theta.\n\n        Returns:\n            bool: True if the CFL is stable, False otherwise.\n        \"\"\"\n        theta = np.linspace(0, 2 * np.pi, num_theta_points, endpoint=False)\n        \n        # The locus of z in the complex plane for a given CFL.\n        # z = -cfl * (1 - exp(-i*theta)) is for U > 0.\n        # The stability analysis depends on the magnitude of z and its location,\n        # which is the same for U  0 when CFL = |U|*dt/dx.\n        z = -cfl * (1 - np.exp(-1j * theta))\n\n        # Coefficients of the characteristic polynomial lambda^2 - C1*lambda - C2 = 0\n        c1 = 1 + (13.0/12.0) * z + (5.0/8.0) * z**2\n        c2 = -(1.0/12.0) * z - (5.0/24.0) * z**2\n\n        # For each theta, find the roots of the characteristic polynomial\n        max_root_mag = 0.0\n        for i in range(num_theta_points):\n            # The characteristic polynomial is p[0]*lambda^2 + p[1]*lambda + p[2] = 0\n            # For numpy.roots, coeffs are [p[0], p[1], p[2]]\n            coeffs = [1, -c1[i], -c2[i]]\n            roots = np.roots(coeffs)\n            # A scheme is unstable if any eigenvalue has magnitude > 1\n            # We use a small tolerance to account for floating point inaccuracies.\n            if np.max(np.abs(roots)) > 1.0 + 1e-9:\n                return False\n        \n        return True\n\n    def find_cfl_max(low=0.0, high=2.0, tol=1e-6, max_iter=100):\n        \"\"\"\n        Performs a binary search to find the maximum stable CFL number.\n\n        Args:\n            low (float): The lower bound of the search interval.\n            high (float): The upper bound of the search interval.\n            tol (float): The tolerance for the result.\n            max_iter (int): Maximum number of iterations for the binary search.\n        \n        Returns:\n            float: The maximum stable CFL number.\n        \"\"\"\n        stable_cfl = low\n        for _ in range(max_iter):\n            if high - low  tol:\n                break\n            \n            mid = (low + high) / 2.0\n            if is_stable(mid):\n                # mid is stable, try for a larger CFL\n                stable_cfl = mid\n                low = mid\n            else:\n                # mid is unstable, reduce CFL\n                high = mid\n        \n        return stable_cfl\n\n    # Task 1: Compute the maximum explicit advective CFL_max\n    cfl_max = find_cfl_max()\n\n    # Task 2: Classify the stability of the three cases\n    case_cfls = [0.0, 0.8, 1.2]\n    \n    stable_1 = (case_cfls[0] = cfl_max)\n    stable_2 = (case_cfls[1] = cfl_max)\n    stable_3 = (case_cfls[2] = cfl_max)\n\n    results = [cfl_max, stable_1, stable_2, stable_3]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]}]\")\n\nsolve()\n```"
        }
    ]
}