{
    "hands_on_practices": [
        {
            "introduction": "在嵌套网格模型中，一个核心挑战是处理子网格的开放边界。子网格内部产生的信号（如波浪或涡旋）必须能够无缝地穿过边界并流出，而不会产生虚假的反射，这对于单向嵌套的稳定性至关重要。此练习将指导您推导一种经典的辐射边界条件——Orlanski 条件，该条件通过估算局部相速度来确保信号能够被平稳地移出计算域 。通过这个实践，您将掌握如何将一个物理原理（线性平流）离散化为一个稳定且有效的数值方案。",
            "id": "3805886",
            "problem": "考虑一个采用网格嵌套的二维海岸海洋模型，其包含一个粗糙的父网格和一个精细的子网格。沿着子网格的一个开放边界段，向外的法线方向与 $x$ 轴对齐。令标量预报场 $\\phi(x,t)$ 表示子网格上的正压模海面高度异常。在单向嵌套中，子网格的边界应允许在子网格内部生成的向外传播的信号无虚假反射地离开，而流入则由父网格提供。一种常用的方法是 Orlanski 辐射边界条件，它遵循运动学假设，即在局部，沿着边法线方向，向外传播的扰动满足线性平流方程。\n\n从沿边法线方向的线性平流方程出发，\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\,\\frac{\\partial \\phi}{\\partial x} = 0,\n$$\n其中 $c$ 是一个待从模型解析的梯度中估计的未知局地相速度。请使用时间上的一阶前向欧拉格式和空间上在边界点处的一阶单侧（内部）差分，推导下一个时间层 $t^{n+1}$ 处边界值 $\\phi_b^{n+1}$ 的离散辐射更新。令 $\\Delta t$ 表示子网格的时间步长，$\\Delta x$ 表示子网格沿边法线方向的间距。将边界值记为 $\\phi_b^n = \\phi(x_b,t^n)$，其紧邻的内部点记为 $\\phi_{b-1}^n = \\phi(x_b-\\Delta x,t^n)$。\n\n假设在时间层 $n$ 的局地相速度通过解析的梯度估计如下：\n$$\nc^n = -\\,\\frac{\\left(\\frac{\\partial \\phi}{\\partial t}\\right)^n}{\\left(\\frac{\\partial \\phi}{\\partial x}\\right)^n},\n$$\n并用时间上的后向差分和空间上的单侧内部差分来近似梯度，\n$$\n\\left(\\frac{\\partial \\phi}{\\partial t}\\right)^n \\approx \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\Delta t}, \\qquad\n\\left(\\frac{\\partial \\phi}{\\partial x}\\right)^n \\approx \\frac{\\phi_b^n - \\phi_{b-1}^n}{\\Delta x}.\n$$\n\n在该边界段上，根据与单向嵌套一致的向外传播假设，将以上各式结合，得出一个关于 $\\phi_b^n$、$\\phi_b^{n-1}$、$\\Delta t$ 和 $\\Delta x$ 的边界更新 $\\phi_b^{n+1}$ 的单一闭式表达式。将最终答案表示为单个符号表达式；不包含单位。无需进行数值计算。",
            "solution": "本题的目标是推导在时间层 $t^{n+1}$ 处边界值 $\\phi_b^{n+1}$ 的单一闭式表达式。推导从线性平流方程开始，该方程控制着标量场 $\\phi(x,t)$ 沿边法线方向 $x$ 的动力学：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\,\\frac{\\partial \\phi}{\\partial x} = 0\n$$\n其中 $c$ 是局地相速度。\n\n问题指定应通过使用时间上的一阶前向欧拉格式和空间上的一阶单侧（内部）差分来离散化该方程，以推导 $\\phi_b^{n+1}$ 的更新。在边界点 $x_b$ 和时间层 $t^n$，该离散化可写为：\n$$\n\\frac{\\phi_b^{n+1} - \\phi_b^n}{\\Delta t} + c^n \\left( \\frac{\\phi_b^n - \\phi_{b-1}^n}{\\Delta x} \\right) = 0\n$$\n此处，$\\phi_b^n$ 是在时间 $t^n$ 处边界点 $x_b$ 的值，$\\phi_{b-1}^n$ 是在时间 $t^n$ 处相邻内部点 $x_b - \\Delta x$ 的值，$\\Delta t$ 是时间步长，$\\Delta x$ 是网格间距。相速度 $c^n$ 在时间层 $n$ 进行计算。\n\n我们可以重新整理该方程以求解 $\\phi_b^{n+1}$：\n$$\n\\phi_b^{n+1} = \\phi_b^n - c^n \\frac{\\Delta t}{\\Delta x} (\\phi_b^n - \\phi_{b-1}^n)\n$$\n该表达式给出了根据当前时间层的值和相速度 $c^n$ 更新的边界值。\n\n接下来，我们使用提供的方法来估计相速度 $c^n$。公式为：\n$$\nc^n = -\\,\\frac{\\left(\\frac{\\partial \\phi}{\\partial t}\\right)^n}{\\left(\\frac{\\partial \\phi}{\\partial x}\\right)^n}\n$$\n问题指定了在边界点 $x_b$ 和时间层 $t^n$ 处偏导数的近似方法：\n1. 时间上的后向差分：\n$$\n\\left(\\frac{\\partial \\phi}{\\partial t}\\right)^n \\approx \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\Delta t}\n$$\n2. 空间上的单侧内部差分（即后向差分格式）：\n$$\n\\left(\\frac{\\partial \\phi}{\\partial x}\\right)^n \\approx \\frac{\\phi_b^n - \\phi_{b-1}^n}{\\Delta x}\n$$\n将这些离散近似代入 $c^n$ 的公式中，得到：\n$$\nc^n = - \\frac{ \\left( \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\Delta t} \\right) }{ \\left( \\frac{\\phi_b^n - \\phi_{b-1}^n}{\\Delta x} \\right) }\n$$\n简化该 $c^n$ 的表达式，得到：\n$$\nc^n = - \\frac{\\Delta x}{\\Delta t} \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\phi_b^n - \\phi_{b-1}^n}\n$$\n现在将这个 $c^n$ 的表达式代回到 $\\phi_b^{n+1}$ 的更新方程中：\n$$\n\\phi_b^{n+1} = \\phi_b^n - \\left( - \\frac{\\Delta x}{\\Delta t} \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\phi_b^n - \\phi_{b-1}^n} \\right) \\frac{\\Delta t}{\\Delta x} (\\phi_b^n - \\phi_{b-1}^n)\n$$\n两个负号相消，得到：\n$$\n\\phi_b^{n+1} = \\phi_b^n + \\left( \\frac{\\Delta x}{\\Delta t} \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\phi_b^n - \\phi_{b-1}^n} \\right) \\frac{\\Delta t}{\\Delta x} (\\phi_b^n - \\phi_{b-1}^n)\n$$\n我们可以重组各项以方便消去：\n$$\n\\phi_b^{n+1} = \\phi_b^n + \\left( \\frac{\\Delta x}{\\Delta t} \\frac{\\Delta t}{\\Delta x} \\right) \\left( \\frac{\\phi_b^n - \\phi_b^{n-1}}{\\phi_b^n - \\phi_{b-1}^n} \\right) (\\phi_b^n - \\phi_{b-1}^n)\n$$\n假设边界处的空间梯度不为零，即 $\\phi_b^n \\neq \\phi_{b-1}^n$，各项可以消去：\n$$\n\\phi_b^{n+1} = \\phi_b^n + (1) \\cdot (\\phi_b^n - \\phi_b^{n-1})\n$$\n这简化为边界更新的最终闭式表达式：\n$$\n\\phi_b^{n+1} = 2\\phi_b^n - \\phi_b^{n-1}\n$$\n这个结果表明，由于为更新规则和相速度估计选择的离散化方案的特定组合，边界值的更新简化为在边界点处根据前两个时间层的值进行简单的时间线性外推。",
            "answer": "$$\n\\boxed{2\\phi_b^n - \\phi_b^{n-1}}\n$$"
        },
        {
            "introduction": "从单向嵌套过渡到双向嵌套时，关键在于如何将子网格的高分辨率信息反馈给父网格，同时避免引入数值噪声。直接替换和增量更新是两种常见的反馈策略，它们在精度和稳定性之间存在权衡。本练习通过一个简化的平流-扩散模型，让您定量比较这两种策略对父网格造成的“冲击” 。这个分析将揭示为什么在实际应用中，通常更倾向于采用平滑的增量更新方法来保证模型的长期稳定运行。",
            "id": "3805941",
            "problem": "考虑一个关于无源示踪场 $u(x,t)$ 的一维线性平流-扩散方程，\n$$\n\\frac{\\partial u}{\\partial t} + c\\,\\frac{\\partial u}{\\partial x} = \\kappa\\,\\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n该方程定义在周期性区域 $x \\in [0, L]$上，其中 $c$ 为恒定平流速度，$\\kappa$ 为恒定扩散率。一个间距均匀的父网格 $\\Delta x_{p}$ 覆盖整个区域，一个间距均匀的嵌套子网格 $\\Delta x_{c} = \\Delta x_{p}/r$（其中加密因子 $r \\geq 2$ 为整数）覆盖一个连续子区域 $\\Omega_{\\mathrm{nest}} \\subset [0,L]$。两个网格均使用相同的时间步长 $\\Delta t$ 和相同的稳定有限体积离散化方案进行平流-扩散计算，但本问题无需了解时间积分器的具体细节。\n\n假设在耦合时间 $t^{n+1}$，子网格在 $\\Omega_{\\mathrm{nest}}$ 内解析出的真实解 $u(x,t^{n+1})$ 误差可忽略不计，而父网格的自由预报 $u_{p}^{n+1,\\mathrm{f}}(x)$ 在 $\\Omega_{\\mathrm{nest}}$ 内偏离真实值，其误差场为 $e(x)$，使得对于 $x \\in \\Omega_{\\mathrm{nest}}$ 有 $u_{p}^{n+1,\\mathrm{f}}(x) = u(x,t^{n+1}) + e(x)$。在 $\\Omega_{\\mathrm{nest}}$ 之外，不施加反馈，父网格保持不变。\n\n考虑两种标准的双向嵌套反馈策略，用限制到父网格上的子网格解来更新 $t^{n+1}$ 时刻的父网格。设 $\\mathcal{A}$ 表示线性限制算子，它将子网格解映射为 $\\Omega_{\\mathrm{nest}}$ 上的父网格单元平均值。这些策略是：\n- 替换反馈：将父网格设置为限制后的子网格解，即在 $\\Omega_{\\mathrm{nest}}$ 中，$u_{p}^{n+1,\\mathrm{rep}} = \\mathcal{A}[u_{c}^{n+1}]$。\n- 增量更新反馈：将父网格设置为自由预报值加上一个朝向限制后的子网格解的加权增量，即在 $\\Omega_{\\mathrm{nest}}$ 中，$u_{p}^{n+1,\\mathrm{inc}} = u_{p}^{n+1,\\mathrm{f}} + \\alpha\\big(\\mathcal{A}[u_{c}^{n+1}] - u_{p}^{n+1,\\mathrm{f}}\\big)$，其中权重为固定的 $0  \\alpha  1$。\n\n为了量化在 $t^{n+1}$ 时刻反馈注入父网格的伪噪声，定义父网格更新增量为 $\\Delta u_{p}^{n+1} = u_{p}^{n+1} - u_{p}^{n+1,\\mathrm{f}}$，并计算其在 $\\Omega_{\\mathrm{nest}}$ 内的父网格单元上的离散 $L^{2}$ 范数：\n$$\n\\|\\Delta u_{p}^{n+1}\\|_{2} \\equiv \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1}\\big]^{2}\\right)^{1/2},\n$$\n其中 $u_{p,j}^{n+1}$ 和 $\\Delta u_{p,j}^{n+1}$ 分别表示父网格单元平均值及其对应的增量，求和遍及 $\\Omega_{\\mathrm{nest}}$ 内的父网格单元索引。\n\n对于一个线性平流-扩散测试，取 $t^{n+1}$ 时刻的真实解为单一空间傅里叶模态 $u(x,t^{n+1}) = U_{0}\\cos\\big(2\\pi k x/L\\big)$，其波数为 $k \\in \\mathbb{N}$。并假设在 $\\Omega_{\\mathrm{nest}}$ 内父网格的自由预报误差为 $e(x) = E_{0}\\cos\\big(2\\pi m x/L\\big)$，其中 $m$ 为某个整数。子网格解在 $\\Omega_{\\mathrm{nest}}$ 内被假设为精确解，因此在父网格上有 $\\mathcal{A}[u_{c}^{n+1}] = \\mathcal{A}[u(\\cdot,t^{n+1})]$。设加密因子为 $r = 4$，增量更新权重为 $\\alpha = \\tfrac{1}{2}$。你可以假设 $\\mathcal{A}$ 是对每个父网格单元的体积平均且是线性的，并且在这样的限制下，上述离散 $L^{2}$ 范数与连续 $L^{2}$ 范数是一致的。\n\n计算比率\n$$\nR \\equiv \\frac{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}},\n$$\n其中 $\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}$ 和 $\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}$ 分别是由增量更新和替换反馈产生的父网格更新的 $L^{2}$ 范数，在 $t^{n+1}$ 耦合后立即进行评估。将最终答案表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "首先，我们根据问题陈述中的定义，为两种反馈策略分别推导父网格的更新增量。我们将一个量 $f(x)$ 在第 $j$ 个父网格单元上的平均值记为 $f_j$。对于嵌套区域 $\\Omega_{\\mathrm{nest}}$ 内 $t^{n+1}$ 时刻的父网格值，关键的定义和关系如下：\n\n1.  父网格自由预报 $u_{p,j}^{n+1,\\mathrm{f}}$ 是连续场 $u_{p}^{n+1,\\mathrm{f}}(x) = u(x,t^{n+1}) + e(x)$ 的单元平均值。设 $u_j^{n+1}$ 和 $e_j$ 分别是真实解 $u(x,t^{n+1})$ 和误差场 $e(x)$ 的单元平均值。根据平均算子的线性性，我们有：\n    $$u_{p,j}^{n+1,\\mathrm{f}} = u_j^{n+1} + e_j$$\n2.  子网格解 $u_c^{n+1}$ 被假设是精确的。限制算子 $\\mathcal{A}$ 执行单元平均。因此，父网格上限制后的子网格解对应于真实解的单元平均值：\n    $$\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j = u_j^{n+1}$$\n3.  父网格的更新增量定义为：\n    $$\\Delta u_{p,j}^{n+1} = u_{p,j}^{n+1} - u_{p,j}^{n+1,\\mathrm{f}}$$\n\n现在我们为两种反馈策略分别计算这个增量。\n\n对于**替换反馈**策略，更新后的父网格状态 $u_{p,j}^{n+1,\\mathrm{rep}}$ 由下式给出：\n$$u_{p,j}^{n+1,\\mathrm{rep}} = \\big(\\mathcal{A}[u_c^{n+1}]\\big)_j = u_j^{n+1}$$\n相应的更新增量 $\\Delta u_{p,j}^{n+1,\\mathrm{rep}}$ 为：\n$$\\Delta u_{p,j}^{n+1,\\mathrm{rep}} = u_{p,j}^{n+1,\\mathrm{rep}} - u_{p,j}^{n+1,\\mathrm{f}} = u_j^{n+1} - (u_j^{n+1} + e_j) = -e_j$$\n\n对于**增量更新反馈**策略，权重为 $\\alpha$，更新后的父网格状态 $u_{p,j}^{n+1,\\mathrm{inc}}$ 为：\n$$u_{p,j}^{n+1,\\mathrm{inc}} = u_{p,j}^{n+1,\\mathrm{f}} + \\alpha\\left(\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j - u_{p,j}^{n+1,\\mathrm{f}}\\right)$$\n根据定义，更新增量 $\\Delta u_{p,j}^{n+1,\\mathrm{inc}}$ 是右侧的第二项：\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha\\left(\\big(\\mathcal{A}[u_c^{n+1}]\\big)_j - u_{p,j}^{n+1,\\mathrm{f}}\\right)$$\n将括号中各项的已知表达式代入：\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha\\left(u_j^{n+1} - (u_j^{n+1} + e_j)\\right) = -\\alpha e_j$$\n\n从这些推导中，我们发现了对于任意父网格单元 $j$，两种策略的更新增量之间存在直接关系：\n$$\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}$$\n这个简单的代数关系是解决问题的关键。建立此关系无需真实解 $u(x,t^{n+1})$ 和误差 $e(x)$ 的具体形式。\n\n现在，我们计算这些增量的离散 $L^2$ 范数。替换反馈的范数是：\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\n增量更新反馈的范数是：\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{inc}}\\big]^{2}\\right)^{1/2}$$\n将关系式 $\\Delta u_{p,j}^{n+1,\\mathrm{inc}} = \\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}$ 代入增量更新范数的表达式中：\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\alpha \\cdot \\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2} = \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\alpha^2 \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\n由于 $\\alpha$ 是一个常数，我们可以将 $\\alpha^2$ 从求和中提出来：\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = \\left(\\alpha^2 \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)\\right)^{1/2} = |\\alpha| \\left(\\Delta x_{p} \\sum_{j \\in \\Omega_{\\mathrm{nest}}} \\big[\\Delta u_{p,j}^{n+1,\\mathrm{rep}}\\big]^{2}\\right)^{1/2}$$\n这可以化简为：\n$$\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}} = |\\alpha| \\cdot \\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}$$\n问题陈述要求计算比率 $R$：\n$$R \\equiv \\frac{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{inc}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}} = \\frac{|\\alpha| \\cdot \\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}}{\\|\\Delta u_{p}^{n+1}\\|_{2}^{\\mathrm{rep}}}$$\n假设误差场 $e(x)$ 在单元平均后不恒为零（这是唯一的非平凡情况，否则增量和范数都将为零），我们可以消去范数项：\n$$R = |\\alpha|$$\n问题指明权重 $\\alpha$ 在范围 $0  \\alpha  1$ 内，所以 $|\\alpha| = \\alpha$。\n给定的权重值为 $\\alpha = \\frac{1}{2}$。\n因此，该比率为：\n$$R = \\frac{1}{2} = 0.5$$\n问题要求将结果四舍五入到四位有效数字。这得到 $0.5000$。诸如 $c$、$\\kappa$、$r=4$、$U_0$、$E_0$、$k$ 和 $m$ 等无关信息不影响最终的比率。",
            "answer": "$$\\boxed{0.5000}$$"
        },
        {
            "introduction": "在真实的海洋模型中，地形追随坐标（如 $\\sigma$ 坐标）被广泛用于处理复杂的海底地形，但这会引入臭名昭著的水平压力梯度误差（PGE）。当网格嵌套与地形追随坐标结合时，父子网格间的插值会成为 PGE 的一个重要来源，尤其是在边界区域。此练习要求您设计并实现一个完整的数值实验，以诊断和量化在嵌套边界上由不同耦合策略引入的压力梯度误差 。这是一个综合性的编程实践，它将多个核心概念（坐标变换、边界耦合、误差分析）结合起来，模拟了计算海洋学家在开发和验证模型时面临的真实挑战。",
            "id": "3805945",
            "problem": "考虑一个一维、静水、Boussinesq 海洋模型，该模型使用地形追随垂直坐标（通常称为 sigma 坐标）进行离散化。假设以下基本定律和定义适用：静水力平衡 $dp/dz = -\\rho g$；Boussinesq 近似仅在浮力和压力梯度力中考虑密度变化，并使用一个恒定的参考密度；密度采用线性状态方程。设密度场被解析地指定为一个光滑函数\n$$\n\\rho(x,z) = \\rho_0 + \\gamma_x x + \\gamma_z z,\n$$\n其中 $x$ 是水平距离（单位：米），$z$ 是垂直距离（单位：米），$z=0$ 位于自由表面，$z0$ 表示向下方向，$\\rho_0$ 的单位是千克/立方米，梯度常数 $\\gamma_x$ 和 $\\gamma_z$ 的单位是千克/立方米/米。水深是一个光滑函数 $H(x)$（单位：米）。地形追随垂直坐标定义为\n$$\n\\sigma = -\\frac{z}{H(x)}, \\quad \\sigma \\in [0,1],\n$$\n因此，一个固定的 $\\sigma$ 对应一个物理深度 $z(x,\\sigma) = -\\sigma H(x)$，当水深存在坡度时，该深度随 $x$ 变化。\n\n根据静水力平衡和给定的密度，在自由表面高度为零的情况下，点 $(x,z)$ 处的精确静水压力为\n$$\np(x,z) = g \\int_{z}^{0} \\rho(x,\\zeta)\\,d\\zeta = g\\left[-(\\rho_0 + \\gamma_x x)z - \\frac{\\gamma_z}{2}z^2\\right],\n$$\n其中 $g$ 是重力加速度（单位：米/秒平方）。在恒定几何深度 $z$ 处的精确水平压力梯度为\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = -g \\gamma_x z.\n$$\n\n在 sigma 坐标离散化中，边界附近的水平压力梯度的一个常见数值近似是沿固定 $\\sigma$ 层的有限差分，\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} \\approx \\frac{p(x+\\Delta x, z(x+\\Delta x,\\sigma)) - p(x-\\Delta x, z(x-\\Delta x,\\sigma))}{2\\Delta x},\n$$\n当 $H(x)$ 不恒定时，该路径遵循变化的几何深度。这个沿 sigma 路径的梯度与精确的恒定 $z$ 梯度之差就是压力梯度误差 (PGE)，\n$$\n\\mathrm{PGE}(x,\\sigma) = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\left.\\frac{\\partial p}{\\partial x}\\right|_{z}.\n$$\n\n你将设计一个专注于边界效应的嵌套网格测试。设有一个粗外部网格，包含 $N_c$ 个节点，范围为 $x\\in[0,L]$，均匀间距为 $\\Delta x_c = L/(N_c-1)$；以及一个嵌套在 $[x_s,x_e]\\subset(0,L)$ 内的细内部网格，包含 $N_f$ 个节点，间距为 $\\Delta x_f = \\Delta x_c/r$，其中 $r\\ge 2$ 是一个整数加密比。水深是线性的，\n$$\nH(x) = H_0 + \\alpha x,\n$$\n其中 $H_0>0$，坡度 $\\alpha$ 的单位是米/米。等密面斜率由比率 $s = -\\gamma_x/\\gamma_z$ 隐式确定；当 $\\gamma_z0$ 且 $\\gamma_x>0$ 时，该斜率为正，确保等密面倾斜并穿过任何垂直边界。\n\n在位于 $x_b = x_s + \\Delta x_f$ 的细网格左边界处，考虑 sigma 路径水平压力梯度的离散中心差分近似，使用 $\\sigma_j = j/(M+1)$（其中 $j=1,\\dots,M$，为避免端点的中间层）处的值，且 $M\\ge 2$：\n- 使用来自细网格内部的 $p(x_b+\\Delta x_f, z(x_b+\\Delta x_f,\\sigma_j))$。\n- 使用以下两种耦合策略之一，从粗网格提供左侧虚拟值 $p(x_b-\\Delta x_f, z(x_b-\\Delta x_f,\\sigma_j))$：\n    1. 单向嵌套：使用最近的粗网格节点之间的线性插值，将相同 $\\sigma_j$ 上的粗网格压力值插值到 $x_b-\\Delta x_f$。\n    2. 双向嵌套：计算相同的粗网格插值，然后使用一个反馈权重 $\\lambda \\in (0,1)$，将其与来自内部相同 $\\sigma_j$ 上的细网格线性外插值进行混合，即 $p_{\\text{ghost}} = (1-\\lambda) p_{\\text{coarse-interp}} + \\lambda p_{\\text{fine-extrap}}$，其中细网格外插值为 $p_{\\text{fine-extrap}} = p(x_b,\\sigma_j) - [p(x_b+\\Delta x_f,\\sigma_j) - p(x_b,\\sigma_j)]$。\n\n对于每个 $\\sigma_j$，计算 sigma 路径有限差分\n$$\nG_{\\sigma}(x_b,\\sigma_j) = \\frac{p(x_b+\\Delta x_f, z(x_b+\\Delta x_f,\\sigma_j)) - p_{\\text{ghost}}(x_b-\\Delta x_f, \\sigma_j)}{2\\Delta x_f},\n$$\n以及在代表性深度 $z_b(\\sigma_j) = -\\sigma_j H(x_b)$ 处的精确恒定 $z$ 梯度，\n$$\nG_{z}(x_b,\\sigma_j) = -g \\gamma_x z_b(\\sigma_j).\n$$\n定义边界处的均方根压力梯度误差，\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{M}\\sum_{j=1}^{M} \\left( G_{\\sigma}(x_b,\\sigma_j) - G_{z}(x_b,\\sigma_j) \\right)^2 }.\n$$\n\n你的任务是实现一个完整的程序，该程序：\n1. 根据上述解析公式精确计算 $p(x,z)$。\n2. 按描述构建粗网格和细网格。\n3. 实现边界虚拟值的单向和双向嵌套，并计算细网格左边界处的 $E_{\\mathrm{RMS}}$。\n4. 对提供的测试套件评估 $E_{\\mathrm{RMS}}$ 并打印结果。\n\n使用以下常量和测试套件。所有输出必须以帕斯卡/米 (Pa/m) 为单位，表示为十进制浮点数。\n\n常量：\n- $g = 9.81 \\ \\mathrm{m/s^2}$，$\\rho_0 = 1025 \\ \\mathrm{kg/m^3}$，加密比 $r = 2$，反馈权重 $\\lambda = 0.5$，sigma 中间层数 $M = 20$。\n\n测试套件参数集 $(L,H_0,\\alpha,N_c,\\gamma_x,\\gamma_z,x_s,x_e,\\mathrm{mode})$：\n- 案例 1 (标准情况，单向)：$(10000, 100, 1.0\\times 10^{-3}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$。\n- 案例 2 (标准情况，双向)：$(10000, 100, 1.0\\times 10^{-3}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{two-way})$。\n- 案例 3 (边界条件边缘情况，平坦水深)：$(10000, 100, 0, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$。\n- 案例 4 (更陡峭的水深，单向)：$(10000, 100, 1.0\\times 10^{-2}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{one-way})$。\n- 案例 5 (更陡峭的水深，双向)：$(10000, 100, 1.0\\times 10^{-2}, 65, 1.0\\times 10^{-5}, -1.0\\times 10^{-2}, 2500, 7500, \\text{two-way})$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述测试案例的顺序排列，例如，“[result1,result2,result3,result4,result5]”。每个结果应是对应案例的 $E_{\\mathrm{RMS}}$ 值，单位为 Pa/m。",
            "solution": "该问题要求在一个简化的一维海洋模型中，计算嵌套网格边界上的均方根压力梯度误差 ($E_{\\mathrm{RMS}}$)。解决方案基于所提供的物理和数值框架，涉及几个计算步骤。\n\n首先，我们根据问题陈述定义核心物理函数。水深 $H(x)$ 是水平坐标 $x$ 的线性函数：\n$$\nH(x) = H_0 + \\alpha x\n$$\n其中 $H_0$ 是 $x=0$ 处的深度，$\\alpha$ 是恒定的海底坡度。\n\n地形追随 sigma 坐标 $\\sigma$ 与几何垂直坐标 $z$ 的关系如下：\n$$\nz(x, \\sigma) = -\\sigma H(x) = -\\sigma(H_0 + \\alpha x)\n$$\n该变换将域 $(x, \\sigma) \\in [0,L] \\times [0,1]$ 映射到由自由表面 $z=0$ 和海底 $z=-H(x)$ 界定的物理域。\n\n静水压力 $p(x,z)$ 由对给定的密度场 $\\rho(x,z) = \\rho_0 + \\gamma_x x + \\gamma_z z$ 进行积分得到的解析公式给出：\n$$\np(x,z) = g\\left[-(\\rho_0 + \\gamma_x x)z - \\frac{\\gamma_z}{2}z^2\\right]\n$$\n其中 $g$ 是重力加速度。\n\n问题要求比较恒定深度 ($z$) 面上的精确水平压力梯度与其在恒定 sigma ($\\sigma$) 面上的数值近似。点 $(x,z)$ 处的精确梯度为：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = -g \\gamma_x z\n$$\n评估将在水平位置 $x_b$ 处的离散垂直层 $\\sigma_j = j/(M+1)$（其中 $j=1,\\dots,M$）上进行。相应的物理深度为 $z_b(\\sigma_j) = z(x_b, \\sigma_j) = -\\sigma_j H(x_b)$。因此，用于比较的精确梯度为：\n$$\nG_{z}(x_b, \\sigma_j) = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z=z_b(\\sigma_j)} = -g \\gamma_x z_b(\\sigma_j) = g \\gamma_x \\sigma_j H(x_b)\n$$\n\n接下来，我们建立数值网格结构。一个粗网格覆盖域 $x \\in [0,L]$，有 $N_c$ 个节点，网格间距为 $\\Delta x_c = L/(N_c-1)$。一个细网格嵌套在 $[x_s, x_e]$ 内，间距为 $\\Delta x_f = \\Delta x_c / r$，其中 $r$ 是加密比。\n\n数值压力梯度使用中心有限差分在位置 $x_b = x_s + \\Delta x_f$（即细网格的第二个节点）处计算。计算模板使用点 $x_b - \\Delta x_f = x_s$ 和 $x_b + \\Delta x_f = x_s + 2\\Delta x_f$。对于给定的 $\\sigma_j$ 层，数值梯度为：\n$$\nG_{\\sigma}(x_b, \\sigma_j) = \\frac{p(x_R, z_R) - p_{\\text{ghost}}(x_L, \\sigma_j)}{2\\Delta x_f}\n$$\n其中：\n- 右侧点为 $x_R = x_b + \\Delta x_f$。压力在物理位置 $(x_R, z_R)$ 处计算，其中 $z_R = z(x_R, \\sigma_j)$。因此，压力项为 $p_R = p(x_R, z(x_R, \\sigma_j))$。\n- 左侧点为 $x_L = x_b - \\Delta x_f = x_s$。此边界点处的压力不是直接计算的，而是作为一个“虚拟”值 $p_{\\text{ghost}}$ 提供，其计算取决于嵌套策略。问题陈述暗示 $p_{\\text{ghost}}$ 是在水平位置 $x_L$ 处 sigma 层 $\\sigma_j$ 上的一个值，但其物理深度对应于 $x_L$ 处的水深，即 $z_L = z(x_L, \\sigma_j)$。\n\n对每个 $\\sigma_j$，在位置 $x_L = x_s$ 处 $p_{\\text{ghost}}$ 的计算过程如下：\n\n1.  **粗网格插值**：首先，我们通过对包含 $x_L$ 的两个最近粗网格节点进行线性插值，来找到值 $p_{\\text{coarse-interp}}$。设这些节点为 $x_{c,k}$ 和 $x_{c,k+1}$，使得 $x_{c,k} \\le x_L  x_{c,k+1}$。索引 $k$ 可以通过 $k = \\lfloor x_L / \\Delta x_c \\rfloor$ 找到。插值权重由 $x_L$ 相对于这些节点的位置确定。粗节点上的压力值在相同的 $\\sigma_j$ 面上计算：\n    $$\n    p_{c,k} = p(x_{c,k}, z(x_{c,k}, \\sigma_j))\n    $$\n    $$\n    p_{c,k+1} = p(x_{c,k+1}, z(x_{c,k+1}, \\sigma_j))\n    $$\n    插值结果为：\n    $$\n    p_{\\text{coarse-interp}} = p_{c,k} + \\frac{p_{c,k+1} - p_{c,k}}{x_{c,k+1} - x_{c,k}} (x_L - x_{c,k})\n    $$\n\n2.  **嵌套策略**：\n    *   **单向嵌套**：虚拟值就是粗网格的插值：\n      $$\n      p_{\\text{ghost}} = p_{\\text{coarse-interp}}\n      $$\n    *   **双向嵌套**：虚拟值是粗网格插值与细网格内部外插值的混合。细网格的外插值 $p_{\\text{fine-extrap}}$ 使用 $x_b$ 和 $x_b+\\Delta x_f$ 处的值来估计 $x_b - \\Delta x_f = x_L$ 处的值：\n      $$\n      p_{\\text{fine-extrap}} = p(x_b, z(x_b, \\sigma_j)) - \\left[ p(x_b+\\Delta x_f, z(x_b+\\Delta x_f, \\sigma_j)) - p(x_b, z(x_b, \\sigma_j)) \\right]\n      $$\n      最终的虚拟值是使用反馈权重 $\\lambda$ 的加权平均：\n      $$\n      p_{\\text{ghost}} = (1-\\lambda) p_{\\text{coarse-interp}} + \\lambda p_{\\text{fine-extrap}}\n      $$\n\n最后，对于每个测试案例，通过对所有 $M$ 个 sigma 层上数值梯度和精确梯度之间差的平方进行平均，来计算均方根误差：\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{M}\\sum_{j=1}^{M} \\left( G_{\\sigma}(x_b, \\sigma_j) - G_{z}(x_b, \\sigma_j) \\right)^2 }\n$$\n\n整体算法如下：\n1.  对于每个测试案例，解析参数 $(L, H_0, \\alpha, N_c, \\gamma_x, \\gamma_z, x_s, x_e, \\mathrm{mode})$。\n2.  设置全局常量 $g, \\rho_0, r, \\lambda, M$。\n3.  定义网格参数：$\\Delta x_c = L/(N_c-1)$ 和 $\\Delta x_f = \\Delta x_c/r$。\n4.  定义关键水平位置：$x_b = x_s + \\Delta x_f$，$x_L = x_s$，$x_R = x_s + 2\\Delta x_f$。\n5.  初始化一个数组以存储每个 $\\sigma_j$ 的平方误差。\n6.  从 $j=1$ 到 $M$ 循环：\n    a.  设置 $\\sigma_j = j/(M+1)$。\n    b.  在所有需要的 $x$ 位置计算水深 $H(x)$。\n    c.  计算精确梯度 $G_{z}(x_b, \\sigma_j) = g \\gamma_x \\sigma_j H(x_b)$。\n    d.  计算 $p_R = p(x_R, z(x_R, \\sigma_j))$。\n    e.  根据指定的 `mode`（‘one-way’ 或 ‘two-way’）在 $x_L$ 处计算 $p_{\\text{ghost}}$，这涉及计算 $p_{\\text{coarse-interp}}$，并在需要时计算 $p_{\\text{fine-extrap}}$。\n    f.  计算数值梯度 $G_{\\sigma}(x_b, \\sigma_j) = (p_R - p_{\\text{ghost}}) / (2\\Delta x_f)$。\n    g.  存储平方差 $(G_{\\sigma} - G_{z})^2$。\n7.  通过取存储的平方误差的平均值的平方根来计算 $E_{\\mathrm{RMS}}$。\n8.  收集所有测试案例的 $E_{\\mathrm{RMS}}$ 并按规定格式化输出。\n\n对于 $\\alpha = 0$ 的特殊情况，水深 $H(x) = H_0$ 是恒定的。因此，对于任何固定的 $\\sigma_j$，深度 $z(x,\\sigma_j) = -\\sigma_j H_0$ 也是恒定的。对于固定的 $z$，压力函数 $p(x,z)$ 在 $x$ 上是线性的。因此，在 $x$ 上的线性插值是精确的。粗网格插值将产生精确的压力值，因此 $p_{\\text{coarse-interp}}$ 将是精确的。这意味着对于单向嵌套，数值梯度 $G_\\sigma$ 将完全等于 $z$ 层上的解析有限差分，对于线性压力场，这等于真实导数。因此，对于案例 3，我们预期 $E_{\\mathrm{RMS}} = 0$。",
            "answer": "[0.003929002,0.001964501,0.0,0.039290024,0.019645012]"
        }
    ]
}