{
    "hands_on_practices": [
        {
            "introduction": "The Gent-McWilliams (GM) parameterization models the transport effects of mesoscale eddies as an advective process along surfaces of constant buoyancy, known as isopycnals. The orientation of these surfaces is quantified by the isopycnal slope, which is determined by the ratio of horizontal to vertical buoyancy gradients. This first practice solidifies this fundamental geometric concept, allowing you to derive the slope from first principles and gain a concrete understanding of how the ocean's large-scale density structure dictates the pathways for eddy-induced transport .",
            "id": "3793909",
            "problem": "In the Gent–McWilliams (GM) eddy parameterization, mesoscale eddy effects are represented as an advective transport along surfaces of constant buoyancy, often referred to as isopycnal surfaces in the Boussinesq framework. Consider a stably stratified ocean interior where the buoyancy field $b(x,y,z)$ is smooth, and define the squared buoyancy frequency $N^{2}$ by the vertical gradient $N^{2} \\equiv \\partial_{z} b$. An isopycnal (constant-buoyancy) surface is characterized by differential displacements $(\\mathrm{d}x,\\mathrm{d}y,\\mathrm{d}z)$ that satisfy $\\mathrm{d}b = 0$. The isopycnal slope in the $x$-direction is defined as $s_{x} \\equiv \\left(\\partial z / \\partial x\\right)_{b}$, the rate at which depth changes with horizontal distance along a surface of constant buoyancy.\n\nAssume a locally linear buoyancy structure that is consistent with stable stratification, given by $b(z) = N^{2} z$ with constant $N^{2} > 0$, and a uniform lateral buoyancy gradient $\\partial_{x} b = \\alpha$, where $\\alpha$ is a prescribed constant. Using only the definition of an isopycnal as a surface of constant $b$ and standard multivariable calculus, derive the isopycnal slope $s_{x}$ in terms of $\\alpha$ and $N^{2}$. Then, based on your derived expression, explain how the sign of $s_{x}$ depends on the sign of $\\alpha$ and comment on the magnitude of $|s_{x}|$ in relation to $|\\alpha|$ and $N^{2}$ for stably stratified flow. Express the final answer for $s_{x}$ as a single closed-form analytic expression in terms of $\\alpha$ and $N^{2}$. No numerical evaluation is required; no units should be included in the final expression.",
            "solution": "The problem is valid as it is scientifically grounded in physical oceanography, well-posed, and objective. It provides a set of consistent definitions and assumptions from which a unique, meaningful solution can be derived through standard mathematical procedures. The problem asks for the derivation of the isopycnal slope, $s_x$, in terms of the lateral buoyancy gradient, $\\alpha$, and the squared buoyancy frequency, $N^2$.\n\nThe derivation begins with the fundamental definition of an isopycnal surface, which is a surface of constant buoyancy, $b$. For a buoyancy field that depends on spatial coordinates, $b(x, y, z)$, an isopycnal surface is described by the equation $b(x, y, z) = C$, where $C$ is a constant.\n\nThe differential change in buoyancy, $\\mathrm{d}b$, can be expressed using the total derivative:\n$$\n\\mathrm{d}b = \\frac{\\partial b}{\\partial x} \\mathrm{d}x + \\frac{\\partial b}{\\partial y} \\mathrm{d}y + \\frac{\\partial b}{\\partial z} \\mathrm{d}z\n$$\nAlong an isopycnal surface, the buoyancy is constant by definition, which implies that its total differential is zero:\n$$\n\\mathrm{d}b = 0\n$$\nThe problem defines the isopycnal slope in the $x$-direction, $s_x$, as $s_x \\equiv (\\partial z / \\partial x)_b$. This represents the change in depth, $z$, with respect to horizontal position, $x$, while constrained to a surface of constant buoyancy, $b$. To find this quantity, we consider displacements purely in the $x$-$z$ plane by setting $\\mathrm{d}y = 0$. The condition $\\mathrm{d}b = 0$ then simplifies to:\n$$\n\\frac{\\partial b}{\\partial x} \\mathrm{d}x + \\frac{\\partial b}{\\partial z} \\mathrm{d}z = 0\n$$\nThis equation relates the differential displacements $\\mathrm{d}x$ and $\\mathrm{d}z$ required to remain on an isopycnal surface. We can rearrange this equation to find the slope $\\mathrm{d}z/\\mathrm{d}x$ along this surface.\n$$\n\\frac{\\partial b}{\\partial z} \\mathrm{d}z = - \\frac{\\partial b}{\\partial x} \\mathrm{d}x\n$$\nAssuming $\\partial b / \\partial z \\neq 0$, which is guaranteed by the stable stratification condition $N^2 > 0$, we can divide by $\\mathrm{d}x$ and $\\partial b / \\partial z$ to obtain the slope:\n$$\n\\frac{\\mathrm{d}z}{\\mathrm{d}x} = - \\frac{\\partial b / \\partial x}{\\partial b / \\partial z}\n$$\nThis expression for the slope along the curve of constant $b$ in the $x$-$z$ plane is precisely the definition of the partial derivative of $z$ with respect to $x$ while holding $b$ constant. Thus, we have:\n$$\ns_x = \\left(\\frac{\\partial z}{\\partial x}\\right)_{b} = - \\frac{\\partial b / \\partial x}{\\partial b / \\partial z}\n$$\nThe problem provides the necessary components to evaluate this expression. The uniform lateral buoyancy gradient in the $x$-direction is given as:\n$$\n\\frac{\\partial b}{\\partial x} = \\alpha\n$$\nThe squared buoyancy frequency, a measure of the vertical stratification, is defined and given as:\n$$\nN^2 \\equiv \\frac{\\partial b}{\\partial z}\n$$\nThe problem states that $N^2$ is a positive constant, consistent with the assumption of stable stratification. Substituting these given quantities into the expression for $s_x$ yields the final result:\n$$\ns_x = - \\frac{\\alpha}{N^2}\n$$\nThis expression gives the isopycnal slope $s_x$ in terms of the prescribed constants $\\alpha$ and $N^2$.\n\nBased on this derived expression, we can analyze the properties of the slope:\n\n1.  **Sign of $s_x$**: The problem specifies that the stratification is stable, which means $N^2 > 0$. Therefore, the sign of the isopycnal slope $s_x$ is determined entirely by the sign of the lateral buoyancy gradient $\\alpha$. Specifically, $s_x$ has the opposite sign to $\\alpha$.\n    *   If $\\alpha > 0$, meaning buoyancy increases in the positive $x$-direction (e.g., the water becomes less dense), then $s_x < 0$. This indicates that the isopycnal surfaces slope downwards as one moves in the positive $x$-direction. To stay on a surface of constant buoyancy, one must move to a greater depth (more negative $z$ if $z$ is positive upwards) where the background buoyancy is lower, compensating for the increase from the lateral gradient.\n    *   If $\\alpha < 0$, meaning buoyancy decreases in the positive $x$-direction, then $s_x > 0$. This indicates that the isopycnal surfaces slope upwards in the positive $x$-direction.\n\n2.  **Magnitude of $|s_x|$**: The magnitude of the slope is given by $|s_x| = \\frac{|\\alpha|}{N^2}$.\n    *   The magnitude of the slope is directly proportional to the magnitude of the lateral buoyancy gradient, $|\\alpha|$. A stronger horizontal difference in buoyancy requires a steeper slope to maintain a constant buoyancy value.\n    *   The magnitude of the slope is inversely proportional to the squared buoyancy frequency, $N^2$. A larger $N^2$ signifies stronger vertical stratification, meaning that buoyancy changes more rapidly with depth. In such a fluid, a smaller vertical displacement is needed to counteract a given horizontal change in buoyancy, resulting in a shallower (less steep) isopycnal slope. In typical oceanic conditions, the horizontal buoyancy gradients are much smaller in magnitude than the vertical stratification, i.e., $|\\alpha| \\ll N^2$. Consequently, isopycnal slopes $|s_x|$ are typically very small, on the order of $10^{-4}$ to $10^{-2}$, indicating that isopycnal surfaces are nearly horizontal.",
            "answer": "$$\n\\boxed{-\\frac{\\alpha}{N^{2}}}\n$$"
        },
        {
            "introduction": "After establishing the geometry of isopycnal surfaces, the next step is to quantify the strength of the eddy-induced mixing along them, which is governed by the eddy diffusivity coefficient, $K$. This parameter can be physically motivated using mixing-length theory, which relates $K$ to the characteristic velocity and length scales of the eddies being parameterized. This exercise provides crucial physical intuition for the eddy diffusivity, connecting an abstract parameter to the tangible properties of mesoscale eddies and helping to justify the typical magnitudes used in ocean models .",
            "id": "3793926",
            "problem": "In large-scale ocean circulation models that cannot resolve mesoscale eddies, the Gent–McWilliams eddy parameterization (GM) represents the lateral stirring of tracers along isopycnal surfaces via an eddy-induced (bolus) transport and an associated isopycnal thickness diffusivity. Consider a passive tracer with concentration field $c(\\mathbf{x},t)$ transported by an incompressible velocity field $\\mathbf{u}(\\mathbf{x},t)$ on approximately isopycnal surfaces. Start from the advection of a passive tracer and a Reynolds decomposition into mean and fluctuating parts, $\\mathbf{u} = \\overline{\\mathbf{u}} + \\mathbf{u}'$ and $c = \\overline{c} + c'$, and the standard downgradient flux closure for isopycnal eddy transport, in which the eddy flux is modeled as $\\overline{\\mathbf{u}' c'} \\approx - K \\nabla_{\\sigma} \\overline{c}$, where $K$ is an isopycnal eddy diffusivity and $\\nabla_{\\sigma}$ denotes the gradient along isopycnal surfaces. Using mixing-length theory and physically based estimates for the magnitudes of the eddy velocity and tracer fluctuations, derive an order-of-magnitude expression for $K$ in terms of an isopycnal eddy mixing length $l$ and an eddy velocity scale $U_{e}$. Then evaluate $K$ for the realistic mesoscale values $l = 30\\,\\mathrm{km}$ and $U_{e} = 0.1\\,\\mathrm{m\\,s^{-1}}$. Round your numerical answer to three significant figures and express the final diffusivity in $\\mathrm{m^{2}\\,s^{-1}}$.",
            "solution": "The problem requires the derivation of an order-of-magnitude expression for the isopycnal eddy diffusivity, $K$, based on mixing-length theory, and a subsequent numerical evaluation.\n\nThe starting point is the Reynolds-averaged advection of a passive tracer, $c$. The effect of unresolved eddies appears as an eddy flux term, $\\overline{\\mathbf{u}' c'}$, where $\\mathbf{u}'$ and $c'$ are the fluctuating parts of the velocity and tracer concentration, respectively. The problem provides a downgradient flux closure for this term, relating it to the mean tracer gradient along isopycnal surfaces, $\\nabla_{\\sigma} \\overline{c}$:\n$$\n\\overline{\\mathbf{u}' c'} \\approx -K \\nabla_{\\sigma} \\overline{c} \\quad (1)\n$$\nOur goal is to derive an expression for $K$ using physical arguments.\n\nWe employ mixing-length theory, a classical concept in turbulence modeling. This theory posits that a parcel of fluid conserves its properties (in this case, tracer concentration) over a characteristic displacement distance, known as the mixing length, before mixing with its new environment. Let us consider a fluid parcel that is displaced by a vector $\\mathbf{l}'$. The concentration anomaly, $c'$, that this parcel represents relative to its new surroundings is caused by the mean concentration gradient, $\\nabla_{\\sigma} \\overline{c}$. For a small displacement, this anomaly can be approximated by the first-order term in a Taylor expansion:\n$$\nc' \\approx - \\mathbf{l}' \\cdot \\nabla_{\\sigma} \\overline{c}\n$$\nThe negative sign signifies that a parcel originating from a region of higher-than-average concentration ($\\mathbf{l}' \\cdot \\nabla_{\\sigma} \\overline{c} < 0$) will have a positive anomaly ($c' > 0$) at its new location.\n\nSubstituting this expression for $c'$ into the eddy flux term gives:\n$$\n\\overline{\\mathbf{u}' c'} \\approx \\overline{\\mathbf{u}' (-\\mathbf{l}' \\cdot \\nabla_{\\sigma} \\overline{c})}\n$$\nAssuming the mean gradient $\\nabla_{\\sigma} \\overline{c}$ is approximately constant over the spatial scales of the eddies, it can be treated as a constant with respect to the averaging operation:\n$$\n\\overline{\\mathbf{u}' c'} \\approx - \\left( \\overline{\\mathbf{u}' \\otimes \\mathbf{l}'} \\right) \\nabla_{\\sigma} \\overline{c}\n$$\nwhere $\\otimes$ represents the tensor (or outer) product. The term $\\overline{\\mathbf{u}' \\otimes \\mathbf{l}'}$ is a second-rank tensor representing the eddy transport coefficient.\n\nFor an order-of-magnitude analysis, we can work with the characteristic scales of the quantities involved. Let $U_e$ be the characteristic magnitude of the eddy velocity, $U_e \\sim |\\mathbf{u}'|$, and let $l$ be the characteristic mixing length, $l \\sim |\\mathbf{l}'|$. The magnitudes of the eddy velocity and eddy concentration fluctuation are assumed to be correlated. The magnitude of the concentration fluctuation is scaled as:\n$$\n|c'| \\sim l |\\nabla_{\\sigma} \\overline{c}|\n$$\nThe magnitude of the eddy flux is then scaled as the product of the characteristic eddy velocity and the characteristic concentration fluctuation:\n$$\n|\\overline{\\mathbf{u}' c'}| \\sim U_e |c'| \\sim U_e l |\\nabla_{\\sigma} \\overline{c}|\n$$\nSince the flux is \"downgradient,\" it is directed opposite to the gradient. We thus write the vector relationship with a negative sign, consistent with our earlier derivation:\n$$\n\\overline{\\mathbf{u}' c'} \\sim - (l U_e) \\nabla_{\\sigma} \\overline{c} \\quad (2)\n$$\nThis expression provides the scaling of the eddy flux based on mixing-length theory.\n\nBy comparing this result $(2)$ with the provided flux-gradient relationship $(1)$, we can identify the eddy diffusivity $K$:\n$$\nK \\sim l U_e\n$$\nThis is the desired order-of-magnitude expression for $K$ in terms of the isopycnal eddy mixing length $l$ and the eddy velocity scale $U_e$.\n\nThe second part of the problem is to evaluate $K$ for the given values:\nIsopycnal eddy mixing length, $l = 30\\,\\mathrm{km}$.\nEddy velocity scale, $U_e = 0.1\\,\\mathrm{m\\,s^{-1}}$.\n\nFor consistency, we must express all quantities in SI units. We convert the mixing length from kilometers to meters:\n$$\nl = 30\\,\\mathrm{km} = 30 \\times 10^3\\,\\mathrm{m} = 3 \\times 10^4\\,\\mathrm{m}\n$$\nThe eddy velocity is given in SI units:\n$$\nU_e = 0.1\\,\\mathrm{m\\,s^{-1}} = 1 \\times 10^{-1}\\,\\mathrm{m\\,s^{-1}}\n$$\nNow, we can compute the numerical value of $K$:\n$$\nK = l U_e = (3 \\times 10^4\\,\\mathrm{m}) \\times (1 \\times 10^{-1}\\,\\mathrm{m\\,s^{-1}})\n$$\n$$\nK = 3 \\times 10^{3}\\,\\mathrm{m^2\\,s^{-1}} = 3000\\,\\mathrm{m^2\\,s^{-1}}\n$$\nThe problem asks for the result to be rounded to three significant figures. To express this precision, we write the result in scientific notation:\n$$\nK = 3.00 \\times 10^3\\,\\mathrm{m^2\\,s^{-1}}\n$$\nThis value is a typical estimate for the isopycnal eddy diffusivity used in coarse-resolution ocean models to parameterize the effects of mesoscale eddies.",
            "answer": "$$\\boxed{3.00 \\times 10^{3}}$$"
        },
        {
            "introduction": "With an understanding of both the isopycnal slope and the eddy diffusivity, we can now explore the parameterization's impact on the large-scale ocean circulation. This advanced, hands-on coding problem bridges theory and application by asking you to implement and compare two versions of the GM scheme: one with a constant diffusivity $K$, and a more sophisticated variant where $K$ is dynamically constrained by the ocean's energy budget. This practice provides a window into modern climate modeling, allowing you to investigate how the parameterization affects the residual overturning circulation and the available potential energy (APE) budget .",
            "id": "3793967",
            "problem": "Consider a zonally periodic, Boussinesq, hydrostatic ocean channel with meridional coordinate $y \\in [0,W]$ and vertical coordinate $z \\in [0,H]$, of zonal length $L_x$. The Gent–McWilliams eddy parameterization (Gent–McWilliams (GM)) represents unresolved eddy effects through an eddy-induced (bolus) transport that acts to advect tracers along isopycnals. In the Transformed Eulerian Mean framework, the residual overturning streamfunction $\\Psi^{\\mathrm{res}}(y,z)$ equals the sum of the Eulerian mean streamfunction $\\Psi^{\\mathrm{E}}(y,z)$ and the GM bolus streamfunction $\\Psi^{\\mathrm{GM}}(y,z)$. Assume $\\Psi^{\\mathrm{E}}(y,z)=0$, so that $\\Psi^{\\mathrm{res}}(y,z)=\\Psi^{\\mathrm{GM}}(y,z)$.\n\nYou will compare the standard constant-thickness-diffusivity GM scheme with a variant in which the thickness diffusivity is constrained by a prescribed energy budget. The comparison must be grounded in first principles. Begin only with the following fundamental bases and core definitions:\n\n- The Boussinesq buoyancy is $b = -g \\rho' / \\rho_0$, where $g$ is gravitational acceleration, $\\rho'$ is the density perturbation, and $\\rho_0$ is a constant reference density.\n- The Brunt–Väisälä frequency satisfies $N^2 = \\partial b / \\partial z$.\n- The isopycnal slope in the meridional direction is $s(y,z) = \\partial \\eta(y,z) / \\partial y$, where $\\eta(y,z)$ is the displacement of an isopycnal surface from a flat reference.\n- The Available Potential Energy (APE) density for small displacements is $e_p = \\tfrac{1}{2} \\rho_0 N^2 \\eta^2$.\n- The eddy-induced bolus transport in GM is represented by a streamfunction $\\Psi^{\\mathrm{GM}}(y,z)$ whose magnitude must be derived from the tracer advection-diffusion equation and the isopycnal geometry, ensuring dimensional consistency and alignment with the role of a thickness diffusivity.\n\nUsing these bases, derive:\n\n1. A dimensionally consistent expression for the GM bolus streamfunction $\\Psi^{\\mathrm{GM}}(y,z)$ in terms of the thickness diffusivity $K$ and the isopycnal slope field $s(y,z)$ for a two-dimensional $(y,z)$ configuration, and define the total meridional overturning magnitude integrated over the zonal direction as a transport with units $\\mathrm{m}^3\\mathrm{s}^{-1}$.\n\n2. An expression for the domain-integrated APE destruction rate due to the GM bolus transport in terms of $K$, $N^2$, and $s$, with units of $\\mathrm{W}$.\n\n3. An energy-constrained thickness diffusivity $K_{\\mathrm{energy}}$ obtained by enforcing that the APE destruction rate due to GM equals a prescribed wind work input $P_w$, subject to an upper bound $K_{\\max}$, so that $K_{\\mathrm{energy}} = \\min\\left(K_{\\max}, \\text{value derived from the energy constraint}\\right)$.\n\nThen implement these expressions numerically in a zonal channel with a prescribed, steady isopycnal slope field\n$$\ns(y,z) = s_0 \\exp\\left(-\\frac{(y - W/2)^2}{2 \\sigma^2}\\right)\\cos\\left(\\frac{\\pi z}{H}\\right),\n$$\nand a constant stratification $N(z) = N_0$. Use a uniform grid in $y$ and $z$ to approximate all required integrals and maxima. Specifically, use $N_y=200$ and $N_z=100$ grid points. Let $\\Delta y = W/(N_y-1)$ and $\\Delta z = H/(N_z-1)$, and approximate the domain integrals by Riemann sums over the grid.\n\nFor each test case, compute:\n\n- The maximum residual overturning transport magnitude for constant-$K$ GM, defined as $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$, expressed in $\\mathrm{m}^3\\mathrm{s}^{-1}$.\n- The maximum residual overturning transport magnitude for the energy-constrained scheme, defined as $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$ with $K=K_{\\mathrm{energy}}$, expressed in $\\mathrm{m}^3\\mathrm{s}^{-1}$.\n- The domain-integrated APE destruction rate for constant-$K$ GM, expressed in $\\mathrm{W}$.\n- The domain-integrated APE destruction rate for the energy-constrained scheme, expressed in $\\mathrm{W}$.\n\nDesign the program to evaluate the following test suite of physically plausible parameter values:\n\n- Case $1$ (general case, moderate stratification and wind power):\n  - $W = 1.0\\times 10^{6}\\ \\mathrm{m}$, $H = 4.0\\times 10^{3}\\ \\mathrm{m}$, $L_x = 2.0\\times 10^{6}\\ \\mathrm{m}$,\n  - $\\rho_0 = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$,\n  - $N_0 = 1.0\\times 10^{-3}\\ \\mathrm{s}^{-1}$,\n  - $s_0 = 1.0\\times 10^{-3}$, $\\sigma = W/4$,\n  - $K_{\\mathrm{const}} = 1.0\\times 10^{3}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$,\n  - $P_w = 5.0\\times 10^{9}\\ \\mathrm{W}$,\n  - $K_{\\max} = 3.0\\times 10^{3}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$.\n- Case $2$ (boundary case, zero wind work):\n  - Same as Case $1$, except $P_w = 0\\ \\mathrm{W}$.\n- Case $3$ (edge case, weak stratification requiring cap by $K_{\\max}$):\n  - Same as Case $1$, except $N_0 = 2.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[\\psi_{\\mathrm{const},1},\\ \\psi_{\\mathrm{energy},1},\\ D_{\\mathrm{const},1},\\ D_{\\mathrm{energy},1},\\ \\psi_{\\mathrm{const},2},\\ \\psi_{\\mathrm{energy},2},\\ D_{\\mathrm{const},2},\\ D_{\\mathrm{energy},2},\\ \\psi_{\\mathrm{const},3},\\ \\psi_{\\mathrm{energy},3},\\ D_{\\mathrm{const},3},\\ D_{\\mathrm{energy},3}],\n$$\nwhere each $\\psi$ is the maximum residual overturning transport in $\\mathrm{m}^3\\mathrm{s}^{-1}$ and each $D$ is the APE destruction rate in $\\mathrm{W}$. No other text should be printed. All angles, if any are introduced, must be in radians. All quantities with physical units must be computed and understood in the units specified above.",
            "solution": "The user has provided a well-posed, scientifically grounded problem in the field of physical oceanography. The request is to derive fundamental expressions related to the Gent–McWilliams (GM) eddy parameterization scheme and then implement them numerically to analyze three test cases. The validation confirms the problem's integrity, and I will proceed with the solution.\n\nThe solution is structured in three parts:\n1.  Derivation of the GM bolus streamfunction, $\\Psi^{\\mathrm{GM}}$.\n2.  Derivation of the domain-integrated Available Potential Energy (APE) destruction rate, $D$.\n3.  Derivation of the energy-constrained thickness diffusivity, $K_{\\mathrm{energy}}$.\nThese derivations will be followed by a summary of the numerical implementation.\n\n### 1. Derivation of the GM Bolus Streamfunction, $\\Psi^{\\mathrm{GM}}$\n\nThe Gent-McWilliams parameterization models the effect of sub-grid-scale eddies as an advection of tracers by an eddy-induced (bolus) velocity field, $\\vec{u}^* = (v^*, w^*)$ in the meridional-vertical $(y,z)$ plane. This velocity field is non-divergent, allowing the definition of a streamfunction, $\\Psi^{\\mathrm{GM}}(y,z)$, such that:\n$$\nv^*(y,z) = -\\frac{\\partial \\Psi^{\\mathrm{GM}}}{\\partial z} \\quad \\text{and} \\quad w^*(y,z) = \\frac{\\partial \\Psi^{\\mathrm{GM}}}{\\partial y}\n$$\nThe physical principle of the GM scheme is that eddies act to flatten isopycnal surfaces, which are surfaces of constant buoyancy $b$. This is parameterized as a diffusion of isopycnal layer thickness. The mathematical representation of this process in Eulerian coordinates yields a direct relationship between the bolus streamfunction $\\Psi^{\\mathrm{GM}}$ and the isopycnal slope $s(y,z)$. The standard formulation is:\n$$\n\\Psi^{\\mathrm{GM}}(y,z) = -K s(y,z)\n$$\nwhere $K$ is the eddy thickness diffusivity, with units of $\\mathrm{m}^2\\mathrm{s}^{-1}$, and $s$ is the dimensionless isopycnal slope, defined as $s(y,z) = \\partial \\eta / \\partial y$, where $\\eta$ is the vertical displacement of an isopycnal.\n\nThe streamfunction $\\Psi^{\\mathrm{GM}}$ has units of $\\mathrm{m}^2\\mathrm{s}^{-1}$, representing volume transport per unit zonal length. For a channel of zonal length $L_x$, the total meridional overturning transport is given by $L_x \\Psi^{\\mathrm{GM}}$, with units of $\\mathrm{m}^3\\mathrm{s}^{-1}$. The problem asks for the maximum magnitude of this quantity, which is $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$.\n\n### 2. Derivation of the APE Destruction Rate, $D$\n\nAvailable Potential Energy (APE) is the portion of potential energy that can be converted into kinetic energy. Eddies can generate or destroy APE. In the GM framework, eddies act to reduce the mean APE by flattening isopycnal slopes. This process is quantified by the rate of work done by eddy buoyancy fluxes.\n\nThe rate of APE generation per unit volume by eddies is given by $\\rho_0 \\overline{w'b'}$, where $\\overline{w'b'}$ is the vertical eddy buoyancy flux. In the GM parameterization, this flux is related to the isopycnal slope $s$ and the background stratification, quantified by the Brunt–Väisälä frequency squared, $N^2 = \\partial b / \\partial z$. The vertical eddy flux of buoyancy is given by:\n$$\n\\overline{w'b'} = -K s^2 N^2\n$$\nThis expression is negative definite (since $K>0$, $N^2 \\ge 0$), indicating that the parameterized eddies always extract energy from the mean state, leading to a destruction of APE. The rate of APE destruction is therefore positive.\n\nThe total domain-integrated APE destruction rate, $D$, is found by integrating the negative of this expression over the entire fluid volume $V$:\n$$\nD = -\\iiint_V \\rho_0 \\overline{w'b'} \\, dV = -\\int_0^{L_x} \\int_0^W \\int_0^H \\rho_0 (-K s^2 N^2) \\, dz \\, dy \\, dx\n$$\nSince the problem is zonally uniform, the integral over $x$ becomes a multiplication by the channel length $L_x$:\n$$\nD = \\rho_0 L_x \\int_0^W \\int_0^H K s(y,z)^2 N(z)^2 \\, dz \\, dy\n$$\nThe units of $D$ are Watts ($\\mathrm{W}$), as required: $(\\mathrm{kg}\\,\\mathrm{m}^{-3}) \\cdot \\mathrm{m} \\cdot (\\mathrm{m}^2\\mathrm{s}^{-1}) \\cdot (\\mathrm{s}^{-2}) \\cdot \\mathrm{m} \\cdot \\mathrm{m} = \\mathrm{kg}\\,\\mathrm{m}^2\\mathrm{s}^{-3} = \\mathrm{J}\\,\\mathrm{s}^{-1}$.\n\n### 3. Derivation of the Energy-Constrained Diffusivity, $K_{\\mathrm{energy}}$\n\nAn energetically consistent parameterization requires that the energy dissipated by parameterized eddies is balanced by the energy supplied to the system. Here, we enforce that the total APE destruction rate $D$ equals the prescribed wind power input $P_w$. We assume the energy-constrained diffusivity, $K_{\\mathrm{energy}}$, is a spatially constant parameter.\n\nSetting $D = P_w$ and using the expression for $D$ from Part 2, with $K = K_{\\mathrm{energy}}$:\n$$\nP_w = \\rho_0 L_x \\int_0^W \\int_0^H K_{\\mathrm{energy}} s(y,z)^2 N(z)^2 \\, dz \\, dy\n$$\nSince $K_{\\mathrm{energy}}$ is constant, it can be factored out of the integral:\n$$\nP_w = K_{\\mathrm{energy}} \\left( \\rho_0 L_x \\int_0^W \\int_0^H s(y,z)^2 N(z)^2 \\, dz \\, dy \\right)\n$$\nSolving for $K_{\\mathrm{energy}}$ gives the unconstrained value:\n$$\nK_{\\mathrm{energy}}^\\text{unconstrained} = \\frac{P_w}{\\rho_0 L_x \\int_0^W \\int_0^H s(y,z)^2 N(z)^2 \\, dz \\, dy}\n$$\nThis value must be constrained by a physically plausible upper bound, $K_{\\max}$, as diffusivity cannot be arbitrarily large. The final expression for $K_{\\mathrm{energy}}$ is therefore:\n$$\nK_{\\mathrm{energy}} = \\min\\left(K_{\\max}, K_{\\mathrm{energy}}^\\text{unconstrained}\\right)\n$$\nIf $P_w=0$, this correctly yields $K_{\\mathrm{energy}}=0$. If the stratification $N$ is very weak, the denominator becomes small, leading to a large $K_{\\mathrm{energy}}^\\text{unconstrained}$ that will be capped by $K_{\\max}$.\n\n### Numerical Implementation\n\nThe derived expressions are implemented numerically.\n1.  A uniform two-dimensional grid for $(y,z)$ is constructed with $N_y=200$ and $N_z=100$ points, with grid spacings $\\Delta y = W/(N_y-1)$ and $\\Delta z = H/(N_z-1)$.\n2.  The isopycnal slope field $s(y,z)$ and the stratification field $N^2(z)$ are evaluated at each grid point.\n3.  For the constant-$K$ scheme, $\\Psi^{\\mathrm{GM}}$ is computed as $-K_{\\mathrm{const}}s$. The maximum transport $\\psi_{\\mathrm{const}}$ is found by taking the maximum absolute value of $L_x \\Psi^{\\mathrm{GM}}$ over the grid. The APE destruction $D_{\\mathrm{const}}$ is computed by a Riemann sum of $\\rho_0 L_x K_{\\mathrm{const}} s^2 N^2$ over the grid cells.\n4.  For the energy-constrained scheme, the integral $I_s = \\rho_0 L_x \\iint s^2 N^2 \\, dy \\, dz$ is computed via a Riemann sum. Then $K_{\\mathrm{energy}}$ is calculated using the derived formula with the given $P_w$ and $K_{\\max}$.\n5.  With the calculated $K_{\\mathrm{energy}}$, the maximum transport $\\psi_{\\mathrm{energy}}$ and APE destruction $D_{\\mathrm{energy}}$ are computed using the same methods as in the constant-$K$ case, but substituting $K_{\\mathrm{const}}$ with $K_{\\mathrm{energy}}$.\n6.  This procedure is repeated for all three test cases, and the results are collected and formatted as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Gent-McWilliams parameterization problem for three test cases.\n    \"\"\"\n    # Grid parameters\n    Ny, Nz = 200, 100\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            # Case 1: General case\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 1.0e-3,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 5.0e9,\n            \"K_max\": 3.0e3\n        },\n        {\n            # Case 2: Zero wind work\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 1.0e-3,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 0.0,\n            \"K_max\": 3.0e3\n        },\n        {\n            # Case 3: Weak stratification\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 2.0e-4,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 5.0e9,\n            \"K_max\": 3.0e3\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current case\n        W = case[\"W\"]\n        H = case[\"H\"]\n        Lx = case[\"Lx\"]\n        rho0 = case[\"rho0\"]\n        N0 = case[\"N0\"]\n        s0 = case[\"s0\"]\n        sigma = W / 4.0\n        K_const = case[\"K_const\"]\n        Pw = case[\"Pw\"]\n        K_max = case[\"K_max\"]\n\n        # Setup grid\n        dy = W / (Ny - 1)\n        dz = H / (Nz - 1)\n        y_vec = np.linspace(0, W, Ny)\n        z_vec = np.linspace(0, H, Nz)\n        Y, Z = np.meshgrid(y_vec, z_vec, indexing='ij')\n\n        # Calculate physical fields on the grid\n        N2 = N0**2\n        S = s0 * np.exp(-((Y - W / 2.0)**2) / (2.0 * sigma**2)) * np.cos(np.pi * Z / H)\n\n        # --- Constant-K GM Scheme Calculations ---\n        \n        # 1. Residual overturning streamfunction\n        Psi_gm_const = -K_const * S\n        \n        # 2. Maximum residual overturning transport magnitude\n        psi_const = Lx * np.max(np.abs(Psi_gm_const))\n        \n        # 3. Domain-integrated APE destruction rate\n        integrand_D_const = rho0 * K_const * S**2 * N2\n        # Riemann sum for the integral\n        D_const = Lx * np.sum(integrand_D_const) * dy * dz\n        \n        # --- Energy-Constrained GM Scheme Calculations ---\n        \n        # 1. Calculate the integral part of the K_energy denominator\n        integrand_K_denom = rho0 * S**2 * N2\n        Is = Lx * np.sum(integrand_K_denom) * dy * dz\n        \n        # 2. Calculate energy-constrained diffusivity K_energy\n        if Is > 1e-9: # Avoid division by zero, though not expected here\n            K_energy_unconstrained = Pw / Is\n        else:\n            K_energy_unconstrained = 0.0 if Pw == 0.0 else np.inf\n            \n        K_energy = min(K_max, K_energy_unconstrained)\n        \n        # 3. Residual overturning streamfunction for the energy-constrained case\n        Psi_gm_energy = -K_energy * S\n        \n        # 4. Maximum residual overturning transport magnitude\n        psi_energy = Lx * np.max(np.abs(Psi_gm_energy))\n        \n        # 5. Domain-integrated APE destruction rate\n        # D_energy = K_energy * Is by definition\n        D_energy = K_energy * Is\n\n        results.extend([psi_const, psi_energy, D_const, D_energy])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}