{
    "hands_on_practices": [
        {
            "introduction": "理解 Gent-McWilliams (GM) 参数化的第一步是量化其作用的几何表面——等密度面。本练习通过海洋的基本属性（层结和侧向浮力梯度）直接计算等密度面斜率，从而为参数化方案奠定几何基础。通过这个练习，你将把等密度面斜率的抽象概念与可测量的物理量联系起来。",
            "id": "3793909",
            "problem": "在 Gent-McWilliams (GM) 涡旋参数化方案中，中尺度涡旋效应被表示为沿等浮力面的平流输运，在 Boussinesq 框架下，这通常被称为等密面。考虑一个稳定分层的海洋内部，其中浮力场 $b(x,y,z)$ 是光滑的，并通过垂直梯度 $N^{2} \\equiv \\partial_{z} b$ 定义浮力频率的平方 $N^{2}$。一个等密（恒定浮力）面的特征是其微分位移 $(\\mathrm{d}x,\\mathrm{d}y,\\mathrm{d}z)$ 满足 $\\mathrm{d}b = 0$。$x$ 方向的等密面斜率定义为 $s_{x} \\equiv \\left(\\partial z / \\partial x\\right)_{b}$，即沿等浮力面，深度随水平距离变化的速率。\n\n假设一个与稳定分层一致的局部线性浮力结构，由 $b(z) = N^{2} z$ 给出，其中常数 $N^{2} > 0$，以及一个均匀的侧向浮力梯度 $\\partial_{x} b = \\alpha$，其中 $\\alpha$ 是一个给定的常数。仅使用等密面是 $b$ 为常数的曲面这一定义和标准的多变量微积分，推导等密面斜率 $s_{x}$（用 $\\alpha$ 和 $N^{2}$ 表示）。然后，根据你推导的表达式，解释 $s_{x}$ 的符号如何依赖于 $\\alpha$ 的符号，并评论在稳定分层流中 $|s_{x}|$ 相对于 $|\\alpha|$ 和 $N^{2}$ 的量级。将 $s_{x}$ 的最终答案表示为关于 $\\alpha$ 和 $N^{2}$ 的单个闭式解析表达式。无需进行数值计算；最终表达式中不应包含单位。",
            "solution": "推导从等密面的基本定义开始，即浮力 $b$ 为常数的曲面。对于一个依赖于空间坐标 $b(x, y, z)$ 的浮力场，一个等密面由方程 $b(x, y, z) = C$ 描述，其中 $C$ 是一个常数。\n\n浮力的微分变化 $\\mathrm{d}b$ 可以用全导数表示：\n$$\n\\mathrm{d}b = \\frac{\\partial b}{\\partial x} \\mathrm{d}x + \\frac{\\partial b}{\\partial y} \\mathrm{d}y + \\frac{\\partial b}{\\partial z} \\mathrm{d}z\n$$\n沿等密面，根据定义，浮力是恒定的，这意味着其全微分为零：\n$$\n\\mathrm{d}b = 0\n$$\n问题将 $x$ 方向的等密面斜率 $s_x$ 定义为 $s_x \\equiv (\\partial z / \\partial x)_b$。这表示在保持在恒定浮力 $b$ 的曲面上的约束下，深度 $z$ 相对于水平位置 $x$ 的变化。为了找到这个量，我们通过设置 $\\mathrm{d}y = 0$ 来只考虑 $x$-$z$ 平面内的位移。那么条件 $\\mathrm{d}b = 0$ 简化为：\n$$\n\\frac{\\partial b}{\\partial x} \\mathrm{d}x + \\frac{\\partial b}{\\partial z} \\mathrm{d}z = 0\n$$\n这个方程关联了为保持在等密面上所需的微分位移 $\\mathrm{d}x$ 和 $\\mathrm{d}z$。我们可以重新整理这个方程来求出沿此曲面的斜率 $\\mathrm{d}z/\\mathrm{d}x$。\n$$\n\\frac{\\partial b}{\\partial z} \\mathrm{d}z = - \\frac{\\partial b}{\\partial x} \\mathrm{d}x\n$$\n假设 $\\partial b / \\partial z \\neq 0$，这由稳定分层条件 $N^2 > 0$ 保证，我们可以两边除以 $\\mathrm{d}x$ 和 $\\partial b / \\partial z$ 来得到斜率：\n$$\n\\frac{\\mathrm{d}z}{\\mathrm{d}x} = - \\frac{\\partial b / \\partial x}{\\partial b / \\partial z}\n$$\n这个在 $x$-$z$ 平面上沿 $b$ 为常数的曲线的斜率表达式，恰好是保持 $b$ 恒定时 $z$ 对 $x$ 的偏导数的定义。因此，我们有：\n$$\ns_x = \\left(\\frac{\\partial z}{\\partial x}\\right)_{b} = - \\frac{\\partial b / \\partial x}{\\partial b / \\partial z}\n$$\n问题提供了评估此表达式所需的必要分量。$x$ 方向的均匀侧向浮力梯度由以下给出：\n$$\n\\frac{\\partial b}{\\partial x} = \\alpha\n$$\n浮力频率的平方，作为垂直分层的量度，其定义和给定值为：\n$$\nN^2 \\equiv \\frac{\\partial b}{\\partial z}\n$$\n问题指出 $N^2$ 是一个正常数，这与稳定分层的假设一致。将这些给定的量代入 $s_x$ 的表达式，得到最终结果：\n$$\ns_x = - \\frac{\\alpha}{N^2}\n$$\n这个表达式给出了用给定常数 $\\alpha$ 和 $N^2$ 表示的等密面斜率 $s_x$。\n\n基于这个推导出的表达式，我们可以分析斜率的性质：\n\n1.  **$s_x$ 的符号**：问题明确指出分层是稳定的，这意味着 $N^2 > 0$。因此，等密面斜率 $s_x$ 的符号完全由侧向浮力梯度 $\\alpha$ 的符号决定。具体来说，$s_x$ 的符号与 $\\alpha$ 相反。\n    *   如果 $\\alpha > 0$，意味着浮力在正 $x$ 方向上增加（例如，水变得更不密集），那么 $s_x  0$。这表明当向正 $x$ 方向移动时，等密面是向下倾斜的。要保持在恒定浮力面上，必须移动到更深的深度（如果 $z$ 向上为正，则 $z$ 值更负），那里的背景浮力较低，以补偿侧向梯度带来的增加。\n    *   如果 $\\alpha  0$，意味着浮力在正 $x$ 方向上减小，那么 $s_x  0$。这表明当向正 $x$ 方向移动时，等密面是向上倾斜的。\n\n2.  **$|s_x|$ 的量级**：斜率的量级由 $|s_x| = \\frac{|\\alpha|}{N^2}$ 给出。\n    *   斜率的量级与侧向浮力梯度的量级 $|\\alpha|$ 成正比。更强的水平浮力差异需要更陡的斜率来维持恒定的浮力值。\n    *   斜率的量级与浮力频率的平方 $N^2$ 成反比。较大的 $N^2$ 表示更强的垂直分层，意味着浮力随深度的变化更快。在这种流体中，需要较小的垂直位移来抵消给定的水平浮力变化，从而导致一个更平缓（不那么陡峭）的等密面斜率。在典型的海洋条件下，水平浮力梯度的量级远小于垂直分层，即 $|\\alpha| \\ll N^2$。因此，等密面斜率 $|s_x|$ 通常非常小，大约在 $10^{-4}$ 到 $10^{-2}$ 的数量级，这表明等密面几乎是水平的。",
            "answer": "$$\n\\boxed{-\\frac{\\alpha}{N^{2}}}\n$$"
        },
        {
            "introduction": "定义了斜率之后，下一步是理解这种几何结构如何驱动输运。本练习揭示了连续框架中涡致平流速度与分层模型中厚度扩散概念之间的根本联系。通过在一个简化的双层系统中证明它们的等价性，本练习阐明了 GM 方案中一个核心且常常令人困惑的方面。",
            "id": "3793911",
            "problem": "考虑一个位于常数科里奥利参数平面（f平面）上的双层海洋，其中第 $1$ 层的平均厚度为 $H_{1}$，第 $2$ 层的平均厚度为 $H_{2}$。两层由一个物质界面隔开，该界面相对于其平均深度的位移被指定为一个仅随经向坐标 $y$ 变化的正弦函数，其形式为\n$$\n\\eta(y) = A \\sin(k y),\n$$\n其中 $A$ 和 $k$ 是正常数，且 $A \\ll H_{1}, H_{2}$，因此小斜率近似是有效的。因此，层厚度分别为 $h_{1}(y) = H_{1} + \\eta(y)$ 和 $h_{2}(y) = H_{2} - \\eta(y)$。假设没有平均流，也没有外力强迫。\n\n采用 Gent-McWilliams 涡旋参数化方案 (Gent-McWilliams (GM))，其中等密度面扩散系数 $\\kappa  0$ 为常数。在连续（z坐标）描述中，涡致水平速度场 $\\boldsymbol{u}^{\\ast}_{h}(x,y,z)$ 通过基本的 GM 关系式由等密度面斜率向量 $\\boldsymbol{s}(x,y,z)$ 定义\n$$\n\\boldsymbol{u}^{\\ast}_{h} = -\\frac{\\partial}{\\partial z}\\!\\left(\\kappa\\,\\boldsymbol{s}\\right),\n$$\n在小斜率和双层假设下，等密度面斜率向量集中在界面处，并等于界面位移的水平梯度，\n$$\n\\boldsymbol{s}(x,y,z) = \\nabla_{h}\\eta(y)\\,\\delta\\!\\left(z-z_{\\mathrm{int}}\\right),\n$$\n其中 $z_{\\mathrm{int}}$ 是平均界面深度，$\\delta(\\cdot)$ 是狄拉克δ函数。你可以假设斜率在边界处（顶部和底部）为零（$\\boldsymbol{s}= \\boldsymbol{0}$），并且 $\\kappa$ 在垂直方向上是均匀的。\n\n从这些基础出发，利用厚度连续性，通过对第 $1$ 层垂直平均 $\\boldsymbol{u}^{\\ast}_{h}$ 来推导第 $1$ 层的厚度加权团块输运向量 $\\boldsymbol{q}_{1} \\equiv h_{1}\\,\\boldsymbol{u}^{\\ast}_{1,h}$。然后，独立地，构建第 $1$ 层的顺梯度厚度扩散通量\n$$\n\\boldsymbol{F}_{1} \\equiv -\\kappa\\,\\nabla_{h} h_{1},\n$$\n这是由质量连续性和等密度面扩散系数闭合方案所驱动的。\n\n对于给定的正弦函数 $\\eta(y)$，计算 $\\nabla_{h}\\!\\cdot \\boldsymbol{q}_{1}$ 和 $\\nabla_{h}\\!\\cdot \\boldsymbol{F}_{1}$，并证明它们是关于 $y$ 的相同函数。将这个共同的解析表达式作为你的最终答案。最终量以米/秒为单位表示，但不要在方框表达式中包含单位。不需要进行数值代入；请提供用 $\\kappa$、$A$、$k$ 和 $y$ 表示的封闭形式表达式。最终答案必须是单一的解析表达式。",
            "solution": "令 $\\boldsymbol{\\nabla}_{h} = \\left(\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\right)$ 为水平梯度算子，$\\boldsymbol{\\nabla}_{h} \\cdot$ 为水平散度算子。水平拉普拉斯算子为 $\\boldsymbol{\\nabla}_{h}^{2} = \\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{\\nabla}_{h}$。\n\n首先，我们推导团块输运向量的散度表达式，即 $\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{q}_{1}$。\n\n问题将第 $1$ 层的厚度加权团块输运向量定义为 $\\boldsymbol{q}_{1} \\equiv h_{1}\\,\\boldsymbol{u}^{\\ast}_{1,h}$，其中 $\\boldsymbol{u}^{\\ast}_{1,h}$ 是涡致水平速度场 $\\boldsymbol{u}^{\\ast}_{h}$ 在第 $1$ 层上的垂直平均值。\n$$\n\\boldsymbol{u}^{\\ast}_{1,h} = \\frac{1}{h_{1}} \\int_{\\text{layer 1}} \\boldsymbol{u}^{\\ast}_{h} \\,dz\n$$\n因此，团块输运向量是涡致速度在该层上的垂直积分：\n$$\n\\boldsymbol{q}_{1} = h_{1} \\left( \\frac{1}{h_{1}} \\int_{\\text{layer 1}} \\boldsymbol{u}^{\\ast}_{h} \\,dz \\right) = \\int_{\\text{layer 1}} \\boldsymbol{u}^{\\ast}_{h} \\,dz\n$$\n涡致速度由基本的 GM 关系式 $\\boldsymbol{u}^{\\ast}_{h} = -\\frac{\\partial}{\\partial z}(\\kappa\\,\\boldsymbol{s})$ 给出，其中等密度面扩散系数 $\\kappa$ 是一个正常数。将此代入 $\\boldsymbol{q}_{1}$ 的积分中：\n$$\n\\boldsymbol{q}_{1} = \\int_{z_b}^{z_t} \\left(-\\kappa \\frac{\\partial \\boldsymbol{s}}{\\partial z}\\right) dz\n$$\n其中 $z_b$ 和 $z_t$ 分别是第 $1$ 层的底部和顶部边界的垂直坐标。根据微积分基本定理，该积分计算结果为：\n$$\n\\boldsymbol{q}_{1} = -\\kappa [\\boldsymbol{s}]_{z_b}^{z_t} = -\\kappa(\\boldsymbol{s}(z_t) - \\boldsymbol{s}(z_b)) = \\kappa(\\boldsymbol{s}(z_b) - \\boldsymbol{s}(z_t))\n$$\n问题指定了层厚度为 $h_{1}(y) = H_{1} + \\eta(y)$ 和 $h_{2}(y) = H_{2} - \\eta(y)$。总厚度是恒定的：$h_1 + h_2 = H_1 + H_2$。界面的向上位移（由 $\\eta  0$ 表示）使第 $1$ 层变厚，第 $2$ 层变薄。在 $z$ 向上增加的标准垂直坐标系中，这意味着第1层必定是下层，第2层是上层。\n因此，对于第 $1$ 层，其底部边界是海底，$z_b = z_{\\mathrm{bottom}}$，顶部边界是界面，$z_t = z_{\\mathrm{int}}$。\n$$\n\\boldsymbol{q}_{1} = \\kappa(\\boldsymbol{s}(z_{\\mathrm{bottom}}) - \\boldsymbol{s}(z_{\\mathrm{int}}))\n$$\n问题指出，斜率在物理边界处为零，因此 $\\boldsymbol{s}(z_{\\mathrm{bottom}}) = \\boldsymbol{0}$。$\\boldsymbol{q}_{1}$ 的表达式简化为：\n$$\n\\boldsymbol{q}_{1} = -\\kappa\\,\\boldsymbol{s}(z_{\\mathrm{int}})\n$$\n问题提供了斜率向量作为一个集中在界面上的分布：$\\boldsymbol{s}(x,y,z) = \\boldsymbol{\\nabla}_{h}\\eta(y)\\,\\delta(z-z_{\\mathrm{int}})$。因此，界面的物理斜率为 $\\boldsymbol{s}_{\\mathrm{int}} = \\boldsymbol{\\nabla}_{h}\\eta(y)$。将此代入 $\\boldsymbol{q}_{1}$ 的表达式中：\n$$\n\\boldsymbol{q}_{1} = -\\kappa\\,\\boldsymbol{\\nabla}_{h}\\eta(y)\n$$\n现在我们计算 $\\boldsymbol{q}_{1}$ 的散度：\n$$\n\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{q}_{1} = \\boldsymbol{\\nabla}_{h} \\cdot (-\\kappa\\,\\boldsymbol{\\nabla}_{h}\\eta(y)) = -\\kappa\\,\\boldsymbol{\\nabla}_{h}^{2}\\eta(y)\n$$\n给定 $\\eta(y) = A \\sin(ky)$，其水平拉普拉斯算子为：\n$$\n\\boldsymbol{\\nabla}_{h}^{2}\\eta(y) = \\frac{\\partial^2}{\\partial x^2}(A \\sin(ky)) + \\frac{\\partial^2}{\\partial y^2}(A \\sin(ky)) = 0 + \\frac{d}{dy}(A k \\cos(ky)) = -A k^2 \\sin(ky)\n$$\n将其代回，我们得到团块输运的散度：\n$$\n\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{q}_{1} = -\\kappa(-A k^2 \\sin(ky)) = \\kappa A k^2 \\sin(ky)\n$$\n\n接下来，我们推导顺梯度厚度扩散通量的散度表达式，即 $\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{F}_{1}$。\n\n通量定义为 $\\boldsymbol{F}_{1} \\equiv -\\kappa\\,\\boldsymbol{\\nabla}_{h} h_{1}$。\n层厚度由 $h_{1}(y) = H_{1} + \\eta(y)$ 给出，其中 $H_{1}$ 是一个常数。厚度的梯度为：\n$$\n\\boldsymbol{\\nabla}_{h}h_{1} = \\boldsymbol{\\nabla}_{h}(H_{1} + \\eta(y)) = \\boldsymbol{\\nabla}_{h}\\eta(y)\n$$\n将此代入 $\\boldsymbol{F}_{1}$ 的定义中：\n$$\n\\boldsymbol{F}_{1} = -\\kappa\\,\\boldsymbol{\\nabla}_{h}\\eta(y)\n$$\n我们观察到 $\\boldsymbol{F}_{1}$ 与之前推导的 $\\boldsymbol{q}_{1}$ 相同。因此，它们的散度也必须相同。让我们明确计算以进行确认：\n$$\n\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{F}_{1} = \\boldsymbol{\\nabla}_{h} \\cdot (-\\kappa\\,\\boldsymbol{\\nabla}_{h}\\eta(y)) = -\\kappa\\,\\boldsymbol{\\nabla}_{h}^{2}\\eta(y)\n$$\n使用 $\\eta(y)$ 的拉普拉斯算子的相同结果：\n$$\n\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{F}_{1} = -\\kappa(-A k^2 \\sin(ky)) = \\kappa A k^2 \\sin(ky)\n$$\n两次计算得到相同的结果，证明了 $\\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{q}_{1} = \\boldsymbol{\\nabla}_{h} \\cdot \\boldsymbol{F}_{1}$。这种等效性显示了连续公式中的团块输运如何对应于分层模型中的厚度扩散。\n\n共同的解析表达式是 $\\kappa A k^2 \\sin(ky)$。\n单位为米/秒，这对于厚度趋势（层厚度的变化率）是正确的。",
            "answer": "$$\\boxed{\\kappa A k^{2} \\sin(ky)}$$"
        },
        {
            "introduction": "超越基本机制，GM 参数化的现代应用旨在实现更强的物理一致性。这项基于代码的高级练习要求你比较标准的常数扩散系数 GM 方案与一个受海洋能量收支约束的更复杂变体。这项练习不仅综合了理论概念，还提供了在气候模型中实施和评估参数化方案的实践经验。",
            "id": "3793967",
            "problem": "考虑一个纬向周期、Boussinesq、静力的海洋通道，其经向坐标为 $y \\in [0,W]$，垂直坐标为 $z \\in [0,H]$，纬向长度为 $L_x$。Gent-McWilliams 涡旋参数化 (Gent-McWilliams (GM)) 通过涡致（团块）输运来表示未解析的涡旋效应，该输运作用是沿等密面平流示踪物。在转换欧拉平均框架中，剩余翻转流函数 $\\Psi^{\\mathrm{res}}(y,z)$ 等于欧拉平均流函数 $\\Psi^{\\mathrm{E}}(y,z)$ 和 GM 涡致流函数 $\\Psi^{\\mathrm{GM}}(y,z)$ 之和。假设 $\\Psi^{\\mathrm{E}}(y,z)=0$，因此 $\\Psi^{\\mathrm{res}}(y,z)=\\Psi^{\\mathrm{GM}}(y,z)$。\n\n您将比较标准的厚度扩散系数恒定的 GM 方案与一个变体方案，在该变体方案中，厚度扩散系数受预设的能量收支约束。该比较必须基于第一性原理。仅从以下基本依据和核心定义开始：\n\n- Boussinesq 浮力为 $b = -g \\rho' / \\rho_0$，其中 $g$ 是重力加速度，$\\rho'$ 是密度扰动，$\\rho_0$ 是一个常数参考密度。\n- Brunt–Väisälä 频率满足 $N^2 = \\partial b / \\partial z$。\n- 经向上的等密面坡度为 $s(y,z) = \\partial \\eta(y,z) / \\partial y$，其中 $\\eta(y,z)$ 是等密面相对于平坦参考面的位移。\n- 小位移情况下的有效位能（APE）密度为 $e_p = \\tfrac{1}{2} \\rho_0 N^2 \\eta^2$。\n- GM 中的涡致团块输运由一个流函数 $\\Psi^{\\mathrm{GM}}(y,z)$ 表示，其大小必须根据示踪物平流-扩散方程和等密面几何形状推导得出，以确保量纲一致性并与厚度扩散系数的作用相符。\n\n使用这些依据，推导：\n\n1.  在二维 $(y,z)$ 配置下，用厚度扩散系数 $K$ 和等密面坡度场 $s(y,z)$ 表示的、量纲一致的 GM 涡致流函数 $\\Psi^{\\mathrm{GM}}(y,z)$ 表达式，并将沿纬向积分的总经向翻转量级定义为单位为 $\\mathrm{m}^3\\mathrm{s}^{-1}$ 的输运。\n\n2.  由 GM 涡致输运引起的、在区域上积分的 APE 耗散率的表达式，用 $K$、$N^2$ 和 $s$ 表示，单位为 $\\mathrm{W}$。\n\n3.  一个能量约束的厚度扩散系数 $K_{\\mathrm{energy}}$，通过强制 GM 引起的 APE 耗散率等于预设的风功输入 $P_w$ 来获得，并受上限 $K_{\\max}$ 的约束，因此 $K_{\\mathrm{energy}} = \\min\\left(K_{\\max}, \\text{从能量约束中推导出的值}\\right)$。\n\n然后在一个纬向通道中对这些表达式进行数值实现，该通道具有给定的、稳态的等密面坡度场\n$$\ns(y,z) = s_0 \\exp\\left(-\\frac{(y - W/2)^2}{2 \\sigma^2}\\right)\\cos\\left(\\frac{\\pi z}{H}\\right),\n$$\n和一个恒定的层化 $N(z) = N_0$。在 $y$ 和 $z$ 方向上使用均匀网格来近似所有需要的积分和最大值。具体来说，使用 $N_y=200$ 和 $N_z=100$ 个网格点。设 $\\Delta y = W/(N_y-1)$ 和 $\\Delta z = H/(N_z-1)$，并通过网格上的黎曼和来近似区域积分。\n\n对每个测试案例，计算：\n\n- 恒定 $K$ 值 GM 方案的最大剩余翻转输运量级，定义为 $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$，以 $\\mathrm{m}^3\\mathrm{s}^{-1}$ 为单位表示。\n- 能量约束方案的最大剩余翻转输运量级，定义为 $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$，其中 $K=K_{\\mathrm{energy}}$，以 $\\mathrm{m}^3\\mathrm{s}^{-1}$ 为单位表示。\n- 恒定 $K$ 值 GM 方案的区域积分 APE 耗散率，以 $\\mathrm{W}$ 为单位表示。\n- 能量约束方案的区域积分 APE 耗散率，以 $\\mathrm{W}$ 为单位表示。\n\n设计程序以评估以下物理上合理的参数值测试套件：\n\n- 情况 1（一般情况，中等层化和风功率）：\n  - $W = 1.0\\times 10^{6}\\ \\mathrm{m}$, $H = 4.0\\times 10^{3}\\ \\mathrm{m}$, $L_x = 2.0\\times 10^{6}\\ \\mathrm{m}$,\n  - $\\rho_0 = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$,\n  - $N_0 = 1.0\\times 10^{-3}\\ \\mathrm{s}^{-1}$,\n  - $s_0 = 1.0\\times 10^{-3}$, $\\sigma = W/4$,\n  - $K_{\\mathrm{const}} = 1.0\\times 10^{3}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$,\n  - $P_w = 5.0\\times 10^{9}\\ \\mathrm{W}$,\n  - $K_{\\max} = 3.0\\times 10^{3}\\ \\mathrm{m}^2\\ \\mathrm{s}^{-1}$。\n- 情况 2（边界情况，零风功）：\n  - 与情况 1 相同，除了 $P_w = 0\\ \\mathrm{W}$。\n- 情况 3（极端情况，弱层化导致需要由 $K_{\\max}$ 限制）：\n  - 与情况 1 相同，除了 $N_0 = 2.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序如下\n$$\n[\\psi_{\\mathrm{const},1},\\ \\psi_{\\mathrm{energy},1},\\ D_{\\mathrm{const},1},\\ D_{\\mathrm{energy},1},\\ \\psi_{\\mathrm{const},2},\\ \\psi_{\\mathrm{energy},2},\\ D_{\\mathrm{const},2},\\ D_{\\mathrm{energy},2},\\ \\psi_{\\mathrm{const},3},\\ \\psi_{\\mathrm{energy},3},\\ D_{\\mathrm{const},3},\\ D_{\\mathrm{energy},3}],\n$$\n其中每个 $\\psi$ 是以 $\\mathrm{m}^3\\mathrm{s}^{-1}$ 为单位的最大剩余翻转输运，每个 $D$ 是以 $\\mathrm{W}$ 为单位的 APE 耗散率。不应打印任何其他文本。所有角度（如果引入）必须以弧度为单位。所有带物理单位的量都必须以上述指定单位进行计算和理解。",
            "solution": "### 1. GM 涡致流函数 $\\Psi^{\\mathrm{GM}}$ 的推导\n\nGent-McWilliams 参数化将次网格尺度涡旋的效应建模为示踪物被一个涡致（团块）速度场 $\\vec{u}^* = (v^*, w^*)$ 在经向-垂直 $(y,z)$ 平面上的平流。该速度场是无辐散的，因此可以定义一个流函数 $\\Psi^{\\mathrm{GM}}(y,z)$，使得：\n$$\nv^*(y,z) = -\\frac{\\partial \\Psi^{\\mathrm{GM}}}{\\partial z} \\quad \\text{和} \\quad w^*(y,z) = \\frac{\\partial \\Psi^{\\mathrm{GM}}}{\\partial y}\n$$\nGM 方案的物理原理是涡旋作用于使等密面（即等浮力 $b$ 面）变平。这被参数化为等密层厚度的扩散。此过程在欧拉坐标系中的数学表示，得出了涡致流函数 $\\Psi^{\\mathrm{GM}}$ 与等密面坡度 $s(y,z)$ 之间的直接关系。标准公式为：\n$$\n\\Psi^{\\mathrm{GM}}(y,z) = -K s(y,z)\n$$\n其中 $K$ 是涡旋厚度扩散系数，单位为 $\\mathrm{m}^2\\mathrm{s}^{-1}$，$s$ 是无量纲的等密面坡度，定义为 $s(y,z) = \\partial \\eta / \\partial y$，其中 $\\eta$ 是等密面的垂直位移。\n\n流函数 $\\Psi^{\\mathrm{GM}}$ 的单位是 $\\mathrm{m}^2\\mathrm{s}^{-1}$，表示单位纬向长度的体积输运。对于一个纬向长度为 $L_x$ 的通道，总经向翻转输运由 $L_x \\Psi^{\\mathrm{GM}}$ 给出，单位为 $\\mathrm{m}^3\\mathrm{s}^{-1}$。问题要求的是该量的最大量级，即 $L_x \\max_{y,z} \\left|\\Psi^{\\mathrm{GM}}(y,z)\\right|$。\n\n### 2. APE 耗散率 $D$ 的推导\n\n有效位能 (APE) 是可以转化为动能的那部分位能。涡旋可以产生或耗散 APE。在 GM 框架中，涡旋通过使等密面坡度变平来减少平均 APE。这个过程通过涡旋浮力通量所做的功的速率来量化。\n\n涡旋引起的单位体积 APE 生成速率由 $\\rho_0 \\overline{w'b'}$ 给出，其中 $\\overline{w'b'}$ 是垂直涡旋浮力通量。在 GM 参数化中，此通量与等密面坡度 $s$ 和背景层化有关，后者由 Brunt–Väisälä 频率的平方 $N^2 = \\partial b / \\partial z$ 来量化。浮力的垂直涡旋通量由下式给出：\n$$\n\\overline{w'b'} = -K s^2 N^2\n$$\n该表达式是负定的（因为 $K0$, $N^2 \\ge 0$），表明参数化的涡旋总是从平均态中提取能量，导致 APE 的耗散。因此，APE 的耗散率是正的。\n\n总的区域积分 APE 耗散率 $D$，是通过在整个流体体积 $V$ 上对此表达式的负值进行积分得到的：\n$$\nD = -\\iiint_V \\rho_0 \\overline{w'b'} \\, dV = -\\int_0^{L_x} \\int_0^W \\int_0^H \\rho_0 (-K s^2 N^2) \\, dz \\, dy \\, dx\n$$\n由于问题在纬向上是均匀的，对 $x$ 的积分变成了乘以通道长度 $L_x$：\n$$\nD = \\rho_0 L_x \\int_0^W \\int_0^H K s(y,z)^2 N(z)^2 \\, dz \\, dy\n$$\n$D$ 的单位是瓦特 ($\\mathrm{W}$)，符合要求：$(\\mathrm{kg}\\,\\mathrm{m}^{-3}) \\cdot \\mathrm{m} \\cdot (\\mathrm{m}^2\\mathrm{s}^{-1}) \\cdot (\\mathrm{s}^{-2}) \\cdot \\mathrm{m} \\cdot \\mathrm{m} = \\mathrm{kg}\\,\\mathrm{m}^2\\mathrm{s}^{-3} = \\mathrm{J}\\,\\mathrm{s}^{-1}$。\n\n### 3. 能量约束扩散系数 $K_{\\mathrm{energy}}$ 的推导\n\n一个能量上一致的参数化方案要求，由参数化涡旋耗散的能量与供给系统的能量相平衡。在这里，我们强制总 APE 耗散率 $D$ 等于预设的风功输入 $P_w$。我们假设能量约束的扩散系数 $K_{\\mathrm{energy}}$ 是一个空间常数。\n\n设 $D = P_w$，并使用第 2 部分中 $D$ 的表达式，其中 $K = K_{\\mathrm{energy}}$：\n$$\nP_w = \\rho_0 L_x \\int_0^W \\int_0^H K_{\\mathrm{energy}} s(y,z)^2 N(z)^2 \\, dz \\, dy\n$$\n由于 $K_{\\mathrm{energy}}$ 是常数，可以从积分中提出：\n$$\nP_w = K_{\\mathrm{energy}} \\left( \\rho_0 L_x \\int_0^W \\int_0^H s(y,z)^2 N(z)^2 \\, dz \\, dy \\right)\n$$\n解出 $K_{\\mathrm{energy}}$ 得到无约束的值：\n$$\nK_{\\mathrm{energy}}^\\text{unconstrained} = \\frac{P_w}{\\rho_0 L_x \\int_0^W \\int_0^H s(y,z)^2 N(z)^2 \\, dz \\, dy}\n$$\n这个值必须受到一个物理上合理的上限 $K_{\\max}$ 的约束，因为扩散系数不能任意大。因此，$K_{\\mathrm{energy}}$ 的最终表达式为：\n$$\nK_{\\mathrm{energy}} = \\min\\left(K_{\\max}, K_{\\mathrm{energy}}^\\text{unconstrained}\\right)\n$$\n如果 $P_w=0$，这将正确地得出 $K_{\\mathrm{energy}}=0$。如果层化 $N$ 非常弱，分母会变小，导致一个大的 $K_{\\mathrm{energy}}^\\text{unconstrained}$，它将被 $K_{\\max}$ 封顶。\n\n### 数值实现\n\n推导出的表达式将进行数值实现。\n1.  为 $(y,z)$ 构建一个具有 $N_y=200$ 和 $N_z=100$ 个点的均匀二维网格，网格间距为 $\\Delta y = W/(N_y-1)$ 和 $\\Delta z = H/(N_z-1)$。\n2.  在每个网格点上评估等密面坡度场 $s(y,z)$ 和层化场 $N^2(z)$。\n3.  对于恒定 $K$ 方案，$\\Psi^{\\mathrm{GM}}$ 计算为 $-K_{\\mathrm{const}}s$。最大输运 $\\psi_{\\mathrm{const}}$ 通过取 $L_x \\Psi^{\\mathrm{GM}}$ 在网格上的最大绝对值来找到。APE 耗散 $D_{\\mathrm{const}}$ 通过对 $\\rho_0 L_x K_{\\mathrm{const}} s^2 N^2$ 在网格单元上进行黎曼和来计算。\n4.  对于能量约束方案，通过黎曼和计算积分 $I_s = \\rho_0 L_x \\iint s^2 N^2 \\, dy \\, dz$。然后使用给定的 $P_w$ 和 $K_{\\max}$，通过推导的公式计算 $K_{\\mathrm{energy}}$。\n5.  用计算出的 $K_{\\mathrm{energy}}$，使用与恒定 $K$ 情况相同的方法计算最大输运 $\\psi_{\\mathrm{energy}}$ 和 APE 耗散 $D_{\\mathrm{energy}}$，但用 $K_{\\mathrm{energy}}$ 替代 $K_{\\mathrm{const}}$。\n6.  对所有三个测试案例重复此过程，并按指定格式收集和格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Gent-McWilliams parameterization problem for three test cases.\n    \"\"\"\n    # Grid parameters\n    Ny, Nz = 200, 100\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            # Case 1: General case\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 1.0e-3,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 5.0e9,\n            \"K_max\": 3.0e3\n        },\n        {\n            # Case 2: Zero wind work\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 1.0e-3,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 0.0,\n            \"K_max\": 3.0e3\n        },\n        {\n            # Case 3: Weak stratification\n            \"W\": 1.0e6, \"H\": 4.0e3, \"Lx\": 2.0e6,\n            \"rho0\": 1025.0, \"g\": 9.81,\n            \"N0\": 2.0e-4,\n            \"s0\": 1.0e-3,\n            \"K_const\": 1.0e3,\n            \"Pw\": 5.0e9,\n            \"K_max\": 3.0e3\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current case\n        W = case[\"W\"]\n        H = case[\"H\"]\n        Lx = case[\"Lx\"]\n        rho0 = case[\"rho0\"]\n        N0 = case[\"N0\"]\n        s0 = case[\"s0\"]\n        sigma = W / 4.0\n        K_const = case[\"K_const\"]\n        Pw = case[\"Pw\"]\n        K_max = case[\"K_max\"]\n\n        # Setup grid\n        dy = W / (Ny - 1)\n        dz = H / (Nz - 1)\n        y_vec = np.linspace(0, W, Ny)\n        z_vec = np.linspace(0, H, Nz)\n        Y, Z = np.meshgrid(y_vec, z_vec, indexing='ij')\n\n        # Calculate physical fields on the grid\n        N2 = N0**2\n        S = s0 * np.exp(-((Y - W / 2.0)**2) / (2.0 * sigma**2)) * np.cos(np.pi * Z / H)\n\n        # --- Constant-K GM Scheme Calculations ---\n        \n        # 1. Residual overturning streamfunction\n        Psi_gm_const = -K_const * S\n        \n        # 2. Maximum residual overturning transport magnitude\n        psi_const = Lx * np.max(np.abs(Psi_gm_const))\n        \n        # 3. Domain-integrated APE destruction rate\n        integrand_D_const = rho0 * K_const * S**2 * N2\n        # Riemann sum for the integral\n        D_const = Lx * np.sum(integrand_D_const) * dy * dz\n        \n        # --- Energy-Constrained GM Scheme Calculations ---\n        \n        # 1. Calculate the integral part of the K_energy denominator\n        integrand_K_denom = rho0 * S**2 * N2\n        Is = Lx * np.sum(integrand_K_denom) * dy * dz\n        \n        # 2. Calculate energy-constrained diffusivity K_energy\n        if Is  1e-9: # Avoid division by zero, though not expected here\n            K_energy_unconstrained = Pw / Is\n        else:\n            K_energy_unconstrained = 0.0 if Pw == 0.0 else np.inf\n            \n        K_energy = min(K_max, K_energy_unconstrained)\n        \n        # 3. Residual overturning streamfunction for the energy-constrained case\n        Psi_gm_energy = -K_energy * S\n        \n        # 4. Maximum residual overturning transport magnitude\n        psi_energy = Lx * np.max(np.abs(Psi_gm_energy))\n        \n        # 5. Domain-integrated APE destruction rate\n        # D_energy = K_energy * Is by definition\n        D_energy = K_energy * Is\n\n        results.extend([psi_const, psi_energy, D_const, D_energy])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}