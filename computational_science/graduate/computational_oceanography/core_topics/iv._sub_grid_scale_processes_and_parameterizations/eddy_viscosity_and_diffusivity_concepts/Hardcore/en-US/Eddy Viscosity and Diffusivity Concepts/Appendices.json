{
    "hands_on_practices": [
        {
            "introduction": "The concept of eddy viscosity arises from a practical necessity in ocean modeling. This exercise grounds this necessity in first principles by having you perform a scale analysis on the governing equations of motion. By calculating the Reynolds number ($Re$) and Péclet number ($Pe$) for a realistic ocean scenario, you will demonstrate why molecular diffusion is negligible and why parameterizing turbulent mixing is essential for computational models. ",
            "id": "3791297",
            "problem": "Consider a horizontally homogeneous oceanic mixed layer that is well-stirred by turbulence and approximately unstratified over its depth. Assume the flow is governed by the incompressible momentum equations and a passive scalar advection–diffusion equation, and take the characteristic scales to be a velocity scale $U$, a length scale $L$ representative of the mixed layer depth, a kinematic viscosity $\\nu$ of seawater, and a molecular diffusivity $\\kappa$ of the scalar (temperature). Starting from the momentum and scalar transport equations, perform a nondimensionalization using the scales $U$ and $L$ and identify the nondimensional parameters that measure the relative importance of advective to diffusive processes in momentum and scalar transport. Then, using the following scientifically plausible values representative of a mid-latitude wind-mixed surface layer:\n- $U = 0.30 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$,\n- $L = 60 \\ \\mathrm{m}$,\n- $\\nu = 1.05 \\times 10^{-6} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}$ (kinematic viscosity of seawater at moderate temperature),\n- $\\kappa = 1.40 \\times 10^{-7} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}$ (molecular thermal diffusivity of seawater),\n\ncompute the Reynolds number (denoted $\\mathrm{Re}$) and the Péclet number (denoted $\\mathrm{Pe}$) for this mixed layer. Based on the magnitudes of these dimensionless numbers from your derivation, infer whether representing unresolved turbulent transport via eddy viscosity and eddy diffusivity coefficients is appropriate in computational oceanography for this scenario. Express your final numerical results for $\\mathrm{Re}$ and $\\mathrm{Pe}$ as a row matrix $\\left( \\mathrm{Re} \\ \\mathrm{Pe} \\right)$ and round to three significant figures. Since these are dimensionless numbers, no physical units should be included in the final answer.",
            "solution": "The problem is first validated and found to be scientifically grounded, well-posed, objective, and self-contained. The provided physical parameters are realistic for the specified oceanographic scenario. Therefore, a full solution is warranted.\n\nThe problem requires us to analyze the relative importance of advective and diffusive transport mechanisms for momentum and a passive scalar in an oceanic mixed layer. This is accomplished by nondimensionalizing the governing equations.\n\nLet the velocity field be $\\mathbf{u}(\\mathbf{x}, t)$ and the passive scalar concentration be $C(\\mathbf{x}, t)$. The flow is governed by the incompressible momentum (Navier-Stokes) equations, and the scalar transport is governed by an advection-diffusion equation. We focus on the terms representing advection and diffusion.\n\nThe momentum equation for an incompressible fluid is:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\mathbf{f} + \\nu \\nabla^2 \\mathbf{u}\n$$\nwhere the term $(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}$ represents the advection of momentum (inertia) and the term $\\nu \\nabla^2 \\mathbf{u}$ represents the viscous diffusion of momentum. Here, $\\rho$ is the fluid density, $p$ is the pressure, $\\mathbf{f}$ represents body forces (like gravity and Coriolis force), and $\\nu$ is the kinematic viscosity.\n\nThe transport equation for a passive scalar $C$ is:\n$$\n\\frac{\\partial C}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)C = \\kappa \\nabla^2 C\n$$\nwhere the term $(\\mathbf{u} \\cdot \\nabla)C$ represents the advection of the scalar and $\\kappa \\nabla^2 C$ represents its molecular diffusion. Here, $\\kappa$ is the molecular diffusivity of the scalar.\n\nTo nondimensionalize these equations, we introduce dimensionless variables, denoted by a superscript $*$. We use the characteristic velocity scale $U$ and length scale $L$:\n$$\n\\mathbf{x} = L\\mathbf{x}^* \\quad \\implies \\quad \\nabla = \\frac{1}{L}\\nabla^*\n$$\n$$\n\\mathbf{u} = U\\mathbf{u}^*\n$$\nThe characteristic time scale for advection is $T = L/U$, so we define dimensionless time as:\n$$\nt = \\frac{L}{U}t^* \\quad \\implies \\quad \\frac{\\partial}{\\partial t} = \\frac{U}{L}\\frac{\\partial}{\\partial t^*}\n$$\nWe define a dimensionless scalar $C^*$ in a similar manner, $C = C_{scale}C^*$, where $C_{scale}$ is a characteristic scale for the scalar.\n\nSubstituting these into the momentum advection and diffusion terms:\n- Advective term: $(\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = (U\\mathbf{u}^* \\cdot \\frac{1}{L}\\nabla^*)(U\\mathbf{u}^*) = \\frac{U^2}{L}(\\mathbf{u}^* \\cdot \\nabla^*)\\mathbf{u}^*$\n- Viscous term: $\\nu \\nabla^2 \\mathbf{u} = \\nu \\left(\\frac{1}{L^2}\\nabla^{*2}\\right)(U\\mathbf{u}^*) = \\frac{\\nu U}{L^2}\\nabla^{*2}\\mathbf{u}^*$\n\nThe ratio of the magnitude of the advective term to the viscous term is:\n$$\n\\frac{|(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}|}{|\\nu \\nabla^2 \\mathbf{u}|} \\sim \\frac{U^2/L}{\\nu U/L^2} = \\frac{UL}{\\nu}\n$$\nThis dimensionless number is the Reynolds number, $\\mathrm{Re}$.\n$$\n\\mathrm{Re} = \\frac{UL}{\\nu}\n$$\nIt represents the ratio of inertial forces to viscous forces.\n\nSimilarly, substituting the dimensionless variables into the scalar transport equation:\n- Advective term: $(\\mathbf{u} \\cdot \\nabla)C = (U\\mathbf{u}^* \\cdot \\frac{1}{L}\\nabla^*)(C_{scale}C^*) = \\frac{U C_{scale}}{L}(\\mathbf{u}^* \\cdot \\nabla^*)C^*$\n- Diffusive term: $\\kappa \\nabla^2 C = \\kappa \\left(\\frac{1}{L^2}\\nabla^{*2}\\right)(C_{scale}C^*) = \\frac{\\kappa C_{scale}}{L^2}\\nabla^{*2}C^*$\n\nThe ratio of the magnitude of the advective term to the diffusive term is:\n$$\n\\frac{|(\\mathbf{u} \\cdot \\nabla)C|}{|\\kappa \\nabla^2 C|} \\sim \\frac{U C_{scale}/L}{\\kappa C_{scale}/L^2} = \\frac{UL}{\\kappa}\n$$\nThis dimensionless number is the Péclet number, $\\mathrm{Pe}$.\n$$\n\\mathrm{Pe} = \\frac{UL}{\\kappa}\n$$\nIt represents the ratio of the rate of advection of a physical quantity by the flow to the rate of diffusion of the same quantity driven by an appropriate gradient.\n\nNow we compute the values of $\\mathrm{Re}$ and $\\mathrm{Pe}$ using the given data:\n- $U = 0.30 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$\n- $L = 60 \\ \\mathrm{m}$\n- $\\nu = 1.05 \\times 10^{-6} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}$\n- $\\kappa = 1.40 \\times 10^{-7} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}$\n\nThe Reynolds number is:\n$$\n\\mathrm{Re} = \\frac{UL}{\\nu} = \\frac{(0.30 \\ \\mathrm{m} \\ \\mathrm{s}^{-1})(60 \\ \\mathrm{m})}{1.05 \\times 10^{-6} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}} = \\frac{18}{1.05 \\times 10^{-6}} \\approx 17142857\n$$\nRounding to three significant figures, $\\mathrm{Re} = 1.71 \\times 10^7$.\n\nThe Péclet number is:\n$$\n\\mathrm{Pe} = \\frac{UL}{\\kappa} = \\frac{(0.30 \\ \\mathrm{m} \\ \\mathrm{s}^{-1})(60 \\ \\mathrm{m})}{1.40 \\times 10^{-7} \\ \\mathrm{m}^{2} \\ \\mathrm{s}^{-1}} = \\frac{18}{1.40 \\times 10^{-7}} \\approx 128571428\n$$\nRounding to three significant figures, $\\mathrm{Pe} = 1.29 \\times 10^8$.\n\nThe calculated Reynolds number, $\\mathrm{Re} \\approx 1.71 \\times 10^7$, is exceptionally large. For most fluid flows, a transition to turbulence occurs at $\\mathrm{Re}$ values of the order of $10^3 - 10^5$. A Reynolds number of this magnitude indicates that the flow is highly turbulent. In such a regime, the advective transport of momentum (inertia) overwhelms the molecular viscous diffusion by many orders of magnitude.\n\nSimilarly, the Péclet number, $\\mathrm{Pe} \\approx 1.29 \\times 10^8$, is also extremely large. This signifies that the advective transport of the scalar (temperature) by the flow is vastly dominant over its diffusion at the molecular level.\n\nIn computational oceanography, numerical models discretize the ocean onto a grid. The grid resolution is typically on the order of kilometers in the horizontal and meters to tens of meters in the vertical. These grid spacings are far too coarse to resolve the smallest scales of turbulent motion (the Kolmogorov scale) or scalar mixing (the Batchelor scale), which are on the order of millimeters or smaller in such energetic environments.\n\nSince the direct effects of molecular viscosity and diffusivity are completely negligible at the scales resolved by the model, but the collective effect of the unresolved turbulent eddies is to mix momentum and scalars very efficiently, these sub-grid-scale turbulent transport processes must be parameterized. The concept of eddy viscosity ($A_v$) and eddy diffusivity ($K_v$) is a common, albeit simplified, method for this parameterization. These eddy coefficients are not properties of the fluid itself but are properties of the flow, representing the enhanced mixing due to turbulence. They are typically orders of magnitude larger than their molecular counterparts ($\\nu$ and $\\kappa$).\n\nTherefore, the extremely large values of $\\mathrm{Re}$ and $\\mathrm{Pe}$ definitively confirm that the flow is in a turbulent regime where molecular transport is insignificant compared to advection at the large scale. This provides the fundamental physical justification for needing to parameterize unresolved turbulent mixing. The use of eddy viscosity and eddy diffusivity coefficients is a standard and appropriate approach to represent these effects in computational ocean models for this scenario.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.71 \\times 10^{7}  1.29 \\times 10^{8}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Estimating eddy diffusivity ($K_T$) from real-world data is a core skill for a computational oceanographer. This practical coding exercise challenges you to derive $K_T$ profiles from discrete measurements of temperature and turbulent heat flux. You will learn to apply finite-difference methods and, critically, to propagate measurement uncertainty to produce a statistically robust result. ",
            "id": "3791273",
            "problem": "A vertical one-dimensional column of the ocean is observed with depth coordinate $z$ measured in meters and increasing downward. The mean temperature profile is denoted $\\bar T(z)$ with units of degrees Celsius, and the turbulent vertical heat flux is denoted $\\overline{w'T'}(z)$ with units of Kelvin meter per second. Under first-order closure (also called $K$-theory), the vertical turbulent heat flux is modeled by the Fickian relation $$\\overline{w'T'}(z) = - K_T(z)\\,\\frac{d\\bar T}{dz}(z),$$ where $K_T(z)$ is the eddy (turbulent) thermal diffusivity with units of square meters per second.\n\nGiven discrete measurements of $\\bar T(z)$ and $\\overline{w'T'}(z)$ at depths $z_i$ for $i=0,\\dots,N-1$, assume the following observational model:\n- The discrete gradient $\\frac{d\\bar T}{dz}(z_i)$ is approximated by finite differences on the given grid. For interior points, use the central difference $$\\left.\\frac{d\\bar T}{dz}\\right|_{z_i} \\approx \\frac{\\bar T(z_{i+1}) - \\bar T(z_{i-1})}{z_{i+1} - z_{i-1}},$$ and for the endpoints use one-sided differences $$\\left.\\frac{d\\bar T}{dz}\\right|_{z_0} \\approx \\frac{\\bar T(z_1) - \\bar T(z_0)}{z_1 - z_0},\\quad \\left.\\frac{d\\bar T}{dz}\\right|_{z_{N-1}} \\approx \\frac{\\bar T(z_{N-1}) - \\bar T(z_{N-2})}{z_{N-1} - z_{N-2}}.$$\n- Measurement noise on $\\bar T$ and $\\overline{w'T'}$ is independent and Gaussian with known standard deviations $\\sigma_T$ (degrees Celsius) and $\\sigma_F$ (Kelvin meter per second), respectively. Under the above finite difference scheme, the variance of the discrete gradient is $$\\operatorname{var}\\!\\left(\\left.\\frac{d\\bar T}{dz}\\right|_{z_i}\\right) = \\begin{cases} \\dfrac{2\\,\\sigma_T^2}{(z_{1} - z_{0})^2},  i=0, \\\\[1.2ex] \\dfrac{2\\,\\sigma_T^2}{(z_{i+1} - z_{i-1})^2},  0iN-1, \\\\[1.2ex] \\dfrac{2\\,\\sigma_T^2}{(z_{N-1} - z_{N-2})^2},  i=N-1.\\end{cases}$$\n- The eddy diffusivity is estimated by inversion of the closure relation: $$K_T(z_i) = -\\frac{\\overline{w'T'}(z_i)}{\\left.\\frac{d\\bar T}{dz}\\right|_{z_i}}.$$\n- The uncertainty in $K_T(z_i)$ due to measurement noise is quantified using first-order (linear) error propagation based on a Taylor expansion. Treating $K_T$ as the function $K_T(F,G) = -F/G$ of flux $F$ and gradient $G$, the variance is $$\\operatorname{var}\\!\\big(K_T(z_i)\\big) = \\left(\\frac{\\partial K_T}{\\partial F}\\right)^2 \\operatorname{var}(F) + \\left(\\frac{\\partial K_T}{\\partial G}\\right)^2 \\operatorname{var}(G) = \\frac{\\sigma_F^2}{G^2} + \\frac{F^2}{G^4}\\,\\operatorname{var}(G),$$ where $G$ is the discrete gradient and $F=\\overline{w'T'}(z_i)$. Assume zero covariance between $F$ and $G$.\n\nTo avoid divisions by gradients that are statistically indistinguishable from zero, define a three-standard-deviation threshold using the Standard Deviation (SD) of the gradient. Specifically, at locations $z_i$ where $$\\left|\\left.\\frac{d\\bar T}{dz}\\right|_{z_i}\\right| \\le 3\\,\\sqrt{\\operatorname{var}\\!\\left(\\left.\\frac{d\\bar T}{dz}\\right|_{z_i}\\right)},$$ treat $K_T(z_i)$ and its uncertainty as undefined. Use $\\mathrm{NaN}$ (not-a-number) for undefined values and exclude them from any averages.\n\nYour task is to write a program that:\n1. Implements the above gradient estimation, eddy diffusivity inversion, and uncertainty propagation on three test cases.\n2. For each test case, computes the depth-mean eddy diffusivity $$\\langle K_T\\rangle$$ in $\\mathrm{m}^2/\\mathrm{s}$ and the depth-mean uncertainty $$\\langle \\sigma_{K_T}\\rangle$$ in $\\mathrm{m}^2/\\mathrm{s}$ across all depths where $K_T$ is defined, where $\\sigma_{K_T} = \\sqrt{\\operatorname{var}(K_T)}$.\n3. Produces a single line of output containing the six results (two per test case) as a comma-separated list enclosed in square brackets.\n\nAll physical quantities must be handled in the following units:\n- Depth $z$ in meters.\n- Temperature $\\bar T$ in degrees Celsius.\n- Flux $\\overline{w'T'}$ in Kelvin meter per second.\n- Eddy diffusivity $K_T$ and its uncertainty in square meters per second.\n\nThe three test cases are:\n\nCase A (uniform grid, linear stratification, constant flux):\n- Depths: $z = [0,\\,20,\\,40,\\,60,\\,80,\\,100,\\,120,\\,140,\\,160,\\,180,\\,200]$.\n- Mean temperature: $\\bar T(z) = [20.0,\\,19.0,\\,18.0,\\,17.0,\\,16.0,\\,15.0,\\,14.0,\\,13.0,\\,12.0,\\,11.0,\\,10.0]$.\n- Turbulent flux: $\\overline{w'T'}(z) = [1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.0\\times 10^{-7}]$.\n- Noise levels: $\\sigma_T = 0.01$, $\\sigma_F = 2.0\\times 10^{-8}$.\n\nCase B (uniform grid, mixed layer then thermocline, constant flux):\n- Depths: $z = [0,\\,10,\\,20,\\,30,\\,40,\\,50,\\,60,\\,70,\\,80,\\,90,\\,100]$.\n- Mean temperature: $\\bar T(z) = [22.0,\\,22.0,\\,22.0,\\,22.0,\\,22.0,\\,22.0,\\,21.8,\\,21.6,\\,21.4,\\,21.2,\\,21.0]$.\n- Turbulent flux: $\\overline{w'T'}(z) = [8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8},\\,8.0\\times 10^{-8}]$.\n- Noise levels: $\\sigma_T = 0.02$, $\\sigma_F = 3.0\\times 10^{-8}$.\n\nCase C (non-uniform grid, smoothly varying stratification, varying flux):\n- Depths: $z = [0,\\,15,\\,40,\\,60,\\,85,\\,120,\\,160,\\,205]$.\n- Mean temperature: $\\bar T(z) = [18.0,\\,17.5,\\,16.8,\\,16.2,\\,15.5,\\,14.6,\\,13.5,\\,12.4]$.\n- Turbulent flux: $\\overline{w'T'}(z) = [1.50\\times 10^{-7},\\,1.62\\times 10^{-7},\\,1.55\\times 10^{-7},\\,1.52\\times 10^{-7},\\,1.48\\times 10^{-7},\\,1.60\\times 10^{-7},\\,1.66\\times 10^{-7},\\,1.72\\times 10^{-7}]$.\n- Noise levels: $\\sigma_T = 0.005$, $\\sigma_F = 1.0\\times 10^{-8}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order:\n$$[\\langle K_T\\rangle_{\\mathrm{A}},\\,\\langle \\sigma_{K_T}\\rangle_{\\mathrm{A}},\\,\\langle K_T\\rangle_{\\mathrm{B}},\\,\\langle \\sigma_{K_T}\\rangle_{\\mathrm{B}},\\,\\langle K_T\\rangle_{\\mathrm{C}},\\,\\langle \\sigma_{K_T}\\rangle_{\\mathrm{C}}],$$\nwhere subscripts $\\mathrm{A}$, $\\mathrm{B}$, and $\\mathrm{C}$ denote the test cases. All values must be in $\\mathrm{m}^2/\\mathrm{s}$, expressed as decimal floats.",
            "solution": "The problem requires the estimation of vertical eddy thermal diffusivity, $K_T(z)$, and its associated uncertainty from discrete profile data of mean temperature $\\bar T(z)$ and turbulent heat flux $\\overline{w'T'}(z)$. This is a common task in physical oceanography for parameterizing turbulent mixing. The solution is derived by implementing the provided theoretical framework, which includes numerical differentiation, error propagation, and statistical thresholding.\n\nThe governing relationship is the first-order closure model for turbulent heat flux, also known as K-theory or a Fickian diffusion law:\n$$\n\\overline{w'T'}(z) = - K_T(z)\\,\\frac{d\\bar T}{dz}(z)\n$$\nHere, $\\overline{w'T'}(z)$ is the vertical turbulent heat flux in units of $\\mathrm{K \\cdot m/s}$, $\\bar T(z)$ is the mean temperature profile in $\\mathrm{^\\circ C}$, and $K_T(z)$ is the eddy thermal diffusivity in $\\mathrm{m^2/s}$. Note that a temperature gradient in $\\mathrm{^\\circ C/m}$ is numerically equivalent to a gradient in $\\mathrm{K/m}$, ensuring dimensional consistency.\n\nThe estimation process proceeds in several distinct steps, as detailed below.\n\n**Step 1: Temperature Gradient Estimation**\nThe continuous temperature gradient, $\\frac{d\\bar T}{dz}$, must be approximated from the discrete temperature measurements $\\bar T(z_i)$ at depths $z_i$. The problem specifies a finite difference scheme:\n- For the top boundary ($i=0$): a one-sided forward difference is used.\n$$\n\\left.\\frac{d\\bar T}{dz}\\right|_{z_0} \\approx \\frac{\\bar T(z_1) - \\bar T(z_0)}{z_1 - z_0}\n$$\n- For interior points ($0  i  N-1$): a second-order accurate central difference is used.\n$$\n\\left.\\frac{d\\bar T}{dz}\\right|_{z_i} \\approx \\frac{\\bar T(z_{i+1}) - \\bar T(z_{i-1})}{z_{i+1} - z_{i-1}}\n$$\n- For the bottom boundary ($i=N-1$): a one-sided backward difference is used.\n$$\n\\left.\\frac{d\\bar T}{dz}\\right|_{z_{N-1}} \\approx \\frac{\\bar T(z_{N-1}) - \\bar T(z_{N-2})}{z_{N-1} - z_{N-2}}\n$$\nThese formulae provide a discrete estimate of the temperature gradient, which we denote as $G(z_i) = \\left.\\frac{d\\bar T}{dz}\\right|_{z_i}$.\n\n**Step 2: Uncertainty in the Temperature Gradient**\nThe measurements of $\\bar T$ are subject to independent Gaussian noise with a standard deviation of $\\sigma_T$. This uncertainty propagates to the calculated gradient. Using the standard formula for propagation of variance for independent variables, $\\operatorname{var}(aX + bY) = a^2\\operatorname{var}(X) + b^2\\operatorname{var}(Y)$, the variance of the gradient estimates can be derived. For example, for the central difference $G_i = \\frac{T_{i+1}}{h} - \\frac{T_{i-1}}{h}$ where $h = z_{i+1}-z_{i-1}$, the variance is $\\operatorname{var}(G_i) = \\frac{1}{h^2}\\operatorname{var}(T_{i+1}) + \\frac{1}{h^2}\\operatorname{var}(T_{i-1}) = \\frac{\\sigma_T^2}{h^2} + \\frac{\\sigma_T^2}{h^2} = \\frac{2\\sigma_T^2}{h^2}$. This logic leads to the variances provided in the problem statement:\n$$\n\\operatorname{var}\\!\\left(G(z_i)\\right) = \\begin{cases} \\dfrac{2\\,\\sigma_T^2}{(z_{1} - z_{0})^2},  i=0 \\\\ \\dfrac{2\\,\\sigma_T^2}{(z_{i+1} - z_{i-1})^2},  0iN-1 \\\\ \\dfrac{2\\,\\sigma_T^2}{(z_{N-1} - z_{N-2})^2},  i=N-1 \\end{cases}\n$$\n\n**Step 3: Statistical Significance Thresholding**\nIn regions where the true temperature gradient is very small or zero (e.g., in a mixed layer), the finite-difference estimate $G(z_i)$ can be dominated by measurement noise. Inversion of the K-theory relation, $K_T = -\\overline{w'T'}/G$, would involve division by a number that is statistically indistinguishable from zero, leading to spurious and extremely large estimates of $K_T$. To prevent this, a statistical significance test is applied. An estimate of the gradient $G(z_i)$ is deemed too noisy if its absolute value is not significantly larger than its uncertainty. The problem defines this threshold using three standard deviations: if $|G(z_i)| \\le 3 \\sqrt{\\operatorname{var}(G(z_i))}$, the gradient is considered statistically insignificant. For any such points, both the eddy diffusivity $K_T(z_i)$ and its uncertainty are considered undefined and are flagged with 'Not-a-Number' ($\\mathrm{NaN}$).\n\n**Step 4: Eddy Diffusivity Inversion**\nFor all depths $z_i$ where the temperature gradient $G(z_i)$ is statistically significant, the eddy diffusivity is estimated by algebraically inverting the K-theory equation:\n$$\nK_T(z_i) = -\\frac{\\overline{w'T'}(z_i)}{G(z_i)}\n$$\n\n**Step 5: Uncertainty Propagation for Eddy Diffusivity**\nThe uncertainty in the estimated $K_T$ arises from the uncertainties in both the flux measurement $\\overline{w'T'}$ (with standard deviation $\\sigma_F$) and the gradient estimate $G$. Treating $K_T$ as a function of two independent random variables, $F = \\overline{w'T'}$ and $G$, so that $K_T(F,G) = -F/G$, the variance of $K_T$ can be approximated to first order by a Taylor expansion:\n$$\n\\operatorname{var}(K_T) \\approx \\left(\\frac{\\partial K_T}{\\partial F}\\right)^2 \\operatorname{var}(F) + \\left(\\frac{\\partial K_T}{\\partial G}\\right)^2 \\operatorname{var}(G)\n$$\nThe partial derivatives are $\\frac{\\partial K_T}{\\partial F} = -1/G$ and $\\frac{\\partial K_T}{\\partial G} = F/G^2$. Substituting these expressions and the known variances, $\\operatorname{var}(F) = \\sigma_F^2$ and $\\operatorname{var}(G)$, we obtain the specified formula for the variance of the eddy diffusivity at each valid point $z_i$:\n$$\n\\operatorname{var}\\!\\big(K_T(z_i)\\big) = \\frac{\\sigma_F^2}{G(z_i)^2} + \\frac{\\overline{w'T'}(z_i)^2}{G(z_i)^4}\\,\\operatorname{var}(G(z_i))\n$$\nThe uncertainty (standard deviation) in $K_T$ is then $\\sigma_{K_T}(z_i) = \\sqrt{\\operatorname{var}(K_T(z_i))}$.\n\n**Step 6: Depth-Averaged Results**\nThe final step is to compute the depth-mean eddy diffusivity $\\langle K_T \\rangle$ and the depth-mean uncertainty $\\langle \\sigma_{K_T} \\rangle$. These averages are computed over all depths where $K_T$ and $\\sigma_{K_T}$ were successfully defined (i.e., not assigned $\\mathrm{NaN}$). This is achieved by taking the arithmetic mean of all non-$\\mathrm{NaN}$ values in the computed arrays for $K_T$ and $\\sigma_{K_T}$.\n\nThese steps are implemented for each of the three test cases specified, yielding a pair of values ($\\langle K_T \\rangle$, $\\langle \\sigma_{K_T} \\rangle$) for each case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the final results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"name\": \"A\",\n            \"z\": np.array([0., 20., 40., 60., 80., 100., 120., 140., 160., 180., 200.]),\n            \"T\": np.array([20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0, 11.0, 10.0]),\n            \"F\": np.full(11, 1.0e-7),\n            \"sigma_T\": 0.01,\n            \"sigma_F\": 2.0e-8,\n        },\n        # Case B\n        {\n            \"name\": \"B\",\n            \"z\": np.array([0., 10., 20., 30., 40., 50., 60., 70., 80., 90., 100.]),\n            \"T\": np.array([22.0, 22.0, 22.0, 22.0, 22.0, 22.0, 21.8, 21.6, 21.4, 21.2, 21.0]),\n            \"F\": np.full(11, 8.0e-8),\n            \"sigma_T\": 0.02,\n            \"sigma_F\": 3.0e-8,\n        },\n        # Case C\n        {\n            \"name\": \"C\",\n            \"z\": np.array([0., 15., 40., 60., 85., 120., 160., 205.]),\n            \"T\": np.array([18.0, 17.5, 16.8, 16.2, 15.5, 14.6, 13.5, 12.4]),\n            \"F\": np.array([1.50e-7, 1.62e-7, 1.55e-7, 1.52e-7, 1.48e-7, 1.60e-7, 1.66e-7, 1.72e-7]),\n            \"sigma_T\": 0.005,\n            \"sigma_F\": 1.0e-8,\n        },\n    ]\n\n    def process_case(z, T, F, sigma_T, sigma_F):\n        \"\"\"\n        Calculates mean eddy diffusivity and its uncertainty for a single case.\n        \"\"\"\n        N = len(z)\n\n        # Step 1: Compute temperature gradient G = dT/dz\n        # np.gradient uses the specified forward/central/backward difference scheme.\n        G = np.gradient(T, z)\n\n        # Step 2: Compute variance of the gradient, var(G)\n        var_G = np.zeros(N)\n        # Endpoint i=0\n        var_G[0] = (2 * sigma_T**2) / (z[1] - z[0])**2\n        # Interior points i=1 to N-2\n        for i in range(1, N - 1):\n            var_G[i] = (2 * sigma_T**2) / (z[i+1] - z[i-1])**2\n        # Endpoint i=N-1\n        var_G[N-1] = (2 * sigma_T**2) / (z[N-1] - z[N-2])**2\n\n        # Step 3: Apply statistical significance threshold\n        threshold = 3.0 * np.sqrt(var_G)\n        is_significant = np.abs(G)  threshold\n\n        # Step 4  5: Calculate K_T and its variance where gradient is significant\n        # Initialize results with NaN\n        K_T = np.full(N, np.nan)\n        var_K_T = np.full(N, np.nan)\n\n        # Use boolean indexing to compute only for significant points\n        G_sig = G[is_significant]\n        F_sig = F[is_significant]\n        var_G_sig = var_G[is_significant]\n        \n        # Inversion for K_T\n        K_T[is_significant] = -F_sig / G_sig\n        \n        # Uncertainty propagation for var(K_T)\n        term1 = sigma_F**2 / G_sig**2\n        term2 = (F_sig**2 / G_sig**4) * var_G_sig\n        var_K_T[is_significant] = term1 + term2\n\n        # Standard deviation of K_T\n        sigma_K_T = np.sqrt(var_K_T)\n\n        # Step 6: Compute depth-mean values, ignoring NaNs\n        mean_K_T = np.nanmean(K_T)\n        mean_sigma_K_T = np.nanmean(sigma_K_T)\n\n        return mean_K_T, mean_sigma_K_T\n\n    results = []\n    for case in test_cases:\n        mean_K_T, mean_sigma_K_T = process_case(\n            case[\"z\"], case[\"T\"], case[\"F\"], case[\"sigma_T\"], case[\"sigma_F\"]\n        )\n        results.append(mean_K_T)\n        results.append(mean_sigma_K_T)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After estimating an eddy diffusivity profile, you must be able to correctly implement its effects in a numerical model. This practice focuses on that crucial step, guiding you through the discretization of the vertical diffusion equation. By deriving the tridiagonal matrix for an implicit solver on a staggered grid, you will translate a physical concept into the computational language of a modern ocean model. ",
            "id": "3791243",
            "problem": "Consider a one-dimensional vertical column of ocean water in hydrostatic balance, in which the evolution of a passive tracer concentration $T(z,t)$ is governed solely by vertical turbulent diffusion with an eddy diffusivity $K(z)$. Starting from the tracer conservation law and Fick's law of diffusion, the governing equation in continuous form is\n$$\n\\frac{\\partial T}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial z}\\!\\left(K(z)\\,\\frac{\\partial T}{\\partial z}\\right).\n$$\nAssume a finite-volume discretization on a staggered vertical grid: tracer unknowns $T_i$ are located at cell centers $z_i$ for $i=1,\\dots,N$, and turbulent fluxes with eddy diffusivity $K$ are evaluated at cell interfaces $z_{i+1/2}$ for $i=1,\\dots,N-1$. Let the cell thicknesses be $\\Delta z_i = z_{i+1/2} - z_{i-1/2}$ and the center-to-center distances be $\\Delta z_{i+1/2} = z_{i+1} - z_i$. Denote the interface eddy diffusivities by $K_{i+1/2} = K(z_{i+1/2})$. Impose no-flux boundary conditions at the top and bottom boundaries, meaning the diffusive flux $F_{1/2}$ and $F_{N+1/2}$ vanish.\n\nUsing a backward Euler (BE) implicit time discretization with time step $\\Delta t$ for the diffusion term alone, derive the discrete vertical diffusion operator in finite-volume form and assemble the resulting linear system for the unknown vector $\\boldsymbol{T}^{n+1} = (T_1^{n+1},\\dots,T_N^{n+1})^{\\top}$ at the new time level $t^{n+1}$. Your derivation must begin from the continuous tracer conservation law and Fick's law, express fluxes and their divergences consistently on the staggered grid, and carefully account for nonuniform vertical spacing.\n\nFinally, write down the tridiagonal matrix form used in the implicit solver by giving closed-form analytic expressions for the interior stencil coefficients $a_i$, $b_i$, and $c_i$ for $i = 2,\\dots,N-1$, where $a_i$ multiplies $T_{i-1}^{n+1}$, $b_i$ multiplies $T_i^{n+1}$, and $c_i$ multiplies $T_{i+1}^{n+1}$. Express your final answer as a single analytic expression for $(a_i, b_i, c_i)$ in terms of $\\Delta t$, $K_{i\\pm 1/2}$, $\\Delta z_i$, and $\\Delta z_{i\\pm 1/2}$. No numerical evaluation is required. If you introduce any acronyms, define them on first use (for example, write \"Backward Euler (BE)\" the first time it appears).",
            "solution": "The problem is valid. It is a well-posed, scientifically grounded problem in computational fluid dynamics, requiring the derivation of a standard numerical scheme.\n\nThe derivation begins with the integral form of the tracer conservation law for a control volume. For a one-dimensional vertical column, we consider a finite volume, or cell, $V_i$ for the tracer $T$. This cell $i$ is centered at $z_i$ and extends from the interface at $z_{i-1/2}$ to the interface at $z_{i+1/2}$. The tracer conservation law states that the rate of change of the total amount of tracer in the volume is equal to the net flux of the tracer across its boundaries.\nLet the vertical diffusive flux be denoted by $F(z,t)$. The conservation law for cell $i$ is:\n$$\n\\frac{d}{dt} \\int_{z_{i-1/2}}^{z_{i+1/2}} T(z,t) \\, dz = F(z_{i-1/2}, t) - F(z_{i+1/2}, t)\n$$\nIn the finite-volume method, we approximate the integral by the product of the cell-averaged concentration, $T_i(t)$, and the volume (here, thickness) of the cell, $\\Delta z_i = z_{i+1/2} - z_{i-1/2}$:\n$$\n\\int_{z_{i-1/2}}^{z_{i+1/2}} T(z,t) \\, dz \\approx T_i(t) \\Delta z_i\n$$\nSubstituting this into the conservation law gives the semi-discrete equation for the cell-averaged concentration:\n$$\n\\Delta z_i \\frac{d T_i}{dt} = F_{i-1/2} - F_{i+1/2}\n$$\nwhere $F_{i\\pm 1/2}$ represents the flux at the cell interfaces $z_{i\\pm 1/2}$.\n\nThe problem statement provides the relationship between the flux and the tracer gradient, which is a form of Fick's law, within the governing equation $\\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(K(z)\\,\\frac{\\partial T}{\\partial z}\\right)$. This implies that the diffusive flux is $F = -K(z)\\frac{\\partial T}{\\partial z}$ and the conservation law is $\\frac{\\partial T}{\\partial t} + \\frac{\\partial F}{\\partial z} = 0$. So we have $F_{i+1/2} = - \\left( K(z)\\frac{\\partial T}{\\partial z} \\right)_{z=z_{i+1/2}}$.\nOn the staggered grid, the gradient at the interface $z_{i+1/2}$ is approximated using the tracer values at the adjacent cell centers $z_i$ and $z_{i+1}$:\n$$\n\\left(\\frac{\\partial T}{\\partial z}\\right)_{z=z_{i+1/2}} \\approx \\frac{T_{i+1}(t) - T_i(t)}{z_{i+1} - z_i} = \\frac{T_{i+1}(t) - T_i(t)}{\\Delta z_{i+1/2}}\n$$\nThe eddy diffusivity at the interface is given as $K_{i+1/2}$. Therefore, the discrete flux at the upper interface of cell $i$ is:\n$$\nF_{i+1/2} = -K_{i+1/2} \\frac{T_{i+1} - T_i}{\\Delta z_{i+1/2}}\n$$\nSimilarly, the flux at the lower interface is:\n$$\nF_{i-1/2} = -K_{i-1/2} \\frac{T_i - T_{i-1}}{\\Delta z_{i-1/2}}\n$$\nSubstituting these discrete fluxes into the semi-discrete conservation law yields:\n$$\n\\Delta z_i \\frac{d T_i}{dt} = \\left(-K_{i-1/2} \\frac{T_i - T_{i-1}}{\\Delta z_{i-1/2}}\\right) - \\left(-K_{i+1/2} \\frac{T_{i+1} - T_i}{\\Delta z_{i+1/2}}\\right)\n$$\n$$\n\\frac{d T_i}{dt} = \\frac{1}{\\Delta z_i} \\left( K_{i+1/2} \\frac{T_{i+1} - T_i}{\\Delta z_{i+1/2}} - K_{i-1/2} \\frac{T_i - T_{i-1}}{\\Delta z_{i-1/2}} \\right)\n$$\nThis is the system of ordinary differential equations that describes the time evolution of the discrete tracer concentrations.\n\nNext, we discretize in time using the Backward Euler (BE) implicit scheme with a time step $\\Delta t$. For an equation of the form $\\frac{dy}{dt} = f(y)$, the BE scheme is $\\frac{y^{n+1}-y^n}{\\Delta t} = f(y^{n+1})$. We apply this to our semi-discrete equation, evaluating the right-hand side (the diffusion term) at the new time level $n+1$:\n$$\n\\frac{T_i^{n+1} - T_i^n}{\\Delta t} = \\frac{1}{\\Delta z_i} \\left( K_{i+1/2} \\frac{T_{i+1}^{n+1} - T_i^{n+1}}{\\Delta z_{i+1/2}} - K_{i-1/2} \\frac{T_i^{n+1} - T_{i-1}^{n+1}}{\\Delta z_{i-1/2}} \\right)\n$$\nOur goal is to assemble a linear system of the form $\\mathbf{A} \\boldsymbol{T}^{n+1} = \\boldsymbol{T}^n$, which requires rearranging the equation to group terms with unknowns $T_j^{n+1}$ on the left-hand side and knowns $T_i^n$ on the right.\nFirst, multiply by $\\Delta t$:\n$$\nT_i^{n+1} - T_i^n = \\frac{\\Delta t}{\\Delta z_i} \\left( K_{i+1/2} \\frac{T_{i+1}^{n+1} - T_i^{n+1}}{\\Delta z_{i+1/2}} - K_{i-1/2} \\frac{T_i^{n+1} - T_{i-1}^{n+1}}{\\Delta z_{i-1/2}} \\right)\n$$\nNow, expand and collect terms multiplying $T_{i-1}^{n+1}$, $T_i^{n+1}$, and $T_{i+1}^{n+1}$:\n$$\nT_i^{n+1} - T_i^n = \\left(\\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}\\right) T_{i+1}^{n+1} - \\left(\\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}\\right) T_i^{n+1} - \\left(\\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}\\right) T_i^{n+1} + \\left(\\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}\\right) T_{i-1}^{n+1}\n$$\nMoving all terms with superscript $n+1$ to the left side:\n$$\n-\\left(\\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}\\right) T_{i-1}^{n+1} + \\left(1 + \\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}} + \\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}\\right) T_i^{n+1} - \\left(\\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}\\right) T_{i+1}^{n+1} = T_i^n\n$$\nThis is the linear equation for the interior grid point $i$, for $i=2,\\dots,N-1$. The equation has the tridiagonal form $a_i T_{i-1}^{n+1} + b_i T_i^{n+1} + c_i T_{i+1}^{n+1} = T_i^n$.\nBy comparing the coefficients, we can identify $a_i$, $b_i$, and $c_i$:\n\n- The coefficient of $T_{i-1}^{n+1}$ is $a_i$:\n$$\na_i = - \\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}\n$$\n- The coefficient of $T_i^{n+1}$ is $b_i$:\n$$\nb_i = 1 + \\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}} + \\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}\n$$\n- The coefficient of $T_{i+1}^{n+1}$ is $c_i$:\n$$\nc_i = - \\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}\n$$\nThese are the closed-form analytic expressions for the interior stencil coefficients of the tridiagonal matrix used in the implicit solver.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}}  1 + \\frac{\\Delta t K_{i-1/2}}{\\Delta z_i \\Delta z_{i-1/2}} + \\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}}  -\\frac{\\Delta t K_{i+1/2}}{\\Delta z_i \\Delta z_{i+1/2}} \\end{pmatrix}}\n$$"
        }
    ]
}