{
    "hands_on_practices": [
        {
            "introduction": "The heart of any boundary integral method is the Green's function, or fundamental solution, which acts as the kernel of the integral operators. Before we can numerically treat these integrals, we must first understand the analytical behavior of their kernels, especially near the singularity where source and observation points coincide. This foundational exercise () walks you through the derivation of the logarithmic singularity of the 2D Helmholtz Green's function, a classic result that underpins all 2D boundary element codes.",
            "id": "4119646",
            "problem": "Consider time-harmonic acoustic propagation in an unbounded, homogeneous, two-dimensional medium. The free-space Green’s function (also called the fundamental solution) for the Helmholtz operator with wavenumber $k>0$ is the distribution $G(\\mathbf{x},\\mathbf{y})$ that satisfies the partial differential equation (PDE) $(\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y})=-\\delta(\\mathbf{x}-\\mathbf{y})$ in $\\mathbb{R}^{2}$ together with the outgoing Sommerfeld radiation condition. In direct and indirect Boundary Integral Equation (BIE) formulations, $G(\\mathbf{x},\\mathbf{y})$ appears as the kernel of single- and double-layer potentials. Let $r=|\\mathbf{x}-\\mathbf{y}|$.\n\na) Express $G(\\mathbf{x},\\mathbf{y})$ explicitly in terms of the Hankel function of the first kind of order zero.\n\nb) Using only well-tested small-argument expansions of Bessel and Hankel functions, derive the leading-order asymptotics of $G(\\mathbf{x},\\mathbf{y})$ as $r\\to 0^{+}$ to expose its logarithmic singularity. Define the finite-part constant\n$$\nC(k)\\equiv \\lim_{r\\to 0^{+}}\\left[G(\\mathbf{x},\\mathbf{y})+\\frac{1}{2\\pi}\\ln r\\right],\n$$\nand compute $C(k)$ in closed form, where $\\gamma$ denotes the Euler–Mascheroni constant. Provide your final answer as a single analytic expression for $C(k)$.",
            "solution": "The problem requires the analysis of the free-space Green's function for the two-dimensional Helmholtz equation, $(\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y})=-\\delta(\\mathbf{x}-\\mathbf{y})$, in $\\mathbb{R}^{2}$. This function, also known as the fundamental solution, must satisfy the Sommerfeld radiation condition, ensuring that waves are purely outgoing at infinity. Let $r=|\\mathbf{x}-\\mathbf{y}|$ be the distance between the source point $\\mathbf{y}$ and the observation point $\\mathbf{x}$.\n\na) The fundamental solution to the two-dimensional Helmholtz equation that satisfies the outgoing radiation condition is well-established in the theory of partial differential equations and wave propagation. It is given in terms of the Hankel function of the first kind of order zero, denoted $H_0^{(1)}$. The specific form is:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(kr)\n$$\nThe constant pre-factor $\\frac{i}{4}$ is a normalization constant that ensures the function satisfies the defining PDE $(\\Delta + k^2)G = -\\delta$. To verify this constant, one can integrate the PDE over a small disk $B_{\\epsilon}$ of radius $\\epsilon$ centered at $\\mathbf{y}$ and take the limit as $\\epsilon \\to 0$. Using the divergence theorem, we have:\n$$\n\\int_{B_{\\epsilon}} (\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y}) \\, d\\mathbf{x} = \\int_{\\partial B_{\\epsilon}} \\nabla_{\\mathbf{x}} G \\cdot \\mathbf{n} \\, dS + k^2 \\int_{B_{\\epsilon}} G \\, d\\mathbf{x}\n$$\nwhere $\\mathbf{n}$ is the outward unit normal to the boundary $\\partial B_{\\epsilon}$. This integral must equal $-\\int_{B_{\\epsilon}} \\delta(\\mathbf{x}-\\mathbf{y}) \\, d\\mathbf{x} = -1$. Using the known small-argument asymptotics for Hankel functions, one can show that as $\\epsilon \\to 0$, the first term on the right-hand side approaches $-1$ and the second term vanishes, which confirms the choice of the pre-factor $\\frac{i}{4}$.\n\nb) To determine the finite-part constant $C(k)$, we must first find the leading-order asymptotics of $G(\\mathbf{x},\\mathbf{y})$ as $r \\to 0^{+}$. This requires the small-argument expansions of the Bessel functions that constitute the Hankel function. The Hankel function $H_0^{(1)}(z)$ is defined as $H_0^{(1)}(z) = J_0(z) + iY_0(z)$, where $J_0(z)$ is the Bessel function of the first kind of order zero, and $Y_0(z)$ is the Bessel function of the second kind of order zero.\n\nFor a small argument $z \\to 0$, their standard asymptotic expansions are:\n$$\nJ_0(z) = 1 - \\frac{z^2}{4} + O(z^4)\n$$\n$$\nY_0(z) = \\frac{2}{\\pi} \\left[ \\left(\\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) J_0(z) + \\frac{z^2}{4} - \\dots \\right]\n$$\nwhere $\\gamma \\approx 0.5772$ is the Euler–Mascheroni constant.\n\nFor the leading-order behavior as $z \\to 0$, we can approximate $J_0(z) \\approx 1$. Thus, the expansion for $Y_0(z)$ simplifies to:\n$$\nY_0(z) = \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) + O(z^2 \\ln z)\n$$\nCombining these results, the small-argument expansion for $H_0^{(1)}(z)$ is:\n$$\nH_0^{(1)}(z) = J_0(z) + iY_0(z) = 1 + i \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) + O(z^2 \\ln z)\n$$\nNow, we substitute $z=kr$ into this expansion to find the behavior of $G(\\mathbf{x},\\mathbf{y})$ for small $r$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(kr) = \\frac{i}{4} \\left[ 1 + i \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O((kr)^2 \\ln(kr)) \\right]\n$$\nDistributing the factor $\\frac{i}{4}$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} + \\frac{i^2}{4} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O(r^2 \\ln r)\n$$\nSince $i^2 = -1$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O(r^2 \\ln r)\n$$\nWe can use the properties of the logarithm, $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(ab) = \\ln(a) + \\ln(b)$, to separate the $r$-dependent term:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln(r) + \\ln(k) - \\ln(2) + \\gamma \\right) + O(r^2 \\ln r)\n$$\n$$\nG(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi} \\ln r + \\left[ \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) \\right] + O(r^2 \\ln r)\n$$\nThis expression explicitly reveals the logarithmic singularity of the Green's function as $r \\to 0^{+}$. The leading-order asymptotic behavior is $G(\\mathbf{x},\\mathbf{y}) \\sim -\\frac{1}{2\\pi}\\ln r$.\n\nThe finite-part constant $C(k)$ is defined by the limit:\n$$\nC(k) \\equiv \\lim_{r\\to 0^{+}}\\left[G(\\mathbf{x},\\mathbf{y})+\\frac{1}{2\\pi}\\ln r\\right]\n$$\nSubstituting our asymptotic expression for $G(\\mathbf{x},\\mathbf{y})$ into this definition:\n$$\nC(k) = \\lim_{r\\to 0^{+}}\\left[ \\left(-\\frac{1}{2\\pi} \\ln r + \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) + O(r^2 \\ln r) \\right) + \\frac{1}{2\\pi}\\ln r \\right]\n$$\nThe logarithmic singularity terms cancel out:\n$$\nC(k) = \\lim_{r\\to 0^{+}}\\left[ \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) + O(r^2 \\ln r) \\right]\n$$\nAs $r \\to 0^{+}$, the term $O(r^2 \\ln r)$ vanishes. Therefore, the limit is:\n$$\nC(k) = \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma)\n$$\nThis expression can be rewritten by combining the logarithmic terms:\n$$\nC(k) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln\\left(\\frac{k}{2}\\right) + \\gamma \\right)\n$$\nThis is the closed-form expression for the finite-part constant $C(k)$.",
            "answer": "$$\n\\boxed{\\frac{i}{4} - \\frac{1}{2\\pi}\\left(\\ln\\left(\\frac{k}{2}\\right) + \\gamma\\right)}\n$$"
        },
        {
            "introduction": "Analytical understanding of kernel singularities is essential, but the ultimate goal is to compute integrals accurately. Standard quadrature rules fail for singular integrands, necessitating specialized techniques. This practical exercise () bridges theory and implementation by having you first derive the exact value of a canonical weakly singular integral, and then write code to benchmark several numerical strategies for handling the singularity, providing a clear view of their effectiveness.",
            "id": "4119598",
            "problem": "Consider the three-dimensional acoustic scattering governed by the scalar Helmholtz equation and its boundary integral formulations. In the direct Boundary Integral Equation (BIE) and indirect Boundary Integral Equation (BIE) approaches for exterior problems, the single-layer boundary integral operator arises from representing the acoustic pressure field as a surface convolution of a fundamental solution with an unknown density on the boundary. In the static limit where the acoustic wavenumber is zero, the problem reduces to the Laplace case. The Laplace fundamental solution in three dimensions is given by $G(\\mathbf{x},\\mathbf{y}) = \\frac{1}{4\\pi\\lVert \\mathbf{x}-\\mathbf{y}\\rVert}$, where $\\mathbf{x}$ is the field point and $\\mathbf{y}$ is the source point on the boundary. For a constant basis function over a boundary element, the diagonal self-term of the single-layer matrix corresponds to a weakly singular surface integral where the field point lies on the same surface element.\n\nYour task is to derive from first principles the analytic value of the diagonal self-term of the single-layer operator for the Laplace case ($k=0$) on the unit sphere, for a collocation point $\\mathbf{x}_0$ on the sphere. Starting from the integral definition for a constant basis over the entire unit sphere $S^2$, the self-term can be written as\n$$\nI = \\int_{S^2} G(\\mathbf{x}_0,\\mathbf{y}) \\,\\mathrm{d}S_{\\mathbf{y}} = \\frac{1}{4\\pi}\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0-\\mathbf{y}\\rVert} \\,\\mathrm{d}S_{\\mathbf{y}}.\n$$\nUsing geometric relations on the unit sphere with polar axis passing through $\\mathbf{x}_0$, denote the polar angle by $\\theta \\in [0,\\pi]$ and the azimuthal angle by $\\phi \\in [0,2\\pi]$ (with angles in radians). Show that the integral is well-defined and evaluate it analytically.\n\nThen, implement a program that numerically approximates the same integral and benchmarks three singular-aware quadrature strategies against the analytic value you derived:\n\n- Strategy A (Plain Spherical Quadrature): Evaluate\n$$\nI_{\\mathrm{num}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi,\n$$\nusing Gauss–Legendre quadrature in $\\theta$ and a uniform trapezoidal rule in $\\phi$. Implement a numerically stable evaluation of the factor $\\frac{\\sin\\theta}{2\\sin(\\theta/2)}$ near $\\theta=0$.\n\n- Strategy B (Analytic Near-Field Isolation): Split the integral at a small polar cutoff $\\theta_c \\in (0,\\pi)$ as\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\theta_c} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi + \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{\\theta_c}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi,\n$$\nevaluate the near-field part analytically and the far-field part numerically using Gauss–Legendre in $\\theta$ and uniform trapezoidal in $\\phi$.\n\n- Strategy C (Quadratic Duffy-Type Mapping): Concentrate resolution near the weak singularity by a quadratic change of variables $\\theta = u^2$ with $u \\in [0,\\sqrt{\\pi}]$, so that\n$$\nI_{\\mathrm{num}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\sqrt{\\pi}} \\frac{\\sin(u^2)}{2\\sin\\big(\\frac{u^2}{2}\\big)}\\cdot 2u \\,\\mathrm{d}u\\,\\mathrm{d}\\phi,\n$$\nand evaluate using Gauss–Legendre in $u$ and uniform trapezoidal in $\\phi$.\n\nAll angles must be handled in radians. Your program must compute the absolute error between each numerical approximation and the analytic value you derived.\n\nDesign a test suite that covers different quadrature resolutions and near-field cutoffs:\n- For Strategy A: $(N_\\theta,N_\\phi) \\in \\{(4,8),(16,32),(64,128)\\}$.\n- For Strategy B: $(N_\\theta,N_\\phi,\\theta_c) \\in \\{(16,32,0.1),(16,32,0.5),(16,32,1.0)\\}$.\n- For Strategy C: $(N_u,N_\\phi) \\in \\{(16,32),(64,128)\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as specified above for the test suite, and expressed as floating-point numbers. For example, the final line must have the format\n$$\n[\\text{error}_{A1},\\text{error}_{A2},\\text{error}_{A3},\\text{error}_{B1},\\text{error}_{B2},\\text{error}_{B3},\\text{error}_{C1},\\text{error}_{C2}].\n$$",
            "solution": "The acoustic scattering problem in three dimensions for time-harmonic waves is governed by the Helmholtz equation. In Boundary Integral Equation (BIE) formulations, both direct and indirect approaches represent the solution using surface integrals of fundamental solutions and unknown densities on the boundary. The single-layer operator in the Laplace limit is central: for the Laplace equation, the fundamental solution is $G(\\mathbf{x},\\mathbf{y}) = \\frac{1}{4\\pi\\lVert \\mathbf{x}-\\mathbf{y}\\rVert}$, which yields a weakly singular integrand when the observation point lies on the boundary element.\n\nWe consider the unit sphere $S^2$ with a constant basis over the entire surface and a collocation point $\\mathbf{x}_0$ on the sphere. The diagonal self-term of the single-layer matrix for the Laplace case is\n$$\nI = \\frac{1}{4\\pi}\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0 - \\mathbf{y}\\rVert}\\,\\mathrm{d}S_{\\mathbf{y}}.\n$$\nTo evaluate this analytically, we choose spherical coordinates centered so that the polar axis passes through $\\mathbf{x}_0$. Let $\\theta$ be the polar angle and $\\phi$ the azimuthal angle, with $\\theta \\in [0,\\pi]$ and $\\phi \\in [0,2\\pi]$ (angles in radians). For points on the unit sphere, the Euclidean distance between $\\mathbf{x}_0$ and $\\mathbf{y}$ depends only on the polar angle $\\theta$ via the relation\n$$\n\\lVert \\mathbf{x}_0 - \\mathbf{y} \\rVert = \\sqrt{2-2\\cos\\theta} = 2\\sin\\left(\\frac{\\theta}{2}\\right).\n$$\nThe surface element on the unit sphere is\n$$\n\\mathrm{d}S = \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi.\n$$\nTherefore, the integral becomes\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\left(\\frac{\\theta}{2}\\right)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi.\n$$\nNote that the apparent singularity at $\\theta = 0$ is integrable because the factor $\\sin\\theta$ in the surface element cancels the $1/\\sin(\\theta/2)$ behavior in the kernel. Using the identity $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$, the integrand simplifies to\n$$\n\\frac{\\sin\\theta}{2\\sin\\left(\\frac{\\theta}{2}\\right)} = \\cos\\left(\\frac{\\theta}{2}\\right),\n$$\nwhich is smooth over $[0,\\pi]$. Thus,\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot \\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta.\n$$\nEvaluating the inner integral:\n$$\n\\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta = 2\\left[\\sin\\left(\\frac{\\theta}{2}\\right)\\right]_{0}^{\\pi} = 2.\n$$\nTherefore,\n$$\nI = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot 2 = 1.\n$$\nThis analytic value agrees with the classical potential-theoretic result: the Newtonian potential of a uniformly charged spherical shell of radius $a$ at a point on the shell is $\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0 - \\mathbf{y}\\rVert}\\,\\mathrm{d}S_{\\mathbf{y}} = 4\\pi a$, which for $a=1$ and the factor $\\frac{1}{4\\pi}$ gives $I=1$.\n\nAlgorithmic design for numerical benchmarking is as follows:\n\n- For Strategy A, we use Gauss–Legendre quadrature with $N_\\theta$ nodes to approximate the $\\theta$-integral on $[0,\\pi]$ and a uniform trapezoidal rule with $N_\\phi$ points for $\\phi$ on $[0,2\\pi]$. The integrand is evaluated as $\\frac{\\sin\\theta}{2\\sin(\\theta/2)}$, with a numerically stable substitution to $\\cos(\\theta/2)$ when $\\sin(\\theta/2)$ is below a small threshold to avoid division by a tiny number.\n\n- For Strategy B, we split the integral at a cutoff $\\theta_c$. The near-field part is computed analytically:\n$$\nI_{\\mathrm{near}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\theta_c} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot 2\\sin\\left(\\frac{\\theta_c}{2}\\right) = \\sin\\left(\\frac{\\theta_c}{2}\\right).\n$$\nThe far-field part is computed numerically on $[\\theta_c,\\pi]$ via Gauss–Legendre for $\\theta$ and trapezoidal for $\\phi$. The total approximation is $I_{\\mathrm{near}} + I_{\\mathrm{far}}$.\n\n- For Strategy C, we apply a quadratic change of variables $\\theta = u^2$, $u \\in [0,\\sqrt{\\pi}]$. The Jacobian gives $\\mathrm{d}\\theta = 2u\\,\\mathrm{d}u$. The integrand becomes $\\frac{\\sin(u^2)}{2\\sin(u^2/2)}\\cdot 2u$, which is evaluated stably near $u=0$ by switching to $\\cos(u^2/2)\\cdot 2u$ when the denominator is small. We use Gauss–Legendre quadrature with $N_u$ nodes on $[0,\\sqrt{\\pi}]$ and trapezoidal in $\\phi$.\n\nFor each test case, the program computes the numerical estimate $I_{\\mathrm{num}}$ and the absolute error $\\lvert I_{\\mathrm{num}} - 1\\rvert$, where $1$ is the analytic value derived above. The results are produced in a single line, as a comma-separated list enclosed in square brackets, ordered to match the test suite. This design tests resolution effects (via $N_\\theta$, $N_\\phi$, $N_u$), the handling of the weak singularity, and the impact of near-field isolation with various $\\theta_c$.\n\nAll angles must be treated in radians, and the output values are dimensionless floating-point numbers. No physical units are required because the unit sphere and the Laplace kernel normalization $\\frac{1}{4\\pi}$ render the target quantity dimensionless.",
            "answer": "```python\nimport numpy as np\n\ndef gauss_legendre_interval(n, a, b):\n    # Nodes and weights on [a,b] from Legendre polynomial on [-1,1]\n    xi, wi = np.polynomial.legendre.leggauss(n)\n    # Affine map\n    x = 0.5*(b - a)*xi + 0.5*(b + a)\n    w = 0.5*(b - a)*wi\n    return x, w\n\ndef stable_sin_over_2sin_half(theta, eps=1e-14):\n    # Evaluate sin(theta)/(2*sin(theta/2)) stably near theta=0\n    half = 0.5 * theta\n    denom = np.sin(half)\n    # Where denom is small, use cos(theta/2)\n    out = np.empty_like(theta, dtype=np.float64)\n    mask = np.abs(denom) < eps\n    out[mask] = np.cos(half[mask])\n    out[~mask] = np.sin(theta[~mask]) / (2.0 * denom[~mask])\n    return out\n\ndef strategy_plain(N_theta, N_phi):\n    # Integrate over theta in [0, pi] and phi in [0, 2pi]\n    theta, w_theta = gauss_legendre_interval(N_theta, 0.0, np.pi)\n    # Uniform trapezoidal rule for phi\n    phi_w = (2.0 * np.pi) / N_phi\n    # Integrand does not depend on phi; phi integration gives exactly 2*pi by trapezoid on constant function\n    f_theta = stable_sin_over_2sin_half(theta)\n    integral_theta = np.sum(w_theta * f_theta)\n    I_num = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_theta\n    return I_num\n\ndef strategy_near_analytic(N_theta, N_phi, theta_c):\n    # Near-field analytic part\n    I_near = np.sin(0.5 * theta_c)\n    # Far-field numerical part over theta in [theta_c, pi]\n    theta, w_theta = gauss_legendre_interval(N_theta, theta_c, np.pi)\n    phi_w = (2.0 * np.pi) / N_phi\n    f_theta = stable_sin_over_2sin_half(theta)\n    integral_theta = np.sum(w_theta * f_theta)\n    I_far = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_theta\n    return I_near + I_far\n\ndef strategy_u2(N_u, N_phi):\n    # Quadratic mapping theta = u^2, u in [0, sqrt(pi)]\n    u, w_u = gauss_legendre_interval(N_u, 0.0, np.sqrt(np.pi))\n    theta = u**2\n    # Integrand with Jacobian: sin(theta)/(2*sin(theta/2))*2u\n    core = stable_sin_over_2sin_half(theta)\n    f_u = core * (2.0 * u)\n    integral_u = np.sum(w_u * f_u)\n    phi_w = (2.0 * np.pi) / N_phi\n    I_num = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_u\n    return I_num\n\ndef solve():\n    # Analytic value from derivation\n    I_analytic = 1.0\n\n    # Define the test cases (ordered as specified)\n    test_cases = [\n        ('plain', 4, 8),\n        ('plain', 16, 32),\n        ('plain', 64, 128),\n        ('near_analytic', 16, 32, 0.1),\n        ('near_analytic', 16, 32, 0.5),\n        ('near_analytic', 16, 32, 1.0),\n        ('u2', 16, 32),\n        ('u2', 64, 128),\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[0] == 'plain':\n            _, N_theta, N_phi = case\n            I_num = strategy_plain(N_theta, N_phi)\n        elif case[0] == 'near_analytic':\n            _, N_theta, N_phi, theta_c = case\n            I_num = strategy_near_analytic(N_theta, N_phi, theta_c)\n        elif case[0] == 'u2':\n            _, N_u, N_phi = case\n            I_num = strategy_u2(N_u, N_phi)\n        else:\n            I_num = np.nan\n        error = abs(I_num - I_analytic)\n        results.append(error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "A boundary element method ultimately transforms a continuous integral equation into a finite-dimensional linear system of equations, $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$. The properties of the matrix $\\mathbf{A}$ are inherited from the continuous operator and the choice of discretization scheme, and they critically influence the stability of the method and the efficiency of the linear solver. This exercise () challenges you to compare the structural properties, such as symmetry and coercivity, of matrices generated by the Galerkin and collocation methods, revealing deep-seated differences between these two popular approaches.",
            "id": "4119614",
            "problem": "Consider the time-harmonic acoustic scattering governed by the Helmholtz equation in $\\mathbb{R}^{3}$ with wavenumber $k \\ge 0$. Let $\\Gamma \\subset \\mathbb{R}^{3}$ be a closed Lipschitz boundary. The fundamental solution of the Helmholtz operator is\n$$\n\\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\;=\\; \\frac{e^{ik\\lvert \\mathbf{x}-\\mathbf{y}\\rvert}}{4\\pi \\lvert \\mathbf{x}-\\mathbf{y}\\rvert},\n$$\nand the single-layer boundary integral operator $V_{k} : H^{-1/2}(\\Gamma) \\to H^{1/2}(\\Gamma)$ is defined by\n$$\n(V_{k}\\varphi)(\\mathbf{x}) \\;=\\; \\int_{\\Gamma} \\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\,\\varphi(\\mathbf{y})\\, \\mathrm{d}\\Gamma(\\mathbf{y}), \\qquad \\mathbf{x}\\in\\Gamma,\n$$\nwhere $H^{s}(\\Gamma)$ denotes the standard Sobolev space of order $s$ on $\\Gamma$. The direct Boundary Integral Equation (BIE) of the first kind for the single-layer formulation seeks $\\varphi \\in H^{-1/2}(\\Gamma)$ such that\n$$\nV_{k}\\varphi \\;=\\; f \\quad \\text{on } \\Gamma,\n$$\nfor a given $f \\in H^{1/2}(\\Gamma)$.\n\nTwo common discretizations of this BIE are considered:\n\n- Galerkin discretization: choose a finite-dimensional subspace $X_{h} \\subset H^{-1/2}(\\Gamma)$ with basis $\\{\\psi_{n}\\}_{n=1}^{N}$, and seek $\\varphi_{h} \\in X_{h}$ such that for all $v_{h}\\in X_{h}$,\n$$\nb_{k}(\\varphi_{h},v_{h}) \\;=\\; \\ell(v_{h}),\n$$\nwith bilinear form\n$$\nb_{k}(u,v) \\;=\\; \\int_{\\Gamma}\\int_{\\Gamma} \\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\,u(\\mathbf{y}) \\, v(\\mathbf{x}) \\,\\mathrm{d}\\Gamma(\\mathbf{y})\\,\\mathrm{d}\\Gamma(\\mathbf{x})\n$$\nand linear functional $\\ell(v) = \\int_{\\Gamma} f(\\mathbf{x})\\, v(\\mathbf{x})\\, \\mathrm{d}\\Gamma(\\mathbf{x})$. The resulting matrix $A \\in \\mathbb{C}^{N\\times N}$ has entries\n$$\nA_{mn} \\;=\\; b_{k}(\\psi_{n},\\psi_{m}).\n$$\n\n- Collocation discretization: choose trial space $X_{h} = \\operatorname{span}\\{\\psi_{n}\\}_{n=1}^{N}$ and distinct collocation points $\\{\\mathbf{x}_{i}\\}_{i=1}^{N} \\subset \\Gamma$; enforce\n$$\n(V_{k}\\varphi_{h})(\\mathbf{x}_{i}) \\;=\\; f(\\mathbf{x}_{i}), \\quad i=1,\\dots,N.\n$$\nThe resulting matrix $C \\in \\mathbb{C}^{N\\times N}$ has entries\n$$\nC_{ij} \\;=\\; \\int_{\\Gamma} \\Phi_{k}(\\mathbf{x}_{i},\\mathbf{y})\\, \\psi_{j}(\\mathbf{y})\\, \\mathrm{d}\\Gamma(\\mathbf{y}).\n$$\n\nUsing only fundamental properties of $\\Phi_{k}$ and $V_{k}$, compare the symmetry and coercivity of the discrete matrices $A$ (Galerkin) and $C$ (collocation) in the regimes $k=0$ (Laplace) and $k>0$ (real Helmholtz). Select the option that gives the correct comparison.\n\nA. For any $k \\ge 0$, the Galerkin matrix $A$ is Hermitian and coercive; the collocation matrix $C$ is symmetric but not coercive.\n\nB. For $k=0$, the Galerkin matrix $A$ is symmetric positive definite; for $k>0$ (real), $A$ is complex symmetric and satisfies a Gårding-type inequality rather than strict coercivity. In both cases, the collocation matrix $C$ is generally nonsymmetric and lacks any variational coercivity guarantee.\n\nC. Collocation preserves both symmetry and coercivity whenever the kernel is symmetric, whereas Galerkin produces nonsymmetric matrices because test and trial spaces interact asymmetrically.\n\nD. For any $k \\ge 0$, both Galerkin and collocation produce symmetric matrices, but only collocation is coercive because it enforces the equation pointwise.\n\nE. For $k>0$, the Galerkin matrix $A$ is skew-Hermitian and loses all symmetry, while the collocation matrix $C$ is Hermitian by construction.",
            "solution": "### Analysis of the Discretization Matrices\n\nWe will analyze the properties of the Galerkin matrix $A$ and the collocation matrix $C$ separately, considering the cases $k=0$ (Laplace equation) and $k > 0$ (Helmholtz equation).\n\n**1. Galerkin Matrix $A$**\n\nThe entry $A_{mn}$ of the Galerkin matrix is given by the bilinear form $b_{k}(\\cdot, \\cdot)$:\n$$A_{mn} = b_{k}(\\psi_{n},\\psi_{m}) = \\int_{\\Gamma}\\int_{\\Gamma} \\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\,\\psi_{n}(\\mathbf{y}) \\, \\psi_{m}(\\mathbf{x}) \\,\\mathrm{d}\\Gamma(\\mathbf{y})\\,\\mathrm{d}\\Gamma(\\mathbf{x})$$\n\n**Symmetry of $A$:**\nLet's examine the entry $A_{nm}$:\n$$A_{nm} = b_{k}(\\psi_{m},\\psi_{n}) = \\int_{\\Gamma}\\int_{\\Gamma} \\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\,\\psi_{m}(\\mathbf{y}) \\, \\psi_{n}(\\mathbf{x}) \\,\\mathrm{d}\\Gamma(\\mathbf{y})\\,\\mathrm{d}\\Gamma(\\mathbf{x})$$\nBy swapping the integration variables $\\mathbf{x}$ and $\\mathbf{y}$, we get:\n$$A_{nm} = \\int_{\\Gamma}\\int_{\\Gamma} \\Phi_{k}(\\mathbf{y},\\mathbf{x}) \\,\\psi_{m}(\\mathbf{x}) \\, \\psi_{n}(\\mathbf{y}) \\,\\mathrm{d}\\Gamma(\\mathbf{x})\\,\\mathrm{d}\\Gamma(\\mathbf{y})$$\nThe fundamental solution $\\Phi_{k}(\\mathbf{x}, \\mathbf{y})$ is symmetric with respect to its arguments, i.e., $\\Phi_{k}(\\mathbf{x}, \\mathbf{y}) = \\Phi_{k}(\\mathbf{y}, \\mathbf{x})$, because $\\lvert \\mathbf{x}-\\mathbf{y}\\rvert = \\lvert \\mathbf{y}-\\mathbf{x}\\rvert$. Therefore,\n$$A_{nm} = \\int_{\\Gamma}\\int_{\\Gamma} \\Phi_{k}(\\mathbf{x},\\mathbf{y}) \\,\\psi_{m}(\\mathbf{x}) \\, \\psi_{n}(\\mathbf{y}) \\,\\mathrm{d}\\Gamma(\\mathbf{y})\\,\\mathrm{d}\\Gamma(\\mathbf{x}) = A_{mn}$$\nThis shows that $A_{mn}=A_{nm}$, so the matrix $A$ is symmetric ($A=A^T$) for any $k \\ge 0$.\n\n-   For $k=0$ (Laplace), $\\Phi_{0}(\\mathbf{x},\\mathbf{y}) = (4\\pi \\lvert \\mathbf{x}-\\mathbf{y}\\rvert)^{-1}$ is real. Assuming standard real-valued basis functions $\\{\\psi_n\\}$, the matrix $A$ is **real symmetric**.\n-   For $k>0$ (Helmholtz), $\\Phi_{k}(\\mathbf{x},\\mathbf{y})$ is complex-valued due to the term $e^{ik\\lvert \\mathbf{x}-\\mathbf{y}\\rvert}$. The matrix $A$ is therefore **complex symmetric**. A complex symmetric matrix is generally not Hermitian, as being Hermitian requires $A_{mn} = \\overline{A_{nm}}$. Since $A_{mn}=A_{nm}$, this would imply $A_{mn}$ is real, which is not true for $k>0$.\n\n**Coercivity of $A$ (related to the operator $V_k$):**\nCoercivity of the matrix is inherited from the properties of the underlying continuous operator $V_k$ and the corresponding bilinear form $b_k$.\n\n-   For $k=0$, the single-layer potential operator $V_0$ for the Laplace equation is a positive-definite, self-adjoint operator from $H^{-1/2}(\\Gamma)$ to $H^{1/2}(\\Gamma)$. This property, known as ellipticity or coercivity, ensures that the bilinear form $b_0(\\varphi, \\varphi) = \\langle V_0\\varphi, \\varphi \\rangle_{L^2(\\Gamma)}$ is positive for any non-zero $\\varphi$. As a result, the Galerkin matrix $A$ is **symmetric positive definite**.\n\n-   For $k>0$, the Helmholtz operator $V_k$ is not coercive. The presence of the oscillatory term $e^{ik\\lvert \\mathbf{x}-\\mathbf{y}\\rvert}$ means that the energy functional associated with the operator is not positive definite. Instead, $V_k$ is known to satisfy a **Gårding-type inequality**. This inequality separates the operator into a coercive part and a compact part, which is sufficient to establish the stability and convergence of the Galerkin method (Céa's Lemma), but it is a weaker condition than strict coercivity. The resulting matrix $A$ will not be positive definite.\n\n**2. Collocation Matrix $C$**\n\nThe entry $C_{ij}$ of the collocation matrix is given by:\n$$C_{ij} = (V_{k}\\psi_{j})(\\mathbf{x}_{i}) = \\int_{\\Gamma} \\Phi_{k}(\\mathbf{x}_{i},\\mathbf{y})\\, \\psi_{j}(\\mathbf{y})\\, \\mathrm{d}\\Gamma(\\mathbf{y})$$\n\n**Symmetry of $C$:**\nLet's examine the entry $C_{ji}$:\n$$C_{ji} = (V_{k}\\psi_{i})(\\mathbf{x}_{j}) = \\int_{\\Gamma} \\Phi_{k}(\\mathbf{x}_{j},\\mathbf{y})\\, \\psi_{i}(\\mathbf{y})\\, \\mathrm{d}\\Gamma(\\mathbf{y})$$\nThere is no fundamental reason for $C_{ij}$ to be equal to $C_{ji}$ or $\\overline{C_{ji}}$. The expression for $C_{ij}$ involves evaluating the potential generated by the basis function $\\psi_j$ at the point $\\mathbf{x}_i$, while $C_{ji}$ involves the potential from $\\psi_i$ at point $\\mathbf{x}_j$. Unless the basis functions and collocation points have a very specific, highly structured arrangement (which is not generally the case), these two values will be different. Therefore, the collocation matrix $C$ is **generally nonsymmetric**.\n\n**Coercivity of $C$:**\nThe concept of coercivity is intrinsically linked to variational formulations (i.e., those involving bilinear forms and dual-pairings like the Galerkin method). The collocation method is a method of weighted residuals where the test functions are Dirac delta distributions centered at the collocation points $\\{\\mathbf{x}_i\\}$. It does not naturally arise from a symmetric bilinear form, and therefore, it **lacks any variational coercivity guarantee**. The stability of collocation methods is a more delicate issue and cannot be established through a simple coercivity argument.\n\n### Evaluation of Options\n\n-   **A. For any $k \\ge 0$, the Galerkin matrix $A$ is Hermitian and coercive; the collocation matrix $C$ is symmetric but not coercive.**\n    This is incorrect. For $k>0$, $A$ is complex symmetric, not Hermitian, and it is not coercive. The collocation matrix $C$ is generally nonsymmetric.\n\n-   **B. For $k=0$, the Galerkin matrix $A$ is symmetric positive definite; for $k>0$ (real), $A$ is complex symmetric and satisfies a Gårding-type inequality rather than strict coercivity. In both cases, the collocation matrix $C$ is generally nonsymmetric and lacks any variational coercivity guarantee.**\n    This statement perfectly aligns with our analysis. For $k=0$, $A$ is symmetric positive definite. For $k>0$, $A$ is complex symmetric, and its stability relies on the Gårding inequality of the continuous operator. The collocation matrix $C$ is indeed nonsymmetric and has no general coercivity property.\n\n-   **C. Collocation preserves both symmetry and coercivity whenever the kernel is symmetric, whereas Galerkin produces nonsymmetric matrices because test and trial spaces interact asymmetrically.**\n    This is incorrect. It reverses the properties. Galerkin (with identical test and trial spaces) produces a symmetric matrix $A$ from the symmetric kernel. Collocation produces a nonsymmetric matrix $C$.\n\n-   **D. For any $k \\ge 0$, both Galerkin and collocation produce symmetric matrices, but only collocation is coercive because it enforces the equation pointwise.**\n    This is incorrect. The collocation matrix $C$ is nonsymmetric. Neither is collocation coercive, nor is the reasoning provided for coercivity sound.\n\n-   **E. For $k>0$, the Galerkin matrix $A$ is skew-Hermitian and loses all symmetry, while the collocation matrix $C$ is Hermitian by construction.**\n    This is incorrect. The Galerkin matrix $A$ is complex symmetric ($A=A^T$), not skew-Hermitian ($A^H = -A$). The collocation matrix $C$ is nonsymmetric, not Hermitian.\n\n**Conclusion:**\nOption B accurately describes the fundamental properties of the matrices derived from the two discretization methods.",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}