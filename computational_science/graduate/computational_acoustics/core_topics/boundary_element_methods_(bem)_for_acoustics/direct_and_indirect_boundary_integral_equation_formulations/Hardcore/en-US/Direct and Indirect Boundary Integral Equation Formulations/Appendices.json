{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any boundary integral method lies in its kernel—the Green's function. Before we can devise numerical strategies to handle these integrals, we must first understand the analytical behavior of the kernel, particularly its singular nature as the source and evaluation points coincide. This foundational exercise () sharpens your analytical skills by having you derive the famous logarithmic singularity of the two-dimensional Helmholtz kernel from first principles, a crucial distinction from its three-dimensional counterpart.",
            "id": "4119646",
            "problem": "Consider time-harmonic acoustic propagation in an unbounded, homogeneous, two-dimensional medium. The free-space Green’s function (also called the fundamental solution) for the Helmholtz operator with wavenumber $k>0$ is the distribution $G(\\mathbf{x},\\mathbf{y})$ that satisfies the partial differential equation (PDE) $(\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y})=-\\delta(\\mathbf{x}-\\mathbf{y})$ in $\\mathbb{R}^{2}$ together with the outgoing Sommerfeld radiation condition. In direct and indirect Boundary Integral Equation (BIE) formulations, $G(\\mathbf{x},\\mathbf{y})$ appears as the kernel of single- and double-layer potentials. Let $r=|\\mathbf{x}-\\mathbf{y}|$.\n\na) Express $G(\\mathbf{x},\\mathbf{y})$ explicitly in terms of the Hankel function of the first kind of order zero.\n\nb) Using only well-tested small-argument expansions of Bessel and Hankel functions, derive the leading-order asymptotics of $G(\\mathbf{x},\\mathbf{y})$ as $r\\to 0^{+}$ to expose its logarithmic singularity. Define the finite-part constant\n$$\nC(k)\\equiv \\lim_{r\\to 0^{+}}\\left[G(\\mathbf{x},\\mathbf{y})+\\frac{1}{2\\pi}\\ln r\\right],\n$$\nand compute $C(k)$ in closed form, where $\\gamma$ denotes the Euler–Mascheroni constant. Provide your final answer as a single analytic expression for $C(k)$.",
            "solution": "The problem requires the analysis of the free-space Green's function for the two-dimensional Helmholtz equation, $(\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y})=-\\delta(\\mathbf{x}-\\mathbf{y})$, in $\\mathbb{R}^{2}$. This function, also known as the fundamental solution, must satisfy the Sommerfeld radiation condition, ensuring that waves are purely outgoing at infinity. Let $r=|\\mathbf{x}-\\mathbf{y}|$ be the distance between the source point $\\mathbf{y}$ and the observation point $\\mathbf{x}$.\n\na) The fundamental solution to the two-dimensional Helmholtz equation that satisfies the outgoing radiation condition is well-established in the theory of partial differential equations and wave propagation. It is given in terms of the Hankel function of the first kind of order zero, denoted $H_0^{(1)}$. The specific form is:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(kr)\n$$\nThe constant pre-factor $\\frac{i}{4}$ is a normalization constant that ensures the function satisfies the defining PDE $(\\Delta + k^2)G = -\\delta$. To verify this constant, one can integrate the PDE over a small disk $B_{\\epsilon}$ of radius $\\epsilon$ centered at $\\mathbf{y}$ and take the limit as $\\epsilon \\to 0$. Using the divergence theorem, we have:\n$$\n\\int_{B_{\\epsilon}} (\\Delta_{\\mathbf{x}}+k^{2})\\,G(\\mathbf{x},\\mathbf{y}) \\, d\\mathbf{x} = \\int_{\\partial B_{\\epsilon}} \\nabla_{\\mathbf{x}} G \\cdot \\mathbf{n} \\, dS + k^2 \\int_{B_{\\epsilon}} G \\, d\\mathbf{x}\n$$\nwhere $\\mathbf{n}$ is the outward unit normal to the boundary $\\partial B_{\\epsilon}$. This integral must equal $-\\int_{B_{\\epsilon}} \\delta(\\mathbf{x}-\\mathbf{y}) \\, d\\mathbf{x} = -1$. Using the known small-argument asymptotics for Hankel functions, one can show that as $\\epsilon \\to 0$, the first term on the right-hand side approaches $-1$ and the second term vanishes, which confirms the choice of the pre-factor $\\frac{i}{4}$.\n\nb) To determine the finite-part constant $C(k)$, we must first find the leading-order asymptotics of $G(\\mathbf{x},\\mathbf{y})$ as $r \\to 0^{+}$. This requires the small-argument expansions of the Bessel functions that constitute the Hankel function. The Hankel function $H_0^{(1)}(z)$ is defined as $H_0^{(1)}(z) = J_0(z) + iY_0(z)$, where $J_0(z)$ is the Bessel function of the first kind of order zero, and $Y_0(z)$ is the Bessel function of the second kind of order zero.\n\nFor a small argument $z \\to 0$, their standard asymptotic expansions are:\n$$\nJ_0(z) = 1 - \\frac{z^2}{4} + O(z^4)\n$$\n$$\nY_0(z) = \\frac{2}{\\pi} \\left[ \\left(\\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) J_0(z) + \\frac{z^2}{4} - \\dots \\right]\n$$\nwhere $\\gamma \\approx 0.5772$ is the Euler–Mascheroni constant.\n\nFor the leading-order behavior as $z \\to 0$, we can approximate $J_0(z) \\approx 1$. Thus, the expansion for $Y_0(z)$ simplifies to:\n$$\nY_0(z) = \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) + O(z^2 \\ln z)\n$$\nCombining these results, the small-argument expansion for $H_0^{(1)}(z)$ is:\n$$\nH_0^{(1)}(z) = J_0(z) + iY_0(z) = 1 + i \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{z}{2}\\right) + \\gamma \\right) + O(z^2 \\ln z)\n$$\nNow, we substitute $z=kr$ into this expansion to find the behavior of $G(\\mathbf{x},\\mathbf{y})$ for small $r$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(kr) = \\frac{i}{4} \\left[ 1 + i \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O((kr)^2 \\ln(kr)) \\right]\n$$\nDistributing the factor $\\frac{i}{4}$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} + \\frac{i^2}{4} \\frac{2}{\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O(r^2 \\ln r)\n$$\nSince $i^2 = -1$:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln\\left(\\frac{kr}{2}\\right) + \\gamma \\right) + O(r^2 \\ln r)\n$$\nWe can use the properties of the logarithm, $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(ab) = \\ln(a) + \\ln(b)$, to separate the $r$-dependent term:\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln(r) + \\ln(k) - \\ln(2) + \\gamma \\right) + O(r^2 \\ln r)\n$$\n$$\nG(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi} \\ln r + \\left[ \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) \\right] + O(r^2 \\ln r)\n$$\nThis expression explicitly reveals the logarithmic singularity of the Green's function as $r \\to 0^{+}$. The leading-order asymptotic behavior is $G(\\mathbf{x},\\mathbf{y}) \\sim -\\frac{1}{2\\pi}\\ln r$.\n\nThe finite-part constant $C(k)$ is defined by the limit:\n$$\nC(k) \\equiv \\lim_{r\\to 0^{+}}\\left[G(\\mathbf{x},\\mathbf{y})+\\frac{1}{2\\pi}\\ln r\\right]\n$$\nSubstituting our asymptotic expression for $G(\\mathbf{x},\\mathbf{y})$ into this definition:\n$$\nC(k) = \\lim_{r\\to 0^{+}}\\left[ \\left(-\\frac{1}{2\\pi} \\ln r + \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) + O(r^2 \\ln r) \\right) + \\frac{1}{2\\pi}\\ln r \\right]\n$$\nThe logarithmic singularity terms cancel out:\n$$\nC(k) = \\lim_{r\\to 0^{+}}\\left[ \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma) + O(r^2 \\ln r) \\right]\n$$\nAs $r \\to 0^{+}$, the term $O(r^2 \\ln r)$ vanishes. Therefore, the limit is:\n$$\nC(k) = \\frac{i}{4} - \\frac{1}{2\\pi} (\\ln(k) - \\ln(2) + \\gamma)\n$$\nThis expression can be rewritten by combining the logarithmic terms:\n$$\nC(k) = \\frac{i}{4} - \\frac{1}{2\\pi} \\left( \\ln\\left(\\frac{k}{2}\\right) + \\gamma \\right)\n$$\nThis is the closed-form expression for the finite-part constant $C(k)$.",
            "answer": "$$\n\\boxed{\\frac{i}{4} - \\frac{1}{2\\pi}\\left(\\ln\\left(\\frac{k}{2}\\right) + \\gamma\\right)}\n$$"
        },
        {
            "introduction": "Understanding a kernel's singularity is the first step; accurately computing integrals containing it is the second, and it's a critical task in building a functional Boundary Element Method (BEM) code. Weakly singular integrals, like those in the single-layer potential, require special numerical treatment to achieve high accuracy. This hands-on coding practice () bridges theory and implementation, guiding you to compute an analytic \"self-influence\" term and then benchmark various specialized quadrature strategies designed to tame the singularity.",
            "id": "4119598",
            "problem": "Consider the three-dimensional acoustic scattering governed by the scalar Helmholtz equation and its boundary integral formulations. In the direct Boundary Integral Equation (BIE) and indirect Boundary Integral Equation (BIE) approaches for exterior problems, the single-layer boundary integral operator arises from representing the acoustic pressure field as a surface convolution of a fundamental solution with an unknown density on the boundary. In the static limit where the acoustic wavenumber is zero, the problem reduces to the Laplace case. The Laplace fundamental solution in three dimensions is given by $G(\\mathbf{x},\\mathbf{y}) = \\frac{1}{4\\pi\\lVert \\mathbf{x}-\\mathbf{y}\\rVert}$, where $\\mathbf{x}$ is the field point and $\\mathbf{y}$ is the source point on the boundary. For a constant basis function over a boundary element, the diagonal self-term of the single-layer matrix corresponds to a weakly singular surface integral where the field point lies on the same surface element.\n\nYour task is to derive from first principles the analytic value of the diagonal self-term of the single-layer operator for the Laplace case ($k=0$) on the unit sphere, for a collocation point $\\mathbf{x}_0$ on the sphere. Starting from the integral definition for a constant basis over the entire unit sphere $S^2$, the self-term can be written as\n$$\nI = \\int_{S^2} G(\\mathbf{x}_0,\\mathbf{y}) \\,\\mathrm{d}S_{\\mathbf{y}} = \\frac{1}{4\\pi}\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0-\\mathbf{y}\\rVert} \\,\\mathrm{d}S_{\\mathbf{y}}.\n$$\nUsing geometric relations on the unit sphere with polar axis passing through $\\mathbf{x}_0$, denote the polar angle by $\\theta \\in [0,\\pi]$ and the azimuthal angle by $\\phi \\in [0,2\\pi]$ (with angles in radians). Show that the integral is well-defined and evaluate it analytically.\n\nThen, implement a program that numerically approximates the same integral and benchmarks three singular-aware quadrature strategies against the analytic value you derived:\n\n- Strategy A (Plain Spherical Quadrature): Evaluate\n$$\nI_{\\mathrm{num}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi,\n$$\nusing Gauss–Legendre quadrature in $\\theta$ and a uniform trapezoidal rule in $\\phi$. Implement a numerically stable evaluation of the factor $\\frac{\\sin\\theta}{2\\sin(\\theta/2)}$ near $\\theta=0$.\n\n- Strategy B (Analytic Near-Field Isolation): Split the integral at a small polar cutoff $\\theta_c \\in (0,\\pi)$ as\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\theta_c} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi + \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{\\theta_c}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\big(\\frac{\\theta}{2}\\big)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi,\n$$\nevaluate the near-field part analytically and the far-field part numerically using Gauss–Legendre in $\\theta$ and uniform trapezoidal in $\\phi$.\n\n- Strategy C (Quadratic Duffy-Type Mapping): Concentrate resolution near the weak singularity by a quadratic change of variables $\\theta = u^2$ with $u \\in [0,\\sqrt{\\pi}]$, so that\n$$\nI_{\\mathrm{num}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\sqrt{\\pi}} \\frac{\\sin(u^2)}{2\\sin\\big(\\frac{u^2}{2}\\big)}\\cdot 2u \\,\\mathrm{d}u\\,\\mathrm{d}\\phi,\n$$\nand evaluate using Gauss–Legendre in $u$ and uniform trapezoidal in $\\phi$.\n\nAll angles must be handled in radians. Your program must compute the absolute error between each numerical approximation and the analytic value you derived.\n\nDesign a test suite that covers different quadrature resolutions and near-field cutoffs:\n- For Strategy A: $(N_\\theta,N_\\phi) \\in \\{(4,8),(16,32),(64,128)\\}$.\n- For Strategy B: $(N_\\theta,N_\\phi,\\theta_c) \\in \\{(16,32,0.1),(16,32,0.5),(16,32,1.0)\\}$.\n- For Strategy C: $(N_u,N_\\phi) \\in \\{(16,32),(64,128)\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as specified above for the test suite, and expressed as floating-point numbers. For example, the final line must have the format\n$$\n[\\text{error}_{A1},\\text{error}_{A2},\\text{error}_{A3},\\text{error}_{B1},\\text{error}_{B2},\\text{error}_{B3},\\text{error}_{C1},\\text{error}_{C2}].\n$$",
            "solution": "The acoustic scattering problem in three dimensions for time-harmonic waves is governed by the Helmholtz equation. In Boundary Integral Equation (BIE) formulations, both direct and indirect approaches represent the solution using surface integrals of fundamental solutions and unknown densities on the boundary. The single-layer operator in the Laplace limit is central: for the Laplace equation, the fundamental solution is $G(\\mathbf{x},\\mathbf{y}) = \\frac{1}{4\\pi\\lVert \\mathbf{x}-\\mathbf{y}\\rVert}$, which yields a weakly singular integrand when the observation point lies on the boundary element.\n\nWe consider the unit sphere $S^2$ with a constant basis over the entire surface and a collocation point $\\mathbf{x}_0$ on the sphere. The diagonal self-term of the single-layer matrix for the Laplace case is\n$$\nI = \\frac{1}{4\\pi}\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0 - \\mathbf{y}\\rVert}\\,\\mathrm{d}S_{\\mathbf{y}}.\n$$\nTo evaluate this analytically, we choose spherical coordinates centered so that the polar axis passes through $\\mathbf{x}_0$. Let $\\theta$ be the polar angle and $\\phi$ the azimuthal angle, with $\\theta \\in [0,\\pi]$ and $\\phi \\in [0,2\\pi]$ (angles in radians). For points on the unit sphere, the Euclidean distance between $\\mathbf{x}_0$ and $\\mathbf{y}$ depends only on the polar angle $\\theta$ via the relation\n$$\n\\lVert \\mathbf{x}_0 - \\mathbf{y} \\rVert = \\sqrt{2-2\\cos\\theta} = 2\\sin\\left(\\frac{\\theta}{2}\\right).\n$$\nThe surface element on the unit sphere is\n$$\n\\mathrm{d}S = \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi.\n$$\nTherefore, the integral becomes\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\frac{\\sin\\theta}{2\\sin\\left(\\frac{\\theta}{2}\\right)}\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi.\n$$\nNote that the apparent singularity at $\\theta = 0$ is integrable because the factor $\\sin\\theta$ in the surface element cancels the $1/\\sin(\\theta/2)$ behavior in the kernel. Using the identity $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$, the integrand simplifies to\n$$\n\\frac{\\sin\\theta}{2\\sin\\left(\\frac{\\theta}{2}\\right)} = \\cos\\left(\\frac{\\theta}{2}\\right),\n$$\nwhich is smooth over $[0,\\pi]$. Thus,\n$$\nI = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot \\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta.\n$$\nEvaluating the inner integral:\n$$\n\\int_{0}^{\\pi} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta = 2\\left[\\sin\\left(\\frac{\\theta}{2}\\right)\\right]_{0}^{\\pi} = 2.\n$$\nTherefore,\n$$\nI = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot 2 = 1.\n$$\nThis analytic value agrees with the classical potential-theoretic result: the Newtonian potential of a uniformly charged spherical shell of radius $a$ at a point on the shell is $\\int_{S^2} \\frac{1}{\\lVert \\mathbf{x}_0 - \\mathbf{y}\\rVert}\\,\\mathrm{d}S_{\\mathbf{y}} = 4\\pi a$, which for $a=1$ and the factor $\\frac{1}{4\\pi}$ gives $I=1$.\n\nAlgorithmic design for numerical benchmarking is as follows:\n\n- For Strategy A, we use Gauss–Legendre quadrature with $N_\\theta$ nodes to approximate the $\\theta$-integral on $[0,\\pi]$ and a uniform trapezoidal rule with $N_\\phi$ points for $\\phi$ on $[0,2\\pi]$. The integrand is evaluated as $\\frac{\\sin\\theta}{2\\sin(\\theta/2)}$, with a numerically stable substitution to $\\cos(\\theta/2)$ when $\\sin(\\theta/2)$ is below a small threshold to avoid division by a tiny number.\n\n- For Strategy B, we split the integral at a cutoff $\\theta_c$. The near-field part is computed analytically:\n$$\nI_{\\mathrm{near}} = \\frac{1}{4\\pi}\\int_{0}^{2\\pi}\\int_{0}^{\\theta_c} \\cos\\left(\\frac{\\theta}{2}\\right)\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\frac{1}{4\\pi}\\cdot 2\\pi \\cdot 2\\sin\\left(\\frac{\\theta_c}{2}\\right) = \\sin\\left(\\frac{\\theta_c}{2}\\right).\n$$\nThe far-field part is computed numerically on $[\\theta_c,\\pi]$ via Gauss–Legendre for $\\theta$ and trapezoidal for $\\phi$. The total approximation is $I_{\\mathrm{near}} + I_{\\mathrm{far}}$.\n\n- For Strategy C, we apply a quadratic change of variables $\\theta = u^2$, $u \\in [0,\\sqrt{\\pi}]$. The Jacobian gives $\\mathrm{d}\\theta = 2u\\,\\mathrm{d}u$. The integrand becomes $\\frac{\\sin(u^2)}{2\\sin(u^2/2)}\\cdot 2u$, which is evaluated stably near $u=0$ by switching to $\\cos(u^2/2)\\cdot 2u$ when the denominator is small. We use Gauss–Legendre quadrature with $N_u$ nodes on $[0,\\sqrt{\\pi}]$ and trapezoidal in $\\phi$.\n\nFor each test case, the program computes the numerical estimate $I_{\\mathrm{num}}$ and the absolute error $\\lvert I_{\\mathrm{num}} - 1\\rvert$, where $1$ is the analytic value derived above. The results are produced in a single line, as a comma-separated list enclosed in square brackets, ordered to match the test suite. This design tests resolution effects (via $N_\\theta$, $N_\\phi$, $N_u$), the handling of the weak singularity, and the impact of near-field isolation with various $\\theta_c$.\n\nAll angles must be treated in radians, and the output values are dimensionless floating-point numbers. No physical units are required because the unit sphere and the Laplace kernel normalization $\\frac{1}{4\\pi}$ render the target quantity dimensionless.",
            "answer": "```python\nimport numpy as np\n\ndef gauss_legendre_interval(n, a, b):\n    # Nodes and weights on [a,b] from Legendre polynomial on [-1,1]\n    xi, wi = np.polynomial.legendre.leggauss(n)\n    # Affine map\n    x = 0.5*(b - a)*xi + 0.5*(b + a)\n    w = 0.5*(b - a)*wi\n    return x, w\n\ndef stable_sin_over_2sin_half(theta, eps=1e-14):\n    # Evaluate sin(theta)/(2*sin(theta/2)) stably near theta=0\n    half = 0.5 * theta\n    denom = np.sin(half)\n    # Where denom is small, use cos(theta/2)\n    out = np.empty_like(theta, dtype=np.float64)\n    mask = np.abs(denom) < eps\n    out[mask] = np.cos(half[mask])\n    out[~mask] = np.sin(theta[~mask]) / (2.0 * denom[~mask])\n    return out\n\ndef strategy_plain(N_theta, N_phi):\n    # Integrate over theta in [0, pi] and phi in [0, 2pi]\n    theta, w_theta = gauss_legendre_interval(N_theta, 0.0, np.pi)\n    # Uniform trapezoidal rule for phi\n    phi_w = (2.0 * np.pi) / N_phi\n    # Integrand does not depend on phi; phi integration gives exactly 2*pi by trapezoid on constant function\n    f_theta = stable_sin_over_2sin_half(theta)\n    integral_theta = np.sum(w_theta * f_theta)\n    I_num = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_theta\n    return I_num\n\ndef strategy_near_analytic(N_theta, N_phi, theta_c):\n    # Near-field analytic part\n    I_near = np.sin(0.5 * theta_c)\n    # Far-field numerical part over theta in [theta_c, pi]\n    theta, w_theta = gauss_legendre_interval(N_theta, theta_c, np.pi)\n    phi_w = (2.0 * np.pi) / N_phi\n    f_theta = stable_sin_over_2sin_half(theta)\n    integral_theta = np.sum(w_theta * f_theta)\n    I_far = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_theta\n    return I_near + I_far\n\ndef strategy_u2(N_u, N_phi):\n    # Quadratic mapping theta = u^2, u in [0, sqrt(pi)]\n    u, w_u = gauss_legendre_interval(N_u, 0.0, np.sqrt(np.pi))\n    theta = u**2\n    # Integrand with Jacobian: sin(theta)/(2*sin(theta/2))*2u\n    core = stable_sin_over_2sin_half(theta)\n    f_u = core * (2.0 * u)\n    integral_u = np.sum(w_u * f_u)\n    phi_w = (2.0 * np.pi) / N_phi\n    I_num = (1.0 / (4.0 * np.pi)) * (N_phi * phi_w) * integral_u\n    return I_num\n\ndef solve():\n    # Analytic value from derivation\n    I_analytic = 1.0\n\n    # Define the test cases (ordered as specified)\n    test_cases = [\n        ('plain', 4, 8),\n        ('plain', 16, 32),\n        ('plain', 64, 128),\n        ('near_analytic', 16, 32, 0.1),\n        ('near_analytic', 16, 32, 0.5),\n        ('near_analytic', 16, 32, 1.0),\n        ('u2', 16, 32),\n        ('u2', 64, 128),\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[0] == 'plain':\n            _, N_theta, N_phi = case\n            I_num = strategy_plain(N_theta, N_phi)\n        elif case[0] == 'near_analytic':\n            _, N_theta, N_phi, theta_c = case\n            I_num = strategy_near_analytic(N_theta, N_phi, theta_c)\n        elif case[0] == 'u2':\n            _, N_u, N_phi = case\n            I_num = strategy_u2(N_u, N_phi)\n        else:\n            I_num = np.nan\n        error = abs(I_num - I_analytic)\n        results.append(error)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Direct boundary integral formulations often lead to Fredholm integral equations of the second kind, which are numerically advantageous. The key to these formulations is the double-layer potential and its boundary-limit behavior, which exhibits a characteristic jump. This practical coding exercise () demonstrates how to numerically realize this jump condition within a collocation scheme, showing how the theoretical $\\pm \\frac{1}{2}\\varphi$ identity term manifests as a simple diagonal contribution in the discrete system matrix.",
            "id": "4119643",
            "problem": "Consider computational acoustics for time-harmonic waves governed by the Helmholtz equation. Let the acoustic pressure field be denoted by $u(\\mathbf{x})$ satisfying the homogeneous Helmholtz partial differential equation in two spatial dimensions,\n$$\n(\\nabla^2 + k^2) u(\\mathbf{x}) = 0,\n$$\nwhere $k > 0$ is the wavenumber. The free-space Green's function $G(\\mathbf{x}, \\mathbf{y})$ for the two-dimensional Helmholtz equation is defined by\n$$\nG(\\mathbf{x}, \\mathbf{y}) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\left(k \\lvert \\mathbf{x} - \\mathbf{y} \\rvert \\right),\n$$\nwhere $H_0^{(1)}$ is the Hankel function of the first kind of order zero, and $\\mathrm{i}$ is the imaginary unit. The double-layer potential $\\mathcal{D}[\\varphi](\\mathbf{x})$ with density $\\varphi$ supported on a smooth closed boundary $\\Gamma$ is given by\n$$\n\\mathcal{D}[\\varphi](\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, \\mathrm{d}\\Gamma(\\mathbf{y}),\n$$\nwhere $\\partial/\\partial n_{\\mathbf{y}}$ denotes the normal derivative with respect to the source point $\\mathbf{y}$ along the unit normal vector $\\mathbf{n}_{\\mathbf{y}}$ on $\\Gamma$.\n\nThe boundary limit of the double-layer potential is known to exhibit a jump discontinuity described by the Plemelj-Sokhotski formulas. When approaching the boundary $\\Gamma$ from the exterior of the domain (with outward normal orientation), the limit of the double-layer potential satisfies\n$$\n\\lim_{\\mathbf{x} \\to \\Gamma^{+}} \\mathcal{D}[\\varphi](\\mathbf{x}) = \\frac{1}{2} \\varphi(\\mathbf{x}) + \\operatorname{P.V.} \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, \\mathrm{d}\\Gamma(\\mathbf{y}),\n$$\nand when approaching from the interior,\n$$\n\\lim_{\\mathbf{x} \\to \\Gamma^{-}} \\mathcal{D}[\\varphi](\\mathbf{x}) = -\\frac{1}{2} \\varphi(\\mathbf{x}) + \\operatorname{P.V.} \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, \\mathrm{d}\\Gamma(\\mathbf{y}),\n$$\nwhere $\\operatorname{P.V.}$ denotes the Cauchy principal value integral. This boundary limit with the $\\pm \\frac{1}{2}$ jump is central in both direct and indirect boundary integral equation formulations: in a direct formulation, one imposes the boundary condition on the physical trace of $u(\\mathbf{x})$ on $\\Gamma$ and uses potential theory to obtain a boundary integral equation of the second kind involving the $\\frac{1}{2}$ identity term; in an indirect formulation, one represents the field in terms of a potential ansatz with an unknown density and again enforces boundary conditions yielding the same jump structure.\n\nYour task is to implement a collocation scheme on a smooth closed curve to numerically realize the boundary limit with the $\\frac{1}{2}$ jump by explicitly evaluating the principal value integral at each collocation point and adding the identity term. Use the unit circle $\\Gamma = \\{\\mathbf{y}(\\theta) = (a \\cos \\theta, a \\sin \\theta) : \\theta \\in [0, 2\\pi)\\}$ with radius $a = 1$ and outward unit normal $\\mathbf{n}_{\\mathbf{y}}(\\theta) = (\\cos \\theta, \\sin \\theta)$. Parameterize the boundary by the angle $\\theta$ in radians. The arclength element is $\\mathrm{d}\\Gamma(\\mathbf{y}) = a \\, \\mathrm{d}\\theta$.\n\nFor collocation points $\\theta_i = 2\\pi i / N$ for $i = 0, 1, \\dots, N-1$, define the discrete operator matrix $\\mathbf{A} \\in \\mathbb{C}^{N \\times N}$ that approximates\n$$\n\\left( s \\, \\mathbf{I} + \\mathcal{K} \\right) \\varphi(\\theta_i) \\approx s \\, \\varphi(\\theta_i) + \\sum_{j \\neq i} w \\, K(\\theta_i, \\theta_j) \\, \\varphi(\\theta_j),\n$$\nwhere $s \\in \\{+1/2, -1/2\\}$ encodes the exterior or interior boundary limit, $\\mathbf{I}$ is the identity matrix, $w = \\frac{2\\pi a}{N}$ is the trapezoidal-rule weight, and\n$$\nK(\\theta_i, \\theta_j) = \\frac{\\partial G(\\mathbf{x}(\\theta_i), \\mathbf{y}(\\theta_j))}{\\partial n_{\\mathbf{y}}} = \\frac{\\mathrm{i} k}{4} H_1^{(1)}\\left(k r_{ij}\\right) \\frac{(\\mathbf{x}(\\theta_i) - \\mathbf{y}(\\theta_j)) \\cdot \\mathbf{n}_{\\mathbf{y}}(\\theta_j)}{r_{ij}},\n$$\nwith $r_{ij} = \\lvert \\mathbf{x}(\\theta_i) - \\mathbf{y}(\\theta_j) \\rvert$ and $H_1^{(1)}$ the Hankel function of the first kind of order one. Implement the principal value by omitting the $j = i$ term in the summation and adding the identity term $s$ on the diagonal entries, i.e., set $A_{ii} = s$ and $A_{ij} = w \\, K(\\theta_i, \\theta_j)$ for $i \\neq j$.\n\nTo make the problem numerically testable without presupposing analytical eigenstructures, use a manufactured density $\\varphi(\\theta)$ and compute the right-hand side $g(\\theta_i)$ by oversampled quadrature that approximates the principal value integral with higher resolution to emulate a \"continuous\" integral. Specifically, for each collocation point $\\theta_i$, define an oversampling grid $\\theta'_m = 2\\pi (m + 1/2)/M$ for $m = 0, 1, \\dots, M-1$ to avoid coincident points, set $w' = 2\\pi a / M$, and approximate\n$$\ng(\\theta_i) \\approx s \\, \\varphi(\\theta_i) + \\sum_{m=0}^{M-1} w' \\, K(\\theta_i, \\theta'_m) \\, \\varphi(\\theta'_m),\n$$\nwhere $K(\\theta_i, \\theta'_m)$ is computed analogously using $\\mathbf{y}(\\theta'_m)$ and $\\mathbf{n}_{\\mathbf{y}}(\\theta'_m)$.\n\nManufacture the density as\n$$\n\\varphi(\\theta) = e^{\\mathrm{i} 3 \\theta} + \\frac{1}{2} e^{-\\mathrm{i} 2 \\theta}.\n$$\n\nYour program must:\n- Construct $\\mathbf{A}$ for given parameters $(k, N, s, a)$ using the collocation scheme described above.\n- Compute $g(\\theta_i)$ using the oversampled principal value integral with $(M = \\alpha N)$ points and a half-step shift in $\\theta$.\n- Solve the discrete linear system $\\mathbf{A} \\, \\hat{\\varphi} = \\mathbf{g}$ to recover an approximation $\\hat{\\varphi}$ to the manufactured $\\varphi(\\theta_i)$.\n- Report the relative weighted $\\ell^2$ error\n$$\nE = \\frac{\\left( \\sum_{i=0}^{N-1} \\lvert \\hat{\\varphi}_i - \\varphi(\\theta_i) \\rvert^2 \\, w \\right)^{1/2}}{\\left( \\sum_{i=0}^{N-1} \\lvert \\varphi(\\theta_i) \\rvert^2 \\, w \\right)^{1/2}}.\n$$\n\nAngle units must be in radians. No physical units are required for output.\n\nImplement this for the following test suite of parameter sets $(k, N, s, a, \\alpha)$:\n1. $(k = 2.0, N = 128, s = +\\frac{1}{2}, a = 1.0, \\alpha = 4)$.\n2. $(k = 2.0, N = 64, s = -\\frac{1}{2}, a = 1.0, \\alpha = 4)$.\n3. $(k = 0.1, N = 128, s = +\\frac{1}{2}, a = 1.0, \\alpha = 8)$.\n4. $(k = 20.0, N = 256, s = +\\frac{1}{2}, a = 1.0, \\alpha = 8)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[result1,result2,result3,result4]\". Each result must be a float representing the relative error $E$ for the corresponding test case. Use the specified wavenumbers and ensure the angle variable $\\theta$ is in radians throughout.",
            "solution": "The user-provided problem has been analyzed and is deemed valid. It is scientifically grounded in the principles of computational acoustics and boundary element methods, well-posed, and provides a complete, unambiguous set of instructions for a numerical verification task. The problem asks for the implementation of a collocation boundary element method to solve the Helmholtz equation on a circular domain, specifically to verify the numerical representation of the jump condition of the double-layer potential.\n\nThe solution proceeds by first discretizing the boundary integral operator, then constructing a right-hand side vector using a method of manufactured solutions, solving the resulting linear system, and finally computing the error of the numerical solution.\n\n### 1. Principle-Based Design of the Numerical Scheme\n\nThe core of the problem lies in the numerical approximation of the boundary integral equation that arises from the representation of the acoustic field $u(\\mathbf{x})$ using potential theory. For a density function $\\varphi$ on the boundary $\\Gamma$, the boundary limit of the double-layer potential operator $\\mathcal{D}[\\varphi]$ results in the operator $s\\mathbf{I} + \\mathcal{K}$, where $\\mathcal{K}$ is the Cauchy principal value integral part and $s\\mathbf{I}$ is the jump term, with $s = \\pm 1/2$ depending on the direction of the limit (exterior/interior). We will construct a discrete version of this operator and test it.\n\n#### 1.1. Boundary Discretization and Quadrature\n\nThe boundary $\\Gamma$ is a circle of radius $a$, parameterized by the angle $\\theta \\in [0, 2\\pi)$ as $\\mathbf{y}(\\theta) = (a \\cos \\theta, a \\sin \\theta)$. We discretize this boundary into $N$ segments using a set of uniformly spaced collocation points. The collocation points $\\mathbf{x}_i$ correspond to the angles $\\theta_i = 2\\pi i / N$ for $i = 0, 1, \\dots, N-1$.\n\nThe integral operator $\\mathcal{K}$ involves an integral over $\\Gamma$. We approximate this integral using the trapezoidal rule. The contribution from each segment centered at a source point $\\mathbf{y}_j$ is weighted by the arc length of that segment, which is approximated as $w = 2\\pi a / N$.\n\n#### 1.2. Discretization of the Boundary Integral Operator\n\nWe construct an $N \\times N$ complex matrix $\\mathbf{A}$ that represents the discrete form of the operator $s\\mathbf{I} + \\mathcal{K}$.\n\nThe off-diagonal entries $A_{ij}$ for $i \\neq j$ approximate the action of the integral operator $\\mathcal{K}$. This is achieved through collocation, where we evaluate the integral kernel between each pair of a collocation point $\\mathbf{x}_i$ and a source point $\\mathbf{y}_j$.\n$$\nA_{ij} = w \\, K(\\theta_i, \\theta_j) \\quad \\text{for } i \\neq j\n$$\nHere, $K(\\theta_i, \\theta_j)$ is the kernel of the double-layer potential operator:\n$$\nK(\\theta_i, \\theta_j) = \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}_j}} = \\frac{\\mathrm{i} k}{4} H_1^{(1)}\\left(k r_{ij}\\right) \\frac{(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{y}_j}}{r_{ij}}\n$$\nwhere $\\mathbf{x}_i = \\mathbf{y}(\\theta_i)$, $\\mathbf{y}_j = \\mathbf{y}(\\theta_j)$, $r_{ij} = \\lvert \\mathbf{x}_i - \\mathbf{y}_j \\rvert$, and $\\mathbf{n}_{\\mathbf{y}_j}$ is the outward unit normal at $\\mathbf{y}_j$, which for the circle is simply $\\mathbf{y}_j/a$. The Hankel function $H_1^{(1)}$ is of the first kind of order one.\n\nThe diagonal entries $A_{ii}$ directly incorporate the jump term $s$ from the Plemelj-Sokhotski formula. The formulation for the principal value integral involves removing the singularity at $\\mathbf{y}=\\mathbf{x}$. In this simple collocation scheme, this is realized by omitting the singular term $j=i$ from the sum, and the jump term from the identity operator $\\mathbf{I}$ is added to the diagonal.\n$$\nA_{ii} = s\n$$\nThis assembly rule yields the discrete matrix operator $\\mathbf{A}$ that approximates $s\\mathbf{I} + \\mathcal{K}$.\n\n#### 1.3. Method of Manufactured Solutions\n\nTo verify the correctness of our discrete operator $\\mathbf{A}$, we use the method of manufactured solutions. We invent a smooth density function $\\varphi(\\theta)$ for which we can compute the \"true\" result of the operation $(s\\mathbf{I} + \\mathcal{K})\\varphi$. This true result will serve as the right-hand side vector $\\mathbf{g}$ in our linear system.\n\nThe manufactured density is given as $\\varphi(\\theta) = e^{\\mathrm{i} 3 \\theta} + \\frac{1}{2} e^{-\\mathrm{i} 2 \\theta}$.\n\nThe vector $\\mathbf{g}$ is constructed by approximating the continuous integral with high accuracy. For each collocation point $\\theta_i$, we compute $g_i$ as:\n$$\ng_i = s \\, \\varphi(\\theta_i) + \\operatorname{P.V.} \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, \\mathrm{d}\\Gamma(\\mathbf{y})\n$$\nThe integral is calculated using a much finer, oversampled quadrature rule with $M = \\alpha N$ points. To avoid any singularity in this reference calculation, the oversampled grid points are shifted by half a step: $\\theta'_m = 2\\pi (m + 1/2)/M$ for $m=0, 1, \\dots, M-1$. The corresponding quadrature weight is $w' = 2\\pi a / M$. The $i$-th component of the vector $\\mathbf{g}$ is then computed as:\n$$\ng_i \\approx s \\, \\varphi(\\theta_i) + \\sum_{m=0}^{M-1} w' \\, K(\\theta_i, \\theta'_m) \\, \\varphi(\\theta'_m)\n$$\n\n#### 1.4. System Solution and Error Computation\n\nWith the matrix $\\mathbf{A}$ and vector $\\mathbf{g}$ constructed, we solve the linear system $\\mathbf{A} \\hat{\\mathbf{\\varphi}} = \\mathbf{g}$ for the vector $\\hat{\\mathbf{\\varphi}}$. The vector $\\hat{\\mathbf{\\varphi}}$ contains the numerical approximations $\\hat{\\varphi}_i$ to the exact density values $\\varphi(\\theta_i)$ at the collocation points.\n\nFinally, we quantify the accuracy of the numerical solution by computing the relative weighted $\\ell^2$-error, $E$:\n$$\nE = \\frac{\\left( \\sum_{i=0}^{N-1} \\lvert \\hat{\\varphi}_i - \\varphi(\\theta_i) \\rvert^2 \\, w \\right)^{1/2}}{\\left( \\sum_{i=0}^{N-1} \\lvert \\varphi(\\theta_i) \\rvert^2 \\, w \\right)^{1/2}}\n$$\nSince the trapezoidal weight $w$ is constant for a uniform grid, it cancels from the numerator and denominator. The error metric simplifies to the standard relative Euclidean norm of the error vector:\n$$\nE = \\frac{\\|\\hat{\\mathbf{\\varphi}} - \\mathbf{\\varphi}_{\\text{exact}}\\|_2}{\\|\\mathbf{\\varphi}_{\\text{exact}}\\|_2}\n$$\nwhere $(\\mathbf{\\varphi}_{\\text{exact}})_i = \\varphi(\\theta_i)$. A small error $E$ indicates that the discrete operator $\\mathbf{A}$ correctly represents the continuous operator $s\\mathbf{I} + \\mathcal{K}$. This procedure is repeated for each test case specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import hankel1\n\ndef solve():\n    \"\"\"\n    Main function to run the boundary element method verification for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # (k, N, s, a, alpha)\n        (2.0, 128, +0.5, 1.0, 4),\n        (2.0, 64,  -0.5, 1.0, 4),\n        (0.1, 128, +0.5, 1.0, 8),\n        (20.0, 256, +0.5, 1.0, 8),\n    ]\n\n    results = []\n    for params in test_cases:\n        error = compute_bem_error(*params)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_bem_error(k, N, s, a, alpha):\n    \"\"\"\n    Computes the relative error for a single BEM test case.\n\n    Args:\n        k (float): Wavenumber.\n        N (int): Number of collocation points.\n        s (float): Jump term (+0.5 for exterior, -0.5 for interior).\n        a (float): Radius of the circular boundary.\n        alpha (int): Oversampling factor for RHS calculation.\n\n    Returns:\n        float: The relative weighted l2 error.\n    \"\"\"\n    # 1. Discretization and manufactured solution\n    theta = 2 * np.pi * np.arange(N) / N\n    w = 2 * np.pi * a / N\n    \n    # Manufactured density evaluated at collocation points\n    phi_exact_at_theta = np.exp(1j * 3 * theta) + 0.5 * np.exp(-1j * 2 * theta)\n    x_pts = a * np.stack((np.cos(theta), np.sin(theta)), axis=1)\n\n    # 2. Assemble matrix A\n    # Use broadcasting for vectorized computation of all pairs (i, j)\n    # xi_b: (N, 1, 2), yj_b: (1, N, 2)\n    xi_b = x_pts[:, np.newaxis, :]\n    yj_b = x_pts[np.newaxis, :, :]\n    \n    # Vector from source yj to target xi, shape: (N, N, 2)\n    diff_vec = xi_b - yj_b\n    \n    # Distance matrix r_ij, shape: (N, N)\n    r_ij = np.linalg.norm(diff_vec, axis=2)\n    \n    # Normal vectors n_y at yj, shape: (1, N, 2)\n    ny_j_b = yj_b / a\n    \n    # Dot product (xi - yj) . n_yj, shape: (N, N)\n    dot_prod = np.sum(diff_vec * ny_j_b, axis=2)\n    \n    # Kernel K(theta_i, theta_j) for i != j\n    # Suppress warnings for division by zero on the diagonal (r_ij=0)\n    with np.errstate(divide='ignore', invalid='ignore'):\n        kernel_val = (1j * k / 4) * hankel1(1, k * r_ij) * (dot_prod / r_ij)\n    \n    # Construct matrix A\n    A = w * kernel_val\n    np.fill_diagonal(A, s) # A_ii = s\n\n    # 3. Assemble RHS vector g using oversampling (vectorized)\n    M = alpha * N\n    theta_prime = 2 * np.pi * (np.arange(M) + 0.5) / M\n    w_prime = 2 * np.pi * a / M\n\n    # Oversampled source points y' and normals n'\n    y_prime_pts = a * np.stack((np.cos(theta_prime), np.sin(theta_prime)), axis=1)\n    n_prime_pts = y_prime_pts / a\n\n    # Manufactured density at oversampled points\n    phi_prime = np.exp(1j * 3 * theta_prime) + 0.5 * np.exp(-1j * 2 * theta_prime)\n\n    # Vectorize computation over all (i, m) pairs\n    # xi_g_b: (N, 1, 2), y_prime_b: (1, M, 2)\n    y_prime_b = y_prime_pts[np.newaxis, :, :]\n    n_prime_b = n_prime_pts[np.newaxis, :, :]\n    \n    # Vector from source y' to target x, shape: (N, M, 2)\n    diff_vec_g = xi_b - y_prime_b\n    # Distances r_im, shape: (N, M)\n    r_im = np.linalg.norm(diff_vec_g, axis=2)\n    # Dot product, shape: (N, M)\n    dot_prod_g = np.sum(diff_vec_g * n_prime_b, axis=2)\n    \n    # Kernel matrix K(theta_i, theta'_m), shape: (N, M)\n    kernel_g_mat = (1j * k / 4) * hankel1(1, k * r_im) * (dot_prod_g / r_im)\n    \n    # Integral part by summing over m for each i, shape: (N,)\n    integral_part = np.sum(w_prime * kernel_g_mat * phi_prime, axis=1)\n    \n    # Assemble g\n    g = s * phi_exact_at_theta + integral_part\n        \n    # 4. Solve the linear system\n    phi_hat = np.linalg.solve(A, g)\n    \n    # 5. Compute the relative l2 error\n    # The weight w cancels in the relative error formula.\n    error_num = np.linalg.norm(phi_hat - phi_exact_at_theta)\n    error_den = np.linalg.norm(phi_exact_at_theta)\n    \n    if error_den == 0:\n        return 0.0 if error_num == 0 else np.inf\n        \n    return error_num / error_den\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}