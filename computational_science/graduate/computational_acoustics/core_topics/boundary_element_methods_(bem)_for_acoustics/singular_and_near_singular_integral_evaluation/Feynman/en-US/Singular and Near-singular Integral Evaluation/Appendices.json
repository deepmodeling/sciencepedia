{
    "hands_on_practices": [
        {
            "introduction": "Before we can treat a singularity, we must first understand its nature. This first exercise guides you through a fundamental analysis to classify the singularity of the free-space Helmholtz Green's function. By examining the integral's behavior over a shrinking patch on a smooth surface , you will see precisely why a kernel with $1/r$ behavior is considered 'weak' in the context of surface integration, a cornerstone concept in BEM.",
            "id": "4137037",
            "problem": "Consider time-harmonic acoustics in three spatial dimensions governed by the Helmholtz equation $\\Delta p + k^{2} p = 0$, with angular frequency $\\omega$ and acoustic wavenumber $k = \\omega/c$, where $c$ is the speed of sound. Let $\\Gamma \\subset \\mathbb{R}^{3}$ be a smooth boundary and let $\\mathbf{x} \\in \\Gamma$ be a point on this boundary. The free-space Green’s function for the Helmholtz operator is\n$$\nG(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp\\!\\big(i k |\\mathbf{x}-\\mathbf{y}|\\big)}{4\\pi\\,|\\mathbf{x}-\\mathbf{y}|} \\, ,\n$$\nwhich is used in boundary integral formulations in computational acoustics. Define the local patch integral\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}} \\, ,\n$$\nwhere $B_{\\epsilon}(\\mathbf{x})$ is the open ball of radius $\\epsilon$ centered at $\\mathbf{x}$, and $d\\Gamma_{\\mathbf{y}}$ denotes the surface measure on $\\Gamma$. Starting from the Helmholtz equation and the fundamental solution above, and using only local differential-geometric information of $\\Gamma$ near $\\mathbf{x}$ (tangent plane and smoothness), derive the leading-order asymptotic behavior of $I(\\epsilon)$ as $\\epsilon \\to 0$ and determine whether the singularity of $G(\\mathbf{x},\\mathbf{y})$ at $\\mathbf{y}=\\mathbf{x}$ is weak, strong, or hypersingular in the sense of surface integration over $\\Gamma$. Report the limit value $\\lim_{\\epsilon\\to 0} I(\\epsilon)$ as your final answer. No rounding is required and no units need be reported in the final answer.",
            "solution": "The problem statement is critically validated and exhibits no flaws. It is scientifically grounded, well-posed, objective, and contains all necessary information for a rigorous solution. We may therefore proceed.\n\nThe problem requires the evaluation of the limit of a surface integral involving the free-space Green's function for the Helmholtz equation as the integration domain shrinks to the singular point. We are given the integral\n$$\nI(\\epsilon) = \\int_{\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})} G(\\mathbf{x},\\mathbf{y}) \\, d\\Gamma_{\\mathbf{y}}\n$$\nwhere $G(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp(i k |\\mathbf{x}-\\mathbf{y}|)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$, $\\Gamma$ is a smooth surface in $\\mathbb{R}^3$, $\\mathbf{x} \\in \\Gamma$, and $B_{\\epsilon}(\\mathbf{x})$ is a ball of radius $\\epsilon$ centered at $\\mathbf{x}$. We seek to find $\\lim_{\\epsilon \\to 0} I(\\epsilon)$.\n\nThe analysis of this integral is best performed in a local coordinate system centered at the point $\\mathbf{x}$. Let the origin of our coordinate system be at $\\mathbf{x}$. We align the $\\xi_1$- and $\\xi_2$-axes with an orthonormal basis for the tangent plane $T_{\\mathbf{x}}\\Gamma$, and the $\\xi_3$-axis with the normal vector $\\mathbf{n}(\\mathbf{x})$ at that point.\n\nA point $\\mathbf{y}$ on the surface $\\Gamma$ in a neighborhood of $\\mathbf{x}$ can be parametrized by the coordinates $(\\xi_1, \\xi_2)$ in the tangent plane. The position vector of $\\mathbf{y}$ relative to $\\mathbf{x}$ is given by $(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$, where $\\xi_3 = h(\\xi_1, \\xi_2)$ describes the elevation of the surface from the tangent plane. As $\\Gamma$ is smooth and the plane $\\xi_3=0$ is tangent to it at the origin, the function $h$ must satisfy $h(0,0)=0$ and $\\frac{\\partial h}{\\partial \\xi_1}(0,0) = \\frac{\\partial h}{\\partial \\xi_2}(0,0) = 0$. A Taylor expansion of $h$ around $(0,0)$ gives $h(\\xi_1, \\xi_2) = O(\\rho^2)$, where $\\rho = \\sqrt{\\xi_1^2 + \\xi_2^2}$ is the radial distance in the tangent plane.\n\nNext, we analyze the components of the integrand and the integration measure in this local coordinate system for small $\\rho$.\n\n1.  **The distance $|\\mathbf{x}-\\mathbf{y}|$**: Let $r = |\\mathbf{x}-\\mathbf{y}|$. In our local coordinates, this is the distance from the origin to the point $(\\xi_1, \\xi_2, h(\\xi_1, \\xi_2))$.\n    $$\n    r = \\sqrt{\\xi_1^2 + \\xi_2^2 + h(\\xi_1, \\xi_2)^2} = \\sqrt{\\rho^2 + O(\\rho^4)} = \\rho \\sqrt{1 + O(\\rho^2)} = \\rho \\left(1 + O(\\rho^2)\\right)\n    $$\n    For small $\\rho$, the leading-order term is simply $r \\approx \\rho$.\n\n2.  **The surface element $d\\Gamma_{\\mathbf{y}}$**: The differential surface element is given by\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + \\left(\\frac{\\partial h}{\\partial \\xi_1}\\right)^2 + \\left(\\frac{\\partial h}{\\partial \\xi_2}\\right)^2} \\, d\\xi_1 d\\xi_2\n    $$\n    Since $\\nabla h = O(\\rho)$, we have $(\\nabla h)^2 = O(\\rho^2)$. Therefore,\n    $$\n    d\\Gamma_{\\mathbf{y}} = \\sqrt{1 + O(\\rho^2)} \\, d\\xi_1 d\\xi_2 = (1+O(\\rho^2)) \\, d\\xi_1 d\\xi_2\n    $$\n    The leading-order approximation is $d\\Gamma_{\\mathbf{y}} \\approx d\\xi_1 d\\xi_2$.\n\n3.  **The integration domain $\\Gamma \\cap B_{\\epsilon}(\\mathbf{x})$**: This is the set of points $\\mathbf{y} \\in \\Gamma$ such that $|\\mathbf{x}-\\mathbf{y}|  \\epsilon$. In local coordinates, this condition is $r  \\epsilon$, which becomes $\\rho(1+O(\\rho^2))  \\epsilon$. As $\\epsilon \\to 0$, this domain on the surface is asymptotically equivalent to the open disk $D_{\\epsilon} = \\{(\\xi_1, \\xi_2) \\in \\mathbb{R}^2 \\mid \\rho  \\epsilon\\}$ in the tangent plane.\n\nSubstituting these leading-order approximations into the integral $I(\\epsilon)$, we obtain:\n$$\nI(\\epsilon) \\approx \\int_{D_{\\epsilon}} \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\, d\\xi_1 d\\xi_2\n$$\nTo evaluate this integral over the disk $D_{\\epsilon}$, we switch to polar coordinates $(\\rho, \\theta)$ in the $(\\xi_1, \\xi_2)$-plane. Here, $\\xi_1 = \\rho \\cos\\theta$, $\\xi_2 = \\rho \\sin\\theta$, and the area element is $d\\xi_1 d\\xi_2 = \\rho \\, d\\rho \\, d\\theta$. The integration limits are $0 \\le \\rho  \\epsilon$ and $0 \\le \\theta  2\\pi$.\n$$\nI(\\epsilon) \\approx \\int_0^{2\\pi} \\int_0^\\epsilon \\frac{\\exp(i k \\rho)}{4\\pi \\rho} \\rho \\, d\\rho \\, d\\theta\n$$\nThe factor of $\\rho$ from the polar coordinate Jacobian cancels the $\\rho$ in the denominator of the Green's function. This cancellation is the key reason the singularity is weak.\n$$\nI(\\epsilon) \\approx \\frac{1}{4\\pi} \\int_0^{2\\pi} d\\theta \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\nThe integral over $\\theta$ is $\\int_0^{2\\pi} d\\theta = 2\\pi$.\n$$\nI(\\epsilon) \\approx \\frac{2\\pi}{4\\pi} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\frac{1}{2} \\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho\n$$\nThe remaining integral with respect to $\\rho$ is elementary:\n$$\n\\int_0^\\epsilon \\exp(i k \\rho) \\, d\\rho = \\left[ \\frac{\\exp(i k \\rho)}{ik} \\right]_0^\\epsilon = \\frac{\\exp(i k \\epsilon) - \\exp(0)}{ik} = \\frac{\\exp(i k \\epsilon) - 1}{ik}\n$$\nThus, the leading-order asymptotic expression for $I(\\epsilon)$ is:\n$$\nI(\\epsilon) \\approx \\frac{\\exp(i k \\epsilon) - 1}{2ik}\n$$\nTo find the required limit, we let $\\epsilon \\to 0$ in this expression. Since the exponential function is continuous, $\\lim_{\\epsilon \\to 0} \\exp(i k \\epsilon) = \\exp(0) = 1$.\n$$\n\\lim_{\\epsilon \\to 0} I(\\epsilon) = \\lim_{\\epsilon \\to 0} \\frac{\\exp(i k \\epsilon) - 1}{2ik} = \\frac{1 - 1}{2ik} = 0\n$$\nThe leading-order behavior of $I(\\epsilon)$ can be found by a Taylor expansion of the exponential term for small $\\epsilon$:\n$$\n\\exp(i k \\epsilon) = 1 + i k \\epsilon + O((k\\epsilon)^2)\n$$\nSubstituting this into our expression for $I(\\epsilon)$:\n$$\nI(\\epsilon) \\approx \\frac{(1 + i k \\epsilon + O(\\epsilon^2)) - 1}{2ik} = \\frac{i k \\epsilon + O(\\epsilon^2)}{2ik} = \\frac{\\epsilon}{2} + O(\\epsilon^2)\n$$\nThis confirms that $I(\\epsilon) \\to 0$ as $\\epsilon \\to 0$.\n\nThe singularity of the kernel $G(\\mathbf{x}, \\mathbf{y})$ is of order $|\\mathbf{x}-\\mathbf{y}|^{-1}$. In a surface integral setting in $\\mathbb{R}^3$, the surface measure $d\\Gamma_{\\mathbf{y}}$ behaves locally like $\\rho \\, d\\rho \\, d\\theta$. The integrand thus behaves like $\\rho^{-1} \\cdot \\rho$, which is regular. Since the integral over any arbitrarily small neighborhood containing the singularity exists and is finite, the singularity is classified as **weak**.\n\nThe final answer is the value of the limit.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "When an evaluation point is merely *close* to a boundary element but not on it, standard numerical quadrature can still fail dramatically, a situation known as a near-singularity. This exercise introduces a powerful and practical technique for improving accuracy: singularity subtraction. You will derive an analytical correction term by integrating the singular part of the kernel over a simplified geometry , a common and effective strategy in computational methods.",
            "id": "4137057",
            "problem": "In computational acoustics, the Boundary Element Method (BEM) for the frequency-domain Helmholtz equation uses the free-space Green’s function $G_{k}(\\mathbf{r},\\mathbf{r}')=\\exp(\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$ to represent single-layer potentials. For an evaluation point $\\mathbf{r}=(0,0,\\delta)$ with $\\delta0$ and a flat triangular element $\\mathcal{T}$ lying in the plane $z=0$ with centroid at the origin and area $A$, the near-singular behavior of the single-layer integrand is governed by the leading singular term $G_{\\mathrm{sing}}(\\mathbf{r},\\mathbf{r}')=1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$. A standard centroid-based quadrature approximates the singular contribution by $A/(4\\pi\\delta)$, which incurs large error when $\\delta$ is small compared to the element size.\n\nDefine the near-singular correction $C_{\\mathrm{sing}}(A,\\delta)$ as the analytical integral of the singular part over the element minus its centroid-based approximation, i.e.,\n$$\nC_{\\mathrm{sing}}(A,\\delta)\\equiv \\int_{\\mathcal{T}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\;-\\; \\frac{A}{4\\pi\\delta}.\n$$\nUsing only the leading-order singular structure near the centroid and assuming the element can be locally approximated by a disk $\\mathcal{D}$ of equal area centered at the origin in the plane $z=0$, with radius $R_{e}$ chosen so that $\\pi R_{e}^{2}=A$, derive a closed-form analytical expression for $C_{\\mathrm{sing}}(A,\\delta)$ by integrating the singular kernel $1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$ exactly over $\\mathcal{D}$ and subtracting the centroid term $A/(4\\pi\\delta)$.\n\nProvide the final answer as a single closed-form expression in terms of $A$ and $\\delta$. Do not perform any numerical rounding. No physical units need to be reported in the final expression.",
            "solution": "The user has asked for a rigorous solution to a problem in computational acoustics, requiring strict adherence to scientific and formatting standards.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n-   **Context**: Boundary Element Method (BEM) for the frequency-domain Helmholtz equation.\n-   **Free-space Green’s function**: $G_{k}(\\mathbf{r},\\mathbf{r}')=\\exp(\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$.\n-   **Evaluation point**: $\\mathbf{r}=(0,0,\\delta)$ with $\\delta0$.\n-   **Element**: A flat triangular element $\\mathcal{T}$ in the plane $z=0$ with centroid at the origin and area $A$.\n-   **Leading singular term**: $G_{\\mathrm{sing}}(\\mathbf{r},\\mathbf{r}')=1/(4\\pi|\\mathbf{r}-\\mathbf{r}'|)$.\n-   **Centroid-based quadrature approximation**: $A/(4\\pi\\delta)$.\n-   **Definition of near-singular correction**: $C_{\\mathrm{sing}}(A,\\delta)\\equiv \\int_{\\mathcal{T}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\;-\\; \\frac{A}{4\\pi\\delta}$.\n-   **Core Task**: Approximate the element $\\mathcal{T}$ by a disk $\\mathcal{D}$ centered at the origin in the $z=0$ plane with radius $R_{e}$ such that $\\pi R_{e}^{2}=A$.\n-   **Objective**: Derive a closed-form analytical expression for $C_{\\mathrm{sing}}(A,\\delta)$ under this disk approximation, expressed in terms of $A$ and $\\delta$.\n\n**Step 2: Validate Using Extracted Givens**\n\n-   **Scientifically Grounded (Critical)**: The problem is firmly rooted in the well-established field of computational acoustics and numerical analysis, specifically the Boundary Element Method. The concepts of Green's functions, singular integrals, and correction schemes for near-singularities are standard and valid. The approximation of a complex geometry (triangle) by a simpler one (disk) to derive analytical correction terms is a common and legitimate technique in this domain.\n-   **Well-Posed**: The problem is well-posed. It provides an explicit definition for the quantity to be calculated, $C_{\\mathrm{sing}}(A,\\delta)$, and a clear directive to use a specific, mathematically tractable approximation (an area-equivalent disk). The inputs ($A$, $\\delta$) and the desired form of the output are unambiguous. A unique mathematical solution exists.\n-   **Objective (Critical)**: The problem statement is composed of precise, technical language, free from subjectivity, ambiguity, or opinion.\n\n**Step 3: Verdict and Action**\n\nThe problem is scientifically sound, well-posed, objective, and complete. It is therefore deemed **valid**. We may proceed with the solution.\n\n### Solution Derivation\n\nThe objective is to compute the near-singular correction term $C_{\\mathrm{sing}}(A,\\delta)$ by approximating the triangular element $\\mathcal{T}$ with a circular disk $\\mathcal{D}$ of the same area $A$. The formula to be evaluated is:\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\left( \\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' \\right) - \\frac{A}{4\\pi\\delta}\n$$\nThe disk $\\mathcal{D}$ is centered at the origin in the $z=0$ plane and has an area $A$. Its radius, $R_e$, is therefore given by the relation $\\pi R_{e}^{2}=A$, which implies $R_{e}^{2} = A/\\pi$.\n\nFirst, we evaluate the integral term. The evaluation point is $\\mathbf{r} = (0,0,\\delta)$. A source point $\\mathbf{r}'$ on the disk $\\mathcal{D}$ can be parameterized in cylindrical coordinates as $(x', y', z') = (\\rho'\\cos\\phi', \\rho'\\sin\\phi', 0)$, where $\\rho'$ is the radial distance from the origin and $\\phi'$ is the azimuthal angle. The distance $|\\mathbf{r}-\\mathbf{r}'|$ is:\n$$\n|\\mathbf{r}-\\mathbf{r}'| = \\sqrt{(0-\\rho'\\cos\\phi')^{2} + (0-\\rho'\\sin\\phi')^{2} + (\\delta-0)^{2}} = \\sqrt{(\\rho')^{2}(\\cos^{2}\\phi' + \\sin^{2}\\phi')} + \\delta^{2}} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\nThe differential surface area element in these coordinates is $\\mathrm{d}S' = \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'$. The limits of integration for the disk are $0 \\leq \\rho' \\leq R_e$ and $0 \\leq \\phi' \\leq 2\\pi$.\n\nThe integral is set up as follows:\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\int_{0}^{2\\pi} \\int_{0}^{R_e} \\frac{1}{4\\pi\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\rho'\\,\\mathrm{d}\\rho'\\,\\mathrm{d}\\phi'\n$$\nWe can factor out the constant $1/(4\\pi)$ and note that the integrand is independent of $\\phi'$, allowing the integration over $\\phi'$ to be performed directly:\n$$\n\\frac{1}{4\\pi} \\left( \\int_{0}^{2\\pi} \\mathrm{d}\\phi' \\right) \\left( \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' \\right) = \\frac{2\\pi}{4\\pi} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\frac{1}{2} \\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho'\n$$\nTo solve the remaining integral over $\\rho'$, we use the substitution $u = (\\rho')^{2} + \\delta^{2}$. This gives $\\mathrm{d}u = 2\\rho'\\,\\mathrm{d}\\rho'$, or $\\rho'\\,\\mathrm{d}\\rho' = \\frac{1}{2}\\mathrm{d}u$. The integral transforms to:\n$$\n\\int \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\int \\frac{\\frac{1}{2}\\mathrm{d}u}{\\sqrt{u}} = \\frac{1}{2} \\int u^{-1/2} \\mathrm{d}u = \\frac{1}{2} \\frac{u^{1/2}}{1/2} = \\sqrt{u} = \\sqrt{(\\rho')^{2}+\\delta^{2}}\n$$\nEvaluating the definite integral:\n$$\n\\int_{0}^{R_e} \\frac{\\rho'}{\\sqrt{(\\rho')^{2}+\\delta^{2}}} \\mathrm{d}\\rho' = \\left[ \\sqrt{(\\rho')^{2}+\\delta^{2}} \\right]_{0}^{R_e} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\sqrt{0^{2}+\\delta^{2}} = \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta\n$$\nSubstituting this back, the value of the integral term is:\n$$\n\\int_{\\mathcal{D}} \\frac{1}{4\\pi|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}S' = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right)\n$$\nNow, we can write the full expression for $C_{\\mathrm{sing}}(A,\\delta)$:\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{R_{e}^{2}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\nFinally, we substitute $R_{e}^{2} = A/\\pi$ to express the result purely in terms of the given parameters $A$ and $\\delta$.\n$$\nC_{\\mathrm{sing}}(A,\\delta) = \\frac{1}{2} \\left( \\sqrt{\\frac{A}{\\pi}+\\delta^{2}} - \\delta \\right) - \\frac{A}{4\\pi\\delta}\n$$\nThis is the final closed-form analytical expression for the near-singular correction under the specified disk approximation.",
            "answer": "$$\\boxed{\\frac{1}{2}\\left(\\sqrt{\\frac{A}{\\pi} + \\delta^{2}} - \\delta\\right) - \\frac{A}{4\\pi\\delta}}$$"
        },
        {
            "introduction": "Theory and analytical derivations culminate in robust numerical algorithms. This final practice challenges you to implement a complete singularity extraction scheme, combining the insights from the previous exercises into a working piece of code. Using a partition of unity to separate the integral into singular and smooth parts , you will combine analytical integration with numerical quadrature to build a versatile tool for accurately evaluating the potential fields that are central to BEM.",
            "id": "4137082",
            "problem": "Consider the two-dimensional acoustic potential in the static (zero-frequency) limit for which the free-space Green's function is given by $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x} - \\mathbf{y}\\|$. In boundary integral formulations for computational acoustics, one often evaluates integrals of the form\n$$\nI(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s,\n$$\nwhere $s \\in [-1,1]$ parameterizes a flat boundary segment along the $x$-axis, the field point is $\\mathbf{x}_0 = (\\xi,d)$ with $\\xi \\in \\mathbb{R}$ and $d \\ge 0$, the kernel is\n$$\nK(s;\\xi,d) = -\\frac{1}{2\\pi} \\ln\\left(\\sqrt{(s-\\xi)^2 + d^2}\\right),\n$$\nand the boundary source density is a given smooth function $\\phi(s)$. The integral is logarithmically singular when $d = 0$ and $\\xi \\in [-1,1]$, and it is near-singular when $d$ is small but positive.\n\nYour task is to implement a partition of unity to split the integral into local and global patches, apply singularity extraction on the local patch, and use standard quadrature on the global patch:\n\n1. Choose a local patch half-width parameter $\\varepsilon  0$ and define the local patch $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$. Define a partition of unity by the local weight $w_{\\mathrm{loc}}(s)$ equal to $1$ on $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$ and $0$ elsewhere, and the global weight $w_{\\mathrm{glob}}(s) = 1 - w_{\\mathrm{loc}}(s)$.\n2. On the local patch, perform singularity extraction by subtracting and adding back the term $\\phi(\\xi)\\,K(s;\\xi,d)$. More precisely, write\n$$\nI(\\xi,d) = \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\left[ K(s;\\xi,d)\\,\\big(\\phi(s)-\\phi(\\xi)\\big) \\right]\\,\\mathrm{d}s}_{\\text{local remainder}} \\;+\\; \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{local singular part (analytic)}} \\;+\\; \\underbrace{\\int_{-1}^{s_{\\mathrm{lo}}} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s + \\int_{s_{\\mathrm{hi}}}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s}_{\\text{global part}}.\n$$\n3. Evaluate the local singular part analytically. Evaluate the local remainder and the global part using standard Gauss–Legendre quadrature with a sufficiently large number of nodes to ensure numerical stability and accuracy.\n\nImplement the above algorithm for the specific choice $\\phi(s) = 1 + \\beta s$, where $\\beta$ is a real parameter. Use the following test suite of parameter sets $(\\xi, d, \\varepsilon, \\beta)$ that probes a variety of cases:\n\n- Test 1 (general near-singular, interior): $(\\xi, d, \\varepsilon, \\beta) = (0.0, 0.1, 0.2, 0.5)$.\n- Test 2 (strong near-singular, interior): $(\\xi, d, \\varepsilon, \\beta) = (0.0, 10^{-6}, 0.1, 1.0)$.\n- Test 3 (on-surface singular, interior): $(\\xi, d, \\varepsilon, \\beta) = (0.5, 0.0, 0.15, -0.3)$.\n- Test 4 (on-surface singular, near boundary truncation): $(\\xi, d, \\varepsilon, \\beta) = (0.95, 0.0, 0.2, 0.7)$.\n- Test 5 (far field, constant density): $(\\xi, d, \\varepsilon, \\beta) = (-0.3, 1.0, 0.25, 0.0)$.\n\nYour program should produce a single line of output containing the numerical values of $I(\\xi,d)$ for the five tests, in this order, as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"). The results must be real numbers (floats) in dimensionless units.",
            "solution": "The problem statement is critically validated and deemed valid. It is scientifically grounded in the theory of potential fields, specifically the application of boundary integral methods to the 2D Laplace equation, which governs static acoustics. The problem is well-posed, describing a standard numerical technique (singularity extraction) for evaluating singular and near-singular integrals. All terms, functions, and parameters are defined clearly and consistently. The provided test cases are physically plausible and serve to test the robustness of the proposed algorithm.\n\nThe core task is to compute the integral $I(\\xi,d) = \\int_{-1}^{1} K(s;\\xi,d)\\,\\phi(s)\\,\\mathrm{d}s$ for a given linear source density $\\phi(s)=1+\\beta s$ and a logarithmic kernel $K(s;\\xi,d) = -\\frac{1}{2\\pi} \\ln \\|\\mathbf{x}_0 - \\mathbf{y}\\| = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$. The field point is $\\mathbf{x}_0 = (\\xi,d)$ and the source is on the segment $[-1,1]$ on the x-axis, parameterized by $s$. The integral presents a numerical challenge when the field point $\\mathbf{x}_0$ is close to or on the source segment, i.e., when $d$ is small or zero.\n\nThe problem specifies a singularity extraction algorithm based on a partition of unity. The integral is split into three components: a local singular part that can be treated analytically, a local remainder that is numerically benign, and a global part that is also non-singular.\n\n1.  **Decomposition of the Integral**: The integration domain $[-1,1]$ is partitioned. A local patch $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}] = [\\max(-1,\\xi-\\varepsilon), \\min(1,\\xi+\\varepsilon)]$ is defined around the projection point $\\xi$. The integral $I(\\xi,d)$ is then decomposed as:\n    $$\n    I(\\xi,d) = \\underbrace{\\phi(\\xi) \\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{Local Singular Part}} \\;+\\; \\underbrace{\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{Local Remainder Part}} \\;+\\; \\underbrace{\\left(\\int_{-1}^{s_{\\mathrm{lo}}} + \\int_{s_{\\mathrm{hi}}}^{1}\\right) \\phi(s) K(s;\\xi,d)\\,\\mathrm{d}s}_{\\text{Global Part}}\n    $$\n\n2.  **Evaluation of Each Part**:\n\n    *   **Local Singular Part**: This integral is evaluated analytically. Let $J(a,b,\\xi,d) = \\int_{a}^{b} K(s;\\xi,d)\\,\\mathrm{d}s$.\n        The kernel is $K(s;\\xi,d) = -\\frac{1}{4\\pi} \\ln\\left((s-\\xi)^2 + d^2\\right)$.\n        For the case $d  0$, we find the antiderivative of $\\ln(u^2+d^2)$, where $u = s-\\xi$. The antiderivative is $F(u,d) = u \\ln(u^2+d^2) - 2u + 2d \\arctan(u/d)$. The integral over $[s_{\\mathrm{lo}}, s_{\\mathrm{hi}}]$ is evaluated using the fundamental theorem of calculus: $J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,d) = -\\frac{1}{4\\pi} [F(s_{\\mathrm{hi}}-\\xi, d) - F(s_{\\mathrm{lo}}-\\xi, d)]$.\n        For the singular case $d = 0$, the kernel simplifies to $K(s;\\xi,0) = -\\frac{1}{2\\pi} \\ln|s-\\xi|$. The antiderivative of $\\ln|u|$ is $H(u) = u \\ln|u| - u$. The integral is $J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,0) = -\\frac{1}{2\\pi} [H(s_{\\mathrm{hi}}-\\xi) - H(s_{\\mathrm{lo}}-\\xi)]$. A key detail is that $\\lim_{u\\to 0} u\\ln|u|=0$, which must be correctly handled when the integration interval includes $\\xi$.\n        The local singular part is then $\\phi(\\xi) \\cdot J(s_{\\mathrm{lo}},s_{\\mathrm{hi}},\\xi,d)$.\n\n    *   **Local Remainder Part**: This integral is $\\int_{s_{\\mathrm{lo}}}^{s_{\\mathrm{hi}}} \\big(\\phi(s)-\\phi(\\xi)\\big) K(s;\\xi,d)\\,\\mathrm{d}s$. For the given linear density $\\phi(s) = 1+\\beta s$, the difference is $\\phi(s)-\\phi(\\xi) = (1+\\beta s) - (1+\\beta\\xi) = \\beta(s-\\xi)$. The integrand becomes $\\beta(s-\\xi) K(s;\\xi,d)$. The term $(s-\\xi)$ regularizes the logarithmic singularity of the kernel, as $\\lim_{s\\to\\xi} (s-\\xi)\\ln|s-\\xi| = 0$. The resulting integrand is smooth and bounded, making it suitable for standard numerical quadrature. We employ Gauss-Legendre quadrature for high accuracy.\n\n    *   **Global Part**: This consists of two integrals, over $[-1, s_{\\mathrm{lo}}]$ and $[s_{\\mathrm{hi}}, 1]$. On these intervals, the distance $|s-\\xi|$ is always greater than or equal to the local patch half-width $\\varepsilon$ (unless the patch is truncated by the element boundary, in which case $|s-\\xi|$ is still bounded away from $0$). Therefore, the integrand $\\phi(s)K(s;\\xi,d)$ is smooth, and these integrals are also evaluated using Gauss-Legendre quadrature.\n\n3.  **Numerical Implementation**: The algorithm is implemented in a Python function. Standard Gauss-Legendre quadrature is realized using `numpy.polynomial.legendre.leggauss` to obtain nodes and weights. The logic correctly handles the special cases $d=0$ and truncated local patches (when $\\xi$ is close to $\\pm 1$). The final result for each test case is the sum of the three computed parts.",
            "answer": "```python\nimport numpy as np\n\ndef gauss_quadrature(f, a, b, n=100):\n    \"\"\"\n    Evaluates the integral of f from a to b using n-point Gauss-Legendre quadrature.\n    \"\"\"\n    if a == b:\n        return 0.0\n    nodes, weights = np.polynomial.legendre.leggauss(n)\n    \n    # Map nodes from [-1, 1] to [a, b]\n    mapped_nodes = 0.5 * (b - a) * nodes + 0.5 * (a + b)\n    \n    # Evaluate the function at the mapped nodes\n    try:\n        f_vals = f(mapped_nodes)\n    except TypeError: # If f is not vectorized\n        f_vals = np.array([f(node) for node in mapped_nodes])\n\n    # The integral is the sum of weighted function values, scaled by the interval length factor\n    integral = 0.5 * (b - a) * np.sum(weights * f_vals)\n    \n    return integral\n\n\ndef evaluate_integral(xi, d, epsilon, beta, n_quad_nodes=100):\n    \"\"\"\n    Computes the integral I(xi, d) using the singularity extraction method.\n    \"\"\"\n    # 1. Define functions and parameters\n    phi = lambda s: 1 + beta * s\n    phi_xi = phi(xi)\n    \n    # 2. Define integration domains\n    s_lo = max(-1.0, xi - epsilon)\n    s_hi = min(1.0, xi + epsilon)\n    \n    # 3. Calculate the three parts of the integral\n    \n    # === Part A: Local singular part (analytic) ===\n    if d  0:\n        # Antiderivative of ln(u^2 + d^2) is u*ln(u^2+d^2) - 2u + 2d*arctan(u/d)\n        def F_antideriv(u):\n            return u * np.log(u**2 + d**2) - 2*u + 2*d * np.arctan2(u, d)\n        \n        integral_log_term = F_antideriv(s_hi - xi) - F_antideriv(s_lo - xi)\n        # Kernel K = -1/(4*pi) * ln((s-xi)^2 + d^2)\n        analytic_local_integral_K = -0.25 / np.pi * integral_log_term\n    else:  # d == 0\n        # Antiderivative of ln|u| is u*ln|u| - u\n        def H_antideriv(u):\n            if u == 0.0:\n                return 0.0\n            return u * np.log(np.abs(u)) - u\n            \n        integral_log_term = H_antideriv(s_hi - xi) - H_antideriv(s_lo - xi)\n        # Kernel K = -1/(2*pi) * ln|s-xi|\n        analytic_local_integral_K = -0.5 / np.pi * integral_log_term\n    \n    local_singular_part = phi_xi * analytic_local_integral_K\n\n    # === Part B: Local remainder (numerical) ===\n    # Integrand is (phi(s) - phi_xi) * K(s; xi, d) = beta*(s-xi)*K(s)\n    def local_remainder_integrand(s):\n        s_minus_xi = s - xi\n        \n        if d  0:\n            log_term = np.log(s_minus_xi**2 + d**2)\n            val = beta * s_minus_xi * (-0.25 / np.pi) * log_term\n        else:  # d == 0\n            # product is (s-xi)*ln|s-xi|, which - 0 as s-xi\n            #\n            # Suppress RuntimeWarning for log(0)\n            with np.errstate(divide='ignore'):\n                 log_term = np.log(np.abs(s_minus_xi))\n            \n            product = s_minus_xi * log_term\n            # correct 0 * (-inf) = nan to 0.0\n            product = np.nan_to_num(product, nan=0.0) \n            val = beta * (-0.5 / np.pi) * product\n        return val\n\n    if beta == 0.0:\n        local_remainder_part = 0.0\n    else:\n        local_remainder_part = gauss_quadrature(local_remainder_integrand, s_lo, s_hi, n=n_quad_nodes)\n    \n    # === Part C: Global part (numerical) ===\n    # Integrand is phi(s) * K(s; xi, d)\n    def global_integrand(s):\n        term_for_log = (s - xi)**2 + d**2\n        kernel_val = -0.25 / np.pi * np.log(term_for_log)\n        return phi(s) * kernel_val\n    \n    global_part1 = gauss_quadrature(global_integrand, -1.0, s_lo, n=n_quad_nodes)\n    global_part2 = gauss_quadrature(global_integrand, s_hi, 1.0, n=n_quad_nodes)\n    global_part = global_part1 + global_part2\n    \n    # 4. Total integral\n    total_integral = local_singular_part + local_remainder_part + global_part\n    return total_integral\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (0.0, 0.1, 0.2, 0.5),    # Test 1\n        (0.0, 1e-6, 0.1, 1.0),   # Test 2\n        (0.5, 0.0, 0.15, -0.3),  # Test 3\n        (0.95, 0.0, 0.2, 0.7),   # Test 4\n        (-0.3, 1.0, 0.25, 0.0),  # Test 5\n    ]\n    \n    results = []\n    for case in test_cases:\n        xi, d, epsilon, beta = case\n        result = evaluate_integral(xi, d, epsilon, beta)\n        results.append(result)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}