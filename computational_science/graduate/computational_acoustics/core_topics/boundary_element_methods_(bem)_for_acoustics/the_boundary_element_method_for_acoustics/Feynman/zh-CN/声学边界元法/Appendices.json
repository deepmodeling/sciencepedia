{
    "hands_on_practices": [
        {
            "introduction": "这个首次实践是实现边界元法的基础练习。我们将解决一个典型问题：声波从一个声软球体上的散射，这个问题存在精确的解析解。通过开发一个谱边界元法求解器，并将总散射截面 $\\sigma_{\\text{tot}}$ 的数值结果与解析基准进行比较 ，你将获得关于整个BEM工作流程和关键的代码验证过程的实践经验。",
            "id": "4139359",
            "problem": "考虑由非齐次亥姆霍兹方程控制的三维空间中的时谐声散射，其声压场为 $p(\\mathbf{x})$，角频率为 $\\omega$，波数为 $k = \\omega / c$，其中 $c$ 为声速。我们关注的区域是刚体外部。对于半径为 $a$ 的软声球体，其球面 $\\Gamma$ 上的边界条件为 Dirichlet 条件：对所有 $\\mathbf{x} \\in \\Gamma$，$p(\\mathbf{x}) = 0$。一个沿 $z$ 轴传播的单位振幅平面波构成了入射场 $p_{\\text{inc}}(\\mathbf{x})$。散射场 $p_{\\text{scat}}(\\mathbf{x})$ 必须在无穷远处满足 Sommerfeld 辐射条件。目标是为此 Dirichlet 问题建立并求解一个外部边界元法 (BEM) 模型，该模型使用单层势表示，计算远场散射振幅，并由此计算总散射截面 $\\sigma_{\\text{tot}}$，将其表示为无量纲参数 $ka$ 的函数。\n\n从以下基础出发：\n- 球体外部总场的亥姆霍兹方程 $\\nabla^2 p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0$。\n- 使用自由空间格林函数 $G_k(\\mathbf{x},\\mathbf{y})$，将散射场 $p_{\\text{scat}}(\\mathbf{x})$ 表示为在 $\\Gamma$ 上密度为 $q(\\mathbf{y})$ 的单层势。\n- 软声边界上的边界条件 $p_{\\text{inc}}(\\mathbf{x}) + p_{\\text{scat}}(\\mathbf{x}) = 0$。\n- $G_k$ 满足 Sommerfeld 辐射条件。\n- 球谐函数在球面上的正交性和完备性，以及能将球形几何上的边界积分算子对角化的加法定理。\n\n您必须：\n1. 基于上述第一性原理，推导关于 $\\Gamma$ 上未知单层势密度 $q(\\mathbf{y})$ 的边界积分方程，并展示该算子如何对球谐函数或 Legendre 多项式模态进行对角作用，从而为模态系数生成一个可解的代数系统。\n2. 利用单层势的远场渐近性，推导远场散射振幅 $f(\\theta)$，其中 $\\theta$ 是相对于 $z$ 轴的极角，并用已解出的密度模态系数表示 $f(\\theta)$。\n3. 将总散射截面定义为 $\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\theta,\\phi)|^2 \\,\\mathrm{d}\\Omega$，并针对沿 $z$ 轴的平面波这一轴对称情况进行特化，使得 $f$ 仅依赖于 $\\theta$。通过将密度展开为 Legendre 多项式，使用谱 BEM 解数值计算 $\\sigma_{\\text{tot}}$，截断阶数需确保数值收敛。\n4. 将 $\\sigma_{\\text{tot}}$ 的数值 BEM 结果与从软声球体散射的分波分析推导出的解析基准进行验证，该基准由一个以球贝塞尔函数表示的收敛级数给出。量化相对误差。\n\n实现要求：\n- 假设半径 $a = 1\\,\\mathrm{m}$，因此 $k = ka/a = ka$ 的单位为 $\\mathrm{m}^{-1}$，总散射截面 $\\sigma_{\\text{tot}}$ 的单位为 $\\mathrm{m}^2$。以 $\\mathrm{m}^2$ 为单位报告 $\\sigma_{\\text{tot}}$。\n- 在球体上使用谱边界元法，利用单层势算子在球谐函数或 Legendre 多项式基下的对角化特性。不要将表面离散化为面元；相反，应推导并使用其在模态上的对角作用来获得模态未知数和远场振幅。\n- 通过对 $|f(\\theta)|^2$ 在单位球上使用适当的求积法进行积分，从 BEM 远场振幅数值计算 $\\sigma_{\\text{tot}}$，并将其与使用第一类和第二类球贝塞尔函数的 $\\sigma_{\\text{tot}}$ 解析基准级数进行比较。\n- 您的程序必须为以下无量纲参数 $ka$ 测试套件生成最终结果：$[0.1, 1.0, 2.3, 5.0, 10.0]$。这些情况分别涵盖了 Rayleigh 区、中等情况、非整数过渡情况、中频情况和高频情况。对于每个测试用例，计算 BEM 计算的 $\\sigma_{\\text{tot}}$ 与解析基准值之间的相对误差，定义为 $\\left|\\sigma_{\\text{tot}}^{\\text{BEM}} - \\sigma_{\\text{tot}}^{\\text{analytical}}\\right| / \\sigma_{\\text{tot}}^{\\text{analytical}}$。\n- 最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4,result5]”）。每个条目必须是一个浮点数。\n\n角度规定：所有角度均以弧度为单位。单位规定：截面必须以 $\\mathrm{m}^2$ 为单位进行计算和概念理解；然而，程序输出的是无单位的相对误差。",
            "solution": "用户的要求是使用谱边界元法 (BEM) 为软声球体建立并求解一个时谐声散射问题，并将计算出的总散射截面与解析基准进行验证。\n\n**问题验证**\n\n**步骤 1：提取已知条件**\n- **控制方程**：亥姆霍兹方程，$\\nabla^2 p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0$。\n- **几何形状**：半径为 $a$ 的球体。\n- **域**：球体外部。\n- **边界条件**：软声（Dirichlet），在球体表面 $\\Gamma$ 上 $p(\\mathbf{x}) = 0$。\n- **入射场**：沿 $z$ 轴的单位振幅平面波，$p_{\\text{inc}}(\\mathbf{x}) = e^{ikz}$。\n- **总场**：$p(\\mathbf{x}) = p_{\\text{inc}}(\\mathbf{x}) + p_{\\text{scat}}(\\mathbf{x})$。\n- **散射场表示**：单层势，$p_{\\text{scat}}(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x}, \\mathbf{y}) q(\\mathbf{y}) dS(\\mathbf{y})$，其中密度 $q(\\mathbf{y})$ 未知。\n- **格林函数**：自由空间格林函数 $G_k(\\mathbf{x}, \\mathbf{y}) = \\frac{e^{ik|\\mathbf{x}-\\mathbf{y}|}}{4\\pi|\\mathbf{x}-\\mathbf{y}|}$。\n- **辐射条件**：$p_{\\text{scat}}(\\mathbf{x})$ 必须满足 Sommerfeld 辐射条件。\n- **工具**：球谐函数、Legendre 多项式、加法定理。\n- **任务 1**：推导 $q(\\mathbf{y})$ 的边界积分方程 (BIE) 并求解其模态系数。\n- **任务 2**：用模态系数表示，推导远场散射振幅 $f(\\theta)$。\n- **任务 3**：使用 BEM 解 $f(\\theta)$ 数值计算总散射截面 $\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\theta,\\phi)|^2 \\,\\mathrm{d}\\Omega$。\n- **任务 4**：将 BEM 结果与 $\\sigma_{\\text{tot}}$ 的解析级数进行验证，并计算相对误差。\n- **实现参数**：$a = 1\\,\\mathrm{m}$。$ka$ 的测试用例：$[0.1, 1.0, 2.3, 5.0, 10.0]$。\n- **输出**：每个测试用例的相对误差列表。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题是计算声学和散射理论中的一个典型范例。亥姆霍兹方程、单层势、BEM 和分波分析都是基础且完善的概念。其物理原理是可靠的。\n- **适定性**：亥姆霍兹方程的外部 Dirichlet 问题是适定的。通过单层势的公式化可得到第一类 Fredholm 积分方程，已知对于球体上的任何非共振波数 $k$，该方程都唯一可解。\n- **客观性**：问题以精确的数学和物理术语陈述，没有歧义或主观论断。\n- **所有其他检查**：问题是完整的、一致的、可形式化的和可验证的。这是一个需要分析推导和数值实现的实质性问题。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整的解决方案。\n\n**求解推导**\n\n**1. 边界积分方程和模态解**\n\n总声压场 $p(\\mathbf{x})$ 是入射场 $p_{\\text{inc}}(\\mathbf{x})$ 和散射场 $p_{\\text{scat}}(\\mathbf{x})$ 的和。在半径为 $a$ 的软声球体上，边界条件为 $p(\\mathbf{x}) = 0$，对所有在表面 $\\Gamma$ 上的 $\\mathbf{x}$ 均成立。这意味着：\n$$p_{\\text{scat}}(\\mathbf{x}) = -p_{\\text{inc}}(\\mathbf{x}), \\quad \\text{for } \\mathbf{x} \\in \\Gamma$$\n散射场由一个具有未知表面密度分布 $q(\\mathbf{y})$ 的单层势表示：\n$$p_{\\text{scat}}(\\mathbf{x}) = (S_k q)(\\mathbf{x}) := \\int_{\\Gamma} G_k(\\mathbf{x}, \\mathbf{y}) q(\\mathbf{y}) \\, dS(\\mathbf{y})$$\n其中 $G_k(\\mathbf{x}, \\mathbf{y}) = \\frac{e^{ik|\\mathbf{x}-\\mathbf{y}|}}{4\\pi|\\mathbf{x}-\\mathbf{y}|}$ 是自由空间格林函数。将这些结合起来，得到 $q(\\mathbf{y})$ 的边界积分方程 (BIE)：\n$$(S_k q)(\\mathbf{x}) = -p_{\\text{inc}}(\\mathbf{x}), \\quad \\text{for } \\mathbf{x} \\in \\Gamma$$\n这是一个第一类 Fredholm 积分方程。对于球形几何，该算子可由球谐函数对角化。由于入射平面波 $p_{\\text{inc}}(\\mathbf{x}) = e^{ikz} = e^{ikr\\cos\\theta}$ 的轴对称性，密度 $q$ 也将是轴对称的，并且可以展开为 Legendre 多项式 $P_n(\\cos\\theta)$。\n\n球体上（$r=a$）的入射场展开为：\n$$p_{\\text{inc}}(a, \\theta) = e^{ika\\cos\\theta} = \\sum_{n=0}^{\\infty} (2n+1)i^n j_n(ka) P_n(\\cos\\theta)$$\n其中 $j_n$ 是第一类球贝塞尔函数。我们将入射场的模态系数记为 $p_{\\text{inc},n} = (2n+1)i^n j_n(ka)$。\n\n我们在相同基下展开未知密度 $q$：\n$$q(\\theta) = \\sum_{n=0}^{\\infty} q_n P_n(\\cos\\theta)$$\n单层势算子 $S_k$ 作用于球体上的基函数 $P_n$ 是乘法性的：$(S_k P_n)(\\theta) = \\lambda_n P_n(\\cos\\theta)$。其特征值 $\\lambda_n$ 是一个标准结果，由下式给出：\n$$\\lambda_n = i k a^2 j_n(ka) h_n^{(1)}(ka)$$\n其中 $h_n^{(1)}(z) = j_n(z) + iy_n(z)$ 是第一类球汉克尔函数，$y_n$ 是第二类球贝塞尔函数。\n\n将展开式代入边界积分方程并利用正交性，我们对每个模态 $n$ 的系数进行等式匹配：\n$$\\lambda_n q_n = -p_{\\text{inc},n}$$\n这就为密度 $q_n$ 的模态系数提供了一个显式代数解：\n$$q_n = -\\frac{p_{\\text{inc},n}}{\\lambda_n} = -\\frac{(2n+1)i^n j_n(ka)}{i k a^2 j_n(ka) h_n^{(1)}(ka)} = \\frac{i(2n+1)i^n}{ka^2 h_n^{(1)}(ka)}$$\n\n**2. 远场散射振幅**\n\n当 $r=|\\mathbf{x}| \\to \\infty$ 时，散射压力的远场行为是 $p_{\\text{scat}}(\\mathbf{x}) \\to f(\\theta) \\frac{e^{ikr}}{r}$。为了找到散射振幅 $f(\\theta)$，我们考察散射场表示的渐近行为。由密度分布 $q(\\mathbf{y}) = \\sum_n q_n P_n(\\cos\\theta')$ 产生的场是：\n$$p_{\\text{scat}}(r, \\theta) = \\sum_n q_n (S_k P_n)(r,\\theta) = \\sum_n q_n \\left( i k a^2 j_n(ka) h_n^{(1)}(kr) \\right) P_n(\\cos\\theta)$$\n使用汉克尔函数的大宗量渐近形式 $h_n^{(1)}(z) \\approx \\frac{1}{z} (-i)^{n+1} e^{iz}$：\n$$p_{\\text{scat}}(r, \\theta) \\approx \\sum_n q_n \\left( i k a^2 j_n(ka) \\frac{1}{kr}(-i)^{n+1} e^{ikr} \\right) P_n(\\cos\\theta)$$\n$$p_{\\text{scat}}(r, \\theta) \\approx \\frac{e^{ikr}}{r} \\left[ a^2 \\sum_n q_n j_n(ka) (-i)^n P_n(\\cos\\theta) \\right]$$\n由此，我们识别出远场振幅 $f(\\theta)$：\n$$f(\\theta) = a^2 \\sum_{n=0}^{\\infty} q_n j_n(ka) (-i)^n P_n(\\cos\\theta)$$\n代入推导出的 $q_n$ 表达式：\n$$f(\\theta) = a^2 \\sum_{n=0}^{\\infty} \\left( \\frac{i(2n+1)i^n}{ka^2 h_n^{(1)}(ka)} \\right) j_n(ka) (-i)^n P_n(\\cos\\theta)$$\n化简各项，注意到 $i^n(-i)^n = 1$：\n$$f(\\theta) = \\frac{i}{k} \\sum_{n=0}^{\\infty} (2n+1) \\frac{j_n(ka)}{h_n^{(1)}(ka)} P_n(\\cos\\theta)$$\n这个 $f(\\theta)$ 的表达式与通过标准分波分析法得到的表达式相同。\n\n**3. 总散射截面 (BEM)**\n\n总散射截面 $\\sigma_{\\text{tot}}$ 定义为总散射功率除以入射强度。对于单位振幅平面波，这是远场振幅的平方模在所有立体角上的积分：\n$$\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\hat{\\mathbf{x}})|^2 \\, d\\Omega = \\int_0^{2\\pi} \\int_0^{\\pi} |f(\\theta)|^2 \\sin\\theta \\, d\\theta \\, d\\phi$$\n由于轴对称性，对 $\\phi$ 的积分得到 $2\\pi$：\n$$\\sigma_{\\text{tot}}^{\\text{BEM}} = 2\\pi \\int_0^{\\pi} |f(\\theta)|^2 \\sin\\theta \\, d\\theta$$\n这个积分将进行数值计算。通过代换 $u = \\cos\\theta$, $du = -\\sin\\theta d\\theta$，积分变换为：\n$$\\sigma_{\\text{tot}}^{\\text{BEM}} = 2\\pi \\int_{-1}^{1} |f(\\arccos u)|^2 \\, du$$\n这个定积分非常适合使用 Gauss-Legendre 求积法计算。我们将其近似为一个加权和：\n$$\\int_{-1}^{1} g(u) \\, du \\approx \\sum_{i=1}^{N_{\\text{quad}}} w_i g(u_i)$$\n其中 $u_i$ 和 $w_i$ 分别是 Gauss-Legendre 求积节点和权重，并且 $g(u) = |f(\\arccos u)|^2$。\n\n**4. 解析基准和相对误差**\n\n$\\sigma_{\\text{tot}}$ 的解析表达式可以通过将 $f(\\theta)$ 的级数代入积分并利用 Legendre 多项式的正交性 $\\int_{-1}^{1} P_n(u)P_m(u)du = \\frac{2}{2n+1}\\delta_{nm}$ 来找到。\n令 $f(\\theta) = \\sum_n c_n P_n(\\cos\\theta)$，其中 $c_n = \\frac{i}{k}(2n+1)\\frac{j_n(ka)}{h_n^{(1)}(ka)}$。\n$$\\sigma_{\\text{tot}} = 2\\pi \\int_{-1}^{1} \\left( \\sum_n c_n P_n(u) \\right) \\left( \\sum_m c_m^* P_m(u) \\right) \\, du$$\n$$\\sigma_{\\text{tot}} = 2\\pi \\sum_{n,m} c_n c_m^* \\int_{-1}^{1} P_n(u) P_m(u) \\, du = 2\\pi \\sum_n |c_n|^2 \\frac{2}{2n+1}$$\n代入 $c_n$ 的表达式：\n$$\\sigma_{\\text{tot}}^{\\text{analytical}} = 4\\pi \\sum_{n=0}^{\\infty} \\left| \\frac{i}{k}(2n+1)\\frac{j_n(ka)}{h_n^{(1)}(ka)} \\right|^2 \\frac{1}{2n+1}$$\n$$\\sigma_{\\text{tot}}^{\\text{analytical}} = \\frac{4\\pi}{k^2} \\sum_{n=0}^{\\infty} (2n+1) \\left| \\frac{j_n(ka)}{h_n^{(1)}(ka)} \\right|^2$$\n该级数提供了解析基准。BEM 求积和解析求和都将在足够高的阶数 $N_{\\text{max}}$ 处截断以确保收敛。然后相对误差计算如下：\n$$\\text{Relative Error} = \\frac{\\left|\\sigma_{\\text{tot}}^{\\text{BEM}} - \\sigma_{\\text{tot}}^{\\text{analytical}}\\right|}{\\sigma_{\\text{tot}}^{\\text{analytical}}}$$\n该误差量化了数值求积实现相对于直接解析级数求和的准确性，两者都源自相同的基础谱表示。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn, legendre\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Computes the relative error between BEM-computed and analytical total scattering\n    cross-sections for a sound-soft sphere under plane wave incidence.\n    \"\"\"\n    a = 1.0  # Sphere radius in meters, as per problem statement.\n    test_cases_ka = [0.1, 1.0, 2.3, 5.0, 10.0]\n    \n    relative_errors = []\n\n    for ka in test_cases_ka:\n        k = ka / a # Wavenumber\n\n        # Determine a sufficient truncation order for the spectral series.\n        # This rule of thumb ensures convergence for the given ka values.\n        n_max = int(np.ceil(ka) + 15)\n        n_vals = np.arange(0, n_max + 1)\n        \n        # --- Common Calculations for Both Methods ---\n        \n        # Calculate spherical Bessel functions j_n(ka) and y_n(ka) for all n.\n        jn_ka = spherical_jn(n_vals, ka)\n        yn_ka = spherical_yn(n_vals, ka)\n        \n        # Calculate spherical Hankel functions of the first kind h_n^(1)(ka) = j_n(ka) + i*y_n(ka).\n        hn1_ka = jn_ka + 1j * yn_ka\n        \n        # Handle potential division by zero, though unlikely for real ka > 0.\n        # Replace near-zero denominators with a small number to avoid warnings/NaNs.\n        hn1_ka[np.abs(hn1_ka)  1e-300] = 1e-300\n        \n        \n        # --- 1. Analytical Benchmark Calculation ---\n        \n        # The analytical formula for total scattering cross-section is a direct series sum.\n        # sigma_tot = (4*pi/k^2) * sum_{n=0 to inf} (2n+1) * |j_n(ka) / h_n^(1)(ka)|^2\n        \n        sigma_terms = (4 * np.pi / k**2) * (2 * n_vals + 1) * (np.abs(jn_ka / hn1_ka)**2)\n        sigma_analytical = np.sum(sigma_terms)\n\n        \n        # --- 2. BEM Numerical Integration Calculation ---\n\n        # The BEM approach requires numerically integrating |f(theta)|^2 over the sphere.\n        # sigma_tot = 2*pi * integral(|f(theta)|^2 * sin(theta) d(theta)) from 0 to pi.\n        # We transform this integral via u = cos(theta) to use Gauss-Legendre quadrature.\n        # sigma_tot = 2*pi * integral(|f(arccos(u))|^2 du) from -1 to 1.\n        \n        # Far-field amplitude coefficients, c_n.\n        # f(theta) = sum_{n=0 to inf} c_n * P_n(cos(theta))\n        coeffs_fn = (1j / k) * (2 * n_vals + 1) * (jn_ka / hn1_ka)\n\n        # Set up Gauss-Legendre quadrature. The order must be high enough\n        # to accurately integrate a polynomial product of degree ~2*n_max.\n        n_quad = 2 * n_max + 2 \n        quad_nodes_u, quad_weights = leggauss(n_quad) # nodes in [-1, 1]\n\n        # Evaluate all required Legendre polynomials P_n(u) at the quadrature nodes.\n        # Pn_matrix will have shape (n_max + 1, n_quad).\n        Pn_matrix = np.array([legendre(n)(quad_nodes_u) for n in n_vals])\n        \n        # Calculate the far-field amplitude f at each quadrature node.\n        # This is a matrix-vector product summing c_n * P_n(u_i) over n for each node u_i.\n        f_vals_at_nodes = coeffs_fn @ Pn_matrix\n        \n        # Perform the quadrature: integral(g(u) du) approx. sum(w_i * g(u_i))\n        # Here, g(u) = |f(arccos(u))|^2.\n        integral_val = np.sum(quad_weights * np.abs(f_vals_at_nodes)**2)\n        \n        sigma_bem = 2 * np.pi * integral_val\n        \n        # --- 3. Compute Relative Error ---\n        \n        if sigma_analytical > 1e-12:\n            rel_error = np.abs(sigma_bem - sigma_analytical) / sigma_analytical\n        else:\n            rel_error = 0.0 # Avoid division by zero for trivial cases\n            \n        relative_errors.append(rel_error)\n\n    # Final output must a be single line with comma-separated values in brackets.\n    print(f\"[{','.join(map(str, relative_errors))}]\")\n\n\nsolve()\n```"
        },
        {
            "introduction": "在首次实现的基础上，本练习将深入探讨边界积分算子的基本性质。我们将探索声学互易定理——这是波动物理学的基石——并展示其与离散化BEM矩阵对称性之间的深刻联系。这个实践  将理论推导与数值验证相结合，让你对BEM的数学结构有更深的理解，并为调试和验证代码提供一个强有力的工具。",
            "id": "4139415",
            "problem": "考虑二维空间中均匀、各向同性、无损耗介质中的时谐声学问题，其中声压场遵循标量亥姆霍兹方程。设时间依赖性为 $e^{-i \\omega t}$，其中角频率为 $\\omega$，声速为 $c$，并定义波数 $k = \\omega / c$。设 $p_a$ 和 $p_b$ 是两个标量场，它们在一个光滑闭合边界 $\\Gamma$ 的外部区域满足齐次亥姆霍兹方程 $(\\nabla^2 + k^2) p = 0$，并在无穷远处满足 Sommerfeld 辐射条件。令 $G(\\mathbf{x}, \\mathbf{y})$ 为二维亥姆霍兹方程的自由空间格林函数，并令 $\\partial / \\partial n$ 表示在 $\\Gamma$ 上的外法向导数。所有角度均应以弧度为单位。\n\n任务 1 (原理推导)。从格林第二恒等式和 Sommerfeld 辐射条件出发，推导边界积分形式的声学互易定理：证明对于齐次亥姆霍兹方程在 $\\Gamma$ 外部的任意两个辐射解 $p_a$ 和 $p_b$，边界积分\n$$\n\\int_{\\Gamma} \\left( p_a \\, \\frac{\\partial p_b}{\\partial n} - p_b \\, \\frac{\\partial p_a}{\\partial n} \\right) \\, d\\Gamma = 0.\n$$\n解释该互易恒等式如何意味着自由空间格林函数 $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$ 的对称性，并用此证明声学边界元法 (BEM) 中边界积分算子的对称性。\n\n任务 2 (算子对称性推论)。使用边界积分表示框架，定义作用于边界密度 $\\varphi$ 的单层算子 $\\mathcal{S}$ 为\n$$\n(\\mathcal{S} \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}),\n$$\n双层算子 $\\mathcal{K}$ 为\n$$\n(\\mathcal{K} \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}),\n$$\n以及伴随双层算子 $\\mathcal{K}'$ 为\n$$\n(\\mathcal{K}' \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{x}}} \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}).\n$$\n利用互易恒等式和对称性 $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$，解释为什么 $\\mathcal{S}$ 关于标准 $L^2(\\Gamma)$ 对偶配对是对称的，以及为什么 $\\mathcal{K}'$ 是 $\\mathcal{K}$ 的伴随算子，即，对于足够光滑的密度 $\\phi$ 和 $\\psi$，\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\langle \\mathcal{S} \\phi, \\psi \\rangle, \\quad \\langle \\phi, \\mathcal{K} \\psi \\rangle = \\langle \\mathcal{K}' \\phi, \\psi \\rangle,\n$$\n其中 $\\langle \\cdot, \\cdot \\rangle$ 表示 $L^2(\\Gamma)$ 对偶配对。\n\n任务 3 (离散化与数值验证)。使用 $N$ 个常数单元（分片常数基函数和单元质心处的配置）将 $\\Gamma$ 离散化为单位圆。使用二维亥姆霍兹方程的自由空间格林函数，\n$$\nG(\\mathbf{x}, \\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(k \\, \\|\\mathbf{x} - \\mathbf{y}\\|),\n$$\n其中 $H_0^{(1)}$ 是第一类 0 阶 Hankel 函数。通过以下方式近似单层矩阵 $S \\in \\mathbb{C}^{N \\times N}$\n$$\nS_{ij} \\approx G(\\mathbf{x}_i, \\mathbf{y}_j) \\, w_j,\n$$\n以及双层矩阵 $K \\in \\mathbb{C}^{N \\times N}$ 和伴随双层矩阵 $K' \\in \\mathbb{C}^{N \\times N}$\n$$\nK_{ij} \\approx \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}}} \\, w_j, \\quad K'_{ij} \\approx \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}}} \\, w_j,\n$$\n其中 $w_j$ 是板元长度，$\\mathbf{x}_i$ 是单元 $i$ 的配置点和外法线，而 $\\mathbf{y}_j$ 及其外法线与单元 $j$ 相关联。使用 $G$ 相对于分离距离 $r = \\|\\mathbf{x} - \\mathbf{y}\\|$ 的径向导数恒等式，\n$$\n\\frac{\\partial G}{\\partial r}(r) = -\\frac{i k}{4} H_1^{(1)}(k r),\n$$\n以及关系式\n$$\n\\nabla_{\\mathbf{x}} G = \\frac{\\partial G}{\\partial r} \\, \\frac{\\mathbf{x} - \\mathbf{y}}{r}, \\quad \\nabla_{\\mathbf{y}} G = -\\nabla_{\\mathbf{x}} G,\n$$\n因此\n$$\n\\frac{\\partial G}{\\partial n_{\\mathbf{y}}}(\\mathbf{x}, \\mathbf{y}) = \\nabla_{\\mathbf{y}} G(\\mathbf{x}, \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{y}} = -\\frac{\\partial G}{\\partial r}(r) \\, \\frac{(\\mathbf{x} - \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{y}}}{r},\n$$\n$$\n\\frac{\\partial G}{\\partial n_{\\mathbf{x}}}(\\mathbf{x}, \\mathbf{y}) = \\nabla_{\\mathbf{x}} G(\\mathbf{x}, \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{x}} = \\frac{\\partial G}{\\partial r}(r) \\, \\frac{(\\mathbf{x} - \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{x}}}{r}.\n$$\n为数值评估互易性引起的对称性，定义以下排除对角线项的无量纲残差（以避免简单求积方法无法解决的表面奇异极限）：\n$$\n\\varepsilon_S = \\frac{\\max_{i \\neq j} \\left| S_{ij} - S_{ji} \\right|}{\\max_{i \\neq j} \\left| S_{ij} \\right|}, \\quad\n\\varepsilon_K = \\frac{\\max_{i \\neq j} \\left| K_{ji} - K'_{ij} \\right|}{\\max_{i \\neq j} \\left| K'_{ij} \\right|}.\n$$\n您的程序必须对以下每个测试用例评估 $(\\varepsilon_S, \\varepsilon_K)$，每个用例由 $(k, N)$ 指定：\n- 测试用例 1：$(k, N) = (5.0, 80)$,\n- 测试用例 2：$(k, N) = (10^{-3}, 80)$,\n- 测试用例 3：$(k, N) = (20.0, 200)$。\n所有输出都要求是无量纲实数。您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果\n$$\n[\\varepsilon_S^{(1)}, \\varepsilon_K^{(1)}, \\varepsilon_S^{(2)}, \\varepsilon_K^{(2)}, \\varepsilon_S^{(3)}, \\varepsilon_K^{(3)}].\n$$\n不应打印任何额外文本。所有中间角度计算必须以弧度为单位进行。由于输出是无量纲的，最终数值中不需要物理单位。",
            "solution": "该问题被评估为有效，因为它在声学和位势论原理上具有科学依据，是适定的、客观的，并包含完整理论推导和数值实现所需的所有必要信息。\n\n### 任务 1：声学互易定理的推导\n\n我们从格林第二恒等式开始，对于两个足够光滑的标量场 $p_a$ 和 $p_b$，在一个边界为 $\\partial\\Omega$ 的区域 $\\Omega$ 内：\n$$\n\\int_{\\Omega} \\left( p_a \\nabla^2 p_b - p_b \\nabla^2 p_a \\right) dV = \\int_{\\partial\\Omega} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) dS.\n$$\n在我们的二维问题中，场 $p_a$ 和 $p_b$ 是在闭合边界 $\\Gamma$ 的外部区域 $\\Omega_{ext}$ 中齐次亥姆霍兹方程 $(\\nabla^2 + k^2)p = 0$ 的解。这意味着 $\\nabla^2 p_a = -k^2 p_a$ 和 $\\nabla^2 p_b = -k^2 p_b$。将这些代入格林恒等式的体积分项得到：\n$$\np_a \\nabla^2 p_b - p_b \\nabla^2 p_a = p_a(-k^2 p_b) - p_b(-k^2 p_a) = -k^2 p_a p_b + k^2 p_b p_a = 0.\n$$\n因此，在 $\\Omega_{ext}$ 内任何区域上的体积分都为零。我们将格林恒等式应用于内部边界为 $\\Gamma$、外部边界为半径为 $R$ 的大圆 $C_R$ 的区域 $\\Omega_R$。该区域的边界为 $\\partial\\Omega_R = \\Gamma \\cup C_R$。$\\Omega_R$ 上的体积分为零，因此其边界上的面积分也必须为零：\n$$\n\\int_{\\Gamma \\cup C_R} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) d\\Gamma = 0.\n$$\n令法向量 $\\mathbf{n}$ 指向积分区域 $\\Omega_R$ 的外部。在 $\\Gamma$ 上，该法线指向 $\\Gamma$ 包围的物体内部，这与问题陈述中定义的外法线方向相反。在 $C_R$ 上，该法线是径向方向，$\\mathbf{n} = \\mathbf{\\hat{r}}$。我们可以将积分拆分为：\n$$\n\\int_{C_R} \\left( p_a \\frac{\\partial p_b}{\\partial r} - p_b \\frac{\\partial p_a}{\\partial r} \\right) d\\Gamma - \\int_{\\Gamma} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) d\\Gamma = 0,\n$$\n其中在 $\\Gamma$ 上，$\\partial/\\partial n$ 现在表示从物体指向外部的法向导数，与问题陈述一致。\n\n场 $p_a$ 和 $p_b$ 满足 Sommerfeld 辐射条件，该条件在二维中规定，对于大的径向距离 $r$，场 $p$ 的行为如下：\n$$\np(\\mathbf{x}) = \\mathcal{O}(r^{-1/2}) \\quad \\text{and} \\quad \\frac{\\partial p}{\\partial r} - ikp = o(r^{-1/2}),\n$$\n其中 $o(r^{-1/2})$ 表示比 $r^{-1/2}$ 衰减更快的项。根据第二个条件，我们可以写出 $\\frac{\\partial p}{\\partial r} = ikp + o(r^{-1/2})$。将其代入 $C_R$ 上的积分的被积函数中：\n$$\np_a \\frac{\\partial p_b}{\\partial r} - p_b \\frac{\\partial p_a}{\\partial r} = p_a (ikp_b + o(r^{-1/2})) - p_b (ikp_a + o(r^{-1/2})) = p_a o_b(r^{-1/2}) - p_b o_a(r^{-1/2}).\n$$\n由于 $p_a = \\mathcal{O}(r^{-1/2})$ 且 $p_b = \\mathcal{O}(r^{-1/2})$，被积函数的阶为 $\\mathcal{O}(r^{-1/2}) o(r^{-1/2}) = o(r^{-1})$。在 $C_R$ 上的线元为 $d\\Gamma = R d\\theta$。因此，$C_R$ 上的积分为：\n$$\n\\lim_{R\\to\\infty} \\int_0^{2\\pi} o(R^{-1}) R d\\theta = \\lim_{R\\to\\infty} o(1) = 0.\n$$\n当 $R \\to \\infty$ 时，外圆 $C_R$ 上的积分消失。这就得到了我们所期望的边界积分形式的声学互易定理：\n$$\n\\int_{\\Gamma} \\left( p_a \\, \\frac{\\partial p_b}{\\partial n} - p_b \\, \\frac{\\partial p_a}{\\partial n} \\right) \\, d\\Gamma = 0.\n$$\n该恒等式是在指定边界条件下亥姆霍兹算子自伴随性的一个基本推论。\n\n为了证明自由空间格林函数的对称性 $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$，我们可以使用分布形式的格林恒等式。格林函数是 $(\\nabla^2 + k^2)G(\\mathbf{z}, \\mathbf{x}) = -\\delta(\\mathbf{z}-\\mathbf{x})$ 的解，其中 $\\delta$ 是 Dirac delta 函数。令 $p_a(\\mathbf{z}) = G(\\mathbf{z}, \\mathbf{x})$ 且 $p_b(\\mathbf{z}) = G(\\mathbf{z}, \\mathbf{y})$。两者都是辐射解。将广义格林恒等式应用于整个空间 $\\mathbb{R}^2$ 可得：\n$$\n\\int_{\\mathbb{R}^2} \\left( G(\\mathbf{z}, \\mathbf{x}) (\\nabla^2+k^2)G(\\mathbf{z}, \\mathbf{y}) - G(\\mathbf{z}, \\mathbf{y}) (\\nabla^2+k^2)G(\\mathbf{z}, \\mathbf{x}) \\right) dV(\\mathbf{z}) = 0.\n$$\n由于 Sommerfeld 条件，无穷远处的边界积分为零。利用格林函数的定义性质：\n$$\n\\int_{\\mathbb{R}^2} \\left( G(\\mathbf{z}, \\mathbf{x}) [-\\delta(\\mathbf{z}-\\mathbf{y})] - G(\\mathbf{z}, \\mathbf{y}) [-\\delta(\\mathbf{z}-\\mathbf{x})] \\right) dV(\\mathbf{z}) = 0.\n$$\n根据 delta 函数的筛选性质，上式简化为：\n$$\n-G(\\mathbf{y}, \\mathbf{x}) + G(\\mathbf{x}, \\mathbf{y}) = 0 \\implies G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x}).\n$$\n格林函数的这种内在对称性是其所描述的基本相互作用具有互易性的原因。在边界元法的背景下，积分算子是由这个格林函数构建的。格林函数核的对称性直接导致了所得算子的对称性，例如单层算子的对称性。\n\n### 任务 2：算子对称性推论\n\n边界积分算子使用格林函数 $G(\\mathbf{x}, \\mathbf{y})$ 作为其核函数来定义。它们的性质继承自该核函数的性质。我们使用 $L^2(\\Gamma)$ 对偶配对，对于 $\\Gamma$ 上的两个函数 $\\phi, \\psi$ 定义为 $\\langle \\phi, \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y})$。注意，这并非厄米特内积，因为它缺少复共轭。\n\n单层算子 $\\mathcal{S}$ 的对称性：\n该算子定义为 $(\\mathcal{S} \\psi)(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y})$。为了证明其对称性，我们必须证明 $\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\langle \\mathcal{S} \\phi, \\psi \\rangle$。\n我们来计算左边：\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{x}) (\\mathcal{S} \\psi)(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\phi(\\mathbf{x}) \\left( \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) \\right) d\\Gamma(\\mathbf{x}).\n$$\n这是一个在 $\\Gamma \\times \\Gamma$ 上的二重积分。假设密度函数是良态的，我们可以应用 Fubini 定理来交换积分顺序：\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} \\phi(\\mathbf{x}) G(\\mathbf{x}, \\mathbf{y}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\n利用格林函数的对称性 $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$：\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} G(\\mathbf{y}, \\mathbf{x}) \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\n内层积分正是 $(\\mathcal{S} \\phi)(\\mathbf{y})$ 的定义。因此，\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) (\\mathcal{S} \\phi)(\\mathbf{y}) d\\Gamma(\\mathbf{y}) = \\langle \\mathcal{S} \\phi, \\psi \\rangle.\n$$\n这证实了单层算子 $\\mathcal{S}$ 关于 $L^2(\\Gamma)$ 对偶配对是对称的。\n\n$\\mathcal{K}$ 与 $\\mathcal{K}'$ 之间的伴随关系：\n算子由核函数 $K_K(\\mathbf{x}, \\mathbf{y}) = \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}}$ 和 $K_{K'}(\\mathbf{x}, \\mathbf{y}) = \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{x}}}$ 定义。如果 $\\langle \\phi, \\mathcal{B} \\psi \\rangle = \\langle \\mathcal{A} \\phi, \\psi \\rangle$，则算子 $\\mathcal{A}$ 是 $\\mathcal{B}$ 的伴随算子。我们想证明 $\\mathcal{K}'$ 是 $\\mathcal{K}$ 的伴随算子。我们从 $\\langle \\phi, \\mathcal{K} \\psi \\rangle$ 开始：\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{x}) \\left( \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) \\right) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\int_{\\Gamma} \\phi(\\mathbf{x}) \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) d\\Gamma(\\mathbf{x}).\n$$\n交换积分顺序：\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\n现在，我们来考察伴随算子的核。$\\mathcal{K}$ 的伴随算子（我们称之为 $\\mathcal{K}^*$）的核是 $K_K^*(\\mathbf{x},\\mathbf{y}) = K_K(\\mathbf{y},\\mathbf{x}) = \\frac{\\partial G(\\mathbf{y},\\mathbf{x})}{\\partial n_\\mathbf{x}}$。$\\mathcal{K}'$ 的核是 $K_{K'}(\\mathbf{x},\\mathbf{y}) = \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n_\\mathbf{x}}$。我们来证明这些核是相同的。\n利用对称性 $G(\\mathbf{y},\\mathbf{x}) = G(\\mathbf{x},\\mathbf{y})$：\n$$\n\\frac{\\partial G(\\mathbf{y},\\mathbf{x})}{\\partial n_\\mathbf{x}} = \\nabla_\\mathbf{x}G(\\mathbf{y},\\mathbf{x}) \\cdot \\mathbf{n}_\\mathbf{x} = \\nabla_\\mathbf{x}G(\\mathbf{x},\\mathbf{y}) \\cdot \\mathbf{n}_\\mathbf{x} = \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n_\\mathbf{x}}.\n$$\n这表明 $\\mathcal{K}$ 的伴随算子的核与 $\\mathcal{K}'$ 的核相同。因此，$\\mathcal{K}'$ 是 $\\mathcal{K}$ 的伴随算子。这意味着：\n$$\n\\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{y}, \\mathbf{x})}{\\partial n_{\\mathbf{x}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = (\\mathcal{K}' \\phi)(\\mathbf{y}).\n$$\n将其代回 $\\langle \\phi, \\mathcal{K} \\psi \\rangle$ 的表达式中：\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) (\\mathcal{K}' \\phi)(\\mathbf{y}) d\\Gamma(\\mathbf{y}) = \\langle \\mathcal{K}' \\phi, \\psi \\rangle.\n$$\n证明完毕。\n\n### 任务 3：离散化与数值验证\n\n理论上的对称性通过边界元法（BEM）的数值实现得到验证。边界 $\\Gamma$ 是单位圆，它被离散化为 $N$ 个等长的直线段（板元）。我们采用常数单元法，其中物理量（密度 $\\varphi$）在每个板元上被假定为常数。方程在每个板元上的单个配置点处强制执行，此处选择板元的质心作为配置点。\n\n对于将单位圆离散化为 $N$ 个板元，第 $j$ 个板元（对于 $j=0, \\dots, N-1$）的质心（配置点）位于 $\\mathbf{y}_j = (\\cos \\phi_j, \\sin \\phi_j)$，角度为 $\\phi_j = 2\\pi(j+0.5)/N$。圆上该点的外法线向量就是 $\\mathbf{n}_{\\mathbf{y}_j} = \\mathbf{y}_j$。板元长度 $w_j$ 用弧长近似，即 $w_j = w = 2\\pi/N$。\n\n连续积分算子被近似为大小为 $N \\times N$ 的复值矩阵 $S$、$K$ 和 $K'$。每个矩阵的项 $(i, j)$ 表示在板元 $i$ 的配置点 $\\mathbf{x}_i$ 处计算的板元 $j$ 上常数源的影响。配置点集合 $\\{\\mathbf{x}_i\\}$ 与源板元质心集合 $\\{\\mathbf{y}_j\\}$ 相同。\n\n当 $i \\neq j$ 时，矩阵项由下式给出：\n$S_{ij} = G(\\mathbf{x}_i, \\mathbf{y}_j) w$\n$K_{ij} = \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}_j}} w$\n$K'_{ij} = \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}_i}} w$\n\n使用问题陈述中提供的具体公式。令 $r_{ij} = \\|\\mathbf{x}_i - \\mathbf{y}_j\\|$。\n$G(\\mathbf{x}_i, \\mathbf{y}_j) = \\frac{i}{4} H_0^{(1)}(k r_{ij})$\n$\\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}_j}} = -\\left(-\\frac{ik}{4} H_1^{(1)}(k r_{ij})\\right) \\frac{(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{y}_j}}{r_{ij}}$\n$\\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}_i}} = \\left(-\\frac{ik}{4} H_1^{(1)}(k r_{ij})\\right) \\frac{(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{x}_i}}{r_{ij}}$\n\n由于是圆形几何，我们有关系式 $r_{ij} = r_{ji}$ 和 $(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{x}_i} = -(\\mathbf{x}_j - \\mathbf{y}_i) \\cdot \\mathbf{n}_{\\mathbf{y}_i}$。这些几何对称性，结合核的性质，导致了离散矩阵关系 $S = S^T$ 和 $K' = K^T$。\n\n数值实验计算矩阵 $S$、$K$ 和 $K'$，然后评估无量纲残差 $\\varepsilon_S$ 和 $\\varepsilon_K$。这些残差衡量了与预期理论对称性（$S_{ij} = S_{ji}$ 和 $K'_{ij} = K_{ji}$）的偏差。因为对于单位圆，离散化是完全对称的，所以这些残差中的任何非零值都将完全归因于浮点运算误差。我们预计这些残差将接近机器精度。针对三对波数 $k$ 和单元数 $N$ 进行计算。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import hankel1\n\n# Set the complex data type for consistency\ncomplex_dtype = np.complex128\n\ndef solve():\n    \"\"\"\n    Main function to run the BEM symmetry validation for all test cases.\n    \"\"\"\n\n    test_cases = [\n        (5.0, 80),        # Test case 1\n        (1e-3, 80),       # Test case 2\n        (20.0, 200),      # Test case 3\n    ]\n\n    results = []\n    \n    for k, N in test_cases:\n        eps_S, eps_K = calculate_residuals(k, N)\n        results.extend([eps_S, eps_K])\n\n    # Format the output as specified in the problem statement\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\n\ndef calculate_residuals(k, N):\n    \"\"\"\n    Constructs BEM matrices S, K, and K' for a discretized unit circle \n    and calculates the symmetry residuals epsilon_S and epsilon_K.\n\n    Args:\n        k (float): The wavenumber.\n        N (int): The number of boundary elements.\n\n    Returns:\n        tuple[float, float]: The computed residuals (epsilon_S, epsilon_K).\n    \"\"\"\n\n    # 1. Discretize the unit circle\n    # Angles for the centroids of N constant elements\n    phi = 2 * np.pi * (np.arange(N) + 0.5) / N\n    \n    # Collocation points (centroids)\n    points = np.zeros((N, 2), dtype=np.float64)\n    points[:, 0] = np.cos(phi)\n    points[:, 1] = np.sin(phi)\n    \n    # Outward normal vectors at collocation points (for a circle, normal=position vector)\n    normals = points\n    \n    # Panel length (arc length for each element)\n    w = 2 * np.pi / N\n\n    # 2. Assemble matrices S, K, and K'\n    S = np.zeros((N, N), dtype=complex_dtype)\n    K = np.zeros((N, N), dtype=complex_dtype)\n    Kp = np.zeros((N, N), dtype=complex_dtype) # K' matrix\n    \n    # Loop over observation points (rows, i) and source points (cols, j)\n    for i in range(N):\n        for j in range(N):\n            if i == j:\n                # Diagonal entries are excluded from residual calculation\n                continue\n            \n            # Geometric quantities\n            xi = points[i, :]\n            yj = points[j, :]\n            \n            # Vector from source to observation point\n            d_ij = xi - yj\n            r_ij = np.linalg.norm(d_ij) # Distance ||x_i - y_j||\n\n            # Hankel functions needed for kernels\n            h0_val = hankel1(0, k * r_ij)\n            h1_val = hankel1(1, k * r_ij)\n\n            # S matrix entry\n            g_val = (1j / 4) * h0_val\n            S[i, j] = g_val * w\n\n            # Normal derivatives of G for K and K'\n            dGdr_val = -(1j * k / 4) * h1_val\n            \n            # K matrix entry\n            dot_prod_ny = np.dot(d_ij, normals[j, :])\n            dGdny_val = -dGdr_val * dot_prod_ny / r_ij\n            K[i, j] = dGdny_val * w\n\n            # K' matrix entry\n            dot_prod_nx = np.dot(d_ij, normals[i, :])\n            dGdnx_val = dGdr_val * dot_prod_nx / r_ij\n            Kp[i, j] = dGdnx_val * w\n\n    # 3. Calculate residuals, excluding diagonal entries\n    off_diag_mask = ~np.eye(N, dtype=bool)\n\n    # Residual for S\n    # Note: S_ji is the (i, j) entry of the transpose of S\n    s_ij = S[off_diag_mask]\n    s_ji = S.T[off_diag_mask]\n    \n    numerator_S = np.max(np.abs(s_ij - s_ji))\n    denominator_S = np.max(np.abs(s_ij))\n    eps_S = numerator_S / denominator_S if denominator_S != 0 else 0.0\n\n    # Residual for K\n    # Note: K_ji is the (i, j) entry of the transpose of K\n    kp_ij = Kp[off_diag_mask]\n    k_ji = K.T[off_diag_mask]\n    \n    numerator_K = np.max(np.abs(k_ji - kp_ij))\n    denominator_K = np.max(np.abs(kp_ij))\n    eps_K = numerator_K / denominator_K if denominator_K != 0 else 0.0\n\n    return eps_S, eps_K\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "尽管边界元法功能强大，但标准的BEM公式存在一个关键缺陷：在特定的“非正则频率”下，其解不是唯一的。本实践将直接应对这一实际挑战。你将首先计算一个球体内部问题的非正则频率，并数值上观察标准边界积分算子在该频率下的奇异性 。然后，你将实现Burton-Miller组合场积分方程（CFIE），并验证这一先进的公式如何成功地消除了非唯一性问题，从而确保在所有频率下都能获得稳健的解。",
            "id": "4139349",
            "problem": "考虑在均匀无损流体中的时谐声学。声压场在域内满足亥姆霍兹方程 $ \\nabla^2 p + k^2 p = 0 $，其中 $ k $ 是以 $\\text{rad/m}$ 为单位的波数。在一个光滑的闭合边界上，可以使用边界元法（BEM; Boundary Element Method）求解内部边值问题。然而，某些波数会导致边界积分方程的非唯一解，这被称为奇异频率。对于半径为 $ a $ 的球体，在球坐标系中进行变量分离表明，内部本征函数的形式为 $ R_n(r) Y_n^m(\\theta,\\varphi) $，其中 $ Y_n^m $ 是球谐函数，径向函数 $ R_n(r) $ 是第一类球贝塞尔函数 $ j_n(kr) $。在 $ r = a $ 处施加边界条件，仅当边界条件简化为以 $ j_n(ka) $ 或其径向导数 $ j_n'(ka) $ 表示的本征频率条件时，才存在非平凡的内部解。\n\n您的任务是显式计算与球体内部狄利克雷问题相关的奇异频率，然后通过结合狄利克雷和诺伊曼边界积分方程，数值演示 Burton–Miller 组合场积分方程（CFIE; Combined Field Integral Equation）如何消除非唯一性。该演示必须纯粹在模态（球谐）域中进行，其中边界算子相对于 $ n $ 和 $ m $ 是对角化的。\n\n从亥姆霍兹方程和球坐标变量分离出发，论证为何半径为 $ a $ 的球体的内部狄利克雷奇异频率对应于满足 $ j_n(ka) = 0 $（对于某个非负整数 $ n $）的正波数 $ k $ 的集合。然后，考虑模态形式的 Burton–Miller CFIE，其在每个球谐模态上的对角作用（在非零缩放因子内）可以通过组合 $ j_n(ka) $ 和 $ j_n'(ka) $ 表示为 $ j_n(ka) + i \\eta j_n'(ka) $，其中 $ \\eta $ 是一个非零实数耦合参数，$ i $ 是虚数单位。解释为什么当 $ \\eta \\neq 0 $ 时，对于那些使得 $ j_n(ka) = 0 $ 的 $ k $，这种组合消除了非唯一性。\n\n程序要求：\n\n- 使用 $ a = 1 $ 米。所有波数 $ k $ 必须以 $\\text{rad/m}$ 为单位报告。\n- 为 $ j_n(x) $ 实现数值求根，以找到 $ j_n(x) $ 对于 $ n \\in \\{0,1,2\\} $ 中每个 $ n $ 的第一个正根 $ x_{n,1} $，并将其转换为奇异频率 $ k_{n,1} = x_{n,1} / a $（单位为 $\\text{rad/m}$）。在 $ x \\in (0, 20) $ 上使用稳健的区间法来找到 $ j_n(x) $ 的第一个符号变化，并应用一个区间求根求解器。\n- 为演示标准内部狄利克雷边界积分算子的非唯一性，构造一个模态对角算子，其元素为 $ j_n(ka) $，$ n = 0,1,\\dots,N_{\\max} $ 且 $ N_{\\max} = 10 $。将该对角算子的最小奇异值定义为 $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) | $。在 $ k = k_{1,1} $ 处评估此最小奇异值，并使用阈值 $ 10^{-12} $ 返回一个布尔值，指示其是否在数值上为零。\n- 为演示 Burton–Miller CFIE 如何消除非唯一性，构造组合模态对角元素 $ j_n(ka) + i \\eta j_n'(ka) $，其中 $ \\eta = 1 $，并在相同的 $ k = k_{1,1} $ 处评估相应的最小奇异值。使用阈值 $ 10^{-6} $ 返回一个布尔值，指示其是否为严格正数。\n- 作为奇异频率附近的边缘情况检查，在一个微扰的波数 $ k = k_{1,1} + \\delta k $（其中 $ \\delta k = 10^{-3} $ $\\text{rad/m}$）处评估两个最小奇异值，并将这两个值作为浮点数返回。\n\n测试套件：\n\n- 情况 $ 1 $ (正常路径): 计算 $ n \\in \\{0,1,2\\} $ 的前几个奇异频率 $ k_{n,1} $，以 $\\text{rad/m}$ 表示，四舍五入到 $ 6 $ 位小数。\n- 情况 $ 2 $ (奇异频率处的非唯一性): 对于 $ N_{\\max} = 10 $、$ \\eta = 1 $ 和 $ k = k_{1,1} $，返回一个布尔值，指示 $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) |  10^{-12} $ 是否成立。\n- 情况 $ 3 $ (相同频率下 Burton–Miller 的唯一性): 对于 $ N_{\\max} = 10 $、$ \\eta = 1 $ 和 $ k = k_{1,1} $，返回一个布尔值，指示 $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) | > 10^{-6} $ 是否成立。\n- 情况 $ 4 $ (根附近的边缘条件): 对于 $ N_{\\max} = 10 $、$ \\eta = 1 $ 和 $ k = k_{1,1} + \\delta k $（其中 $ \\delta k = 10^{-3} $ $\\text{rad/m}$），返回包含两个浮点数的列表 $ [ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) |, \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) | ] $，每个值四舍五入到 $ 6 $ 位小数。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。第一个元素必须是 $ n=0,1,2 $ 的前几个奇异频率的嵌套列表（每个频率为浮点数，四舍五入到 $ 6 $ 位小数，单位为 $\\text{rad/m}$），第二个元素必须是情况 $ 2 $ 的布尔值，第三个元素必须是情况 $ 3 $ 的布尔值，第四个元素必须是情况 $ 4 $ 的两个浮点数的嵌套列表，四舍五入到 $ 6 $ 位小数。例如，正确的格式为：$ [ [x_0,x_1,x_2], \\text{True}, \\text{True}, [y_1,y_2] ] $。",
            "solution": "分析始于对问题陈述的验证。\n\n### 步骤1：提取给定信息\n- **控制方程**：声压场 $p$ 满足亥姆霍兹方程 $\\nabla^2 p + k^2 p = 0$，其中 $k$ 是以 $\\text{rad/m}$ 为单位的波数。\n- **区域**：光滑闭合边界（特别是半径为 $a$ 的球体）内的均匀无损流体。\n- **问题背景**：使用边界元法 (BEM) 求解的内部边值问题。\n- **现象**：边界积分方程在某些波数处解不唯一，这些波数被称为奇异频率。\n- **解的形式**：对于球体，内部本征函数的形式为 $R_n(r) Y_n^m(\\theta,\\varphi)$，其中 $Y_n^m$ 是球谐函数，$R_n(r)$ 是第一类球贝塞尔函数 $j_n(kr)$。\n- **奇异频率条件（狄利克雷）**：对于半径为 $a$ 的球体的内部狄利克雷问题，奇异频率是满足 $j_n(ka) = 0$（对于某个非负整数 $n$）的正波数 $k$。\n- **Burton-Miller CFIE**：组合场积分方程 (CFIE) 算子的模态表示由组合 $j_n(ka) + i \\eta j_n'(ka)$ 给出，其中 $i$ 是虚数单位，$\\eta$ 是一个非零实数耦合参数。\n- **数值参数**：\n    - 球体半径：$a = 1$ 米。\n    - 耦合参数：$\\eta = 1$。\n    - 数值评估的最大球谐阶数：$N_{\\max} = 10$。\n    - 求根范围 $x=ka$：$x \\in (0, 20)$。\n    - 波数微扰：$\\delta k = 10^{-3}$ $\\text{rad/m}$。\n    - 标准 BIE 的数值零阈值：$10^{-12}$。\n    - CFIE 的正性阈值：$10^{-6}$。\n- **计算任务**：\n    1. 通过找到 $j_n(x)$ 的第一个正根 $x_{n,1}$，计算 $n \\in \\{0,1,2\\}$ 的第一个正奇异频率 $k_{n,1}$，并设 $k_{n,1} = x_{n,1}/a$。\n    2. 在 $k=k_{1,1}$ 处评估 $\\min_{0 \\le n \\le N_{\\max}} | j_n(ka) |$，并检查其是否小于 $10^{-12}$。\n    3. 在 $k=k_{1,1}$ 处，当 $\\eta=1$ 时，评估 $\\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) |$，并检查其是否大于 $10^{-6}$。\n    4. 在微扰波数 $k = k_{1,1} + \\delta k$ 处评估两个最小奇异值。\n\n### 步骤2：使用提取的给定信息进行验证\n- **科学依据**：该问题基于声学和数学物理学的基本原理。亥姆霍兹方程、球坐标中的变量分离、球贝塞尔函数、边界积分方程、奇异频率的概念以及 Burton-Miller CFIE 都是计算声学中标准且成熟的课题。其表述是正确的。\n- **适定性**：该问题是适定的。它要求基于明确定义的数学函数和参数进行特定的数值计算。目标明确，并且可以确定一组唯一的数值结果。\n- **客观性**：问题陈述使用精确、客观和技术性的语言，不含任何主观性或意见。\n- **完整性和一致性**：该问题是自洽的。它提供了所有必要的常数（$a=1$, $\\eta=1$）、函数（$j_n(x)$）、范围（$x \\in (0, 20)$，$n \\in \\{0, \\dots, 10\\}$）、阈值以及对所需计算的清晰描述。没有矛盾之处。\n- **其他缺陷**：该问题并非微不足道、隐喻性或超出科学验证范围。它代表了 BEM 中一个核心概念的标准（尽管是简化的）演示。\n\n### 步骤3：结论与行动\n问题陈述是有效的。它在科学上是合理的、适定的和完整的。将提供完整的解决方案。\n\n---\n\n### 理论基础和求解推导\n\n在无源、均匀、无损耗的流体中，时谐声压场 $p$ 由亥姆霍兹方程控制：\n$$ \\nabla^2 p + k^2 p = 0 $$\n其中 $k = \\omega/c$ 是声学波数，$\\omega$ 是角频率，$c$ 是声速。我们考虑半径为 $a$ 的球体内部。在球坐标 $(r, \\theta, \\varphi)$ 中，通过变量分离法可以得到在整个域内正则的亥姆霍兹方程的解。这些解可以表示为各种模态的叠加：\n$$ p(r, \\theta, \\varphi) = \\sum_{n=0}^{\\infty} \\sum_{m=-n}^{n} A_{nm} j_n(kr) Y_n^m(\\theta, \\varphi) $$\n这里，$Y_n^m(\\theta, \\varphi)$ 是球谐函数，它们在单位球面上构成一个标准正交基；$j_n(kr)$ 是第一类球贝塞尔函数。之所以选择 $j_n(kr)$ 而不是径向方程的其他解（如球诺伊曼函数 $y_n(kr)$），是由于物理要求声压场在原点（$r=0$）处必须保持有限。\n\n用于内部狄利克雷问题的边界元法 (BEM) 涉及求解一个边界积分方程。然而，该方程在一组离散的波数（称为“奇异频率”）处无法得到唯一解。这些频率恰好对应于相关齐次内部问题的本征频率。对于内部狄利克雷问题，齐次问题是：\n$$ \\nabla^2 p + k^2 p = 0 \\quad \\text{for } r  a $$\n$$ p = 0 \\quad \\text{on } r = a $$\n当且仅当波数 $k$ 是一个本征频率时，存在非平凡解 ($p \\not\\equiv 0$)。将通解形式代入边界条件，得到：\n$$ \\sum_{n=0}^{\\infty} \\sum_{m=-n}^{n} A_{nm} j_n(ka) Y_n^m(\\theta, \\varphi) = 0 $$\n由于球谐函数 $Y_n^m$ 的正交性，该方程对所有 $(\\theta, \\varphi)$ 成立的充要条件是每个模态的系数都为零。为了存在非平凡解，至少要有一个系数 $A_{nm}$ 不为零。这只有在特定模态 $(n,m)$ 的径向部分在边界处为零时才可能：\n$$ j_n(ka) = 0 $$\n因此，球体上内部狄利克雷问题的奇异频率集合包含了所有满足 $j_n(ka) = 0$（对于某个非负整数 $n$）的正波数 $k$。在这样的 $k$ 值下，内部狄利克雷问题的 BEM 算子变为奇异的。在模态域中，算子相对于球谐模态是对角的，对应于模态 $n$ 的对角元与 $j_n(ka)$ 成正比。当 $j_n(ka)=0$ 时，该对角元为零，使得算子矩阵奇异。\n\nBurton-Miller 组合场积分方程 (CFIE) 是一种克服此非唯一性问题的技术。它将标准边界积分方程（与单层势相关）与该方程的法向导数（与超奇异势相关）进行线性组合。这种组合通常形式为 $S + i\\eta D$，其中 $S$ 和 $D$ 分别是单层和超奇异算子，$\\eta \\neq 0$ 是一个实数耦合参数。对于球体，在模态域中，这对应于将模态项 $j_n(ka)$ 与其导数组合。如此，CFIE 的模态算子为：\n$$ C_n(k) = j_n(ka) + i \\eta j_n'(ka) $$\n其中 $j_n'(x)$ 是 $j_n(x)$ 对其自变量 $x$ 的导数。我们必须证明对于任何 $k>0$ 和任何 $n$，此表达式永远不为零。让我们考虑一个奇异频率 $k^*$，使得对于某个 $n$ 有 $j_n(k^*a) = 0$。在此波数下，CFIE 模态项变为：\n$$ C_n(k^*) = 0 + i \\eta j_n'(k^*a) = i \\eta j_n'(k^*a) $$\n贝塞尔函数（及其球函数对应物）的一个基本性质是其非平凡根都是单根。这意味着如果对于某个 $x>0$ 有 $j_n(x)=0$，那么它的导数 $j_n'(x)$ 必定不为零。由于问题指定 $\\eta$ 是一个非零实数，因此项 $i \\eta j_n'(k^*a)$ 保证不为零。因此，CFIE 模态算子 $C_n(k)$ 对于任何 $k>0$ 都没有零元，从而解决了非唯一性问题。\n\n### 数值演示\n\n我们现在将执行问题陈述中指定的数值任务。球体半径为 $a=1$ 米。所有波数 $k$ 的单位均为 $\\text{rad/m}$。\n\n**情况1：计算奇异频率**\n我们需要为 $n \\in \\{0, 1, 2\\}$ 找到球贝塞尔函数 $j_n(x)$ 的第一个正根 $x_{n,1}$。相应的奇异频率为 $k_{n,1} = x_{n,1}/a = x_{n,1}$。我们在区间 $(0, 20)$ 内数值搜索 $j_n(x)$ 的第一个符号变化以确定根的区间，然后应用数值求根算法。\n- 对于 $n=0$，$j_0(x) = \\frac{\\sin(x)}{x}$。第一个正根在 $x_{0,1} = \\pi$。\n- 对于 $n=1$，$j_1(x) = \\frac{\\sin(x)}{x^2} - \\frac{\\cos(x)}{x}$。其根是方程 $\\tan(x)=x$ 的解。\n- 对于 $n=2$，$j_2(x) = (\\frac{3}{x^2}-1)\\frac{\\sin(x)}{x} - \\frac{3\\cos(x)}{x^2}$。\n\n**情况2和3：奇异频率处的（非）唯一性**\n我们关注与 $n=1$ 对应的奇异频率 $k_{1,1}$。我们设置 $N_{\\max}=10$ 和 $\\eta=1$。对角模态算子的最小奇异值是其对角元绝对值的最小值。\n- 对于标准 BIE，算子元素为 $j_n(ka)$。最小奇异值为 $\\min_{0 \\le n \\le N_{\\max}} |j_n(ka)|$。在 $k=k_{1,1}$ 处，$n=1$ 的项是 $j_1(k_{1,1}a) = j_1(x_{1,1}) = 0$。最小奇异值在数值上应为零。\n- 对于 CFIE，算子元素为 $j_n(ka) + i \\eta j_n'(ka)$。最小奇异值为 $\\min_{0 \\le n \\le N_{\\max}} |j_n(ka) + i j_n'(ka)|$。在 $k=k_{1,1}$ 处，$n=1$ 的项是 $|j_1(k_{1,1}a) + i j_1'(k_{1,1}a)| = |0 + i j_1'(x_{1,1})| = |j_1'(x_{1,1})|$。由于 $j_1'(x_{1,1}) \\neq 0$，该项不为零。对于 $n \\neq 1$ 的所有其他项 $|j_n(k_{1,1}a) + i j_n'(k_{1,1}a)|$ 也都不为零，因为 $j_n(k_{1,1}a) \\neq 0$。因此，最小奇异值将严格为正。\n\n**情况4：奇异频率附近的行为**\n我们研究在微扰波数 $k = k_{1,1} + \\delta k$（其中 $\\delta k = 10^{-3}$）下的情况。\n- 对于标准 BIE，$n=1$ 的项是 $j_1((k_{1,1}+\\delta k)a)$。使用泰勒展开，$j_1((k_{1,1}+\\delta k)a) \\approx j_1(k_{1,1}a) + j_1'(k_{1,1}a)(\\delta k a) = 0 + j_1'(k_{1,1}a)\\delta k a$。该值很小，量级为 $\\delta k$。最小奇异值将是这个小数。\n- 对于 CFIE，$n=1$ 的项是 $|j_1((k_{1,1}+\\delta k)a) + i j_1'((k_{1,1}+\\delta k)a)|$。该值将接近于 $|0 + i j_1'(k_{1,1}a)| = |j_1'(k_{1,1}a)|$，这是一个量级为 1 的值，不是一个小数字。因此，最小奇异值应该是稳定的，不接近于零。\n\n以下代码将实现这些计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Performs the calculations as specified in the problem statement.\n    \"\"\"\n    # Define constants from the problem statement.\n    a = 1.0  # meter\n    N_max = 10\n    eta = 1.0\n    delta_k = 1e-3  # rad/m\n    dirichlet_zero_threshold = 1e-12\n    cfie_positivity_threshold = 1e-6\n    root_finding_range = (0.0, 20.0)\n\n    def find_first_positive_root(n, x_min, x_max, num_steps=2000):\n        \"\"\"\n        Finds the first positive root of the spherical Bessel function j_n(x).\n        \"\"\"\n        # We need to start evaluation slightly away from 0 to avoid division by zero for some functions.\n        x_start = 1e-9 if n  0 else x_min + 1e-9\n        \n        # Scan for the first interval where a sign change occurs.\n        x_vals = np.linspace(x_start, x_max, num_steps)\n        jn_vals = spherical_jn(n, x_vals)\n        \n        for i in range(len(jn_vals) - 1):\n            if np.sign(jn_vals[i]) != np.sign(jn_vals[i+1]):\n                # Found a bracket for the root\n                try:\n                    root = brentq(lambda x: spherical_jn(n, x), x_vals[i], x_vals[i+1])\n                    return root\n                except ValueError:\n                    # brentq fails if signs are not different, though we checked.\n                    # This is a fallback.\n                    continue\n        return None\n\n    # Case 1: Compute the first irregular frequencies k_n,1 for n in {0, 1, 2}.\n    k_irregular_list = []\n    for n in range(3):\n        root = find_first_positive_root(n, root_finding_range[0], root_finding_range[1])\n        k_n1 = root / a\n        k_irregular_list.append(round(k_n1, 6))\n\n    # Store k_1,1 for use in subsequent cases.\n    k11 = find_first_positive_root(1, root_finding_range[0], root_finding_range[1]) / a\n\n    # Case 2: Non-uniqueness at an irregular frequency.\n    k_test = k11\n    n_vals = np.arange(N_max + 1)\n    \n    # Standard BIE modal operator values\n    sv_dirichlet_op = np.abs(spherical_jn(n_vals, k_test * a))\n    min_sv_dirichlet = np.min(sv_dirichlet_op)\n    is_singular_dirichlet = min_sv_dirichlet  dirichlet_zero_threshold\n\n    # Case 3: Burton-Miller uniqueness at the same frequency.\n    # CFIE modal operator values\n    # Need j_n(x) and its derivative j_n'(x)\n    jn_vals = spherical_jn(n_vals, k_test * a)\n    jn_prime_vals = spherical_jn(n_vals, k_test * a, derivative=True)\n    \n    sv_cfie_op = np.abs(jn_vals + 1j * eta * jn_prime_vals)\n    min_sv_cfie = np.min(sv_cfie_op)\n    is_nonsingular_cfie = min_sv_cfie > cfie_positivity_threshold\n\n    # Case 4: Edge condition near a root.\n    k_perturbed = k11 + delta_k\n    \n    # Standard BIE at perturbed k\n    sv_dirichlet_perturbed = np.abs(spherical_jn(n_vals, k_perturbed * a))\n    min_sv_dirichlet_perturbed = np.min(sv_dirichlet_perturbed)\n\n    # CFIE at perturbed k\n    jn_perturbed = spherical_jn(n_vals, k_perturbed * a)\n    jn_prime_perturbed = spherical_jn(n_vals, k_perturbed * a, derivative=True)\n    sv_cfie_perturbed = np.abs(jn_perturbed + 1j * eta * jn_prime_perturbed)\n    min_sv_cfie_perturbed = np.min(sv_cfie_perturbed)\n\n    edge_case_values = [round(min_sv_dirichlet_perturbed, 6), round(min_sv_cfie_perturbed, 6)]\n\n    # Assemble the final result list\n    final_results = [\n        k_irregular_list,\n        is_singular_dirichlet,\n        is_nonsingular_cfie,\n        edge_case_values\n    ]\n\n    # Print the result in the specified format\n    # Custom formatting to match the example output style exactly.\n    result_str = f\"[{final_results[0]}, {str(final_results[1])}, {str(final_results[2])}, {final_results[3]}]\"\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}