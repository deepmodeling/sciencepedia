{
    "hands_on_practices": [
        {
            "introduction": "A robust numerical method should faithfully represent the underlying physics of the system it models. This practice delves into the acoustic reciprocity theorem, a fundamental principle of symmetry in wave propagation. You will first derive this theorem within the boundary integral framework  and then use it to numerically validate the symmetry properties of the discretized BEM operators, a crucial verification step in the development of any reliable BEM code.",
            "id": "4139415",
            "problem": "Consider time-harmonic acoustics in a homogeneous, isotropic, lossless medium in two spatial dimensions, where acoustic pressure fields obey the scalar Helmholtz equation. Let the temporal dependence be $e^{-i \\omega t}$, with angular frequency $\\omega$ and sound speed $c$, and define the wavenumber $k = \\omega / c$. Let $p_a$ and $p_b$ be two scalar fields that satisfy the homogeneous Helmholtz equation $(\\nabla^2 + k^2) p = 0$ in a region exterior to a smooth, closed boundary $\\Gamma$, with the Sommerfeld radiation condition at infinity. Let $G(\\mathbf{x}, \\mathbf{y})$ be the free-space Green's function for the two-dimensional Helmholtz equation, and let $\\partial / \\partial n$ denote the outward normal derivative on $\\Gamma$. All angles are to be understood in radians.\n\nTask 1 (principle derivation). Starting from Green’s second identity and the Sommerfeld radiation condition, derive the acoustic reciprocity theorem in boundary integral form: show that for any two radiating solutions $p_a$ and $p_b$ of the homogeneous Helmholtz equation exterior to $\\Gamma$, the boundary integral\n$$\n\\int_{\\Gamma} \\left( p_a \\, \\frac{\\partial p_b}{\\partial n} - p_b \\, \\frac{\\partial p_a}{\\partial n} \\right) \\, d\\Gamma = 0.\n$$\nExplain how this reciprocity identity implies symmetry of the free-space Green’s function $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$, and use this to justify symmetry properties of the boundary integral operators in the boundary element method (BEM) for acoustics.\n\nTask 2 (operator symmetry consequences). Using the boundary integral representation framework, define the single-layer operator $\\mathcal{S}$ acting on a boundary density $\\varphi$ by\n$$\n(\\mathcal{S} \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}),\n$$\nthe double-layer operator $\\mathcal{K}$ by\n$$\n(\\mathcal{K} \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}),\n$$\nand the adjoint double-layer operator $\\mathcal{K}'$ by\n$$\n(\\mathcal{K}' \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{x}}} \\, \\varphi(\\mathbf{y}) \\, d\\Gamma(\\mathbf{y}).\n$$\nUsing the reciprocity identity and the symmetry $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$, explain why $\\mathcal{S}$ is symmetric with respect to the standard $L^2(\\Gamma)$ duality pairing and why $\\mathcal{K}'$ is the adjoint of $\\mathcal{K}$, i.e., for sufficiently smooth densities $\\phi$ and $\\psi$,\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\langle \\mathcal{S} \\phi, \\psi \\rangle, \\quad \\langle \\phi, \\mathcal{K} \\psi \\rangle = \\langle \\mathcal{K}' \\phi, \\psi \\rangle,\n$$\nwhere $\\langle \\cdot, \\cdot \\rangle$ denotes the $L^2(\\Gamma)$ duality pairing.\n\nTask 3 (discretization and numerical validation). Discretize $\\Gamma$ as the unit circle using $N$ constant elements (piecewise constant basis and collocation at element centroids). Use the free-space Green’s function for the two-dimensional Helmholtz equation,\n$$\nG(\\mathbf{x}, \\mathbf{y}) = \\frac{i}{4} H_0^{(1)}(k \\, \\|\\mathbf{x} - \\mathbf{y}\\|),\n$$\nwhere $H_0^{(1)}$ is the Hankel function of the first kind of order $0$. Approximate the single-layer matrix $S \\in \\mathbb{C}^{N \\times N}$ by\n$$\nS_{ij} \\approx G(\\mathbf{x}_i, \\mathbf{y}_j) \\, w_j,\n$$\nand the double-layer $K \\in \\mathbb{C}^{N \\times N}$ and adjoint double-layer $K' \\in \\mathbb{C}^{N \\times N}$ by\n$$\nK_{ij} \\approx \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}}} \\, w_j, \\quad K'_{ij} \\approx \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}}} \\, w_j,\n$$\nwhere $w_j$ is the panel length and $\\mathbf{x}_i$ is the collocation point and outward normal at element $i$, while $\\mathbf{y}_j$ and its outward normal are associated with element $j$. Use the identities for the radial derivative of $G$ with respect to the separation distance $r = \\|\\mathbf{x} - \\mathbf{y}\\|$,\n$$\n\\frac{\\partial G}{\\partial r}(r) = -\\frac{i k}{4} H_1^{(1)}(k r),\n$$\nand the relations\n$$\n\\nabla_{\\mathbf{x}} G = \\frac{\\partial G}{\\partial r} \\, \\frac{\\mathbf{x} - \\mathbf{y}}{r}, \\quad \\nabla_{\\mathbf{y}} G = -\\nabla_{\\mathbf{x}} G,\n$$\nso that\n$$\n\\frac{\\partial G}{\\partial n_{\\mathbf{y}}}(\\mathbf{x}, \\mathbf{y}) = \\nabla_{\\mathbf{y}} G(\\mathbf{x}, \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{y}} = -\\frac{\\partial G}{\\partial r}(r) \\, \\frac{(\\mathbf{x} - \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{y}}}{r},\n$$\n$$\n\\frac{\\partial G}{\\partial n_{\\mathbf{x}}}(\\mathbf{x}, \\mathbf{y}) = \\nabla_{\\mathbf{x}} G(\\mathbf{x}, \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{x}} = \\frac{\\partial G}{\\partial r}(r) \\, \\frac{(\\mathbf{x} - \\mathbf{y}) \\cdot \\mathbf{n}_{\\mathbf{x}}}{r}.\n$$\nTo assess reciprocity-induced symmetry numerically, define the following dimensionless residuals that exclude the diagonal entries (to avoid singular on-surface limits that are not resolved by the simple quadrature):\n$$\n\\varepsilon_S = \\frac{\\max_{i \\neq j} \\left| S_{ij} - S_{ji} \\right|}{\\max_{i \\neq j} \\left| S_{ij} \\right|}, \\quad\n\\varepsilon_K = \\frac{\\max_{i \\neq j} \\left| K_{ji} - K'_{ij} \\right|}{\\max_{i \\neq j} \\left| K'_{ij} \\right|}.\n$$\nYour program must evaluate $(\\varepsilon_S, \\varepsilon_K)$ for each of the following test cases, each specified by $(k, N)$:\n- Test case $1$: $(k, N) = (5.0, 80)$,\n- Test case $2$: $(k, N) = (10^{-3}, 80)$,\n- Test case $3$: $(k, N) = (20.0, 200)$.\nAll outputs are required to be dimensionless real numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets of the form\n$$\n[\\varepsilon_S^{(1)}, \\varepsilon_K^{(1)}, \\varepsilon_S^{(2)}, \\varepsilon_K^{(2)}, \\varepsilon_S^{(3)}, \\varepsilon_K^{(3)}].\n$$\nNo additional text should be printed. All intermediate angle calculations must be performed in radians. Since the outputs are dimensionless, no physical units are required in the final numeric values.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of acoustics and potential theory, well-posed, objective, and contains all necessary information for a complete theoretical derivation and numerical implementation.\n\n### Task 1: Derivation of the Acoustic Reciprocity Theorem\n\nWe begin with Green's second identity for two sufficiently smooth scalar fields, $p_a$ and $p_b$, within a domain $\\Omega$ with boundary $\\partial\\Omega$:\n$$\n\\int_{\\Omega} \\left( p_a \\nabla^2 p_b - p_b \\nabla^2 p_a \\right) dV = \\int_{\\partial\\Omega} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) dS.\n$$\nIn our two-dimensional problem, the fields $p_a$ and $p_b$ are solutions to the homogeneous Helmholtz equation, $(\\nabla^2 + k^2)p = 0$, in the region $\\Omega_{ext}$ exterior to a closed boundary $\\Gamma$. This implies $\\nabla^2 p_a = -k^2 p_a$ and $\\nabla^2 p_b = -k^2 p_b$. Substituting these into the volume integral term of Green's identity gives:\n$$\np_a \\nabla^2 p_b - p_b \\nabla^2 p_a = p_a(-k^2 p_b) - p_b(-k^2 p_a) = -k^2 p_a p_b + k^2 p_b p_a = 0.\n$$\nTherefore, the volume integral over any domain within $\\Omega_{ext}$ is zero. Let us apply Green's identity to the domain $\\Omega_R$ bounded internally by $\\Gamma$ and externally by a large circle $C_R$ of radius $R$. The boundary of this domain is $\\partial\\Omega_R = \\Gamma \\cup C_R$. The volume integral over $\\Omega_R$ is zero, so the surface integral over its boundary must also be zero:\n$$\n\\int_{\\Gamma \\cup C_R} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) d\\Gamma = 0.\n$$\nLet the normal vector $\\mathbf{n}$ point outwards from the domain of integration $\\Omega_R$. On $\\Gamma$, this normal is directed into the object enclosed by $\\Gamma$, which is opposite to the outward normal defined in the problem statement. On $C_R$, this normal is the radial direction, $\\mathbf{n} = \\mathbf{\\hat{r}}$. We can split the integral:\n$$\n\\int_{C_R} \\left( p_a \\frac{\\partial p_b}{\\partial r} - p_b \\frac{\\partial p_a}{\\partial r} \\right) d\\Gamma - \\int_{\\Gamma} \\left( p_a \\frac{\\partial p_b}{\\partial n} - p_b \\frac{\\partial p_a}{\\partial n} \\right) d\\Gamma = 0,\n$$\nwhere on $\\Gamma$, $\\partial/\\partial n$ now denotes the outward normal derivative from the object, consistent with the problem statement.\n\nThe fields $p_a$ and $p_b$ satisfy the Sommerfeld radiation condition, which in two dimensions states that for large radial distance $r$, a field $p$ behaves as:\n$$\np(\\mathbf{x}) = \\mathcal{O}(r^{-1/2}) \\quad \\text{and} \\quad \\frac{\\partial p}{\\partial r} - ikp = o(r^{-1/2}),\n$$\nwhere $o(r^{-1/2})$ signifies a term that decays faster than $r^{-1/2}$. From the second condition, we can write $\\frac{\\partial p}{\\partial r} = ikp + o(r^{-1/2})$. Substituting this into the integrand of the integral over $C_R$:\n$$\np_a \\frac{\\partial p_b}{\\partial r} - p_b \\frac{\\partial p_a}{\\partial r} = p_a (ikp_b + o(r^{-1/2})) - p_b (ikp_a + o(r^{-1/2})) = p_a o_b(r^{-1/2}) - p_b o_a(r^{-1/2}).\n$$\nSince $p_a = \\mathcal{O}(r^{-1/2})$ and $p_b = \\mathcal{O}(r^{-1/2})$, the integrand is of order $\\mathcal{O}(r^{-1/2}) o(r^{-1/2}) = o(r^{-1})$. The line element on $C_R$ is $d\\Gamma = R d\\theta$. The integral over $C_R$ is thus:\n$$\n\\lim_{R\\to\\infty} \\int_0^{2\\pi} o(R^{-1}) R d\\theta = \\lim_{R\\to\\infty} o(1) = 0.\n$$\nThe integral over the outer circle $C_R$ vanishes as $R \\to \\infty$. This leaves us with the desired acoustic reciprocity theorem in boundary integral form:\n$$\n\\int_{\\Gamma} \\left( p_a \\, \\frac{\\partial p_b}{\\partial n} - p_b \\, \\frac{\\partial p_a}{\\partial n} \\right) \\, d\\Gamma = 0.\n$$\nThis identity is a fundamental consequence of the self-adjointness of the Helmholtz operator under the specified boundary conditions.\n\nTo show the symmetry of the free-space Green's function, $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$, we can use a distributional form of Green's identity. The Green's function is the solution to $(\\nabla^2 + k^2)G(\\mathbf{z}, \\mathbf{x}) = -\\delta(\\mathbf{z}-\\mathbf{x})$, where $\\delta$ is the Dirac delta function. Let $p_a(\\mathbf{z}) = G(\\mathbf{z}, \\mathbf{x})$ and $p_b(\\mathbf{z}) = G(\\mathbf{z}, \\mathbf{y})$. Both are radiating solutions. Applying the generalized Green's identity over all of space $\\mathbb{R}^2$ yields:\n$$\n\\int_{\\mathbb{R}^2} \\left( G(\\mathbf{z}, \\mathbf{x}) (\\nabla^2+k^2)G(\\mathbf{z}, \\mathbf{y}) - G(\\mathbf{z}, \\mathbf{y}) (\\nabla^2+k^2)G(\\mathbf{z}, \\mathbf{x}) \\right) dV(\\mathbf{z}) = 0.\n$$\nThe boundary integral at infinity vanishes due to the Sommerfeld condition. Using the defining property of the Green's function:\n$$\n\\int_{\\mathbb{R}^2} \\left( G(\\mathbf{z}, \\mathbf{x}) [-\\delta(\\mathbf{z}-\\mathbf{y})] - G(\\mathbf{z}, \\mathbf{y}) [-\\delta(\\mathbf{z}-\\mathbf{x})] \\right) dV(\\mathbf{z}) = 0.\n$$\nBy the sifting property of the delta function, this simplifies to:\n$$\n-G(\\mathbf{y}, \\mathbf{x}) + G(\\mathbf{x}, \\mathbf{y}) = 0 \\implies G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x}).\n$$\nThis inherent symmetry of the Green's function is the reason why the fundamental interactions it describes are reciprocal. In the context of BEM, the integral operators are constructed from this Green's function. The symmetry of the Green's function kernel directly leads to symmetry properties of the resulting operators, such as the symmetry of the single-layer operator.\n\n### Task 2: Operator Symmetry Consequences\n\nThe boundary integral operators are defined using the Green's function $G(\\mathbf{x}, \\mathbf{y})$ as their kernel. Their properties are inherited from the properties of this kernel. We use the $L^2(\\Gamma)$ duality pairing, defined for two functions $\\phi, \\psi$ on $\\Gamma$ as $\\langle \\phi, \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y})$. Note that this is not a Hermitian inner product as it lacks complex conjugation.\n\nSymmetry of the single-layer operator $\\mathcal{S}$:\nThe operator is defined as $(\\mathcal{S} \\psi)(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y})$. To show it is symmetric, we must demonstrate that $\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\langle \\mathcal{S} \\phi, \\psi \\rangle$.\nLet's evaluate the left-hand side:\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{x}) (\\mathcal{S} \\psi)(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\phi(\\mathbf{x}) \\left( \\int_{\\Gamma} G(\\mathbf{x}, \\mathbf{y}) \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) \\right) d\\Gamma(\\mathbf{x}).\n$$\nThis is a double integral over $\\Gamma \\times \\Gamma$. Assuming the densities are well-behaved, we can apply Fubini's theorem to switch the order of integration:\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} \\phi(\\mathbf{x}) G(\\mathbf{x}, \\mathbf{y}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\nUsing the symmetry of the Green's function, $G(\\mathbf{x}, \\mathbf{y}) = G(\\mathbf{y}, \\mathbf{x})$:\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} G(\\mathbf{y}, \\mathbf{x}) \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\nThe inner integral is precisely the definition of $(\\mathcal{S} \\phi)(\\mathbf{y})$. Therefore,\n$$\n\\langle \\phi, \\mathcal{S} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) (\\mathcal{S} \\phi)(\\mathbf{y}) d\\Gamma(\\mathbf{y}) = \\langle \\mathcal{S} \\phi, \\psi \\rangle.\n$$\nThis confirms that the single-layer operator $\\mathcal{S}$ is symmetric with respect to the $L^2(\\Gamma)$ duality pairing.\n\nAdjoint relationship between $\\mathcal{K}$ and $\\mathcal{K}'$:\nThe operators are defined by kernels $K_K(\\mathbf{x}, \\mathbf{y}) = \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}}$ and $K_{K'}(\\mathbf{x}, \\mathbf{y}) = \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{x}}}$. An operator $\\mathcal{A}$ is the adjoint of $\\mathcal{B}$ if $\\langle \\phi, \\mathcal{B} \\psi \\rangle = \\langle \\mathcal{A} \\phi, \\psi \\rangle$. We want to show $\\mathcal{K}'$ is the adjoint of $\\mathcal{K}$. We start with $\\langle \\phi, \\mathcal{K} \\psi \\rangle$:\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\phi(\\mathbf{x}) \\left( \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) \\right) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\int_{\\Gamma} \\phi(\\mathbf{x}) \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\psi(\\mathbf{y}) d\\Gamma(\\mathbf{y}) d\\Gamma(\\mathbf{x}).\n$$\nSwapping the integration order:\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) \\left( \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) \\right) d\\Gamma(\\mathbf{y}).\n$$\nNow, let's examine the kernel of the adjoint operator. The kernel of the adjoint of $\\mathcal{K}$, let's call it $\\mathcal{K}^*$, is $K_K^*(\\mathbf{x},\\mathbf{y}) = K_K(\\mathbf{y},\\mathbf{x}) = \\frac{\\partial G(\\mathbf{y},\\mathbf{x})}{\\partial n_\\mathbf{x}}$. The kernel of $\\mathcal{K}'$ is $K_{K'}(\\mathbf{x},\\mathbf{y}) = \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n_\\mathbf{x}}$. Let's show these kernels are identical.\nUsing symmetry $G(\\mathbf{y},\\mathbf{x}) = G(\\mathbf{x},\\mathbf{y})$:\n$$\n\\frac{\\partial G(\\mathbf{y},\\mathbf{x})}{\\partial n_\\mathbf{x}} = \\nabla_\\mathbf{x}G(\\mathbf{y},\\mathbf{x}) \\cdot \\mathbf{n}_\\mathbf{x} = \\nabla_\\mathbf{x}G(\\mathbf{x},\\mathbf{y}) \\cdot \\mathbf{n}_\\mathbf{x} = \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n_\\mathbf{x}}.\n$$\nThis shows that the kernel of the adjoint of $\\mathcal{K}$ is identical to the kernel of $\\mathcal{K}'$. Therefore, $\\mathcal{K}'$ is the adjoint of $\\mathcal{K}$. This means:\n$$\n\\int_{\\Gamma} \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_{\\mathbf{y}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = \\int_{\\Gamma} \\frac{\\partial G(\\mathbf{y}, \\mathbf{x})}{\\partial n_{\\mathbf{x}}} \\phi(\\mathbf{x}) d\\Gamma(\\mathbf{x}) = (\\mathcal{K}' \\phi)(\\mathbf{y}).\n$$\nSubstituting this back into the expression for $\\langle \\phi, \\mathcal{K} \\psi \\rangle$:\n$$\n\\langle \\phi, \\mathcal{K} \\psi \\rangle = \\int_{\\Gamma} \\psi(\\mathbf{y}) (\\mathcal{K}' \\phi)(\\mathbf{y}) d\\Gamma(\\mathbf{y}) = \\langle \\mathcal{K}' \\phi, \\psi \\rangle.\n$$\nThis completes the proof.\n\n### Task 3: Discretization and Numerical Validation\n\nThe theoretical symmetry properties are validated numerically using a boundary element method (BEM) implementation. The boundary $\\Gamma$ is the unit circle, which is discretized into $N$ equal-length straight-line segments (panels). We use a constant element approach, where the physical quantity (density $\\varphi$) is assumed to be constant over each panel. The equations are enforced at a single collocation point on each panel, chosen here as the panel's centroid.\n\nFor a discretization of the unit circle into $N$ panels, the $j$-th panel (for $j=0, \\dots, N-1$) has a centroid (collocation point) at $\\mathbf{y}_j = (\\cos \\phi_j, \\sin \\phi_j)$ with angle $\\phi_j = 2\\pi(j+0.5)/N$. The outward normal vector at this point on the circle is simply $\\mathbf{n}_{\\mathbf{y}_j} = \\mathbf{y}_j$. The panel length $w_j$ is approximated by the arc length, $w_j = w = 2\\pi/N$.\n\nThe continuous integral operators are approximated by complex-valued matrices $S$, $K$, and $K'$ of size $N \\times N$. The entry $(i, j)$ of each matrix represents the influence of a constant source on panel $j$ evaluated at the collocation point $\\mathbf{x}_i$ of panel $i$. The set of collocation points $\\{\\mathbf{x}_i\\}$ is identical to the set of source panel centroids $\\{\\mathbf{y}_j\\}$.\n\nThe matrix entries for $i \\neq j$ are given by:\n$S_{ij} = G(\\mathbf{x}_i, \\mathbf{y}_j) w$\n$K_{ij} = \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}_j}} w$\n$K'_{ij} = \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}_i}} w$\n\nThe specific formulas provided in the problem statement are used. Let $r_{ij} = \\|\\mathbf{x}_i - \\mathbf{y}_j\\|$.\n$G(\\mathbf{x}_i, \\mathbf{y}_j) = \\frac{i}{4} H_0^{(1)}(k r_{ij})$\n$\\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{y}_j}} = -\\left(-\\frac{ik}{4} H_1^{(1)}(k r_{ij})\\right) \\frac{(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{y}_j}}{r_{ij}}$\n$\\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y}_j)}{\\partial n_{\\mathbf{x}_i}} = \\left(-\\frac{ik}{4} H_1^{(1)}(k r_{ij})\\right) \\frac{(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{x}_i}}{r_{ij}}$\n\nDue to the circular geometry, we have the relations $r_{ij} = r_{ji}$ and $(\\mathbf{x}_i - \\mathbf{y}_j) \\cdot \\mathbf{n}_{\\mathbf{x}_i} = -(\\mathbf{x}_j - \\mathbf{y}_i) \\cdot \\mathbf{n}_{\\mathbf{y}_i}$. These geometrical symmetries, combined with the kernel properties, lead to the discrete matrix relations $S = S^T$ and $K' = K^T$.\n\nThe numerical experiment computes the matrices $S$, $K$, and $K'$ and then evaluates the dimensionless residuals $\\varepsilon_S$ and $\\varepsilon_K$. These residuals measure the deviation from the expected theoretical symmetries ($S_{ij} = S_{ji}$ and $K'_{ij} = K_{ji}$). Because the discretization is perfectly symmetric for the unit circle, any non-zero value in these residuals will be attributable solely to floating-point arithmetic errors. We expect these residuals to be near machine precision. The calculation is performed for three pairs of wavenumber $k$ and number of elements $N$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import hankel1\n\n# Set the complex data type for consistency\ncomplex_dtype = np.complex128\n\ndef solve():\n    \"\"\"\n    Main function to run the BEM symmetry validation for all test cases.\n    \"\"\"\n\n    test_cases = [\n        (5.0, 80),        # Test case 1\n        (1e-3, 80),       # Test case 2\n        (20.0, 200),      # Test case 3\n    ]\n\n    results = []\n    \n    for k, N in test_cases:\n        eps_S, eps_K = calculate_residuals(k, N)\n        results.extend([eps_S, eps_K])\n\n    # Format the output as specified in the problem statement\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\n\ndef calculate_residuals(k, N):\n    \"\"\"\n    Constructs BEM matrices S, K, and K' for a discretized unit circle \n    and calculates the symmetry residuals epsilon_S and epsilon_K.\n\n    Args:\n        k (float): The wavenumber.\n        N (int): The number of boundary elements.\n\n    Returns:\n        tuple[float, float]: The computed residuals (epsilon_S, epsilon_K).\n    \"\"\"\n\n    # 1. Discretize the unit circle\n    # Angles for the centroids of N constant elements\n    phi = 2 * np.pi * (np.arange(N) + 0.5) / N\n    \n    # Collocation points (centroids)\n    points = np.zeros((N, 2), dtype=np.float64)\n    points[:, 0] = np.cos(phi)\n    points[:, 1] = np.sin(phi)\n    \n    # Outward normal vectors at collocation points (for a circle, normal=position vector)\n    normals = points\n    \n    # Panel length (arc length for each element)\n    w = 2 * np.pi / N\n\n    # 2. Assemble matrices S, K, and K'\n    S = np.zeros((N, N), dtype=complex_dtype)\n    K = np.zeros((N, N), dtype=complex_dtype)\n    Kp = np.zeros((N, N), dtype=complex_dtype) # K' matrix\n    \n    # Loop over observation points (rows, i) and source points (cols, j)\n    for i in range(N):\n        for j in range(N):\n            if i == j:\n                # Diagonal entries are excluded from residual calculation\n                continue\n            \n            # Geometric quantities\n            xi = points[i, :]\n            yj = points[j, :]\n            \n            # Vector from source to observation point\n            d_ij = xi - yj\n            r_ij = np.linalg.norm(d_ij) # Distance ||x_i - y_j||\n\n            # Hankel functions needed for kernels\n            h0_val = hankel1(0, k * r_ij)\n            h1_val = hankel1(1, k * r_ij)\n\n            # S matrix entry\n            g_val = (1j / 4) * h0_val\n            S[i, j] = g_val * w\n\n            # Normal derivatives of G for K and K'\n            dGdr_val = -(1j * k / 4) * h1_val\n            \n            # K matrix entry\n            dot_prod_ny = np.dot(d_ij, normals[j, :])\n            dGdny_val = -dGdr_val * dot_prod_ny / r_ij\n            K[i, j] = dGdny_val * w\n\n            # K' matrix entry\n            dot_prod_nx = np.dot(d_ij, normals[i, :])\n            dGdnx_val = dGdr_val * dot_prod_nx / r_ij\n            Kp[i, j] = dGdnx_val * w\n\n    # 3. Calculate residuals, excluding diagonal entries\n    off_diag_mask = ~np.eye(N, dtype=bool)\n\n    # Residual for S\n    # Note: S_ji is the (i, j) entry of the transpose of S\n    s_ij = S[off_diag_mask]\n    s_ji = S.T[off_diag_mask]\n    \n    numerator_S = np.max(np.abs(s_ij - s_ji))\n    denominator_S = np.max(np.abs(s_ij))\n    eps_S = numerator_S / denominator_S if denominator_S != 0 else 0.0\n\n    # Residual for K\n    # Note: K_ji is the (i, j) entry of the transpose of K\n    kp_ij = Kp[off_diag_mask]\n    k_ji = K.T[off_diag_mask]\n    \n    numerator_K = np.max(np.abs(k_ji - kp_ij))\n    denominator_K = np.max(np.abs(kp_ij))\n    eps_K = numerator_K / denominator_K if denominator_K != 0 else 0.0\n\n    return eps_S, eps_K\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Standard boundary integral formulations for exterior acoustic problems suffer from a critical flaw: they fail to produce unique solutions at a set of discrete 'irregular frequencies'. This exercise provides a hands-on exploration of this non-uniqueness phenomenon, showing how it relates to the interior resonance modes of the scattering object . You will then implement the Burton-Miller formulation to demonstrate how this elegant technique effectively eliminates the issue, paving the way for a robust BEM solver.",
            "id": "4139349",
            "problem": "Consider time-harmonic acoustics in a homogeneous, lossless fluid. The acoustic pressure field satisfies the Helmholtz equation $ \\nabla^2 p + k^2 p = 0 $ in a domain, with $ k $ the wavenumber in $\\text{rad/m}$. On a smooth closed boundary, one may solve interior boundary value problems using the Boundary Element Method (BEM). However, certain wavenumbers yield non-uniqueness of the boundary integral equation, known as irregular frequencies. For a sphere of radius $ a $, separation of variables in spherical coordinates shows that interior eigenfunctions are of the form $ R_n(r) Y_n^m(\\theta,\\varphi) $, where $ Y_n^m $ are spherical harmonics and the radial function $ R_n(r) $ is a spherical Bessel function of the first kind $ j_n(kr) $. Imposing boundary conditions at $ r = a $, non-trivial interior solutions exist only when the boundary condition reduces to an eigenfrequency condition expressed in terms of $ j_n(ka) $ or its radial derivative $ j_n'(ka) $.\n\nYour task is to explicitly compute the irregular frequencies associated with the interior Dirichlet problem for a sphere, and then to demonstrate numerically how the Burton–Miller Combined Field Integral Equation (CFIE) removes the non-uniqueness by combining the Dirichlet and Neumann boundary integral equations. The demonstration must be performed purely in the modal (spherical harmonic) domain, where the boundary operator is diagonal with respect to $ n $ and $ m $.\n\nStarting from the Helmholtz equation and the spherical separation of variables, argue why interior Dirichlet irregular frequencies for the sphere of radius $ a $ correspond to the set of positive wavenumbers $ k $ such that $ j_n(ka) = 0 $ for some non-negative integer $ n $. Then, consider the Burton–Miller CFIE in modal form, whose diagonal action on each spherical harmonic mode may be represented, up to non-zero scaling, by combining $ j_n(ka) $ and $ j_n'(ka) $ as $ j_n(ka) + i \\eta j_n'(ka) $, where $ \\eta $ is a non-zero real coupling parameter and $ i $ is the imaginary unit. Explain why, for $ \\eta \\neq 0 $, this combination eliminates the non-uniqueness at those $ k $ for which $ j_n(ka) = 0 $.\n\nProgram requirements:\n\n- Use $ a = 1 $ meter. All wavenumbers $ k $ must be reported in $\\text{rad/m}$.\n- Implement numerical root-finding for $ j_n(x) $ to locate the first positive root $ x_{n,1} $ of $ j_n(x) $ for each $ n $ in $ \\{0,1,2\\} $, and convert to irregular frequencies $ k_{n,1} = x_{n,1} / a $ in $\\text{rad/m}$. Use robust bracketing on $ x \\in (0, 20) $ to find the first sign change for $ j_n(x) $ and apply a bracketing root solver.\n- To demonstrate non-uniqueness for the standard interior Dirichlet boundary integral operator, construct the modal diagonal operator whose entries are $ j_n(ka) $ for $ n = 0,1,\\dots,N_{\\max} $ with $ N_{\\max} = 10 $. Define the minimal singular value for this diagonal operator as $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) | $. Evaluate this minimal singular value at $ k = k_{1,1} $ and return a boolean indicating whether it is numerically zero, using the threshold $ 10^{-12} $.\n- To demonstrate removal of non-uniqueness by the Burton–Miller CFIE, construct the combined modal diagonal entries $ j_n(ka) + i \\eta j_n'(ka) $ with $ \\eta = 1 $, and evaluate the corresponding minimal singular value at the same $ k = k_{1,1} $. Return a boolean indicating whether it is strictly positive, using the threshold $ 10^{-6} $.\n- As an edge-case check near an irregular frequency, evaluate both minimal singular values at a slightly perturbed wavenumber $ k = k_{1,1} + \\delta k $ with $ \\delta k = 10^{-3} $ $\\text{rad/m}$, and return these two values as floats.\n\nTest suite:\n\n- Case $ 1 $ (happy path): Compute the first irregular frequencies $ k_{n,1} $ for $ n \\in \\{0,1,2\\} $, expressed in $\\text{rad/m}$, rounded to $ 6 $ decimals.\n- Case $ 2 $ (non-uniqueness at an irregular frequency): For $ N_{\\max} = 10 $, $ \\eta = 1 $, and $ k = k_{1,1} $, return a boolean indicating whether $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) | < 10^{-12} $.\n- Case $ 3 $ (Burton–Miller uniqueness at the same frequency): For $ N_{\\max} = 10 $, $ \\eta = 1 $, and $ k = k_{1,1} $, return a boolean indicating whether $ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) | > 10^{-6} $.\n- Case $ 4 $ (edge condition near a root): For $ N_{\\max} = 10 $, $ \\eta = 1 $, and $ k = k_{1,1} + \\delta k $ with $ \\delta k = 10^{-3} $ $\\text{rad/m}$, return the list of two floats $ [ \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) |, \\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) | ] $, each rounded to $ 6 $ decimals.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The first element must be the nested list of the first irregular frequencies for $ n = 0,1,2 $ (each as a float rounded to $ 6 $ decimals, in $\\text{rad/m}$), the second element must be the boolean for Case $ 2 $, the third element must be the boolean for Case $ 3 $, and the fourth element must be the nested list of the two floats for Case $ 4 $, rounded to $ 6 $ decimals. For example, in the correct format: $ [ [x_0,x_1,x_2], \\text{True}, \\text{True}, [y_1,y_2] ] $.",
            "solution": "The analysis begins with the validation of the problem statement.\n\n### Step 1: Extract Givens\n- **Governing Equation**: The acoustic pressure field $p$ satisfies the Helmholtz equation, $\\nabla^2 p + k^2 p = 0$, where $k$ is the wavenumber in $\\text{rad/m}$.\n- **Domain**: A homogeneous, lossless fluid inside a smooth closed boundary, specifically a sphere of radius $a$.\n- **Problem Context**: Interior boundary value problems solved using the Boundary Element Method (BEM).\n- **Phenomenon**: Non-uniqueness of the boundary integral equation at certain wavenumbers, known as irregular frequencies.\n- **Solution Form**: For a sphere, interior eigenfunctions are of the form $R_n(r) Y_n^m(\\theta,\\varphi)$, where $Y_n^m$ are spherical harmonics and $R_n(r)$ is the spherical Bessel function of the first kind, $j_n(kr)$.\n- **Irregular Frequency Condition (Dirichlet)**: For the interior Dirichlet problem for a sphere of radius $a$, irregular frequencies are the positive wavenumbers $k$ such that $j_n(ka) = 0$ for some non-negative integer $n$.\n- **Burton-Miller CFIE**: The modal representation of the Combined Field Integral Equation (CFIE) operator is given by the combination $j_n(ka) + i \\eta j_n'(ka)$, with $i$ being the imaginary unit and $\\eta$ a non-zero real coupling parameter.\n- **Numerical Parameters**:\n    - Sphere radius: $a = 1$ meter.\n    - Coupling parameter: $\\eta = 1$.\n    - Maximum spherical harmonic degree for numerical evaluation: $N_{\\max} = 10$.\n    - Root-finding range for $x=ka$: $x \\in (0, 20)$.\n    - Wavenumber perturbation: $\\delta k = 10^{-3}$ $\\text{rad/m}$.\n    - Numerical zero threshold for standard BIE: $10^{-12}$.\n    - Positivity threshold for CFIE: $10^{-6}$.\n- **Computational Tasks**:\n    1.  Compute the first positive irregular frequencies $k_{n,1}$ for $n \\in \\{0,1,2\\}$ by finding the first positive root $x_{n,1}$ of $j_n(x)$ and setting $k_{n,1} = x_{n,1}/a$.\n    2.  Evaluate $\\min_{0 \\le n \\le N_{\\max}} | j_n(ka) |$ at $k=k_{1,1}$ and check if it is less than $10^{-12}$.\n    3.  Evaluate $\\min_{0 \\le n \\le N_{\\max}} | j_n(ka) + i \\eta j_n'(ka) |$ at $k=k_{1,1}$ with $\\eta=1$ and check if it is greater than $10^{-6}$.\n    4.  Evaluate both minimal singular values at the perturbed wavenumber $k = k_{1,1} + \\delta k$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on fundamental principles of acoustics and mathematical physics. The Helmholtz equation, separation of variables in spherical coordinates, spherical Bessel functions, boundary integral equations, the concept of irregular frequencies, and the Burton-Miller CFIE are all standard and well-established topics in computational acoustics. The formulation is correct.\n- **Well-Posed**: The problem is well-posed. It asks for specific numerical computations based on clearly defined mathematical functions and parameters. The objectives are unambiguous and a unique set of numerical results can be determined.\n- **Objective**: The problem statement is formulated using precise, objective, and technical language, free from any subjectivity or opinion.\n- **Completeness and Consistency**: The problem is self-contained. It provides all necessary constants ($a=1$, $\\eta=1$), functions ($j_n(x)$), ranges ($x \\in (0, 20)$, $n \\in \\{0, \\dots, 10\\}$), thresholds, and a clear description of the required calculations. There are no contradictions.\n- **Other Flaws**: The problem is not trivial, metaphorical, or outside the scope of scientific verification. It represents a standard, albeit simplified, demonstration of a core concept in BEM.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is scientifically sound, well-posed, and complete. A full solution will be provided.\n\n---\n\n### Theoretical Foundation and Solution Derivation\n\nThe time-harmonic acoustic pressure field $p$ in a source-free, homogeneous, lossless fluid is governed by the Helmholtz equation:\n$$ \\nabla^2 p + k^2 p = 0 $$\nwhere $k = \\omega/c$ is the acoustic wavenumber, $\\omega$ is the angular frequency, and $c$ is the speed of sound. We consider the interior of a sphere of radius $a$. In spherical coordinates $(r, \\theta, \\varphi)$, solutions to the Helmholtz equation that are regular throughout the domain are obtained via separation of variables. These solutions can be expressed as a superposition of modes:\n$$ p(r, \\theta, \\varphi) = \\sum_{n=0}^{\\infty} \\sum_{m=-n}^{n} A_{nm} j_n(kr) Y_n^m(\\theta, \\varphi) $$\nHere, $Y_n^m(\\theta, \\varphi)$ are the spherical harmonics, which form an orthonormal basis on the unit sphere, and $j_n(kr)$ are the spherical Bessel functions of the first kind. The selection of $j_n(kr)$ over other solutions to the radial equation (like the spherical Neumann functions, $y_n(kr)$) is mandated by the physical requirement that the pressure field must remain finite at the origin ($r=0$).\n\nThe Boundary Element Method (BEM) for the interior Dirichlet problem involves solving a boundary integral equation. However, this equation fails to have a unique solution at a set of discrete wavenumbers known as \"irregular frequencies\". These frequencies correspond precisely to the eigenfrequencies of the associated homogeneous interior problem. For the interior Dirichlet problem, the homogeneous problem is:\n$$ \\nabla^2 p + k^2 p = 0 \\quad \\text{for } r < a $$\n$$ p = 0 \\quad \\text{on } r = a $$\nA non-trivial solution ($p \\not\\equiv 0$) exists if and only if the wavenumber $k$ is an eigenfrequency. Substituting the general solution form into the boundary condition gives:\n$$ \\sum_{n=0}^{\\infty} \\sum_{m=-n}^{n} A_{nm} j_n(ka) Y_n^m(\\theta, \\varphi) = 0 $$\nDue to the orthogonality of the spherical harmonics $Y_n^m$, this equation holds for all $(\\theta, \\varphi)$ if and only if the coefficient of each mode is zero. For a non-trivial solution to exist, at least one coefficient $A_{nm}$ must be non-zero. This is possible only if, for that specific mode $(n,m)$, the radial part vanishes at the boundary:\n$$ j_n(ka) = 0 $$\nThus, the set of irregular frequencies for the interior Dirichlet problem on a sphere consists of all positive wavenumbers $k$ for which $j_n(ka) = 0$ for some non-negative integer $n$. At such a $k$, the BEM operator for the interior Dirichlet problem becomes singular. In the modal domain, where the operator is diagonal with respect to the spherical harmonic modes, the diagonal entry corresponding to mode $n$ is proportional to $j_n(ka)$. When $j_n(ka)=0$, this entry is zero, making the operator matrix singular.\n\nThe Burton-Miller Combined Field Integral Equation (CFIE) is a technique to overcome this non-uniqueness issue. It linearly combines the standard boundary integral equation (related to a single-layer potential) with the normal derivative of that equation (related to a hypersingular potential). This combination is typically of the form $S + i\\eta D$, where $S$ and $D$ are the single-layer and hypersingular operators, and $\\eta \\neq 0$ is a real coupling parameter. In the modal domain for a sphere, this corresponds to combining the modal term $j_n(ka)$ with its derivative. As given, the modal operator for the CFIE is:\n$$ C_n(k) = j_n(ka) + i \\eta j_n'(ka) $$\nwhere $j_n'(x)$ is the derivative of $j_n(x)$ with respect to its argument $x$. We must show that this expression is never zero for any $k>0$ and any $n$. Let us consider an irregular frequency $k^*$ such that $j_n(k^*a) = 0$ for some $n$. At this wavenumber, the CFIE modal term becomes:\n$$ C_n(k^*) = 0 + i \\eta j_n'(k^*a) = i \\eta j_n'(k^*a) $$\nA fundamental property of Bessel functions (and their spherical counterparts) is that their non-trivial roots are simple. This means that if $j_n(x)=0$ for some $x>0$, then its derivative $j_n'(x)$ must be non-zero. Since the problem specifies $\\eta$ is a non-zero real number, the term $i \\eta j_n'(k^*a)$ is guaranteed to be non-zero. Consequently, the CFIE modal operator $C_n(k)$ has no zero entries for any $k>0$, and the non-uniqueness problem is resolved.\n\n### Numerical Demonstration\n\nWe will now perform the numerical tasks specified in the problem statement. The sphere radius is $a=1$ m. All wavenumbers $k$ are in $\\text{rad/m}$.\n\n**Case 1: Computation of Irregular Frequencies**\nWe need to find the first positive root $x_{n,1}$ of the spherical Bessel function $j_n(x)$ for $n \\in \\{0, 1, 2\\}$. The corresponding irregular frequencies are $k_{n,1} = x_{n,1}/a = x_{n,1}$. We numerically search for the first sign change of $j_n(x)$ in the interval $(0, 20)$ to bracket the root, then apply a numerical root-finding algorithm.\n- For $n=0$, $j_0(x) = \\frac{\\sin(x)}{x}$. The first positive root is at $x_{0,1} = \\pi$.\n- For $n=1$, $j_1(x) = \\frac{\\sin(x)}{x^2} - \\frac{\\cos(x)}{x}$. The roots are solutions to $\\tan(x)=x$.\n- For $n=2$, $j_2(x) = (\\frac{3}{x^2}-1)\\frac{\\sin(x)}{x} - \\frac{3\\cos(x)}{x^2}$.\n\n**Case 2 & 3: (Non-)Uniqueness at an Irregular Frequency**\nWe focus on the irregular frequency $k_{1,1}$ corresponding to $n=1$. We set $N_{\\max}=10$ and $\\eta=1$. The minimal singular value of the diagonal modal operator is the minimum of the absolute values of its diagonal entries.\n- For the standard BIE, the operator entries are $j_n(ka)$. The minimal singular value is $\\min_{0 \\le n \\le N_{\\max}} |j_n(ka)|$. At $k=k_{1,1}$, the $n=1$ term is $j_1(k_{1,1}a) = j_1(x_{1,1}) = 0$. The minimal singular value should be numerically zero.\n- For the CFIE, the operator entries are $j_n(ka) + i \\eta j_n'(ka)$. The minimal singular value is $\\min_{0 \\le n \\le N_{\\max}} |j_n(ka) + i j_n'(ka)|$. At $k=k_{1,1}$, the $n=1$ term is $|j_1(k_{1,1}a) + i j_1'(k_{1,1}a)| = |0 + i j_1'(x_{1,1})| = |j_1'(x_{1,1})|$. Since $j_1'(x_{1,1}) \\neq 0$, this term is non-zero. All other terms $|j_n(k_{1,1}a) + i j_n'(k_{1,1}a)|$ for $n \\neq 1$ are also non-zero because $j_n(k_{1,1}a) \\neq 0$. Thus, the minimal singular value will be strictly positive.\n\n**Case 4: Behavior Near an Irregular Frequency**\nWe investigate the situation at a slightly perturbed wavenumber $k = k_{1,1} + \\delta k$, with $\\delta k = 10^{-3}$.\n- For the standard BIE, the term for $n=1$ is $j_1((k_{1,1}+\\delta k)a)$. Using a Taylor expansion, $j_1((k_{1,1}+\\delta k)a) \\approx j_1(k_{1,1}a) + j_1'(k_{1,1}a)(\\delta k a) = 0 + j_1'(k_{1,1}a)\\delta k a$. This value is small, of the order of $\\delta k$. The minimal singular value will be this small number.\n- For the CFIE, the term for $n=1$ is $|j_1((k_{1,1}+\\delta k)a) + i j_1'((k_{1,1}+\\delta k)a)|$. This will be close to $|0 + i j_1'(k_{1,1}a)| = |j_1'(k_{1,1}a)|$, which is a value of order unity, not a small number. The minimal singular value should therefore be stable and not close to zero.\n\nThe following code will implement these calculations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Performs the calculations as specified in the problem statement.\n    \"\"\"\n    # Define constants from the problem statement.\n    a = 1.0  # meter\n    N_max = 10\n    eta = 1.0\n    delta_k = 1e-3  # rad/m\n    dirichlet_zero_threshold = 1e-12\n    cfie_positivity_threshold = 1e-6\n    root_finding_range = (0.0, 20.0)\n\n    def find_first_positive_root(n, x_min, x_max, num_steps=2000):\n        \"\"\"\n        Finds the first positive root of the spherical Bessel function j_n(x).\n        \"\"\"\n        # We need to start evaluation slightly away from 0 to avoid division by zero for some functions.\n        x_start = 1e-9 if n > 0 else x_min + 1e-9\n        \n        # Scan for the first interval where a sign change occurs.\n        x_vals = np.linspace(x_start, x_max, num_steps)\n        jn_vals = spherical_jn(n, x_vals)\n        \n        for i in range(len(jn_vals) - 1):\n            if np.sign(jn_vals[i]) != np.sign(jn_vals[i+1]):\n                # Found a bracket for the root\n                try:\n                    root = brentq(lambda x: spherical_jn(n, x), x_vals[i], x_vals[i+1])\n                    return root\n                except ValueError:\n                    # brentq fails if signs are not different, though we checked.\n                    # This is a fallback.\n                    continue\n        return None\n\n    # Case 1: Compute the first irregular frequencies k_n,1 for n in {0, 1, 2}.\n    k_irregular_list = []\n    for n in range(3):\n        root = find_first_positive_root(n, root_finding_range[0], root_finding_range[1])\n        k_n1 = root / a\n        k_irregular_list.append(round(k_n1, 6))\n\n    # Store k_1,1 for use in subsequent cases.\n    k11 = find_first_positive_root(1, root_finding_range[0], root_finding_range[1]) / a\n\n    # Case 2: Non-uniqueness at an irregular frequency.\n    k_test = k11\n    n_vals = np.arange(N_max + 1)\n    \n    # Standard BIE modal operator values\n    sv_dirichlet_op = np.abs(spherical_jn(n_vals, k_test * a))\n    min_sv_dirichlet = np.min(sv_dirichlet_op)\n    is_singular_dirichlet = min_sv_dirichlet < dirichlet_zero_threshold\n\n    # Case 3: Burton-Miller uniqueness at the same frequency.\n    # CFIE modal operator values\n    # Need j_n(x) and its derivative j_n'(x)\n    jn_vals = spherical_jn(n_vals, k_test * a)\n    jn_prime_vals = spherical_jn(n_vals, k_test * a, derivative=True)\n    \n    sv_cfie_op = np.abs(jn_vals + 1j * eta * jn_prime_vals)\n    min_sv_cfie = np.min(sv_cfie_op)\n    is_nonsingular_cfie = min_sv_cfie > cfie_positivity_threshold\n\n    # Case 4: Edge condition near a root.\n    k_perturbed = k11 + delta_k\n    \n    # Standard BIE at perturbed k\n    sv_dirichlet_perturbed = np.abs(spherical_jn(n_vals, k_perturbed * a))\n    min_sv_dirichlet_perturbed = np.min(sv_dirichlet_perturbed)\n\n    # CFIE at perturbed k\n    jn_perturbed = spherical_jn(n_vals, k_perturbed * a)\n    jn_prime_perturbed = spherical_jn(n_vals, k_perturbed * a, derivative=True)\n    sv_cfie_perturbed = np.abs(jn_perturbed + 1j * eta * jn_prime_perturbed)\n    min_sv_cfie_perturbed = np.min(sv_cfie_perturbed)\n\n    edge_case_values = [round(min_sv_dirichlet_perturbed, 6), round(min_sv_cfie_perturbed, 6)]\n\n    # Assemble the final result list\n    final_results = [\n        k_irregular_list,\n        is_singular_dirichlet,\n        is_nonsingular_cfie,\n        edge_case_values\n    ]\n\n    # Print the result in the specified format\n    # Custom formatting to match the example output style exactly.\n    result_str = f\"[{final_results[0]}, {str(final_results[1])}, {str(final_results[2])}, {final_results[3]}]\"\n    print(result_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Having established a robust formulation, we can now apply the BEM to a complete scattering problem. This practice guides you through an end-to-end analysis of acoustic scattering from a sound-soft sphere, a canonical problem in acoustics . You will use a spectral BEM approach to compute the far-field pattern and the total scattering cross-section, and then validate your numerical results against the well-known analytical solution, reinforcing the crucial skill of code verification.",
            "id": "4139359",
            "problem": "Consider time-harmonic acoustic scattering in three spatial dimensions governed by the inhomogeneous Helmholtz equation for the acoustic pressure field $p(\\mathbf{x})$ at angular frequency $\\omega$, with wavenumber $k = \\omega / c$ for sound speed $c$. The exterior of a rigid body is the domain of interest. For a sound-soft sphere of radius $a$, the boundary condition on the spherical surface $\\Gamma$ is Dirichlet: $p(\\mathbf{x}) = 0$ for all $\\mathbf{x} \\in \\Gamma$. A plane wave of unit amplitude propagating along the $z$-axis provides the incident field $p_{\\text{inc}}(\\mathbf{x})$. The scattered field $p_{\\text{scat}}(\\mathbf{x})$ must satisfy the Sommerfeld radiation condition at infinity. The goal is to formulate and solve an exterior Boundary Element Method (BEM) for this Dirichlet problem using a single-layer potential representation, compute the far-field scattering amplitude, and from it compute the total scattering cross-section $\\sigma_{\\text{tot}}$ as a function of the dimensionless parameter $ka$.\n\nStarting from the following foundational base:\n- The Helmholtz equation $\\nabla^2 p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0$ for the total field in the exterior of the sphere.\n- The representation of the scattered field $p_{\\text{scat}}(\\mathbf{x})$ as a single-layer potential with density $q(\\mathbf{y})$ on $\\Gamma$, using the free-space Green's function $G_k(\\mathbf{x},\\mathbf{y})$.\n- The boundary condition $p_{\\text{inc}}(\\mathbf{x}) + p_{\\text{scat}}(\\mathbf{x}) = 0$ on $\\Gamma$ for a sound-soft boundary.\n- The Sommerfeld radiation condition satisfied by $G_k$.\n- Orthogonality and completeness properties of spherical harmonics on the sphere and the addition theorem that diagonalizes the boundary integral operator on spherical geometries.\n\nYou must:\n1. Derive, from first principles based on the above, a boundary integral equation for the unknown single-layer density $q(\\mathbf{y})$ on $\\Gamma$ and show how the operator acts diagonally on spherical harmonic or Legendre polynomial modes for a sphere, producing a solvable algebraic system for the modal coefficients.\n2. Use the far-field asymptotics of the single-layer potential to derive the far-field scattering amplitude $f(\\theta)$, where $\\theta$ is the polar angle relative to the $z$-axis, and express $f(\\theta)$ in terms of the solved modal coefficients for the density.\n3. Define the total scattering cross-section as $\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\theta,\\phi)|^2 \\,\\mathrm{d}\\Omega$, and specialize it for the axisymmetric case of a plane wave along $z$ so that $f$ depends only on $\\theta$. Compute $\\sigma_{\\text{tot}}$ numerically from a spectral BEM solution by expanding the density in Legendre polynomials up to a truncation order that ensures numerical convergence.\n4. Verify the numerical BEM result for $\\sigma_{\\text{tot}}$ against an analytical benchmark derived from partial-wave analysis of scattering by a sound-soft sphere, which yields a convergent series in terms of spherical Bessel functions. Quantify the relative error.\n\nImplementation requirements:\n- Assume radius $a = 1\\,\\mathrm{m}$ so that $k = ka/a = ka$ has units $\\mathrm{m}^{-1}$ and the total scattering cross-section $\\sigma_{\\text{tot}}$ has units of $\\mathrm{m}^2$. Report $\\sigma_{\\text{tot}}$ in $\\mathrm{m}^2$.\n- Use a spectral Boundary Element Method on the sphere that leverages the diagonalization of the single-layer operator in the spherical harmonic or Legendre polynomial basis. Do not discretize the surface into panels; instead, derive and use the diagonal action on modes to obtain the modal unknowns and the far-field amplitude.\n- Numerically evaluate $\\sigma_{\\text{tot}}$ from the BEM far-field amplitude by integrating $|f(\\theta)|^2$ over the unit sphere using an appropriate quadrature, and compare it against the analytical benchmark series for $\\sigma_{\\text{tot}}$ that uses spherical Bessel functions of the first and second kind.\n- Your program must produce the final results for the following test suite of dimensionless parameters $ka$: $[0.1, 1.0, 2.3, 5.0, 10.0]$. These cover a Rayleigh regime case, a moderate case, a non-integer transitional case, a mid-frequency case, and a higher-frequency case. For each test case, compute the relative error between the BEM-computed $\\sigma_{\\text{tot}}$ and the analytical benchmark value, defined as $\\left|\\sigma_{\\text{tot}}^{\\text{BEM}} - \\sigma_{\\text{tot}}^{\\text{analytical}}\\right| / \\sigma_{\\text{tot}}^{\\text{analytical}}$.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3,result4,result5]\"). Each entry must be a float.\n\nAngle specification: All angles are in radians. Units specification: Cross-sections must be computed and conceptually understood in $\\mathrm{m}^2$; however, the program output is unitless relative errors.",
            "solution": "The user's request is to formulate and solve a time-harmonic acoustic scattering problem for a sound-soft sphere using a spectral Boundary Element Method (BEM), and to verify the computed total scattering cross-section against an analytical benchmark.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n- **Governing Equation**: Helmholtz equation, $\\nabla^2 p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0$.\n- **Geometry**: A sphere of radius $a$.\n- **Domain**: The exterior of the sphere.\n- **Boundary Condition**: Sound-soft (Dirichlet), $p(\\mathbf{x}) = 0$ on the sphere's surface $\\Gamma$.\n- **Incident Field**: Plane wave of unit amplitude along the $z$-axis, $p_{\\text{inc}}(\\mathbf{x}) = e^{ikz}$.\n- **Total Field**: $p(\\mathbf{x}) = p_{\\text{inc}}(\\mathbf{x}) + p_{\\text{scat}}(\\mathbf{x})$.\n- **Scattered Field Representation**: Single-layer potential, $p_{\\text{scat}}(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x}, \\mathbf{y}) q(\\mathbf{y}) dS(\\mathbf{y})$, with unknown density $q(\\mathbf{y})$.\n- **Green's Function**: Free-space Green's function $G_k(\\mathbf{x}, \\mathbf{y}) = \\frac{e^{ik|\\mathbf{x}-\\mathbf{y}|}}{4\\pi|\\mathbf{x}-\\mathbf{y}|}$.\n- **Radiation Condition**: $p_{\\text{scat}}(\\mathbf{x})$ must satisfy the Sommerfeld radiation condition.\n- **Tools**: Spherical harmonics, Legendre polynomials, addition theorem.\n- **Task 1**: Derive the boundary integral equation (BIE) for $q(\\mathbf{y})$ and solve for its modal coefficients.\n- **Task 2**: Derive the far-field scattering amplitude $f(\\theta)$ in terms of the modal coefficients.\n- **Task 3**: Numerically compute the total scattering cross-section $\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\theta,\\phi)|^2 \\,\\mathrm{d}\\Omega$ using the BEM solution for $f(\\theta)$.\n- **Task 4**: Verify the BEM result against an analytical series for $\\sigma_{\\text{tot}}$ and compute the relative error.\n- **Implementation Parameters**: $a = 1\\,\\mathrm{m}$. Test cases for $ka$: $[0.1, 1.0, 2.3, 5.0, 10.0]$.\n- **Output**: A list of relative errors for each test case.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is a canonical example in computational acoustics and scattering theory. The Helmholtz equation, single-layer potential, BEM, and partial-wave analysis are all fundamental, well-established concepts. The physics is sound.\n- **Well-Posed**: The exterior Dirichlet problem for the Helmholtz equation is well-posed. The formulation via a single-layer potential leads to a Fredholm integral equation of the first kind, which is known to be uniquely solvable for the Helmholtz equation on a sphere for any non-resonant wavenumber $k$.\n- **Objective**: The problem is stated in precise mathematical and physical terms, free of ambiguity or subjective claims.\n- **All other checks**: The problem is complete, consistent, formalizable, and verifiable. It is a substantive problem requiring both analytical derivation and numerical implementation.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivations**\n\n**1. Boundary Integral Equation and Modal Solution**\n\nThe total acoustic pressure field $p(\\mathbf{x})$ is the sum of the incident field $p_{\\text{inc}}(\\mathbf{x})$ and the scattered field $p_{\\text{scat}}(\\mathbf{x})$. The boundary condition on the sound-soft sphere of radius $a$ is $p(\\mathbf{x}) = 0$ for all $\\mathbf{x}$ on the surface $\\Gamma$. This implies:\n$$p_{\\text{scat}}(\\mathbf{x}) = -p_{\\text{inc}}(\\mathbf{x}), \\quad \\text{for } \\mathbf{x} \\in \\Gamma$$\nThe scattered field is represented by a single-layer potential with an unknown surface density distribution $q(\\mathbf{y})$:\n$$p_{\\text{scat}}(\\mathbf{x}) = (S_k q)(\\mathbf{x}) := \\int_{\\Gamma} G_k(\\mathbf{x}, \\mathbf{y}) q(\\mathbf{y}) \\, dS(\\mathbf{y})$$\nwhere $G_k(\\mathbf{x}, \\mathbf{y}) = \\frac{e^{ik|\\mathbf{x}-\\mathbf{y}|}}{4\\pi|\\mathbf{x}-\\mathbf{y}|}$ is the free-space Green's function. Combining these gives the boundary integral equation (BIE) for $q(\\mathbf{y})$:\n$$(S_k q)(\\mathbf{x}) = -p_{\\text{inc}}(\\mathbf{x}), \\quad \\text{for } \\mathbf{x} \\in \\Gamma$$\nThis is a Fredholm integral equation of the first kind. For a spherical geometry, this operator is diagonalized by spherical harmonics. Due to the axisymmetry of the incident plane wave $p_{\\text{inc}}(\\mathbf{x}) = e^{ikz} = e^{ikr\\cos\\theta}$, the density $q$ will also be axisymmetric and can be expanded in Legendre polynomials $P_n(\\cos\\theta)$.\n\nThe incident field on the sphere ($r=a$) is expanded as:\n$$p_{\\text{inc}}(a, \\theta) = e^{ika\\cos\\theta} = \\sum_{n=0}^{\\infty} (2n+1)i^n j_n(ka) P_n(\\cos\\theta)$$\nwhere $j_n$ are the spherical Bessel functions of the first kind. We denote the modal coefficients of the incident field as $p_{\\text{inc},n} = (2n+1)i^n j_n(ka)$.\n\nWe expand the unknown density $q$ in the same basis:\n$$q(\\theta) = \\sum_{n=0}^{\\infty} q_n P_n(\\cos\\theta)$$\nThe action of the single-layer operator $S_k$ on a basis function $P_n$ on the sphere is multiplicative: $(S_k P_n)(\\theta) = \\lambda_n P_n(\\cos\\theta)$. The eigenvalues $\\lambda_n$ are a standard result given by:\n$$\\lambda_n = i k a^2 j_n(ka) h_n^{(1)}(ka)$$\nwhere $h_n^{(1)}(z) = j_n(z) + iy_n(z)$ is the spherical Hankel function of the first kind, with $y_n$ being the spherical Bessel function of the second kind.\n\nSubstituting the expansions into the BIE and using orthogonality, we equate the coefficients for each mode $n$:\n$$\\lambda_n q_n = -p_{\\text{inc},n}$$\nThis provides an explicit algebraic solution for the modal coefficients $q_n$ of the density:\n$$q_n = -\\frac{p_{\\text{inc},n}}{\\lambda_n} = -\\frac{(2n+1)i^n j_n(ka)}{i k a^2 j_n(ka) h_n^{(1)}(ka)} = \\frac{i(2n+1)i^n}{ka^2 h_n^{(1)}(ka)}$$\n\n**2. Far-Field Scattering Amplitude**\n\nThe far-field behavior of the scattered pressure is $p_{\\text{scat}}(\\mathbf{x}) \\to f(\\theta) \\frac{e^{ikr}}{r}$ as $r=|\\mathbf{x}| \\to \\infty$. To find the scattering amplitude $f(\\theta)$, we examine the asymptotic behavior of the scattered field representation. The field generated by a density distribution $q(\\mathbf{y}) = \\sum_n q_n P_n(\\cos\\theta')$ is:\n$$p_{\\text{scat}}(r, \\theta) = \\sum_n q_n (S_k P_n)(r,\\theta) = \\sum_n q_n \\left( i k a^2 j_n(ka) h_n^{(1)}(kr) \\right) P_n(\\cos\\theta)$$\nUsing the large-argument asymptotic form of the Hankel function, $h_n^{(1)}(z) \\approx \\frac{1}{z} (-i)^{n+1} e^{iz}$:\n$$p_{\\text{scat}}(r, \\theta) \\approx \\sum_n q_n \\left( i k a^2 j_n(ka) \\frac{1}{kr}(-i)^{n+1} e^{ikr} \\right) P_n(\\cos\\theta)$$\n$$p_{\\text{scat}}(r, \\theta) \\approx \\frac{e^{ikr}}{r} \\left[ a^2 \\sum_n q_n j_n(ka) (-i)^n P_n(\\cos\\theta) \\right]$$\nFrom this, we identify the far-field amplitude $f(\\theta)$:\n$$f(\\theta) = a^2 \\sum_{n=0}^{\\infty} q_n j_n(ka) (-i)^n P_n(\\cos\\theta)$$\nSubstituting the derived expression for $q_n$:\n$$f(\\theta) = a^2 \\sum_{n=0}^{\\infty} \\left( \\frac{i(2n+1)i^n}{ka^2 h_n^{(1)}(ka)} \\right) j_n(ka) (-i)^n P_n(\\cos\\theta)$$\nSimplifying the terms, noting $i^n(-i)^n = 1$:\n$$f(\\theta) = \\frac{i}{k} \\sum_{n=0}^{\\infty} (2n+1) \\frac{j_n(ka)}{h_n^{(1)}(ka)} P_n(\\cos\\theta)$$\nThis expression for $f(\\theta)$ is identical to the one obtained via the standard partial-wave analysis method.\n\n**3. Total Scattering Cross-Section (BEM)**\n\nThe total scattering cross-section $\\sigma_{\\text{tot}}$ is defined as the total scattered power normalized by the incident intensity. For a unit amplitude plane wave, this is the integral of the squared magnitude of the far-field amplitude over all solid angles:\n$$\\sigma_{\\text{tot}} = \\int_{4\\pi} |f(\\hat{\\mathbf{x}})|^2 \\, d\\Omega = \\int_0^{2\\pi} \\int_0^{\\pi} |f(\\theta)|^2 \\sin\\theta \\, d\\theta \\, d\\phi$$\nDue to axisymmetry, the integral over $\\phi$ yields $2\\pi$:\n$$\\sigma_{\\text{tot}}^{\\text{BEM}} = 2\\pi \\int_0^{\\pi} |f(\\theta)|^2 \\sin\\theta \\, d\\theta$$\nThis integral will be computed numerically. By substituting $u = \\cos\\theta$, $du = -\\sin\\theta d\\theta$, the integral transforms to:\n$$\\sigma_{\\text{tot}}^{\\text{BEM}} = 2\\pi \\int_{-1}^{1} |f(\\arccos u)|^2 \\, du$$\nThis definite integral is well-suited for Gauss-Legendre quadrature. We approximate it as a weighted sum:\n$$\\int_{-1}^{1} g(u) \\, du \\approx \\sum_{i=1}^{N_{\\text{quad}}} w_i g(u_i)$$\nwhere $u_i$ and $w_i$ are the Gauss-Legendre quadrature nodes and weights, respectively, and $g(u) = |f(\\arccos u)|^2$.\n\n**4. Analytical Benchmark and Relative Error**\n\nThe analytical expression for $\\sigma_{\\text{tot}}$ can be found by substituting the series for $f(\\theta)$ into the integral and exploiting the orthogonality of Legendre polynomials, $\\int_{-1}^{1} P_n(u)P_m(u)du = \\frac{2}{2n+1}\\delta_{nm}$.\nLet $f(\\theta) = \\sum_n c_n P_n(\\cos\\theta)$, with $c_n = \\frac{i}{k}(2n+1)\\frac{j_n(ka)}{h_n^{(1)}(ka)}$.\n$$\\sigma_{\\text{tot}} = 2\\pi \\int_{-1}^{1} \\left( \\sum_n c_n P_n(u) \\right) \\left( \\sum_m c_m^* P_m(u) \\right) \\, du$$\n$$\\sigma_{\\text{tot}} = 2\\pi \\sum_{n,m} c_n c_m^* \\int_{-1}^{1} P_n(u) P_m(u) \\, du = 2\\pi \\sum_n |c_n|^2 \\frac{2}{2n+1}$$\nSubstituting the expression for $c_n$:\n$$\\sigma_{\\text{tot}}^{\\text{analytical}} = 4\\pi \\sum_{n=0}^{\\infty} \\left| \\frac{i}{k}(2n+1)\\frac{j_n(ka)}{h_n^{(1)}(ka)} \\right|^2 \\frac{1}{2n+1}$$\n$$\\sigma_{\\text{tot}}^{\\text{analytical}} = \\frac{4\\pi}{k^2} \\sum_{n=0}^{\\infty} (2n+1) \\left| \\frac{j_n(ka)}{h_n^{(1)}(ka)} \\right|^2$$\nThis series provides the analytical benchmark. Both the BEM quadrature and the analytical summation will be truncated at a sufficiently high order $N_{\\text{max}}$ to ensure convergence. The relative error is then computed as:\n$$\\text{Relative Error} = \\frac{\\left|\\sigma_{\\text{tot}}^{\\text{BEM}} - \\sigma_{\\text{tot}}^{\\text{analytical}}\\right|}{\\sigma_{\\text{tot}}^{\\text{analytical}}}$$\nThis error quantifies the accuracy of the numerical quadrature implementation against the direct analytical series summation, both derived from the same underlying spectral representation.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn, legendre\nfrom numpy.polynomial.legendre import leggauss\n\ndef solve():\n    \"\"\"\n    Computes the relative error between BEM-computed and analytical total scattering\n    cross-sections for a sound-soft sphere under plane wave incidence.\n    \"\"\"\n    a = 1.0  # Sphere radius in meters, as per problem statement.\n    test_cases_ka = [0.1, 1.0, 2.3, 5.0, 10.0]\n    \n    relative_errors = []\n\n    for ka in test_cases_ka:\n        k = ka / a # Wavenumber\n\n        # Determine a sufficient truncation order for the spectral series.\n        # This rule of thumb ensures convergence for the given ka values.\n        n_max = int(np.ceil(ka) + 15)\n        n_vals = np.arange(0, n_max + 1)\n        \n        # --- Common Calculations for Both Methods ---\n        \n        # Calculate spherical Bessel functions j_n(ka) and y_n(ka) for all n.\n        jn_ka = spherical_jn(n_vals, ka)\n        yn_ka = spherical_yn(n_vals, ka)\n        \n        # Calculate spherical Hankel functions of the first kind h_n^(1)(ka) = j_n(ka) + i*y_n(ka).\n        hn1_ka = jn_ka + 1j * yn_ka\n        \n        # Handle potential division by zero, though unlikely for real ka > 0.\n        # Replace near-zero denominators with a small number to avoid warnings/NaNs.\n        hn1_ka[np.abs(hn1_ka)  1e-300] = 1e-300\n        \n        \n        # --- 1. Analytical Benchmark Calculation ---\n        \n        # The analytical formula for total scattering cross-section is a direct series sum.\n        # sigma_tot = (4*pi/k^2) * sum_{n=0 to inf} (2n+1) * |j_n(ka) / h_n^(1)(ka)|^2\n        \n        sigma_terms = (4 * np.pi / k**2) * (2 * n_vals + 1) * (np.abs(jn_ka / hn1_ka)**2)\n        sigma_analytical = np.sum(sigma_terms)\n\n        \n        # --- 2. BEM Numerical Integration Calculation ---\n\n        # The BEM approach requires numerically integrating |f(theta)|^2 over the sphere.\n        # sigma_tot = 2*pi * integral(|f(theta)|^2 * sin(theta) d(theta)) from 0 to pi.\n        # We transform this integral via u = cos(theta) to use Gauss-Legendre quadrature.\n        # sigma_tot = 2*pi * integral(|f(arccos(u))|^2 du) from -1 to 1.\n        \n        # Far-field amplitude coefficients, c_n.\n        # f(theta) = sum_{n=0 to inf} c_n * P_n(cos(theta))\n        coeffs_fn = (1j / k) * (2 * n_vals + 1) * (jn_ka / hn1_ka)\n\n        # Set up Gauss-Legendre quadrature. The order must be high enough\n        # to accurately integrate a polynomial product of degree ~2*n_max.\n        n_quad = 2 * n_max + 2 \n        quad_nodes_u, quad_weights = leggauss(n_quad) # nodes in [-1, 1]\n\n        # Evaluate all required Legendre polynomials P_n(u) at the quadrature nodes.\n        # Pn_matrix will have shape (n_max + 1, n_quad).\n        Pn_matrix = np.array([legendre(n)(quad_nodes_u) for n in n_vals])\n        \n        # Calculate the far-field amplitude f at each quadrature node.\n        # This is a matrix-vector product summing c_n * P_n(u_i) over n for each node u_i.\n        f_vals_at_nodes = coeffs_fn @ Pn_matrix\n        \n        # Perform the quadrature: integral(g(u) du) approx. sum(w_i * g(u_i))\n        # Here, g(u) = |f(arccos(u))|^2.\n        integral_val = np.sum(quad_weights * np.abs(f_vals_at_nodes)**2)\n        \n        sigma_bem = 2 * np.pi * integral_val\n        \n        # --- 3. Compute Relative Error ---\n        \n        if sigma_analytical > 1e-12:\n            rel_error = np.abs(sigma_bem - sigma_analytical) / sigma_analytical\n        else:\n            rel_error = 0.0 # Avoid division by zero for trivial cases\n            \n        relative_errors.append(rel_error)\n\n    # Final output must a be single line with comma-separated values in brackets.\n    print(f\"[{','.join(map(str, relative_errors))}]\")\n\n\nsolve()\n```"
        }
    ]
}