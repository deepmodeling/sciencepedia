{
    "hands_on_practices": [
        {
            "introduction": "This exercise grounds our study of aeroacoustics in fundamental physics by tasking you with deriving the convective wave equation directly from first principles. You will then solve this equation for a canonical source problem and perform a sensitivity analysis, a powerful technique to quantify how uncertainties in model parameters, such as the mean flow speed $U$, propagate to the solution . This practice strengthens your analytical skills and highlights the connection between the governing equations and practical modeling concerns.",
            "id": "4115429",
            "problem": "Consider an inviscid, compressible, isentropic fluid of constant base density $\\rho_{0}$ and constant sound speed $c$ supporting small-amplitude acoustic perturbations $\\rho'(x,t)$, $u'(x,t)$, and $p'(x,t)$ superposed on a uniform mean flow with speed $U$ directed along the $+x$ axis. A compact, time-harmonic monopole source of complex strength $Q$ located at $x=0$ drives the acoustic field at angular frequency $\\omega>0$. The flow is subsonic, with $0<U<c$. A point sensor is located at the position $x_{s}>0$ downstream of the source.\n\nStarting from first principles, use the linearized mass conservation and momentum balance for an isentropic fluid and the state relation to derive a closed Partial Differential Equation (PDE) governing the acoustic pressure $p'(x,t)$ in the presence of a uniform mean flow. Then, pass to the frequency domain by seeking solutions of the form $p'(x,t)=\\operatorname{Re}\\{P(x)\\exp(-\\mathrm{i}\\omega t)\\}$ and derive the appropriate frequency-domain PDE for $P(x)$ including the source term. Enforce an outgoing-wave radiation condition away from $x=0$.\n\nFor the one-dimensional geometry described, solve the frequency-domain problem and obtain the complex pressure amplitude $P(x)$ for $x>0$ at the sensor location $x_{s}$. Define the prediction functional as the unwrapped phase of $P$ at the sensor,\n$$\n\\Phi(U):=\\arg\\big(P(x_{s})\\big),\n$$\nwhere the argument is chosen continuously with respect to $U$ for $U\\in(0,c)$. Using linear perturbation analysis, compute the sensitivity (gradient) of $\\Phi(U)$ with respect to the mean flow speed $U$ in closed analytical form under the stated assumptions. Express your final gradient in seconds per meter (s/m). The final answer must be a single analytical expression.",
            "solution": "The user wants me to critically validate and then solve a problem in one-dimensional computational acoustics.\n\n### Step 1: Extract Givens\n- **Fluid:** Inviscid, compressible, isentropic.\n- **Base State:** Constant base density $\\rho_{0}$, constant sound speed $c$, uniform mean flow with speed $U$ along the $+x$ axis.\n- **Flow Regime:** Subsonic, $0 < U < c$.\n- **Perturbations:** Small-amplitude acoustic perturbations $\\rho'(x,t)$, $u'(x,t)$, and $p'(x,t)$.\n- **Source:** Compact, time-harmonic monopole source of complex strength $Q$ at $x=0$, angular frequency $\\omega > 0$.\n- **Sensor:** Point sensor at position $x_{s} > 0$.\n- **Task 1:** Derive the PDE for $p'(x,t)$ from first principles (linearized mass conservation, momentum balance, isentropic state relation).\n- **Task 2:** Find the frequency-domain PDE for $P(x)$, where $p'(x,t)=\\operatorname{Re}\\{P(x)\\exp(-\\mathrm{i}\\omega t)\\}$, including the source term.\n- **Task 3:** Enforce an outgoing-wave radiation condition.\n- **Task 4:** Solve for the complex pressure amplitude $P(x)$ at $x_s > 0$.\n- **Task 5:** Define the prediction functional as the unwrapped phase $\\Phi(U):=\\arg\\big(P(x_{s})\\big)$.\n- **Task 6:** Compute the sensitivity (gradient) $\\frac{d\\Phi}{dU}$.\n- **Task 7:** Express the final gradient in units of seconds per meter (s/m).\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is based on the linearized Euler equations, which are a cornerstone of aeroacoustics. The setup describes a canonical problem of sound generation and propagation in a uniform flow. The assumptions (inviscid, isentropic, uniform flow) are standard idealizations for a wide range of acoustic problems. The problem is scientifically sound.\n- **Well-Posed:** The problem is clearly specified. The governing equations are stated, the source is defined, the geometry is one-dimensional, and a radiation condition is required. This set of conditions is sufficient to determine a unique solution for the acoustic pressure field. The subsequent calculation of a phase functional and its derivative are well-defined mathematical operations.\n- **Objective:** The problem is stated in precise, technical language, free from any subjective or ambiguous terminology.\n\nThe problem does not violate any of the invalidity criteria. It is a standard, solvable problem in theoretical acoustics.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Derivation and Solution\n\nThe problem requires a derivation starting from first principles for an inviscid, isentropic fluid.\n\n**1. Governing Equations and Linearization**\nThe fundamental equations are mass conservation and momentum conservation (Euler's equation). In one dimension, for a flow with a mass source per unit volume $q_m(x,t)$, these are:\n1.  Continuity Equation: $\\frac{\\partial\\rho}{\\partial t} + \\frac{\\partial(\\rho v)}{\\partial x} = q_m$\n2.  Momentum Equation: $\\rho\\left(\\frac{\\partial v}{\\partial t} + v\\frac{\\partial v}{\\partial x}\\right) = -\\frac{\\partial p}{\\partial x}$\n\nWe linearize these equations by writing each field as a sum of a constant mean-flow quantity (subscript $0$) and a small acoustic perturbation (prime):\n$\\rho(x,t) = \\rho_0 + \\rho'(x,t)$\n$v(x,t) = U + u'(x,t)$\n$p(x,t) = p_0 + p'(x,t)$\n\nFor an isentropic process, the pressure and density perturbations are related by the speed of sound $c$: $p' = c^2\\rho'$. The mean pressure $p_0$ is constant for a uniform flow $U$.\n\nSubstituting these into the governing equations and keeping only first-order terms in the perturbations gives the linearized equations:\n1.  Linearized Continuity: $\\frac{\\partial \\rho'}{\\partial t} + U \\frac{\\partial \\rho'}{\\partial x} + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$\n2.  Linearized Momentum: $\\rho_0 \\left(\\frac{\\partial u'}{\\partial t} + U \\frac{\\partial u'}{\\partial x}\\right) = -\\frac{\\partial p'}{\\partial x}$\n\nWe can introduce the material derivative following the mean flow, $D_t \\equiv \\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}$. Using $p' = c^2\\rho'$, the linearized equations become:\n1.  $\\frac{1}{c^2} D_t p' + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$\n2.  $\\rho_0 D_t u' = -\\frac{\\partial p'}{\\partial x}$\n\n**2. Derivation of the Convective Wave Equation**\nTo obtain a single equation for the pressure perturbation $p'$, we can eliminate $u'$. We apply the operator $D_t$ to the first equation and $\\frac{\\partial}{\\partial x}$ to the second equation. Since $U$ is constant, $D_t$ and $\\frac{\\partial}{\\partial x}$ commute.\n1.  $\\frac{1}{c^2} D_t^2 p' + \\rho_0 D_t \\left(\\frac{\\partial u'}{\\partial x}\\right) = D_t q_m$\n2.  $\\rho_0 D_t \\left(\\frac{\\partial u'}{\\partial x}\\right) = -\\frac{\\partial^2 p'}{\\partial x^2}$\n\nSubstituting the second result into the first yields the convective wave equation for pressure:\n$$ \\frac{1}{c^2} D_t^2 p' - \\frac{\\partial^2 p'}{\\partial x^2} = D_t q_m $$\nExpanding the material derivative operator $D_t^2 = (\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x})^2 = \\frac{\\partial^2}{\\partial t^2} + 2U \\frac{\\partial^2}{\\partial t \\partial x} + U^2 \\frac{\\partial^2}{\\partial x^2}$, and defining the Mach number $M = U/c$, we get the PDE for $p'(x,t)$:\n$$ \\frac{1}{c^2} \\frac{\\partial^2 p'}{\\partial t^2} + \\frac{2M}{c} \\frac{\\partial^2 p'}{\\partial t \\partial x} - (1-M^2) \\frac{\\partial^2 p'}{\\partial x^2} = D_t q_m $$\n\n**3. Frequency-Domain Formulation and Solution**\nWe seek a time-harmonic solution $p'(x,t) = \\operatorname{Re}\\{P(x) \\exp(-\\mathrm{i}\\omega t)\\}$. Working with complex amplitudes, the substitution $p'(x,t) = P(x)\\exp(-\\mathrm{i}\\omega t)$ transforms the operators $\\frac{\\partial}{\\partial t} \\to -\\mathrm{i}\\omega$ and $D_t \\to (-\\mathrm{i}\\omega + U \\frac{d}{dx})$. The source is a point monopole at $x=0$ with complex mass injection rate strength $Q$, so $q_m(x,t) = \\operatorname{Re}\\{Q \\delta(x) \\exp(-\\mathrm{i}\\omega t)\\}$. The complex source is $Q\\delta(x)\\exp(-\\mathrm{i}\\omega t)$.\n\nFor $x \\neq 0$, the source term is zero, and the frequency-domain equation for the complex pressure amplitude $P(x)$ is a homogeneous ordinary differential equation (ODE):\n$$ (1-M^2)\\frac{d^2P}{dx^2} + 2\\mathrm{i}Mk\\frac{dP}{dx} + k^2 P = 0 $$\nwhere $k=\\omega/c$ is the quiescent-medium wavenumber. We seek solutions of the form $P(x) = A \\exp(\\mathrm{i}\\lambda x)$. Substituting this ansatz yields the characteristic equation for $\\lambda$:\n$$ (1-M^2)\\lambda^2 + 2Mk\\lambda - k^2 = 0 $$\nThe roots are:\n$$ \\lambda = \\frac{-2Mk \\pm \\sqrt{4M^2k^2 - 4(1-M^2)(-k^2)}}{2(1-M^2)} = \\frac{k(-M \\pm 1)}{1-M^2} $$\nThis gives two possible wavenumbers:\n$\\lambda_1 = \\frac{k(1-M)}{(1-M)(1+M)} = \\frac{k}{1+M}$, which corresponds to a downstream-propagating wave.\n$\\lambda_2 = \\frac{k(-1-M)}{1-M^2} = -\\frac{k}{1-M}$, which corresponds to an upstream-propagating wave.\n\nThe radiation condition requires that for $x > 0$ (downstream of the source), we consider only the wave propagating away from the source in the positive $x$ direction. Therefore, the solution for $x>0$ has the form:\n$$ P(x) = A_+ \\exp(\\mathrm{i}\\lambda_1 x) = A_+ \\exp\\left(\\frac{\\mathrm{i}kx}{1+M}\\right) $$\nFor $x < 0$, the solution must be the upstream-propagating wave: $P(x) = A_- \\exp(\\mathrm{i}\\lambda_2 x) = A_- \\exp\\left(-\\frac{\\mathrm{i}kx}{1-M}\\right)$.\n\n**4. Application of Source Jump Conditions**\nTo find the amplitude $A_+$, we derive jump conditions across the source at $x=0$ from the first-order linearized equations.\n1.  Integrating the momentum equation $\\rho_0 D_t u' = -\\frac{\\partial p'}{\\partial x}$ across an infinitesimal interval $[-\\epsilon, \\epsilon]$ around $x=0$, the left-hand side vanishes, implying $[p']_0=p'(0^+)-p'(0^-)=0$. Thus, pressure is continuous across the source: $P(0^+) = P(0^-)$. This means $A_+ = A_- = A$.\n2.  Integrating the continuity equation $\\frac{1}{c^2} D_t p' + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$ across $[-\\epsilon, \\epsilon]$ gives $\\rho_0 [u']_0 = \\int q_m dx$. In the frequency domain, with $u'(x,t)=\\hat{u}(x)\\exp(-\\mathrm{i}\\omega t)$ and source $Q\\delta(x)$, this becomes $\\rho_0(\\hat{u}(0^+) - \\hat{u}(0^-)) = Q$.\n\nThe specific acoustic impedance for a plane wave in a moving medium is $Z=p'/u'=\\rho_0\\frac{\\omega-Uk_{eff}}{k_{eff}}$.\nFor the downstream wave, $k_{eff}=\\lambda_1=k/(1+M)$, which gives $Z_+ = \\rho_0 c$.\nFor the upstream wave, $k_{eff}=\\lambda_2=-k/(1-M)$, which gives $Z_- = -\\rho_0 c$.\n\nSo, $\\hat{u}(0^+) = P(0^+)/Z_+ = A/(\\rho_0 c)$ and $\\hat{u}(0^-) = P(0^-)/Z_- = A/(-\\rho_0 c)$.\nSubstituting into the jump condition $\\rho_0(\\hat{u}(0^+) - \\hat{u}(0^-)) = Q$:\n$\\rho_0 \\left( \\frac{A}{\\rho_0 c} - \\frac{A}{-\\rho_0 c} \\right) = Q$\n$\\frac{1}{c}(A + A) = Q$.\n$\\frac{2A}{c} = Q \\implies A = \\frac{Qc}{2}$.\n\nThe complex pressure amplitude for $x>0$ is:\n$$ P(x) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}kx}{1+M} \\right) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}(\\omega/c)x}{1+U/c} \\right) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}\\omega x}{c+U} \\right) $$\n\n**5. Sensitivity Analysis**\nThe sensor is located at $x_s > 0$. The complex pressure is:\n$$ P(x_s) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}\\omega x_s}{c+U} \\right) $$\nThe prediction functional is the unwrapped phase of $P(x_s)$:\n$$ \\Phi(U) = \\arg\\big(P(x_s)\\big) = \\arg\\left( \\frac{Qc}{2} \\right) + \\frac{\\omega x_s}{c+U} $$\nThe term $\\arg(Qc/2)$ is a constant with respect to $U$.\n\nWe need to compute the sensitivity (gradient) of $\\Phi$ with respect to $U$:\n$$ \\frac{d\\Phi}{dU} = \\frac{d}{dU} \\left( \\arg\\left(\\frac{Qc}{2}\\right) + \\frac{\\omega x_s}{c+U} \\right) $$\n$$ \\frac{d\\Phi}{dU} = 0 + \\omega x_s \\frac{d}{dU} \\left( (c+U)^{-1} \\right) $$\nUsing the power rule and chain rule:\n$$ \\frac{d\\Phi}{dU} = \\omega x_s \\left( -1 \\cdot (c+U)^{-2} \\cdot \\frac{d}{dU}(c+U) \\right) $$\n$$ \\frac{d\\Phi}{dU} = -\\omega x_s (c+U)^{-2} $$\nThe final analytical expression for the sensitivity is:\n$$ \\frac{d\\Phi}{dU} = -\\frac{\\omega x_s}{(c+U)^2} $$\n\nThe units are consistent with the requirement of s/m: $\\omega$ is in s$^{-1}$, $x_s$ is in m, and $(c+U)$ is in m/s. The resulting unit is $\\frac{\\mathrm{s}^{-1} \\cdot \\mathrm{m}}{(\\mathrm{m}/\\mathrm{s})^2} = \\frac{\\mathrm{m}/\\mathrm{s}}{\\mathrm{m}^2/\\mathrm{s}^2} = \\frac{\\mathrm{s}}{\\mathrm{m}}$.",
            "answer": "$$\n\\boxed{-\\frac{\\omega x_{s}}{(c+U)^{2}}}\n$$"
        },
        {
            "introduction": "Moving from analytical solutions to numerical simulations requires a crucial step: verification. This hands-on coding practice guides you through implementing a time-domain solver for the convective wave equation and using the method of manufactured solutions to perform a grid convergence study . Successfully completing this exercise will equip you with one of the most critical skills in computational science—the ability to demonstrate that your code is producing results that are both correct and accurate to the expected order.",
            "id": "4115450",
            "problem": "Consider small-amplitude acoustics in a one-dimensional, inviscid, compressible fluid with a uniform mean flow speed $U$ and constant sound speed $c$. Starting from fundamental conservation laws, the linearized dynamics for the acoustic pressure perturbation $p(x,t)$ in a uniform mean flow are governed by the convected wave equation\n$$\n\\left(\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}\\right)^2 p(x,t) - c^2 \\frac{\\partial^2 p(x,t)}{\\partial x^2} = 0,\n$$\non a periodic spatial domain $x \\in [0,L]$ with period $L$. For a manufactured traveling-wave solution of the form\n$$\np_{\\text{exact}}(x,t) = \\sin\\big(k x - \\omega t\\big),\n$$\nthe dispersion relation implied by the convected wave equation requires\n$$\n\\omega = U k \\pm c k,\n$$\nso that the two branches travel with phase speeds $U \\pm c$. Choose the $+$ branch with $\\omega = k(U + c)$. Define the convective derivative as $D_t p = \\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}$. Introduce the auxiliary variable $q = D_t p$ and rewrite the second-order equation as the first-order system\n$$\n\\frac{\\partial p}{\\partial t} = - U \\frac{\\partial p}{\\partial x} + q, \\qquad \\frac{\\partial q}{\\partial t} = - U \\frac{\\partial q}{\\partial x} + c^2 \\frac{\\partial^2 p}{\\partial x^2},\n$$\nsubject to periodic boundary conditions. The exact manufactured initial conditions at $t=0$ for the chosen branch are\n$$\np(x,0) = \\sin(k x), \\qquad q(x,0) = \\left.\\left(\\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}\\right)\\right|_{t=0} = - c k \\cos(k x).\n$$\n\nYour task is to write a complete, runnable program that:\n- Discretizes the above first-order system in space using second-order centered finite differences for $\\frac{\\partial}{\\partial x}$ and $\\frac{\\partial^2}{\\partial x^2}$ under periodic boundary conditions.\n- Advances the solution in time using the explicit two-stage second-order Runge–Kutta method (also known as Heun’s method).\n- Uses the Courant–Friedrichs–Lewy (CFL) condition to select the time step as $\\Delta t = \\text{CFL} \\cdot \\Delta x / (|U| + c)$, with the CFL number set to $\\text{CFL} = 0.2$. Use an integer number of time steps so that the final integration time is exactly $T$ by choosing the number of steps $N_t = \\lceil T / \\Delta t \\rceil$ and then resetting $\\Delta t \\leftarrow T / N_t$.\n- Computes the numerical solution $p_{\\text{num}}(x,T)$ and compares it to $p_{\\text{exact}}(x,T)$ using the discrete $L^2$ norm of the error,\n$$\nE(\\Delta x) = \\left(\\Delta x \\sum_{i} \\left[p_{\\text{num}}(x_i,T) - p_{\\text{exact}}(x_i,T)\\right]^2 \\right)^{1/2}.\n$$\n- Evaluates the observed grid convergence rate $p_{\\text{obs}}$ by fitting a straight line to $\\log E(\\Delta x)$ versus $\\log \\Delta x$ over a set of four successively refined uniform grids and taking the slope of the fit as the observed order.\n- Interprets the observed rate against the theoretical accuracy $p_{\\text{th}} = 2$ for the chosen second-order discretization by returning a boolean $b$ that is true if $|p_{\\text{obs}} - 2| \\le 0.15$ and false otherwise.\n\nAngles in all trigonometric functions must be in radians. All physical quantities must use the International System of Units (SI): $x$ and $L$ in meters, $t$ and $T$ in seconds, $U$ and $c$ in meters per second, and $k$ in radians per meter.\n\nImplement the following test suite of parameter values to ensure coverage of different mean-flow regimes and directions:\n- Test case 1 (baseline, no mean flow): $L = 1.0$ m, $c = 340.0$ m/s, $U = 0.0$ m/s, $m = 1$ wavelength so that $k = 2\\pi m / L$, $T = 0.001$ s, grids with $N = [50,100,200,400]$ points.\n- Test case 2 (moderate co-flow): $L = 1.0$ m, $c = 340.0$ m/s, $U = 100.0$ m/s, $m = 1$, $T = 0.001$ s, $N = [50,100,200,400]$.\n- Test case 3 (moderate counter-flow): $L = 1.0$ m, $c = 340.0$ m/s, $U = -50.0$ m/s, $m = 1$, $T = 0.001$ s, $N = [50,100,200,400]$.\n- Test case 4 (near-transonic co-flow): $L = 1.0$ m, $c = 340.0$ m/s, $U = 306.0$ m/s, $m = 1$, $T = 0.001$ s, $N = [50,100,200,400]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element must be a two-item list $[p_{\\text{obs}}, b]$ corresponding to the test cases in the order listed above. For example, the output should look like\n$[[p_1,b_1],[p_2,b_2],[p_3,b_3],[p_4,b_4]]$,\nwhere each $p_i$ is a floating-point number and each $b_i$ is a boolean.",
            "solution": "The user-provided problem is a well-posed task in computational acoustics, requiring the numerical solution of the one-dimensional convected wave equation and a verification of the numerical scheme's convergence rate. The problem is scientifically sound, self-contained, and all parameters and methods are clearly defined.\n\nThe solution proceeds by discretizing the governing partial differential equations (PDEs) into a system of ordinary differential equations (ODEs), which is then integrated in time. The core steps of the methodology are outlined below.\n\n### 1. System of Equations\nThe problem begins with the second-order convected wave equation for acoustic pressure perturbation $p(x,t)$:\n$$\n\\left(\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}\\right)^2 p - c^2 \\frac{\\partial^2 p}{\\partial x^2} = 0\n$$\nwhere $U$ is the uniform mean flow velocity and $c$ is the constant speed of sound. By defining an auxiliary variable $q = \\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}$, this equation is recast as a first-order system in time:\n$$\n\\begin{align*}\n\\frac{\\partial p}{\\partial t} &= - U \\frac{\\partial p}{\\partial x} + q \\\\\n\\frac{\\partial q}{\\partial t} &= - U \\frac{\\partial q}{\\partial x} + c^2 \\frac{\\partial^2 p}{\\partial x^2}\n\\end{align*}\n$$\nThis system is solved on a periodic spatial domain $x \\in [0, L]$.\n\n### 2. Spatial Discretization\nThe spatial domain $[0, L]$ is discretized into $N$ uniformly spaced grid points $x_i = i \\Delta x$ for $i = 0, 1, \\dots, N-1$, where the grid spacing is $\\Delta x = L/N$. The values of $p$ and $q$ at these points are denoted by $p_i(t) = p(x_i, t)$ and $q_i(t) = q(x_i, t)$, respectively.\n\nThe spatial derivatives are approximated using $2^{\\text{nd}}$-order centered finite differences. For a generic function $f(x)$ on the grid, the derivatives at point $x_i$ are:\n- First derivative: $\\left(\\frac{\\partial f}{\\partial x}\\right)_i \\approx \\frac{f_{i+1} - f_{i-1}}{2 \\Delta x}$\n- Second derivative: $\\left(\\frac{\\partial^2 f}{\\partial x^2}\\right)_i \\approx \\frac{f_{i+1} - 2f_i + f_{i-1}}{\\Delta x^2}$\n\nDue to the periodic boundary conditions, the indices are handled modulo $N$, i.e., $f_{N} \\equiv f_0$ and $f_{-1} \\equiv f_{N-1}$. Applying these discretizations to the first-order system yields a large system of coupled ordinary differential equations (ODEs) for the grid-point values:\n$$\n\\begin{align*}\n\\frac{d p_i}{d t} &= - U \\left(\\frac{p_{i+1} - p_{i-1}}{2 \\Delta x}\\right) + q_i \\\\\n\\frac{d q_i}{d t} &= - U \\left(\\frac{q_{i+1} - q_{i-1}}{2 \\Delta x}\\right) + c^2 \\left(\\frac{p_{i+1} - 2p_i + p_{i-1}}{\\Delta x^2}\\right)\n\\end{align*}\n$$\nThis system can be written in compact vector form as $\\frac{d\\mathbf{y}}{dt} = \\mathbf{F}(\\mathbf{y})$, where $\\mathbf{y}(t) = [p_0(t), \\dots, p_{N-1}(t), q_0(t), \\dots, q_{N-1}(t)]^T$ is the state vector of size $2N$, and $\\mathbf{F}$ is the function representing the discretized spatial operators on the right-hand side.\n\n### 3. Temporal Integration\nThe system of ODEs is advanced in time using the explicit $2^{\\text{nd}}$-order two-stage Runge-Kutta method, also known as Heun's method. For a time step $\\Delta t$, the state vector $\\mathbf{y}^{n+1}$ at time $t_{n+1} = t_n + \\Delta t$ is computed from $\\mathbf{y}^n$ at time $t_n$ as follows:\n1. Predictor step: $\\mathbf{y}^* = \\mathbf{y}^n + \\Delta t \\cdot \\mathbf{F}(\\mathbf{y}^n)$\n2. Corrector step: $\\mathbf{y}^{n+1} = \\mathbf{y}^n + \\frac{\\Delta t}{2} \\left[ \\mathbf{F}(\\mathbf{y}^n) + \\mathbf{F}(\\mathbf{y}^*) \\right]$\n\nThe time step $\\Delta t$ is chosen based on the Courant–Friedrichs–Lewy (CFL) condition for numerical stability. The maximum characteristic speed of the system is $|U| + c$. A preliminary time step is calculated as $\\Delta t_{\\text{CFL}} = \\text{CFL} \\cdot \\Delta x / (|U| + c)$ with a given CFL number of $0.2$. To ensure the simulation stops at the exact final time $T$, the number of integer time steps is calculated as $N_t = \\lceil T / \\Delta t_{\\text{CFL}} \\rceil$. The actual time step used for integration is then re-calculated as $\\Delta t = T / N_t$.\n\n### 4. Convergence Analysis\nThe numerical simulation is initialized at $t=0$ using the manufactured exact solution:\n$$\np(x,0) = \\sin(k x), \\qquad q(x,0) = -c k \\cos(k x)\n$$\nwhere the wavenumber is $k = 2\\pi m / L$ with $m=1$. After integrating to the final time $T$, the numerical solution $p_{\\text{num}}(x_i, T)$ is compared to the exact solution $p_{\\text{exact}}(x_i, T) = \\sin(k x_i - \\omega T)$, where the angular frequency is $\\omega = k(U+c)$.\n\nThe error is quantified using the discrete $L^2$ norm:\n$$\nE(\\Delta x) = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[p_{\\text{num}}(x_i,T) - p_{\\text{exact}}(x_i,T)\\right]^2 \\right)^{1/2}\n$$\nThe theoretical order of accuracy for the combined spatial and temporal discretization is $p_{\\text{th}} = 2$. This implies that the error should scale as $E(\\Delta x) \\propto (\\Delta x)^{p_{\\text{th}}}$. To verify this, we run the simulation for a sequence of four grid resolutions $N=[50, 100, 200, 400]$, yielding a set of grid spacings $\\Delta x_j$ and corresponding errors $E_j$. Taking the logarithm, we get $\\log(E) \\approx \\log(C) + p_{\\text{obs}} \\log(\\Delta x)$. The observed convergence rate, $p_{\\text{obs}}$, is determined by finding the slope of a best-fit line to the points $(\\log(\\Delta x_j), \\log(E_j))$ using linear regression.\n\nFinally, the observed rate is compared to the theoretical rate. A boolean flag $b$ is set to true if the observed rate is within a tolerance of the theoretical rate, i.e., $|p_{\\text{obs}} - 2| \\le 0.15$. The procedure is repeated for each test case specified in the problem.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        # (L, c, U, m, T, N_list)\n        (1.0, 340.0, 0.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, 100.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, -50.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, 306.0, 1, 0.001, [50, 100, 200, 400]),\n    ]\n\n    results = []\n    for params in test_cases:\n        p_obs, is_convergent = solve_case(*params)\n        results.append([p_obs, is_convergent])\n    \n    # Format the output string as specified, without extra spaces\n    result_strings = [f'[{r[0]},{str(r[1]).lower()}]' for r in results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef solve_case(L, c, U, m, T, N_list):\n    \"\"\"\n    Solves the convected wave equation for a single test case over a range of\n    grid resolutions to determine the convergence rate.\n    \n    Returns:\n        A list [p_obs, b] where p_obs is the observed convergence rate\n        and b is a boolean indicating if the rate is close to the theoretical\n        second-order accuracy.\n    \"\"\"\n    errors = []\n    dxs = []\n    \n    k = 2.0 * np.pi * m / L\n    omega = k * (U + c)\n\n    def rhs(y, N, dx, U_val, c_val):\n        \"\"\"\n        Computes the right-hand side of the semi-discretized system dy/dt = F(y).\n        \"\"\"\n        p = y[:N]\n        q = y[N:]\n        \n        # Second-order centered differences with periodic boundaries using np.roll\n        dpdx = (np.roll(p, -1) - np.roll(p, 1)) / (2.0 * dx)\n        dqdx = (np.roll(q, -1) - np.roll(q, 1)) / (2.0 * dx)\n        d2pdx2 = (np.roll(p, -1) - 2.0 * p + np.roll(p, 1)) / (dx**2)\n        \n        dpdt = -U_val * dpdx + q\n        dqdt = -U_val * dqdx + c_val**2 * d2pdx2\n        \n        return np.concatenate((dpdt, dqdt))\n\n    for N in N_list:\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        dxs.append(dx)\n        \n        # Time step calculation based on CFL condition\n        cfl = 0.2\n        # Use abs(U) + c as the maximum characteristic speed\n        max_speed = abs(U) + c\n        if max_speed == 0:\n            # Fallback for theoretical case U=0, c=0; not in test data\n            dt_cfl = 1e-6\n        else:\n            dt_cfl = cfl * dx / max_speed\n\n        # Ensure final time is exactly T\n        Nt = int(np.ceil(T / dt_cfl))\n        dt = T / Nt\n        \n        # Initial conditions at t=0\n        p0 = np.sin(k * x)\n        q0 = -c * k * np.cos(k * x)\n        y = np.concatenate((p0, q0))\n        \n        # Time integration using 2nd-order Runge-Kutta (Heun's method)\n        for _ in range(Nt):\n            dydt1 = rhs(y, N, dx, U, c)\n            y_star = y + dt * dydt1\n            dydt2 = rhs(y_star, N, dx, U, c)\n            y = y + (dt / 2.0) * (dydt1 + dydt2)\n            \n        # Error calculation\n        p_num = y[:N]\n        p_exact = np.sin(k * x - omega * T)\n        \n        # Discrete L2 norm of the error\n        error = np.sqrt(dx * np.sum((p_num - p_exact)**2))\n        errors.append(error)\n\n    # Calculate observed convergence rate p_obs\n    log_dx = np.log(np.array(dxs))\n    log_E = np.log(np.array(errors))\n    \n    # Fit a line: log(E) = p_obs * log(dx) + const\n    p_obs, _ = np.polyfit(log_dx, log_E, 1)\n    \n    # Validate rate against theoretical rate of 2\n    is_convergent = abs(p_obs - 2.0) <= 0.15\n    \n    return p_obs, is_convergent\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "A pervasive challenge in computational wave modeling is the need to simulate phenomena in unbounded domains using finite computational resources. This practice tackles this problem head-on by having you design and optimize a \"sponge layer,\" a widely used absorbing boundary condition . You will apply the concept of wave impedance to analyze the sponge's reflectivity and then numerically search for the optimal damping parameter that minimizes reflections, a task that beautifully merges physical insight with computational design.",
            "id": "4115459",
            "problem": "Consider linearized acoustics in a uniform, inviscid, compressible fluid of constant base density $\\rho_0$, constant base sound speed $c_0$, and a uniform mean flow $\\mathbf{U} = U \\,\\hat{\\mathbf{x}}$. Let $p'(\\mathbf{x},t)$ denote the acoustic pressure perturbation. The convective derivative is $D_t = \\partial_t + \\mathbf{U}\\cdot\\nabla$. In the physical domain, the acoustic field satisfies the convective wave equation. A sponge layer is implemented adjacent to a planar boundary normal to the $x$-direction by augmenting the pressure equation inside the sponge with a relaxation term $\\sigma(\\mathbf{x}) D_t p'$, where $\\sigma(\\mathbf{x}) \\ge 0$ is a spatially varying relaxation strength. Outside the sponge, $\\sigma(\\mathbf{x})=0$.\n\nYour task is to design a program that, for a semi-infinite sponge layer occupying $x>0$ with a uniform relaxation strength $\\sigma$ (constant in $x$), computes and tunes $\\sigma$ to minimize the reflection magnitude for incident plane waves over a specified frequency band and set of incidence angles. Assume the interface between the undamped region ($x<0$) and the sponge ($x>0$) is at $x=0$, and model the reflection at $x=0$ using a plane-wave impedance mismatch with the following physical constraints:\n\n- The undamped region satisfies the convective wave dynamics with $\\sigma=0$.\n- The sponge region satisfies the convective wave dynamics with the relaxation term $\\sigma D_t p'$ active.\n- The tangential wavenumber component (along $y$) is conserved across the interface.\n- The sponge layer is semi-infinite so that no reflection occurs from $x\\to +\\infty$; only the interface reflection at $x=0$ is relevant.\n\nStarting from first principles of linearized acoustics in moving media, the program shall use the physically admissible plane-wave solutions and interface continuity conditions to compute, for each frequency $f$ and incidence angle $\\theta$, the normal wavenumber $k_x$ in the undamped region, the corresponding tangential wavenumber $k_y$, the complex normal wavenumber in the sponge, and the resulting plane-wave normal specific acoustic impedances on both sides of the interface. The reflection coefficient at the interface is then computed as the ratio of impedance mismatch, and its magnitude is used as the reflection metric. Your program must choose $\\sigma$ to minimize the worst-case (maximum over the frequency band and angle set) reflection magnitude.\n\nUnits and conventions:\n\n- Use $c_0$ in $\\mathrm{m/s}$, $U$ in $\\mathrm{m/s}$, and $\\rho_0$ in $\\mathrm{kg/m^3}$.\n- Frequencies are given in $\\mathrm{Hz}$ and must be converted to angular frequency $\\omega$ in $\\mathrm{rad/s}$ using $\\omega = 2\\pi f$.\n- Angles are specified in degrees and must be interpreted in degrees.\n- The relaxation strength $\\sigma$ is in $\\mathrm{s^{-1}}$.\n- The output relaxation strengths must be reported in $\\mathrm{s^{-1}}$, rounded to six decimal places.\n\nOptimization protocol:\n\n- For each test case, sample the frequency band using $N_f=20$ equally spaced points between $f_{\\min}$ and $f_{\\max}$ (inclusive).\n- For the angle set, use the given discrete angles as-is.\n- For each candidate $\\sigma$ in a search grid $\\sigma \\in [0,5000]\\,\\mathrm{s^{-1}}$ sampled at $\\Delta\\sigma=25\\,\\mathrm{s^{-1}}$, compute the maximum reflection magnitude over all sampled frequencies and angles. Choose the $\\sigma$ that minimizes this maximum. If multiple $\\sigma$ achieve the same minimum within numerical tolerance, choose the smallest such $\\sigma$.\n\nTest suite:\n\nFor all test cases, use $\\rho_0 = 1.225\\,\\mathrm{kg/m^3}$ and $c_0 = 343\\,\\mathrm{m/s}$. Angles are in degrees.\n\n- Test case 1 (happy path): $U = 30\\,\\mathrm{m/s}$, $f_{\\min} = 800\\,\\mathrm{Hz}$, $f_{\\max} = 1200\\,\\mathrm{Hz}$, angles $\\theta \\in \\{0,30,60\\}$.\n- Test case 2 (near-grazing incidence): $U = 30\\,\\mathrm{m/s}$, $f_{\\min} = 500\\,\\mathrm{Hz}$, $f_{\\max} = 1500\\,\\mathrm{Hz}$, angles $\\theta \\in \\{80,85,89\\}$.\n- Test case 3 (higher Mach flow): $U = 150\\,\\mathrm{m/s}$, $f_{\\min} = 1000\\,\\mathrm{Hz}$, $f_{\\max} = 2000\\,\\mathrm{Hz}$, angles $\\theta \\in \\{0,45,75\\}$.\n- Test case 4 (low-frequency band): $U = 10\\,\\mathrm{m/s}$, $f_{\\min} = 50\\,\\mathrm{Hz}$, $f_{\\max} = 150\\,\\mathrm{Hz}$, angles $\\theta \\in \\{0,30,60\\}$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the optimal relaxation strengths for the four test cases, in $\\mathrm{s^{-1}}$, rounded to six decimal places, as a comma-separated list enclosed in square brackets, for example, \"[sigma1,sigma2,sigma3,sigma4]\".",
            "solution": "The present task requires the determination of an optimal relaxation strength $\\sigma$ for a semi-infinite sponge layer designed to absorb acoustic waves in a uniform mean flow. The optimization criterion is to minimize the maximum reflection coefficient magnitude over a specified range of frequencies and incidence angles. The solution involves deriving the reflection properties of the interface between the standard fluid and the sponge layer from first principles.\n\nWe begin with the governing equations. The acoustic field is described by the pressure perturbation $p'(\\mathbf{x}, t)$ in a fluid with base density $\\rho_0$, sound speed $c_0$, and a uniform mean flow $\\mathbf{U} = U \\hat{\\mathbf{x}}$. The material derivative in the presence of the mean flow is $D_t = \\partial_t + \\mathbf{U} \\cdot \\nabla = \\partial_t + U \\partial_x$.\n\nIn the undamped region ($x<0$), the pressure field satisfies the convective wave equation:\n$$ \\frac{1}{c_0^2} D_t^2 p' - \\nabla^2 p' = 0 $$\nIn the sponge region ($x>0$), the equation is augmented with a relaxation term, which, based on standard formulations for absorbing layers, modifies the convective wave equation to:\n$$ \\frac{1}{c_0^2} D_t^2 p' + \\frac{\\sigma}{c_0^2} D_t p' - \\nabla^2 p' = 0 $$\nwhere $\\sigma > 0$ is the constant relaxation strength.\n\nTo analyze reflection and transmission, we seek plane-wave solutions of the form $p'(\\mathbf{x}, t) = \\hat{p} \\exp(\\mathrm{i}(k_x x + k_y y - \\omega t))$. Applying the differential operators to this form yields: $\\partial_t \\to -i\\omega$, $\\nabla \\to i\\mathbf{k} = i(k_x \\hat{\\mathbf{x}} + k_y \\hat{\\mathbf{y}})$, and $D_t \\to \\mathrm{i}(Uk_x - \\omega)$. Substituting these into the governing equations gives the dispersion relation for each region.\n\nFor the undamped region ($x<0$, denoted by subscript $1$):\n$$ -\\frac{1}{c_0^2}(\\omega - Uk_x)^2 + (k_x^2 + k_y^2) = 0 $$\nThis can be rearranged into a quadratic equation for $k_x$:\n$$ (c_0^2 - U^2)k_x^2 + (2\\omega U)k_x + (c_0^2 k_y^2 - \\omega^2) = 0 $$\n\nFor the sponge region ($x>0$, denoted by subscript $2$):\n$$ -\\frac{1}{c_0^2}(\\omega - Uk_x)^2 + \\mathrm{i}\\frac{\\sigma}{c_0^2}(\\omega - Uk_x) + (k_x^2 + k_y^2) = 0 $$\nThis also yields a quadratic equation for the complex wavenumber $k_{x,s}$ in the sponge:\n$$ (c_0^2 - U^2)k_{x,s}^2 + (2\\omega U - \\mathrm{i}\\sigma U)k_{x,s} + (c_0^2 k_y^2 - \\omega^2 + \\mathrm{i}\\sigma\\omega) = 0 $$\n\nAn incident plane wave is characterized by its frequency $f$ (angular frequency $\\omega=2\\pi f$) and incidence angle $\\theta$ relative to the $x$-axis. The wave vector $\\mathbf{k}_{\\text{inc}}$ makes an angle $\\theta$ with the $x$-axis. Its magnitude $k = |\\mathbf{k}_{\\text{inc}}|$ is related to $\\omega$ via the dispersion relation: $(\\omega - U k \\cos\\theta)^2 = (c_0 k)^2$. For a forward-propagating wave in a subsonic flow, we take the positive root, leading to $\\omega - U k \\cos\\theta = c_0 k$, which gives $k = \\omega / (c_0 + U\\cos\\theta)$. The components of the incident wave vector are:\n$$ k_{x,\\text{inc}} = \\frac{\\omega \\cos\\theta}{c_0 + U\\cos\\theta}, \\quad k_y = \\frac{\\omega \\sin\\theta}{c_0 + U\\cos\\theta} $$\nThe tangential wavenumber $k_y$ must be continuous across the interface at $x=0$.\nIn the undamped region, for a given $(\\omega, k_y)$, there are two solutions for $k_x$: the incident $k_{x,\\text{inc}}$ and the reflected $k_{x,\\text{refl}}$. From Vieta's formulas applied to the quadratic for $k_x$, their sum is $k_{x,\\text{inc}} + k_{x,\\text{refl}} = -2\\omega U / (c_0^2 - U^2)$. Thus,\n$$ k_{x,\\text{refl}} = -\\frac{2\\omega U}{c_0^2 - U^2} - k_{x,\\text{inc}} $$\n\nIn the sponge region, we solve the complex quadratic equation for $k_{x,s}$. Let the equation be $A k_{x,s}^2 + B k_{x,s} + C = 0$. The solutions are $k_{x,s} = (-B \\pm \\sqrt{B^2-4AC})/(2A)$. Since the sponge is semi-infinite, the wave must decay as $x \\to \\infty$. This physical constraint requires that the imaginary part of $k_{x,s}$ be positive, i.e., $\\operatorname{Im}(k_{x,s}) > 0$. We select the root that satisfies this condition.\n\nThe reflection coefficient is determined by the impedance mismatch. The normal specific acoustic impedance for a single plane wave is derived from the linearized momentum equation in the $x$-direction, $\\rho_0 D_t u'_x = -\\partial_x p'$:\n$$ Z(k_x) = \\frac{\\hat{p}}{\\hat{u}_x} = \\frac{\\rho_0(\\omega - Uk_x)}{k_x} $$\nAt the interface, the total fields must be continuous. The impedance of the incident, reflected, and transmitted waves are $Z_i = Z(k_{x,\\text{inc}})$, $Z_r = Z(k_{x,\\text{refl}})$, and $Z_2 = Z(k_{x,s})$, respectively.\nThe pressure reflection coefficient $R = \\hat{p}_{\\text{refl}} / \\hat{p}_{\\text{inc}}$ is found by enforcing continuity of pressure and normal particle velocity at the interface, which yields a relation between the impedances:\n$$ R = \\frac{Z_r(Z_i - Z_2)}{Z_i(Z_2 - Z_r)} $$\nThe reflection coefficient magnitude $|R|$ is computed for each pair of frequency and angle.\n\nThe optimization procedure involves a grid search over the specified range of $\\sigma$. For each candidate $\\sigma$, we compute the maximum value of $|R|$ across all sampled frequencies and angles. The optimal $\\sigma$ is the one that minimizes this maximum $|R|$. If a tie occurs, the smallest $\\sigma$ is chosen.\n\nThe algorithm is as follows:\n1.  For each test case, set up the grids for frequency $f_j$ and relaxation strength $\\sigma_k$.\n2.  Initialize $\\sigma_{\\text{opt}} = 0$ and a minimum-of-maximums reflection $R_{\\min-\\max} = \\infty$.\n3.  Loop over each $\\sigma_k$:\n4.  Initialize a maximum reflection for the current sigma, $R_{\\max}(\\sigma_k) = 0$.\n5.  Loop over each frequency $f_j$ and angle $\\theta_l$:\n    a. Calculate $\\omega=2\\pi f_j$ and convert $\\theta_l$ to radians.\n    b. Compute $k_{x,\\text{inc}}$ and $k_y$.\n    c. Compute $k_{x,\\text{refl}}$.\n    d. Solve the complex quadratic dispersion relation for the sponge to find $k_{x,s}$ with $\\operatorname{Im}(k_{x,s})>0$.\n    e. Calculate the impedances $Z_i$, $Z_r$, and $Z_2$. Special care is taken for cases where a wavenumber component is near zero, although the derived formulas are well-behaved.\n    f. Compute the reflection coefficient magnitude $|R|$.\n    g. Update $R_{\\max}(\\sigma_k) = \\max(R_{\\max}(\\sigma_k), |R|)$.\n6.  If $R_{\\max}(\\sigma_k) < R_{\\min-\\max}$, update $R_{\\min-\\max} = R_{\\max}(\\sigma_k)$ and $\\sigma_{\\text{opt}} = \\sigma_k$.\n7.  The final $\\sigma_{\\text{opt}}$ for the test case is the result. This procedure is repeated for all test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal sponge layer relaxation strength for several test cases.\n    \"\"\"\n    RHO_0 = 1.225  # kg/m^3\n    C_0 = 343.0    # m/s\n\n    test_cases = [\n        # (U, f_min, f_max, angles)\n        (30.0, 800.0, 1200.0, [0, 30, 60]),\n        (30.0, 500.0, 1500.0, [80, 85, 89]),\n        (150.0, 1000.0, 2000.0, [0, 45, 75]),\n        (10.0, 50.0, 150.0, [0, 30, 60]),\n    ]\n    \n    # Optimization parameters\n    N_F = 20\n    SIGMA_MIN = 0.0\n    SIGMA_MAX = 5000.0\n    SIGMA_STEP = 25.0\n\n    optimal_sigmas = []\n\n    for U, f_min, f_max, angles_deg in test_cases:\n        \n        freqs = np.linspace(f_min, f_max, N_F)\n        angles_rad = np.deg2rad(angles_deg)\n        sigmas = np.arange(SIGMA_MIN, SIGMA_MAX + SIGMA_STEP, SIGMA_STEP)\n\n        min_max_R_mag = float('inf')\n        optimal_sigma = -1.0\n\n        for sigma in sigmas:\n            max_R_mag_for_sigma = 0.0\n\n            for f in freqs:\n                omega = 2.0 * np.pi * f\n                if omega == 0: continue\n\n                for theta in angles_rad:\n                    # 1. Calculate wavenumbers for undamped region\n                    cos_theta = np.cos(theta)\n                    sin_theta = np.sin(theta)\n\n                    # Handle theta=90 to avoid division by zero in some formulations, though this one is robust\n                    if abs(C_0 + U * cos_theta) < 1e-9:\n                        # This case is physically unusual and indicates group velocity issues\n                        # For the given problem parameters, it's not encountered\n                        continue\n                    \n                    k = omega / (C_0 + U * cos_theta)\n                    kx_inc = k * cos_theta\n                    ky = k * sin_theta\n                    \n                    # Reflected wave normal wavenumber\n                    # Using Vieta's formulas for robustness\n                    A1 = C_0**2 - U**2\n                    if abs(A1) < 1e-9: # Transonic flow, not in test cases\n                        continue\n                    \n                    kx_refl = - (2 * omega * U) / A1 - kx_inc\n                    \n                    # 2. Calculate wavenumber for sponge region (k_xs)\n                    A2 = C_0**2 - U**2\n                    B2 = 2 * omega * U - 1j * sigma * U\n                    C2 = C_0**2 * ky**2 - omega**2 + 1j * sigma * omega\n                    \n                    discriminant = np.sqrt(B2**2 - 4 * A2 * C2)\n                    \n                    # Two roots for k_xs\n                    root1 = (-B2 + discriminant) / (2 * A2)\n                    root2 = (-B2 - discriminant) / (2 * A2)\n\n                    # Choose physically admissible root with Im(k_xs) > 0 for decay\n                    if root1.imag > 0:\n                        k_xs = root1\n                    elif root2.imag > 0:\n                        k_xs = root2\n                    else: # If both have ~0 imag part (e.g. sigma=0), choose forward-like.\n                          # For sigma>0, theory guarantees one root has positive imag part\n                          # because Im(discriminant^2)  0.\n                          # A check for which root has the positive imaginary part covers all cases.\n                        k_xs = root1 if root1.imag  root2.imag else root2\n\n                    # 3. Calculate impedances\n                    # Z(k_x) = rho_0 * (omega - U*k_x) / k_x\n                    \n                    # Avoid division by zero, though impedance formulas are well-behaved at limits\n                    eps = 1e-16\n                    \n                    Z_i = RHO_0 * (omega - U * kx_inc) / (kx_inc + eps) if abs(kx_inc)  eps else np.inf\n                    Z_r = RHO_0 * (omega - U * kx_refl) / (kx_refl + eps) if abs(kx_refl)  eps else np.inf\n                    Z_2 = RHO_0 * (omega - U * k_xs) / (k_xs + eps) if abs(k_xs)  eps else np.inf\n\n                    # 4. Calculate reflection coefficient R\n                    # R = Z_r(Z_i - Z_2) / (Z_i(Z_2 - Z_r))\n                    \n                    # Handle infinite impedance limits\n                    if np.isinf(Z_i): #grazing incidence for kx_inc\n                        # R -> Z_r / (Z_2 - Z_r)\n                        if abs(Z_2 - Z_r)  eps:\n                            R_coeff = Z_r / (Z_2 - Z_r)\n                        else: R_coeff = np.inf\n                    elif np.isinf(Z_r):\n                        # R -> (Z_i - Z_2) / (-Z_i) = Z_2/Z_i - 1\n                        if abs(Z_i)  eps:\n                            R_coeff = Z_2/Z_i - 1\n                        else: R_coeff = np.inf\n                    elif np.isinf(Z_2):\n                        # R -> Z_r(Z_i) / (Z_i(-Z_r)) = -1\n                        R_coeff = -1.0\n                    else:\n                        num = Z_r * (Z_i - Z_2)\n                        den = Z_i * (Z_2 - Z_r)\n                        if abs(den)  eps:\n                            R_coeff = np.inf\n                        else:\n                            R_coeff = num / den\n                    \n                    R_mag = np.abs(R_coeff)\n                    if R_mag  max_R_mag_for_sigma:\n                        max_R_mag_for_sigma = R_mag\n\n            if max_R_mag_for_sigma  min_max_R_mag:\n                min_max_R_mag = max_R_mag_for_sigma\n                optimal_sigma = sigma\n\n        optimal_sigmas.append(optimal_sigma)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{s:.6f}' for s in optimal_sigmas)}]\")\n\nsolve()\n```"
        }
    ]
}