{
    "hands_on_practices": [
        {
            "introduction": "对流波动方程的解析研究是计算航空声学的基础。本练习通过求解一个经典问题——均匀流场中的单极子声源——来建立物理直觉，并进一步探讨声学预测（如声压相位）对背景流速等物理参数的敏感性。通过这种方式，我们不仅能够理解声波在移动流体中的传播特性，还能掌握量化模型不确定性的重要分析工具。",
            "id": "4115429",
            "problem": "考虑一种无粘、可压缩、等熵流体，其基态密度 $\\rho_{0}$ 和声速 $c$ 为常数。该流体中存在小振幅声学扰动 $\\rho'(x,t)$、 $u'(x,t)$ 和 $p'(x,t)$，这些扰动叠加在沿 $+x$ 轴方向，速度为 $U$ 的均匀平均流上。一个位于 $x=0$ 处、复强度为 $Q$ 的紧凑时谐单极子源以角频率 $\\omega0$ 驱动声场。流速为亚声速，满足 $0  U  c$。一个点式传感器位于 $x_{s}  0$ 处。\n\n您的任务是：\n1.  从第一性原理（线性化质量守恒、动量平衡、等熵关系式）出发，推导关于压力扰动 $p'(x,t)$ 的偏微分方程。\n2.  假设 $p'(x,t)=\\Re\\{P(x) \\exp(-\\mathrm{i}\\omega t)\\}$，推导在 $x \\neq 0$ 处复压幅 $P(x)$ 所满足的常微分方程。\n3.  施加外行波辐射条件，求出在 $x_s  0$ 处的复压幅 $P(x)$ 的解析解，该解应为声源强度 $Q$ 的函数。\n4.  将预测泛函定义为展开相位 $\\Phi(U):=\\arg\\big(P(x_{s})\\big)$。计算其对平均流速 $U$ 的灵敏度（梯度）$\\frac{d\\Phi}{dU}$，并以秒每米 (s/m) 为单位表示。",
            "solution": "用户要求我严格验证并解决一个一维计算声学问题。\n\n### 第1步：提取已知条件\n- **流体：** 无粘、可压缩、等熵。\n- **基态：** 恒定基态密度 $\\rho_{0}$，恒定声速 $c$，沿 $+x$ 轴的均匀平均流速 $U$。\n- **流态：** 亚声速，$0  U  c$。\n- **扰动：** 小振幅声学扰动 $\\rho'(x,t)$、$u'(x,t)$ 和 $p'(x,t)$。\n- **声源：** 位于 $x=0$ 处的紧凑时谐单极子源，复强度为 $Q$，角频率 $\\omega > 0$。\n- **传感器：** 点式传感器，位于 $x_{s} > 0$。\n- **任务1：** 从第一性原理（线性化质量守恒、动量平衡、等熵状态关系式）推导 $p'(x,t)$ 的PDE。\n- **任务2：** 寻找 $P(x)$ 的频域PDE，其中 $p'(x,t)=\\Re\\{P(x)\\exp(-\\mathrm{i}\\omega t)\\}$，并包含源项。\n- **任务3：** 施加外行波辐射条件。\n- **任务4：** 求解在 $x_s > 0$ 处的复压幅 $P(x)$。\n- **任务5：** 将预测泛函定义为展开相位 $\\Phi(U):=\\arg\\big(P(x_{s})\\big)$。\n- **任务6：** 计算灵敏度（梯度）$\\frac{d\\Phi}{dU}$。\n- **任务7：** 以秒每米 (s/m) 为单位表示最终梯度。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于线性化欧拉方程，这是空气声学的基石。其设置描述了均匀流中声产生和传播的典型问题。所作假设（无粘、等熵、均匀流）是广泛声学问题的标准理想化处理。该问题在科学上是合理的。\n- **适定性：** 问题描述清晰。给出了控制方程，定义了声源，几何结构是一维的，并要求了辐射条件。这一系列条件足以确定声压场的唯一解。后续计算相位泛函及其导数是明确定义的数学运算。\n- **客观性：** 该问题以精确的技术语言陈述，没有任何主观或模棱两可的术语。\n\n该问题未违反任何无效性标准。这是一个标准的、可解的理论声学问题。\n\n### 第3步：结论与行动\n该问题有效。我将继续进行求解。\n\n### 推导与求解\n\n该问题要求从无粘、等熵流体的第一性原理开始推导。\n\n**1. 控制方程与线性化**\n基本方程是质量守恒和动量守恒（欧拉方程）。在一维情况下，对于单位体积质量源为 $q_m(x,t)$ 的流动，这些方程是：\n1.  连续性方程：$\\frac{\\partial\\rho}{\\partial t} + \\frac{\\partial(\\rho v)}{\\partial x} = q_m$\n2.  动量方程：$\\rho\\left(\\frac{\\partial v}{\\partial t} + v\\frac{\\partial v}{\\partial x}\\right) = -\\frac{\\partial p}{\\partial x}$\n\n我们通过将每个场写成一个常数平均流分量（下标为 $0$）和一个小的声学扰动（带撇号）之和来线性化这些方程：\n$\\rho(x,t) = \\rho_0 + \\rho'(x,t)$\n$v(x,t) = U + u'(x,t)$\n$p(x,t) = p_0 + p'(x,t)$\n\n对于等熵过程，压力和密度扰动通过声速 $c$ 相关联：$p' = c^2\\rho'$。对于均匀流 $U$，平均压力 $p_0$ 是恒定的。\n\n将这些代入控制方程并只保留扰动的一阶项，得到线性化方程：\n1.  线性化连续性方程：$\\frac{\\partial \\rho'}{\\partial t} + U \\frac{\\partial \\rho'}{\\partial x} + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$\n2.  线性化动量方程：$\\rho_0 \\left(\\frac{\\partial u'}{\\partial t} + U \\frac{\\partial u'}{\\partial x}\\right) = -\\frac{\\partial p'}{\\partial x}$\n\n我们可以引入跟随平均流的物质导数 $D_t \\equiv \\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}$。使用 $p' = c^2\\rho'$，线性化方程变为：\n1.  $\\frac{1}{c^2} D_t p' + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$\n2.  $\\rho_0 D_t u' = -\\frac{\\partial p'}{\\partial x}$\n\n**2. 对流波动方程的推导**\n为了得到关于压力扰动 $p'$ 的单个方程，我们可以消去 $u'$。我们对第一个方程应用算子 $D_t$，对第二个方程应用算子 $\\frac{\\partial}{\\partial x}$。由于 $U$ 是常数，$D_t$ 和 $\\frac{\\partial}{\\partial x}$ 可交换。\n1.  $\\frac{1}{c^2} D_t^2 p' + \\rho_0 D_t \\left(\\frac{\\partial u'}{\\partial x}\\right) = D_t q_m$\n2.  $\\rho_0 D_t \\left(\\frac{\\partial u'}{\\partial x}\\right) = -\\frac{\\partial^2 p'}{\\partial x^2}$\n\n将第二个结果代入第一个，得到压力的对流波动方程：\n$$ \\frac{1}{c^2} D_t^2 p' - \\frac{\\partial^2 p'}{\\partial x^2} = D_t q_m $$\n展开物质导数算子 $D_t^2 = (\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x})^2 = \\frac{\\partial^2}{\\partial t^2} + 2U \\frac{\\partial^2}{\\partial t \\partial x} + U^2 \\frac{\\partial^2}{\\partial x^2}$，并定义马赫数 $M = U/c$，我们得到 $p'(x,t)$ 的PDE：\n$$ \\frac{1}{c^2} \\frac{\\partial^2 p'}{\\partial t^2} + \\frac{2M}{c} \\frac{\\partial^2 p'}{\\partial t \\partial x} - (1-M^2) \\frac{\\partial^2 p'}{\\partial x^2} = D_t q_m $$\n\n**3. 频域公式与求解**\n我们寻求时谐解 $p'(x,t) = \\Re\\{P(x) \\exp(-\\mathrm{i}\\omega t)\\}$。使用复振幅，代换 $p'(x,t) = P(x)\\exp(-\\mathrm{i}\\omega t)$ 将算子转换为 $\\frac{\\partial}{\\partial t} \\to -\\mathrm{i}\\omega$ 和 $D_t \\to (-\\mathrm{i}\\omega + U \\frac{d}{dx})$。声源是位于 $x=0$ 处的点单极子，其复质量注入率强度为 $Q$，因此 $q_m(x,t) = \\Re\\{Q \\delta(x) \\exp(-\\mathrm{i}\\omega t)\\}$。复源项为 $Q\\delta(x)\\exp(-\\mathrm{i}\\omega t)$。\n\n对于 $x \\neq 0$，源项为零，复压幅 $P(x)$ 的频域方程是一个齐次常微分方程 (ODE)：\n$$ (1-M^2)\\frac{d^2P}{dx^2} + 2\\mathrm{i}Mk\\frac{dP}{dx} + k^2 P = 0 $$\n其中 $k=\\omega/c$ 是静止介质中的波数。我们寻求 $P(x) = A \\exp(\\mathrm{i}\\lambda x)$ 形式的解。代入该假设得到 $\\lambda$ 的特征方程：\n$$ (1-M^2)\\lambda^2 + 2Mk\\lambda - k^2 = 0 $$\n方程的根为：\n$$ \\lambda = \\frac{-2Mk \\pm \\sqrt{4M^2k^2 - 4(1-M^2)(-k^2)}}{2(1-M^2)} = \\frac{k(-M \\pm 1)}{1-M^2} $$\n这给出了两个可能的波数：\n$\\lambda_1 = \\frac{k(1-M)}{(1-M)(1+M)} = \\frac{k}{1+M}$，对应于向下游传播的波。\n$\\lambda_2 = \\frac{k(-1-M)}{1-M^2} = -\\frac{k}{1-M}$，对应于向上游传播的波。\n\n辐射条件要求对于 $x > 0$（声源下游），我们只考虑沿正 $x$ 方向传播离开声源的波。因此，对于 $x0$ 的解具有以下形式：\n$$ P(x) = A_+ \\exp(\\mathrm{i}\\lambda_1 x) = A_+ \\exp\\left(\\frac{\\mathrm{i}kx}{1+M}\\right) $$\n对于 $x  0$，解必须是上游传播的波：$P(x) = A_- \\exp(\\mathrm{i}\\lambda_2 x) = A_- \\exp\\left(-\\frac{\\mathrm{i}kx}{1-M}\\right)$。\n\n**4. 源项跳跃条件的应用**\n为了找到振幅 $A_+$，我们从一阶线性化方程推导跨越 $x=0$ 处声源的跳跃条件。\n1.  将动量方程 $\\rho_0 D_t u' = -\\frac{\\partial p'}{\\partial x}$ 在 $x=0$ 附近的一个无穷小区间 $[-\\epsilon, \\epsilon]$ 上积分，左侧消失，意味着 $[p']_0=p'(0^+)-p'(0^-)=0$。因此，压力在声源处是连续的：$P(0^+) = P(0^-)$。这意味着 $A_+ = A_- = A$。\n2.  将连续性方程 $\\frac{1}{c^2} D_t p' + \\rho_0 \\frac{\\partial u'}{\\partial x} = q_m$ 在 $[-\\epsilon, \\epsilon]$ 上积分，得到 $\\rho_0 [u']_0 = \\int q_m dx$。在频域中，对于 $u'(x,t)=\\hat{u}(x)\\exp(-\\mathrm{i}\\omega t)$ 和源 $Q\\delta(x)$，这变为 $\\rho_0(\\hat{u}(0^+) - \\hat{u}(0^-)) = Q$。\n\n我们从频域动量方程 $\\rho_0(-\\mathrm{i}\\omega + U\\frac{d}{dx})\\hat{u} = -\\frac{dP}{dx}$ 求解速度振幅 $\\hat{u}$。\n对于下游波（$x>0$），$P(x) = A \\exp(\\mathrm{i}\\lambda_1 x)$，因此 $\\frac{dP}{dx} = \\mathrm{i}\\lambda_1 P$。\n$\\rho_0(-\\mathrm{i}\\omega + U(\\mathrm{i}\\lambda_1))\\hat{u}(0^+) = -(\\mathrm{i}\\lambda_1)P(0^+)$，所以 $\\hat{u}(0^+) = \\frac{-\\lambda_1}{\\rho_0(-\\omega+U\\lambda_1)}P(0^+)$。代入 $\\lambda_1 = \\omega/(c+U)$，得到 $\\hat{u}(0^+) = \\frac{1}{\\rho_0 c} P(0^+)$。\n对于上游波（$x0$），$P(x) = A \\exp(\\mathrm{i}\\lambda_2 x)$，因此 $\\frac{dP}{dx} = \\mathrm{i}\\lambda_2 P$。\n类似地，$\\hat{u}(0^-) = \\frac{-\\lambda_2}{\\rho_0(-\\omega+U\\lambda_2)}P(0^-)$。代入 $\\lambda_2 = -\\omega/(c-U)$，得到 $\\hat{u}(0^-) = -\\frac{1}{\\rho_0 c} P(0^-)$。\n\n将这些代入跳跃条件 $\\rho_0(\\hat{u}(0^+) - \\hat{u}(0^-)) = Q$：\n$\\rho_0 \\left( \\frac{P(0^+)}{\\rho_0 c} - \\frac{-P(0^-)}{\\rho_0 c} \\right) = Q$\n$\\frac{1}{c}(P(0^+) + P(0^-)) = Q$。\n使用连续性条件 $P(0^+)=P(0^-)=A$：\n$\\frac{2A}{c} = Q \\implies A = \\frac{Qc}{2}$。\n\n对于 $x0$ 的复压幅为：\n$$ P(x) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}kx}{1+M} \\right) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}(\\omega/c)x}{1+U/c} \\right) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}\\omega x}{c+U} \\right) $$\n\n**5. 灵敏度分析**\n传感器位于 $x_s  0$。复压力为：\n$$ P(x_s) = \\frac{Qc}{2} \\exp\\left( \\frac{\\mathrm{i}\\omega x_s}{c+U} \\right) $$\n预测泛函是 $P(x_s)$ 的展开相位：\n$$ \\Phi(U) = \\arg\\big(P(x_s)\\big) = \\arg\\left( \\frac{Qc}{2} \\right) + \\frac{\\omega x_s}{c+U} $$\n项 $\\arg(Qc/2)$ 是一个关于 $U$ 的常数。\n\n我们需要计算 $\\Phi$ 对 $U$ 的灵敏度（梯度）：\n$$ \\frac{d\\Phi}{dU} = \\frac{d}{dU} \\left( \\arg\\left(\\frac{Qc}{2}\\right) + \\frac{\\omega x_s}{c+U} \\right) $$\n$$ \\frac{d\\Phi}{dU} = 0 + \\omega x_s \\frac{d}{dU} \\left( (c+U)^{-1} \\right) $$\n使用幂法则和链式法则：\n$$ \\frac{d\\Phi}{dU} = \\omega x_s \\left( -1 \\cdot (c+U)^{-2} \\cdot \\frac{d}{dU}(c+U) \\right) $$\n$$ \\frac{d\\Phi}{dU} = -\\omega x_s (c+U)^{-2} $$\n灵敏度的最终解析表达式为：\n$$ \\frac{d\\Phi}{dU} = -\\frac{\\omega x_s}{(c+U)^2} $$\n\n单位与 s/m 的要求一致：$\\omega$ 的单位是 s$^{-1}$，$x_s$ 的单位是 m，而 $(c+U)$ 的单位是 m/s。结果的单位是 $\\frac{\\mathrm{s}^{-1} \\cdot \\mathrm{m}}{(\\mathrm{m}/\\mathrm{s})^2} = \\frac{\\mathrm{m}/\\mathrm{s}}{\\mathrm{m}^2/\\mathrm{s}^2} = \\frac{\\mathrm{s}}{\\mathrm{m}}$。",
            "answer": "$$\n\\boxed{-\\frac{\\omega x_{s}}{(c+U)^{2}}}\n$$"
        },
        {
            "introduction": "将连续的物理方程离散化是计算方法的核心，但这个过程会引入误差。本练习将通过冯·诺依曼（von Neumann）分析，深入研究一个用于求解对流波动方程的有限差分格式的性质。通过推导其数值色散关系，我们可以量化数值解的相位误差，并评估由离散对流项引起的各向异性效应，这些都是确保计算模拟准确性的关键。",
            "id": "4115455",
            "problem": "考虑在均匀、无粘、可压缩流体中的二维对流波动方程，用于描述小振幅声学。该流体具有沿 $x$ 轴方向的恒定背景流速 $U$ 和恒定的声速 $c_{0}$。该方程写作\n$$\n\\left(\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}\\right)^{2} p(x,y,t) - c_{0}^{2} \\left( \\frac{\\partial^{2} p}{\\partial x^{2}} + \\frac{\\partial^{2} p}{\\partial y^{2}} \\right) = 0,\n$$\n其中 $p(x,y,t)$ 是声压脉动。设空间网格是均匀的，间距为 $\\Delta x = \\Delta y = h$，时间步长为 $\\Delta t$。对于方程中的每个算子，考虑在笛卡尔网格上使用以下一致的二阶有限差分离散格式：\n- 二阶时间导数由中心差分 $(p^{n+1}_{j,l} - 2 p^{n}_{j,l} + p^{n-1}_{j,l}) / \\Delta t^{2}$ 近似。\n- 混合导数 $\\partial_{t} \\partial_{x} p$ 由时间和空间上的中心差分的组合来近似，即 $( (\\delta_{x} p)^{n+1}_{j,l} - (\\delta_{x} p)^{n-1}_{j,l} )/(2 \\Delta t)$，其中 $(\\delta_{x} p)^{n}_{j,l} = (p^{n}_{j+1,l} - p^{n}_{j-1,l})/(2 h)$。\n- 二阶空间导数由中心差分 $(p^{n}_{j+1,l} - 2 p^{n}_{j,l} + p^{n}_{j-1,l}) / h^{2}$ 和 $(p^{n}_{j,l+1} - 2 p^{n}_{j,l} + p^{n}_{j,l-1}) / h^{2}$ 近似。\n\n使用 von Neumann (傅里叶) 分析，以及平面波拟设 $p^{n}_{j,l} = \\hat{p} \\exp\\!\\big(i(k_{x} j h + k_{y} l h - \\omega n \\Delta t)\\big)$，推导该格式的数值色散关系。将无量纲数值频率 $\\Omega \\equiv \\omega \\Delta t$ 明确地表示为关于无量纲参数 $\\kappa_{x} \\equiv k_{x} h$、$\\kappa_{y} \\equiv k_{y} h$、马赫数 $M \\equiv U/c_{0}$ 和库朗数 $\\sigma \\equiv c_{0} \\Delta t / h$ 的闭式表达式。\n\n然后，为量化离散对流算子引入的各向异性，定义传播角 $\\theta$ (以弧度为单位)，使得 $k_{x} = k \\cos \\theta$ 和 $k_{y} = k \\sin \\theta$，其中 $k = \\sqrt{k_{x}^{2} + k_{y}^{2}}$，并令 $\\kappa \\equiv k h$。使用 $x$ 方向中心一阶导数的离散符号，提供对流引起的各向异性因子 $\\Gamma(\\theta,\\kappa)$ 的闭式解析表达式，该因子定义为离散对流投影与其连续对应物之间的比值，\n$$\n\\Gamma(\\theta,\\kappa) \\equiv \\frac{k_{x}^{\\text{eff}}}{k \\cos \\theta}, \\quad \\text{其中 } k_{x}^{\\text{eff}} = \\frac{1}{h} \\sin(\\kappa \\cos \\theta).\n$$\n\n您的最终答案必须是一个单行矩阵，包含两个条目：从数值色散关系中得到的 $\\Omega$ 的闭式表达式，以及 $\\Gamma(\\theta,\\kappa)$ 的闭式表达式。不需要进行数值计算。如果您为色散关系选择一个分支，请包含 $\\pm$ 符号以表示两个声学分支。角度必须以弧度表示。最终答案框中不应包含任何单位。",
            "solution": "用户希望我解决一个计算声学中的问题。我现在开始执行此任务。\n\n所提供的问题陈述经确认为合理且适定。所有必要的数据、定义和方程均已提供，并且它们与计算声学和有限差分方法的既定原则一致。该问题不违反任何指定的无效标准。这是一个标准的练习，用于推导数值色散关系和分析有限差分格式的数值各向异性，尽管代数运算量较大。\n\n我们首先处理问题的第一部分：推导数值色散关系。\n给定的偏微分方程 (PDE) 是二维对流波动方程，展开后为：\n$$\n\\frac{\\partial^{2} p}{\\partial t^{2}} + 2U \\frac{\\partial^{2} p}{\\partial t \\partial x} + (U^{2} - c_{0}^{2}) \\frac{\\partial^{2} p}{\\partial x^{2}} - c_{0}^{2} \\frac{\\partial^{2} p}{\\partial y^{2}} = 0\n$$\n为了进行 von Neumann 分析，我们将平面波拟设 $p^{n}_{j,l} = \\hat{p} \\exp\\!\\big(\\mathrm{i}(k_{x} j h + k_{y} l h - \\omega n \\Delta t)\\big)$ 代入该方程的离散版本。每个有限差分算子对拟设的作用是通过用相应的傅里叶符号替换导数来找到的。令 $\\Omega \\equiv \\omega \\Delta t$，$\\kappa_x \\equiv k_x h$，以及 $\\kappa_y \\equiv k_y h$。\n\n所提供的有限差分近似 (FDA) 及其傅里叶符号是：\n1.  对于 $\\frac{\\partial^2 p}{\\partial t^2}$，符号为：$\\frac{-4\\sin^2(\\frac{\\Omega}{2})}{\\Delta t^2}$\n2.  对于 $\\frac{\\partial^2 p}{\\partial t \\partial x}$，符号为：$\\frac{\\sin\\Omega \\sin\\kappa_x}{h\\Delta t}$\n3.  对于 $\\frac{\\partial^2 p}{\\partial x^2}$，符号为：$\\frac{-4\\sin^2(\\frac{\\kappa_x}{2})}{h^2}$\n4.  对于 $\\frac{\\partial^2 p}{\\partial y^2}$，符号为：$\\frac{-4\\sin^2(\\frac{\\kappa_y}{2})}{h^2}$\n\n将这些符号代入展开的偏微分方程，得到数值色散关系：\n$$\n\\frac{-4\\sin^2(\\frac{\\Omega}{2})}{\\Delta t^2} + 2U \\left(\\frac{\\sin\\Omega \\sin\\kappa_x}{h\\Delta t}\\right) + (U^2 - c_0^2)\\left(\\frac{-4\\sin^2(\\frac{\\kappa_x}{2})}{h^2}\\right) - c_0^2\\left(\\frac{-4\\sin^2(\\frac{\\kappa_y}{2})}{h^2}\\right) = 0\n$$\n将整个方程乘以 $-\\frac{\\Delta t^2}{4}$：\n$$\n\\sin^2\\left(\\frac{\\Omega}{2}\\right) - \\frac{U\\Delta t}{2h}\\sin\\Omega \\sin\\kappa_x - (U^2 - c_0^2)\\frac{\\Delta t^2}{h^2}\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) + c_0^2 \\frac{\\Delta t^2}{h^2}\\sin^2\\left(\\frac{\\kappa_y}{2}\\right) = 0\n$$\n该方程有一个错误。正确的推导是：项 `- c_0^2 (∂²p/∂y²)` 变为 `- c_0^2 (-4sin²(κ_y/2)/h²) = + 4c_0^2/h² sin²(κ_y/2)`。乘以 `-Δt²/4` 后，该项变为 `- c_0^2 (Δt²/h²) sin²(κ_y/2) = -σ²sin²(κ_y/2)`。\n因此，正确的代数关系是：\n$$\n\\sin^2\\left(\\frac{\\Omega}{2}\\right) - \\frac{U\\Delta t}{2h}\\sin\\Omega \\sin\\kappa_x + (U^2-c_0^2)\\frac{\\Delta t^2}{h^2}\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) - c_0^2\\frac{\\Delta t^2}{h^2}\\sin^2\\left(\\frac{\\kappa_y}{2}\\right) = 0\n$$\n引入无量纲参数 $M \\equiv U/c_0$ 和 $\\sigma \\equiv c_0\\Delta t/h$：\n$$\n\\frac{U\\Delta t}{h} = M\\sigma, \\quad \\frac{c_0^2\\Delta t^2}{h^2} = \\sigma^2, \\quad \\frac{U^2\\Delta t^2}{h^2} = M^2\\sigma^2\n$$\n关系式变为：\n$$\n\\sin^2\\left(\\frac{\\Omega}{2}\\right) - \\frac{M\\sigma}{2}\\sin\\Omega \\sin\\kappa_x + (M^2-1)\\sigma^2\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) - \\sigma^2\\sin^2\\left(\\frac{\\kappa_y}{2}\\right) = 0\n$$\n使用恒等式 $\\sin^2(\\frac{\\Omega}{2}) = \\frac{1-\\cos\\Omega}{2}$ 并乘以 $2$：\n$$\n1-\\cos\\Omega - M\\sigma\\sin\\Omega \\sin\\kappa_x + 2\\sigma^2\\left((M^2-1)\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) - \\sin^2\\left(\\frac{\\kappa_y}{2}\\right)\\right) = 0\n$$\n重排后得到一个形如 $A\\cos\\phi + B\\sin\\phi = C$ 的方程：\n$$\n\\cos\\Omega + (M\\sigma \\sin\\kappa_x)\\sin\\Omega = 1 + 2\\sigma^2\\left((M^2-1)\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) - \\sin^2\\left(\\frac{\\kappa_y}{2}\\right)\\right)\n$$\n该方程可以使用 R 公式求解 $\\Omega$。令 $A=1$ 和 $B = M\\sigma\\sin\\kappa_x$。\n$$\n\\sqrt{1 + (M\\sigma\\sin\\kappa_x)^2} \\cos\\left(\\Omega - \\arctan(M\\sigma\\sin\\kappa_x)\\right) = 1 + 2\\sigma^2\\left((M^2-1)\\sin^2\\left(\\frac{\\kappa_x}{2}\\right) - \\sin^2\\left(\\frac{\\kappa_y}{2}\\right)\\right)\n$$\n求解 $\\Omega$：\n$$\n\\Omega = \\arctan(M\\sigma\\sin\\kappa_x) \\pm \\arccos\\left(\\frac{1 + 2\\sigma^2\\left((M^2-1)\\sin^2(\\frac{\\kappa_x}{2}) - \\sin^2(\\frac{\\kappa_y}{2})\\right)}{\\sqrt{1 + M^2\\sigma^2\\sin^2\\kappa_x}}\\right)\n$$\n这就是无量纲数值频率 $\\Omega$ 的闭式表达式。$\\pm$ 符号考虑了两种声波模式。\n\n对于第二部分，我们必须找到对流引起的各向异性因子 $\\Gamma(\\theta,\\kappa)$。它被定义为离散对流投影 $k_x^{\\text{eff}}$ 与其连续对应物 $k_x$ 之间的比值。连续投影是 $k_x = k \\cos\\theta$。\n问题指定了空间一阶导数的中心差分 $(\\delta_x p)^{n}_{j,l} = (p^{n}_{j+1,l} - p^{n}_{j-1,l})/(2h)$。将此算子应用于平面波的空间部分 $\\exp(\\mathrm{i} k_x j h)$，得到的有效波数为：\n$$\nk_x^{\\text{eff}} = \\frac{\\sin(k_x h)}{h}\n$$\n这与问题陈述中提供的 $k_x^{\\text{eff}}$ 的表达式相匹配。\n现在我们可以计算各向异性因子 $\\Gamma(\\theta,\\kappa)$：\n$$\n\\Gamma(\\theta,\\kappa) \\equiv \\frac{k_x^{\\text{eff}}}{k_x} = \\frac{\\sin(k_x h) / h}{k_x} = \\frac{\\sin(k_x h)}{k_x h}\n$$\n代入 $k_x h = \\kappa \\cos\\theta$：\n$$\n\\Gamma(\\theta,\\kappa) = \\frac{\\sin(\\kappa \\cos\\theta)}{\\kappa \\cos\\theta}\n$$\n这就是所要求的各向异性因子的闭式表达式。这等价于 sinc 函数，$\\text{sinc}(\\kappa\\cos\\theta)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\arctan\\big(M\\sigma \\sin(\\kappa_x)\\big) \\pm \\arccos\\left( \\frac{1 + 2\\sigma^2\\left((M^2-1)\\sin^2(\\frac{\\kappa_x}{2}) - \\sin^2(\\frac{\\kappa_y}{2})\\right)}{\\sqrt{1 + M^2\\sigma^2 \\sin^2(\\kappa_x)}} \\right)  \\frac{\\sin(\\kappa \\cos\\theta)}{\\kappa \\cos\\theta} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论分析的最终目的是指导可靠的数值实现。本练习将理论付诸实践，要求你编写一个时域求解器，并采用“人造解法”（method of manufactured solutions）这一标准的验证技术。通过执行网格收敛性研究，你将亲手验证所编写代码的计算精度是否达到了理论预期，这是计算科学研究中不可或缺的一步。",
            "id": "4115450",
            "problem": "考虑在一维、无粘性、可压缩流体中的小振幅声学问题，该流体具有均匀的平均流速 $U$ 和恒定的声速 $c$。从基本守恒律出发，均匀平均流中声压扰动 $p(x,t)$ 的线性化动力学由对流波动方程控制：\n$$\n\\left(\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}\\right)^2 p(x,t) - c^2 \\frac{\\partial^2 p(x,t)}{\\partial x^2} = 0,\n$$\n该方程定义在周期为 $L$ 的周期性空间域 $x \\in [0,L]$ 上。对于一个形式为\n$$\np_{\\text{exact}}(x,t) = \\sin\\big(k x - \\omega t\\big),\n$$\n的构造行波解，对流波动方程所蕴含的色散关系要求\n$$\n\\omega = U k \\pm c k,\n$$\n因此两个分支以相速度 $U \\pm c$ 传播。选择 + 分支，即 $\\omega = k(U + c)$。将对流导数定义为 $D_t p = \\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}$。引入辅助变量 $q = D_t p$，并将二阶方程重写为一阶方程组：\n$$\n\\frac{\\partial p}{\\partial t} = - U \\frac{\\partial p}{\\partial x} + q, \\qquad \\frac{\\partial q}{\\partial t} = - U \\frac{\\partial q}{\\partial x} + c^2 \\frac{\\partial^2 p}{\\partial x^2},\n$$\n该方程组受周期性边界条件约束。在 $t=0$ 时，所选分支的精确构造初始条件为\n$$\np(x,0) = \\sin(k x), \\qquad q(x,0) = \\left.\\left(\\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}\\right)\\right|_{t=0} = - c k \\cos(k x).\n$$\n\n您的任务是编写一个完整、可运行的程序，该程序：\n- 在周期性边界条件下，使用二阶中心有限差分法对 $\\frac{\\partial}{\\partial x}$ 和 $\\frac{\\partial^2}{\\partial x^2}$ 进行空间离散化，从而离散化上述一阶系统。\n- 使用显式二阶两步 Runge–Kutta 方法（也称为 Heun 法）在时间上推进解。\n- 使用 Courant–Friedrichs–Lewy (CFL) 条件选择时间步长为 $\\Delta t = \\text{CFL} \\cdot \\Delta x / (|U| + c)$，其中 CFL 数设置为 $\\text{CFL} = 0.2$。通过选择步数 $N_t = \\lceil T / \\Delta t \\rceil$ 然后重置 $\\Delta t \\leftarrow T / N_t$，来使用整数个时间步，使得最终积分时间恰好为 $T$。\n- 计算数值解 $p_{\\text{num}}(x,T)$，并使用误差的离散 $L^2$ 范数将其与精确解 $p_{\\text{exact}}(x,T)$进行比较：\n$$\nE(\\Delta x) = \\left(\\Delta x \\sum_{i} \\left[p_{\\text{num}}(x_i,T) - p_{\\text{exact}}(x_i,T)\\right]^2 \\right)^{1/2}.\n$$\n- 通过对一组四个相继加密的均匀网格上的 $\\log E(\\Delta x)$ 与 $\\log \\Delta x$ 拟合一条直线，并取拟合直线的斜率作为观测阶数，来评估观测到的网格收敛率 $p_{\\text{obs}}$。\n- 将观测到的收敛率与所选二阶离散化的理论精度 $p_{\\text{th}} = 2$ 进行对比，如果 $|p_{\\text{obs}} - 2| \\le 0.15$ 则返回布尔值 $b$ 为真，否则为假。\n\n所有三角函数中的角度必须以弧度为单位。所有物理量必须使用国际单位制 (SI)：$x$ 和 $L$ 的单位为米，$t$ 和 $T$ 的单位为秒，$U$ 和 $c$ 的单位为米/秒，$k$ 的单位为弧度/米。\n\n实施以下参数值的测试套件，以确保覆盖不同的平均流态和方向：\n- 测试用例 1（基准，无平均流）：$L = 1.0$ 米，$c = 340.0$ 米/秒，$U = 0.0$ 米/秒，$m = 1$ 波长，因此 $k = 2\\pi m / L$，$T = 0.001$ 秒，网格点数为 $N = [50,100,200,400]$。\n- 测试用例 2（中等顺流）：$L = 1.0$ 米，$c = 340.0$ 米/秒，$U = 100.0$ 米/秒，$m = 1$，$T = 0.001$ 秒，$N = [50,100,200,400]$。\n- 测试用例 3（中等逆流）：$L = 1.0$ 米，$c = 340.0$ 米/秒，$U = -50.0$ 米/秒，$m = 1$，$T = 0.001$ 秒，$N = [50,100,200,400]$。\n- 测试用例 4（近跨音速顺流）：$L = 1.0$ 米，$c = 340.0$ 米/秒，$U = 306.0$ 米/秒，$m = 1$，$T = 0.001$ 秒，$N = [50,100,200,400]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素必须是一个包含两项 $[p_{\\text{obs}}, b]$ 的列表，按上述顺序列出对应于各个测试用例。例如，输出应如下所示：\n$[[p_1,b_1],[p_2,b_2],[p_3,b_3],[p_4,b_4]]$,\n其中每个 $p_i$ 是一个浮点数，每个 $b_i$ 是一个布尔值。",
            "solution": "用户提供的问题是计算声学领域一个适定的任务，要求对一维对流波动方程进行数值求解，并验证数值格式的收敛率。该问题在科学上是合理的、内容是自洽的，并且所有参数和方法都得到了清晰的定义。\n\n解决方案的流程是将控制偏微分方程（PDE）离散化为一个常微分方程组（ODE），然后对该方程组进行时间积分。其核心方法步骤概述如下。\n\n### 1. 方程组\n问题始于声压扰动 $p(x,t)$ 的二阶对流波动方程：\n$$\n\\left(\\frac{\\partial}{\\partial t} + U \\frac{\\partial}{\\partial x}\\right)^2 p - c^2 \\frac{\\partial^2 p}{\\partial x^2} = 0\n$$\n其中 $U$ 是均匀平均流速，$c$ 是恒定声速。通过定义辅助变量 $q = \\frac{\\partial p}{\\partial t} + U \\frac{\\partial p}{\\partial x}$，该方程被重写为时间上的一阶系统：\n$$\n\\begin{align*}\n\\frac{\\partial p}{\\partial t} = - U \\frac{\\partial p}{\\partial x} + q \\\\\n\\frac{\\partial q}{\\partial t} = - U \\frac{\\partial q}{\\partial x} + c^2 \\frac{\\partial^2 p}{\\partial x^2}\n\\end{align*}\n$$\n该系统在周期性空间域 $x \\in [0, L]$ 上求解。\n\n### 2. 空间离散化\n空间域 $[0, L]$ 被离散化为 $N$ 个均匀分布的网格点 $x_i = i \\Delta x$，其中 $i = 0, 1, \\dots, N-1$，网格间距为 $\\Delta x = L/N$。在这些点上 $p$ 和 $q$ 的值分别表示为 $p_i(t) = p(x_i, t)$ 和 $q_i(t) = q(x_i, t)$。\n\n空间导数使用二阶中心有限差分进行近似。对于网格上的通用函数 $f(x)$，在点 $x_i$ 处的导数为：\n- 一阶导数：$\\left(\\frac{\\partial f}{\\partial x}\\right)_i \\approx \\frac{f_{i+1} - f_{i-1}}{2 \\Delta x}$\n- 二阶导数：$\\left(\\frac{\\partial^2 f}{\\partial x^2}\\right)_i \\approx \\frac{f_{i+1} - 2f_i + f_{i-1}}{\\Delta x^2}$\n\n由于是周期性边界条件，索引按模 $N$ 处理，即 $f_{N} \\equiv f_0$ 和 $f_{-1} \\equiv f_{N-1}$。将这些离散化方法应用于一阶系统，得到一个关于网格点值的大型耦合常微分方程组（ODE）：\n$$\n\\begin{align*}\n\\frac{d p_i}{d t} = - U \\left(\\frac{p_{i+1} - p_{i-1}}{2 \\Delta x}\\right) + q_i \\\\\n\\frac{d q_i}{d t} = - U \\left(\\frac{q_{i+1} - q_{i-1}}{2 \\Delta x}\\right) + c^2 \\left(\\frac{p_{i+1} - 2p_i + p_{i-1}}{\\Delta x^2}\\right)\n\\end{align*}\n$$\n该系统可以写成紧凑的向量形式 $\\frac{d\\mathbf{y}}{dt} = \\mathbf{F}(\\mathbf{y})$，其中 $\\mathbf{y}(t) = [p_0(t), \\dots, p_{N-1}(t), q_0(t), \\dots, q_{N-1}(t)]^T$ 是大小为 $2N$ 的状态向量，$\\mathbf{F}$ 是表示右侧离散化空间算子的函数。\n\n### 3. 时间积分\n该常微分方程组使用显式二阶两步 Runge-Kutta 方法（也称为 Heun 法）在时间上进行推进。对于时间步长 $\\Delta t$，在时间 $t_{n+1} = t_n + \\Delta t$ 的状态向量 $\\mathbf{y}^{n+1}$ 是根据时间 $t_n$ 的 $\\mathbf{y}^n$ 计算得出的，步骤如下：\n1. 预测步：$\\mathbf{y}^* = \\mathbf{y}^n + \\Delta t \\cdot \\mathbf{F}(\\mathbf{y}^n)$\n2. 校正步：$\\mathbf{y}^{n+1} = \\mathbf{y}^n + \\frac{\\Delta t}{2} \\left[ \\mathbf{F}(\\mathbf{y}^n) + \\mathbf{F}(\\mathbf{y}^*) \\right]$\n\n时间步长 $\\Delta t$ 的选择基于保证数值稳定性的 Courant–Friedrichs–Lewy (CFL) 条件。系统的最大特征速度为 $|U| + c$。初步时间步长计算为 $\\Delta t_{\\text{CFL}} = \\text{CFL} \\cdot \\Delta x / (|U| + c)$，给定的 CFL 数为 $0.2$。为确保模拟在精确的最终时间 $T$ 停止，整数时间步数计算为 $N_t = \\lceil T / \\Delta t_{\\text{CFL}} \\rceil$。然后，用于积分的实际时间步长重新计算为 $\\Delta t = T / N_t$。\n\n### 4. 收敛性分析\n数值模拟在 $t=0$ 时使用构造的精确解进行初始化：\n$$\np(x,0) = \\sin(k x), \\qquad q(x,0) = -c k \\cos(k x)\n$$\n其中波数为 $k = 2\\pi m / L$，且 $m=1$。在积分到最终时间 $T$ 后，将数值解 $p_{\\text{num}}(x_i, T)$ 与精确解 $p_{\\text{exact}}(x_i, T) = \\sin(k x_i - \\omega T)$ 进行比较，其中角频率为 $\\omega = k(U+c)$。\n\n误差使用离散 $L^2$ 范数进行量化：\n$$\nE(\\Delta x) = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[p_{\\text{num}}(x_i,T) - p_{\\text{exact}}(x_i,T)\\right]^2 \\right)^{1/2}\n$$\n组合空间和时间离散化的理论精度阶数为 $p_{\\text{th}} = 2$。这意味着误差应按 $E(\\Delta x) \\propto (\\Delta x)^{p_{\\text{th}}}$ 的比例缩放。为了验证这一点，我们对一系列四个网格分辨率 $N=[50, 100, 200, 400]$ 进行模拟，从而得到一组网格间距 $\\Delta x_j$ 和相应的误差 $E_j$。取对数后，我们得到 $\\log(E) \\approx \\log(C) + p_{\\text{obs}} \\log(\\Delta x)$。观测收敛率 $p_{\\text{obs}}$ 通过使用线性回归找到点集 $(\\log(\\Delta x_j), \\log(E_j))$ 的最佳拟合线的斜率来确定。\n\n最后，将观测率与理论率进行比较。如果观测率在理论率的容差范围内，即 $|p_{\\text{obs}} - 2| \\le 0.15$，则布尔标志 $b$ 设置为真。对问题中指定的每个测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        # (L, c, U, m, T, N_list)\n        (1.0, 340.0, 0.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, 100.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, -50.0, 1, 0.001, [50, 100, 200, 400]),\n        (1.0, 340.0, 306.0, 1, 0.001, [50, 100, 200, 400]),\n    ]\n\n    results = []\n    for params in test_cases:\n        p_obs, is_convergent = solve_case(*params)\n        results.append([p_obs, is_convergent])\n    \n    # Format the output string as specified, without extra spaces\n    result_strings = [f'[{r[0]},{str(r[1]).lower()}]' for r in results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef solve_case(L, c, U, m, T, N_list):\n    \"\"\"\n    Solves the convected wave equation for a single test case over a range of\n    grid resolutions to determine the convergence rate.\n    \n    Returns:\n        A list [p_obs, b] where p_obs is the observed convergence rate\n        and b is a boolean indicating if the rate is close to the theoretical\n        second-order accuracy.\n    \"\"\"\n    errors = []\n    dxs = []\n    \n    k = 2.0 * np.pi * m / L\n    omega = k * (U + c)\n\n    def rhs(y, N, dx, U_val, c_val):\n        \"\"\"\n        Computes the right-hand side of the semi-discretized system dy/dt = F(y).\n        \"\"\"\n        p = y[:N]\n        q = y[N:]\n        \n        # Second-order centered differences with periodic boundaries using np.roll\n        dpdx = (np.roll(p, -1) - np.roll(p, 1)) / (2.0 * dx)\n        dqdx = (np.roll(q, -1) - np.roll(q, 1)) / (2.0 * dx)\n        d2pdx2 = (np.roll(p, -1) - 2.0 * p + np.roll(p, 1)) / (dx**2)\n        \n        dpdt = -U_val * dpdx + q\n        dqdt = -U_val * dqdx + c_val**2 * d2pdx2\n        \n        return np.concatenate((dpdt, dqdt))\n\n    for N in N_list:\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        dxs.append(dx)\n        \n        # Time step calculation based on CFL condition\n        cfl = 0.2\n        # Use abs(U) + c as the maximum characteristic speed\n        max_speed = abs(U) + c\n        if max_speed == 0:\n            # Fallback for theoretical case U=0, c=0; not in test data\n            dt_cfl = 1e-6\n        else:\n            dt_cfl = cfl * dx / max_speed\n\n        # Ensure final time is exactly T\n        Nt = int(np.ceil(T / dt_cfl))\n        dt = T / Nt\n        \n        # Initial conditions at t=0\n        p0 = np.sin(k * x)\n        q0 = -c * k * np.cos(k * x)\n        y = np.concatenate((p0, q0))\n        \n        # Time integration using 2nd-order Runge-Kutta (Heun's method)\n        for _ in range(Nt):\n            dydt1 = rhs(y, N, dx, U, c)\n            y_star = y + dt * dydt1\n            dydt2 = rhs(y_star, N, dx, U, c)\n            y = y + (dt / 2.0) * (dydt1 + dydt2)\n            \n        # Error calculation\n        p_num = y[:N]\n        p_exact = np.sin(k * x - omega * T)\n        \n        # Discrete L2 norm of the error\n        error = np.sqrt(dx * np.sum((p_num - p_exact)**2))\n        errors.append(error)\n\n    # Calculate observed convergence rate p_obs\n    log_dx = np.log(np.array(dxs))\n    log_E = np.log(np.array(errors))\n    \n    # Fit a line: log(E) = p_obs * log(dx) + const\n    p_obs, _ = np.polyfit(log_dx, log_E, 1)\n    \n    # Validate rate against theoretical rate of 2\n    is_convergent = abs(p_obs - 2.0) = 0.15\n    \n    return p_obs, is_convergent\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}