{
    "hands_on_practices": [
        {
            "introduction": "理论知识的掌握需要通过实践来巩固。本节的第一个练习将带您深入了解色散关系保持（DRP）格式的核心——其系数的优化设计。通过将“在宽波数范围内最小化相位误差”这一设计目标转化为一个带约束的最小二乘问题，您将亲手计算出优化后的差分格式系数，从而将抽象的理论转化为具体的数值计算工具。这个过程不仅能加深您对DRP方法背后数学原理的理解，也为您提供了设计满足特定性能要求的定制化数值格式的能力。",
            "id": "4120633",
            "problem": "考虑一维线性声学平流方程 $\\,\\partial u / \\partial t + c\\, \\partial u / \\partial x = 0\\,$，其平面波解为 $\\,u(x,t) = \\exp\\!\\left(i(k x - \\omega t)\\right)\\,$，满足色散关系 $\\,\\omega = c\\,k\\,$。在计算声学中，保色散关系 (DRP) 格式旨在设计空间有限差分算子，使其平面波响应在目标波数带上能再现连续色散关系。对于均匀网格（间距为 $\\,h\\,$）上的一阶空间导数的中心有限差分近似，考虑一个形式如下的 $\\,7\\,$ 点模板：\n$$\n\\left.\\frac{\\partial u}{\\partial x}\\right|_{x_i} \\approx \\frac{1}{h}\\sum_{m=-3}^{3} a_m\\, u_{i+m},\n$$\n其中 $\\,a_0 = 0\\,$ 且具有反对称性 $\\,a_{-m} = - a_m\\,$，以确保该算子表示一阶导数。当应用于平面波 $\\,u_i = \\exp(i\\,k\\,h\\,i)\\,$ 时，该离散算子产生一个修正波数 $\\,\\widehat{k}\\,$，定义为：\n$$\n\\frac{1}{h}\\sum_{m=-3}^{3} a_m\\, \\exp(i\\,m\\,k\\,h) = i\\,\\widehat{k},\n$$\n在反对称性约束下，该式可简化为无量纲关系：\n$$\n\\widehat{k}\\,h = 2\\sum_{m=1}^{3} a_m\\, \\sin(m\\,\\theta), \\quad \\text{其中 } \\theta = k\\,h.\n$$\n为确保在 $\\,\\theta = 0\\,$ 附近与连续导数的一致性，要求满足泰勒级数斜率条件：\n$$\n2\\sum_{m=1}^{3} m\\,a_m = 1,\n$$\n这确保了对于小的 $\\,\\theta\\,$，有 $\\,\\widehat{k}\\,h \\approx \\theta\\,$。通过选择系数 $\\,a_1,a_2,a_3\\,$ 来设计模板，使其在目标频带 $\\,0 \\le \\theta \\le \\theta_{\\max}\\,$ 上保持色散关系，即使得离散最小二乘误差最小化：\n$$\nJ(a_1,a_2,a_3) = \\sum_{i=1}^{N} \\left( 2\\sum_{m=1}^{3} a_m\\, \\sin(m\\,\\theta_i) - \\theta_i \\right)^2,\n$$\n其中网格 $\\,\\{\\theta_i\\}_{i=1}^{N}\\,$ 在区间 $\\,\\left[0,\\ \\theta_{\\max}\\right]\\,$ 上均匀分布，$\\,\\theta_{\\max} = k_{\\max} h = \\pi/2\\,$，且角度必须以弧度处理。建立并求解该约束最小二乘问题：\n$$\n\\min_{a_1,a_2,a_3} J(a_1,a_2,a_3) \\quad \\text{约束条件为} \\quad \\sum_{m=1}^{3} m\\,a_m = \\tfrac{1}{2}.\n$$\n使用带有单个线性等式约束的正规方程形式，或等价地，使用 Karush–Kuhn–Tucker (KKT) 鞍点系统，来获得最优系数 $\\,a_1,a_2,a_3\\,$。最后，报告完整的 $\\,7\\,$ 点模板系数 $\\,\\left[a_{-3},a_{-2},a_{-1},a_0,a_1,a_2,a_3\\right]\\,$（其中 $\\,a_{-m} = -a_m\\,$ 且 $\\,a_0 = 0\\,$），并计算在相同网格上（不包括 $\\,\\theta = 0\\,$）的均方根色散误差，其定义为：\n$$\n\\varepsilon_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N'} \\sum_{\\theta_i \\in (0,\\theta_{\\max}]} \\left( \\frac{\\widehat{k}\\,h - \\theta_i}{\\theta_i} \\right)^2 },\n$$\n其中 $\\,N'\\,$ 是 $\\,\\theta_i > 0\\,$ 的网格点数，所有角度均须以弧度为单位。\n\n您的程序必须针对 $\\,N\\,$ 的几个不同值实现约束最小二乘解，以评估最优系数对设计中所用网格分辨率的依赖性。为 $\\,N\\,$ 使用以下测试套件：\n- $\\,N = 33\\,$，\n- $\\,N = 65\\,$，\n- $\\,N = 129\\,$，\n- $\\,N = 5\\,$ (设计网格非常粗糙的边缘情况)。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。此列表中的每个元素本身都应是一个包含 $\\,8\\,$ 个浮点数的列表，形式为 $\\,\\left[a_{-3},a_{-2},a_{-1},a_0,a_1,a_2,a_3,\\varepsilon_{\\mathrm{rms}}\\right]\\,$，按上述顺序列出，对应一个测试用例。角度必须以弧度为单位，系数或误差无需物理单位。输出必须为：\n$$\n\\left[ [a_{-3},a_{-2},a_{-1},a_0,a_1,a_2,a_3,\\varepsilon_{\\mathrm{rms}}]_{N=33},\\ [\\cdots]_{N=65},\\ [\\cdots]_{N=129},\\ [\\cdots]_{N=5} \\right],\n$$\n的形式，并使用标准数字格式打印为单行。",
            "solution": "该问题要求设计一个用于一阶空间导数的 $\\,7\\,$ 点有限差分模板，该模板经过优化，以在一维声学平流方程的指定波数范围内保持其色散关系。这被表述为一个约束线性最小二乘问题。\n\n目标是找到系数 $a_1, a_2, a_3$，以最小化离散最小二乘误差函数 $J$：\n$$\n\\min_{a_1,a_2,a_3} J(a_1,a_2,a_3) = \\sum_{i=1}^{N} \\left( 2\\sum_{m=1}^{3} a_m \\sin(m \\theta_i) - \\theta_i \\right)^2\n$$\n并服从确保在低波数下与连续一阶导数一致的线性等式约束：\n$$\n\\sum_{m=1}^{3} m a_m = \\frac{1}{2}\n$$\n优化是在无量纲波数 $\\theta_i = k_i h$ 的离散网格上进行的，该网格在区间 $[0, \\theta_{\\max}]$ 上均匀分布，其中 $\\theta_{\\max} = \\pi/2$，$N$ 为网格点数。\n\n该问题可以表示为矩阵形式。设未知系数向量为 $\\mathbf{a} = [a_1, a_2, a_3]^T$。问题是在 $\\mathbf{C}\\mathbf{a} = d$ 约束下最小化 $\\|\\mathbf{A}\\mathbf{a} - \\mathbf{b}\\|_2^2$。\n矩阵 $\\mathbf{A}$、向量 $\\mathbf{b}$、约束矩阵 $\\mathbf{C}$ 和约束值 $d$ 的各分量定义如下：\n- $\\mathbf{A}$ 是一个 $N \\times 3$ 矩阵，其元素为 $A_{im} = 2 \\sin(m \\theta_i)$，其中 $i \\in \\{1, \\dots, N\\}$ 且 $m \\in \\{1, 2, 3\\}$。\n- $\\mathbf{b}$ 是一个 $N \\times 1$ 向量，其元素为 $b_i = \\theta_i$。\n- $\\mathbf{C}$ 是一个 $1 \\times 3$ 的行向量，$\\mathbf{C} = [1, 2, 3]$。\n- $d$ 是一个标量，$d = 1/2$。\n\n该问题使用拉格朗日乘数法求解，该方法可导出 Karush–Kuhn–Tucker (KKT) 条件。此约束优化问题的拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(\\mathbf{a}, \\lambda) = (\\mathbf{A}\\mathbf{a} - \\mathbf{b})^T (\\mathbf{A}\\mathbf{a} - \\mathbf{b}) + \\lambda (\\mathbf{C}\\mathbf{a} - d)\n$$\n其中 $\\lambda$ 是与等式约束相关的拉格朗日乘子。为求得最优解，我们将 $\\mathcal{L}$ 对 $\\mathbf{a}$ 和 $\\lambda$ 的梯度置零：\n$$\n\\nabla_{\\mathbf{a}} \\mathcal{L} = 2\\mathbf{A}^T(\\mathbf{A}\\mathbf{a} - \\mathbf{b}) + \\mathbf{C}^T \\lambda = \\mathbf{0}\n$$\n$$\n\\nabla_{\\lambda} \\mathcal{L} = \\mathbf{C}\\mathbf{a} - d = 0\n$$\n重新整理这些方程，可得到关于增广未知向量 $[\\mathbf{a}^T, \\lambda]^T$ 的线性方程组：\n$$\n2\\mathbf{A}^T\\mathbf{A}\\mathbf{a} + \\mathbf{C}^T\\lambda = 2\\mathbf{A}^T\\mathbf{b}\n$$\n$$\n\\mathbf{C}\\mathbf{a} = d\n$$\n这就是 KKT 鞍点系统，可以写成如下的分块矩阵形式：\n$$\n\\begin{bmatrix}\n2\\mathbf{A}^T\\mathbf{A}  \\mathbf{C}^T \\\\\n\\mathbf{C}  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{a} \\\\\n\\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n2\\mathbf{A}^T\\mathbf{b} \\\\\nd\n\\end{bmatrix}\n$$\n这是一个 $(3+1) \\times (3+1) = 4 \\times 4$ 的线性系统。对于每个指定的 $\\,N\\,$ 值，我们构建网格 $\\{\\theta_i\\}_{i=1}^N$，组装 KKT 矩阵和右侧向量，然后求解系数向量 $\\mathbf{a} = [a_1, a_2, a_3]^T$。\n\n一旦求得最优系数 $a_1, a_2, a_3$，就可以利用给定的约束 $a_0 = 0$ 和 $a_{-m} = -a_m$ 来构建完整的 $\\,7\\,$ 点模板：\n$$\n[a_{-3}, a_{-2}, a_{-1}, a_0, a_1, a_2, a_3] = [-a_3, -a_2, -a_1, 0, a_1, a_2, a_3]\n$$\n最后，在设计网格上计算均方根 (RMS) 色散误差 $\\varepsilon_{\\mathrm{rms}}$，不包括点 $\\theta = 0$：\n$$\n\\varepsilon_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N'} \\sum_{\\theta_i \\in (0,\\theta_{\\max}]} \\left( \\frac{\\widehat{k_i}h - \\theta_i}{\\theta_i} \\right)^2 }\n$$\n其中 $N' = N-1$ 是非零网格点的数量，而 $\\widehat{k_i}h$ 是每个 $\\theta_i$ 对应的无量纲修正波数：\n$$\n\\widehat{k_i}h = 2\\sum_{m=1}^{3} a_m \\sin(m \\theta_i)\n$$\n对测试套件中提供的每个 $\\,N\\,$ 值（$N=33, 65, 129, 5$）执行这整个过程。\n随着 $\\,N\\,$ 的增加，$a_1, a_2, a_3$ 的解会收敛，因为 KKT 矩阵中的离散求和会趋近于其连续积分的对应项。$N=5$ 的情况是使用一个非常粗糙的网格进行优化过程的示例，该问题在数学上仍然是适定的，因为方程的数量（来自求和的 $\\,5\\,$ 个，来自约束的 $\\,1\\,$ 个）超过了未知数的数量（$\\,3\\,$ 个）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the constrained least-squares problem for DRP scheme coefficients\n    for a series of test cases and formats the output.\n    \"\"\"\n    test_cases = [33, 65, 129, 5]\n\n    results = []\n    for N in test_cases:\n        result = calculate_coeffs_and_error(N)\n        results.append(result)\n\n    # Format the final list of lists into the required string representation.\n    # The str() of a list is '[item1, item2, ...]', which is the desired format.\n    formatted_results = ','.join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\ndef calculate_coeffs_and_error(N):\n    \"\"\"\n    Calculates the optimal DRP coefficients and RMS error for a given grid\n    resolution N.\n\n    Args:\n        N (int): The number of points in the design grid for theta.\n\n    Returns:\n        list: A list of 8 floats containing the 7 stencil coefficients\n              [a_{-3}, ..., a_3] and the RMS error.\n    \"\"\"\n    theta_max = np.pi / 2.0\n    # Create a uniform grid for theta from 0 to theta_max with N points.\n    theta = np.linspace(0, theta_max, N)\n\n    # Set up the linear least-squares problem: min ||Aa - b||^2\n    # A has shape (N, 3), b has shape (N,)\n    A = np.zeros((N, 3))\n    for m in range(1, 4):\n        # A_im = 2*sin(m*theta_i)\n        A[:, m-1] = 2.0 * np.sin(m * theta)\n    \n    b = theta\n\n    # Set up the linear constraint: Ca = d\n    # C has shape (1, 3), d is a scalar\n    C = np.array([1.0, 2.0, 3.0])\n    d = 0.5\n\n    # Assemble the KKT (Karush-Kuhn-Tucker) saddle-point system:\n    # [ 2*A^T*A   C^T ] [ a      ] = [ 2*A^T*b ]\n    # [ C         0   ] [ lambda ]   [ d       ]\n    # The system is 4x4.\n    \n    # Top-left block: 2 * A^T * A (3x3)\n    H = 2.0 * (A.T @ A)\n    \n    # Top-right block: C^T (3x1)\n    CT = C.reshape(3, 1)\n\n    # Build the 4x4 KKT matrix\n    KKT_mat = np.zeros((4, 4))\n    KKT_mat[0:3, 0:3] = H\n    KKT_mat[0:3, 3] = C\n    KKT_mat[3, 0:3] = C\n\n    # Build the 4x1 right-hand side vector\n    rhs = np.zeros(4)\n    # Top part: 2 * A^T * b\n    rhs[0:3] = 2.0 * (A.T @ b)\n    # Bottom part: d\n    rhs[3] = d\n\n    # Solve the KKT system for [a_1, a_2, a_3, lambda]\n    solution = np.linalg.solve(KKT_mat, rhs)\n    \n    # Extract the coefficients a_1, a_2, a_3\n    a = solution[0:3]\n    a1, a2, a3 = a[0], a[1], a[2]\n\n    # Construct the full 7-point stencil using antisymmetry a_{-m} = -a_m\n    # and a_0 = 0\n    stencil_coeffs = [-a3, -a2, -a1, 0.0, a1, a2, a3]\n\n    # Calculate the RMS dispersion error\n    # The error is calculated over the grid excluding theta = 0.\n    theta_nonzero = theta[1:]\n    N_prime = N - 1\n\n    if N_prime  0:\n        # Modified wavenumber kh_hat = 2 * sum(a_m * sin(m*theta))\n        kh_hat_model = A[1:, :] @ a\n        \n        # Relative error: (kh_hat - theta) / theta\n        relative_error = (kh_hat_model - theta_nonzero) / theta_nonzero\n        \n        # RMS error: sqrt(mean of squared relative errors)\n        rms_error = np.sqrt(np.mean(relative_error**2))\n    else:\n        # Should not happen with N = 2, but handle for robustness\n        rms_error = 0.0\n\n    # Combine stencil and error into a single list\n    final_result = stencil_coeffs + [rms_error]\n    \n    return final_result\n\nsolve()\n```"
        },
        {
            "introduction": "设计出数值格式后，我们需要一个有效的工具来分析和评估其性能。修正波数（modified wavenumber）正是分析有限差分格式色散特性的核心工具。本练习将指导您从第一性原理出发，推导修正波数的表达式，并在此基础上，通过编程实现对不同差分格式——包括优化的DRP格式和标准高阶中心差分格式——的修正波数曲线进行可视化和定量比较。通过这项实践，您将能直观地看到“色散关系保持”的真正含义，并理解不同格式在不同波数下的性能差异。",
            "id": "4120595",
            "problem": "考虑在计算声学中用于设计保持线性波传播色散关系的数值空间差分算子的平面波分析框架。保色散关系 (Dispersion-Relation-Preserving, DRP) 格式是一种有限差分离散化方法，其离散空间算子产生的修正波数在一个很宽的无量纲波数范围内与精确的连续波数非常匹配。\n\n从以下基本出发点开始：应用于间距为 $h$ 的均匀网格上的离散网格函数 $u_j = u(x_j)$ 的一维空间导数近似，可以使用中心反对称模板写为：\n$$\n\\left.\\frac{\\partial u}{\\partial x}\\right|_{x=x_j} \\approx \\frac{1}{h} \\sum_{m=1}^{M} a_m \\left(u_{j+m} - u_{j-m}\\right),\n$$\n其中 $a_m$ 是恒定的模板系数，$M$ 是模板的半宽。对于波数为 $k$ 的空间傅里叶模态 $u(x) = e^{i k x}$，一个线性、常系数、位移不变模板的作用可以通过由离散符号定义的修正波数 $k_{\\text{eff}}(k)$ 来表征。使用无量纲量 $\\hat{k}(\\theta)$（其中 $\\theta \\equiv k h$）来比较数值色散与精确关系，其中精确的连续行为对应于 $\\hat{k}(\\theta) = \\theta$。\n\n在本问题中，您将比较两种用于一阶导数的特定中心反对称模板：\n- 一个优化的7点保色散关系 (DRP) 模板，半宽 $M=3$，系数为 $a_1 = 0.77088238$，$a_2 = -0.16670590$，$a_3 = 0.02084314$。这些系数的选择使得主导相容性条件 $\\sum_{m=1}^{3} m\\,a_m = 1/2$ 得以满足，并且数值色散在 $\\theta$ 的一个实用范围内得到优化。\n- 一个标准的一阶导数6阶中心差分模板，半宽 $M=3$，系数为 $a_1 = 3/4$，$a_2 = -3/20$，$a_3 = 1/60$。这些系数满足 $\\sum_{m=1}^{3} m\\,a_m = 1/2$ 并且产生 $O(h^6)$ 阶的截断误差。\n\n您的任务：\n1. 使用平面波拟设 $u_j = e^{i k x_j}$ 和线性位移不变算子的离散符号定义，推导中心反对称模板的无量纲修正波数 $\\hat{k}(\\theta)$ 作为 $\\theta$ 和模板系数 $a_m$ 的函数表达式。不要假设任何关于 $\\hat{k}(\\theta)$ 的既有公式；通过将模板应用于 $u_j = e^{i k x_j}$ 从第一性原理出发进行推导。\n2. 实现一个程序，对于每种模板，在 $\\theta \\in [0,\\pi/2]$ 的范围内计算无量纲修正波数 $\\hat{k}(\\theta)$，其中 $\\theta$ 以弧度为单位。\n3. 计算并报告在 $\\theta \\in [0,\\pi/2]$ 范围内两个修正波数之间的最大绝对偏差，即 $\\max_{\\theta \\in [0,\\pi/2]} \\left|\\hat{k}_{\\text{DRP}}(\\theta) - \\hat{k}_{\\text{CD6}}(\\theta)\\right|$，以及出现此最大值时 $\\theta$ 的值（以弧度为单位）。\n\n角度单位必须是弧度。所有数值输出必须四舍五入到六位小数。\n\n测试套件和要求输出：\n- 使用三个测试用例，每个用例由用于离散化 $\\theta \\in [0,\\pi/2]$ 的均匀间隔采样点数 $N$ 定义：\n  1. $N = 10001$（一个高分辨率的“理想路径”情况）。\n  2. $N = 101$（一个中等分辨率的边界情况）。\n  3. $N = 2$（一个仅采样端点的边缘情况）。\n- 对于每个测试用例，在指定的 $\\theta$ 值网格上评估两个修正波数曲线，计算最大绝对偏差和对应的 $\\theta$ 位置，并返回这两个值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个按 $[\\text{max\\_deviation}, \\theta_{\\text{at\\_max}}]$ 顺序排列的双元素列表。例如，包含三个测试用例的输出必须如下所示：\n$$\n[[x_1,y_1],[x_2,y_2],[x_3,y_3]]\n$$\n无空格，其中 $x_i$ 和 $y_i$ 是四舍五入到六位小数的浮点数。",
            "solution": "问题陈述具有科学依据、是良定的、客观且自洽的，因此被认为是有效的。我们逐步进行求解。\n\n### 第1部分：无量纲修正波数的推导\n\n首要任务是为一个通用的中心反对称有限差分模板推导无量纲修正波数 $\\hat{k}(\\theta)$ 的表达式。\n\n该模板将函数 $u(x)$ 在网格点 $x_j$ 处的一阶空间导数近似为：\n$$\n\\left.\\frac{\\partial u}{\\partial x}\\right|_{x=x_j} \\approx \\frac{1}{h} \\sum_{m=1}^{M} a_m \\left(u_{j+m} - u_{j-m}\\right)\n$$\n这里，$u_j = u(x_j)$，$h$ 是均匀网格间距，$a_m$ 是模板系数，$M$ 是模板半宽。这个数值算子，我们记为 $D_h$，是线性且位移不变的。\n\n为了在傅里叶域中分析其行为，我们将该算子应用于单个空间傅里叶模态，也称为平面波。这就是平面波拟设：\n$$\nu(x) = e^{i k x}\n$$\n其中 $k$ 是连续波数，$i = \\sqrt{-1}$。在离散网格上，$x_j = j h$，函数表示为：\n$$\nu_j = e^{i k x_j} = e^{i k j h}\n$$\n在相邻网格点 $x_{j \\pm m} = (j \\pm m)h$ 处的值为：\n$$\nu_{j+m} = e^{i k (j+m)h} = e^{i k j h} e^{i m k h} = u_j e^{i m k h}\n$$\n$$\nu_{j-m} = e^{i k (j-m)h} = e^{i k j h} e^{-i m k h} = u_j e^{-i m k h}\n$$\n模板求和中的差分项变为：\n$$\nu_{j+m} - u_{j-m} = u_j e^{i m k h} - u_j e^{-i m k h} = u_j \\left(e^{i m k h} - e^{-i m k h}\\right)\n$$\n使用欧拉公式 $e^{i\\phi} - e^{-i\\phi} = 2i \\sin(\\phi)$，我们可以简化这个差分：\n$$\nu_{j+m} - u_{j-m} = u_j \\cdot 2i \\sin(m k h)\n$$\n将此代入模板公式中，我们得到数值算子 $D_h$ 对平面波 $u_j$ 的作用：\n$$\nD_h[u_j] = \\frac{1}{h} \\sum_{m=1}^{M} a_m \\left( u_j \\cdot 2i \\sin(m k h) \\right)\n$$\n由于 $u_j$ 和 $i$ 不依赖于求和指数 $m$，我们可以将它们提取出来：\n$$\nD_h[u_j] = \\left( \\frac{2i}{h} \\sum_{m=1}^{M} a_m \\sin(m k h) \\right) u_j\n$$\n平面波 $u(x)=e^{ikx}$ 的精确连续导数是：\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} (e^{i k x}) = i k e^{i k x} = (i k) u(x)\n$$\n通过类比，离散算子 $D_h$ 对离散平面波 $u_j$ 的作用定义了修正波数 $k_{\\text{eff}}$，它是一个满足以下条件的标量：\n$$\nD_h[u_j] = (i k_{\\text{eff}}) u_j\n$$\n通过令我们得到的两个 $D_h[u_j]$ 表达式相等，我们得到：\n$$\n(i k_{\\text{eff}}) u_j = \\left( \\frac{2i}{h} \\sum_{m=1}^{M} a_m \\sin(m k h) \\right) u_j\n$$\n从两侧消去公因子 $i u_j$ 即可得到修正波数的表达式：\n$$\nk_{\\text{eff}} = \\frac{2}{h} \\sum_{m=1}^{M} a_m \\sin(m k h)\n$$\n为了获得无量纲形式，我们引入无量纲波数 $\\theta = k h$，并定义无量纲修正波数为 $\\hat{k}(\\theta) = k_{\\text{eff}} h$。我们将 $k_{\\text{eff}}$ 的方程两边乘以 $h$：\n$$\nk_{\\text{eff}} h = 2 \\sum_{m=1}^{M} a_m \\sin(m (k h))\n$$\n代入无量纲变量，我们得到最终推导出的表达式：\n$$\n\\hat{k}(\\theta) = 2 \\sum_{m=1}^{M} a_m \\sin(m \\theta)\n$$\n这个公式通过模板系数 $a_m$ 将有效数值色散 $\\hat{k}(\\theta)$ 与理想色散 $\\hat{k}(\\theta)=\\theta$ 联系起来。\n\n### 第2和第3部分：数值计算与比较\n\n下一步是为给定的两种模板实现此公式，并计算它们各自的修正波数在区间 $\\theta \\in [0, \\pi/2]$ 上的最大绝对偏差。\n\n模板的系数如下：\n1.  **7点 DRP 模板 ($M=3$)：**\n    $a_1 = 0.77088238$\n    $a_2 = -0.16670590$\n    $a_3 = 0.02084314$\n2.  **6阶中心差分 (CD6) 模板 ($M=3$)：**\n    $a_1 = 3/4 = 0.75$\n    $a_2 = -3/20 = -0.15$\n    $a_3 = 1/60 \\approx 0.01666667$\n\n对于由 $N$（采样点数）定义的每个测试用例，我们将执行以下步骤：\n1.  在 $[0, \\pi/2]$ 范围内为 $\\theta$ 创建一个包含 $N$ 个点的均匀网格。\n2.  对于此网格上的每个 $\\theta$，使用 DRP 系数和推导出的公式计算 $\\hat{k}_{\\text{DRP}}(\\theta)$。\n3.  类似地，使用 CD6 系数计算 $\\hat{k}_{\\text{CD6}}(\\theta)$。\n4.  计算网格上所有点的绝对差 $|\\hat{k}_{\\text{DRP}}(\\theta) - \\hat{k}_{\\text{CD6}}(\\theta)|$。\n5.  找到这个差值的最大值以及它出现时对应的 $\\theta$ 值。\n6.  每个测试用例的结果 $[\\text{max\\_deviation}, \\theta_{\\text{at\\_max}}]$ 将被收集并按规定格式化。\n\n计算逻辑将被封装在一个 Python 脚本中，该脚本利用 `numpy` 库进行高效的向量化计算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing DRP and CD6 finite difference schemes.\n    \n    This function performs the following steps:\n    1. Defines the coefficients for the 7-point DRP and 6th-order centered\n       difference (CD6) stencils.\n    2. Defines the test cases based on the number of sample points N.\n    3. Implements a vectorized function to calculate the dimensionless \n       modified wavenumber for a given set of coefficients and theta values.\n    4. Iterates through each test case:\n       a. Creates a grid of theta values.\n       b. Computes the modified wavenumbers for both DRP and CD6 schemes.\n       c. Calculates the absolute difference between the two.\n       d. Finds the maximum deviation and the theta at which it occurs.\n    5. Formats and prints the final results as specified in the problem statement.\n    \"\"\"\n\n    # Stencil coefficients for M=3\n    # 7-point Dispersion-Relation-Preserving (DRP) stencil\n    coeffs_drp = np.array([0.77088238, -0.16670590, 0.02084314])\n    \n    # 6th-order Centered Difference (CD6) stencil\n    coeffs_cd6 = np.array([3.0/4.0, -3.0/20.0, 1.0/60.0])\n\n    # Test cases defined by the number of sample points N\n    test_cases = [10001, 101, 2]\n\n    results = []\n\n    def calculate_k_hat(theta_grid, coeffs):\n        \"\"\"\n        Calculates the dimensionless modified wavenumber k_hat(theta).\n        Formula: k_hat(theta) = 2 * sum_{m=1 to M} a_m * sin(m*theta)\n        \n        Args:\n            theta_grid (np.ndarray): An array of dimensionless wavenumbers theta.\n            coeffs (np.ndarray): The stencil coefficients [a_1, a_2, ..., a_M].\n\n        Returns:\n            np.ndarray: An array of k_hat values corresponding to the theta_grid.\n        \"\"\"\n        M = len(coeffs)\n        m_vals = np.arange(1, M + 1)\n        \n        # Create a matrix of m*theta values where rows correspond to theta\n        # and columns correspond to m.\n        m_theta_matrix = np.outer(theta_grid, m_vals)\n        \n        # Apply sin function element-wise\n        sin_matrix = np.sin(m_theta_matrix)\n        \n        # Compute the sum via matrix-vector multiplication\n        # (N, M) @ (M,) - (N,)\n        k_hat_values = 2 * (sin_matrix @ coeffs)\n        return k_hat_values\n\n    for n_points in test_cases:\n        # Create a uniform grid for theta in the range [0, pi/2]\n        theta_grid = np.linspace(0, np.pi/2, n_points)\n        \n        # Calculate the modified wavenumbers for both schemes\n        k_hat_drp = calculate_k_hat(theta_grid, coeffs_drp)\n        k_hat_cd6 = calculate_k_hat(theta_grid, coeffs_cd6)\n        \n        # Compute the absolute difference\n        abs_deviation = np.abs(k_hat_drp - k_hat_cd6)\n        \n        # Find the index of the maximum deviation\n        max_dev_index = np.argmax(abs_deviation)\n        \n        # Get the maximum deviation and the theta at which it occurs\n        max_dev = abs_deviation[max_dev_index]\n        theta_at_max = theta_grid[max_dev_index]\n        \n        results.append([max_dev, theta_at_max])\n\n    # Format the final output string exactly as required\n    formatted_results = []\n    for res_pair in results:\n        max_dev, theta_val = res_pair\n        # Format each number to 6 decimal places and create a string like \"[x.xxxxxx,y.yyyyyy]\"\n        formatted_pair = f\"[{max_dev:.6f},{theta_val:.6f}]\"\n        formatted_results.append(formatted_pair)\n        \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "修正波数的微小偏差在单步计算中或许微不足道，但在长时间的波传播模拟中，这些误差会逐渐累积，最终导致模拟结果与真实物理过程产生显著偏离。本节的最后一个练习旨在将抽象的色散误差概念与其在实际模拟中的具体影响联系起来。通过模拟一个周期域中的驻波并精确追踪其相位，您将定量地看到不同数值格式在长时间演化后所产生的累积相位误差。这项实践将清晰地展示DRP格式在长时程、高保真度声学仿真中的关键优势，并突显其对于预测物理现象的重要性。",
            "id": "4120598",
            "problem": "考虑周期域中的一维线性声学问题。声压 $p(x,t)$ 和质点速度 $u(x,t)$ 的控制方程为一阶系统：\n$p_t + K u_x = 0$ 和 $u_t + \\frac{1}{\\rho} p_x = 0$，其中 $K$ 是体积模量，$\\rho$ 是密度，声速为 $c = \\sqrt{K/\\rho}$。在长度为 $L$ 且具有周期性边界条件的连续域上，驻波初始条件 $p(x,0) = \\cos(k x)$，$u(x,0) = 0$ 会导出 $p(x,t) = \\cos(k x)\\cos(\\omega t)$，其角频率为 $\\omega = c\\,|k|$。我们感兴趣的是半离散（空间离散，时间连续）情况，其中空间由一种保色散关系 (DRP) 的中心有限差分格式来离散，以近似一阶空间导数，而时间是精确积分的（无时间离散误差）。空间网格有 $M$ 个点，均匀间距为 $\\Delta x = L/M$。离散一阶导数的格式是反对称的，形式为：\n$D[u]_n = \\frac{1}{\\Delta x}\\sum_{j=1}^{J} a_j\\,(u_{n+j} - u_{n-j})$，\n其中 $a_j$ 是给定的系数，$J$ 是半宽度。假设在半离散一阶声学系统中使用该离散导数算子。对于波数为 $k = 2\\pi m/L$（其中 $m$ 为整数）的模态，半离散系统会再现一个振荡，其数值角频率 $\\omega_{\\text{num}}$ 由离散空间算子确定。长时间驻波的相位误差会根据 $\\Delta\\phi(T) = (\\omega_{\\text{num}} - \\omega)\\,T$ 线性累积，以弧度为单位。将经过 $N$ 个精确连续周期 $T = N\\,\\frac{2\\pi}{\\omega}$ 后的展开累积相位误差定义为标量：\n$\\Delta\\phi_N = (\\omega_{\\text{num}}/\\omega - 1)\\,2\\pi N$，\n这即是要计算的量。\n\n你的任务是编写一个完整、可运行的程序，该程序：\n- 从基本声学模型和给定的离散空间导数出发，利用傅里叶分析得到半离散色散关系，并由此导出 $\\omega_{\\text{num}}$。\n- 对下面列出的每个测试用例，实现累积展开相位误差 $\\Delta\\phi_N$ 的计算。\n- 将结果以单行形式输出，格式为方括号内包含的逗号分隔列表。\n\n所有物理量必须使用以下单位：$L$ 的单位为 $\\mathrm{m}$，$c$ 的单位为 $\\mathrm{m/s}$，累积相位误差 $\\Delta\\phi_N$ 必须以弧度报告。角度必须以弧度为单位。不存在时间步长，因为时间积分是精确的。\n\n要使用的格式系数集（反对称中心差分一阶导数格式）：\n- 二阶中心差分：$J=1$，$a_1 = 0.5$。\n- 四阶中心差分：$J=2$，$a_1 = 0.6666666666666666$，$a_2 = -0.08333333333333333$。\n- 七点保色散关系优化格式（Tam–Webb 类型）：$J=3$，$a_1 = 0.770882380518225$，$a_2 = -0.166705904414580$，$a_3 = 0.020843142770311$。\n\n参数集测试套件 $(\\text{格式}, L, c, M, m, N)$：\n- 用例 A（理想情况，良解析 DRP）：七点 DRP，$L = 1.0\\,\\mathrm{m}$，$c = 340.0\\,\\mathrm{m/s}$，$M = 256$，$m = 4$，$N = 1000$。\n- 用例 B（极低波数下的长时间累积）：七点 DRP，$L = 1.0\\,\\mathrm{m}$，$c = 340.0\\,\\mathrm{m/s}$，$M = 256$，$m = 1$，$N = 10000$。\n- 用例 C（中心差分格式的奈奎斯特边界情况）：二阶中心差分，$L = 1.0\\,\\mathrm{m}$，$c = 340.0\\,\\mathrm{m/s}$，$M = 128$，$m = 64$，$N = 5$。\n- 用例 D（中等解析度，非 DRP 高阶）：四阶中心差分，$L = 1.0\\,\\mathrm{m}$，$c = 340.0\\,\\mathrm{m/s}$，$M = 48$，$m = 9$，$N = 800$。\n\n你的程序必须：\n- 对每个测试用例，计算 $\\Delta x = L/M$、连续波数 $k = 2\\pi m/L$，并使用空间格式得到该 $k$ 对应的离散修正波数 $\\tilde{k}$。\n- 利用半离散系统的精确时间积分特性，从离散空间算子中得到 $\\omega_{\\text{num}}$，然后计算如上定义的累积展开相位误差 $\\Delta\\phi_N$。\n- 按 A-D 用例的顺序，将四个结果返回为打印到标准输出的单行，其中包含一个类 Python 列表的字符串，内含4个四舍五入到10位小数的浮点值，例如 $[x_1,x_2,x_3,x_4]$。\n\n答案以弧度为单位。将每个结果四舍五入到10位小数。最终程序不得读取输入。\n\n你的解决方案必须可被任何使用任何现代编程语言的开发者复现，但你的最终答案必须是按 Python $3.12$ 规范编写的、包含允许库的完整可运行程序。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确，并包含推导唯一解所需的所有信息。\n\n解决方案是通过分析半离散声学方程的色散特性推导出来的。我们从连续系统入手，建立其色散关系，然后将其与由空间有限差分近似产生的数值色散关系进行对比。\n\n一维线性声学方程以声压 $p(x,t)$ 和质点速度 $u(x,t)$ 的一阶系统形式给出：\n$$\n\\frac{\\partial p}{\\partial t} + K \\frac{\\partial u}{\\partial x} = 0 \\\\\n\\frac{\\partial u}{\\partial t} + \\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} = 0\n$$\n其中 $K$ 是体积模量，$\\rho$ 是密度。通过将第一个方程对时间 $t$ 求导，第二个方程对空间 $x$ 求导，然后代入，这些方程可以组合成一个二阶波动方程，得到：\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}\n$$\n其中 $c = \\sqrt{K/\\rho}$ 是声速。\n为了找到连续色散关系，我们考虑一个平面波解，形式为 $p(x,t) = \\hat{p} e^{i(kx - \\omega t)}$。将其代入波动方程可得：\n$$\n(-i\\omega)^2 e^{i(kx - \\omega t)} = c^2 (ik)^2 e^{i(kx - \\omega t)} \\\\\n-\\omega^2 = -c^2 k^2\n$$\n这给出了精确的色散关系 $\\omega^2 = c^2 k^2$，即 $\\omega = c|k|$，其中 $k$ 是波数，$\\omega$ 是角频率。\n\n在半离散方法中，空间导数使用有限差分格式进行近似，而时间保持连续。网格点定义为 $x_n = n \\Delta x$，其中 $\\Delta x = L/M$ 是网格间距。空间导数算子由下式给出：\n$$\nD[f]_n = \\frac{1}{\\Delta x}\\sum_{j=1}^{J} a_j\\,(f_{n+j} - f_{n-j})\n$$\n半离散方程组变为：\n$$\n\\frac{d p_n}{dt} = -K D[u]_n \\\\\n\\frac{d u_n}{dt} = -\\frac{1}{\\rho} D[p]_n\n$$\n为了分析该系统的色散特性，我们考察它在单个空间傅里叶模态 $f_n = e^{ikx_n} = e^{ikn\\Delta x}$ 上的行为。将离散算子 $D$ 应用于此模态，得到：\n$$\nD[e^{ikn\\Delta x}] = \\frac{1}{\\Delta x}\\sum_{j=1}^{J} a_j\\,(e^{ik(n+j)\\Delta x} - e^{ik(n-j)\\Delta x}) \\\\\n= \\frac{e^{ikn\\Delta x}}{\\Delta x} \\sum_{j=1}^{J} a_j\\,(e^{ikj\\Delta x} - e^{-ikj\\Delta x})\n$$\n使用恒等式 $\\sin(\\theta) = (e^{i\\theta} - e^{-i\\theta})/(2i)$，上式可简化为：\n$$\nD[e^{ikn\\Delta x}] = \\frac{e^{ikn\\Delta x}}{\\Delta x} \\sum_{j=1}^{J} a_j\\,(2i \\sin(kj\\Delta x)) \\\\\n= i \\left( \\frac{2}{\\Delta x} \\sum_{j=1}^{J} a_j \\sin(kj\\Delta x) \\right) e^{ikn\\Delta x}\n$$\n这表明对于一个傅里叶模态，离散微分算子 $D$ 的作用等同于乘以 $i\\tilde{k}$，其中 $\\tilde{k}$ 是*修正波数*：\n$$\n\\tilde{k}(k) = \\frac{2}{\\Delta x} \\sum_{j=1}^{J} a_j \\sin(kj\\Delta x)\n$$\n修正波数 $\\tilde{k}$ 是数值格式所“看到”的有效波数。$\\tilde{k}$ 与 $k$ 的任何偏差都会导致色散误差。\n\n将傅里叶模态表示 $p_n(t) = \\hat{p}(t)e^{ikn\\Delta x}$ 和 $u_n(t) = \\hat{u}(t)e^{ikn\\Delta x}$ 代入半离散系统，我们得到一个关于随时间变化的振幅 $\\hat{p}(t)$ 和 $\\hat{u}(t)$ 的常微分方程组：\n$$\n\\frac{d\\hat{p}}{dt} = -K (i\\tilde{k}) \\hat{u} \\\\\n\\frac{d\\hat{u}}{dt} = -\\frac{1}{\\rho} (i\\tilde{k}) \\hat{p}\n$$\n合并这些方程可得到关于 $\\hat{p}(t)$ 的二阶常微分方程：\n$$\n\\frac{d^2\\hat{p}}{dt^2} = -K (i\\tilde{k}) \\frac{d\\hat{u}}{dt} = -K (i\\tilde{k}) \\left(-\\frac{1}{\\rho} (i\\tilde{k}) \\hat{p}\\right) = -\\frac{K}{\\rho}\\tilde{k}^2 \\hat{p} = -c^2 \\tilde{k}^2 \\hat{p}\n$$\n这是一个谐振子方程 $\\frac{d^2\\hat{p}}{dt^2} + (c\\tilde{k})^2 \\hat{p} = 0$，其解以数值角频率 $\\omega_{\\text{num}}$ 振荡，满足：\n$$\n\\omega_{\\text{num}}^2 = c^2 \\tilde{k}^2 \\implies \\omega_{\\text{num}} = c|\\tilde{k}|\n$$\n问题要求计算 $N$ 个连续周期后累积的展开相位误差，定义为：\n$$\n\\Delta\\phi_N = \\left(\\frac{\\omega_{\\text{num}}}{\\omega} - 1\\right) 2\\pi N\n$$\n代入 $\\omega = c|k|$ 和 $\\omega_{\\text{num}} = c|\\tilde{k}|$ 的表达式，我们得到：\n$$\n\\Delta\\phi_N = \\left(\\frac{c|\\tilde{k}|}{c|k|} - 1\\right) 2\\pi N = \\left(\\frac{|\\tilde{k}|}{|k|} - 1\\right) 2\\pi N\n$$\n对于给定的问题设置，模数 $m$ 为非负数，波数 $k = 2\\pi m/L \\ge 0$。反对称格式保证了在奈奎斯特极限以下的波数，$\\tilde{k}$ 与 $k$ 的符号相同，因此我们可以去掉绝对值符号。\n$$\n\\Delta\\phi_N = \\left(\\frac{\\tilde{k}}{k} - 1\\right) 2\\pi N\n$$\n比值 $\\tilde{k}/k$ 可以用无量纲波数 $\\alpha = k\\Delta x$ 表示：\n$$\n\\frac{\\tilde{k}}{k} = \\frac{1}{k} \\left( \\frac{2}{\\Delta x} \\sum_{j=1}^{J} a_j \\sin(kj\\Delta x) \\right) = \\frac{2}{k\\Delta x} \\sum_{j=1}^{J} a_j \\sin(j(k\\Delta x)) = \\frac{2}{\\alpha} \\sum_{j=1}^{J} a_j \\sin(j\\alpha)\n$$\n对于每个测试用例，我们计算参数 $L, c, M, m, N$，这些参数决定了 $\\Delta x = L/M$ 和 $k=2\\pi m/L$。然后我们计算 $\\alpha = k\\Delta x = 2\\pi m/M$。使用适当的格式系数 $\\{a_j\\}$，我们计算比值 $\\tilde{k}/k$，并随后计算相位误差 $\\Delta\\phi_N$。\n\n具体的格式系数是：\n- 二阶中心差分：$J=1$，$a_1 = 0.5$。\n- 四阶中心差分：$J=2$，$a_1 = 2/3 \\approx 0.6666666666666666$，$a_2 = -1/12 \\approx -0.08333333333333333$。\n- 七点 DRP：$J=3$，$a_1 = 0.770882380518225$，$a_2 = -0.166705904414580$，$a_3 = 0.020843142770311$。\n\n通过将这些公式直接应用于每个测试用例来进行计算。\n对于一个给定的测试用例 $(\\text{格式类型}, L, c, M, m, N)$：\n1. 计算 $\\alpha = 2\\pi m / M$。\n2. 为指定的格式选择系数 $a_j$。\n3. 如果 $\\alpha=0$，则比值 $\\tilde{k}/k = 1$。如果 $\\alpha \\neq 0$，则计算比值 $\\frac{\\tilde{k}}{k} = \\frac{2}{\\alpha} \\sum_{j=1}^{J} a_j \\sin(j\\alpha)$。\n4. 计算相位误差 $\\Delta\\phi_N = (\\tilde{k}/k - 1)2\\pi N$。\n该过程得出所需的数值结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the accumulated unwrapped phase error for several\n    semi-discrete acoustic simulation test cases.\n    \"\"\"\n    \n    # Stencil coefficients for the discrete first derivative operator.\n    # D[u]_n = (1/dx) * sum_{j=1 to J} a_j * (u_{n+j} - u_{n-j})\n    stencils = {\n        \"second-order\": {\n            \"J\": 1,\n            \"a\": [0.5]\n        },\n        \"fourth-order\": {\n            \"J\": 2,\n            \"a\": [0.6666666666666666, -0.08333333333333333]\n        },\n        \"seven-point-drp\": {\n            \"J\": 3,\n            \"a\": [0.770882380518225, -0.166705904414580, 0.020843142770311]\n        }\n    }\n\n    # Test suite of parameter sets (stencil_name, L, c, M, m, N)\n    test_cases = [\n        # Case A\n        (\"seven-point-drp\", 1.0, 340.0, 256, 4, 1000),\n        # Case B\n        (\"seven-point-drp\", 1.0, 340.0, 256, 1, 10000),\n        # Case C\n        (\"second-order\", 1.0, 340.0, 128, 64, 5),\n        # Case D\n        (\"fourth-order\", 1.0, 340.0, 48, 9, 800),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        stencil_name, L, c, M, m, N = case\n        \n        # Calculate derived physical and numerical parameters\n        # delta_x = L / M\n        # k = 2 * np.pi * m / L\n        # alpha is the dimensionless wavenumber k * delta_x\n        # which simplifies to 2 * pi * m / M\n        alpha = 2 * np.pi * m / M\n        \n        stencil_data = stencils[stencil_name]\n        a_coeffs = stencil_data[\"a\"]\n        \n        # Calculate the ratio of numerical to exact frequency, which equals\n        # the ratio of modified to exact wavenumber, k_tilde / k.\n        \n        # Handle the case alpha = 0 to avoid division by zero, though not\n        # present in test cases. For alpha-0, k_tilde/k - 1.\n        if alpha == 0:\n            ratio_k_tilde_over_k = 1.0\n        else:\n            # Calculate the sum term for the modified wavenumber formula\n            sum_term = 0.0\n            for j, a_j in enumerate(a_coeffs, 1):\n                sum_term += a_j * np.sin(j * alpha)\n            \n            # The ratio k_tilde/k = (2/alpha) * sum(...)\n            ratio_k_tilde_over_k = 2 * sum_term / alpha\n\n        # Calculate the unwrapped accumulated phase error\n        # delta_phi_N = (omega_num/omega - 1) * 2 * pi * N\n        # which is (k_tilde/k - 1) * 2 * pi * N\n        phase_error = (ratio_k_tilde_over_k - 1) * 2 * np.pi * N\n        \n        results.append(phase_error)\n\n    # Format output as a list of strings with 10 decimal places.\n    formatted_results = [f\"{res:.10f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}