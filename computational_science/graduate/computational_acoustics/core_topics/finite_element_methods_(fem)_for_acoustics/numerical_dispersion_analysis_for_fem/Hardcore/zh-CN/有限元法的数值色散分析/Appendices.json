{
    "hands_on_practices": [
        {
            "introduction": "这项基础练习将带领我们回到一维波动方程，这是理解有限元法（FEM）离散化如何引入相位误差的最简单情景。通过从弱形式和单元矩阵出发，推导离散色散关系并进行低频（小 $kh$）近似，你将能亲手揭示线性元在一致质量矩阵下“相位超前”的特性。这项练习旨在训练色散分析的核心技能：推导并分析数值相速度的领先阶误差项。",
            "id": "4132541",
            "problem": "考虑在声速为 $c$ 的均匀介质中的一维声波传播，其声压 $p(x,t)$ 由偏微分方程 $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$ 建模。使用有限元法 (FEM)，通过标准线性 Lagrange 基函数，在尺寸为 $h$ 的均匀网格上对空间域进行离散，并使用一致质量矩阵。假设一个空间周期性设置，并在 Bloch 波拟设 $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$ 下分析半离散系统（时间连续，空间离散），其中 $j \\in \\mathbb{Z}$ 是网格节点的索引，$\\omega$ 是角频率，$\\varphi$ 是每个单元的 Bloch 相位，以弧度为单位。\n\n从弱形式和单元矩阵出发，推导连接连续波数 $k = \\omega / c$ 和 Bloch 相位 $\\varphi$ 的半离散色散关系，并用它来获得离散相速度比 $c_{p}/c$ 关于小 $kh$ 的展开式，其中 $c_{p} = \\omega / \\kappa$ 且 $\\kappa = \\varphi / h$。证明对于足够小的 $kh$，有\n$$\n\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right),\n$$\n并确定使用一致质量矩阵的线性单元的常数 $\\alpha$。将 $\\alpha$ 的最终值表示为一个无单位的最简有理数。角度（Bloch 相位 $\\varphi$）必须以弧度处理。",
            "solution": "用户想要解决一个关于一维波动方程的有限元法 (FEM) 的数值色散问题。\n\n### 第 1 步：提取已知条件\n-   **控制方程**：一维声波方程为 $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$。\n-   **物理参数**：介质是均匀的，声速 $c$ 为常数。\n-   **离散化方法**：使用单元尺寸为 $h$ 的均匀网格。空间近似在 FEM 框架内采用标准线性 Lagrange 基函数。使用一致质量矩阵。\n-   **边界条件**：设置为空间周期性。\n-   **分析拟设**：假设一个半离散 Bloch 波解 $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$，其中 $p_j(t)$ 是节点 $j$ 处的压力，$\\omega$ 是角频率，$\\varphi$ 是每个单元的 Bloch 相位（以弧度为单位）。\n-   **定义**：\n    -   连续波数：$k = \\omega / c$。\n    -   数值波数：$\\kappa = \\varphi / h$。\n    -   数值相速度：$c_{p} = \\omega / \\kappa$。\n-   **目标**：\n    1.  推导半离散色散关系。\n    2.  求出相速度比 $c_{p}/c$ 的小 $kh$ 展开。\n    3.  证明展开式具有形式 $\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right)$。\n    4.  确定常数 $\\alpha$。\n    5.  将 $\\alpha$ 表示为最简有理数。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，是偏微分方程数值分析（特别是计算声学）中的一个标准课题。问题是适定的，提供了所有必要信息（偏微分方程、离散化方法、基函数、质量矩阵类型和分析拟设）来唯一确定所求的常数 $\\alpha$。术语精确客观。没有矛盾、缺失数据或不科学的前提。该问题是推导和分析数值格式性质的一个非平凡的练习。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解法。\n\n### 解法推导\n\n求解过程从控制偏微分方程的弱形式开始，接着进行有限元离散以求得单元矩阵，然后组装系统方程，应用 Bloch 波拟设推导色散关系，最后进行泰勒级数展开以求得所要求的常数 $\\alpha$。\n\n**1. 弱形式**\n波动方程为 $p_{tt} - c^2 p_{xx} = 0$。我们乘以一个检验函数 $v(x)$ 并在域 $\\Omega$ 上积分。\n$$ \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial t^{2}} \\, \\mathrm{d}x - c^2 \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial x^{2}} \\, \\mathrm{d}x = 0 $$\n对第二项进行分部积分可得：\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, \\mathrm{d}x + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, \\mathrm{d}x - c^2 \\left[v \\frac{\\partial p}{\\partial x}\\right]_{\\partial\\Omega} = 0 $$\n对于周期性域，在组装全局系统时，边界项会相互抵消。待离散的弱形式为：\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, \\mathrm{d}x + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, \\mathrm{d}x = 0 $$\n\n**2. 有限元离散和单元矩阵**\n我们在长度为 $h$ 的通用单元 $e = [x_j, x_{j+1}]$ 上使用线性 Lagrange 基函数。在局部坐标 $\\xi = (x - x_j)/h \\in [0, 1]$ 中，基函数为 $N_1(\\xi) = 1-\\xi$ 和 $N_2(\\xi) = \\xi$。它们关于 $x$ 的导数为 $\\frac{\\mathrm{d}N_1}{\\mathrm{d}x} = -\\frac{1}{h}$ 和 $\\frac{\\mathrm{d}N_2}{\\mathrm{d}x} = \\frac{1}{h}$。压力场近似为 $p^h(x,t) = \\sum_{j} p_j(t) N_j(x)$。\n\n半离散系统具有形式 $M \\ddot{\\mathbf{p}} + K \\mathbf{p} = \\mathbf{0}$。长度为 $h$ 的单元的单元矩阵为：\n\n-   **一致单元质量矩阵 ($M^e$)**：\n    $M^e_{ik} = \\int_{e} N_i N_k \\, \\mathrm{d}x = h \\int_0^1 N_i(\\xi) N_k(\\xi) \\, \\mathrm{d}\\xi$。\n    $$ M^e = h \\begin{pmatrix} \\int_0^1 (1-\\xi)^2 \\mathrm{d}\\xi  \\int_0^1 (1-\\xi)\\xi \\mathrm{d}\\xi \\\\ \\int_0^1 \\xi(1-\\xi) \\mathrm{d}\\xi  \\int_0^1 \\xi^2 \\mathrm{d}\\xi \\end{pmatrix} = h \\begin{pmatrix} 1/3  1/6 \\\\ 1/6  1/3 \\end{pmatrix} = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} $$\n-   **单元刚度矩阵 ($K^e$)**：\n    $K^e_{ik} = c^2 \\int_e \\frac{\\mathrm{d}N_i}{\\mathrm{d}x}\\frac{\\mathrm{d}N_k}{\\mathrm{d}x} \\, \\mathrm{d}x$。\n    $$ K^e = c^2 \\int_0^h \\begin{pmatrix} (-1/h)^2  (-1/h)(1/h) \\\\ (1/h)(-1/h)  (1/h)^2 \\end{pmatrix} \\mathrm{d}x = \\frac{c^2}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} $$\n\n**3. 节点 $j$ 的组装和方程**\n节点 $j$ 的方程是通过将来自单元 $j-1$（连接节点 $j-1, j$）和单元 $j$（连接节点 $j, j+1$）的贡献相加得到的。\n-   质量项：$\\frac{h}{6}(\\ddot{p}_{j-1} + 2\\ddot{p}_j) + \\frac{h}{6}(2\\ddot{p}_j + \\ddot{p}_{j+1}) = \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1})$。\n-   刚度项：$\\frac{c^2}{h}(-p_{j-1} + p_j) + \\frac{c^2}{h}(p_j - p_{j+1}) = \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1})$。\n\n组装后的节点 $j$ 的半离散方程为：\n$$ \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1}) + \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1}) = 0 $$\n\n**4. 色散分析**\n我们代入 Bloch 波拟设 $p_j(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$。这意味着 $\\ddot{p}_j = -\\omega^2 p_j$，$p_{j-1} = p_j e^{-i\\varphi}$ 和 $p_{j+1} = p_j e^{i\\varphi}$。代入并除以 $p_j$：\n$$ -\\omega^2 \\frac{h}{6}(e^{-i\\varphi} + 4 + e^{i\\varphi}) + \\frac{c^2}{h}(-e^{-i\\varphi} + 2 - e^{i\\varphi}) = 0 $$\n使用欧拉恒等式 $e^{i\\varphi} + e^{-i\\varphi} = 2\\cos\\varphi$:\n$$ -\\omega^2 \\frac{h}{6}(2\\cos\\varphi + 4) + \\frac{c^2}{h}(2 - 2\\cos\\varphi) = 0 $$\n$$ -\\omega^2 \\frac{h}{3}(2 + \\cos\\varphi) + \\frac{2c^2}{h}(1 - \\cos\\varphi) = 0 $$\n解出 $\\omega^2$ 得到色散关系：\n$$ \\omega^2 = \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\n\n**5. 相速度展开**\n数值相速度为 $c_p = \\omega/\\kappa = \\omega h / \\varphi$。与精确速度之比为 $c_p/c = \\omega h/(c\\varphi)$。将此比率平方并代入色散关系可得：\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{\\omega^2 h^2}{c^2 \\varphi^2} = \\frac{h^2}{c^2 \\varphi^2} \\left( \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} \\right) = \\frac{6}{\\varphi^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\n我们对小 $\\varphi$ 展开此表达式。相关的泰勒级数为：\n$\\cos\\varphi = 1 - \\frac{\\varphi^2}{2!} + \\frac{\\varphi^4}{4!} - \\mathcal{O}(\\varphi^6)$。\n$$ 1 - \\cos\\varphi = \\frac{\\varphi^2}{2} - \\frac{\\varphi^4}{24} + \\mathcal{O}(\\varphi^6) $$\n$$ 2 + \\cos\\varphi = 3 - \\frac{\\varphi^2}{2} + \\mathcal{O}(\\varphi^4) $$\n该比率变为：\n$$ \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} = \\frac{\\frac{\\varphi^2}{2} (1 - \\frac{\\varphi^2}{12} + \\ldots)}{3 (1 - \\frac{\\varphi^2}{6} + \\ldots)} = \\frac{\\varphi^2}{6} \\left(1 - \\frac{\\varphi^2}{12}\\right) \\left(1 + \\frac{\\varphi^2}{6}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} \\left(1 + \\frac{\\varphi^2}{12}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) $$\n将此代回 $(c_p/c)^2$ 的表达式中：\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{6}{\\varphi^2} \\left( \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) \\right) = 1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4) $$\n取平方根（对小 $x$ 使用 $\\sqrt{1+x} \\approx 1 + x/2$）：\n$$ \\frac{c_p}{c} = \\sqrt{1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4)} = 1 + \\frac{1}{2} \\left( \\frac{\\varphi^2}{12} \\right) + \\mathcal{O}(\\varphi^4) = 1 + \\frac{\\varphi^2}{24} + \\mathcal{O}(\\varphi^4) $$\n为了用 $kh$ 来表示，我们将 $\\varphi$ 和 $kh$ 联系起来。由色散关系可知，$(kh)^2 = (\\omega h/c)^2 = 6 \\frac{1-\\cos\\varphi}{2+\\cos\\varphi}$。\n$$(kh)^2 = 6 \\left(\\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6)\\right) = \\varphi^2 + \\frac{\\varphi^4}{12} + \\mathcal{O}(\\varphi^6)$$\n对于小值，$\\varphi^2 = (kh)^2 + \\mathcal{O}((kh)^4)$。将其代入 $c_p/c$ 的展开式中：\n$$ \\frac{c_p}{c} = 1 + \\frac{(kh)^2 + \\mathcal{O}((kh)^4)}{24} + \\mathcal{O}((kh)^4) = 1 + \\frac{1}{24} (kh)^2 + \\mathcal{O}((kh)^4) $$\n这个表达式代表了相位超前现象 ($c_p > c$)。\n\n**6. $\\alpha$ 的确定**\n我们必须将我们推导出的展开式与问题陈述中给出的形式进行匹配：\n$$ \\frac{c_p}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right) $$\n通过比较 $(kh)^2$ 项的系数，我们得到：\n$$ 1 + \\frac{1}{24}(kh)^2 = 1 - \\alpha(kh)^2 $$\n$$ \\frac{1}{24} = -\\alpha $$\n因此，常数 $\\alpha$ 为：\n$$ \\alpha = -\\frac{1}{24} $$\n该值是一个最简有理数，符合要求。",
            "answer": "$$\\boxed{-\\frac{1}{24}}$$"
        },
        {
            "introduction": "在掌握了一维分析的基础后，我们将进入更实际的二维情景，并引入一个关键概念：数值各向异性，即数值波速依赖于其相对于网格的传播方向。该练习旨在比较有限元法（FEM）与另一种常用方法——有限差分法（FDM）在处理二维问题时的色散特性。通过分析沿网格对角线方向传播的平面波，你将发现一个关于两种方法性能的有趣结论，从而加深对网格结构如何影响仿真精度的理解。",
            "id": "4132483",
            "problem": "考虑在均匀、无损的二维介质中的时谐声学问题，其中复压强场 $p$ 满足亥姆霍兹方程 $-\\nabla^{2} p - k^{2} p = 0$，其中波数 $k  0$ 为实数。一个平面波以相对于笛卡尔网格轴 $45^\\circ$ 的角度传播。\n\n我们考虑在同一个间距为 $h$ 的均匀方形网格上的两种标准空间离散化方法：\n- 拉普拉斯算子的二阶五点有限差分（FD）格式，以及\n- 采用一致质量矩阵的双线性连续伽辽金有限元法（FEM）。\n\n对于每种离散化方法，将数值波数大小 $\\xi$ 定义为离散相位向量的模，该向量满足以 $45^\\circ$ 方向（即具有相等的笛卡尔分量）传播的平面波所对应的离散色散关系。将相位误差定义为相对波数误差的大小 $E = |\\xi - k|/k$。\n\n假设 FD 和 FEM 每波长的自由度（DOFs）相等，通过每波长点数（PPW）$Q = 2 \\pi / (k h)$ 来量化。在 $Q$ 很大（等效于 $k h$ 很小）的高分辨率区域中，从亥姆霍兹方程和各自的离散算子出发，根据第一性原理推导 FD 和 FEM 中以 $45^\\circ$ 传播的波的 $E$ 的主阶渐近表达式，该表达式应纯粹用 $Q$ 和 $\\pi$ 表示。本问题中的角度均以度为单位。最终答案必须是一个单行向量，按顺序包含 FD 和 FEM 的相位误差大小。答案是无量纲的，无需四舍五入。",
            "solution": "我们从均匀介质的亥姆霍兹方程 $-\\nabla^{2} p - k^{2} p = 0$ 开始。对于一个以 $45^\\circ$ 传播的平面波 $p(\\boldsymbol{x}) = \\exp(\\mathrm{i} \\boldsymbol{k} \\cdot \\boldsymbol{x})$，其中 $|\\boldsymbol{k}| = k$，其连续波数分量满足 $k_{x} = k/\\sqrt{2}$ 和 $k_{y} = k/\\sqrt{2}$。\n\n我们对每种格式分析由离散平面波 $u_{m,n} = \\exp\\left( \\mathrm{i} (m \\theta_{x} + n \\theta_{y}) \\right)$ 满足的离散色散关系，其中 $\\theta_{x} = \\xi_{x} h$ 和 $\\theta_{y} = \\xi_{y} h$ 是与网格间距 $h$ 相关联的离散相角，$\\boldsymbol{\\xi}$ 是数值波数向量。对于 $45^\\circ$ 传播，我们设定 $\\xi_{x} = \\xi/\\sqrt{2}$ 和 $\\xi_{y} = \\xi/\\sqrt{2}$，因此 $\\theta_{x} = \\theta_{y} = \\theta := \\xi h / \\sqrt{2}$。我们将计算 $\\xi$ 作为 $k$ 和 $h$ 的函数，然后构造相位误差 $E = |\\xi - k| / k$。\n\n我们定义每波长点数（PPW）$Q = 2 \\pi / (k h)$，这样无量纲小参数为 $s := k h = 2 \\pi / Q$。我们的目标是对于大 $Q$（小 $s$）情况下 $E$ 的主阶渐近行为。\n\n有限差分（FD）五点拉普拉斯算子：\n对于方形网格上的二阶FD拉普拉斯算子，其傅里叶符号为\n$$\n-(\\Delta_{h} u)(\\theta_{x}, \\theta_{y})\n\\;=\\; \\frac{2}{h^{2}} \\left( 2 - \\cos(\\theta_{x}) - \\cos(\\theta_{y}) \\right).\n$$\n离散亥姆霍兹算子是 $-\\Delta_{h} - k^{2}$，因此离散平面波的FD色散关系为\n$$\n\\frac{2}{h^{2}} \\left( 2 - \\cos(\\theta_{x}) - \\cos(\\theta_{y}) \\right) \\;=\\; k^{2}.\n$$\n对于 $45^\\circ$ 传播，$\\theta_{x} = \\theta_{y} = \\theta$，因此\n$$\n\\frac{2}{h^{2}} \\left( 2 - 2 \\cos(\\theta) \\right) \\;=\\; k^{2},\n\\quad\\text{或}\\quad\n\\frac{4}{h^{2}} \\left( 1 - \\cos(\\theta) \\right) \\;=\\; k^{2}.\n$$\n使用 $1 - \\cos(\\theta) = 2 \\sin^{2}(\\theta/2)$，我们得到\n$$\n\\frac{8}{h^{2}} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; k^{2}.\n$$\n回顾 $\\theta = \\xi h / \\sqrt{2}$，所以\n$$\n\\frac{8}{h^{2}} \\sin^{2}\\!\\left( \\frac{\\xi h}{2 \\sqrt{2}} \\right) \\;=\\; k^{2},\n\\quad\\Rightarrow\\quad\n\\sin^{2}\\!\\left( \\frac{\\xi h}{2 \\sqrt{2}} \\right) \\;=\\; \\frac{k^{2} h^{2}}{8} \\;=\\; \\frac{s^{2}}{8}.\n$$\n当 $s$ 很小时，我们对该式进行关于 $\\xi$ 的渐近求解。令 $\\alpha := \\frac{\\xi h}{\\sqrt{2}}$，则关系式为\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right) \\;=\\; \\frac{s^{2}}{8}.\n$$\n我们对 $\\sin^{2}(\\alpha/2)$ 在 $\\alpha$ 很小时展开：\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right)\n\\;=\\; \\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} + \\mathcal{O}(\\alpha^{6}).\n$$\n这得到\n$$\n\\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} \\;=\\; \\frac{s^{2}}{8} + \\mathcal{O}(s^{6}).\n$$\n根据 $\\alpha = \\frac{\\xi h}{\\sqrt{2}} = \\frac{s}{\\sqrt{2}} \\zeta$，其中 $\\zeta := \\xi/k$，我们发现\n$$\n\\frac{s^{2} \\zeta^{2}}{8} - \\frac{s^{4} \\zeta^{4}}{192} \\;=\\; \\frac{s^{2}}{8} + \\mathcal{O}(s^{6}).\n$$\n两边除以 $s^{2}$ 并保留到 $\\mathcal{O}(s^{2})$ 阶的项：\n$$\n\\frac{\\zeta^{2}}{8} - \\frac{s^{2} \\zeta^{4}}{192} \\;=\\; \\frac{1}{8}.\n$$\n整理得\n$$\n\\zeta^{2} - \\frac{s^{2}}{24} \\zeta^{4} \\;=\\; 1.\n$$\n设 $\\zeta = 1 + a s^{2} + \\mathcal{O}(s^{4})$。代入并保留 $\\mathcal{O}(s^{2})$ 阶项：\n$$\n(1 + 2 a s^{2}) - \\frac{s^{2}}{24} (1) \\;=\\; 1 + \\mathcal{O}(s^{4}),\n$$\n这给出 $2 a - \\frac{1}{24} = 0$，因此 $a = \\frac{1}{48}$。所以\n$$\n\\frac{\\xi - k}{k} \\;=\\; \\zeta - 1 \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\n因此相位误差大小为\n$$\nE_{\\mathrm{FD}} \\;=\\; \\left| \\frac{\\xi - k}{k} \\right| \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\n用 $Q$ 表示，由于 $s = 2 \\pi / Q$，我们得到\n$$\nE_{\\mathrm{FD}} \\;=\\; \\frac{(2 \\pi)^{2}}{48\\, Q^{2}} + \\mathcal{O}(Q^{-4}) \\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\n\n有限元法（FEM）双线性连续伽辽金及一致质量矩阵：\n从弱形式出发：找到 $u$ 使得\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\,\\mathrm{d}\\boldsymbol{x} - k^{2} \\int_{\\Omega} u v \\,\\mathrm{d}\\boldsymbol{x} = 0\n$$\n对所有测试函数 $v$ 成立。在间距为 $h$ 的均匀方形网格上，使用双线性（$Q1$）形函数和一致质量矩阵，组装后的全局算子可以通过一维张量积表示。将均匀 $Q1$ 网格的一维刚度符号和质量符号记为\n$$\nK_{1\\mathrm{D}}(\\theta) \\;=\\; \\frac{4}{h} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right),\n\\qquad\nM_{1\\mathrm{D}}(\\theta) \\;=\\; \\frac{2 h}{3} + \\frac{h}{3} \\cos(\\theta).\n$$\n对于二维双线性情况，刚度符号和质量符号是\n$$\nK(\\theta_{x}, \\theta_{y}) \\;=\\; K_{1\\mathrm{D}}(\\theta_{x}) M_{1\\mathrm{D}}(\\theta_{y}) + M_{1\\mathrm{D}}(\\theta_{x}) K_{1\\mathrm{D}}(\\theta_{y}),\n\\qquad\nM(\\theta_{x}, \\theta_{y}) \\;=\\; M_{1\\mathrm{D}}(\\theta_{x}) M_{1\\mathrm{D}}(\\theta_{y}).\n$$\n离散亥姆霍兹符号是 $A(\\theta_{x}, \\theta_{y}) = K(\\theta_{x}, \\theta_{y}) - k^{2} M(\\theta_{x}, \\theta_{y})$。对于 $45^\\circ$ 传播（$\\theta_{x} = \\theta_{y} = \\theta$），\n$$\nK(\\theta, \\theta) \\;=\\; 2 K_{1\\mathrm{D}}(\\theta) M_{1\\mathrm{D}}(\\theta),\n\\qquad\nM(\\theta, \\theta) \\;=\\; M_{1\\mathrm{D}}(\\theta)^{2}.\n$$\n因此色散关系 $A(\\theta, \\theta) = 0$ 简化为\n$$\n2 K_{1\\mathrm{D}}(\\theta) - k^{2} M_{1\\mathrm{D}}(\\theta) \\;=\\; 0,\n$$\n或明确写为\n$$\n\\frac{8}{h} \\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; k^{2} \\left( \\frac{2 h}{3} + \\frac{h}{3} \\cos(\\theta) \\right).\n$$\n化简并使用 $s = kh$ 可得：\n$$\n\\sin^{2}\\!\\left( \\frac{\\theta}{2} \\right) \\;=\\; \\frac{s^{2}}{24} \\left( 2 + \\cos(\\theta) \\right).\n$$\n回顾 $\\theta = \\xi h / \\sqrt{2} = \\alpha$，和之前一样，其中 $\\alpha = \\frac{s}{\\sqrt{2}} \\zeta$。我们代入小 $\\alpha$ 的展开式\n$$\n\\sin^{2}\\!\\left( \\frac{\\alpha}{2} \\right)\n\\;=\\; \\frac{\\alpha^{2}}{4} - \\frac{\\alpha^{4}}{48} + \\mathcal{O}(\\alpha^{6}),\n\\qquad\n\\cos(\\alpha)\n\\;=\\; 1 - \\frac{\\alpha^{2}}{2} + \\frac{\\alpha^{4}}{24} + \\mathcal{O}(\\alpha^{6}),\n$$\n得到\n$$\n\\frac{s^{2} \\zeta^{2}}{8} - \\frac{s^{4} \\zeta^{4}}{192}\n\\;=\\; \\frac{s^{2}}{24} \\left( 2 + 1 - \\frac{\\alpha^{2}}{2} + \\frac{\\alpha^{4}}{24} \\right)\n\\;=\\; \\frac{s^{2}}{24} \\left( 3 - \\frac{s^{2} \\zeta^{2}}{4} + \\frac{s^{4} \\zeta^{4}}{96} \\right) + \\mathcal{O}(s^{6}).\n$$\n舍去右侧的 $\\mathcal{O}(s^{4})$ 阶项，并在左侧保留 $\\mathcal{O}(s^{2})$ 阶修正项，我们有\n$$\n\\frac{\\zeta^{2}}{8} - \\frac{s^{2} \\zeta^{4}}{192} \\;=\\; \\frac{1}{8} - \\frac{s^{2} \\zeta^{2}}{96}.\n$$\n乘以 192：\n$$\n24 \\zeta^{2} - s^{2} \\zeta^{4} \\;=\\; 24 - 2 s^{2} \\zeta^{2}.\n$$\n整理：\n$$\n24 (\\zeta^{2} - 1) + s^{2} \\left( - \\zeta^{4} + 2 \\zeta^{2} \\right) \\;=\\; 0.\n$$\n设 $\\zeta = 1 + a s^{2} + \\mathcal{O}(s^{4})$，我们计算 $\\zeta^{2} \\approx 1 + 2 a s^{2}$ 和 $\\zeta^{4} \\approx 1 + 4 a s^{2}$，并代入：\n$$\n24 (2 a s^{2}) + s^{2} \\left( -1 - 4 a s^{2} + 2 + 4 a s^{2} \\right) \\;=\\; 0\n\\;\\Rightarrow\\;\n48 a s^{2} + s^{2} (1) \\;=\\; 0.\n$$\n因此 $48 a + 1 = 0$，所以 $a = -\\frac{1}{48}$。所以\n$$\n\\frac{\\xi - k}{k} \\;=\\; \\zeta - 1 \\;=\\; - \\frac{s^{2}}{48} + \\mathcal{O}(s^{4}).\n$$\n相位误差大小为\n$$\nE_{\\mathrm{FEM}} \\;=\\; \\left| \\frac{\\xi - k}{k} \\right| \\;=\\; \\frac{s^{2}}{48} + \\mathcal{O}(s^{4})\n\\;=\\; \\frac{(2 \\pi)^{2}}{48\\, Q^{2}} + \\mathcal{O}(Q^{-4})\n\\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\n\n在每波长自由度相等情况下的比较：\n在 $Q = 2 \\pi / (k h)$ 对两种方法都通用时，以 $45^\\circ$ 传播的波的主阶相位误差大小是相同的：\n$$\nE_{\\mathrm{FD}} \\;=\\; E_{\\mathrm{FEM}} \\;=\\; \\frac{\\pi^{2}}{12\\, Q^{2}} + \\mathcal{O}(Q^{-4}).\n$$\n因此，在 $Q^{-2}$ 的主阶上，FD五点格式和采用一致质量矩阵的双线性FEM在 $45^\\circ$ 方向上产生相同的最大相位误差大小，等于 $\\pi^{2} / (12\\, Q^{2})$。",
            "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{\\pi^{2}}{12\\,Q^{2}}  \\dfrac{\\pi^{2}}{12\\,Q^{2}}\\end{pmatrix}}$$"
        },
        {
            "introduction": "理论推导对于理解特定情况下的误差行为极具启发性，但要全面评估数值格式的各向异性，则需要借助计算工具。这项实践将引导你从“纸笔”分析转向编程实现，通过编写程序来数值求解覆盖所有传播方向的色散关系。你将学会如何量化最坏情况下的相位误差和整体各向异性系数，这些是评估和选择数值方法时至关重要的实用技能。",
            "id": "4132495",
            "problem": "考虑由标量亥姆霍兹方程控制的单色声压场，该方程是通过寻找时谐解从声波方程推导出来的。设声波方程为 $ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} - \\Delta p = 0 $，其中 $ p(\\mathbf{x},t) $ 是声压，$ c $ 是声速，$ \\Delta $ 是拉普拉斯算子。对于角频率为 $ \\omega $ 的时谐场 $ p(\\mathbf{x},t) = \\operatorname{Re}\\{ u(\\mathbf{x}) e^{-i \\omega t} \\} $，其空间振幅 $ u(\\mathbf{x}) $ 满足亥姆霍兹方程 $ -\\Delta u - k^2 u = 0 $，其中 $ k = \\omega / c $ 是连续波数。在一个具有间距 $ h $ 的无限、均匀结构化方形网格上，考虑使用双线性四边形单元 ($ Q_1 $) 的有限元法 (FEM)。假设周期性，使得组装产生的离散算子具有平移不变性。\n\n从弱形式出发，内部节点的组装全局系统可以用刚度算子 $ \\mathbf{K} $ 和质量算子 $ \\mathbf{M} $ 表示为 $ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $。对于均匀方形网格和 $ Q_1 $ 单元，组装的刚度算子 $ \\mathbf{K} $ 是一个等效于标准二阶有限差分拉普拉斯算子的五点模板，而一致质量算子 $ \\mathbf{M} $ 是一个九点模板。考虑一个平面波拟设 $ u_{i,j} = e^{i (i \\zeta_x + j \\zeta_y)} $，其中 $ \\zeta_x = \\zeta \\cos \\theta $，$ \\zeta_y = \\zeta \\sin \\theta $，且 $ \\zeta = \\kappa h $ 是无量纲的离散波数大小。五点模板的刚度算子的符号为 $ S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y) $。对于一致 $ Q_1 $ 质量矩阵，在单位正方形上使用参考单元形函数 $ N_1 = (1-x)(1-y) $、$ N_2 = x(1-y) $、$ N_3 = xy $、$ N_4 = (1-x)y $，可获得单元级积分 $ \\int N_1^2 \\, \\mathrm{d}x \\mathrm{d}y = \\frac{1}{9} $、$ \\int N_1 N_2 \\, \\mathrm{d}x \\mathrm{d}y = \\frac{1}{18} $、$ \\int N_1 N_3 \\, \\mathrm{d}x \\mathrm{d}y = \\frac{1}{36} $、$ \\int N_1 N_4 \\, \\mathrm{d}x \\mathrm{d}y = \\frac{1}{18} $，并且通过对称性，内部节点的完整一致质量模板在中心点的权重为 $ w_0 = \\frac{4 h^2}{9} $，在轴向相邻点的权重为 $ w_1 = \\frac{h^2}{9} $，在对角相邻点的权重为 $ w_2 = \\frac{h^2}{36} $。因此，质量算子的符号为 $ M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y $。\n\n对平面波施加 $ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $ 得到离散色散关系\n$$\nS(\\zeta_x,\\zeta_y) - (k h)^2 M(\\zeta_x,\\zeta_y) = 0,\n$$\n其中 $ S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y) $ 且 $ M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y $，而 $ \\zeta_x = \\zeta \\cos \\theta $ 和 $ \\zeta_y = \\zeta \\sin \\theta $。数值相速度 $ c_{\\mathrm{num}}(\\theta) $ 定义为 $ \\omega = c_{\\mathrm{num}}(\\theta) \\kappa(\\theta) $，而连续相速度为 $ c_{\\mathrm{cont}} = \\omega / k $。对于给定方向 $ \\theta $，数值相速度与连续相速度之比为\n$$\n\\frac{c_{\\mathrm{num}}(\\theta)}{c_{\\mathrm{cont}}} = \\frac{k}{\\kappa(\\theta)} = \\frac{k h}{\\zeta(\\theta)}.\n$$\n定义角相速度相对误差为\n$$\nE(\\theta) = \\left| \\frac{k h}{\\zeta(\\theta)} - 1 \\right|,\n$$\n以及所有方向上的最坏情况角误差为\n$$\nE_{\\mathrm{worst}}(k h) = \\max_{\\theta \\in [0,\\pi/2]} E(\\theta),\n$$\n其中 $ \\theta $ 以弧度为单位。为量化网格引起的各向异性，定义各向异性系数为\n$$\nA(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} - \\min_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)}.\n$$\n\n您的任务是实现一个程序，对于指定的无量纲波数 $ k h $ 值，通过在区间 $ \\zeta \\in (0,\\pi] $ 上使用稳健的求根方法对每个 $ \\theta \\in [0,\\pi/2] $ 数值求解色散关系来计算 $ \\zeta(\\theta) $，评估 $ E_{\\mathrm{worst}}(k h) $，并评估 $ A(k h) $。使用在 $ [0,\\pi/2] $ 上均匀间隔的 $ N_\\theta = 721 $ 个角采样点（包括端点），并以弧度处理 $ \\theta $。解必须是无量纲的，最终的数值输出必须是四舍五入到八位小数的浮点数。\n\n测试套件：\n- 情况 1：$ k h = \\pi/60 $。\n- 情况 2：$ k h = \\pi/12 $。\n- 情况 3：$ k h = \\pi/6 $。\n\n对于每种情况，生成一个包含 $ [ E_{\\mathrm{worst}}(k h), A(k h) ] $ 的双元素列表，其中元素为小数（无百分号）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一种情况，并且本身是一个双元素列表。例如，输出格式应类似于 $ [ [x_1,y_1],[x_2,y_2],[x_3,y_3] ] $，但使用实际数值且元素之间没有空格。所有角度必须全程以弧度处理。",
            "solution": "首先评估问题的有效性。\n\n### 步骤 1：提取已知条件\n- **控制方程**：声波方程 $ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} - \\Delta p = 0 $，导出时谐解的亥姆霍兹方程 $ -\\Delta u - k^2 u = 0 $，其中 $ k = \\omega/c $。\n- **离散化方法**：在间距为 $ h $ 的均匀方形网格上，使用双线性四边形 ($ Q_1 $) 单元的有限元法 (FEM)。\n- **离散系统**：$ \\mathbf{K} u - k^2 \\mathbf{M} u = 0 $，其中 $ \\mathbf{K} $ 是刚度算子，$ \\mathbf{M} $ 是质量算子。\n- **平面波拟设**：$ u_{i,j} = e^{i (i \\zeta_x + j \\zeta_y)} $，其中无量纲波数为 $ \\zeta_x = \\zeta \\cos \\theta $ 和 $ \\zeta_y = \\zeta \\sin \\theta $，且 $ \\zeta = \\kappa h $。\n- **算子符号**：\n  - 刚度符号：$ S(\\zeta_x,\\zeta_y) = 4 - 2 (\\cos \\zeta_x + \\cos \\zeta_y) $。\n  - 质量符号：$ M(\\zeta_x,\\zeta_y) = \\frac{4}{9} + \\frac{2}{9}(\\cos \\zeta_x + \\cos \\zeta_y) + \\frac{1}{9} \\cos \\zeta_x \\cos \\zeta_y $。\n- **离散色散关系**：$ S(\\zeta_x,\\zeta_y) - (k h)^2 M(\\zeta_x,\\zeta_y) = 0 $。\n- **待计算量**：\n  - 相速度比：$ \\frac{c_{\\mathrm{num}}(\\theta)}{c_{\\mathrm{cont}}} = \\frac{k h}{\\zeta(\\theta)} $。\n  - 最坏情况角相速度相对误差：$ E_{\\mathrm{worst}}(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\left| \\frac{k h}{\\zeta(\\theta)} - 1 \\right| $。\n  - 各向异性系数：$ A(k h) = \\max_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} - \\min_{\\theta \\in [0,\\pi/2]} \\frac{k h}{\\zeta(\\theta)} $。\n- **数值参数**：\n  - 角域：$ \\theta \\in [0,\\pi/2] $ (弧度)。\n  - 角采样：$ N_\\theta = 721 $ 个均匀间隔点。\n  - $ \\zeta $ 的求根域：$ \\zeta \\in (0,\\pi] $。\n  - 输出格式：四舍五入到八位小数的浮点数。\n- **测试套件**：\n  - 情况 1：$ k h = \\pi/60 $。\n  - 情况 2：$ k h = \\pi/12 $。\n  - 情况 3：$ k h = \\pi/6 $。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述描述了有限元格式的标准数值色散分析，这是计算声学和波传播中的常见程序。\n- **科学依据**：从波方程到亥姆霍兹方程的推导、有限元系统的构建以及平面波拟设（冯·诺依曼分析的一种形式）的使用都是标准且科学上合理的原则。对于均匀方形网格上的 $ Q_1 $ 单元，所提供的刚度与质量算子的模板及其相应符号是正确的。\n- **适定性**：对于任何给定的有效输入 $ k h \\in \\mathbb{R}^+ $ 和 $ \\theta \\in [0, \\pi/2] $，色散关系是关于单个未知数 $ \\zeta $ 的单个超越方程。分析表明，对于小的 $ k h $，存在唯一解 $ \\zeta \\approx k h $。函数 $ F(\\zeta) = S - (kh)^2 M $ 在指定的搜索区间 $ (0, \\pi] $ 上是连续且表现良好的。可以证明 $ F(\\zeta) $ 在此区间上会变号，根据介值定理确保了根的存在。因此，可以可靠地使用稳健的数值求根器。\n- **客观与完整**：问题使用了精确的数学语言进行陈述。解决问题所需的所有必要方程、定义、常数和数值参数都已提供。问题是自洽且客观的。\n\n### 步骤 3：结论与行动\n问题是科学上合理、适定且完整的。判定为**有效**。\n\n### 求解推导\n\n问题的核心是分析亥姆霍兹方程的 $Q_1$ 有限元格式的数值色散特性。这需要针对固定的连续波数 $ k $，求解作为传播角度 $ \\theta $ 函数的无量纲离散波数 $ \\zeta $ 的离散色散关系。\n\n对于给定的无量纲连续波数 $ k h $ 和传播角度 $ \\theta $，我们必须找到以下超越方程的根 $ \\zeta $：\n$$\nf(\\zeta; k h, \\theta) = S(\\zeta \\cos \\theta, \\zeta \\sin \\theta) - (k h)^2 M(\\zeta \\cos \\theta, \\zeta \\sin \\theta) = 0\n$$\n通常情况下，这个方程无法解析地求解 $ \\zeta $。因此，必须采用数值方法。我们将角域 $ \\theta \\in [0, \\pi/2] $ 离散化为 $ N_\\theta = 721 $ 个均匀间隔的点。对于每个采样角 $ \\theta_i $，我们将使用数值求根算法求解方程 $ f(\\zeta; k h, \\theta_i) = 0 $ 以得到 $ \\zeta_i = \\zeta(\\theta_i) $。\n\n问题指定在区间 $ (0, \\pi] $ 内搜索 $ \\zeta $。一个适合且稳健的算法是 Brent-Dekker 方法（SciPy 优化库中的 `brentq`），只要给定一个包围区间 $ [a, b] $，其中 $ f(a) $ 和 $ f(b) $ 符号相反，该方法就能保证收敛。\n让我们在搜索域的边界分析函数 $ f(\\zeta) $：\n1.  当 $ \\zeta \\to 0^+ $ 时，我们可以使用泰勒级数展开：$ \\cos(x) \\approx 1 - x^2/2 $。\n    - $ S(\\zeta_x, \\zeta_y) = 4 - 2(\\cos(\\zeta_x) + \\cos(\\zeta_y)) \\approx \\zeta_x^2 + \\zeta_y^2 = \\zeta^2 $。\n    - $ M(\\zeta_x, \\zeta_y) \\approx 1 $。\n    - 因此，$ f(\\zeta) \\approx \\zeta^2 - (k h)^2 $。对于 $ \\zeta \\to 0^+ $ (特别是当 $ \\zeta \\ll k h $ 时)，$ f(\\zeta) $ 是负的。所以我们可以选择我们的下界 $ a $ 为一个很小的正数，例如 $ 10^{-9} $。\n2.  在 $ \\zeta = \\pi $ 处，对三角函数求值。对于任何 $ \\theta \\in [0, \\pi/2] $ 和测试套件中的小 $ k h $ 值，$ S $ 是一个正数，$ M $ 也是正数。$ (kh)^2 M $ 项将远小于 $ S $，使得 $ f(\\pi) $ 为正。例如，当 $ \\theta=0 $ 时，$ S(\\pi, 0) = 4 $ 且 $ M(\\pi, 0) = 1/3 $，所以对于给定的 $kh$ 值，$ f(\\pi) = 4 - (kh)^2/3  0 $。\n因此，区间 $ [\\epsilon, \\pi] $（其中 $ \\epsilon  0 $ 是一个小数）是求根器的有效包围区间。\n\n一旦计算出所有角度 $ \\theta_i $ 的离散波数集合 $ \\{ \\zeta(\\theta_i) \\} $，我们就可以计算数值相速度与连续相速度之比：\n$$\nR_i = \\frac{k h}{\\zeta(\\theta_i)}\n$$\n有了比值数组 $ \\{R_i\\} $，我们就可以计算最终的度量指标：\n1.  **最坏情况角误差**：这是比值与理想值 $ 1 $ 的最大偏差。\n    $$\n    E_{\\mathrm{worst}}(k h) = \\max_{i} |R_i - 1|\n    $$\n2.  **各向异性系数**：这衡量相速度的方向依赖性，量化为所有角度上比值的总范围。\n    $$\n    A(k h) = \\max_i(R_i) - \\min_i(R_i)\n    $$\n\n总体算法如下：\n1.  初始化一个列表，用于存储每个测试用例的最终结果。\n2.  对于每个给定的 $ k h $ 值：\n    a. 创建一个包含从 $ 0 $ 到 $ \\pi/2 $ 的 $ N_\\theta=721 $ 个角度 $ \\theta_i $ 的数组。\n    b. 对于每个角度 $ \\theta_i $：\n        i. 定义函数 $ f(\\zeta) = f(\\zeta; k h, \\theta_i) $。\n        ii. 在区间 $ [\\epsilon, \\pi] $ 上使用数值求根器（例如 `scipy.optimize.brentq`）找到根 $ \\zeta_i $。\n    c. 收集所有 $ \\zeta_i $ 后，计算比值数组 $ R_i = k h / \\zeta_i $。\n    d. 计算 $ E_{\\mathrm{worst}} = \\max(|R_i - 1|) $ 和 $ A = \\max(R_i) - \\min(R_i) $。\n    e. 将结果四舍五入到 $ 8 $ 位小数并存储。\n3.  将收集到的结果格式化为指定的字符串格式。\n此过程在提供的 Python 代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the numerical dispersion analysis problem for the given test cases.\n    \"\"\"\n\n    def dispersion_function(zeta: float, kh: float, theta: float) - float:\n        \"\"\"\n        The discrete dispersion relation f(zeta) = 0 for given kh and theta.\n\n        Args:\n            zeta (float): The dimensionless discrete wavenumber magnitude (variable).\n            kh (float): The dimensionless continuous wavenumber.\n            theta (float): The propagation angle in radians.\n\n        Returns:\n            float: The value of the dispersion function.\n        \"\"\"\n        zeta_x = zeta * np.cos(theta)\n        zeta_y = zeta * np.sin(theta)\n\n        cos_zx = np.cos(zeta_x)\n        cos_zy = np.cos(zeta_y)\n\n        # Stiffness matrix symbol\n        S = 4.0 - 2.0 * (cos_zx + cos_zy)\n        \n        # Consistent mass matrix symbol\n        M = (4.0/9.0) + (2.0/9.0) * (cos_zx + cos_zy) + (1.0/9.0) * cos_zx * cos_zy\n\n        return S - (kh**2) * M\n\n    def calculate_metrics(kh: float) - list[float]:\n        \"\"\"\n        Calculates E_worst and A for a given dimensionless wavenumber kh.\n\n        Args:\n            kh (float): The dimensionless continuous wavenumber.\n\n        Returns:\n            list[float]: A list containing [E_worst, A] rounded to 8 decimal places.\n        \"\"\"\n        num_angles = 721\n        thetas = np.linspace(0.0, np.pi / 2.0, num_angles)\n        \n        zetas = np.zeros_like(thetas)\n\n        for i, theta in enumerate(thetas):\n            # Define a lambda to be passed to the root-finder, with only zeta as a variable.\n            func_to_solve = lambda z: dispersion_function(z, kh, theta)\n            \n            # The search interval for zeta is (0, pi].\n            # We use a small positive lower bound for the bracketing interval.\n            # a=1e-9 and b=pi forms a valid bracket for brentq.\n            try:\n                zetas[i] = brentq(func_to_solve, 1e-9, np.pi)\n            except ValueError:\n                # This case should not be reached for this well-behaved problem.\n                # It's included as a safety measure.\n                zetas[i] = np.nan\n\n        # Calculate the ratio of numerical to continuous phase velocity\n        # Filter out potential NaNs if brentq failed, although not expected here\n        valid_zetas = zetas[~np.isnan(zetas)]\n        if len(valid_zetas) == 0:\n            return [float('nan'), float('nan')]\n\n        ratios = kh / valid_zetas\n\n        # Worst-case angular error\n        e_worst = np.max(np.abs(ratios - 1.0))\n        \n        # Anisotropy coefficient\n        anisotropy = np.max(ratios) - np.min(ratios)\n\n        return [round(e_worst, 8), round(anisotropy, 8)]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        np.pi/60,\n        np.pi/12,\n        np.pi/6,\n    ]\n\n    all_results = []\n    for kh_val in test_cases:\n        result_pair = calculate_metrics(kh_val)\n        all_results.append(result_pair)\n\n    # Format the final output string exactly as required, with no spaces\n    # between elements, to produce output like [[x1,y1],[x2,y2],...].\n    result_strings = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}