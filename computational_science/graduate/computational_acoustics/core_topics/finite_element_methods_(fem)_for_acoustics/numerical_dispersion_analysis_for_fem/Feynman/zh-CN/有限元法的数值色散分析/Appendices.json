{
    "hands_on_practices": [
        {
            "introduction": "掌握数值色散分析的第一步，是从第一性原理出发，为最典型的案例推导出其色散关系。这项练习将通过分析一维声波方程的标准线性有限元格式，帮助您建立核心的分析技能。通过运用布洛赫波分析和泰勒展开，您将揭示该方法固有的相位误差特性，并理解数值离散化如何导致波速的频率依赖性。",
            "id": "4132541",
            "problem": "考虑声速为 $c$ 的均匀介质中的一维声波传播，其声压 $p(x,t)$ 由偏微分方程 $\\partial^{2} p / \\partial t^{2} = c^{2} \\, \\partial^{2} p / \\partial x^{2}$ 建模。使用有限元法（FEM）中的标准线性拉格朗日基函数，在尺寸为 $h$ 的均匀网格上对空间域进行离散化，并使用一致质量矩阵。假设一个空间周期性设置，并在布洛赫波拟设 $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$ 下分析半离散系统（时间上连续，空间上离散），其中 $j \\in \\mathbb{Z}$ 是网格节点的索引，$\\omega$ 是角频率，$\\varphi$ 是每个单元的布洛赫相位，以弧度为单位。\n\n从弱形式和单元矩阵出发，推导连接连续波数 $k = \\omega / c$ 和布洛赫相位 $\\varphi$ 的半离散色散关系，并用它来获得离散相速度比 $c_{p}/c$ 的小 $kh$ 展开，其中 $c_{p} = \\omega / \\kappa$ 且 $\\kappa = \\varphi / h$。证明对于足够小的 $kh$，有\n$$\n\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right),\n$$\n并确定使用一致质量矩阵的线性单元的常数 $\\alpha$。将 $\\alpha$ 的最终值表示为一个无单位的最简有理数。角度（布洛赫相位 $\\varphi$）必须以弧度处理。",
            "solution": "用户希望解决一个关于一维波动方程的有限元法（FEM）数值色散的问题。\n\n### 步骤 1：提取已知条件\n-   **控制方程**：一维声波方程为 $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$。\n-   **物理参数**：介质是均匀的，具有恒定的声速 $c$。\n-   **离散化方法**：使用单元尺寸为 $h$ 的均匀网格。空间近似采用有限元法框架内的标准线性拉格朗日基函数。使用一致质量矩阵。\n-   **边界条件**：设置为空间周期性。\n-   **分析拟设**：假设一个半离散布洛赫波解 $p_{j}(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$，其中 $p_j(t)$ 是节点 $j$ 处的压力，$\\omega$ 是角频率，$\\varphi$ 是每个单元的布洛赫相位（以弧度为单位）。\n-   **定义**：\n    -   连续波数：$k = \\omega / c$。\n    -   数值波数：$\\kappa = \\varphi / h$。\n    -   数值相速度：$c_{p} = \\omega / \\kappa$。\n-   **目标**：\n    1.  推导半离散色散关系。\n    2.  求相速度比 $c_{p}/c$ 的小 $kh$ 展开。\n    3.  证明该展开具有形式 $\\frac{c_{p}}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right)$。\n    4.  确定常数 $\\alpha$。\n    5.  将 $\\alpha$ 表示为最简有理数。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是偏微分方程数值分析（特别是计算声学）中的一个标准课题。问题提法恰当，提供了所有必要信息（偏微分方程、离散化方法、基函数、质量矩阵类型和分析拟设），足以唯一确定所求常数 $\\alpha$。术语精确客观。没有矛盾、缺失数据或不科学的前提。该问题是推导和分析数值格式性质的一个非平凡的练习。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n\n求解过程从控制偏微分方程的弱形式开始，接着进行有限元离散化以求得单元矩阵，然后组装系统方程，应用布洛赫波拟设推导色散关系，最后进行泰勒级数展开以求得所需的常数 $\\alpha$。\n\n**1. 弱形式**\n波动方程为 $p_{tt} - c^2 p_{xx} = 0$。我们用一个测试函数 $v(x)$ 乘以该方程，并在域 $\\Omega$ 上积分。\n$$ \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial t^{2}} \\, dx - c^2 \\int_{\\Omega} v \\frac{\\partial^{2} p}{\\partial x^{2}} \\, dx = 0 $$\n对第二项进行分部积分得到：\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, dx + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, dx - c^2 \\left[v \\frac{\\partial p}{\\partial x}\\right]_{\\partial\\Omega} = 0 $$\n对于周期域，在组装全局系统时，边界项会抵消。待离散化的弱形式为：\n$$ \\int_{\\Omega} v \\frac{\\partial^2 p}{\\partial t^2} \\, dx + c^2 \\int_{\\Omega} \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} \\, dx = 0 $$\n\n**2. 有限元离散化与单元矩阵**\n我们在长度为 $h$ 的通用单元 $e = [x_j, x_{j+1}]$ 上使用线性拉格朗日基函数。在局部坐标 $\\xi = (x - x_j)/h \\in [0, 1]$ 中，基函数为 $N_1(\\xi) = 1-\\xi$ 和 $N_2(\\xi) = \\xi$。它们关于 $x$ 的导数为 $\\frac{dN_1}{dx} = -\\frac{1}{h}$ 和 $\\frac{dN_2}{dx} = \\frac{1}{h}$。压力场近似为 $p^h(x,t) = \\sum_{j} p_j(t) N_j(x)$。\n\n半离散系统具有形式 $M \\ddot{\\mathbf{p}} + K \\mathbf{p} = \\mathbf{0}$。长度为 $h$ 的单元的单元矩阵为：\n\n-   **一致单元质量矩阵 ($M^e$)**：\n    $M^e_{ik} = \\int_{e} N_i N_k \\, dx = h \\int_0^1 N_i(\\xi) N_k(\\xi) \\, d\\xi$。\n    $$ M^e = h \\begin{pmatrix} \\int_0^1 (1-\\xi)^2 d\\xi   \\int_0^1 (1-\\xi)\\xi d\\xi \\\\ \\int_0^1 \\xi(1-\\xi) d\\xi   \\int_0^1 \\xi^2 d\\xi \\end{pmatrix} = h \\begin{pmatrix} 1/3   1/6 \\\\ 1/6   1/3 \\end{pmatrix} = \\frac{h}{6} \\begin{pmatrix} 2   1 \\\\ 1   2 \\end{pmatrix} $$\n-   **单元刚度矩阵 ($K^e$)**：\n    $K^e_{ik} = c^2 \\int_e \\frac{dN_i}{dx}\\frac{dN_k}{dx} \\, dx$。\n    $$ K^e = c^2 \\int_0^h \\begin{pmatrix} (-1/h)^2   (-1/h)(1/h) \\\\ (1/h)(-1/h)   (1/h)^2 \\end{pmatrix} dx = \\frac{c^2}{h} \\begin{pmatrix} 1   -1 \\\\ -1   1 \\end{pmatrix} $$\n\n**3. 组装与节点 $j$ 的方程**\n通用节点 $j$ 的方程是通过将单元 $j-1$（连接节点 $j-1, j$）和单元 $j$（连接节点 $j, j+1$）的贡献相加得到的。\n-   质量项：$\\frac{h}{6}(\\ddot{p}_{j-1} + 2\\ddot{p}_j) + \\frac{h}{6}(2\\ddot{p}_j + \\ddot{p}_{j+1}) = \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1})$。\n-   刚度项：$\\frac{c^2}{h}(-p_{j-1} + p_j) + \\frac{c^2}{h}(p_j - p_{j+1}) = \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1})$。\n\n组装后的节点 $j$ 的半离散方程为：\n$$ \\frac{h}{6}(\\ddot{p}_{j-1} + 4\\ddot{p}_j + \\ddot{p}_{j+1}) + \\frac{c^2}{h}(-p_{j-1} + 2p_j - p_{j+1}) = 0 $$\n\n**4. 色散分析**\n我们代入布洛赫波拟设 $p_j(t) = \\hat{p} \\exp(i (j \\varphi - \\omega t))$。这意味着 $\\ddot{p}_j = -\\omega^2 p_j$，$p_{j-1} = p_j e^{-i\\varphi}$ 和 $p_{j+1} = p_j e^{i\\varphi}$。代入并除以 $p_j$：\n$$ -\\omega^2 \\frac{h}{6}(e^{-i\\varphi} + 4 + e^{i\\varphi}) + \\frac{c^2}{h}(-e^{-i\\varphi} + 2 - e^{i\\varphi}) = 0 $$\n使用欧拉恒等式 $e^{i\\varphi} + e^{-i\\varphi} = 2\\cos\\varphi$：\n$$ -\\omega^2 \\frac{h}{6}(2\\cos\\varphi + 4) + \\frac{c^2}{h}(2 - 2\\cos\\varphi) = 0 $$\n$$ -\\omega^2 \\frac{h}{3}(2 + \\cos\\varphi) + \\frac{2c^2}{h}(1 - \\cos\\varphi) = 0 $$\n解出 $\\omega^2$ 得到色散关系：\n$$ \\omega^2 = \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\n\n**5. 相速度展开**\n数值相速度为 $c_p = \\omega/\\kappa = \\omega h / \\varphi$。与精确速度之比为 $c_p/c = \\omega h/(c\\varphi)$。将此比率平方并代入色散关系得到：\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{\\omega^2 h^2}{c^2 \\varphi^2} = \\frac{h^2}{c^2 \\varphi^2} \\left( \\frac{6c^2}{h^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} \\right) = \\frac{6}{\\varphi^2} \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} $$\n我们对小 $\\varphi$ 展开此表达式。相关的泰勒级数为：\n$\\cos\\varphi = 1 - \\frac{\\varphi^2}{2!} + \\frac{\\varphi^4}{4!} - \\mathcal{O}(\\varphi^6)$。\n$$ 1 - \\cos\\varphi = \\frac{\\varphi^2}{2} - \\frac{\\varphi^4}{24} + \\mathcal{O}(\\varphi^6) $$\n$$ 2 + \\cos\\varphi = 3 - \\frac{\\varphi^2}{2} + \\mathcal{O}(\\varphi^4) $$\n该比率变为：\n$$ \\frac{1 - \\cos\\varphi}{2 + \\cos\\varphi} = \\frac{\\frac{\\varphi^2}{2} (1 - \\frac{\\varphi^2}{12} + \\ldots)}{3 (1 - \\frac{\\varphi^2}{6} + \\ldots)} = \\frac{\\varphi^2}{6} \\left(1 - \\frac{\\varphi^2}{12}\\right) \\left(1 + \\frac{\\varphi^2}{6}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} \\left(1 + \\frac{\\varphi^2}{12}\\right) + \\mathcal{O}(\\varphi^6) = \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) $$\n将此代回 $(c_p/c)^2$ 的表达式中：\n$$ \\left(\\frac{c_p}{c}\\right)^2 = \\frac{6}{\\varphi^2} \\left( \\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6) \\right) = 1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4) $$\n取平方根（对小 $x$ 使用 $\\sqrt{1+x} \\approx 1 + x/2$）：\n$$ \\frac{c_p}{c} = \\sqrt{1 + \\frac{\\varphi^2}{12} + \\mathcal{O}(\\varphi^4)} = 1 + \\frac{1}{2} \\left( \\frac{\\varphi^2}{12} \\right) + \\mathcal{O}(\\varphi^4) = 1 + \\frac{\\varphi^2}{24} + \\mathcal{O}(\\varphi^4) $$\n为了用 $kh$ 表示，我们关联 $\\varphi$ 和 $kh$。根据色散关系，$(kh)^2 = (\\omega h/c)^2 = 6 \\frac{1-\\cos\\varphi}{2+\\cos\\varphi}$。\n$$(kh)^2 = 6 \\left(\\frac{\\varphi^2}{6} + \\frac{\\varphi^4}{72} + \\mathcal{O}(\\varphi^6)\\right) = \\varphi^2 + \\frac{\\varphi^4}{12} + \\mathcal{O}(\\varphi^6)$$\n对于小值，$\\varphi^2 = (kh)^2 + \\mathcal{O}((kh)^4)$。将此代入 $c_p/c$ 的展开式中：\n$$ \\frac{c_p}{c} = 1 + \\frac{(kh)^2 + \\mathcal{O}((kh)^4)}{24} + \\mathcal{O}((kh)^4) = 1 + \\frac{1}{24} (kh)^2 + \\mathcal{O}((kh)^4) $$\n此表达式表示相位超前现象 ($c_p  c$)。\n\n**6. 确定 $\\alpha$**\n我们必须将我们推导的展开式与问题陈述中给出的形式相匹配：\n$$ \\frac{c_p}{c} = 1 - \\alpha (k h)^{2} + \\mathcal{O}\\!\\left((k h)^{4}\\right) $$\n通过比较 $(kh)^2$ 项的系数，我们得到：\n$$ 1 + \\frac{1}{24}(kh)^2 = 1 - \\alpha(kh)^2 $$\n$$ \\frac{1}{24} = -\\alpha $$\n因此，常数 $\\alpha$ 是：\n$$ \\alpha = -\\frac{1}{24} $$\n该值是一个最简有理数，符合要求。",
            "answer": "$$\\boxed{-\\frac{1}{24}}$$"
        },
        {
            "introduction": "在掌握了基本分析方法后，探索数值实现细节如何从根本上改变方法的特性至关重要。本练习将前一问题中的一致质量矩阵与减缩积分质量矩阵进行对比，揭示了不同计算格式之间的权衡。通过推导减缩积分方案的色散关系，您会发现它与有限差分法之间惊人的联系，从而深刻理解数值方法设计中的微妙之处。",
            "id": "4132507",
            "problem": "考虑在无限、均匀的直线上的一维声波方程，\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n其中波速 $c0$ 为常数。通过节点为 $x_{j} = j h$、网格尺寸为 $h0$ 的均匀网格离散化空间域，并使用每个单元上通常的帽子函数，通过标准的分段线性（$\\mathbb{P}_{1}$）有限元法（FEM）来近似 $u(x,t)$。对刚度矩阵使用标准的Galerkin弱形式及精确积分，对每个单元上的质量矩阵使用降阶（单点Gauss）积分法则。假设无阻尼，在无限网格上具有周期性，并且密度为单位1，使得质量项中不出现额外的物理系数。\n\n设 $\\theta \\in [0,\\pi]$ 表示每个单元的无量纲相位增量（以弧度为单位），并考虑以下形式的Bloch-Floquet平面波解\n$$\nu_{j}(t) = \\widehat{u} \\exp\\!\\big(i (j \\,\\theta - \\omega t)\\big),\n$$\n其中角频率 $\\omega \\ge 0$，振幅 $\\widehat{u} \\neq 0$ 为常数。\n\n从弱形式和参考单元 $\\xi \\in [-1,1]$ 上的单元形函数出发，其中等参映射为 $x(\\xi) = x_{e} + \\frac{h}{2}\\,\\xi$，形函数为 $N_{1}(\\xi) = \\frac{1-\\xi}{2}$，$N_{2}(\\xi) = \\frac{1+\\xi}{2}$，完成以下任务：\n\n- 推导精确的单元刚度矩阵，并组装其贡献以获得离散刚度算子的Fourier符号 $k(\\theta)$。\n- 使用在 $\\xi=0$ 处权重为2的单点Gauss法则，推导降阶积分的单元质量矩阵，将其组装，并获得离散质量算子的Fourier符号 $m_{\\mathrm{RI}}(\\theta)$。\n- 从无限均匀网格上的半离散系统 $M \\ddot{\\mathbf{u}} + c^{2} K \\mathbf{u} = \\mathbf{0}$ 出发，使用平面波拟设来推导降阶积分质量矩阵情况下的离散色散关系 $\\omega(\\theta)$。\n\n将您的最终色散关系表示为一个关于 $\\omega(\\theta)$ 的单一显式解析公式，用 $c$、$h$ 和 $\\theta$（以弧度为单位）表示。最终表达式中不要包含任何单位。您的最终答案必须是单一的闭式表达式。",
            "solution": "该问题要求解使用特定有限元法（FEM）方案离散化后的一维声波方程的数值色散关系。该过程包括推导质量算子和刚度算子的Fourier符号，然后将它们组合起来。\n\n在无限均匀网格上，波动方程的FEM近似的半离散形式由以下常微分方程组给出：\n$$\nM \\ddot{\\mathbf{u}} + c^{2} K \\mathbf{u} = \\mathbf{0}\n$$\n其中 $\\mathbf{u}(t)$ 是节点位移 $u_j(t)$ 的向量，$M$ 是全局质量矩阵，$K$ 是全局刚度矩阵。常数 $c$ 是波速。\n\n我们分析系统对于形式为 $u_{j}(t) = \\widehat{u} \\exp(i (j \\theta - \\omega t))$ 的Bloch-Floquet平面波解的行为，其中 $\\theta$ 是无量纲波数或每个单元的相位增量，$\\omega$ 是角频率。二阶时间导数为 $\\ddot{u}_{j}(t) = -\\omega^2 u_{j}(t)$。\n\n由于网格的均匀性和基函数的局部支撑性，全局矩阵 $M$ 和 $K$ 是Toeplitz矩阵，代表卷积算子。将这些算子应用于平面波解，得到：\n$$\n(K\\mathbf{u})_j = k(\\theta) u_j(t) \\quad \\text{and} \\quad (M\\mathbf{u})_j = m(\\theta) u_j(t)\n$$\n其中 $k(\\theta)$ 和 $m(\\theta)$ 分别是算子 $K$ 和 $M$ 的Fourier符号（或传递函数）。将这些代入半离散系统，得到：\n$$\n(-\\omega^2 m(\\theta) + c^2 k(\\theta)) u_j(t) = 0\n$$\n对于非平凡解（$u_j(t) \\neq 0$），我们必须有：\n$$\n\\omega^2 = c^2 \\frac{k(\\theta)}{m(\\theta)}\n$$\n我们的任务是找到精确积分的刚度矩阵的符号 $k(\\theta)$ 和降阶积分的质量矩阵的符号 $m_{\\mathrm{RI}}(\\theta)$。\n\n**1. 刚度矩阵符号 $k(\\theta)$ 的推导**\n\n对于长度为 $h$ 的单元，单元刚度矩阵 $K^e$ 由其分量定义：\n$$\nK^e_{ab} = \\int_{e} \\frac{d\\phi_a}{dx} \\frac{d\\phi_b}{dx} \\, dx\n$$\n其中 $\\phi_a$ 和 $\\phi_b$ 是单元的局部基函数。我们将此积分变换到参考单元 $\\xi \\in [-1, 1]$。等参映射为 $x(\\xi) = x_e + \\frac{h}{2}\\xi$，其Jacobian为 $dx/d\\xi = h/2$。导数的链式法则是 $\\frac{d}{dx} = \\frac{d\\xi}{dx} \\frac{d}{d\\xi} = \\frac{2}{h} \\frac{d}{d\\xi}$。参考单元上的线性形函数为 $N_1(\\xi) = \\frac{1-\\xi}{2}$ 和 $N_2(\\xi) = \\frac{1+\\xi}{2}$，其导数为 $\\frac{dN_1}{d\\xi} = -1/2$ 和 $\\frac{dN_2}{d\\xi} = 1/2$。\n\n单元矩阵的分量使用精确积分计算：\n$$\nK^e_{ab} = \\int_{-1}^{1} \\left(\\frac{2}{h}\\frac{dN_a}{d\\xi}\\right) \\left(\\frac{2}{h}\\frac{dN_b}{d\\xi}\\right) \\left(\\frac{h}{2} d\\xi\\right) = \\frac{2}{h} \\int_{-1}^{1} \\frac{dN_a}{d\\xi} \\frac{dN_b}{d\\xi} \\, d\\xi\n$$\n- $K^e_{11} = \\frac{2}{h} \\int_{-1}^{1} (-\\frac{1}{2})(-\\frac{1}{2}) \\, d\\xi = \\frac{2}{h} \\cdot \\frac{1}{4} \\cdot [\\xi]_{-1}^{1} = \\frac{1}{2h} \\cdot 2 = \\frac{1}{h}$\n- $K^e_{12} = \\frac{2}{h} \\int_{-1}^{1} (-\\frac{1}{2})(\\frac{1}{2}) \\, d\\xi = \\frac{2}{h} \\cdot (-\\frac{1}{4}) \\cdot [\\xi]_{-1}^{1} = -\\frac{1}{2h} \\cdot 2 = -\\frac{1}{h}$\n- $K^e_{21} = K^e_{12} = -\\frac{1}{h}$\n- $K^e_{22} = \\frac{2}{h} \\int_{-1}^{1} (\\frac{1}{2})(\\frac{1}{2}) \\, d\\xi = \\frac{1}{h}$\n\n单元刚度矩阵为 $K^e = \\frac{1}{h} \\begin{pmatrix} 1   -1 \\\\ -1   1 \\end{pmatrix}$。\n\n为了找到全局算子 $K$ 在节点 $j$ 上的作用，我们组装来自两个相邻单元 $[x_{j-1}, x_j]$ 和 $[x_j, x_{j+1}]$ 的贡献。这得到以下应用于向量 $\\mathbf{u}$ 的离散算子（模板）：\n$$\n(K\\mathbf{u})_j = K^e_{21} u_{j-1} + (K^e_{22} + K^e_{11}) u_j + K^e_{12} u_{j+1} = \\frac{1}{h}(-u_{j-1} + 2u_j - u_{j+1})\n$$\n将此应用于平面波 $u_j = \\exp(ij\\theta)$：\n$$\n(K\\mathbf{u})_j = \\frac{1}{h} \\left(-\\exp(i(j-1)\\theta) + 2\\exp(ij\\theta) - \\exp(i(j+1)\\theta)\\right) \\\\\n= \\frac{\\exp(ij\\theta)}{h} \\left(-\\exp(-i\\theta) + 2 - \\exp(i\\theta)\\right) \\\\\n= \\frac{u_j}{h} (2 - 2\\cos(\\theta)) = \\frac{2}{h}(1 - \\cos(\\theta)) u_j\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$，刚度符号为：\n$$\nk(\\theta) = \\frac{4}{h} \\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n\n**2. 降阶积分质量矩阵符号 $m_{\\mathrm{RI}}(\\theta)$ 的推导**\n\n单元质量矩阵 $M^e$ 定义为 $M^e_{ab} = \\int_{e} \\phi_a \\phi_b \\, dx$。变换到参考单元：\n$$\nM^e_{ab} = \\int_{-1}^{1} N_a(\\xi) N_b(\\xi) \\left(\\frac{h}{2} d\\xi\\right)\n$$\n问题指定了在 $\\xi_1=0$ 处权重为 $w_1=2$ 的单点Gauss求积法则。\n$$\nM^e_{ab} \\approx \\frac{h}{2} \\left[ w_1 N_a(\\xi_1) N_b(\\xi_1) \\right] = \\frac{h}{2} \\left[ 2 \\cdot N_a(0) N_b(0) \\right] = h N_a(0) N_b(0)\n$$\n在单元中心 $\\xi=0$ 处，形函数为 $N_1(0) = 1/2$ 和 $N_2(0) = 1/2$。\n- $M^e_{11} = h (\\frac{1}{2})(\\frac{1}{2}) = \\frac{h}{4}$\n- $M^e_{12} = h (\\frac{1}{2})(\\frac{1}{2}) = \\frac{h}{4}$\n- $M^e_{21} = M^e_{12} = \\frac{h}{4}$\n- $M^e_{22} = h (\\frac{1}{2})(\\frac{1}{2}) = \\frac{h}{4}$\n\n降阶积分的单元质量矩阵为 $M^e_{\\mathrm{RI}} = \\frac{h}{4} \\begin{pmatrix} 1   1 \\\\ 1   1 \\end{pmatrix}$。\n\n组装这个矩阵得到全局质量算子 $M_{\\mathrm{RI}}$ 的模板：\n$$\n(M_{\\mathrm{RI}}\\mathbf{u})_j = M^e_{21} u_{j-1} + (M^e_{22} + M^e_{11}) u_j + M^e_{12} u_{j+1} = \\frac{h}{4}(u_{j-1} + 2u_j + u_{j+1})\n$$\n将此应用于平面波 $u_j = \\exp(ij\\theta)$：\n$$\n(M_{\\mathrm{RI}}\\mathbf{u})_j = \\frac{h}{4} \\left(\\exp(i(j-1)\\theta) + 2\\exp(ij\\theta) + \\exp(i(j+1)\\theta)\\right) \\\\\n= \\frac{h \\exp(ij\\theta)}{4} \\left(\\exp(-i\\theta) + 2 + \\exp(i\\theta)\\right) \\\\\n= \\frac{h u_j}{4} (2 + 2\\cos(\\theta)) = \\frac{h}{2}(1 + \\cos(\\theta)) u_j\n$$\n使用半角恒等式 $1 + \\cos(\\theta) = 2\\cos^2(\\theta/2)$，质量符号为：\n$$\nm_{\\mathrm{RI}}(\\theta) = h \\cos^2\\left(\\frac{\\theta}{2}\\right)\n$$\n\n**3. 色散关系 $\\omega(\\theta)$ 的推导**\n\n最后，我们将推导出的符号 $k(\\theta)$ 和 $m_{\\mathrm{RI}}(\\theta)$ 代入色散关系公式中：\n$$\n\\omega^2 = c^2 \\frac{k(\\theta)}{m_{\\mathrm{RI}}(\\theta)} = c^2 \\frac{\\frac{4}{h} \\sin^2\\left(\\frac{\\theta}{2}\\right)}{h \\cos^2\\left(\\frac{\\theta}{2}\\right)} = \\frac{4c^2}{h^2} \\frac{\\sin^2\\left(\\frac{\\theta}{2}\\right)}{\\cos^2\\left(\\frac{\\theta}{2}\\right)} = \\frac{4c^2}{h^2} \\tan^2\\left(\\frac{\\theta}{2}\\right)\n$$\n取正平方根（因为指定了 $\\omega \\ge 0$，且对于 $\\theta \\in [0, \\pi]$，有 $\\tan(\\theta/2) \\ge 0$）：\n$$\n\\omega(\\theta) = \\sqrt{\\frac{4c^2}{h^2} \\tan^2\\left(\\frac{\\theta}{2}\\right)} = \\frac{2c}{h} \\tan\\left(\\frac{\\theta}{2}\\right)\n$$\n这就是离散色散关系的最终表达式。",
            "answer": "$$\\boxed{\\frac{2c}{h} \\tan\\left(\\frac{\\theta}{2}\\right)}$$"
        },
        {
            "introduction": "本练习将理论分析与实际的仿真规划联系起来，旨在解决计算声学中的一个核心挑战——“污染效应”。该效应指出，随着频率或传播距离的增加，为维持给定精度所需的网格分辨率会急剧提升。通过编写程序来量化此效应，并比较线性和二次单元的性能，您将亲身体验高阶单元在抑制色散和控制计算成本方面的强大优势。",
            "id": "4132492",
            "problem": "考虑均匀介质中的一维声学亥姆霍兹方程，该方程建立在均匀网格上，并使用标准连续伽辽金有限元法（FEM）进行近似。其控制方程为 $-u''(x) - k^2 u(x) = 0$，其中 $k$ 是物理波数，单位为 $\\mathrm{rad/m}$。使用尺寸为 $h$ 的均匀网格，并假设存在形式为 $u(x) = e^{i k x}$ 的周期性弗洛凯-布洛赫波。数值色散关系将每个单元的离散相移（用 $\\zeta$ 表示，单位为弧度）与网格参数 $h$ 和物理波数 $k$ 联系起来。离散数值波数为 $k_{\\mathrm{num}} = \\zeta / h$。\n\n您的任务是分析连续伽辽金有限元法中两种多项式阶次的数值色散：\n- 线性元（多项式次数 $p=1$，节点间距等于单元尺寸 $h$）。\n- 二次元（多项式次数 $p=2$，由于存在边中节点，节点间距等于 $h/2$）。\n\n从弱形式出发，利用弗洛凯-布洛赫拟设，推导每种多项式阶次的色散关系，并用它计算随着物理波数 $k$ 的增加，为保持预设的相误差阈值，每个波长所需的最少自由度数。将“每个波长的自由度”（每个波长的节点数）定义如下：\n- 对于 $p=1$，每个波长的节点数为 $N_{\\lambda}^{(1)} = \\lambda / h$，其中 $\\lambda = 2\\pi/k$ 是物理波长，单位为米。\n- 对于 $p=2$，每个波长的节点数为 $N_{\\lambda}^{(2)} = 2\\lambda / h$，这反映了边中节点的存在。\n\n将在传播长度 $L$ 上累积的总相误差定义为 $\\Delta \\phi = |k_{\\mathrm{num}} - k| L$（单位为弧度），并将周期归一化相误差定义为 $E_{\\mathrm{rel}} = \\Delta \\phi / (2\\pi)$，此为无量纲量。对于给定的 $k$ 和容差 $\\epsilon$，对每个多项式阶次 $p \\in \\{1,2\\}$，确定最小整数 $N_{\\lambda}^{(p)}$，使得 $E_{\\mathrm{rel}} \\le \\epsilon$。所有角度量使用弧度，所有长度量使用米。分析必须基于第一性原理：从亥姆霍兹方程的弱形式开始，组装单元矩阵，并施加弗洛凯-布洛赫条件以获得离散色散关系。请勿假设或引用任何预先推导的色散公式。\n\n按如下方式实现色散计算：\n- 对于 $p=1$，显式推导离散关系，并计算 $\\zeta$ 作为 $k h$ 的函数。\n- 对于 $p=2$，推导每个单元内两种节点类型（端点节点和边中节点）的单元级分块循环关系，构建 $2\\times 2$ 的布洛赫约化刚度矩阵和质量矩阵，并强制广义亥姆霍兹算子的行列式为零，以便对于给定的 $k h$，在区间 $\\zeta \\in (0,\\pi)$ 内数值求解 $\\zeta$。始终选择声学分支（最小的正 $\\zeta$）。\n\n给定固定的传播长度 $L$ 和容差 $\\epsilon$，您必须对整数 $N_{\\lambda}^{(p)}$ 进行搜索，以找到满足 $E_{\\mathrm{rel}} \\le \\epsilon$ 的最小值。应分别对 $p=1$ 和 $p=2$ 进行搜索。\n\n使用以下测试套件，其中 $L=10\\,\\mathrm{m}$：\n1. $k=50\\,\\mathrm{rad/m}$, $\\epsilon=0.01$。\n2. $k=200\\,\\mathrm{rad/m}$, $\\epsilon=0.01$。\n3. $k=200\\,\\mathrm{rad/m}$, $\\epsilon=0.002$。\n4. $k=800\\,\\mathrm{rad/m}$, $\\epsilon=0.005$。\n\n您的程序应生成单行输出，其中包含汇总所有测试用例的结果，形式为方括号内的逗号分隔列表，其中每个条目是包含两个整数 $[N_{\\lambda}^{(1)}, N_{\\lambda}^{(2)}]$ 的列表，分别对应于线性元和二次元每个波长的最少节点数。例如，输出格式必须与以下完全一样：$[[n_{1,1},n_{1,2}],[n_{2,1},n_{2,2}],\\ldots]$。所有计算出的 $N_{\\lambda}^{(p)}$ 值均为无量纲整数。",
            "solution": "用户在计算声学领域提供了一个适定问题，具体涉及一维亥姆霍兹方程的有限元法（FEM）的数值色散分析。问题陈述具有科学依据，内部一致，并包含进行完整求解所需的所有必要信息。\n\n本文中，首先详细推导了线性（$p=1$）和二次（$p=2$）连续伽辽金有限元法的数值色散关系，然后给出了解决该问题的算法设计。\n\n### 1. 控制方程与弱形式\n\n均匀介质中的一维声学亥姆霍兹方程由下式给出：\n$$\n-u''(x) - k^2 u(x) = 0\n$$\n其中 $u(x)$ 是复声压场，$k$ 是物理波数，单位为 $\\mathrm{rad/m}$。\n\n为了推导有限元近似，我们首先建立弱形式。将方程乘以一个测试函数 $v(x)$ 并在域 $\\Omega$ 上积分，我们得到：\n$$\n-\\int_{\\Omega} u'' v \\, dx - k^2 \\int_{\\Omega} u v \\, dx = 0\n$$\n对第一项应用分部积分法得到：\n$$\n\\int_{\\Omega} u' v' \\, dx - [u'v]_{\\partial\\Omega} - k^2 \\int_{\\Omega} u v \\, dx = 0\n$$\n假设周期性边界条件或解在无穷远处衰减的无限域，边界项消失。离散有限元问题是在有限维函数空间 $V_h$（由多项式基函数张成）中找到一个解 $u_h$，使得对于所有测试函数 $v_h \\in V_h$：\n$$\n\\int_{\\Omega} u'_h v'_h \\, dx - k^2 \\int_{\\Omega} u_h v_h \\, dx = 0\n$$\n这导出了全局线性系统：\n$$\n(S - k^2 M) \\mathbf{U} = \\mathbf{0}\n$$\n其中 $S$ 是全局刚度矩阵，$M$ 是全局质量矩阵，$\\mathbf{U}$ 是节点自由度的向量。\n\n### 2. 单元矩阵的推导\n\n我们在一个长度为 $2$ 的参考单元 $\\hat{e} = [-1, 1]$ 上进行计算。在一个长度为 $h$ 的单元中，从参考坐标 $\\xi$ 到物理坐标 $x$ 的映射是 $x(\\xi) = x_c + \\frac{h}{2}\\xi$。单元刚度（$S^e$）和质量（$M^e$）矩阵计算如下：\n$$\nS^e_{ij} = \\int_{e} \\phi'_i(x) \\phi'_j(x) \\, dx = \\frac{2}{h} \\int_{-1}^{1} \\frac{d\\phi_i}{d\\xi} \\frac{d\\phi_j}{d\\xi} \\, d\\xi\n$$\n$$\nM^e_{ij} = \\int_{e} \\phi_i(x) \\phi_j(x) \\, dx = \\frac{h}{2} \\int_{-1}^{1} \\phi_i(\\xi) \\phi_j(\\xi) \\, d\\xi\n$$\n其中 $\\phi_i(\\xi)$ 是参考单元上的拉格朗日基函数。\n\n### 3. 使用弗洛凯-布洛赫理论进行色散分析\n\n对于尺寸为 $h$ 的均匀网格，离散系统是周期性的。我们通过对节点值假设一个弗洛凯-布洛赫拟设来分析平面波的传播。对于一个数值波数为 $k_{\\mathrm{num}}$ 的波，在位置 $x_j$ 处的节点值为 $U_j = U_0 e^{i k_{\\mathrm{num}} x_j}$。在一个长度为 $h$ 的单元上的相移是 $\\zeta = k_{\\mathrm{num}} h$。因此，节点 $j+1$ 处的值与节点 $j$ 处的值的关系为 $U_{j+1} = U_j e^{i\\zeta}$。该关系用于将无限的全局系统简化为单个代表性单元的小型特征方程，从而得到色散关系。\n\n#### 3.1. 线性元 ($p=1$)\n\n对于线性元，在 $[-1, 1]$ 上的基函数为 $\\phi_1(\\xi) = \\frac{1-\\xi}{2}$ 和 $\\phi_2(\\xi) = \\frac{1+\\xi}{2}$。得到的单元矩阵为：\n$$\nS^e = \\frac{1}{h} \\begin{pmatrix} 1   -1 \\\\ -1   1 \\end{pmatrix}, \\quad M^e = \\frac{h}{6} \\begin{pmatrix} 2   1 \\\\ 1   2 \\end{pmatrix}\n$$\n一个通用节点 $j$ 的方程由其左侧单元 $[x_{j-1}, x_j]$ 和右侧单元 $[x_j, x_{j+1}]$ 的贡献组装而成。这产生了以下模板：\n$$\n(S^e_{21}-k^2M^e_{21})U_{j-1} + (S^e_{22}+S^e_{11}-k^2(M^e_{22}+M^e_{11}))U_j + (S^e_{12}-k^2M^e_{12})U_{j+1} = 0\n$$\n代入 $U_{j-1} = U_j e^{-i\\zeta}$ 和 $U_{j+1} = U_j e^{i\\zeta}$ 并除以 $U_j$：\n$$\n\\left(-\\frac{1}{h} - k^2\\frac{h}{6}\\right)e^{-i\\zeta} + \\left(\\frac{2}{h} - k^2\\frac{2h}{3}\\right) + \\left(-\\frac{1}{h} - k^2\\frac{h}{6}\\right)e^{i\\zeta} = 0\n$$\n使用 $e^{i\\zeta} + e^{-i\\zeta} = 2\\cos\\zeta$ 并化简，我们得到：\n$$\n\\frac{2}{h}(1-\\cos\\zeta) - k^2\\frac{h}{3}(2+\\cos\\zeta) = 0\n$$\n求解 $(kh)^2$：\n$$\n(kh)^2 = \\frac{6(1-\\cos\\zeta)}{2+\\cos\\zeta}\n$$\n对于我们的分析，需要将 $\\zeta$ 表示为 $kh$ 的函数。反转该关系可得：\n$$\n\\cos\\zeta = \\frac{6 - 2(kh)^2}{6 + (kh)^2}\n$$\n这允许对于给定的无量纲波数 $kh$ 直接计算 $\\zeta = \\arccos\\left( \\frac{6 - 2(kh)^2}{6 + (kh)^2} \\right)$。\n\n#### 3.2. 二次元 ($p=2$)\n\n对于二次元，我们在 $[-1, 1]$ 上使用三个基函数：$\\phi_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}$，$\\phi_2(\\xi) = 1-\\xi^2$，$\\phi_3(\\xi) = \\frac{\\xi(\\xi+1)}{2}$。单元矩阵为：\n$$\nS^e = \\frac{1}{3h} \\begin{pmatrix} 7   -8   1 \\\\ -8   16   -8 \\\\ 1   -8   7 \\end{pmatrix}, \\quad M^e = \\frac{h}{30} \\begin{pmatrix} 4   2   -1 \\\\ 2   16   2 \\\\ -1   2   4 \\end{pmatrix}\n$$\n一种标准且稳健的分析技术是静力凝聚，它消去内部自由度（边中节点），从而为仅有的边界节点产生一个等效系统。这为每个单元的边界节点生成一个 $2 \\times 2$ 的矩阵系统，类似于线性情况。令 $\\hat{K} = \\hat{S} - k^2 \\hat{M}$ 为凝聚单元算子。将弗洛凯-布洛赫条件应用于此凝聚系统，可得关系式 $\\cos\\zeta = -\\hat{K}_{11}/\\hat{K}_{12}$。在执行静力凝聚的代数步骤后，我们得到色散关系。令 $\\alpha = (kh)^2$。该关系式为：\n$$\n\\cos\\zeta = - \\frac{\\frac{70-4\\alpha}{30} - \\frac{(40+\\alpha)^2}{120(10-\\alpha)}}{\\frac{10+\\alpha}{30} - \\frac{(40+\\alpha)^2}{120(10-\\alpha)}}\n$$\n化简此表达式可得：\n$$\n\\cos\\zeta = \\frac{1200 - 520(kh)^2 + 15(kh)^4}{1200 + 80(kh)^2 + 5(kh)^4}\n$$\n此表达式允许直接计算 $\\zeta = \\arccos(\\dots)$。虽然问题文本建议对 $\\zeta$ 进行数值求解，但该公式提供了一个显式公式，它等价于为声学分支找到布洛赫约化矩阵的行列式的根。\n\n### 4. 误差计算与搜索算法\n\n目标是找到每个波长的最小整数自由度数 $N_{\\lambda}^{(p)}$，以使周期归一化相误差 $E_{\\mathrm{rel}}$ 保持在容差 $\\epsilon$ 以下。定义如下：\n- $N_{\\lambda}^{(1)} = \\lambda/h \\implies kh = 2\\pi/N_{\\lambda}^{(1)}$\n- $N_{\\lambda}^{(2)} = 2\\lambda/h \\implies kh = 4\\pi/N_{\\lambda}^{(2)}$\n- $E_{\\mathrm{rel}} = \\frac{|k_{\\mathrm{num}} - k|L}{2\\pi} = \\frac{kL}{2\\pi} \\left| \\frac{\\zeta}{kh} - 1 \\right|$\n\n对于每个测试用例 ($k, L, \\epsilon$) 和每个多项式阶次 $p \\in \\{1, 2\\}$，我们执行以下搜索：\n1. 初始化每个波长的节点数 $N=1$。\n2. 使用适用于 $p$ 的公式计算相应的 $kh$ 值。\n3. 使用为次数 $p$ 推导出的色散关系从 $kh$ 计算 $\\zeta$。\n4. 计算误差 $E_{\\mathrm{rel}}$。\n5. 如果 $E_{\\mathrm{rel}} \\le \\epsilon$，则最小整数值为 $N_{\\lambda}^{(p)}=N$。搜索终止。\n6. 如果 $E_{\\mathrm{rel}}  \\epsilon$，则将 $N$ 增加 1 并返回到步骤 2。\n\n此过程保证找到满足误差标准的最小整数 $N_{\\lambda}^{(p)}$。",
            "answer": "```python\nimport numpy as np\nfrom scipy import optimize\n\n# This solution strictly adheres to the specified environment:\n# Python 3.12, numpy 1.23.5, scipy 1.11.4\n\ndef get_dispersion_relation_p1(kh):\n    \"\"\"\n    Computes numerical phase advance zeta for linear elements (p=1).\n    The formula is derived from the FEM weak form and Floquet-Bloch analysis.\n    cos(zeta) = (6 - 2*(kh)**2) / (6 + (kh)**2)\n    \"\"\"\n    alpha = kh**2\n    # The argument to arccos can exceed [-1, 1] if kh is too large (spatial aliasing)\n    # This indicates the mesh is too coarse to represent the wave.\n    # The search algorithm starts from N=1, so kh is large initially.\n    # We must handle this case gracefully.\n    cos_zeta_arg = (6.0 - 2.0 * alpha) / (6.0 + alpha)\n    if not (-1.0 = cos_zeta_arg = 1.0):\n        # Return a value that implies very high error, ensuring the loop continues.\n        # e.g., a zeta of 0, which corresponds to an infinite numerical wavelength.\n        return 0.0\n    return np.arccos(cos_zeta_arg)\n\ndef get_dispersion_relation_p2(kh):\n    \"\"\"\n    Computes numerical phase advance zeta for quadratic elements (p=2).\n    The formula is derived via static condensation and Floquet-Bloch analysis.\n    cos(zeta) = (1200 - 520*alpha + 15*alpha^2) / (1200 + 80*alpha + 5*alpha^2)\n    where alpha = (kh)^2.\n    \"\"\"\n    alpha = kh**2\n    num = 1200.0 - 520.0 * alpha + 15.0 * alpha**2\n    den = 1200.0 + 80.0 * alpha + 5.0 * alpha**2\n    \n    # Handle spatial aliasing limit\n    cos_zeta_arg = num / den\n    if not (-1.0 = cos_zeta_arg = 1.0):\n        return 0.0\n    return np.arccos(cos_zeta_arg)\n\ndef find_min_nodes_per_wavelength(p, k, L, epsilon):\n    \"\"\"\n    Searches for the minimum integer number of nodes per wavelength (N)\n    to satisfy the phase error tolerance.\n    \"\"\"\n    N = 1\n    while True:\n        if p == 1:\n            # For p=1, N_lambda = lambda/h => kh = 2*pi/N\n            kh = 2.0 * np.pi / N\n            zeta = get_dispersion_relation_p1(kh)\n        elif p == 2:\n            # For p=2, N_lambda = 2*lambda/h => kh = 4*pi/N\n            kh = 4.0 * np.pi / N\n            zeta = get_dispersion_relation_p2(kh)\n        else:\n            raise ValueError(\"Polynomial order p must be 1 or 2.\")\n        \n        # Avoid division by zero for kh=0 or if zeta is invalid\n        if kh == 0 or zeta == 0:\n            # Error is maximal, continue search\n            N += 1\n            continue\n\n        # k_num = zeta / h = zeta / (kh / k) = k * zeta / kh\n        k_num = k * zeta / kh\n        \n        # Cycle-normalized phase error\n        # E_rel = |k_num - k| * L / (2*pi)\n        error = np.abs(k_num - k) * L / (2.0 * np.pi)\n        \n        if error = epsilon:\n            return N\n        \n        # Safety break for very large N, though should not be needed for given test cases\n        if N > 10000:\n            raise RuntimeError(f\"Search for p={p} exceeded max iterations for k={k}, eps={epsilon}\")\n            \n        N += 1\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (k in rad/m, L in m, epsilon)\n    test_cases_params = [\n        (50.0, 10.0, 0.01),\n        (200.0, 10.0, 0.01),\n        (200.0, 10.0, 0.002),\n        (800.0, 10.0, 0.005),\n    ]\n\n    results = []\n    for k, L, epsilon in test_cases_params:\n        N_p1 = find_min_nodes_per_wavelength(p=1, k=k, L=L, epsilon=epsilon)\n        N_p2 = find_min_nodes_per_wavelength(p=2, k=k, L=L, epsilon=epsilon)\n        results.append(f\"[{N_p1},{N_p2}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}