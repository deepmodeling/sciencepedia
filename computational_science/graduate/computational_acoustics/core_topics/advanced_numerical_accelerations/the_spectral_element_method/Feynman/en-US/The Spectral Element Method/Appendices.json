{
    "hands_on_practices": [
        {
            "introduction": "The efficiency and high accuracy of the Spectral Element Method (SEM) are rooted in its specific choice of polynomial basis and quadrature rules defined on a reference element. This first exercise focuses on these fundamental building blocks by having you compute the Gauss-Lobatto-Legendre (GLL) nodes and weights from first principles. By assembling the local mass and stiffness matrices, you will directly observe how this particular construction leads to a diagonal mass matrix, a key feature that makes explicit time-stepping schemes exceptionally efficient .",
            "id": "4145034",
            "problem": "Consider the one-dimensional reference element $\\xi \\in [-1,1]$ for the Spectral Element Method (SEM) applied to linear acoustics with unit density and unit bulk modulus so that the bilinear forms reduce to the standard $L^{2}$ inner product and the $H^{1}$ seminorm. Let the polynomial degree be $p=4$ and adopt the Gauss–Lobatto–Legendre (GLL) nodal set of $p+1=5$ points on $[-1,1]$. Using fundamental properties of Legendre polynomials, first determine the $5$ GLL nodes $\\{\\xi_{i}\\}_{i=0}^{4}$ and their associated GLL quadrature weights $\\{w_{i}\\}_{i=0}^{4}$. Next, construct the nodal Lagrange basis $\\{\\ell_{i}(\\xi)\\}_{i=0}^{4}$ that interpolates at these nodes, and assemble the local, element-level consistent mass and stiffness matrices,\n$$\nM_{ij} \\equiv \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi,\\qquad\nK_{ij} \\equiv \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}(\\xi)\\,\\frac{d\\ell_{j}}{d\\xi}(\\xi)\\,d\\xi,\\quad i,j=0,\\dots,4.\n$$\nBegin from the defining properties of Legendre polynomials and the construction of GLL quadrature (endpoints included and interior nodes at the roots of the derivative of the Legendre polynomial of degree $p$), and the definition of nodal Lagrange polynomials. Use only these bases to justify the diagonality of the mass matrix under GLL quadrature collocation and to explain the nonzero pattern (bandwidth) that results for the stiffness matrix on this single reference element.\n\nFinally, report the determinant of the mass matrix $M$ as your answer. Express the final value as an exact rational number. No rounding is required and no units are involved. The final answer must be a single real number presented in exact form.",
            "solution": "The problem is set on the one-dimensional reference element $\\xi \\in [-1,1]$ with a polynomial approximation of degree $p=4$. The nodal basis is constructed using the $p+1=5$ Gauss–Lobatto–Legendre (GLL) points.\n\nFirst, we determine the GLL nodes $\\{\\xi_{i}\\}_{i=0}^{4}$ and their associated quadrature weights $\\{w_{i}\\}_{i=0}^{4}$. For a polynomial degree $p$, the $p+1$ GLL nodes are the roots of the polynomial $(1-\\xi^2)P'_{p}(\\xi)$, where $P_{p}(\\xi)$ is the Legendre polynomial of degree $p$. The endpoints $\\xi=-1$ and $\\xi=1$ are always included. The $p-1$ interior nodes are the roots of $P'_{p}(\\xi)$, the first derivative of the Legendre polynomial.\n\nFor $p=4$, we need the Legendre polynomial $P_4(\\xi)$. The first few Legendre polynomials are:\n$P_0(\\xi) = 1$\n$P_1(\\xi) = \\xi$\n$P_2(\\xi) = \\frac{1}{2}(3\\xi^2 - 1)$\n$P_3(\\xi) = \\frac{1}{2}(5\\xi^3 - 3\\xi)$\n$P_4(\\xi) = \\frac{1}{8}(35\\xi^4 - 30\\xi^2 + 3)$\n\nThe derivative, $P'_4(\\xi)$, is:\n$$ P'_4(\\xi) = \\frac{d}{d\\xi} \\left[ \\frac{1}{8}(35\\xi^4 - 30\\xi^2 + 3) \\right] = \\frac{1}{8}(140\\xi^3 - 60\\xi) = \\frac{5}{2}\\xi(7\\xi^2 - 3) $$\nThe interior GLL nodes are the roots of $P'_4(\\xi)=0$, which are $\\xi=0$ and $\\xi^2 = \\frac{3}{7}$, yielding $\\xi = \\pm\\sqrt{\\frac{3}{7}}$.\nIncluding the endpoints and ordering the nodes, we have the $5$ GLL nodes:\n$$ \\xi_0 = -1, \\quad \\xi_1 = -\\sqrt{\\frac{3}{7}}, \\quad \\xi_2 = 0, \\quad \\xi_3 = \\sqrt{\\frac{3}{7}}, \\quad \\xi_4 = 1 $$\nThe GLL quadrature weights $w_i$ are given by the formula:\n$$ w_i = \\frac{2}{p(p+1)[P_p(\\xi_i)]^2} $$\nFor $p=4$, this becomes $w_i = \\frac{2}{4(5)[P_4(\\xi_i)]^2} = \\frac{1}{10[P_4(\\xi_i)]^2}$.\nWe evaluate $P_4(\\xi_i)$ for each node:\nFor the endpoints $\\xi_0 = -1$ and $\\xi_4 = 1$, we have $P_4(\\pm 1) = 1$. The weights are:\n$$ w_0 = w_4 = \\frac{1}{10[P_4(1)]^2} = \\frac{1}{10(1)^2} = \\frac{1}{10} $$\nFor the interior node $\\xi_2 = 0$:\n$$ P_4(0) = \\frac{1}{8}(3) = \\frac{3}{8} $$\n$$ w_2 = \\frac{1}{10[P_4(0)]^2} = \\frac{1}{10(\\frac{3}{8})^2} = \\frac{1}{10(\\frac{9}{64})} = \\frac{64}{90} = \\frac{32}{45} $$\nFor the interior nodes $\\xi_1 = -\\sqrt{\\frac{3}{7}}$ and $\\xi_3 = \\sqrt{\\frac{3}{7}}$ (note that $P_4(\\xi)$ is an even function):\n$$ P_4\\left(\\pm\\sqrt{\\frac{3}{7}}\\right) = \\frac{1}{8}\\left(35\\left(\\frac{3}{7}\\right)^2 - 30\\left(\\frac{3}{7}\\right) + 3\\right) = \\frac{1}{8}\\left(35\\frac{9}{49} - \\frac{90}{7} + 3\\right) = \\frac{1}{8}\\left(\\frac{45}{7} - \\frac{90}{7} + \\frac{21}{7}\\right) = \\frac{1}{8}\\left(\\frac{-24}{7}\\right) = -\\frac{3}{7} $$\n$$ w_1 = w_3 = \\frac{1}{10\\left[P_4\\left(\\pm\\sqrt{\\frac{3}{7}}\\right)\\right]^2} = \\frac{1}{10\\left(-\\frac{3}{7}\\right)^2} = \\frac{1}{10\\left(\\frac{9}{49}\\right)} = \\frac{49}{90} $$\nThe set of weights is $\\{w_i\\}_{i=0}^4 = \\{\\frac{1}{10}, \\frac{49}{90}, \\frac{32}{45}, \\frac{49}{90}, \\frac{1}{10}\\}$. As a check, the sum of the weights is $\\sum w_i = 2 \\cdot \\frac{1}{10} + 2 \\cdot \\frac{49}{90} + \\frac{32}{45} = \\frac{9}{45} + \\frac{49}{45} + \\frac{32}{45} = \\frac{90}{45} = 2$, which is correct since $\\int_{-1}^1 d\\xi = 2$.\n\nNext, we address the element matrices. The basis functions are the nodal Lagrange polynomials $\\{\\ell_j(\\xi)\\}_{j=0}^4$, which are unique polynomials of degree $p=4$ satisfying the interpolatory property $\\ell_j(\\xi_i) = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta.\n\nThe consistent mass matrix is defined as $M_{ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi$.\nIn the context of SEM, integrals are typically evaluated using GLL quadrature. The GLL quadrature rule with $p+1$ points is exact for polynomials of degree up to $2p-1$. Here, for $p=4$, the GLL quadrature is exact for polynomials of degree up to $2(4)-1=7$. The integrand $\\ell_i(\\xi)\\ell_j(\\xi)$ is a polynomial of degree up to $2p = 8$. Since $8>7$, GLL quadrature is not exact for the consistent mass matrix.\n\nHowever, a key feature of SEM is \"mass lumping,\" where the integral for the mass matrix is deliberately approximated by GLL quadrature. This is what the problem refers to when asking to \"justify the diagonality of the mass matrix under GLL quadrature collocation\". The collocated, or lumped, mass matrix is:\n$$ M_{ij}^{GLL} = \\sum_{k=0}^{4} w_k \\ell_i(\\xi_k) \\ell_j(\\xi_k) $$\nUsing the property $\\ell_i(\\xi_k) = \\delta_{ik}$, the expression simplifies:\n$$ M_{ij}^{GLL} = \\sum_{k=0}^{4} w_k \\delta_{ik} \\delta_{jk} $$\nThis sum is non-zero only when $k=i$ and $k=j$, which requires $i=j$. Thus, the matrix is diagonal:\n$$ M_{ij}^{GLL} = w_i \\delta_{ij} $$\nThe lumped mass matrix is diagonal, with the quadrature weights as its diagonal entries. This diagonal structure is a major computational advantage of SEM.\n\nThe stiffness matrix is defined as $K_{ij} = \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}(\\xi)\\,\\frac{d\\ell_{j}}{d\\xi}(\\xi)\\,d\\xi$.\nThe derivative of a Lagrange polynomial of degree $p=4$ is a polynomial of degree $p-1=3$. The integrand $\\frac{d\\ell_{i}}{d\\xi}\\frac{d\\ell_{j}}{d\\xi}$ is therefore a polynomial of degree $2(p-1)=6$. Since $6  7$, GLL quadrature is **exact** for the stiffness matrix. The stiffness matrix is thus computed as:\n$$ K_{ij} = \\sum_{k=0}^{4} w_k \\frac{d\\ell_{i}}{d\\xi}(\\xi_k) \\frac{d\\ell_{j}}{d\\xi}(\\xi_k) $$\nTo explain its non-zero pattern, we consider the matrix of derivatives $D_{ki} = \\frac{d\\ell_{i}}{d\\xi}(\\xi_k)$. Unlike the Lagrange polynomials themselves, their derivatives are generally non-zero at the nodal points (except possibly at a few points due to symmetries). The differentiation matrix $D$ is a dense $5 \\times 5$ matrix. The stiffness matrix can be written in matrix form as $K = D^T W D$, where $W$ is the diagonal matrix of weights. The product of these matrices results in a dense (fully populated) $5 \\times 5$ matrix. Therefore, the local stiffness matrix on this single reference element is a full matrix.\n\nFinally, we are asked to report the determinant of the mass matrix $M$. Given the context and the request to explain the diagonality under GLL collocation, it is standard practice to interpret \"the mass matrix\" in this computational context as the lumped mass matrix $M^{GLL}$. The determinant of the diagonal lumped mass matrix is the product of its diagonal entries, which are the quadrature weights.\n$$ \\det(M) = \\det(M^{GLL}) = \\prod_{i=0}^{4} w_i = w_0 w_1 w_2 w_3 w_4 $$\nSubstituting the calculated weights:\n$$ \\det(M) = \\left(\\frac{1}{10}\\right) \\left(\\frac{49}{90}\\right) \\left(\\frac{32}{45}\\right) \\left(\\frac{49}{90}\\right) \\left(\\frac{1}{10}\\right) $$\n$$ \\det(M) = \\frac{1 \\cdot 49 \\cdot 32 \\cdot 49 \\cdot 1}{10 \\cdot 90 \\cdot 45 \\cdot 90 \\cdot 10} = \\frac{49^2 \\cdot 32}{10^2 \\cdot 90^2 \\cdot 45} = \\frac{2401 \\cdot 32}{100 \\cdot 8100 \\cdot 45} = \\frac{76832}{36450000} $$\nTo simplify this fraction, we use prime factorization:\n$76832 = 2^5 \\cdot 7^4$\n$36450000 = 3645 \\cdot 10^4 = (5 \\cdot 729) \\cdot (2 \\cdot 5)^4 = (5 \\cdot 3^6) \\cdot (2^4 \\cdot 5^4) = 2^4 \\cdot 3^6 \\cdot 5^5$\n$$ \\det(M) = \\frac{2^5 \\cdot 7^4}{2^4 \\cdot 3^6 \\cdot 5^5} = \\frac{2 \\cdot 7^4}{3^6 \\cdot 5^5} = \\frac{2 \\cdot 2401}{729 \\cdot 3125} = \\frac{4802}{2278125} $$\nThis is the final answer as an exact rational number.",
            "answer": "$$ \\boxed{\\frac{4802}{2278125}} $$"
        },
        {
            "introduction": "A numerical simulation involves assembling local element contributions into a global system that represents the entire physical domain. This practice builds upon the concept of local matrices by guiding you through the assembly of global mass and stiffness matrices and the application of boundary conditions. Furthermore, you will tackle the critical issue of numerical stability for time-dependent problems, deriving the maximum allowable time step for an explicit leapfrog scheme by analyzing the eigenvalues of the discrete spatial operator .",
            "id": "4144970",
            "problem": "You are asked to derive, implement, and evaluate the stability-limited explicit time-step for the Spectral Element Method (SEM) applied to one-dimensional linear acoustics. Consider the one-dimensional homogeneous acoustic wave equation on the interval $[0,L]$ with Dirichlet boundary conditions,\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}, \\quad x \\in [0,L], \\quad p(0,t) = 0, \\quad p(L,t) = 0,\n$$\nwhere $p(x,t)$ is the acoustic pressure and $c$ is the sound speed. Use the Spectral Element Method (SEM) with Legendre-Gauss-Lobatto (LGL) nodes and Lagrange interpolating polynomials of polynomial order $p$ on each element. Assume a uniform mesh with $E$ elements, each of length $h = L/E$. Use the LGL quadrature to construct a diagonal mass matrix and the stiffness matrix consistent with the weak form. Impose continuity across element interfaces by assembling a global $C^0$-continuous discretization that includes the shared interface nodes. Enforce the Dirichlet boundary conditions by eliminating the boundary degrees of freedom at $x=0$ and $x=L$ from the assembled system.\n\nFrom a suitable fundamental base, derive how the leapfrog (explicit central difference) time integration scheme applies to the resulting semi-discrete system and determine the maximum stable time-step $\\Delta t$ in seconds constrained by the discrete spatial operator’s spectrum. Do not assume or use any shortcut formulas; start from the weak form and the definition of the leapfrog method to arrive at the stability condition from first principles.\n\nYour program must:\n- Construct the local element matrices from the LGL quadrature on the reference interval $\\xi \\in [-1,1]$, using the mapping $x(\\xi)$ with Jacobian $J = h/2$, the Lagrange basis functions at LGL nodes of order $p$, the nodal derivative matrix with entries of $\\partial \\ell_j / \\partial \\xi$ evaluated at LGL nodes, and the LGL quadrature weights.\n- Assemble the global diagonal mass matrix and global stiffness matrix for the entire domain, with $C^0$ continuity enforced by identifying shared nodes at element interfaces.\n- Apply homogeneous Dirichlet boundary conditions by eliminating the boundary degrees of freedom corresponding to the nodes at $x=0$ and $x=L$.\n- Compute the largest eigenvalue of the generalized eigenproblem given by the assembled matrices, and then deduce the maximum stable $\\Delta t$ for the leapfrog scheme solely from the stability analysis of the semi-discrete system.\n\nUnits and output:\n- All geometric quantities must be handled in meters ($\\mathrm{m}$).\n- The sound speed must be in meters per second ($\\mathrm{m/s}$).\n- The final answers $\\Delta t$ must be expressed in seconds ($\\mathrm{s}$) and rounded to eight decimal places.\n\nTest suite:\nFor each of the following parameter sets $(L,E,p,c)$, compute the maximum stable $\\Delta t$ in seconds, rounded to eight decimal places:\n1. $(L=1.0, E=4, p=4, c=343.0)$\n2. $(L=2.0, E=8, p=6, c=1500.0)$\n3. $(L=1.0, E=1, p=2, c=2000.0)$\n4. $(L=1.0, E=2, p=1, c=1000.0)$\n5. $(L=0.3, E=12, p=8, c=343.0)$\n\nFinal output format:\nYour program should produce a single line of output containing the five results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), in the same order as the test suite above. Each result must be a float rounded to eight decimal places and expressed in seconds.",
            "solution": "The problem requires the derivation and implementation of the maximum stable time-step, $\\Delta t_{max}$, for the one-dimensional acoustic wave equation discretized using the Spectral Element Method (SEM) with an explicit leapfrog time integration scheme. The derivation must start from first principles.\n\nThe governing equation is the homogeneous 1D acoustic wave equation on a domain $x \\in [0,L]$ with homogeneous Dirichlet boundary conditions:\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}, \\quad p(0,t) = 0, \\quad p(L,t) = 0\n$$\nwhere $p(x,t)$ is the acoustic pressure and $c$ is the speed of sound.\n\n**1. Weak Formulation**\nTo derive the weak form, we multiply the wave equation by a suitable test function $v(x)$ that belongs to the same function space as the solution, and integrate over the domain $[0,L]$. The test functions must also satisfy the homogeneous boundary conditions, i.e., $v(0)=v(L)=0$.\n$$\n\\int_0^L v \\frac{\\partial^2 p}{\\partial t^2} dx = \\int_0^L v c^2 \\frac{\\partial^2 p}{\\partial x^2} dx\n$$\nWe apply integration by parts to the right-hand side term:\n$$\n\\int_0^L v c^2 \\frac{\\partial^2 p}{\\partial x^2} dx = \\left[ v c^2 \\frac{\\partial p}{\\partial x} \\right]_0^L - \\int_0^L c^2 \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} dx\n$$\nThe boundary term $\\left[ v c^2 \\frac{\\partial p}{\\partial x} \\right]_0^L$ vanishes because the test function $v(x)$ is zero at the boundaries $x=0$ and $x=L$. This yields the weak form of the equation: find $p(x,t)$ such that for all admissible test functions $v(x)$,\n$$\n\\int_0^L v \\frac{\\partial^2 p}{\\partial t^2} dx = -c^2 \\int_0^L \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} dx\n$$\n\n**2. Spectral Element Discretization**\nThe domain $[0,L]$ is partitioned into $E$ non-overlapping elements $\\Omega_k$, each of uniform length $h=L/E$. Within each element, the geometry and the solution are mapped to a reference element $\\xi \\in [-1,1]$. The mapping is $x(\\xi) = x_c^k + \\frac{h}{2}\\xi$, where $x_c^k$ is the center of the $k$-th element. The Jacobian of this transformation is $J = \\frac{dx}{d\\xi} = \\frac{h}{2}$, and the chain rule gives $\\frac{\\partial}{\\partial x} = \\frac{1}{J}\\frac{\\partial}{\\partial\\xi}$.\n\nIn each element, the pressure field $p(x,t)$ is approximated as a sum over a basis of Lagrange interpolating polynomials $\\ell_j(\\xi)$ of order $p$, defined on the $p+1$ Legendre-Gauss-Lobatto (LGL) nodes $\\{\\xi_j\\}_{j=0}^p$:\n$$\np(x(\\xi), t) \\approx p^k(\\xi, t) = \\sum_{j=0}^{p} p_j^k(t) \\ell_j(\\xi)\n$$\nHere, $p_j^k(t)$ are the unknown time-dependent pressure values at the LGL nodes within element $k$. The Lagrange basis functions have the property $\\ell_j(\\xi_i) = \\delta_{ij}$. A Galerkin approach is used, where the test function $v$ is represented using the same basis.\n\nSubstituting the expansion into the weak form, which is a sum over all elements:\n$$\n\\sum_{k=1}^E \\int_{\\Omega_k} \\left(\\sum_{i=0}^p v_i^k \\ell_i\\right) \\left(\\sum_{j=0}^p \\frac{d^2 p_j^k}{dt^2} \\ell_j\\right) dx = -c^2 \\sum_{k=1}^E \\int_{\\Omega_k} \\left(\\sum_{i=0}^p v_i^k \\frac{\\partial\\ell_i}{\\partial x}\\right) \\left(\\sum_{j=0}^p p_j^k \\frac{\\partial\\ell_j}{\\partial x}\\right) dx\n$$\nSince this must hold for any choice of nodal values $v_i^k$, we obtain a system of ordinary differential equations (ODEs). For each element $k$, we define the local mass matrix $M^k$ and stiffness matrix $K^k$:\n$$\nM^k_{ij} = \\int_{\\Omega_k} \\ell_i \\ell_j dx = \\int_{-1}^1 \\ell_i(\\xi) \\ell_j(\\xi) J d\\xi\n$$\n$$\nK^k_{ij} = \\int_{\\Omega_k} \\frac{\\partial\\ell_i}{\\partial x} \\frac{\\partial\\ell_j}{\\partial x} dx = \\int_{-1}^1 \\left(\\frac{1}{J}\\frac{d\\ell_i}{d\\xi}\\right) \\left(\\frac{1}{J}\\frac{d\\ell_j}{d\\xi}\\right) J d\\xi = \\frac{1}{J} \\int_{-1}^1 \\frac{d\\ell_i}{d\\xi} \\frac{d\\ell_j}{d\\xi} d\\xi\n$$\n\nThese integrals are evaluated numerically using LGL quadrature, which uses the LGL nodes as quadrature points and corresponding weights $\\{w_m\\}_{m=0}^p$. The mass matrix integral becomes:\n$$\nM^k_{ij} = J \\sum_{m=0}^p w_m \\ell_i(\\xi_m) \\ell_j(\\xi_m) = J \\sum_{m=0}^p w_m \\delta_{im} \\delta_{jm} = J w_i \\delta_{ij}\n$$\nThis demonstrates that using LGL nodes for both interpolation and quadrature results in a diagonal, or \"lumped\", mass matrix.\n\nThe stiffness matrix is evaluated as:\n$$\nK^k_{ij} = \\frac{1}{J} \\sum_{m=0}^p w_m \\frac{d\\ell_i}{d\\xi}(\\xi_m) \\frac{d\\ell_j}{d\\xi}(\\xi_m)\n$$\nThis can be expressed using the nodal derivative matrix $D$ on the reference element, with entries $D_{mi} = \\frac{d\\ell_i}{d\\xi}(\\xi_m)$, and the diagonal matrix of quadrature weights $W$, where $W_{mm}=w_m$. The element stiffness matrix is then $K^k = \\frac{1}{J} D^T W D$.\n\n**3. Assembly and Boundary Conditions**\nThe global matrices $M_{glob}$ and $K_{glob}$ are assembled by summing the contributions from each element's matrices into a global structure of size $(Ep+1) \\times (Ep+1)$. This process enforces $C^0$ continuity at the element interfaces. Since the element mass matrices are diagonal, the global mass matrix is also diagonal.\n\nThe homogeneous Dirichlet boundary conditions $p(0,t)=0$ and $p(L,t)=0$ mean the degrees of freedom corresponding to the global nodes at $x=0$ and $x=L$ are fixed at zero. We enforce this by eliminating the first and last rows and columns from the global matrices, resulting in smaller matrices $M_{int}$ and $K_{int}$ corresponding to the interior degrees of freedom.\n\nThe resulting semi-discrete system of ODEs for the vector of interior nodal pressures $\\mathbf{p}_{int}(t)$ is:\n$$\nM_{int} \\frac{d^2\\mathbf{p}_{int}}{dt^2} = -c^2 K_{int} \\mathbf{p}_{int}\n$$\nSince $M_{int}$ is diagonal and positive definite, we can write:\n$$\n\\frac{d^2\\mathbf{p}_{int}}{dt^2} = -c^2 M_{int}^{-1} K_{int} \\mathbf{p}_{int}\n$$\n\n**4. Leapfrog Time Integration and Stability Analysis**\nWe discretize the time derivative using the second-order explicit central difference (leapfrog) scheme. For a generic ODE system $\\ddot{\\mathbf{u}} = \\mathbf{f}(\\mathbf{u})$, this is:\n$$\n\\frac{\\mathbf{u}^{n+1} - 2\\mathbf{u}^n + \\mathbf{u}^{n-1}}{(\\Delta t)^2} = \\mathbf{f}(\\mathbf{u}^n)\n$$\nApplying this to our semi-discrete system gives:\n$$\n\\frac{\\mathbf{p}_{int}^{n+1} - 2\\mathbf{p}_{int}^n + \\mathbf{p}_{int}^{n-1}}{(\\Delta t)^2} = -c^2 M_{int}^{-1} K_{int} \\mathbf{p}_{int}^n\n$$\nTo analyze stability, we consider the behavior of a single eigenmode of the system matrix $A = c^2 M_{int}^{-1} K_{int}$. Let $\\lambda$ be an eigenvalue of $A$ with corresponding eigenvector $\\mathbf{v}$. We propose a solution of the form $\\mathbf{p}_{int}^n = z^n \\mathbf{v}$, where $z$ is a complex amplification factor. Substituting this into the scheme:\n$$\n\\frac{z^{n+1}\\mathbf{v} - 2z^n\\mathbf{v} + z^{n-1}\\mathbf{v}}{(\\Delta t)^2} = -\\lambda z^n \\mathbf{v}\n$$\nDividing by $z^{n-1}\\mathbf{v}$ and rearranging yields the characteristic equation for $z$:\n$$\nz^2 - 2z + 1 = -\\lambda (\\Delta t)^2 z \\implies z^2 + (\\lambda (\\Delta t)^2 - 2) z + 1 = 0\n$$\nFor the scheme to be stable, the magnitude of the roots must satisfy $|z| \\le 1$. The roots of this quadratic equation are:\n$$\nz = \\frac{-( \\lambda (\\Delta t)^2 - 2 ) \\pm \\sqrt{( \\lambda (\\Delta t)^2 - 2 )^2 - 4}}{2}\n$$\nThe eigenvalues $\\lambda$ of $A$ are real and non-negative because $K_{int}$ is symmetric positive definite and $M_{int}$ is diagonal positive definite. Stability is maintained if the discriminant is non-positive, leading to complex conjugate roots with $|z|=1$.\n$$\n( \\lambda (\\Delta t)^2 - 2 )^2 - 4 \\le 0 \\implies ( \\lambda (\\Delta t)^2 - 2 )^2 \\le 4\n$$\nTaking the square root gives $-2 \\le \\lambda (\\Delta t)^2 - 2 \\le 2$, which simplifies to $0 \\le \\lambda (\\Delta t)^2 \\le 4$.\nThis condition must hold for all eigenvalues of the system. The most restrictive constraint comes from the largest eigenvalue, $\\lambda_{max}$:\n$$\n\\lambda_{max} (\\Delta t)^2 \\le 4\n$$\nTherefore, the maximum stable time-step is:\n$$\n\\Delta t_{max} = \\frac{2}{\\sqrt{\\lambda_{max}}}\n$$\nwhere $\\lambda_{max}$ is the largest eigenvalue of the matrix $c^2 M_{int}^{-1} K_{int}$, or equivalently, the largest eigenvalue of the generalized eigenvalue problem $c^2 K_{int} \\mathbf{v} = \\lambda M_{int} \\mathbf{v}$.\n\n**5. Computational Procedure**\nThe algorithm to compute $\\Delta t_{max}$ for given parameters $(L, E, p, c)$ is as follows:\n1.  Calculate element geometry: element length $h = L/E$ and Jacobian $J = h/2$.\n2.  For polynomial order $p$, determine the $p+1$ LGL nodes and weights on $[-1,1]$.\n3.  Compute the $(p+1) \\times (p+1)$ nodal derivative matrix $D$ on the reference element.\n4.  Construct the local element matrices: the diagonal mass matrix $M^k$ and the consistent stiffness matrix $K^k$.\n5.  Assemble the global diagonal mass matrix $M_{glob}$ and stiffness matrix $K_{glob}$ by summing element contributions.\n6.  Apply homogeneous Dirichlet boundary conditions by extracting the interior sub-matrices $M_{int}$ and $K_{int}$.\n7.  Solve the generalized eigenvalue problem $c^2 K_{int} \\mathbf{v} = \\lambda M_{int} \\mathbf{v}$ to find the maximum eigenvalue $\\lambda_{max}$.\n8.  Calculate the maximum stable time-step $\\Delta t_{max} = 2 / \\sqrt{\\lambda_{max}}$.\n\nThis procedure provides a rigorous method for determining the stability limit from first principles, as required.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_jacobi, eval_legendre\nfrom scipy.linalg import eigh\n\ndef get_lgl_nodes_weights(p):\n    \"\"\"\n    Computes Legendre-Gauss-Lobatto (LGL) nodes and weights for a given polynomial order p.\n    \"\"\"\n    if p == 0:\n        # This case is trivial and not used in the problem, but for completeness.\n        return np.array([0.0]), np.array([2.0])\n    if p == 1:\n        nodes = np.array([-1.0, 1.0])\n        weights = np.array([1.0, 1.0])\n        return nodes, weights\n\n    # Interior nodes are roots of the derivative of P_p, which are the roots of Jacobi polynomial P_{p-1}^{(1,1)}.\n    interior_nodes, _ = roots_jacobi(p - 1, 1, 1)\n    \n    # Full set of nodes includes endpoints -1 and 1.\n    nodes = np.concatenate(([-1.0], np.sort(interior_nodes), [1.0]))\n    \n    # Weights formula: w_i = 2 / (p*(p+1) * [P_p(xi_i)]^2)\n    poly_vals = eval_legendre(p, nodes)\n    weights = 2.0 / (p * (p + 1) * poly_vals**2)\n    \n    return nodes, weights\n\ndef get_derivative_matrix(p, nodes):\n    \"\"\"\n    Computes the nodal derivative matrix D for Lagrange basis functions at LGL nodes.\n    D_ij = l'_j(xi_i)\n    \"\"\"\n    n_nodes = p + 1\n    D = np.zeros((n_nodes, n_nodes))\n    poly_vals_at_nodes = eval_legendre(p, nodes)\n    \n    for i in range(n_nodes):\n        for j in range(n_nodes):\n            if i == j:\n                if i == 0:\n                    D[i, j] = -p * (p + 1) / 4.0\n                elif i == p:\n                    D[i, j] = p * (p + 1) / 4.0\n                else:\n                    D[i, j] = 0.0\n            else:\n                D[i, j] = poly_vals_at_nodes[i] / (poly_vals_at_nodes[j] * (nodes[i] - nodes[j]))\n    return D\n\ndef calculate_max_dt(L, E, p, c):\n    \"\"\"\n    Calculates the maximum stable timestep Delta_t for the 1D wave equation\n    using SEM with LGL nodes and leapfrog time integration.\n    \"\"\"\n    # 1. Element geometry\n    h = L / E\n    J = h / 2.0\n\n    # 2. LGL data for reference element\n    nodes, weights = get_lgl_nodes_weights(p)\n    n_nodes_per_elem = p + 1\n\n    # 3. Derivative matrix\n    D = get_derivative_matrix(p, nodes)\n    \n    # 4. Element matrices\n    # Element mass matrix (diagonal)\n    M_elem_diag = weights * J\n    # Element stiffness matrix, K^k = (1/J) * D^T * W * D\n    W_diag_mat = np.diag(weights)\n    K_elem = (1.0 / J) * (D.T @ W_diag_mat @ D)\n\n    # 5. Global assembly\n    num_dofs = E * p + 1\n    M_glob_diag = np.zeros(num_dofs)\n    K_glob = np.zeros((num_dofs, num_dofs))\n\n    for e in range(E):\n        for i in range(n_nodes_per_elem):\n            gi = e * p + i\n            M_glob_diag[gi] += M_elem_diag[i]\n            for j in range(n_nodes_per_elem):\n                gj = e * p + j\n                K_glob[gi, gj] += K_elem[i, j]\n\n    # 6. Apply homogeneous Dirichlet BCs\n    # Eliminate first and last DOFs\n    M_int_diag = M_glob_diag[1:-1]\n    K_int = K_glob[1:-1, 1:-1]\n    \n    # Handle case with no interior DOFs (e.g., p=1, E=1)\n    if K_int.shape[0] == 0:\n        return np.inf\n\n    M_int = np.diag(M_int_diag)\n\n    # 7. Solve generalized eigenvalue problem\n    # c^2 * K_int * v = lambda * M_int * v\n    # We need the maximum eigenvalue, lambda_max.\n    # eigh is for symmetric/Hermitian matrices, suitable here.\n    # It solves A*x = lambda*B*x\n    eigenvalues = eigh(c**2 * K_int, M_int, eigvals_only=True)\n    lambda_max = np.max(eigenvalues)\n\n    # 8. Calculate max stable time-step\n    # For leapfrog, dt = 2 / sqrt(lambda_max)\n    if lambda_max = 0: # Should not happen for a valid problem setup\n        return np.inf\n        \n    dt_max = 2.0 / np.sqrt(lambda_max)\n    \n    return dt_max\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 4, 4, 343.0),\n        (2.0, 8, 6, 1500.0),\n        (1.0, 1, 2, 2000.0),\n        (1.0, 2, 1, 1000.0),\n        (0.3, 12, 8, 343.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, E, p, c = case\n        dt_max = calculate_max_dt(L, E, p, c)\n        results.append(f\"{dt_max:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "After building a complex numerical solver, a crucial question arises: how can we be certain it is implemented correctly and is solving the intended equations? This exercise introduces the Method of Manufactured Solutions (MMS), a rigorous and indispensable technique for code verification. You will start with a chosen analytical solution and work backward to derive the corresponding source term and boundary data, creating a test case where the exact solution is known and can be used to meticulously check your code's accuracy .",
            "id": "4145097",
            "problem": "Consider linear acoustics in a heterogeneous medium on the rectangular domain $\\Omega = [0,L_{x}] \\times [0,L_{y}]$ with outward unit normal $\\mathbf{n}(\\mathbf{x})$ on the boundary $\\partial \\Omega$. Let the mass density be $\\rho(\\mathbf{x}) = \\rho_{0}(1+\\epsilon x)$ and the bulk modulus be $\\kappa(\\mathbf{x}) = \\kappa_{0}$, where $\\rho_{0}  0$, $\\kappa_{0}  0$, and $\\epsilon \\ge 0$ are constants. The acoustic pressure $p(\\mathbf{x},t)$ satisfies the second-order scalar wave equation in strong form\n$$\n\\frac{1}{\\kappa_{0}} \\,\\partial_{tt} p(\\mathbf{x},t) - \\nabla \\cdot \\left( \\frac{1}{\\rho_{0}(1+\\epsilon x)} \\, \\nabla p(\\mathbf{x},t) \\right) = f(\\mathbf{x},t) \\quad \\text{in } \\Omega \\times (0,T],\n$$\nwith appropriate boundary and initial conditions. For the purpose of code verification of a Spectral Element Method (SEM), you will use the Method of Manufactured Solutions (MMS): construct a smooth, nontrivial manufactured solution $p(\\mathbf{x},t)$, and then derive the forcing term $f(\\mathbf{x},t)$, consistent boundary data, and initial data so that this $p(\\mathbf{x},t)$ exactly satisfies the above equation and boundary/initial conditions.\n\nSpecifically, take the manufactured solution\n$$\np(\\mathbf{x},t) = \\sin(k_{x} x)\\,\\sin(k_{y} y)\\,\\cos(\\omega t),\n$$\nwhere $k_{x}  0$, $k_{y}  0$, and $\\omega  0$ are prescribed constants. Using first principles of linear acoustics and the weak form that underlies the Spectral Element Method (SEM), perform the following:\n\n- Starting from the linearized momentum and continuity equations, justify the second-order scalar wave equation with heterogeneous coefficients as posed above, and identify the natural boundary flux that appears from integration by parts in the weak form.\n- Compute the source term $f(\\mathbf{x},t)$ that makes the chosen $p(\\mathbf{x},t)$ an exact solution of the strong form.\n- Derive the Dirichlet boundary data $g_{D}(\\mathbf{x},t)$ and the Neumann boundary flux $g_{N}(\\mathbf{x},t)$ consistent with the weak form for arbitrary boundary segments of $\\partial \\Omega$ with outward unit normal $\\mathbf{n}(\\mathbf{x}) = (n_{x}(\\mathbf{x}), n_{y}(\\mathbf{x}))$.\n- Provide the initial pressure $p(\\mathbf{x},0)$ and initial pressure time derivative $\\partial_{t} p(\\mathbf{x},0)$.\n\nExpress the final result as a single closed-form analytic expression containing, in order, the five quantities $\\big(f(\\mathbf{x},t),\\, g_{D}(\\mathbf{x},t),\\, g_{N}(\\mathbf{x},t),\\, p(\\mathbf{x},0),\\, \\partial_{t} p(\\mathbf{x},0)\\big)$. No numerical evaluation is required.",
            "solution": "We perform the tasks in order: justifying the governing equation and its weak form, and then deriving the necessary terms for the Method of Manufactured Solutions (MMS).\n\n#### Justification of the Wave Equation and Weak Form\n\nWe start with the first-order linearized equations of acoustics for a fluid at rest in a heterogeneous medium with density $\\rho(\\mathbf{x})$ and bulk modulus $\\kappa(\\mathbf{x})$. The acoustic pressure is $p(\\mathbf{x},t)$ and the particle velocity is $\\mathbf{u}(\\mathbf{x},t)$.\n\n1.  **Linearized Momentum Equation:**\n    $$ \\rho(\\mathbf{x}) \\frac{\\partial \\mathbf{u}}{\\partial t} (\\mathbf{x},t) = -\\nabla p(\\mathbf{x},t) $$\n2.  **Linearized Continuity Equation:**\n    $$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial p}{\\partial t} (\\mathbf{x},t) + \\nabla \\cdot \\mathbf{u}(\\mathbf{x},t) = 0 $$\n\nTo derive the second-order wave equation for pressure, we eliminate the velocity $\\mathbf{u}$. Differentiating the continuity equation with respect to time $t$ and assuming $\\kappa$ is time-independent yields:\n$$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial^2 p}{\\partial t^2} + \\nabla \\cdot \\left( \\frac{\\partial \\mathbf{u}}{\\partial t} \\right) = 0 $$\nFrom the momentum equation, we substitute $\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\frac{1}{\\rho(\\mathbf{x})} \\nabla p$ into the time-differentiated continuity equation:\n$$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial^2 p}{\\partial t^2} - \\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) = 0 $$\nAdding an external source term $f(\\mathbf{x},t)$ and using the given forms for $\\rho(\\mathbf{x})$ and $\\kappa(\\mathbf{x})$ matches the problem's PDE.\n\nTo derive the weak form, we multiply the PDE by a test function $v(\\mathbf{x})$ and integrate over the domain $\\Omega$:\n$$ \\int_{\\Omega} v \\left( \\frac{1}{\\kappa_{0}} \\partial_{tt}p - \\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) \\right) d\\mathbf{x} = \\int_{\\Omega} v f d\\mathbf{x} $$\nApplying Green's first identity (integration by parts) to the divergence term gives the weak formulation:\nFind $p$ such that for all admissible test functions $v$:\n$$ \\int_{\\Omega} \\frac{1}{\\kappa_{0}} v \\partial_{tt}p \\,d\\mathbf{x} + \\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\nabla v \\cdot \\nabla p \\,d\\mathbf{x} = \\int_{\\Omega} v f \\,d\\mathbf{x} + \\int_{\\partial\\Omega} v \\left(\\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n}\\right) dS $$\nThe term in the boundary integral, $\\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n}$, is the **natural boundary flux** $g_N(\\mathbf{x},t)$.\n\n#### Derivation of MMS Terms\n\nGiven the manufactured solution $p(\\mathbf{x},t) = \\sin(k_{x} x)\\sin(k_{y} y)\\cos(\\omega t)$.\n\n**1. Source Term $f(\\mathbf{x},t)$**\nWe compute $f(\\mathbf{x}, t) = \\frac{1}{\\kappa_0} \\partial_{tt}p - \\nabla \\cdot (\\frac{1}{\\rho} \\nabla p)$.\nThe required derivatives of $p$ are:\n- $\\partial_{tt} p = -\\omega^2 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)$\n- $\\nabla p = \\cos(\\omega t) \\begin{pmatrix} k_x \\cos(k_x x) \\sin(k_y y) \\\\ k_y \\sin(k_x x) \\cos(k_y y) \\end{pmatrix}$\n\nNext, we find $\\nabla \\cdot (\\frac{1}{\\rho} \\nabla p)$ with $\\rho(\\mathbf{x})=\\rho_{0}(1+\\epsilon x)$:\n$$ \\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial_x p}{\\rho}\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{\\partial_y p}{\\rho}\\right) $$\nThe $x$-derivative term is:\n$$ \\frac{\\partial}{\\partial x}\\left(\\frac{k_x \\cos(k_x x) \\sin(k_y y)\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)}\\right) = \\frac{k_x \\sin(k_y y)\\cos(\\omega t)}{\\rho_0} \\frac{-k_x\\sin(k_x x)(1+\\epsilon x) - \\epsilon\\cos(k_x x)}{(1+\\epsilon x)^2} $$\nThe $y$-derivative term is:\n$$ \\frac{\\partial}{\\partial y}\\left(\\frac{k_y \\sin(k_x x) \\cos(k_y y)\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)}\\right) = \\frac{k_y \\sin(k_x x)\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} (-k_y \\sin(k_y y)) = -\\frac{k_y^2 \\sin(k_x x)\\sin(k_y y)\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} $$\nCombining all terms for $f(\\mathbf{x},t)$:\n$$ f(\\mathbf{x},t) = -\\frac{\\omega^2}{\\kappa_0}p - \\left[ -\\frac{k_x^2 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} - \\frac{k_x \\epsilon \\cos(k_x x) \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)^2} - \\frac{k_y^2 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\right] $$\nFactoring terms gives the source term:\n$$ f(\\mathbf{x},t) = \\left( \\left[ \\frac{k_x^2+k_y^2}{\\rho_0(1+\\epsilon x)} - \\frac{\\omega^2}{\\kappa_0} \\right] \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y)}{\\rho_0(1+\\epsilon x)^2} \\right) \\cos(\\omega t) $$\n\n**2. Boundary Data $g_D(\\mathbf{x},t)$ and $g_N(\\mathbf{x},t)$**\n- **Dirichlet data $g_D(\\mathbf{x},t)$:** This is the trace of the manufactured solution on the boundary $\\partial \\Omega$.\n  $$ g_D(\\mathbf{x},t) = p(\\mathbf{x},t)|_{\\mathbf{x} \\in \\partial \\Omega} = \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t) $$\n- **Neumann flux $g_N(\\mathbf{x},t)$:** This is the natural boundary flux.\n  $$ g_N(\\mathbf{x},t) = \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n} = \\frac{1}{\\rho_0(1+\\epsilon x)} (\\partial_x p \\cdot n_x + \\partial_y p \\cdot n_y) $$\n  Substituting the partial derivatives of $p$:\n  $$ g_N(\\mathbf{x},t) = \\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\left( n_x k_x \\cos(k_x x) \\sin(k_y y) + n_y k_y \\sin(k_x x) \\cos(k_y y) \\right) $$\n\n**3. Initial Data**\n- **Initial pressure $p(\\mathbf{x},0)$:** The solution evaluated at $t=0$.\n  $$ p(\\mathbf{x},0) = \\sin(k_x x) \\sin(k_y y) \\cos(0) = \\sin(k_x x) \\sin(k_y y) $$\n- **Initial pressure time derivative $\\partial_t p(\\mathbf{x},0)$:** The time derivative evaluated at $t=0$.\n  $$ \\partial_t p(\\mathbf{x},t) = -\\omega \\sin(k_x x) \\sin(k_y y) \\sin(\\omega t) $$\n  $$ \\partial_t p(\\mathbf{x},0) = -\\omega \\sin(k_x x) \\sin(k_y y) \\sin(0) = 0 $$",
            "answer": "$$ \\boxed{\n\\begin{pmatrix}\n\\left( \\left[ \\frac{k_x^2+k_y^2}{\\rho_0(1+\\epsilon x)} - \\frac{\\omega^2}{\\kappa_0} \\right] \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y)}{\\rho_0(1+\\epsilon x)^2} \\right) \\cos(\\omega t)\n\\\\\n\\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)\n\\\\\n\\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\left( n_x k_x \\cos(k_x x) \\sin(k_y y) + n_y k_y \\sin(k_x x) \\cos(k_y y) \\right)\n\\\\\n\\sin(k_x x) \\sin(k_y y)\n\\\\\n0\n\\end{pmatrix}\n} $$"
        }
    ]
}