{
    "hands_on_practices": [
        {
            "introduction": "谱元法（SEM）的核心在于将复杂的求解域分解为简单的参考单元。这个练习将带你从第一性原理出发，推导和计算一维谱单元的关键组成部分：高斯-洛巴托-勒让德（GLL）节点和权重，并组装单元质量矩阵和刚度矩阵。通过这个过程，你将亲身体会到谱元法对角质量矩阵这一显著计算优势的来源。",
            "id": "4145034",
            "problem": "考虑一维参考单元 $\\xi \\in [-1,1]$，将其应用于谱元法（SEM）求解线性声学问题，其中密度和体积模量均为单位值，因此双线性形式简化为标准的 $L^{2}$ 内积和 $H^{1}$ 半范数。设多项式阶数为 $p=4$，并采用 $[-1,1]$ 上的 $p+1=5$ 个点的Gauss–Lobatto–Legendre (GLL) 节点集。利用Legendre多项式的基本性质，首先确定这5个GLL节点 $\\{\\xi_{i}\\}_{i=0}^{4}$ 及其相关的GLL求积权重 $\\{w_{i}\\}_{i=0}^{4}$。接下来，构建在这些节点上插值的节点Lagrange基 $\\{\\ell_{i}(\\xi)\\}_{i=0}^{4}$，并组集局部单元级的相容质量矩阵和刚度矩阵，\n$$\nM_{ij} \\equiv \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi,\\qquad\nK_{ij} \\equiv \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}(\\xi)\\,\\frac{d\\ell_{j}}{d\\xi}(\\xi)\\,d\\xi,\\quad i,j=0,\\dots,4.\n$$\n从Legendre多项式的定义性质、GLL求积的构造（包括端点，内部节点为p阶Legendre多项式导数的根）以及节点Lagrange多项式的定义出发。仅使用这些基础来证明在GLL求积配置下质量矩阵的对角性，并解释在此单个参考单元上刚度矩阵产生的非零模式（带宽）。\n\n最后，报告质量矩阵 $M$ 的行列式作为你的答案。将最终值表示为一个精确的有理数。不需要四舍五入，也不涉及单位。最终答案必须是单个以精确形式表示的实数。",
            "solution": "该问题提法明确且科学上合理，是谱元法（SEM）构建中的一个标准练习。我们开始求解。\n\n问题设定在一维参考单元 $\\xi \\in [-1,1]$ 上，多项式逼近阶数为 $p=4$。节点基使用 $p+1=5$ 个Gauss–Lobatto–Legendre (GLL) 点构建。\n\n首先，我们确定GLL节点 $\\{\\xi_{i}\\}_{i=0}^{4}$ 及其相关的求积权重 $\\{w_{i}\\}_{i=0}^{4}$。对于多项式阶数 $p$，$p+1$ 个GLL节点是多项式 $(1-\\xi^2)P'_{p}(\\xi)$ 的根，其中 $P_{p}(\\xi)$ 是 $p$ 阶Legendre多项式。端点 $\\xi=-1$ 和 $\\xi=1$ 总是包含在内。$p-1$ 个内部节点是Legendre多项式一阶导数 $P'_{p}(\\xi)$ 的根。\n\n对于 $p=4$，我们需要Legendre多项式 $P_4(\\xi)$。前几个Legendre多项式是：\n$P_0(\\xi) = 1$\n$P_1(\\xi) = \\xi$\n$P_2(\\xi) = \\frac{1}{2}(3\\xi^2 - 1)$\n$P_3(\\xi) = \\frac{1}{2}(5\\xi^3 - 3\\xi)$\n$P_4(\\xi) = \\frac{1}{8}(35\\xi^4 - 30\\xi^2 + 3)$\n\n其导数 $P'_4(\\xi)$ 为：\n$$ P'_4(\\xi) = \\frac{d}{d\\xi} \\left[ \\frac{1}{8}(35\\xi^4 - 30\\xi^2 + 3) \\right] = \\frac{1}{8}(140\\xi^3 - 60\\xi) = \\frac{5}{2}\\xi(7\\xi^2 - 3) $$\n内部GLL节点是 $P'_4(\\xi)=0$ 的根，即 $\\xi=0$ 和 $\\xi^2 = \\frac{3}{7}$，解得 $\\xi = \\pm\\sqrt{\\frac{3}{7}}$。\n包括端点并对节点排序，我们得到5个GLL节点：\n$$ \\xi_0 = -1, \\quad \\xi_1 = -\\sqrt{\\frac{3}{7}}, \\quad \\xi_2 = 0, \\quad \\xi_3 = \\sqrt{\\frac{3}{7}}, \\quad \\xi_4 = 1 $$\nGLL求积权重 $w_i$ 由以下公式给出：\n$$ w_i = \\frac{2}{p(p+1)[P_p(\\xi_i)]^2} $$\n对于 $p=4$，公式变为 $w_i = \\frac{2}{4(5)[P_4(\\xi_i)]^2} = \\frac{1}{10[P_4(\\xi_i)]^2}$。\n我们对每个节点计算 $P_4(\\xi_i)$ 的值：\n对于端点 $\\xi_0 = -1$ 和 $\\xi_4 = 1$，我们有 $P_4(\\pm 1) = 1$。权重为：\n$$ w_0 = w_4 = \\frac{1}{10[P_4(1)]^2} = \\frac{1}{10(1)^2} = \\frac{1}{10} $$\n对于内部节点 $\\xi_2 = 0$：\n$$ P_4(0) = \\frac{1}{8}(3) = \\frac{3}{8} $$\n$$ w_2 = \\frac{1}{10[P_4(0)]^2} = \\frac{1}{10(\\frac{3}{8})^2} = \\frac{1}{10(\\frac{9}{64})} = \\frac{64}{90} = \\frac{32}{45} $$\n对于内部节点 $\\xi_1 = -\\sqrt{\\frac{3}{7}}$ 和 $\\xi_3 = \\sqrt{\\frac{3}{7}}$（注意 $P_4(\\xi)$ 是一个偶函数）：\n$$ P_4\\left(\\pm\\sqrt{\\frac{3}{7}}\\right) = \\frac{1}{8}\\left(35\\left(\\frac{3}{7}\\right)^2 - 30\\left(\\frac{3}{7}\\right) + 3\\right) = \\frac{1}{8}\\left(35\\frac{9}{49} - \\frac{90}{7} + 3\\right) = \\frac{1}{8}\\left(\\frac{45}{7} - \\frac{90}{7} + \\frac{21}{7}\\right) = \\frac{1}{8}\\left(\\frac{-24}{7}\\right) = -\\frac{3}{7} $$\n$$ w_1 = w_3 = \\frac{1}{10\\left[P_4\\left(\\pm\\sqrt{\\frac{3}{7}}\\right)\\right]^2} = \\frac{1}{10\\left(-\\frac{3}{7}\\right)^2} = \\frac{1}{10\\left(\\frac{9}{49}\\right)} = \\frac{49}{90} $$\n权重集合为 $\\{w_i\\}_{i=0}^4 = \\{\\frac{1}{10}, \\frac{49}{90}, \\frac{32}{45}, \\frac{49}{90}, \\frac{1}{10}\\}$。作为检验，权重之和为 $\\sum w_i = 2 \\cdot \\frac{1}{10} + 2 \\cdot \\frac{49}{90} + \\frac{32}{45} = \\frac{9}{45} + \\frac{49}{45} + \\frac{32}{45} = \\frac{90}{45} = 2$，这是正确的，因为 $\\int_{-1}^1 d\\xi = 2$。\n\n接下来，我们处理单元矩阵。基函数是节点Lagrange多项式 $\\{\\ell_j(\\xi)\\}_{j=0}^4$，它们是唯一的 $p=4$ 阶多项式，满足插值性质 $\\ell_j(\\xi_i) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是Kronecker delta。\n\n相容质量矩阵定义为 $M_{ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi$。\n在SEM的背景下，积分通常使用GLL求积法计算。具有 $p+1$ 个点的GLL求积法则对于阶数最高为 $2(p+1)-3 = 2p-1$ 的多项式是精确的。这里，对于 $p=4$，GLL求积对阶数最高为 $2(4)-1=7$ 的多项式是精确的。被积函数 $\\ell_i(\\xi)\\ell_j(\\xi)$ 是一个阶数最高为 $2p = 8$ 的多项式。由于 $8>7$，GLL求积对于相容质量矩阵不是精确的。\n\n然而，SEM的一个关键特征是“质量集中”（mass lumping），即质量矩阵的积分被有意地用GLL求积法来近似。这就是问题中要求“证明在GLL求积配置下质量矩阵的对角性”所指的内容。配置的或集中的质量矩阵是：\n$$ M_{ij}^{GLL} = \\sum_{k=0}^{4} w_k \\ell_i(\\xi_k) \\ell_j(\\xi_k) $$\n利用性质 $\\ell_i(\\xi_k) = \\delta_{ik}$，该表达式简化为：\n$$ M_{ij}^{GLL} = \\sum_{k=0}^{4} w_k \\delta_{ik} \\delta_{jk} $$\n该求和仅在 $k=i$ 和 $k=j$ 时非零，这要求 $i=j$。因此，该矩阵是对角矩阵：\n$$ M_{ij}^{GLL} = w_i \\delta_{ij} $$\n集中质量矩阵是对角矩阵，其对角线元素为求积权重。这种对角结构是SEM的一个主要计算优势。\n\n刚度矩阵定义为 $K_{ij} = \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}(\\xi)\\,\\frac{d\\ell_{j}}{d\\xi}(\\xi)\\,d\\xi$。\n一个 $p=4$ 阶Lagrange多项式的导数是一个 $p-1=3$ 阶的多项式。因此，被积函数 $\\frac{d\\ell_{i}}{d\\xi}\\frac{d\\ell_{j}}{d\\xi}$ 是一个阶数为 $2(p-1)=6$ 的多项式。由于 $6 \\le 7$，GLL求积对于刚度矩阵是**精确**的。因此，刚度矩阵可计算为：\n$$ K_{ij} = \\sum_{k=0}^{4} w_k \\frac{d\\ell_{i}}{d\\xi}(\\xi_k) \\frac{d\\ell_{j}}{d\\xi}(\\xi_k) $$\n为了解释其非零模式，我们考虑导数矩阵 $D_{ki} = \\frac{d\\ell_{i}}{d\\xi}(\\xi_k)$。与Lagrange多项式本身不同，它们的导数在节点处通常是非零的（除了可能由于对称性在少数点上为零）。微分矩阵 $D$ 是一个稠密的 $5 \\times 5$ 矩阵。刚度矩阵可以写成矩阵形式 $K = D^T W D$，其中 $W$ 是权重的对角矩阵。这些矩阵的乘积得到一个稠密的（完全填充的）$5 \\times 5$ 矩阵。因此，在这个单一参考单元上，局部刚度矩阵的非零模式是它是一个满矩阵，在这种情况下，其带宽不是一个有意义的稀疏矩阵概念。\n\n最后，我们被要求报告质量矩阵 $M$ 的行列式。鉴于上下文和在GLL配置下解释对角性的要求，通常的做法是在此计算背景下将“质量矩阵”解释为集中质量矩阵 $M^{GLL}$。相容质量矩阵的行列式需要更复杂的符号计算。对角集中质量矩阵的行列式是其对角线元素（即求积权重）的乘积。\n$$ \\det(M) = \\det(M^{GLL}) = \\prod_{i=0}^{4} w_i = w_0 w_1 w_2 w_3 w_4 $$\n代入计算出的权重：\n$$ \\det(M) = \\left(\\frac{1}{10}\\right) \\left(\\frac{49}{90}\\right) \\left(\\frac{32}{45}\\right) \\left(\\frac{49}{90}\\right) \\left(\\frac{1}{10}\\right) $$\n$$ \\det(M) = \\frac{1 \\cdot 49 \\cdot 32 \\cdot 49 \\cdot 1}{10 \\cdot 90 \\cdot 45 \\cdot 90 \\cdot 10} = \\frac{49^2 \\cdot 32}{10^2 \\cdot 90^2 \\cdot 45} = \\frac{2401 \\cdot 32}{100 \\cdot 8100 \\cdot 45} = \\frac{76832}{36450000} $$\n为了简化此分数，我们使用素因数分解：\n$76832 = 2^5 \\cdot 7^4$\n$36450000 = 3645 \\cdot 10^4 = (5 \\cdot 729) \\cdot (2 \\cdot 5)^4 = (5 \\cdot 3^6) \\cdot (2^4 \\cdot 5^4) = 2^4 \\cdot 3^6 \\cdot 5^5$\n$$ \\det(M) = \\frac{2^5 \\cdot 7^4}{2^4 \\cdot 3^6 \\cdot 5^5} = \\frac{2 \\cdot 7^4}{3^6 \\cdot 5^5} = \\frac{2 \\cdot 2401}{729 \\cdot 3125} = \\frac{4802}{2278125} $$\n这是作为精确有理数的最终答案。",
            "answer": "$$ \\boxed{\\frac{4802}{2278125}} $$"
        },
        {
            "introduction": "验证数值代码的正确性是计算科学中的一个基本挑战。制造解方法（MMS）是一种强大而严谨的技术，它通过构造一个解析解来反推出相应的源项和边界条件，从而能够精确地检验代码是否正确实现了控制方程。这个练习将指导你完成MMS测试所需的分析推导，这是开发和验证可靠的模拟工具所必需的一项核心技能。",
            "id": "4145097",
            "problem": "考虑在矩形域 $\\Omega = [0,L_{x}] \\times [0,L_{y}]$ 上的非均匀介质中的线性声学问题，其边界 $\\partial \\Omega$ 上的外向单位法向量为 $\\mathbf{n}(\\mathbf{x})$。设质量密度为 $\\rho(\\mathbf{x}) = \\rho_{0}(1+\\epsilon x)$，体积模量为 $\\kappa(\\mathbf{x}) = \\kappa_{0}$，其中 $\\rho_{0} > 0$，$\\kappa_{0} > 0$ 和 $\\epsilon \\ge 0$ 是常数。声压 $p(\\mathbf{x},t)$ 满足强形式的二阶标量波动方程\n$$\n\\frac{1}{\\kappa_{0}} \\,\\partial_{tt} p(\\mathbf{x},t) - \\nabla \\cdot \\left( \\frac{1}{\\rho_{0}(1+\\epsilon x)} \\, \\nabla p(\\mathbf{x},t) \\right) = f(\\mathbf{x},t) \\quad \\text{in } \\Omega \\times (0,T],\n$$\n以及相应的边界和初始条件。为了对谱元法（SEM）进行代码验证，您将使用人工解方法（MMS）：构造一个光滑、非平凡的人工解 $p(\\mathbf{x},t)$，然后推导出强迫项 $f(\\mathbf{x},t)$、相容的边界数据和初始数据，使得该 $p(\\mathbf{x},t)$ 精确满足上述方程和边界/初始条件。\n\n具体来说，取人工解为\n$$\np(\\mathbf{x},t) = \\sin(k_{x} x)\\,\\sin(k_{y} y)\\,\\cos(\\omega t),\n$$\n其中 $k_{x} > 0$，$k_{y} > 0$ 和 $\\omega > 0$ 是给定的常数。使用线性声学的第一性原理和作为谱元法（SEM）基础的弱形式，完成以下任务：\n\n- 从线性化的动量和连续性方程出发，论证上述带有非均匀系数的二阶标量波动方程的合理性，并找出在弱形式中通过分部积分出现的自然边界通量。\n- 计算源项 $f(\\mathbf{x},t)$，使所选的 $p(\\mathbf{x},t)$ 成为强形式的精确解。\n- 对于边界 $\\partial \\Omega$ 上具有外向单位法向量 $\\mathbf{n}(\\mathbf{x}) = (n_{x}(\\mathbf{x}), n_{y}(\\mathbf{x}))$ 的任意边界段，推导与弱形式相容的狄利克雷边界数据 $g_{D}(\\mathbf{x},t)$ 和诺伊曼边界通量 $g_{N}(\\mathbf{x},t)$。\n- 给出初始压力 $p(\\mathbf{x},0)$ 和初始压力时间导数 $\\partial_{t} p(\\mathbf{x},0)$。\n\n将最终结果表示为一个单一的闭式解析表达式，依次包含五个量 $\\big(f(\\mathbf{x},t),\\, g_{D}(\\mathbf{x},t),\\, g_{N}(\\mathbf{x},t),\\, p(\\mathbf{x},0),\\, \\partial_{t} p(\\mathbf{x},0)\\big)$。无需进行数值计算。",
            "solution": "用户希望解决一个与声学波动方程的人工解方法（MMS）相关的问题。\n\n### 问题验证\n\n我将首先根据指定标准验证问题陈述。\n\n#### 步骤 1：提取已知条件\n\n-   **域：** 矩形域 $\\Omega = [0,L_{x}] \\times [0,L_{y}]$。\n-   **边界：** $\\partial \\Omega$，其外向单位法向量为 $\\mathbf{n}(\\mathbf{x})$。\n-   **质量密度：** $\\rho(\\mathbf{x}) = \\rho_{0}(1+\\epsilon x)$，其中 $\\rho_{0} > 0$ 且 $\\epsilon \\ge 0$。\n-   **体积模量：** $\\kappa(\\mathbf{x}) = \\kappa_{0}$，其中 $\\kappa_{0} > 0$。\n-   **控制方程（强形式）：**\n    $$ \\frac{1}{\\kappa_{0}} \\,\\partial_{tt} p(\\mathbf{x},t) - \\nabla \\cdot \\left( \\frac{1}{\\rho_{0}(1+\\epsilon x)} \\, \\nabla p(\\mathbf{x},t) \\right) = f(\\mathbf{x},t) \\quad \\text{in } \\Omega \\times (0,T] $$\n-   **人工解：**\n    $$ p(\\mathbf{x},t) = \\sin(k_{x} x)\\,\\sin(k_{y} y)\\,\\cos(\\omega t) $$\n    其中 $k_{x} > 0$，$k_{y} > 0$ 和 $\\omega > 0$ 是常数。\n-   **要求任务：**\n    1.  从线性声学的第一性原理（线性化动量和连续性方程）出发，论证二阶波动方程的合理性，并从弱形式中确定自然边界通量。\n    2.  计算源项 $f(\\mathbf{x},t)$。\n    3.  推导狄利克雷边界数据 $g_{D}(\\mathbf{x},t)$。\n    4.  推导诺伊曼边界通量 $g_{N}(\\mathbf{x},t)$。\n    5.  给出初始压力 $p(\\mathbf{x},0)$。\n    6.  给出初始压力时间导数 $\\partial_{t} p(\\mathbf{x},0)$。\n-   **最终输出格式：** 一个单一的闭式解析表达式，包含五个量 $\\big(f(\\mathbf{x},t),\\, g_{D}(\\mathbf{x},t),\\, g_{N}(\\mathbf{x},t),\\, p(\\mathbf{x},0),\\, \\partial_{t} p(\\mathbf{x},0)\\big)$。\n\n#### 步骤 2：使用提取的已知条件进行验证\n\n-   **科学依据：** 该问题基于非均匀介质中的标准线性声学波动方程。密度和体积模量的形式是物理上合理的模型，用于描述在一个方向上具有连续梯度的介质。人工解方法是计算科学与工程中用于代码验证的标准且严谨的技术。该问题在科学和数学上是合理的。\n-   **适定性：** 任务是推导与所选解析解相对应的强迫项和边界/初始数据。这是一个定义明确、直接代入和求导的问题。待推导量的存在性和唯一性是有保证的。\n-   **客观性：** 问题以精确的数学语言陈述，没有模糊或主观的论断。\n-   **完整性和一致性：** 所有必要信息（偏微分方程、人工解、材料属性）均已提供。没有矛盾之处。\n-   **主题相关性：** 该问题与谱元法（SEM）和计算声学直接相关，因为 MMS 是验证 SEM 代码的基石，而弱形式是 SEM 的基础。\n\n#### 步骤 3：结论和行动\n\n问题有效。我将继续构建解决方案。\n\n### 解决方案\n\n解决方案按要求包含四个部分：论证控制方程及其弱形式的合理性，然后推导人工解方法（MMS）所需的各项。\n\n#### 波动方程及其弱形式的论证\n\n我们从非均匀介质中静止流体的声学一阶线性化方程开始，其密度为 $\\rho(\\mathbf{x})$，体积模量为 $\\kappa(\\mathbf{x})$。声压为 $p(\\mathbf{x},t)$，质点速度为 $\\mathbf{u}(\\mathbf{x},t)$。\n\n1.  **线性化动量方程：**\n    $$ \\rho(\\mathbf{x}) \\frac{\\partial \\mathbf{u}}{\\partial t} (\\mathbf{x},t) = -\\nabla p(\\mathbf{x},t) $$\n2.  **线性化连续性方程：**\n    $$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial p}{\\partial t} (\\mathbf{x},t) + \\nabla \\cdot \\mathbf{u}(\\mathbf{x},t) = 0 $$\n\n为了推导关于压力的二阶波动方程，我们可以消去速度 $\\mathbf{u}$。将连续性方程对时间 $t$ 求导，得到：\n$$ \\frac{\\partial}{\\partial t} \\left( \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial p}{\\partial t} \\right) + \\nabla \\cdot \\left( \\frac{\\partial \\mathbf{u}}{\\partial t} \\right) = 0 $$\n由于 $\\kappa$ 不是时间的函数，上式可简化为：\n$$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial^2 p}{\\partial t^2} + \\nabla \\cdot \\left( \\frac{\\partial \\mathbf{u}}{\\partial t} \\right) = 0 $$\n从动量方程，我们可以将 $\\frac{\\partial \\mathbf{u}}{\\partial t}$ 表示为：\n$$ \\frac{\\partial \\mathbf{u}}{\\partial t} = -\\frac{1}{\\rho(\\mathbf{x})} \\nabla p $$\n将此式代入经时间求导的连续性方程，我们得到：\n$$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial^2 p}{\\partial t^2} + \\nabla \\cdot \\left( -\\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) = 0 $$\n$$ \\frac{1}{\\kappa(\\mathbf{x})} \\frac{\\partial^2 p}{\\partial t^2} - \\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) = 0 $$\n添加一个外部源项 $f(\\mathbf{x},t)$ 就得到了问题陈述中指定的控制方程。给定 $\\rho(\\mathbf{x})=\\rho_{0}(1+\\epsilon x)$ 和 $\\kappa(\\mathbf{x})=\\kappa_{0}$，这与问题的偏微分方程相符。\n\n为了推导弱形式，我们将偏微分方程乘以一个合适的测试函数 $v(\\mathbf{x})$ 并在域 $\\Omega$ 上积分：\n$$ \\int_{\\Omega} v \\left( \\frac{1}{\\kappa_{0}} \\partial_{tt}p - \\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\right) \\right) d\\mathbf{x} = \\int_{\\Omega} v f d\\mathbf{x} $$\n对散度项应用格林第一恒等式（分部积分）：\n$$ \\int_{\\Omega} -v \\nabla \\cdot \\left( \\frac{1}{\\rho} \\nabla p \\right) d\\mathbf{x} = \\int_{\\Omega} \\nabla v \\cdot \\left(\\frac{1}{\\rho} \\nabla p \\right) d\\mathbf{x} - \\int_{\\partial \\Omega} v \\left( \\frac{1}{\\rho} \\nabla p \\cdot \\mathbf{n} \\right) dS $$\n于是弱形式为：\n求 $p$，使得对于所有容许的测试函数 $v$：\n$$ \\int_{\\Omega} \\frac{1}{\\kappa_{0}} v \\partial_{tt}p \\,d\\mathbf{x} + \\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\nabla v \\cdot \\nabla p \\,d\\mathbf{x} = \\int_{\\Omega} v f \\,d\\mathbf{x} + \\int_{\\partial\\Omega} v \\left(\\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n}\\right) dS $$\n边界积分中出现的项 $\\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n}$ 是**自然边界通量**，它在诺伊曼型边界条件中被施加。这就是我们需要计算的通量 $g_N(\\mathbf{x},t)$。\n\n#### 第 1 部分：源项 $f(\\mathbf{x},t)$\n\n为了求出源项 $f(\\mathbf{x},t)$，我们将人工解 $p(\\mathbf{x},t) = \\sin(k_{x} x)\\sin(k_{y} y)\\cos(\\omega t)$ 代入偏微分方程的左侧算子。\n首先，我们计算 $p$ 的必要导数：\n$$ \\partial_{t} p = -\\omega \\sin(k_x x) \\sin(k_y y) \\sin(\\omega t) $$\n$$ \\partial_{tt} p = -\\omega^2 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t) = -\\omega^2 p $$\n$p$ 的梯度是：\n$$ \\nabla p = \\begin{pmatrix} \\partial_x p \\\\ \\partial_y p \\end{pmatrix} = \\cos(\\omega t) \\begin{pmatrix} k_x \\cos(k_x x) \\sin(k_y y) \\\\ k_y \\sin(k_x x) \\cos(k_y y) \\end{pmatrix} $$\n接下来，我们计算 $\\frac{1}{\\rho(\\mathbf{x})}\\nabla p$：\n$$ \\frac{1}{\\rho(\\mathbf{x})}\\nabla p = \\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\begin{pmatrix} k_x \\cos(k_x x) \\sin(k_y y) \\\\ k_y \\sin(k_x x) \\cos(k_y y) \\end{pmatrix} $$\n现在，我们求这个向量场（我们称之为 $\\mathbf{F}(\\mathbf{x},t)$）的散度：\n$$ \\nabla \\cdot \\mathbf{F} = \\partial_x F_x + \\partial_y F_y $$\n$$ \\partial_x F_x = \\frac{\\partial}{\\partial x} \\left( \\frac{k_x \\cos(k_x x) \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\right) = \\frac{k_x \\sin(k_y y) \\cos(\\omega t)}{\\rho_0} \\frac{\\partial}{\\partial x}\\left( \\frac{\\cos(k_x x)}{1+\\epsilon x} \\right) $$\n使用商法则：\n$$ \\frac{\\partial}{\\partial x}\\left( \\frac{\\cos(k_x x)}{1+\\epsilon x} \\right) = \\frac{-k_x \\sin(k_x x)(1+\\epsilon x) - \\cos(k_x x)(\\epsilon)}{(1+\\epsilon x)^2} $$\n所以，\n$$ \\partial_x F_x = -\\frac{k_x \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)^2} \\left[ k_x(1+\\epsilon x)\\sin(k_x x) + \\epsilon \\cos(k_x x) \\right] $$\n对于 $y$ 分量：\n$$ \\partial_y F_y = \\frac{\\partial}{\\partial y} \\left( \\frac{k_y \\sin(k_x x) \\cos(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\right) = \\frac{k_y \\sin(k_x x) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} (-k_y \\sin(k_y y)) = -\\frac{k_y^2 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} $$\n将这些组合起来，我们得到 $\\nabla \\cdot (\\frac{1}{\\rho} \\nabla p) = \\partial_x F_x + \\partial_y F_y$：\n$$ \\nabla \\cdot \\left(\\frac{1}{\\rho} \\nabla p\\right) = -\\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)^2} \\left[ \\left( k_x^2(1+\\epsilon x) + k_y^2(1+\\epsilon x) \\right) \\sin(k_x x)\\sin(k_y y) + k_x\\epsilon \\cos(k_x x)\\sin(k_y y) \\right] $$\n$$ = -\\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} (k_x^2+k_y^2) \\sin(k_x x)\\sin(k_y y) - \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)^2} $$\n最后，我们组合出源项 $f(\\mathbf{x}, t) = \\frac{1}{\\kappa_0} \\partial_{tt}p - \\nabla \\cdot (\\frac{1}{\\rho} \\nabla p)$：\n$$ f(\\mathbf{x},t) = -\\frac{\\omega^2}{\\kappa_0} \\sin(k_x x)\\sin(k_y y)\\cos(\\omega t) + \\frac{(k_x^2+k_y^2)\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y) \\cos(\\omega t)}{\\rho_0(1+\\epsilon x)^2} $$\n因式分解后得到：\n$$ f(\\mathbf{x},t) = \\left( \\left[ \\frac{k_x^2+k_y^2}{\\rho_0(1+\\epsilon x)} - \\frac{\\omega^2}{\\kappa_0} \\right] \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y)}{\\rho_0(1+\\epsilon x)^2} \\right) \\cos(\\omega t) $$\n\n#### 第 2 部分：边界数据 $g_D(\\mathbf{x},t)$ 和 $g_N(\\mathbf{x},t)$\n\n-   **狄利克雷边界数据, $g_D(\\mathbf{x},t)$：** 这是人工解在边界 $\\partial \\Omega$ 上的迹。\n    $$ g_D(\\mathbf{x},t) = p(\\mathbf{x},t)|_{\\mathbf{x} \\in \\partial \\Omega} = \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t) $$\n-   **诺伊曼边界通量, $g_N(\\mathbf{x},t)$：** 这是从弱形式中确定的自然边界通量。\n    $$ g_N(\\mathbf{x},t) = \\frac{1}{\\rho(\\mathbf{x})} \\nabla p \\cdot \\mathbf{n} = \\frac{1}{\\rho_0(1+\\epsilon x)} (\\partial_x p \\cdot n_x + \\partial_y p \\cdot n_y) $$\n    代入 $p$ 的偏导数表达式：\n    $$ g_N(\\mathbf{x},t) = \\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\left( n_x k_x \\cos(k_x x) \\sin(k_y y) + n_y k_y \\sin(k_x x) \\cos(k_y y) \\right) $$\n    其中 $\\mathbf{n}(\\mathbf{x}) = (n_x(\\mathbf{x}), n_y(\\mathbf{x}))$ 是边界 $\\partial\\Omega$ 上一点 $\\mathbf{x}$ 处的外向单位法向量。\n\n#### 第 3 部分：初始数据\n\n-   **初始压力, $p(\\mathbf{x},0)$：** 这是在 $t=0$ 时的人工解的值。\n    $$ p(\\mathbf{x},0) = \\sin(k_x x) \\sin(k_y y) \\cos(\\omega \\cdot 0) = \\sin(k_x x) \\sin(k_y y) $$\n-   **初始压力时间导数, $\\partial_t p(\\mathbf{x},0)$：**\n    $$ \\partial_t p(\\mathbf{x},t) = -\\omega \\sin(k_x x) \\sin(k_y y) \\sin(\\omega t) $$\n    在 $t=0$ 时求值：\n    $$ \\partial_t p(\\mathbf{x},0) = -\\omega \\sin(k_x x) \\sin(k_y y) \\sin(\\omega \\cdot 0) = 0 $$\n\n#### 结果摘要\n\n人工解方法所需的五个量是：\n1.  $f(\\mathbf{x},t) = \\left( \\left[ \\frac{k_x^2+k_y^2}{\\rho_0(1+\\epsilon x)} - \\frac{\\omega^2}{\\kappa_0} \\right] \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y)}{\\rho_0(1+\\epsilon x)^2} \\right) \\cos(\\omega t)$\n2.  $g_D(\\mathbf{x},t) = \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)$\n3.  $g_N(\\mathbf{x},t) = \\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\left( n_x k_x \\cos(k_x x) \\sin(k_y y) + n_y k_y \\sin(k_x x) \\cos(k_y y) \\right)$\n4.  $p(\\mathbf{x},0) = \\sin(k_x x) \\sin(k_y y)$\n5.  $\\partial_t p(\\mathbf{x},0) = 0$",
            "answer": "$$ \\boxed{\n\\begin{pmatrix}\n\\left( \\left[ \\frac{k_x^2+k_y^2}{\\rho_0(1+\\epsilon x)} - \\frac{\\omega^2}{\\kappa_0} \\right] \\sin(k_x x)\\sin(k_y y) + \\frac{k_x\\epsilon \\cos(k_x x)\\sin(k_y y)}{\\rho_0(1+\\epsilon x)^2} \\right) \\cos(\\omega t)\n\n\\sin(k_x x) \\sin(k_y y) \\cos(\\omega t)\n\n\\frac{\\cos(\\omega t)}{\\rho_0(1+\\epsilon x)} \\left( n_x k_x \\cos(k_x x) \\sin(k_y y) + n_y k_y \\sin(k_x x) \\cos(k_y y) \\right)\n\n\\sin(k_x x) \\sin(k_y y)\n\n0\n\\end{pmatrix}\n} $$"
        },
        {
            "introduction": "从单个单元矩阵到完整的求解域模拟，需要经过全局组装和施加边界条件这两个关键步骤。对于显式时间积分方法，数值稳定性是决定计算成败的首要因素。本练习将引导你分析一个完整的半离散系统，并推导出保证蛙跳法（leapfrog scheme）稳定的最大时间步长，这是一个对任何显式谱元模拟都至关重要的实践问题。",
            "id": "4144970",
            "problem": "本题要求您推导、实现并评估应用于一维线性声学的谱元法（SEM）中受稳定性限制的显式时间步长。考虑区间 $[0,L]$ 上带狄利克雷边界条件的一维齐次声波方程，\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}, \\quad x \\in [0,L], \\quad p(0,t) = 0, \\quad p(L,t) = 0,\n$$\n其中 $p(x,t)$ 是声压，$c$ 是声速。在每个单元上使用谱元法（SEM），其采用勒让德-高斯-洛巴托（LGL）节点和阶数为 $p$ 的拉格朗日插值多项式。假设网格均匀，包含 $E$ 个单元，每个单元的长度为 $h = L/E$。使用 LGL 求积构建对角质量矩阵和与弱形式一致的刚度矩阵。通过组装包含共享界面节点的全局 $C^0$ 连续离散系统，以在单元界面上施加连续性。通过从组装后的系统中消除 $x=0$ 和 $x=L$ 处的边界自由度来施加狄利克雷边界条件。\n\n从适当的基本原理出发，推导蛙跳（显式中心差分）时间积分格式如何应用于所得的半离散系统，并确定由离散空间算子谱约束的最大稳定时间步长 $\\Delta t$（单位为秒）。请勿假设或使用任何简便公式；从弱形式和蛙跳法的定义出发，依据第一性原理推导出稳定性条件。\n\n您的程序必须：\n- 使用映射 $x(\\xi)$（其雅可比为 $J = h/2$）、$p$ 阶 LGL 节点上的拉格朗日基函数、在 LGL 节点上求值的 $\\partial \\ell_j / \\partial \\xi$ 项构成的节点导数矩阵以及 LGL 求积权重，在参考区间 $\\xi \\in [-1,1]$ 上构建局部单元矩阵。\n- 组装整个区域的全局对角质量矩阵和全局刚度矩阵，通过识别单元界面处的共享节点来强制实现 $C^0$ 连续性。\n- 通过消除对应于 $x=0$ 和 $x=L$ 处节点的边界自由度来应用齐次狄利克雷边界条件。\n- 计算由组装矩阵给出的广义特征值问题的最大特征值，然后仅根据半离散系统的稳定性分析推导出蛙跳格式的最大稳定 $\\Delta t$。\n\n单位和输出：\n- 所有几何量必须以米（$\\mathrm{m}$）为单位处理。\n- 声速必须以米/秒（$\\mathrm{m/s}$）为单位。\n- 最终答案 $\\Delta t$ 必须以秒（$\\mathrm{s}$）表示，并四舍五入到八位小数。\n\n测试组：\n对于以下每组参数 $(L,E,p,c)$，计算最大稳定时间步长 $\\Delta t$（单位为秒），四舍五入到八位小数：\n1. $(L=1.0, E=4, p=4, c=343.0)$\n2. $(L=2.0, E=8, p=6, c=1500.0)$\n3. $(L=1.0, E=1, p=2, c=2000.0)$\n4. $(L=1.0, E=2, p=1, c=1000.0)$\n5. $(L=0.3, E=12, p=8, c=343.0)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个结果，形式为方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4,result5]”），顺序与上述测试组相同。每个结果必须是浮点数，四舍五入到八位小数，并以秒为单位表示。",
            "solution": "该问题要求针对使用谱元法（SEM）和显式蛙跳时间积分格式离散的一维声波方程，推导并实现最大稳定时间步长 $\\Delta t_{max}$。推导过程必须从第一性原理开始。\n\n控制方程为在域 $x \\in [0,L]$ 上的齐次一维声波方程，带有齐次狄利克雷边界条件：\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}, \\quad p(0,t) = 0, \\quad p(L,t) = 0\n$$\n其中 $p(x,t)$ 是声压，$c$ 是声速。\n\n**1. 弱形式**\n为了推导弱形式，我们将波动方程乘以一个与解属于同一函数空间的合适测试函数 $v(x)$，并在域 $[0,L]$ 上进行积分。测试函数也必须满足齐次边界条件，即 $v(0)=v(L)=0$。\n$$\n\\int_0^L v \\frac{\\partial^2 p}{\\partial t^2} dx = \\int_0^L v c^2 \\frac{\\partial^2 p}{\\partial x^2} dx\n$$\n我们对右侧项应用分部积分：\n$$\n\\int_0^L v c^2 \\frac{\\partial^2 p}{\\partial x^2} dx = \\left[ v c^2 \\frac{\\partial p}{\\partial x} \\right]_0^L - \\int_0^L c^2 \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} dx\n$$\n边界项 $\\left[ v c^2 \\frac{\\partial p}{\\partial x} \\right]_0^L$ 为零，因为测试函数 $v(x)$ 在边界 $x=0$ 和 $x=L$ 处为零。这得到了方程的弱形式：找到 $p(x,t)$，使得对于所有容许的测试函数 $v(x)$，\n$$\n\\int_0^L v \\frac{\\partial^2 p}{\\partial t^2} dx = -c^2 \\int_0^L \\frac{\\partial v}{\\partial x} \\frac{\\partial p}{\\partial x} dx\n$$\n\n**2. 谱元离散化**\n域 $[0,L]$ 被划分为 $E$ 个不重叠的单元 $\\Omega_k$，每个单元的长度均为 $h=L/E$。在每个单元内，几何和解被映射到参考单元 $\\xi \\in [-1,1]$。映射关系为 $x(\\xi) = x_c^k + \\frac{h}{2}\\xi$，其中 $x_c^k$ 是第 $k$ 个单元的中心。该变换的雅可比是 $J = \\frac{dx}{d\\xi} = \\frac{h}{2}$，链式法则给出 $\\frac{\\partial}{\\partial x} = \\frac{1}{J}\\frac{\\partial}{\\partial\\xi}$。\n\n在每个单元中，压力场 $p(x,t)$ 被近似为在 $p+1$ 个勒让德-高斯-洛巴托（LGL）节点 $\\{\\xi_j\\}_{j=0}^p$ 上定义的阶数为 $p$ 的拉格朗日插值多项式 $\\ell_j(\\xi)$ 的基上的和：\n$$\np(x(\\xi), t) \\approx p^k(\\xi, t) = \\sum_{j=0}^{p} p_j^k(t) \\ell_j(\\xi)\n$$\n这里，$p_j^k(t)$ 是单元 $k$ 内 LGL 节点上未知的随时间变化的压力值。拉格朗日基函数具有性质 $\\ell_j(\\xi_i) = \\delta_{ij}$。我们使用伽辽金方法，其中测试函数 $v$ 使用相同的基进行表示。\n\n将展开式代入弱形式，即所有单元上的总和：\n$$\n\\sum_{k=1}^E \\int_{\\Omega_k} \\left(\\sum_{i=0}^p v_i^k \\ell_i\\right) \\left(\\sum_{j=0}^p \\frac{d^2 p_j^k}{dt^2} \\ell_j\\right) dx = -c^2 \\sum_{k=1}^E \\int_{\\Omega_k} \\left(\\sum_{i=0}^p v_i^k \\frac{\\partial\\ell_i}{\\partial x}\\right) \\left(\\sum_{j=0}^p p_j^k \\frac{\\partial\\ell_j}{\\partial x}\\right) dx\n$$\n由于这对任何节点值 $v_i^k$ 的选择都必须成立，我们得到一个常微分方程组（ODE）。对于每个单元 $k$，我们定义局部质量矩阵 $M^k$ 和刚度矩阵 $K^k$：\n$$\nM^k_{ij} = \\int_{\\Omega_k} \\ell_i \\ell_j dx = \\int_{-1}^1 \\ell_i(\\xi) \\ell_j(\\xi) J d\\xi\n$$\n$$\nK^k_{ij} = \\int_{\\Omega_k} \\frac{\\partial\\ell_i}{\\partial x} \\frac{\\partial\\ell_j}{\\partial x} dx = \\int_{-1}^1 \\left(\\frac{1}{J}\\frac{d\\ell_i}{d\\xi}\\right) \\left(\\frac{1}{J}\\frac{d\\ell_j}{d\\xi}\\right) J d\\xi = \\frac{1}{J} \\int_{-1}^1 \\frac{d\\ell_i}{d\\xi} \\frac{d\\ell_j}{d\\xi} d\\xi\n$$\n\n这些积分使用 LGL 求积进行数值计算，该方法使用 LGL 节点作为求积点和相应的权重 $\\{w_m\\}_{m=0}^p$。质量矩阵积分为：\n$$\nM^k_{ij} = J \\sum_{m=0}^p w_m \\ell_i(\\xi_m) \\ell_j(\\xi_m) = J \\sum_{m=0}^p w_m \\delta_{im} \\delta_{jm} = J w_i \\delta_{ij}\n$$\n这表明同时使用 LGL 节点进行插值和求积会得到一个对角（或“集总”）质量矩阵。\n\n刚度矩阵计算如下：\n$$\nK^k_{ij} = \\frac{1}{J} \\sum_{m=0}^p w_m \\frac{d\\ell_i}{d\\xi}(\\xi_m) \\frac{d\\ell_j}{d\\xi}(\\xi_m)\n$$\n这可以用参考单元上的节点导数矩阵 $D$（其元素为 $D_{mi} = \\frac{d\\ell_i}{d\\xi}(\\xi_m)$）和求积权重的对角矩阵 $W$（其中 $W_{mm}=w_m$）来表示。那么单元刚度矩阵为 $K^k = \\frac{1}{J} D^T W D$。\n\n**3. 组装与边界条件**\n全局矩阵 $M_{glob}$ 和 $K_{glob}$ 通过将每个单元矩阵的贡献求和到一个大小为 $(Ep+1) \\times (Ep+1)$ 的全局结构中来组装。此过程强制在单元界面处实现 $C^0$ 连续性。由于单元质量矩阵是对角的，全局质量矩阵也是对角的。\n\n齐次狄利克雷边界条件 $p(0,t)=0$ 和 $p(L,t)=0$ 意味着对应于全局节点 $x=0$ 和 $x=L$ 的自由度固定为零。我们通过从全局矩阵中删除第一行和最后一行以及第一列和最后一列来实现这一点，从而得到与内部自由度对应的较小矩阵 $M_{int}$ 和 $K_{int}$。\n\n得到的内部节点压力向量 $\\mathbf{p}_{int}(t)$ 的半离散 ODE 系统为：\n$$\nM_{int} \\frac{d^2\\mathbf{p}_{int}}{dt^2} = -c^2 K_{int} \\mathbf{p}_{int}\n$$\n由于 $M_{int}$ 是对角且正定的，我们可以写成：\n$$\n\\frac{d^2\\mathbf{p}_{int}}{dt^2} = -c^2 M_{int}^{-1} K_{int} \\mathbf{p}_{int}\n$$\n\n**4. 蛙跳时间积分与稳定性分析**\n我们使用二阶显式中心差分（蛙跳）格式对时间导数进行离散。对于一般的 ODE 系统 $\\ddot{\\mathbf{u}} = \\mathbf{f}(\\mathbf{u})$，该格式为：\n$$\n\\frac{\\mathbf{u}^{n+1} - 2\\mathbf{u}^n + \\mathbf{u}^{n-1}}{(\\Delta t)^2} = \\mathbf{f}(\\mathbf{u}^n)\n$$\n将此应用于我们的半离散系统：\n$$\n\\frac{\\mathbf{p}_{int}^{n+1} - 2\\mathbf{p}_{int}^n + \\mathbf{p}_{int}^{n-1}}{(\\Delta t)^2} = -c^2 M_{int}^{-1} K_{int} \\mathbf{p}_{int}^n\n$$\n为了分析稳定性，我们考虑系统矩阵 $A = c^2 M_{int}^{-1} K_{int}$ 的单个特征模态的行为。设 $\\lambda$ 是 $A$ 的一个特征值，其对应的特征向量为 $\\mathbf{v}$。我们假设一个形式为 $\\mathbf{p}_{int}^n = z^n \\mathbf{v}$ 的解，其中 $z$ 是一个复数放大因子。将其代入格式中：\n$$\n\\frac{z^{n+1}\\mathbf{v} - 2z^n\\mathbf{v} + z^{n-1}\\mathbf{v}}{(\\Delta t)^2} = -\\lambda z^n \\mathbf{v}\n$$\n两边除以 $z^{n-1}\\mathbf{v}$ 并重新排列，得到关于 $z$ 的特征方程：\n$$\nz^2 - 2z + 1 = -\\lambda (\\Delta t)^2 z \\implies z^2 + (\\lambda (\\Delta t)^2 - 2) z + 1 = 0\n$$\n为使格式稳定，根的模必须满足 $|z| \\le 1$。这个二次方程的根是：\n$$\nz = \\frac{-( \\lambda (\\Delta t)^2 - 2 ) \\pm \\sqrt{( \\lambda (\\Delta t)^2 - 2 )^2 - 4}}{2}\n$$\n矩阵 $A$ 的特征值 $\\lambda$ 是实数且非负的，因为 $K_{int}$ 是对称正定的，$M_{int}$ 是对角正定的。如果判别式为非正数，稳定性得以保持，此时方程的根为模长 $|z|=1$ 的共轭复数。\n$$\n( \\lambda (\\Delta t)^2 - 2 )^2 - 4 \\le 0 \\implies ( \\lambda (\\Delta t)^2 - 2 )^2 \\le 4\n$$\n取平方根得到 $-2 \\le \\lambda (\\Delta t)^2 - 2 \\le 2$，化简为 $0 \\le \\lambda (\\Delta t)^2 \\le 4$。\n这个条件必须对系统的所有特征值都成立。最严格的约束来自于最大特征值 $\\lambda_{max}$：\n$$\n\\lambda_{max} (\\Delta t)^2 \\le 4\n$$\n因此，最大稳定时间步长是：\n$$\n\\Delta t_{max} = \\frac{2}{\\sqrt{\\lambda_{max}}}\n$$\n其中 $\\lambda_{max}$ 是矩阵 $c^2 M_{int}^{-1} K_{int}$ 的最大特征值，或者等价地，是广义特征值问题 $c^2 K_{int} \\mathbf{v} = \\lambda M_{int} \\mathbf{v}$ 的最大特征值。\n\n**5. 计算流程**\n对于给定的参数 $(L, E, p, c)$，计算 $\\Delta t_{max}$ 的算法如下：\n1. 计算单元几何：单元长度 $h = L/E$ 和雅可比 $J = h/2$。\n2. 对于多项式阶数 $p$，确定在 $[-1,1]$ 上的 $p+1$ 个 LGL 节点和权重。\n3. 计算参考单元上的 $(p+1) \\times (p+1)$ 节点导数矩阵 $D$。\n4. 构建局部单元矩阵：对角质量矩阵 $M^k$ 和相容刚度矩阵 $K^k$。\n5. 通过对单元贡献求和，组装全局对角质量矩阵 $M_{glob}$ 和刚度矩阵 $K_{glob}$。\n6. 通过提取内部子矩阵 $M_{int}$ 和 $K_{int}$ 来应用齐次狄利克雷边界条件。\n7. 求解广义特征值问题 $c^2 K_{int} \\mathbf{v} = \\lambda M_{int} \\mathbf{v}$ 以找到最大特征值 $\\lambda_{max}$。\n8. 计算最大稳定时间步长 $\\Delta t_{max} = 2 / \\sqrt{\\lambda_{max}}$。\n\n这个流程提供了一个从第一性原理出发，严格确定稳定性极限的方法，符合题目要求。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_jacobi, eval_legendre\nfrom scipy.linalg import eigh\n\ndef get_lgl_nodes_weights(p):\n    \"\"\"\n    Computes Legendre-Gauss-Lobatto (LGL) nodes and weights for a given polynomial order p.\n    \"\"\"\n    if p == 0:\n        # This case is trivial and not used in the problem, but for completeness.\n        return np.array([0.0]), np.array([2.0])\n    if p == 1:\n        nodes = np.array([-1.0, 1.0])\n        weights = np.array([1.0, 1.0])\n        return nodes, weights\n\n    # Interior nodes are roots of the derivative of P_p, which are the roots of Jacobi polynomial P_{p-1}^{(1,1)}.\n    interior_nodes, _ = roots_jacobi(p - 1, 1, 1)\n    \n    # Full set of nodes includes endpoints -1 and 1.\n    nodes = np.concatenate(([-1.0], np.sort(interior_nodes), [1.0]))\n    \n    # Weights formula: w_i = 2 / (p*(p+1) * [P_p(xi_i)]^2)\n    poly_vals = eval_legendre(p, nodes)\n    weights = 2.0 / (p * (p + 1) * poly_vals**2)\n    \n    return nodes, weights\n\ndef get_derivative_matrix(p, nodes):\n    \"\"\"\n    Computes the nodal derivative matrix D for Lagrange basis functions at LGL nodes.\n    D_ij = l'_j(xi_i)\n    \"\"\"\n    n_nodes = p + 1\n    D = np.zeros((n_nodes, n_nodes))\n    poly_vals_at_nodes = eval_legendre(p, nodes)\n    \n    for i in range(n_nodes):\n        for j in range(n_nodes):\n            if i == j:\n                if i == 0:\n                    D[i, j] = -p * (p + 1) / 4.0\n                elif i == p:\n                    D[i, j] = p * (p + 1) / 4.0\n                else:\n                    D[i, j] = 0.0\n            else:\n                D[i, j] = poly_vals_at_nodes[i] / (poly_vals_at_nodes[j] * (nodes[i] - nodes[j]))\n    return D\n\ndef calculate_max_dt(L, E, p, c):\n    \"\"\"\n    Calculates the maximum stable timestep Delta_t for the 1D wave equation\n    using SEM with LGL nodes and leapfrog time integration.\n    \"\"\"\n    # 1. Element geometry\n    h = L / E\n    J = h / 2.0\n\n    # 2. LGL data for reference element\n    nodes, weights = get_lgl_nodes_weights(p)\n    n_nodes_per_elem = p + 1\n\n    # 3. Derivative matrix\n    D = get_derivative_matrix(p, nodes)\n    \n    # 4. Element matrices\n    # Element mass matrix (diagonal)\n    M_elem_diag = weights * J\n    # Element stiffness matrix, K^k = (1/J) * D^T * W * D\n    W_diag_mat = np.diag(weights)\n    K_elem = (1.0 / J) * (D.T @ W_diag_mat @ D)\n\n    # 5. Global assembly\n    num_dofs = E * p + 1\n    M_glob_diag = np.zeros(num_dofs)\n    K_glob = np.zeros((num_dofs, num_dofs))\n\n    for e in range(E):\n        for i in range(n_nodes_per_elem):\n            gi = e * p + i\n            M_glob_diag[gi] += M_elem_diag[i]\n            for j in range(n_nodes_per_elem):\n                gj = e * p + j\n                K_glob[gi, gj] += K_elem[i, j]\n\n    # 6. Apply homogeneous Dirichlet BCs\n    # Eliminate first and last DOFs\n    M_int_diag = M_glob_diag[1:-1]\n    K_int = K_glob[1:-1, 1:-1]\n    \n    # Handle case with no interior DOFs (e.g., p=1, E=1)\n    if K_int.shape[0] == 0:\n        return np.inf\n\n    M_int = np.diag(M_int_diag)\n\n    # 7. Solve generalized eigenvalue problem\n    # c^2 * K_int * v = lambda * M_int * v\n    # We need the maximum eigenvalue, lambda_max.\n    # eigh is for symmetric/Hermitian matrices, suitable here.\n    # It solves A*x = lambda*B*x\n    eigenvalues = eigh(c**2 * K_int, M_int, eigvals_only=True)\n    lambda_max = np.max(eigenvalues)\n\n    # 8. Calculate max stable time-step\n    # For leapfrog, dt = 2 / sqrt(lambda_max)\n    if lambda_max == 0: # Should not happen for a valid problem setup\n        return np.inf\n        \n    dt_max = 2.0 / np.sqrt(lambda_max)\n    \n    return dt_max\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 4, 4, 343.0),\n        (2.0, 8, 6, 1500.0),\n        (1.0, 1, 2, 2000.0),\n        (1.0, 2, 1, 1000.0),\n        (0.3, 12, 8, 343.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, E, p, c = case\n        dt_max = calculate_max_dt(L, E, p, c)\n        results.append(f\"{dt_max:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}