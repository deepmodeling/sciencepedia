{
    "hands_on_practices": [
        {
            "introduction": "在对时间反转进行计算建模之前，我们必须首先正确地将波场数字化。本练习探讨了波的物理特性与无损捕获波场所需的数字采样要求之间的基本联系。通过在时间和空间上应用奈奎斯特-香农采样定理，您将推导出避免混叠所需的精确约束，确保用于时间反转聚焦的数据的完整性 。",
            "id": "4147332",
            "problem": "一个线性时间反转镜由 $N$ 个相同的全向声学换能器组成，它们沿着 $x$ 轴放置在 $x_m = m d$（$m = 0,1,\\dots,N-1$）的位置，具有均匀的间距 $d$ 和孔径长度 $(N-1)d$。介质是均匀的，声速为 $c_0$，在感兴趣的频带内色散可以忽略不计。位于阵列前半空间的一个紧凑声源发出来一个带限信号，其声场可以很好地用传播的平面波叠加来近似，这些平面波的角频率支持范围为 $|\\omega| \\le \\omega_{\\max}$，到达角（从阵列法线测量）受限于 $|\\theta| \\le \\theta_{\\max}$，其中 $\\theta_{\\max} \\in (0,\\pi/2]$。每个换能器记录局部声压 $p(x_m,t)$，记录的信号被低通滤波到频带 $|\\omega| \\le \\omega_{\\max}$，以采样周期 $\\Delta t$ 进行时间采样，然后进行时间反转，并由同一阵列重新发射，以在声源位置重新聚焦。\n\n假设时间反转过程在其他方面是理想的（在连续极限下是完美的时间反转，且换能器自噪声可忽略不计），并且倏逝波分量（$|k_x|>k$）对于重新聚焦不是必需的。使用第一性原理，推导在时间和空间上为避免记录场发生混叠（这种混叠会破坏重新聚焦）所需的最小采样约束。你的推导必须从波动方程和平面波解的叠加开始，确定沿阵列的切向波数内容，并在时间和空间上应用采样定理，以获得用 $\\omega_{\\max}$、 $c_0$、 $d$ 和 $\\theta_{\\max}$ 表示的紧奈奎斯特不等式。然后选择正确陈述这些紧约束的选项。\n\n选项：\n\nA. 时间采样必须满足 $\\Delta t \\le \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/k_x^{\\max}$，其中 $k_x^{\\max} = k_{\\max}\\,|\\sin\\theta_{\\max}|$ 且 $k_{\\max} = \\omega_{\\max}/c_0$。对于 $\\theta_{\\max} = \\pi/2$，这简化为 $d \\le \\pi/k_{\\max}$，即 $d \\le \\lambda_{\\min}/2$，其中 $\\lambda_{\\min} = 2\\pi/k_{\\max}$。\n\nB. 时间采样必须满足 $\\Delta t \\le 2\\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/k_{\\max}$，与 $\\theta_{\\max}$ 无关。\n\nC. 时间采样必须满足 $\\Delta t \\le \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\lambda_{\\min}$，即 $d \\le 2\\pi/k_{\\max}$。\n\nD. 时间采样必须满足 $\\Delta t \\le 1/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/\\big(2 k_{\\max}|\\sin\\theta_{\\max}|\\big)$。\n\nE. 时间采样必须满足 $\\Delta t \\ge \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\ge \\pi/k_{\\max}$。",
            "solution": "该问题要求为一个时间反转声学实验推导最小采样约束。这需要在时间域和空间域中应用奈奎斯特-香农采样定理。\n\n首先，评估问题陈述的有效性。\n\n**第1步：提取已知条件**\n- **阵列：** 一个由 $N$ 个相同的全向换能器组成的线性时间反转镜。\n- **阵列几何结构：** 换能器沿 $x$ 轴位于 $x_m = m d$ 处，其中 $m = 0,1,\\dots,N-1$。间距是均匀的，$d$。孔径长度为 $(N-1)d$。\n- **介质：** 均匀，声速为 $c_0$，色散可忽略。\n- **声场：** 传播的平面波的叠加。\n- **时间带宽：** 角频率支持范围为 $|\\omega| \\le \\omega_{\\max}$。\n- **空间带宽：** 到达角 $\\theta$（从阵列法线测量）受限于 $|\\theta| \\le \\theta_{\\max}$，其中 $\\theta_{\\max} \\in (0,\\pi/2]$。\n- **信号处理：** 记录的压力 $p(x_m,t)$ 被低通滤波到 $|\\omega| \\le \\omega_{\\max}$，然后以周期 $\\Delta t$ 进行采样。\n- **假设：** 时间反转过程是理想的。倏逝波分量（$|k_x|>k$，其中 $k=\\omega/c_0$）对于重新聚焦不是必需的。\n- **目标：** 推导 $\\Delta t$ 和 $d$ 的最小采样约束（紧奈奎斯特不等式）以避免混叠。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于波传播的基本原理（波动方程）、傅里叶分析和奈奎斯特-香农采样定理。所描述的设置是阵列信号处理和计算声学中的一个标准（尽管是理想化的）模型。\n- **适定性：** 该问题是适定的。它提供了确定信号在时间和空间上的带宽所需的所有必要参数（$\\omega_{\\max}$、 $c_0$、 $\\theta_{\\max}$）。对“最小采样约束”或“紧奈奎斯特不等式”的要求是一个明确的目标，即找到允许的最大采样间隔。\n- **客观性：** 该问题使用精确、客观的科学语言陈述。没有主观或模糊的术语。\n\n问题陈述没有违反任何无效性标准。这是一个标准的、正式的物理学和工程学问题。\n\n**第3步：结论和行动**\n问题陈述是有效的。接下来是完整的解答推导。\n\n**采样约束的推导**\n\n推导分两部分进行：首先是时间域，然后是空间域。两者都依赖于奈奎斯特-香农采样定理，该定理指出，为了完美地重建一个带限信号，采样率必须至少是信号中最高频率分量的两倍。\n\n**1. 时间采样约束 ($\\Delta t$)**\n\n问题明确指出，记录的信号是带限的，其角频率支持范围为 $|\\omega| \\le \\omega_{\\max}$。这意味着信号不包含幅度大于 $\\omega_{\\max}$（单位：弧度/秒）的频率分量。\n\n信号中的最高循环频率是 $f_{\\max} = \\frac{\\omega_{\\max}}{2\\pi}$。\n\n根据奈奎斯特-香农采样定理，采样频率 $f_s$ 必须满足：\n$$f_s \\ge 2 f_{\\max}$$\n代入 $f_s = 1/\\Delta t$ 和 $f_{\\max} = \\omega_{\\max}/(2\\pi)$：\n$$\\frac{1}{\\Delta t} \\ge 2 \\left( \\frac{\\omega_{\\max}}{2\\pi} \\right) = \\frac{\\omega_{\\max}}{\\pi}$$\n为了找到对采样周期 $\\Delta t$ 的最紧约束，我们解出 $\\Delta t$：\n$$\\Delta t \\le \\frac{\\pi}{\\omega_{\\max}}$$\n这是为避免时间混叠而对时间采样周期的最小约束。\n\n**2. 空间采样约束 ($d$)**\n\n声场是平面波的叠加。一个角频率为 $\\omega$、到达角为 $\\theta$ 的单一平面波分量在二维情况下（阵列位于 $x$ 轴上，声源位于 $y>0$ 半空间）可以写成：\n$$p(x, y, t) = A \\exp(i(k_x x + k_y y - \\omega t))$$\n其中 $\\mathbf{k} = (k_x, k_y)$ 是波矢量。波矢量的大小为 $k = |\\mathbf{k}| = \\sqrt{k_x^2 + k_y^2} = \\omega/c_0$。角度 $\\theta$ 是从阵列法线（$y$ 轴）测量的，因此波矢量的分量是：\n$$k_x = k \\sin\\theta$$\n$$k_y = k \\cos\\theta$$\n换能器位于 $x$ 轴上（$y=0$ 处）。阵列采样的场是 $p(x_m, 0, t)$。沿阵列的场的空间变化由相位项 $\\exp(i k_x x)$ 决定。量 $k_x$ 是沿阵列轴的切向波数或空间频率。\n\n为了在空间上应用采样定理，我们必须找到信号沿阵列的空间带宽。这由 $|k_x|$ 的最大可能值决定。\n$$|k_x| = |k \\sin\\theta| = \\left| \\frac{\\omega}{c_0} \\sin\\theta \\right|$$\n$|k_x|$ 的最大值，记为 $k_x^{\\max}$，出现在 $|\\omega|$ 和 $|\\sin\\theta|$ 都最大化时。\n- $|\\omega|$ 的最大值由题设为 $\\omega_{\\max}$。\n- 到达角受限于 $|\\theta| \\le \\theta_{\\max}$。由于 $\\theta_{\\max} \\in (0, \\pi/2]$，在此范围内 $|\\sin\\theta|$ 的最大值是 $\\sin\\theta_{\\max}$。\n\n因此，最大切向波数为：\n$$k_x^{\\max} = \\frac{\\omega_{\\max}}{c_0} \\sin\\theta_{\\max}$$\n我们定义 $k_{\\max} = \\omega_{\\max}/c_0$ 为最大波数，对应于最高时间频率。可能的角度范围 $|\\theta| \\le \\theta_{\\max}$ 意味着 $\\theta \\in [-\\theta_{\\max}, \\theta_{\\max}]$。切向波数的最大幅值确实在 $\\theta = \\pm \\theta_{\\max}$ 时取得，因此 $|k_x| \\le \\frac{\\omega_{\\max}}{c_0}|\\sin(\\pm \\theta_{\\max})| = k_{\\max} \\sin\\theta_{\\max}$，因为 $\\sin\\theta_{\\max} > 0$。问题中使用 $|\\sin\\theta_{\\max}|$ 的表述是等价的。\n$$k_x^{\\max} = k_{\\max} |\\sin\\theta_{\\max}|$$\n因此，沿阵列的信号在空间角频率 $k_x$ 上是带限的，范围为 $[-k_x^{\\max}, k_x^{\\max}]$。\n\n应用奈奎斯特-香农采样定理的空间版本，空间采样间隔 $d$ 必须满足：\n$$d \\le \\frac{\\pi}{k_x^{\\max}}$$\n代入 $k_x^{\\max}$ 的表达式：\n$$d \\le \\frac{\\pi}{k_{\\max} |\\sin\\theta_{\\max}|}$$\n这是为避免空间混叠而对空间采样间隔（换能器间距）的最小约束。\n\n**综合约束：**\n- 时间： $\\Delta t \\le \\frac{\\pi}{\\omega_{\\max}}$\n- 空间： $d \\le \\frac{\\pi}{k_{\\max} |\\sin\\theta_{\\max}|}$，其中 $k_{\\max} = \\omega_{\\max}/c_0$。\n\n**选项评估**\n\n**A. 时间采样必须满足 $\\Delta t \\le \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/k_x^{\\max}$，其中 $k_x^{\\max} = k_{\\max}\\,|\\sin\\theta_{\\max}|$ 且 $k_{\\max} = \\omega_{\\max}/c_0$。对于 $\\theta_{\\max} = \\pi/2$，这简化为 $d \\le \\pi/k_{\\max}$，即 $d \\le \\lambda_{\\min}/2$，其中 $\\lambda_{\\min} = 2\\pi/k_{\\max}$。**\n- 时间约束 $\\Delta t \\le \\pi/\\omega_{\\max}$ 与我们的推导完全匹配。\n- 空间约束 $d \\le \\pi/k_x^{\\max}$ 且 $k_x^{\\max} = k_{\\max}\\,|\\sin\\theta_{\\max}|$ 也与我们的推导完全匹配。\n- 对于特殊情况 $\\theta_{\\max} = \\pi/2$，$|\\sin(\\pi/2)| = 1$，因此空间约束变为 $d \\le \\pi/k_{\\max}$。最小波长是 $\\lambda_{\\min} = 2\\pi c_0 / \\omega_{\\max} = 2\\pi/k_{\\max}$。将其代入约束条件得到 $d \\le \\pi/(2\\pi/\\lambda_{\\min}) = \\lambda_{\\min}/2$。这个简化也是正确的，代表了众所周知的半波长间距准则。\n**结论：正确。**\n\n**B. 时间采样必须满足 $\\Delta t \\le 2\\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/k_{\\max}$，与 $\\theta_{\\max}$ 无关。**\n- 时间约束 $\\Delta t \\le 2\\pi/\\omega_{\\max}$ 不正确，差了2倍。这对应于以 $\\omega_{\\max}/(2\\pi)$ 的速率采样，该速率等于最高频率，而不是其两倍。\n- 空间约束 $d \\le \\pi/k_{\\max}$ 仅在 $\\theta_{\\max} = \\pi/2$ 的特定情况下正确。它并非与 $\\theta_{\\max}$ 无关；对于 $\\theta_{\\max}  \\pi/2$，约束更宽松。\n**结论：不正确。**\n\n**C. 时间采样必须满足 $\\Delta t \\le \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\le \\lambda_{\\min}$，即 $d \\le 2\\pi/k_{\\max}$。**\n- 时间约束是正确的。\n- 空间约束 $d \\le 2\\pi/k_{\\max}$ 等价于 $d \\le \\lambda_{\\min}$。这是不正确的。最紧的要求（对于 $\\theta_{\\max}=\\pi/2$）是 $d \\le \\lambda_{\\min}/2$。间距为 $d=\\lambda_{\\min}$ 会导致严重的混叠。\n**结论：不正确。**\n\n**D. 时间采样必须满足 $\\Delta t \\le 1/\\omega_{\\max}$。空间采样必须满足 $d \\le \\pi/\\big(2 k_{\\max}|\\sin\\theta_{\\max}|\\big)$。**\n- 时间约束 $\\Delta t \\le 1/\\omega_{\\max}$ 不正确。它缺少一个因子 $\\pi$。\n- 空间约束 $d \\le \\pi/(2 k_{\\max}|\\sin\\theta_{\\max}|)$ 过于严格，差了2倍。虽然如此密集地采样可以避免混叠，但这并不是问题所要求的“最小”或“最紧”的约束。\n**结论：不正确。**\n\n**E. 时间采样必须满足 $\\Delta t \\ge \\pi/\\omega_{\\max}$。空间采样必须满足 $d \\ge \\pi/k_{\\max}$。**\n- 两个不等式都反了。这些约束将允许任意大的采样间隔，从而导致混叠。\n**结论：不正确。**\n\n只有选项A提供了基于第一性原理正确推导出的时间和空间采样的紧约束。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "即使采样完美，数值模拟本身也会引入伪影，从而影响时间反转的准确性。本实践深入研究数值频散，这是有限差分法固有的误差，其中不同频率的波在网格上以略微不同的速度传播。您将推导数值频散关系，并量化其对时间反转焦斑的影响，从而深刻理解模拟参数如何扭曲物理结果 。",
            "id": "4147313",
            "problem": "考虑声速为 $c$ 的均匀无损介质中的一维声波传播，其由标量波动方程 $\\partial^{2} p/\\partial t^{2} = c^{2}\\,\\partial^{2} p/\\partial x^{2}$ 控制。该场在空间间距为 $\\Delta x$ 的均匀空间网格和时间步长为 $\\Delta t$ 的均匀时间步上进行模拟，空间和时间上均使用二阶中心差分，因此在网格索引 $i$ 和时间索引 $n$ 处的离散更新为\n$$\np_{i}^{n+1} - 2\\,p_{i}^{n} + p_{i}^{n-1} \\;=\\; \\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2}\\,\\big(p_{i+1}^{n} - 2\\,p_{i}^{n} + p_{i-1}^{n}\\big).\n$$\n假设一个单色平面波拟设 $p_{i}^{n} = \\Re\\{A\\,\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big)\\}$，其角频率为 $\\omega$，数值波数为该格式所允许的 $k_{\\text{num}}(\\omega)$。令物理波数为 $k(\\omega) = \\omega/c$。一个时间反转镜，在此相同均匀介质中建模为一个固定几何形状的平面阵列，记录角频率为 $\\omega$ 的窄带连续波，然后进行时间反转并重新发射，经过与波长相比很大的距离 $L$ 传播后，在原始源位置重新聚焦。在均匀介质中具有固定孔径几何形状的标量衍射极限聚焦中，对于给定的聚焦配置，横向焦斑宽度 $W$ 与波长 $\\lambda$ 成线性比例。\n\n从波动方程和所述的有限差分格式出发，并仅使用关于衍射极限聚焦的公认事实，完成以下任务：\n- 推导数值色散关系以及 $k_{\\text{num}}(\\omega)$ 的显式表达式。\n- 由此，求出每单位距离累积的相位误差 $k_{\\text{num}}(\\omega) - k(\\omega)$。\n- 使用固定几何形状下的标度关系 $W \\propto \\lambda$，预测模拟焦斑宽度与物理焦斑宽度之比 $B(\\omega;\\Delta x,\\Delta t,c) \\equiv W_{\\text{num}}/W_{\\text{phys}}$，用 $k_{\\text{num}}(\\omega)$ 和 $k(\\omega)$ 表示。\n\n你最终报告的答案必须是 $B(\\omega;\\Delta x,\\Delta t,c)$ 的一个单一闭式解析表达式，用 $\\omega$, $\\Delta x$, $\\Delta t$, 和 $c$ 表示。不需要进行数值近似或四舍五入。将最终答案表示为无量纲量。",
            "solution": "该问题是有效的。它在科学上基于波传播、有限差分法和衍射理论的原理。问题提法恰当、客观，并包含推导所要求表达式的所有必要信息。\n\n推导过程分三步进行：首先，从有限差分格式推导数值色散关系；其次，将焦斑宽度与波长联系起来，从而与波数联系起来；第三，结合这些结果求出模拟焦斑宽度与物理焦斑宽度之比。\n\n**步骤1：推导数值色散关系**\n\n一维标量波动方程的时域有限差分 (FDTD) 格式如下：\n$$\np_{i}^{n+1} - 2\\,p_{i}^{n} + p_{i}^{n-1} \\;=\\; \\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2}\\,\\big(p_{i+1}^{n} - 2\\,p_{i}^{n} + p_{i-1}^{n}\\big)\n$$\n其中 $p_{i}^{n}$ 是空间网格索引 $i$ 和时间索引 $n$ 处的声压，$c$ 是声速，$\\Delta x$ 是网格间距，$\\Delta t$ 是时间步长。\n\n我们检验一个形式为 $p_{i}^{n} = A\\,\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,x_i - \\omega\\,t_n)\\big)$ 的单色平面波解，其中 $x_i = i\\,\\Delta x$ 且 $t_n = n\\,\\Delta t$。实部算子 $\\Re\\{\\cdot\\}$ 和振幅 $A$ 可以忽略，因为它们是所有项的公因子。将复指数形式代入 FDTD 方程得到：\n$$\n\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,(n+1)\\,\\Delta t)\\big) - 2\\,\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big) + \\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,(n-1)\\,\\Delta t)\\big) \\\\\n= \\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2} \\left[ \\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,(i+1)\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big) - 2\\,\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big) + \\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,(i-1)\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big) \\right]\n$$\n我们可以从两边提出公因子 $\\exp\\big(\\mathrm{i}(k_{\\text{num}}\\,i\\,\\Delta x - \\omega\\,n\\,\\Delta t)\\big)$：\n$$\n\\exp(-\\mathrm{i}\\omega\\,\\Delta t) - 2 + \\exp(\\mathrm{i}\\omega\\,\\Delta t) = \\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2} \\left[ \\exp(\\mathrm{i}k_{\\text{num}}\\,\\Delta x) - 2 + \\exp(-\\mathrm{i}k_{\\text{num}}\\,\\Delta x) \\right]\n$$\n使用 Euler 恒等式 $\\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta) = 2\\cos(\\theta)$，方程变为：\n$$\n2\\cos(\\omega\\,\\Delta t) - 2 = \\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2} \\left( 2\\cos(k_{\\text{num}}\\,\\Delta x) - 2 \\right)\n$$\n应用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$，我们得到：\n$$\n-4\\sin^2\\left(\\frac{\\omega\\,\\Delta t}{2}\\right) = -4\\left(\\frac{c\\,\\Delta t}{\\Delta x}\\right)^{2} \\sin^2\\left(\\frac{k_{\\text{num}}\\,\\Delta x}{2}\\right)\n$$\n化简后，我们得到连接数值波数 $k_{\\text{num}}$ 和角频率 $\\omega$ 的数值色散关系：\n$$\n\\sin\\left(\\frac{\\omega\\,\\Delta t}{2}\\right) = \\frac{c\\,\\Delta t}{\\Delta x} \\sin\\left(\\frac{k_{\\text{num}}\\,\\Delta x}{2}\\right)\n$$\n题目要求我们求出 $k_{\\text{num}}(\\omega)$ 的显式表达式。我们可以对上述关系求解 $k_{\\text{num}}$：\n$$\n\\sin\\left(\\frac{k_{\\text{num}}\\,\\Delta x}{2}\\right) = \\frac{\\Delta x}{c\\,\\Delta t} \\sin\\left(\\frac{\\omega\\,\\Delta t}{2}\\right)\n$$\n取反正弦并求解 $k_{\\text{num}}$ 得到：\n$$\nk_{\\text{num}}(\\omega) = \\frac{2}{\\Delta x} \\arcsin\\left(\\frac{\\Delta x}{c\\,\\Delta t} \\sin\\left(\\frac{\\omega\\,\\Delta t}{2}\\right)\\right)\n$$\n这是角频率为 $\\omega$ 的波在数值网格上传播时的波数。\n\n**步骤2：将焦斑宽度与波数联系起来**\n\n问题陈述，对于均匀介质中具有固定孔径几何形状的标量衍射极限聚焦，横向焦斑宽度 $W$ 与波长 $\\lambda$ 成线性比例。这可以写作 $W \\propto \\lambda$。波长通过基本关系 $\\lambda = 2\\pi/|k|$ 与波数 $k$ 相关。因此，焦斑宽度与波数的大小成反比：\n$$\nW \\propto \\frac{1}{|k|}\n$$\n在物理情况下，波的传播是无色散的，波数为 $k_{\\text{phys}}(\\omega) = k(\\omega) = \\omega/c$。因此，物理焦斑宽度 $W_{\\text{phys}}$ 为：\n$$\nW_{\\text{phys}} \\propto \\frac{1}{k(\\omega)} = \\frac{c}{\\omega}\n$$\n在数值模拟中，波的传播受到数值色散的影响，这由数值波数 $k_{\\text{num}}(\\omega)$ 体现。产生聚焦的干涉现象由该数值波数决定。模拟中的有效波长为 $\\lambda_{\\text{num}} = 2\\pi/k_{\\text{num}}(\\omega)$。因此，模拟的焦斑宽度 $W_{\\text{num}}$ 与此数值波长成比例：\n$$\nW_{\\text{num}} \\propto \\frac{1}{k_{\\text{num}}(\\omega)}\n$$\n比例常数由几何形状（例如，聚焦系统的 F 数）决定，假设物理系统及其数值模型的几何形状相同。\n\n**步骤3：计算焦斑宽度之比**\n\n我们现在可以计算比率 $B(\\omega;\\Delta x,\\Delta t,c) = W_{\\text{num}}/W_{\\text{phys}}$。由于比例常数相同，它被消掉了：\n$$\nB = \\frac{W_{\\text{num}}}{W_{\\text{phys}}} = \\frac{1/k_{\\text{num}}(\\omega)}{1/k(\\omega)} = \\frac{k(\\omega)}{k_{\\text{num}}(\\omega)}\n$$\n我们有 $k(\\omega) = \\omega/c$，并且我们推导了 $k_{\\text{num}}(\\omega)$ 的表达式。将这些代入 $B$ 的方程中：\n$$\nB(\\omega;\\Delta x,\\Delta t,c) = \\frac{\\frac{\\omega}{c}}{\\frac{2}{\\Delta x} \\arcsin\\left(\\frac{\\Delta x}{c\\,\\Delta t} \\sin\\left(\\frac{\\omega\\,\\Delta t}{2}\\right)\\right)}\n$$\n该表达式可以重新整理成其最终形式：\n$$\nB(\\omega;\\Delta x,\\Delta t,c) = \\frac{\\omega\\,\\Delta x}{2c\\,\\arcsin\\left(\\frac{\\Delta x}{c\\,\\Delta t} \\sin\\left(\\frac{\\omega\\,\\Delta t}{2}\\right)\\right)}\n$$\n这就是所求的模拟焦斑宽度与物理焦斑宽度之比的闭式解析表达式，表示为关于给定参数的无量纲量。该表达式量化了 FDTD 模拟中由于数值色散引起的焦斑展宽或变窄。",
            "answer": "$$\n\\boxed{\\frac{\\omega \\Delta x}{2c \\arcsin\\left(\\frac{\\Delta x}{c\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right)}}\n$$"
        },
        {
            "introduction": "时间反转的威力依赖于波动方程的时间反演不变性，而任何形式的能量损失或耗散都会破坏这一特性。这个动手编程练习要求您构建一个完整的时域有限差分（FDTD）模拟，以直接观察这种效应。通过实现一个引入非互易吸收的吸收边界层（PML），您将量化耗散如何降低时间反转聚焦的质量，并探索可逆过程与不可逆过程之间的关键差异 。",
            "id": "4147319",
            "problem": "您必须实现一个二维时域有限差分模拟，用于模拟带完美匹配层 (PML) 的线性声波方程，以研究时间反转声学。从无损线性声波方程 $p_{tt} = c^2 \\nabla^2 p$ 开始，其中 $p(\\mathbf{x},t)$ 是声压，$c$ 是声速，$\\nabla^2$ 是拉普拉斯算子。为了对PML建模，使用一个空间变化的阻尼系数 $\\sigma(\\mathbf{x}) \\ge 0$，并考虑阻尼波模型 $p_{tt} + \\sigma(\\mathbf{x}) p_t = c^2 \\nabla^2 p + s(\\mathbf{x},t)$，其中 $s(\\mathbf{x},t)$ 是一个外部源项。在无损介质中，时间反转聚焦是精确的；然而，任何耗散，包括PML的吸收，都会破坏时间反转不变性，并会降低再聚焦的质量。目标是量化PML吸收对边界附近再聚焦准确性的影响。\n\n使用以下要求：\n\n- 在间距为 $\\Delta x = \\Delta y$ 的均匀方形网格上，使用空间和时间上的二阶中心有限差分来离散化 $p_{tt} + \\sigma(\\mathbf{x}) p_t = c^2 \\nabla^2 p + s(\\mathbf{x},t)$。更新应满足无损部分的 Courant–Friedrichs–Lewy 稳定性条件，并一致地包含阻尼项。离散更新必须从连续方程推导得出，不能使用任何特设的简化公式。\n\n- 将完美匹配层 (PML) 实现为一个非负阻尼场 $\\sigma(\\mathbf{x})$，该场在内部为零，并在厚度为 $d_{\\text{pml}}$ 个单元的边界层内向域边界平滑增加。使用一个阶数为 $m$ 的多项式斜坡和最大阻尼 $\\sigma_{\\max}$。您的 $\\sigma(\\mathbf{x})$ 应由 $x$ 和 $y$ 方向的贡献相加构造，以使角落处的阻尼更强。\n\n- 除了域内的PML之外，在网格的最外层边缘使用零梯度（Neumann）边界条件，以便到达最外层边缘的波在被PML衰减后反射最小。\n\n- 正向模拟必须从靠近边界的单个源注入一个带限脉冲，并在位于PML内边缘的“时间反转镜”传感器环上记录声压。反向模拟必须从该传感器环重新发射时间反转后的记录信号。\n\n- 源波形：使用中心频率为 $f_0$ 的 Ricker 子波，其公式为 $w(t) = \\left(1 - 2 \\pi^2 f_0^2 (t-t_c)^2\\right) \\exp\\left(-\\pi^2 f_0^2 (t-t_c)^2\\right)$，其中 $t_c$ 的选择应使脉冲完全处于模拟时间区间内。源振幅必须为 $1$ 帕斯卡，因此压力单位为帕斯卡 (Pa)。\n\n- 时间反转过程：在所有传感器环位置记录正向模拟的声压时间序列，然后在相同的位置注入时间反转后的记录信号，运行相同时间步数的反向模拟。\n\n- 聚焦度量：反向运行完成后，计算在最终时刻原始源位置的焦点头峰值振幅 $A$，单位为帕斯卡 (Pa)。这个 $A$ 是需要报告的标量值。\n\n需使用的数值参数和单位：\n\n- 网格大小：$N_x = N_y = 64$ 个单元，间距 $\\Delta x = \\Delta y = 0.01$ 米。\n- 声速：$c = 343$ 米/秒。\n- 时间步长：选择 $\\Delta t = 1.5 \\times 10^{-5}$ 秒。\n- 时间步数：$N_t = 1600$。\n- PML 厚度：$d_{\\text{pml}} = 8$ 个单元。\n- PML 多项式阶数：$m = 3$，最大阻尼 $\\sigma_{\\max} = 800$ /秒。\n- 源频率：$f_0 = 1000$ 赫兹。\n- 传感器环：所有在每一侧索引等于PML内边缘的网格点，即 $i = d_{\\text{pml}}$、$i = N_x - d_{\\text{pml}} - 1$、$j = d_{\\text{pml}}$ 或 $j = N_y - d_{\\text{pml}} - 1$。\n\n需强制执行的离散化细节：\n\n- 对空间上的拉普拉斯算子使用二阶中心差分近似，对 $p_{tt}$ 使用时间上的二阶中心差分近似，并对 $p_t$ 使用一个能产生两步显式格式的一致的一阶近似。离散更新必须反映阻尼项对 $p_t$ 的依赖性。\n\n- 通过边缘值复制对拉普拉斯算子应用零梯度边界处理，以避免PML之外的人为反射。\n\n测试套件：\n\n对于正向模拟，将源放置在水平索引 $i_s = \\lfloor N_x/2 \\rfloor$ 和垂直索引 $j_s = d_{\\text{pml}} + d$ 处，其中 $d$ 是从PML内边缘到内部的单元数。使用以下六个测试用例：\n\n1. $d = 3$ 个单元，反向运行时PML激活（使用与正向运行相同的 $\\sigma(\\mathbf{x})$）。\n2. $d = 10$ 个单元，反向运行时PML激活。\n3. $d = 20$ 个单元，反向运行时PML激活。\n4. $d = 3$ 个单元，反向运行时PML禁用（在反向运行中设置 $\\sigma(\\mathbf{x}) = 0$）。\n5. $d = 10$ 个单元，反向运行时PML禁用。\n6. $d = 20$ 个单元，反向运行时PML禁用。\n\n对于每个测试用例，计算反向运行的最后一个时间步时源位置处的焦点头峰值振幅 $A$（单位：帕斯卡）。您的程序应生成单行输出，其中包含按上述顺序列出的六个结果，格式为方括号括起来的逗号分隔列表（例如，“[A1,A2,A3,A4,A5,A6]”）。所有振幅必须以帕斯卡（Pa）为单位，表示为浮点数。",
            "solution": "该问题要求实现一个二维（$2$D）时域有限差分（FDTD）模拟，以研究吸收边界层对声学时间反转的影响。该模拟基于线性声波方程，并通过增加一个模拟完美匹配层（PML）的阻尼项进行了修正。\n\n声压 $p(\\mathbf{x}, t)$ 的控制偏微分方程 (PDE) 如下：\n$$\n\\frac{\\partial^2 p}{\\partial t^2} + \\sigma(\\mathbf{x}) \\frac{\\partial p}{\\partial t} = c^2 \\nabla^2 p + s(\\mathbf{x}, t)\n$$\n在此，$c$ 是恒定声速，$\\sigma(\\mathbf{x})$ 是一个空间相关的阻尼系数，仅在PML区域内非零，$s(\\mathbf{x}, t)$ 是一个外部源项。模拟将在一个均匀的笛卡尔网格上进行，空间步长为 $\\Delta x = \\Delta y$，时间步长为 $\\Delta t$。\n\n为了对该方程进行数值求解，我们使用二阶中心有限差分对其进行离散化。令 $p_{i,j}^n$ 表示在网格点 $(i\\Delta x, j\\Delta y)$ 和时间 $n\\Delta t$ 处的压力。偏导数近似如下：\n- 二阶时间导数：$\\frac{\\partial^2 p}{\\partial t^2} \\approx \\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2}$\n- 一阶时间导数：$\\frac{\\partial p}{\\partial t} \\approx \\frac{p_{i,j}^{n+1} - p_{i,j}^{n-1}}{2\\Delta t}$ （这是一个二阶近似，可以得到所需的两步显式格式）。\n- 拉普拉斯算子：$\\nabla^2 p \\approx \\frac{p_{i+1,j}^n - 2p_{i,j}^n + p_{i-1,j}^n}{\\Delta x^2} + \\frac{p_{i,j+1}^n - 2p_{i,j}^n + p_{i,j-1}^n}{\\Delta y^2}$\n\n将这些近似值代入PDE，并分离出未来时间步的项 $p_{i,j}^{n+1}$，即可得到显式更新方程。在网格点 $(i,j)$ 和时间步 $n$ 的离散化PDE为：\n$$\n\\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2} + \\sigma_{i,j} \\frac{p_{i,j}^{n+1} - p_{i,j}^{n-1}}{2\\Delta t} = c^2 \\nabla^2_h p_{i,j}^n + s_{i,j}^n\n$$\n其中 $\\nabla^2_h$ 表示离散拉普拉斯算子。我们将包含 $p_{i,j}^{n+1}$ 和 $p_{i,j}^{n-1}$ 的项分组：\n$$\np_{i,j}^{n+1} \\left( \\frac{1}{\\Delta t^2} + \\frac{\\sigma_{i,j}}{2\\Delta t} \\right) = \\frac{2p_{i,j}^n}{\\Delta t^2} - p_{i,j}^{n-1} \\left( \\frac{1}{\\Delta t^2} - \\frac{\\sigma_{i,j}}{2\\Delta t} \\right) + c^2 \\nabla^2_h p_{i,j}^n + s_{i,j}^n\n$$\n乘以 $\\Delta t^2$ 并重新整理以求解 $p_{i,j}^{n+1}$，得到最终的FDTD更新法则：\n$$\np_{i,j}^{n+1} = \\frac{1}{1 + \\frac{\\sigma_{i,j}\\Delta t}{2}} \\left[ 2p_{i,j}^n - p_{i,j}^{n-1}\\left(1 - \\frac{\\sigma_{i,j}\\Delta t}{2}\\right) + c^2 \\Delta t^2 \\nabla^2_h p_{i,j}^n + \\Delta t^2 s_{i,j}^n \\right]\n$$\n这是一个三层（或两步）时间步进格式，因为它需要时间 $n$ 和 $n-1$ 的声压场来计算时间 $n+1$ 的声压场。模拟从静止开始，因此初始条件为 $p_{i,j}^0 = 0$ 和 $p_{i,j}^{-1} = 0$（这等效于 $\\partial p/\\partial t|_{t=0} = 0$）。\n\n这种显式格式的稳定性由 Courant–Friedrichs–Lewy (CFL) 条件决定。对于二维无损波动方程，该条件为 $c \\Delta t \\sqrt{1/\\Delta x^2 + 1/\\Delta y^2} \\le 1$。给定 $\\Delta x = \\Delta y$，该条件简化为 $\\frac{c \\Delta t \\sqrt{2}}{\\Delta x} \\le 1$。使用提供的参数：$c=343\\,\\text{m/s}$，$\\Delta t=1.5 \\times 10^{-5}\\,\\text{s}$，以及 $\\Delta x=0.01\\,\\text{m}$，CFL数为 $\\frac{343 \\times 1.5 \\times 10^{-5} \\times \\sqrt{2}}{0.01} \\approx 0.728$，该值小于 $1$，满足稳定性判据。\n\nPML通过阻尼场 $\\sigma(\\mathbf{x})$ 实现。该场在计算域内部为零，并在厚度为 $d_{\\text{pml}} = 8$ 个单元的边界层内增加。其剖面遵循一个阶数为 $m=3$ 的多项式斜坡。对于给定的坐标方向（例如 $x$），从内部进入PML层 $k$ 个单元距离处的阻尼 $\\sigma_x$ 由 $\\sigma_x(k) = \\sigma_{\\max} (k/d_{\\text{pml}})^m$ 给出，其中 $k$ 的范围从 $1$ 到 $d_{\\text{pml}}$。点 $(i,j)$ 处的总阻尼是来自两个方向贡献的总和：$\\sigma_{i,j} = \\sigma_x(i) + \\sigma_y(j)$。这种叠加构造使得计算域角落处的阻尼更强。通过将第一内部层的压力值复制到一层虚拟单元（ghost cells），在最外层网格边缘应用零梯度诺伊曼（Neumann）边界条件，这可以通过填充（padding）高效处理。\n\n时间反转过程涉及两次模拟：\n1. 正向模拟：一个源在指定位置 $(i_s, j_s)$ 注入一个 Ricker 子波 $w(t) = (1 - 2 \\pi^2 f_0^2 (t-t_c)^2) \\exp(-\\pi^2 f_0^2 (t-t_c)^2)$。计算 $N_t=1600$ 个时间步的声压演化。在此运行期间，在由PML内边缘定义的一圈传感器位置上记录声压时间序列。\n2. 反向模拟：再次运行模拟 $N_t$ 步。介质被重置为静止状态。先前记录的信号被时间反转，并在其各自的传感器位置作为源注入。对于在正向运行期间从 $t=0$ 到 $T=(N_t-1)\\Delta t$ 记录的信号 $p_{\\text{rec}}(t)$，反向运行期间注入的源是 $s(t) = p_{\\text{rec}}(T-t)$。在理想的无损介质中，此过程应使波沿其原始路径反向传播，并在最终时刻在原始源位置重新聚焦。模拟在两种条件下进行：一次是PML阻尼激活（$\\sigma  0$），另一次是PML阻尼禁用（$\\sigma = 0$）。\n\n每个测试用例需要报告的最终度量是在反向模拟的最后一个时间步，原始源位置 $(i_s, j_s)$ 处的压力振幅 $A$。这量化了时间反转聚焦的质量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the time-reversal acoustic simulations for all test cases.\n    \"\"\"\n    \n    # --- Numerical parameters and constants ---\n    NX = 64          # Grid size in x\n    NY = 64          # Grid size in y\n    DX = 0.01        # Grid spacing in x (m)\n    DY = 0.01        # Grid spacing in y (m)\n    C0 = 343.0       # Speed of sound (m/s)\n    DT = 1.5e-5      # Time step (s)\n    NT = 1600        # Number of time steps\n    D_PML = 8        # PML thickness (cells)\n    PML_M = 3        # PML polynomial order\n    SIGMA_MAX = 800.0# Maximum damping in PML (s^-1)\n    F0 = 1000.0      # Source center frequency (Hz)\n    SRC_AMP = 1.0    # Source amplitude (Pa)\n\n    def create_pml_sigma():\n        \"\"\"Constructs the spatially varying PML damping field sigma.\"\"\"\n        sigma = np.zeros((NX, NY))\n        sigma_x = np.zeros((NX, NY))\n        sigma_y = np.zeros((NX, NY))\n\n        # Ramp profile for each side\n        # Left PML region\n        for i in range(D_PML):\n            dist = D_PML - i\n            sigma_x[i, :] = SIGMA_MAX * (dist / D_PML)**PML_M\n        # Right PML region\n        for i in range(NX - D_PML, NX):\n            dist = i - (NX - D_PML - 1)\n            sigma_x[i, :] = SIGMA_MAX * (dist / D_PML)**PML_M\n        # Top PML region\n        for j in range(D_PML):\n            dist = D_PML - j\n            sigma_y[:, j] = SIGMA_MAX * (dist / D_PML)**PML_M\n        # Bottom PML region\n        for j in range(NY - D_PML, NY):\n            dist = j - (NY - D_PML - 1)\n            sigma_y[:, j] = SIGMA_MAX * (dist / D_PML)**PML_M\n        \n        # Combine contributions additively\n        sigma = sigma_x + sigma_y\n        return sigma\n\n    def ricker_wavelet(t, t_c, f0):\n        \"\"\"Generates a Ricker wavelet.\"\"\"\n        arg = (np.pi * f0 * (t - t_c))**2\n        return (1.0 - 2.0 * arg) * np.exp(-arg)\n\n    def get_sensor_indices():\n        \"\"\"Returns a list of (i, j) tuples for the sensor ring locations.\"\"\"\n        indices = []\n        i_min, i_max = D_PML, NX - D_PML - 1\n        j_min, j_max = D_PML, NY - D_PML - 1\n\n        # Top and bottom rows of the inner domain\n        for i in range(i_min, i_max + 1):\n            indices.append((i, j_min))\n            indices.append((i, j_max))\n\n        # Left and right columns (excluding corners already added)\n        for j in range(j_min + 1, j_max):\n            indices.append((i_min, j))\n            indices.append((i_max, j))\n        return indices\n\n    def run_fdtd_simulation(sigma, nt, src_is=None, src_js=None, \n                              source_time_series=None, \n                              recordings_to_inject=None, \n                              sensor_indices=None):\n        \"\"\"Core FDTD simulation loop for one run (forward or backward).\"\"\"\n        p_curr = np.zeros((NX, NY), dtype=np.float64)\n        p_prev = np.zeros((NX, NY), dtype=np.float64)\n        \n        # Precompute coefficients for the update equation\n        coeff1 = 1.0 / (1.0 + sigma * DT / 2.0)\n        coeff2 = 1.0 - sigma * DT / 2.0\n        c_courant_sq = (C0 * DT / DX)**2\n\n        recorded_signals = None\n        if sensor_indices is not None and recordings_to_inject is None:\n            recorded_signals = np.zeros((len(sensor_indices), nt), dtype=np.float64)\n        \n        for n in range(nt):\n            # Apply Neumann BC via padding with edge values\n            p_padded = np.pad(p_curr, 1, mode='edge')\n            \n            # Compute discrete Laplacian (without 1/dx^2 factor)\n            lap_p = (p_padded[2:, 1:-1] + p_padded[:-2, 1:-1] + \n                     p_padded[1:-1, 2:] + p_padded[1:-1, :-2] - \n                     4.0 * p_curr)\n            \n            # Create source grid for this timestep\n            source_grid = np.zeros((NX, NY), dtype=np.float64)\n            if source_time_series is not None and src_is is not None:\n                source_grid[src_is, src_js] = source_time_series[n]\n                \n            if recordings_to_inject is not None and sensor_indices is not None:\n                # Inject time-reversed signals\n                time_reversed_step = nt - 1 - n\n                for k, (i, j) in enumerate(sensor_indices):\n                    source_grid[i, j] += recordings_to_inject[k, time_reversed_step]\n\n            # FDTD update equation\n            term_lap = c_courant_sq * lap_p\n            term_source = DT**2 * source_grid\n            \n            p_next = coeff1 * (2.0 * p_curr - coeff2 * p_prev + term_lap + term_source)\n            \n            p_prev, p_curr = p_curr, p_next\n            \n            # Record signals if in forward run\n            if recorded_signals is not None:\n                for k, (i, j) in enumerate(sensor_indices):\n                    recorded_signals[k, n] = p_curr[i, j]\n                    \n        return p_curr, recorded_signals\n\n    def solve_case(d, backward_pml_active):\n        \"\"\"Runs one full test case (forward and backward simulation).\"\"\"\n        # --- 1. Setup ---\n        isrc = NX // 2\n        jsrc = D_PML + d\n        \n        pml_sigma = create_pml_sigma()\n        sensor_indices = get_sensor_indices()\n        \n        # Generate source Ricker wavelet\n        t_c = 4.0 / F0  # Pulse center time\n        time_pts = np.arange(NT) * DT\n        source_waveform = SRC_AMP * ricker_wavelet(time_pts, t_c, F0)\n        \n        # --- 2. Forward run with PML ---\n        _, recorded_signals = run_fdtd_simulation(pml_sigma, NT, \n                                                  src_is=isrc, src_js=jsrc, \n                                                  source_time_series=source_waveform,\n                                                  sensor_indices=sensor_indices)\n        \n        # --- 3. Backward run ---\n        backward_sigma = pml_sigma if backward_pml_active else np.zeros((NX, NY))\n        \n        final_pressure_field, _ = run_fdtd_simulation(backward_sigma, NT,\n                                                      recordings_to_inject=recorded_signals,\n                                                      sensor_indices=sensor_indices)\n                                                      \n        # --- 4. Get result metric ---\n        focal_amplitude = final_pressure_field[isrc, jsrc]\n        return focal_amplitude\n\n    # --- Main test suite execution ---\n    test_cases = [\n        # d, backward_pml_active\n        (3, True),   # Case 1\n        (10, True),  # Case 2\n        (20, True),  # Case 3\n        (3, False),  # Case 4\n        (10, False), # Case 5\n        (20, False)  # Case 6\n    ]\n    \n    results = []\n    for d, pml_active in test_cases:\n        result = solve_case(d, pml_active)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}