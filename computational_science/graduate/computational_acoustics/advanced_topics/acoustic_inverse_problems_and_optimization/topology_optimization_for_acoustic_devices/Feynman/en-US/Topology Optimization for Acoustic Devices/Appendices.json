{
    "hands_on_practices": [
        {
            "introduction": "Before we can trust the results of a topology optimization, we must first trust the underlying physical simulation. This practice  delves into a fundamental challenge in computational wave physics: numerical dispersion. By analyzing a simple 1D waveguide, you will derive how the finite element method introduces errors in the wave's phase speed, a critical insight for accurately modeling acoustic devices, especially at higher frequencies.",
            "id": "4148050",
            "problem": "In density-based topology optimization of an acoustic muffler operating at angular frequency $\\omega$, the pressure field $p(x)$ in a homogeneous, lossless, one-dimensional waveguide is modeled by the time-harmonic linear acoustics Helmholtz equation, which for constant mass density $\\rho$ and bulk modulus $\\kappa$ reduces to $\\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2} p = 0$ with $k = \\omega / c$ and $c = \\sqrt{\\kappa/\\rho}$. To quantify numerical dispersion effects that can pollute objective and sensitivity evaluations in topology optimization, consider a uniform mesh with element size $h$ and the standard Galerkin finite element method (FEM) with linear shape functions and the consistent mass matrix over an infinite periodic mesh.\n\nStarting from the weak form and using the above discretization choices:\n- Derive the assembled discrete equation at an interior node in terms of the nodal values $p_{i-1}$, $p_{i}$, and $p_{i+1}$.\n- Perform a Bloch-wave ansatz $p_{j} = \\exp(\\mathrm{i} j \\theta)$ with $\\theta = k_{h} h$ to obtain the discrete dispersion relation between the continuous wavenumber $k$ and the discrete wavenumber $k_{h}$.\n- From this relation, derive the leading-order asymptotic expansion of the relative phase error $\\varepsilon(k h) = \\frac{k_{h} - k}{k}$ as $k h \\to 0$.\n\nProvide your final answer as a single closed-form analytic expression for the leading-order term of $\\varepsilon(k h)$ in terms of $k$ and $h$. Do not include any equals sign in your final expression. No numerical rounding is required. The final expression is dimensionless, so no units should be reported.",
            "solution": "The user wants to find the leading-order term for the relative phase error in a finite element discretization of the 1D Helmholtz equation.\n\nThe validation steps are as follows:\n\n### Step 1: Extract Givens\n- **Governing Equation**: $\\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2} p = 0$ for the pressure field $p(x)$.\n- **Constants**: Mass density $\\rho$, bulk modulus $\\kappa$. Both are constant.\n- **Wave Properties**: Angular frequency $\\omega$, wavenumber $k = \\omega / c$, speed of sound $c = \\sqrt{\\kappa/\\rho}$.\n- **Numerical Scheme**: Standard Galerkin Finite Element Method (FEM).\n- **Discretization Details**: Uniform mesh with element size $h$, linear shape functions, consistent mass matrix.\n- **Domain**: Infinite periodic mesh.\n- **Nodal Variables**: Pressure values $p_{i-1}$, $p_{i}$, $p_{i+1}$ at three consecutive nodes.\n- **Analysis Tool**: Bloch-wave ansatz $p_{j} = \\exp(\\mathrm{i} j \\theta)$ where $\\theta = k_{h} h$ and $k_h$ is the discrete wavenumber.\n- **Objective**: Derive the leading-order asymptotic expansion of the relative phase error $\\varepsilon(k h) = \\frac{k_{h} - k}{k}$ as $k h \\to 0$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard exercise in numerical analysis for wave propagation, specifically grid dispersion analysis for the FEM. The Helmholtz equation, Galerkin method, linear elements, consistent mass matrix, and Bloch-wave analysis are all fundamental and well-established concepts in computational mechanics and acoustics. The premise is sound.\n- **Well-Posed**: The problem is clearly stated and provides a step-by-step procedure to follow. It asks for a specific, derivable quantity (the leading-order term of the phase error). The setup is self-contained and sufficient to derive a unique answer.\n- **Objective**: The language is precise and mathematical. There are no subjective or ambiguous terms.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, and complete. I will proceed with the solution.\n\nThe solution is derived by following the steps outlined in the problem statement.\n\nFirst, we establish the weak form of the Helmholtz equation. We multiply the governing equation by a suitable test function $v(x)$ and integrate over the domain. For the equation at an interior node $i$, it is sufficient to integrate over the support of the corresponding basis function $N_i(x)$, which is $[x_{i-1}, x_{i+1}]$.\n$$ \\int_{x_{i-1}}^{x_{i+1}} v \\left( \\frac{\\mathrm{d}^{2}p}{\\mathrm{d}x^{2}} + k^{2}p \\right) \\mathrm{d}x = 0 $$\nApplying integration by parts to the second derivative term gives:\n$$ \\left[ v \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\right]_{x_{i-1}}^{x_{i+1}} - \\int_{x_{i-1}}^{x_{i+1}} \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\mathrm{d}x + k^{2} \\int_{x_{i-1}}^{x_{i+1}} v p \\, \\mathrm{d}x = 0 $$\nIn the Galerkin method, the test function $v(x)$ is chosen from the same space as the trial functions. We select $v(x) = N_i(x)$, the linear \"hat\" function centered at node $i$, which is zero at $x_{i-1}$ and $x_{i+1}$. Thus, the boundary term vanishes. The weak form for node $i$ is:\n$$ - \\int_{x_{i-1}}^{x_{i+1}} \\frac{\\mathrm{d}N_i}{\\mathrm{d}x} \\frac{\\mathrm{d}p}{\\mathrm{d}x} \\mathrm{d}x + k^{2} \\int_{x_{i-1}}^{x_{i+1}} N_i p \\, \\mathrm{d}x = 0 $$\nNext, we discretize the pressure field $p(x)$ using linear shape functions: $p(x) \\approx p_h(x) = \\sum_{j} p_j N_j(x)$, where $p_j$ are the nodal pressure values. Substituting this into the weak form yields the discrete equation for node $i$:\n$$ \\sum_{j} p_j \\left( - \\int \\frac{\\mathrm{d}N_i}{\\mathrm{d}x} \\frac{\\mathrm{d}N_j}{\\mathrm{d}x} \\mathrm{d}x + k^2 \\int N_i N_j \\mathrm{d}x \\right) = 0 $$\nThis can be written in matrix form as $(K - k^2 M)\\mathbf{p} = \\mathbf{0}$, where $K$ is the stiffness matrix and $M$ is the consistent mass matrix. To find the specific equation for node $i$, we need the element stiffness matrix $K^e$ and mass matrix $M^e$ for a 1D linear element of length $h$. They are given by:\n$$ K^e = \\frac{1}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad M^e = \\frac{h}{6}\\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} $$\nAssembling the contributions from the two elements adjacent to node $i$, namely $[x_{i-1}, x_i]$ and $[x_i, x_{i+1}]$, gives the stencil for the $i$-th row of the global system:\nStiffness part: $\\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1})$\nMass part: $\\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1})$\nThe assembled discrete equation at interior node $i$ is:\n$$ \\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1}) - k^2 \\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1}) = 0 $$\nNow, we perform a Bloch-wave analysis by substituting the ansatz $p_j = \\exp(\\mathrm{i} j \\theta)$ with $\\theta = k_h h$ into this equation. Here, $k_h$ is the numerical wavenumber.\n$$ \\frac{1}{h}(-\\exp(\\mathrm{i}(i-1)\\theta) + 2\\exp(\\mathrm{i}i\\theta) - \\exp(\\mathrm{i}(i+1)\\theta)) - k^2 \\frac{h}{6}(\\exp(\\mathrm{i}(i-1)\\theta) + 4\\exp(\\mathrm{i}i\\theta) + \\exp(\\mathrm{i}(i+1)\\theta)) = 0 $$\nDividing by the common factor $\\exp(\\mathrm{i}i\\theta)$:\n$$ \\frac{1}{h}(-\\exp(-\\mathrm{i}\\theta) + 2 - \\exp(\\mathrm{i}\\theta)) - k^2 \\frac{h}{6}(\\exp(-\\mathrm{i}\\theta) + 4 + \\exp(\\mathrm{i}\\theta)) = 0 $$\nUsing Euler's formula, $\\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta) = 2\\cos(\\theta)$, we simplify the equation:\n$$ \\frac{1}{h}(2 - 2\\cos(\\theta)) - k^2 \\frac{h}{6}(4 + 2\\cos(\\theta)) = 0 $$\nThis is the discrete dispersion relation. We solve for $k^2$ to relate it to the numerical parameters:\n$$ k^2 = \\frac{\\frac{2}{h}(1-\\cos(\\theta))}{\\frac{h}{3}(2+\\cos(\\theta))} = \\frac{6(1-\\cos(\\theta))}{h^2(2+\\cos(\\theta))} $$\nSubstituting $\\theta = k_h h$ and using the half-angle identity $1-\\cos(x) = 2\\sin^2(x/2)$:\n$$ (kh)^2 = \\frac{6(1-\\cos(k_h h))}{2+\\cos(k_h h)} = \\frac{12\\sin^2(k_h h / 2)}{2+\\cos(k_h h)} $$\nTo find the leading-order asymptotic expansion for $\\varepsilon(kh) = \\frac{k_h-k}{k}$ as $kh \\to 0$, we perform a Taylor series expansion of this relation for small argument. Let $\\phi = k_h h$. As $kh \\to 0$, we also have $\\phi \\to 0$. The Taylor expansions for sine and cosine are:\n$$ \\sin(x) = x - \\frac{x^3}{6} + O(x^5), \\quad \\cos(x) = 1 - \\frac{x^2}{2} + \\frac{x^4}{24} + O(x^6) $$\nExpanding the numerator and denominator of the dispersion relation:\n$$ 12\\sin^2(\\phi/2) = 12 \\left( \\frac{\\phi}{2} - \\frac{1}{6}\\left(\\frac{\\phi}{2}\\right)^3 + \\dots \\right)^2 = 12 \\left( \\frac{\\phi^2}{4} - \\frac{\\phi^4}{48} + \\dots \\right) = 3\\phi^2 - \\frac{\\phi^4}{4} + O(\\phi^6) $$\n$$ 2+\\cos(\\phi) = 2 + \\left( 1 - \\frac{\\phi^2}{2} + \\frac{\\phi^4}{24} + \\dots \\right) = 3 - \\frac{\\phi^2}{2} + \\frac{\\phi^4}{24} + \\dots $$\nSubstituting these back into the relation for $(kh)^2$:\n$$ (kh)^2 = \\frac{3\\phi^2 - \\frac{\\phi^4}{4} + O(\\phi^6)}{3 - \\frac{\\phi^2}{2} + O(\\phi^4)} = \\frac{\\phi^2(1 - \\frac{\\phi^2}{12} + \\dots)}{1 - \\frac{\\phi^2}{6} + \\dots} $$\nUsing the geometric series approximation $(1-x)^{-1} \\approx 1+x$ for small $x$:\n$$ (kh)^2 \\approx \\phi^2 \\left(1 - \\frac{\\phi^2}{12}\\right) \\left(1 + \\frac{\\phi^2}{6}\\right) \\approx \\phi^2 \\left(1 + \\frac{\\phi^2}{6} - \\frac{\\phi^2}{12}\\right) = \\phi^2 \\left(1 + \\frac{\\phi^2}{12}\\right) = \\phi^2 + \\frac{\\phi^4}{12} $$\nSo we have $(kh)^2 = (k_h h)^2 + \\frac{(k_h h)^4}{12} + O((k_h h)^6)$. We need to invert this to express $k_h$ in terms of $k$.\n$$ (k_h h)^2 = (kh)^2 - \\frac{(k_h h)^4}{12} + \\dots $$\nIn the correction term, we can make the leading-order approximation $(k_h h)^4 \\approx (kh)^4$.\n$$ (k_h h)^2 \\approx (kh)^2 - \\frac{(kh)^4}{12} $$\nTaking the square root and using the binomial approximation $\\sqrt{1-x} \\approx 1-x/2$:\n$$ k_h h \\approx \\sqrt{(kh)^2 \\left(1 - \\frac{(kh)^2}{12}\\right)} = (kh) \\sqrt{1 - \\frac{(kh)^2}{12}} \\approx (kh)\\left(1 - \\frac{(kh)^2}{24}\\right) $$\n$$ k_h h \\approx kh - \\frac{(kh)^3}{24} $$\nDividing by $h$:\n$$ k_h \\approx k - \\frac{k^3 h^2}{24} $$\nThe relative phase error is $\\varepsilon(kh) = (k_h - k)/k$.\n$$ \\varepsilon(kh) \\approx \\frac{(k - \\frac{k^3 h^2}{24}) - k}{k} = \\frac{-\\frac{k^3 h^2}{24}}{k} = -\\frac{k^2 h^2}{24} $$\nThe leading-order term of the relative phase error is thus $-\\frac{k^2 h^2}{24}$.",
            "answer": "$$\\boxed{-\\frac{k^2 h^2}{24}}$$"
        },
        {
            "introduction": "Many advanced acoustic devices, such as filters and waveguides, are based on phononic crystals—periodic structures designed to control wave propagation. This practice  guides you through the foundational analysis of these structures using Bloch-Floquet theory. You will set up the computational eigenproblem to find the band structure, which reveals the frequency ranges (band gaps) where sound is forbidden to propagate.",
            "id": "4148066",
            "problem": "Consider a $2\\mathrm{D}$ phononic crystal intended for use in topology optimization for acoustic devices. The periodic unit cell is the square domain $\\Omega = [0,a] \\times [0,a]$ with lattice constant $a0$. The design is represented by a spatially varying scalar field $\\chi(\\mathbf{x}) \\in [0,1]$ that is $a$-periodic in both directions, and interpolates material properties between a solid phase with density $\\rho_{s}$ and bulk modulus $K_{s}$, and a fluid phase with density $\\rho_{f}$ and bulk modulus $K_{f}$, via the relations $\\rho(\\mathbf{x}) = \\rho_{s} \\chi(\\mathbf{x}) + \\rho_{f} (1 - \\chi(\\mathbf{x}))$ and $K(\\mathbf{x}) = K_{s} \\chi(\\mathbf{x}) + K_{f} (1 - \\chi(\\mathbf{x}))$. Assume time-harmonic acoustics with angular frequency $\\omega$, negligible viscosity, and linearized kinematics. Let $p(\\mathbf{x})$ denote the complex acoustic pressure field. The governing equation in the frequency domain for an inhomogeneous compressible medium is the scalar Helmholtz-type equation\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho(\\mathbf{x})} \\nabla p(\\mathbf{x}) \\right) + \\omega^{2} \\frac{1}{K(\\mathbf{x})} p(\\mathbf{x}) = 0 \\quad \\text{in } \\Omega,\n$$\nwith $a$-periodic material coefficients $\\rho(\\mathbf{x})$ and $K(\\mathbf{x})$. The crystal is analyzed under Bloch–Floquet conditions for a given wavevector $\\mathbf{k} = (k_{x}, k_{y})$ in the first Brillouin zone.\n\nTasks:\n- Starting from the periodicity of the material coefficients and the linear acoustics governing equation above, use the Bloch theorem to derive the Bloch–Floquet boundary conditions that must hold on opposite faces of $\\Omega$ for the acoustic pressure $p(\\mathbf{x})$, explicitly in terms of the phase factors associated with $\\mathbf{k}$ and the lattice translations.\n- Using the Bloch ansatz $p(\\mathbf{x}) = u(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$ where $u(\\mathbf{x})$ is $a$-periodic, derive the weak form over the unit cell $\\Omega$ and show that the dispersion analysis reduces to a generalized Hermitian eigenproblem of the form $\\mathbf{K}(\\mathbf{k}) \\mathbf{u} = \\omega^{2} \\mathbf{M} \\mathbf{u}$ when discretized by the Finite Element Method (FEM). Clearly identify the bilinear forms that define $\\mathbf{K}(\\mathbf{k})$ and $\\mathbf{M}$.\n- For the special baseline case where the unit cell is homogeneous with constant properties $\\rho(\\mathbf{x}) \\equiv \\rho_{0}$ and $K(\\mathbf{x}) \\equiv K_{0}$, consider the plane-wave expansion truncated to the single fundamental Bloch harmonic. Derive the closed-form analytic expression for the lowest-branch dispersion relation $\\omega(\\mathbf{k})$ across the first Brillouin zone.\n\nAnswer form:\n- Provide only the final expression for the lowest-branch dispersion relation $\\omega(k_{x}, k_{y})$ in closed form. No numerical evaluation is required. Do not include units in the final answer box.",
            "solution": "The problem statement is scientifically grounded, self-contained, and well-posed. It presents a standard problem in the field of computational acoustics and phononic crystal theory. All provided information is consistent and sufficient for the requested derivations. Thus, the problem is valid, and a full solution is provided below.\n\nThe problem concerns the analysis of acoustic wave propagation in a $2\\mathrm{D}$ periodic medium (a phononic crystal). The analysis rests on the Bloch-Floquet theorem, which is a fundamental result for systems described by partial differential equations with periodic coefficients.\n\nFirst, we derive the Bloch-Floquet boundary conditions for the acoustic pressure field $p(\\mathbf{x})$. The material properties $\\rho(\\mathbf{x})$ and $K(\\mathbf{x})$ are periodic with respect to the lattice translations. The unit cell is a square of side length $a$, so the lattice vectors are generated by the basis $\\mathbf{a}_1 = (a, 0)$ and $\\mathbf{a}_2 = (0, a)$. Any lattice translation vector can be written as $\\mathbf{R} = n_1 \\mathbf{a}_1 + n_2 \\mathbf{a}_2$ for integers $n_1, n_2$. Bloch's theorem states that for a given wavevector $\\mathbf{k}$, the solution $p(\\mathbf{x})$ to the governing wave equation must satisfy the condition:\n$$\np(\\mathbf{x} + \\mathbf{R}) = p(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{R})\n$$\nWe apply this theorem to the boundaries of the unit cell $\\Omega = [0,a] \\times [0,a]$.\nFor the vertical boundaries at $x=0$ and $x=a$, the relevant translation vector is $\\mathbf{R} = \\mathbf{a}_1 = (a, 0)$. For any point $(0, y)$ on the left boundary, its periodically equivalent point on the right boundary is $(a, y) = (0, y) + (a, 0)$. Applying Bloch's theorem gives:\n$$\np(a, y) = p(0, y) \\exp(i \\mathbf{k} \\cdot (a, 0)) = p(0, y) \\exp(i k_x a)\n$$\nSimilarly, for the horizontal boundaries at $y=0$ and $y=a$, the translation vector is $\\mathbf{R} = \\mathbf{a}_2 = (0, a)$. For any point $(x, 0)$ on the bottom boundary, its equivalent point on the top boundary is $(x, a) = (x, 0) + (0, a)$. This yields:\n$$\np(x, a) = p(x, 0) \\exp(i \\mathbf{k} \\cdot (0, a)) = p(x, 0) \\exp(i k_y a)\n$$\nThese are the Bloch-Floquet boundary conditions for the pressure field $p(\\mathbf{x})$ on the unit cell $\\Omega$. They are pseudo-periodic boundary conditions, where the periodicity is modulated by a phase factor determined by the wavevector $\\mathbf{k}$.\n\nSecond, we derive the weak form and show it leads to a generalized Hermitian eigenproblem. The Bloch ansatz decomposes the pressure field $p(\\mathbf{x})$ into a periodic part $u(\\mathbf{x})$ and a plane-wave phase factor:\n$$\np(\\mathbf{x}) = u(\\mathbf{x}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nwhere $u(\\mathbf{x})$ is $a$-periodic, i.e., $u(\\mathbf{x}+\\mathbf{R}) = u(\\mathbf{x})$. To find the governing equation for $u(\\mathbf{x})$, we substitute the ansatz into the original PDE. The gradient of $p$ is:\n$$\n\\nabla p = \\nabla(u \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = (\\nabla u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) + u (i\\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = (\\nabla u + i\\mathbf{k}u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nLet's define the operator $\\nabla_{\\mathbf{k}} \\equiv \\nabla + i\\mathbf{k}$. Then $\\nabla p = (\\nabla_{\\mathbf{k}} u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$. Applying the divergence operator:\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho} \\nabla p \\right) = \\nabla \\cdot \\left( \\frac{1}{\\rho} (\\nabla_{\\mathbf{k}} u) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) \\right) = (\\nabla_{\\mathbf{k}} \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u)) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nSubstituting this into the governing equation and canceling the non-zero factor $\\exp(i \\mathbf{k} \\cdot \\mathbf{x})$ yields the PDE for $u(\\mathbf{x})$:\n$$\n\\nabla_{\\mathbf{k}} \\cdot \\left( \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u \\right) + \\frac{\\omega^2}{K} u = 0\n$$\nTo obtain the weak form, we multiply by a periodic test function $\\bar{v}(\\mathbf{x})$, where $v(\\mathbf{x})$ belongs to the same function space as $u(\\mathbf{x})$, and integrate over the unit cell $\\Omega$:\n$$\n\\int_{\\Omega} \\bar{v} \\left( \\nabla_{\\mathbf{k}} \\cdot \\left( \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u \\right) \\right) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\nWe apply integration by parts (Green's first identity) to the first term. Let $\\mathbf{F} = \\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u$. Then $\\int_{\\Omega} \\bar{v} (\\nabla_{\\mathbf{k}} \\cdot \\mathbf{F}) d\\mathbf{x} = \\int_{\\Omega} \\bar{v} (\\nabla \\cdot \\mathbf{F} + i\\mathbf{k} \\cdot \\mathbf{F}) d\\mathbf{x}$.\n$$\n\\int_{\\Omega} \\bar{v} (\\nabla \\cdot \\mathbf{F}) d\\mathbf{x} = -\\int_{\\Omega} (\\nabla \\bar{v}) \\cdot \\mathbf{F} \\, d\\mathbf{x} + \\oint_{\\partial \\Omega} \\bar{v} (\\mathbf{F} \\cdot \\mathbf{n}) \\, dS\n$$\nThe boundary integral $\\oint_{\\partial \\Omega}$ vanishes. This is because the integrand, $\\bar{v} \\frac{1}{\\rho} (\\nabla_{\\mathbf{k}} u) \\cdot \\mathbf{n}$, is periodic on opposite faces (since $v$, $\\rho$, and $u$ are periodic) while the outward normal vector $\\mathbf{n}$ is oppositely directed (e.g., $\\mathbf{n}|_{x=a} = -\\mathbf{n}|_{x=0}$).\nThus, the weak form becomes:\n$$\n-\\int_{\\Omega} (\\nabla \\bar{v}) \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u) d\\mathbf{x} + \\int_{\\Omega} \\bar{v} (i\\mathbf{k}) \\cdot (\\frac{1}{\\rho} \\nabla_{\\mathbf{k}} u) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\nCombining the first two terms:\n$$\n-\\int_{\\Omega} (\\nabla \\bar{v} - i\\mathbf{k} \\bar{v}) \\cdot (\\frac{1}{\\rho} (\\nabla u + i\\mathbf{k} u)) d\\mathbf{x} + \\omega^2 \\int_{\\Omega} \\frac{1}{K} \\bar{v} u \\, d\\mathbf{x} = 0\n$$\nUsing the property $\\nabla \\bar{v} - i\\mathbf{k} \\bar{v} = \\overline{\\nabla v + i\\mathbf{k} v} = \\overline{\\nabla_{\\mathbf{k}} v}$, we rearrange the equation into the canonical form $a(u,v) = \\lambda b(u,v)$:\n$$\n\\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\overline{(\\nabla_{\\mathbf{k}} v)} \\cdot (\\nabla_{\\mathbf{k}} u) \\, d\\mathbf{x} = \\omega^2 \\int_{\\Omega} \\frac{1}{K(\\mathbf{x})} \\bar{v} u \\, d\\mathbf{x}\n$$\nThis is a variational problem for the eigenpairs $(\\omega^2, u)$. Upon discretization using the Finite Element Method, where $u$ and $v$ are expanded in a basis of shape functions $\\{N_j(\\mathbf{x})\\}$, this equation gives rise to a generalized matrix eigenproblem $\\mathbf{K}(\\mathbf{k}) \\mathbf{u} = \\omega^2 \\mathbf{M} \\mathbf{u}$. The matrices are defined by the sesquilinear forms:\nThe stiffness matrix $\\mathbf{K}(\\mathbf{k})$ is derived from the form:\n$$\na(u,v) = \\int_{\\Omega} \\frac{1}{\\rho(\\mathbf{x})} \\overline{(\\nabla v + i\\mathbf{k} v)} \\cdot (\\nabla u + i\\mathbf{k} u) \\, d\\mathbf{x}\n$$\nThe mass matrix $\\mathbf{M}$ is derived from the form:\n$$\nb(u,v) = \\int_{\\Omega} \\frac{1}{K(\\mathbf{x})} \\bar{v} u \\, d\\mathbf{x}\n$$\nBoth forms $a(u,v)$ and $b(u,v)$ are Hermitian (i.e., $a(u,v) = \\overline{a(v,u)}$), so the resulting matrices $\\mathbf{K}(\\mathbf{k})$ and $\\mathbf{M}$ are Hermitian. This guarantees that the eigenvalues $\\omega^2$ are real.\n\nThird, we derive the dispersion relation for the homogeneous baseline case, where $\\rho(\\mathbf{x}) \\equiv \\rho_0$ and $K(\\mathbf{x}) \\equiv K_0$. The governing equation simplifies to the standard Helmholtz equation:\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho_0} \\nabla p \\right) + \\omega^{2} \\frac{1}{K_0} p = 0 \\quad \\implies \\quad \\nabla^2 p + \\frac{\\omega^2 \\rho_0}{K_0} p = 0\n$$\nLet's define the speed of sound in the homogeneous medium as $c_0 = \\sqrt{K_0 / \\rho_0}$. The equation becomes:\n$$\n\\nabla^2 p + \\frac{\\omega^2}{c_0^2} p = 0\n$$\nThe problem asks to consider the expansion truncated to the \"single fundamental Bloch harmonic.\" In a homogeneous medium, an exact solution is a single plane wave. This corresponds to the Bloch ansatz $p(\\mathbf{x}) = u(\\mathbf{x})\\exp(i\\mathbf{k}\\cdot\\mathbf{x})$ where the periodic part $u(\\mathbf{x})$ is a constant, $u(\\mathbf{x})=u_0$. Thus, we seek a solution of the form:\n$$\np(\\mathbf{x}) = u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nwhere $\\mathbf{k} = (k_x, k_y)$ is the wavevector. We substitute this ansatz into the homogeneous Helmholtz equation:\n$$\n\\nabla^2 (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) + \\frac{\\omega^2}{c_0^2} (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = 0\n$$\nCalculating the Laplacian:\n$$\n\\nabla (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = u_0 (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\n$$\n\\nabla^2 (u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = \\nabla \\cdot (u_0 (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = u_0 (i \\mathbf{k}) \\cdot (i \\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = - |\\mathbf{k}|^2 u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nSubstituting this back, we get:\n$$\n- |\\mathbf{k}|^2 u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) + \\frac{\\omega^2}{c_0^2} u_0 \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = 0\n$$\nFor a non-trivial solution ($u_0 \\neq 0$), we can cancel the common factors to obtain the dispersion relation:\n$$\n- |\\mathbf{k}|^2 + \\frac{\\omega^2}{c_0^2} = 0\n$$\nSolving for the angular frequency $\\omega$ (and taking the physically meaningful positive root):\n$$\n\\omega^2 = c_0^2 |\\mathbf{k}|^2 \\implies \\omega(\\mathbf{k}) = c_0 |\\mathbf{k}|\n$$\nSubstituting $c_0 = \\sqrt{K_0 / \\rho_0}$ and $|\\mathbf{k}| = \\sqrt{k_x^2 + k_y^2}$, we obtain the closed-form expression for the lowest-branch dispersion relation:\n$$\n\\omega(k_x, k_y) = \\sqrt{\\frac{K_0}{\\rho_0}} \\sqrt{k_x^2 + k_y^2} = \\sqrt{\\frac{K_0(k_x^2 + k_y^2)}{\\rho_0}}\n$$",
            "answer": "$$\\boxed{\\sqrt{\\frac{K_{0}}{\\rho_{0}}(k_{x}^{2} + k_{y}^{2})}}$$"
        },
        {
            "introduction": "Gradient-based optimization relies on accurate sensitivity information to iteratively improve a design. While the adjoint method provides an efficient way to compute these gradients, implementation errors are a common pitfall. This exercise  explores the indispensable technique of gradient verification using the complex-step method, a robust tool for ensuring your optimization algorithm is built on a solid mathematical foundation.",
            "id": "4148112",
            "problem": "Consider time-harmonic acoustics in a bounded domain $\\Omega \\subset \\mathbb{R}^n$ with angular frequency $\\omega \\in \\mathbb{R}$, where the acoustic pressure field $p(\\mathbf{x})$ satisfies the scalar Helmholtz equation derived from linear momentum and constitutive relations: $\\nabla \\cdot \\left( \\dfrac{1}{\\rho(s)} \\nabla p \\right) + \\dfrac{\\omega^2}{K(s)} p = q$, with appropriate boundary conditions to ensure well-posedness. Here $K(s)$ is the bulk modulus and $\\rho(s)$ is the mass density, both depending on a scalar design parameter $s \\in \\mathbb{R}$ that encodes a material distribution typical of topology optimization (for example, through a differentiable interpolation such as Solid Isotropic Material with Penalization (SIMP)). A standard Galerkin finite element discretization (Finite Element Method (FEM)) yields the linear system\n$$\n\\left( \\mathbf{H}(\\rho(s)) + \\omega^2 \\mathbf{M}(K(s)) \\right) \\mathbf{p}(s) = \\mathbf{f},\n$$\nwhere\n$$\n\\mathbf{H}(\\rho) = \\int_{\\Omega} \\frac{1}{\\rho} \\left( \\nabla \\mathbf{N} \\right) \\left( \\nabla \\mathbf{N} \\right)^{\\top} \\,\\mathrm{d}\\Omega, \\quad\n\\mathbf{M}(K) = \\int_{\\Omega} \\frac{1}{K} \\,\\mathbf{N}\\,\\mathbf{N}^{\\top} \\,\\mathrm{d}\\Omega,\n$$\n$\\mathbf{N}$ is the vector of shape functions, $\\mathbf{p}(s)$ is the nodal vector of discrete pressures, and $\\mathbf{f}$ encodes sources and boundary data. Consider the output functional\n$$\nJ(s) = \\frac{1}{2} \\left\\| \\mathbf{C}\\,\\mathbf{p}(s) - \\mathbf{d} \\right\\|_2^2,\n$$\nwith a given sampling matrix $\\mathbf{C}$ and target data vector $\\mathbf{d}$.\n\nYou wish to verify, by the complex-step method, the adjoint-based gradient $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s}$ for the scalar design parameter $s$ that simultaneously affects $K(s)$ and $\\rho(s)$. Assume $\\mathbf{f}$, $\\mathbf{C}$, and $\\mathbf{d}$ do not depend on $s$, that $K(s)$ and $\\rho(s)$ are differentiable in the real sense and complex-analytic in a neighborhood of the real axis, and that the FEM assembly is performed without any non-analytic operations on complex inputs.\n\nSelect all statements that correctly describe the conceptual implementation of the complex-step verification and the correct adjoint-gradient structure, including the primary sources of error when performing the complex-step check.\n\nA. Set $s_c = s + i h$ with $h \\in \\mathbb{R}$ sufficiently small, assemble $\\mathbf{H}(\\rho(s_c))$ and $\\mathbf{M}(K(s_c))$ in complex arithmetic, solve $\\left( \\mathbf{H}(\\rho(s_c)) + \\omega^2 \\mathbf{M}(K(s_c)) \\right) \\mathbf{p}(s_c) = \\mathbf{f}$ for the complex-valued $\\mathbf{p}(s_c)$, evaluate $J(s_c) = \\dfrac{1}{2} \\left\\| \\mathbf{C}\\,\\mathbf{p}(s_c) - \\mathbf{d} \\right\\|_2^2$ in complex arithmetic, and estimate $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s}$ by $\\operatorname{Im}\\!\\left( J(s_c) \\right)/h$. Provided $K(s)$ and $\\rho(s)$ are complex-analytic and all internal operations are holomorphic, truncation error is negligible and the discrepancy with the adjoint gradient is dominated by floating-point rounding and linear-solver residuals.\n\nB. The adjoint variable $\\boldsymbol{\\lambda}$ satisfies $\\left( \\mathbf{H}(\\rho(s)) + \\omega^2 \\mathbf{M}(K(s)) \\right) \\boldsymbol{\\lambda} = \\mathbf{C}^{\\top} \\left( \\mathbf{C}\\,\\mathbf{p}(s) - \\mathbf{d} \\right)$, and the gradient is $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s} = \\boldsymbol{\\lambda}^{\\top} \\mathbf{f}$.\n\nC. With $\\mathbf{A}(s) = \\mathbf{H}(\\rho(s)) + \\omega^2 \\mathbf{M}(K(s))$ and $\\mathbf{f}$ independent of $s$, the adjoint $\\boldsymbol{\\lambda}$ solves $\\mathbf{A}(s)^{\\top}\\boldsymbol{\\lambda} = \\mathbf{C}^{\\top}\\left( \\mathbf{C}\\,\\mathbf{p}(s) - \\mathbf{d} \\right)$ and the gradient satisfies\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}s} = - \\boldsymbol{\\lambda}^{\\top} \\left( \\frac{\\partial \\mathbf{H}}{\\partial s} + \\omega^2 \\frac{\\partial \\mathbf{M}}{\\partial s} \\right) \\mathbf{p}(s),\n$$\nwith $\\dfrac{\\partial \\mathbf{H}}{\\partial s}$ and $\\dfrac{\\partial \\mathbf{M}}{\\partial s}$ obtained by differentiating the element integrals through $\\dfrac{\\partial}{\\partial s}\\!\\left( \\dfrac{1}{\\rho(s)} \\right)$ and $\\dfrac{\\partial}{\\partial s}\\!\\left( \\dfrac{1}{K(s)} \\right)$, respectively.\n\nD. A dominant numerical error in the complex-step method arises from catastrophic subtractive cancellation in $\\operatorname{Im}\\!\\left( J(s+i h) \\right)/h$ when $h$ is chosen too small; therefore $h$ must be balanced to trade off truncation and cancellation errors as in finite differences.\n\nE. If the material interpolation uses non-analytic or non-smooth mappings, such as $K(s) = K_0 + \\alpha \\left| \\phi(s) \\right|$ or a piecewise definition with conditionals $K(s) = \\begin{cases} K_1,  s  s_0 \\\\ K_2,  s \\ge s_0 \\end{cases}$, the complex-step estimate $\\operatorname{Im}\\!\\left( J(s + i h) \\right)/h$ may be invalid or misleading, because $\\left| \\cdot \\right|$ and discontinuous branches are not complex-differentiable; this constitutes a primary error source in the check.",
            "solution": "Begin from first principles. The linearized, time-harmonic acoustic field under small-amplitude assumptions is governed by the scalar Helmholtz equation obtained by combining conservation of linear momentum with the constitutive relation under adiabatic conditions. In continuous form,\n$$\n\\nabla \\cdot \\left( \\frac{1}{\\rho(s)} \\nabla p \\right) + \\frac{\\omega^2}{K(s)} p = q,\n$$\nwith appropriate boundary conditions. A Galerkin finite element discretization gives the algebraic system\n$$\n\\mathbf{A}(s)\\,\\mathbf{p}(s) = \\mathbf{f}, \\quad \\text{with} \\quad \\mathbf{A}(s) = \\mathbf{H}(\\rho(s)) + \\omega^2 \\mathbf{M}(K(s)),\n$$\nwhere\n$$\n\\mathbf{H}(\\rho) = \\int_{\\Omega} \\frac{1}{\\rho} \\left( \\nabla \\mathbf{N} \\right) \\left( \\nabla \\mathbf{N} \\right)^{\\top} \\,\\mathrm{d}\\Omega, \\quad\n\\mathbf{M}(K) = \\int_{\\Omega} \\frac{1}{K} \\,\\mathbf{N}\\,\\mathbf{N}^{\\top} \\,\\mathrm{d}\\Omega,\n$$\nand $\\mathbf{f}$ does not depend on $s$. The objective is\n$$\nJ(s) = \\frac{1}{2} \\left\\| \\mathbf{C}\\,\\mathbf{p}(s) - \\mathbf{d} \\right\\|_2^2.\n$$\n\nTo derive $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s}$, use the chain rule with the implicit dependence of $\\mathbf{p}(s)$ on $s$. First, compute the sensitivity of $\\mathbf{p}$ by differentiating the state equation:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}s}\\left( \\mathbf{A}(s)\\,\\mathbf{p}(s) \\right) = \\frac{\\mathrm{d}\\mathbf{f}}{\\mathrm{d}s} = \\mathbf{0} \\quad \\Rightarrow \\quad \\left( \\frac{\\partial \\mathbf{A}}{\\partial s} \\right) \\mathbf{p} + \\mathbf{A} \\left( \\frac{\\mathrm{d}\\mathbf{p}}{\\mathrm{d}s} \\right) = \\mathbf{0}.\n$$\nSolve for $\\dfrac{\\mathrm{d}\\mathbf{p}}{\\mathrm{d}s}$:\n$$\n\\frac{\\mathrm{d}\\mathbf{p}}{\\mathrm{d}s} = - \\mathbf{A}(s)^{-1} \\left( \\frac{\\partial \\mathbf{A}}{\\partial s} \\right) \\mathbf{p}(s),\n$$\nassuming $\\mathbf{A}(s)$ is nonsingular for the frequency and boundary conditions considered. Next, compute $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s}$:\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}s} = \\left( \\frac{\\partial J}{\\partial \\mathbf{p}} \\right)^{\\top} \\frac{\\mathrm{d}\\mathbf{p}}{\\mathrm{d}s}\n= \\left( \\mathbf{C}^{\\top} \\left( \\mathbf{C}\\,\\mathbf{p} - \\mathbf{d} \\right) \\right)^{\\top} \\left( - \\mathbf{A}^{-1} \\frac{\\partial \\mathbf{A}}{\\partial s} \\mathbf{p} \\right).\n$$\nIntroduce the adjoint variable $\\boldsymbol{\\lambda}$ by solving the adjoint equation\n$$\n\\mathbf{A}(s)^{\\top} \\boldsymbol{\\lambda} = \\mathbf{C}^{\\top} \\left( \\mathbf{C}\\,\\mathbf{p}(s) - \\mathbf{d} \\right),\n$$\nwhich is obtained by choosing $\\boldsymbol{\\lambda}$ such that $\\boldsymbol{\\lambda}^{\\top}\\mathbf{A}^{\\top} = \\left( \\frac{\\partial J}{\\partial \\mathbf{p}} \\right)^{\\top}$. Then\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}s} = - \\boldsymbol{\\lambda}^{\\top} \\left( \\frac{\\partial \\mathbf{A}}{\\partial s} \\right) \\mathbf{p}(s).\n$$\nFinally, use $\\mathbf{A}(s) = \\mathbf{H}(\\rho(s)) + \\omega^2 \\mathbf{M}(K(s))$ to obtain\n$$\n\\frac{\\partial \\mathbf{A}}{\\partial s} = \\frac{\\partial \\mathbf{H}}{\\partial s} + \\omega^2 \\frac{\\partial \\mathbf{M}}{\\partial s}, \\quad\n\\frac{\\partial \\mathbf{H}}{\\partial s} = \\int_{\\Omega} \\frac{\\partial}{\\partial s}\\!\\left( \\frac{1}{\\rho(s)} \\right) \\left( \\nabla \\mathbf{N} \\right) \\left( \\nabla \\mathbf{N} \\right)^{\\top} \\mathrm{d}\\Omega,\n$$\n$$\n\\frac{\\partial \\mathbf{M}}{\\partial s} = \\int_{\\Omega} \\frac{\\partial}{\\partial s}\\!\\left( \\frac{1}{K(s)} \\right) \\mathbf{N}\\,\\mathbf{N}^{\\top} \\mathrm{d}\\Omega.\n$$\nThis establishes the correct adjoint-gradient structure.\n\nFor the complex-step method, leverage complex analyticity. If $J(s)$ is a composition of complex-analytic functions of $s$ (via $K(s)$, $\\rho(s)$, assembly operations, solve, and the quadratic form), its Taylor expansion at $s$ along the imaginary direction is\n$$\nJ(s + i h) = J(s) + i h J'(s) - \\frac{h^2}{2} J''(s) - i \\frac{h^3}{6} J^{(3)}(s) + \\cdots.\n$$\nTaking the imaginary part and dividing by $h$ yields\n$$\n\\frac{\\operatorname{Im}\\!\\left( J(s + i h) \\right)}{h} = J'(s) - \\frac{h^2}{6} J^{(3)}(s) + \\mathcal{O}(h^4),\n$$\nso truncation error is of order $\\mathcal{O}(h^2)$ in this quotient (more precisely, the leading error term arises from the odd-order derivatives and scales like $\\mathcal{O}(h^2)$ after division by $h$), and there is no subtractive cancellation because the real part is not differenced. In practical floating-point computations, this estimate is typically limited by rounding errors in complex arithmetic and by the residual tolerance of the linear solver when solving $\\mathbf{A}(s+i h)\\,\\mathbf{p}(s+i h) = \\mathbf{f}$.\n\nNon-holomorphic operations break the method. If any internal mapping uses $\\left| \\cdot \\right|$, non-differentiable penalties, or conditional branches that are not complex-analytic, then evaluating at $s + i h$ will not produce the correct imaginary part proportional to $J'(s)$, and the complex-step estimate becomes invalid or misleading. This is especially relevant in topology optimization when design-dependent material interpolations are not smooth or involve thresholding.\n\nNow evaluate the options:\n\nA. This statement correctly outlines the complex-step implementation: perturb $s$ to $s_c = s + i h$, assemble and solve in complex arithmetic, evaluate $J(s_c)$ consistently, and use $\\operatorname{Im}(J(s_c))/h$ to estimate $\\dfrac{\\mathrm{d}J}{\\mathrm{d}s}$. The error characterization is appropriate: under holomorphic mappings, truncation error is negligible for sufficiently small $h$, and the dominant discrepancies arise from floating-point rounding and linear-solver residuals. Verdict: Correct.\n\nB. This adjoint equation omits the transpose on $\\mathbf{A}$, which is required in the standard adjoint derivation for real-valued objectives (or the conjugate transpose in complex-valued settings). Moreover, the claimed gradient $\\boldsymbol{\\lambda}^{\\top}\\mathbf{f}$ is incorrect; with $\\mathbf{f}$ independent of $s$, the gradient depends on $\\dfrac{\\partial \\mathbf{A}}{\\partial s}$, not on $\\mathbf{f}$. Verdict: Incorrect.\n\nC. This statement matches the derivation from first principles. With $\\mathbf{f}$ independent of $s$, the adjoint equation is $\\mathbf{A}^{\\top}\\boldsymbol{\\lambda} = \\mathbf{C}^{\\top}(\\mathbf{C}\\mathbf{p} - \\mathbf{d})$, and the gradient is $- \\boldsymbol{\\lambda}^{\\top}\\left( \\dfrac{\\partial \\mathbf{H}}{\\partial s} + \\omega^2 \\dfrac{\\partial \\mathbf{M}}{\\partial s} \\right)\\mathbf{p}$, with $\\dfrac{\\partial \\mathbf{H}}{\\partial s}$ and $\\dfrac{\\partial \\mathbf{M}}{\\partial s}$ obtained by differentiating the integrands $\\dfrac{1}{\\rho(s)}$ and $\\dfrac{1}{K(s)}$. Verdict: Correct.\n\nD. The claim of catastrophic subtractive cancellation is a misconception applicable to real finite differences but not to the complex-step method. In the complex-step method, the derivative is extracted from the imaginary part, avoiding subtraction of nearly equal real numbers, so cancellation error is not the dominant concern; instead, rounding and solver residuals, and possible underflow if $h$ is chosen beyond floating-point resolution, are relevant. The proposed trade-off analogous to finite differences is not required. Verdict: Incorrect.\n\nE. This statement correctly identifies a primary error source: non-analytic or non-smooth material interpolations (absolute value, discontinuous branches) break complex-analyticity, invalidating the complex-step derivative extraction. Verdict: Correct.",
            "answer": "$$\\boxed{ACE}$$"
        }
    ]
}