{
    "hands_on_practices": [
        {
            "introduction": "高频近似方法，如射线追踪，是计算声学中分析复杂环境中声传播的强大工具。然而，这些方法并非普遍适用，其有效性取决于声学波长远小于介质变化特征尺度的基本假设。本练习  提供了一种量化评估这些条件的实践方法，通过计算关键的无量纲参数，帮助您建立关于何时可以信赖这些近似的直观理解。",
            "id": "4126025",
            "problem": "考虑一个深度为 $H$ 的分层海洋，其垂直坐标 $z$ 从表面向下测量（$z=0$ 在表面，$z=H$ 在底部）。声压场 $p(x,z,t)$ 满足从线性化运动方程导出的时谐声波方程，在通常假设下，对于 $p(x,z,t) = \\Re\\{P(x,z)\\exp(-\\mathrm{i}\\omega t)\\}$，该方程简化为亥姆霍兹方程，\n$$\n\\nabla^{2} P(x,z) + k^{2}(z) P(x,z) = 0,\n$$\n其中 $k(z) = \\omega/c(z)$ 是局地波数，$\\omega = 2\\pi f$ 是角频率，$c(z)$ 是随深度变化的声速。在几何声学（射线理论）和抛物线方程法等高频近似中，其有效性由比较声波波长与折射率的特征非均匀性尺度的无量纲参数控制。将折射率场定义为 $n(z) = c(0)/c(z)$。\n\n设声速剖面由下式给出：\n$$\nc(z) = c_{0}\\left(1 + \\alpha z + \\beta z^{2}\\right),\n$$\n其中 $c_{0} = 1500\\,\\mathrm{m/s}$，$\\alpha = -5\\times 10^{-6}\\,\\mathrm{m}^{-1}$，$\\beta = 1\\times 10^{-9}\\,\\mathrm{m}^{-2}$，$H = 4000\\,\\mathrm{m}$。考虑一个频率为 $f = 1000\\,\\mathrm{Hz}$ 的单频源。在中间深度 $z_{\\ast} = H/2$ 处计算所有量。\n\n从时谐亥姆霍兹方程和定义 $n(z) = c(0)/c(z)$ 出发，推导并计算在 $z_{\\ast}$ 处的以下无量纲参数：\n- 尺度分离参数 $k(z_{\\ast})L$，其中 $L$ 是由 $L = \\left| \\frac{n(z_{\\ast})}{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})} \\right|$ 定义的特征非均匀性长度尺度。\n- 标度化梯度参数 $\\epsilon_{1} = \\left|\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})\\right|\\big/\\left(n(z_{\\ast})\\,k(z_{\\ast})\\right)$。\n- 曲率参数 $\\epsilon_{2} = \\left| \\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast}) \\right|\\big/\\left(n(z_{\\ast})\\,k^{2}(z_{\\ast})\\right)$。\n\n将你的最终答案表示为无量纲数。将答案四舍五入到四位有效数字。",
            "solution": "该问题提出了一个计算声学中有效且适定的场景。所有提供的物理量、定义和数学关系都与分层介质中波传播的既定原理一致。该问题有科学依据、客观，并包含获得唯一解所需的所有信息。因此，我们可以继续进行推导和计算。\n\n目标是根据给定的声速剖面 $c(z)$ 和源频率 $f$，计算在中间深度 $z_{\\ast} = H/2$ 处的三个无量纲参数。\n\n首先，我们建立必要的解析表达式。声速剖面由下式给出：\n$$\nc(z) = c_{0}\\left(1 + \\alpha z + \\beta z^{2}\\right)\n$$\n折射率 $n(z)$ 定义为 $n(z) = c(0)/c(z)$。在 $z=0$ 处计算 $c(z)$ 得到 $c(0)=c_0$。因此，\n$$\nn(z) = \\frac{c_0}{c(z)} = \\frac{c_0}{c_0(1 + \\alpha z + \\beta z^2)} = (1 + \\alpha z + \\beta z^2)^{-1}\n$$\n为简化表示，令 $S(z) = 1 + \\alpha z + \\beta z^2$，则 $n(z) = S(z)^{-1}$。\n\n待计算的参数需要 $n(z)$ 关于 $z$ 的一阶和二阶导数。\n使用链式法则，一阶导数为：\n$$\n\\frac{\\mathrm{d}n}{\\mathrm{d}z} = \\frac{\\mathrm{d}}{\\mathrm{d}z} [S(z)^{-1}] = -S(z)^{-2} \\frac{\\mathrm{d}S}{\\mathrm{d}z} = -S(z)^{-2}(\\alpha + 2\\beta z)\n$$\n再次对 $z$ 使用乘积法则求导，得到二阶导数：\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2} = \\frac{\\mathrm{d}}{\\mathrm{d}z}\\left[-(\\alpha + 2\\beta z)S(z)^{-2}\\right] = -(2\\beta)S(z)^{-2} - (\\alpha + 2\\beta z)\\left[-2S(z)^{-3}(\\alpha + 2\\beta z)\\right]\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2} = 2(\\alpha + 2\\beta z)^2 S(z)^{-3} - 2\\beta S(z)^{-2}\n$$\n局地波数为 $k(z) = \\omega/c(z) = 2\\pi f / c(z)$。为方便起见，引入表面的参考波数 $k_0 = \\omega/c_0$。则 $k(z) = (\\omega/c_0)(c_0/c(z)) = k_0 n(z) = k_0 S(z)^{-1}$。\n\n接下来，我们代入给定的数值。\n$c_0 = 1500\\,\\mathrm{m/s}$\n$\\alpha = -5 \\times 10^{-6}\\,\\mathrm{m}^{-1}$\n$\\beta = 1 \\times 10^{-9}\\,\\mathrm{m}^{-2}$\n$H = 4000\\,\\mathrm{m}$\n$f = 1000\\,\\mathrm{Hz}$\n计算深度为 $z_{\\ast} = H/2 = 2000\\,\\mathrm{m}$。\n\n我们计算在 $z=z_{\\ast}$ 处的中间量：\n$$\nS(z_{\\ast}) = 1 + (-5 \\times 10^{-6})(2000) + (1 \\times 10^{-9})(2000)^2 = 1 - 0.01 + 0.004 = 0.994\n$$\n$$\nc(z_{\\ast}) = c_0 S(z_{\\ast}) = 1500 \\times 0.994 = 1491\\,\\mathrm{m/s}\n$$\n角频率为 $\\omega = 2\\pi f = 2000\\pi\\,\\mathrm{rad/s}$。\n参考波数为 $k_0 = \\omega/c_0 = 2000\\pi/1500 = \\frac{4\\pi}{3}\\,\\mathrm{m}^{-1}$。\n在 $z_{\\ast}$ 处的局地波数为 $k(z_{\\ast}) = k_0/S(z_{\\ast}) = \\frac{4\\pi}{3 \\times 0.994}\\,\\mathrm{m}^{-1}$。\n\n现在我们计算在 $z_{\\ast}$ 处的导数：\n导数内的梯度项为 $\\alpha + 2\\beta z_{\\ast} = -5 \\times 10^{-6} + 2(1 \\times 10^{-9})(2000) = -1 \\times 10^{-6}\\,\\mathrm{m}^{-1}$。\n$$\n\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast}) = -(0.994)^{-2}(-1 \\times 10^{-6}) = \\frac{10^{-6}}{(0.994)^2} \\approx 1.012109 \\times 10^{-6}\\,\\mathrm{m}^{-1}\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2}(z_{\\ast}) = 2(-1 \\times 10^{-6})^2 (0.994)^{-3} - 2(1 \\times 10^{-9})(0.994)^{-2}\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2}(z_{\\ast}) = \\frac{2 \\times 10^{-12}}{(0.994)^3} - \\frac{2 \\times 10^{-9}}{(0.994)^2} \\approx (2.03639 \\times 10^{-12}) - (2.02421 \\times 10^{-9}) \\approx -2.02217 \\times 10^{-9}\\,\\mathrm{m}^{-2}\n$$\n\n最后，我们计算所要求的三个无量纲参数。\n\n1.  **尺度分离参数 $k(z_{\\ast})L$**：\n    特征长度尺度 $L$ 定义为 $L = \\left| \\frac{n(z_{\\ast})}{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})} \\right|$。\n    代入 $n(z)$ 及其导数的表达式：\n    $$\n    L = \\left| \\frac{S(z_{\\ast})^{-1}}{-S(z_{\\ast})^{-2}(\\alpha + 2\\beta z_{\\ast})} \\right| = \\left| \\frac{S(z_{\\ast})}{\\alpha + 2\\beta z_{\\ast}} \\right|\n    $$\n    参数 $k(z_{\\ast})L$ 可简化为：\n    $$\n    k(z_{\\ast})L = \\frac{k_0}{S(z_{\\ast})} \\left| \\frac{S(z_{\\ast})}{\\alpha + 2\\beta z_{\\ast}} \\right| = \\left| \\frac{k_0}{\\alpha + 2\\beta z_{\\ast}} \\right|\n    $$\n    代入数值：\n    $$\n    k(z_{\\ast})L = \\left| \\frac{4\\pi/3}{-1 \\times 10^{-6}} \\right| = \\frac{4\\pi}{3} \\times 10^6 \\approx 4188790.2\n    $$\n    四舍五入到四位有效数字，$k(z_{\\ast})L = 4.189 \\times 10^6$。\n\n2.  **标度化梯度参数 $\\epsilon_{1}$**：\n    该参数定义为 $\\epsilon_{1} = \\left|\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})\\right|\\big/\\left(n(z_{\\ast})\\,k(z_{\\ast})\\right)$。\n    我们可以识别出它与尺度 $L$ 的关系：\n    $$\n    \\epsilon_{1} = \\frac{1}{k(z_{\\ast})} \\left| \\frac{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})}{n(z_{\\ast})} \\right| = \\frac{1}{k(z_{\\ast})L}\n    $$\n    使用先前计算的 $k(z_{\\ast})L$ 的值：\n    $$\n    \\epsilon_{1} = \\frac{1}{\\frac{4\\pi}{3} \\times 10^6} = \\frac{3}{4\\pi} \\times 10^{-6} \\approx 2.38732 \\times 10^{-7}\n    $$\n    四舍五入到四位有效数字，$\\epsilon_1 = 2.387 \\times 10^{-7}$。\n\n3.  **曲率参数 $\\epsilon_{2}$**：\n    该参数定义为 $\\epsilon_{2} = \\left| \\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast}) \\right|\\big/\\left(n(z_{\\ast})\\,k^{2}(z_{\\ast})\\right)$。\n    分子为 $|\\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast})| \\approx 2.02217 \\times 10^{-9}\\,\\mathrm{m}^{-2}$。\n    分母为 $n(z_{\\ast})k^{2}(z_{\\ast}) = S(z_{\\ast})^{-1} (k_0 S(z_{\\ast})^{-1})^2 = k_0^2 S(z_{\\ast})^{-3}$。\n    $$\n    n(z_{\\ast})k^{2}(z_{\\ast}) = \\left(\\frac{4\\pi}{3}\\right)^2 (0.994)^{-3} = \\frac{16\\pi^2}{9(0.994)^3} \\approx 17.86518\\,\\mathrm{m}^{-2}\n    $$\n    现在我们计算该比率：\n    $$\n    \\epsilon_2 = \\frac{2.02217 \\times 10^{-9}}{17.86518} \\approx 1.13190 \\times 10^{-10}\n    $$\n    四舍五入到四位有效数字，$\\epsilon_2 = 1.132 \\times 10^{-10}$。\n\n因此，计算出的三个参数为 $k(z_{\\ast})L = 4.189 \\times 10^6$，$\\epsilon_1 = 2.387 \\times 10^{-7}$ 和 $\\epsilon_2 = 1.132 \\times 10^{-10}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4.189 \\times 10^6  2.387 \\times 10^{-7}  1.132 \\times 10^{-10} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在确定了射线理论适用的条件后，我们便可以运用其核心原理来解决实际问题。射线追踪最基本的应用之一，是在层状介质中根据斯涅尔定律（Snell's Law）追踪声线路径，该定律在此类环境中表现为声线参数的守恒。本练习  将通过一个经典场景，在一个声速随深度线性变化的简化海洋环境中，推导声线的转折深度。这个推导过程不仅能加深您对声速剖面如何决定声线几何形态的理解，也展示了如何从基本物理原理得到一个具体且富有洞察力的结果。",
            "id": "4125994",
            "problem": "考虑一个二维距离-深度声学环境，其中声速仅与深度有关，由线性剖面 $c(z) = c_0 + \\gamma z$ 给出，其中 $c_0 > 0$ 且 $\\gamma > 0$。一个位于 $z=0$ 的点源以初始掠射角 $\\theta_0$（从水平方向测量，单位为弧度）发射一条声线。在计算声学的高频（短波长）极限下，声线由程函方程及其相关的特征线所支配。在一个 $c$ 仅依赖于 $z$ 的分层介质中，慢度的水平分量沿每条声线守恒。\n\n从适用于此情景的守恒定律以及距离、深度和角度之间的运动学关系出发，积分声线方程，以获得声线路径 $z(x)$ 作为距离 $x$ 的函数的解析表达式。使用你的结果，确定反转深度 $z_{\\mathrm{t}}$，其定义为声线在向上反转之前达到的最大深度，用 $c_0$、$\\gamma$ 和 $\\theta_0$ 来表示。\n\n以单个关于 $c_0$、$\\gamma$ 和 $\\theta_0$ 的闭式符号表达式的形式给出 $z_{\\mathrm{t}}$ 的最终答案。角度 $\\theta_0$ 必须以弧度处理。不需要进行数值计算，最终方框内的表达式不应包含任何单位。",
            "solution": "该问题要求确定在具有线性依赖于深度的声速剖面的二维介质中，声线的反转深度。求解过程从支配分层介质中声线传播的基本守恒定律出发。\n\n给定的声速剖面为 $c(z) = c_0 + \\gamma z$，其中 $z$ 是深度，$c_0$ 是表面（$z=0$）处的声速，$\\gamma$ 是恒定的正梯度。声线从原点 $(0,0)$ 以相对于水平方向的初始掠射角 $\\theta_0$ 发射。\n\n在折射率（以及声速）仅随一个坐标（本例中为深度 $z$）变化的介质中，微分形式的斯涅尔定律成立。该定律与问题中给出的陈述等价：慢度矢量的水平分量沿声线路径守恒。\n\n设 $\\theta(z)$ 为声线在深度 $z$ 处的局部掠射角。慢度矢量 $\\mathbf{s}$ 的大小为 $|\\mathbf{s}| = 1/c(z)$。其水平分量 $s_x$ 由下式给出：\n$$ s_x = \\frac{\\cos(\\theta(z))}{c(z)} $$\n该分量的守恒意味着它在整个声线轨迹上是一个常数。我们可以利用声源处（$z=0$）的初始条件来计算这个常数，即声线参数 $p$：\n$$ p = \\frac{\\cos(\\theta(0))}{c(0)} = \\frac{\\cos\\theta_0}{c_0} $$\n因此，对于声线路径上的任意一点，都必须满足以下关系式，这也是斯涅尔定律的一种形式：\n$$ \\frac{\\cos(\\theta(z))}{c(z)} = \\frac{\\cos\\theta_0}{c_0} $$\n任务要求积分声线方程以求得路径 $z(x)$。声线斜率的运动学关系为 $\\frac{dz}{dx} = \\tan(\\theta(z))$。根据上述斯涅尔定律，我们可以表示出 $\\cos(\\theta(z)) = \\frac{c(z)}{c_0}\\cos\\theta_0$。这使我们能够写出 $\\tan(\\theta(z)) = \\frac{\\sqrt{1-\\cos^2(\\theta(z))}}{\\cos(\\theta(z))}$，从而得到一个关于 $z(x)$ 的可分离微分方程。虽然对其进行积分可以证实声线路径是一段圆弧，但我们无需显式求解 $z(x)$ 即可求出反转深度。\n\n我们记为 $z_{\\mathrm{t}}$ 的反转深度是声线达到的最大深度。在这一点，声线的轨迹在开始上升之前瞬间变为水平。水平轨迹对应于局部掠射角为零。\n$$ \\theta(z_{\\mathrm{t}}) = 0 $$\n我们现在可以将此反转条件应用于斯涅尔定律方程：\n$$ \\frac{\\cos(\\theta(z_{\\mathrm{t}}))}{c(z_{\\mathrm{t}})} = \\frac{\\cos\\theta_0}{c_0} $$\n代入 $\\theta(z_{\\mathrm{t}}) = 0$ 并利用 $\\cos(0) = 1$ 这一事实，我们得到：\n$$ \\frac{1}{c(z_{\\mathrm{t}})} = \\frac{\\cos\\theta_0}{c_0} $$\n接下来，我们代入反转深度处的声速表达式 $c(z_{\\mathrm{t}}) = c_0 + \\gamma z_{\\mathrm{t}}$：\n$$ \\frac{1}{c_0 + \\gamma z_{\\mathrm{t}}} = \\frac{\\cos\\theta_0}{c_0} $$\n现在，我们求解这个关于 $z_{\\mathrm{t}}$ 的代数方程。对两边取倒数，我们得到：\n$$ c_0 + \\gamma z_{\\mathrm{t}} = \\frac{c_0}{\\cos\\theta_0} $$\n重新整理各项以分离出 $z_{\\mathrm{t}}$：\n$$ \\gamma z_{\\mathrm{t}} = \\frac{c_0}{\\cos\\theta_0} - c_0 $$\n$$ \\gamma z_{\\mathrm{t}} = c_0 \\left( \\frac{1}{\\cos\\theta_0} - 1 \\right) $$\n最后，除以梯度 $\\gamma$（已知 $\\gamma > 0$），便得到反转深度的表达式：\n$$ z_{\\mathrm{t}} = \\frac{c_0}{\\gamma} \\left( \\frac{1}{\\cos\\theta_0} - 1 \\right) $$\n这就是所要求的、用给定参数 $c_0$、$\\gamma$ 和 $\\theta_0$ 表示的反转深度的闭式符号表达式。",
            "answer": "$$\\boxed{\\frac{c_0}{\\gamma} \\left(\\frac{1}{\\cos\\theta_0} - 1\\right)}$$"
        },
        {
            "introduction": "虽然射线理论在概念上很直观，但更强大的计算工具，如抛物方程（Parabolic Equation, PE）方法，能够更稳健地处理射线理论难以解决的衍射和焦散等复杂现象。然而，开发或使用任何数值求解器都必须经过严格的验证，因为一个能输出数字的程序并不等同于一个能输出正确结果的程序。本综合性练习  将引导您完成计算声学中的一项核心任务：实现一个广泛使用的 PE 求解器（基于Strang分裂和傅里叶变换），并进行收敛性研究以经验性地验证其理论精度。这项技能对于任何计算科学家而言都至关重要，是确保数值模拟结果可靠性的基石。",
            "id": "4126014",
            "problem": "考虑一个由亥姆霍兹方程控制的标量时谐声压场，在正向距离方向上进行标准的近轴分解后，可以得到复包络的窄角抛物方程（PE）。令 $r$ 表示距离坐标，$(x,z)$ 表示横向坐标。在分解出快变项 $\\exp(i k_0 r)$（其中参考波数为 $k_0 = 2\\pi f / c$）之后，包络 $\\psi(r,x,z)$ 的前向PE可写为\n$$\n\\frac{\\partial \\psi}{\\partial r} = \\frac{i}{2 k_0} \\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} \\right) + i k_0 V(r,x,z)\\,\\psi,\n$$\n其中 $V(r,x,z)$ 是一个无量纲、小振幅的有效折射势，其编码了声速变化和慢变的距离依赖性，$f$ 是频率（单位：赫兹，Hz），$c$ 是声速（单位：米/秒，m/s）。在本问题中，您将为PE实现一个Strang分裂数值积分器（二阶对称算子分裂），并经验性地确定其在距离步长 $\\Delta r$ 上的收敛率。Strang分裂将算子分解为 $A = \\frac{i}{2 k_0} \\nabla_{\\perp}^2$ 和 $B(r) = i k_0 V(r,x,z)$，并通过以下方式前进一个距离步长 $\\Delta r$：\n$$\n\\psi(r+\\Delta r) \\approx \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right) \\exp\\!\\left(\\Delta r\\, A\\right) \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right)\\psi(r),\n$$\n在光滑性假设下，该方法在 $\\Delta r$ 上具有二阶精度。衍射子步 $\\exp(\\Delta r A)$ 在横向坐标 $(x,z)$ 上使用快速傅里叶变换（FFT）在谱域中实现，而势能子步 $\\exp\\left(\\frac{\\Delta r}{2} B(\\cdot)\\right)$ 则实现为在距离中点 $r+\\Delta r/2$ 处求值的逐点相位乘法。\n\n您将实现以下计算设置，并通过细化距离步长 $\\Delta r$ 来计算经验收敛率，同时保持横向网格足够精细。横向域在 $x$ 和 $z$ 方向上都是周期的，以便与基于FFT的谱离散化方法保持一致。横向网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta z = L_z/N_z$，其中 $L_x$ 和 $L_z$ 是横向范围（单位：米），$N_x$ 和 $N_z$ 分别是 $x$ 和 $z$ 方向的网格点数。谱波数定义为 $k_x = 2\\pi m / L_x$ 和 $k_z = 2\\pi n / L_z$，其中 $m,n$ 为整数索引，这些值在代码中通过均匀的FFT频率网格获得。衍射子步将 $\\psi$ 的傅里叶变换乘以\n$$\n\\exp\\!\\left(-i \\Delta r \\frac{k_x^2 + k_z^2}{2 k_0}\\right).\n$$\n势能取为一个光滑、小振幅、依赖于距离的函数：\n$$\nV(r,x,z) = \\varepsilon \\cos\\!\\left(\\frac{2\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{2\\pi z}{L_z}\\right) \\cos\\!\\left(\\frac{2\\pi r}{R}\\right),\n$$\n其中 $R$ 是最终距离（单位：米），$\\varepsilon$ 是一个无量纲振幅。初始条件为一个倾斜的高斯波束：\n$$\n\\psi(0,x,z) = \\exp\\!\\left(-\\frac{x^2}{w_x^2} - \\frac{z^2}{w_z^2} \\right) \\exp\\!\\left(i k_{\\text{tilt},x} x + i k_{\\text{tilt},z} z\\right),\n$$\n其中给定了波束宽度 $w_x,w_z$ （单位：米）和小的倾斜量 $k_{\\text{tilt},x}, k_{\\text{tilt},z}$ （单位：弧度/米），以填充横向波数。\n\n为了确定Strang分裂实现在距离上的经验收敛率 $p$，您将使用三种不同的距离步长计算最终距离 $R$ 处的包络：一个粗步长 $\\Delta r_c$，一个细步长 $\\Delta r_f = \\Delta r_c/2$，以及一个足够小的参考步长 $\\Delta r_{\\text{ref}}$（每个测试用例中会指定）。在所有运行中，最终距离 $R$ 保持不变。令 $E_c$ 和 $E_f$ 分别表示在最终距离 $R$ 处，粗/细步长解与参考解之间的离散 $L^2$ 误差，这些误差均在相同的横向网格上计算。离散 $L^2$ 误差定义为：\n$$\nE = \\sqrt{ \\sum_{j=0}^{N_x-1} \\sum_{k=0}^{N_z-1} \\left| \\psi_{\\Delta r}(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }.\n$$\n那么经验收敛率为：\n$$\np = \\frac{\\log(E_c/E_f)}{\\log(\\Delta r_c/\\Delta r_f)}.\n$$\n在距离上具有二阶精度的情况下，$p$ 的值应接近2，前提是横向离散化误差不占主导地位。\n\n物理单位：所有长度（$L_x, L_z, R, \\Delta r$）和波束宽度（$w_x,w_z$）以米（m）为单位；频率 $f$ 以赫兹（Hz）为单位；声速 $c$ 以米/秒（m/s）为单位；波数 $k_0, k_{\\text{tilt},x}, k_{\\text{tilt},z}$ 以弧度/米（rad/m）为单位。不直接使用角度；不要将任何量转换为度。\n\n实现一个完整的、可运行的程序，该程序：\n- 构建横向网格和谱波数。\n- 按照描述实现Strang分裂PE传播器，其中势能在每个步长的距离中点进行求值。\n- 对于下面的每个测试用例，计算在 $R$ 处的粗略、精细和参考解，评估 $E_c$、$E_f$，并计算 $p$。\n- 生成单行输出，其中包含三个测试用例的三个经验收敛率，按顺序排列，格式为用方括号括起来的逗号分隔列表，并四舍五入到三位小数。\n\n测试套件（三个用例）：\n1. 理想情况用例：\n   - $c = 1500\\,\\text{m/s}$，$f = 300\\,\\text{Hz}$，$L_x = 200\\,\\text{m}$，$L_z = 200\\,\\text{m}$，$N_x = 64$，$N_z = 64$，$R = 200\\,\\text{m}$，$\\varepsilon = 0.01$，$w_x = 20\\,\\text{m}$，$w_z = 20\\,\\text{m}$，$k_{\\text{tilt},x} = 0.1\\,\\text{rad/m}$，$k_{\\text{tilt},z} = -0.05\\,\\text{rad/m}$，$\\Delta r_c = 1.0\\,\\text{m}$，$\\Delta r_f = 0.5\\,\\text{m}$，$\\Delta r_{\\text{ref}} = 0.125\\,\\text{m}$。\n2. 边界敏感性用例（较弱介质，较短距离）：\n   - $c = 1500\\,\\text{m/s}$，$f = 600\\,\\text{Hz}$，$L_x = 160\\,\\text{m}$，$L_z = 160\\,\\text{m}$，$N_x = 48$，$N_z = 48$，$R = 150\\,\\text{m}$，$\\varepsilon = 0.001$，$w_x = 15\\,\\text{m}$，$w_z = 25\\,\\text{m}$，$k_{\\text{tilt},x} = 0.08\\,\\text{rad/m}$，$k_{\\text{tilt},z} = -0.03\\,\\text{rad/m}$，$\\Delta r_c = 1.5\\,\\text{m}$，$\\Delta r_f = 0.75\\,\\text{m}$，$\\Delta r_{\\text{ref}} = 0.1875\\,\\text{m}$。\n3. 边界用例（各向异性网格分辨率）：\n   - $c = 1500\\,\\text{m/s}$，$f = 450\\,\\text{Hz}$，$L_x = 240\\,\\text{m}$，$L_z = 100\\,\\text{m}$，$N_x = 96$，$N_z = 32$，$R = 180\\,\\text{m}$，$\\varepsilon = 0.02$，$w_x = 30\\,\\text{m}$，$w_z = 12\\,\\text{m}$，$k_{\\text{tilt},x} = 0.12\\,\\text{rad/m}$，$k_{\\text{tilt},z} = -0.04\\,\\text{rad/m}$，$\\Delta r_c = 1.2\\,\\text{m}$，$\\Delta r_f = 0.6\\,\\text{m}$，$\\Delta r_{\\text{ref}} = 0.15\\,\\text{m}$。\n\n要求的最终输出格式：您的程序应生成单行输出，其中包含三个收敛率，格式为用方括号括起来的逗号分隔列表，并四舍五入到三位小数（例如，“[1.997,2.004,1.989]”）。",
            "solution": "已对用户提供的问题进行分析，并认定其有效。这是一个计算声学领域内适定且有科学依据的问题，内容完整，没有矛盾或歧义。任务是实现一个标准的数值算法并验证其理论收敛特性，这是计算科学领域一项常规且有意义的练习。\n\n该问题要求实现一个Strang分裂傅里叶积分器，以求解用于声传播的窄角抛物方程（PE）。目标是经验性地确定此数值格式相对于距离步长 $\\Delta r$ 的收敛阶数 $p$。\n\n复压包络 $\\psi(r,x,z)$ 的控制方程是窄角PE：\n$$\n\\frac{\\partial \\psi}{\\partial r} = \\frac{i}{2 k_0} \\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} \\right) + i k_0 V(r,x,z)\\,\\psi\n$$\n这是一个关于距离坐标 $r$ 的演化方程。它可以抽象地写为 $\\frac{\\partial \\psi}{\\partial r} = (A + B(r))\\psi$，其中 $A$ 是衍射算子，$B(r)$ 是势能算子。\n- 衍射算子为 $A = \\frac{i}{2k_0}\\nabla_\\perp^2$，其中 $\\nabla_\\perp^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial z^2}$。\n- 势能算子为 $B(r) = i k_0 V(r,x,z)$，这是一个乘法算子。\n\nStrang分裂法是一种将解从距离 $r$ 推进到 $r+\\Delta r$ 的二阶精度技术。它通过对称地分裂算子来近似形式解 $\\psi(r+\\Delta r) = \\exp(\\Delta r(A+B))\\psi(r)$：\n$$\n\\psi(r+\\Delta r) \\approx \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right) \\exp\\!\\left(\\Delta r\\, A\\right) \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right)\\psi(r)\n$$\n此处，势能 $B$ 在距离步长的中点 $r_{\\text{mid}} = r + \\Delta r/2$ 处求值，以保持对距离相关势能的二阶精度。\n\n单个距离步长的算法实现包括三个连续的子步骤：\n1.  **第一个势能半步**：场 $\\psi$ 乘以一个相位因子。在离散网格 $(x_j, z_k)$ 上，这是一个逐点乘法：$\\psi \\leftarrow \\exp\\left(\\frac{\\Delta r}{2} B(r_{\\text{mid}})\\right) \\psi = \\exp\\left(i k_0 \\frac{\\Delta r}{2} V(r_{\\text{mid}}, x_j, z_k)\\right) \\psi(r, x_j, z_k)$。\n\n2.  **衍射全步**：算子 $\\exp(\\Delta r A)$ 在空间傅里叶域中应用最为高效。算法如下：\n    a. 计算场的二维快速傅里叶变换（FFT）：$\\hat{\\psi}(k_x, k_z) = \\mathcal{F}\\{\\psi(x,z)\\}$。\n    b. 在谱域中乘以衍射相位因子：$\\hat{\\psi} \\leftarrow \\exp\\left(-i \\Delta r \\frac{k_x^2 + k_z^2}{2 k_0}\\right) \\hat{\\psi}$。横向波数 $k_x$ 和 $k_z$ 对应于离散网格，并由标准的FFT频率例程提供。\n    c. 计算二维逆FFT以返回空间域：$\\psi = \\mathcal{F}^{-1}\\{\\hat{\\psi}\\}$。\n\n3.  **第二个势能半步**：此步骤与第一步相同，将相同的相位乘法应用于衍射步骤的结果。\n\n将整个序列重复 $N_{\\text{steps}} = \\text{round}(R/\\Delta r)$ 次迭代，以将初始场 $\\psi(0,x,z)$ 传播到最终距离 $R$。\n\n为了找到经验收敛率 $p$，每个测试用例的模拟都运行三次，具有固定的最终距离 $R$ 和横向网格，但使用三个不同的距离步长：一个粗步长 $\\Delta r_c$，一个细步长 $\\Delta r_f = \\Delta r_c/2$，以及一个非常精细的参考步长 $\\Delta r_{\\text{ref}}$。这将产生三个最终场：$\\psi_c$、$\\psi_f$ 和 $\\psi_{\\text{ref}}$。计算粗略解和精细解相对于参考解的离散 $L^2$ 误差：\n$$\nE_c = \\sqrt{ \\sum_{j,k} \\left| \\psi_c(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }\n$$\n$$\nE_f = \\sqrt{ \\sum_{j,k} \\left| \\psi_f(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }\n$$\n对于一个收敛阶为 $p$ 的方法，误差 $E$ 与 $(\\Delta r)^p$ 成正比。因此，误差之比与步长之比相关：$E_c / E_f \\approx (\\Delta r_c / \\Delta r_f)^p$。求解 $p$ 得到经验率的公式：\n$$\np = \\frac{\\log(E_c/E_f)}{\\log(\\Delta r_c/\\Delta r_f)}\n$$\n由于所有测试用例中 $\\Delta r_c / \\Delta r_f = 2$，该式可简化为 $p = \\log_2(E_c/E_f)$。对于二阶Strang分裂方法， $p$ 的期望值约为2。\n\n该实现将定义一个函数，用于对一组给定的参数执行PE传播。该函数将被每个测试用例和距离步长（$\\Delta r_c, \\Delta r_f, \\Delta r_{\\text{ref}}$）的组合调用，以生成计算 $p$ 所需的场。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef propagate_pe(c, f, Lx, Lz, Nx, Nz, R, epsilon, wx, wz, ktilt_x, ktilt_z, dr):\n    \"\"\"\n    Solves the Parabolic Equation using a Strang-split Fourier method.\n\n    Args:\n        c (float): Sound speed (m/s).\n        f (float): Frequency (Hz).\n        Lx (float): Transverse domain extent in x (m).\n        Lz (float): Transverse domain extent in z (m).\n        Nx (int): Number of grid points in x.\n        Nz (int): Number of grid points in z.\n        R (float): Final range (m).\n        epsilon (float): Dimensionless potential amplitude.\n        wx (float): Beam width in x (m).\n        wz (float): Beam width in z (m).\n        ktilt_x (float): Initial beam tilt in x (rad/m).\n        ktilt_z (float): Initial beam tilt in z (rad/m).\n        dr (float): Range step (m).\n\n    Returns:\n        numpy.ndarray: The complex pressure envelope psi at range R.\n    \"\"\"\n    # 1. Derived constants and grid setup\n    k0 = 2.0 * np.pi * f / c\n    dx = Lx / float(Nx)\n    dz = Lz / float(Nz)\n    num_steps = int(round(R / dr))\n\n    # Transverse spatial grid (centered at origin)\n    x_vec = (np.arange(Nx) * dx) - (Lx / 2.0)\n    z_vec = (np.arange(Nz) * dz) - (Lz / 2.0)\n    X, Z = np.meshgrid(x_vec, z_vec, indexing='ij')\n\n    # Transverse spectral grid (for FFT)\n    kx_vec = 2.0 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    kz_vec = 2.0 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    Kx, Kz = np.meshgrid(kx_vec, kz_vec, indexing='ij')\n\n    # 2. Initial Condition\n    psi = np.exp(-(X**2 / wx**2) - (Z**2 / wz**2)) * \\\n          np.exp(1j * ktilt_x * X + 1j * ktilt_z * Z)\n    psi = psi.astype(np.complex128)\n\n    # 3. Propagator operators\n    # Diffraction operator (constant for all steps)\n    diff_op = np.exp(-1j * dr * (Kx**2 + Kz**2) / (2.0 * k0))\n\n    # 4. Main propagation loop\n    for i in range(num_steps):\n        # Midpoint rule for range-dependent potential\n        r_mid = (float(i) + 0.5) * dr\n        \n        # Potential evaluation at midpoint\n        V_mid = epsilon * np.cos(2.0 * np.pi * X / Lx) * \\\n                        np.sin(2.0 * np.pi * Z / Lz) * \\\n                        np.cos(2.0 * np.pi * r_mid / R)\n        \n        # Potential operator for half-step\n        pot_op_half = np.exp(1j * k0 * (dr / 2.0) * V_mid)\n\n        # Apply Strang splitting: B/2, A, B/2\n        # First potential half-step\n        psi = pot_op_half * psi\n        \n        # Diffraction full-step\n        psi = np.fft.ifft2(np.fft.fft2(psi) * diff_op)\n        \n        # Second potential half-step\n        psi = pot_op_half * psi\n\n    return psi\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute empirical convergence rates.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {'c': 1500.0, 'f': 300.0, 'Lx': 200.0, 'Lz': 200.0, 'Nx': 64, 'Nz': 64, 'R': 200.0, \n         'epsilon': 0.01, 'wx': 20.0, 'wz': 20.0, 'ktilt_x': 0.1, 'ktilt_z': -0.05,\n         'dr_c': 1.0, 'dr_f': 0.5, 'dr_ref': 0.125},\n        # Case 2: Boundary sensitivity\n        {'c': 1500.0, 'f': 600.0, 'Lx': 160.0, 'Lz': 160.0, 'Nx': 48, 'Nz': 48, 'R': 150.0, \n         'epsilon': 0.001, 'wx': 15.0, 'wz': 25.0, 'ktilt_x': 0.08, 'ktilt_z': -0.03,\n         'dr_c': 1.5, 'dr_f': 0.75, 'dr_ref': 0.1875},\n        # Case 3: Anisotropic grid\n        {'c': 1500.0, 'f': 450.0, 'Lx': 240.0, 'Lz': 100.0, 'Nx': 96, 'Nz': 32, 'R': 180.0, \n         'epsilon': 0.02, 'wx': 30.0, 'wz': 12.0, 'ktilt_x': 0.12, 'ktilt_z': -0.04,\n         'dr_c': 1.2, 'dr_f': 0.6, 'dr_ref': 0.15},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract common parameters for propagate_pe function\n        params = {k: v for k, v in case.items() if not k.startswith('dr_')}\n        \n        # Run simulations for reference, coarse, and fine steps\n        psi_ref = propagate_pe(**params, dr=case['dr_ref'])\n        psi_c = propagate_pe(**params, dr=case['dr_c'])\n        psi_f = propagate_pe(**params, dr=case['dr_f'])\n\n        # Calculate discrete L2 errors\n        dx = case['Lx'] / float(case['Nx'])\n        dz = case['Lz'] / float(case['Nz'])\n        \n        err_c = np.sqrt(np.sum(np.abs(psi_c - psi_ref)**2) * dx * dz)\n        err_f = np.sqrt(np.sum(np.abs(psi_f - psi_ref)**2) * dx * dz)\n        \n        # Calculate empirical convergence rate p\n        # p = log(err_c / err_f) / log(dr_c / dr_f)\n        # Since dr_c / dr_f is always 2 in the test cases, we can use log base 2.\n        p = np.log2(err_c / err_f)\n        \n        # Format and store the result\n        results.append(f\"{p:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}