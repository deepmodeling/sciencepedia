{
    "hands_on_practices": [
        {
            "introduction": "波形声学模型直接求解声波波动方程。对于矩形房间等简单几何形状，一种基本方法是模态分析，它将声场描述为一系列驻波或“简正模式”的叠加。本练习将引导您从第一性原理出发，推导这些声学模式，将刚性壁面的物理边界条件与定义声场的数学约束联系起来。",
            "id": "4135947",
            "problem": "一个三维矩形房间占据了域 $0 \\leq x \\leq L_{x}$，$0 \\leq y \\leq L_{y}$ 和 $0 \\leq z \\leq L_{z}$。房间内充满了密度为 $\\rho_{0}$、声速为 $c$ 的均匀、无损耗、静止的流体，所有六个壁面都是理想刚性的。考虑角频率为 $\\omega$ 的时谐声学运动，因此声压可以写成 $p(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t)$ 的形式，其中 $p(\\mathbf{x},\\omega)$ 是复振幅。假设一个试验压力振幅\n$$\np(x,y,z,\\omega) = A \\cos(k_{x} x)\\cos(k_{y} y)\\cos(k_{z} z),\n$$\n其中 $A$ 是一个复常数，$k_{x}$、$k_{y}$、$k_{z}$ 是待定的分离常数。\n\n从线性化的声学方程出发，并仅使用标准物理定律，完成以下任务：\n\n1. 推导每个壁面上压力场的刚性壁边界条件，用壁面法向导数 $\\partial p/\\partial n$ 表示，其中 $\\partial p/\\partial n = \\hat{\\mathbf{n}}\\cdot\\nabla p$，$\\hat{\\mathbf{n}}$ 是指向壁面外部的单位法向量。\n\n2. 在六个壁面（$x=0$、$x=L_{x}$、$y=0$、$y=L_{y}$、$z=0$ 和 $z=L_{z}$）上，计算给定试验场的向外法向导数 $\\partial p/\\partial n$。\n\n3. 将第 1 部分推导出的边界条件施加到每个壁面上，并要求其在该壁面上的所有点都成立。由此确定对 $k_{x}$、$k_{y}$ 和 $k_{z}$ 的约束条件。\n\n将波数 $k_{x}$、$k_{y}$ 和 $k_{z}$ 的最终结果以倒易米 $\\text{m}^{-1}$ 为单位表示。将最终答案以一个单行矩阵的形式给出，其中包含用房间尺寸和整数模态指数表示的 $(k_{x},k_{y},k_{z})$ 的三个表达式。无需进行数值四舍五入。",
            "solution": "该问题要求基于给定的压力场试验解，确定具有刚性壁面的矩形房间中声学模态的允许波数。求解过程将按照问题陈述中指定的三个步骤进行。\n\n首先，我将推导理想刚性壁面对声压场施加的边界条件。声压 $p$ 和流体质点速度 $\\mathbf{u}$ 之间的基本关系由线性化的欧拉运动方程给出。对于密度为 $\\rho_{0}$ 的均匀、静止流体，该方程为：\n$$\n\\rho_{0} \\frac{\\partial \\mathbf{u}(\\mathbf{x}, t)}{\\partial t} = -\\nabla p(\\mathbf{x}, t)\n$$\n问题指定了时谐运动，其中压力为 $p(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t)$，质点速度为 $\\mathbf{u}(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t)$。将这些形式代入欧拉方程，得到：\n$$\n\\rho_{0} \\frac{\\partial}{\\partial t} \\left[ \\mathbf{u}(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t) \\right] = -\\nabla \\left[ p(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t) \\right]\n$$\n计算时间导数和梯度，我们得到：\n$$\n\\rho_{0} (-\\mathrm{i}\\,\\omega) \\mathbf{u}(\\mathbf{x},\\omega) \\exp(-\\mathrm{i}\\,\\omega t) = -[\\nabla p(\\mathbf{x},\\omega)] \\exp(-\\mathrm{i}\\,\\omega t)\n$$\n消去公共的时间相关因子 $\\exp(-\\mathrm{i}\\,\\omega t)$ 并整理得到复速度振幅 $\\mathbf{u}(\\mathbf{x},\\omega)$：\n$$\n\\mathbf{u}(\\mathbf{x},\\omega) = \\frac{\\nabla p(\\mathbf{x},\\omega)}{\\mathrm{i}\\,\\omega \\rho_{0}}\n$$\n理想刚性壁面是不可穿透的。这个物理约束意味着流体质点速度在壁面法线方向上的分量必须在壁面处为零。如果 $\\hat{\\mathbf{n}}$ 是指向壁面外部的单位法向量，则此条件表示为：\n$$\n\\mathbf{u}(\\mathbf{x},\\omega) \\cdot \\hat{\\mathbf{n}} = 0 \\quad \\text{for } \\mathbf{x} \\text{ on the wall}\n$$\n代入 $\\mathbf{u}(\\mathbf{x},\\omega)$ 的表达式，得到用压力振幅表示的边界条件：\n$$\n\\frac{\\nabla p(\\mathbf{x},\\omega) \\cdot \\hat{\\mathbf{n}}}{\\mathrm{i}\\,\\omega \\rho_{0}} = 0\n$$\n对于非平凡声场，角频率 $\\omega$ 不为零，流体密度 $\\rho_{0}$ 也不为零。因此，该条件简化为：\n$$\n\\nabla p(\\mathbf{x},\\omega) \\cdot \\hat{\\mathbf{n}} = 0\n$$\n根据定义，法向导数为 $\\partial p/\\partial n = \\nabla p \\cdot \\hat{\\mathbf{n}}$。因此，在理想刚性壁面上，声压振幅 $p$ 的边界条件是：\n$$\n\\frac{\\partial p}{\\partial n} = 0\n$$\n这是一个齐次诺伊曼边界条件。\n\n其次，我们计算给定试验压力场在六个壁面上各自的向外法向导数 $\\partial p/\\partial n$。试验场为：\n$$\np(x,y,z,\\omega) = A \\cos(k_{x} x)\\cos(k_{y} y)\\cos(k_{z} z)\n$$\n该场的梯度 $\\nabla p$ 是：\n$$\n\\nabla p = \\frac{\\partial p}{\\partial x}\\hat{\\mathbf{i}} + \\frac{\\partial p}{\\partial y}\\hat{\\mathbf{j}} + \\frac{\\partial p}{\\partial z}\\hat{\\mathbf{k}}\n$$\n其中\n$$\n\\frac{\\partial p}{\\partial x} = -A k_{x} \\sin(k_{x} x)\\cos(k_{y} y)\\cos(k_{z} z)\n$$\n$$\n\\frac{\\partial p}{\\partial y} = -A k_{y} \\cos(k_{x} x)\\sin(k_{y} y)\\cos(k_{z} z)\n$$\n$$\n\\frac{\\partial p}{\\partial z} = -A k_{z} \\cos(k_{x} x)\\cos(k_{y} y)\\sin(k_{z} z)\n$$\n现在我们在每个壁面上计算 $\\partial p/\\partial n = \\hat{\\mathbf{n}}\\cdot\\nabla p$。\n1.  在 $x=0$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = -\\hat{\\mathbf{i}}$。\n    $\\frac{\\partial p}{\\partial n} = (-\\hat{\\mathbf{i}}) \\cdot \\nabla p = -\\frac{\\partial p}{\\partial x} \\bigg|_{x=0} = -(-A k_{x} \\sin(0)\\cos(k_{y} y)\\cos(k_{z} z)) = 0$。\n2.  在 $x=L_{x}$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = +\\hat{\\mathbf{i}}$。\n    $\\frac{\\partial p}{\\partial n} = (+\\hat{\\mathbf{i}}) \\cdot \\nabla p = +\\frac{\\partial p}{\\partial x} \\bigg|_{x=L_{x}} = -A k_{x} \\sin(k_{x} L_{x})\\cos(k_{y} y)\\cos(k_{z} z)$。\n3.  在 $y=0$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = -\\hat{\\mathbf{j}}$。\n    $\\frac{\\partial p}{\\partial n} = (-\\hat{\\mathbf{j}}) \\cdot \\nabla p = -\\frac{\\partial p}{\\partial y} \\bigg|_{y=0} = -(-A k_{y} \\cos(k_{x} x)\\sin(0)\\cos(k_{z} z)) = 0$。\n4.  在 $y=L_{y}$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = +\\hat{\\mathbf{j}}$。\n    $\\frac{\\partial p}{\\partial n} = (+\\hat{\\mathbf{j}}) \\cdot \\nabla p = +\\frac{\\partial p}{\\partial y} \\bigg|_{y=L_{y}} = -A k_{y} \\cos(k_{x} x)\\sin(k_{y} L_{y})\\cos(k_{z} z)$。\n5.  在 $z=0$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = -\\hat{\\mathbf{k}}$。\n    $\\frac{\\partial p}{\\partial n} = (-\\hat{\\mathbf{k}}) \\cdot \\nabla p = -\\frac{\\partial p}{\\partial z} \\bigg|_{z=0} = -(-A k_{z} \\cos(k_{x} x)\\cos(k_{y} y)\\sin(0)) = 0$。\n6.  在 $z=L_{z}$ 处的壁面：向外法向量为 $\\hat{\\mathbf{n}} = +\\hat{\\mathbf{k}}$。\n    $\\frac{\\partial p}{\\partial n} = (+\\hat{\\mathbf{k}}) \\cdot \\nabla p = +\\frac{\\partial p}{\\partial z} \\bigg|_{z=L_{z}} = -A k_{z} \\cos(k_{x} x)\\cos(k_{y} y)\\sin(k_{z} L_{z})$。\n试验解自动满足了在 $x=0$、$y=0$ 和 $z=0$ 处壁面上的边界条件。\n\n第三，我们将边界条件 $\\partial p/\\partial n = 0$ 施加到剩下的三个壁面（$x=L_x$、$y=L_y$、$z=L_z$）上。对于一个非平凡解（$A \\neq 0$），这要求对波数 $k_{x}$、$k_{y}$ 和 $k_{z}$ 有特定的约束。\n\n1.  在 $x=L_{x}$ 处：我们要求对于所有的 $y \\in [0, L_{y}]$ 和 $z \\in [0, L_{z}]$，都有 $-A k_{x} \\sin(k_{x} L_{x})\\cos(k_{y} y)\\cos(k_{z} z) = 0$。对于一个非平凡的空间模态，只有当正弦项为零时才能满足此条件。$k_x=0$ 的情况是对应于模态指数 $n_x=0$ 的有效解。如果 $k_x \\neq 0$，我们必须有：\n    $$\n    \\sin(k_{x} L_{x}) = 0\n    $$\n    这意味着正弦函数的参数必须是 $\\pi$ 的整数倍。\n    $$\n    k_{x} L_{x} = n_{x} \\pi, \\quad \\text{for } n_{x} \\in \\mathbb{Z}\n    $$\n    这得到 $k_{x} = \\frac{n_{x} \\pi}{L_{x}}$。由于 $\\cos(-u) = \\cos(u)$，负整数的 $n_{x}$ 不会产生新的独立空间函数，因此我们将 $n_{x}$ 限制为非负整数：$n_{x} = 0, 1, 2, \\dots$。\n\n2.  在 $y=L_{y}$ 处：类似的推理要求对于所有的 $x \\in [0, L_{x}]$ 和 $z \\in [0, L_{z}]$，都有 $-A k_{y} \\cos(k_{x} x)\\sin(k_{y} L_{y})\\cos(k_{z} z) = 0$。这导致：\n    $$\n    \\sin(k_{y} L_{y}) = 0 \\quad \\text{or} \\quad k_y=0\n    $$\n    $$\n    k_{y} L_{y} = n_{y} \\pi \\implies k_{y} = \\frac{n_{y} \\pi}{L_{y}}, \\quad \\text{for } n_{y} = 0, 1, 2, \\dots\n    $$\n\n3.  在 $z=L_{z}$ 处：条件 $-A k_{z} \\cos(k_{x} x)\\cos(k_{y} y)\\sin(k_{z} L_{z}) = 0$ 必须对所有的 $x \\in [0, L_{x}]$ 和 $y \\in [0, L_{y}]$ 成立，这意味着：\n    $$\n    \\sin(k_{z} L_{z}) = 0 \\quad \\text{or} \\quad k_z=0\n    $$\n    $$\n    k_{z} L_{z} = n_{z} \\pi \\implies k_{z} = \\frac{n_{z} \\pi}{L_{z}}, \\quad \\text{for } n_{z} = 0, 1, 2, \\dots\n    $$\n\n整数集合 $(n_{x}, n_{y}, n_{z})$ 指定了矩形房间的一个声学模态。情况 $(0,0,0)$ 对应于空间上均匀的压力，这是一个有效的解，代表一个静态的压力偏移。因此，波数是量子化的。\n\n波数的最终表达式为：\n$$\nk_{x} = \\frac{n_{x} \\pi}{L_{x}}\n$$\n$$\nk_{y} = \\frac{n_{y} \\pi}{L_{y}}\n$$\n$$\nk_{z} = \\frac{n_{z} \\pi}{L_{z}}\n$$\n其中 $n_x$、$n_y$ 和 $n_z$ 是非负整数模态指数。单位是正确的，因为 $L_x, L_y, L_z$ 的单位是米，所以波数的单位是倒易米（$\\text{m}^{-1}$）。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{n_{x} \\pi}{L_{x}} & \\frac{n_{y} \\pi}{L_{y}} & \\frac{n_{z} \\pi}{L_{z}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在高频建模中，镜像声源法（Image Source Method, ISM）是一种将声波近似为声线的强大替代方法。该方法通过创建虚拟的“镜像”声源来简化反射问题。本练习要求您编写一个程序，为矩形房间实现核心的ISM算法，计算构成房间脉冲响应基础的声反射的到达时间和衰减。",
            "id": "4135936",
            "problem": "给定一个三维矩形房间，其尺寸为 $(L_x,L_y,L_z)$，一个声源位置 $\\mathbf{r}_s=(x_s,y_s,z_s)$，一个接收器位置 $\\mathbf{r}=(x_r,y_r,z_r)$，声速 $c$（单位为米/秒），以及最大路径长度 $D_{\\max}$（单位为米）。假设墙壁是完美刚性的，这意味着所有墙壁上的声学边界条件（Acoustic Boundary Condition, ABC）是 Neumann 边界条件，即声压的法向导数为零。在此假设下，镜像声源法（Image Source Method, ISM）通过将每次反射替换为一个虚拟声源（一个镜像声源）来模拟镜面反射，该虚拟声源的位置由各轴上的反射生成。\n\n从三维波动方程和相应的自由空间格林函数可知，在无界介质中，单个点源的脉冲响应贡献支撑在由 $t=d/c$ 定义的球面上，其中 $d$ 是到声源的欧几里得距离，其几何扩散幅度按 $1/(4\\pi d)$ 比例缩放。对于刚性墙壁，声压反射系数的模为1，因此反射路径的几何衰减等于相应镜像声源的几何衰减，而没有来自反射的额外幅度缩放。\n\n设镜像声源位置由整数 $(m,n,p)\\in\\mathbb{Z}^3$ 索引，每个坐标由下式给出：\n$$\nx_{m} = 2 m L_x + (-1)^m x_s,\\quad\ny_{n} = 2 n L_y + (-1)^n y_s,\\quad\nz_{p} = 2 p L_z + (-1)^p z_s,\n$$\n因此 $\\mathbf{r}_{mnp} = (x_m,y_n,z_p)$。对每个镜像声源，定义路径长度\n$$\nd_{mnp} = \\left\\|\\mathbf{r}-\\mathbf{r}_{mnp}\\right\\|_2,\n$$\n延迟\n$$\n\\tau_{mnp} = \\frac{d_{mnp}}{c},\n$$\n和几何衰减\n$$\nA_{mnp} = \\frac{1}{4\\pi d_{mnp}}.\n$$\n您的任务是枚举所有满足 $d_{mnp}\\leq D_{\\max}$ 的镜像声源，计算 $\\tau_{mnp}$（单位为秒）和 $A_{mnp}$（单位为 $\\mathrm{m}^{-1}$），并按 $\\tau_{mnp}$ 升序排列输出结果。\n\n您的程序必须通过使用 $|x_m-x_r|\\leq D_{\\max}$、 $|y_n-y_r|\\leq D_{\\max}$ 和 $|z_p-z_r|\\leq D_{\\max}$ 的要求来限定整数索引 $(m,n,p)$，从而高效地实现枚举。枚举必须是精确的；不要在这些边界内进行近似或截断。当直达路径满足 $d_{000}\\leq D_{\\max}$ 时，务必包含对应的 $(m,n,p)=(0,0,0)$。\n\n所有物理量必须使用国际单位制（SI）处理，具体如下：\n- 距离单位为米。\n- 声速单位为米/秒。\n- 延迟单位为秒。\n- 几何衰减单位为反米，$\\mathrm{m}^{-1}$。\n\n在最终输出中，将所有延迟 $\\tau_{mnp}$ 和衰减 $A_{mnp}$ 四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是一个 $[\\tau_{mnp},A_{mnp}]$ 对的列表，同样用方括号括起来，并按 $\\tau_{mnp}$ 升序排序。因此，最终输出格式为：\n$$\n[\\,[\\,[\\tau_1,A_1],\\ldots],\\;[\\,[\\tau_1,A_1],\\ldots],\\;\\ldots\\,]\n$$\n其中最外层的列表汇总了所有提供的测试用例的结果。\n\n除非测试用例中另有说明，否则使用声速 $c=343.0$ 米/秒。\n\n测试套件（每个元组为 $(L_x,L_y,L_z,\\;x_s,y_s,z_s,\\;x_r,y_r,z_r,\\;D_{\\max},\\;c)$）：\n1. 正常路径：$(7.0,6.0,3.0,\\;1.2,2.0,1.0,\\;5.1,4.5,1.4,\\;12.0,\\;343.0)$。\n2. 直达路径上的边界相等情况：$(10.0,8.0,3.0,\\;2.0,3.0,1.5,\\;8.0,3.0,1.5,\\;6.0,\\;343.0)$。\n3. 接收器和声源靠近墙壁：$(4.0,3.0,2.5,\\;0.2,1.0,0.6,\\;0.3,2.1,1.2,\\;3.0,\\;343.0)$。\n4. 范围内无镜像（预期结果为空）：$(6.0,5.0,3.0,\\;0.5,0.5,0.5,\\;5.5,4.5,2.5,\\;1.0,\\;343.0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[[...],[...],[...],[...]]”）。每个内部列表对应一个测试用例，并包含四舍五入到六位小数且按 $\\tau_{mnp}$ 升序排序的 $[\\tau_{mnp},A_{mnp}]$ 对。",
            "solution": "用户提供了一个计算声学问题，要求为一个矩形房间实现镜像声源法（Image Source Method, ISM）。解决方案必须枚举从声源到接收器的所有声学路径（包括直达路径和反射路径），这些路径的长度不超过最大路径长度。\n\n### 步骤 1：问题验证\n\n在尝试解决方案之前，该问题需经过严格的验证过程。\n\n#### 步骤 1.1：提取已知信息\n\n问题描述中提供了以下信息：\n- **房间尺寸**：一个三维矩形房间，其尺寸为 $(L_x, L_y, L_z)$。\n- **声源位置**：$\\mathbf{r}_s = (x_s, y_s, z_s)$。\n- **接收器位置**：$\\mathbf{r} = (x_r, y_r, z_r)$。\n- **声速**：$c$，单位为米/秒。\n- **最大路径长度**：$D_{\\max}$，单位为米。\n- **边界条件**：完美刚性墙壁（Neumann 边界条件），意味着声压反射系数为 $1$。\n- **镜像声源位置公式**：对于整数索引向量 $(m, n, p) \\in \\mathbb{Z}^3$，镜像声源 $\\mathbf{r}_{mnp} = (x_m, y_n, z_p)$ 的坐标由下式给出：\n  $$x_{m} = 2 m L_x + (-1)^m x_s$$\n  $$y_{n} = 2 n L_y + (-1)^n y_s$$\n  $$z_{p} = 2 p L_z + (-1)^p z_s$$\n- **路径长度计算**：从镜像声源到接收器的欧几里得距离为 $d_{mnp} = \\left\\|\\mathbf{r}-\\mathbf{r}_{mnp}\\right\\|_2$。\n- **延迟计算**：传播延迟为 $\\tau_{mnp} = d_{mnp} / c$。\n- **衰减计算**：几何衰减为 $A_{mnp} = \\frac{1}{4\\pi d_{mnp}}$。\n- **主要约束**：只考虑满足 $d_{mnp} \\leq D_{\\max}$ 的镜像声源。\n- **枚举范围界定**：有效整数索引 $(m,n,p)$ 的搜索可以通过必要条件 $|x_m - x_r| \\leq D_{\\max}$、 $|y_n - y_r| \\leq D_{\\max}$ 和 $|z_p - z_r| \\leq D_{\\max}$ 来界定。\n- **输出要求**：对于每个测试用例，生成一个 $[\\tau_{mnp}, A_{mnp}]$ 对的列表，按 $\\tau_{mnp}$ 升序排序，数值四舍五入到六位小数。最终输出将所有测试用例的结果汇总到一个列表中。\n- **默认常数**：除非另有规定，声速为 $c = 343.0 \\, \\mathrm{m/s}$。\n- **测试套件**：提供了一组四个测试用例来验证实现。\n\n#### 步骤 1.2：使用提取的已知信息进行验证\n\n根据预定义标准对问题进行评估：\n\n- **科学性**：镜像声源法是室内声学中用于模拟矩形几何体内镜面反射的一种基础且广泛使用的方法。所提供的镜像声源位置、路径长度、延迟和衰减的公式对于完美刚性墙壁的理想化情况是标准且正确的。其底层的物理原理（波的传播、几何扩散）是合理的。\n- **适定性**：问题定义明确。对于给定的输入参数集，枚举镜像声源、应用滤波器（$d_{mnp} \\leq D_{\\max}$）以及计算相关物理量的过程是确定性的。所提供的范围界定策略确保了搜索空间是有限的，从而保证了唯一且可计算的解的存在。\n- **客观性**：问题使用精确的数学表达式和客观的物理量来表述。它没有歧义、主观性或基于意见的陈述。\n\n该问题没有表现出任何列出的无效性缺陷。它在科学上是合理的、可形式化的、完整的，并提出了一个非平凡但可解的计算任务。\n\n#### 步骤 1.3：结论与行动\n\n问题陈述是**有效的**。将开发并实现一个解决方案。\n\n### 步骤 2：解决方案设计\n\n问题的核心是设计一种算法，能高效地枚举所有满足路径长度约束的镜像声源。\n\n#### 算法原理\n\n镜像声源法通过创建声源的虚拟副本来模拟反射，这些副本是声源跨越房间边界的镜像。对于矩形房间，此过程会生成一个无限的镜像声源晶格。任务是找到所有这些声源，使得从它们到接收器的路径长度不超过 $D_{\\max}$。\n\n#### 界定搜索空间\n\n对所有整数 $(m,n,p) \\in \\mathbb{Z}^3$ 进行暴力搜索在计算上是不可行的。正如问题所建议的，一种更高效的方法是为索引 $m$、$n$ 和 $p$ 建立有限的边界。\n\n主要约束是 $d_{mnp}^2 = (x_m - x_r)^2 + (y_n - y_r)^2 + (z_p - z_r)^2 \\leq D_{\\max}^2$。这意味着每个平方项也必须小于或等于 $D_{\\max}^2$。对于 x 坐标，这给出了必要（但不充分）的条件：\n$$|x_m - x_r| \\leq D_{\\max}$$\n代入 $x_m$ 的定义：\n$$|2 m L_x + (-1)^m x_s - x_r| \\leq D_{\\max}$$\n为了找到一个简单、保守的 $m$ 的整数范围，我们可以使用三角不等式 $|a+b| \\ge |a|-|b|$：\n$$|2 m L_x + ((-1)^m x_s - x_r)| \\ge |2 m L_x| - |(-1)^m x_s - x_r|$$\n因此，该条件要求：\n$$|2 m L_x| - |(-1)^m x_s - x_r| \\leq D_{\\max}$$\n$$|2m|L_x \\leq D_{\\max} + |(-1)^m x_s - x_r|$$\n由于 $0 \\leq x_s \\leq L_x$ 和 $0 \\leq x_r \\leq L_x$，项 $|(-1)^m x_s - x_r|$ 是有界的。例如， $|(-1)^m x_s - x_r| \\leq |x_s| + |x_r| \\le L_x + L_x = 2L_x$。使用这个粗略的界限：\n$$|2m|L_x \\leq D_{\\max} + 2L_x$$\n$$|m| \\leq \\frac{D_{\\max}}{2L_x} + 1$$\n这为索引 $m$ 提供了一个对称且保守的范围：$m \\in [-\\lfloor \\frac{D_{\\max}}{2L_x} + 1 \\rfloor, \\lfloor \\frac{D_{\\max}}{2L_x} + 1 \\rfloor]$。这个范围保证了不会错过任何有效的镜像声源。为索引 $n$ 和 $p$ 推导出类似的边界：\n- $m_{lim} = \\lfloor D_{\\max} / (2L_x) + 1 \\rfloor$\n- $n_{lim} = \\lfloor D_{\\max} / (2L_y) + 1 \\rfloor$\n- $p_{lim} = \\lfloor D_{\\max} / (2L_z) + 1 \\rfloor$\n\n该算法将遍历在范围 $[-m_{lim}, m_{lim}]$、 $[-n_{lim}, n_{lim}]$ 和 $[-p_{lim}, p_{lim}]$ 的笛卡尔积内的所有整数三元组 $(m,n,p)$。\n\n#### 算法大纲\n\n1.  对于每个测试用例，解析输入参数：$(L_x, L_y, L_z)$、$\\mathbf{r}_s=(x_s, y_s, z_s)$、$\\mathbf{r}=(x_r, y_r, z_r)$、$D_{\\max}$ 和 $c$。\n\n2.  如上所述，计算整数索引限制 $m_{lim}$、$n_{lim}$ 和 $p_{lim}$。\n\n3.  初始化一个空列表 `image_contributions`，用于存储有效的 $[\\tau, A]$ 对。\n\n4.  对 $m \\in [-m_{lim}, m_{lim}]$、$n \\in [-n_{lim}, n_{lim}]$ 和 $p \\in [-p_{lim}, p_{lim}]$ 执行三个嵌套循环。\n\n5.  在最内层循环中，对于每个索引三元组 $(m,n,p)$：\n    a. 使用给定公式计算镜像声源位置 $\\mathbf{r}_{mnp}=(x_m, y_n, z_p)$。\n    b. 计算距离向量 $\\mathbf{d} = \\mathbf{r} - \\mathbf{r}_{mnp}$。\n    c. 计算标量路径长度 $d_{mnp} = \\|\\mathbf{d}\\|_2$。\n    d. 如果 $d_{mnp} \\leq D_{\\max}$：\n        i. 检查 $d_{mnp} > 0$ 以防止除以零。问题的设置使得 $d_{mnp}=0$ 极不可能发生，但为了稳健性，这是一个必要的检查。\n        ii. 计算延迟：$\\tau_{mnp} = d_{mnp} / c$。\n        iii. 计算衰减：$A_{mnp} = 1 / (4 \\pi d_{mnp})$。\n        iv. 将对 $[\\tau_{mnp}, A_{mnp}]$ 添加到 `image_contributions` 列表中。\n\n6.  循环完成后，根据每对的第一个元素（延迟 $\\tau$）对 `image_contributions` 列表进行升序排序。\n\n7.  通过遍历已排序的 `image_contributions` 列表创建一个新列表，按要求将每个 $\\tau$ 和 $A$ 值四舍五入到六位小数。\n\n8.  存储生成的四舍五入对的列表。此列表代表一个测试用例的解。\n\n9.  处理完所有测试用例后，将结果汇总到一个最终列表中，并将其格式化为指定的字符串表示形式以供最终输出。\n\n这个系统化的过程确保了问题的所有约束都得到满足，在推导出的边界内提供了精确的枚举，并以指定的排序和格式化方式生成输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the Image Source Method (ISM) to find all acoustic paths within a maximum length\n    for a rectangular room with rigid walls.\n    \"\"\"\n\n    # Test Suite provided in the problem statement.\n    # Format: (Lx, Ly, Lz, xs, ys, zs, xr, yr, zr, D_max, c)\n    test_cases = [\n        (7.0, 6.0, 3.0, 1.2, 2.0, 1.0, 5.1, 4.5, 1.4, 12.0, 343.0),\n        (10.0, 8.0, 3.0, 2.0, 3.0, 1.5, 8.0, 3.0, 1.5, 6.0, 343.0),\n        (4.0, 3.0, 2.5, 0.2, 1.0, 0.6, 0.3, 2.1, 1.2, 3.0, 343.0),\n        (6.0, 5.0, 3.0, 0.5, 0.5, 0.5, 5.5, 4.5, 2.5, 1.0, 343.0),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        Lx, Ly, Lz, xs, ys, zs, xr, yr, zr, D_max, c = case\n        \n        r_s = np.array([xs, ys, zs])\n        r_r = np.array([xr, yr, zr])\n        L = np.array([Lx, Ly, Lz])\n\n        # Calculate conservative bounds for the integer indices m, n, p.\n        # This is based on |m| = D_max / (2*L) + 1.\n        m_lim = int(np.floor(D_max / (2 * Lx) + 1))\n        n_lim = int(np.floor(D_max / (2 * Ly) + 1))\n        p_lim = int(np.floor(D_max / (2 * Lz) + 1))\n\n        image_contributions = []\n\n        for m_idx in range(-m_lim, m_lim + 1):\n            for n_idx in range(-n_lim, n_lim + 1):\n                for p_idx in range(-p_lim, p_lim + 1):\n                    # Compute the position of the image source r_mnp\n                    \n                    # x_m = 2*m*Lx + (-1)^m * xs\n                    x_m = 2 * m_idx * Lx + ((-1)**m_idx) * xs\n                    # y_n = 2*n*Ly + (-1)^n * ys\n                    y_n = 2 * n_idx * Ly + ((-1)**n_idx) * ys\n                    # z_p = 2*p*Lz + (-1)^p * zs\n                    z_p = 2 * p_idx * Lz + ((-1)**p_idx) * zs\n\n                    r_mnp = np.array([x_m, y_n, z_p])\n                    \n                    # Calculate distance d_mnp = ||r_r - r_mnp||\n                    d_mnp = np.linalg.norm(r_r - r_mnp)\n\n                    # Check if the path length is within the maximum allowed distance\n                    if d_mnp = D_max:\n                        # Ensure distance is non-zero to avoid division by zero\n                        if d_mnp > 1e-9: # Using a small epsilon for floating point safety\n                            # Calculate delay tau = d/c\n                            tau_mnp = d_mnp / c\n                            # Calculate geometric attenuation A = 1/(4*pi*d)\n                            A_mnp = 1.0 / (4.0 * np.pi * d_mnp)\n                            image_contributions.append([tau_mnp, A_mnp])\n        \n        # Sort contributions by ascending delay (tau)\n        image_contributions.sort(key=lambda x: x[0])\n        \n        # Round the results to 6 decimal places\n        rounded_results = [[round(tau, 6), round(A, 6)] for tau, A in image_contributions]\n        \n        all_results.append(rounded_results)\n\n    # Format the final output string to match the problem specification\n    # [[...],[...],...] without spaces.\n    results_str = str(all_results).replace(\" \", \"\")\n    print(results_str)\n\nsolve()\n```"
        },
        {
            "introduction": "将像镜像声源法（ISM）这样的理论模型转化为数字音频仿真的一个关键步骤是，在离散的采样网格上精确地表示连续时间事件（如回声到达）。本练习通过实现一个多项式插值滤波器来解决“分数延迟”问题。您不仅将学习创建更精确的离散脉冲响应，还将学会量化近似误差，这是评估计算模型的关键技能。",
            "id": "4135901",
            "problem": "给定一个通过镜像声源法建模的矩形房间场景，接收器处由一组到达波引起的连续时间声学脉冲响应是一系列延迟Dirac脉冲的和。设采样率为 $f_s$（单位为 $\\mathrm{Hz}$），到达时间为集合 $\\{t_n\\}_{n=1}^N$（单位为 $\\mathrm{s}$）。假设所有到达波的振幅均为单位振幅，因此连续时间脉冲响应为 $h_\\mathrm{c}(t) = \\sum_{n=1}^N \\delta(t - t_n)$。离散化后，所需的离散时间脉冲响应是一个序列 $h[k]$，其构造旨在近似非整数采样点索引处的延迟脉冲。使用M阶多项式Lagrange插值实现分数样本延迟：对于每个延迟 $t_n$，其以采样点数为单位的延迟为 $d_n = f_s t_n$，可写作 $d_n = p_n + \\mu_n$，其中 $p_n \\in \\mathbb{Z}$ 是整数部分，$\\mu_n \\in [0,1)$ 是小数部分。M阶插值产生一个支撑在 $M+1$ 个连续采样点上的有限脉冲响应，该响应在整数索引 $p_n$ 附近近似分数延迟 $\\mu_n$。\n\n从线性波动方程及其在室内声学中的Green函数解出发，论证将离散时间表示为延迟脉冲之和的合理性，并推导M阶Lagrange插值如何近似分数延迟。然后，定义离散化脉冲响应的频率响应 $H_\\mathrm{approx}(f) = \\sum_{k=0}^{L-1} h[k] e^{-j 2 \\pi f k / f_s}$ 和理想连续时间频率响应 $H_\\mathrm{ideal}(f) = \\sum_{n=1}^N e^{-j 2 \\pi f t_n}$。作为插值阶数和频率的函数的近似误差为\n$$\nE_M(f) = \\left| \\, \\left|H_\\mathrm{approx}(f)\\right| - \\left|H_\\mathrm{ideal}(f)\\right| \\, \\right|.\n$$\n此处，所有角度均以弧度为单位。你必须使用M阶Lagrange插值计算 $h[k]$，在指定的频率网格上评估 $H_\\mathrm{approx}(f)$ 和 $H_\\mathrm{ideal}(f)$，并报告每个网格上的最大幅度误差。\n\n实现一个完整、可运行的程序，该程序：\n- 根据提供的 $f_s$、$\\{t_n\\}$ 和插值阶数 $M$ 构建 $h[k]$。\n- 在测试套件中的每个频率上评估 $H_\\mathrm{approx}(f)$ 和 $H_\\mathrm{ideal}(f)$。\n- 对每个测试案例，计算标量度量 $\\max_{f \\in \\mathcal{F}} E_M(f)$，其中 $\\mathcal{F}$ 是该测试案例提供的频率集合。\n- 生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。\n\n所有物理单位必须遵守：$f_s$ 的单位为 $\\mathrm{Hz}$，延迟 $t_n$ 的单位为 $\\mathrm{s}$，频率 $f$ 的单位为 $\\mathrm{Hz}$。角度必须以弧度为单位。最终输出为无量纲实数。\n\n测试套件：\n- 案例 1 (一般情况)：$f_s = 48000$，$\\{t_n\\} = \\{0.007123, 0.012345\\}$，$M = 3$，频率集合 $\\mathcal{F} = \\{0, 1000, 5000, 10000, 15000, 20000\\}$。\n- 案例 2 (边界情况：最近邻插值)：$f_s = 48000$，$\\{t_n\\} = \\{0.0034\\}$，$M = 0$，频率集合 $\\mathcal{F} = \\{0, 5000, 10000, 20000, 23000\\}$。\n- 案例 3 (边缘情况：高阶插值和接近整数的分数延迟)：$f_s = 44100$，$\\{t_n\\} = \\{(100.999)/f_s, (257.1)/f_s\\}$，$M = 10$，频率集合 $\\mathcal{F} = \\{0, 1000, 5000, 10000, 15000, 20000\\}$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如 $[r_1,r_2,r_3]$），其中 $r_i$ 是案例 $i$ 的 $\\max_{f \\in \\mathcal{F}} E_M(f)$，表示为十进制数。",
            "solution": "该问题要求制定并实现一个程序，以量化使用基于多项式的分数延迟滤波对连续时间声学脉冲响应进行离散化时引入的误差。脉冲响应被建模为延迟Dirac脉冲之和，这一表示法通过室内声学中的镜像声源法得以证明其合理性。\n\n### 第 1 部分：从波动方程到延迟脉冲之和\n\n声音在空气等流体介质中的传播由线性声学波动方程控制。对于位置 $\\mathbf{r}$ 和时间 $t$ 处的声压场 $p(\\mathbf{r}, t)$，该方程为：\n$$\n\\nabla^2 p(\\mathbf{r}, t) - \\frac{1}{c^2} \\frac{\\partial^2 p(\\mathbf{r}, t)}{\\partial t^2} = -S(\\mathbf{r}, t)\n$$\n其中 $c$ 是声速，$S(\\mathbf{r}, t)$ 是一个源项。对于位于 $\\mathbf{r}_s$ 处、在时间 $t=0$ 发出脉冲的理想化点声源，源项为 $S(\\mathbf{r}, t) = \\delta(\\mathbf{r} - \\mathbf{r}_s) \\delta(t)$。\n\n在无界自由场介质中，此方程的解是Green函数，它表示一个球形扩展波：\n$$\ng(\\mathbf{r}, t | \\mathbf{r}_s, 0) = \\frac{1}{4\\pi ||\\mathbf{r} - \\mathbf{r}_s||} \\delta\\left(t - \\frac{||\\mathbf{r} - \\mathbf{r}_s||}{c}\\right)\n$$\n该解是一个Dirac脉冲，其延迟为传播时间 $t_d = ||\\mathbf{r} - \\mathbf{r}_s||/c$，振幅因球面扩展因子 $1/(4\\pi ||\\mathbf{r} - \\mathbf{r}_s||)$ 而衰减。\n\n在混响环境中，例如具有声学硬（全反射）墙壁的矩形房间，接收器位置 $\\mathbf{r}_r$ 处的声场是来自声源的直达声与一系列墙壁反射声的叠加。镜像声源法为求解该声场提供了一种简洁的方法。墙壁施加的边界条件通过构建一个“镜像”声源晶格来满足，这些镜像是物理声源跨越房间边界的反射。\n\n每个由索引 $n$ 标识的镜像声源都如同自由空间中的一个声源，为接收器处的声压贡献一个延迟和衰减的脉冲。接收器处的总声学脉冲响应 $h_c(t)$ 是这些贡献的总和：\n$$\nh_c(t) = \\sum_{n=0}^{\\infty} A_n \\delta(t - t_n)\n$$\n这里，$t_n$ 是从第 $n$ 个镜像声源到接收器的传播时间，$A_n$ 是相应的衰减因子，它考虑了球面扩展和墙壁的反射系数。\n\n问题陈述简化了该模型，假设存在有限数量 $N$ 的显著到达波，并且所有到达波都具有单位振幅（对于所有 $n$，$A_n=1$）。这直接导出了给定的连续时间脉冲响应模型：\n$$\nh_c(t) = \\sum_{n=1}^N \\delta(t - t_n)\n$$\n这证明了将房间脉冲响应表示为延迟Dirac脉冲之和的合理性。\n\n### 第 2 部分：通过Lagrange插值进行离散化\n\n为了用数字系统处理连续时间信号 $h_c(t)$，必须以速率 $f_s$（采样周期 $T_s = 1/f_s$）对其进行采样。一种朴素的采样过程 $h[k] = h_c(k T_s)$ 会漏掉任何到达时间 $t_n$ 不是 $T_s$ 整数倍的脉冲。\n\n对于在时间 $t_n$ 到达的声波，其以采样点数为单位的总延迟为 $d_n = t_n / T_s = f_s t_n$。通常，$d_n$ 是一个非整数值。我们可以将其分解为一个整数部分 $p_n = \\lfloor d_n \\rfloor$ 和一个小数部分 $\\mu_n = d_n - p_n$，其中 $\\mu_n \\in [0, 1)$。在离散时间域中正确表示这种非整数延迟的任务被称为分数延迟滤波。\n\n理想的分数延迟滤波器具有非因果的无限长脉冲响应（一个移位的sinc函数），因此不切实际。因此，需要一种有限长脉冲响应（FIR）近似。Lagrange插值提供了一种构建此类FIR滤波器的方法。\n\n一个M阶Lagrange插值器构造一个唯一的至多M次的多项式，该多项式穿过给定的M+1个点。为了设计一个近似分数延迟 $\\mu_n$ 的FIR滤波器，我们可以使用Lagrange基多项式。对于一个长度为 $M+1$ 的因果滤波器，它在整数采样索引 $\\{0, 1, \\dots, M\\}$ 上进行插值，其在索引 $\\ell \\in \\{0, 1, \\dots, M\\}$ 处的滤波器系数由下式给出：\n$$\nh_{\\mu_n, M}[\\ell] = \\prod_{i=0, i \\neq \\ell}^{M} \\frac{\\mu_n - i}{\\ell - i}\n$$\n这些系数 $h_{\\mu_n, M}[\\ell]$ 构成了近似分数延迟部分 $\\mu_n$ 的FIR滤波器。整数延迟部分 $p_n$ 通过沿时间轴移动此FIR滤波器的位置来实现。\n\n### 第 3 部分：脉冲响应构建算法\n\n完整的离散时间脉冲响应 $h[k]$ 是通过叠加每个到达波的独立FIR滤波器来构建的。\n\n1.  **确定脉冲响应长度**：最晚的到达时间 $t_{\\max} = \\max_n\\{t_n\\}$ 决定了离散脉冲响应数组所需的长度。最大采样延迟为 $d_{\\max} = f_s t_{\\max}$。该到达波的滤波器将在索引 $\\lfloor d_{\\max} \\rfloor + M$ 处有其最后一个非零系数。因此，所需的总长度为 $L = \\lfloor d_{\\max} \\rfloor + M + 1$。一个长度为 $L$ 的数组 $h[k]$ 被初始化为全零。\n\n2.  **叠加到达滤波器**：对于集合 $\\{t_n\\}_{n=1}^N$ 中的每个到达时间 $t_n$：\n    a. 计算以采样点为单位的总延迟：$d_n = f_s t_n$。\n    b. 将延迟分解为其整数部分和小数部分：$p_n = \\lfloor d_n \\rfloor$ 和 $\\mu_n = d_n - p_n$。\n    c. 对于从 $0$ 到 $M$ 的每个索引 $\\ell$：\n        i.  计算Lagrange插值系数：$c_\\ell = \\prod_{i=0, i \\neq \\ell}^{M} (\\mu_n - i) / (\\ell - i)$。\n        ii. 将此系数加到总脉冲响应中相应的采样索引处：$h[p_n + \\ell] \\leftarrow h[p_n + \\ell] + c_\\ell$。\n\n得到的数组 $h[k]$ 是房间脉冲响应 $h_c(t)$ 的离散化表示。\n\n### 第 4 部分：频域误差计算\n\n为了评估近似的质量，我们将离散时间滤波器的频率响应幅度 $H_\\mathrm{approx}(f)$ 与理想连续时间响应的频率响应幅度 $H_\\mathrm{ideal}(f)$ 进行比较。\n\n1.  **近似频率响应**：对于给定的频率 $f$，$H_\\mathrm{approx}(f)$ 通过 $h[k]$ 的离散时间傅里叶变换（DTFT）计算：\n    $$\n    H_\\mathrm{approx}(f) = \\sum_{k=0}^{L-1} h[k] e^{-j 2 \\pi f k / f_s}\n    $$\n    其中 $j = \\sqrt{-1}$。\n\n2.  **理想频率响应**：理想连续时间响应 $h_c(t) = \\sum_{n=1}^N \\delta(t - t_n)$ 的傅里叶变换为：\n    $$\n    H_\\mathrm{ideal}(f) = \\mathcal{F}\\{h_c(t)\\} = \\sum_{n=1}^N e^{-j 2 \\pi f t_n}\n    $$\n\n3.  **误差度量**：在给定频率 $f$ 处的误差定义为幅度响应之间的绝对差：\n    $$\n    E_M(f) = \\left| \\, \\left|H_\\mathrm{approx}(f)\\right| - \\left|H_\\mathrm{ideal}(f)\\right| \\, \\right|\n    $$\n每个测试案例的最终度量是在指定频率集合 $\\mathcal{F}$ 上该误差的最大值：\n$$\n\\max_{f \\in \\mathcal{F}} E_M(f)\n$$\n\n这个过程提供了一个定量度量，衡量M阶基于Lagrange的的分数延迟滤波器在多大程度上保持了理想信号的幅度谱。",
            "answer": "```python\nimport numpy as np\n\ndef lagrange_coeffs(mu, M):\n    \"\"\"\n    Computes the coefficients of an order-M Lagrange interpolation FIR filter\n    for a fractional delay mu.\n    \"\"\"\n    if M == 0:\n        return np.array([1.0])\n    \n    ell = np.arange(M + 1)\n    coeffs = np.zeros(M + 1)\n    \n    for l_idx, l_val in enumerate(ell):\n        numerator = 1.0\n        denominator = 1.0\n        for i_val in ell:\n            if i_val != l_val:\n                numerator *= mu - i_val\n                denominator *= l_val - i_val\n        coeffs[l_idx] = numerator / denominator\n        \n    return coeffs\n\ndef calculate_max_error(fs, t_n_list, M, F_list):\n    \"\"\"\n    Calculates the maximum approximation error over a set of frequencies.\n    \"\"\"\n    if not t_n_list:\n        return 0.0\n\n    # Step 1: Construct the discrete-time impulse response h[k]\n    t_n_array = np.array(t_n_list)\n    d_max = fs * np.max(t_n_array)\n    p_max = int(np.floor(d_max))\n    L = p_max + M + 1\n    h = np.zeros(L, dtype=np.float64)\n\n    for t_n in t_n_array:\n        d_n = fs * t_n\n        p_n = int(np.floor(d_n))\n        mu_n = d_n - p_n\n        \n        coeffs = lagrange_coeffs(mu_n, M)\n        \n        start_idx = p_n\n        end_idx = p_n + M + 1\n        if end_idx = L:\n            h[start_idx:end_idx] += coeffs\n\n    # Step 2: Calculate error for each frequency in F_list\n    max_error = 0.0\n    k_vec = np.arange(L)\n    \n    for f in F_list:\n        # Calculate approximate frequency response\n        exp_vec_approx = np.exp(-1j * 2 * np.pi * f * k_vec / fs)\n        H_approx = np.sum(h * exp_vec_approx)\n\n        # Calculate ideal frequency response\n        exp_vec_ideal = np.exp(-1j * 2 * np.pi * f * t_n_array)\n        H_ideal = np.sum(exp_vec_ideal)\n        \n        # Calculate error\n        error = np.abs(np.abs(H_approx) - np.abs(H_ideal))\n        if error > max_error:\n            max_error = error\n            \n    return max_error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"fs\": 48000,\n            \"t_n\": [0.007123, 0.012345],\n            \"M\": 3,\n            \"F\": [0, 1000, 5000, 10000, 15000, 20000],\n        },\n        {\n            \"fs\": 48000,\n            \"t_n\": [0.0034],\n            \"M\": 0,\n            \"F\": [0, 5000, 10000, 20000, 23000],\n        },\n        {\n            \"fs\": 44100,\n            \"t_n\": [100.999 / 44100, 257.1 / 44100],\n            \"M\": 10,\n            \"F\": [0, 1000, 5000, 10000, 15000, 20000],\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        fs = case[\"fs\"]\n        t_n_list = case[\"t_n\"]\n        M = case[\"M\"]\n        F_list = case[\"F\"]\n        \n        max_err = calculate_max_error(fs, t_n_list, M, F_list)\n        results.append(f\"{max_err:.10f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}