{
    "hands_on_practices": [
        {
            "introduction": "The Chern number, $C$, is a robust integer invariant that quantifies the topological nature of a two-dimensional material's band structure. It is formally defined by integrating the Berry curvature over the entire Brillouin zone. This exercise  introduces a direct and numerically stable approach for this calculation, the Fukui-Hatsugai-Suzuki (FHS) method, which cleverly avoids the gauge-dependency issues inherent in the Berry connection. By implementing this method on a discrete momentum-space lattice, you will gain tangible experience in computing this fundamental topological quantity and appreciate the numerical challenges involved, such as finite-mesh errors.",
            "id": "4147729",
            "problem": "Consider a two-dimensional periodic acoustic metamaterial modeled at low frequencies by a coupled-mode effective Bloch operator with two hybridized pressure modes per unit cell. By spatial periodicity and the Bloch theorem, the small-amplitude pressure field can be represented by Bloch wave solutions labeled by a Bloch wavevector $k = (k_x,k_y)$ on the first Brillouin zone, which is taken to be the square domain $k_x,k_y \\in [-\\pi,\\pi]$ with angles in radians. The mode coupling is chosen to be symmetry-allowed and non-reciprocal, producing an effective $2 \\times 2$ Hermitian Bloch operator\n$$\nH(k) = \\sin(k_x)\\,\\sigma_x + \\sin(k_y)\\,\\sigma_y + \\left(m + \\cos(k_x) + \\cos(k_y)\\right)\\,\\sigma_z,\n$$\nwhere $m$ is a dimensionless bias parameter tunable by rotating the resonators or by imposing a steady acoustic flow, and $\\sigma_x,\\sigma_y,\\sigma_z$ are the Pauli matrices. For each $k$, the eigenvalue problem $H(k)\\,u_b(k) = \\omega_b(k)\\,u_b(k)$ defines band-indexed normalized eigenmodes $u_b(k)$.\n\nThe first Chern number of an isolated band $b$ is the integer given by the integral of the Berry curvature over the Brillouin zone, which arises from the geometric phase accumulated by parallel transport of $u_b(k)$ around infinitesimal loops in $k$-space. Starting from the definition of the Berry connection and Berry curvature and using the fact that numerical computation operates on a finite mesh, construct a discrete approximation of the Chern number for the lower band $b=0$ (the band with the smaller eigenvalue) based on gauge-invariant link variables on a uniform grid of the Brillouin zone. Implement the method by discretizing the Brillouin zone into a uniform $N \\times N$ mesh of $k$-points, with $k_x$ and $k_y$ sampled uniformly in $[-\\pi,\\pi]$. Use periodic boundary conditions on the mesh so that neighboring points at the boundary wrap around.\n\nCompute the discrete Berry flux over each elementary plaquette from the phase accumulated by transporting the eigenvector around the plaquette, and sum over all plaquettes to estimate the lower-band Chern number. For numerical stability, ensure that eigenvectors are normalized at each $k$ and use gauge-invariant comparisons of neighboring eigenvectors. The angles must be treated in radians.\n\nIn addition to computing the Chern number, estimate two numerical error metrics:\n\n- A finite-mesh discretization error estimate: compute the absolute difference between the Chern number obtained on the base mesh size $N$ and the refined mesh size $2N$, both using the same $m$ and the same method described above. Report this difference as a non-negative real number.\n\n- A mode orthogonality stability metric: for the base mesh size $N$, compute the average deviation of the neighbor overlaps from unit magnitude across the mesh for the lower band. Specifically, at each $k$ on the mesh, compute the overlap magnitudes $s_x(k) = \\left|\\langle u_0(k)\\,|\\,u_0(k+\\Delta_x)\\rangle\\right|$ and $s_y(k) = \\left|\\langle u_0(k)\\,|\\,u_0(k+\\Delta_y)\\rangle\\right|$, where $\\Delta_x$ and $\\Delta_y$ denote one-mesh-step displacements in the $k_x$ and $k_y$ directions with periodic wrapping. Then define the orthogonality stability metric as the arithmetic mean over all $k$ of $\\left(1 - s_x(k)\\right)$ and $\\left(1 - s_y(k)\\right)$; report this mean as a real number in $[0,1]$. Larger values indicate stronger local gauge fluctuations due to coarse sampling or near-degeneracies.\n\nYour program must, for each test case in the following test suite, output a list with three entries $[C, E_{\\mathrm{mesh}}, E_{\\mathrm{ortho}}]$ where $C$ is the computed lower-band Chern number on the base mesh $N$ (reported as a real number without rounding), $E_{\\mathrm{mesh}}$ is the finite-mesh discretization error estimate as defined above, and $E_{\\mathrm{ortho}}$ is the mode orthogonality stability metric as defined above. The test suite contains the following parameter sets $(m,N)$:\n\n- Test case $1$: $(m,N) = (-1.0,\\,21)$.\n- Test case $2$: $(m,N) = (0.0,\\,21)$, a gap-closing boundary case.\n- Test case $3$: $(m,N) = (1.0,\\,21)$.\n- Test case $4$: $(m,N) = (3.0,\\,21)$.\n- Test case $5$: $(m,N) = (-1.0,\\,9)$, a coarse mesh to stress orthogonality stability.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, for example, $[[r_{11},r_{12},r_{13}],[r_{21},r_{22},r_{23}],\\ldots]$, where each $r_{ij}$ is a real number. Angles must be in radians, and no physical units are required because all quantities are dimensionless. The code must be self-contained and runnable without any input.",
            "solution": "The problem requires the computation of the first Chern number for the lower band of a two-dimensional topological acoustic metamaterial, along with two numerical error metrics. The solution necessitates a numerical approach based on a lattice discretization of the Brillouin zone.\n\nThe system is described by a $2 \\times 2$ Hermitian Bloch operator, or Hamiltonian, which is a function of the Bloch wavevector $k = (k_x, k_y)$:\n$$\nH(k) = d_x(k)\\,\\sigma_x + d_y(k)\\,\\sigma_y + d_z(k)\\,\\sigma_z\n$$\nwhere $\\sigma_x, \\sigma_y, \\sigma_z$ are the Pauli matrices:\n$$\n\\sigma_x = \\begin{pmatrix} 0 & 1 \\\\ 1 & 0 \\end{pmatrix}, \\quad \\sigma_y = \\begin{pmatrix} 0 & -i \\\\ i & 0 \\end{pmatrix}, \\quad \\sigma_z = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\end{pmatrix}\n$$\nThe components of the vector $\\vec{d}(k)$ are given by $d_x(k) = \\sin(k_x)$, $d_y(k) = \\sin(k_y)$, and $d_z(k) = m + \\cos(k_x) + \\cos(k_y)$. The parameter $m$ tunes the system through different topological phases. The eigenvalues of this Hamiltonian are $\\omega(k) = \\pm|\\vec{d}(k)|$, defining two energy bands. The problem focuses on the lower band, corresponding to the eigenvalue $\\omega_0(k) = -|\\vec{d}(k)|$.\n\nThe first Chern number, $C$, is a topological invariant that characterizes the band structure. It is defined as the integral of the Berry curvature, $\\mathcal{F}(k)$, over the first Brillouin zone (BZ):\n$$\nC = \\frac{1}{2\\pi} \\int_{\\mathrm{BZ}} \\mathcal{F}(k) \\, dk_x dk_y\n$$\nThe Berry curvature arises from the geometry of the eigenstates. For a numerical calculation on a finite grid, a direct discretization of this integral is cumbersome due to the gauge-dependent nature of the underlying Berry connection. A more robust method, as suggested by the problem, is based on a lattice gauge theory formulation proposed by Fukui, Hatsugai, and Suzuki.\n\nThe numerical procedure is as follows:\n\n1.  **Discretization of the Brillouin Zone**: The BZ, $k_x, k_y \\in [-\\pi, \\pi]$, is discretized into a uniform $N \\times N$ grid. To respect the periodic nature of the BZ, the grid points are chosen as $k_{i_x, i_y} = (k_x^{(i_x)}, k_y^{(i_y)})$ where $k_{x,y}^{(i)} = -\\pi + i \\frac{2\\pi}{N}$ for $i_{x,y} \\in \\{0, 1, \\dots, N-1\\}$.\n\n2.  **Eigenvector Calculation**: At each grid point $k$, the Hamiltonian matrix $H(k)$ is constructed and diagonalized to find its eigenvalues and eigenvectors. We are interested in the normalized eigenvector $u_0(k)$ corresponding to the lowest eigenvalue $\\omega_0(k)$. This is performed for all $N^2$ points on the grid.\n\n3.  **Link Variables**: We define link variables that connect adjacent eigenvectors on the lattice. These are complex numbers representing the gauge-invariant part of the parallel transport:\n    $$\n    U_x(k) = \\langle u_0(k) | u_0(k + \\Delta_x) \\rangle\n    $$\n    $$\n    U_y(k) = \\langle u_0(k) | u_0(k + \\Delta_y) \\rangle\n    $$\n    where $\\Delta_x$ and $\\Delta_y$ are the lattice vectors in the $k_x$ and $k_y$ directions, respectively. The inner product is $\\langle a | b \\rangle = a^\\dagger b$.\n\n4.  **Plaquette Berry Flux**: The local Berry flux through an elementary plaquette starting at point $k$ is calculated from the argument of the plaquette's Wilson loop. This product of four link variables around the plaquette is a gauge-invariant quantity:\n    $$\n    W(k) = U_x(k) \\, U_y(k+\\Delta_x) \\, U_x(k+\\Delta_y)^* \\, U_y(k)^*\n    $$\n    The local flux is then $\\mathcal{F}_{\\text{lat}}(k) = \\arg(W(k))$. The branch of the complex logarithm must be chosen in $(-\\pi, \\pi]$, which is naturally handled by the `atan2` function (or `numpy.angle`).\n\n5.  **Chern Number Summation**: The total Chern number is the sum of these local fluxes over all $N^2$ plaquettes in the BZ, normalized by $2\\pi$:\n    $$\n    C = \\frac{1}{2\\pi} \\sum_{k \\in \\text{grid}} \\mathcal{F}_{\\text{lat}}(k)\n    $$\n    For a gapped system and a sufficiently fine mesh, this sum converges to an integer.\n\nIn addition to the Chern number $C$ for a base mesh of size $N$, two error metrics are computed:\n\n-   **Finite-mesh discretization error ($E_{\\mathrm{mesh}}$)**: This metric estimates the convergence of the calculation with respect to the mesh size. It is computed as the absolute difference between the Chern numbers calculated on the base ($N \\times N$) and a refined ($2N \\times 2N$) mesh:\n    $$\n    E_{\\mathrm{mesh}} = |C_N - C_{2N}|\n    $$\n\n-   **Mode orthogonality stability metric ($E_{\\mathrm{ortho}}$)**: This metric quantifies the \"smoothness\" of the eigenvector field across the BZ. Since normalized eigenvectors at neighboring points $k$ and $k'$ should be nearly identical (differing by a small rotation), the magnitude of their inner product $|\\langle u_0(k) | u_0(k') \\rangle|$ should be close to $1$. A significant deviation from $1$ indicates a rapid change in the eigenvector, which occurs near band degeneracies (gap-closing points) or if the mesh is too coarse. The metric is defined as the average deviation from unity over all links on the base $N \\times N$ grid:\n    $$\n    E_{\\mathrm{ortho}} = \\frac{1}{2N^2} \\sum_{k \\in \\text{grid}} \\left[ \\left(1 - |\\langle u_0(k)|u_0(k+\\Delta_x)\\rangle|\\right) + \\left(1 - |\\langle u_0(k)|u_0(k+\\Delta_y)\\rangle|\\right) \\right]\n    $$\n\nThe implementation leverages `numpy` for efficient, vectorized computations. The k-space grid is generated using `meshgrid`. The Hamiltonian is constructed as an array of shape $(N, N, 2, 2)$. `numpy.linalg.eigh` is used to diagonalize all $N^2$ matrices simultaneously. Periodic boundary conditions are handled efficiently using `numpy.roll` for shifting arrays to access neighboring grid points. This vectorized approach avoids slow Python loops and is well-suited for this class of problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_properties(m, N_grid):\n    \"\"\"\n    Computes the Chern number and orthogonality metrics for a given m and grid size N.\n\n    Args:\n        m (float): The bias parameter in the Hamiltonian.\n        N_grid (int): The number of points along one dimension of the BZ grid.\n\n    Returns:\n        tuple: A tuple containing:\n            - chern_number (float): The computed Chern number for the lower band.\n            - s_x (np.ndarray): Array of overlap magnitudes in the x-direction.\n            - s_y (np.ndarray): Array of overlap magnitudes in the y-direction.\n    \"\"\"\n    # Create the k-space grid. np.linspace with endpoint=False is standard for\n    # periodic Fourier-space calculations.\n    k_vals = np.linspace(-np.pi, np.pi, N_grid, endpoint=False)\n    kx, ky = np.meshgrid(k_vals, k_vals, indexing='ij')\n\n    # Construct the Hamiltonian H(k) = d(k) . sigma over the entire grid.\n    # The shape will be (N_grid, N_grid, 2, 2).\n    H = np.zeros((N_grid, N_grid, 2, 2), dtype=complex)\n    \n    # Components of the d-vector\n    d_x = np.sin(kx)\n    d_y = np.sin(ky)\n    d_z = m + np.cos(kx) + np.cos(ky)\n\n    # Populate the Hamiltonian matrices using Pauli matrix definitions\n    H[..., 0, 0] = d_z\n    H[..., 1, 1] = -d_z\n    H[..., 0, 1] = d_x - 1j * d_y\n    H[..., 1, 0] = d_x + 1j * d_y\n\n    # Diagonalize the Hamiltonian at each k-point.\n    # np.linalg.eigh is for Hermitian matrices and returns sorted eigenvalues\n    # and corresponding normalized eigenvectors.\n    # evals shape: (N_grid, N_grid, 2)\n    # evecs shape: (N_grid, N_grid, 2, 2)\n    evals, evecs = np.linalg.eigh(H)\n\n    # Extract the eigenvectors for the lower band (corresponding to the first eigenvalue).\n    # u0 shape: (N_grid, N_grid, 2)\n    u0 = evecs[..., 0]\n\n    # Compute link variables (overlaps) using periodic boundary conditions via np.roll.\n    # The inner product is <u|v> = u*.v\n    link_x = np.sum(u0.conj() * np.roll(u0, -1, axis=0), axis=2)\n    link_y = np.sum(u0.conj() * np.roll(u0, -1, axis=1), axis=2)\n\n    # Compute the plaquette Wilson loop product: U_x(k) U_y(k+dx) U_x(k+dy)* U_y(k)*\n    plaquette_prod = link_x * np.roll(link_y, -1, axis=0) * np.conj(np.roll(link_x, -1, axis=1)) * np.conj(link_y)\n\n    # The Chern number is the sum of the argument of the plaquette products, normalized by 2*pi.\n    # np.angle correctly handles the principal value of the argument.\n    chern_number = np.sum(np.angle(plaquette_prod)) / (2 * np.pi)\n\n    # For the orthogonality metric, we need the magnitudes of the link variables.\n    s_x = np.abs(link_x)\n    s_y = np.abs(link_y)\n    \n    return chern_number, s_x, s_y\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all specified test cases.\n    \"\"\"\n    # (Parameter set 1), (Parameter set 2), ...\n    test_cases = [\n        (-1.0, 21),  # Test case 1\n        (0.0, 21),   # Test case 2\n        (1.0, 21),   # Test case 3\n        (3.0, 21),   # Test case 4\n        (-1.0, 9)    # Test case 5\n    ]\n\n    results = []\n    for m, N in test_cases:\n        # Calculate properties for the base mesh size N\n        C_N, s_x_N, s_y_N = compute_properties(m, N)\n\n        # Calculate Chern number for the refined mesh size 2N for the error estimate\n        C_2N, _, _ = compute_properties(m, 2 * N)\n\n        # E_mesh: Finite-mesh discretization error estimate\n        E_mesh = np.abs(C_N - C_2N)\n\n        # E_ortho: Mode orthogonality stability metric for the base mesh N\n        # This is the arithmetic mean of (1 - s) over all links\n        num_links = 2 * N * N\n        total_deviation = np.sum(1 - s_x_N) + np.sum(1 - s_y_N)\n        E_ortho = total_deviation / num_links\n\n        # Append results for the current test case\n        # C_N is reported, not rounded, as per instructions.\n        results.append([C_N, E_mesh, E_ortho])\n\n    # Final print statement in the exact required format.\n    # map(str, results) converts each inner list to its string representation.\n    # e.g., [1.0, 0.1, 0.01] -> '[1.0, 0.1, 0.01]'\n    # ','.join(...) joins these strings with commas.\n    # f\"[{...}]\" wraps the entire thing in the outermost brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond integrating local curvature, the topological character of a band can also be understood through global properties related to parallel transport. The Wilson loop operator captures the geometric phase acquired by Bloch states when transported along a non-contractible loop in the Brillouin zone. This exercise  guides you through the computation of Wilson loops and demonstrates how the winding of their eigenvalues—the Wannier centers—provides an alternative and powerful method for determining the Chern number. Completing this practice will deepen your geometric intuition and introduce the concept of Wannier center flow, a crucial tool for analyzing topological polarization.",
            "id": "4147659",
            "problem": "Consider a two-dimensional periodic acoustic metamaterial modeled as a lattice with linear, lossless, small-amplitude dynamics. The linearized acoustic wave equation in a periodic medium yields a Bloch eigenproblem for a Hermitian operator that is periodic in the crystal momentum. In computational acoustics, an effective Hermitian Bloch operator $H(\\mathbf{k})$ acts on Bloch modes $u_n(\\mathbf{k})$ and produces band frequencies (or energies in an effective description). For a fixed band subspace indexed by a set $\\mathcal{S}$ of band labels, the non-Abelian Berry connection along the $k_x$ direction is defined by\n$$\n\\mathcal{A}_x^{mn}(\\mathbf{k}) = i \\langle u_m(\\mathbf{k}) \\mid \\partial_{k_x} u_n(\\mathbf{k}) \\rangle,\\quad m,n \\in \\mathcal{S}.\n$$\nThe Wilson loop along $k_x$ at fixed $k_y$ is the path-ordered exponential\n$$\nW(k_y) = \\mathcal{P} \\exp\\left(i \\int_{0}^{2\\pi} \\mathcal{A}_x(\\mathbf{k}) \\, dk_x \\right),\n$$\nwhose eigenvalues can be written as $e^{i \\theta_a(k_y)}$, where the phases $ \\theta_a(k_y)$ are the Wannier center angles. The net winding of the sum of these phases as $k_y$ traverses from $0$ to $2\\pi$ is a signature of nontrivial topology; specifically, the integer\n$$\n\\nu = \\frac{1}{2\\pi} \\left[ \\sum_a \\theta_a(2\\pi) - \\sum_a \\theta_a(0) \\right],\n$$\ncomputed with a continuous branch choice in $k_y$, indicates the topological character of the band subspace.\n\nYour task is to implement a complete, numerically stable Wilson loop computation for a specified band subspace and to identify the integer winding in the Wannier center flow. You must use a discrete Brillouin zone sampling and a gauge-invariant construction that is numerically robust.\n\nUse the following effective models for $H(\\mathbf{k})$ to define the test suite. All angles must be treated in radians, and all quantities are dimensionless.\n\n1. Two-band Qi–Wu–Zhang model with broken effective time-reversal symmetry:\n$$\nH_{\\mathrm{QWZ}}(\\mathbf{k};m) = \\sin(k_x)\\,\\sigma_x + \\sin(k_y)\\,\\sigma_y + \\left(m + \\cos(k_x) + \\cos(k_y)\\right)\\,\\sigma_z,\n$$\nwhere $\\sigma_x,\\sigma_y,\\sigma_z$ are Pauli matrices and $m$ is a real parameter. In this effective description, the lower-energy band is treated as the “occupied” band subspace of dimension $1$.\n\n2. Block-diagonal four-band model consisting of two independent Qi–Wu–Zhang blocks:\n$$\nH_{\\mathrm{BLOCK}}(\\mathbf{k};m_1,m_2) = H_{\\mathrm{QWZ}}(\\mathbf{k};m_1) \\oplus H_{\\mathrm{QWZ}}(\\mathbf{k};m_2),\n$$\nwhere the “occupied” band subspace is of dimension $2$ and consists of the two lowest-energy bands of the $4\\times 4$ Hermitian operator.\n\nImplement the Wilson loop $W(k_y)$ along $k_x \\in [0,2\\pi)$ for each fixed $k_y$ using a discrete sampling of $k_x$ and $k_y$, construct a numerically unitary link between neighboring $k_x$ points within the chosen occupied subspace, and compute the determinant phase\n$$\n\\phi(k_y) = \\arg\\left(\\det W(k_y)\\right).\n$$\nThen compute the integer winding number\n$$\n\\nu = \\mathrm{round}\\left(\\frac{\\phi(2\\pi) - \\phi(0)}{2\\pi}\\right),\n$$\nafter unwrapping $\\phi(k_y)$ as a continuous function of $k_y$. Report that integer for each test case.\n\nTest Suite Specification (all angles in radians, all quantities dimensionless):\n\n- Test Case $1$: Model $H_{\\mathrm{QWZ}}$, parameter $m = 0.5$, discretization $N_{k_x} = 201$, $N_{k_y} = 181$, occupied subspace dimension $1$.\n- Test Case $2$: Model $H_{\\mathrm{QWZ}}$, parameter $m = 3.0$, discretization $N_{k_x} = 201$, $N_{k_y} = 181$, occupied subspace dimension $1$.\n- Test Case $3$: Model $H_{\\mathrm{QWZ}}$, parameter $m = -0.5$, discretization $N_{k_x} = 201$, $N_{k_y} = 181$, occupied subspace dimension $1$.\n- Test Case $4$: Model $H_{\\mathrm{BLOCK}}$, parameters $m_1 = 0.5$, $m_2 = -0.5$, discretization $N_{k_x} = 181$, $N_{k_y} = 151$, occupied subspace dimension $2$.\n- Test Case $5$: Model $H_{\\mathrm{QWZ}}$, parameter $m = 0.5$, coarse discretization $N_{k_x} = 31$, $N_{k_y} = 31$, occupied subspace dimension $1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., “$[result_1,result_2,\\dots]$”), where each $result_j$ is the computed integer winding number $\\nu$ for the corresponding test case, in the order listed above. The output is unitless, and all internal computations must use angles in radians.",
            "solution": "The problem is valid as it presents a well-defined, scientifically grounded computational task in the field of topological acoustics. The models, parameters, and objectives are specified with sufficient precision to permit a unique and verifiable solution. The underlying physics, based on the Bloch-theoretic description of periodic media and concepts of topological band theory such as the Berry connection and Wilson loop, is sound. The provided Qi–Wu–Zhang (QWZ) model is a canonical example of a system exhibiting a non-trivial topological phase (a Chern insulator), for which the topological invariant is well-established.\n\nThe task is to compute the integer winding number $\\nu$, which corresponds to the Chern number of a specified occupied band subspace. This is accomplished by calculating the Wilson loop along one crystallographic direction, say $k_x$, and observing how its properties evolve as a function of the transverse crystal momentum, $k_y$.\n\nThe Wilson loop along a closed path in momentum space is a matrix that captures the geometric phase accumulated by the Bloch states. For a path along the $k_x$ direction from $k_x=0$ to $k_x=2\\pi$ at a fixed $k_y$, the Wilson loop operator is given by\n$$\nW(k_y) = \\mathcal{P} \\exp\\left(i \\int_{0}^{2\\pi} \\mathcal{A}_x(\\mathbf{k}) \\, dk_x \\right),\n$$\nwhere $\\mathcal{P}$ denotes path ordering, and $\\mathcal{A}_x$ is the non-Abelian Berry connection matrix for the chosen band subspace. Its components are $\\mathcal{A}_x^{mn}(\\mathbf{k}) = i \\langle u_m(\\mathbf{k}) \\mid \\partial_{k_x} u_n(\\mathbf{k}) \\rangle$, with $\\{|u_n(\\mathbf{k})\\rangle\\}$ being the orthonormal basis of Bloch states for the occupied subspace of dimension $D$.\n\nDirect numerical computation of $\\partial_{k_x} u_n(\\mathbf{k})$ is ill-advised due to the gauge freedom in the phase of eigenvectors returned by numerical diagonalization routines. A numerically stable and gauge-invariant method involves discretizing the integral path. The Brillouin zone is sampled at discrete points. The $k_x$ path is discretized into $N_{k_x}$ points, $k_{x,j} = j(2\\pi/N_{k_x})$ for $j = 0, 1, \\dots, N_{k_x}-1$. The integral is then approximated by a product of \"link matrices,\" $F_j$, which connect the basis of occupied states at adjacent momentum points:\n$$\n(F_j)_{mn} = \\langle u_m(\\mathbf{k}_j) \\mid u_n(\\mathbf{k}_{j+1}) \\rangle,\n$$\nwhere $\\mathbf{k}_j = (k_{x,j}, k_y)$. In matrix form, $F_j = U_j^\\dagger U_{j+1}$, where $U_j$ is the $N \\times D$ matrix whose columns are the $D$ occupied Bloch eigenvectors at $\\mathbf{k}_j$. The path-ordered product becomes a matrix product, with operators for larger $k_x$ appearing on the left:\n$$\nW(k_y) \\approx F_{N_{k_x}-1} F_{N_{k_x}-2} \\cdots F_0.\n$$\nPeriodicity of the Brillouin zone implies that the state at $k_x=2\\pi$ is equivalent to the state at $k_x=0$, so the final link matrix is $F_{N_{k_x}-1} = U_{N_{k_x}-1}^\\dagger U_0$.\n\nThe eigenvalues of the unitary matrix $W(k_y)$ are of the form $e^{i\\theta_a(k_y)}$, where the phases $\\theta_a(k_y)$ are the Wannier center locations. The sum of these phases is related to the determinant of the Wilson loop:\n$$\n\\sum_a \\theta_a(k_y) = \\arg\\left(\\det W(k_y)\\right) \\pmod{2\\pi}.\n$$\nLet $\\phi(k_y) = \\arg(\\det W(k_y))$. As $k_y$ is varied from $0$ to $2\\pi$, the centers $\\theta_a(k_y)$ may \"flow,\" and the net change in their sum, when properly unwrapped to be a continuous function of $k_y$, reveals the topological winding number:\n$$\n\\nu = \\frac{1}{2\\pi} \\left[ \\phi_{\\text{unwrapped}}(2\\pi) - \\phi_{\\text{unwrapped}}(0) \\right].\n$$\nSince $\\nu$ must be an integer, the computation is made robust by rounding the result.\n\nThe algorithmic procedure is as follows:\n1.  Discretize the $k_y$ path into $N_{k_y}$ points from $k_y=0$ to $k_y=2\\pi$ inclusive.\n2.  For each $k_y$ in this grid:\n    a. Discretize the $k_x$ path into $N_{k_x}$ points from $k_x=0$ to $k_x=2\\pi$ (exclusive of the endpoint).\n    b. For each point $(k_{x,j}, k_y)$, construct the specified Hamiltonian matrix, $H(k_{x,j}, k_y)$.\n    c. Numerically diagonalize $H$ using a Hermitian eigensolver (e.g., `numpy.linalg.eigh`).\n    d. From the sorted eigenvalues, identify the $D$ eigenvectors corresponding to the $D$ lowest-energy bands. These form the columns of the matrix $U_j$.\n    e. Compute the link matrices $F_j = U_j^\\dagger U_{j+1}$ for $j=0, \\dots, N_{k_x}-1$, enforcing periodicity via $U_{N_{k_x}} = U_0$.\n    f. Calculate the Wilson loop matrix $W(k_y) = F_{N_{k_x}-1} \\cdots F_0$.\n    g. Compute the phase of its determinant, $\\phi(k_y) = \\arg(\\det W(k_y))$.\n3.  Collect the phases $\\{\\phi(k_y)\\}$ into an array.\n4.  Apply a phase unwrapping algorithm (e.g., `numpy.unwrap`) to this array to obtain $\\phi_{\\text{unwrapped}}(k_y)$.\n5.  Calculate the winding number $\\nu = \\text{round}\\left( (\\phi_{\\text{unwrapped}}[-1] - \\phi_{\\text{unwrapped}}[0]) / (2\\pi) \\right)$.\n\nThis procedure is applied to each test case using the specified Hamiltonian models, $H_{\\mathrm{QWZ}}(\\mathbf{k};m)$ and $H_{\\mathrm{BLOCK}}(\\mathbf{k};m_1,m_2)$, and their corresponding parameters. The former is a $2 \\times 2$ model, while the latter is a $4 \\times 4$ block-diagonal model. The selection of the occupied subspace dimension $D$ (either $1$ or $2$) is followed as specified.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import block_diag\n\n# Define Pauli matrices as global constants\nSIGMA_X = np.array([[0, 1], [1, 0]], dtype=np.complex128)\nSIGMA_Y = np.array([[0, -1j], [1j, 0]], dtype=np.complex128)\nSIGMA_Z = np.array([[1, 0], [0, -1]], dtype=np.complex128)\n\ndef get_hamiltonian(kx, ky, model, params):\n    \"\"\"\n    Constructs the Hamiltonian matrix for a given model and parameters.\n    \"\"\"\n    if model == 'QWZ':\n        m = params['m']\n        h = (np.sin(kx) * SIGMA_X +\n             np.sin(ky) * SIGMA_Y +\n             (m + np.cos(kx) + np.cos(ky)) * SIGMA_Z)\n        return h\n    elif model == 'BLOCK':\n        m1, m2 = params['m1'], params['m2']\n        h1 = (np.sin(kx) * SIGMA_X +\n              np.sin(ky) * SIGMA_Y +\n              (m1 + np.cos(kx) + np.cos(ky)) * SIGMA_Z)\n        h2 = (np.sin(kx) * SIGMA_X +\n              np.sin(ky) * SIGMA_Y +\n              (m2 + np.cos(kx) + np.cos(ky)) * SIGMA_Z)\n        return block_diag(h1, h2)\n    else:\n        raise ValueError(f\"Unknown model: {model}\")\n\ndef calculate_phi_at_ky(ky, model, params, Nkx, D):\n    \"\"\"\n    Calculates the phase of the determinant of the Wilson loop for a fixed ky.\n    \"\"\"\n    kx_grid = np.linspace(0, 2 * np.pi, Nkx, endpoint=False)\n    \n    # Store matrices of occupied eigenvectors for each kx\n    U_list = []\n    for kx in kx_grid:\n        H = get_hamiltonian(kx, ky, model, params)\n        # eigh returns sorted eigenvalues and corresponding eigenvectors\n        # for Hermitian matrices.\n        evals, evecs = np.linalg.eigh(H)\n        # The first D columns correspond to the D lowest eigenvalues.\n        U = evecs[:, :D]\n        U_list.append(U)\n\n    # Calculate the Wilson loop by multiplying link matrices\n    # W = F_{N-1} * ... * F_0\n    W = np.identity(D, dtype=np.complex128)\n    for j in range(Nkx):\n        U_j = U_list[j]\n        # Use periodic boundary condition for the last link\n        U_j_plus_1 = U_list[(j + 1) % Nkx]\n        \n        # Link matrix F_j = U_j^dagger * U_{j+1}\n        F_j = U_j.T.conj() @ U_j_plus_1\n        \n        # Multiply from the left to get correct path ordering\n        W = F_j @ W\n\n    # The phase of the determinant of the Wilson loop\n    return np.angle(np.linalg.det(W))\n\ndef compute_winding_number(model, params, Nkx, Nky, D):\n    \"\"\"\n    Computes the winding number nu for a given set of parameters.\n    \"\"\"\n    # The ky path must include both 0 and 2*pi to get phi(0) and phi(2*pi)\n    ky_grid = np.linspace(0, 2 * np.pi, Nky, endpoint=True)\n    \n    phi_values = []\n    for ky in ky_grid:\n        phi = calculate_phi_at_ky(ky, model, params, Nkx, D)\n        phi_values.append(phi)\n        \n    # Unwrap the phase to handle jumps larger than pi\n    phi_unwrapped = np.unwrap(phi_values)\n    \n    # Total phase change over the ky path [0, 2*pi]\n    delta_phi = phi_unwrapped[-1] - phi_unwrapped[0]\n    \n    # The winding number is the integer number of 2*pi windings\n    winding_number = round(delta_phi / (2 * np.pi))\n    \n    return int(winding_number)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {'model': 'QWZ',   'params': {'m': 0.5}, 'Nkx': 201, 'Nky': 181, 'D': 1},\n        {'model': 'QWZ',   'params': {'m': 3.0}, 'Nkx': 201, 'Nky': 181, 'D': 1},\n        {'model': 'QWZ',   'params': {'m': -0.5}, 'Nkx': 201, 'Nky': 181, 'D': 1},\n        {'model': 'BLOCK', 'params': {'m1': 0.5, 'm2': -0.5}, 'Nkx': 181, 'Nky': 151, 'D': 2},\n        {'model': 'QWZ',   'params': {'m': 0.5}, 'Nkx': 31, 'Nky': 31, 'D': 1},\n    ]\n\n    results = []\n    for case in test_cases:\n        nu = compute_winding_number(\n            model=case['model'],\n            params=case['params'],\n            Nkx=case['Nkx'],\n            Nky=case['Nky'],\n            D=case['D']\n        )\n        results.append(nu)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Topological acoustics extends into the fascinating realm of non-Hermitian systems, where energy is not conserved due to intrinsic material loss or gain. These systems host unique topological phenomena, such as the non-Hermitian skin effect, where an extensive number of states become exponentially localized at the boundaries. This dramatic effect is governed by a distinct bulk topological invariant known as the point-gap winding number. This practice  provides a hands-on opportunity to explore this exotic bulk-boundary correspondence by first computing the winding number for a periodic system and then directly observing the predicted pile-up of \"skin\" modes in the corresponding finite-sized, open-boundary system.",
            "id": "4147680",
            "problem": "Consider a one-dimensional non-reciprocal tight-binding model that arises as an effective description of a strip of a two-dimensional acoustic lattice with open boundaries along the $x$-direction and periodicity along the $y$-direction. The lattice is modeled as a set of acoustic resonators coupled by ducts whose geometry is engineered to yield asymmetric coupling strengths in the $x$-direction due to viscous losses and flow bias, producing a non-Hermitian operator. For each fixed transverse Bloch wave number $k_y$ in the Brillouin Zone (BZ), the effective one-dimensional Bloch operator along $x$ is a scalar band with complex-valued dispersion given by $E(k_x,k_y)$, where $k_x$ is the longitudinal Bloch wave number. The asymmetric nearest-neighbor couplings are denoted by $t_R(k_y)$ to the right and $t_L(k_y)$ to the left, and the on-site term $m(k_y)$ accounts for detuning caused by transverse coupling and local losses. Assume $t_R(k_y)$, $t_L(k_y)$, and $m(k_y)$ are real-valued functions of $k_y$ and independent of $k_x$. For the purposes of computation, use the parametrization $t_R(k_y) = t_R$, $t_L(k_y) = t_L$, and $m(k_y) = m_0 + M \\cos(k_y)$ with constants $t_R$, $t_L$, $m_0$, and $M$.\n\nStarting from the linearized acoustic wave equation and its finite-difference discretization, the effective non-Hermitian tight-binding description is valid when the resonators are weakly coupled and the wavelength is large compared to the duct lengths, so that the dynamics reduces to a nearest-neighbor model in the strip geometry. The complex band $E(k_x,k_y)$ traces a closed curve in the complex plane as $k_x$ runs over the Brillouin Zone for each fixed $k_y$. Consider a fixed complex basepoint $E_0$ which is not an eigenvalue of the operator under periodic boundary conditions. A Non-Hermitian Point-Gap (NHPG) exists at $E_0$ for a given $k_y$ if the complex energy curve $E(k_x,k_y)$ does not pass through $E_0$. The point-gap winding number at $E_0$ for that $k_y$ is the integer counting the net number of times the closed curve winds around the basepoint $E_0$ in the counterclockwise sense. The presence of a nonzero winding number is predicted to correlate with chiral edge localization under Open Boundary Conditions (OBC) along $x$, in the sense that eigenstates near $E_0$ become exponentially localized at one boundary (left or right) depending on the directionality of the non-reciprocal coupling.\n\nTask: For the specified class of models, write a complete program that:\n- Computes, for each $k_y$ in a provided test set, the point-gap winding number at a chosen basepoint $E_0$ by tracking the net change in the complex argument of $E(k_x,k_y)-E_0$ as $k_x$ traverses the Brillouin Zone.\n- Builds the finite OBC Hamiltonian along $x$ for each $k_y$ as an $N_x \\times N_x$ tridiagonal matrix with diagonal entries $m(k_y)$, upper diagonal entries $t_R$, and lower diagonal entries $t_L$, computes its spectrum and eigenvectors, and detects whether there exist eigenstates whose eigenvalues lie within an $E_0$-centered neighborhood in the complex plane and whose probability density is exponentially localized near the left or the right boundary. Use the following quantitative detection criteria for a given $k_y$:\n    1. Select the $K$ eigenpairs with eigenvalues closest in complex distance to $E_0$, where the complex distance is the magnitude of $E - E_0$.\n    2. An eigenstate is considered \"near the basepoint\" if its complex distance is less than a threshold $\\varepsilon$.\n    3. An eigenstate is considered \"left-localized\" if its probability center of mass along $x$ (computed from the normalized squared magnitude of the eigenvector components) is less than a fraction $\\alpha$ of the chain length $N_x$. It is considered \"right-localized\" if the center of mass exceeds $(1-\\alpha) N_x$.\n    4. Report the presence of at least one left-localized near-basepoint eigenstate and the presence of at least one right-localized near-basepoint eigenstate as booleans for each test case, aggregated across the provided $k_y$ values.\n\nYour program must implement the following mathematical objects and operations:\n- Treat $k_x$ as a continuous variable sampled on a uniform grid in $[0,2\\pi]$ and $k_y$ as a set of specified discrete samples. The modeled Bloch band must be evaluated as\n$$\nE(k_x,k_y) = m(k_y) + t_R e^{i k_x} + t_L e^{-i k_x},\n$$\nwhere $m(k_y) = m_0 + M \\cos(k_y)$, $t_R>0$, and $t_L>0$ are chosen per test case.\n- Compute the winding number by numerically evaluating the net change in the complex argument of $E(k_x,k_y)-E_0$ as $k_x$ increments over the Brillouin Zone and normalizing by $2\\pi$ to obtain an integer.\n- Under OBC, construct the $N_x \\times N_x$ matrix\n$$\nH_{ij}(k_y) = m(k_y)\\,\\delta_{ij} + t_R\\,\\delta_{i,j-1} + t_L\\,\\delta_{i,j+1},\n$$\nwith $i,j \\in \\{1,\\dots,N_x\\}$, where $\\delta_{ij}$ is the Kronecker delta, and analyze its eigenpairs to detect edge-localized near-basepoint states per the quantitative criteria stated.\n\nTest suite and output specification:\n- Use $E_0 = 0$ (dimensionless units), angle in radians, and the following fixed detection parameters for all test cases: $N_x = 80$, $K = 5$, $\\varepsilon = 0.05$, and $\\alpha = 0.2$.\n- Use a uniform grid of $N_k = 4096$ samples for $k_x \\in [0,2\\pi]$.\n- For each test case, use the $k_y$ set $\\{0,\\pi/3,\\pi\\}$.\n- Test cases:\n    1. $(t_R,t_L,m_0,M) = (1.2,0.8,0.0,0.2)$.\n    2. $(t_R,t_L,m_0,M) = (0.7,1.3,0.0,0.2)$.\n    3. $(t_R,t_L,m_0,M) = (0.6,0.5,1.5,0.3)$.\n    4. $(t_R,t_L,m_0,M) = (0.8,0.7,1.4,0.2)$.\n    5. $(t_R,t_L,m_0,M) = (1.0,1.0,0.0,0.2)$.\n- For each test case, compute:\n    - The integer count of $k_y$ values in the set $\\{0,\\pi/3,\\pi\\}$ for which the winding number at $E_0$ is nonzero.\n    - A boolean indicating whether there exists at least one left-localized near-basepoint eigenstate under OBC among those three $k_y$ values.\n    - A boolean indicating whether there exists at least one right-localized near-basepoint eigenstate under OBC among those three $k_y$ values.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the form $[w\\_count,\\text{left},\\text{right}]$. For example, the output must look like: $[[w\\_count\\_1,\\text{left\\_1},\\text{right\\_1}],[w\\_count\\_2,\\text{left\\_2},\\text{right\\_2}],\\dots]$.\n\nNo external inputs are permitted. All quantities are dimensionless and require no physical units in the final answers. Angles are in radians. Ensure scientific realism by keeping $t_R>0$ and $t_L>0$. The program must be complete and runnable.",
            "solution": "The problem requires analyzing a one-dimensional non-Hermitian tight-binding model to verify its bulk-boundary correspondence. This involves two main tasks: calculating a bulk topological invariant (the point-gap winding number) for the system with periodic boundary conditions (PBC), and identifying the predicted boundary-localized states (the non-Hermitian skin effect) in the system with open boundary conditions (OBC).\n\nThe bulk system for a fixed transverse wave number $k_y$ is described by a complex energy dispersion $E(k_x, k_y) = m(k_y) + t_R e^{i k_x} + t_L e^{-i k_x}$. As the longitudinal wave number $k_x$ traverses the Brillouin zone, this function traces an elliptical path in the complex plane. The winding number $w$ around a basepoint $E_0$ is the integer number of times this path encircles $E_0$. It is calculated numerically by evaluating the total change in the complex argument of $E(k_x, k_y) - E_0$ along the path and dividing by $2\\pi$.\n\nThe OBC system is modeled by an $N_x \\times N_x$ non-Hermitian tridiagonal matrix. According to the non-Hermitian bulk-boundary correspondence, a non-zero winding number in the bulk ($w \\neq 0$) mandates that all eigenstates of the OBC system become exponentially localized at a boundary. The direction of this localization depends on the non-reciprocal hopping strengths: if $|t_R| > |t_L|$, states localize at the left boundary, and if $|t_L| > |t_R|$, they localize at the right.\n\nThe solution code implements this verification. First, it computes the winding number for the given parameters. Then, it constructs the OBC matrix, computes its eigenvalues and eigenvectors, and checks for localization by calculating the center of mass for eigenstates whose energy is near the basepoint $E_0$. The results demonstrate the direct correspondence between the calculated bulk invariant and the observed boundary phenomena.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Solves the topological acoustics problem for the given test cases.\n    \"\"\"\n    # Fixed parameters from the problem statement\n    Nx = 80\n    K = 5\n    epsilon = 0.05\n    alpha = 0.2\n    Nk = 4096\n    E0 = 0.0\n    ky_set = np.array([0, np.pi / 3, np.pi])\n\n    # Test cases: (tR, tL, m0, M)\n    test_cases = [\n        (1.2, 0.8, 0.0, 0.2),\n        (0.7, 1.3, 0.0, 0.2),\n        (0.6, 0.5, 1.5, 0.3),\n        (0.8, 0.7, 1.4, 0.2),\n        (1.0, 1.0, 0.0, 0.2),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        tR, tL, m0, M = case\n        \n        w_count = 0\n        found_left_localized = False\n        found_right_localized = False\n\n        for ky in ky_set:\n            m_ky = m0 + M * np.cos(ky)\n\n            # Part 1: Winding number calculation\n            kx_grid = np.linspace(0, 2 * np.pi, Nk, endpoint=True)\n            exp_ikx = np.exp(1j * kx_grid)\n            \n            E_vals = m_ky + tR * exp_ikx + tL / exp_ikx\n            \n            winding = 0\n            if not np.allclose(tR, tL):\n                angles = np.angle(E_vals - E0)\n                unwrapped_angles = np.unwrap(angles)\n                total_phase_change = unwrapped_angles[-1] - unwrapped_angles[0]\n                winding = int(np.round(total_phase_change / (2 * np.pi)))\n            \n            if winding != 0:\n                w_count += 1\n\n            # Part 2: OBC eigenstate analysis\n            # Construct the OBC Hamiltonian matrix H\n            diag_main = np.full(Nx, m_ky, dtype=np.complex128)\n            diag_upper = np.full(Nx - 1, tR, dtype=np.complex128)\n            diag_lower = np.full(Nx - 1, tL, dtype=np.complex128)\n            \n            H_obc = np.diag(diag_main) + np.diag(diag_upper, k=1) + np.diag(diag_lower, k=-1)\n            \n            # Compute eigenvalues and right eigenvectors\n            eigenvalues, eigenvectors = eig(H_obc)\n            \n            # Find K eigenvalues closest to E0\n            distances = np.abs(eigenvalues - E0)\n            sorted_indices = np.argsort(distances)\n            \n            candidate_indices = sorted_indices[:K]\n            \n            # Check localization for near-basepoint states\n            site_indices = np.arange(1, Nx + 1)\n            left_threshold = alpha * Nx\n            right_threshold = (1 - alpha) * Nx\n\n            for i in candidate_indices:\n                if distances[i]  epsilon:\n                    eigenvector = eigenvectors[:, i]\n                    prob_density = np.abs(eigenvector)**2\n                    norm = np.sum(prob_density)\n                    if norm > 1e-9: # Avoid division by zero for null vectors\n                        prob_density_normalized = prob_density / norm\n                        \n                        com = np.sum(site_indices * prob_density_normalized)\n                        \n                        if com  left_threshold:\n                            found_left_localized = True\n                        if com > right_threshold:\n                            found_right_localized = True\n\n        all_results.append([w_count, found_left_localized, found_right_localized])\n\n    # Format the final output string as required.\n    result_strings = []\n    for res in all_results:\n        # Convert boolean to lowercase 'true'/'false' string.\n        result_strings.append(f\"[{res[0]},{str(res[1]).lower()},{str(res[2]).lower()}]\")\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}