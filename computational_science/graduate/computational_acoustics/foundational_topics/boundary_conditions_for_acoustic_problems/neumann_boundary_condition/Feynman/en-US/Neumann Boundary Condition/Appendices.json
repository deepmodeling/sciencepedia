{
    "hands_on_practices": [
        {
            "introduction": "The first step in mastering any boundary condition is to understand its physical origin and its direct consequences in a simple, ideal scenario. This practice explores the reflection of a plane wave from a perfectly rigid surface, a classic problem in acoustics. By starting from the fundamental equations of fluid motion, you will derive how the physical constraint of zero normal velocity translates directly into a Neumann boundary condition on the acoustic pressure, a cornerstone concept for 'sound-hard' boundaries. ",
            "id": "4131551",
            "problem": "A time-harmonic plane acoustic wave propagates in a homogeneous, lossless fluid of mass density $\\rho_{0}$ and sound speed $c$. The fluid occupies the half-space $z>0$, and the boundary at $z=0$ is an infinite, perfectly rigid (sound-hard) plane. Let the acoustic pressure field be described in the complex phasor convention with time dependence $\\exp(-\\mathrm{i}\\omega t)$, where $\\omega$ is the angular frequency, and define the wavenumber $k=\\omega/c$. The incident plane wave has complex pressure amplitude $P_{0}$ and propagates in the $x$-$z$ plane at an incidence angle $\\theta \\in [0,\\pi/2)$ measured from the positive $z$-axis (the outward normal of the boundary into the fluid). In the absence of sources in the fluid, the total field is the superposition of the incident and reflected fields, each satisfying the homogeneous Helmholtz equation. The rigid boundary enforces the Neumann boundary condition that the normal component of the particle velocity vanishes on $z=0$.\n\nUsing only first principles of linear acoustics, namely the linearized momentum equation (Euler equation), the linearized continuity equation, and the adiabatic constitutive relation for a lossless fluid, derive the complex pressure reflection coefficient $R_p$ defined by $p_r(x,y,0)=R_p\\,p_i(x,y,0)$ for all $(x,y)$ on the boundary, where $p_i$ and $p_r$ denote the incident and reflected pressure phasors, respectively. Express $R_p$ as a single closed-form analytic expression in terms of the given quantities. Your final answer must be a single expression. No rounding is required, and no physical units should be included in the final boxed expression.",
            "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- Fluid: Homogeneous, lossless.\n- Fluid properties: Mass density $\\rho_{0}$, sound speed $c$.\n- Domain: Half-space $z>0$.\n- Boundary: Infinite, perfectly rigid (sound-hard) plane at $z=0$.\n- Time dependence: Phasor convention with $\\exp(-\\mathrm{i}\\omega t)$.\n- Wavenumber: $k=\\omega/c$.\n- Incident wave: Time-harmonic plane wave with complex pressure amplitude $P_{0}$.\n- Propagation plane: $x$-$z$ plane.\n- Incidence angle: $\\theta \\in [0,\\pi/2)$ measured from the positive $z$-axis.\n- Total field: Superposition of incident ($p_i$) and reflected ($p_r$) fields.\n- Governing equation: Homogeneous Helmholtz equation.\n- Boundary condition: The normal component of the particle velocity vanishes on $z=0$.\n- Definition of reflection coefficient: $p_r(x,y,0)=R_p\\,p_i(x,y,0)$.\n- Task: Derive $R_p$ from first principles (linearized momentum, continuity, and constitutive relation).\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is a classic textbook case of wave reflection in acoustics. It is based on fundamental principles: the wave equation derived from Euler's and continuity equations, and the Neumann boundary condition for a rigid surface. All aspects are scientifically established.\n- **Well-Posedness**: The problem is well-posed. The geometry, medium, incident wave, and boundary conditions are all clearly defined, which is sufficient to determine a unique solution for the reflected field and thus the reflection coefficient.\n- **Objectivity**: The problem is stated in precise, objective, mathematical language.\n- **Completeness and Consistency**: The problem provides all necessary information and contains no internal contradictions. The definition of a rigid boundary is correctly linked to the Neumann condition on particle velocity.\n- **Topic Relevance**: The problem is directly concerned with the physical meaning and mathematical implementation of a *Neumann boundary condition* for a *rigid (sound-hard)* surface in the context of acoustic wave propagation, which is a central theme in *computational acoustics* and wave physics.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A solution will be derived from the specified first principles.\n\n**Derivation of the Reflection Coefficient**\n\nThe derivation begins with the fundamental equations of linear acoustics for a lossless, homogeneous, and quiescent fluid. Let $p(\\mathbf{r}, t)$ be the acoustic pressure, $\\mathbf{v}(\\mathbf{r}, t)$ be the particle velocity, and $\\rho(\\mathbf{r}, t)$ be the acoustic density fluctuation.\n\n1.  **First Principles and Velocity-Pressure Relation:**\n    The problem asks to start from the linearized momentum equation (Euler's equation) and continuity equation.\n    - Linearized momentum equation: $\\rho_{0} \\frac{\\partial \\mathbf{v}}{\\partial t} = -\\nabla p$.\n    - Linearized continuity equation: $\\frac{\\partial \\rho}{\\partial t} + \\rho_{0} \\nabla \\cdot \\mathbf{v} = 0$.\n    - Adiabatic constitutive relation: $p = c^{2}\\rho$.\n\n    For time-harmonic fields with time dependence $\\exp(-\\mathrm{i}\\omega t)$, the time derivative operator $\\frac{\\partial}{\\partial t}$ is replaced by a multiplication by $-\\mathrm{i}\\omega$. Applying this to the momentum equation for the complex phasors $p(\\mathbf{r})$ and $\\mathbf{v}(\\mathbf{r})$:\n    $$\n    \\rho_{0} (-\\mathrm{i}\\omega) \\mathbf{v} = -\\nabla p\n    $$\n    This provides the crucial relationship between the particle velocity phasor and the pressure phasor:\n    $$\n    \\mathbf{v} = \\frac{1}{\\mathrm{i}\\omega\\rho_{0}} \\nabla p\n    $$\n    The normal component of the velocity at the boundary $z=0$ is the $z$-component, $v_z$. The boundary condition is $v_z(x,y,0) = 0$. Using the relation above, this becomes:\n    $$\n    v_z = \\hat{\\mathbf{z}} \\cdot \\mathbf{v} = \\frac{1}{\\mathrm{i}\\omega\\rho_{0}} \\frac{\\partial p}{\\partial z}\n    $$\n    Therefore, the boundary condition $v_z(x,y,0) = 0$ is equivalent to the Neumann boundary condition on the pressure field:\n    $$\n    \\frac{\\partial p}{\\partial z} \\bigg|_{z=0} = 0\n    $$\n\n2.  **Incident and Reflected Waves:**\n    The incident plane wave propagates in the $x$-$z$ plane at an angle $\\theta$ with respect to the $+z$-axis. The incident wave vector, $\\mathbf{k}_i$, must have a negative $z$-component to represent propagation towards the boundary at $z=0$. The components of $\\mathbf{k}_i$ are:\n    $$\n    k_{ix} = k \\sin\\theta, \\quad k_{iy} = 0, \\quad k_{iz} = -k \\cos\\theta\n    $$\n    The incident pressure phasor $p_i$ is given by:\n    $$\n    p_i(x,z) = P_0 \\exp(\\mathrm{i}\\mathbf{k}_i \\cdot \\mathbf{r}) = P_0 \\exp(\\mathrm{i}(k \\sin\\theta \\, x - k \\cos\\theta \\, z))\n    $$\n    For the reflected wave, Snell's law dictates that the tangential component of the wave vector is conserved: $k_{rx} = k_{ix} = k \\sin\\theta$. The reflected wave must propagate away from the boundary into the $z>0$ region, so its $z$-component of the wave vector, $k_{rz}$, must be positive. Since the wave still propagates in the same medium, its wavenumber magnitude is conserved, $|\\mathbf{k}_r| = k$. This gives $k_{rz} = \\sqrt{k^2 - k_{rx}^2} = \\sqrt{k^2 - k^2\\sin^2\\theta} = k\\cos\\theta$. The reflected wave vector is:\n    $$\n    \\mathbf{k}_r = (k \\sin\\theta, 0, k \\cos\\theta)\n    $$\n    The reflected pressure phasor $p_r$ can be written in terms of the reflection coefficient $R_p$. The problem defines $R_p$ such that $p_r(x,y,0) = R_p p_i(x,y,0)$. At $z=0$, we have $p_i(x,0) = P_0 \\exp(\\mathrm{i}k\\sin\\theta\\,x)$ and $p_r(x,0) = P_r\\exp(\\mathrm{i}k\\sin\\theta\\,x)$, where $P_r$ is the complex amplitude of the reflected wave. The definition implies $P_r = R_p P_0$. Thus, the reflected wave is:\n    $$\n    p_r(x,z) = R_p P_0 \\exp(\\mathrm{i}\\mathbf{k}_r \\cdot \\mathbf{r}) = R_p P_0 \\exp(\\mathrm{i}(k \\sin\\theta \\, x + k \\cos\\theta \\, z))\n    $$\n\n3.  **Total Field and Boundary Condition Application:**\n    The total pressure field $p$ is the superposition of the incident and reflected fields:\n    $$\n    p(x,z) = p_i(x,z) + p_r(x,z) = P_0 \\left[ \\exp(\\mathrm{i}(k \\sin\\theta \\, x - k \\cos\\theta \\, z)) + R_p \\exp(\\mathrm{i}(k \\sin\\theta \\, x + k \\cos\\theta \\, z)) \\right]\n    $$\n    We can factor out the common spatial dependence on $x$:\n    $$\n    p(x,z) = P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) \\left[ \\exp(-\\mathrm{i}k \\cos\\theta \\, z) + R_p \\exp(\\mathrm{i}k \\cos\\theta \\, z) \\right]\n    $$\n    Now, apply the Neumann boundary condition $\\frac{\\partial p}{\\partial z}|_{z=0}=0$. First, compute the partial derivative of $p$ with respect to $z$:\n    $$\n    \\frac{\\partial p}{\\partial z} = P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) \\frac{\\partial}{\\partial z} \\left[ \\exp(-\\mathrm{i}k \\cos\\theta \\, z) + R_p \\exp(\\mathrm{i}k \\cos\\theta \\, z) \\right]\n    $$\n    $$\n    \\frac{\\partial p}{\\partial z} = P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) \\left[ (-\\mathrm{i}k \\cos\\theta) \\exp(-\\mathrm{i}k \\cos\\theta \\, z) + R_p (\\mathrm{i}k \\cos\\theta) \\exp(\\mathrm{i}k \\cos\\theta \\, z) \\right]\n    $$\n    Next, evaluate this derivative at the boundary $z=0$:\n    $$\n    \\frac{\\partial p}{\\partial z} \\bigg|_{z=0} = P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) \\left[ (-\\mathrm{i}k \\cos\\theta) \\exp(0) + R_p (\\mathrm{i}k \\cos\\theta) \\exp(0) \\right]\n    $$\n    $$\n    \\frac{\\partial p}{\\partial z} \\bigg|_{z=0} = P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) (-\\mathrm{i}k \\cos\\theta) (1 - R_p)\n    $$\n    Setting this expression to zero to satisfy the boundary condition:\n    $$\n    P_0 \\exp(\\mathrm{i}k \\sin\\theta \\, x) (-\\mathrm{i}k \\cos\\theta) (1 - R_p) = 0\n    $$\n    This equation must hold for all $x$. Since the amplitude $P_0$ is non-zero, $k$ is non-zero, and the angle of incidence $\\theta$ is in the range $[0, \\pi/2)$, which means $\\cos\\theta > 0$, the term $(1 - R_p)$ must be zero.\n    $$\n    1 - R_p = 0\n    $$\n\n4.  **Conclusion:**\n    Solving for the reflection coefficient $R_p$, we find:\n    $$\n    R_p = 1\n    $$\n    This result indicates that for a perfectly rigid (sound-hard) boundary, the reflected pressure wave has the same amplitude and phase as the incident pressure wave at the boundary. This leads to a doubling of acoustic pressure at the surface, a well-known phenomenon.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "Analytical solutions are powerful, but most real-world problems require numerical methods. This exercise provides the crucial bridge between the continuous partial differential equation and its numerical counterpart used in the Finite Element Method (FEM). You will derive the 'weak form' of the acoustic wave equation and discover why the Neumann condition arises as a 'natural' boundary condition, a term with a specific and important meaning in variational methods. ",
            "id": "4131580",
            "problem": "Consider time-harmonic acoustics in a homogeneous, inviscid fluid of constant mass density $\\rho_0$ and sound speed $c$, with temporal dependence $\\exp(-\\mathrm{i}\\omega t)$. The acoustic particle velocity is denoted by $\\mathbf{u}(\\mathbf{x})$ and the acoustic pressure by $p(\\mathbf{x})$. The governing linearized equations are the frequency-domain continuity equation and the frequency-domain momentum balance. A perfectly rigid (sound-hard) wall imposes zero normal particle velocity on the boundary. \n\nTask 1 (derivation): Starting from these fundamental laws and definitions, derive the governing scalar Partial Differential Equation (PDE) for the acoustic pressure, and then obtain its weak (variational) form by testing with an arbitrary function $q \\in H^1(\\Omega)$, where $H^1(\\Omega)$ is the Sobolev space of square-integrable functions with square-integrable first derivatives on the domain $\\Omega$. Clearly identify the boundary term that appears from integration by parts and explain why it is called a natural boundary condition in the context of the Finite Element (FE) method. Relate the rigid-wall condition to this natural boundary term.\n\nTask 2 (evaluation): To concretize the weak form, consider a non-dimensional square domain $\\Omega = (0,1)\\times(0,1)$ with outward unit normal $\\mathbf{n}$ on its boundary $\\Gamma$, and impose a rigid-wall (sound-hard) boundary everywhere on $\\Gamma$. Let the non-dimensional wavenumber be $\\kappa = \\pi$. Using the weak form you derived, evaluate the bilinear form\n$$\na(p,q) \\;=\\; \\int_{\\Omega} \\nabla p \\cdot \\nabla q \\,\\mathrm{d}\\Omega \\;-\\; \\kappa^{2} \\int_{\\Omega} p\\,q \\,\\mathrm{d}\\Omega\n$$\nfor the choice $p(x,y) = x(1-y)$ and $q(x,y) = x(1-y)$. You must treat the boundary contribution associated with the natural boundary condition carefully in light of the rigid-wall assumption. Express your final result as a single closed-form analytic expression. No units are required. Do not round; provide the exact expression.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded, self-contained, and well-posed. It constitutes a standard exercise in the derivation and application of the weak form for the acoustic Helmholtz equation.\n\n**Task 1: Derivation and Explanation**\n\nThe fundamental governing laws for time-harmonic acoustics in a homogeneous, inviscid fluid are the frequency-domain continuity and momentum equations. We begin by stating the linearized time-domain equations. Let $p'(\\mathbf{x}, t)$ be the acoustic pressure perturbation, $\\mathbf{u}'(\\mathbf{x}, t)$ the particle velocity, and $\\rho'(\\mathbf{x}, t)$ the density perturbation. The constant ambient density is $\\rho_0$ and the speed of sound is $c$.\n\nThe continuity equation (conservation of mass) is:\n$$\n\\frac{\\partial \\rho'}{\\partial t} + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0\n$$\nThe momentum balance (linearized Euler's equation) is:\n$$\n\\rho_0 \\frac{\\partial \\mathbf{u}'}{\\partial t} = -\\nabla p'\n$$\nFor an adiabatic process, the pressure and density perturbations are related through the speed of sound: $p' = c^2 \\rho'$. Substituting $\\rho' = p'/c^2$ into the continuity equation gives:\n$$\n\\frac{1}{c^2} \\frac{\\partial p'}{\\partial t} + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0\n$$\nWe assume a time-harmonic dependence of the form $\\exp(-\\mathrm{i}\\omega t)$, where $\\omega$ is the angular frequency and $\\mathrm{i}$ is the imaginary unit. The fields can thus be written as $p'(\\mathbf{x}, t) = p(\\mathbf{x})\\exp(-\\mathrm{i}\\omega t)$ and $\\mathbf{u}'(\\mathbf{x}, t) = \\mathbf{u}(\\mathbf{x})\\exp(-\\mathrm{i}\\omega t)$, where $p(\\mathbf{x})$ and $\\mathbf{u}(\\mathbf{x})$ are complex-valued spatial amplitudes. The time derivative $\\frac{\\partial}{\\partial t}$ is replaced by a multiplication with $-\\mathrm{i}\\omega$. Applying this to the two governing equations yields their frequency-domain counterparts:\n\n1.  Continuity equation:\n    $$\n    -\\frac{\\mathrm{i}\\omega}{c^2} p + \\rho_0 \\nabla \\cdot \\mathbf{u} = 0 \\quad \\implies \\quad \\nabla \\cdot \\mathbf{u} = \\frac{\\mathrm{i}\\omega}{\\rho_0 c^2} p\n    $$\n2.  Momentum equation:\n    $$\n    -\\mathrm{i}\\omega \\rho_0 \\mathbf{u} = -\\nabla p \\quad \\implies \\quad \\mathbf{u} = \\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla p\n    $$\n\nTo derive a single scalar PDE for the acoustic pressure $p$, we take the divergence of the momentum equation:\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot \\left(\\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla p\\right) = \\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla^2 p\n$$\nWe then eliminate $\\nabla \\cdot \\mathbf{u}$ by equating this result with the expression from the continuity equation:\n$$\n\\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla^2 p = \\frac{\\mathrm{i}\\omega}{\\rho_0 c^2} p\n$$\nMultiplying by $\\mathrm{i}\\omega \\rho_0$ and rearranging the terms gives:\n$$\n\\nabla^2 p = \\frac{(\\mathrm{i}\\omega)^2}{c^2} p = -\\frac{\\omega^2}{c^2} p\n$$\nThis leads to the standard Helmholtz equation for acoustic pressure:\n$$\n\\nabla^2 p + k^2 p = 0\n$$\nwhere $k = \\omega/c$ is the acoustic wavenumber. This is the governing scalar PDE for the acoustic pressure amplitude $p(\\mathbf{x})$.\n\nTo obtain the weak (variational) form, we multiply the Helmholtz equation by an arbitrary test function $q \\in H^1(\\Omega)$ and integrate over the domain $\\Omega$:\n$$\n\\int_{\\Omega} (\\nabla^2 p + k^2 p) q \\, \\mathrm{d}\\Omega = 0\n$$\nSeparating the terms, we have:\n$$\n\\int_{\\Omega} (\\nabla \\cdot (\\nabla p)) q \\, \\mathrm{d}\\Omega + \\int_{\\Omega} k^2 p q \\, \\mathrm{d}\\Omega = 0\n$$\nWe apply integration by parts to the first term, using Green's first identity: $\\int_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\phi \\, \\mathrm{d}\\Omega = \\int_{\\Gamma} \\phi (\\mathbf{F} \\cdot \\mathbf{n}) \\, \\mathrm{d}\\Gamma - \\int_{\\Omega} \\mathbf{F} \\cdot \\nabla \\phi \\, \\mathrm{d}\\Omega$. Here, we set $\\mathbf{F} = \\nabla p$ and $\\phi = q$. The term $\\nabla p \\cdot \\mathbf{n}$ is the normal derivative $\\frac{\\partial p}{\\partial n}$.\n$$\n\\int_{\\Omega} (\\nabla \\cdot (\\nabla p)) q \\, \\mathrm{d}\\Omega = \\int_{\\Gamma} q (\\nabla p \\cdot \\mathbf{n}) \\, \\mathrm{d}\\Gamma - \\int_{\\Omega} \\nabla p \\cdot \\nabla q \\, \\mathrm{d}\\Omega\n$$\nSubstituting this back into the integrated equation gives:\n$$\n-\\int_{\\Omega} \\nabla p \\cdot \\nabla q \\, \\mathrm{d}\\Omega + \\int_{\\Omega} k^2 p q \\, \\mathrm{d}\\Omega + \\int_{\\Gamma} q \\frac{\\partial p}{\\partial n} \\, \\mathrm{d}\\Gamma = 0\n$$\nRearranging to the standard weak form, we seek $p \\in H^1(\\Omega)$ such that for all $q \\in H^1(\\Omega)$:\n$$\n\\int_{\\Omega} \\nabla p \\cdot \\nabla q \\, \\mathrm{d}\\Omega - k^2 \\int_{\\Omega} p q \\, \\mathrm{d}\\Omega = \\int_{\\Gamma} q \\frac{\\partial p}{\\partial n} \\, \\mathrm{d}\\Gamma\n$$\nThe boundary term is the integral on the right-hand side, $\\int_{\\Gamma} q \\frac{\\partial p}{\\partial n} \\, \\mathrm{d}\\Gamma$. This type of boundary condition, which involves derivatives of the solution variable (like $\\frac{\\partial p}{\\partial n}$), is termed a **natural boundary condition** in the context of the Finite Element (FE) method. This is because it arises \"naturally\" from the variational formulation through integration by parts. It is imposed by specifying the value of the boundary integral, rather than by explicitly constraining the space of permissible solutions. For example, if we specify $\\frac{\\partial p}{\\partial n} = g$ on the boundary, the right-hand side becomes $\\int_{\\Gamma} q g \\, \\mathrm{d}\\Gamma$. If we do not specify anything, the term is implicitly set to zero, which naturally enforces $\\frac{\\partial p}{\\partial n} = 0$.\n\nNow, we relate the physical rigid-wall condition to this natural boundary term. A perfectly rigid (sound-hard) wall implies that the normal component of the particle velocity is zero on the boundary $\\Gamma$:\n$$\n\\mathbf{u} \\cdot \\mathbf{n} = 0 \\quad \\text{on } \\Gamma\n$$\nUsing the frequency-domain momentum equation, $\\mathbf{u} = \\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla p$, we substitute this into the boundary condition:\n$$\n\\left(\\frac{1}{\\mathrm{i}\\omega \\rho_0} \\nabla p\\right) \\cdot \\mathbf{n} = 0\n$$\nSince $\\mathrm{i}$, $\\omega$, and $\\rho_0$ are non-zero constants, this directly implies:\n$$\n\\nabla p \\cdot \\mathbf{n} = 0 \\quad \\text{or} \\quad \\frac{\\partial p}{\\partial n} = 0\n$$\nThis is a homogeneous Neumann boundary condition for the pressure $p$. Substituting this condition into the boundary term of the weak form causes the integral to vanish:\n$$\n\\int_{\\Gamma} q \\frac{\\partial p}{\\partial n} \\, \\mathrm{d}\\Gamma = \\int_{\\Gamma} q (0) \\, \\mathrm{d}\\Gamma = 0\n$$\nThus, for a domain enclosed by rigid walls, the weak form simplifies to finding $p \\in H^1(\\Omega)$ such that for all $q \\in H^1(\\Omega)$:\n$$\n\\int_{\\Omega} \\nabla p \\cdot \\nabla q \\, \\mathrm{d}\\Omega - k^2 \\int_{\\Omega} p q \\, \\mathrm{d}\\Omega = 0\n$$\n\n**Task 2: Evaluation**\n\nWe are asked to evaluate the bilinear form $a(p,q)$ for a specific case:\n$$\na(p,q) = \\int_{\\Omega} \\nabla p \\cdot \\nabla q \\,\\mathrm{d}\\Omega - \\kappa^{2} \\int_{\\Omega} p\\,q \\,\\mathrm{d}\\Omega\n$$\nThe problem specifies a non-dimensional formulation where the wavenumber is denoted by $\\kappa$. The domain is the unit square $\\Omega = (0,1)\\times(0,1)$, the wavenumber is $\\kappa = \\pi$, and the functions are $p(x,y) = x(1-y)$ and $q(x,y) = x(1-y)$. The boundary condition on $\\Gamma$ is rigid-wall, which justifies the structure of the bilinear form $a(p,q)$ as derived above (i.e., with no boundary integral term).\n\nFirst, we compute the necessary components for the integrands.\nSince $p(x,y) = q(x,y) = x(1-y) = x - xy$, the gradients are identical:\n$$\n\\nabla p = \\nabla q = \\begin{pmatrix} \\frac{\\partial}{\\partial x}(x-xy) \\\\ \\frac{\\partial}{\\partial y}(x-xy) \\end{pmatrix} = \\begin{pmatrix} 1-y \\\\ -x \\end{pmatrix}\n$$\nThe dot product of the gradients is:\n$$\n\\nabla p \\cdot \\nabla q = (1-y)(1-y) + (-x)(-x) = (1-y)^2 + x^2 = 1 - 2y + y^2 + x^2\n$$\nThe product of the functions is:\n$$\np(x,y)q(x,y) = (x(1-y))^2 = x^2 (1-y)^2 = x^2(1 - 2y + y^2)\n$$\n\nNext, we evaluate the two integrals over the domain $\\Omega$.\nThe first integral is:\n$$\n\\int_{\\Omega} \\nabla p \\cdot \\nabla q \\,\\mathrm{d}\\Omega = \\int_0^1 \\int_0^1 (1 - 2y + y^2 + x^2) \\,\\mathrm{d}x\\,\\mathrm{d}y\n$$\nIntegrating with respect to $x$ first:\n$$\n\\int_0^1 (1 - 2y + y^2 + x^2) \\,\\mathrm{d}x = \\left[ (1 - 2y + y^2)x + \\frac{x^3}{3} \\right]_0^1 = (1 - 2y + y^2)(1) + \\frac{1^3}{3} - 0 = \\frac{4}{3} - 2y + y^2\n$$\nNow, integrating with respect to $y$:\n$$\n\\int_0^1 \\left(\\frac{4}{3} - 2y + y^2\\right) \\,\\mathrm{d}y = \\left[ \\frac{4}{3}y - y^2 + \\frac{y^3}{3} \\right]_0^1 = \\left(\\frac{4}{3} - 1 + \\frac{1}{3}\\right) - 0 = \\frac{5}{3} - 1 = \\frac{2}{3}\n$$\n\nThe second integral is:\n$$\n\\int_{\\Omega} p\\,q \\,\\mathrm{d}\\Omega = \\int_0^1 \\int_0^1 x^2(1 - 2y + y^2) \\,\\mathrm{d}x\\,\\mathrm{d}y\n$$\nThis integral is separable:\n$$\n\\int_0^1 \\int_0^1 x^2(1-y)^2 \\,\\mathrm{d}x\\,\\mathrm{d}y = \\left( \\int_0^1 x^2 \\,\\mathrm{d}x \\right) \\left( \\int_0^1 (1-y)^2 \\,\\mathrm{d}y \\right)\n$$\nThe first factor is:\n$$\n\\int_0^1 x^2 \\,\\mathrm{d}x = \\left[ \\frac{x^3}{3} \\right]_0^1 = \\frac{1}{3}\n$$\nThe second factor is:\n$$\n\\int_0^1 (1-y)^2 \\,\\mathrm{d}y = \\left[ -\\frac{(1-y)^3}{3} \\right]_0^1 = \\left(-\\frac{(1-1)^3}{3}\\right) - \\left(-\\frac{(1-0)^3}{3}\\right) = 0 - \\left(-\\frac{1}{3}\\right) = \\frac{1}{3}\n$$\nThus, the second integral evaluates to:\n$$\n\\int_{\\Omega} p\\,q \\,\\mathrm{d}\\Omega = \\frac{1}{3} \\times \\frac{1}{3} = \\frac{1}{9}\n$$\n\nFinally, we assemble the expression for $a(p,q)$ using $\\kappa = \\pi$, so $\\kappa^2 = \\pi^2$:\n$$\na(p,q) = \\int_{\\Omega} \\nabla p \\cdot \\nabla q \\,\\mathrm{d}\\Omega - \\kappa^{2} \\int_{\\Omega} p\\,q \\,\\mathrm{d}\\Omega = \\frac{2}{3} - \\pi^2 \\left(\\frac{1}{9}\\right)\n$$\n$$\na(p,q) = \\frac{2}{3} - \\frac{\\pi^2}{9} = \\frac{6}{9} - \\frac{\\pi^2}{9} = \\frac{6-\\pi^2}{9}\n$$\nThis is the final closed-form analytic expression.",
            "answer": "$$\n\\boxed{\\frac{6 - \\pi^2}{9}}\n$$"
        },
        {
            "introduction": "The final step in computational science is to translate theory into a working predictive tool. This practice guides you through the complete implementation of a one-dimensional Finite Element solver for the Helmholtz equation, putting the weak formulation from the previous exercise into action. You will assemble the system matrices and load vectors, and correctly impose Neumann boundary conditions, including the special case where $k=0$ which requires careful handling to ensure a unique solution. ",
            "id": "4131519",
            "problem": "Consider one-dimensional frequency-domain acoustic propagation in a straight duct of length $L$ with spatial coordinate $x \\in (0,L)$. Let the complex acoustic pressure be denoted by $p(x)$, the wavenumber by $k$ (in radians per meter), and a distributed source term by $f(x)$ (in pascals per square meter). Under the assumption of time-harmonic fields and lossless medium, a widely used reduced model for computational acoustics is the following boundary value problem:\n$$\n- \\frac{d^2 p}{dx^2} + k^2 p = f(x) \\quad \\text{for } x \\in (0,L),\n$$\nsubject to a Neumann boundary condition (rigid, sound hard) at $x=0$ and a prescribed Neumann boundary condition at $x=L$,\n$$\n\\frac{dp}{dx}(0) = 0, \\qquad \\frac{dp}{dx}(L) = g,\n$$\nwhere $g$ is the prescribed boundary flux (in pascals per meter). The Neumann boundary condition models a sound hard wall, and the boundary flux models a prescribed normal pressure gradient. The task is to formulate and implement a conforming Galerkin Finite Element Method (FEM) with piecewise linear basis functions on a uniform mesh to approximate $p(x)$.\n\nStarting from the strong form given above, derive the weak formulation by multiplying with a test function and integrating over the domain, ensuring that the Neumann boundary contributions are handled correctly as natural boundary terms. Construct the resulting symmetric positive definite bilinear form for $k \\neq 0$, and the corresponding right-hand side functional incorporating both the volumetric source $f(x)$ and the boundary flux $g$. For $k=0$, the operator reduces to the Poisson operator with pure Neumann boundary conditions, which has a nontrivial nullspace consisting of constants. In this case, ensure that your linear system is consistent by requiring the compatibility condition between $f(x)$ and $g$ and then enforce a zero-mean constraint on $p(x)$ to obtain a unique solution.\n\nImplement the finite element discretization as follows:\n- Use a uniform partition of $(0,L)$ into $N$ equal subintervals (elements), with $N+1$ nodes.\n- Use continuous, piecewise linear (hat) basis functions.\n- Assemble the global stiffness matrix and the global mass matrix corresponding to the terms $-\\frac{d^2 p}{dx^2}$ and $k^2 p$, respectively.\n- Assemble the global load vector for a constant source $f(x) = F_0$ and the boundary contribution at $x=L$ induced by $g$.\n- For the case $k=0$, augment the linear system with a single constraint enforcing $\\int_0^L p(x) \\, dx = 0$ using nodal weights corresponding to the exact integral of a piecewise linear function on a uniform mesh, so that the augmented system is nonsingular.\n\nYour program must compute, for each test case, the finite element approximation of $p(x)$ and then output the value of $p$ at the midpoint $x = L/2$ (in pascals). Angles are not involved in this problem; no angle units are required.\n\nTest Suite:\n- Case $1$ (happy path): $L = 1.0$ meters, $N = 10$, $k = 5.0$ radians per meter, $F_0 = 100.0$ pascals per square meter, $g = 0.0$ pascals per meter.\n- Case $2$ (Neumann boundary-driven response): $L = 1.0$ meters, $N = 20$, $k = 5.0$ radians per meter, $F_0 = 0.0$ pascals per square meter, $g = 100.0$ pascals per meter.\n- Case $3$ (Poisson limit with pure Neumann and zero-mean gauge): $L = 2.0$ meters, $N = 50$, $k = 0.0$ radians per meter, $F_0 = -5.0$ pascals per square meter, $g = 10.0$ pascals per meter. Note that the compatibility condition $\\int_0^L f(x)\\,dx = -g$ holds because $F_0 \\cdot L = -g$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the three cases above, in the order listed. Each entry must be the midpoint value $p(L/2)$ in pascals represented as a floating-point number. For example: \"[p_case1,p_case2,p_case3]\".",
            "solution": "The problem asks for the formulation and implementation of a one-dimensional Finite Element Method (FEM) to solve the Helmholtz equation with Neumann boundary conditions. The problem is scientifically sound, well-posed, and provides all necessary information.\n\n### 1. Derivation of the Weak Formulation\nThe strong form of the boundary value problem is given by the Helmholtz equation in the domain $x \\in (0,L)$:\n$$\n- \\frac{d^2 p}{dx^2} + k^2 p = f(x)\n$$\nwith the Neumann boundary conditions:\n$$\n\\frac{dp}{dx}(0) = 0, \\qquad \\frac{dp}{dx}(L) = g\n$$\nTo obtain the weak formulation, we multiply the partial differential equation by a suitable test function $v(x)$ (from the Sobolev space $H^1(0,L)$) and integrate over the domain $[0,L]$:\n$$\n\\int_0^L \\left( - \\frac{d^2 p}{dx^2} v(x) + k^2 p(x) v(x) \\right) \\, dx = \\int_0^L f(x) v(x) \\, dx\n$$\nThe first term is handled using integration by parts, $\\int u v' = [uv] - \\int u' v$:\n$$\n\\int_0^L \\left( - \\frac{d^2 p}{dx^2} \\right) v(x) \\, dx = - \\left[ \\frac{dp}{dx}(x) v(x) \\right]_0^L + \\int_0^L \\frac{dp}{dx}(x) \\frac{dv}{dx}(x) \\, dx\n$$\nWe evaluate the boundary term using the given Neumann conditions:\n$$\n- \\left[ \\frac{dp}{dx}(L) v(L) - \\frac{dp}{dx}(0) v(0) \\right] = - \\left[ g \\cdot v(L) - 0 \\cdot v(0) \\right] = -g v(L)\n$$\nSubstituting this result back into the integrated equation gives:\n$$\n\\int_0^L \\frac{dp}{dx} \\frac{dv}{dx} \\, dx - g v(L) + \\int_0^L k^2 p v \\, dx = \\int_0^L f v \\, dx\n$$\nRearranging so that terms involving the unknown function $p(x)$ are on the left-hand side, we arrive at the weak (or variational) formulation: Find $p \\in H^1(0,L)$ such that for all test functions $v \\in H^1(0,L)$,\n$$\n\\int_0^L \\frac{dp}{dx} \\frac{dv}{dx} \\, dx + k^2 \\int_0^L p v \\, dx = \\int_0^L f v \\, dx + g v(L)\n$$\nThis is expressed abstractly as $a(p, v) = \\ell(v)$, where $a(\\cdot, \\cdot)$ is the symmetric bilinear form and $\\ell(\\cdot)$ is the linear functional:\n$$\na(p, v) = \\int_0^L \\frac{dp}{dx} \\frac{dv}{dx} \\, dx + k^2 \\int_0^L p v \\, dx\n$$\n$$\n\\ell(v) = \\int_0^L f(x) v(x) \\, dx + g v(L)\n$$\nThe Neumann conditions are \"natural\" because they are naturally incorporated into the weak form through the integration by parts procedure.\n\n### 2. Finite Element Discretization\nWe partition the domain $[0,L]$ into $N$ uniform elements of length $h = L/N$, with $N+1$ nodes at positions $x_i = ih$ for $i=0, 1, \\dots, N$. The unknown pressure field $p(x)$ is approximated by a function $p_h(x)$ which is a linear combination of continuous, piecewise linear basis functions $\\phi_j(x)$ (also known as \"hat\" functions):\n$$\np_h(x) = \\sum_{j=0}^{N} p_j \\phi_j(x)\n$$\nHere, $p_j = p_h(x_j)$ are the unknown pressure values at the nodes, and the basis function $\\phi_j(x)$ has the property that $\\phi_j(x_i) = \\delta_{ij}$ (it is $1$ at node $j$ and $0$ at all other nodes).\n\nIn the Galerkin method, the test functions are chosen from the same set as the basis functions, i.e., $v(x) = \\phi_i(x)$ for each $i=0, 1, \\dots, N$. Inserting the approximation $p_h(x)$ and test functions into the weak formulation yields a system of $N+1$ linear algebraic equations:\n$$\n\\sum_{j=0}^{N} p_j \\left( \\int_0^L \\frac{d\\phi_j}{dx} \\frac{d\\phi_i}{dx} \\, dx + k^2 \\int_0^L \\phi_j \\phi_i \\, dx \\right) = \\int_0^L f(x) \\phi_i(x) \\, dx + g \\phi_i(L)\n$$\nThis can be written in the matrix form $(K + k^2 M) \\mathbf{p} = \\mathbf{b}$, where:\n- $\\mathbf{p} = [p_0, p_1, \\dots, p_N]^T$ is the vector of unknown nodal values.\n- $K$ is the stiffness matrix, with entries $K_{ij} = \\int_0^L \\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx} \\, dx$.\n- $M$ is the mass matrix, with entries $M_{ij} = \\int_0^L \\phi_i \\phi_j \\, dx$.\n- $\\mathbf{b}$ is the load vector, with entries $b_i = \\int_0^L f(x) \\phi_i(x) \\, dx + g \\phi_i(L)$.\n\n### 3. Matrix and Vector Assembly\nFor piecewise linear basis functions on a uniform mesh, the element stiffness ($K^e$) and mass ($M^e$) matrices for an element of length $h$ are:\n$$\nK^e = \\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}, \\quad M^e = \\frac{h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\nAssembling these for all $N$ elements results in the global $(N+1) \\times (N+1)$ tridiagonal matrices:\n$$\nK = \\frac{1}{h} \\begin{pmatrix}\n1 & -1 & & & \\\\\n-1 & 2 & -1 & & \\\\\n& \\ddots & \\ddots & \\ddots & \\\\\n& & -1 & 2 & -1 \\\\\n& & & -1 & 1\n\\end{pmatrix}, \\quad\nM = \\frac{h}{6} \\begin{pmatrix}\n2 & 1 & & & \\\\\n1 & 4 & 1 & & \\\\\n& \\ddots & \\ddots & \\ddots & \\\\\n& & 1 & 4 & 1 \\\\\n& & & 1 & 2\n\\end{pmatrix}\n$$\nThe load vector $\\mathbf{b}$ has two components. For a constant source $f(x) = F_0$, the source contribution to $b_i$ is $\\int_0^L F_0 \\phi_i(x) \\, dx$. This integral equals $F_0$ times the area under the hat function $\\phi_i(x)$, which is $h$ for internal nodes ($i=1, \\dots, N-1$) and $h/2$ for boundary nodes ($i=0, N$). The boundary flux contribution, $g \\phi_i(L)$, is non-zero only for $i=N$, where $\\phi_N(L)=1$, adding $g$ to the last component of the vector. The final load vector is:\n$$\n\\mathbf{b} = F_0 h \\begin{pmatrix} 1/2 \\\\ 1 \\\\ \\vdots \\\\ 1 \\\\ 1/2 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ g \\end{pmatrix}\n$$\n\n### 4. Special Case: $k=0$ (Poisson Problem)\nWhen $k=0$, the system reduces to $K \\mathbf{p} = \\mathbf{b}$. The stiffness matrix $K$ for pure Neumann conditions is singular, reflecting the fact that if $p(x)$ is a solution, so is $p(x) + C$ for any constant $C$. The nullspace of $K$ is the vector of all ones, $\\mathbf{1}$. A solution to $K \\mathbf{p} = \\mathbf{b}$ exists if and only if $\\mathbf{b}$ is orthogonal to the nullspace of $K^T=K$, which means $\\sum_{i=0}^N b_i = 0$. This corresponds to the compatibility condition $\\int_0^L f(x)\\,dx = -g$, which is satisfied for Case 3. To find a unique solution, we add a constraint. The problem specifies a zero-mean solution, $\\int_0^L p(x) \\, dx = 0$. Discretized for a piecewise linear function, this is $\\mathbf{w}^T \\mathbf{p} = 0$, where $\\mathbf{w} = h[1/2, 1, \\dots, 1, 1/2]^T$. We solve the augmented system using a Lagrange multiplier $\\lambda$:\n$$\n\\begin{pmatrix} K & \\mathbf{w} \\\\ \\mathbf{w}^T & 0 \\end{pmatrix}\n\\begin{pmatrix} \\mathbf{p} \\\\ \\lambda \\end{pmatrix} =\n\\begin{pmatrix} \\mathbf{b} \\\\ 0 \\end{pmatrix}\n$$\nThis $(N+2) \\times (N+2)$ system is non-singular and yields the unique zero-mean solution $\\mathbf{p}$.\n\n### 5. Calculation of Midpoint Pressure\nThe value of the pressure at $x = L/2$ is required. The location $L/2$ corresponds to $x_{N/2}$ on the mesh.\n- If $N$ is even, $L/2$ is exactly at node $N/2$. The pressure is $p(L/2) = p_{N/2}$.\n- If $N$ is odd, $L/2$ is in the middle of the element between nodes $m$ and $m+1$, where $m = \\lfloor N/2 \\rfloor$. The pressure is found by linear interpolation: $p(L/2) = (p_m + p_{m+1}) / 2$.\nAll test cases use an even $N$, simplifying this step.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_midpoint_pressure(L, N, k, F0, g):\n    \"\"\"\n    Solves the 1D Helmholtz BVP with Neumann conditions using linear FEM.\n\n    Args:\n        L (float): Length of the domain.\n        N (int): Number of elements.\n        k (float): Wavenumber.\n        F0 (float): Constant distributed source term.\n        g (float): Prescribed boundary flux at x=L.\n\n    Returns:\n        float: The computed pressure at the midpoint of the domain, p(L/2).\n    \"\"\"\n    n_nodes = N + 1\n    h = L / N\n\n    # Assemble stiffness matrix K\n    diag0_K = np.full(n_nodes, 2.0 / h)\n    diag0_K[0] = diag0_K[-1] = 1.0 / h\n    diag1_K = np.full(n_nodes - 1, -1.0 / h)\n    K = np.diag(diag0_K) + np.diag(diag1_K, k=1) + np.diag(diag1_K, k=-1)\n\n    # Assemble load vector b\n    b = np.full(n_nodes, F0 * h)\n    b[0] = b[-1] = F0 * h / 2.0\n    b[-1] += g\n\n    if k != 0.0:\n        # Assemble mass matrix M\n        diag0_M = np.full(n_nodes, 4.0 * h / 6.0)\n        diag0_M[0] = diag0_M[-1] = 2.0 * h / 6.0\n        diag1_M = np.full(n_nodes - 1, 1.0 * h / 6.0)\n        M = np.diag(diag0_M) + np.diag(diag1_M, k=1) + np.diag(diag1_M, k=-1)\n\n        # Form the system matrix A = K + k^2 * M\n        A = K + k**2 * M\n        \n        # Solve the linear system A*p = b\n        p = np.linalg.solve(A, b)\n    else: # k == 0.0, Poisson problem with pure Neumann\n        # Create constraint vector for zero-mean condition\n        w = np.full(n_nodes, h)\n        w[0] = w[-1] = h / 2.0\n\n        # Assemble the augmented system matrix A_aug\n        A_aug = np.zeros((n_nodes + 1, n_nodes + 1))\n        A_aug[:n_nodes, :n_nodes] = K\n        A_aug[:n_nodes, n_nodes] = w\n        A_aug[n_nodes, :n_nodes] = w\n\n        # Assemble the augmented load vector b_aug\n        b_aug = np.zeros(n_nodes + 1)\n        b_aug[:n_nodes] = b\n\n        # Solve the augmented system\n        p_aug = np.linalg.solve(A_aug, b_aug)\n        p = p_aug[:n_nodes]\n\n    # Interpolate to find the pressure at the midpoint x = L/2\n    if N % 2 == 0:\n        # Midpoint is a node\n        mid_idx = N // 2\n        p_mid = p[mid_idx]\n    else:\n        # Midpoint is in the middle of an element\n        mid_idx_left = N // 2\n        p_mid = (p[mid_idx_left] + p[mid_idx_left + 1]) / 2.0\n    \n    return p_mid\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (L, N, k, F0, g)\n        (1.0, 10, 5.0, 100.0, 0.0), # Case 1\n        (1.0, 20, 5.0, 0.0, 100.0), # Case 2\n        (2.0, 50, 0.0, -5.0, 10.0), # Case 3\n    ]\n\n    results = []\n    for L, N, k, F0, g in test_cases:\n        result = compute_midpoint_pressure(L, N, k, F0, g)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.7f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}