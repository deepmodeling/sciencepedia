## 引言
在[计算声学](@entry_id:172112)、电磁学及其他波物理领域，精确模拟波与物体的相互作用是一个核心挑战。尤其是在开放边界问题中，如何在有限的计算区域内有效地引入一个来自无穷远的、无失真的入射波，是许多数值方法的关键难题。全场/散射场（Total-Field/Scattered-Field, TF/SF）公式正是为解决这一问题而生的一种强大而优雅的数值框架。它通过巧妙地将物理场分解，使得我们可以在一个紧凑的区域内模拟复杂的散射现象，同时避免了将计算网格延伸至[远场](@entry_id:269288)的巨大成本。

本文旨在系统性地剖析TF/SF公式的理论与实践。读者将通过本文学习到：

“原理与机制”部分将深入探讨TF/SF方法的基础，从场分解思想出发，推导数值界面的实现方式，并分析包括数值频散在内的关键误差来源及其修正策略。“应用与交叉学科联系”部分将展示TF/SF公式的广泛适用性，从经典的散射问题到[光子晶体](@entry_id:137347)、[超材料](@entry_id:276826)、流动介质中的[声传播](@entry_id:1120706)等前沿交叉领域。最后，“动手实践”部分提供了一系列精心设计的计算练习，旨在帮助读者将理论知识转化为解决实际问题的能力。

通过这几个层次的递进学习，本文将引导您全面掌握TF/SF这一计算波物理学中的基石技术。

## 原理与机制

本章旨在深入阐述全场/散射场（Total-Field/Scattered-Field, TF/SF）公式的核心原理与数值实现机制。我们将从基本分解思想出发，系统地推导其在计算域中的实现方式，探讨[数值误差](@entry_id:635587)的来源与规避策略，并最终将其置于一个完整的计算声学仿真环境中进行考量。

### 场分解的基本原理

在波散射问题的研究中，我们通常关心的是一个已知的入射波与散射体相互作用后产生的总声场。TF/SF 方法的核心思想是将这个复杂的总声场 $(p, \mathbf{v})$ 分解为一个已知的**入射场** $(p^{\mathrm{inc}}, \mathbf{v}^{\mathrm{inc}})$ 和一个待求解的**散射场** $(p^{\mathrm{scat}}, \mathbf{v}^{\mathrm{scat}})$ 的线性叠加：

$p = p^{\mathrm{inc}} + p^{\mathrm{scat}}$

$\mathbf{v} = \mathbf{v}^{\mathrm{inc}} + \mathbf{v}^{\mathrm{scat}}$

其中，$p$ 是声压，$ \mathbf{v} $ 是质点速度。入射场是在没有散射体存在时，在均匀背景介质中传播的场。它是一个已知量，通常是解析形式，例如[平面波](@entry_id:189798)或点源。散射场则代表了散射体对入射波扰动所产生的所有波现象。

#### 线性、叠加与问题转化

这种分解之所以成立，其根本在于控制[线性声学](@entry_id:1127264)现象的[波动方程](@entry_id:139839)是**线性**的。考虑在均匀、无损耗的流体中，声学扰动由以下线性化的一阶方程组描述：

$\rho_0 \frac{\partial \mathbf{v}}{\partial t} + \nabla p = \mathbf{0}$

$\frac{\partial p}{\partial t} + \rho_0 c^2 \nabla \cdot \mathbf{v} = 0$

这里，$\rho_0$ 是流体的环境密度，$c$ 是声速。由于这些方程是线性的，我们可以利用叠加原理。将场的分解形式代入上述方程组，并利用入射场 $(p^{\mathrm{inc}}, \mathbf{v}^{\mathrm{inc}})$ 本身就是该方程组在全空间 $\mathbb{R}^3$ 内的一个解这一事实，我们可以推断出散射场 $(p^{\mathrm{scat}}, \mathbf{v}^{\mathrm{scat}})$ 也必须满足同一组齐次声学方程 。

这种分解巧妙地将一个复杂的问题转化为了一个等效但更易于数值处理的问题。原始问题是求解在包含散射体的非均匀环境中总场的行为；而新问题则是在一个均匀的背景介质中，求解一个由散射体“驱动”的散射场。

驱动散射场的“源”来自于边界条件。例如，对于一个刚性固定散射体，其表面 $S$ 上的总场法向速度必须为零，即 $\mathbf{v} \cdot \mathbf{n} = 0$。将场分解代入此条件：

$(\mathbf{v}^{\mathrm{inc}} + \mathbf{v}^{\mathrm{scat}}) \cdot \mathbf{n} = 0$

由此得到散射场在散射体表面必须满足的边界条件：

$\mathbf{v}^{\mathrm{scat}} \cdot \mathbf{n} = -\mathbf{v}^{\mathrm{inc}} \cdot \mathbf{n} \quad \text{在 } S \text{ 上}$

这个条件直观地揭示了散射场的物理意义：散射场在物体边界处被“激发”，其作用是精确抵消入射场的法向速度分量，从而共同满足物理边界条件 。此外，为了确保外域问题[解的唯一性](@entry_id:143619)，散射场还必须满足在无穷远处的**[Sommerfeld辐射条件](@entry_id:168772)**，保证能量是向外传播的。

#### 分[解的唯一性](@entry_id:143619)

一个自然的问题是：这样的分解是否唯一？给定一个总场和一个入射场，散射场通过代数关系 $p^{\mathrm{scat}} = p - p^{\mathrm{inc}}$ 显然是唯一的。但更深刻的问题是，对于一个给定的物理散射问题（即给定的入射场和散射体），其产生的散射场解是否唯一？答案是肯定的，而其保障同样来自于控制方程的线性。

我们可以通过[反证法](@entry_id:276604)来证明这一点。假设对于同一个问题存在两个不同的散射场解 $(p_1^{\mathrm{scat}}, \mathbf{v}_1^{\mathrm{scat}})$ 和 $(p_2^{\mathrm{scat}}, \mathbf{v}_2^{\mathrm{scat}})$。由于方程是线性的，它们的差值场 $(p_d, \mathbf{v}_d) = (p_1^{\mathrm{scat}} - p_2^{\mathrm{scat}}, \mathbf{v}_1^{\mathrm{scat}} - \mathbf{v}_2^{\mathrm{scat}})$ 必然满足**齐次**的声学方程，并且满足零初始条件和零边界条件（因为两个解满足相同的[非齐次边界条件](@entry_id:750645)）。根据[线性偏微分方程](@entry_id:172517)的[唯一性定理](@entry_id:166861)，一个满足[齐次方程](@entry_id:163650)和齐次边界/初始条件的解必然是零解。因此，$p_d \equiv 0$ 且 $\mathbf{v}_d \equiv \mathbf{0}$，这证明了两个假设的解是完全相同的。这个唯一性保证了TF/SF方法在理论上的严谨性 。

### 数值界面：区域分解

在数值计算中，我们通常在一个有限的计算域内求解问题。TF/SF方法通过引入一个封闭的、不与任何物理边界重合的**人工数值界面** $\Gamma$ 来实现。这个界面将整个计算域 $\Omega$ 分为两个子区域：

1.  **全场区 (Total-Field Region, $\Omega_{\mathrm{TF}}$)**：位于界面 $\Gamma$ 内部，该区域的数值解代表物理上的总场 $(p^{\mathrm{T}}, \mathbf{v}^{\mathrm{T}}) = (p^{\mathrm{inc}} + p^{\mathrm{scat}}, \mathbf{v}^{\mathrm{inc}} + \mathbf{v}^{\mathrm{scat}})$。所有的物理散射体都必须被包含在这个区域内。
2.  **散射场区 (Scattered-Field Region, $\Omega_{\mathrm{SF}}$)**：位于界面 $\Gamma$ 外部，该区域的数值解仅代表散射场 $(p^{\mathrm{S}}, \mathbf{v}^{\mathrm{S}}) = (p^{\mathrm{scat}}, \mathbf{v}^{\mathrm{scat}})$。

界面 $\Gamma$ 本身在物理上并不存在，它只是一个数学构造。因此，物理场（总场）在穿过 $\Gamma$ 时必须是连续的。这一基本物理原则是推导数值[界面条件](@entry_id:750725)的关键。设 $\mathbf{n}$ 为从 $\Omega_{\mathrm{SF}}$ 指向 $\Omega_{\mathrm{TF}}$ 的[单位法向量](@entry_id:178851)。在界面 $\Gamma$ 上，从内部逼近的总场必须等于从外部逼近的总场。

-   从内部 ($\Omega_{\mathrm{TF}}$) 看，总场就是计算变量 $(p^{\mathrm{T}}, \mathbf{v}^{\mathrm{T}})$。
-   从外部 ($\Omega_{\mathrm{SF}}$) 看，计算变量是 $(p^{\mathrm{S}}, \mathbf{v}^{\mathrm{S}})$，它只代表散射场。因此，此处的总场是计算变量与入射场之和，即 $(p^{\mathrm{S}} + p^{\mathrm{inc}}, \mathbf{v}^{\mathrm{S}} + \mathbf{v}^{\mathrm{inc}})$。

令两者在界面 $\Gamma$ 上相等，我们得到声压和法向速度的**[跳跃条件](@entry_id:750965)**：

$p^{\mathrm{T}}|_{\Gamma} = (p^{\mathrm{S}} + p^{\mathrm{inc}})|_{\Gamma} \implies p^{\mathrm{T}}|_{\Gamma} - p^{\mathrm{S}}|_{\Gamma} = p^{\mathrm{inc}}|_{\Gamma}$

$(\mathbf{v}^{\mathrm{T}} \cdot \mathbf{n})|_{\Gamma} = ((\mathbf{v}^{\mathrm{S}} + \mathbf{v}^{\mathrm{inc}}) \cdot \mathbf{n})|_{\Gamma} \implies (\mathbf{v}^{\mathrm{T}} \cdot \mathbf{n})|_{\Gamma} - (\mathbf{v}^{\mathrm{S}} \cdot \mathbf{n})|_{\Gamma} = (\mathbf{v}^{\mathrm{inc}} \cdot \mathbf{n})|_{\Gamma}$

这些条件构成了在数值上实现场注入的核心机制 。它们表明，在TF区和SF区的交界处，两个区域计算变量的差值必须精确等于该处入射场的值。这为通过施加等效源来“注入”入射场提供了理论依据。

### 在[时域有限差分法 (FDTD)](@entry_id:261431) 中的实现

我们以应用广泛的[交错网格](@entry_id:1125805)[时域有限差分法](@entry_id:141865)（FDTD）为例，具体说明如何实现上述界面条件。在典型的Yee元胞中，声压 $p$ 定义在网格单元的中心，而速度分量 $v_x, v_y, v_z$ 定义在相应面的中心。

FDTD的更新过程基于对一阶声学方程的[中心差分近似](@entry_id:177025)。例如，声压的[更新方程](@entry_id:264802)可写为：
$p^{n+1}_{i,j,k} = p^n_{i,j,k} - \kappa \Delta t \left( \frac{v_{x, i+1/2,j,k}^{n+1/2} - v_{x, i-1/2,j,k}^{n+1/2}}{\Delta x} + \dots \right)$
其中 $\kappa = \rho_0 c^2$ 是体积模量。速度分量的[更新方程](@entry_id:264802)则依赖于声压的梯度。

现在，考虑一个与网格对齐的、位于 $x = (i_{\Gamma}+1/2)\Delta x$ 平面上的TF/SF界面。区域 $i \le i_{\Gamma}$ 是TF区，区域 $i > i_{\Gamma}$ 是SF区。我们来考察紧邻界面内侧的TF区压力节点 $(i_{\Gamma}, j, k)$ 的[更新过程](@entry_id:275714)。

根据标准的FDTD更新公式，计算 $p^{n+1}_{i_{\Gamma},j,k}$ 需要用到其两侧的速度值 $v_{x, i_{\Gamma}-1/2,j,k}^{n+1/2}$ 和 $v_{x, i_{\Gamma}+1/2,j,k}^{n+1/2}$。前者位于TF区，其存储值是总速度 $v_{x, T}$。然而，后者位于SF/TF界面上，属于SF区，其存储值是散射速度 $v_{x, S}$。因此，直接使用存储值计算得到的更新是：
$p_{T, \text{impl}}^{n+1} = p_{T}^{n} - \kappa \Delta t \left( \frac{v_{x,S, i_{\Gamma}+1/2}^{n+1/2} - v_{x,T, i_{\Gamma}-1/2}^{n+1/2}}{\Delta x} + \dots \right)$

但是，物理上正确的更新应该使用总速度：
$p_{T, \text{correct}}^{n+1} = p_{T}^{n} - \kappa \Delta t \left( \frac{v_{x,T, i_{\Gamma}+1/2}^{n+1/2} - v_{x,T, i_{\Gamma}-1/2}^{n+1/2}}{\Delta x} + \dots \right)$

为了修正这个错误，我们必须在标准的更新公式上加上一个**修正源项** $S_p$。该源项等于正确更新值与实际执行更新值之差：
$S_p = p_{T, \text{correct}}^{n+1} - p_{T, \text{impl}}^{n+1} = -\frac{\kappa \Delta t}{\Delta x} (v_{x,T, i_{\Gamma}+1/2}^{n+1/2} - v_{x,S, i_{\Gamma}+1/2}^{n+1/2})$

利用关系 $v_T = v_S + v_{\text{inc}}$，我们得到最终的修正项 ：
$S_p^{n}(i_{\Gamma},j,k) = -\frac{\kappa \Delta t}{\Delta x} v_{x,\text{inc}}^{n+1/2}(i_{\Gamma}+1/2,j,k)$

这个源项物理意义明确：它补偿了由于在SF区使用了散射速度而“丢失”的入射速度通量。对界面另一侧的SF区压力节点，以及界面上的速度节点，可以进行类似的推导，得到相应的修正项。这些源项共同作用，在TF区内“生成”入射波，并在SF区内将其“抵消”。

用于计算这些源项的入射场 $(p^{\mathrm{inc}}, \mathbf{v}^{\mathrm{inc}})$ 是已知的。对于常见的[平面波](@entry_id:189798)入射，其声压和质点速度之间存在简单的关系，由介质的**特征声阻抗** $Z_0 = \rho_0 c$ 决定。通过[动量方程](@entry_id:197225)可以推导出，对于沿 $\mathbf{n}$ 方向传播的平面波，其声压与法向速度满足 $p^{\mathrm{inc}} / (\mathbf{n} \cdot \mathbf{v}^{\mathrm{inc}}) = \rho_0 c$ 。

### 误差来源与高级技术

尽管TF/SF方法原理上很完美，但在离散化的数值实现中会引入各种误差，导致入射场不能被完全限制在TF区内，部分会“泄漏”到SF区，这种现象被称为**数值泄漏**（numerical leakage）。

#### 数值泄漏与变量配置

在交错网格中，一个重要的误差来源是当计算源项所需的入射场值位于网格点之间时，必须进行插值。插值本身会引入误差。一个精妙的实现细节可以显著减少此类误差。

回顾FDTD的[更新方程](@entry_id:264802)：压力更新依赖于速度的散度，而速度更新依赖于压力的梯度。这意味着，施加[界面条件](@entry_id:750725)的修正项可以有两种方式：
1.  修改压力[更新方程](@entry_id:264802)（即连续方程），等效于施加法向速度跳跃条件。
2.  修改速度[更新方程](@entry_id:264802)（即动量方程），等效于施加压力跳跃条件。

在交错网格中，如果TF/SF界面 $\Gamma$ 沿网格单元的表面（例如 $x$ 方向速度 $v_x$ 所在的面）设置，那么法向速度分量天然地就定义在界面上。此时，若选择通过修正压力方程来施加法向速度跳跃，计算源项所需的 $v_{x, \text{inc}}$ 值可以直接从其定义位置获取，无需任何[空间插值](@entry_id:1132043)。相反，若选择修正速度方程，则需要用到界面两侧的压力值，而压力定义在单元中心，需要对入射压[力场](@entry_id:147325)进行插值才能得到界面上的值，从而引入误差。因此，对于标准的[交错网格](@entry_id:1125805)，当界面与网格面对齐时，通过修正压力方程来施加法向速度[跳跃条件](@entry_id:750965)是减少数值泄漏的最优选择 。

#### 数值频散

一个更根本的误差来源是**数值频散**。FDTD网格本身是一个离散结构，波在其中传播的行为与在连续介质中不完全相同。其结果是，波的相速度依赖于其频率和传播方向，这便是数值频散。

FDTD方程的离散[平面波解](@entry_id:195230)满足的**数值频散关系**，与连续介质的频散关系 $\omega = c |\mathbf{k}|$ 不同。对于二维标量波动方程的[二阶中心差分](@entry_id:170774)格式，其数值频散关系为 ：
$\sin^{2}\left(\frac{\omega \Delta t}{2}\right) = \sigma^{2} \left[ \sin^{2}\left(\frac{k_x h}{2}\right) + \sin^{2}\left(\frac{k_y h}{2}\right) \right]$
其中，$h$ 是空间步长，$\sigma = c\Delta t/h$ 是[Courant数](@entry_id:143767)。

当我们使用解析公式（基于连续介质频散关系 $k_0 = \omega/c$）计算入射场并将其作为TF/SF源项时，这个解析波并非FDTD离散方程的精确解。这种不匹配导致FDTD求解器在每一步更新时都会在TF/SF界面上产生微小的非物理散射波，这些波会泄漏到SF区域。这种由于入射波与离散网格“不兼容”而产生的泄漏是TF/SF方法的一个主要误差源。其累积效应表现为数值波与理论波之间的相位差，在一个波长 $\lambda$ 距离上累积的相位误差 $\Delta\phi$ 的主阶项为 ：
$\Delta \phi = \frac{\pi k^{2} h^{2}}{12} \left( \cos^{4}(\theta) + \sin^{4}(\theta) - \sigma^{2} \right)$
其中 $\theta$ 是传播方向与坐标轴的夹角。

#### 频散修正

幸运的是，我们可以通过修[正入射](@entry_id:260681)场的定义来消除这种不匹配。我们的目标是构造一个在FDTD网格上传播时不会产生伪影的入射场。这意味着这个入射场本身必须是FDTD**离散方程**的一个精确解。

为实现这一点，我们保持入射波的频率 $\omega$ 和传播方向 $\theta$ 不变，但不再使用连续介质的波数 $k_0 = \omega/c$，而是通过**反解**数值频散关系，计算出一个与离散格式相容的**频散[修正波数](@entry_id:141354)** $k_d(\omega, \theta)$。例如，对于沿对角线 $\theta = \pi/4$ 传播的波，可以精确解出 ：
$k_{d} = \frac{2\sqrt{2}}{h} \arcsin\left(\frac{h}{\sqrt{2} c \Delta t} \sin\left(\frac{\omega \Delta t}{2}\right)\right)$

使用这个修正后的波数 $k_d$ 来构造入射[平面波](@entry_id:189798)，再代入TF/SF源项公式，就能保证注入的波是离散系统的“[本征模](@entry_id:174677)”。这样，它在TF区内传播时将保持纯净的平面波形态，不会在界面上产生因频散失配导致的数值泄漏，从而极大地提高了仿真的精度。

### 在完整仿真环境中的集成

#### 与[完美匹配层 (PML)](@entry_id:1129508) 的协同工作

在有限的计算域中模拟开放空间问题，必须在域的边界设置**[吸收边界条件](@entry_id:164672)**（Absorbing Boundary Condition, ABC）来吸收向外传播的波，防止其反射回计算域内部。**[完美匹配层](@entry_id:753330)**（Perfectly Matched Layer, PML）是一种高效的吸收层技术。

PML的设计原理是，它是一个人工设计的各向异性、有损耗的介质层，其阻抗与相邻的物理介质[完美匹配](@entry_id:273916)，因此波在进入PML时不会发生反射。然而，这个“[完美匹配](@entry_id:273916)”的特性是有条件的：它只对满足特定[波动方程](@entry_id:139839)（通常是均匀、无源的背景介质方程）的波有效。

这就对TF/SF区域和PML的相对位置提出了严格要求。
-   TF/SF界面本身包含等效源项，破坏了“无源”条件。
-   TF区域可能包含散射体，使得该区域内的总场不满足均匀介质方程。

因此，如果将PML置于TF区域内或与TF/SF界面重合，入射场或界面源项会直接与PML相互作用，破坏其[完美匹配](@entry_id:273916)的条件，导致严重的伪反射。正确的做法是：**将整个PML区域放置在散射场区（SF区）内**。由于SF区不包含入射场和界面源，其中的散射波在传播到PML之前，满足均匀、无源的背景方程，因此可以被PML有效地吸收。为进一步提高精度，通常还会在TF/SF界面和PML内边界之间设置一个由数个网格单元构成的“缓冲带”，以确保任何来自界面的高频[数值噪声](@entry_id:1128984)在到达PML前已经衰减 。

#### 推广至非均匀介质

TF/SF方法还可以推广到更复杂的场景，例如当人工界面 $\Gamma$ 恰好与一个物理介质分界面重合时，界面两侧的背景介质属性 $(\rho_0, c)$ 不同。此时，简单的跳跃条件已不再适用。

处理这种情况需要更深刻的物理洞察，即采用基于**[特征分析](@entry_id:1124210)**（characteristic analysis）的方法。一阶声学方程组是一个[双曲系统](@entry_id:260647)，其信息沿特征线传播。对于一维问题，可以定义两个**[黎曼不变量](@entry_id:165930)**（Riemann invariants），或称[特征变量](@entry_id:747282)：
$w_{\pm} = p \pm Z u_n$
其中 $u_n$ 是法向速度，$Z = \rho_0 c$ 是局部声阻抗。$w_+$ 沿 $+n$ 方向以速度 $+c$ 传播，$w_-$ 沿 $-n$ 方向以速度 $-c$ 传播。

当界面两侧介质不同时，必须在每一侧使用其各自的局部参数 $(\rho^\pm, c^\pm)$ 来定义[特征变量](@entry_id:747282)。[数值边界条件](@entry_id:752776)的核心原则是：**只规定传入计算[域的特征](@entry_id:154386)变量，而传出的[特征变量](@entry_id:747282)必须由内部的动力学决定**。

对于跨介质的TF/SF界面，设 $\mathbf{n}$ 从“减侧”（TF区）指向“加侧”（SF区）：
-   在减侧（TF区），传入的[特征变量](@entry_id:747282)是 $w_-^- = p - Z^- u_n$。为注入入射场，需将其值设为入射场对应的传入特征量：$w_-^- = p^{\mathrm{inc}} - Z^- u_n^{\mathrm{inc}}$。
-   在加侧（SF区），传入的[特征变量](@entry_id:747282)是 $w_+^+ = p + Z^+ u_n$。为保证SF区没有入射场，需将其设为零：$w_+^+ = 0$。

这种基于[特征变量](@entry_id:747282)的规定，能够正确地注入入射场，同时保证了跨越物理界面的散射波能够根据真实的物理定律（[Snell定律](@entry_id:162003)）进行透射和反射，而不会产生非物理的[数值反射](@entry_id:752819)。这是TF/SF方法在处理[复杂介质](@entry_id:164088)问题时强大能力的体现 。