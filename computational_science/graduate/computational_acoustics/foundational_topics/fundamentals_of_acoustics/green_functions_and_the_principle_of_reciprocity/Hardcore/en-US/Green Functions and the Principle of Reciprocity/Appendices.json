{
    "hands_on_practices": [
        {
            "introduction": "One of the most powerful analytical methods for constructing a Green's function is through eigenfunction expansion. This exercise  demonstrates this technique for the Helmholtz equation within a bounded acoustic cavity, which is governed by a self-adjoint operator. You will build the Green's function from first principles and, in doing so, uncover the special significance of the zero-frequency (or constant) mode that arises under Neumann boundary conditions, a crucial concept in acoustics and other field theories.",
            "id": "4125321",
            "problem": "Consider a three-dimensional rectangular acoustic cavity $\\Omega = (0,L_{x}) \\times (0,L_{y}) \\times (0,L_{z})$ filled with a homogeneous, lossless fluid. The cavity walls are perfectly rigid, implying homogeneous Neumann boundary conditions for the acoustic pressure. In the frequency domain, the acoustic pressure Green's function $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ for the Helmholtz operator satisfies the Partial Differential Equation (PDE)\n$$\n\\nabla^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) + k^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) = -\\delta(\\mathbf{r}-\\mathbf{r}'),\n$$\nwith the homogeneous Neumann boundary condition\n$$\n\\frac{\\partial G_{N}}{\\partial n}\\bigg|_{\\partial \\Omega} = 0,\n$$\nwhere $k>0$ is the wavenumber, $\\delta(\\mathbf{r}-\\mathbf{r}')$ is the Dirac delta distribution, and $\\partial/\\partial n$ denotes the outward normal derivative on the boundary $\\partial \\Omega$. Assume that $k^{2}$ is not equal to any nonzero Neumann Laplacian eigenvalue of $\\Omega$ so that the resolvent is well-defined.\n\nStarting from fundamental principles, namely the self-adjointness of the negative Laplacian with Neumann boundary conditions and the completeness and orthonormality of its eigenfunctions, construct the eigenfunction expansion for $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ in $\\Omega$. Identify the zero-eigenvalue (constant) mode explicitly, including its correct normalization, and use the principle of reciprocity to explain the symmetry $G_{N}(\\mathbf{r},\\mathbf{r}';k) = G_{N}(\\mathbf{r}',\\mathbf{r};k)$ in this setting.\n\nThen, analytically evaluate the double-volume average of the Neumann Green's function over both arguments:\n$$\n\\langle G_{N} \\rangle := \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}',\n$$\nwhere $V = L_{x} L_{y} L_{z}$ is the cavity volume. Your evaluation must isolate and quantify the contribution of the zero-frequency (constant) mode.\n\nProvide the final result for $\\langle G_{N} \\rangle$ as a single, closed-form analytic expression in terms of $L_{x}$, $L_{y}$, $L_{z}$, and $k$. Express the final answer in inverse meters. No numerical approximation is required.",
            "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n- **Domain:** A three-dimensional rectangular acoustic cavity $\\Omega = (0,L_{x}) \\times (0,L_{y}) \\times (0,L_{z})$.\n- **Medium:** Homogeneous, lossless fluid.\n- **Boundary Conditions:** Perfectly rigid walls, implying homogeneous Neumann boundary conditions: $\\frac{\\partial G_{N}}{\\partial n}\\bigg|_{\\partial \\Omega} = 0$.\n- **Governing Equation:** The Helmholtz equation for the Green's function $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ is $\\nabla^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) + k^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) = -\\delta(\\mathbf{r}-\\mathbf{r}')$, where $\\mathbf{r}, \\mathbf{r}' \\in \\Omega$.\n- **Parameters:** Wavenumber $k>0$.\n- **Constraint:** $k^{2}$ is not equal to any nonzero Neumann Laplacian eigenvalue of $\\Omega$.\n- **Task 1:** Construct the eigenfunction expansion for $G_{N}(\\mathbf{r},\\mathbf{r}';k)$, identifying the zero-eigenvalue mode.\n- **Task 2:** Use the principle of reciprocity to explain the symmetry $G_{N}(\\mathbf{r},\\mathbf{r}';k) = G_{N}(\\mathbf{r}',\\mathbf{r};k)$.\n- **Task 3:** Analytically evaluate the double-volume average $\\langle G_{N} \\rangle := \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'$, where $V = L_{x} L_{y} L_{z}$.\n- **Output Requirement:** The final result for $\\langle G_{N} \\rangle$ must be a single, closed-form analytic expression in terms of $L_{x}$, $L_{y}$, $L_{z}$, and $k$, with units of inverse meters.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard problem in mathematical physics and acoustics involving the Helmholtz equation and Green's functions. The setup is well-posed; the domain, operator, and boundary conditions are clearly defined. The constraint that $k^2$ is not a non-zero eigenvalue ensures that the Green's function is well-defined and does not diverge, which is a critical condition for solvability. The language is objective and precise. The problem is self-contained and free from contradictions or scientific flaws. It is a non-trivial problem that tests fundamental concepts of eigenfunction expansions and orthogonality.\n\n### Step 3: Verdict and Action\nThe problem is valid and can be solved as stated.\n\nThe solution proceeds by first finding the eigenfunctions and eigenvalues of the governing operator, which are then used to construct the Green's function.\n\nThe Green's function $G_N(\\mathbf{r},\\mathbf{r}';k)$ is the solution to the inhomogeneous Helmholtz equation. Let $L = -\\nabla^2$ be the negative Laplacian operator. The PDE can be written as $(L - k^2)G_N(\\mathbf{r}, \\mathbf{r}'; k) = \\delta(\\mathbf{r}-\\mathbf{r}')$. The Green's function can be expanded in the complete, orthonormal basis of eigenfunctions of $L$ with homogeneous Neumann boundary conditions.\n\nFirst, we solve the eigenvalue problem $L\\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$, which is $-\\nabla^2 \\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$ in $\\Omega$, with the boundary condition $\\frac{\\partial \\psi}{\\partial n}|_{\\partial\\Omega} = 0$.\nUsing the method of separation of variables, we let $\\psi(x,y,z) = X(x)Y(y)Z(z)$. This leads to three ordinary differential equations:\n$$\n-X''(x) = k_x^2 X(x), \\quad -Y''(y) = k_y^2 Y(y), \\quad -Z''(z) = k_z^2 Z(z)\n$$\nwith boundary conditions $X'(0)=X'(L_x)=0$, $Y'(0)=Y'(L_y)=0$, and $Z'(0)=Z'(L_z)=0$. The eigenvalues are $\\lambda = k_x^2 + k_y^2 + k_z^2$.\nThe solutions satisfying these boundary conditions are of the form $\\cos(\\frac{n_x \\pi x}{L_x})$, $\\cos(\\frac{n_y \\pi y}{L_y})$, and $\\cos(\\frac{n_z \\pi z}{L_z})$, where $n_x, n_y, n_z$ are non-negative integers.\nThe eigenvalues are thus indexed by the triple integer $\\mathbf{n}=(n_x, n_y, n_z)$:\n$$\n\\lambda_{\\mathbf{n}} = k_{\\mathbf{n}}^2 = \\left(\\frac{n_x \\pi}{L_x}\\right)^2 + \\left(\\frac{n_y \\pi}{L_y}\\right)^2 + \\left(\\frac{n_z \\pi}{L_z}\\right)^2\n$$\nThe corresponding unnormalized eigenfunctions are $\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\cos(\\frac{n_x \\pi x}{L_x})\\cos(\\frac{n_y \\pi y}{L_y})\\cos(\\frac{n_z \\pi z}{L_z})$.\n\nThese eigenfunctions must be normalized such that $\\int_\\Omega \\psi_{\\mathbf{n}}(\\mathbf{r})^2 \\,d^3\\mathbf{r} = 1$. Let's compute the normalization integral:\n$$\n\\int_0^{L_x} \\cos^2\\left(\\frac{n_x \\pi x}{L_x}\\right)dx = \\begin{cases} L_x & \\text{if } n_x=0 \\\\ L_x/2 & \\text{if } n_x>0 \\end{cases}\n$$\nThe same applies to the $y$ and $z$ integrals. We define a factor $N_j$ as $N_j=1$ if $n_j=0$ and $N_j=2$ if $n_j>0$. The square of the normalization constant is given by:\n$$\nC_{\\mathbf{n}}^2 \\frac{L_x}{N_x} \\frac{L_y}{N_y} \\frac{L_z}{N_z} = 1 \\implies C_{\\mathbf{n}} = \\sqrt{\\frac{N_x N_y N_z}{V}}\n$$\nwhere $V=L_x L_y L_z$. The orthonormal eigenfunctions are:\n$$\n\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\sqrt{\\frac{N_x N_y N_z}{V}} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right)\\cos\\left(\\frac{n_y \\pi y}{L_y}\\right)\\cos\\left(\\frac{n_z \\pi z}{L_z}\\right)\n$$\nThe zero-eigenvalue mode corresponds to $\\mathbf{n}=(0,0,0)$. For this mode, $n_x=n_y=n_z=0$, so $N_x=N_y=N_z=1$ and $\\lambda_{\\mathbf{0}}=0$. The normalized eigenfunction is:\n$$\n\\psi_{\\mathbf{0}}(\\mathbf{r}) = \\sqrt{\\frac{1}{V}} \\cos(0)\\cos(0)\\cos(0) = \\frac{1}{\\sqrt{V}}\n$$\nThis is the constant mode.\n\nThe Green's function is given by the eigenfunction expansion:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\sum_{\\mathbf{n}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nThe sum runs over all non-negative integer triples $\\mathbf{n}=(n_x,n_y,n_z)$. We can separate the zero-eigenvalue mode from the sum:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{\\psi_{\\mathbf{0}}(\\mathbf{r})\\psi_{\\mathbf{0}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{0}}} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nSubstituting $\\psi_{\\mathbf{0}}(\\mathbf{r}) = 1/\\sqrt{V}$ and $\\lambda_{\\mathbf{0}}=0$:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{(1/\\sqrt{V})(1/\\sqrt{V})}{k^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}} = \\frac{1}{Vk^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nThis is the eigenfunction expansion of the Neumann Green's function, with the zero-mode contribution explicitly identified.\n\nThe principle of reciprocity, $G_N(\\mathbf{r},\\mathbf{r}';k) = G_N(\\mathbf{r}',\\mathbf{r};k)$, is a direct consequence of the structure of this expansion. The operator $L=-\\nabla^2$ with Neumann boundary conditions is self-adjoint, which guarantees that its eigenvalues $\\lambda_{\\mathbf{n}}$ are real and its eigenfunctions $\\psi_{\\mathbf{n}}(\\mathbf{r})$ can be chosen to be real. In the expansion, the term $\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')$ is manifestly symmetric with respect to an interchange of $\\mathbf{r}$ and $\\mathbf{r}'$. Since every term in the sum is symmetric, the entire sum, and thus the Green's function, is symmetric. This symmetry reflects the physical principle that the acoustic response at $\\mathbf{r}$ due to a source at $\\mathbf{r}'$ is the same as the response at $\\mathbf{r}'$ due to an identical source at $\\mathbf{r}$.\n\nNow, we evaluate the double-volume average:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\nSubstituting the eigenfunction expansion for $G_N$ and swapping the order of summation and integration:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\sum_{\\mathbf{n}} \\frac{1}{k^2 - \\lambda_{\\mathbf{n}}} \\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\nThe double integral can be separated into a product of two identical integrals:\n$$\n\\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}' = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right) \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}' \\right) = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\nLet's evaluate the integral $\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r}$. This integral is proportional to the inner product of $\\psi_{\\mathbf{n}}(\\mathbf{r})$ with the constant function $f(\\mathbf{r})=1$. Since the constant function is proportional to the zero-mode eigenfunction $\\psi_{\\mathbf{0}}(\\mathbf{r})$, the orthogonality of eigenfunctions implies this integral is zero for all $\\mathbf{n} \\neq \\mathbf{0}$.\nLet's verify this explicitly.\nFor $\\mathbf{n} = \\mathbf{0}$:\n$$\n\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\int_{\\Omega} \\frac{1}{\\sqrt{V}} \\, \\mathrm{d}^{3}\\mathbf{r} = \\frac{1}{\\sqrt{V}} V = \\sqrt{V}\n$$\nFor $\\mathbf{n} \\neq \\mathbf{0}$, at least one index $n_j$ (say $n_x$) is non-zero. The integral contains a factor:\n$$\n\\int_0^{L_x} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right) \\, dx = \\left[ \\frac{L_x}{n_x \\pi} \\sin\\left(\\frac{n_x \\pi x}{L_x}\\right) \\right]_0^{L_x} = 0 \\quad \\text{for } n_x > 0\n$$\nThis makes the entire volume integral zero for any $\\mathbf{n} \\neq \\mathbf{0}$.\nSo, $\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\sqrt{V} \\delta_{\\mathbf{n},\\mathbf{0}}$, where $\\delta_{\\mathbf{n},\\mathbf{0}}$ is the Kronecker delta.\n\nTherefore, in the summation for $\\langle G_{N} \\rangle$, all terms for $\\mathbf{n} \\neq \\mathbf{0}$ vanish. Only the term corresponding to the zero-frequency mode $\\mathbf{n}=\\mathbf{0}$ survives.\n\nThe contribution from the $\\mathbf{n}=\\mathbf{0}$ mode is:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2 - \\lambda_{\\mathbf{0}}} \\left( \\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\nSubstituting $\\lambda_{\\mathbf{0}}=0$ and $\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, d^3\\mathbf{r} = \\sqrt{V}$:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2} (\\sqrt{V})^2 = \\frac{1}{V^2} \\frac{V}{k^2} = \\frac{1}{Vk^2}\n$$\nThe entire contribution to the double-volume average comes from the zero-frequency (constant) mode.\nSubstituting $V = L_x L_y L_z$, we obtain the final expression:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{L_x L_y L_z k^2}\n$$\nThe units are consistent with the request: $V$ has units of $[\\text{length}]^3$ and $k$ has units of $[\\text{length}]^{-1}$, so $Vk^2$ has units of $[\\text{length}]$. The final result $\\langle G_{N} \\rangle$ has units of $[\\text{length}]^{-1}$.",
            "answer": "$$ \\boxed{\\frac{1}{L_x L_y L_z k^2}} $$"
        },
        {
            "introduction": "The abstract principle of reciprocity has a concrete and vital representation within the matrices of numerical methods like the Finite Element Method (FEM). This practice  delves into this connection by examining the discrete Green's matrix, $G(\\omega)$, for a simple acoustic system. You will learn to identify the conditions for reciprocity at the matrix level and quantify how non-reciprocal effects, such as those modeled by non-symmetric damping, break this fundamental symmetry.",
            "id": "4125340",
            "problem": "In linear acoustics for a quiescent medium, the frequency-domain pressure field $p(\\mathbf{x},\\omega)$ satisfies a Helmholtz-type equation that, under a Galerkin discretization by the Finite Element Method (FEM), leads to a second-order discrete system whose weak-form coefficients assemble into a real symmetric mass matrix $M$ and a real symmetric stiffness matrix $K$. When damping is included and the excitation is time-harmonic at angular frequency $\\omega$, the discrete frequency-domain equilibrium is governed by a dynamic stiffness operator that acts on the nodal pressure vector $u(\\omega)$ and maps a nodal source vector $f(\\omega)$ to $u(\\omega)$. The discrete Green’s matrix $G(\\omega)$ is the operator inverse that maps $f(\\omega)$ to $u(\\omega)$, and discrete reciprocity is reflected in the symmetry of $G(\\omega)$.\n\nStarting from the conservation of mass and momentum for a small-amplitude acoustic field, derive the discrete frequency-domain operator structure from the FEM weak form and use it to justify conditions under which the discrete Green’s matrix $G(\\omega)$ is symmetric. Then, quantify the symmetry of $G(\\omega)$ by the dimensionless symmetry-breaking index\n$$\nr(\\omega) \\;=\\; \\frac{\\|G(\\omega) - G(\\omega)^{\\mathsf{T}}\\|_{F}}{\\|G(\\omega)\\|_{F}},\n$$\nwhere $\\|\\cdot\\|_{F}$ denotes the Frobenius norm and $(\\cdot)^{\\mathsf{T}}$ denotes matrix transpose. Consider a reduced two-degree-of-freedom FEM model with the following symmetric mass and stiffness matrices:\n$$\nM \\;=\\; \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix},\n\\qquad\nK \\;=\\; \\begin{pmatrix} 5 & -1 \\\\ -1 & 3 \\end{pmatrix},\n$$\noperating at angular frequency $\\omega = 2$ (radians per second). Let the damping be modeled in two scenarios:\n- Scenario (i): Proportional symmetric damping $D \\;=\\; \\alpha M + \\beta K$ with $\\alpha = 0.1$ and $\\beta = 0.05$.\n- Scenario (ii): Non-symmetric gyroscopic-type contribution added to proportional damping $D \\;=\\; \\alpha M + \\beta K + \\gamma J$, where $\\gamma = 0.2$ and\n$$\nJ \\;=\\; \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}.\n$$\nIn both scenarios, the frequency-domain dynamic stiffness is\n$$\nA(\\omega) \\;=\\; K \\;-\\; \\omega^{2} M \\;+\\; i\\,\\omega\\, D,\n$$\nand the discrete Green’s matrix is $G(\\omega) \\;=\\; A(\\omega)^{-1}$. Compute the symmetry-breaking index $r(\\omega)$ for both scenarios (i) and (ii). Express your final answers for $r(\\omega)$ in exact analytic form using radicals; do not round or approximate. The quantity $r(\\omega)$ is dimensionless, so no physical units are required for the final answers.",
            "solution": "The problem asks for a justification of the conditions under which the discrete Green's matrix $G(\\omega)$ is symmetric, and then for the calculation of a dimensionless symmetry-breaking index, $r(\\omega)$, for two different damping scenarios in a $2$-degree-of-freedom system.\n\nFirst, we address the condition for the symmetry of the discrete Green's matrix, $G(\\omega)$. The discrete frequency-domain equilibrium equation is given by\n$$A(\\omega) u(\\omega) = f(\\omega)$$\nwhere $A(\\omega)$ is the dynamic stiffness matrix, $u(\\omega)$ is the vector of nodal pressures, and $f(\\omega)$ is the vector of nodal sources. The discrete Green's matrix $G(\\omega)$ is defined as the inverse of $A(\\omega)$, such that $u(\\omega) = G(\\omega) f(\\omega)$.\n$$G(\\omega) = A(\\omega)^{-1}$$\nA fundamental property of matrices is that a matrix is symmetric if and only if its inverse is symmetric. Therefore, $G(\\omega)$ is symmetric, i.e., $G(\\omega) = G(\\omega)^{\\mathsf{T}}$, if and only if $A(\\omega)$ is symmetric, i.e., $A(\\omega) = A(\\omega)^{\\mathsf{T}}$.\n\nThe dynamic stiffness matrix is defined as:\n$$A(\\omega) = K - \\omega^{2} M + i\\,\\omega\\, D$$\nwhere $K$ is the stiffness matrix, $M$ is the mass matrix, $D$ is the damping matrix, $\\omega$ is the angular frequency, and $i$ is the imaginary unit. To check the condition for symmetry, we take the transpose of $A(\\omega)$:\n$$A(\\omega)^{\\mathsf{T}} = (K - \\omega^{2} M + i\\,\\omega\\, D)^{\\mathsf{T}} = K^{\\mathsf{T}} - (\\omega^{2} M)^{\\mathsf{T}} + (i\\,\\omega\\, D)^{\\mathsf{T}}$$\nSince $\\omega^{2}$ and $i\\,\\omega$ are scalars, this simplifies to:\n$$A(\\omega)^{\\mathsf{T}} = K^{\\mathsf{T}} - \\omega^{2} M^{\\mathsf{T}} + i\\,\\omega\\, D^{\\mathsf{T}}$$\nThe problem states that the mass matrix $M$ and stiffness matrix $K$ are real and symmetric, meaning $M = M^{\\mathsf{T}}$ and $K = K^{\\mathsf{T}}$. Substituting these into the expression for $A(\\omega)^{\\mathsf{T}}$ gives:\n$$A(\\omega)^{\\mathsf{T}} = K - \\omega^{2} M + i\\,\\omega\\, D^{\\mathsf{T}}$$\nFor $A(\\omega)$ to be symmetric, we must have $A(\\omega) = A(\\omega)^{\\mathsf{T}}$:\n$$K - \\omega^{2} M + i\\,\\omega\\, D = K - \\omega^{2} M + i\\,\\omega\\, D^{\\mathsf{T}}$$\nThis equation holds if and only if $i\\,\\omega\\, D = i\\,\\omega\\, D^{\\mathsf{T}}$. For any non-zero frequency $\\omega \\neq 0$, this simplifies to the condition that the damping matrix $D$ must be symmetric:\n$$D = D^{\\mathsf{T}}$$\nThus, in the context of this discrete system, the principle of reciprocity, manifested as the symmetry of the Green's matrix $G(\\omega)$, holds if and only if the damping matrix $D$ is symmetric.\n\nNow, we compute the symmetry-breaking index $r(\\omega)$ for the two specified scenarios at $\\omega = 2$.\nThe index is defined as:\n$$r(\\omega) = \\frac{\\|G(\\omega) - G(\\omega)^{\\mathsf{T}}\\|_{F}}{\\|G(\\omega)\\|_{F}}$$\n\n**Scenario (i): Proportional symmetric damping**\n\nThe damping matrix is given by $D = \\alpha M + \\beta K$, with parameters $\\alpha = 0.1$, $\\beta = 0.05$. The matrices $M$ and $K$ are given as:\n$$M = \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix}, \\qquad K = \\begin{pmatrix} 5 & -1 \\\\ -1 & 3 \\end{pmatrix}$$\nSince $M$ and $K$ are symmetric, and $\\alpha$ and $\\beta$ are scalars, the resulting damping matrix $D$ must also be symmetric:\n$$D^{\\mathsf{T}} = (\\alpha M + \\beta K)^{\\mathsf{T}} = \\alpha M^{\\mathsf{T}} + \\beta K^{\\mathsf{T}} = \\alpha M + \\beta K = D$$\nAs established in our derivation, if $D$ is symmetric, then $A(\\omega)$ is symmetric, and consequently its inverse $G(\\omega)$ is also symmetric. If $G(\\omega) = G(\\omega)^{\\mathsf{T}}$, then the difference $G(\\omega) - G(\\omega)^{\\mathsf{T}}$ is the zero matrix. The Frobenius norm of the zero matrix is $0$. Therefore, for scenario (i), the symmetry-breaking index is:\n$$r(2) = \\frac{\\|0\\|_{F}}{\\|G(2)\\|_{F}} = 0$$\n\n**Scenario (ii): Non-symmetric gyroscopic-type damping**\n\nThe damping matrix is $D = \\alpha M + \\beta K + \\gamma J$, with $\\alpha = 0.1$, $\\beta = 0.05$, $\\gamma = 0.2$, and the skew-symmetric matrix:\n$$J = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$$\nThe term $\\alpha M + \\beta K$ is symmetric, as shown in scenario (i). The term $\\gamma J$ is skew-symmetric, since $J^{\\mathsf{T}} = -J$. The full damping matrix is:\n$$D^{\\mathsf{T}} = (\\alpha M + \\beta K)^{\\mathsf{T}} + (\\gamma J)^{\\mathsf{T}} = (\\alpha M + \\beta K) - \\gamma J$$\nSince $\\gamma \\neq 0$ and $J$ is not the zero matrix, $D \\neq D^{\\mathsf{T}}$. The damping matrix is non-symmetric. Consequently, $A(\\omega)$ and $G(\\omega)$ are non-symmetric, and we expect $r(\\omega) \\neq 0$.\n\nWe compute the dynamic stiffness matrix $A(\\omega)$ at $\\omega = 2$:\n$A(2) = K - 2^{2} M + i(2) D = K - 4M + 2iD$.\nFirst, let's compute $D$:\n$$D = 0.1 \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix} + 0.05 \\begin{pmatrix} 5 & -1 \\\\ -1 & 3 \\end{pmatrix} + 0.2 \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$$\n$$D = \\begin{pmatrix} 0.2 & 0 \\\\ 0 & 0.1 \\end{pmatrix} + \\begin{pmatrix} 0.25 & -0.05 \\\\ -0.05 & 0.15 \\end{pmatrix} + \\begin{pmatrix} 0 & 0.2 \\\\ -0.2 & 0 \\end{pmatrix} = \\begin{pmatrix} 0.45 & 0.15 \\\\ -0.25 & 0.25 \\end{pmatrix}$$\nNow we assemble $A(2)$:\n$$A(2) = \\begin{pmatrix} 5 & -1 \\\\ -1 & 3 \\end{pmatrix} - 4 \\begin{pmatrix} 2 & 0 \\\\ 0 & 1 \\end{pmatrix} + 2i \\begin{pmatrix} 0.45 & 0.15 \\\\ -0.25 & 0.25 \\end{pmatrix}$$\n$$A(2) = \\begin{pmatrix} 5-8 & -1 \\\\ -1 & 3-4 \\end{pmatrix} + i \\begin{pmatrix} 0.9 & 0.3 \\\\ -0.5 & 0.5 \\end{pmatrix} = \\begin{pmatrix} -3 + 0.9i & -1 + 0.3i \\\\ -1 - 0.5i & -1 + 0.5i \\end{pmatrix}$$\nSince $\\det(A) = \\det(A^\\mathsf{T})$, the ratio for the symmetry-breaking index simplifies.\n$r(\\omega) = \\frac{\\|G - G^\\mathsf{T}\\|_F}{\\|G\\|_F} = \\frac{\\|\\frac{1}{\\det(A)}(\\text{adj}(A) - \\text{adj}(A)^\\mathsf{T})\\|_F}{\\|\\frac{1}{\\det(A)}\\text{adj}(A)\\|_F} = \\frac{\\|\\text{adj}(A) - \\text{adj}(A)^\\mathsf{T}\\|_F}{\\|\\text{adj}(A)\\|_F}$.\nFor a $2 \\times 2$ matrix $A = \\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}$, $\\text{adj}(A) = \\begin{pmatrix} d & -b \\\\ -c & a \\end{pmatrix}$.\nThe numerator term becomes:\n$\\|\\text{adj}(A) - \\text{adj}(A)^\\mathsf{T}\\|_F = \\left\\| \\begin{pmatrix} 0 & c-b \\\\ b-c & 0 \\end{pmatrix} \\right\\|_F = \\sqrt{|c-b|^2 + |b-c|^2} = \\sqrt{2}|b-c|$.\nThe denominator term is $\\|\\text{adj}(A)\\|_F = \\sqrt{|a|^2+|b|^2+|c|^2+|d|^2} = \\|A\\|_F$.\nSo, for our $2 \\times 2$ case, $r(2) = \\frac{\\sqrt{2}|a_{21} - a_{12}|}{\\|A(2)\\|_{F}}$.\n\nLet's compute the necessary quantities using fractions for exactness.\n$A(2) = \\begin{pmatrix} -3 + \\frac{9}{10}i & -1 + \\frac{3}{10}i \\\\ -1 - \\frac{1}{2}i & -1 + \\frac{1}{2}i \\end{pmatrix}$.\nThe matrix elements are $a_{11}$, $a_{12}$, $a_{21}$, $a_{22}$.\n$a_{21} - a_{12} = (-1 - \\frac{1}{2}i) - (-1 + \\frac{3}{10}i) = -\\frac{1}{2}i - \\frac{3}{10}i = -\\frac{5+3}{10}i = -\\frac{8}{10}i = -\\frac{4}{5}i$.\n$|a_{21} - a_{12}| = |-\\frac{4}{5}i| = \\frac{4}{5}$.\nThe numerator of $r(2)$ is $\\sqrt{2} \\cdot \\frac{4}{5} = \\frac{4\\sqrt{2}}{5}$.\n\nThe denominator is the Frobenius norm of $A(2)$:\n$$\\|A(2)\\|_{F} = \\sqrt{|a_{11}|^2 + |a_{12}|^2 + |a_{21}|^2 + |a_{22}|^2}$$\n$|a_{11}|^2 = |-3 + \\frac{9}{10}i|^2 = (-3)^2 + (\\frac{9}{10})^2 = 9 + \\frac{81}{100} = \\frac{981}{100}$.\n$|a_{12}|^2 = |-1 + \\frac{3}{10}i|^2 = (-1)^2 + (\\frac{3}{10})^2 = 1 + \\frac{9}{100} = \\frac{109}{100}$.\n$|a_{21}|^2 = |-1 - \\frac{1}{2}i|^2 = (-1)^2 + (-\\frac{1}{2})^2 = 1 + \\frac{1}{4} = \\frac{5}{4} = \\frac{125}{100}$.\n$|a_{22}|^2 = |-1 + \\frac{1}{2}i|^2 = (-1)^2 + (\\frac{1}{2})^2 = 1 + \\frac{1}{4} = \\frac{5}{4} = \\frac{125}{100}$.\n$$\\|A(2)\\|_{F}^2 = \\frac{981 + 109 + 125 + 125}{100} = \\frac{1340}{100} = \\frac{134}{10} = \\frac{67}{5}$$\n$$\\|A(2)\\|_{F} = \\sqrt{\\frac{67}{5}}$$\nFinally, we compute the ratio $r(2)$:\n$$r(2) = \\frac{4\\sqrt{2}/5}{\\sqrt{67/5}} = \\frac{4\\sqrt{2}}{5} \\cdot \\frac{\\sqrt{5}}{\\sqrt{67}} = \\frac{4\\sqrt{10}}{5\\sqrt{67}}$$\nTo rationalize the denominator, we multiply the numerator and denominator by $\\sqrt{67}$:\n$$r(2) = \\frac{4\\sqrt{10}\\sqrt{67}}{5(\\sqrt{67})^2} = \\frac{4\\sqrt{670}}{5 \\cdot 67} = \\frac{4\\sqrt{670}}{335}$$\n\nThe final answers for the symmetry-breaking index $r(2)$ are $0$ for scenario (i) and $\\frac{4\\sqrt{670}}{335}$ for scenario (ii).",
            "answer": "$$\\boxed{\\begin{pmatrix} 0 & \\frac{4\\sqrt{670}}{335} \\end{pmatrix}}$$"
        },
        {
            "introduction": "This final practice synthesizes theory and computation to tackle a classic exterior scattering problem and numerically verify the reciprocity principle. By applying Green's theorem, you will use the Kirchhoff-Helmholtz integral representation to calculate the far-field scattering amplitude, $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$, from data on an obstacle's boundary . This hands-on coding exercise provides practical experience in evaluating boundary integrals and demonstrates the powerful constraint that reciprocity, $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$, imposes on the scattering process.",
            "id": "4125280",
            "problem": "Consider two-dimensional time-harmonic acoustics in a homogeneous, isotropic, source-free exterior domain. The total acoustic pressure field $u_{\\mathrm{tot}}(\\mathbf{x})$ satisfies the scalar Helmholtz equation $\\Delta u_{\\mathrm{tot}}(\\mathbf{x}) + k^{2} u_{\\mathrm{tot}}(\\mathbf{x}) = 0$ for all observation points $\\mathbf{x}$ exterior to a sound-soft obstacle, with the Sommerfeld radiation condition holding at infinity. The obstacle is a circular cylinder of radius $a$ centered at the origin, with the sound-soft boundary condition $u_{\\mathrm{tot}}(\\mathbf{x}) = 0$ imposed for $|\\mathbf{x}| = a$. A unit-amplitude plane wave is incident from direction angle $\\theta_{\\mathrm{i}}$, written as $u_{\\mathrm{inc}}(\\mathbf{x}) = \\exp\\!\\big(i k \\, \\hat{\\mathbf{d}}_{\\mathrm{i}} \\cdot \\mathbf{x}\\big)$ where $\\hat{\\mathbf{d}}_{\\mathrm{i}} = (\\cos \\theta_{\\mathrm{i}}, \\sin \\theta_{\\mathrm{i}})$ and $k$ is the wavenumber. The scattered field is given by $u(\\mathbf{x}) = u_{\\mathrm{tot}}(\\mathbf{x}) - u_{\\mathrm{inc}}(\\mathbf{x})$ and obeys the same Helmholtz equation and radiation condition in the exterior.\n\nStarting from Green’s second identity for the Helmholtz operator and the fundamental solution (Green’s function) in two dimensions, derive the representation of the far-field scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the Kirchhoff–Helmholtz integral over the obstacle boundary $\\Gamma = \\{ \\mathbf{y} : |\\mathbf{y}| = a \\}$, in terms of the boundary traces $u(\\mathbf{y})$ and $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ of the scattered field and the asymptotic form of the two-dimensional Green’s function. Then, for the circular geometry, compute the boundary densities $u(\\mathbf{y})$ and $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ consistently with the sound-soft boundary condition by using a separation-of-variables solution in cylindrical coordinates. Use these boundary densities to evaluate the far-field scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ numerically via the Kirchhoff–Helmholtz integral.\n\nFinally, verify the principle of reciprocity for scalar acoustics in a reciprocal medium by demonstrating that the scattering amplitude satisfies $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$ for the circular sound-soft obstacle, and quantify the numerical deviation from exact reciprocity produced by your discretization.\n\nAll angles must be expressed in radians. The physical units must be as follows: radius $a$ in meters, speed of sound $c$ in meters per second, and frequency $f$ in Hertz; compute $k$ using $k = 2\\pi f / c$ with $k$ in inverse meters. Your program must:\n- Compute the scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the Kirchhoff–Helmholtz integral by numerically integrating around the circular boundary using a uniform trapezoidal rule with $N$ nodes.\n- Compute the exact far-field scattering amplitude using separation of variables for the sound-soft circular cylinder and use it as a reference.\n- For each test case, output two floating-point numbers: the absolute difference between the Kirchhoff–Helmholtz integral result and the exact reference, and the absolute difference $|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})|$ that quantifies reciprocity.\n\nUse the following test suite of parameter values, where each tuple is $(a, c, f, \\theta_{\\mathrm{i}}, \\theta_{\\mathrm{s}}, N)$:\n- Test case 1 (general case): $(0.5, 343.0, 1000.0, 0.7, 2.2, 256)$.\n- Test case 2 (small obstacle, low frequency): $(0.1, 343.0, 300.0, 0.0, 1.0, 128)$.\n- Test case 3 (coinciding angles boundary condition): $(0.3, 343.0, 800.0, 1.1, 1.1, 64)$.\n- Test case 4 (higher frequency, finer quadrature): $(0.7, 343.0, 1500.0, 1.3, -0.5, 512)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4},\\ldots]$), ordered by test case and with the two values for each test case placed consecutively. The outputs must be floating-point numbers in standard decimal notation.",
            "solution": "We begin with the scalar Helmholtz equation $\\Delta u(\\mathbf{x}) + k^{2} u(\\mathbf{x}) = 0$ in $\\mathbb{R}^{2} \\setminus \\overline{\\Omega}$ for the scattered field $u(\\mathbf{x})$, where $\\Omega$ is the circular obstacle of radius $a$, together with the Sommerfeld radiation condition. The sound-soft boundary condition on $\\Gamma = \\partial \\Omega$ is $u_{\\mathrm{tot}}(\\mathbf{y}) = u(\\mathbf{y}) + u_{\\mathrm{inc}}(\\mathbf{y}) = 0$ for all $\\mathbf{y} \\in \\Gamma$, which implies $u(\\mathbf{y}) = -u_{\\mathrm{inc}}(\\mathbf{y})$ on $\\Gamma$, while $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ must be consistent with the exterior solution of the Helmholtz equation.\n\nThe fundamental solution (Green’s function) in two dimensions for the Helmholtz operator is $G(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big)$, where $H_{\\nu}^{(1)}$ denotes the Hankel function of the first kind of order $\\nu$. Green’s second identity for two solutions $u$ and $G$ of the Helmholtz equation in a domain bounded by $\\Gamma$ yields the Kirchhoff–Helmholtz representation for $\\mathbf{x}$ exterior to $\\Gamma$,\n$$\nu(\\mathbf{x}) = \\int_{\\Gamma} \\left[ u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n(\\mathbf{y})} - \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} G(\\mathbf{x},\\mathbf{y}) \\right] \\, \\mathrm{d}s(\\mathbf{y}),\n$$\nwhere $\\partial/\\partial n(\\mathbf{y})$ denotes the outward normal derivative at $\\mathbf{y}$.\n\nTo derive the far-field pattern, we use the large-distance asymptotic of the Hankel function $H_{0}^{(1)}(k |\\mathbf{x} - \\mathbf{y}|)$ when $|\\mathbf{x}| = r \\to \\infty$ and $\\hat{\\mathbf{x}} = \\mathbf{x}/r$ fixed:\n$$\nH_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big),\n$$\nand\n$$\n\\frac{\\partial}{\\partial n(\\mathbf{y})} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim -i k \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big).\n$$\nSubstituting these into the Kirchhoff–Helmholtz representation gives the standard far-field form\n$$\nu(\\mathbf{x}) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\, F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}),\n$$\nwhere $\\theta_{\\mathrm{s}}$ is the observation angle such that $\\hat{\\mathbf{x}} = (\\cos \\theta_{\\mathrm{s}}, \\sin \\theta_{\\mathrm{s}})$, and the scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ is\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = \\int_{\\Gamma} \\left[ \\frac{k}{4} \\, u(\\mathbf{y}) \\, \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) - \\frac{i}{4} \\, \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} \\right] \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big) \\, \\mathrm{d}s(\\mathbf{y}).\n$$\n\nFor the circular obstacle of radius $a$, parametrize the boundary by $\\mathbf{y}(\\theta) = a (\\cos \\theta, \\sin \\theta)$ with $\\theta \\in [0, 2\\pi)$, outward normal $\\mathbf{n}(\\theta) = (\\cos \\theta, \\sin \\theta)$, and line element $\\mathrm{d}s = a \\, \\mathrm{d}\\theta$. The incident plane wave is $u_{\\mathrm{inc}}(r,\\phi) = \\exp\\!\\big(i k r \\cos(\\phi - \\theta_{\\mathrm{i}})\\big)$ in polar coordinates $(r,\\phi)$. The sound-soft boundary condition $u_{\\mathrm{tot}}(a,\\theta) = 0$ gives the scattered field boundary trace $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$. The normal derivative of the scattered field at $r = a$ is obtained from the separation-of-variables solution in cylindrical harmonics. One represents the scattered field for $r \\ge a$ by a radiating series\n$$\nu(r,\\theta) = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)}(k r) \\, e^{i n \\theta},\n$$\nand enforces $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta)$ by expanding the incident field using the Jacobi–Anger expansion, which leads to the Fourier coefficients\n$$\nA_{n} = - i^{n} \\, e^{-i n \\theta_{\\mathrm{i}}} \\, \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)},\n$$\nwhere $J_{n}$ is the Bessel function of the first kind of order $n$. Differentiating the series with respect to $r$ yields the normal derivative at the boundary\n$$\n\\left.\\frac{\\partial u}{\\partial n}\\right|_{r=a} = \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, k \\, \\frac{\\mathrm{d}}{\\mathrm{d}(k r)} H_{n}^{(1)}(k r) \\bigg|_{r=a} \\, e^{i n \\theta} = k \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)\\prime}(k a) \\, e^{i n \\theta},\n$$\nwhere $H_{n}^{(1)\\prime}$ denotes differentiation with respect to the argument.\n\nWith $u(a,\\theta)$ and $\\partial u/\\partial n (a,\\theta)$ known, the scattering amplitude becomes the boundary integral\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = a \\int_{0}^{2\\pi} \\left[ \\frac{k}{4} \\, u(a,\\theta) \\, \\cos(\\theta - \\theta_{\\mathrm{s}}) - \\frac{i}{4} \\, \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a,\\theta} \\right] \\exp\\!\\big(-i k a \\cos(\\theta - \\theta_{\\mathrm{s}})\\big) \\, \\mathrm{d}\\theta,\n$$\nwhich we evaluate numerically using the trapezoidal rule with $N$ equispaced points $\\theta_{j} = 2\\pi j / N$ for $j = 0,1,\\dots,N-1$.\n\nFor reference, the exact far-field scattering amplitude for the sound-soft circular cylinder is obtained by taking the large-distance asymptotics of $H_{n}^{(1)}(k r)$ in the series solution, producing\n$$\nF_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = -\\sum_{n=-\\infty}^{\\infty} \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)} \\, e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}.\n$$\nWe truncate all series to $|n| \\le N_{\\mathrm{m}}$, where $N_{\\mathrm{m}}$ is chosen adaptively as a function of $k a$ (for example, $N_{\\mathrm{m}} = \\lceil k a \\rceil + \\text{margin}$ with a modest margin) to reach numerical convergence.\n\nThe principle of reciprocity for scalar acoustics in reciprocal media states that the scattering amplitude satisfies $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$. For the circular sound-soft cylinder, the exact series expression $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ is manifestly symmetric in $(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ because $e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$ becomes $e^{i n (\\theta_{\\mathrm{i}} - \\theta_{\\mathrm{s}})}$ upon swapping, and the summation over all integer orders preserves equality. The Kirchhoff–Helmholtz integral computed with the correct boundary densities must therefore yield a numerically reciprocal result; any small discrepancy quantifies numerical error due to discretization and series truncation.\n\nAlgorithmic steps implemented in the program:\n- Compute $k = 2\\pi f / c$ and $k a$ for each test case.\n- Choose $N_{\\mathrm{m}}$ as an adaptive truncation level based on $k a$ to ensure accurate series sums.\n- Assemble $A_{n}$ for $n = -N_{\\mathrm{m}}, \\dots, N_{\\mathrm{m}}$ using $A_{n} = - i^{n} e^{-i n \\theta_{\\mathrm{i}}} J_{n}(k a) / H_{n}^{(1)}(k a)$, using parity relations $J_{-n}(x) = (-1)^{n} J_{n}(x)$ and $H_{-n}^{(1)}(x) = (-1)^{n} H_{n}^{(1)}(x)$ to avoid direct evaluation at negative orders.\n- Compute $\\partial u/\\partial r$ on the boundary via the truncated series $\\left.\\partial u/\\partial r\\right|_{r=a,\\theta} = k \\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} A_{n} H_{n}^{(1)\\prime}(k a) e^{i n \\theta}$.\n- Form $u(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$ and numerically integrate the Kirchhoff–Helmholtz expression for $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ over the boundary using $N$-point trapezoidal quadrature.\n- Compute $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the truncated series $-\\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} \\big[J_{n}(k a)/H_{n}^{(1)}(k a)\\big] e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$.\n- Report the absolute difference $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})\\big|$ and the reciprocity deviation $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})\\big|$ for each test case.\n\nThe output is a single line containing a comma-separated list of floating-point numbers enclosed in square brackets, with two numbers per test case ordered as specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, hankel1, h1vp\n\ndef compute_series_truncation(ka: float) -> int:\n    \"\"\"\n    Choose a truncation level for the cylindrical-harmonic series\n    based on ka to ensure accurate sums.\n    \"\"\"\n    # Rule of thumb: N_m ~ ka + margin; add extra safety for higher ka.\n    # Ensure at least a modest minimum.\n    return int(np.ceil(ka + 30.0)) if ka > 5.0 else int(np.ceil(ka + 20.0))\n\ndef parity_factor(n: int) -> int:\n    \"\"\"\n    Return (-1)^|n| for negative n, else 1.\n    \"\"\"\n    if n < 0:\n        return -1 if (abs(n) % 2 == 1) else 1\n    else:\n        return 1\n\ndef assemble_coeffs_A_and_derivs(k: float, a: float, theta_i: float, Nm: int):\n    \"\"\"\n    Assemble A_n and Hn'(ka) for n in [-Nm, ..., Nm] using parity relations.\n    Returns:\n        n_vals: array of integers of shape (2*Nm+1,)\n        A: complex array of shape (2*Nm+1,)\n        Hp: complex array of shape (2*Nm+1,) representing H_n^(1)'(ka)\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)                   # J_n(ka) for n >= 0\n    Habs = hankel1(orders, ka)              # H_n^(1)(ka) for n >= 0\n    Hpabs = h1vp(orders, ka)                # d/dx H_n^(1)(x) at x=ka, orders >= 0\n\n    n_vals = np.arange(-Nm, Nm + 1, dtype=int)\n    A = np.zeros_like(n_vals, dtype=np.complex128)\n    Hp = np.zeros_like(n_vals, dtype=np.complex128)\n\n    for idx, n in enumerate(n_vals):\n        m = abs(n)\n        s = parity_factor(n)  # parity factor for negative orders\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        Hpn = s * Hpabs[m]\n        A[idx] = - (1j ** n) * np.exp(-1j * n * theta_i) * (Jn / Hn)\n        Hp[idx] = Hpn\n\n    return n_vals, A, Hp\n\ndef du_dr_on_boundary(k: float, a: float, theta_i: float, thetas: np.ndarray, Nm: int) -> np.ndarray:\n    \"\"\"\n    Compute the normal derivative du/dr of the scattered field on r=a for all boundary angles 'thetas'.\n    Uses truncated series with coefficients A_n and H_n'(ka).\n    \"\"\"\n    n_vals, A, Hp = assemble_coeffs_A_and_derivs(k, a, theta_i, Nm)\n    # Build e^{i n theta} matrix: shape (num_n, num_theta)\n    exp_matrix = np.exp(1j * np.outer(n_vals, thetas))\n    # Sum over n: du/dr = k * sum_n A_n * Hn'(ka) * e^{i n theta}\n    du_dr = k * (A * Hp) @ exp_matrix\n    return du_dr  # shape (num_theta,)\n\ndef far_field_kirchhoff(a: float, k: float, theta_i: float, theta_s: float, N: int, Nm: int) -> complex:\n    \"\"\"\n    Evaluate the far-field scattering amplitude F(theta_s, theta_i) via the Kirchhoff–Helmholtz integral\n    around the circular boundary using N quadrature points and Nm series modes for du/dr.\n    \"\"\"\n    # Boundary parameterization\n    thetas = np.linspace(0.0, 2.0 * np.pi, N, endpoint=False)\n    dtheta = 2.0 * np.pi / N\n\n    # Scattered field on boundary for sound-soft: u(a, theta) = -u_inc(a, theta)\n    u_b = -np.exp(1j * k * a * np.cos(thetas - theta_i))\n\n    # Normal derivative of scattered field on boundary via series\n    du_dr_b = du_dr_on_boundary(k, a, theta_i, thetas, Nm)\n\n    # Observation direction unit vector dot normal: cos(theta - theta_s)\n    cos_term = np.cos(thetas - theta_s)\n    # Plane-wave-like factor from far-field asymptotic\n    phase_factor = np.exp(-1j * k * a * np.cos(thetas - theta_s))\n\n    # Integrand for F (amplitude compatible with 2D far-field scaling)\n    integrand = a * ((k / 4.0) * u_b * cos_term - (1j / 4.0) * du_dr_b) * phase_factor\n\n    # Trapezoidal rule over [0, 2pi]\n    F = np.sum(integrand) * dtheta\n    return F\n\ndef far_field_exact(a: float, k: float, theta_i: float, theta_s: float, Nm: int) -> complex:\n    \"\"\"\n    Compute the exact far-field scattering amplitude F(theta_s, theta_i) for a sound-soft circular cylinder\n    via truncated separation-of-variables series.\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)\n    Habs = hankel1(orders, ka)\n\n    # Sum over n from -Nm to Nm using parity to avoid direct negative-order evaluations\n    F = 0.0 + 0.0j\n    for n in range(-Nm, Nm + 1):\n        m = abs(n)\n        s = parity_factor(n)\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        term = - (Jn / Hn) * np.exp(1j * n * (theta_s - theta_i))\n        F += term\n    return F\n\ndef run_test_case(a: float, c: float, f: float, theta_i: float, theta_s: float, N: int):\n    \"\"\"\n    Run a single test case and return:\n    - amplitude error: |F_KI - F_exact|\n    - reciprocity error: |F_KI(theta_s, theta_i) - F_KI(theta_i, theta_s)|\n    \"\"\"\n    k = 2.0 * np.pi * f / c\n    ka = k * a\n    Nm = compute_series_truncation(ka)\n\n    F_KI = far_field_kirchhoff(a, k, theta_i, theta_s, N, Nm)\n    F_exact = far_field_exact(a, k, theta_i, theta_s, Nm)\n\n    # Reciprocity check\n    F_KI_swapped = far_field_kirchhoff(a, k, theta_s, theta_i, N, Nm)\n\n    amp_err = abs(F_KI - F_exact)\n    recip_err = abs(F_KI - F_KI_swapped)\n    return amp_err, recip_err\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (a, c, f, theta_i, theta_s, N)\n    test_cases = [\n        (0.5, 343.0, 1000.0, 0.7, 2.2, 256),\n        (0.1, 343.0, 300.0, 0.0, 1.0, 128),\n        (0.3, 343.0, 800.0, 1.1, 1.1, 64),\n        (0.7, 343.0, 1500.0, 1.3, -0.5, 512),\n    ]\n\n    results = []\n    for a, c, f, theta_i, theta_s, N in test_cases:\n        amp_err, recip_err = run_test_case(a, c, f, theta_i, theta_s, N)\n        results.append(amp_err)\n        results.append(recip_err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}