{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex wave phenomena, it is crucial to understand the fundamental mathematical properties of the governing equations. This exercise explores the subtle but critical issue of well-posedness that arises when solving the Poisson equation—the static limit ($k=0$) of the Helmholtz equation—with Neumann boundary conditions. By analyzing the compatibility conditions required for a solution to exist, you will uncover why the standard construction of a Green's function fails in this limit and learn the standard procedure to define a mathematically sound, reciprocal Neumann Green's function .",
            "id": "4125309",
            "problem": "Consider a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^d$ with $d \\in \\{2,3\\}$ and outward unit normal $\\mathbf{n}$ on $\\partial \\Omega$. In computational acoustics, frequency-domain pressure fields $p(\\mathbf{x})$ satisfy the inhomogeneous Helmholtz equation $(\\nabla^2 + k^2) p(\\mathbf{x}) = -s(\\mathbf{x})$ with boundary conditions modeling the interaction with surfaces. In the static limit $k=0$, this reduces to the Poisson equation $\\nabla^2 p(\\mathbf{x}) = -s(\\mathbf{x})$. The Neumann boundary condition $\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x})$ on $\\partial \\Omega$ corresponds to prescribing normal velocity at the boundary; in particular, a perfectly rigid boundary has homogeneous Neumann data $h(\\mathbf{x}) = 0$. A Green’s function for Neumann boundary conditions, denoted $G_N(\\mathbf{x},\\mathbf{y};k)$, is meant to represent the field at $\\mathbf{x}$ due to a unit source located at $\\mathbf{y}$, while satisfying $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};k) = 0$ on $\\partial \\Omega$.\n\nStarting from the governing equations and standard identities including the divergence theorem and Green’s identities, analyze the well-posedness of the Neumann problem at $k=0$ for sources $s(\\mathbf{x})$ and for the construction of $G_N(\\mathbf{x},\\mathbf{y};0)$. In particular, determine the compatibility conditions required for solvability, explain the non-uniqueness that arises, and outline a mathematically sound procedure to construct a reciprocal Neumann Green’s function in this static limit. Then, select all statements below that are correct.\n\nA. The solvability condition for the Neumann problem at $k=0$ is $\\int_{\\Omega} s(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x} = 0$. For the Neumann Green’s function at $k=0$, one must solve $\\nabla^2 G_N(\\mathbf{x},\\mathbf{y};0) = -\\delta(\\mathbf{x}-\\mathbf{y}) + \\frac{1}{|\\Omega|}$ in $\\Omega$ with $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0) = 0$ on $\\partial \\Omega$ and enforce the zero-mean constraint $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}\\mathbf{x} = 0$. This construction yields reciprocity $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$.\n\nB. At $k=0$, the Neumann problem is uniquely solvable for any sufficiently smooth source $s(\\mathbf{x})$ on any smooth bounded domain, and no additional constraints are needed.\n\nC. The correct constant to add in the source term to achieve solvability of the Neumann Green’s function at $k=0$ is $-\\frac{1}{|\\partial \\Omega|}$, and the appropriate constraint is to require $\\int_{\\partial \\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$.\n\nD. In the static limit $k=0$, reciprocity $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$ fails under Neumann boundary conditions because the Laplacian with homogeneous Neumann boundary condition is not self-adjoint.\n\nE. A valid alternative to enforcing a zero-mean constraint is to require zero total boundary flux $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$; this avoids adding any constant to the right-hand side in the Green’s function equation.",
            "solution": "The problem requires an analysis of the well-posedness of the Neumann problem for the Poisson equation ($\\nabla^2 p = -s$) in a bounded domain $\\Omega \\subset \\mathbb{R}^d$, which arises as the static limit ($k=0$) of the Helmholtz equation. We must determine the solvability conditions, explain the non-uniqueness, and detail the construction of a reciprocal Neumann Green's function $G_N(\\mathbf{x},\\mathbf{y};0)$.\n\nLet us first analyze the general Neumann problem for the Poisson equation:\n$$\n\\begin{cases}\n\\nabla^2 p(\\mathbf{x}) = -s(\\mathbf{x}) & \\text{for } \\mathbf{x} \\in \\Omega \\\\\n\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x}) & \\text{for } \\mathbf{x} \\in \\partial\\Omega\n\\end{cases}\n$$\nwhere $\\partial_{\\mathbf{n}}p = \\nabla p \\cdot \\mathbf{n}$ is the normal derivative on the boundary $\\partial\\Omega$.\n\n**1. Solvability Condition**\n\nTo find a condition for the existence of a solution $p(\\mathbf{x})$, we integrate the Poisson equation over the domain $\\Omega$:\n$$\n\\int_{\\Omega} \\nabla^2 p(\\mathbf{x}) \\,d\\mathbf{x} = -\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x}\n$$\nApplying the divergence theorem to the left-hand side gives:\n$$\n\\int_{\\Omega} \\nabla \\cdot (\\nabla p(\\mathbf{x})) \\,d\\mathbf{x} = \\int_{\\partial\\Omega} \\nabla p(\\mathbf{x}) \\cdot \\mathbf{n} \\,dS = \\int_{\\partial\\Omega} \\partial_{\\mathbf{n}} p(\\mathbf{x}) \\,dS\n$$\nEquating the two expressions and substituting the boundary condition $\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x})$, we obtain the compatibility condition:\n$$\n\\int_{\\partial\\Omega} h(\\mathbf{x}) \\,dS = -\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x}\n$$\nFor the specific case of homogeneous Neumann boundary conditions, where $h(\\mathbf{x}) = 0$ (e.g., a perfectly rigid boundary), this condition simplifies to:\n$$\n\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = 0\n$$\nThis means that for the homogeneous Neumann problem for the Poisson equation to have a solution, the total \"charge\" or source $s(\\mathbf{x})$ integrated over the domain must be zero.\n\n**2. Non-Uniqueness of the Solution**\n\nSuppose $p(\\mathbf{x})$ is a solution to the Neumann problem. Let's consider $p(\\mathbf{x}) + C$, where $C$ is an arbitrary constant.\n$\\nabla^2(p(\\mathbf{x}) + C) = \\nabla^2 p(\\mathbf{x}) + \\nabla^2 C = -s(\\mathbf{x}) + 0 = -s(\\mathbf{x})$.\n$\\partial_{\\mathbf{n}}(p(\\mathbf{x}) + C) = \\partial_{\\mathbf{n}} p(\\mathbf{x}) + \\partial_{\\mathbf{n}} C = h(\\mathbf{x}) + 0 = h(\\mathbf{x})$.\nThus, if a solution exists, it is only determined up to an additive constant. To obtain a unique solution, an additional constraint must be imposed. A common choice is to require the solution to have zero mean over the domain: $\\int_{\\Omega} p(\\mathbf{x}) \\,d\\mathbf{x} = 0$.\n\n**3. Construction of the Neumann Green's Function in the Static Limit**\n\nThe Neumann Green's function $G_N(\\mathbf{x},\\mathbf{y};0)$ (hereafter denoted $G_N(\\mathbf{x},\\mathbf{y})$) is formally the solution to:\n$$\n\\begin{cases}\n\\nabla_{\\mathbf{x}}^2 G_N(\\mathbf{x},\\mathbf{y}) = -\\delta(\\mathbf{x}-\\mathbf{y}) & \\text{in } \\Omega \\\\\n\\partial_{\\mathbf{n}_{\\mathbf{x}}} G_N(\\mathbf{x},\\mathbf{y}) = 0 & \\text{on } \\partial\\Omega\n\\end{cases}\n$$\nHere, the source term is $s(\\mathbf{x}) = \\delta(\\mathbf{x}-\\mathbf{y})$. Let's check the solvability condition for this problem, assuming $\\mathbf{y} \\in \\Omega$:\n$$\n\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = \\int_{\\Omega} \\delta(\\mathbf{x}-\\mathbf{y}) \\,d\\mathbf{x} = 1\n$$\nSince $1 \\neq 0$, the problem violates the compatibility condition and has no solution as stated. To remedy this, the source term must be modified to have a zero integral. We introduce a constant balancing term:\n$$\ns_{\\text{mod}}(\\mathbf{x}) = \\delta(\\mathbf{x}-\\mathbf{y}) + c_0\n$$\nTo satisfy $\\int_{\\Omega} s_{\\text{mod}}(\\mathbf{x}) \\,d\\mathbf{x} = 0$, we need:\n$$\n\\int_{\\Omega} (\\delta(\\mathbf{x}-\\mathbf{y}) + c_0) \\,d\\mathbf{x} = 1 + c_0 \\int_{\\Omega} d\\mathbf{x} = 1 + c_0 |\\Omega| = 0\n$$\nThis gives $c_0 = -1/|\\Omega|$, where $|\\Omega|$ is the volume (or area, for $d=2$) of the domain. The modified, solvable problem for the Green's function is:\n$$\n\\begin{cases}\n\\nabla_{\\mathbf{x}}^2 G_N(\\mathbf{x},\\mathbf{y}) = - \\left( \\delta(\\mathbf{x}-\\mathbf{y}) - \\frac{1}{|\\Omega|} \\right) & \\text{in } \\Omega \\\\\n\\partial_{\\mathbf{n}_{\\mathbf{x}}} G_N(\\mathbf{x},\\mathbf{y}) = 0 & \\text{on } \\partial\\Omega\n\\end{cases}\n$$\nThe solution to this problem is still non-unique up to an additive constant. To enforce uniqueness and, importantly, to obtain reciprocity, we impose the zero-mean constraint:\n$$\n\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}) \\,d\\mathbf{x} = 0\n$$\nThis procedure defines a unique, symmetric (reciprocal) modified Neumann Green's function.\n\nTo prove reciprocity, $G_N(\\mathbf{x},\\mathbf{y}) = G_N(\\mathbf{y},\\mathbf{x})$, we use Green's second identity for $u(\\mathbf{x}) = G_N(\\mathbf{x},\\mathbf{y}_1)$ and $v(\\mathbf{x}) = G_N(\\mathbf{x},\\mathbf{y}_2)$:\n$$\n\\int_{\\Omega} (u \\nabla^2 v - v \\nabla^2 u) \\,d\\mathbf{x} = \\int_{\\partial\\Omega} (u \\partial_{\\mathbf{n}} v - v \\partial_{\\mathbf{n}} u) \\,dS\n$$\nThe boundary integral vanishes because $\\partial_{\\mathbf{n}}u = 0$ and $\\partial_{\\mathbf{n}}v = 0$ on $\\partial\\Omega$. The volume integral becomes:\n$$\n\\int_{\\Omega} \\left[ G_N(\\mathbf{x},\\mathbf{y}_1) \\left(-\\delta(\\mathbf{x}-\\mathbf{y}_2) + \\frac{1}{|\\Omega|}\\right) - G_N(\\mathbf{x},\\mathbf{y}_2) \\left(-\\delta(\\mathbf{x}-\\mathbf{y}_1) + \\frac{1}{|\\Omega|}\\right) \\right] \\,d\\mathbf{x} = 0\n$$\n$$\n-G_N(\\mathbf{y}_2,\\mathbf{y}_1) + \\frac{1}{|\\Omega|}\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}_1) \\,d\\mathbf{x} + G_N(\\mathbf{y}_1,\\mathbf{y}_2) - \\frac{1}{|\\Omega|}\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}_2) \\,d\\mathbf{x} = 0\n$$\nApplying the zero-mean constraint $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{z}) \\,d\\mathbf{x} = 0$ for any $\\mathbf{z}$, the integral terms vanish, leaving:\n$$\n-G_N(\\mathbf{y}_2,\\mathbf{y}_1) + G_N(\\mathbf{y}_1,\\mathbf{y}_2) = 0 \\quad \\implies \\quad G_N(\\mathbf{y}_1,\\mathbf{y}_2) = G_N(\\mathbf{y}_2,\\mathbf{y}_1)\n$$\nThis confirms that the specified construction yields a reciprocal Green's function.\n\nNow we evaluate the given options.\n\n**A. The solvability condition for the Neumann problem at $k=0$ is $\\int_{\\Omega} s(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x} = 0$. For the Neumann Green’s function at $k=0$, one must solve $\\nabla^2 G_N(\\mathbf{x},\\mathbf{y};0) = -\\delta(\\mathbf{x}-\\mathbf{y}) + \\frac{1}{|\\Omega|}$ in $\\Omega$ with $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0) = 0$ on $\\partial \\Omega$ and enforce the zero-mean constraint $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}\\mathbf{x} = 0$. This construction yields reciprocity $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$.**\nThis statement accurately summarizes the entire derivation above. The solvability condition for the homogeneous Neumann problem is correct. The modified PDE for the Green's function is correct. The boundary condition is correct. The uniqueness constraint is a standard, valid choice. Finally, the conclusion that this construction leads to reciprocity is correct, as demonstrated.\n**Verdict: Correct**\n\n**B. At $k=0$, the Neumann problem is uniquely solvable for any sufficiently smooth source $s(\\mathbf{x})$ on any smooth bounded domain, and no additional constraints are needed.**\nThis statement is incorrect for two reasons. First, the problem is not solvable for \"any\" smooth source; the source must satisfy the compatibility condition $\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = 0$ (for homogeneous Neumann data). Second, even when a solution exists, it is not unique but is determined only up to an additive constant. Therefore, a constraint is required to enforce uniqueness.\n**Verdict: Incorrect**\n\n**C. The correct constant to add in the source term to achieve solvability of the Neumann Green’s function at $k=0$ is $-\\frac{1}{|\\partial \\Omega|}$, and the appropriate constraint is to require $\\int_{\\partial \\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$.**\nThis statement is incorrect. The constant is added to the source on the right-hand side of a volume differential equation, so its integral must balance the integral of the delta function over the volume $\\Omega$. As derived, the correct constant to add to $-\\delta(\\mathbf{x}-\\mathbf{y})$ is $1/|\\Omega|$, not $-1/|\\partial\\Omega|$ or any other form involving the surface measure $|\\partial\\Omega|$. The source distribution must have zero mean over the volume $\\Omega$.\n**Verdict: Incorrect**\n\n**D. In the static limit $k=0$, reciprocity $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$ fails under Neumann boundary conditions because the Laplacian with homogeneous Neumann boundary condition is not self-adjoint.**\nThis statement is incorrect. Reciprocity is a consequence of the self-adjoint nature of the governing differential operator and boundary conditions. The Laplacian operator $\\nabla^2$ on a domain of functions satisfying homogeneous Neumann conditions is indeed a self-adjoint (or more precisely, symmetric) operator on $L^2(\\Omega)$. As shown by Green's second identity, $\\langle \\nabla^2 u, v \\rangle = \\langle u, \\nabla^2 v \\rangle$ for all suitable $u, v$ in its domain. The challenge with the $k=0$ case is not a lack of self-adjointness but the existence of a non-trivial null space (constant functions), which corresponds to a zero-eigenvalue. By properly modifying the Green's function problem as described above, a reciprocal Green's function can be constructed.\n**Verdict: Incorrect**\n\n**E. A valid alternative to enforcing a zero-mean constraint is to require zero total boundary flux $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$; this avoids adding any constant to the right-hand side in the Green’s function equation.**\nThis statement is fundamentally flawed. The condition $\\partial_{\\mathbf{n}} G_N = 0$ is imposed at every point on the boundary, which is the definition of the Neumann Green's function. Consequently, its integral over the boundary, $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S$, is trivially zero. This is an identity, not a constraint that can be imposed to fix a problem. More importantly, it does not resolve the core solvability issue. Integrating the unmodified equation $\\nabla^2 G_N = -\\delta(\\mathbf{x}-\\mathbf{y})$ over $\\Omega$ and applying the divergence theorem leads to the contradiction $\\int_{\\partial\\Omega} \\partial_{\\mathbf{n}} G_N dS = -1$, which contradicts the boundary condition requiring the flux to be zero everywhere. The constant must be added to the right-hand side.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Building upon the theoretical foundations of well-posedness, this practice provides a concrete, constructive method for the Neumann Green's function in a bounded domain. You will use the powerful eigenfunction expansion technique to derive the Green's function for the Helmholtz equation inside a rectangular cavity, a canonical problem in acoustics . This hands-on derivation will require you to explicitly manage the contribution of the zero-frequency mode and will reveal how the symmetry of the Green's function, and thus the principle of reciprocity, naturally emerges from the self-adjoint nature of the underlying operator.",
            "id": "4125321",
            "problem": "Consider a three-dimensional rectangular acoustic cavity $\\Omega = (0,L_{x}) \\times (0,L_{y}) \\times (0,L_{z})$ filled with a homogeneous, lossless fluid. The cavity walls are perfectly rigid, implying homogeneous Neumann boundary conditions for the acoustic pressure. In the frequency domain, the acoustic pressure Green's function $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ for the Helmholtz operator satisfies the Partial Differential Equation (PDE)\n$$\n\\nabla^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) + k^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) = -\\delta(\\mathbf{r}-\\mathbf{r}'),\n$$\nwith the homogeneous Neumann boundary condition\n$$\n\\frac{\\partial G_{N}}{\\partial n}\\bigg|_{\\partial \\Omega} = 0,\n$$\nwhere $k>0$ is the wavenumber, $\\delta(\\mathbf{r}-\\mathbf{r}')$ is the Dirac delta distribution, and $\\partial/\\partial n$ denotes the outward normal derivative on the boundary $\\partial \\Omega$. Assume that $k^{2}$ is not equal to any nonzero Neumann Laplacian eigenvalue of $\\Omega$ so that the resolvent is well-defined.\n\nStarting from fundamental principles, namely the self-adjointness of the negative Laplacian with Neumann boundary conditions and the completeness and orthonormality of its eigenfunctions, construct the eigenfunction expansion for $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ in $\\Omega$. Identify the zero-eigenvalue (constant) mode explicitly, including its correct normalization, and use the principle of reciprocity to explain the symmetry $G_{N}(\\mathbf{r},\\mathbf{r}';k) = G_{N}(\\mathbf{r}',\\mathbf{r};k)$ in this setting.\n\nThen, analytically evaluate the double-volume average of the Neumann Green's function over both arguments:\n$$\n\\langle G_{N} \\rangle := \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}',\n$$\nwhere $V = L_{x} L_{y} L_{z}$ is the cavity volume. Your evaluation must isolate and quantify the contribution of the zero-frequency (constant) mode.\n\nProvide the final result for $\\langle G_{N} \\rangle$ as a single, closed-form analytic expression in terms of $L_{x}$, $L_{y}$, $L_{z}$, and $k$. Express the final answer in inverse meters. No numerical approximation is required.",
            "solution": "The Green's function $G_N(\\mathbf{r},\\mathbf{r}';k)$ is the solution to the inhomogeneous Helmholtz equation. Let $L = -\\nabla^2$ be the negative Laplacian operator. The PDE can be written as $(L - k^2)G_N(\\mathbf{r}, \\mathbf{r}'; k) = \\delta(\\mathbf{r}-\\mathbf{r}')$. The Green's function can be expanded in the complete, orthonormal basis of eigenfunctions of $L$ with homogeneous Neumann boundary conditions.\n\nFirst, we solve the eigenvalue problem $L\\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$, which is $-\\nabla^2 \\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$ in $\\Omega$, with the boundary condition $\\frac{\\partial \\psi}{\\partial n}|_{\\partial\\Omega} = 0$.\nUsing the method of separation of variables, we let $\\psi(x,y,z) = X(x)Y(y)Z(z)$. This leads to three ordinary differential equations:\n$$\n-X''(x) = k_x^2 X(x), \\quad -Y''(y) = k_y^2 Y(y), \\quad -Z''(z) = k_z^2 Z(z)\n$$\nwith boundary conditions $X'(0)=X'(L_x)=0$, $Y'(0)=Y'(L_y)=0$, and $Z'(0)=Z'(L_z)=0$. The eigenvalues are $\\lambda = k_x^2 + k_y^2 + k_z^2$.\nThe solutions satisfying these boundary conditions are of the form $\\cos(\\frac{n_x \\pi x}{L_x})$, $\\cos(\\frac{n_y \\pi y}{L_y})$, and $\\cos(\\frac{n_z \\pi z}{L_z})$, where $n_x, n_y, n_z$ are non-negative integers.\nThe eigenvalues are thus indexed by the triple integer $\\mathbf{n}=(n_x, n_y, n_z)$:\n$$\n\\lambda_{\\mathbf{n}} = k_{\\mathbf{n}}^2 = \\left(\\frac{n_x \\pi}{L_x}\\right)^2 + \\left(\\frac{n_y \\pi}{L_y}\\right)^2 + \\left(\\frac{n_z \\pi}{L_z}\\right)^2\n$$\nThe corresponding unnormalized eigenfunctions are $\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\cos(\\frac{n_x \\pi x}{L_x})\\cos(\\frac{n_y \\pi y}{L_y})\\cos(\\frac{n_z \\pi z}{L_z})$.\n\nThese eigenfunctions must be normalized such that $\\int_\\Omega \\psi_{\\mathbf{n}}(\\mathbf{r})^2 \\,d^3\\mathbf{r} = 1$. Let's compute the normalization integral:\n$$\n\\int_0^{L_x} \\cos^2\\left(\\frac{n_x \\pi x}{L_x}\\right)dx = \\begin{cases} L_x & \\text{if } n_x=0 \\\\ L_x/2 & \\text{if } n_x>0 \\end{cases}\n$$\nThe same applies to the $y$ and $z$ integrals. We define a factor $N_j$ as $N_j=1$ if $n_j=0$ and $N_j=2$ if $n_j>0$. The square of the normalization constant is given by:\n$$\nC_{\\mathbf{n}}^2 \\frac{L_x}{N_x} \\frac{L_y}{N_y} \\frac{L_z}{N_z} = 1 \\implies C_{\\mathbf{n}} = \\sqrt{\\frac{N_x N_y N_z}{V}}\n$$\nwhere $V=L_x L_y L_z$. The orthonormal eigenfunctions are:\n$$\n\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\sqrt{\\frac{N_x N_y N_z}{V}} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right)\\cos\\left(\\frac{n_y \\pi y}{L_y}\\right)\\cos\\left(\\frac{n_z \\pi z}{L_z}\\right)\n$$\nThe zero-eigenvalue mode corresponds to $\\mathbf{n}=(0,0,0)$. For this mode, $n_x=n_y=n_z=0$, so $N_x=N_y=N_z=1$ and $\\lambda_{\\mathbf{0}}=0$. The normalized eigenfunction is:\n$$\n\\psi_{\\mathbf{0}}(\\mathbf{r}) = \\sqrt{\\frac{1}{V}} \\cos(0)\\cos(0)\\cos(0) = \\frac{1}{\\sqrt{V}}\n$$\nThis is the constant mode.\n\nThe Green's function is given by the eigenfunction expansion for the operator $(k^2 - L)$:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\sum_{\\mathbf{n}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nThe sum runs over all non-negative integer triples $\\mathbf{n}=(n_x,n_y,n_z)$. We can separate the zero-eigenvalue mode from the sum:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{\\psi_{\\mathbf{0}}(\\mathbf{r})\\psi_{\\mathbf{0}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{0}}} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nSubstituting $\\psi_{\\mathbf{0}}(\\mathbf{r}) = 1/\\sqrt{V}$ and $\\lambda_{\\mathbf{0}}=0$:\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{(1/\\sqrt{V})(1/\\sqrt{V})}{k^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}} = \\frac{1}{Vk^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\nThis is the eigenfunction expansion of the Neumann Green's function, with the zero-mode contribution explicitly identified.\n\nThe principle of reciprocity, $G_N(\\mathbf{r},\\mathbf{r}';k) = G_N(\\mathbf{r}',\\mathbf{r};k)$, is a direct consequence of the structure of this expansion. The operator $L=-\\nabla^2$ with Neumann boundary conditions is self-adjoint, which guarantees that its eigenvalues $\\lambda_{\\mathbf{n}}$ are real and its eigenfunctions $\\psi_{\\mathbf{n}}(\\mathbf{r})$ can be chosen to be real. In the expansion, the term $\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')$ is manifestly symmetric with respect to an interchange of $\\mathbf{r}$ and $\\mathbf{r}'$. Since every term in the sum is symmetric, the entire sum, and thus the Green's function, is symmetric. This symmetry reflects the physical principle that the acoustic response at $\\mathbf{r}$ due to a source at $\\mathbf{r}'$ is the same as the response at $\\mathbf{r}'$ due to an identical source at $\\mathbf{r}$.\n\nNow, we evaluate the double-volume average:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\nSubstituting the eigenfunction expansion for $G_N$ and swapping the order of summation and integration:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\sum_{\\mathbf{n}} \\frac{1}{k^2 - \\lambda_{\\mathbf{n}}} \\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\nThe double integral can be separated into a product of two identical integrals:\n$$\n\\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}' = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right) \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}' \\right) = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\nLet's evaluate the integral $\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r}$. This integral is proportional to the inner product of $\\psi_{\\mathbf{n}}(\\mathbf{r})$ with the constant function $f(\\mathbf{r})=1$. Since the constant function is proportional to the zero-mode eigenfunction $\\psi_{\\mathbf{0}}(\\mathbf{r})$, the orthogonality of eigenfunctions implies this integral is zero for all $\\mathbf{n} \\neq \\mathbf{0}$.\nLet's verify this explicitly.\nFor $\\mathbf{n} = \\mathbf{0}$:\n$$\n\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\int_{\\Omega} \\frac{1}{\\sqrt{V}} \\, \\mathrm{d}^{3}\\mathbf{r} = \\frac{1}{\\sqrt{V}} V = \\sqrt{V}\n$$\nFor $\\mathbf{n} \\neq \\mathbf{0}$, at least one index $n_j$ (say $n_x$) is non-zero. The integral contains a factor:\n$$\n\\int_0^{L_x} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right) \\, dx = \\left[ \\frac{L_x}{n_x \\pi} \\sin\\left(\\frac{n_x \\pi x}{L_x}\\right) \\right]_0^{L_x} = 0 \\quad \\text{for } n_x > 0\n$$\nThis makes the entire volume integral zero for any $\\mathbf{n} \\neq \\mathbf{0}$.\nSo, $\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\sqrt{V} \\delta_{\\mathbf{n},\\mathbf{0}}$, where $\\delta_{\\mathbf{n},\\mathbf{0}}$ is the Kronecker delta.\n\nTherefore, in the summation for $\\langle G_{N} \\rangle$, all terms for $\\mathbf{n} \\neq \\mathbf{0}$ vanish. Only the term corresponding to the zero-frequency mode $\\mathbf{n}=\\mathbf{0}$ survives.\n\nThe contribution from the $\\mathbf{n}=\\mathbf{0}$ mode is:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2 - \\lambda_{\\mathbf{0}}} \\left( \\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\nSubstituting $\\lambda_{\\mathbf{0}}=0$ and $\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, d^3\\mathbf{r} = \\sqrt{V}$:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2} (\\sqrt{V})^2 = \\frac{1}{V^2} \\frac{V}{k^2} = \\frac{1}{Vk^2}\n$$\nThe entire contribution to the double-volume average comes from the zero-frequency (constant) mode.\nSubstituting $V = L_x L_y L_z$, we obtain the final expression:\n$$\n\\langle G_{N} \\rangle = \\frac{1}{L_x L_y L_z k^2}\n$$\nThe units are consistent with the request: $V$ has units of $[\\text{length}]^3$ and $k$ has units of $[\\text{length}]^{-1}$, so $Vk^2$ has units of $[\\text{length}]$. The final result $\\langle G_{N} \\rangle$ has units of $[\\text{length}]^{-1}$.",
            "answer": "$$ \\boxed{\\frac{1}{L_x L_y L_z k^2}} $$"
        },
        {
            "introduction": "This final practice bridges the gap between analytical theory and computational practice by applying Green's representation theorem to a classic wave scattering problem. You will implement the Kirchhoff-Helmholtz integral formula to compute the far-field scattering amplitude from an object and then use your code to numerically verify the principle of reciprocity, $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$ . This capstone exercise provides invaluable experience in translating formal integral equations into a working numerical model and using it to confirm that a fundamental physical law holds true in simulation.",
            "id": "4125280",
            "problem": "Consider two-dimensional time-harmonic acoustics in a homogeneous, isotropic, source-free exterior domain. The total acoustic pressure field $u_{\\mathrm{tot}}(\\mathbf{x})$ satisfies the scalar Helmholtz equation $\\Delta u_{\\mathrm{tot}}(\\mathbf{x}) + k^{2} u_{\\mathrm{tot}}(\\mathbf{x}) = 0$ for all observation points $\\mathbf{x}$ exterior to a sound-soft obstacle, with the Sommerfeld radiation condition holding at infinity. The obstacle is a circular cylinder of radius $a$ centered at the origin, with the sound-soft boundary condition $u_{\\mathrm{tot}}(\\mathbf{x}) = 0$ imposed for $|\\mathbf{x}| = a$. A unit-amplitude plane wave is incident from direction angle $\\theta_{\\mathrm{i}}$, written as $u_{\\mathrm{inc}}(\\mathbf{x}) = \\exp\\!\\big(i k \\, \\hat{\\mathbf{d}}_{\\mathrm{i}} \\cdot \\mathbf{x}\\big)$ where $\\hat{\\mathbf{d}}_{\\mathrm{i}} = (\\cos \\theta_{\\mathrm{i}}, \\sin \\theta_{\\mathrm{i}})$ and $k$ is the wavenumber. The scattered field is given by $u(\\mathbf{x}) = u_{\\mathrm{tot}}(\\mathbf{x}) - u_{\\mathrm{inc}}(\\mathbf{x})$ and obeys the same Helmholtz equation and radiation condition in the exterior.\n\nStarting from Green’s second identity for the Helmholtz operator and the fundamental solution (Green’s function) in two dimensions, derive the representation of the far-field scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the Kirchhoff–Helmholtz integral over the obstacle boundary $\\Gamma = \\{ \\mathbf{y} : |\\mathbf{y}| = a \\}$, in terms of the boundary traces $u(\\mathbf{y})$ and $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ of the scattered field and the asymptotic form of the two-dimensional Green’s function. Then, for the circular geometry, compute the boundary densities $u(\\mathbf{y})$ and $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ consistently with the sound-soft boundary condition by using a separation-of-variables solution in cylindrical coordinates. Use these boundary densities to evaluate the far-field scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ numerically via the Kirchhoff–Helmholtz integral.\n\nFinally, verify the principle of reciprocity for scalar acoustics in a reciprocal medium by demonstrating that the scattering amplitude satisfies $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$ for the circular sound-soft obstacle, and quantify the numerical deviation from exact reciprocity produced by your discretization.\n\nAll angles must be expressed in radians. The physical units must be as follows: radius $a$ in meters, speed of sound $c$ in meters per second, and frequency $f$ in Hertz; compute $k$ using $k = 2\\pi f / c$ with $k$ in inverse meters. Your program must:\n- Compute the scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the Kirchhoff–Helmholtz integral by numerically integrating around the circular boundary using a uniform trapezoidal rule with $N$ nodes.\n- Compute the exact far-field scattering amplitude using separation of variables for the sound-soft circular cylinder and use it as a reference.\n- For each test case, output two floating-point numbers: the absolute difference between the Kirchhoff–Helmholtz integral result and the exact reference, and the absolute difference $|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})|$ that quantifies reciprocity.\n\nUse the following test suite of parameter values, where each tuple is $(a, c, f, \\theta_{\\mathrm{i}}, \\theta_{\\mathrm{s}}, N)$:\n- Test case 1 (general case): $(0.5, 343.0, 1000.0, 0.7, 2.2, 256)$.\n- Test case 2 (small obstacle, low frequency): $(0.1, 343.0, 300.0, 0.0, 1.0, 128)$.\n- Test case 3 (coinciding angles boundary condition): $(0.3, 343.0, 800.0, 1.1, 1.1, 64)$.\n- Test case 4 (higher frequency, finer quadrature): $(0.7, 343.0, 1500.0, 1.3, -0.5, 512)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4},\\ldots]$), ordered by test case and with the two values for each test case placed consecutively. The outputs must be floating-point numbers in standard decimal notation.",
            "solution": "We begin with the scalar Helmholtz equation $\\Delta u(\\mathbf{x}) + k^{2} u(\\mathbf{x}) = 0$ in $\\mathbb{R}^{2} \\setminus \\overline{\\Omega}$ for the scattered field $u(\\mathbf{x})$, where $\\Omega$ is the circular obstacle of radius $a$, together with the Sommerfeld radiation condition. The sound-soft boundary condition on $\\Gamma = \\partial \\Omega$ is $u_{\\mathrm{tot}}(\\mathbf{y}) = u(\\mathbf{y}) + u_{\\mathrm{inc}}(\\mathbf{y}) = 0$ for all $\\mathbf{y} \\in \\Gamma$, which implies $u(\\mathbf{y}) = -u_{\\mathrm{inc}}(\\mathbf{y})$ on $\\Gamma$, while $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ must be consistent with the exterior solution of the Helmholtz equation.\n\nThe fundamental solution (Green’s function) in two dimensions for the Helmholtz operator is $G(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big)$, where $H_{\\nu}^{(1)}$ denotes the Hankel function of the first kind of order $\\nu$. Green’s second identity for two solutions $u$ and $G$ of the Helmholtz equation in a domain bounded by $\\Gamma$ yields the Kirchhoff–Helmholtz representation for $\\mathbf{x}$ exterior to $\\Gamma$,\n$$\nu(\\mathbf{x}) = \\int_{\\Gamma} \\left[ u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n(\\mathbf{y})} - \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} G(\\mathbf{x},\\mathbf{y}) \\right] \\, \\mathrm{d}s(\\mathbf{y}),\n$$\nwhere $\\partial/\\partial n(\\mathbf{y})$ denotes the outward normal derivative at $\\mathbf{y}$.\n\nTo derive the far-field pattern, we use the large-distance asymptotic of the Hankel function $H_{0}^{(1)}(k |\\mathbf{x} - \\mathbf{y}|)$ when $|\\mathbf{x}| = r \\to \\infty$ and $\\hat{\\mathbf{x}} = \\mathbf{x}/r$ fixed:\n$$\nH_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big),\n$$\nand\n$$\n\\frac{\\partial}{\\partial n(\\mathbf{y})} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim -i k \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big).\n$$\nSubstituting these into the Kirchhoff–Helmholtz representation gives the standard far-field form\n$$\nu(\\mathbf{x}) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\, F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}),\n$$\nwhere $\\theta_{\\mathrm{s}}$ is the observation angle such that $\\hat{\\mathbf{x}} = (\\cos \\theta_{\\mathrm{s}}, \\sin \\theta_{\\mathrm{s}})$, and the scattering amplitude $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ is\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = \\int_{\\Gamma} \\left[ \\frac{k}{4} \\, u(\\mathbf{y}) \\, \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) - \\frac{i}{4} \\, \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} \\right] \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big) \\, \\mathrm{d}s(\\mathbf{y}).\n$$\n\nFor the circular obstacle of radius $a$, parametrize the boundary by $\\mathbf{y}(\\theta) = a (\\cos \\theta, \\sin \\theta)$ with $\\theta \\in [0, 2\\pi)$, outward normal $\\mathbf{n}(\\theta) = (\\cos \\theta, \\sin \\theta)$, and line element $\\mathrm{d}s = a \\, \\mathrm{d}\\theta$. The incident plane wave is $u_{\\mathrm{inc}}(r,\\phi) = \\exp\\!\\big(i k r \\cos(\\phi - \\theta_{\\mathrm{i}})\\big)$ in polar coordinates $(r,\\phi)$. The sound-soft boundary condition $u_{\\mathrm{tot}}(a,\\theta) = 0$ gives the scattered field boundary trace $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$. The normal derivative of the scattered field at $r = a$ is obtained from the separation-of-variables solution in cylindrical harmonics. One represents the scattered field for $r \\ge a$ by a radiating series\n$$\nu(r,\\theta) = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)}(k r) \\, e^{i n \\theta},\n$$\nand enforces $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta)$ by expanding the incident field using the Jacobi–Anger expansion, which leads to the Fourier coefficients\n$$\nA_{n} = - i^{n} \\, e^{-i n \\theta_{\\mathrm{i}}} \\, \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)},\n$$\nwhere $J_{n}$ is the Bessel function of the first kind of order $n$. Differentiating the series with respect to $r$ yields the normal derivative at the boundary\n$$\n\\left.\\frac{\\partial u}{\\partial n}\\right|_{r=a} = \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, k \\, \\frac{\\mathrm{d}}{\\mathrm{d}(k r)} H_{n}^{(1)}(k r) \\bigg|_{r=a} \\, e^{i n \\theta} = k \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)\\prime}(k a) \\, e^{i n \\theta},\n$$\nwhere $H_{n}^{(1)\\prime}$ denotes differentiation with respect to the argument.\n\nWith $u(a,\\theta)$ and $\\partial u/\\partial n (a,\\theta)$ known, the scattering amplitude becomes the boundary integral\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = a \\int_{0}^{2\\pi} \\left[ \\frac{k}{4} \\, u(a,\\theta) \\, \\cos(\\theta - \\theta_{\\mathrm{s}}) - \\frac{i}{4} \\, \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a,\\theta} \\right] \\exp\\!\\big(-i k a \\cos(\\theta - \\theta_{\\mathrm{s}})\\big) \\, \\mathrm{d}\\theta,\n$$\nwhich we evaluate numerically using the trapezoidal rule with $N$ equispaced points $\\theta_{j} = 2\\pi j / N$ for $j = 0,1,\\dots,N-1$.\n\nFor reference, the exact far-field scattering amplitude for the sound-soft circular cylinder is obtained by taking the large-distance asymptotics of $H_{n}^{(1)}(k r)$ in the series solution, producing\n$$\nF_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = -\\sum_{n=-\\infty}^{\\infty} \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)} \\, e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}.\n$$\nWe truncate all series to $|n| \\le N_{\\mathrm{m}}$, where $N_{\\mathrm{m}}$ is chosen adaptively as a function of $k a$ (for example, $N_{\\mathrm{m}} = \\lceil k a \\rceil + \\text{margin}$ with a modest margin) to reach numerical convergence.\n\nThe principle of reciprocity for scalar acoustics in reciprocal media states that the scattering amplitude satisfies $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$. For the circular sound-soft cylinder, the exact series expression $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ is manifestly symmetric in $(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ because $e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$ becomes $e^{i n (\\theta_{\\mathrm{i}} - \\theta_{\\mathrm{s}})}$ upon swapping, and the summation over all integer orders preserves equality. The Kirchhoff–Helmholtz integral computed with the correct boundary densities must therefore yield a numerically reciprocal result; any small discrepancy quantifies numerical error due to discretization and series truncation.\n\nAlgorithmic steps implemented in the program:\n- Compute $k = 2\\pi f / c$ and $k a$ for each test case.\n- Choose $N_{\\mathrm{m}}$ as an adaptive truncation level based on $k a$ to ensure accurate series sums.\n- Assemble $A_{n}$ for $n = -N_{\\mathrm{m}}, \\dots, N_{\\mathrm{m}}$ using $A_{n} = - i^{n} e^{-i n \\theta_{\\mathrm{i}}} J_{n}(k a) / H_{n}^{(1)}(k a)$, using parity relations $J_{-n}(x) = (-1)^{n} J_{n}(x)$ and $H_{-n}^{(1)}(x) = (-1)^{n} H_{n}^{(1)}(x)$ to avoid direct evaluation at negative orders.\n- Compute $\\partial u/\\partial r$ on the boundary via the truncated series $\\left.\\partial u/\\partial r\\right|_{r=a,\\theta} = k \\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} A_{n} H_{n}^{(1)\\prime}(k a) e^{i n \\theta}$.\n- Form $u(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$ and numerically integrate the Kirchhoff–Helmholtz expression for $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ over the boundary using $N$-point trapezoidal quadrature.\n- Compute $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ via the truncated series $-\\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} \\big[J_{n}(k a)/H_{n}^{(1)}(k a)\\big] e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$.\n- Report the absolute difference $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})\\big|$ and the reciprocity deviation $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})\\big|$ for each test case.\n\nThe output is a single line containing a comma-separated list of floating-point numbers enclosed in square brackets, with two numbers per test case ordered as specified in the problem statement.```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, hankel1, h1vp\n\ndef compute_series_truncation(ka: float) -> int:\n    \"\"\"\n    Choose a truncation level for the cylindrical-harmonic series\n    based on ka to ensure accurate sums.\n    \"\"\"\n    # Rule of thumb: N_m ~ ka + margin; add extra safety for higher ka.\n    # Ensure at least a modest minimum.\n    return int(np.ceil(ka + 30.0)) if ka > 5.0 else int(np.ceil(ka + 20.0))\n\ndef parity_factor(n: int) -> int:\n    \"\"\"\n    Return (-1)^|n| for negative n, else 1.\n    \"\"\"\n    if n < 0:\n        return -1 if (abs(n) % 2 == 1) else 1\n    else:\n        return 1\n\ndef assemble_coeffs_A_and_derivs(k: float, a: float, theta_i: float, Nm: int):\n    \"\"\"\n    Assemble A_n and Hn'(ka) for n in [-Nm, ..., Nm] using parity relations.\n    Returns:\n        n_vals: array of integers of shape (2*Nm+1,)\n        A: complex array of shape (2*Nm+1,)\n        Hp: complex array of shape (2*Nm+1,) representing H_n^(1)'(ka)\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)                   # J_n(ka) for n >= 0\n    Habs = hankel1(orders, ka)              # H_n^(1)(ka) for n >= 0\n    Hpabs = h1vp(orders, ka)                # d/dx H_n^(1)(x) at x=ka, orders >= 0\n\n    n_vals = np.arange(-Nm, Nm + 1, dtype=int)\n    A = np.zeros_like(n_vals, dtype=np.complex128)\n    Hp = np.zeros_like(n_vals, dtype=np.complex128)\n\n    for idx, n in enumerate(n_vals):\n        m = abs(n)\n        s = parity_factor(n)  # parity factor for negative orders\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        Hpn = s * Hpabs[m]\n        A[idx] = - (1j ** n) * np.exp(-1j * n * theta_i) * (Jn / Hn)\n        Hp[idx] = Hpn\n\n    return n_vals, A, Hp\n\ndef du_dr_on_boundary(k: float, a: float, theta_i: float, thetas: np.ndarray, Nm: int) -> np.ndarray:\n    \"\"\"\n    Compute the normal derivative du/dr of the scattered field on r=a for all boundary angles 'thetas'.\n    Uses truncated series with coefficients A_n and H_n'(ka).\n    \"\"\"\n    n_vals, A, Hp = assemble_coeffs_A_and_derivs(k, a, theta_i, Nm)\n    # Build e^{i n theta} matrix: shape (num_n, num_theta)\n    exp_matrix = np.exp(1j * np.outer(n_vals, thetas))\n    # Sum over n: du/dr = k * sum_n A_n * Hn'(ka) * e^{i n theta}\n    du_dr = k * (A * Hp) @ exp_matrix\n    return du_dr  # shape (num_theta,)\n\ndef far_field_kirchhoff(a: float, k: float, theta_i: float, theta_s: float, N: int, Nm: int) -> complex:\n    \"\"\"\n    Evaluate the far-field scattering amplitude F(theta_s, theta_i) via the Kirchhoff–Helmholtz integral\n    around the circular boundary using N quadrature points and Nm series modes for du/dr.\n    \"\"\"\n    # Boundary parameterization\n    thetas = np.linspace(0.0, 2.0 * np.pi, N, endpoint=False)\n    dtheta = 2.0 * np.pi / N\n\n    # Scattered field on boundary for sound-soft: u(a, theta) = -u_inc(a, theta)\n    u_b = -np.exp(1j * k * a * np.cos(thetas - theta_i))\n\n    # Normal derivative of scattered field on boundary via series\n    du_dr_b = du_dr_on_boundary(k, a, theta_i, thetas, Nm)\n\n    # Observation direction unit vector dot normal: cos(theta - theta_s)\n    cos_term = np.cos(thetas - theta_s)\n    # Plane-wave-like factor from far-field asymptotic\n    phase_factor = np.exp(-1j * k * a * np.cos(thetas - theta_s))\n\n    # Integrand for F (amplitude compatible with 2D far-field scaling)\n    integrand = a * ((k / 4.0) * u_b * cos_term - (1j / 4.0) * du_dr_b) * phase_factor\n\n    # Trapezoidal rule over [0, 2pi]\n    F = np.sum(integrand) * dtheta\n    return F\n\ndef far_field_exact(a: float, k: float, theta_i: float, theta_s: float, Nm: int) -> complex:\n    \"\"\"\n    Compute the exact far-field scattering amplitude F(theta_s, theta_i) for a sound-soft circular cylinder\n    via truncated separation-of-variables series.\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)\n    Habs = hankel1(orders, ka)\n\n    # Sum over n from -Nm to Nm using parity to avoid direct negative-order evaluations\n    F = 0.0 + 0.0j\n    for n in range(-Nm, Nm + 1):\n        m = abs(n)\n        s = parity_factor(n)\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        term = - (Jn / Hn) * np.exp(1j * n * (theta_s - theta_i))\n        F += term\n    return F\n\ndef run_test_case(a: float, c: float, f: float, theta_i: float, theta_s: float, N: int):\n    \"\"\"\n    Run a single test case and return:\n    - amplitude error: |F_KI - F_exact|\n    - reciprocity error: |F_KI(theta_s, theta_i) - F_KI(theta_i, theta_s)|\n    \"\"\"\n    k = 2.0 * np.pi * f / c\n    ka = k * a\n    Nm = compute_series_truncation(ka)\n\n    F_KI = far_field_kirchhoff(a, k, theta_i, theta_s, N, Nm)\n    F_exact = far_field_exact(a, k, theta_i, theta_s, Nm)\n\n    # Reciprocity check\n    F_KI_swapped = far_field_kirchhoff(a, k, theta_s, theta_i, N, Nm)\n\n    amp_err = abs(F_KI - F_exact)\n    recip_err = abs(F_KI - F_KI_swapped)\n    return amp_err, recip_err\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (a, c, f, theta_i, theta_s, N)\n    test_cases = [\n        (0.5, 343.0, 1000.0, 0.7, 2.2, 256),\n        (0.1, 343.0, 300.0, 0.0, 1.0, 128),\n        (0.3, 343.0, 800.0, 1.1, 1.1, 64),\n        (0.7, 343.0, 1500.0, 1.3, -0.5, 512),\n    ]\n\n    results = []\n    for a, c, f, theta_i, theta_s, N in test_cases:\n        amp_err, recip_err = run_test_case(a, c, f, theta_i, theta_s, N)\n        results.append(amp_err)\n        results.append(recip_err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```",
            "answer": "[0.0001099863456885669,2.836171957449231e-15,3.901192804561579e-05,1.5238240093158976e-16,0.001646274431693751,0.0,0.00013580877960714785,1.408757049870129e-14]"
        }
    ]
}