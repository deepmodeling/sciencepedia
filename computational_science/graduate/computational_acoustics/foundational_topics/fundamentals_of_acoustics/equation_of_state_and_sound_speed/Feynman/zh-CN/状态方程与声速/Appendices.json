{
    "hands_on_practices": [
        {
            "introduction": "尽管声速的基本公式 $c = \\sqrt{\\gamma R T}$ 形式简单，但在大气声学等实际应用中，我们必须考虑环境参数的变化。本练习  将引导你使用国际标准大气（ISA）框架，构建一个对流层模型，从而推导出声速随高度变化的剖面，并量化湿度的重要影响。这是模拟远距离声传播的一项基本技能。",
            "id": "4122536",
            "problem": "您被要求在国际标准大气（ISA）条件下，使用热力学一致的状态方程和从第一性原理出发的声速定义，推导、实现并评估空气中的声速作为海拔高度的函数，然后系统地量化由湿度和可变气体成分引入的偏差。您的推导和实现必须仅从基本定律和定义开始，问题陈述中不提供任何捷径公式。该任务必须在标准温度直减率模型的对流层低层执行。\n\n要求和假设：\n- 在海拔高度范围 $0 \\le z \\le 11000$（单位为米）内工作，其中 ISA 采用恒定的温度直减率。\n- 使用静力平衡、理想气体行为和恒定熵下的声速热力学定义，推导干空气表达式及其湿空气扩展。\n- 将水蒸气建模为理想气体，将空气建模为干空气和水蒸气的二元理想气体混合物，其成分由相对湿度（RH）设定。\n- 使用经过良好测试的经验关系式计算水的饱和水汽压作为温度的函数。您可以选择一个与广泛使用标准精度相当的关系式；您的解决方案必须明确陈述并实现所选的关系式，并确保单位一致性。\n- 采用以下常数（视为经过良好测试的值）：\n  - 标准重力加速度 $g_0 = 9.80665$（单位 $\\mathrm{m/s^2}$）。\n  - 海平面温度 $T_0 = 288.15$（单位 $\\mathrm{K}$）。\n  - 海平面压力 $p_0 = 101325$（单位 $\\mathrm{Pa}$）。\n  - 对流层温度直减率 $L = -0.0065$（单位 $\\mathrm{K/m}$）。\n  - 干空气的比气体常数 $R_d = 287.052$（单位 $\\mathrm{J/(kg\\cdot K)}$）。\n  - 水蒸气的比气体常数 $R_v = 461.522$（单位 $\\mathrm{J/(kg\\cdot K)}$）。\n  - 干空气的定压比热 $c_{p,d} = 1004.685$（单位 $\\mathrm{J/(kg\\cdot K)}$）。\n  - 水蒸气的定压比热 $c_{p,v} = 1859.0$（单位 $\\mathrm{J/(kg\\cdot K)}$）。\n- 将注意力限制在 $z \\le 11000$，因此温度为 $T(z) = T_0 + L z$，压力是通过对干参考大气的理想气体行为进行静力平衡的一致积分得到的。\n\n任务：\n1. 从声速的热力学定义、理想气体状态方程、静力平衡和 ISA 温度结构出发，推导干空气中声速作为海拔高度 $z$（单位为米）的函数的表达式。最终声速以米/秒表示。\n2. 将推导扩展到干空气和水蒸气的湿润混合物，将两者均视为理想气体，并使用适用于比热和比气体常数的混合法则。使用相对湿度通过经验上准确的饱和水汽压关系式确定水蒸气分压。推导在海拔高度 $z$（米）和相对湿度 $\\mathrm{RH}$（$[0,1]$ 内的小数）下混合物的声速。最终声速以米/秒表示。\n3. 在一个完整的、可运行的程序中实现您的推导，该程序：\n   - 计算 $0 \\le z \\le 11000$ 的 ISA 温度 $T(z)$（开尔文）和压力 $p(z)$（帕斯卡）。\n   - 使用 Arden Buck 型或同等精度的关系式，根据温度（开尔文）计算水蒸气饱和水汽压 $e_s(T)$（帕斯卡），对于 $T \\ge 273.15\\,\\mathrm{K}$ 应用液态水上的关系式，对于 $T  273.15\\,\\mathrm{K}$ 应用冰上的关系式。\n   - 计算水汽分压 $e = \\mathrm{RH} \\cdot e_s(T)$（帕斯卡），并强制 $0 \\le e  p(z)$。\n   - 计算混合比 $r = \\epsilon \\, e/(p-e)$，其中 $\\epsilon = R_d/R_v$，以及质量分数 $Y_v = r/(1+r)$ 和 $Y_d = 1 - Y_v$。\n   - 计算混合物性质 $R_{\\mathrm{mix}} = Y_d R_d + Y_v R_v$，$c_{p,\\mathrm{mix}} = Y_d c_{p,d} + Y_v c_{p,v}$，和 $c_{v,\\mathrm{mix}} = c_{p,\\mathrm{mix}} - R_{\\mathrm{mix}}$，然后评估在 $(z,\\mathrm{RH})$ 条件下混合物中的声速。\n   - 使用相同 $T(z)$ 的干空气性质计算干空气声速。\n   - 对于每个测试用例，返回一个包含两个浮点数的列表：在指定的 $(z,\\mathrm{RH})$ 下的干空气声速和湿空气声速，单位均为 $\\mathrm{m/s}$，四舍五入到三位小数。\n\n物理单位和输出规范：\n- 海拔高度 $z$ 的单位是米。\n- 温度 $T$ 必须以开尔文计算。\n- 压力 $p$ 和所有分压必须以帕斯卡为单位。\n- 声速必须以 $\\mathrm{m/s}$ 表示，四舍五入到三位小数。\n- 相对湿度 $\\mathrm{RH}$ 必须是 $[0,1]$ 范围内的小数。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须为每个测试用例包含一个条目，其中每个条目是如上所述的双元素列表。例如，打印的输出应类似于 $[[c_{1,\\mathrm{dry}},c_{1,\\mathrm{humid}}],[c_{2,\\mathrm{dry}},c_{2,\\mathrm{humid}}],\\ldots]$，其中符号被数值替换。\n\n测试套件：\n使用上述模型和常数，评估以下测试用例，以检验正常操作、湿度极端情况和边界条件：\n- 案例 1：$z = 0$，$\\mathrm{RH} = 0.0$。\n- 案例 2：$z = 0$，$\\mathrm{RH} = 0.9$。\n- 案例 3：$z = 5000$，$\\mathrm{RH} = 1.0$。\n- 案例 4：$z = 11000$，$\\mathrm{RH} = 0.5$。\n\n您的程序必须计算并打印 $[[c_{1,\\mathrm{dry}},c_{1,\\mathrm{humid}}],[c_{2,\\mathrm{dry}},c_{2,\\mathrm{humid}}],[c_{3,\\mathrm{dry}},c_{3,\\mathrm{humid}}],[c_{4,\\mathrm{dry}},c_{4,\\mathrm{humid}}]]$，其中每个 $c$ 的单位为 $\\mathrm{m/s}$，四舍五入到三位小数。",
            "solution": "该问题被评估为有效，因为它具有科学依据、问题设定良好、客观，并包含了获得唯一解所需的所有信息。该问题要求基于热力学和流体力学的第一性原理，在国际标准大气（ISA）模型内，推导并实现干空气和湿空气中声速随海拔高度变化的函数。\n\n解决方案主要分为三个部分：\n1. 推导干空气中声速随海拔高度变化的函数。\n2. 推导 ISA 模型中的压力-海拔关系。\n3. 将推导扩展到湿空气，考虑混合效应。\n\n**1. 理想气体中的声速**\n\n声速 $c$ 被定义为无穷小压力扰动在介质中传播的速度。对于流体，它由等熵体积模量的平方根给出，表示为在恒定熵 $s$ 下压力对密度的偏导数：\n$$\nc^2 = \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_s\n$$\n对于理想气体，状态方程为 $p = \\rho R T$，其中 $p$ 是压力，$\\rho$ 是密度，$T$ 是绝对温度，$R$ 是比气体常数。\n理想气体的等熵过程（可逆且绝热）遵循关系式 $p \\rho^{-\\gamma} = \\text{constant}$，其中 $\\gamma = c_p/c_v$ 是热容比，$c_p$ 和 $c_v$ 分别是定压比热和定容比热。\n\n对于某个常数 $K$，从 $p = K \\rho^\\gamma$ 出发，我们可以求导：\n$$\n\\left(\\frac{\\partial p}{\\partial \\rho}\\right)_s = \\gamma K \\rho^{\\gamma-1} = \\gamma \\frac{p}{\\rho^\\gamma} \\rho^{\\gamma-1} = \\gamma \\frac{p}{\\rho}\n$$\n将此代入声速定义，并使用理想气体定律（$p/\\rho = RT$）：\n$$\nc^2 = \\gamma \\frac{p}{\\rho} = \\gamma R T\n$$\n因此，理想气体中的声速为：\n$$\nc = \\sqrt{\\gamma R T}\n$$\n这个基本结果表明，对于给定的理想气体（固定的 $\\gamma$ 和 $R$），声速仅取决于绝对温度 $T$。\n\n**2. 在 ISA 对流层中对干空气的应用**\n\n对于干空气，我们使用干空气的比气体常数 $R_d$ 和干空气的热容比 $\\gamma_d$。问题给出了 $R_d = 287.052 \\, \\mathrm{J/(kg\\cdot K)}$ 和定压比热 $c_{p,d} = 1004.685 \\, \\mathrm{J/(kg\\cdot K)}$。\n对于理想气体，迈耶关系成立：$c_{p,d} - c_{v,d} = R_d$。我们可以求出 $c_{v,d}$：\n$$\nc_{v,d} = c_{p,d} - R_d = 1004.685 - 287.052 = 717.633 \\, \\mathrm{J/(kg\\cdot K)}\n$$\n干空气的热容比为：\n$$\n\\gamma_d = \\frac{c_{p,d}}{c_{v,d}} = \\frac{1004.685}{717.633} \\approx 1.4000\n$$\n国际标准大气（ISA）模型在对流层（海拔 $z \\le 11000 \\, \\mathrm{m}$）中定义了一个线性温度廓线：\n$$\nT(z) = T_0 + L z\n$$\n其中 $T_0 = 288.15 \\, \\mathrm{K}$ 是海平面温度，$L = -0.0065 \\, \\mathrm{K/m}$ 是对流层温度直减率。\n因此，干空气中声速随海拔高度 $z$ 的函数为：\n$$\nc_d(z) = \\sqrt{\\gamma_d R_d T(z)} = \\sqrt{\\gamma_d R_d (T_0 + L z)}\n$$\n\n**3. ISA 压力廓线**\n\n为了分析湿空气，我们需要总大气压力 $p(z)$。这可以通过积分静力平衡方程得到，假设大气处于平衡状态：\n$$\n\\frac{dp}{dz} = -\\rho g_0\n$$\n其中 $g_0 = 9.80665 \\, \\mathrm{m/s^2}$ 是标准重力加速度。ISA 模型使用干空气状态方程 $\\rho = p/(R_d T)$ 来定义参考压力廓线。将此式和温度廓线 $T(z) = T_0 + Lz$ 代入静力平衡方程：\n$$\n\\frac{dp}{dz} = - \\frac{p g_0}{R_d (T_0 + L z)} \\implies \\frac{dp}{p} = -\\frac{g_0}{R_d L} \\frac{L \\, dz}{T_0 + L z}\n$$\n从海平面（$z=0$, $p=p_0=101325 \\, \\mathrm{Pa}$）积分到海拔高度 $z$：\n$$\n\\int_{p_0}^{p(z)} \\frac{dp'}{p'} = -\\frac{g_0}{R_d L} \\int_0^z \\frac{L \\, dz'}{T_0 + L z'}\n$$\n$$\n\\ln\\left(\\frac{p(z)}{p_0}\\right) = -\\frac{g_0}{R_d L} \\ln\\left(\\frac{T_0 + L z}{T_0}\\right) = \\ln\\left[ \\left(\\frac{T(z)}{T_0}\\right)^{-g_0 / (R_d L)} \\right]\n$$\n这就得到了对流层的标准 ISA 压力-海拔关系：\n$$\np(z) = p_0 \\left( \\frac{T(z)}{T_0} \\right)^{-g_0 / (R_d L)} = p_0 \\left(1 + \\frac{L z}{T_0}\\right)^{-g_0 / (R_d L)}\n$$\n\n**4. 湿空气中的声速**\n\n湿空气是干空气和水蒸气的混合物。我们将其建模为二元理想气体混合物。混合物中的声速由 $c_h = \\sqrt{\\gamma_{\\mathrm{mix}} R_{\\mathrm{mix}} T(z)}$ 给出。我们必须确定混合物性质 $R_{\\mathrm{mix}}$ 和 $\\gamma_{\\mathrm{mix}}$。\n\n混合物的成分由相对湿度 $\\mathrm{RH}$ 决定，它将水蒸气分压 $e$ 与饱和水汽压 $e_s(T)$ 联系起来：\n$$\ne = \\mathrm{RH} \\cdot e_s(T)\n$$\n饱和水汽压 $e_s$ 是温度的强函数。根据问题规范，我们使用一个精确的 Arden Buck 型经验关系式。选择 1996 年的 Buck 方程是因为其准确性。压力单位为帕斯卡，温度 $T$ 单位为开尔文。设 $T_C = T - 273.15$ 为摄氏温度。\n\n对于 $T \\ge 273.15 \\, \\mathrm{K}$（液态水上的饱和）：\n$$\ne_s(T) = 611.21 \\exp \\left( \\frac{(18.678 - T_C/234.5) T_C}{T_C + 257.14} \\right)\n$$\n对于 $T  273.15 \\, \\mathrm{K}$（冰上的饱和）：\n$$\ne_s(T) = 611.15 \\exp \\left( \\frac{(23.036 - T_C/333.7) T_C}{T_C + 279.82} \\right)\n$$\n干空气的分压是 $p_d = p(z) - e$。我们定义混合比 $r$，即水蒸气质量与干空气质量之比：\n$$\nr = \\frac{m_v}{m_d} = \\frac{\\rho_v}{\\rho_d} = \\frac{e/(R_v T)}{(p_d)/(R_d T)} = \\frac{e/(R_v T)}{(p-e)/(R_d T)} = \\frac{R_d}{R_v} \\frac{e}{p-e}\n$$\n令 $\\epsilon = R_d/R_v = 287.052 / 461.522 \\approx 0.622$，我们有 $r = \\epsilon \\frac{e}{p-e}$。\n\n水蒸气（$Y_v$）和干空气（$Y_d$）的质量分数为：\n$$\nY_v = \\frac{m_v}{m_d + m_v} = \\frac{m_v/m_d}{1 + m_v/m_d} = \\frac{r}{1+r}\n$$\n$$\nY_d = \\frac{m_d}{m_d + m_v} = \\frac{1}{1 + m_v/m_d} = \\frac{1}{1+r} = 1 - Y_v\n$$\n混合物性质通过质量分数加权得到：\n$$\nR_{\\mathrm{mix}} = Y_d R_d + Y_v R_v\n$$\n$$\nc_{p,\\mathrm{mix}} = Y_d c_{p,d} + Y_v c_{p,v}\n$$\n其中给定了 $R_v = 461.522 \\, \\mathrm{J/(kg\\cdot K)}$ 和 $c_{p,v} = 1859.0 \\, \\mathrm{J/(kg\\cdot K)}$。\n对混合物使用迈耶关系，$c_{v,\\mathrm{mix}} = c_{p,\\mathrm{mix}} - R_{\\mathrm{mix}}$。混合物的热容比为：\n$$\n\\gamma_{\\mathrm{mix}} = \\frac{c_{p,\\mathrm{mix}}}{c_{v,\\mathrm{mix}}} = \\frac{c_{p,\\mathrm{mix}}}{c_{p,\\mathrm{mix}} - R_{\\mathrm{mix}}}\n$$\n最后，在海拔高度 $z$ 和相对湿度 $\\mathrm{RH}$ 下，湿空气中的声速为：\n$$\nc_h(z, \\mathrm{RH}) = \\sqrt{\\gamma_{\\mathrm{mix}} R_{\\mathrm{mix}} T(z)}\n$$\n该表达式以及前面的步骤，为计算提供了完整的模型。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the speed of sound in dry and humid air under ISA conditions\n    based on derivations from first principles.\n    \"\"\"\n\n    # --- Givens: Constants and ISA Parameters ---\n    g0 = 9.80665      # Standard gravitational acceleration [m/s^2]\n    T0 = 288.15       # Sea-level standard temperature [K]\n    p0 = 101325.0     # Sea-level standard pressure [Pa]\n    L = -0.0065       # Tropospheric lapse rate [K/m]\n    R_d = 287.052     # Specific gas constant for dry air [J/(kg.K)]\n    R_v = 461.522     # Specific gas constant for water vapor [J/(kg.K)]\n    cp_d = 1004.685   # Constant-pressure specific heat for dry air [J/(kg.K)]\n    cp_v = 1859.0     # Constant-pressure specific heat for water vapor [J/(kg.K)]\n    \n    # --- Derived Dry Air Properties ---\n    # Heat capacity at constant volume for dry air\n    cv_d = cp_d - R_d\n    # Heat capacity ratio for dry air\n    gamma_d = cp_d / cv_d\n    \n    # --- Helper Functions ---\n    def get_isa_temp(z):\n        \"\"\"Computes ISA temperature at altitude z.\"\"\"\n        return T0 + L * z\n\n    def get_isa_pressure(z, temp):\n        \"\"\"Computes ISA pressure at altitude z.\"\"\"\n        # This formula is only valid for L != 0\n        return p0 * (temp / T0)**(-g0 / (R_d * L))\n\n    def get_saturation_vapor_pressure(T):\n        \"\"\"\n        Computes saturation vapor pressure using the Arden Buck (1996) equations.\n        T is temperature in Kelvin. Returns pressure in Pascals.\n        \"\"\"\n        T_C = T - 273.15  # Temperature in Celsius\n\n        if T_C = 0:\n            # Saturation vapor pressure over liquid water\n            es = 611.21 * np.exp((18.678 - T_C / 234.5) * (T_C / (257.14 + T_C)))\n        else:\n            # Saturation vapor pressure over ice\n            es = 611.15 * np.exp((23.036 - T_C / 333.7) * (T_C / (279.82 + T_C)))\n        return es\n\n    def calculate_sound_speeds(z, RH):\n        \"\"\"\n        Calculates and returns the speed of sound for dry and humid air.\n        z: altitude [m]\n        RH: relative humidity [0, 1]\n        \"\"\"\n        # --- ISA Conditions at Altitude z ---\n        T_z = get_isa_temp(z)\n        p_z = get_isa_pressure(z, T_z)\n\n        # --- Task 1: Dry Air Sound Speed ---\n        c_dry = np.sqrt(gamma_d * R_d * T_z)\n        \n        # --- Task 2: Humid Air Sound Speed ---\n        if RH == 0.0:\n            c_humid = c_dry\n        else:\n            # Calculate vapor pressure\n            e_s = get_saturation_vapor_pressure(T_z)\n            e = RH * e_s\n            \n            # Constraint check: vapor pressure cannot exceed total pressure\n            if e = p_z:\n                # This physical state implies 100% water vapor or supersaturation\n                # in a way that displaces all air, which is not the model's intent.\n                # For this problem, we cap 'e' to be slightly less than 'p_z'\n                # to avoid division by zero, though test cases do not trigger this.\n                e = p_z * 0.999999\n\n            # Calculate mixing ratio\n            epsilon = R_d / R_v\n            # Avoid division by zero if p_z == e\n            if p_z - e == 0:\n                # Under this extreme, physically unlikely condition, the atmosphere is \n                # pure water vapor. We'll model it as such.\n                r = np.inf\n            else:\n                r = epsilon * e / (p_z - e)\n\n            # Calculate mass fractions\n            if np.isinf(r):\n                Y_v = 1.0\n            else:\n                Y_v = r / (1.0 + r)\n            Y_d = 1.0 - Y_v\n\n            # Calculate mixture properties\n            R_mix = Y_d * R_d + Y_v * R_v\n            cp_mix = Y_d * cp_d + Y_v * cp_v\n            cv_mix = cp_mix - R_mix\n            gamma_mix = cp_mix / cv_mix\n            \n            c_humid = np.sqrt(gamma_mix * R_mix * T_z)\n            \n        return [round(c_dry, 3), round(c_humid, 3)]\n\n    # --- Test Suite ---\n    test_cases = [\n        (0.0, 0.0),       # Case 1: z = 0, RH = 0.0\n        (0.0, 0.9),       # Case 2: z = 0, RH = 0.9\n        (5000.0, 1.0),    # Case 3: z = 5000, RH = 1.0\n        (11000.0, 0.5)    # Case 4: z = 11000, RH = 0.5\n    ]\n\n    results = []\n    for z, RH in test_cases:\n        result = calculate_sound_speeds(z, RH)\n        results.append(result)\n\n    # --- Print Final Output ---\n    # The str() of a list is used to get the inner bracket formatting.\n    # The top-level format is a string of these list strings, comma-separated.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "并非所有数学上成立的状态方程（EOS）都具有物理意义。为了让介质能够支持声波传播，它必须是力学稳定的，即它会抵抗压缩。本练习  深入探讨了这一基本要求，要求你从第一性原理出发，为一般化的状态方程推导出力学稳定性的普适条件（$c^2  0$），并编写一个计算测试来筛选出非物理的参数集。这是开发稳健数值模拟程序的关键一步。",
            "id": "4122520",
            "problem": "在计算声学中，考虑一个物理要求：力学稳定介质必须具有严格为正的等熵体积模量，这等同于严格为正的声速平方。负可压缩性状态是力学不稳定的，因此是不可接受的。仅从基本的热力学定义和定律出发，推导出一个可计算的测试方法。对于给定的参数化状态方程（equation of state, EOS），该测试能够拒绝任何在任何容许热力学状态下产生非正声速平方的参数集。\n\n您将使用以下形式的参数化压力定律：\n$$\np(\\rho,e;\\theta) = (\\gamma - 1)\\,\\rho\\,e \\;-\\; \\gamma\\,p_{\\infty} \\;+\\; K\\Big[\\Big(\\frac{\\rho}{\\rho_{\\mathrm{ref}}}\\Big)^{m} - 1\\Big],\n$$\n其中参数矢量为 $\\theta = (\\gamma,p_{\\infty},K,m)$，密度为 $\\rho$，比内能为 $e$。所有量都必须在国际单位制（SI）下解释：$\\rho$ 的单位是 $\\mathrm{kg/m^3}$，$e$ 是 $\\mathrm{J/kg}$，$p$ 是 $\\mathrm{Pa}$，$p_{\\infty}$ 是 $\\mathrm{Pa}$，$K$ 是 $\\mathrm{Pa}$，以及 $\\rho_{\\mathrm{ref}}$ 是 $\\mathrm{kg/m^3}$。声速满足核心声学定义\n$$\nc^2 = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{s},\n$$\n并且热力学提供了微分形式的第一定律\n$$\n\\mathrm{d}e = T\\,\\mathrm{d}s + \\frac{p}{\\rho^2}\\,\\mathrm{d}\\rho,\n$$\n其中 $T$ 是温度，$s$ 是熵。在推导过程中，不应假设任何额外的简化公式。\n\n容许状态被限制在矩形集合中\n$$\n\\rho \\in [\\rho_{\\min},\\rho_{\\max}],\\quad e \\in [e_{\\min},e_{\\max}],\n$$\n具有固定值\n$$\n\\rho_{\\mathrm{ref}} = 1000\\,\\mathrm{kg/m^3},\\quad \\rho_{\\min} = 800\\,\\mathrm{kg/m^3},\\quad \\rho_{\\max} = 1400\\,\\mathrm{kg/m^3},\n$$\n和\n$$\ne_{\\min} = 1.0\\times 10^{6}\\,\\mathrm{J/kg},\\quad e_{\\max} = 5.0\\times 10^{6}\\,\\mathrm{J/kg}.\n$$\n\n任务 1（推导）：从上述两个基本关系出发，推导出一个用 $\\rho$、$e$ 以及 $p(\\rho,e;\\theta)$ 分别在 $e$ 固定和 $\\rho$ 固定时对 $\\rho$ 和 $e$ 的偏导数表示的 $c^2$ 的可计算表达式。证明在容许集合上严格为正的 $c^2$ 为何等同于严格为正的等熵体积模量，并因此等同于正的可压缩性。\n\n任务 2（算法设计）：使用您推导的表达式，设计一个算法。该算法给定一个参数集 $\\theta$，在一个包含容许矩形边界的均匀张量网格上评估 $c^2(\\rho,e;\\theta)$，检测在任何采样状态下是否存在 $c^2 \\le 0$ 的情况，并返回一个表示拒绝的布尔值（当且仅当存在至少一个采样状态满足 $c^2 \\le 0$ 时，返回 $\\,\\mathrm{True}\\,$）。\n\n使用一个均匀网格，在 $\\rho$ 和 $e$ 方向上分别有\n$$\nN_{\\rho} = 129,\\quad N_{e} = 129\n$$\n个点，覆盖闭区间 $[\\rho_{\\min},\\rho_{\\max}]$ 和 $[e_{\\min},e_{\\max}]$。\n\n测试套件：将您的算法应用于以下五个参数集 $\\theta_k = (\\gamma,p_{\\infty},K,m)$，$k \\in \\{1,2,3,4,5\\}$：\n- $\\theta_1 = (4.4,\\;6.0\\times 10^{8}\\,\\mathrm{Pa},\\;1.0\\times 10^{9}\\,\\mathrm{Pa},\\;2.0)$,\n- $\\theta_2 = (0.8,\\;1.0\\times 10^{5}\\,\\mathrm{Pa},\\;0.0\\,\\mathrm{Pa},\\;2.0)$,\n- $\\theta_3 = (2.0,\\;1.0\\times 10^{5}\\,\\mathrm{Pa},\\;-1.0\\times 10^{9}\\,\\mathrm{Pa},\\;2.0)$,\n- $\\theta_4 = (1.0001,\\;0.0\\,\\mathrm{Pa},\\;0.0\\,\\mathrm{Pa},\\;2.0)$,\n- $\\theta_5 = (1.4,\\;0.0\\,\\mathrm{Pa},\\;1.0\\times 10^{7}\\,\\mathrm{Pa},\\;1.1)$.\n\n您的程序必须：\n- 仅使用 $p(\\rho,e;\\theta)$ 分别在 $e$ 固定和 $\\rho$ 固定时对 $\\rho$ 和 $e$ 的偏导数，实现推导出的 $c^2(\\rho,e;\\theta)$ 公式。\n- 在指定的网格上对容许集合进行采样，并对每个 $\\theta_k$ 判断是否存在任何采样点 $(\\rho,e)$ 满足 $c^2 \\le 0$。\n- 生成一行输出，其中包含 $k=1,2,3,4,5$ 的结果，形式为方括号内以逗号分隔的布尔值列表，条目顺序与上面给出的参数集顺序一致。例如，一个包含五个布尔值结果的输出必须看起来像\n$$\n[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{True},\\mathrm{False}],\n$$\n但使用您的程序计算出的实际值。由于答案是布尔值，输出中不需要单位。\n\n科学真实性和单位：所有常量和参数值均采用国际单位制（SI），您的实现必须在内部遵守这些单位。分析和算法必须普遍适用且与具体编程语言无关；但是，您的最终答案必须是下面指定的完整且可运行的 Python 程序。",
            "solution": "用户提供了一个计算声学问题，要求推导一个稳定性判据并设计一个计算算法来测试它。该问题定义明确，有科学依据，并包含了所有必要的信息。\n\n### 任务 1：推导与证明\n\n第一个任务是推导声速平方 $c^2$ 的可计算表达式，并证明稳定性判据 $c^2  0$ 的合理性。\n\n**$c^2$ 表达式的推导**\n\n我们的任务是找到声速平方的表达式，其定义为压力对密度的等熵导数：\n$$\nc^2 = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{s}\n$$\n所提供的状态方程（EOS）给出了压力 $p$ 作为密度 $\\rho$ 和比内能 $e$ 的函数，即 $p = p(\\rho, e)$。此状态方程的“自然”变量是 $\\rho$ 和 $e$。因此，我们的目标是用在恒定能量 $e$ 和恒定密度 $\\rho$ 下的偏导数（分别为 $(\\partial p/\\partial \\rho)_e$ 和 $(\\partial p/\\partial e)_\\rho$）来表示在恒定熵 $s$ 下的导数 $(\\partial p/\\partial \\rho)_s$。\n\n我们从压力 $p(\\rho, e)$ 的全微分开始：\n$$\n\\mathrm{d}p = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} \\mathrm{d}\\rho + \\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho} \\mathrm{d}e\n$$\n接下来，我们使用所提供的微分形式的热力学第一定律：\n$$\n\\mathrm{d}e = T\\,\\mathrm{d}s + \\frac{p}{\\rho^2}\\,\\mathrm{d}\\rho\n$$\n其中 $T$ 是温度，$s$ 是比熵。此方程将微分 $\\mathrm{d}e$ 与微分 $\\mathrm{d}s$ 和 $\\mathrm{d}\\rho$ 联系起来。\n\n我们可以将第一定律中 $\\mathrm{d}e$ 的表达式代入 $p$ 的全微分中：\n$$\n\\mathrm{d}p = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} \\mathrm{d}\\rho + \\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho} \\bigg(T\\,\\mathrm{d}s + \\frac{p}{\\rho^2}\\,\\mathrm{d}\\rho\\bigg)\n$$\n现在，我们按微分 $\\mathrm{d}\\rho$ 和 $\\mathrm{d}s$ 对各项进行分组：\n$$\n\\mathrm{d}p = \\left[ \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} + \\frac{p}{\\rho^2}\\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho} \\right] \\mathrm{d}\\rho + \\left[ T\\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho} \\right] \\mathrm{d}s\n$$\n这个表达式是压力 $p$ 关于 $\\rho$ 和 $s$ 的全微分，即 $p(\\rho, s)$。根据定义，$p$ 在 $s$ 恒定时对 $\\rho$ 的偏导数是 $\\mathrm{d}s=0$ 时 $\\mathrm{d}\\rho$ 项的系数。从上面的方程可知，这个系数是：\n$$\n\\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{s} = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} + \\frac{p}{\\rho^2}\\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho}\n$$\n因此，声速平方的可计算表达式为：\n$$\nc^2 = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} + \\frac{p}{\\rho^2}\\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho}\n$$\n此表达式仅依赖于 $p$、$\\rho$ 以及给定状态方程 $p(\\rho, e)$ 对其自然变量的偏导数。\n\n**力学稳定性的证明**\n\n如果一个介质能够抵抗压缩，即压力的无穷小增加导致体积的无穷小减小（从而密度增加），则认为该介质是力学稳定的。衡量这种抵抗能力的量是体积模量。对于像声波传播这样足够快的过程，相关的量是等熵体积模量 $K_s$。其定义为：\n$$\nK_s = -V \\Big(\\frac{\\partial p}{\\partial V}\\Big)_s\n$$\n其中 $V$ 是体积。为了力学稳定性，介质在被压缩时体积必须减小，因此我们要求 $(\\partial p/\\partial V)_s  0$，这意味着 $K_s  0$。\n\n我们可以通过比容 $v = 1/\\rho$ 将体积 $V$ 与密度 $\\rho$ 联系起来。用 $v$ 代替 $V$（因为对于固定质量，它们是成比例的），我们有：\n$$\nK_s = -v \\Big(\\frac{\\partial p}{\\partial v}\\Big)_s = -\\frac{1}{\\rho} \\Big(\\frac{\\partial p}{\\partial v}\\Big)_s\n$$\n使用链式法则，我们可以将微分变量从 $v$ 变为 $\\rho$：\n$$\n\\Big(\\frac{\\partial p}{\\partial v}\\Big)_s = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_s \\Big(\\frac{\\partial \\rho}{\\partial v}\\Big)\n$$\n由于 $\\rho = 1/v$，我们有 $\\mathrm{d}\\rho/\\mathrm{d}v = -1/v^2 = -\\rho^2$。将此代入链式法则表达式得到：\n$$\n\\Big(\\frac{\\partial p}{\\partial v}\\Big)_s = \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_s (-\\rho^2)\n$$\n现在，我们将其代回 $K_s$ 的表达式中：\n$$\nK_s = -\\frac{1}{\\rho} \\left[ \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_s (-\\rho^2) \\right] = \\rho \\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_s\n$$\n回想定义 $c^2 = (\\partial p/\\partial \\rho)_s$，我们得到基本关系：\n$$\nK_s = \\rho c^2\n$$\n由于密度 $\\rho$ 必须为正，力学稳定性条件 $K_s  0$ 等价于条件 $c^2  0$。等熵压缩率 $\\beta_s = 1/K_s$ 也必须为正。因此，任何 $c^2 \\le 0$ 的状态都是力学不稳定或临界稳定的，因而在物理上是不可接受的。\n\n### 任务 2：算法设计\n\n第二个任务是设计一个算法，在容许状态的离散网格上测试是否存在 $c^2 \\le 0$。\n\n**1. 解析偏导数**\n\n首先，我们计算给定状态方程的必要偏导数：\n$$\np(\\rho,e;\\theta) = (\\gamma - 1)\\,\\rho\\,e \\;-\\; \\gamma\\,p_{\\infty} \\;+\\; K\\Big[\\Big(\\frac{\\rho}{\\rho_{\\mathrm{ref}}}\\Big)^{m} - 1\\Big]\n$$\n在 $\\rho$ 固定时对 $e$ 的偏导数为：\n$$\n\\Big(\\frac{\\partial p}{\\partial e}\\Big)_{\\rho} = \\frac{\\partial}{\\partial e} \\left[ (\\gamma - 1)\\rho e - \\gamma p_{\\infty} + K\\left(\\left(\\frac{\\rho}{\\rho_{\\mathrm{ref}}}\\right)^m - 1\\right) \\right] = (\\gamma - 1)\\rho\n$$\n在 $e$ 固定时对 $\\rho$ 的偏导数为：\n$$\n\\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} = \\frac{\\partial}{\\partial \\rho} \\left[ (\\gamma - 1)\\rho e - \\gamma p_{\\infty} + K\\left(\\left(\\frac{\\rho}{\\rho_{\\mathrm{ref}}}\\right)^m - 1\\right) \\right] = (\\gamma - 1)e + K \\frac{\\partial}{\\partial \\rho} \\left(\\frac{\\rho^m}{\\rho_{\\mathrm{ref}}^m}\\right)\n$$\n$$\n\\Big(\\frac{\\partial p}{\\partial \\rho}\\Big)_{e} = (\\gamma - 1)e + \\frac{K m}{\\rho_{\\mathrm{ref}}^m} \\rho^{m-1} = (\\gamma - 1)e + \\frac{K m}{\\rho} \\left(\\frac{\\rho}{\\rho_{\\mathrm{ref}}}\\right)^m\n$$\n\n**2. 基于网格的评估算法**\n\n该算法测试给定参数集 $\\theta = (\\gamma, p_{\\infty}, K, m)$ 的稳定性。\n\n**输入：**\n- 参数集 $\\theta = (\\gamma, p_{\\infty}, K, m)$。\n- 区域边界：$\\rho_{\\min}$、$\\rho_{\\max}$、$e_{\\min}$、$e_{\\max}$。\n- 网格分辨率：$N_{\\rho}$、$N_{e}$。\n- 参考密度：$\\rho_{\\mathrm{ref}}$。\n\n**过程：**\n1.  生成热力学状态的均匀张量网格。创建一个包含 $N_{\\rho}$ 个密度点 $\\rho_i$ 的一维数组，这些点在 $\\rho_{\\min}$ 到 $\\rho_{\\max}$ 之间线性分布。创建一个包含 $N_{e}$ 个能量点 $e_j$ 的一维数组，这些点在 $e_{\\min}$ 到 $e_{\\max}$ 之间线性分布。这定义了一个包含 $N_{\\rho} \\times N_{e}$ 个状态 $(\\rho_i, e_j)$ 的网格。\n\n2.  对于网格上的每个点 $(\\rho, e)$ 和给定的 $\\theta$：\n    a. 使用状态方程公式计算压力 $p = p(\\rho, e; \\theta)$。\n    b. 使用其推导公式计算偏导数 $(\\partial p/\\partial \\rho)_e$。\n    c. 使用其推导公式计算偏导数 $(\\partial p/\\partial e)_\\rho$。\n    d. 使用推导的关系式 $c^2 = (\\partial p/\\partial \\rho)_e + (p/\\rho^2)(\\partial p/\\partial e)_\\rho$ 计算声速平方 $c^2$。\n\n3.  检查不稳定性。在计算完网格上所有点的 $c^2$ 后，判断是否有任何计算值是非正的（即，是否存在 $\\min(c^2) \\le 0$）。\n\n**输出：**\n- 如果存在至少一个网格点 $(\\rho, e)$ 使得 $c^2 \\le 0$，则返回 $\\mathrm{True}$。\n- 如果所有网格点的 $c^2  0$，则返回 $\\mathrm{False}$。\n\n通过在整个 $\\rho$ 和 $e$ 值的网格上同时评估公式，可以使用向量化数值库（如 Python 中的 NumPy）高效地实现此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef check_stability_for_params(params: tuple) - bool:\n    \"\"\"\n    Checks a parameter set for mechanical stability over a specified domain.\n\n    The function evaluates the squared speed of sound c^2 on a grid of\n    (density, specific internal energy) states. It returns True if any\n    sampled state has c^2 = 0, indicating a mechanically unstable or\n    marginally stable region is found.\n\n    Args:\n        params: A tuple containing the equation of state parameters\n                (gamma, p_infinity, K, m).\n\n    Returns:\n        A boolean, True if the parameter set is rejected (instability found),\n        False otherwise.\n    \"\"\"\n    # Unpack the parameter vector theta\n    gamma, p_infinity, K, m = params\n\n    # Define fixed physical constants and domain boundaries in SI units\n    rho_ref = 1000.0  # kg/m^3\n    rho_min = 800.0    # kg/m^3\n    rho_max = 1400.0   # kg/m^3\n    e_min = 1.0e6      # J/kg\n    e_max = 5.0e6      # J/kg\n\n    # Define the grid resolution\n    N_rho = 129\n    N_e = 129\n\n    # Create the uniform tensor grid for density (rho) and specific internal energy (e)\n    rho_grid = np.linspace(rho_min, rho_max, N_rho)\n    e_grid = np.linspace(e_min, e_max, N_e)\n    RHO, E = np.meshgrid(rho_grid, e_grid)\n\n    # --- Vectorized calculation over the grid ---\n\n    # 1. Calculate pressure p(RHO, E)\n    # The EOS is: p = (gamma - 1)*rho*e - gamma*p_inf + K*((rho/rho_ref)^m - 1)\n    # Let's compute term by term for clarity.\n    term1 = (gamma - 1.0) * RHO * E\n    term2 = -gamma * p_infinity\n    term3 = K * (np.power(RHO / rho_ref, m) - 1.0)\n    P = term1 + term2 + term3\n\n    # 2. Calculate partial derivative (dp/de)_rho\n    # (dp/de)_rho = (gamma - 1) * rho\n    dp_de_rho = (gamma - 1.0) * RHO\n\n    # 3. Calculate partial derivative (dp/drho)_e\n    # (dp/drho)_e = (gamma - 1)*e + K*m/rho * (rho/rho_ref)^m\n    # The form (gamma - 1)*e + (K * m / rho_ref**m) * rho**(m-1) is better\n    # to avoid potential division by zero if rho could be zero, though not here.\n    dp_drho_e = (gamma - 1.0) * E + (K * m / np.power(rho_ref, m)) * np.power(RHO, m - 1.0)\n    \n    # 4. Calculate squared speed of sound c^2\n    # c^2 = (dp/drho)_e + (p / rho^2) * (dp/de)_rho\n    c_squared = dp_drho_e + (P / np.power(RHO, 2)) * dp_de_rho\n\n    # 5. Check if any value of c^2 is non-positive\n    # The problem requires rejection if c^2 = 0.\n    is_unstable = np.any(c_squared = 0)\n\n    return is_unstable\n\ndef solve():\n    \"\"\"\n    Main function to run stability checks on all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple theta = (gamma, p_infinity, K, m).\n    test_cases = [\n        (4.4, 6.0e8, 1.0e9, 2.0),      # theta_1\n        (0.8, 1.0e5, 0.0, 2.0),       # theta_2\n        (2.0, 1.0e5, -1.0e9, 2.0),     # theta_3\n        (1.0001, 0.0, 0.0, 2.0),      # theta_4\n        (1.4, 0.0, 1.0e7, 1.1)         # theta_5\n    ]\n\n    results = []\n    for case in test_cases:\n        # For each parameter set, check for stability.\n        # The result is True if rejected, False if stable.\n        result = check_stability_for_params(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The problem example shows [True,False,...], which is the default\n    # string representation of booleans in Python.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "在许多涉及高压或相变的声学应用中，理想气体定律已不再适用。最后一个练习  直面这一挑战，指导你完整实现 Peng-Robinson 立方状态方程——一个描述真实流体的强大模型。该练习涵盖了从求解流体状态、计算热力学导数到处理相界附近的数值难题的整个计算流程，最终让你能够精确预测非理想流体中的声速。",
            "id": "4122488",
            "problem": "您的任务是设计并实现一个完整的计算工作流，用于在声学求解器中评估由三次状态方程 (EOS) 建模的纯流体的声速 $c$。该工作流必须包括 (i) 在给定压力 $p$ 和温度 $T$ 下对比容 $v$ 进行稳健的求根，(ii) 计算热力学响应函数所需的符号微分求值，以及 (iii) 在导数变得病态的相界附近采用数值稳定的回退策略。您的实现必须是一个单一的可运行程序，能够为提供的测试套件生成结果。\n\n使用的基本原理和定义：\n- 单组分流体的 Peng–Robinson (PR) 三次状态方程 (EOS) 形式如下\n$$\np(T,v) = \\frac{R T}{v - b} - \\frac{a(T)}{v^2 + 2 b v - b^2},\n$$\n其中 $R$ 是通用气体常数，$T$ 是温度，$v$ 是摩尔比容，$a(T)$ 和 $b$ 是由临界性质和偏心因子定义的 EOS 参数。\n- Peng–Robinson EOS 参数由流体的临界温度 $T_c$、临界压力 $p_c$ 和偏心因子 $\\omega$ 计算得出：\n$$\na_c = 0.45724 \\frac{R^2 T_c^2}{p_c}, \\quad b = 0.07780 \\frac{R T_c}{p_c},\n$$\n$$\n\\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2, \\quad \\alpha(T) = \\left( 1 + \\kappa \\left(1 - \\sqrt{\\frac{T}{T_c}}\\right) \\right)^2,\n$$\n$$\na(T) = a_c \\,\\alpha(T).\n$$\n- 压缩因子 $Z$ 通过 $Z = \\frac{p v}{R T}$ 与摩尔体积相关。对于 Peng–Robinson EOS，$Z$ 满足以下三次多项式\n$$\nZ^3 - (1 - B) Z^2 + (A - 3 B^2 - 2 B) Z - (A B - B^2 - B^3) = 0,\n$$\n其中 $A = \\frac{a(T) p}{R^2 T^2}$ 且 $B = \\frac{b p}{R T}$。\n- 等温压缩率 $\\kappa_T$ 和热膨胀系数 $\\alpha$ 定义为\n$$\n\\kappa_T = -\\frac{1}{v}\\left( \\frac{\\partial v}{\\partial p} \\right)_T, \\quad \\alpha = \\frac{1}{v}\\left( \\frac{\\partial v}{\\partial T} \\right)_p.\n$$\n- 定压比热容 $c_p$ 和定容比热容 $c_v$（均以单位质量表示）之间的差值由下式给出\n$$\nc_p - c_v = \\frac{T \\alpha^2 v_{\\text{mass}}}{\\kappa_T},\n$$\n其中 $v_{\\text{mass}}$ 是质量比容，通过 $v_{\\text{mass}} = \\frac{v}{M}$ 与摩尔体积相关，其中 $M$ 是摩尔质量。请注意，只要计算方式一致，$\\kappa_T$ 和 $\\alpha$ 在摩尔基准和质量比容基准之间是不变的。\n- 等熵压缩率 $\\kappa_S$ 可表示为\n$$\n\\kappa_S = \\kappa_T - \\frac{\\alpha^2 T v_{\\text{mass}}}{c_p},\n$$\n等熵声速为\n$$\nc^2 = \\frac{1}{\\rho \\kappa_S} = \\frac{v_{\\text{mass}}}{\\kappa_S},\n$$\n其中 $\\rho = \\frac{1}{v_{\\text{mass}}}$ 是质量密度。\n\n所需的导数计算：\n- 吸引项中的分母是 $D(v,b) = v^2 + 2 b v - b^2$。\n- 在恒定组分下所需的偏导数为\n$$\n\\left( \\frac{\\partial p}{\\partial v} \\right)_T = -\\frac{R T}{(v - b)^2} + a(T) \\frac{2 v + 2 b}{D(v,b)^2},\n$$\n$$\n\\left( \\frac{\\partial p}{\\partial T} \\right)_v = \\frac{R}{v - b} - \\frac{a'(T)}{D(v,b)},\n$$\n其中 $a'(T) = \\frac{d a(T)}{d T} = a_c \\alpha'(T)$ 且\n$$\n\\alpha'(T) = -\\frac{\\kappa}{T_c \\sqrt{T/T_c}} \\left( 1 + \\kappa \\left(1 - \\sqrt{\\frac{T}{T_c}}\\right) \\right).\n$$\n从全微分 $dp = \\left( \\frac{\\partial p}{\\partial T} \\right)_v dT + \\left( \\frac{\\partial p}{\\partial v} \\right)_T dv$ 推导出\n$$\n\\left( \\frac{\\partial v}{\\partial T} \\right)_p = - \\frac{ \\left( \\frac{\\partial p}{\\partial T} \\right)_v }{ \\left( \\frac{\\partial p}{\\partial v} \\right)_T }, \\quad \\left( \\frac{\\partial v}{\\partial p} \\right)_T = \\frac{1}{ \\left( \\frac{\\partial p}{\\partial v} \\right)_T }.\n$$\n\n求根和回退要求：\n- 给定 $p$ 和 $T$，您必须通过求解 $Z$ 的三次多项式并映射到 $v = \\frac{Z R T}{p}$ 来求解摩尔体积 $v$，或者如果多项式解不符合物理实际或数值不稳定，则直接对 $p(T,v) - p = 0$ 进行求根。\n- 当三次方程产生三个实根时，通过选择最小的实根作为液相分支或最大的实根作为气相分支来选择与物理相关的相态。确保所选的 $v$ 满足 $v  b$。\n- 如果三次方程求解器失败或得出 $v \\le b$，则在 $p(T,v) - p = 0$ 上实现一个稳健的区间限定与二分法回退，利用所选分支的单调性。对于气相，使用 $v \\in (b, v_{\\max})$，并自适应增加 $v_{\\max}$ 直到 $p(T,v_{\\max})  p$。对于液相，使用 $v \\in (b, v_{\\max})$，并增加 $v_{\\max}$ 直到 $p(T,v_{\\max}) > p$。\n- 在相界或临界条件附近，当 $\\left( \\frac{\\partial p}{\\partial v} \\right)_T \\approx 0$ 或 $\\kappa_S \\le 0$ 时，您必须应用数值稳定的回退策略，通过设置 $\\kappa_S \\leftarrow \\kappa_T$ 并计算等温估计值 $c_T^2 = \\frac{v_{\\text{mass}}}{\\kappa_T}$ 来避免非物理或未定义的值。\n\n实现所需的输入和常量：\n- 使用通用气体常数 $R = 8.314462618$ $\\mathrm{J/(mol\\cdot K)}$。\n- 待使用的流体性质集：\n    1. 甲烷：$T_c = 190.564$ $\\mathrm{K}$，$p_c = 4.5992 \\times 10^6$ $\\mathrm{Pa}$，$\\omega = 0.01142$，$M = 0.01604$ $\\mathrm{kg/mol}$，$c_v = 1700$ $\\mathrm{J/(kg\\cdot K)}$。\n    2. 二氧化碳：$T_c = 304.1282$ $\\mathrm{K}$，$p_c = 7.3773 \\times 10^6$ $\\mathrm{Pa}$，$\\omega = 0.22394$，$M = 0.04401$ $\\mathrm{kg/mol}$，$c_v = 655$ $\\mathrm{J/(kg\\cdot K)}$。\n\n测试套件：\n- 案例 1 (正常路径气相)：甲烷，位于 $p = 1.0 \\times 10^6$ $\\mathrm{Pa}$，$T = 300$ $\\mathrm{K}$，气相分支。\n- 案例 2 (亚临界液相，预期有多个根)：二氧化碳，位于 $p = 6.0 \\times 10^6$ $\\mathrm{Pa}$，$T = 280$ $\\mathrm{K}$，液相分支。\n- 案例 3 (近临界气相，可能需要导数回退)：二氧化碳，位于 $p = 7.0 \\times 10^6$ $\\mathrm{Pa}$，$T = 304$ $\\mathrm{K}$，气相分支。\n\n所需输出：\n- 对每个案例，使用等熵公式计算声速 $c$（单位 $\\mathrm{m/s}$），必要时应用回退规则。\n- 您的程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，按测试案例的顺序排列三个结果，结果以浮点数形式表示（单位 $\\mathrm{m/s}$），并四舍五入到六位小数，例如 $[c_1,c_2,c_3]$。\n\n角度单位不适用。不得使用百分比。计算中使用的所有物理单位均为上文明确说明的单位；最终值必须以 $\\mathrm{m/s}$ 为单位。\n\n您的程序必须是自包含的，且不得要求任何输入。它必须实现所描述的完整工作流，包括稳健的根选择、导数求值以及在相界附近的保稳定性回退。",
            "solution": "该问题要求设计并实现一个计算工作流，用于确定由 Peng–Robinson (PR) 状态方程 (EOS) 描述的纯流体中的声速 $c$。解决方案涉及一系列步骤：首先，在给定压力 $p$ 和温度 $T$ 下确定流体的摩尔体积 $v$；其次，计算必要的热力学导数；第三，使用包含针对近临界或两相边界条件的数值稳定回退的公式计算声速。\n\n总体方法是将给定流体的物理模型和计算逻辑封装在一个结构化程序中。对于每个测试案例，我们将使用指定的流体属性（$T_c$，$p_c$，$\\omega$，$M$，$c_v$）实例化此模型，然后对给定状态（$p$，$T$ 和相态）执行计算。\n\n首先，我们确定 PR EOS 的流体特定参数和温度依赖性参数。通用气体常数为 $R = 8.314462618 \\, \\mathrm{J/(mol\\cdot K)}$。参数 $a_c$ 和 $b$ 对于给定流体是常数，由其临界温度 $T_c$ 和临界压力 $p_c$ 推导得出：\n$$\na_c = 0.45724 \\frac{R^2 T_c^2}{p_c}, \\quad b = 0.07780 \\frac{R T_c}{p_c}\n$$\n吸引项参数 $a(T)$ 通过函数 $\\alpha_{\\text{eos}}(T)$ 依赖于温度：\n$$\na(T) = a_c \\alpha_{\\text{eos}}(T)\n$$\n其中 $\\alpha_{\\text{eos}}(T)$ 使用流体的偏心因子 $\\omega$ 定义：\n$$\n\\alpha_{\\text{eos}}(T) = \\left( 1 + \\kappa \\left(1 - \\sqrt{\\frac{T}{T_c}}\\right) \\right)^2, \\quad \\text{with} \\quad \\kappa = 0.37464 + 1.54226\\,\\omega - 0.26992\\,\\omega^2\n$$\n\n其次，我们确定摩尔体积 $v$。PR EOS 是一个关于 $v$ 的三次方程，但将其等效形式——一个关于压缩因子 $Z = \\frac{pv}{RT}$ 的三次多项式——求解更为方便。该多项式由下式给出：\n$$\nZ^3 - (1 - B) Z^2 + (A - 3 B^2 - 2 B) Z - (A B - B^2 - B^3) = 0\n$$\n其中 $A$ 和 $B$ 是无量纲群：\n$$\nA = \\frac{a(T) p}{R^2 T^2}, \\quad B = \\frac{b p}{R T}\n$$\n对于给定的状态（$p$，$T$），我们计算 $A$ 和 $B$，并求解这个关于 $Z$ 的三次多项式。根可以是实数或复数。我们只考虑实根，因为复根没有物理意义。对于每个实根 $Z_{real}$，我们计算相应的摩尔体积 $v = \\frac{Z_{real} R T}{p}$。只有当体积大于排除体积参数时，即 $v  b$，它才具有物理有效性。\n\n如果存在多个有效的实根（通常在亚临界、两相区），问题指定了一个选择标准：最小的体积对应于液相，而最大的体积对应于气相。中间的根代表一个不稳定的状态，应被舍弃。根据每个测试案例指定的相态（‘liquid’ 或 ‘vapor’），我们选择适当的体积 $v$。\n\n第三，我们评估必要的热力学导数。声速计算依赖于从 EOS 的偏导数推导出的响应函数。所需的压力 $p$ 对恒定温度 $T$ 下的体积 $v$ 的导数，以及对恒定体积 $v$ 下的温度 $T$ 的导数是：\n$$\n\\left( \\frac{\\partial p}{\\partial v} \\right)_T = -\\frac{R T}{(v - b)^2} + a(T) \\frac{2 v + 2 b}{(v^2 + 2 b v - b^2)^2}\n$$\n$$\n\\left( \\frac{\\partial p}{\\partial T} \\right)_v = \\frac{R}{v - b} - \\frac{a'(T)}{v^2 + 2 b v - b^2}\n$$\n其中 $a'(T) = \\frac{da(T)}{dT}$ 是吸引参数相对于温度的导数：\n$$\na'(T) = a_c \\alpha'_{\\text{eos}}(T), \\quad \\text{with} \\quad \\alpha'_{\\text{eos}}(T) = -\\frac{\\kappa}{\\sqrt{T T_c}} \\left( 1 + \\kappa \\left(1 - \\sqrt{\\frac{T}{T_c}}\\right) \\right)\n$$\n根据这些，我们可以使用标准恒等式找到体积的导数：\n$$\n\\left( \\frac{\\partial v}{\\partial p} \\right)_T = \\frac{1}{ \\left( \\frac{\\partial p}{\\partial v} \\right)_T }, \\quad \\left( \\frac{\\partial v}{\\partial T} \\right)_p = - \\frac{ \\left( \\frac{\\partial p}{\\partial T} \\right)_v }{ \\left( \\frac{\\partial p}{\\partial v} \\right)_T }\n$$\n这些导数允许计算等温压缩率 $\\kappa_T$ 和热膨胀系数 $\\alpha_p$：\n$$\n\\kappa_T = -\\frac{1}{v}\\left( \\frac{\\partial v}{\\partial p} \\right)_T = -\\frac{1}{v \\left( \\frac{\\partial p}{\\partial v} \\right)_T}, \\quad \\alpha_p = \\frac{1}{v}\\left( \\frac{\\partial v}{\\partial T} \\right)_p = -\\frac{\\left( \\frac{\\partial p}{\\partial T} \\right)_v}{v \\left( \\frac{\\partial p}{\\partial v} \\right)_T}\n$$\n\n第四，我们计算声速，并实现指定的回退逻辑。该计算需要质量定压比热容 $c_p$。我们使用标准热力学关系，从提供的质量定容比热容 $c_v$ 中获得此值：\n$$\nc_p - c_v = \\frac{T \\alpha_p^2 v_{\\text{mass}}}{\\kappa_T}\n$$\n其中 $v_{\\text{mass}} = v/M$ 是质量比容，$M$ 是摩尔质量。这得出 $c_p = c_v + T \\alpha_p^2 v_{\\text{mass}} / \\kappa_T$。\n\n然后使用以下公式找到等熵压缩率 $\\kappa_S$：\n$$\n\\kappa_S = \\kappa_T - \\frac{\\alpha_p^2 T v_{\\text{mass}}}{c_p}\n$$\n最后，等熵声速 $c$ 由下式给出：\n$$\nc^2 = \\frac{v_{\\text{mass}}}{\\kappa_S}\n$$\n问题要求为该计算可能变得不稳定的条件提供一个稳健的回退，特别是在临界点或相界附近，此时 $(\\partial p / \\partial v)_T \\to 0$。触发条件是当 $(\\partial p / \\partial v)_T \\ge 0$（表示力学不稳定性）或计算出的 $\\kappa_S \\le 0$（这将导致虚数或无穷大的声速）时。如果满足这些条件中的任何一个，计算将回退到等温声速 $c_T$，定义为：\n$$\nc_T^2 = \\frac{v_{\\text{mass}}}{\\kappa_T}\n$$\n即使在等熵模型是病态的区域，这种回退也能确保得到一个有物理意义的实值结果。最终的声速是 $c = \\sqrt{c^2}$。\n\n实现将对每个测试案例精确地遵循这些步骤，产生一个声速向量，该向量将被格式化为所需的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the calculation of sound speed for the given test suite.\n    \"\"\"\n\n    class PR_Fluid:\n        \"\"\"\n        A class to encapsulate the Peng-Robinson EOS model and related calculations for a pure fluid.\n        \"\"\"\n        R = 8.314462618  # Universal gas constant in J/(mol·K)\n\n        def __init__(self, Tc, pc, omega, M, cv_mass):\n            \"\"\"\n            Initializes the fluid with its critical properties and other constants.\n            \n            Args:\n                Tc (float): Critical temperature (K).\n                pc (float): Critical pressure (Pa).\n                omega (float): Acentric factor.\n                M (float): Molar mass (kg/mol).\n                cv_mass (float): Mass-specific heat at constant volume (J/(kg·K)).\n            \"\"\"\n            self.Tc = Tc\n            self.pc = pc\n            self.omega = omega\n            self.M = M\n            self.cv_mass = cv_mass\n\n            # Pre-calculate constant EOS parameters\n            self.ac = 0.45724 * (self.R**2 * self.Tc**2) / self.pc\n            self.b = 0.07780 * (self.R * self.Tc) / self.pc\n            self.kappa = 0.37464 + 1.54226 * self.omega - 0.26992 * self.omega**2\n\n        def _calculate_state_params(self, T, p):\n            \"\"\"\n            Calculates temperature-dependent parameters for a given state (T, p).\n            \"\"\"\n            Tr = T / self.Tc\n            self.alpha_eos = (1 + self.kappa * (1 - np.sqrt(Tr)))**2\n            self.a_T = self.ac * self.alpha_eos\n            \n            # Dimensionless groups for the Z-polynomial\n            self.A = (self.a_T * p) / (self.R**2 * T**2)\n            self.B = (self.b * p) / (self.R * T)\n\n        def find_volume(self, T, p, phase):\n            \"\"\"\n            Finds the molar volume v by solving the cubic EOS for the compressibility factor Z.\n            Selects the appropriate root based on the specified phase.\n            \"\"\"\n            self._calculate_state_params(T, p)\n\n            # Coefficients of Z^3 + c2*Z^2 + c1*Z + c0 = 0\n            coeffs = [\n                1,\n                self.B - 1,\n                self.A - 3 * self.B**2 - 2 * self.B,\n                -(self.A * self.B - self.B**2 - self.B**3)\n            ]\n            roots = np.roots(coeffs)\n            \n            # Filter for real roots that correspond to physical volumes (v  b)\n            real_roots = roots[np.isreal(roots)].real\n            valid_volumes = []\n            for Z in real_roots:\n                v = Z * self.R * T / p\n                if v  self.b:\n                    valid_volumes.append(v)\n            \n            if not valid_volumes:\n                raise ValueError(f\"No physical root (v  b) found for T={T} K, p={p} Pa.\")\n            \n            if phase == 'liquid':\n                return min(valid_volumes)\n            elif phase == 'vapor':\n                return max(valid_volumes)\n            else:\n                raise ValueError(\"Invalid phase specified. Must be 'liquid' or 'vapor'.\")\n\n        def calculate_sound_speed(self, T, p, phase):\n            \"\"\"\n            Calculates the sound speed with a stability-preserving fallback.\n            \"\"\"\n            v = self.find_volume(T, p, phase)\n\n            # Derivative of the a(T) parameter\n            Tr = T / self.Tc\n            sqrt_alpha_eos = 1 + self.kappa * (1 - np.sqrt(Tr))\n            d_alpha_eos_dT = (-self.kappa / np.sqrt(T * self.Tc)) * sqrt_alpha_eos\n            d_a_T_dT = self.ac * d_alpha_eos_dT\n            \n            # Partial derivatives of pressure\n            D_vb = v**2 + 2*self.b*v - self.b**2\n            dp_dv_T = -(self.R * T) / (v - self.b)**2 + self.a_T * (2*v + 2*self.b) / (D_vb**2)\n            dp_dT_v = self.R / (v - self.b) - d_a_T_dT / D_vb\n            \n            # Response functions\n            kappa_T = -1 / (v * dp_dv_T)\n            alpha_p = -dp_dT_v / (v * dp_dv_T)\n\n            # Mass-specific properties\n            v_mass = v / self.M\n            cp_minus_cv = (T * alpha_p**2 * v_mass) / kappa_T\n            cp_mass = self.cv_mass + cp_minus_cv\n\n            # Isentropic compressibility\n            kappa_S = kappa_T - (alpha_p**2 * T * v_mass) / cp_mass\n\n            # Fallback logic for numerical stability\n            is_unstable = (dp_dv_T = 0) or (kappa_S = 0)\n\n            if is_unstable:\n                # Use isothermal sound speed as fallback\n                c_squared = v_mass / kappa_T\n            else:\n                # Use isentropic sound speed\n                c_squared = v_mass / kappa_S\n\n            if c_squared  0:\n                # This indicates the state is deep in an unphysical region\n                return np.nan\n            \n            return np.sqrt(c_squared)\n\n    # Define fluid properties from the problem statement\n    methane_props = {\n        'Tc': 190.564, 'pc': 4.5992e6, 'omega': 0.01142, 'M': 0.01604, 'cv_mass': 1700\n    }\n    co2_props = {\n        'Tc': 304.1282, 'pc': 7.3773e6, 'omega': 0.22394, 'M': 0.04401, 'cv_mass': 655\n    }\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        (methane_props, {'p': 1.0e6, 'T': 300, 'phase': 'vapor'}),\n        (co2_props, {'p': 6.0e6, 'T': 280, 'phase': 'liquid'}),\n        (co2_props, {'p': 7.0e6, 'T': 304, 'phase': 'vapor'}),\n    ]\n\n    results = []\n    for fluid_props, state in test_cases:\n        fluid = PR_Fluid(**fluid_props)\n        c = fluid.calculate_sound_speed(**state)\n        results.append(c)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{res:.6f}' for res in results)}]\")\n\nsolve()\n```"
        }
    ]
}