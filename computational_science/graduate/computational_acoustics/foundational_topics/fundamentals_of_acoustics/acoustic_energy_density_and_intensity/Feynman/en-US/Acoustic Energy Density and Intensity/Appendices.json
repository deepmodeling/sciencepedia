{
    "hands_on_practices": [
        {
            "introduction": "To master the concepts of acoustic energy, we begin with a foundational analysis of its two forms: kinetic and potential. This exercise explores the behavior of these energy densities within a one-dimensional standing wave, a non-propagating field formed by the superposition of two counter-propagating waves. By deriving the relationship between time-averaged kinetic and potential energy as a function of position, you will develop a deep intuition for the local \"sloshing\" of energy and understand why the total energy is spatially uniform in this idealized case . This analysis is crucial for understanding reactive fields and energy storage phenomena in resonant systems.",
            "id": "4112657",
            "problem": "A lossless, homogeneous fluid of mass density $\\rho$ and adiabatic sound speed $c$ supports small-amplitude one-dimensional acoustic motion along the $x$-axis. Consider a monochromatic standing plane wave formed by the superposition of two counter-propagating, equal-amplitude traveling waves of angular frequency $\\omega$ and wavenumber $k$. Let $p(x,t)$ denote the acoustic pressure fluctuation and $v(x,t)$ the particle velocity. Starting strictly from the linearized momentum equation and the linearized continuity equation for adiabatic acoustics,\n$$\\rho\\,\\frac{\\partial v}{\\partial t}=-\\frac{\\partial p}{\\partial x},\\qquad \\frac{\\partial p}{\\partial t}=-\\rho c^{2}\\,\\frac{\\partial v}{\\partial x},$$\nderive the explicit real-valued spatiotemporal fields $p(x,t)$ and $v(x,t)$ for the standing wave in terms of a real pressure amplitude $P$.\n\nUsing the fundamental definitions of instantaneous kinetic and potential acoustic energy densities,\n$$u_{k}(x,t)=\\frac{1}{2}\\,\\rho\\,v(x,t)^{2},\\qquad u_{p}(x,t)=\\frac{p(x,t)^{2}}{2\\,\\rho\\,c^{2}},$$\ncompute the cycle-averaged ratio $R(x)=\\langle u_{k}(x,t)\\rangle_{t}/\\langle u_{p}(x,t)\\rangle_{t}$ as a closed-form function of position $x$, where $\\langle\\cdot\\rangle_{t}$ denotes averaging over one temporal period $T=2\\pi/\\omega$. From this $R(x)$, evaluate and interpret the behavior at pressure antinodes and velocity antinodes, explaining the local “sloshing” of energy between kinetic and potential forms and its phase structure in time. Express your final answer for the function $R(x)$ as a symbolic expression; no numerical rounding is required. The interpretation should be qualitative, but the reported $R(x)$ must be an analytic expression.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **Fluid Properties**: Lossless, homogeneous fluid with mass density $\\rho$ and adiabatic sound speed $c$.\n- **Motion**: One-dimensional ($x$-axis), small-amplitude acoustic motion.\n- **Wave Type**: Monochromatic standing plane wave with angular frequency $\\omega$ and wavenumber $k$.\n- **Governing Equations (Linearized)**:\n  - Momentum: $\\rho\\,\\frac{\\partial v}{\\partial t}=-\\frac{\\partial p}{\\partial x}$\n  - Continuity: $\\frac{\\partial p}{\\partial t}=-\\rho c^{2}\\,\\frac{\\partial v}{\\partial x}$\n- **Field Variables**: Acoustic pressure fluctuation $p(x,t)$, particle velocity $v(x,t)$.\n- **Energy Density Definitions (Instantaneous)**:\n  - Kinetic: $u_{k}(x,t)=\\frac{1}{2}\\,\\rho\\,v(x,t)^{2}$\n  - Potential: $u_{p}(x,t)=\\frac{p(x,t)^{2}}{2\\,\\rho\\,c^{2}}$\n- **Required Output**:\n  1. Explicit real-valued spatiotemporal fields $p(x,t)$ and $v(x,t)$ in terms of a real pressure amplitude $P$.\n  2. The cycle-averaged ratio $R(x)=\\langle u_{k}(x,t)\\rangle_{t}/\\langle u_{p}(x,t)\\rangle_{t}$, where averaging is over one temporal period $T=2\\pi/\\omega$.\n  3. Interpretation of $R(x)$ at pressure and velocity antinodes, including the local energy \"sloshing\".\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is examined against the validation criteria.\n\n- **Scientifically Grounded**: The problem is based on the fundamental linearized equations of acoustics, which are a cornerstone of wave physics. The definitions of kinetic and potential energy density are standard for acoustic fields. The concept of a standing wave formed by a superposition of counter-propagating waves is a classic and physically sound model. All premises are factually and scientifically sound.\n- **Well-Posed**: The problem provides all necessary equations, definitions, and constraints to derive the requested quantities. The tasks are clearly defined, leading to a unique analytical solution for the ratio $R(x)$.\n- **Objective**: The problem is stated using precise, unambiguous mathematical and physical terminology. It is free of subjective language or opinion.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-posed, scientifically grounded problem from the field of acoustics. A solution will now be derived.\n\nFirst, we derive the expressions for the pressure field $p(x,t)$ and velocity field $v(x,t)$ for a standing wave. A one-dimensional standing wave can be represented as the superposition of two identical traveling waves propagating in opposite directions. Let the two pressure waves be $p_1(x,t)$ and $p_2(x,t)$, representing forward and backward propagation respectively. In complex notation, these can be written as:\n$$p_1(x,t) = \\tilde{A} \\exp(i(\\omega t - kx))$$\n$$p_2(x,t) = \\tilde{A} \\exp(i(\\omega t + kx))$$\nThe total pressure field $p(x,t)$ is the real part of their sum:\n$$p(x,t) = \\Re[p_1(x,t) + p_2(x,t)] = \\Re[\\tilde{A} \\exp(i\\omega t) (\\exp(-ikx) + \\exp(ikx))]$$\nUsing Euler's formula, $\\exp(-ikx) + \\exp(ikx) = 2\\cos(kx)$, we get:\n$$p(x,t) = \\Re[2\\tilde{A} \\cos(kx) \\exp(i\\omega t)]$$\nThe problem specifies that the fields should be in terms of a real pressure amplitude $P$. We can set the complex amplitude $2\\tilde{A}$ to be the real value $P$. This choice corresponds to setting the phase of the standing wave.\n$$p(x,t) = \\Re[P \\cos(kx) (\\cos(\\omega t) + i \\sin(\\omega t))] = P \\cos(kx) \\cos(\\omega t)$$\n\nNext, we derive the particle velocity $v(x,t)$ from the pressure $p(x,t)$ using the linearized momentum equation:\n$$\\rho\\,\\frac{\\partial v}{\\partial t}=-\\frac{\\partial p}{\\partial x}$$\nFirst, compute the spatial derivative of the pressure:\n$$\\frac{\\partial p}{\\partial x} = \\frac{\\partial}{\\partial x} [P \\cos(kx) \\cos(\\omega t)] = -Pk \\sin(kx) \\cos(\\omega t)$$\nSubstitute this into the momentum equation:\n$$\\rho\\,\\frac{\\partial v}{\\partial t} = -(-Pk \\sin(kx) \\cos(\\omega t)) = Pk \\sin(kx) \\cos(\\omega t)$$\nTo find $v(x,t)$, we integrate with respect to time $t$:\n$$v(x,t) = \\int \\frac{Pk}{\\rho} \\sin(kx) \\cos(\\omega t) dt = \\frac{Pk}{\\rho\\omega} \\sin(kx) \\sin(\\omega t)$$\nThe constant of integration is zero for a purely oscillatory acoustic field with no mean flow. For a lossless medium, the dispersion relation is $\\omega = ck$, which implies $k/\\omega = 1/c$. Substituting this, we obtain the final expression for velocity:\n$$v(x,t) = \\frac{P}{\\rho c} \\sin(kx) \\sin(\\omega t)$$\nThese expressions for $p(x,t)$ and $v(x,t)$ show that the pressure and velocity are in spatial quadrature ($\\cos(kx)$ vs. $\\sin(kx)$) and temporal quadrature ($\\cos(\\omega t)$ vs. $\\sin(\\omega t)$).\n\nNow, we compute the instantaneous kinetic and potential energy densities using their definitions:\n$$u_{k}(x,t) = \\frac{1}{2}\\,\\rho\\,v(x,t)^{2} = \\frac{1}{2}\\rho \\left(\\frac{P}{\\rho c} \\sin(kx) \\sin(\\omega t)\\right)^2 = \\frac{P^2}{2\\rho c^2} \\sin^2(kx) \\sin^2(\\omega t)$$\n$$u_{p}(x,t) = \\frac{p(x,t)^{2}}{2\\,\\rho\\,c^{2}} = \\frac{(P \\cos(kx) \\cos(\\omega t))^2}{2\\rho c^2} = \\frac{P^2}{2\\rho c^2} \\cos^2(kx) \\cos^2(\\omega t)$$\n\nThe next step is to compute the time-average of these quantities over one period $T = 2\\pi/\\omega$. The time-average of a function $f(t)$ is $\\langle f(t) \\rangle_{t} = \\frac{1}{T}\\int_{0}^{T} f(t) dt$. We need the average of the trigonometric terms:\n$$\\langle \\sin^2(\\omega t) \\rangle_t = \\frac{1}{T}\\int_{0}^{T} \\sin^2(\\omega t) dt = \\frac{1}{T}\\int_{0}^{T} \\frac{1 - \\cos(2\\omega t)}{2} dt = \\frac{1}{2}$$\n$$\\langle \\cos^2(\\omega t) \\rangle_t = \\frac{1}{T}\\int_{0}^{T} \\cos^2(\\omega t) dt = \\frac{1}{T}\\int_{0}^{T} \\frac{1 + \\cos(2\\omega t)}{2} dt = \\frac{1}{2}$$\nThe integrals of $\\cos(2\\omega t)$ over the period $T$ are zero.\n\nUsing these results, we find the time-averaged energy densities:\n$$\\langle u_{k}(x,t) \\rangle_{t} = \\frac{P^2}{2\\rho c^2} \\sin^2(kx) \\langle \\sin^2(\\omega t) \\rangle_{t} = \\frac{P^2}{4\\rho c^2} \\sin^2(kx)$$\n$$\\langle u_{p}(x,t) \\rangle_{t} = \\frac{P^2}{2\\rho c^2} \\cos^2(kx) \\langle \\cos^2(\\omega t) \\rangle_{t} = \\frac{P^2}{4\\rho c^2} \\cos^2(kx)$$\n\nFinally, we compute the ratio $R(x)$:\n$$R(x) = \\frac{\\langle u_{k}(x,t)\\rangle_{t}}{\\langle u_{p}(x,t)\\rangle_{t}} = \\frac{\\frac{P^2}{4\\rho c^2} \\sin^2(kx)}{\\frac{P^2}{4\\rho c^2} \\cos^2(kx)} = \\frac{\\sin^2(kx)}{\\cos^2(kx)} = \\tan^2(kx)$$\n\nInterpretation of the result:\n- **At pressure antinodes**: These are locations where the pressure amplitude $|\\cos(kx)|$ is maximal, i.e., $|\\cos(kx)|=1$. This occurs at $kx = n\\pi$ for any integer $n$. At these points, $\\sin(kx) = 0$, so $R(x) = \\tan^2(n\\pi) = 0$. This signifies that the time-averaged kinetic energy density is zero. These are velocity nodes, where $v(x,t)=0$ for all $t$. The acoustic energy at these locations is, on average, purely potential.\n- **At velocity antinodes**: These are locations where the velocity amplitude $|\\sin(kx)|$ is maximal, i.e., $|\\sin(kx)|=1$. This occurs at $kx = (n + 1/2)\\pi$ for any integer $n$. At these points, $\\cos(kx) = 0$, and the ratio $R(x) = \\tan^2((n+1/2)\\pi)$ is singular (approaches infinity). This signifies that the time-averaged potential energy density is zero. These are pressure nodes, where $p(x,t)=0$ for all $t$. The acoustic energy at these locations is, on average, purely kinetic.\n\nThe local \"sloshing\" of energy refers to the temporal exchange between kinetic and potential forms. At any fixed position $x$ (that is not a node or antinode), the energy continuously transforms. The instantaneous kinetic energy $u_k \\propto \\sin^2(\\omega t)$ is maximum when the potential energy $u_p \\propto \\cos^2(\\omega t)$ is zero, and vice-versa. This is because $p(x,t)$ and $v(x,t)$ are out of phase by $\\pi/2$ in time. Energy is entirely potential at $t=n\\pi/\\omega$ and entirely kinetic a quarter-period later at $t=(n+1/2)\\pi/\\omega$. This periodic conversion from one form to another at a fixed point, without net propagation, is the characteristic energy dynamic of a standing wave. The function $R(x) = \\tan^2(kx)$ quantifies the spatial partitioning of the time-averaged energy budget between its kinetic and potential forms. Note that the total time-averaged energy density $\\langle u \\rangle_t = \\langle u_k \\rangle_t + \\langle u_p \\rangle_t = \\frac{P^2}{4\\rho c^2}(\\sin^2(kx) + \\cos^2(kx)) = \\frac{P^2}{4\\rho c^2}$ is constant in space, a hallmark of an ideal one-dimensional standing wave.",
            "answer": "$$\\boxed{\\tan^2(kx)}$$"
        },
        {
            "introduction": "Building on the fundamentals, we now apply the concepts of energy density and intensity to a practical scenario: the acoustic field radiated by a baffled circular piston. This problem moves from idealized plane waves to the spatially complex field of a common transducer, focusing on the far-field directivity pattern where the energy is distributed in a characteristic pattern of lobes. This computational practice will allow you to connect the theoretical directivity function $D(\\theta)$ to the tangible distribution of radiated energy in space, a critical skill for antenna design, sonar systems engineering, and medical ultrasound imaging .",
            "id": "4112645",
            "problem": "Consider a baffled circular piston source radiating a time-harmonic acoustic field of angular frequency $\\omega=2\\pi f$ into a homogeneous, lossless fluid with mass density $\\rho$ and sound speed $c$. In the far field, the pressure amplitude pattern of the piston is governed by the given directivity function $D(\\theta)=\\dfrac{2 J_1(k a \\sin\\theta)}{k a \\sin\\theta}$, where $J_1(\\cdot)$ is the first-order Bessel function of the first kind, $k=\\dfrac{2\\pi f}{c}$ is the acoustic wavenumber, $a$ is the piston radius, and $\\theta$ is the polar angle measured from the piston axis.\n\nStarting from core definitions of linear acoustics, specifically the relationships among acoustic pressure, particle velocity, intensity, and energy density, and under the far-field approximation where amplitude scales inversely with distance, derive an algorithm that:\n- Maps the sidelobe structure of the angular intensity distribution in the domain $\\theta\\in[0,\\theta_{\\max}]$ by identifying all local maxima of the normalized intensity pattern $I_{\\mathrm{rel}}(\\theta)\\propto |D(\\theta)|^2$ that are not the main lobe at $\\theta=0$ and whose relative level exceeds a specified threshold $\\tau$.\n- Computes the peak time-averaged acoustic energy density at a specified range $r$ from the source, using a known on-axis root-mean-square (RMS) pressure $p_{\\mathrm{ref}}$ at a reference range $r_{\\mathrm{ref}}$.\n\nYour program must implement the following computational steps for each test case:\n1. Compute $k=\\dfrac{2\\pi f}{c}$ and the dimensionless parameter $k a$.\n2. Construct the normalized intensity pattern $I_{\\mathrm{rel}}(\\theta)=|D(\\theta)|^2$ on a dense angular grid spanning $\\theta\\in[0,\\theta_{\\max}]$.\n3. Detect all sidelobe peaks by finding local maxima of $I_{\\mathrm{rel}}(\\theta)$ for $\\theta>0$ that exceed the threshold $\\tau$ relative to the on-axis intensity. Report their angles (in degrees) and peak levels (unitless, relative to the on-axis intensity).\n4. Using far-field scaling, compute the peak time-averaged acoustic energy density at range $r$,\ngiven $p_{\\mathrm{ref}}$ at $r_{\\mathrm{ref}}$, and report it in Joules per cubic meter (J/m$^3$).\n\nPhysical and numerical details to respect:\n- Use the far-field approximation $p_{\\mathrm{rms}}(r,\\theta)=p_{\\mathrm{ref}}\\left(\\dfrac{r_{\\mathrm{ref}}}{r}\\right) D(\\theta)$ for the root-mean-square pressure amplitude.\n- Use the definition of time-averaged acoustic energy density to relate pressure amplitude to energy density.\n- The angular search domain must be $\\theta_{\\max}=90$ degrees and must be sampled densely enough to reliably resolve sidelobe peaks; ensure numerical robustness near $\\theta=0$ by correctly handling the limit of $D(\\theta)$.\n\nUnits and output formatting requirements:\n- Angles must be reported in degrees.\n- The energy density must be reported in J/m$^3$, rounded to six decimal places.\n- Sidelobe angles must be rounded to two decimal places.\n- Relative sidelobe intensities must be rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\"), where each \"result\" is a list of the form [angles_list, intensities_list, energy_density_float] for each test case.\n\nTest suite:\nUse the following test cases, each provided as $(\\rho,c,a,f,p_{\\mathrm{ref}},r_{\\mathrm{ref}},r,\\theta_{\\max},\\tau)$ with units $(\\mathrm{kg/m^3},\\mathrm{m/s},\\mathrm{m},\\mathrm{Hz},\\mathrm{Pa},\\mathrm{m},\\mathrm{m},\\mathrm{degrees},\\text{unitless})$:\n- Test case 1 (small $k a$): $(1000,\\;1500,\\;0.01,\\;5000,\\;2.0,\\;1.0,\\;10.0,\\;90,\\;0.01)$.\n- Test case 2 (moderate $k a$): $(1.225,\\;343,\\;0.1,\\;4000,\\;2.0,\\;1.0,\\;5.0,\\;90,\\;0.02)$.\n- Test case 3 (large $k a$): $(1.225,\\;343,\\;0.2,\\;8000,\\;2.0,\\;1.0,\\;20.0,\\;90,\\;0.01)$.\n\nYour program should produce a single line of output containing the results for all three test cases as a comma-separated list enclosed in square brackets, where each element is the list [angles_list, intensities_list, energy_density_float] corresponding to the respective test case, with the stated rounding requirements applied.",
            "solution": "The problem as stated is scientifically sound, well-posed, and contains all necessary information for a unique solution. It describes a canonical problem in acoustics: the far-field radiation from a baffled circular piston. All physical parameters and mathematical definitions are standard and consistent with the principles of linear acoustics. I will therefore proceed with a full solution.\n\nThe problem requires the derivation and implementation of an algorithm to analyze the far-field acoustic pattern of a baffled piston. This involves two primary tasks: identifying the angular locations and relative levels of sidelobes in the intensity pattern, and calculating the peak time-averaged acoustic energy density at a specified distance from the source. The solution is founded on the fundamental relationships of linear acoustics.\n\nIn a homogeneous, lossless fluid, for a single-frequency (time-harmonic) plane wave, the acoustic pressure $p$ and the particle velocity $u$ are in phase. The relationship between their amplitudes is given by $p_{\\text{peak}} = \\rho c u_{\\text{peak}}$, where $\\rho$ is the fluid mass density and $c$ is the speed of sound. The quantity $\\rho c$ is the characteristic acoustic impedance of the medium.\n\nThe time-averaged acoustic intensity $\\langle I \\rangle$, which represents the flow of energy per unit area per unit time, is given in terms of the root-mean-square (RMS) pressure $p_{\\mathrm{rms}}$ as:\n$$\n\\langle I \\rangle = \\frac{p_{\\mathrm{rms}}^2}{\\rho c}\n$$\nThe time-averaged acoustic energy density $\\langle E \\rangle$, which is the energy stored per unit volume, is the sum of the time-averaged potential energy density $\\langle E_p \\rangle$ and kinetic energy density $\\langle E_k \\rangle$. For a plane wave, these two components are equal, and the total is given by:\n$$\n\\langle E \\rangle = \\langle E_p \\rangle + \\langle E_k \\rangle = \\frac{p_{\\mathrm{rms}}^2}{\\rho c^2}\n$$\nFrom these two relations, it is clear that $\\langle I \\rangle = c \\langle E \\rangle$.\n\nThe algorithm can be constructed in a sequence of logical steps:\n\n**1. System Parameter Calculation**\nFirst, we compute the acoustic wavenumber $k$ from the given temporal frequency $f$ and sound speed $c$:\n$$\nk = \\frac{\\omega}{c} = \\frac{2\\pi f}{c}\n$$\nThe directivity of the piston source is governed by the dimensionless parameter $ka$, where $a$ is the piston radius. A larger value of $ka$ corresponds to a more directional sound beam with more numerous and narrower sidelobes.\n\n**2. Sidelobe Structure Analysis**\nThe angular dependence of the far-field acoustic pressure is described by the directivity function $D(\\theta)$. The problem provides the far-field RMS pressure as:\n$$\np_{\\mathrm{rms}}(r, \\theta) = p_{\\mathrm{ref}} \\left(\\frac{r_{\\mathrm{ref}}}{r}\\right) D(\\theta)\n$$\nwhere $p_{\\mathrm{ref}}$ is the on-axis ($\\theta=0$) RMS pressure at a reference distance $r_{\\text{ref}}$. The angular distribution of the time-averaged intensity follows from this:\n$$\n\\langle I(r, \\theta) \\rangle = \\frac{p_{\\mathrm{rms}}^2(r, \\theta)}{\\rho c} = \\frac{1}{\\rho c} \\left[ p_{\\mathrm{ref}} \\left(\\frac{r_{\\mathrm{ref}}}{r}\\right) D(\\theta) \\right]^2\n$$\nTo analyze the sidelobe structure, we are interested in the shape of the intensity pattern, normalized to its on-axis maximum. This normalized intensity pattern, $I_{\\mathrm{rel}}(\\theta)$, is:\n$$\nI_{\\mathrm{rel}}(\\theta) = \\frac{\\langle I(r, \\theta) \\rangle}{\\langle I(r, 0) \\rangle} = \\frac{|D(\\theta)|^2}{|D(0)|^2}\n$$\nThe directivity function for a baffled circular piston is given by:\n$$\nD(\\theta) = \\frac{2 J_1(k a \\sin\\theta)}{k a \\sin\\theta}\n$$\nwhere $J_1(\\cdot)$ is the first-order Bessel function of the first kind. To evaluate $D(0)$, we take the limit of the expression as $\\theta \\to 0$. Using the small-argument approximation for the Bessel function, $J_1(x) \\approx x/2$ as $x \\to 0$, we find:\n$$\nD(0) = \\lim_{\\theta \\to 0} \\frac{2 J_1(k a \\sin\\theta)}{k a \\sin\\theta} = 1\n$$\nTherefore, the normalized intensity pattern is simply:\n$$\nI_{\\mathrm{rel}}(\\theta) = |D(\\theta)|^2 = \\left( \\frac{2 J_1(k a \\sin\\theta)}{k a \\sin\\theta} \\right)^2\n$$\nTo find the sidelobes, we must numerically identify the local maxima of $I_{\\mathrm{rel}}(\\theta)$ in the domain $\\theta \\in (0, \\theta_{\\max}]$. This is achieved by creating a sufficiently dense grid of angles in the specified range, evaluating $I_{\\mathrm{rel}}(\\theta)$ on this grid, and employing a peak-finding algorithm. The density of the grid is crucial for resolving the potentially narrow peaks associated with large $ka$ values. For each identified local maximum at an angle $\\theta_p > 0$, we check if its level $I_{\\mathrm{rel}}(\\theta_p)$ exceeds the specified threshold $\\tau$. If it does, its angle and level are recorded. For numerical stability, the special case for $\\theta=0$ (or more generally, $ka \\sin\\theta = 0$) must be handled by setting $D(0)=1$ to avoid division by zero.\n\n**3. Peak Acoustic Energy Density Calculation**\nThe problem asks for the peak time-averaged acoustic energy density at a range $r$. The peak value occurs on the axis of the piston, where $\\theta=0$. We use the fundamental relation $\\langle E \\rangle = p_{\\mathrm{rms}}^2 / (\\rho c^2)$. The required pressure term is the on-axis RMS pressure at range $r$, which we denote as $p_{\\mathrm{rms, on-axis}}(r)$. Using the provided pressure scaling law and the fact that $D(0)=1$:\n$$\np_{\\mathrm{rms, on-axis}}(r) = p_{\\mathrm{rms}}(r, \\theta=0) = p_{\\mathrm{ref}} \\left(\\frac{r_{\\mathrm{ref}}}{r}\\right) D(0) = p_{\\mathrm{ref}} \\frac{r_{\\mathrm{ref}}}{r}\n$$\nSubstituting this into the energy density formula yields the final expression for the peak time-averaged energy density:\n$$\n\\langle E \\rangle_{\\mathrm{peak}} = \\frac{(p_{\\mathrm{rms, on-axis}}(r))^2}{\\rho c^2} = \\frac{1}{\\rho c^2} \\left( p_{\\mathrm{ref}} \\frac{r_{\\mathrm{ref}}}{r} \\right)^2\n$$\nThis quantity is calculated using the provided physical parameters for each test case.\n\nThe computational implementation will carry out these steps precisely, respecting the specified numerical libraries, data types, and rounding conventions for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j1\nfrom scipy.signal import find_peaks\n\ndef solve():\n    \"\"\"\n    Solves the acoustic analysis problem for a baffled circular piston source.\n    For each test case, it calculates sidelobe locations and intensities,\n    and the peak time-averaged acoustic energy density.\n    \"\"\"\n    \n    # Test cases: (rho, c, a, f, p_ref, r_ref, r, theta_max, tau)\n    test_cases = [\n        (1000, 1500, 0.01, 5000, 2.0, 1.0, 10.0, 90, 0.01),\n        (1.225, 343, 0.1, 4000, 2.0, 1.0, 5.0, 90, 0.02),\n        (1.225, 343, 0.2, 8000, 2.0, 1.0, 20.0, 90, 0.01),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        rho, c, a, f, p_ref, r_ref, r, theta_max_deg, tau = case\n\n        # Step 1: Compute k and ka\n        k = 2 * np.pi * f / c\n        ka = k * a\n\n        # Step 2: Construct the normalized intensity pattern\n        # A dense grid is necessary to resolve sharp sidelobe peaks\n        num_points = 20000 \n        theta_deg = np.linspace(0, theta_max_deg, num_points, endpoint=True)\n        theta_rad = np.deg2rad(theta_deg)\n        \n        # Argument of the Bessel function\n        x = ka * np.sin(theta_rad)\n\n        # Calculate directivity D(theta) = 2*J1(x)/x, handling x=0 case.\n        # D(0) = 1\n        D_theta = np.ones_like(x)\n        # Avoid division by zero for non-zero elements\n        non_zero_x_indices = np.where(x != 0)\n        D_theta[non_zero_x_indices] = 2 * j1(x[non_zero_x_indices]) / x[non_zero_x_indices]\n        \n        # Normalized intensity I_rel = D(theta)^2\n        I_rel = D_theta**2\n\n        # Step 3: Detect sidelobe peaks\n        # find_peaks identifies local maxima. 'height=tau' applies the threshold.\n        # We search from index 1 to ignore the main lobe at theta=0.\n        peak_indices, properties = find_peaks(I_rel, height=tau)\n        \n        # Filter peaks to only include those at theta > 0\n        # Given our grid search starts from 0, any index > 0 is fine.\n        valid_peak_indices = peak_indices[peak_indices > 0]\n        \n        if valid_peak_indices.size > 0:\n            sidelobe_angles = np.round(theta_deg[valid_peak_indices], 2).tolist()\n            sidelobe_intensities = np.round(I_rel[valid_peak_indices], 6).tolist()\n        else:\n            sidelobe_angles = []\n            sidelobe_intensities = []\n\n        # Step 4: Compute peak time-averaged acoustic energy density\n        # p_rms_on_axis(r) = p_ref * (r_ref / r)\n        p_rms_on_axis_r = p_ref * (r_ref / r)\n        \n        # <E>_peak = p_rms_on_axis(r)^2 / (rho * c^2)\n        energy_density = p_rms_on_axis_r**2 / (rho * c**2)\n        rounded_energy_density = round(energy_density, 6)\n        \n        case_result = [sidelobe_angles, sidelobe_intensities, rounded_energy_density]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Our final practice synthesizes these concepts in a comprehensive numerical experiment that simulates the transient flow of acoustic energy from first principles. You will implement a finite-difference time-domain (FDTD) solver to model a wave pulse scattering from an interface, directly computing the instantaneous acoustic intensity $I_x(x,t) = p(x,t) v(x,t)$ at a receiver. This capstone exercise not only provides a powerful tool for visualizing dynamic energy transport but also reinforces a core principle of computational physics: verifying that the simulation respects fundamental laws, such as causality, by ensuring no energy arrives before the physically allowed travel time .",
            "id": "4112673",
            "problem": "Design a numerical experiment in one spatial dimension to simulate a transient acoustic scattering event and to verify causality by ensuring that no energy flux arrives at a specified receiver location earlier than the earliest physically admissible travel time. The simulation must be based entirely on first principles for linear acoustics and must compute the instantaneous acoustic energy density and the instantaneous acoustic energy flux from the evolving acoustic pressure field and particle velocity field.\n\nStart from the linearized momentum conservation and mass conservation for a compressible, inviscid fluid with spatially varying material properties. The medium is piecewise homogeneous with one planar interface at a prescribed position. Implement a staggered-grid, explicit, second-order accurate finite-difference time-domain scheme that respects the Courant–Friedrichs–Lewy stability condition, and include an absorbing boundary treatment to avoid spurious reflections from the computational boundaries. Drive the system with a compact, bandlimited, scalar source at a single grid point using a physically sensible source-time function. The simulation must yield the transient acoustic pressure and particle velocity fields over time.\n\nFrom the simulated fields, compute at the receiver location the instantaneous acoustic energy density and the instantaneous acoustic energy flux. The instantaneous acoustic energy density combines the kinetic component and the compressive potential component. The instantaneous acoustic energy flux equals the acoustic intensity. In one dimension, the sign of the intensity indicates the direction of energy transport. You must derive the expressions used for these quantities from the governing first-principles equations; direct use of pre-memorized target formulas is not permitted.\n\nDefine the earliest physically admissible arrival time at the receiver as the path integral of the reciprocal local sound speed along the straight path between source and receiver through the piecewise homogeneous layers. In one dimension with a single interface at position $x_0$, source position $x_s$, and receiver position $x_r$, this earliest time reduces to a sum of segment lengths divided by the corresponding constant sound speeds in each segment.\n\nVerification of causality must proceed by thresholding the receiver’s instantaneous acoustic intensity time series: declare a causality violation if, for any time $t$ strictly less than the earliest travel time, the absolute magnitude of the instantaneous intensity exceeds a small fraction of the peak absolute intensity observed over the entire simulated time window. Use a fractional threshold of $10^{-5}$ of the peak, and guard against division by zero by adding a small positive floor if necessary.\n\nYour program must implement this experiment and perform the causality check for each of the following test cases. All quantities must be treated in the International System of Units, and any reported time must be in seconds. All distances are in meters, speeds in meters per second, densities in kilograms per cubic meter, pressure in pascals, and time in seconds. Angles do not appear and thus require no specification.\n\nEach test case is a tuple specifying the domain and material parameters, source and receiver placement, and numerical parameters:\n1. $(L,\\Delta x,c_1,c_2,\\rho_1,\\rho_2,x_0,x_s,x_r,f_0,A,\\text{CFL},T_{\\text{end}}) = (3.0, 0.005, 1500.0, 1000.0, 1000.0, 1500.0, 1.5, 0.5, 2.5, 1200.0, 100.0, 0.7, 0.003)$\n2. $(L,\\Delta x,c_1,c_2,\\rho_1,\\rho_2,x_0,x_s,x_r,f_0,A,\\text{CFL},T_{\\text{end}}) = (3.0, 0.005, 1500.0, 1500.0, 1000.0, 1000.0, 1.0, 0.6, 2.6, 2000.0, 80.0, 0.9, 0.003)$\n3. $(L,\\Delta x,c_1,c_2,\\rho_1,\\rho_2,x_0,x_s,x_r,f_0,A,\\text{CFL},T_{\\text{end}}) = (3.0, 0.005, 1400.0, 800.0, 950.0, 1600.0, 2.4, 0.7, 2.45, 2500.0, 60.0, 0.8, 0.002)$\n4. $(L,\\Delta x,c_1,c_2,\\rho_1,\\rho_2,x_0,x_s,x_r,f_0,A,\\text{CFL},T_{\\text{end}}) = (3.2, 0.004, 1500.0, 2000.0, 1000.0, 1200.0, 1.3, 0.4, 2.8, 1800.0, 70.0, 0.99, 0.002)$\n\nWhere:\n- $L$ is the domain length,\n- $\\Delta x$ is the spatial grid spacing,\n- $c_1$ and $c_2$ are the sound speeds in the left and right layers, respectively,\n- $\\rho_1$ and $\\rho_2$ are the densities in the left and right layers, respectively,\n- $x_0$ is the interface position,\n- $x_s$ is the source position,\n- $x_r$ is the receiver position,\n- $f_0$ is the central frequency of a bandlimited source-time function,\n- $A$ is the source amplitude (pressure units),\n- $\\text{CFL}$ is the Courant number for the time step,\n- $T_{\\text{end}}$ is the total simulated time.\n\nYour program must:\n- Implement a staggered-grid finite-difference time-domain update for one-dimensional linear acoustics with spatially varying material properties and absorbing boundary layers.\n- Use a compact, bandlimited source-time function such as a Ricker wavelet centered at time $t_0 = \\frac{3}{f_0}$.\n- Compute at the receiver the instantaneous acoustic energy density and the instantaneous acoustic intensity at consistent time instants.\n- Compute the earliest travel time as the sum of segment lengths divided by the corresponding sound speeds along the straight source-to-receiver path through the two layers.\n- Decide causality for each test case by checking if the absolute intensity exceeds $10^{-5}$ of its peak value at any time earlier than the earliest travel time.\n- Produce a single line of output containing the boolean results for the four test cases as a comma-separated list enclosed in square brackets (for example, \"[True,False,True,True]\").\n\nYour final answers must be booleans for each of the four test cases, and the program must print them in the specified single-line format.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\nThe problem provides the following data, definitions, and constraints for a numerical experiment in one-dimensional computational acoustics:\n\n**Governing Principles:**\n- Linearized momentum and mass conservation for a compressible, inviscid fluid.\n- Spatially varying material properties ($\\rho(x)$, $c(x)$).\n- A piecewise homogeneous medium with a single planar interface at $x_0$.\n- A staggered-grid, explicit, second-order accurate finite-difference time-domain (FDTD) scheme.\n- Courant–Friedrichs–Lewy (CFL) stability condition must be respected.\n- An absorbing boundary treatment is required.\n- A compact, bandlimited, scalar source at a single grid point, with a defined source-time function (e.g., Ricker wavelet).\n\n**Quantities to Compute and Analyze:**\n- Transient acoustic pressure field $p(x,t)$ and particle velocity field $v(x,t)$.\n- Instantaneous acoustic energy density, derived from first principles.\n- Instantaneous acoustic energy flux (intensity), derived from first principles.\n\n**Causality Verification Procedure:**\n- Define the earliest physically admissible arrival time $t_{\\text{arrival}}$ as the path integral of the reciprocal local sound speed. For the given 1D setup with source at $x_s$, receiver at $x_r$, interface at $x_0$, and sound speeds $c_1$ and $c_2$, this simplifies to a sum of travel times through segments.\n- Monitor the instantaneous intensity $I(t)$ at the receiver location $x_r$.\n- A causality violation is declared if $|I(t)| > 10^{-5} \\times \\max_t|I(t)|$ for any time $t < t_{\\text{arrival}}$. A small positive floor must be added to $\\max_t|I(t)|$ to prevent division by zero.\n\n**Test Cases (Parameters):**\nEach test case is a tuple: $(L, \\Delta x, c_1, c_2, \\rho_1, \\rho_2, x_0, x_s, x_r, f_0, A, \\text{CFL}, T_{\\text{end}})$.\n1. $(3.0, 0.005, 1500.0, 1000.0, 1000.0, 1500.0, 1.5, 0.5, 2.5, 1200.0, 100.0, 0.7, 0.003)$\n2. $(3.0, 0.005, 1500.0, 1500.0, 1000.0, 1000.0, 1.0, 0.6, 2.6, 2000.0, 80.0, 0.9, 0.003)$\n3. $(3.0, 0.005, 1400.0, 800.0, 950.0, 1600.0, 2.4, 0.7, 2.45, 2500.0, 60.0, 0.8, 0.002)$\n4. $(3.2, 0.004, 1500.0, 2000.0, 1000.0, 1200.0, 1.3, 0.4, 2.8, 1800.0, 70.0, 0.99, 0.002)$\n\n**Source-Time Function:**\n- Ricker wavelet centered at time $t_0 = 3/f_0$.\n\n**Output Format:**\n- A single line containing a comma-separated list of boolean results (e.g., `[True,False,True,True]`).\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded (Critical):** The problem is firmly rooted in the fundamental principles of linear acoustics, described by the linearized Euler equations. The FDTD method is a standard, scientifically validated technique for solving wave propagation problems. The concept of causality is a cornerstone of physics, and its verification in a numerical simulation is a standard and meaningful exercise. All proposed steps are based on established physics and numerical analysis.\n- **Well-Posed:** The problem provides all necessary parameters, governing equations, initial conditions (quiescent medium), boundary conditions (absorbing), and source terms to set up a well-posed initial-boundary value problem. The solution is expected to be unique and stable, given the satisfaction of the CFL condition.\n- **Objective (Critical):** The problem is stated in precise, objective, and quantitative terms. All parameters are explicitly defined, and the criteria for verification (the causality check) are unambiguous.\n- **No Flaws Detected:** The problem statement does not violate any of the invalidity criteria. It is not scientifically unsound, non-formalizable, incomplete, unrealistic, ill-posed, trivial, or unverifiable. It describes a standard numerical experiment in computational physics.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. A full solution will be provided.\n\n## Solution Derivation and Implementation Strategy\n\nThe solution involves simulating the one-dimensional linear acoustic equations and analyzing the results at a receiver to verify causality. The process is broken down into the following steps.\n\n**1. Governing Equations and Energy Conservation**\n\nWe begin with the first-principles equations for linear acoustics in an inviscid, compressible fluid. These are the linearized Euler equations for momentum and mass conservation in one dimension:\n$$\n\\rho_0(x) \\frac{\\partial v(x,t)}{\\partial t} = -\\frac{\\partial p(x,t)}{\\partial x} \\quad \\text{(Momentum Conservation)}\n$$\n$$\n\\frac{1}{K(x)} \\frac{\\partial p(x,t)}{\\partial t} = -\\frac{\\partial v(x,t)}{\\partial x} \\quad \\text{(Mass Conservation)}\n$$\nwhere $p$ is the acoustic pressure, $v$ is the particle velocity, $\\rho_0(x)$ is the ambient fluid density, and $K(x) = \\rho_0(x) c(x)^2$ is the bulk modulus, with $c(x)$ being the local sound speed.\n\nTo derive the law of energy conservation, we multiply the momentum equation by $v$ and the mass conservation equation by $p$:\n$$\n\\rho_0 v \\frac{\\partial v}{\\partial t} = -v \\frac{\\partial p}{\\partial x}\n$$\n$$\n\\frac{p}{K} \\frac{\\partial p}{\\partial t} = -p \\frac{\\partial v}{\\partial x}\n$$\nRecognizing that $u \\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial t}(\\frac{1}{2}u^2)$, we can rewrite these as:\n$$\n\\frac{\\partial}{\\partial t}\\left(\\frac{1}{2}\\rho_0 v^2\\right) = -v \\frac{\\partial p}{\\partial x}\n$$\n$$\n\\frac{\\partial}{\\partial t}\\left(\\frac{1}{2}\\frac{p^2}{K}\\right) = -p \\frac{\\partial v}{\\partial x}\n$$\nSumming these two equations gives:\n$$\n\\frac{\\partial}{\\partial t}\\left(\\frac{1}{2}\\rho_0 v^2 + \\frac{1}{2}\\frac{p^2}{K}\\right) = -v \\frac{\\partial p}{\\partial x} - p \\frac{\\partial v}{\\partial x}\n$$\nThe right-hand side is the negative of the divergence of the product $pv$, i.e., $-\\frac{\\partial (pv)}{\\partial x}$. This yields the acoustic energy conservation law in differential form:\n$$\n\\frac{\\partial E(x,t)}{\\partial t} + \\frac{\\partial I_x(x,t)}{\\partial x} = 0\n$$\nFrom this derivation, we identify:\n- **Instantaneous Acoustic Energy Density ($E$)**: The sum of kinetic and potential energy densities.\n  $$ E(x,t) = \\underbrace{\\frac{1}{2}\\rho_0(x) v(x,t)^2}_{\\text{Kinetic}} + \\underbrace{\\frac{1}{2}\\frac{p(x,t)^2}{\\rho_0(x) c(x)^2}}_{\\text{Potential}} $$\n- **Instantaneous Acoustic Energy Flux or Intensity ($I_x$)**: The rate of energy transport per unit area.\n  $$ I_x(x,t) = p(x,t) v(x,t) $$\nThese expressions will be used to compute the required quantities from the simulated fields.\n\n**2. Finite-Difference Time-Domain (FDTD) Scheme**\n\nWe employ a staggered grid (Yee grid) for the numerical solution. Pressure $p$ is defined at integer spatial indices $i$ and integer time indices $n$, while velocity $v$ is defined at half-integer spatial indices $i+1/2$ and half-integer time indices $n+1/2$.\n- $p_i^n \\approx p(i\\Delta x, n\\Delta t)$\n- $v_{i+1/2}^{n+1/2} \\approx v((i+1/2)\\Delta x, (n+1/2)\\Delta t)$\n\nThe governing equations are discretized using second-order accurate central differences, leading to a leapfrog time-stepping scheme:\n$$\n\\frac{v_{i+1/2}^{n+1/2} - v_{i+1/2}^{n-1/2}}{\\Delta t} = -\\frac{1}{\\rho_{i+1/2}} \\frac{p_{i+1}^n - p_i^n}{\\Delta x}\n$$\n$$\n\\frac{p_i^{n+1} - p_i^n}{\\Delta t} = -K_i \\frac{v_{i+1/2}^{n+1/2} - v_{i-1/2}^{n+1/2}}{\\Delta x}\n$$\nThe material properties $\\rho_{i+1/2}$ on the velocity grid are computed by averaging the values from the adjacent pressure grid points: $\\rho_{i+1/2} = (\\rho_i + \\rho_{i+1})/2$.\nThe update equations are:\n1.  **Velocity Update**:\n    $$ v_{i+1/2}^{n+1/2} = v_{i+1/2}^{n-1/2} - \\frac{\\Delta t}{\\rho_{i+1/2}\\Delta x} (p_{i+1}^n - p_i^n) $$\n2.  **Pressure Update**:\n    $$ p_i^{n+1} = p_i^n - \\frac{\\Delta t K_i}{\\Delta x} (v_{i+1/2}^{n+1/2} - v_{i-1/2}^{n+1/2}) $$\n\nThe time step $\\Delta t$ is selected based on the CFL condition to ensure stability: $\\Delta t = \\text{CFL} \\frac{\\Delta x}{c_{\\max}}$, where $c_{\\max} = \\max(c_1, c_2)$ and $\\text{CFL} \\le 1$.\n\n**3. Source, Boundaries, and Receiver**\n\n- **Source**: A soft source is implemented by adding a term to the pressure update equation at the source location $i_s$:\n  $$ p_{i_s}^{n+1} \\rightarrow p_{i_s}^{n+1} + \\Delta t \\cdot S(n\\Delta t) $$\n  The source-time function $S(t)$ is a Ricker wavelet:\n  $$ S(t) = A\\left(1 - 2\\pi^2 f_0^2 (t-t_0)^2\\right) e^{-\\pi^2 f_0^2 (t-t_0)^2} $$\n  with the peak-delay time $t_0 = 3/f_0$.\n\n- **Absorbing Boundary Conditions (ABCs)**: To prevent spurious reflections from the domain edges, first-order absorbing boundary conditions are applied. These simulate an outgoing wave by enforcing the one-way wave equation at the boundaries. At the left boundary ($i=0$) and right boundary ($i=N_x-1$):\n  $$ p_0^{n+1} = p_0^n(1 - \\alpha_0) + p_1^n \\alpha_0 $$\n  $$ p_{N_x-1}^{n+1} = p_{N_x-1}^n(1 - \\alpha_{N_x-1}) + p_{N_x-2}^n \\alpha_{N_x-1} $$\n  where $\\alpha_i = c_i \\Delta t / \\Delta x$ is the local Courant number. These updates use pressure values from the previous time step $n$ to explicitly compute the new boundary values at $n+1$.\n\n- **Receiver**: To compute intensity $I(t)$ at the receiver location $x_r$ (grid index $i_r$), we require $p$ and $v$ at the same time and location. Since the grid is staggered, interpolation is necessary. We compute quantities at half-integer time steps $t_{n+1/2}$:\n  - The velocity $v_{i_r}^{n+1/2}$ is spatially interpolated: $v_{i_r}^{n+1/2} = 0.5(v_{i_r-1/2}^{n+1/2} + v_{i_r+1/2}^{n+1/2})$. (Note: in code, if `v` has length `N-1`, this is `0.5*(v[ir-1] + v[ir])`).\n  - The pressure $p_{i_r}^{n+1/2}$ is temporally interpolated: $p_{i_r}^{n+1/2} = 0.5(p_{i_r}^n + p_{i_r}^{n+1})$.\n  The intensity is then $I_{i_r}^{n+1/2} = p_{i_r}^{n+1/2} \\cdot v_{i_r}^{n+1/2}$.\n\n**4. Causality Verification**\n\n- **Earliest Arrival Time ($t_{\\text{arrival}}$)**: This is the time taken for a wave to travel from the source $x_s$ to the receiver $x_r$. For a piecewise medium with an interface at $x_0$:\n  - If source and receiver are in the same segment (e.g., $x_s, x_r < x_0$ or $x_s, x_r > x_0$): $t_{\\text{arrival}} = |x_r - x_s| / c_{\\text{segment}}$.\n  - If they are in different segments (e.g., $x_s < x_0 < x_r$): $t_{\\text{arrival}} = |x_0 - x_s|/c_{\\text{source\\_segment}} + |x_r - x_0|/c_{\\text{receiver\\_segment}}$.\n\n- **Check**: We compute the peak absolute intensity $I_{\\text{peak}} = \\max_t|I(t)|$ over the entire simulation. The causality threshold is $I_{\\text{thresh}} = 10^{-5} \\times (I_{\\text{peak}} + \\epsilon)$, where $\\epsilon$ is a small machine epsilon to guard against a zero peak. We then iterate through the recorded intensity time series. If $|I(t_k)| > I_{\\text{thresh}}$ for any time $t_k < t_{\\text{arrival}}$, a causality violation is flagged. Otherwise, causality is considered verified. The result is a boolean `True` (causality respected) or `False` (violated).\n\nThis comprehensive procedure is implemented for each of the four test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        (3.0, 0.005, 1500.0, 1000.0, 1000.0, 1500.0, 1.5, 0.5, 2.5, 1200.0, 100.0, 0.7, 0.003),\n        (3.0, 0.005, 1500.0, 1500.0, 1000.0, 1000.0, 1.0, 0.6, 2.6, 2000.0, 80.0, 0.9, 0.003),\n        (3.0, 0.005, 1400.0, 800.0, 950.0, 1600.0, 2.4, 0.7, 2.45, 2500.0, 60.0, 0.8, 0.002),\n        (3.2, 0.004, 1500.0, 2000.0, 1000.0, 1200.0, 1.3, 0.4, 2.8, 1800.0, 70.0, 0.99, 0.002),\n    ]\n\n    results = []\n    for case in test_cases:\n        causality_respected = run_simulation(*case)\n        results.append(causality_respected)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(L, dx, c1, c2, rho1, rho2, x0, xs, xr, f0, A, CFL, T_end):\n    \"\"\"\n    Performs a single 1D FDTD acoustic simulation and causality check.\n    \"\"\"\n    # 1. Grid and material parameter setup\n    Nx = int(L / dx)\n    x = np.linspace(0, L, Nx, endpoint=False)\n    \n    c = np.full(Nx, c1)\n    rho = np.full(Nx, rho1)\n    \n    interface_idx = int(x0 / dx)\n    c[interface_idx:] = c2\n    rho[interface_idx:] = rho2\n    \n    K = rho * c**2\n    \n    c_max = max(c1, c2)\n    dt = CFL * dx / c_max\n    Nt = int(T_end / dt)\n    \n    # Staggered grid density for velocity updates\n    rho_v = 0.5 * (rho[:-1] + rho[1:])\n\n    # 2. Source and Receiver setup\n    isource = int(xs / dx)\n    ireceiver = int(xr / dx)\n    \n    # Ricker wavelet source function\n    t0 = 3.0 / f0\n    def ricker_source(t):\n        arg = np.pi**2 * f0**2 * (t - t0)**2\n        return A * (1 - 2 * arg) * np.exp(-arg)\n\n    # 3. FDTD Initialization\n    p = np.zeros(Nx)       # Pressure at integer time steps\n    v = np.zeros(Nx - 1)   # Velocity at half-integer time steps\n    \n    # Storage for receiver data\n    intensity_series = np.zeros(Nt)\n    time_series = np.zeros(Nt)\n\n    # 4. Main FDTD Loop\n    for n in range(Nt):\n        p_old = p.copy()\n\n        # Update velocity (v^{n+1/2} from p^n)\n        v -= (dt / (rho_v * dx)) * np.diff(p_old)\n\n        # Update pressure (p^{n+1} from v^{n+1/2}) - interior\n        p[1:-1] -= (dt * K[1:-1] / dx) * np.diff(v)\n\n        # Add source term (as pressure rate, so it is just added to p update)\n        p[isource] += dt * ricker_source(n * dt)\n        \n        # Apply first-order Absorbing Boundary Conditions (ABCs)\n        # using p_old to maintain explicit scheme\n        alpha_0 = c[0] * dt / dx\n        p[0] = p_old[0] * (1 - alpha_0) + p_old[1] * alpha_0\n        \n        alpha_end = c[-1] * dt / dx\n        p[-1] = p_old[-1] * (1 - alpha_end) + p_old[-2] * alpha_end\n\n        # 5. Record data at receiver\n        # Interpolate p and v to the same time and space point\n        \n        # p at time n+1/2 via temporal averaging\n        p_rec_n_half = 0.5 * (p_old[ireceiver] + p[ireceiver])\n        \n        # v at receiver index ireceiver via spatial averaging\n        v_rec_n_half = 0.5 * (v[ireceiver - 1] + v[ireceiver])\n        \n        # Compute and store instantaneous intensity\n        current_intensity = p_rec_n_half * v_rec_n_half\n        intensity_series[n] = current_intensity\n        time_series[n] = (n + 0.5) * dt\n\n    # 6. Causality Verification\n    # Calculate earliest physical arrival time\n    c_s = c1 if xs  x0 else c2\n    c_r = c1 if xr  x0 else c2\n    \n    if (xs  x0 and xr  x0) or (xs >= x0 and xr >= x0):\n        t_arrival = abs(xr - xs) / c_s\n    else:\n        t_arrival = abs(x0 - xs) / c_s + abs(xr - x0) / c_r\n\n    # Find peak absolute intensity and set threshold\n    peak_intensity = np.max(np.abs(intensity_series))\n    threshold = 1e-5 * (peak_intensity + np.finfo(float).eps)\n\n    # Check for causality violation\n    causality_respected = True\n    pre_arrival_indices = np.where(time_series  t_arrival)[0]\n    \n    if pre_arrival_indices.size > 0:\n        pre_arrival_intensities = np.abs(intensity_series[pre_arrival_indices])\n        if np.any(pre_arrival_intensities > threshold):\n            causality_respected = False\n            \n    return causality_respected\n\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}