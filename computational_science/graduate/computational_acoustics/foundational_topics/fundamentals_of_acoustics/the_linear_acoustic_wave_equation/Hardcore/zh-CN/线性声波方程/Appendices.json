{
    "hands_on_practices": [
        {
            "introduction": "声速是声波方程中的一个关键参数，但它的值取决于声波压缩和稀疏过程中所遵循的热力学模型。本练习旨在通过推导和比较两种不同热力学假设下的声速，来阐明标准声学波动方程背后的物理假设。通过实践，你将能区分在等温（恒温）和等熵（恒定熵）扰动下声速的差异，并理解为何对于空气等流体中的声传播，等熵模型是更为物理真实的选择 。",
            "id": "4144081",
            "problem": "考虑一个处于平衡状态的空间均匀理想气体，其特征为平衡密度 $\\rho_{0}$、平衡压力 $p_{0}$ 和平衡温度 $T_{0}$。令 $R$ 表示比气体常数，令 $\\gamma$ 表示比热比，定义为 $\\gamma = c_{p}/c_{v}$，其中 $c_{p}$ 和 $c_{v}$ 分别是定压比热容和定容比热容。在线性声波方程适用的小振幅极限下，传播速度由热过程施加的约束条件下压力扰动 $p'$ 和密度扰动 $\\rho'$ 之间的线性热力学关系决定。\n\n从基本热力学关系（包括理想气体定律 $p = \\rho R T$ 和基于第一定律的理想气体熵微分）出发，并围绕平衡态进行线性化，推导在以下两种闭合条件下的声速平方 $c^{2}$ 的表达式：\n- 等温扰动（温度 $T$ 保持恒定），\n- 等熵扰动（熵 $s$ 保持恒定）。\n\n然后，通过构建分数差 $$\\Delta = \\frac{c_{\\text{isentropic}}^{2} - c_{\\text{isothermal}}^{2}}{c_{\\text{isothermal}}^{2}},$$ 来量化这两个声速平方之间的差异，并将 $\\Delta$ 仅用比热比 $\\gamma$ 表示。请以无单位的单一闭式解析表达式的形式提供最终答案。无需四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据，问题提出得当且客观，基于热力学和声学的基本原理。\n\n声速的平方 $c^2$ 通常定义为在特定热力学约束下，压力 $p$ 对密度 $\\rho$ 的偏导数。对于围绕平衡态 $(p_0, \\rho_0)$ 的小扰动 $p'$ 和 $\\rho'$，其线性关系为 $p' = c^2 \\rho'$，其中 $c^2 = \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_{\\text{约束}}$。我们将针对两种不同的约束条件（等温和等熵）来评估这个值。\n\n首先，我们推导等温扰动下的声速平方。在这种情况下，温度 $T$ 保持恒定，因此约束条件是 $T = T_0$。主导的热力学关系是理想气体定律：\n$$p = \\rho R T$$\n其中 $R$ 是比气体常数。为了求出等温声速 $c_{\\text{isothermal}}$，我们在 $T$ 恒定的条件下计算 $p$ 对 $\\rho$ 的偏导数：\n$$c_{\\text{isothermal}}^{2} = \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_{T} = \\left(\\frac{\\partial (\\rho R T)}{\\partial \\rho}\\right)_{T}$$\n由于在此微分中 $R$ 和 $T$ 均保持恒定，我们得到：\n$$c_{\\text{isothermal}}^{2} = R T$$\n在平衡温度 $T_0$ 下对此进行评估，我们有：\n$$c_{\\text{isothermal}}^{2} = R T_0$$\n使用平衡态下的理想气体定律 $p_0 = \\rho_0 R T_0$，这也可以表示为 $c_{\\text{isothermal}}^{2} = p_0 / \\rho_0$。\n\n接下来，我们推导等熵扰动下的声速平方。在这种情况下，比熵 $s$ 保持恒定。我们必须首先建立理想气体在等熵过程中压力和密度之间的关系。我们从以比焓 $h$ 表示的吉布斯方程（热力学第一和第二定律的组合）开始：\n$$T ds = dh - v dp$$\n其中 $v = 1/\\rho$ 是比容。对于理想气体，比焓的微分是 $dh = c_p dT$，其中 $c_p$ 是定压比热容。将此式以及理想气体关系 $v = RT/p$ 代入吉布斯方程，得到：\n$$T ds = c_p dT - \\frac{RT}{p} dp$$\n两边同除以 $T$ 得到熵的微分表达式：\n$$ds = c_p \\frac{dT}{T} - R \\frac{dp}{p}$$\n对于等熵过程，$ds = 0$，所以我们有：\n$$c_p \\frac{dT}{T} = R \\frac{dp}{p}$$\n为了关联 $p$ 和 $\\rho$，我们使用理想气体定律 $p = \\rho R T$ 的对数微分：\n$$\\ln(p) = \\ln(\\rho) + \\ln(R) + \\ln(T)$$\n$$ \\frac{dp}{p} = \\frac{d\\rho}{\\rho} + \\frac{dT}{T}$$\n由此，我们可以将 $dT/T$ 表示为 $\\frac{dT}{T} = \\frac{dp}{p} - \\frac{d\\rho}{\\rho}$。将此式代入等熵条件 $c_p \\frac{dT}{T} = R \\frac{dp}{p}$ 中：\n$$c_p \\left(\\frac{dp}{p} - \\frac{d\\rho}{\\rho}\\right) = R \\frac{dp}{p}$$\n重新整理各项以对 $dp$ 和 $d\\rho$ 进行分组：\n$$(c_p - R) \\frac{dp}{p} = c_p \\frac{d\\rho}{\\rho}$$\n使用理想气体的 Mayer 关系式 $R = c_p - c_v$，我们发现 $c_p - R = c_v$，其中 $c_v$ 是定容比热容。方程简化为：\n$$c_v \\frac{dp}{p} = c_p \\frac{d\\rho}{\\rho}$$\n$$\\frac{dp}{p} = \\frac{c_p}{c_v} \\frac{d\\rho}{\\rho}$$\n根据定义，比热比为 $\\gamma = c_p/c_v$。因此，对于等熵过程：\n$$\\frac{dp}{p} = \\gamma \\frac{d\\rho}{\\rho}$$\n将此微分方程从初始状态 $(p_0, \\rho_0)$ 积分到最终状态 $(p, \\rho)$，得到 $\\ln(p/p_0) = \\gamma \\ln(\\rho/\\rho_0)$，这就给出了理想气体著名的等熵关系：\n$$p \\rho^{-\\gamma} = p_0 \\rho_0^{-\\gamma} = \\text{常数}$$\n现在我们可以通过对 $p = (p_0 \\rho_0^{-\\gamma}) \\rho^\\gamma$ 求关于 $\\rho$ 的导数来计算等熵声速 $c_{\\text{isentropic}}$：\n$$c_{\\text{isentropic}}^{2} = \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_{s} = (p_0 \\rho_0^{-\\gamma}) \\frac{d}{d\\rho}(\\rho^\\gamma) = (p_0 \\rho_0^{-\\gamma}) \\gamma \\rho^{\\gamma-1}$$\n在平衡态 $(\\rho = \\rho_0)$ 下评估此式：\n$$c_{\\text{isentropic}}^{2} = (p_0 \\rho_0^{-\\gamma}) \\gamma \\rho_0^{\\gamma-1} = \\gamma \\frac{p_0}{\\rho_0}$$\n再次使用平衡态理想气体定律 $p_0/\\rho_0 = R T_0$，我们也可以将其写为：\n$$c_{\\text{isentropic}}^{2} = \\gamma R T_0$$\n现在我们可以计算分数差 $\\Delta$。我们有两个声速平方的表达式：\n$$c_{\\text{isothermal}}^{2} = R T_0$$\n$$c_{\\text{isentropic}}^{2} = \\gamma R T_0$$\n分数差 $\\Delta$ 定义为：\n$$\\Delta = \\frac{c_{\\text{isentropic}}^{2} - c_{\\text{isothermal}}^{2}}{c_{\\text{isothermal}}^{2}}$$\n代入推导出的表达式：\n$$\\Delta = \\frac{\\gamma R T_0 - R T_0}{R T_0} = \\frac{R T_0 (\\gamma - 1)}{R T_0}$$\n项 $R T_0$ 被消去，留下只用 $\\gamma$ 表示的 $\\Delta$ 的最终表达式：\n$$\\Delta = \\gamma - 1$$",
            "answer": "$$\\boxed{\\gamma - 1}$$"
        },
        {
            "introduction": "将连续的波动方程离散化以便在计算机上求解，不可避免地会引入数值误差。本练习将探讨其中一种最重要的误差——数值色散，即在数值模拟中，不同频率的波以不同的速度传播的现象。通过对一个标准的显式有限差分格式进行冯·诺依曼稳定性分析，你将推导出数值相速度的表达式，并理解它如何偏离真实的物理声速 。",
            "id": "4144103",
            "problem": "考虑均匀介质中声压 $p(x,t)$ 的一维（$1$-D）线性声波方程，其中声速 $c$ 为常数，由下式给出\n$$\n\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}.\n$$\n在间距为 $\\Delta x$ 的均匀空间网格和步长为 $\\Delta t$ 的均匀时间步上，使用中心、二阶精度的有限差分来近似时间和空间的二阶导数，得到显式更新关系\n$$\n\\frac{p_{i}^{n+1} - 2 p_{i}^{n} + p_{i}^{n-1}}{\\Delta t^{2}} = c^{2} \\frac{p_{i+1}^{n} - 2 p_{i}^{n} + p_{i-1}^{n}}{\\Delta x^{2}},\n$$\n其中 $p_{i}^{n}$ 是对 $p(x_{i}, t^{n})$ 在 $x_{i} = i \\Delta x$ 和 $t^{n} = n \\Delta t$ 处的近似。假设周期性边界条件，以允许离散平面波的存在，并通过代入形式为 $p_{i}^{n} = \\hat{p} \\exp\\!\\big(\\mathrm{i}(k\\, i\\, \\Delta x - \\omega\\, n\\, \\Delta t)\\big)$ 的离散平面波拟设（ansatz）来进行 von Neumann 傅里叶分析，其中 $k$ 是波数，$\\omega$ 是角频率。\n\n定义 Courant–Friedrichs–Lewy (CFL) 数 $\\sigma = \\dfrac{c\\, \\Delta t}{\\Delta x}$ 和无量纲波数 $\\kappa = k \\Delta x$。从上述控制方程和给定的离散化方法出发，推导连接 $\\omega$ 和 $k$ 的离散色散关系，并由此得到数值相速度 $v_{p} = \\dfrac{\\omega}{k}$。将数值相速度与物理声速 $c$ 的比值表示为关于 $\\sigma$ 和 $\\kappa$ 的单一闭式解析表达式。\n\n您的最终答案必须是这个关于 $\\dfrac{v_{p}}{c}$ 的单一表达式。不需要进行数值计算，也无需四舍五入。结果是无量纲的，因此不要在最终表达式中包含单位。",
            "solution": "用户希望推导一维线性声波方程的有限差分离散化方案下，数值相速度与物理声速的比值。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   **控制方程**：一维线性声波方程为 $\\dfrac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$。\n-   **有限差分格式**：显式更新关系为 $\\dfrac{p_{i}^{n+1} - 2 p_{i}^{n} + p_{i}^{n-1}}{\\Delta t^{2}} = c^{2} \\frac{p_{i+1}^{n} - 2 p_{i}^{n} + p_{i-1}^{n}}{\\Delta x^{2}}$。\n-   **符号**：$p_{i}^{n}$ 是 $p(x_{i}, t^{n})$ 在 $x_{i} = i \\Delta x$ 和 $t^{n} = n \\Delta t$ 处的近似值。\n-   **边界条件**：假设为周期性边界条件。\n-   **拟设**：使用形式为 $p_{i}^{n} = \\hat{p} \\exp\\!\\big(\\mathrm{i}(k\\, i\\, \\Delta x - \\omega\\, n\\, \\Delta t)\\big)$ 的离散平面波解。\n-   **定义**：\n    -   Courant–Friedrichs–Lewy (CFL) 数：$\\sigma = \\dfrac{c\\, \\Delta t}{\\Delta x}$。\n    -   无量纲波数：$\\kappa = k \\Delta x$。\n-   **目标**：推导数值相速度 $v_{p} = \\dfrac{\\omega}{k}$ 与物理声速 $c$ 的比值，即 $\\dfrac{v_{p}}{c}$，并将其表示为关于 $\\sigma$ 和 $\\kappa$ 的闭式表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n-   **科学依据**：该问题建立在物理学（波动方程）和数值分析（有限差分法，von Neumann 分析）的基本概念之上。所描述的过程是分析求解偏微分方程的数值格式性质的标准且必要的技术。该问题在科学上和事实上都是合理的。\n-   **适定性**：该问题提供了进行推导所需的所有方程和定义。目标陈述清晰，且存在唯一的解析解。\n-   **客观性**：问题以精确的数学语言陈述，没有任何主观或模糊的术语。\n-   **自洽性和一致性**：给定的条件是充分且一致的。不需要外部信息或未陈述的假设。\n-   **其他缺陷**：该问题没有表现出验证清单中列出的任何缺陷，例如非形式化、不完整、不切实际、不适定或过于简单。\n\n**步骤 3：结论与行动**\n\n问题有效。我将继续推导解答。\n\n### 数值相速度的推导\n\n起点是给定的一维波动方程的有限差分近似：\n$$\n\\frac{p_{i}^{n+1} - 2 p_{i}^{n} + p_{i}^{n-1}}{\\Delta t^{2}} = c^{2} \\frac{p_{i+1}^{n} - 2 p_{i}^{n} + p_{i-1}^{n}}{\\Delta x^{2}}\n$$\n我们通过代入离散平面波拟设 $p_{i}^{n} = \\hat{p} \\exp\\!\\big(\\mathrm{i}(k x_i - \\omega t_n)\\big)$ 来进行 von Neumann 傅里叶分析，其中 $x_i = i \\Delta x$ 且 $t_n = n \\Delta t$。\n有限差分方程中的不同项可以表示为：\n-   $p_{i}^{n} = \\hat{p} \\exp(\\mathrm{i}(k i \\Delta x - \\omega n \\Delta t))$\n-   $p_{i}^{n+1} = \\hat{p} \\exp(\\mathrm{i}(k i \\Delta x - \\omega (n+1) \\Delta t)) = p_{i}^{n} \\exp(-\\mathrm{i}\\omega \\Delta t)$\n-   $p_{i}^{n-1} = \\hat{p} \\exp(\\mathrm{i}(k i \\Delta x - \\omega (n-1) \\Delta t)) = p_{i}^{n} \\exp(\\mathrm{i}\\omega \\Delta t)$\n-   $p_{i+1}^{n} = \\hat{p} \\exp(\\mathrm{i}(k (i+1) \\Delta x - \\omega n \\Delta t)) = p_{i}^{n} \\exp(\\mathrm{i}k \\Delta x)$\n-   $p_{i-1}^{n} = \\hat{p} \\exp(\\mathrm{i}(k (i-1) \\Delta x - \\omega n \\Delta t)) = p_{i}^{n} \\exp(-\\mathrm{i}k \\Delta x)$\n\n将这些表达式代入有限差分方程，得到：\n$$\n\\frac{p_{i}^{n} \\exp(-\\mathrm{i}\\omega \\Delta t) - 2 p_{i}^{n} + p_{i}^{n} \\exp(\\mathrm{i}\\omega \\Delta t)}{\\Delta t^{2}} = c^{2} \\frac{p_{i}^{n} \\exp(\\mathrm{i}k \\Delta x) - 2 p_{i}^{n} + p_{i}^{n} \\exp(-\\mathrm{i}k \\Delta x)}{\\Delta x^{2}}\n$$\n假设存在非平凡解（$p_{i}^{n} \\neq 0$），我们可以两边同除以 $p_{i}^{n}$：\n$$\n\\frac{\\exp(\\mathrm{i}\\omega \\Delta t) + \\exp(-\\mathrm{i}\\omega \\Delta t) - 2}{\\Delta t^{2}} = c^{2} \\frac{\\exp(\\mathrm{i}k \\Delta x) + \\exp(-\\mathrm{i}k \\Delta x) - 2}{\\Delta x^{2}}\n$$\n使用欧拉公式 $\\cos(\\theta) = \\frac{\\exp(\\mathrm{i}\\theta) + \\exp(-\\mathrm{i}\\theta)}{2}$，方程变为：\n$$\n\\frac{2\\cos(\\omega \\Delta t) - 2}{\\Delta t^{2}} = c^{2} \\frac{2\\cos(k \\Delta x) - 2}{\\Delta x^{2}}\n$$\n我们应用三角半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\frac{\\theta}{2})$，这意味着 $2\\cos(\\theta) - 2 = -4\\sin^2(\\frac{\\theta}{2})$。\n将此代入方程得到：\n$$\n\\frac{-4 \\sin^{2}\\left(\\frac{\\omega \\Delta t}{2}\\right)}{\\Delta t^{2}} = c^{2} \\frac{-4 \\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x^{2}}\n$$\n消去两边的因子 $-4$，我们得到：\n$$\n\\frac{\\sin^{2}\\left(\\frac{\\omega \\Delta t}{2}\\right)}{\\Delta t^{2}} = c^{2} \\frac{\\sin^{2}\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x^{2}}\n$$\n对两边取平方根，并假设对于前向传播的波，$\\omega$ 和 $k$ 均为正值，那么正弦函数的参数将处于正弦值为正的范围内，因此我们可以写出：\n$$\n\\frac{\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)}{\\Delta t} = \\frac{c}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n这就是数值色散关系。现在，我们引入指定的无量纲参数：CFL数 $\\sigma = \\dfrac{c \\Delta t}{\\Delta x}$ 和无量纲波数 $\\kappa = k \\Delta x$。\n方程两边乘以 $\\Delta t$，我们有：\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right) = \\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\n$$\n我们现在求解角频率 $\\omega$：\n$$\n\\frac{\\omega \\Delta t}{2} = \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n$$\n\\omega = \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n数值相速度定义为 $v_{p} = \\dfrac{\\omega}{k}$。代入 $\\omega$ 的表达式：\n$$\nv_{p} = \\frac{1}{k} \\left( \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\right) = \\frac{2}{k \\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n问题要求的是数值相速度与物理声速的比值，即 $\\dfrac{v_{p}}{c}$：\n$$\n\\frac{v_{p}}{c} = \\frac{2}{c k \\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n为了用 $\\sigma$ 和 $\\kappa$ 表示前面的因子，我们使用它们的定义：\n$$\nc k \\Delta t = \\left(\\frac{c \\Delta t}{\\Delta x}\\right) (k \\Delta x) = \\sigma \\kappa\n$$\n将此结果代入 $\\dfrac{v_{p}}{c}$ 的表达式，我们得到最终的闭式表达式：\n$$\n\\frac{v_{p}}{c} = \\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n这个表达式量化了该格式的数值色散，显示了离散平面波的速度如何依赖于其波数 $k$ 和离散化参数 $\\Delta x$ 和 $\\Delta t$。",
            "answer": "$$\\boxed{\\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)}$$"
        },
        {
            "introduction": "理论分析至关重要，但对数值方法的最终检验来自于其实际表现。这个动手编程练习将指导你实现一个时域有限差分（FDTD）求解器，在一系列逐渐加密的网格上运行它，并对照已知的精确解来计算误差。这个称为网格收敛性研究的过程，使你能够通过实验验证数值格式的理论精度阶数，这是计算科学中的一项基本技能 。",
            "id": "4144095",
            "problem": "考虑小振幅声压扰动在具有恒定平衡密度和声速的均匀无损介质中的一维传播。从第一性原理出发，利用线性化动量平衡、线性化质量守恒和线性状态方程，建立声压的控制方程。然后，基于二阶显式时域有限差分格式构建一个数值求解器。\n\n您的任务是：\n\n- 从适当的线性化连续介质定律推导出一维空间声压场 $p(x,t)$ 的控制偏微分方程。使用以下与上下文相符的基本原理：线性化动量方程 $ \\rho_0 \\,\\partial v/\\partial t = -\\,\\partial p/\\partial x $，线性化连续性方程 $ \\partial \\rho/\\partial t + \\rho_0 \\,\\partial v/\\partial x = 0 $，以及线性状态方程 $ p = c^2 \\rho $，其中 $ \\rho_0 $ 是恒定平衡密度，$ c $ 是恒定声速，$ v(x,t) $ 是质点速度。\n- 在均匀空间网格上为 $p(x,t)$ 构建一个二阶精确的显式时域有限差分（Finite-Difference Time-Domain, FDTD）格式。在空间和时间上使用中心差分，并根据测试用例施加周期性或齐次 Dirichlet 边界条件。不要引入或假设任何目标更新公式；从 Taylor 展开和中心差分近似推导它们。\n- 对于每个测试用例，选择一个能精确满足所选边界条件和控制方程的解析解。分别使用在 $t=0$ 和 $t=\\Delta t$ 处的解析解来初始化离散压力场及其第一个时间层，以便两步显式格式可以在不需要为第一步进行辅助近似的情况下启动。\n- 进行网格收敛性研究：对于一组空间分辨率 $h$（均匀网格尺寸），将解积分到固定的物理时间 $T$（单位为秒），计算在 $t=T$ 时的离散空间 $L^2$ 误差，并在对数-对数坐标上拟合观测误差 $E(h)$ 与 $h$ 的关系，以根据 $ E(h) \\approx C\\,h^p $ 估计观测到的精度阶 $p$。使用 $\\log(E)$ 对 $\\log(h)$ 的线性最小二乘拟合；报告拟合的斜率 $p$。\n- 使用根据 Courant-Friedrichs-Lewy (CFL) 条件 $ \\mathrm{CFL} = c\\,\\Delta t / h $（其中 $ \\mathrm{CFL}  1 $ 以保证稳定性）选择的时间步长 $ \\Delta t $。为精确达到最终时间 $T$ 并同时满足稳定性要求，首先计算名义时间步长 $ \\Delta t_\\mathrm{CFL} = \\mathrm{CFL}\\,h/c $，然后选择步数 $N_t = \\lceil T/\\Delta t_\\mathrm{CFL} \\rceil$，并设置 $ \\Delta t = T/N_t $。\n\n定义和数值细节：\n\n- 空间域：$ x \\in [0,L] $，其中 $L$ 单位为米，声速 $ c $ 单位为米/秒，时间 $ t $ 单位为秒。\n- $t=T$ 时的离散空间 $L^2$ 误差：$ E(h) = \\sqrt{ \\sum_{i} \\big(p_i(T) - p_\\mathrm{exact}(x_i,T)\\big)^2\\,h } $，其中 $ p_i(T) $ 是在网格节点 $ x_i $ 和时间 $T$ 的数值解，$ p_\\mathrm{exact}(x_i,T) $ 是在 $ x_i $ 和 $ T $ 处计算的解析解。\n- 角度单位：所有三角函数均使用弧度。\n- 物理单位：$L$ 使用米，$c$ 使用米/秒，$T$ 使用秒。\n- 将每个观测到的阶数 $p$ 报告为四舍五入到3位小数的浮点数。\n\n测试套件和参数覆盖范围：\n\n为以下三个测试用例提供结果，这些用例探究了不同的边界条件和频谱内容。\n\n- 用例 $1$（周期性边界，基频模式）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，波数指数 $ m = 1 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( 2\\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, 2\\pi m / L $。\n  - 网格尺寸（周期性网格的节点数）：$ N_x \\in \\{ 50, 100, 200, 400 \\} $。\n  - 使用间距为 $ h = L/N_x $ 的均匀网格，并对邻居节点使用周期性环绕。\n\n- 用例 $2$（齐次 Dirichlet 边界，二次谐波）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，模式指数 $ m = 2 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( \\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, \\pi m / L $，该解满足 $ p(0,t) = p(L,t) = 0 $。\n  - 网格尺寸（包括边界的节点数）：$ N_x \\in \\{ 50, 100, 200, 400 \\} $。\n  - 使用间距为 $ h = L/(N_x-1) $ 的均匀网格，并在所有时间层将边界节点设置为零。\n\n- 用例 $3$（周期性边界，在较粗网格上的高阶模式以探究前渐近行为）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，波数指数 $ m = 4 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( 2\\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, 2\\pi m / L $。\n  - 网格尺寸（周期性网格的节点数）：$ N_x \\in \\{ 20, 40, 80, 160 \\} $。\n  - 使用间距为 $ h = L/N_x $ 的均匀网格，并对邻居节点使用周期性环绕。\n\n要求的最终输出格式：\n\n您的程序应产生单行输出，其中包含三个测试用例的观测阶数 $p$，格式为方括号内以逗号分隔的列表，并四舍五入到三位小数，例如 $ [p_1,p_2,p_3] $。程序必须是完整且可直接运行的，不得要求任何用户输入、外部文件或网络访问。唯一允许使用的库是 Python 标准库、Numerical Python (NumPy) 和 Scientific Python (SciPy)。输出量是无量纲的浮点数。",
            "solution": "该问题经评估是有效的。它以线性声学的基本原理为科学基础，数学上是适定的，并为所需的推导、数值实现和分析提供了完整而明确的说明。\n\n### 1. 一维声波方程的推导\n\n声压 $p(x,t)$ 的控制偏微分方程是从连续介质力学的基本原理推导出来的，这些原理针对静止、均匀、无损介质中的小振幅扰动进行了线性化。\n\n提供的第一性原理方程如下：\n1.  线性化动量方程：\n    $$ \\rho_0 \\frac{\\partial v}{\\partial t} = - \\frac{\\partial p}{\\partial x} \\quad (1) $$\n    其中 $\\rho_0$ 是恒定的平衡密度，$v(x,t)$ 是质点速度。\n\n2.  线性化连续性方程（质量守恒）：\n    $$ \\frac{\\partial \\rho}{\\partial t} + \\rho_0 \\frac{\\partial v}{\\partial x} = 0 \\quad (2) $$\n    其中 $\\rho(x,t)$ 是密度的小扰动。\n\n3.  线性状态方程：\n    $$ p = c^2 \\rho \\quad (3) $$\n    其中 $c$ 是恒定的声速，它将声压与声密度联系起来。\n\n为了推导出声压 $p$ 的单一方程，我们消去其他场变量 $v$ 和 $\\rho$。过程如下：\n\n首先，对动量方程 $(1)$ 关于空间坐标 $x$ 求导：\n$$ \\rho_0 \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial v}{\\partial t} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} $$\n假设速度场足够光滑，我们可以交换偏导数的顺序（Clairaut 定理）：\n$$ \\rho_0 \\frac{\\partial}{\\partial t} \\left( \\frac{\\partial v}{\\partial x} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} \\quad (4) $$\n\n接下来，从连续性方程 $(2)$ 中，我们可以用密度扰动 $\\rho$ 来表示速度的空间导数 $\\frac{\\partial v}{\\partial x}$：\n$$ \\frac{\\partial v}{\\partial x} = - \\frac{1}{\\rho_0} \\frac{\\partial \\rho}{\\partial t} $$\n\n将此表达式代入方程 $(4)$：\n$$ \\rho_0 \\frac{\\partial}{\\partial t} \\left( - \\frac{1}{\\rho_0} \\frac{\\partial \\rho}{\\partial t} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} $$\n常数 $\\rho_0$ 被消掉，得到：\n$$ - \\frac{\\partial^2 \\rho}{\\partial t^2} = - \\frac{\\partial^2 p}{\\partial x^2} \\implies \\frac{\\partial^2 \\rho}{\\partial t^2} = \\frac{\\partial^2 p}{\\partial x^2} \\quad (5) $$\n\n最后，使用线性状态方程 $(3)$ 将密度扰动 $\\rho$ 替换为压力 $p$。由于 $c$ 是常数，我们有 $\\rho = p/c^2$。对此式关于时间求二阶导数得到：\n$$ \\frac{\\partial^2 \\rho}{\\partial t^2} = \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} $$\n\n将此结果代入方程 $(5)$，得到最终的控制方程：\n$$ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} = \\frac{\\partial^2 p}{\\partial x^2} $$\n这是一维齐次声波压力方程，通常写作：\n$$ \\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2} $$\n\n### 2. 二阶有限差分格式的推导\n\n我们在一个均匀的时空网格上对波动方程进行离散化。令 $p(x_i, t_n) \\equiv p_i^n$，其中 $x_i = i h$ (空间步长为 $h$)，$t_n = n \\Delta t$ (时间步长为 $\\Delta t$)。我们使用中心有限差分来近似二阶偏导数，这种方法具有二阶精度。\n\n$p(t)$ 在 $t_n$ 点的 Taylor 级数展开为：\n$$ p(t_n \\pm \\Delta t) = p(t_n) \\pm \\Delta t \\frac{\\partial p}{\\partial t}\\bigg|_{t_n} + \\frac{(\\Delta t)^2}{2!} \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{t_n} \\pm \\frac{(\\Delta t)^3}{3!} \\frac{\\partial^3 p}{\\partial t^3}\\bigg|_{t_n} + \\mathcal{O}(\\Delta t^4) $$\n将 $p(t_n + \\Delta t)$ 和 $p(t_n - \\Delta t)$ 的展开式相加，可以消去奇数阶导数项：\n$$ p(t_{n+1}) + p(t_{n-1}) = 2 p(t_n) + (\\Delta t)^2 \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{t_n} + \\mathcal{O}(\\Delta t^4) $$\n求解二阶时间导数，我们得到二阶精确的中心差分近似：\n$$ \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{x_i, t_n} = \\frac{p_i^{n+1} - 2 p_i^n + p_i^{n-1}}{(\\Delta t)^2} + \\mathcal{O}(\\Delta t^2) $$\n\n对于固定时间 $t_n$ 的空间导数，进行类似的推导可得：\n$$ \\frac{\\partial^2 p}{\\partial x^2}\\bigg|_{x_i, t_n} = \\frac{p_{i+1}^n - 2 p_i^n + p_{i-1}^n}{h^2} + \\mathcal{O}(h^2) $$\n\n将这些离散近似代入波动方程 $\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}$：\n$$ \\frac{p_i^{n+1} - 2 p_i^n + p_i^{n-1}}{(\\Delta t)^2} = c^2 \\left( \\frac{p_{i+1}^n - 2 p_i^n + p_{i-1}^n}{h^2} \\right) $$\n\n这是一个显式格式。为了求解下一个时间步的解 $p_i^{n+1}$，我们重新整理方程：\n$$ p_i^{n+1} = 2 p_i^n - p_i^{n-1} + c^2 \\frac{(\\Delta t)^2}{h^2} (p_{i+1}^n - 2 p_i^n + p_{i-1}^n) $$\n引入 Courant-Friedrichs-Lewy (CFL) 数 $\\lambda = \\frac{c \\Delta t}{h}$，更新公式简化为：\n$$ p_i^{n+1} = 2 p_i^n - p_i^{n-1} + \\lambda^2 (p_{i+1}^n - 2 p_i^n + p_{i-1}^n) $$\n这是最终的显式时域有限差分（FDTD）更新规则，在格式稳定的前提下，它在空间和时间上都是二阶精确的。该格式的稳定性条件是 $\\lambda \\le 1$。\n\n### 3. 用于收敛性研究的数值实现\n\n该求解器在 Python 中实现，用于对三个不同的测试用例进行网格收敛性研究。对于每个用例，通过对误差的对数与网格间距的对数进行线性拟合来估计精度阶。\n\n**初始化**：FDTD 格式是一种两步法，需要前两个时间层（$p^n$ 和 $p^{n-1}$）的数据来计算下一个时间层（$p^{n+1}$）。为了在不引入低阶启动误差的情况下开始模拟，我们使用提供的解析解 $p_{\\mathrm{exact}}(x,t)$ 来初始化前两个时间层：\n- $p^0$：在 $t_0 = 0$ 时的压力场，设为 $p_i^0 = p_{\\mathrm{exact}}(x_i, 0)$。\n- $p^1$：在 $t_1 = \\Delta t$ 时的压力场，设为 $p_i^1 = p_{\\mathrm{exact}}(x_i, \\Delta t)$。\n\n**时间步长选择**：为确保稳定性（$\\lambda  1$）并精确达到最终时间 $T$，首先根据指定的 CFL 数计算名义时间步长 $\\Delta t_{\\mathrm{CFL}} = \\mathrm{CFL} \\cdot h / c$。然后计算时间步数 $N_t = \\lceil T / \\Delta t_{\\mathrm{CFL}} \\rceil$，实际使用的时间步长为 $\\Delta t = T / N_t$。这保证了 $N_t \\cdot \\Delta t = T$，并且有效 CFL 数小于或等于指定值。\n\n**边界条件**：\n- **周期性**：计算域是环绕的，最右侧节点的邻居是最左侧的节点，反之亦然。这可以通过使用 `numpy.roll` 来高效实现，以向量化的方式同时为所有 $i$ 访问 $p_{i-1}^n$ 和 $p_{i+1}^n$。对于具有 $N_x$ 个节点的网格，间距为 $h=L/N_x$。\n- **齐次 Dirichlet**：边界处的压力在所有时间都固定为零，即 $p(0,t) = p(L,t) = 0$。在离散模型中，对所有 $n$ 都有 $p_0^n = p_{N_x-1}^n = 0$。FDTD 更新规则仅应用于内部网格点。对于具有 $N_x$ 个节点（包括边界）的网格，间距为 $h=L/(N_x-1)$。\n\n**误差计算与收敛性**：对于每个测试用例，在具有不同尺寸 $N_x$ 的一系列逐渐变细的网格上运行模拟。在最终时间 $T$，使用以下公式计算离散空间 $L^2$ 误差：\n$$ E(h) = \\sqrt{ \\sum_{i} \\big(p_i(T) - p_\\mathrm{exact}(x_i,T)\\big)^2\\,h } $$\n其中 $p_i(T)$ 是数值解，$p_\\mathrm{exact}(x_i,T)$ 是在网格点 $x_i$ 和时间 $T$ 处的解析解。求和遍及所有网格点。\n理论收敛率是 $E(h) \\approx C h^p$，其中 $p$ 是精度阶。通过取对数，我们得到 $\\log(E) \\approx \\log(C) + p \\log(h)$。对不同网格分辨率的 $(\\log(h), \\log(E))$ 数据对进行线性最小二乘拟合。所得直线的斜率提供了观测到的精度阶 $p$ 的估计。\n\n该实现系统地遵循这些步骤来处理三个指定的测试用例，并报告每个用例的拟合斜率 $p$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    \n    def run_convergence_study(L, c, T, CFL, m, Nx_values, bc_type, k_factor, p_func):\n        \"\"\"\n        Solves one test case, performs a convergence study, and returns the observed order of accuracy.\n\n        Args:\n            L (float): Domain length.\n            c (float): Speed of sound.\n            T (float): Final simulation time.\n            CFL (float): Courant-Friedrichs-Lewy number for time step selection.\n            m (int): Mode or wavenumber index.\n            Nx_values (list): List of grid sizes (number of nodes).\n            bc_type (str): Boundary condition type ('periodic' or 'dirichlet').\n            k_factor (float): Factor in the analytic solution's wavenumber (e.g., 2*pi).\n            p_func (function): Spatial function in analytic solution (e.g., np.sin).\n\n        Returns:\n            float: The observed order of accuracy.\n        \"\"\"\n        h_values = []\n        errors = []\n\n        for Nx in Nx_values:\n            # 1. Setup grid and time step\n            if bc_type == 'periodic':\n                h = L / Nx\n                x = np.linspace(0, L, Nx, endpoint=False)\n            elif bc_type == 'dirichlet':\n                h = L / (Nx - 1)\n                x = np.linspace(0, L, Nx)\n            else:\n                raise ValueError(\"Unknown boundary condition type.\")\n            \n            h_values.append(h)\n\n            dt_cfl = CFL * h / c\n            # Ensure number of steps is an integer and final time T is met exactly\n            Nt = int(np.ceil(T / dt_cfl))\n            dt = T / Nt\n\n            # 2. Define analytic solution\n            omega = c * k_factor * m / L\n            p_exact = lambda x_grid, time: p_func(k_factor * m * x_grid / L) * np.cos(omega * time)\n\n            # 3. Initialize pressure fields at t=0 and t=dt\n            p_prev = p_exact(x, 0)\n            p_curr = p_exact(x, dt)\n            \n            # The square of the CFL number used in the update\n            lambda_sq = (c * dt / h)**2\n\n            # 4. Time-stepping loop\n            # Start from n=1, loop Nt-1 times to reach t=Nt*dt=T\n            for _ in range(1, Nt):\n                if bc_type == 'periodic':\n                    # Vectorized update using np.roll for periodic boundaries\n                    p_laplacian = np.roll(p_curr, -1) - 2 * p_curr + np.roll(p_curr, 1)\n                    p_next = 2 * p_curr - p_prev + lambda_sq * p_laplacian\n                \n                elif bc_type == 'dirichlet':\n                    p_next = np.zeros_like(p_curr)\n                    # Sliced update for interior points; boundaries remain zero\n                    p_laplacian_interior = p_curr[2:] - 2 * p_curr[1:-1] + p_curr[0:-2]\n                    p_next[1:-1] = 2 * p_curr[1:-1] - p_prev[1:-1] + lambda_sq * p_laplacian_interior\n                \n                # Advance time levels\n                p_prev, p_curr = p_curr, p_next\n\n            # 5. Compute discrete L2 error at the final time T\n            p_final_exact = p_exact(x, T)\n            error = np.sqrt(np.sum((p_curr - p_final_exact)**2 * h))\n            errors.append(error)\n\n        # 6. Perform linear regression on log-log data to find order of accuracy\n        log_h = np.log(np.array(h_values))\n        log_e = np.log(np.array(errors))\n        \n        # Fit a line (degree 1 polynomial) to the data. The slope is the order of accuracy.\n        p, _ = np.polyfit(log_h, log_e, 1)\n\n        return p\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 1,\n            \"Nx_values\": [50, 100, 200, 400], \"bc_type\": \"periodic\",\n            \"k_factor\": 2 * np.pi, \"p_func\": np.sin\n        },\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 2,\n            \"Nx_values\": [50, 100, 200, 400], \"bc_type\": \"dirichlet\",\n            \"k_factor\": np.pi, \"p_func\": np.sin\n        },\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 4,\n            \"Nx_values\": [20, 40, 80, 160], \"bc_type\": \"periodic\",\n            \"k_factor\": 2 * np.pi, \"p_func\": np.sin\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p_observed = run_convergence_study(**case)\n        results.append(p_observed)\n\n    # Format and print the final results as specified.\n    # The output quantities are dimensionless floating-point numbers rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}