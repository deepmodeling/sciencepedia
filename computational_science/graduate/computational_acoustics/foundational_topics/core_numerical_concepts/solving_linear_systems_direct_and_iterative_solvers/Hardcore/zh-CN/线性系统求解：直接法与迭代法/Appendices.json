{
    "hands_on_practices": [
        {
            "introduction": "在计算声学中，选择直接求解器还是迭代求解器是一个首要的策略性决策。本练习将指导你像计算科学家一样思考，通过设计一个基准测试来比较这两种求解器。通过这个过程，你将深入理解计算成本（时间和内存）如何随问题规模（由频率驱动）扩展，而这正是做出正确选择的关键。",
            "id": "4137440",
            "problem": "需要设计一个外部声散射基准问题，以比较在完美匹配层（PML）截断下直接求解器和迭代求解器的性能。控制连续介质模型从均匀、无粘性流体中的声压 $p(\\mathbf{x},t)$ 的线性化声学波动方程开始，其声速为 $c_0$，质量密度为 $\\rho_0$，\n$$\\frac{1}{c_0^2}\\,\\partial_t^2 p - \\nabla^2 p = 0,$$\n并采用时谐拟设 $p(\\mathbf{x},t) = \\Re\\{\\hat{p}(\\mathbf{x})\\,e^{-\\mathrm{i}\\omega t}\\}$，其中角频率为 $\\omega$，这导出了复振幅 $\\hat{p}(\\mathbf{x})$ 的亥姆霍兹方程，\n$$\\nabla^2 \\hat{p} + k^2 \\hat{p} = 0,\\quad k = \\frac{\\omega}{c_0},$$\n同时在散射体表面施加适当的边界条件，并在远场施加索末菲辐射条件。为了在有限计算域中模拟无界域，附加了一层完美匹配层（PML），通过复坐标伸缩实现，该方法在一致离散化时能够无反射地衰减出射波。\n\n在特征尺寸为 $h$、多项式阶数为 $p$ 的准均匀网格上进行有限元离散化，会产生一个线性代数系统 $\\mathbf{A}(k)\\mathbf{u}=\\mathbf{b}$，其中 $\\mathbf{A}(k)$ 是一个大型、稀疏、复数、非厄米且不定的矩阵。对于固定的物理散射体尺寸和固定的每波长点数 $n_{\\text{ppw}}$（用于控制色散误差），$h$ 被设置为与局部波长 $\\lambda = 2\\pi/k$ 成正比，因此 $h \\propto 1/k$。在这些假设下，自由度（DOF）数量 $N$ 和计算成本随 $k$ 的缩放方式与维度相关。\n\n您需要选择一个单一的基准规范，该规范对于使用PML的外部散射问题是科学上合理的，在几何、网格和性能指标方面包含足够的细节以比较直接和迭代求解器，并且其关于计算成本如何随频率 $f$（等效于波数 $k$）缩放的假设可以从第一性原理推导出来。请选择最符合这些要求的选项。\n\nA. 几何：一个位于原点的半径为 $a$ 的刚性（声硬）球体，在空气中，其中 $c_0 = 343\\,\\mathrm{m/s}$，$\\rho_0 = 1.21\\,\\mathrm{kg/m^3}$。入射场：平面波 $\\hat{p}_{\\text{inc}}(\\mathbf{x}) = p_0 e^{\\mathrm{i}k x}$。计算域：一个外半径为 $R_{\\text{out}} = a + 3\\lambda$ 的球体；PML：厚度为 $L_{\\text{pml}} = \\lambda$ 的球壳，其径向伸缩剖面 $\\sigma(r)$ 经过调整，使得在整个频率范围内PML界面的伪反射低于 $10^{-6}$。离散化：在物理域和PML内部均使用多项式阶数 $p=3$ 和每波长点数 $n_{\\text{ppw}}=10$ 的协调四面体有限元，因此 $h \\approx \\lambda/n_{\\text{ppw}}$。求解器：稀疏LU直接分解法和带有移位拉普拉斯预条件子 $(\\nabla^2 + k^2 + \\mathrm{i}\\beta)$ 的广义最小残差法（GMRES），其中移位量 $\\beta$ 选择为与 $k^2$ 成正比，以在 $k$ 变化时保持鲁棒性。指标：组装、分解和求解的墙上时钟时间；峰值内存；GMRES达到相对残差 $10^{-8}$ 的迭代次数；与刚性球体的Mie级数解析解相比的相对 $L^2$ 误差 $\\|\\hat{p}-\\hat{p}_{\\text{exact}}\\|_{L^2}/\\|\\hat{p}_{\\text{exact}}\\|_{L^2}$；PML反射估计。假设：在 $3\\mathrm{D}$ 中，对于固定的 $a$ 和固定的 $n_{\\text{ppw}}$，$N \\asymp k^3$。稀疏直接分解时间 $T_{\\text{dir}} \\asymp N^2 \\asymp k^6$，内存 $M_{\\text{dir}} \\asymp N^{4/3} \\asymp k^4$（嵌套剖分缩放）。使用鲁棒的移位拉普拉斯预条件子，GMRES迭代次数保持为 $O(1)$ 或最多随 $k$ 缓慢变化，因此 $T_{\\text{it}} \\asymp N \\asymp k^3$；若无鲁棒预条件子，迭代次数可能以 $k^\\alpha$ 的形式增长，其中 $1 \\le \\alpha \\le 2$。\n\nB. 几何：一个边长为 $2a$ 的带尖角的立方体；边界条件被视为刚性。计算域：一个半径为 $R_{\\text{out}} = 5a$ 的球体，附加一个厚度固定为 $L_{\\text{pml}} = 0.1$ 且不随 $\\lambda$ 变化的PML。离散化：在四面体网格上使用线性 ($p=1$) 元，网格尺寸固定为 $h = 0.01$ 且不随 $k$ 变化。求解器：稀疏LU直接法和无预处理的GMRES。指标：仅有GMRES达到相对残差 $10^{-6}$ 的迭代次数。假设：$N$ 与 $k$ 无关；$T_{\\text{dir}} \\propto k^2$；$T_{\\text{it}} \\propto k$。\n\nC. 几何：二维外部散射问题，散射体为空气中半径为 $a$ 的声软圆柱体。计算域：一个半径为 $R_{\\text{out}} = a + 2\\lambda$ 的圆盘；PML：厚度为 $L_{\\text{pml}} = \\lambda$ 的环形层，采用标准多项式衰减剖面；离散化：二次 ($p=2$) 三角形有限元，$n_{\\text{ppw}}=10$ 因此 $h \\approx \\lambda/n_{\\text{ppw}}$，以及一致的PML网格划分。求解器：稀疏LU直接法和带有与选项A中调整方式相同的移位拉普拉斯预条件子的GMRES。指标：组装、分解和求解时间；峰值内存；GMRES达到相对残差 $10^{-8}$ 的迭代次数；与级数解析解相比的相对 $L^2$ 误差。假设：在 $2\\mathrm{D}$ 中，$N \\asymp k$；$T_{\\text{dir}} \\asymp k^2$；$M_{\\text{dir}} \\asymp k$；$T_{\\text{it}} \\asymp k$。\n\nD. 几何：空气中半径为 $a$ 的刚性球体；入射平面波如选项A。计算域：半径为 $R_{\\text{out}} = a + 3\\lambda$ 的球体；截断在外部边界上使用一阶吸收边界条件，而不是完美匹配层（PML）。离散化：仅在物理域中使用线性 ($p=1$) 四面体网格，其中 $h \\approx \\lambda/8$。求解器：共轭梯度法（CG）和稀疏Cholesky分解。指标：墙上时钟时间、内存以及与参考解的误差。假设：$N \\asymp k^3$；$T_{\\text{dir}} \\asymp k^3$；$M_{\\text{dir}} \\asymp k^2$；$T_{\\text{it}} \\asymp k^2$。\n\n选择内部一致、恰当使用PML、为公平比较指定了科学合理的网格和指标、并且其缩放假设遵循所述物理和数值假设的唯一选项。",
            "solution": "用户提供了一个关于设计基准问题以比较外部声散射问题直接与迭代求解器性能的问题陈述。任务是选择代表了科学上合理的基准规范，且包含正确的计算成本缩放假设的选项。\n\n### 问题验证\n\n首先，根据指令，我将验证问题陈述的主体部分，不包括选项。\n\n**步骤1：提取已知信息**\n- 控制连续介质模型：线性化声学波动方程，$\\frac{1}{c_0^2}\\,\\partial_t^2 p - \\nabla^2 p = 0$。\n- 流体性质：均匀、无粘性，声速为 $c_0$，质量密度为 $\\rho_0$。\n- 时谐拟设：$p(\\mathbf{x},t) = \\Re\\{\\hat{p}(\\mathbf{x})\\,e^{-\\mathrm{i}\\omega t}\\}$。\n- 频域方程：亥姆霍兹方程，$\\nabla^2 \\hat{p} + k^2 \\hat{p} = 0$，波数 $k = \\frac{\\omega}{c_0}$。\n- 边界条件：散射体表面的条件和远场的索末菲辐射条件。\n- 域截断：通过复坐标伸缩实现的完美匹配层（PML）。\n- 离散化：在尺寸为 $h$、多项式阶数为 $p$ 的准均匀网格上使用有限元法（FEM）。\n- 得到的线性系统：$\\mathbf{A}(k)\\mathbf{u}=\\mathbf{b}$。\n- $\\mathbf{A}(k)$ 的性质：大型、稀疏、复数、非厄米且不定。\n- 用于色散控制的网格划分约束：固定的每波长点数 $n_{\\text{ppw}}$，导致 $h \\propto \\lambda \\propto 1/k$。\n- 缩放分析：自由度数量（$N$）和计算成本对波数 $k$ 的依赖关系。\n\n**步骤2：使用提取的已知信息进行验证**\n- **科学基础：** 问题陈述牢固地建立在计算声学的既定理论之上。从波动方程到亥姆霍兹方程的推导、使用FEM进行离散化、应用PML处理无界域，以及对所得线性系统的特性描述，都是标准且正确的。\n- **适定性：** 任务定义明确：根据科学合理性、完整性和缩放假设的正确性，从一系列选项中选择最佳的基准规范。这是一个适定的选择问题。\n- **客观性：** 所用语言技术性强、精确且无主观性。\n\n**步骤3：结论与行动**\n问题陈述是有效的。它为频域声学分析提供了一个正确且标准的框架。任务的核心现在是根据这个框架和数值分析的第一性原理来评估所提供的选项。\n\n### 理论缩放定律的推导\n\n在评估选项之前，我们先建立在 $d$ 维空间问题中，假设计算域尺寸固定（与散射体尺寸 $a$ 成正比）且网格分辨率准则为 $h \\propto \\lambda \\propto 1/k$ 的情况下，计算成本作为波数 $k$ 函数的正确缩放规律。\n\n1.  **自由度数量（$N$）**：网格单元的数量与计算体积除以单个单元的体积成正比。自由度数量 $N$ 与单元数量成正比。\n    $$N \\propto \\frac{\\text{体积}}{h^d} \\propto \\frac{O(1)}{(1/k)^d} = O(k^d)$$\n    - 对于 3D ($d=3$)：$N \\asymp k^3$。\n    - 对于 2D ($d=2$)：$N \\asymp k^2$。\n\n2.  **直接求解器成本（带嵌套剖分的稀疏LU）**：根据稀疏矩阵理论，分解一个由 $d$ 维网格问题产生的稀疏矩阵的计算复杂度是已知的。\n    - **时间复杂度（$T_{\\text{dir}}$）**：\n        - 对于 3D ($d=3$)：$T_{\\text{dir}} \\asymp N^2 \\asymp (k^3)^2 = k^6$。\n        - 对于 2D ($d=2$)：$T_{\\text{dir}} \\asymp N^{3/2} \\asymp (k^2)^{3/2} = k^3$。\n    - **因子所需的内存/存储复杂度（$M_{\\text{dir}}$）**：\n        - 对于 3D ($d=3$)：$M_{\\text{dir}} \\asymp N^{4/3} \\asymp (k^3)^{4/3} = k^4$。\n        - 对于 2D ($d=2$)：$M_{\\text{dir}} \\asymp N \\log N \\asymp k^2 \\log k$。\n\n3.  **迭代求解器成本（预处理的GMRES）**：成本是迭代次数与每次迭代成本的乘积。\n    - **每次迭代成本**：主要由一次稀疏矩阵向量乘积决定，成本为 $O(\\text{nnz}(\\mathbf{A}))$。对于有限元矩阵，非零元素数量 $\\text{nnz}(\\mathbf{A}) \\asymp N$。因此，每次迭代的成本为 $O(N)$。\n    - **迭代次数（$I(k)$）**：这在很大程度上取决于预条件子。对于不定的亥姆霍兹方程，无预处理的GMRES迭代次数会随 $k$ 增长，通常 $I(k) \\asymp k$。一个“鲁棒”的预条件子是指能使 $I(k)$ 保持常数或随 $k$ 增长非常缓慢（例如，多对数增长）的预条件子。\n    - **使用鲁棒预条件子（$I(k) \\asymp O(1)$）的总时间（$T_{\\text{it}}$）**：\n        $$T_{\\text{it}} = I(k) \\times O(N) \\asymp N$$\n        - 对于 3D ($d=3$)：$T_{\\text{it}} \\asymp N \\asymp k^3$。\n        - 对于 2D ($d=2$)：$T_{\\text{it}} \\asymp N \\asymp k^2$。\n\n有了这些参考缩放规律，我们现在可以评估每个选项。\n\n### 逐项分析\n\n**A. 几何：一个刚性球体...**\n- **基准规范**：该选项描述了一个适定的3D基准问题。几何形状（球体）允许与Mie级数解析解进行验证。材料属性已指定。数值方法（高阶有限元， $p=3$）和网格策略（$n_{\\text{ppw}}=10$）是合理的。使用PML并指定性能目标是恰当的。求解器的选择（稀疏LU vs. 预处理的GMRES）以及特定的移位拉普拉斯预条件子是标准且相关的。指标（时间、内存、迭代次数、误差）是全面的。计算域半径 $R_{\\text{out}} = a + 3\\lambda$ 的定义略显非标准，因为它意味着域尺寸会随着 $k$ 的增大而缩小。然而，所提供的缩放定律与标准假设（固定尺寸计算域）一致，而这些缩放定律正是在该背景下才有意义。这表明措辞可能不精确，但基于标准模型，其核心假设是正确的。\n- **假设 (3D)**：\n    - $N \\asymp k^3$：**正确**。对于一个固定体积的3D问题，这可以从第一性原理推导出来。\n    - $T_{\\text{dir}} \\asymp N^2 \\asymp k^6$：**正确**。与3D嵌套剖分的理论缩放规律相符。\n    - $M_{\\text{dir}} \\asymp N^{4/3} \\asymp k^4$：**正确**。与3D嵌套剖分的理论缩放规律相符。\n    - $T_{\\text{it}} \\asymp N \\asymp k^3$（使用鲁棒预处理）：**正确**。假设预条件子使迭代次数为 $O(1)$，这正是此类预条件子的目标。\n- **结论**：**正确**。此选项提供了一个科学上合理、全面且可验证的基准规范，其缩放假设与已建立的3D问题数值分析理论一致。\n\n**B. 几何：一个立方体...**\n- **基准规范**：该规范有几个关键缺陷。\n    1.  带尖角的立方体引入了几何奇异点，这对于一个旨在测试求解器性能与频率关系的纯粹基准问题来说是不希望的。\n    2.  厚度固定的PML（$L_{\\text{pml}} = 0.1$）是无效的；其厚度必须与波长（$\\lambda$）成比例缩放，才能在一定频率范围内有效吸收波。\n    3.  与 $k$ 无关的固定网格尺寸 $h = 0.01$ 在根本上是不合理的。它违反了波动问题的类奈奎斯特准则，随着 $k$ 的增加会导致灾难性的色散误差（污染）。每波长点数 $n_{\\text{ppw}} = \\lambda/h \\propto 1/k$ 会下降，使解变得毫无意义。\n    4.  指标不充分，仅测量迭代次数。\n- **假设**：\n    - $N$ 与 $k$ 无关：这是固定 $h$ 这一错误假设的结果，但它使模拟在物理上无意义。\n    - $T_{\\text{dir}} \\propto k^2$：**不正确**。对于固定网格（$N$ 是常数），LU分解时间是常数，与矩阵中的值无关，因此 $T_{\\text{dir}} \\asymp O(1)$。\n- **结论**：**不正确**。由于其设计中存在多个根本性错误（PML、网格划分），所提议的基准在科学上是不合理的，并且其假设也不正确。\n\n**C. 几何：二维...圆柱...**\n- **基准规范**：一个2D问题的设置（圆柱体、 $p=2$ 三角形、PML、求解器、指标）在很大程度上是合理的，质量与选项A相似。\n- **假设 (2D)**：\n    - $N \\asymp k$：**不正确**。如上所述，对于2D问题，自由度数量应按 $N \\asymp k^2$ 缩放。这个初始错误使其后的假设全部失效。\n    - $T_{\\text{dir}} \\asymp k^2$：**不正确**。正确的缩放规律是 $T_{\\text{dir}} \\asymp N^{3/2} \\asymp (k^2)^{3/2} = k^3$。\n    - $M_{\\text{dir}} \\asymp k$：**不正确**。正确的缩放规律是 $M_{\\text{dir}} \\asymp N \\log N \\asymp k^2 \\log k$。\n    - $T_{\\text{it}} \\asymp k$：**不正确**。正确的缩放规律是 $T_{\\text{it}} \\asymp N \\asymp k^2$。\n- **结论**：**不正确**。尽管实验设计合理，但其缩放假设对于2D问题是根本错误的。\n\n**D. 几何：一个刚性球体... ABC...**\n- **基准规范**：该选项在其数值方法的选择上存在两个关键错误。\n    1.  它提议使用共轭梯度（CG）法和Cholesky分解。问题矩阵 $\\mathbf{A}(k)$ 是复数且非厄米的。CG和Cholesky仅适用于厄米正定矩阵。它们在数学上不适用于此问题。LU分解和GMRES（如选项A中）才是恰当的选择。\n    2.  它偏离了问题陈述中使用PML的目标，而是采用了一阶吸收边界条件（ABC）。众所周知，低阶ABC的准确性远低于PML，这使其成为高保真度基准的不良选择。\n- **假设 (3D)**：\n    - $N \\asymp k^3$：**正确**。\n    - $T_{\\text{dir}} \\asymp k^3$：**不正确**。3D直接求解器的正确缩放规律是 $k^6$。\n    - $M_{\\text{dir}} \\asymp k^2$：**不正确**。3D直接求解器的正确内存缩放规律是 $k^4$。\n    - $T_{\\text{it}} \\asymp k^2$：**不正确**。迭代求解器时间为 $T_{\\text{it}} \\asymp I(k) \\times N \\asymp I(k) \\times k^3$。该假设将意味着迭代次数 $I(k) \\asymp 1/k$，这是不合逻辑的。\n- **结论**：**不正确**。此选项为该问题类型提议了根本错误的求解器，并提供了不正确的缩放定律。\n\n### 结论\n\n选项A是唯一一个提出了科学上合理且内部一致的基准规范的选项。其问题选择、数值方法、指标，以及最重要的——关于计算复杂度缩放的假设，都符合计算科学和3D波动问题数值分析的原理。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "既然我们已经了解了迭代求解器在可扩展性上的优势，那么下一个问题就是：该选择哪一种？本练习将挑战你分析两种主流方法——GMRES 和 BiCGStab——的根本区别。通过剖析它们的核心机制，你将能够掌握在保证收敛（GMRES）和维持低内存占用（BiCGStab）之间进行权衡的艺术，这对于高效求解非厄米不定系统至关重要。",
            "id": "4137402",
            "problem": "您正在求解一个由亥姆霍兹方程和一阶吸收边界条件所支配的频域声学散射问题。标准的有限元离散化会产生一个线性系统 $A x = b$，其中 $A \\in \\mathbb{C}^{n \\times n}$ 是复对称且不定的，即 $A = A^{T} \\neq A^{H}$。考虑两种克雷洛夫子空间方法：双共轭梯度稳定法 (BiCGStab) 和广义最小残差法 (GMRES)。仅从克雷洛夫子空间、残差以及关于标准共轭内积的正交性定义出发，执行以下推理步骤：\n\n- 对于广义最小残差法 (GMRES)，推导对由 $A$ 作用于初始残差 $r_{0} = b - A x_{0}$ 生成的克雷洛夫基向量进行标准正交化所产生的递推结构，并解释为什么在第 $m$ 次迭代时，它能在仿射空间 $x_{0} + \\mathcal{K}_{m}(A, r_{0})$ 上提供使残差的2-范数最小化的近似解。\n\n- 对于双共轭梯度稳定法 (BiCGStab)，从应用于 $A$ 和 $A^{H}$ 的双兰索斯思想出发，使用固定的影子残差 $\\hat{r}_{0}$ 来施加双正交条件，并推导用于产生更新的迭代解和残差的搜索方向、中间残差和稳定化步骤的短递推关系。\n\n然后，基于您的推导和这些方法的基本性质，选择所有对于计算声学中出现的复对称不定系统的应用是正确的陈述：\n\nA. 双共轭梯度稳定法 (BiCGStab) 使用短递推，并存储固定数量的向量，内存成本为 $\\mathcal{O}(n)$，与迭代次数无关，但当递推中的标量分母变为零时（例如，当双正交内积消失或稳定化参数变为零时），它可能会中断。广义最小残差法 (GMRES) 通过阿诺德型过程构建一个标准正交克雷洛夫基，并且必须存储所有直到当前或重启长度的基向量，在 $m$ 次迭代后内存成本为 $\\mathcal{O}(m n)$。\n\nB. 对于复对称矩阵 $A = A^{T}$，取双共轭梯度稳定法 (BiCGStab) 的影子残差 $\\hat{r}_{0} = r_{0}$ 并且不使用共轭（即用纯转置替换共轭转置），可以保持形式上的递推关系，并保证残差的2-范数单调递减。\n\nC. 完全（非重启的）广义最小残差法 (GMRES) 在每次迭代中在当前克雷洛夫子空间上最小化残差的2-范数，产生一个非增的残差范数序列，并且在精确算术下不会出现真正的中断，除非在克雷洛夫子空间内达到精确解时发生所谓的幸运中断，其代价是每次迭代的存储和正交化工作量都会增加。\n\nD. 在精确算术下，对于任何可对角化的矩阵 $A \\in \\mathbb{C}^{n \\times n}$，双共轭梯度稳定法 (BiCGStab) 都保证在至多 $n$ 步内收敛。\n\nE. 对于复对称不定矩阵 $A$，用转置双线性形式 $x^{T} y$ 代替标准共轭内积 $x^{H} y$ 来构建双共轭梯度稳定法 (BiCGStab)，可以在精确算术下完全消除中断。\n\nF. 在高波数的亥姆霍兹问题中，$A$ 的非正规性和不定性通常会导致重启的广义最小残差法 (GMRES) 停滞以及双共轭梯度稳定法 (BiCGStab) 的不稳定收敛；在实践中，预处理器的质量在很大程度上决定了这两种方法的收敛行为。\n\n选择所有适用的选项。在最终选择中不要提供推导过程；推导过程只应为您的内部选择提供信息。",
            "solution": "问题陈述提供了一个来自计算声学的有效场景，并要求分析两种标准的克雷洛夫子空间方法——广义最小残差法 (GMRES) 和双共轭梯度稳定法 (BiCGStab)——用于求解由此产生的线性系统。该系统矩阵 $A$ 是复对称的 ($A=A^T$)、不定的且非厄米特的 ($A \\neq A^H$)。此问题具有科学依据、良定且客观。我们将按照要求，首先推导 GMRES 和 BiCGStab 的基本性质，然后评估每个陈述。\n\n**广义最小残差法 (GMRES) 的推导与性质**\n\nGMRES 在第 $m$ 次迭代的目标是从仿射克雷洛夫子空间 $x_0 + \\mathcal{K}_m(A, r_0)$ 中找到一个近似解 $x_m$，使得相应残差的欧几里得范数（2-范数）最小。该仿射子空间定义为 $x_0 + \\text{span}\\{r_0, Ar_0, \\ldots, A^{m-1}r_0\\}$，其中 $x_0$ 是初始猜测， $r_0 = b - Ax_0$ 是初始残差。\n\n令 $x_m = x_0 + z_m$，其中 $z_m \\in \\mathcal{K}_m(A, r_0)$。残差为 $r_m = b - Ax_m = b - A(x_0 + z_m) = r_0 - Az_m$。最小化问题是找到 $z_m \\in \\mathcal{K}_m(A, r_0)$，使得 $\\|r_m\\|_2 = \\|r_0 - Az_m\\|_2$ 最小。\n\nArnoldi 迭代用于为克雷洛夫子空间 $\\mathcal{K}_m(A, r_0)$ 构建一个标准正交基 $\\{v_1, v_2, \\ldots, v_m\\}$。该过程从 $v_1 = r_0 / \\|r_0\\|_2$ 开始。对于 $j=1, 2, \\ldots, m$，它计算：\n$$ \\hat{w} = A v_j $$\n$$ h_{i,j} = v_i^H \\hat{w} \\quad \\text{for } i=1, \\ldots, j $$\n$$ w = \\hat{w} - \\sum_{i=1}^{j} h_{i,j} v_i $$\n$$ h_{j+1,j} = \\|w\\|_2 $$\n$$ v_{j+1} = w / h_{j+1,j} $$\n该过程生成一组标准正交向量 $V_{m+1} = [v_1, \\ldots, v_{m+1}]$ 和一个 $(m+1) \\times m$ 的上 Hessenberg 矩阵 $\\tilde{H}_m$，其元素为 $h_{i,j}$。这些矩阵通过 Arnoldi 关系式相关联：\n$$ A V_m = V_{m+1} \\tilde{H}_m $$\n其中 $V_m = [v_1, \\ldots, v_m]$。\n\n任何向量 $z_m \\in \\mathcal{K}_m(A, r_0)$ 都可以表示为基向量的线性组合，$z_m = V_m y$，其中 $y \\in \\mathbb{C}^m$ 是某个系数向量。将此代入残差表达式中：\n$$ r_m = r_0 - A(V_m y) = r_0 - V_{m+1}\\tilde{H}_m y $$\n使用 $r_0 = \\|r_0\\|_2 v_1$ 并注意到 $v_1 = V_{m+1}e_1$（其中 $e_1$ 是 $\\mathbb{R}^{m+1}$ 中的第一个标准基向量）：\n$$ r_m = \\|r_0\\|_2 V_{m+1}e_1 - V_{m+1}\\tilde{H}_m y = V_{m+1}(\\|r_0\\|_2 e_1 - \\tilde{H}_m y) $$\n由于 $V_{m+1}$ 的列是标准正交的（$V_{m+1}^H V_{m+1} = I$），2-范数在乘以 $V_{m+1}^H$ 后保持不变。因此，最小化 $\\|r_m\\|_2$ 等价于求解以下关于 $y$ 的最小二乘问题：\n$$ \\min_{y \\in \\mathbb{C}^m} \\|\\, \\|r_0\\|_2 e_1 - \\tilde{H}_m y \\,\\|_2 $$\n这是一个规模为 $(m+1) \\times m$ 的小型稠密最小二乘问题，可以高效求解（例如，通过 QR 分解）。一旦找到最优的 $y$，解的更新为 $x_m = x_0 + V_m y$。根据构造，此过程在 $x_0 + \\mathcal{K}_m(A, r_0)$ 中找到了具有最小残差2-范数的解。\n\n**双共轭梯度稳定法 (BiCGStab) 的推导与性质**\n\nBiCGStab 是一种混合方法，旨在平滑双共轭梯度法 (BiCG) 经常出现的不稳定收敛。BiCG 本身基于双兰索斯过程，该过程生成两个向量序列，$v_j$ 和 $\\hat{v}_j$，它们是双正交的（对于 $j \\neq k$，$v_j^H \\hat{v}_k = 0$）。这被应用于两个克雷洛夫子空间 $\\mathcal{K}_m(A, r_0)$ 和 $\\mathcal{K}_m(A^H, \\hat{r}_0)$，其中 $\\hat{r}_0$ 是一个任意的“影子”初始残差。对于给定的 $A=A^T$ 问题，常见的选择是用 $A^T=A$ 替换 $A^H$，并使用双线性形式 $u^T v$ 而不是内积 $u^H v$。\n\nBiCGStab 的每次迭代 $k$ 主要包括两部分：一个 BiCG 步骤，然后是一个起稳定作用的 GMRES(1) 步骤。\n从一个初始猜测 $x_0$ 和残差 $r_0 = b-Ax_0$ 开始。选择一个影子残差 $\\hat{r}_0$（通常为 $r_0$）。设 $p_0=r_0$。\n\n对于 $k=1, 2, \\ldots$：\n1.  **BiCG 部分**：此步骤沿着由 BiCG 递推确定的搜索方向 $p_k$ 来推进解。\n    -   计算递推的标量。一个常见的公式使用 $\\rho_{k-1} = \\hat{r}_0^T r_{k-1}$。如果 $\\rho_{k-1}=0$，则会发生中断。\n    -   搜索方向 $p_k$ 通过短递推更新：\n        $$ \\beta_{k-1} = \\frac{\\rho_{k-1}}{\\rho_{k-2}} \\frac{\\alpha_{k-1}}{\\omega_{k-1}} $$\n        $$ p_k = r_{k-1} + \\beta_{k-1} (p_{k-1} - \\omega_{k-1} A p_{k-1}) $$\n    -   计算沿 $p_k$ 的最优步长 $\\alpha_k$：\n        $$ v_k = A p_k $$\n        $$ \\alpha_k = \\frac{\\rho_{k-1}}{\\hat{r}_0^T v_k} $$\n        如果分母 $\\hat{r}_0^T v_k = 0$，则会发生中断。\n    -   形成一个中间解和残差：\n        $$ s_k = r_{k-1} - \\alpha_k v_k $$\n        $$ x_{k}' = x_{k-1} + \\alpha_k p_k $$\n        向量 $s_k$ 是对应于 $x_{k}'$ 的残差。\n\n2.  **稳定化部分**：此步骤旨在使用长度为一的最小残差步骤来减小中间残差 $s_k$ 的范数。\n    -   计算 $t_k = A s_k$。\n    -   选择步长 $\\omega_k$ 以最小化 $\\|s_k - \\omega_k t_k\\|_2$。这个一维最小二乘问题的解是：\n        $$ \\omega_k = \\frac{t_k^H s_k}{t_k^H t_k} $$\n        如果 $t_k=0$，或者如果使用双线性形式，$t_k^T t_k=0$，则可能发生中断。\n    -   第 $k$ 步的解和残差的最终更新是：\n        $$ x_k = x_{k}' + \\omega_k s_k = x_{k-1} + \\alpha_k p_k + \\omega_k s_k $$\n        $$ r_k = s_k - \\omega_k t_k $$\nBiCGStab 使用短期递推。在每一步 $k$，它只需要来自第 $k-1$ 步的向量。因此，它需要存储固定数量的少量向量（例如 $r, \\hat{r}_0, p, v, s, t$），导致内存成本为 $\\mathcal{O}(n)$。然而，如果任何标量分母变为零或接近零，算法可能会遭受多种类型的中断。\n\n**陈述评估**\n\n-   **陈述 A**：双共轭梯度稳定法 (BiCGStab) 使用短递推，并存储固定数量的向量，内存成本为 $\\mathcal{O}(n)$，与迭代次数无关，但当递推中的标量分母变为零时（例如，当双正交内积消失或稳定化参数变为零时），它可能会中断。广义最小残差法 (GMRES) 通过阿诺德型过程构建一个标准正交克雷洛夫基，并且必须存储所有直到当前或重启长度的基向量，在 $m$ 次迭代后内存成本为 $\\mathcal{O}(m n)$。\n    -   该陈述是对两种算法基本复杂度和稳定性属性的正确总结。我们的推导表明，BiCGStab 使用短递推（固定存储，$\\mathcal{O}(n)$）并且有潜在的中断点（$\\alpha_k, \\beta_k, \\omega_k$ 的分母为零）。我们对 GMRES 的推导证实了它使用长递推的 Arnoldi 过程，需要存储 $m$ 个向量的整个基，导致 $\\mathcal{O}(mn)$ 的内存成本。\n    -   **结论：正确。**\n\n-   **陈述 B**：对于复对称矩阵 $A = A^{T}$，取双共轭梯度稳定法 (BiCGStab) 的影子残差 $\\hat{r}_{0} = r_{0}$ 并且不使用共轭（即用纯转置替换共轭转置），可以保持形式上的递推关系，并保证残差的2-范数单调递减。\n    -   虽然所提议的修改为复对称系统定义了一个有效的 BiCGStab 变体，但关于保证残差2-范数单调递减的断言是错误的。BiCGStab 的“稳定化”步骤执行了残差范数的局部最小化，这有助于平滑收敛，但不能保证全局单调性。残差范数可以并且经常表现出非单调行为。只有 GMRES 因其在嵌套子空间上的全局最小化而具有这种保证的非增残差性质。\n    -   **结论：不正确。**\n\n-   **陈述 C**：完全（非重启的）广义最小残差法 (GMRES) 在每次迭代中在当前克雷洛夫子空间上最小化残差的2-范数，产生一个非增的残差范数序列，并且在精确算术下不会出现真正的中断，除非在克雷洛夫子空间内达到精确解时发生所谓的幸运中断，其代价是每次迭代的存储和正交化工作量都会增加。\n    -   该陈述准确地描述了完全 GMRES 的理论性质。如我们的推导所示，它在 $x_m \\in x_0+\\mathcal{K}_m(A, r_0)$ 上最小化 $\\|r_m\\|_2$。由于 $\\mathcal{K}_m \\subseteq \\mathcal{K}_{m+1}$，在更大空间上的最小值不会更差，因此 $\\|r_{m+1}\\|_2 \\le \\|r_m\\|_2$。中断（$h_{m+1,m}=0$）意味着子空间在 $A$ 的作用下是不变的，这意味着已经找到了精确解。这种“幸运中断”是在精确算术下唯一可能发生的中断类型。如陈述所述，成本（$V_m$ 存储和正交化工作）都以 $\\mathcal{O}(mn)$ 的速度增长。\n    -   **结论：正确。**\n\n-   **陈述 D**：在精确算术下，对于任何可对角化的矩阵 $A \\in \\mathbb{C}^{n \\times n}$，双共轭梯度稳定法 (BiCGStab) 都保证在至多 $n$ 步内收敛。\n    -   这个陈述过于强烈且不正确。虽然 BiCG（BiCGStab 基于此）*如果不发生中断*，确实具有在至多 $n$ 步内有限终止的性质，但这个保证不会自动推广到 BiCGStab 对*任何*可对角化矩阵都适用。主要问题是中断的可能性，而该陈述忽略了这一点。有限步终止性没有保证。\n    -   **结论：不正确。**\n\n-   **陈述 E**：对于复对称不定矩阵 $A$，用转置双线性形式 $x^{T} y$ 代替标准共轭内积 $x^{H} y$ 来构建双共轭梯度稳定法 (BiCGStab)，可以在精确算术下完全消除中断。\n    -   这种说法是错误的。对于复对称系统，使用双线性形式 $x^T y$ 是一种常用技术，但它并不能消除中断。例如，对于一个非零的复向量 $v$，形式为 $v^T v$ 的分母可能为零（例如，$v = [1, i]^T \\implies v^T v = 1^2 + i^2 = 0$）。这是此类算法中一个众所周知的潜在中断原因。\n    -   **结论：不正确。**\n\n-   **陈述 F**：在高波数的亥姆霍兹问题中，$A$ 的非正规性和不定性通常会导致重启的广义最小残差法 (GMRES) 停滞以及双共轭梯度稳定法 (BiCGStab) 的不稳定收敛；在实践中，预处理器的质量在很大程度上决定了这两种方法的收敛行为。\n    -   该陈述准确地反映了解决大规模亥姆霍兹问题的实践现实。由此产生的矩阵是高度不定和非正规的，这对大多数迭代求解器来说是具有挑战性的性质。重启的 GMRES 经常停滞，因为重启之间生成的小克雷洛夫子空间不足以模拟算子的复杂行为。BiCGStab 的收敛可能不规则且缓慢。对于这类难题，未经预处理的求解器很少有效，而开发和应用一个强大的预处理器几乎总是决定是否能够高效找到解的关键因素。\n    -   **结论：正确。**\n\n最终选择包括陈述 A、C 和 F。",
            "answer": "$$\\boxed{ACF}$$"
        },
        {
            "introduction": "对于亥姆霍兹问题，迭代求解器的性能在很大程度上取决于预条件子的质量。本练习将提供一个具体的编码实践，让你将理论付诸实践。你将实现一个简单的对角预条件子，并直接观察其性能如何受介质物理属性（如密度和体积模量）变化的影响，从而深刻理解预条件处理在连接物理问题与数值求解中的桥梁作用。",
            "id": "4137503",
            "problem": "考虑从线性化动量平衡和可压缩性关系推导出的时谐线性声学压力公式，假设时间依赖性为正弦形式，角频率为 $\\omega$（单位：弧度/秒）。在非均匀介质中，压力 $p$ 的控制偏微分方程（PDE）为\n$$\n-\\nabla \\cdot \\left(\\alpha(\\mathbf{x}) \\nabla p(\\mathbf{x})\\right) + \\beta(\\mathbf{x})\\,p(\\mathbf{x}) = s(\\mathbf{x}),\n$$\n其中 $\\alpha(\\mathbf{x}) = 1/\\rho(\\mathbf{x})$，$\\rho$ 是质量密度（单位：$\\mathrm{kg/m^3}$），$\\beta(\\mathbf{x}) = \\omega^2/\\kappa(\\mathbf{x})$，$\\kappa$ 是体积模量（单位：$\\mathrm{Pa}$）。假设在一个边长为 $L$（单位：米）的方形域的边界上，采用均匀狄利克雷边界条件 $p=0$。使用从散度定理和面法向通量连续性推导出的二阶有限体积或有限差分方法，在具有 $N \\times N$ 个内部点和网格间距 $h = L/(N+1)$ 的均匀笛卡尔网格上对算子进行离散化。得到的对称正定（SPD）线性系统矩阵 $A \\in \\mathbb{R}^{n \\times n}$（其中 $n=N^2$）的对角线元素反映了面通量系数和局部反应（质量）项的总和。\n\n定义阻尼雅可比预条件子为 $M^{-1} = \\omega_J D^{-1}$，其中 $D=\\mathrm{diag}(A)$ 是 $A$ 的对角线，$\\omega_J \\in (0,1)$ 是一个无量纲的阻尼因子。预处理算子为 $M^{-1}A$，它与对称矩阵 $D^{-1/2} A D^{-1/2}$ 相似，因此具有实非负谱。您的任务是：\n- 为每个测试案例构建矩阵 $A$，使用基于面心通量的物理一致性离散化方法，并在面上对 $\\alpha$ 进行适当的平均以处理材料不连续性。\n- 构造预处理算子，并计算相似对称矩阵 $D^{-1/2} A D^{-1/2}$ 的特征值，这些特征值等于 $D^{-1}A$ 的特征值。\n- 通过报告每个测试案例的以下内容，量化阻尼雅可比预条件子固有的对角缩放如何与 $\\rho$ 和 $\\kappa$ 的非均匀性相互作用：\n  1. $D^{-1/2} A D^{-1/2}$ 的最小特征值 $\\lambda_{\\min}$，\n  2. $D^{-1/2} A D^{-1/2}$ 的最大特征值 $\\lambda_{\\max}$，\n  3. $M^{-1}A$ 的谱半径，其等于 $\\omega_J \\lambda_{\\max}$，\n  4. $M^{-1}A$ 特征值的变异系数，定义为标准差除以均值。\n所有这四个量都是无量纲的，并且必须以浮点数形式返回。\n\n使用以下参数值和非均匀场的测试套件。在所有情况下，取 $L = 1.0$ 米，$h = L/(N+1)$，以及 $\\omega = 2\\pi f$，其中 $f$ 的单位为赫兹。程序必须从第一性原理实现离散化，不依赖于快捷公式，并且必须以数值方式计算特征值。\n\n- 测试案例 1（基准均匀介质）：\n  - $N = 10$，$f = 1000$ 赫兹，$\\omega_J = 0.66$，\n  - 各处 $\\rho(x,y) = 1000$ $\\mathrm{kg/m^3}$，\n  - 各处 $\\kappa(x,y) = 2.2\\times 10^9$ $\\mathrm{Pa}$。\n- 测试案例 2（密度对比平板，体积模量恒定）：\n  - $N = 10$，$f = 1000$ 赫兹，$\\omega_J = 0.66$，\n  - 当 $x  0.5$ 时，$\\rho(x,y) = 1000$ $\\mathrm{kg/m^3}$；当 $x \\ge 0.5$ 时，$\\rho(x,y) = 2500$ $\\mathrm{kg/m^3}$，\n  - 各处 $\\kappa(x,y) = 2.2\\times 10^9$ $\\mathrm{Pa}$。\n- 测试案例 3（体积模量对比平板，密度恒定）：\n  - $N = 10$，$f = 1000$ 赫兹，$\\omega_J = 0.66$，\n  - 各处 $\\rho(x,y) = 1000$ $\\mathrm{kg/m^3}$，\n  - 当 $y \\ge 0.5$ 时，$\\kappa(x,y) = 1.0\\times 10^9$ $\\mathrm{Pa}$；当 $y  0.5$ 时，$\\kappa(x,y) = 5.0\\times 10^9$ $\\mathrm{Pa}$。\n- 测试案例 4（$\\rho$ 和 $\\kappa$ 均为棋盘状非均匀性，强阻尼）：\n  - $N = 10$，$f = 1000$ 赫兹，$\\omega_J = 0.95$，\n  - 若 $(i+j)$ 为偶数，$\\rho(x,y) = 800$ $\\mathrm{kg/m^3}$；若 $(i+j)$ 为奇数，$\\rho(x,y) = 1600$ $\\mathrm{kg/m^3}$，其中 $(i,j)$ 为内部网格点索引，\n  - 若 $(i+j)$ 为偶数，$\\kappa(x,y) = 1.5\\times 10^9$ $\\mathrm{Pa}$；若 $(i+j)$ 为奇数，$\\kappa(x,y) = 3.0\\times 10^9$ $\\mathrm{Pa}$。\n- 测试案例 5（极端局部非均匀性，中等阻尼）：\n  - $N = 6$，$f = 1000$ 赫兹，$\\omega_J = 0.50$，\n  - 在中心的 $2\\times 2$ 内部块中，$\\rho(x,y) = 100$ $\\mathrm{kg/m^3}$；其他地方 $\\rho(x,y) = 5000$ $\\mathrm{kg/m^3}$，\n  - 在中心的 $2\\times 2$ 内部块中，$\\kappa(x,y) = 0.5\\times 10^9$ $\\mathrm{Pa}$；其他地方 $\\kappa(x,y) = 10.0\\times 10^9$ $\\mathrm{Pa}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试案例的结果本身是一个包含四个浮点数量的列表，顺序为 $[\\lambda_{\\min}, \\lambda_{\\max}, \\text{spectral\\_radius}, \\text{coefficient\\_of\\_variation}]$。例如，输出格式必须类似于 $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],\\dots]$，其中每个 $a_k, b_k, c_k, d_k$ 都是一个浮点数。所有报告的量都是无量纲的；输出中不需要物理单位。",
            "solution": "该问题要求分析一个由非均匀介质中时谐声压波方程的有限体积离散化产生的阻尼雅可比预处理线性系统的谱特性。我们将首先推导离散化以构建系统矩阵 $A$，然后定义预处理算子，最后概述所需谱度量的计算。\n\n声压 $p(\\mathbf{x})$ 的控制偏微分方程是非均匀亥姆霍兹方程：\n$$\n-\\nabla \\cdot \\left(\\alpha(\\mathbf{x}) \\nabla p(\\mathbf{x})\\right) + \\beta(\\mathbf{x})\\,p(\\mathbf{x}) = s(\\mathbf{x})\n$$\n其中 $\\mathbf{x}=(x,y)$，$\\alpha(\\mathbf{x}) = 1/\\rho(\\mathbf{x})$ 是质量密度的倒数，$\\beta(\\mathbf{x}) = \\omega^2/\\kappa(\\mathbf{x})$ 与体积模量和角频率有关。区域是一个边长为 $L$ 的正方形，边界上具有均匀狄利克雷边界条件 $p(\\mathbf{x})=0$。\n\n我们在一个具有 $N \\times N$ 个内部点的均匀笛卡尔网格上对此方程进行离散化。网格间距为 $h = L/(N+1)$，网格点坐标为 $(x_i, y_j) = (ih, jh)$，其中 $i,j \\in \\{1, \\dots, N\\}$。总自由度数为 $n=N^2$。我们将使用单元中心有限体积法。在以 $(x_i, y_j)$ 为中心的边长为 $h$ 的方形控制体 $V_{ij}$ 上对 PDE 进行积分，并应用散度定理，得到：\n$$\n-\\oint_{\\partial V_{ij}} (\\alpha \\nabla p) \\cdot \\mathbf{n} \\, dS + \\int_{V_{ij}} \\beta p \\, dV = \\int_{V_{ij}} s \\, dV\n$$\n边界积分是控制体四个面（东、西、南、北）通量的总和。例如，通过东面的通量可以使用二阶中心差分来近似梯度：\n$$\n\\int_{\\text{East face}} (\\alpha \\nabla p) \\cdot \\mathbf{n} \\, dS \\approx h \\left( \\alpha_{i+1/2,j} \\frac{p_{i+1,j} - p_{i,j}}{h} \\right) = \\alpha_{i+1/2,j} (p_{i+1,j} - p_{i,j})\n$$\n这里，$p_{i,j}$ 表示 $p(x_i, y_j)$，而 $\\alpha_{i+1/2,j}$ 是单元 $(i,j)$ 和 $(i+1,j)$ 之间面上的 $\\alpha$ 值。为确保物理一致性（即通量 $\\alpha \\nabla p$ 在材料界面上的连续性），我们对系数 $\\alpha$ 使用调和平均：\n$$\n\\alpha_{i+1/2, j} = \\frac{2 \\alpha_{i,j} \\alpha_{i+1,j}}{\\alpha_{i,j} + \\alpha_{i+1,j}}\n$$\n近似所有通量和体积积分（例如，使用中点法则 $\\int_{V_{ij}} \\beta p \\, dV \\approx (\\beta p)_{i,j} h^2$），并取源项 $s(\\mathbf{x})=0$（因为它不影响矩阵 $A$），我们得到网格点 $(i,j)$ 的离散方程：\n$$\n-\\left[ \\alpha_{E}(p_{i+1,j}-p_{i,j}) - \\alpha_{W}(p_{i,j}-p_{i-1,j}) + \\alpha_{N}(p_{i,j+1}-p_{i,j}) - \\alpha_{S}(p_{i,j}-p_{i,j-1}) \\right] + h^2 \\beta_{i,j} p_{i,j} = 0\n$$\n其中 $\\alpha_E, \\alpha_W, \\alpha_N, \\alpha_S$ 分别是东、西、北、南面上 $\\alpha$ 的调和平均值。重新整理此式，得到线性系统 $Ap=0$ 的模板：\n$$\n(\\alpha_E + \\alpha_W + \\alpha_N + \\alpha_S + h^2\\beta_{i,j})p_{i,j} - \\alpha_E p_{i+1,j} - \\alpha_W p_{i-1,j} - \\alpha_N p_{i,j+1} - \\alpha_S p_{i,j-1} = 0\n$$\n为了构建 $n \\times n$ 矩阵 $A$，我们使用行主序将二维未知数网格映射到一维向量：点 $(i,j)$ 的索引 $k$ 为 $k = (j-1)N + (i-1)$。得到的矩阵 $A$ 是一个稀疏、带状、对称的矩阵。由于 $\\alpha > 0$ 和 $\\beta > 0$，主对角线上的系数为正，并且大于同一行中非对角线元素绝对值之和。这种严格对角占优，结合对称性和正对角线元素，保证了 $A$ 是对称正定（SPD）的。\n\n问题要求分析阻尼雅可比预条件子，其定义为 $M^{-1} = \\omega_J D^{-1}$，其中 $D=\\mathrm{diag}(A)$ 是 $A$ 的对角线，$\\omega_J \\in (0,1)$ 是阻尼因子。我们分析预处理算子 $M^{-1}A = \\omega_J D^{-1}A$ 的特征值。$D^{-1}A$ 的特征值是实数且为正，因为 $D^{-1}A$ 与对称矩阵 $B = D^{-1/2} A D^{-1/2}$ 相似（因为 $A$ 是 SPD，所以 $D$ 的元素为正，故 $D^{-1/2}$ 是实数且定义良好）。$M^{-1}A$ 的特征值就是 $D^{-1}A$ 的特征值乘以 $\\omega_J$。\n\n每个测试案例的步骤如下：\n1.  离散化域并构建材料属性场 $\\rho(\\mathbf{x})$ 和 $\\kappa(\\mathbf{x})$ 于一个 $(N+2) \\times (N+2)$ 网格上，该网格代表 $N \\times N$ 个内部点和一层用于边界计算的虚拟单元。虚拟单元的值通过从最近的内部单元进行零阶外插来设置。\n2.  从 $\\rho$ 和 $\\kappa$ 计算系数场 $\\alpha = 1/\\rho$ 和 $\\beta = \\omega^2/\\kappa$。\n3.  基于推导出的有限体积模板构建 $n \\times n$ 矩阵 $A$，在单元面上对 $\\alpha$ 使用调和平均。\n4.  提取 $A$ 的对角线 $D$，并形成对称缩放矩阵 $B = D^{-1/2} A D^{-1/2}$。\n5.  使用数值特征求解器计算对称矩阵 $B$ 的特征值。记为 $\\{\\lambda_i\\}_{i=1}^n$。这些也是 $D^{-1}A$ 的特征值。\n6.  计算所需的四个无量纲量：\n    a. 最小特征值 $\\lambda_{\\min} = \\min(\\{\\lambda_i\\})$。\n    b. 最大特征值 $\\lambda_{\\max} = \\max(\\{\\lambda_i\\})$。\n    c. $M^{-1}A$ 的谱半径，即 $\\rho(M^{-1}A) = |\\omega_J| \\cdot \\rho(D^{-1}A) = \\omega_J \\lambda_{\\max}$。\n    d. $M^{-1}A$ 特征值的变异系数。由于 $M^{-1}A$ 的特征值只是 $D^{-1}A$ 特征值的缩放版本（通过常数因子 $\\omega_J$），它们的变异系数（标准差/均值）是相同的。我们计算 $\\text{std}(\\{\\lambda_i\\}) / \\text{mean}(\\{\\lambda_i\\})$。\n\n该过程将对问题中定义的五个测试案例中的每一个实施。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_metrics(case_params):\n    \"\"\"\n    Constructs the system matrix for the acoustic problem and computes\n    spectral properties of the Jacobi-preconditioned operator.\n    \"\"\"\n    # Unpack parameters\n    N = case_params['N']\n    f = case_params['f']\n    omega_J = case_params['omega_J']\n    rho_def = case_params['rho_def']\n    kappa_def = case_params['kappa_def']\n    \n    # Constants and grid parameters\n    L = 1.0\n    h = L / (N + 1)\n    n = N * N\n    omega = 2.0 * np.pi * f\n\n    # Material property grids (including ghost cells)\n    # Array indices (i,j) map to (y,x) in coordinate system\n    # Indices 1...N are interior points\n    rho = np.zeros((N + 2, N + 2))\n    kappa = np.zeros((N + 2, N + 2))\n\n    # Fill interior points based on case definitions\n    for j_idx in range(1, N + 1):  # Corresponds to y-direction\n        for i_idx in range(1, N + 1):  # Corresponds to x-direction\n            x = i_idx * h\n            y = j_idx * h\n            rho[j_idx, i_idx] = rho_def(x, y, i_idx, j_idx, N)\n            kappa[j_idx, i_idx] = kappa_def(x, y, i_idx, j_idx, N)\n\n    # Extrapolate to ghost cells\n    rho[0, :] = rho[1, :]\n    rho[N + 1, :] = rho[N, :]\n    rho[:, 0] = rho[:, 1]\n    rho[:, N + 1] = rho[:, N]\n\n    kappa[0, :] = kappa[1, :]\n    kappa[N + 1, :] = kappa[N, :]\n    kappa[:, 0] = kappa[:, 1]\n    kappa[:, N + 1] = kappa[:, N]\n\n    # Derived coefficient fields\n    alpha = 1.0 / rho\n    beta = omega**2 / kappa\n\n    # Construct the system matrix A\n    A = np.zeros((n, n))\n    for j_idx in range(1, N + 1):\n        for i_idx in range(1, N + 1):\n            k = (j_idx - 1) * N + (i_idx - 1)\n            \n            # Harmonic means for alpha at cell faces\n            alpha_E = 2.0 * alpha[j_idx, i_idx] * alpha[j_idx, i_idx + 1] / (alpha[j_idx, i_idx] + alpha[j_idx, i_idx + 1])\n            alpha_W = 2.0 * alpha[j_idx, i_idx] * alpha[j_idx, i_idx - 1] / (alpha[j_idx, i_idx] + alpha[j_idx, i_idx - 1])\n            alpha_N = 2.0 * alpha[j_idx, i_idx] * alpha[j_idx + 1, i_idx] / (alpha[j_idx, i_idx] + alpha[j_idx + 1, i_idx])\n            alpha_S = 2.0 * alpha[j_idx, i_idx] * alpha[j_idx - 1, i_idx] / (alpha[j_idx, i_idx] + alpha[j_idx - 1, i_idx])\n            \n            # Diagonal entry\n            A[k, k] = alpha_E + alpha_W + alpha_N + alpha_S + h**2 * beta[j_idx, i_idx]\n            \n            # Off-diagonal entries\n            if i_idx  N:  # East neighbor\n                l = k + 1\n                A[k, l] = -alpha_E\n            if i_idx > 1:  # West neighbor\n                l = k - 1\n                A[k, l] = -alpha_W\n            if j_idx  N:  # North neighbor\n                l = k + N\n                A[k, l] = -alpha_N\n            if j_idx > 1:  # South neighbor\n                l = k - N\n                A[k, l] = -alpha_S\n\n    # Form the symmetrically scaled matrix B = D^{-1/2} A D^{-1/2}\n    D_diag = np.diag(A)\n    D_inv_sqrt = np.diag(1.0 / np.sqrt(D_diag))\n    B = D_inv_sqrt @ A @ D_inv_sqrt\n\n    # Compute eigenvalues of B (which are the same as D^{-1}A)\n    # Using eigvalsh for symmetric matrices is more efficient and stable.\n    eigs = np.linalg.eigvalsh(B)\n    \n    # Calculate the four required metrics\n    lambda_min = eigs.min()\n    lambda_max = eigs.max()\n    spectral_radius = omega_J * lambda_max\n    \n    mean_eig = np.mean(eigs)\n    std_eig = np.std(eigs)\n    coeff_var = std_eig / mean_eig if mean_eig != 0 else 0.0\n\n    return [lambda_min, lambda_max, spectral_radius, coeff_var]\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Homogeneous medium\n        {\n            'N': 10, 'f': 1000, 'omega_J': 0.66,\n            'rho_def': lambda x, y, i, j, N: 1000,\n            'kappa_def': lambda x, y, i, j, N: 2.2e9\n        },\n        # Case 2: Density contrast slab\n        {\n            'N': 10, 'f': 1000, 'omega_J': 0.66,\n            'rho_def': lambda x, y, i, j, N: 1000 if x  0.5 else 2500,\n            'kappa_def': lambda x, y, i, j, N: 2.2e9\n        },\n        # Case 3: Bulk modulus contrast slab\n        {\n            'N': 10, 'f': 1000, 'omega_J': 0.66,\n            'rho_def': lambda x, y, i, j, N: 1000,\n            'kappa_def': lambda x, y, i, j, N: 1.0e9 if y >= 0.5 else 5.0e9\n        },\n        # Case 4: Checkerboard heterogeneity\n        {\n            'N': 10, 'f': 1000, 'omega_J': 0.95,\n            'rho_def': lambda x, y, i, j, N: 800 if (i + j) % 2 == 0 else 1600,\n            'kappa_def': lambda x, y, i, j, N: 1.5e9 if (i + j) % 2 == 0 else 3.0e9\n        },\n        # Case 5: Extreme localized heterogeneity\n        {\n            'N': 6, 'f': 1000, 'omega_J': 0.50,\n            'rho_def': lambda x, y, i, j, N: 100 if (i in [3,4] and j in [3,4]) else 5000,\n            'kappa_def': lambda x, y, i, j, N: 0.5e9 if (i in [3,4] and j in [3,4]) else 10.0e9\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        metrics = compute_metrics(case)\n        results.append(metrics)\n\n    # Format output as a list of lists of floats\n    result_str = '[' + ','.join([f\"[{m[0]},{m[1]},{m[2]},{m[3]}]\" for m in results]) + ']'\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}