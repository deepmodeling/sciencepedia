{
    "hands_on_practices": [
        {
            "introduction": "本练习构成了创建自定义数值方法的基础。通过使用泰勒级数手动推导特定精度有限差分格式的系数，您将从第一性原理的层面，深入理解这些强大工具的构建方式，以及“精度阶数”在实践中的真正含义。对于任何希望设计或分析偏微分方程数值算法的人来说，这项实践  都是至关重要的。",
            "id": "4124043",
            "problem": "考虑均匀介质中的一维线性声学，由线性化欧拉方程组 $u_{t} + \\frac{1}{\\rho_{0}} p_{x} = 0$ 和 $p_{t} + \\rho_{0} c^{2} u_{x} = 0$ 描述，其中 $p(x,t)$ 是声压，$u(x,t)$ 是粒子速度，$c$ 是声速，$\\rho_{0}$ 是环境密度。在网格间距为 $h$ 的均匀空间网格 $x_{i} = i h$ 上，假设我们希望构造空间导数算子的高阶有限差分近似，以便用于这些方程的半离散格式。\n\n在内部点，考虑一个关于一阶导数的对称中心有限差分近似，该近似由三个未知系数 $a_{1}, a_{2}, a_{3}$ 参数化：\n$$\n(\\mathcal{D}_{c} f)_{i} = \\frac{1}{h} \\left[ a_{1}\\left(f_{i+1} - f_{i-1}\\right) + a_{2}\\left(f_{i+2} - f_{i-2}\\right) + a_{3}\\left(f_{i+3} - f_{i-3}\\right) \\right].\n$$\n在左边界 $x_{0} = 0$ 处，考虑一个使用五个节点、带有未知系数 $b_{0}, b_{1}, b_{2}, b_{3}, b_{4}$ 的单边前向有限差分近似：\n$$\n(\\mathcal{D}_{f} f)_{0} = \\frac{1}{h} \\left[ b_{0} f_{0} + b_{1} f_{1} + b_{2} f_{2} + b_{3} f_{3} + b_{4} f_{4} \\right].\n$$\n\n仅从围绕 $x_{i}$ 的泰勒级数展开和平面波拟设 $f(x) = \\exp(i k x)$ 出发，推导以下内容：\n\n1. 系数 $a_{1}, a_{2}, a_{3}$，使得 $(\\mathcal{D}_{c} f)_{i}$ 是对 $f'(x_{i})$ 的六阶精度近似，即截断误差为 $\\mathcal{O}(h^{6})$。\n2. 中心算子的色散-截断主阶系数 $\\gamma$，其定义为将 $\\mathcal{D}_{c}$ 应用于傅里叶模式 $f_{i} = \\exp(i k x_{i})$ 所得的有效波数 $k_{\\mathrm{eff}}$ 在小 $k h$ 条件下的展开式，即\n$$\nk_{\\mathrm{eff}} = k - \\gamma \\, k^{7} h^{6} + \\mathcal{O}(k^{9} h^{8}).\n$$\n将 $\\gamma$ 表示为实常数的闭合形式。\n3. 系数 $b_{0}, b_{1}, b_{2}, b_{3}, b_{4}$，使得 $(\\mathcal{D}_{f} f)_{0}$ 是对 $f'(x_{0})$ 的四阶精度近似，即截断误差为 $\\mathcal{O}(h^{4})$。\n\n将你的最终答案以单行矩阵的形式给出，按顺序包含各项 $(a_{1}, a_{2}, a_{3}, \\gamma, b_{0}, b_{1}, b_{2}, b_{3}, b_{4})$。无需四舍五入，所有系数应表示为精确的有理数。最终答案是无量纲的，不需要单位。",
            "solution": "该问题是适定的且在科学上是合理的，代表了发展偏微分方程数值方法中的一项标准任务。我们被要求通过泰勒级数分析施加精度约束来推导有限差分格式的系数，并对所得格式进行色散分析。\n\n问题分为三个部分。我们将依次解决每个部分。\n\n第1部分：确定六阶中心差分格式的系数。\n\n给定一阶导数 $f'(x_i)$ 的对称中心差分算子：\n$$\n(\\mathcal{D}_{c} f)_{i} = \\frac{1}{h} \\left[ a_{1}\\left(f_{i+1} - f_{i-1}\\right) + a_{2}\\left(f_{i+2} - f_{i-2}\\right) + a_{3}\\left(f_{i+3} - f_{i-3}\\right) \\right]\n$$\n为了确定系数 $a_1, a_2, a_3$，我们将函数值 $f_{i \\pm j} = f(x_i \\pm jh)$ 在 $x_i$ 周围展开为泰勒级数。\n$$\nf(x_i \\pm jh) = f(x_i) \\pm (jh)f'(x_i) + \\frac{(jh)^2}{2!}f''(x_i) \\pm \\frac{(jh)^3}{3!}f'''(x_i) + \\dots\n$$\n差值 $f_{i+j} - f_{i-j}$ 由下式给出：\n$$\nf_{i+j} - f_{i-j} = 2jh f'_{i} + 2\\frac{(jh)^3}{3!} f'''_{i} + 2\\frac{(jh)^5}{5!} f^{(5)}_{i} + 2\\frac{(jh)^7}{7!} f^{(7)}_{i} + \\mathcal{O}(h^9)\n$$\n其中 $f_i^{(n)} = f^{(n)}(x_i)$。将此代入算子表达式中，对于 $j = 1, 2, 3$：\n$$\n(\\mathcal{D}_{c} f)_{i} = \\frac{1}{h} \\sum_{j=1}^{3} a_j \\left( 2jh f'_{i} + \\frac{j^3h^3}{3} f'''_{i} + \\frac{j^5h^5}{60} f^{(5)}_{i} + \\frac{j^7h^7}{2520} f^{(7)}_{i} + \\dots \\right)\n$$\n我们按 $f$ 的导数阶数对各项进行分组：\n$$\n(\\mathcal{D}_{c} f)_{i} = \\left(2 \\sum_{j=1}^{3} j a_j\\right) f'_{i} + h^2 \\left(\\frac{1}{3} \\sum_{j=1}^{3} j^3 a_j\\right) f'''_{i} + h^4 \\left(\\frac{1}{60} \\sum_{j=1}^{3} j^5 a_j\\right) f^{(5)}_{i} + h^6 \\left(\\frac{1}{2520} \\sum_{j=1}^{3} j^7 a_j\\right) f^{(7)}_{i} + \\dots\n$$\n为了使该算子成为 $f'_{i}$ 的近似，$f'_{i}$ 的系数必须为 $1$。为了达到六阶精度，截断误差必须为 $\\mathcal{O}(h^6)$，这意味着 $h^2 f'''_i$ 和 $h^4 f^{(5)}_i$ 项的系数必须为零。这就产生了一个关于 $a_1, a_2, a_3$ 的三元线性方程组：\n1. $2(a_1 + 2a_2 + 3a_3) = 1 \\implies a_1 + 2a_2 + 3a_3 = \\frac{1}{2}$\n2. $\\frac{1}{3}(a_1 + 8a_2 + 27a_3) = 0 \\implies a_1 + 8a_2 + 27a_3 = 0$\n3. $\\frac{1}{60}(a_1 + 32a_2 + 243a_3) = 0 \\implies a_1 + 32a_2 + 243a_3 = 0$\n\n我们求解这个方程组。将第三个方程减去第二个方程：\n$(a_1 + 32a_2 + 243a_3) - (a_1 + 8a_2 + 27a_3) = 0 \\implies 24a_2 + 216a_3 = 0 \\implies a_2 = -9a_3$。\n将 $a_2 = -9a_3$ 代入第二个方程：\n$a_1 + 8(-9a_3) + 27a_3 = 0 \\implies a_1 - 72a_3 + 27a_3 = 0 \\implies a_1 = 45a_3$。\n现在将 $a_1$ 和 $a_2$ 都代入第一个方程：\n$45a_3 + 2(-9a_3) + 3a_3 = \\frac{1}{2} \\implies 45a_3 - 18a_3 + 3a_3 = \\frac{1}{2} \\implies 30a_3 = \\frac{1}{2} \\implies a_3 = \\frac{1}{60}$。\n由此，我们求得 $a_1$ 和 $a_2$：\n$a_1 = 45 \\left(\\frac{1}{60}\\right) = \\frac{45}{60} = \\frac{3}{4}$。\n$a_2 = -9 \\left(\\frac{1}{60}\\right) = -\\frac{9}{60} = -\\frac{3}{20}$。\n这些系数是 $a_1 = \\frac{3}{4}$，$a_2 = -\\frac{3}{20}$，和 $a_3 = \\frac{1}{60}$。\n\n第2部分：确定色散系数 $\\gamma$。\n\n我们将算子 $\\mathcal{D}_c$ 应用于平面波拟设 $f_j = f(x_j) = \\exp(ikx_j)$。精确导数为 $f'(x_j) = ik \\exp(ikx_j) = ik f_j$。数值导数定义为 $(\\mathcal{D}_c f)_j = ik_{\\mathrm{eff}} f_j$。\n$$\nf_{j+m} - f_{j-m} = \\exp(ik(x_j+mh)) - \\exp(ik(x_j-mh)) = \\exp(ikx_j) (\\exp(ikmh) - \\exp(-ikmh)) = f_j (2i \\sin(kmh))\n$$\n将此代入 $\\mathcal{D}_c$ 的定义中：\n$$\n(\\mathcal D_c f)_j = \\frac{1}{h} \\sum_{m=1}^{3} a_m (f_{j+m} - f_{j-m}) = \\frac{1}{h} \\sum_{m=1}^{3} a_m (2i \\sin(kmh)) f_j = \\frac{2i}{h} \\left( \\sum_{m=1}^{3} a_m \\sin(kmh) \\right) f_j\n$$\n与 $(\\mathcal{D}_c f)_j = ik_{\\mathrm{eff}} f_j$ 比较，我们得到有效波数 $k_{\\mathrm{eff}}$：\n$$\nk_{\\mathrm{eff}} = \\frac{2}{h} \\sum_{m=1}^{3} a_m \\sin(kmh)\n$$\n我们对小 $kh$ 展开 $\\sin(kmh)$：\n$$\n\\sin(kmh) = (kmh) - \\frac{(kmh)^3}{3!} + \\frac{(kmh)^5}{5!} - \\frac{(kmh)^7}{7!} + \\mathcal{O}((kh)^9)\n$$\n将此代入 $k_{\\mathrm{eff}}$ 的表达式中：\n$$\nk_{\\mathrm{eff}} = \\frac{2}{h} \\sum_{m=1}^{3} a_m \\left( kmh - \\frac{k^3m^3h^3}{6} + \\frac{k^5m^5h^5}{120} - \\frac{k^7m^7h^7}{5040} + \\dots \\right)\n$$\n$$\nk_{\\mathrm{eff}} = k \\left(2\\sum m a_m\\right) - k^3h^2 \\left(\\frac{1}{3}\\sum m^3 a_m\\right) + k^5h^4 \\left(\\frac{1}{60}\\sum m^5 a_m\\right) - k^7h^6 \\left(\\frac{1}{2520}\\sum m^7 a_m\\right) + \\dots\n$$\n根据第1部分推导出的约束条件，我们知道：\n$2\\sum m a_m = 1$\n$\\sum m^3 a_m = 0$\n$\\sum m^5 a_m = 0$\n$k_{\\mathrm{eff}}$ 的表达式简化为：\n$$\nk_{\\mathrm{eff}} = k - \\frac{k^7 h^6}{2520} \\left( \\sum_{m=1}^{3} m^7 a_m \\right) + \\mathcal{O}(k^9h^8)\n$$\n将其与给定形式 $k_{\\mathrm{eff}} = k - \\gamma k^7 h^6 + \\mathcal{O}(k^9h^8)$ 进行比较，我们确定 $\\gamma$ 为：\n$$\n\\gamma = \\frac{1}{2520} \\sum_{m=1}^{3} m^7 a_m = \\frac{1}{2520} (1^7 a_1 + 2^7 a_2 + 3^7 a_3)\n$$\n代入 $a_1, a_2, a_3$ 的值：\n$$\n\\sum m^7 a_m = (1)\\left(\\frac{3}{4}\\right) + (128)\\left(-\\frac{3}{20}\\right) + (2187)\\left(\\frac{1}{60}\\right) = \\frac{3}{4} - \\frac{384}{20} + \\frac{2187}{60}\n$$\n使用公分母 $60$：\n$$\n\\frac{45}{60} - \\frac{1152}{60} + \\frac{2187}{60} = \\frac{45 - 1152 + 2187}{60} = \\frac{1080}{60} = 18\n$$\n因此，$\\gamma = \\frac{18}{2520}$。化简该分数：\n$$\n\\gamma = \\frac{18}{2520} = \\frac{1}{140}\n$$\n\n第3部分：确定四阶前向差分格式的系数。\n\n给定单边前向差分算子：\n$$\n(\\mathcal{D}_{f} f)_{0} = \\frac{1}{h} \\left[ b_{0} f_{0} + b_{1} f_{1} + b_{2} f_{2} + b_{3} f_{3} + b_{4} f_{4} \\right]\n$$\n我们将 $f_j = f(x_j) = f(x_0+jh)$ 在 $x_0$ 周围展开为泰勒级数：\n$$\nf_j = f_0 + (jh)f'_0 + \\frac{(jh)^2}{2!}f''_0 + \\frac{(jh)^3}{3!}f'''_0 + \\frac{(jh)^4}{4!}f^{(4)}_0 + \\mathcal{O}(h^5)\n$$\n将此代入算子中：\n$$\n(\\mathcal{D}_{f} f)_{0} = \\frac{1}{h} \\sum_{j=0}^{4} b_j \\left(f_0 + (jh)f'_0 + \\frac{j^2h^2}{2}f''_0 + \\dots \\right) = \\left(\\frac{1}{h}\\sum b_j \\right)f_0 + \\left(\\sum j b_j \\right)f'_0 + h\\left(\\frac{1}{2}\\sum j^2 b_j \\right)f''_0 + \\dots\n$$\n为了在近似 $f'_0$ 时达到四阶精度，前五项必须与 $f'_0$ 的泰勒展开相匹配。这导出了一个关于 $b_0, \\dots, b_4$ 的5元线性方程组：\n1. $\\sum_{j=0}^{4} b_j = 0$\n2. $\\sum_{j=0}^{4} j b_j = 1$\n3. $\\sum_{j=0}^{4} j^2 b_j = 0$\n4. $\\sum_{j=0}^{4} j^3 b_j = 0$\n5. $\\sum_{j=0}^{4} j^4 b_j = 0$\n\n这个范德蒙型方程组可以直接求解。或者，我们可以使用基于前向差分算子 $\\Delta_h f(x) = f(x+h) - f(x)$ 的待定系数法。导数算子可以表示为 $D = \\frac{1}{h}\\ln(E) = \\frac{1}{h}\\ln(1+\\Delta_h)$，其中 $E$ 是位移算子。\n$$\nf'(x_0) = \\frac{1}{h} \\left(\\Delta_h - \\frac{\\Delta_h^2}{2} + \\frac{\\Delta_h^3}{3} - \\frac{\\Delta_h^4}{4} + \\dots \\right) f(x_0)\n$$\n在 $\\mathcal{O}(h^4)$ 项处截断，我们得到 $h f'_0$ 的近似：\n$$\nh f'_0 \\approx \\Delta_h f_0 - \\frac{1}{2}\\Delta_h^2 f_0 + \\frac{1}{3}\\Delta_h^3 f_0 - \\frac{1}{4}\\Delta_h^4 f_0\n$$\n我们用函数值 $f_j$ 来表示 $\\Delta_h$ 的幂：\n$\\Delta_h f_0 = f_1 - f_0$\n$\\Delta_h^2 f_0 = f_2 - 2f_1 + f_0$\n$\\Delta_h^3 f_0 = f_3 - 3f_2 + 3f_1 - f_0$\n$\\Delta_h^4 f_0 = f_4 - 4f_3 + 6f_2 - 4f_1 + f_0$\n将这些代入 $h f'_0$ 的近似式中：\n$$\nh f'_0 \\approx (f_1-f_0) - \\frac{1}{2}(f_2-2f_1+f_0) + \\frac{1}{3}(f_3-3f_2+3f_1-f_0) - \\frac{1}{4}(f_4-4f_3+6f_2-4f_1+f_0)\n$$\n收集每个 $f_j$ 的系数：\n$b_0$：$-1 - \\frac{1}{2} - \\frac{1}{3} - \\frac{1}{4} = -\\frac{12+6+4+3}{12} = -\\frac{25}{12}$\n$b_1$：$1 - \\frac{1}{2}(-2) + \\frac{1}{3}(3) - \\frac{1}{4}(-4) = 1+1+1+1=4$\n$b_2$：$-\\frac{1}{2}(1) + \\frac{1}{3}(-3) - \\frac{1}{4}(6) = -\\frac{1}{2} - 1 - \\frac{3}{2} = -3$\n$b_3$：$\\frac{1}{3}(1) - \\frac{1}{4}(-4) = \\frac{1}{3} + 1 = \\frac{4}{3}$\n$b_4$：$-\\frac{1}{4}(1) = -\\frac{1}{4}$\n所以，系数为 $b_0 = -\\frac{25}{12}$，$b_1 = 4$，$b_2 = -3$，$b_3 = \\frac{4}{3}$，$b_4 = -\\frac{1}{4}$。这些系数满足前面推导的线性方程组。\n\n最终结果是所有推导出的系数的集合。\n$a_1 = \\frac{3}{4}$, $a_2 = -\\frac{3}{20}$, $a_3 = \\frac{1}{60}$\n$\\gamma = \\frac{1}{140}$\n$b_0 = -\\frac{25}{12}$, $b_1 = 4$, $b_2 = -3$, $b_3 = \\frac{4}{3}$, $b_4 = -\\frac{1}{4}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{4}  -\\frac{3}{20}  \\frac{1}{60}  \\frac{1}{140}  -\\frac{25}{12}  4  -3  \\frac{4}{3}  -\\frac{1}{4}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "构建有限差分格式后，其最重要的特性是它在多大程度上能准确地表示不同频率的波。本练习  将指导您通过傅里叶分析来量化*色散误差*——即数值波以错误速度传播的现象。通过将标准格式与高性能的紧致格式进行比较，您将学会如何评估和选择解决波传播问题的最佳数值工具。",
            "id": "4124024",
            "problem": "考虑由压力-位移公式导出的一维线性声学问题，该问题可简化为标量波动方程\n$$\n\\frac{\\partial^2 p(x,t)}{\\partial t^2} - c^2 \\frac{\\partial^2 p(x,t)}{\\partial x^2} = 0,\n$$\n其中 $p(x,t)$ 是声压，$c$ 是声速。在一个间距为 $\\Delta x$、节点为 $x_j = j \\Delta x$ 的均匀周期性网格上，使用三类格式（前向、后向和中心差分）以及一种紧致三对角格式来定义空间导数的有限差分近似。\n\n你的任务是构建、分析和比较三种基于周期性网格上一阶导数近似构建的 $\\frac{\\partial^2}{\\partial x^2}$ 二阶导数离散化的半离散色散性质：\n\n1. 将后向差分应用于前向差分形成的二阶导数（记为 $D_{\\mathrm{b}} D_{\\mathrm{f}}$）。\n2. 应用两次中心差分形成的二阶导数（记为 $D_{\\mathrm{c}}^2$）。\n3. 将一阶导数的三对角紧致有限差分近似进行平方形成的二阶导数（记为 $D_{\\mathrm{comp}}^2$）。\n\n从以下与问题背景相符的基本出发点开始：\n- 波动方程的连续平面波解 $p(x,t) = \\Re\\{ \\exp( \\mathrm{i} (k x - \\omega t) ) \\}$ 满足连续色散关系 $\\omega^2 = c^2 k^2$，其中 $k$ 是波数，$\\omega$ 是角频率。\n- 在均匀周期性网格上，任何作用于离散傅里叶模 $\\exp(\\mathrm{i} j \\theta)$ 的线性、平移不变的离散导数算子都由一个离散傅里叶符号来表征，其中 $\\theta = k \\Delta x$ 是网格归一化的波数（一个以弧度为单位的角度）。\n\n请按以下步骤进行，不要使用任何未从第一性原理推导的快捷公式：\n\nA. 在周期性网格上，推导与前向差分、后向差分和中心差分相对应的一阶导数算子的离散傅里叶符号。然后，用 $\\theta$ 表示三个二阶导数算子 $D_{\\mathrm{b}} D_{\\mathrm{f}}$、$D_{\\mathrm{c}}^2$ 和 $D_{\\mathrm{comp}}^2$ 的离散傅里叶符号。\n\nB. 在周期性网格上，为一阶导数构建一个具有未知系数 $\\,\\alpha\\,,\\,b\\,,\\,c\\,$ 的 Padé 型三对角紧致有限差分格式，其形式如下：\n$$\n\\alpha\\, f'_{j-1} + f'_j + \\alpha\\, f'_{j+1}\n= \\frac{1}{\\Delta x}\\left[\\, b \\left(f_{j+1} - f_{j-1}\\right) + c \\left(f_{j+2} - f_{j-2}\\right) \\,\\right].\n$$\n使用关于平滑函数 $f(x)$ 的泰勒级数一致性和离散傅里叶模分析，确定使一阶导数达到六阶精度的系数 $\\,\\alpha\\,,\\,b\\,,\\,c\\,$。然后，求出 $D_{\\mathrm{comp}}$ 对应的离散傅里叶符号，并通过平方得到 $D_{\\mathrm{comp}}^2$ 的符号。\n\nC. 对于三种二阶导数离散化中的每一种，通过将连续关系 $\\omega^2 = c^2 k^2$ 中的 $k^2$ 替换为由二阶导数符号作用于傅里叶模 $\\exp(\\mathrm{i} j \\theta)$ 所产生的相应有效离散波数 $k_{\\mathrm{eff}}(\\theta)$ 的模的平方，来定义半离散色散关系。由此，定义相速比\n$$\nR(\\theta) = \\frac{\\omega / k}{c} = \\frac{k_{\\mathrm{eff}}(\\theta)}{k} = \\frac{k_{\\mathrm{eff}}(\\theta)\\,\\Delta x}{\\theta},\n$$\n该比值是无量纲的，并且仅依赖于 $\\theta$。\n\nD. 实现一个程序，对于给定的测试角度 $\\,\\theta\\,$，计算三种格式 $D_{\\mathrm{b}} D_{\\mathrm{f}}$、$D_{\\mathrm{c}}^2$ 和 $D_{\\mathrm{comp}}^2$ 各自的绝对相速误差 $\\,E(\\theta) = \\left| R(\\theta) - 1 \\right|$。\n\n角度必须以弧度表示。输出无需物理单位，因为所求的量是无量纲的。\n\n测试组：\n- 情况 1：$\\theta = \\pi/16$（长波极限）。\n- 情况 2：$\\theta = \\pi/2$（中程波数）。\n- 情况 3：$\\theta = 0.99\\,\\pi$（接近网格上的奈奎斯特极限）。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$\n\\left[ E_{\\mathrm{b}\\mathrm{f}}(\\pi/16),\\, E_{\\mathrm{c}^2}(\\pi/16),\\, E_{\\mathrm{comp}^2}(\\pi/16),\\, E_{\\mathrm{b}\\mathrm{f}}(\\pi/2),\\, E_{\\mathrm{c}^2}(\\pi/2),\\, E_{\\mathrm{comp}^2}(\\pi/2),\\, E_{\\mathrm{b}\\mathrm{f}}(0.99\\pi),\\, E_{\\mathrm{c}^2}(0.99\\pi),\\, E_{\\mathrm{comp}^2}(0.99\\pi) \\right],\n$$\n其中 $E_{\\mathrm{b}\\mathrm{f}}$ 表示 $D_{\\mathrm{b}} D_{\\mathrm{f}}$ 的绝对相速误差，$E_{\\mathrm{c}^2}$ 表示 $D_{\\mathrm{c}}^2$ 的绝对相速误差，$E_{\\mathrm{comp}^2}$ 表示 $D_{\\mathrm{comp}}^2$ 的绝对相速误差。",
            "solution": "该问题要求在一维波动方程的背景下，推导和比较三种对二阶空间导数 $\\frac{\\partial^2}{\\partial x^2}$ 的有限差分近似的色散性质。分析将在傅里叶域中进行。\n\nA. 标准格式的离散傅里叶符号推导\n\n一个离散算子 $D$ 由其傅里叶符号 $\\widehat{D}(\\theta)$ 表征，该符号通过其对离散傅里叶模 $f_j = \\exp(\\mathrm{i} j \\theta)$ 的作用来定义，其中 $\\theta = k \\Delta x$ 是网格归一化的波数。该作用为 $D f_j = \\widehat{D}(\\theta) f_j$。精确的一阶导数算子 $\\frac{\\partial}{\\partial x}$ 的符号为 $\\frac{\\mathrm{i}k\\exp(\\mathrm{i}kx)}{\\exp(\\mathrm{i}kx)} = \\mathrm{i}k = \\frac{\\mathrm{i}\\theta}{\\Delta x}$。\n\n首先，我们推导一阶导数算子的符号。\n1.  前向差分 ($D_{\\mathrm{f}}$): $D_{\\mathrm{f}} f_j = \\frac{f_{j+1} - f_j}{\\Delta x}$。\n    将其应用于 $f_j = \\exp(\\mathrm{i} j \\theta)$：\n    $$\n    D_{\\mathrm{f}} \\exp(\\mathrm{i} j \\theta) = \\frac{\\exp(\\mathrm{i} (j+1) \\theta) - \\exp(\\mathrm{i} j \\theta)}{\\Delta x} = \\frac{\\exp(\\mathrm{i} \\theta) - 1}{\\Delta x} \\exp(\\mathrm{i} j \\theta)\n    $$\n    因此，其符号为 $\\widehat{D}_{\\mathrm{f}}(\\theta) = \\frac{\\exp(\\mathrm{i} \\theta) - 1}{\\Delta x}$。\n\n2.  后向差分 ($D_{\\mathrm{b}}$): $D_{\\mathrm{b}} f_j = \\frac{f_j - f_{j-1}}{\\Delta x}$。\n    将其应用于 $f_j = \\exp(\\mathrm{i} j \\theta)$：\n    $$\n    D_{\\mathrm{b}} \\exp(\\mathrm{i} j \\theta) = \\frac{\\exp(\\mathrm{i} j \\theta) - \\exp(\\mathrm{i} (j-1) \\theta)}{\\Delta x} = \\frac{1 - \\exp(-\\mathrm{i} \\theta)}{\\Delta x} \\exp(\\mathrm{i} j \\theta)\n    $$\n    因此，其符号为 $\\widehat{D}_{\\mathrm{b}}(\\theta) = \\frac{1 - \\exp(-\\mathrm{i} \\theta)}{\\Delta x}$。\n\n3.  中心差分 ($D_{\\mathrm{c}}$): $D_{\\mathrm{c}} f_j = \\frac{f_{j+1} - f_{j-1}}{2 \\Delta x}$。\n    将其应用于 $f_j = \\exp(\\mathrm{i} j \\theta)$：\n    $$\n    D_{\\mathrm{c}} \\exp(\\mathrm{i} j \\theta) = \\frac{\\exp(\\mathrm{i} (j+1) \\theta) - \\exp(\\mathrm{i} (j-1) \\theta)}{2 \\Delta x} = \\frac{\\exp(\\mathrm{i} \\theta) - \\exp(-\\mathrm{i} \\theta)}{2 \\Delta x} \\exp(\\mathrm{i} j \\theta) = \\frac{2\\mathrm{i} \\sin(\\theta)}{2 \\Delta x} \\exp(\\mathrm{i} j \\theta)\n    $$\n    因此，其符号为 $\\widehat{D}_{\\mathrm{c}}(\\theta) = \\frac{\\mathrm{i} \\sin(\\theta)}{\\Delta x}$。\n\n接下来，我们推导二阶导数算子的符号。复合算子的符号是各个符号的乘积。\n1.  $D_{\\mathrm{b}} D_{\\mathrm{f}}$：\n    $$\n    \\widehat{D}_{\\mathrm{bf}}(\\theta) = \\widehat{D}_{\\mathrm{b}}(\\theta) \\widehat{D}_{\\mathrm{f}}(\\theta) = \\left( \\frac{1 - \\exp(-\\mathrm{i} \\theta)}{\\Delta x} \\right) \\left( \\frac{\\exp(\\mathrm{i} \\theta) - 1}{\\Delta x} \\right) = \\frac{\\exp(\\mathrm{i} \\theta) - 1 - 1 + \\exp(-\\mathrm{i} \\theta)}{(\\Delta x)^2} = \\frac{2\\cos(\\theta) - 2}{(\\Delta x)^2}\n    $$\n    这是二阶导数的标准二阶中心差分 $\\frac{f_{j+1} - 2f_j + f_{j-1}}{(\\Delta x)^2}$ 的符号。\n\n2.  $D_{\\mathrm{c}}^2$：\n    $$\n    \\widehat{D}_{\\mathrm{c}^2}(\\theta) = \\left( \\widehat{D}_{\\mathrm{c}}(\\theta) \\right)^2 = \\left( \\frac{\\mathrm{i} \\sin(\\theta)}{\\Delta x} \\right)^2 = -\\frac{\\sin^2(\\theta)}{(\\Delta x)^2}\n    $$\n\nB. 六阶紧致格式的推导\n\n给定紧致格式的一般形式，该形式关联了函数值 $f_j$ 与其导数值 $f'_j$：\n$$\n\\alpha\\, f'_{j-1} + f'_j + \\alpha\\, f'_{j+1} = \\frac{1}{\\Delta x}\\left[\\, b \\left(f_{j+1} - f_{j-1}\\right) + c \\left(f_{j+2} - f_{j-2}\\right) \\,\\right]\n$$\n为了找到系数 $\\alpha$、$b$ 和 $c$，我们要求离散算子尽可能精确地逼近连续导数。我们将精确关系 $f_j = \\exp(\\mathrm{i} j \\theta)$ 和 $f'_j = \\frac{\\mathrm{i}\\theta}{\\Delta x} \\exp(\\mathrm{i} j \\theta)$ 代入格式的定义中：\n$$\n\\alpha \\frac{\\mathrm{i}\\theta}{\\Delta x} e^{\\mathrm{i}(j-1)\\theta} + \\frac{\\mathrm{i}\\theta}{\\Delta x} e^{\\mathrm{i}j\\theta} + \\alpha \\frac{\\mathrm{i}\\theta}{\\Delta x} e^{\\mathrm{i}(j+1)\\theta} = \\frac{1}{\\Delta x}\\left[ b(e^{\\mathrm{i}(j+1)\\theta} - e^{\\mathrm{i}(j-1)\\theta}) + c(e^{\\mathrm{i}(j+2)\\theta} - e^{\\mathrm{i}(j-2)\\theta}) \\right]\n$$\n两边同除以 $\\frac{1}{\\Delta x}\\exp(\\mathrm{i} j \\theta)$，方程简化为：\n$$\n\\mathrm{i}\\theta (\\alpha e^{-\\mathrm{i}\\theta} + 1 + \\alpha e^{\\mathrm{i}\\theta}) = b(e^{\\mathrm{i}\\theta} - e^{-\\mathrm{i}\\theta}) + c(e^{\\mathrm{i}2\\theta} - e^{-\\mathrm{i}2\\theta})\n$$\n使用欧拉恒等式 $e^{\\mathrm{i}x} \\pm e^{-\\mathrm{i}x}$，我们得到：\n$$\n\\mathrm{i}\\theta (1 + 2\\alpha \\cos(\\theta)) = b(2\\mathrm{i} \\sin(\\theta)) + c(2\\mathrm{i} \\sin(2\\theta))\n$$\n$$\n\\theta (1 + 2\\alpha \\cos(\\theta)) = 2b \\sin(\\theta) + 2c \\sin(2\\theta)\n$$\n为达到六阶精度，等式两边在 $\\theta=0$ 附近的泰勒级数展开必须匹配到 $\\theta^5$ 项，从而使主误差项与 $\\theta^7$ 成正比。\n左侧：$\\theta(1 + 2\\alpha(1 - \\frac{\\theta^2}{2} + \\frac{\\theta^4}{24} - \\dots)) = (1+2\\alpha)\\theta - \\alpha\\theta^3 + \\frac{\\alpha}{12}\\theta^5 - O(\\theta^7)$。\n右侧：$2b(\\theta - \\frac{\\theta^3}{6} + \\frac{\\theta^5}{120} - \\dots) + 2c(2\\theta - \\frac{8\\theta^3}{6} + \\frac{32\\theta^5}{120} - \\dots) = (2b+4c)\\theta - (\\frac{b}{3}+\\frac{8c}{3})\\theta^3 + (\\frac{b}{60}+\\frac{32c}{60})\\theta^5 - O(\\theta^7)$。\n匹配 $\\theta$ 的幂次系数：\n\\begin{itemize}\n    \\item $\\theta^1$：$1+2\\alpha = 2b+4c$\n    \\item $\\theta^3$：$\\alpha = \\frac{b}{3}+\\frac{8c}{3} \\implies 3\\alpha = b+8c$\n    \\item $\\theta^5$：$\\frac{\\alpha}{12} = \\frac{b}{60}+\\frac{32c}{60} \\implies 5\\alpha = b+32c$\n\\end{itemize}\n我们求解这个关于 $\\alpha, b, c$ 的三元线性方程组。第三个方程减去第二个方程得到 $2\\alpha = 24c$，所以 $c = \\frac{\\alpha}{12}$。将此代入第二个方程得到 $3\\alpha = b + 8(\\frac{\\alpha}{12}) = b + \\frac{2\\alpha}{3}$，从而得出 $b = \\frac{7\\alpha}{3}$。最后，将 $b$ 和 $c$ 代入第一个方程：$1+2\\alpha = 2(\\frac{7\\alpha}{3}) + 4(\\frac{\\alpha}{12}) = \\frac{14\\alpha}{3} + \\frac{\\alpha}{3} = \\frac{15\\alpha}{3} = 5\\alpha$。这简化为 $1=3\\alpha$，所以 $\\alpha = \\frac{1}{3}$。\n其他系数为 $b = \\frac{7}{3}(\\frac{1}{3}) = \\frac{7}{9}$ 和 $c = \\frac{1}{12}(\\frac{1}{3}) = \\frac{1}{36}$。\n\n紧致一阶导数算子 $\\widehat{D}_{\\mathrm{comp}}(\\theta)$ 的傅里叶符号通过在傅里叶域中求解 $f'_j/f_j$ 得到：\n$$\n\\widehat{D}_{\\mathrm{comp}}(\\theta) = \\frac{\\mathrm{i}}{\\Delta x} \\frac{2b \\sin(\\theta) + 2c \\sin(2\\theta)}{1 + 2\\alpha \\cos(\\theta)}\n$$\n代入系数并化简：\n$$\n\\widehat{D}_{\\mathrm{comp}}(\\theta) = \\frac{\\mathrm{i}}{\\Delta x} \\frac{2(\\frac{7}{9}) \\sin(\\theta) + 2(\\frac{1}{36}) \\sin(2\\theta)}{1 + 2(\\frac{1}{3}) \\cos(\\theta)} = \\frac{\\mathrm{i}}{\\Delta x} \\frac{\\frac{14}{9} \\sin(\\theta) + \\frac{1}{18} (2\\sin\\theta\\cos\\theta)}{1 + \\frac{2}{3} \\cos(\\theta)} = \\frac{\\mathrm{i}}{\\Delta x} \\frac{\\frac{\\sin(\\theta)}{9}(14 + \\cos(\\theta))}{\\frac{1}{3}(3 + 2\\cos(\\theta))} = \\frac{\\mathrm{i}}{\\Delta x} \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3(3 + 2 \\cos(\\theta))}\n$$\n二阶导数算子 $D_{\\mathrm{comp}}^2$ 的符号是一阶导数符号的平方：\n$$\n\\widehat{D}_{\\mathrm{comp}^2}(\\theta) = \\left( \\widehat{D}_{\\mathrm{comp}}(\\theta) \\right)^2 = -\\frac{1}{(\\Delta x)^2} \\left[ \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3(3 + 2 \\cos(\\theta))} \\right]^2\n$$\n\nC. 半离散色散关系与相速比\n\n波动方程的半离散形式为 $\\frac{\\partial^2 p}{\\partial t^2} - c^2 D^2 p = 0$，其中 $D^2$ 是离散二阶导数算子之一。代入一个傅里叶模 $p_j(t) = \\exp(-\\mathrm{i}\\omega t)\\exp(\\mathrm{i} j \\theta)$ 可以得到半离散色散关系：\n$$\n(-\\mathrm{i}\\omega)^2 - c^2 \\widehat{D^2}(\\theta) = 0 \\implies \\omega^2 = -c^2 \\widehat{D^2}(\\theta)\n$$\n问题定义了一个有效波数 $k_{\\mathrm{eff}}$，使得 $\\omega^2 = c^2 k_{\\mathrm{eff}}^2$。比较这些可得 $k_{\\mathrm{eff}}^2 = -\\widehat{D^2}(\\theta)$。对于所考虑的非耗散格式，$\\widehat{D^2}(\\theta)$ 是实数且非正，因此 $k_{\\mathrm{eff}}$ 是实数。\n我们定义归一化有效波数为 $\\theta_{\\mathrm{eff}}(\\theta) = k_{\\mathrm{eff}}(\\theta)\\Delta x = \\sqrt{-(\\Delta x)^2 \\widehat{D^2}(\\theta)}$。\n相速比定义为 $R(\\theta) = \\frac{\\omega/k}{c} = \\frac{k_{\\mathrm{eff}}}{k} = \\frac{k_{\\mathrm{eff}}\\Delta x}{k\\Delta x} = \\frac{\\theta_{\\mathrm{eff}}(\\theta)}{\\theta}$。\n\n1.  $D_{\\mathrm{b}} D_{\\mathrm{f}}$：\n    $\\theta_{\\mathrm{eff, bf}}^2 = -(\\Delta x)^2 \\left( \\frac{2\\cos(\\theta) - 2}{(\\Delta x)^2} \\right) = 2(1-\\cos\\theta) = 4\\sin^2(\\frac{\\theta}{2})$。\n    对于 $\\theta \\in [0, \\pi]$，$\\theta_{\\mathrm{eff, bf}}(\\theta) = 2\\sin(\\frac{\\theta}{2})$。\n    $R_{\\mathrm{bf}}(\\theta) = \\frac{2\\sin(\\theta/2)}{\\theta}$。\n\n2.  $D_{\\mathrm{c}}^2$：\n    $\\theta_{\\mathrm{eff, c2}}^2 = -(\\Delta x)^2 \\left( -\\frac{\\sin^2(\\theta)}{(\\Delta x)^2} \\right) = \\sin^2(\\theta)$。\n    对于 $\\theta \\in [0, \\pi]$，$\\theta_{\\mathrm{eff, c2}}(\\theta) = \\sin(\\theta)$。\n    $R_{\\mathrm{c2}}(\\theta) = \\frac{\\sin(\\theta)}{\\theta}$。\n\n3.  $D_{\\mathrm{comp}}^2$：\n    $\\theta_{\\mathrm{eff, comp2}}^2 = -(\\Delta x)^2 \\left( -\\frac{1}{(\\Delta x)^2} \\left[ \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3(3 + 2 \\cos(\\theta))} \\right]^2 \\right) = \\left[ \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3(3 + 2 \\cos(\\theta))} \\right]^2$。\n    对于 $\\theta \\in [0, \\pi]$，分数中的所有项均为正，因此：\n    $\\theta_{\\mathrm{eff, comp2}}(\\theta) = \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3(3 + 2 \\cos(\\theta))}$。\n    $R_{\\mathrm{comp2}}(\\theta) = \\frac{\\sin(\\theta)(14 + \\cos(\\theta))}{3\\theta(3 + 2 \\cos(\\theta))}$。\n\nD. 实现\n\n每种格式的绝对相速误差为 $E(\\theta) = |R(\\theta) - 1|$。下面的程序将使用推导出的 $R(\\theta)$ 表达式，计算在指定角度 $\\theta = \\pi/16$、$\\theta = \\pi/2$ 和 $\\theta = 0.99\\pi$ 时，三种格式的该误差值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute phase speed error for three finite difference schemes\n    at specified grid-normalized wavenumbers.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        np.pi/16,\n        np.pi/2,\n        0.99 * np.pi\n    ]\n\n    # --- Define functions for the phase speed ratio R(theta) for each scheme ---\n\n    def r_bf(theta: float) - float:\n        \"\"\"Phase speed ratio for the D_b * D_f scheme.\"\"\"\n        # R(theta) = 2*sin(theta/2) / theta\n        if theta == 0:\n            return 1.0\n        return 2.0 * np.sin(theta / 2.0) / theta\n\n    def r_c2(theta: float) - float:\n        \"\"\"Phase speed ratio for the D_c^2 scheme.\"\"\"\n        # R(theta) = sin(theta) / theta\n        if theta == 0:\n            return 1.0\n        return np.sin(theta) / theta\n\n    def r_comp2(theta: float) - float:\n        \"\"\"Phase speed ratio for the D_comp^2 scheme.\"\"\"\n        # R(theta) = [sin(theta)*(14 + cos(theta))] / [3*theta*(3 + 2*cos(theta))]\n        if theta == 0:\n            return 1.0\n        \n        sin_t = np.sin(theta)\n        cos_t = np.cos(theta)\n        \n        numerator = sin_t * (14.0 + cos_t)\n        denominator = 3.0 * theta * (3.0 + 2.0 * cos_t)\n        \n        return numerator / denominator\n\n    results = []\n    schemes = [\n        ('bf', r_bf),\n        ('c2', r_c2),\n        ('comp2', r_comp2)\n    ]\n\n    # Main logic to calculate the absolute error for each case.\n    for theta in test_cases:\n        for name, r_func in schemes:\n            ratio = r_func(theta)\n            error = abs(ratio - 1.0)\n            results.append(error)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这项实践将所有概念整合到一个完整的声学波动方程模拟框架中。您将在交错网格上实现高效的时域有限差分（FDTD）方法，这是计算物理和工程领域的标准技术 。本练习将巩固您对空间差分、时间积分和稳定性分析（CFL条件）如何结合起来，以创建有效、稳定且精确的波动模拟的理解。",
            "id": "4124032",
            "problem": "考虑在均匀介质中，一维线性化声学方程。该介质具有恒定的质量密度 $\\rho_0$ 和声速 $c$。方程描述了压力 $p(x,t)$ 和质点速度 $u(x,t)$。控制方程为连续性方程和动量方程：$$\\frac{\\partial p}{\\partial t} = - \\rho_0 c^2 \\frac{\\partial u}{\\partial x}, \\quad \\frac{\\partial u}{\\partial t} = - \\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}.$$ 所有物理量均使用国际单位制（SI）：$x$ 的单位为米（$\\mathrm{m}$），$t$ 的单位为秒（$\\mathrm{s}$），$p$ 的单位为帕斯卡（$\\mathrm{Pa}$），$u$ 的单位为米每秒（$\\mathrm{m/s}$），$\\rho_0$ 的单位为千克每立方米（$\\mathrm{kg/m^3}$），$c$ 的单位为米每秒（$\\mathrm{m/s}$）。使用均匀交错空间网格，其中压力 $p_j^n$ 定义在整数索引 $j$ 的位置 $x_j = j \\Delta x$ 上，而质点速度 $u_{j+1/2}^{n+1/2}$ 定义在半整数索引的位置 $x_{j+1/2} = (j + 1/2) \\Delta x$ 和半步时间 $t^{n+1/2} = (n + 1/2) \\Delta t$ 上。采用蛙跳（leapfrog）时间步进策略，其中 $u$ 在半时间步长处更新， $p$ 在全时间步长处更新。使用与交错网格一致的前向或后向差分来近似空间导数，使得离散空间导数在相邻的交错点之间中心化。\n\n从上述方程和定义出发，完成以下任务：\n\n- 使用蛙跳格式和在时间上中心、在空间上适当采用前向或后向的有限差分法，在交错网格上推导 $u_{j+1/2}^{n+1/2}$ 和 $p_j^{n+1}$ 的离散更新方程。不要假设任何预先推导好的更新公式；从连续方程和离散网格定义开始。\n- 使用角频率为 $\\omega$、波数为 $k$ 的平面波假设（ansatz），构建一个在所推导的有限差分格式下连接 $\\omega$ 和 $k$ 的离散色散关系。\n- 从离散色散关系中，确定关于 Courant 数 $r = c \\Delta t / \\Delta x$ 的稳定性条件，并给出使 $\\omega$ 保持实数值的条件。\n- 实现一个程序，给定 $(c, \\Delta x, \\Delta t, N_x)$，计算：\n  1. Courant 数 $r = c \\Delta t / \\Delta x$（无量纲）。\n  2. 离散无量纲波数集合 $\\kappa_m = k_m \\Delta x = 2 \\pi m / N_x$，其中整数 $m$ 从 $m = 1$ 到 $m = N_x/2$，假设在 $N_x$ 个点的均匀网格上具有周期性。角度单位为弧度。\n  3. 对于每个 $\\kappa_m$，计算由离散色散关系所蕴含的数值相速度 $c_p^{\\mathrm{num}}$。将其与物理相速度 $c$ 进行比较，并计算相对相速度误差 $\\left| c_p^{\\mathrm{num}} - c \\right| / c$（无量纲）。\n  4. 在所有模式 $m \\in \\{1, \\dots, N_x/2\\}$ 上的最大相对相速度误差（无量纲）。如果格式不稳定（即，计算出的 $r$ 违反了稳定性条件），则将最大误差设置为浮点值 $-1.0$。\n  5. 一个布尔类型的稳定性标志 $S$，如果稳定则 $S = \\mathrm{True}$，如果不稳定则 $S = \\mathrm{False}$。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个条目对应一个测试用例，并且必须是一个双元素列表 $[E,S]$，其中 $E$ 是最大相对相速度误差（浮点数，无量纲），$S$ 是稳定性布尔值。例如，格式应类似于 $[[E_1,S_1],[E_2,S_2],\\dots]$，不含空格。\n\n使用以下参数值测试套件来运行实现：\n\n- 情况 1（一般稳定情况）：$c = 343 \\ \\mathrm{m/s}$，$\\Delta x = 0.01 \\ \\mathrm{m}$，选择 $\\Delta t$ 使得 $r = 0.9$，以及 $N_x = 128$。\n- 情况 2（稳定性边界）：$c = 343 \\ \\mathrm{m/s}$，$\\Delta x = 0.01 \\ \\mathrm{m}$，选择 $\\Delta t$ 使得 $r = 1.0$，以及 $N_x = 128$。\n- 情况 3（不稳定情况）：$c = 343 \\ \\mathrm{m/s}$，$\\Delta x = 0.01 \\ \\mathrm{m}$，选择 $\\Delta t$ 使得 $r = 1.1$，以及 $N_x = 128$。\n- 情况 4（粗网格边界情况）：$c = 343 \\ \\mathrm{m/s}$，$\\Delta x = 0.5 \\ \\mathrm{m}$，选择 $\\Delta t$ 使得 $r = 0.9$，以及 $N_x = 4$。\n\n所有的 $c$、$\\Delta x$ 和 $\\Delta t$ 都必须以国际单位制（分别为 $\\mathrm{m/s}$、$\\mathrm{m}$ 和 $\\mathrm{s}$）进行解释；输出误差 $E$ 是无量纲的，稳定性标志 $S$ 是布尔值。任何三角量的角度单位都是弧度。你的程序应以上述确切格式生成最终输出行。",
            "solution": "该问题是有效的，因为它在科学上基于声学和数值分析的原理，问题提法清晰、客观，并包含了推导所要求的结果和实现相应程序所需的所有信息。\n\n求解过程分几步进行：首先，从连续控制方程推导离散更新方程；其次，推导离散色散关系和稳定性条件；第三，推导数值相速度及其相关误差的公式。\n\n### 1. 离散更新方程的推导\n\n问题描述了在交错空间网格上的蛙跳时间步进格式。压力 $p_j^n$ 定义在整数空间索引 $j$ 和完整时间步长 $n$ 处，即 $(x_j, t^n) = (j \\Delta x, n \\Delta t)$。质点速度 $u_{j+1/2}^{n+1/2}$ 定义在半整数空间索引和半整数时间步长处，即 $(x_{j+1/2}, t^{n+1/2}) = ((j + 1/2) \\Delta x, (n + 1/2) \\Delta t)$。\n\n蛙跳时域有限差分（FDTD）方法的核心思想是在用于近似的网格点之间的中心位置评估时间和空间导数。这会产生一个二阶精度的格式。\n\n**质点速度 $u$ 的更新方程：**\n\n动量方程为 $\\frac{\\partial u}{\\partial t} = - \\frac{1}{\\rho_0} \\frac{\\partial p}{\\partial x}$。我们使用时间 $t^n$ 处的压力值将 $u$ 从时间 $t^{n-1/2}$ 更新到 $t^{n+1/2}$。这需要在 $(x_{j+1/2}, t^n)$ 处评估导数。\n\n在 $(x_{j+1/2}, t^n)$ 处的时间导数 $\\frac{\\partial u}{\\partial t}$ 使用以 $t^n$ 为中心的时间中心差分来近似：\n$$\n\\frac{\\partial u}{\\partial t} \\bigg|_{j+1/2, n} \\approx \\frac{u_{j+1/2}^{n+1/2} - u_{j+1/2}^{n-1/2}}{\\Delta t}\n$$\n在 $(x_{j+1/2}, t^n)$ 处的空间导数 $\\frac{\\partial p}{\\partial x}$ 使用以 $x_{j+1/2}$ 为中心的空间中心差分来近似：\n$$\n\\frac{\\partial p}{\\partial x} \\bigg|_{j+1/2, n} \\approx \\frac{p_{j+1}^n - p_j^n}{\\Delta x}\n$$\n将这些代入动量方程得到：\n$$\n\\frac{u_{j+1/2}^{n+1/2} - u_{j+1/2}^{n-1/2}}{\\Delta t} = - \\frac{1}{\\rho_0} \\frac{p_{j+1}^n - p_j^n}{\\Delta x}\n$$\n整理得到 $u_{j+1/2}^{n+1/2}$ 的第一个更新方程：\n$$\nu_{j+1/2}^{n+1/2} = u_{j+1/2}^{n-1/2} - \\frac{\\Delta t}{\\rho_0 \\Delta x} (p_{j+1}^n - p_j^n)\n$$\n\n**压力 $p$ 的更新方程：**\n\n连续性方程为 $\\frac{\\partial p}{\\partial t} = - \\rho_0 c^2 \\frac{\\partial u}{\\partial x}$。我们使用时间 $t^{n+1/2}$ 处的速度值将 $p$ 从时间 $t^n$ 更新到 $t^{n+1}$。这需要在 $(x_j, t^{n+1/2})$ 处评估导数。\n\n在 $(x_j, t^{n+1/2})$ 处的时间导数 $\\frac{\\partial p}{\\partial t}$ 使用以 $t^{n+1/2}$ 为中心的时间中心差分来近似：\n$$\n\\frac{\\partial p}{\\partial t} \\bigg|_{j, n+1/2} \\approx \\frac{p_j^{n+1} - p_j^n}{\\Delta t}\n$$\n在 $(x_j, t^{n+1/2})$ 处的空间导数 $\\frac{\\partial u}{\\partial x}$ 使用以 $x_j$ 为中心的空间中心差分来近似：\n$$\n\\frac{\\partial u}{\\partial x} \\bigg|_{j, n+1/2} \\approx \\frac{u_{j+1/2}^{n+1/2} - u_{j-1/2}^{n+1/2}}{\\Delta x}\n$$\n将这些代入连续性方程得到：\n$$\n\\frac{p_j^{n+1} - p_j^n}{\\Delta t} = - \\rho_0 c^2 \\frac{u_{j+1/2}^{n+1/2} - u_{j-1/2}^{n+1/2}}{\\Delta x}\n$$\n整理得到 $p_j^{n+1}$ 的第二个更新方程：\n$$\np_j^{n+1} = p_j^n - \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} (u_{j+1/2}^{n+1/2} - u_{j-1/2}^{n+1/2})\n$$\n\n### 2. 离散色散关系和稳定性条件\n\n为了分析该格式的性质，我们对离散变量使用平面波假设（ansatz）：\n$$\np_j^n = P_0 e^{i(k x_j - \\omega t^n)} = P_0 e^{i(k j \\Delta x - \\omega n \\Delta t)}\n$$\n$$\nu_{j+1/2}^{n+1/2} = U_0 e^{i(k x_{j+1/2} - \\omega t^{n+1/2})} = U_0 e^{i(k (j+1/2) \\Delta x - \\omega (n+1/2) \\Delta t)}\n$$\n其中 $k$ 是波数，$\\omega$ 是角频率，$P_0, U_0$ 是复振幅。将该假设代入 $u$ 的更新方程：\n$$\nU_0 e^{i(k(j+1/2)\\Delta x - \\omega(n+1/2)\\Delta t)} - U_0 e^{i(k(j+1/2)\\Delta x - \\omega(n-1/2)\\Delta t)} = - \\frac{\\Delta t}{\\rho_0 \\Delta x} (P_0 e^{i(k(j+1)\\Delta x - \\omega n \\Delta t)} - P_0 e^{i(kj\\Delta x - \\omega n \\Delta t)})\n$$\n除以公因子 $e^{i k(j+1/2)\\Delta x} e^{-i\\omega n \\Delta t}$：\n$$\nU_0 (e^{-i\\omega\\Delta t/2} - e^{i\\omega\\Delta t/2}) = - \\frac{\\Delta t P_0}{\\rho_0 \\Delta x} (e^{ik\\Delta x/2} - e^{-ik\\Delta x/2})\n$$\n使用欧拉公式 $e^{i\\theta} - e^{-i\\theta} = 2i \\sin\\theta$：\n$$\nU_0 (-2i \\sin(\\omega\\Delta t/2)) = - \\frac{\\Delta t P_0}{\\rho_0 \\Delta x} (2i \\sin(k\\Delta x/2))\n$$\n$$\n\\frac{U_0}{P_0} = \\frac{\\Delta t}{\\rho_0 \\Delta x} \\frac{\\sin(k\\Delta x/2)}{\\sin(\\omega\\Delta t/2)} \\quad (1)\n$$\n接下来，将该假设代入 $p$ 的更新方程：\n$$\nP_0 (e^{-i\\omega\\Delta t} - 1)e^{i(kj\\Delta x - \\omega n \\Delta t)} = - \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} U_0 (e^{ik\\Delta x/2} - e^{-ik\\Delta x/2}) e^{i(kj\\Delta x - \\omega(n+1/2)\\Delta t)}\n$$\n$$\nP_0 e^{-i\\omega\\Delta t/2}(e^{-i\\omega\\Delta t/2} - e^{i\\omega\\Delta t/2}) = - \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} U_0 (2i \\sin(k\\Delta x/2)) e^{-i\\omega\\Delta t/2}\n$$\n$$\nP_0 (-2i \\sin(\\omega\\Delta t/2)) = - \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} U_0 (2i \\sin(k\\Delta x/2))\n$$\n$$\n\\frac{P_0}{U_0} = \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} \\frac{\\sin(k\\Delta x/2)}{\\sin(\\omega\\Delta t/2)} \\quad (2)\n$$\n将方程 (1) 与方程 (2) 相乘：\n$$\n1 = \\left( \\frac{\\Delta t}{\\rho_0 \\Delta x} \\frac{\\sin(k\\Delta x/2)}{\\sin(\\omega\\Delta t/2)} \\right) \\left( \\rho_0 c^2 \\frac{\\Delta t}{\\Delta x} \\frac{\\sin(k\\Delta x/2)}{\\sin(\\omega\\Delta t/2)} \\right)\n$$\n$$\n1 = c^2 \\left(\\frac{\\Delta t}{\\Delta x}\\right)^2 \\frac{\\sin^2(k\\Delta x/2)}{\\sin^2(\\omega\\Delta t/2)}\n$$\n令 $r = c \\Delta t / \\Delta x$ 为 Courant 数，我们得到离散色散关系：\n$$\n\\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = r^2 \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n对于一个稳定的、非放大的数值解，角频率 $\\omega$ 必须是一个实数。这意味着 $\\sin(\\omega \\Delta t / 2)$ 必须是实数，并且其值必须在 $[-1, 1]$ 的范围内。因此，我们必须有：\n$$\n\\left| r \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\right| \\leq 1\n$$\n由于 $\\sin(k \\Delta x / 2)$ 可以等于 $1$（例如，对于奈奎斯特波数 $k = \\pi/\\Delta x$），该条件必须在最坏情况下成立。这要求 $|r| \\le 1$。因为 $c, \\Delta t, \\Delta x$ 都是正数，所以稳定性条件是：\n$$\nr = \\frac{c \\Delta t}{\\Delta x} \\leq 1\n$$\n\n### 3. 数值相速度和误差\n\n从色散关系可知，$\\sin(\\frac{\\omega \\Delta t}{2}) = \\pm r \\sin(\\frac{k \\Delta x}{2})$。对于前向传播的波，我们取正根。解出 $\\omega$：\n$$\n\\omega = \\frac{2}{\\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k \\Delta x}{2}\\right)\\right)\n$$\n数值相速度为 $c_p^{\\mathrm{num}} = \\omega/k$。\n$$\nc_p^{\\mathrm{num}} = \\frac{2}{k \\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k \\Delta x}{2}\\right)\\right)\n$$\n为了分析误差，我们将其与物理相速度 $c$ 进行比较。其比值为：\n$$\n\\frac{c_p^{\\mathrm{num}}}{c} = \\frac{2}{c k \\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k \\Delta x}{2}\\right)\\right) = \\frac{2}{k (r \\Delta x)} \\arcsin\\left(r \\sin\\left(\\frac{k \\Delta x}{2}\\right)\\right)\n$$\n令 $\\kappa = k \\Delta x$ 为无量纲波数。表达式变为：\n$$\n\\frac{c_p^{\\mathrm{num}}}{c} = \\frac{2}{r \\kappa} \\arcsin\\left(r \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n相对相速度误差由 $\\left| \\frac{c_p^{\\mathrm{num}}}{c} - 1 \\right|$ 给出。程序将为每个离散波数 $\\kappa_m = 2 \\pi m / N_x$（其中 $m \\in \\{1, \\dots, N_x/2\\}$）计算此误差，并找出最大值。如果格式不稳定（$r  1$），此分析无效，因为 $\\omega$ 会变为复数，误差被赋值为 $-1.0$。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_metrics(c, dx, r_val, Nx):\n    \"\"\"\n    Calculates stability and maximum relative phase speed error for a given set of parameters.\n\n    Args:\n        c (float): Speed of sound (m/s).\n        dx (float): Spatial grid spacing (m).\n        r_val (float): Courant number.\n        Nx (int): Number of grid points.\n\n    Returns:\n        list: A two-element list [E, S] where E is the max relative error (float)\n              and S is the stability flag (bool).\n    \"\"\"\n    dt = r_val * dx / c\n    r = c * dt / dx\n\n    is_stable = r = 1.0\n    \n    if not is_stable:\n        return [-1.0, False]\n\n    # Modes m from 1 to Nx/2\n    # np.arange is exclusive of the stop value, so we need +1\n    m_values = np.arange(1, Nx // 2 + 1)\n    \n    # Nondimensional wavenumbers kappa_m = k_m * dx\n    kappa_values = 2 * np.pi * m_values / Nx\n    \n    # Calculate the ratio of numerical to physical phase velocity\n    # The term inside arcsin must not exceed 1.0, which is guaranteed by the stability check.\n    # A small epsilon is added to avoid potential division by zero if kappa_values could be zero,\n    # though here it starts from m=1, so kappa is never zero.\n    \n    # Expression for c_p_num / c\n    # sin_kappa_half = np.sin(kappa_values / 2) creates a vector of values\n    # The whole expression is vectorized with numpy\n    ratio_c_p_num_c = (2 / (r * kappa_values)) * np.arcsin(r * np.sin(kappa_values / 2))\n    \n    # Relative phase speed error\n    # This is also a vectorized operation\n    relative_errors = np.abs(ratio_c_p_num_c - 1)\n    \n    # Find the maximum error over all computed modes\n    max_relative_error = np.max(relative_errors)\n    \n    return [max_relative_error, True]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the final output.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    # Format: (c, delta_x, target_courant_r, Nx)\n    test_cases = [\n        # Case 1: stable case\n        (343.0, 0.01, 0.9, 128),\n        # Case 2: stability boundary\n        (343.0, 0.01, 1.0, 128),\n        # Case 3: unstable case\n        (343.0, 0.01, 1.1, 128),\n        # Case 4: coarse grid edge case\n        (343.0, 0.5, 0.9, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        c, dx, r_val, Nx = case\n        result = calculate_metrics(c, dx, r_val, Nx)\n        results.append(result)\n\n    # Format the final output string as specified in the problem.\n    # Example: [[E1,S1],[E2,S2]]\n    # str(list) creates the '[E, S]' part, and join forms the comma-separated list of lists.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    \n    # The problem asks for no spaces between list elements\n    output_str_no_spaces = output_str.replace(\" \", \"\")\n\n    print(output_str_no_spaces)\n\nsolve()\n```"
        }
    ]
}