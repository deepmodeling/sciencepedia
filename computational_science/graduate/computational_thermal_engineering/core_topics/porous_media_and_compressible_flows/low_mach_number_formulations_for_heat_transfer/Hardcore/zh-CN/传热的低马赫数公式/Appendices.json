{
    "hands_on_practices": [
        {
            "introduction": "在低马赫数模型中，核心思想是流体受热膨胀会产生速度散度，这与不可压缩流动的无散度条件（$\\nabla \\cdot \\mathbf{u} = 0$）显著不同。这个练习将引导你从基本原理出发，推导由体积加热引起的速度散度源项。通过这个推导，你将深刻理解在低马赫数近似下，热力学（热量增加）如何直接转化为流体运动学（速度场膨胀），这是构建所有低马赫数热流仿真的物理基石。",
            "id": "3968942",
            "problem": "考虑一个单组分理想气体，在一个大的周期性区域内进行低马赫数流动，其热力学压力在空间上是均匀且恒定的，即 $p = p_0$。流体被一个大小为 $Q$（单位体积单位时间的能量）的体积热源均匀加热。假设定压比热容 $c_p$ 和理想气体常数 $R$ 为常数，粘性耗散可忽略不计，无物质扩散或化学反应，且温度场在空间上是均匀的，因此热传导没有贡献（$\\nabla T = \\mathbf{0}$）。\n\n从连续性方程、理想气体状态方程以及比焓为 $h = c_p T$ 的基于焓的能量方程出发，推导低马赫数散度约束，并计算散度源 $S$，使得 $\\nabla \\cdot \\mathbf{u} = S$ 仅用 $Q$、$c_p$、$p_0$ 和 $R$ 表示。\n\n请将 $S$ 的最终表达式以单一闭式解析表达式的形式给出。$S$ 的大小以 $\\mathrm{s}^{-1}$ 为单位表示。",
            "solution": "用户希望我为受到均匀体积加热的单组分理想气体推导低马赫数散度约束。散度源 $S = \\nabla \\cdot \\mathbf{u}$ 的最终表达式必须用体积热源 $Q$、定压比热容 $c_p$、恒定压力 $p_0$ 和比理想气体常数 $R$ 来表示。\n\n推导过程是在指定的假设条件下，结合三个基本方程：连续性方程、理想气体状态方程和能量方程。\n\n起点是表示质量守恒的连续性方程：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{u}$ 是速度矢量。使用散度的乘积法则，我们可以展开第二项：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\rho (\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot \\nabla \\rho = 0\n$$\n问题陈述温度场在空间上是均匀的，即 $\\nabla T = \\mathbf{0}$。我们可以利用这个信息以及理想气体状态方程 $p = \\rho R T$ 来确定密度的空间变化。鉴于压力是恒定且均匀的 ($p=p_0$)，并且气体常数 $R$ 是恒定的，我们可以将密度写为 $\\rho = \\frac{p_0}{RT}$。求密度的梯度可得：\n$$\n\\nabla \\rho = \\nabla \\left( \\frac{p_0}{R T} \\right) = -\\frac{p_0}{R T^2} \\nabla T\n$$\n因为 $\\nabla T = \\mathbf{0}$，所以密度梯度也为零，即 $\\nabla \\rho = \\mathbf{0}$。这意味着密度 $\\rho$ 在空间上是均匀的，只能是时间的函数，即 $\\rho = \\rho(t)$。\n\n由于 $\\nabla \\rho = \\mathbf{0}$，展开的连续性方程中的 $\\mathbf{u} \\cdot \\nabla \\rho$ 项消失。此外，由于 $\\rho$ 仅是时间的函数，时间偏导数变为常导数，$\\frac{\\partial \\rho}{\\partial t} = \\frac{d\\rho}{dt}$。连续性方程简化为：\n$$\n\\frac{d\\rho}{dt} + \\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n重新整理这个方程，得到我们所求的速度散度表达式：\n$$\n\\nabla \\cdot \\mathbf{u} = -\\frac{1}{\\rho}\\frac{d\\rho}{dt}\n$$\n为了继续推导，我们需要将密度的时间导数 $\\frac{d\\rho}{dt}$ 与给定的热力学量联系起来。我们可以通过对理想气体状态方程关于时间求导来实现。从 $p_0 = \\rho R T$ 出发，取自然对数：\n$$\n\\ln(p_0) = \\ln(\\rho) + \\ln(R) + \\ln(T)\n$$\n对时间 $t$ 求导，并注意到 $p_0$ 和 $R$ 是常数，我们得到：\n$$\n0 = \\frac{1}{\\rho}\\frac{d\\rho}{dt} + \\frac{1}{T}\\frac{dT}{dt}\n$$\n这提供了密度和温度相对变化率之间的直接关系：\n$$\n-\\frac{1}{\\rho}\\frac{d\\rho}{dt} = \\frac{1}{T}\\frac{dT}{dt}\n$$\n将此结果代入我们的速度散度表达式中，得到：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T}\\frac{dT}{dt}\n$$\n现在，我们必须使用能量方程来找到温度变化率 $\\frac{dT}{dt}$ 的表达式。问题指定使用基于焓的能量方程。该方程的一般形式是：\n$$\n\\rho \\frac{Dh}{Dt} = \\frac{Dp}{Dt} + \\nabla \\cdot (k \\nabla T) + \\Phi + Q\n$$\n其中 $h$ 是比焓，$k$ 是热导率，$\\Phi$ 是粘性耗散函数，$Q$ 是体积热源。物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。\n\n我们应用问题中给出的条件：\n1.  比焓为 $h = c_p T$，其中 $c_p$ 是常数。\n2.  压力是恒定的，$p = p_0$，所以 $\\frac{Dp}{Dt} = 0$。\n3.  温度在空间上是均匀的，$\\nabla T = \\mathbf{0}$，这意味着热传导项为零：$\\nabla \\cdot (k \\nabla T) = 0$。\n4.  粘性耗散可忽略不计，$\\Phi = 0$。\n\n根据这些简化，能量方程简化为：\n$$\n\\rho \\frac{D(c_p T)}{Dt} = Q\n$$\n由于 $c_p$ 是常数，这变为 $\\rho c_p \\frac{DT}{Dt} = Q$。温度的物质导数是 $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} + \\mathbf{u} \\cdot \\nabla T$。鉴于 $\\nabla T = \\mathbf{0}$，这简化为 $\\frac{DT}{Dt} = \\frac{\\partial T}{\\partial t} = \\frac{dT}{dt}$（因为 $T$ 仅是时间的函数）。\n因此，简化的能量方程为：\n$$\n\\rho c_p \\frac{dT}{dt} = Q\n$$\n求解温度变化率：\n$$\n\\frac{dT}{dt} = \\frac{Q}{\\rho c_p}\n$$\n最后，我们将 $\\frac{dT}{dt}$ 的这个表达式代回到我们的速度散度方程中：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{1}{T} \\left( \\frac{Q}{\\rho c_p} \\right) = \\frac{Q}{\\rho c_p T}\n$$\n问题要求最终表达式仅用 $Q$、$c_p$、$p_0$ 和 $R$ 表示。我们可以使用理想气体状态方程 $p_0 = \\rho R T$ 来消去乘积 $\\rho T$。重新整理该方程得到 $\\rho T = \\frac{p_0}{R}$。将此代入我们散度表达式的分母中：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{Q}{c_p (\\rho T)} = \\frac{Q}{c_p \\left(\\frac{p_0}{R}\\right)}\n$$\n简化此表达式可得出散度源 $S$ 的最终结果：\n$$\nS = \\nabla \\cdot \\mathbf{u} = \\frac{Q R}{c_p p_0}\n$$\n此表达式的单位是 $[Q] [R] / ([c_p] [p_0]) = ([ML^{-1}T^{-3}] [L^2 T^{-2} \\Theta^{-1}]) / ([L^2 T^{-2} \\Theta^{-1}] [ML^{-1}T^{-2}]) = [T^{-1}]$，这与速度散度的单位 $\\mathrm{s}^{-1}$ 一致。",
            "answer": "$$\n\\boxed{\\frac{Q R}{c_p p_0}}\n$$"
        },
        {
            "introduction": "上一个练习揭示了热量如何产生速度散度，但数值求解器如何确保流场精确满足这一散度约束呢？本练习将带你深入了解投影法的核心机制，这是确保低马赫数方程数值解满足质量守恒的关键步骤。你将计算一个壓力修正场，用它来校正一个不满足约束的“临时”速度场，从而直观地理解压力泊松方程在算法中的“强制”作用。",
            "id": "3968978",
            "problem": "考虑一个占据 $0 \\leq x \\leq L$ 和 $0 \\leq y \\leq H$ 范围的二维平面通道，其在 $x$ 方向上具有周期性边界条件，在 $y=0$ 和 $y=H$ 处为刚性不可渗透壁面。流体为低马赫数 (LMN) 理想气体流，在投影时间步长内具有均匀的热力学背景压力 $p_0$，以及单位体积内空间均匀的体积加热率 $\\dot{q}$。设流体的参考密度为 $\\rho_0$，定压比热为 $c_p$，参考温度为 $T_0$，在时间步长内均视为空间均匀。临时速度场 $\\boldsymbol{u}^*$ 在一个时间步长 $\\Delta t$ 内由显式非压力项推进，其散度已知为\n$$\n\\nabla \\cdot \\boldsymbol{u}^*(y) = \\phi_0 + S \\cos\\!\\left(\\frac{\\pi y}{H}\\right),\n$$\n其中 $S$ 是给定的恒定振幅，$\\phi_0$ 是在LMN框架下由施加的均匀加热所要求的散度分布。\n\n从理想气体的质量守恒和热能方程出发，推导在时间步长内由均匀加热 $\\dot{q}$ 引起的均匀散度 $\\phi_0$。假设 $p_0$ 为常数，并且在 $\\Delta t$ 内 $T$ 和 $\\rho$ 的空间变化在主导阶上可以忽略不计。然后，利用时间步长内的压力梯度进行速度修正，确定必须施加的标量压力修正量 $p'(y)$，以使修正后的速度在 $0 \\leq y \\leq H$ 范围内的任何地方都满足散度约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1}(y) = \\phi_0$。假设进入修正的密度为常数 $\\rho_0$，并在壁面处对压力修正量施加齐次诺伊曼边界条件，即在 $y=0$ 和 $y=H$ 处 $\\partial p'/\\partial y = 0$。通过要求 $p'(y)$ 在 $y \\in [0,H]$ 上的空间平均值为零来固定规范。\n\n将最终的压力修正量表示为一个关于 $y$ 的封闭形式函数，单位为帕斯卡，并用符号 $\\rho_0$、$\\Delta t$、$H$、$S$ 和 $\\pi$ 表示。不需要数值，也无需四舍五入。",
            "solution": "我们从物质形式的质量守恒方程开始，\n$$\n\\frac{D \\rho}{D t} + \\rho \\, \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\n这意味着\n$$\n\\nabla \\cdot \\boldsymbol{u} = -\\frac{1}{\\rho} \\frac{D \\rho}{D t}.\n$$\n对于低马赫数条件下的理想气体，在投影时间步长内热力学背景压力 $p_0$ 视为常数，状态方程 $p_0 = \\rho R T$ 给出 $\\rho \\propto 1/T$。取物质导数，\n$$\n\\frac{D \\rho}{D t} = -\\frac{\\rho}{T} \\frac{D T}{D t}.\n$$\n因此，\n$$\n\\nabla \\cdot \\boldsymbol{u} = -\\frac{1}{\\rho} \\left( -\\frac{\\rho}{T} \\frac{D T}{D t} \\right) = \\frac{1}{T} \\frac{D T}{D t}.\n$$\n在所述假设（均匀加热和时间步长内主导阶均匀场）下，热能方程简化为\n$$\n\\rho c_p \\frac{D T}{D t} = \\dot{q},\n$$\n因此\n$$\n\\frac{D T}{D t} = \\frac{\\dot{q}}{\\rho c_p}.\n$$\n在主导阶上，$T \\approx T_0$ 且 $\\rho \\approx \\rho_0$，由加热引起的散度是均匀的，并由下式给出\n$$\n\\phi_0 = \\nabla \\cdot \\boldsymbol{u} \\approx \\frac{1}{T_0} \\frac{\\dot{q}}{\\rho_0 c_p}.\n$$\n\n接下来，我们通过压力梯度在时间步长上施加速度修正，采用密度为常数 $\\rho_0$ 的准不可压缩形式，\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla p'.\n$$\n我们要求修正后的速度满足散度约束 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\phi_0$。对修正关系式取散度，\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla \\cdot \\left( \\nabla p' \\right) = \\nabla \\cdot \\boldsymbol{u}^* - \\frac{\\Delta t}{\\rho_0} \\nabla^2 p'.\n$$\n施加 $\\nabla \\cdot \\boldsymbol{u}^{n+1} = \\phi_0$ 得到压力修正量的泊松方程，\n$$\n\\nabla^2 p' = \\frac{\\rho_0}{\\Delta t} \\left( \\nabla \\cdot \\boldsymbol{u}^* - \\phi_0 \\right).\n$$\n根据假设，为此修正目的，场与 $x$ 无关，并且在此步骤中通道在 $y$ 方向上是一维的。因此，\n$$\n\\frac{d^2 p'}{d y^2} = \\frac{\\rho_0}{\\Delta t} \\left[ \\phi_0 + S \\cos\\!\\left( \\frac{\\pi y}{H} \\right) - \\phi_0 \\right] = \\frac{\\rho_0}{\\Delta t} S \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\n为简化符号，定义 $k = \\frac{\\pi}{H}$ 和 $C = \\frac{\\rho_0}{\\Delta t} S$。常微分方程为\n$$\n\\frac{d^2 p'}{d y^2} = C \\cos(k y).\n$$\n积分两次，\n$$\np'(y) = -\\frac{C}{k^2} \\cos(k y) + A y + B,\n$$\n其中 $A$ 和 $B$ 是积分常数。齐次诺伊曼边界条件要求在 $y=0$ 和 $y=H$ 处 $\\frac{d p'}{d y} = 0$。导数为\n$$\n\\frac{d p'}{d y} = \\frac{C}{k} \\sin(k y) + A.\n$$\n在 $y=0$ 处，$\\sin(0) = 0$，所以 $\\frac{d p'}{d y}\\big|_{y=0} = A = 0$。在 $y=H$ 处，$\\sin(k H) = \\sin(\\pi) = 0$，所以 $\\frac{d p'}{d y}\\big|_{y=H} = A = 0$，这个条件已经满足。因此 $A=0$。\n\n通过要求 $p'(y)$ 在 $[0,H]$ 上的空间平均值为零来固定规范，\n$$\n\\frac{1}{H} \\int_{0}^{H} p'(y) \\, dy = 0.\n$$\n因为 $\\int_{0}^{H} \\cos\\!\\left( \\frac{\\pi y}{H} \\right) dy = \\left. \\frac{H}{\\pi} \\sin\\!\\left( \\frac{\\pi y}{H} \\right) \\right|_{0}^{H} = 0$，余弦项的平均值为零，所以零均值条件强制 $B=0$。\n\n将 $k=\\frac{\\pi}{H}$ 和 $C=\\frac{\\rho_0}{\\Delta t} S$ 代回，我们得到\n$$\np'(y) = -\\frac{ \\left( \\frac{\\rho_0}{\\Delta t} S \\right) }{ \\left( \\frac{\\pi}{H} \\right)^2 } \\cos\\!\\left( \\frac{\\pi y}{H} \\right)\n= - \\frac{\\rho_0 S H^2}{\\Delta t \\pi^2} \\cos\\!\\left( \\frac{\\pi y}{H} \\right).\n$$\n这就是所需的压力修正量，单位为帕斯卡，它在给定临时散度场的情况下，强制施加由均匀加热设定的均匀散度 $\\phi_0$。",
            "answer": "$$\\boxed{-\\frac{\\rho_0 S H^2}{\\Delta t \\pi^2}\\cos\\!\\left(\\frac{\\pi y}{H}\\right)}$$"
        },
        {
            "introduction": "理论上完美的算法在实际编程中常会遇到数值“陷阱”，在并置网格上求解流体问题时，压力-速度解耦就是一个典型例子，它会导致非物理的棋盘状压力振荡。本练习将理论分析与编程实践相结合，让你直面这一挑战。你将推导并实现经典的Rhie-Chow插值格式，这是一种旨在抑制这种数值不稳定性的强大技术，从而掌握构建稳健可靠的计算流体动力学求解器的关键技巧之一。",
            "id": "3968961",
            "problem": "考虑一个长度为 $L$ 的一维、均匀、周期性域，使用同位网格有限体积法 (FVM) 将其离散为 $N$ 个控制体。在低马赫数极限下，热力学压力在空间上几乎是均匀的，而机械压力（用 $\\pi$ 表示）提供了主导阶的动量平衡。对于密度为常数 $\\rho$ 和动力粘度为常数 $\\mu$ 的牛顿流体，其控制连续介质方程为稳态质量守恒和动量平衡：\n- 质量守恒：$\\nabla \\cdot (\\rho \\mathbf{u}) = 0$。\n- 动量平衡：$\\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{b}$，其中 $\\mathbf{b}$ 是体积力密度（本问题中设为零）。\n\n在同位 FVM 网格上，单元中心变量 $u_i$ 和 $\\pi_i$ 与单元索引 $i \\in \\{0,1,\\dots,N-1\\}$ 相关联，单元 $i$ 和 $i+1$ 之间的面索引为 $i+\\frac{1}{2}$。一种常用的朴素速度面插值是算术平均，即 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} \\left( u_i + u_{i+1} \\right)$。\n在低马赫数求解器中，通常从不含机械压力梯度项的动量方程中获得预测速度 $u_i^\\star$。在这种情况下，朴素面插值得出 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$，该式不包含来自 $\\pi$ 的直接贡献，可能导致速度和压力解耦，从而容许不影响质量通量散度的伪棋盘格压力场。\n\n您的任务是：\n1. 从在间距为 $\\Delta x = L/N$ 的均匀一维同位网格上离散化的动量方程出发，推导一种将机械压力梯度与面速度耦合的 Rhie–Chow 型面插值。在单元层面使用稳态、线性化的离散动量算子，其系数与粘性项的二阶中心离散一致，从而得到单元系数 $a_P = 2\\mu/\\Delta x$。证明一个一致的 Rhie–Chow 型面速度可以写成\n$$\nu_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2} \\left( u_i^\\star + u_{i+1}^\\star \\right) - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x},\n$$\n其中 $a_{i+\\frac{1}{2}}$ 取为相邻单元系数的算术平均值，对于均匀粘度，该值简化为 $a_{i+\\frac{1}{2}} = 2\\mu/\\Delta x$。\n2. 定义面质量通量 $m_{i+\\frac{1}{2}} = \\rho \\, u_{i+\\frac{1}{2}}$ 和单元 $i$ 中的离散散度\n$$\n\\left( \\nabla \\cdot \\mathbf{m} \\right)_i = \\frac{m_{i+\\frac{1}{2}} - m_{i-\\frac{1}{2}}}{\\Delta x},\n$$\n采用周期性索引，即 $m_{-\\frac{1}{2}} = m_{N-\\frac{1}{2}}$ 和 $m_{N+\\frac{1}{2}} = m_{\\frac{1}{2}}$。证明对于 $u_i^\\star = 0$ 和棋盘格机械压力场 $\\pi_i = A(-1)^i$，朴素插值产生的离散散度为零，而 Rhie–Chow 插值产生一个与 $A$、$\\rho$、$\\mu$ 和 $\\Delta x$ 成比例的非零离散散度。\n3. 实现一个程序，对于一组给定的测试用例，构建压力场 $\\pi_i$，计算 $u_i^\\star = 0$ 时的朴素和 Rhie–Chow 面速度，计算面质量通量，并报告两种插值方法在所有单元上的离散散度的均方根 (RMS)：\n$$\n\\text{RMS} = \\sqrt{ \\frac{1}{N} \\sum_{i=0}^{N-1} \\left( (\\nabla \\cdot \\mathbf{m})_i \\right)^2 }.\n$$\n\n使用以下参数值测试套件：\n- 测试用例 1 (正常情况): $N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$, 压力类型 = 棋盘格, 即 $\\pi_i = A(-1)^i$。\n- 测试用例 2 (奇数网格尺寸): $N=31$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=1.0$, 压力类型 = 棋盘格。\n- 测试用例 3 (基准恒定压力): $N=32$, $L=1.0$, $\\rho=1.0$, $\\mu=1.0$, $A=0.0$, 压力类型 = 恒定, 即 $\\pi_i = A$。\n- 测试用例 4 (平滑模式，低粘度): $N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=0.1$, $A=1.0$, 压力类型 = 正弦, 即 $\\pi_i = A \\sin(2\\pi x_i)$，其中 $x_i = (i+0.5)\\Delta x$。\n- 测试用例 5 (平滑模式，高粘度): $N=64$, $L=1.0$, $\\rho=1.0$, $\\mu=2.0$, $A=1.0$, 压力类型 = 正弦, 即 $\\pi_i = A \\sin(2\\pi x_i)$。\n\n对于每个测试用例，计算并输出两个浮点数：朴素 RMS 散度和 Rhie–Chow RMS 散度。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为\n$[\\text{naive}_1,\\text{RC}_1,\\text{naive}_2,\\text{RC}_2,\\dots,\\text{naive}_5,\\text{RC}_5]$。\n所有输出均为无量纲浮点数。输出中不需要物理单位。",
            "solution": "用户提供的问题是有效的，因为它科学地基于计算流体动力学的原理，问题设定良好，目标明确，并且没有任何在问题验证标准中列出的无效缺陷。执行所需的推导、分析和实现所必需的数据、方程和边界条件均已提供。\n\n### 第 1 部分：Rhie–Chow 插值的推导\n\n目标是从一维同位网格上的离散化稳态动量方程出发，推导一种能够耦合压力和速度的面速度插值方案。\n\n对于性质恒定且无体积力的不可压缩牛顿流体，其稳态动量方程为：\n$$ \\mathbf{0} = -\\nabla \\pi + \\mu \\nabla^2 \\mathbf{u} $$\n在一维情况下，这简化为：\n$$ 0 = -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} $$\n我们使用有限体积法 (FVM) 在单元中心 $i$ 对该方程进行离散化，方法是在宽度为 $\\Delta x = L/N$ 的控制体 $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 上进行积分。\n$$ \\int_{i-\\frac{1}{2}}^{i+\\frac{1}{2}} \\left( -\\frac{d\\pi}{dx} + \\mu \\frac{d^2u}{dx^2} \\right) dx = 0 $$\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\mu \\left( \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} - \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\right) = 0 $$\n在单元面上使用二阶中心差分近似通量：\n$$ \\left.\\frac{du}{dx}\\right|_{i+\\frac{1}{2}} \\approx \\frac{u_{i+1} - u_i}{\\Delta x} $$\n$$ \\left.\\frac{du}{dx}\\right|_{i-\\frac{1}{2}} \\approx \\frac{u_i - u_{i-1}}{\\Delta x} $$\n将这些代入积分方程得到：\n$$ -\\left( \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} \\right) + \\frac{\\mu}{\\Delta x} \\left( (u_{i+1} - u_i) - (u_i - u_{i-1}) \\right) = 0 $$\n$$ \\frac{\\mu}{\\Delta x} (u_{i+1} - 2u_i + u_{i-1}) = \\pi_{i+\\frac{1}{2}} - \\pi_{i-\\frac{1}{2}} $$\n在同位网格上，面上的压力通常通过插值得到，例如 $\\pi_{i+\\frac{1}{2}} = \\frac{1}{2}(\\pi_i + \\pi_{i+1})$。压力项则变为 $\\frac{1}{2}(\\pi_{i+1} - \\pi_{i-1})$。将方程重排为标准 FVM 形式 $a_i u_i = \\sum_{nb} a_{nb} u_{nb} + S_u$：\n$$ \\frac{2\\mu}{\\Delta x} u_i = \\frac{\\mu}{\\Delta x} u_{i+1} + \\frac{\\mu}{\\Delta x} u_{i-1} + S_{\\pi} $$\n这给出了单元系数 $a_i = 2\\mu/\\Delta x$，与问题陈述 ($a_P = 2\\mu/\\Delta x$) 一致。包含相邻速度的项是 $H(u)_i = \\frac{\\mu}{\\Delta x} (u_{i+1} + u_{i-1})$。单元 $i$ 处的完整离散动量方程可以写为：\n$$ a_i u_i = H(u)_i - (\\nabla_d \\pi)_i $$\n其中 $(\\nabla_d \\pi)_i$ 代表离散压力梯度项。\n\n在基于压力的分离式求解器中，预测速度 $u^\\star$ 是通过动量方程计算的，通常省略压力梯度项（或使用前一次迭代的压力场）。\n$$ a_i u_i^\\star = H(u)_i $$\n将其代回完整的动量方程，得到单元中心速度 $u_i$ 的表达式：\n$$ u_i = u_i^\\star - \\frac{1}{a_i} (\\nabla_d \\pi)_i $$\nRhie–Chow 插值方案避免了对单元中心速度进行简单平均。相反，它对单元 $i$ 和单元 $i+1$ 处的单元中心速度表达式进行平均，然后用面 $i+\\frac{1}{2}$ 处的紧凑格式来近似压力梯度项。\n为了找到面 $i+\\frac{1}{2}$ 处的速度，我们首先将 $u_i$ 的方程插值到该面上：\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a} (\\nabla_d \\pi)\\right)}_{i+\\frac{1}{2}} $$\n其中上划线表示插值。Rhie 和 Chow 的关键思想是拆分插值过程：\n$$ u_{i+\\frac{1}{2}} = \\overline{(u^\\star)}_{i+\\frac{1}{2}} - \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} (\\nabla_d \\pi)_{i+\\frac{1}{2}} $$\n我们对预测速度和系数项使用线性插值（算术平均）：\n$$ \\overline{(u^\\star)}_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) $$\n$$ \\overline{\\left(\\frac{1}{a}\\right)}_{i+\\frac{1}{2}} \\approx \\frac{1}{\\overline{a}_{i+\\frac{1}{2}}} = \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} $$\n以及在面上使用紧凑的二阶差分来表示压力梯度：\n$$ (\\nabla_d \\pi)_{i+\\frac{1}{2}} = \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n组合这些项得到 Rhie–Chow 面速度：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{\\frac{1}{2}(a_i + a_{i+1})} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n令 $a_{i+\\frac{1}{2}} = \\frac{1}{2}(a_i + a_{i+1})$，并且给定粘度 $\\mu$ 为常数、网格间距 $\\Delta x$ 均匀，我们有 $a_i = a_{i+1} = 2\\mu/\\Delta x$。因此，面系数为：\n$$ a_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(\\frac{2\\mu}{\\Delta x} + \\frac{2\\mu}{\\Delta x}\\right) = \\frac{2\\mu}{\\Delta x} $$\n将此代入面速度表达式，得到最终所需的形式：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{1}{2}\\left(u_i^\\star + u_{i+1}^\\star\\right) - \\frac{1}{2\\mu/\\Delta x} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} $$\n该表达式将面速度与局部压力差 $\\pi_{i+1} - \\pi_i$ 直接联系起来，提供了必要的压力-速度耦合，而这在预测速度的朴素插值 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$ 中是不存在的。\n\n### 第 2 部分：棋盘格压力场分析\n\n我们分析预测速度为零 ($u_i^\\star=0$) 且压力场为棋盘格模式 ($\\pi_i = A(-1)^i$) 情况下的离散质量散度。\n\n**朴素插值：**\n朴素面速度定义为 $u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2} (u_i^\\star + u_{i+1}^\\star)$。当所有 $i$ 的 $u_i^\\star=0$ 时：\n$$ u_{i+\\frac{1}{2}}^{\\text{naive}} = \\frac{1}{2}(0 + 0) = 0 $$\n相应的面质量通量为 $m_{i+\\frac{1}{2}}^{\\text{naive}} = \\rho u_{i+\\frac{1}{2}}^{\\text{naive}} = 0$。单元 $i$ 中的离散散度为：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{naive}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{naive}} - m_{i-\\frac{1}{2}}^{\\text{naive}}}{\\Delta x} = \\frac{0 - 0}{\\Delta x} = 0 $$\n这对所有单元 $i$ 都成立。因此，朴素插值方案无法“看到”棋盘格压力场，导致散度场为零。这表明压力和速度发生了去耦。\n\n**Rhie–Chow 插值：**\n当 $u_i^\\star=0$ 时，Rhie–Chow 面速度为：\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{1}{a_{i+\\frac{1}{2}}} \\frac{\\pi_{i+1} - \\pi_i}{\\Delta x} = - \\frac{\\Delta x}{2\\mu} \\frac{A(-1)^{i+1} - A(-1)^i}{\\Delta x} $$\n$$ u_{i+\\frac{1}{2}}^{\\text{RC}} = - \\frac{A}{2\\mu} \\left( (-1)^{i+1} - (-1)^i \\right) = - \\frac{A}{2\\mu} (-1)^i \\left( -1 - 1 \\right) = \\frac{A}{\\mu} (-1)^i $$\n面质量通量为：\n$$ m_{i+\\frac{1}{2}}^{\\text{RC}} = \\rho u_{i+\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^i $$\n现在，我们计算单元 $i$ 中的离散散度：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{m_{i+\\frac{1}{2}}^{\\text{RC}} - m_{i-\\frac{1}{2}}^{\\text{RC}}}{\\Delta x} $$\n前一个面 $i-\\frac{1}{2}$ 处的通量通过将 $i$ 替换为 $i-1$ 得到：\n$$ m_{i-\\frac{1}{2}}^{\\text{RC}} = \\frac{\\rho A}{\\mu} (-1)^{i-1} = -\\frac{\\rho A}{\\mu} (-1)^i $$\n将面通量代入散度表达式：\n$$ \\left( \\nabla \\cdot \\mathbf{m} \\right)_i^{\\text{RC}} = \\frac{1}{\\Delta x} \\left[ \\frac{\\rho A}{\\mu} (-1)^i - \\left(-\\frac{\\rho A}{\\mu} (-1)^i\\right) \\right] = \\frac{2 \\rho A}{\\mu \\Delta x} (-1)^i $$\n对于 $A \\neq 0$，该结果为非零，表明 Rhie–Chow 插值能正确感知棋盘格压力梯度，从而产生非零的质量散度。该散度的大小 $|(\\nabla \\cdot \\mathbf{m})_i^{\\text{RC}}| = \\frac{2 \\rho A}{\\mu \\Delta x}$，与 $A$ 和 $\\rho$ 成正比，与 $\\mu$ 和 $\\Delta x$ 成反比，符合要求。在完整的求解器中，这个非零散度将驱动压力修正步骤，以消除伪棋盘格模式。\n\n### 第 3 部分：实现\n\n所提供的 Python 代码实现了一系列测试用例中朴素插值和 Rhie–Chow 插值的离散质量通量均方根 (RMS) 的计算。正如解析分析所示和问题陈述所要求的，对零预测速度场的朴素插值总是产生零面速度，因此散度也为零。相比之下，Rhie–Chow 插值包含一个压力梯度项，对于非恒定压力场，该项会产生非零的面速度和非零的散度场。程序根据推导出的公式和周期性边界条件计算这些值，其中周期性边界条件通过 `numpy.roll` 处理。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_divergence_rms(N, L, rho, mu, A, pressure_type):\n    \"\"\"\n    Computes the RMS of the discrete mass divergence for naive and Rhie-Chow\n    interpolations for a single test case.\n    \n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        rho (float): Fluid density.\n        mu (float): Dynamic viscosity.\n        A (float): Amplitude of the pressure field.\n        pressure_type (str): Type of pressure field ('checkerboard', 'constant', 'sinusoidal').\n        \n    Returns:\n        tuple[float, float]: RMS divergence for naive and Rhie-Chow methods.\n    \"\"\"\n    delta_x = L / N\n    i = np.arange(N)\n\n    # 1. Construct the pressure field pi_i\n    if pressure_type == 'checkerboard':\n        pi = A * (-1.0)**i\n    elif pressure_type == 'constant':\n        pi = A * np.ones(N)\n    elif pressure_type == 'sinusoidal':\n        x_i = (i + 0.5) * delta_x\n        pi = A * np.sin(2 * np.pi * x_i)\n    else:\n        raise ValueError(\"Unknown pressure_type\")\n\n    # Predictor velocity is zero for all cases\n    # u_star = np.zeros(N)\n\n    # 2. Compute naive interpolation results\n    # u_naive_face = 0.5 * (u_star_i + u_star_i+1) = 0\n    # m_naive_face = 0\n    # div_m_naive = 0\n    rms_naive = 0.0\n\n    # 3. Compute Rhie-Chow interpolation results\n    # Face coefficient a_{i+1/2} = 2*mu/delta_x for uniform grid\n    a_face = 2.0 * mu / delta_x\n    \n    # Pressure difference at faces i+1/2\n    # np.roll handles periodic boundary conditions for pi_{i+1}\n    pi_iplus1 = np.roll(pi, -1)\n    delta_pi_face = pi_iplus1 - pi\n    \n    # Calculate RC face velocity u_{i+1/2} and mass flux m_{i+1/2}\n    # Per the problem, u_star is zero\n    u_face_rc = - (1.0 / a_face) * (delta_pi_face / delta_x)\n    m_face_rc = rho * u_face_rc\n    \n    # Calculate discrete divergence (div . m)_i at cell centers\n    # (m_{i+1/2} - m_{i-1/2}) / delta_x\n    # np.roll handles periodic BC for m_{i-1/2}\n    m_face_rc_iminushalf = np.roll(m_face_rc, 1)\n    div_m_rc = (m_face_rc - m_face_rc_iminushalf) / delta_x\n    \n    # Calculate RMS of the divergence\n    rms_rc = np.sqrt(np.mean(div_m_rc**2))\n    \n    return rms_naive, rms_rc\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, L, rho, mu, A, pressure_type)\n        (32, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (31, 1.0, 1.0, 1.0, 1.0, 'checkerboard'),\n        (32, 1.0, 1.0, 1.0, 0.0, 'constant'),\n        (64, 1.0, 1.0, 0.1, 1.0, 'sinusoidal'),\n        (64, 1.0, 1.0, 2.0, 1.0, 'sinusoidal'),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, L, rho, mu, A, p_type = case\n        rms_naive, rms_rc = compute_divergence_rms(N, L, rho, mu, A, p_type)\n        results.extend([rms_naive, rms_rc])\n\n    # Final print statement in the exact required format.\n    # Using 'g' for general-purpose floating point formatting.\n    print(f\"[{','.join(f'{r:.12g}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}