{
    "hands_on_practices": [
        {
            "introduction": "比尔-朗伯定律为辐射衰减提供了一个基础模型，但将其应用于真实世界的数据需要严谨的统计处理。本练习旨在弥合理论与实践之间的鸿沟，要求您从一组模拟的实验测量数据中提取吸收系数 $\\kappa$ 。通过实施加权线性回归并进行不确定性传播，您将掌握从噪声数据中确定物理特性并量化其不确定性的核心方法，这在实验验证和计算模型建立中都是一项至关重要的技能。",
            "id": "3994664",
            "problem": "考虑一维、稳态、准直的辐射穿过均匀、等温、非散射的纯吸收介质的辐射转移过程。从纯吸收的辐射转移方程出发，表述辐射强度如何沿路径衰减，并将对数吸光度定义为一个可测量的量。以此为基础，为吸收系数构建一个符合统计原理的线性推断方法，并量化到光学厚度的不确定性传播。在一个完整、可运行的程序中实现此过程。\n\n需使用的科学背景和定义：\n- 一维、稳态的纯吸收辐射转移方程是基本基础。\n- 将吸光度定义为测量强度和入射强度的对数函数。\n- 将光学厚度定义为吸收系数和路径长度的乘积。\n\n您的程序必须：\n1. 假设测量强度和入射強度中的测量噪声是独立的高斯噪声，使用一阶不确定性传播将测量强度转换为吸光度值及其不确定性。\n2. 在异方差高斯噪声下，使用最大似然估计（等效于加权最小二乘法）对吸光度与路径长度的线性模型进行拟合。\n3. 从线性拟合中提取吸收系数及其标准不确定度，并使用双标准差准则验证截距在统计上是否与零一致。\n4. 将提取的吸收系数不确定性传播到指定目标路径长度处的光学厚度，如果提供了目标路径长度的不确定性，则在传播中包含该不确定性。\n\n单位和数值报告要求：\n- 路径长度 $L$ 以米 ($m$) 为单位。\n- 吸收系数 $\\kappa$ 必须以逆米 ($m^{-1}$) 为单位报告。\n- 吸光度 $A$ 和光学厚度 $\\tau$ 是无量纲的。\n- 数值的最终输出必须四舍五入到六位小数。\n\n测试套件：\n使用以下三个测试用例。对于每个用例，给定测量路径长度 $L$ (单位 $m$) 的数组、测量的透射强度 $I$ (单位 $W\\,m^{-2}$) 的数组、一个恒定的入射强度 $I_0$ (单位 $W\\,m^{-2}$) 以及标准差 $\\sigma_I$ 和 $\\sigma_{I_0}$ (单位 $W\\,m^{-2}$)。您必须通过一阶传播计算吸光度值 $A_i=-\\ln(I_i/I_0)$ 和吸光度不确定性 $\\sigma_{A_i}$。然后执行加权线性拟合 $A_i = a + \\kappa L_i + \\varepsilon_i$，提取 $\\kappa$ 及其标准不确定度，检验 $a$ 是否在零的两个标准差范围内，并通过不确定性传播计算目标路径长度 $L^\\star$ 处的光学厚度。当提供目标路径长度不确定性 $\\sigma_{L^\\star}$ 时，将其包含在传播中；否则，将 $L^\\star$ 视为精确值。\n\n- 用例1（一般情况，中等吸收）：\n  - $L = [0.005, 0.010, 0.015, 0.020, 0.025]$ $m$\n  - $I = [0.862, 0.742, 0.635, 0.550, 0.470]$ $W\\,m^{-2}$\n  - $I_0 = 1.000$ $W\\,m^{-2}$\n  - 对数组中每个 $I$ 的 $\\sigma_I = 0.005$ $W\\,m^{-2}$\n  - $\\sigma_{I_0} = 0.002$ $W\\,m^{-2}$\n  - $L^\\star = 0.040$ $m$\n  - $\\sigma_{L^\\star} = 0.000$ $m$\n\n- 用例2（近透明，包含路径长度不确定性）：\n  - $L = [0.020, 0.040, 0.060, 0.080, 0.100]$ $m$\n  - $I = [0.962, 0.921, 0.888, 0.850, 0.820]$ $W\\,m^{-2}$\n  - $I_0 = 1.000$ $W\\,m^{-2}$\n  - 对数组中每个 $I$ 的 $\\sigma_I = 0.004$ $W\\,m^{-2}$\n  - $\\sigma_{I_0} = 0.001$ $W\\,m^{-2}$\n  - $L^\\star = 0.050$ $m$\n  - $\\sigma_{L^\\star} = 0.00025$ $m$\n\n- 用例3（强吸收，路径长度较小）：\n  - $L = [0.001, 0.003, 0.005, 0.007, 0.009]$ $m$\n  - $I = [0.890, 0.700, 0.546, 0.435, 0.338]$ $W\\,m^{-2}$\n  - $I_0 = 1.000$ $W\\,m^{-2}$\n  - 对数组中每个 $I$ 的 $\\sigma_I = 0.006$ $W\\,m^{-2}$\n  - $\\sigma_{I_0} = 0.003$ $W\\,m^{-2}$\n  - $L^\\star = 0.010$ $m$\n  - $\\sigma_{L^\\star} = 0.000$ $m$\n\n需实现的计算细节：\n- 吸光度：$A_i = -\\ln\\!\\left(\\dfrac{I_i}{I_0}\\right)$。\n- 通过独立性假设下的一阶传播计算吸光度不确定性：$\\sigma_{A_i} = \\sqrt{\\left(\\dfrac{\\partial A}{\\partial I}\\Big|_{I_i,I_0}\\right)^2 \\sigma_I^2 + \\left(\\dfrac{\\partial A}{\\partial I_0}\\Big|_{I_i,I_0}\\right)^2 \\sigma_{I_0}^2}$，其中 $\\dfrac{\\partial A}{\\partial I} = -\\dfrac{1}{I}$ 和 $\\dfrac{\\partial A}{\\partial I_0} = \\dfrac{1}{I_0}$ 在测量值处求值。\n- 异方差高斯噪声下的加权线性拟合：最小化 $\\sum_i w_i \\left(A_i - a - \\kappa L_i\\right)^2$，其中权重为 $w_i = \\dfrac{1}{\\sigma_{A_i}^2}$；从加权正规矩阵的逆计算参数协方差。\n- 截距验证：返回一个布尔值，指示是否满足 $|a| \\le 2\\,\\sigma_a$。\n- 目标路径长度处的光学厚度及其不确定性：$\\tau^\\star = \\kappa\\,L^\\star$ 和 $\\sigma_{\\tau^\\star} = \\sqrt{(L^\\star)^2 \\sigma_\\kappa^2 + \\kappa^2 \\sigma_{L^\\star}^2}$，假设 $\\kappa$ 和 $L^\\star$ 之间相互独立。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个由方括号括起来的逗号分隔列表的结果。每个测试用例的输出本身必须是一个包含五个条目的列表，顺序为 $\\left[\\kappa,\\;\\sigma_\\kappa,\\;\\tau^\\star,\\;\\sigma_{\\tau^\\star},\\;\\text{pass\\_zero\\_intercept}\\right]$，其中前四个是四舍五入到六位小数的浮点数，最后一个是布尔值。例如，总体格式为 $[[\\dots],[\\dots],[\\dots]]$，不含额外文本。",
            "solution": "该问题是有效的，因为它科学地基于辐射转移原理，使用成熟的线性推断和不确定性传播方法在统计上是适定的，并提供了一套完整、一致且可形式化的要求。\n\n解决方案首先从基本物理学推导出线性模型，然后详细说明用于参数估计和不确定性量化的统计方法。\n\n**1. 物理模型：比尔-朗伯定律**\n\n该问题涉及在一维、均匀、非散射的纯吸收介质中的辐射转移。辐射强度 $I$ 相对于路径长度 $s$ 的变化由纯吸收的辐射转移方程 (RTE) 描述：\n$$\n\\frac{dI}{ds} = -\\kappa I\n$$\n其中 $\\kappa$ 是介质的吸收系数，单位为逆长度（例如 $m^{-1}$）。这是一个一阶线性常微分方程。我们可以通过分离变量并沿长度为 $L$ 的路径积分来求解：\n$$\n\\int_{I_0}^{I(L)} \\frac{dI}{I} = \\int_0^L -\\kappa \\, ds\n$$\n这里，$I_0$ 是 $s=0$ 处的入射强度，$I(L)$ 是穿过路径长度 $L$ 后的透射强度。由于介质是均匀的，$\\kappa$ 沿路径为常数。积分得出：\n$$\n\\ln(I(L)) - \\ln(I_0) = -\\kappa L\n$$\n$$\n\\ln\\left(\\frac{I(L)}{I_0}\\right) = -\\kappa L\n$$\n对两边取指数，得到熟悉的比尔-朗伯衰减定律：\n$$\nI(L) = I_0 e^{-\\kappa L}\n$$\n\n**2. 线性化与吸光度**\n\n为了从不同路径长度 $L_i$ 下 $I(L)$ 的实验测量值中确定 $\\kappa$，使用线性模型很方便。问题将吸光度 $A$ 定义为：\n$$\nA = -\\ln\\left(\\frac{I}{I_0}\\right)\n$$\n将比尔-朗伯定律代入此定义，揭示了吸光度与路径长度之间的直接线性关系：\n$$\nA = -\\ln\\left(\\frac{I_0 e^{-\\kappa L}}{I_0}\\right) = -\\ln(e^{-\\kappa L}) = \\kappa L\n$$\n这个理论模型 $A = \\kappa L$ 表明，吸光度与路径长度成正比，吸收系数 $\\kappa$ 是比例常数。在实际实验中，我们将数据拟合到一个稍微更通用的线性模型 $A = a + \\kappa L$ 中，其中截距 $a$ 用于解释潜在的系统误差或偏移。物理上理想的实验将产生截距 $a=0$。\n\n**3. 吸光度的不确定性传播**\n\n测量从来都不是完美的。测量的强度 $I_i$ 和入射强度 $I_0$ 分别具有相关的不确定性 $\\sigma_I$ 和 $\\sigma_{I_0}$。这些不确定性必须传播到计算出的吸光度值 $A_i$ 中。使用一阶泰勒级数展开进行不确定性传播，函数 $f(x_1, x_2, \\dots)$ 的方差近似为：\n$$\n\\sigma_f^2 \\approx \\sum_j \\left(\\frac{\\partial f}{\\partial x_j}\\right)^2 \\sigma_{x_j}^2\n$$\n假设 $x_j$ 中的不确定性是独立的。对于吸光度 $A(I, I_0) = \\ln(I_0) - \\ln(I)$，其偏导数为：\n$$\n\\frac{\\partial A}{\\partial I} = -\\frac{1}{I} \\quad \\text{and} \\quad \\frac{\\partial A}{\\partial I_0} = \\frac{1}{I_0}\n$$\n假设 $I$ 和 $I_0$ 中的测量误差是独立的，吸光度的方差 $\\sigma_A^2$ 为：\n$$\n\\sigma_A^2 = \\left(\\frac{\\partial A}{\\partial I}\\right)^2 \\sigma_I^2 + \\left(\\frac{\\partial A}{\\partial I_0}\\right)^2 \\sigma_{I_0}^2 = \\left(-\\frac{1}{I}\\right)^2 \\sigma_I^2 + \\left(\\frac{1}{I_0}\\right)^2 \\sigma_{I_0}^2 = \\left(\\frac{\\sigma_I}{I}\\right)^2 + \\left(\\frac{\\sigma_{I_0}}{I_0}\\right)^2\n$$\n由于每个测量对 $(L_i, I_i)$ 都有唯一的值，因此得到的吸光度不确定性 $\\sigma_{A_i}$ 对每个点都不同。这被称为异方差性。\n\n**4. 加权最小二乘 (WLS) 估计**\n\n为了解释这种异方差性，我们使用加权最小二乘法 (WLS) 来拟合线性模型 $A_i = a + \\kappa L_i$。WLS 等效于假设误差是独立且呈正态分布的最大似然估计，即 $\\varepsilon_i = A_i - (a + \\kappa L_i) \\sim \\mathcal{N}(0, \\sigma_{A_i}^2)$。该方法最小化加权残差平方和，其中每个残差的权重是其方差的倒数：\n$$\n\\chi^2(a, \\kappa) = \\sum_{i=1}^{N} w_i (A_i - a - \\kappa L_i)^2 \\quad \\text{where} \\quad w_i = \\frac{1}{\\sigma_{A_i}^2}\n$$\n这个最小化问题可以使用矩阵代数高效求解。我们定义吸光度测量向量 $\\mathbf{y}$、参数向量 $\\mathbf{p}$ 和设计矩阵 $\\mathbf{X}$：\n$$\n\\mathbf{y} = \\begin{pmatrix} A_1 \\\\ A_2 \\\\ \\vdots \\\\ A_N \\end{pmatrix}, \\quad \\mathbf{p} = \\begin{pmatrix} a \\\\ \\kappa \\end{pmatrix}, \\quad \\mathbf{X} = \\begin{pmatrix} 1 & L_1 \\\\ 1 & L_2 \\\\ \\vdots & \\vdots \\\\ 1 & L_N \\end{pmatrix}\n$$\n参数的 WLS 估计值 $\\hat{\\mathbf{p}}$ 由下式给出：\n$$\n\\hat{\\mathbf{p}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{W} \\mathbf{y}\n$$\n其中 $\\mathbf{W}$ 是由权重 $w_i$ 构成的对角矩阵。估计参数的协方差矩阵是：\n$$\n\\mathbf{C}_{\\mathbf{p}} = (\\mathbf{X}^T \\mathbf{W} \\mathbf{X})^{-1} = \\begin{pmatrix} \\sigma_a^2 & \\text{cov}(a, \\kappa) \\\\ \\text{cov}(a, \\kappa) & \\sigma_\\kappa^2 \\end{pmatrix}\n$$\n$\\mathbf{C}_{\\mathbf{p}}$ 的对角元素是估计的截距 $a$ 和斜率 $\\kappa$ 的方差。标准不确定性是它们各自的平方根，即 $\\sigma_a = \\sqrt{(\\mathbf{C}_{\\mathbf{p}})_{00}}$ 和 $\\sigma_\\kappa = \\sqrt{(\\mathbf{C}_{\\mathbf{p}})_{11}}$。如果截距的估计值在零的两个标准差范围内，即 $|a| \\le 2\\sigma_a$，则认为其在统计上与零一致。\n\n**5. 光学厚度与不确定性传播**\n\n最后一步是计算在特定目标路径长度 $L^\\star$ 处的光学厚度 $\\tau^\\star$ 及其相关的不确定性。光学厚度定义为：\n$$\n\\tau^\\star = \\kappa L^\\star\n$$\n由于该值是由估计参数 $\\kappa$ 和目标路径长度 $L^\\star$ (其本身也可能具有不确定性 $\\sigma_{L^\\star}$) 推导出来的，我们再次使用一阶不确定性传播。$\\tau^\\star$ 的方差为：\n$$\n\\sigma_{\\tau^\\star}^2 = \\left(\\frac{\\partial \\tau^\\star}{\\partial \\kappa}\\right)^2 \\sigma_\\kappa^2 + \\left(\\frac{\\partial \\tau^\\star}{\\partial L^\\star}\\right)^2 \\sigma_{L^\\star}^2 = (L^\\star)^2 \\sigma_\\kappa^2 + \\kappa^2 \\sigma_{L^\\star}^2\n$$\n该公式假设估计的 $\\kappa$ 的不确定性与 $L^\\star$ 的不确定性是独立的，这是一个合理的假设，因为它们通常源于不同的测量过程（分别是拟合过程和路径长度测量）。标准不确定性为 $\\sigma_{\\tau^\\star} = \\sqrt{\\sigma_{\\tau^\\star}^2}$。如果 $L^\\star$ 是精确已知的，那么 $\\sigma_{L^\\star} = 0$，第二项消失。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the absorption coefficient, its uncertainty, optical thickness,\n    and its uncertainty for three test cases based on radiative transfer principles.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"L\": np.array([0.005, 0.010, 0.015, 0.020, 0.025]),\n            \"I\": np.array([0.862, 0.742, 0.635, 0.550, 0.470]),\n            \"I0\": 1.000,\n            \"sigma_I\": 0.005,\n            \"sigma_I0\": 0.002,\n            \"L_star\": 0.040,\n            \"sigma_L_star\": 0.000,\n        },\n        {\n            \"L\": np.array([0.020, 0.040, 0.060, 0.080, 0.100]),\n            \"I\": np.array([0.962, 0.921, 0.888, 0.850, 0.820]),\n            \"I0\": 1.000,\n            \"sigma_I\": 0.004,\n            \"sigma_I0\": 0.001,\n            \"L_star\": 0.050,\n            \"sigma_L_star\": 0.00025,\n        },\n        {\n            \"L\": np.array([0.001, 0.003, 0.005, 0.007, 0.009]),\n            \"I\": np.array([0.890, 0.700, 0.546, 0.435, 0.338]),\n            \"I0\": 1.000,\n            \"sigma_I\": 0.006,\n            \"sigma_I0\": 0.003,\n            \"L_star\": 0.010,\n            \"sigma_L_star\": 0.000,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        L = case[\"L\"]\n        I = case[\"I\"]\n        I0 = case[\"I0\"]\n        sigma_I = case[\"sigma_I\"]\n        sigma_I0 = case[\"sigma_I0\"]\n        L_star = case[\"L_star\"]\n        sigma_L_star = case[\"sigma_L_star\"]\n\n        # 1. Transform measured intensities into absorbance and their uncertainties.\n        # A = -ln(I/I0) = ln(I0) - ln(I)\n        A = np.log(I0) - np.log(I)\n        \n        # Uncertainty propagation: sigma_A^2 = (sigma_I/I)^2 + (sigma_I0/I0)^2\n        # sigma_I can be a scalar or array; numpy handles broadcasting.\n        sigma_A_sq = (sigma_I / I)**2 + (sigma_I0 / I0)**2\n        \n        # 2. Fit a linear model using Weighted Least Squares (WLS).\n        # Model: A = a + k*L\n        # Matrix formulation: y = X * p, where p = [a, k]^T\n        \n        # Construct the design matrix X\n        X = np.vstack([np.ones(len(L)), L]).T\n        \n        # Construct the diagonal weight matrix W from uncertainties\n        # Weights w_i = 1 / sigma_A_i^2\n        W = np.diag(1.0 / sigma_A_sq)\n        \n        # Calculate the WLS solution for parameters p = [a, k]^T\n        # p_hat = (X^T * W * X)^-1 * X^T * W * y\n        XTW = X.T @ W\n        XTWX = XTW @ X\n        XTWy = XTW @ A\n        \n        # Covariance matrix of parameters is inv(X^T * W * X)\n        cov_matrix = np.linalg.inv(XTWX)\n        \n        # Estimated parameters\n        params = cov_matrix @ XTWy\n        a, kappa = params[0], params[1]\n        \n        # 3. Extract absorption coefficient and its uncertainty, and verify intercept.\n        sigma_a = np.sqrt(cov_matrix[0, 0])\n        sigma_kappa = np.sqrt(cov_matrix[1, 1])\n        \n        # Intercept verification: |a| = 2 * sigma_a\n        pass_zero_intercept = np.abs(a) = 2 * sigma_a\n        \n        # 4. Propagate uncertainty to optical thickness tau_star at L_star.\n        # tau_star = kappa * L_star\n        tau_star = kappa * L_star\n        \n        # Uncertainty propagation: sigma_tau^2 = (L*)^2 * sigma_k^2 + k^2 * sigma_L*^2\n        sigma_tau_star_sq = (L_star**2 * sigma_kappa**2) + (kappa**2 * sigma_L_star**2)\n        sigma_tau_star = np.sqrt(sigma_tau_star_sq)\n        \n        # Round numerical results to six decimal places.\n        case_result = [\n            round(kappa, 6),\n            round(sigma_kappa, 6),\n            round(tau_star, 6),\n            round(sigma_tau_star, 6),\n            pass_zero_intercept\n        ]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list includes spaces, which is consistent\n    # with the problem's example formatting of the output list.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然灰体介质假设简化了辐射传递分析，但大多数真实气体的吸收系数随波长发生剧烈变化。本练习将探讨这种光谱变化的后果，要求您对比真实的窄带透射率与简化的灰气体模型的结果 。通过数值求解光谱细节，您将直接观察到为何指数的平均值不等于平均值的指数，这是理解辐射衰减非线性特性的一个根本性见解。",
            "id": "3994642",
            "problem": "一束中心位于中红外波段的准直热辐射光谱束穿过一个均匀、等温、不发射、不散射的气体层。光谱衰减由辐射传输方程 (RTE) 描述，在一维路径坐标 $s$ 上，对于单色强度 $I_{\\nu}$，该方程为 $\\,\\dfrac{\\partial I_{\\nu}}{\\partial s} = - \\kappa_{\\nu} I_{\\nu}\\,$，其中 $\\kappa_{\\nu}$ 是波数为 $\\nu$ 处的光谱吸收系数，单位为逆长度。光学厚度定义为 $\\,\\tau_{\\nu}(L) = \\int_{0}^{L} \\kappa_{\\nu}(s') \\,\\mathrm{d}s'\\,$, 其中 $L$ 是该层的物理厚度。\n\n该气体具有随光谱变化的吸收系数，由一个平滑的连续背景和离散的光谱线组成。连续背景在整个波段上是均匀的，其系数为 $\\kappa_{\\mathrm{c}}$，单位为 $\\mathrm{m}^{-1}$。光谱线由归一化的洛伦兹线型表示。对于中心在 $\\,\\nu_{0}\\,$、半高半宽为 $\\,\\gamma\\,$ 的谱线，洛伦兹线型为\n$$\n\\phi_{\\mathrm{L}}(\\nu; \\nu_{0}, \\gamma) = \\frac{1}{\\pi}\\,\\frac{\\gamma}{(\\nu - \\nu_{0})^{2} + \\gamma^{2}},\n$$\n其满足 $\\,\\int_{-\\infty}^{\\infty} \\phi_{\\mathrm{L}}(\\nu; \\nu_{0}, \\gamma)\\,\\mathrm{d}\\nu = 1\\,$。波段上的光谱吸收系数模型为\n$$\n\\kappa_{\\nu} = \\kappa_{\\mathrm{c}} + \\sum_{i=1}^{N_{\\ell}} S_{i}\\,\\phi_{\\mathrm{L}}(\\nu; \\nu_{0,i}, \\gamma_{i}),\n$$\n其中 $S_{i}$ 是积分线强度，单位为 $\\mathrm{m}^{-2}$，确保当 $\\nu$ 以 $\\mathrm{m}^{-1}$ 表示时，$\\,\\kappa_{\\nu}\\,$ 的单位为 $\\mathrm{m}^{-1}$。\n\n定义一个波数的窄带 $[\\nu_{1}, \\nu_{2}]$，其宽度为 $\\,\\Delta \\nu = \\nu_{2} - \\nu_{1}\\,$。假设入射光谱强度在整个波段上是均匀的。波段平均透射率定义为波段平均透射强度与波段平均入射强度之比，并且必须通过在整个波段上对 RTE 进行光谱求解并进行适当平均来计算。\n\n您的程序必须从 RTE 和上述定义出发，实现以下内容：\n\n1. 推导并计算在 $[\\nu_{1}, \\nu_{2}]$ 上的窄带透射率 $\\,T_{\\mathrm{NB}}\\,$，方法是对厚度为 $\\,L\\,$ 的均匀层的 RTE 光谱解进行数值积分。\n\n2. 计算波段平均吸收系数 $\\,\\overline{\\kappa} = \\dfrac{1}{\\Delta \\nu}\\int_{\\nu_{1}}^{\\nu_{2}} \\kappa_{\\nu}\\,\\mathrm{d}\\nu\\,$ 并构建灰体 Beer–Lambert 透射率 $\\,T_{\\mathrm{gray,avg}} = \\exp(-\\overline{\\kappa}\\,L)\\,$。\n\n3. 计算与透射率匹配的有效灰体系数 $\\,\\kappa_{\\mathrm{eff,map}} = -\\dfrac{1}{L}\\ln T_{\\mathrm{NB}}\\,$（对于 $\\,L > 0\\,$），并在 $\\,L = 0\\,$ 时使用小 $L$ 极限 $\\,\\kappa_{\\mathrm{eff,map}} = \\overline{\\kappa}\\,$。报告 $\\,\\overline{\\kappa}\\,$ 和 $\\,\\kappa_{\\mathrm{eff,map}}\\,$，单位均为 $\\mathrm{m}^{-1}$。\n\n数值计算必须使用波数（单位 $\\mathrm{m}^{-1}$）、层厚度（单位 $\\mathrm{m}$）、连续吸收系数（单位 $\\mathrm{m}^{-1}$）、积分线强度（单位 $\\mathrm{m}^{-2}$）和洛伦兹宽度（单位 $\\mathrm{m}^{-1}$）。所有透射率都是无量纲的。在 $[\\nu_{1}, \\nu_{2}]$ 上使用 $\\,N\\,$ 个等间距点的网格，并使用梯形法则近似波段积分。角度未出现；不需要角度单位。如果出现任何类似百分比的量，请以小数形式表示。\n\n测试套件规范：\n对于下面的每个测试用例，计算并返回一个包含四个浮点数 $[T_{\\mathrm{NB}}, T_{\\mathrm{gray,avg}}, \\overline{\\kappa}, \\kappa_{\\mathrm{eff,map}}]$ 的列表，按所述顺序排列。参数集为：\n\n- 案例 1（一般情况，包含连续背景和多条谱线）：\n  - $\\,\\nu_{1} = 95000\\,\\mathrm{m}^{-1}\\,$, $\\,\\nu_{2} = 105000\\,\\mathrm{m}^{-1}\\,$, $\\,N = 20001\\,$.\n  - $\\,L = 1.0\\,\\mathrm{m}\\,$, $\\,\\kappa_{\\mathrm{c}} = 0.05\\,\\mathrm{m}^{-1}\\,$.\n  - 谱线：$\\,(\\nu_{0}, S, \\gamma)\\,$ 分别等于 $\\, (98000\\,\\mathrm{m}^{-1}, 0.030\\,\\mathrm{m}^{-2}, 60\\,\\mathrm{m}^{-1})\\,$, $\\, (100000\\,\\mathrm{m}^{-1}, 0.050\\,\\mathrm{m}^{-2}, 60\\,\\mathrm{m}^{-1})\\,$, $\\, (102000\\,\\mathrm{m}^{-1}, 0.040\\,\\mathrm{m}^{-2}, 60\\,\\mathrm{m}^{-1})\\,$.\n\n- 案例 2（光学薄极限）：\n  - $\\,\\nu_{1} = 99500\\,\\mathrm{m}^{-1}\\,$, $\\,\\nu_{2} = 100500\\,\\mathrm{m}^{-1}\\,$, $\\,N = 20001\\,$.\n  - $\\,L = 0.01\\,\\mathrm{m}\\,$, $\\,\\kappa_{\\mathrm{c}} = 0.0\\,\\mathrm{m}^{-1}\\,$.\n  - 谱线：$\\, (100000\\,\\mathrm{m}^{-1}, 5.0\\times 10^{-4}\\,\\mathrm{m}^{-2}, 20\\,\\mathrm{m}^{-1})\\,$ 和 $\\, (100200\\,\\mathrm{m}^{-1}, 2.0\\times 10^{-4}\\,\\mathrm{m}^{-2}, 15\\,\\mathrm{m}^{-1})\\,$.\n\n- 案例 3（强光谱变化，无连续背景）：\n  - $\\,\\nu_{1} = 99900\\,\\mathrm{m}^{-1}\\,$, $\\,\\nu_{2} = 100100\\,\\mathrm{m}^{-1}\\,$, $\\,N = 20001\\,$.\n  - $\\,L = 3.0\\,\\mathrm{m}\\,$, $\\,\\kappa_{\\mathrm{c}} = 0.0\\,\\mathrm{m}^{-1}\\,$.\n  - 谱线：$\\, (100000\\,\\mathrm{m}^{-1}, 3.0\\,\\mathrm{m}^{-2}, 5.0\\,\\mathrm{m}^{-1})\\,$ 和 $\\, (100050\\,\\mathrm{m}^{-1}, 2.5\\,\\mathrm{m}^{-2}, 3.0\\,\\mathrm{m}^{-1})\\,$.\n\n- 案例 4（极窄谱线，高分辨率）：\n  - $\\,\\nu_{1} = 99950\\,\\mathrm{m}^{-1}\\,$, $\\,\\nu_{2} = 100050\\,\\mathrm{m}^{-1}\\,$, $\\,N = 40001\\,$.\n  - $\\,L = 2.0\\,\\mathrm{m}\\,$, $\\,\\kappa_{\\mathrm{c}} = 0.0\\,\\mathrm{m}^{-1}\\,$.\n  - 谱线：$\\, (100000\\,\\mathrm{m}^{-1}, 0.20\\,\\mathrm{m}^{-2}, 0.50\\,\\mathrm{m}^{-1})\\,$.\n\n- 案例 5（零程长边界条件）：\n  - $\\,\\nu_{1} = 99500\\,\\mathrm{m}^{-1}\\,$, $\\,\\nu_{2} = 100500\\,\\mathrm{m}^{-1}\\,$, $\\,N = 20001\\,$.\n  - $\\,L = 0.0\\,\\mathrm{m}\\,$, $\\,\\kappa_{\\mathrm{c}} = 0.20\\,\\mathrm{m}^{-1}\\,$.\n  - 谱线：$\\, (100000\\,\\mathrm{m}^{-1}, 0.050\\,\\mathrm{m}^{-2}, 30\\,\\mathrm{m}^{-1})\\,$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的 Python 风格的列表的列表。每个内部列表对应于上述顺序的一个测试用例，并包含四个十进制数 $[T_{\\mathrm{NB}}, T_{\\mathrm{gray,avg}}, \\overline{\\kappa}, \\kappa_{\\mathrm{eff,map}}]$。例如，打印的结构必须类似于 $[[a_{1},b_{1},c_{1},d_{1}],[a_{2},b_{2},c_{2},d_{2}],\\ldots]$，不含额外文本。所有透射率都是无量纲的，所有吸收系数必须以 $\\mathrm{m}^{-1}$ 为单位。",
            "solution": "该问题是有效的，因为它基于辐射传输的科学原理，其定义和参数完整且一致，问题是适定的，并且其表述是客观的。因此，我们可以进行推导和求解。\n\n此问题的基础是针对不发射、不散射介质的一维辐射传输方程 (RTE)，如下所示：\n$$\n\\frac{\\partial I_{\\nu}}{\\partial s} = - \\kappa_{\\nu} I_{\\nu}\n$$\n这里，$I_{\\nu}$ 是波数为 $\\nu$ 处的单色光谱强度，$s$ 是路径坐标，$\\kappa_{\\nu}$ 是光谱吸收系数。\n\n对于厚度为 $L$ 的均匀气体层，吸收系数 $\\kappa_{\\nu}$ 相对于路径坐标 $s$ 是恒定的。这允许直接对 RTE 进行积分。我们分离变量，并从 $s=0$ 处的入射边界积分到 $s=L$ 处的出射边界：\n$$\n\\int_{I_{\\nu}(0)}^{I_{\\nu}(L)} \\frac{\\mathrm{d}I_{\\nu}'}{I_{\\nu}'} = \\int_{0}^{L} -\\kappa_{\\nu} \\,\\mathrm{d}s'\n$$\n这得到：\n$$\n\\ln(I_{\\nu}(L)) - \\ln(I_{\\nu}(0)) = -\\kappa_{\\nu} (L - 0)\n$$\n$$\n\\ln\\left(\\frac{I_{\\nu}(L)}{I_{\\nu}(0)}\\right) = -\\kappa_{\\nu}L\n$$\n对两边取指数，我们得到单色辐射的 Beer-Lambert 定律：\n$$\nI_{\\nu}(L) = I_{\\nu}(0) e^{-\\kappa_{\\nu}L}\n$$\n单色透射率 $T_{\\nu}$ 是透射强度与入射强度之比：\n$$\nT_{\\nu} = \\frac{I_{\\nu}(L)}{I_{\\nu}(0)} = e^{-\\kappa_{\\nu}L}\n$$\n问题将光谱吸收系数 $\\kappa_{\\nu}$ 指定为一个恒定连续背景 $\\kappa_{\\mathrm{c}}$ 和一系列 $N_{\\ell}$ 条光谱线之和，每条谱线都具有洛伦兹线型 $\\phi_{\\mathrm{L}}$：\n$$\n\\kappa_{\\nu} = \\kappa_{\\mathrm{c}} + \\sum_{i=1}^{N_{\\ell}} S_{i}\\,\\phi_{\\mathrm{L}}(\\nu; \\nu_{0,i}, \\gamma_{i})\n$$\n其中归一化的洛伦兹线型由下式给出：\n$$\n\\phi_{\\mathrm{L}}(\\nu; \\nu_{0}, \\gamma) = \\frac{1}{\\pi}\\,\\frac{\\gamma}{(\\nu - \\nu_{0})^{2} + \\gamma^{2}}\n$$\n$S_i$ 是积分线强度，$\\nu_{0,i}$ 是线中心波数，$\\gamma_i$ 是半高半宽 (HWHM)。所有单位均如指定的那样保持一致。\n\n问题要求计算波数窄带 $[\\nu_1, \\nu_2]$ 上的四个量：\n\n1.  **窄带透射率, $T_{\\mathrm{NB}}$**\n    入射强度在整个波段上是均匀的。波段平均透射强度为 $\\overline{I}_{\\text{trans}} = \\frac{1}{\\Delta\\nu} \\int_{\\nu_1}^{\\nu_2} I_{\\nu}(L) \\mathrm{d}\\nu$，其中 $\\Delta\\nu = \\nu_2 - \\nu_1$。波段平均入射强度为 $\\overline{I}_{\\text{inc}} = I_{\\nu}(0)$。窄带透射率是这两者之比：\n    $$\n    T_{\\mathrm{NB}} = \\frac{\\overline{I}_{\\text{trans}}}{\\overline{I}_{\\text{inc}}} = \\frac{1}{\\Delta\\nu} \\int_{\\nu_1}^{\\nu_2} \\frac{I_{\\nu}(L)}{I_{\\nu}(0)} \\mathrm{d}\\nu = \\frac{1}{\\Delta\\nu} \\int_{\\nu_1}^{\\nu_2} e^{-\\kappa_{\\nu}L} \\mathrm{d}\\nu\n    $$\n    这是单色透射率的光谱平均值。它必须进行数值计算。我们在区间 $[\\nu_1, \\nu_2]$ 上建立一个包含 $N$ 个波数的等间距网格 $\\{\\nu_j\\}_{j=1}^N$。对于每个点 $\\nu_j$，我们计算 $\\kappa_{\\nu_j}$，然后计算 $T_{\\nu_j} = e^{-\\kappa_{\\nu_j}L}$。然后使用梯形法则近似该积分。\n\n2.  **波段平均吸收系数, $\\overline{\\kappa}$，和灰体透射率, $T_{\\mathrm{gray,avg}}$**\n    波段平均吸收系数定义为：\n    $$\n    \\overline{\\kappa} = \\frac{1}{\\Delta \\nu}\\int_{\\nu_{1}}^{\\nu_{2}} \\kappa_{\\nu}\\,\\mathrm{d}\\nu\n    $$\n    该积分也使用梯形法则在波数网格上的 $\\kappa_{\\nu_j}$ 值进行数值计算。\n    然后使用此平均系数计算灰体 Beer-Lambert 透射率 $T_{\\mathrm{gray,avg}}$：\n    $$\n    T_{\\mathrm{gray,avg}} = e^{-\\overline{\\kappa}L}\n    $$\n    由于指数函数的非线性，通常情况下 $T_{\\mathrm{NB}} \\neq T_{\\mathrm{gray,avg}}$。根据凸函数 $f(x)=e^{-x}$ 的 Jensen 不等式，我们预期 $T_{\\mathrm{NB}} \\geq T_{\\mathrm{gray,avg}}$。\n\n3.  **与透射率匹配的有效系数, $\\kappa_{\\mathrm{eff,map}}$**\n    该量被定义为能产生真实窄带透射率 $T_{\\mathrm{NB}}$ 的等效灰体吸收系数。它通过对 $T_{\\mathrm{NB}}$ 的 Beer-Lambert 定律求逆得到：\n    $$\n    T_{\\mathrm{NB}} = e^{-\\kappa_{\\mathrm{eff,map}}L}\n    $$\n    求解 $\\kappa_{\\mathrm{eff,map}}$ 得：\n    $$\n    \\kappa_{\\mathrm{eff,map}} = -\\frac{1}{L}\\ln(T_{\\mathrm{NB}}) \\quad \\text{对于 } L > 0\n    $$\n    对于 $L=0$ 的特殊情况，问题指定 $\\kappa_{\\mathrm{eff,map}} = \\overline{\\kappa}$。这与 $T_{\\mathrm{NB}}$ 的小 $L$ 泰勒级数展开一致，该展开显示当 $L \\rightarrow 0$ 时 $\\kappa_{\\mathrm{eff,map}} \\rightarrow \\overline{\\kappa}$。如果 $L=0$，则 $\\kappa_{\\nu}L=0$，所以对所有 $\\nu$ 都有 $T_\\nu=1$，且 $T_{\\mathrm{NB}}=1$。对数将是 $\\ln(1)=0$，导致不定形式 $0/0$。因此，所提供的 $L=0$ 的定义是必要且具有物理意义的。\n\n要实现的算法如下：\n对于每个测试用例：\n1.  在 $[\\nu_1, \\nu_2]$ 上用 $N$ 个点定义波数网格 $\\nu$。\n2.  通过将连续背景贡献与所有指定洛伦兹线的贡献相加，计算网格上每个点的光谱吸收系数 $\\kappa_{\\nu}$。\n3.  通过使用梯形法则对网格上的 $\\kappa_{\\nu}$ 进行数值积分，然后除以带宽 $\\Delta\\nu = \\nu_2 - \\nu_1$，来计算波段平均吸收系数 $\\overline{\\kappa}$。\n4.  计算灰体透射率 $T_{\\mathrm{gray,avg}} = e^{-\\overline{\\kappa}L}$。处理 $L=0$ 的情况，此时 $T_{\\mathrm{gray,avg}}=1$。\n5.  计算每个网格点的光谱透射率 $T_{\\nu} = e^{-\\kappa_{\\nu}L}$。对于 $L=0$，$T_{\\nu}=1$。\n6.  通过使用梯形法则对网格上的 $T_{\\nu}$ 进行数值积分，然后除以带宽 $\\Delta\\nu$，来计算窄带透射率 $T_{\\mathrm{NB}}$。\n7.  计算有效吸收系数 $\\kappa_{\\mathrm{eff,map}}$。如果 $L=0$，设置 $\\kappa_{\\mathrm{eff,map}} = \\overline{\\kappa}$。如果 $L0$，计算 $\\kappa_{\\mathrm{eff,map}} = -\\frac{1}{L}\\ln(T_{\\mathrm{NB}})$。\n8.  收集四个结果 $[T_{\\mathrm{NB}}, T_{\\mathrm{gray,avg}}, \\overline{\\kappa}, \\kappa_{\\mathrm{eff,map}}]$。\n此过程将应用于所有指定的测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes radiative properties for a gas layer based on spectral data.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"nu1\": 95000.0, \"nu2\": 105000.0, \"N\": 20001, \"L\": 1.0, \"k_c\": 0.05,\n            \"lines\": [\n                {\"nu0\": 98000.0, \"S\": 0.030, \"gamma\": 60.0},\n                {\"nu0\": 100000.0, \"S\": 0.050, \"gamma\": 60.0},\n                {\"nu0\": 102000.0, \"S\": 0.040, \"gamma\": 60.0},\n            ],\n        },\n        {\n            \"nu1\": 99500.0, \"nu2\": 100500.0, \"N\": 20001, \"L\": 0.01, \"k_c\": 0.0,\n            \"lines\": [\n                {\"nu0\": 100000.0, \"S\": 5.0e-4, \"gamma\": 20.0},\n                {\"nu0\": 100200.0, \"S\": 2.0e-4, \"gamma\": 15.0},\n            ],\n        },\n        {\n            \"nu1\": 99900.0, \"nu2\": 100100.0, \"N\": 20001, \"L\": 3.0, \"k_c\": 0.0,\n            \"lines\": [\n                {\"nu0\": 100000.0, \"S\": 3.0, \"gamma\": 5.0},\n                {\"nu0\": 100050.0, \"S\": 2.5, \"gamma\": 3.0},\n            ],\n        },\n        {\n            \"nu1\": 99950.0, \"nu2\": 100050.0, \"N\": 40001, \"L\": 2.0, \"k_c\": 0.0,\n            \"lines\": [\n                {\"nu0\": 100000.0, \"S\": 0.20, \"gamma\": 0.50},\n            ],\n        },\n        {\n            \"nu1\": 99500.0, \"nu2\": 100500.0, \"N\": 20001, \"L\": 0.0, \"k_c\": 0.20,\n            \"lines\": [\n                {\"nu0\": 100000.0, \"S\": 0.050, \"gamma\": 30.0},\n            ],\n        },\n    ]\n\n    results = []\n\n    def lorentz_profile(nu, nu0, gamma):\n        \"\"\"Calculates the normalized Lorentz profile.\"\"\"\n        return (1.0 / np.pi) * (gamma / ((nu - nu0)**2 + gamma**2))\n\n    for case in test_cases:\n        nu1, nu2, N, L, k_c, lines = case.values()\n        \n        # 1. Create the wavenumber grid\n        nu_grid = np.linspace(nu1, nu2, N)\n        delta_nu = nu2 - nu1\n        \n        # 2. Calculate the spectral absorption coefficient kappa_nu\n        kappa_nu = np.full_like(nu_grid, k_c)\n        for line in lines:\n            kappa_nu += line[\"S\"] * lorentz_profile(nu_grid, line[\"nu0\"], line[\"gamma\"])\n            \n        # 3. Compute band-averaged absorption coefficient kappa_bar\n        # np.trapz integrates using the trapezoidal rule.\n        kappa_bar = np.trapz(kappa_nu, nu_grid) / delta_nu\n        \n        # 4. Compute gray Beer-Lambert transmittance T_gray,avg\n        T_gray_avg = np.exp(-kappa_bar * L)\n        \n        # 5. Compute narrow-band transmittance T_NB\n        # First, compute spectral transmittance T_nu\n        T_nu = np.exp(-kappa_nu * L)\n        T_NB = np.trapz(T_nu, nu_grid) / delta_nu\n        \n        # 6. Compute transmittance-matching effective coefficient kappa_eff,map\n        if L > 0:\n            # Prevent taking log of zero or negative for very small T_NB\n            if T_NB > 0:\n                kappa_eff_map = -np.log(T_NB) / L\n            else:\n                kappa_eff_map = np.inf # Optically thick to the point of zero transmission\n        else:  # L == 0 case\n            kappa_eff_map = kappa_bar\n            \n        # Collect results for the current case\n        case_results = [T_NB, T_gray_avg, kappa_bar, kappa_eff_map]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list is used for the inner lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "求解辐射传递方程通常需要进行数值积分，尤其是在存在发射或散射源项的情况下。本练习专注于针对含发射源项的一维辐射传递方程，开发并评估不同的数值格式 。通过推导和比较一种基础的显式格式与能够精确积分衰减项的更稳健方法，您将对数值精度、稳定性以及现代辐射传输求解器的设计原则获得实践性的理解。",
            "id": "3994676",
            "problem": "考虑一维辐射传输方程 (RTE) 在均匀、各向同性、无散射的吸收-发射介质中沿直线特征线的形式，由 $dI/ds = -\\kappa I + \\kappa B$ 给出，其中 $I(s)$ 是比强度，$\\kappa$ 是吸收系数，$B(s)$ 是发射源函数。将路径长度 $s$ 上的光学厚度定义为 $\\tau(s) = \\kappa s$，并用 $\\exp(-\\tau)$ 表示 Beer–Lambert 衰减。假设 $\\kappa$ 在空间上是恒定的，源函数呈线性变化 $B(s) = B_0 \\left(1 + \\alpha s\\right)$，其中 $B_0$ 是一个常数参考值，$\\alpha$ 是一个单位为 $\\mathrm{m}^{-1}$ 的常数斜率。为方便计算并避免单位依赖，我们使用无量纲强度 $\\bar{I}(s) = I(s)/B_0$ 和无量纲源 $\\bar{B}(s) = B(s)/B_0 = 1 + \\alpha s$。设 $s$ 的单位为米，$\\kappa$ 的单位为 $\\mathrm{m}^{-1}$，所有强度均由 $B_0$ 归一化（无量纲）。\n\n严格从 RTE 及其光学厚度公式出发，推导一个二阶精确的单元到单元更新方案，该方案在每个空间步长上精确满足 Beer–Lambert 衰减，并且在源函数在单元上为常数时是精确的。推导过程必须采用积分因子法和在每个单元内对 $\\bar{B}(s)$ 的线性表示。您还必须通过比较以下几种方法来讨论空间离散化对精度的影响：\n- 应用于 RTE 的一阶显式 Euler 更新，\n- 在单元上源函数分段常数的指数衰减更新，\n- 在单元上源函数分段线性的推导出的二阶指数更新。\n\n在一个包含 $N$ 个单元、总长度为 $L$、步长为 $\\Delta s = L/N$ 的均匀网格上实现这三种方案。边界条件是作为参数提供的流入强度 $\\bar{I}(0) = I_0/B_0$。为进行验证，通过解析求解具有恒定 $\\kappa$ 和线性 $\\bar{B}(s)$ 的 RTE 来获得 $\\bar{I}(L)$ 的精确解，并以小数形式计算每种方案的相对绝对误差：$|\\bar{I}_{\\text{num}}(L) - \\bar{I}_{\\text{exact}}(L)|/\\max(|\\bar{I}_{\\text{exact}}(L)|, \\epsilon)$，其中选择 $\\epsilon$ 以避免除以零。\n\n您的程序必须实现这三种方案，并为以下测试套件生成误差，该套件探索了不同的光学厚度、斜率和离散化：\n1. $(\\kappa = 1.0\\,\\mathrm{m}^{-1},\\, L = 1.0\\,\\mathrm{m},\\, N = 10,\\, \\alpha = 0.5\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.0)$\n2. $(\\kappa = 0.1\\,\\mathrm{m}^{-1},\\, L = 1.0\\,\\mathrm{m},\\, N = 4,\\, \\alpha = 1.0\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.3)$\n3. $(\\kappa = 1.0\\,\\mathrm{m}^{-1},\\, L = 10.0\\,\\mathrm{m},\\, N = 50,\\, \\alpha = 0.2\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.0)$\n4. $(\\kappa = 1.0\\,\\mathrm{m}^{-1},\\, L = 10.0\\,\\mathrm{m},\\, N = 2,\\, \\alpha = 0.2\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.0)$\n5. $(\\kappa = 2.0\\,\\mathrm{m}^{-1},\\, L = 1.0\\,\\mathrm{m},\\, N = 20,\\, \\alpha = 0.0\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.1)$\n6. $(\\kappa = 1.0\\,\\mathrm{m}^{-1},\\, L = 1.0\\,\\mathrm{m},\\, N = 20,\\, \\alpha = 0.5\\,\\mathrm{m}^{-1},\\, I_0/B_0 = 0.0)$\n\n对于每个测试用例，计算并返回一个包含三个浮点数的列表，分别对应于以下方案的相对绝对误差：\n- 显式 Euler 更新，\n- 源函数分段常数的指数衰减，\n- 源函数分段线性的二阶指数衰减。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素本身是按上述顺序排列的三个十进制数的列表（例如，\"[[e11,e12,e13],[e21,e22,e23],...]\"）。不涉及角度。强度是无量纲的（由 $B_0$ 归一化）。如上所述，长度单位必须是米，吸收系数单位必须是 $\\mathrm{m}^{-1}$。",
            "solution": "该问题要求推导、实现和比较用于求解非散射、吸收-发射介质中一维辐射传输方程（RTE）的三种数值方案。问题陈述经确认在科学上是合理的、适定的，并包含完整解答所需的所有信息。\n\n### 1. 预备知识：无量纲辐射传输方程\n\n给定的 RTE 是：\n$$\n\\frac{dI}{ds} = -\\kappa I + \\kappa B\n$$\n其中 $I$ 是比强度，$s$ 是路径长度，$\\kappa$ 是恒定吸收系数，$B$ 是源函数。通过一个常数参考值 $B_0$ 进行归一化，我们定义无量纲强度 $\\bar{I}(s) = I(s)/B_0$ 和无量纲源函数 $\\bar{B}(s) = B(s)/B_0$。RTE 变为：\n$$\n\\frac{d\\bar{I}}{ds} = \\frac{1}{B_0} \\frac{dI}{ds} = -\\kappa \\frac{I}{B_0} + \\kappa \\frac{B}{B_0}\n$$\n$$\n\\frac{d\\bar{I}}{ds} = -\\kappa \\bar{I} + \\kappa \\bar{B}(s)\n$$\n问题指定了一个线性变化的源函数 $B(s) = B_0(1 + \\alpha s)$，这给出了无量纲源函数 $\\bar{B}(s) = 1 + \\alpha s$。因此，需要求解的常微分方程（ODE）是：\n$$\n\\frac{d\\bar{I}}{ds} + \\kappa \\bar{I} = \\kappa(1 + \\alpha s)\n$$\n初始（边界）条件为 $\\bar{I}(0) = I_0/B_0$。\n\n### 2. 解析解\n\n这是一个一阶线性常微分方程。我们使用积分因子 $\\mu(s) = e^{\\int \\kappa ds} = e^{\\kappa s}$ 来求解它。将 ODE 乘以 $\\mu(s)$ 得：\n$$\ne^{\\kappa s} \\frac{d\\bar{I}}{ds} + \\kappa e^{\\kappa s} \\bar{I} = \\kappa(1 + \\alpha s)e^{\\kappa s}\n$$\n左侧是乘积的导数：\n$$\n\\frac{d}{ds} \\left( \\bar{I}(s) e^{\\kappa s} \\right) = \\kappa e^{\\kappa s} + \\kappa \\alpha s e^{\\kappa s}\n$$\n两边从 $s'=0$ 到 $s'=s$ 积分，得到：\n$$\n\\int_0^s \\frac{d}{ds'} \\left( \\bar{I}(s') e^{\\kappa s'} \\right) ds' = \\int_0^s (\\kappa e^{\\kappa s'} + \\kappa \\alpha s' e^{\\kappa s'}) ds'\n$$\n$$\n\\left[ \\bar{I}(s') e^{\\kappa s'} \\right]_0^s = \\left[ e^{\\kappa s'} \\right]_0^s + \\kappa \\alpha \\int_0^s s' e^{\\kappa s'} ds'\n$$\n对剩下的积分使用分部积分法 $\\int u dv = uv - \\int v du$，令 $u=s'$ 且 $dv=e^{\\kappa s'}ds'$，我们得到 $\\int s' e^{\\kappa s'} ds' = \\frac{s'}{\\kappa}e^{\\kappa s'} - \\frac{1}{\\kappa^2}e^{\\kappa s'}$。\n$$\n\\bar{I}(s)e^{\\kappa s} - \\bar{I}(0)e^0 = (e^{\\kappa s} - 1) + \\kappa \\alpha \\left[ \\frac{s'}{\\kappa}e^{\\kappa s'} - \\frac{1}{\\kappa^2}e^{\\kappa s'} \\right]_0^s\n$$\n$$\n\\bar{I}(s)e^{\\kappa s} - \\bar{I}(0) = (e^{\\kappa s} - 1) + \\alpha \\left( s e^{\\kappa s} - \\frac{1}{\\kappa}e^{\\kappa s} \\right) - \\alpha \\left( 0 - \\frac{1}{\\kappa} \\right)\n$$\n$$\n\\bar{I}(s)e^{\\kappa s} = \\bar{I}(0) + e^{\\kappa s} - 1 + \\alpha s e^{\\kappa s} - \\frac{\\alpha}{\\kappa} e^{\\kappa s} + \\frac{\\alpha}{\\kappa}\n$$\n除以 $e^{\\kappa s}$ 来求解 $\\bar{I}(s)$：\n$$\n\\bar{I}(s) = \\bar{I}(0)e^{-\\kappa s} + 1 - e^{-\\kappa s} + \\alpha s - \\frac{\\alpha}{\\kappa} + \\frac{\\alpha}{\\kappa}e^{-\\kappa s}\n$$\n按 $e^{-\\kappa s}$ 合并各项：\n$$\n\\bar{I}(s) = \\left( 1 + \\alpha s - \\frac{\\alpha}{\\kappa} \\right) + \\left( \\bar{I}(0) - 1 + \\frac{\\alpha}{\\kappa} \\right) e^{-\\kappa s}\n$$\n这是强度 $\\bar{I}$ 在任意位置 $s$ 的精确解析解。在验证步骤中，我们使用此公式来找到 $\\bar{I}_{\\text{exact}}(L)$。\n\n### 3. 数值方案\n\n我们将长度为 $L$ 的域离散化为 $N$ 个宽度均匀的单元 $\\Delta s = L/N$。节点 $s_i = i \\Delta s$ 处的强度记为 $\\bar{I}_i$。我们寻求一个更新规则来从 $\\bar{I}_i$ 计算 $\\bar{I}_{i+1}$。\n\n#### 3.1 方案1：一阶显式 Euler 更新\n该方案源于对导数的有限差分近似：$(\\bar{I}_{i+1} - \\bar{I}_i)/\\Delta s \\approx d\\bar{I}/ds|_{s_i}$。\n$$\n\\frac{\\bar{I}_{i+1} - \\bar{I}_i}{\\Delta s} = -\\kappa \\bar{I}_i + \\kappa \\bar{B}(s_i)\n$$\n$$\n\\bar{I}_{i+1} = \\bar{I}_i + \\kappa \\Delta s (\\bar{B}(s_i) - \\bar{I}_i) = (1 - \\kappa \\Delta s) \\bar{I}_i + \\kappa \\Delta s \\bar{B}(s_i)\n$$\n代入 $\\bar{B}(s_i) = 1 + \\alpha s_i$，更新规则为：\n$$\n\\bar{I}_{i+1} = (1 - \\kappa \\Delta s) \\bar{I}_i + \\kappa \\Delta s (1 + \\alpha s_i)\n$$\n该方案是一阶精确的，并且只是有条件稳定的，要求 $\\kappa \\Delta s \\le 2$。\n\n#### 3.2 方案2：源函数分段常数的指数衰减\n该方案从单个单元上（从 $s_i$ 到 $s_{i+1}$）的形式解出发：\n$$\n\\bar{I}(s_{i+1}) = \\bar{I}(s_i) e^{-\\kappa \\Delta s} + \\int_{s_i}^{s_{i+1}} \\kappa \\bar{B}(s') e^{-\\kappa(s_{i+1}-s')} ds'\n$$\n这精确地考虑了来自 $s_i$ 的强度的 Beer-Lambert 衰减。我们将源函数 $\\bar{B}(s')$ 近似为在单元上是常数，$\\bar{B}(s') \\approx \\bar{B}(s_i)$。积变为：\n$$\n\\kappa \\bar{B}(s_i) \\int_{s_i}^{s_{i+1}} e^{-\\kappa(s_{i+1}-s')} ds' = \\kappa \\bar{B}(s_i) \\left[ \\frac{1}{\\kappa} e^{-\\kappa(s_{i+1}-s')} \\right]_{s_i}^{s_{i+1}} = \\bar{B}(s_i) (1 - e^{-\\kappa \\Delta s})\n$$\n更新规则是：\n$$\n\\bar{I}_{i+1} = \\bar{I}_i e^{-\\kappa \\Delta s} + \\bar{B}(s_i) (1 - e^{-\\kappa \\Delta s})\n$$\n代入 $\\bar{B}(s_i) = 1 + \\alpha s_i$：\n$$\n\\bar{I}_{i+1} = \\bar{I}_i e^{-\\kappa \\Delta s} + (1 + \\alpha s_i) (1 - e^{-\\kappa \\Delta s})\n$$\n该方案是一阶精确且无条件稳定的。如果源函数在单元上确实是常数，则该方案是精确的。\n\n#### 3.3 方案3：源函数分段线性的二阶指数衰减\n按照要求，我们在单元内采用 $\\bar{B}(s)$ 的线性表示。由于给定的源函数 $\\bar{B}(s) = 1 + \\alpha s$ 已经是线性的，我们可以精确地对形式解中的源项进行积分。\n$$\n\\text{源项} = \\int_{s_i}^{s_{i+1}} \\kappa (1 + \\alpha s') e^{-\\kappa(s_{i+1}-s')} ds'\n$$\n这个积分恰好是解析解推导的第二部分，应用于区间 $[s_i, s_{i+1}]$ 而非 $[0, s]$。我们可以调整通用解的形式：\n$$\n\\bar{I}(s_i + \\Delta s) = \\left( 1 + \\alpha (s_i+\\Delta s) - \\frac{\\alpha}{\\kappa} \\right) + \\left( \\bar{I}(s_i) - \\left(1 + \\alpha s_i - \\frac{\\alpha}{\\kappa}\\right) \\right) e^{-\\kappa \\Delta s}\n$$\n整理此式可得到 $\\bar{I}_{i+1} = \\bar{I}(s_i + \\Delta s)$ 的更新规则：\n$$\n\\bar{I}_{i+1} = \\bar{I}_i e^{-\\kappa \\Delta s} + \\left(1 + \\alpha s_i - \\frac{\\alpha}{\\kappa}\\right)(1 - e^{-\\kappa \\Delta s}) + \\alpha \\Delta s\n$$\n该方案是通过精确积分线性源项推导出来的。对于一般的平滑源函数，这种线性近似将导致 $O(\\Delta s^3)$ 的局部截断误差和 $O(\\Delta s^2)$ 的全局误差，因此它是二阶精确的。对于问题中给出的源函数是完全线性的特定情况，此方案是精确的，这意味着其误差应仅受浮点精度限制。它也是无条件稳定的。\n\n### 4. 实现与误差计算\n\n通过从 $\\bar{I}_0 = I_0/B_0$ 开始，迭代应用各自的更新规则 $N$ 次来实现这三种方案。在 $s_N = L$ 处获得最终的数值强度 $\\bar{I}_{\\text{num}}(L)$。然后针对解析解 $\\bar{I}_{\\text{exact}}(L)$ 计算每种方案的相对绝对误差：\n$$\n\\text{误差} = \\frac{|\\bar{I}_{\\text{num}}(L) - \\bar{I}_{\\text{exact}}(L)|}{\\max(|\\bar{I}_{\\text{exact}}(L)|, \\epsilon)}\n$$\n其中有一个小的常数 $\\epsilon = 10^{-9}$ 以防止除以零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D Radiative Transfer Equation using three different numerical\n    schemes and calculates their relative errors against the exact analytical solution.\n    \"\"\"\n    \n    # Test cases as specified in the problem statement.\n    # Each tuple is (kappa, L, N, alpha, I0_B0)\n    test_cases = [\n        (1.0, 1.0, 10, 0.5, 0.0),\n        (0.1, 1.0, 4, 1.0, 0.3),\n        (1.0, 10.0, 50, 0.2, 0.0),\n        (1.0, 10.0, 2, 0.2, 0.0),\n        (2.0, 1.0, 20, 0.0, 0.1),\n        (1.0, 1.0, 20, 0.5, 0.0),\n    ]\n\n    all_results = []\n    # Epsilon for robust error calculation\n    epsilon = 1e-9\n\n    for case in test_cases:\n        kappa, L, N, alpha, I0_B0 = case\n        delta_s = L / N\n\n        # 1. Analytical Solution\n        # I_bar(s) = (1 + alpha*s - alpha/kappa) + (I0_B0 - 1 + alpha/kappa) * exp(-kappa*s)\n        # Note: This formula is valid even for alpha = 0.\n        if kappa > 0:\n            exp_term = np.exp(-kappa * L)\n            term1 = 1.0 + alpha * L - alpha / kappa\n            term2 = (I0_B0 - 1.0 + alpha / kappa) * exp_term\n            I_exact_L = term1 + term2\n        else: # Handles kappa = 0 case\n            I_exact_L = I0_B0 + L + alpha * L**2 / 2.0\n\n\n        # 2. Numerical Schemes\n        results_for_case = []\n        \n        # Scheme 1: First-order Explicit Euler\n        I_current = I0_B0\n        for i in range(N):\n            s_i = i * delta_s\n            B_i = 1.0 + alpha * s_i\n            # I_{i+1} = (1 - k*ds)*I_i + k*ds*B_i\n            I_current = (1.0 - kappa * delta_s) * I_current + kappa * delta_s * B_i\n        I_num_euler = I_current\n        \n        # Scheme 2: Exponential Attenuation with Piecewise-Constant Source\n        I_current = I0_B0\n        exp_atten = np.exp(-kappa * delta_s)\n        for i in range(N):\n            s_i = i * delta_s\n            B_i = 1.0 + alpha * s_i\n            # I_{i+1} = I_i * exp(-k*ds) + B_i * (1 - exp(-k*ds))\n            I_current = I_current * exp_atten + B_i * (1.0 - exp_atten)\n        I_num_const_src = I_current\n\n        # Scheme 3: Exponential Attenuation with Piecewise-Linear Source (Exact Integration)\n        I_current = I0_B0\n        exp_atten = np.exp(-kappa * delta_s)\n        \n        if kappa > 0:\n            # Pre-calculate factor for efficiency if kappa is not zero.\n            term_const_part = (1.0 - alpha / kappa) * (1.0 - exp_atten) + alpha * delta_s\n            alpha_si_factor = alpha * (1.0 - exp_atten)\n        \n            for i in range(N):\n                s_i = i * delta_s\n                # Source term S = (1 + alpha*si - alpha/k)*(1-exp) + alpha*ds\n                # Simplified to reduce operations inside the loop\n                source_integral = term_const_part + alpha_si_factor * s_i\n                I_current = I_current * exp_atten + source_integral\n        else: # Handle kappa=0 case, though not in test suite\n            for i in range(N):\n                s_i = i*delta_s\n                source_integral = (1+alpha*s_i)*delta_s + alpha*delta_s**2/2.0\n                I_current = I_current + source_integral\n\n        I_num_linear_src = I_current\n        \n        # 3. Calculate Errors\n        denominator = max(abs(I_exact_L), epsilon)\n        \n        error_euler = abs(I_num_euler - I_exact_L) / denominator\n        error_const_src = abs(I_num_const_src - I_exact_L) / denominator\n        error_linear_src = abs(I_num_linear_src - I_exact_L) / denominator\n        \n        results_for_case.extend([error_euler, error_const_src, error_linear_src])\n        all_results.append(results_for_case)\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists of floats.\n    print(str(all_results).replace(\"], [\", \"],[\") )\n\nsolve()\n```"
        }
    ]
}