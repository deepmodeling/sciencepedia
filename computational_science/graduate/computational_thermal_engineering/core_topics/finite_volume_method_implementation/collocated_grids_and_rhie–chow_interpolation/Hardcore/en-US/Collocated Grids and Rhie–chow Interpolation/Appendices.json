{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any finite volume solver lies in the careful translation of continuous conservation laws into discrete algebraic equations. This practice guides you through the fundamental derivation of the discrete continuity equation on a collocated grid, incorporating the essential Rhie-Chow interpolation . By working through this derivation, you will construct the explicit relationship between cell-centered pressures and the resulting mass fluxes, which forms the basis for the pressure-correction equation.",
            "id": "3939855",
            "problem": "Consider a two-dimensional, steady, incompressible, constant-density flow solved by the Finite Volume Method (FVM) on a uniform collocated grid. On each control volume $\\Omega_{P}$, the primary unknowns are the Cartesian velocity components $u$ and $v$ and the pressure $p$, all stored at the cell center. Let the cell dimensions be $\\Delta x$ in the $x$-direction and $\\Delta y$ in the $y$-direction, so the face areas are $A_{e} = \\Delta y$, $A_{w} = \\Delta y$, $A_{n} = \\Delta x$, and $A_{s} = \\Delta x$. Denote by $E$, $W$, $N$, and $S$ the east, west, north, and south neighbor cells, respectively, of cell $P$. Let $\\rho$ denote the constant density. Let the outward unit normals on the faces of $\\Omega_{P}$ be $\\mathbf{n}_{e} = (1,0)$, $\\mathbf{n}_{w} = (-1,0)$, $\\mathbf{n}_{n} = (0,1)$, and $\\mathbf{n}_{s} = (0,-1)$.\n\nBegin from the integral form of the continuity equation for incompressible flow, $\\int_{\\Omega_{P}} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0$, and use the Divergence Theorem and the control-volume face partition to express mass conservation as the sum of face-normal mass fluxes being zero. On a collocated grid, adopt Rhie–Chow interpolation to compute the face-normal velocities. In this setting, assume each component of the cell-centered velocity is related to the cell-centered pressure gradient by a linearized steady momentum balance whose diagonal coefficients are denoted $a_{P}^{u}$ for the $u$-momentum equation and $a_{P}^{v}$ for the $v$-momentum equation, and likewise $a_{E}^{u}$, $a_{W}^{u}$, $a_{N}^{v}$, and $a_{S}^{v}$ for the respective neighbors. Use a face interpolation that is consistent with these discrete momentum relations: approximate each face-normal velocity by an arithmetic average of adjacent cell-centered velocities corrected by an arithmetic average of the inverse diagonal momentum coefficients multiplying the centered finite-difference pressure gradient across the face. Specifically, for the east and west faces use the $x$-component ($u$) and for the north and south faces use the $y$-component ($v$). The mass flux at each face is the product of density, face area, and the face-normal velocity, with the sign consistent with the outward normal.\n\nDerive, in closed form, the discrete continuity residual $R_{P}$ defined as the algebraic sum of the four outward face mass fluxes on $\\Omega_{P}$, expressed entirely in terms of $\\rho$, $\\Delta x$, $\\Delta y$, the cell-centered variables $u_{P}$, $u_{E}$, $u_{W}$, $v_{P}$, $v_{N}$, $v_{S}$, the pressures $p_{P}$, $p_{E}$, $p_{W}$, $p_{N}$, $p_{S}$, and the diagonal momentum coefficients $a_{P}^{u}$, $a_{E}^{u}$, $a_{W}^{u}$, $a_{P}^{v}$, $a_{N}^{v}$, $a_{S}^{v}$. Your derivation must start from the stated integral continuity law and proceed through physically consistent discretizations and the Rhie–Chow interpolation concept. Report the final symbolic expression for $R_{P}$. Do not substitute any numerical values. Do not include units in your final expression.",
            "solution": "The derivation proceeds as follows.\nFirst, we start with the integral form of the continuity equation over a control volume $\\Omega_P$:\n$$ \\int_{\\Omega_P} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0 $$\nApplying the Divergence Theorem, we convert the volume integral into a surface integral over the boundary $\\partial\\Omega_P$:\n$$ \\int_{\\partial\\Omega_P} \\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S = 0 $$\nThe boundary is partitioned into four faces: east ($e$), west ($w$), north ($n$), and south ($s$). Assuming uniform properties on each face, the integral becomes an algebraic sum of volume fluxes:\n$$ (\\mathbf{u}_e \\cdot \\mathbf{n}_e) A_e + (\\mathbf{u}_w \\cdot \\mathbf{n}_w) A_w + (\\mathbf{u}_n \\cdot \\mathbf{n}_n) A_n + (\\mathbf{u}_s \\cdot \\mathbf{n}_s) A_s = 0 $$\nUsing the given outward unit normals $\\mathbf{n}_e=(1,0)$, $\\mathbf{n}_w=(-1,0)$, $\\mathbf{n}_n=(0,1)$, $\\mathbf{n}_s=(0,-1)$, and defining the face-normal velocities $u_e$, $u_w$, $v_n$, $v_s$ as the velocity components in the positive coordinate directions at the respective face centers, the volume conservation equation is:\n$$ u_e A_e - u_w A_w + v_n A_n - v_s A_s = 0 $$\nThe discrete continuity residual, $R_P$, is defined as the net outward mass flux from the control volume. For a fluid of constant density $\\rho$, this is:\n$$ R_P = \\rho (u_e A_e - u_w A_w + v_n A_n - v_s A_s) $$\nSubstituting the given face areas $A_e = A_w = \\Delta y$ and $A_n = A_s = \\Delta x$:\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\nNext, we express the face-normal velocities using the prescribed Rhie–Chow interpolation scheme. For each face, the velocity is the arithmetic average of the adjacent cell-centered velocities, plus a correction term. The correction involves the average of the inverse diagonal momentum coefficients and the centered pressure gradient across the face. For the east face velocity $u_e$, between cells $P$ and $E$:\n$$ u_e = \\frac{u_P + u_E}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^u} + \\frac{1}{a_E^u} \\right) \\frac{p_E - p_P}{\\Delta x} $$\nThe negative sign on the correction term is due to the fact that a positive pressure gradient opposes the flow. By analogy, we write the expressions for the other three faces:\nWest face ($w$), between cells $W$ and $P$:\n$$ u_w = \\frac{u_W + u_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_W^u} + \\frac{1}{a_P^u} \\right) \\frac{p_P - p_W}{\\Delta x} $$\nNorth face ($n$), between cells $P$ and $N$:\n$$ v_n = \\frac{v_P + v_N}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^v} + \\frac{1}{a_N^v} \\right) \\frac{p_N - p_P}{\\Delta y} $$\nSouth face ($s$), between cells $S$ and $P$:\n$$ v_s = \\frac{v_S + v_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_S^v} + \\frac{1}{a_P^v} \\right) \\frac{p_P - p_S}{\\Delta y} $$\nNow we substitute these into the expression for $R_P$. Let's compute the differences $(u_e - u_w)$ and $(v_n - v_s)$.\nFor the $x$-direction velocities:\n$$ u_e - u_w = \\left[ \\frac{u_P + u_E}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) \\right] - \\left[ \\frac{u_W + u_P}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right] $$\n$$ u_e - u_w = \\frac{u_E - u_W}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\nFor the $y$-direction velocities:\n$$ v_n - v_s = \\frac{v_N - v_S}{2} - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\nFinally, we substitute these differences back into the expression for $R_P$:\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\n$$ R_P = \\rho \\left\\{ \\left[ \\frac{u_E - u_W}{2} \\right]\\Delta y + \\left[ \\frac{v_N - v_S}{2} \\right]\\Delta x \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right]\\Delta y \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) \\right]\\Delta x \\right\\} $$\nDistributing the $\\Delta y$ and $\\Delta x$ terms gives the final expression for the residual $R_P$ in terms of the specified variables.\nThe expression can be separated into two parts: a part derived from simple velocity averaging which is known to be unstable on its own, and a part from the pressure-gradient correction which provides the necessary pressure-velocity coupling to prevent checkerboard oscillations.\nRearranging slightly to group terms by face contributions yields the final form.\n$$ R_P = \\rho \\left( \\frac{u_E - u_W}{2}\\Delta y + \\frac{v_N - v_S}{2}\\Delta x \\right) $$\n$$ - \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\n$$ - \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\nThis expression represents the complete discrete continuity residual as requested.",
            "answer": "$$\n\\boxed{\n\\rho\\left[ \\frac{(u_E - u_W)\\Delta y}{2} + \\frac{(v_N - v_S)\\Delta x}{2} \\right] - \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{P}^{u}}+\\frac{1}{a_{E}^{u}}\\right)(p_E-p_P) + \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{W}^{u}}+\\frac{1}{a_{P}^{u}}\\right)(p_P-p_W) - \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{P}^{v}}+\\frac{1}{a_{N}^{v}}\\right)(p_N-p_P) + \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{S}^{v}}+\\frac{1}{a_{P}^{v}}\\right)(p_P-p_S)\n}\n$$"
        },
        {
            "introduction": "Theoretical derivations are vital, but seeing a numerical instability in action provides a deeper intuition. This hands-on coding exercise demonstrates the classic pressure-velocity decoupling problem that plagues naive collocated grid schemes . You will set up a test case with a checkerboard pressure field and observe how a simple linear interpolation for face velocities fails to detect any mass imbalance, while the Rhie-Chow interpolation correctly identifies a non-zero divergence, thereby enabling the solver to suppress these spurious oscillations.",
            "id": "3939869",
            "problem": "Consider a two-dimensional, incompressible, steady flow on a uniform, collocated grid, where velocity components and pressure are stored at cell centers. The governing equations are the continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and the momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$, with constant density $\\rho$ and dynamic viscosity $\\mu$. In Computational Fluid Dynamics (CFD), it is well known that collocated grids can exhibit spurious pressure oscillations (checkerboarding) unless a stabilization such as the Rhie-Chow interpolation is applied. Your task is to construct a simple discrete test that demonstrates how pressure oscillations arise on a collocated grid without Rhie-Chow interpolation, even when exact uniform boundary conditions are enforced.\n\nFundamental base and discrete setting:\n- Use a uniform, Cartesian grid of size $N_x \\times N_y$, with uniform spacing $\\Delta x = 1$ and $\\Delta y = 1$, and periodic boundary conditions in both directions. Periodic boundaries represent exact continuation of a uniform solution.\n- Assume a base uniform velocity field $\\tilde{u} = U_0$ and $\\tilde{v} = 0$, and a base pressure $p_0$ (constant). All quantities are dimensionless (unitless).\n- Introduce a small, dimensionless checkerboard pressure perturbation of amplitude $\\varepsilon$, superimposed on $p_0$:\n$$\np_{i,j} = p_0 + \\varepsilon (-1)^{i+j},\n$$\nfor cell indices $i \\in \\{0,1,\\dots,N_x-1\\}$ and $j \\in \\{0,1,\\dots,N_y-1\\}$. With periodic boundaries and even $N_x, N_y$, this perturbation is consistent and the base uniform solution remains exact at the boundaries.\n\nDiscrete gradient, velocity update, and face interpolation:\n- Compute the discrete cell-centered pressure gradients using second-order central differences (with periodic wrap):\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y}.\n$$\n- Define a dimensionless momentum diagonal coefficient $a_m  0$ that represents the strength of the implicit momentum operator (the inverse of which scales the pressure-gradient contribution to velocity). Update the cell-centered velocities due to pressure as\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}.\n$$\n\nTwo face-interpolation strategies:\n1. Without Rhie-Chow interpolation (naive collocated interpolation):\n   - Compute face velocities by linear interpolation of neighboring cell-centered velocities:\n   $$\n   u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n   $$\n   $$\n   v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n   $$\n   - Compute the discrete divergence at each cell using face differences:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}.\n   $$\n2. With Rhie-Chow interpolation (stabilized collocated interpolation):\n   - Define the face momentum coefficient $a_f = a_m$.\n   - Augment face velocities with a pressure-difference term across the face:\n   $$\n   u_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n   u_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x},\n   $$\n   $$\n   v_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}, \\quad\n   v_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n   $$\n   - Compute the discrete divergence:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y}.\n   $$\n\nQuantitative measure:\n- For each strategy, compute the global discrete $L^2$ norm of the divergence:\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2 = \\left( \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left[ (\\nabla \\cdot \\mathbf{u})_{i,j} \\right]^2 \\right)^{1/2}.\n$$\n- Demonstrate that, for the checkerboard perturbation and periodic boundaries, the naive collocated interpolation yields $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ numerically equal to $0$ (or at machine precision), while the Rhie-Chow interpolation yields a strictly positive $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ proportional to $\\varepsilon$.\n\nTest suite:\n- Use the following parameter sets $(N_x,N_y,U_0,a_m,\\varepsilon)$, all dimensionless:\n  1. $(4,4,1.0,1.0,10^{-3})$\n  2. $(16,16,0.5,1.0,10^{-3})$\n  3. $(8,8,0.0,2.0,10^{-6})$\n  4. $(6,10,3.0,0.5,10^{-4})$\n\nProgram requirements:\n- Implement the above discrete operations with periodic boundary conditions and the two face-interpolation strategies.\n- For each test case, compute and record a pair of floats $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets of these pairs, for example, $[[a,b],[c,d],[e,f],[g,h]]$ where each letter is a float.\n\nAll quantities are dimensionless, so no physical units are required in the output. Angles do not appear. Percentages are not used.",
            "solution": "We begin from the incompressible continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and steady momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$. On a collocated grid, velocities $\\mathbf{u}$ and pressure $p$ are stored at the same locations (cell centers). For steady uniform flow with periodic boundaries, an exact solution is $\\mathbf{u} = (U_0, 0)$ and $p = p_0$ constant. We consider a superimposed checkerboard pressure perturbation $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$ to study the numerical response of face-interpolation schemes.\n\nDiscretization choices:\n- We adopt a uniform grid with $\\Delta x = \\Delta y = 1$, periodic boundary conditions, and central differences for cell-centered pressure gradients:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2}.\n$$\nWith the checkerboard pattern and even $N_x,N_y$, we note that for the oscillatory part, $p_{i+1,j}$ and $p_{i-1,j}$ are identical. Thus,\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2} = 0, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = 0.\n$$\nHence, the cell-centered velocities updated by the pressure gradient,\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j},\n$$\nsimplify to $u_{i,j} = \\tilde{u} = U_0$ and $v_{i,j} = \\tilde{v} = 0$ everywhere, despite the pressure oscillations.\n\nNaive collocated face interpolation:\n- The naive strategy interpolates cell-centered velocities to faces linearly:\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n$$\n$$\nv_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n$$\nSince $u_{i,j} = U_0$ is constant and $v_{i,j} = 0$ is constant, we have $u_{e,i,j} = u_{w,i,j} = U_0$ and $v_{n,i,j} = v_{s,i,j} = 0$. Therefore, the discrete divergence\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = (u_{e,i,j} - u_{w,i,j}) + (v_{n,i,j} - v_{s,i,j}) = 0,\n$$\nfor all cells. The global $L^2$ norm $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$ is identically $0$. This reveals the decoupling: the checkerboard pressure oscillation does not induce any corrective mass flux at faces, so the continuity equation is blind to it, allowing spurious pressure modes to persist.\n\nRhie-Chow interpolation:\n- Rhie-Chow interpolation modifies face velocities by adding a pressure-difference term that uses face-centered pressure differences rather than cell-centered gradients:\n$$\nu_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} (p_{i+1,j} - p_{i,j}), \\quad\nu_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i-1,j}),\n$$\n$$\nv_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} (p_{i,j+1} - p_{i,j}), \\quad\nv_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i,j-1}).\n$$\nHere we set $a_f = a_m$ to simplify. The resulting discrete divergence is\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\left[ \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y} \\right].\n$$\nWith $\\Delta x = \\Delta y = 1$ and $u_{i,j} = U_0$, $v_{i,j} = 0$, the uniform parts cancel, leaving the pressure contribution:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[(p_{i+1,j} - p_{i,j}) - (p_{i,j} - p_{i-1,j}) + (p_{i,j+1} - p_{i,j}) - (p_{i,j} - p_{i,j-1})\\right].\n$$\nRearranging, we get the discrete $5$-point Laplacian of $p$ multiplied by $-1/a_f$:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j} \\right].\n$$\nFor the checkerboard pattern $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$, neighboring values of the oscillatory part have the opposite sign. Evaluating the Laplacian term for the full pressure field:\n$$\np_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j} = 4(p_0 - \\varepsilon(-1)^{i+j}) - 4(p_0 + \\varepsilon(-1)^{i+j}) = -8\\varepsilon(-1)^{i+j}.\n$$\nThus, the discrete divergence becomes non-zero:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ -8\\varepsilon(-1)^{i+j} \\right] = \\frac{8\\varepsilon}{a_f}(-1)^{i+j}.\n$$\nWith $a_f = a_m$, the discrete divergence is directly proportional to the amplitude of the pressure oscillation:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{8 \\varepsilon}{a_m} (-1)^{i+j}.\n$$\nThe global $L^2$ norm is\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} \\right]^2 \\right)^{1/2} = \\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}.\n$$\nThis nonzero norm quantifies the Rhie-Chow interpolation’s ability to convert the checkerboard pressure oscillation into face flux corrections that do not vanish in the discrete continuity, thereby suppressing the spurious mode.\n\nAlgorithmic design:\n- Implement periodic indexing for central differences and face interpolations.\n- Compute $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}$ and $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}$ with central differences.\n- Update $u_{i,j}$ and $v_{i,j}$ using $a_m$.\n- Compute naive face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$.\n- Compute Rhie-Chow face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$.\n- For the provided test suite $(N_x,N_y,U_0,a_m,\\varepsilon)$, record pairs $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- The expected qualitative outcome is that $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}} \\approx 0$ for all cases (to machine precision), while $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$ scales as $\\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}$.\n\nThis demonstration uses fundamental laws and standard central-difference discretizations to reveal the collocated-grid decoupling mechanism and shows how Rhie-Chow interpolation restores coupling between pressure and mass flux at faces, eliminating the checkerboard null space.",
            "answer": "```python\nimport numpy as np\n\ndef periodic_index(i, n):\n    # Return periodic index\n    return i % n\n\ndef compute_gradients(p):\n    nx, ny = p.shape\n    dpdx = np.zeros_like(p)\n    dpdy = np.zeros_like(p)\n    # Central differences with periodic wrap, dx = dy = 1\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            dpdx[i, j] = 0.5 * (p[ip, j] - p[im, j])\n            dpdy[i, j] = 0.5 * (p[i, jp] - p[i, jm])\n    return dpdx, dpdy\n\ndef interpolate_faces_naive(u, v):\n    nx, ny = u.shape\n    # Face velocities at cell i,j: east, west, north, south\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef interpolate_faces_rc(u, v, p, a_f):\n    nx, ny = u.shape\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            # dx = dy = 1\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j]) - (1.0 / a_f) * (p[ip, j] - p[i, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j]) - (1.0 / a_f) * (p[i, j] - p[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp]) - (1.0 / a_f) * (p[i, jp] - p[i, j])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm]) - (1.0 / a_f) * (p[i, j] - p[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef divergence_from_faces(u_e, u_w, v_n, v_s):\n    # dx = dy = 1\n    return (u_e - u_w) + (v_n - v_s)\n\ndef l2_norm(field):\n    return np.sqrt(np.sum(field**2))\n\ndef run_case(nx, ny, U0, a_m, eps):\n    # Construct checkerboard pressure with periodic consistency\n    i_idx = np.arange(nx).reshape(nx, 1)\n    j_idx = np.arange(ny).reshape(1, ny)\n    checker = ((i_idx + j_idx) % 2) * 2 - 1  # values in {-1, +1}\n    p0 = 0.0\n    p = p0 + eps * checker\n\n    # Base velocities\n    u_tilde = np.full((nx, ny), U0)\n    v_tilde = np.zeros((nx, ny))\n\n    # Cell-centered gradients\n    dpdx, dpdy = compute_gradients(p)\n\n    # Update cell-centered velocities\n    u = u_tilde - (1.0 / a_m) * dpdx\n    v = v_tilde - (1.0 / a_m) * dpdy\n\n    # Naive face interpolation and divergence\n    u_e, u_w, v_n, v_s = interpolate_faces_naive(u, v)\n    div_naive = divergence_from_faces(u_e, u_w, v_n, v_s)\n    norm_naive = l2_norm(div_naive)\n\n    # Rhie–Chow face interpolation and divergence\n    u_e_rc, u_w_rc, v_n_rc, v_s_rc = interpolate_faces_rc(u, v, p, a_m)\n    div_rc = divergence_from_faces(u_e_rc, u_w_rc, v_n_rc, v_s_rc)\n    norm_rc = l2_norm(div_rc)\n\n    return [float(norm_naive), float(norm_rc)]\n\ndef solve():\n    test_cases = [\n        (4, 4, 1.0, 1.0, 1e-3),\n        (16, 16, 0.5, 1.0, 1e-3),\n        (8, 8, 0.0, 2.0, 1e-6),\n        (6, 10, 3.0, 0.5, 1e-4),\n    ]\n\n    results = []\n    for nx, ny, U0, a_m, eps in test_cases:\n        results.append(run_case(nx, ny, U0, a_m, eps))\n\n    # Print nested list of [norm_naive, norm_rc] for each case\n    # Ensure single-line output format exactly as specified.\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The standard Rhie-Chow interpolation is typically presented for schemes with first-order accuracy in pressure-velocity coupling. To achieve higher-order simulations, the velocity reconstruction and the pressure-coupling mechanism must be enhanced in a consistent manner. This advanced exercise challenges you to generalize the core idea of Rhie-Chow interpolation to a higher-order, quadratic velocity reconstruction scheme . Deriving the modified flux formula will deepen your understanding of the underlying principles and prepare you to analyze and develop more sophisticated numerical methods.",
            "id": "3939904",
            "problem": "Consider one-dimensional, steady, incompressible flow of a Newtonian fluid in a channel of constant cross-sectional area on a collocated finite-volume grid, where velocities and pressures are stored at the same locations (cell centers). The governing momentum equation along the $x$-direction is the $x$-component of the Navier–Stokes equations, and the spatial discretization is performed using the Finite Volume Method (FVM). On a collocated grid, naive face interpolation of cell-centered velocities can lead to pressure-velocity decoupling (checkerboarding). The Rhie-Chow interpolation introduces a pressure-gradient-consistent correction in the face velocity formula to prevent decoupling.\n\nYou are asked to assess the feasibility of using a higher-order face velocity reconstruction and to derive the corresponding modification to the Rhie-Chow face flux. Work from first principles as follows:\n\n- Begin from the discrete form of the $x$-momentum equation on cell $i$, written in linearized form as $a_i u_i = H_i - D_i (\\partial p/\\partial x)_i$, where $a_i$ is the diagonal momentum coefficient arising from convection, diffusion, and temporal terms, $H_i$ is the aggregation of neighbor contributions and sources, and $D_i$ is a geometric coefficient multiplying the pressure gradient contribution. Explain briefly why a purely interpolated $u_f$ at faces $f$ fails to couple consistently to the discrete pressure field on a collocated grid, and why a Rhie-Chow-type correction of the form proportional to the difference between a face pressure gradient and an interpolation of cell-centered pressure gradients restores coupling.\n\n- Now, assume a uniform grid with spacing $\\Delta x$, constant fluid density $\\rho$, constant face area $A_f$, and consider the face $f$ located at $x_{i+1/2}$ between cells $i$ and $i+1$. Construct a quadratic polynomial in $x$ for the velocity using the three-point stencil $\\{x_{i-1}, x_i, x_{i+1}\\}$ and evaluate it at $x_{i+1/2}$ to obtain a second-order face velocity reconstruction $u_f^{\\mathrm{quad}}$ in terms of $u_{i-1}$, $u_i$, and $u_{i+1}$. For the Rhie-Chow pressure-gradient correction, use the following consistent second-order ingredients:\n    1. The face pressure gradient at $x_{i+1/2}$ evaluated by a two-point difference, $\\left(\\partial p/\\partial x\\right)_f = \\left(p_{i+1} - p_i\\right)/\\Delta x$.\n    2. The cell-centered pressure gradients $\\left(\\partial p/\\partial x\\right)_i = \\left(p_{i+1} - p_{i-1}\\right)/(2\\Delta x)$ and $\\left(\\partial p/\\partial x\\right)_{i+1} = \\left(p_{i+2} - p_i\\right)/(2\\Delta x)$, interpolated linearly to the face as $\\overline{\\left(\\partial p/\\partial x\\right)}_f = \\frac{1}{2}\\left[\\left(\\partial p/\\partial x\\right)_i + \\left(\\partial p/\\partial x\\right)_{i+1}\\right]$.\n    3. The inverse face momentum coefficient given by the arithmetic average of reciprocals, $\\beta_f = \\frac{1}{2}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right)$.\n\n- Using these ingredients, derive a closed-form analytic expression for the face mass flux $F_f = \\rho A_f u_f$ at $x_{i+1/2}$ that employs the quadratic face velocity reconstruction and a Rhie-Chow correction defined as $-\\beta_f\\left[\\left(\\partial p/\\partial x\\right)_f - \\overline{\\left(\\partial p/\\partial x\\right)}_f\\right]$. Simplify the final expression into a single formula in terms of $u_{i-1}$, $u_i$, $u_{i+1}$, $p_{i-1}$, $p_i$, $p_{i+1}$, $p_{i+2}$, $a_i$, $a_{i+1}$, $\\Delta x$, $A_f$, and $\\rho$.\n\nDiscuss briefly in your derivation the feasibility of this quadratic reconstruction with Rhie-Chow interpolation in terms of consistency (the correction should vanish for a linear pressure field) and potential stability issues (e.g., overshoots) without resorting to limiters. Your final answer must be the single, simplified analytic expression for $F_f$. Do not numerically evaluate your expression and do not include units in the final boxed expression.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics (CFD), is well-posed with a clear objective and sufficient data, and is formulated objectively. We proceed with the solution.\n\nThe use of a collocated grid in the Finite Volume Method (FVM), where velocity components and pressure share the same storage location (e.g., cell centers), is a priori prone to pressure-velocity decoupling. This issue arises from the way the discrete momentum and continuity equations are linked. Consider the discrete continuity equation for an incompressible fluid in one dimension for cell $i$: $F_{i+1/2} - F_{i-1/2} = 0$, where $F_f = \\rho A_f u_f$ is the mass flux through face $f$. If the face velocity $u_{i+1/2}$ is obtained by simple linear interpolation of the cell-centered velocities, $u_{i+1/2} = \\frac{1}{2}(u_i + u_{i+1})$, the stencil for the continuity equation at cell $i$ does not directly involve the pressure at node $i$, $p_i$. Specifically, the discretized momentum equation at cell $i$ relates $u_i$ to the pressure gradient calculated from $p_{i+1}$ and $p_{i-1}$. Consequently, the continuity equation at cell $i$ ends up coupling $p_i$ only to its next-nearest neighbors ($p_{i-2}$ and $p_{i+2}$), not its immediate neighbors ($p_{i-1}$ and $p_{i+1}$). This allows for two independent pressure fields on alternating grid points, leading to non-physical, oscillatory pressure solutions known as \"checkerboarding\".\n\nThe Rhie-Chow interpolation method remedies this by introducing a correction term to the face velocity. The fundamental idea is to reconstruct the face velocity in a way that is consistent with the discrete pressure gradient that would drive such a velocity. The discrete momentum equation for cell $i$ is given as $a_i u_i = H_i - D_i (\\partial p/\\partial x)_i$. From this, we can express the cell velocity as $u_i = (H_i/a_i) - (D_i/a_i)(\\partial p/\\partial x)_i$. A simple interpolation of $u_i$ and $u_{i+1}$ to the face $i+1/2$ would involve an interpolation of the $(\\partial p/\\partial x)_i$ and $(\\partial p/\\partial x)_{i+1}$ terms. The Rhie-Chow correction is proportional to the difference between a compact, higher-order approximation of the pressure gradient at the face, $(\\partial p/\\partial x)_f$, and the interpolated cell-centered pressure gradients, $\\overline{(\\partial p/\\partial x)}_f$. This difference term effectively introduces a discrete pressure Laplacian into the continuity equation, which robustly couples adjacent pressure nodes and suppresses oscillations. The correction is designed to vanish for a sufficiently smooth pressure field, thus maintaining the formal accuracy of the scheme.\n\nFollowing the problem's instructions, we first derive the second-order (quadratic) face velocity reconstruction, $u_f^{\\mathrm{quad}}$, at face $f$ located at $x_{i+1/2}$. We use a three-point stencil involving the cell-centered velocities $u_{i-1}$, $u_i$, and $u_{i+1}$. Let the quadratic interpolating polynomial be $u(x')$, where $x'=x-x_i$ is a local coordinate:\n$$u(x') = c_0 + c_1 x' + c_2 (x')^2$$\nThe velocities are known at $x'=-\\Delta x$ ($u_{i-1}$), $x'=0$ ($u_i$), and $x'=\\Delta x$ ($u_{i+1}$).\n$u(0) = u_i \\implies c_0 = u_i$.\n$u(\\Delta x) = u_{i+1} = u_i + c_1 \\Delta x + c_2 (\\Delta x)^2$.\n$u(-\\Delta x) = u_{i-1} = u_i - c_1 \\Delta x + c_2 (\\Delta x)^2$.\nSolving this system for $c_1$ and $c_2$ yields:\n$$c_1 = \\frac{u_{i+1} - u_{i-1}}{2\\Delta x}$$\n$$c_2 = \\frac{u_{i+1} - 2u_i + u_{i-1}}{2(\\Delta x)^2}$$\nThe face $f$ is located at $x_{i+1/2}$, which corresponds to $x' = \\Delta x / 2$. Evaluating the polynomial at this location gives the desired face velocity reconstruction:\n$$u_f^{\\mathrm{quad}} = u\\left(\\frac{\\Delta x}{2}\\right) = c_0 + c_1\\left(\\frac{\\Delta x}{2}\\right) + c_2\\left(\\frac{\\Delta x}{2}\\right)^2$$\n$$u_f^{\\mathrm{quad}} = u_i + \\left(\\frac{u_{i+1} - u_{i-1}}{2\\Delta x}\\right)\\frac{\\Delta x}{2} + \\left(\\frac{u_{i+1} - 2u_i + u_{i-1}}{2(\\Delta x)^2}\\right)\\frac{(\\Delta x)^2}{4}$$\n$$u_f^{\\mathrm{quad}} = u_i + \\frac{u_{i+1} - u_{i-1}}{4} + \\frac{u_{i+1} - 2u_i + u_{i-1}}{8}$$\n$$u_f^{\\mathrm{quad}} = \\frac{8u_i + 2(u_{i+1} - u_{i-1}) + (u_{i+1} - 2u_i + u_{i-1})}{8}$$\n$$u_f^{\\mathrm{quad}} = \\frac{8u_i + 2u_{i+1} - 2u_{i-1} + u_{i+1} - 2u_i + u_{i-1}}{8} = \\frac{6u_i + 3u_{i+1} - u_{i-1}}{8}$$\nThis is the velocity reconstruction based on the QUICK scheme.\n\nNext, we formulate the Rhie-Chow correction term using the provided ingredients. The correction is added to the interpolated velocity, so the final face velocity is $u_f = u_f^{\\mathrm{quad}} - \\beta_f \\left[ (\\partial p/\\partial x)_f - \\overline{(\\partial p/\\partial x)}_f \\right]$. Let's compute the pressure gradient difference term:\n$$ \\Delta\\left(\\frac{\\partial p}{\\partial x}\\right) = \\left(\\frac{\\partial p}{\\partial x}\\right)_f - \\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f $$\nUsing the given definitions:\n$$ \\left(\\frac{\\partial p}{\\partial x}\\right)_f = \\frac{p_{i+1} - p_i}{\\Delta x} $$\n$$ \\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f = \\frac{1}{2}\\left[\\left(\\frac{\\partial p}{\\partial x}\\right)_i + \\left(\\frac{\\partial p}{\\partial x}\\right)_{i+1}\\right] = \\frac{1}{2}\\left[ \\frac{p_{i+1} - p_{i-1}}{2\\Delta x} + \\frac{p_{i+2} - p_i}{2\\Delta x} \\right] = \\frac{p_{i+2} + p_{i+1} - p_i - p_{i-1}}{4\\Delta x} $$\nSubstituting these into the difference expression:\n$$ \\Delta\\left(\\frac{\\partial p}{\\partial x}\\right) = \\frac{p_{i+1} - p_i}{\\Delta x} - \\frac{p_{i+2} + p_{i+1} - p_i - p_{i-1}}{4\\Delta x} $$\n$$ \\Delta\\left(\\frac{\\partial p}{\\partial x}\\right) = \\frac{4(p_{i+1} - p_i) - (p_{i+2} + p_{i+1} - p_i - p_{i-1})}{4\\Delta x} $$\n$$ \\Delta\\left(\\frac{\\partial p}{\\partial x}\\right) = \\frac{4p_{i+1} - 4p_i - p_{i+2} - p_{i+1} + p_i + p_{i-1}}{4\\Delta x} = \\frac{-p_{i+2} + 3p_{i+1} - 3p_i + p_{i-1}}{4\\Delta x} $$\nThis term is proportional to a finite difference approximation of the third derivative of pressure, $-(\\Delta x)^2 (\\partial^3 p/\\partial x^3)/4$. As required for consistency, this term vanishes if the pressure field is quadratic, linear, or constant.\n\nNow, we construct the full expression for the face velocity $u_f$. The Rhie-Chow correction term to be added to $u_f^{\\mathrm{quad}}$ is defined as $-\\beta_f \\Delta(\\partial p/\\partial x)$, where $\\beta_f = \\frac{1}{2}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right)$.\n$$ u_f = u_f^{\\mathrm{quad}} - \\beta_f \\left[ \\frac{-p_{i+2} + 3p_{i+1} - 3p_i + p_{i-1}}{4\\Delta x} \\right] $$\n$$ u_f = \\frac{6u_i + 3u_{i+1} - u_{i-1}}{8} + \\frac{1}{2}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right) \\left[ \\frac{p_{i+2} - 3p_{i+1} + 3p_i - p_{i-1}}{4\\Delta x} \\right] $$\n$$ u_f = \\frac{6u_i + 3u_{i+1} - u_{i-1}}{8} + \\frac{1}{8\\Delta x}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right) (p_{i+2} - 3p_{i+1} + 3p_i - p_{i-1}) $$\nFinally, the face mass flux $F_f$ is $F_f = \\rho A_f u_f$.\n$$ F_f = \\rho A_f \\left[ \\frac{6u_i + 3u_{i+1} - u_{i-1}}{8} + \\frac{1}{8\\Delta x}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right) (p_{i+2} - 3p_{i+1} + 3p_i - p_{i-1}) \\right] $$\nThis scheme is feasible and consistent. However, its stability warrants caution. The QUICK velocity reconstruction is known to produce unphysical oscillations (overshoots and undershoots) in regions with strong gradients unless flux limiters are applied. The pressure correction term, being a discrete high-order derivative, can also introduce numerical noise and potential instabilities, especially on coarse grids. Furthermore, its inclusion results in a wider stencil for the pressure-correction equation (a pentadiagonal system in 1D), increasing computational cost compared to the standard tridiagonal system.",
            "answer": "$$\n\\boxed{\\rho A_f \\left[ \\frac{6u_i + 3u_{i+1} - u_{i-1}}{8} + \\frac{1}{8\\Delta x}\\left(\\frac{1}{a_i} + \\frac{1}{a_{i+1}}\\right) (p_{i+2} - 3p_{i+1} + 3p_i - p_{i-1}) \\right]}\n$$"
        }
    ]
}