{
    "hands_on_practices": [
        {
            "introduction": "在同位网格上进行流体动力学仿真时，一个典型挑战是压力-速度解耦问题，它可能导致非物理的棋盘状压力振荡。本练习旨在通过一个经典的数值实验来直观地揭示这一问题。通过引入一个棋盘状的压力扰动，您将对比朴素插值格式和Rhie–Chow插值格式的响应，从而亲手验证为何需要进行校正，并理解Rhie–Chow方法如何有效地重建压力与速度之间的物理耦合。",
            "id": "3939869",
            "problem": "考虑一个均匀同位网格上的二维、不可压缩、稳态流动，其中速度分量和压力存储在单元中心。控制方程为连续性方程 $\\nabla \\cdot \\mathbf{u} = 0$ 和动量方程 $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$，其中密度 $\\rho$ 和动力粘度 $\\mu$ 为常数。在计算流体动力学（CFD）中，众所周知，除非应用像 Rhie–Chow 插值这样的稳定化方法，否则同位网格会表现出伪压力振荡（棋盘格现象）。您的任务是构建一个简单的离散测试，以演示即使在施加精确的均匀边界条件的情况下，压力振荡如何在没有 Rhie–Chow 插值的同位网格上产生。\n\n基本基底和离散设置：\n- 使用一个大小为 $N_x \\times N_y$ 的均匀笛卡尔网格，其均匀间距 $\\Delta x = 1$ 和 $\\Delta y = 1$，并在两个方向上都采用周期性边界条件。周期性边界代表了均匀解的精确延续。\n- 假设一个基础均匀速度场 $\\tilde{u} = U_0$ 和 $\\tilde{v} = 0$，以及一个基础压力 $p_0$（常数）。所有量都是无量纲的（无单位）。\n- 引入一个小的、无量纲的棋盘格压力扰动，其振幅为 $\\varepsilon$，叠加在 $p_0$ 之上：\n$$\np_{i,j} = p_0 + \\varepsilon (-1)^{i+j},\n$$\n对于单元索引 $i \\in \\{0,1,\\dots,N_x-1\\}$ 和 $j \\in \\{0,1,\\dots,N_y-1\\}$。对于周期性边界和偶数 $N_x, N_y$，此扰动是一致的，并且基础均匀解在边界上保持精确。\n\n离散梯度、速度更新和面插值：\n- 使用二阶中心差分（带周期性环绕）计算离散的单元中心压力梯度：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y}.\n$$\n- 定义一个无量纲动量对角系数 $a_m > 0$，它代表隐式动量算子的强度（其倒数缩放压力梯度对速度的贡献）。由压力引起的单元中心速度更新为：\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}.\n$$\n\n两种面插值策略：\n1. 不使用 Rhie–Chow 插值（朴素同位插值）：\n   - 通过相邻单元中心速度的线性插值计算面速度：\n   $$\n   u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n   $$\n   $$\n   v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n   $$\n   - 使用面通量差计算每个单元的离散散度：\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}.\n   $$\n2. 使用 Rhie–Chow 插值（稳定的同位插值）：\n   - 定义面动量系数 $a_f = a_m$。\n   - 用跨面的压力差项来增强面速度：\n   $$\n   u_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n   u_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x},\n   $$\n   $$\n   v_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}, \\quad\n   v_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n   $$\n   - 计算离散散度：\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y}.\n   $$\n\n定量度量：\n- 对每种策略，计算散度的全局离散 $L^2$ 范数：\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2 = \\left( \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left[ (\\nabla \\cdot \\mathbf{u})_{i,j} \\right]^2 \\right)^{1/2}.\n$$\n- 证明对于棋盘格扰动和周期性边界，朴素同位插值得到的 $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ 在数值上等于 $0$（或达到机器精度），而 Rhie–Chow 插值得到的 $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ 是一个与 $\\varepsilon$ 成正比的严格为正的值。\n\n测试套件：\n- 使用以下无量纲参数集 $(N_x,N_y,U_0,a_m,\\varepsilon)$：\n  1. $(4,4,1.0,1.0,10^{-3})$\n  2. $(16,16,0.5,1.0,10^{-3})$\n  3. $(8,8,0.0,2.0,10^{-6})$\n  4. $(6,10,3.0,0.5,10^{-4})$\n\n程序要求：\n- 实现上述带有周期性边界条件和两种面插值策略的离散操作。\n- 对每个测试用例，计算并记录一对浮点数 $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$。\n- 您的程序应生成单行输出，包含一个由这些浮点数对组成的列表，格式为用方括号括起来的逗号分隔列表，例如 $[[a,b],[c,d],[e,f],[g,h]]$，其中每个字母都是一个浮点数。\n\n所有量都是无量纲的，因此输出中不需要物理单位。不出现角度。不使用百分比。",
            "solution": "我们从不可压缩连续性方程 $\\nabla \\cdot \\mathbf{u} = 0$ 和稳态动量方程 $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$ 开始。在同位网格上，速度 $\\mathbf{u}$ 和压力 $p$ 存储在相同的位置（单元中心）。对于具有周期性边界的稳态均匀流，一个精确解是 $\\mathbf{u} = (U_0, 0)$ 和 $p = p_0$（常数）。我们考虑一个叠加的棋盘格压力扰动 $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$，以研究面插值格式的数值响应。\n\n离散化选择：\n- 我们采用一个具有 $\\Delta x = \\Delta y = 1$ 的均匀网格、周期性边界条件，并使用中心差分计算单元中心的压力梯度：\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2}.\n$$\n对于棋盘格模式和偶数 $N_x,N_y$，我们注意到 $p_{i+1,j} = - p_{i,j}$ 和 $p_{i-1,j} = - p_{i,j}$，这意味着\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{(-p_{i,j}) - (-p_{i,j})}{2} = 0, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = 0.\n$$\n因此，由压力梯度更新的单元中心速度，\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j},\n$$\n简化为 $u_{i,j} = \\tilde{u} = U_0$ 和 $v_{i,j} = \\tilde{v} = 0$，在所有地方都如此，尽管存在压力振荡。\n\n朴素同位面插值：\n- 朴素策略将单元中心速度线性插值到面上：\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n$$\n$$\nv_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n$$\n由于 $u_{i,j} = U_0$ 是常数且 $v_{i,j} = 0$ 是常数，我们有 $u_{e,i,j} = u_{w,i,j} = U_0$ 和 $v_{n,i,j} = v_{s,i,j} = 0$。因此，离散散度\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = (u_{e,i,j} - u_{w,i,j}) + (v_{n,i,j} - v_{s,i,j}) = 0,\n$$\n对于所有单元都成立。全局 $L^2$ 范数 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$ 恒等于 $0$。这揭示了解耦现象：棋盘格压力振荡不会在面上引起任何修正的质量通量，因此连续性方程对此是“盲目”的，从而允许伪压力模式持续存在。\n\nRhie–Chow 插值：\n- Rhie–Chow 插值通过添加一个使用面心压力差而非单元中心梯度的压力差项来修正面速度：\n$$\nu_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} (p_{i+1,j} - p_{i,j}), \\quad\nu_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i-1,j}),\n$$\n$$\nv_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} (p_{i,j+1} - p_{i,j}), \\quad\nv_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i,j-1}).\n$$\n这里我们为简化起见设置 $a_f = a_m$。由此产生的离散散度为\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\left[ \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y} \\right].\n$$\n当 $\\Delta x = \\Delta y = 1$ 且 $u_{i,j} = U_0$, $v_{i,j} = 0$ 时，均匀部分相消，留下压力贡献部分：\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[(p_{i+1,j} - p_{i,j}) - (p_{i,j} - p_{i-1,j}) + (p_{i,j+1} - p_{i,j}) - (p_{i,j} - p_{i,j-1})\\right].\n$$\n重新整理，\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ p_{i+1,j} - 2 p_{i,j} + p_{i-1,j} + p_{i,j+1} - 2 p_{i,j} + p_{i,j-1} \\right].\n$$\n这是 $p$ 的离散 $5$ 点拉普拉斯算子乘以 $-1/a_f$。对于棋盘格模式 $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$ 和偶数 $N_x, N_y$，相邻值满足 $p_{i\\pm 1,j} = - p_{i,j}$ 和 $p_{i,j \\pm 1} = - p_{i,j}$，得到\n$$\np_{i+1,j} - 2 p_{i,j} + p_{i-1,j} = - 4 p_{i,j}, \\quad p_{i,j+1} - 2 p_{i,j} + p_{i,j-1} = - 4 p_{i,j}.\n$$\n因此\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ - 8 p_{i,j} \\right] = \\frac{8}{a_f} p_{i,j} = \\frac{8}{a_m} \\left( p_0 + \\varepsilon (-1)^{i+j} \\right).\n$$\n由于 $p_0$ 是常数，当考虑周期性所隐含的差分时，$p_0$ 的散度贡献会抵消；振荡部分产生一个非零散度：\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{8 \\varepsilon}{a_m} (-1)^{i+j}.\n$$\n全局 $L^2$ 范数为\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} \\right]^2 \\right)^{1/2} = \\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}.\n$$\n这个非零范数定量地描述了 Rhie–Chow 插值将棋盘格压力振荡转换为面通量修正的能力，这些修正项在离散连续性方程中不为零，从而抑制了伪模式。\n\n算法设计：\n- 为中心差分和面插值实现周期性索引。\n- 计算 $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}$ 和 $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}$。\n- 使用 $a_m$ 更新 $u_{i,j}$ 和 $v_{i,j}$。\n- 计算朴素面速度和散度；计算 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$。\n- 计算 Rhie–Chow 面速度和散度；计算 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$。\n- 对于给定的测试套件 $(N_x,N_y,U_0,a_m,\\varepsilon)$，记录浮点数对 $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$。\n- 预期的定性结果是，对于所有情况，$\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}} \\approx 0$（达到机器精度），而 $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$ 按 $\\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}$ 的比例缩放。\n\n该演示使用基本定律和标准的中心差分离散格式来揭示同位网格的解耦机制，并展示了 Rhie–Chow 插值如何恢复压力与面质量通量之间的耦合，从而消除了棋盘格零空间。",
            "answer": "```python\nimport numpy as np\n\ndef periodic_index(i, n):\n    # Return periodic index\n    return i % n\n\ndef compute_gradients(p):\n    nx, ny = p.shape\n    dpdx = np.zeros_like(p)\n    dpdy = np.zeros_like(p)\n    # Central differences with periodic wrap, dx = dy = 1\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            dpdx[i, j] = 0.5 * (p[ip, j] - p[im, j])\n            dpdy[i, j] = 0.5 * (p[i, jp] - p[i, jm])\n    return dpdx, dpdy\n\ndef interpolate_faces_naive(u, v):\n    nx, ny = u.shape\n    # Face velocities at cell i,j: east, west, north, south\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef interpolate_faces_rc(u, v, p, a_f):\n    nx, ny = u.shape\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            # dx = dy = 1\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j]) - (1.0 / a_f) * (p[ip, j] - p[i, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j]) - (1.0 / a_f) * (p[i, j] - p[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp]) - (1.0 / a_f) * (p[i, jp] - p[i, j])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm]) - (1.0 / a_f) * (p[i, j] - p[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef divergence_from_faces(u_e, u_w, v_n, v_s):\n    # dx = dy = 1\n    return (u_e - u_w) + (v_n - v_s)\n\ndef l2_norm(field):\n    return np.sqrt(np.sum(field**2))\n\ndef run_case(nx, ny, U0, a_m, eps):\n    # Construct checkerboard pressure with periodic consistency\n    i_idx = np.arange(nx).reshape(nx, 1)\n    j_idx = np.arange(ny).reshape(1, ny)\n    checker = ((i_idx + j_idx) % 2) * 2 - 1  # values in {-1, +1}\n    p0 = 0.0\n    p = p0 + eps * checker\n\n    # Base velocities\n    u_tilde = np.full((nx, ny), U0)\n    v_tilde = np.zeros((nx, ny))\n\n    # Cell-centered gradients\n    dpdx, dpdy = compute_gradients(p)\n\n    # Update cell-centered velocities\n    u = u_tilde - (1.0 / a_m) * dpdx\n    v = v_tilde - (1.0 / a_m) * dpdy\n\n    # Naive face interpolation and divergence\n    u_e, u_w, v_n, v_s = interpolate_faces_naive(u, v)\n    div_naive = divergence_from_faces(u_e, u_w, v_n, v_s)\n    norm_naive = l2_norm(div_naive)\n\n    # Rhie–Chow face interpolation and divergence\n    u_e_rc, u_w_rc, v_n_rc, v_s_rc = interpolate_faces_rc(u, v, p, a_m)\n    div_rc = divergence_from_faces(u_e_rc, u_w_rc, v_n_rc, v_s_rc)\n    norm_rc = l2_norm(div_rc)\n\n    return [float(norm_naive), float(norm_rc)]\n\ndef solve():\n    test_cases = [\n        (4, 4, 1.0, 1.0, 1e-3),\n        (16, 16, 0.5, 1.0, 1e-3),\n        (8, 8, 0.0, 2.0, 1e-6),\n        (6, 10, 3.0, 0.5, 1e-4),\n    ]\n\n    results = []\n    for nx, ny, U0, a_m, eps in test_cases:\n        results.append(run_case(nx, ny, U0, a_m, eps))\n\n    # Print nested list of [norm_naive, norm_rc] for each case\n    # Ensure single-line output format exactly as specified.\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "理解了为何需要Rhie–Chow插值之后，下一步是掌握如何在有限体积法（FVM）的框架内将其数学化，以便于程序实现。本练习将引导您从基本守恒定律出发，一步步推导出包含了Rhie–Chow通量定义的离散连续性方程。掌握这一推导过程对于从概念理解过渡到实际代码开发至关重要，因为它将产生压力泊松方程的核心代数形式。",
            "id": "3939855",
            "problem": "考虑一个在均匀同位网格上使用有限体积法（FVM）求解的二维、稳态、不可压缩、常密度流。在每个控制体 $\\Omega_{P}$ 上，主要未知量是笛卡尔速度分量 $u$ 和 $v$ 以及压力 $p$，它们都存储在单元中心。设单元尺寸在 $x$ 方向为 $\\Delta x$，在 $y$ 方向为 $\\Delta y$，因此面面积为 $A_{e} = \\Delta y$，$A_{w} = \\Delta y$，$A_{n} = \\Delta x$ 和 $A_{s} = \\Delta x$。用 $E$、$W$、$N$ 和 $S$ 分别表示单元 $P$ 的东、西、北、南相邻单元。设 $\\rho$ 表示常数密度。设 $\\Omega_{P}$ 各面上的外向单位法向量为 $\\mathbf{n}_{e} = (1,0)$，$\\mathbf{n}_{w} = (-1,0)$，$\\mathbf{n}_{n} = (0,1)$ 和 $\\mathbf{n}_{s} = (0,-1)$。\n\n从不可压缩流的连续性方程的积分形式 $\\int_{\\Omega_{P}} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0$ 开始，利用散度定理和控制体面划分将质量守恒表示为各面法向质量通量之和为零。在同位网格上，采用 Rhie–Chow 插值来计算面法向速度。在此设定下，假设单元中心速度的每个分量通过一个线性化的稳态动量平衡与单元中心的压力梯度相关，其对角系数对于 $u$-动量方程记为 $a_{P}^{u}$，对于 $v$-动量方程记为 $a_{P}^{v}$，同样地，对于各自的相邻单元记为 $a_{E}^{u}$、$a_{W}^{u}$、$a_{N}^{v}$ 和 $a_{S}^{v}$。使用与这些离散动量关系一致的面插值：通过相邻单元中心速度的算术平均值来近似每个面法向速度，并用一个校正项对其进行修正。该校正项为对角动量系数倒数的算术平均值乘以穿过该面的中心有限差分压力梯度。具体来说，对于东面和西面使用 $x$ 分量（$u$），对于北面和南面使用 $y$ 分量（$v$）。每个面上的质量通量是密度、面面积和面法向速度的乘积，其符号与外向法向量一致。\n\n以封闭形式推导离散连续性残差 $R_{P}$，该残差定义为 $\\Omega_{P}$ 上四个外向面质量通量的代数和，并完全用 $\\rho$、$\\Delta x$、$\\Delta y$、单元中心变量 $u_{P}$、$u_{E}$、$u_{W}$、$v_{P}$、$v_{N}$、$v_{S}$、压力 $p_{P}$、$p_{E}$、$p_{W}$、$p_{N}$、$p_{S}$ 以及对角动量系数 $a_{P}^{u}$、$a_{E}^{u}$、$a_{W}^{u}$、$a_{P}^{v}$、$a_{N}^{v}$、$a_{S}^{v}$ 来表示。您的推导必须从所述的积分连续性定律开始，并经过物理上一致的离散化和 Rhie–Chow 插值概念。报告 $R_{P}$ 的最终符号表达式。不要代入任何数值。最终表达式中不要包含单位。",
            "solution": "首先，我们从控制体 $\\Omega_P$ 上的连续性方程的积分形式开始：\n$$ \\int_{\\Omega_P} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0 $$\n应用散度定理，我们将体积分转换为边界 $\\partial\\Omega_P$ 上的面积分：\n$$ \\int_{\\partial\\Omega_P} \\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S = 0 $$\n边界被划分为四个面：东（$e$）、西（$w$）、北（$n$）和南（$s$）。假设每个面上的属性是均匀的，该积分变为体积通量的代数和：\n$$ (\\mathbf{u}_e \\cdot \\mathbf{n}_e) A_e + (\\mathbf{u}_w \\cdot \\mathbf{n}_w) A_w + (\\mathbf{u}_n \\cdot \\mathbf{n}_n) A_n + (\\mathbf{u}_s \\cdot \\mathbf{n}_s) A_s = 0 $$\n使用给定的外向单位法向量 $\\mathbf{n}_e=(1,0)$、$\\mathbf{n}_w=(-1,0)$、$\\mathbf{n}_n=(0,1)$、$\\mathbf{n}_s=(0,-1)$，并将在各面中心沿正坐标方向的速度分量定义为面法向速度 $u_e$、$u_w$、$v_n$、$v_s$，体积守恒方程为：\n$$ u_e A_e - u_w A_w + v_n A_n - v_s A_s = 0 $$\n离散连续性残差 $R_P$ 定义为从控制体流出的净质量通量。对于密度为常数 $\\rho$ 的流体，这表示为：\n$$ R_P = \\rho (u_e A_e - u_w A_w + v_n A_n - v_s A_s) $$\n代入给定的面面积 $A_e = A_w = \\Delta y$ 和 $A_n = A_s = \\Delta x$：\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\n接下来，我们使用规定的 Rhie–Chow 插值格式来表示面法向速度。对于每个面，速度是相邻单元中心速度的算术平均值，外加一个校正项。该校正项涉及对角动量系数倒数的平均值和穿过该面的中心压力梯度。对于单元 $P$ 和 $E$ 之间的东面速度 $u_e$：\n$$ u_e = \\frac{u_P + u_E}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^u} + \\frac{1}{a_E^u} \\right) \\frac{p_E - p_P}{\\Delta x} $$\n校正项上的负号是因为正压力梯度与流动方向相反。通过类比，我们写出其他三个面的表达式：\n西面（$w$），在单元 $W$ 和 $P$ 之间：\n$$ u_w = \\frac{u_W + u_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_W^u} + \\frac{1}{a_P^u} \\right) \\frac{p_P - p_W}{\\Delta x} $$\n北面（$n$），在单元 $P$ 和 $N$ 之间：\n$$ v_n = \\frac{v_P + v_N}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^v} + \\frac{1}{a_N^v} \\right) \\frac{p_N - p_P}{\\Delta y} $$\n南面（$s$），在单元 $S$ 和 $P$ 之间：\n$$ v_s = \\frac{v_S + v_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_S^v} + \\frac{1}{a_P^v} \\right) \\frac{p_P - p_S}{\\Delta y} $$\n现在我们将这些代入 $R_P$ 的表达式中。我们来计算差值 $(u_e - u_w)$ 和 $(v_n - v_s)$。\n对于 $x$ 方向的速度：\n$$ u_e - u_w = \\left[ \\frac{u_P + u_E}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) \\right] - \\left[ \\frac{u_W + u_P}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right] $$\n$$ u_e - u_w = \\frac{u_E - u_W}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\n对于 $y$ 方向的速度：\n$$ v_n - v_s = \\frac{v_N - v_S}{2} - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\n最后，我们将这些差值代回到 $R_P$ 的表达式中：\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\n$$ R_P = \\rho \\left\\{ \\left[ \\frac{u_E - u_W}{2} \\right]\\Delta y + \\left[ \\frac{v_N - v_S}{2} \\right]\\Delta x \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right]\\Delta y \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) \\right]\\Delta x \\right\\} $$\n将 $\\Delta y$ 和 $\\Delta x$ 项分配进去，得到以指定变量表示的残差 $R_P$ 的最终表达式。\n该表达式可以分为两部分：一部分源于简单的速度平均（已知其本身是不稳定的），另一部分源于压力梯度校正，它提供了必要的压力-速度耦合以防止棋盘格振荡。\n稍作整理，按面的贡献对各项进行分组，得到最终形式。\n$$ R_P = \\rho \\left( \\frac{u_E - u_W}{2}\\Delta y + \\frac{v_N - v_S}{2}\\Delta x \\right) $$\n$$ - \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\n$$ - \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\n该表达式代表了所要求的完整的离散连续性残差。",
            "answer": "$$\n\\boxed{\n\\rho\\left[ \\frac{(u_E - u_W)\\Delta y}{2} + \\frac{(v_N - v_S)\\Delta x}{2} \\right] - \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{P}^{u}}+\\frac{1}{a_{E}^{u}}\\right)(p_E-p_P) + \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{W}^{u}}+\\frac{1}{a_{P}^{u}}\\right)(p_P-p_W) - \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{P}^{v}}+\\frac{1}{a_{N}^{v}}\\right)(p_N-p_P) + \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{S}^{v}}+\\frac{1}{a_{P}^{v}}\\right)(p_P-p_S)\n}\n$$"
        },
        {
            "introduction": "在计算流体动力学中，任何数值格式在被采纳之前，都必须经过严格的验证，以确保其遵循基本的物理定律，其中质量守恒是最根本的一条。本练习将使用一种被称为“制造解法”的标准验证技术，在一个封闭域内检验Rhie–Chow格式的全局质量守恒特性。通过完成这个实践，您不仅能学会一种重要的CFD代码验证方法，还能证实Rhie–Chow插值虽然形式更复杂，却能在机器精度范围内精确地保持质量守恒，从而建立对其物理可靠性和数值稳健性的信心。",
            "id": "3939862",
            "problem": "考虑一个二维、稳态、不可压缩的流体，其位于一个封闭的矩形域中，在 $x$ 和 $y$ 方向上的长度分别为 $L_x$ 和 $L_y$。设流体的密度 $\\rho$ 和动力粘度 $\\mu$ 恒定。使用均匀的同位网格，在 $x$ 方向有 $N_x$ 个单元，在 $y$ 方向有 $N_y$ 个单元，其中标量压力 $p$ 和速度分量 $u$、$v$ 存储在单元中心。对离散连续性方程采用有限体积法（FVM），并使用 Rhie–Chow 插值计算面法向质量通量。\n\n基本原理：\n- 不可压缩稳态流的连续性方程为 $\\nabla \\cdot \\mathbf{u} = 0$，其在控制体 $\\Omega$（边界为 $\\partial \\Omega$）上的积分形式为：\n$$\n\\int_{\\partial \\Omega} \\rho \\, \\mathbf{u} \\cdot \\mathbf{n} \\, dA = 0,\n$$\n其中 $\\mathbf{n}$ 是向外的单位法向量，$\\rho$ 为常数。\n- 在有限体积法（FVM）中，单元的离散连续性方程指出，在没有源项的情况下，通过其所有面的质量通量之和为零：\n$$\n\\sum_{f \\in \\text{faces}} F_f = 0,\n$$\n其中 $F_f$ 是通过面 $f$ 的面法向质量通量。\n\n设置与定义：\n- 使用均匀网格，间距为 $ \\Delta x = L_x / N_x $ 和 $ \\Delta y = L_y / N_y $。法向于 $x$ 方向的面的面积为 $A_x = \\Delta y$，法向于 $y$ 方向的面的面积为 $A_y = \\Delta x$。\n- 同位网格将 $p$、$u$ 和 $v$ 存储在单元中心。对于本问题，将单元中心的速度设置为零，$u_{i,j} = 0$ 和 $v_{i,j} = 0$，并定义一个制造压力场\n$$\np(x,y) = \\sin\\left( 2 \\pi x \\right) \\sin\\left( 2 \\pi y \\right),\n$$\n在单元中心 $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$（其中 $i = 0,1,\\dots,N_x-1$）和 $y_j = \\left(j+\\tfrac{1}{2}\\right)\\Delta y$（其中 $j = 0,1,\\dots,N_y-1$）处进行采样。\n- 使用 Rhie–Chow 插值计算面法向质量通量。对于相邻单元 $P$ 和 $N$ 之间的内部面 $f$，$x$ 方向的 Rhie–Chow 面速度为\n$$\nu_f = \\frac{1}{2}\\left( u_P + u_N \\right) - D_f^{(x)} \\left( p_N - p_P \\right),\n$$\n在 $y$ 方向上为\n$$\nv_f = \\frac{1}{2}\\left( v_P + v_N \\right) - D_f^{(y)} \\left( p_N - p_P \\right),\n$$\n其中 $D_f^{(x)}$ 和 $D_f^{(y)}$ 是从动量算子系数导出的修正系数。对每个方向上的单元中心动量系数，使用以下物理上合理、扩散主导的近似：\n$$\na_P^{(x)} = 2 \\mu \\frac{A_x}{\\Delta x} + 2 \\mu \\frac{A_y}{\\Delta y} = 2 \\mu \\frac{\\Delta y}{\\Delta x} + 2 \\mu \\frac{\\Delta x}{\\Delta y},\n$$\n$$\na_P^{(y)} = 2 \\mu \\frac{A_y}{\\Delta y} + 2 \\mu \\frac{A_x}{\\Delta x} = 2 \\mu \\frac{\\Delta x}{\\Delta y} + 2 \\mu \\frac{\\Delta y}{\\Delta x}.\n$$\n在面 $f$ 上，使用相邻单元系数的调和平均值计算有效动量系数，例如，对于 $x$ 方向的面，\n$$\na_f^{(x)} = \\left( \\frac{1}{2} \\left( \\frac{1}{a_P^{(x)}(P)} + \\frac{1}{a_P^{(x)}(N)} \\right) \\right)^{-1}.\n$$\n定义 Rhie–Chow 修正系数\n$$\nD_f^{(x)} = \\frac{A_x}{a_f^{(x)} \\Delta x} = \\frac{\\Delta y}{a_f^{(x)} \\Delta x}, \\quad D_f^{(y)} = \\frac{A_y}{a_f^{(y)} \\Delta y} = \\frac{\\Delta x}{a_f^{(y)} \\Delta y}.\n$$\n最后，面法向质量通量对于垂直面为 $F_f^{(x)} = \\rho \\, u_f \\, A_x = \\rho \\, u_f \\, \\Delta y$，对于水平面为 $F_f^{(y)} = \\rho \\, v_f \\, A_y = \\rho \\, v_f \\, \\Delta x$。\n\n边界条件：\n- 该域是封闭的，具有无穿透边界。将跨越域边界的质量通量设置为零：\n$$\nF_f^{(x)} = 0 \\quad \\text{on } i = 0 \\text{ and } i = N_x, \\quad F_f^{(y)} = 0 \\quad \\text{on } j = 0 \\text{ and } j = N_y.\n$$\n\n离散连续性残差：\n- 对于每个单元 $(i,j)$，将离散连续性残差定义为\n$$\nR_{i,j} = \\frac{ F^{(x)}_{i+1,j} - F^{(x)}_{i,j} + F^{(y)}_{i,j+1} - F^{(y)}_{i,j} }{ \\Delta x \\Delta y }.\n$$\n全局质量残差 $R_{\\text{global}}$ 是所有单元的残差乘以单元面积后的总和：\n$$\nR_{\\text{global}} = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} R_{i,j} \\, \\Delta x \\Delta y.\n$$\n在具有一致面通量的封闭域中，内部面的贡献会伸缩相消，因此 $R_{\\text{global}}$ 等于净边界质量通量，在精确算术中其值为零。\n\n任务：\n- 实现上述方案，为测试套件中的每组参数计算 $R_{\\text{global}}$。以千克/秒 (kg/s) 为单位量化其绝对值 $|R_{\\text{global}}|$。由于有限精度算术，期望值应等于或低于机器精度乘以一个特征通量尺度。\n\n测试套件：\n- 使用以下参数集，每组参数指定为 $(N_x,N_y,L_x,L_y,\\rho,\\mu)$：\n    1. $(4,4,1.0,1.0,1.0,1.0)$\n    2. $(16,16,1.0,1.0,1000.0,1.0 \\times 10^{-3})$\n    3. $(31,19,2.0,1.0,1.2,1.8 \\times 10^{-5})$\n    4. $(1,1,1.0,1.0,1000.0,1.0)$\n    5. $(64,64,1.0,1.0,1000.0,1.0 \\times 10^{8})$\n\n输出规格：\n- 你的程序应生成单行输出，其中包含五个测试用例的绝对全局质量残差，格式为逗号分隔的列表并用方括号括起来，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是一个以千克/秒 (kg/s) 为单位的浮点数。",
            "solution": "该问题是计算流体动力学（CFD）领域中一个适定的数值验证任务。它在科学上基于用于不可压缩流的有限体积法（FVM），并测试了 Rhie–Chow 插值方案在同位网格上的质量守恒特性。该问题提供了计算唯一、可量化结果所需的所有方程、参数和边界条件，该结果是针对一个制造流场景的全局质量残差。问题设置是自洽且无矛盾的。因此，该问题是有效的，并且可以推导出解。\n\n求解过程通过实现指定的数值算法来进行。核心任务是为一系列测试用例计算全局质量残差 $R_{\\text{global}}$。由于问题的设置（一个具有零边界通量的封闭域），$R_{\\text{global}}$ 的解析值为零，因此计算结果量化了浮点运算过程中累积的数值误差。\n\n**步骤 1：离散化与网格设置**\n\n对于每个测试用例，给定单元数 $N_x$ 和 $N_y$、域长度 $L_x$ 和 $L_y$、流体密度 $\\rho$ 以及动力粘度 $\\mu$。根据这些，我们定义均匀网格间距：\n$$\n\\Delta x = \\frac{L_x}{N_x}, \\quad \\Delta y = \\frac{L_y}{N_y}\n$$\n同位网格将所有变量存储在单元中心。单元 $(i,j)$ 中心的坐标由下式给出：\n$$\nx_i = \\left(i+\\frac{1}{2}\\right)\\Delta x, \\quad \\text{for } i = 0, 1, \\dots, N_x-1\n$$\n$$\ny_j = \\left(j+\\frac{1}{2}\\right)\\Delta y, \\quad \\text{for } j = 0, 1, \\dots, N_y-1\n$$\n\n**步骤 2：定义指定场**\n\n在整个域上定义一个制造压力场，并在单元中心进行采样：\n$$\np_{i,j} = p(x_i, y_j) = \\sin(2 \\pi x_i) \\sin(2 \\pi y_j)\n$$\n指定整个域内的单元中心速度为零：\n$$\nu_{i,j} = 0, \\quad v_{i,j} = 0 \\quad \\text{for all } i,j\n$$\n\n**步骤 3：计算 Rhie–Chow 系数**\n\nRhie–Chow 插值需要从动量方程导出的系数。问题为单元中心动量系数 $a_P$ 提供了一个扩散主导的近似。由于网格是均匀的，该系数对所有单元都是常数：\n$$\na_P = a_P^{(x)} = a_P^{(y)} = 2 \\mu \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\n基于面的系数 $a_f$ 使用调和平均值计算。对于均匀网格和恒定属性，这简化为 $a_f = a_P$。\n\nRhie–Chow 修正系数 $D_f^{(x)}$ 和 $D_f^{(y)}$ 用于建立压力-速度耦合。对于所有内部面，它们也是常数：\n$$\nD^{(x)} = \\frac{\\Delta y}{a_f \\Delta x} = \\frac{\\Delta y}{a_P \\Delta x}\n$$\n$$\nD^{(y)} = \\frac{\\Delta x}{a_f \\Delta y} = \\frac{\\Delta x}{a_P \\Delta y}\n$$\n\n**步骤 4：计算面质量通量**\n\n使用 Rhie–Chow 插值的面法向速度由下式给出：\n$$\nu_f = \\frac{1}{2}\\left( u_P + u_N \\right) - D_f^{(x)} \\left( p_N - p_P \\right)\n$$\n$$\nv_f = \\frac{1}{2}\\left( v_P + v_N \\right) - D_f^{(y)} \\left( p_N - p_P \\right)\n$$\n由于所有单元中心速度（$u_P, u_N, v_P, v_N$）均为零，表达式简化为：\n$$\nu_f = - D^{(x)} \\left( p_N - p_P \\right)\n$$\n$$\nv_f = - D^{(y)} \\left( p_N - p_P \\right)\n$$\n然后计算通过内部面的质量通量。对于单元 $(i-1,j)$ 和 $(i,j)$ 之间的垂直面，通量为：\n$$\nF^{(x)}_{i,j} = \\rho \\, u_f \\, A_x = \\rho \\left( -D^{(x)} (p_{i,j} - p_{i-1,j}) \\right) \\Delta y\n$$\n对于单元 $(i,j-1)$ 和 $(i,j)$ 之间的水平面，通量为：\n$$\nF^{(y)}_{i,j} = \\rho \\, v_f \\, A_y = \\rho \\left( -D^{(y)} (p_{i,j} - p_{i,j-1}) \\right) \\Delta x\n$$\n边界条件声明该域是封闭的，因此域边界上的所有通量均为零：\n$$\nF^{(x)}_{0,j} = F^{(x)}_{N_x,j} = 0 \\quad \\text{for all } j\n$$\n$$\nF^{(y)}_{i,0} = F^{(y)}_{i,N_y} = 0 \\quad \\text{for all } i\n$$\n\n**步骤 5：计算全局质量残差**\n\n全局质量残差 $R_{\\text{global}}$ 是所有单元的净质量通量之和：\n$$\nR_{\\text{global}} = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left( F^{(x)}_{i+1,j} - F^{(x)}_{i,j} + F^{(y)}_{i,j+1} - F^{(y)}_{i,j} \\right)\n$$\n这是一个伸缩求和。在精确算术中，内部面通量相互抵消，只剩下域边界上的通量之和：\n$$\nR_{\\text{global}} = \\sum_{j=0}^{N_y-1} \\left( F^{(x)}_{N_x,j} - F^{(x)}_{0,j} \\right) + \\sum_{i=0}^{N_x-1} \\left( F^{(y)}_{i,N_y} - F^{(y)}_{i,0} \\right)\n$$\n由于所有边界通量都设置为零，$R_{\\text{global}}$ 的精确解析值为 $0$。使用有限精度浮点算术的计算会因抵消误差而产生一个小的非零值。任务是计算这个数值残差并报告其绝对值 $|R_{\\text{global}}|$。\n\n实现将首先计算压力场，然后计算常系数 $a_P$、$D^{(x)}$ 和 $D^{(y)}$。接着，它将计算所有内部质量通量并将它们存储在数组中。最后，它将对每个单元的净通量求和以找到全局残差。对于 $N_x=1$ 和 $N_y=1$ 的特殊情况，没有内部面，所有通量都是边界通量，其值为零。因此，残差精确为 $0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_residual(Nx, Ny, Lx, Ly, rho, mu):\n    \"\"\"\n    Computes the absolute global mass residual for a 2D steady, incompressible\n    flow problem using Rhie-Chow interpolation on a collocated grid.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        Lx (float): Length of the domain in the x-direction.\n        Ly (float): Length of the domain in the y-direction.\n        rho (float): Fluid density.\n        mu (float): Fluid dynamic viscosity.\n\n    Returns:\n        float: The absolute value of the global mass residual in kg/s.\n    \"\"\"\n    # 1. Grid parameters\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # If there are no internal faces (single cell), boundary fluxes are zero,\n    # so the global residual is exactly zero. The general logic below also\n    # correctly handles this case, but this check is a clear statement.\n    if Nx == 1 and Ny == 1:\n        return 0.0\n\n    # 2. Cell-centered momentum coefficient (constant for uniform grid)\n    # The problem statement guarantees mu > 0 for all test cases.\n    a_P = 2.0 * mu * (dy / dx + dx / dy)\n    \n    # 3. Rhie-Chow correction coefficients (constant for all internal faces)\n    D_x = dy / (a_P * dx)\n    D_y = dx / (a_P * dy)\n\n    # 4. Generate pressure field at cell centers\n    x_coords = (np.arange(Nx) + 0.5) * dx\n    y_coords = (np.arange(Ny) + 0.5) * dy\n    X, Y = np.meshgrid(x_coords, y_coords, indexing='ij')\n    p = np.sin(2.0 * np.pi * X) * np.sin(2.0 * np.pi * Y)\n\n    # 5. Compute face mass fluxes\n    # Initialize flux arrays. Boundary fluxes are zero by problem definition.\n    Fx = np.zeros((Nx + 1, Ny))\n    Fy = np.zeros((Nx, Ny + 1))\n\n    # Compute internal x-direction mass fluxes.\n    # Velocity is u_face = -D_x * (p_N - p_P). Flux is rho * u_face * Area_x.\n    # p_N is cell (i,j), p_P is cell (i-1,j), so dp = p[i,j] - p[i-1,j].\n    if Nx > 1:\n        dp_x = p[1:, :] - p[:-1, :]\n        u_face_internal = -D_x * dp_x\n        # Fluxes correspond to Fx[1:Nx, :]\n        Fx[1:Nx, :] = rho * u_face_internal * dy\n\n    # Compute internal y-direction mass fluxes.\n    # Velocity is v_face = -D_y * (p_N - p_P). Flux is rho * v_face * Area_y.\n    # p_N is cell (i,j), p_P is cell (i,j-1), so dp = p[i,j] - p[i,j-1].\n    if Ny > 1:\n        dp_y = p[:, 1:] - p[:, :-1]\n        v_face_internal = -D_y * dp_y\n        # Fluxes correspond to Fy[:, 1:Ny]\n        Fy[:, 1:Ny] = rho * v_face_internal * dx\n\n    # 6. Compute the global mass residual\n    # R_global = sum_{i,j} ( Fx[i+1,j] - Fx[i,j] + Fy[i,j+1] - Fy[i,j] )\n    # This sum telescopes to the sum of boundary fluxes, which is 0 in exact\n    # arithmetic. The non-zero result comes from floating-point errors.\n    \n    # Calculate net flux for each cell\n    net_flux_x_per_cell = Fx[1:, :] - Fx[:-1, :] # Shape (Nx, Ny)\n    net_flux_y_per_cell = Fy[:, 1:] - Fy[:, :-1] # Shape (Nx, Ny)\n\n    # Sum the net fluxes over all cells to get the global residual\n    net_flux_per_cell = net_flux_x_per_cell + net_flux_y_per_cell\n    R_global = np.sum(net_flux_per_cell)\n\n    return abs(R_global)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, Lx, Ly, rho, mu)\n        (4, 4, 1.0, 1.0, 1.0, 1.0),\n        (16, 16, 1.0, 1.0, 1000.0, 1.0e-3),\n        (31, 19, 2.0, 1.0, 1.2, 1.8e-5),\n        (1, 1, 1.0, 1.0, 1000.0, 1.0),\n        (64, 64, 1.0, 1.0, 1000.0, 1.0e8)\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, Lx, Ly, rho, mu = case\n        residual = compute_residual(Nx, Ny, Lx, Ly, rho, mu)\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}