{
    "hands_on_practices": [
        {
            "introduction": "The primary challenge of using a collocated grid arrangement is the potential for pressure-velocity decoupling. This practice provides a direct, quantitative demonstration of this phenomenon. By implementing a simple test case with a \"checkerboard\" pressure field, you will see how a naive interpolation of velocities fails to register these unphysical pressure oscillations, and how the Rhie-Chow interpolation successfully restores the necessary coupling to suppress them . This exercise is fundamental to appreciating *why* such specialized interpolation techniques are indispensable in modern CFD.",
            "id": "3939869",
            "problem": "Consider a two-dimensional, incompressible, steady flow on a uniform, collocated grid, where velocity components and pressure are stored at cell centers. The governing equations are the continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and the momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$, with constant density $\\rho$ and dynamic viscosity $\\mu$. In Computational Fluid Dynamics (CFD), it is well known that collocated grids can exhibit spurious pressure oscillations (checkerboarding) unless a stabilization such as the Rhie–Chow interpolation is applied. Your task is to construct a simple discrete test that demonstrates how pressure oscillations arise on a collocated grid without Rhie–Chow interpolation, even when exact uniform boundary conditions are enforced.\n\nFundamental base and discrete setting:\n- Use a uniform, Cartesian grid of size $N_x \\times N_y$, with uniform spacing $\\Delta x = 1$ and $\\Delta y = 1$, and periodic boundary conditions in both directions. Periodic boundaries represent exact continuation of a uniform solution.\n- Assume a base uniform velocity field $\\tilde{u} = U_0$ and $\\tilde{v} = 0$, and a base pressure $p_0$ (constant). All quantities are dimensionless (unitless).\n- Introduce a small, dimensionless checkerboard pressure perturbation of amplitude $\\varepsilon$, superimposed on $p_0$:\n$$\np_{i,j} = p_0 + \\varepsilon (-1)^{i+j},\n$$\nfor cell indices $i \\in \\{0,1,\\dots,N_x-1\\}$ and $j \\in \\{0,1,\\dots,N_y-1\\}$. With periodic boundaries and even $N_x, N_y$, this perturbation is consistent and the base uniform solution remains exact at the boundaries.\n\nDiscrete gradient, velocity update, and face interpolation:\n- Compute the discrete cell-centered pressure gradients using second-order central differences (with periodic wrap):\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y}.\n$$\n- Define a dimensionless momentum diagonal coefficient $a_m > 0$ that represents the strength of the implicit momentum operator (the inverse of which scales the pressure-gradient contribution to velocity). Update the cell-centered velocities due to pressure as\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}.\n$$\n\nTwo face-interpolation strategies:\n1. Without Rhie–Chow interpolation (naive collocated interpolation):\n   - Compute face velocities by linear interpolation of neighboring cell-centered velocities:\n   $$\n   u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n   $$\n   $$\n   v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n   $$\n   - Compute the discrete divergence at each cell using face differences:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}.\n   $$\n2. With Rhie–Chow interpolation (stabilized collocated interpolation):\n   - Define the face momentum coefficient $a_f = a_m$.\n   - Augment face velocities with a pressure-difference term across the face:\n   $$\n   u_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n   u_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x},\n   $$\n   $$\n   v_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}, \\quad\n   v_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n   $$\n   - Compute the discrete divergence:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y}.\n   $$\n\nQuantitative measure:\n- For each strategy, compute the global discrete $L^2$ norm of the divergence:\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2 = \\left( \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left[ (\\nabla \\cdot \\mathbf{u})_{i,j} \\right]^2 \\right)^{1/2}.\n$$\n- Demonstrate that, for the checkerboard perturbation and periodic boundaries, the naive collocated interpolation yields $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ numerically equal to $0$ (or at machine precision), while the Rhie–Chow interpolation yields a strictly positive $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ proportional to $\\varepsilon$.\n\nTest suite:\n- Use the following parameter sets $(N_x,N_y,U_0,a_m,\\varepsilon)$, all dimensionless:\n  1. $(4,4,1.0,1.0,10^{-3})$\n  2. $(16,16,0.5,1.0,10^{-3})$\n  3. $(8,8,0.0,2.0,10^{-6})$\n  4. $(6,10,3.0,0.5,10^{-4})$\n\nProgram requirements:\n- Implement the above discrete operations with periodic boundary conditions and the two face-interpolation strategies.\n- For each test case, compute and record a pair of floats $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets of these pairs, for example, $[[a,b],[c,d],[e,f],[g,h]]$ where each letter is a float.\n\nAll quantities are dimensionless, so no physical units are required in the output. Angles do not appear. Percentages are not used.",
            "solution": "We begin from the incompressible continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and steady momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$. On a collocated grid, velocities $\\mathbf{u}$ and pressure $p$ are stored at the same locations (cell centers). For steady uniform flow with periodic boundaries, an exact solution is $\\mathbf{u} = (U_0, 0)$ and $p = p_0$ constant. We consider a superimposed checkerboard pressure perturbation $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$ to study the numerical response of face-interpolation schemes.\n\nDiscretization choices:\n- We adopt a uniform grid with $\\Delta x = \\Delta y = 1$, periodic boundary conditions, and central differences for cell-centered pressure gradients:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2}.\n$$\nWith the checkerboard pattern and even $N_x,N_y$, we note $p_{i+1,j} - p_0 = -(p_{i,j} - p_0)$ and $p_{i-1,j} - p_0 = -(p_{i,j} - p_0)$. Thus,\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{ (p_0 - (p_{i,j} - p_0)) - (p_0 - (p_{i,j} - p_0)) }{2} = 0, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = 0.\n$$\nHence, the cell-centered velocities updated by the pressure gradient,\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j},\n$$\nsimplify to $u_{i,j} = \\tilde{u} = U_0$ and $v_{i,j} = \\tilde{v} = 0$ everywhere, despite the pressure oscillations.\n\nNaive collocated face interpolation:\n- The naive strategy interpolates cell-centered velocities to faces linearly:\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n$$\n$$\nv_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n$$\nSince $u_{i,j} = U_0$ is constant and $v_{i,j} = 0$ is constant, we have $u_{e,i,j} = u_{w,i,j} = U_0$ and $v_{n,i,j} = v_{s,i,j} = 0$. Therefore, the discrete divergence\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = (u_{e,i,j} - u_{w,i,j}) + (v_{n,i,j} - v_{s,i,j}) = 0,\n$$\nfor all cells. The global $L^2$ norm $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$ is identically $0$. This reveals the decoupling: the checkerboard pressure oscillation does not induce any corrective mass flux at faces, so the continuity equation is blind to it, allowing spurious pressure modes to persist.\n\nRhie–Chow interpolation:\n- Rhie–Chow interpolation modifies face velocities by adding a pressure-difference term that uses face-centered pressure differences rather than cell-centered gradients:\n$$\nu_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} (p_{i+1,j} - p_{i,j}), \\quad\nu_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i-1,j}),\n$$\n$$\nv_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} (p_{i,j+1} - p_{i,j}), \\quad\nv_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i,j-1}).\n$$\nHere we set $a_f = a_m$ to simplify. The resulting discrete divergence is\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\left[ \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y} \\right].\n$$\nWith $\\Delta x = \\Delta y = 1$ and $u_{i,j} = U_0$, $v_{i,j} = 0$, the uniform parts cancel, leaving the pressure contribution:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[(p_{i+1,j} - p_{i,j}) - (p_{i,j} - p_{i-1,j}) + (p_{i,j+1} - p_{i,j}) - (p_{i,j} - p_{i,j-1})\\right].\n$$\nRearranging,\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ p_{i+1,j} + p_{i-1,j} - 2 p_{i,j} + p_{i,j+1} + p_{i,j-1} - 2 p_{i,j} \\right].\n$$\nThis is the discrete $5$-point Laplacian of $p$ multiplied by $-1/a_f$. Let's analyze its effect on the checkerboard pattern $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$. The discrete Laplacian of a constant $p_0$ is zero. For the oscillatory part, let $p'_{i,j} = \\varepsilon(-1)^{i+j}$. We note that $p'_{i\\pm 1,j} = -p'_{i,j}$ and $p'_{i,j\\pm 1} = -p'_{i,j}$. Therefore, the Laplacian applied to $p'_{i,j}$ is:\n$$\n(p'_{i+1,j} + p'_{i-1,j} - 2p'_{i,j}) + (p'_{i,j+1} + p'_{i,j-1} - 2p'_{i,j}) = (-p'_{i,j} - p'_{i,j} - 2p'_{i,j}) + (-p'_{i,j} - p'_{i,j} - 2p'_{i,j}) = -8p'_{i,j}.\n$$\nThus, the divergence is:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ -8 p'_{i,j} \\right] = \\frac{8 p'_{i,j}}{a_f} = \\frac{8 \\varepsilon}{a_m} (-1)^{i+j}.\n$$\nThe global $L^2$ norm is\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} \\right]^2 \\right)^{1/2} = \\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}.\n$$\nThis nonzero norm quantifies the Rhie–Chow interpolation’s ability to convert the checkerboard pressure oscillation into face flux corrections that do not vanish in the discrete continuity, thereby suppressing the spurious mode.\n\nAlgorithmic design:\n- Implement periodic indexing for central differences and face interpolations.\n- Compute $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}$ and $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}$ with central differences.\n- Update $u_{i,j}$ and $v_{i,j}$ using $a_m$.\n- Compute naive face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$.\n- Compute Rhie–Chow face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$.\n- For the provided test suite $(N_x,N_y,U_0,a_m,\\varepsilon)$, record pairs $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- The expected qualitative outcome is that $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}} \\approx 0$ for all cases (to machine precision), while $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$ scales as $\\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}$.\n\nThis demonstration uses fundamental laws and standard central-difference discretizations to reveal the collocated-grid decoupling mechanism and shows how Rhie–Chow interpolation restores coupling between pressure and mass flux at faces, eliminating the checkerboard null space.",
            "answer": "```python\nimport numpy as np\n\ndef periodic_index(i, n):\n    # Return periodic index\n    return i % n\n\ndef compute_gradients(p):\n    nx, ny = p.shape\n    dpdx = np.zeros_like(p)\n    dpdy = np.zeros_like(p)\n    # Central differences with periodic wrap, dx = dy = 1\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            dpdx[i, j] = 0.5 * (p[ip, j] - p[im, j])\n            dpdy[i, j] = 0.5 * (p[i, jp] - p[i, jm])\n    return dpdx, dpdy\n\ndef interpolate_faces_naive(u, v):\n    nx, ny = u.shape\n    # Face velocities at cell i,j: east, west, north, south\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef interpolate_faces_rc(u, v, p, a_f):\n    nx, ny = u.shape\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            # dx = dy = 1\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j]) - (1.0 / a_f) * (p[ip, j] - p[i, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j]) - (1.0 / a_f) * (p[i, j] - p[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp]) - (1.0 / a_f) * (p[i, jp] - p[i, j])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm]) - (1.0 / a_f) * (p[i, j] - p[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef divergence_from_faces(u_e, u_w, v_n, v_s):\n    # dx = dy = 1\n    return (u_e - u_w) + (v_n - v_s)\n\ndef l2_norm(field):\n    return np.sqrt(np.sum(field**2))\n\ndef run_case(nx, ny, U0, a_m, eps):\n    # Construct checkerboard pressure with periodic consistency\n    i_idx = np.arange(nx).reshape(nx, 1)\n    j_idx = np.arange(ny).reshape(1, ny)\n    checker = ((i_idx + j_idx) % 2) * 2 - 1  # values in {-1, +1}\n    p0 = 0.0\n    p = p0 + eps * checker\n\n    # Base velocities\n    u_tilde = np.full((nx, ny), U0)\n    v_tilde = np.zeros((nx, ny))\n\n    # Cell-centered gradients\n    dpdx, dpdy = compute_gradients(p)\n\n    # Update cell-centered velocities\n    u = u_tilde - (1.0 / a_m) * dpdx\n    v = v_tilde - (1.0 / a_m) * dpdy\n\n    # Naive face interpolation and divergence\n    u_e, u_w, v_n, v_s = interpolate_faces_naive(u, v)\n    div_naive = divergence_from_faces(u_e, u_w, v_n, v_s)\n    norm_naive = l2_norm(div_naive)\n\n    # Rhie–Chow face interpolation and divergence\n    u_e_rc, u_w_rc, v_n_rc, v_s_rc = interpolate_faces_rc(u, v, p, a_m)\n    div_rc = divergence_from_faces(u_e_rc, u_w_rc, v_n_rc, v_s_rc)\n    norm_rc = l2_norm(div_rc)\n\n    return [float(norm_naive), float(norm_rc)]\n\ndef solve():\n    test_cases = [\n        (4, 4, 1.0, 1.0, 1e-3),\n        (16, 16, 0.5, 1.0, 1e-3),\n        (8, 8, 0.0, 2.0, 1e-6),\n        (6, 10, 3.0, 0.5, 1e-4),\n    ]\n\n    results = []\n    for nx, ny, U0, a_m, eps in test_cases:\n        results.append(run_case(nx, ny, U0, a_m, eps))\n\n    # Print nested list of [norm_naive, norm_rc] for each case\n    # Ensure single-line output format exactly as specified.\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "After observing the problem of decoupling, it is essential to understand the mathematical mechanics of the solution. This practice guides you through the analytical derivation of the discrete continuity equation on a collocated grid when using Rhie-Chow interpolation . By starting from the integral conservation law and applying the specific Rhie-Chow flux definition, you will construct the final algebraic equation, revealing precisely how pressure differences between adjacent cells are incorporated to ensure stability. This derivation forms the theoretical backbone of pressure-based solvers using this method.",
            "id": "3939855",
            "problem": "Consider a two-dimensional, steady, incompressible, constant-density flow solved by the Finite Volume Method (FVM) on a uniform collocated grid. On each control volume $\\Omega_{P}$, the primary unknowns are the Cartesian velocity components $u$ and $v$ and the pressure $p$, all stored at the cell center. Let the cell dimensions be $\\Delta x$ in the $x$-direction and $\\Delta y$ in the $y$-direction, so the face areas are $A_{e} = \\Delta y$, $A_{w} = \\Delta y$, $A_{n} = \\Delta x$, and $A_{s} = \\Delta x$. Denote by $E$, $W$, $N$, and $S$ the east, west, north, and south neighbor cells, respectively, of cell $P$. Let $\\rho$ denote the constant density. Let the outward unit normals on the faces of $\\Omega_{P}$ be $\\mathbf{n}_{e} = (1,0)$, $\\mathbf{n}_{w} = (-1,0)$, $\\mathbf{n}_{n} = (0,1)$, and $\\mathbf{n}_{s} = (0,-1)$.\n\nBegin from the integral form of the continuity equation for incompressible flow, $\\int_{\\Omega_{P}} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0$, and use the Divergence Theorem and the control-volume face partition to express mass conservation as the sum of face-normal mass fluxes being zero. On a collocated grid, adopt Rhie–Chow interpolation to compute the face-normal velocities. In this setting, assume each component of the cell-centered velocity is related to the cell-centered pressure gradient by a linearized steady momentum balance whose diagonal coefficients are denoted $a_{P}^{u}$ for the $u$-momentum equation and $a_{P}^{v}$ for the $v$-momentum equation, and likewise $a_{E}^{u}$, $a_{W}^{u}$, $a_{N}^{v}$, and $a_{S}^{v}$ for the respective neighbors. Use a face interpolation that is consistent with these discrete momentum relations: approximate each face-normal velocity by an arithmetic average of adjacent cell-centered velocities corrected by an arithmetic average of the inverse diagonal momentum coefficients multiplying the centered finite-difference pressure gradient across the face. Specifically, for the east and west faces use the $x$-component ($u$) and for the north and south faces use the $y$-component ($v$). The mass flux at each face is the product of density, face area, and the face-normal velocity, with the sign consistent with the outward normal.\n\nDerive, in closed form, the discrete continuity residual $R_{P}$ defined as the algebraic sum of the four outward face mass fluxes on $\\Omega_{P}$, expressed entirely in terms of $\\rho$, $\\Delta x$, $\\Delta y$, the cell-centered variables $u_{P}$, $u_{E}$, $u_{W}$, $v_{P}$, $v_{N}$, $v_{S}$, the pressures $p_{P}$, $p_{E}$, $p_{W}$, $p_{N}$, $p_{S}$, and the diagonal momentum coefficients $a_{P}^{u}$, $a_{E}^{u}$, $a_{W}^{u}$, $a_{P}^{v}$, $a_{N}^{v}$, $a_{S}^{v}$. Your derivation must start from the stated integral continuity law and proceed through physically consistent discretizations and the Rhie–Chow interpolation concept. Report the final symbolic expression for $R_{P}$. Do not substitute any numerical values. Do not include units in your final expression.",
            "solution": "The derivation proceeds as follows.\nFirst, we start with the integral form of the continuity equation over a control volume $\\Omega_P$:\n$$ \\int_{\\Omega_P} \\nabla \\cdot \\mathbf{u} \\,\\mathrm{d}\\Omega = 0 $$\nApplying the Divergence Theorem, we convert the volume integral into a surface integral over the boundary $\\partial\\Omega_P$:\n$$ \\int_{\\partial\\Omega_P} \\mathbf{u} \\cdot \\mathbf{n} \\,\\mathrm{d}S = 0 $$\nThe boundary is partitioned into four faces: east ($e$), west ($w$), north ($n$), and south ($s$). Assuming uniform properties on each face, the integral becomes an algebraic sum of volume fluxes:\n$$ (\\mathbf{u}_e \\cdot \\mathbf{n}_e) A_e + (\\mathbf{u}_w \\cdot \\mathbf{n}_w) A_w + (\\mathbf{u}_n \\cdot \\mathbf{n}_n) A_n + (\\mathbf{u}_s \\cdot \\mathbf{n}_s) A_s = 0 $$\nUsing the given outward unit normals $\\mathbf{n}_e=(1,0)$, $\\mathbf{n}_w=(-1,0)$, $\\mathbf{n}_n=(0,1)$, $\\mathbf{n}_s=(0,-1)$, and defining the face-normal velocities $u_e$, $u_w$, $v_n$, $v_s$ as the velocity components in the positive coordinate directions at the respective face centers, the volume conservation equation is:\n$$ u_e A_e - u_w A_w + v_n A_n - v_s A_s = 0 $$\nThe discrete continuity residual, $R_P$, is defined as the net outward mass flux from the control volume. For a fluid of constant density $\\rho$, this is:\n$$ R_P = \\rho (u_e A_e - u_w A_w + v_n A_n - v_s A_s) $$\nSubstituting the given face areas $A_e = A_w = \\Delta y$ and $A_n = A_s = \\Delta x$:\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\nNext, we express the face-normal velocities using the prescribed Rhie–Chow interpolation scheme. For each face, the velocity is the arithmetic average of the adjacent cell-centered velocities, plus a correction term. The correction involves the average of the inverse diagonal momentum coefficients and the centered pressure gradient across the face. For the east face velocity $u_e$, between cells $P$ and $E$:\n$$ u_e = \\frac{u_P + u_E}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^u} + \\frac{1}{a_E^u} \\right) \\frac{p_E - p_P}{\\Delta x} $$\nThe negative sign on the correction term is due to the fact that a positive pressure gradient opposes the flow. By analogy, we write the expressions for the other three faces:\nWest face ($w$), between cells $W$ and $P$:\n$$ u_w = \\frac{u_W + u_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_W^u} + \\frac{1}{a_P^u} \\right) \\frac{p_P - p_W}{\\Delta x} $$\nNorth face ($n$), between cells $P$ and $N$:\n$$ v_n = \\frac{v_P + v_N}{2} - \\frac{1}{2} \\left( \\frac{1}{a_P^v} + \\frac{1}{a_N^v} \\right) \\frac{p_N - p_P}{\\Delta y} $$\nSouth face ($s$), between cells $S$ and $P$:\n$$ v_s = \\frac{v_S + v_P}{2} - \\frac{1}{2} \\left( \\frac{1}{a_S^v} + \\frac{1}{a_P^v} \\right) \\frac{p_P - p_S}{\\Delta y} $$\nNow we substitute these into the expression for $R_P$. Let's compute the differences $(u_e - u_w)$ and $(v_n - v_s)$.\nFor the $x$-direction velocities:\n$$ u_e - u_w = \\left[ \\frac{u_P + u_E}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) \\right] - \\left[ \\frac{u_W + u_P}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right] $$\n$$ u_e - u_w = \\frac{u_E - u_W}{2} - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\nFor the $y$-direction velocities:\n$$ v_n - v_s = \\frac{v_N - v_S}{2} - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\nFinally, we substitute these differences back into the expression for $R_P$:\n$$ R_P = \\rho \\left[ (u_e - u_w)\\Delta y + (v_n - v_s)\\Delta x \\right] $$\n$$ R_P = \\rho \\left\\{ \\left[ \\frac{u_E - u_W}{2} \\right]\\Delta y + \\left[ \\frac{v_N - v_S}{2} \\right]\\Delta x \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) - \\frac{1}{2\\Delta x}\\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) \\right]\\Delta y \\right. $$\n$$ \\left. - \\left[ \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) - \\frac{1}{2\\Delta y}\\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) \\right]\\Delta x \\right\\} $$\nDistributing the $\\Delta y$ and $\\Delta x$ terms gives the final expression for the residual $R_P$ in terms of the specified variables. The expression can be separated into two parts: a part derived from simple velocity averaging which is known to be unstable on its own, and a part from the pressure-gradient correction which provides the necessary pressure-velocity coupling to prevent checkerboard oscillations.\nRearranging slightly to group terms by face contributions yields the final form.\n$$ R_P = \\rho \\left( \\frac{u_E - u_W}{2}\\Delta y + \\frac{v_N - v_S}{2}\\Delta x \\right) $$\n$$ - \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_P^u}+\\frac{1}{a_E^u}\\right)(p_E - p_P) + \\rho \\frac{\\Delta y}{2\\Delta x} \\left(\\frac{1}{a_W^u}+\\frac{1}{a_P^u}\\right)(p_P - p_W) $$\n$$ - \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_P^v}+\\frac{1}{a_N^v}\\right)(p_N - p_P) + \\rho \\frac{\\Delta x}{2\\Delta y} \\left(\\frac{1}{a_S^v}+\\frac{1}{a_P^v}\\right)(p_P - p_S) $$\nThis expression represents the complete discrete continuity residual as requested.",
            "answer": "$$\n\\boxed{\n\\rho\\left[ \\frac{(u_E - u_W)\\Delta y}{2} + \\frac{(v_N - v_S)\\Delta x}{2} \\right] - \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{P}^{u}}+\\frac{1}{a_{E}^{u}}\\right)(p_E-p_P) + \\rho\\frac{\\Delta y}{2\\Delta x}\\left(\\frac{1}{a_{W}^{u}}+\\frac{1}{a_{P}^{u}}\\right)(p_P-p_W) - \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{P}^{v}}+\\frac{1}{a_{N}^{v}}\\right)(p_N-p_P) + \\rho\\frac{\\Delta x}{2\\Delta y}\\left(\\frac{1}{a_{S}^{v}}+\\frac{1}{a_{P}^{v}}\\right)(p_P-p_S)\n}\n$$"
        },
        {
            "introduction": "A critical test for any valid numerical scheme in fluid mechanics is its adherence to fundamental physical laws, such as the conservation of mass. This hands-on practice focuses on verifying this property for the Rhie-Chow scheme within a closed system . You will implement a manufactured solution test to demonstrate that while the interpolation adds corrective terms to the face fluxes, the global mass balance is perfectly maintained up to machine precision. This exercise highlights a key feature of a well-designed finite volume method and builds confidence in the robustness of the Rhie-Chow approach.",
            "id": "3939862",
            "problem": "Consider a two-dimensional, steady, incompressible fluid in a closed rectangular domain with lengths $L_x$ and $L_y$ in the $x$ and $y$ directions, respectively. Let the fluid have constant density $\\rho$ and dynamic viscosity $\\mu$. Use a uniform, collocated grid with $N_x$ cells in the $x$-direction and $N_y$ cells in the $y$-direction, where scalar pressure $p$ and velocity components $u$ and $v$ are stored at cell centers. Employ the Finite Volume Method (FVM) for the discrete continuity equation, and compute face-normal mass fluxes using Rhie–Chow interpolation.\n\nFundamental base:\n- The continuity equation for incompressible steady flow is $\\nabla \\cdot \\mathbf{u} = 0$, and in integral form over a control volume $\\Omega$ with boundary $\\partial \\Omega$,\n$$\n\\int_{\\partial \\Omega} \\rho \\, \\mathbf{u} \\cdot \\mathbf{n} \\, dA = 0,\n$$\nwhere $\\mathbf{n}$ is the outward unit normal vector and $\\rho$ is constant.\n- In the Finite Volume Method (FVM), the discrete continuity for a cell states that the sum of mass fluxes through its faces is zero in the absence of sources:\n$$\n\\sum_{f \\in \\text{faces}} F_f = 0,\n$$\nwhere $F_f$ is the face-normal mass flux through face $f$.\n\nSetup and definitions:\n- Use a uniform grid with spacings $ \\Delta x = L_x / N_x $ and $ \\Delta y = L_y / N_y $. The area of a face normal to the $x$-direction is $A_x = \\Delta y$, and the area of a face normal to the $y$-direction is $A_y = \\Delta x$.\n- The collocated grid stores $p$, $u$, and $v$ at the cell centers. For this problem, set the cell-centered velocities to zero, $u_{i,j} = 0$ and $v_{i,j} = 0$, and define a manufactured pressure field\n$$\np(x,y) = \\sin\\left( 2 \\pi x \\right) \\sin\\left( 2 \\pi y \\right),\n$$\nsampled at cell centers $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$ for $i = 0,1,\\dots,N_x-1$, and $y_j = \\left(j+\\tfrac{1}{2}\\right)\\Delta y$ for $j = 0,1,\\dots,N_y-1$.\n- Compute face-normal mass fluxes using Rhie–Chow interpolation. For an internal face $f$ between adjacent cells $P$ and $N$, the Rhie–Chow face velocity in the $x$-direction is\n$$\nu_f = \\frac{1}{2}\\left( u_P + u_N \\right) - D_f^{(x)} \\left( p_N - p_P \\right),\n$$\nand in the $y$-direction\n$$\nv_f = \\frac{1}{2}\\left( v_P + v_N \\right) - D_f^{(y)} \\left( p_N - p_P \\right),\n$$\nwhere $D_f^{(x)}$ and $D_f^{(y)}$ are correction coefficients derived from the momentum operator coefficients. Use the following physically plausible, diffusion-dominated approximation for the cell-centered momentum coefficients in each direction:\n$$\na_P^{(x)} = 2 \\mu \\frac{A_x}{\\Delta x} + 2 \\mu \\frac{A_y}{\\Delta y} = 2 \\mu \\frac{\\Delta y}{\\Delta x} + 2 \\mu \\frac{\\Delta x}{\\Delta y},\n$$\n$$\na_P^{(y)} = 2 \\mu \\frac{A_y}{\\Delta y} + 2 \\mu \\frac{A_x}{\\Delta x} = 2 \\mu \\frac{\\Delta x}{\\Delta y} + 2 \\mu \\frac{\\Delta y}{\\Delta x}.\n$$\nAt a face $f$, compute the effective momentum coefficient using the harmonic average of the adjacent cell coefficients, e.g., for the $x$-faces,\n$$\na_f^{(x)} = \\left( \\frac{1}{2} \\left( \\frac{1}{a_P^{(x)}(P)} + \\frac{1}{a_P^{(x)}(N)} \\right) \\right)^{-1}.\n$$\nDefine the Rhie–Chow correction coefficients\n$$\nD_f^{(x)} = \\frac{A_x}{a_f^{(x)} \\Delta x} = \\frac{\\Delta y}{a_f^{(x)} \\Delta x}, \\quad D_f^{(y)} = \\frac{A_y}{a_f^{(y)} \\Delta y} = \\frac{\\Delta x}{a_f^{(y)} \\Delta y}.\n$$\nFinally, the face-normal mass fluxes are $F_f^{(x)} = \\rho \\, u_f \\, A_x = \\rho \\, u_f \\, \\Delta y$ for vertical faces and $F_f^{(y)} = \\rho \\, v_f \\, A_y = \\rho \\, v_f \\, \\Delta x$ for horizontal faces.\n\nBoundary conditions:\n- The domain is closed with no-penetration boundaries. Set the mass fluxes across domain boundaries to zero:\n$$\nF_f^{(x)} = 0 \\quad \\text{on } i = 0 \\text{ and } i = N_x, \\quad F_f^{(y)} = 0 \\quad \\text{on } j = 0 \\text{ and } j = N_y.\n$$\n\nDiscrete continuity residual:\n- For each cell $(i,j)$, define the discrete continuity residual as\n$$\nR_{i,j} = \\frac{ F^{(x)}_{i+1,j} - F^{(x)}_{i,j} + F^{(y)}_{i,j+1} - F^{(y)}_{i,j} }{ \\Delta x \\Delta y }.\n$$\nThe global mass residual $R_{\\text{global}}$ is the sum over all cells multiplied by the cell area:\n$$\nR_{\\text{global}} = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} R_{i,j} \\, \\Delta x \\Delta y.\n$$\nIn a closed domain with consistent face fluxes, internal face contributions telescope and cancel, so $R_{\\text{global}}$ equals the net boundary mass flux, which is zero in exact arithmetic.\n\nTask:\n- Implement the above scheme to compute $R_{\\text{global}}$ for each parameter set in the test suite. Quantify the absolute value $|R_{\\text{global}}|$ in kilograms per second (kg/s). Due to finite precision arithmetic, the expected value is at or below machine precision times a characteristic flux scale.\n\nTest suite:\n- Use the following parameter sets, each specified as $(N_x,N_y,L_x,L_y,\\rho,\\mu)$:\n    1. $(4,4,1.0,1.0,1.0,1.0)$\n    2. $(16,16,1.0,1.0,1000.0,1.0 \\times 10^{-3})$\n    3. $(31,19,2.0,1.0,1.2,1.8 \\times 10^{-5})$\n    4. $(1,1,1.0,1.0,1000.0,1.0)$\n    5. $(64,64,1.0,1.0,1000.0,1.0 \\times 10^{8})$\n\nOutput specification:\n- Your program should produce a single line of output containing the absolute global mass residuals for the five test cases as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4,r_5]$, where each $r_k$ is a floating-point number in kilograms per second (kg/s).",
            "solution": "The problem is a well-posed numerical verification task from the field of computational fluid dynamics (CFD). It is scientifically grounded in the Finite Volume Method (FVM) for incompressible flows and tests the mass conservation properties of the Rhie–Chow interpolation scheme on a collocated grid. The problem provides all necessary equations, parameters, and boundary conditions to compute a unique, quantifiable result, which is the global mass residual for a manufactured flow scenario. The setup is self-contained and free of contradictions. Therefore, the problem is valid, and a solution can be derived.\n\nThe solution proceeds by implementing the specified numerical algorithm. The core task is to compute the global mass residual, $R_{\\text{global}}$, for a series of test cases. The analytical value of $R_{\\text{global}}$ is zero due to the problem's setup (a closed domain with zero boundary flux), so the computed result quantifies the numerical error accumulated during the floating-point calculations.\n\n**Step 1: Discretization and Grid Setup**\n\nFor each test case, we are given the number of cells $N_x$ and $N_y$, domain lengths $L_x$ and $L_y$, fluid density $\\rho$, and dynamic viscosity $\\mu$. From these, we define the uniform grid spacings:\n$$\n\\Delta x = \\frac{L_x}{N_x}, \\quad \\Delta y = \\frac{L_y}{N_y}\n$$\nThe collocated grid stores all variables at cell centers. The coordinates of the center of cell $(i,j)$ are given by:\n$$\nx_i = \\left(i+\\frac{1}{2}\\right)\\Delta x, \\quad \\text{for } i = 0, 1, \\dots, N_x-1\n$$\n$$\ny_j = \\left(j+\\frac{1}{2}\\right)\\Delta y, \\quad \\text{for } j = 0, 1, \\dots, N_y-1\n$$\n\n**Step 2: Define Specified Fields**\n\nA manufactured pressure field is defined over the domain and sampled at the cell centers:\n$$\np_{i,j} = p(x_i, y_j) = \\sin(2 \\pi x_i) \\sin(2 \\pi y_j)\n$$\nThe cell-centered velocities are specified to be zero throughout the domain:\n$$\nu_{i,j} = 0, \\quad v_{i,j} = 0 \\quad \\text{for all } i,j\n$$\n\n**Step 3: Calculate Rhie–Chow Coefficients**\n\nThe Rhie–Chow interpolation requires coefficients derived from the momentum equations. The problem provides a diffusion-dominated approximation for the cell-centered momentum coefficient $a_P$. Since the grid is uniform, this coefficient is constant for all cells:\n$$\na_P = a_P^{(x)} = a_P^{(y)} = 2 \\mu \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\nThe face-based coefficient $a_f$ is calculated using a harmonic average. For a uniform grid and constant properties, this simplifies to $a_f = a_P$.\n\nThe Rhie–Chow correction coefficients, $D_f^{(x)}$ and $D_f^{(y)}$, are used to create pressure-velocity coupling. They are also constant for all internal faces:\n$$\nD^{(x)} = \\frac{\\Delta y}{a_f \\Delta x} = \\frac{\\Delta y}{a_P \\Delta x}\n$$\n$$\nD^{(y)} = \\frac{\\Delta x}{a_f \\Delta y} = \\frac{\\Delta x}{a_P \\Delta y}\n$$\n\n**Step 4: Compute Face Mass Fluxes**\n\nThe face-normal velocities using Rhie–Chow interpolation are given by:\n$$\nu_f = \\frac{1}{2}\\left( u_P + u_N \\right) - D_f^{(x)} \\left( p_N - p_P \\right)\n$$\n$$\nv_f = \\frac{1}{2}\\left( v_P + v_N \\right) - D_f^{(y)} \\left( p_N - p_P \\right)\n$$\nSince all cell-centered velocities ($u_P, u_N, v_P, v_N$) are zero, the expressions simplify to:\n$$\nu_f = - D^{(x)} \\left( p_N - p_P \\right)\n$$\n$$\nv_f = - D^{(y)} \\left( p_N - p_P \\right)\n$$\nThe mass fluxes through the internal faces are then calculated. For a vertical face between cells $(i-1,j)$ and $(i,j)$, the flux is:\n$$\nF^{(x)}_{i,j} = \\rho \\, u_f \\, A_x = \\rho \\left( -D^{(x)} (p_{i,j} - p_{i-1,j}) \\right) \\Delta y\n$$\nFor a horizontal face between cells $(i,j-1)$ and $(i,j)$, the flux is:\n$$\nF^{(y)}_{i,j} = \\rho \\, v_f \\, A_y = \\rho \\left( -D^{(y)} (p_{i,j} - p_{i,j-1}) \\right) \\Delta x\n$$\nBoundary conditions state that the domain is closed, so all fluxes on the domain boundary are zero:\n$$\nF^{(x)}_{0,j} = F^{(x)}_{N_x,j} = 0 \\quad \\text{for all } j\n$$\n$$\nF^{(y)}_{i,0} = F^{(y)}_{i,N_y} = 0 \\quad \\text{for all } i\n$$\n\n**Step 5: Compute the Global Mass Residual**\n\nThe global mass residual, $R_{\\text{global}}$, is the sum of the net mass fluxes for all cells:\n$$\nR_{\\text{global}} = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left( F^{(x)}_{i+1,j} - F^{(x)}_{i,j} + F^{(y)}_{i,j+1} - F^{(y)}_{i,j} \\right)\n$$\nThis is a telescoping sum. In exact arithmetic, the internal face fluxes cancel out, leaving only the sum of fluxes on the domain boundary:\n$$\nR_{\\text{global}} = \\sum_{j=0}^{N_y-1} \\left( F^{(x)}_{N_x,j} - F^{(x)}_{0,j} \\right) + \\sum_{i=0}^{N_x-1} \\left( F^{(y)}_{i,N_y} - F^{(y)}_{i,0} \\right)\n$$\nSince all boundary fluxes are set to zero, the exact analytical value of $R_{\\text{global}}$ is $0$. The calculation using finite-precision floating-point arithmetic will produce a small non-zero value due to cancellation errors. The task is to compute this numerical residual and report its absolute value, $|R_{\\text{global}}|$.\n\nThe implementation will first compute the pressure field, then the constant coefficients $a_P$, $D^{(x)}$, and $D^{(y)}$. It will then compute all internal mass fluxes and store them in arrays. Finally, it will sum the net fluxes for each cell to find the global residual. For the special case where $N_x=1$ and $N_y=1$, there are no internal faces, and all fluxes are boundary fluxes, which are zero. Thus, the residual is exactly $0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_residual(Nx, Ny, Lx, Ly, rho, mu):\n    \"\"\"\n    Computes the absolute global mass residual for a 2D steady, incompressible\n    flow problem using Rhie-Chow interpolation on a collocated grid.\n\n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        Lx (float): Length of the domain in the x-direction.\n        Ly (float): Length of the domain in the y-direction.\n        rho (float): Fluid density.\n        mu (float): Fluid dynamic viscosity.\n\n    Returns:\n        float: The absolute value of the global mass residual in kg/s.\n    \"\"\"\n    # 1. Grid parameters\n    dx = Lx / Nx\n    dy = Ly / Ny\n\n    # If there are no internal faces (single cell), boundary fluxes are zero,\n    # so the global residual is exactly zero. The general logic below also\n    # correctly handles this case, but this check is a clear statement.\n    if Nx == 1 and Ny == 1:\n        return 0.0\n\n    # 2. Cell-centered momentum coefficient (constant for uniform grid)\n    # The problem statement guarantees mu > 0 for all test cases.\n    a_P = 2.0 * mu * (dy / dx + dx / dy)\n    \n    # 3. Rhie-Chow correction coefficients (constant for all internal faces)\n    D_x = dy / (a_P * dx)\n    D_y = dx / (a_P * dy)\n\n    # 4. Generate pressure field at cell centers\n    x_coords = (np.arange(Nx) + 0.5) * dx\n    y_coords = (np.arange(Ny) + 0.5) * dy\n    X, Y = np.meshgrid(x_coords, y_coords, indexing='ij')\n    p = np.sin(2.0 * np.pi * X) * np.sin(2.0 * np.pi * Y)\n\n    # 5. Compute face mass fluxes\n    # Initialize flux arrays. Boundary fluxes are zero by problem definition.\n    Fx = np.zeros((Nx + 1, Ny))\n    Fy = np.zeros((Nx, Ny + 1))\n\n    # Compute internal x-direction mass fluxes.\n    # Velocity is u_face = -D_x * (p_N - p_P). Flux is rho * u_face * Area_x.\n    # p_N is cell (i,j), p_P is cell (i-1,j), so dp = p[i,j] - p[i-1,j].\n    if Nx > 1:\n        dp_x = p[1:, :] - p[:-1, :]\n        u_face_internal = -D_x * dp_x\n        # Fluxes correspond to Fx[1:Nx, :]\n        Fx[1:Nx, :] = rho * u_face_internal * dy\n\n    # Compute internal y-direction mass fluxes.\n    # Velocity is v_face = -D_y * (p_N - p_P). Flux is rho * v_face * Area_y.\n    # p_N is cell (i,j), p_P is cell (i,j-1), so dp = p[i,j] - p[i,j-1].\n    if Ny > 1:\n        dp_y = p[:, 1:] - p[:, :-1]\n        v_face_internal = -D_y * dp_y\n        # Fluxes correspond to Fy[:, 1:Ny]\n        Fy[:, 1:Ny] = rho * v_face_internal * dx\n\n    # 6. Compute the global mass residual\n    # R_global = sum_{i,j} ( Fx[i+1,j] - Fx[i,j] + Fy[i,j+1] - Fy[i,j] )\n    # This sum telescopes to the sum of boundary fluxes, which is 0 in exact\n    # arithmetic. The non-zero result comes from floating-point errors.\n    \n    # Calculate net flux for each cell\n    net_flux_x_per_cell = Fx[1:, :] - Fx[:-1, :] # Shape (Nx, Ny)\n    net_flux_y_per_cell = Fy[:, 1:] - Fy[:, :-1] # Shape (Nx, Ny)\n\n    # Sum the net fluxes over all cells to get the global residual\n    net_flux_per_cell = net_flux_x_per_cell + net_flux_y_per_cell\n    R_global = np.sum(net_flux_per_cell)\n\n    return abs(R_global)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, Lx, Ly, rho, mu)\n        (4, 4, 1.0, 1.0, 1.0, 1.0),\n        (16, 16, 1.0, 1.0, 1000.0, 1.0e-3),\n        (31, 19, 2.0, 1.0, 1.2, 1.8e-5),\n        (1, 1, 1.0, 1.0, 1000.0, 1.0),\n        (64, 64, 1.0, 1.0, 1000.0, 1.0e8)\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, Lx, Ly, rho, mu = case\n        residual = compute_residual(Nx, Ny, Lx, Ly, rho, mu)\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}