{
    "hands_on_practices": [
        {
            "introduction": "为了开始我们的动手实践，我们首先深入研究迎风格式的理论基石：其稳定性。虽然我们已经讨论过选择迎风格式是因为其稳健性，但本练习将让你严格地证明这一点。通过对线性平流方程进行傅里叶稳定性分析，你将推导出著名的Courant-Friedrichs-Lewy (CFL) 条件，它为显式时间积分格式保持稳定所需的时间步长提供了一个具体的限制。",
            "id": "3996981",
            "problem": "考虑由偏微分方程 $\\partial_{t} T(x,t) + u \\,\\partial_{x} T(x,t) = 0$ 描述的温度线性平流问题。该问题定义在一个长度为 $L$ 的一维周期性区域上，平流速度 $u \\in \\mathbb{R}$ 为常数。设该区域被一个包含 $N$ 个点的均匀网格离散化，网格间距为 $h = L/N$。网格中心处的未知量为 $\\{T_{i}(t)\\}_{i=0}^{N-1}$，位于 $x_{i} = i h$ 处，并采用周期性索引。使用与 $u$ 的符号相适应的迎风空间差分格式（即，与传播方向一致的单边离散梯度），将半离散系统写成 $\\frac{d \\mathbf{T}}{dt} = A\\,\\mathbf{T}$ 的形式，其中 $A$ 是一个合适的矩阵，$\\mathbf{T}(t) \\in \\mathbb{R}^{N}$ 是节点值的集合。\n\n从控制方程和迎风有限差分算子的定义出发，基于周期性进行离散傅里叶模态分析，以：\n- 推导半离散算子 $A$ 的完整特征值集合，作为离散波数的函数，\n- 推导出保证全离散格式 $\\mathbf{T}^{n+1} = \\mathbf{T}^{n} + \\Delta t\\,A\\,\\mathbf{T}^{n}$ 线性稳定的前向欧拉时间步长限制。\n\n您的推导必须从给定的物理模型和迎风差分定义开始，依次构建半离散算子，确定其傅里叶特征向量，并由此得到特征值。然后，在复平面中使用前向欧拉线性稳定性判据，以获得在所有离散波数上对 $\\Delta t$ 的最严格约束。将您的最终答案表示为关于 $h$ 和 $|u|$ 的最大稳定时间步长的单个闭式解析表达式。您无需给出数值；最终的方框答案中不要包含单位。如果该表达式需要进行数值计算，其单位将是秒。",
            "solution": "分析始于温度 $T(x,t)$ 的控制线性平流方程，其形式如下：\n$$\n\\partial_{t} T(x,t) + u \\,\\partial_{x} T(x,t) = 0\n$$\n该方程定义在一个长度为 $L$ 的一维周期性区域上。该区域被离散化为 $N$ 个宽度为 $h = L/N$ 的均匀单元，网格中心处的温度值为 $T_i(t)$，位于位置 $x_i = i h$ 上，其中 $i \\in \\{0, 1, \\dots, N-1\\}$。空间导数 $\\partial_x T$ 的半离散化采用一阶迎风差分格式。单边差分模板的选择取决于平流速度 $u$ 的符号。\n\n情况1：$u > 0$。信息沿 $x$ 轴正方向传播（从左到右）。迎风格式使用后向差分来近似节点 $i$ 处的空间导数：\n$$\n(\\partial_x T)_i \\approx \\frac{T_i - T_{i-1}}{h}\n$$\n将此代入控制方程，得到关于 $T_i(t)$ 的半离散常微分方程：\n$$\n\\frac{d T_i}{dt} = -u \\left( \\frac{T_i - T_{i-1}}{h} \\right)\n$$\n由于指定的周期性边界条件，索引按模 $N$ 计算，因此 $T_{-1}$ 被理解为 $T_{N-1}$。\n\n情况2：$u  0$。信息沿 $x$ 轴负方向传播（从右到左）。迎风格式使用前向差分：\n$$\n(\\partial_x T)_i \\approx \\frac{T_{i+1} - T_i}{h}\n$$\n$T_i(t)$ 的半离散方程变为：\n$$\n\\frac{d T_i}{dt} = -u \\left( \\frac{T_{i+1} - T_i}{h} \\right)\n$$\n在此，周期性索引意味着 $T_N$ 被理解为 $T_0$。\n\n这两种情况可以统一起来。节点温度向量 $\\mathbf{T}(t) = [T_0(t), \\dots, T_{N-1}(t)]^T$ 的半离散系统表示为 $\\frac{d\\mathbf{T}}{dt} = A\\mathbf{T}$。矩阵 $A$ 是一个 $N \\times N$ 的循环矩阵。为了求其特征值，我们进行离散傅里叶分析。任何 $N \\times N$ 循环矩阵的特征向量都是离散傅里叶模态。对应于离散波数 $k_m = \\frac{2\\pi m}{L} = \\frac{2\\pi m}{Nh}$（其中 $m \\in \\{0, 1, \\dots, N-1\\}$）的特征向量 $\\mathbf{v}_m$ 的分量为 $(\\mathbf{v}_m)_j = e^{i k_m x_j} = e^{i (2\\pi m / (Nh)) (jh)} = e^{i j (2\\pi m / N)}$。令 $\\theta_m = k_m h = \\frac{2\\pi m}{N}$ 为无量纲波数或每网格单元的相角。则特征向量的第 $j$ 个分量为 $(\\mathbf{v}_m)_j = e^{i j \\theta_m}$。\n\n我们通过将算子 $A$ 的第 $i$ 行应用于特征向量 $\\mathbf{v}_m$ 来找到与之相关的特征值 $\\lambda_m$。\n对于 $u > 0$：\n$$\n(A \\mathbf{v}_m)_i = - \\frac{u}{h} ((\\mathbf{v}_m)_i - (\\mathbf{v}_m)_{i-1}) = - \\frac{u}{h} (e^{i i \\theta_m} - e^{i (i-1) \\theta_m}) = - \\frac{u}{h} e^{i i \\theta_m} (1 - e^{-i \\theta_m}) = \\left[ \\frac{u}{h}(e^{-i \\theta_m} - 1) \\right] (\\mathbf{v}_m)_i\n$$\n因此，对于 $u>0$，特征值为 $\\lambda_m = \\frac{u}{h}(e^{-i \\theta_m} - 1)$。\n\n对于 $u  0$：\n$$\n(A \\mathbf{v}_m)_i = - \\frac{u}{h} ((\\mathbf{v}_m)_{i+1} - (\\mathbf{v}_m)_i) = - \\frac{u}{h} (e^{i (i+1) \\theta_m} - e^{i i \\theta_m}) = - \\frac{u}{h} e^{i i \\theta_m} (e^{i \\theta_m} - 1) = \\left[ - \\frac{u}{h}(e^{i \\theta_m} - 1) \\right] (\\mathbf{v}_m)_i\n$$\n因此，对于 $u0$，特征值为 $\\lambda_m = -\\frac{u}{h}(e^{i \\theta_m} - 1)$。\n\n问题要求使用前向欧拉法进行时间积分，对全离散格式进行稳定性分析：\n$$\n\\mathbf{T}^{n+1} = \\mathbf{T}^{n} + \\Delta t\\,A\\,\\mathbf{T}^{n} = (I + \\Delta t A) \\mathbf{T}^n\n$$\n其中 $\\Delta t$ 是时间步长。该格式的稳定性要求每个模态 $m$ 的放大因子 $G_m$ 的模不大于1。放大因子是算子 $(I + \\Delta t A)$ 的特征值，即 $G_m = 1 + \\Delta t \\lambda_m$。稳定性条件是：\n$$\n|G_m| = |1 + \\Delta t \\lambda_m| \\le 1 \\quad \\forall m \\in \\{0, 1, \\dots, N-1\\}\n$$\n该条件表明，为保证稳定性，复数 $z_m = \\Delta t \\lambda_m$ 必须位于复平面上以 $(-1, 0)$ 为中心、半径为 $1$ 的圆内或其边界上。\n\n我们来分析点 $z_m = \\Delta t \\lambda_m$ 的轨迹。引入库朗数 $C = \\frac{|u|\\Delta t}{h}$。\n对于 $u > 0$，有 $u=|u|$，因此 $C = \\frac{u \\Delta t}{h}$。\n$$\nz_m = \\Delta t \\left( \\frac{u}{h}(e^{-i \\theta_m} - 1) \\right) = C(e^{-i \\theta_m} - 1) = C(\\cos(\\theta_m) - 1) - i C\\sin(\\theta_m)\n$$\n对于 $u  0$，有 $u=-|u|$，因此 $C = -\\frac{u \\Delta t}{h}$。\n$$\nz_m = \\Delta t \\left( - \\frac{u}{h}(e^{i \\theta_m} - 1) \\right) = C(e^{i \\theta_m} - 1) = C(\\cos(\\theta_m) - 1) + i C\\sin(\\theta_m)\n$$\n在这两种情况下，当 $\\theta_m$ 从 $0$ 变化到 $2\\pi$ 时（对应于 $m$ 从 $0$ 到 $N$），点 $z_m$ 在复平面上描绘出一个圆。这个圆由方程 $|z_m + C| = C$ 描述。它是一个以 $(-C, 0)$ 为中心、半径为 $C$ 的圆。\n\n为使格式稳定，这个由点集 $\\{z_m\\}$ 构成的圆必须完全包含在稳定区域 $|z+1| \\le 1$ 内。稳定区域是一个以 $(-1, 0)$ 为中心、半径为 $1$ 的圆。\n$\\{z_m\\}$ 构成的圆，其最右点在 $z = 0$ 处（当 $\\theta_m=0$ 时），最左点在 $z=-2C$ 处（当 $\\theta_m=\\pi$ 时）。要使该圆包含在稳定区域内，其最左点不能比稳定区域的最左点（即 $z=-2$）更左。因此，我们必须有：\n$$\n-2C \\ge -2\n$$\n这可以简化为 $C \\le 1$。\n代回库朗数的定义，我们得到稳定性条件：\n$$\n\\frac{|u|\\Delta t}{h} \\le 1\n$$\n问题要求的是最大稳定时间步长，当上述不等式取等号时获得：\n$$\n\\Delta t_{\\text{max}} = \\frac{h}{|u|}\n$$\n这是一阶迎风格式与前向欧拉时间积分相结合时的 Courant-Friedrichs-Lewy (CFL) 条件。稳定性受信息穿越单个网格单元所需时间的限制。",
            "answer": "$$\\boxed{\\frac{h}{|u|}}$$"
        },
        {
            "introduction": "在确定了迎风格式的稳定性之后，我们现在转向其精度问题。如果一个格式的结果不正确，那么它的稳定性就毫无意义。在此实践中，你将使用“制造解方法”(Method of Manufactured Solutions, MMS)——一种强大的代码验证技术——来数值化地测量迎风格式的收敛阶。这个练习将为该格式的一阶空间精度提供具体的经验证据，并揭示其数值耗散的来源。",
            "id": "3996964",
            "problem": "考虑在域 $x \\in [0,1]$ 上，具有恒定属性的被动标量（温度）场 $T(x)$ 的稳态一维（1D）对流扩散平衡，其守恒声明表示为\n$$\n- \\alpha \\frac{d^2 T}{dx^2} + \\beta \\frac{d T}{dx} = S(x),\n$$\n其中 $\\alpha > 0$ 是扩散系数，$\\beta$ 是一个恒定的对流系数，$S(x)$ 是一个体积源项。制造解方法（Method of Manufactured Solutions, MMS）要求选择一个光滑、非平凡的精确解 $T_{\\text{exact}}(x)$，并由此推导出 $S(x)$，以使 $T_{\\text{exact}}(x)$ 满足该微分方程。您将使用 MMS，在与 $T_{\\text{exact}}(x)$ 一致的狄利克雷边界条件下，验证有限差分格式中对流项的迎风差分格式（Upwind Differencing Scheme, UDS）与扩散项的二阶中心差分相结合时，所观测到的空间收敛阶。所有量均为无量纲。不需要物理单位。\n\n从上述守恒定律出发，执行以下操作：\n- 选择制造解 $T_{\\text{exact}}(x) = \\sin(2\\pi x)$，并根据给定的常数 $\\alpha$ 和 $\\beta$ 计算控制方程所对应的源项 $S(x)$。施加狄利克雷边界条件 $T(0) = T_{\\text{exact}}(0)$ 和 $T(1) = T_{\\text{exact}}(1)$。\n- 使用包含 $N$ 个内部节点的均匀网格（网格间距 $h = 1/(N+1)$）对域 $[0,1]$ 进行离散化。在每个内部节点处，使用二阶中心差分模板近似扩散项，并使用迎风差分格式（UDS）近似对流项，其中 UDS 采用与 $\\beta$ 符号一致的单边有限差分。组装并求解得到的线性系统，以获得离散近似解 $T_h$。\n- 对于每个网格，计算内部节点 $x_i = i h$（其中 $i = 1,2,\\dots,N$）处的节点误差 $e_i = T_h(x_i) - T_{\\text{exact}}(x_i)$，以及定义为 $E(h) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N e_i^2}$ 的离散 $L_2$ 误差范数。\n- 使用间距为 $h$ 和 $\\tilde{h}$ 的两个连续细化网格，按下式估算观测到的空间收敛阶\n$$\np = \\frac{\\ln\\left(E(h)/E(\\tilde{h})\\right)}{\\ln\\left(h/\\tilde{h}\\right)}.\n$$\n\n您的程序必须针对以下测试套件评估观测到的阶数 $p$，在每种情况下，使用 $N \\in \\{20,40,80,160,320\\}$ 中最后两次网格细化的结果来计算 $p$：\n- 情况 1（理想情况）：$\\alpha = 10^{-2}$，$\\beta = 1$。\n- 情况 2（流动反向）：$\\alpha = 10^{-2}$，$\\beta = -1$。\n- 情况 3（强对流主导）：$\\alpha = 10^{-6}$，$\\beta = 1$。\n- 情况 4（纯扩散边缘情况）：$\\alpha = 1$，$\\beta = 0$。\n\n预期行为是，由于 UDS 的原因，$\\beta \\neq 0$ 的情况表现出大约一阶的空间收敛性，而由于中心差分格式，$\\beta = 0$ 的纯扩散情况表现出大约二阶的收敛性。\n\n最终输出规格：\n- 对于每种情况，输出单个浮点数 $p$，四舍五入到三位小数。\n- 您的程序应生成单行输出，其中包含按情况 1 到 4 的顺序排列的结果，形式为方括号内以逗号分隔的列表，例如 $[p_1,p_2,p_3,p_4]$。\n- 角度单位不适用。不需要物理单位，任何地方都不得使用百分比；所有值都必须表示为小数。\n\n确保科学真实性和自洽性。实现必须直接反映所描述的原理，不得使用未由所述守恒定律和有限差分定义证明的捷径公式。",
            "solution": "该问题是有效的，因为它提出了一个使用已建立的制造解方法（MMS）对数值方法进行验证的标准、适定的练习。所有组成部分——物理控制方程、数值格式和分析过程——都是科学上合理且明确定义的。\n\n求解过程包括四个主要步骤：源项推导、控制方程离散化、线性系统组装与求解，以及收敛阶计算。\n\n**1. 源项推导**\n控制方程是一维稳态对流扩散方程：\n$$\n- \\alpha \\frac{d^2 T}{dx^2} + \\beta \\frac{d T}{dx} = S(x)\n$$\n制造解方法（MMS）要求我们选择一个精确解 $T_{\\text{exact}}(x)$，并将其代入控制方程，以推导出使方程成立的相应源项 $S(x)$。所选的制造解为：\n$$\nT_{\\text{exact}}(x) = \\sin(2\\pi x)\n$$\n我们计算它关于 $x$ 的一阶和二阶导数：\n$$\n\\frac{dT_{\\text{exact}}}{dx} = 2\\pi \\cos(2\\pi x)\n$$\n$$\n\\frac{d^2T_{\\text{exact}}}{dx^2} = -4\\pi^2 \\sin(2\\pi x)\n$$\n将这些导数代入控制方程，得到源项 $S(x)$：\n$$\nS(x) = - \\alpha \\left(-4\\pi^2 \\sin(2\\pi x)\\right) + \\beta \\left(2\\pi \\cos(2\\pi x)\\right)\n$$\n$$\nS(x) = 4\\alpha\\pi^2 \\sin(2\\pi x) + 2\\beta\\pi \\cos(2\\pi x)\n$$\n狄利克雷边界条件根据制造解在域边界 $x=0$ 和 $x=1$ 处的值确定：\n$$\nT(0) = T_{\\text{exact}}(0) = \\sin(0) = 0\n$$\n$$\nT(1) = T_{\\text{exact}}(1) = \\sin(2\\pi) = 0\n$$\n\n**2. 有限差分离散化**\n域 $x \\in [0,1]$ 使用包含 $N$ 个内部节点的均匀网格进行离散化。网格点的索引从 $i=0$ 到 $i=N+1$，使得 $x_i = i h$，其中网格间距为 $h = 1/(N+1)$。数值解 $T_h$ 旨在近似 $T_{\\text{exact}}$ 在内部节点 $x_i$（其中 $i=1, 2, \\dots, N$）处的值。未知值为 $T_i \\equiv T_h(x_i)$。\n\n在内部节点 $x_i$ 处，控制方程的离散形式为：\n$$\n- \\alpha \\left(\\frac{d^2 T}{dx^2}\\right)_i + \\beta \\left(\\frac{d T}{dx}\\right)_i = S(x_i)\n$$\n扩散项使用二阶中心差分模板进行近似：\n$$\n\\left(\\frac{d^2 T}{dx^2}\\right)_i \\approx \\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\n$$\n对流项使用一阶迎风差分格式（UDS）进行近似，其模板取决于对流系数 $\\beta$ 的符号。\n- 如果 $\\beta > 0$（流动方向为 $x$ 轴正方向），则使用后向差分：\n$$\n\\left(\\frac{d T}{dx}\\right)_i \\approx \\frac{T_i - T_{i-1}}{h}\n$$\n- 如果 $\\beta  0$（流动方向为 $x$ 轴负方向），则使用前向差分：\n$$\n\\left(\\frac{d T}{dx}\\right)_i \\approx \\frac{T_{i+1} - T_i}{h}\n$$\n- 如果 $\\beta = 0$，对流项为零。\n\n将这些近似值代入控制方程并重新整理，可以为每个节点 $i$ 得到一个线性代数方程。\n\n**情况 1：$\\beta > 0$**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) + \\beta \\left(\\frac{T_i - T_{i-1}}{h}\\right) = S_i\n$$\n乘以 $h^2$ 并按未知数 $T_j$ 合并项：\n$$\n(-\\alpha - \\beta h)T_{i-1} + (2\\alpha + \\beta h)T_i + (-\\alpha)T_{i+1} = h^2 S_i\n$$\n\n**情况 2：$\\beta  0$**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) + \\beta \\left(\\frac{T_{i+1} - T_i}{h}\\right) = S_i\n$$\n乘以 $h^2$ 并合并项：\n$$\n(-\\alpha)T_{i-1} + (2\\alpha - \\beta h)T_i + (-\\alpha + \\beta h)T_{i+1} = h^2 S_i\n$$\n\n**情况 3：$\\beta = 0$ (纯扩散)**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) = S_i\n$$\n$$\n(-\\alpha)T_{i-1} + (2\\alpha)T_i + (-\\alpha)T_{i+1} = h^2 S_i\n$$\n\n**3. 线性系统组装与求解**\n对于内部节点 $i=1, \\dots, N$ 的 $N$ 个线性方程组构成一个矩阵系统 $A\\mathbf{T}_h = \\mathbf{d}$，其中 $\\mathbf{T}_h = [T_1, T_2, \\dots, T_N]^T$ 是未知节点温度的向量。矩阵 $A$ 是一个 $N \\times N$ 的三对角矩阵，$\\mathbf{d}$ 是右端向量。\n\n$A$ 的元素是上面推导出的系数。对于一般的第 $i$ 行（代表节点 $x_i$），主对角线元素是 $A_{i,i}$，次对角线元素是 $A_{i,i-1}$，超对角线元素是 $A_{i,i+1}$。向量 $\\mathbf{d}$ 的元素为 $d_i = h^2 S(x_i)$。\n\n边界条件 $T_0=0$ 和 $T_{N+1}=0$ 影响第一个（$i=1$）和最后一个（$i=N$）方程。项 $T_0$ 和 $T_{N+1}$ 是已知的，并被移到右端。由于它们都为零，右端向量 $\\mathbf{d}$ 不受影响。\n\n对于每种网格配置，求解得到的三对角系统以获得 $\\mathbf{T}_h$。\n\n**4. 误差分析与收敛阶**\n在获得数值解 $\\mathbf{T}_h$ 后，计算其相对于已知精确解的误差。每个内部节点的节点误差为 $e_i = T_i - T_{\\text{exact}}(x_i)$。对于给定的网格间距 $h$，总体误差使用离散 $L_2$ 范数来衡量：\n$$\nE(h) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N e_i^2}\n$$\n通过在两种不同间距 $h$ 和 $\\tilde{h}$（其中 $\\tilde{h}  h$）的网格上进行模拟，来估算观测到的空间收敛阶 $p$。其公式为：\n$$\np = \\frac{\\ln\\left(E(h)/E(\\tilde{h})\\right)}{\\ln\\left(h/\\tilde{h}\\right)}\n$$\n对于这个问题，每种 $(\\alpha, \\beta)$ 情况下的 $p$ 都是使用来自两个最精细网格的结果计算的，这两个网格分别对应于 $N=160$（$h=1/161$）和 $N=320$（$\\tilde{h}=1/321$）。预期阶数是：对于有对流的情况（$\\beta \\neq 0$），由于一阶 UDS， $p \\approx 1$；对于纯扩散情况（$\\beta = 0$），由于扩散项的二阶中心差分格式，$p \\approx 2$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_case(alpha, beta, N_list):\n    \"\"\"\n    Solves a single case for a given alpha, beta, and list of grid sizes N.\n    \n    This function implements the Method of Manufactured Solutions (MMS) to\n    verify the spatial convergence order of a finite difference scheme for the\n    1D steady convection-diffusion equation. It calculates the L2 error for a\n    series of refined grids and then computes the observed order of convergence\n    from the last two refinements.\n\n    Args:\n        alpha (float): The diffusivity coefficient.\n        beta (float): The convection coefficient.\n        N_list (list of int): A list of the number of interior grid nodes for each refinement.\n\n    Returns:\n        float: The observed spatial order of convergence, p.\n    \"\"\"\n    errors = []\n    h_values = []\n\n    for N in N_list:\n        # 1. Setup grid\n        h = 1.0 / (N + 1)\n        # We only need interior nodes for setting up and solving the system\n        x_interior = np.linspace(h, 1.0 - h, N)\n\n        # 2. Compute manufactured solution and source term at interior nodes\n        T_exact_interior = np.sin(2 * np.pi * x_interior)\n        S_interior = (4 * alpha * np.pi**2 * np.sin(2 * np.pi * x_interior) +\n                      2 * beta * np.pi * np.cos(2 * np.pi * x_interior))\n        \n        # 3. Assemble the linear system A * T_h = d\n        A = np.zeros((N, N))\n        d = h**2 * S_interior\n        # The boundary conditions T(0)=0 and T(1)=0 are homogeneous, so they\n        # do not contribute to the right-hand side vector d.\n\n        # Define tridiagonal coefficients based on the sign of beta (Upwind Scheme)\n        if beta > 0:\n            # Backward difference for convection\n            sub_diag_val = -alpha - beta * h\n            main_diag_val = 2 * alpha + beta * h\n            super_diag_val = -alpha\n        elif beta  0:\n            # Forward difference for convection\n            sub_diag_val = -alpha\n            main_diag_val = 2 * alpha - beta * h\n            super_diag_val = -alpha + beta * h\n        else:  # beta == 0, pure diffusion\n            sub_diag_val = -alpha\n            main_diag_val = 2 * alpha\n            super_diag_val = -alpha\n\n        # Populate the tridiagonal matrix A\n        np.fill_diagonal(A, main_diag_val)\n        if N > 1:\n            np.fill_diagonal(A[1:], sub_diag_val)\n            np.fill_diagonal(A[:, 1:], super_diag_val)\n\n        # 4. Solve the linear system for the numerical solution T_h\n        T_h = np.linalg.solve(A, d)\n\n        # 5. Compute the discrete L2 error norm\n        nodal_errors = T_h - T_exact_interior\n        l2_error = np.sqrt(np.sum(nodal_errors**2) / N)\n\n        errors.append(l2_error)\n        h_values.append(h)\n\n    # 6. Compute convergence order p from the last two grid refinements\n    # E(h) -> errors[-2], E(tilde_h) -> errors[-1]\n    # h    -> h_values[-2], tilde_h   -> h_values[-1]\n    p = np.log(errors[-2] / errors[-1]) / np.log(h_values[-2] / h_values[-1])\n    \n    return p\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'alpha': 1e-2, 'beta': 1.0},    # Case 1\n        {'alpha': 1e-2, 'beta': -1.0},   # Case 2\n        {'alpha': 1e-6, 'beta': 1.0},    # Case 3\n        {'alpha': 1.0,   'beta': 0.0},    # Case 4\n    ]\n    \n    # Grid refinement sequence\n    N_list = [20, 40, 80, 160, 320]\n    \n    results = []\n    for case in test_cases:\n        alpha = case['alpha']\n        beta = case['beta']\n        \n        # Calculate the observed convergence order for the current case\n        p = solve_case(alpha, beta, N_list)\n        \n        # Round the result to three decimal places\n        results.append(round(p, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后，我们将稳定性和精度的理论概念与可触摸的物理结果联系起来。迎风格式的一阶精度表现为数值耗散，它会人为地“抹平”解中的陡峭梯度。这个动手问题要求你模拟一个对流-扩散边界层，并亲身观察这种效应。通过实现一个混合格式并将其数值结果与解析解进行比较，你将量化数值耗散如何影响对关键物理特征的预测。",
            "id": "3996963",
            "problem": "考虑一维、稳态、常物性条件下，在一个定义域 $x \\in [0,1]$ 内的被动标量场 $\\phi(x)$ 的对流扩散问题，其控制微分方程为\n$$\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0,$$\n边界条件为狄利克雷（Dirichlet）边界条件 $\\phi(0) = 1$ 和 $\\phi(1) = 0$。在此，$\\Gamma$ 是扩散系数，$\\rho u$ 是恒定的质量通量，长度尺度为 $L=1$。定义域长度佩克莱数（Péclet number）为 $Pe_L = \\rho u L / \\Gamma$，因此当 $L=1$ 时，我们有 $Pe_L = \\rho u / \\Gamma$。其解析解是一个边界层剖面，在出口 $x=1$ 附近从 $\\phi \\approx 1$ 过渡到 $\\phi = 0$，其边界层厚度取决于 $Pe_L$。\n\n您必须使用有限体积法（Finite Volume Method, FVM）在具有 $N$ 个等间距区间的均匀网格上对此问题进行离散化。对于以节点 $i$ 为中心、单元面位于 $x_{i-1/2}$ 和 $x_{i+1/2}$ 的控制体，使用线性差分近似扩散项的面梯度，并使用由参数 $\\beta \\in [0,1]$ 控制的混合迎风-中心差分格式来近似对流项的面值：\n- 对于右侧面，\n$$\\phi_{i+1/2} = \\beta\\, \\phi_i + (1-\\beta)\\,\\frac{\\phi_{i}+\\phi_{i+1}}{2},$$\n- 对于左侧面，\n$$\\phi_{i-1/2} = \\beta\\, \\phi_{i-1} + (1-\\beta)\\,\\frac{\\phi_{i-1}+\\phi_{i}}{2}.$$\n利用这些面值，控制体 $i$ 上的有限体积法平衡方程为\n$$\\Gamma\\left(\\frac{\\phi_{i+1}-\\phi_i}{\\Delta x} - \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\\right) - \\rho u\\left(\\phi_{i+1/2} - \\phi_{i-1/2}\\right) = 0,$$\n其中 $\\Delta x = 1/N$。\n\n您必须：\n1. 使用上述离散化方法，从第一性原理推导内部节点的线性系统系数，并明确展示 $\\beta$ 如何出现在系数中。\n2. 使用推导出的线性系统计算离散解 $\\phi_i$，其中 $i=0,1,\\dots,N$，且 $\\phi_0=1$ 和 $\\phi_N=0$。\n3. 将边界层厚度定义为从出口 $x=1$ 到 $\\phi$ 首次等于阈值 $r=0.5$ 的位置之间的无量纲距离 $\\delta_{r}$：\n   $$\\delta_r = 1 - x_r,$$\n   其中 $x_r$ 满足 $\\phi(x_r) = r$；对于解析解，证明\n   $$x_r = \\frac{1}{Pe_L}\\,\\ln\\!\\left(r + (1-r)\\,e^{Pe_L}\\right),\\quad \\delta_r^{\\text{exact}} = 1 - x_r.$$\n   在离散解中，通过在出口附近跨越 $r$ 的第一对相邻节点之间进行线性插值来定位 $x_r$。\n4. 将边界层厚度的绝对误差量化为\n   $$\\varepsilon = \\left|\\delta_r^{\\text{num}} - \\delta_r^{\\text{exact}}\\right|.$$\n\n实现一个完整、可运行的程序，对以下测试套件执行这些步骤。对于每种情况，使用 $\\rho u = 1$（无量纲）并选择 $\\Gamma = 1/Pe_L$ 以匹配指定的佩克莱数。网格是均匀的，厚度 $\\delta_r$ 是无量纲的，表示为域长度的一部分。\n\n测试套件参数集 $(N, Pe_L, \\beta)$:\n- 情况 1 (通用，理想路径): $(300, 20, 1.0)$。\n- 情况 2 (相同 $Pe_L$，减小 $\\beta$ 以显示变薄): $(300, 20, 0.2)$。\n- 情况 3 (高 $Pe_L$ 薄层): $(1000, 100, 1.0)$。\n- 情况 4 (高 $Pe_L$ 与混合): $(1000, 100, 0.7)$。\n- 情况 5 (低 $Pe_L$ 中心差分稳定区域): $(100, 2, 0.0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。列表中的每个元素本身必须是对应测试用例的浮点数组成的双元素列表 $[\\delta_r^{\\text{num}}, \\varepsilon]$，顺序与上面列出的顺序相同。例如，最终输出应如下所示\n$$\\text{[}[d_1,e_1],[d_2,e_2],[d_3,e_3],[d_4,e_4],[d_5,e_5]\\text{]}.$$\n所有量均为无量纲，最终的数值应以浮点数形式打印。不允许外部输入。",
            "solution": "用户提供的问题是有效的。它具有科学依据，是适定的、客观的，并且包含推导唯一解所需的所有必要信息。该问题涉及使用指定的有限体积法（FVM）和混合离散格式，对一维稳态对流扩散方程进行数值求解。该方程是输运现象中的一个基本模型。推导代数系统、求解该系统并分析派生量（边界层厚度）的准确性，这是计算流体动力学和传热学中一个标准且定义明确的练习。\n\n我们首先按要求正式推导求解过程。\n\n被动标量 $\\phi(x)$ 的稳态一维对流扩散的控制方程如下：\n$$ \\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0 $$\n适用于 $x \\in [0, 1]$，其中扩散系数 $\\Gamma$ 和质量通量 $\\rho u$ 为常数。边界条件为 $\\phi(0) = 1$ 和 $\\phi(1) = 0$。\n\n### 1. 有限体积离散化与系数推导\n\n我们将域 $x \\in [0, 1]$ 离散化为 $N$ 个均匀的控制体，每个控制体的宽度为 $\\Delta x = 1/N$。节点 $x_i = i \\Delta x$（$i=0, 1, \\dots, N$）位于每个控制体的中心，边界节点除外。节点 $i$ 的控制体面位于 $x_{i-1/2}$ 和 $x_{i+1/2}$。\n\n我们将控制方程在第 $i$ 个控制体上进行积分，从 $x_{i-1/2}$ 到 $x_{i+1/2}$：\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left[ \\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\frac{d}{dx}(\\rho u \\phi) \\right] dx = 0 $$\n应用微积分基本定理，我们得到有限体积法平衡方程的守恒形式：\n$$ \\left[ \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi \\right]_{x_{i+1/2}} - \\left[ \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi \\right]_{x_{i-1/2}} = 0 $$\n这可以写成通过控制体面的净通量为零：\n$$ \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i+1/2} - (\\rho u \\phi)_{i+1/2} - \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i-1/2} + (\\rho u \\phi)_{i-1/2} = 0 $$\n现在我们引入指定的近似方法。扩散通量使用节点之间的线性差分进行近似：\n$$ \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i+1/2} \\approx \\Gamma \\frac{\\phi_{i+1}-\\phi_i}{\\Delta x} \\quad \\text{和} \\quad \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i-1/2} \\approx \\Gamma \\frac{\\phi_i-\\phi_{i-1}}{\\Delta x} $$\n面上的对流项值 $\\phi$ 使用由参数 $\\beta \\in [0, 1]$ 控制的混合迎风-中心差分格式进行近似。对于正质量通量 $\\rho u > 0$，迎风方向来自左侧。\n$$ (\\rho u \\phi)_{i+1/2} \\approx \\rho u \\left[ \\beta\\, \\phi_i + (1-\\beta)\\,\\frac{\\phi_{i}+\\phi_{i+1}}{2} \\right] $$\n$$ (\\rho u \\phi)_{i-1/2} \\approx \\rho u \\left[ \\beta\\, \\phi_{i-1} + (1-\\beta)\\,\\frac{\\phi_{i-1}+\\phi_{i}}{2} \\right] $$\n我们来简化面值的表达式：\n$$ \\phi_{i+1/2} = \\left(\\beta + \\frac{1-\\beta}{2}\\right)\\phi_i + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i+1} = \\frac{1+\\beta}{2}\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} $$\n$$ \\phi_{i-1/2} = \\left(\\beta + \\frac{1-\\beta}{2}\\right)\\phi_{i-1} + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i} = \\frac{1+\\beta}{2}\\phi_{i-1} + \\frac{1-\\beta}{2}\\phi_{i} $$\n将这些代入通量平衡方程：\n$$ \\left(\\Gamma \\frac{\\phi_{i+1}-\\phi_i}{\\Delta x}\\right) - \\left(\\Gamma \\frac{\\phi_i-\\phi_{i-1}}{\\Delta x}\\right) - \\rho u \\left( \\phi_{i+1/2} - \\phi_{i-1/2} \\right) = 0 $$\n对流项面值的差值为：\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = \\left(\\frac{1+\\beta}{2}\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1}\\right) - \\left(\\frac{1+\\beta}{2}\\phi_{i-1} + \\frac{1-\\beta}{2}\\phi_{i}\\right) $$\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = -\\left(\\frac{1+\\beta}{2}\\right)\\phi_{i-1} + \\left(\\frac{1+\\beta}{2} - \\frac{1-\\beta}{2}\\right)\\phi_i + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i+1} $$\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = -\\frac{1+\\beta}{2}\\phi_{i-1} + \\beta\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} $$\n将此结果代回离散化方程中，得到：\n$$ \\frac{\\Gamma}{\\Delta x}(\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}) - \\rho u \\left( -\\frac{1+\\beta}{2}\\phi_{i-1} + \\beta\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} \\right) = 0 $$\n现在，我们可以按节点值 $\\phi_{i-1}$、$\\phi_i$ 和 $\\phi_{i+1}$ 对各项进行分组，得到线性代数方程 $a_W \\phi_{i-1} + a_P \\phi_i + a_E \\phi_{i+1} = 0$：\n$$ \\left(\\frac{\\Gamma}{\\Delta x} + \\rho u \\frac{1+\\beta}{2}\\right)\\phi_{i-1} + \\left(-2\\frac{\\Gamma}{\\Delta x} - \\rho u \\beta\\right)\\phi_i + \\left(\\frac{\\Gamma}{\\Delta x} - \\rho u \\frac{1-\\beta}{2}\\right)\\phi_{i+1} = 0 $$\n因此，线性系统的系数为：\n$$ a_W = \\frac{\\Gamma}{\\Delta x} + \\rho u \\frac{1+\\beta}{2} $$\n$$ a_E = \\frac{\\Gamma}{\\Delta x} - \\rho u \\frac{1-\\beta}{2} $$\n$$ a_P = -2\\frac{\\Gamma}{\\Delta x} - \\rho u \\beta = -(a_W + a_E) $$\n这些系数明确地依赖于混合参数 $\\beta$。当 $\\beta=1$ 时，该格式为一阶迎风格式。当 $\\beta=0$ 时，为二阶中心差分格式。\n\n### 2. 线性系统求解\n\n推导出的代数方程适用于所有内部节点 $i=1, 2, \\dots, N-1$。这构成了一个包含 $N-1$ 个线性方程的方程组，用于求解 $N-1$ 个未知值 $\\phi_1, \\dots, \\phi_{N-1}$。边界值 $\\phi_0=1$ 和 $\\phi_N=0$ 是已知的。\n\n对于第一个内部节点（$i=1$）：\n$ a_W \\phi_0 + a_P \\phi_1 + a_E \\phi_2 = 0 \\implies a_P \\phi_1 + a_E \\phi_2 = -a_W \\phi_0 = -a_W $\n\n对于一个通用内部节点（$i=2, \\dots, N-2$）：\n$ a_W \\phi_{i-1} + a_P \\phi_i + a_E \\phi_{i+1} = 0 $\n\n对于最后一个内部节点（$i=N-1$）：\n$ a_W \\phi_{N-2} + a_P \\phi_{N-1} + a_E \\phi_N = 0 \\implies a_W \\phi_{N-2} + a_P \\phi_{N-1} = -a_E \\phi_N = 0 $\n\n该方程组可以写成矩阵形式 $A\\Phi = b$，其中 $\\Phi = [\\phi_1, \\dots, \\phi_{N-1}]^T$ 是未知数向量。矩阵 $A$ 是一个大小为 $(N-1) \\times (N-1)$ 的三对角矩阵，其主对角线由 $a_P$ 构成，次对角线由 $a_W$ 构成，超对角线由 $a_E$ 构成。右端项向量 $b$ 为 $[-a_W, 0, \\dots, 0]^T$。这种三对角系统可以被高效求解。\n\n### 3. 边界层厚度与解析解\n\n控制常微分方程（ODE）的解析解是通过求解 $\\phi'' - Pe_L \\cdot \\phi' = 0$ 得到的，其中佩克莱数 $Pe_L = \\rho u L / \\Gamma$ 且 $L=1$。通解为 $\\phi(x) = C_1 + C_2 e^{Pe_L \\cdot x}$。应用边界条件 $\\phi(0)=1$ 和 $\\phi(1)=0$ 可以得到常数 $C_1$ 和 $C_2$，从而得出精确解：\n$$ \\phi(x) = \\frac{e^{Pe_L} - e^{Pe_L \\cdot x}}{e^{Pe_L} - 1} $$\n边界层厚度 $\\delta_r$ 是相对于阈值 $\\phi(x_r) = r$ 定义的。我们求解 $x_r$：\n$$ r = \\frac{e^{Pe_L} - e^{Pe_L \\cdot x_r}}{e^{Pe_L} - 1} \\implies e^{Pe_L \\cdot x_r} = e^{Pe_L} - r(e^{Pe_L} - 1) = (1-r)e^{Pe_L} + r $$\n取自然对数并求解 $x_r$：\n$$ x_r = \\frac{1}{Pe_L} \\ln\\left(r + (1-r)e^{Pe_L}\\right) $$\n那么，精确的边界层厚度为 $\\delta_r^{\\text{exact}} = 1 - x_r$。\n\n在数值上，一旦计算出离散解 $\\phi_i$，我们就找到在出口附近跨越阈值 $r$ 的一对相邻节点 $(i-1, i)$（即 $\\phi_i \\le r  \\phi_{i-1}$）。通过线性插值找到位置 $x_r$：\n$$ \\frac{x_r - x_{i-1}}{x_i - x_{i-1}} = \\frac{r - \\phi_{i-1}}{\\phi_i - \\phi_{i-1}} \\implies x_r^{\\text{num}} = x_{i-1} + \\Delta x \\frac{r - \\phi_{i-1}}{\\phi_i - \\phi_{i-1}} $$\n数值计算的边界层厚度为 $\\delta_r^{\\text{num}} = 1 - x_r^{\\text{num}}$。绝对误差为 $\\varepsilon = |\\delta_r^{\\text{num}} - \\delta_r^{\\text{exact}}|$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D convection-diffusion problem for a series of test cases\n    and calculates the boundary layer thickness and its error.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Pe_L, beta)\n        (300, 20.0, 1.0),   # Case 1\n        (300, 20.0, 0.2),   # Case 2\n        (1000, 100.0, 1.0), # Case 3\n        (1000, 100.0, 0.7), # Case 4\n        (100, 2.0, 0.0)     # Case 5\n    ]\n    \n    results = []\n    \n    # Shared parameters for all cases\n    rho_u = 1.0\n    L = 1.0\n    r = 0.5  # Threshold for boundary layer thickness calculation\n    phi_0 = 1.0\n    phi_N = 0.0\n\n    for N, Pe_L, beta in test_cases:\n        # --- Problem Setup ---\n        Gamma = rho_u * L / Pe_L if Pe_L != 0 else np.inf\n        delta_x = L / N\n        num_interior_nodes = N - 1\n\n        # --- Calculate FVM Coefficients ---\n        D = Gamma / delta_x  # Diffusive conductance\n        F = rho_u            # Convective flux strength\n\n        a_W = D + F * (1.0 + beta) / 2.0\n        a_E = D - F * (1.0 - beta) / 2.0\n        a_P = -(a_W + a_E)\n\n        # --- Assemble and Solve Linear System ---\n        # Matrix A is tridiagonal with size (N-1) x (N-1)\n        # scipy.linalg.solve_banded expects bands in a specific format (l, u)\n        # Here l=1 (sub-diagonal), u=1 (super-diagonal)\n        A_banded = np.zeros((3, num_interior_nodes))\n        A_banded[0, 1:] = a_E      # Super-diagonal (u)\n        A_banded[1, :] = a_P         # Main diagonal\n        A_banded[2, :-1] = a_W     # Sub-diagonal (l)\n\n        # Right-hand-side vector b\n        b = np.zeros(num_interior_nodes)\n        b[0] = -a_W * phi_0 # Contribution from phi_0 at node i=1\n        # b[-1] is not modified since phi_N=0\n\n        # Solve for interior nodes phi_1, ..., phi_{N-1}\n        phi_interior = solve_banded((1, 1), A_banded, b)\n\n        # Construct full solution vector [phi_0, ..., phi_N]\n        phi_numerical = np.concatenate(([phi_0], phi_interior, [phi_N]))\n\n        # --- Calculate Analytical Boundary Layer Thickness ---\n        # Handle Pe_L=0 case to avoid division by zero\n        if Pe_L > 1e-9:\n             x_r_exact = (1.0 / Pe_L) * np.log(r + (1.0 - r) * np.exp(Pe_L))\n        else: # Limit as Pe_L -> 0, linear profile\n             x_r_exact = L * (1.0 - r)\n        delta_r_exact = L - x_r_exact\n        \n        # --- Calculate Numerical Boundary Layer Thickness ---\n        x_nodes = np.linspace(0, L, N + 1)\n        \n        # Find the interval (i-1, i) where phi crosses the threshold r\n        # We search from the outlet (x=L) backwards\n        x_r_num = -1.0 # Initialize with a sentinel value\n        for i in range(N, 0, -1):\n            if phi_numerical[i] = r  phi_numerical[i-1]:\n                # Linearly interpolate to find x_r where phi(x_r) = r\n                phi_hi = phi_numerical[i-1]\n                phi_lo = phi_numerical[i]\n                x_hi = x_nodes[i-1]\n                x_lo = x_nodes[i]\n                \n                # Check for division by zero, although not expected with monotonic solution\n                if abs(phi_lo - phi_hi) > 1e-12:\n                    x_r_num = x_hi + (x_lo - x_hi) * (r - phi_hi) / (phi_lo - phi_hi)\n                else: # Fallback in case of flat profile segment\n                    x_r_num = (x_hi + x_lo) / 2.0\n                break\n        \n        if x_r_num == -1.0:\n            # This case should not be reached with the given test inputs\n            # as the boundary layer is always resolved to some degree.\n            # It would indicate the solution is almost constant at 1.0.\n            # A failsafe could be to set error to a large value or NaN.\n            # Here we assume it's always found.\n            delta_r_num = np.nan\n            error = np.nan\n        else:\n            delta_r_num = L - x_r_num\n            # --- Calculate Absolute Error ---\n            error = np.abs(delta_r_num - delta_r_exact)\n\n        results.append([delta_r_num, error])\n\n    # Final print statement in the exact required format.\n    # The str() of a list is \"[...]\", which matches the required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}