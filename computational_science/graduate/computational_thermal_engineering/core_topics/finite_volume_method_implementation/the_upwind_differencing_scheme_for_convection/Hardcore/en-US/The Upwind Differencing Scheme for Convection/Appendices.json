{
    "hands_on_practices": [
        {
            "introduction": "Before deploying a numerical scheme in complex simulations, we must rigorously verify that our code is implemented correctly. This practice introduces the Method of Manufactured Solutions (MMS), a powerful technique for code verification. By choosing a known analytical solution, we can derive a corresponding source term and use it to test whether our numerical solver achieves its theoretical order of accuracy, which for the upwind scheme is first-order in space. ",
            "id": "3996964",
            "problem": "Consider the steady one-dimensional ($1$D) convection-diffusion balance for a passive scalar (temperature) field $T(x)$ over the domain $x \\in [0,1]$ with constant properties, expressed by the conservation statement\n$$\n- \\alpha \\frac{d^2 T}{dx^2} + \\beta \\frac{d T}{dx} = S(x),\n$$\nwhere $\\alpha  0$ is the diffusivity, $\\beta$ is a constant convection coefficient, and $S(x)$ is a volumetric source term. The Method of Manufactured Solutions (MMS) prescribes choosing a smooth, nontrivial exact solution $T_{\\text{exact}}(x)$ and deducing $S(x)$ so that $T_{\\text{exact}}(x)$ satisfies the differential equation. You will use MMS to verify the observed spatial convergence order of the Upwind Differencing Scheme (UDS) for the convection term in a finite difference discretization, combined with a second-order central difference for diffusion, under Dirichlet boundary conditions consistent with $T_{\\text{exact}}(x)$. All quantities are nondimensional. No physical units are required.\n\nStarting from the conservation law above, perform the following:\n- Choose the manufactured solution $T_{\\text{exact}}(x) = \\sin(2\\pi x)$ and compute the source term $S(x)$ implied by the governing equation for given constants $\\alpha$ and $\\beta$. Impose Dirichlet boundary conditions $T(0) = T_{\\text{exact}}(0)$ and $T(1) = T_{\\text{exact}}(1)$.\n- Discretize the domain $[0,1]$ with a uniform grid of $N$ interior nodes (grid spacing $h = 1/(N+1)$). At each interior node, approximate the diffusion term with a second-order central difference stencil and the convection term with the Upwind Differencing Scheme (UDS) that uses the one-sided finite difference aligned with the sign of $\\beta$. Assemble and solve the resulting linear system for the discrete approximation $T_h$.\n- For each grid, compute the nodal error $e_i = T_h(x_i) - T_{\\text{exact}}(x_i)$ at interior nodes $x_i = i h$ for $i = 1,2,\\dots,N$, and the discrete $L_2$ error norm defined as $E(h) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N e_i^2}$.\n- Estimate the observed spatial convergence order between two successive refinements with spacings $h$ and $\\tilde{h}$ as\n$$\np = \\frac{\\ln\\left(E(h)/E(\\tilde{h})\\right)}{\\ln\\left(h/\\tilde{h}\\right)}.\n$$\n\nYour program must evaluate the observed order $p$ for the following test suite, using the last two grid refinements from $N \\in \\{20,40,80,160,320\\}$ to compute $p$ for each case:\n- Case $1$ (happy path): $\\alpha = 10^{-2}$, $\\beta = 1$.\n- Case $2$ (flow reversal): $\\alpha = 10^{-2}$, $\\beta = -1$.\n- Case $3$ (strongly convection-dominated): $\\alpha = 10^{-6}$, $\\beta = 1$.\n- Case $4$ (diffusion-only edge case): $\\alpha = 1$, $\\beta = 0$.\n\nThe expected behavior is that cases with nonzero $\\beta$ exhibit approximately first-order spatial convergence due to UDS, while the diffusion-only case exhibits approximately second-order convergence due to the central difference scheme.\n\nFinal output specification:\n- For each case, output the single float $p$ rounded to three decimals.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of cases $1$ through $4$, for example, $[p_1,p_2,p_3,p_4]$.\n- The angle unit is not applicable. No physical units are required and no percentages are to be used anywhere; all values must be represented as decimals.\n\nEnsure scientific realism and self-consistency. Implementations must directly reflect the described principles without using shortcut formulas not justified by the stated conservation law and finite difference definitions.",
            "solution": "The problem is valid as it presents a standard, well-posed verification exercise for a numerical method using the established Method of Manufactured Solutions (MMS). All components—the governing physical equation, the numerical schemes, and the analysis procedure—are scientifically sound and clearly defined.\n\nThe solution process involves four main steps: derivation of the source term, discretization of the governing equation, assembly and solution of the linear system, and computation of the convergence order.\n\n**1. Source Term Derivation**\nThe governing equation is the one-dimensional steady convection-diffusion equation:\n$$\n- \\alpha \\frac{d^2 T}{dx^2} + \\beta \\frac{d T}{dx} = S(x)\n$$\nThe Method of Manufactured Solutions (MMS) requires us to choose an exact solution, $T_{\\text{exact}}(x)$, and substitute it into the governing equation to derive the corresponding source term $S(x)$ that makes the equation true. The chosen manufactured solution is:\n$$\nT_{\\text{exact}}(x) = \\sin(2\\pi x)\n$$\nWe compute its first and second derivatives with respect to $x$:\n$$\n\\frac{dT_{\\text{exact}}}{dx} = 2\\pi \\cos(2\\pi x)\n$$\n$$\n\\frac{d^2T_{\\text{exact}}}{dx^2} = -4\\pi^2 \\sin(2\\pi x)\n$$\nSubstituting these derivatives into the governing equation gives the source term $S(x)$:\n$$\nS(x) = - \\alpha \\left(-4\\pi^2 \\sin(2\\pi x)\\right) + \\beta \\left(2\\pi \\cos(2\\pi x)\\right)\n$$\n$$\nS(x) = 4\\alpha\\pi^2 \\sin(2\\pi x) + 2\\beta\\pi \\cos(2\\pi x)\n$$\nThe Dirichlet boundary conditions are evaluated from the manufactured solution at the domain boundaries $x=0$ and $x=1$:\n$$\nT(0) = T_{\\text{exact}}(0) = \\sin(0) = 0\n$$\n$$\nT(1) = T_{\\text{exact}}(1) = \\sin(2\\pi) = 0\n$$\n\n**2. Finite Difference Discretization**\nThe domain $x \\in [0,1]$ is discretized using a uniform grid with $N$ interior nodes. The grid points are indexed from $i=0$ to $i=N+1$, such that $x_i = i h$, where the grid spacing is $h = 1/(N+1)$. The numerical solution $T_h$ seeks to approximate $T_{\\text{exact}}$ at the interior nodes $x_i$ for $i=1, 2, \\dots, N$. The unknown values are $T_i \\equiv T_h(x_i)$.\n\nThe discrete form of the governing equation at an interior node $x_i$ is:\n$$\n- \\alpha \\left(\\frac{d^2 T}{dx^2}\\right)_i + \\beta \\left(\\frac{d T}{dx}\\right)_i = S(x_i)\n$$\nThe diffusion term is approximated using a second-order central difference stencil:\n$$\n\\left(\\frac{d^2 T}{dx^2}\\right)_i \\approx \\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\n$$\nThe convection term is approximated using the first-order Upwind Differencing Scheme (UDS), where the stencil depends on the sign of the convection coefficient $\\beta$.\n- If $\\beta  0$ (flow is in the positive $x$-direction), a backward difference is used:\n$$\n\\left(\\frac{d T}{dx}\\right)_i \\approx \\frac{T_i - T_{i-1}}{h}\n$$\n- If $\\beta  0$ (flow is in the negative $x$-direction), a forward difference is used:\n$$\n\\left(\\frac{d T}{dx}\\right)_i \\approx \\frac{T_{i+1} - T_i}{h}\n$$\n- If $\\beta = 0$, the convection term is zero.\n\nSubstituting these approximations into the governing equation and rearranging yields a linear algebraic equation for each node $i$.\n\n**Case 1: $\\beta  0$**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) + \\beta \\left(\\frac{T_i - T_{i-1}}{h}\\right) = S_i\n$$\nMultiplying by $h^2$ and grouping terms by unknown $T_j$:\n$$\n(-\\alpha - \\beta h)T_{i-1} + (2\\alpha + \\beta h)T_i + (-\\alpha)T_{i+1} = h^2 S_i\n$$\n\n**Case 2: $\\beta  0$**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) + \\beta \\left(\\frac{T_{i+1} - T_i}{h}\\right) = S_i\n$$\nMultiplying by $h^2$ and grouping terms:\n$$\n(-\\alpha)T_{i-1} + (2\\alpha - \\beta h)T_i + (-\\alpha + \\beta h)T_{i+1} = h^2 S_i\n$$\n\n**Case 3: $\\beta = 0$ (Pure Diffusion)**\n$$\n-\\alpha \\left(\\frac{T_{i-1} - 2T_i + T_{i+1}}{h^2}\\right) = S_i\n$$\n$$\n(-\\alpha)T_{i-1} + (2\\alpha)T_i + (-\\alpha)T_{i+1} = h^2 S_i\n$$\n\n**3. Linear System Assembly and Solution**\nThe set of $N$ linear equations for the interior nodes $i=1, \\dots, N$ forms a matrix system $A\\mathbf{T}_h = \\mathbf{d}$, where $\\mathbf{T}_h = [T_1, T_2, \\dots, T_N]^T$ is the vector of unknown nodal temperatures. The matrix $A$ is an $N \\times N$ tridiagonal matrix, and $\\mathbf{d}$ is the right-hand side vector.\n\nThe elements of $A$ are the coefficients derived above. For a general row $i$ (representing node $x_i$), the main diagonal entry is $A_{i,i}$, the sub-diagonal is $A_{i,i-1}$, and the super-diagonal is $A_{i,i+1}$. The vector $\\mathbf{d}$ has entries $d_i = h^2 S(x_i)$.\n\nThe boundary conditions $T_0=0$ and $T_{N+1}=0$ affect the first ($i=1$) and last ($i=N$) equations. The terms $T_0$ and $T_{N+1}$ are known and are moved to the right-hand side. Since they are both zero, the right-hand side vector $\\mathbf{d}$ is unaffected.\n\nThe resulting tridiagonal system is solved for $\\mathbf{T}_h$ for each grid configuration.\n\n**4. Error Analysis and Convergence Order**\nAfter obtaining the numerical solution $\\mathbf{T}_h$, the error is computed with respect to the known exact solution. The nodal error at each interior node is $e_i = T_i - T_{\\text{exact}}(x_i)$. The overall error for a given grid spacing $h$ is measured using the discrete $L_2$ norm:\n$$\nE(h) = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N e_i^2}\n$$\nThe observed order of spatial convergence, $p$, is estimated by performing simulations on two grids with different spacings, $h$ and $\\tilde{h}$ (where $\\tilde{h}  h$). The formula is:\n$$\np = \\frac{\\ln\\left(E(h)/E(\\tilde{h})\\right)}{\\ln\\left(h/\\tilde{h}\\right)}\n$$\nFor this problem, $p$ is calculated for each $(\\alpha, \\beta)$ case using the results from the two finest grids, corresponding to $N=160$ ($h=1/161$) and $N=320$ ($\\tilde{h}=1/321$). The expected order is $p \\approx 1$ for cases with convection ($\\beta \\neq 0$) due to the first-order UDS, and $p \\approx 2$ for the pure diffusion case ($\\beta = 0$) due to the second-order central difference scheme for the diffusion term.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_case(alpha, beta, N_list):\n    \"\"\"\n    Solves a single case for a given alpha, beta, and list of grid sizes N.\n    \n    This function implements the Method of Manufactured Solutions (MMS) to\n    verify the spatial convergence order of a finite difference scheme for the\n    1D steady convection-diffusion equation. It calculates the L2 error for a\n    series of refined grids and then computes the observed order of convergence\n    from the last two refinements.\n\n    Args:\n        alpha (float): The diffusivity coefficient.\n        beta (float): The convection coefficient.\n        N_list (list of int): A list of the number of interior grid nodes for each refinement.\n\n    Returns:\n        float: The observed spatial order of convergence, p.\n    \"\"\"\n    errors = []\n    h_values = []\n\n    for N in N_list:\n        # 1. Setup grid\n        h = 1.0 / (N + 1)\n        # We only need interior nodes for setting up and solving the system\n        x_interior = np.linspace(h, 1.0 - h, N)\n\n        # 2. Compute manufactured solution and source term at interior nodes\n        T_exact_interior = np.sin(2 * np.pi * x_interior)\n        S_interior = (4 * alpha * np.pi**2 * np.sin(2 * np.pi * x_interior) +\n                      2 * beta * np.pi * np.cos(2 * np.pi * x_interior))\n        \n        # 3. Assemble the linear system A * T_h = d\n        A = np.zeros((N, N))\n        d = h**2 * S_interior\n        # The boundary conditions T(0)=0 and T(1)=0 are homogeneous, so they\n        # do not contribute to the right-hand side vector d.\n\n        # Define tridiagonal coefficients based on the sign of beta (Upwind Scheme)\n        if beta  0:\n            # Backward difference for convection\n            sub_diag_val = -alpha - beta * h\n            main_diag_val = 2 * alpha + beta * h\n            super_diag_val = -alpha\n        elif beta  0:\n            # Forward difference for convection\n            sub_diag_val = -alpha\n            main_diag_val = 2 * alpha - beta * h\n            super_diag_val = -alpha + beta * h\n        else:  # beta == 0, pure diffusion\n            sub_diag_val = -alpha\n            main_diag_val = 2 * alpha\n            super_diag_val = -alpha\n\n        # Populate the tridiagonal matrix A\n        np.fill_diagonal(A, main_diag_val)\n        if N  1:\n            np.fill_diagonal(A[1:], sub_diag_val)\n            np.fill_diagonal(A[:, 1:], super_diag_val)\n\n        # 4. Solve the linear system for the numerical solution T_h\n        T_h = np.linalg.solve(A, d)\n\n        # 5. Compute the discrete L2 error norm\n        nodal_errors = T_h - T_exact_interior\n        l2_error = np.sqrt(np.sum(nodal_errors**2) / N)\n\n        errors.append(l2_error)\n        h_values.append(h)\n\n    # 6. Compute convergence order p from the last two grid refinements\n    # E(h) - errors[-2], E(tilde_h) - errors[-1]\n    # h    - h_values[-2], tilde_h   - h_values[-1]\n    p = np.log(errors[-2] / errors[-1]) / np.log(h_values[-2] / h_values[-1])\n    \n    return p\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'alpha': 1e-2, 'beta': 1.0},    # Case 1\n        {'alpha': 1e-2, 'beta': -1.0},   # Case 2\n        {'alpha': 1e-6, 'beta': 1.0},    # Case 3\n        {'alpha': 1.0,   'beta': 0.0},    # Case 4\n    ]\n    \n    # Grid refinement sequence\n    N_list = [20, 40, 80, 160, 320]\n    \n    results = []\n    for case in test_cases:\n        alpha = case['alpha']\n        beta = case['beta']\n        \n        # Calculate the observed convergence order for the current case\n        p = solve_case(alpha, beta, N_list)\n        \n        # Round the result to three decimal places\n        results.append(round(p, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having verified the basic implementation, we now explore the physical consequences of the upwind scheme's properties, particularly its inherent numerical diffusion. We will tackle a steady convection-diffusion problem that produces a sharp boundary layer, a feature highly sensitive to numerical errors. This exercise demonstrates how the artificial diffusion from the first-order upwind scheme can \"smear\" sharp gradients and how blending it with a non-dissipative central difference scheme allows us to control and visualize this effect. ",
            "id": "3996963",
            "problem": "Consider the one-dimensional, steady-state, constant-property convection-diffusion of a passive scalar field $\\phi(x)$ in a domain $x \\in [0,1]$ governed by the differential equation\n$$\\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0,$$\nwith Dirichlet boundary conditions $\\phi(0) = 1$ and $\\phi(1) = 0$. Here, $\\Gamma$ is the diffusion coefficient, $\\rho u$ is the constant mass flux, and the length scale is $L=1$. Define the domain-length Peclet number as $Pe = \\rho u L / \\Gamma$, so that for $L=1$ we have $Pe = \\rho u / \\Gamma$. The analytical solution is a boundary layer profile that transitions from $\\phi \\approx 1$ to $\\phi = 0$ near the outlet $x=1$, with the layer thickness depending on $Pe$.\n\nYou must discretize this problem using a Finite Volume Method (FVM) on a uniform mesh with $N$ equal intervals. For a control volume centered at node $i$ with cell faces located at $x_{i-1/2}$ and $x_{i+1/2}$, approximate diffusive face gradients by linear differences and approximate the convective face values using a blended upwind-central scheme controlled by a parameter $\\beta \\in [0,1]$:\n- For the right face,\n$$\\phi_{i+1/2} = \\beta\\, \\phi_i + (1-\\beta)\\,\\frac{\\phi_{i}+\\phi_{i+1}}{2},$$\n- For the left face,\n$$\\phi_{i-1/2} = \\beta\\, \\phi_{i-1} + (1-\\beta)\\,\\frac{\\phi_{i-1}+\\phi_{i}}{2}.$$\nWith these face values, the FVM balance over control volume $i$ is\n$$\\Gamma\\left(\\frac{\\phi_{i+1}-\\phi_i}{\\Delta x} - \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\\right) - \\rho u\\left(\\phi_{i+1/2} - \\phi_{i-1/2}\\right) = 0,$$\nwhere $\\Delta x = 1/N$.\n\nYou must:\n1. Derive from first principles the linear system coefficients for interior nodes using the above discretizations, explicitly showing how $\\beta$ appears in the coefficients.\n2. Use the derived linear system to compute the discrete solution $\\phi_i$ for $i=0,1,\\dots,N$, with $\\phi_0=1$ and $\\phi_N=0$.\n3. Define the boundary layer thickness as the non-dimensional distance $\\delta_{r}$ from the outlet at $x=1$ to the location where $\\phi$ first equals the threshold $r=0.5$:\n   $$\\delta_r = 1 - x_r,$$\n   where $x_r$ satisfies $\\phi(x_r) = r$; for the analytical solution, show that\n   $$x_r = \\frac{1}{Pe}\\,\\ln\\!\\left(r + (1-r)\\,e^{Pe}\\right),\\quad \\delta_r^{\\text{exact}} = 1 - x_r.$$\n   In the discrete solution, locate $x_r$ by linear interpolation between the first pair of neighboring nodes that straddle $r$ near the outlet.\n4. Quantify the absolute error in the boundary layer thickness as\n   $$\\varepsilon = \\left|\\delta_r^{\\text{num}} - \\delta_r^{\\text{exact}}\\right|.$$\n\nImplement a complete, runnable program that performs these steps for the following test suite. For each case, use $\\rho u = 1$ (non-dimensional) and select $\\Gamma = 1/Pe$ to match the specified Peclet number. The mesh is uniform and the thickness $\\delta_r$ is non-dimensional, expressed as a fraction of the domain length.\n\nTest suite parameter sets $(N,Pe,\\beta)$:\n- Case 1 (general, happy path): $(300, 20, 1.0)$.\n- Case 2 (same $Pe$ with reduced $\\beta$ to show thinning): $(300, 20, 0.2)$.\n- Case 3 (high-$Pe$ thin layer): $(1000, 100, 1.0)$.\n- Case 4 (high-$Pe$ with blending): $(1000, 100, 0.7)$.\n- Case 5 (low-$Pe$ central differencing stable regime): $(100, 2, 0.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list must itself be a two-element list $[\\delta_r^{\\text{num}}, \\varepsilon]$ of floats for the corresponding test case, in the same order as listed above. For example, the final output should look like\n$$\\text{[}[d_1,e_1],[d_2,e_2],[d_3,e_3],[d_4,e_4],[d_5,e_5]\\text{]}.$$\nAll quantities are non-dimensional, and the final numerical values should be printed as floats. No external input is allowed.",
            "solution": "The user-provided problem is valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution. The problem concerns the numerical solution of the one-dimensional steady-state convection-diffusion equation, a fundamental model in transport phenomena, using a specified Finite Volume Method (FVM) with a blended discretization scheme. The request to derive the algebraic system, solve it, and analyze the accuracy of a derived quantity (boundary layer thickness) is a standard and well-defined exercise in computational fluid dynamics and heat transfer.\n\nWe begin by formally deriving the solution as requested.\n\nThe governing equation for the steady-state, one-dimensional convection-diffusion of a passive scalar $\\phi(x)$ is given as:\n$$ \\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\rho u \\frac{d \\phi}{dx} = 0 $$\nfor $x \\in [0, 1]$, with constant diffusion coefficient $\\Gamma$ and constant mass flux $\\rho u$. The boundary conditions are $\\phi(0) = 1$ and $\\phi(1) = 0$.\n\n### 1. Finite Volume Discretization and Coefficient Derivation\n\nWe discretize the domain $x \\in [0, 1]$ into $N$ uniform control volumes, each of width $\\Delta x = 1/N$. The nodes $x_i = i \\Delta x$ for $i=0, 1, \\dots, N$ are at the center of each control volume, except for the boundary nodes. The faces of the control volume for node $i$ are at $x_{i-1/2}$ and $x_{i+1/2}$.\n\nWe integrate the governing equation over the $i$-th control volume, from $x_{i-1/2}$ to $x_{i+1/2}$:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left[ \\frac{d}{dx}\\left(\\Gamma \\frac{d \\phi}{dx}\\right) - \\frac{d}{dx}(\\rho u \\phi) \\right] dx = 0 $$\nApplying the fundamental theorem of calculus, we obtain the conservative form of the FVM balance:\n$$ \\left[ \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi \\right]_{x_{i+1/2}} - \\left[ \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi \\right]_{x_{i-1/2}} = 0 $$\nThis can be written as the net flux through the control volume faces being zero:\n$$ \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i+1/2} - (\\rho u \\phi)_{i+1/2} - \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i-1/2} + (\\rho u \\phi)_{i-1/2} = 0 $$\nWe now introduce the specified approximations. The diffusive fluxes are approximated using linear differences between nodes:\n$$ \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i+1/2} \\approx \\Gamma \\frac{\\phi_{i+1}-\\phi_i}{\\Delta x} \\quad \\text{and} \\quad \\left( \\Gamma \\frac{d\\phi}{dx} \\right)_{i-1/2} \\approx \\Gamma \\frac{\\phi_i-\\phi_{i-1}}{\\Delta x} $$\nThe convective term values $\\phi$ at the faces are approximated using the blended upwind-central scheme, controlled by parameter $\\beta \\in [0, 1]$. For a positive mass flux $\\rho u  0$, the upwind direction is from the left.\n$$ (\\rho u \\phi)_{i+1/2} \\approx \\rho u \\left[ \\beta\\, \\phi_i + (1-\\beta)\\,\\frac{\\phi_{i}+\\phi_{i+1}}{2} \\right] $$\n$$ (\\rho u \\phi)_{i-1/2} \\approx \\rho u \\left[ \\beta\\, \\phi_{i-1} + (1-\\beta)\\,\\frac{\\phi_{i-1}+\\phi_{i}}{2} \\right] $$\nLet's simplify the face value expressions:\n$$ \\phi_{i+1/2} = \\left(\\beta + \\frac{1-\\beta}{2}\\right)\\phi_i + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i+1} = \\frac{1+\\beta}{2}\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} $$\n$$ \\phi_{i-1/2} = \\left(\\beta + \\frac{1-\\beta}{2}\\right)\\phi_{i-1} + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i} = \\frac{1+\\beta}{2}\\phi_{i-1} + \\frac{1-\\beta}{2}\\phi_{i} $$\nSubstituting these into the flux balance equation:\n$$ \\left(\\Gamma \\frac{\\phi_{i+1}-\\phi_i}{\\Delta x}\\right) - \\left(\\Gamma \\frac{\\phi_i-\\phi_{i-1}}{\\Delta x}\\right) - \\rho u \\left( \\phi_{i+1/2} - \\phi_{i-1/2} \\right) = 0 $$\nThe difference in convective face values is:\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = \\left(\\frac{1+\\beta}{2}\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1}\\right) - \\left(\\frac{1+\\beta}{2}\\phi_{i-1} + \\frac{1-\\beta}{2}\\phi_{i}\\right) $$\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = -\\left(\\frac{1+\\beta}{2}\\right)\\phi_{i-1} + \\left(\\frac{1+\\beta}{2} - \\frac{1-\\beta}{2}\\right)\\phi_i + \\left(\\frac{1-\\beta}{2}\\right)\\phi_{i+1} $$\n$$ \\phi_{i+1/2} - \\phi_{i-1/2} = -\\frac{1+\\beta}{2}\\phi_{i-1} + \\beta\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} $$\nSubstituting this back into the discretized equation gives:\n$$ \\frac{\\Gamma}{\\Delta x}(\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}) - \\rho u \\left( -\\frac{1+\\beta}{2}\\phi_{i-1} + \\beta\\phi_i + \\frac{1-\\beta}{2}\\phi_{i+1} \\right) = 0 $$\nWe can now group the terms by the nodal values $\\phi_{i-1}$, $\\phi_i$, and $\\phi_{i+1}$ to obtain the linear algebraic equation $a_W \\phi_{i-1} + a_P \\phi_i + a_E \\phi_{i+1} = 0$:\n$$ \\left(\\frac{\\Gamma}{\\Delta x} + \\rho u \\frac{1+\\beta}{2}\\right)\\phi_{i-1} + \\left(-2\\frac{\\Gamma}{\\Delta x} - \\rho u \\beta\\right)\\phi_i + \\left(\\frac{\\Gamma}{\\Delta x} - \\rho u \\frac{1-\\beta}{2}\\right)\\phi_{i+1} = 0 $$\nThe coefficients for the linear system are therefore:\n$$ a_W = \\frac{\\Gamma}{\\Delta x} + \\rho u \\frac{1+\\beta}{2} $$\n$$ a_E = \\frac{\\Gamma}{\\Delta x} - \\rho u \\frac{1-\\beta}{2} $$\n$$ a_P = -2\\frac{\\Gamma}{\\Delta x} - \\rho u \\beta = -(a_W + a_E) $$\nThese coefficients explicitly depend on the blending parameter $\\beta$. For $\\beta=1$, the scheme is first-order upwind. For $\\beta=0$, it is second-order central differencing.\n\n### 2. Linear System Solution\n\nThe derived algebraic equation applies to all interior nodes $i=1, 2, \\dots, N-1$. This forms a system of $N-1$ linear equations for the $N-1$ unknown values $\\phi_1, \\dots, \\phi_{N-1}$. The boundary values $\\phi_0=1$ and $\\phi_N=0$ are known.\n\nFor the first interior node ($i=1$):\n$ a_W \\phi_0 + a_P \\phi_1 + a_E \\phi_2 = 0 \\implies a_P \\phi_1 + a_E \\phi_2 = -a_W \\phi_0 = -a_W $\n\nFor a general interior node ($i=2, \\dots, N-2$):\n$ a_W \\phi_{i-1} + a_P \\phi_i + a_E \\phi_{i+1} = 0 $\n\nFor the last interior node ($i=N-1$):\n$ a_W \\phi_{N-2} + a_P \\phi_{N-1} + a_E \\phi_N = 0 \\implies a_W \\phi_{N-2} + a_P \\phi_{N-1} = -a_E \\phi_N = 0 $\n\nThis system of equations can be written in matrix form $A\\Phi = b$, where $\\Phi = [\\phi_1, \\dots, \\phi_{N-1}]^T$ is the vector of unknowns. The matrix $A$ is a tridiagonal matrix of size $(N-1) \\times (N-1)$ with the main diagonal composed of $a_P$, the sub-diagonal of $a_W$, and the super-diagonal of $a_E$. The right-hand-side vector $b$ is $[-a_W, 0, \\dots, 0]^T$. This tridiagonal system can be solved efficiently.\n\n### 3. Boundary Layer Thickness and Analytical Solution\n\nThe analytical solution to the governing ODE is found by solving $\\phi'' - Pe \\cdot \\phi' = 0$, where $Pe = \\rho u L / \\Gamma$ is the Peclet number and $L=1$. The general solution is $\\phi(x) = C_1 + C_2 e^{Pe \\cdot x}$. Applying the boundary conditions $\\phi(0)=1$ and $\\phi(1)=0$ yields the constants $C_1$ and $C_2$, resulting in the exact solution:\n$$ \\phi(x) = \\frac{e^{Pe} - e^{Pe \\cdot x}}{e^{Pe} - 1} $$\nThe boundary layer thickness $\\delta_r$ is defined relative to a threshold value $\\phi(x_r) = r$. We solve for $x_r$:\n$$ r = \\frac{e^{Pe} - e^{Pe \\cdot x_r}}{e^{Pe} - 1} \\implies e^{Pe \\cdot x_r} = e^{Pe} - r(e^{Pe} - 1) = (1-r)e^{Pe} + r $$\nTaking the natural logarithm and solving for $x_r$:\n$$ x_r = \\frac{1}{Pe} \\ln\\left(r + (1-r)e^{Pe}\\right) $$\nThe exact boundary layer thickness is then $\\delta_r^{\\text{exact}} = 1 - x_r$.\n\nNumerically, once the discrete solution $\\phi_i$ is computed, we locate the pair of adjacent nodes $(i-1, i)$ that straddle the threshold value $r$ near the outlet (i.e., $\\phi_i \\le r  \\phi_{i-1}$). The location $x_r$ is found by linear interpolation:\n$$ \\frac{x_r - x_{i-1}}{x_i - x_{i-1}} = \\frac{r - \\phi_{i-1}}{\\phi_i - \\phi_{i-1}} \\implies x_r^{\\text{num}} = x_{i-1} + \\Delta x \\frac{r - \\phi_{i-1}}{\\phi_i - \\phi_{i-1}} $$\nThe numerical boundary layer thickness is $\\delta_r^{\\text{num}} = 1 - x_r^{\\text{num}}$. The absolute error is $\\varepsilon = |\\delta_r^{\\text{num}} - \\delta_r^{\\text{exact}}|$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Solves the 1D convection-diffusion problem for a series of test cases\n    and calculates the boundary layer thickness and its error.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Pe, beta)\n        (300, 20.0, 1.0),   # Case 1\n        (300, 20.0, 0.2),   # Case 2\n        (1000, 100.0, 1.0), # Case 3\n        (1000, 100.0, 0.7), # Case 4\n        (100, 2.0, 0.0)     # Case 5\n    ]\n    \n    results = []\n    \n    # Shared parameters for all cases\n    rho_u = 1.0\n    L = 1.0\n    r = 0.5  # Threshold for boundary layer thickness calculation\n    phi_0 = 1.0\n    phi_N = 0.0\n\n    for N, Pe, beta in test_cases:\n        # --- Problem Setup ---\n        Gamma = 1.0 / Pe if Pe != 0 else np.inf\n        delta_x = L / N\n        num_interior_nodes = N - 1\n\n        # --- Calculate FVM Coefficients ---\n        D = Gamma / delta_x  # Diffusive conductance\n        F = rho_u            # Convective flux strength\n\n        a_W = D + F * (1.0 + beta) / 2.0\n        a_E = D - F * (1.0 - beta) / 2.0\n        a_P = -(a_W + a_E)\n\n        # --- Assemble and Solve Linear System ---\n        # Matrix A is tridiagonal with size (N-1) x (N-1)\n        # scipy.linalg.solve_banded expects bands in a specific format (l, u)\n        # Here l=1 (sub-diagonal), u=1 (super-diagonal)\n        A_banded = np.zeros((3, num_interior_nodes))\n        A_banded[0, 1:] = a_E      # Super-diagonal (u)\n        A_banded[1, :] = a_P         # Main diagonal\n        A_banded[2, :-1] = a_W     # Sub-diagonal (l)\n\n        # Right-hand-side vector b\n        b = np.zeros(num_interior_nodes)\n        b[0] = -a_W * phi_0 # Contribution from phi_0 at node i=1\n        # b[-1] is not modified since phi_N=0\n\n        # Solve for interior nodes phi_1, ..., phi_{N-1}\n        phi_interior = solve_banded((1, 1), A_banded, b)\n\n        # Construct full solution vector [phi_0, ..., phi_N]\n        phi_numerical = np.concatenate(([phi_0], phi_interior, [phi_N]))\n\n        # --- Calculate Analytical Boundary Layer Thickness ---\n        # Handle Pe=0 case to avoid division by zero\n        if Pe  1e-9:\n             x_r_exact = (1.0 / Pe) * np.log(r + (1.0 - r) * np.exp(Pe))\n        else: # Limit as Pe - 0, linear profile\n             x_r_exact = 1.0 - r\n        delta_r_exact = 1.0 - x_r_exact\n        \n        # --- Calculate Numerical Boundary Layer Thickness ---\n        x_nodes = np.linspace(0, 1, N + 1)\n        \n        # Find the interval (i-1, i) where phi crosses the threshold r\n        # We search from the outlet (x=1) backwards\n        x_r_num = -1.0 # Initialize with a sentinel value\n        for i in range(N, 0, -1):\n            if phi_numerical[i] = r and r  phi_numerical[i-1]:\n                # Linearly interpolate to find x_r where phi(x_r) = r\n                phi_hi = phi_numerical[i-1]\n                phi_lo = phi_numerical[i]\n                x_hi = x_nodes[i-1]\n                x_lo = x_nodes[i]\n                \n                # Check for division by zero, although not expected with monotonic solution\n                if abs(phi_lo - phi_hi)  1e-12:\n                    x_r_num = x_hi + (x_lo - x_hi) * (r - phi_hi) / (phi_lo - phi_hi)\n                else: # Fallback in case of flat profile segment\n                    x_r_num = (x_hi + x_lo) / 2.0\n                break\n        \n        if x_r_num == -1.0:\n            # This case should not be reached with the given test inputs\n            # as the boundary layer is always resolved to some degree.\n            # It would indicate the solution is almost constant at 1.0.\n            # A failsafe could be to set error to a large value or NaN.\n            # Here we assume it's always found.\n            delta_r_num = np.nan\n            error = np.nan\n        else:\n            delta_r_num = 1.0 - x_r_num\n            # --- Calculate Absolute Error ---\n            error = np.abs(delta_r_num - delta_r_exact)\n\n        results.append([delta_r_num, error])\n\n    # Final print statement in the exact required format.\n    # The str() of a list is \"[...]\", which matches the required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Our final practice shifts from steady-state analysis to the crucial topic of stability in time-dependent problems. When solving the unsteady advection equation with an explicit method like forward Euler, the choice of time step $\\Delta t$ is not arbitrary; an improperly large step can cause the solution to grow without bound. This exercise uses von Neumann stability analysis to derive the famous Courant-Friedrichs-Lewy (CFL) condition, which provides a rigorous upper limit on the time step, ensuring that the numerical simulation remains stable. ",
            "id": "3996981",
            "problem": "Consider the linear advection of temperature described by the partial differential equation $\\partial_{t} T(x,t) + u \\,\\partial_{x} T(x,t) = 0$ on a one-dimensional periodic domain of length $L$ with constant advection speed $u \\in \\mathbb{R}$. Let the domain be discretized by a uniform grid of $N$ points with grid spacing $h = L/N$ and cell-centered unknowns $\\{T_{i}(t)\\}_{i=0}^{N-1}$ at locations $x_{i} = i h$, with periodic indexing. Using the upwind spatial differencing appropriate to the sign of $u$ (i.e., the one-sided discrete gradient aligned with the direction of propagation), write the semi-discrete system in the form $\\frac{d \\mathbf{T}}{dt} = A\\,\\mathbf{T}$ for a suitable matrix $A$, where $\\mathbf{T}(t) \\in \\mathbb{R}^{N}$ collects the nodal values.\n\nStarting from the governing equation and the definition of the upwind finite-difference operator, perform a discrete Fourier mode analysis predicated on periodicity to:\n- derive the complete set of eigenvalues of the semi-discrete operator $A$ as a function of the discrete wavenumber,\n- deduce the forward Euler time-step restriction that guarantees linear stability of the fully discrete scheme $\\mathbf{T}^{n+1} = \\mathbf{T}^{n} + \\Delta t\\,A\\,\\mathbf{T}^{n}$.\n\nYour derivation must begin from the stated physical model and the upwind differencing definition and proceed through the construction of the semi-discrete operator, the identification of its Fourier eigenvectors, and the consequent eigenvalues. Then, use the forward Euler linear stability criterion in the complex plane to obtain the most restrictive bound on $\\Delta t$ over all discrete wavenumbers. Express your final answer as a single closed-form analytic expression for the largest stable time step in terms of $h$ and $|u|$. You are not asked for a numerical value; do not include units in your final boxed answer. If this expression were to be evaluated numerically, it would have units of seconds.",
            "solution": "The analysis begins with the governing linear advection equation for temperature $T(x,t)$, given by:\n$$\n\\partial_{t} T(x,t) + u \\,\\partial_{x} T(x,t) = 0\n$$\nThis equation is defined on a one-dimensional periodic domain of length $L$. The domain is discretized into $N$ uniform cells of width $h = L/N$, with cell-centered temperature values $T_i(t)$ at positions $x_i = i h$ for $i \\in \\{0, 1, \\dots, N-1\\}$. The semi-discretization of the spatial derivative $\\partial_x T$ is performed using the first-order upwind differencing scheme. The choice of the one-sided difference stencil depends on the sign of the advection speed $u$.\n\nCase 1: $u  0$. Information propagates in the positive $x$ direction (from left to right). The upwind scheme uses a backward difference to approximate the spatial derivative at node $i$:\n$$\n(\\partial_x T)_i \\approx \\frac{T_i - T_{i-1}}{h}\n$$\nSubstituting this into the governing equation yields the semi-discrete ordinary differential equation for $T_i(t)$:\n$$\n\\frac{d T_i}{dt} = -u \\left( \\frac{T_i - T_{i-1}}{h} \\right)\n$$\nDue to the specified periodic boundary conditions, the indices are taken modulo $N$, so $T_{-1}$ is understood as $T_{N-1}$.\n\nCase 2: $u  0$. Information propagates in the negative $x$ direction (from right to left). The upwind scheme uses a forward difference:\n$$\n(\\partial_x T)_i \\approx \\frac{T_{i+1} - T_i}{h}\n$$\nThe semi-discrete equation for $T_i(t)$ becomes:\n$$\n\\frac{d T_i}{dt} = -u \\left( \\frac{T_{i+1} - T_i}{h} \\right)\n$$\nHere, periodic indexing implies $T_N$ is understood as $T_0$.\n\nThese two cases can be unified. The semi-discrete system for the vector of nodal temperatures $\\mathbf{T}(t) = [T_0(t), \\dots, T_{N-1}(t)]^T$ is expressed as $\\frac{d\\mathbf{T}}{dt} = A\\mathbf{T}$. The matrix $A$ is an $N \\times N$ circulant matrix. To find its eigenvalues, we perform a discrete Fourier analysis. The eigenvectors of any $N \\times N$ circulant matrix are the discrete Fourier modes. An eigenvector $\\mathbf{v}_m$ corresponding to a discrete wavenumber $k_m = \\frac{2\\pi m}{L} = \\frac{2\\pi m}{Nh}$ (for $m \\in \\{0, 1, \\dots, N-1\\}$) has components $(\\mathbf{v}_m)_j = e^{i k_m x_j} = e^{i (2\\pi m / (Nh)) (jh)} = e^{i j (2\\pi m / N)}$. Let $\\theta_m = k_m h = \\frac{2\\pi m}{N}$ be the non-dimensional wavenumber or phase angle per grid cell. The $j$-th component of the eigenvector is then $(\\mathbf{v}_m)_j = e^{i j \\theta_m}$.\n\nWe find the eigenvalue $\\lambda_m$ associated with the eigenvector $\\mathbf{v}_m$ by applying the $i$-th row of the operator $A$ to $\\mathbf{v}_m$.\nFor $u  0$:\n$$\n(A \\mathbf{v}_m)_i = - \\frac{u}{h} ((\\mathbf{v}_m)_i - (\\mathbf{v}_m)_{i-1}) = - \\frac{u}{h} (e^{i i \\theta_m} - e^{i (i-1) \\theta_m}) = - \\frac{u}{h} e^{i i \\theta_m} (1 - e^{-i \\theta_m}) = \\left[ \\frac{u}{h}(e^{-i \\theta_m} - 1) \\right] (\\mathbf{v}_m)_i\n$$\nThus, for $u0$, the eigenvalues are $\\lambda_m = \\frac{u}{h}(e^{-i \\theta_m} - 1)$.\n\nFor $u  0$:\n$$\n(A \\mathbf{v}_m)_i = - \\frac{u}{h} ((\\mathbf{v}_m)_{i+1} - (\\mathbf{v}_m)_i) = - \\frac{u}{h} (e^{i (i+1) \\theta_m} - e^{i i \\theta_m}) = - \\frac{u}{h} e^{i i \\theta_m} (e^{i \\theta_m} - 1) = \\left[ - \\frac{u}{h}(e^{i \\theta_m} - 1) \\right] (\\mathbf{v}_m)_i\n$$\nThus, for $u0$, the eigenvalues are $\\lambda_m = -\\frac{u}{h}(e^{i \\theta_m} - 1)$.\n\nThe problem requires a stability analysis of the fully discrete scheme using the forward Euler method for time integration:\n$$\n\\mathbf{T}^{n+1} = \\mathbf{T}^{n} + \\Delta t\\,A\\,\\mathbf{T}^{n} = (I + \\Delta t A) \\mathbf{T}^n\n$$\nwhere $\\Delta t$ is the time step. Stability of this scheme requires that the magnitude of the amplification factor, $G_m$, for each mode $m$ does not exceed unity. The amplification factor is the eigenvalue of the operator $(I + \\Delta t A)$, which is $G_m = 1 + \\Delta t \\lambda_m$. The stability condition is:\n$$\n|G_m| = |1 + \\Delta t \\lambda_m| \\le 1 \\quad \\forall m \\in \\{0, 1, \\dots, N-1\\}\n$$\nThis condition states that for stability, the complex numbers $z_m = \\Delta t \\lambda_m$ must lie within or on the boundary of a circle of radius $1$ centered at $(-1, 0)$ in the complex plane.\n\nLet's analyze the locus of the points $z_m = \\Delta t \\lambda_m$. We introduce the Courant number, $C = \\frac{|u|\\Delta t}{h}$.\nFor $u  0$, $u=|u|$, so $C = \\frac{u \\Delta t}{h}$.\n$$\nz_m = \\Delta t \\left( \\frac{u}{h}(e^{-i \\theta_m} - 1) \\right) = C(e^{-i \\theta_m} - 1) = C(\\cos(\\theta_m) - 1) - i C\\sin(\\theta_m)\n$$\nFor $u  0$, $u=-|u|$, so $C = -\\frac{u \\Delta t}{h}$.\n$$\nz_m = \\Delta t \\left( - \\frac{u}{h}(e^{i \\theta_m} - 1) \\right) = C(e^{i \\theta_m} - 1) = C(\\cos(\\theta_m) - 1) + i C\\sin(\\theta_m)\n$$\nIn both cases, as $\\theta_m$ varies from $0$ to $2\\pi$ (corresponding to $m$ from $0$ to $N$), the points $z_m$ trace out a circle in the complex plane. This circle is described by the equation $|z_m + C| = C$. It is a circle of radius $C$ centered at $(-C, 0)$.\n\nFor the scheme to be stable, this circle of points $\\{z_m\\}$ must be entirely contained within the stability region $|z+1| \\le 1$. The stability region is a circle of radius $1$ centered at $(-1, 0)$.\nThe circle for $\\{z_m\\}$ has its rightmost point at $z = 0$ (when $\\theta_m=0$) and its leftmost point at $z=-2C$ (when $\\theta_m=\\pi$). For this circle to be contained within the stability region, its leftmost point must not be to the left of the stability region's leftmost point, which is at $z=-2$. Therefore, we must have:\n$$\n-2C \\ge -2\n$$\nThis simplifies to $C \\le 1$.\nSubstituting back the definition of the Courant number, we get the stability condition:\n$$\n\\frac{|u|\\Delta t}{h} \\le 1\n$$\nThe problem asks for the largest stable time step, which is obtained when this inequality is an equality:\n$$\n\\Delta t_{\\text{max}} = \\frac{h}{|u|}\n$$\nThis is the Courant-Friedrichs-Lewy (CFL) condition for the first-order upwind scheme combined with forward Euler time integration. The stability is limited by the time it takes for information to travel across one grid cell.",
            "answer": "$$\\boxed{\\frac{h}{|u|}}$$"
        }
    ]
}