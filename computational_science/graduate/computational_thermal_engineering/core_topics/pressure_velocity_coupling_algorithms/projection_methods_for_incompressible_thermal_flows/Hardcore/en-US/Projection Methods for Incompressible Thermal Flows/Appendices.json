{
    "hands_on_practices": [
        {
            "introduction": "The core of any projection method is the solution of a pressure Poisson equation, which in a computational setting becomes a large linear system. This exercise guides you through the process of deriving the coefficients of this system from first principles using the finite volume method on a staggered grid. Mastering this derivation is fundamental to understanding how the continuous equations are translated into the algebraic relationships that a computer can solve .",
            "id": "3980165",
            "problem": "Consider a two-dimensional incompressible, thermally driven flow under the Boussinesq approximation, where temperature-induced density variations are small and only affect buoyancy in the momentum equation. The flow is discretized using the Finite Volume Method (FVM) on a uniform, orthogonal, Cartesian grid with cell-centered pressure and face-centered velocities. Let a generic interior control volume be denoted by cell $P$ with volume $V_{P}$, east and west face areas $S_{e} = \\Delta y$ and $S_{w} = \\Delta y$, north and south face areas $S_{n} = \\Delta x$ and $S_{s} = \\Delta x$, and center-to-center distances $d_{pe} = \\Delta x$, $d_{pw} = \\Delta x$, $d_{pn} = \\Delta y$, and $d_{ps} = \\Delta y$. Assume constant density $\\rho$ and a time step $\\Delta t$.\n\nStarting from the incompressible continuity equation and the projection method framework in Computational Fluid Dynamics (CFD), construct the flux-based discrete divergence operator for a control volume as the net sum of face-normal mass fluxes divided by the volume, and construct the flux-based discrete gradient operator as a two-point face-normal difference of pressure divided by the center-to-center distance. Using these operators, derive the fully discrete pressure system for the pressure increment that enforces zero net mass flux across each cell’s faces at the new time level. Assume the intermediate velocity field $\\boldsymbol{u}^{\\ast}$ is known from the momentum and energy updates without the pressure gradient.\n\nFor the uniform grid described above, identify the diagonal coefficient $A_{P}$ of the resulting linear system for the pressure at an interior cell $P$, written in the standard diffusion-like stencil form in which the diagonal is positive and the nearest-neighbor off-diagonals are negative. Report the dimensionless quantity $A_{P}/\\Delta t$ as a closed-form expression in terms of $\\Delta x$ and $\\Delta y$. Do not substitute any numerical values. Express your final answer as a single analytical expression.",
            "solution": "The user has requested a derivation of the diagonal coefficient of the discrete pressure equation resulting from a projection method for incompressible flow. The problem is well-posed, scientifically sound, and contains all necessary information for an interior control volume in a two-dimensional uniform Cartesian grid.\n\nThe solution process begins with the core principles of the projection method. The method decouples the velocity and pressure fields by first computing an intermediate velocity field, $\\boldsymbol{u}^{\\ast}$, which does not satisfy the incompressibility constraint, and then projecting it onto a divergence-free space to find the velocity field at the new time step, $\\boldsymbol{u}^{n+1}$.\n\nThe velocity update step in the projection method relates the final velocity $\\boldsymbol{u}^{n+1}$ to the intermediate velocity $\\boldsymbol{u}^{\\ast}$ through the gradient of a kinematic pressure increment, which we denote as $\\pi'$. The update equation is:\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\Delta t \\nabla \\pi'\n$$\nHere, $\\Delta t$ is the time step. The intermediate velocity $\\boldsymbol{u}^{\\ast}$ is assumed to be known from solving the momentum equation without the pressure gradient term.\n\nThe fundamental constraint for an incompressible flow is that the velocity field must be divergence-free at all times. For the new time step, this is expressed as:\n$$\n\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0\n$$\nSubstituting the velocity update equation into the incompressibility constraint yields the continuous pressure-correction equation:\n$$\n\\nabla \\cdot \\left(\\boldsymbol{u}^{\\ast} - \\Delta t \\nabla \\pi'\\right) = 0\n$$\nAssuming constant $\\Delta t$ and rearranging the terms, we obtain a Poisson equation for the kinematic pressure correction $\\pi'$:\n$$\n\\nabla^2 \\pi' = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{u}^{\\ast}\n$$\n\nWe now discretize this relationship using the Finite Volume Method (FVM) on the specified control volume $P$. The integral form of the incompressibility constraint $\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$ over the control volume $V_P$ is:\n$$\n\\int_{V_P} \\nabla \\cdot \\boldsymbol{u}^{n+1} \\, dV = 0\n$$\nApplying the divergence theorem, and noting that density $\\rho$ is constant, this becomes a statement about the net volume flux across the control volume's faces being zero:\n$$\n\\sum_{f} (\\boldsymbol{u}^{n+1} \\cdot \\boldsymbol{n} S)_f = 0\n$$\nwhere the sum is over the faces of the control volume (east $e$, west $w$, north $n$, south $s$), $\\boldsymbol{n}$ is the outward-pointing unit normal vector to the face, and $S_f$ is the face area. For a 2D Cartesian grid, this expands to:\n$$\n(u S)_e - (u S)_w + (v S)_n - (v S)_s = 0\n$$\nThe velocities $u$ and $v$ are the components normal to the faces, evaluated at the face centers. The velocity at each face at time level $n+1$ is obtained by discretizing the velocity update equation. The problem specifies a \"two-point face-normal difference\" for the discrete gradient operator. Applied to the face-centered velocities, this gives:\n$$\nu_e^{n+1} = u_e^{\\ast} - \\Delta t \\frac{\\pi'_E - \\pi'_P}{d_{pe}}\n$$\n$$\nu_w^{n+1} = u_w^{\\ast} - \\Delta t \\frac{\\pi'_P - \\pi'_W}{d_{pw}}\n$$\n$$\nv_n^{n+1} = v_n^{\\ast} - \\Delta t \\frac{\\pi'_N - \\pi'_P}{d_{pn}}\n$$\n$$\nv_s^{n+1} = v_s^{\\ast} - \\Delta t \\frac{\\pi'_P - \\pi'_S}{d_{ps}}\n$$\nHere, $\\pi'_P, \\pi'_E, \\pi'_W, \\pi'_N, \\pi'_S$ are the kinematic pressure-correction values at the centers of cell $P$ and its east, west, north, and south neighbors, respectively. The terms $d_{pe}$, etc., are the distances between cell centers.\n\nWe substitute these discrete velocity expressions into the discretized continuity equation. Let's analyze the volume flux term for each face:\nThe volume flow rate through the east face is $Q_e^{n+1} = (u S)_e^{n+1}$:\n$$\nQ_e^{n+1} = S_e \\left(u_e^{\\ast} - \\Delta t \\frac{\\pi'_E - \\pi'_P}{d_{pe}}\\right) = (u^{\\ast} S)_e - \\frac{S_e \\Delta t}{d_{pe}}(\\pi'_E - \\pi'_P)\n$$\nSimilarly, for the other faces:\n$$\nQ_w^{n+1} = S_w \\left(u_w^{\\ast} - \\Delta t \\frac{\\pi'_P - \\pi'_W}{d_{pw}}\\right) = (u^{\\ast} S)_w - \\frac{S_w \\Delta t}{d_{pw}}(\\pi'_P - \\pi'_W)\n$$\n$$\nQ_n^{n+1} = S_n \\left(v_n^{\\ast} - \\Delta t \\frac{\\pi'_N - \\pi'_P}{d_{pn}}\\right) = (v^{\\ast} S)_n - \\frac{S_n \\Delta t}{d_{pn}}(\\pi'_N - \\pi'_P)\n$$\n$$\nQ_s^{n+1} = S_s \\left(v_s^{\\ast} - \\Delta t \\frac{\\pi'_P - \\pi'_S}{d_{ps}}\\right) = (v^{\\ast} S)_s - \\frac{S_s \\Delta t}{d_{ps}}(\\pi'_P - \\pi'_S)\n$$\nThe discrete continuity equation is $Q_e^{n+1} - Q_w^{n+1} + Q_n^{n+1} - Q_s^{n+1} = 0$. Substituting the expressions for the volume flow rates and grouping terms related to the pressure correction $\\pi'$ on one side, we get:\n$$\n\\frac{S_e \\Delta t}{d_{pe}}(\\pi'_P - \\pi'_E) + \\frac{S_w \\Delta t}{d_{pw}}(\\pi'_P - \\pi'_W) + \\frac{S_n \\Delta t}{d_{pn}}(\\pi'_P - \\pi'_N) + \\frac{S_s \\Delta t}{d_{ps}}(\\pi'_P - \\pi'_S) = (Q^{\\ast}_e - Q^{\\ast}_w + Q^{\\ast}_n - Q^{\\ast}_s)\n$$\nThe right-hand side is the source term, representing the net volume imbalance from the intermediate velocity field. We rearrange the left-hand side to isolate the term with $\\pi'_P$:\n$$\n\\left( \\frac{S_e \\Delta t}{d_{pe}} + \\frac{S_w \\Delta t}{d_{pw}} + \\frac{S_n \\Delta t}{d_{pn}} + \\frac{S_s \\Delta t}{d_{ps}} \\right) \\pi'_P - \\frac{S_e \\Delta t}{d_{pe}} \\pi'_E - \\frac{S_w \\Delta t}{d_{pw}} \\pi'_W - \\frac{S_n \\Delta t}{d_{pn}} \\pi'_N - \\frac{S_s \\Delta t}{d_{ps}} \\pi'_S = \\text{source term}\n$$\nThis equation is in the standard linear system form $A_P \\pi'_P = \\sum_{nb} A_{nb} \\pi'_{nb} + b$, which can be written as $A_P \\pi'_P - \\sum_{nb \\in \\{E,W,N,S\\}} A_{nb} \\pi'_{nb} = b$. The diagonal coefficient, $A_P$, is the coefficient of $\\pi'_P$. By inspection, we identify it as:\n$$\nA_P = \\frac{S_e \\Delta t}{d_{pe}} + \\frac{S_w \\Delta t}{d_{pw}} + \\frac{S_n \\Delta t}{d_{pn}} + \\frac{S_s \\Delta t}{d_{ps}}\n$$\nNote that in this formulation, $A_{nb}$ (e.g., $A_E = \\frac{S_e \\Delta t}{d_{pe}}$) are the coefficients of the neighboring nodes, and the diagonal is the sum of these neighbor coefficients: $A_P = A_E + A_W + A_N + A_S$.\n\nNow, we substitute the geometric parameters for the uniform Cartesian grid provided in the problem statement:\n- Face areas: $S_e = S_w = \\Delta y$ and $S_n = S_s = \\Delta x$.\n- Center-to-center distances: $d_{pe} = d_{pw} = \\Delta x$ and $d_{pn} = d_{ps} = \\Delta y$.\n\nSubstituting these into the expression for $A_P$:\n$$\nA_P = \\frac{\\Delta y \\cdot \\Delta t}{\\Delta x} + \\frac{\\Delta y \\cdot \\Delta t}{\\Delta x} + \\frac{\\Delta x \\cdot \\Delta t}{\\Delta y} + \\frac{\\Delta x \\cdot \\Delta t}{\\Delta y}\n$$\n$$\nA_P = 2 \\frac{\\Delta y \\Delta t}{\\Delta x} + 2 \\frac{\\Delta x \\Delta t}{\\Delta y}\n$$\nThis can be factored as:\n$$\nA_P = 2 \\Delta t \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\nThe problem asks for the dimensionless quantity $A_P / \\Delta t$. Dividing our expression for $A_P$ by $\\Delta t$:\n$$\n\\frac{A_P}{\\Delta t} = \\frac{2 \\Delta t}{\\Delta t} \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\n$$\n\\frac{A_P}{\\Delta t} = 2 \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)\n$$\nThis is the final analytical expression for the requested dimensionless quantity.",
            "answer": "$$\n\\boxed{2 \\left( \\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y} \\right)}\n$$"
        },
        {
            "introduction": "After constructing the pressure system, it is essential to verify that it accomplishes its goal: enforcing the incompressibility constraint. This practice provides a concrete numerical scenario where you will calculate the divergence of a velocity field both before and after the projection step. By working through this small-scale example, you will gain a tangible understanding of how the mathematical projection cleanses the velocity field of its divergent part, resulting in a discretely mass-conserving flow .",
            "id": "3980214",
            "problem": "Consider two-dimensional incompressible, constant-density flow with thermal buoyancy modeled by the Boussinesq approximation, advanced in time by an explicit method that produces an intermediate velocity field with a small divergence residual due to time integration. The projection step is used to enforce incompressibility. The computational domain is $\\Omega = [0,1]\\times[0,1]$ with impermeable walls, discretized by a uniform Marker-and-Cell (MAC) grid (Marker-and-Cell (MAC) places velocity components at cell faces and pressure at cell centers) with $N_{x}=2$ and $N_{y}=2$ interior cells, so that $\\Delta x = \\Delta y = 0.5$. The time step is $\\Delta t = 0.1$.\n\nThe face-centered intermediate velocity components $\\mathbf{u}^{*} = (u^{*}, v^{*})$ are given at the MAC locations as follows:\n- Vertical faces (for $u^{*}_{i+1/2,j}$): $u^{*}_{1/2,1} = 0$, $u^{*}_{1/2,2} = 0$, $u^{*}_{3/2,1} = 0.06$, $u^{*}_{3/2,2} = -0.02$, $u^{*}_{5/2,1} = 0$, $u^{*}_{5/2,2} = 0$.\n- Horizontal faces (for $v^{*}_{i,j+1/2}$): $v^{*}_{1,1/2} = 0$, $v^{*}_{2,1/2} = 0$, $v^{*}_{1,3/2} = -0.04$, $v^{*}_{2,3/2} = 0.05$, $v^{*}_{1,5/2} = 0$, $v^{*}_{2,5/2} = 0$.\n\nImpermeable walls imply $u^{*}\\cdot \\mathbf{n} = 0$ at all domain boundaries, which is consistent with the given boundary face values.\n\nStarting from the incompressibility constraint and the projection methodology, you must:\n1. Compute the discrete cell-centered divergence of $\\mathbf{u}^{*}$ for each of the four cells using the finite-volume form of the divergence consistent with a MAC grid and no-penetration boundaries.\n2. Compute the $L^{2}$ norm of the divergence over $\\Omega$ before projection, using the midpoint rule on this uniform grid, that is, approximate $\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}$ by $\\left(\\sum_{i=1}^{2}\\sum_{j=1}^{2} (\\nabla \\cdot \\mathbf{u}^{*})_{i,j}^{2}\\, \\Delta x \\Delta y\\right)^{1/2}$.\n3. Using the exact projection step that enforces discrete incompressibility by solving the pressure Poisson equation with boundary conditions consistent with impermeable walls, determine the $L^{2}$ norm of the divergence after projection.\n4. Quantify the enforcement of incompressibility by the scalar metric $E$ defined as $E = 1 - \\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)} / \\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}$, where $\\mathbf{u}^{n+1}$ is the projected velocity.\n\nReport only the final value of $E$ as your answer. If any numerical approximation is needed in your work, keep all intermediate quantities exact and state any rounding requirement explicitly in your derivation. The final metric $E$ is dimensionless; do not include any units in your final answer box. No rounding is required for $E$ if it is an exact value.",
            "solution": "The governing incompressible continuity equation is $\\nabla \\cdot \\mathbf{u} = 0$. In projection methods, we first compute an intermediate velocity $\\mathbf{u}^{*}$ from the momentum equation (which may include thermal buoyancy under the Boussinesq approximation) without enforcing incompressibility, and then project $\\mathbf{u}^{*}$ onto a divergence-free subspace. The projection step uses the Helmholtz decomposition in discrete form: we seek a scalar kinematic pressure correction $\\pi'$ such that\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\Delta t \\nabla \\pi',\n$$\nwith $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$. Applying divergence gives\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\nabla^{2} \\pi' = 0 \\quad \\Rightarrow \\quad \\nabla^{2}\\pi' = \\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}.\n$$\nWith impermeable walls ($\\mathbf{u}\\cdot \\mathbf{n} = 0$), the boundary condition for $\\pi'$ is a homogeneous Neumann condition consistent with enforcing the wall-normal component of $\\mathbf{u}^{n+1}$.\n\nWe now compute the discrete divergence at the cell centers on a Marker-and-Cell (MAC) grid. For a cell $(i,j)$, the finite-volume discrete divergence is\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{i,j} = \\frac{u^{*}_{i+1/2,j} - u^{*}_{i-1/2,j}}{\\Delta x} + \\frac{v^{*}_{i,j+1/2} - v^{*}_{i,j-1/2}}{\\Delta y}.\n$$\nGiven $\\Delta x = \\Delta y = 0.5$, we evaluate each cell:\n\n- Cell $(1,1)$:\n$$\n\\frac{u^{*}_{3/2,1} - u^{*}_{1/2,1}}{\\Delta x} = \\frac{0.06 - 0}{0.5} = 0.12, \\quad \\frac{v^{*}_{1,3/2} - v^{*}_{1,1/2}}{\\Delta y} = \\frac{-0.04 - 0}{0.5} = -0.08,\n$$\nso\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{1,1} = 0.12 - 0.08 = 0.04.\n$$\n\n- Cell $(2,1)$:\n$$\n\\frac{u^{*}_{5/2,1} - u^{*}_{3/2,1}}{\\Delta x} = \\frac{0 - 0.06}{0.5} = -0.12, \\quad \\frac{v^{*}_{2,3/2} - v^{*}_{2,1/2}}{\\Delta y} = \\frac{0.05 - 0}{0.5} = 0.10,\n$$\nso\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{2,1} = -0.12 + 0.10 = -0.02.\n$$\n\n- Cell $(1,2)$:\n$$\n\\frac{u^{*}_{3/2,2} - u^{*}_{1/2,2}}{\\Delta x} = \\frac{-0.02 - 0}{0.5} = -0.04, \\quad \\frac{v^{*}_{1,5/2} - v^{*}_{1,3/2}}{\\Delta y} = \\frac{0 - (-0.04)}{0.5} = 0.08,\n$$\nso\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{1,2} = -0.04 + 0.08 = 0.04.\n$$\n\n- Cell $(2,2)$:\n$$\n\\frac{u^{*}_{5/2,2} - u^{*}_{3/2,2}}{\\Delta x} = \\frac{0 - (-0.02)}{0.5} = 0.04, \\quad \\frac{v^{*}_{2,5/2} - v^{*}_{2,3/2}}{\\Delta y} = \\frac{0 - 0.05}{0.5} = -0.10,\n$$\nso\n$$\n(\\nabla \\cdot \\mathbf{u}^{*})_{2,2} = 0.04 - 0.10 = -0.06.\n$$\n\nHence the four cell-centered divergence values are $0.04$, $-0.02$, $0.04$, and $-0.06$.\n\nWe approximate the $L^{2}$ norm over $\\Omega$ using the midpoint rule:\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)} \\approx \\left(\\sum_{i=1}^{2}\\sum_{j=1}^{2} \\left[(\\nabla \\cdot \\mathbf{u}^{*})_{i,j}\\right]^{2} \\,\\Delta x \\Delta y\\right)^{1/2}.\n$$\nCompute the sum of squares:\n$$\n0.04^{2} + (-0.02)^{2} + 0.04^{2} + (-0.06)^{2} = 0.0016 + 0.0004 + 0.0016 + 0.0036 = 0.0072.\n$$\nMultiply by the cell area $\\Delta x \\Delta y = 0.25$:\n$$\n0.0072 \\times 0.25 = 0.0018.\n$$\nTherefore,\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)} \\approx \\sqrt{0.0018} = 10^{-2}\\sqrt{1.8}.\n$$\n\nNext, consider the exact projection step. Solving\n$$\n\\nabla^{2} \\pi' = \\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}\n$$\nwith boundary conditions consistent with impermeable walls, and setting\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\Delta t \\nabla \\pi',\n$$\nensures, by construction,\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\nabla^{2} \\pi' = \\nabla \\cdot \\mathbf{u}^{*} - \\Delta t \\left(\\frac{1}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}\\right) = 0\n$$\nat the discrete cell centers. Consequently,\n$$\n\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)} = 0.\n$$\n\nDefine the enforcement metric\n$$\nE = 1 - \\frac{\\|\\nabla \\cdot \\mathbf{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla \\cdot \\mathbf{u}^{*}\\|_{L^{2}(\\Omega)}} = 1 - \\frac{0}{\\sqrt{0.0018}} = 1.\n$$\nThis $E$ is dimensionless, and no rounding is required because it is exact.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "With the key components understood, this final practice challenges you to synthesize them into a complete time-advancement algorithm for a coupled thermal flow problem. You will outline the full operator-splitting procedure and then analyze the critical impact of algorithmic choices—specifically explicit versus semi-implicit diffusion—on numerical stability. This connects the theoretical structure of the projection method to the practical necessity of selecting a stable time step, a crucial skill for any computational practitioner .",
            "id": "3980208",
            "problem": "Consider an incompressible buoyancy-driven thermal flow governed by the two-dimensional Boussinesq approximation on a uniform periodic domain. The fundamental governing equations are the incompressible Navier–Stokes momentum equation, the continuity equation, and the temperature advection–diffusion equation. Specifically, for constant reference density $ \\rho_0 $, kinematic viscosity $ \\nu $, thermal diffusivity $ \\alpha $, gravitational acceleration $ g $ acting in the negative $ y $-direction, and thermal expansion coefficient $ \\beta $, the equations are\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\nabla \\pi + \\nu \\nabla^2 \\mathbf{u} + g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f},\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\n$$\n$$\n\\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T = \\alpha \\nabla^2 T + q,\n$$\nwhere $ \\mathbf{u} = (u,v) $ is the velocity field, $ \\pi $ is the kinematic pressure, $ T $ is the temperature, $ T_{\\mathrm{ref}} $ is a reference temperature, $ \\mathbf{e}_y $ is the unit vector in the $ y $-direction, $ \\mathbf{f} $ is a prescribed body force per unit mass, and $ q $ is a prescribed volumetric heating rate. The incompressibility constraint $ \\nabla \\cdot \\mathbf{u} = 0 $ must hold at all times.\n\nStarting from $ \\mathbf{u}^n $, $ T^n $, and known $ \\mathbf{f}^n $ at time level $ n $, formulate the complete operator-splitting steps that advance the solution to time level $ n+1 $ using a pressure projection method. Two operator orderings are to be considered:\n\n- Scheme $ \\mathsf{S}_{\\mathrm{EX}} $: fully explicit diffusion in both momentum and temperature equations.\n- Scheme $ \\mathsf{S}_{\\mathrm{SI}} $: semi-implicit diffusion in both momentum and temperature equations (diffusion treated implicitly, advection and sources treated explicitly).\n\nYou must clearly specify the ordering of sub-steps (convection, diffusion, body force addition, pressure projection, temperature update), and explain how the ordering and implicitness impact linear stability. For the velocity update, the buoyancy term $ g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y $ is treated explicitly. For the temperature update, the advection uses a bounded estimate based on the known velocity $ \\mathbf{u}^n $ to determine stability constraints.\n\nUse the following fundamental base to derive your algorithm and stability conditions:\n- Conservation of mass $ \\nabla \\cdot \\mathbf{u} = 0 $.\n- Conservation of momentum and energy as written above.\n- Consistent semi-discrete finite volume or finite difference discretization with first-order upwinding for advection and second-order central differences for diffusion on a uniform grid.\n- The Pressure Poisson Equation (PPE) emerging from the projection method: $ \\nabla^2 \\pi' = \\frac{1}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star $, where $ \\mathbf{u}^\\star $ is an intermediate velocity and $ \\pi' $ is the kinematic pressure-increment potential.\n- Courant–Friedrichs–Lewy (CFL) constraint for explicit upwind advection on a two-dimensional grid: a sufficient bound is $ \\Delta t \\le \\mathcal{C}\\left(\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y}\\right)^{-1} $ with Courant number $ \\mathcal{C} $ satisfying $ 0 < \\mathcal{C} \\le 1 $.\n- Forward Euler stability for explicit diffusion with a discrete Laplacian spectral radius $ \\lambda_{\\max} $: $ \\Delta t \\le \\frac{2}{\\nu \\lambda_{\\max}} $ for momentum diffusion, and $ \\Delta t \\le \\frac{2}{\\alpha \\lambda_{\\max}} $ for thermal diffusion.\n\nAssume a rectangular periodic domain of size $ L_x \\times L_y $ discretized by $ N_x \\times N_y $ uniform cells, with spacings $ \\Delta x = \\frac{L_x}{N_x} $ and $ \\Delta y = \\frac{L_y}{N_y} $. For the second-order central difference Laplacian on this grid, use the bound\n$$\n\\lambda_{\\max} = \\frac{4}{\\Delta x^2} + \\frac{4}{\\Delta y^2}.\n$$\n\nYour task is to implement a program that, for each test case in the provided test suite, computes the maximum admissible time step $ \\Delta t_{\\max} $ in seconds for both $ \\mathsf{S}_{\\mathrm{EX}} $ and $ \\mathsf{S}_{\\mathrm{SI}} $, based on the derived linear stability constraints:\n- For $ \\mathsf{S}_{\\mathrm{EX}} $, $ \\Delta t_{\\max} $ is the minimum over advection constraints for velocity and temperature and explicit diffusion constraints in momentum and temperature.\n- For $ \\mathsf{S}_{\\mathrm{SI}} $, $ \\Delta t_{\\max} $ is the minimum over advection constraints only, because diffusion is treated implicitly and does not impose a forward Euler time-step restriction; the pressure projection step does not impose a time-step restriction.\n\nUse the bound for advection constraints based on a maximum speed estimate $ (|u|_{\\max}, |v|_{\\max}) $ from $ \\mathbf{u}^n $, with CFL number $ \\mathcal{C} = 0.5 $. If $ |u|_{\\max} = 0 $ and $ |v|_{\\max} = 0 $, then the advection constraint is unbounded and should be treated as $ +\\infty $ for the purpose of computing the minimum.\n\nPhysical units: report the computed $ \\Delta t_{\\max} $ in seconds as floating-point numbers.\n\nTest suite:\n- Case $ 1 $ (happy path): $ L_x = 0.1 $ m, $ L_y = 0.1 $ m, $ N_x = 64 $, $ N_y = 64 $, $ |u|_{\\max} = 0.02 $ m/s, $ |v|_{\\max} = 0.01 $ m/s, $ \\nu = 1.0 \\times 10^{-6} $ m$^2$/s, $ \\alpha = 1.4 \\times 10^{-7} $ m$^2$/s.\n- Case $ 2 $ (diffusion-dominated edge): $ L_x = 0.1 $ m, $ L_y = 0.1 $ m, $ N_x = 64 $, $ N_y = 64 $, $ |u|_{\\max} = 0.01 $ m/s, $ |v|_{\\max} = 0.01 $ m/s, $ \\nu = 1.0 \\times 10^{-3} $ m$^2$/s, $ \\alpha = 1.0 \\times 10^{-3} $ m$^2$/s.\n- Case $ 3 $ (zero-advection boundary): $ L_x = 0.2 $ m, $ L_y = 0.2 $ m, $ N_x = 32 $, $ N_y = 32 $, $ |u|_{\\max} = 0.0 $ m/s, $ |v|_{\\max} = 0.0 $ m/s, $ \\nu = 1.0 \\times 10^{-5} $ m$^2$/s, $ \\alpha = 1.0 \\times 10^{-5} $ m$^2$/s.\n\nFinal output format:\n- Your program should produce a single line of output containing a comma-separated list of lists, each inner list holding two floating-point results in seconds $ [\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}}, \\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}}] $ for the corresponding test case. For example, $ [[a_1,b_1],[a_2,b_2],[a_3,b_3]] $ where each $ a_i $ and $ b_i $ are reported in seconds. No additional text should be printed.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, well-posed, objective, and self-contained. The governing equations and numerical methods described are standard for simulating incompressible thermal flows. The task is a direct application of linear stability analysis for well-known operator-splitting schemes.\n\nThe problem requires the formulation of two operator-splitting schemes for the Boussinesq equations and the subsequent calculation of the maximum stable time step, $\\Delta t_{\\max}$, for each scheme based on linear stability theory. The governing equations are the incompressible Navier-Stokes momentum equation, the continuity equation, and the temperature advection-diffusion equation:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u} = -\\nabla \\pi + \\nu \\nabla^2 \\mathbf{u} + g \\beta \\bigl(T - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f} \\quad (\\text{Momentum})\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0 \\quad (\\text{Continuity})\n$$\n$$\n\\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T = \\alpha \\nabla^2 T + q \\quad (\\text{Temperature})\n$$\nA pressure projection method advances the solution from time $t^n$ to $t^{n+1} = t^n + \\Delta t$ by first computing a provisional velocity field, $\\mathbf{u}^\\star$, that does not satisfy the incompressibility constraint, and then projecting it onto the space of divergence-free fields. This involves solving a Poisson equation for a kinematic pressure increment, $\\pi'$. The two schemes, $\\mathsf{S}_{\\mathrm{EX}}$ and $\\mathsf{S}_{\\mathrm{SI}}$, differ in their treatment of the diffusion terms.\n\nScheme $\\mathsf{S}_{\\mathrm{EX}}$: Fully Explicit Diffusion\n\nIn this scheme, all terms except the pressure gradient are treated explicitly using values from time level $n$. The operator splitting sequence is as follows:\n\n1.  **Temperature Update**: The temperature field is advanced from $T^n$ to $T^{n+1}$ in a single explicit step. The time-discretized equation using a forward Euler scheme is:\n    $$\n    \\frac{T^{n+1} - T^n}{\\Delta t} = -(\\mathbf{u}^n \\cdot \\nabla) T^n + \\alpha \\nabla^2 T^n + q^n\n    $$\n\n2.  **Velocity Prediction**: An intermediate velocity field $\\mathbf{u}^\\star$ is computed by time-stepping the momentum equation without the pressure gradient term. All right-hand-side terms, including advection, diffusion, and buoyancy, are evaluated explicitly at time level $n$:\n    $$\n    \\frac{\\mathbf{u}^\\star - \\mathbf{u}^n}{\\Delta t} = -(\\mathbf{u}^n \\cdot \\nabla)\\mathbf{u}^n + \\nu \\nabla^2 \\mathbf{u}^n + g \\beta \\bigl(T^n - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f}^n\n    $$\n\n3.  **Pressure Projection**: The intermediate velocity $\\mathbf{u}^\\star$ is not guaranteed to be divergence-free. A correction is applied to obtain the divergence-free velocity $\\mathbf{u}^{n+1}$. The relationship between the final and intermediate velocity is $\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\Delta t \\nabla \\pi'$. Applying the divergence operator and enforcing $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ yields the Pressure Poisson Equation (PPE) for the kinematic pressure increment $\\pi'$:\n    $$\n    \\nabla^2 \\pi' = \\frac{1}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star\n    $$\n    This elliptic equation is solved for $\\pi'$.\n\n4.  **Velocity Correction**: The final velocity at time $n+1$ is computed by correcting $\\mathbf{u}^\\star$ with the gradient of the potential $\\pi'$:\n    $$\n    \\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\Delta t \\nabla \\pi'\n    $$\n\nStability Constraints for $\\mathsf{S}_{\\mathrm{EX}}$:\nThe explicit treatment of both advection and diffusion imposes strict stability constraints on the time step $\\Delta t$.\n-   **Advection (CFL) Constraint**: For a first-order upwind discretization, the Courant-Friedrichs-Lewy (CFL) condition must be met. A sufficient condition is:\n    $$\n    \\Delta t_{\\mathrm{CFL}} \\le \\mathcal{C} \\left( \\frac{|u|_{\\max}}{\\Delta x} + \\frac{|v|_{\\max}}{\\Delta y} \\right)^{-1}\n    $$\n-   **Momentum Diffusion Constraint**: The explicit (forward Euler) treatment of the viscous term $\\nu \\nabla^2 \\mathbf{u}$ is stable if:\n    $$\n    \\Delta t_{\\mathrm{diff,u}} \\le \\frac{2}{\\nu \\lambda_{\\max}}\n    $$\n-   **Thermal Diffusion Constraint**: Similarly, the explicit treatment of the thermal diffusion term $\\alpha \\nabla^2 T$ is stable if:\n    $$\n    \\Delta t_{\\mathrm{diff,T}} \\le \\frac{2}{\\alpha \\lambda_{\\max}}\n    $$\nThe maximum admissible time step for the fully explicit scheme is the minimum of these three constraints: $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}} = \\min(\\Delta t_{\\mathrm{CFL}}, \\Delta t_{\\mathrm{diff,u}}, \\Delta t_{\\mathrm{diff,T}})$.\n\nScheme $\\mathsf{S}_{\\mathrm{SI}}$: Semi-Implicit Diffusion\n\nIn this scheme, the diffusion terms are treated implicitly (e.g., using a backward Euler method), while advection and source terms remain explicit. This approach enhances stability.\n\n1.  **Intermediate Explicit Update**: First, an intermediate state is computed by applying only the explicit advection and source terms from time level $n$.\n    -   For Temperature: $T^\\circ = T^n + \\Delta t \\left[ -(\\mathbf{u}^n \\cdot \\nabla) T^n + q^n \\right]$\n    -   For Velocity: $\\mathbf{u}^\\circ = \\mathbf{u}^n + \\Delta t \\left[ -(\\mathbf{u}^n \\cdot \\nabla)\\mathbf{u}^n + g \\beta \\bigl(T^n - T_{\\mathrm{ref}}\\bigr)\\,\\mathbf{e}_y + \\mathbf{f}^n \\right]$\n\n2.  **Implicit Diffusion Step**: The diffusion terms are now applied implicitly to produce the predictor fields. This requires solving a Helmholtz-type equation for each field.\n    -   For Temperature: $\\frac{T^{n+1} - T^\\circ}{\\Delta t} = \\alpha \\nabla^2 T^{n+1} \\implies (I - \\Delta t \\alpha \\nabla^2) T^{n+1} = T^\\circ$\n    -   For Velocity: $\\frac{\\mathbf{u}^\\star - \\mathbf{u}^\\circ}{\\Delta t} = \\nu \\nabla^2 \\mathbf{u}^\\star \\implies (I - \\Delta t \\nu \\nabla^2) \\mathbf{u}^\\star = \\mathbf{u}^\\circ$\n    This update for $T$ gives the final temperature $T^{n+1}$. The update for $\\mathbf{u}$ gives the predictor velocity $\\mathbf{u}^\\star$.\n\n3.  **Pressure Projection and Velocity Correction**: These steps are identical to those in the $\\mathsf{S}_{\\mathrm{EX}}$ scheme, using the predictor velocity $\\mathbf{u}^\\star$ obtained from the implicit diffusion step.\n    -   Solve PPE: $\\nabla^2 \\pi' = \\frac{1}{\\Delta t}\\nabla \\cdot \\mathbf{u}^\\star$\n    -   Correct Velocity: $\\mathbf{u}^{n+1} = \\mathbf{u}^\\star - \\Delta t \\nabla \\pi'$\n\nStability Constraints for $\\mathsf{S}_{\\mathrm{SI}}$:\nThe implicit treatment of diffusion is unconditionally stable. Therefore, the restrictive stability constraints related to diffusion are removed. The only remaining constraint is from the explicit treatment of advection.\n-   **Advection (CFL) Constraint**:\n    $$\n    \\Delta t_{\\mathrm{CFL}} \\le \\mathcal{C} \\left( \\frac{|u|_{\\max}}{\\Delta x} + \\frac{|v|_{\\max}}{\\Delta y} \\right)^{-1}\n    $$\nThe maximum admissible time step for the semi-implicit scheme is determined solely by the CFL condition: $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}} = \\Delta t_{\\mathrm{CFL}}$.\n\nCalculation of $\\Delta t_{\\max}$:\nFor a uniform grid with $N_x \\times N_y$ cells over a domain of size $L_x \\times L_y$, the grid spacings are $\\Delta x = L_x / N_x$ and $\\Delta y = L_y / N_y$. The bound on the largest eigenvalue of the discrete Laplacian is given as:\n$$\n\\lambda_{\\max} = \\frac{4}{\\Delta x^2} + \\frac{4}{\\Delta y^2}\n$$\nThe calculation uses a Courant number $\\mathcal{C} = 0.5$. If $|u|_{\\max} = 0$ and $|v|_{\\max} = 0$, the advection constraint is unbounded $(+\\infty)$.\n\nThe required computations for each test case are:\n1.  Calculate $\\Delta x$, $\\Delta y$, and $\\lambda_{\\max}$.\n2.  Calculate $\\Delta t_{\\mathrm{CFL}}$, handling the zero-velocity case.\n3.  Calculate $\\Delta t_{\\mathrm{diff,u}}$ and $\\Delta t_{\\mathrm{diff,T}}$.\n4.  For scheme $\\mathsf{S}_{\\mathrm{EX}}$, find $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{EX}}} = \\min(\\Delta t_{\\mathrm{CFL}}, \\Delta t_{\\mathrm{diff,u}}, \\Delta t_{\\mathrm{diff,T}})$.\n5.  For scheme $\\mathsf{S}_{\\mathrm{SI}}$, set $\\Delta t_{\\max}^{\\mathsf{S}_{\\mathrm{SI}}} = \\Delta t_{\\mathrm{CFL}}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum admissible time step for two numerical schemes\n    for simulating incompressible buoyancy-driven thermal flow.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"Lx\": 0.1, \"Ly\": 0.1, \"Nx\": 64, \"Ny\": 64,\n            \"u_max\": 0.02, \"v_max\": 0.01,\n            \"nu\": 1.0e-6, \"alpha\": 1.4e-7\n        },\n        {\n            \"case_id\": 2,\n            \"Lx\": 0.1, \"Ly\": 0.1, \"Nx\": 64, \"Ny\": 64,\n            \"u_max\": 0.01, \"v_max\": 0.01,\n            \"nu\": 1.0e-3, \"alpha\": 1.0e-3\n        },\n        {\n            \"case_id\": 3,\n            \"Lx\": 0.2, \"Ly\": 0.2, \"Nx\": 32, \"Ny\": 32,\n            \"u_max\": 0.0, \"v_max\": 0.0,\n            \"nu\": 1.0e-5, \"alpha\": 1.0e-5\n        }\n    ]\n\n    results = []\n    C = 0.5  # Courant number\n\n    for case in test_cases:\n        Lx, Ly = case[\"Lx\"], case[\"Ly\"]\n        Nx, Ny = case[\"Nx\"], case[\"Ny\"]\n        u_max, v_max = case[\"u_max\"], case[\"v_max\"]\n        nu, alpha = case[\"nu\"], case[\"alpha\"]\n\n        # Calculate grid spacing\n        dx = Lx / Nx\n        dy = Ly / Ny\n\n        # Calculate advection (CFL) stability constraint\n        cfl_denominator = (u_max / dx) + (v_max / dy)\n        if cfl_denominator == 0.0:\n            dt_cfl = np.inf\n        else:\n            dt_cfl = C / cfl_denominator\n\n        # Calculate diffusion stability constraints\n        lambda_max = (4 / dx**2) + (4 / dy**2)\n        \n        dt_diff_u = 2 / (nu * lambda_max)\n        dt_diff_t = 2 / (alpha * lambda_max)\n\n        # Determine max time step for each scheme\n        # Scheme S_EX: Fully Explicit\n        dt_max_ex = min(dt_cfl, dt_diff_u, dt_diff_t)\n        \n        # Scheme S_SI: Semi-Implicit (diffusion is implicit, no constraint)\n        # The pressure projection step also imposes no time-step restriction.\n        dt_max_si = dt_cfl\n        \n        results.append([dt_max_ex, dt_max_si])\n\n    # Format the output string exactly as specified: [[a_1,b_1],[a_2,b_2],...]\n    # without extra spaces around commas.\n    result_str = \",\".join(f\"[{r[0]},{r[1]}]\" for r in results)\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}