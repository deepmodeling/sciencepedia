{
    "hands_on_practices": [
        {
            "introduction": "在着手对一个问题进行离散化之前，理解其物理本质至关重要。本练习引入了斯特凡数（Stefan number），这是一个关键的无量纲参数，它不仅能帮助我们判断相变过程的类型，还能为我们选择合适的数值策略提供指导。通过计算斯特凡数并分析其物理意义，您将学会如何在开始编程之前就对问题的动态特性和数值挑战做出预判。",
            "id": "3987464",
            "problem": "一个占据 $x \\geq 0$ 区域的一维 (1D) 半无限相变平板，其初始温度为相变温度 $T_{m}$。在时间 $t=0$ 时，$x=0$ 处的边界温度突然升高并保持在一个更高的温度 $T_{b} > T_{m}$，从而引发熔化，并在 $x = s(t)$ 处形成一个清晰的固液界面。假设采用单相斯特凡模型，其中固体保持在 $T_{m}$，热传导仅发生在液体中，界面清晰且没有糊状区。液体的热导率为 $k$，密度为 $\\rho$，定压比热容为 $c_{p}$，材料的熔化潜热为 $L$。\n\n给定以下代表类石蜡相变材料的物理上合理的参数：\n- $k = 0.40\\ \\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$，\n- $\\rho = 900\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $c_{p} = 2200\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，\n- $L = 2.60 \\times 10^{5}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$，\n- $T_{m} = 327\\ \\mathrm{K}$，\n- $T_{b} = 342\\ \\mathrm{K}$，\n\n计算表征此熔化情景中显热与潜热之比的无量纲斯特凡数。然后，基于第一性原理，讨论界面动力学的预期定性状态（例如，缓慢或快速熔化），以及这对于移动边界问题的计算求解器在离散化方面（包括时间步长、网格分辨率和方法选择）的影响。将最终答案表示为一个四舍五入到三位有效数字的无量纲数。",
            "solution": "用户提供的问题在尝试解决前需要进行严格验证。\n\n### 步骤 1：提取已知条件\n- 区域：一维 (1D) 半无限平板，$x \\geq 0$。\n- 初始条件 ($t=0$)：整个平板处于相变温度，$T(x,0) = T_{m}$ 对所有 $x \\geq 0$。\n- 边界条件 ($x=0$)：对于 $t > 0$，边界保持在恒定温度 $T_{b} > T_{m}$，即 $T(0,t) = T_{b}$。\n- 界面：在位置 $x = s(t)$ 处存在一个清晰的固液界面。\n- 模型：单相斯特凡问题，其中固体保持在 $T = T_{m}$，热传导仅发生在液相中 ($0 \\leq x \\leq s(t)$)。\n- 液相属性：\n  - 热导率：$k = 0.40\\ \\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n  - 密度：$\\rho = 900\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n  - 比热容：$c_{p} = 2200\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- 材料属性：\n  - 熔化潜热：$L = 2.60 \\times 10^{5}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$\n- 温度：\n  - 熔化温度：$T_{m} = 327\\ \\mathrm{K}$\n  - 边界温度：$T_{b} = 342\\ \\mathrm{K}$\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题陈述进行验证。\n1.  **科学依据：** 该问题描述了一个经典的单相斯特凡问题，这是瞬态相变传热中一个基本且成熟的模型。其物理原理是合理的。所提供的材料参数明确说明是类石蜡材料的代表值，并且其数量级和单位在物理上是现实的。\n2.  **适定性：** 该问题是适定的。初始条件和边界条件足以确定液体中温度场和移动界面位置的唯一解。任务是计算一个标准的无量纲数（斯特凡数）并基于已建立的计算传热学原理进行定性讨论。\n3.  **客观性：** 问题使用清晰、客观和定量的语言进行陈述。\n4.  **完整性和一致性：** 计算斯特凡数所需的所有数据均已提供。条件 $T_{b} > T_{m}$ 确保会发生熔化，这与问题设置一致。没有矛盾之处。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。将提供解答。\n\n该问题需要两部分：计算斯特凡数，以及对其对问题动力学和数值解法影响的定性讨论。\n\n**第 1 部分：斯特凡数的计算**\n\n斯特凡数，记为 $Ste$，是一个无量纲参数，代表显热与潜热之比。对于熔化问题，它通常根据液相的属性来定义。特征显热是将单位质量的液体从熔化温度 $T_m$ 升高到边界温度 $T_b$ 所需的能量。潜热是在温度 $T_m$ 下熔化单位质量固体所需的能量。\n\n斯特凡数的数学定义是：\n$$\nSte = \\frac{c_{p} (T_{b} - T_{m})}{L}\n$$\n其中：\n- $c_p$ 是液体的比热容。\n- $L$ 是熔化潜热。\n- $T_b$ 是边界温度。\n- $T_m$ 是熔化温度。\n\n将给定值代入此定义：\n- $c_{p} = 2200\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- $T_{b} = 342\\ \\mathrm{K}$\n- $T_{m} = 327\\ \\mathrm{K}$\n- $L = 2.60 \\times 10^{5}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}$\n\n温差为 $\\Delta T = T_{b} - T_{m} = 342\\ \\mathrm{K} - 327\\ \\mathrm{K} = 15\\ \\mathrm{K}$。\n\n现在我们计算斯特凡数：\n$$\nSte = \\frac{(2200\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}) \\times (15\\ \\mathrm{K})}{2.60 \\times 10^{5}\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}}\n$$\n$$\nSte = \\frac{33000}{260000} = \\frac{33}{260}\n$$\n计算数值：\n$$\nSte \\approx 0.126923...\n$$\n四舍五入到三位有效数字，斯特凡数为 $0.127$。\n\n**第 2 部分：界面动力学及计算影响的讨论**\n\n计算出的斯特凡数约为 $Ste \\approx 0.127$。这个值远小于 $1$ ($Ste \\ll 1$)，这具有重要的物理和数值意义。\n\n**界面动力学的定性状态：**\n小的斯特凡数表明，熔化潜热 ($L$) 远大于液相的显热容 ($c_{p} (T_{b} - T_{m})$)。这标志着一个**潜热主导**的过程。物理上，这意味着到达固液界面的大部分热通量被相变本身消耗，只有一小部分用于提高新形成液体的温度。\n这导致了一个**缓慢熔化**的状态。界面 $s(t)$ 移动缓慢，因为需要大量的能量来克服潜热壁垒并熔化固体。在这种状态下，液相中的温度分布 $T(x,t)$（对于 $0 \\leq x \\leq s(t)$）趋于近似线性。这是因为边界的缓慢移动使得温度场能够弛豫到一种准稳态。液体中的控制热方程为 $\\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2}$，其中 $\\alpha = k/(\\rho c_p)$ 是热扩散率。对于缓慢的界面运动，瞬态项 $\\frac{\\partial T}{\\partial t}$ 相对于扩散项变得很小，温度分布接近稳态的线性分布。\n\n**对计算求解器中离散化的影响：**\n\n小的斯特凡数 ($Ste \\ll 1$) 将此问题归类为数值上的“刚性”问题，这指导了数值方法、时间步长和网格分辨率的选择。\n\n1.  **方法选择：**\n    - **界面追踪法：** 这类方法显式地追踪界面位置 $s(t)$，并在具有移动边界的液体域中求解热方程。对于像这样具有清晰界面的 1D 问题，界面追踪法非常精确。然而，对于更高维度或界面拓扑发生变化的问题，其实施会变得复杂。\n    - **固定网格法：** 这类方法通常更稳健且易于实现。最常见的是**焓法**。该问题被重新表述，以焓为主要变量，从而得到一个适用于整个区域的单一控制方程。相变通过焓-温度关系 $H(T)$ 被隐式处理。清晰的界面通常被涂抹在一个或两个网格单元上。这种方法具有强保守性和稳健性，使其成为工业代码的标准选择。另一种固定网格方法是**等效热容法**，其中潜热被建模为 $T_m$ 附近比热容的一个巨大峰值。这通常会导致严重的数值刚性问题，并需要非常小的时间步长来保证稳定性，因此不如焓法受欢迎。鉴于问题的刚性 ($Ste \\ll 1$)，焓法是一个绝佳的选择。\n\n2.  **时间步长 ($\\Delta t$)：**\n    - 问题由大的潜热项引起的刚性，强烈倾向于使用**隐式时间积分格式**（例如，后向欧拉法、Crank-Nicolson法）。显式格式会受到非常严格的时间步长限制以保证稳定性，尤其是在使用等效热容法时。隐式方法是无条件稳定的，允许由精度而非稳定性决定更大的时间步长。\n    - 即使使用隐式格式，时间步长也必须足够小，以精确解析界面运动。一个常见的经验法则是，确保界面在每个时间步内移动的距离小于一个网格宽度 ($\\Delta x$)，以避免相界面的非物理“跳跃”并保持焓法的准确性。由于熔化缓慢（归因于小 $Ste$），界面速度较低，这对时间步长的要求可能比高 $Ste$ 问题要宽松，但最终的选择取决于所需的精度。\n\n3.  **网格分辨率 ($\\Delta x$)：**\n    - 界面处的斯特凡条件 $k \\frac{\\partial T}{\\partial x}|_{x=s(t)^-} = \\rho L \\frac{ds}{dt}$ 表明，界面速度与前沿的温度梯度成正比。准确解析这个梯度至关重要。这需要在移动界面附近有精细的网格分辨率。\n    - 在固定网格法中，使用更精细的网格可以使界面位置和温度分布更准确。相界面的涂抹效应随着 $\\Delta x \\to 0$ 而减小。\n    - 因为大部分液体区域的温度分布近似线性（这是 $Ste \\ll 1$ 的结果），所以远离界面的区域可能使用较粗的网格就足够了。这使得该问题成为**自适应网格加密 (AMR)** 的理想候选。通过 AMR，仅在界面附近使用并随之移动的精细网格，而在其他地方使用较粗的网格。这种策略在最需要的地方提供了高精度，而没有全局精细网格带来的高昂计算成本，使其成为解决斯特凡问题的非常有效的方法。",
            "answer": "$$\n\\boxed{0.127}\n$$"
        },
        {
            "introduction": "在理解了问题的物理特性之后，下一步自然是尝试构建一个数值解法。本练习将引导您探索使用显式格式求解斯特凡问题的核心挑战，即需要同时满足由热扩散和界面移动所产生的不同稳定性约束。通过亲手推导和计算这些约束，您将深刻理解为何显式方法虽然直观，但在处理移动界面问题时必须小心处理时间步长。",
            "id": "3987453",
            "problem": "一个一维单相熔化问题在均匀网格上通过液相区域内的显式前向时间中心空间（FTCS）格式进行求解，其中一个被追踪的相界面位于位置 $s(t)$，并满足斯蒂芬（Stefan）条件。液相区域占据 $x \\in [0,s(t)]$，边界温度为 $T(0,t) = T_b$，界面温度为 $T(s(t),t) = T_m$。液相中的能量方程为 $\\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2}$，界面速度由斯蒂芬（Stefan）条件 $\\rho \\ell \\frac{\\mathrm{d}s}{\\mathrm{d}t} = -k \\frac{\\partial T}{\\partial x}\\bigg|_{x=s(t)^{-}}$ 控制，其中 $k$ 是导热系数，$\\rho$ 是密度，$\\ell$ 是熔化潜热，$\\alpha = k/(\\rho c_p)$ 是热扩散系数，$c_p$ 是比热容。\n\n温度场的显式更新使用均匀网格间距 $\\Delta x$ 和时间步长 $\\Delta t$。界面通过 $s^{n+1} = s^n + \\Delta t v^n$ 显式推进，其中 $v^n$ 是在时间 $t^n$ 时，利用界面液相侧的温度梯度，由斯蒂芬（Stefan）条件计算得出。\n\n仅从上述定义出发，推导在一个时间步长内，为保证数值稳定性和界面局域性所需的关于 $\\Delta t$ 的两个独立约束条件：\n- 一维FTCS格式的扩散稳定性约束，以及\n- 一个保证界面在单个时间步长内移动不超过一个网格单元的界面运动约束，即 $|s^{n+1} - s^n| \\le \\Delta x$。\n\n对于界面运动约束，通过将在时间 $t^n$ 时 $x=0$ 和 $x=s^n$ 之间的液相温度分布近似为线性，来对界面温度梯度进行保守估计。\n\n给定在时间层 $n$ 的以下数据：\n- $k = 237\\,\\mathrm{W\\,m^{-1}\\,K^{-1}}$,\n- $\\rho = 2700\\,\\mathrm{kg\\,m^{-3}}$,\n- $c_p = 900\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$,\n- $\\ell = 3.97 \\times 10^{5}\\,\\mathrm{J\\,kg^{-1}}$,\n- $T_b = 973\\,\\mathrm{K}$,\n- $T_m = 933\\,\\mathrm{K}$,\n- $\\Delta x = 5.0 \\times 10^{-4}\\,\\mathrm{m}$,\n- $s^n = 2.0 \\times 10^{-5}\\,\\mathrm{m}$,\n\n计算同时满足这两个约束的单个最严格的允许时间步长 $\\Delta t_{\\max}$。将您的答案四舍五入到4位有效数字。以秒为单位表示最终的时间步长。",
            "solution": "该问题陈述在科学上是合理的、适定的，并为确定给定数值格式的稳定性约束提供了所有必要的信息。我们将着手进行推导和计算。\n\n该问题要求为一维单相斯蒂芬（Stefan）问题的显式数值解推导关于时间步长 $\\Delta t$ 的两个独立约束。最终目标是基于所提供的数据，计算出单个最严格的时间步长 $\\Delta t_{\\max}$。\n\n第一个约束源于用于求解液相中热扩散方程的前向时间中心空间（FTCS）格式的稳定性。其控制方程为：\n$$\n\\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2}\n$$\n该方程在空间步长为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上的FTCS离散化为：\n$$\n\\frac{T_i^{n+1} - T_i^n}{\\Delta t} = \\alpha \\frac{T_{i+1}^n - 2T_i^n + T_{i-1}^n}{\\Delta x^2}\n$$\n其中 $T_i^n$ 是在网格点 $i$ 和时间层 $n$ 的温度。对新时间步长的温度 $T_i^{n+1}$ 进行整理，得到显式更新公式：\n$$\nT_i^{n+1} = T_i^n + \\frac{\\alpha \\Delta t}{\\Delta x^2} (T_{i+1}^n - 2T_i^n + T_{i-1}^n)\n$$\n让我们定义无量纲网格傅里叶数 $Fo$ 为 $Fo = \\frac{\\alpha \\Delta t}{\\Delta x^2}$。方程变为：\n$$\nT_i^{n+1} = (1 - 2Fo) T_i^n + Fo(T_{i+1}^n + T_{i-1}^n)\n$$\n为使FTCS格式稳定，时间层 $n$ 的温度值的系数必须为非负。这个从 von Neumann 稳定性分析中得出的条件可以防止非物理振荡和误差的放大。因此，约束条件为 $1 - 2Fo \\ge 0$，这意味着 $Fo \\le \\frac{1}{2}$。代入 $Fo$ 的定义，我们得到扩散稳定性约束：\n$$\n\\frac{\\alpha \\Delta t}{\\Delta x^2} \\le \\frac{1}{2} \\implies \\Delta t \\le \\frac{\\Delta x^2}{2\\alpha}\n$$\n我们将此约束表示为 $\\Delta t_{\\text{diffusion}}$。热扩散系数 $\\alpha$ 由 $\\alpha = \\frac{k}{\\rho c_p}$ 给出。\n\n第二个约束确保相界面在单个时间步长 $\\Delta t$ 内的移动距离不超过一个网格单元宽度 $\\Delta x$。这是一个针对移动前沿的界面局域性或库朗（Courant）类型条件。该约束给出为：\n$$\n|s^{n+1} - s^n| \\le \\Delta x\n$$\n界面位置通过 $s^{n+1} = s^n + v^n \\Delta t$ 显式更新，其中 $v^n = \\frac{\\mathrm{d}s}{\\mathrm{d}t}|_{t=t^n}$ 是在时间 $t^n$ 的界面速度。因此，$|s^{n+1} - s^n| = |v^n \\Delta t|$。由于 $T_b > T_m$，热量流向界面，导致熔化，这意味着界面位置 $s(t)$ 增加。因此，$v^n > 0$，约束简化为：\n$$\nv^n \\Delta t \\le \\Delta x \\implies \\Delta t \\le \\frac{\\Delta x}{v^n}\n$$\n我们将此约束表示为 $\\Delta t_{\\text{interface}}$。界面速度 $v^n$ 由斯蒂芬（Stefan）条件确定：\n$$\n\\rho \\ell v^n = -k \\frac{\\partial T}{\\partial x}\\bigg|_{x=s^n} \\implies v^n = -\\frac{k}{\\rho \\ell} \\frac{\\partial T}{\\partial x}\\bigg|_{x=s^n}\n$$\n问题指定我们应该通过在时间 $t^n$ 时假设液相区域 $[0, s^n]$ 内的温度分布为线性的来估计温度梯度。在边界条件 $T(0, t^n) = T_b$ 和 $T(s^n, t^n) = T_m$ 下，该线性分布为：\n$$\nT(x) = T_b + \\frac{T_m - T_b}{s^n} x\n$$\n因此，梯度在整个液相中是恒定的：\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{T_m - T_b}{s^n}\n$$\n将此梯度代入 $v^n$ 的表达式中：\n$$\nv^n = -\\frac{k}{\\rho \\ell} \\left(\\frac{T_m - T_b}{s^n}\\right) = \\frac{k(T_b - T_m)}{\\rho \\ell s^n}\n$$\n最后，将这个 $v^n$ 的表达式代入时间步长约束中，得到：\n$$\n\\Delta t_{\\text{interface}} \\le \\frac{\\Delta x}{v^n} = \\frac{\\Delta x (\\rho \\ell s^n)}{k(T_b - T_m)}\n$$\n现在，我们使用给定的数据计算这两个约束的数值：\n- $k = 237$\n- $\\rho = 2700$\n- $c_p = 900$\n- $\\ell = 3.97 \\times 10^5$\n- $T_b = 973$\n- $T_m = 933$\n- $\\Delta x = 5.0 \\times 10^{-4}$\n- $s^n = 2.0 \\times 10^{-5}$\n\n首先，我们计算热扩散系数 $\\alpha$：\n$$\n\\alpha = \\frac{k}{\\rho c_p} = \\frac{237}{2700 \\times 900} = \\frac{237}{2430000} \\approx 9.753086 \\times 10^{-5} \\, \\text{m}^2/\\text{s}\n$$\n现在，我们计算扩散稳定性极限 $\\Delta t_{\\text{diffusion}}$：\n$$\n\\Delta t_{\\text{diffusion}} \\le \\frac{\\Delta x^2}{2\\alpha} = \\frac{(5.0 \\times 10^{-4})^2}{2 \\times (9.753086 \\times 10^{-5})} = \\frac{2.5 \\times 10^{-7}}{1.950617 \\times 10^{-4}} \\approx 1.2816 \\times 10^{-3} \\, \\text{s}\n$$\n接下来，我们计算界面运动极限 $\\Delta t_{\\text{interface}}$：\n$$\n\\Delta t_{\\text{interface}} \\le \\frac{\\rho \\ell s^n \\Delta x}{k(T_b - T_m)} = \\frac{(2700)(3.97 \\times 10^5)(2.0 \\times 10^{-5})(5.0 \\times 10^{-4})}{237(973 - 933)}\n$$\n$$\n\\Delta t_{\\text{interface}} \\le \\frac{(2700)(3.97 \\times 10^5)(2.0 \\times 10^{-5})(5.0 \\times 10^{-4})}{237 \\times 40} = \\frac{10.719}{9480} \\approx 1.1307 \\times 10^{-3} \\, \\text{s}\n$$\n整体时间步长 $\\Delta t$ 必须同时满足这两个条件。因此，最大允许时间步长 $\\Delta t_{\\max}$ 是两个推导出的极限中的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{diffusion}}, \\Delta t_{\\text{interface}})\n$$\n$$\n\\Delta t_{\\max} = \\min(1.2816 \\times 10^{-3}, 1.1307 \\times 10^{-3}) = 1.1307 \\times 10^{-3} \\, \\text{s}\n$$\n将结果四舍五入到4位有效数字，我们得到：\n$$\n\\Delta t_{\\max} \\approx 1.131 \\times 10^{-3} \\, \\text{s}\n$$",
            "answer": "$$\n\\boxed{1.131 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "焓法是求解斯特凡问题的一种功能强大且稳健的现代方法，它巧妙地绕开了显式追踪移动界面的复杂性。本练习将指导您使用有限体积法实现一个基于焓法的求解器，并重点关注其内在的能量守恒特性，这是该方法备受青睐的关键优势之一。完成这项实践将使您掌握一种在计算传热学中广泛应用的实用技术。",
            "id": "3987456",
            "problem": "考虑一个长度为 $L_x$、横截面积 $A$ 均匀的一维平板，其材料密度为 $\\rho$，比热容为 $c_p$，热导率为 $k$，熔化潜热为 $L_h$。随温度变化的相分数 $\\phi(T)$ 由一个线性糊状区模型定义，其中固相线温度为 $T_s$，液相线温度为 $T_l$。对于 $T \\le T_s$，相分数满足 $\\phi(T)=0$；对于 $T \\ge T_l$，相分数满足 $\\phi(T)=1$；对于 $T_s  T  T_l$，相分数线性变化，为 $\\phi(T)=(T-T_s)/(T_l-T_s)$。体积焓定义为 $H(T) = \\rho c_p T + \\rho L_h \\phi(T)$。热通量根据傅里叶定律定义为 $q = -k \\frac{\\partial T}{\\partial x}$。\n\n从能量守恒定律出发，焓法将演化过程建模为 $\\frac{\\partial H}{\\partial t} + \\frac{\\partial q}{\\partial x} = 0$。使用有限体积法 (FVM) 将平板离散为 $N$ 个宽度为 $\\Delta x = L_x/N$ 的均匀控制体积。令 $H_i^n$ 表示在时间层 $n$ 时控制体积 $i$ 内的焓，并定义在面 $j=0,1,\\dots,N$ 上的面心通量 $q_{j}^n$，其中 $q_0^n$ 是在左边界（流入域内为正）规定的通量，$q_N^n$ 是在右边界规定的通量。每个控制体积中焓的更新必须通过对面通量求和来获得，该求和需与每个控制体积和时间步长 $\\Delta t$ 内的局部守恒一致。计算通量所需的温度必须通过在固相、糊状和液相区域对本构关系 $H(T)$ 进行分段反演，从焓中恢复。\n\n您的任务是实现一个程序，该程序能够：\n- 以均匀温度 $T_0$ 初始化平板，并计算所有控制体积 $i$ 对应的初始焓 $H_i^0$。\n- 使用所述的焓法和FVM通量求和，通过显式时间更新（该更新使用从 $H_i^n$ 恢复的温度 $T_i^n$ 和用于内部面梯度的中心差分），将焓场 $H_i^n$ 推进指定的步数。\n- 在每个时间步 $n \\to n+1$，计算吸收或释放的总潜热为 $\\sum_i \\rho L_h \\left(\\phi_i^{n+1} - \\phi_i^n\\right) V_i$，其中 $V_i = A \\Delta x$，并记录符号约定：正值表示潜热吸收（熔化），负值表示潜热释放（凝固）。\n- 通过计算全局能量残差 $R^n$ 来验证离散能量守恒。$R^n$ 定义为时间步内的净外部能量输入减去域内总焓的变化，即 $R^n = \\left(q_0^n - q_N^n\\right) A \\Delta t - \\sum_i \\left(H_i^{n+1} - H_i^n\\right) V_i$。报告所有模拟时间步中的最大绝对残差。\n\n所有能量必须以焦耳 ($\\mathrm{J}$) 为单位表示。所有温度必须以摄氏度 ($^{\\circ}\\mathrm{C}$) 为单位表示。不使用角度。输出中不包含百分比。\n\n使用以下参数集测试套件，在熔化、凝固和无相变三种情况下检验该实现。在所有情况下，均使用 $A=1$，$L_x=0.1$，$N=64$，$\\Delta t = 1.0$，$k=0.6$，$\\rho=1000$，$c_p=4200$，$L_h=334000$，$T_s=-1$，$T_l=1$，并模拟 $N_t=30$ 个时间步。对于所有情况，规定右边界通量 $q_N^n=0$。\n\n- 情况 1 (熔化)：$T_0=-2$，对于所有 $n$，左边界通量 $q_0^n=50000$。\n- 情况 2 (凝固)：$T_0=2$，对于所有 $n$，左边界通量 $q_0^n=-50000$。\n- 情况 3 (无相变)：$T_0=-10$，对于所有 $n$，左边界通量 $q_0^n=1000$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于每种情况，输出两个浮点数（单位为 $\\mathrm{J}$）：首先是所有时间步中的最大绝对能量残差，其次是所有时间步中消耗（正值）或释放（负值）的总潜热之和。因此，最终输出必须为 $\\left[ r_1, \\ell_1, r_2, \\ell_2, r_3, \\ell_3 \\right]$ 的形式，其中 $r_i$ 和 $\\ell_i$ 是情况 $i$ 的残差和潜热总量，单位为 $\\mathrm{J}$。",
            "solution": "用户提供的问题陈述已经过仔细验证，被确定为是健全、适定且具有科学依据的。它概述了一个经典的一维瞬态热传导伴随相变的问题，通常称为斯蒂芬问题（Stefan problem），该问题将使用焓法和有限体积法（FVM）离散化来求解。所有参数、控制方程和边界条件都已提供，从而能够进行直接而明确的实现。\n\n解决方案的开发遵循能量守恒原理和指定的数值格式。主要步骤包括离散化控制方程、定义数值更新算法以及详细说明物理本构关系。\n\n**1. 控制方程和本构关系**\n\n基本原理是能量守恒，对于一维系统，其表述为：\n$$\n\\frac{\\partial H}{\\partial t} + \\frac{\\partial q}{\\partial x} = 0\n$$\n其中 $H$ 是体积焓（单位 $\\mathrm{J}/\\mathrm{m}^3$），$q$ 是热通量（单位 $\\mathrm{W}/\\mathrm{m}^2$），$t$ 是时间，$x$ 是空间坐标。\n\n问题指定了连接主要变量焓 $H$ 和温度 $T$ 的本构关系：\n体积焓 $H(T)$ 是温度的函数，同时包含了显热和潜热：\n$$\nH(T) = \\rho c_p T + \\rho L_h \\phi(T)\n$$\n这里，$\\rho$ 是密度，$c_p$ 是比热容，$L_h$ 是熔化潜热。相分数 $\\phi(T)$ 取决于固相线温度 $T_s$ 和液相线温度 $T_l$：\n$$\n\\phi(T) =\n\\begin{cases}\n    0   \\text{若 } T \\le T_s \\quad (\\text{固相}) \\\\\n    \\frac{T-T_s}{T_l-T_s}   \\text{若 } T_s  T  T_l \\quad (\\text{糊状区}) \\\\\n    1   \\text{若 } T \\ge T_l \\quad (\\text{液相})\n\\end{cases}\n$$\n热通量 $q$ 由傅里叶传导定律给出：\n$$\nq = -k \\frac{\\partial T}{\\partial x}\n$$\n其中 $k$ 是热导率。\n\n**2. 有限体积离散化与显式更新**\n\n长度为 $L_x$ 的区域被离散化为 $N$ 个均匀的控制体积 (CV)，每个控制体积的宽度为 $\\Delta x = L_x/N$，体积为 $V_i = A \\Delta x$，其中 $A$ 是横截面积。我们将控制体积从 $i=0, \\dots, N-1$ 编号。控制体积的面从 $j=0, \\dots, N$ 编号，其中面 $j=0$ 是左边界，面 $j=N$ 是右边界，内部面 $j=i+1$ 分隔控制体积 $i$ 和 $i+1$。\n\n将控制方程在控制体积 $i$ (从 $x_i$ 到 $x_{i+1}$) 和一个时间步 $\\Delta t$ (从 $t^n$ 到 $t^{n+1}$) 上积分，得到积分守恒定律：\n$$\n\\int_{x_i}^{x_{i+1}} \\left( H(t^{n+1}) - H(t^n) \\right) dx + \\int_{t^n}^{t^{n+1}} \\left( q(x_{i+1}) - q(x_i) \\right) dt = 0\n$$\n用单元中心值和时间步开始时的值（显式格式）来近似空间和时间积分，我们得到控制体积 $i$ 中平均焓 $H_i$ 的离散方程：\n$$\n(H_i^{n+1} - H_i^n)\\Delta x + (q_{i+1}^n - q_i^n)\\Delta t = 0\n$$\n其中 $q_i^n$ 和 $q_{i+1}^n$ 分别代表在时间层 $n$ 时控制体积 $i$ 的左、右面上的通量。整理后得到更新后的焓 $H_i^{n+1}$：\n$$\nH_i^{n+1} = H_i^n - \\frac{\\Delta t}{\\Delta x} (q_{i+1}^n - q_i^n)\n$$\n问题定义了边界通量 $q_0^n$（左）和 $q_N^n$（右）。内部面通量使用中心差分格式来近似相邻单元中心之间的温度梯度：\n$$\nq_{i+1}^n \\approx -k \\frac{T_{i+1}^n - T_i^n}{\\Delta x} \\quad \\text{对于 } i = 0, \\dots, N-2\n$$\n\n**3. 焓-温度反演**\n\n在每个时间步，必须从焓场 $H^n$ 中恢复温度场 $T^n$ 以计算通量。这需要反演 $H(T)$ 关系。令 $H_s = \\rho c_p T_s$ 和 $H_l = \\rho c_p T_l + \\rho L_h$ 分别为固相点和液相点的焓。反演是分段进行的：\n- 若 $H \\le H_s$ (固相): $\\phi=0$，因此 $H = \\rho c_p T \\implies T = H / (\\rho c_p)$。\n- 若 $H \\ge H_l$ (液相): $\\phi=1$，因此 $H = \\rho c_p T + \\rho L_h \\implies T = (H - \\rho L_h) / (\\rho c_p)$。\n- 若 $H_s  H  H_l$ (糊状区): 相分数 $\\phi$ 与焓呈线性关系，$\\phi = (H - H_s) / (H_l - H_s)$。然后通过反演相分数的定义来恢复温度：$T = T_s + \\phi(T_l - T_s)$。这个两步过程 ($H \\to \\phi \\to T$) 在数值上是稳健的。\n\n**4. 数值算法与守恒性检验**\n\n模拟过程如下：\n1.  **初始化**: 给定一个初始均匀温度 $T_0$，计算所有控制体积 $i=0, \\dots, N-1$ 的初始相分数 $\\phi_i^0$ 和焓 $H_i^0$。\n2.  **时间推进**: 对于从 $0$ 到 $N_t-1$ 的每个时间步 $n$：\n    a.  存储当前的焓场 $H_i^n$ 和相分数场 $\\phi_i^n$。\n    b.  **恢复温度**: 对于所有的 $i$，使用反演逻辑从 $H_i^n$ 计算 $T_i^n$。\n    c.  **计算通量**: 计算所有面 $j=0, \\dots, N$ 上的通量 $q_j^n$。边界通量 $q_0^n$ 和 $q_N^n$ 是给定的，而内部通量根据温度场 $T^n$ 计算。\n    d.  **更新焓**: 对于所有的 $i$，使用显式FVM更新公式计算新的焓场 $H_i^{n+1}$。\n    e.  **后处理**:\n        i.  从 $H_i^{n+1}$ 恢复新的相分数 $\\phi_i^{n+1}$。\n        ii. 计算该步的潜热产生/消耗：$\\Delta L^n = \\sum_i \\rho L_h (\\phi_i^{n+1} - \\phi_i^n) V_i$。\n        iii. 通过计算残差来检验离散能量守恒：$R^n = (q_0^n - q_N^n) A \\Delta t - \\sum_i (H_i^{n+1} - H_i^n) V_i$。由于公式的构造，该残差理论上为零，任何非零值都源于浮点运算精度误差。记录整个模拟过程中 $R^n$ 的最大绝对值。\n3.  **报告**: 在完成给定测试用例的所有时间步后，报告最大绝对残差和累积的总潜热。对所有测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are used.\n\ndef solve():\n    \"\"\"\n    Solves the 1D Stefan problem using the enthalpy method and FVM.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'T0': -2.0, 'q0': 50000.0},  # Case 1: melting\n        {'T0': 2.0, 'q0': -50000.0}, # Case 2: solidification\n        {'T0': -10.0, 'q0': 1000.0},   # Case 3: no phase change\n    ]\n\n    # Global parameters\n    A = 1.0         # Cross-sectional area (m^2)\n    Lx = 0.1        # Slab length (m)\n    N = 64          # Number of control volumes\n    dt = 1.0        # Time step (s)\n    k = 0.6         # Thermal conductivity (W/m-K)\n    rho = 1000.0    # Density (kg/m^3)\n    cp = 4200.0     # Specific heat capacity (J/kg-K)\n    Lh = 334000.0   # Latent heat of fusion (J/kg)\n    Ts = -1.0       # Solidus temperature (degC)\n    Tl = 1.0        # Liquidus temperature (degC)\n    Nt = 30         # Number of time steps\n    qN = 0.0        # Flux at right boundary (x=Lx)\n\n    # Derived parameters\n    dx = Lx / N\n    Vi = A * dx  # Volume of a control volume\n\n    # Enthalpy thresholds for phase change\n    H_s = rho * cp * Ts\n    H_l = rho * cp * Tl + rho * Lh\n    H_mushy_range = H_l - H_s\n\n    # Helper function for state recovery from enthalpy\n    def get_T_and_phi_from_H(H_arr):\n        T_arr = np.zeros_like(H_arr)\n        phi_arr = np.zeros_like(H_arr)\n\n        solid_mask = H_arr = H_s\n        liquid_mask = H_arr >= H_l\n        mushy_mask = (~solid_mask)  (~liquid_mask)\n\n        # Solid phase\n        phi_arr[solid_mask] = 0.0\n        T_arr[solid_mask] = H_arr[solid_mask] / (rho * cp)\n\n        # Liquid phase\n        phi_arr[liquid_mask] = 1.0\n        T_arr[liquid_mask] = (H_arr[liquid_mask] - rho * Lh) / (rho * cp)\n\n        # Mushy phase\n        if H_mushy_range > 0:\n            phi_arr[mushy_mask] = (H_arr[mushy_mask] - H_s) / H_mushy_range\n            T_arr[mushy_mask] = Ts + phi_arr[mushy_mask] * (Tl - Ts)\n        \n        return T_arr, phi_arr\n\n    # Helper function for initialization\n    def get_H_and_phi_from_T(T_arr):\n        phi_arr = np.zeros_like(T_arr)\n\n        liquid_mask = T_arr >= Tl\n        mushy_mask = (T_arr > Ts)  (T_arr  Tl)\n\n        phi_arr[liquid_mask] = 1.0\n        if Tl - Ts > 0:\n            phi_arr[mushy_mask] = (T_arr[mushy_mask] - Ts) / (Tl - Ts)\n        \n        H_arr = rho * cp * T_arr + rho * Lh * phi_arr\n        \n        return H_arr, phi_arr\n    \n    results = []\n    \n    for case in test_cases:\n        T0 = case['T0']\n        q0 = case['q0']\n    \n        # Initialization for the current case\n        T = np.full(N, T0)\n        H, _ = get_H_and_phi_from_T(T)\n\n        total_latent_heat = 0.0\n        max_abs_residual = 0.0\n\n        # Main time-stepping loop\n        for n in range(Nt):\n            H_old = H.copy()\n            \n            # Recover temperature and phase fraction from current enthalpy\n            T, phi_old = get_T_and_phi_from_H(H_old)\n            \n            # Compute fluxes at faces\n            q_faces = np.zeros(N + 1)\n            q_faces[0] = q0\n            q_faces[N] = qN\n            # Interior faces (j=1 to N-1)\n            q_faces[1:-1] = -k * (T[1:] - T[:-1]) / dx\n            \n            # Update enthalpy for all control volumes\n            H += (dt / dx) * (q_faces[:-1] - q_faces[1:])\n            \n            # Recover new phase fraction to calculate latent heat change\n            _, phi_new = get_T_and_phi_from_H(H)\n\n            # Calculate latent heat change for this step\n            latent_heat_step = np.sum(rho * Lh * (phi_new - phi_old) * Vi)\n            total_latent_heat += latent_heat_step\n\n            # Calculate the energy residual for this step\n            # Total change in enthalpy in the domain\n            total_enthalpy_change = np.sum((H - H_old) * Vi)\n            # Net energy input from boundaries\n            net_boundary_input = (q_faces[0] - q_faces[-1]) * A * dt\n            \n            residual = net_boundary_input - total_enthalpy_change\n            if abs(residual) > max_abs_residual:\n                max_abs_residual = abs(residual)\n                \n        results.extend([max_abs_residual, total_latent_heat])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}