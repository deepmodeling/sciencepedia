{
    "hands_on_practices": [
        {
            "introduction": "掌握数值稳定性的第一步是理解其约束条件是如何从基本原理推导出来的。我们将从一个经典案例入手：用于模拟一维输运现象的平流-扩散方程。本练习将指导您完成冯·诺依曼稳定性分析，这是分析线性格式和周期性边界条件的基本工具。通过推导放大因子并施加 $|G| \\le 1$ 的稳定性条件，您将亲自为这个组合问题导出著名的 Courant-Friedrichs-Lewy (CFL) 条件，这项技能对于理解显式方法的内在局限性至关重要。 ",
            "id": "3985772",
            "problem": "考虑均匀、不可压缩流中的一维热输运，其温度 $u(x,t)$ 由以下线性平流-扩散方程建模：\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; \\nu\\,\\frac{\\partial^{2}u}{\\partial x^{2}},\n$$\n其中 $a>0$ 是恒定的平流速度，$\\nu>0$ 是恒定的热扩散系数。假设一个周期性域和均匀空间网格 $x_j = j\\,h$，网格间距为 $h>0$。你需要使用显式前向欧拉格式对解进行时间推进。对于空间离散化，平流项使用一阶迎风近似（适用于 $a>0$），扩散项使用二阶中心近似，得到如下更新公式：\n$$\nu_j^{n+1} \\;=\\; u_j^n \\;-\\; \\frac{a\\,\\Delta t}{h}\\left(u_j^n - u_{j-1}^n\\right) \\;+\\; \\frac{\\nu\\,\\Delta t}{h^2}\\left(u_{j+1}^n - 2\\,u_j^n + u_{j-1}^n\\right).\n$$\n从该偏微分方程和这些标准离散化方法出发，在周期性假设下进行傅里叶（冯·诺依曼）稳定性分析。推导放大因子，并施加其模对所有可分辨的波数都不超过1的条件。根据这一要求，确定最大稳定时间步长 $\\Delta t$，并将其表示为参数 $a$、$\\nu$ 和 $h$ 的闭式表达式。\n\n你的最终答案 $\\Delta t$ 应以秒为单位。题目未提供数值；请给出精确的解析表达式。无需四舍五入。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n已知信息如下：\n- **偏微分方程 (PDE)**：温度 $u(x,t)$ 的一维线性平流-扩散方程：\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; \\nu\\,\\frac{\\partial^{2}u}{\\partial x^{2}}\n$$\n- **常数**：平流速度 $a>0$ 和热扩散系数 $\\nu>0$。\n- **域和网格**：一个周期性域，具有均匀空间网格 $x_j = j\\,h$，其中 $h>0$ 是网格间距。\n- **数值格式**：时间积分使用显式前向欧拉格式。空间导数使用一阶迎风格式近似平流项（$\\frac{\\partial u}{\\partial x}$），使用二阶中心差分格式近似扩散项（$\\frac{\\partial^2 u}{\\partial x^2}$）。\n- **有限差分方程 (FDE)**：由此得到的离散更新规则如下：\n$$\nu_j^{n+1} \\;=\\; u_j^n \\;-\\; \\frac{a\\,\\Delta t}{h}\\left(u_j^n - u_{j-1}^n\\right) \\;+\\; \\frac{\\nu\\,\\Delta t}{h^2}\\left(u_{j+1}^n - 2\\,u_j^n + u_{j-1}^n\\right)\n$$\n其中 $\\Delta t$ 是时间步长。\n- **任务**：进行傅里叶（冯·诺依曼）稳定性分析，以 $a$、$\\nu$ 和 $h$ 的闭式表达式形式求出最大稳定时间步长 $\\Delta t$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于平流-扩散方程，这是输运现象中的一个基本模型。所描述的数值方法（前向欧拉、迎风、中心差分）和分析技术（冯·诺依曼稳定性分析）是计算物理和工程学中标准、成熟的工具。该问题完全具有科学合理性。\n- **适定性**：问题定义清晰。它指明了控制方程、数值格式以及要使用的分析方法。目标是推导一个特定的量，即稳定性极限，对于给定的格式，这个极限应该是唯一的。\n- **客观性**：问题以精确的数学语言表达，没有任何主观性或歧义。\n- **完整性和一致性**：提供了所有必要的信息。给出的偏微分方程和相应的有限差分方程与所描述的离散化方法是一致的。约束条件 $a>0$、$\\nu>0$ 和 $h>0$ 具有物理意义，在数学上也是必要的。\n- **现实性**：该设置是计算热工问题的一个标准模型。\n\n### 步骤3：结论与行动\n该问题具有科学依据、适定性、客观性和完整性，因此是有效的。将提供解答。\n\n### 解答推导\n为进行冯·诺依曼稳定性分析，我们考虑网格上数值解的单个傅里叶模态。我们将网格点 $j$ 和时间步 $n$ 的解表示为：\n$$\nu_j^n = \\hat{u}^n(k) \\, e^{i k x_j} = \\hat{u}^n(k) \\, e^{i k j h}\n$$\n其中 $k$ 是波数，$i$ 是虚数单位，$\\hat{u}^n(k)$ 是在时间步 $n$ 的模态振幅。格式的稳定性取决于放大因子 $G(k)$，它关联了连续时间步的振幅：\n$$\n\\hat{u}^{n+1}(k) = G(k) \\, \\hat{u}^n(k)\n$$\n将傅里叶模态表示代入有限差分方程，我们得到：\n$$\nG(k) \\hat{u}^n(k) e^{i k j h} = \\hat{u}^n(k) e^{i k j h} - \\frac{a \\Delta t}{h} \\left( \\hat{u}^n(k) e^{i k j h} - \\hat{u}^n(k) e^{i k (j-1) h} \\right) + \\frac{\\nu \\Delta t}{h^2} \\left( \\hat{u}^n(k) e^{i k (j+1) h} - 2 \\hat{u}^n(k) e^{i k j h} + \\hat{u}^n(k) e^{i k (j-1) h} \\right)\n$$\n我们可以从所有项中消去公因子 $\\hat{u}^n(k) e^{i k j h}$：\n$$\nG(k) = 1 - \\frac{a \\Delta t}{h} (1 - e^{-i k h}) + \\frac{\\nu \\Delta t}{h^2} (e^{i k h} - 2 + e^{-i k h})\n$$\n我们定义两个无量纲数：库朗数 $C = \\frac{a \\Delta t}{h}$ 和扩散数 $d = \\frac{\\nu \\Delta t}{h^2}$。令 $\\theta = k h$。放大因子的表达式变为：\n$$\nG(\\theta) = 1 - C (1 - e^{-i \\theta}) + d (e^{i \\theta} - 2 + e^{-i \\theta})\n$$\n使用欧拉恒等式（$e^{i\\phi} = \\cos\\phi + i\\sin\\phi$），我们可以简化这些项：\n$$\n1 - e^{-i \\theta} = 1 - (\\cos\\theta - i\\sin\\theta) = 1 - \\cos\\theta + i\\sin\\theta\n$$\n$$\ne^{i \\theta} - 2 + e^{-i \\theta} = (\\cos\\theta + i\\sin\\theta) - 2 + (\\cos\\theta - i\\sin\\theta) = 2\\cos\\theta - 2\n$$\n将这些代回 $G(\\theta)$ 的表达式中：\n$$\nG(\\theta) = 1 - C(1 - \\cos\\theta + i\\sin\\theta) + d(2\\cos\\theta - 2)\n$$\n分离实部和虚部：\n$$\nG(\\theta) = [1 - C(1 - \\cos\\theta) - 2d(1 - \\cos\\theta)] - i[C\\sin\\theta]\n$$\n$$\nG(\\theta) = [1 - (C + 2d)(1 - \\cos\\theta)] - i[C\\sin\\theta]\n$$\n为使数值格式稳定，对任何可能的波数，放大因子的模都不能超过1，即对所有 $\\theta \\in [-\\pi, \\pi]$ 都有 $|G(\\theta)| \\le 1$。这等价于 $|G(\\theta)|^2 \\le 1$。\n$$\n|G(\\theta)|^2 = [1 - (C + 2d)(1 - \\cos\\theta)]^2 + (C\\sin\\theta)^2 \\le 1\n$$\n展开表达式：\n$$\n1 - 2(C + 2d)(1 - \\cos\\theta) + (C + 2d)^2(1 - \\cos\\theta)^2 + C^2\\sin^2\\theta \\le 1\n$$\n两边减1并简化：\n$$\n-2(C + 2d)(1 - \\cos\\theta) + (C + 2d)^2(1 - \\cos\\theta)^2 + C^2\\sin^2\\theta \\le 0\n$$\n为了简化这个表达式，我们使用半角恒等式 $1 - \\cos\\theta = 2\\sin^2(\\frac{\\theta}{2})$ 和恒等式 $\\sin^2\\theta = 4\\sin^2(\\frac{\\theta}{2})\\cos^2(\\frac{\\theta}{2}) = 4\\sin^2(\\frac{\\theta}{2})(1-\\sin^2(\\frac{\\theta}{2}))$。令 $S = \\sin^2(\\frac{\\theta}{2})$。不等式变为：\n$$\n-2(C + 2d)(2S) + (C + 2d)^2(2S)^2 + C^2(4S(1-S)) \\le 0\n$$\n对于 $S \\ne 0$（即对于非零波数），我们可以除以 $4S$：\n$$\n-(C + 2d) + S(C + 2d)^2 + C^2(1-S) \\le 0\n$$\n根据 $S$ 重新排列各项：\n$$\nS [(C + 2d)^2 - C^2] + [C^2 - (C + 2d)] \\le 0\n$$\n简化 $S$ 的系数：\n$$\n(C + 2d)^2 - C^2 = C^2 + 4Cd + 4d^2 - C^2 = 4Cd + 4d^2 = 4d(C+d)\n$$\n现在不等式为：\n$$\nS [4d(C+d)] + C^2 - C - 2d \\le 0\n$$\n这个不等式必须对所有可分辨的模态都成立。$\\theta$ 的范围是 $[-\\pi, \\pi]$，这意味着 $\\frac{\\theta}{2}$ 在 $[-\\frac{\\pi}{2}, \\frac{\\pi}{2}]$ 内，因此 $S = \\sin^2(\\frac{\\theta}{2})$ 在 $[0, 1]$ 内。\n由于 $a, \\nu, h, \\Delta t$ 均为正数，所以 $C>0$ 且 $d>0$。因此 $S$ 的系数 $4d(C+d)$ 是正的。这意味着不等式左边是 $S$ 的单调递增函数。最严格的条件（即不等式左边的最大值）发生在 $S$ 取其最大值 $S=1$ 时（对应于 $\\theta=\\pi$ 的最高频率模态）。我们必须对 $S=1$ 施加此不等式：\n$$\n(1) [4d(C+d)] + C^2 - C - 2d \\le 0\n$$\n$$\n4Cd + 4d^2 + C^2 - C - 2d \\le 0\n$$\n这个表达式可以方便地重新排列为：\n$$\n(C^2 + 4Cd + 4d^2) - (C + 2d) \\le 0\n$$\n$$\n(C + 2d)^2 - (C + 2d) \\le 0\n$$\n令 $Z = C + 2d$。不等式为 $Z^2 - Z \\le 0$，即 $Z(Z-1) \\le 0$。\n因为 $C = \\frac{a \\Delta t}{h} > 0$ 且 $d = \\frac{\\nu \\Delta t}{h^2} > 0$，它们的和 $Z = C+2d$ 也必须是正的。要使乘积 $Z(Z-1)$ 非正，我们必须有 $Z-1 \\le 0$，这意味着 $Z \\le 1$。\n因此，稳定性的条件是：\n$$\nC + 2d \\le 1\n$$\n将 $C$ 和 $d$ 的定义代回这个不等式：\n$$\n\\frac{a \\Delta t}{h} + 2\\frac{\\nu \\Delta t}{h^2} \\le 1\n$$\n为了求出最大稳定时间步长 $\\Delta t$，我们求解 $\\Delta t$：\n$$\n\\Delta t \\left( \\frac{a}{h} + \\frac{2\\nu}{h^2} \\right) \\le 1\n$$\n由于括号中的项是正的，我们可以写成：\n$$\n\\Delta t \\le \\frac{1}{\\frac{a}{h} + \\frac{2\\nu}{h^2}}\n$$\n将分母中的项合并成一个分数：\n$$\n\\Delta t \\le \\frac{1}{\\frac{ah + 2\\nu}{h^2}}\n$$\n因此，最大稳定时间步长是：\n$$\n\\Delta t_{\\text{max}} = \\frac{h^2}{ah + 2\\nu}\n$$\n该表达式给出了以问题的物理和数值参数表示的稳定性极限。",
            "answer": "$$\n\\boxed{\\frac{h^2}{ah + 2\\nu}}\n$$"
        },
        {
            "introduction": "理论上的稳定性限制必须转化为实际的代码。现实世界的模拟常常涉及复杂的几何形状和非均匀材料，其中稳定性约束在空间上是变化的。本练习要求您设计一个时间步长控制器，这是任何自适应瞬态求解器的核心组件。通过在整个计算域中遵守最严格的局部柯朗数和傅里叶数，该控制器必须能够动态计算出允许的最大时间步长。  这项实践性的编程任务将理论与应用联系起来，教您如何编写能在复杂、非均匀场景下自动确保稳定性的稳健代码。",
            "id": "3985745",
            "problem": "您的任务是为一维空间中的显式瞬态热模拟设计并实现一个时间步长控制器，该控制器必须在空间非均匀域上强制执行稳定性约束。其控制物理原理为包含平流和扩散的一维瞬态能量平衡：\n$$\\rho c_p \\frac{\\partial T}{\\partial t} + \\rho c_p u \\frac{\\partial T}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(k \\frac{\\partial T}{\\partial x}\\right),$$\n其中 $T$ 是温度，$t$ 是时间，$x$ 是空间坐标，$\\rho$ 是密度，$c_p$ 是比热容，$u$ 是平流速度，$k$ 是热导率。热扩散率定义为 $\\alpha = \\frac{k}{\\rho c_p}$。对于显式时间积分器，其稳定性约束由每个单元 $j$ 处的两个局部无量纲群表示：库朗数 $C_j$ 和傅里叶数 $Fo_j$，定义如下：\n$$C_j = \\frac{|u_j| \\Delta t}{\\Delta x_j}, \\qquad Fo_j = \\frac{\\alpha_j \\Delta t}{\\Delta x_j^2},$$\n其中 $\\Delta x_j$ 是单元尺寸，$u_j$ 是局部平流速率，$\\alpha_j$ 是局部热扩散率。给定两个目标值 $C_{\\text{tgt}}$ 和 $Fo_{\\text{tgt}}$，以及一个安全因子 $s \\in (0, 1]$。该控制器必须在每一步选择最大的时间步长 $\\Delta t$，以确保整个域上的最大库朗数和最大傅里叶数分别不超过经安全因子 $s$ 缩放的 $C_{\\text{tgt}}$ 和 $Fo_{\\text{tgt}}$。形式上，您选择的 $\\Delta t$ 必须满足：\n$$\\max_j C_j \\le s\\, C_{\\text{tgt}}, \\qquad \\max_j Fo_j \\le s\\, Fo_{\\text{tgt}}.$$\n如果某个单元的局部平流速度 $u_j$ 为零，则该单元的局部库朗数约束不对 $\\Delta t$ 产生限制；如果局部热扩散率 $\\alpha_j$ 为零，则该单元的局部傅里叶数约束不对 $\\Delta t$ 产生限制。单位必须保持一致：$\\Delta x_j$ 单位为 $\\mathrm{m}$，$u_j$ 单位为 $\\mathrm{m/s}$，$\\rho_j$ 单位为 $\\mathrm{kg/m^3}$，$c_{p,j}$ 单位为 $\\mathrm{J/(kg\\,K)}$，$k_j$ 单位为 $\\mathrm{W/(m\\,K)}$，结果 $\\Delta t$ 单位为 $\\mathrm{s}$。最终的时间步长以秒为单位，用十进制数表示。\n\n您的程序必须实现一个函数，该函数在给定数组 $\\{\\Delta x_j\\}$, $\\{u_j\\}$, $\\{k_j\\}$, $\\{\\rho_j\\}$, $\\{c_{p,j}\\}$、目标库朗数 $C_{\\text{tgt}}$、目标傅里叶数 $Fo_{\\text{tgt}}$ 和安全因子 $s$ 的情况下，返回所选的、同时满足两个全域约束的 $\\Delta t$。程序必须评估以下测试套件，并报告每种情况下的 $\\Delta t$ 结果。\n\n测试套件：\n- 情况1（平流限制，均匀介质）：\n  - $\\Delta x = [\\,0.01,\\,0.01,\\,0.01,\\,0.01\\,]\\,\\mathrm{m}$，\n  - $u = [\\,0.5,\\,0.5,\\,0.5,\\,0.5\\,]\\,\\mathrm{m/s}$，\n  - $k = [\\,20,\\,20,\\,20,\\,20\\,]\\,\\mathrm{W/(m\\,K)}$，\n  - $\\rho = [\\,7800,\\,7800,\\,7800,\\,7800\\,]\\,\\mathrm{kg/m^3}$，\n  - $c_p = [\\,500,\\,500,\\,500,\\,500\\,]\\,\\mathrm{J/(kg\\,K)}$，\n  - $C_{\\text{tgt}} = 0.5$, $Fo_{\\text{tgt}} = 0.25$, $s = 0.9$。\n- 情况2（扩散限制，非均匀介质和非均匀网格）：\n  - $\\Delta x = [\\,0.02,\\,0.01,\\,0.005,\\,0.02\\,]\\,\\mathrm{m}$，\n  - $u = [\\,0,\\,0,\\,0,\\,0\\,]\\,\\mathrm{m/s}$，\n  - $k = [\\,200,\\,15,\\,40,\\,100\\,]\\,\\mathrm{W/(m\\,K)}$，\n  - $\\rho = [\\,8000,\\,2700,\\,8900,\\,7800\\,]\\,\\mathrm{kg/m^3}$，\n  - $c_p = [\\,500,\\,900,\\,380,\\,500\\,]\\,\\mathrm{J/(kg\\,K)}$，\n  - $C_{\\text{tgt}} = 0.6$, $Fo_{\\text{tgt}} = 0.2$, $s = 1.0$。\n- 情况3（平流-扩散混合，u 中包含零值及强局部约束）：\n  - $\\Delta x = [\\,0.005,\\,0.01,\\,0.002,\\,0.02\\,]\\,\\mathrm{m}$，\n  - $u = [\\,2.0,\\,0.0,\\,-1.0,\\,0.5\\,]\\,\\mathrm{m/s}$，\n  - $k = [\\,15,\\,30,\\,12,\\,20\\,]\\,\\mathrm{W/(m\\,K)}$，\n  - $\\rho = [\\,7800,\\,7800,\\,8900,\\,1000\\,]\\,\\mathrm{kg/m^3}$，\n  - $c_p = [\\,500,\\,500,\\,380,\\,4184\\,]\\,\\mathrm{J/(kg\\,K)}$，\n  - $C_{\\text{tgt}} = 0.8$, $Fo_{\\text{tgt}} = 0.3$, $s = 0.95$。\n- 情况4（纯扩散，小单元决定了严格的时间步长）：\n  - $\\Delta x = [\\,0.001,\\,0.002,\\,0.004\\,]\\,\\mathrm{m}$，\n  - $u = [\\,0.0,\\,0.0,\\,0.0\\,]\\,\\mathrm{m/s}$，\n  - $k = [\\,180,\\,180,\\,180\\,]\\,\\mathrm{W/(m\\,K)}$，\n  - $\\rho = [\\,9000,\\,9000,\\,9000\\,]\\,\\mathrm{kg/m^3}$，\n  - $c_p = [\\,400,\\,400,\\,400\\,]\\,\\mathrm{J/(kg\\,K)}$，\n  - $C_{\\text{tgt}} = 0.7$, $Fo_{\\text{tgt}} = 0.5$, $s = 0.8$。\n- 情况5（扩散主导的混合情况）：\n  - $\\Delta x = [\\,0.01,\\,0.01\\,]\\,\\mathrm{m}$，\n  - $u = [\\,0.01,\\,0.02\\,]\\,\\mathrm{m/s}$，\n  - $k = [\\,200,\\,200\\,]\\,\\mathrm{W/(m\\,K)}$，\n  - $\\rho = [\\,1000,\\,1000\\,]\\,\\mathrm{kg/m^3}$，\n  - $c_p = [\\,1000,\\,1000\\,]\\,\\mathrm{J/(kg\\,K)}$，\n  - $C_{\\text{tgt}} = 0.8$, $Fo_{\\text{tgt}} = 0.2$, $s = 1.0$。\n\n您的程序应生成单行输出，其中包含用方括号括起来、并按上述情况顺序排列的以逗号分隔的结果列表，例如“[0.1,0.2,0.3,0.4,0.5]”。请确保报告的每个 $\\Delta t$ 都以 $\\mathrm{s}$ 为单位。",
            "solution": "所述问题具有科学依据，定义明确、客观且完整。所有提供的数据和物理原理均与计算传热学中的既定理论一致。因此，可以推导出解决方案。\n\n问题的核心是为保持稳定性的显式数值模拟确定可能的最大时间步长 $\\Delta t$。该模拟求解的是一维能量输运的平流-扩散方程：\n$$\n\\rho c_p \\frac{\\partial T}{\\partial t} + \\rho c_p u \\frac{\\partial T}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(k \\frac{\\partial T}{\\partial x}\\right)\n$$\n显式方法的稳定性受限于局部的、基于单元的约束，这些约束限制了信息在单个时间步长内可以传播的距离。问题基于库朗数 $C_j$（用于平流）和傅里叶数 $Fo_j$（用于扩散）提供了两个此类约束。为确保整个计算域的稳定性，所选的时间步长 $\\Delta t$ 必须满足每个单元 $j$ 的稳定性条件。这意味着 $\\Delta t$ 受域中最具限制性单元的制约。\n\n目标是找到满足两个全局条件的最大 $\\Delta t > 0$：\n$$\n\\max_j C_j \\le s \\, C_{\\text{tgt}} \\quad \\text{and} \\quad \\max_j Fo_j \\le s \\, Fo_{\\text{tgt}}\n$$\n其中 $s$ 是安全因子，$C_{\\text{tgt}}$ 和 $Fo_{\\text{tgt}}$ 是目标稳定性数。我们可以分别分析每个约束，以找到其各自允许的最大时间步长，然后将它们组合起来。\n\n首先，考虑平流约束（库朗条件）。单元 $j$ 的局部库朗数由 $C_j = \\frac{|u_j| \\Delta t}{\\Delta x_j}$ 给出。因此，单元 $j$ 的稳定性要求为：\n$$\n\\frac{|u_j| \\Delta t}{\\Delta x_j} \\le s \\, C_{\\text{tgt}}\n$$\n求解 $\\Delta t$ 可得局部时间步长限制：\n$$\n\\Delta t \\le \\frac{s \\, C_{\\text{tgt}} \\Delta x_j}{|u_j|}\n$$\n该不等式必须对域中所有存在平流的单元 $j$（即 $|u_j| > 0$）成立。如果某个特定单元的 $u_j = 0$，则该单元对时间步长不施加平流限制。为同时满足所有相关单元的约束，$\\Delta t$ 必须小于或等于所有这些局部限制中的最小值。这为我们提供了全局平流时间步长限制 $\\Delta t_C$：\n$$\n\\Delta t_C = \\min_{j \\, | \\, u_j \\neq 0} \\left( \\frac{s \\, C_{\\text{tgt}} \\Delta x_j}{|u_j|} \\right)\n$$\n如果所有速度 $u_j$ 均为零，则此约束无效，我们可以认为 $\\Delta t_C$ 为无穷大。\n\n其次，考虑扩散约束（傅里叶条件）。单元 $j$ 的局部傅里叶数为 $Fo_j = \\frac{\\alpha_j \\Delta t}{\\Delta x_j^2}$，其中热扩散率为 $\\alpha_j = \\frac{k_j}{\\rho_j c_{p,j}}$。单元 $j$ 的稳定性要求为：\n$$\n\\frac{\\alpha_j \\Delta t}{\\Delta x_j^2} \\le s \\, Fo_{\\text{tgt}}\n$$\n求解 $\\Delta t$ 可得另一个局部时间步长限制：\n$$\n\\Delta t \\le \\frac{s \\, Fo_{\\text{tgt}} \\Delta x_j^2}{\\alpha_j} = \\frac{s \\, Fo_{\\text{tgt}} \\rho_j c_{p,j} \\Delta x_j^2}{k_j}\n$$\n该不等式必须对所有存在扩散的单元 $j$（即 $\\alpha_j > 0$，意味着 $k_j > 0$）成立。如果 $k_j = 0$，则该单元不施加扩散限制。为满足所有相关单元的约束，$\\Delta t$ 必须小于或等于所有这些局部扩散限制中的最小值。这定义了全局扩散时间步长限制 $\\Delta t_F$：\n$$\n\\Delta t_F = \\min_{j \\, | \\, k_j \\neq 0} \\left( \\frac{s \\, Fo_{\\text{tgt}} \\rho_j c_{p,j} \\Delta x_j^2}{k_j} \\right)\n$$\n如果所有热导率 $k_j$ 均为零，则此约束无效，可以认为 $\\Delta t_F$ 为无穷大。\n\n为确保整个模拟的稳定性，所选的时间步长 $\\Delta t$ 必须同时满足平流和扩散约束。因此，它必须小于或等于 $\\Delta t_C$ 和 $\\Delta t_F$。要找到满足此要求的最大可能时间步长，我们必须选择两个全局限制中较小的一个：\n$$\n\\Delta t_{\\text{final}} = \\min(\\Delta t_C, \\Delta t_F)\n$$\n这就是最终的、全局稳定的时间步长。\n\n每个测试用例的算法如下：\n1. 接收单元属性数组 $\\{\\Delta x_j\\}$, $\\{u_j\\}$, $\\{k_j\\}$, $\\{\\rho_j\\}$, $\\{c_{p,j}\\}$ 和标量参数 $C_{\\text{tgt}}$, $Fo_{\\text{tgt}}$, $s$。\n2. 计算局部平流时间步长限制的向量 $\\Delta t_{C,j} = \\frac{s C_{\\text{tgt}} \\Delta x_j}{|u_j|}$。对于 $u_j=0$ 的任何单元 $j$，此限制为无穷大。\n3. 找到全局平流限制 $\\Delta t_C = \\min_j(\\{\\Delta t_{C,j}\\})$。\n4. 计算局部扩散时间步长限制的向量 $\\Delta t_{F,j} = \\frac{s Fo_{\\text{tgt}} \\rho_j c_{p,j} \\Delta x_j^2}{k_j}$。对于 $k_j=0$ 的任何单元 $j$，此限制为无穷大。\n5. 找到全局扩散限制 $\\Delta t_F = \\min_j(\\{\\Delta t_{F,j}\\})$。\n6. 该情况的结果是 $\\Delta t = \\min(\\Delta t_C, \\Delta t_F)$。\n将此过程应用于套件中的每个测试用例，以生成最终的结果列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum stable time step for a series of 1D transient\n    thermal simulation test cases, based on Courant and Fourier stability\n    constraints.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (advection-limited, uniform medium)\n        {\n            \"dx\": np.array([0.01, 0.01, 0.01, 0.01]),\n            \"u\": np.array([0.5, 0.5, 0.5, 0.5]),\n            \"k\": np.array([20, 20, 20, 20]),\n            \"rho\": np.array([7800, 7800, 7800, 7800]),\n            \"cp\": np.array([500, 500, 500, 500]),\n            \"C_tgt\": 0.5, \"Fo_tgt\": 0.25, \"s\": 0.9\n        },\n        # Case 2 (diffusion-limited, heterogeneous and nonuniform)\n        {\n            \"dx\": np.array([0.02, 0.01, 0.005, 0.02]),\n            \"u\": np.array([0, 0, 0, 0]),\n            \"k\": np.array([200, 15, 40, 100]),\n            \"rho\": np.array([8000, 2700, 8900, 7800]),\n            \"cp\": np.array([500, 900, 380, 500]),\n            \"C_tgt\": 0.6, \"Fo_tgt\": 0.2, \"s\": 1.0\n        },\n        # Case 3 (mixed advection–diffusion, with zeros in u and strong local constraint)\n        {\n            \"dx\": np.array([0.005, 0.01, 0.002, 0.02]),\n            \"u\": np.array([2.0, 0.0, -1.0, 0.5]),\n            \"k\": np.array([15, 30, 12, 20]),\n            \"rho\": np.array([7800, 7800, 8900, 1000]),\n            \"cp\": np.array([500, 500, 380, 4184]),\n            \"C_tgt\": 0.8, \"Fo_tgt\": 0.3, \"s\": 0.95\n        },\n        # Case 4 (pure diffusion, small cell drives tight step)\n        {\n            \"dx\": np.array([0.001, 0.002, 0.004]),\n            \"u\": np.array([0.0, 0.0, 0.0]),\n            \"k\": np.array([180, 180, 180]),\n            \"rho\": np.array([9000, 9000, 9000]),\n            \"cp\": np.array([400, 400, 400]),\n            \"C_tgt\": 0.7, \"Fo_tgt\": 0.5, \"s\": 0.8\n        },\n        # Case 5 (diffusion-dominated mixed case)\n        {\n            \"dx\": np.array([0.01, 0.01]),\n            \"u\": np.array([0.01, 0.02]),\n            \"k\": np.array([200, 200]),\n            \"rho\": np.array([1000, 1000]),\n            \"cp\": np.array([1000, 1000]),\n            \"C_tgt\": 0.8, \"Fo_tgt\": 0.2, \"s\": 1.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        dx, u, k = case[\"dx\"], case[\"u\"], case[\"k\"]\n        rho, cp = case[\"rho\"], case[\"cp\"]\n        C_tgt, Fo_tgt, s = case[\"C_tgt\"], case[\"Fo_tgt\"], case[\"s\"]\n\n        # Advective (Courant) time step constraint\n        # dt_C_local = (s * C_tgt * dx) / |u|\n        # If u is zero, the constraint is inactive (dt -> infinity)\n        # Using np.divide handles division by zero by outputting np.inf\n        # where the condition u != 0 is false.\n        abs_u = np.abs(u)\n        dt_C_local = np.divide(s * C_tgt * dx, abs_u, \n                               out=np.full_like(dx, np.inf), \n                               where=abs_u != 0)\n        dt_C = np.min(dt_C_local)\n\n        # Diffusive (Fourier) time step constraint\n        # dt_F_local = (s * Fo_tgt * rho * cp * dx^2) / k\n        # If k is zero, thermal diffusivity is zero, constraint is inactive (dt -> infinity)\n        dt_F_local = np.divide(s * Fo_tgt * rho * cp * dx**2, k,\n                               out=np.full_like(dx, np.inf),\n                               where=k != 0)\n        dt_F = np.min(dt_F_local)\n\n        # The final time step must satisfy both constraints, so we take the minimum\n        final_dt = min(dt_C, dt_F)\n        results.append(final_dt)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [0.009, 0.0010125, 0.0010105263157894737, 0.008, 0.01]))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "无条件稳定是最终目标吗？以其无条件稳定而闻名的 Crank-Nicolson 格式，有时仍会产生非物理的振荡。本练习探讨了一个更严格且往往更重要的属性：单调性。通过分析一个简化的示例系统，您将发现 Crank-Nicolson 格式虽然从不“发散”，但可能无法保持解的定性特征，例如温度的非负性。  这个练习深化了您对数值伪影的理解，促使您区分稳定性（误差的有界性）和单调性（物理边界的保持），并揭示了为什么仅仅满足经典稳定性判据有时不足以保证高质量的模拟。",
            "id": "3985733",
            "problem": "考虑一维均匀杆的热传导方程，\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n其定义在空间区间 $[0,1]$ 上，边界条件为齐次狄利克雷边界条件 $u(0,t)=0$ 和 $u(1,t)=0$。使用包含 $N=2$ 个内部节点的均匀网格对空间域进行离散，并采用标准的二阶中心差分来近似拉普拉斯算子。时间推进采用 Crank–Nicolson 格式。定义无量纲参数 $r = \\alpha \\Delta t / \\Delta x^{2}$，其中 $\\Delta x$ 是均匀网格间距，$\\Delta t$ 是时间步长。此处的单调性（离散最大值原理）指的是以下性质：如果当前内部温度向量 $u^{n}$ 的所有分量均为非负，那么下一步的向量 $u^{n+1}$ 的所有分量也均为非负。\n\n从控制方程和给定的离散化方法出发，推导内部自由度的 $2\\times 2$ 线性时间步进映射 $u^{n+1} = \\mathbf{T}(r)\\,u^{n}$。然后，使用初始离散状态 $u^{n} = \\begin{pmatrix}1  0\\end{pmatrix}^{\\mathsf{T}}$，确定使得 $u^{n+1}$ 的第一个内部分量变为负值的最小 $r$ 值，从而为大 $\\Delta t$ 下的单调性提供一个明确的反例。请用包含根式的单一闭式表达式给出最终答案，不带单位。不接受任何中间过程的不等式作为最终答案。\n\n此外，请解释单调性的丧失如何与M矩阵（单调矩阵）相关的矩阵单调性条件的违反相关联。此处M矩阵定义为：其非对角线元素为非正，且其逆矩阵的所有分量均为非负。您可以参考库朗-弗里德里希斯-列维（Courant–Friedrichs–Lewy, CFL）条件来对比稳定性和单调性，但不要假定任何预先推导的时间步进公式；请从所述基本原理出发推导所有必需的矩阵。\n\n不要进行任何四舍五入；请提供所要求的 $r$ 的阈值的精确表达式。",
            "solution": "首先根据指定标准对问题进行验证。\n\n**第一步：提取已知条件**\n-   控制方程: $\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^{2} u}{\\partial x^{2}}$\n-   空间域: $x \\in [0, 1]$\n-   边界条件: $u(0,t)=0$ 和 $u(1,t)=0$ (齐次狄利克雷)\n-   空间离散化: 包含 $N=2$ 个内部节点的均匀网格。采用二阶中心差分近似拉普拉斯算子。\n-   时间离散化: Crank–Nicolson 格式。\n-   参数定义: $r = \\alpha \\Delta t / \\Delta x^{2}$\n-   单调性定义: 如果当前内部温度向量 $u^{n}$ 逐项非负，则下一步向量 $u^{n+1}$ 也逐项非负。\n-   测试初始条件: $u^{n} = \\begin{pmatrix}1  0\\end{pmatrix}^{\\mathsf{T}}$\n-   目标1: 推导 $2\\times 2$ 时间步进映射 $u^{n+1} = \\mathbf{T}(r)\\,u^{n}$。\n-   目标2: 在给定测试初始条件下，求使 $u^{n+1}_1 < 0$ 的最小 $r$ 值。\n-   目标3: 解释单调性丧失与M矩阵性质之间的联系。\n-   目标4: 对比单调性与稳定性。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，是适定的、客观的。它为计算热工学中的一个标准问题，即一维热方程的 Crank-Nicolson 格式分析，提供了一个完整且一致的设定。各项任务具体、可形式化且可在数学上验证。该问题不违反任何无效性标准。\n\n**结论**\n该问题有效。\n\n**求解推导**\n\n我们首先对偏微分控制方程进行离散化。\n\n**空间离散化**\n空间域为 $[0, 1]$。有 $N=2$ 个内部节点，总网格点数为 $N+2=4$。设这些点从 $i=0$ 到 $i=3$ 进行索引。网格间距是均匀的，因此 $\\Delta x = \\frac{1-0}{N+1} = \\frac{1}{3}$。内部节点位于 $x_1 = \\frac{1}{3}$ 和 $x_2 = \\frac{2}{3}$，对应的温度变量为 $u_1(t)$ 和 $u_2(t)$。边界条件要求 $u_0(t) = u(0, t) = 0$ 和 $u_3(t) = u(1, t) = 0$。\n\n在内部节点 $x_i$ 处，拉普拉斯算子 $\\frac{\\partial^2 u}{\\partial x^2}$ 的二阶中心差分近似为：\n$$ \\left.\\frac{\\partial^2 u}{\\partial x^2}\\right|_{x_i} \\approx \\frac{u_{i-1} - 2u_i + u_{i+1}}{\\Delta x^2} $$\n将此应用于我们的两个内部节点：\n-   在 $x_1$ 处: $\\frac{u_0 - 2u_1 + u_2}{\\Delta x^2} = \\frac{0 - 2u_1 + u_2}{\\Delta x^2}$\n-   在 $x_2$ 处: $\\frac{u_1 - 2u_2 + u_3}{\\Delta x^2} = \\frac{u_1 - 2u_2 + 0}{\\Delta x^2}$\n\n令 $u(t) = \\begin{pmatrix} u_1(t) \\\\ u_2(t) \\end{pmatrix}$ 为内部温度向量。通过空间离散化（直线法）得到的常微分方程组为：\n$$ \\frac{d u}{d t} = \\frac{\\alpha}{\\Delta x^2} \\begin{pmatrix} -2  1 \\\\ 1  -2 \\end{pmatrix} u = \\frac{\\alpha}{\\Delta x^2} \\mathbf{L} u $$\n其中 $\\mathbf{L} = \\begin{pmatrix} -2  1 \\\\ 1  -2 \\end{pmatrix}$ 是内部节点的离散拉普拉斯矩阵。\n\n**时间离散化：Crank-Nicolson 格式**\nCrank-Nicolson 格式在时间层 $t_n$ 和 $t_{n+1}$ 上对右侧项取平均：\n$$ \\frac{u^{n+1} - u^n}{\\Delta t} = \\frac{1}{2} \\left[ \\left(\\alpha \\frac{\\partial^2 u}{\\partial x^2}\\right)^{n+1} + \\left(\\alpha \\frac{\\partial^2 u}{\\partial x^2}\\right)^n \\right] $$\n代入空间离散化的矩阵形式：\n$$ \\frac{u^{n+1} - u^n}{\\Delta t} = \\frac{1}{2} \\left( \\frac{\\alpha}{\\Delta x^2} \\mathbf{L} u^{n+1} + \\frac{\\alpha}{\\Delta x^2} \\mathbf{L} u^n \\right) $$\n使用无量纲参数 $r = \\frac{\\alpha \\Delta t}{\\Delta x^2}$：\n$$ u^{n+1} - u^n = \\frac{r}{2} \\mathbf{L} u^{n+1} + \\frac{r}{2} \\mathbf{L} u^n $$\n整理各项以求解 $u^{n+1}$：\n$$ \\left(\\mathbf{I} - \\frac{r}{2}\\mathbf{L}\\right) u^{n+1} = \\left(\\mathbf{I} + \\frac{r}{2}\\mathbf{L}\\right) u^n $$\n其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。\n\n**时间步进映射 $\\mathbf{T}(r)$ 的推导**\n方程的形式为 $\\mathbf{A} u^{n+1} = \\mathbf{B} u^n$，其中 $\\mathbf{A} = \\mathbf{I} - \\frac{r}{2}\\mathbf{L}$ 且 $\\mathbf{B} = \\mathbf{I} + \\frac{r}{2}\\mathbf{L}$。时间步进映射为 $\\mathbf{T}(r) = \\mathbf{A}^{-1}\\mathbf{B}$。\n\n首先，我们计算 $\\mathbf{A}$ 和 $\\mathbf{B}$：\n$$ \\mathbf{A} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\frac{r}{2}\\begin{pmatrix} -2  1 \\\\ 1  -2 \\end{pmatrix} = \\begin{pmatrix} 1+r  -r/2 \\\\ -r/2  1+r \\end{pmatrix} $$\n$$ \\mathbf{B} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\frac{r}{2}\\begin{pmatrix} -2  1 \\\\ 1  -2 \\end{pmatrix} = \\begin{pmatrix} 1-r  r/2 \\\\ r/2  1-r \\end{pmatrix} $$\n\n接下来，我们求 $\\mathbf{A}$ 的逆矩阵。$\\mathbf{A}$ 的行列式为：\n$$ \\det(\\mathbf{A}) = (1+r)^2 - \\left(-\\frac{r}{2}\\right)^2 = 1 + 2r + r^2 - \\frac{r^2}{4} = 1 + 2r + \\frac{3}{4}r^2 $$\n逆矩阵 $\\mathbf{A}^{-1}$ 为：\n$$ \\mathbf{A}^{-1} = \\frac{1}{1 + 2r + \\frac{3}{4}r^2} \\begin{pmatrix} 1+r  r/2 \\\\ r/2  1+r \\end{pmatrix} $$\n\n现在，我们计算 $\\mathbf{T}(r) = \\mathbf{A}^{-1}\\mathbf{B}$：\n$$ \\mathbf{T}(r) = \\frac{1}{1 + 2r + \\frac{3}{4}r^2} \\begin{pmatrix} 1+r  r/2 \\\\ r/2  1+r \\end{pmatrix} \\begin{pmatrix} 1-r  r/2 \\\\ r/2  1-r \\end{pmatrix} $$\n矩阵乘积为：\n$$ \\begin{pmatrix} (1+r)(1-r) + (r/2)^2  (1+r)(r/2) + (r/2)(1-r) \\\\ (r/2)(1-r) + (1+r)(r/2)  (r/2)^2 + (1+r)(1-r) \\end{pmatrix} = \\begin{pmatrix} 1-r^2 + \\frac{r^2}{4}  \\frac{r}{2} + \\frac{r^2}{2} + \\frac{r}{2} - \\frac{r^2}{2} \\\\ \\frac{r}{2} - \\frac{r^2}{2} + \\frac{r}{2} + \\frac{r^2}{2}  \\frac{r^2}{4} + 1-r^2 \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{3}{4}r^2  r \\\\ r  1 - \\frac{3}{4}r^2 \\end{pmatrix} $$\n所以，时间步进映射为：\n$$ \\mathbf{T}(r) = \\frac{1}{1 + 2r + \\frac{3}{4}r^2} \\begin{pmatrix} 1 - \\frac{3}{4}r^2  r \\\\ r  1 - \\frac{3}{4}r^2 \\end{pmatrix} $$\n\n**确定 $r$ 的临界值**\n给定初始状态 $u^n = \\begin{pmatrix}1  0\\end{pmatrix}^{\\mathsf{T}}$，其逐项非负。我们计算 $u^{n+1} = \\mathbf{T}(r)u^n$：\n$$ u^{n+1} = \\frac{1}{1 + 2r + \\frac{3}{4}r^2} \\begin{pmatrix} 1 - \\frac{3}{4}r^2  r \\\\ r  1 - \\frac{3}{4}r^2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\frac{1}{1 + 2r + \\frac{3}{4}r^2} \\begin{pmatrix} 1 - \\frac{3}{4}r^2 \\\\ r \\end{pmatrix} $$\n下一步状态的分量为 $u^{n+1}_1 = \\frac{1 - \\frac{3}{4}r^2}{1 + 2r + \\frac{3}{4}r^2}$ 和 $u^{n+1}_2 = \\frac{r}{1 + 2r + \\frac{3}{4}r^2}$。\n对于 $r > 0$，分母 $1 + 2r + \\frac{3}{4}r^2$ 恒为正。分量 $u^{n+1}_2$ 也恒为正。第一个分量 $u^{n+1}_1$ 在其分子变为负时变为负。对于此特定初始条件，单调性的丧失发生在 $u^{n+1}_1 < 0$ 时。\n临界条件是 $u^{n+1}_1 = 0$，这要求分子为零：\n$$ 1 - \\frac{3}{4}r^2 = 0 $$\n$$ 1 = \\frac{3}{4}r^2 $$\n$$ r^2 = \\frac{4}{3} $$\n由于 $r$ 必须为正，我们取正平方根：\n$$ r = \\sqrt{\\frac{4}{3}} = \\frac{2}{\\sqrt{3}} $$\n对于任何大于 $\\frac{2}{\\sqrt{3}}$ 的 $r$ 值，分量 $u^{n+1}_1$ 将为负，从而违反单调性。发生此转变的最小 $r$ 值即为阈值本身。\n\n**与M矩阵、单调性和稳定性的联系**\n如果对于任何非负向量 $u^n$，结果向量 $u^{n+1} = \\mathbf{T}(r)u^n$ 也为非负，则该格式是单调的。这当且仅当传播矩阵 $\\mathbf{T}(r)$ 逐项非负时成立。对于 $r > 0$，$\\mathbf{T}(r)$ 的分母及其非对角线元素均为正。因此，当对角线元素 $1 - \\frac{3}{4}r^2$ 变为负时，单调性丧失。这给出了单调性的条件：$1 - \\frac{3}{4}r^2 \\geq 0$，即 $r \\le \\frac{2}{\\sqrt{3}}$。\n\n问题将M矩阵定义为其非对角线元素非正且其逆矩阵逐项非负。来自格式隐式部分的矩阵 $\\mathbf{A} = \\mathbf{I} - \\frac{r}{2}\\mathbf{L}$，对于 $r > 0$，其非对角线元素为 $-r/2 \\le 0$。其逆矩阵 $\\mathbf{A}^{-1}$ 已证明对于所有 $r > 0$ 都是逐项为正的。因此，对于所有 $r > 0$，$\\mathbf{A}$ 都是一个M矩阵。这个M矩阵的存在保证了关于 $u^{n+1}$ 的隐式系统总是唯一可解的。\n\n单调性的丧失是违反了 $\\mathbf{T}(r)$ 必须是一个非负矩阵的条件。$\\mathbf{A}$ 是一个M矩阵（因此 $\\mathbf{A}^{-1} \\ge 0$）这一事实是结构的关键部分，但其本身并不足以保证单调性。格式 $\\mathbf{A}u^{n+1} = \\mathbf{B}u^n$ 单调性的一个常见充分（但不必要）条件是：$\\mathbf{A}$ 是一个M矩阵且 $\\mathbf{B}$ 是一个非负矩阵。在我们的例子中，$\\mathbf{B} = \\begin{pmatrix} 1-r  r/2 \\\\ r/2  1-r \\end{pmatrix}$ 仅当 $1-r \\ge 0$ (即 $r \\le 1$) 时才为非负。我们的分析表明，单调性实际上在更大的值域内成立，即 $r \\le \\frac{2}{\\sqrt{3}} \\approx 1.1547$。因此，单调性的丧失与传播矩阵 $\\mathbf{T}(r) = \\mathbf{A}^{-1}\\mathbf{B}$ 不再是一个非负矩阵直接相关，这发生在已确定的 $r$ 的临界值处。\n\n最后，我们将其与稳定性进行对比。Crank-Nicolson 格式在冯·诺伊曼（von Neumann）意义下是无条件稳定的，这意味着对于所有 $r > 0$，放大因子的模长都小于或等于1。这确保了数值误差不会无界增长。然而，正如推导所示，该格式仅为有条件单调。对于 $r > \\frac{2}{\\sqrt{3}}$，该格式是稳定的但非单调的，允许解中出现物理上不切实际的振荡（例如，从正的初始数据产生负的温度），即使其振幅不会增长。通常作为稳定性约束的库朗-弗里德里希斯-列维（Courant–Friedrichs–Lewy, CFL）条件，在这种情况下并不限制稳定性的时间步长。然而，一个形式相似的对 $r$ 的约束来自于对单调性的要求，对于扩散问题，单调性通常是比稳定性本身更理想的性质。",
            "answer": "$$\n\\boxed{\\frac{2}{\\sqrt{3}}}\n$$"
        }
    ]
}