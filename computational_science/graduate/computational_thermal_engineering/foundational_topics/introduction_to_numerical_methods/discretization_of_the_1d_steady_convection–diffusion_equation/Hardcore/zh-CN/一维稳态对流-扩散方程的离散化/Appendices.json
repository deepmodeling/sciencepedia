{
    "hands_on_practices": [
        {
            "introduction": "选择离散格式并非无足轻重；简单的格式可能引入模拟物理现象的数值误差。本练习  将引导你使用一种称为“修正方程分析”的强大技术，揭示常用的一阶迎风格式中隐藏的“人工扩散”效应。这种分析有助于理解为什么在对流主导的问题中，该格式的计算结果可能出现过度模糊或耗散的现象。",
            "id": "3947949",
            "problem": "考虑一个被动标量 $\\,\\phi(x)\\,$ 在速度为 $\\,u0\\,$ 的均匀流场中的一维稳态输运，其分子扩散系数 $\\,\\alpha\\,$ 为常数，由以下守恒定律控制\n$$u\\,\\frac{d\\phi}{dx} \\;=\\; \\alpha\\,\\frac{d^{2}\\phi}{dx^{2}},$$\n在间距为 $\\,\\Delta x\\,$ 的均匀网格上。在索引为 $\\,i\\,$ 的内部节点（位于 $\\,x_i\\,$），构建一个有限体积平衡，其中对流项通量使用一阶迎风格式，扩散项通量使用二阶中心差分格式。从这个离散平衡出发，通过将 $\\,\\phi_{i\\pm 1}\\,$ 在 $\\,x_i\\,$ 附近进行足够高阶的泰勒展开，进行修正方程分析，并确定该格式在 $\\,\\Delta x\\,$ 的主导阶上求解的连续微分方程。以闭合形式确定乘以 $\\,\\frac{d^{2}\\phi}{dx^{2}}\\,$ 的系数的主导阶增补项，并将此增补项解释为由迎风离散化引入的人工扩散系数 $\\,\\alpha_{\\mathrm{num}}\\,$。\n\n利用修正方程的量纲分析，通过平衡对流与有效扩散，推断出入流边界附近的有效边界层厚度 $\\,\\delta_{\\mathrm{eff}}\\,$，其中有效扩散是分子扩散和人工扩散之和。然后，对于数值参数 $\\,u = 2.0\\,\\mathrm{m/s}\\,$, $\\,\\alpha = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}\\,$ 和 $\\,\\Delta x = 1.0\\times 10^{-2}\\,\\mathrm{m}\\,$，计算 $\\,\\delta_{\\mathrm{eff}}\\,$。最终边界层厚度以米为单位表示，并将答案四舍五入到四位有效数字。\n\n作为背景知识，您可以将佩克莱数（Pe）定义为 $\\,\\mathrm{Pe} = \\dfrac{u\\,L}{\\alpha}\\,$，其中 $\\,L\\,$ 是特征长度，但在推导 $\\,\\delta_{\\mathrm{eff}}\\,$ 时，不应假设一个特定的 $\\,L\\,$。",
            "solution": "用户提供了一个有效的问题陈述。该问题在计算流体动力学方面有科学依据，是适定的、客观的。它包含了推导出唯一解所需的所有必要信息。\n\n第一步是在间距为 $\\Delta x$ 的均匀网格上，使用有限体积法推导控制方程的离散形式。一维稳态对流扩散方程为：\n$$u\\,\\frac{d\\phi}{dx} \\;=\\; \\alpha\\,\\frac{d^{2}\\phi}{dx^{2}}$$\n假设 $u$ 和 $\\alpha$ 是常数，我们可以将其写成守恒定律形式 $\\frac{dF}{dx} = 0$，其中总通量 $F$ 由对流部分 $F_c = u\\phi$ 和扩散部分 $F_d = -\\alpha\\frac{d\\phi}{dx}$ 组成。\n$$F(x) = u\\phi(x) - \\alpha\\frac{d\\phi}{dx}$$\n我们将守恒定律在以节点 $i$ 为中心的控制体积（CV）上积分，该控制体积从 $x_{i-1/2}$ 处的面延伸到 $x_{i+1/2}$ 处的面。此控制体积的宽度为 $\\Delta x$。\n$$\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{dF}{dx} \\,dx = 0 \\implies F(x_{i+1/2}) - F(x_{i-1/2}) = 0$$\n设 $F_{i+1/2}$ 和 $F_{i-1/2}$ 表示控制体面上的通量。离散平衡方程为 $F_{i+1/2} - F_{i-1/2} = 0$。\n\n现在我们需要使用节点值 $\\phi_i$ 来近似面上的通量。\n对流通量 $F_c = u\\phi$ 使用一阶迎风格式进行离散化。由于流速 $u$ 被给定为正值 ($u0$)，流向是从左到右。因此，面上的 $\\phi$ 值取自上游（左侧）节点。\n$$ (F_c)_{i-1/2} = u\\phi_{i-1} $$\n$$ (F_c)_{i+1/2} = u\\phi_i $$\n扩散通量 $F_d = -\\alpha\\frac{d\\phi}{dx}$ 使用二阶中心差分格式对面上的梯度进行离散化。\n$$ (F_d)_{i-1/2} = -\\alpha \\left(\\frac{d\\phi}{dx}\\right)_{i-1/2} \\approx -\\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} $$\n$$ (F_d)_{i+1/2} = -\\alpha \\left(\\frac{d\\phi}{dx}\\right)_{i+1/2} \\approx -\\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\n每个面上的总通量是对流通量和扩散通量之和。\n$$ F_{i-1/2} = (F_c)_{i-1/2} + (F_d)_{i-1/2} = u\\phi_{i-1} - \\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} $$\n$$ F_{i+1/2} = (F_c)_{i+1/2} + (F_d)_{i+1/2} = u\\phi_i - \\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} $$\n将这些代入平衡方程 $F_{i+1/2} - F_{i-1/2} = 0$ 中：\n$$ \\left( u\\phi_i - \\alpha \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} \\right) - \\left( u\\phi_{i-1} - \\alpha \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} \\right) = 0 $$\n重新整理各项，我们得到：\n$$ u(\\phi_i - \\phi_{i-1}) - \\frac{\\alpha}{\\Delta x} ((\\phi_{i+1} - \\phi_i) - (\\phi_i - \\phi_{i-1})) = 0 $$\n$$ u(\\phi_i - \\phi_{i-1}) = \\frac{\\alpha}{\\Delta x} (\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) $$\n两边除以 $\\Delta x$ 得到标准的有限差分形式：\n$$ u\\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} = \\alpha\\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{(\\Delta x)^2} $$\n左边是 $u\\frac{d\\phi}{dx}$ 的一阶后向差分近似，右边是 $\\alpha\\frac{d^2\\phi}{dx^2}$ 的二阶中心差分近似。\n\n接下来，我们通过将离散项替换为它们在点 $x_i$ 附近的泰勒级数展开来进行修正方程分析。设 $\\phi_i = \\phi(x_i)$，$\\phi' = \\frac{d\\phi}{dx}$，$\\phi'' = \\frac{d^2\\phi}{dx^2}$ 等，所有导数均在 $x_i$ 处计算。\n$$ \\phi_{i-1} = \\phi(x_i - \\Delta x) = \\phi_i - \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\frac{(\\Delta x)^3}{6}\\phi''' + O((\\Delta x)^4) $$\n$$ \\phi_{i+1} = \\phi(x_i + \\Delta x) = \\phi_i + \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' + \\frac{(\\Delta x)^3}{6}\\phi''' + O((\\Delta x)^4) $$\n我们将这些展开式代入离散方程。\n对于对流项（左侧）：\n$$ u\\frac{\\phi_i - \\phi_{i-1}}{\\Delta x} = u \\frac{1}{\\Delta x} \\left( \\phi_i - \\left[ \\phi_i - \\Delta x\\,\\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\dots \\right] \\right) = u \\left( \\phi' - \\frac{\\Delta x}{2}\\phi'' + O((\\Delta x)^2) \\right) $$\n对于扩散项（右侧）：\n$$ \\phi_{i+1} - 2\\phi_i + \\phi_{i-1} = (\\phi_i + \\Delta x \\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' + \\dots) - 2\\phi_i + (\\phi_i - \\Delta x \\phi' + \\frac{(\\Delta x)^2}{2}\\phi'' - \\dots) = (\\Delta x)^2\\phi'' + O((\\Delta x)^4) $$\n$$ \\alpha\\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{(\\Delta x)^2} = \\alpha \\frac{(\\Delta x)^2\\phi'' + O((\\Delta x)^4)}{(\\Delta x)^2} = \\alpha\\phi'' + O((\\Delta x)^2) $$\n将展开的各项相等：\n$$ u\\phi' - u\\frac{\\Delta x}{2}\\phi'' + O((\\Delta x)^2) = \\alpha\\phi'' + O((\\Delta x)^2) $$\n重新整理以分离出原方程的各项：\n$$ u\\frac{d\\phi}{dx} = \\alpha\\frac{d^2\\phi}{dx^2} + u\\frac{\\Delta x}{2}\\frac{d^2\\phi}{dx^2} + O((\\Delta x)^2) $$\n修正方程，即数值格式在主导阶上求解的微分方程，是：\n$$ u\\frac{d\\phi}{dx} = \\left(\\alpha + \\frac{u\\Delta x}{2}\\right) \\frac{d^2\\phi}{dx^2} $$\n将其与原方程比较，我们确定加到分子扩散系数 $\\alpha$ 上的项是人工或数值扩散系数 $\\alpha_{\\mathrm{num}}$。\n$$ \\alpha_{\\mathrm{num}} = \\frac{u\\Delta x}{2} $$\n有效扩散系数为 $\\alpha_{\\mathrm{eff}} = \\alpha + \\alpha_{\\mathrm{num}} = \\alpha + \\frac{u\\Delta x}{2}$。\n\n边界层的厚度通过平衡对流和扩散输运项的量纲分析来确定。对于修正方程，这个平衡是在对流和有效扩散之间。设 $\\delta_{\\mathrm{eff}}$ 为有效边界层厚度。\n各项的量纲为：\n$$ \\text{Convection: } u\\frac{d\\phi}{dx} \\sim u\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}} $$\n$$ \\text{Effective Diffusion: } \\alpha_{\\mathrm{eff}}\\frac{d^2\\phi}{dx^2} \\sim \\alpha_{\\mathrm{eff}}\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}^2} $$\n使量纲相等：\n$$ u\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}} \\sim \\alpha_{\\mathrm{eff}}\\frac{\\Delta\\phi}{\\delta_{\\mathrm{eff}}^2} \\implies \\delta_{\\mathrm{eff}} \\sim \\frac{\\alpha_{\\mathrm{eff}}}{u} $$\n代入 $\\alpha_{\\mathrm{eff}}$ 的表达式：\n$$ \\delta_{\\mathrm{eff}} = \\frac{\\alpha + \\alpha_{\\mathrm{num}}}{u} = \\frac{\\alpha + \\frac{u\\Delta x}{2}}{u} = \\frac{\\alpha}{u} + \\frac{\\Delta x}{2} $$\n现在，我们使用给定的参数计算 $\\delta_{\\mathrm{eff}}$ 的数值：$u = 2.0\\,\\mathrm{m/s}$，$\\alpha = 1.5\\times 10^{-5}\\,\\mathrm{m^{2}/s}$ 和 $\\Delta x = 1.0\\times 10^{-2}\\,\\mathrm{m}$。\n$$ \\delta_{\\mathrm{eff}} = \\frac{1.5\\times 10^{-5}\\,\\mathrm{m^2/s}}{2.0\\,\\mathrm{m/s}} + \\frac{1.0\\times 10^{-2}\\,\\mathrm{m}}{2} $$\n$$ \\delta_{\\mathrm{eff}} = (7.5 \\times 10^{-6})\\,\\mathrm{m} + (0.5 \\times 10^{-2})\\,\\mathrm{m} $$\n$$ \\delta_{\\mathrm{eff}} = 0.0000075\\,\\mathrm{m} + 0.005\\,\\mathrm{m} = 0.0050075\\,\\mathrm{m} $$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $5$，$0$，$0$，$7$。第五位是 $5$，所以我们将第四位数字向上取整。\n$$ \\delta_{\\mathrm{eff}} \\approx 0.005008\\,\\mathrm{m} $$",
            "answer": "$$\\boxed{0.005008}$$"
        },
        {
            "introduction": "认识到简单格式的局限性后，我们自然会寻求更精确的方法。指数格式，或称精确解格式，为一维稳态对流扩散问题提供了一个理论上的理想方案。在本练习  中，你将推导并实现该格式，并体会其系数如何根据当地的Péclet数 $P$ 自动调整，从而在不同物理情境下都能保持高精度。",
            "id": "3948014",
            "problem": "考虑在一维空间坐标 $\\,x\\,$ 的均匀网格上，具有恒定物性的标量场 $\\,\\phi(x)\\,$ 的一维稳态对流扩散问题。在稳态条件下，忽略体积源时，守恒标量的控制平衡方程为以下微分方程\n$$\n\\frac{d}{dx}\\left(\\Gamma\\,\\frac{d\\phi}{dx}\\right) - \\rho\\,u\\,\\frac{d\\phi}{dx} = 0,\n$$\n其中 $\\,\\Gamma\\,$ 是扩散系数，$\\,\\rho\\,$ 是密度，$\\,u\\,$ 是恒定速度。假设横截面积为单位面积。使用控制体积有限体积法，对于均匀网格间距 $\\,\\Delta x\\,$ 和拥有相邻节点 $\\,W\\,$ 与 $\\,E\\,$ 的内部节点 $\\,P\\,$，定义质量通量大小 $\\,F = \\rho\\,u\\,$ 和扩散导率 $\\,D = \\Gamma/\\Delta x\\,$。对于此设置，面 Peclet 数是均匀的，其定义为\n$$\nP = \\frac{F}{D} = \\frac{\\rho\\,u\\,\\Delta x}{\\Gamma}.\n$$\n您的任务是：基于在每个控制体积内对局部一维稳态对流扩散方程的精确积分，以及与该局部精确解一致的面插值方法（该方法通常称为指数格式），推导出一个代表性内部节点 $\\,P\\,$ 处的离散方程。从第一性原理出发，由控制平衡方程开始，展示面上的对流通量和扩散通量如何组合，从而得到以下形式的线性离散方程\n$$\na_W\\,\\phi_W + a_E\\,\\phi_E - a_P\\,\\phi_P = 0,\n$$\n其中系数 $\\,a_W\\,$, $\\,a_E\\,$ 和 $\\,a_P\\,$ 在均匀网格和恒定物性的假设下，仅用 $\\,F\\,$, $\\,D\\,$ 和 $\\,P\\,$ 表示，并假设体积源为零。\n\n推导完成后，请您编写一个程序，使用指数格式计算一个代表性内部节点的离散系数 $\\,a_W\\,$, $\\,a_E\\,$ 和 $\\,a_P\\,$，并应用于以下测试套件。为了保证您实现的数值稳健性，当 $\\,|P|\\,$ 非常小时，您必须使用与局部精确解一致的级数展开来评估所需的面权重函数，以避免灾难性抵消。\n\n测试套件的参数集由有序对 $\\,(\\text{Pe}, D)\\,$ 给出，其中 $\\,\\text{Pe}=P\\,$ 是 Peclet 数，$\\,D\\,$ 是扩散导率：\n- 一般对流扩散（正常情况）：$\\,(\\text{Pe}=10,\\;D=2.0)\\,$。\n- 纯扩散极限：$\\,(\\text{Pe}=0,\\;D=2.0)\\,$。\n- 向左对流（负向流动）：$\\,(\\text{Pe}=-10,\\;D=2.0)\\,$。\n- 接近零的 Peclet 数（数值稳定性检查）：$\\,(\\text{Pe}=10^{-6},\\;D=2.0)\\,$。\n- 强对流极限：$\\,(\\text{Pe}=100,\\;D=2.0)\\,$。\n\n对于每个测试用例，计算并报告三元组 $\\,\\big[a_W,\\;a_E,\\;a_P\\big]\\,$。您的程序应生成单行输出，其中包含五个三元组的结果，以逗号分隔，并用方括号括起来，每个系数四舍五入到六位小数。例如，输出格式必须为\n$$\n\\texttt{[[aW1,aE1,aP1],[aW2,aE2,aP3],[aW4,aE4,aP4],[aW5,aE5,aP5]]}\n$$\n所有输出均为无单位的纯数字。",
            "solution": "该问题陈述具有科学依据，提法恰当，客观且自成体系。它描述了计算输运现象中的一个标准问题：一维稳态对流扩散方程的指数离散格式的推导与应用。所提供的控制方程、定义和边界条件在该领域内是一致且标准的。因此，该问题是有效的，并将提供解答。\n\n推导过程从有限体积法的基本原理出发，利用局部控制方程的精确解析解。\n\n对于标量属性 $\\phi(x)$，在物性（$\\rho$、$u$、$\\Gamma$）恒定且无源项的情况下，一维稳态对流扩散方程如下：\n$$\n\\frac{d}{dx}\\left(\\Gamma\\,\\frac{d\\phi}{dx}\\right) - \\rho\\,u\\,\\frac{d\\phi}{dx} = 0\n$$\n对于恒定的 $\\rho$ 和 $u$，对流项可以写成散度形式，$\\rho u \\frac{d\\phi}{dx} = \\frac{d}{dx}(\\rho u \\phi)$。因此，该方程可以表示为代表总通量 $J(x) = \\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}$ 平衡的守恒形式：\n$$\n-\\frac{d J(x)}{dx} = 0 \\quad \\text{或} \\quad \\frac{d}{dx}\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right) = 0\n$$\n我们应用有限体积法，将此方程在一个围绕通用内部节点 $P$ 的控制体积（CV）上进行积分。该控制体积从位于节点 $W$ 和 $P$ 中间的西面 $w$ 延伸到位于节点 $P$ 和 $E$ 中间的东面 $e$。网格间距是均匀的，为 $\\Delta x$。\n$$\n\\int_{w}^{e} \\frac{d}{dx}\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right) dx = 0\n$$\n应用微积分基本定理，可得到该控制体积的通量平衡：\n$$\n\\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right)\\bigg|_e - \\left( \\Gamma \\frac{d\\phi}{dx} - \\rho u \\phi\\right)\\bigg|_w = 0\n$$\n这表明在稳态下，流出控制体积的净通量为零。我们将总通量表示为 $J_{total} = \\rho u \\phi - \\Gamma \\frac{d\\phi}{dx}$。平衡方程即为 $J_{total, e} - J_{total, w} = 0$。\n\n指数格式的核心是利用控制常微分方程（ODE）的局部精确解来评估通量 $J_{total, e}$ 和 $J_{total, w}$。我们来求解 ODE $\\Gamma\\phi'' - \\rho u \\phi' = 0$。其通解形式为：\n$$\n\\phi(x) = C_1 e^{(\\rho u / \\Gamma)x} + C_2\n$$\n考虑任意两个节点之间的线段，例如位于 $x=0$ 的节点 $A$ 和位于 $x=\\Delta x$ 的节点 $B$。边界条件为 $\\phi(0) = \\phi_A$ 和 $\\phi(\\Delta x) = \\phi_B$。应用这些条件可以解出常数 $C_1$ 和 $C_2$。在区间 $[0, \\Delta x]$ 内得到的 $\\phi(x)$ 解为：\n$$\n\\frac{\\phi(x) - \\phi_A}{\\phi_B - \\phi_A} = \\frac{e^{P \\cdot (x/\\Delta x)} - 1}{e^P - 1}\n$$\n其中 $P = \\frac{\\rho u \\Delta x}{\\Gamma}$ 是网格 Peclet 数。\n\n一个关键的洞见是，对于这个无源一维问题，总通量 $J_{total}(x)$ 在任意两个节点之间是恒定的。我们可以通过使用精确解，在任意点 $x \\in [0, \\Delta x]$ 处计算 $J_{total}(x) = \\rho u \\phi(x) - \\Gamma \\frac{d\\phi}{dx}$ 来找到这个恒定通量。该计算得出了一个非常简洁的、用节点值 $\\phi_A$ 和 $\\phi_B$ 表示的通量表达式：\n$$\nJ_{total} = \\rho u \\frac{\\phi_A e^P - \\phi_B}{e^P - 1}\n$$\n使用定义 $F = \\rho u$（质量通量）和 $D = \\Gamma / \\Delta x$（扩散导率），以及关系式 $P = F/D$，上式可以写为：\n$$\nJ_{total} = F \\frac{\\phi_A e^P - \\phi_B}{e^P - 1}\n$$\n现在我们将此结果应用于我们的控制体积平衡方程 $J_{total, e} - J_{total, w} = 0$。面 $e$ 处的通量由其两侧的节点 $P$ 和 $E$ 决定。在此情况下，$A=P$ 且 $B=E$。\n$$\nJ_{total, e} = F \\frac{\\phi_P e^P - \\phi_E}{e^P - 1}\n$$\n面 $w$ 处的通量由节点 $W$ 和 $P$ 决定。此处，$A=W$ 且 $B=P$。\n$$\nJ_{total, w} = F \\frac{\\phi_W e^P - \\phi_P}{e^P - 1}\n$$\n将这些代入通量平衡方程，得到：\n$$\nF \\frac{\\phi_P e^P - \\phi_E}{e^P - 1} - F \\frac{\\phi_W e^P - \\phi_P}{e^P - 1} = 0\n$$\n由于 $F$ 是一个公因子（我们暂时假设 $F \\neq 0$），我们可以简化为：\n$$\n(\\phi_P e^P - \\phi_E) - (\\phi_W e^P - \\phi_P) = 0\n$$\n按节点值 $\\phi_W$、$\\phi_P$ 和 $\\phi_E$ 重新整理和分组各项：\n$$\n(-\\phi_W e^P) + (-\\phi_E) + \\phi_P(e^P + 1) = 0\n$$\n为了匹配所需的形式 $a_W \\phi_W + a_E \\phi_E - a_P \\phi_P = 0$，我们可以将方程表示为：\n$$\n\\left(\\frac{F e^P}{e^P-1}\\right) \\phi_W + \\left(\\frac{F}{e^P-1}\\right) \\phi_E - \\left(\\frac{F(e^P+1)}{e^P-1}\\right) \\phi_P = 0\n$$\n由此可以确定系数为：\n$$\na_W = F \\frac{e^P}{e^P-1}\n$$\n$$\na_E = \\frac{F}{e^P-1}\n$$\n$$\na_P = F \\frac{e^P+1}{e^P-1}\n$$\n可以很容易地验证 $a_P = a_W + a_E$，这是无源项守恒格式的一个必要属性。这些表达式对正负 $P$ 值均有效。\n\n对于数值实现，将这些系数表示为 $D$ 和一个关于 $P$ 的函数是有利的，以便稳健地处理 $P \\to 0$ 的情况。使用 $F=P \\cdot D$：\n$$\na_E = (P \\cdot D) \\frac{1}{e^P-1} = D \\left(\\frac{P}{e^P-1}\\right)\n$$\n$$\na_W = (P \\cdot D) \\frac{e^P}{e^P-1} = D \\left(\\frac{P e^P}{e^P-1}\\right) = D \\left(\\frac{-P}{e^{-P}-1}\\right)\n$$\n我们定义函数 $B(z) = \\frac{z}{e^z-1}$。系数变为：\n$$\na_E = D \\cdot B(P)\n$$\n$$\na_W = D \\cdot B(-P)\n$$\n$$\na_P = a_W + a_E = D \\cdot (B(P) + B(-P))\n$$\n这个公式是数值稳健的。当 $P \\to 0$ 时，表达式 $e^P-1$ 会遭受灾难性抵消。然而，$B(P)$ 在 $P \\to 0$ 时的极限是明确定义的：$\\lim_{P\\to 0} B(P) = 1$。这可以通过使用洛必达法则或泰勒展开来证明：$e^P \\approx 1+P$，所以 $B(P) \\approx P/((1+P)-1)=1$。\n对于极限情况 $P=0$（纯扩散），我们得到：\n$a_E = D \\cdot B(0) = D \\cdot 1 = D$。\n$a_W = D \\cdot B(0) = D \\cdot 1 = D$。\n$a_P = D+D = 2D$。\n这正确地恢复了用于纯扩散的标准中心差分格式。\n\n在计算时，当 $|P|$ 非常小但不为零时，使用 `numpy.expm1(P)` 函数（该函数可精确计算 $e^P-1$）可以避免数值不稳定性。对于 $P=0$ 的情况，必须使用极限值 $1$ 作为 $B(0)$ 的值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrete coefficients for the 1D steady convection-diffusion equation\n    using the exponential scheme for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement as (Pe, D) pairs.\n    # Pe is the Peclet number (P), and D is the diffusive conductance.\n    test_cases = [\n        (10.0, 2.0),      # General convection-diffusion\n        (0.0, 2.0),       # Pure diffusion limit\n        (-10.0, 2.0),     # Convection to the left (negative flow)\n        (1e-6, 2.0),      # Near-zero Peclet number (numerical stability check)\n        (100.0, 2.0),     # Strong convection limit\n    ]\n\n    results_formatted = []\n    \n    # Helper function B(z) = z / (exp(z) - 1)\n    # This function is central to the exponential scheme coefficients.\n    def B(z):\n        \"\"\"\n        Computes z / (exp(z) - 1) robustly.\n        For z -> 0, the limit is 1.\n        For small non-zero z, np.expm1(z) provides an accurate computation\n        of exp(z) - 1, avoiding catastrophic cancellation.\n        \"\"\"\n        if z == 0.0:\n            return 1.0\n        else:\n            return z / np.expm1(z)\n\n    for case in test_cases:\n        P, D = case\n        \n        # The mass flux F is related to P and D by F = P * D.\n        # The coefficients are expressed in terms of D and the function B(P).\n        # This formulation is robust for all values of P, including P -> 0.\n        \n        # Coefficient for the east node (E)\n        # a_E = D * (P / (exp(P) - 1)) = D * B(P)\n        a_E = D * B(P)\n        \n        # Coefficient for the west node (W)\n        # a_W = D * (P * exp(P) / (exp(P) - 1)) = D * B(-P)\n        a_W = D * B(-P)\n        \n        # Coefficient for the center node (P)\n        # For a source-free problem, a_P = a_W + a_E\n        a_P = a_W + a_E\n        \n        # Append the formatted triplet to the results list\n        results_formatted.append(f\"[{a_W:.6f},{a_E:.6f},{a_P:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_formatted)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "理论分析之后，必须通过量化验证来评估数值格式的实际性能。本练习  介绍了一种标准的程序验证技术——“制造解方法”(Method of Manufactured Solutions)，并要求你通过网格加密研究来计算收敛阶。通过亲手实现并比较一阶迎风格式和更高阶的QUICK格式的精度，你将掌握衡量和验证任何数值方案准确性的基本技能。",
            "id": "3947959",
            "problem": "考虑一个周期性域上的一维稳态对流扩散方程，该方程以守恒形式表示，用于描述光滑标量场 $\\,\\phi(x)\\,$，\n$$\n\\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big)\\;-\\;\\frac{d}{dx}\\big(\\rho u\\,\\phi\\big)\\;=\\;s(x),\\quad x\\in[0,1],\n$$\n在 $[0,1]$ 上具有周期性边界条件。此处 $\\,\\Gamma0\\,$ 是扩散系数，$\\,\\rho u0\\,$ 是恒定的质量通量（密度乘以速度），而 $\\,s(x)\\,$ 是一个给定的源项。使用一个构造的光滑解 $\\,\\phi_{\\text{exact}}(x)=\\sin(2\\pi x)\\,$，通过该微分方程来定义一个一致的源项。$\\,\\phi_{\\text{exact}}\\,$ 的导数为 $\\,\\phi_{\\text{exact}}'(x)=2\\pi\\cos(2\\pi x)\\,$ 和 $\\,\\phi_{\\text{exact}}''(x)=-(2\\pi)^2\\sin(2\\pi x)\\,$。因此，设\n$$\ns(x)\\;=\\;\\Gamma\\,\\phi_{\\text{exact}}''(x)\\;-\\;\\rho u\\,\\phi_{\\text{exact}}'(x)\\;=\\;-\\Gamma\\,(2\\pi)^2\\,\\sin(2\\pi x)\\;-\\;\\rho u\\,(2\\pi)\\,\\cos(2\\pi x).\n$$\n\n使用有限体积法在一个均匀网格上对该方程进行离散化，该网格具有 $\\,N\\,$ 个单元中心 $\\,x_i=(i+\\tfrac{1}{2})\\Delta x\\,$（其中 $\\,i=0,1,\\dots,N-1\\,$）且 $\\,\\Delta x=1/N\\,$。通过相邻单元中心值的中心差分来近似界面上的扩散通量。通过以下任一方法来近似界面上的对流通量：\n\n- 对于正速度使用迎风格式：界面值等于迎风侧单元中心的值。\n- 对于正速度使用二次上游插值对流运动学格式 (Quadratic Upstream Interpolation for Convective Kinematics, QUICK)：界面值等于三个相邻单元中心值的二次上游偏置插值。具体来说，在均匀网格上，对于单元 $\\,i\\,$ 和 $\\,i+1\\,$ 之间的东界面，\n$$\n\\phi_e=\\frac{3}{8}\\,\\phi_{i+1}+\\frac{6}{8}\\,\\phi_{i}-\\frac{1}{8}\\,\\phi_{i-1},\n$$\n以及对于单元 $\\,i-1\\,$ 和 $\\,i\\,$ 之间的西界面，\n$$\n\\phi_w=\\frac{3}{8}\\,\\phi_{i}+\\frac{6}{8}\\,\\phi_{i-1}-\\frac{1}{8}\\,\\phi_{i-2},\n$$\n其中指数进行周期性循环处理。\n\n利用界面通量为每个控制体建立离散平衡方程，并通过中点法则 $\\,s(x_i)\\Delta x\\,$ 来近似源项积分。由于周期性算子存在一个常数零空间，因此施加一个单一的锚定约束来选择物理上相关的解，方法是将一个选定单元中的值设置为该单元处精确的构造解。\n\n将全局误差 $\\,\\ell_2\\,$ 范数定义为\n$$\n\\|e\\|_{2}=\\Big(\\sum_{i=0}^{N-1}\\big(\\phi_i-\\phi_{\\text{exact}}(x_i)\\big)^2\\,\\Delta x\\Big)^{1/2}.\n$$\n对于一系列加密网格 $\\,N\\in\\{20,40,80,160\\}\\,$，计算两种格式（迎风格式和 QUICK 格式）的误差，然后通过对 $\\,\\log\\|e\\|_2\\,$ 与 $\\,\\log \\Delta x\\,$ 进行最小二乘拟合来估计观测到的收敛阶 $\\,p\\,$，使得 $\\,\\log\\|e\\|_2\\approx \\log C + p\\,\\log \\Delta x\\,$。\n\n根据截断误差分析，对于采用中心差分扩散离散和正速度的组合对流-扩散算子，其在光滑解上的预期观测阶数为：\n- 迎风对流：一阶，$\\,p\\approx 1\\,$。\n- QUICK 对流：二阶，$\\,p\\approx 2\\,$（受限于二阶的扩散离散格式）。\n\n你的任务是实现这种离散化和量化方法，并针对以下具有恒定系数的测试套件，将测得的收敛阶与这些预期值进行比较：\n- 情况 $\\,1\\,$：$\\,\\Gamma=0.1\\,$, $\\,\\rho u=1.0\\,$。\n- 情况 $\\,2\\,$：$\\,\\Gamma=1.0\\,$, $\\,\\rho u=1.0\\,$。\n- 情况 $\\,3\\,$：$\\,\\Gamma=0.01\\,$, $\\,\\rho u=1.0\\,$。\n\n对于每种情况，计算测得的阶数 $\\,p_{\\text{upwind}}\\,$ 和 $\\,p_{\\text{QUICK}}\\,$，并使用 $\\,0.25\\,$ 的容差生成布尔指示符，将它们与预期值进行比较；即报告 $\\,\\big|\\;p_{\\text{upwind}}-1\\;\\big|\\le 0.25\\,$ 和 $\\,\\big|\\;p_{\\text{QUICK}}-2\\;\\big|\\le 0.25\\,$ 是否成立。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于情况 $\\,1\\,$, $\\,2\\,$ 和 $\\,3\\,$，该列表必须按顺序包含：$[p_{\\text{upwind}},p_{\\text{QUICK}},\\text{match}_{\\text{upwind}},\\text{match}_{\\text{QUICK}},\\dots]$，其中省略号表示对后续情况重复此四项模式。所有数值答案必须报告为无量纲浮点数，所有布尔值答案报告为 $\\,\\text{True}\\,$ 或 $\\,\\text{False}\\,$。",
            "solution": "该问题被认为是有效的，因为它有科学依据、适定、客观且内部一致。它为应用于对流扩散方程的数值方法提供了一个标准的验证练习。我们开始求解。\n\n一维稳态对流扩散方程的守恒形式由下式给出\n$$\n\\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big)\\;-\\;\\frac{d}{dx}\\big(\\rho u\\,\\phi\\big)\\;=\\;s(x), \\quad x \\in [0,1]\n$$\n具有周期性边界条件。参数 $\\Gamma  0$ 和 $\\rho u  0$ 分别是恒定的扩散系数和质量通量。\n\n我们在包含 $N$ 个单元的均匀网格上采用有限体积法。对于 $i \\in \\{0, 1, \\dots, N-1\\}$，第 $i$ 个单元是区间 $[x_i - \\Delta x/2, x_i + \\Delta x/2]$，其中单元中心为 $x_i = (i + 1/2)\\Delta x$，单元宽度为 $\\Delta x = 1/N$。对控制方程在第 $i$ 个控制体上进行积分，得到：\n$$\n\\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{d}{dx}\\Big(\\Gamma \\,\\frac{d\\phi}{dx}\\Big) dx - \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{d}{dx}(\\rho u \\phi) dx = \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} s(x) dx\n$$\n将微积分基本定理应用于通量项，得到单元 $i$ 的平衡方程：\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_e - \\left(\\Gamma \\frac{d\\phi}{dx}\\right)_w - (\\rho u \\phi)_e + (\\rho u \\phi)_w = \\bar{s}_i \\Delta x\n$$\n此处，下标 $e$ 和 $w$ 分别表示单元的东界面 ($x_i + \\Delta x/2$) 和西界面 ($x_i - \\Delta x/2$)。源项积分使用中点法则进行近似，即 $\\bar{s}_i \\Delta x \\approx s(x_i) \\Delta x$。\n\n界面通量按如下方式进行离散化。设 $\\phi_i$ 是 $\\phi(x_i)$ 的数值近似值。\n扩散通量使用二阶中心差分格式进行近似：\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_e \\approx \\Gamma \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x}\n$$\n$$\n\\left(\\Gamma \\frac{d\\phi}{dx}\\right)_w \\approx \\Gamma \\frac{\\phi_i - \\phi_{i-1}}{\\Delta x}\n$$\n对流通量 $(\\rho u \\phi)_f$ 取决于为界面值 $\\phi_f$ 所选择的格式。\n\n对于一阶迎风格式（由于 $\\rho u  0$，流动方向为从西到东）：\n$$\n(\\rho u \\phi)_e = \\rho u \\phi_i\n$$\n$$\n(\\rho u \\phi)_w = \\rho u \\phi_{i-1}\n$$\n将这些代入平衡方程并除以 $\\Delta x$，得到单元 $i$ 的离散方程：\n$$\n\\frac{\\Gamma}{\\Delta x^2} (\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) - \\frac{\\rho u}{\\Delta x}(\\phi_i - \\phi_{i-1}) = s(x_i)\n$$\n这可以写成一个线性系统 $A\\Phi = b$，其中 $\\Phi = [\\phi_0, \\dots, \\phi_{N-1}]^T$ 且 $b_i = s(x_i)$。矩阵 $A$ 第 $i$ 行的非零系数为：\n$$\nA_{i,i-1} = \\frac{\\Gamma}{\\Delta x^2} + \\frac{\\rho u}{\\Delta x}, \\quad A_{i,i} = -\\frac{2\\Gamma}{\\Delta x^2} - \\frac{\\rho u}{\\Delta x}, \\quad A_{i,i+1} = \\frac{\\Gamma}{\\Delta x^2}\n$$\n\n对于二次上游插值对流运动学格式 (QUICK)，界面值由二次插值给出。对于东界面：\n$$\n\\phi_e = \\frac{3}{8}\\phi_{i+1} + \\frac{6}{8}\\phi_i - \\frac{1}{8}\\phi_{i-1}\n$$\n以及对于西界面：\n$$\n\\phi_w = \\frac{3}{8}\\phi_{i} + \\frac{6}{8}\\phi_{i-1} - \\frac{1}{8}\\phi_{i-2}\n$$\n离开单元 $i$ 的净对流通量为 $\\rho u (\\phi_e - \\phi_w)$。代入并化简可得：\n$$\n\\rho u (\\phi_e - \\phi_w) = \\rho u \\left( \\frac{3}{8}\\phi_{i+1} + \\frac{3}{8}\\phi_i - \\frac{7}{8}\\phi_{i-1} + \\frac{1}{8}\\phi_{i-2} \\right)\n$$\nQUICK 格式的完整离散方程为：\n$$\n\\frac{\\Gamma}{\\Delta x^2}(\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}) - \\frac{\\rho u}{\\Delta x}\\left(\\frac{1}{8}\\phi_{i-2} - \\frac{7}{8}\\phi_{i-1} + \\frac{3}{8}\\phi_i + \\frac{3}{8}\\phi_{i+1}\\right) = s(x_i)\n$$\n矩阵 $A$ 第 $i$ 行的非零系数为：\n$$\nA_{i,i-2} = -\\frac{\\rho u}{8\\Delta x}, \\quad A_{i,i-1} = \\frac{\\Gamma}{\\Delta x^2} + \\frac{7\\rho u}{8\\Delta x}, \\quad A_{i,i} = -\\frac{2\\Gamma}{\\Delta x^2} - \\frac{3\\rho u}{8\\Delta x}, \\quad A_{i,i+1} = \\frac{\\Gamma}{\\Delta x^2} - \\frac{3\\rho u}{8\\Delta x}\n$$\n在所有表达式中，指数都对 $N$ 取模以实现周期性。得到的矩阵是循环矩阵。\n\n该离散算子是守恒的，意味着每行系数之和为零。这导致矩阵 $A$ 是一个奇异矩阵，反映了周期域上的连续问题具有一个非平凡的零空间（常数函数）。为了获得唯一解，我们施加一个锚定约束。我们选择一个单元，比如 $j=0$，并强制 $\\phi_0 = \\phi_{\\text{exact}}(x_0)$。这通过将线性系统的第一行替换为方程 $1 \\cdot \\phi_0 = \\phi_{\\text{exact}}(x_0)$ 来实现，这使得系统非奇异且可解。\n\n对于每种格式和测试用例，我们求解 $N \\in \\{20, 40, 80, 160\\}$ 时的系统。然后我们计算 $\\ell_2$ 误差范数：\n$$\n\\|e\\|_{2}=\\Big(\\sum_{i=0}^{N-1}\\big(\\phi_i-\\phi_{\\text{exact}}(x_i)\\big)^2\\,\\Delta x\\Big)^{1/2}\n$$\n收敛阶 $p$ 通过对模型 $\\log\\|e\\|_2 = \\log C + p \\log \\Delta x$ 进行线性最小二乘拟合来估计，其中 $p$ 是斜率。计算出的收敛阶 $p_{\\text{upwind}}$ 和 $p_{\\text{QUICK}}$ 分别与它们的理论值 $1$ 和 $2$ 进行比较，使用的容差为 $0.25$。\n构造解 $\\phi_{\\text{exact}}(x) = \\sin(2\\pi x)$ 用于定义源项：\n$$\ns(x) = -\\Gamma (2\\pi)^2 \\sin(2\\pi x) - \\rho u (2\\pi) \\cos(2\\pi x)\n$$\n这确保了微分方程的精确解是已知的，从而可以进行精确的误差量化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady convection-diffusion equation using the finite volume\n    method with upwind and QUICK schemes, and computes the convergence rates.\n    \"\"\"\n    \n    # Define problem parameters\n    N_values = [20, 40, 80, 160]\n    test_cases = [\n        (0.1, 1.0),  # Case 1\n        (1.0, 1.0),  # Case 2\n        (0.01, 1.0) # Case 3\n    ]\n    anchor_idx = 0\n    \n    results = []\n\n    def get_convergence_rate(delta_x_vals, errors):\n        \"\"\"\n        Computes the convergence rate p from log(error) vs log(delta_x)\n        using a linear least-squares fit.\n        \"\"\"\n        log_delta_x = np.log(delta_x_vals)\n        log_errors = np.log(errors)\n        \n        # Perform linear regression for: log_errors = p * log_delta_x + c\n        n = len(log_delta_x)\n        sum_x = np.sum(log_delta_x)\n        sum_y = np.sum(log_errors)\n        sum_xy = np.sum(log_delta_x * log_errors)\n        sum_x2 = np.sum(log_delta_x**2)\n        \n        # Slope p of the regression line\n        p = (n * sum_xy - sum_x * sum_y) / (n * sum_x2 - sum_x**2)\n        return p\n\n    for gamma, rho_u in test_cases:\n        rates = {}\n        for scheme in ['upwind', 'quick']:\n            errors = []\n            delta_x_vals = []\n            \n            for N in N_values:\n                delta_x = 1.0 / N\n                delta_x_vals.append(delta_x)\n                x = (np.arange(N) + 0.5) * delta_x\n                \n                # Manufactured solution and corresponding source term\n                phi_exact = np.sin(2.0 * np.pi * x)\n                s = -gamma * (2.0 * np.pi)**2 * np.sin(2.0 * np.pi * x) - \\\n                     rho_u * (2.0 * np.pi) * np.cos(2.0 * np.pi * x)\n                \n                # Assemble the linear system A*phi = b\n                A = np.zeros((N, N))\n                b = s\n                \n                if scheme == 'upwind':\n                    # A_i,i-1*phi_i-1 + A_i,i*phi_i + A_i,i+1*phi_i+1 = s_i\n                    c_im1 = gamma / delta_x**2 + rho_u / delta_x\n                    c_i   = -2.0 * gamma / delta_x**2 - rho_u / delta_x\n                    c_ip1 = gamma / delta_x**2\n                    for i in range(N):\n                        A[i, (i - 1 + N) % N] = c_im1\n                        A[i, i]              = c_i\n                        A[i, (i + 1) % N]    = c_ip1\n                \n                elif scheme == 'quick':\n                    c_im2 = -rho_u / (8.0 * delta_x)\n                    c_im1 = gamma / delta_x**2 + 7.0 * rho_u / (8.0 * delta_x)\n                    c_i   = -2.0 * gamma / delta_x**2 - 3.0 * rho_u / (8.0 * delta_x)\n                    c_ip1 = gamma / delta_x**2 - 3.0 * rho_u / (8.0 * delta_x)\n                    for i in range(N):\n                        A[i, (i - 2 + N) % N] = c_im2\n                        A[i, (i - 1 + N) % N] = c_im1\n                        A[i, i]              = c_i\n                        A[i, (i + 1) % N]    = c_ip1\n\n                # Apply anchoring constraint to fix the null space\n                A[anchor_idx, :] = 0.0\n                A[anchor_idx, anchor_idx] = 1.0\n                b[anchor_idx] = phi_exact[anchor_idx]\n\n                # Solve the linear system\n                phi_numerical = np.linalg.solve(A, b)\n                \n                # Calculate the l2 error norm\n                l2_error = np.sqrt(np.sum((phi_numerical - phi_exact)**2) * delta_x)\n                errors.append(l2_error)\n            \n            # Estimate convergence rate\n            rate = get_convergence_rate(np.array(delta_x_vals), np.array(errors))\n            rates[scheme] = rate\n\n        p_upwind = rates['upwind']\n        p_quick = rates['quick']\n        \n        # Compare measured rates to expected values\n        match_upwind = abs(p_upwind - 1.0) = 0.25\n        match_quick = abs(p_quick - 2.0) = 0.25\n        \n        results.extend([p_upwind, p_quick, match_upwind, match_quick])\n\n    # Format final output as a comma-separated list in a single line\n    output_str = ','.join(map(str, results))\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        }
    ]
}