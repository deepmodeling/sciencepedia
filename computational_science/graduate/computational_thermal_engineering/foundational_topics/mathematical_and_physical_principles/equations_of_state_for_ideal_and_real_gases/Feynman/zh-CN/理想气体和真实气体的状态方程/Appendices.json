{
    "hands_on_practices": [
        {
            "introduction": "本实践是一项基础性练习，从捕捉真实气体行为的最简单模型——范德华（van der Waals）方程开始。通过推导其无量纲形式，您将揭示强大的对应状态原理（principle of corresponding states），该原理展示了如何通过临界性质进行缩放，将特定物质的参数整合到一个普适方程中 。这种分析技能对于理解所有物态方程的底层结构至关重要。",
            "id": "3951058",
            "problem": "一种单组分流体可用范德华状态方程 (EOS) 建模，对于摩尔体积 $V$ 和绝对温度 $T$，该方程为\n$$\nP = \\frac{R T}{V - b} - \\frac{a}{V^{2}},\n$$\n其中 $P$ 是压力，$R$ 是普适气体常数，$a$ 和 $b$ 分别是考虑了分子间引力和排除体积效应的特定物质参数。在温度 $T = T_{c}$ 的等温线 $P(V)$ 上，热力学临界点由 $P$–$V$ 曲线上的一个拐点条件定义，\n$$\n\\left( \\frac{\\partial P}{\\partial V} \\right)_{T} \\bigg|_{(T_{c}, V_{c})} = 0, \n\\qquad\n\\left( \\frac{\\partial^{2} P}{\\partial V^{2}} \\right)_{T} \\bigg|_{(T_{c}, V_{c})} = 0,\n$$\n对应的压力为 $P_{c} = P(T_{c}, V_{c})$。\n\n从这些基本定义出发，推导临界标度 $P_{c}$、$T_{c}$ 和 $V_{c}$ 关于 $a$、$b$ 和 $R$ 的表达式。然后，通过定义约化变量对状态方程进行无量纲化\n$$\n\\hat{P} = \\frac{P}{P_{c}}, \n\\qquad \n\\hat{T} = \\frac{T}{T_{c}}, \n\\qquad \n\\hat{V} = \\frac{V}{V_{c}},\n$$\n并将约化压力 $\\hat{P}$ 表示为仅与 $\\hat{T}$ 和 $\\hat{V}$ 有关的函数。简要解释为什么对于该模型，在对应状态定律下，所得的约化状态方程呈现出一种无参数结构。最终答案必须是 $\\hat{P}(\\hat{T}, \\hat{V})$ 的单一闭合形式表达式。无需进行四舍五入。由于结果是无量纲的，最终表达式中请勿包含单位。",
            "solution": "本题要求推导范德华状态方程 (EOS) 的临界常数，并随后构建该方程的约化、无量纲形式。\n\n范德华状态方程由下式给出\n$$\nP = \\frac{R T}{V - b} - \\frac{a}{V^{2}}\n$$\n其中 $P$ 是压力，$V$ 是摩尔体积，$T$ 是绝对温度，$R$ 是普适气体常数，$a$ 和 $b$ 是特定物质参数。\n\n临界点 $(P_c, V_c, T_c)$ 定义为临界等温线上的拐点，在该点，压力对体积在恒温下的一阶和二阶偏导数均为零。\n\n首先，我们计算 $P$ 在恒温 $T$ 下对 $V$ 的一阶偏导数：\n$$\n\\left( \\frac{\\partial P}{\\partial V} \\right)_{T} = \\frac{\\partial}{\\partial V} \\left( \\frac{R T}{V - b} - \\frac{a}{V^{2}} \\right) = - \\frac{R T}{(V - b)^{2}} + \\frac{2a}{V^{3}}\n$$\n接下来，我们计算二阶偏导数：\n$$\n\\left( \\frac{\\partial^{2} P}{\\partial V^{2}} \\right)_{T} = \\frac{\\partial}{\\partial V} \\left( - \\frac{R T}{(V - b)^{2}} + \\frac{2a}{V^{3}} \\right) = \\frac{2 R T}{(V - b)^{3}} - \\frac{6a}{V^{4}}\n$$\n在临界点 $(T_c, V_c)$，这两个导数都等于零：\n$$\n(1) \\qquad - \\frac{R T_{c}}{(V_{c} - b)^{2}} + \\frac{2a}{V_{c}^{3}} = 0 \\implies \\frac{R T_{c}}{(V_{c} - b)^{2}} = \\frac{2a}{V_{c}^{3}}\n$$\n$$\n(2) \\qquad \\frac{2 R T_{c}}{(V_{c} - b)^{3}} - \\frac{6a}{V_{c}^{4}} = 0 \\implies \\frac{2 R T_{c}}{(V_{c} - b)^{3}} = \\frac{6a}{V_{c}^{4}}\n$$\n我们现在得到了一个包含两个未知数 $T_c$ 和 $V_c$ 的方程组。为求解该方程组，我们可以将方程 $(2)$ 除以方程 $(1)$：\n$$\n\\frac{\\left( \\frac{2 R T_{c}}{(V_{c} - b)^{3}} \\right)}{\\left( \\frac{R T_{c}}{(V_{c} - b)^{2}} \\right)} = \\frac{\\left( \\frac{6a}{V_{c}^{4}} \\right)}{\\left( \\frac{2a}{V_{c}^{3}} \\right)}\n$$\n简化两边可得：\n$$\n\\frac{2}{V_{c} - b} = \\frac{3}{V_{c}}\n$$\n$$\n2V_{c} = 3(V_{c} - b) \\implies 2V_{c} = 3V_{c} - 3b \\implies V_{c} = 3b\n$$\n现在我们将临界摩尔体积 $V_{c}$ 的这个表达式代回方程 $(1)$，以求解临界温度 $T_c$：\n$$\n\\frac{R T_{c}}{(3b - b)^{2}} = \\frac{2a}{(3b)^{3}} \\implies \\frac{R T_{c}}{(2b)^{2}} = \\frac{2a}{27b^{3}}\n$$\n$$\n\\frac{R T_{c}}{4b^{2}} = \\frac{2a}{27b^{3}} \\implies T_{c} = \\frac{4b^{2}}{R} \\left( \\frac{2a}{27b^{3}} \\right) = \\frac{8a}{27Rb}\n$$\n最后，我们将 $T_c$ 和 $V_c$ 代入原始的范德华方程，求出临界压力 $P_c$：\n$$\nP_{c} = \\frac{R T_{c}}{V_{c} - b} - \\frac{a}{V_{c}^{2}} = \\frac{R}{3b - b} \\left( \\frac{8a}{27Rb} \\right) - \\frac{a}{(3b)^{2}}\n$$\n$$\nP_{c} = \\frac{R}{2b} \\left( \\frac{8a}{27Rb} \\right) - \\frac{a}{9b^{2}} = \\frac{4a}{27b^{2}} - \\frac{a}{9b^{2}} = \\frac{4a}{27b^{2}} - \\frac{3a}{27b^{2}}\n$$\n$$\nP_{c} = \\frac{a}{27b^{2}}\n$$\n总结以 $a$、$b$ 和 $R$ 表示的临界常数：\n$V_c = 3b$, $T_c = \\frac{8a}{27Rb}$, $P_c = \\frac{a}{27b^2}$.\n\n下一步是使用约化变量对状态方程进行无量纲化：\n$\\hat{P} = \\frac{P}{P_c}$，$\\hat{T} = \\frac{T}{T_c}$，$\\hat{V} = \\frac{V}{V_c}$。\n这意味着我们可以将原始变量写为 $P = \\hat{P}P_c$、$T = \\hat{T}T_c$ 和 $V = \\hat{V}V_c$。将这些代入范德华状态方程：\n$$\n\\hat{P} P_{c} = \\frac{R (\\hat{T} T_{c})}{\\hat{V} V_{c} - b} - \\frac{a}{(\\hat{V} V_{c})^{2}}\n$$\n现在，代入 $P_c$、$T_c$ 和 $V_c$ 的表达式：\n$$\n\\hat{P} \\left( \\frac{a}{27b^{2}} \\right) = \\frac{R \\hat{T} \\left( \\frac{8a}{27Rb} \\right)}{\\hat{V}(3b) - b} - \\frac{a}{(\\hat{V}(3b))^{2}}\n$$\n$$\n\\hat{P} \\left( \\frac{a}{27b^{2}} \\right) = \\frac{\\frac{8a\\hat{T}}{27b}}{b(3\\hat{V} - 1)} - \\frac{a}{9b^{2}\\hat{V}^{2}}\n$$\n$$\n\\hat{P} \\left( \\frac{a}{27b^{2}} \\right) = \\frac{8a\\hat{T}}{27b^{2}(3\\hat{V} - 1)} - \\frac{a}{9b^{2}\\hat{V}^{2}}\n$$\n为了求解 $\\hat{P}$，我们可以将整个方程除以公因式 $\\frac{a}{27b^2}$：\n$$\n\\hat{P} = \\left( \\frac{8a\\hat{T}}{27b^{2}(3\\hat{V} - 1)} \\right) \\left( \\frac{27b^{2}}{a} \\right) - \\left( \\frac{a}{9b^{2}\\hat{V}^{2}} \\right) \\left( \\frac{27b^{2}}{a} \\right)\n$$\n简化每一项可得：\n$$\n\\hat{P} = \\frac{8\\hat{T}}{3\\hat{V} - 1} - \\frac{27}{9\\hat{V}^{2}}\n$$\n这就得到了最终的约化范德华状态方程：\n$$\n\\hat{P} = \\frac{8\\hat{T}}{3\\hat{V} - 1} - \\frac{3}{\\hat{V}^{2}}\n$$\n所得的约化状态方程是一个连接约化变量 $\\hat{P}$、$\\hat{V}$ 和 $\\hat{T}$ 的无参数表达式。这体现了范德华模型的对应状态定律。其之所以无参数，是因为特定物质常数 $a$ 和 $b$ 已被吸收到标度因子 $P_c$、$V_c$ 和 $T_c$ 的定义中。通过用状态变量在临界点（对于任何给定物质都是一个独特的特征点）的值对其进行标度，所得方程对于所有可用范德华模型描述的物质都具有普适性。这意味着，在相同的约化温度和约化体积下，所有范德华流体都具有相同的约化压力。",
            "answer": "$$\n\\boxed{\\frac{8\\hat{T}}{3\\hat{V} - 1} - \\frac{3}{\\hat{V}^{2}}}\n$$"
        },
        {
            "introduction": "本练习将从分析推导转向实际计算，要求您实现并比较两个工业标准物态方程：立方型的彭-罗宾逊（Peng-Robinson, PR）方程和多参数的本尼迪克特-韦布-鲁宾-斯塔林（Benedict-Webb-Rubin-Starling, BWRS）模型。您将计算关键的热力学性质及其导数，从而获得在数值求根和有限差分方法方面的实践经验 。这项实践对于在真实工程模拟中评估不同模型之间的权衡至关重要。",
            "id": "3951055",
            "problem": "你需要实现一个完整的、可运行的程序。该程序针对一个指定并建模为单组分的重质烃，在多个温度-压力对下，比较两种真实气体状态方程的预测结果，并分析压缩因子和派生性质——焦耳-汤姆孙系数的差异。\n\n从以下基本依据和定义开始。\n\n- 压缩因子定义为 $Z \\equiv \\dfrac{P v}{R T}$，其中 $P$ 是压力，$v$ 是摩尔体积，$R$ 是普适气体常数，$T$ 是温度。\n- 焦耳-汤姆孙系数定义为 $\\mu_{\\mathrm{JT}} \\equiv \\left( \\dfrac{\\partial T}{\\partial P} \\right)_H$。根据焓微分 $d h = c_p d T + \\left[ v - T \\left( \\dfrac{\\partial v}{\\partial T} \\right)_P \\right] d P$ 和恒焓条件 $d h = 0$，可以得到工作关系式\n$$\n\\mu_{\\mathrm{JT}} = \\dfrac{ T \\left( \\dfrac{\\partial v}{\\partial T} \\right)_P - v }{ c_p },\n$$\n其中 $c_p$ 是恒压摩尔热容。在本问题中，使用线性的理想气体形式 $c_{p,\\mathrm{ig}}(T) = A + B T$ 对 $c_p$ 进行建模，其中 $A$ 和 $B$ 是给定常数。\n\n使用以下两种状态方程 (EOS)作为计算模型。\n\n- Peng–Robinson (PR) 立方状态方程：\n$$\nP(T,v) = \\dfrac{R T}{v - b} - \\dfrac{a \\, \\alpha(T)}{ v (v + b) + b (v - b) },\n$$\n其中\n$$\na = 0.45724 \\dfrac{R^2 T_c^2}{P_c}, \\quad b = 0.07780 \\dfrac{R T_c}{P_c}, \\quad \\alpha(T) = \\left[ 1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}} \\right) \\right]^2,\n$$\n$$\n\\kappa = 0.37464 + 1.54226 \\, \\omega - 0.26992 \\, \\omega^2.\n$$\n- 以摩尔密度 $\\rho \\equiv \\dfrac{1}{v}$ 表示的 Benedict–Webb–Rubin–Starling (BWRS-like) 形式：\n$$\nP(T,\\rho) = R T \\rho + \\left( B_0 R T - A_0 - \\dfrac{C_0}{T^2} \\right) \\rho^2 + \\left( b R T - a \\right) \\rho^3 + a \\alpha \\rho^6 + \\dfrac{c}{T^2} \\, \\rho^3 \\left( 1 + \\gamma \\rho^2 \\right) \\exp\\!\\left( - \\gamma \\rho^2 \\right).\n$$\n\n对于该重质烃，采用以下数据，这些数据是正癸烷的代表值：\n\n- 临界温度 $T_c = 617.7$ K。\n- 临界压力 $P_c = 2.11$ MPa。\n- 偏心因子 $\\omega = 0.49$。\n- 普适气体常数 $R = 8.314462618$ J mol$^{-1}$ K$^{-1}$。\n- 理想气体摩尔热容模型常数 $A = 100.0$ J mol$^{-1}$ K$^{-1}$ 和 $B = 0.20$ J mol$^{-1}$ K$^{-2}$。\n- BWRS-like 系数 (单位的选择是为了保证上述公式的量纲一致性)：\n  - $A_0 = 0.20$ J m$^3$ mol$^{-2}$，\n  - $B_0 = 1.0 \\times 10^{-4}$ m$^3$ mol$^{-1}$，\n  - $C_0 = 0.02$ J m$^3$ mol$^{-2}$ K$^{-2}$，\n  - $a = 1.0 \\times 10^{-4}$ J m$^6$ mol$^{-3}$，\n  - $b = 1.0 \\times 10^{-7}$ m$^6$ mol$^{-2}$，\n  - $\\alpha = 1.0$ (无量纲)，\n  - $\\gamma = 1.0 \\times 10^{-6}$ m$^6$ mol$^{-2}$，\n  - $c = 1.0 \\times 10^{-4}$ J m$^6$ K$^2$ mol$^{-3}$。\n\n你的程序必须完全使用浮点运算实现以下逻辑：\n\n- 对于每个指定的温度-压力对 $(T,P)$，通过数值求解 PR 状态方程 $P(T,v)$ 来计算摩尔体积 $v_{\\mathrm{PR}}(T,P)$。通过数值求解 BWRS-like 状态方程 $P(T,\\rho)$ 来计算摩尔密度 $\\rho_{\\mathrm{BWRS}}(T,P)$，然后令 $v_{\\mathrm{BWRS}}(T,P) = 1 / \\rho_{\\mathrm{BWRS}}(T,P)$。\n- 使用这些摩尔体积计算压缩因子 $Z_{\\mathrm{PR}} = \\dfrac{P v_{\\mathrm{PR}}}{R T}$ 和 $Z_{\\mathrm{BWRS}} = \\dfrac{P v_{\\mathrm{BWRS}}}{R T}$。\n- 使用以下公式计算焦耳-汤姆孙系数\n$$\n\\mu_{\\mathrm{JT,PR}}(T,P) = \\dfrac{ T \\left( \\dfrac{\\partial v_{\\mathrm{PR}}}{\\partial T} \\right)_P - v_{\\mathrm{PR}} }{ c_{p,\\mathrm{ig}}(T) }, \\quad\n\\mu_{\\mathrm{JT,BWRS}}(T,P) = \\dfrac{ T \\left( \\dfrac{\\partial v_{\\mathrm{BWRS}}}{\\partial T} \\right)_P - v_{\\mathrm{BWRS}} }{ c_{p,\\mathrm{ig}}(T) },\n$$\n使用对称温度增量 $\\Delta T = 1.0$ K 的中心有限差分来近似 $\\left( \\dfrac{\\partial v}{\\partial T} \\right)_P$。通过将计算出的 K/Pa 值除以 $10^6$，以 K/MPa 为单位报告焦耳-汤姆孙系数。\n\n数值要求和约束：\n\n- 使用稳健的区间法和求根法求解关于 $v_{\\mathrm{PR}}(T,P)$ 和 $\\rho_{\\mathrm{BWRS}}(T,P)$ 的非线性方程；确保区间两端的目标残差符号相反。\n- 内部计算使用 SI 基本单位：$T$ 以开尔文为单位，$P$ 以帕斯卡为单位，$v$ 以 m$^3$ mol$^{-1}$ 为单位，$\\rho$ 以 mol m$^{-3}$ 为单位。最终报告的 $\\mu_{\\mathrm{JT}}$ 必须以 K/MPa 为单位。\n- 所有输出结果计算到六位小数。\n\n测试套件：\n\n在以下四种情况下评估你的程序，这些情况旨在覆盖典型的超临界类气态区域、近临界区域、低压近理想气体区域以及保持在单相区内的高压区域：\n\n- 情况 1：$T = 650.0$ K, $P = 1.0$ MPa。\n- 情况 2：$T = 620.0$ K, $P = 2.0$ MPa。\n- 情况 3：$T = 700.0$ K, $P = 0.1$ MPa。\n- 情况 4：$T = 650.0$ K, $P = 5.0$ MPa。\n\n答案规范：\n\n- 对于每种情况，生成一个包含四个浮点数的列表 $[ Z_{\\mathrm{PR}}, Z_{\\mathrm{BWRS}}, \\mu_{\\mathrm{JT,PR}}, \\mu_{\\mathrm{JT,BWRS}} ]$，其中焦耳-汤姆孙系数项的单位是 K/MPa。将每个值四舍五入到六位小数。\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每种情况都表示为其自己的子列表，例如 $[[x_1,x_2,x_3,x_4],[y_1,y_2,y_3,y_4],\\ldots]$。",
            "solution": "该问题被评估为有效，因为它在科学上基于化学工程热力学，数据充分、问题良定，且表述客观。任务是实现一个计算模型，用于比较两种状态方程 (EOS) 对一种重质烃的预测。\n\n解决方案首先确定必要的物理常数和状态方程参数。然后，对于每个指定的温度-压力对，采用稳健的数值求根算法从每个状态方程中确定摩尔体积（或密度）。随后，根据其基本定义和计算出的状态变量，计算压缩因子和焦耳-汤姆孙系数。\n\n**1. 模型构建和常数**\n\n该问题要求使用两种状态方程：Peng–Robinson (PR) 状态方程和一种特定的 Benedict–Webb–Rubin–Starling (BWRS)-like 状态方程。所有计算均使用 SI 基本单位（压力单位为帕斯卡，温度单位为开尔文，摩尔体积单位为 $m^3/mol$）。\n\n**Peng-Robinson (PR) 状态方程：**\n压力表示为温度 $T$ 和摩尔体积 $v$ 的函数：\n$$P(T,v) = \\dfrac{R T}{v - b} - \\dfrac{a \\alpha(T)}{v(v+b) + b(v-b)}$$\n参数 $a$、$b$ 和 $\\alpha(T)$ 由物质的临界性质（$T_c, P_c$）和偏心因子（$\\omega$）确定：\n$$a = 0.45724 \\dfrac{R^2 T_c^2}{P_c}, \\quad b = 0.07780 \\dfrac{R T_c}{P_c}$$\n$$\\alpha(T) = \\left[ 1 + \\kappa \\left(1 - \\sqrt{\\dfrac{T}{T_c}} \\right) \\right]^2, \\quad \\text{其中} \\quad \\kappa = 0.37464 + 1.54226 \\omega - 0.26992 \\omega^2$$\n\n**BWRS-like 状态方程：**\n该状态方程将压力表示为温度 $T$ 和摩尔密度 $\\rho = 1/v$ 的函数：\n$$P(T,\\rho) = R T \\rho + \\left( B_0 R T - A_0 - \\dfrac{C_0}{T^2} \\right) \\rho^2 + \\left( b R T - a \\right) \\rho^3 + a \\alpha \\rho^6 + \\dfrac{c}{T^2} \\rho^3 \\left( 1 + \\gamma \\rho^2 \\right) \\exp\\left( - \\gamma \\rho^2 \\right)$$\n系数 $A_0, B_0, C_0, a, b, \\alpha, c, \\gamma$ 作为特定物质的常数给出。\n\n**物理和模型常数：**\n对于类正癸烷的烃，使用以下数据：\n- 临界温度, $T_c = 617.7 \\text{ K}$\n- 临界压力, $P_c = 2.11 \\text{ MPa} = 2.11 \\times 10^6 \\text{ Pa}$\n- 偏心因子, $\\omega = 0.49$\n- 普适气体常数, $R = 8.314462618 \\text{ J mol}^{-1} \\text{ K}^{-1}$\n- 理想气体热容常数: $A = 100.0 \\text{ J mol}^{-1} \\text{ K}^{-1}$, $B = 0.20 \\text{ J mol}^{-1} \\text{ K}^{-2}$\n- BWRS-like 系数按规定使用，并注意与 PR 方程中符号相同（$a$, $b$, $\\alpha$）的参数进行区分。\n\n**2. 计算策略**\n\n**用于状态确定的求根方法：**\n在给定的温度 $T$ 和压力 $P$ 下，两种状态方程都变为单变量（PR 方程为摩尔体积 $v$，BWRS 方程为摩尔密度 $\\rho$）的非线性函数。为了找到正确的状态，我们必须求解这个变量。这被构建为一个求根问题 $f(x) = 0$，其中残差函数为 $f(x) = P_{EOS}(T, x) - P$。\n\n为此任务选择了一个稳健的数值求解器 `scipy.optimize.brentq`。该方法需要一个区间 $[x_{min}, x_{max}]$，使得 $f(x_{min})$ 和 $f(x_{max})$ 符号相反。\n- 对于 PR 状态方程，物理摩尔体积 $v$ 必须大于协体积参数 $b$。理想气体体积 $v_{ideal} = RT/P$ 为解的量级提供了一个很好的估计。可以建立一个合适的搜索区间，例如，在 $1.01 \\cdot b$ 和 $v_{ideal}$ 的数倍之间。\n- 对于 BWRS-like 状态方程，摩尔密度 $\\rho$ 必须为正。使用一个宽泛但物理上合理的区间，如 $[10^{-4}, 6000] \\text{ mol/m}^3$，以确保在所有测试条件下都能捕获到根。\n\n**派生性质的计算：**\n1.  **压缩因子 ($Z$)：** 在给定的 $(T, P)$ 下确定摩尔体积 $v$ 后，压缩因子可直接根据其定义计算：\n    $$Z = \\dfrac{P v}{R T}$$\n\n2.  **焦耳-汤姆孙系数 ($\\mu_{JT}$)：** 该系数使用所提供的热力学关系式计算：\n    $$\\mu_{\\mathrm{JT}} = \\dfrac{T \\left( \\dfrac{\\partial v}{\\partial T} \\right)_P - v}{c_p}$$\n    按照规定，热容 $c_p$ 用其理想气体形式 $c_{p,ig}(T) = A + B T$ 近似。偏导数 $(\\partial v / \\partial T)_P$ 使用温度步长为 $\\Delta T = 1.0 \\text{ K}$ 的二阶中心有限差分格式进行近似：\n    $$\\left( \\dfrac{\\partial v}{\\partial T} \\right)_P \\approx \\dfrac{v(T + \\Delta T, P) - v(T - \\Delta T, P)}{2 \\Delta T}$$\n    对于每个测试用例，这需要求解在另外两个温度 $T + \\Delta T$ 和 $T - \\Delta T$ 下的摩尔体积。最终以 K/Pa 为单位的结果通过除以 $10^6$ 转换为 K/MPa。\n\n**3. 实现设计**\n\nPython 实现的结构力求清晰和稳健。\n- 使用面向对象设计，通过独立的类（`PREOS`, `BWRS_EOS`）来封装每个状态方程的逻辑和参数。这可以防止在不同模型中因参数同名（例如 $a$, $b$）而引起的混淆。\n- 一个 `solve` 函数组织整个过程。它遍历指定的测试用例，并为每个 $(T, P)$ 对调用一个辅助函数来执行计算。\n- 该计算辅助函数首先使用相应的状态方程求根程序求解摩尔体积/密度。然后通过有限差分计算导数项，最后整合 $Z$ 和 $\\mu_{JT}$ 的值。\n- 所有内部计算都严格遵守 SI 单位。\n- 每个案例的最终结果 $[Z_{\\mathrm{PR}}, Z_{\\mathrm{BWRS}}, \\mu_{\\mathrm{JT,PR}}, \\mu_{\\mathrm{JT,BWRS}}]$ 按要求四舍五入到六位小数，并汇总到一个列表的列表中。然后将此最终数据结构格式化为指定的字符串表示形式以供输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the thermodynamics problem.\n    It sets up constants, defines EOS models, iterates through test cases,\n    and prints the final results in the specified format.\n    \"\"\"\n\n    # Global constants in SI units\n    R = 8.314462618  # J mol^-1 K^-1\n    TC = 617.7  # K\n    PC = 2.11e6  # Pa\n    OMEGA = 0.49\n    CP_IG_PARAMS = {\"A\": 100.0, \"B\": 0.20}  # J mol^-1 K^-1, J mol^-1 K^-2\n\n    # BWRS-like EOS coefficients\n    BWRS_PARAMS = {\n        \"A0\": 0.20,       # J m^3 mol^-2\n        \"B0\": 1.0e-4,     # m^3 mol^-1\n        \"C0\": 0.02,       # J m^3 mol^-2 K^2\n        \"a\": 1.0e-4,      # J m^6 mol^-3\n        \"b\": 1.0e-7,      # m^6 mol^-2\n        \"alpha\": 1.0,     # dimensionless\n        \"gamma\": 1.0e-6,  # m^6 mol^-2\n        \"c\": 1.0e-4       # J m^6 K^2 mol^-3\n    }\n    \n    class PREOS:\n        \"\"\"Encapsulates the Peng-Robinson Equation of State.\"\"\"\n        def __init__(self, Tc, Pc, omega, R_const):\n            self.Tc, self.Pc, self.omega, self.R = Tc, Pc, omega, R_const\n            self.kappa = 0.37464 + 1.54226 * omega - 0.26992 * omega**2\n            self.a_const = 0.45724 * (self.R**2 * Tc**2) / Pc\n            self.b = 0.07780 * (self.R * Tc) / Pc\n\n        def get_alpha(self, T):\n            return (1 + self.kappa * (1 - np.sqrt(T / self.Tc)))**2\n\n        def pressure(self, v, T):\n            alpha_T = self.get_alpha(T)\n            # Denominator is v(v+b) + b(v-b) = v^2 + 2bv - b^2\n            attractive_term = (self.a_const * alpha_T) / (v**2 + 2 * self.b * v - self.b**2)\n            repulsive_term = (self.R * T) / (v - self.b)\n            return repulsive_term - attractive_term\n\n        def residual(self, v, T, P):\n            if v = self.b:\n                return 1e12  # Return a large number for non-physical volumes\n            return self.pressure(v, T) - P\n\n    class BWRS_EOS:\n        \"\"\"Encapsulates the BWRS-like Equation of State.\"\"\"\n        def __init__(self, R_const, params):\n            self.R = R_const\n            self.p = params\n\n        def pressure(self, rho, T):\n            p = self.p\n            T2 = T**2\n            rho2 = rho**2\n            rho3 = rho**3\n            gamma_rho2 = p[\"gamma\"] * rho2\n            \n            term1 = self.R * T * rho\n            term2 = (p[\"B0\"] * self.R * T - p[\"A0\"] - p[\"C0\"] / T2) * rho2\n            term3 = (p[\"b\"] * self.R * T - p[\"a\"]) * rho3\n            term4 = p[\"a\"] * p[\"alpha\"] * rho**6\n            term5 = (p[\"c\"] / T2) * rho3 * (1 + gamma_rho2) * np.exp(-gamma_rho2)\n            \n            return term1 + term2 + term3 + term4 + term5\n            \n        def residual(self, rho, T, P):\n            if rho = 0:\n                return -1e12 # Return a large number for non-physical densities\n            return self.pressure(rho, T) - P\n\n    def get_properties(T, P, pr_eos, bwrs_eos, cp_params):\n        \"\"\"Computes Z and mu_JT for both EOS at a given T and P.\"\"\"\n        # --- Peng-Robinson Path ---\n        v_ideal_pr = R * T / P\n        v_pr = brentq(pr_eos.residual, pr_eos.b * 1.01, v_ideal_pr * 10, args=(T, P))\n        Z_pr = (P * v_pr) / (R * T)\n\n        # --- BWRS-like Path ---\n        # Bracket [1e-4, 6000] is robust for gaseous states\n        rho_bwrs = brentq(bwrs_eos.residual, 1e-4, 6000, args=(T, P))\n        v_bwrs = 1.0 / rho_bwrs\n        Z_bwrs = (P * v_bwrs) / (R * T)\n\n        # --- Joule-Thomson Coefficient Calculation ---\n        dT = 1.0 # K, finite difference step\n        cp_ig = cp_params[\"A\"] + cp_params[\"B\"] * T\n        \n        # PR mu_JT\n        v_pr_plus = brentq(pr_eos.residual, pr_eos.b * 1.01, v_ideal_pr * 10, args=(T + dT, P))\n        v_pr_minus = brentq(pr_eos.residual, pr_eos.b * 1.01, v_ideal_pr * 10, args=(T - dT, P))\n        dvdT_pr = (v_pr_plus - v_pr_minus) / (2 * dT)\n        mu_jt_pr_si = (T * dvdT_pr - v_pr) / cp_ig\n        mu_jt_pr = mu_jt_pr_si / 1e6 # Convert from K/Pa to K/MPa\n\n        # BWRS mu_JT\n        rho_bwrs_plus = brentq(bwrs_eos.residual, 1e-4, 6000, args=(T + dT, P))\n        rho_bwrs_minus = brentq(bwrs_eos.residual, 1e-4, 6000, args=(T - dT, P))\n        v_bwrs_plus = 1.0 / rho_bwrs_plus\n        v_bwrs_minus = 1.0 / rho_bwrs_minus\n        dvdT_bwrs = (v_bwrs_plus - v_bwrs_minus) / (2 * dT)\n        mu_jt_bwrs_si = (T * dvdT_bwrs - v_bwrs) / cp_ig\n        mu_jt_bwrs = mu_jt_bwrs_si / 1e6 # Convert from K/Pa to K/MPa\n\n        return [\n            round(Z_pr, 6),\n            round(Z_bwrs, 6),\n            round(mu_jt_pr, 6),\n            round(mu_jt_bwrs, 6)\n        ]\n\n    # Instantiate EOS models\n    pr_eos_model = PREOS(TC, PC, OMEGA, R)\n    bwrs_eos_model = BWRS_EOS(R, BWRS_PARAMS)\n\n    # Define test cases (T in K, P in Pa)\n    test_cases = [\n        (650.0, 1.0e6),\n        (620.0, 2.0e6),\n        (700.0, 0.1e6),\n        (650.0, 5.0e6)\n    ]\n\n    results = []\n    for T_case, P_case in test_cases:\n        case_results = get_properties(T_case, P_case, pr_eos_model, bwrs_eos_model, CP_IG_PARAMS)\n        results.append(case_results)\n    \n    # Format the final output string as a list of lists.\n    # str(list) automatically creates the '[...]' representation.\n    # ','.join(...) joins these string representations with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "最后的这项实践将整合您的技能，以解决化学与热力工程中最重要的挑战之一：评估多组分混合物的相稳定性。您将使用彭-罗宾逊（Peng-Robinson）物态方程，结合数值优化技术，实现严格的切平面距离（tangent plane distance, TPD）准则 。掌握此方法是分离过程和油藏流体行为设计与模拟的基础。",
            "id": "3951077",
            "problem": "给定一个多组分烃类混合物，您必须在指定的热力dynamic条件下，使用基于逸度系数构建的切平面距离 (TPD) 准则来评估其单相稳定性，逸度系数由 Peng–Robinson (PR) 状态方程获得。整个计算过程应完全基于摩尔吉布斯能和逸度的概念，不使用问题陈述中提供的简化公式。目标是实现一种计算方法，该方法通过在候选组成上最小化 TPD 泛函，来判断单相状态是稳定还是会分裂成两相。\n\n应使用的基本原理：恒定压力和温度下的摩尔吉布斯能；作为偏摩尔吉布斯能的化学势；逸度和逸度系数的定义；用于真实气体的 Peng–Robinson 状态方程及其经典混合规则；以及类气相压缩因子根的选择。您必须从第一性原理和科学合理的假设出发实现这些内容，从“一个在恒定压力和温度下的热力学相，如果其摩尔吉布斯能是组成的凸函数，则该相是稳定的；如果存在一个方向能通过相分离降低吉布斯能，则该相是不稳定的”这一定义开始。\n\n物理规格：\n- 组分：甲烷、乙烷、丙烷。对这些组分使用标准的 Peng–Robinson 临界性质和偏心因子，并采用经典混合规则。\n- 每个组分 $i$ 的临界性质和偏心因子：\n  - 甲烷：$T_{c} = 190.56\\ \\mathrm{K}$，$P_{c} = 4.599\\times 10^{6}\\ \\mathrm{Pa}$，$\\omega = 0.011$。\n  - 乙烷：$T_{c} = 305.32\\ \\mathrm{K}$，$P_{c} = 4.872\\times 10^{6}\\ \\mathrm{Pa}$，$\\omega = 0.099$。\n  - 丙烷：$T_{c} = 369.83\\ \\mathrm{K}$，$P_{c} = 4.248\\times 10^{6}\\ \\mathrm{Pa}$，$\\omega = 0.152$。\n- 二元交互作用参数（对称），用于经典混合规则 $\\sqrt{a_{i} a_{j}}(1 - k_{ij})$：$k_{12} = 0.012$，$k_{13} = 0.015$，$k_{23} = 0.010$，以及 $k_{ii} = 0$。\n- 通用气体常数：$R = 8.314462618\\ \\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。\n\n计算要求和模型假设：\n- 逸度系数必须使用带有经典混合规则（用于 $a$ 和 $b$ 参数）的 Peng–Robinson 状态方程计算。对于压缩因子 $Z$，应使用类气相根选择，即在指定条件下 PR 三次方程的最大实数根。\n- 切平面距离泛函必须在候选组成上进行最小化，并受摩尔分数约束。假设使用一个光滑的参数化方法来强制满足 $y_{i} \\ge 0$ 和 $\\sum_{i} y_{i} = 1$，而无需手动施加约束。\n\n判定准则：\n- 如果在指定条件下的最小 TPD 值为负，则单相状态不稳定并将分裂成两相；如果为非负值，则单相状态稳定。\n\n单位和输出规格：\n- 温度 $T$ 必须以 $\\mathrm{K}$ 为单位。\n- 压力 $P$ 必须以 $\\mathrm{Pa}$ 为单位。\n- 摩尔分数必须是无量纲的，并且对于所有组分都严格为正（没有精确的零）。\n- 您的程序必须为每个测试用例计算最小 TPD 值，并在单行中报告这些值。将每个最小 TPD 值表示为四舍五入到六位小数的浮点数。\n\n测试套件：\n- 情况 1（一般类气相条件）：$T = 320\\ \\mathrm{K}$，$P = 5.0\\times 10^{6}\\ \\mathrm{Pa}$，总组成 $z = [0.7,\\,0.2,\\,0.1]$。\n- 情况 2（近冷凝条件）：$T = 220\\ \\mathrm{K}$，$P = 2.0\\times 10^{6}\\ \\mathrm{Pa}$，总组成 $z = [0.4,\\,0.3,\\,0.3]$。\n- 情况 3（高压类气相条件）：$T = 370\\ \\mathrm{K}$，$P = 1.2\\times 10^{7}\\ \\mathrm{Pa}$，总组成 $z = [0.9,\\,0.05,\\,0.05]$。\n- 情况 4（接近纯组分但摩尔分数严格为正）：$T = 300\\ \\mathrm{K}$，$P = 4.0\\times 10^{6}\\ \\mathrm{Pa}$，总组成 $z = [0.02,\\,0.97999,\\,0.00001]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的最小 TPD 值，格式为一个由方括号括起来的逗号分隔列表，四舍五入到六位小数（例如，$[x_{1},x_{2},x_{3},x_{4}]$，其中每个 $x_{k}$ 是一个小数点后有六位的浮点数）。",
            "solution": "该问题要求对指定条件下的单相烃类混合物进行严格的热力学稳定性分析。在恒定温度 $T$ 和压力 $P$ 下，一个相的稳定性由其摩尔吉布斯能 $G_m$ 作为组成函数的凸性决定。如果一个相的 $G_m$ 曲面是凸的，即连接曲面上任意两点的线段完全位于该曲面上方，则该相是稳定的。如果在对应于总组成 $\\mathbf{z}$ 的点上构造的切平面，对于所有其他可能的组成 $\\mathbf{y}$，都完全位于 $G_m$ 曲面的下方，则该相是稳定的。如果 $G_m$ 曲面的任何部分落在此切平面下方，则该相不稳定，并将分裂成两个或更多相以达到更低的总吉布斯能。切平面距离 (TPD) 准则是这一原理的直接数学形式化表達。\n\n### 热力学基础\n\nTPD 是在尝试组成 $\\mathbf{y}$ 处的摩尔吉布斯能曲面与在初始组成 $\\mathbf{z}$ 处该曲面的切平面之间的归一化垂直距离。TPD 泛函通过除以 $RT$ 进行无量纲化，表示为：\n$$\n\\text{TPD}(\\mathbf{y}) = \\frac{G_m(\\mathbf{y})}{RT} - \\frac{G_{m, \\text{tangent}}(\\mathbf{y})}{RT}\n$$\n在 $\\mathbf{z}$ 处的切平面方程为 $G_{m, \\text{tangent}}(\\mathbf{y}) = \\sum_{i=1}^{N_c} y_i \\mu_i(\\mathbf{z})$，其中 $\\mu_i(\\mathbf{z})$ 是组成为 $\\mathbf{z}$ 的混合物中组分 $i$ 的化学势。因此，TPD 泛函变为：\n$$\n\\text{TPD}(\\mathbf{y}) = \\frac{1}{RT} \\left( G_m(\\mathbf{y}) - \\sum_{i=1}^{N_c} y_i \\mu_i(\\mathbf{z}) \\right)\n$$\n化学势 $\\mu_i$ 通过 $\\mu_i = \\mu_i^{\\text{ref}} + RT \\ln(f_i/f_i^{\\text{ref}})$ 与逸度 $f_i$ 相关联。利用此关系，TPD 泛函可以用逸度表示：\n$$\n\\text{TPD}(\\mathbf{y}) = \\sum_{i=1}^{N_c} y_i \\ln \\frac{f_i(\\mathbf{y})}{f_i(\\mathbf{z})}\n$$\n混合物中组分 $i$ 的逸度定义为 $f_i = y_i \\phi_i P$，其中 $\\phi_i$ 是逸度系数。将此定义代入 TPD 表达式，得到用于计算的形式：\n$$\n\\text{TPD}(\\mathbf{y}) = \\sum_{i=1}^{N_c} y_i \\left( \\ln\\left(y_i \\phi_i(\\mathbf{y}) P\\right) - \\ln\\left(z_i \\phi_i(\\mathbf{z}) P\\right) \\right) = \\sum_{i=1}^{N_c} y_i \\left( \\ln y_i + \\ln \\phi_i(\\mathbf{y}) - \\ln z_i - \\ln \\phi_i(\\mathbf{z}) \\right)\n$$\n对于给定的问题，$\\ln z_i$ 和 $\\ln \\phi_i(\\mathbf{z})$ 的值是常数。令 $d_i = \\ln z_i + \\ln \\phi_i(\\mathbf{z})$。需要最小化的函数是：\n$$\n\\text{TPD}(\\mathbf{y}) = \\sum_{i=1}^{N_c} y_i \\left( \\ln y_i + \\ln \\phi_i(\\mathbf{y}) - d_i \\right)\n$$\n其中求和遍及所有组分 $i=1, \\dots, N_c$。逸度系数 $\\phi_i(\\mathbf{y})$ 依赖于尝试组成 $\\mathbf{y}$，并且必须在最小化的每一步重新计算。当尝试相的化学势等于进料相的化学势时，即 $\\mu_i(\\mathbf{y}) = \\mu_i(\\mathbf{z})$，达到一个驻点。在平凡解 $\\mathbf{y} = \\mathbf{z}$ 处，$\\text{TPD}(\\mathbf{z}) = 0$。如果找到了一个 $\\text{TPD}(\\mathbf{y})  0$ 的非平凡最小值，则原始相不稳定。否则，它是稳定或亚稳的。\n\n### Peng–Robinson 状态方程 (PR-EOS)\n\n逸度系数使用 Peng-Robinson 状态方程计算：\n$$\nP = \\frac{RT}{V_m - b} - \\frac{a(T)}{V_m(V_m+b) + b(V_m-b)}\n$$\n每个纯组分 $i$ 的参数 $a_i$ 和 $b_i$ 由其临界性质（$T_{ci}$，$P_{ci}$）和偏心因子（$\\omega_i$）确定：\n$$\na_i = 0.45724 \\frac{R^2 T_{ci}^2}{P_{ci}}\n$$\n$$\nb_i = 0.07780 \\frac{R T_{ci}}{P_{ci}}\n$$\n依赖于温度的项 $a(T)_i$ 由 $a(T)_i = a_i \\alpha_i(T)$ 给出，其中\n$$\n\\alpha_i(T) = \\left[1 + \\kappa_i \\left(1 - \\sqrt{\\frac{T}{T_{ci}}}\\right)\\right]^2\n$$\n$$\n\\kappa_i = 0.37464 + 1.54226 \\omega_i - 0.26992 \\omega_i^2\n$$\n对于摩尔分数为 $\\mathbf{x} = (x_1, \\dots, x_{N_c})$ 的混合物，应用经典混合规则：\n$$\na_{\\text{mix}} = \\sum_{i=1}^{N_c} \\sum_{j=1}^{N_c} x_i x_j \\sqrt{a_i(T) a_j(T)} (1 - k_{ij})\n$$\n$$\nb_{\\text{mix}} = \\sum_{i=1}^{N_c} x_i b_i\n$$\n引入无量纲参数 $A = \\frac{a_{\\text{mix}} P}{(RT)^2}$ 和 $B = \\frac{b_{\\text{mix}} P}{RT}$，PR-EOS可以写成一个关于压缩因子 $Z = PV_m/RT$ 的三次方程：\n$$\nZ^3 - (1-B)Z^2 + (A - 2B - 3B^2)Z - (AB - B^2 - B^3) = 0\n$$\n根据问题规定，该三次方程的最大实数根（类气相根）被用作 $Z$。\n\n### 基于 PR-EOS 的逸度系数\n\n混合物中组分 $k$ 的逸度系数由状态方程导出，表达式为：\n$$\n\\ln \\phi_k = \\frac{b_k}{b_{\\text{mix}}}(Z-1) - \\ln(Z-B) - \\frac{A}{2\\sqrt{2}B} \\left( \\frac{2 \\sum_{j=1}^{N_c} x_j \\sqrt{a_k a_j}(1-k_{kj})}{a_{\\text{mix}}} - \\frac{b_k}{b_{\\text{mix}}} \\right) \\ln\\left(\\frac{Z + (1+\\sqrt{2})B}{Z + (1-\\sqrt{2})B}\\right)\n$$\n其中 $a_k(T)$ 是纯组分 $k$ 的依赖于温度的参数。\n\n### 计算策略\n\n对于每个测试用例，解决方案涉及一个两阶段的计算过程。\n\n1.  **进料相表征：** 对于给定的进料组成 $\\mathbf{z}$，在温度 $T$ 和压力 $P$ 下，我们首先计算所有必要的性质。这包括计算混合物参数 $a_{\\text{mix}}(\\mathbf{z})$ 和 $b_{\\text{mix}}(\\mathbf{z})$，求解压缩因子 $Z(\\mathbf{z})$，然后计算所有组分的逸度系数 $\\phi_i(\\mathbf{z})$。这些值用于确定 TPD 泛函中的常数项 $d_i = \\ln z_i + \\ln \\phi_i(\\mathbf{z})$。\n\n2.  **TPD 最小化：** 任务的核心是在所有可能的尝试组成 $\\mathbf{y}$ 上找到 TPD 泛函的最小值。这是一个约束优化问题，因为摩尔分数必须满足 $y_i > 0$ 和 $\\sum y_i = 1$。为了处理这些约束，我们引入一组 $N_c-1$ 个无约束变量 $X_1, \\dots, X_{N_c-1}$，并使用一个光滑映射将它们转换为有效的摩尔分数。一个稳健的选择是 softmax 函数的一个变体：令 $X_{N_c}=0$，则\n    $$\n    y_i = \\frac{\\exp(X_i)}{\\sum_{j=1}^{N_c} \\exp(X_j)}\n    $$\n    这种变换确保 $y_i$ 总是正的并且总和为一。然后，使用 `scipy.optimize.minimize` 提供的拟牛顿法（例如 BFGS）对无约束变量 $\\mathbf{X}$进行最小化。\n\n    TPD 曲面可能很复杂，有多个局部最小值。为增加找到全局最小值的可能性，优化从几个不同的起始点开始。对这些初始猜测的明智选择是接近纯组分的组成，因为这些点代表了组成空间的顶点，新相很可能在这些位置成核。对于三组分体系，使用对应于接近纯甲烷、纯乙烷和纯丙烷的初始猜测。在所有优化运行中找到的最低 TPD 值被视为最终结果。如果该值为负，则宣布该相不稳定。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves the phase stability problem using the tangent plane distance (TPD)\n    criterion with the Peng-Robinson (PR) equation of state.\n    \"\"\"\n    # Universal gas constant in J/(mol K)\n    R = 8.314462618\n\n    # Component properties: name, Tc (K), Pc (Pa), omega\n    components_data = {\n        'methane': {'Tc': 190.56, 'Pc': 4.599e6, 'omega': 0.011},\n        'ethane': {'Tc': 305.32, 'Pc': 4.872e6, 'omega': 0.099},\n        'propane': {'Tc': 369.83, 'Pc': 4.248e6, 'omega': 0.152},\n    }\n    comp_names = list(components_data.keys())\n    num_components = len(comp_names)\n\n    # Binary interaction parameters (kij)\n    kij = np.array([\n        [0.0,   0.012, 0.015],  # Methane\n        [0.012, 0.0,   0.010],  # Ethane\n        [0.015, 0.010, 0.0]    # Propane\n    ])\n\n    test_cases = [\n        # T (K), P (Pa), z (mole fractions)\n        (320.0, 5.0e6, np.array([0.7, 0.2, 0.1])),\n        (220.0, 2.0e6, np.array([0.4, 0.3, 0.3])),\n        (370.0, 1.2e7, np.array([0.9, 0.05, 0.05])),\n        (300.0, 4.0e6, np.array([0.02, 0.97999, 0.00001])),\n    ]\n\n    # Pre-calculate pure component parameters\n    Tc = np.array([v['Tc'] for v in components_data.values()])\n    Pc = np.array([v['Pc'] for v in components_data.values()])\n    omega = np.array([v['omega'] for v in components_data.values()])\n\n    kappa = 0.37464 + 1.54226 * omega - 0.26992 * omega**2\n    a_c = 0.45724 * (R * Tc)**2 / Pc\n    b_i = 0.07780 * R * Tc / Pc\n\n    def get_eos_properties(T, P, x):\n        \"\"\"Calculates EOS parameters A, B, Z, and ln(phi) for a given state.\"\"\"\n        # Ensure composition is a numpy array\n        x = np.array(x)\n\n        # Temperature-dependent 'a' parameter for pure components\n        Tr = T / Tc\n        alpha = (1 + kappa * (1 - np.sqrt(Tr)))**2\n        a_i_T = a_c * alpha\n\n        # Mixture 'a' and 'b' parameters using classical mixing rules\n        a_ij = np.outer(a_i_T, a_i_T)**0.5 * (1 - kij)\n        a_mix = x @ a_ij @ x\n        b_mix = x @ b_i\n\n        # Dimensionless PR parameters A and B\n        A = a_mix * P / (R * T)**2\n        B = b_mix * P / (R * T)\n\n        # Solve cubic equation for Z\n        coeffs = [1, -(1 - B), (A - 2 * B - 3 * B**2), -(A * B - B**2 - B**3)]\n        roots = np.roots(coeffs)\n        real_roots = roots[np.isreal(roots)].real\n        \n        # Select the vapor-like root (largest real root)\n        Z = np.max(real_roots) if len(real_roots) > 0 else -1\n        if Z = 0: # Physicality check\n            return None\n\n        # Fugacity coefficient calculation\n        # Sum term for ln(phi)\n        sum_a_ij_xj = a_ij @ x\n\n        term1 = b_i / b_mix * (Z - 1)\n        term2 = -np.log(Z - B) # Scipy uses natural log\n        \n        # Avoid division by zero if B is very small\n        if np.abs(B)  1e-12:\n           log_term_val = 0\n        else:\n           log_term_val = np.log((Z + (1 + np.sqrt(2)) * B) / (Z + (1 - np.sqrt(2)) * B))\n\n        term3_factor = A / (2 * np.sqrt(2) * B) if np.abs(B) > 1e-12 else 0\n        term3_inner = (2 * sum_a_ij_xj / a_mix) - (b_i / b_mix)\n        term3 = -term3_factor * term3_inner * log_term_val\n        \n        ln_phi = term1 + term2 + term3\n\n        return {'A': A, 'B': B, 'Z': Z, 'ln_phi': ln_phi}\n\n    def tpd_objective_function(X_vars, d_i_feed, T, P):\n        \"\"\"\n        Objective function for TPD minimization.\n        X_vars: Unconstrained variables for trial composition y.\n        d_i_feed: ln(z_i) + ln(phi_i(z)) for the feed phase.\n        T, P: Temperature and Pressure.\n        \"\"\"\n        # Transform unconstrained variables X to mole fractions y via softmax\n        X_full = np.append(X_vars, 0.0)\n        exp_X = np.exp(X_full)\n        y = exp_X / np.sum(exp_X)\n\n        # Handle cases where y has components very close to zero\n        if np.any(y  1e-12):\n            return 1e6 # Return a large number to steer optimizer away\n\n        # Calculate properties of the trial phase y\n        props_y = get_eos_properties(T, P, y)\n        if props_y is None:\n            return 1e6 # Return a large number if phase is non-physical\n\n        ln_phi_y = props_y['ln_phi']\n        \n        # Calculate TPD value\n        tpd = np.sum(y * (np.log(y) + ln_phi_y - d_i_feed))\n        return tpd\n\n    results = []\n    # Main loop over test cases\n    for T, P, z in test_cases:\n        # 1. Characterize the feed phase\n        props_z = get_eos_properties(T, P, z)\n        if props_z is None:\n            # Should not happen for given test cases\n            results.append(np.nan)\n            continue\n        \n        ln_phi_z = props_z['ln_phi']\n        d_i_feed = np.log(z) + ln_phi_z\n\n        # 2. Minimize the TPD function\n        min_tpd_found = 0.0\n        \n        # Initial guesses for unconstrained variables X, corresponding to\n        # trial compositions y near pure components.\n        # For 3 components, we have 2 variables X1, X2.\n        # X3 is fixed to 0.\n        # y1 ~ exp(X1), y2 ~ exp(X2), y3 ~ exp(0)=1\n        initial_guesses = [\n            np.array([10.0, 0.0]),      # Near component 1 (Methane)\n            np.array([0.0, 10.0]),      # Near component 2 (Ethane)\n            np.array([-10.0, -10.0]), # Near component 3 (Propane)\n        ]\n\n        for x0 in initial_guesses:\n            res = optimize.minimize(\n                tpd_objective_function,\n                x0,\n                args=(d_i_feed, T, P),\n                method='BFGS',\n                tol=1e-9\n            )\n            # TPD is by definition >= 0 for a stable phase, and its minimum at y=z is 0.\n            # We seek a negative minimum. res.fun can be a very small positive number\n            # due to numerical precision, which should be treated as zero.\n            if res.fun  min_tpd_found:\n                min_tpd_found = res.fun\n        \n        # Round very small positive values to 0 for stability\n        if min_tpd_found > -1e-9:\n             min_tpd_found = 0.0\n\n        results.append(min_tpd_found)\n\n    # Format and print the final results\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}