{
    "hands_on_practices": [
        {
            "introduction": "A deep understanding of fin performance begins with the analytical treatment of idealized cases. This practice guides you through the first-principles derivation of the fin efficiency for a straight fin with an insulated tip . Mastering this derivation solidifies your understanding of the governing differential equation and provides a vital benchmark solution against which numerical models are often validated.",
            "id": "3953420",
            "problem": "A straight longitudinal fin of uniform rectangular cross-section, thickness $t$ and width $w$, made of a solid with thermal conductivity $k$, is attached to a wall at $x=0$ and extends into a fluid at $x=L$. The wall at the fin base maintains a uniform temperature $T_{b}$, and the ambient fluid is at uniform temperature $T_{\\infty}$; assume $T_{b}  T_{\\infty}$. Heat transfer from the fin’s lateral surfaces to the fluid is by convection with a uniform heat transfer coefficient $h$. Neglect radiation. The tip at $x=L$ is perfectly insulated. Assume steady state, one-dimensional axial conduction in the fin, and uniform material properties. Let the perimeter of the fin’s cross-section be $P$ and the cross-sectional area be $A_{c}$, and define the excess temperature $\\theta(x) = T(x) - T_{\\infty}$.\n\nStarting only from Fourier’s law of heat conduction and Newton’s law of cooling, and using the insulated tip boundary condition $\\left.\\frac{d\\theta}{dx}\\right|_{x=L} = 0$ together with the base condition $\\theta(0) = \\theta_{b} = T_{b} - T_{\\infty}$, derive an analytic expression for the fin efficiency $\\eta_{f}$, defined as the ratio of the actual heat transferred by the fin to the hypothetical heat transfer if the entire fin lateral surface were maintained at the base excess temperature $\\theta_{b}$. Express your final answer solely as a function of the nondimensional group $mL$, where $m$ is the fin parameter formed from $h$, $P$, $k$, and $A_{c}$.\n\nYour final answer must be a single closed-form analytic expression in terms of $mL$. No numerical evaluation is required and no rounding is necessary. Since efficiency is dimensionless, do not include any units in your final expression.",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of heat transfer, well-posed with a clear differential equation and boundary conditions, and objectively stated with no ambiguities. We may proceed with the derivation.\n\nThe analysis begins by applying the principle of conservation of energy to a differential element of the fin of length $dx$ located at a distance $x$ from the base. In the steady state, the rate of heat conducted into the element at $x$ must equal the sum of the rate of heat conducted out of the element at $x+dx$ and the rate of heat convected from the surface of the element.\n$$ q_x = q_{x+dx} + dq_{\\text{conv}} $$\nHere, $q_x$ is the rate of heat conduction at location $x$, and $q_{x+dx}$ is the rate at $x+dx$. The term $dq_{\\text{conv}}$ is the rate of heat convection from the differential surface area $dA_s = P dx$, where $P$ is the perimeter of the fin's cross-section.\n\nAccording to Fourier's law of heat conduction, the heat flow rate is given by:\n$$ q_x = -kA_c \\frac{dT}{dx} $$\nwhere $k$ is the thermal conductivity and $A_c$ is the cross-sectional area. Since the excess temperature is defined as $\\theta(x) = T(x) - T_{\\infty}$, and $T_{\\infty}$ is a constant, we have $\\frac{d\\theta}{dx} = \\frac{dT}{dx}$. Thus, Fourier's law can be written in terms of $\\theta(x)$ as:\n$$ q_x = -kA_c \\frac{d\\theta}{dx} $$\nThe heat conducted out at $x+dx$ can be expressed using a first-order Taylor series expansion of $q_x$:\n$$ q_{x+dx} = q_x + \\frac{dq_x}{dx}dx $$\nAccording to Newton's law of cooling, the heat convected from the differential surface is:\n$$ dq_{\\text{conv}} = h(P dx)(T(x) - T_{\\infty}) = hP\\theta(x)dx $$\nwhere $h$ is the convective heat transfer coefficient.\n\nSubstituting these expressions into the energy balance equation gives:\n$$ q_x = \\left(q_x + \\frac{dq_x}{dx}dx\\right) + hP\\theta(x)dx $$\nThis simplifies to:\n$$ -\\frac{dq_x}{dx} - hP\\theta(x) = 0 $$\nNow, we substitute the expression for $q_x$ from Fourier's law:\n$$ -\\frac{d}{dx}\\left(-kA_c \\frac{d\\theta}{dx}\\right) - hP\\theta(x) = 0 $$\nSince $k$ and $A_c$ are uniform, they can be taken out of the derivative, yielding the governing ordinary differential equation (ODE) for one-dimensional heat transfer in the fin:\n$$ kA_c \\frac{d^2\\theta}{dx^2} - hP\\theta(x) = 0 $$\nThis equation is conventionally written as:\n$$ \\frac{d^2\\theta}{dx^2} - m^2\\theta = 0 $$\nwhere $m$ is the fin parameter, defined as $m^2 = \\frac{hP}{kA_c}$, so $m = \\sqrt{\\frac{hP}{kA_c}}$.\n\nThis is a second-order, linear, homogeneous ODE. Its general solution can be expressed in terms of hyperbolic functions, which is convenient for the given boundary conditions:\n$$ \\theta(x) = C_1 \\cosh(mx) + C_2 \\sinh(mx) $$\nThe constants of integration, $C_1$ and $C_2$, are determined by applying the boundary conditions.\n\nThe first boundary condition (BC1) is at the fin tip, $x=L$, which is perfectly insulated. This means there is no heat flow, so the temperature gradient is zero:\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=L} = 0 $$\nFirst, we find the derivative of the general solution:\n$$ \\frac{d\\theta}{dx} = mC_1 \\sinh(mx) + mC_2 \\cosh(mx) $$\nApplying BC1 at $x=L$:\n$$ mC_1 \\sinh(mL) + mC_2 \\cosh(mL) = 0 $$\n$$ C_2 = -C_1 \\frac{\\sinh(mL)}{\\cosh(mL)} = -C_1 \\tanh(mL) $$\n\nThe second boundary condition (BC2) is at the fin base, $x=0$, where the temperature is specified as $T_b$. In terms of excess temperature:\n$$ \\theta(0) = T_b - T_{\\infty} = \\theta_b $$\nApplying BC2 to the general solution:\n$$ \\theta(0) = C_1 \\cosh(0) + C_2 \\sinh(0) = C_1(1) + C_2(0) = C_1 $$\nTherefore, $C_1 = \\theta_b$.\n\nSubstituting $C_1 = \\theta_b$ into the expression for $C_2$ gives $C_2 = -\\theta_b \\tanh(mL)$. The particular solution for the temperature distribution is:\n$$ \\theta(x) = \\theta_b \\cosh(mx) - \\theta_b \\tanh(mL) \\sinh(mx) $$\n$$ \\theta(x) = \\theta_b \\left( \\cosh(mx) - \\frac{\\sinh(mL)}{\\cosh(mL)}\\sinh(mx) \\right) = \\frac{\\theta_b}{\\cosh(mL)} \\left( \\cosh(mL)\\cosh(mx) - \\sinh(mL)\\sinh(mx) \\right) $$\nUsing the hyperbolic identity $\\cosh(A-B) = \\cosh(A)\\cosh(B) - \\sinh(A)\\sinh(B)$, the temperature distribution simplifies to:\n$$ \\theta(x) = \\frac{\\theta_b \\cosh(m(L-x))}{\\cosh(mL)} $$\n\nNext, we calculate the actual heat transferred by the fin, $q_f$. This is the heat conducted into the fin at its base, $x=0$:\n$$ q_f = q_{x=0} = -kA_c \\left.\\frac{d\\theta}{dx}\\right|_{x=0} $$\nThe derivative of the temperature distribution is:\n$$ \\frac{d\\theta}{dx} = \\frac{d}{dx}\\left( \\frac{\\theta_b \\cosh(m(L-x))}{\\cosh(mL)} \\right) = \\frac{\\theta_b}{\\cosh(mL)} [ \\sinh(m(L-x)) \\cdot (-m) ] = -\\frac{m\\theta_b \\sinh(m(L-x))}{\\cosh(mL)} $$\nEvaluating this derivative at $x=0$:\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=0} = -\\frac{m\\theta_b \\sinh(mL)}{\\cosh(mL)} = -m\\theta_b \\tanh(mL) $$\nSubstituting this back into the expression for $q_f$:\n$$ q_f = -kA_c(-m\\theta_b \\tanh(mL)) = kA_c m \\theta_b \\tanh(mL) $$\n\nThe fin efficiency, $\\eta_f$, is defined as the ratio of the actual heat transfer, $q_f$, to the maximum possible heat transfer, $q_{\\text{max}}$. The maximum heat transfer would occur if the entire fin surface were maintained at the base temperature, $T_b$. In this ideal case, heat would be transferred by convection from the total lateral surface area of the fin, $A_s = PL$, with a uniform temperature difference $\\theta_b$:\n$$ q_{\\text{max}} = h A_s \\theta_b = h(PL)\\theta_b $$\n\nNow, we can compute the efficiency:\n$$ \\eta_f = \\frac{q_f}{q_{\\text{max}}} = \\frac{kA_c m \\theta_b \\tanh(mL)}{hPL\\theta_b} $$\nThe $\\theta_b$ terms cancel. We are left with:\n$$ \\eta_f = \\frac{kA_c m \\tanh(mL)}{hPL} $$\nTo express this solely in terms of $mL$, we use the definition of $m^2 = \\frac{hP}{kA_c}$, which can be rearranged to $hP = kA_c m^2$. Substituting this for $hP$ in the denominator:\n$$ \\eta_f = \\frac{kA_c m \\tanh(mL)}{(kA_c m^2)L} $$\nCanceling the common term $kA_c$ and one factor of $m$:\n$$ \\eta_f = \\frac{\\tanh(mL)}{mL} $$\nThis expression gives the fin efficiency for a straight fin of uniform cross-section with an insulated tip, as a function of the dimensionless group $mL$, as required.",
            "answer": "$$ \\boxed{\\frac{\\tanh(mL)}{mL}} $$"
        },
        {
            "introduction": "While analytical solutions provide invaluable insight, computational methods are essential for analyzing complex, real-world fins. This exercise tasks you with developing a finite difference model for a steady-state fin, including the implementation of a convective tip boundary condition . The central goal is to perform a grid convergence study, allowing you to quantify the numerical error and appreciate the critical engineering practice of verification and validation (VV).",
            "id": "3953483",
            "problem": "Consider a straight, slender, one-dimensional fin of uniform cross-sectional area $A$ and perimeter $P$, made of a solid with thermal conductivity $k$, extending a length $L$ from a base at temperature $T_b$ into a fluid at ambient temperature $T_\\infty$. The lateral surface of the fin is exposed to a fluid with a uniform convective heat transfer coefficient $h$. The tip of the fin at $x=L$ is exposed to convection with coefficient $h_t$ over the tip area $A_t$. Define the excess temperature as $\\theta(x) = T(x) - T_\\infty$ and the base excess temperature $\\theta_b = T_b - T_\\infty$. Under steady-state conditions with negligible axial heat generation and constant properties, the fin is governed by a linear, second-order ordinary differential equation with a convective (Robin) boundary condition at the tip. The fin efficiency $\\eta_f$ is defined as the ratio of the total heat transfer rate from the fin to the hypothetical heat transfer rate if the entire fin were at the base excess temperature, i.e., $\\eta_f = q_f/\\left(h P L \\theta_b\\right)$, where $q_f$ is the actual heat transfer rate conducted at the base.\n\nYour task is to implement a finite difference scheme that:\n- Discretizes the governing ordinary differential equation on a uniform grid with spacing $\\Delta x$ using a second-order central difference approximation in the interior and a first-order one-sided difference for the convective tip boundary condition at $x=L$.\n- Enforces a Dirichlet boundary condition at the base $x=0$ with $\\theta(0)=\\theta_b$.\n- Computes the discrete temperature field, then computes the base heat rate $q_f$ using a second-order one-sided finite difference approximation of the derivative at $x=0$.\n- Computes the fin efficiency $\\eta_f$ from the discrete solution.\n\nTo quantify accuracy, you must also compute a reference value of $\\eta_f$ based on the exact closed-form solution of the governing linear ordinary differential equation with the same boundary conditions, and then evaluate the absolute relative error in $\\eta_f$ as a function of the grid spacing $\\Delta x$.\n\nUse the following constants and units:\n- Thermal conductivity $k$ in $\\mathrm{W/(m\\cdot K)}$.\n- Convective heat transfer coefficients $h$ and $h_t$ in $\\mathrm{W/(m^2\\cdot K)}$.\n- Geometric quantities $L$ in $\\mathrm{m}$, $A$ and $A_t$ in $\\mathrm{m^2}$, $P$ in $\\mathrm{m}$.\n- Temperatures in $\\mathrm{K}$; use a base excess temperature $\\theta_b = 1$ so that the fin efficiency remains dimensionless. Report errors as dimensionless decimal numbers.\n\nFor all test cases, use a uniform mesh with $N$ control volumes such that $\\Delta x = L/N$. For each case, evaluate the error at the set of grid spacings $\\left\\{\\Delta x_k\\right\\}$ corresponding to $N \\in \\{5, 10, 20, 40, 80\\}$, i.e., $\\Delta x_k = L/5$, $\\Delta x_k = L/10$, $\\Delta x_k = L/20$, $\\Delta x_k = L/40$, $\\Delta x_k = L/80$.\n\nImplement your program to compute, for each test case, the list of absolute relative errors $e_k = \\left|\\eta_f^{\\mathrm{FD}}(\\Delta x_k) - \\eta_f^{\\mathrm{exact}}\\right|/\\left|\\eta_f^{\\mathrm{exact}}\\right|$ for the prescribed $\\Delta x_k$, where $\\eta_f^{\\mathrm{FD}}$ is the finite difference estimate and $\\eta_f^{\\mathrm{exact}}$ is the value obtained from the exact continuous solution.\n\nUse the following four scientifically plausible and self-consistent test cases:\n\n- Case $1$ (moderate convection, aluminum-like conductivity): $L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n- Case $2$ (adiabatic tip idealization): $L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 0\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n- Case $3$ (strong convection, low conductivity): $L = 0.10\\,\\mathrm{m}$, $k = 15\\,\\mathrm{W/(m\\cdot K)}$, $h = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.06\\,\\mathrm{m}$, $h_t = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n- Case $4$ (short, highly conductive fin): $L = 0.01\\,\\mathrm{m}$, $k = 400\\,\\mathrm{W/(m\\cdot K)}$, $h = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 5.0\\times 10^{-5}\\,\\mathrm{m^2}$, $P = 0.03\\,\\mathrm{m}$, $h_t = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists, each inner list corresponding to one test case and containing the errors for the five prescribed $\\Delta x_k$, in the order $[L/5, L/10, L/20, L/40, L/80]$. The exact required output format is:\n- A single line with no additional text, containing a Python-like list-of-lists of floating-point numbers, for example: \"[[e_{1,1},e_{1,2},e_{1,3},e_{1,4},e_{1,5}],[e_{2,1},...,e_{2,5}],...]\" where each $e_{i,j}$ is a decimal number.",
            "solution": "### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Governing Physics**: Steady-state, one-dimensional heat transfer in a straight fin of uniform cross-sectional area $A$ and perimeter $P$.\n- **Material Property**: Thermal conductivity $k$.\n- **Convection**: Uniform convective heat transfer coefficient $h$ on lateral surfaces, and a coefficient $h_t$ on the tip area $A_t$.\n- **Temperatures**: Base temperature $T_b$, ambient fluid temperature $T_\\infty$.\n- **Definitions**:\n    - Excess temperature: $\\theta(x) = T(x) - T_\\infty$.\n    - Base excess temperature: $\\theta_b = T_b - T_\\infty$. For all calculations, $\\theta_b = 1$.\n    - Fin efficiency: $\\eta_f = q_f/\\left(h P L \\theta_b\\right)$, where $q_f$ is the heat transfer rate conducted at the base ($x=0$).\n- **Governing Equation**: The problem implies the standard fin equation: $k A \\frac{d^2T}{dx^2} - h P (T-T_\\infty) = 0$.\n- **Boundary Conditions (BCs)**:\n    - Base ($x=0$): Dirichlet BC, $\\theta(0) = \\theta_b$.\n    - Tip ($x=L$): Convective (Robin) BC, $-k A \\frac{dT}{dx}|_{x=L} = h_t A_t (T(L) - T_\\infty)$.\n- **Finite Difference Method (FDM) Specifications**:\n    - Grid: Uniform with $N$ control volumes, spacing $\\Delta x = L/N$.\n    - Interior nodes: Second-order central difference for the ODE.\n    - Tip BC ($x=L$): First-order one-sided difference.\n    - Base heat rate ($q_f$): Second-order one-sided finite difference for the derivative at $x=0$.\n- **Error Analysis**:\n    - Compute absolute relative error $e_k = \\left|\\eta_f^{\\mathrm{FD}}(\\Delta x_k) - \\eta_f^{\\mathrm{exact}}\\right|/\\left|\\eta_f^{\\mathrm{exact}}\\right|$.\n    - Evaluation points: $N \\in \\{5, 10, 20, 40, 80\\}$.\n- **Test Cases**:\n    - Case 1: $L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n    - Case 2: $L = 0.05\\,\\mathrm{m}$, $k = 205\\,\\mathrm{W/(m\\cdot K)}$, $h = 25\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.04\\,\\mathrm{m}$, $h_t = 0\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n    - Case 3: $L = 0.10\\,\\mathrm{m}$, $k = 15\\,\\mathrm{W/(m\\cdot K)}$, $h = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.06\\,\\mathrm{m}$, $h_t = 200\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n    - Case 4: $L = 0.01\\,\\mathrm{m}$, $k = 400\\,\\mathrm{W/(m\\cdot K)}$, $h = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A = 5.0\\times 10^{-5}\\,\\mathrm{m^2}$, $P = 0.03\\,\\mathrm{m}$, $h_t = 10\\,\\mathrm{W/(m^2\\cdot K)}$, $A_t = A$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is a standard exercise in computational heat transfer, specifically the numerical solution and analysis of a fin problem.\n- **Scientifically Grounded**: The problem is based on the fundamental principles of steady-state heat conduction and convection, described by a well-established second-order ordinary differential equation (the fin equation). The physical parameters provided for the test cases are realistic for common engineering materials (e.g., aluminum, copper) and convection scenarios. The definitions are standard in the field of heat transfer.\n- **Well-Posed**: The problem describes a linear, second-order ODE with two boundary conditions (one Dirichlet at the base, one Robin at the tip). This constitutes a well-posed boundary value problem, for which a unique, stable, and meaningful analytical solution exists. The numerical task is also well-posed; the specified finite difference scheme leads to a system of linear equations that is non-singular and solvable.\n- **Objective**: The problem is stated in precise, objective, and quantitative terms. All parameters, methods, and evaluation criteria are explicitly defined, leaving no room for subjective interpretation.\n- **Completeness and Consistency**: All necessary data for both the analytical solution and the numerical implementation are provided. The units are consistent. The structure of the numerical scheme is fully specified. The problem is self-contained and free of contradictions. The observation that fin efficiency $\\eta_f$ can exceed $1$ is a valid consequence of the provided definition $\\eta_f = q_f/\\left(h P L \\theta_b\\right)$, which defines the ideal heat transfer based only on the lateral fin area, while the actual heat transfer $q_f$ includes contributions from both the lateral area and the tip area.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. It is scientifically sound, well-posed, complete, and objective. The task is a rigorous and standard verification and validation exercise in computational thermal engineering. We proceed to the solution.\n\n### Principle-Based Solution Design\n\nThe solution involves both an analytical derivation for a reference value and a numerical implementation based on the finite difference method, as specified.\n\n**1. Analytical Solution**\n\nThe governing equation for the excess temperature $\\theta(x) = T(x) - T_\\infty$ in a fin with uniform properties is:\n$$ \\frac{d^2\\theta}{dx^2} - m^2 \\theta = 0 $$\nwhere the fin parameter $m$ is defined as $m = \\sqrt{\\frac{hP}{kA}}$. The boundary conditions in terms of $\\theta$ are:\n1. Base ($x=0$): $\\theta(0) = \\theta_b$\n2. Tip ($x=L$): Heat conduction to the tip equals convection from the tip. With $A_t=A$, this is $-k A \\frac{d\\theta}{dx}|_{L} = h_t A \\theta(L)$, which simplifies to $\\frac{d\\theta}{dx}|_{L} + \\frac{h_t}{k} \\theta(L) = 0$.\n\nThe general solution to the ODE is $\\theta(x) = C_1 \\cosh(m(L-x)) + C_2 \\sinh(m(L-x))$. Applying the boundary conditions allows us to solve for the constants, yielding the standard solution for the temperature distribution.\n\nThe heat transfer rate at the base is given by Fourier's law: $q_f = -kA \\frac{d\\theta}{dx}|_{x=0}$. Differentiating the general solution and applying the boundary conditions yields the well-known expression for the heat rate from a fin with a convective tip:\n$$ q_f = \\sqrt{hPkA} \\theta_b \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\nThe fin efficiency, $\\eta_f$, is defined as the ratio of this actual heat transfer rate to the ideal rate if the entire lateral surface were at the base temperature, $q_{ideal} = hPL\\theta_b$.\n$$ \\eta_f^{\\mathrm{exact}} = \\frac{q_f}{hPL\\theta_b} = \\frac{\\sqrt{hPkA}}{hPL} \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\nSince $m = \\sqrt{hP/kA}$, the pre-factor simplifies: $\\frac{\\sqrt{hPkA}}{hPL} = \\frac{m k A}{hPL} = \\frac{m k A}{(m^2 k A) L} = \\frac{1}{mL}$. Thus, the exact efficiency is:\n$$ \\eta_f^{\\mathrm{exact}} = \\frac{1}{mL} \\frac{\\sinh(mL) + (h_t/mk) \\cosh(mL)}{\\cosh(mL) + (h_t/mk) \\sinh(mL)} $$\nFor the special case of an adiabatic tip ($h_t=0$), this simplifies to the classic result $\\eta_f^{\\mathrm{exact}} = \\frac{\\tanh(mL)}{mL}$.\n\n**2. Finite Difference Formulation**\n\nThe fin domain of length $L$ is discretized into $N$ uniform segments of length $\\Delta x = L/N$, creating $N+1$ nodes indexed $i = 0, 1, \\dots, N$. Let $\\theta_i$ be the numerical approximation of $\\theta(x_i)$.\n\n- **Interior Nodes ($i=1, \\dots, N-1$)**: The ODE $\\frac{d^2\\theta}{dx^2} - m^2 \\theta = 0$ is discretized using a second-order central difference for the second derivative:\n$$ \\frac{\\theta_{i-1} - 2\\theta_i + \\theta_{i+1}}{(\\Delta x)^2} - m^2 \\theta_i = 0 $$\nRearranging gives a linear algebraic equation for each interior node:\n$$ \\theta_{i-1} - (2 + m^2(\\Delta x)^2) \\theta_i + \\theta_{i+1} = 0 $$\n\n- **Boundary Nodes**:\n    - **Base ($i=0$)**: The Dirichlet condition is applied directly: $\\theta_0 = \\theta_b$. Since $\\theta_b=1$ is specified, $\\theta_0=1$. This value is substituted into the equation for node $i=1$.\n    - **Tip ($i=N$)**: The Robin BC $\\frac{d\\theta}{dx}|_{L} + \\frac{h_t}{k} \\theta(L) = 0$ is discretized using a first-order backward difference for the derivative, as specified:\n    $$ \\frac{\\theta_N - \\theta_{N-1}}{\\Delta x} + \\frac{h_t}{k} \\theta_N = 0 $$\n    Rearranging gives the final equation of the system:\n    $$ -\\theta_{N-1} + \\left(1 + \\frac{h_t \\Delta x}{k}\\right) \\theta_N = 0 $$\n\nThis formulation results in a system of $N$ linear equations for the $N$ unknown temperatures $\\theta_1, \\dots, \\theta_N$. In matrix form, $\\mathbf{M}\\vec{\\theta} = \\vec{b}$, where $\\vec{\\theta} = [\\theta_1, \\dots, \\theta_N]^T$, $\\mathbf{M}$ is an $N \\times N$ tridiagonal matrix, and $\\vec{b}$ is a vector representing the boundary condition contribution. Specifically:\n$$\n\\mathbf{M} = \n\\begin{pmatrix}\n-(2+c)  1  0  \\cdots  0 \\\\\n1  -(2+c)  1  \\cdots  0 \\\\\n\\vdots  \\ddots  \\ddots  \\ddots  \\vdots \\\\\n0  \\cdots  1  -(2+c)  1 \\\\\n0  \\cdots  0  -1  1+d\n\\end{pmatrix}, \\quad\n\\vec{b} = \n\\begin{pmatrix}\n-\\theta_b \\\\ 0 \\\\ \\vdots \\\\ 0 \\\\ 0\n\\end{pmatrix}\n$$\nwhere $c = m^2(\\Delta x)^2$ and $d = \\frac{h_t \\Delta x}{k}$. This system can be solved efficiently to find the discrete temperature field $\\theta_i$.\n\n**3. Numerical Fin Efficiency and Error Calculation**\n\nThe base heat rate $q_f$ is computed using the specified second-order forward difference formula for the derivative at $x=0$:\n$$ \\left.\\frac{d\\theta}{dx}\\right|_{x=0} \\approx \\frac{-3\\theta_0 + 4\\theta_1 - \\theta_2}{2\\Delta x} $$\nThe numerical heat rate is then:\n$$ q_f^{\\mathrm{FD}} = -kA \\left( \\frac{-3\\theta_0 + 4\\theta_1 - \\theta_2}{2\\Delta x} \\right) $$\nThe numerical fin efficiency is calculated using the given definition:\n$$ \\eta_f^{\\mathrm{FD}} = \\frac{q_f^{\\mathrm{FD}}}{hPL\\theta_b} $$\nWith $\\theta_0=\\theta_b=1$, this becomes:\n$$ \\eta_f^{\\mathrm{FD}} = \\frac{-kA(-3 + 4\\theta_1 - \\theta_2)}{2hPL\\Delta x} $$\n\nFinally, for each grid resolution $N$, the absolute relative error $e$ is computed by comparing the numerical result to the exact solution:\n$$ e = \\frac{\\left|\\eta_f^{\\mathrm{FD}} - \\eta_f^{\\mathrm{exact}}\\right|}{\\left|\\eta_f^{\\mathrm{exact}}\\right|} $$\n\nThe overall algorithm consists of iterating through each set of physical parameters (test cases) and for each case, iterating through the prescribed grid resolutions $N$, calculating and storing the error $e$ at each step.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the fin heat transfer problem for four test cases, calculating the\n    absolute relative error in fin efficiency for a series of grid refinements.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (moderate convection, aluminum-like conductivity)\n        # L, k, h, A, P, h_t, A_t\n        (0.05, 205.0, 25.0, 1.0e-4, 0.04, 25.0, 1.0e-4),\n        # Case 2 (adiabatic tip idealization)\n        (0.05, 205.0, 25.0, 1.0e-4, 0.04, 0.0, 1.0e-4),\n        # Case 3 (strong convection, low conductivity)\n        (0.10, 15.0, 200.0, 2.0e-4, 0.06, 200.0, 2.0e-4),\n        # Case 4 (short, highly conductive fin)\n        (0.01, 400.0, 10.0, 5.0e-5, 0.03, 10.0, 5.0e-5),\n    ]\n\n    N_values = [5, 10, 20, 40, 80]\n    all_results = []\n\n    for case_params in test_cases:\n        L, k, h, A, P, h_t, A_t = case_params\n        case_errors = calculate_errors_for_case(L, k, h, A, P, h_t, A_t, N_values)\n        all_results.append(case_errors)\n\n    # Format the output as a string representing a list of lists.\n    list_of_strings = []\n    for inner_list in all_results:\n        inner_list_str = [f\"{num:.10e}\" for num in inner_list]\n        list_of_strings.append(f\"[{','.join(inner_list_str)}]\")\n    final_output = f\"[{','.join(list_of_strings)}]\"\n    print(final_output)\n\n\ndef calculate_errors_for_case(L, k, h, A, P, h_t, A_t, N_values):\n    \"\"\"\n    For a single test case, computes the fin efficiency error for each grid size.\n    \"\"\"\n    theta_b = 1.0\n    errors = []\n\n    # 1. Calculate the exact fin efficiency for the given parameters.\n    # This value is constant for the case.\n    if k * A == 0:\n        return [np.nan] * len(N_values)\n    m = np.sqrt((h * P) / (k * A))\n    mL = m * L\n\n    if mL == 0:\n        eta_f_exact = 1.0\n    else:\n        if h_t == 0: # Adiabatic tip special case\n            eta_f_exact = np.tanh(mL) / mL\n        else: # General convective tip case (A_t = A is assumed)\n            term = h_t / (m * k)\n            numerator = np.sinh(mL) + term * np.cosh(mL)\n            denominator = np.cosh(mL) + term * np.sinh(mL)\n            eta_f_exact = (1.0 / mL) * (numerator / denominator)\n\n    for N in N_values:\n        delta_x = L / N\n\n        # 2. Set up and solve the finite difference linear system M*theta = b\n        M = np.zeros((N, N))\n        b = np.zeros(N)\n\n        # Tridiagonal matrix coefficients for interior nodes\n        m_sq_dx_sq = m**2 * delta_x**2\n        diag_val = -(2.0 + m_sq_dx_sq)\n        \n        for i in range(N - 1):\n            if i > 0:\n                M[i, i - 1] = 1.0  # Lower diagonal\n            M[i, i] = diag_val       # Main diagonal\n            M[i, i + 1] = 1.0  # Upper diagonal\n        \n        # First equation's RHS is modified by the base BC\n        b[0] = -theta_b\n        \n        # Last row of the matrix from the tip BC\n        # -theta_{N-1} + (1 + h_t*delta_x/k) * theta_N = 0\n        M[N - 1, N - 2] = -1.0\n        M[N - 1, N - 1] = 1.0 + (h_t * delta_x / k)\n        \n        theta_vec = np.linalg.solve(M, b)\n        \n        # 3. Calculate numerical fin efficiency from the discrete solution\n        theta_0 = theta_b\n        theta_1 = theta_vec[0]\n        theta_2 = theta_vec[1]\n        \n        # Base heat flux using 2nd-order forward difference for derivative\n        dtheta_dx_0 = (-3.0 * theta_0 + 4.0 * theta_1 - theta_2) / (2.0 * delta_x)\n        q_f_fd = -k * A * dtheta_dx_0\n        \n        # Ideal heat rate for the lateral surface\n        q_ideal = h * P * L * theta_b\n        \n        eta_f_fd = q_f_fd / q_ideal\n        \n        # 4. Compute and store the absolute relative error\n        if eta_f_exact == 0:\n            rel_error = np.abs(eta_f_fd)\n        else:\n            rel_error = np.abs(eta_f_fd - eta_f_exact) / np.abs(eta_f_exact)\n        \n        errors.append(rel_error)\n        \n    return errors\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "To fully capture the performance of thermal systems, we must often analyze their behavior over time. This advanced practice challenges you to model the transient response of a fin by formulating and implementing the Crank-Nicolson finite difference scheme . By deriving the implicit matrix system and handling a Robin boundary condition, you will gain hands-on experience with the powerful numerical techniques required for time-dependent heat transfer simulations.",
            "id": "3953813",
            "problem": "Consider a slender one-dimensional straight fin of length $L$ with constant cross-sectional area $A$ and perimeter $P$ made of a homogeneous material with thermal conductivity $k$, mass density $\\rho$, and specific heat capacity $c$. The lateral surface of the fin is exposed to a uniform ambient at temperature $T_{\\infty}$ with convection coefficient $h$. Let $\\theta(x,t) = T(x,t) - T_{\\infty}$ denote the excess temperature. Assume spatially uniform properties and negligible axial radiation. The energy conservation per unit length combined with Fourier’s law yields the transient fin equation\n$$\n\\rho c A \\frac{\\partial \\theta}{\\partial t} = k A \\frac{\\partial^2 \\theta}{\\partial x^2} - h P \\theta,\n$$\nfor $x \\in (0,L)$ and $t  0$. Define the thermal diffusivity $\\alpha = \\frac{k}{\\rho c}$ and the lateral convection sink coefficient $s = \\frac{h P}{\\rho c A}$ to write\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta.\n$$\nThe base of the fin at $x=0$ is maintained at a known excess temperature $\\theta(0,t) = \\theta_b$ for all $t \\ge 0$. The tip at $x=L$ exchanges heat through its end area $A_e$ with an ambient at temperature $T_{\\infty}$ via convection with coefficient $h_e$. The resulting Robin boundary condition (RBC) for the excess temperature is\n$$\n-k A \\frac{\\partial \\theta}{\\partial x}(L,t) = h_e A_e \\theta(L,t),\n$$\nwhich can be written as\n$$\n-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t), \\quad \\text{where} \\quad \\beta = \\frac{h_e A_e}{k A}.\n$$\nYou are to formulate a Crank-Nicolson (CN) finite difference scheme for one time step of this transient fin equation on a uniform grid and derive the associated linear algebraic system including the Robin tip boundary. Work from first principles by discretizing the spatial second derivative using central differences on a uniform mesh $x_i = i \\Delta x$ for $i = 0,1,\\dots,N$ with $\\Delta x = \\frac{L}{N}$, and discretize time using the CN method with time step $\\Delta t$. Treat the base boundary at $x_0 = 0$ as a Dirichlet condition with the known value $\\theta_b$, and enforce the Robin boundary at $x_N = L$ via a one-sided second-order accurate elimination of the ghost node consistent with the derivative boundary condition.\n\nTasks:\n- Starting from the finite difference approximations and the CN time discretization applied to $\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta$, derive the tridiagonal matrix system for the unknown vector $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_{N}^{n+1}]^{\\top}$ at the new time level $t^{n+1} = t^n + \\Delta t$, where the base node $\\theta_0$ is known and not included in the unknown vector. Explicitly state the coefficients of the matrix row for interior nodes $i=1,\\dots,N-1$, the modification for the first interior node $i=1$ due to the Dirichlet boundary, and the modification for the tip node $i=N$ due to the Robin boundary with parameter $\\beta$.\n- Provide the resulting right-hand side vector in terms of the known previous state $\\boldsymbol{\\theta}^{n} = [\\theta_1^{n}, \\theta_2^{n}, \\dots, \\theta_{N}^{n}]^{\\top}$, the Dirichlet boundary value $\\theta_b$, and the parameters $\\alpha$, $s$, $\\beta$, $\\Delta x$, and $\\Delta t$.\n\nYour program must implement the derived CN scheme to perform a single time step from $\\boldsymbol{\\theta}^{n}$ to $\\boldsymbol{\\theta}^{n+1}$ for each of the following test cases. In all cases, assume a spatially uniform initial excess temperature $\\theta(x,0) = \\theta_{\\text{init}}$ given below, and use a uniform spatial grid of $N+1$ points with $N$ interior intervals. Report the excess temperatures in kelvin at all grid points $x_i$ including the base, that is, output the list $[\\theta_0^{n+1}, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$ for each case. Express all temperatures in $\\mathrm{K}$ and time in $\\mathrm{s}$, and lengths in $\\mathrm{m}$.\n\nUse the following test suite of parameter values:\n- Case $1$ (general case, moderate lateral convection, moderate tip convection):\n  - $L = 0.05\\,\\mathrm{m}$, $N = 10$, $\\Delta t = 0.2\\,\\mathrm{s}$,\n  - $k = 205\\,\\mathrm{W/(m\\,K)}$, $\\rho = 2700\\,\\mathrm{kg/m^3}$, $c = 900\\,\\mathrm{J/(kg\\,K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.02\\,\\mathrm{m}$,\n  - $h = 55\\,\\mathrm{W/(m^2\\,K)}$, $h_e = 55\\,\\mathrm{W/(m^2\\,K)}$, $A_e = A$,\n  - $\\theta_b = 50\\,\\mathrm{K}$, $\\theta_{\\text{init}} = 0\\,\\mathrm{K}$.\n- Case $2$ (insulated tip, i.e., zero tip convection):\n  - $L = 0.05\\,\\mathrm{m}$, $N = 10$, $\\Delta t = 0.2\\,\\mathrm{s}$,\n  - $k = 205\\,\\mathrm{W/(m\\,K)}$, $\\rho = 2700\\,\\mathrm{kg/m^3}$, $c = 900\\,\\mathrm{J/(kg\\,K)}$, $A = 1.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.02\\,\\mathrm{m}$,\n  - $h = 55\\,\\mathrm{W/(m^2\\,K)}$, $h_e = 0\\,\\mathrm{W/(m^2\\,K)}$, $A_e = A$,\n  - $\\theta_b = 50\\,\\mathrm{K}$, $\\theta_{\\text{init}} = 0\\,\\mathrm{K}$.\n- Case $3$ (shorter fin, strong lateral and tip convection, different material):\n  - $L = 0.03\\,\\mathrm{m}$, $N = 6$, $\\Delta t = 0.01\\,\\mathrm{s}$,\n  - $k = 150\\,\\mathrm{W/(m\\,K)}$, $\\rho = 8000\\,\\mathrm{kg/m^3}$, $c = 500\\,\\mathrm{J/(kg\\,K)}$, $A = 2.0\\times 10^{-4}\\,\\mathrm{m^2}$, $P = 0.03\\,\\mathrm{m}$,\n  - $h = 250\\,\\mathrm{W/(m^2\\,K)}$, $h_e = 4000\\,\\mathrm{W/(m^2\\,K)}$, $A_e = A$,\n  - $\\theta_b = 20\\,\\mathrm{K}$, $\\theta_{\\text{init}} = 0\\,\\mathrm{K}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each list entry corresponds to one case and is itself a comma-separated list of the gridpoint temperatures at time $t^{n+1}$. For example, the output format must be\n$$\n[\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}],\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}],\\,[\\theta_0^{n+1},\\theta_1^{n+1},\\dots,\\theta_N^{n+1}]\\,].\n$$",
            "solution": "The user wants to solve a transient heat conduction problem for a one-dimensional fin using the Crank-Nicolson finite difference method.\n\n### 1. Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Governing Equation:** $\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta$ for $x \\in (0,L)$, $t  0$.\n- **Definitions:**\n    - Excess temperature: $\\theta(x,t) = T(x,t) - T_{\\infty}$.\n    - Thermal diffusivity: $\\alpha = \\frac{k}{\\rho c}$.\n    - Lateral convection sink coefficient: $s = \\frac{h P}{\\rho c A}$.\n- **Boundary Conditions:**\n    - Base (Dirichlet at $x=0$): $\\theta(0,t) = \\theta_b$ for $t \\ge 0$.\n    - Tip (Robin at $x=L$): $-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t)$, where $\\beta = \\frac{h_e A_e}{k A}$.\n- **Initial Condition:** Spatially uniform excess temperature $\\theta(x,0) = \\theta_{\\text{init}}$.\n- **Numerical Scheme:**\n    - Crank-Nicolson (CN) method for time discretization.\n    - Uniform spatial grid: $x_i = i \\Delta x$ for $i = 0, 1, \\dots, N$, with $\\Delta x = L/N$.\n    - Central difference for spatial second derivative.\n    - Second-order accurate one-sided elimination for the Robin boundary condition at the tip.\n- **Task:**\n    1.  Derive the tridiagonal matrix system for the unknown vector $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_{N}^{n+1}]^{\\top}$.\n    2.  Provide the expressions for the matrix coefficients and the right-hand side vector.\n    3.  Implement the scheme for a single time step and report the temperature distribution $[\\theta_0^{n+1}, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$ for three specific test cases.\n- **Test Cases:**\n    - **Case 1:** $L = 0.05$, $N = 10$, $\\Delta t = 0.2$, $k = 205$, $\\rho = 2700$, $c = 900$, $A = 10^{-4}$, $P = 0.02$, $h = 55$, $h_e = 55$, $A_e = A$, $\\theta_b = 50$, $\\theta_{\\text{init}} = 0$.\n    - **Case 2:** Same as Case 1 but with $h_e = 0$.\n    - **Case 3:** $L = 0.03$, $N = 6$, $\\Delta t = 0.01$, $k = 150$, $\\rho = 8000$, $c = 500$, $A = 2 \\times 10^{-4}$, $P = 0.03$, $h = 250$, $h_e = 4000$, $A_e = A$, $\\theta_b = 20$, $\\theta_{\\text{init}} = 0$.\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientifically Grounded:** The problem is based on the well-established one-dimensional transient fin equation, a standard model in heat transfer analysis derived from the principle of energy conservation and Fourier's law of conduction. The boundary conditions (Dirichlet and Robin) are physically realistic representations of common thermal conditions. All parameters are standard physical properties. The problem is free of pseudoscience and factually sound.\n- **Well-Posed:** The problem is a linear parabolic partial differential equation with well-defined initial and boundary conditions. This constitutes a well-posed initial-boundary value problem. The task of deriving and implementing a standard numerical method (Crank-Nicolson) for its solution is also well-posed.\n- **Objective:** The problem is stated using precise mathematical and physical terminology. The tasks are specific and quantitative. There are no subjective or opinion-based elements.\n- **Completeness and Consistency:** All necessary physical parameters, geometric dimensions, initial/boundary conditions, and numerical parameters are provided for each test case. The data is self-consistent and sufficient to formulate and solve the problem.\n- **Realism and Feasibility:** The values of thermal properties and dimensions correspond to realistic engineering materials (e.g., aluminum alloy in Case 1, steel/copper alloy in Case 3) and fin geometries. The specified numerical methods are standard and computationally feasible.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a scientifically sound, well-posed, and complete problem in computational heat transfer. I will proceed with the derivation and solution.\n\n### 2. Derivation of the Crank-Nicolson Scheme\n\nThe governing transient fin equation is:\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\n$$\nLet $\\theta_i^n \\approx \\theta(x_i, t^n)$ be the numerical approximation of the excess temperature at spatial grid point $x_i = i\\Delta x$ and time level $t^n = n\\Delta t$.\n\nThe Crank-Nicolson method approximates the time derivative with a forward difference centered at $t^{n+1/2}$, and averages the spatial terms over the time levels $n$ and $n+1$:\n$$\n\\frac{\\theta_i^{n+1} - \\theta_i^n}{\\Delta t} = \\frac{1}{2} \\left[ \\left(\\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\\right)\\right]_i^{n+1} + \\frac{1}{2} \\left[ \\left(\\alpha \\frac{\\partial^2 \\theta}{\\partial x^2} - s \\theta\\right)\\right]_i^{n}\n$$\nWe use a second-order central difference approximation for the spatial second derivative:\n$$\n\\frac{\\partial^2 \\theta}{\\partial x^2}\\bigg|_i \\approx \\frac{\\theta_{i-1} - 2\\theta_i + \\theta_{i+1}}{(\\Delta x)^2}\n$$\nSubstituting this into the Crank-Nicolson formula gives:\n$$\n\\frac{\\theta_i^{n+1} - \\theta_i^n}{\\Delta t} = \\frac{\\alpha}{2} \\left( \\frac{\\theta_{i-1}^{n+1} - 2\\theta_i^{n+1} + \\theta_{i+1}^{n+1}}{(\\Delta x)^2} + \\frac{\\theta_{i-1}^{n} - 2\\theta_i^{n} + \\theta_{i+1}^{n}}{(\\Delta x)^2} \\right) - \\frac{s}{2}(\\theta_i^{n+1} + \\theta_i^n)\n$$\nLet's define the diffusion number $r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}$. Multiplying by $\\Delta t$ and rearranging terms to group unknowns (at time level $n+1$) on the left-hand side (LHS) and knowns (at time level $n$) on the right-hand side (RHS), we get:\n$$\n-\\frac{r}{2}\\theta_{i-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_i^{n+1} - \\frac{r}{2}\\theta_{i+1}^{n+1} = \\frac{r}{2}\\theta_{i-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_i^{n} + \\frac{r}{2}\\theta_{i+1}^{n}\n$$\nThis equation is valid for the interior nodes $i = 1, 2, \\dots, N-1$. We must now incorporate the boundary conditions to modify the equations for nodes $i=1$ and $i=N$. The unknown vector is $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\theta_2^{n+1}, \\dots, \\theta_N^{n+1}]^{\\top}$.\n\n**Base Boundary Condition (Dirichlet at $i=0$):**\nThe base temperature is fixed: $\\theta(0, t) = \\theta_b$. In our discretized grid, this means $\\theta_0^n = \\theta_b$ for all $n \\ge 0$.\nFor the first interior node, $i=1$, the general equation is:\n$$\n-\\frac{r}{2}\\theta_{0}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = \\frac{r}{2}\\theta_{0}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}\n$$\nSince $\\theta_0^{n+1} = \\theta_0^n = \\theta_b$, we move the known terms involving $\\theta_0$ to the RHS:\n$$\n\\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = \\frac{r}{2}\\theta_b + \\frac{r}{2}\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}\n$$\nThe equation for the first unknown $\\theta_1^{n+1}$ is:\n$$\n\\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_1^{n+1} - \\frac{r}{2}\\theta_2^{n+1} = r\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^{n} + \\frac{r}{2}\\theta_2^{n}.\n$$\n\n**Tip Boundary Condition (Robin at $i=N$):**\nThe condition is $-\\frac{\\partial \\theta}{\\partial x}(L,t) = \\beta \\theta(L,t)$. We use a second-order accurate central difference for the derivative at $x_N=L$ by introducing a \"ghost\" node at $x_{N+1} = x_N + \\Delta x$.\n$$\n\\frac{\\partial \\theta}{\\partial x}\\bigg|_N \\approx \\frac{\\theta_{N+1} - \\theta_{N-1}}{2\\Delta x}\n$$\nSubstituting this into the Robin boundary condition yields:\n$$\n-\\left(\\frac{\\theta_{N+1} - \\theta_{N-1}}{2\\Delta x}\\right) = \\beta \\theta_N \\quad \\implies \\quad \\theta_{N+1} = \\theta_{N-1} - 2\\beta\\Delta x \\theta_N\n$$\nThis relation is used to eliminate the ghost node $\\theta_{N+1}$ from the general difference equation at $i=N$. We apply this at both time levels $n$ and $n+1$.\nThe equation for node $i=N$ is:\n$$\n-\\frac{r}{2}\\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_N^{n+1} - \\frac{r}{2}\\theta_{N+1}^{n+1} = \\frac{r}{2}\\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_N^{n} + \\frac{r}{2}\\theta_{N+1}^{n}\n$$\nSubstitute $\\theta_{N+1}^{n+1} = \\theta_{N-1}^{n+1} - 2\\beta\\Delta x \\theta_N^{n+1}$ on the LHS and $\\theta_{N+1}^{n} = \\theta_{N-1}^{n} - 2\\beta\\Delta x \\theta_N^{n}$ on the RHS:\nLHS: $-\\frac{r}{2}\\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2}\\right)\\theta_N^{n+1} - \\frac{r}{2}\\left(\\theta_{N-1}^{n+1} - 2\\beta\\Delta x \\theta_N^{n+1}\\right) = -r \\theta_{N-1}^{n+1} + \\left(1 + r + \\frac{s \\Delta t}{2} + r\\beta\\Delta x\\right)\\theta_N^{n+1}$\n\nRHS: $\\frac{r}{2}\\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_N^{n} + \\frac{r}{2}\\left(\\theta_{N-1}^{n} - 2\\beta\\Delta x \\theta_N^{n}\\right) = r \\theta_{N-1}^{n} + \\left(1 - r - \\frac{s \\Delta t}{2} - r\\beta\\Delta x\\right)\\theta_N^{n}$\n\n### 3. Tridiagonal System Summary\n\nWe have a linear system of $N$ equations for the $N$ unknowns $\\boldsymbol{\\theta}^{n+1} = [\\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]^{\\top}$ of the form $\\mathbf{M} \\boldsymbol{\\theta}^{n+1} = \\mathbf{d}$.\n\n**Matrix $\\mathbf{M}$ ($N \\times N$):**\nThis is a tridiagonal matrix with the following coefficients. Let the row index be $j \\in \\{1,\\dots,N\\}$.\n- **Sub-diagonal ($a_j$):**\n  - For $j = 2, \\dots, N-1$: $a_j = -\\frac{r}{2}$\n  - For $j = N$: $a_N = -r$\n- **Main diagonal ($b_j$):**\n  - For $j = 1, \\dots, N-1$: $b_j = 1 + r + \\frac{s \\Delta t}{2}$\n  - For $j = N$: $b_N = 1 + r + \\frac{s \\Delta t}{2} + r\\beta\\Delta x$\n- **Super-diagonal ($c_j$):**\n  - For $j = 1, \\dots, N-1$: $c_j = -\\frac{r}{2}$\n\n**Right-hand side vector $\\mathbf{d}$ (size $N$):**\nLet the component index be $j \\in \\{1,\\dots,N\\}$.\n- **First component ($d_1$):**\n  - $d_1 = r\\theta_b + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_1^n + \\frac{r}{2}\\theta_2^n$\n- **Interior components ($d_j$ for $j=2, \\dots, N-1$):**\n  - $d_j = \\frac{r}{2}\\theta_{j-1}^n + \\left(1 - r - \\frac{s \\Delta t}{2}\\right)\\theta_j^n + \\frac{r}{2}\\theta_{j+1}^n$\n- **Last component ($d_N$):**\n  - $d_N = r\\theta_{N-1}^n + \\left(1 - r - \\frac{s \\Delta t}{2} - r\\beta\\Delta x\\right)\\theta_N^n$\n\nThe solution for the temperatures at the new time step $t^{n+1}$ is found by setting up this system with the known values from time $t^n$ and solving for $\\boldsymbol{\\theta}^{n+1}$. The final temperature vector is then constructed by prepending the known base temperature $\\theta_b$ to the solution vector: $[\\theta_b, \\theta_1^{n+1}, \\dots, \\theta_N^{n+1}]$.",
            "answer": "```python\nimport numpy as np\n\ndef setup_and_solve_cn_step(params):\n    \"\"\"\n    Sets up and solves the Crank-Nicolson system for one time step.\n\n    Args:\n        params (dict): A dictionary containing all problem parameters.\n\n    Returns:\n        np.array: The temperature vector at the new time step, including the base.\n    \"\"\"\n    # Unpack parameters\n    L = params['L']\n    N = params['N']\n    dt = params['dt']\n    k = params['k']\n    rho = params['rho']\n    c = params['c']\n    A = params['A']\n    P = params['P']\n    h = params['h']\n    h_e = params['h_e']\n    A_e = params['A_e']\n    theta_b = params['theta_b']\n    theta_init = params['theta_init']\n    \n    # Calculate derived parameters\n    dx = L / N\n    alpha = k / (rho * c)\n    s = (h * P) / (rho * c * A)\n    beta = (h_e * A_e) / (k * A)\n    r = alpha * dt / (dx**2)\n\n    # Initial temperature vector theta^n for the single step calculation\n    # theta_n[0] is at x=0, theta_n[N] is at x=L\n    theta_n = np.full(N + 1, theta_init)\n    theta_n[0] = theta_b\n\n    # The vector of unknowns contains N elements: theta_{1} to theta_{N}\n    # We will construct an N x N matrix M and an N-element RHS vector d.\n    M = np.zeros((N, N))\n    d = np.zeros(N)\n\n    # --- Fill Matrix M (LHS coefficients) ---\n\n    # Main diagonal\n    diag_val = 1 + r + (s * dt / 2)\n    np.fill_diagonal(M, diag_val)\n    \n    # Sub-diagonal and Super-diagonal for interior nodes\n    sub_sup_val = -r / 2\n    if N > 1:\n        np.fill_diagonal(M[1:], sub_sup_val)  # Sub-diagonal\n        np.fill_diagonal(M[:, 1:], sub_sup_val) # Super-diagonal\n\n    # Modify last row for Robin BC at i=N\n    if N > 1:\n        M[N-1, N-2] = -r\n    M[N-1, N-1] = diag_val + r * beta * dx\n\n    # --- Fill RHS vector d ---\n\n    # First interior node (i=1)\n    # d[0] corresponds to the equation for theta_1\n    d[0] = r * theta_b + (1 - r - s * dt / 2) * theta_n[1]\n    if N > 1:\n        d[0] += (r / 2) * theta_n[2]\n\n    # Interior nodes (i=2 to N-1)\n    # d[j] corresponds to equation for theta_{j+1}\n    for j in range(1, N - 1):\n        d[j] = (r / 2) * theta_n[j] + \\\n               (1 - r - s * dt / 2) * theta_n[j+1] + \\\n               (r / 2) * theta_n[j+2]\n\n    # Last node (i=N)\n    # d[N-1] corresponds to equation for theta_N\n    if N > 1:\n        d[N-1] = r * theta_n[N-1] + \\\n                 (1 - r - s * dt / 2 - r * beta * dx) * theta_n[N]\n    else: # Case N=1\n        d[0] += (r * theta_n[0] + (1 - r - s * dt/2 - r*beta*dx) * theta_n[1]) - (1-r-s*dt/2)*theta_n[1]\n\n    # Solve the linear system M * theta_unknown_np1 = d\n    theta_unknown_np1 = np.linalg.solve(M, d)\n    \n    # Construct the full solution vector for t^{n+1}\n    theta_np1 = np.concatenate(([theta_b], theta_unknown_np1))\n\n    return theta_np1\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            'L': 0.05, 'N': 10, 'dt': 0.2,\n            'k': 205.0, 'rho': 2700.0, 'c': 900.0,\n            'A': 1.0e-4, 'P': 0.02, 'h': 55.0,\n            'h_e': 55.0, 'A_e': 1.0e-4,\n            'theta_b': 50.0, 'theta_init': 0.0\n        },\n        # Case 2\n        {\n            'L': 0.05, 'N': 10, 'dt': 0.2,\n            'k': 205.0, 'rho': 2700.0, 'c': 900.0,\n            'A': 1.0e-4, 'P': 0.02, 'h': 55.0,\n            'h_e': 0.0, 'A_e': 1.0e-4,\n            'theta_b': 50.0, 'theta_init': 0.0\n        },\n        # Case 3\n        {\n            'L': 0.03, 'N': 6, 'dt': 0.01,\n            'k': 150.0, 'rho': 8000.0, 'c': 500.0,\n            'A': 2.0e-4, 'P': 0.03, 'h': 250.0,\n            'h_e': 4000.0, 'A_e': 2.0e-4,\n            'theta_b': 20.0, 'theta_init': 0.0\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result_vector = setup_and_solve_cn_step(case_params)\n        # Format the result vector as a list of strings\n        result_str_list = [f\"{x:.10f}\" for x in result_vector]\n        results.append(f\"[{','.join(result_str_list)}]\")\n\n    # Print the final output in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}