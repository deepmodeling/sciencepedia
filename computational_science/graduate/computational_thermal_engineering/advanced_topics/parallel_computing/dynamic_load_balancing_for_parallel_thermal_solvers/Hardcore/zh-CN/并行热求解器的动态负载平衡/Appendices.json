{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最终目的是解决实际问题。在高性能计算领域，评估一项技术优化的最直接方式是衡量其对性能的实际影响。本实践旨在将动态负载均衡 (DLB) 的概念与可量化的性能指标联系起来。通过分析一组模拟真实场景的并行求解器运行时间数据，您将亲手计算并比较启用与禁用 DLB 时的强扩展效率，从而定量地评估 DLB 带来的性能提升 。这项练习将帮助您掌握评估并行计算策略有效性的基本方法。",
            "id": "3949367",
            "problem": "一个三维瞬态热传导求解器使用区域分解方法，在固定网格上推进一个显式时间步进格式。为了减轻每个子域中空间异构的计算工作量（这源于随温度变化的材料属性和自适应时间步长控制），该代码可选择性地激活动态负载平衡（DLB），该功能会周期性地对区域进行重新划分。考虑该求解器在禁用和启用DLB两种情况下，在相同硬件上进行的强扩展性实验。在单个进程上测得的墙上时钟时间为 $T(1) = 10240\\,\\mathrm{s}$；在单个进程上，DLB选项在功能上不起作用，且不引入任何开销，因此 $T(1)$ 对两种配置是相同的。\n\n在两种配置下，对进程数 $P \\in \\{8,16,32,64\\}$ 测量了多进程墙上时钟时间 $T(P)$ 如下：\n- 不使用DLB：$T(8)=1375\\,\\mathrm{s}$, $T(16)=770\\,\\mathrm{s}$, $T(32)=420\\,\\mathrm{s}$, $T(64)=240\\,\\mathrm{s}$。\n- 使用DLB：$T(8)=1300\\,\\mathrm{s}$, $T(16)=660\\,\\mathrm{s}$, $T(32)=345\\,\\mathrm{s}$, $T(64)=195\\,\\mathrm{s}$。\n\n从并行加速比 $S(P)$ 和强扩展性效率 $E(P)$ 的基本定义出发，计算在启用和禁用DLB时，每个所列进程数 $P$ 下的效率。将每个 $P$ 处的改进因子定义为 $I(P) = \\dfrac{E_{\\mathrm{DLB}}(P)}{E_{\\mathrm{no\\ DLB}}(P)}$。最后，将集合 $\\{8,16,32,64\\}$ 上的几何平均改进因子作为您的答案，以单个简化的精确解析表达式（无四舍五入）的形式报告。答案是无量纲的；不要包含任何单位。",
            "solution": "该问题要求计算一个与并行计算效率相关的改进因子的几何平均值。我们首先陈述基本定义。\n\n在 $P$ 个进程上的强扩展性并行加速比 $S(P)$ 定义为单个进程上的墙上时钟时间 $T(1)$ 与 $P$ 个进程上的墙上时钟时间 $T(P)$ 的比值。\n$$S(P) = \\frac{T(1)}{T(P)}$$\n相应的强扩展性效率 $E(P)$ 是每个进程的加速比。\n$$E(P) = \\frac{S(P)}{P} = \\frac{T(1)}{P \\cdot T(P)}$$\n问题考虑了两种配置：一种不使用动态负载平衡（DLB），用下标 'no DLB' 表示；另一种使用DLB，用下标 'DLB' 表示。单进程时间给定为 $T(1) = 10240\\,\\mathrm{s}$，并且对两种配置是相同的。\n\n每种配置的效率由下式给出：\n$$E_{\\mathrm{no\\ DLB}}(P) = \\frac{T(1)}{P \\cdot T_{\\mathrm{no\\ DLB}}(P)}$$\n$$E_{\\mathrm{DLB}}(P) = \\frac{T(1)}{P \\cdot T_{\\mathrm{DLB}}(P)}$$\n\n在给定进程数 $P$ 下的改进因子 $I(P)$ 定义为使用DLB的效率与不使用DLB的效率之比。\n$$I(P) = \\frac{E_{\\mathrm{DLB}}(P)}{E_{\\mathrm{no\\ DLB}}(P)}$$\n代入效率的表达式，我们发现改进因子可以简化为墙上时钟时间的比值：\n$$I(P) = \\frac{\\frac{T(1)}{P \\cdot T_{\\mathrm{DLB}}(P)}}{\\frac{T(1)}{P \\cdot T_{\\mathrm{no\\ DLB}}(P)}} = \\frac{T(1)}{P \\cdot T_{\\mathrm{DLB}}(P)} \\cdot \\frac{P \\cdot T_{\\mathrm{no\\ DLB}}(P)}{T(1)} = \\frac{T_{\\mathrm{no\\ DLB}}(P)}{T_{\\mathrm{DLB}}(P)}$$\n这个简化避免了在中间计算中使用 $T(1)$ 的需要。\n\n我们现在使用提供的时间测量值，为每个指定的进程数 $P \\in \\{8, 16, 32, 64\\}$ 计算改进因子 $I(P)$。\n\n对于 $P=8$：\n$T_{\\mathrm{no\\ DLB}}(8) = 1375\\,\\mathrm{s}$ 且 $T_{\\mathrm{DLB}}(8) = 1300\\,\\mathrm{s}$。\n$$I(8) = \\frac{1375}{1300} = \\frac{55 \\times 25}{52 \\times 25} = \\frac{55}{52}$$\n\n对于 $P=16$：\n$T_{\\mathrm{no\\ DLB}}(16) = 770\\,\\mathrm{s}$ 且 $T_{\\mathrm{DLB}}(16) = 660\\,\\mathrm{s}$。\n$$I(16) = \\frac{770}{660} = \\frac{77 \\times 10}{66 \\times 10} = \\frac{7 \\times 11}{6 \\times 11} = \\frac{7}{6}$$\n\n对于 $P=32$：\n$T_{\\mathrm{no\\ DLB}}(32) = 420\\,\\mathrm{s}$ 且 $T_{\\mathrm{DLB}}(32) = 345\\,\\mathrm{s}$。\n$$I(32) = \\frac{420}{345} = \\frac{28 \\times 15}{23 \\times 15} = \\frac{28}{23}$$\n\n对于 $P=64$：\n$T_{\\mathrm{no\\ DLB}}(64) = 240\\,\\mathrm{s}$ 且 $T_{\\mathrm{DLB}}(64) = 195\\,\\mathrm{s}$。\n$$I(64) = \\frac{240}{195} = \\frac{16 \\times 15}{13 \\times 15} = \\frac{16}{13}$$\n\n最后一步是计算这四个改进因子的几何平均值 $G$。$n$ 个数的几何平均值是它们乘积的 $n$ 次方根。这里，$n=4$。\n$$G = \\left( I(8) \\cdot I(16) \\cdot I(32) \\cdot I(64) \\right)^{\\frac{1}{4}}$$\n代入简化的分数值：\n$$G = \\left( \\frac{55}{52} \\cdot \\frac{7}{6} \\cdot \\frac{28}{23} \\cdot \\frac{16}{13} \\right)^{\\frac{1}{4}}$$\n为简化括号内的乘积，我们用各项的因子来表示它们，并尽可能地进行约分。\n$$G = \\left( \\frac{55 \\cdot 7 \\cdot 28 \\cdot 16}{52 \\cdot 6 \\cdot 23 \\cdot 13} \\right)^{\\frac{1}{4}}$$\n$$G = \\left( \\frac{(5 \\cdot 11) \\cdot 7 \\cdot (4 \\cdot 7) \\cdot 16}{(4 \\cdot 13) \\cdot (2 \\cdot 3) \\cdot 23 \\cdot 13} \\right)^{\\frac{1}{4}}$$\n约去分子和分母中的公因子 $4$：\n$$G = \\left( \\frac{5 \\cdot 11 \\cdot 7^2 \\cdot 16}{13 \\cdot (2 \\cdot 3) \\cdot 23 \\cdot 13} \\right)^{\\frac{1}{4}}$$\n从分子的 $16$ 和分母的 $6$ 中约去公因子 $2$：\n$$G = \\left( \\frac{5 \\cdot 11 \\cdot 7^2 \\cdot 8}{13^2 \\cdot 3 \\cdot 23} \\right)^{\\frac{1}{4}}$$\n现在，我们计算所得分数的分子和分母：\n分子 $= 5 \\cdot 11 \\cdot 7^2 \\cdot 8 = 55 \\cdot 49 \\cdot 8 = 2695 \\cdot 8 = 21560$。\n分母 $= 13^2 \\cdot 3 \\cdot 23 = 169 \\cdot 3 \\cdot 23 = 507 \\cdot 23 = 11661$。\n\n因此，几何平均值为：\n$$G = \\left( \\frac{21560}{11661} \\right)^{\\frac{1}{4}}$$\n分子的质因数分解为 $2^3 \\cdot 5 \\cdot 7^2 \\cdot 11$，分母的质因数分解为 $3 \\cdot 13^2 \\cdot 23$。由于简化分数中质因数的指数没有一个是 $4$ 的倍数，所以该表达式无法进一步简化。这就是最终的简化精确解析表达式。",
            "answer": "$$\\boxed{\\left(\\frac{21560}{11661}\\right)^{\\frac{1}{4}}}$$"
        },
        {
            "introduction": "在量化了动态负载均衡的性能优势之后，一个自然而然的问题是：求解器如何智能地判断 *何时* 需要触发重新分区？这个决策过程依赖于精确且鲁棒的负载不平衡度量标准。本实践将引导您深入探讨两种不同度量标准的设计原理——一种基于平均值，另一种基于中位数 。通过推导它们的数学表达式并分析其对计算时间异常值（outliers）的敏感性，您将理解在算法设计中选择合适度量标准的重要性，以及这种选择如何影响负载均衡策略的稳定性和有效性。",
            "id": "3949356",
            "problem": "一个使用区域分解的瞬态热传导求解器在消息传递接口（MPI）编程模型下于 $n$ 个进程上执行。每个全局迭代都包含在各个进程上的本地计算，然后进行一次栅栏同步的 halo 交换，因此每次迭代的墙上时钟时间受限于最慢的进程。令 $T_i$ 表示在给定的全局迭代中，进程 $i$ 的每次迭代墙上时钟时间。考虑以下两种用于指导动态负载均衡决策的不平衡度量：\n- 复合不平衡度量，定义为同步限制的迭代时间相对于各进程时间的算术平均值的相对超量。\n- 基于中位数的不平衡度量，定义为同步限制的迭代时间相对于各进程时间的样本中位数的相对超量。\n\n从算术平均值、样本中位数的定义以及在栅栏同步下迭代完工时间等于 $\\max_i(T_i)$ 这一事实出发，首先推导这两种度量关于 $\\{T_i\\}_{i=1}^n$ 的符号表达式。\n\n为了比较对离群值的敏感度，考虑一个单次迭代快照，其中 $n-1$ 个进程具有相同的时间 $\\tau$，且恰好有 1 个进程是离群值，其时间为 $a\\,\\tau$，其中 $a>1$, $\\tau>0$, 且 $n\\ge 3$。在此单离群值模型下：\n- 用 $a$、$n$ 和 $\\tau$ 符号化地表示这两种不平衡度量。\n- 将对离群值大小的敏感度定义为每个度量关于 $a$ 的导数。\n- 将敏感度比率 $S(a,n)$ 定义为复合不平衡度量的导数与基于中位数的度量的导数之比，两者均是关于 $a$ 的导数。\n\n以精确符号形式给出 $S(a,n)$ 的闭式表达式。不要进行近似。无需单位。",
            "solution": "首先验证问题是自洽的、有科学依据且良定的。所用术语是并行计算和性能分析领域的标准术语。前提条件在数学上是一致的，并且足以推导出唯一解。因此，我们开始求解。\n\n令 $n$ 为计算进程的数量，令 $\\{T_i\\}_{i=1}^n$ 为每个进程的每次迭代墙上时钟时间集合。\n\n同步限制的迭代时间（或称完工时间）由最慢的进程决定，因为所有进程都必须在栅栏处等待。其表达式为：\n$$T_{max} = \\max_i(T_i)$$\n\n各个进程时间的算术平均值定义为：\n$$\\bar{T} = \\frac{1}{n} \\sum_{i=1}^n T_i$$\n\n各个进程时间的样本中位数表示为：\n$$T_{med} = \\text{median}(\\{T_i\\}_{i=1}^n)$$\n\n复合不平衡度量 $I_C$ 定义为 $T_{max}$ 相对于 $\\bar{T}$ 的相对超量。其符号表达式为：\n$$I_C = \\frac{T_{max} - \\bar{T}}{\\bar{T}} = \\frac{T_{max}}{\\bar{T}} - 1$$\n\n基于中位数的不平衡度量 $I_M$ 定义为 $T_{max}$ 相对于 $T_{med}$ 的相对超量。其符号表达式为：\n$$I_M = \\frac{T_{max} - T_{med}}{T_{med}} = \\frac{T_{max}}{T_{med}} - 1$$\n\n现在我们应用单离群值模型。在此模型中，时间集合包含 $n-1$ 个时间相同的进程，其时间为 $\\tau > 0$，以及 1 个离群进程，其时间为 $a\\tau$，其中 $a > 1$。进程数量为 $n \\ge 3$。该时间集合实际上是 $\\{\\underbrace{\\tau, \\tau, \\dots, \\tau}_{n-1}, a\\tau\\}$。\n\n在此模型下，我们计算 $T_{max}$、$\\bar{T}$ 和 $T_{med}$。\n由于 $a > 1$，离群时间 $a\\tau$ 是集合中的最大值。因此，完工时间为：\n$$T_{max} = a\\tau$$\n\n算术平均值为：\n$$\\bar{T} = \\frac{(n-1)\\tau + a\\tau}{n} = \\frac{(n-1+a)\\tau}{n}$$\n\n必须确定时间集合 $\\{\\underbrace{\\tau, \\tau, \\dots, \\tau}_{n-1}, a\\tau\\}$ 的样本中位数。对于 $n \\ge 3$，排序后的列表开头至少有两个 $\\tau$。中位数是中间值。对于任何 $n \\ge 2$，这个特定集合的中位数是 $\\tau$。对于 $n=3$，集合是 $(\\tau, \\tau, a\\tau)$，中位数是 $\\tau$。对于 $n=4$，集合是 $(\\tau, \\tau, \\tau, a\\tau)$，中位数是中间两个元素的平均值，即 $\\frac{\\tau+\\tau}{2} = \\tau$。这对任何 $n \\ge 3$ 都成立。因此：\n$$T_{med} = \\tau$$\n\n现在我们可以用 $a$、$n$ 和 $\\tau$ 来表示不平衡度量 $I_C$ 和 $I_M$。\n对于复合度量 $I_C$：\n$$I_C(a, n) = \\frac{a\\tau}{\\frac{(n-1+a)\\tau}{n}} - 1 = \\frac{an}{a+n-1} - 1$$\n$$I_C(a, n) = \\frac{an - (a+n-1)}{a+n-1} = \\frac{an - a - n + 1}{a+n-1} = \\frac{a(n-1) - (n-1)}{a+n-1} = \\frac{(a-1)(n-1)}{a+n-1}$$\n注意 $I_C$ 与 $\\tau$ 无关。\n\n对于基于中位数的度量 $I_M$：\n$$I_M(a) = \\frac{a\\tau}{\\tau} - 1 = a - 1$$\n注意 $I_M$ 与 $n$ 和 $\\tau$ 均无关。\n\n接下来，我们通过求关于 $a$ 的导数来找到每个度量对离群值大小 $a$ 的敏感度。\n$I_C$ 的敏感度是 $\\frac{dI_C}{da}$。我们使用微分学的商法则 $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$，其中 $u(a) = (a-1)(n-1)$ 且 $v(a) = a+n-1$。\n关于 $a$ 的导数是 $\\frac{du}{da} = n-1$ 和 $\\frac{dv}{da} = 1$。\n$$\\frac{dI_C}{da} = \\frac{(n-1)(a+n-1) - (a-1)(n-1)(1)}{(a+n-1)^2}$$\n$$= \\frac{(n-1)[(a+n-1) - (a-1)]}{(a+n-1)^2}$$\n$$= \\frac{(n-1)[a+n-1-a+1]}{(a+n-1)^2} = \\frac{(n-1)n}{(a+n-1)^2}$$\n所以，复合度量的敏感度为：\n$$\\frac{dI_C}{da} = \\frac{n(n-1)}{(a+n-1)^2}$$\n\n$I_M$ 的敏感度为 $\\frac{dI_M}{da}$：\n$$\\frac{dI_M}{da} = \\frac{d}{da}(a-1) = 1$$\n\n最后，敏感度比率 $S(a,n)$ 是这两个导数的比值：\n$$S(a,n) = \\frac{\\frac{dI_C}{da}}{\\frac{dI_M}{da}} = \\frac{\\frac{n(n-1)}{(a+n-1)^2}}{1}$$\n$S(a,n)$ 的闭式表达式为：\n$$S(a,n) = \\frac{n(n-1)}{(a+n-1)^2}$$\n对于给定的约束条件 $a > 1$ 和 $n \\ge 3$，该表达式是良定的，因为分母恒为正。",
            "answer": "$$\\boxed{\\frac{n(n-1)}{(a+n-1)^2}}$$"
        },
        {
            "introduction": "动态负载均衡是提升并行效率的有力工具，但并非万能。当处理器数量持续增加时，通信开销的增长最终会抵消计算任务并行化带来的收益，这构成了可扩展性的根本瓶颈。本实践将通过构建一个综合性能模型，来揭示计算与通信之间的这一核心权衡关系 。您将使用经典的 LogP 模型来量化通信成本，并推导出在理想负载均衡条件下，决定最佳处理器数量 $P^{\\ast}$ 的解析表达式。这个练习将使您从更宏观的视角理解并行性能的极限，并将动态负载均衡置于整个可扩展性优化策略的正确位置。",
            "id": "3949313",
            "problem": "考虑一个用于三维热方程的显式瞬态热传导求解器，其控制方程是包含傅里叶传导的能量守恒方程：$\\rho c_{p} \\frac{\\partial T}{\\partial t} = \\nabla \\cdot (k \\nabla T)$，该方程在一个由 $N^{3}$ 个控制体组成的均匀立方网格上，使用 $7$ 点模板进行离散化。求解器通过对每个单元进行局部更新来推进一个时间步，并需要在 $\\pm x$、$\\pm y$ 和 $\\pm z$ 方向上进行宽度为一个单元的最近邻光环交换（halo exchange），以维持子域边界上模板的一致性。\n\n计算域是一个立方体，通过规则的 $P^{1/3} \\times P^{1/3} \\times P^{1/3}$ 分区被分解为 $P$ 个等体积的子域，其中 $P^{1/3}$ 为整数。采用动态负载均衡来维持每个子域的计算工作量相等；假设负载在任何时候都是完全平衡的。每个时间步与 $6$ 个面相邻的邻居各执行一次邻居光环交换。此外，在每个时间步结束时，通过二叉树全局归约（all-reduce）在所有子域上聚合一个标量“负载”度量，以决定是否更新分区权重；假设这个全局聚合在每个时间步都发生，并且其延迟主导了任何实际的数据迁移。\n\n并行通信性能由 Latency–overhead–gap–processors (LogP) 模型来建模，其中 $L$ 是点对点延迟， $o$ 是每条消息的开销， $g$ 是消息间的最小注入间隔（间隙）， $P$ 是处理器数量。假设所有邻居消息和集体（collective）消息都足够小，以至于带宽效应可以忽略不计，并且消息时间由 $L$ 和 $o$ 主导，即每条小消息对每个参与者的成本为 $L + o$。进一步假设，邻居光环交换实现为每个时间步每个面一条小消息，并且二叉树全局归约使用 $\\log_{2}(P)$ 个向上归约阶段，随后是 $\\log_{2}(P)$ 个向下广播阶段，每个参与者在每个阶段发送一条小消息。\n\n设每个单元的计算时间为 $t_{c}$，因此一个包含 $\\frac{N^{3}}{P}$ 个单元的子域每个时间步的计算时间为 $t_{c} \\frac{N^{3}}{P}$。忽略计算和通信之间的任何重叠；每个子域每时间步的墙上时间（wall time）是计算时间和通信时间之和。\n\n使用这些假设，从第一性原理出发，推导出一个关于临界分区数 $P^{\\ast}$ 的解析表达式。当分区数 $P$ 超过 $P^{\\ast}$ 时，尽管计算负载完全平衡，每时间步的墙上时间仍会严格增加。您的推导必须从计算工作量随单元数的基本扩展关系和消息成本的 LogP 特征出发，并且必须清楚地说明三维分区中的邻居交换如何通过 $L$ 和 $o$ 对时间模型做出贡献。请仅用 $t_{c}$、$N$、$L$ 和 $o$ 提供您的最终答案，形式为单个封闭形式表达式。不需要进行数值评估。",
            "solution": "该问题要求推导临界分区数 $P^{\\ast}$ 的解析表达式，它代表了使每时间步墙上时间最小化的处理器数量。超过这个数量，墙上时间会严格增加。这个最小值源于随着处理器数量 $P$ 的增长，计算时间的减少与通信时间的增加之间的权衡。这是一个典型的强扩展（strong-scaling）分析。\n\n每时间步的总墙上时间 $T_{\\text{wall}}(P)$ 是计算时间和通信时间之和，因为忽略了重叠。\n$$T_{\\text{wall}}(P) = T_{\\text{compute}}(P) + T_{\\text{comm}}(P)$$\n\n首先，我们构建计算时间 $T_{\\text{compute}}(P)$ 的公式。\n计算域包含 $N^{3}$ 个单元。该域被分配给 $P$ 个处理器。问题陈述动态负载均衡确保负载完全平衡，意味着每个处理器负责相同数量的单元。\n因此，每个处理器的单元数为 $\\frac{N^3}{P}$。\n每个单元的计算时间为 $t_c$。\n因此，对于任何给定的处理器，每个时间步的计算时间是：\n$$T_{\\text{compute}}(P) = t_c \\frac{N^3}{P}$$\n此项表明，计算时间随处理器数量 $P$ 成双曲递减。\n\n接下来，我们构建通信时间 $T_{\\text{comm}}(P)$ 的公式。\n总通信时间是最近邻光环交换的时间与全局归约操作的时间之和。\n$$T_{\\text{comm}}(P) = T_{\\text{halo}}(P) + T_{\\text{allreduce}}(P)$$\n\n我们来分析光环交换时间 $T_{\\text{halo}}(P)$。\n计算域被分解为 $P^{1/3} \\times P^{1/3} \\times P^{1/3}$ 的子域网格。一个内部子域有 $6$ 个面相邻的邻居。需要与这些邻居进行通信来更新光环单元中的值，这对于在子域边界上进行 $7$ 点模板计算是必需的。问题陈述这涉及到每个时间步每个面一条小消息。单条小消息的成本为 $L+o$，其中 $L$ 是延迟， $o$ 是开销。由于假设消息大小足够小可以忽略带宽效应，这个成本与所交换的光环区域的大小无关。\n这些交换的总时间取决于所使用的协议（例如，沿每个维度顺序交换，或与所有邻居并行交换）。例如，一个沿 $\\pm x$，然后 $\\pm y$，再然后 $\\pm z$ 方向顺序交换数据的协议可能耗时 $3 \\times (L+o)$，假设每个维度的交换可以并行完成。如果所有 $6$ 次交换被视为独立的、不重叠的事件，成本可能是 $6 \\times (L+o)$。无论具体协议如何，内部处理器的邻居数量固定为 $6$，且与处理器总数 $P$ 无关。因此，在给定的小消息假设下，光环交换时间相对于 $P$ 是一个常数。我们用 $C_{\\text{halo}}$ 表示这个常数时间。\n$$T_{\\text{halo}}(P) = C_{\\text{halo}}$$\n由于此项是常数，它在对 $P$ 求导时会消失，因此不会影响 $T_{\\text{wall}}(P)$ 的最小值位置。\n\n现在，我们分析全局归约时间 $T_{\\text{allreduce}}(P)$。\n每个时间步都会执行一次全局归约操作，以聚合一个标量负载度量。这是使用二叉树算法实现的。在 $P$ 个处理器上的二叉树全局归约包含一个向上归约阶段和一个随后的向下广播阶段。\n归约阶段的级数为 $\\lceil\\log_2(P)\\rceil$。广播阶段的级数也是 $\\lceil\\log_2(P)\\rceil$。为了便于推导连续模型，我们将其近似为 $\\log_2(P)$。\n顺序执行的总级数是两个阶段的级数之和：$2\\log_2(P)$。\n每个阶段都涉及一组处理器向其在树中的父节点或子节点发送一条小消息。问题陈述每个参与者在每个阶段的成本是一条小消息的成本，即 $L+o$。\n由于这些阶段是顺序的（一个阶段只能在前一个阶段完成后才能开始），总时间是每个阶段的时间之和。\n$$T_{\\text{allreduce}}(P) = 2(L+o) \\log_2(P)$$\n此项表明，集体操作的通信时间随处理器数量 $P$ 成对数增长。\n\n现在我们可以组合出每时间步墙上时间的完整表达式：\n$$T_{\\text{wall}}(P) = T_{\\text{compute}}(P) + T_{\\text{halo}}(P) + T_{\\text{allreduce}}(P) = \\frac{t_c N^3}{P} + C_{\\text{halo}} + 2(L+o) \\log_2(P)$$\n\n为了找到使该墙上时间最小化的临界分区数 $P^{\\ast}$，我们将 $P$ 视为一个连续变量，并将 $T_{\\text{wall}}(P)$ 对 $P$ 的一阶导数设为零。为了便于求导，我们将以 $2$ 为底的对数转换为自然对数：$\\log_2(P) = \\frac{\\ln(P)}{\\ln(2)}$。\n$$T_{\\text{wall}}(P) = t_c N^3 P^{-1} + C_{\\text{halo}} + \\frac{2(L+o)}{\\ln(2)} \\ln(P)$$\n\n现在，我们计算导数：\n$$\\frac{d T_{\\text{wall}}}{d P} = \\frac{d}{d P} \\left( t_c N^3 P^{-1} + C_{\\text{halo}} + \\frac{2(L+o)}{\\ln(2)} \\ln(P) \\right)$$\n$$\\frac{d T_{\\text{wall}}}{d P} = -t_c N^3 P^{-2} + 0 + \\frac{2(L+o)}{\\ln(2)} \\frac{1}{P}$$\n\n将导数设为零以找到临界点 $P^{\\ast}$：\n$$-t_c N^3 (P^{\\ast})^{-2} + \\frac{2(L+o)}{\\ln(2)} (P^{\\ast})^{-1} = 0$$\n假设 $P^{\\ast} \\neq 0$，我们可以将方程两边乘以 $(P^{\\ast})^2$：\n$$-t_c N^3 + \\frac{2(L+o)}{\\ln(2)} P^{\\ast} = 0$$\n求解 $P^{\\ast}$：\n$$\\frac{2(L+o)}{\\ln(2)} P^{\\ast} = t_c N^3$$\n$$P^{\\ast} = \\frac{t_c N^3 \\ln(2)}{2(L+o)}$$\n\n为了确认这是一个最小值，我们可以检查二阶导数：\n$$\\frac{d^2 T_{\\text{wall}}}{d P^2} = \\frac{d}{d P} \\left( -t_c N^3 P^{-2} + \\frac{2(L+o)}{\\ln(2)} P^{-1} \\right) = 2 t_c N^3 P^{-3} - \\frac{2(L+o)}{\\ln(2)} P^{-2}$$\n在 $P=P^{\\ast}$ 处，我们知道 $t_c N^3 (P^{\\ast})^{-1} = \\frac{2(L+o)}{\\ln(2)}$。将此代入二阶导数表达式中：\n$$\\frac{d^2 T_{\\text{wall}}}{d P^2}\\bigg|_{P=P^{\\ast}} = 2 t_c N^3 (P^{\\ast})^{-3} - (t_c N^3 (P^{\\ast})^{-1}) (P^{\\ast})^{-2} = 2 t_c N^3 (P^{\\ast})^{-3} - t_c N^3 (P^{\\ast})^{-3} = t_c N^3 (P^{\\ast})^{-3}$$\n由于 $t_c$、$N$ 和 $P^{\\ast}$ 都是正量，二阶导数为正，这证实了 $P^{\\ast}$ 对应于墙上时间的最小值。这是最优的分区数；将 $P$ 增加到超过此值会导致通信成本超过计算节省的收益，从而增加总墙上时间。",
            "answer": "$$\\boxed{\\frac{t_c N^3 \\ln(2)}{2(L+o)}}$$"
        }
    ]
}