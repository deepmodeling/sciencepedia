{
    "hands_on_practices": [
        {
            "introduction": "Understanding the equilibrium state of a thermally coupled system is a foundational skill in Fluid-Structure Interaction (FSI) analysis. This first practice explores a steady-state benchmark problem where a solid's thermal expansion alters the geometry of an adjacent fluid layer, creating a direct feedback loop between the thermal and structural fields . By applying Fourier’s law and enforcing energy conservation, you will derive and solve the nonlinear equation governing the system's interface temperature, gaining hands-on experience with the core physics of thermal-structural coupling.",
            "id": "3954922",
            "problem": "Consider a one-dimensional, steady-state, thermally coupled Fluid–Structure Interaction (FSI) benchmark that captures the effect of thermal expansion of a solid plate on the heat transfer through an adjacent stagnant fluid layer. A flat solid plate of thickness $L_s$ and thermal conductivity $k_s$ separates a uniform hot source at temperature $T_{hot}$ from a stagnant fluid layer of initial thickness $L_{f0}$ and thermal conductivity $k_f$ that is exposed to an ambient temperature $T_{\\infty}$. The structural plate undergoes linear thermal expansion, and a fraction of this expansion protrudes into the fluid gap, reducing its effective thickness. Specifically, the interface temperature is $T_i$, and the structure's interface displacement into the fluid is modeled as $w = \\zeta \\alpha_s L_s (T_i - T_{ref})$, where $\\alpha_s$ is the solid’s coefficient of linear thermal expansion, $\\zeta \\in [0,1]$ is a dimensionless geometric factor representing the fraction of thickness expansion that moves the interface into the fluid, and $T_{ref}$ is a reference temperature. The effective fluid gap thickness is $L_f^{eff} = L_{f0} - w$, which must remain positive for physical feasibility. Heat transfer through the plate is by conduction, and heat transfer through the stagnant fluid layer is also assumed to be purely by conduction. The system reaches steady state when the conductive heat flux through the solid equals the conductive heat flux through the fluid.\n\nStarting from Fourier’s law of heat conduction and energy conservation at the interface, derive the nonlinear scalar equation for the interface temperature $T_i$ that enforces flux continuity between the solid and the fluid, and then solve it numerically. Use the following fundamental bases:\n- Fourier’s law of heat conduction: the heat flux through a homogeneous slab of thickness $L$ with thermal conductivity $k$ and temperatures $T_{1}$ and $T_{2}$ on its faces is $q'' = k \\dfrac{T_{1} - T_{2}}{L}$.\n- Energy conservation at the interface: the steady-state heat flux through the solid equals the steady-state heat flux through the fluid, so $q''_{solid} = q''_{fluid}$.\n- Linear thermal expansion for effective gap change: $w = \\zeta \\alpha_s L_s (T_i - T_{ref})$.\n\nYour task is to write a complete program that, for a set of test cases, solves for $T_i$ by finding a root of the flux balance equation, computes the corresponding steady-state heat flux $q''$, and computes the interface displacement $w$. Ensure that the effective gap thickness satisfies $L_f^{eff} = L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref}) > 0$ over the numerical bracket used in the root search. If the upper bound $T_{hot}$ would violate $L_f^{eff} > 0$, restrict the upper bound to $T_{upper} = T_{ref} + \\dfrac{L_{f0}}{\\zeta \\alpha_s L_s}$ (for $\\zeta \\alpha_s L_s > 0$) minus a small positive margin. Use a robust bracketing method.\n\nUse the following test suite with parameters expressed in International System of Units:\n- Case $1$ (moderate properties, nonzero coupling): $T_{hot} = 400\\,\\mathrm{K}$, $T_{\\infty} = 300\\,\\mathrm{K}$, $L_s = 0.01\\,\\mathrm{m}$, $L_{f0} = 0.005\\,\\mathrm{m}$, $k_s = 15\\,\\mathrm{W/(m\\cdot K)}$, $k_f = 0.6\\,\\mathrm{W/(m\\cdot K)}$, $\\alpha_s = 1.2\\times 10^{-5}\\,\\mathrm{K^{-1}}$, $\\zeta = 0.5$, $T_{ref} = 300\\,\\mathrm{K}$.\n- Case $2$ (decoupled boundary, stiff structure): $T_{hot} = 400\\,\\mathrm{K}$, $T_{\\infty} = 300\\,\\mathrm{K}$, $L_s = 0.01\\,\\mathrm{m}$, $L_{f0} = 0.005\\,\\mathrm{m}$, $k_s = 15\\,\\mathrm{W/(m\\cdot K)}$, $k_f = 0.6\\,\\mathrm{W/(m\\cdot K)}$, $\\alpha_s = 1.2\\times 10^{-5}\\,\\mathrm{K^{-1}}$, $\\zeta = 0$, $T_{ref} = 300\\,\\mathrm{K}$.\n- Case $3$ (high expansion fraction, thin fluid layer, low fluid conductivity): $T_{hot} = 500\\,\\mathrm{K}$, $T_{\\infty} = 300\\,\\mathrm{K}$, $L_s = 0.02\\,\\mathrm{m}$, $L_{f0} = 0.001\\,\\mathrm{m}$, $k_s = 30\\,\\mathrm{W/(m\\cdot K)}$, $k_f = 0.03\\,\\mathrm{W/(m\\cdot K)}$, $\\alpha_s = 5.0\\times 10^{-5}\\,\\mathrm{K^{-1}}$, $\\zeta = 0.9$, $T_{ref} = 300\\,\\mathrm{K}$.\n- Case $4$ (large gap, very low fluid conductivity): $T_{hot} = 350\\,\\mathrm{K}$, $T_{\\infty} = 300\\,\\mathrm{K}$, $L_s = 0.02\\,\\mathrm{m}$, $L_{f0} = 0.02\\,\\mathrm{m}$, $k_s = 200\\,\\mathrm{W/(m\\cdot K)}$, $k_f = 0.03\\,\\mathrm{W/(m\\cdot K)}$, $\\alpha_s = 1.0\\times 10^{-5}\\,\\mathrm{K^{-1}}$, $\\zeta = 0.7$, $T_{ref} = 300\\,\\mathrm{K}$.\n\nFor each test case, your program must compute and return the triplet $[T_i, q'', w]$. Use Kelvin for temperatures, meters for displacement, and watts per square meter for heat flux. All floating-point outputs must be rounded to six decimal places.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the three-value list $[T_i,q'',w]$ for one test case, in order from Case $1$ to Case $4$. For example, the output must look like $[[T_{i1},q''_1,w_1],[T_{i2},q''_2,w_2],[T_{i3},q''_3,w_3],[T_{i4},q''_4,w_4]]$ with no spaces anywhere in the line.",
            "solution": "The user-provided problem statement has been analyzed and validated.\n\n### Step 1: Extract Givens\n- **System**: A one-dimensional, steady-state, thermally coupled Fluid–Structure Interaction (FSI) system.\n- **Components**: A solid plate and a stagnant fluid layer.\n- **Temperatures**:\n    - Hot source temperature: $T_{hot}$\n    - Ambient temperature: $T_{\\infty}$\n    - Interface temperature: $T_i$\n    - Reference temperature for thermal expansion: $T_{ref}$\n- **Solid Plate Properties**:\n    - Thickness: $L_s$\n    - Thermal conductivity: $k_s$\n    - Coefficient of linear thermal expansion: $\\alpha_s$\n- **Fluid Layer Properties**:\n    - Initial thickness: $L_{f0}$\n    - Thermal conductivity: $k_f$\n- **Coupling Parameters**:\n    - Geometric factor for expansion protrusion: $\\zeta \\in [0, 1]$\n- **Governing Principles and Equations**:\n    1.  **Fourier's Law of Heat Conduction**: $q'' = k \\frac{T_1 - T_2}{L}$.\n    2.  **Energy Conservation**: At steady state, the heat flux through the solid equals the heat flux through the fluid: $q''_{solid} = q''_{fluid}$.\n    3.  **Interface Displacement**: The displacement of the solid-fluid interface due to thermal expansion is $w = \\zeta \\alpha_s L_s (T_i - T_{ref})$.\n    4.  **Effective Fluid Thickness**: The fluid thickness is reduced by the displacement: $L_f^{eff} = L_{f0} - w$.\n    5.  **Physical Constraint**: The effective fluid thickness must remain positive: $L_f^{eff} > 0$.\n- **Task**:\n    1.  Derive the nonlinear scalar equation for $T_i$.\n    2.  Solve for $T_i$ numerically using a robust bracketing method.\n    3.  Compute the steady-state heat flux $q''$ and interface displacement $w$.\n    4.  Handle the physical constraint $L_f^{eff} > 0$ by adjusting the numerical search bracket if necessary.\n- **Test Cases (in SI units)**:\n    - **Case 1**: $T_{hot} = 400$, $T_{\\infty} = 300$, $L_s = 0.01$, $L_{f0} = 0.005$, $k_s = 15$, $k_f = 0.6$, $\\alpha_s = 1.2 \\times 10^{-5}$, $\\zeta = 0.5$, $T_{ref} = 300$.\n    - **Case 2**: $T_{hot} = 400$, $T_{\\infty} = 300$, $L_s = 0.01$, $L_{f0} = 0.005$, $k_s = 15$, $k_f = 0.6$, $\\alpha_s = 1.2 \\times 10^{-5}$, $\\zeta = 0$, $T_{ref} = 300$.\n    - **Case 3**: $T_{hot} = 500$, $T_{\\infty} = 300$, $L_s = 0.02$, $L_{f0} = 0.001$, $k_s = 30$, $k_f = 0.03$, $\\alpha_s = 5.0 \\times 10^{-5}$, $\\zeta = 0.9$, $T_{ref} = 300$.\n    - **Case 4**: $T_{hot} = 350$, $T_{\\infty} = 300$, $L_s = 0.02$, $L_{f0} = 0.02$, $k_s = 200$, $k_f = 0.03$, $\\alpha_s = 1.0 \\times 10^{-5}$, $\\zeta = 0.7$, $T_{ref} = 300$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded**: The problem is based on fundamental principles of heat transfer (Fourier's Law) and solid mechanics (linear thermal expansion). The FSI coupling model is a valid and standard simplification used in engineering analysis. All principles are well-established.\n- **Well-Posed**: The problem is well-posed. It asks for the solution of a single nonlinear equation in a single unknown, $T_i$. It provides all necessary parameters and defines a clear physical constraint ($L_f^{eff} > 0$) along with a procedure to handle it, ensuring a unique and meaningful solution exists.\n- **Objective**: The problem is stated using precise, objective, and quantitative language. There are no subjective or opinion-based elements.\n- **No Flaws Detected**: The problem does not violate any of the invalidity criteria. It is scientifically sound, formally structured, complete, physically realistic, and well-posed.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution Derivation and Algorithmic Design\n\nThe solution proceeds by first deriving the governing nonlinear equation for the interface temperature $T_i$ and then outlining the numerical algorithm to solve it.\n\n**1. Derivation of the Governing Equation**\n\nThe system is in a steady state, meaning the heat flux is constant through both the solid and fluid layers.\n\nApplying Fourier's law of heat conduction to the solid plate, the heat flux $q''_{solid}$ from the hot source at $T_{hot}$ to the interface at $T_i$ is:\n$$ q''_{solid} = k_s \\frac{T_{hot} - T_i}{L_s} $$\n\nThe interface displacement, $w$, is a function of the interface temperature $T_i$:\n$$ w = \\zeta \\alpha_s L_s (T_i - T_{ref}) $$\n\nThis displacement reduces the thickness of the fluid layer. The effective fluid thickness, $L_f^{eff}$, is:\n$$ L_f^{eff} = L_{f0} - w = L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref}) $$\n\nApplying Fourier's law to the stagnant fluid layer, the heat flux $q''_{fluid}$ from the interface at $T_i$ to the ambient at $T_{\\infty}$ is:\n$$ q''_{fluid} = k_f \\frac{T_i - T_{\\infty}}{L_f^{eff}} = k_f \\frac{T_i - T_{\\infty}}{L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref})} $$\n\nEnergy conservation at the interface requires that the incoming and outgoing fluxes are equal: $q''_{solid} = q''_{fluid}$.\n$$ k_s \\frac{T_{hot} - T_i}{L_s} = k_f \\frac{T_i - T_{\\infty}}{L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref})} $$\n\nThis is the final nonlinear scalar equation for the unknown interface temperature $T_i$.\n\n**2. Numerical Solution Methodology**\n\nTo solve for $T_i$, we formulate a root-finding problem. We define a residual function $F(T_i)$ such that its root corresponds to the solution. Let $F(T_i) = q''_{solid} - q''_{fluid}$. The problem is to find $T_i$ such that $F(T_i) = 0$.\n$$ F(T_i) = k_s \\frac{T_{hot} - T_i}{L_s} - k_f \\frac{T_i - T_{\\infty}}{L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref})} = 0 $$\n\nA robust numerical method for finding a root of a single-variable nonlinear function is a bracketing method, such as the Brent-Dekker method (available in SciPy as `scipy.optimize.brentq`). This method requires an interval $[a, b]$ where $F(a)$ and $F(b)$ have opposite signs.\n\n**3. Determining the Search Bracket $[a, b]$**\n\n- **Lower Bound ($a$)**: A physical lower bound for the interface temperature is the ambient temperature, $T_{\\infty}$. Let's set $a = T_{\\infty}$. At this temperature, the flux through the fluid is zero, $q''_{fluid}=0$, while the flux through the solid is positive, $q''_{solid} > 0$ (since $T_{hot} > T_{\\infty}$). Therefore, $F(a) = F(T_{\\infty}) > 0$.\n\n- **Upper Bound ($b$)**: Two constraints apply to the upper bound of $T_i$:\n    1.  **Thermodynamic Limit**: $T_i$ cannot exceed the source temperature, $T_{hot}$. At $T_i = T_{hot}$, the solid flux $q''_{solid} = 0$, while the fluid flux $q''_{fluid} > 0$. Thus, $F(T_{hot}) < 0$.\n    2.  **Physical Limit**: The effective fluid thickness must remain positive: $L_f^{eff} > 0$. This implies $L_{f0} - \\zeta \\alpha_s L_s (T_i - T_{ref}) > 0$. If the coupling product $\\zeta \\alpha_s L_s$ is positive, this sets an upper limit on $T_i$:\n        $$ T_i < T_{ref} + \\frac{L_{f0}}{\\zeta \\alpha_s L_s} \\equiv T_{upper} $$\n        The function $F(T_i)$ has a vertical asymptote at $T_i = T_{upper}$, approaching $-\\infty$ as $T_i \\to T_{upper}$ from below.\n\nTo ensure a valid and physically meaningful search, the upper bound of the bracket, $b$, must be chosen as $b = \\min(T_{hot}, T_{upper} - \\epsilon)$, where $\\epsilon$ is a small positive margin to avoid the singularity at $T_{upper}$.\n\nWith $a = T_{\\infty}$ and $b = \\min(T_{hot}, T_{upper} - \\epsilon)$, we have $F(a) > 0$ and $F(b) < 0$, guaranteeing a unique root within the interval $[a, b]$ since $F(T_i)$ is continuous and monotonic in this range.\n\n**4. Algorithm**\n\nThe computational procedure for each test case is as follows:\n1.  Initialize all physical parameters: $T_{hot}$, $T_{\\infty}$, $L_s$, $L_{f0}$, $k_s$, $k_f$, $\\alpha_s$, $\\zeta$, and $T_{ref}$.\n2.  Define the residual function $F(T_i)$ as derived above.\n3.  Calculate the coupling product term $C = \\zeta \\alpha_s L_s$. If $C > 0$, compute the gap closure temperature limit $T_{upper}$.\n4.  Set the lower bound of the search bracket to $a = T_{\\infty}$.\n5.  Set the upper bound of the search bracket to $b = T_{hot}$. If $C > 0$, update the upper bound to $b = \\min(T_{hot}, T_{upper} - 10^{-9})$.\n6.  Use a numerical root-finder (e.g., `scipy.optimize.brentq`) to solve for $T_i$ in the interval $[a, b]$.\n7.  Once $T_i$ is found, calculate the steady-state heat flux $q'' = k_s \\frac{T_{hot} - T_i}{L_s}$ and the interface displacement $w = \\zeta \\alpha_s L_s (T_i - T_{ref})$.\n8.  Round the computed values of $T_i$, $q''$, and $w$ to six decimal places.\n9.  Store the resulting triplet $[T_i, q'', w]$.\n10. After processing all cases, format the collected results into the specified string format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves a set of 1D steady-state thermally coupled FSI problems.\n    For each case, it computes the interface temperature, heat flux,\n    and interface displacement.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: moderate properties, nonzero coupling\n        (400, 300, 0.01, 0.005, 15, 0.6, 1.2e-5, 0.5, 300),\n        # Case 2: decoupled boundary, stiff structure\n        (400, 300, 0.01, 0.005, 15, 0.6, 1.2e-5, 0, 300),\n        # Case 3: high expansion fraction, thin fluid layer, low fluid conductivity\n        (500, 300, 0.02, 0.001, 30, 0.03, 5.0e-5, 0.9, 300),\n        # Case 4: large gap, very low fluid conductivity\n        (350, 300, 0.02, 0.02, 200, 0.03, 1.0e-5, 0.7, 300),\n    ]\n\n    results = []\n    for case in test_cases:\n        T_hot, T_inf, L_s, L_f0, k_s, k_f, alpha_s, zeta, T_ref = case\n\n        def flux_balance(T_i):\n            \"\"\"\n            Residual function F(T_i) = q_solid - q_fluid.\n            The root of this function is the solution for the interface temperature.\n            \"\"\"\n            # Calculate displacement and effective fluid thickness\n            w = zeta * alpha_s * L_s * (T_i - T_ref)\n            L_f_eff = L_f0 - w\n\n            # Physically, L_f_eff must be positive. If the solver wanders\n            # into a region where L_f_eff <= 0, return a large value to repel it.\n            # This is a safeguard; the bracket should prevent this.\n            if L_f_eff <= 0:\n                return -np.inf\n\n            # Calculate heat fluxes\n            q_solid = k_s * (T_hot - T_i) / L_s\n            q_fluid = k_f * (T_i - T_inf) / L_f_eff\n            \n            return q_solid - q_fluid\n\n        # Set up the search bracket [a, b] for the root finder\n        # Lower bound is the ambient temperature\n        a = T_inf\n        # Upper bound is the hot source temperature\n        b = T_hot\n\n        # Adjust upper bound to prevent gap closure (L_f_eff <= 0)\n        coupling_term = zeta * alpha_s * L_s\n        if coupling_term > 0:\n            # Temperature at which the gap closes\n            T_upper_limit = T_ref + L_f0 / coupling_term\n            # Use a small margin as specified\n            margin = 1e-9\n            b = min(b, T_upper_limit - margin)\n\n        # Solve for the interface temperature T_i using Brent's method\n        T_i_sol = brentq(flux_balance, a, b, xtol=1e-12, rtol=1e-12)\n\n        # Calculate final displacement and heat flux with the solved T_i\n        w_sol = zeta * alpha_s * L_s * (T_i_sol - T_ref)\n        q_sol = k_s * (T_hot - T_i_sol) / L_s\n\n        # Round the results to six decimal places\n        result = [\n            round(T_i_sol, 6),\n            round(q_sol, 6),\n            round(w_sol, 6)\n        ]\n        results.append(result)\n\n    # Format the results into the required string format with no spaces\n    formatted_results = [str(r).replace(' ', '') for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "Moving from steady-state to transient phenomena introduces the critical dimension of time and the associated challenges of numerical simulation. This exercise uses a lumped-capacitance model to represent the transient thermal response of a wall, a common simplification in thermal analysis . You will derive the governing ordinary differential equation and, crucially, analyze the stability of an explicit time-integration scheme, establishing the maximum allowable time step, $\\Delta t_{\\max}$, as a function of the system's physical properties.",
            "id": "3954930",
            "problem": "A thin, highly conductive solid wall of thickness $l$ separates two incompressible flows: a hot stream with bulk temperature $T_{1,\\infty}$ and a cold stream with bulk temperature $T_{2,\\infty}$. The wall material has density $\\rho_{s}$ and specific heat capacity $c_{p,s}$. Owing to the high thermal conductivity of the wall, assume the wall temperature is spatially uniform and equal to $T_{w}(t)$ at all times. The interface heat exchange on each side is governed by Newton’s law of cooling: on the hot side, the heat flux into the wall is $q_{1}(t) = h_{1}\\left(T_{1,\\infty} - T_{w}(t)\\right)$, and on the cold side, the heat flux out of the wall is $q_{2}(t) = h_{2}\\left(T_{w}(t) - T_{2,\\infty}\\right)$, where $h_{1}$ and $h_{2}$ are constant convective heat transfer coefficients. Treat all quantities per unit area of the wall.\n\nStarting from first principles, write the wall energy balance and use it to derive the governing ordinary differential equation for $T_{w}(t)$. Consider a partitioned Fluid–Structure Interaction (FSI) coupling in which the wall temperature is advanced explicitly in time using a forward Euler update with time step $\\Delta t$ applied to this ordinary differential equation, while the fluid-side heat fluxes $q_{1}(t)$ and $q_{2}(t)$ are evaluated using the current wall temperature at each step. Derive the necessary and sufficient condition for absolute stability of this explicit time integration scheme in terms of $h_{1}$, $h_{2}$, $\\rho_{s}$, $c_{p,s}$, and $l$.\n\nFinally, for a wall of thickness $l = 2.0 \\times 10^{-3}\\,\\text{m}$ made of a solid with $\\rho_{s} = 2.7 \\times 10^{3}\\,\\text{kg}\\,\\text{m}^{-3}$ and $c_{p,s} = 9.0 \\times 10^{2}\\,\\text{J}\\,\\text{kg}^{-1}\\,\\text{K}^{-1}$, separating a liquid flow with $h_{1} = 4.0 \\times 10^{3}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-1}$ from an air flow with $h_{2} = 2.0 \\times 10^{2}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-1}$, compute the maximum allowable time step $\\Delta t_{\\max}$ for absolute stability. Express your final time step in seconds and round your answer to four significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and complete. The given problem describes a standard transient heat transfer scenario using the lumped capacitance method, which is appropriate for a thin, highly conductive wall. The physics is based on the first law of thermodynamics (energy conservation) and Newton's law of cooling. The numerical analysis part, concerning the stability of the forward Euler method, is a canonical topic in computational engineering. All required parameters are provided, and the numerical values are physically realistic for the described materials and conditions. The problem is therefore deemed valid.\n\nThe solution proceeds in three parts: first, the derivation of the governing ordinary differential equation (ODE) for the wall temperature $T_w(t)$; second, the derivation of the stability condition for the explicit forward Euler time integration scheme; and third, the calculation of the maximum stable time step $\\Delta t_{\\max}$ using the provided numerical data.\n\n**Part 1: Derivation of the Governing ODE**\n\nWe begin from the first principle of conservation of energy applied to the solid wall. The rate of change of the internal energy stored within the wall must equal the net rate of heat transfer into the wall. As the problem specifies a treatment per unit area, we formulate the energy balance for a control volume corresponding to a unit area of the wall with thickness $l$.\n\nThe internal energy of the wall per unit area, $E_{w}$, is given by $E_{w} = m' c_{p,s} T_{w}(t)$, where $m'$ is the mass per unit area. The mass per unit area is the product of the material density $\\rho_s$ and the wall thickness $l$, so $m' = \\rho_{s} l$. The internal energy per unit area is thus $E_{w} = \\rho_{s} l c_{p,s} T_{w}(t)$.\n\nThe rate of change of this internal energy per unit area is:\n$$\n\\frac{dE_{w}}{dt} = \\frac{d}{dt} \\left( \\rho_{s} l c_{p,s} T_{w}(t) \\right) = \\rho_{s} l c_{p,s} \\frac{dT_{w}}{dt}\n$$\nThis is valid because $\\rho_{s}$, $l$, and $c_{p,s}$ are constants.\n\nThe net heat flux into the wall, $q_{net}$, is the heat flux from the hot side, $q_1(t)$, minus the heat flux leaving to the cold side, $q_2(t)$.\n$$\nq_{net}(t) = q_{1}(t) - q_{2}(t)\n$$\nUsing the provided expressions based on Newton's law of cooling:\n$$\nq_{1}(t) = h_{1}\\left(T_{1,\\infty} - T_{w}(t)\\right)\n$$\n$$\nq_{2}(t) = h_{2}\\left(T_{w}(t) - T_{2,\\infty}\\right)\n$$\nThe net heat flux is therefore:\n$$\nq_{net}(t) = h_{1}\\left(T_{1,\\infty} - T_{w}(t)\\right) - h_{2}\\left(T_{w}(t) - T_{2,\\infty}\\right)\n$$\nExpanding and collecting terms with $T_w(t)$:\n$$\nq_{net}(t) = h_{1}T_{1,\\infty} - h_{1}T_{w}(t) - h_{2}T_{w}(t) + h_{2}T_{2,\\infty}\n$$\n$$\nq_{net}(t) = -\\left(h_{1} + h_{2}\\right)T_{w}(t) + \\left(h_{1}T_{1,\\infty} + h_{2}T_{2,\\infty}\\right)\n$$\nEquating the rate of energy change with the net heat flux, $\\frac{dE_{w}}{dt} = q_{net}(t)$, we obtain the governing ODE:\n$$\n\\rho_{s} l c_{p,s} \\frac{dT_{w}}{dt} = -\\left(h_{1} + h_{2}\\right)T_{w}(t) + \\left(h_{1}T_{1,\\infty} + h_{2}T_{2,\\infty}\\right)\n$$\nThis is the required ordinary differential equation for the wall temperature $T_w(t)$.\n\n**Part 2: Stability Condition for the Forward Euler Scheme**\n\nThe derived ODE can be written in the standard form $\\frac{dy}{dt} = \\lambda y + b$. Rearranging our ODE:\n$$\n\\frac{dT_{w}}{dt} = -\\frac{h_{1} + h_{2}}{\\rho_{s} l c_{p,s}} T_{w}(t) + \\frac{h_{1}T_{1,\\infty} + h_{2}T_{2,\\infty}}{\\rho_{s} l c_{p,s}}\n$$\nThis is a linear first-order ODE. For the stability analysis, we only need to consider the homogeneous part of the equation, which governs the evolution of perturbations. The equation is of the form $\\frac{dT_w}{dt} = \\lambda T_w + f(t)$, where the constant $\\lambda$ is given by:\n$$\n\\lambda = -\\frac{h_{1} + h_{2}}{\\rho_{s} l c_{p,s}}\n$$\nThe forward Euler method is an explicit time integration scheme. For an ODE $\\frac{dy}{dt} = g(t, y)$, the update rule is $y^{n+1} = y^{n} + \\Delta t \\, g(t^{n}, y^{n})$. Applying this to our ODE for $T_w$:\n$$\nT_{w}^{n+1} = T_{w}^{n} + \\Delta t \\left( \\lambda T_{w}^{n} + \\frac{h_{1}T_{1,\\infty} + h_{2}T_{2,\\infty}}{\\rho_{s} l c_{p,s}} \\right)\n$$\nThe stability of this numerical scheme is determined by how it propagates errors. An error $\\epsilon^n$ at time step $n$ evolves to $\\epsilon^{n+1}$ at step $n+1$ according to the homogeneous part of the discretized equation:\n$$\n\\epsilon^{n+1} = \\epsilon^{n} + \\Delta t (\\lambda \\epsilon^{n}) = (1 + \\lambda \\Delta t)\\epsilon^{n}\n$$\nThe term $G = 1 + \\lambda \\Delta t$ is the amplification factor. For the scheme to be absolutely stable, any initial error must not grow in magnitude over time. This requires the magnitude of the amplification factor to be less than or equal to one:\n$$\n|G| \\leq 1 \\implies |1 + \\lambda \\Delta t| \\leq 1\n$$\nThis inequality can be expanded to:\n$$\n-1 \\leq 1 + \\lambda \\Delta t \\leq 1\n$$\nThis yields two conditions:\n1. $1 + \\lambda \\Delta t \\leq 1 \\implies \\lambda \\Delta t \\leq 0$\n2. $-1 \\leq 1 + \\lambda \\Delta t \\implies -2 \\leq \\lambda \\Delta t \\implies \\Delta t \\leq -\\frac{2}{\\lambda}$\n\nSince all physical parameters ($h_1, h_2, \\rho_s, l, c_{p,s}$) are positive, the term $\\lambda = -\\frac{h_{1} + h_{2}}{\\rho_{s} l c_{p,s}}$ is strictly negative. Also, the time step $\\Delta t$ must be positive. Therefore, the product $\\lambda \\Delta t$ is always negative, and the first condition, $\\lambda \\Delta t \\leq 0$, is always satisfied.\n\nThe stability is thus solely constrained by the second condition:\n$$\n\\Delta t \\leq -\\frac{2}{\\lambda}\n$$\nSubstituting the expression for $\\lambda$:\n$$\n\\Delta t \\leq -2 \\left( -\\frac{\\rho_{s} l c_{p,s}}{h_{1} + h_{2}} \\right)\n$$\n$$\n\\Delta t \\leq \\frac{2 \\rho_{s} l c_{p,s}}{h_{1} + h_{2}}\n$$\nThis is the necessary and sufficient condition for the absolute stability of the forward Euler scheme for this problem.\n\n**Part 3: Calculation of the Maximum Time Step $\\Delta t_{\\max}$**\n\nThe maximum allowable time step, $\\Delta t_{\\max}$, is the upper bound of this stability condition:\n$$\n\\Delta t_{\\max} = \\frac{2 \\rho_{s} l c_{p,s}}{h_{1} + h_{2}}\n$$\nWe are given the following numerical values:\n- $l = 2.0 \\times 10^{-3}\\,\\text{m}$\n- $\\rho_{s} = 2.7 \\times 10^{3}\\,\\text{kg}\\,\\text{m}^{-3}$\n- $c_{p,s} = 9.0 \\times 10^{2}\\,\\text{J}\\,\\text{kg}^{-1}\\,\\text{K}^{-1}$\n- $h_{1} = 4.0 \\times 10^{3}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-1}$\n- $h_{2} = 2.0 \\times 10^{2}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-1}$\n\nFirst, we calculate the thermal capacitance of the wall per unit area, which is the numerator term $\\rho_{s} l c_{p,s}$:\n$$\n\\rho_{s} l c_{p,s} = (2.7 \\times 10^{3}) \\times (2.0 \\times 10^{-3}) \\times (9.0 \\times 10^{2}) = 4860\\,\\text{J}\\,\\text{m}^{-2}\\,\\text{K}^{-1}\n$$\nNext, we calculate the sum of the convective heat transfer coefficients:\n$$\nh_{1} + h_{2} = (4.0 \\times 10^{3}) + (2.0 \\times 10^{2}) = 4000 + 200 = 4200\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{K}^{-1}\n$$\nNow, substitute these values into the expression for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{2 \\times 4860}{4200} = \\frac{9720}{4200}\\,\\text{s}\n$$\n$$\n\\Delta t_{\\max} = \\frac{972}{420} = \\frac{81}{35}\\,\\text{s} \\approx 2.3142857... \\,\\text{s}\n$$\nRounding the result to four significant figures as requested:\n$$\n\\Delta t_{\\max} \\approx 2.314 \\, \\text{s}\n$$",
            "answer": "$$\\boxed{2.314}$$"
        },
        {
            "introduction": "A reliable numerical simulation must do more than just produce stable results; it must also respect the fundamental physical laws it aims to model, such as the conservation of energy. This advanced practice challenges you to implement a robust, unconditionally stable implicit time-integration scheme—the trapezoidal rule—for a coupled thermal system . Your primary task is to perform a numerical energy audit to verify that your implementation conserves energy to within machine precision, demonstrating a critical skill in code verification and validation.",
            "id": "3954902",
            "problem": "Consider a thermally coupled Fluid–Structure Interaction (FSI) system in which a single well-mixed fluid region exchanges energy with a single well-mixed solid region across $N$ discrete, planar interfaces. Each interface $i$ has area $A_i$ and an interfacial heat transfer coefficient $h_i$. Let $T_f(t)$ and $T_s(t)$ denote the uniform temperatures of the fluid and solid regions, respectively. Let the fluid region have mass $m_f$ and constant specific heat capacity $c_f$, and the solid region have mass $m_s$ and constant specific heat capacity $c_s$. Assume there are no external heat sources, no phase change, no radiation, and the thermal properties are constant in time. All heat transfer occurs only through the $N$ discrete interfaces by convection/conduction characterized by the same linear interfacial law on each interface.\n\nStarting from the First Law of Thermodynamics for a control volume (energy conservation) and Newton’s law of cooling, the net interfacial heat rate on interface $i$ is $ \\Phi_i(t) = A_i h_i \\left( T_f(t) - T_s(t) \\right) $. The fluid and solid ordinary differential equations (ODEs) follow from energy balance on each lumped region. Using these fundamental statements only, derive a consistent semi-discrete time-integration scheme for $T_f(t)$ and $T_s(t)$ over a uniform time grid $t_n = t_0 + n \\Delta t$ with a chosen time step $\\Delta t$. Use the trapezoidal rule (a second-order, unconditionally stable scheme) to discretize time in a way that is consistent between the state update and the evaluation of the interfacial energy exchange.\n\nDefine the cumulative energy exchanged across the discrete interfaces over a time interval $[t_0, t_K]$ by discretely integrating the sum of the interfacial heat rates using the trapezoidal rule, i.e., integrate $ \\sum_{i=1}^{N} \\Phi_i(t) $ over time. Let the total internal energy changes of the fluid and the solid be $ \\Delta U_f = m_f c_f \\left( T_f(t_K) - T_f(t_0) \\right) $ and $ \\Delta U_s = m_s c_s \\left( T_s(t_K) - T_s(t_0) \\right) $, respectively. Verification of energy exchange requires demonstrating, for the chosen discrete scheme, that the residuals $ r_f = \\Delta U_f + Q_{\\text{interfaces}} $ and $ r_s = \\Delta U_s - Q_{\\text{interfaces}} $ are both approximately zero, where $ Q_{\\text{interfaces}} $ is the discrete cumulative interface energy integral. The residuals $r_f$ and $r_s$ must be reported in joules.\n\nYour task is to implement a program that:\n- Derives from first principles the coupled lumped-parameter ODEs governing $T_f(t)$ and $T_s(t)$.\n- Constructs a trapezoidal-rule time discretization for the coupled system and solves for $T_f^{n+1}$ and $T_s^{n+1}$ at each time step, ensuring consistency in how the interfacial energy exchange is discretely integrated.\n- Computes the cumulative energy exchanged across all discrete interfaces using the trapezoidal rule, $ Q_{\\text{interfaces}} $, and evaluates the residuals $ r_f $ and $ r_s $ as defined above.\n- Returns, for each test case, a single float equal to the maximum of $ |r_f| $ and $ |r_s| $ over the full simulation, expressed in joules as a real number.\n\nPhysical units must be used consistently as follows: $A_i$ in $\\text{m}^2$, $h_i$ in $\\text{W}/(\\text{m}^2\\cdot\\text{K})$, $m_f$ and $m_s$ in $\\text{kg}$, $c_f$ and $c_s$ in $\\text{J}/(\\text{kg}\\cdot\\text{K})$, temperatures in $\\text{K}$, time in $\\text{s}$, energy in $\\text{J}$.\n\nAngle units do not appear in this problem. No percentages are required.\n\nImplement the program to evaluate the following test suite. In all cases, use initial time $t_0 = 0$ and a uniform time step $\\Delta t$ for $K$ steps, with initial temperatures $T_f(t_0)$ and $T_s(t_0)$ as specified. All outputs must be expressed in joules. The final output must be a single line containing a comma-separated list enclosed in square brackets with one float per test case, in the order given.\n\nTest suite:\n- Case 1 (general case with multiple interfaces):\n    - $N = 3$\n    - $A = [\\,0.5,\\,0.2,\\,0.3\\,]$ $\\text{m}^2$\n    - $h = [\\,100,\\,250,\\,400\\,]$ $\\text{W}/(\\text{m}^2\\cdot\\text{K})$\n    - $m_f = 1.0$ $\\text{kg}$, $c_f = 4184$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $m_s = 2.0$ $\\text{kg}$, $c_s = 900$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $\\Delta t = 0.01$ $\\text{s}$, $K = 100$\n    - $T_f(t_0) = 350$ $\\text{K}$, $T_s(t_0) = 300$ $\\text{K}$\n    - Use a trapezoidal audit of interfacial energy.\n- Case 2 (boundary condition with one zero-area interface):\n    - $N = 4$\n    - $A = [\\,0.0,\\,0.1,\\,0.05,\\,0.2\\,]$ $\\text{m}^2$\n    - $h = [\\,100,\\,200,\\,150,\\,300\\,]$ $\\text{W}/(\\text{m}^2\\cdot\\text{K})$\n    - $m_f = 0.5$ $\\text{kg}$, $c_f = 4184$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $m_s = 5.0$ $\\text{kg}$, $c_s = 500$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $\\Delta t = 0.05$ $\\text{s}$, $K = 40$\n    - $T_f(t_0) = 320$ $\\text{K}$, $T_s(t_0) = 310$ $\\text{K}$\n    - Use a trapezoidal audit of interfacial energy.\n- Case 3 (stiff coupling due to large interfacial coefficients):\n    - $N = 2$\n    - $A = [\\,0.1,\\,0.2\\,]$ $\\text{m}^2$\n    - $h = [\\,100000,\\,80000\\,]$ $\\text{W}/(\\text{m}^2\\cdot\\text{K})$\n    - $m_f = 1.0$ $\\text{kg}$, $c_f = 1000$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $m_s = 1.5$ $\\text{kg}$, $c_s = 800$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $\\Delta t = 0.00001$ $\\text{s}$, $K = 1000$\n    - $T_f(t_0) = 310$ $\\text{K}$, $T_s(t_0) = 300$ $\\text{K}$\n    - Use a trapezoidal audit of interfacial energy.\n- Case 4 (significant edge case to reveal inconsistency if audit is mismatched):\n    - $N = 3$\n    - $A = [\\,0.4,\\,0.2,\\,0.1\\,]$ $\\text{m}^2$\n    - $h = [\\,500,\\,1000,\\,750\\,]$ $\\text{W}/(\\text{m}^2\\cdot\\text{K})$\n    - $m_f = 0.8$ $\\text{kg}$, $c_f = 2000$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $m_s = 1.2$ $\\text{kg}$, $c_s = 700$ $\\text{J}/(\\text{kg}\\cdot\\text{K})$\n    - $\\Delta t = 0.02$ $\\text{s}$, $K = 50$\n    - $T_f(t_0) = 330$ $\\text{K}$, $T_s(t_0) = 290$ $\\text{K}$\n    - For this case only, audit the interfacial energy using a first-order left-rectangle (forward Euler) rule, i.e., $ Q_{\\text{interfaces}} = \\sum_{n=0}^{K-1} \\Delta t \\sum_{i=1}^{N} \\Phi_i(t_n) $, while still updating the temperatures using the trapezoidal rule.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where each $r_k$ is the maximum residual magnitude in joules for the $k$-th test case.",
            "solution": "The user wants me to solve a problem in the field of computational thermal engineering, specifically focusing on fluid–structure interaction in thermally coupled systems.\n\n### **Problem Validation**\n\nFirst, I will validate the problem statement.\n\n**Step 1: Extract Givens**\n- System: A single well-mixed fluid region and a single well-mixed solid region.\n- Interfaces: $N$ discrete, planar interfaces, each with area $A_i$ and heat transfer coefficient $h_i$.\n- State Variables: Uniform fluid temperature $T_f(t)$ and solid temperature $T_s(t)$.\n- Properties: Fluid mass $m_f$ and specific heat $c_f$; Solid mass $m_s$ and specific heat $c_s$. All properties are constant.\n- Governing Physics: First Law of Thermodynamics and Newton's law of cooling. Heat transfer occurs only through the interfaces. Interfacial heat rate is $\\Phi_i(t) = A_i h_i (T_f(t) - T_s(t))$. No other heat sources or sinks.\n- Numerical Method: Semi-discrete time-integration on a uniform grid $t_n = t_0 + n \\Delta t$. The trapezoidal rule is specified for updating the state variables $T_f(t)$ and $T_s(t)$.\n- Energy Audit: The cumulative energy exchanged, $Q_{\\text{interfaces}}$, is calculated by integrating the total heat rate $\\sum_{i=1}^{N} \\Phi_i(t)$ over time $[t_0, t_K]$. This integration also uses the trapezoidal rule, except for a specified test case.\n- Verification Quantities:\n    - Change in internal energy: $\\Delta U_f = m_f c_f (T_f(t_K) - T_f(t_0))$ and $\\Delta U_s = m_s c_s (T_s(t_K) - T_s(t_0))$.\n    - Residuals: $r_f = \\Delta U_f + Q_{\\text{interfaces}}$ and $r_s = \\Delta U_s - Q_{\\text{interfaces}}$.\n- Task: Implement an algorithm to compute $\\max(|r_f|, |r_s|)$ for a given set of test cases.\n- Test Cases: Four distinct cases are provided with all necessary parameters ($N$, $A_i$, $h_i$, $m_f$, $c_f$, $m_s$, $c_s$, $\\Delta t$, $K$, $T_f(t_0)$, $T_s(t_0)$). Case $4$ specifically requires a different numerical rule for the energy audit.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on fundamental principles of thermodynamics (energy conservation) and heat transfer (Newton's cooling law). The lumped-parameter model is a standard and valid approach for the described system. (Valid)\n- **Well-Posed**: The problem defines a system of two coupled linear ordinary differential equations with initial conditions. The use of an implicit time-integration scheme (trapezoidal rule) ensures stability and leads to a well-defined linear system at each time step. The requested output is a uniquely determinable numerical value. (Valid)\n- **Objective**: All aspects of the problem are defined with mathematical precision and objective physical quantities. There is no subjective or ambiguous language. (Valid)\n- **Complete and Consistent**: All data required to solve the problem (material properties, geometry, initial conditions, time-stepping parameters) are provided. The definitions are clear and internally consistent. (Valid)\n- **Realistic and Feasible**: The provided physical values are plausible. The computational task is straightforward and feasible. (Valid)\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and complete. It represents a a canonical exercise in verifying the energy conservation properties of numerical schemes for coupled systems. The problem is valid. I will proceed to the solution.\n\n### **Principle-Based Solution Design**\n\nThe solution requires developing a numerical time-integration scheme for a coupled thermal system and verifying its energy conservation properties.\n\n**1. Derivation of Governing Ordinary Differential Equations (ODEs)**\n\nThe First Law of Thermodynamics applied to the fluid control volume states that the rate of change of its internal energy, $U_f$, equals the net rate of heat transfer into it. Since heat is transferred out of the fluid to the solid (assuming $T_f > T_s$), the energy balance is:\n$$ \\frac{dU_f}{dt} = - \\sum_{i=1}^{N} \\Phi_i(t) $$\nThe internal energy of the well-mixed fluid is $U_f(t) = m_f c_f T_f(t)$. The thermal properties $m_f$ and $c_f$ are constant. The total heat rate across all interfaces is $\\Phi_{total}(t) = \\sum_{i=1}^{N} A_i h_i (T_f(t) - T_s(t))$. Let's define the total interfacial heat transfer conductance as $H = \\sum_{i=1}^{N} A_i h_i$. The fluid ODE becomes:\n$$ m_f c_f \\frac{dT_f}{dt} = -H \\left( T_f(t) - T_s(t) \\right) $$\nSimilarly, for the solid control volume, the heat is transferred into the region:\n$$ \\frac{dU_s}{dt} = + \\sum_{i=1}^{N} \\Phi_i(t) $$\nWith $U_s(t) = m_s c_s T_s(t)$, the solid ODE is:\n$$ m_s c_s \\frac{dT_s}{dt} = H \\left( T_f(t) - T_s(t) \\right) $$\nLet $C_f = m_f c_f$ and $C_s = m_s c_s$ be the thermal capacitances of the fluid and solid, respectively. The coupled system of ODEs is:\n$$ \\frac{d}{dt} \\begin{pmatrix} T_f \\\\ T_s \\end{pmatrix} = \\begin{pmatrix} -H/C_f & H/C_f \\\\ H/C_s & -H/C_s \\end{pmatrix} \\begin{pmatrix} T_f \\\\ T_s \\end{pmatrix} $$\n\n**2. Time Discretization using the Trapezoidal Rule**\n\nThe trapezoidal rule for an ODE $\\frac{dy}{dt} = f(y, t)$ is an implicit, second-order accurate scheme given by:\n$$ \\frac{y^{n+1} - y^n}{\\Delta t} = \\frac{1}{2} \\left[ f(y^n, t_n) + f(y^{n+1}, t_{n+1}) \\right] $$\nwhere the superscript $n$ denotes the value at time $t_n$. Applying this to our coupled system yields two algebraic equations for the unknown temperatures $T_f^{n+1}$ and $T_s^{n+1}$:\n$$ \\frac{T_f^{n+1} - T_f^n}{\\Delta t} = -\\frac{H}{C_f} \\frac{1}{2} \\left[ (T_f^n - T_s^n) + (T_f^{n+1} - T_s^{n+1}) \\right] $$\n$$ \\frac{T_s^{n+1} - T_s^n}{\\Delta t} = +\\frac{H}{C_s} \\frac{1}{2} \\left[ (T_f^n - T_s^n) + (T_f^{n+1} - T_s^{n+1}) \\right] $$\nTo solve for the temperatures at step $n+1$, we rearrange these equations into a linear system. Let's multiply the first equation by $2 C_f$ and the second by $2 C_s$:\n$$ 2 C_f (T_f^{n+1} - T_f^n) = -H \\Delta t (T_f^n - T_s^n + T_f^{n+1} - T_s^{n+1}) $$\n$$ 2 C_s (T_s^{n+1} - T_s^n) = +H \\Delta t (T_f^n - T_s^n + T_f^{n+1} - T_s^{n+1}) $$\nGrouping terms with unknowns $T_f^{n+1}$ and $T_s^{n+1}$ on the left-hand side:\n$$ (2 C_f + H \\Delta t) T_f^{n+1} - (H \\Delta t) T_s^{n+1} = (2 C_f - H \\Delta t) T_f^n + (H \\Delta t) T_s^n $$\n$$ -(H \\Delta t) T_f^{n+1} + (2 C_s + H \\Delta t) T_s^{n+1} = (H \\Delta t) T_f^n + (2 C_s - H \\Delta t) T_s^n $$\nThis is a $2 \\times 2$ linear system of the form $\\mathbf{M} \\mathbf{T}^{n+1} = \\mathbf{b}$, where $\\mathbf{T}^{n+1} = [T_f^{n+1}, T_s^{n+1}]^T$:\n$$ \\mathbf{M} = \\begin{pmatrix} C_f + \\frac{1}{2}H \\Delta t & -\\frac{1}{2}H \\Delta t \\\\ -\\frac{1}{2}H \\Delta t & C_s + \\frac{1}{2}H \\Delta t \\end{pmatrix} $$\n$$ \\mathbf{b} = \\begin{pmatrix} (C_f - \\frac{1}{2}H \\Delta t) T_f^n + (\\frac{1}{2}H \\Delta t) T_s^n \\\\ (\\frac{1}{2}H \\Delta t) T_f^n + (C_s - \\frac{1}{2}H \\Delta t) T_s^n \\end{pmatrix} $$\nAt each time step $n$, this system is solved for $\\mathbf{T}^{n+1}$ using the known values from step $n$.\n\n**3. Energy Conservation and Residual Calculation**\n\nThe core of the problem is to verify discrete energy conservation. The change in internal energy for the fluid and solid over the interval $[t_0, t_K]$ are:\n$$ \\Delta U_f = C_f (T_f(t_K) - T_f(t_0)) $$\n$$ \\Delta U_s = C_s (T_s(t_K) - T_s(t_0)) $$\nThe total energy transferred from the fluid to the solid through the interfaces is $Q_{\\text{interfaces}} = \\int_{t_0}^{t_K} \\Phi_{total}(t) dt$. For Cases $1$, $2$, and $3$, this integral is discretionary evaluated using the trapezoidal rule:\n$$ Q_{\\text{interfaces}} = \\sum_{n=0}^{K-1} \\frac{\\Phi_{total}(t_n) + \\Phi_{total}(t_{n+1})}{2} \\Delta t $$\nwhere $\\Phi_{total}(t_n) = H (T_f^n - T_s^n)$. Note that this is the same integration rule used for the ODEs. If we sum the two discretized ODEs, we get:\n$$ C_f (T_f^{n+1} - T_f^n) + C_s (T_s^{n+1} - T_s^n) = 0 $$\nThis shows that for each time step, the change in internal energy of the combined system is zero, i.e., $\\Delta U_f^{n \\to n+1} + \\Delta U_s^{n \\to n+1} = 0$. This scheme is inherently energy-conserving.\nLet's define the discrete energy exchange in one time step as $\\Delta Q^n = \\frac{1}{2} (\\Phi_{total}(t_n) + \\Phi_{total}(t_{n+1}))\\Delta t$. The fluid update equation can be written as $\\Delta U_f^{n \\to n+1} = - \\Delta Q^n$. Summing over all time steps, $\\sum \\Delta U_f^{n \\to n+1} = - \\sum \\Delta Q^n$, which implies $\\Delta U_f = -Q_{\\text{interfaces}}$. Therefore, the residual $r_f = \\Delta U_f + Q_{\\text{interfaces}}$ must be zero (up to floating-point precision). Similarly, the solid update implies $\\Delta U_s = Q_{\\text{interfaces}}$, so $r_s = \\Delta U_s - Q_{\\text{interfaces}}$ must also be zero.\n\nFor Case $4$, the energy audit is performed with the forward Euler (left-rectangle) rule:\n$$ Q_{\\text{interfaces}} = \\sum_{n=0}^{K-1} \\Phi_{total}(t_n) \\Delta t $$\nSince the temperature update scheme (trapezoidal) and the energy audit scheme (Euler) are inconsistent, the calculated residuals $r_f$ and $r_s$ will not be zero. This case demonstrates the importance of using consistent discretizations for state updates and derived integral quantities to ensure conservation properties are met numerically.\n\nThe algorithm will iterate through time steps, solving the $2 \\times 2$ system, and then compute the final residuals based on the full temperature history and the specified audit method for each case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a set of thermally coupled fluid-structure interaction problems\n    and verifies energy conservation of the numerical scheme.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general case with multiple interfaces)\n        {\n            \"N\": 3, \"A\": [0.5, 0.2, 0.3], \"h\": [100, 250, 400],\n            \"m_f\": 1.0, \"c_f\": 4184.0, \"m_s\": 2.0, \"c_s\": 900.0,\n            \"dt\": 0.01, \"K\": 100, \"T_f0\": 350.0, \"T_s0\": 300.0,\n            \"audit_method\": \"trapezoidal\"\n        },\n        # Case 2 (boundary condition with one zero-area interface)\n        {\n            \"N\": 4, \"A\": [0.0, 0.1, 0.05, 0.2], \"h\": [100, 200, 150, 300],\n            \"m_f\": 0.5, \"c_f\": 4184.0, \"m_s\": 5.0, \"c_s\": 500.0,\n            \"dt\": 0.05, \"K\": 40, \"T_f0\": 320.0, \"T_s0\": 310.0,\n            \"audit_method\": \"trapezoidal\"\n\n        },\n        # Case 3 (stiff coupling due to large interfacial coefficients)\n        {\n            \"N\": 2, \"A\": [0.1, 0.2], \"h\": [100000, 80000],\n            \"m_f\": 1.0, \"c_f\": 1000.0, \"m_s\": 1.5, \"c_s\": 800.0,\n            \"dt\": 0.00001, \"K\": 1000, \"T_f0\": 310.0, \"T_s0\": 300.0,\n            \"audit_method\": \"trapezoidal\"\n        },\n        # Case 4 (significant edge case to reveal inconsistency if audit is mismatched)\n        {\n            \"N\": 3, \"A\": [0.4, 0.2, 0.1], \"h\": [500, 1000, 750],\n            \"m_f\": 0.8, \"c_f\": 2000.0, \"m_s\": 1.2, \"c_s\": 700.0,\n            \"dt\": 0.02, \"K\": 50, \"T_f0\": 330.0, \"T_s0\": 290.0,\n            \"audit_method\": \"euler\"\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Extract parameters\n        A = np.array(case[\"A\"])\n        h = np.array(case[\"h\"])\n        m_f, c_f = case[\"m_f\"], case[\"c_f\"]\n        m_s, c_s = case[\"m_s\"], case[\"c_s\"]\n        dt, K = case[\"dt\"], case[\"K\"]\n        T_f0, T_s0 = case[\"T_f0\"], case[\"T_s0\"]\n        audit_method = case[\"audit_method\"]\n\n        # Pre-calculations\n        C_f = m_f * c_f  # Fluid thermal capacitance\n        C_s = m_s * c_s  # Solid thermal capacitance\n        H = np.sum(A * h)   # Total interfacial heat transfer conductance\n\n        # History arrays to store temperatures at each time step\n        T_f_hist = np.zeros(K + 1)\n        T_s_hist = np.zeros(K + 1)\n        T_f_hist[0] = T_f0\n        T_s_hist[0] = T_s0\n\n        # Setup the 2x2 linear system for the implicit trapezoidal rule\n        # M * T_next = b\n        alpha = 0.5 * H * dt\n        M = np.array([\n            [C_f + alpha, -alpha],\n            [-alpha,      C_s + alpha]\n        ])\n\n        # Time-stepping loop\n        for n in range(K):\n            T_f_n = T_f_hist[n]\n            T_s_n = T_s_hist[n]\n            \n            # Construct the right-hand side vector b\n            b = np.array([\n                (C_f - alpha) * T_f_n + alpha * T_s_n,\n                alpha * T_f_n + (C_s - alpha) * T_s_n\n            ])\n            \n            # Solve for temperatures at the next time step\n            T_next = np.linalg.solve(M, b)\n            T_f_hist[n + 1] = T_next[0]\n            T_s_hist[n + 1] = T_next[1]\n\n        # Post-processing: calculate residuals\n        \n        # Total change in internal energy\n        delta_U_f = C_f * (T_f_hist[-1] - T_f_hist[0])\n        delta_U_s = C_s * (T_s_hist[-1] - T_s_hist[0])\n\n        # Total heat rate history\n        phi_hist = H * (T_f_hist - T_s_hist)\n        \n        Q_interfaces = 0.0\n        if audit_method == 'trapezoidal':\n            # Use numpy's trapezoidal integration utility for consistency\n            Q_interfaces = np.trapz(phi_hist, dx=dt)\n        elif audit_method == 'euler':\n            # Use forward Euler (left-rectangle) rule for the audit\n            Q_interfaces = np.sum(phi_hist[:-1]) * dt\n\n        # Calculate energy balance residuals\n        r_f = delta_U_f + Q_interfaces\n        r_s = delta_U_s - Q_interfaces\n        \n        # The result for this case is the maximum absolute residual\n        result = max(abs(r_f), abs(r_s))\n        results.append(result)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}