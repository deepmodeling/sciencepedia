{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的微分方程之前，首先理解彭纳斯生物热模型中各项的物理意义至关重要。本练习将引导您从第一性原理出发，推导血液灌注所带来的热量交换项，并将其与组织的新陈代谢产热进行比较。通过这个计算，您将对血液灌注在何种情况下成为主导的热调节机制建立起定量的直觉，这是精确模拟各种热疗过程的基石。",
            "id": "3978138",
            "problem": "在稳态下，一个微小、均匀的灌注骨骼肌控制体与微血管系统进行热量交换，并通过新陈代谢产生热量。对该控制体应用能量守恒原理，将灌注热交换建模为动脉血液流入和静脉血液流出所携带的焓差，并将新陈代谢产热表示为均匀的体积热源。假定动脉血在温度 $T_a$ 下流入，静脉血在与局部组织达到热平衡后在温度 $T$ 下流出。假设血液密度为 $\\rho_b$，血液的定压比热为 $c_b$，体积灌注率（单位时间单位组织体积内输送的血液体积）为 $\\omega_b$。\n\n从控制体的能量守恒第一性原理和体积灌注的定义出发，推导以 $\\omega_b$、$\\rho_b$、$c_b$ 和 $T_a - T$ 表示的体积灌注热源。然后，使用以下对于轻度热疗下灌注骨骼肌的科学合理参数值，计算灌注加热与新陈代谢产热的无量纲比值：\n- 血液密度 $\\rho_b = 1060\\,\\mathrm{kg/m^3}$。\n- 血液比热 $c_b = 3600\\,\\mathrm{J/(kg\\cdot K)}$。\n- 体积灌注率 $\\omega_b = 2.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$。\n- 动脉-组织温差 $T_a - T = 2\\,\\mathrm{K}$。\n- 新陈代谢产热 $Q_m = 420\\,\\mathrm{W/m^3}$。\n\n将您的最终答案表示为比值\n$$R = \\frac{\\text{灌注加热}}{\\text{新陈代谢产热}},$$\n并四舍五入到4位有效数字。将 $R$ 报告为一个无单位的纯数。",
            "solution": "问题陈述经评估是有效的。其科学基础是能量守恒和生物传热原理，特别是 Pennes 生物热模型。该问题提法明确，为求得唯一解提供了所有必要的参数和假设。语言客观，所给出的数值对于骨骼肌组织是物理上合理的。问题是自洽的，没有矛盾。\n\n任务是首先从第一性原理推导体积灌注热源项，然后用它来计算一个无量纲比值。\n\n让我们考虑一个微小、均匀的组织控制体，用 $V$ 表示。分析在稳态下进行。根据能量守恒第一性原理，进入控制体的净能量速率必须与离开它的净能量速率相平衡。问题指出了两种主要的热交换机制：通过血液灌注的焓输运和体积新陈代谢产热。\n\n由于血液灌注而添加到控制体 $V$ 的净能量速率 $\\dot{E}_p$ 是动脉血带入该体积的焓与静脉血带出该体积的焓之间的差值。\n$$\n\\dot{E}_p = \\dot{H}_{\\text{in}} - \\dot{H}_{\\text{out}}\n$$\n其中 $\\dot{H}_{\\text{in}}$ 是动脉血的焓流入速率，$\\dot{H}_{\\text{out}}$ 是静脉血的焓流出速率。\n\n焓输运速率由 $\\dot{H} = \\dot{m} h$ 给出，其中 $\\dot{m}$ 是质量流率， $h$ 是比焓。对于具有恒定比热的不可压缩流体，比焓的变化与温度的变化关系为 $dh = c_b dT$。因此，相对于一个合适的参考温度，我们可以将焓率表示为 $\\dot{H} = \\dot{m} c_b T$。\n\n体积灌注率 $\\omega_b$ 定义为单位时间单位组织体积内输送的血液体积。对于我们的控制体 $V$，血液的体积流率 $\\dot{V}_b$ 是：\n$$\n\\dot{V}_b = \\omega_b V\n$$\n相应的血液质量流率 $\\dot{m}_b$ 是通过将体积流率乘以血液密度 $\\rho_b$ 得到的：\n$$\n\\dot{m}_b = \\rho_b \\dot{V}_b = \\rho_b \\omega_b V\n$$\n由于质量守恒，这个质量流率同时适用于动脉流入和静脉流出。\n\n动脉血在温度 $T_a$ 下进入控制体。焓流入速率为：\n$$\n\\dot{H}_{\\text{in}} = \\dot{m}_b c_b T_a = (\\rho_b \\omega_b V) c_b T_a\n$$\n假设静脉血在与周围组织达到热平衡后离开控制体，这意味着其温度为局部组织温度 $T$。焓流出速率为：\n$$\n\\dot{H}_{\\text{out}} = \\dot{m}_b c_b T = (\\rho_b \\omega_b V) c_b T\n$$\n因此，通过灌注供给控制体 $V$ 的净能量速率为：\n$$\n\\dot{E}_p = \\dot{H}_{\\text{in}} - \\dot{H}_{\\text{out}} = (\\rho_b \\omega_b V) c_b T_a - (\\rho_b \\omega_b V) c_b T = \\rho_b \\omega_b c_b V (T_a - T)\n$$\n体积灌注热源，我们记为 $Q_p$，是单位组织体积的净能量速率。\n$$\nQ_p = \\frac{\\dot{E}_p}{V} = \\frac{\\rho_b \\omega_b c_b V (T_a - T)}{V}\n$$\n这可以简化为体积灌注热源项的表达式：\n$$\nQ_p = \\omega_b \\rho_b c_b (T_a - T)\n$$\n该项表示血流为组织增加的（如果 $T_a > T$）或带走的（如果 $T_a  T$）热量。\n\n接下来，我们计算灌注加热与新陈代谢产热 $Q_m$ 的无量纲比值 $R$。\n$$\nR = \\frac{Q_p}{Q_m} = \\frac{\\omega_b \\rho_b c_b (T_a - T)}{Q_m}\n$$\n我们已知以下参数值：\n- 血液密度 $\\rho_b = 1060\\,\\mathrm{kg/m^3}$\n- 血液比热 $c_b = 3600\\,\\mathrm{J/(kg\\cdot K)}$\n- 体积灌注率 $\\omega_b = 2.0 \\times 10^{-3}\\,\\mathrm{s^{-1}}$\n- 动脉-组织温差 $T_a - T = 2\\,\\mathrm{K}$\n- 新陈代谢产热 $Q_m = 420\\,\\mathrm{W/m^3}$\n\n首先，我们计算 $Q_p$ 的数值：\n$$\nQ_p = (2.0 \\times 10^{-3}\\,\\mathrm{s^{-1}}) \\times (1060\\,\\mathrm{kg/m^3}) \\times (3600\\,\\mathrm{J/(kg\\cdot K)}) \\times (2\\,\\mathrm{K})\n$$\n$$\nQ_p = 15264\\,\\mathrm{J/(m^3 \\cdot s)} = 15264\\,\\mathrm{W/m^3}\n$$\n现在，我们可以计算比值 $R$：\n$$\nR = \\frac{15264\\,\\mathrm{W/m^3}}{420\\,\\mathrm{W/m^3}} \\approx 36.342857\n$$\n问题要求答案四舍五入到4位有效数字。\n$$\nR \\approx 36.34\n$$\n这个结果表明，在指定条件下，由灌注提供的热量远大于由新陈代谢产生的热量。",
            "answer": "$$\\boxed{36.34}$$"
        },
        {
            "introduction": "一个稳健的物理模型不仅应能描述复杂现象，还必须能在极限条件下正确地简化为我们熟知的简单情况。本练习要求您解析求解一维组织板中的彭纳斯生物热方程，并检验当血液灌注率趋于零（纯热传导）和无穷大（高效散热）时，解的极限行为。这个实践将锻炼您的解析能力，并通过验证模型如何统一纯热传导和强灌注的散热效应，加深您对血液灌注作用的理解。",
            "id": "3978100",
            "problem": "一块厚度为 $L$ 的均匀组织板，占据区域 $x \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right]$，并使用一维 ($1\\mathrm{D}$) Pennes 生物热模型 (PBM) 进行建模。该组织板具有恒定的热导率 $k$，血液灌注汇项的特征由血液密度 $\\rho_b$、血液比热 $c_b$ 和体积血液灌注率 $\\omega_b$ 决定。组织以均匀的体积速率 $q_0$（新陈代谢加热加任何外加源）产热。动脉血温度为 $T_a$。组织板表面 $x = \\pm \\frac{L}{2}$ 的温度维持在动脉血温度，因此 $T\\!\\left(-\\frac{L}{2}\\right) = T_a$ 且 $T\\!\\left(\\frac{L}{2}\\right) = T_a$。\n\n从微分控制体积 (CV) 内的稳态能量守恒和 Fourier 热传导定律出发，推导 Pennes 生物热模型下稳态温度场 $T(x)$ 的控制方程，并求解中心线温度 $T(0)$ 关于 $k$、$L$、$q_0$、$\\rho_b c_b \\omega_b$ 和 $T_a$ 的精确闭式表达式。然后，分析当体积血液灌注率趋于零 ($\\omega_b \\to 0$) 时 $T(0)$ 的极限行为以恢复纯传导解，以及当 $\\omega_b \\to \\infty$ 时恢复温度为 $T_a$ 的等温组织解。\n\n以开尔文表示两个极限中心线温度。无需四舍五入。以闭式解析表达式对 $\\left(\\omega_b \\to 0,\\ \\omega_b \\to \\infty\\right)$ 的形式提供您的最终答案。",
            "solution": "根据验证标准对问题陈述进行评估。\n\n**步骤1：提取已知条件**\n- **区域：** 一块厚度为 $L$ 的均匀组织板，占据 $x \\in \\left[-\\frac{L}{2}, \\frac{L}{2}\\right]$。\n- **模型：** 一维 ($1\\mathrm{D}$) 稳态 Pennes 生物热模型 (PBM)。\n- **组织属性：** 恒定的热导率 $k$，均匀的体积产热率 $q_0$。\n- **灌注属性：** 血液密度 $\\rho_b$，血液比热 $c_b$，体积血液灌注率 $\\omega_b$。\n- **动脉温度：** $T_a$。\n- **边界条件：** $T\\!\\left(-\\frac{L}{2}\\right) = T_a$ 且 $T\\!\\left(\\frac{L}{2}\\right) = T_a$。\n- **目标：**\n  1. 推导稳态温度场 $T(x)$ 的控制微分方程。\n  2. 求解中心线温度 $T(0)$ 的精确闭式表达式。\n  3. 分析当 $\\omega_b \\to 0$ 和 $\\omega_b \\to \\infty$ 时 $T(0)$ 的极限行为。\n  4. 提供两个极限表达式作为最终答案。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于 Pennes 生物热模型，这是生物热工学中一个基础且被广泛接受的模型。它结合了 Fourier 传导定律以及新陈代谢产热和血液灌注的项，所有这些都是标准的物理概念。该问题是科学合理的。\n- **适定性：** 该问题在一个有限域上定义了一个二阶线性常微分方程 (ODE)，并带有两个 Dirichlet 边界条件。设置是对称的。这构成了一个适定的边值问题，它允许唯一且稳定的解。\n- **客观性：** 该问题使用精确、客观、无歧义的术语进行表述。所有参数都已明确定义。\n- **缺陷检查清单：** 该问题不违反任何无效性标准。它科学合理、可形式化、完整、一致、在模型假设内物理上合理且适定。这是一个需要推导和分析的实质性问题，而不是一个微不足道的问题。\n\n**步骤3：结论与行动**\n该问题是**有效的**。将提供完整解答。\n\n**控制方程的推导**\n我们首先对位于位置 $x$、横截面积为 $A$、厚度为 $dx$ 的微分控制体积 (CV) 应用稳态能量守恒原理。能量平衡为：\n$$(\\text{能量输入率}) - (\\text{能量输出率}) + (\\text{能量生成率}) = 0$$\n各项为：\n1.  在 $x$ 处传导入的能量：$\\dot{E}_{cond, x} = q_x A$。\n2.  在 $x+dx$ 处传导出的能量：$\\dot{E}_{cond, x+dx} = q_{x+dx} A$。\n3.  体积产热（新陈代谢 + 外加源）：$\\dot{E}_{gen} = q_0 (A \\, dx)$。\n4.  由血液灌注引起的能量交换（Pennes 源/汇项）：$\\dot{E}_{perf} = \\rho_b c_b \\omega_b (T_a - T) (A \\, dx)$。\n\n稳态能量平衡方程为：\n$$q_x A - q_{x+dx} A + q_0 A \\, dx + \\rho_b c_b \\omega_b (T_a - T) A \\, dx = 0$$\n除以控制体积的体积 $A \\, dx$，我们得到：\n$$-\\frac{q_{x+dx} - q_x}{dx} + q_0 + \\rho_b c_b \\omega_b (T_a - T) = 0$$\n当 $dx \\to 0$ 时取极限，第一项变为 $-\\frac{dq}{dx}$。使用 Fourier 热传导定律，$q = -k \\frac{dT}{dx}$，我们有：\n$$-\\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + q_0 + \\rho_b c_b \\omega_b (T_a - T) = 0$$\n由于热导率 $k$ 是常数，这简化为 Pennes 生物热模型的控制方程：\n$$k \\frac{d^2T}{dx^2} - \\rho_b c_b \\omega_b (T - T_a) + q_0 = 0$$\n\n**控制方程的求解**\n为了求解这个二阶线性非齐次常微分方程，我们引入一个新变量 $\\theta(x)$ 来使方程齐次化。令 $W_b = \\rho_b c_b \\omega_b$ 为灌注热容率。方程为：\n$$k \\frac{d^2T}{dx^2} - W_b T = -W_b T_a - q_0$$\n令 $\\theta(x) = T(x) - \\left(T_a + \\frac{q_0}{W_b}\\right)$。这意味着 $\\frac{d^2\\theta}{dx^2} = \\frac{d^2T}{dx^2}$。代入常微分方程：\n$$k \\frac{d^2\\theta}{dx^2} - W_b \\left(\\theta + T_a + \\frac{q_0}{W_b}\\right) = -W_b T_a - q_0$$\n$$k \\frac{d^2\\theta}{dx^2} - W_b \\theta - W_b T_a - q_0 = -W_b T_a - q_0$$\n$$k \\frac{d^2\\theta}{dx^2} - W_b \\theta = 0$$\n这是一个齐次常微分方程，可以写成 $\\frac{d^2\\theta}{dx^2} - m^2 \\theta = 0$，其中 $m = \\sqrt{\\frac{W_b}{k}} = \\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}$。\n$\\theta(x)$ 的通解是 $\\theta(x) = C_1 e^{mx} + C_2 e^{-mx}$，或者对于对称问题，更方便地使用双曲函数：\n$$\\theta(x) = A \\cosh(mx) + B \\sinh(mx)$$\n问题的几何形状和边界条件关于 $x=0$ 对称。因此，温度分布 $T(x)$ 必须是一个偶函数，$T(x) = T(-x)$。这意味着包含奇函数 $\\sinh(mx)$ 的项必须为零，所以 $B=0$。\n$\\theta(x)$ 的解简化为 $\\theta(x) = A \\cosh(mx)$。\n温度分布则为：\n$$T(x) = A \\cosh(mx) + T_a + \\frac{q_0}{W_b}$$\n我们应用边界条件 $T(\\frac{L}{2}) = T_a$：\n$$T\\left(\\frac{L}{2}\\right) = A \\cosh\\left(\\frac{mL}{2}\\right) + T_a + \\frac{q_0}{W_b} = T_a$$\n$$A \\cosh\\left(\\frac{mL}{2}\\right) = -\\frac{q_0}{W_b}$$\n$$A = -\\frac{q_0}{W_b \\cosh\\left(\\frac{mL}{2}\\right)}$$\n将 $A$ 代回 $T(x)$ 的表达式：\n$$T(x) = T_a + \\frac{q_0}{W_b} - \\frac{q_0}{W_b \\cosh\\left(\\frac{mL}{2}\\right)} \\cosh(mx)$$\n$$T(x) = T_a + \\frac{q_0}{W_b} \\left(1 - \\frac{\\cosh(mx)}{\\cosh\\left(\\frac{mL}{2}\\right)}\\right)$$\n\n**中心线温度**\n中心线温度 $T(0)$ 可通过设置 $x=0$ 找到：\n$$T(0) = T_a + \\frac{q_0}{W_b} \\left(1 - \\frac{\\cosh(0)}{\\cosh\\left(\\frac{mL}{2}\\right)}\\right)$$\n由于 $\\cosh(0)=1$，我们有：\n$$T(0) = T_a + \\frac{q_0}{W_b} \\left(1 - \\frac{1}{\\cosh\\left(\\frac{mL}{2}\\right)}\\right)$$\n代回 $W_b = \\rho_b c_b \\omega_b$ 和 $m = \\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}$：\n$$T(0) = T_a + \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(1 - \\frac{1}{\\cosh\\left(\\frac{L}{2}\\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}\\right)}\\right)$$\n\n**当 $\\omega_b \\to 0$ 时的极限行为（纯传导）**\n我们必须评估当 $\\omega_b \\to 0$ 时第二项的极限。令 $z = \\frac{L}{2}\\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}$。当 $\\omega_b \\to 0$ 时，$z \\to 0$。表达式为 $\\frac{q_0}{k} \\frac{L^2}{4z^2} (1 - \\frac{1}{\\cosh(z)})$。\n我们使用 $\\cosh(z)$ 在 $z=0$ 附近的 Taylor 级数展开：$\\cosh(z) = 1 + \\frac{z^2}{2} + O(z^4)$。\n$$\\lim_{\\omega_b \\to 0} [T(0) - T_a] = \\lim_{z \\to 0} \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(\\frac{\\cosh(z) - 1}{\\cosh(z)}\\right)$$\n$$= \\lim_{z \\to 0} \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(\\frac{(1 + \\frac{z^2}{2} + \\dots) - 1}{1 + \\frac{z^2}{2} + \\dots}\\right) = \\lim_{z \\to 0} \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(\\frac{z^2}{2}\\right)$$\n代入 $z^2 = \\frac{L^2}{4} \\frac{\\rho_b c_b \\omega_b}{k}$：\n$$\\lim_{\\omega_b \\to 0} [T(0) - T_a] = \\lim_{\\omega_b \\to 0} \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(\\frac{1}{2} \\cdot \\frac{L^2}{4} \\frac{\\rho_b c_b \\omega_b}{k}\\right) = \\frac{q_0 L^2}{8k}$$\n所以，在零灌注极限下的中心线温度为：\n$$T(0)_{\\omega_b \\to 0} = T_a + \\frac{q_0 L^2}{8k}$$\n这个结果与具有均匀产热和对称 Dirichlet 边界条件的平板中的纯传导解相匹配。\n\n**当 $\\omega_b \\to \\infty$ 时的极限行为（等温组织）**\n我们评估当 $\\omega_b \\to \\infty$ 时 $T(0)$ 的极限：\n$$\\lim_{\\omega_b \\to \\infty} T(0) = T_a + \\lim_{\\omega_b \\to \\infty} \\left[ \\frac{q_0}{\\rho_b c_b \\omega_b} \\left(1 - \\frac{1}{\\cosh\\left(\\frac{L}{2}\\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}\\right)}\\right) \\right]$$\n当 $\\omega_b \\to \\infty$ 时，双曲余弦的参数也趋于无穷大。\n$$\\lim_{\\omega_b \\to \\infty} \\cosh\\left(\\frac{L}{2}\\sqrt{\\frac{\\rho_b c_b \\omega_b}{k}}\\right) = \\infty$$\n因此，$\\frac{1}{\\cosh(\\dots)}$ 项趋于 $0$。括号中的项 $ (1 - \\frac{1}{\\cosh(\\dots)})$ 趋于 $1$。\n前置因子 $\\frac{q_0}{\\rho_b c_b \\omega_b}$ 趋于 $0$。\n第二项的整体极限为 $0 \\times 1 = 0$。\n因此，在无限灌注极限下的中心线温度为：\n$$T(0)_{\\omega_b \\to \\infty} = T_a$$\n这在物理上对应于灌注作用占绝对主导地位，以至于它冲刷掉了由新陈代谢产热引起的任何温升，有效地将组织温度钳制在动脉血温度。\n\n中心线温度的两个极限表达式是 $T_a + \\frac{q_0 L^2}{8k}$ 和 $T_a$。",
            "answer": "$$\n\\boxed{\n\\left( T_a + \\frac{q_0 L^2}{8k}, \\ T_a \\right)\n}\n$$"
        },
        {
            "introduction": "尽管解析解能提供深刻的物理洞见，但大多数实际应用，如热疗规划，都涉及复杂的几何形状和热源分布，这使得计算方法成为不可或缺的工具。本任务要求您建立一个二维有限差分模型，以求解由空间变化的能量吸收率（SAR）加热的组织内的温度分布。通过这项计算实践，您将学习如何将连续的物理模型转化为离散的代数系统，并直观地分析血液灌注不仅如何降低峰值温度，而且如何从根本上重塑组织内的热场形态。",
            "id": "3978085",
            "problem": "您的任务是构建并验证一个由空间变化的特定吸收率 (SAR) 驱动的活体组织稳态热传递计算模型。您必须从能量守恒和傅里叶热传导定律出发，推导出待求解的模型。考虑一个均匀、各向同性的组织，占据一个边长为 $L_x = L_y = 0.1$ 米的二维方形域。该组织的常数热导率为 $k$（单位 $\\mathrm{W \\cdot m^{-1} \\cdot K^{-1}}$）、组织密度为 $\\rho_t$（单位 $\\mathrm{kg \\cdot m^{-3}}$）、血液密度为 $\\rho_b$（单位 $\\mathrm{kg \\cdot m^{-3}}$）、血液比热为 $c_b$（单位 $\\mathrm{J \\cdot kg^{-1} \\cdot K^{-1}}$），以及体积灌注率为 $\\omega_b$（单位 $\\mathrm{s^{-1}}$）。动脉（参考）温度是均匀的且等于边界温度，因此温升 $\\Delta T$ 的边界条件是均匀狄利克雷条件，即在 $\\partial \\Omega$ 上 $\\Delta T = 0$。\n\n从静止介质中的能量平衡和傅里叶定律开始，推导域内的稳态控制方程，其中灌注作为体积热沉，以及由空间变化的特定吸收率 (SAR) 引起的外部体积热源项。您可以假设外部体积热源为 $q_{\\mathrm{ext}}(x,y) = \\rho_t S(x,y)$（单位 $\\mathrm{W \\cdot m^{-3}}$），其中 $S(x,y)$（单位 $\\mathrm{W \\cdot kg^{-1}}$）是 SAR 分布图。请勿使用任何预先推导的离散化公式；请从第一性原理出发推导离散系统。\n\n在一个均匀网格上对得到的边值问题进行数值求解，每个方向上至少有 $N_x = N_y = 129$ 个网格点，并对 $\\Delta T$ 使用均匀狄利克雷边界条件。使用与您的推导一致的五点有限差分格式。仔细组装线性系统，并以与物理学一致的方式施加边界条件。您可以使用任何稳定且合适的数值线性代数方法来求解得到的稀疏线性系统。\n\n对于以下每种情况，在相同的域、属性和 SAR 分布图上求解稳态问题两次：一次包含灌注（$\\omega_b  0$），另一次忽略灌注（设置 $\\omega_b = 0$）以表示纯传导。然后，沿着中线 $y = L_y/2$，计算两个定量指标，以表征灌注相对于纯传导是如何重新分布热量的：\n- 振幅缩减因子 $r_{\\mathrm{amp}} = \\dfrac{\\max_{\\Omega} \\Delta T_{\\mathrm{perf}}}{\\max_{\\Omega} \\Delta T_{\\mathrm{cond}}}$，这是一个无量纲量。\n- 基于中线温度分布的均方根 (RMS) 宽度的宽度缩减因子，$r_{\\sigma} = \\dfrac{\\sigma_{\\mathrm{perf}}}{\\sigma_{\\mathrm{cond}}}$，其中对于一个分布 $w(x) = \\Delta T(x, y=L_y/2)$，其质心为 $\\mu = \\dfrac{\\int_0^{L_x} x w(x) \\, dx}{\\int_0^{L_x} w(x) \\, dx}$，RMS 宽度为 $\\sigma = \\sqrt{\\dfrac{\\int_0^{L_x} (x-\\mu)^2 w(x) \\, dx}{\\int_0^{L_x} w(x) \\, dx}}$。将 $r_{\\mathrm{amp}}$ 和 $r_{\\sigma}$ 作为无量纲小数报告。\n\n除非另有说明，否则使用以下物理上合理的参数值：\n- 热导率 $k = 0.5$（单位 $\\mathrm{W \\cdot m^{-1} \\cdot K^{-1}}$）。\n- 组织密度 $\\rho_t = 1000$（单位 $\\mathrm{kg \\cdot m^{-3}}$）。\n- 血液密度 $\\rho_b = 1060$（单位 $\\mathrm{kg \\cdot m^{-3}}$）。\n- 血液比热 $c_b = 3600$（单位 $\\mathrm{J \\cdot kg^{-1} \\cdot K^{-1}}$）。\n- 包含灌注的求解中，体积灌注率 $\\omega_b = 0.005$（单位 $\\mathrm{s^{-1}}$）。\n- 对于纯传导求解，设置 $\\omega_b = 0$。\n\n定义测试套件的 SAR 分布图 $S(x,y)$ 如下，其中 $x \\in [0,L_x]$ 且 $y \\in [0,L_y]$：\n- 情况 A（窄热点）：一个以域中心为中心的高斯分布，标准差 $\\sigma_A = 0.005$ 米，峰值振幅 $S_{0A} = 10$（单位 $\\mathrm{W \\cdot kg^{-1}}$），即 $S_A(x,y) = S_{0A} \\exp\\!\\left(-\\dfrac{(x - L_x/2)^2 + (y - L_y/2)^2}{2 \\sigma_A^2}\\right)$。\n- 情况 B（宽热点）：一个以域中心为中心的高斯分布，标准差 $\\sigma_B = 0.03$ 米，峰值振幅 $S_{0B} = 5$（单位 $\\mathrm{W \\cdot kg^{-1}}$），即 $S_B(x,y) = S_{0B} \\exp\\!\\left(-\\dfrac{(x - L_x/2)^2 + (y - L_y/2)^2}{2 \\sigma_B^2}\\right)$。\n- 情况 C（双瓣）：两个相同的高斯分布的叠加，标准差 $\\sigma_C = 0.008$ 米，峰值振幅 $S_{0C} = 8$（单位 $\\mathrm{W \\cdot kg^{-1}}$），中心分别位于 $(x_{C1}, y_{C1}) = (0.035, L_y/2)$ 和 $(x_{C2}, y_{C2}) = (0.065, L_y/2)$，即 $S_C(x,y) = S_{0C} \\exp\\!\\left(-\\dfrac{(x - x_{C1})^2 + (y - y_{C1})^2}{2 \\sigma_C^2}\\right) + S_{0C} \\exp\\!\\left(-\\dfrac{(x - x_{C2})^2 + (y - y_{C2})^2}{2 \\sigma_C^2}\\right)$。\n\n对于每种情况，使用上述定义计算 $r_{\\mathrm{amp}}$ 和 $r_{\\sigma}}$。所有最终报告的量均为无量纲小数。您的程序应生成单行输出，包含六个结果，按 $[r_{\\mathrm{amp},A}, r_{\\sigma,A}, r_{\\mathrm{amp},B}, r_{\\sigma,B}, r_{\\mathrm{amp},C}, r_{\\sigma,C}]$ 的顺序排列，每个结果四舍五入到六位小数，列表中没有空格。\n\n您的程序需要实现的测试套件摘要：\n- 情况 A：窄高斯 SAR，$\\sigma_A = 0.005$ 米，$S_{0A} = 10$（单位 $\\mathrm{W \\cdot kg^{-1}}$）。\n- 情况 B：宽高斯 SAR，$\\sigma_B = 0.03$ 米，$S_{0B} = 5$（单位 $\\mathrm{W \\cdot kg^{-1}}$）。\n- 情况 C：双瓣 SAR，$\\sigma_C = 0.008$ 米，$S_{0C} = 8$（单位 $\\mathrm{W \\cdot kg^{-1}}$），中心位于 $x_{C1} = 0.035$ 米和 $x_{C2} = 0.065$ 米，沿 $y = L_y/2$。\n\n所有温升的计算单位为开尔文，但要求的输出 $r_{\\mathrm{amp}}$ 和 $r_{\\sigma}$ 是无量纲小数。确保在域边界上施加边界条件 $\\Delta T = 0$，并且数值解稳定且与所述物理学一致。",
            "solution": "用户提供了一个计算热工学领域的问题，特别关注在不同条件下求解 Pennes 生物热模型。该问题定义明确、科学上合理且计算上可行。所有必需的数据和参数都已提供，目标也已明确说明。因此，该问题被认为是有效的。\n\n### I. 控制方程的推导\n\n该问题要求从第一性原理推导控制方程。我们从应用于静止、产热介质内微分控制体 $dV$ 的能量守恒原理开始。在稳态下，能量积累率为零，从而导致进入控制体的净热传导速率与控制体内能量生成速率之间的平衡。\n\n进入控制体的净热传导速率由热通量矢量 $\\vec{q}$ 的散度在体积上的积分给出：$-\\int_V \\nabla \\cdot \\vec{q} \\, dV$。\n单位体积生热率为 $\\int_V q_{gen} \\, dV$，其中 $q_{gen}$ 是单位体积的生成率，单位为 $\\mathrm{W \\cdot m^{-3}}$。\n\n任意控制体的稳态能量平衡为：\n$$-\\int_V \\nabla \\cdot \\vec{q} \\, dV + \\int_V q_{gen} \\, dV = 0$$\n由于这必须对任意体积 $V$ 成立，因此被积函数本身在每一点上都必须为零：\n$$-\\nabla \\cdot \\vec{q} + q_{gen} = 0$$\n\n傅里叶热传导定律将热通量矢量 $\\vec{q}$ 与温度梯度 $\\nabla T$ 联系起来：\n$$\\vec{q} = -k \\nabla T$$\n其中 $k$ 是组织的热导率，单位为 $\\mathrm{W \\cdot m^{-1} \\cdot K^{-1}}$。假设组织是均匀且各向同性的，则 $k$ 是一个常数标量。将傅里叶定律代入能量平衡方程，得到：\n$$-\\nabla \\cdot (-k \\nabla T) + q_{gen} = 0$$\n$$k \\nabla^2 T + q_{gen} = 0$$\n其中 $\\nabla^2$ 是拉普拉斯算子。\n\n总体积生热率 $q_{gen}$ 是两项之和：\n1.  由特定吸收率 (SAR) 引起的外部加热 $q_{\\mathrm{ext}}$。\n2.  由血液灌注引起的热交换 $q_p$。\n\n外部加热项由 $q_{\\mathrm{ext}} = \\rho_t S(x,y)$ 给出，其中 $\\rho_t$ 是组织密度，$S(x,y)$ 是空间变化的 SAR。\n\nPennes 的灌注模型将血液视为一个分布式热沉。它假设血液以均匀的动脉温度 $T_a$ 进入组织毛细血管，并在与局部组织温度 $T(x,y)$ 达到热平衡时流出。因此，从组织中移除的热量与局部温差 $(T - T_a)$、血液的体积热容 ($\\rho_b c_b$) 和体积灌注率 ($\\omega_b$，单位 $\\mathrm{s^{-1}}$) 成正比。\n$$q_p = \\rho_b c_b \\omega_b (T_a - T)$$\n\n合并这些项，总生成率为 $q_{gen} = q_{\\mathrm{ext}} + q_p = \\rho_t S(x,y) + \\rho_b c_b \\omega_b (T_a - T)$。将其代入热方程，得到稳态 Pennes 生物热方程：\n$$k \\nabla^2 T + \\rho_t S(x,y) + \\rho_b c_b \\omega_b (T_a - T) = 0$$\n最好用温升 $\\Delta T = T - T_a$ 来表述此问题。由于 $T_a$ 是常数，我们有 $\\nabla T = \\nabla(\\Delta T)$ 和 $\\nabla^2 T = \\nabla^2(\\Delta T)$。灌注项变为 $\\rho_b c_b \\omega_b (T_a - (\\Delta T + T_a)) = -\\rho_b c_b \\omega_b \\Delta T$。温升的控制方程为：\n$$k \\nabla^2(\\Delta T) - \\rho_b c_b \\omega_b \\Delta T + \\rho_t S(x,y) = 0$$\n这是一个亥姆霍兹型椭圆偏微分方程。边界条件是均匀狄利克雷条件，即在域边界 $\\partial\\Omega$ 上 $\\Delta T = 0$。\n\n### II. 数值离散化\n\n为了对该方程进行数值求解，我们使用一个具有 $N_x = N_y = N = 129$ 个点的均匀网格对二维域 $[0, L_x] \\times [0, L_y]$ 进行离散化。网格间距为 $h = L_x/(N-1) = L_y/(N-1)$。网格点用 $(x_i, y_j) = (i h, j h)$ 表示，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。令 $\\Delta T_{i,j}$ 为 $\\Delta T(x_i, y_j)$ 的数值近似。\n\n在内部网格点 $(i,j)$ 处，拉普拉斯算子 $\\nabla^2(\\Delta T)$ 使用五点中心差分格式进行近似：\n$$\\nabla^2(\\Delta T)\\bigg|_{i,j} \\approx \\frac{\\Delta T_{i+1,j} - 2\\Delta T_{i,j} + \\Delta T_{i-1,j}}{h^2} + \\frac{\\Delta T_{i,j+1} - 2\\Delta T_{i,j} + \\Delta T_{i,j-1}}{h^2}$$\n$$\\nabla^2(\\Delta T)\\bigg|_{i,j} \\approx \\frac{1}{h^2} \\left( \\Delta T_{i+1,j} + \\Delta T_{i-1,j} + \\Delta T_{i,j+1} + \\Delta T_{i,j-1} - 4\\Delta T_{i,j} \\right)$$\n将此近似代入 $\\Delta T$ 的控制方程，得到每个内部节点 $(i,j)$（其中 $i,j \\in \\{1, \\dots, N-2\\}$）的离散方程：\n$$\\frac{k}{h^2} \\left( \\Delta T_{i+1,j} + \\Delta T_{i-1,j} + \\Delta T_{i,j+1} + \\Delta T_{i,j-1} - 4\\Delta T_{i,j} \\right) - \\rho_b c_b \\omega_b \\Delta T_{i,j} + \\rho_t S_{i,j} = 0$$\n重新整理，将未知的 $\\Delta T$ 项组合在左侧，得到每个内部节点的线性代数方程：\n$$\\frac{k}{h^2} (\\Delta T_{i-1,j} + \\Delta T_{i+1,j} + \\Delta T_{i,j-1} + \\Delta T_{i,j+1}) - \\left(\\frac{4k}{h^2} + \\rho_b c_b \\omega_b\\right) \\Delta T_{i,j} = -\\rho_t S_{i,j}$$\n问题被简化为求解一个包含 $(N-2) \\times (N-2)$ 个线性方程的方程组 $A\\vec{u} = \\vec{b}$。向量 $\\vec{u}$ 包含内部网格点处的未知温升 $\\Delta T_{i,j}$，并被展平为一维数组。矩阵 $A$ 是一个大的、稀疏的、对角占优的块三对角矩阵，而 $\\vec{b}$ 是从 SAR 分布图导出的源向量。均匀狄利克雷边界条件（对于边界上的任何 $i$ 或 $j$，$\\Delta T_{i,j}=0$）在该系统的组装过程中被整合。例如，对于与左边界相邻的内部节点 $(1, j)$，项 $\\Delta T_{0,j}$ 已知为 $0$，因此从方程中消失。\n\n求解过程如下：\n1.  为每种情况在网格上构建 SAR 分布图 $S(x,y)$。\n2.  对每个 SAR 分布图求解两次问题：一次有灌注（$\\omega_b = 0.005 \\, s^{-1}$），一次无灌注（$\\omega_b = 0$）。\n3.  对于每次求解，组装与内部节点对应的稀疏矩阵 $A$ 和源向量 $\\vec{b}$。使用像 `scipy.sparse.linalg.spsolve` 这样的稀疏线性求解器来求解该系统。\n4.  通过用零值边界填充内部解，重构完整的二维温升场 $\\Delta T$。\n5.  从得到的两个温度场计算所需的指标（$r_{\\mathrm{amp}}$ 和 $r_{\\sigma}$）。RMS 宽度 $\\sigma$ 使用梯形法则进行数值积分计算。\n\n振幅缩减因子 $r_{\\mathrm{amp}}$ 量化了由灌注引起的峰值温度降低，而宽度缩减因子 $r_{\\sigma}$ 量化了灌注如何影响沿中线的温度分布的空间扩散。灌注作为一个热沉，在温度较高的地方作用更强，从而降低峰值温度，并常常“扁平化”分布，这可能会矛盾地导致更宽的有效轮廓，具体取决于定义和热源。数值评估将揭示其精确效果。",
            "answer": "```python\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to solve the bioheat problem for all test cases and print the results.\n    \"\"\"\n    # Define physical and numerical parameters\n    L = 0.1  # Domain side length [m]\n    k = 0.5  # Thermal conductivity [W/(m.K)]\n    rho_t = 1000  # Tissue density [kg/m^3]\n    rho_b = 1060  # Blood density [kg/m^3]\n    c_b = 3600  # Blood specific heat [J/(kg.K)]\n    omega_b_perf = 0.005  # Volumetric perfusion rate [1/s]\n    N = 129  # Number of grid points in each direction\n\n    test_cases = [\n        # (case_id, S0, sigma, centers)\n        ('A', 10.0, 0.005, None),\n        ('B', 5.0, 0.03, None),\n        ('C', 8.0, 0.008, [(0.035, L / 2.0), (0.065, L / 2.0)])\n    ]\n    \n    results = []\n\n    for case_id, S0, sigma, centers in test_cases:\n        S_map = _setup_sar_map(case_id, L, N, S0, sigma, centers)\n\n        # Solve for conduction-only case (omega_b = 0)\n        delta_T_cond = _solve_bvp(0.0, S_map, L, N, k, rho_t, rho_b, c_b)\n        \n        # Solve for perfusion case\n        delta_T_perf = _solve_bvp(omega_b_perf, S_map, L, N, k, rho_t, rho_b, c_b)\n\n        # Calculate and store metrics\n        r_amp, r_sigma = _calculate_metrics(delta_T_perf, delta_T_cond, L, N)\n        results.extend([r_amp, r_sigma])\n\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef _setup_sar_map(case_id, L, N, S0, sigma, centers=None):\n    \"\"\"\n    Generates the 2D SAR map for a given case configuration.\n    \"\"\"\n    x = np.linspace(0, L, N)\n    y = np.linspace(0, L, N)\n    xx, yy = np.meshgrid(x, y)\n    \n    if case_id in ['A', 'B']:\n        x_c, y_c = L / 2.0, L / 2.0\n        S_map = S0 * np.exp(-((xx - x_c)**2 + (yy - y_c)**2) / (2.0 * sigma**2))\n    elif case_id == 'C':\n        (x_c1, y_c1) = centers[0]\n        (x_c2, y_c2) = centers[1]\n        S1 = S0 * np.exp(-((xx - x_c1)**2 + (yy - y_c1)**2) / (2.0 * sigma**2))\n        S2 = S0 * np.exp(-((xx - x_c2)**2 + (yy - y_c2)**2) / (2.0 * sigma**2))\n        S_map = S1 + S2\n    else:\n        raise ValueError(\"Unknown case ID\")\n        \n    return S_map\n\ndef _solve_bvp(omega_b, S_map, L, N, k, rho_t, rho_b, c_b):\n    \"\"\"\n    Solves the 2D steady-state bioheat BVP using a finite difference method.\n    \"\"\"\n    h = L / (N - 1.0)\n    N_int = N - 2\n    N_unk = N_int * N_int\n\n    # Coefficients from discretization\n    W_b = rho_b * c_b * omega_b\n    C_center = -(4.0 * k / h**2 + W_b)\n    C_neighbor = k / h**2\n\n    # Assemble the sparse matrix A using LIL format for clarity\n    A = sparse.lil_matrix((N_unk, N_unk))\n    for j_int in range(N_int):  # y-index of interior grid\n        for i_int in range(N_int):  # x-index of interior grid\n            p = j_int * N_int + i_int  # 1D index\n            \n            A[p, p] = C_center\n            \n            # West neighbor\n            if i_int > 0:\n                A[p, p - 1] = C_neighbor\n            # East neighbor\n            if i_int  N_int - 1:\n                A[p, p + 1] = C_neighbor\n            # South neighbor (y increases downwards in matrix indexing)\n            if j_int > 0:\n                A[p, p - N_int] = C_neighbor\n            # North neighbor\n            if j_int  N_int - 1:\n                A[p, p + N_int] = C_neighbor\n    \n    A = A.tocsr() # Convert to CSR for efficient solving\n\n    # Assemble the RHS vector b\n    S_interior = S_map[1:-1, 1:-1]\n    b = -rho_t * S_interior.flatten()\n\n    # Solve the linear system\n    delta_T_flat = spsolve(A, b)\n\n    # Reshape solution and pad with boundary zeros\n    delta_T_interior = delta_T_flat.reshape((N_int, N_int))\n    delta_T = np.zeros((N, N))\n    delta_T[1:-1, 1:-1] = delta_T_interior\n\n    return delta_T\n\ndef _calculate_metrics(delta_T_perf, delta_T_cond, L, N):\n    \"\"\"\n    Calculates the amplitude and width reduction factors.\n    \"\"\"\n    x_coords = np.linspace(0, L, N)\n    mid_y_idx = (N - 1) // 2\n\n    # Amplitude reduction factor\n    max_perf = np.max(delta_T_perf)\n    max_cond = np.max(delta_T_cond)\n    \n    if max_cond == 0:\n        r_amp = 0.0 if max_perf == 0.0 else np.inf\n    else:\n        r_amp = max_perf / max_cond\n\n    # RMS width calculation\n    def get_rms_width(w, x):\n        if np.all(w == 0): return 0.0\n        \n        # Using trapezoidal rule for integration\n        norm_integral = np.trapz(w, x)\n        if norm_integral == 0: return 0.0\n        \n        mu = np.trapz(x * w, x) / norm_integral\n        var_integral = np.trapz((x - mu)**2 * w, x)\n        \n        # Clamp to avoid sqrt of small negative number due to precision errors\n        variance = max(0, var_integral / norm_integral)\n        sigma = np.sqrt(variance)\n        return sigma\n\n    w_perf = delta_T_perf[mid_y_idx, :]\n    w_cond = delta_T_cond[mid_y_idx, :]\n\n    sigma_perf = get_rms_width(w_perf, x_coords)\n    sigma_cond = get_rms_width(w_cond, x_coords)\n\n    if sigma_cond == 0:\n        r_sigma = 0.0 if sigma_perf == 0 else np.inf\n    else:\n        r_sigma = sigma_perf / sigma_cond\n        \n    return r_amp, r_sigma\n\nsolve()\n```"
        }
    ]
}