{
    "hands_on_practices": [
        {
            "introduction": "A complete thermal model of a battery requires a precise accounting of all heat sources. Beyond the familiar irreversible Joule heating, a second, more subtle thermodynamic effect known as reversible or \"entropic\" heat plays a significant role. This exercise challenges you to derive the expression for this heat source from the fundamental Gibbs free energy relation, connecting electrochemical principles to practical thermal analysis . Performing this calculation will deepen your understanding of the complex interplay between thermodynamics and heat generation in battery cells.",
            "id": "3997674",
            "problem": "In a single lithium-ion cell within a battery module, the reversible heat generation (also known as entropic heat) arises from the temperature dependence of the open-circuit voltage. Consider isobaric conditions and negligible compositional transients over the time of interest, such that the open-circuit voltage $U$ depends only on temperature $T$ at fixed state of charge. Starting from the Gibbs free energy relation $dG=-S\\,dT+V\\,dP+\\sum_i \\mu_i\\,dn_i$ and the definition of the cell open-circuit voltage as the electrical work per unit charge, derive an expression for the reversible heat rate in terms of the current $I$, the temperature $T$, and the partial derivative $\\partial U/\\partial T$ at fixed composition. Then, evaluate this reversible heat rate for a cell discharging at $I = 50$ A and $T = 298$ K with a measured temperature coefficient $\\partial U/\\partial T = -0.2$ mV/K. State whether the cell undergoes reversible heating or reversible cooling at these operating conditions based on the sign of the heat rate. Round your numerical answer for the reversible heat rate to three significant figures and express it in W. Report only the numerical value of the reversible heat rate as your final answer.",
            "solution": "The problem statement is first validated against the required criteria.\n\n### Step 1: Extract Givens\n- Fundamental thermodynamic relation: $dG=-S\\,dT+V\\,dP+\\sum_i \\mu_i\\,dn_i$\n- System condition: isobaric ($dP=0$)\n- System condition: negligible compositional transients (state of charge is fixed for the partial derivative)\n- Open-circuit voltage $U$ is a function of temperature $T$ only, at a fixed state of charge.\n- Definition context: cell open-circuit voltage is electrical work per unit charge.\n- Current: $I = 50$ A (discharging)\n- Temperature: $T = 298$ K\n- Temperature coefficient of open-circuit voltage: $\\frac{\\partial U}{\\partial T} = -0.2$ mV/K\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on fundamental principles of thermodynamics and electrochemistry, specifically the Gibbs free energy and its relation to electrochemical potential and entropy. The concept of entropic or reversible heat in a battery is a well-established scientific principle.\n- **Well-Posed**: The problem is clearly structured. It requests a derivation followed by a numerical calculation. All necessary data for the calculation ($I$, $T$, $\\partial U/\\partial T$) are provided. The requested output is well-defined.\n- **Objective**: The language is precise and unbiased, using standard scientific terminology.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, and self-contained. A complete solution will be provided.\n\nThe derivation for the reversible heat rate begins with the differential of the Gibbs free energy, $G$:\n$$dG = -S\\,dT + V\\,dP + \\sum_i \\mu_i\\,dn_i$$\nHere, $S$ is entropy, $T$ is absolute temperature, $V$ is volume, $P$ is pressure, $\\mu_i$ are the chemical potentials of species $i$, and $n_i$ are the mole numbers.\n\nUnder isobaric conditions, the change in pressure $dP$ is zero, so the $V\\,dP$ term vanishes:\n$$dG = -S\\,dT + \\sum_i \\mu_i\\,dn_i$$\nThe term $\\sum_i \\mu_i\\,dn_i$ represents the change in Gibbs free energy due to the chemical reaction at constant $T$ and $P$. This change is equal to the maximum non-$PV$ work that can be extracted from the system. In an electrochemical cell, this is the reversible electrical work. The electrical work done *by* the cell when an infinitesimal charge $dq$ flows is $U\\,dq$, where $U$ is the open-circuit voltage. The change in Gibbs energy is the negative of the work done by the system, so:\n$$\\sum_i \\mu_i\\,dn_i = -U\\,dq$$\nSubstituting this into the expression for $dG$ gives:\n$$dG = -S\\,dT - U\\,dq$$\nThis expression shows $G$ as a state function of temperature $T$ and charge passed $q$. As $dG$ is an exact differential, we can write:\n$$dG = \\left(\\frac{\\partial G}{\\partial T}\\right)_q dT + \\left(\\frac{\\partial G}{\\partial q}\\right)_T dq$$\nBy comparing the two expressions for $dG$, we can identify the partial derivatives:\n$$\\left(\\frac{\\partial G}{\\partial T}\\right)_q = -S$$\n$$\\left(\\frac{\\partial G}{\\partial q}\\right)_T = -U$$\nSince $G$ is a well-behaved state function, its mixed second partial derivatives must be equal (Maxwell's relation):\n$$\\frac{\\partial}{\\partial q}\\left(\\frac{\\partial G}{\\partial T}\\right)_q = \\frac{\\partial}{\\partial T}\\left(\\frac{\\partial G}{\\partial q}\\right)_T$$\nSubstituting the expressions for the first derivatives yields:\n$$\\frac{\\partial}{\\partial q}(-S) = \\frac{\\partial}{\\partial T}(-U)$$\n$$-\\left(\\frac{\\partial S}{\\partial q}\\right)_T = -\\left(\\frac{\\partial U}{\\partial T}\\right)_q$$\nTherefore, we arrive at the following thermodynamic identity for an electrochemical cell:\n$$\\left(\\frac{\\partial S}{\\partial q}\\right)_T = \\left(\\frac{\\partial U}{\\partial T}\\right)_q$$\nThe problem asks for the reversible heat rate, $\\dot{Q}_{rev}$. From the second law of thermodynamics, for a reversible process, the incremental heat absorbed by the system is $dQ_{rev} = T\\,dS$. The rate of heat absorption is thus:\n$$\\dot{Q}_{rev} = T \\frac{dS}{dt}$$\nUsing the chain rule, we can express $\\frac{dS}{dt}$ in terms of the rate of charge flow. Assuming constant temperature:\n$$\\frac{dS}{dt} = \\left(\\frac{\\partial S}{\\partial q}\\right)_T \\frac{dq}{dt}$$\nThe rate of charge flow, $\\frac{dq}{dt}$, is the electric current, $I$. For a discharging cell, a positive current $I$ flows out of the positive terminal.\n$$\\frac{dq}{dt} = I$$\nSubstituting this into the expression for $\\dot{Q}_{rev}$:\n$$\\dot{Q}_{rev} = T \\cdot I \\cdot \\left(\\frac{\\partial S}{\\partial q}\\right)_T$$\nFinally, using the Maxwell relation we derived, we substitute $\\left(\\frac{\\partial U}{\\partial T}\\right)_q$ for $\\left(\\frac{\\partial S}{\\partial q}\\right)_T$:\n$$\\dot{Q}_{rev} = I \\cdot T \\cdot \\left(\\frac{\\partial U}{\\partial T}\\right)_q$$\nThis is the derived expression for the reversible heat rate. A positive value for $\\dot{Q}_{rev}$ signifies heat absorption by the cell (endothermic process, or reversible cooling), while a negative value signifies heat release (exothermic process, or reversible heating).\n\nNext, we evaluate this expression using the given numerical values:\n- Current $I = 50$ A\n- Temperature $T = 298$ K\n- Temperature coefficient $\\frac{\\partial U}{\\partial T} = -0.2$ mV/K $= -0.2 \\times 10^{-3}$ V/K\n\nSubstituting these values into the derived formula:\n$$\\dot{Q}_{rev} = (50 \\text{ A}) \\cdot (298 \\text{ K}) \\cdot (-0.2 \\times 10^{-3} \\text{ V/K})$$\n$$\\dot{Q}_{rev} = (50 \\cdot 298 \\cdot -0.2 \\times 10^{-3}) \\text{ W}$$\n$$\\dot{Q}_{rev} = (14900) \\cdot (-0.2 \\times 10^{-3}) \\text{ W}$$\n$$\\dot{Q}_{rev} = -2.98 \\text{ W}$$\nThe result, rounded to three significant figures as requested, is $-2.98$ W.\n\nThe sign of the reversible heat rate is negative. This indicates that heat is being released by the cell into its surroundings. Therefore, at these operating conditions, the cell undergoes reversible heating.",
            "answer": "$$\n\\boxed{-2.98}\n$$"
        },
        {
            "introduction": "Once heat is generated within a cell, it must be conducted to the surface to be dissipated, creating internal temperature gradients. This practice guides you through the derivation of the steady-state radial temperature profile within a cylindrical cell, starting from the heat conduction equation . By solving for the temperature as a function of radius, you will gain crucial, quantitative insight into how a cell's size and internal thermal conductivity drive the core-to-surface temperature difference, a critical parameter for battery safety and performance.",
            "id": "3997654",
            "problem": "A long, solid cylindrical Lithium-ion (Li-ion) cell of radius $R$ experiences uniform internal volumetric heat generation $\\;q'''\\;$ due to electrochemical reactions and ohmic losses during high-rate operation. The thermal conductivity $k$ of the active region is isotropic and spatially constant, and end effects are negligible so that heat transfer is purely radial. The outer surface at $r=R$ is exposed to a coolant that provides a uniform convective heat transfer coefficient $h$ to an ambient fluid at temperature $T_{\\infty}$. Assume steady state, no axial gradients, and no radiation.\n\nStarting from energy conservation in a continuum and Fourierâ€™s law of heat conduction, derive the closed-form steady radial temperature profile $T(r)$ within the cell subject to the symmetry condition at $r=0$ and the convective boundary at $r=R$. Then, obtain a closed-form expression for the core-to-surface temperature difference $\\Delta T_{cs} \\equiv T(0) - T(R)$ and interpret its parametric dependence in terms of $q'''$, $k$, $h$, and $R$.\n\nExpress the final temperature profile and the core-to-surface temperature difference as analytic expressions in terms of $q'''$, $k$, $h$, $R$, and $T_{\\infty}$. Temperatures should be expressed in Kelvin. No numerical substitution or rounding is required. Provide your final answer as a two-entry row matrix, where the first entry is $T(r)$ and the second entry is $\\Delta T_{cs}$.",
            "solution": "The problem is assessed to be valid as it represents a well-posed, scientifically grounded problem in heat conduction, free of contradictions, ambiguities, or factual unsoundness. It requires the derivation of a temperature profile from first principles, which is a standard and meaningful task in thermal engineering.\n\nThe physical system under consideration is a long solid cylinder of radius $R$ with uniform internal heat generation $q'''$ and constant thermal conductivity $k$. Heat transfer is one-dimensional in the radial direction, $r$. The governing equation for steady-state heat conduction in cylindrical coordinates with internal heat generation is derived from the principle of energy conservation.\n\nConsidering a cylindrical shell of infinitesimal thickness $dr$ at a radial position $r$ and of length $L$, the energy balance at steady state is:\n(Rate of heat conducted into the shell at $r$) + (Rate of heat generated within the shell) = (Rate of heat conducted out of the shell at $r+dr$).\n\nLet $q_r$ be the radial heat rate. The energy balance can be written as:\n$$ q_r + d\\dot{E}_{gen} = q_{r+dr} $$\nThe rate of heat generation within the differential volume $dV = (2\\pi r L) dr$ is $d\\dot{E}_{gen} = q''' (2\\pi r L dr)$.\nThe difference in heat rate across the shell is $q_{r+dr} - q_r = d_r q_r$. Thus:\n$$ d_r q_r = q''' (2\\pi r L dr) $$\nDividing by $dr$ and $L$ gives the change in heat rate per unit length:\n$$ \\frac{d}{dr} \\left( \\frac{q_r}{L} \\right) = 2\\pi r q''' $$\nThe radial heat rate $q_r$ is related to the heat flux $q''_r$ by $q_r = q''_r A_r = q''_r (2\\pi r L)$. Substituting this into the previous equation is not the most direct path. A more direct formulation from the general heat diffusion equation is preferred.\n\nThe general heat diffusion equation in cylindrical coordinates is:\n$$ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(k r \\frac{\\partial T}{\\partial r}\\right) + \\frac{1}{r^2}\\frac{\\partial}{\\partial \\phi}\\left(k \\frac{\\partial T}{\\partial \\phi}\\right) + \\frac{\\partial}{\\partial z}\\left(k \\frac{\\partial T}{\\partial z}\\right) + q''' = \\rho c_p \\frac{\\partial T}{\\partial t} $$\nApplying the problem's simplifying assumptions:\n1.  Steady state: $\\frac{\\partial T}{\\partial t} = 0$.\n2.  Negligible end effects and no axial gradients: $\\frac{\\partial T}{\\partial z} = 0$.\n3.  Purely radial heat transfer implies azimuthal symmetry: $\\frac{\\partial T}{\\partial \\phi} = 0$.\n4.  Spatially constant thermal conductivity $k$.\n\nThe equation reduces to an ordinary differential equation (ODE):\n$$ \\frac{1}{r}\\frac{d}{dr}\\left(k r \\frac{dT}{dr}\\right) + q''' = 0 $$\nSince $k$ is constant, we can write:\n$$ \\frac{k}{r}\\frac{d}{dr}\\left(r \\frac{dT}{dr}\\right) + q''' = 0 $$\nRearranging yields the governing ODE for the temperature profile $T(r)$:\n$$ \\frac{d}{dr}\\left(r \\frac{dT}{dr}\\right) = -\\frac{q'''}{k} r $$\nWe solve this equation by integrating twice with respect to $r$. The first integration gives:\n$$ r \\frac{dT}{dr} = -\\int \\frac{q'''}{k} r \\,dr = -\\frac{q'''}{2k} r^2 + C_1 $$\nwhere $C_1$ is an integration constant. Dividing by $r$ gives the temperature gradient:\n$$ \\frac{dT}{dr} = -\\frac{q'''}{2k} r + \\frac{C_1}{r} $$\nThe second integration yields the general solution for the temperature profile:\n$$ T(r) = \\int \\left(-\\frac{q'''}{2k} r + \\frac{C_1}{r}\\right) dr = -\\frac{q'''}{4k} r^2 + C_1 \\ln(r) + C_2 $$\nwhere $C_2$ is a second integration constant. The constants $C_1$ and $C_2$ are determined from the boundary conditions.\n\nThe first boundary condition is the symmetry condition at the centerline of the cylinder ($r=0$). The temperature profile must be symmetric about the axis, which implies that the temperature gradient must be zero at $r=0$.\n$$ \\left.\\frac{dT}{dr}\\right|_{r=0} = 0 $$\nApplying this condition to the expression for the temperature gradient:\n$$ 0 = -\\frac{q'''}{2k}(0) + \\lim_{r \\to 0} \\frac{C_1}{r} $$\nFor the right-hand side to be zero, the term $\\frac{C_1}{r}$ must not be singular. This is only possible if $C_1 = 0$. This also ensures that the temperature $T(r=0)$ is finite, as the $\\ln(r)$ term in the solution for $T(r)$ would otherwise diverge at $r=0$.\nWith $C_1=0$, the solution simplifies to:\n$$ T(r) = -\\frac{q'''}{4k} r^2 + C_2 $$\n$$ \\frac{dT}{dr} = -\\frac{q'''}{2k} r $$\n\nThe second boundary condition is at the outer surface ($r=R$), where heat conducted to the surface is transferred to the ambient fluid via convection. The energy balance at the surface is:\n$$ q''_{\\text{conduction}} = q''_{\\text{convection}} $$\n$$ -k \\left.\\frac{dT}{dr}\\right|_{r=R} = h [T(R) - T_{\\infty}] $$\nSubstituting the expression for the temperature gradient at $r=R$:\n$$ -k \\left(-\\frac{q''' R}{2k}\\right) = h [T(R) - T_{\\infty}] $$\n$$ \\frac{q''' R}{2} = h [T(R) - T_{\\infty}] $$\nThis equation allows us to determine the surface temperature, $T(R)$:\n$$ T(R) = T_{\\infty} + \\frac{q''' R}{2h} $$\nNow we use this result to determine the constant $C_2$. From the simplified temperature profile, we evaluate it at $r=R$:\n$$ T(R) = -\\frac{q''' R^2}{4k} + C_2 $$\nEquating the two expressions for $T(R)$:\n$$ T_{\\infty} + \\frac{q''' R}{2h} = -\\frac{q''' R^2}{4k} + C_2 $$\nSolving for $C_2$:\n$$ C_2 = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} $$\nSubstituting the expressions for $C_1$ and $C_2$ back into the general solution for $T(r)$, we obtain the final closed-form temperature profile:\n$$ T(r) = -\\frac{q'''}{4k} r^2 + \\left( T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} \\right) $$\nThis can be rearranged into a more interpretable form:\n$$ T(r) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - r^2) $$\nThis expression gives the temperature $T$ at any radial position $r$ within the cylinder.\n\nNext, we derive the core-to-surface temperature difference, $\\Delta T_{cs} \\equiv T(0) - T(R)$.\nThe core temperature, $T(0)$, is found by setting $r=0$ in the temperature profile:\n$$ T(0) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - 0) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} $$\nThe surface temperature, $T(R)$, was previously determined as:\n$$ T(R) = T_{\\infty} + \\frac{q''' R}{2h} $$\nThe difference is therefore:\n$$ \\Delta T_{cs} = T(0) - T(R) = \\left( T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} \\right) - \\left( T_{\\infty} + \\frac{q''' R}{2h} \\right) $$\n$$ \\Delta T_{cs} = \\frac{q''' R^2}{4k} $$\n\n**Interpretation of Parametric Dependence of $\\Delta T_{cs}$:**\nThe expression $\\Delta T_{cs} = \\frac{q''' R^2}{4k}$ reveals the following physical dependencies for the temperature drop within the solid cylinder:\n1.  **Heat Generation ($q'''$):** $\\Delta T_{cs}$ is directly proportional to $q'''$. A higher rate of internal heat generation leads to a steeper internal temperature gradient and a larger core-to-surface temperature difference.\n2.  **Radius ($R$):** $\\Delta T_{cs}$ is proportional to the square of the radius, $R^2$. This is a critical insight, indicating that the internal temperature rise is significantly more pronounced in larger-diameter cells. Doubling the radius quadruples this internal temperature difference, all else being equal.\n3.  **Thermal Conductivity ($k$):** $\\Delta T_{cs}$ is inversely proportional to $k$. A material with high thermal conductivity can more effectively conduct heat from the core to the surface, resulting in a smaller internal temperature difference.\n4.  **Convective Conditions ($h$, $T_{\\infty}$):** Notably, $\\Delta T_{cs}$ is independent of the convective heat transfer coefficient $h$ and the ambient temperature $T_{\\infty}$. These external parameters determine the temperature of the surface itself, $T(R)$, and thus shift the entire temperature profile up or down, but they do not affect the magnitude of the temperature difference between the core and the surface, which is solely a function of internal heat generation and conduction.\n\nThe two required expressions are the temperature profile $T(r)$ and the core-to-surface difference $\\Delta T_{cs}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nT_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - r^2) & \\frac{q''' R^2}{4k}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In a real-world Battery Management System (BMS), the critical core temperature is not directly accessible, yet it must be monitored to ensure safety and longevity. This advanced computational practice bridges theory and application by asking you to design an estimator for this hidden state . You will combine a dynamic thermal network model with modern estimation theory to build an Extended Kalman Filter (EKF) that fuses model predictions with noisy surface temperature measurements, a core skill for developing sophisticated thermal management strategies.",
            "id": "3997667",
            "problem": "A cylindrical lithium-ion battery cell is represented by a two-node lumped thermal network with a core node and a surface node. The goal is to estimate the core temperature using only surface temperature measurements and a known current profile, by deriving and implementing an Extended Kalman Filter (EKF), where Extended Kalman Filter (EKF) denotes a recursive Bayesian estimator for nonlinear systems that linearizes about the current estimate. The derivation must begin from the First Law of Thermodynamics (energy conservation) and standard heat transfer relations. The battery generates heat due to its internal resistance, which depends on core temperature, and loses heat to the environment through the surface.\n\nStarting from the following fundamental base:\n- Energy balance at the core node: $$C_c \\frac{d T_c}{dt} = q(T_c,I) - \\frac{T_c - T_s}{R_{cs}},$$ where $C_c$ is the core thermal capacitance, $T_c$ is the core temperature, $T_s$ is the surface temperature, $I$ is the current, $q(T_c,I)$ is the heat generation rate, and $R_{cs}$ is the thermal resistance between core and surface.\n- Energy balance at the surface node: $$C_s \\frac{d T_s}{dt} = \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}},$$ where $C_s$ is the surface thermal capacitance, $T_a$ is the ambient temperature, and $R_{se}$ is the surface-to-environment thermal resistance.\n- Resistive heat generation: $$q(T_c,I) = I^2 R_{\\mathrm{int}}(T_c), \\quad R_{\\mathrm{int}}(T_c) = R_0\\left(1 + \\alpha (T_c - T_{\\mathrm{ref}})\\right),$$ where $R_0$ is the reference internal resistance at reference temperature $T_{\\mathrm{ref}}$, and $\\alpha$ is the resistance temperature coefficient.\n\nYou must:\n1. Derive a discrete-time nonlinear state-space model suitable for EKF using an explicit Euler discretization with sampling period $\\Delta t$. Specify the state transition function $f(\\cdot)$ and measurement function $h(\\cdot)$ explicitly, where the state is $x_k = \\begin{bmatrix} T_{c,k} \\\\ T_{s,k} \\end{bmatrix}$ and the measurement is $z_k$ given by the surface temperature corrupted by measurement noise. Include additive process noise $w_k$ and measurement noise $v_k$, assumed zero-mean Gaussian with covariances $Q$ and $R$, respectively.\n2. Derive the Jacobians needed by the EKF. That is, provide the discrete-time Jacobian $F_k = \\frac{\\partial f}{\\partial x}\\big|_{x=\\hat{x}_{k-1}}$ and $H_k = \\frac{\\partial h}{\\partial x}\\big|_{x=\\hat{x}_{k}^{-}}$ evaluated at the appropriate points.\n3. Implement the EKF time update and measurement update recursions for the derived model.\n\nPhysical parameters (use these values):\n- Core capacitance: $C_c = 120\\,\\mathrm{J/K}$.\n- Surface capacitance: $C_s = 40\\,\\mathrm{J/K}$.\n- Core-surface thermal resistance: $R_{cs} = 0.08\\,\\mathrm{K/W}$.\n- Surface-environment thermal resistance: $R_{se} = 1.2\\,\\mathrm{K/W}$.\n- Ambient temperature: $T_a = 25\\,^\\circ\\mathrm{C}$.\n- Reference internal resistance: $R_0 = 0.015\\,\\Omega$.\n- Resistance temperature coefficient: $\\alpha = 0.004\\,\\mathrm{K}^{-1}$.\n- Reference temperature: $T_{\\mathrm{ref}} = 25\\,^\\circ\\mathrm{C}$.\n- Sampling period: $\\Delta t = 1\\,\\mathrm{s}$.\n\nNoise models and filter initialization:\n- Process noise covariance $Q$ and measurement noise covariance $R$ are diagonal, specified per test case.\n- Initialize the EKF state estimate as $\\hat{x}_0$ and covariance $P_0$ as specified per test case.\n\nMeasurement generation for evaluation:\n- For each test case, generate a synthetic measurement sequence by simulating the true two-node thermal system using the same discretization and parameters above, and then adding zero-mean Gaussian measurement noise to the surface temperature with the specified variance $R$. Use fixed random seeds for reproducibility.\n\nTest suite:\n- Case $1$ (happy path): $N = 300$ steps, current $I_k = 20\\,\\mathrm{A}$ for all $k$, $Q = \\mathrm{diag}([0.005,\\,0.005])\\,\\mathrm{K}^2$, $R = 0.04\\,\\mathrm{K}^2$, truth initial state $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$, filter initial state $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise random seed $42$.\n- Case $2$ (boundary cooling): $N = 300$ steps, current $I_k = 0\\,\\mathrm{A}$ for all $k$, $Q = \\mathrm{diag}([0.0025,\\,0.0025])\\,\\mathrm{K}^2$, $R = 0.09\\,\\mathrm{K}^2$, truth initial state $x_0^{\\mathrm{true}} = \\begin{bmatrix}45 \\\\ 35\\end{bmatrix}$, filter initial state $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise random seed $123$.\n- Case $3$ (edge: pulsed heating and high sensor noise): $N = 300$ steps, current profile $$I_k = \\begin{cases}0\\,\\mathrm{A}, & 0 \\le k < 100, \\\\ 30\\,\\mathrm{A}, & 100 \\le k < 200, \\\\ 0\\,\\mathrm{A}, & 200 \\le k \\le 299, \\end{cases}$$ $Q = \\mathrm{diag}([0.01,\\,0.01])\\,\\mathrm{K}^2$, $R = 2.25\\,\\mathrm{K}^2$, truth initial state $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$, filter initial state $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise random seed $7$.\n\nRequired outputs:\n- For each test case, run your EKF on the generated measurement sequence and return the final estimated core temperature $\\hat{T}_{c,N}$.\n- Express each final estimated core temperature in degrees Celsius, rounded to two decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases $1$, $2$, $3$ (for example, $$[x_1,x_2,x_3]$$ where each $x_i$ is a float representing $\\hat{T}_{c,N}$ in $^\\circ\\mathrm{C}$ rounded to two decimal places).\n\nAll mathematical steps must be derived from the fundamental base specified above, and the EKF must be formulated with explicit state and measurement equations and their Jacobians.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\nThe verbatim givens extracted from the problem statement are as follows:\n\n**System Dynamics:**\n- Core node energy balance: $$C_c \\frac{d T_c}{dt} = q(T_c,I) - \\frac{T_c - T_s}{R_{cs}}$$\n- Surface node energy balance: $$C_s \\frac{d T_s}{dt} = \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}}$$\n- Heat generation model: $$q(T_c,I) = I^2 R_{\\mathrm{int}}(T_c), \\quad R_{\\mathrm{int}}(T_c) = R_0\\left(1 + \\alpha (T_c - T_{\\mathrm{ref}})\\right)$$\n\n**State-Space Model Formulation:**\n- State vector: $x_k = \\begin{bmatrix} T_{c,k} \\\\ T_{s,k} \\end{bmatrix}$\n- Discretization method: Explicit Euler with sampling period $\\Delta t$.\n- Process noise: Additive, zero-mean Gaussian $w_k$ with covariance $Q$.\n- Measurement: Surface temperature $T_{s,k}$.\n- Measurement noise: Additive, zero-mean Gaussian $v_k$ with covariance $R$.\n\n**Physical Parameters:**\n- $C_c = 120\\,\\mathrm{J/K}$\n- $C_s = 40\\,\\mathrm{J/K}$\n- $R_{cs} = 0.08\\,\\mathrm{K/W}$\n- $R_{se} = 1.2\\,\\mathrm{K/W}$\n- $T_a = 25\\,^\\circ\\mathrm{C}$\n- $R_0 = 0.015\\,\\Omega$\n- $\\alpha = 0.004\\,\\mathrm{K}^{-1}$\n- $T_{\\mathrm{ref}} = 25\\,^\\circ\\mathrm{C}$\n- $\\Delta t = 1\\,\\mathrm{s}$\n\n**Test Suites:**\n- **Case 1:** $N = 300$, $I_k = 20\\,\\mathrm{A}$ (constant), $Q = \\mathrm{diag}([0.005,\\,0.005])\\,\\mathrm{K}^2$, $R = 0.04\\,\\mathrm{K}^2$, $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise seed $42$.\n- **Case 2:** $N = 300$, $I_k = 0\\,\\mathrm{A}$ (constant), $Q = \\mathrm{diag}([0.0025,\\,0.0025])\\,\\mathrm{K}^2$, $R = 0.09\\,\\mathrm{K}^2$, $x_0^{\\mathrm{true}} = \\begin{bmatrix}45 \\\\ 35\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise seed $123$.\n- **Case 3:** $N = 300$, $I_k = \\begin{cases}0\\,\\mathrm{A}, & 0 \\le k < 100 \\\\ 30\\,\\mathrm{A}, & 100 \\le k < 200 \\\\ 0\\,\\mathrm{A}, & 200 \\le k \\le 299 \\end{cases}$, $Q = \\mathrm{diag}([0.01,\\,0.01])\\,\\mathrm{K}^2$, $R = 2.25\\,\\mathrm{K}^2$, $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$, $P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$, measurement noise seed $7$.\n\n**Required Output:**\n- Final estimated core temperature $\\hat{T}_{c,N}$ for each case, rounded to two decimal places, formatted as a comma-separated list in brackets.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is validated against the specified criteria:\n- **Scientifically Grounded:** The problem is based on the First Law of Thermodynamics (energy conservation) and standard models for conductive/convective heat transfer (thermal resistance network) and Joule heating in a resistor. This is a common and valid approach in thermal engineering. The model is scientifically sound.\n- **Well-Posed:** The problem provides a complete set of differential equations, parameters, initial conditions, noise statistics, and input profiles. It requests the implementation of a standard estimation algorithm (EKF) to find a unique solution (the state trajectory estimate). The problem is well-posed.\n- **Objective:** The problem is stated in precise, quantitative terms. All parameters are defined, and the objectives are clear. There is no subjective or ambiguous language.\n- **Completeness and Consistency:** All required data to solve the problem for each test case is provided. There are no missing parameters or contradictory constraints.\n- **Realism:** The parameters are within a plausible range for a cylindrical lithium-ion cell, and the two-node model is a standard simplification. The task is realistic.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It is therefore **valid**. A solution will be provided.\n\n### Solution Derivation\n\nThe solution requires deriving and implementing an Extended Kalman Filter (EKF) for a two-node thermal model of a battery. The derivation proceeds in three parts: formulating the discrete-time state-space model, deriving the necessary Jacobians, and specifying the EKF algorithm.\n\n**1. Discrete-Time State-Space Model**\n\nFirst, we rewrite the given continuous-time differential equations in state-space form. Let the state vector be $x = \\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix}$. The system dynamics can be written as $\\dot{x} = \\phi(x, u)$, where $u = I$ is the input current.\n\n$$\n\\frac{d}{dt}\\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix} = \\begin{bmatrix} \\frac{1}{C_c} \\left( I^2 R_0(1 + \\alpha(T_c - T_{\\mathrm{ref}})) - \\frac{T_c - T_s}{R_{cs}} \\right) \\\\ \\frac{1}{C_s} \\left( \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}} \\right) \\end{bmatrix}\n$$\n\nWe discretize this system using the explicit (forward) Euler method, $x_{k+1} = x_k + \\Delta t \\, \\phi(x_k, u_k)$. This yields the nonlinear state transition function $f(\\cdot)$ for the process model $x_{k+1} = f(x_k, u_k)$.\n\nThe components of $f(x_k, u_k)$ are:\n$$\nT_{c,k+1} = T_{c,k} + \\frac{\\Delta t}{C_c} \\left( I_k^2 R_0(1 + \\alpha(T_{c,k} - T_{\\mathrm{ref}})) - \\frac{T_{c,k} - T_{s,k}}{R_{cs}} \\right)\n$$\n$$\nT_{s,k+1} = T_{s,k} + \\frac{\\Delta t}{C_s} \\left( \\frac{T_{c,k} - T_{s,k}}{R_{cs}} - \\frac{T_{s,k} - T_a}{R_{se}} \\right)\n$$\n\nThe full discrete-time process model, including zero-mean Gaussian process noise $w_k \\sim \\mathcal{N}(0, Q)$, is:\n$$\nx_{k+1} = f(x_k, I_k) + w_k\n$$\n\nThe measurement $z_k$ is the surface temperature corrupted by zero-mean Gaussian noise $v_k \\sim \\mathcal{N}(0, R)$. The measurement function $h(\\cdot)$ is linear:\n$$\nz_k = h(x_k) + v_k = T_{s,k} + v_k = \\begin{bmatrix} 0 & 1 \\end{bmatrix} x_k + v_k\n$$\n\n**2. EKF Jacobians Derivation**\n\nThe EKF linearizes the nonlinear functions $f$ and $h$ around the current state estimate. This requires their Jacobians.\n\nThe state Jacobian, $F_k$, is the partial derivative of $f$ with respect to the state $x$, evaluated at the estimate $\\hat{x}_k$ and input $I_k$. Let $x = \\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix}$.\n$$\nF_k = \\frac{\\partial f}{\\partial x}\\bigg|_{\\hat{x}_k, I_k} = \\begin{bmatrix} \\frac{\\partial f_1}{\\partial T_c} & \\frac{\\partial f_1}{\\partial T_s} \\\\ \\frac{\\partial f_2}{\\partial T_c} & \\frac{\\partial f_2}{\\partial T_s} \\end{bmatrix}\\bigg|_{\\hat{x}_k, I_k}\n$$\nThe components are:\n- $\\frac{\\partial f_1}{\\partial T_c} = 1 + \\frac{\\Delta t}{C_c} \\left( I_k^2 R_0 \\alpha - \\frac{1}{R_{cs}} \\right)$\n- $\\frac{\\partial f_1}{\\partial T_s} = \\frac{\\Delta t}{C_c R_{cs}}$\n- $\\frac{\\partial f_2}{\\partial T_c} = \\frac{\\Delta t}{C_s R_{cs}}$\n- $\\frac{\\partial f_2}{\\partial T_s} = 1 + \\frac{\\Delta t}{C_s} \\left( -\\frac{1}{R_{cs}} - \\frac{1}{R_{se}} \\right) = 1 - \\frac{\\Delta t}{C_s} \\left( \\frac{1}{R_{cs}} + \\frac{1}{R_{se}} \\right)$\n\nThe measurement Jacobian, $H_k$, is the partial derivative of $h$ with respect to $x$. Since $h$ is linear, the Jacobian is constant:\n$$\nH_k = \\frac{\\partial h}{\\partial x} = \\begin{bmatrix} \\frac{\\partial T_s}{\\partial T_c} & \\frac{\\partial T_s}{\\partial T_s} \\end{bmatrix} = \\begin{bmatrix} 0 & 1 \\end{bmatrix}\n$$\n\n**3. Extended Kalman Filter Algorithm**\nThe EKF operates in a two-step recursive loop: prediction and correction.\n\n**Initialization:**\n- State estimate: $\\hat{x}_0$\n- Covariance estimate: $P_0$\n\n**Recursion for $k = 0, \\dots, N-1$:**\nGiven the estimate $\\hat{x}_k$ and $P_k$, we compute the estimate for the next time step, $k+1$.\n\n**Time Update (Prediction):**\n1.  Predict the next state using the nonlinear model:\n    $$ \\hat{x}_{k+1}^- = f(\\hat{x}_k, I_k) $$\n2.  Linearize the system by computing the state Jacobian at the current estimate:\n    $$ F_k = \\frac{\\partial f}{\\partial x}\\bigg|_{\\hat{x}_k, I_k} $$\n3.  Propagate the error covariance:\n    $$ P_{k+1}^- = F_k P_k F_k^T + Q $$\n\n**Measurement Update (Correction):**\n1.  Obtain the measurement $z_{k+1}$.\n2.  The measurement Jacobian $H_{k+1}$ is constant: $H_{k+1} = \\begin{bmatrix} 0 & 1 \\end{bmatrix}$.\n3.  Calculate the innovation (measurement residual):\n    $$ y_{k+1} = z_{k+1} - h(\\hat{x}_{k+1}^-) = z_{k+1} - \\hat{T}_{s, k+1}^- $$\n4.  Calculate the innovation covariance:\n    $$ S_{k+1} = H_{k+1} P_{k+1}^- H_{k+1}^T + R $$\n5.  Compute the optimal Kalman gain:\n    $$ K_{k+1} = P_{k+1}^- H_{k+1}^T S_{k+1}^{-1} $$\n6.  Update the state estimate with the measurement information:\n    $$ \\hat{x}_{k+1} = \\hat{x}_{k+1}^- + K_{k+1} y_{k+1} $$\n7.  Update the error covariance:\n    $$ P_{k+1} = (I - K_{k+1} H_{k+1}) P_{k+1}^- $$\n\nThis completes the theoretical derivation. The implementation will follow this procedure for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery thermal state estimation problem using an Extended Kalman Filter (EKF).\n    \"\"\"\n\n    # Physical parameters\n    Cc = 120.0  # Core capacitance (J/K)\n    Cs = 40.0   # Surface capacitance (J/K)\n    Rcs = 0.08  # Core-surface thermal resistance (K/W)\n    Rse = 1.2   # Surface-environment thermal resistance (K/W)\n    Ta = 25.0   # Ambient temperature (deg C)\n    R0 = 0.015  # Reference internal resistance (Ohm)\n    alpha = 0.004 # Resistance temperature coefficient (1/K)\n    T_ref = 25.0 # Reference temperature (deg C)\n    dt = 1.0    # Sampling period (s)\n\n    # Test cases\n    test_cases = [\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 20.0,\n            \"Q\": np.diag([0.005, 0.005]),\n            \"R\": 0.04,\n            \"x0_true\": np.array([25.0, 25.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 42\n        },\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 0.0,\n            \"Q\": np.diag([0.0025, 0.0025]),\n            \"R\": 0.09,\n            \"x0_true\": np.array([45.0, 35.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 123\n        },\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 30.0 if 100 = k  200 else 0.0,\n            \"Q\": np.diag([0.01, 0.01]),\n            \"R\": 2.25,\n            \"x0_true\": np.array([25.0, 25.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 7\n        }\n    ]\n\n    results = []\n\n    # --- EKF Helper Functions ---\n    def state_transition_func(x, I):\n        Tc, Ts = x\n        R_int = R0 * (1 + alpha * (Tc - T_ref))\n        q_gen = I**2 * R_int\n        \n        dTc_dt = (q_gen - (Tc - Ts) / Rcs) / Cc\n        dTs_dt = ((Tc - Ts) / Rcs - (Ts - Ta) / Rse) / Cs\n        \n        x_next = x + dt * np.array([dTc_dt, dTs_dt])\n        return x_next\n\n    def measurement_func(x):\n        return x[1]\n\n    def state_jacobian(I):\n        # The discretized system model is affine, so the Jacobian F does not depend on the state x.\n        # F_k depends only on the input I_k.\n        F = np.zeros((2, 2))\n        F[0, 0] = 1 + (dt / Cc) * (I**2 * R0 * alpha - 1 / Rcs)\n        F[0, 1] = (dt / Cc) * (1 / Rcs)\n        F[1, 0] = (dt / Cs) * (1 / Rcs)\n        F[1, 1] = 1 + (dt / Cs) * (-1 / Rcs - 1 / Rse)\n        return F\n\n    H = np.array([[0.0, 1.0]])\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        I_profile = case[\"I_profile\"]\n        Q = case[\"Q\"]\n        R = case[\"R\"]\n        seed = case[\"seed\"]\n\n        # --- 1. Generate Synthetic Measurements ---\n        rng = np.random.default_rng(seed)\n        x_true = case[\"x0_true\"].copy()\n        measurements = np.zeros(N)\n        \n        for k in range(N):\n            I_k = I_profile(k)\n            # The state evolves from k to k+1\n            x_true = state_transition_func(x_true, I_k)\n            # Measurement is for state at k+1, taken at time k+1\n            measurement_noise = rng.normal(0, np.sqrt(R))\n            measurements[k] = measurement_func(x_true) + measurement_noise\n\n        # --- 2. Run Extended Kalman Filter ---\n        x_est = case[\"x0_est\"].copy()\n        P_est = case[\"P0\"].copy()\n        Id = np.eye(2)\n\n        for k in range(N):\n            # Input current at step k drives the transition from k to k+1\n            I_k = I_profile(k)\n            \n            # --- Prediction (Time Update) ---\n            # Predict state for k+1 based on state at k\n            x_pred = state_transition_func(x_est, I_k)\n            \n            # Calculate Jacobian F_k\n            F_k = state_jacobian(I_k)\n            \n            # Predict covariance for k+1\n            P_pred = F_k @ P_est @ F_k.T + Q\n\n            # --- Correction (Measurement Update) ---\n            # Get measurement z_{k+1} (stored at index k)\n            z_k_plus_1 = measurements[k]\n            \n            # Innovation\n            y = z_k_plus_1 - measurement_func(x_pred)\n            \n            # Innovation covariance\n            S = H @ P_pred @ H.T + R\n            \n            # Kalman gain\n            K = (P_pred @ H.T) / S\n            K = K.reshape((2,1))\n            \n            # Update state estimate for k+1\n            x_est = x_pred + (K * y).flatten()\n            \n            # Update covariance estimate for k+1\n            P_est = (Id - K @ H) @ P_pred\n        \n        results.append(f\"{x_est[0]:.2f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}