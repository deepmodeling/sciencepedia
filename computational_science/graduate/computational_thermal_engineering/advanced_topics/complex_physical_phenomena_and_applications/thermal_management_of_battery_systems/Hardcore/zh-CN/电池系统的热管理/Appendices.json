{
    "hands_on_practices": [
        {
            "introduction": "理解电池热行为的第一步是建立一个能描述其整体温度随时间变化的动态模型。本练习将引导你从最基本的能量守恒定律出发，推导出一个集总参数模型，这是电池热分析中最常用且基础的方法。通过求解这个模型，你将能够预测电池在发热和冷却过程中的瞬态温度响应，并理解热时间常数等关键概念。",
            "id": "3997652",
            "problem": "一个圆柱形锂离子电池单元通过与温度为 $T_{\\infty}$ 的环境进行强制对流来进行热管理。该电池的体积为 $V$，外表面积为 $A_{s}$，有效热导率为 $k$，密度为 $\\rho$，比热容为 $c_{p}$。对流传热系数为 $h$，辐射可忽略不计。内部生热在空间上是均匀的且随时间变化，由一个已知且有界的体积率 $q(t)$ 描述。初始电池温度为 $T(0)=T_{0}$。该电池足够细长，且对流足够强，使得毕渥数 $Bi=h L_{c}/k$（其中特征长度 $L_{c}=V/A_{s}$）满足 $Bi \\ll 1$，这证明了采用空间均匀电池温度 $T(t)$ 的集总电容模型是合理的。\n\n严格从作为控制体积的电池的能量守恒以及对流和显能储存的标准本构定律出发，在所述假设下推导出 $T(t)$ 的控制常微分方程。然后，仅使用适用于线性时变系统的第一性原理方法，获得对于通用输入 $q(t)$ 的 $T(t)$ 的闭式表达式。最后，对体积生热发生阶跃变化（即当 $t \\ge 0$ 时，$q(t)=q_{0}$，其中 $q_{0}$ 为常数）的特定情况，计算您的表达式，并用符号 $T_{0}$、$T_{\\infty}$、$q_{0}$、$h$、$A_{s}$、$\\rho$、$c_{p}$、$V$ 和 $t$ 给出 $T(t)$ 的闭式表达式。\n\n你的最终答案必须是针对阶跃输入情况的 $T(t)$ 的单个闭式解析表达式。最终答案中不要包含等号或任何单位。不需要进行数值计算或四舍五入。",
            "solution": "### 步骤1：提取已知条件\n- 控制体积：一个圆柱形锂离子电池单元\n- 环境温度：$T_{\\infty}$\n- 电池体积：$V$\n- 电池外表面积：$A_{s}$\n- 电池有效热导率：$k$\n- 电池密度：$\\rho$\n- 电池比热容：$c_{p}$\n- 对流传热系数：$h$\n- 辐射：可忽略不计\n- 体积生热率：$q(t)$，空间均匀，随时间变化，已知且有界\n- 初始条件：$T(0)=T_{0}$\n- 特征长度：$L_{c}=V/A_{s}$\n- 毕渥数：$Bi = h L_{c}/k$\n- 假设：$Bi \\ll 1$，证明了采用空间均匀电池温度 $T(t)$ 的集总电容模型是合理的\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行评估。\n\n1.  **科学依据**：该问题基于能量守恒的基本原理（热力学第一定律）。它采用了标准的本构定律，即用于对流的牛顿冷却定律和用于储热的显能定义。当毕渥数远小于1（$Bi \\ll 1$）时，集总电容模型是传热学中一个标准且有效的近似方法，这一条件已明确给出。该问题在科学上是合理的。\n2.  **适定性**：问题要求在指定的初始条件 $T(0)=T_0$ 下，推导一个控制常微分方程并求解。得到的常微分方程是一个系数为常数的一阶线性非齐次方程。给定初始条件后，此类问题是适定的，存在唯一且稳定的解。\n3.  **客观性**：问题陈述使用了精确、无歧义的科学和数学术语。所有变量都已明确定义。没有主观或基于观点的陈述。\n4.  **完整性与一致性**：所有必要的物理性质（$\\rho, c_p, V, A_s$）、输运系数（$h$）、边界条件（$T_{\\infty}$）、初始条件（$T_0$）和强迫函数（$q(t)$，特别是 $q(t)=q_0$）都已用符号形式提供。没有缺失的参数或相互矛盾的约束。\n5.  **现实性与可行性**：该场景描述了热工程中的一个常见问题，特别是电池系统的热管理。当内部导热热阻与外部对流热阻相比可以忽略不计时，集总电容假设是一种实用的工程简化方法。这些参数和场景在物理上是现实的。\n\n该问题没有表现出验证清单中列出的任何缺陷。它是瞬态传热中的一个典型问题。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供一个解决方案。\n\n### 控制常微分方程的推导\n\n我们将能量守恒原理应用于作为我们控制体积的电池单元。能量平衡方程为：\n$$\n\\text{能量累积率} = \\text{能量输入率} - \\text{能量输出率} + \\text{能量生成率}\n$$\n用符号表示，对于控制体积：\n$$\n\\frac{dE_{cv}}{dt} = \\dot{E}_{in} - \\dot{E}_{out} + \\dot{E}_{gen}\n$$\n在集总电容模型假设下，温度 $T(t)$ 在任何给定时间 $t$ 在整个电池体积 $V$ 内是均匀的。\n\n能量累积率（显能储存）由以下公式给出：\n$$\n\\frac{dE_{cv}}{dt} = \\frac{d}{dt} \\left[ m c_p (T(t) - T_{ref}) \\right] = \\rho V c_p \\frac{dT}{dt}\n$$\n其中 $m = \\rho V$ 是电池的质量，$T_{ref}$ 是一个恒定的参考温度。\n\n没有能量通过传热进入控制体积，因此 $\\dot{E}_{in} = 0$。\n\n能量通过从表面积 $A_s$ 到温度为 $T_{\\infty}$ 的环境流体的对流离开控制体积。根据牛顿冷却定律：\n$$\n\\dot{E}_{out} = h A_s (T(t) - T_{\\infty})\n$$\n内部能量生成率由体积率 $q(t)$ 乘以电池体积 $V$ 给出：\n$$\n\\dot{E}_{gen} = q(t) V\n$$\n将这些项代入能量平衡方程：\n$$\n\\rho V c_p \\frac{dT}{dt} = 0 - h A_s (T(t) - T_{\\infty}) + q(t) V\n$$\n重新整理这些项，我们得到：\n$$\n\\rho V c_p \\frac{dT}{dt} + h A_s (T(t) - T_{\\infty}) = q(t) V\n$$\n$$\n\\rho V c_p \\frac{dT}{dt} + h A_s T(t) - h A_s T_{\\infty} = q(t) V\n$$\n为了将其写成一阶线性常微分方程的标准形式 $\\frac{dy}{dx} + P(x)y = Q(x)$，我们除以 $\\rho V c_p$：\n$$\n\\frac{dT}{dt} + \\frac{h A_s}{\\rho V c_p} T(t) = \\frac{h A_s}{\\rho V c_p} T_{\\infty} + \\frac{q(t)}{\\rho c_p}\n$$\n这就是电池温度 $T(t)$ 的控制常微分方程。\n\n### $T(t)$ 的通解\n\n该常微分方程是一阶线性非齐次方程。我们可以使用积分因子 $I(t)$ 来求解。设时间常数为 $\\tau = \\frac{\\rho V c_p}{h A_s}$。常微分方程变为：\n$$\n\\frac{dT}{dt} + \\frac{1}{\\tau} T(t) = \\frac{1}{\\tau} T_{\\infty} + \\frac{q(t)}{\\rho c_p}\n$$\n积分因子为 $I(t) = \\exp\\left(\\int \\frac{1}{\\tau} dt\\right) = \\exp(t/\\tau)$。将常微分方程乘以 $I(t)$：\n$$\n\\exp(t/\\tau) \\frac{dT}{dt} + \\frac{1}{\\tau} \\exp(t/\\tau) T(t) = \\exp(t/\\tau) \\left( \\frac{1}{\\tau} T_{\\infty} + \\frac{q(t)}{\\rho c_p} \\right)\n$$\n左边是乘积的导数：\n$$\n\\frac{d}{dt} \\left[ T(t) \\exp(t/\\tau) \\right] = \\frac{T_{\\infty}}{\\tau} \\exp(t/\\tau) + \\frac{q(t)}{\\rho c_p} \\exp(t/\\tau)\n$$\n我们对两边从 $t'=0$ 到 $t'=t$ 进行积分：\n$$\n\\int_{0}^{t} \\frac{d}{dt'} \\left[ T(t') \\exp(t'/\\tau) \\right] dt' = \\int_{0}^{t} \\left( \\frac{T_{\\infty}}{\\tau} \\exp(t'/\\tau) + \\frac{q(t')}{\\rho c_p} \\exp(t'/\\tau) \\right) dt'\n$$\n计算左边：\n$$\n\\left[ T(t') \\exp(t'/\\tau) \\right]_0^t = T(t) \\exp(t/\\tau) - T(0) \\exp(0) = T(t) \\exp(t/\\tau) - T_0\n$$\n所以，我们有：\n$$\nT(t) \\exp(t/\\tau) - T_0 = T_{\\infty} \\left[ \\exp(t'/\\tau) \\right]_0^t + \\frac{1}{\\rho c_p} \\int_0^t q(t') \\exp(t'/\\tau) dt'\n$$\n$$\nT(t) \\exp(t/\\tau) - T_0 = T_{\\infty} (\\exp(t/\\tau) - 1) + \\frac{1}{\\rho c_p} \\int_0^t q(t') \\exp(t'/\\tau) dt'\n$$\n求解 $T(t)$：\n$$\nT(t) = T_0 \\exp(-t/\\tau) + T_{\\infty} (1 - \\exp(-t/\\tau)) + \\frac{\\exp(-t/\\tau)}{\\rho c_p} \\int_0^t q(t') \\exp(t'/\\tau) dt'\n$$\n这就是对于任意生热率 $q(t)$ 的 $T(t)$ 的通用闭式表达式。\n\n### 阶跃输入 $q(t) = q_{0}$ 的特解\n\n对于 $t \\ge 0$ 时恒定生热 $q(t) = q_{0}$ 的情况，我们计算通解中的积分：\n$$\n\\int_0^t q_0 \\exp(t'/\\tau) dt' = q_0 \\int_0^t \\exp(t'/\\tau) dt' = q_0 \\left[ \\tau \\exp(t'/\\tau) \\right]_0^t = q_0 \\tau (\\exp(t/\\tau) - 1)\n$$\n将此结果代回 $T(t)$ 的通解表达式：\n$$\nT(t) = T_0 \\exp(-t/\\tau) + T_{\\infty} (1 - \\exp(-t/\\tau)) + \\frac{\\exp(-t/\\tau)}{\\rho c_p} \\left[ q_0 \\tau (\\exp(t/\\tau) - 1) \\right]\n$$\n$$\nT(t) = T_0 \\exp(-t/\\tau) + T_{\\infty} (1 - \\exp(-t/\\tau)) + \\frac{q_0 \\tau}{\\rho c_p} (1 - \\exp(-t/\\tau))\n$$\n现在，代入时间常数 $\\tau = \\frac{\\rho V c_p}{h A_s}$ 的定义：\n$$\n\\frac{q_0 \\tau}{\\rho c_p} = \\frac{q_0}{\\rho c_p} \\left( \\frac{\\rho V c_p}{h A_s} \\right) = \\frac{q_0 V}{h A_s}\n$$\n$T(t)$ 的表达式变为：\n$$\nT(t) = T_0 \\exp(-t/\\tau) + T_{\\infty} (1 - \\exp(-t/\\tau)) + \\frac{q_0 V}{h A_s} (1 - \\exp(-t/\\tau))\n$$\n我们可以将带有和不带有指数的项收集起来：\n$$\nT(t) = T_0 \\exp(-t/\\tau) + \\left( T_{\\infty} + \\frac{q_0 V}{h A_s} \\right) (1 - \\exp(-t/\\tau))\n$$\n$$\nT(t) = T_0 \\exp(-t/\\tau) + T_{\\infty} + \\frac{q_0 V}{h A_s} - T_{\\infty} \\exp(-t/\\tau) - \\frac{q_0 V}{h A_s} \\exp(-t/\\tau)\n$$\n$$\nT(t) = \\left( T_{\\infty} + \\frac{q_0 V}{h A_s} \\right) + \\left( T_0 - T_{\\infty} - \\frac{q_0 V}{h A_s} \\right) \\exp(-t/\\tau)\n$$\n这个形式清楚地显示了稳态温度 $T_{ss} = T_{\\infty} + \\frac{q_0 V}{h A_s}$ 和瞬态衰减。最后，代入 $\\tau$ 的完整表达式：\n$$\nT(t) = T_{\\infty} + \\frac{q_0 V}{h A_s} + \\left(T_0 - T_{\\infty} - \\frac{q_0 V}{h A_s}\\right) \\exp\\left(-\\frac{h A_s t}{\\rho V c_p}\\right)\n$$\n这就是阶跃输入情况下 $T(t)$ 的最终闭式解析表达式。",
            "answer": "$$\\boxed{T_{\\infty} + \\frac{q_{0} V}{h A_{s}} + \\left(T_{0} - T_{\\infty} - \\frac{q_{0} V}{h A_{s}}\\right) \\exp\\left(-\\frac{h A_{s} t}{\\rho V c_{p}}\\right)}$$"
        },
        {
            "introduction": "虽然集总参数模型在许多情况下很有效，但它忽略了电池内部的温度分布，而这对于预防局部过热至关重要。本练习将带你深入电池内部，通过求解稳态热传导方程，推导出圆柱形电芯内部的径向温度分布。这项实践将揭示电芯尺寸和导热系数如何影响内部温差，这是设计大型电池包时必须考虑的核心问题。",
            "id": "3997654",
            "problem": "一个半径为 $R$ 的长实心圆柱形锂离子（Li-ion）电池，在高倍率工作期间，由于电化学反应和欧姆损耗，产生均匀的内部体积生热率 $\\;q'''\\;$。活性区域的热导率 $k$ 是各向同性且空间上恒定的，并且末端效应可以忽略不计，因此传热纯粹是径向的。在 $r=R$ 处的​​外表面暴露于冷却剂中，该冷却剂与温度为 $T_{\\infty}$ 的环境流体之间具有均匀的对流换热系数 $h$。假设稳态、无轴向梯度且无辐射。\n\n从连续介质中的能量守恒和傅里叶热传导定律出发，推导电池内部稳态径向温度分布 $T(r)$ 的闭合形式解，该解需满足在 $r=0$ 处的对称性条件和在 $r=R$ 处的对流边界条件。然后，求出核心到表面的温差 $\\Delta T_{cs} \\equiv T(0) - T(R)$ 的闭合形式表达式，并用 $q'''$、$k$、$h$ 和 $R$ 解释其参数依赖性。\n\n将最终的温度分布和核心到表面的温差表示为以 $q'''$、$k$、$h$、$R$ 和 $T_{\\infty}$ 为变量的解析表达式。温度应以开尔文表示。无需进行数值代入或四舍五入。请将最终答案以一个两元素的行矩阵形式提供，其中第一个元素是 $T(r)$，第二个元素是 $\\Delta T_{cs}$。",
            "solution": "该问题被评估为有效，因为它代表了一个适定、有科学依据的热传导问题，没有矛盾、歧义或事实错误。它要求从第一性原理出发推导温度分布，这是热工学中一项标准且有意义的任务。\n\n所考虑的物理系统是一个半径为 $R$ 的长实心圆柱体，具有均匀的内部生热率 $q'''$ 和恒定的热导率 $k$。传热是在径向 $r$ 上的一维过程。在圆柱坐标系中，带有内部生热的稳态热传导的控制方程是从能量守恒原理推导出来的。\n\n考虑一个位于径向位置 $r$、长度为 $L$、厚度为无穷小 $dr$ 的圆柱壳，其稳态下的能量平衡为：\n（在 $r$ 处传入壳体的热传导速率）+（壳体内产生的热量速率）=（在 $r+dr$ 处传出壳体的热传导速率）。\n\n设 $q_r$ 为径向热率。能量平衡可写为：\n$$ q_r + d\\dot{E}_{gen} = q_{r+dr} $$\n在微元体积 $dV = (2\\pi r L) dr$ 内的生热速率为 $d\\dot{E}_{gen} = q''' (2\\pi r L dr)$。\n穿过壳体的热率差为 $q_{r+dr} - q_r = d_r q_r$。因此：\n$$ d_r q_r = q''' (2\\pi r L dr) $$\n除以 $dr$ 和 $L$ 得到单位长度上的热率变化：\n$$ \\frac{d}{dr} \\left( \\frac{q_r}{L} \\right) = 2\\pi r q''' $$\n径向热率 $q_r$ 与热通量 $q''_r$ 的关系为 $q_r = q''_r A_r = q''_r (2\\pi r L)$。将此代入前一个方程不是最直接的方法。从通用的热扩散方程出发进行更直接的公式推导是更可取的。\n\n圆柱坐标系下的一般热扩散方程为：\n$$ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(k r \\frac{\\partial T}{\\partial r}\\right) + \\frac{1}{r^2}\\frac{\\partial}{\\partial \\phi}\\left(k \\frac{\\partial T}{\\partial \\phi}\\right) + \\frac{\\partial}{\\partial z}\\left(k \\frac{\\partial T}{\\partial z}\\right) + q''' = \\rho c_p \\frac{\\partial T}{\\partial t} $$\n应用题目的简化假设：\n1.  稳态：$\\frac{\\partial T}{\\partial t} = 0$。\n2.  末端效应可忽略且无轴向梯度：$\\frac{\\partial T}{\\partial z} = 0$。\n3.  纯径向传热意味着方位角对称：$\\frac{\\partial T}{\\partial \\phi} = 0$。\n4.  空间上恒定的热导率 $k$。\n\n该方程简化为一个常微分方程（ODE）：\n$$ \\frac{1}{r}\\frac{d}{dr}\\left(k r \\frac{dT}{dr}\\right) + q''' = 0 $$\n由于 $k$ 是常数，我们可以写成：\n$$ \\frac{k}{r}\\frac{d}{dr}\\left(r \\frac{dT}{dr}\\right) + q''' = 0 $$\n整理后得到温度分布 $T(r)$ 的控制常微分方程：\n$$ \\frac{d}{dr}\\left(r \\frac{dT}{dr}\\right) = -\\frac{q'''}{k} r $$\n我们通过对 $r$ 积分两次来解这个方程。第一次积分得到：\n$$ r \\frac{dT}{dr} = -\\int \\frac{q'''}{k} r \\,dr = -\\frac{q'''}{2k} r^2 + C_1 $$\n其中 $C_1$ 是一个积分常数。除以 $r$ 得到温度梯度：\n$$ \\frac{dT}{dr} = -\\frac{q'''}{2k} r + \\frac{C_1}{r} $$\n第二次积分得到温度分布的通解：\n$$ T(r) = \\int \\left(-\\frac{q'''}{2k} r + \\frac{C_1}{r}\\right) dr = -\\frac{q'''}{4k} r^2 + C_1 \\ln(r) + C_2 $$\n其中 $C_2$ 是第二个积分常数。常数 $C_1$ 和 $C_2$ 由边界条件确定。\n\n第一个边界条件是圆柱中心线（$r=0$）处的对称性条件。温度分布必须关于轴对称，这意味着在 $r=0$ 处温度梯度必须为零。\n$$ \\left.\\frac{dT}{dr}\\right|_{r=0} = 0 $$\n将此条件应用于温度梯度的表达式：\n$$ 0 = -\\frac{q'''}{2k}(0) + \\lim_{r \\to 0} \\frac{C_1}{r} $$\n为使右侧为零，项 $\\frac{C_1}{r}$ 必须不为奇异。这仅在 $C_1=0$ 时才可能。这也确保了温度 $T(r=0)$ 是有限的，否则 $T(r)$ 解中的 $\\ln(r)$ 项将在 $r=0$ 处发散。\n当 $C_1=0$ 时，解简化为：\n$$ T(r) = -\\frac{q'''}{4k} r^2 + C_2 $$\n$$ \\frac{dT}{dr} = -\\frac{q'''}{2k} r $$\n\n第二个边界条件是在外表面（$r=R$）处，在此，传导到表面的热量通过对流传递给周围流体。表面的能量平衡为：\n$$ q''_{\\text{conduction}} = q''_{\\text{convection}} $$\n$$ -k \\left.\\frac{dT}{dr}\\right|_{r=R} = h [T(R) - T_{\\infty}] $$\n代入 $r=R$ 处的温度梯度表达式：\n$$ -k \\left(-\\frac{q''' R}{2k}\\right) = h [T(R) - T_{\\infty}] $$\n$$ \\frac{q''' R}{2} = h [T(R) - T_{\\infty}] $$\n这个方程使我们能够确定表面温度 $T(R)$：\n$$ T(R) = T_{\\infty} + \\frac{q''' R}{2h} $$\n现在我们用这个结果来确定常数 $C_2$。从简化的温度分布表达式，我们在 $r=R$ 处进行求值：\n$$ T(R) = -\\frac{q''' R^2}{4k} + C_2 $$\n令两个 $T(R)$ 的表达式相等：\n$$ T_{\\infty} + \\frac{q''' R}{2h} = -\\frac{q''' R^2}{4k} + C_2 $$\n解出 $C_2$：\n$$ C_2 = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} $$\n将 $C_1$ 和 $C_2$ 的表达式代回 $T(r)$ 的通解，我们得到最终的闭合形式温度分布：\n$$ T(r) = -\\frac{q'''}{4k} r^2 + \\left( T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} \\right) $$\n这可以重新整理成一个更易于解释的形式：\n$$ T(r) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - r^2) $$\n该表达式给出了圆柱内任意径向位置 $r$ 处的温度 $T$。\n\n接下来，我们推导核心到表面的温差，$\\Delta T_{cs} \\equiv T(0) - T(R)$。\n核心温度 $T(0)$ 可通过在温度分布中令 $r=0$ 得到：\n$$ T(0) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - 0) = T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} $$\n表面温度 $T(R)$ 先前已确定为：\n$$ T(R) = T_{\\infty} + \\frac{q''' R}{2h} $$\n因此，温差为：\n$$ \\Delta T_{cs} = T(0) - T(R) = \\left( T_{\\infty} + \\frac{q''' R}{2h} + \\frac{q''' R^2}{4k} \\right) - \\left( T_{\\infty} + \\frac{q''' R}{2h} \\right) $$\n$$ \\Delta T_{cs} = \\frac{q''' R^2}{4k} $$\n\n**$\\Delta T_{cs}$ 的参数依赖性解释：**\n表达式 $\\Delta T_{cs} = \\frac{q''' R^2}{4k}$ 揭示了实心圆柱体内部温降的以下物理依赖关系：\n1.  **生热率 ($q'''$)：** $\\Delta T_{cs}$ 与 $q'''$ 成正比。更高的内部生热率导致更陡峭的内部温度梯度和更大的核心到表面温差。\n2.  **半径 ($R$)：** $\\Delta T_{cs}$ 与半径的平方 $R^2$ 成正比。这是一个关键的洞见，表明内部温升在直径较大的电池中更为显著。在其他条件相同的情况下，半径加倍会使这个内部温差增加四倍。\n3.  **热导率 ($k$)：** $\\Delta T_{cs}$ 与 $k$ 成反比。具有高热导率的材料可以更有效地将热量从核心传导到表面，从而导致较小的内部温差。\n4.  **对流条件 ($h$, $T_{\\infty}$)：** 值得注意的是，$\\Delta T_{cs}$ 与对流换热系数 $h$ 和环境温度 $T_{\\infty}$ 无关。这些外部参数决定了表面本身的温度 $T(R)$，从而使整个温度分布向上或向下平移，但它们不影响核心与表面之间的温差大小，该温差仅是内部生热和传导的函数。\n\n所需的两个表达式是温度分布 $T(r)$ 和核心到表面的温差 $\\Delta T_{cs}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nT_{\\infty} + \\frac{q''' R}{2h} + \\frac{q'''}{4k} (R^2 - r^2)  \\frac{q''' R^2}{4k}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在实际应用中，我们往往无法直接测量电池芯的内部核心温度，但这一参数对电池的安全和寿命至关重要。本练习将理论模型与先进的估计算法相结合，要求你构建一个扩展卡尔曼滤波器（EKF）。通过这项实践，你将学会如何利用可测量的表面温度和电流数据，来实时、准确地估计无法直接测量的核心温度，这是现代电池管理系统（BMS）中的一项关键技术。",
            "id": "3997667",
            "problem": "一个圆柱形锂离子电池单元由一个包含核心节点和表面节点的双节点集总热网络表示。目标是通过推导和实现扩展卡尔曼滤波器 (EKF)，仅使用表面温度测量值和已知的电流曲线来估计核心温度。扩展卡尔曼滤波器 (EKF) 是一种用于非线性系统的递归贝叶斯估计器，它围绕当前估计值进行线性化。推导必须从热力学第一定律（能量守恒）和标准传热关系开始。电池由于其内阻而产生热量，该内阻取决于核心温度，并通过表面向环境散热。\n\n从以下基本原理出发：\n- 核心节点的能量平衡：$$C_c \\frac{d T_c}{dt} = q(T_c,I) - \\frac{T_c - T_s}{R_{cs}},$$ 其中 $C_c$ 是核心热容，$T_c$ 是核心温度，$T_s$ 是表面温度，$I$ 是电流，$q(T_c,I)$ 是生热率，$R_{cs}$ 是核心与表面之间的热阻。\n- 表面节点的能量平衡：$$C_s \\frac{d T_s}{dt} = \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}},$$ 其中 $C_s$ 是表面热容，$T_a$ 是环境温度，$R_{se}$ 是表面到环境的热阻。\n- 电阻生热：$$q(T_c,I) = I^2 R_{\\mathrm{int}}(T_c), \\quad R_{\\mathrm{int}}(T_c) = R_0\\left(1 + \\alpha (T_c - T_{\\mathrm{ref}})\\right),$$ 其中 $R_0$ 是在参考温度 $T_{\\mathrm{ref}}$ 下的参考内阻，$\\alpha$ 是电阻温度系数。\n\n您必须：\n1. 使用采样周期为 $\\Delta t$ 的显式欧拉离散化方法，推导一个适用于 EKF 的离散时间非线性状态空间模型。明确指定状态转移函数 $f(\\cdot)$ 和测量函数 $h(\\cdot)$，其中状态为 $x_k = \\begin{bmatrix} T_{c,k} \\\\ T_{s,k} \\end{bmatrix}$，测量值 $z_k$ 是被测量噪声污染的表面温度。模型应包含加性过程噪声 $w_k$ 和测量噪声 $v_k$，并假设它们分别为协方差是 $Q$ 和 $R$ 的零均值高斯噪声。\n2. 推导 EKF 所需的雅可比矩阵。即，提供在适当点求值的离散时间雅可比矩阵 $F_k = \\frac{\\partial f}{\\partial x}\\big|_{x=\\hat{x}_{k-1}}$ 和 $H_k = \\frac{\\partial h}{\\partial x}\\big|_{x=\\hat{x}_{k}^{-}}$。\n3. 为推导出的模型实现 EKF 的时间更新和测量更新递推。\n\n物理参数 (使用以下数值)：\n- 核心热容：$C_c = 120\\,\\mathrm{J/K}$。\n- 表面热容：$C_s = 40\\,\\mathrm{J/K}$。\n- 核心-表面热阻：$R_{cs} = 0.08\\,\\mathrm{K/W}$。\n- 表面-环境热阻：$R_{se} = 1.2\\,\\mathrm{K/W}$。\n- 环境温度：$T_a = 25\\,^\\circ\\mathrm{C}$。\n- 参考内阻：$R_0 = 0.015\\,\\Omega$。\n- 电阻温度系数：$\\alpha = 0.004\\,\\mathrm{K}^{-1}$。\n- 参考温度：$T_{\\mathrm{ref}} = 25\\,^\\circ\\mathrm{C}$。\n- 采样周期：$\\Delta t = 1\\,\\mathrm{s}$。\n\n噪声模型和滤波器初始化：\n- 过程噪声协方差 $Q$ 和测量噪声协方差 $R$ 是对角矩阵，具体值在每个测试用例中指定。\n- 将 EKF 的状态估计初始值设为 $\\hat{x}_0$，协方差初始值设为 $P_0$，具体值在每个测试用例中指定。\n\n用于评估的测量值生成：\n- 对于每个测试用例，通过使用上述相同的离散化方法和参数模拟真实双节点热力系统，生成一个合成测量序列，然后在表面温度上添加指定方差为 $R$ 的零均值高斯测量噪声。为保证可复现性，请使用固定的随机种子。\n\n测试套件：\n- 用例 1 (理想情况)：$N = 300$ 步，所有 $k$ 的电流 $I_k = 20\\,\\mathrm{A}$，$Q = \\mathrm{diag}([0.005,\\,0.005])\\,\\mathrm{K}^2$，$R = 0.04\\,\\mathrm{K}^2$，真实初始状态 $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$，滤波器初始状态 $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声随机种子 $42$。\n- 用例 2 (边界冷却)：$N = 300$ 步，所有 $k$ 的电流 $I_k = 0\\,\\mathrm{A}$，$Q = \\mathrm{diag}([0.0025,\\,0.0025])\\,\\mathrm{K}^2$，$R = 0.09\\,\\mathrm{K}^2$，真实初始状态 $x_0^{\\mathrm{true}} = \\begin{bmatrix}45 \\\\ 35\\end{bmatrix}$，滤波器初始状态 $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声随机种子 $123$。\n- 用例 3 (边缘情况: 脉冲加热和高传感器噪声)：$N = 300$ 步，电流曲线 $$I_k = \\begin{cases}0\\,\\mathrm{A},  0 \\le k  100, \\\\ 30\\,\\mathrm{A},  100 \\le k  200, \\\\ 0\\,\\mathrm{A},  200 \\le k \\le 299, \\end{cases}$$ $Q = \\mathrm{diag}([0.01,\\,0.01])\\,\\mathrm{K}^2$，$R = 2.25\\,\\mathrm{K}^2$，真实初始状态 $x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$，滤波器初始状态 $\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声随机种子 $7$。\n\n所需输出：\n- 对于每个测试用例，对生成的测量序列运行您的 EKF，并返回最终估计的核心温度 $\\hat{T}_{c,N}$。\n- 将每个最终估计的核心温度以摄氏度表示，并四舍五入到小数点后两位。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按用例 $1$、$2$、$3$ 的顺序排列结果（例如，$$[x_1,x_2,x_3]$$，其中每个 $x_i$ 是一个浮点数，代表以 $^\\circ\\mathrm{C}$ 为单位并四舍五入到小数点后两位的 $\\hat{T}_{c,N}$）。\n\n所有数学步骤必须从上述指定的基本原理推导而来，并且 EKF 的公式必须包含明确的状态方程、测量方程及其雅可比矩阵。",
            "solution": "在尝试提供解决方案之前，对问题进行验证。\n\n### 第 1 步：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n\n**系统动力学：**\n- 核心节点能量平衡：$$C_c \\frac{d T_c}{dt} = q(T_c,I) - \\frac{T_c - T_s}{R_{cs}}$$\n- 表面节点能量平衡：$$C_s \\frac{d T_s}{dt} = \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}}$$\n- 生热模型：$$q(T_c,I) = I^2 R_{\\mathrm{int}}(T_c), \\quad R_{\\mathrm{int}}(T_c) = R_0\\left(1 + \\alpha (T_c - T_{\\mathrm{ref}})\\right)$$\n\n**状态空间模型构建：**\n- 状态向量：$x_k = \\begin{bmatrix} T_{c,k} \\\\ T_{s,k} \\end{bmatrix}$\n- 离散化方法：显式欧拉法，采样周期为 $\\Delta t$。\n- 过程噪声：加性、零均值高斯噪声 $w_k$，协方差为 $Q$。\n- 测量：表面温度 $T_{s,k}$。\n- 测量噪声：加性、零均值高斯噪声 $v_k$，协方差为 $R$。\n\n**物理参数：**\n- $C_c = 120\\,\\mathrm{J/K}$\n- $C_s = 40\\,\\mathrm{J/K}$\n- $R_{cs} = 0.08\\,\\mathrm{K/W}$\n- $R_{se} = 1.2\\,\\mathrm{K/W}$\n- $T_a = 25\\,^\\circ\\mathrm{C}$\n- $R_0 = 0.015\\,\\Omega$\n- $\\alpha = 0.004\\,\\mathrm{K}^{-1}$\n- $T_{\\mathrm{ref}} = 25\\,^\\circ\\mathrm{C}$\n- $\\Delta t = 1\\,\\mathrm{s}$\n\n**测试套件：**\n- **用例 1：** $N = 300$，$I_k = 20\\,\\mathrm{A}$ (恒定)，$Q = \\mathrm{diag}([0.005,\\,0.005])\\,\\mathrm{K}^2$，$R = 0.04\\,\\mathrm{K}^2$，$x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声种子 $42$。\n- **用例 2：** $N = 300$，$I_k = 0\\,\\mathrm{A}$ (恒定)，$Q = \\mathrm{diag}([0.0025,\\,0.0025])\\,\\mathrm{K}^2$，$R = 0.09\\,\\mathrm{K}^2$，$x_0^{\\mathrm{true}} = \\begin{bmatrix}45 \\\\ 35\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声种子 $123$。\n- **用例 3：** $N = 300$，$I_k = \\begin{cases}0\\,\\mathrm{A},  0 \\le k  100 \\\\ 30\\,\\mathrm{A},  100 \\le k  200 \\\\ 0\\,\\mathrm{A},  200 \\le k \\le 299 \\end{cases}$，$Q = \\mathrm{diag}([0.01,\\,0.01])\\,\\mathrm{K}^2$，$R = 2.25\\,\\mathrm{K}^2$，$x_0^{\\mathrm{true}} = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$\\hat{x}_0 = \\begin{bmatrix}25 \\\\ 25\\end{bmatrix}\\,^\\circ\\mathrm{C}$，$P_0 = \\mathrm{diag}([9,\\,9])\\,\\mathrm{K}^2$，测量噪声种子 $7$。\n\n**所需输出：**\n- 对应每个用例的最终估计核心温度 $\\hat{T}_{c,N}$，四舍五入到小数点后两位，格式为逗号分隔的列表并用方括号括起。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据指定标准对问题进行验证：\n- **科学依据：** 问题基于热力学第一定律（能量守恒）以及传导/对流传热（热阻网络）和电阻器焦耳热的标准模型。这是热工学中一种常用且有效的方法。该模型具有科学合理性。\n- **适定性：** 问题提供了一整套微分方程、参数、初始条件、噪声统计数据和输入曲线。它要求实现一个标准估计算法 (EKF) 来找到一个唯一解（状态轨迹估计）。该问题是适定的。\n- **客观性：** 问题以精确、量化的术语陈述。所有参数都已定义，目标明确。没有主观或模糊的语言。\n- **完整性和一致性：** 解决每个测试用例所需的所有数据都已提供。没有缺失的参数或矛盾的约束。\n- **现实性：** 参数在圆柱形锂离子电池的合理范围内，双节点模型是一种标准的简化方法。该任务是现实的。\n\n### 第 3 步：结论与行动\n问题具有科学合理性、适定性、客观性和完整性。因此，该问题是 **有效的**。将提供一个解决方案。\n\n### 解决方案推导\n\n该解决方案需要为一个双节点电池热模型推导和实现扩展卡尔曼滤波器 (EKF)。推导过程分三部分：构建离散时间状态空间模型，推导必要的雅可比矩阵，以及指定 EKF 算法。\n\n**1. 离散时间状态空间模型**\n\n首先，我们将给定的连续时间微分方程改写为状态空间形式。设状态向量为 $x = \\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix}$。系统动力学可以写成 $\\dot{x} = \\phi(x, u)$，其中 $u = I$ 是输入电流。\n\n$$\n\\frac{d}{dt}\\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix} = \\begin{bmatrix} \\frac{1}{C_c} \\left( I^2 R_0(1 + \\alpha(T_c - T_{\\mathrm{ref}})) - \\frac{T_c - T_s}{R_{cs}} \\right) \\\\ \\frac{1}{C_s} \\left( \\frac{T_c - T_s}{R_{cs}} - \\frac{T_s - T_a}{R_{se}} \\right) \\end{bmatrix}\n$$\n\n我们使用显式（前向）欧拉方法 $x_{k+1} = x_k + \\Delta t \\, \\phi(x_k, u_k)$ 对该系统进行离散化。这为过程模型 $x_{k+1} = f(x_k, u_k)$ 提供了非线性状态转移函数 $f(\\cdot)$。\n\n$f(x_k, u_k)$ 的分量是：\n$$\nT_{c,k+1} = T_{c,k} + \\frac{\\Delta t}{C_c} \\left( I_k^2 R_0(1 + \\alpha(T_{c,k} - T_{\\mathrm{ref}})) - \\frac{T_{c,k} - T_{s,k}}{R_{cs}} \\right)\n$$\n$$\nT_{s,k+1} = T_{s,k} + \\frac{\\Delta t}{C_s} \\left( \\frac{T_{c,k} - T_{s,k}}{R_{cs}} - \\frac{T_{s,k} - T_a}{R_{se}} \\right)\n$$\n\n完整的离散时间过程模型，包括零均值高斯过程噪声 $w_k \\sim \\mathcal{N}(0, Q)$，为：\n$$\nx_{k+1} = f(x_k, I_k) + w_k\n$$\n\n测量值 $z_k$ 是被零均值高斯噪声 $v_k \\sim \\mathcal{N}(0, R)$ 污染的表面温度。测量函数 $h(\\cdot)$ 是线性的：\n$$\nz_k = h(x_k) + v_k = T_{s,k} + v_k = \\begin{bmatrix} 0  1 \\end{bmatrix} x_k + v_k\n$$\n\n**2. EKF 雅可比矩阵推导**\n\nEKF 围绕当前状态估计对非线性函数 $f$ 和 $h$ 进行线性化。这需要它们的雅可比矩阵。\n\n状态雅可比矩阵 $F_k$ 是 $f$ 对状态 $x$ 的偏导数，在估计值 $\\hat{x}_k$ 和输入 $I_k$ 处求值。设 $x = \\begin{bmatrix} T_c \\\\ T_s \\end{bmatrix}$。\n$$\nF_k = \\frac{\\partial f}{\\partial x}\\bigg|_{\\hat{x}_k, I_k} = \\begin{bmatrix} \\frac{\\partial f_1}{\\partial T_c}  \\frac{\\partial f_1}{\\partial T_s} \\\\ \\frac{\\partial f_2}{\\partial T_c}  \\frac{\\partial f_2}{\\partial T_s} \\end{bmatrix}\\bigg|_{\\hat{x}_k, I_k}\n$$\n各分量为：\n- $\\frac{\\partial f_1}{\\partial T_c} = 1 + \\frac{\\Delta t}{C_c} \\left( I_k^2 R_0 \\alpha - \\frac{1}{R_{cs}} \\right)$\n- $\\frac{\\partial f_1}{\\partial T_s} = \\frac{\\Delta t}{C_c R_{cs}}$\n- $\\frac{\\partial f_2}{\\partial T_c} = \\frac{\\Delta t}{C_s R_{cs}}$\n- $\\frac{\\partial f_2}{\\partial T_s} = 1 + \\frac{\\Delta t}{C_s} \\left( -\\frac{1}{R_{cs}} - \\frac{1}{R_{se}} \\right) = 1 - \\frac{\\Delta t}{C_s} \\left( \\frac{1}{R_{cs}} + \\frac{1}{R_{se}} \\right)$\n\n测量雅可比矩阵 $H_k$ 是 $h$ 对 $x$ 的偏导数。由于 $h$ 是线性的，该雅可比矩阵是一个常数：\n$$\nH_k = \\frac{\\partial h}{\\partial x} = \\begin{bmatrix} \\frac{\\partial T_s}{\\partial T_c}  \\frac{\\partial T_s}{\\partial T_s} \\end{bmatrix} = \\begin{bmatrix} 0  1 \\end{bmatrix}\n$$\n\n**3. 扩展卡尔曼滤波器算法**\nEKF 在一个两步递推循环中运行：预测和校正。\n\n**初始化：**\n- 状态估计：$\\hat{x}_0$\n- 协方差估计：$P_0$\n\n**递推，对于 $k = 0, \\dots, N-1$：**\n给定估计值 $\\hat{x}_k$ 和 $P_k$，我们计算下一个时间步 $k+1$ 的估计值。\n\n**时间更新 (预测)：**\n1.  使用非线性模型预测下一状态：\n    $$ \\hat{x}_{k+1}^- = f(\\hat{x}_k, I_k) $$\n2.  通过在当前估计值处计算状态雅可比矩阵来线性化系统：\n    $$ F_k = \\frac{\\partial f}{\\partial x}\\bigg|_{\\hat{x}_k, I_k} $$\n3.  传播误差协方差：\n    $$ P_{k+1}^- = F_k P_k F_k^T + Q $$\n\n**测量更新 (校正)：**\n1.  获取测量值 $z_{k+1}$。\n2.  测量雅可比矩阵 $H_{k+1}$ 是常数：$H_{k+1} = \\begin{bmatrix} 0  1 \\end{bmatrix}$。\n3.  计算新息（测量残差）：\n    $$ y_{k+1} = z_{k+1} - h(\\hat{x}_{k+1}^-) = z_{k+1} - \\hat{T}_{s, k+1}^- $$\n4.  计算新息协方差：\n    $$ S_{k+1} = H_{k+1} P_{k+1}^- H_{k+1}^T + R $$\n5.  计算最优卡尔曼增益：\n    $$ K_{k+1} = P_{k+1}^- H_{k+1}^T S_{k+1}^{-1} $$\n6.  使用测量信息更新状态估计：\n    $$ \\hat{x}_{k+1} = \\hat{x}_{k+1}^- + K_{k+1} y_{k+1} $$\n7.  更新误差协方差：\n    $$ P_{k+1} = (I - K_{k+1} H_{k+1}) P_{k+1}^- $$\n\n理论推导到此结束。实现过程将对每个测试用例遵循此程序。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery thermal state estimation problem using an Extended Kalman Filter (EKF).\n    \"\"\"\n\n    # Physical parameters\n    Cc = 120.0  # Core capacitance (J/K)\n    Cs = 40.0   # Surface capacitance (J/K)\n    Rcs = 0.08  # Core-surface thermal resistance (K/W)\n    Rse = 1.2   # Surface-environment thermal resistance (K/W)\n    Ta = 25.0   # Ambient temperature (deg C)\n    R0 = 0.015  # Reference internal resistance (Ohm)\n    alpha = 0.004 # Resistance temperature coefficient (1/K)\n    T_ref = 25.0 # Reference temperature (deg C)\n    dt = 1.0    # Sampling period (s)\n\n    # Test cases\n    test_cases = [\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 20.0,\n            \"Q\": np.diag([0.005, 0.005]),\n            \"R\": 0.04,\n            \"x0_true\": np.array([25.0, 25.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 42\n        },\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 0.0,\n            \"Q\": np.diag([0.0025, 0.0025]),\n            \"R\": 0.09,\n            \"x0_true\": np.array([45.0, 35.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 123\n        },\n        {\n            \"N\": 300,\n            \"I_profile\": lambda k: 30.0 if 100 = k  200 else 0.0,\n            \"Q\": np.diag([0.01, 0.01]),\n            \"R\": 2.25,\n            \"x0_true\": np.array([25.0, 25.0]),\n            \"x0_est\": np.array([25.0, 25.0]),\n            \"P0\": np.diag([9.0, 9.0]),\n            \"seed\": 7\n        }\n    ]\n\n    results = []\n\n    # --- EKF Helper Functions ---\n    def state_transition_func(x, I):\n        Tc, Ts = x\n        R_int = R0 * (1 + alpha * (Tc - T_ref))\n        q_gen = I**2 * R_int\n        \n        dTc_dt = (q_gen - (Tc - Ts) / Rcs) / Cc\n        dTs_dt = ((Tc - Ts) / Rcs - (Ts - Ta) / Rse) / Cs\n        \n        x_next = x + dt * np.array([dTc_dt, dTs_dt])\n        return x_next\n\n    def measurement_func(x):\n        return x[1]\n\n    def state_jacobian(x, I):\n        # The Jacobian of the state transition function `f` with respect to state `x`.\n        # Since the dynamics are linear in T_c and T_s (after evaluating the nonlinear term),\n        # the Jacobian is constant with respect to x.\n        F = np.zeros((2, 2))\n        F[0, 0] = 1 + (dt / Cc) * (I**2 * R0 * alpha - 1 / Rcs)\n        F[0, 1] = (dt / Cc) * (1 / Rcs)\n        F[1, 0] = (dt / Cs) * (1 / Rcs)\n        F[1, 1] = 1 + (dt / Cs) * (-1 / Rcs - 1 / Rse)\n        return F\n\n    H = np.array([[0.0, 1.0]])\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        I_profile = case[\"I_profile\"]\n        Q = case[\"Q\"]\n        R = case[\"R\"]\n        seed = case[\"seed\"]\n\n        # --- 1. Generate Synthetic Measurements ---\n        rng = np.random.default_rng(seed)\n        x_true = case[\"x0_true\"].copy()\n        measurements = np.zeros(N)\n        \n        for k in range(N):\n            I_k = I_profile(k)\n            # The \"true\" system evolves from k to k+1\n            x_true = state_transition_func(x_true, I_k)\n            # Measurement is for state at k+1, taken at time k+1\n            measurement_noise = rng.normal(0, np.sqrt(R))\n            measurements[k] = measurement_func(x_true) + measurement_noise\n\n        # --- 2. Run Extended Kalman Filter ---\n        x_est = case[\"x0_est\"].copy()\n        P_est = case[\"P0\"].copy()\n        Id = np.eye(2)\n\n        for k in range(N):\n            # Input current at step k that influences state transition from k to k+1\n            I_k = I_profile(k)\n            \n            # --- Prediction (Time Update from k to k+1) ---\n            # Predict state for k+1 based on estimated state at k\n            x_pred = state_transition_func(x_est, I_k)\n            \n            # Calculate Jacobian F_k evaluated at the current estimate x_est\n            F_k = state_jacobian(x_est, I_k)\n            \n            # Predict covariance for k+1\n            P_pred = F_k @ P_est @ F_k.T + Q\n\n            # --- Correction (Measurement Update at k+1) ---\n            # Get measurement corresponding to state at k+1\n            z_k_plus_1 = measurements[k]\n            \n            # Innovation\n            y = z_k_plus_1 - measurement_func(x_pred)\n            \n            # Innovation covariance\n            S = H @ P_pred @ H.T + R\n            \n            # Kalman gain\n            K = (P_pred @ H.T) / S\n            K = K.reshape((2,1))\n            \n            # Update state estimate for k+1\n            x_est = x_pred + (K * y).flatten()\n            \n            # Update covariance estimate for k+1\n            P_est = (Id - K @ H) @ P_pred\n        \n        results.append(f\"{x_est[0]:.2f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}