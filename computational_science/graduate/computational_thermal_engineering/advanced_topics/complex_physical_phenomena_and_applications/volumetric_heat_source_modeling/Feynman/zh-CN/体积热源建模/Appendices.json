{
    "hands_on_practices": [
        {
            "introduction": "这项实践提供了一个基础的解析建模练习。在进行复杂的数值模拟之前，通过解析模型掌握理想化情况下的解对于建立物理直觉至关重要。本练习要求您推导一个具有均匀热源但热导率随温度变化的平板内的温度分布 ，这是实际材料中的常见情况，它将迫使您从第一性原理出发求解一个非线性微分方程。",
            "id": "4004507",
            "problem": "一个厚度为 $L$ 的一维平面固体板占据 $0 \\le x \\le L$ 的区域。该板以均匀的体积生热率 $q'''$（在空间和时间上恒定）产生热量，其中 $q''' > 0$。其热导率与温度相关，并遵循线性本构关系 $k(T) = k_0 \\left[ 1 + \\beta \\left( T - T_0 \\right) \\right]$，其中 $k_0 > 0$ 是参考热导率，$\\beta \\ge 0$ 是材料参数，$T_0$ 是参考温度。$x = 0$ 处的边界是完美绝热的（无热通量），而 $x = L$ 处的边界保持在恒定温度 $T_s$。\n\n从固定控制体积内的能量守恒和傅里叶热传导定律出发，不使用任何简化公式，推导稳态温度场 $T(x)$ 的控制方程，然后确定最高温度的位置 $x_{\\max}$ 及其值 $T_{\\max}$。以 $L$、$q'''$、$k_0$、$\\beta$、$T_0$ 和 $T_s$ 的形式，给出 $x_{\\max}$ 和 $T_{\\max}$ 的封闭解析表达式。以米为单位报告 $x_{\\max}$，以开尔文为单位报告 $T_{\\max}$。不需要数值四舍五入；给出精确表达式。",
            "solution": "首先根据既定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n-   **几何**：一个厚度为 $L$ 的一维平面固体板，占据区域 $0 \\le x \\le L$。\n-   **生热**：均匀的体积生热率 $q'''$，为一个正的常数。\n-   **热导率**：一个与温度相关的属性，由线性关系 $k(T) = k_0 \\left[ 1 + \\beta \\left( T - T_0 \\right) \\right]$ 给出。\n-   **常数**：$k_0 > 0$ 是参考热导率，$\\beta \\ge 0$ 是材料参数，$T_0$ 是参考温度。\n-   **边界条件**：\n    -   在 $x=0$ 处：边界是完美绝热的，意味着热通量为零。\n    -   在 $x=L$ 处：边界维持在恒定温度 $T_s$。\n-   **目标**：从第一性原理出发，推导稳态温度场 $T(x)$ 的控制方程，然后求出最高温度的位置 $x_{\\max}$ 和值 $T_{\\max}$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于热传导原理，特别是傅里叶定律和能量守恒。温度相关的热导率线性模型是热工学中一个标准且物理上现实的近似。该问题在科学上是合理的。\n-   **适定性**：该问题描述了一个二阶常微分方程，带有一个通量边界条件（诺伊曼条件）和一个温度边界条件（狄利克雷条件）。这构成了一个适定的边值问题，预期存在唯一且稳定的解。\n-   **客观性**：问题陈述使用清晰、精确且明确的技术语言，不含主观或基于观点的论断。\n\n### 步骤3：结论与行动\n该问题在科学上合理、适定且客观。判定为**有效**。将提供完整解答。\n\n### 推导与求解\n\n分析始于将能量守恒原理应用于板内的一个微分控制体积。对于具有内热源的一维稳态系统，能量平衡方程为：\n$$ \\frac{d}{dx} \\left( q''_{x} \\right) = q''' $$\n其中 $q''_{x}$ 是 $x$ 方向的热通量。\n\n根据傅里叶热传导定律，热通量与温度梯度相关：\n$$ q''_{x} = -k(T) \\frac{dT}{dx} $$\n将傅里叶定律代入能量平衡方程，得到温度场 $T(x)$ 的控制微分方程：\n$$ \\frac{d}{dx} \\left( -k(T) \\frac{dT}{dx} \\right) = q''' $$\n$$ \\frac{d}{dx} \\left( k(T) \\frac{dT}{dx} \\right) + q''' = 0 $$\n这就是所要求的控制关系。为了解这个方程，我们对它关于 $x$ 进行积分：\n$$ k(T) \\frac{dT}{dx} = -q''' x + C_1 $$\n其中 $C_1$ 是一个积分常数。\n\n第一个边界条件是在 $x=0$ 处的壁面是完美绝热的。这意味着在该位置没有热通量：\n$$ q''_{x}(0) = -k(T(0)) \\frac{dT}{dx}\\bigg|_{x=0} = 0 $$\n由于热导率 $k(T)$ 是严格为正的（给定 $k_0 > 0$，$\\beta \\ge 0$，并假设温度具有物理意义），这个条件意味着在 $x=0$ 处的温度梯度必须为零：\n$$ \\frac{dT}{dx}\\bigg|_{x=0} = 0 $$\n将此应用于 $x=0$ 处的积分方程：\n$$ k(T(0)) \\cdot (0) = -q'''(0) + C_1 \\implies C_1 = 0 $$\n因此，方程简化为：\n$$ k(T) \\frac{dT}{dx} = -q''' x $$\n最高温度的位置 $x_{\\max}$ 是温度梯度为零的地方，即 $\\frac{dT}{dx} = 0$。根据上述方程，由于 $k(T) > 0$ 和 $q''' > 0$，这个条件仅在 $x=0$ 处满足。\n因此，最高温度的位置是 $x_{\\max} = 0$。最高温度是 $T_{\\max} = T(0)$。\n\n为了求出温度分布，我们代入给定的 $k(T)$ 表达式：\n$$ k_0 \\left[ 1 + \\beta (T - T_0) \\right] \\frac{dT}{dx} = -q''' x $$\n我们分离变量并积分。我们从 $x=0$（此处 $T = T_{\\max}$）积分到一个任意位置 $x$：\n$$ k_0 \\int_{T_{\\max}}^{T(x)} \\left[ 1 + \\beta (T' - T_0) \\right] dT' = \\int_{0}^{x} -q''' \\xi \\, d\\xi $$\n$$ k_0 \\left[ T' + \\frac{\\beta}{2}T'^2 - \\beta T_0 T' \\right]_{T_{\\max}}^{T(x)} = \\left[ -\\frac{q'''}{2}\\xi^2 \\right]_{0}^{x} $$\n$$ k_0 \\left\\{ \\left(T(x) + \\frac{\\beta}{2}T(x)^2 - \\beta T_0 T(x)\\right) - \\left(T_{\\max} + \\frac{\\beta}{2}T_{\\max}^2 - \\beta T_0 T_{\\max}\\right) \\right\\} = -\\frac{q'''x^2}{2} $$\n这个方程给出了温度分布 $T(x)$。为了求出 $T_{\\max}$，我们应用第二个边界条件 $T(L) = T_s$，即令 $x=L$：\n$$ k_0 \\left\\{ \\left(T_s + \\frac{\\beta}{2}T_s^2 - \\beta T_0 T_s\\right) - \\left(T_{\\max} + \\frac{\\beta}{2}T_{\\max}^2 - \\beta T_0 T_{\\max}\\right) \\right\\} = -\\frac{q'''L^2}{2} $$\n重新整理此方程以求解包含 $T_{\\max}$ 的项：\n$$ T_{\\max} + \\frac{\\beta}{2}T_{\\max}^2 - \\beta T_0 T_{\\max} = T_s + \\frac{\\beta}{2}T_s^2 - \\beta T_0 T_s + \\frac{q'''L^2}{2k_0} $$\n这是一个关于 $T_{\\max}$ 的二次方程，形式为 $aT_{\\max}^2 + bT_{\\max} + c = 0$：\n$$ \\left(\\frac{\\beta}{2}\\right)T_{\\max}^2 + (1 - \\beta T_0)T_{\\max} - \\left(T_s(1 - \\beta T_0) + \\frac{\\beta}{2}T_s^2 + \\frac{q'''L^2}{2k_0}\\right) = 0 $$\n使用二次公式 $T_{\\max} = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解 $T_{\\max}$：\n$$ T_{\\max} = \\frac{-(1 - \\beta T_0) \\pm \\sqrt{(1 - \\beta T_0)^2 + 4(\\frac{\\beta}{2})\\left(T_s(1 - \\beta T_0) + \\frac{\\beta}{2}T_s^2 + \\frac{q'''L^2}{2k_0}\\right)}}{2(\\frac{\\beta}{2})} $$\n$$ T_{\\max} = \\frac{\\beta T_0 - 1 \\pm \\sqrt{(1 - 2\\beta T_0 + \\beta^2 T_0^2) + 2\\beta T_s - 2\\beta^2 T_0 T_s + \\beta^2 T_s^2 + \\frac{\\beta q'''L^2}{k_0}}}{\\beta} $$\n平方根下的项可以简化：\n$$ 1 + 2\\beta(T_s - T_0) + \\beta^2(T_s^2 - 2T_0 T_s + T_0^2) + \\frac{\\beta q'''L^2}{k_0} = \\left[1 + \\beta(T_s - T_0)\\right]^2 + \\frac{\\beta q'''L^2}{k_0} $$\n所以解变为：\n$$ T_{\\max} = \\frac{\\beta T_0 - 1 \\pm \\sqrt{\\left[1 + \\beta(T_s - T_0)\\right]^2 + \\frac{\\beta q'''L^2}{k_0}}}{\\beta} $$\n为了选择正确的符号，我们考虑当 $\\beta \\to 0$（热导率恒定）时的物理极限。使用正号会导致一个 $0/0$ 的不定型，可以通过使用洛必达法则来解决，得到正确的物理结果 $T_{\\max} = T_s + \\frac{q'''L^2}{2k_0}$。负号会产生一个非物理的结果。因此，我们必须选择正号。\n$$ T_{\\max} = \\frac{\\beta T_0 - 1 + \\sqrt{\\left[1 + \\beta(T_s - T_0)\\right]^2 + \\frac{\\beta q'''L^2}{k_0}}}{\\beta} $$\n通过加上和减去 $T_0$，这个表达式可以改写为：\n$$ T_{\\max} = T_0 + \\frac{-1 + \\sqrt{\\left[1 + \\beta(T_s - T_0)\\right]^2 + \\frac{\\beta q'''L^2}{k_0}}}{\\beta} $$\n\n总结一下，最终的解析表达式是：\n1.  最高温度的位置是 $x_{\\max} = 0$。\n2.  最高温度 $T_{\\max}$（对于 $\\beta > 0$）由上面推导的表达式给出。对于特殊情况 $\\beta = 0$，其值是该表达式的极限，$T_{\\max} = T_s + \\frac{q'''L^2}{2k_0}$。如果将在 $\\beta=0$ 处的值理解为极限，则所提供的形式对整个定义域 $\\beta \\ge 0$ 均有效。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0 & T_0 + \\frac{1}{\\beta} \\left( \\sqrt{\\left[1 + \\beta \\left(T_s - T_0\\right)\\right]^2 + \\frac{\\beta q''' L^2}{k_0}} - 1 \\right) \\end{pmatrix}}$$"
        },
        {
            "introduction": "现在我们从解析方法过渡到数值离散化，特别是在有限元方法 (FEM) 的框架下。在有限元方法中，连续的物理问题被转化为基于单元网格的代数系统。本练习聚焦于一个关键步骤：将连续的体积热源 $q'''$ 转化为离散的单元源向量 $f_a$ ，这对于组装全局方程组至关重要。您将计算并比较更精确的“一致”源向量与更简单的“集总”近似，从而揭示有限元实现中精度与计算简便性之间的根本权衡。",
            "id": "4004531",
            "problem": "在有限元法（FEM）的背景下，针对单个线性四面体有限元，提出了一个带有体热生成的三维稳态热传导问题。对于均匀、各向同性的固体，其稳态能量平衡控制方程在单元域 $\\Omega_e$ 内为 $\\nabla \\cdot (k \\nabla T) + q''' = 0$，其中 $k$ 是热导率，$T$ 是温度，$q'''$ 是体热源密度。\n\n该单元是一个四面体，其节点的笛卡尔坐标（单位：米）为：节点 $1$ 位于 $(0,0,0)$，节点 $2$ 位于 $(L,0,0)$，节点 $3$ 位于 $(0,L,0)$，节点 $4$ 位于 $(0,0,L)$，其中 $L = 0.01$。体热源密度在空间上呈线性变化：$q'''(x,y,z) = q_0 + ax + by + cz$，其中 $q_0 = 1.2 \\times 10^6$，$a = 4.0 \\times 10^8$，$b = -2.0 \\times 10^8$，$c = 1.0 \\times 10^8$，单位分别为 $\\mathrm{W}/\\mathrm{m}^3$ 和 $\\mathrm{W}/\\mathrm{m}^4$。\n\n使用线性四面体形函数 $N_a$（$a=1,2,3,4$），计算一致单元源载荷向量的分量 $f_a = \\int_{\\Omega_e} q''' N_a \\, d\\Omega$（对于 $a=1,2,3,4$）。然后，计算相应的集总近似分量 $f_a^{\\mathrm{lump}} = \\frac{1}{4} \\int_{\\Omega_e} q''' \\, d\\Omega$（对于 $a=1,2,3,4$）。按顺序 $(a=1,2,3,4)$ 报告四个一致分量，然后以相同顺序报告四个集总分量，所有单位均为瓦特（W）。将每个分量四舍五入到四位有效数字。",
            "solution": "用户需要计算具有空间变化的体热源的线性四面体有限元的一致和集总单元源载荷向量。\n\n**1. 问题公式化**\n\n给定的控制方程是带源项的稳态热传导方程：\n$$ \\nabla \\cdot (k \\nabla T) + q''' = 0 $$\n在有限元法（FEM）中，此方程被转换为弱形式，并在单元域 $\\Omega_e$ 上积分。源项对单元方程组的贡献是源载荷向量 $\\{f\\}$，其分量为单元每个节点 $a$ 的 $f_a$。\n\n**2. 一致源向量 $f_a$**\n\n一致源向量分量定义为：\n$$ f_a = \\int_{\\Omega_e} q'''(\\mathbf{x}) N_a(\\mathbf{x}) \\, d\\Omega $$\n其中 $N_a(\\mathbf{x})$ 是四面体的线性形函数。单元节点位于：\n- 节点 $1$：$(0,0,0)$\n- 节点 $2$：$(L,0,0)$\n- 节点 $3$：$(0,L,0)$\n- 节点 $4$：$(0,0,L)$\n其中 $L = 0.01 \\, \\mathrm{m}$。\n\n对于这个特定的“直角”四面体，线性形函数 $N_a(x,y,z)$ 由条件 $N_a(\\mathbf{x}_b) = \\delta_{ab}$ 导出，其中 $\\mathbf{x}_b$ 是节点 $b$ 的坐标向量，$\\delta_{ab}$ 是克罗内克δ。形函数为：\n$$ N_1(x,y,z) = 1 - \\frac{x}{L} - \\frac{y}{L} - \\frac{z}{L} $$\n$$ N_2(x,y,z) = \\frac{x}{L} $$\n$$ N_3(x,y,z) = \\frac{y}{L} $$\n$$ N_4(x,y,z) = \\frac{z}{L} $$\n\n体热源 $q'''$ 是位置的线性函数：\n$$ q'''(x,y,z) = q_0 + ax + by + cz $$\n由于 $q'''$ 是线性的，它可以通过使用线性形函数的插值来精确表示：\n$$ q'''(x,y,z) = \\sum_{j=1}^{4} N_j(x,y,z) q_j''' $$\n其中 $q_j'''$ 是节点 $j$ 处的热源值。让我们使用给定的常数计算这些节点值：$q_0 = 1.2 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3$，$a = 4.0 \\times 10^8 \\, \\mathrm{W}/\\mathrm{m}^4$，$b = -2.0 \\times 10^8 \\, \\mathrm{W}/\\mathrm{m}^4$ 和 $c = 1.0 \\times 10^8 \\, \\mathrm{W}/\\mathrm{m}^4$。\n$$ q_1''' = q'''(0,0,0) = q_0 = 1.2 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3 $$\n$$ q_2''' = q'''(L,0,0) = q_0 + aL = 1.2 \\times 10^6 + (4.0 \\times 10^8)(0.01) = 5.2 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3 $$\n$$ q_3''' = q'''(0,L,0) = q_0 + bL = 1.2 \\times 10^6 + (-2.0 \\times 10^8)(0.01) = -0.8 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3 $$\n$$ q_4''' = q'''(0,0,L) = q_0 + cL = 1.2 \\times 10^6 + (1.0 \\times 10^8)(0.01) = 2.2 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3 $$\n\n将 $q'''$ 的插值形式代入 $f_a$ 的定义：\n$$ f_a = \\int_{\\Omega_e} N_a \\left( \\sum_{j=1}^{4} N_j q_j''' \\right) d\\Omega = \\sum_{j=1}^{4} q_j''' \\int_{\\Omega_e} N_a N_j \\, d\\Omega $$\n涉及形函数乘积的积分是单元一致质量矩阵 $M_{aj}$ 的分量。对于线性四面体，使用标准公式：\n$$ \\int_{\\Omega_e} N_a N_j \\, d\\Omega = \\frac{V_e}{20}(1 + \\delta_{aj}) $$\n其中 $V_e$ 是单元的体积。对于给定的四面体，体积为 $V_e = \\frac{1}{6}L^3$。\n$$ V_e = \\frac{1}{6}(0.01)^3 = \\frac{1}{6} \\times 10^{-6} \\, \\mathrm{m}^3 $$\n使用这个公式，一致载荷向量的分量为：\n$$ f_a = \\sum_{j=1}^{4} q_j''' \\frac{V_e}{20}(1 + \\delta_{aj}) = \\frac{V_e}{20} \\left( \\sum_{j=1}^{4} q_j''' + q_a''' \\right) $$\n让我们计算节点热源值的总和：\n$$ \\sum_{j=1}^{4} q_j''' = (1.2 + 5.2 - 0.8 + 2.2) \\times 10^6 = 7.8 \\times 10^6 \\, \\mathrm{W}/\\mathrm{m}^3 $$\n现在我们可以计算每个 $f_a$：\n$$ f_1 = \\frac{V_e}{20} (7.8 \\times 10^6 + q_1''') = \\frac{10^{-6}/6}{20} (7.8 \\times 10^6 + 1.2 \\times 10^6) = \\frac{9.0 \\times 10^6}{120} \\times 10^{-6} = 0.075 \\, \\mathrm{W} $$\n$$ f_2 = \\frac{V_e}{20} (7.8 \\times 10^6 + q_2''') = \\frac{10^{-6}/6}{20} (7.8 \\times 10^6 + 5.2 \\times 10^6) = \\frac{13.0 \\times 10^6}{120} \\times 10^{-6} = \\frac{13}{120} \\approx 0.108333... \\, \\mathrm{W} $$\n$$ f_3 = \\frac{V_e}{20} (7.8 \\times 10^6 + q_3''') = \\frac{10^{-6}/6}{20} (7.8 \\times 10^6 - 0.8 \\times 10^6) = \\frac{7.0 \\times 10^6}{120} \\times 10^{-6} = \\frac{7}{120} \\approx 0.058333... \\, \\mathrm{W} $$\n$$ f_4 = \\frac{V_e}{20} (7.8 \\times 10^6 + q_4''') = \\frac{10^{-6}/6}{20} (7.8 \\times 10^6 + 2.2 \\times 10^6) = \\frac{10.0 \\times 10^6}{120} \\times 10^{-6} = \\frac{10}{120} \\approx 0.083333... \\, \\mathrm{W} $$\n\n**3. 集总源向量 $f_a^{\\mathrm{lump}}$**\n\n源向量的集总近似将单元中的总生热量 $Q_{\\mathrm{gen}}$ 平均分配到四个节点上：\n$$ f_a^{\\mathrm{lump}} = \\frac{1}{4} Q_{\\mathrm{gen}} = \\frac{1}{4} \\int_{\\Omega_e} q''' \\, d\\Omega $$\n总生热量 $Q_{\\mathrm{gen}}$ 是 $q'''$ 在单元体积上的积分。使用形函数插值：\n$$ Q_{\\mathrm{gen}} = \\int_{\\Omega_e} \\sum_{j=1}^{4} N_j q_j''' \\, d\\Omega = \\sum_{j=1}^{4} q_j''' \\int_{\\Omega_e} N_j \\, d\\Omega $$\n单个线性形函数在线性四面体上的积分为：\n$$ \\int_{\\Omega_e} N_j \\, d\\Omega = \\frac{V_e}{4} $$\n因此，总生热量为：\n$$ Q_{\\mathrm{gen}} = \\frac{V_e}{4} \\sum_{j=1}^{4} q_j''' = \\frac{10^{-6}/6}{4} (7.8 \\times 10^6) = \\frac{7.8}{24} = 0.325 \\, \\mathrm{W} $$\n（作为检验，$\\sum f_a = 0.075 + 13/120 + 7/120 + 10/120 = (9+13+7+10)/120 = 39/120 = 0.325 \\, \\mathrm{W} = Q_{\\mathrm{gen}}$，这证实了一致性。）\n\n集总源向量的所有分量都相等：\n$$ f_a^{\\mathrm{lump}} = \\frac{1}{4} Q_{\\mathrm{gen}} = \\frac{0.325}{4} = 0.08125 \\, \\mathrm{W} $$\n\n**4. 最终结果**\n\n题目要求将值四舍五入到四位有效数字。\n一致分量：\n$f_1 = 0.075 \\to 0.07500$\n$f_2 \\approx 0.108333... \\to 0.1083$\n$f_3 \\approx 0.058333... \\to 0.05833$\n$f_4 \\approx 0.083333... \\to 0.08333$\n\n集总分量：\n$f_a^{\\mathrm{lump}} = 0.08125$，这本身就是四位有效数字。\n\n最终结果以包含八个值的行的形式呈现：四个一致分量后跟四个集总分量。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 0.07500 & 0.1083 & 0.05833 & 0.08333 & 0.08125 & 0.08125 & 0.08125 & 0.08125 \\end{pmatrix}} $$"
        },
        {
            "introduction": "最后的这项实践将着手于一个完整的计算实现，它采用的是在许多商业和开源计算流体力学与传热软件中占主导地位的有限体积法 (FVM)。这个问题要求您开发一个程序，用于在非均匀网格上处理复杂的、空间变化的体积热源 ，从而超越理想化的场景。其核心要点在于，为了确保严格的守恒性，对源项进行恰当的单元平均积分至关重要，并且您将量化简单的中心点采样所引入的误差，这对于开发稳健而精确的模拟工具是至关重要的一课。",
            "id": "4004508",
            "problem": "您正在一个非均匀网格上模拟一个具有空间变化的体积热源的一维稳态热传导问题。我们所关注的物理量是单位体积的体积生热率，记为 $q'''(x)$，单位为 $\\mathrm{W\\,m^{-3}}$。计算任务是，在给定解析源函数的情况下，在一个非均匀网格上实现对单元平均源项的稳健计算，进行守恒性检验，并量化朴素的点采样与恰当的有限体积单元平均之间的差异。三角函数中的所有角度都必须以弧度为单位。在长度为 $L$ 的域上积分时，单位面积的总生热量为 $\\int_0^L q'''(x)\\,\\mathrm{d}x$，并且必须以 $\\mathrm{W\\,m^{-2}}$ 为单位报告。\n\n从一维稳态热传导的能量守恒积分形式出发，并遵循在有限体积法 (FVM) 下离散化保持守恒性的要求。您的程序必须使用这些原理在非均匀网格上计算单元平均源项。网格由位置为 $x_{j+1/2}$（$j=0,1,\\dots,N$）的控制体界面定义，其中 $x_{1/2}=0$ 和 $x_{N+1/2}=L$。非均匀性通过映射 $x_{j+1/2} = L\\left(\\frac{j}{N}\\right)^\\alpha$ 由拉伸指数 $\\alpha > 0$ 引入。对于单元索引 $i=1,2,\\dots,N$，单元宽度为 $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$。\n\n对于每个测试用例，您的程序必须：\n- 根据给定的 $L$、$N$ 和 $\\alpha$ 构建非均匀网格。\n- 按该用例的规定实现 $q'''(x)$。\n- 使用 FVM 所蕴含的积分形式计算每个控制体中的单元平均源项，不依赖于点采样。\n- 通过对各单元的积分源项求和，计算单位面积的总积分生热量 $Q=\\int_0^L q'''(x)\\,\\mathrm{d}x$，并以 $\\mathrm{W\\,m^{-2}}$ 为单位表示 $Q$。\n- 使用带控制体体积加权的相对 $L^2$ 范数，量化朴素的中心点采样与单元平均表示之间的偏差。具体来说，计算\n$$\n\\varepsilon = \\sqrt{\\frac{\\sum_{i=1}^{N} \\left(\\bar{q}_i - q'''(x_i)\\right)^2 \\,\\Delta x_i}{\\sum_{i=1}^{N} \\bar{q}_i^2 \\,\\Delta x_i}},\n$$\n其中 $\\bar{q}_i$ 是单元 $i$ 中的单元平均源项，$x_i = \\tfrac{1}{2}\\left(x_{i-1/2}+x_{i+1/2}\\right)$ 是单元中心。\n\n测试套件。实现以下四个科学上一致的测试用例。所有角度均以弧度为单位，$q'''(x)$ 的所有量均以 $\\mathrm{W\\,m^{-3}}$ 为单位。\n\n- 用例 1（平滑振荡加上局部高斯凸起，中等非均匀性）：\n    - 域长度：$L=1\\,\\mathrm{m}$，单元数量：$N=40$，拉伸指数：$\\alpha=1.7$。\n    - 源项：\n      $$\n      q'''(x) = a_0 + a_1 x + A\\sin(\\omega x + \\phi) + G\\exp\\!\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right).\n      $$\n      参数：$a_0=1.0\\times 10^5$, $a_1=5.0\\times 10^4\\,\\mathrm{W\\,m^{-4}}$, $A=1.5\\times 10^5$, $\\omega=24\\pi\\,\\mathrm{rad\\,m^{-1}}$, $\\phi=0$, $G=3.0\\times 10^5$, $x_0=0.6\\,\\mathrm{m}$, $\\sigma=0.07\\,\\mathrm{m}$。\n\n- 用例 2（在相对粗糙、轻度拉伸的网格上易产生混叠的高频振荡）：\n    - 域长度：$L=1\\,\\mathrm{m}$，单元数量：$N=24$，拉伸指数：$\\alpha=0.8$。\n    - 源项：\n      $$\n      q'''(x) = a_0 + a_1 x + A\\sin(\\omega x + \\phi) + G\\exp\\!\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right).\n      $$\n      参数：$a_0=8.0\\times 10^4$, $a_1=2.0\\times 10^4\\,\\mathrm{W\\,m^{-4}}$, $A=2.0\\times 10^5$, $\\omega=120\\pi\\,\\mathrm{rad\\,m^{-1}}$, $\\phi=0.3$, $G=1.0\\times 10^5$, $x_0=0.2\\,\\mathrm{m}$, $\\sigma=0.03\\,\\mathrm{m}$。\n\n- 用例 3（不连续阶跃加上振荡，需要特殊处理不连续点以避免伪振荡）：\n    - 域长度：$L=1\\,\\mathrm{m}$，单元数量：$N=32$，拉伸指数：$\\alpha=1.2$。\n    - 源项：\n      $$\n      q'''(x) = a_0 + a_1 x + A\\sin(\\omega x + \\phi) + H\\,\\mathsf{H}(x-x_d),\n      $$\n      其中 $\\mathsf{H}(\\cdot)$ 是亥维赛德阶跃函数。参数：$a_0=6.0\\times 10^4$, $a_1=3.0\\times 10^4\\,\\mathrm{W\\,m^{-4}}$, $A=1.0\\times 10^5$, $\\omega=36\\pi\\,\\mathrm{rad\\,m^{-1}}$, $\\phi=-0.2$, $H=4.0\\times 10^5$, $x_d=0.5\\,\\mathrm{m}$。\n\n- 用例 4（在一个边界附近有急剧指数衰减，加上温和振荡和高斯项，强拉伸网格）：\n    - 域长度：$L=2\\,\\mathrm{m}$，单元数量：$N=64$，拉伸指数：$\\alpha=2.5$。\n    - 源项：\n      $$\n      q'''(x) = a_0 + A\\sin(\\omega x + \\phi) + E\\exp\\!\\left(-\\frac{x}{\\lambda}\\right) + G\\exp\\!\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right),\n      $$\n      参数：$a_0=5.0\\times 10^4$, $A=0.8\\times 10^5$, $\\omega=30\\pi\\,\\mathrm{rad\\,m^{-1}}$, $\\phi=0$, $E=9.0\\times 10^5$, $\\lambda=0.12\\,\\mathrm{m}$, $G=2.0\\times 10^5$, $x_0=1.2\\,\\mathrm{m}$, $\\sigma=0.08\\,\\mathrm{m}$。\n\n最终输出规格。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于顺序为 $1,2,3,4$ 的每个用例，输出两个值：首先是单位面积的总积分生热量 $Q$（单位 $\\mathrm{W\\,m^{-2}}$），其次是相对偏差 $\\varepsilon$（小数形式）。因此，最终输出行必须按顺序包含 $8$ 个数字：$[Q_1,\\varepsilon_1,Q_2,\\varepsilon_2,Q_3,\\varepsilon_3,Q_4,\\varepsilon_4]$。",
            "solution": "该问题要求实现一种有限体积法 (FVM)，用于在一维非均匀网格上计算单元平均的体积热源。这项任务是计算传热学的核心，因为它确保了离散域内生成的总热量守恒，无论网格结构如何。该问题是适定的、有科学依据的，并为完整的计算求解提供了所有必要信息。\n\n### 原理：有限体积源项离散化\n\n有限体积法的基本原理是在划分计算域的一组离散控制体 (CVs) 上强制执行守恒律。对于稳态一维热传导，单个控制体 $CV_i$（从界面 $x_{i-1/2}$ 延伸至 $x_{i+1/2}$）上的能量平衡积分形式为：\n$$\n\\left(q_x A\\right)_{i+1/2} - \\left(q_x A\\right)_{i-1/2} + \\int_{CV_i} q'''(x) \\, dV = 0\n$$\n其中 $q_x$ 是 $x$ 方向的热通量 [$\\mathrm{W\\,m^{-2}}$]，$A$ 是横截面积 [$\\mathrm{m^2}$]，$q'''(x)$ 是体积生热率 [$\\mathrm{W\\,m^{-3}}$]。假设横截面积 $A$ 恒定且体积元 $dV = A \\, dx$，方程简化为：\n$$\nA \\left( (q_x)_{i+1/2} - (q_x)_{i-1/2} \\right) + A \\int_{x_{i-1/2}}^{x_{i+1/2}} q'''(x) \\, dx = 0\n$$\n除以单元体积 $V_i = A \\Delta x_i$，其中 $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$ 是单元宽度，我们得到离散方程：\n$$\n\\frac{(q_x)_{i+1/2} - (q_x)_{i-1/2}}{\\Delta x_i} + \\frac{1}{\\Delta x_i} \\int_{x_{i-1/2}}^{x_{i+1/2}} q'''(x) \\, dx = 0\n$$\n第二项代表热源的贡献。在 FVM 中，源项由其单元平均值 $\\bar{q}_i$ 表示，定义为：\n$$\n\\bar{q}_i = \\frac{1}{\\Delta x_i} \\int_{x_{i-1/2}}^{x_{i+1/2}} q'''(x) \\, dx\n$$\n这种积分形式至关重要。一种朴素的方法可能是在单元中心 $x_i$ 处对源进行采样，并假设 $\\bar{q}_i \\approx q'''(x_i)$。然而，对于非线性源函数或高度非均匀的网格，这种近似可能导致显著误差并违背守恒性。本问题要求对每个单元直接计算此积分。\n\n### 算法设计与实现\n\n该解决方案包括三个主要阶段：网格生成、源函数的解析积分以及所需度量（$Q$ 和 $\\varepsilon$）的计算。\n\n#### 1. 网格生成\n\n非均匀网格由单元界面的位置 $x_{j+1/2}$（$j=0, 1, \\dots, N$）定义。映射关系为：\n$$\nx_{j+1/2} = L \\left(\\frac{j}{N}\\right)^\\alpha\n$$\n这将创建一个根据指数 $\\alpha$ 进行拉伸的网格。如果 $\\alpha > 1$，单元在 $x=0$ 附近更密，在 $x=L$ 附近更疏。如果 $\\alpha  1$，则情况相反。如果 $\\alpha=1$，网格是均匀的。对于每个单元 $i$（其中 $i=1, \\dots, N$），单元宽度为 $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$，单元中心为 $x_i = \\frac{1}{2}(x_{i-1/2} + x_{i+1/2})$。\n\n#### 2. 源项积分\n\n为了计算 $\\bar{q}_i$，我们需要源函数 $q'''(x)$ 的解析原函数。设 $F(x) = \\int q'''(x) \\, dx$。根据微积分基本定理，单元 $i$ 上的积分为：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} q'''(x) \\, dx = F(x_{i+1/2}) - F(x_{i-1/2})\n$$\n问题中的源函数是基本函数的组合。我们逐项求其原函数：\n- **多项式**：$\\int (a_0 + a_1 x) \\,dx = a_0 x + \\frac{1}{2}a_1 x^2 + C$\n- **正弦**：$\\int A\\sin(\\omega x + \\phi) \\,dx = -\\frac{A}{\\omega}\\cos(\\omega x + \\phi) + C$\n- **高斯**：$\\int G\\exp\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right) \\,dx = G\\sigma\\sqrt{\\frac{\\pi}{2}}\\,\\mathrm{erf}\\left(\\frac{x-x_0}{\\sqrt{2}\\sigma}\\right) + C$，其中 $\\mathrm{erf}(\\cdot)$ 是误差函数，在 `scipy.special` 中可用。\n- **指数衰减**：$\\int E\\exp\\left(-\\frac{x}{\\lambda}\\right) \\,dx = -E\\lambda\\exp\\left(-\\frac{x}{\\lambda}\\right) + C$\n- **亥维赛德阶跃**：对于 $a  b$，积分 $\\int_a^b H\\,\\mathsf{H}(x-x_d)\\,dx$ 需要分段处理。其值为 $H \\cdot \\max(0, b - \\max(a, x_d))$，这正确地涵盖了三种情况：积分区间在不连续点 $x_d$ 之前、之后或跨越该点。\n\n实现将包含每个分量积分的模块化函数，然后根据每个测试用例的需要进行组合。\n\n#### 3. 度量计算\n\n- **总生热量 ($Q$)**：域 $[0, L]$ 上每单位面积的总生热量为 $Q = \\int_0^L q'''(x) \\, dx$。FVM 的一个关键特性是守恒性，这意味着所有控制体上的积分源项之和必须等于域上的总积分：\n    $$\n    Q = \\sum_{i=1}^N \\int_{x_{i-1/2}}^{x_{i+1/2}} q'''(x) \\, dx = \\sum_{i=1}^N \\bar{q}_i \\Delta x_i\n    $$\n    程序将使用此求和式计算 $Q$。\n\n- **相对偏差 ($\\varepsilon$)**：为量化朴素点采样近似引入的误差，我们计算单元平均源 $\\bar{q}_i$ 与点采样源 $q'''(x_i)$ 之差的体积加权的相对 $L^2$ 范数：\n    $$\n    \\varepsilon = \\sqrt{\\frac{\\sum_{i=1}^{N} \\left(\\bar{q}_i - q'''(x_i)\\right)^2 \\,\\Delta x_i}{\\sum_{i=1}^{N} \\bar{q}_i^2 \\,\\Delta x_i}}\n    $$\n    这需要在每个单元中心 $x_i$ 处计算 $q'''(x)$，然后应用该公式。非零的 $\\varepsilon$ 凸显了正确进行源项积分的重要性，尤其对于粗糙或拉伸的网格以及高度变化的源函数。\n\n最终的程序将根据这些原理系统地处理每个测试用例，计算 $Q$ 和 $\\varepsilon$，并按规定格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\n\n# --- Integral and Function Definitions ---\n\n# Polynomial term: q(x) = a0 + a1*x\ndef poly_func(x, a0, a1):\n    return a0 + a1 * x\n\ndef poly_integral(xa, xb, a0, a1):\n    F_b = a0 * xb + 0.5 * a1 * xb**2\n    F_a = a0 * xa + 0.5 * a1 * xa**2\n    return F_b - F_a\n\n# Sinusoidal term: q(x) = A*sin(omega*x + phi)\ndef sin_func(x, A, omega, phi):\n    return A * np.sin(omega * x + phi)\n\ndef sin_integral(xa, xb, A, omega, phi):\n    if omega == 0:\n        return A * np.sin(phi) * (xb - xa)\n    F_b = -A / omega * np.cos(omega * xb + phi)\n    F_a = -A / omega * np.cos(omega * xa + phi)\n    return F_b - F_a\n\n# Gaussian term: q(x) = G*exp(-(x-x0)^2 / (2*sigma^2))\ndef gauss_func(x, G, x0, sigma):\n    return G * np.exp(-((x - x0)**2) / (2 * sigma**2))\n\ndef gauss_integral(xa, xb, G, x0, sigma):\n    const = G * sigma * np.sqrt(np.pi / 2.0)\n    F_b = const * erf((xb - x0) / (np.sqrt(2) * sigma))\n    F_a = const * erf((xa - x0) / (np.sqrt(2) * sigma))\n    return F_b - F_a\n\n# Heaviside step term: q(x) = H*H(x - xd)\ndef heaviside_func(x, H, xd):\n    return H * np.heaviside(x - xd, 1)\n\ndef heaviside_integral(xa, xb, H, xd):\n    # This vectorized implementation handles all cases\n    # integral is H * max(0, xb - max(xa, xd))\n    return H * np.maximum(0, xb - np.maximum(xa, xd))\n\n# Exponential decay term: q(x) = E*exp(-x/lambda)\ndef exp_decay_func(x, E, lam):\n    return E * np.exp(-x / lam)\n\ndef exp_decay_integral(xa, xb, E, lam):\n    if lam == 0:\n        return 0\n    F_b = -E * lam * np.exp(-xb / lam)\n    F_a = -E * lam * np.exp(-xa / lam)\n    return F_b - F_a\n\n# --- Case Processing Function ---\n\ndef process_case(case_params):\n    \"\"\"\n    Processes a single test case to compute Q and epsilon.\n    \"\"\"\n    L = case_params['L']\n    N = case_params['N']\n    alpha = case_params['alpha']\n    p = case_params['params']\n    q_type = case_params['q_type']\n\n    # 1. Generate Mesh\n    j = np.arange(N + 1)\n    x_faces = L * (j / N)**alpha\n    delta_x = np.diff(x_faces)\n    x_centers = 0.5 * (x_faces[:-1] + x_faces[1:])\n\n    # 2. Define source and integral functions for the case\n    if q_type == 'case1' or q_type == 'case2':\n        q_func = lambda x: (poly_func(x, p['a0'], p['a1']) +\n                           sin_func(x, p['A'], p['omega'], p['phi']) +\n                           gauss_func(x, p['G'], p['x0'], p['sigma']))\n        integral_func = lambda xa, xb: (poly_integral(xa, xb, p['a0'], p['a1']) +\n                                       sin_integral(xa, xb, p['A'], p['omega'], p['phi']) +\n                                       gauss_integral(xa, xb, p['G'], p['x0'], p['sigma']))\n    elif q_type == 'case3':\n        q_func = lambda x: (poly_func(x, p['a0'], p['a1']) +\n                           sin_func(x, p['A'], p['omega'], p['phi']) +\n                           heaviside_func(x, p['H'], p['xd']))\n        integral_func = lambda xa, xb: (poly_integral(xa, xb, p['a0'], p['a1']) +\n                                       sin_integral(xa, xb, p['A'], p['omega'], p['phi']) +\n                                       heaviside_integral(xa, xb, p['H'], p['xd']))\n    elif q_type == 'case4':\n        q_func = lambda x: (p['a0'] +\n                           sin_func(x, p['A'], p['omega'], p['phi']) +\n                           exp_decay_func(x, p['E'], p['lambda']) +\n                           gauss_func(x, p['G'], p['x0'], p['sigma']))\n        integral_func = lambda xa, xb: (p['a0'] * (xb - xa) +\n                                       sin_integral(xa, xb, p['A'], p['omega'], p['phi']) +\n                                       exp_decay_integral(xa, xb, p['E'], p['lambda']) +\n                                       gauss_integral(xa, xb, p['G'], p['x0'], p['sigma']))\n\n    # 3. Compute cell-averaged sources\n    cell_integrals = integral_func(x_faces[:-1], x_faces[1:])\n    q_bar = cell_integrals / delta_x\n    \n    # 4. Compute total heat generation Q\n    Q = np.sum(cell_integrals)\n\n    # 5. Compute deviation epsilon\n    q_point = q_func(x_centers)\n    \n    numerator = np.sum((q_bar - q_point)**2 * delta_x)\n    denominator = np.sum(q_bar**2 * delta_x)\n    \n    epsilon = np.sqrt(numerator / denominator) if denominator != 0 else 0.0\n\n    return Q, epsilon\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        { # Case 1\n            'L': 1.0, 'N': 40, 'alpha': 1.7, 'q_type': 'case1',\n            'params': {\n                'a0': 1.0e5, 'a1': 5.0e4, 'A': 1.5e5, 'omega': 24 * np.pi,\n                'phi': 0.0, 'G': 3.0e5, 'x0': 0.6, 'sigma': 0.07,\n            }\n        },\n        { # Case 2\n            'L': 1.0, 'N': 24, 'alpha': 0.8, 'q_type': 'case2',\n            'params': {\n                'a0': 8.0e4, 'a1': 2.0e4, 'A': 2.0e5, 'omega': 120 * np.pi,\n                'phi': 0.3, 'G': 1.0e5, 'x0': 0.2, 'sigma': 0.03,\n            }\n        },\n        { # Case 3\n            'L': 1.0, 'N': 32, 'alpha': 1.2, 'q_type': 'case3',\n            'params': {\n                'a0': 6.0e4, 'a1': 3.0e4, 'A': 1.0e5, 'omega': 36 * np.pi,\n                'phi': -0.2, 'H': 4.0e5, 'xd': 0.5,\n            }\n        },\n        { # Case 4\n            'L': 2.0, 'N': 64, 'alpha': 2.5, 'q_type': 'case4',\n            'params': {\n                'a0': 5.0e4, 'A': 0.8e5, 'omega': 30 * np.pi, 'phi': 0.0,\n                'E': 9.0e5, 'lambda': 0.12, 'G': 2.0e5, 'x0': 1.2, 'sigma': 0.08,\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Q, epsilon = process_case(case)\n        results.extend([Q, epsilon])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}