{
    "hands_on_practices": [
        {
            "introduction": "In real-world electronic assemblies, surfaces are never perfectly smooth, and the imperfect contact between components creates a significant barrier to heat flow. This practice delves into modeling this phenomenon, known as thermal contact resistance, by considering how heat is funneled through microscopic asperity contacts. By linking a mechanical model of plastic deformation to the principles of thermal constriction resistance, you will derive an expression for the area-specific thermal contact resistance, $R''_t$, a critical parameter for accurately predicting junction temperatures in stacked electronic packages .",
            "id": "3943447",
            "problem": "An electronic module with a copper base is clamped to an aluminum heat sink. The nominally flat interface is formed by two rough surfaces pressed together under a uniform nominal contact pressure $p$. The interfacial conduction occurs only through a population of plastically deformed asperity microcontacts distributed uniformly over the apparent area $A_{\\text{app}}$. The copper and aluminum are modeled as semi-infinite solids with thermal conductivities $k_1$ and $k_2$, respectively. The microcontacts are assumed to be identical, circular, non-interacting patches of radius $a$; their number density per unit apparent area is $n_s$. The hardness of the softer surface is $H$, and the real contact area $A_r$ obeys the Bowden–Tabor plasticity relation $A_r = (p/H)\\,A_{\\text{app}}$.\n\nStarting from Fourier’s law of heat conduction and the definition of thermal resistance, and using the classical constriction/spreading resistance result for a circular isothermal contact on a semi-infinite solid, treat each microcontact as a series network of two spreading resistances (one in copper, one in aluminum). Then treat the ensemble of microcontacts as a parallel network across the interface. Derive a closed-form analytic expression for the effective area-specific thermal contact resistance $R''_t$ of the interface as a function of $p$, $H$, $n_s$, $k_1$, and $k_2$.\n\nExpress your final answer for $R''_t$ in $\\text{m}^2 \\cdot \\text{K}/\\text{W}$. No numerical evaluation is required; provide a single closed-form analytic expression.",
            "solution": "The problem requires the derivation of a closed-form analytic expression for the effective area-specific thermal contact resistance, $R''_t$, of an interface between two solids. The derivation will be built upon fundamental principles of heat transfer and a simplified model of mechanical contact between rough surfaces.\n\nThe analysis begins with Fourier's law of heat conduction and the definition of thermal resistance. The thermal resistance, $R_t$, is defined as the ratio of the temperature drop, $\\Delta T$, across an object or interface to the steady-state heat flow rate, $Q$, through it:\n$$R_t = \\frac{\\Delta T}{Q}$$\nThe area-specific thermal contact resistance, $R''_t$, is defined as the thermal resistance of the interface multiplied by the apparent contact area, $A_{\\text{app}}$:\n$$R''_t = R_t \\cdot A_{\\text{app}}$$\nThe units of $R''_t$ are $\\text{m}^2 \\cdot \\text{K}/\\text{W}$.\n\nThe model treats the interface as a collection of discrete microcontacts. Heat is assumed to flow only through these contact spots. Each microcontact presents a resistance to heat flow due to the constriction of heat flux lines from the bulk material into the small contact spot, and the subsequent spreading of these lines on the other side.\n\nFirst, we consider a single, isolated microcontact. It is modeled as a circular patch of radius $a$. The problem states to use the classical constriction/spreading resistance result for a circular isothermal contact on a semi-infinite solid. For a single such contact spot on a semi-infinite solid with thermal conductivity $k$, the thermal resistance is given by:\n$$R_c = \\frac{1}{4ka}$$\nThe problem specifies that each microcontact is a series network of two such resistances, one for the copper side (solid $1$, conductivity $k_1$) and one for the aluminum side (solid $2$, conductivity $k_2$). Therefore, the total thermal resistance of a single microcontact, $R_{mc}$, is the sum of the individual constriction resistances from each side:\n$$R_{mc} = R_{c1} + R_{c2} = \\frac{1}{4k_1 a} + \\frac{1}{4k_2 a}$$\nFactoring out the geometric term, we have:\n$$R_{mc} = \\frac{1}{4a} \\left( \\frac{1}{k_1} + \\frac{1}{k_2} \\right) = \\frac{1}{4a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\nNext, we consider the entire ensemble of microcontacts. The problem states that the microcontacts are uniformly distributed over the apparent area $A_{\\text{app}}$ with a number density $n_s$. The total number of microcontacts, $N$, is therefore $N = n_s A_{\\text{app}}$. These microcontacts are treated as a parallel network of thermal resistors. For $N$ identical resistors in parallel, the total resistance, $R_t$, is related to the resistance of a single element, $R_{mc}$, by:\n$$\\frac{1}{R_t} = \\sum_{i=1}^{N} \\frac{1}{R_{mc}} = \\frac{N}{R_{mc}}$$\nThus, the total thermal resistance of the interface is:\n$$R_t = \\frac{R_{mc}}{N} = \\frac{R_{mc}}{n_s A_{\\text{app}}}$$\nNow, we can find the area-specific thermal contact resistance, $R''_t$, using its definition:\n$$R''_t = R_t \\cdot A_{\\text{app}} = \\left( \\frac{R_{mc}}{n_s A_{\\text{app}}} \\right) A_{\\text{app}} = \\frac{R_{mc}}{n_s}$$\nSubstituting the expression for $R_{mc}$:\n$$R''_t = \\frac{1}{n_s} \\left[ \\frac{1}{4a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right) \\right] = \\frac{1}{4 n_s a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\nThis expression for $R''_t$ depends on the microcontact radius, $a$, which is not a given parameter. We must eliminate $a$ using the provided plasticity model. The Bowden–Tabor relation states that the real contact area, $A_r$, is proportional to the nominal contact pressure, $p$, and inversely proportional to the hardness of the softer material, $H$:\n$$A_r = \\frac{p}{H} A_{\\text{app}}$$\nThe real contact area is also the sum of the areas of all individual microcontacts. Since there are $N = n_s A_{\\text{app}}$ identical circular microcontacts of radius $a$, the total real contact area is:\n$$A_r = N \\cdot (\\pi a^2) = (n_s A_{\\text{app}})(\\pi a^2)$$\nEquating the two expressions for $A_r$:\n$$(n_s A_{\\text{app}})(\\pi a^2) = \\frac{p}{H} A_{\\text{app}}$$\nThe apparent area $A_{\\text{app}}$ cancels, yielding a relationship between the microscopic geometry ($a$, $n_s$) and the macroscopic properties ($p$, $H$):\n$$n_s \\pi a^2 = \\frac{p}{H}$$\nWe solve this for the microcontact radius $a$:\n$$a^2 = \\frac{p}{n_s \\pi H} \\implies a = \\sqrt{\\frac{p}{n_s \\pi H}}$$\nFinally, we substitute this expression for $a$ into our equation for $R''_t$:\n$$R''_t = \\frac{1}{4 n_s \\sqrt{\\frac{p}{n_s \\pi H}}} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\nThis expression can be simplified by manipulating the term containing the square root:\n$$ \\frac{1}{n_s \\sqrt{\\frac{p}{n_s \\pi H}}} = \\frac{1}{n_s \\frac{\\sqrt{p}}{\\sqrt{n_s \\pi H}}} = \\frac{\\sqrt{n_s \\pi H}}{n_s \\sqrt{p}} = \\frac{\\sqrt{\\pi H}}{\\sqrt{n_s} \\sqrt{p}} = \\sqrt{\\frac{\\pi H}{n_s p}} $$\nSubstituting this simplified term back into the expression for $R''_t$:\n$$R''_t = \\frac{1}{4} \\sqrt{\\frac{\\pi H}{n_s p}} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\nThis is the closed-form analytic expression for the area-specific thermal contact resistance as a function of the specified parameters $p$, $H$, $n_s$, $k_1$, and $k_2$.",
            "answer": "$$\\boxed{\\frac{\\sqrt{\\pi}}{4} \\sqrt{\\frac{H}{n_s p}} \\left(\\frac{k_1 + k_2}{k_1 k_2}\\right)}$$"
        },
        {
            "introduction": "While detailed numerical simulations are powerful, simplified analytical models are invaluable for initial design, optimization, and developing physical intuition. This exercise introduces the potent technique of scaling analysis to dissect a canonical conjugate heat transfer problem: forced convection over a heat-generating board. You will balance advection and diffusion to determine the growth of the thermal boundary layer and subsequently build a thermal resistance network to predict the local heat flux, providing a rapid method for assessing cooling performance .",
            "id": "3943427",
            "problem": "A printed circuit board used in an electronic module is modeled as a uniform solid slab of thickness $t$ and thermal conductivity $k_{s}$. Its back face at $y=-t$ is maintained at a uniform base temperature $T_{b}$ by a high-conductivity heat spreader. The front face at $y=0$ is exposed to a steady, two-dimensional, laminar, incompressible external flow of a coolant with free-stream temperature $T_{\\infty}$, free-stream speed $U$, thermal conductivity $k_{f}$, density $\\rho$, specific heat at constant pressure $c_{p}$, and thermal diffusivity $\\alpha = k_{f}/(\\rho c_{p})$. The flow is aligned with the $x$-axis, which measures distance from the leading edge of the board, and the $y$-axis is normal to the board. Viscous dissipation and axial conduction in the fluid are negligible. The thermal boundary layer is thin compared to the plate length, and the thermal Prandtl number is $\\mathcal{O}(1)$ or larger so that a boundary layer description is appropriate.\n\nStarting from conservation of energy in the fluid adjacent to the board and invoking appropriate laminar boundary-layer scalings, perform the following:\n\n1. By balancing the dominant terms in the steady advection-diffusion equation, obtain a scaling expression for the characteristic thermal boundary layer thickness $\\delta_{T}(x)$ in terms of $x$ and the local Péclet number (Péclet number, $\\mathrm{Pe}_{x}$, defined for this problem by $\\mathrm{Pe}_{x} = U x / \\alpha$).\n\n2. Using your result for $\\delta_{T}(x)$, construct a scaling for the local convective heat transfer coefficient $h_{x}(x)$ and, by modeling the conjugate heat transfer at the wall as two thermal resistances in series (normal conduction across the solid thickness $t$ and normal convection across the fluid thermal boundary layer), derive a closed-form analytic expression for the local wall heat flux $q''_{w}(x)$ as a function of $x$, $U$, $\\alpha$, $k_{f}$, $k_{s}$, $t$, $T_{b}$, and $T_{\\infty}$.\n\nClearly state all assumptions used in your derivation. Express the final $q''_{w}(x)$ in SI units of $\\mathrm{W\\,m^{-2}}$. No numerical evaluation is required, and no rounding is needed. Your final answer must be a single analytic expression.",
            "solution": "The solution is developed in two parts as requested by the problem statement.\n\n**Part 1: Scaling for Thermal Boundary Layer Thickness $\\delta_{T}(x)$**\n\nWe begin with the steady-state, two-dimensional energy equation for an incompressible fluid with constant properties, neglecting viscous dissipation:\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right)$$\nwhere $u$ and $v$ are the velocity components in the $x$ and $y$ directions, respectively, $T$ is the fluid temperature, and $\\alpha$ is the thermal diffusivity.\n\nThe problem states that a boundary layer description is appropriate. This implies that gradients normal to the wall are much larger than gradients parallel to the wall. Consequently, axial conduction $\\alpha \\frac{\\partial^2 T}{\\partial x^2}$ is negligible compared to normal conduction $\\alpha \\frac{\\partial^2 T}{\\partial y^2}$. The energy equation simplifies to the thermal boundary layer equation:\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\frac{\\partial^2 T}{\\partial y^2}$$\nWe perform a scaling analysis on this equation. Let $x$ be the characteristic length scale in the flow direction. The characteristic velocity in the $x$-direction is the free-stream speed $U$. The characteristic thickness of the thermal boundary layer is $\\delta_{T}(x)$. The characteristic temperature difference across the boundary layer is $\\Delta T = T_{w}(x) - T_{\\infty}$, where $T_{w}(x)$ is the local wall temperature at $y=0$.\n\nThe terms in the equation are scaled as follows:\n-   Partial derivatives: $\\frac{\\partial}{\\partial x} \\sim \\frac{1}{x}$, $\\frac{\\partial}{\\partial y} \\sim \\frac{1}{\\delta_{T}}$.\n-   Velocities: $u \\sim U$. From the continuity equation $\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 0$, we scale $v$ as $\\frac{U}{x} \\sim \\frac{v}{\\delta_{T}}$, which gives $v \\sim U \\frac{\\delta_{T}}{x}$.\n\nNow we scale the terms in the thermal boundary layer equation:\n-   Advection term (left-hand side): The two advection terms are of the same order of magnitude. For example, $u \\frac{\\partial T}{\\partial x} \\sim U \\frac{\\Delta T}{x}$.\n-   Diffusion term (right-hand side): $\\alpha \\frac{\\partial^2 T}{\\partial y^2} \\sim \\alpha \\frac{\\Delta T}{\\delta_{T}^2}$.\n\nIn a boundary layer, advection in the flow direction is balanced by diffusion normal to the wall. Equating the scales of these dominant terms:\n$$U \\frac{\\Delta T}{x} \\sim \\alpha \\frac{\\Delta T}{\\delta_{T}^2}$$\nSolving for the thermal boundary layer thickness $\\delta_{T}$:\n$$\\delta_{T}^2 \\sim \\frac{\\alpha x}{U}$$\n$$\\delta_{T}(x) \\sim \\sqrt{\\frac{\\alpha x}{U}}$$\nTo express this in terms of the local Péclet number, $\\mathrm{Pe}_{x} = Ux/\\alpha$, we manipulate the expression:\n$$\\delta_{T}(x) \\sim \\sqrt{\\frac{\\alpha x^2}{Ux}} = x \\sqrt{\\frac{\\alpha}{Ux}} = x \\left(\\frac{Ux}{\\alpha}\\right)^{-1/2}$$\nThis gives the required scaling relationship:\n$$\\delta_{T}(x) \\sim x \\, \\mathrm{Pe}_{x}^{-1/2}$$\n\n**Part 2: Scaling for $h_{x}(x)$ and Derivation of $q''_{w}(x)$**\n\nFirst, we construct a scaling for the local convective heat transfer coefficient, $h_{x}(x)$. By definition, the heat flux from the wall into the fluid is given by Fourier's law of conduction at the fluid-solid interface ($y=0$) and by Newton's law of cooling:\n$$q''_{w}(x) = -k_{f} \\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0} = h_{x}(x) (T_{w}(x) - T_{\\infty})$$\nFrom this, we can define $h_x(x)$. Using our scaling arguments, the gradient $\\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0}$ scales as $\\frac{\\Delta T}{\\delta_{T}} = \\frac{T_{w}(x) - T_{\\infty}}{\\delta_{T}(x)}$. Substituting this into the definition gives the scaling for $h_x(x)$:\n$$h_{x}(x) \\sim \\frac{k_{f} \\frac{T_{w}(x) - T_{\\infty}}{\\delta_{T}(x)}}{T_{w}(x) - T_{\\infty}} = \\frac{k_{f}}{\\delta_{T}(x)}$$\nThis is the constructed scaling for $h_x(x)$. To proceed, we adopt this scaling as an approximate equality, which is a common practice in such modeling exercises. Substituting our result for $\\delta_{T}(x)$:\n$$h_{x}(x) = \\frac{k_{f}}{\\sqrt{\\frac{\\alpha x}{U}}} = k_{f} \\sqrt{\\frac{U}{\\alpha x}}$$\nNext, we model the conjugate heat transfer process using a thermal resistance network. At any given position $x$, the total heat flux $q''_{w}(x)$ flows from the base at temperature $T_{b}$, conducts through the solid slab, and then convects into the fluid at temperature $T_{\\infty}$. This can be modeled as two thermal resistances in series per unit area:\n\n1.  **Conduction resistance of the solid slab:** $R''_{cond} = \\frac{\\text{thickness}}{\\text{conductivity}} = \\frac{t}{k_{s}}$.\n2.  **Convection resistance of the fluid boundary layer:** $R''_{conv}(x) = \\frac{1}{h_{x}(x)}$.\n\nThe total thermal resistance per unit area is the sum of the series resistances:\n$$R''_{tot}(x) = R''_{cond} + R''_{conv}(x) = \\frac{t}{k_{s}} + \\frac{1}{h_{x}(x)}$$\nThe local wall heat flux $q''_{w}(x)$ is driven by the overall temperature difference $T_{b} - T_{\\infty}$ across this total resistance:\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{R''_{tot}(x)} = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{h_{x}(x)}}$$\nFinally, we substitute the expression for $h_{x}(x)$ into this equation to obtain the closed-form expression for $q''_{w}(x)$:\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}\\sqrt{\\frac{U}{\\alpha x}}}}$$\nSimplifying the denominator gives the final result:\n$$q''_{w}(x) = \\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}}\\sqrt{\\frac{\\alpha x}{U}}}$$\nThis expression gives the local wall heat flux as a function of all the specified parameters: $x$, $U$, $\\alpha$, $k_{f}$, $k_{s}$, $t$, $T_{b}$, and $T_{\\infty}$. The units are $\\mathrm{K} / (\\mathrm{m}^2 \\cdot \\mathrm{K} / \\mathrm{W}) = \\mathrm{W}/\\mathrm{m}^2$, which is correct for heat flux.",
            "answer": "$$\\boxed{\\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}} \\sqrt{\\frac{\\alpha x}{U}}}}$$"
        },
        {
            "introduction": "A fundamental check on any computational fluid dynamics or heat transfer simulation is to verify that it upholds the basic laws of physics, chief among them the conservation of energy. This practice is essential for any computational engineer, guiding you first through the formal derivation of the integral energy balance for a complete conjugate domain from first principles. You will then translate this theoretical balance into a practical, quantitative diagnostic tool to assess the accuracy and integrity of a numerical CHT solver, learning how to identify and measure discretization and coupling errors .",
            "id": "3943444",
            "problem": "A conjugate heat transfer problem consists of a solid region and a fluid region that exchange heat across internal interfaces while the fluid may also exchange energy with the exterior through mass inflow and outflow. Starting from the conservation of energy for a continuum and applying the Reynolds Transport Theorem to the total internal energy of the combined solid and fluid domain, derive the integral energy balance over the entire conjugate domain. The derivation must begin from first principles: conservation of energy and the divergence theorem, and it must explicitly justify the disappearance of internal solid–fluid interface terms in the global balance. Provide the steady and transient forms and clearly define the sign conventions for all boundary exchanges.\n\nThen, implement the derived integral energy balance as a quantitative diagnostic to assess discretization and coupling errors. The diagnostic is defined as a global residual that compares the time rate of change of total internal energy to the net energy exchange through external boundaries and volumetric sources. Your program must compute, for each test case listed below, the dimensionless normalized residual\n$$\n\\mathcal{R} = \\frac{\\left| R \\right|}{\\left| \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right| + \\sum \\left| \\text{each individual external contribution on the right-hand side} \\right|},\n$$\nwhere $R$ is the signed residual given by\n$$\nR = \\left( \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right) - \\left( \\text{net energy into the domain from boundaries and sources} \\right).\n$$\nIn discrete form over control volumes $i$ with volume $V_i$, density $\\rho_i$, specific heat $c_{p,i}$, previous temperature $T_i^{n}$, current temperature $T_i^{n+1}$, and time step $\\Delta t$, the left-hand side is\n$$\n\\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i \\left( T_i^{n+1} - T_i^{n} \\right).\n$$\nThe right-hand-side contributions must include:\n- Prescribed heat flux boundaries: sum of $q_n A$ over patches, with $q_n$ taken positive into the domain.\n- Convective boundaries: sum of $h A ( T_{\\infty} - T_{\\text{surf}} )$ over patches, with $h$ the heat transfer coefficient, $T_{\\infty}$ the ambient temperature, and $T_{\\text{surf}}$ the surface temperature.\n- Volumetric sources: sum of $\\dot{q}_i V_i$ over volumes.\n- Advective energy at mass-flow boundaries in the fluid: sum of $-\\dot{m} c_{p,f} T_{\\text{bulk}}$ over inlets and outlets, with $\\dot{m}$ defined positive when pointing outward with respect to the computational domain and $c_{p,f}$ the fluid specific heat.\n\nThe program must compute $\\mathcal{R}$ for each test case and output the results as decimal floats rounded to six decimal places. No physical units are required in the final output because the diagnostic is dimensionless. If the normalization denominator evaluates to zero, use a fallback value of $10^{-12}$ to avoid division by zero.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$). Implement the following test suite, which exercises steady and transient behavior, advection-dominated exchange, and degenerate cases:\n\n- Test Case $1$ (steady conjugate removal by advection, happy path with small mismatch):\n  - Time step $\\Delta t = 1.0$.\n  - Solid control volumes: three cells with $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ equal to $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$, $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$, and $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 0.0)$, respectively.\n  - Fluid control volumes: three cells with $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ equal to $(1000.0, 4180.0, 5.0\\times10^{-6}, 300.0, 300.0, 0.0)$ in all three cells.\n  - Prescribed heat flux boundaries: none.\n  - Convective boundaries: none.\n  - Mass-flow boundaries: one inlet with $\\dot{m} = -0.02$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$; one outlet with $\\dot{m} = +0.02$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.5$.\n\n- Test Case $2$ (transient heat-up in a solid with known source and small boundary flux, interior consistency check):\n  - Time step $\\Delta t = 1.0$.\n  - Solid control volumes: two cells with $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ equal to $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 6.5\\times10^{4})$ and $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 0.0)$, respectively.\n  - Fluid control volumes: none.\n  - Prescribed heat flux boundaries: one patch with $q_n A = 0.05$.\n  - Convective boundaries: none.\n  - Mass-flow boundaries: none.\n\n- Test Case $3$ (steady fluid-only with balanced in/out energy, boundary condition consistency, edge of cancellation):\n  - Time step $\\Delta t = 1.0$.\n  - Solid control volumes: none.\n  - Fluid control volumes: one cell with $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (1000.0, 4180.0, 1.0\\times10^{-5}, 300.0, 300.0, 0.0)$.\n  - Prescribed heat flux boundaries: none.\n  - Convective boundaries: none.\n  - Mass-flow boundaries: one inlet with $\\dot{m} = -0.1$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$; one outlet with $\\dot{m} = +0.1$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$.\n\n- Test Case $4$ (degenerate steady case with no exchanges, checks denominator fallback):\n  - Time step $\\Delta t = 1.0$.\n  - Solid control volumes: one cell with $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (2000.0, 800.0, 1.0\\times10^{-6}, 300.0, 300.0, 0.0)$.\n  - Fluid control volumes: none.\n  - Prescribed heat flux boundaries: none.\n  - Convective boundaries: none.\n  - Mass-flow boundaries: none.\n\nYour program must implement the residual using the derived integral balance and output a single list $[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3,\\mathcal{R}_4]$ where $\\mathcal{R}_i$ is the normalized residual for Test Case $i$, rounded to six decimal places.",
            "solution": "The problem requires the derivation of the integral energy balance for a conjugate heat transfer domain and its subsequent implementation as a numerical diagnostic. The validation of the problem statement confirms that it is scientifically sound, well-posed, and contains all necessary information. We may therefore proceed with the solution.\n\nThe solution is presented in two parts: first, the theoretical derivation of the integral energy balance, and second, the numerical implementation of the diagnostic residual based on this balance.\n\n### Part 1: Derivation of the Integral Energy Balance\n\nThe derivation begins from the principle of conservation of energy for a continuum, applied to the entire conjugate domain $\\Omega$, which is composed of a solid region $\\Omega_s$ and a fluid region $\\Omega_f$, such that $\\Omega = \\Omega_s \\cup \\Omega_f$.\n\n**1. Differential Form of Energy Conservation**\n\nThe local, differential form of the first law of thermodynamics for a continuum can be expressed in terms of the specific internal energy, $e$:\n$$\n\\frac{\\partial (\\rho e)}{\\partial t} + \\nabla \\cdot (\\rho e \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol} + \\Phi_{diss}\n$$\nwhere $\\rho$ is the density, $\\mathbf{v}$ is the velocity vector, $\\mathbf{q}$ is the heat flux vector (e.g., from Fourier's law, $\\mathbf{q} = -k \\nabla T$), $\\dot{q}_{vol}$ is the volumetric heat source per unit volume, and $\\Phi_{diss}$ represents the viscous dissipation term, which is the rate of irreversible work done by viscous stresses. The problem statement's formulation of energy balance, focusing on heat transfer mechanisms, implicitly neglects viscous dissipation, so we shall set $\\Phi_{diss} = 0$.\n\nThe problem uses a formulation based on temperature $T$ and specific heat at constant pressure $c_p$. For solids and liquids (incompressible substances), the specific heats at constant volume and constant pressure are nearly identical, $c_v \\approx c_p = c$, and the change in internal energy is well-approximated by $de \\approx c dT$. The term $\\rho c_p T$ in the problem's definition represents the stored thermal energy density. Accordingly, we substitute $e$ with $c_p T$.\n\nThe energy equation becomes:\n$$\n\\frac{\\partial (\\rho c_p T)}{\\partial t} + \\nabla \\cdot (\\rho c_p T \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol}\n$$\nThis equation is valid at any point within either the solid or the fluid region. In the solid region $\\Omega_s$, the velocity $\\mathbf{v}$ is zero, so the advection term $\\nabla \\cdot (\\rho c_p T \\mathbf{v})$ vanishes.\n\n**2. Integral Form over the Conjugate Domain**\n\nTo obtain the global energy balance, we integrate the differential equation over the entire domain $\\Omega = \\Omega_s \\cup \\Omega_f$.\n$$\n\\int_{\\Omega} \\frac{\\partial (\\rho c_p T)}{\\partial t} dV + \\int_{\\Omega} \\nabla \\cdot (\\rho c_p T \\mathbf{v}) dV = -\\int_{\\Omega} \\nabla \\cdot \\mathbf{q} dV + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\nFor a fixed (Eulerian) control volume, the order of integration and time differentiation can be swapped for the first term. We then apply the Gauss Divergence Theorem, which states $\\int_V \\nabla \\cdot \\mathbf{F} dV = \\oint_{\\partial V} \\mathbf{F} \\cdot \\hat{n} dA$, to the divergence terms. This transforms volume integrals of divergences into surface integrals of fluxes over the boundary $\\partial\\Omega$ of the domain.\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV + \\oint_{\\partial \\Omega} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA = -\\oint_{\\partial \\Omega} \\mathbf{q} \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\nThis equation is the integral energy balance for an arbitrary control volume.\n\n**3. Justification for Cancellation of Internal Interface Terms**\n\nWe now apply this balance by considering the solid and fluid domains separately and then summing the results. The boundary of the solid domain, $\\partial\\Omega_s$, consists of its external boundary $\\partial\\Omega_{s,ext}$ and the internal solid-fluid interface $\\Gamma_{sf}$. Similarly, $\\partial\\Omega_f = \\partial\\Omega_{f,ext} \\cup \\Gamma_{sf}$.\n\nFor the solid domain $\\Omega_s$ (where $\\mathbf{v}=0$):\n$$\n\\frac{d}{dt} \\int_{\\Omega_s} \\rho_s c_{p,s} T_s dV = -\\int_{\\partial\\Omega_{s,ext}} \\mathbf{q}_s \\cdot \\hat{n}_s dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_s \\cdot \\hat{n}_s dA + \\int_{\\Omega_s} \\dot{q}_{vol,s} dV\n$$\nFor the fluid domain $\\Omega_f$:\n$$\n\\frac{d}{dt} \\int_{\\Omega_f} \\rho_f c_{p,f} T_f dV = -\\int_{\\partial\\Omega_{f,ext}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\partial\\Omega_{f,ext}} \\mathbf{q}_f \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_f \\cdot \\hat{n}_f dA + \\int_{\\Omega_f} \\dot{q}_{vol,f} dV\n$$\nSumming these two equations gives the balance for the total domain $\\Omega$. The volume integrals combine directly. The key is to analyze the sum of the surface integrals over the internal interface $\\Gamma_{sf}$. The normal vectors are defined pointing outwards from their respective domains, so at any point on the interface, $\\hat{n}_s = -\\hat{n}_f$.\n\nThe sum of interface terms is:\n$$\nI_{\\Gamma_{sf}} = - \\int_{\\Gamma_{sf}} \\left[ \\mathbf{q}_s \\cdot \\hat{n}_s + \\mathbf{q}_f \\cdot \\hat{n}_f + (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f \\right] dA\n$$\nThese terms cancel for the following physical reasons:\n-   **Advective Flux:** At the solid-fluid interface, the no-slip condition for viscous fluids dictates that the fluid velocity $\\mathbf{v}_f$ is zero. Therefore, the advective energy flux term at the interface is zero: $(\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f = 0$.\n-   **Conductive Flux:** The interface $\\Gamma_{sf}$ is assumed to be of zero thickness and thus has no capacity to store or generate energy. Conservation of energy requires that the heat flux leaving the solid surface must equal the heat flux entering the fluid surface. This is expressed as the continuity of the normal component of the heat flux vector across the interface. In terms of fluxes relative to the domain normals: $(\\mathbf{q}_s \\cdot \\hat{n}_s) + (\\mathbf{q}_f \\cdot \\hat{n}_f) = 0$. This is because the flux leaving the solid at the interface is identical to the flux entering the fluid.\n\nConsequently, all terms in the integrand of $I_{\\Gamma_{sf}}$ are zero, and the integral over the internal interface vanishes, $I_{\\Gamma_{sf}}=0$. This explicitly justifies the disappearance of internal interface terms in the global balance.\n\n**4. Final Integral Energy Balance**\n\nAfter summing the solid and fluid equations and eliminating the interface terms, the global integral energy balance for the conjugate domain $\\Omega$ is:\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\nwhere $\\partial\\Omega_{ext} = \\partial\\Omega_{s,ext} \\cup \\partial\\Omega_{f,ext}$ is the total external boundary of the conjugate domain, and the advection term is non-zero only on the fluid portion of this boundary, $\\partial\\Omega_{f,ext}$.\n\nThis equation can be expressed as:\n(Rate of change of stored energy) = (Net heat flow IN by conduction/convection) + (Net energy flow IN by advection) + (Total volumetric heat generation)\n\n-   **Transient and Steady Forms:** The equation above is the **transient form**. The **steady form** is obtained by setting the time-derivative term to zero, which implies that the net energy entering the domain from all sources and boundaries must sum to zero:\n$$\n0 = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n\n**5. Sign Conventions and Boundary Term Definitions**\n\nThe terms on the right-hand side represent the net energy flow *into* the domain. The sign conventions are:\n-   **Volumetric Sources ($\\sum \\dot{q}_i V_i$):** $\\dot{q}_i$ is positive for heat generation, contributing positively to the energy balance.\n-   **Prescribed Heat Flux ($\\sum q_n A$):** The term $-\\mathbf{q} \\cdot \\hat{n}$ is the heat flux entering the domain. The problem defines $q_n$ as the flux positive *into* the domain, so $q_n = -\\mathbf{q} \\cdot \\hat{n}$. The total energy input is $\\int q_n dA$, approximated as $\\sum q_n A$.\n-   **Convective Boundaries ($\\sum h A (T_\\infty - T_{\\text{surf}})$):** The flux into the domain is given by Newton's law of cooling, $h(T_\\infty - T_{\\text{surf}})$. This is positive when the ambient temperature $T_\\infty$ is greater than the surface temperature $T_{\\text{surf}}$, consistent with energy entering the domain.\n-   **Advective Energy ($\\sum - \\dot{m} c_{p,f} T_{\\text{bulk}}$):** The net advected power into the domain is $-\\oint (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA$. The mass flow rate $\\dot{m}$ is defined as positive for outflow, $\\dot{m} = \\int \\rho (\\mathbf{v} \\cdot \\hat{n}) dA$. Assuming uniform properties over an inlet/outlet patch, the advective energy transport is $\\dot{m} c_p T_{bulk}$. The term corresponding to the integral is $-\\sum \\dot{m} c_{p,f} T_{\\text{bulk}}$. For an inlet, $\\dot{m} < 0$, so the term is positive (energy enters). For an outlet, $\\dot{m} > 0$, and the term is negative (energy leaves). This is consistent.\n\n### Part 2: Numerical Implementation\n\nThe derived integral balance forms the basis for the diagnostic residual $R$. The residual checks if the numerically computed change in stored energy is balanced by the computed net energy exchange with the surroundings.\n$$\nR = \\left( \\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV \\right) - \\left( \\text{Net Energy Inflow} \\right)\n$$\nUsing the discrete forms provided:\n-   Left-Hand Side (LHS): $E_{stored\\_rate} = \\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i (T_i^{n+1} - T_i^n)$\n-   Right-Hand Side (RHS): $E_{inflow} = \\sum (\\dot{q}_i V_i) + \\sum (q_n A) + \\sum (h A (T_\\infty-T_{surf})) + \\sum (-\\dot{m} c_p T_{bulk})$\n\nThe signed residual is $R = E_{stored\\_rate} - E_{inflow}$. The normalized residual $\\mathcal{R}$ is computed as specified, using the sum of the absolute values of all individual contributions for the normalization denominator to ensure robustness against cancellation of terms.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residual(case):\n    \"\"\"\n    Calculates the normalized energy residual for a given test case.\n    \n    The residual R is defined as:\n    R = (rate of change of stored energy) - (net energy rate into the domain)\n    \n    The normalized residual is |R| / Denominator, where the denominator is the\n    sum of absolute values of all individual energy rate terms.\n    \"\"\"\n    \n    # Unpack case data\n    delta_t = case['delta_t']\n    solid_vols = case.get('solid_vols', [])\n    fluid_vols = case.get('fluid_vols', [])\n    flux_boundaries = case.get('flux_boundaries', [])\n    conv_boundaries = case.get('conv_boundaries', [])\n    mass_flow_boundaries = case.get('mass_flow_boundaries', [])\n\n    all_vols = solid_vols + fluid_vols\n    \n    # 1. Calculate the rate of change of stored energy (LHS)\n    transient_terms = []\n    for vol in all_vols:\n        rho, cp, V, T_n, T_np1, _ = vol\n        term = rho * cp * V * (T_np1 - T_n)\n        transient_terms.append(term)\n    \n    lhs = sum(transient_terms) / delta_t\n\n    # 2. Calculate the net energy rate into the domain (RHS)\n    # and collect absolute values of individual terms for normalization.\n    \n    denominator_terms = [abs(lhs)]\n    \n    # Volumetric sources\n    source_terms = []\n    for vol in all_vols:\n        _, _, V, _, _, q_dot = vol\n        term = q_dot * V\n        source_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_sources_total = sum(source_terms)\n\n    # Prescribed heat flux boundaries\n    flux_terms = []\n    for patch in flux_boundaries:\n        term = patch['qn_A']\n        flux_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_flux_total = sum(flux_terms)\n    \n    # Convective boundaries\n    conv_terms = []\n    for patch in conv_boundaries:\n        term = patch['h'] * patch['A'] * (patch['T_inf'] - patch['T_surf'])\n        conv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_conv_total = sum(conv_terms)\n\n    # Advective energy at mass-flow boundaries\n    adv_terms = []\n    for patch in mass_flow_boundaries:\n        term = -1.0 * patch['m_dot'] * patch['cp_f'] * patch['T_bulk']\n        adv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_adv_total = sum(adv_terms)\n    \n    rhs = q_sources_total + q_flux_total + q_conv_total + q_adv_total\n    \n    # 3. Calculate the signed residual\n    residual = lhs - rhs\n    \n    # 4. Calculate normalization denominator\n    denominator = sum(denominator_terms)\n    \n    if np.isclose(denominator, 0.0):\n        denominator = 1.0e-12\n\n    # 5. Calculate the dimensionless normalized residual\n    norm_residual = abs(residual) / denominator\n    \n    return norm_residual\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes the normalized residual for each,\n    and prints the results in the required format.\n    \"\"\"\n    \n    # Format for cell data: (rho, cp, V, T_n, T_np1, q_dot)\n    \n    test_cases = [\n        # Test Case 1: steady conjugate removal by advection\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 0.0),\n            ],\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.02, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.02, 'cp_f': 4180.0, 'T_bulk': 300.5},\n            ]\n        },\n        # Test Case 2: transient heat-up in a solid\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 6.5e4),\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 0.0),\n            ],\n            \"flux_boundaries\": [\n                {'qn_A': 0.05}\n            ]\n        },\n        # Test Case 3: steady fluid-only with balanced in/out energy\n        {\n            \"delta_t\": 1.0,\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 1.0e-5, 300.0, 300.0, 0.0)\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n            ]\n        },\n        # Test Case 4: degenerate steady case with no exchanges\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2000.0, 800.0, 1.0e-6, 300.0, 300.0, 0.0)\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        r = calculate_residual(case)\n        results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}