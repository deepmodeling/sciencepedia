{
    "hands_on_practices": [
        {
            "introduction": "在共轭传热（CHT）仿真中，精确求解流固界面处的薄热边界层是关键挑战之一，它通常需要极高的网格密度。本实践将引导你使用标度分析（scaling analysis）这一强大的理论工具，从基本的能量守恒方程出发，推导出热边界层厚度的特征尺度。掌握此方法可以帮助你估算局部传热系数，并构建一个简化的热阻网络模型，从而在无需进行复杂数值计算的情况下，快速评估关键参数对系统整体换热性能的影响。",
            "id": "3943427",
            "problem": "用于电子模块的印刷电路板被建模为厚度为 $t$、热导率为 $k_s$ 的均匀固态平板。其位于 $y=-t$ 的背面通过一个高热导率的均热板维持在均匀的基底温度 $T_b$。其位于 $y=0$ 的正面暴露于一种冷却剂的稳态、二维、层流、不可压缩的外部流动中，该冷却剂的自由来流温度为 $T_{\\infty}$、自由来流速度为 $U$、热导率为 $k_f$、密度为 $\\rho$、定压比热为 $c_p$，热扩散率为 $\\alpha = k_f/(\\rho c_p)$。流动方向与 $x$ 轴对齐，$x$ 轴测量从板前缘开始的距离，$y$ 轴垂直于板。流体中的粘性耗散和轴向热传导可忽略不计。热边界层与板长相比很薄，且热普朗特数是 $\\mathcal{O}(1)$ 或更大，因此边界层描述是适用的。\n\n从邻近板的流体的能量守恒出发，并采用适当的层流边界层标度分析，完成以下任务：\n\n1. 通过平衡稳态对流-扩散方程中的主导项，获得特征热边界层厚度 $\\delta_T(x)$ 关于 $x$ 和局部Péclet数（Péclet数，$\\mathrm{Pe}_x$，在本问题中定义为 $\\mathrm{Pe}_x = U x / \\alpha$）的标度表达式。\n\n2. 使用您得到的 $\\delta_T(x)$ 结果，为局部对流换热系数 $h_x(x)$ 构建一个标度关系，并通过将壁面上的共轭传热建模为两个串联的热阻（穿过固体厚度 $t$ 的法向热传导和穿过流体热边界层的法向对流），推导局部壁面热通量 $q''_w(x)$ 作为 $x$、$U$、$\\alpha$、$k_f$、$k_s$、$t$、$T_b$ 和 $T_{\\infty}$ 的函数的闭式解析表达式。\n\n清楚地说明您推导过程中使用的所有假设。以 $\\mathrm{W\\,m^{-2}}$ 的国际单位制（SI）单位表示最终的 $q''_w(x)$。不需要进行数值计算，也不需要四舍五入。您的最终答案必须是一个单一的解析表达式。",
            "solution": "在进行求解之前，对问题陈述进行了严格验证。\n\n### 第1步：提取已知条件\n-   **固态平板（PCB）：** 厚度 $t$，热导率 $k_s$。\n-   **背面边界条件：** 在 $y=-t$ 处，温度均匀为 $T_b$。\n-   **正面边界条件：** 在 $y=0$ 处，平板暴露于外部冷却剂流中。\n-   **冷却剂性质：** 自由来流温度 $T_{\\infty}$，自由来流速度 $U$，热导率 $k_f$，密度 $\\rho$，定压比热 $c_p$。\n-   **流体热扩散率：** 定义为 $\\alpha = k_f/(\\rho c_p)$。\n-   **流动特性：** 稳态、二维、层流、不可压缩。流动沿 $x$ 轴方向，从 $x=0$ 处的前缘开始。$y$ 轴垂直于板。\n-   **假设与约束：** 粘性耗散可忽略。流体中的轴向热传导可忽略。热边界层很薄。热普朗特数约为1或更大 ($\\mathcal{O}(1)$)。\n-   **Péclet数定义：** $\\mathrm{Pe}_x = U x / \\alpha$。\n-   **任务1：** 获得热边界层厚度 $\\delta_T(x)$ 关于 $x$ 和 $\\mathrm{Pe}_x$ 的标度表达式。\n-   **任务2：** 为局部对流换热系数 $h_x(x)$ 构建一个标度关系，并使用串联热阻模型推导局部壁面热通量 $q''_w(x)$ 的闭式表达式。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学依据：** 该问题基于流体动力学和传热学的基本原理，特别是能量守恒、边界层理论和热阻概念。这些是热工学中标准且成熟的概念。所描述的情景是一个经典的共轭传热问题。\n-   **适定性：** 该问题以符号形式提供了所有必要的物理参数和边界条件。各项假设（层流、可忽略的粘性耗散和轴向热传导）适当地简化了控制方程，使得问题可以按要求通过标度分析求解。任务定义清晰，并在指定模型的框架内导向一个唯一的解析表达式。\n-   **客观性：** 该问题以精确的技术语言陈述，没有任何主观性或歧义。\n-   **完整性与一致性：** 问题是自洽的。所有变量都已定义，没有内部矛盾。例如，所述的薄热边界层假设与边界层方程的使用是一致的。\n-   **真实性与可行性：** 冷却印刷电路板的物理设置是一个常见且现实的工程应用。参数是符号化的，避免了任何物理上不一致的数值问题。\n-   **结构与复杂性：** 该问题结构良好，从边界层的标度分析逐步构建到更复杂的共轭传热模型。它并非微不足道，因为它需要应用和综合几个核心概念。\n\n### 第3步：结论与行动\n该问题被认为是**有效**的，因为它在科学上是合理的、适定的且内部一致的。将推导完整的解决方案。\n\n### 解题推导\n\n解答过程按问题陈述的要求分为两部分。\n\n**第1部分：热边界层厚度 $\\delta_T(x)$ 的标度分析**\n\n我们从物性恒定的不可压缩流体的稳态、二维能量方程开始，忽略粘性耗散：\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\left( \\frac{\\partial^2 T}{\\partial x^2} + \\frac{\\partial^2 T}{\\partial y^2} \\right)$$\n其中 $u$ 和 $v$ 分别是 $x$ 和 $y$ 方向的速度分量，$T$ 是流体温度，$\\alpha$ 是热扩散率。\n\n问题陈述指出边界层描述是适用的。这意味着垂直于壁面的梯度远大于平行于壁面的梯度。因此，轴向热传导 $\\alpha \\frac{\\partial^2 T}{\\partial x^2}$ 与法向热传导 $\\alpha \\frac{\\partial^2 T}{\\partial y^2}$ 相比可忽略不计。能量方程简化为热边界层方程：\n$$u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} = \\alpha \\frac{\\partial^2 T}{\\partial y^2}$$\n我们对该方程进行标度分析。设 $x$ 是流动方向的特征长度尺度。$x$ 方向的特征速度是自由来流速度 $U$。热边界层的特征厚度是 $\\delta_T(x)$。跨越边界层的特征温差是 $\\Delta T = T_w(x) - T_{\\infty}$，其中 $T_w(x)$ 是 $y=0$ 处的局部壁面温度。\n\n方程中的各项按如下方式进行标度分析：\n-   偏导数：$\\frac{\\partial}{\\partial x} \\sim \\frac{1}{x}$，$\\frac{\\partial}{\\partial y} \\sim \\frac{1}{\\delta_T}$。\n-   速度：$u \\sim U$。根据连续性方程 $\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = 0$，我们将 $v$ 标度为 $\\frac{U}{x} \\sim \\frac{v}{\\delta_T}$，得到 $v \\sim U \\frac{\\delta_T}{x}$。\n\n现在我们对热边界层方程中的各项进行标度分析：\n-   对流项（左侧）：两个对流项的数量级相同。例如，$u \\frac{\\partial T}{\\partial x} \\sim U \\frac{\\Delta T}{x}$。\n-   扩散项（右侧）：$\\alpha \\frac{\\partial^2 T}{\\partial y^2} \\sim \\alpha \\frac{\\Delta T}{\\delta_T^2}$。\n\n在边界层中，流动方向的对流与垂直于壁面的扩散相平衡。令这些主导项的标度相等：\n$$U \\frac{\\Delta T}{x} \\sim \\alpha \\frac{\\Delta T}{\\delta_T^2}$$\n求解热边界层厚度 $\\delta_T$：\n$$\\delta_T^2 \\sim \\frac{\\alpha x}{U}$$\n$$\\delta_T(x) \\sim \\sqrt{\\frac{\\alpha x}{U}}$$\n为了用局部Péclet数 $\\mathrm{Pe}_x = Ux/\\alpha$ 来表示，我们对表达式进行变换：\n$$\\delta_T(x) \\sim \\sqrt{\\frac{\\alpha x^2}{Ux}} = x \\sqrt{\\frac{\\alpha}{Ux}} = x \\left(\\frac{Ux}{\\alpha}\\right)^{-1/2}$$\n这就得到了所需的标度关系：\n$$\\delta_T(x) \\sim x \\, \\mathrm{Pe}_x^{-1/2}$$\n\n**第2部分：$h_x(x)$ 的标度分析与 $q''_w(x)$ 的推导**\n\n首先，我们为局部对流换热系数 $h_x(x)$ 构建一个标度关系。根据定义，从壁面进入流体的热通量由流固界面（$y=0$）处的傅里叶热传导定律和牛顿冷却定律给出：\n$$q''_w(x) = -k_f \\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0} = h_x(x) (T_w(x) - T_{\\infty})$$\n由此，我们可以定义 $h_x(x)$。使用我们的标度分析论证，梯度 $\\left. \\frac{\\partial T}{\\partial y} \\right|_{y=0}$ 的标度为 $\\frac{\\Delta T}{\\delta_T} = \\frac{T_w(x) - T_{\\infty}}{\\delta_T(x)}$。将此代入定义中，得到 $h_x(x)$ 的标度关系：\n$$h_x(x) \\sim \\frac{k_f \\frac{T_w(x) - T_{\\infty}}{\\delta_T(x)}}{T_w(x) - T_{\\infty}} = \\frac{k_f}{\\delta_T(x)}$$\n这就是为 $h_x(x)$ 构建的标度关系。为继续推导，我们将此标度关系视为一个近似等式，这在此类建模练习中是常见做法。代入我们关于 $\\delta_T(x)$ 的结果：\n$$h_x(x) = \\frac{k_f}{\\sqrt{\\frac{\\alpha x}{U}}} = k_f \\sqrt{\\frac{U}{\\alpha x}}$$\n接下来，我们使用热阻网络对共轭传热过程进行建模。在任意给定位置 $x$，总热通量 $q''_w(x)$ 从温度为 $T_b$ 的基底流出，通过固态平板传导，然后对流进入温度为 $T_{\\infty}$ 的流体中。这可以建模为两个单位面积上的串联热阻：\n\n1.  **固态平板的导热热阻：** $R''_{cond} = \\frac{\\text{thickness}}{\\text{conductivity}} = \\frac{t}{k_s}$。\n2.  **流体边界层的对流换热热阻：** $R''_{conv}(x) = \\frac{1}{h_x(x)}$。\n\n单位面积总热阻是串联热阻之和：\n$$R''_{tot}(x) = R''_{cond} + R''_{conv}(x) = \\frac{t}{k_s} + \\frac{1}{h_x(x)}$$\n局部壁面热通量 $q''_w(x)$ 由作用在该总热阻上的总温差 $T_b - T_{\\infty}$ 驱动：\n$$q''_w(x) = \\frac{T_b - T_{\\infty}}{R''_{tot}(x)} = \\frac{T_b - T_{\\infty}}{\\frac{t}{k_s} + \\frac{1}{h_x(x)}}$$\n最后，我们将 $h_x(x)$ 的表达式代入此方程，以获得 $q''_w(x)$ 的闭式表达式：\n$$q''_w(x) = \\frac{T_b - T_{\\infty}}{\\frac{t}{k_s} + \\frac{1}{k_f\\sqrt{\\frac{U}{\\alpha x}}}}$$\n化简分母得到最终结果：\n$$q''_w(x) = \\frac{T_b - T_{\\infty}}{\\frac{t}{k_s} + \\frac{1}{k_f}\\sqrt{\\frac{\\alpha x}{U}}}$$\n此表达式给出了局部壁面热通量作为所有指定参数 $x$、$U$、$\\alpha$、$k_f$、$k_s$、$t$、$T_b$ 和 $T_{\\infty}$ 的函数。单位是 $(K) / (m^2 \\cdot K / W) = W/m^2$，对于热通量来说是正确的。",
            "answer": "$$\\boxed{\\frac{T_{b} - T_{\\infty}}{\\frac{t}{k_{s}} + \\frac{1}{k_{f}} \\sqrt{\\frac{\\alpha x}{U}}}}$$"
        },
        {
            "introduction": "从流固界面转向固固界面，我们将探讨另一个在电子散热中至关重要的现象：热接触热阻。在实际工程中，两个看似平整的固体表面在接触时，真正的接触只发生在微观的凸起上，这极大地阻碍了热量传递。本练习将指导你建立一个从微观物理到宏观效应的模型。 你将从接触点塑性变形的力学假设和热流收缩的基本原理出发，推导出有效接触热阻的解析表达式，从而深刻理解接触压力、材料硬度等参数如何影响界面传热。",
            "id": "3943447",
            "problem": "一个带有铜基座的电子模块被夹在一个铝制散热器上。名义上平坦的界面是由两个粗糙表面在均匀的名义接触压力 $p$ 下压合而成的。界面导热仅通过均匀分布在表观面积 $A_{\\text{app}}$ 上的一群塑性变形的微凸体接触点发生。铜和铝分别被建模为导热系数为 $k_1$ 和 $k_2$ 的半无限大固体。假设微接触点是相同的、圆形的、不相互作用的斑块，半径为 $a$；它们单位表观面积上的数量密度为 $n_s$。较软表面的硬度为 $H$，真实接触面积 $A_r$ 遵循 Bowden–Tabor 塑性关系 $A_r = (p/H)\\,A_{\\text{app}}$。\n\n从傅里叶导热定律和热阻的定义出发，并使用半无限大固体上圆形等温接触的经典收缩/扩散热阻结果，将每个微接触点视为由两个扩散热阻（一个在铜中，一个在铝中）组成的串联网络。然后将微接触点集合视为跨界面的并联网络。推导界面有效单位面积热接触电阻 $R''_t$ 作为 $p$, $H$, $n_s$, $k_1$, 和 $k_2$ 的函数的闭式解析表达式。\n\n将 $R''_t$ 的最终答案以 $\\text{m}^2 \\cdot \\text{K}/\\text{W}$ 为单位表示。不需要进行数值计算；提供一个单一的闭式解析表达式。",
            "solution": "该问题要求推导两固体之间界面的有效单位面积热接触电阻 $R''_t$ 的闭式解析表达式。推导将基于传热学的基本原理以及粗糙表面之间机械接触的简化模型。\n\n分析从傅里叶导热定律和热阻的定义开始。热阻 $R_t$ 定义为物体或界面上的温降 $\\Delta T$ 与通过它的稳态热流率 $Q$ 之比：\n$$R_t = \\frac{\\Delta T}{Q}$$\n单位面积热接触电阻 $R''_t$ 定义为界面热阻乘以表观接触面积 $A_{\\text{app}}$：\n$$R''_t = R_t \\cdot A_{\\text{app}}$$\n$R''_t$ 的单位是 $\\text{m}^2 \\cdot \\text{K}/\\text{W}$。\n\n该模型将界面视为离散微接触点的集合。假设热量只通过这些接触点流动。由于热通量线从块体材料收缩进入小的接触点，以及随后在另一侧的扩散，每个微接触点都表现出对热流的阻力。\n\n首先，我们考虑一个单一、孤立的微接触点。它被建模为一个半径为 $a$ 的圆形斑块。问题要求使用半无限大固体上圆形等温接触的经典收缩/扩散热阻结果。对于导热系数为 $k$ 的半无限大固体上的单个此类接触点，其热阻由下式给出：\n$$R_c = \\frac{1}{4ka}$$\n问题指明，每个微接触点是由两个这样的热阻组成的串联网络，一个用于铜侧（固体1，导热系数 $k_1$），一个用于铝侧（固体2，导热系数 $k_2$）。因此，单个微接触点的总热阻 $R_{mc}$ 是来自每一侧的单个收缩热阻之和：\n$$R_{mc} = R_{c1} + R_{c2} = \\frac{1}{4k_1 a} + \\frac{1}{4k_2 a}$$\n提出几何项，我们得到：\n$$R_{mc} = \\frac{1}{4a} \\left( \\frac{1}{k_1} + \\frac{1}{k_2} \\right) = \\frac{1}{4a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\n接下来，我们考虑整个微接触点集合。问题陈述，微接触点以数量密度 $n_s$ 均匀分布在表观面积 $A_{\\text{app}}$ 上。因此，微接触点的总数 $N$ 为 $N = n_s A_{\\text{app}}$。这些微接触点被视为热阻的并联网络。对于 $N$ 个并联的相同电阻，总电阻 $R_t$ 与单个元件的电阻 $R_{mc}$ 的关系为：\n$$\\frac{1}{R_t} = \\sum_{i=1}^{N} \\frac{1}{R_{mc}} = \\frac{N}{R_{mc}}$$\n因此，界面的总热阻为：\n$$R_t = \\frac{R_{mc}}{N} = \\frac{R_{mc}}{n_s A_{\\text{app}}}$$\n现在，我们可以根据其定义求出单位面积热接触电阻 $R''_t$：\n$$R''_t = R_t \\cdot A_{\\text{app}} = \\left( \\frac{R_{mc}}{n_s A_{\\text{app}}} \\right) A_{\\text{app}} = \\frac{R_{mc}}{n_s}$$\n代入 $R_{mc}$ 的表达式：\n$$R''_t = \\frac{1}{n_s} \\left[ \\frac{1}{4a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right) \\right] = \\frac{1}{4 n_s a} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\n这个 $R''_t$ 的表达式依赖于微接触点半径 $a$，而 $a$ 不是一个给定的参数。我们必须使用所提供的塑性模型来消去 $a$。Bowden–Tabor 关系指出，真实接触面积 $A_r$ 与名义接触压力 $p$ 成正比，与较软材料的硬度 $H$ 成反比：\n$$A_r = \\frac{p}{H} A_{\\text{app}}$$\n真实接触面积也是所有单个微接触点面积的总和。由于有 $N = n_s A_{\\text{app}}$ 个半径为 $a$ 的相同圆形微接触点，总真实接触面积为：\n$$A_r = N \\cdot (\\pi a^2) = (n_s A_{\\text{app}})(\\pi a^2)$$\n令两个 $A_r$ 的表达式相等：\n$$(n_s A_{\\text{app}})(\\pi a^2) = \\frac{p}{H} A_{\\text{app}}$$\n表观面积 $A_{\\text{app}}$ 被消去，得到了微观几何参数（$a$, $n_s$）与宏观性质（$p$, $H$）之间的关系：\n$$n_s \\pi a^2 = \\frac{p}{H}$$\n我们由此解出微接触点半径 $a$：\n$$a^2 = \\frac{p}{n_s \\pi H} \\implies a = \\sqrt{\\frac{p}{n_s \\pi H}}$$\n最后，我们将这个 $a$ 的表达式代入我们的 $R''_t$ 方程中：\n$$R''_t = \\frac{1}{4 n_s \\sqrt{\\frac{p}{n_s \\pi H}}} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\n可以通过处理包含平方根的项来简化该表达式：\n$$ \\frac{1}{n_s \\sqrt{\\frac{p}{n_s \\pi H}}} = \\frac{1}{n_s \\frac{\\sqrt{p}}{\\sqrt{n_s \\pi H}}} = \\frac{\\sqrt{n_s \\pi H}}{n_s \\sqrt{p}} = \\frac{\\sqrt{\\pi H}}{\\sqrt{n_s} \\sqrt{p}} = \\sqrt{\\frac{\\pi H}{n_s p}} $$\n将这个简化后的项代回 $R''_t$ 的表达式中：\n$$R''_t = \\frac{1}{4} \\sqrt{\\frac{\\pi H}{n_s p}} \\left( \\frac{k_1 + k_2}{k_1 k_2} \\right)$$\n这就是单位面积热接触电阻作为指定参数 $p$, $H$, $n_s$, $k_1$, 和 $k_2$ 的函数的闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{\\sqrt{\\pi}}{4} \\sqrt{\\frac{H}{n_s p}} \\left(\\frac{k_1 + k_2}{k_1 k_2}\\right)}$$"
        },
        {
            "introduction": "在掌握了分析性建模方法后，我们将注意力转向计算实践的核心：保证数值解的可靠性。任何复杂的CHT仿真都可能存在离散误差或耦合误差，而验证其是否遵循基本的物理守恒定律是确保结果可信的第一步。本实践将引导你从第一性原理（雷诺输运定理）出发，为整个共轭域推导积分形式的能量守恒方程。 更重要的是，你将把这个理论结果转化为一个实用的计算诊断工具，通过编写代码来量化模拟中的全局能量不平衡，这是计算流体力学工程师必备的一项关键技能。",
            "id": "3943444",
            "problem": "一个共轭传热问题包含一个固体区域和一个流体区域，它们通过内部界面交换热量，同时流体也可能通过质量流入和流出与外部交换能量。从连续介质的能量守恒出发，并对固液组合域的总内能应用雷诺输运定理，推导出整个共轭域上的积分能量平衡方程。推导必须从第一性原理开始：能量守恒和散度定理，并且必须明确论证在全局平衡中内部固-液界面项消失的原因。请提供稳态和瞬态形式，并清楚地定义所有边界交换的符号约定。\n\n然后，实施推导出的积分能量平衡，作为评估离散化和耦合误差的量化诊断工具。该诊断工具被定义为一个全局残差，它比较总内能的时间变化率与通过外部边界和体积源的净能量交换。您的程序必须为下面列出的每个测试用例计算无量纲归一化残差\n$$\n\\mathcal{R} = \\frac{\\left| R \\right|}{\\left| \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right| + \\sum \\left| \\text{右手侧每个单独的外部贡献项} \\right|},\n$$\n其中 $R$ 是有符号的残差，由下式给出\n$$\nR = \\left( \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{\\Omega} \\rho c_p T \\, \\mathrm{d}\\Omega \\right) - \\left( \\text{从边界和源进入域的净能量} \\right).\n$$\n对于具有体积 $V_i$、密度 $\\rho_i$、比热容 $c_{p,i}$、前一时刻温度 $T_i^{n}$、当前时刻温度 $T_i^{n+1}$ 和时间步长 $\\Delta t$ 的控制体 $i$，其离散形式的左手侧为\n$$\n\\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i \\left( T_i^{n+1} - T_i^{n} \\right).\n$$\n右手侧的贡献项必须包括：\n- 指定热通量边界：所有片面上的 $q_n A$ 之和，其中 $q_n$ 定义为流入域为正。\n- 对流边界：所有片面上的 $h A \\left( T_{\\infty} - T_{\\text{surf}} \\right)$ 之和，其中 $h$ 是传热系数，$T_{\\infty}$ 是环境温度，$T_{\\text{surf}}$ 是表面温度。\n- 体积源：所有体积上的 $\\dot{q}_i V_i$ 之和。\n- 流体中质量流边界处的平流能量：所有入口和出口上的 $- \\dot{m} c_{p,f} T_{\\text{bulk}}$ 之和，其中 $\\dot{m}$ 定义为相对于计算域向外为正，$c_{p,f}$ 是流体比热容。\n\n程序必须为每个测试用例计算 $\\mathcal{R}$，并以十进制浮点数形式输出结果，四舍五入到六位小数。最终输出中不需要物理单位，因为该诊断工具是无量纲的。如果归一化分母计算结果为零，则使用备用值 $10^{-12}$ 以避免除以零。\n\n您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来的结果（例如，$[r_1,r_2,r_3]$）。请实现以下测试套件，该套件涵盖稳态和瞬态行为、平流主导的交换以及退化情况：\n\n- 测试用例 $1$（通过平流的稳态共轭散热，具有小不匹配的理想情况）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体：三个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 分别等于 $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$、$(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 2.0\\times10^{6})$ 和 $(2700.0, 900.0, 1.0\\times10^{-5}, 320.0, 320.0, 0.0)$。\n  - 流体控制体：三个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 在所有三个单元中均等于 $(1000.0, 4180.0, 5.0\\times10^{-6}, 300.0, 300.0, 0.0)$。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：一个入口，$\\dot{m} = -0.02$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$；一个出口，$\\dot{m} = +0.02$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.5$。\n\n- 测试用例 $2$（具有已知源和微小边界通量的固体瞬态升温，内部一致性检查）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体：两个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q})$ 分别等于 $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 6.5\\times10^{4})$ 和 $(8900.0, 385.0, 2.0\\times10^{-5}, 300.0, 300.1, 0.0)$。\n  - 流体控制体：无。\n  - 指定热通量边界：一个片面，其 $q_n A = 0.05$。\n  - 对流边界：无。\n  - 质量流边界：无。\n\n- 测试用例 $3$（能量输入/输出平衡的纯流体稳态，边界条件一致性，接近抵消的边缘情况）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体：无。\n  - 流体控制体：一个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (1000.0, 4180.0, 1.0\\times10^{-5}, 300.0, 300.0, 0.0)$。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：一个入口，$\\dot{m} = -0.1$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$；一个出口，$\\dot{m} = +0.1$, $c_{p,f} = 4180.0$, $T_{\\text{bulk}} = 300.0$。\n\n- 测试用例 $4$（无交换的退化稳态情况，检查分母备用值）：\n  - 时间步长 $\\Delta t = 1.0$。\n  - 固体控制体：一个单元，其 $(\\rho, c_p, V, T^{n}, T^{n+1}, \\dot{q}) = (2000.0, 800.0, 1.0\\times10^{-6}, 300.0, 300.0, 0.0)$。\n  - 流体控制体：无。\n  - 指定热通量边界：无。\n  - 对流边界：无。\n  - 质量流边界：无。\n\n您的程序必须使用推导出的积分平衡来实现残差，并输出一个列表 $[\\mathcal{R}_1,\\mathcal{R}_2,\\mathcal{R}_3,\\mathcal{R}_4]$，其中 $\\mathcal{R}_i$ 是测试用例 $i$ 的归一化残差，四舍五入到六位小数。",
            "solution": "该问题要求推导共轭传热域的积分能量平衡方程，并随后将其实现为一个数值诊断工具。问题陈述的验证证实其在科学上是合理的、适定的，并包含了所有必要的信息。因此，我们可以着手解决。\n\n### 第1部分：积分能量平衡的推导\n\n推导从连续介质的能量守恒原理开始，应用于整个共轭域 $\\Omega$，该域由一个固体区域 $\\Omega_s$ 和一个流体区域 $\\Omega_f$ 组成，使得 $\\Omega = \\Omega_s \\cup \\Omega_f$。\n\n**1. 能量守恒的微分形式**\n\n对于连续介质，热力学第一定律的局部微分形式可以用比内能 $e$ 表示：\n$$\n\\frac{\\partial (\\rho e)}{\\partial t} + \\nabla \\cdot (\\rho e \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol} + \\Phi_{diss}\n$$\n其中 $\\rho$ 是密度，$\\mathbf{v}$ 是速度矢量，$\\mathbf{q}$ 是热通量矢量（例如，根据傅里叶定律，$\\mathbf{q} = -k \\nabla T$），$\\dot{q}_{vol}$ 是单位体积的体积热源，$\\Phi_{diss}$ 代表粘性耗散项，即粘性应力所做的不可逆功的速率。问题陈述中关于能量平衡的公式侧重于传热机制，隐含地忽略了粘性耗散，因此我们设 $\\Phi_{diss} = 0$。\n\n该问题使用基于温度 $T$ 和定压比热容 $c_p$ 的公式。对于固体和液体（不可压缩物质），定容比热容和定压比热容几乎相同，$c_v \\approx c_p = c$，内能的变化可以很好地近似为 $de \\approx c dT$。问题定义中的项 $\\rho c_p T$ 代表储存的热能密度。因此，我们将 $e$ 替换为 $c_p T$。\n\n能量方程变为：\n$$\n\\frac{\\partial (\\rho c_p T)}{\\partial t} + \\nabla \\cdot (\\rho c_p T \\mathbf{v}) = -\\nabla \\cdot \\mathbf{q} + \\dot{q}_{vol}\n$$\n该方程在固体或流体区域内的任何点都有效。在固体区域 $\\Omega_s$ 中，速度 $\\mathbf{v}$ 为零，因此平流项 $\\nabla \\cdot (\\rho c_p T \\mathbf{v})$ 消失。\n\n**2. 共轭域上的积分形式**\n\n为了获得全局能量平衡，我们在整个域 $\\Omega = \\Omega_s \\cup \\Omega_f$ 上对微分方程进行积分。\n$$\n\\int_{\\Omega} \\frac{\\partial (\\rho c_p T)}{\\partial t} dV + \\int_{\\Omega} \\nabla \\cdot (\\rho c_p T \\mathbf{v}) dV = -\\int_{\\Omega} \\nabla \\cdot \\mathbf{q} dV + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n对于一个固定的（欧拉）控制体，第一项的积分和时间微分的顺序可以互换。然后我们应用高斯散度定理，即 $\\int_V \\nabla \\cdot \\mathbf{F} dV = \\oint_{\\partial V} \\mathbf{F} \\cdot \\hat{n} dA$，于散度项。这将散度的体积分转换为域边界 $\\partial\\Omega$ 上通量的面积分。\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV + \\oint_{\\partial \\Omega} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA = -\\oint_{\\partial \\Omega} \\mathbf{q} \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n该方程是任意控制体的积分能量平衡。\n\n**3. 内部界面项抵消的论证**\n\n我们现在通过分别考虑固体和流体域，然后将结果相加来应用此平衡。固体域的边界 $\\partial\\Omega_s$ 由其外部边界 $\\partial\\Omega_{s,ext}$ 和内部固-液界面 $\\Gamma_{sf}$ 组成。类似地，$\\partial\\Omega_f = \\partial\\Omega_{f,ext} \\cup \\Gamma_{sf}$。\n\n对于固体域 $\\Omega_s$（其中 $\\mathbf{v}=0$）：\n$$\n\\frac{d}{dt} \\int_{\\Omega_s} \\rho_s c_{p,s} T_s dV = -\\int_{\\partial\\Omega_{s,ext}} \\mathbf{q}_s \\cdot \\hat{n}_s dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_s \\cdot \\hat{n}_s dA + \\int_{\\Omega_s} \\dot{q}_{vol,s} dV\n$$\n对于流体域 $\\Omega_f$：\n$$\n\\frac{d}{dt} \\int_{\\Omega_f} \\rho_f c_{p,f} T_f dV = -\\int_{\\partial\\Omega_{f,ext}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f dA - \\int_{\\partial\\Omega_{f,ext}} \\mathbf{q}_f \\cdot \\hat{n}_f dA - \\int_{\\Gamma_{sf}} \\mathbf{q}_f \\cdot \\hat{n}_f dA + \\int_{\\Omega_f} \\dot{q}_{vol,f} dV\n$$\n将这两个方程相加，得到总域 $\\Omega$ 的平衡。体积分直接合并。关键是分析内部界面 $\\Gamma_{sf}$ 上面积分的和。法向量定义为从各自的域向外指，因此在界面上的任何一点，$\\hat{n}_s = -\\hat{n}_f$。\n\n界面项的和为：\n$$\nI_{\\Gamma_{sf}} = - \\int_{\\Gamma_{sf}} \\left[ \\mathbf{q}_s \\cdot \\hat{n}_s + \\mathbf{q}_f \\cdot \\hat{n}_f + (\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f \\right] dA\n$$\n由于以下物理原因，这些项相互抵消：\n-   **平流通量：** 在固-液界面，对于粘性流体，无滑移条件要求流体速度 $\\mathbf{v}_f$ 为零。因此，界面处的平流能量通量项为零：$(\\rho_f c_{p,f} T_f \\mathbf{v}_f) \\cdot \\hat{n}_f = 0$。\n-   **传导通量：** 界面 $\\Gamma_{sf}$ 被假定为零厚度，因此没有储存或产生能量的能力。能量守恒要求离开固体表面的热通量必须等于进入流体表面的热通量。这表示为热通量矢量法向分量在界面上的连续性。就相对于域法线的通量而言：$(\\mathbf{q}_s \\cdot \\hat{n}_s) + (\\mathbf{q}_f \\cdot \\hat{n}_f) = 0$。这是因为在界面处离开固体的通量与进入流体的通量相同。\n\n因此，$I_{\\Gamma_{sf}}$ 的被积函数中的所有项都为零，内部界面上的积分消失，即 $I_{\\Gamma_{sf}}=0$。这明确地论证了在全局平衡中内部界面项的消失。\n\n**4. 最终积分能量平衡**\n\n将固体和流体方程相加并消去界面项后，共轭域 $\\Omega$ 的全局积分能量平衡为：\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n其中 $\\partial\\Omega_{ext} = \\partial\\Omega_{s,ext} \\cup \\partial\\Omega_{f,ext}$ 是共轭域的总外部边界，平流项仅在该边界的流体部分 $\\partial\\Omega_{f,ext}$ 上非零。\n\n该方程可以表示为：\n(储存能量的变化率) = (通过传导/对流的净热流IN) + (通过平流的净能量流IN) + (总体积热生成)\n\n-   **瞬态和稳态形式：** 上述方程是**瞬态形式**。**稳态形式**是通过将时间导数项设为零得到的，这意味着从所有源和边界进入域的净能量总和必须为零：\n$$\n0 = -\\oint_{\\partial\\Omega_{ext}} \\mathbf{q} \\cdot \\hat{n} dA - \\oint_{\\partial\\Omega_{f,ext}} (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA + \\int_{\\Omega} \\dot{q}_{vol} dV\n$$\n\n**5. 符号约定和边界项定义**\n\n右手侧的各项代表*流入*域的净能量。符号约定如下：\n-   **体积源 ($\\sum \\dot{q}_i V_i$)：** 对于产热，$\\dot{q}_i$ 为正，对能量平衡有正贡献。\n-   **指定热通量 ($\\sum q_n A$)：** 项 $-\\mathbf{q} \\cdot \\hat{n}$ 是流入域的热通量。问题将 $q_n$ 定义为*流入*域为正，所以 $q_n = -\\mathbf{q} \\cdot \\hat{n}$。总能量输入为 $\\int q_n dA$，近似为 $\\sum q_n A$。\n-   **对流边界 ($\\sum h A (T_\\infty - T_{\\text{surf}})$)：** 流入域的通量由牛顿冷却定律给出，$h(T_\\infty - T_{\\text{surf}})$。当环境温度 $T_\\infty$ 高于表面温度 $T_{\\text{surf}}$ 时，此值为正，与能量进入域一致。\n-   **平流能量 ($\\sum - \\dot{m} c_{p,f} T_{\\text{bulk}}$)：** 流入域的净平流功率为 $-\\oint (\\rho c_p T \\mathbf{v}) \\cdot \\hat{n} dA$。质量流率 $\\dot{m}$ 定义为流出为正，$\\dot{m} = \\int \\rho (\\mathbf{v} \\cdot \\hat{n}) dA$。假设在入口/出口片面上属性均匀，则平流能量输运为 $\\dot{m} c_p T_{bulk}$。与积分对应的项是 $-\\sum \\dot{m} c_{p,f} T_{\\text{bulk}}$。对于入口，$\\dot{m}  0$，所以该项为正（能量进入）。对于出口，$\\dot{m} > 0$，该项为负（能量离开）。这是自洽的。\n\n### 第2部分：数值实现\n\n推导出的积分平衡构成了诊断残差 $R$ 的基础。残差检查数值计算的储存能量变化是否与计算出的与周围环境的净能量交换相平衡。\n$$\nR = \\left( \\frac{d}{dt} \\int_{\\Omega} \\rho c_p T dV \\right) - \\left( \\text{净能量流入} \\right)\n$$\n使用提供的离散形式：\n-   左手侧 (LHS): $E_{stored\\_rate} = \\frac{1}{\\Delta t} \\sum_i \\rho_i c_{p,i} V_i (T_i^{n+1} - T_i^n)$\n-   右手侧 (RHS): $E_{inflow} = \\sum (\\dot{q}_i V_i) + \\sum (q_n A) + \\sum (h A (T_\\infty-T_{surf})) + \\sum (-\\dot{m} c_p T_{bulk})$\n\n有符号残差为 $R = E_{stored\\_rate} - E_{inflow}$。归一化残差 $\\mathcal{R}$ 按规定计算，使用所有单个贡献项的绝对值之和作为归一化分母，以确保对项抵消的鲁棒性。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residual(case):\n    \"\"\"\n    Calculates the normalized energy residual for a given test case.\n    \n    The residual R is defined as:\n    R = (rate of change of stored energy) - (net energy rate into the domain)\n    \n    The normalized residual is |R| / Denominator, where the denominator is the\n    sum of absolute values of all individual energy rate terms.\n    \"\"\"\n    \n    # Unpack case data\n    delta_t = case['delta_t']\n    solid_vols = case.get('solid_vols', [])\n    fluid_vols = case.get('fluid_vols', [])\n    flux_boundaries = case.get('flux_boundaries', [])\n    conv_boundaries = case.get('conv_boundaries', [])\n    mass_flow_boundaries = case.get('mass_flow_boundaries', [])\n\n    all_vols = solid_vols + fluid_vols\n    \n    # 1. Calculate the rate of change of stored energy (LHS)\n    transient_terms = []\n    for vol in all_vols:\n        rho, cp, V, T_n, T_np1, _ = vol\n        term = rho * cp * V * (T_np1 - T_n)\n        transient_terms.append(term)\n    \n    lhs = sum(transient_terms) / delta_t\n\n    # 2. Calculate the net energy rate into the domain (RHS)\n    # and collect absolute values of individual terms for normalization.\n    \n    denominator_terms = [abs(lhs)]\n    \n    # Volumetric sources\n    source_terms = []\n    for vol in all_vols:\n        _, _, V, _, _, q_dot = vol\n        term = q_dot * V\n        source_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_sources_total = sum(source_terms)\n\n    # Prescribed heat flux boundaries\n    flux_terms = []\n    for patch in flux_boundaries:\n        term = patch['qn_A']\n        flux_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_flux_total = sum(flux_terms)\n    \n    # Convective boundaries\n    conv_terms = []\n    for patch in conv_boundaries:\n        term = patch['h'] * patch['A'] * (patch['T_inf'] - patch['T_surf'])\n        conv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_conv_total = sum(conv_terms)\n\n    # Advective energy at mass-flow boundaries\n    adv_terms = []\n    for patch in mass_flow_boundaries:\n        term = -1.0 * patch['m_dot'] * patch['cp_f'] * patch['T_bulk']\n        adv_terms.append(term)\n        denominator_terms.append(abs(term))\n    q_adv_total = sum(adv_terms)\n    \n    rhs = q_sources_total + q_flux_total + q_conv_total + q_adv_total\n    \n    # 3. Calculate the signed residual\n    residual = lhs - rhs\n    \n    # 4. Calculate normalization denominator\n    denominator = sum(denominator_terms)\n    \n    if np.isclose(denominator, 0.0):\n        denominator = 1.0e-12\n\n    # 5. Calculate the dimensionless normalized residual\n    norm_residual = abs(residual) / denominator\n    \n    return norm_residual\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes the normalized residual for each,\n    and prints the results in the required format.\n    \"\"\"\n    \n    # Format for cell data: (rho, cp, V, T_n, T_np1, q_dot)\n    \n    test_cases = [\n        # Test Case 1: steady conjugate removal by advection\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 2.0e6),\n                (2700.0, 900.0, 1.0e-5, 320.0, 320.0, 0.0),\n            ],\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n                (1000.0, 4180.0, 5.0e-6, 300.0, 300.0, 0.0),\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.02, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.02, 'cp_f': 4180.0, 'T_bulk': 300.5},\n            ]\n        },\n        # Test Case 2: transient heat-up in a solid\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 6.5e4),\n                (8900.0, 385.0, 2.0e-5, 300.0, 300.1, 0.0),\n            ],\n            \"flux_boundaries\": [\n                {'qn_A': 0.05}\n            ]\n        },\n        # Test Case 3: steady fluid-only with balanced in/out energy\n        {\n            \"delta_t\": 1.0,\n            \"fluid_vols\": [\n                (1000.0, 4180.0, 1.0e-5, 300.0, 300.0, 0.0)\n            ],\n            \"mass_flow_boundaries\": [\n                {'m_dot': -0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n                {'m_dot': +0.1, 'cp_f': 4180.0, 'T_bulk': 300.0},\n            ]\n        },\n        # Test Case 4: degenerate steady case with no exchanges\n        {\n            \"delta_t\": 1.0,\n            \"solid_vols\": [\n                (2000.0, 800.0, 1.0e-6, 300.0, 300.0, 0.0)\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        r = calculate_residual(case)\n        results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}