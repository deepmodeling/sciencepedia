{
    "hands_on_practices": [
        {
            "introduction": "To appreciate why Total Variation Diminishing (TVD) schemes are essential, we must first understand the limitations of simpler methods. This practice  provides a foundational comparison between the robust first-order upwind scheme and the formally more accurate second-order Lax-Wendroff scheme. By applying both to a sharp step in temperature and analytically calculating the change in total variation after one time step, you will directly observe how higher-order accuracy can introduce spurious oscillations, a crucial insight that underpins the entire field of high-resolution schemes.",
            "id": "3998778",
            "problem": "Consider one-dimensional inviscid thermal convection of a passive temperature field governed by the linear advection equation $T_{t} + a\\,T_{x} = 0$ with constant velocity $a  0$. A uniform grid with spacing $\\Delta x$ and time step $\\Delta t$ is used to advance cell averages $\\{T_{i}^{n}\\}$ at time level $n$ to time level $n+1$. Define the Courant–Friedrichs–Lewy (CFL) number as $\\nu = a\\,\\Delta t / \\Delta x$. Let the initial data be a step (Heaviside) condition aligned to the grid: $T_{i}^{0} = 1$ for $i \\le 0$ and $T_{i}^{0} = 0$ for $i \\ge 1$ on a domain large enough that boundary conditions do not affect the first update. \n\nStarting from the governing equation and standard finite-volume consistency requirements, derive the one-step update near the discontinuity for two discretizations: the first-order upwind scheme for positive $a$, and the second-order Lax–Wendroff scheme. Using these updates, explicitly compute $T_{i}^{1}$ for the stencil indices $i \\in \\{-1, 0, 1, 2\\}$.\n\nDefine the discrete total variation as $\\mathrm{TV}(T^{n}) = \\sum_{i \\in \\mathbb{Z}} |T_{i+1}^{n} - T_{i}^{n}|$. Compute $\\mathrm{TV}(T^{0})$ and $\\mathrm{TV}(T^{1})$ for each scheme, and report the change in total variation $\\Delta \\mathrm{TV} = \\mathrm{TV}(T^{1}) - \\mathrm{TV}(T^{0})$ for upwind and for Lax–Wendroff as a closed-form analytic expression in terms of $\\nu$, assuming $0  \\nu  1$. Express the final answer as a row matrix containing the two $\\Delta \\mathrm{TV}$ values. No rounding is required. The final quantities are dimensionless; report them without units.",
            "solution": "The problem requires the analysis of two finite-volume schemes, first-order upwind and second-order Lax-Wendroff, for the one-dimensional linear advection equation $T_{t} + a\\,T_{x} = 0$ with $a  0$. We must compute the change in total variation, $\\Delta \\mathrm{TV}$, after one time step for a specific initial condition.\n\nFirst, we establish the general finite-volume framework. The governing equation is integrated over a control volume (cell) $C_i = [x_{i-1/2}, x_{i+1/2}]$ of width $\\Delta x$ and over a time interval $[t^n, t^{n+1}]$ of duration $\\Delta t$.\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\int_{t^n}^{t^{n+1}} (T_t + a\\,T_x) \\,dt\\,dx = 0 $$\nUsing the definitions of cell averages, $T_i^n = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} T(x, t^n) \\,dx$, and numerical fluxes at the cell interfaces, $F_{i \\pm 1/2}$, which approximate the time-averaged physical flux $a\\,T$, the equation is discretized as:\n$$ T_i^{n+1} = T_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2} - F_{i-1/2}) $$\nThe physical flux is $f(T) = aT$. The Courant–Friedrichs–Lewy (CFL) number is $\\nu = a\\,\\Delta t/\\Delta x$. The update formula can be written as:\n$$ T_i^{n+1} = T_i^n - \\frac{\\nu}{a} (F_{i+1/2} - F_{i-1/2}) $$\n\nThe initial condition is a Heaviside step function aligned with the grid: $T_{i}^{0} = 1$ for $i \\le 0$ and $T_{i}^{0} = 0$ for $i \\ge 1$. The discrete total variation at time level $n$ is defined as $\\mathrm{TV}(T^n) = \\sum_{i \\in \\mathbb{Z}} |T_{i+1}^n - T_i^n|$. For the initial condition, the only non-zero contribution to the sum occurs at the interface between cell $i=0$ and cell $i=1$:\n$$ \\mathrm{TV}(T^0) = |T_1^0 - T_0^0| = |0 - 1| = 1 $$\n\nWe now analyze each scheme for $0  \\nu  1$.\n\n**1. First-Order Upwind Scheme**\n\nFor $a  0$, the upwind scheme uses the value from the upwind cell (the left cell, $i$) to define the flux at the interface $x_{i+1/2}$. The numerical flux is $F_{i+1/2} = a T_i^n$.\nSubstituting this into the general finite-volume formula:\n$$ T_i^{n+1} = T_i^n - \\frac{\\Delta t}{\\Delta x} (a T_i^n - a T_{i-1}^n) = T_i^n - \\nu (T_i^n - T_{i-1}^n) $$\nWe apply this update rule to the initial condition $T^0$ to find $T^1$. We are interested in the stencil $i \\in \\{-1, 0, 1, 2\\}$.\nFor any $i \\le 0$, $T_i^0=1$ and $T_{i-1}^0=1$. Thus, $T_i^1 = 1 - \\nu(1-1) = 1$. In particular, $T_{-1}^1=1$ and $T_0^1=1$.\nFor $i = 1$, $T_1^0=0$ and $T_0^0=1$. Thus, $T_1^1 = 0 - \\nu(0-1) = \\nu$.\nFor $i = 2$, $T_2^0=0$ and $T_1^0=0$. Thus, $T_2^1 = 0 - \\nu(0-0) = 0$.\nFor any $i \\ge 2$, $T_i^0=0$ and $T_{i-1}^0=0$, which gives $T_i^1=0$.\n\nThe updated state is $T_i^1 = 1$ for $i \\le 0$, $T_1^1 = \\nu$, and $T_i^1 = 0$ for $i \\ge 2$.\nNow, we compute the total variation of this new state, $\\mathrm{TV}(T^1)$:\n$$ \\mathrm{TV}(T^1)_{\\text{upwind}} = \\sum_{i \\in \\mathbb{Z}} |T_{i+1}^1 - T_i^1| $$\nThe non-zero terms in the sum are at $i=0$ and $i=1$:\n$$ \\mathrm{TV}(T^1)_{\\text{upwind}} = |T_1^1 - T_0^1| + |T_2^1 - T_1^1| = |\\nu - 1| + |0 - \\nu| $$\nSince $0  \\nu  1$, we have $|\\nu - 1| = 1 - \\nu$ and $|-\\nu| = \\nu$.\n$$ \\mathrm{TV}(T^1)_{\\text{upwind}} = (1 - \\nu) + \\nu = 1 $$\nThe change in total variation is:\n$$ \\Delta \\mathrm{TV}_{\\text{upwind}} = \\mathrm{TV}(T^1)_{\\text{upwind}} - \\mathrm{TV}(T^0) = 1 - 1 = 0 $$\n\n**2. Second-Order Lax-Wendroff Scheme**\n\nThe Lax-Wendroff scheme can be derived from a second-order Taylor series expansion in time, leading to the update formula:\n$$ T_i^{n+1} = T_i^n - \\frac{\\nu}{2}(T_{i+1}^n - T_{i-1}^n) + \\frac{\\nu^2}{2}(T_{i+1}^n - 2T_i^n + T_{i-1}^n) $$\nWe apply this rule to the initial condition $T^0$ to find $T^1$ for the stencil $i \\in \\{-1, 0, 1, 2\\}$.\nFor any $i \\le -1$, $T_{i-1}^0 = T_i^0 = T_{i+1}^0 = 1$. The update gives $T_i^1 = 1 - \\frac{\\nu}{2}(1-1) + \\frac{\\nu^2}{2}(1-2(1)+1) = 1$. Thus, $T_{-1}^1=1$.\nFor $i=0$, we have $T_{-1}^0=1$, $T_{0}^0=1$, $T_{1}^0=0$.\n$$ T_0^1 = T_0^0 - \\frac{\\nu}{2}(T_1^0 - T_{-1}^0) + \\frac{\\nu^2}{2}(T_1^0 - 2T_0^0 + T_{-1}^0) = 1 - \\frac{\\nu}{2}(0-1) + \\frac{\\nu^2}{2}(0 - 2(1) + 1) = 1 + \\frac{\\nu}{2} - \\frac{\\nu^2}{2} $$\nFor $i=1$, we have $T_{0}^0=1$, $T_{1}^0=0$, $T_{2}^0=0$.\n$$ T_1^1 = T_1^0 - \\frac{\\nu}{2}(T_2^0 - T_0^0) + \\frac{\\nu^2}{2}(T_2^0 - 2T_1^0 + T_0^0) = 0 - \\frac{\\nu}{2}(0-1) + \\frac{\\nu^2}{2}(0 - 2(0) + 1) = \\frac{\\nu}{2} + \\frac{\\nu^2}{2} $$\nFor any $i \\ge 2$, we have $T_{i-1}^0 = T_i^0 = T_{i+1}^0 = 0$. The update gives $T_i^1 = 0 - \\frac{\\nu}{2}(0-0) + \\frac{\\nu^2}{2}(0-2(0)+0) = 0$. Thus, $T_2^1=0$.\n\nThe updated state near the discontinuity is $T_{-1}^1=1$, $T_0^1=1+\\frac{\\nu}{2}-\\frac{\\nu^2}{2}$, $T_1^1=\\frac{\\nu}{2}+\\frac{\\nu^2}{2}$, and $T_2^1=0$.\nWe compute the total variation $\\mathrm{TV}(T^1)_{\\text{LW}}$. The non-zero terms in the sum occur at $i=-1, 0, 1$:\n$$ \\mathrm{TV}(T^1)_{\\text{LW}} = |T_0^1 - T_{-1}^1| + |T_1^1 - T_0^1| + |T_2^1 - T_1^1| $$\nEach term is calculated as:\n$$ |T_0^1 - T_{-1}^1| = \\left|\\left(1+\\frac{\\nu}{2}-\\frac{\\nu^2}{2}\\right) - 1\\right| = \\left|\\frac{\\nu-\\nu^2}{2}\\right| = \\left|\\frac{\\nu(1-\\nu)}{2}\\right| = \\frac{\\nu(1-\\nu)}{2} \\quad (\\text{since } 0\\nu1) $$\n$$ |T_1^1 - T_0^1| = \\left|\\left(\\frac{\\nu}{2}+\\frac{\\nu^2}{2}\\right) - \\left(1+\\frac{\\nu}{2}-\\frac{\\nu^2}{2}\\right)\\right| = |\\nu^2-1| = 1-\\nu^2 \\quad (\\text{since } 0\\nu1) $$\n$$ |T_2^1 - T_1^1| = \\left|0 - \\left(\\frac{\\nu}{2}+\\frac{\\nu^2}{2}\\right)\\right| = \\left|\\frac{\\nu(1+\\nu)}{2}\\right| = \\frac{\\nu(1+\\nu)}{2} \\quad (\\text{since } 0\\nu1) $$\nSumming these terms gives the total variation:\n$$ \\mathrm{TV}(T^1)_{\\text{LW}} = \\frac{\\nu(1-\\nu)}{2} + (1-\\nu^2) + \\frac{\\nu(1+\\nu)}{2} = \\frac{\\nu-\\nu^2}{2} + 1-\\nu^2 + \\frac{\\nu+\\nu^2}{2} $$\n$$ \\mathrm{TV}(T^1)_{\\text{LW}} = \\frac{\\nu-\\nu^2+\\nu+\\nu^2}{2} + 1-\\nu^2 = \\frac{2\\nu}{2} + 1-\\nu^2 = 1+\\nu-\\nu^2 $$\nThe change in total variation is:\n$$ \\Delta \\mathrm{TV}_{\\text{LW}} = \\mathrm{TV}(T^1)_{\\text{LW}} - \\mathrm{TV}(T^0) = (1+\\nu-\\nu^2) - 1 = \\nu - \\nu^2 $$\nThe result $\\nu - \\nu^2 = \\nu(1-\\nu)  0$ for $0\\nu1$ shows that the Lax-Wendroff scheme is not total variation diminishing (TVD) and increases total variation by introducing oscillations near the discontinuity.\n\nThe final answer is composed of the two $\\Delta \\mathrm{TV}$ values for the upwind and Lax-Wendroff schemes, respectively.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\nu - \\nu^{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having established the problem of oscillations in high-order linear schemes, we now explore the solution. This exercise  focuses on the engine of a modern TVD scheme: the slope limiter. By examining how a limiter function, such as the `minmod` limiter, adjusts the reconstructed data slope based on the smoothness of the local solution, you will gain hands-on experience with the mechanism that allows these schemes to be both high-resolution and non-oscillatory.",
            "id": "3998743",
            "problem": "Consider one-dimensional pure convection of temperature in a uniform duct with constant axial speed, modeled by the conservation law $\\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0$ with $a0$. A second-order Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) finite-volume discretization reconstructs face values using a slope-limited linear profile to enforce the Total Variation Diminishing (TVD) property. For a uniform grid of spacing $\\Delta x$, define the upwind (left) discrete gradient in cell $i$ as $s_i^{\\text{un}} = \\frac{T_i - T_{i-1}}{\\Delta x}$ and the ratio of successive gradients (for $a0$) as $r_i = \\frac{T_i - T_{i-1}}{T_{i+1} - T_i}$. The limited slope is modeled by $s_i^{\\text{lim}} = \\phi_{\\text{mm}}(r_i)\\, s_i^{\\text{un}}$, where the minmod flux limiter function is defined by $\\phi_{\\text{mm}}(r) = \\max\\!\\big(0, \\min(1, r)\\big)$.\n\nStarting from the convection equation and the requirement that the reconstruction be TVD, explain why a flux-limited slope of the form $s_i^{\\text{lim}} = \\phi(r_i)\\, s_i^{\\text{un}}$ with $\\phi(r)$ constrained to $0 \\le \\phi(r) \\le \\min(2, 2r)$ is consistent with monotonicity for $a0$, and justify the use of the minmod flux limiter $\\phi_{\\text{mm}}(r)$ to suppress spurious oscillations while preserving second-order accuracy in smooth regions. Then, for a particular cell $i$, suppose the unlimited upwind slope is $s_i^{\\text{un}} = 9.87$ K/m and that three hypothetical local ratio values are $r_i = 0.2$, $r_i = 1$, and $r_i = 5$. Compute the corresponding limited slopes $s_i^{\\text{lim}}$ for these three cases.\n\nExpress the final slopes in Kelvin per meter, and round your answers to four significant figures. Provide your final result as a row of three values corresponding to $r_i = 0.2$, $1$, and $5$, respectively.",
            "solution": "The analysis proceeds in two parts: first, the theoretical justification of the TVD condition and the minmod limiter, and second, the numerical calculation of the limited slopes.\n\n**Part 1: Theoretical Justification**\n\nThe governing partial differential equation is the one-dimensional linear convection equation for temperature $T$:\n$$ \\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0, \\quad a  0 $$\nIn computational fluid dynamics, high-order numerical schemes for hyperbolic conservation laws like this one can introduce non-physical oscillations near sharp gradients (discontinuities or shocks). Total Variation Diminishing (TVD) schemes are designed to prevent this by ensuring that the total variation of the discrete solution does not increase in time. The total variation is defined as $TV(T) = \\sum_i |T_{i+1} - T_i|$. A scheme for which $TV(T^{n+1}) \\le TV(T^n)$ is TVD. This property guarantees that no new local extrema are created, thus suppressing spurious oscillations.\n\n**Consistency with Monotonicity:**\nA key development in this area was the formulation of flux limiters. For a second-order Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) scheme, a linear profile is reconstructed within each cell $i$. The slope of this profile, $s_i$, is limited to preserve monotonicity. The limited slope, $s_i^{\\text{lim}}$, is expressed as a function of an unlimited slope, $s_i^{\\text{un}}$, and a limiter function $\\phi(r_i)$:\n$$ s_i^{\\text{lim}} = \\phi(r_i) s_i^{\\text{un}} $$\nHere, $s_i^{\\text{un}} = \\frac{T_i - T_{i-1}}{\\Delta x}$ is the unlimited upwind gradient for $a0$, and $r_i = \\frac{T_i - T_{i-1}}{T_{i+1} - T_i}$ is the ratio of the upwind gradient to the downwind gradient at cell $i$.\n\nThe works of Harten, Sweby, and others showed that for a scheme constructed in this manner to be TVD, the limiter function $\\phi(r)$ must lie within a specific region on a $\\phi-r$ diagram (the \"Sweby diagram\"). For a second-order scheme to be TVD, the limiter function must satisfy the following conditions for $r0$:\n$$ 0 \\le \\phi(r) \\le 2 $$\n$$ 0 \\le \\phi(r) \\le 2r $$\nFor $r \\le 0$, which occurs at local extrema, the limiter must be $\\phi(r) = 0$ to prevent the extremum from growing. Combining these conditions gives the well-known TVD region for second-order accurate schemes:\n$$ \\phi(r) = 0 \\quad \\text{for } r \\le 0 $$\n$$ 0 \\le \\phi(r) \\le \\min(2, 2r) \\quad \\text{for } r  0 $$\nThe problem statement's condition $0 \\le \\phi(r) \\le \\min(2, 2r)$ is precisely this requirement for $r0$. This set of constraints ensures that the numerical flux computations do not lead to an increase in total variation, thereby maintaining monotonicity and preventing the formation of new oscillations. The constraint $\\phi(r) \\le 2r$ ensures the reconstructed value at the interface does not overshoot the adjacent downwind cell-average value, while the constraint $\\phi(r) \\le 2$ is a related bound required for the scheme to be TVD under a Courant-Friedrichs-Lewy (CFL) condition.\n\n**Justification of the Minmod Limiter:**\nThe minmod limiter is defined in the problem as $\\phi_{\\text{mm}}(r) = \\max(0, \\min(1, r))$. We justify its use by examining its properties.\n\n1.  **Suppression of Spurious Oscillations:** To suppress oscillations, the limiter must produce a TVD scheme. We verify if $\\phi_{\\text{mm}}(r)$ lies within the TVD region defined above.\n    *   For $r \\le 0$, $\\phi_{\\text{mm}}(r) = \\max(0, r) = 0$. This satisfies the TVD requirement.\n    *   For $0  r \\le 1$, $\\phi_{\\text{mm}}(r) = \\max(0, r) = r$. We check against the bounds: $r \\le 2r$ is true for $r0$, and $r \\le 2$ is true for $r \\le 1$. The condition is satisfied.\n    *   For $r  1$, $\\phi_{\\text{mm}}(r) = \\max(0, 1) = 1$. We check against the bounds: $1 \\le 2r$ is true for $r1$ (since $2r2$), and $1 \\le 2$ is true. The condition is satisfied.\n    Since $\\phi_{\\text{mm}}(r)$ lies entirely within the TVD region for all $r$, any scheme using it is guaranteed to be TVD and will therefore suppress spurious oscillations.\n\n2.  **Preservation of Second-Order Accuracy:** A TVD scheme achieves second-order accuracy in smooth regions of the solution if the limiter function satisfies $\\phi(1) = 1$.\n    *   In smooth regions, the grid values vary gently, so the successive gradients are nearly equal: $T_i - T_{i-1} \\approx T_{i+1} - T_i$. This implies that the ratio $r_i \\approx 1$.\n    *   For the minmod limiter: $\\phi_{\\text{mm}}(1) = \\max(0, \\min(1, 1)) = 1$.\n    *   Since the condition $\\phi(1) = 1$ is met, when $r_i \\approx 1$, the limiter function gives $\\phi_{\\text{mm}}(r_i) \\approx 1$. This means the limited slope $s_i^{\\text{lim}} = \\phi_{\\text{mm}}(r_i) s_i^{\\text{un}}$ becomes very close to the unlimited slope, $s_i^{\\text{lim}} \\approx s_i^{\\text{un}}$. The scheme then reverts to a second-order accurate formulation in these smooth regions, minimizing numerical error. In regions of high gradients or discontinuities where $r_i$ is not close to $1$, the limiter \"activates\" to reduce the slope (e.g., if $r_i \\ll 1$, then $\\phi_{\\text{mm}}(r_i) \\approx r_i$), adding local dissipation to prevent oscillations at the cost of reducing the local order of accuracy to first order. This adaptive nature is the primary strength of the MUSCL-TVD approach.\n\n**Part 2: Numerical Calculation**\n\nWe are given the unlimited upwind slope $s_i^{\\text{un}} = 9.87 \\, \\text{K/m}$. The limited slope is calculated using the formula $s_i^{\\text{lim}} = \\phi_{\\text{mm}}(r_i) s_i^{\\text{un}}$, where $\\phi_{\\text{mm}}(r) = \\max(0, \\min(1, r))$. We calculate $s_i^{\\text{lim}}$ for three given values of the ratio $r_i$.\n\n**Case 1: $r_i = 0.2$**\nThe limiter value is:\n$$ \\phi_{\\text{mm}}(0.2) = \\max(0, \\min(1, 0.2)) = \\max(0, 0.2) = 0.2 $$\nThe limited slope is:\n$$ s_i^{\\text{lim}} = 0.2 \\times s_i^{\\text{un}} = 0.2 \\times 9.87 \\, \\text{K/m} = 1.974 \\, \\text{K/m} $$\nRounding to four significant figures, the value is $1.974$.\n\n**Case 2: $r_i = 1$**\nThis case corresponds to a region of constant gradient. The limiter value is:\n$$ \\phi_{\\text{mm}}(1) = \\max(0, \\min(1, 1)) = \\max(0, 1) = 1 $$\nThe limited slope is:\n$$ s_i^{\\text{lim}} = 1 \\times s_i^{\\text{un}} = 1 \\times 9.87 \\, \\text{K/m} = 9.87 \\, \\text{K/m} $$\nRounding to four significant figures, the value is $9.870$. This confirms that at $r_i=1$, the scheme does not limit the slope, preserving accuracy.\n\n**Case 3: $r_i = 5$**\nThis case corresponds to a region where the upwind gradient is much larger than the downwind gradient (e.g., approaching a peak from the left). The limiter value is:\n$$ \\phi_{\\text{mm}}(5) = \\max(0, \\min(1, 5)) = \\max(0, 1) = 1 $$\nThe limited slope is:\n$$ s_i^{\\text{lim}} = 1 \\times s_i^{\\text{un}} = 1 \\times 9.87 \\, \\text{K/m} = 9.87 \\, \\text{K/m} $$\nRounding to four significant figures, the value is $9.870$. According to the problem's strict definition, when the upwind slope is steeper than the downwind slope ($r_i1$), this particular formulation retains the full upwind slope.\n\nThe three calculated values for the limited slope, corresponding to $r_i = 0.2$, $1$, and $5$, are $1.974$, $9.870$, and $9.870$ K/m, respectively.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.974  9.870  9.870 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Theory comes to life through computation. This final practice  is a computational experiment that synthesizes the concepts from the previous exercises. By implementing and running both a first-order scheme and a high-resolution MUSCL scheme with various limiters on a classic advection problem, you will be able to visualize and quantify their long-term performance, gaining an intuitive understanding of numerical diffusion and the distinct behaviors of different slope limiters.",
            "id": "3998716",
            "problem": "Consider one-dimensional linear advection of a scalar field in a periodic domain. The fundamental base is the conservation law for linear convection, which states that the scalar field $u(x,t)$ satisfies $u_t + a u_x = 0$ for constant advection speed $a$. Assume a periodic domain of length $L$ with spatial coordinate $x \\in [0,L)$ and periodic boundary conditions. The initial condition is a square pulse with amplitude $A$ over an interval $[x_0, x_0 + w)$ and zero elsewhere. The advection speed is $a  0$. The goal is to quantitatively assess the Total Variation Diminishing (TVD) behavior of two numerical convection schemes applied to this problem: the first-order upwind scheme and a second-order Monotonic Upwind Scheme for Conservation Laws (MUSCL) with different slope limiters. You will compute the discrete total variation $TV$ over time and report the ratio of the final to initial total variation after one full domain-length of advection.\n\nDefinitions and requirements:\n- The discrete total variation of a grid function $u_i$ on a uniform mesh is $TV(u) = \\sum_{i=0}^{N-1} \\left| u_{i+1} - u_i \\right|$, where periodicity implies $u_N \\equiv u_0$. Total Variation Diminishing (TVD) refers to schemes for which $TV(u^{n+1}) \\leq TV(u^n)$ for all time steps $n$.\n- The time stepping must satisfy the Courant–Friedrichs–Lewy (CFL) condition for stability. The non-dimensional Courant number is $\\nu = \\dfrac{a \\Delta t}{\\Delta x}$.\n- Implement the first-order upwind scheme and a second-order MUSCL scheme with slope limiters chosen from minmod, van Leer, and superbee. For the second-order scheme, use a flux-limited high-resolution correction that is consistent with the TVD property for $\\nu \\in [0,1]$ and positive $a$.\n- The domain length is $L = 1$, the number of grid points is $N = 400$, the advection speed is $a = 1$, the initial square pulse amplitude is $A = 1$, the left edge of the pulse is $x_0 = 0.2$, and the pulse width is $w = 0.2$. The spatial grid is uniform with spacing $\\Delta x = L/N$. Periodic boundary conditions must be strictly enforced at every update.\n- Evolve the numerical solution until time $T = L/a$ (one full-domain advection period). Compute and report the ratio $R = TV(u(T))/TV(u(0))$ for each specified test case. No physical units are required beyond these dimensionless quantities.\n\nTest suite and required outputs:\n- Use the following test suite of scheme and Courant number combinations:\n    1. Upwind with $\\nu = 0.2$.\n    2. Upwind with $\\nu = 0.8$.\n    3. Upwind with $\\nu = 1.0$ (boundary case).\n    4. MUSCL with minmod limiter and $\\nu = 0.2$.\n    5. MUSCL with minmod limiter and $\\nu = 0.8$.\n    6. MUSCL with van Leer limiter and $\\nu = 0.8$.\n    7. MUSCL with superbee limiter and $\\nu = 0.8$.\n- For each test case, compute $R$ as a floating-point number. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4,r5,r6,r7]\").\n\nAdditional notes:\n- The acronyms must be interpreted correctly: Total Variation Diminishing (TVD), Monotonic Upwind Scheme for Conservation Laws (MUSCL), and Courant–Friedrichs–Lewy (CFL) condition.\n- The problem is purely mathematical and algorithmic. All computations must be performed in the specified numerical setting, with periodic boundary conditions, and results reported in the non-dimensional form stated above. Angles are not involved. Percentages must not be used; ensure $R$ is reported as a floating-point decimal.",
            "solution": "The problem requires a quantitative comparison of the Total Variation Diminishing (TVD) properties of several numerical schemes for the one-dimensional linear advection equation.\n\nThe governing partial differential equation is the linear advection equation for a scalar field $u(x,t)$ with a constant, positive advection speed $a$:\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nThis equation can be written in conservative form as $\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0$, where the flux function is $f(u) = au$. We will solve this equation on a periodic domain of length $L=1$ with a specified initial condition.\n\nThe standard numerical approach for conservation laws is the finite volume method. The domain is divided into $N$ cells of uniform width $\\Delta x = L/N$. The cell-averaged value of the solution in cell $i$ at time step $n$ is denoted by $u_i^n$. The integral form of the conservation law leads to the semi-discrete update formula:\n$$\n\\frac{d u_i}{d t} = -\\frac{1}{\\Delta x} \\left( f_{i+1/2} - f_{i-1/2} \\right)\n$$\nwhere $f_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. Using a simple forward Euler time discretization with time step $\\Delta t$, the fully discrete form is:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( f_{i+1/2}^n - f_{i-1/2}^n \\right)\n$$\nThe specific numerical scheme is determined by the definition of the numerical flux $f_{i+1/2}$.\n\nThe problem assesses the performance of schemes using the discrete total variation ($TV$), defined for a periodic grid function $u_i$ ($i = 0, \\dots, N-1$, with $u_N \\equiv u_0$) as:\n$$\nTV(u) = \\sum_{i=0}^{N-1} |u_{i+1} - u_i|\n$$\nA scheme is TVD if $TV(u^{n+1}) \\leq TV(u^n)$. The initial condition is a square pulse of amplitude $A=1$ on $[0.2, 0.4)$ within the domain $[0, 1)$. Discretized on a grid with $N=400$ points, this pulse has two discontinuities: a jump from $0$ to $1$, and a jump from $1$ to $0$. The initial total variation is therefore $TV(u(0)) = |1-0| + |0-1| = 2$. The objective is to compute the ratio $R = TV(u(T)) / TV(u(0))$ after one full advection period, $T = L/a = 1$.\n\n**First-Order Upwind Scheme**\n\nFor linear advection with speed $a  0$, information propagates from left to right. The first-order upwind scheme accounts for this by defining the flux at an interface using the state from the \"upwind\" cell, which is cell $i$ for interface $i+1/2$.\n$$\nf_{i+1/2} = a u_i^n\n$$\nSubstituting this into the finite volume update equation gives:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (a u_i^n - a u_{i-1}^n) = u_i^n - \\nu (u_i^n - u_{i-1}^n)\n$$\nwhere $\\nu = a \\Delta t / \\Delta x$ is the Courant number. This scheme is known to be TVD for $\\nu \\in [0, 1]$. However, it is only first-order accurate and suffers from significant numerical diffusion, which smears sharp features like the edges of the square pulse. This diffusion is proportional to $\\Delta x (1-\\nu)$, so it is most pronounced for small $\\nu$ and vanishes for the special case $\\nu=1$. When $\\nu=1$, the update becomes $u_i^{n+1} = u_{i-1}^n$, which is an exact discrete shift, resulting in perfect advection with no loss of total variation.\n\n**Second-Order MUSCL Scheme**\n\nTo achieve second-order accuracy while retaining the TVD property, Monotonic Upwind Schemes for Conservation Laws (MUSCL) employ a high-resolution reconstruction. Instead of assuming a constant value within each cell, the solution is reconstructed as a piecewise linear function:\n$$\nU(x) = u_i^n + \\frac{\\sigma_i^n}{\\Delta x}(x - x_i) \\quad \\text{for } x \\in [x_{i-1/2}, x_{i+1/2})\n$$\nThe slope $\\sigma_i^n$ must be limited to prevent the introduction of new extrema (oscillations), which would violate the TVD property. The limited slope $\\sigma_i^n$ is a function of the local solution gradients. A common choice is $\\sigma_i = \\text{limiter}(\\Delta u_{i-1/2}, \\Delta u_{i+1/2})$, where $\\Delta u_{i-1/2} = u_i - u_{i-1}$ and $\\Delta u_{i+1/2} = u_{i+1} - u_i$. The limiters ensure that the reconstructed slope is never steeper than the slopes of the neighboring data. The specified limiters are:\n1.  **minmod**: $\\text{minmod}(a, b) = \\begin{cases} \\text{sgn}(a) \\min(|a|, |b|)  \\text{if } ab  0 \\\\ 0  \\text{if } ab \\le 0 \\end{cases}$. This is the most dissipative of the common limiters.\n2.  **van Leer**: $\\text{vanLeer}(a, b) = \\begin{cases} 2ab/(a+b)  \\text{if } ab  0 \\\\ 0  \\text{if } ab \\le 0 \\end{cases}$. This offers a good balance between accuracy and oscillation control.\n3.  **superbee**: This is a more aggressive (compressive) limiter, designed to preserve contact discontinuities with minimal smearing. It can be defined as $\\text{superbee}(a, b) = \\text{maxmod}(\\text{minmod}(2a,b), \\text{minmod}(a, 2b))$, where $\\text{maxmod}$ is analogous to minmod but takes the maximum absolute value.\n\nFor the explicit time integration, we use the MUSCL-Hancock method, a predictor-corrector scheme. The final update formula, which adds a limited anti-diffusive flux correction to the first-order upwind scheme, can be written as:\n$$\nu_i^{n+1} = u_i^n - \\nu(u_i^n - u_{i-1}^n) - \\frac{\\nu(1-\\nu)}{2}(\\sigma_i^n - \\sigma_{i-1}^n)\n$$\nThis formulation is TVD for $\\nu \\in [0,1]$ with appropriate slope limiters. It reduces to the second-order Lax-Wendroff scheme if no limiting is applied and reverts to the first-order upwind scheme when the limiter returns zero (e.g., near extrema). This adaptive nature allows it to capture sharp gradients while avoiding spurious oscillations.\n\nThe solution proceeds by implementing these schemes for the specified test cases. For each case, the initial square pulse is evolved for $T=1$ second. The final total variation is computed and divided by the initial total variation ($TV_0=2$) to obtain the ratio $R$. This ratio provides a direct measure of how well each scheme preserves the sharp profile of the initial pulse. A value of $R=1$ indicates perfect preservation, while lower values indicate numerical diffusion.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection problem using different numerical schemes\n    and computes the ratio of final to initial total variation.\n    \"\"\"\n    # Problem parameters\n    L = 1.0  # Domain length\n    N = 400  # Number of grid points\n    a = 1.0  # Advection speed\n    A = 1.0  # Pulse amplitude\n    x0 = 0.2  # Pulse left edge\n    w = 0.2  # Pulse width\n    T = L / a  # Final time (one full period)\n\n    # Discretization\n    dx = L / N\n    x = np.linspace(0, L, N, endpoint=False) + dx / 2\n\n    # Initial condition: square pulse\n    u0 = np.zeros(N)\n    u0[np.where((x = x0)  (x  x0 + w))] = A\n\n    def total_variation(u):\n        \"\"\"Computes the discrete total variation of a periodic grid function.\"\"\"\n        return np.sum(np.abs(np.roll(u, -1) - u))\n\n    TV0 = total_variation(u0)\n\n    # --- Slope Limiter Functions ---\n    def limiter_minmod(a, b):\n        \"\"\"Minmod slope limiter.\"\"\"\n        ab = a * b\n        return np.where(ab  0, np.sign(a) * np.minimum(np.abs(a), np.abs(b)), 0)\n\n    def limiter_vanleer(a, b):\n        \"\"\"Van Leer slope limiter.\"\"\"\n        ab = a * b\n        # Add a small epsilon to the denominator to prevent division by zero\n        # in the case where both a and b are extremely small but non-zero.\n        # The where clause already prevents a+b=0 if a=-b, since ab0.\n        return np.where(ab  0, 2 * ab / (a + b + 1e-12), 0)\n\n    def limiter_superbee(a, b):\n        \"\"\"Superbee slope limiter.\"\"\"\n        s1 = limiter_minmod(2 * a, b)\n        s2 = limiter_minmod(a, 2 * b)\n        # maxmod implementation\n        s1s2 = s1 * s2\n        max_abs = np.maximum(np.abs(s1), np.abs(s2))\n        return np.where(s1s2  0, np.sign(s1) * max_abs, 0)\n    \n    limiters = {\n        'minmod': limiter_minmod,\n        'vanLeer': limiter_vanleer,\n        'superbee': limiter_superbee\n    }\n\n    # Test suite\n    test_cases = [\n        ('Upwind', 0.2, None),\n        ('Upwind', 0.8, None),\n        ('Upwind', 1.0, None),\n        ('MUSCL', 0.2, 'minmod'),\n        ('MUSCL', 0.8, 'minmod'),\n        ('MUSCL', 0.8, 'vanLeer'),\n        ('MUSCL', 0.8, 'superbee'),\n    ]\n\n    results = []\n    \n    for scheme, nu, limiter_name in test_cases:\n        u = u0.copy()\n        dt = nu * dx / a\n        # Ensure integer number of steps to reach exactly T\n        num_steps = int(round(T / dt))\n\n        if scheme == 'Upwind':\n            for _ in range(num_steps):\n                u_minus_1 = np.roll(u, 1)\n                u = u - nu * (u - u_minus_1)\n        \n        elif scheme == 'MUSCL':\n            limiter_func = limiters[limiter_name]\n            for _ in range(num_steps):\n                # Calculate forward and backward differences\n                delta_minus = u - np.roll(u, 1)\n                delta_plus = np.roll(u, -1) - u\n\n                # Apply slope limiter\n                sigma = limiter_func(delta_minus, delta_plus)\n                \n                # MUSCL-Hancock update formula for linear advection\n                sigma_minus_1 = np.roll(sigma, 1)\n                \n                # The update can be seen as first-order upwind plus a correction term\n                correction = (nu * (1 - nu) / 2.0) * (sigma - sigma_minus_1)\n                first_order_term = nu * delta_minus\n                u = u - first_order_term - correction\n        \n        TV_final = total_variation(u)\n        ratio = TV_final / TV0\n        results.append(ratio)\n\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}