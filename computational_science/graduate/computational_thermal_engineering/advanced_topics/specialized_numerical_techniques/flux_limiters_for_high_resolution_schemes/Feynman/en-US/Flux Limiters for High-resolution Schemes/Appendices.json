{
    "hands_on_practices": [
        {
            "introduction": "To build a robust high-resolution scheme, we must first understand its core mechanism at the level of a single cell interface. This exercise provides a concrete, step-by-step walkthrough of this fundamental process. By calculating a limited interface value for a given temperature profile, you will see precisely how a flux limiter function modifies the numerical flux and adds the necessary numerical diffusion to maintain stability .",
            "id": "3955144",
            "problem": "Consider one-dimensional, constant-coefficient advection of temperature governed by the energy conservation law for a passive scalar, $\\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0$, with positive advection speed $a>0$. A uniform, cell-centered finite-volume discretization is used on a grid with nodes $x_i$, cell averages $T_i$, and numerical convective fluxes $F_{i+1/2} = a\\,T_{i+1/2}^{-}$, where $T_{i+1/2}^{-}$ denotes the left-sided reconstructed interface temperature at $x_{i+1/2}$. In a high-resolution, Total Variation Diminishing (TVD) Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) reconstruction, the piecewise-linear slope within cell $i$ is limited by a flux limiter $\\phi(r)$ applied to the upstream gradient. The van Albada limiter is specified by\n$$\n\\phi(r) = \\frac{r^{2} + r}{1 + r^{2}},\n$$\nwith the dimensionless gradient ratio for $a>0$ defined by\n$$\nr = \\frac{T_{i} - T_{i-1}}{T_{i+1} - T_{i}}.\n$$\nGiven the grid sequence $(T_{i-1}, T_i, T_{i+1}) = (300\\,\\text{K}, 330\\,\\text{K}, 365\\,\\text{K})$ and $a = 0.25\\,\\text{m}\\,\\text{s}^{-1}$, reconstruct the left-sided interface temperature $T_{i+1/2}^{-}$ at $x_{i+1/2}$ using the TVD-MUSCL approach with the van Albada limiter. Then, interpret the sign and magnitude of the incremental numerical diffusion in the convective flux, relative to the unlimited upwind-linear reconstruction corresponding to $\\phi(r)=1$, by comparing $F_{i+1/2}$ values.\n\nRound your final computed $T_{i+1/2}^{-}$ to four significant figures. Express the interface temperature in Kelvin.",
            "solution": "The problem requires the reconstruction of an interface temperature using a Total Variation Diminishing (TVD) Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) approach, followed by an interpretation of the numerical diffusion introduced by the flux limiter.\n\nThe governing equation is the one-dimensional linear advection equation for temperature $T$:\n$$\n\\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0\n$$\nwhere the advection speed $a$ is positive, indicating flow from left to right.\n\nIn a finite-volume framework, the semi-discrete form for a cell $i$ is:\n$$\n\\frac{d T_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nwhere $T_i$ is the cell-average temperature and $F_{i\\pm1/2}$ are the numerical fluxes at the cell interfaces. The problem specifies the flux as $F_{i+1/2} = a\\,T_{i+1/2}^{-}$, where $T_{i+1/2}^{-}$ is the reconstructed temperature at the left side of the interface $x_{i+1/2}$.\n\nFor a MUSCL scheme with an upwind-biased slope (since $a>0$), the piecewise-linear reconstruction of the temperature within cell $i$ leads to a value at its right-hand face, $x_{i+1/2}$, given by:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\sigma_i \\Delta x\n$$\nwhere $\\sigma_i$ is the limited slope in cell $i$. The problem states that the limiter is applied to the upstream gradient. For $a>0$, the upstream gradient for cell $i$ is based on the data in cells $i$ and $i-1$. The unlimited upwind-biased slope is $\\sigma_{i, \\text{unlim}} = (T_i - T_{i-1}) / \\Delta x$.\n\nApplying the flux limiter $\\phi(r_i)$ to this slope gives the limited slope:\n$$\n\\sigma_i = \\phi(r_i) \\frac{T_i - T_{i-1}}{\\Delta x}\n$$\nSubstituting this into the reconstruction formula yields the expression for the left-sided interface temperature:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\left( \\phi(r_i) \\frac{T_i - T_{i-1}}{\\Delta x} \\right) \\Delta x = T_i + \\frac{1}{2} \\phi(r_i) (T_i - T_{i-1})\n$$\nThe problem provides the necessary data: $T_{i-1} = 300\\,\\text{K}$, $T_i = 330\\,\\text{K}$, and $T_{i+1} = 365\\,\\text{K}$.\n\nFirst, we calculate the dimensionless gradient ratio $r_i$ at cell $i$:\n$$\nr_i = \\frac{T_{i} - T_{i-1}}{T_{i+1} - T_{i}} = \\frac{330 - 300}{365 - 330} = \\frac{30}{35} = \\frac{6}{7}\n$$\nNext, we evaluate the van Albada flux limiter function $\\phi(r)$ with $r = 6/7$:\n$$\n\\phi(r) = \\frac{r^{2} + r}{1 + r^{2}} \\implies \\phi\\left(\\frac{6}{7}\\right) = \\frac{\\left(\\frac{6}{7}\\right)^{2} + \\frac{6}{7}}{1 + \\left(\\frac{6}{7}\\right)^{2}} = \\frac{\\frac{36}{49} + \\frac{42}{49}}{\\frac{49}{49} + \\frac{36}{49}} = \\frac{\\frac{78}{49}}{\\frac{85}{49}} = \\frac{78}{85}\n$$\nNow, we can compute the reconstructed interface temperature $T_{i+1/2}^{-}$:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\phi(r_i) (T_i - T_{i-1}) = 330 + \\frac{1}{2} \\left(\\frac{78}{85}\\right) (330 - 300)\n$$\n$$\nT_{i+1/2}^{-} = 330 + \\frac{1}{2} \\left(\\frac{78}{85}\\right) (30) = 330 + \\frac{1170}{85} = 330 + \\frac{234}{17}\n$$\nNumerically, this value is:\n$$\nT_{i+1/2}^{-} \\approx 330 + 13.76470588... = 343.76470588...\\,\\text{K}\n$$\nRounding to four significant figures as requested gives:\n$$\nT_{i+1/2}^{-} \\approx 343.8\\,\\text{K}\n$$\nTo interpret the effect of the limiter, we compare this result to the unlimited upwind-linear reconstruction, which corresponds to setting $\\phi(r)=1$. This represents a pure second-order fully upwind scheme.\n$$\nT_{i+1/2, \\text{unlim}}^{-} = T_i + \\frac{1}{2} (1) (T_i - T_{i-1}) = 330 + \\frac{1}{2} (30) = 330 + 15 = 345\\,\\text{K}\n$$\nThe corresponding numerical fluxes are calculated with $a = 0.25\\,\\text{m}\\,\\text{s}^{-1}$:\n$$\nF_{i+1/2, \\text{limited}} = a \\cdot T_{i+1/2}^{-} = 0.25 \\times \\left(330 + \\frac{1170}{85}\\right) \\approx 0.25 \\times 343.7647 = 85.94117...\\,\\text{W}\\,\\text{m}^{-2}\\text{ (if T is a proxy for enthalpy)}\n$$\n$$\nF_{i+1/2, \\text{unlim}} = a \\cdot T_{i+1/2, \\text{unlim}}^{-} = 0.25 \\times 345 = 86.25\\,\\text{W}\\,\\text{m}^{-2}\n$$\nThe first-order upwind scheme, known to be the most diffusive but non-oscillatory, would use $T_{i+1/2}^{-} = T_i = 330\\,\\text{K}$. Its flux would be $F_{i+1/2, \\text{1st}} = 0.25 \\times 330 = 82.5\\,\\text{W}\\,\\text{m}^{-2}$.\n\nThe value of the limiter is $\\phi(r_i) = 78/85 \\approx 0.9176$, which is less than $1$. This causes the reconstructed temperature $T_{i+1/2}^{-} \\approx 343.8\\,\\text{K}$ to be lower than the unlimited second-order value $T_{i+1/2, \\text{unlim}}^{-} = 345\\,\\text{K}$ and closer to the first-order value $T_{i+1/2, \\text{1st}}^{-} = 330\\,\\text{K}$.\n\nThis shift towards the first-order upwind result is the defining characteristic of adding numerical diffusion. High-order schemes can introduce non-physical oscillations (over- and undershoots) near sharp gradients. The flux limiter's role is to add just enough numerical diffusion to suppress these oscillations and enforce monotonicity (the TVD property), at the cost of slightly lower accuracy than the unlimited scheme in smooth regions.\n\nTherefore, the sign of the incremental numerical diffusion introduced by the limiter is positive (i.e., diffusion is added). The magnitude of this effect is reflected in the reduction of the reconstructed temperature and the corresponding convective flux. The flux is reduced from $F_{i+1/2, \\text{unlim}} = 86.25$ to $F_{i+1/2, \\text{limited}} \\approx 85.94$. The difference in flux, $\\Delta F = F_{i+1/2, \\text{unlim}} - F_{i+1/2, \\text{limited}} > 0$, represents the dissipative correction applied by the limiter.\n$$\n\\Delta F = a \\frac{1}{2} (1 - \\phi(r_i)) (T_i - T_{i-1}) = 0.25 \\times \\frac{1}{2} \\left(1 - \\frac{78}{85}\\right) (30) = 0.25 \\times 15 \\times \\frac{7}{85} = \\frac{21}{68} \\approx 0.3088\n$$\nThis positive value confirms that the limiter acts to increase the scheme's dissipation relative to the unlimited second-order reconstruction.",
            "answer": "$$\n\\boxed{343.8}\n$$"
        },
        {
            "introduction": "Moving from a single calculation to a complete simulation, this practice challenges you to build a working finite-volume solver for the advection equation. You will implement a full scheme, including periodic boundary conditions and the van Leer flux limiter, to simulate the transport of a smooth sine wave. The essential task of performing a grid refinement study will allow you to empirically verify the scheme's theoretical second-order accuracy, a cornerstone of code verification in computational science .",
            "id": "3955097",
            "problem": "A one-dimensional linear advection of a smooth scalar field is governed by the conservation law $\\partial_t u + \\partial_x (a u) = 0$ with constant positive advection speed $a$. Starting from the conservation law and the definition of a conservative finite-volume discretization on a uniform periodic grid over $[0,1]$ with $N$ cells of width $\\Delta x$, construct a high-resolution explicit update using a flux-limited upwind scheme with the van Leer flux limiter to advance the solution in time with a Courant–Friedrichs–Lewy (CFL) number $\\nu \\in (0,1]$. The van Leer limiter is defined, for slope ratio $r$, by $\\phi_{\\mathrm{VL}}(r) = \\dfrac{r + |r|}{1 + |r|}$. Use the standard upwind choice for $a > 0$ in the numerical flux and enforce periodic boundary conditions exactly.\n\nThe physical and numerical setup is as follows:\n\n- Domain: $x \\in [0,1]$ in meters. Use periodic boundary conditions.\n- Advection speed: $a = 1\\,\\mathrm{m/s}$.\n- Initial condition: $u(x,0) = \\sin(2\\pi x)$.\n- Final time: $T = 1\\,\\mathrm{s}$, so that the exact solution at time $T$ is $u(x,T) = \\sin(2\\pi x)$.\n- Time step: choose $\\Delta t$ to satisfy $\\nu = a \\Delta t / \\Delta x$. Use $\\nu = 0.5$ so that $T/\\Delta t$ is an integer for all grids defined below.\n\nYou must:\n- Discretize the conservation law in conservative form with a finite-volume method, using a high-resolution upwind flux with the van Leer limiter for $a > 0$. The limiter should be applied through the slope ratio $r_i$ built from consecutive one-sided differences and used to correct the interface flux at $x_{i+1/2}$. The method must be Total Variation Diminishing (TVD) in the sense of Godunov for $a > 0$ by construction. Clearly implement periodicity to compute all required one-sided differences and interface fluxes.\n- Advance the solution from $t=0$ to $t=T$ with the chosen explicit time step such that $T/\\Delta t$ is an integer.\n- Compute the discrete $L^2$ error at $t=T$ defined by $E_2 = \\left(\\sum_{i=1}^{N} (u_i^{\\mathrm{num}} - u_i^{\\mathrm{exact}})^2 \\, \\Delta x \\right)^{1/2}$, where $u_i^{\\mathrm{exact}} = \\sin(2\\pi x_i)$ and $x_i$ is the center of cell $i$.\n- Perform a grid refinement study and estimate the observed order of accuracy $p$ between any two consecutive grids by $p = \\dfrac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(\\Delta x^{(1)}/\\Delta x^{(2)})}$.\n\nUse the following test suite of grid sizes (number of cells $N$):\n- Coarse: $N = 50$.\n- Medium: $N = 100$.\n- Fine: $N = 200$.\n- Very fine: $N = 400$.\n\nNumerical and physical units: distances must be in $\\mathrm{m}$, time in $\\mathrm{s}$, and speed in $\\mathrm{m/s}$. The $L^2$ errors and observed orders $p$ are unitless numbers. The initial condition amplitude and all constants must be used exactly as specified.\n\nYour program must:\n- For each $N$ in the test suite, compute the $L^2$ error $E_2$ at $t=T$ as a floating-point number.\n- Compute the three observed orders $p_{50\\to 100}$, $p_{100\\to 200}$, and $p_{200\\to 400}$ as floating-point numbers.\n- Return a final boolean indicating whether second-order accuracy is verified on the two finest refinements by the condition $p_{100\\to 200} \\ge 1.8$ and $p_{200\\to 400} \\ge 1.8$.\n\nFinal output format specification:\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets with the following entries in order: $[E_{50}, E_{100}, E_{200}, E_{400}, p_{50\\to 100}, p_{100\\to 200}, p_{200\\to 400}, \\text{verified}]$, where each $E_N$ and $p$ is a floating-point number and $\\text{verified}$ is a boolean. For example, an output might look like $[1.23e-04,3.08e-05,7.67e-06,1.91e-06,2.00,2.00,2.00,True]$.",
            "solution": "The problem requires the construction and application of a high-resolution, flux-limited finite-volume scheme to solve the one-dimensional linear advection equation. We will detail the derivation of the numerical method, its implementation, and the procedure for error analysis and order verification.\n\nThe governing partial differential equation (PDE) is the linear advection equation in conservation form:\n$$ \\partial_t u + \\partial_x (a u) = 0 $$\nwhere $u(x,t)$ is a scalar field, $t$ is time, $x$ is the spatial coordinate, and $a$ is the constant positive advection speed, given as $a=1\\,\\mathrm{m/s}$. The problem is posed on a one-dimensional periodic domain $x \\in [0,1]$.\n\nWe employ a finite-volume method on a uniform grid with $N$ cells. The domain $[0,1]$ is divided into cells $C_i = [x_{i-1/2}, x_{i+1/2}]$ of width $\\Delta x = 1/N$, for $i=0, 1, \\dots, N-1$. The cell center is $x_i = (i+0.5)\\Delta x$. Integrating the PDE over cell $C_i$ gives:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_t u \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_x (au) \\,dx = 0 $$\nUsing Leibniz's rule and the fundamental theorem of calculus, this becomes:\n$$ \\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u \\,dx + [au]_{x_{i+1/2}} - [au]_{x_{i-1/2}} = 0 $$\nWe define the cell-averaged quantity $u_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$. The equation for the evolution of the cell average is:\n$$ \\frac{d u_i}{dt} + \\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2}) = 0 $$\nHere, $F_{i \\pm 1/2}$ represents the numerical flux at the cell interfaces $x_{i \\pm 1/2}$, which approximates the physical flux $au$ at those locations.\n\nFor time discretization, we use an explicit forward Euler method. The fully discrete update formula is:\n$$ \\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{1}{\\Delta x} (F_{i+1/2}^n - F_{i-1/2}^n) = 0 $$\n$$ u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2}^n - F_{i-1/2}^n) $$\nwhere $u_i^n$ is the approximation of the cell average in cell $i$ at time $t^n = n\\Delta t$. The term $\\frac{\\Delta t}{\\Delta x}$ is related to the Courant–Friedrichs–Lewy (CFL) number, $\\nu = \\frac{a \\Delta t}{\\Delta x}$. The update becomes:\n$$ u_i^{n+1} = u_i^n - \\frac{\\nu}{a} (F_{i+1/2}^n - F_{i-1/2}^n) $$\n\nTo achieve high resolution while maintaining stability (i.e., being Total Variation Diminishing, TVD), we construct the numerical flux $F_{i+1/2}$ as a combination of a low-resolution (first-order) flux and a limited high-resolution (anti-diffusive) correction. Since the advection speed $a$ is positive, information propagates from left to right, so we use an upwind-biased scheme.\n\nThe first-order upwind flux at interface $x_{i+1/2}$ is:\n$$ F_{i+1/2}^{\\text{1st}} = a u_i^n $$\nA common second-order scheme for this problem is the Lax-Wendroff scheme, whose flux (for $a>0$) is:\n$$ F_{i+1/2}^{\\text{LW}} = a u_i^n + \\frac{a}{2}\\left(1 - \\frac{a\\Delta t}{\\Delta x}\\right)(u_{i+1}^n - u_i^n) = a u_i^n + \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe difference between the Lax-Wendroff flux and the first-order upwind flux is the anti-diffusive flux term, which is responsible for the higher accuracy but can introduce spurious oscillations near sharp gradients.\n$$ \\Phi_{i+1/2}^{\\text{AD}} = F_{i+1/2}^{\\text{LW}} - F_{i+1/2}^{\\text{1st}} = \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe high-resolution flux-limited scheme is constructed by adding a limited portion of this anti-diffusive flux to the first-order flux:\n$$ F_{i+1/2} = F_{i+1/2}^{\\text{1st}} + \\phi(r_{i+1/2}) \\Phi_{i+1/2}^{\\text{AD}} = a u_i^n + \\phi(r_{i+1/2}) \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe function $\\phi(r)$ is the flux limiter, and it depends on the slope ratio $r$. For an upwind-biased scheme with $a>0$, the slope ratio for the flux at interface $x_{i+1/2}$ compares the gradient in the upwind cell ($i-1$) to the gradient in the local cell ($i$). It is defined as the ratio of consecutive cell-to-cell differences:\n$$ r_{i+1/2} = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n} $$\nThis ratio measures the local smoothness of the solution. The problem specifies the van Leer flux limiter:\n$$ \\phi_{\\mathrm{VL}}(r) = \\frac{r + |r|}{1 + |r|} $$\nIf the denominator $u_{i+1}^n - u_i^n$ is zero, $r_{i+1/2}$ is undefined. However, in this case, the anti-diffusive flux term $\\Phi_{i+1/2}^{\\text{AD}}$ is also zero, so the correction is null regardless of the limiter's value. We handle this case by setting the correction to zero.\n\nThe periodic boundary conditions mean that cell indices are treated modulo $N$. For example, the upwind neighbor of cell $i=0$ is cell $i=N-1$, and the downwind neighbor of cell $i=N-1$ is cell $i=0$. This is implemented efficiently using array rolling or modular arithmetic.\n\nThe overall algorithm for each time step is:\n1. For each cell $i=0, \\dots, N-1$, compute the slope ratio $r_{i+1/2}$ using values from cells $i-1$, $i$, and $i+1$ with periodic wrap-around.\n2. Compute the van Leer limiter $\\phi_{\\mathrm{VL}}(r_{i+1/2})$ for each interface.\n3. Compute the numerical flux $F_{i+1/2}$ for each interface $i=0, \\dots, N-1$.\n4. Compute the flux at the left interface of each cell, $F_{i-1/2}$, by shifting the array of right-interface fluxes.\n5. Update all cell averages $u_i^n$ to $u_i^{n+1}$ simultaneously.\n\nThis procedure is repeated for $N_t = T/\\Delta t$ time steps to reach the final time $T=1\\,\\mathrm{s}$. Given $a=1\\,\\mathrm{m/s}$, $\\nu=0.5$, and $\\Delta x = 1/N$, the time step is $\\Delta t = \\nu \\Delta x / a = 0.5/N$, and the number of steps is $N_t = T/\\Delta t = 1/(0.5/N) = 2N$, which is an integer.\n\nAfter the final time step, we compute the discrete $L^2$ error:\n$$ E_2 = \\left(\\sum_{i=0}^{N-1} (u_i^{\\text{num}} - u_i^{\\text{exact}})^2 \\, \\Delta x \\right)^{1/2} $$\nwhere $u_i^{\\text{num}}$ is the numerical solution in cell $i$ at time $T$, and $u_i^{\\text{exact}} = u(x_i, T)$. Since the wave speed is $a=1\\,\\mathrm{m/s}$ and the final time is $T=1\\,\\mathrm{s}$, the wave travels exactly one domain length, returning to its initial state due to periodicity. Thus, $u(x,T) = u(x-aT,0) = \\sin(2\\pi(x-1)) = \\sin(2\\pi x)$.\n\nFinally, we perform a grid refinement study using two consecutive grids with resolutions $N_1$ and $N_2$ (and corresponding mesh sizes $\\Delta x_1, \\Delta x_2$ and errors $E_2^{(1)}, E_2^{(2)}$). The observed order of accuracy $p$ is estimated as:\n$$ p = \\frac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(\\Delta x_1/\\Delta x_2)} $$\nFor our case where grids are doubled, $\\Delta x_1/\\Delta x_2 = 2$, so $p = \\frac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(2)}$. We expect $p \\approx 2$ for this scheme on a smooth solution, though limiters can reduce this slightly near extrema.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a flux-limited finite volume scheme\n    and performs a grid refinement study.\n    \"\"\"\n    \n    # --- Physical and Numerical Parameters ---\n    grid_sizes = [50, 100, 200, 400]\n    a = 1.0  # Advection speed in m/s\n    L = 1.0  # Domain length in m\n    T = 1.0  # Final time in s\n    nu = 0.5  # CFL number\n\n    l2_errors = []\n\n    for N in grid_sizes:\n        # --- Grid and Time Step Setup ---\n        dx = L / N\n        dt = nu * dx / a\n        num_steps = int(round(T / dt))\n\n        # --- Initial Condition ---\n        # Cell centers\n        x = (np.arange(N) + 0.5) * dx\n        u = np.sin(2 * np.pi * x)\n\n        # --- Time Integration Loop ---\n        for _ in range(num_steps):\n            # Enforce periodic boundary conditions by rolling the array\n            u_im1 = np.roll(u, 1)  # u_{i-1}\n            u_ip1 = np.roll(u, -1)  # u_{i+1}\n            \n            # --- Calculate Slope Ratio r ---\n            # r_{i+1/2} = (u_i - u_{i-1}) / (u_{i+1} - u_i)\n            # which is associated with the flux F_{i+1/2}\n            \n            # Numerator of r\n            num_r = u - u_im1\n            # Denominator of r\n            den_r = u_ip1 - u\n            \n            # Handle division by zero for r\n            r = np.zeros_like(u)\n            nonzero_den_mask = (den_r != 0)\n            r[nonzero_den_mask] = num_r[nonzero_den_mask] / den_r[nonzero_den_mask]\n            \n            # --- Calculate van Leer Flux Limiter phi ---\n            # phi(r) = (r + |r|) / (1 + |r|)\n            phi = (r + np.abs(r)) / (1.0 + np.abs(r))\n\n            # --- Calculate High-Resolution Flux F_{i+1/2} ---\n            # F_{i+1/2} = a*u_i + phi * a*(1-nu)/2 * (u_{i+1} - u_i)\n            \n            # First-order upwind flux\n            flux_low = a * u\n            \n            # Anti-diffusive correction term\n            flux_correction = phi * (a * (1 - nu) / 2.0) * den_r\n            \n            # High-resolution flux at the right cell interface (i+1/2)\n            F_iph = flux_low + flux_correction\n            \n            # Flux at the left cell interface (i-1/2) by rolling\n            F_imh = np.roll(F_iph, 1)\n            \n            # --- Update Solution ---\n            # u^{n+1} = u^n - (dt/dx) * (F_{i+1/2} - F_{i-1/2})\n            u = u - (dt / dx) * (F_iph - F_imh)\n\n        # --- Error Calculation ---\n        # Exact solution at t=T is the same as the initial condition\n        u_exact = np.sin(2 * np.pi * x)\n        \n        # L2-norm of the error\n        error = np.sqrt(np.sum((u - u_exact)**2) * dx)\n        l2_errors.append(error)\n\n    # --- Order of Accuracy Calculation ---\n    orders = []\n    for i in range(len(grid_sizes) - 1):\n        # p = log(E1/E2) / log(dx1/dx2)\n        # dx1/dx2 = 2 for grid doubling\n        order = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders.append(order)\n\n    # --- Verification of Second-Order Accuracy ---\n    # Condition: p = 1.8 on the two finest refinements\n    verified = (orders[1] = 1.8) and (orders[2] = 1.8)\n\n    # --- Final Output Formatting ---\n    results_list = l2_errors + orders + [verified]\n    # Example format: [1.23e-04,3.08e-05,7.67e-06,1.91e-06,2.00,2.00,2.00,True]\n    # We use a mix of general and scientific notation for floats to be clean\n    formatted_results = []\n    for item in results_list:\n        if isinstance(item, bool):\n            formatted_results.append(str(item))\n        else: # float\n            if abs(item)  1e-3 and item != 0:\n                 formatted_results.append(f\"{item:.6e}\")\n            else:\n                 formatted_results.append(f\"{item:.6f}\")\n    \n    print(f\"[{','.join(map(str, results_list))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A spatially limited scheme is only half the story; the choice of time integrator is equally critical for ensuring non-oscillatory results. This advanced exercise explores the crucial interaction between spatial and temporal discretization. By comparing a non-Strong Stability Preserving (non-SSP) method like the classical fourth-order Runge–Kutta (RK4) with an SSP method, you will demonstrate and quantify how the time-stepping algorithm itself can violate the Total Variation Diminishing (TVD) property, even when a spatial limiter is active .",
            "id": "3955164",
            "problem": "Consider the one-dimensional linear advection of temperature governed by the conservation law $T_t + a T_x = 0$ on the periodic domain $x \\in [0,1]$, where $T(x,t)$ is the temperature in Kelvin, $t$ is time in seconds, and $a$ is a constant advection speed in meters per second. Use a finite-volume formulation with cell averages $T_i^n$ representing the average of $T$ in cell $i$ at time level $n$. The semi-discrete update is defined by the flux difference,\n$$\n\\frac{d T_i}{dt} = - \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x},\n$$\nwhere $F_{i+\\frac{1}{2}}$ is a consistent numerical flux at the cell interface between cells $i$ and $i+1$, and $\\Delta x$ is the uniform grid spacing in meters. Construct a second-order spatial discretization using the Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) reconstruction with the minmod limiter to compute interface states. Define the minmod function as\n$$\n\\operatorname{minmod}(p,q) = \\begin{cases}\n\\operatorname{sign}(p)\\min(|p|,|q|),  \\text{if } \\operatorname{sign}(p) = \\operatorname{sign}(q), \\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nFor each interface $x_{i+\\frac{1}{2}}$, reconstruct left and right states,\n$$\nT_{i+\\frac{1}{2}}^L = T_i + \\frac{1}{2}\\operatorname{minmod}\\left(T_i - T_{i-1}, T_{i+1} - T_i\\right), \\quad\nT_{i+\\frac{1}{2}}^R = T_{i+1} - \\frac{1}{2}\\operatorname{minmod}\\left(T_{i+1} - T_i, T_{i+2} - T_{i+1}\\right),\n$$\nwith periodic indexing. Use the Rusanov (local Lax–Friedrichs) numerical flux,\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(a T_{i+\\frac{1}{2}}^L + a T_{i+\\frac{1}{2}}^R\\right) - \\frac{1}{2}|a|\\left(T_{i+\\frac{1}{2}}^R - T_{i+\\frac{1}{2}}^L\\right).\n$$\nTime integrate with either the classical fourth-order Runge–Kutta method (RK4), which is a non-Strong Stability Preserving (non-SSP) high-order integrator, or the third-order Strong Stability Preserving Runge–Kutta method (SSPRK3), which is SSP. Define the Courant–Friedrichs–Lewy (CFL) number as $\\text{CFL} = \\frac{a \\Delta t}{\\Delta x}$, where $\\Delta t$ is the time step in seconds. For the SSPRK3 method, use the Shu–Osher stages, where the $n \\to n+1$ update is given by three forward Euler-like stages combined convexly.\n\nDefine the total variation (in the sense of sequences) of the discrete temperature at time level $n$ by\n$$\n\\operatorname{TV}(T^n) = \\sum_{i=0}^{N-1} \\left| T_{i+1}^n - T_i^n \\right|,\n$$\nwith periodic indexing so that $T_N^n \\equiv T_0^n$. The Total Variation Diminishing (TVD) condition requires $\\operatorname{TV}(T^{n+1}) \\le \\operatorname{TV}(T^n)$ under appropriate stability conditions. Strong Stability Preserving (SSP) methods guarantee that if a forward Euler step with a given spatial discretization is TVD under a certain time-step restriction, then the SSP method remains TVD under a related time-step restriction because it can be written as a convex combination of forward Euler steps. Non-SSP methods such as RK4 do not guarantee TVD, and thus can generate oscillations even if the spatial scheme is limited.\n\nYour task is to construct computational experiments that demonstrate a case where the non-SSP RK4 produces oscillations despite MUSCL spatial limiting, and to quantify the violation of the TVD condition by computing the maximum normalized increase of total variation relative to the initial total variation. For each experiment, run for a fixed number of time steps and compute\n$$\n\\mathcal{V} = \\max_{0 \\le n \\le N_{\\text{steps}}} \\frac{\\max\\left(\\operatorname{TV}(T^n) - \\operatorname{TV}(T^0), 0\\right)}{\\operatorname{TV}(T^0)}.\n$$\nReport $\\mathcal{V}$ as a decimal number (dimensionless). If $\\mathcal{V} = 0$, the TVD condition is not violated over the run; if $\\mathcal{V} > 0$, the TVD condition is violated by the amount reported.\n\nUse the following physical parameters and initial conditions, ensuring scientific realism and consistent units:\n- Advection speed $a = 1\\,\\text{m/s}$.\n- Domain length $L = 1\\,\\text{m}$, with periodic boundary conditions.\n- Grid resolution $N$ cells; thus $\\Delta x = L/N$ meters.\n- Time step $\\Delta t = \\text{CFL} \\cdot \\Delta x / a$ seconds.\n\nUse the following test suite with different integrator types, grid resolutions, CFL numbers, and initial conditions. For initial conditions, define:\n- Step profile (monotone discontinuity): $T(x,0) = 1\\,\\text{K}$ for $x \\in [0.3, 0.7)$ and $T(x,0) = 0\\,\\text{K}$ otherwise.\n- Smooth cosine profile: $T(x,0) = \\frac{1}{2}\\left(1 + \\cos(2\\pi x)\\right)\\,\\text{K}$.\n\nRun each test for $N_{\\text{steps}} = 20$ time steps and compute $\\mathcal{V}$.\n\nTest suite:\n1. Non-SSP RK4, $\\text{CFL} = 0.95$, $N = 50$, step profile.\n2. SSPRK3, $\\text{CFL} = 0.95$, $N = 50$, step profile.\n3. Non-SSP RK4, $\\text{CFL} = 0.90$, $N = 200$, step profile.\n4. Non-SSP RK4, $\\text{CFL} = 0.95$, $N = 50$, smooth cosine profile.\n\nYour program should produce a single line of output containing the results for the four test cases as a comma-separated list of decimal numbers enclosed in square brackets (for example, \"[result1,result2,result3,result4]\"). Each number must be the value of $\\mathcal{V}$ for the corresponding test case, rounded to six decimal places. As all outputs are dimensionless ratios, no physical unit should be printed. Angles, if any were used, would be in radians, but this setup does not require angle units. Percentages must not be used; express all results as decimals.",
            "solution": "The problem statement is a well-defined computational experiment in the field of numerical methods for partial differential equations, specifically focusing on transport phenomena in thermal engineering. It is scientifically grounded, self-contained, and objective. All parameters, equations, and numerical methods are standard in the field of computational fluid dynamics. Therefore, the problem is valid and a solution can be constructed.\n\nThe task is to investigate the Total Variation Diminishing (TVD) property of a numerical scheme for the one-dimensional linear advection equation, $T_t + a T_x = 0$. The scheme combines a second-order MUSCL spatial reconstruction with a choice of two different time integration methods: the non-Strong Stability Preserving (non-SSP) classical fourth-order Runge-Kutta (RK4) method and the third-order Strong Stability Preserving Runge-Kutta (SSPRK3) method. The goal is to demonstrate and quantify that the non-SSP integrator can introduce oscillations and violate the TVD property, even when the spatial discretization is designed to prevent them.\n\nThe solution is computed using a finite-volume method. The domain $x \\in [0, 1]$ is divided into $N$ uniform cells of width $\\Delta x = L/N = 1/N$. The state variable is the cell-averaged temperature, $T_i^n$. The semi-discrete equation for the evolution of the cell average $T_i$ is given by\n$$\n\\frac{d T_i}{dt} = \\mathcal{L}(T)_i = - \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x}\n$$\nwhere $\\mathcal{L}(T)_i$ represents the spatial discretization operator, and $F_{i+\\frac{1}{2}}$ is the numerical flux at the interface between cell $i$ and cell $i+1$.\n\n**1. Spatial Discretization**\n\nThe spatial discretization involves three steps: data reconstruction, flux calculation, and flux differencing.\n\n**1.1. MUSCL Reconstruction with Minmod Limiter**\n\nTo achieve second-order accuracy in space, we reconstruct the temperature distribution within each cell from the cell averages. At each cell interface $x_{i+\\frac{1}{2}}$, we determine a left state $T_{i+\\frac{1}{2}}^L$ and a right state $T_{i+\\frac{1}{2}}^R$ by linear reconstruction with slope limiting.\n\nThe slope in each cell $i$, denoted $\\Delta_i$, is limited to prevent spurious oscillations near sharp gradients. The minmod limiter is used for this purpose. It compares the backward difference, $T_i - T_{i-1}$, and the forward difference, $T_{i+1} - T_i$. The limited slope is given by $\\sigma_i = \\operatorname{minmod}(T_i - T_{i-1}, T_{i+1} - T_i)$, where the minmod function is defined as\n$$\n\\operatorname{minmod}(p,q) = \\begin{cases}\n\\operatorname{sign}(p)\\min(|p|,|q|),  \\text{if } \\operatorname{sign}(p) = \\operatorname{sign}(q) \\\\\n0,  \\text{otherwise}\n\\end{cases}\n$$\nThis limiter ensures that the reconstructed values do not introduce new local extrema, a key property for a TVD scheme. The reconstructed states at the interface $x_{i+\\frac{1}{2}}$ are then:\n$$\nT_{i+\\frac{1}{2}}^L = T_i + \\frac{1}{2}\\sigma_i\n$$\n$$\nT_{i+\\frac{1}{2}}^R = T_{i+1} - \\frac{1}{2}\\sigma_{i+1}\n$$\nPeriodic boundary conditions are enforced by wrapping around indices for cells at the domain boundaries. For example, for cell $i=0$, the value $T_{i-1}$ is taken as $T_{N-1}$.\n\n**1.2. Rusanov (Local Lax-Friedrichs) Flux**\n\nWith the left and right states at each interface, the numerical flux $F_{i+\\frac{1}{2}}$ is calculated using the Rusanov formula. This flux is robust and introduces an amount of numerical dissipation proportional to the local wave speed.\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(a T_{i+\\frac{1}{2}}^L + a T_{i+\\frac{1}{2}}^R\\right) - \\frac{1}{2}|a|\\left(T_{i+\\frac{1}{2}}^R - T_{i+\\frac{1}{2}}^L\\right)\n$$\nSince the advection speed is given as $a=1\\,\\text{m/s} > 0$, this simplifies to the upwind flux $F_{i+\\frac{1}{2}} = a T_{i+\\frac{1}{2}}^L$.\n\n**2. Temporal Discretization**\n\nThe semi-discrete system $\\frac{dT}{dt} = \\mathcal{L}(T)$ is a system of ordinary differential equations, which is solved using a Runge-Kutta method.\n\n**2.1. Third-Order Strong Stability Preserving Runge-Kutta (SSPRK3)**\n\nSSP methods are designed to preserve the stability properties (like the TVD property) of the forward Euler method. The SSPRK3 method advances the solution from time $n$ to $n+1$ via three stages:\n$$\n\\begin{aligned}\nT^{(1)} = T^n + \\Delta t \\mathcal{L}(T^n) \\\\\nT^{(2)} = \\frac{3}{4}T^n + \\frac{1}{4}T^{(1)} + \\frac{1}{4}\\Delta t \\mathcal{L}(T^{(1)}) \\\\\nT^{n+1} = \\frac{1}{3}T^n + \\frac{2}{3}T^{(2)} + \\frac{2}{3}\\Delta t \\mathcal{L}(T^{(2)})\n\\end{aligned}\n$$\nIf the spatial operator $\\mathcal{L}$ coupled with forward Euler is TVD under a CFL condition, SSPRK3 guarantees the fully-discrete scheme is also TVD under a related CFL condition.\n\n**2.2. Classical Fourth-Order Runge-Kutta (RK4)**\n\nThe classical RK4 method is known for its high accuracy but is not an SSP method. This means it can violate the TVD property even if the spatial scheme is TVD under forward Euler. The stages are:\n$$\n\\begin{aligned}\nk_1 = \\mathcal{L}(T^n) \\\\\nk_2 = \\mathcal{L}(T^n + \\frac{\\Delta t}{2} k_1) \\\\\nk_3 = \\mathcal{L}(T^n + \\frac{\\Delta t}{2} k_2) \\\\\nk_4 = \\mathcal{L}(T^n + \\Delta t k_3) \\\\\nT^{n+1} = T^n + \\frac{\\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n\\end{aligned}\n$$\nThe convex combination property required for SSP methods is not satisfied by these coefficients.\n\n**3. Evaluation of TVD Violation**\n\nTo quantify the performance, we measure the Total Variation ($\\operatorname{TV}$) of the discrete solution at each time step $n$:\n$$\n\\operatorname{TV}(T^n) = \\sum_{i=0}^{N-1} |T_{i+1}^n - T_i^n|\n$$\nwhere $T_N^n \\equiv T_0^n$ due to periodicity. A scheme is TVD if $\\operatorname{TV}(T^{n+1}) \\le \\operatorname{TV}(T^n)$ for all $n$. We compute the maximum normalized increase in TV over the simulation, defined by the metric $\\mathcal{V}$:\n$$\n\\mathcal{V} = \\max_{0 \\le n \\le N_{\\text{steps}}} \\frac{\\max\\left(\\operatorname{TV}(T^n) - \\operatorname{TV}(T^0), 0\\right)}{\\operatorname{TV}(T^0)}\n$$\nA value of $\\mathcal{V} = 0$ indicates no TVD violation was observed, while $\\mathcal{V} > 0$ quantifies the extent of the violation.\n\n**4. Implementation and Test Procedure**\n\nFor each of the four test cases specified, a simulation is performed. The process is as follows:\n1.  Define the grid with $N$ cells and cell centers $x_i = (i+0.5)\\Delta x$.\n2.  Initialize the temperature array $T^0$ based on the given profile (step or cosine), sampled at the cell centers.\n3.  Calculate the constant time step $\\Delta t = \\text{CFL} \\cdot \\Delta x / a$.\n4.  Compute the initial total variation $\\operatorname{TV}(T^0)$.\n5.  Iterate for $N_{\\text{steps}} = 20$ time steps. In each step, update the solution $T^n \\to T^{n+1}$ using the specified time integrator (SSPRK3 or RK4).\n6.  At every step, compute and store $\\operatorname{TV}(T^n)$.\n7.  After the simulation, calculate the metric $\\mathcal{V}$ from the stored history of total variation values.\n\nThis procedure is systematically applied to all test cases, and the resulting values of $\\mathcal{V}$ are reported. The implementation uses vectorized `NumPy` operations for efficiency.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation test suite and print results.\n    \"\"\"\n\n    def minmod(p, q):\n        \"\"\"\n        Vectorized minmod limiter function.\n        \"\"\"\n        sign_p = np.sign(p)\n        result = np.zeros_like(p)\n        # The condition sign(p) * sign(q)  0 is a concise way to handle signs\n        # and avoids issues with np.sign(0) = 0.\n        idx = np.where(sign_p * np.sign(q)  0)\n        result[idx] = sign_p[idx] * np.minimum(np.abs(p[idx]), np.abs(q[idx]))\n        return result\n\n    def compute_rhs(T, dx, a):\n        \"\"\"\n        Computes the right-hand side of the semi-discrete finite volume scheme.\n        This corresponds to the spatial operator L(T).\n        \"\"\"\n        # Periodic boundary conditions via np.roll\n        T_im1 = np.roll(T, 1)\n        T_ip1 = np.roll(T, -1)\n\n        # MUSCL reconstruction with minmod limiter\n        # Slope in each cell i is based on differences with neighbors\n        delta_backward = T - T_im1\n        delta_forward = T_ip1 - T\n        sigma = minmod(delta_backward, delta_forward)\n\n        # Reconstructed states at interface i+1/2\n        # T_L corresponds to T_{i+1/2}^L, T_R to T_{i+1/2}^R\n        T_L = T + 0.5 * sigma\n        T_R = T_ip1 - 0.5 * np.roll(sigma, -1)\n\n        # Rusanov (local Lax-Friedrichs) flux\n        # F_flux[i] corresponds to F_{i+1/2}\n        flux_avg = 0.5 * (a * T_L + a * T_R)\n        dissipation = 0.5 * np.abs(a) * (T_R - T_L)\n        F_flux = flux_avg - dissipation\n\n        # Flux difference for each cell i: F_{i+1/2} - F_{i-1/2}\n        rhs = -(F_flux - np.roll(F_flux, 1)) / dx\n        return rhs\n\n    def ssprk3_step(T, dt, dx, a):\n        \"\"\"\n        Performs one time step using the third-order SSP Runge-Kutta method.\n        \"\"\"\n        T1 = T + dt * compute_rhs(T, dx, a)\n        T2 = 0.75 * T + 0.25 * (T1 + dt * compute_rhs(T1, dx, a))\n        T_next = (1.0 / 3.0) * T + (2.0 / 3.0) * (T2 + dt * compute_rhs(T2, dx, a))\n        return T_next\n\n    def rk4_step(T, dt, dx, a):\n        \"\"\"\n        Performs one time step using the classical fourth-order Runge-Kutta method.\n        \"\"\"\n        k1 = compute_rhs(T, dx, a)\n        k2 = compute_rhs(T + 0.5 * dt * k1, dx, a)\n        k3 = compute_rhs(T + 0.5 * dt * k2, dx, a)\n        k4 = compute_rhs(T + dt * k3, dx, a)\n        T_next = T + (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n        return T_next\n\n    def total_variation(T):\n        \"\"\"\n        Computes the total variation of a discrete solution with periodic boundaries.\n        \"\"\"\n        return np.sum(np.abs(T - np.roll(T, 1)))\n\n    def run_simulation(integrator, cfl, N, ic_profile, n_steps):\n        \"\"\"\n        Runs a single simulation case and computes the TVD violation metric V.\n        \"\"\"\n        # Physical and grid parameters\n        L = 1.0\n        a = 1.0\n        dx = L / N\n        dt = cfl * dx / a\n\n        x = (np.arange(N) + 0.5) * dx\n\n        # Initial conditions\n        if ic_profile == 'step':\n            T = np.where((x = 0.3)  (x  0.7), 1.0, 0.0)\n        elif ic_profile == 'cosine':\n            T = 0.5 * (1.0 + np.cos(2.0 * np.pi * x))\n        else:\n            raise ValueError(\"Unknown initial condition profile.\")\n\n        # Determine the time stepping function\n        if integrator == 'RK4':\n            step_func = rk4_step\n        elif integrator == 'SSPRK3':\n            step_func = ssprk3_step\n        else:\n            raise ValueError(\"Unknown integrator.\")\n\n        # Compute initial total variation\n        tv0 = total_variation(T)\n        if tv0 == 0.0:\n            return 0.0 # No variation to increase\n\n        tv_history = [tv0]\n        \n        T_current = T.copy()\n        for _ in range(n_steps):\n            T_current = step_func(T_current, dt, dx, a)\n            tv_history.append(total_variation(T_current))\n\n        # Compute the metric V\n        tv_history = np.array(tv_history)\n        max_tv_increase = np.max(np.maximum(tv_history - tv0, 0))\n        \n        V = max_tv_increase / tv0\n        \n        return V\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'integrator': 'RK4', 'cfl': 0.95, 'N': 50, 'ic_profile': 'step', 'n_steps': 20},\n        {'integrator': 'SSPRK3', 'cfl': 0.95, 'N': 50, 'ic_profile': 'step', 'n_steps': 20},\n        {'integrator': 'RK4', 'cfl': 0.90, 'N': 200, 'ic_profile': 'step', 'n_steps': 20},\n        {'integrator': 'RK4', 'cfl': 0.95, 'N': 50, 'ic_profile': 'cosine', 'n_steps': 20},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(**case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}