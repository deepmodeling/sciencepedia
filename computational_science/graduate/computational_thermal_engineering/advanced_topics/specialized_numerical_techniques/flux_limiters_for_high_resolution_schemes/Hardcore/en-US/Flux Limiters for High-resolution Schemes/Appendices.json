{
    "hands_on_practices": [
        {
            "introduction": "The primary function of a flux limiter is to control the gradients used in piecewise data reconstruction, preventing the spurious oscillations that high-order schemes can generate near sharp changes in the solution. This practice provides a concrete, step-by-step calculation to demystify this process. By working through a specific numerical example with the van Albada limiter, you will see exactly how the local solution profile, captured by the ratio $r$, dictates the extent of the limiting action and ultimately determines the reconstructed temperature at a cell interface .",
            "id": "3955144",
            "problem": "Consider one-dimensional, constant-coefficient advection of temperature governed by the energy conservation law for a passive scalar, $\\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0$, with positive advection speed $a0$. A uniform, cell-centered finite-volume discretization is used on a grid with nodes $x_i$, cell averages $T_i$, and numerical convective fluxes $F_{i+1/2} = a\\,T_{i+1/2}^{-}$, where $T_{i+1/2}^{-}$ denotes the left-sided reconstructed interface temperature at $x_{i+1/2}$. In a high-resolution, Total Variation Diminishing (TVD) Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) reconstruction, the piecewise-linear slope within cell $i$ is limited by a flux limiter $\\phi(r)$ applied to the upstream gradient. The van Albada limiter is specified by\n$$\n\\phi(r) = \\frac{r^{2} + r}{1 + r^{2}},\n$$\nwith the dimensionless gradient ratio for $a0$ defined by\n$$\nr = \\frac{T_{i} - T_{i-1}}{T_{i+1} - T_{i}}.\n$$\nGiven the grid sequence $(T_{i-1}, T_i, T_{i+1}) = (\\,300\\,\\text{K},\\,330\\,\\text{K},\\,365\\,\\text{K}\\,)$ and $a = 0.25\\,\\text{m}\\,\\text{s}^{-1}$, reconstruct the left-sided interface temperature $T_{i+1/2}^{-}$ at $x_{i+1/2}$ using the TVD-MUSCL approach with the van Albada limiter. Then, interpret the sign and magnitude of the incremental numerical diffusion in the convective flux, relative to the unlimited upwind-linear reconstruction corresponding to $\\phi(r)=1$, by comparing $F_{i+1/2}$ values.\n\nRound your final computed $T_{i+1/2}^{-}$ to four significant figures. Express the interface temperature in Kelvin.",
            "solution": "The problem requires the reconstruction of an interface temperature using a Total Variation Diminishing (TVD) Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) approach, followed by an interpretation of the numerical diffusion introduced by the flux limiter.\n\nThe governing equation is the one-dimensional linear advection equation for temperature $T$:\n$$\n\\frac{\\partial T}{\\partial t} + a \\frac{\\partial T}{\\partial x} = 0\n$$\nwhere the advection speed $a$ is positive, indicating flow from left to right.\n\nIn a finite-volume framework, the semi-discrete form for a cell $i$ is:\n$$\n\\frac{d T_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nwhere $T_i$ is the cell-average temperature and $F_{i\\pm1/2}$ are the numerical fluxes at the cell interfaces. The problem specifies the flux as $F_{i+1/2} = a\\,T_{i+1/2}^{-}$, where $T_{i+1/2}^{-}$ is the reconstructed temperature at the left side of the interface $x_{i+1/2}$.\n\nFor a MUSCL scheme with an upwind-biased slope (since $a0$), the piecewise-linear reconstruction of the temperature within cell $i$ leads to a value at its right-hand face, $x_{i+1/2}$, given by:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\sigma_i \\Delta x\n$$\nwhere $\\sigma_i$ is the limited slope in cell $i$. The problem states that the limiter is applied to the upstream gradient. For $a0$, the upstream gradient for cell $i$ is based on the data in cells $i$ and $i-1$. The unlimited upwind-biased slope is $\\sigma_{i, \\text{unlim}} = (T_i - T_{i-1}) / \\Delta x$.\n\nApplying the flux limiter $\\phi(r)$ to this slope gives the limited slope:\n$$\n\\sigma_i = \\phi(r_i) \\frac{T_i - T_{i-1}}{\\Delta x}\n$$\nSubstituting this into the reconstruction formula yields the expression for the left-sided interface temperature:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\left( \\phi(r_i) \\frac{T_i - T_{i-1}}{\\Delta x} \\right) \\Delta x = T_i + \\frac{1}{2} \\phi(r_i) (T_i - T_{i-1})\n$$\nThe problem provides the necessary data: $T_{i-1} = 300\\,\\text{K}$, $T_i = 330\\,\\text{K}$, and $T_{i+1} = 365\\,\\text{K}$.\n\nFirst, we calculate the dimensionless gradient ratio $r$ at cell $i$:\n$$\nr_i = \\frac{T_{i} - T_{i-1}}{T_{i+1} - T_{i}} = \\frac{330 - 300}{365 - 330} = \\frac{30}{35} = \\frac{6}{7}\n$$\nNext, we evaluate the van Albada flux limiter function $\\phi(r)$ with $r = 6/7$:\n$$\n\\phi(r) = \\frac{r^{2} + r}{1 + r^{2}} \\implies \\phi\\left(\\frac{6}{7}\\right) = \\frac{\\left(\\frac{6}{7}\\right)^{2} + \\frac{6}{7}}{1 + \\left(\\frac{6}{7}\\right)^{2}} = \\frac{\\frac{36}{49} + \\frac{42}{49}}{\\frac{49}{49} + \\frac{36}{49}} = \\frac{\\frac{78}{49}}{\\frac{85}{49}} = \\frac{78}{85}\n$$\nNow, we can compute the reconstructed interface temperature $T_{i+1/2}^{-}$:\n$$\nT_{i+1/2}^{-} = T_i + \\frac{1}{2} \\phi(r_i) (T_i - T_{i-1}) = 330 + \\frac{1}{2} \\left(\\frac{78}{85}\\right) (330 - 300)\n$$\n$$\nT_{i+1/2}^{-} = 330 + \\frac{1}{2} \\left(\\frac{78}{85}\\right) (30) = 330 + \\frac{1170}{85} = 330 + \\frac{234}{17}\n$$\nNumerically, this value is:\n$$\nT_{i+1/2}^{-} \\approx 330 + 13.76470588... = 343.76470588...\\,\\text{K}\n$$\nRounding to four significant figures as requested gives:\n$$\nT_{i+1/2}^{-} \\approx 343.8\\,\\text{K}\n$$\nTo interpret the effect of the limiter, we compare this result to the unlimited upwind-linear reconstruction, which corresponds to setting $\\phi(r)=1$. This represents a pure second-order fully upwind scheme.\n$$\nT_{i+1/2, \\text{unlim}}^{-} = T_i + \\frac{1}{2} (1) (T_i - T_{i-1}) = 330 + \\frac{1}{2} (30) = 330 + 15 = 345\\,\\text{K}\n$$\nThe corresponding numerical fluxes are calculated with $a = 0.25\\,\\text{m}\\,\\text{s}^{-1}$:\n$$\nF_{i+1/2, \\text{limited}} = a \\cdot T_{i+1/2}^{-} = 0.25 \\times \\left(330 + \\frac{1170}{85}\\right) \\approx 0.25 \\times 343.7647 = 85.94117...\\,\\text{W}\\,\\text{m}^{-2}\\text{ (if T is a proxy for enthalpy)}\n$$\n$$\nF_{i+1/2, \\text{unlim}} = a \\cdot T_{i+1/2, \\text{unlim}}^{-} = 0.25 \\times 345 = 86.25\\,\\text{W}\\,\\text{m}^{-2}\n$$\nThe first-order upwind scheme, known to be the most diffusive but non-oscillatory, would use $T_{i+1/2}^{-} = T_i = 330\\,\\text{K}$. Its flux would be $F_{i+1/2, \\text{1st}} = 0.25 \\times 330 = 82.5\\,\\text{W}\\,\\text{m}^{-2}$.\n\nThe value of the limiter is $\\phi(r_i) = 78/85 \\approx 0.9176$, which is less than $1$. This causes the reconstructed temperature $T_{i+1/2}^{-} \\approx 343.8\\,\\text{K}$ to be lower than the unlimited second-order value $T_{i+1/2, \\text{unlim}}^{-} = 345\\,\\text{K}$ and closer to the first-order value $T_{i+1/2, \\text{1st}}^{-} = 330\\,\\text{K}$.\n\nThis shift towards the first-order upwind result is the defining characteristic of adding numerical diffusion. High-order schemes can introduce non-physical oscillations (over- and undershoots) near sharp gradients. The flux limiter's role is to add just enough numerical diffusion to suppress these oscillations and enforce monotonicity (the TVD property), at the cost of slightly lower accuracy than the unlimited scheme in smooth regions.\n\nTherefore, the sign of the incremental numerical diffusion introduced by the limiter is positive (i.e., diffusion is added). The magnitude of this effect is reflected in the reduction of the reconstructed temperature and the corresponding convective flux. The flux is reduced from $F_{i+1/2, \\text{unlim}} = 86.25$ to $F_{i+1/2, \\text{limited}} \\approx 85.94$. The difference in flux, $\\Delta F = F_{i+1/2, \\text{unlim}} - F_{i+1/2, \\text{limited}}  0$, represents the dissipative correction applied by the limiter.\n$$\n\\Delta F = a \\frac{1}{2} (1 - \\phi(r_i)) (T_i - T_{i-1}) = 0.25 \\times \\frac{1}{2} \\left(1 - \\frac{78}{85}\\right) (30) = 0.25 \\times 15 \\times \\frac{7}{85} = \\frac{21}{68} \\approx 0.3088\n$$\nThis positive value confirms that the limiter acts to increase the scheme's dissipation relative to the unlimited second-order reconstruction.",
            "answer": "$$\n\\boxed{343.8}\n$$"
        },
        {
            "introduction": "After understanding the limiter's local mechanism, the next step is to build and test a complete simulation code. A key promise of high-resolution schemes is their ability to deliver second-order accuracy in smooth regions of the flow, offering significant improvements over first-order methods. This hands-on coding practice guides you through a standard grid refinement study to empirically verify this theoretical property. By implementing a flux-limited scheme for a smooth sine wave and measuring how the solution error decreases with grid spacing, you will confirm the scheme's convergence rate and develop crucial skills in computational code verification .",
            "id": "3955097",
            "problem": "A one-dimensional linear advection of a smooth scalar field is governed by the conservation law $\\partial_t u + \\partial_x (a u) = 0$ with constant positive advection speed $a$. Starting from the conservation law and the definition of a conservative finite-volume discretization on a uniform periodic grid over $[0,1]$ with $N$ cells of width $\\Delta x$, construct a high-resolution explicit update using a flux-limited upwind scheme with the van Leer flux limiter to advance the solution in time with a Courant–Friedrichs–Lewy (CFL) number $\\nu \\in (0,1]$. The van Leer limiter is defined, for slope ratio $r$, by $\\phi_{\\mathrm{VL}}(r) = \\dfrac{r + |r|}{1 + |r|}$. Use the standard upwind choice for $a  0$ in the numerical flux and enforce periodic boundary conditions exactly.\n\nThe physical and numerical setup is as follows:\n\n- Domain: $x \\in [0,1]$ in meters. Use periodic boundary conditions.\n- Advection speed: $a = 1\\,\\mathrm{m/s}$.\n- Initial condition: $u(x,0) = \\sin(2\\pi x)$.\n- Final time: $T = 1\\,\\mathrm{s}$, so that the exact solution at time $T$ is $u(x,T) = \\sin(2\\pi x)$.\n- Time step: choose $\\Delta t$ to satisfy $\\nu = a \\Delta t / \\Delta x$. Use $\\nu = 0.5$ so that $T/\\Delta t$ is an integer for all grids defined below.\n\nYou must:\n- Discretize the conservation law in conservative form with a finite-volume method, using a high-resolution upwind flux with the van Leer limiter for $a  0$. The limiter should be applied through the slope ratio $r_i$ built from consecutive one-sided differences and used to correct the interface flux at $x_{i+1/2}$. The method must be Total Variation Diminishing (TVD) in the sense of Godunov for $a  0$ by construction. Clearly implement periodicity to compute all required one-sided differences and interface fluxes.\n- Advance the solution from $t=0$ to $t=T$ with the chosen explicit time step such that $T/\\Delta t$ is an integer.\n- Compute the discrete $L^2$ error at $t=T$ defined by $E_2 = \\left(\\sum_{i=1}^{N} (u_i^{\\mathrm{num}} - u_i^{\\mathrm{exact}})^2 \\, \\Delta x \\right)^{1/2}$, where $u_i^{\\mathrm{exact}} = \\sin(2\\pi x_i)$ and $x_i$ is the center of cell $i$.\n- Perform a grid refinement study and estimate the observed order of accuracy $p$ between any two consecutive grids by $p = \\dfrac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(\\Delta x^{(1)}/\\Delta x^{(2)})}$.\n\nUse the following test suite of grid sizes (number of cells $N$):\n- Coarse: $N = 50$.\n- Medium: $N = 100$.\n- Fine: $N = 200$.\n- Very fine: $N = 400$.\n\nNumerical and physical units: distances must be in $\\mathrm{m}$, time in $\\mathrm{s}$, and speed in $\\mathrm{m/s}$. The $L^2$ errors and observed orders $p$ are unitless numbers. The initial condition amplitude and all constants must be used exactly as specified.\n\nYour program must:\n- For each $N$ in the test suite, compute the $L^2$ error $E_2$ at $t=T$ as a floating-point number.\n- Compute the three observed orders $p_{50\\to 100}$, $p_{100\\to 200}$, and $p_{200\\to 400}$ as floating-point numbers.\n- Return a final boolean indicating whether second-order accuracy is verified on the two finest refinements by the condition $p_{100\\to 200} \\ge 1.8$ and $p_{200\\to 400} \\ge 1.8$.\n\nFinal output format specification:\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets with the following entries in order: $[E_{50}, E_{100}, E_{200}, E_{400}, p_{50\\to 100}, p_{100\\to 200}, p_{200\\to 400}, \\text{verified}]$, where each $E_N$ and $p$ is a floating-point number and $\\text{verified}$ is a boolean. For example, an output might look like $[1.23e-04,3.08e-05,7.67e-06,1.91e-06,2.00,2.00,2.00,True]$.",
            "solution": "The problem requires the construction and application of a high-resolution, flux-limited finite-volume scheme to solve the one-dimensional linear advection equation. We will detail the derivation of the numerical method, its implementation, and the procedure for error analysis and order verification.\n\nThe governing partial differential equation (PDE) is the linear advection equation in conservation form:\n$$ \\partial_t u + \\partial_x (a u) = 0 $$\nwhere $u(x,t)$ is a scalar field, $t$ is time, $x$ is the spatial coordinate, and $a$ is the constant positive advection speed, given as $a=1\\,\\mathrm{m/s}$. The problem is posed on a one-dimensional periodic domain $x \\in [0,1]$.\n\nWe employ a finite-volume method on a uniform grid with $N$ cells. The domain $[0,1]$ is divided into cells $C_i = [x_{i-1/2}, x_{i+1/2}]$ of width $\\Delta x = 1/N$, for $i=0, 1, \\dots, N-1$. The cell center is $x_i = (i+0.5)\\Delta x$. Integrating the PDE over cell $C_i$ gives:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_t u \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_x (au) \\,dx = 0 $$\nUsing Leibniz's rule and the fundamental theorem of calculus, this becomes:\n$$ \\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u \\,dx + [au]_{x_{i+1/2}} - [au]_{x_{i-1/2}} = 0 $$\nWe define the cell-averaged quantity $u_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$. The equation for the evolution of the cell average is:\n$$ \\frac{d u_i}{dt} + \\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2}) = 0 $$\nHere, $F_{i \\pm 1/2}$ represents the numerical flux at the cell interfaces $x_{i \\pm 1/2}$, which approximates the physical flux $au$ at those locations.\n\nFor time discretization, we use an explicit forward Euler method. The fully discrete update formula is:\n$$ \\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{1}{\\Delta x} (F_{i+1/2}^n - F_{i-1/2}^n) = 0 $$\n$$ u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} (F_{i+1/2}^n - F_{i-1/2}^n) $$\nwhere $u_i^n$ is the approximation of the cell average in cell $i$ at time $t^n = n\\Delta t$. The term $\\frac{\\Delta t}{\\Delta x}$ is related to the Courant–Friedrichs–Lewy (CFL) number, $\\nu = \\frac{a \\Delta t}{\\Delta x}$. The update becomes:\n$$ u_i^{n+1} = u_i^n - \\frac{\\nu}{a} (F_{i+1/2}^n - F_{i-1/2}^n) $$\n\nTo achieve high resolution while maintaining stability (i.e., being Total Variation Diminishing, TVD), we construct the numerical flux $F_{i+1/2}$ as a combination of a low-resolution (first-order) flux and a limited high-resolution (anti-diffusive) correction. Since the advection speed $a$ is positive, information propagates from left to right, so we use an upwind-biased scheme.\n\nThe first-order upwind flux at interface $x_{i+1/2}$ is:\n$$ F_{i+1/2}^{\\text{1st}} = a u_i^n $$\nA common second-order scheme for this problem is the Lax-Wendroff scheme, whose flux (for $a0$) is:\n$$ F_{i+1/2}^{\\text{LW}} = a u_i^n + \\frac{a}{2}\\left(1 - \\frac{a\\Delta t}{\\Delta x}\\right)(u_{i+1}^n - u_i^n) = a u_i^n + \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe difference between the Lax-Wendroff flux and the first-order upwind flux is the anti-diffusive flux term, which is responsible for the higher accuracy but can introduce spurious oscillations near sharp gradients.\n$$ \\Phi_{i+1/2}^{\\text{AD}} = F_{i+1/2}^{\\text{LW}} - F_{i+1/2}^{\\text{1st}} = \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe high-resolution flux-limited scheme is constructed by adding a limited portion of this anti-diffusive flux to the first-order flux:\n$$ F_{i+1/2} = F_{i+1/2}^{\\text{1st}} + \\phi(r_{i+1/2}) \\Phi_{i+1/2}^{\\text{AD}} = a u_i^n + \\phi(r_{i+1/2}) \\frac{a(1-\\nu)}{2}(u_{i+1}^n - u_i^n) $$\nThe function $\\phi(r)$ is the flux limiter, and it depends on the slope ratio $r$. For an upwind-biased scheme with $a0$, the slope ratio for the flux at interface $x_{i+1/2}$ compares the gradient in the upwind cell ($i-1$) to the gradient in the local cell ($i$). It is defined as the ratio of consecutive cell-to-cell differences:\n$$ r_{i+1/2} = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n} $$\nThis ratio measures the local smoothness of the solution. The problem specifies the van Leer flux limiter:\n$$ \\phi_{\\mathrm{VL}}(r) = \\frac{r + |r|}{1 + |r|} $$\nIf the denominator $u_{i+1}^n - u_i^n$ is zero, $r_{i+1/2}$ is undefined. However, in this case, the anti-diffusive flux term $\\Phi_{i+1/2}^{\\text{AD}}$ is also zero, so the correction is null regardless of the limiter's value. We handle this case by setting the correction to zero.\n\nThe periodic boundary conditions mean that cell indices are treated modulo $N$. For example, the upwind neighbor of cell $i=0$ is cell $i=N-1$, and the downwind neighbor of cell $i=N-1$ is cell $i=0$. This is implemented efficiently using array rolling or modular arithmetic.\n\nThe overall algorithm for each time step is:\n1. For each cell $i=0, \\dots, N-1$, compute the slope ratio $r_{i+1/2}$ using values from cells $i-1$, $i$, and $i+1$ with periodic wrap-around.\n2. Compute the van Leer limiter $\\phi_{\\mathrm{VL}}(r_{i+1/2})$ for each interface.\n3. Compute the numerical flux $F_{i+1/2}$ for each interface $i=0, \\dots, N-1$.\n4. Compute the flux at the left interface of each cell, $F_{i-1/2}$, by shifting the array of right-interface fluxes.\n5. Update all cell averages $u_i^n$ to $u_i^{n+1}$ simultaneously.\n\nThis procedure is repeated for $N_t = T/\\Delta t$ time steps to reach the final time $T=1\\,\\mathrm{s}$. Given $a=1\\,\\mathrm{m/s}$, $\\nu=0.5$, and $\\Delta x = 1/N$, the time step is $\\Delta t = \\nu \\Delta x / a = 0.5/N$, and the number of steps is $N_t = T/\\Delta t = 1/(0.5/N) = 2N$, which is an integer.\n\nAfter the final time step, we compute the discrete $L^2$ error:\n$$ E_2 = \\left(\\sum_{i=0}^{N-1} (u_i^{\\text{num}} - u_i^{\\text{exact}})^2 \\, \\Delta x \\right)^{1/2} $$\nwhere $u_i^{\\text{num}}$ is the numerical solution in cell $i$ at time $T$, and $u_i^{\\text{exact}} = u(x_i, T)$. Since the wave speed is $a=1\\,\\mathrm{m/s}$ and the final time is $T=1\\,\\mathrm{s}$, the wave travels exactly one domain length, returning to its initial state due to periodicity. Thus, $u(x,T) = u(x-aT,0) = \\sin(2\\pi(x-1)) = \\sin(2\\pi x)$.\n\nFinally, we perform a grid refinement study using two consecutive grids with resolutions $N_1$ and $N_2$ (and corresponding mesh sizes $\\Delta x_1, \\Delta x_2$ and errors $E_2^{(1)}, E_2^{(2)}$). The observed order of accuracy $p$ is estimated as:\n$$ p = \\frac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(\\Delta x_1/\\Delta x_2)} $$\nFor our case where grids are doubled, $\\Delta x_1/\\Delta x_2 = 2$, so $p = \\frac{\\log(E_2^{(1)}/E_2^{(2)})}{\\log(2)}$. We expect $p \\approx 2$ for this scheme on a smooth solution, though limiters can reduce this slightly near extrema.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a flux-limited finite volume scheme\n    and performs a grid refinement study.\n    \"\"\"\n    \n    # --- Physical and Numerical Parameters ---\n    grid_sizes = [50, 100, 200, 400]\n    a = 1.0  # Advection speed in m/s\n    L = 1.0  # Domain length in m\n    T = 1.0  # Final time in s\n    nu = 0.5  # CFL number\n\n    l2_errors = []\n\n    for N in grid_sizes:\n        # --- Grid and Time Step Setup ---\n        dx = L / N\n        dt = nu * dx / a\n        num_steps = int(round(T / dt))\n\n        # --- Initial Condition ---\n        # Cell centers\n        x = (np.arange(N) + 0.5) * dx\n        u = np.sin(2 * np.pi * x)\n\n        # --- Time Integration Loop ---\n        for _ in range(num_steps):\n            # Enforce periodic boundary conditions by rolling the array\n            u_im1 = np.roll(u, 1)  # u_{i-1}\n            u_ip1 = np.roll(u, -1)  # u_{i+1}\n            \n            # --- Calculate Slope Ratio r ---\n            # r_{i+1/2} = (u_i - u_{i-1}) / (u_{i+1} - u_i)\n            # which is associated with the flux F_{i+1/2}\n            \n            # Numerator of r\n            num_r = u - u_im1\n            # Denominator of r\n            den_r = u_ip1 - u\n            \n            # Handle division by zero for r\n            r = np.zeros_like(u)\n            nonzero_den_mask = (den_r != 0)\n            r[nonzero_den_mask] = num_r[nonzero_den_mask] / den_r[nonzero_den_mask]\n            \n            # --- Calculate van Leer Flux Limiter phi ---\n            # phi(r) = (r + |r|) / (1 + |r|)\n            phi = (r + np.abs(r)) / (1.0 + np.abs(r))\n\n            # --- Calculate High-Resolution Flux F_{i+1/2} ---\n            # F_{i+1/2} = a*u_i + phi * a*(1-nu)/2 * (u_{i+1} - u_i)\n            \n            # First-order upwind flux\n            flux_low = a * u\n            \n            # Anti-diffusive correction term\n            flux_correction = phi * (a * (1 - nu) / 2.0) * den_r\n            \n            # High-resolution flux at the right cell interface (i+1/2)\n            F_iph = flux_low + flux_correction\n            \n            # Flux at the left cell interface (i-1/2) by rolling\n            F_imh = np.roll(F_iph, 1)\n            \n            # --- Update Solution ---\n            # u^{n+1} = u^n - (dt/dx) * (F_{i+1/2} - F_{i-1/2})\n            u = u - (dt / dx) * (F_iph - F_imh)\n\n        # --- Error Calculation ---\n        # Exact solution at t=T is the same as the initial condition\n        u_exact = np.sin(2 * np.pi * x)\n        \n        # L2-norm of the error\n        error = np.sqrt(np.sum((u - u_exact)**2) * dx)\n        l2_errors.append(error)\n\n    # --- Order of Accuracy Calculation ---\n    orders = []\n    for i in range(len(grid_sizes) - 1):\n        # p = log(E1/E2) / log(dx1/dx2)\n        # dx1/dx2 = 2 for grid doubling\n        order = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders.append(order)\n\n    # --- Verification of Second-Order Accuracy ---\n    # Condition: p = 1.8 on the two finest refinements\n    verified = (orders[1] = 1.8) and (orders[2] = 1.8)\n\n    # --- Final Output Formatting ---\n    results_list = l2_errors + orders + [verified]\n    # Example format: [1.23e-04,3.08e-05,7.67e-06,1.91e-06,2.00,2.00,2.00,True]\n    # We use a mix of general and scientific notation for floats to be clean\n    formatted_results = []\n    for item in results_list:\n        if isinstance(item, bool):\n            formatted_results.append(str(item))\n        else: # float\n            if abs(item)  1e-3 and item != 0:\n                 formatted_results.append(f\"{item:.6e}\")\n            else:\n                 formatted_results.append(f\"{item:.6f}\")\n    \n    print(f\"[{','.join(map(str, results_list))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While high-resolution schemes achieve second-order accuracy in smooth regions, their non-oscillatory behavior comes at a price. This final practice explores the fundamental trade-off between accuracy and stability by analyzing the scheme's performance at a local extremum, where the risk of oscillations is highest. Using Taylor series analysis, you will demonstrate how the flux limiter automatically detects the extremum and reduces the scheme's local accuracy to first order to prevent overshoots, a phenomenon often called \"clipping\". This theoretical exercise reveals the elegant compromise at the heart of flux-limiter design and explains why they are not uniformly second-order accurate .",
            "id": "3955136",
            "problem": "Consider the one-dimensional linear advection of temperature governed by the partial differential equation $T_{t} + a\\,T_{x} = 0$ with constant advection speed $a0$ on a uniform grid of spacing $\\Delta x$. Use a finite volume update $T_{i}'(t) = -\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x}$ with an upwind numerical flux $F_{i+1/2} = a\\,T^{L}_{i+1/2}$ for $a0$, where $T^{L}_{i+1/2}$ is a left-biased, piecewise linear reconstruction of $T$ at the face $x_{i+1/2}$ controlled by a flux limiter $\\phi(r)$ in a Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL)-type high-resolution scheme. Assume the Total Variation Diminishing (TVD) limiter satisfies $0 \\le \\phi(r) \\le 2$, $\\phi(1)=1$, and $\\phi(r)=0$ for $r \\le 0$. Let the reconstruction be\n$$\nT^{L}_{i+1/2} = T_{i} + \\frac{1}{2}\\,\\phi(r_{i})\\,\\Delta_{i},\\quad \\Delta_{i} := T_{i}-T_{i-1},\\quad r_{i} := \\frac{T_{i}-T_{i-1}}{T_{i+1}-T_{i}},\n$$\non a uniform grid with nodes $x_{i}=i\\,\\Delta x$. Suppose there is a smooth local extremum at cell $i^{\\ast}$, so that $T'(x_{i^{\\ast}})=0$ and $T''(x_{i^{\\ast}})\\neq 0$, with $T$ sufficiently smooth for a Taylor expansion. Starting from the governing equation and these definitions (no additional formulas are provided), perform a local Taylor expansion about $x_{i^{\\ast}}$ to determine the formal leading-order truncation error of the limited scheme in the neighborhood of the extremum, and compare it to the leading-order truncation error of the corresponding unlimited second-order reconstruction obtained by setting $\\phi \\equiv 1$. Explicitly relate the behavior to the deactivation of the second-order reconstruction when the smoothness ratio $r$ is near zero and, at the extremum, $r \\le 0$. Report the order-of-accuracy drop $p_{\\mathrm{drop}} := p_{\\mathrm{unlimited}} - p_{\\mathrm{limited}}$ as a single real number. No rounding is required; provide an exact integer without units.",
            "solution": "The task is to determine the local truncation error of a flux-limited high-resolution scheme for the one-dimensional linear advection equation, $T_{t} + a\\,T_{x} = 0$, in the vicinity of a smooth extremum. We will then compare this to the error of the corresponding unlimited scheme and find the order-of-accuracy drop. The semi-discrete finite volume scheme is given by $T_{i}'(t) = L(T)_i$, where $L(T)_i = -\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x}$ is the spatial operator. The truncation error is defined as $\\tau_{i} = L(T)_i - (-aT_{x})_i$, where $T(x,t)$ is the exact solution.\n\nFirst, we analyze the unlimited, second-order reconstruction. This is achieved by setting the flux limiter $\\phi(r) \\equiv 1$ for all values of $r$. The numerical flux at the cell face $x_{i+1/2}$ is $F_{i+1/2} = a\\,T^{L}_{i+1/2}$. The reconstructed temperature is $T^{L}_{i+1/2} = T_{i} + \\frac{1}{2}\\,\\phi(r_{i})\\,(T_{i}-T_{i-1})$.\nWith $\\phi(r_i)=1$, the reconstruction becomes:\n$$\nT^{L}_{i+1/2} = T_{i} + \\frac{1}{2}\\,(T_{i}-T_{i-1}) = \\frac{3}{2}T_i - \\frac{1}{2}T_{i-1}\n$$\nThe numerical flux is then $F_{i+1/2} = \\frac{a}{2}(3T_i - T_{i-1})$. The spatial operator for the unlimited scheme is:\n$$\nL(T)_i = -\\frac{1}{\\Delta x} \\left[ \\left(\\frac{a}{2}(3T_i - T_{i-1})\\right) - \\left(\\frac{a}{2}(3T_{i-1} - T_{i-2})\\right) \\right] = -\\frac{a}{2\\Delta x}(3T_i - 4T_{i-1} + T_{i-2})\n$$\nTo find the truncation error, we perform a Taylor series expansion of $T_{i-1}$ and $T_{i-2}$ around $x_i$:\n$$\nT_{i-1} = T(x_i - \\Delta x) = T_i - T'_i \\Delta x + \\frac{1}{2}T''_i \\Delta x^2 - \\frac{1}{6}T'''_i \\Delta x^3 + O(\\Delta x^4)\n$$\n$$\nT_{i-2} = T(x_i - 2\\Delta x) = T_i - 2T'_i \\Delta x + 2T''_i \\Delta x^2 - \\frac{4}{3}T'''_i \\Delta x^3 + O(\\Delta x^4)\n$$\nSubstituting these into the expression for $L(T)_i$:\n$$\nL(T)_i = -\\frac{a}{2\\Delta x} \\left[ 3T_i - 4\\left(T_i - T'_i \\Delta x + \\frac{1}{2}T''_i \\Delta x^2 - \\frac{1}{6}T'''_i \\Delta x^3 \\right) + \\left(T_i - 2T'_i \\Delta x + 2T''_i \\Delta x^2 - \\frac{4}{3}T'''_i \\Delta x^3 \\right) + O(\\Delta x^4) \\right]\n$$\n$$\nL(T)_i = -\\frac{a}{2\\Delta x} \\left[ (3-4+1)T_i + (4-2)T'_i \\Delta x + (-2+2)T''_i \\Delta x^2 + \\left(\\frac{4}{6}-\\frac{4}{3}\\right)T'''_i \\Delta x^3 + O(\\Delta x^4) \\right]\n$$\n$$\nL(T)_i = -\\frac{a}{2\\Delta x} \\left[ 2T'_i \\Delta x - \\frac{2}{3}T'''_i \\Delta x^3 + O(\\Delta x^4) \\right] = -aT'_i + \\frac{a}{3}T'''_i \\Delta x^2 + O(\\Delta x^3)\n$$\nThe exact differential operator is $-aT_x$. Thus, the truncation error for the unlimited scheme is:\n$$\n\\tau_i = L(T)_i - (-aT'_i) = \\left(-aT'_i + \\frac{a}{3}T'''_i \\Delta x^2 + \\dots \\right) - (-aT'_i) = \\frac{a}{3}T'''_i \\Delta x^2 + O(\\Delta x^3)\n$$\nThe leading-order error is proportional to $\\Delta x^2$, so the unlimited scheme is second-order accurate, $p_{\\mathrm{unlimited}} = 2$. This holds for any smooth solution, including at an extremum.\n\nNext, we analyze the flux-limited scheme at a smooth local extremum located at $x_{i^{\\ast}}$, where $T'(x_{i^{\\ast}})=0$ and $T''(x_{i^{\\ast}})\\neq 0$. The analysis focuses on the cell $i^{\\ast}$. The spatial operator at this cell is $L(T)_{i^{\\ast}} = -\\frac{1}{\\Delta x}(F_{i^{\\ast}+1/2} - F_{i^{\\ast}-1/2})$.\n\nWe must determine the values of the limiter $\\phi(r_{i^{\\ast}})$ and $\\phi(r_{i^{\\ast}-1})$. To do this, we expand the solution $T(x)$ in a Taylor series around $x_{i^{\\ast}}$:\n$$\nT(x) = T(x_{i^{\\ast}}) + \\frac{1}{2}T''(x_{i^{\\ast}})(x-x_{i^{\\ast}})^2 + \\frac{1}{6}T'''(x_{i^{\\ast}})(x-x_{i^{\\ast}})^3 + O((x-x_{i^{\\ast}})^4)\n$$\nThe values at neighboring grid points are:\n$$\nT_{i^{\\ast} \\pm 1} = T_{i^{\\ast}} + \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 \\pm \\frac{1}{6}T'''_{i^{\\ast}}\\Delta x^3 + O(\\Delta x^4)\n$$\n$$\nT_{i^{\\ast}-2} = T_{i^{\\ast}} + \\frac{1}{2}T''_{i^{\\ast}}( -2 \\Delta x)^2 + \\frac{1}{6}T'''_{i^{\\ast}}( -2 \\Delta x)^3 + O(\\Delta x^4) = T_{i^{\\ast}} + 2T''_{i^{\\ast}}\\Delta x^2 - \\frac{4}{3}T'''_{i^{\\ast}}\\Delta x^3 + O(\\Delta x^4)\n$$\nThe smoothness ratio at cell $i^{\\ast}$ is $r_{i^{\\ast}} = \\frac{T_{i^{\\ast}}-T_{i^{\\ast}-1}}{T_{i^{\\ast}+1}-T_{i^{\\ast}}}$.\nThe numerator is $T_{i^{\\ast}}-T_{i^{\\ast}-1} = -\\left( \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 - \\frac{1}{6}T'''_{i^{\\ast}}\\Delta x^3 + \\dots \\right)$.\nThe denominator is $T_{i^{\\ast}+1}-T_{i^{\\ast}} = \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + \\frac{1}{6}T'''_{i^{\\ast}}\\Delta x^3 + \\dots$.\n$$\nr_{i^{\\ast}} = \\frac{-\\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)}{\\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)} = -1 + O(\\Delta x)\n$$\nAs $\\Delta x \\to 0$, $r_{i^{\\ast}} \\to -1$. Since $r_{i^{\\ast}} \\le 0$, the limiter property $\\phi(r)=0$ for $r \\le 0$ is activated. Thus, $\\phi(r_{i^{\\ast}})=0$. This is the crucial mechanism by which TVD schemes prevent oscillations near extrema: they locally reduce to a more dissipative, lower-order scheme.\n\nWith $\\phi(r_{i^{\\ast}})=0$, the reconstruction for the flux $F_{i^{\\ast}+1/2}$ simplifies significantly:\n$$\nT^{L}_{i^{\\ast}+1/2} = T_{i^{\\ast}} + \\frac{1}{2}\\phi(r_{i^{\\ast}})(T_{i^{\\ast}}-T_{i^{\\ast}-1}) = T_{i^{\\ast}}\n$$\nThis is the reconstruction for the first-order upwind scheme. The flux is $F_{i^{\\ast}+1/2} = aT_{i^{\\ast}}$.\n\nNow we evaluate the flux $F_{i^{\\ast}-1/2} = a\\,T^{L}_{i^{\\ast}-1/2} = a(T_{i^{\\ast}-1} + \\frac{1}{2}\\phi(r_{i^{\\ast}-1})(T_{i^{\\ast}-1}-T_{i^{\\ast}-2}))$. We need the smoothness ratio $r_{i^{\\ast}-1}$:\n$$\nr_{i^{\\ast}-1} = \\frac{T_{i^{\\ast}-1}-T_{i^{\\ast}-2}}{T_{i^{\\ast}}-T_{i^{\\ast}-1}}\n$$\nUsing the Taylor expansions:\nNumerator: $T_{i^{\\ast}-1}-T_{i^{\\ast}-2} = (T_{i^{\\ast}} + \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + \\dots) - (T_{i^{\\ast}} + 2T''_{i^{\\ast}}\\Delta x^2 + \\dots) = -\\frac{3}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)$.\nDenominator: $T_{i^{\\ast}}-T_{i^{\\ast}-1} = -\\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)$.\n$$\nr_{i^{\\ast}-1} = \\frac{-\\frac{3}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)}{-\\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3)} = 3 + O(\\Delta x)\n$$\nAs $\\Delta x \\to 0$, $r_{i^{\\ast}-1} \\to 3$. The limiter function evaluates to a constant, $\\phi(r_{i^{\\ast}-1}) \\to \\phi(3)$. Let's denote this constant as $\\phi_3$.\n\nNow we assemble the spatial operator at $i^{\\ast}$:\n$$\nL(T)_{i^{\\ast}} = -\\frac{1}{\\Delta x} \\left[ F_{i^{\\ast}+1/2} - F_{i^{\\ast}-1/2} \\right] = -\\frac{a}{\\Delta x} \\left[ T_{i^{\\ast}} - \\left(T_{i^{\\ast}-1} + \\frac{1}{2}\\phi_3(T_{i^{\\ast}-1}-T_{i^{\\ast}-2})\\right) \\right]\n$$\nSubstitute the Taylor expansions around $x_{i^{\\ast}}$:\n$$\nL(T)_{i^{\\ast}} = -\\frac{a}{\\Delta x} \\left[ T_{i^{\\ast}} - \\left( \\left(T_{i^{\\ast}} + \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + \\dots \\right) + \\frac{1}{2}\\phi_3\\left(-\\frac{3}{2}T''_{i^{\\ast}}\\Delta x^2 + \\dots\\right) \\right) \\right]\n$$\n$$\nL(T)_{i^{\\ast}} = -\\frac{a}{\\Delta x} \\left[ T_{i^{\\ast}} - T_{i^{\\ast}} - \\frac{1}{2}T''_{i^{\\ast}}\\Delta x^2 + \\frac{3}{4}\\phi_3 T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3) \\right]\n$$\n$$\nL(T)_{i^{\\ast}} = -\\frac{a}{\\Delta x} \\left[ \\left(-\\frac{1}{2} + \\frac{3}{4}\\phi_3\\right) T''_{i^{\\ast}}\\Delta x^2 + O(\\Delta x^3) \\right] = a\\left(\\frac{1}{2} - \\frac{3}{4}\\phi_3\\right) T''_{i^{\\ast}}\\Delta x + O(\\Delta x^2)\n$$\nThe exact spatial derivative at the extremum is $(-aT_x)_{i^{\\ast}} = -aT'_{i^{\\ast}} = 0$. The truncation error is:\n$$\n\\tau_{i^{\\ast}} = L(T)_{i^{\\ast}} - 0 = a\\left(\\frac{1}{2} - \\frac{3}{4}\\phi_3\\right) T''_{i^{\\ast}}\\Delta x + O(\\Delta x^2)\n$$\nUnless the specific limiter used happens to have $\\phi(3) = 2/3$, this leading error term is non-zero. For standard limiters, this is not the case. The leading error term is proportional to $\\Delta x^1$. Therefore, the order of accuracy of the limited scheme at a smooth extremum is $p_{\\mathrm{limited}}=1$.\n\nIn summary:\n- The unlimited scheme has an order of accuracy $p_{\\mathrm{unlimited}} = 2$.\n- The limited scheme, due to the deactivation of the second-order term at the extremum ($\\phi(r_{i^{\\ast}})=0$), drops to a local order of accuracy $p_{\\mathrm{limited}} = 1$.\n\nThe order-of-accuracy drop is:\n$$\np_{\\mathrm{drop}} = p_{\\mathrm{unlimited}} - p_{\\mathrm{limited}} = 2 - 1 = 1\n$$",
            "answer": "$$\n\\boxed{1}\n$$"
        }
    ]
}