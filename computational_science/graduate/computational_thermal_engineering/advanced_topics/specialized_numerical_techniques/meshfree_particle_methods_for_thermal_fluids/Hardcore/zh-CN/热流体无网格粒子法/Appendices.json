{
    "hands_on_practices": [
        {
            "introduction": "在无网格粒子方法中，首要步骤是将连续的流体域离散化为一组粒子。本练习将引导你建立宏观物理量（如密度 $\\rho_0$）与离散化基本参数（如粒子间距 $\\Delta x$ 和邻居粒子数）之间的联系。通过这个基础计算 ，你将能更好地理解平滑长度 $h$ 如何决定一个粒子的相互作用范围和邻居数量，这是调节SPH模拟精度和计算成本的关键。",
            "id": "3969812",
            "problem": "考虑一个用于二维 ($2\\text{D}$) 光滑粒子流体动力学 (SPH) 热流体模拟的平面预处理步骤。使用质量为 $m$ 的相同粒子的均匀分布来离散化一个目标体积密度为 $\\rho_0$ 的等温不可压缩场。SPH 光滑长度 $h$ 是预设的，并选择了三次样条核函数，其紧支撐半径等于 $R_s = 2 h$。对于 $2\\text{D}$ 公式，通过考虑一个垂直于平面的单位厚度切片，将体积密度 $\\rho_0$ 解释为表面质量密度，因此有效表面质量密度为 $\\rho_0$。\n\n仅从密度和数密度的基本定义出发，并将分布视为边界效应可忽略的均匀分布，推导粒子间距 $\\Delta x$（假设使用方形晶格类比来估计间距）以及在 $2\\text{D}$ 核函数支撐域内的期望平均邻居数的表达式。以 $m$、$\\rho_0$ 和 $h$ 的闭式解析表达式形式给出最终答案，使用 $R_s = 2 h$。不要包含任何数值近似。期望平均邻居数应为位于给定粒子周围半径为 $R_s$ 的支撐圆盘内严格存在的不同粒子的平均数量（通过期望的方式从计数中排除中心粒子本身；不要用离散减法代替期望）。",
            "solution": "对问题陈述进行验证。\n\n### 第1步：提取已知条件\n-   **系统**：用于光滑粒子流体动力学 (SPH) 热流体模拟的平面、二维 ($2\\text{D}$) 预处理步骤。\n-   **场**：等温不可压缩，目标体积密度为 $\\rho_0$。\n-   **离散化**：相同粒子的均匀分布。\n-   **粒子质量**：$m$。\n-   **密度解释**：在 $2\\text{D}$ 中，体积密度 $\\rho_0$ 被视为有效表面质量密度。\n-   **SPH参数**：光滑长度为 $h$；核函数为三次样条。\n-   **核函数支撐**：紧支撐半径 $R_s = 2h$。\n-   **建模假设**：\n    1.  假设使用方形晶格类比来估计粒子间距 $\\Delta x$。\n    2.  边界效应被认为可以忽略不计。\n-   **目标**：\n    1.  推导粒子间距 $\\Delta x$ 的闭式解析表达式。\n    2.  推导在核函数支撐半径 $R_s$ 内的期望平均邻居数的闭式解析表达式。\n-   **邻居数定义**：位于给定粒子周围半径为 $R_s$ 的支撐圆盘内严格存在的不同粒子的平均数量，其中中心粒子通过期望的方式从计数中排除，而不是通过离散减法。\n-   **最终答案形式**：以 $m$、$\\rho_0$ 和 $h$ 表示的表达式。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于光滑粒子流体动力学 (SPH) 的公认原理，这是一种在计算热工和流体动力学中广泛使用的无网格方法。粒子质量 $m$、密度 $\\rho_0$、光滑长度 $h$ 和核函数支撐 $R_s$ 等概念在该领域是标准的。将体积密度解释为 $2\\text{D}$ 问题的表面密度是一种常见且有效的简化。\n-   **适定性**：该问题是适定的。它提供了一套充分的参数（$m$、$\\rho_0$、$h$）和清晰的建模假设（均匀分布、用于间距的方形晶格类比、可忽略的边界效应），以唯一确定所要求的两个量（$\\Delta x$ 和邻居数）。\n-   **客观性**：该问题以精确、客观和技术性的语言陈述，没有任何主观或非科学的主张。\n-   **完整性与一致性**：该问题是自洽的。所提供的信息是充分且一致的。关系式 $R_s = 2h$ 是明确的。邻居数的定义虽然措辞巧妙，但在统计力学和连续介质模型的背景下是可以解释的。没有矛盾之处。\n\n### 第3步：结论与行动\n该问题被判定为**有效**。这是计算物理领域一个标准的、适定的问题。将推导解答。\n\n### 解题推导\n该问题要求推导两个量：粒子间距 $\\Delta x$ 和期望平均邻居数。\n\n**1. 粒子间距 $\\Delta x$ 的推导**\n\n问题陈述，对于此 $2\\text{D}$ 分析，目标体积密度 $\\rho_0$ 应被解释为表面质量密度。表面质量密度定义为单位面积的质量。\n$$\n\\rho_0 = \\frac{\\text{质量}}{\\text{面积}}\n$$\n根据指示，我们假设使用方形晶格类比来估计粒子间距 $\\Delta x$。在一个均匀的方形晶格中，每个粒子可以被认为占据一个边长为 $\\Delta x$ 的方形单元。因此，与单个粒子关联的面积 $A_{\\text{particle}}$ 为：\n$$\nA_{\\text{particle}} = (\\Delta x)^2\n$$\n此区域内的质量是单个粒子的质量 $m$。将这些代入表面密度的定义中得到：\n$$\n\\rho_0 = \\frac{m}{A_{\\text{particle}}} = \\frac{m}{(\\Delta x)^2}\n$$\n我们现在可以重排这个方程来求解粒子间距 $\\Delta x$。\n$$\n(\\Delta x)^2 = \\frac{m}{\\rho_0}\n$$\n$$\n\\Delta x = \\sqrt{\\frac{m}{\\rho_0}}\n$$\n该表达式以粒子质量 $m$ 和目标表面密度 $\\rho_0$ 来表示粒子间距。\n\n**2. 期望平均邻居数的推导**\n\n第二个目标是求出单个粒子的期望平均邻居数。此计数包括中心粒子紧支撐半径 $R_s$ 内的所有其他粒子。\n\n首先，我们建立粒子数密度 $n$，即单位面积内的粒子数量。这与质量密度 $\\rho_0$ 和单个粒子的质量 $m$ 有关。\n$$\n\\rho_0 = n \\cdot m\n$$\n求解数密度 $n$，我们得到：\n$$\nn = \\frac{\\rho_0}{m}\n$$\n问题指明了均匀的粒子分布和可忽略的边界效应，这意味着我们可以将粒子场视为均匀连续介质。任何给定区域内的期望粒子数是数密度 $n$ 与该面积的乘积。\n\n支撐区域是一个半径为 $R_s$ 的圆盘。这个支撐圆盘的面积 $A_{\\text{support}}$ 是：\n$$\nA_{\\text{support}} = \\pi R_s^2\n$$\n问题给出了关系式 $R_s = 2h$，所以我们可以用 $h$ 来表示面积：\n$$\nA_{\\text support} = \\pi (2h)^2 = 4 \\pi h^2\n$$\n问题的关键部分是确定“期望平均邻居数”，其中中心粒子“通过期望的方式排除；不要用离散减法代替期望”。这种措辞引导我们使用基于连续介质的统计方法。位于位置 $\\mathbf{r}_i$ 的粒子的期望邻居数是*其他*粒子（$j \\neq i$）的数密度在支撐区域上的积分。\n\n假设一个粒子位于原点。在一个包含 $N$ 个粒子、总面积为 $A_{\\text{total}}$ 的大系统中，“其他”粒子的密度是 $n_{\\text{others}} = (N-1)/A_{\\text{total}}$。对于一个边界效应可忽略的系统（即，在热力学极限下，当 $N \\to \\infty$ 和 $A_{\\text{total}} \\to \\infty$ 使得 $N/A_{\\text{total}} \\to n$），其他粒子的密度与总粒子密度无法区分：\n$$\nn_{\\text{others}} = \\frac{N-1}{A_{\\text{total}}} = \\frac{N}{A_{\\text{total}}} - \\frac{1}{A_{\\text{total}}} \\approx n\n$$\n因此，期望邻居数 $N_{\\text{neigh}}$ 是这个数密度与支撐面积的乘积。这种方法通过考虑周围其他粒子场的密度，按照指示正确地“通过期望”排除了中心粒子。\n$$\nN_{\\text{neigh}} = n \\cdot A_{\\text{support}}\n$$\n从圆盘中的总期望粒子数中离散地减去 1（即 $n A_{\\text{support}} - 1$）将对应于有限尺寸或离散晶格的计数方法，而题目的措辞引导我们避免这种方法。\n\n代入 $n$ 和 $A_{\\text{support}}$ 的表达式：\n$$\nN_{\\text{neigh}} = \\left(\\frac{\\rho_0}{m}\\right) \\cdot (4 \\pi h^2)\n$$\n这给出了期望邻居数的最终表达式：\n$$\nN_{\\text{neigh}} = \\frac{4 \\pi \\rho_0 h^2}{m}\n$$\n所推导出的 $\\Delta x$ 和 $N_{\\text{neigh}}$ 的两个表达式均按要求以 $m$、$\\rho_0$ 和 $h$ 表示。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\sqrt{\\frac{m}{\\rho_0}}  \\frac{4 \\pi \\rho_0 h^2}{m} \\end{pmatrix}}$$"
        },
        {
            "introduction": "从静态的粒子设置转向动态模拟后，我们必须确保数值求解过程的稳定性。本练习聚焦于显式时间积分方案中一个至关重要的实际问题：时间步长的选择 。你将从第一性原理出发，推导并计算由声学-对流输运（CFL条件）、粘性扩散、热扩散以及体力加速度等不同物理过程所施加的稳定性约束，并最终确定一个安全的全局时间步长。",
            "id": "3969789",
            "problem": "我们使用弱可压缩光滑粒子流体动力学（SPH）离散化方法，在三维空间中模拟Boussinesq近似下的牛顿流体的浮力驱动热流。动量和总能量方程在时间上都使用单一时间步长进行显式推进。为了确保显式更新的稳定性，时间步长必须满足与动量方程中的双曲声-对流传播、动量和能量方程中的抛物线扩散以及对彻体力加速度的显式响应相关的约束。您的任务是从第一性原理推导出时间步长界限，并计算一个安全的时间步长。\n\n给定在均匀参考温度下的以下材料属性和数值参数：\n- 流体密度：$\\rho = 997 \\ \\mathrm{kg \\, m^{-3}}$。\n- 动力粘度：$\\mu = 8.9 \\times 10^{-4} \\ \\mathrm{Pa \\, s}$。\n- 导热系数：$k = 0.60 \\ \\mathrm{W \\, m^{-1} \\, K^{-1}}$。\n- 定压比热：$c_{p} = 4180 \\ \\mathrm{J \\, kg^{-1} \\, K^{-1}}$。\n- 热膨胀系数（用于Boussinesq浮力）：$\\beta = 2.07 \\times 10^{-4} \\ \\mathrm{K^{-1}}$。\n- 重力大小：$g = 9.81 \\ \\mathrm{m \\, s^{-2}}$。\n- 驱动浮力的施加温差：$\\Delta T = 8.0 \\ \\mathrm{K}$。\n\n无网格离散化使用各向同性光滑长度 $h = 1.0 \\times 10^{-2} \\ \\mathrm{m}$。当前步长期间解析的最大流速估计为 $|u|_{\\max} = 0.30 \\ \\mathrm{m \\, s^{-1}}$。使用弱可压缩闭合，人工声速为 $c_{0} = 25.0 \\ \\mathrm{m \\, s^{-1}}$。\n\n仅从质量、动量和能量守恒定律，Boussinesq形式的浮力，以及运动粘度和热扩散系数的定义出发，论证以下各项的显式稳定性限制的标度关系：\n- 动量方程中的双曲声-对流输运（Courant–Friedrichs–Lewy (CFL) 型界限）。\n- 动量方程中的粘性扩散。\n- 能量方程中的热扩散。\n- 对彻体力加速度的显式响应。\n\n使用以下与所选显式SPH算子和时间积分器相关的无量纲安全系数（由离散算子的线性稳定性分析独立确定）：$C_{\\mathrm{ac}} = 0.25$, $C_{\\nu} = 0.125$, $C_{\\alpha} = 0.125$, $C_{a} = 0.25$。通过取四个约束中的最小值来组合这些系数，以获得单个安全时间步长。清晰地数值计算每个界限，并指出哪个界限最具限制性。\n\n您必须使用的定义：\n- 运动粘度：$\\nu = \\mu / \\rho$。\n- 热扩散系数：$\\alpha = k / (\\rho c_{p})$。\n- Boussinesq近似下的浮力加速度大小：$a_{b} = g \\, \\beta \\, \\Delta T$。\n\n将安全时间步长报告为单个数字。将您的答案四舍五入到3位有效数字。以秒为单位表示最终时间步长。",
            "solution": "该问题是计算流体动力学中的一个适定问题，特别涉及无网格粒子方法显式时间积分方案的稳定性。它科学基础扎实、内容自洽且客观。所有需要的物理和数值参数都已提供。因此，我将进行完整解答。\n\n该问题要求推导四种不同时间步长约束的标度律，并随后进行数值评估，以确定一个安全的、统一的模拟时间步长 $\\Delta t$。\n\n首先，我们为每个约束建立理论基础。显式时间积分方案的稳定性受信息传播通过最小解析空间单元所需时间的限制。在SPH中，此特征长度尺度为光滑长度 $h$。\n\n1.  **双曲声-对流约束 ($\\Delta t_{\\mathrm{ac}}$)**\n    流体动量方程包含非定常加速度项 $\\frac{\\partial \\mathbf{u}}{\\partial t}$、对流加速度项 $(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}$ 和压力梯度项 $-\\frac{1}{\\rho}\\nabla p$。在弱可压缩SPH公式中，传递压力场变化的压力波以指定的人工声速 $c_0$ 传播。同时，信息（如动量、能量）随局部流体速度 $\\mathbf{u}$ 平流。这些是双曲输运现象。\n    显式方案的Courant–Friedrichs–Lewy (CFL) 条件规定，数值依赖域必须包含物理依赖域。这意味着信息粒子在单个时间步长 $\\Delta t$ 内的移动距离不能超过一个特征长度 $h$。信息传播的最大速度 $v_{\\text{char}}$ 是最大流速 $|u|_{\\max}$ 和声速 $c_0$ 的和。\n    因此，稳定性约束为：\n    $$ \\Delta t \\leq C \\frac{h}{v_{\\text{char}}} $$\n    代入特征速度和特定的安全系数 $C_{\\mathrm{ac}}$，我们得到标度关系：\n    $$ \\Delta t_{\\mathrm{ac}} = C_{\\mathrm{ac}} \\frac{h}{|u|_{\\max} + c_0} $$\n\n2.  **粘性扩散约束 ($\\Delta t_{\\nu}$)**\n    动量方程包含一个粘性扩散项 $\\nu \\nabla^2 \\mathbf{u}$，其中 $\\nu$ 是运动粘度。该项描述动量的扩散。这是一个抛物线过程。对于显式有限差分格式，扩散方程 $\\frac{\\partial \\phi}{\\partial t} = D \\frac{\\partial^2 \\phi}{\\partial x^2}$ 的稳定性要求 $\\Delta t \\leq C \\frac{(\\Delta x)^2}{2D}$。\n    通过类比，对于一个特征长度尺度为 $h$（代表最精细的空间分辨率）的多维问题，拉普拉斯算子标度为 $\\nabla^2 \\sim 1/h^2$。因此，动量扩散的稳定性约束由粘性效应传播通过长度 $h$ 的特征时间决定。此时间标度为 $h^2/\\nu$。因此，显式时间步长限制为：\n    $$ \\Delta t_{\\nu} = C_{\\nu} \\frac{h^2}{\\nu} $$\n    其中 $C_{\\nu}$ 是粘性算子的安全系数。\n\n3.  **热扩散约束 ($\\Delta t_{\\alpha}$)**\n    当总能量方程写成关于温度 $T$ 的形式时，它包含一个热扩散项 $\\alpha \\nabla^2 T$，其中 $\\alpha$ 是热扩散系数。该项描述热量的扩散，其数学形式与粘性扩散项相同。其 underlying 过程是抛物线型的。\n    遵循与粘性扩散相同的逻辑，热扩散通过长度 $h$ 的特征时间标度为 $h^2/\\alpha$。该项的显式方案稳定性要求时间步长受以下限制：\n    $$ \\Delta t_{\\alpha} = C_{\\alpha} \\frac{h^2}{\\alpha} $$\n    其中 $C_{\\alpha}$ 是相应的安全系数。\n\n4.  **彻体力加速度约束 ($\\Delta t_{a}$)**\n    动量方程包含一个彻体力项，在此情况下为单位质量的浮力 $\\mathbf{a}_b$。对于速度的显式更新 $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\, \\mathbf{a}_b^n$，大的加速度可能在单个时间步长内引起非物理的大速度变化，从而导致不稳定性。一个常见的稳定性约束确保由加速度在一个时间步长内引起的位移（其标度为 $\\frac{1}{2} a_b (\\Delta t)^2$）不会显著超过粒子分辨率 $h$。这导致形式为 $(\\Delta t)^2 \\propto h/a_b$ 的条件。\n    另一种观点是速度变化 $a_b \\Delta t$ 不应过大。在SPH中经常使用的界限就是基于这种推理得出的，其标度关系为：\n    $$ \\Delta t_{a} = C_{a} \\sqrt{\\frac{h}{|\\mathbf{a}_b|}} $$\n    其中 $|\\mathbf{a}_b|$ 是由彻体力引起的最大加速度的大小，$C_{a}$ 是相关的安全系数。\n\n在建立了标度律之后，我们进行数值计算。首先，我们根据给定数据计算必要的派生属性。\n\n运动粘度 $\\nu$ 定义为 $\\nu = \\mu / \\rho$：\n$$ \\nu = \\frac{8.9 \\times 10^{-4} \\ \\mathrm{Pa \\, s}}{997 \\ \\mathrm{kg \\, m^{-3}}} \\approx 8.9268 \\times 10^{-7} \\ \\mathrm{m^2 \\, s^{-1}} $$\n\n热扩散系数 $\\alpha$ 定义为 $\\alpha = k / (\\rho c_p)$：\n$$ \\alpha = \\frac{0.60 \\ \\mathrm{W \\, m^{-1} \\, K^{-1}}}{(997 \\ \\mathrm{kg \\, m^{-3}}) \\times (4180 \\ \\mathrm{J \\, kg^{-1} \\, K^{-1}})} \\approx 1.4397 \\times 10^{-7} \\ \\mathrm{m^2 \\, s^{-1}} $$\n\n在Boussinesq近似下，浮力加速度的大小 $a_b$ 为 $a_b = g \\, \\beta \\, \\Delta T$：\n$$ a_b = (9.81 \\ \\mathrm{m \\, s^{-2}}) \\times (2.07 \\times 10^{-4} \\ \\mathrm{K^{-1}}) \\times (8.0 \\ \\mathrm{K}) \\approx 0.01624 \\ \\mathrm{m \\, s^{-2}} $$\n\n现在我们使用提供的安全系数和数值参数计算四个时间步长界限：\n$h = 1.0 \\times 10^{-2} \\ \\mathrm{m}$， $|u|_{\\max} = 0.30 \\ \\mathrm{m \\, s^{-1}}$， $c_0 = 25.0 \\ \\mathrm{m \\, s^{-1}}$。\n$C_{\\mathrm{ac}} = 0.25$， $C_{\\nu} = 0.125$， $C_{\\alpha} = 0.125$， $C_{a} = 0.25$。\n\n- **声-对流界限：**\n$$ \\Delta t_{\\mathrm{ac}} = 0.25 \\times \\frac{1.0 \\times 10^{-2} \\ \\mathrm{m}}{0.30 \\ \\mathrm{m \\, s^{-1}} + 25.0 \\ \\mathrm{m \\, s^{-1}}} = \\frac{2.5 \\times 10^{-3}}{25.3} \\ \\mathrm{s} \\approx 9.881 \\times 10^{-5} \\ \\mathrm{s} $$\n\n- **粘性扩散界限：**\n$$ \\Delta t_{\\nu} = 0.125 \\times \\frac{(1.0 \\times 10^{-2} \\ \\mathrm{m})^2}{8.9268 \\times 10^{-7} \\ \\mathrm{m^2 \\, s^{-1}}} = \\frac{1.25 \\times 10^{-5}}{8.9268 \\times 10^{-7}} \\ \\mathrm{s} \\approx 14.00 \\ \\mathrm{s} $$\n\n- **热扩散界限：**\n$$ \\Delta t_{\\alpha} = 0.125 \\times \\frac{(1.0 \\times 10^{-2} \\ \\mathrm{m})^2}{1.4397 \\times 10^{-7} \\ \\mathrm{m^2 \\, s^{-1}}} = \\frac{1.25 \\times 10^{-5}}{1.4397 \\times 10^{-7}} \\ \\mathrm{s} \\approx 86.82 \\ \\mathrm{s} $$\n\n- **彻体力加速度界限：**\n$$ \\Delta t_{a} = 0.25 \\times \\sqrt{\\frac{1.0 \\times 10^{-2} \\ \\mathrm{m}}{0.01624 \\ \\mathrm{m \\, s^{-2}}}} \\approx 0.25 \\times \\sqrt{0.6157} \\ \\mathrm{s} \\approx 0.1962 \\ \\mathrm{s} $$\n\n显式方案的总体安全时间步长 $\\Delta t$ 必须同时满足所有四个约束。因此，我们必须取这些值的最小值：\n$$ \\Delta t = \\min(\\Delta t_{\\mathrm{ac}}, \\Delta t_{\\nu}, \\Delta t_{\\alpha}, \\Delta t_{a}) $$\n$$ \\Delta t = \\min(9.881 \\times 10^{-5}, 14.00, 86.82, 0.1962) \\ \\mathrm{s} $$\n$$ \\Delta t = 9.881 \\times 10^{-5} \\ \\mathrm{s} $$\n最具限制性的约束是双曲声-对流 (CFL) 限制，它比其他约束小几个数量级。这对于弱可压缩SPH模拟是典型的，因为其中人工声速 $c_0$ 相对于流体速度较高，但长度尺度 $h$ 较小。\n\n问题要求将最终答案四舍五入到3位有效数字。\n$$ \\Delta t \\approx 9.88 \\times 10^{-5} \\ \\mathrm{s} $$",
            "answer": "$$ \\boxed{9.88 \\times 10^{-5}} $$"
        },
        {
            "introduction": "在确保模拟的稳定运行之后，计算效率成为下一个关键考量。在SPH等粒子方法中，邻居粒子搜索通常是每个时间步中最耗时的部分。本练习旨在探讨如何优化这一核心算法 ，通过对比分析两种经典的空间索引结构（kd-tree和均匀网格）在一个非均匀粒子分布场景下的性能，你将深入理解算法选择如何受到粒子分布、硬件架构（CPU与GPU）以及渐近复杂性等因素的综合影响。",
            "id": "3969811",
            "problem": "在一次使用光滑粒子流体动力学 (SPH) 对粘性导热流体进行的三维 ($3$D) 无网格粒子模拟中，每个时间步都需要进行邻域搜索，以在紧支半径内评估对流和扩散相互作用。粒子分布高度非均匀：$N = 10^6$ 个粒子中的一部分（比例为 $f_{\\mathrm{dense}} = 98\\%$）位于一个密集的丝状结构中，该结构约占域体积的 $1\\%$，而剩余部分（比例为 $f_{\\mathrm{sparse}} = 2\\%$）则散布在其余区域。局部光滑长度相差一个数量级，使得 $h_{\\max} \\approx 10\\, h_{\\min}$，并且每个粒子 $i$ 在半径 $r_i = \\kappa h_i$ 内查询邻居，其中 $\\kappa  0$ 是一个固定常数。在连续的时间步之间，Courant–Friedrichs–Lewy (CFL) 条件确保粒子位移满足 $\\Delta x_i \\le \\beta h_i$（其中 $\\beta \\in (0,1)$），并且通过标准的 SPH 校准，支撑域内的目标平均邻居数保持为 $O(1)$。\n\n每个时间步考虑两种空间索引策略：\n(i) 在当前粒子位置上重建一个平衡 k 维树 (kd-tree)，然后对每个粒子进行半径搜索；\n(ii) 一个单分辨率均匀网格（单元尺寸为 $c \\approx h_{\\min}$ 或 $c \\approx h_{\\max}$），通过将粒子分箱或哈希到单元中来构建，然后进行邻域查询，查询范围限制在相邻单元的固定模板内。\n\n从基本的算法定义和几何计数论证出发，比较这些策略在所述非均匀分布下的表现。评估它们关于 $N$ 和光滑长度比 $\\rho \\equiv h_{\\max}/h_{\\min}$ 的渐近行为，以及包括内存访问模式、在中央处理器 (CPU) 和图形处理器 (GPU) 上的重建成本在内的实际性能考量。\n\n在此背景下，选择所有正确的陈述。\n\nA. 对于所述的具有可变 $h_i$ 的非均匀分布，一个每步重建成本为 $O(N \\log N)$、每次查询的半径搜索成本为 $O(\\log N + k_i)$ 的平衡 kd-树，在渐近意义上优于调整为 $c \\approx h_{\\min}$ 或 $c \\approx h_{\\max}$ 的单分辨率均匀网格，因为该网格要么在密集丝状结构中产生高桶占用率，要么在稀疏区域产生与 $\\rho^d$ 成正比的大单元模板；因此，在 CPU 上，尽管 kd-树的常数因子更高，但对于大的 $N$ 来说，它是一个更安全的选择。\n\nB. 选择单元尺寸为 $c \\approx h_{\\max}$ 的均匀网格可保证每次查询的工作量为 $O(1)$，且与聚类和维度 $d$ 无关，因为每次查询最多检查 $3^d$ 个单元，且每个单元包含 $O(1)$ 个粒子；因此，在这种情况下，它在渐近和实践意义上都是最优的。\n\nC. 如果使用单元尺寸为 $c \\approx h_{\\min}$ 的单分辨率均匀网格，稀疏粒子查询必须访问的单元数量会以 $O(\\rho^d)$ 的形式增长，当 $\\rho \\gg 1$ 时，这部分成本相对于 kd-树可能会占主导地位；因此，在分辨率比 $\\rho$ 上渐近地（对于固定的 $N$），kd-树在这种情况下优于此类均匀网格。\n\nD. 在现代 GPU 上，尽管 kd-树对于聚类的非均匀数据具有良好的渐近性，但分支发散和不规则内存访问通常使其比通过键值排序在 $O(N)$ 时间内每步重建的均匀网格更慢；因此，在实践中，即使对于高度非均匀的数据，带有空间哈希和莫顿排序的均匀网格也可能胜过 kd-树，前提是通过局部自适应或分层网格将核函数支撑限制在单元尺寸的常数倍以内。",
            "solution": "我们从与邻域搜索相关的基础算法属性和几何计数论证开始。\n\n一个在 $N$ 个点上构建的平衡 k 维树 (kd-tree) 支持范围（半径）查询，每次查询的最坏情况时间为 $O(\\log N + k)$，其中 $k$ 是报告的邻居数量，并且该树可以在 $O(N \\log N)$ 时间内构建。在像光滑粒子流体动力学 (SPH) 这样的无网格粒子方法中，每个粒子 $i$ 在紧支半径 $r_i = \\kappa h_i$ 内的邻居数 $k_i$ 通常通过将光滑长度 $h_i$ 校准到局部粒子间距来控制为 $O(1)$，因此我们在解析良好的区域将 $k_i = O(1)$ 处理。因此，每步 kd-tree 邻域搜索的成本为重建的 $O(N \\log N)$ 加上 $O(N \\log N + \\sum_i k_i) = O(N \\log N + N)$，总计为 $O(N \\log N)$，其常数受维度 $d$ 和树的平衡性影响。\n\n一个单元尺寸为 $c$ 的单分辨率均匀网格通过检查包含半径为 $r_i$ 的支撑球体的固定单元模板来支持邻域查询。如果 $c \\approx h_i$ 是一致的且分布是均匀的，那么每个模板覆盖 $O(1)$ 个单元，每个单元包含 $O(1)$ 个粒子，从而每次查询的成本为 $O(1)$，每步的成本为 $O(N)$（不包括重建）。然而，对于非均匀分布和可变光滑长度，单一的 $c$ 无法匹配所有的 $h_i$，这导致两种主要的失效模式：\n\n1. 如果 $c \\approx h_{\\max}$（大单元），那么在 $h_i \\approx h_{\\min}$ 的密集区域，每个单元的粒子数量与单元体积和局部粒子体积之比成比例。在 $d$ 维空间中，占用率大约放大了 $(h_{\\max}/h_{\\min})^d = \\rho^d$ 倍。因为 $f_{\\mathrm{dense}} N$ 个粒子占据了域的一小部分，与密集丝状结构相交的单元将比均匀情况下多包含 $\\Theta(\\rho^d)$ 倍的粒子。由于每次查询必须检查 $O(1)$ 个单元（例如 $3^d$），但现在每个单元包含 $\\Theta(\\rho^d)$ 个粒子，因此在这些区域，朴素扫描的每次查询工作量变为 $\\Theta(\\rho^d)$。对于 $\\rho = 10$ 和 $d = 3$，这是一个 $\\Theta(10^3)$ 的额外因子，相当可观。\n\n2. 如果 $c \\approx h_{\\min}$（小单元），那么在 $h_i \\approx h_{\\max}$ 的稀疏区域，与支撑球体相交的单元数量会随着体积比增长，大约为 $(r_i/c)^d = \\Theta((h_{\\max}/h_{\\min})^d) = \\Theta(\\rho^d)$ 个单元。许多这样的单元是空的，但算法为了确保完整性仍必须枚举它们，因此每次查询的开销会以 $\\Theta(\\rho^d)$ 的形式增长，且与 $N$ 无关。尽管这种依赖性不是 $O(N)$，但对于 $\\rho \\gg 1$ 的情况，它可能在实际运行时间中占主导地位。\n\n这些效应纯粹是几何上的，源于单一网格尺度 $c$ 与 $h_i$ 的多尺度分布不匹配。相比之下，kd-树会根据局部密度调整分区大小，使半径搜索期间检查的节点数接近 $O(\\log N)$ 加上真实的邻居数 $O(1)$，且与 $\\rho$ 无关。\n\n我们还考虑重建/更新成本和硬件。每步重建的 kd-树具有 $O(N \\log N)$ 的成本，常数相对较高且内存访问不规则，这可能对缓存不友好并导致分支预测错误，尤其是在图形处理器 (GPU) 上，其线程束发散问题严重。通过对粒子到单元索引进行键值排序（例如，使用莫顿排序），均匀网格可以在 $O(N)$ 时间内重建，具有出色的内存合并和并行可扩展性，这通常在 GPU 上产生更短的挂钟时间，即使理论上的每次查询工作量更大，前提是基于网格的方法在实践中使用一种策略将搜索模板限制为每次查询 $O(1)$。在非均匀设置中实现这一界限通常需要局部自适应（例如，像八叉树这样的分层网格）或相对于单元尺寸限制有效支撑域，以确保高 $h_i$ 的粒子不需要扫描 $\\Theta(\\rho^d)$ 个单元。\n\n我们现在分析每个选项。\n\n选项 A：它声称，对于跨越一个数量级的可变 $h_i$，一个重建成本为 $O(N \\log N)$、每次查询成本为 $O(\\log N + k_i)$ 的平衡 kd-树，在渐近意义上优于 $c \\approx h_{\\min}$ 或 $c \\approx h_{\\max}$ 的单分辨率网格，因为后者要么有高占用率，要么有与 $\\rho^d$ 成正比的大模板。并且在 CPU 上，对于大的 $N$，kd-树是一个更安全的选择。其渐近推理源于几何论证：对于单分辨率网格，占用率或模板大小均以 $\\Theta(\\rho^d)$ 的形式扩展，而 kd-树的搜索不以同样的方式依赖于 $\\rho$。在 CPU 上，kd-树在高度非均匀数据上通常优于单分辨率网格，因为 kd-树减少了在密集单元和大型模板中的无效扫描。该陈述正确地抓住了渐近和实际 CPU 的考量。结论：正确。\n\n选项 B：它断言 $c \\approx h_{\\max}$ 保证了每次查询的工作量为 $O(1)$，且与聚类和维度无关，因为只检查 $3^d$ 个单元，且每个单元包含 $O(1)$ 个粒子。其缺陷在于“每个单元包含 $O(1)$ 个粒子”这一假设：在密集丝状结构中，大单元包含许多粒子，占用率以 $\\Theta(\\rho^d)$ 的形式扩展，因此在密集区域每次查询的成本不是 $O(1)$，而至少是 $\\Theta(\\rho^d)$。因此，它在这种情况下既不是渐近最优也不是实践最优的。结论：不正确。\n\n选项 C：它指出，当 $c \\approx h_{\\min}$ 时，稀疏粒子查询访问的单元数量以 $O(\\rho^d)$ 的形式增长，当 $\\rho \\gg 1$ 时，这部分成本相对于 kd-树可能占主导地位，因此在 $\\rho$ 的渐近意义上（对于固定的 $N$），kd-树优于此类均匀网格。这与几何模板的论证相符：每次查询的开销随 $\\rho^d$ 扩展，而 kd-树的成本不以这种方式依赖于 $\\rho$，因此对于大的 $\\rho$，kd-树在关于 $\\rho$ 的渐近意义上是优越的。“对于固定的 $N$”这一限定在对比参数依赖性时是恰当的。结论：正确。\n\n选项 D：它认为，在 GPU 上，kd-树的不规则控制流和内存访问会使其比通过排序在 $O(N)$ 时间内每步重建的均匀网格更慢，并且在实践中，即使对于高度非均匀的数据，带有空间哈希和莫顿排序的均匀网格也可能胜过 kd-树，前提是通过局部自适应或分层网格将核函数支撑限制在单元尺寸的常数倍以内。这反映了广泛观察到的实际行为：kd-树在 GPU 上受到线程束发散和不良内存合并的影响，而基于网格并使用排序键的方法可实现高吞吐量。关于局部自适应或分层网格的附带条件是必要的，以避免在非均匀情况下出现 $\\Theta(\\rho^d)$ 的模板爆炸，从而恢复有效的 $O(1)$ 每次查询工作量。因此，作为一个以在“均匀网格”家族中采用自适应网格策略（例如，哈希的、莫顿排序的桶加上层次结构）为条件的实践陈述，它是正确的。结论：正确。",
            "answer": "$$\\boxed{ACD}$$"
        }
    ]
}