{
    "hands_on_practices": [
        {
            "introduction": "在光子蒙特卡洛模拟中，准确模拟光子与介质相互作用后的散射方向至关重要。虽然各向同性散射在教学中很常见，但真实物理系统中的散射过程通常是各向异性的，由复杂的概率分布函数描述。本练习  将引导你推导接受-拒绝采样法的效率，并将其应用于一个具有物理意义的各向异性散射相函数。掌握这项技术是构建精确蒙特卡洛辐射传输（MCRT）代码的基础步骤，它确保了模拟中的光子行为能够忠实地反映底层物理过程。",
            "id": "3978788",
            "problem": "考虑一个在具有各向异性散射的参与介质中，使用蒙特卡洛辐射传输（MCRT）方法进行的光子输运模拟。您希望使用接受-拒绝采样法从定义在域 $D$ 上的目标角度分布中进行抽样。设非负目标函数为定义在 $D$ 上的 $f(x)$，其积分为有限值 $\\int_{D} f(x)\\,dx$。设包络函数构造为 $h(x) = M\\,g(x)$，其中 $g(x)$ 是一个归一化的建议概率密度函数（PDF），满足 $\\int_{D} g(x)\\,dx = 1$，且 $M \\geq \\sup_{x \\in D} \\frac{f(x)}{g(x)}$ 确保对于所有 $x \\in D$ 都有 $h(x) \\geq f(x)$。在接受-拒绝采样法中，一个样本 $X \\sim g$ 会以概率 $\\frac{f(X)}{h(X)}$ 被接受，这需要使用一个独立于 $X$ 的辅助变量 $U \\sim \\mathrm{Uniform}(0,1)$。从这些定义出发，推导平均接受概率（效率）$\\eta$，将其表示为目标积分 $\\int_{D} f(x)\\,dx$ 与包络积分 $\\int_{D} h(x)\\,dx$ 的比值。\n\n然后，将您的结果应用于对一个非平凡的方位角对称各向异性散射分布进行抽样\n$$\np(\\mu) = \\frac{\\beta}{2\\,\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu), \\quad \\mu \\in [-1,1],\n$$\n其中 $\\mu = \\cos(\\theta)$，$\\theta$ 是以弧度为单位的极向散射角，$\\beta > 0$ 是给定的各向异性参数。在 $[-1,1]$ 上使用均匀建议分布 $g(\\mu) = \\frac{1}{2}$，并选择最小常数 $M$ 使得对于所有 $\\mu \\in [-1,1]$ 都有 $p(\\mu) \\leq M\\,g(\\mu)$。计算当 $\\beta = 3$ 时，由此产生的接受-拒绝采样效率 $\\eta$。将效率表示为无量纲的小数，并将您的答案四舍五入到五位有效数字。此外，写出针对此情况的接受规则 $U \\leq \\frac{p(\\mu)}{M\\,g(\\mu)}$，但您最终报告的量必须仅为效率值。",
            "solution": "该问题被验证为具有科学依据、问题明确、客观且完整。这是一个计算统计学和物理学中的标准问题，可以被严格求解。\n\n解答分为两部分。首先，我们推导接受-拒绝采样法效率的一般表达式。其次，我们将此结果应用于各向异性散射分布的特定情况。\n\n第一部分：效率的一般推导\n\n接受-拒绝采样法旨在从域 $D$ 上密度为 $f(x)$ 的目标分布中抽取样本。我们使用定义在同一域上的一个更简单的建议概率密度函数（PDF）$g(x)$，其满足 $\\int_{D} g(x)\\,dx = 1$。构造一个包络函数 $h(x) = M\\,g(x)$，使得对于所有 $x \\in D$ 都有 $h(x) \\geq f(x)$。常数 $M$ 的选择要至少等于比率 $f(x)/g(x)$ 的上确界，即 $M \\geq \\sup_{x \\in D} \\frac{f(x)}{g(x)}$。\n\n抽样算法按以下步骤进行：\n1. 从建议分布中抽取一个候选样本，我们将其表示为随机变量 $X$，因此其PDF为 $g(x)$。\n2. 从区间 $[0, 1]$ 上的均匀分布中抽取一个辅助随机变量 $U$，即 $U \\sim \\mathrm{Uniform}(0,1)$。\n3. 如果满足条件 $U \\leq \\frac{f(X)}{h(X)}$，则接受候选样本 $X$。\n\n在给定特定值 $X=x$ 的情况下，接受一个候选样本的概率是条件概率 $P(\\text{accept}|X=x)$。由于 $U$ 在 $[0,1]$ 上是均匀分布的，这个概率等于不等式的上界值：\n$$\nP(\\text{accept}|X=x) = P\\left(U \\leq \\frac{f(x)}{h(x)}\\right) = \\frac{f(x)}{h(x)}\n$$\n条件 $M \\geq \\sup_{x \\in D} \\frac{f(x)}{g(x)}$ 意味着 $M\\,g(x) \\geq f(x)$，因此 $h(x) \\geq f(x)$，这确保了比率 $\\frac{f(x)}{h(x)}$ 始终在区间 $[0, 1]$ 内。\n\n总接受概率，或称效率 $\\eta$，是这个条件概率在 $X$ 的所有可能值上的平均值。为了求得此平均值，我们计算 $P(\\text{accept}|X)$ 关于 $X$ 的分布 $g(x)$ 的期望。\n$$\n\\eta = E[P(\\text{accept}|X)] = \\int_{D} P(\\text{accept}|X=x) \\, g(x) \\, dx\n$$\n代入条件概率的表达式，我们得到：\n$$\n\\eta = \\int_{D} \\frac{f(x)}{h(x)} \\, g(x) \\, dx\n$$\n现在，我们代入包络函数的定义 $h(x) = M\\,g(x)$：\n$$\n\\eta = \\int_{D} \\frac{f(x)}{M\\,g(x)} \\, g(x) \\, dx = \\int_{D} \\frac{f(x)}{M} \\, dx\n$$\n由于 $M$ 是一个常数，可以将其移到积分符号外：\n$$\n\\eta = \\frac{1}{M} \\int_{D} f(x) \\, dx\n$$\n包络函数 $h(x)$ 在域 $D$ 上的积分是：\n$$\n\\int_{D} h(x) \\, dx = \\int_{D} M \\, g(x) \\, dx = M \\int_{D} g(x) \\, dx\n$$\n由于 $g(x)$ 是一个归一化的PDF，$\\int_{D} g(x) \\, dx = 1$。因此，$\\int_{D} h(x) \\, dx = M$。\n将 $M = \\int_{D} h(x) \\, dx$ 代入 $\\eta$ 的表达式，我们得到最终的一般结果：\n$$\n\\eta = \\frac{\\int_{D} f(x) \\, dx}{\\int_{D} h(x) \\, dx}\n$$\n这表明效率是目标函数下方“面积”与包络函数下方“面积”的比值。\n\n第二部分：应用于各向异性散射\n\n我们现在将此结果应用于指定的问题。目标函数是散射PDF $p(\\mu)$，建议分布是均匀PDF $g(\\mu)$。\n目标函数：$f(\\mu) \\equiv p(\\mu) = \\frac{\\beta}{2\\,\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu)$，对于 $\\mu \\in [-1,1]$。\n建议PDF：$g(\\mu) = \\frac{1}{2}$，对于 $\\mu \\in [-1,1]$。\n\n目标函数的积分是 $\\int_{-1}^{1} p(\\mu) \\, d\\mu$。由于 $p(\\mu)$ 是一个给定的PDF，我们知道它在其定义域上的积分为1：\n$$\n\\int_{-1}^{1} p(\\mu) \\, d\\mu = \\int_{-1}^{1} \\frac{\\beta}{2\\,\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu) \\, d\\mu = \\frac{\\beta}{2\\,\\sinh(\\beta)} \\left[ \\frac{\\exp(\\beta\\mu)}{\\beta} \\right]_{-1}^{1} = \\frac{\\exp(\\beta) - \\exp(-\\beta)}{2\\,\\sinh(\\beta)} = \\frac{2\\,\\sinh(\\beta)}{2\\,\\sinh(\\beta)} = 1\n$$\n因此，我们效率公式中的分子是 $\\int_{-1}^{1} p(\\mu) \\, d\\mu = 1$。\n\n接下来，我们必须找到最小常数 $M$ 使得对于所有 $\\mu \\in [-1,1]$ 都有 $p(\\mu) \\leq M\\,g(\\mu)$。这个最小的 $M$ 是比率 $p(\\mu)/g(\\mu)$ 的上确界：\n$$\nM = \\sup_{\\mu \\in [-1,1]} \\frac{p(\\mu)}{g(\\mu)} = \\sup_{\\mu \\in [-1,1]} \\frac{\\frac{\\beta}{2\\,\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu)}{\\frac{1}{2}} = \\sup_{\\mu \\in [-1,1]} \\frac{\\beta}{\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu)\n$$\n因为 $\\beta > 0$，函数 $\\exp(\\beta\\mu)$ 是关于 $\\mu$ 单调递增的。因此，它在区间 $[-1,1]$ 上的上确界出现在 $\\mu = 1$ 处。\n$$\nM = \\frac{\\beta}{\\sinh(\\beta)}\\,\\exp(\\beta \\cdot 1) = \\frac{\\beta\\,\\exp(\\beta)}{\\sinh(\\beta)}\n$$\n现在可以使用我们推导出的公式计算效率 $\\eta$：\n$$\n\\eta = \\frac{\\int_{-1}^{1} p(\\mu) \\, d\\mu}{M} = \\frac{1}{M} = \\frac{1}{\\frac{\\beta\\,\\exp(\\beta)}{\\sinh(\\beta)}} = \\frac{\\sinh(\\beta)}{\\beta\\,\\exp(\\beta)}\n$$\n为简化起见，我们使用定义 $\\sinh(\\beta) = \\frac{\\exp(\\beta) - \\exp(-\\beta)}{2}$：\n$$\n\\eta = \\frac{\\frac{\\exp(\\beta) - \\exp(-\\beta)}{2}}{\\beta\\,\\exp(\\beta)} = \\frac{\\exp(\\beta) - \\exp(-\\beta)}{2\\beta\\,\\exp(\\beta)} = \\frac{1}{2\\beta} \\left( \\frac{\\exp(\\beta)}{\\exp(\\beta)} - \\frac{\\exp(-\\beta)}{\\exp(\\beta)} \\right) = \\frac{1}{2\\beta} (1 - \\exp(-2\\beta))\n$$\n问题指定 $\\beta = 3$。代入这个值：\n$$\n\\eta = \\frac{1}{2(3)} (1 - \\exp(-2 \\cdot 3)) = \\frac{1}{6} (1 - \\exp(-6))\n$$\n我们现在计算数值：\n$\\exp(-6) \\approx 0.00247875217$\n$1 - \\exp(-6) \\approx 0.99752124783$\n$\\eta \\approx \\frac{0.99752124783}{6} \\approx 0.1662535413$\n\n将结果四舍五入到五位有效数字，得到 $\\eta \\approx 0.16625$。\n\n最后，专门针对此情况的接受规则 $U \\leq \\frac{p(\\mu)}{M\\,g(\\mu)}$ 是：\n$$\nU \\leq \\frac{\\frac{\\beta}{2\\,\\sinh(\\beta)}\\,\\exp(\\beta\\,\\mu)}{\\left(\\frac{\\beta\\,\\exp(\\beta)}{\\sinh(\\beta)}\\right) \\left(\\frac{1}{2}\\right)} = \\frac{\\exp(\\beta\\,\\mu)}{\\exp(\\beta)} = \\exp(\\beta(\\mu-1))\n$$\n对于 $\\beta=3$，规则是 $U \\leq \\exp(3(\\mu-1))$。一个被接受的 $\\mu$ 值将服从 $p(\\mu)$ 分布。\n\n最终要求的答案是效率 $\\eta$ 的数值。",
            "answer": "$$\n\\boxed{0.16625}\n$$"
        },
        {
            "introduction": "在确定了光子的传播方向后，模拟的下一步是决定光子在下一次相互作用前能传播多远。这个距离由光学厚度概念决定，当介质属性不均匀或光子路径为曲线时，其计算会变得相当复杂。本练习  要求你开发一种稳健的数值方法，用于计算非均匀介质中沿各种曲线路径的光学厚度。这个实践将辐射传输方程的抽象概念与光子路径追踪的具体计算算法联系起来，是实现完整光子传输模拟的核心环节。",
            "id": "3978765",
            "problem": "在参与介质中传播的光子根据辐射传输方程（RTE）发生衰减：沿无穷小路径长度的强度变化与局部消光系数成正比。从RTE所蕴含的微分衰减定律出发，根据第一性原理推导沿一般曲线路径的光学厚度表达式。然后，构建一种数值方法，用于在消光系数随空间变化且射线路径为曲线时计算此光学厚度。您的推导必须从基本的微分衰减定律开始，并推导出一个适合数值计算的路径积分表示。使用曲线的参数化表示，并考虑将参数微分转换为微分弧长的度量因子。\n\n使用您推导的表达式，实现一个数值积分方案，该方案对于沿曲线路径的平滑但非均匀的消光场是鲁棒的。该积分方法必须能适应被积函数的局部行为，从而将绝对积分误差控制在指定的容差范围内。任何正确的自适应求积方法都是可接受的，只要它是从有原理依据的误差估计中推导出来的。\n\n需要针对消光系数在指定曲线路径上能得到光学厚度闭式解的情况进行验证。您必须以弧度处理角度。光学厚度是无量纲的；以无量纲小数形式报告绝对误差。\n\n测试套件规范。对于每种情况，您必须使用您的积分方法计算数值光学厚度，从您的第一性原理表示出发推导解析光学厚度，然后以小数形式返回数值与解析值之间的绝对误差。所有角度均以弧度为单位。\n\n- 情况1（平面内圆弧上的均匀消光）：\n  - 曲线：位于 $z=0$ 平面内，由角度 $\\theta \\in [0,\\phi]$ 参数化的圆弧，半径为 $R$，中心在原点，由 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, 0)$ 给出。\n  - 参数：$R=2.0$，$\\phi=\\pi/2$，消光 $\\sigma_t(\\mathbf{x}) = \\sigma_0$，其中 $\\sigma_0 = 1.25$。\n  - 要求：计算数值光学厚度与解析光学厚度之间的绝对误差。\n\n- 情况2（圆弧上 $x$ 方向线性变化的消光）：\n  - 曲线：位于 $z=0$ 平面内，由角度 $\\theta \\in [0,\\phi]$ 参数化的圆弧，半径为 $R$，中心在原点，由 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, 0)$ 给出。\n  - 参数：$R=3.0$，$\\phi=\\pi/3$，消光 $\\sigma_t(\\mathbf{x}) = a + b x$，其中 $a=0.8$, $b=-0.3$。\n  - 要求：计算数值光学厚度与解析光学厚度之间的绝对误差。\n\n- 情况3（对数螺线上的径向幂律消光）：\n  - 曲线：位于 $z=0$ 平面内的对数螺线，由角度 $\\theta \\in [0,\\phi]$ 参数化，其中 $r(\\theta) = r_0 e^{\\alpha \\theta}$，由 $\\mathbf{r}(\\theta) = (r(\\theta)\\cos\\theta, r(\\theta)\\sin\\theta, 0)$ 给出。\n  - 参数：$r_0=1.1$，$\\alpha=0.5$，$\\phi=2.0$，消光 $\\sigma_t(\\mathbf{x}) = k \\|\\mathbf{x}\\|^m$，其中 $k=0.7$, $m=2.0$。\n  - 要求：计算数值光学厚度与解析光学厚度之间的绝对误差。\n\n- 情况4（螺旋线上 $z$ 方向线性变化的消光）：\n  - 曲线：由角度 $\\theta \\in [0,\\phi]$ 参数化的螺旋线，半径为 $R$，螺距参数为 $p$，由 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, p\\theta)$ 给出。\n  - 参数：$R=1.7$, $p=0.4$, $\\phi=5.0$, 消光 $\\sigma_t(\\mathbf{x}) = a + c z$，其中 $a=0.2$, $c=0.6$。\n  - 要求：计算数值光学厚度与解析光学厚度之间的绝对误差。\n\n实现要求：\n\n- 从第一性原理的微分衰减定律出发，推导沿参数化曲线的光学厚度路径积分，并确定正确的度量因子。\n- 实现一个自适应数值积分方法来近似光学厚度积分，在每种情况下，绝对误差容差不得超过 $10^{-10}$。\n- 角度必须以弧度为单位。\n- 将四个案例的绝对误差报告为包含四个小数的单个列表。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是案例 $i$ 的绝对误差，以小数形式表示，没有单位，因为光学厚度是无量纲的。",
            "solution": "该问题是有效的，因为它以辐射传输原理为科学基础，在数学上是适定的、客观的，并包含获得唯一解所需的所有信息。\n\n在参与介质中，描述辐射强度 $I$ 衰减的基本原理是辐射传输方程（RTE）。对于非发射和非散射介质，沿微分路径长度 $ds$ 的强度变化 $dI$ 由微分衰减定律（也称为 Beer-Lambert 定律）给出：\n$$ dI = -\\sigma_t(\\mathbf{x}) I ds $$\n其中 $\\sigma_t(\\mathbf{x})$ 是在位置 $\\mathbf{x}$ 处随空间变化的消光系数。这是一个关于路径长度 $s$ 的函数 $I$ 的一阶可分离常微分方程。我们可以从路径上的起点 $s=0$ 到某一点 $s$ 对此方程进行积分：\n$$ \\int_{I(0)}^{I(s)} \\frac{dI'}{I'} = -\\int_0^s \\sigma_t(\\mathbf{x}(s')) ds' $$\n$$ \\ln\\left(\\frac{I(s)}{I(0)}\\right) = -\\int_0^s \\sigma_t(\\mathbf{x}(s')) ds' $$\n$$ I(s) = I(0) \\exp\\left(-\\int_0^s \\sigma_t(\\mathbf{x}(s')) ds'\\right) $$\n指数中的无量纲量被定义为光学厚度 $\\tau$。因此，从路径起点 $s=0$ 到路径长度为 $L$ 的点的光学厚度为：\n$$ \\tau = \\int_0^L \\sigma_t(\\mathbf{x}(s)) ds $$\n其微分形式为 $d\\tau = \\sigma_t(\\mathbf{x}) ds$。此积分表示沿路径累积的总消光效应。\n\n为了计算沿一般曲线路径的该积分，我们首先用向量函数 $\\mathbf{r}(u)$ 对路径进行参数化表示，其中 $u$ 是在区间 $[u_a, u_b]$ 上变化的参数。微分弧长 $ds$ 通过度量因子与参数的微分 $du$ 相关联，该度量因子是切向量 $\\frac{d\\mathbf{r}}{du}$ 的模：\n$$ ds = \\left\\| \\frac{d\\mathbf{r}}{du} \\right\\| du = \\sqrt{\\left(\\frac{dx}{du}\\right)^2 + \\left(\\frac{dy}{du}\\right)^2 + \\left(\\frac{dz}{du}\\right)^2} \\, du $$\n通过代入 $ds$ 的这个表达式，并将消光系数表示为参数的函数 $\\sigma_t(\\mathbf{r}(u))$，我们获得了适合计算的光学厚度的一般路径积分表达式：\n$$ \\tau = \\int_{u_a}^{u_b} \\sigma_t(\\mathbf{r}(u)) \\left\\| \\frac{d\\mathbf{r}}{du} \\right\\| du $$\n这是一个关于参数 $u$ 的一维定积分。被积函数是在曲线上一点的消光系数与将参数微分缩放为弧长微分的度量因子的乘积。\n\n对于此积分的数值计算，我们采用一种自适应求积方法。这类方法旨在自动调整区间划分以达到期望的精度，将计算量集中在被积函数表现不佳或变化迅速的区域。该问题允许使用标准库，因此我们将使用 `scipy.integrate` 包中的 `quad` 函数。该函数实现了来自 FORTRAN 的鲁棒且广泛使用的 QUADPACK 库，它在提供积分近似值的同时也提供了绝对误差的估计。这使我们能够以指定的 $10^{-10}$ 的绝对误差容差计算光学厚度。\n\n我们现在推导四个测试案例的解析解，这些解将作为验证我们数值实现的基准真相。\n\n**情况1：均匀消光下的圆弧**\n曲线是 $z=0$ 平面内的一段圆弧，$\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, 0)$，其中 $\\theta \\in [0, \\phi]$，$R=2.0$，$\\phi=\\pi/2$。消光是均匀的，$\\sigma_t(\\mathbf{x}) = \\sigma_0 = 1.25$。\n切向量为 $\\frac{d\\mathbf{r}}{d\\theta} = (-R\\sin\\theta, R\\cos\\theta, 0)$。\n度量因子是一个常数：$\\|\\frac{d\\mathbf{r}}{d\\theta}\\| = \\sqrt{(-R\\sin\\theta)^2 + (R\\cos\\theta)^2} = \\sqrt{R^2(\\sin^2\\theta + \\cos^2\\theta)} = R$。\n被积函数为 $\\sigma_t(\\mathbf{r}(\\theta)) \\|\\frac{d\\mathbf{r}}{d\\theta}\\| = \\sigma_0 R$。\n光学厚度为：\n$$ \\tau_1 = \\int_0^{\\phi} \\sigma_0 R \\, d\\theta = \\sigma_0 R [\\theta]_0^\\phi = \\sigma_0 R \\phi $$\n代入数值：$\\tau_1 = (1.25)(2.0)(\\pi/2) = 1.25\\pi \\approx 3.9269908169872414$。\n\n**情况2：$x$方向线性变化消光下的圆弧**\n曲线为 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, 0)$，其中 $\\theta \\in [0, \\phi]$，$R=3.0$，$\\phi=\\pi/3$。消光为 $\\sigma_t(\\mathbf{x}) = a + bx$，其中 $a=0.8$，$b=-0.3$。\n度量因子为 $\\|\\frac{d\\mathbf{r}}{d\\theta}\\| = R$。\n沿路径的消光为 $\\sigma_t(\\mathbf{r}(\\theta)) = a + b(R\\cos\\theta)$。\n光学厚度为：\n$$ \\tau_2 = \\int_0^{\\phi} (a + bR\\cos\\theta)R \\, d\\theta = R \\int_0^{\\phi} (a + bR\\cos\\theta) \\, d\\theta = R \\left[ a\\theta + bR\\sin\\theta \\right]_0^{\\phi} = R (a\\phi + bR\\sin\\phi) $$\n代入数值：$\\tau_2 = 3.0(0.8(\\pi/3) + (-0.3)(3.0)\\sin(\\pi/3)) = 0.8\\pi - 1.35\\sqrt{3} \\approx 0.1755433224311847$。\n\n**情况3：径向幂律消光下的对数螺线**\n曲线是一条对数螺线 $\\mathbf{r}(\\theta) = (r_0 e^{\\alpha \\theta}\\cos\\theta, r_0 e^{\\alpha \\theta}\\sin\\theta, 0)$，其中 $\\theta \\in [0, \\phi]$，$r_0=1.1$，$\\alpha=0.5$，$\\phi=2.0$。消光为 $\\sigma_t(\\mathbf{x}) = k \\|\\mathbf{x}\\|^m$，其中 $k=0.7$, $m=2.0$。\n令 $r(\\theta) = r_0 e^{\\alpha\\theta}$。切向量 $\\frac{d\\mathbf{r}}{d\\theta}$ 的模的平方为 $\\|\\frac{d\\mathbf{r}}{d\\theta}\\|^2 = (1+\\alpha^2)r(\\theta)^2$，得到度量因子 $\\|\\frac{d\\mathbf{r}}{d\\theta}\\| = r(\\theta)\\sqrt{1+\\alpha^2}$。\n沿路径的消光取决于 $\\|\\mathbf{x}\\| = \\|\\mathbf{r}(\\theta)\\| = r(\\theta)$，所以 $\\sigma_t(\\mathbf{r}(\\theta)) = k r(\\theta)^m$。\n被积函数为 $(k r(\\theta)^m)(r(\\theta)\\sqrt{1+\\alpha^2}) = k\\sqrt{1+\\alpha^2} r(\\theta)^{m+1}$。\n光学厚度为：\n$$ \\tau_3 = \\int_0^{\\phi} k\\sqrt{1+\\alpha^2} (r_0 e^{\\alpha\\theta})^{m+1} \\, d\\theta = k r_0^{m+1} \\sqrt{1+\\alpha^2} \\int_0^{\\phi} e^{\\alpha(m+1)\\theta} \\, d\\theta $$\n$$ \\tau_3 = k r_0^{m+1} \\sqrt{1+\\alpha^2} \\left[ \\frac{e^{\\alpha(m+1)\\theta}}{\\alpha(m+1)} \\right]_0^{\\phi} = \\frac{k r_0^{m+1} \\sqrt{1+\\alpha^2}}{\\alpha(m+1)} \\left( e^{\\alpha(m+1)\\phi} - 1 \\right) $$\n代入数值：$\\tau_3 = \\frac{(0.7)(1.1)^3 \\sqrt{1+0.5^2}}{(0.5)(3.0)} (e^{(0.5)(3.0)(2.0)} - 1) \\approx 13.220171243169055$。\n\n**情况4：$z$方向线性变化消光下的螺旋线**\n曲线是一条螺旋线 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta, p\\theta)$，其中 $\\theta \\in [0, \\phi]$，$R=1.7$，$p=0.4$，$\\phi=5.0$。消光为 $\\sigma_t(\\mathbf{x}) = a + cz$，其中 $a=0.2$, $c=0.6$。\n切向量为 $\\frac{d\\mathbf{r}}{d\\theta} = (-R\\sin\\theta, R\\cos\\theta, p)$。\n度量因子是常数：$\\|\\frac{d\\mathbf{r}}{d\\theta}\\| = \\sqrt{(-R\\sin\\theta)^2 + (R\\cos\\theta)^2 + p^2} = \\sqrt{R^2+p^2}$。\n沿路径的消光为 $\\sigma_t(\\mathbf{r}(\\theta)) = a + c(p\\theta)$。\n光学厚度为：\n$$ \\tau_4 = \\int_0^{\\phi} (a+cp\\theta)\\sqrt{R^2+p^2} \\, d\\theta = \\sqrt{R^2+p^2} \\left[ a\\theta + \\frac{cp\\theta^2}{2} \\right]_0^{\\phi} = \\sqrt{R^2+p^2} \\left( a\\phi + \\frac{cp\\phi^2}{2} \\right) $$\n代入数值：$\\tau_4 = \\sqrt{1.7^2+0.4^2} \\left( (0.2)(5.0) + \\frac{(0.6)(0.4)(5.0)^2}{2} \\right) = \\sqrt{3.05} (1.0 + 3.0) = 4.0\\sqrt{3.05} \\approx 6.985699684784381$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the absolute error between numerical and analytical optical thickness\n    for four test cases involving different curved paths and extinction fields.\n    \"\"\"\n    # Define the absolute error tolerance for the numerical integration.\n    # We use a value smaller than the required 1e-10 to ensure compliance.\n    TOLERANCE = 1e-12\n\n    # A list of dictionaries, each defining a test case.\n    # This structure facilitates a clean, looped execution.\n    test_cases = [\n        {\n            \"id\": 1,\n            \"params\": {\"R\": 2.0, \"phi\": np.pi / 2.0, \"sigma0\": 1.25},\n            \"integrand\": lambda theta, p: p[\"sigma0\"] * p[\"R\"],\n            \"analytic\": lambda p: p[\"sigma0\"] * p[\"R\"] * p[\"phi\"]\n        },\n        {\n            \"id\": 2,\n            \"params\": {\"R\": 3.0, \"phi\": np.pi / 3.0, \"a\": 0.8, \"b\": -0.3},\n            \"integrand\": lambda theta, p: (p[\"a\"] + p[\"b\"] * p[\"R\"] * np.cos(theta)) * p[\"R\"],\n            \"analytic\": lambda p: p[\"R\"] * (p[\"a\"] * p[\"phi\"] + p[\"b\"] * p[\"R\"] * np.sin(p[\"phi\"]))\n        },\n        {\n            \"id\": 3,\n            \"params\": {\"r0\": 1.1, \"alpha\": 0.5, \"phi\": 2.0, \"k\": 0.7, \"m\": 2.0},\n            \"integrand\": lambda theta, p: (\n                p[\"k\"] * (p[\"r0\"] * np.exp(p[\"alpha\"] * theta))**p[\"m\"] *\n                (p[\"r0\"] * np.exp(p[\"alpha\"] * theta) * np.sqrt(p[\"alpha\"]**2 + 1))\n            ),\n            \"analytic\": lambda p: (\n                (p[\"k\"] * p[\"r0\"]**(p[\"m\"] + 1) * np.sqrt(p[\"alpha\"]**2 + 1)) / (p[\"alpha\"] * (p[\"m\"] + 1)) *\n                (np.exp(p[\"alpha\"] * (p[\"m\"] + 1) * p[\"phi\"]) - 1)\n            )\n        },\n        {\n            \"id\": 4,\n            \"params\": {\"R\": 1.7, \"p\": 0.4, \"phi\": 5.0, \"a\": 0.2, \"c\": 0.6},\n            \"integrand\": lambda theta, p: (\n                (p[\"a\"] + p[\"c\"] * p[\"p\"] * theta) * np.sqrt(p[\"R\"]**2 + p[\"p\"]**2)\n            ),\n            \"analytic\": lambda p: (\n                np.sqrt(p[\"R\"]**2 + p[\"p\"]**2) * (p[\"a\"] * p[\"phi\"] + p[\"c\"] * p[\"p\"] * p[\"phi\"]**2 / 2.0)\n            )\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        params = case[\"params\"]\n        \n        # The integrand is the product of the extinction coeff and the metric factor\n        integrand_func = lambda theta: case[\"integrand\"](theta, params)\n        \n        # The integration limit is given by the parameter phi\n        phi = params[\"phi\"]\n\n        # Numerical integration using SciPy's adaptive quadrature\n        numerical_val, _ = quad(integrand_func, 0, phi, epsabs=TOLERANCE)\n        \n        # Analytical solution derived from first principles\n        analytic_val = case[\"analytic\"](params)\n        \n        # Compute the absolute error\n        absolute_error = abs(numerical_val - analytic_val)\n        results.append(absolute_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "蒙特卡洛模拟通过平均大量独立光子历史的结果来得出最终值。因此，评估这些结果的质量至关重要：我们对结果的置信度有多高？需要多少次模拟才能达到预期的精度？最后的这项练习  将中心极限定理应用于一个典型的MCRT场景。你将学习如何为计算出的辐射量构建置信区间，并估计达到特定精度水平所需的计算量，这些是任何蒙特卡洛方法实践者都必须掌握的关键技能，确保了模拟结果的可靠性和有效性。",
            "id": "3978764",
            "problem": "使用单色光子蒙特卡罗模拟来估计一个标量辐射量，具体来说，是从嵌入在吸收、发射、非散射介质中的灰色等温表面片射出的半球漫射辐射热通量。每个模拟的光子历史产生一个独立的分数 $X$，该分数计入通量估计量的总和，而真实通量 $Q$ 是其期望值 $\\mathbb{E}[X]$。假设分数 $X$ 是独立同分布 (i.i.d.) 且具有有限二阶矩，$Q$ 的估计量是样本均值 $\\hat{Q}_{M} = \\frac{1}{M} \\sum_{i=1}^{M} X_{i}$。一次包含 $M_{0} = 2.00 \\times 10^{5}$ 个光子历史的初步模拟运行，得到分数的样本均值为 $\\hat{\\mu} = 1.80 \\times 10^{4} \\text{ W/m}^{2}$，样本标准差为 $\\hat{\\sigma} = 5.40 \\times 10^{5} \\text{ W/m}^{2}$。\n\n仅使用第一性原理和标准渐近结果，回答以下问题：\n- 使用中心极限定理 (CLT)，为真实通量 $Q$ 构建一个双侧 $95\\%$ 置信区间，单位为 $\\text{W/m}^{2}$。\n- 使用相同的 CLT 框架，并将初步模拟的统计数据作为方差的替代值，确定为达到 $95\\%$ 置信度下规定的相对置信半宽 $\\varepsilon_{r} = 0.050$ 所需的最小光子历史总数 $N$。\n\n将所有最终数值答案四舍五入至四位有效数字。置信区间的界限以 $\\text{W/m}^{2}$ 为单位表示，并将 $N$ 报告为无量纲的计数。",
            "solution": "该问题经评估有效。问题陈述具有科学依据、提法明确、客观且自成体系。它描述了中心极限定理在分析蒙特卡罗模拟（计算物理和工程中的一种基本技术）的收敛性和不确定性方面的一个标准应用。所有必要数据均已提供，术语精确，目标明确。没有矛盾、歧义或违反科学原理之处。\n\n按照要求，解答分为两部分。\n\n第一部分：构建 $95\\%$ 置信区间\n\n半球漫射辐射热通量的真值用 $Q$ 表示，它是一个光子历史得分的期望值，即 $Q = \\mathbb{E}[X]$。$Q$ 的估计量是 $M$ 个分数的样本均值，$\\hat{Q}_{M} = \\frac{1}{M} \\sum_{i=1}^{M} X_{i}$。\n\n根据中心极限定理 (CLT)，对于足够大数量的独立同分布 (i.i.d.) 随机变量 ($M \\rightarrow \\infty$)，样本均值 $\\hat{Q}_{M}$ 的分布趋近于一个正态分布，其均值为 $Q$，方差为 $\\frac{\\sigma^2}{M}$，其中 $\\sigma^2$ 是单个分数 $X_i$ 的方差。这可以写成：\n$$ \\hat{Q}_{M} \\sim \\mathcal{N}\\left(Q, \\frac{\\sigma^2}{M}\\right) $$\n问题提供了来自一次包含 $M_0 = 2.00 \\times 10^{5}$ 个光子历史的初步模拟运行的数据。这个样本量足够大，可以应用中心极限定理。初步模拟运行得到的样本均值为 $\\hat{\\mu} = 1.80 \\times 10^{4} \\text{ W/m}^{2}$，样本标准差为 $\\hat{\\sigma} = 5.40 \\times 10^{5} \\text{ W/m}^{2}$。我们使用 $\\hat{\\mu}$ 作为 $Q$ 的点估计，使用 $\\hat{\\sigma}$ 作为真实标准差 $\\sigma$ 的估计。\n\n$Q$ 的一个双侧 $(1-\\alpha)$ 置信区间构造如下：\n$$ \\left[ \\hat{\\mu} - z_{1-\\alpha/2} \\frac{\\hat{\\sigma}}{\\sqrt{M_0}}, \\hat{\\mu} + z_{1-\\alpha/2} \\frac{\\hat{\\sigma}}{\\sqrt{M_0}} \\right] $$\n对于 $95\\%$ 的置信水平，$1-\\alpha = 0.95$，这意味着 $\\alpha = 0.05$。临界值 $z_{1-\\alpha/2} = z_{0.975}$ 是标准正态分布中对应于累积概率为 $0.975$ 的分位数。从标准统计表中查得，$z_{0.975} \\approx 1.959964$。\n\n首先，我们计算估计的均值标准误差 $\\hat{SE}$：\n$$ \\hat{SE} = \\frac{\\hat{\\sigma}}{\\sqrt{M_0}} = \\frac{5.40 \\times 10^{5} \\text{ W/m}^{2}}{\\sqrt{2.00 \\times 10^{5}}} \\approx 1207.4739 \\text{ W/m}^{2} $$\n接下来，我们计算误差范围 $\\delta$，即置信区间的半宽：\n$$ \\delta = z_{0.975} \\cdot \\hat{SE} \\approx 1.959964 \\times 1207.4739 \\text{ W/m}^{2} \\approx 2366.596 \\text{ W/m}^{2} $$\n置信区间为 $[\\hat{\\mu} - \\delta, \\hat{\\mu} + \\delta]$。下界 $Q_L$ 为：\n$$ Q_L = 1.80 \\times 10^{4} - 2366.596 = 15633.404 \\text{ W/m}^{2} $$\n上界 $Q_U$ 为：\n$$ Q_U = 1.80 \\times 10^{4} + 2366.596 = 20366.596 \\text{ W/m}^{2} $$\n按要求将这些界限四舍五入到四位有效数字：\n$$ Q_L \\approx 1.563 \\times 10^{4} \\text{ W/m}^{2} $$\n$$ Q_U \\approx 2.037 \\times 10^{4} \\text{ W/m}^{2} $$\n\n第二部分：确定所需的光子历史数\n\n相对置信半宽 $\\varepsilon_r$ 定义为绝对半宽 $\\delta_N$ 除以真均值的绝对值 $|Q|$：\n$$ \\varepsilon_r = \\frac{\\delta_N}{|Q|} = \\frac{1}{|Q|} \\left( z_{1-\\alpha/2} \\frac{\\sigma}{\\sqrt{N}} \\right) $$\n我们需要求出在 $95\\%$ 置信度下达到相对半宽 $\\varepsilon_r = 0.050$ 所需的最小历史数 $N$。我们可以对上述方程求解 $N$：\n$$ \\sqrt{N} = \\frac{z_{1-\\alpha/2} \\sigma}{\\varepsilon_r |Q|} \\implies N = \\left( \\frac{z_{1-\\alpha/2} \\sigma}{\\varepsilon_r |Q|} \\right)^2 $$\n我们使用初步模拟运行的统计数据作为真值的替代值：$\\sigma \\approx \\hat{\\sigma} = 5.40 \\times 10^{5} \\text{ W/m}^{2}$ 和 $Q \\approx \\hat{\\mu} = 1.80 \\times 10^{4} \\text{ W/m}^{2}$。置信水平同样是 $95\\%$，所以 $z_{0.975} \\approx 1.959964$。\n\n将这些值代入 $N$ 的方程中：\n$$ N = \\left( \\frac{1.959964 \\times (5.40 \\times 10^{5})}{0.050 \\times |1.80 \\times 10^{4}|} \\right)^2 $$\n括号内的项为：\n$$ \\frac{1.959964 \\times 5.40 \\times 10^{5}}{0.050 \\times 1.80 \\times 10^{4}} = \\frac{1.05838 \\times 10^{6}}{900} \\approx 1175.978 $$\n将此值平方得到 $N$：\n$$ N \\approx (1175.978)^2 \\approx 1382924.9 $$\n由于光子历史数必须是整数，并且我们要求误差*最多*为规定值，我们必须对这个结果取上整来找到最小历史数：\n$$ N_{min} = \\lceil 1382924.9 \\rceil = 1382925 $$\n将此整数结果四舍五入到四位有效数字，得到：\n$$ N \\approx 1.383 \\times 10^{6} $$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.563 \\times 10^{4}  2.037 \\times 10^{4}  1.383 \\times 10^{6} \\end{pmatrix}}\n$$"
        }
    ]
}