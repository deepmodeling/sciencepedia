{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of Large Eddy Simulation is the spatial filter, which formally separates the resolved and unresolved scales of turbulence. To build intuition, this first practice strips the concept down to its essence by asking you to analytically compute the effect of a simple top-hat filter on a single Fourier mode. By deriving the filter's transfer function, you will see precisely how it attenuates small-scale information, a foundational concept for all of LES .",
            "id": "3338942",
            "problem": "In Large Eddy Simulation (LES), spatial filtering is defined by convolution of a field with a filter kernel. Consider a one-dimensional, spatially homogeneous filter with kernel $G(x;\\Delta)$ of compact support of width $\\Delta$, and define the filtered field $\\bar{\\phi}(x)$ by the convolution $\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,\\mathrm{d}r$. Take the top-hat kernel $G(x;\\Delta) = \\Delta^{-1}\\,\\mathbb{1}_{|x|<\\Delta/2}$ and the scalar field $\\phi(x) = \\sin(k x)$, where $k$ is a real wavenumber. Starting only from the definition of convolution and basic trigonometric identities, derive a closed-form expression for $\\bar{\\phi}(x)$ as a function of $k$, $\\Delta$, and $x$. Then, define the effective spectral cutoff wavenumber $k_c$ as the smallest positive $k$ for which the magnitude of the filter’s one-dimensional transfer function vanishes, and express the corresponding nondimensional product $k_c \\Delta$. Provide your final answer as a single row vector whose first entry is the exact expression for $\\bar{\\phi}(x)$ and whose second entry is the exact value of $k_c \\Delta$. No rounding is required, and no units should be included in the final answer.",
            "solution": "The problem statement is critically validated before attempting a solution.\n\n### Step 1: Extract Givens\n- **Definition of spatial filtering:** The filtered field $\\bar{\\phi}(x)$ is the convolution of the field $\\phi(x)$ with a filter kernel $G(x;\\Delta)$: $\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,\\mathrm{d}r$.\n- **Filter kernel:** One-dimensional top-hat filter kernel, $G(x;\\Delta) = \\Delta^{-1}\\,\\mathbb{1}_{|x|<\\Delta/2}$, where $\\mathbb{1}$ is the indicator function and $\\Delta$ is the filter width.\n- **Scalar field:** A single-wavenumber sinusoidal field, $\\phi(x) = \\sin(k x)$, where $k$ is a real wavenumber.\n- **Definition of cutoff wavenumber:** The effective spectral cutoff wavenumber $k_c$ is the smallest positive value of $k$ for which the magnitude of the filter’s one-dimensional transfer function vanishes.\n- **Task:** Derive a closed-form expression for $\\bar{\\phi}(x)$ and find the value of the nondimensional product $k_c \\Delta$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded:** The problem is a standard exercise in the mathematical foundations of Large Eddy Simulation (LES), a major topic in computational fluid dynamics. The concepts of convolution, filter kernels, and transfer functions are fundamental principles in signal processing and turbulence theory.\n- **Well-Posed:** All necessary functions ($G$, $\\phi$), definitions (convolution, $k_c$), and constraints are provided. The problem is self-contained and structured to yield a unique solution.\n- **Objective:** The language is formal and precise, with no subjective or ambiguous statements.\n- **No other flaws are detected:** The problem is not unsound, incomplete, contradictory, unrealistic, or ill-posed.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A complete, reasoned solution will be provided.\n\n### Solution Derivation\nThe first step is to derive the expression for the filtered field $\\bar{\\phi}(x)$ by evaluating the convolution integral.\nThe definition of the filtered field is:\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,\\mathrm{d}r\n$$\nSubstituting the given expressions for the filter kernel $G(r;\\Delta)$ and the scalar field $\\phi(x)$:\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} \\left(\\frac{1}{\\Delta}\\,\\mathbb{1}_{|r|<\\Delta/2}\\right) \\sin(k(x-r))\\,\\mathrm{d}r\n$$\nThe indicator function $\\mathbb{1}_{|r|<\\Delta/2}$ is equal to $1$ for $-\\Delta/2 < r < \\Delta/2$ and $0$ otherwise. This property restricts the limits of integration:\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(k(x-r))\\,\\mathrm{d}r\n$$\nTo evaluate this integral, we use the trigonometric identity for the sine of a difference: $\\sin(A-B) = \\sin(A)\\cos(B) - \\cos(A)\\sin(B)$. Let $A = kx$ and $B = kr$.\n$$\n\\sin(k(x-r)) = \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr)\n$$\nSubstituting this into the integral:\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\left[ \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr) \\right]\\,\\mathrm{d}r\n$$\nSince $\\sin(kx)$ and $\\cos(kx)$ do not depend on the integration variable $r$, they can be factored out of the integral:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,\\mathrm{d}r - \\frac{\\cos(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,\\mathrm{d}r\n$$\nWe now evaluate the two integrals separately.\nThe first integral involves an even function, $\\cos(kr)$, integrated over a symmetric interval:\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,\\mathrm{d}r = \\left[ \\frac{\\sin(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = \\frac{\\sin(k\\Delta/2)}{k} - \\frac{\\sin(-k\\Delta/2)}{k}\n$$\nSince $\\sin(-z) = -\\sin(z)$, this simplifies to:\n$$\n\\frac{\\sin(k\\Delta/2)}{k} + \\frac{\\sin(k\\Delta/2)}{k} = \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right)\n$$\nThe second integral involves an odd function, $\\sin(kr)$, integrated over a symmetric interval. Such an integral is always zero. We can verify this explicitly:\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,\\mathrm{d}r = \\left[ -\\frac{\\cos(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = -\\frac{\\cos(k\\Delta/2)}{k} - \\left(-\\frac{\\cos(-k\\Delta/2)}{k}\\right)\n$$\nSince $\\cos(-z) = \\cos(z)$, this simplifies to:\n$$\n-\\frac{\\cos(k\\Delta/2)}{k} + \\frac{\\cos(k\\Delta/2)}{k} = 0\n$$\nSubstituting these results back into the expression for $\\bar{\\phi}(x)$:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\left( \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\right) - \\frac{\\cos(kx)}{\\Delta} (0)\n$$\n$$\n\\bar{\\phi}(x) = \\frac{2}{k\\Delta} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\sin(kx)\n$$\nThis expression can be conveniently rewritten to highlight the filter's transfer function. By rearranging the terms, we get the first part of the required answer:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx)\n$$\n\nThe second step is to determine the nondimensional product $k_c \\Delta$.\nThe application of a filter to a single Fourier mode $\\exp(ikx)$ results in the mode being multiplied by the filter's transfer function, $\\hat{G}(k)$. For a real-valued field like $\\phi(x) = \\sin(kx)$, the filtered field is $\\bar{\\phi}(x) = \\hat{G}(k)\\phi(x)$, assuming the kernel $G(x)$ is real and even, which is true for the top-hat kernel.\nBy comparing our derived expression for $\\bar{\\phi}(x)$ with the form $\\hat{G}(k)\\phi(x) = \\hat{G}(k)\\sin(kx)$, we can identify the transfer function:\n$$\n\\hat{G}(k) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2}\n$$\nThis is the normalized sinc function, $\\text{sinc}(k\\Delta/2)$.\nAccording to the problem definition, $k_c$ is the smallest positive wavenumber $k$ for which the magnitude of the transfer function, $|\\hat{G}(k)|$, is zero. Since $\\hat{G}(k)$ is real, this is equivalent to finding the smallest positive $k$ for which $\\hat{G}(k) = 0$.\n$$\n\\frac{\\sin(k_c\\Delta/2)}{k_c\\Delta/2} = 0\n$$\nFor this expression to be zero, the numerator must be zero, while the denominator is non-zero (the case $k_c=0$ is excluded as we seek a positive wavenumber, and in the limit $k\\to 0$, $\\hat{G}(k) \\to 1$).\nThe condition is therefore:\n$$\n\\sin\\left(\\frac{k_c\\Delta}{2}\\right) = 0\n$$\nThe general solution for $\\sin(\\theta) = 0$ is $\\theta = n\\pi$ for any integer $n$. Thus:\n$$\n\\frac{k_c\\Delta}{2} = n\\pi, \\quad n \\in \\mathbb{Z}\n$$\nWe seek the smallest positive wavenumber $k_c$. Since the filter width $\\Delta$ is positive, we must have $n > 0$. The smallest positive integer is $n=1$.\n$$\n\\frac{k_c\\Delta}{2} = \\pi\n$$\nSolving for the nondimensional product $k_c \\Delta$ gives the second part of the required answer:\n$$\nk_c \\Delta = 2\\pi\n$$\nThe physical interpretation is that the top-hat filter completely removes waves whose wavelength $\\lambda = 2\\pi/k_c$ is equal to the filter width $\\Delta$, i.e., $\\lambda_c = \\Delta$.\n\nThe final answer consists of the expression for $\\bar{\\phi}(x)$ and the value of $k_c \\Delta$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx) & 2\\pi \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "In a real simulation, the idealized continuous filter is replaced by a discrete numerical stencil, an approximation that introduces important errors. This exercise guides you through a Taylor series analysis to uncover the leading-order truncation and commutation errors for a common filter stencil . Understanding the commutation error, which arises from spatially varying filter widths near boundaries or in adaptive meshes, is crucial for developing high-fidelity LES codes.",
            "id": "3967071",
            "problem": "Consider a one-dimensional, sufficiently smooth scalar field $f(x)$ representing a thermal variable in a Large Eddy Simulation (LES) context. The exact spatially filtered field with a Gaussian kernel of spatially varying standard deviation $\\sigma(x)$ is defined by the convolution\n$$\n\\bar{f}(x) \\equiv \\int_{-\\infty}^{\\infty} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma(x)} \\exp\\!\\left(-\\frac{\\xi^{2}}{2\\sigma(x)^{2}}\\right) f(x-\\xi)\\,\\mathrm{d}\\xi.\n$$\nAssume a uniform computational grid with spacing $h>0$ and approximate the Gaussian filter by a symmetric three-point linear stencil\n$$\n\\tilde{f}(x) \\equiv a(x)\\,f(x) + b(x)\\,\\big[f(x+h)+f(x-h)\\big],\n$$\nwhere the coefficients $a(x)$ and $b(x)$ are smooth functions of $x$, chosen so that the stencil is normalized and matches the Gaussian filter up to and including the term proportional to $f''(x)$ in a Taylor-series sense. Assume the practically relevant scaling $\\sigma(x) = c(x)\\,h$, where $c(x)$ is a smooth function satisfying $0 < c(x) \\leq 1$ and with derivatives that are $O(1)$ as $h \\to 0$.\n\nUsing only first-principles expansions and definitions, and without invoking any pre-derived filter identities, perform the following.\n\n1. Determine $a(x)$ and $b(x)$ by consistency with normalization and by matching the coefficient multiplying $f''(x)$ in the local Taylor expansion of the exact Gaussian-filtered field about $x$.\n\n2. Define the truncation error as $\\mathcal{T}[f](x) \\equiv \\tilde{f}(x) - \\bar{f}(x)$. Derive the leading-order term of $\\mathcal{T}[f](x)$ as $h \\to 0$, expressed explicitly in terms of $c(x)$, $h$, and derivatives of $f$ evaluated at $x$. Retain only the smallest nonvanishing order in $h$.\n\n3. Define the commutation error with differentiation as $\\mathcal{C}[f](x) \\equiv \\partial_{x}\\tilde{f}(x) - \\widetilde{\\partial_{x} f}(x)$, where $\\partial_{x}$ denotes the exact derivative and the tilde denotes application of the same three-point stencil at the same location $x$. Under the same assumptions, derive the leading-order term of $\\mathcal{C}[f](x)$ as $h \\to 0$, expressed explicitly in terms of $c(x)$, $h$, and derivatives of $f$ and $c$ evaluated at $x$. Retain only the smallest nonvanishing order in $h$.\n\nProvide the final answer as a single row matrix containing the two leading-order expressions in the order $\\big[\\mathcal{T}[f](x),\\,\\mathcal{C}[f](x)\\big]$. No numerical evaluation is required. Express your final answer in exact closed form. Do not include units. No rounding is needed.",
            "solution": "The problem is subjected to validation and is found to be valid. It is scientifically grounded, well-posed, objective, and self-contained. The analysis proceeds as follows.\n\nThe problem requires a three-step analysis: determination of the filter coefficients, derivation of the truncation error, and derivation of the commutation error. This is accomplished by performing local Taylor series expansions of the exact and approximate filter operations.\n\n**1. Determination of Filter Coefficients $a(x)$ and $b(x)$**\n\nFirst, we analyze the exact Gaussian-filtered field $\\bar{f}(x)$. The definition is given by the convolution:\n$$\n\\bar{f}(x) = \\int_{-\\infty}^{\\infty} G(x, \\xi) f(x-\\xi)\\,\\mathrm{d}\\xi, \\quad \\text{where} \\quad G(x, \\xi) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma(x)} \\exp\\!\\left(-\\frac{\\xi^{2}}{2\\sigma(x)^{2}}\\right).\n$$\nWe expand the function $f(x-\\xi)$ in a Taylor series about the point $x$. Assuming $f$ is sufficiently smooth, we have:\n$$\nf(x-\\xi) = f(x) - \\xi f'(x) + \\frac{\\xi^{2}}{2!}f''(x) - \\frac{\\xi^{3}}{3!}f'''(x) + \\frac{\\xi^{4}}{4!}f^{(4)}(x) - \\dots\n$$\nSubstituting this expansion into the integral for $\\bar{f}(x)$ gives:\n$$\n\\bar{f}(x) = f(x)\\int_{-\\infty}^{\\infty} G(x, \\xi)\\,\\mathrm{d}\\xi - f'(x)\\int_{-\\infty}^{\\infty} \\xi G(x, \\xi)\\,\\mathrm{d}\\xi + \\frac{f''(x)}{2}\\int_{-\\infty}^{\\infty} \\xi^{2} G(x, \\xi)\\,\\mathrm{d}\\xi - \\frac{f'''(x)}{6}\\int_{-\\infty}^{\\infty} \\xi^{3} G(x, \\xi)\\,\\mathrm{d}\\xi + \\frac{f^{(4)}(x)}{24}\\int_{-\\infty}^{\\infty} \\xi^{4} G(x, \\xi)\\,\\mathrm{d}\\xi + \\dots\n$$\nThe integrals are the moments of the Gaussian kernel $G(x, \\xi)$ with respect to $\\xi$. The kernel is a normalized probability density function, and it is an even function of $\\xi$. Its moments are well-known:\n- $\\int_{-\\infty}^{\\infty} \\xi^{0} G(x, \\xi)\\,\\mathrm{d}\\xi = 1$ (Normalization)\n- $\\int_{-\\infty}^{\\infty} \\xi^{1} G(x, \\xi)\\,\\mathrm{d}\\xi = 0$ (Symmetry)\n- $\\int_{-\\infty}^{\\infty} \\xi^{2} G(x, \\xi)\\,\\mathrm{d}\\xi = \\sigma(x)^{2}$ (Variance)\n- $\\int_{-\\infty}^{\\infty} \\xi^{3} G(x, \\xi)\\,\\mathrm{d}\\xi = 0$ (Symmetry)\n- $\\int_{-\\infty}^{\\infty} \\xi^{4} G(x, \\xi)\\,\\mathrm{d}\\xi = 3\\sigma(x)^{4}$\n\nSubstituting these moments into the expansion for $\\bar{f}(x)$ yields:\n$$\n\\bar{f}(x) = f(x) + \\frac{\\sigma(x)^{2}}{2}f''(x) + \\frac{3\\sigma(x)^{4}}{24}f^{(4)}(x) + O(\\sigma^{6}) = f(x) + \\frac{\\sigma(x)^{2}}{2}f''(x) + \\frac{\\sigma(x)^{4}}{8}f^{(4)}(x) + O(\\sigma^{6}).\n$$\nNext, we analyze the approximate three-point stencil $\\tilde{f}(x)$:\n$$\n\\tilde{f}(x) = a(x)\\,f(x) + b(x)\\,\\big[f(x+h)+f(x-h)\\big].\n$$\nWe expand $f(x+h)$ and $f(x-h)$ in Taylor series around $x$:\n$$\nf(x+h) = f(x) + hf'(x) + \\frac{h^{2}}{2}f''(x) + \\frac{h^{3}}{6}f'''(x) + \\frac{h^{4}}{24}f^{(4)}(x) + O(h^{5})\n$$\n$$\nf(x-h) = f(x) - hf'(x) + \\frac{h^{2}}{2}f''(x) - \\frac{h^{3}}{6}f'''(x) + \\frac{h^{4}}{24}f^{(4)}(x) + O(h^{5})\n$$\nSumming these two expressions, the odd-order terms cancel:\n$$\nf(x+h) + f(x-h) = 2f(x) + h^{2}f''(x) + \\frac{h^{4}}{12}f^{(4)}(x) + O(h^{6}).\n$$\nSubstituting this into the expression for $\\tilde{f}(x)$:\n$$\n\\tilde{f}(x) = a(x)f(x) + b(x)\\left( 2f(x) + h^{2}f''(x) + \\frac{h^{4}}{12}f^{(4)}(x) + O(h^{6}) \\right)\n$$\n$$\n\\tilde{f}(x) = \\big(a(x)+2b(x)\\big)f(x) + b(x)h^{2}f''(x) + \\frac{b(x)h^{4}}{12}f^{(4)}(x) + O(h^{6}).\n$$\nThe problem requires that the stencil be normalized and match the Gaussian filter up to the $f''(x)$ term. We equate the coefficients of corresponding derivatives of $f(x)$ in the expansions of $\\bar{f}(x)$ and $\\tilde{f}(x)$.\n- Coefficient of $f(x)$ (Normalization): $a(x) + 2b(x) = 1$.\n- Coefficient of $f''(x)$: $b(x)h^{2} = \\frac{\\sigma(x)^{2}}{2}$.\n\nUsing the given scaling relationship $\\sigma(x) = c(x)h$, the second condition becomes:\n$$\nb(x)h^{2} = \\frac{(c(x)h)^{2}}{2} = \\frac{c(x)^{2}h^{2}}{2}.\n$$\nThis gives the expression for $b(x)$:\n$$\nb(x) = \\frac{c(x)^{2}}{2}.\n$$\nFrom the normalization condition, we find $a(x)$:\n$$\na(x) = 1 - 2b(x) = 1 - 2\\left(\\frac{c(x)^{2}}{2}\\right) = 1 - c(x)^{2}.\n$$\n\n**2. Derivation of the Truncation Error $\\mathcal{T}[f](x)$**\n\nThe truncation error is defined as $\\mathcal{T}[f](x) \\equiv \\tilde{f}(x) - \\bar{f}(x)$. Using the expansions derived above, the terms involving $f(x)$ and $f''(x)$ cancel by construction. The leading-order error term comes from the next non-vanishing term, which is the coefficient of $f^{(4)}(x)$.\n$$\n\\mathcal{T}[f](x) = \\left( \\frac{b(x)h^{4}}{12} - \\frac{\\sigma(x)^{4}}{8} \\right) f^{(4)}(x) + O(h^{6}).\n$$\nThe leading-order term is:\n$$\n\\mathcal{T}[f](x) \\approx \\left( \\frac{b(x)h^{4}}{12} - \\frac{\\sigma(x)^{4}}{8} \\right) f^{(4)}(x).\n$$\nWe substitute the expressions for $b(x)$ and $\\sigma(x)$:\n$$\n\\mathcal{T}[f](x) \\approx \\left( \\frac{1}{12}\\left(\\frac{c(x)^{2}}{2}\\right)h^{4} - \\frac{(c(x)h)^{4}}{8} \\right) f^{(4)}(x)\n$$\n$$\n\\mathcal{T}[f](x) \\approx \\left( \\frac{c(x)^{2}h^{4}}{24} - \\frac{c(x)^{4}h^{4}}{8} \\right) f^{(4)}(x)\n$$\nFactoring out common terms, we obtain the leading-order truncation error:\n$$\n\\mathcal{T}[f](x) = \\frac{c(x)^{2} - 3c(x)^{4}}{24} h^{4} f^{(4)}(x).\n$$\nThe error is of order $O(h^{4})$.\n\n**3. Derivation of the Commutation Error $\\mathcal{C}[f](x)$**\n\nThe commutation error is defined as $\\mathcal{C}[f](x) \\equiv \\partial_{x}\\tilde{f}(x) - \\widetilde{\\partial_{x} f}(x)$, where $\\partial_{x}$ is the exact derivative operator.\nFirst, we compute $\\partial_{x}\\tilde{f}(x)$:\n$$\n\\partial_{x}\\tilde{f}(x) = \\partial_{x} \\left( a(x)f(x) + b(x)\\big[f(x+h)+f(x-h)\\big] \\right)\n$$\n$$\n\\partial_{x}\\tilde{f}(x) = a'(x)f(x) + a(x)f'(x) + b'(x)\\big[f(x+h)+f(x-h)\\big] + b(x)\\big[f'(x+h)+f'(x-h)\\big].\n$$\nNext, we compute $\\widetilde{\\partial_{x} f}(x)$, which is the application of the filter stencil to the function $g(x) = \\partial_{x}f(x) = f'(x)$:\n$$\n\\widetilde{\\partial_{x} f}(x) = a(x)f'(x) + b(x)\\big[f'(x+h)+f'(x-h)\\big].\n$$\nSubtracting the second expression from the first yields the commutation error:\n$$\n\\mathcal{C}[f](x) = \\left( a'(x)f(x) + a(x)f'(x) + b'(x)\\big[f(x+h)+f(x-h)\\big] + b(x)\\big[f'(x+h)+f'(x-h)\\big] \\right) - \\left( a(x)f'(x) + b(x)\\big[f'(x+h)+f'(x-h)\\big] \\right)\n$$\n$$\n\\mathcal{C}[f](x) = a'(x)f(x) + b'(x)\\big[f(x+h)+f(x-h)\\big].\n$$\nTo find the leading-order term, we expand the term in brackets about $x$:\n$$\nf(x+h)+f(x-h) = 2f(x) + h^{2}f''(x) + O(h^{4}).\n$$\nSubstituting this into the expression for $\\mathcal{C}[f](x)$:\n$$\n\\mathcal{C}[f](x) = a'(x)f(x) + b'(x) \\left( 2f(x) + h^{2}f''(x) + O(h^{4}) \\right)\n$$\n$$\n\\mathcal{C}[f](x) = \\big(a'(x)+2b'(x)\\big)f(x) + b'(x)h^{2}f''(x) + O(h^{4}).\n$$\nWe use the normalization condition $a(x)+2b(x) = 1$. Differentiating with respect to $x$ gives $a'(x)+2b'(x) = 0$. Therefore, the term proportional to $f(x)$ vanishes.\nThis leaves the leading-order commutation error as:\n$$\n\\mathcal{C}[f](x) \\approx b'(x)h^{2}f''(x).\n$$\nWe need to find $b'(x)$. From $b(x) = \\frac{c(x)^{2}}{2}$, we have:\n$$\nb'(x) = \\frac{d}{dx}\\left(\\frac{c(x)^{2}}{2}\\right) = \\frac{1}{2} \\cdot 2c(x) \\cdot c'(x) = c(x)c'(x).\n$$\nSubstituting this into the expression for the commutation error gives:\n$$\n\\mathcal{C}[f](x) = c(x)c'(x) h^{2} f''(x).\n$$\nThis is the leading-order term, which is of order $O(h^{2})$. This error arises from the spatial variation of the filter width, represented by a non-zero $c'(x)$.\n\nThe final answer comprises the leading-order expressions for $\\mathcal{T}[f](x)$ and $\\mathcal{C}[f](x)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{c(x)^{2} - 3c(x)^{4}}{24} h^{4} f^{(4)}(x) & c(x)c'(x) h^{2} f''(x) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "When fluid density varies significantly, as in combustion or multiphase flows, standard filtering methods can lead to large modeling errors. This hands-on computational problem demonstrates the superiority of Favre (density-weighted) filtering in accurately representing convective momentum flux in such scenarios . By implementing both simple and Favre filtering, you will numerically quantify the spurious terms that Favre averaging is specifically designed to eliminate.",
            "id": "3967139",
            "problem": "You are given a one-dimensional, periodic domain of length $L$ in $\\mathrm{m}$ and a prescribed, inhomogeneous density field $\\rho(x)$ in $\\mathrm{kg\\,m^{-3}}$ with a sharp gradient near a location $x_0$, together with a velocity field $u(x)$ in $\\mathrm{m\\,s^{-1}}$. Consider spatial filtering with a Gaussian kernel of standard deviation $\\sigma$ in $\\mathrm{m}$, applied under periodic boundary conditions. Let simple filtering denote the spatial average $\\overline{\\cdot}$ effected by convolution with the Gaussian kernel, and let Favre filtering denote the density-weighted average defined by $\\tilde{\\phi}(x) = \\overline{\\rho \\phi}(x)/\\overline{\\rho}(x)$. The convective momentum flux in one spatial dimension is the field $\\rho(x)\\,u(x)^2$ in $\\mathrm{Pa}$.\n\nStarting from the definitions of compressible convective momentum flux, spatial filtering, and Favre filtering, implement a program that:\n- Computes the exact filtered flux $\\overline{\\rho u^2}(x)$ in $\\mathrm{Pa}$.\n- Computes the simple-filter approximation to the flux $\\overline{\\rho}(x)\\,\\overline{u}(x)^2$ in $\\mathrm{Pa}$.\n- Computes the Favre-filter approximation to the flux $\\overline{\\rho}(x)\\,\\tilde{u}(x)^2$ in $\\mathrm{Pa}$, where $\\tilde{u}(x) = \\overline{\\rho u}(x)/\\overline{\\rho}(x)$.\n- Computes the difference between the simple and Favre approximations to the convective momentum flux, defined pointwise as $\\Delta(x) = \\overline{\\rho}(x)\\,\\overline{u}(x)^2 - \\overline{\\rho}(x)\\,\\tilde{u}(x)^2$ in $\\mathrm{Pa}$.\n- Quantifies the spurious term avoided by Favre filtering relative to the exact filtered flux as the pointwise reduction in absolute error $E_{\\mathrm{avoid}}(x) = \\left|\\overline{\\rho}(x)\\,\\overline{u}(x)^2 - \\overline{\\rho u^2}(x)\\right| - \\left|\\overline{\\rho}(x)\\,\\tilde{u}(x)^2 - \\overline{\\rho u^2}(x)\\right|$ in $\\mathrm{Pa}$.\n- Reports the spatial averages $\\langle \\Delta \\rangle$ and $\\langle E_{\\mathrm{avoid}} \\rangle$ over the domain, both in $\\mathrm{Pa}$.\n\nUse the following fundamental bases:\n- The compressible momentum equation’s convective flux tensor in one dimension reduces to the scalar field $\\rho u^2$ in $\\mathrm{Pa}$.\n- Spatial filtering is a linear convolution operation with a normalized Gaussian kernel $G(x) = \\exp\\!\\left(-x^2/(2\\sigma^2)\\right)$, interpreted periodically over the domain.\n- Favre filtering is defined by $\\tilde{\\phi} = \\overline{\\rho \\phi}/\\overline{\\rho}$.\n\nAll filtering must be performed numerically via the discrete Fourier transform with periodic boundary conditions using the Gaussian transfer function in wavenumber space.\n\nPhysical and numerical specifications:\n- Domain: $x \\in [0,L)$ with periodic boundary conditions and $N$ uniformly spaced points.\n- Density: $\\rho(x) = \\rho_1 + (\\rho_2 - \\rho_1)\\,s(x)$, where $s(x) = \\dfrac{1}{2}\\left[1 + \\tanh\\!\\left(\\dfrac{x - x_0}{\\epsilon}\\right)\\right]$, with $\\rho_1$ and $\\rho_2$ in $\\mathrm{kg\\,m^{-3}}$, $x_0$ and $\\epsilon$ in $\\mathrm{m}$.\n- Velocity: $u(x) = U_0 + U_1 \\sin\\!\\left(\\dfrac{2\\pi x}{L}\\right) + U_2 \\exp\\!\\left(-\\left(\\dfrac{x - x_0}{\\epsilon}\\right)^2\\right)$, with $U_0$, $U_1$, and $U_2$ in $\\mathrm{m\\,s^{-1}}$.\n- Gaussian filter: standard deviation $\\sigma$ in $\\mathrm{m}$, with transfer function in wavenumber space $H(k) = \\exp\\!\\left(-\\dfrac{1}{2}\\sigma^2 k^2\\right)$, where $k$ denotes the periodic wavenumbers.\n\nUnits:\n- All outputs must be reported in $\\mathrm{Pa}$.\n\nTest suite:\nProvide three test cases with scientifically realistic parameters to assess different facets:\n1. Case A (general sharp gradient, moderate filter): $L = 1\\,\\mathrm{m}$, $N = 4096$, $\\rho_1 = 1.0\\,\\mathrm{kg\\,m^{-3}}$, $\\rho_2 = 5.0\\,\\mathrm{kg\\,m^{-3}}$, $x_0 = 0.5\\,\\mathrm{m}$, $\\epsilon = 0.005\\,\\mathrm{m}$, $U_0 = 20\\,\\mathrm{m\\,s^{-1}}$, $U_1 = 5\\,\\mathrm{m\\,s^{-1}}$, $U_2 = 10\\,\\mathrm{m\\,s^{-1}}$, $\\sigma = 0.02\\,\\mathrm{m}$.\n2. Case B (uniform density baseline): $L = 1\\,\\mathrm{m}$, $N = 4096$, $\\rho_1 = 1.2\\,\\mathrm{kg\\,m^{-3}}$, $\\rho_2 = 1.2\\,\\mathrm{kg\\,m^{-3}}$, $x_0 = 0.5\\,\\mathrm{m}$, $\\epsilon = 0.005\\,\\mathrm{m}$, $U_0 = 20\\,\\mathrm{m\\,s^{-1}}$, $U_1 = 5\\,\\mathrm{m\\,s^{-1}}$, $U_2 = 10\\,\\mathrm{m\\,s^{-1}}$, $\\sigma = 0.02\\,\\mathrm{m}$.\n3. Case C (very sharp gradient, large filter): $L = 1\\,\\mathrm{m}$, $N = 4096$, $\\rho_1 = 1.0\\,\\mathrm{kg\\,m^{-3}}$, $\\rho_2 = 7.0\\,\\mathrm{kg\\,m^{-3}}$, $x_0 = 0.5\\,\\mathrm{m}$, $\\epsilon = 0.001\\,\\mathrm{m}$, $U_0 = 15\\,\\mathrm{m\\,s^{-1}}$, $U_1 = 8\\,\\mathrm{m\\,s^{-1}}$, $U_2 = 12\\,\\mathrm{m\\,s^{-1}}$, $\\sigma = 0.20\\,\\mathrm{m}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a flattened, comma-separated list of floats in $\\mathrm{Pa}$, in the order $\\left[\\langle \\Delta \\rangle_{\\mathrm{A}}, \\langle E_{\\mathrm{avoid}} \\rangle_{\\mathrm{A}}, \\langle \\Delta \\rangle_{\\mathrm{B}}, \\langle E_{\\mathrm{avoid}} \\rangle_{\\mathrm{B}}, \\langle \\Delta \\rangle_{\\mathrm{C}}, \\langle E_{\\mathrm{avoid}} \\rangle_{\\mathrm{C}}\\right]$, enclosed in square brackets (for example, $\\left[0.1,0.2,0.0,0.0,1.5,1.2\\right]$), where each value is the spatial average over the domain in $\\mathrm{Pa}$.",
            "solution": "The problem posed is a valid and well-defined exercise in computational fluid dynamics, specifically concerning the fundamentals of Large Eddy Simulation (LES) for variable-density flows. It is scientifically grounded, objective, and provides all necessary information to proceed with a numerical solution. The problem requires the comparison of simple (Reynolds-type) and Favre (density-weighted) filtering for the convective momentum flux term, a critical aspect of modeling compressible or multi-phase turbulence.\n\nFirst, the physical quantities and their mathematical definitions are established. The one-dimensional domain extends over a length $L$ with periodic boundary conditions, discretized by $N$ uniformly spaced points. The spatial coordinate is $x$. The density field $\\rho(x)$ and velocity field $u(x)$ are given by:\n$$ \\rho(x) = \\rho_1 + (\\rho_2 - \\rho_1)\\,s(x), \\quad \\text{where} \\quad s(x) = \\frac{1}{2}\\left[1 + \\tanh\\left(\\frac{x - x_0}{\\epsilon}\\right)\\right] $$\n$$ u(x) = U_0 + U_1 \\sin\\left(\\frac{2\\pi x}{L}\\right) + U_2 \\exp\\left(-\\left(\\frac{x - x_0}{\\epsilon}\\right)^2\\right) $$\nThe convective momentum flux in one dimension is the quantity $\\rho(x) u(x)^2$.\n\nIn LES, flow variables are decomposed into a large-scale (filtered) component and a small-scale (subgrid) component. The filtering operation, denoted by an overbar $\\overline{\\cdot}$, is a spatial convolution. For a generic field $\\phi(x)$, the filtered field is $\\overline{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(x - x') \\phi(x')\\,\\mathrm{d}x'$, where $G$ is the filter kernel. For this problem, a Gaussian kernel with standard deviation $\\sigma$ is specified.\n\nThe central challenge in LES arises from filtering nonlinear terms. Filtering the convective momentum flux $\\rho u^2$ yields $\\overline{\\rho u^2}$. This term is unclosed, meaning it cannot be expressed directly in terms of the filtered primary variables $\\overline{\\rho}$ and $\\overline{u}$. It must be modeled.\n\nTwo common approaches to approximate this term are analyzed:\n$1$. **Simple (or Reynolds) Filtering**: The approximation is formed by the product of the filtered quantities: $\\overline{\\rho u^2} \\approx \\overline{\\rho}\\,\\overline{u}^2$. This approach is known to perform poorly when density variations are significant, as it neglects correlations between density and velocity fluctuations at the subgrid scale.\n\n$2$. **Favre (or density-weighted) Filtering**: This method is designed to mitigate issues with variable density. The Favre-filtered velocity, $\\tilde{u}$, is defined as:\n$$ \\tilde{u}(x) = \\frac{\\overline{\\rho u}(x)}{\\overline{\\rho}(x)} $$\nThe corresponding approximation for the filtered convective flux is $\\overline{\\rho u^2} \\approx \\overline{\\rho}\\,\\tilde{u}^2$. By incorporating density into the filtered velocity definition, some of the subgrid correlations are implicitly accounted for, generally leading to a more accurate approximation and a simpler structure for the remaining subgrid-scale (SGS) term.\n\nThe problem requires the computation and comparison of these two approximations. Specifically, we are to compute:\n- The exact filtered flux: $\\overline{\\rho u^2}(x)$.\n- The simple-filter approximation: $\\overline{\\rho}(x)\\,\\overline{u}(x)^2$.\n- The Favre-filter approximation: $\\overline{\\rho}(x)\\,\\tilde{u}(x)^2 = \\overline{\\rho}(x) \\left( \\frac{\\overline{\\rho u}(x)}{\\overline{\\rho}(x)} \\right)^2 = \\frac{(\\overline{\\rho u}(x))^2}{\\overline{\\rho}(x)}$.\n\nThe difference between the two approximations is quantified by $\\Delta(x)$:\n$$ \\Delta(x) = \\overline{\\rho}(x)\\,\\overline{u}(x)^2 - \\overline{\\rho}(x)\\,\\tilde{u}(x)^2 $$\nThis term, $\\Delta(x)$, represents the contribution that is explicitly present in the simple-averaging framework but is absorbed into the definition of the filtered velocity in the Favre framework.\n\nFurthermore, we quantify the benefit of Favre filtering by calculating the pointwise reduction in absolute error relative to the exact filtered flux, $E_{\\mathrm{avoid}}(x)$:\n$$ E_{\\mathrm{avoid}}(x) = \\underbrace{\\left|\\overline{\\rho}(x)\\,\\overline{u}(x)^2 - \\overline{\\rho u^2}(x)\\right|}_{\\text{Error of simple approx.}} - \\underbrace{\\left|\\overline{\\rho}(x)\\,\\tilde{u}(x)^2 - \\overline{\\rho u^2}(x)\\right|}_{\\text{Error of Favre approx.}} $$\nA positive value of $E_{\\mathrm{avoid}}(x)$ indicates that the Favre approximation is more accurate at that point. The final objective is to report the spatial average of these two quantities, $\\langle \\Delta \\rangle$ and $\\langle E_{\\mathrm{avoid}} \\rangle$, for three distinct test cases.\n\nThe numerical implementation relies on the convolution theorem. The convolution operation in physical space is equivalent to a multiplication in Fourier (wavenumber) space. The procedure is as follows:\n$1$. Discretize the domain $x \\in [0, L)$ into $N$ points.\n$2$. Generate the discrete signals for $\\rho(x)$, $u(x)$, and the composite fields $\\rho(x)u(x)$ and $\\rho(x)u(x)^2$.\n$3$. Compute the discrete wavenumbers $k$ corresponding to the grid. For a domain length $L$ and $N$ points, the wavenumbers are $k_j = 2\\pi j / L$ for $j = -N/2, \\dots, N/2 - 1$.\n$4$. Construct the Gaussian transfer function in wavenumber space: $H(k) = \\exp(-\\frac{1}{2}\\sigma^2 k^2)$.\n$5$. For any field $\\phi(x)$, its filtered version $\\overline{\\phi}(x)$ is computed by:\n   a. Applying the Fast Fourier Transform (FFT): $\\hat{\\phi}(k) = \\mathcal{F}\\{\\phi(x)\\}$.\n   b. Multiplying by the transfer function: $\\hat{\\overline{\\phi}}(k) = \\hat{\\phi}(k) H(k)$.\n   c. Applying the Inverse Fast Fourier Transform (IFFT): $\\overline{\\phi}(x) = \\mathcal{F}^{-1}\\{\\hat{\\overline{\\phi}}(k)\\}$.\n$6$. Using this filtering procedure, compute $\\overline{\\rho}$, $\\overline{u}$, $\\overline{\\rho u}$, and $\\overline{\\rho u^2}$.\n$7$. From these filtered fields, calculate $\\tilde{u}$, $\\Delta(x)$, and $E_{\\mathrm{avoid}}(x)$ pointwise.\n$8$. Finally, compute the spatial averages $\\langle \\Delta \\rangle$ and $\\langle E_{\\mathrm{avoid}} \\rangle$ by taking the mean of the respective arrays.\n\nFor the constant density case (Case B), where $\\rho_1 = \\rho_2$, the density field is uniform, $\\rho(x) = \\rho_1$. In this scenario, $\\overline{\\rho} = \\rho_1$, and the definition of Favre velocity simplifies to $\\tilde{u} = \\overline{\\rho_1 u} / \\overline{\\rho_1} = (\\rho_1 \\overline{u}) / \\rho_1 = \\overline{u}$. Consequently, the simple and Favre approximations become identical, and both $\\Delta(x)$ and $E_{\\mathrm{avoid}}(x)$ are identically zero. This case serves as a crucial validation for the numerical implementation. For cases with sharp density gradients (A and C), significant non-zero values are expected for both $\\langle \\Delta \\rangle$ and $\\langle E_{\\mathrm{avoid}} \\rangle$, demonstrating the non-trivial difference between the two filtering approaches and the practical superiority of the Favre method in such flows.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing simple and Favre filtering for the\n    convective momentum flux in a 1D variable-density flow.\n    \"\"\"\n\n    test_cases = [\n        # Case A: General sharp gradient, moderate filter\n        {'L': 1.0, 'N': 4096, 'rho1': 1.0, 'rho2': 5.0, 'x0': 0.5, 'epsilon': 0.005,\n         'U0': 20.0, 'U1': 5.0, 'U2': 10.0, 'sigma': 0.02},\n        # Case B: Uniform density baseline\n        {'L': 1.0, 'N': 4096, 'rho1': 1.2, 'rho2': 1.2, 'x0': 0.5, 'epsilon': 0.005,\n         'U0': 20.0, 'U1': 5.0, 'U2': 10.0, 'sigma': 0.02},\n        # Case C: Very sharp gradient, large filter\n        {'L': 1.0, 'N': 4096, 'rho1': 1.0, 'rho2': 7.0, 'x0': 0.5, 'epsilon': 0.001,\n         'U0': 15.0, 'U1': 8.0, 'U2': 12.0, 'sigma': 0.20},\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        L = params['L']\n        N = params['N']\n        rho1 = params['rho1']\n        rho2 = params['rho2']\n        x0 = params['x0']\n        epsilon = params['epsilon']\n        U0 = params['U0']\n        U1 = params['U1']\n        U2 = params['U2']\n        sigma = params['sigma']\n\n        # 1. Discretize the domain and define wavenumbers\n        x = np.linspace(0, L, N, endpoint=False)\n        dx = L / N\n        k = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n\n        # 2. Define the Gaussian filter transfer function\n        H_k = np.exp(-0.5 * sigma**2 * k**2)\n\n        def apply_filter(field):\n            \"\"\"Applies the Gaussian filter in Fourier space.\"\"\"\n            field_hat = np.fft.fft(field)\n            filtered_field_hat = field_hat * H_k\n            filtered_field = np.fft.ifft(filtered_field_hat)\n            return np.real(filtered_field)\n\n        # 3. Generate the physical fields\n        s_x = 0.5 * (1 + np.tanh((x - x0) / epsilon))\n        rho = rho1 + (rho2 - rho1) * s_x\n        u = U0 + U1 * np.sin(2 * np.pi * x / L) + U2 * np.exp(-((x - x0) / epsilon)**2)\n\n        # 4. Compute composite fields\n        rhou = rho * u\n        rhou2 = rho * u**2\n\n        # 5. Apply the filter to all necessary fields\n        rho_bar = apply_filter(rho)\n        u_bar = apply_filter(u)\n        rhou_bar = apply_filter(rhou)\n        rhou2_bar = apply_filter(rhou2) # This is the exact filtered flux\n\n        # 6. Compute Favre-filtered velocity\n        # Add a small epsilon to avoid division by zero in case rho_bar gets very small\n        # although with the given parameters it is not an issue.\n        u_tilde = rhou_bar / (rho_bar + 1e-12)\n\n        # 7. Compute the flux approximations\n        flux_simple = rho_bar * u_bar**2\n        flux_favre = rho_bar * u_tilde**2\n\n        # 8. Compute the diagnostic quantities\n        # Difference between simple and Favre approximations\n        delta = flux_simple - flux_favre\n        \n        # Spurious term avoided by Favre filtering (reduction in absolute error)\n        error_simple = np.abs(flux_simple - rhou2_bar)\n        error_favre = np.abs(flux_favre - rhou2_bar)\n        E_avoid = error_simple - error_favre\n\n        # 9. Compute the spatial averages\n        avg_delta = np.mean(delta)\n        avg_E_avoid = np.mean(E_avoid)\n        \n        results.extend([avg_delta, avg_E_avoid])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}