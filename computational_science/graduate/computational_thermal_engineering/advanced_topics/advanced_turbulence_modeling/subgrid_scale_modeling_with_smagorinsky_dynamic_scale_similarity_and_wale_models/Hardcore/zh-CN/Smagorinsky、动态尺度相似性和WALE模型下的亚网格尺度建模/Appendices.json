{
    "hands_on_practices": [
        {
            "introduction": "任何亚格子尺度（SGS）模型的有效性都取决于其准确预测亚格子应力的能力。本次实践采用一种称为“先验”分析的基本验证方法，将经典的Smagorinsky模型的预测结果与简单剪切流的高保真直接数值模拟（DNS）数据进行直接比较（）。通过亲手实现该模型并计算误差指标，您将获得评估和理解大涡模拟（LES）封闭模型性能的基础技能，这是发展和应用计算流体动力学模型的关键一步。",
            "id": "3988250",
            "problem": "您的任务是评估大涡模拟 (LES) 中一个广泛使用的亚格子尺度闭合模型——Smagorinsky 模型，在稳态剪切流中的预测能力。重点是评估非对角亚格子尺度 (SGS) 剪切应力分量 $ \\tau_{12} $ 及其对应变率大小 $ \\lvert S \\rvert $ 的依赖关系。您必须基于基本的滤波方程和闭合假设推导出 $ \\tau_{12} $，在一个程序中实现得到的预测模型，并与先验的直接数值模拟 (DNS) 数据进行比较，计算量化误差指标。\n\n从滤波后的不可压缩 Navier-Stokes 方程以及亚格子尺度应力张量 $ \\tau_{ij} $ 和已解尺度应变率张量 $ S_{ij} $ 的定义出发。使用基于物理上合理的假设的统计闭合框架，获得一个关于滤波宽度 $ \\Delta $、无量纲系数 $ C_s $、应变率大小 $ \\lvert S \\rvert $ 以及剪切分量 $ S_{12} $ 的 $ \\tau_{12} $ 模型表达式。假设 SGS 应力是经过密度归一化的（运动学的），因此 $ \\tau_{ij} $ 的单位是 $ \\mathrm{m}^2/\\mathrm{s}^2 $。解释在不可压缩剪切流条件下，推导出 $ \\tau_{12} $ 模型所依赖的物理假设和数学步骤。\n\n然后，在代码中实现您推导的预测模型，并将其与提供的直接数值模拟 (DNS) 的先验数据进行比较。对于每个测试用例，计算模型预测与 DNS 数据之间的以下误差指标：\n- 平均绝对误差 (MAE)，单位为 $ \\mathrm{m}^2/\\mathrm{s}^2 $。\n- 均方根误差 (RMSE)，单位为 $ \\mathrm{m}^2/\\mathrm{s}^2 $。\n- 决定系数 $ R^2 $，定义为预测值数组和 DNS 数据数组之间的 Pearson 相关系数的平方（无量纲）。如果两个数组的方差均为零且完全相等，则定义 $ R^2 = 1.0 $。如果两个数组的方差均为零但不相等，则定义 $ R^2 = 0.0 $。\n\n您的程序必须评估以下测试套件。每个测试用例提供了以米为单位的滤波宽度 $ \\Delta $、无量纲系数 $ C_s $、以 $ \\mathrm{s}^{-1} $ 为单位的 $ \\lvert S \\rvert $ 和 $ S_{12} $ 数组，以及以 $ \\mathrm{m}^2/\\mathrm{s}^2 $ 为单位的 DNS $ \\tau_{12} $。所有量均采用国际单位制 (SI)。\n\n测试用例 1（中等剪切，典型参数）：\n- $ \\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.16 $,\n- $ \\lvert S \\rvert = [20, 40, 60, 80, 100] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [-3.896\\times10^{-5}, -1.7384\\times10^{-4}, -3.6064\\times10^{-4}, -6.7036\\times10^{-4}, -1.014\\times10^{-3}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $。\n\n测试用例 2（应变为零的边界情况）：\n- $ \\Delta = 2.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.16 $,\n- $ \\lvert S \\rvert = [0, 0, 0, 0] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [0, 0, 0, 0] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [0, 0, 0, 0] \\, \\mathrm{m}^2/\\mathrm{s}^2 $。\n\n测试用例 3（符号变化的高剪切）：\n- $ \\Delta = 3.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.18 $,\n- $ \\lvert S \\rvert = [50, 100, 150, 200, 250] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [-25, -50, 75, -100, 125] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [1.229\\times10^{-3}, 2.516\\times10^{-3}, -5.961\\times10^{-3}, 1.0964\\times10^{-2}, -1.7225\\times10^{-2}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $。\n\n测试用例 4（小滤波宽度和较低系数）：\n- $ \\Delta = 1.0 \\times 10^{-3} \\, \\mathrm{m} $, $ C_s = 0.10 $,\n- $ \\lvert S \\rvert = [10, 20, 30, 40, 50] \\, \\mathrm{s}^{-1} $,\n- $ S_{12} = [5, 10, 15, 20, 25] \\, \\mathrm{s}^{-1} $,\n- DNS $ \\tau_{12} = [0.0, -4.5\\times10^{-6}, -7.0\\times10^{-6}, -1.7\\times10^{-5}, -2.5\\times10^{-5}] \\, \\mathrm{m}^2/\\mathrm{s}^2 $。\n\n您的程序应计算四个测试用例中每个用例的三个误差指标。最终输出必须是单行文本，包含一个由逗号分隔的 $ 12 $ 个浮点数列表，并用方括号括起来，顺序如下：\n$ [\\mathrm{MAE}_1,\\mathrm{RMSE}_1,R^2_1,\\mathrm{MAE}_2,\\mathrm{RMSE}_2,R^2_2,\\mathrm{MAE}_3,\\mathrm{RMSE}_3,R^2_3,\\mathrm{MAE}_4,\\mathrm{RMSE}_4,R^2_4] $。\n所有的 MAE 和 RMSE 值单位必须是 $ \\mathrm{m}^2/\\mathrm{s}^2 $，所有的 $ R^2 $ 值必须是无量纲的。",
            "solution": "所述问题在科学上是合理的、自洽的且提法恰当。它为湍流大涡模拟 (LES) 中的一个基础亚格子尺度 (SGS) 模型提供了一个标准的先验验证练习。所有必需的物理参数、数据和误差指标的定义都已明确给出，没有歧义或矛盾。因此，我们可以开始进行推导和求解。\n\n**1. Smagorinsky 模型对 $ \\tau_{12} $ 的理论推导**\n\n目标是为不可压缩流动的亚格子尺度 (SGS) 剪切应力分量 $ \\tau_{12} $ 推导一个模型。\n\n**1.1. 滤波与亚格子尺度应力张量**\n\n在 LES 中，速度场 $ u_i $ 被分解为一个已解（滤波）分量 $ \\overline{u}_i $ 和一个未解（亚格子）分量 $ u'_i $。滤波操作由上划线表示。滤波后的不可压缩 Navier-Stokes 方程包含一个表示未解尺度对已解尺度影响的项。该项是 SGS 应力张量 $ \\tau_{ij} $ 的散度，定义为：\n$$ \\tau_{ij} = \\overline{u_i u_j} - \\overline{u}_i \\overline{u}_j $$\n这里，$ \\tau_{ij} $ 是一个运动应力（单位为 $ \\mathrm{m}^2/\\mathrm{s}^2 $），因为密度被假定为常数并被吸收到压力项中。该张量是对称的（$ \\tau_{ij} = \\tau_{ji} $），但是未知的，必须用已解的量来建模。\n\n**1.2. Boussinesq 假设与涡粘性**\n\nSmagorinsky 模型与许多其他 SGS 模型一样，基于 Boussinesq 或“涡粘性”假设。该假设假定 SGS 应力张量的各向异性部分与已解尺度应变率张量之间存在线性关系，这类似于牛顿流体中粘性应力与应变率之间的关系。\n\nSGS 应力张量被分解为其各向同性部分和其偏（各向异性）部分 $ \\tau_{ij}^d $：\n$$ \\tau_{ij} = \\tau_{ij}^d + \\frac{1}{3}\\tau_{kk}\\delta_{ij} $$\n其中 $ \\tau_{kk} $ 是该张量的迹（SGS 湍动能的两倍），$ \\delta_{ij} $ 是 Kronecker delta。各向同性部分通常被吸收到动量方程中一个修正的压力项里，并不直接贡献于动量输运。\n\nBoussinesq 假设将偏量部分建模为：\n$$ \\tau_{ij}^d = -2\\nu_{SGS} \\overline{S}_{ij} $$\n其中 $ \\nu_{SGS} $ 是 SGS 涡粘性系数，$ \\overline{S}_{ij} $ 是已解尺度应变率张量，定义为：\n$$ \\overline{S}_{ij} = \\frac{1}{2} \\left( \\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i} \\right) $$\n对于非对角剪切应力分量 $ \\tau_{12} $，其中 $ i=1, j=2 $ ($ i \\neq j $)，由于 $ \\delta_{12} = 0 $，各向同性部分消失。因此，$ \\tau_{12} $ 的模型直接由偏量部分给出：\n$$ \\tau_{12} = -2\\nu_{SGS} \\overline{S}_{12} $$\n问题陈述使用 $ S_{ij} $ 来表示已解尺度应变率张量，因此我们将采用此记法，得到 $ \\tau_{12} = -2\\nu_{SGS} S_{12} $。\n\n**1.3. 涡粘性系数 $ \\nu_{SGS} $ 的建模**\n\nSmagorinsky 模型的核心贡献是 $ \\nu_{SGS} $ 的表达式。它是通过量纲分析得出的，假设 SGS 能量的产生与其耗散处于局部平衡状态。涡粘性系数的单位必须是 $ \\mathrm{m}^2/\\mathrm{s} $。它由一个未解涡的特征长度尺度和一个特征速度尺度构成。\n-   特征长度尺度取为滤波宽度 $ \\Delta $。\n-   特征速度尺度从已解场中导出。已解尺度应变率张量的大小 $ \\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}} $ 的单位是 $ \\mathrm{s}^{-1} $。将其乘以长度尺度 $ \\Delta $ 得到一个速度尺度：$ v' \\sim \\Delta \\lvert S \\rvert $。\n\n结合这些尺度，涡粘性系数被建模为：\n$$ \\nu_{SGS} \\sim (\\text{长度尺度}) \\times (\\text{速度尺度}) \\sim \\Delta \\times (\\Delta \\lvert S \\rvert) = \\Delta^2 \\lvert S \\rvert $$\n引入一个无量纲模型系数，即 Smagorinsky 常数 $ C_s $，便得到涡粘性系数的最终形式：\n$$ \\nu_{SGS} = (C_s \\Delta)^2 \\lvert S \\rvert = C_s^2 \\Delta^2 \\lvert S \\rvert $$\n\n**1.4. $ \\tau_{12} $ 的最终模型方程**\n\n将 $ \\nu_{SGS} $ 的表达式代入 $ \\tau_{12} $ 的 Boussinesq 关系式，得到 SGS 剪切应力的完整 Smagorinsky 模型：\n$$ \\tau_{12}^{\\text{model}} = -2 \\nu_{SGS} S_{12} = -2 \\left( C_s^2 \\Delta^2 \\lvert S \\rvert \\right) S_{12} $$\n这就是需要实现的方程。它仅使用已解场量（$ \\lvert S \\rvert $, $ S_{12} $）和模型参数（$ C_s $, $ \\Delta $）来预测 SGS 剪切应力。负号表明该模型是纯耗散的；对于正的 $ S_{12} $ 和 $ \\lvert S \\rvert $，它会产生一个负的 $ \\tau_{12} $，这对应于一个与平均剪切方向相反的应力。\n\n**2. 误差指标**\n\n将计算以下误差指标，以比较模型预测值 $ y_{\\text{pred}} = \\tau_{12}^{\\text{model}} $ 与 DNS 数据 $ y_{\\text{true}} = \\tau_{12}^{\\text{DNS}} $。对于一组 $ N $ 个数据点：\n-   **平均绝对误差 (MAE):**\n    $$ \\mathrm{MAE} = \\frac{1}{N} \\sum_{i=1}^{N} | y_{\\text{pred},i} - y_{\\text{true},i} | $$\n-   **均方根误差 (RMSE):**\n    $$ \\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} ( y_{\\text{pred},i} - y_{\\text{true},i} )^2} $$\n-   **决定系数 ($ R^2 $):** 定义为 Pearson 相关系数 $ r $ 的平方。\n    $$ r = \\frac{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})(y_{\\text{true},i} - \\bar{y}_{\\text{true}})}{\\sqrt{\\sum_{i=1}^{N} (y_{\\text{pred},i} - \\bar{y}_{\\text{pred}})^2 \\sum_{i=1}^{N} (y_{\\text{true},i} - \\bar{y}_{\\text{true}})^2}} \\quad \\implies \\quad R^2 = r^2 $$\n    关于零方差的特殊情况按问题陈述中的规定处理。具体来说，如果预测数组和真实数组的方差均为零，若它们完全相同，则 $ R^2 = 1.0 $，否则 $ R^2 = 0.0 $。\n\n现在将基于这些推导出的公式和定义的指标进行实现。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_error_metrics(y_pred, y_true):\n    \"\"\"\n    Computes MAE, RMSE, and R^2 between predicted and true values.\n    \n    Args:\n        y_pred (np.ndarray): Array of predicted values.\n        y_true (np.ndarray): Array of true values.\n\n    Returns:\n        tuple: A tuple containing (mae, rmse, r_squared).\n    \"\"\"\n    # Mean Absolute Error (MAE)\n    mae = np.mean(np.abs(y_pred - y_true))\n\n    # Root Mean Square Error (RMSE)\n    rmse = np.sqrt(np.mean((y_pred - y_true)**2))\n\n    # Coefficient of Determination (R^2)\n    var_pred = np.var(y_pred)\n    var_true = np.var(y_true)\n\n    if var_pred == 0 and var_true == 0:\n        if np.all(y_pred == y_true):\n            r_squared = 1.0\n        else:\n            r_squared = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, the value at [0, 1] is the coefficient r.\n        # It can return nan if one of the inputs has zero variance. A simple check\n        # is sufficient since the case where both have zero variance is handled above.\n        if var_pred == 0 or var_true == 0:\n             # Correlation is typically undefined if one variable is constant.\n             # This can lead to a divide-by-zero warning in np.corrcoef.\n             # Given the problem context, if one has variance and the other doesn't,\n             # they are not well correlated. We can assign 0.\n             r_squared = 0.0\n        else:\n            r_matrix = np.corrcoef(y_pred, y_true)\n            r = r_matrix[0, 1]\n            r_squared = r**2\n\n    return mae, rmse, r_squared\n\ndef smagorinsky_model_tau12(Cs, Delta, S_mag, S_12):\n    \"\"\"\n    Calculates the SGS shear stress tau_12 using the Smagorinsky model.\n    \n    Args:\n        Cs (float): Smagorinsky constant.\n        Delta (float): Filter width.\n        S_mag (np.ndarray): Magnitude of the resolved rate-of-strain tensor.\n        S_12 (np.ndarray): Shear component of the resolved rate-of-strain tensor.\n\n    Returns:\n        np.ndarray: The modeled SGS shear stress tau_12.\n    \"\"\"\n    return -2.0 * (Cs * Delta)**2 * S_mag * S_12\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and compute error metrics.\n    \"\"\"\n    test_cases = [\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([20, 40, 60, 80, 100]),\n            \"S_12\": np.array([10, 20, 30, 40, 50]),\n            \"dns_tau_12\": np.array([-3.896e-5, -1.7384e-4, -3.6064e-4, -6.7036e-4, -1.014e-3])\n        },\n        {\n            \"Delta\": 2.0e-3, \"Cs\": 0.16,\n            \"S_mag\": np.array([0, 0, 0, 0]),\n            \"S_12\": np.array([0, 0, 0, 0]),\n            \"dns_tau_12\": np.array([0, 0, 0, 0])\n        },\n        {\n            \"Delta\": 3.0e-3, \"Cs\": 0.18,\n            \"S_mag\": np.array([50, 100, 150, 200, 250]),\n            \"S_12\": np.array([-25, -50, 75, -100, 125]),\n            \"dns_tau_12\": np.array([1.229e-3, 2.516e-3, -5.961e-3, 1.0964e-2, -1.7225e-2])\n        },\n        {\n            \"Delta\": 1.0e-3, \"Cs\": 0.10,\n            \"S_mag\": np.array([10, 20, 30, 40, 50]),\n            \"S_12\": np.array([5, 10, 15, 20, 25]),\n            \"dns_tau_12\": np.array([0.0, -4.5e-6, -7.0e-6, -1.7e-5, -2.5e-5])\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Calculate the model prediction for tau_12\n        model_tau_12 = smagorinsky_model_tau12(\n            case[\"Cs\"],\n            case[\"Delta\"],\n            case[\"S_mag\"],\n            case[\"S_12\"]\n        )\n\n        # Compute the error metrics against the DNS data\n        mae, rmse, r_squared = calculate_error_metrics(model_tau_12, case[\"dns_tau_12\"])\n\n        # Append metrics to the results list\n        all_results.extend([mae, rmse, r_squared])\n\n    # Format the final output string\n    print(f\"[{','.join(f'{r:.7g}' for r in all_results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "虽然标准的Smagorinsky模型为亚格子尺度建模提供了理论基础，但它在近壁区域会失效，因为在这些区域黏性效应占主导地位。本练习探讨了“壁面阻尼函数”这一关键概念，这是一种至关重要的修正方法，通过在固体表面附近衰减涡黏性来确保模型行为的物理正确性（）。您将通过求解湍流槽道流中不同阻尼模型下的平均速度梯度，从而直接洞察这些实用修正如何影响壁面剪切应力等关键物理量的预测。",
            "id": "3988249",
            "problem": "考虑在大涡模拟 (LES) 范式下，摩擦雷诺数 $Re_\\tau \\approx 180$ 的充分发展的湍流槽道流的一维表示。设槽道半高为 $h$，运动粘度为 $\\nu$，摩擦速度为 $u_\\tau = \\sqrt{\\tau_w/\\rho}$，密度为 $\\rho$。在此类流动中，平均流向动量方程简化为沿槽道高度的线性总切应力分布，可写为 $ \\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right) $，其中总应力是粘性应力和建模的湍流（亚格子尺度）应力之和，即 $ \\tau_\\text{tot}(y) = \\rho \\nu \\frac{dU}{dy} + \\rho \\nu_t \\frac{dU}{dy}$。假设亚格子尺度应力采用 Smagorinsky 类型的空间滤波涡粘封闭，即 $ \\nu_t = f_w(y^+) \\left(C_s \\Delta\\right)^2 \\left|\\frac{dU}{dy}\\right| $，其中 $C_s$ 是 Smagorinsky 常数，$\\Delta$ 是等同于网格间距的滤波宽度，$f_w(y^+)$ 是用壁面单位 $y^+ = \\frac{y u_\\tau}{\\nu}$ 表示的近壁阻尼函数。将比较两种不同的阻尼公式：\n- van Driest 阻尼函数 $ f_\\text{vd}(y^+) = \\left(1 - \\exp\\left(-\\frac{y^+}{A^+}\\right)\\right)^2 $，参数为 $A^+$。\n- 代数阻尼函数 $ f_\\text{alg}(y^+) = \\frac{y^+}{y^+ + B^+} $，参数为 $B^+$。\n\n利用平均动量平衡、涡粘封闭和壁面无滑移边界条件，在给定的壁面法向位置 $y$ 处，推导平均剪切 $ G(y) = \\frac{dU}{dy} $ 与 $ \\nu $、$ \\nu_t(G,y) $ 以及总应力分布之间的局部代数关系。然后，对于间距为 $ \\Delta y = \\frac{h}{N} $ 的均匀网格，且第一个离壁网格中心位于 $ y_1 = \\frac{\\Delta y}{2} $，将预测的粘性壁面切应力定义为在 $ y_1 $ 处使用局部平均剪切计算的近壁粘性贡献，即 $ \\tau_w^\\text{pred} = \\rho \\nu G(y_1) $。该代理量化了近壁梯度法从第一个离壁位置的解析速度中推断出的结果。\n\n假设 $ h = 1 $ 并通过设置 $ \\rho = 1 $、$ u_\\tau = 1 $ 进行无量纲化，因此在这些单位中 $ \\nu = \\frac{1}{Re_\\tau} $ 且真实壁面切应力为 $ \\tau_w = \\rho u_\\tau^2 = 1 $。采用 $ \\Delta = \\Delta y $ 和 $ C_s = 0.17 $。对于每种阻尼公式 $ f_w(y^+) $ 和每种网格分辨率 $N$，通过求解总应力与涡粘模型耦合所隐含的 $ G(y_1) $ 的代数关系，计算出 $ y_1 $ 处的 $ \\tau_w^\\text{pred} $，然后构成 $ \\tau_w^\\text{pred} = \\nu G(y_1) $。\n\n您的程序必须为以下测试套件实现此过程：\n- 案例 1（粗网格）：$ Re_\\tau = 180 $，$ N = 8 $，$ A^+ = 26 $，$ B^+ = 50 $。\n- 案例 2（中等网格）：$ Re_\\tau = 180 $，$ N = 32 $，$ A^+ = 26 $，$ B^+ = 50 $。\n- 案例 3（细网格）：$ Re_\\tau = 180 $，$ N = 128 $，$ A^+ = 26 $，$ B^+ = 50 $。\n\n对于每个案例，计算两个浮点数：使用 van Driest 阻尼和使用代数阻尼的归一化预测粘性壁面切应力。所有切应力均以 $ \\rho u_\\tau^2 $ 为单位表示（即无量纲），并且输出中不包含任何单位符号。您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，顺序为 $ [\\tau_{w,\\text{vd}}^\\text{pred}(\\text{案例 1}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{案例 1}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{案例 2}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{案例 2}), \\tau_{w,\\text{vd}}^\\text{pred}(\\text{案例 3}), \\tau_{w,\\text{alg}}^\\text{pred}(\\text{案例 3})] $。\n\n通过遵守所述的建模假设来确保科学真实性，并设计您的算法来解决平均剪切和涡粘度之间的局部代数耦合问题，而不要引入超出指定定义的任何特设捷径。每个测试案例的最终输出必须是浮点数。此问题不涉及角度。",
            "solution": "该问题被评估为有效，其科学基础是基于大涡模拟（LES）的湍流建模原理，问题提法得当且客观。所提供的数据和参数对于研究湍流槽道流是一致且标准的。\n\n主要目标是针对 Smagorinsky 类型的亚格子尺度（SGS）模型，使用两种不同的近壁阻尼函数，在三种不同的网格分辨率下计算预测的粘性壁面切应力 $\\tau_w^\\text{pred}$。\n\n首先，我们建立联系平均切应力与平均速度梯度 $G(y) = \\frac{dU}{dy}$ 的控制方程。在充分发展的湍流槽道流中，总切应力 $\\tau_\\text{tot}(y)$ 是粘性应力 $\\tau_\\nu = \\rho \\nu G(y)$ 和建模的 SGS 应力 $\\tau_t = \\rho \\nu_t G(y)$ 的和，其中 $\\nu_t$ 是涡粘度。\n$$\n\\tau_\\text{tot}(y) = \\rho (\\nu + \\nu_t) G(y)\n$$\n问题提供了线性的总应力分布和涡粘度的 Smagorinsky 模型：\n$$\n\\tau_\\text{tot}(y) = \\rho u_\\tau^2 \\left(1 - \\frac{y}{h}\\right)\n$$\n$$\n\\nu_t = f_w(y^+) (C_s \\Delta)^2 \\left|\\frac{dU}{dy}\\right| = f_w(y^+) (C_s \\Delta)^2 |G(y)|\n$$\n此处，$f_w(y^+)$ 是一个依赖于壁面法向距离（以壁面单位计）$y^+ = \\frac{y u_\\tau}{\\nu}$ 的阻尼函数。在近壁区域（$y>0$），平均速度梯度 $G(y)$ 为正，因此我们可以设 $|G(y)| = G(y)$。将 $\\nu_t$ 的表达式代入总应力方程，得到：\n$$\n\\tau_\\text{tot}(y) = \\rho \\left( \\nu + f_w(y^+) (C_s \\Delta)^2 G(y) \\right) G(y)\n$$\n该方程可以重排为关于 $G(y)$ 的标准二次型，$a G(y)^2 + b G(y) + c = 0$：\n$$\n\\left( \\rho f_w(y^+) (C_s \\Delta)^2 \\right) G(y)^2 + (\\rho \\nu) G(y) - \\tau_\\text{tot}(y) = 0\n$$\n系数为：\n$a = \\rho f_w(y^+) (C_s \\Delta)^2$\n$b = \\rho \\nu$\n$c = -\\tau_\\text{tot}(y)$\n\n对于正的剪切梯度 $G(y)$，其物理上有意义的解可以通过选择二次公式的正根来获得：\n$$\nG(y) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}\n$$\n问题指定使用无量纲单位，其中 $h=1$，$\\rho=1$，且 $u_\\tau=1$。这简化了参数：\n- 运动粘度：$\\nu = \\frac{h u_\\tau}{Re_\\tau} = \\frac{1}{Re_\\tau}$\n- 总应力：$\\tau_\\text{tot}(y) = 1 \\cdot 1^2 \\left(1 - \\frac{y}{1}\\right) = 1 - y$\n- 网格间距（滤波宽度）：$\\Delta = \\Delta y = \\frac{h}{N} = \\frac{1}{N}$\n\n我们的任务是评估第一个离壁网格中心 $y_1 = \\frac{\\Delta y}{2} = \\frac{1}{2N}$ 处的剪切。在此位置：\n- 壁面坐标为 $y_1^+ = \\frac{y_1 u_\\tau}{\\nu} = \\frac{1/(2N)}{1/Re_\\tau} = \\frac{Re_\\tau}{2N}$。\n- 总应力为 $\\tau_\\text{tot}(y_1) = 1 - y_1 = 1 - \\frac{1}{2N}$。\n\n当 $\\rho=1$ 时，二次方程的系数变为：\n- $a = f_w(y_1^+) (C_s/N)^2$\n- $b = 1/Re_\\tau$\n- $c = -(1 - 1/(2N))$\n\n我们使用这些系数求解 $G(y_1)$，其中阻尼函数 $f_w(y_1^+)$ 具有两种形式之一：\n1.  van Driest 阻尼：$f_\\text{vd}(y_1^+) = \\left(1 - \\exp\\left(-\\frac{y_1^+}{A^+}\\right)\\right)^2$\n2.  代数阻尼：$f_\\text{alg}(y_1^+) = \\frac{y_1^+}{y_1^+ + B^+}$\n\n最后，预测的粘性壁面切应力 $\\tau_w^\\text{pred}$ 被定义为近壁粘性贡献，即 $\\tau_w^\\text{pred} = \\rho \\nu G(y_1)$。在我们的无量纲单位中，这变为 $\\tau_w^\\text{pred} = \\nu G(y_1) = \\frac{G(y_1)}{Re_\\tau}$。问题要求此值通过 $\\rho u_\\tau^2 = 1$ 进行归一化，因此最终的量就是 $\\frac{G(y_1)}{Re_\\tau}$。\n\n每个测试案例的算法如下：\n1.  设置案例参数：$Re_\\tau$, $N$, $A^+$, $B^+$。\n2.  设置常数：$C_s = 0.17$。\n3.  计算与位置相关的参数：$\\nu = 1/Re_\\tau$, $y_1 = 1/(2N)$, $y_1^+ = Re_\\tau/(2N)$。\n4.  对于两种阻尼函数，$f_\\text{vd}$ 和 $f_\\text{alg}$：\n    a. 计算阻尼函数 $f_w(y_1^+)$ 的值。\n    b. 定义二次方程系数 $a = f_w(y_1^+) (C_s/N)^2$，$b = \\nu$，和 $c = -(1-y_1)$。\n    c. 使用二次公式求解剪切率 $G(y_1)$：$G(y_1) = \\frac{-b + \\sqrt{b^2 - 4ac}}{2a}$。\n    d. 计算预测的壁面切应力：$\\tau_w^\\text{pred} = \\nu G(y_1)$。\n5.  收集该案例的两个计算值 $\\tau_w^\\text{pred}$。\n6.  对所有测试案例重复此过程，并按单个列表格式化结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the predicted viscous wall shear stress in a turbulent channel flow\n    using two different LES damping models for a range of grid resolutions.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Re_tau, N, A_plus, B_plus)\n        (180, 8, 26, 50),\n        (180, 32, 26, 50),\n        (180, 128, 26, 50)\n    ]\n\n    # Universal constants from the problem.\n    # h = 1, rho = 1, u_tau = 1.\n    Cs = 0.17  # Smagorinsky constant\n\n    results = []\n\n    def calculate_predicted_shear(Re_tau, N, A_plus, B_plus):\n        \"\"\"\n        Calculates predicted wall shear for a single case with both damping models.\n        \"\"\"\n        # Derived parameters in non-dimensional units\n        nu = 1.0 / Re_tau\n        y1 = 1.0 / (2.0 * N)\n        y1_plus = Re_tau / (2.0 * N)\n        \n        # Total stress at y1\n        tau_tot_y1 = 1.0 - y1\n\n        # Common quadratic coefficient 'b'. Note rho=1.\n        b = nu\n        # Common quadratic coefficient 'c'\n        c = -tau_tot_y1\n\n        # --- van Driest Damping ---\n        f_vd = (1.0 - np.exp(-y1_plus / A_plus))**2\n        \n        # Quadratic coefficient 'a' for van Driest\n        a_vd = f_vd * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        # a*G^2 + b*G + c = 0\n        discriminant_vd = b**2 - 4 * a_vd * c\n        # The physically meaningful root is the positive one for G.\n        G_vd = (-b + np.sqrt(discriminant_vd)) / (2.0 * a_vd)\n        \n        # Predicted viscous wall shear stress (normalized by rho*u_tau^2 = 1)\n        tau_w_pred_vd = nu * G_vd\n\n        # --- Algebraic Damping ---\n        f_alg = y1_plus / (y1_plus + B_plus)\n        \n        # Quadratic coefficient 'a' for algebraic damping\n        a_alg = f_alg * (Cs / N)**2\n        \n        # Solve quadratic equation for G = dU/dy\n        discriminant_alg = b**2 - 4 * a_alg * c\n        G_alg = (-b + np.sqrt(discriminant_alg)) / (2.0 * a_alg)\n\n        # Predicted viscous wall shear stress\n        tau_w_pred_alg = nu * G_alg\n        \n        return tau_w_pred_vd, tau_w_pred_alg\n\n    for case in test_cases:\n        Re_tau, N, A_plus, B_plus = case\n        tau_vd, tau_alg = calculate_predicted_shear(Re_tau, N, A_plus, B_plus)\n        results.append(tau_vd)\n        results.append(tau_alg)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际的工程模拟中，计算网格通常是各向异性的，即在不同方向上具有不同的单元间距，这对定义亚格子尺度模型中的关键参数——滤波宽度$ \\Delta $——构成了挑战。本次实践旨在研究两种常见的$ \\Delta $定义方式（基于体积的$ \\Delta_V $与基于最大间距的$ \\Delta_M $）如何影响不同SGS模型（包括Smagorinsky、WALE等）对亚格子热通量的预测（）。通过分析由此产生的误差，您将理解不同模型对网格各向异性的敏感性，并学会在复杂的真实世界模拟中应用这些模型的最佳实践。",
            "id": "3988263",
            "problem": "考虑在计算热工学中，各向异性网格上不可压缩流传热的大涡模拟 (LES)。滤波后的动量和能量方程引入了针对未解析应力和标量通量的亚格子尺度 (SGS) 封闭项。设滤波后的速度梯度张量为 $g_{ij} = \\partial \\tilde{u}_i / \\partial x_j$，解析的应变率张量为 $S_{ij} = \\tfrac{1}{2}(g_{ij} + g_{ji})$。解析的温度梯度矢量为 $\\nabla \\tilde{T}$，其分量为 $G_j = \\partial \\tilde{T} / \\partial x_j$。亚格子尺度涡粘性用 $\\nu_t$ 表示，亚格子尺度热扩散率用 $\\alpha_t$ 表示，其中 $\\alpha_t = \\nu_t / \\mathrm{Pr}_t$，$\\mathrm{Pr}_t$ 是湍流普朗特数。模拟的亚格子尺度标量热通量矢量为 $q_j = -\\alpha_t G_j$。\n\n您将评估对于四种封闭模型——Smagorinsky 模型、动态 Smagorinsky 模型、壁面自适应局部涡粘性 (WALE) 模型和标量通量的尺度相似模型，不同滤波宽度 $\\Delta$ 定义对预测的亚格子尺度热通量大小的影响。对于各向异性单元，必须比较两种基于网格的滤波宽度 $\\Delta$ 定义：\n- 基于体积的定义：$\\Delta_V = (\\Delta x \\, \\Delta y \\, \\Delta z)^{1/3}$。\n- 基于最大间距的定义：$\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$。\n\n对于每个模型，计算亚格子尺度涡粘性 $\\nu_t(\\Delta)$ 和由此产生的亚格子尺度热通量大小 $|q(\\Delta)| = \\alpha_t(\\Delta)\\, \\|\\nabla \\tilde{T}\\|_2$，其中 $\\|\\cdot\\|_2$ 表示欧几里得范数。以 $|q(\\Delta_M)|$ 为参考，定义使用基于体积的 $\\Delta_V$ 所引入的相对误差为\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|},\n$$\n该误差是无量纲的，并且必须以十进制数报告。如果 $|q(\\Delta_M)| = 0$，则定义 $E = 0$。\n\n使用的封闭模型：\n- Smagorinsky 模型：$\\nu_t = (C_s \\Delta)^2 \\, |S|$，其中 $|S| = \\sqrt{2 S_{ij} S_{ij}}$ 且 $C_s$ 为常数。\n- 使用 Germano 恒等式（偏张量部分）的动态 Smagorinsky 模型：定义 Leonard 应力 $L_{ij}$ 和测试滤波比 $\\alpha > 1$。使用模型张量\n$$\nM_{ij} = \\widehat{-2 \\Delta^2 |S| S_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{S}| \\, \\widehat{S}_{ij},\n$$\n其中帽子符号表示测试滤波。通过最小化 Germano 恒等式中的误差来计算 $C_s^2$，\n$$\nC_s^2 = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}}{2 M_{ij} M_{ij}}\\right),\n$$\n然后 $\\nu_t = (C_s \\Delta)^2 |S|$。假设所提供的 $L_{ij}$ 和 $\\widehat{S}_{ij}$ 与解析场一致。\n- 壁面自适应局部涡粘性 (WALE) 模型：定义 $G_{ij} = g_{ik} g_{kj}$ 和无迹对称部分 $S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$。令 $S^2 = S_{ij} S_{ij}$ 和 $(S^{d})^2 = S^{d}_{ij} S^{d}_{ij}$。使用\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}},\n$$\n其中 $C_w$ 是一个常数。如有必要，对分母使用一个小的正则化项以避免除零错误。\n- 尺度相似标量通量：通过 Leonard 标量通量矢量 $L^{\\theta}_j = \\widetilde{\\theta u_j} - \\tilde{\\theta}\\,\\tilde{u}_j$ 对亚格子尺度标量通量进行建模，并取 $|q| = \\|L^{\\theta}\\|_2$。这与 $\\Delta$ 无关，因此使用 $\\Delta_V$ 或 $\\Delta_M$ 都会得到相同的 $|q|$，从而 $E = 0$。\n\n所有测试用例中使用的常数：\n- Smagorinsky 常数 $C_s = 0.17$。\n- WALE 常数 $C_w = 0.50$。\n- 湍流普朗特数 $\\mathrm{Pr}_t = 0.70$。\n- 测试滤波比 $\\alpha = 2$。\n\n实现一个程序，为每个测试用例，使用上述公式计算每个模型的相对误差 $E$。您的程序必须将所有测试用例的最终结果以指定格式生成为单行输出。所有输出均为无量纲十进制数。\n\n测试套件输入：\n- 每个测试用例提供单位为 $\\mathrm{m}$ 的 $(\\Delta x, \\Delta y, \\Delta z)$，单位为 $\\mathrm{s}^{-1}$ 的 $3\\times 3$ 张量 $g_{ij}$，单位为 $\\mathrm{K/m}$ 的温度梯度矢量 $\\nabla \\tilde{T}$，定义 $\\widehat{S}_{ij} = \\beta S_{ij}$ 的标量 $\\beta$，定义 $L_{ij} = \\zeta \\,\\widehat{S}_{ij}$ 的标量 $\\zeta$，以及单位为 $\\mathrm{K\\,m/s}$ 的 Leonard 标量通量矢量 $L^{\\theta}$。\n- 测试用例：\n    1. 各向同性中等剪切：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 100$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (1000, 0, 0)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.80$，$\\zeta = 0.010$。\n        - $L^{\\theta} = (0.010, 0.000, 0.000)$ $\\mathrm{K\\,m/s}$。\n    2. 高度各向异性，粗网格方向与温度梯度对齐：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 80$, $g_{23} = 40$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (0, 0, 200)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.60$，$\\zeta = 0.020$。\n        - $L^{\\theta} = (0.000, 0.000, 0.020)$ $\\mathrm{K\\,m/s}$。\n    3. 旋转主导的小应变：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{12} = 300$, $g_{21} = -300$, $g_{11} = 5$, $g_{22} = -5$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (100, 100, 0)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.90$，$\\zeta = 0.005$。\n        - $L^{\\theta} = (0.005, 0.005, 0.000)$ $\\mathrm{K\\,m/s}$。\n    4. 近零应变，强各向异性：\n        - $(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)$ $\\mathrm{m}$。\n        - $g_{ij}$：$g_{11} = 1$, $g_{22} = 1$, $g_{33} = 1$ $\\mathrm{s}^{-1}$，其他为 $0$。\n        - $\\nabla \\tilde{T} = (10, 10, 10)$ $\\mathrm{K/m}$。\n        - $\\beta = 0.50$，$\\zeta = 0.001$。\n        - $L^{\\theta} = (0.0001, 0.0001, 0.0001)$ $\\mathrm{K\\,m/s}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例映射到一个四元素误差列表，顺序为 $[E_{\\mathrm{Smag}}, E_{\\mathrm{Dyn}}, E_{\\mathrm{WALE}}, E_{\\mathrm{SS}}]$。例如，最终程序输出应如下所示\n[[e11,e12,e13,e14],[e21,e22,e23,e24],[e31,e32,e33,e34],[e41,e42,e43,e44]]\n值为十进制数。",
            "solution": "该问题要求分析几种亚格子尺度 (SGS) 模型对各向异性计算网格上滤波宽度 $\\Delta$ 定义的敏感性。在使用基于体积的滤波宽度 $\\Delta_V$ 与基于最大间距的滤波宽度 $\\Delta_M$ 时，需要计算 SGS 热通量大小 $|q|$ 的相对误差 $E$。\n\n该问题在科学上是适定的 (well-posed)，并且指定的模型——Smagorinsky、动态 Smagorinsky、WALE 和尺度相似模型——都是大涡模拟 (LES) 中的标准封闭项。为进行完整分析所需的所有必要数据和常数均已提供。动态模型公式中的一个歧义可以通过采用一个标准简化来解决，我将在相应部分详细说明。因此，该问题被认为是有效的。\n\nSGS 热通量矢量建模为 $q_j = -\\alpha_t G_j$，其中 $\\alpha_t = \\nu_t / \\mathrm{Pr}_t$ 是 SGS 热扩散率，$\\nu_t$ 是 SGS 涡粘性，$\\mathrm{Pr}_t$ 是湍流普朗特数，而 $G_j = \\partial \\tilde{T} / \\partial x_j$ 是解析温度梯度 $\\nabla \\tilde{T}$ 的分量。\n\nSGS 热通量的大小为 $|q(\\Delta)| = \\alpha_t(\\Delta) \\|\\nabla \\tilde{T}\\|_2$，其中 $\\|\\nabla \\tilde{T}\\|_2 = \\sqrt{G_j G_j}$ 是温度梯度的欧几里得范数。滤波宽度 $\\Delta$ 取决于模型，可以是 $\\Delta_V = (\\Delta x \\Delta y \\Delta z)^{1/3}$ 或 $\\Delta_M = \\max(\\Delta x, \\Delta y, \\Delta z)$。\n\n相对误差 $E$ 定义为：\n$$\nE = \\frac{\\big|\\,|q(\\Delta_V)| - |q(\\Delta_M)|\\,\\big|}{|q(\\Delta_M)|}\n$$\n如果 $|q(\\Delta_M)| = 0$，则定义 $E$ 为 $0$。假设 $|q(\\Delta_M)| \\neq 0$，我们可以代入 $|q(\\Delta)|$ 的表达式：\n$$\nE = \\frac{\\left| \\frac{\\nu_t(\\Delta_V)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 - \\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2 \\right|}{\\frac{\\nu_t(\\Delta_M)}{\\mathrm{Pr}_t} \\|\\nabla \\tilde{T}\\|_2}\n$$\n对于给定的测试用例，项 $\\mathrm{Pr}_t$ 和 $\\|\\nabla \\tilde{T}\\|_2$ 是常数并且可以消去，前提是 $\\|\\nabla \\tilde{T}\\|_2 \\neq 0$ 且 $\\nu_t(\\Delta_M) \\neq 0$。这将误差表达式简化为仅依赖于涡粘性：\n$$\nE = \\left| \\frac{\\nu_t(\\Delta_V)}{\\nu_t(\\Delta_M)} - 1 \\right|\n$$\n我们将分析每种模型中 $\\nu_t$ 与 $\\Delta$ 的标度关系。\n\n**1. Smagorinsky 模型**\n涡粘性为 $\\nu_t = (C_s \\Delta)^2 |S|$，其中 $|S| = \\sqrt{2 S_{ij} S_{ij}}$ 且 $S_{ij} = \\frac{1}{2}(\\partial_j \\tilde{u}_i + \\partial_i \\tilde{u}_j)$。\n这里，$\\nu_t$ 与 $\\Delta^2$ 成正比：$\\nu_t(\\Delta) \\propto \\Delta^2$。\n因此，如果 $|S| \\neq 0$：\n$$\nE_{\\mathrm{Smag}} = \\left| \\frac{(C_s \\Delta_V)^2 |S|}{(C_s \\Delta_M)^2 |S|} - 1 \\right| = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\n如果 $|S| = 0$，则对于所有 $\\Delta$，$\\nu_t = 0$，使得 $|q|=0$，因此 $E_{\\mathrm{Smag}}=0$。对于各向同性网格，$\\Delta_V = \\Delta_M$，所以 $E_{\\mathrm{Smag}}=0$。\n\n**2. 动态 Smagorinsky 模型**\n涡粘性为 $\\nu_t = (C_s \\Delta)^2 |S|$，但 $C_s$ 现在是动态计算的。根据问题陈述，动态系数为：\n$$\nC_s^2(\\Delta) = \\max\\!\\left(0, \\frac{L_{ij} M_{ij}(\\Delta)}{2 M_{kl}(\\Delta) M_{kl}(\\Delta)}\\right)\n$$\n模型张量为 $M_{ij}(\\Delta) = \\widehat{-2 \\Delta^2 |S| S_{ij}} + 2 \\alpha^2 \\Delta^2 |\\widehat{S}| \\, \\widehat{S}_{ij}$。\n问题提供了简化条件：$\\widehat{S}_{ij} = \\beta S_{ij}$ 和 $L_{ij} = \\zeta \\widehat{S}_{ij} = \\zeta \\beta S_{ij}$。\n为了继续进行，需要对项 $\\widehat{|S| S_{ij}}$ 做一个假设。在这类分析中，标准的做法是假设滤波操作对乘积近似满足分配律，即 $\\widehat{|S| S_{ij}} \\approx |\\widehat{S}| \\widehat{S}_{ij}$。\n据此，并注意到 $|\\widehat{S}| = \\sqrt{2 \\widehat{S}_{pq}\\widehat{S}_{pq}} = \\sqrt{2 \\beta^2 S_{pq}S_{pq}} = \\beta|S|$，我们有 $\\widehat{|S| S_{ij}} \\approx (\\beta|S|)(\\beta S_{ij}) = \\beta^2|S|S_{ij}$。\n将此代入 $M_{ij}(\\Delta)$ 的表达式中：\n$$\nM_{ij}(\\Delta) \\approx -2 \\Delta^2 (\\beta^2 |S| S_{ij}) + 2 \\alpha^2 \\Delta^2 (\\beta|S|) (\\beta S_{ij}) = 2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{ij}\n$$\n现在我们计算 $C_s^2(\\Delta)$ 的分数：\n$L_{ij} M_{ij}(\\Delta) = \\sum_{i,j} (\\zeta \\beta S_{ij}) (2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{ij}) = 2 \\zeta \\beta^3 |S| (\\alpha^2 - 1) \\Delta^2 (S_{kl}S_{kl})$。\n$2 M_{kl}(\\Delta) M_{kl}(\\Delta) = 2 \\sum_{k,l} (2 \\Delta^2 \\beta^2 |S| (\\alpha^2 - 1) S_{kl})^2 = 8 \\Delta^4 \\beta^4 |S|^2 (\\alpha^2-1)^2 (S_{mn}S_{mn})$。\n$$\n\\frac{L_{ij} M_{ij}}{2 M_{kl} M_{kl}} = \\frac{2 \\zeta \\beta^3 |S| (\\alpha^2-1) \\Delta^2}{8 \\Delta^4 \\beta^4 |S|^2 (\\alpha^2-1)^2} = \\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}\n$$\n假设此项为正，则 $C_s^2(\\Delta) = \\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}$。\n那么涡粘性为：\n$$\n\\nu_t(\\Delta) = C_s^2(\\Delta) \\Delta^2 |S| = \\left(\\frac{\\zeta}{4 \\beta |S| (\\alpha^2-1) \\Delta^2}\\right) \\Delta^2 |S| = \\frac{\\zeta}{4 \\beta (\\alpha^2-1)}\n$$\n值得注意的是，在这些简化假设下，$\\nu_t$ 与 $\\Delta$ 无关。因此，$\\nu_t(\\Delta_V) = \\nu_t(\\Delta_M)$，这意味着 $|q(\\Delta_V)| = |q(\\Delta_M)|$。误差表达式的分子为零。因此，对于所有测试用例，$E_{\\mathrm{Dyn}}=0$。\n\n**3. 壁面自适应局部涡粘性 (WALE) 模型**\n涡粘性为：\n$$\n\\nu_t = (C_w \\Delta)^2 \\, \\frac{\\left((S^{d})^2\\right)^{3/2}}{\\left(S^2\\right)^{5/2} + \\left((S^{d})^2\\right)^{5/4}}\n$$\n其中 $S^2=S_{ij}S_{ij}$ 和 $(S^d)^2=S^d_{ij}S^d_{ij}$，而 $S^{d}_{ij} = \\tfrac{1}{2}(G_{ij} + G_{ji}) - \\tfrac{1}{3}\\delta_{ij} G_{kk}$ 且 $G_{ij} = g_{ik}g_{kj}$。\n分数部分与 $\\Delta$ 无关。设其为 $\\mathcal{W}$。则 $\\nu_t = (C_w \\Delta)^2 \\mathcal{W}$。\n与 Smagorinsky 模型类似，$\\nu_t \\propto \\Delta^2$。\n$$\nE_{\\mathrm{WALE}} = \\left| \\frac{\\Delta_V^2}{\\Delta_M^2} - 1 \\right|\n$$\n此结论成立的前提是 WALE 应变项 $\\mathcal{W}$ 不为零。如果 $\\mathcal{W}=0$（当 $S^d_{ij}$ 为零张量时发生），则 $\\nu_t=0$，$|q|=0$，且 $E_{\\mathrm{WALE}}=0$。对于各向同性网格，$\\Delta_V = \\Delta_M$，所以 $E_{\\mathrm{WALE}}=0$。\n\n**4. 尺度相似模型**\nSGS 热通量大小 $|q|$ 直接建模为 $\\|L^{\\theta}\\|_2$，其中 $L^{\\theta}$ 是 Leonard 标量通量矢量。该模型不依赖于 $\\Delta$。\n因此， $|q(\\Delta_V)| = |q(\\Delta_M)| = \\|L^{\\theta}\\|_2$，误差恒为零：$E_{\\mathrm{SS}}=0$。\n\n**测试用例分析**\n\n**测试用例 1：各向同性中等剪切**\n- 网格：$(\\Delta x, \\Delta y, \\Delta z) = (0.01, 0.01, 0.01)\\,\\mathrm{m}$。这是一个各向同性网格。\n- $\\Delta_M = 0.01\\,\\mathrm{m}$。\n- $\\Delta_V = (0.01^3)^{1/3} = 0.01\\,\\mathrm{m}$。\n由于 $\\Delta_V = \\Delta_M$，比率 $\\Delta_V^2/\\Delta_M^2 = 1$。所有模型的误差 $E$ 均为 $0$。\n- $E_{\\mathrm{Smag}} = 0$, $E_{\\mathrm{Dyn}} = 0$, $E_{\\mathrm{WALE}} = 0$, $E_{\\mathrm{SS}} = 0$。\n- 结果：$[0.0, 0.0, 0.0, 0.0]$。\n\n**测试用例 2：高度各向异性，粗网格方向与温度梯度对齐**\n- 网格：$(\\Delta x, \\Delta y, \\Delta z) = (0.002, 0.020, 0.050)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.05\\,\\mathrm{m}$。\n- $\\Delta_V = (0.002 \\cdot 0.02 \\cdot 0.05)^{1/3} = (2 \\times 10^{-9})^{1/3} \\approx 0.0012599\\,\\mathrm{m}$。\n- 误差因子：$|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.0012599}{0.05})^2 - 1| \\approx |0.000635 - 1| \\approx 0.999365$。\n- 动力学：$g_{ij}$ 具有 $g_{12}=80, g_{23}=40$。$S_{12}=40, S_{21}=40, S_{23}=20, S_{32}=20$。$|S|=\\sqrt{2(2\\cdot40^2 + 2\\cdot20^2)} = \\sqrt{8000} \\neq 0$。所以 $E_{\\mathrm{Smag}} \\approx 0.999365$。\n- 对于 WALE 模型，$g = \\tiny\\begin{pmatrix} 0  80  0 \\\\ 0  0  40 \\\\ 0  0  0 \\end{pmatrix}$，$G=gg=\\tiny\\begin{pmatrix} 0  0  3200 \\\\ 0  0  0 \\\\ 0  0  0 \\end{pmatrix}$。$G_{kk}=0$。$S^d = \\frac{1}{2}(G+G^T) = \\tiny\\begin{pmatrix} 0  0  1600 \\\\ 0  0  0 \\\\ 1600  0  0 \\end{pmatrix}$。由于 $S^d \\neq 0$，WALE 项不为零。$E_{\\mathrm{WALE}} \\approx 0.999365$。\n- 结果：$[0.9993650401363183, 0.0, 0.9993650401363183, 0.0]$。\n\n**测试用例 3：旋转主导的小应变**\n- 网格：$(\\Delta x, \\Delta y, \\Delta z) = (0.010, 0.050, 0.050)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.05\\,\\mathrm{m}$。\n- $\\Delta_V = (0.01 \\cdot 0.05 \\cdot 0.05)^{1/3} = (2.5 \\times 10^{-5})^{1/3} \\approx 0.029240\\,\\mathrm{m}$。\n- 误差因子：$|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.029240}{0.05})^2 - 1| \\approx |0.341995 - 1| \\approx 0.658005$。\n- 动力学：$g_{11}=5, g_{22}=-5, g_{12}=300, g_{21}=-300$。$S_{11}=5, S_{22}=-5$，其他 $S_{ij}=0$。$|S|=\\sqrt{2(5^2 + (-5)^2)} = 10 \\neq 0$。所以 $E_{\\mathrm{Smag}} \\approx 0.658005$。\n- 对于 WALE 模型，$g = \\tiny\\begin{pmatrix} 5  300  0 \\\\ -300  -5  0 \\\\ 0  0  0 \\end{pmatrix}$，$G = gg = \\tiny\\begin{pmatrix} -89975  0  0 \\\\ 0  -89975  0 \\\\ 0  0  0 \\end{pmatrix}$。$G_{kk} = -179950$。$S^d = G - \\frac{1}{3}I G_{kk} \\neq 0$。因此，WALE 项不为零。$E_{\\mathrm{WALE}} \\approx 0.658005$。\n- 结果：$[0.6580049887114946, 0.0, 0.6580049887114946, 0.0]$。\n\n**测试用例 4：近零应变，强各向异性**\n- 网格：$(\\Delta x, \\Delta y, \\Delta z) = (0.005, 0.005, 0.100)\\,\\mathrm{m}$。\n- $\\Delta_M = 0.1\\,\\mathrm{m}$。\n- $\\Delta_V = (0.005 \\cdot 0.005 \\cdot 0.1)^{1/3} = (2.5 \\times 10^{-6})^{1/3} \\approx 0.013572\\,\\mathrm{m}$。\n- 误差因子：$|\\frac{\\Delta_V^2}{\\Delta_M^2} - 1| = |(\\frac{0.013572}{0.1})^2 - 1| \\approx |0.01842 - 1| \\approx 0.9815799$。\n- 动力学：$g_{11}=1, g_{22}=1, g_{33}=1$。$S=I$（单位矩阵）。$|S| = \\sqrt{2(1^2+1^2+1^2)} = \\sqrt{6} \\neq 0$。所以 $E_{\\mathrm{Smag}} \\approx 0.9815799$。\n- 对于 WALE 模型，$g=I$，所以 $G = gg = I$。$G_{kk} = \\mathrm{tr}(I)=3$。$S^d = G - \\frac{1}{3}I G_{kk} = I - \\frac{1}{3}I(3) = I-I=0$。WALE 应变项为零。因此，$\\nu_t=0$ 且 $E_{\\mathrm{WALE}}=0$。该用例突出了 Smagorinsky 和 WALE 模型之间的一个关键区别。\n- 结果：$[0.9815799184534942, 0.0, 0.0, 0.0]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative error E for four SGS models based on different\n    filter width definitions for several test cases in LES.\n    \"\"\"\n\n    # Define constants from the problem statement.\n    # These are not used in the final simplified error calculation,\n    # but are included for completeness.\n    # C_s = 0.17\n    # C_w = 0.50\n    # Pr_t = 0.70\n    # alpha = 2.0\n\n    test_cases = [\n        {\n            \"name\": \"Isotropic moderate shear\",\n            \"deltas\": np.array([0.01, 0.01, 0.01]),\n            \"g\": np.array([[0., 100., 0.], [0., 0., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([1000., 0., 0.])\n        },\n        {\n            \"name\": \"Highly anisotropic, coarse dir aligned with T-grad\",\n            \"deltas\": np.array([0.002, 0.020, 0.050]),\n            \"g\": np.array([[0., 80., 0.], [0., 0., 40.], [0., 0., 0.]]),\n            \"grad_T\": np.array([0., 0., 200.])\n        },\n        {\n            \"name\": \"Rotation-dominated with small strain\",\n            \"deltas\": np.array([0.010, 0.050, 0.050]),\n            \"g\": np.array([[5., 300., 0.], [-300., -5., 0.], [0., 0., 0.]]),\n            \"grad_T\": np.array([100., 100., 0.])\n        },\n        {\n            \"name\": \"Near-zero strain, strong anisotropy\",\n            \"deltas\": np.array([0.005, 0.005, 0.100]),\n            \"g\": np.array([[1., 0., 0.], [0., 1., 0.], [0., 0., 1.]]),\n            \"grad_T\": np.array([10., 10., 10.])\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        deltas = case[\"deltas\"]\n        g = case[\"g\"]\n\n        # Calculate filter widths\n        delta_V = np.prod(deltas)**(1/3)\n        delta_M = np.max(deltas)\n\n        # The error E for models with nu_t proportional to Delta^2 simplifies to\n        # |(delta_V/delta_M)^2 - 1|.\n        # This is zero if the grid is isotropic (delta_V == delta_M).\n        if delta_M == 0:\n            error_factor = 0.0\n        else:\n            error_factor = abs((delta_V/delta_M)**2 - 1)\n\n        # ---------- Model Calculations ----------\n\n        # 1. Smagorinsky Model\n        # E_smag depends on whether the strain rate magnitude |S| is zero.\n        S = 0.5 * (g + g.T)\n        S_sq_sum = np.sum(S**2) # S_ij * S_ij\n        S_mag_sq = 2 * S_sq_sum\n        \n        # If |S| = 0, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_smag = error_factor if S_mag_sq > 1e-20 else 0.0\n        \n        # 2. Dynamic Smagorinsky Model\n        # As derived in the solution, under the problem's simplifications,\n        # nu_t is independent of Delta. Thus, E_dyn is always 0.\n        E_dyn = 0.0\n\n        # 3. WALE Model\n        # E_wale depends on whether the WALE strain term is zero.\n        # This term is zero if S^d_ij is zero.\n        G = np.matmul(g, g)\n        G_kk = np.trace(G)\n        # We need the symmetric part of G for S^d\n        G_sym = 0.5 * (G + G.T)\n        S_d = G_sym - (1/3) * G_kk * np.identity(3)\n        S_d_sq_sum = np.sum(S_d**2)\n        \n        # Denominator of the WALE strain term\n        # A small epsilon is added for regularization, though S_mag_sq check is primary\n        wale_denom = S_sq_sum**(5/2) + S_d_sq_sum**(5/4) + 1e-20\n        wale_strain_term_numerator = S_d_sq_sum**(3/2)\n\n        # If the numerator is zero, nu_t = 0, so |q| = 0 and E is defined as 0.\n        E_wale = error_factor if wale_strain_term_numerator > 1e-20 else 0.0\n\n        # 4. Scale-Similarity Model\n        # |q| is independent of Delta, so E_ss is always 0.\n        E_ss = 0.0\n\n        errors = [E_smag, E_dyn, E_wale, E_ss]\n        all_results.append(errors)\n\n    # Format the results into the spec's required output string.\n    # Example: \"[[e11,e12,e13,e14],[e21,e22,e23,e24],...]\"\n    # The skeleton print statement implies no spaces, so I will build it manually.\n    results_as_str_lists = []\n    for res_list in all_results:\n        # Format each list of floats into a string like \"[f1,f2,f3,f4]\"\n        # Using map(str,...) to get default float representation.\n        str_list = f\"[{','.join(map(str, res_list))}]\"\n        results_as_str_lists.append(str_list)\n\n    final_output_str = f\"[{','.join(results_as_str_lists)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}