{
    "hands_on_practices": [
        {
            "introduction": "在进行复杂的计算模拟之前，深刻理解其背后的物理模型至关重要。本练习将引导您推导Scheil方程，这是描述合金凝固过程中溶质再分配的一个基石模型。通过这个推导，您将掌握在非平衡凝固条件下，溶质在液相中富集如何动态地改变局部液相线温度，这是任何精确的糊状区模型都必须捕捉的关键物理效应。",
            "id": "3974918",
            "problem": "考虑一个正在进行定向凝固的二元合金，其糊状区跨越固相线和液相线之间的温度范围。假设在固-液界面处满足局部热力学平衡，固相中的溶质扩散可忽略不计，且液相为完全混合状态。这些是 Scheil 模型的经典假设。定义溶质分配系数为 $k = C_{S}/C_{L}$，其中 $C_{S}$ 是在界面处形成的固相的瞬时溶质质量分数，$C_{L}$ 是相邻液相的瞬时溶质质量分数。设初始整体溶质质量分数为 $C_{0}$，固相分数用 $f_{S}$ 表示。\n\n从糊状区中一个无穷小控制体积内的溶质守恒以及分配系数的定义出发，在 Scheil 假设下，推导剩余液相中溶质富集浓度 $C_{L}$ 作为 $f_{S}$ 函数的表达式。然后，利用合金成分附近的线性化相图，通过液相线关系式 $T_{L}(C) = T_{L}^{0} + m_{L}\\,C$ 来量化这种富集如何改变局部液相线温度，其中 $T_{L}^{0}$ 是纯溶剂的液相线温度，$m_{L}$ 是液相线相对于溶质质量分数 $C$ 的（恒定）斜率。\n\n使用以下参数值：$k = 0.3$，$C_{0} = 0.05$（无量纲溶质质量分数），$T_{L}^{0} = 933\\,\\mathrm{K}$，$m_{L} = -250\\,\\mathrm{K}$ 每单位溶质质量分数，并在 $f_{S} = 0.8$ 时评估结果。计算由富集导致的液相线温度 $T_{L}\\!\\left(C_{L}(f_{S})\\right)$，并报告该最终温度。将您的答案四舍五入至四位有效数字，并以 $\\mathrm{K}$ 为单位表示最终温度。",
            "solution": "该问题是有效的。这是一个在材料科学和凝固处理领域中，基于经典的 Scheil-Gulliver 模型的适定问题。所有必要的假设、定义和数据均已提供，并且它们在科学上是合理且一致的。\n\n第一个任务是推导 Scheil 方程，该方程描述了液相中的溶质浓度 $C_{L}$ 作为固相分数 $f_{S}$ 的函数。该推导基于一个微分控制体积上的溶质质量平衡，其假设条件为固相中无扩散、液相中完全混合以及界面处局部平衡。\n\n让我们考虑一个单位质量的系统。总溶质浓度为 $C_{0}$。随着凝固的进行，无穷小质量的固相 $df_{S}$ 从液相中形成。在任何给定时刻，剩余液相的质量为 $(1 - f_{S})$。液相中溶质的总量为 $C_{L}(1 - f_{S})$。\n\n随着凝固的进行，液相中溶质含量的变化由微分 $d\\left(C_{L}(1 - f_{S})\\right)$ 给出。使用乘积法则求导，我们有：\n$$d\\left(C_{L}(1 - f_{S})\\right) = (1 - f_{S})dC_{L} + C_{L}d(1 - f_{S}) = (1 - f_{S})dC_{L} - C_{L}df_{S}$$\n\n溶质含量的这种变化必须等于离开液相形成新固相的溶质的量。新形成的固相质量为 $df_S$。该固相的浓度为 $C_S$。因此，从液相中移除的溶质质量为 $C_{S}df_{S}$。因此，液相中的溶质量减少了此数量。这给出了溶质平衡方程：\n$$d\\left(C_{L}(1 - f_{S})\\right) = -C_{S}df_{S}$$\n\n将液相中溶质含量变化的两个表达式相等，我们得到：\n$$(1 - f_{S})dC_{L} - C_{L}df_{S} = -C_{S}df_{S}$$\n\n问题指出，界面处维持局部热力学平衡，这使我们能够使用分配系数 $k = C_{S}/C_{L}$。将 $C_{S} = k C_{L}$ 代入平衡方程：\n$$(1 - f_{S})dC_{L} - C_{L}df_{S} = -kC_{L}df_{S}$$\n\n我们现在可以重新整理方程以分离变量 $C_{L}$ 和 $f_{S}$：\n$$(1 - f_{S})dC_{L} = (C_{L} - kC_{L})df_{S}$$\n$$(1 - f_{S})dC_{L} = (1 - k)C_{L}df_{S}$$\n$$\\frac{dC_{L}}{C_{L}} = (1 - k)\\frac{df_{S}}{1 - f_{S}}$$\n\n为了找到 $C_{L}$ 和 $f_{S}$ 之间的关系，我们对这个微分方程进行积分。积分从凝固开始时进行，此时 $f_{S}=0$ 且液相浓度为初始整体浓度 $C_{L}=C_{0}$，直到一个由固相分数 $f_{S}$ 和相应的液相浓度 $C_{L}$ 定义的任意状态。\n$$\\int_{C_{0}}^{C_{L}} \\frac{dC'_{L}}{C'_{L}} = \\int_{0}^{f_{S}} (1 - k)\\frac{df'_{S}}{1 - f'_{S}}$$\n\n左侧积分为：\n$$\\left[ \\ln(C'_{L}) \\right]_{C_{0}}^{C_{L}} = \\ln(C_{L}) - \\ln(C_{0}) = \\ln\\left(\\frac{C_{L}}{C_{0}}\\right)$$\n\n右侧积分为：\n$$(1 - k) \\int_{0}^{f_{S}} \\frac{df'_{S}}{1 - f'_{S}} = (1 - k) \\left[ -\\ln(1 - f'_{S}) \\right]_{0}^{f_{S}} = (1 - k) \\left( -\\ln(1 - f_{S}) - (-\\ln(1)) \\right) = -(1 - k)\\ln(1 - f_{S})$$\n这可以重写为 $(k - 1)\\ln(1 - f_{S})$。\n\n将两边积分的结果相等：\n$$\\ln\\left(\\frac{C_{L}}{C_{0}}\\right) = (k - 1)\\ln(1 - f_{S})$$\n\n通过对两边取指数，我们得到 $C_{L}$ 作为 $f_{S}$ 函数的最终表达式，即 Scheil 方程：\n$$C_{L}(f_{S}) = C_{0}(1 - f_{S})^{k-1}$$\n\n第二个任务是使用这个强大的结果来计算特定固相分数下的液相线温度。我们给定了以下参数值：\n- 分配系数：$k = 0.3$\n- 初始溶质质量分数：$C_{0} = 0.05$\n- 用于评估的固相分数：$f_{S} = 0.8$\n- 纯溶剂的液相线温度：$T_{L}^{0} = 933\\,\\mathrm{K}$\n- 液相线斜率：$m_{L} = -250\\,\\mathrm{K}$\n\n首先，我们计算当固相分数 $f_{S}$ 达到 $0.8$ 时，液相中富集的溶质浓度 $C_{L}$：\n$$C_{L}(0.8) = C_{0}(1 - 0.8)^{k-1} = 0.05(0.2)^{0.3-1} = 0.05(0.2)^{-0.7}$$\n$$C_{L}(0.8) \\approx 0.05 \\times 3.085235 = 0.15426175$$\n\n接下来，我们使用线性化液相线方程 $T_{L}(C) = T_{L}^{0} + m_{L}\\,C$，来找到与此富集液相浓度相对应的液相线温度。该温度表示当 $f_S = 0.8$ 时固-液界面处的平衡温度。\n$$T_{L}(C_{L}(0.8)) = T_{L}^{0} + m_{L} \\times C_{L}(0.8)$$\n$$T_{L} = 933\\,\\mathrm{K} + (-250\\,\\mathrm{K}) \\times 0.15426175$$\n$$T_{L} = 933\\,\\mathrm{K} - 38.5654375\\,\\mathrm{K}$$\n$$T_{L} = 894.4345625\\,\\mathrm{K}$$\n\n问题要求将最终答案四舍五入至四位有效数字。\n计算出的温度为 $894.4345625\\,\\mathrm{K}$。前四位有效数字是 $8$、$9$、$4$ 和 $4$。第五位数字是 $3$，小于 $5$，所以我们向下取整。\n最终结果是 $894.4\\,\\mathrm{K}$。",
            "answer": "$$\\boxed{894.4}$$"
        },
        {
            "introduction": "从物理模型到数值实现，一个关键的挑战是确保算法的稳定性。本练习将带您深入探讨显式时间积分方案中的一个核心问题：时间步长的选择。您将基于能量守恒方程，为包含热对流和非平衡潜热释放动力学的糊状区模型，推导出一个严格的稳定性判据。掌握这项技能对于开发稳健、高效的凝固模拟程序至关重要，能有效避免模拟结果出现非物理震荡或发散。",
            "id": "3974915",
            "problem": "一个空间维度下的二元合金单向凝固过程采用基于焓的糊状区模型进行建模。糊状区的温度范围在固相线温度 $T_{s}$ 和液相线温度 $T_{l}$ 之间，局部液相分数被建模为温度的线性函数，\n$$\nf_{l}(T) = \\frac{T - T_{s}}{T_{l} - T_{s}} \\quad \\text{for} \\quad T_{s} \\leq T \\leq T_{l}.\n$$\n体积焓定义为\n$$\nh(T,f_{l}) = \\rho c_{p} T + \\rho L f_{l}(T),\n$$\n其中 $\\rho$ 是质量密度，$c_{p}$ 是定压比热容，$L$ 是单位质量熔化潜热。表观热容是焓对温度的导数，\n$$\nc_{\\text{app}}(T) = \\frac{\\partial h}{\\partial T} = \\rho c_{p} + \\rho L \\frac{\\partial f_{l}}{\\partial T} = \\rho c_{p} + \\frac{\\rho L}{T_{l} - T_{s}}.\n$$\n\n假设采用以下建模和数值离散化选择：\n- 糊状区中的能量守恒方程通过将焓方程除以 $c_{\\text{app}}(T)$，以温度形式进行时间推进。\n- 显热的平流通过恒定的液体速度 $u$（从热液体流向冷固体）来建模，在温度方程除以 $c_{\\text{app}}(T)$ 之前，贡献了 $\\rho c_{p} u \\, \\partial T / \\partial x$ 这一项。\n- 非平衡凝固动力学通过液相分数向液相线状态的线性弛豫在糊状区内部建模，表示为潜热源项 $S(T) = - \\rho L M \\left( T - T_{l} \\right)$，其中 $M$ 为常数迁移率（单位为 $\\text{s}^{-1}\\,\\text{K}^{-1}$）。该源项在除以 $c_{\\text{app}}(T)$ 后进入温度方程。\n- 热扩散被完全隐式处理，不施加显式时间步长约束。\n- 空间离散化是均匀的，单元尺寸为 $\\Delta x$，平流采用一阶迎风格式离散化。平流项和源项的时间推进采用前向欧拉法。\n\n从以焓表示的能量守恒和上述本构关系出发，通过对温度的前向欧拉更新中的系数强制执行非负性和单調性，推导出对显式时间步长 $\\Delta t$ 的稳定性要求。您的推导应从控制焓形式开始，得到显式温度更新系数，然后强制施加条件，从而得到两个类似于 Courant-Friedrichs-Lewy (CFL) 的约束：\n1. 一个与温度平流相关（由 $c_{\\text{app}}(T)$ 修正）。\n2. 一个与动力学引起的显式潜热源项相关。\n\n将这些约束组合成一个最大稳定时间步长 $\\Delta t_{\\max}$ 的单一表达式，即为您获得的两个界限的最小值。然后，使用以下材料和数值参数对 $\\Delta t_{\\max}$ 进行数值计算：\n- $\\rho = 7.8 \\times 10^{3} \\ \\text{kg} \\ \\text{m}^{-3}$，\n- $c_{p} = 6.0 \\times 10^{2} \\ \\text{J} \\ \\text{kg}^{-1} \\ \\text{K}^{-1}$，\n- $L = 2.6 \\times 10^{5} \\ \\text{J} \\ \\text{kg}^{-1}$，\n- $T_{l} - T_{s} = 3.0 \\times 10^{1} \\ \\text{K}$，\n- $\\Delta x = 1.0 \\times 10^{-4} \\ \\text{m}$，\n- $u = 1.0 \\times 10^{-2} \\ \\text{m} \\ \\text{s}^{-1}$，\n- $M = 1.0 \\times 10^{2} \\ \\text{s}^{-1} \\ \\text{K}^{-1}$。\n\n将您最终的 $\\Delta t_{\\max}$ 数值答案四舍五入到三位有效数字。以秒为单位表示最终答案。",
            "solution": "起点是一个代表性糊状控制体积的焓形式能量守恒方程，\n$$\n\\frac{\\partial h}{\\partial t} + \\frac{\\partial}{\\partial x}\\left( \\rho c_{p} T \\, u \\right) = \\frac{\\partial}{\\partial x}\\left( k \\, \\frac{\\partial T}{\\partial x} \\right),\n$$\n我们在方程右侧添加非平衡潜热动力学作为体积源 $S(T)$。写出带有源项的完整焓方程，\n$$\n\\frac{\\partial h}{\\partial t} + \\rho c_{p} u \\, \\frac{\\partial T}{\\partial x} = \\frac{\\partial}{\\partial x}\\left( k \\, \\frac{\\partial T}{\\partial x} \\right) + S(T).\n$$\n根据焓的定义 $h(T,f_{l}) = \\rho c_{p} T + \\rho L f_{l}(T)$，焓的全时间导数为\n$$\n\\frac{\\partial h}{\\partial t} = \\left( \\rho c_{p} + \\rho L \\frac{\\partial f_{l}}{\\partial T} \\right) \\frac{\\partial T}{\\partial t} = c_{\\text{app}}(T) \\, \\frac{\\partial T}{\\partial t},\n$$\n其中，对于糊状区内的线性 $f_{l}(T)$，\n$$\n\\frac{\\partial f_{l}}{\\partial T} = \\frac{1}{T_{l} - T_{s}}, \\qquad c_{\\text{app}}(T) = \\rho c_{p} + \\frac{\\rho L}{T_{l} - T_{s}}.\n$$\n\n将能量方程除以 $c_{\\text{app}}(T)$ 以获得温度演化形式，\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\rho c_{p} u}{c_{\\text{app}}(T)} \\, \\frac{\\partial T}{\\partial x} = \\frac{1}{c_{\\text{app}}(T)} \\, \\frac{\\partial}{\\partial x}\\left( k \\, \\frac{\\partial T}{\\partial x} \\right) + \\frac{S(T)}{c_{\\text{app}}(T)}.\n$$\n根据假设，扩散项被隐式处理，不约束显式时间步长。显式部分是平流项和源项。我们对平流项（$u > 0$）使用一阶迎风离散格式，时间上使用前向欧拉法，对于网格单元 $i$ 得到\n$$\nT_{i}^{n+1} = T_{i}^{n} - \\Delta t \\, \\frac{\\rho c_{p} u}{c_{\\text{app}}} \\, \\frac{T_{i}^{n} - T_{i-1}^{n}}{\\Delta x} + \\Delta t \\, \\frac{S(T_{i}^{n})}{c_{\\text{app}}}.\n$$\n\n现在我们通过对乘以旧时刻值的系数强制执行非负性和单调性来分析此显式更新的稳定性。对于一阶迎风平流，确保 $T_{i}^{n}$ 的系数保持非负的 Courant-Friedrichs-Lewy (CFL) 条件是\n$$\n\\Delta t \\, \\frac{\\rho c_{p} u}{c_{\\text{app}}} \\, \\frac{1}{\\Delta x} \\leq 1 \\quad \\Longrightarrow \\quad \\Delta t \\leq \\Delta t_{\\text{adv}} \\equiv \\frac{c_{\\text{app}}}{\\rho c_{p}} \\, \\frac{\\Delta x}{u}.\n$$\n\n对于源项，我们采用非平衡潜热模型\n$$\nS(T) = - \\rho L M \\big( T - T_{l} \\big),\n$$\n该模型通过以与过冷度成正比的速率释放或吸收潜热来驱动 $T$ 趋向于 $T_{l}$。代入显式更新得到一个线性标量衰减项\n$$\nT_{i}^{n+1} = T_{i}^{n} - \\Delta t \\, \\frac{\\rho L M}{c_{\\text{app}}} \\, \\big( T_{i}^{n} - T_{l} \\big) + \\text{(advection term)}.\n$$\n对于应用于 $\\partial T/\\partial t = - a (T - T_{l})$ 的前向欧拉法，其中 $a = \\rho L M / c_{\\text{app}}$，一个充分的单调性和稳定性条件是\n$$\n\\Delta t \\, a \\leq 1 \\quad \\Longrightarrow \\quad \\Delta t \\leq \\Delta t_{\\text{lat}} \\equiv \\frac{c_{\\text{app}}}{\\rho L M}.\n$$\n\n结合两个显式约束，一个稳定的时间步长是\n$$\n\\Delta t_{\\max} = \\min \\left( \\Delta t_{\\text{adv}}, \\, \\Delta t_{\\text{lat}} \\right) = \\min \\left( \\frac{c_{\\text{app}}}{\\rho c_{p}} \\, \\frac{\\Delta x}{u}, \\, \\frac{c_{\\text{app}}}{\\rho L M} \\right).\n$$\n\n我们继续用给定的参数来计算 $\\Delta t_{\\max}$。首先计算表观热容，\n$$\nc_{\\text{app}} = \\rho c_{p} + \\frac{\\rho L}{T_{l} - T_{s}} = \\rho \\left( c_{p} + \\frac{L}{T_{l} - T_{s}} \\right).\n$$\n可以方便地注意到，比率 $c_{\\text{app}}/(\\rho c_{p})$ 和 $c_{\\text{app}}/(\\rho L M)$ 可以简化为仅包含物性参数的表达式：\n$$\n\\frac{c_{\\text{app}}}{\\rho c_{p}} = \\frac{c_{p} + L/(T_{l} - T_{s})}{c_{p}} = 1 + \\frac{L}{c_{p}(T_{l} - T_{s})},\n$$\n$$\n\\frac{c_{\\text{app}}}{\\rho L M} = \\frac{c_{p} + L/(T_{l} - T_{s})}{L M} = \\frac{c_{p}}{L M} + \\frac{1}{M (T_{l} - T_{s})}.\n$$\n\n代入数值：\n\n对于平流约束，\n$$\n\\Delta t_{\\text{adv}} = \\left[ 1 + \\frac{L}{c_{p}(T_{l} - T_{s})} \\right] \\frac{\\Delta x}{u}\n= \\left[ 1 + \\frac{2.6 \\times 10^{5}}{(6.0 \\times 10^{2})(3.0 \\times 10^{1})} \\right] \\frac{1.0 \\times 10^{-4}}{1.0 \\times 10^{-2}}.\n$$\n计算无量纲括号项：\n$$\n\\frac{L}{c_{p}(T_{l} - T_{s})} = \\frac{2.6 \\times 10^{5}}{6.0 \\times 10^{2} \\times 3.0 \\times 10^{1}} = \\frac{2.6 \\times 10^{5}}{1.8 \\times 10^{4}} \\approx 14.444\\ldots,\n$$\n因此\n$$\n\\Delta t_{\\text{adv}} \\approx (1 + 14.444\\ldots) \\times \\frac{1.0 \\times 10^{-4}}{1.0 \\times 10^{-2}} = 15.444\\ldots \\times 10^{-2} \\ \\text{s} = 1.54444\\ldots \\times 10^{-1} \\ \\text{s}.\n$$\n\n对于潜热动力学约束，\n$$\n\\Delta t_{\\text{lat}} = \\frac{c_{p}}{L M} + \\frac{1}{M (T_{l} - T_{s})}\n= \\frac{6.0 \\times 10^{2}}{(2.6 \\times 10^{5})(1.0 \\times 10^{2})} + \\frac{1}{(1.0 \\times 10^{2})(3.0 \\times 10^{1})}.\n$$\n计算这两项：\n$$\n\\frac{6.0 \\times 10^{2}}{2.6 \\times 10^{7}} \\approx 2.3077 \\times 10^{-5} \\ \\text{s}, \\qquad \\frac{1}{3.0 \\times 10^{3}} \\approx 3.3333 \\times 10^{-4} \\ \\text{s},\n$$\n所以\n$$\n\\Delta t_{\\text{lat}} \\approx 2.3077 \\times 10^{-5} + 3.3333 \\times 10^{-4} \\ \\text{s} \\approx 3.5641 \\times 10^{-4} \\ \\text{s}.\n$$\n\n最后，\n$$\n\\Delta t_{\\max} = \\min \\left( 1.54444\\ldots \\times 10^{-1} \\ \\text{s}, \\, 3.5641 \\times 10^{-4} \\ \\text{s} \\right) = 3.5641 \\times 10^{-4} \\ \\text{s}.\n$$\n四舍五入到三位有效数字得到\n$$\n\\Delta t_{\\max} \\approx 3.56 \\times 10^{-4} \\ \\text{s}.\n$$",
            "answer": "$$\\boxed{3.56 \\times 10^{-4}}$$"
        },
        {
            "introduction": "本章的最终实践是一项综合性的编码任务，旨在将物理理解与数值技术融为一体。您将亲自实现并对比两种最主流的固定网格凝固模型：有效热容法和焓法。通过将您的模拟结果与经典的Stefan问题的解析解进行比较，您将对这两种方法在能量守恒、界面追踪精度以及数值误差来源等方面的优劣获得宝贵的实践经验。",
            "id": "3974910",
            "problem": "您需要为一个具有已知锐利界面 Stefan 解的半无限基准问题，实现并比较两种用于含糊状区一维凝固问题的固定网格公式。这两种公式是：等效热容 (EHC) 法和焓法。从控制能量守恒定律和傅里叶热传导定律出发，推导并实现离散算法，模拟至指定的最终时间，提取每种方法中界面位置的数值估计，并计算其与 Stefan 解给出的解析界面位置之间的绝对误差。所有界面位置误差均以米为单位表示。\n\n物理背景为半无限域 ($x \\ge 0$) 内的一维热传导，初始温度为熔点温度，而位于 $x=0$ 的边界突然冷却至低于熔点的温度。使用以下材料属性和条件，这些属性和条件以一种金属为代表：\n\n- 密度 $ \\rho = 2700\\,\\mathrm{kg/m^3} $。\n- 导热系数 $ k = 200\\,\\mathrm{W/(m\\,K)} $。\n- 比热 $ c = 900\\,\\mathrm{J/(kg\\,K)} $。\n- 熔化潜热 $ L = 3.97\\times 10^{5}\\,\\mathrm{J/kg} $。\n- 熔点温度 $ T_m = 933\\,\\mathrm{K} $。\n- $ x=0 $ 处的边界（冷却）温度：$ T_s = 800\\,\\mathrm{K} $。\n- 初始温度 $ T(x,0) = T_m $（对于所有 $ x \\ge 0 $）。\n\n使用一个足够大的有限长度 $ L_x = 0.1\\,\\mathrm{m} $ 来模拟半无限域，并施加远场狄利克雷边界条件 $ T(L_x,t) = T_m $（对于所有 $ t \\ge 0 $）。空间网格是均匀的，间距 $ \\Delta x $ 如下面的测试套件中所指定，时间积分为显式方法。对于所有测试用例，设模拟最终时间为 $ t_\\mathrm{final} = 5\\,\\mathrm{s} $。在等效热容等于显热容的区域，使用受温度方程标准显式稳定性判据约束的均匀时间步长：\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{2\\,\\alpha_\\mathrm{max}}, \\quad \\alpha_\\mathrm{max} = \\frac{k}{\\rho\\,c}.\n$$\n在您的实现中，设置 $ \\Delta t = 0.9\\,\\Delta x^2/(2\\,\\alpha_\\mathrm{max}) $，并根据需要缩短最后一步的时间步长，以确保模拟在 $ t_\\mathrm{final} $ 精确结束。\n\n通过一个以熔点温度为中心、宽度为 $ \\Delta T $ 的有限温度区间来引入糊状区正则化。将固相线和液相线温度定义为 $ T_\\mathrm{sol} = T_m - \\Delta T / 2 $ 和 $ T_\\mathrm{liq} = T_m + \\Delta T / 2 $。液相分数 $ f_\\ell(T) $ 建模如下：\n$$\nf_\\ell(T) = \n\\begin{cases}\n0,  T \\le T_\\mathrm{sol},\\\\\n\\frac{T - T_\\mathrm{sol}}{\\Delta T},  T_\\mathrm{sol}  T  T_\\mathrm{liq},\\\\\n1,  T \\ge T_\\mathrm{liq}.\n\\end{cases}\n$$\n\n对于等效热容法，使用以下方程演化温度：\n$$\n\\rho\\,c_\\mathrm{eff}(T)\\,\\frac{\\partial T}{\\partial t} = k\\,\\frac{\\partial^2 T}{\\partial x^2},\n$$\n其中\n$$\nc_\\mathrm{eff}(T) = c + \\frac{L}{\\Delta T} \\quad \\text{若 } T_\\mathrm{sol}  T  T_\\mathrm{liq}, \\quad \\text{否则 } c_\\mathrm{eff}(T) = c 。\n$$\n对空间二阶导数使用二阶中心差分，在时间上使用前向欧拉法。在每个时间步施加狄利克雷边界条件 $ T(0,t) = T_s $ 和 $ T(L_x,t) = T_m $。\n\n对于焓法，使用以下方程演化体积焓 $ H(T) $：\n$$\n\\frac{\\partial H}{\\partial t} = k\\,\\frac{\\partial^2 T}{\\partial x^2}, \\quad H(T) = \\rho\\,c\\,T + \\rho\\,L\\,f_\\ell(T).\n$$\n在每个时间步，通过 $ H(T) $ 定义所隐含的分段线性逆关系从 $ H $ 计算 $ T $。对 $ H $ 使用相同的离散空间算子和前向欧拉法进行推进。在每个时间步设置 $ T(0,t) = T_s $ 和 $ T(L_x,t) = T_m $，并相应地更新边界焓值 $ H(0,t) = H(T_s) $ 和 $ H(L_x,t) = H(T_m) $，以强制施加狄利克雷边界条件。\n\n对于此配置，单相锐利界面 Stefan 问题的解析解给出界面位置 $ s(t) $ 如下：\n$$\ns(t) = 2\\,\\lambda\\,\\sqrt{\\alpha\\,t}, \\quad \\alpha = \\frac{k}{\\rho\\,c},\n$$\n其中参数 $ \\lambda $ 是解一个涉及 Stefan 数 $ \\mathrm{Ste} $ 和互补误差函数（CERF，通常写作 $ \\operatorname{erfc} $）的超越方程得到的：\n$$\n\\mathrm{Ste} = \\frac{c\\,(T_m - T_s)}{L}, \\quad \\mathrm{Ste} = \\sqrt{\\pi}\\,\\lambda\\,\\exp(\\lambda^2)\\,\\operatorname{erfc}(\\lambda).\n$$\n根据给定参数数值计算 $ \\lambda $，然后计算 $ s(t_\\mathrm{final}) $。\n\n在 $ t_\\mathrm{final} $ 时刻，通过找到温度 $ T $ 首次超过 $ T_m $ 的位置并在网格点之间进行线性插值，从每种方法中提取数值界面位置 $ s_\\mathrm{num} $。为每种方法计算以米为单位的绝对误差 $ |s_\\mathrm{num} - s(t_\\mathrm{final})| $。\n\n测试套件：\n提供三个测试用例，以探索数值行为的不同方面：\n- 用例 $1$ (基准分辨率，中等糊状区宽度): $ \\Delta x = 5\\times 10^{-4}\\,\\mathrm{m} $, $ \\Delta T = 10\\,\\mathrm{K} $。\n- 用例 $2$ (较粗网格，锐利界面极限): $ \\Delta x = 10^{-3}\\,\\mathrm{m} $, $ \\Delta T = 1\\,\\mathrm{K} $。\n- 用例 $3$ (基准分辨率，宽糊状区宽度): $ \\Delta x = 5\\times 10^{-4}\\,\\mathrm{m} $, $ \\Delta T = 50\\,\\mathrm{K} $。\n\n数值输出规范：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果应为一个双元素列表 $[e_\\mathrm{EHC}, e_\\mathrm{ENT}]$，其中包含以米为单位的浮点数，分别代表在 $ t_\\mathrm{final} $ 时刻，等效热容法和焓法的绝对误差。对于这三个测试用例，最终输出必须采用以下形式：\n$$\n\\text{print } \\big[ [e_{\\mathrm{EHC},1},e_{\\mathrm{ENT},1}], [e_{\\mathrm{EHC},2},e_{\\mathrm{ENT},2}], [e_{\\mathrm{EHC},3},e_{\\mathrm{ENT},3}] \\big].\n$$",
            "solution": "该问题要求针对一维凝固问题，实现并比较两种固定网格数值方法：等效热容 (EHC) 法和焓法。凝固前沿位置的数值结果将与锐利界面 Stefan 问题的已知解析解进行验证。\n\n基本的控制原理是能量守恒。对于一个只有热传导而无内部热源的系统，能量方程由下式给出：\n$$\n\\frac{\\partial (\\rho h)}{\\partial t} = \\nabla \\cdot (k \\nabla T)\n$$\n其中 $\\rho$ 是密度，$h$ 是比焓，$t$ 是时间，$k$ 是导热系数，$T$ 是温度。比焓 $h$ 是温度和相的函数。对于经历固液相变的物质，其定义如下：\n$$\nh(T) = \\int_{T_\\mathrm{ref}}^T c(T') \\, dT' + L f_{\\ell}(T)\n$$\n其中 $c$ 是比热，$L$ 是熔化潜热，$f_{\\ell}(T)$ 是液相分数，其值从 0（固相）变化到 1（液相）。对于本问题，我们假设各相的材料属性是恒定的，因此积分简化为 $c(T-T_\\mathrm{ref})$。体积焓为 $H = \\rho h$。\n\n该问题使用糊状区模型，其中相变发生在从固相线温度 $T_\\mathrm{sol} = T_m - \\Delta T / 2$ 到液相线温度 $T_\\mathrm{liq} = T_m + \\Delta T / 2$ 的一个有限温度区间 $\\Delta T$ 内。在此区间内，液相分数 $f_{\\ell}(T)$ 被设定为温度的线性函数。\n\n这两种数值公式源于对能量方程中焓项的不同处理方式。\n\n**等效热容 (EHC) 法**\n\n此方法将能量方程显式地改写为关于温度的方程。根据链式法则，焓的时间导数可以表示为：\n$$\n\\frac{\\partial h}{\\partial t} = \\frac{\\partial h}{\\partial T} \\frac{\\partial T}{\\partial t} = c_\\mathrm{eff}(T) \\frac{\\partial T}{\\partial t}\n$$\n其中 $c_\\mathrm{eff}(T) = \\frac{\\partial h}{\\partial T}$ 是等效热容。根据 $h(T)$ 的定义，我们推导出 $c_\\mathrm{eff}(T)$:\n$$\nc_\\mathrm{eff}(T) = \\frac{\\partial}{\\partial T} \\left( c T + L f_{\\ell}(T) \\right) = c + L \\frac{df_{\\ell}}{dT}\n$$\n对于 $f_{\\ell}(T)$ 的指定线性形式，导数 $\\frac{df_{\\ell}}{dT}$ 在糊状区内 ($T_\\mathrm{sol}  T  T_\\mathrm{liq}$) 为 $1/\\Delta T$，在其他区域为 0。这导出了问题描述中给出的分段定义。因此，EHC 方法的控制方程为：\n$$\n\\rho c_\\mathrm{eff}(T) \\frac{\\partial T}{\\partial t} = k \\frac{\\partial^2 T}{\\partial x^2}\n$$\n这是一个非线性热方程，因为系数 $c_\\mathrm{eff}$ 依赖于解 $T$。\n\n为了进行数值求解，我们在空间上使用二阶中心差分进行离散，在时间上使用前向欧拉法。设 $T_i^n$ 为网格点 $x_i = i \\Delta x$ 和时间 $t_n = n \\Delta t$ 处的温度。离散更新方程为：\n$$\n\\rho c_\\mathrm{eff}(T_i^n) \\frac{T_i^{n+1} - T_i^n}{\\Delta t} = k \\frac{T_{i+1}^n - 2T_i^n + T_{i-1}^n}{\\Delta x^2}\n$$\n求解下一时间步的温度 $T_i^{n+1}$：\n$$\nT_i^{n+1} = T_i^n + \\frac{k \\Delta t}{\\rho c_\\mathrm{eff}(T_i^n) \\Delta x^2} (T_{i+1}^n - 2T_i^n + T_{i-1}^n)\n$$\nEHC 方法的算法包括初始化温度场，然后迭代执行以下步骤：\n1. 施加温度的狄利克雷边界条件。\n2. 在每个内部网格点 $i$，根据当前温度计算 $c_\\mathrm{eff}(T_i^n)$。\n3. 使用显式更新公式计算新温度 $T_i^{n+1}$。\n4. 前进到下一个时间步。\n\n**焓法**\n\n该方法保留体积焓 $H = \\rho h$ 作为主要演化变量。其控制方程为：\n$$\n\\frac{\\partial H}{\\partial t} = k \\frac{\\partial^2 T}{\\partial x^2}\n$$\n焓 $H$ 和温度 $T$ 之间的关系由 $H(T) = \\rho c T + \\rho L f_{\\ell}(T)$ 给出。该方法的关键特征是时间演化针对焓，而空间算子（拉普拉斯算子）需要温度。这使得在每个时间步都必须在 $H$ 和 $T$ 之间进行转换。\n\n离散化方程为：\n$$\n\\frac{H_i^{n+1} - H_i^n}{\\Delta t} = k \\frac{T_{i+1}^n - 2T_i^n + T_{i-1}^n}{\\Delta x^2}\n$$\n焓的更新方程为：\n$$\nH_i^{n+1} = H_i^n + \\frac{k \\Delta t}{\\Delta x^2} (T_{i+1}^n - 2T_i^n + T_{i-1}^n)\n$$\n为了获得拉普拉斯算子所需的温度场 $T^n$，我们必须对 $H(T)$ 关系求逆。鉴于 $f_{\\ell}(T)$ 的分段线性定义，$H(T)$ 函数也是分段线性的且单调递增，这使其逆函数 $T(H)$ 成为单值函数。该关系如下：\n- 如果 $H \\le H_\\mathrm{sol} = \\rho c T_\\mathrm{sol}$: $T = H / (\\rho c)$\n- 如果 $H_\\mathrm{sol}  H  H_\\mathrm{liq} = \\rho c T_\\mathrm{liq} + \\rho L$: $T = \\frac{H - \\rho L \\frac{T_\\mathrm{sol}}{\\Delta T}}{ \\rho c + \\frac{\\rho L}{\\Delta T} }$\n- 如果 $H \\ge H_\\mathrm{liq}$: $T = (H - \\rho L) / (\\rho c)$\n\n焓法的算法如下：\n1. 初始化温度场 $T^0$ 并计算相应的初始焓场 $H^0 = H(T^0)$。\n2. 迭代执行：\n   a. 对温度 $T^n$ 施加狄利克雷边界条件。更新边界上的焓值 $H_0^n = H(T_0^n)$ 和 $H_{N-1}^n = H(T_{N-1}^n)$。\n   b. 使用显式更新公式为内部点计算新的焓场 $H^{n+1}$，该公式使用上一步的温度 $T^n$。\n   c. 通过对新的焓值求逆来更新内部温度：$T_i^{n+1} = T(H_i^{n+1})$。\n   d. 前进到下一个时间步。\n\n**解析解：单相 Stefan 问题**\n\n对于锐利界面（$\\Delta T \\to 0$）和初始温度为熔点温度的半无限域情况，存在一个解析解。固液界面的位置 $s(t)$ 由下式给出：\n$$\ns(t) = 2 \\lambda \\sqrt{\\alpha t}\n$$\n其中 $\\alpha = k/(\\rho c)$ 是固相的热扩散系数。常数 $\\lambda$ 通过求解一个在移动界面上强制能量平衡的超越方程来确定：\n$$\n\\mathrm{Ste} = \\sqrt{\\pi} \\lambda e^{\\lambda^2} \\mathrm{erfc}(\\lambda)\n$$\nStefan 数 $\\mathrm{Ste} = \\frac{c(T_m - T_s)}{L}$ 是一个无量纲参数，表示显热与潜热之比。互补误差函数为 $\\mathrm{erfc}(\\lambda)$。该方程必须通过数值方法求解 $\\lambda$。得到的 $s(t_\\mathrm{final})$ 作为与数值解进行比较的基准。\n\n**数值实现细节**\n\n模拟域的长度为 $L_x = 0.1\\,\\mathrm{m}$，用均匀的网格间距 $\\Delta x$ 进行离散化。选择时间步长 $\\Delta t$ 以满足纯固/液相的显式稳定性判据，$\\Delta t = 0.9 \\frac{\\Delta x^2}{2\\alpha}$，其中 $\\alpha = k/(\\rho c)$。由于糊状区中的等效扩散系数较低，因此这一选择是保守的，并能确保在整个域内的稳定性。模拟运行至最终时间 $t_\\mathrm{final} = 5\\,\\mathrm{s}$。\n\n数值界面位置 $s_\\mathrm{num}$ 是从最终温度分布 $T(x, t_\\mathrm{final})$ 中提取的。我们从冷却边界开始，找到第一个满足 $T_i \\ge T_m$ 的网格索引 $i$。界面位于网格点 $x_{i-1}$ 和 $x_i$ 之间。使用线性插值来估计其精确位置：\n$$\ns_\\mathrm{num} = x_{i-1} + (x_i - x_{i-1}) \\frac{T_m - T_{i-1}}{T_i - T_{i-1}}\n$$\n最后，对每种方法和每个测试用例，计算绝对误差 $|s_\\mathrm{num} - s(t_\\mathrm{final})|$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erfc\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Implements and compares Effective Heat Capacity and Enthalpy methods\n    for a 1D solidification problem.\n    \"\"\"\n\n    # --- Material Properties and Conditions ---\n    rho = 2700.0  # Density, kg/m^3\n    k = 200.0   # Thermal conductivity, W/(m K)\n    c = 900.0   # Specific heat, J/(kg K)\n    L = 3.97e5  # Latent heat of fusion, J/kg\n    T_m = 933.0 # Melting temperature, K\n    T_s = 800.0 # Boundary cooling temperature, K\n    \n    # --- Domain and Simulation Parameters ---\n    L_x = 0.1     # Domain length, m\n    t_final = 5.0 # Final simulation time, s\n\n    # --- Analytical Solution ---\n    Ste = c * (T_m - T_s) / L\n    alpha = k / (rho * c)\n\n    def lambda_equation(lam):\n        return np.sqrt(np.pi) * lam * np.exp(lam**2) * erfc(lam) - Ste\n\n    # Find the root for lambda\n    sol = root_scalar(lambda_equation, bracket=[0.01, 1.0], method='brentq')\n    lambda_val = sol.root\n    \n    s_analytical = 2 * lambda_val * np.sqrt(alpha * t_final)\n\n    # --- Test Suite ---\n    test_cases = [\n        # (dx, DeltaT)\n        (5e-4, 10.0),  # Case 1: baseline resolution, moderate mushy width\n        (1e-3, 1.0),   # Case 2: coarser grid, sharp-interface limit\n        (5e-4, 50.0),  # Case 3: baseline resolution, wide mushy width\n    ]\n\n    all_results = []\n\n    for dx, DeltaT in test_cases:\n        \n        # --- Common Numerical Setup for a Test Case ---\n        N_x = int(L_x / dx) + 1\n        x = np.linspace(0, L_x, N_x)\n        dt = 0.9 * dx**2 / (2 * alpha)\n        T_sol = T_m - DeltaT / 2\n        T_liq = T_m + DeltaT / 2\n\n        # --- EHC Method Simulation ---\n        T_ehc = np.full(N_x, T_m)\n        T_ehc[0] = T_s\n        \n        t = 0.0\n        while t  t_final:\n            dt_step = min(dt, t_final - t)\n            T_old = T_ehc.copy()\n            \n            c_eff = np.full(N_x, c)\n            mushy_mask = (T_old > T_sol)  (T_old  T_liq)\n            c_eff[mushy_mask] = c + L / DeltaT\n            \n            # Vectorized update for interior nodes\n            laplacian_T = (T_old[2:] - 2 * T_old[1:-1] + T_old[:-2]) / dx**2\n            dT_dt = k / (rho * c_eff[1:-1]) * laplacian_T\n            T_ehc[1:-1] = T_old[1:-1] + dT_dt * dt_step\n            \n            t += dt_step\n\n        # --- Enthalpy Method Simulation ---\n        def T_to_H(T_arr):\n            _H = np.zeros_like(T_arr)\n            solid_mask = T_arr = T_sol\n            mushy_mask = (T_arr > T_sol)  (T_arr  T_liq)\n            liquid_mask = T_arr >= T_liq\n            \n            _H[solid_mask] = rho * c * T_arr[solid_mask]\n            _H[mushy_mask] = rho * c * T_arr[mushy_mask] + rho * L * (T_arr[mushy_mask] - T_sol) / DeltaT\n            _H[liquid_mask] = rho * c * T_arr[liquid_mask] + rho * L\n            return _H\n\n        def H_to_T(H_arr):\n            _T = np.zeros_like(H_arr)\n            H_sol = rho * c * T_sol\n            H_liq = rho * c * T_liq + rho * L\n            \n            solid_mask = H_arr = H_sol\n            mushy_mask = (H_arr > H_sol)  (H_arr  H_liq)\n            liquid_mask = H_arr >= H_liq\n\n            _T[solid_mask] = H_arr[solid_mask] / (rho * c)\n            _T[mushy_mask] = (H_arr[mushy_mask] + rho * L * T_sol / DeltaT) / (rho * c + rho * L / DeltaT)\n            _T[liquid_mask] = (H_arr[liquid_mask] - rho * L) / (rho * c)\n            return _T\n        \n        T_ent = np.full(N_x, T_m)\n        H_ent = T_to_H(T_ent)\n\n        t = 0.0\n        while t  t_final:\n            dt_step = min(dt, t_final - t)\n            \n            # Apply BCs on T and update H at boundaries\n            T_ent[0] = T_s\n            T_ent[-1] = T_m\n            H_ent[0] = T_to_H(np.array([T_ent[0]]))[0]\n            H_ent[-1] = T_to_H(np.array([T_ent[-1]]))[0]\n            \n            H_old = H_ent.copy()\n\n            # Vectorized update for interior nodes\n            laplacian_T = (T_ent[2:] - 2*T_ent[1:-1] + T_ent[:-2]) / dx**2\n            dH_dt = k * laplacian_T\n            H_ent[1:-1] = H_old[1:-1] + dH_dt * dt_step\n            \n            # Update interior temperatures from new enthalpy\n            T_ent[1:-1] = H_to_T(H_ent[1:-1])\n\n            t += dt_step\n\n        # --- Interface Extraction and Error Calculation ---\n        def find_interface_pos(T_profile, x_grid):\n            # Find first index where temperature crosses T_m\n            try:\n                idx = np.where(T_profile >= T_m)[0][0]\n                if idx == 0: return 0.0 # Interface at the wall\n                \n                # Linear interpolation\n                x1, T1 = x_grid[idx-1], T_profile[idx-1]\n                x2, T2 = x_grid[idx], T_profile[idx]\n                \n                if T2 == T1: return x1\n                \n                s_num = x1 + (x2 - x1) * (T_m - T1) / (T2 - T1)\n                return s_num\n            except IndexError:\n                # Temperature never reaches T_m, interface is beyond domain\n                return x_grid[-1]\n\n        s_num_ehc = find_interface_pos(T_ehc, x)\n        s_num_ent = find_interface_pos(T_ent, x)\n        \n        error_ehc = abs(s_num_ehc - s_analytical)\n        error_ent = abs(s_num_ent - s_analytical)\n        \n        all_results.append([error_ehc, error_ent])\n\n    # --- Format and Print Final Output ---\n    str_results = [f\"[{r[0]},{r[1]}]\" for r in all_results]\n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```"
        }
    ]
}