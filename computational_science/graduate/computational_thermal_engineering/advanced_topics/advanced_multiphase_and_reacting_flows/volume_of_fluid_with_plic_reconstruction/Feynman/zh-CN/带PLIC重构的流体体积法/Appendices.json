{
    "hands_on_practices": [
        {
            "introduction": "本实践旨在解决PLIC重建方法中的核心逆向问题。在一个给定的计算网格单元内，如果我们已知流体的体积分数，我们应如何确定线性界面的精确位置？本练习将引导你完成一个简化情形下的几何推导，为理解该方法如何保证质量守恒奠定关键的理论基础。",
            "id": "3336377",
            "problem": "考虑在均匀笛卡尔网格单元中，采用流体体积法（VOF）界面捕捉策略和分段线性界面重构（PLIC）方法。在PLIC方法中，给定单元内的界面被重构为一个由方程 $\\mathbf{n}\\cdot\\mathbf{x}=d$ 描述的平面，其中 $\\mathbf{n}$ 是根据体积分数场估算出的单位法向量，而 $d$ 是一个平面常数，其选择是为了匹配已知的单元体积分数。这与界面追踪方法（例如，前端追踪法）形成对比，后者显式地对离散化的界面进行平流输运。\n\n设该单元为笛卡尔坐标系中的单位立方体 $\\Omega=[0,1]^{3}$，并设估算出的单位法向量为 $\\mathbf{n}=(n_{x},n_{y},n_{z})$，其分量严格为正。体积分数 $C\\in[0,1]$ 表示在 $\\mathbf{n}\\cdot\\mathbf{x}\\leq d$ 一侧，流体占据 $\\Omega$ 的比例。假设处于这样一种情形：界面平面与单元从原点延伸出的三条边相交，从而流体区域 $\\{\\,\\mathbf{x}\\in\\Omega:\\mathbf{n}\\cdot\\mathbf{x}\\leq d\\,\\}$ 是一个以原点为顶点的四面体；这种情况在 $0\\leq d\\leq \\min\\{n_{x},n_{y},n_{z}\\}$ 时发生。\n\n请从第一性原理（体积的几何或积分定义）出发，推导在该四面体情形下，能够产生正确截断体积的平面常数 $d$ 的表达式，该表达式应使用给定的体积分数 $C$ 和法向量分量 $n_{x}$、$n_{y}$、$n_{z}$ 来表示。请将最终答案表示为单个闭式解析表达式。由于所有变量都是无量纲的，因此无需四舍五入，也无需单位。",
            "solution": "本题要求在单位立方体单元内，对于PLIC界面重构，推导在流体填充区域形成一个位于原点的四面体的特定情形下的平面常数 $d$。\n\n首先对问题进行验证，以确保其科学上合理、良构且客观。\n\n**第1步：提取已知条件**\n- 单元几何形状：单位立方体 $\\Omega = [0,1]^3$。\n- 界面平面方程：$\\mathbf{n} \\cdot \\mathbf{x} = d$，其中 $\\mathbf{n} = (n_x, n_y, n_z)$ 是一个单位法向量，且 $n_x>0$，$n_y>0$，$n_z>0$。\n- 流体区域：$\\{\\mathbf{x} \\in \\Omega : \\mathbf{n} \\cdot \\mathbf{x} \\leq d\\}$。\n- 体积分数：$C \\in [0,1]$。\n- 几何情形：流体区域是一个以原点为顶点的四面体。此条件在 $0 \\leq d \\leq \\min\\{n_x, n_y, n_z\\}$ 时成立。\n\n**第2步：使用已知条件进行验证**\n- **科学依据**：该问题根植于计算流体力学的标准方法，特别是带有PLIC重构的流体体积法（VOF）。其几何和数学设置是严谨的，并基于解析几何的基本原理。\n- **适定性**：该问题提供了所有必要信息，可以在体积分数 $C$ 和平面常数 $d$ 之间建立一个唯一的关系。目标是反解这个关系，这是可能的，因为体积是 $d$ 的一个单调函数。\n- **客观性**：语言精确，没有任何主观性。\n- **完整性与一致性**：已知条件是充分且一致的。条件 $0 \\leq d \\leq \\min\\{n_x, n_y, n_z\\}$ 正确地确保了平面与坐标轴的截距位于从原点延伸的单位立方体边界之内，从而形成一个简单的四面体。\n- **结论**：该问题有效。\n\n**第3步：求解推导**\n\n推导过程从流体体积的几何定义开始。\n\n1.  **确定几何形状和顶点**：\n    流体区域由不等式 $x \\ge 0$，$y \\ge 0$，$z \\ge 0$ 和 $n_x x + n_y y + n_z z \\le d$ 定义。该区域是一个四面体。此四面体的一个顶点是原点 $O=(0,0,0)$。另外三个顶点是平面 $\\mathbf{n} \\cdot \\mathbf{x} = d$ 与坐标轴相交的点。\n    -   与x轴的交点 ($y=0, z=0$):\n        $n_x x = d \\implies x_0 = \\frac{d}{n_x}$。顶点为 $P_x = (\\frac{d}{n_x}, 0, 0)$。\n    -   与y轴的交点 ($x=0, z=0$):\n        $n_y y = d \\implies y_0 = \\frac{d}{n_y}$。顶点为 $P_y = (0, \\frac{d}{n_y}, 0)$。\n    -   与z轴的交点 ($x=0, y=0$):\n        $n_z z = d \\implies z_0 = \\frac{d}{n_z}$。顶点为 $P_z = (0, 0, \\frac{d}{n_z})$。\n    问题条件 $0 \\leq d \\leq \\min\\{n_x, n_y, n_z\\}$ 确保了这些截距 $x_0, y_0, z_0$ 都小于或等于 $1$，因此该四面体完全位于单位立方体 $\\Omega$ 内。\n\n2.  **计算体积**：\n    一个顶点在原点，另外三个顶点在坐标轴上且距离原点分别为 $x_0$、$y_0$ 和 $z_0$ 的四面体的体积 $V$ 由以下公式给出：\n    $$ V = \\frac{1}{6} x_0 y_0 z_0 $$\n    代入上一步中找到的截距表达式：\n    $$ V = \\frac{1}{6} \\left(\\frac{d}{n_x}\\right) \\left(\\frac{d}{n_y}\\right) \\left(\\frac{d}{n_z}\\right) $$\n    $$ V = \\frac{d^3}{6 n_x n_y n_z} $$\n\n3.  **将体积与体积分数关联**：\n    体积分数 $C$ 是流体体积 $V$ 与计算单元总体积 $V_{\\text{cell}}$ 的比率。该单元是一个单位立方体，因此其体积为 $V_{\\text{cell}} = 1^3 = 1$。\n    因此，体积分数在数值上等于流体体积：\n    $$ C = \\frac{V}{V_{\\text{cell}}} = \\frac{V}{1} = V $$\n    将 $C$ 和 $V$ 的表达式相等：\n    $$ C = \\frac{d^3}{6 n_x n_y n_z} $$\n\n4.  **求解平面常数 $d$**：\n    最后一步是求解该方程得到 $d$。我们重排方程以分离出 $d^3$：\n    $$ d^3 = 6 C n_x n_y n_z $$\n    对两边取立方根，得到用 $C$、$n_x$、$n_y$ 和 $n_z$ 表示的 $d$ 的所需表达式：\n    $$ d = (6 C n_x n_y n_z)^{\\frac{1}{3}} $$\n    这就是在指定的四面体情形下，平面常数 $d$ 的闭式解析表达式。",
            "answer": "$$\\boxed{(6 C n_x n_y n_z)^{\\frac{1}{3}}}$$"
        },
        {
            "introduction": "一旦界面被重建，下一步就是利用它来计算单元之间的流体输运。本实践将演示如何在一个简单的恒定速度场下，精确计算穿过单元面的体积通量。这个练习将静态的几何重建与动态的平流输运过程联系起来，后者是任何VOF求解器的核心组成部分。",
            "id": "4004075",
            "problem": "考虑一个用于计算热工学中两相流平流的、采用流体体积（VOF）法和分段线性界面重构（PLIC）的均匀笛卡尔网格。我们关注单个施主单元，其局部坐标定义为 $x \\in [0,\\Delta x]$，$y \\in [0,\\Delta y]$ 和 $z \\in [0,\\Delta z]$。流速恒定且沿 $x$ 方向，$\\mathbf{u} = (u,0,0)$，并且Courant–Friedrichs–Lewy（CFL）数 $\\mathrm{CFL} = u \\Delta t / \\Delta x$ 满足 $\\mathrm{CFL} < 1$。施主单元内的相界面通过PLIC方法重构，该界面是单元与一个平面相交形成的，该平面的方程为 $n_x x + n_y y + n_z z = \\alpha$，其中 $\\mathbf{n} = (n_x,n_y,n_z)$ 是由VOF梯度提供的单位法向量，$\\alpha$ 是由局部体积分数决定的平面常数。\n\n假设以下数值：\n- $\\Delta x = 0.01\\,\\mathrm{m}$，$\\Delta y = 0.02\\,\\mathrm{m}$，$\\Delta z = 0.01\\,\\mathrm{m}$，\n- $u = 1\\,\\mathrm{m/s}$，$\\Delta t = 0.003\\,\\mathrm{s}$（因此 $\\mathrm{CFL} = 0.3$），\n- $\\mathbf{n} = (0.6,0.8,0)$（一个单位向量），\n- $\\alpha = 0.014\\,\\mathrm{m}$。\n\n在时间步长内恒速平流作用下，重构流体穿过位于 $x = \\Delta x$ 的右侧（垂直）单元面的精确PLIC通量，等于位于扫描厚板区域 $x \\in [\\Delta x - d, \\Delta x]$（其中 $d = u \\Delta t$）内的那部分重构流体区域的体积。从指示函数的守恒和恒速几何平流出发，计算在时间间隔 $\\Delta t$ 内穿过右侧面的精确PLIC体积通量 $F$。请用 $\\mathrm{m^3}$ 作为单位表示最终答案，并将结果四舍五入到五位有效数字。",
            "solution": "本问题要求计算在一个时间步长 $\\Delta t$ 内，流体穿过计算单元右侧面的体积通量 $F$。在流体体积（VOF）框架内，流体界面通过分段线性界面重构（PLIC）方法表示为一个平面。\n\n问题指出，体积通量 $F$ 等于位于由 $x \\in [\\Delta x - d, \\Delta x]$（其中 $d = u \\Delta t$）定义的“扫描厚板”区域内的重构流体区域的体积。这是对于恒定速度场下平流作用的标准几何解释。\n\n我们感兴趣的区域是一个由多个半空间相交定义的多面体：\n1.  重构流体区域：相界面由平面 $n_x x + n_y y + n_z z = \\alpha$ 给出。法向量 $\\mathbf{n}$ 通常定义为指向流体外部。因此，流体占据 $n_x x + n_y y + n_z z \\le \\alpha$ 的空间。\n2.  扫描厚板：平流纯粹发生在 $x$ 方向，因此在时间 $\\Delta t$ 内穿过 $x=\\Delta x$ 面的体积来自于由 $x \\in [\\Delta x - u\\Delta t, \\Delta x]$ 定义的厚板区域。\n3.  单元边界：计算被限制在施主单元内，这施加了边界 $y \\in [0, \\Delta y]$ 和 $z \\in [0, \\Delta z]$。\n\n需要计算的总容积 $F$ 是在由所有这些约束定义的区域 $V$ 上对 $1$ 进行积分得到的。\n我们首先将给定的数值代入参数中。\n单元尺寸：$\\Delta x = 0.01\\,\\mathrm{m}$，$\\Delta y = 0.02\\,\\mathrm{m}$，$\\Delta z = 0.01\\,\\mathrm{m}$。\n流动参数：$u = 1\\,\\mathrm{m/s}$，$\\Delta t = 0.003\\,\\mathrm{s}$。\n平流距离为 $d = u \\Delta t = (1\\,\\mathrm{m/s})(0.003\\,\\mathrm{s}) = 0.003\\,\\mathrm{m}$。\n因此，扫描厚板是 $x \\in [0.01 - 0.003, 0.01]$ 的区域，简化为 $x \\in [0.007, 0.01]$。\n\n相界面平面定义：\n法向量 $\\mathbf{n} = (0.6, 0.8, 0)$。\n平面常数 $\\alpha = 0.014\\,\\mathrm{m}$。\n流体位于由不等式定义的区域内：\n$0.6x + 0.8y + 0z \\le 0.014$，简化为 $0.6x + 0.8y \\le 0.014$。\n\n体积 $F$ 是在由以下不等式定义的区域 $V$ 上的积分：\n1. $0.007 \\le x \\le 0.01$\n2. $0 \\le y \\le 0.02$\n3. $0 \\le z \\le 0.01$\n4. $0.6x + 0.8y \\le 0.014$\n\n流体区域的表达式不依赖于变量 $z$（因为 $n_z=0$）。这意味着对于任何给定的 $(x, y)$ 对，被积函数沿 $z$ 方向是恒定的。对 $z$ 的积分可以首先进行，结果就是将该区域在 $xy$ 平面上的投影面积乘以单元深度 $\\Delta z$。\n\n设 $A$ 是 $xy$ 平面中由以下条件定义的二维区域的面积：\n1. $0.007 \\le x \\le 0.01$\n2. $0 \\le y \\le 0.02$\n3. $0.6x + 0.8y \\le 0.014$\n\n那么通量体积为 $F = A \\times \\Delta z$。我们现在集中计算 $A$。\n第三个不等式可以重写为以 $x$ 的函数表示 $y$：\n$0.8y \\le 0.014 - 0.6x$\n$y \\le \\frac{0.014 - 0.6x}{0.8}$\n$y \\le 0.0175 - 0.75x$\n\n所以，区域 $A$ 的边界是 $x=0.007$、$x=0.01$、$y=0$ 和 $y \\le \\min(0.02, 0.0175 - 0.75x)$。\n我们必须检查直线 $y = 0.0175 - 0.75x$ 是否在我们的 $x$ 积分域 $[0.007, 0.01]$ 内与单元顶部 $y = 0.02$ 相交。\n让我们在 $x$ 域的边界处计算上界 $0.0175 - 0.75x$ 的值：\n在 $x = 0.007$ 处：$y = 0.0175 - 0.75(0.007) = 0.0175 - 0.00525 = 0.01225$。\n在 $x = 0.01$ 处：$y = 0.0175 - 0.75(0.01) = 0.0175 - 0.0075 = 0.01$。\n\n由于 $0.01225$ 和 $0.01$ 都小于单元高度 $\\Delta y = 0.02$，积分区域的上边界始终由直线 $y = 0.0175 - 0.75x$ 给出，而单元边界 $y = 0.02$ 并不对该面积构成约束。\n面积 $A$ 可以通过积分计算：\n$$ A = \\int_{0.007}^{0.01} \\left( \\int_0^{0.0175 - 0.75x} dy \\right) dx $$\n$$ A = \\int_{0.007}^{0.01} (0.0175 - 0.75x) dx $$\n这个积分代表一个梯形的面积。我们可以直接求解它：\n$$ A = \\left[ 0.0175x - 0.75\\frac{x^2}{2} \\right]_{0.007}^{0.01} = \\left[ 0.0175x - 0.375x^2 \\right]_{0.007}^{0.01} $$\n代入积分上下限：\n$$ A = (0.0175(0.01) - 0.375(0.01)^2) - (0.0175(0.007) - 0.375(0.007)^2) $$\n$$ A = (0.000175 - 0.375(0.0001)) - (0.0001225 - 0.375(0.000049)) $$\n$$ A = (0.000175 - 0.0000375) - (0.0001225 - 0.000018375) $$\n$$ A = 0.0001375 - 0.000104125 $$\n$$ A = 0.000033375\\,\\mathrm{m}^2 $$\n这个计算可以用梯形的几何公式来验证：面积 $= \\frac{1}{2}(\\text{高}_1 + \\text{高}_2) \\times \\text{宽}$。\n宽 $w = 0.01 - 0.007 = 0.003\\,\\mathrm{m}$。\n高分别为 $h_1 = 0.01225\\,\\mathrm{m}$（在 $x=0.007$ 处）和 $h_2 = 0.01\\,\\mathrm{m}$（在 $x=0.01$ 处）。\n$$ A = \\frac{1}{2}(0.01225 + 0.01)(0.003) = \\frac{1}{2}(0.02225)(0.003) = 0.011125 \\times 0.003 = 0.000033375\\,\\mathrm{m}^2 $$\n结果吻合。\n\n最后，我们通过将面积 $A$ 乘以单元深度 $\\Delta z$ 来计算体积通量 $F$：\n$$ F = A \\times \\Delta z = (0.000033375\\,\\mathrm{m}^2) \\times (0.01\\,\\mathrm{m}) $$\n$$ F = 0.00000033375\\,\\mathrm{m}^3 $$\n用科学记数法表示，即 $F = 3.3375 \\times 10^{-7}\\,\\mathrm{m}^3$。\n问题要求答案四舍五入到五位有效数字。计算出的值 $3.3375 \\times 10^{-7}$ 已经恰好是五位有效数字。",
            "answer": "$$\n\\boxed{3.3375 \\times 10^{-7}}\n$$"
        },
        {
            "introduction": "VOF-PLIC模拟的准确性和稳定性在很大程度上取决于其几何计算程序的稳健性。这最后一个实践聚焦于正向问题：为给定的界面平面计算其对应的体积分数。你将通过一系列具有挑战性的测试用例，来实施并验证一个裁剪算法，这些用例包括极端微小的体积或退化的方向，从而确保你的VOF实现核心在数值上是可靠的。",
            "id": "4004146",
            "problem": "考虑在笛卡尔网格中使用带有分段线性界面重构 (PLIC) 的流体体积法 (VOF)。在单个计算单元中，重构的界面由一个线性流形表示：二维中是一条直线，三维中是一个平面。设计算单元在二维中为单位正方形，定义为 $\\{(x,y)\\in\\mathbb{R}^2 \\mid 0 \\le x \\le 1, 0 \\le y \\le 1\\}$，在三维中为单位立方体，定义为 $\\{(x,y,z)\\in\\mathbb{R}^3 \\mid 0 \\le x \\le 1, 0 \\le y \\le 1, 0 \\le z \\le 1\\}$。PLIC 界面是满足 $n \\cdot \\mathbf{x} = \\alpha$ 的点集，其中 $n$ 是界面法向量，$\\alpha$ 是一个标量偏移量，液相占据单元内部的半空间 $n \\cdot \\mathbf{x} \\le \\alpha$。单元内的局部体积分数必须等于半空间与单位单元相交区域的度量（二维中为面积，三维中为体积）除以单元度量。\n\n目标是设计和验证稳健的裁剪算法，用于计算极端几何构型下的相交度量，并与体积分数守恒和线性界面表示保持一致。这些算法必须仅依赖于凸多胞体与半空间的相交，并从第一性原理出发：(i) 质量守恒意味着体积分数等于液相区域占单元度量的比例，(ii) PLIC 界面是线性的，以及 (iii) 凸多胞体与半空间相交后仍为凸多胞体。\n\n定义以下任务：\n- 对于二维情况，计算相交集 $R_2 = \\{(x,y) \\in [0,1]^2 \\mid n_x x + n_y y \\le \\alpha\\}$ 的面积。\n- 对于三维情况，计算相交集 $R_3 = \\{(x,y,z) \\in [0,1]^3 \\mid n_x x + n_y y + n_z z \\le \\alpha\\}$ 的体积。\n\n您的程序必须从第一性原理实现几何裁剪，并为下方的测试套件生成结果。算法必须对以下情况具有稳健性：\n- 界面几乎不与单元相交的近切线切割，产生极小的薄片度量。\n- 法向量与坐标轴对齐，产生轴对齐的半空间。\n- 靠近边和角进行切割，对数值容差构成考验。\n\n使用以下测试套件。对于每个测试用例，计算单位单元中的相交度量，并使用通过/失败标准将其与提供的期望值进行比较。所有期望值均以与度量相同的单位给出：二维中为面积，三维中为体积。不需要物理单位或角度单位。\n\n二维测试用例（单位正方形）：\n- 用例 $1$：$n = (1,0)$，$\\alpha = 0.37$，期望面积 $= 0.37$。\n- 用例 $2$：$n = (1,0)$，$\\alpha = -10^{-12}$，期望面积 $= 0$。\n- 用例 $3$：$n = (1,0)$，$\\alpha = 1.2$，期望面积 $= 1$。\n- 用例 $4$：$n = (1,1)$，$\\alpha = 0.5$，期望面积 $= 0.125$。\n- 用例 $5$：$n = (1,1)$，$\\alpha = 10^{-4}$，期望面积 $= 5 \\times 10^{-9}$。\n- 用例 $6$：$n = (1,1)$，$\\alpha = 1.99$，期望面积 $= 0.99995$。\n- 用例 $7$：$n = (0,1)$，$\\alpha = 0.65$，期望面积 $= 0.65$。\n\n三维测试用例（单位立方体）：\n- 用例 $8$：$n = (1,0,0)$，$\\alpha = 0.37$，期望体积 $= 0.37$。\n- 用例 $9$：$n = (1,0,0)$，$\\alpha = -10^{-12}$，期望体积 $= 0$。\n- 用例 $10$：$n = (1,0,0)$，$\\alpha = 1.2$，期望体积 $= 1$。\n- 用例 $11$：$n = (1,1,1)$，$\\alpha = 0.5$，期望体积 $= 0.020833333333333332$。\n- 用例 $12$：$n = (1,1,1)$，$\\alpha = 0.01$，期望体积 $= 1.6666666666666667 \\times 10^{-7}$。\n- 用例 $13$：$n = (1,1,1)$，$\\alpha = 2.99$，期望体积 $= 0.9999998333333334$。\n- 用例 $14$：$n = (0,1,0)$，$\\alpha = 0.65$，期望体积 $= 0.65$。\n\n通过/失败标准：\n- 如果计算出的度量 $m_{\\text{comp}}$ 满足 $|\\lvert m_{\\text{comp}} - m_{\\text{exp}} \\rvert| \\le \\max(\\varepsilon_{\\text{abs}}, \\varepsilon_{\\text{rel}} \\cdot \\max(1, \\lvert m_{\\text{exp}} \\rvert))$，其中 $\\varepsilon_{\\text{abs}} = 10^{-9}$ 且 $\\varepsilon_{\\text{rel}} = 10^{-9}$，则测试通过。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_1,result_2,\\dots,result_{14}]$），其中每个 $result_i$ 是一个布尔值，表示上述用例 $i$ 的通过或失败情况。",
            "solution": "该问题要求计算单位超立方体与半空间相交区域的度量（二维中为面积，三维中为体积）。这是计算几何学中的一个经典问题，是多相流模拟中流体体积法 (VOF) 内的分段线性界面重构 (PLIC) 方案的基础。在单位单元 $[0,1]^d$（其中 $d \\in \\{2, 3\\}$）内，液相由不等式 $n \\cdot \\mathbf{x} \\le \\alpha$ 定义。任务的核心是基于第一性原理开发一种稳健的算法，用于计算由法向量 $n$ 和偏移量 $\\alpha$ 定义的界面平面的各种几何构型下的此度量。\n\n解决方案通过将一般问题系统地简化为存在解析解的规范形式来得出。这种方法确保了正确性和稳健性。\n\n**1. 基本原理**\n\n该算法建立在以下原理之上：\n- 单位单元是一个凸多胞体 $[0,1]^d$。\n- 液相区域是该凸多胞体与半空间 $n \\cdot \\mathbf{x} \\le \\alpha$ 的交集，其结果是另一个凸多胞体。\n- 集合的度量在等距变换（例如，反射）下是不变的。\n\n**2. 算法步骤**\n\n整个算法分几个阶段进行：\n\n**阶段 1：降维**\n法向量 $n$ 可能包含零分量。例如，在三维中，如果 $n = (n_x, n_y, 0)$，则界面方程 $n_x x + n_y y \\le \\alpha$ 与 $z$ 坐标无关。液相区域的体积等于 $xy$ 平面上相应二维区域的面积乘以单元在 $z$ 方向的长度（即 1）。通常，如果 $n$ 的某些分量为零，则问题可以在由 $n$ 的非零分量对应的坐标轴所张成的低维空间中求解。所得度量是相同的。该算法首先确定问题的有效维度，并使用简化的法向量和维度进行处理。如果 $n$ 的所有分量都为零，会出现一种特殊情况，不等式变为 $0 \\le \\alpha$。如果 $\\alpha \\ge 0$，则度量为 1，如果 $\\alpha < 0$，则度量为 0。如果只有一个分量 $n_k$ 非零，则问题是一维的，度量就是单元长度的一部分，如果 $n_k > 0$，计算为 $\\text{clip}(\\alpha/n_k, 0, 1)$，如果 $n_k < 0$，则计算为 $\\text{clip}(1 - \\alpha/n_k, 0, 1)$。\n\n**阶段 2：转换为规范形式**\n通过将一般问题转换为法向量所有分量均为非负的规范形式，可以简化问题。这是通过一系列保体积的反射变换实现的。对于任何 $n_i < 0$ 的维度 $i$，我们应用反射 $x_i \\to 1 - x'_i$。新坐标 $x'_i$ 的定义域仍为 $[0,1]$。不等式 $\\sum_j n_j x_j \\le \\alpha$ 变为：\n$$ \\sum_{j \\ne i} n_j x_j + n_i(1-x'_i) \\le \\alpha \\implies \\sum_{j \\ne i} n_j x_j - n_i x'_i \\le \\alpha - n_i $$\n通过定义一个新的法向量 $n'$（其中 $n'_i = -n_i > 0$）和一个新的偏移量 $\\alpha' = \\alpha - n_i$，我们得到了一个法向量分量为非负的等价问题。对所有法向量分量为负的维度重复此过程。此阶段之后，我们得到一个由 $(n', \\alpha')$ 定义的新问题，其中 $n'$ 的所有分量均为非负。函数 $f(\\mathbf{x}) = n' \\cdot \\mathbf{x}$ 现在在所有坐标上都是单调递增的。\n\n**阶段 3：边界和平凡情况**\n对于所有 $i$ 都有 $n'_i \\ge 0$ 的规范问题，在单位单元中 $n' \\cdot \\mathbf{x}$ 的最小值为 $\\mathbf{x}=(0,\\dots,0)$ 处的 0。最大值为 $\\mathbf{x}=(1,\\dots,1)$ 处的 $\\sum_i n'_i$。这允许进行简单的检查：\n- 如果 $\\alpha' \\le 0$，液相区域为空（或度量为零），因此度量为 $0$。\n- 如果 $\\alpha' \\ge \\sum_i n'_i$，整个单元被填充，度量为 $1$。\n\n**阶段 4：用于体积计算的容斥公式**\n对于 $0 < \\alpha' < \\sum_i n'_i$ 的非平凡情况，液相区域是一个通过切除超立方体靠近原点的角而形成的凸多胞体。这种形状的体积可以解析计算。由 $\\{\\mathbf{x} \\in \\mathbb{R}^d_+ \\mid n' \\cdot \\mathbf{x} \\le \\alpha'\\}$ 定义的单纯形（即在第一象限内）的体积由下式给出：\n$$ V_{\\text{simplex}} = \\frac{(\\alpha')^d}{d! \\prod_{i=1}^d n'_i} $$\n仅当单纯形没有超出任何面 $x_i = 1$ 时，此公式才对单位超立方体内部的单纯形部分有效。为了考虑超立方体面对单纯形的裁剪，我们使用容斥原理。所需的体积是第一象限中单纯形的体积减去位于超立方体外部区域的体积（其中一个或多个 $x_i > 1$）。这导出了度量 $M$ 的通用公式：\n$$ M(n', \\alpha', d) = \\frac{1}{\\prod_{i=1}^d n'_i} \\sum_{S \\subseteq \\{1, \\dots, d\\}} (-1)^{|S|} \\frac{\\left(\\alpha' - \\sum_{j \\in S} n'_j\\right)^d}{d!} H\\left(\\alpha' - \\sum_{j \\in S} n'_j\\right) $$\n在这里，求和是对维度索引 $\\{1, \\dots, d\\}$ 的所有 $2^d$ 个子集 $S$ 进行的，$H$ 是亥维赛阶跃函数，当其参数为正时为 1，否则为 0。这有效地修剪了求和，只包含调整后的 alpha 值为正的项。$S=\\emptyset$ 对应的项是初始单纯形的体积。\n\n这种对降维、规范变换和容斥原理的系统性应用，提供了一种稳健且数学上合理的算法，能够处理所有测试用例，包括那些旨在考验数值精度和几何退化情况的用例。",
            "answer": "```python\nimport numpy as np\nfrom itertools import combinations\nimport math\n\ndef compute_measure(n_orig, alpha_orig):\n    \"\"\"\n    Computes the measure (area in 2D, volume in 3D) of the region\n    n . x = alpha inside the unit hypercube [0,1]^d.\n    \"\"\"\n    n = np.array(n_orig, dtype=float)\n    alpha = float(alpha_orig)\n    dim = len(n)\n    \n    # Epsilon for floating point comparisons\n    TOL = 1e-12\n\n    # Stage 1: Dimensionality Reduction\n    non_zero_indices = np.where(np.abs(n) > TOL)[0]\n    sub_dim = len(non_zero_indices)\n\n    if sub_dim == 0:\n        return 1.0 if alpha >= 0 else 0.0\n\n    # If the problem is effectively lower-dimensional, solve it in that subspace.\n    # The measure in the full space is the same.\n    if sub_dim  dim:\n        sub_n = n[non_zero_indices]\n        # Recursively call on the sub-problem\n        return compute_measure(sub_n, alpha)\n\n    # From here, dim = sub_dim and all components of n are non-zero.\n    \n    # Handle the 1D case explicitly for clarity, though it's covered by the \n    # transformation logic as well.\n    if dim == 1:\n        n0 = n[0]\n        if n0 > 0:\n            val = alpha / n0\n        else: # n0  0\n            # n0*x = alpha => x >= alpha/n0.\n            # measure of x in [0,1] is 1 - alpha/n0\n            val = 1.0 - (alpha / n0)\n        return np.clip(val, 0.0, 1.0)\n        \n    # Stage 2: Transformation to a Canonical Form (all normal components non-negative)\n    n_prime = n.copy()\n    alpha_prime = alpha\n    for i in range(dim):\n        if n_prime[i]  0:\n            alpha_prime -= n_prime[i]\n            n_prime[i] = -n_prime[i]\n\n    # After transformation, n_prime has all positive components.\n    \n    # Stage 3: Bounding and Trivial Cases for the canonical problem\n    if alpha_prime = TOL:\n        return 0.0\n    if alpha_prime >= np.sum(n_prime):\n        return 1.0\n\n    # Stage 4: Inclusion-Exclusion Formula for measure calculation\n    total_volume_term = 0.0\n    \n    # Iterate over all subset sizes k = 0, 1, ..., dim\n    for k in range(dim + 1):\n        # The sign of the term in the inclusion-exclusion sum\n        term_sign = (-1)**k\n        \n        # Iterate over all subsets of indices of size k\n        for subset_indices in combinations(range(dim), k):\n            n_subset_sum = np.sum(n_prime[list(subset_indices)])\n            \n            current_alpha = alpha_prime - n_subset_sum\n            \n            # The Heaviside function H(...) implemented by this check\n            if current_alpha > TOL:\n                term = (current_alpha**dim)\n                total_volume_term += term_sign * term\n    \n    prod_n = np.prod(n_prime)\n    factorial_d = math.factorial(dim)\n    \n    final_measure = total_volume_term / (factorial_d * prod_n)\n    \n    return np.clip(final_measure, 0.0, 1.0)\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # 2D cases\n        {'n': (1,0), 'alpha': 0.37, 'expected': 0.37, 'dim': 2},\n        {'n': (1,0), 'alpha': -1e-12, 'expected': 0.0, 'dim': 2},\n        {'n': (1,0), 'alpha': 1.2, 'expected': 1.0, 'dim': 2},\n        {'n': (1,1), 'alpha': 0.5, 'expected': 0.125, 'dim': 2},\n        {'n': (1,1), 'alpha': 1e-4, 'expected': 5e-9, 'dim': 2},\n        {'n': (1,1), 'alpha': 1.99, 'expected': 0.99995, 'dim': 2},\n        {'n': (0,1), 'alpha': 0.65, 'expected': 0.65, 'dim': 2},\n        # 3D cases\n        {'n': (1,0,0), 'alpha': 0.37, 'expected': 0.37, 'dim': 3},\n        {'n': (1,0,0), 'alpha': -1e-12, 'expected': 0.0, 'dim': 3},\n        {'n': (1,0,0), 'alpha': 1.2, 'expected': 1.0, 'dim': 3},\n        {'n': (1,1,1), 'alpha': 0.5, 'expected': 0.020833333333333332, 'dim': 3},\n        {'n': (1,1,1), 'alpha': 0.01, 'expected': 1.6666666666666667e-07, 'dim': 3},\n        {'n': (1,1,1), 'alpha': 2.99, 'expected': 0.9999998333333334, 'dim': 3},\n        {'n': (0,1,0), 'alpha': 0.65, 'expected': 0.65, 'dim': 3},\n    ]\n\n    eps_abs = 1e-9\n    eps_rel = 1e-9\n    \n    results = []\n    \n    for case in test_cases:\n        computed_measure = compute_measure(case['n'], case['alpha'])\n        expected_measure = case['expected']\n        \n        abs_error = abs(computed_measure - expected_measure)\n        \n        # Pass/fail criterion: |m_comp - m_exp| = max(eps_abs, eps_rel * max(1, |m_exp|))\n        tolerance = max(eps_abs, eps_rel * max(1.0, abs(expected_measure)))\n\n        passed = abs_error = tolerance\n        results.append(passed)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}