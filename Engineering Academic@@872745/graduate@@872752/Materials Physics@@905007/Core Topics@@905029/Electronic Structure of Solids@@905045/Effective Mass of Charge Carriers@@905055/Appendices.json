{"hands_on_practices": [{"introduction": "The concept of effective mass is a powerful tool, but it is fundamentally a tensor that captures the anisotropic response of an electron to an external force within a crystal lattice. This exercise will guide you through the formal derivation, starting from the semiclassical equations of motion. By working through this problem [@problem_id:2817133], you will see precisely how the inverse effective mass tensor, $(m^*)^{-1}_{ij}$, is defined by the local curvature of the energy dispersion surface, $\\frac{1}{\\hbar^2} \\frac{\\partial^2 E}{\\partial k_i \\partial k_j}$, solidifying the foundational link between band structure and carrier dynamics.", "problem": "A crystalline semiconductor exhibits an anisotropic parabolic conduction-band dispersion near a single valley minimum at $\\boldsymbol{k}=\\boldsymbol{0}$, given by\n$$\nE(k_x,k_y,k_z)=\\alpha\\,k_x^{2}+\\beta\\,k_y^{2}+\\gamma\\,k_z^{2},\n$$\nwhere $\\alpha$, $\\beta$, and $\\gamma$ are positive real constants with units of energy times length squared, and $k_x$, $k_y$, $k_z$ are the components of the crystal wavevector. Using only the standard semiclassical equations of motion for Bloch electrons and the definition of group velocity as your fundamental starting point, derive the effective mass tensor of the charge carriers at the band minimum. Then obtain its principal components along the crystallographic axes $\\hat{\\boldsymbol{x}}$, $\\hat{\\boldsymbol{y}}$, and $\\hat{\\boldsymbol{z}}$, and identify the condition on $\\alpha$, $\\beta$, and $\\gamma$ under which the effective mass is isotropic. Express your final answer as the ordered triple of the principal effective masses in symbolic form in terms of $\\hbar$, $\\alpha$, $\\beta$, and $\\gamma$. Do not substitute any numerical values. Do not include units in the final boxed answer; masses are in kilograms.", "solution": "The problem as stated is valid. It is scientifically grounded, well-posed, and objective. It represents a standard, fundamental problem in solid-state physics. We shall proceed with the derivation.\n\nThe starting point, as mandated, is the semiclassical dynamics of a Bloch electron. The group velocity $\\boldsymbol{v}_g$ of a wave packet is defined as the gradient of the energy dispersion relation $E(\\boldsymbol{k})$ with respect to the wavevector $\\boldsymbol{k}$:\n$$\n\\boldsymbol{v}_g = \\frac{1}{\\hbar} \\nabla_{\\boldsymbol{k}} E(\\boldsymbol{k})\n$$\nwhere $\\hbar$ is the reduced Planck constant. For the given anisotropic parabolic dispersion relation,\n$$\nE(k_x, k_y, k_z) = \\alpha k_x^2 + \\beta k_y^2 + \\gamma k_z^2\n$$\nthe components of the group velocity are:\n$$\nv_{g,x} = \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_x} = \\frac{2\\alpha k_x}{\\hbar}\n$$\n$$\nv_{g,y} = \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_y} = \\frac{2\\beta k_y}{\\hbar}\n$$\n$$\nv_{g,z} = \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_z} = \\frac{2\\gamma k_z}{\\hbar}\n$$\nThe second fundamental principle is the semiclassical equation of motion for the crystal momentum $\\hbar\\boldsymbol{k}$ under an external force $\\boldsymbol{F}_{ext}$:\n$$\n\\frac{d(\\hbar\\boldsymbol{k})}{dt} = \\boldsymbol{F}_{ext} \\implies \\frac{d\\boldsymbol{k}}{dt} = \\frac{\\boldsymbol{F}_{ext}}{\\hbar}\n$$\nThe acceleration $\\boldsymbol{a}$ of the charge carrier is the total time derivative of its group velocity $\\boldsymbol{v}_g(\\boldsymbol{k})$. Since $\\boldsymbol{k}$ is a function of time, we must use the chain rule. The $i$-th component of acceleration is:\n$$\na_i = \\frac{d v_{g,i}}{dt} = \\sum_{j} \\frac{\\partial v_{g,i}}{\\partial k_j} \\frac{d k_j}{dt}\n$$\nwhere the indices $i, j$ run over the Cartesian components $x, y, z$. Substituting the expression for $\\frac{d k_j}{dt}$:\n$$\na_i = \\sum_{j} \\frac{\\partial v_{g,i}}{\\partial k_j} \\left(\\frac{F_{ext,j}}{\\hbar}\\right)\n$$\nThe effective mass tensor, $\\boldsymbol{m}^*$, is defined by analogy to Newton's second law, $F_i = \\sum_j m_{ij}^* a_j$. It is more convenient to work with the inverse effective mass tensor, $(\\boldsymbol{m}^*)^{-1}$, which relates acceleration to force: $a_i = \\sum_j (m^{*-1})_{ij} F_{ext,j}$. By comparing this with our derived expression for $a_i$, we can identify the components of the inverse effective mass tensor:\n$$\n(m^{*-1})_{ij} = \\frac{1}{\\hbar} \\frac{\\partial v_{g,i}}{\\partial k_j}\n$$\nNow, we substitute the definition of group velocity, $v_{g,i} = \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_i}$, into this expression:\n$$\n(m^{*-1})_{ij} = \\frac{1}{\\hbar} \\frac{\\partial}{\\partial k_j} \\left( \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_i} \\right) = \\frac{1}{\\hbar^2} \\frac{\\partial^2 E}{\\partial k_i \\partial k_j}\n$$\nThis is the general definition of the inverse effective mass tensor. We now compute the required second partial derivatives of the given dispersion relation $E(\\boldsymbol{k})$ at the band minimum $\\boldsymbol{k}=\\boldsymbol{0}$.\n\nThe diagonal second derivatives are:\n$$\n\\frac{\\partial^2 E}{\\partial k_x^2} = \\frac{\\partial}{\\partial k_x} (2\\alpha k_x) = 2\\alpha\n$$\n$$\n\\frac{\\partial^2 E}{\\partial k_y^2} = \\frac{\\partial}{\\partial k_y} (2\\beta k_y) = 2\\beta\n$$\n$$\n\\frac{\\partial^2 E}{\\partial k_z^2} = \\frac{\\partial}{\\partial k_z} (2\\gamma k_z) = 2\\gamma\n$$\nThe off-diagonal (mixed) partial derivatives are all zero, for example:\n$$\n\\frac{\\partial^2 E}{\\partial k_x \\partial k_y} = \\frac{\\partial}{\\partial k_x} \\left( \\frac{\\partial E}{\\partial k_y} \\right) = \\frac{\\partial}{\\partial k_x} (2\\beta k_y) = 0\n$$\nSince these second derivatives are constant, their values at the band minimum $\\boldsymbol{k}=\\boldsymbol{0}$ are as computed. The inverse effective mass tensor is therefore a diagonal matrix:\n$$\n(\\boldsymbol{m}^*)^{-1} = \\frac{1}{\\hbar^2}\n\\begin{pmatrix}\n2\\alpha  0  0 \\\\\n0  2\\beta  0 \\\\\n0  0  2\\gamma\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{2\\alpha}{\\hbar^2}  0  0 \\\\\n0  \\frac{2\\beta}{\\hbar^2}  0 \\\\\n0  0  \\frac{2\\gamma}{\\hbar^2}\n\\end{pmatrix}\n$$\nThe effective mass tensor $\\boldsymbol{m}^*$ is the matrix inverse of $(\\boldsymbol{m}^*)^{-1}$. For a diagonal matrix, the inverse is found by taking the reciprocal of each diagonal element:\n$$\n\\boldsymbol{m}^* = \\left( (\\boldsymbol{m}^*)^{-1} \\right)^{-1} =\n\\begin{pmatrix}\n\\frac{\\hbar^2}{2\\alpha}  0  0 \\\\\n0  \\frac{\\hbar^2}{2\\beta}  0 \\\\\n0  0  \\frac{\\hbar^2}{2\\gamma}\n\\end{pmatrix}\n$$\nThe problem asks for the principal components of the effective mass tensor along the crystallographic axes $\\hat{\\boldsymbol{x}}$, $\\hat{\\boldsymbol{y}}$, and $\\hat{\\boldsymbol{z}}$. Since the tensor is diagonal in this basis, these axes are the principal axes, and the diagonal elements are the principal effective masses:\n$$\nm_{xx}^* = \\frac{\\hbar^2}{2\\alpha}\n$$\n$$\nm_{yy}^* = \\frac{\\hbar^2}{2\\beta}\n$$\n$$\nm_{zz}^* = \\frac{\\hbar^2}{2\\gamma}\n$$\nThe condition for the effective mass to be isotropic is that all principal components are equal: $m_{xx}^* = m_{yy}^* = m_{zz}^*$. This leads to the condition:\n$$\n\\frac{\\hbar^2}{2\\alpha} = \\frac{\\hbar^2}{2\\beta} = \\frac{\\hbar^2}{2\\gamma}\n$$\nwhich simplifies to $\\alpha = \\beta = \\gamma$.\n\nThe final answer is the ordered triple of the principal effective masses $(m_{xx}^*, m_{yy}^*, m_{zz}^*)$.", "answer": "$$\n\\boxed{\n(\\frac{\\hbar^2}{2\\alpha}, \\frac{\\hbar^2}{2\\beta}, \\frac{\\hbar^2}{2\\gamma})\n}\n$$", "id": "2817133"}, {"introduction": "Building on the definition of effective mass, we now explore one of its most profound consequences: the concept of the hole. In a nearly-filled valence band, the band curvature is typically negative, which would imply a negative effective mass for an electron near the band maximum. This practice [@problem_id:2817166] demonstrates how the collective behavior of the filled band in response to the absence of one electron can be elegantly described by a quasiparticle—the hole—with a positive charge and a positive effective mass, providing the foundation for understanding p-type conduction in semiconductors.", "problem": "A cubic, non-magnetic semiconductor has an isotropic valence band near the Brillouin-zone center described by the dispersion\n$$\nE_{v}(\\mathbf{k}) \\approx E_{v0} - \\frac{C}{2}\\left(k_{x}^{2}+k_{y}^{2}+k_{z}^{2}\\right) + D\\left(k_{x}^{2}+k_{y}^{2}+k_{z}^{2}\\right)^{2},\n$$\nwith material parameters $C$ and $D$ supplied below. Consider a single, weak, spatially uniform electric field $\\mathbf{E}=E_{x}\\,\\hat{\\mathbf{x}}$, and a dilute hole gas so that band nonparabolicity is negligible at the valence-band maximum.\n\nStarting only from the semiclassical equations of motion for Bloch electrons and the definition of group velocity, derive the expression for the hole effective mass along $x$ at $\\mathbf{k}=\\mathbf{0}$ in terms of the local band curvature at the valence-band maximum. Your derivation should make clear why the hole effective mass is positive despite the negative curvature of $E_{v}(\\mathbf{k})$, and why the hole charge enters transport formulas as $+e$.\n\nNext, under a single-relaxation-time approximation for momentum relaxation (with relaxation time $\\tau$), show that the hole drift current density along $x$ can be written in the form $J_{x}=p\\,(+e)\\,\\mu_{h}\\,E_{x}$, and obtain $\\mu_{h}$ in terms of $\\tau$ and the hole effective mass you derived. Finally, evaluate $\\mu_{h}$ numerically for the material parameters\n$$\nC=2.00\\times 10^{-38}\\ \\text{J}\\,\\text{m}^{2},\\qquad D=1.00\\times 10^{-76}\\ \\text{J}\\,\\text{m}^{4},\\qquad \\tau=5.00\\times 10^{-14}\\ \\text{s}.\n$$\n\nUse the elementary charge $e$ and the reduced Planck constant $\\hbar$ in standard physical constants, and express your final numerical result for the hole mobility $\\mu_{h}$ in $\\text{cm}^{2}\\,\\text{V}^{-1}\\,\\text{s}^{-1}$. Round your answer to three significant figures. Report only the numerical value as your final answer, without units, and do not report any intermediate results.", "solution": "The problem is validated as scientifically grounded, well-posed, and self-contained. We proceed with the solution.\n\nThe foundation of the semiclassical model for a Bloch electron with charge $q=-e$ (where $e$ is the elementary charge) in an external electric field $\\mathbf{E}$ is the equation of motion for its crystal momentum $\\hbar\\mathbf{k}$:\n$$\n\\hbar \\frac{d\\mathbf{k}}{dt} = -e\\mathbf{E}\n$$\nThe electron's group velocity $\\mathbf{v}_g$ is given by the gradient of the energy dispersion $E(\\mathbf{k})$:\n$$\n\\mathbf{v}_g(\\mathbf{k}) = \\frac{1}{\\hbar} \\nabla_{\\mathbf{k}} E(\\mathbf{k})\n$$\nThe acceleration $\\mathbf{a}$ of the electron is the time derivative of its group velocity. Using the chain rule:\n$$\na_i = \\frac{dv_{g,i}}{dt} = \\sum_{j} \\frac{\\partial v_{g,i}}{\\partial k_j} \\frac{dk_j}{dt}\n$$\nSubstituting the expressions for $v_{g,i}$ and $dk_j/dt$:\n$$\nv_{g,i} = \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_i} \\implies \\frac{\\partial v_{g,i}}{\\partial k_j} = \\frac{1}{\\hbar} \\frac{\\partial^2 E}{\\partial k_i \\partial k_j}\n$$\n$$\n\\frac{dk_j}{dt} = -\\frac{eE_j}{\\hbar}\n$$\nThus, the acceleration is:\n$$\na_i = \\sum_{j} \\left( \\frac{1}{\\hbar^2} \\frac{\\partial^2 E}{\\partial k_i \\partial k_j} \\right) (-eE_j)\n$$\nBy analogy with Newton's second law, $a_i = \\sum_j (m^*)^{-1}_{ij} F_j$, where $F_j = -eE_j$ is the force component, we identify the inverse effective mass tensor:\n$$\n(m^*)^{-1}_{ij} = \\frac{1}{\\hbar^2} \\frac{\\partial^2 E(\\mathbf{k})}{\\partial k_i \\partial k_j}\n$$\nFor an electron in the specified valence band, we use $E(\\mathbf{k}) = E_v(\\mathbf{k})$:\n$$\nE_{v}(\\mathbf{k}) = E_{v0} - \\frac{C}{2}\\left(k_{x}^{2}+k_{y}^{2}+k_{z}^{2}\\right) + D\\left(k_{x}^{2}+k_{y}^{2}+k_{z}^{2}\\right)^{2}\n$$\nWe compute the second partial derivatives. For example, for the $x$-component:\n$$\n\\frac{\\partial E_v}{\\partial k_x} = -C k_x + 4D k_x(k_x^2+k_y^2+k_z^2)\n$$\n$$\n\\frac{\\partial^2 E_v}{\\partial k_x^2} = -C + 4D(k_x^2+k_y^2+k_z^2) + 8D k_x^2\n$$\nThe problem considers the dilute hole gas limit, where carriers are at the valence-band maximum, i.e., at $\\mathbf{k}=\\mathbf{0}$. Evaluating the curvature at this point:\n$$\n\\left. \\frac{\\partial^2 E_v}{\\partial k_x^2} \\right|_{\\mathbf{k}=\\mathbf{0}} = -C\n$$\nSimilarly, $\\left. \\frac{\\partial^2 E_v}{\\partial k_y^2} \\right|_{\\mathbf{k}=\\mathbf{0}} = -C$ and $\\left. \\frac{\\partial^2 E_v}{\\partial k_z^2} \\right|_{\\mathbf{k}=\\mathbf{0}} = -C$. The off-diagonal terms are zero, e.g., $\\left. \\frac{\\partial^2 E_v}{\\partial k_x \\partial k_y} \\right|_{\\mathbf{k}=\\mathbf{0}} = \\left. 8D k_x k_y \\right|_{\\mathbf{k}=\\mathbf{0}} = 0$. The non-parabolic term proportional to $D$ does not influence the curvature at the band extremum.\nThe inverse effective mass of an electron at the top of the valence band is isotropic:\n$$\n(m_{e,v}^*)^{-1} = \\frac{1}{\\hbar^2}(-C) \\implies m_{e,v}^* = -\\frac{\\hbar^2}{C}\n$$\nSince $C  0$, the electron effective mass $m_{e,v}^*$ is negative, a consequence of the negative curvature of the band ($E_v$ has a maximum at $\\mathbf{k}=\\mathbf{0}$).\n\nNow, we introduce the concept of a hole. A hole is the absence of an electron in an otherwise filled band. The total wavevector of a filled band is zero. Removing an electron of wavevector $\\mathbf{k}_e$ leaves the band with a net wavevector $\\mathbf{K} = \\mathbf{0} - \\mathbf{k}_e$. We define the hole wavevector as $\\mathbf{k}_h = -\\mathbf{k}_e$.\nThe equation of motion for the hole is derived from that of the absent electron:\n$$\n\\hbar \\frac{d\\mathbf{k}_h}{dt} = \\hbar \\frac{d(-\\mathbf{k}_e)}{dt} = -\\left(\\hbar \\frac{d\\mathbf{k}_e}{dt}\\right) = -(-e\\mathbf{E}) = +e\\mathbf{E}\n$$\nThis is the equation of motion for a particle with positive charge $q_h = +e$. This is why the hole charge enters transport formulas as $+e$.\n\nThe energy of the hole, $E_h(\\mathbf{k}_h)$, is related to the energy of the electron it replaces, $E_v(\\mathbf{k}_e)$. For a band with inversion symmetry, $E_v(\\mathbf{k}) = E_v(-\\mathbf{k})$, which holds for the given isotropic dispersion. The hole dispersion is defined as $E_h(\\mathbf{k}_h) = -E_v(\\mathbf{k}_e) = -E_v(-\\mathbf{k}_h) = -E_v(\\mathbf{k}_h)$. The hole energy band is the inverted electron energy band.\nThe hole effective mass $m_h^*$ is therefore derived from the curvature of $E_h(\\mathbf{k}_h)$:\n$$\n(m_h^*)^{-1}_{ij} = \\frac{1}{\\hbar^2} \\frac{\\partial^2 E_h(\\mathbf{k}_h)}{\\partial k_{h,i} \\partial k_{h,j}} = \\frac{1}{\\hbar^2} \\frac{\\partial^2 (-E_v(\\mathbf{k}_h))}{\\partial k_{h,i} \\partial k_{h,j}} = - \\left( \\frac{1}{\\hbar^2} \\frac{\\partial^2 E_v(\\mathbf{k}_h)}{\\partial k_{h,i} \\partial k_{h,j}} \\right) = -(m_{e,v}^*)^{-1}_{ij}\n$$\nThis implies $m_h^* = -m_{e,v}^*$. Substituting the result for the electron effective mass:\n$$\nm_h^* = - \\left(-\\frac{\\hbar^2}{C}\\right) = \\frac{\\hbar^2}{C}\n$$\nThe effective mass is isotropic, so the mass along $x$ is $m_{h,x}^* = m_h^*$. Since $C  0$, the hole effective mass $m_h^*$ is positive. The hole behaves as a particle with positive charge and positive mass.\n\nNext, we consider transport under the single-relaxation-time approximation. In steady state, the momentum gained by a hole from the electric field over a time $\\tau$ is balanced by momentum loss through scattering. The average drift momentum $\\langle \\mathbf{p} \\rangle$ is given by the impulse of the force over the relaxation time $\\tau$:\n$$\n\\langle \\mathbf{p} \\rangle = (+e)\\mathbf{E}\\tau\n$$\nThis drift momentum is related to the drift velocity $\\mathbf{v}_d$ by $\\langle \\mathbf{p} \\rangle = m_h^* \\mathbf{v}_d$. Thus:\n$$\nm_h^* \\mathbf{v}_d = e\\mathbf{E}\\tau \\implies \\mathbf{v}_d = \\frac{e\\tau}{m_h^*} \\mathbf{E}\n$$\nThe drift current density $\\mathbf{J}$ is the product of the hole density $p$, the hole charge $+e$, and the drift velocity $\\mathbf{v}_d$:\n$$\n\\mathbf{J} = p(+e)\\mathbf{v}_d = p e \\left(\\frac{e\\tau}{m_h^*}\\right) \\mathbf{E} = \\frac{p e^2 \\tau}{m_h^*} \\mathbf{E}\n$$\nFor the specified field $\\mathbf{E}=E_{x}\\,\\hat{\\mathbf{x}}$, the $x$-component of the current density is:\n$$\nJ_x = \\left(\\frac{p e^2 \\tau}{m_h^*}\\right) E_x\n$$\nComparing this to the desired form $J_x = p(+e)\\mu_h E_x$, we identify the hole mobility $\\mu_h$:\n$$\np e \\mu_h = \\frac{p e^2 \\tau}{m_h^*} \\implies \\mu_h = \\frac{e\\tau}{m_h^*}\n$$\nSubstituting our derived expression for the hole effective mass, $m_h^* = \\hbar^2/C$:\n$$\n\\mu_h = \\frac{e\\tau}{\\hbar^2/C} = \\frac{e C \\tau}{\\hbar^2}\n$$\nFinally, we evaluate this expression numerically. The given parameters are:\n$e \\approx 1.602 \\times 10^{-19}\\ \\text{C}$\n$C = 2.00 \\times 10^{-38}\\ \\text{J}\\,\\text{m}^{2}$\n$\\tau = 5.00 \\times 10^{-14}\\ \\text{s}$\n$\\hbar \\approx 1.0546 \\times 10^{-34}\\ \\text{J}\\,\\text{s}$\n$$\n\\mu_h = \\frac{(1.602 \\times 10^{-19}) \\times (2.00 \\times 10^{-38}) \\times (5.00 \\times 10^{-14})}{(1.0546 \\times 10^{-34})^2}\n$$\n$$\n\\mu_h \\approx \\frac{1.602 \\times 10^{-71}}{1.112 \\times 10^{-68}}\\ \\frac{\\text{C} \\cdot (\\text{J}\\,\\text{m}^2) \\cdot \\text{s}}{(\\text{J}\\,\\text{s})^2} \\approx 0.0014406\\ \\text{m}^2\\,\\text{V}^{-1}\\,\\text{s}^{-1}\n$$\nThe problem requires the answer in units of $\\text{cm}^2\\,\\text{V}^{-1}\\,\\text{s}^{-1}$. The conversion is $1\\ \\text{m}^2 = 10^4\\ \\text{cm}^2$.\n$$\n\\mu_h \\approx 0.0014406 \\times 10^4\\ \\text{cm}^2\\,\\text{V}^{-1}\\,\\text{s}^{-1} \\approx 14.406\\ \\text{cm}^2\\,\\text{V}^{-1}\\,\\text{s}^{-1}\n$$\nRounding to three significant figures, as justified by the precision of the input parameters, we obtain $14.4$.", "answer": "$$ \\boxed{14.4} $$", "id": "2817166"}, {"introduction": "In modern materials research, predicting electronic properties often begins with first-principles computations like Density Functional Theory (DFT). This final practice bridges the gap between the analytical theory of effective mass and its practical, numerical implementation. In this computational exercise [@problem_id:2817084], you will develop a program to extract the effective mass from a synthetic band structure by numerically calculating the band curvature, and more importantly, you will investigate how the accuracy of this calculated property depends on critical computational parameters such as k-point mesh density and smearing.", "problem": "Design a complete, runnable program that implements a numerical convergence test for the effective mass of charge carriers extracted from synthetic ab initio band structures near a single band extremum. The program must be fully self-contained and produce the final result for a fixed test suite specified below. All calculations must be performed from first principles, starting from the semiclassical dynamics of Bloch electrons and a local quadratic expansion of the band energy near an extremum.\n\nFundamental base to use:\n- Semiclassical dynamics of Bloch electrons: the crystal momentum obeys $\\hbar \\, d\\mathbf{k}/dt = \\mathbf{F}$, where $\\hbar$ is the reduced Planck constant, $\\mathbf{k}$ is the wave vector, and $\\mathbf{F}$ is the external force.\n- Group velocity: $\\mathbf{v}(\\mathbf{k}) = \\frac{1}{\\hbar}\\nabla_{\\mathbf{k}} E(\\mathbf{k})$, where $E(\\mathbf{k})$ is the band energy.\n- Near a band extremum $\\mathbf{k}_0$, the band energy is locally smooth and admits a second-order Taylor expansion in $\\mathbf{q} = \\mathbf{k} - \\mathbf{k}_0$ with a symmetric Hessian matrix.\n\nYour tasks:\n- From the above principles only, derive how the effective mass tensor arises as the unique linear relation between force and acceleration in response to an electric field near an extremum, and express it in terms of the local curvature of $E(\\mathbf{k})$.\n- Devise and implement a numerically stable algorithm to estimate the curvature (Hessian) of $E(\\mathbf{k})$ near $\\mathbf{k}_0$ from discrete samples on a local $\\mathbf{k}$-space grid. Use a least-squares quadratic fit that includes all independent quadratic terms and allows a nonzero linear term to absorb discretization asymmetries.\n- Implement a synthetic “ab initio band” generator for a single-valley conduction-band minimum at $\\mathbf{k}_0$, defined by principal-axis effective masses, an optional weak quartic nonparabolicity, a smearing-dependent curvature reduction, and a small zero-mean noise whose magnitude scales with smearing. Specifically, generate synthetic energies as\n  $$E(\\mathbf{k}) = E_0 + \\tfrac{1}{2}\\,\\mathbf{q}^\\mathsf{T}\\,\\mathbf{H}_{\\mathrm{eff}}\\,\\mathbf{q} + \\lambda\\,\\lVert \\mathbf{q} \\rVert^4 + \\epsilon,$$\n  where $\\mathbf{q} = \\mathbf{k} - \\mathbf{k}_0$, $\\epsilon$ is a zero-mean random noise with standard deviation proportional to the smearing parameter, and $\\mathbf{H}_{\\mathrm{eff}}$ is a diagonal curvature tensor in the principal axes constructed from the target masses and modified by both smearing and the exchange-correlation functional choice through a multiplicative scaling. Ensure reproducibility by using a fixed random seed.\n- Extract the principal effective masses by diagonalizing the fitted curvature tensor. Report masses in units of the electron rest mass; that is, compute dimensionless ratios relative to the electron mass. All intermediate uses of physical constants must respect units: wave vectors in $\\text{\\AA}^{-1}$, energies in $\\text{eV}$, and the final reported effective masses as unitless ratios relative to the electron mass. Use the physical constants $\\hbar$ in $\\mathrm{J\\cdot s}$, the elementary charge $e$ in $\\mathrm{C}$, and the electron rest mass $m_e$ in $\\mathrm{kg}$ consistently. Any angles, if used, must be in radians.\n- Propose and implement a convergence test of the extracted effective masses with respect to three independent numerical parameters: $\\mathbf{k}$-point density (controlled by the grid step), smearing magnitude, and exchange-correlation functional choice. Define “converged” as follows:\n  - Fix the smallest smearing and a reference functional, and compare the masses obtained at the two finest $\\mathbf{k}$-point spacings. The maximum relative change across the three principal masses must be less than a threshold $\\tau_k$.\n  - Fix the finest $\\mathbf{k}$-point spacing and the reference functional, and compare the masses obtained at the two smallest smearings. The maximum relative change across the three principal masses must be less than a threshold $\\tau_\\sigma$.\n  - Fix the finest $\\mathbf{k}$-point spacing and the smallest smearing, and compare the masses from all functionals against the reference functional. The maximum relative change across the three principal masses (over all non-reference functionals) must be less than a threshold $\\tau_f$.\n  - The final boolean result for a test case is true if and only if all three criteria above are satisfied.\n- Implement the $\\mathbf{k}$-space grids as uniform cubic grids on the cube $[-q_{\\max}, q_{\\max}]^3$ centered at $\\mathbf{k}_0$, with grid spacing $\\Delta k$ in $\\text{\\AA}^{-1}$. Use all grid points in the least-squares fit; there is no need to remove the $\\mathbf{q}=\\mathbf{0}$ point.\n\nPhysical units and constants:\n- Use energies in $\\text{eV}$, wave vectors in $\\text{\\AA}^{-1}$, and convert to standard units internally as needed. Report the final effective masses as dimensionless ratios relative to the electron mass $m_e$ (unitless). No other physical units appear in the final answer.\n- Use the following fixed numerical values for constants: $\\hbar = 1.054571817\\times 10^{-34}\\ \\mathrm{J\\cdot s}$, $m_e = 9.1093837015\\times 10^{-31}\\ \\mathrm{kg}$, $e = 1.602176634\\times 10^{-19}\\ \\mathrm{C}$, and $1\\ \\text{\\AA} = 10^{-10}\\ \\mathrm{m}$.\n\nTest suite:\nYour program must evaluate the convergence test on the following four independent synthetic cases. In all cases, set $\\mathbf{k}_0 = \\mathbf{0}$, $E_0 = 0$, use a fixed random seed for the noise, and construct the diagonal target curvature in the principal axes from the target principal masses by enforcing the relation between curvature and mass that you derive. For each case, the generator parameters are:\n\n- Case A (happy path, isotropic light band):\n  - Target masses (principal axes) in units of $m_e$: $(0.2, 0.2, 0.2)$.\n  - Quartic coefficient $\\lambda = 10.0\\ \\mathrm{eV\\cdot \\AA^4}$.\n  - Smearing-curvature coupling $c_\\sigma = 0.03$ per $\\mathrm{eV}$ (dimension $1/\\mathrm{eV}$).\n  - Exchange-correlation functional scalings $s \\in \\{1.0, 1.01\\}$.\n  - $\\mathbf{k}$-grid steps $\\Delta k \\in \\{0.05, 0.025, 0.0125\\}\\ \\text{\\AA}^{-1}$.\n  - Smearings $\\sigma \\in \\{0.08, 0.04, 0.02\\}\\ \\mathrm{eV}$.\n  - Grid half-width $q_{\\max} = 0.12\\ \\text{\\AA}^{-1}$.\n  - Noise standard deviation set to $\\kappa \\sigma$ with $\\kappa = 0.006$.\n  - Convergence thresholds: $\\tau_k = 0.03$, $\\tau_\\sigma = 0.03$, $\\tau_f = 0.05$.\n\n- Case B (anisotropic ellipsoidal valley):\n  - Target masses: $(0.1, 0.5, 1.5)$.\n  - $\\lambda = 6.0\\ \\mathrm{eV\\cdot \\AA^4}$.\n  - $c_\\sigma = 0.02$ per $\\mathrm{eV}$.\n  - $s \\in \\{1.0, 1.02\\}$.\n  - $\\Delta k \\in \\{0.06, 0.03, 0.015\\}\\ \\text{\\AA}^{-1}$.\n  - $\\sigma \\in \\{0.06, 0.03, 0.015\\}\\ \\mathrm{eV}$.\n  - $q_{\\max} = 0.12\\ \\text{\\AA}^{-1}$.\n  - $\\kappa = 0.008$.\n  - $\\tau_k = 0.03$, $\\tau_\\sigma = 0.03$, $\\tau_f = 0.05$.\n\n- Case C (near-flat heavy isotropic band, boundary condition on $\\mathbf{k}$-density):\n  - Target masses: $(5.0, 5.0, 5.0)$.\n  - $\\lambda = 2.0\\ \\mathrm{eV\\cdot \\AA^4}$.\n  - $c_\\sigma = 0.02$ per $\\mathrm{eV}$.\n  - $s \\in \\{1.0, 1.005\\}$.\n  - $\\Delta k \\in \\{0.08, 0.04, 0.02\\}\\ \\text{\\AA}^{-1}$.\n  - $\\sigma \\in \\{0.10, 0.05, 0.02\\}\\ \\mathrm{eV}$.\n  - $q_{\\max} = 0.20\\ \\text{\\AA}^{-1}$.\n  - $\\kappa = 0.003$.\n  - $\\tau_k = 0.03$, $\\tau_\\sigma = 0.03$, $\\tau_f = 0.05$.\n\n- Case D (functional-choice sensitivity, designed to fail):\n  - Target masses: $(0.3, 0.3, 0.3)$.\n  - $\\lambda = 8.0\\ \\mathrm{eV\\cdot \\AA^4}$.\n  - $c_\\sigma = 0.03$ per $\\mathrm{eV}$.\n  - $s \\in \\{0.90, 1.10\\}$.\n  - $\\Delta k \\in \\{0.05, 0.025, 0.0125\\}\\ \\text{\\AA}^{-1}$.\n  - $\\sigma \\in \\{0.08, 0.04, 0.02\\}\\ \\mathrm{eV}$.\n  - $q_{\\max} = 0.12\\ \\text{\\AA}^{-1}$.\n  - $\\kappa = 0.006$.\n  - $\\tau_k = 0.03$, $\\tau_\\sigma = 0.03$, $\\tau_f = 0.05$.\n\nAlgorithmic requirements:\n- For each case and for every combination of $\\Delta k$, $\\sigma$, and functional scaling $s$, generate the synthetic energies on the uniform cubic grid in $\\mathbf{q}$, fit a full quadratic model\n  $$E(\\mathbf{q}) \\approx c + \\mathbf{b}^\\mathsf{T}\\mathbf{q} + \\tfrac{1}{2} q_x^2 H_{xx} + \\tfrac{1}{2} q_y^2 H_{yy} + \\tfrac{1}{2} q_z^2 H_{zz} + q_x q_y H_{xy} + q_x q_z H_{xz} + q_y q_z H_{yz},$$\n  and extract the symmetric Hessian $\\mathbf{H}$. Then diagonalize $\\mathbf{H}$ to obtain the principal curvatures. Convert these to principal effective masses in units of $m_e$ using your derived relation.\n- Implement the three convergence checks as specified and return one boolean per case, true if converged, false otherwise.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (for example, \"[True,False,True,False]\"). The list must contain exactly four boolean entries, in the order of Cases A, B, C, D.", "solution": "The problem requires the design of a numerical program to test the convergence of charge carrier effective mass calculations. This involves deriving the physical relationship between band structure and effective mass, implementing a numerical procedure to extract this mass from synthetic data, and applying a specific set of convergence criteria. The problem is well-posed, scientifically grounded, and provides all necessary information for a unique solution.\n\nFirst, we must derive the effective mass tensor from the stated first principles of semiclassical electron dynamics. An electron in a crystal, subject to an external force $\\mathbf{F}$ (e.g., from an electric field $\\mathbf{E}$, so that $\\mathbf{F} = -e\\mathbf{E}$ where $e$ is the elementary charge), experiences a change in its crystal momentum $\\mathbf{k}$ according to $\\hbar \\frac{d\\mathbf{k}}{dt} = \\mathbf{F}$. The electron's group velocity $\\mathbf{v}$ is given by $\\mathbf{v}(\\mathbf{k}) = \\frac{1}{\\hbar}\\nabla_{\\mathbf{k}} E(\\mathbf{k})$, where $E(\\mathbf{k})$ is the energy of the band.\n\nThe acceleration of the electron is the time derivative of its velocity, $\\mathbf{a} = \\frac{d\\mathbf{v}}{dt}$. Applying the chain rule, we can express the $i$-th component of acceleration as:\n$$ a_i = \\frac{dv_i}{dt} = \\sum_{j=1}^{3} \\frac{\\partial v_i}{\\partial k_j} \\frac{dk_j}{dt} $$\nSubstituting the expressions for velocity and the time derivative of crystal momentum, we obtain:\n$$ a_i = \\sum_{j=1}^{3} \\frac{\\partial}{\\partial k_j} \\left( \\frac{1}{\\hbar} \\frac{\\partial E}{\\partial k_i} \\right) \\left( \\frac{F_j}{\\hbar} \\right) = \\frac{1}{\\hbar^2} \\sum_{j=1}^{3} \\left( \\frac{\\partial^2 E}{\\partial k_i \\partial k_j} \\right) F_j $$\nThis equation relates the acceleration vector $\\mathbf{a}$ to the force vector $\\mathbf{F}$ via a tensor. Let us define the Hessian matrix of the band energy as $\\mathbf{H}_E$, with components $(\\mathbf{H}_E)_{ij} = \\frac{\\partial^2 E}{\\partial k_i \\partial k_j}$. The equation of motion becomes:\n$$ \\mathbf{a} = \\left( \\frac{1}{\\hbar^2} \\mathbf{H}_E \\right) \\mathbf{F} $$\nThis has the same form as the classical equation of motion, $\\mathbf{a} = \\mathbf{M}^{-1}\\mathbf{F}$, where $\\mathbf{M}$ is the mass tensor. By direct comparison, we identify the inverse effective mass tensor as:\n$$ (\\mathbf{M}_{\\mathrm{eff}})^{-1} = \\frac{1}{\\hbar^2} \\mathbf{H}_E $$\nTherefore, the effective mass tensor $\\mathbf{M}_{\\mathrm{eff}}$ is the inverse of this quantity:\n$$ \\mathbf{M}_{\\mathrm{eff}} = \\hbar^2 (\\mathbf{H}_E)^{-1} $$\nThis tensor quantifies the inertial properties of a charge carrier near a band extremum. Its eigenvalues are the principal effective masses, which correspond to the inertial response along the principal axes of the constant-energy surface. If the principal curvatures (eigenvalues of $\\mathbf{H}_E$) are denoted by $h_i$, the corresponding principal effective masses are $M_i = \\hbar^2 / h_i$.\n\nFor practical implementation, we must handle physical units with care. The problem specifies energies in electron-volts ($\\mathrm{eV}$) and wave vectors in inverse Angstroms ($\\text{\\AA}^{-1}$). The Hessian extracted from fitted data, $\\mathbf{H}'$, will have units of $\\mathrm{eV} \\cdot \\text{\\AA}^2$. To calculate mass in kilograms ($\\mathrm{kg}$), $\\mathbf{H}'$ must be converted to SI units of Joule-meters squared ($\\mathrm{J}\\cdot\\mathrm{m}^2$). The conversion is:\n$$ 1 \\ \\mathrm{eV} \\cdot \\text{\\AA}^2 = (e \\ \\mathrm{J}) \\cdot (10^{-10} \\ \\mathrm{m})^2 = e \\cdot 10^{-20} \\ \\mathrm{J}\\cdot\\mathrm{m}^2 $$\nwhere $e = 1.602176634 \\times 10^{-19} \\ \\mathrm{C}$ is the elementary charge magnitude. The principal effective masses in SI units are $M_i = \\hbar^2 / (h'_i \\cdot e \\cdot 10^{-20})$, where $h'_i$ are the eigenvalues of $\\mathbf{H}'$. The final results are to be reported as dimensionless ratios relative to the electron rest mass, $m_e$:\n$$ m^*_i = \\frac{M_i}{m_e} = \\frac{\\hbar^2}{m_e \\cdot e \\cdot 10^{-20}} \\frac{1}{h'_i} $$\nThe conversion constant $C = \\frac{\\hbar^2}{m_e \\cdot e \\cdot 10^{-20}}$ is calculated using the provided values for $\\hbar$, $m_e$, and $e$.\n$C = \\frac{(1.054571817 \\times 10^{-34})^2}{(9.1093837015 \\times 10^{-31}) \\cdot (1.602176634 \\times 10^{-19}) \\cdot 10^{-20}} \\approx 7.61996$.\n\nThe numerical algorithm proceeds as follows:\n1.  **Synthetic Band Structure Generation**: For each set of parameters ($\\Delta k, \\sigma, s$), a synthetic band structure is generated. The target principal curvatures $h'_{\\text{target}, i}$ are computed from the given target masses $m^*_{\\text{target}, i}$ using the inverse relation $h'_{\\text{target}, i} = C/m^*_{\\text{target}, i}$. The effective Hessian for the generator, $\\mathbf{H}_{\\mathrm{eff}}$, which is diagonal in the principal axes, is constructed by applying scaling factors for the exchange-correlation functional ($s$) and smearing-induced curvature reduction ($1 - c_\\sigma \\sigma$): $\\mathbf{H}_{\\mathrm{eff}} = s \\cdot (1 - c_\\sigma \\sigma) \\cdot \\text{diag}(h'_{\\text{target}, i})$. A uniform cubic grid of $\\mathbf{q}$ vectors is generated around $\\mathbf{q}=\\mathbf{0}$. For each point $\\mathbf{q}$ on this grid, the energy is calculated as $E(\\mathbf{q}) = \\tfrac{1}{2}\\,\\mathbf{q}^\\mathsf{T}\\,\\mathbf{H}_{\\mathrm{eff}}\\,\\mathbf{q} + \\lambda\\,\\lVert \\mathbf{q} \\rVert^4 + \\epsilon$, where $\\epsilon$ is Gaussian noise with standard deviation $\\kappa \\sigma$. A fixed random seed ensures reproducibility.\n\n2.  **Hessian Extraction via Least-Squares Fit**: The generated energy data $(E, \\mathbf{q})$ are fitted to a full quadratic model: $E(\\mathbf{q}) \\approx c + \\mathbf{b}^\\mathsf{T}\\mathbf{q} + \\frac{1}{2}\\mathbf{q}^\\mathsf{T}\\mathbf{H}\\mathbf{q}$. This is a linear least-squares problem, $E = \\mathbf{Xp}$, where $\\mathbf{p}$ is a vector of the $10$ unknown coefficients: constant term ($c$), three linear terms ($b_x, b_y, b_z$), and six unique symmetric Hessian components ($H_{xx}, H_{yy}, H_{zz}, H_{xy}, H_{xz}, H_{yz}$). The design matrix $\\mathbf{X}$ is constructed with rows corresponding to each $\\mathbf{q}$-point, containing the basis functions: $[1, q_x, q_y, q_z, \\frac{1}{2}q_x^2, \\frac{1}{2}q_y^2, \\frac{1}{2}q_z^2, q_x q_y, q_x q_z, q_y q_z]$. The system is solved for $\\mathbf{p}$ using `numpy.linalg.lstsq`. The symmetric Hessian matrix $\\mathbf{H}$ is then assembled from the fitted coefficients.\n\n3.  **Effective Mass Calculation**: The fitted Hessian $\\mathbf{H}$ (in units of $\\mathrm{eV}\\cdot\\text{\\AA}^2$) is diagonalized using `numpy.linalg.eigh` to obtain its eigenvalues, which are the principal curvatures $h'_i$. The dimensionless principal effective masses $m^*_i$ are then calculated using the formula $m^*_i = C/h'_i$. The resulting three masses are sorted for consistent comparison.\n\n4.  **Convergence Test**: For each test case, the effective masses are computed for all combinations of the given numerical parameters. The results are stored and subjected to three checks:\n    - **k-point convergence**: With the reference functional and smallest smearing fixed, the relative difference in masses between the two finest $\\mathbf{k}$-grid spacings is computed. The maximum relative change across the three principal masses, $|\\text{mass}_{\\text{fine}} - \\text{mass}_{\\text{coarse}}| / \\text{mass}_{\\text{fine}}$, must be below a threshold $\\tau_k$.\n    - **Smearing convergence**: With the reference functional and finest $\\mathbf{k}$-grid fixed, the maximum relative difference in masses between the two smallest smearings must be below a threshold $\\tau_\\sigma$.\n    - **Functional convergence**: With the finest $\\mathbf{k}$-grid and smallest smearing fixed, the maximum relative difference between masses calculated with the reference functional and all other functionals must be below a threshold $\\tau_f$.\nA test case is considered \"converged\" (result is `True`) if and only if all three of these conditions are satisfied. This procedure is applied independently to the four specified test cases.\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the convergence test for effective mass calculations.\n    \"\"\"\n    # Physical Constants\n    HBAR = 1.054571817e-34  # J*s\n    M_E = 9.1093837015e-31  # kg\n    E_CHARGE = 1.602176634e-19  # C\n    ANGSTROM = 1e-10  # m\n\n    # Conversion constant from Hessian [eV*Angstrom^2] to dimensionless mass m*/m_e\n    # m* = (HBAR^2 / (m_e * h_eV_A2 * E_CHARGE * ANGSTROM^2))\n    MASS_CONVERSION_FACTOR = (HBAR**2) / (M_E * E_CHARGE * ANGSTROM**2)\n\n    # Set a fixed random seed for reproducibility\n    np.random.seed(42)\n\n    test_cases = [\n        # Case A (happy path, isotropic light band)\n        {\n            \"target_masses\": (0.2, 0.2, 0.2), \"lambda\": 10.0, \"c_sigma\": 0.03,\n            \"s_list\": (1.0, 1.01), \"delta_k_list\": (0.05, 0.025, 0.0125),\n            \"sigma_list\": (0.08, 0.04, 0.02), \"q_max\": 0.12, \"kappa\": 0.006,\n            \"tau_k\": 0.03, \"tau_sigma\": 0.03, \"tau_f\": 0.05,\n        },\n        # Case B (anisotropic ellipsoidal valley)\n        {\n            \"target_masses\": (0.1, 0.5, 1.5), \"lambda\": 6.0, \"c_sigma\": 0.02,\n            \"s_list\": (1.0, 1.02), \"delta_k_list\": (0.06, 0.03, 0.015),\n            \"sigma_list\": (0.06, 0.03, 0.015), \"q_max\": 0.12, \"kappa\": 0.008,\n            \"tau_k\": 0.03, \"tau_sigma\": 0.03, \"tau_f\": 0.05,\n        },\n        # Case C (near-flat heavy isotropic band)\n        {\n            \"target_masses\": (5.0, 5.0, 5.0), \"lambda\": 2.0, \"c_sigma\": 0.02,\n            \"s_list\": (1.0, 1.005), \"delta_k_list\": (0.08, 0.04, 0.02),\n            \"sigma_list\": (0.10, 0.05, 0.02), \"q_max\": 0.20, \"kappa\": 0.003,\n            \"tau_k\": 0.03, \"tau_sigma\": 0.03, \"tau_f\": 0.05,\n        },\n        # Case D (functional-choice sensitivity, designed to fail)\n        {\n            \"target_masses\": (0.3, 0.3, 0.3), \"lambda\": 8.0, \"c_sigma\": 0.03,\n            \"s_list\": (0.90, 1.10), \"delta_k_list\": (0.05, 0.025, 0.0125),\n            \"sigma_list\": (0.08, 0.04, 0.02), \"q_max\": 0.12, \"kappa\": 0.006,\n            \"tau_k\": 0.03, \"tau_sigma\": 0.03, \"tau_f\": 0.05,\n        }\n    ]\n\n    def _calculate_masses(params):\n        \"\"\"Generates synthetic band, fits Hessian, and returns effective masses.\"\"\"\n        # Unpack parameters\n        target_masses = params[\"target_masses\"]\n        lambda_val = params[\"lambda\"]\n        c_sigma = params[\"c_sigma\"]\n        s = params[\"s\"]\n        delta_k = params[\"delta_k\"]\n        sigma = params[\"sigma\"]\n        q_max = params[\"q_max\"]\n        kappa = params[\"kappa\"]\n\n        # 1. Generate k-point grid\n        N = int(np.round(q_max / delta_k))\n        q_1d = np.arange(-N, N + 1) * delta_k\n        qx, qy, qz = np.meshgrid(q_1d, q_1d, q_1d, indexing='ij')\n        q_vectors = np.vstack([qx.ravel(), qy.ravel(), qz.ravel()]).T\n\n        # 2. Generate synthetic band energies\n        h_target_diag = MASS_CONVERSION_FACTOR / np.array(target_masses)\n        h_eff_diag = s * (1 - c_sigma * sigma) * h_target_diag\n        \n        quadratic_term = 0.5 * np.sum(q_vectors**2 * h_eff_diag, axis=1)\n        quartic_term = lambda_val * (np.linalg.norm(q_vectors, axis=1)**4)\n        noise = np.random.normal(0, kappa * sigma, size=len(q_vectors))\n        \n        energies = quadratic_term + quartic_term + noise\n\n        # 3. Perform least-squares fit for the Hessian\n        q_x, q_y, q_z = q_vectors.T\n        design_matrix = np.vstack([\n            np.ones_like(q_x), q_x, q_y, q_z,\n            0.5 * q_x**2, 0.5 * q_y**2, 0.5 * q_z**2,\n            q_x * q_y, q_x * q_z, q_y * q_z\n        ]).T\n        \n        coeffs, _, _, _ = np.linalg.lstsq(design_matrix, energies, rcond=None)\n        \n        # Reconstruct Hessian matrix from coefficients\n        # p = [c, bx, by, bz, Hxx, Hyy, Hzz, Hxy, Hxz, Hyz]\n        hessian = np.array([\n            [coeffs[4], coeffs[7], coeffs[8]],\n            [coeffs[7], coeffs[5], coeffs[9]],\n            [coeffs[8], coeffs[9], coeffs[6]]\n        ])\n\n        # 4. Calculate effective masses\n        principal_curvatures = np.linalg.eigh(hessian)[0]\n        # Avoid division by zero or negative curvatures, although not expected here\n        # A small positive curvature means a very large mass.\n        # A negative curvature is unphysical for a band minimum.\n        principal_curvatures[principal_curvatures = 1e-9] = 1e-9\n        \n        effective_masses = MASS_CONVERSION_FACTOR / principal_curvatures\n        return tuple(sorted(effective_masses))\n\n    def run_convergence_test(case):\n        \"\"\"Runs the full convergence test for a single case.\"\"\"\n        # Sort parameter lists to easily access finest/smallest values\n        delta_k_list = sorted(case[\"delta_k_list\"])\n        sigma_list = sorted(case[\"sigma_list\"])\n        s_list = case[\"s_list\"] # Order matters, first is reference\n\n        # Store all computed masses\n        all_masses = {}\n        param_set = {}\n        for dk in delta_k_list:\n            for sig in sigma_list:\n                for s_val in s_list:\n                    param_set.update(case)\n                    param_set[\"delta_k\"] = dk\n                    param_set[\"sigma\"] = sig\n                    param_set[\"s\"] = s_val\n                    all_masses[(dk, sig, s_val)] = _calculate_masses(param_set)\n        \n        # Reference parameters\n        s_ref = s_list[0]\n        dk_ref1, dk_ref2 = delta_k_list[0], delta_k_list[1]\n        sigma_ref1, sigma_ref2 = sigma_list[0], sigma_list[1]\n\n        # --- Check 1: k-point convergence ---\n        m_k1 = np.array(all_masses[(dk_ref1, sigma_ref1, s_ref)])\n        m_k2 = np.array(all_masses[(dk_ref2, sigma_ref1, s_ref)])\n        rel_change_k = np.max(np.abs(m_k1 - m_k2) / np.abs(m_k1))\n        is_k_converged = rel_change_k  case[\"tau_k\"]\n\n        # --- Check 2: Smearing convergence ---\n        m_s1 = np.array(all_masses[(dk_ref1, sigma_ref1, s_ref)])\n        m_s2 = np.array(all_masses[(dk_ref1, sigma_ref2, s_ref)])\n        rel_change_sigma = np.max(np.abs(m_s1 - m_s2) / np.abs(m_s1))\n        is_sigma_converged = rel_change_sigma  case[\"tau_sigma\"]\n\n        # --- Check 3: Functional convergence ---\n        m_f_ref = np.array(all_masses[(dk_ref1, sigma_ref1, s_ref)])\n        max_rel_change_f = 0.0\n        for s_other in s_list[1:]:\n            m_f_other = np.array(all_masses[(dk_ref1, sigma_ref1, s_other)])\n            rel_change = np.max(np.abs(m_f_ref - m_f_other) / np.abs(m_f_ref))\n            if rel_change > max_rel_change_f:\n                max_rel_change_f = rel_change\n        is_f_converged = max_rel_change_f  case[\"tau_f\"]\n        \n        return is_k_converged and is_sigma_converged and is_f_converged\n\n    final_results = []\n    for case_data in test_cases:\n        final_results.append(run_convergence_test(case_data))\n    \n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "answer": "[True,True,True,False]", "id": "2817084"}]}