{"hands_on_practices": [{"introduction": "Understanding the properties of crystalline materials begins with a precise accounting of their fundamental building blocks. This exercise requires you to apply the definitions of a lattice, a basis, and a unit cell to determine the number of atoms within a specified cell for the hexagonal close-packed (HCP) structure. Mastering this calculation [@problem_id:2767901] is a crucial first step for deriving macroscopic properties like mass density and packing efficiency from the microscopic atomic arrangement.", "problem": "In a crystalline solid with a hexagonal close-packed (HCP) structure, the underlying Bravais lattice is hexagonal and the structure can be specified by a two-atom basis. Let the conventional crystallographic hexagonal cell be defined by lattice vectors\n$$\n\\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}},\\quad\n\\mathbf{a}_{2} = a\\left(\\frac{1}{2}\\,\\hat{\\mathbf{x}} + \\frac{\\sqrt{3}}{2}\\,\\hat{\\mathbf{y}}\\right),\\quad\n\\mathbf{a}_{3} = c\\,\\hat{\\mathbf{z}},\n$$\nwith $a0$ and $c0$. Angles in the basal plane are $60^{\\circ}$ by construction; all angles are to be interpreted in degrees. The HCP motif is completed by a basis of two atoms located at fractional coordinates (in the lattice basis $\\{\\mathbf{a}_{1},\\mathbf{a}_{2},\\mathbf{a}_{3}\\}$)\n$$\n\\mathbf{r}_{1} = (0,0,0),\\qquad \\mathbf{r}_{2} = \\left(\\frac{2}{3},\\,\\frac{1}{3},\\,\\frac{1}{2}\\right).\n$$\nStarting only from the fundamental definitions of a Bravais lattice, a primitive cell, and a lattice basis, and from the scalar triple product formula for volumes, determine:\n- the exact number $N$ of atoms contained in the conventional hexagonal unit cell defined above, and\n- the exact volume per atom $V_{\\text{atom}}$ expressed in closed form in terms of $a$ and $c$.\n\nExpress your final result as a single row matrix $\\begin{pmatrix}N  V_{\\text{atom}}\\end{pmatrix}$, symbolically in $a$ and $c$ only. Do not substitute numerical values and do not attach units to your final answer. Angles, where used, must be treated in degrees. No rounding is required; provide exact expressions.", "solution": "The problem requires the determination of the number of atoms $N$ within a specified unit cell of a hexagonal close-packed (HCP) structure, and the volume per atom $V_{\\text{atom}}$.\n\nFirst, the problem statement must be validated for correctness and completeness.\n\nThe givens are:\n1.  A crystalline solid with an HCP structure.\n2.  The underlying Bravais lattice is hexagonal.\n3.  A specific unit cell, which the problem refers to as the \"conventional crystallographic hexagonal cell,\" is defined by the lattice vectors:\n    $$\n    \\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}} \\\\\n    \\mathbf{a}_{2} = a\\left(\\frac{1}{2}\\,\\hat{\\mathbf{x}} + \\frac{\\sqrt{3}}{2}\\,\\hat{\\mathbf{y}}\\right) \\\\\n    \\mathbf{a}_{3} = c\\,\\hat{\\mathbf{z}}\n    $$\n    with parameters $a  0$ and $c  0$.\n4.  The basis consists of two atoms, with positions given in fractional coordinates with respect to the lattice vectors $\\{\\mathbf{a}_{1}, \\mathbf{a}_{2}, \\mathbf{a}_{3}\\}$:\n    $$\n    \\mathbf{r}_{1} = (0,0,0) \\\\\n    \\mathbf{r}_{2} = \\left(\\frac{2}{3},\\,\\frac{1}{3},\\,\\frac{1}{2}\\right)\n    $$\n\nThe problem is scientifically sound. The vectors $\\mathbf{a}_{1}$ and $\\mathbf{a}_{2}$ are in the basal plane with $|\\mathbf{a}_{1}| = |\\mathbf{a}_{2}| = a$ and the angle between them is $60^{\\circ}$, which is characteristic of a hexagonal lattice. The vector $\\mathbf{a}_{3}$ is orthogonal to the basal plane. The basis coordinates are a valid choice for describing the HCP stacking. The problem is well-posed and provides all necessary information. Although the problem uses the term \"conventional crystallographic hexagonal cell\" to describe a cell that is in fact a primitive cell of the hexagonal Bravais lattice, the wording \"be defined by\" establishes a local definition that must be strictly followed. The problem is therefore valid.\n\nThe solution proceeds in two parts.\n\nPart 1: Determination of the number of atoms $N$ in the defined unit cell.\nThe crystal structure is generated by placing the two-atom basis at every point of the hexagonal Bravais lattice. The lattice points are given by vectors $\\mathbf{R} = n_1\\mathbf{a}_1 + n_2\\mathbf{a}_2 + n_3\\mathbf{a}_3$ for integers $n_1, n_2, n_3$.\nThe unit cell is the parallelepiped spanned by the vectors $\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$. By its definition, it has lattice points only at its vertices. A cell with lattice points only at its corners is a primitive cell. A primitive cell contains exactly one lattice point. This can be confirmed by counting the contribution of the vertices to a single cell: there are $8$ vertices, each shared by $8$ adjacent cells. The total number of lattice points per cell is $8 \\times \\frac{1}{8} = 1$.\n\nThe total number of atoms in the cell is the number of lattice points per cell multiplied by the number of atoms in the basis.\nAlternatively, and more rigorously, we can count the atoms whose positions lie within the volume of the cell. The cell can be defined as the set of points $\\mathbf{P} = u_1\\mathbf{a}_1 + u_2\\mathbf{a}_2 + u_3\\mathbf{a}_3$ where $0 \\le u_i  1$ for $i=1, 2, 3$.\n\nThe positions of the atoms in the crystal are given by $\\mathbf{P}_{n,i} = \\mathbf{R}_n + \\mathbf{p}_i$, where $\\mathbf{R}_n$ is a lattice vector and $\\mathbf{p}_i$ are the basis position vectors.\nThe basis vectors are $\\mathbf{p}_1 = 0\\mathbf{a}_1 + 0\\mathbf{a}_2 + 0\\mathbf{a}_3$ and $\\mathbf{p}_2 = \\frac{2}{3}\\mathbf{a}_1 + \\frac{1}{3}\\mathbf{a}_2 + \\frac{1}{2}\\mathbf{a}_3$.\n\nThe first set of atoms are located at the lattice points themselves (since $\\mathbf{p}_1 = \\mathbf{0}$). As established, the cell contains a total of one atom from this set. This accounts for the shared atoms at the corners.\n\nThe second set of atoms are located at positions $\\mathbf{R}_n + \\mathbf{p}_2$. We must find how many of these are inside our specific cell defined by $0 \\le u_i  1$. We consider the atom associated with the lattice origin $\\mathbf{R}_0 = \\mathbf{0}$. Its position is $\\mathbf{p}_2$. The fractional coordinates of this atom are given as $\\left(\\frac{2}{3}, \\frac{1}{3}, \\frac{1}{2}\\right)$. Since these coordinates $u_1 = \\frac{2}{3}$, $u_2 = \\frac{1}{3}$, and $u_3 = \\frac{1}{2}$ all satisfy the condition $0 \\le u_i  1$, this atom lies entirely inside the unit cell. It is not shared with any other cell. Thus, it contributes a full count of $1$ to the total number of atoms in the cell.\n\nThe total number of atoms $N$ in the defined unit cell is the sum of contributions from both sets of atoms:\n$$N = 1 (\\text{from basis atom 1}) + 1 (\\text{from basis atom 2}) = 2$$\n\nPart 2: Determination of the volume per atom $V_{\\text{atom}}$.\nFirst, we calculate the volume of the unit cell, $V_{\\text{cell}}$. The volume of the parallelepiped spanned by $\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$ is given by the absolute value of their scalar triple product, $V_{\\text{cell}} = |\\mathbf{a}_3 \\cdot (\\mathbf{a}_1 \\times \\mathbf{a}_2)|$.\nWe express the vectors in Cartesian coordinates:\n$$\n\\mathbf{a}_{1} = (a, 0, 0) \\\\\n\\mathbf{a}_{2} = \\left(\\frac{a}{2}, \\frac{a\\sqrt{3}}{2}, 0\\right) \\\\\n\\mathbf{a}_{3} = (0, 0, c)\n$$\nThe scalar triple product is calculated as the determinant of the matrix whose rows are these vectors:\n$$\nV_{\\text{cell}} = \\left| \\det \\begin{pmatrix} a  0  0 \\\\ \\frac{a}{2}  \\frac{a\\sqrt{3}}{2}  0 \\\\ 0  0  c \\end{pmatrix} \\right|\n$$\nThe determinant of this upper-triangular matrix is the product of its diagonal elements:\n$$\n\\det = a \\cdot \\left( \\frac{a\\sqrt{3}}{2} \\right) \\cdot c = \\frac{\\sqrt{3}}{2}a^2 c\n$$\nSince $a  0$ and $c  0$, the volume is positive.\n$$\nV_{\\text{cell}} = \\frac{\\sqrt{3}}{2}a^2 c\n$$\nThe volume per atom, $V_{\\text{atom}}$, is the total volume of the cell divided by the number of atoms it contains:\n$$\nV_{\\text{atom}} = \\frac{V_{\\text{cell}}}{N}\n$$\nSubstituting the calculated values for $V_{\\text{cell}}$ and $N$:\n$$\nV_{\\text{atom}} = \\frac{\\frac{\\sqrt{3}}{2}a^2 c}{2} = \\frac{\\sqrt{3}}{4}a^2 c\n$$\nThe problem requires the result to be expressed as a single row matrix $\\begin{pmatrix}N  V_{\\text{atom}}\\end{pmatrix}$.\nThe final result is thus $\\begin{pmatrix}2  \\frac{\\sqrt{3}}{4}a^2 c\\end{pmatrix}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} 2  \\frac{\\sqrt{3}}{4} a^{2} c \\end{pmatrix}}\n$$", "id": "2767901"}, {"introduction": "While the positions of Bragg peaks in a diffraction experiment reveal the geometry of the Bravais lattice, their intensities hold the key to the arrangement of atoms within the unit cell. This practice delves into the concept of the structure factor, which acts as the mathematical link between the real-space atomic basis and the reciprocal-space diffraction pattern. By analyzing a crystal with a two-atom basis [@problem_id:2767908], you will discover how the basis dictates systematic absences and provides an unambiguous signature of the underlying structure.", "problem": "A crystalline solid is constructed by interpenetrating two simple cubic sublattices with the same cubic parameter $a$, one containing atoms of type $A$ at positions $\\mathbf{R} = n_1 a \\,\\hat{\\mathbf{x}} + n_2 a \\,\\hat{\\mathbf{y}} + n_3 a \\,\\hat{\\mathbf{z}}$ with integers $n_1,n_2,n_3$, and the other containing atoms of type $B$ at positions $\\mathbf{R} + \\boldsymbol{\\delta}$ with $\\boldsymbol{\\delta} = \\tfrac{a}{2}(\\hat{\\mathbf{x}}+\\hat{\\mathbf{y}}+\\hat{\\mathbf{z}})$. Assume the kinematic (first Born) approximation for diffraction, and that each atom scatters with an isotropic atomic form factor $f_A$ or $f_B$ evaluated at the same momentum transfer. The same set of atomic positions can alternatively be represented as a single simple cubic Bravais lattice with a two-atom basis at fractional coordinates $(0,0,0)$ and $(\\tfrac{1}{2},\\tfrac{1}{2},\\tfrac{1}{2})$.\n\nStarting only from the definition of the electron density as a sum over a Bravais lattice and a basis, the definition of the reciprocal lattice, and the definition of the structure factor as the Fourier transform of the basis, determine which statements about the diffraction from this crystal are correct. In particular, address the equivalence (or lack thereof) of the two descriptions, the conditions for systematic absences, and the location of Bragg peaks.\n\nSelect all options that are correct.\n\nA. For the representation as a simple cubic Bravais lattice with a two-atom basis at fractional coordinates $(0,0,0)$ and $(\\tfrac{1}{2},\\tfrac{1}{2},\\tfrac{1}{2})$, the structure factor for Miller indices $(h,k,l)$ is $F_{hkl} = f_A + f_B \\,\\mathrm{e}^{i\\pi(h+k+l)}$. When $f_A = f_B$, reflections with $h+k+l$ odd are extinct, and the surviving Bragg peak positions coincide with those of the reciprocal lattice for a body-centered cubic real lattice.\n\nB. The union of the two simple cubic sublattices at $(0,0,0)$ and $(\\tfrac{1}{2},\\tfrac{1}{2},\\tfrac{1}{2})$ is always describable as a body-centered cubic Bravais lattice with a single-atom basis; therefore, the pattern of systematic absences is independent of the values of $f_A$ and $f_B$.\n\nC. Computing the scattering amplitude either by summing over the two interpenetrating simple cubic sublattices separately or by factoring into a simple cubic lattice sum times a two-atom basis sum yields identical amplitudes at every reciprocal-lattice vector, differing at most by an overall phase that cancels in intensities; hence, both descriptions are strictly equivalent for all $f_A,f_B$.\n\nD. Introducing the second sublattice at $\\boldsymbol{\\delta} = (\\tfrac{a}{2},\\tfrac{a}{2},\\tfrac{a}{2})$ doubles the real-space unit-cell volume and therefore halves the reciprocal-lattice spacings, shifting all Bragg peak positions to $(h/2,k/2,l/2)$ relative to those of a single simple cubic lattice.\n\nE. If $f_A = -\\,f_B$, then reflections with $h+k+l$ even are extinct and those with $h+k+l$ odd are allowed.", "solution": "We begin from first principles: In the kinematic (first Born) approximation, the elastic scattering amplitude at momentum transfer $\\mathbf{q}$ is proportional to the Fourier transform of the electron density $\\rho(\\mathbf{r})$. For a crystal described as a Bravais lattice $\\{\\mathbf{R}\\}$ with a basis $\\{\\boldsymbol{\\tau}_j\\}$ and atomic form factors $f_j$, one writes\n$$\n\\rho(\\mathbf{r}) \\;=\\; \\sum_{\\mathbf{R}} \\sum_{j} f_j \\,\\delta\\!\\left(\\mathbf{r}-\\mathbf{R}-\\boldsymbol{\\tau}_j\\right).\n$$\nThe scattering amplitude is then\n$$\nA(\\mathbf{q}) \\;\\propto\\; \\sum_{\\mathbf{R}} \\mathrm{e}^{\\,i\\mathbf{q}\\cdot \\mathbf{R}} \\;\\sum_{j} f_j \\,\\mathrm{e}^{\\,i\\mathbf{q}\\cdot \\boldsymbol{\\tau}_j} \\;=\\; L(\\mathbf{q})\\,F(\\mathbf{q}),\n$$\nwhere $L(\\mathbf{q})$ is the lattice sum, which is nonzero only when $\\mathbf{q}$ equals a reciprocal-lattice vector $\\mathbf{G}$ of the chosen Bravais lattice, and $F(\\mathbf{q})$ is the structure factor (the Fourier transform of the basis). The intensity is $I(\\mathbf{G}) \\propto |F(\\mathbf{G})|^2$ at reciprocal-lattice vectors $\\mathbf{G}$, and vanishes elsewhere.\n\nWe now apply this to the crystal at hand in two equivalent descriptions.\n\nDescription as two interpenetrating simple cubic sublattices. The total amplitude at $\\mathbf{q}$ is the sum of the contributions from the two sublattices:\n$$\nA(\\mathbf{q}) \\;\\propto\\; \\sum_{\\mathbf{R}\\in \\text{sc}} \\left[ f_A\\,\\mathrm{e}^{\\,i\\mathbf{q}\\cdot \\mathbf{R}} \\;+\\; f_B\\,\\mathrm{e}^{\\,i\\mathbf{q}\\cdot (\\mathbf{R}+\\boldsymbol{\\delta})} \\right]\n\\;=\\; \\left(f_A + f_B\\,\\mathrm{e}^{\\,i\\mathbf{q}\\cdot \\boldsymbol{\\delta}}\\right)\\sum_{\\mathbf{R}\\in \\text{sc}} \\mathrm{e}^{\\,i\\mathbf{q}\\cdot \\mathbf{R}}.\n$$\nThus the same factorization into a simple cubic lattice sum and a two-site basis factor appears.\n\nDescription as a simple cubic Bravais lattice with a two-atom basis. Here the Bravais lattice is simple cubic with conventional parameter $a$, so the reciprocal lattice is also simple cubic with primitive vectors of magnitude $2\\pi/a$. The basis is $\\boldsymbol{\\tau}_1 = (0,0,0)$ with form factor $f_A$ and $\\boldsymbol{\\tau}_2 = \\boldsymbol{\\delta} = \\tfrac{a}{2}(1,1,1)$ with form factor $f_B$. The structure factor at a reciprocal-lattice vector $\\mathbf{G}_{hkl} = \\tfrac{2\\pi}{a}(h,k,l)$ with integers $h,k,l$ is\n$$\nF_{hkl} \\;=\\; f_A\\,\\mathrm{e}^{\\,i\\mathbf{G}\\cdot \\boldsymbol{\\tau}_1} + f_B\\,\\mathrm{e}^{\\,i\\mathbf{G}\\cdot \\boldsymbol{\\tau}_2}\n\\;=\\; f_A + f_B\\,\\mathrm{e}^{\\,i \\mathbf{G}_{hkl}\\cdot \\boldsymbol{\\delta}}.\n$$\nSince $\\mathbf{G}_{hkl}\\cdot \\boldsymbol{\\delta} = \\tfrac{2\\pi}{a}(h,k,l)\\cdot \\tfrac{a}{2}(1,1,1) = \\pi(h+k+l)$, we obtain\n$$\nF_{hkl} \\;=\\; f_A + f_B\\,\\mathrm{e}^{\\,i\\pi(h+k+l)} \\;=\\; f_A + f_B\\,(-1)^{h+k+l}.\n$$\nTherefore:\n- If $f_A = f_B \\equiv f$, then $F_{hkl} = f\\left[1 + (-1)^{h+k+l}\\right]$, so $F_{hkl} = 0$ when $h+k+l$ is odd and $F_{hkl} = 2f$ when $h+k+l$ is even. The allowed Bragg peak positions are the subset of simple cubic reciprocal-lattice nodes with $h+k+l$ even. Geometrically, this subset coincides with the reciprocal lattice that one would obtain by describing the real-space lattice as body-centered cubic (a Bravais lattice with a single lattice point per primitive cell), demonstrating the identity of peak positions between the two descriptions.\n- If $f_A = -\\,f_B \\equiv f$, then $F_{hkl} = f\\left[1 - (-1)^{h+k+l}\\right]$, so $F_{hkl} = 0$ when $h+k+l$ is even and $F_{hkl} = 2f$ when $h+k+l$ is odd: the parity of the systematic absences is reversed relative to the case $f_A=f_B$.\n- For general $f_A,f_B$, the amplitudes and intensities are determined by $F_{hkl} = f_A + f_B(-1)^{h+k+l}$, and the two descriptions are strictly equivalent because both lead to the same factorization with the same basis-dependent factor.\n\nWe now analyze each option:\n\nOption A. This gives precisely the structure factor derived above, $F_{hkl} = f_A + f_B\\,\\mathrm{e}^{i\\pi(h+k+l)}$, and identifies the extinction condition for $f_A=f_B$ as $h+k+l$ odd. It also correctly states that the surviving peak positions coincide with those obtained when the crystal is represented as a body-centered cubic real lattice, because restricting to $h+k+l$ even selects exactly the same set of reciprocal-lattice vectors as in that representation. Verdict: Correct.\n\nOption B. If $A$ and $B$ are different scatterers, the crystal cannot be represented as a body-centered cubic Bravais lattice with a single-atom basis, because a single-atom basis would imply translational equivalence of all sites. In that incorrect representation, systematic absences would be independent of $f_A,f_B$, which contradicts the explicit dependence of $F_{hkl}$ on $f_A$ and $f_B$ derived above. Verdict: Incorrect.\n\nOption C. Starting from the sum over two interpenetrating simple cubic lattices,\n$$\nA(\\mathbf{q}) \\propto \\sum_{\\mathbf{R}} \\left[f_A\\,\\mathrm{e}^{i\\mathbf{q}\\cdot \\mathbf{R}} + f_B\\,\\mathrm{e}^{i\\mathbf{q}\\cdot (\\mathbf{R}+\\boldsymbol{\\delta})}\\right]\n= \\left(f_A + f_B\\,\\mathrm{e}^{i\\mathbf{q}\\cdot \\boldsymbol{\\delta}}\\right)\\sum_{\\mathbf{R}} \\mathrm{e}^{i\\mathbf{q}\\cdot \\mathbf{R}},\n$$\nwhich is exactly the lattice-sum times basis-factor factorization for the simple cubic Bravais lattice with two-atom basis. Evaluated at $\\mathbf{q}=\\mathbf{G}$, the two procedures yield the same $A(\\mathbf{G})$ up to an overall phase that has no effect on intensities. Thus the two descriptions are strictly equivalent for all $f_A,f_B$. Verdict: Correct.\n\nOption D. Adding a basis atom does not change the reciprocal lattice of the chosen Bravais lattice; it only modifies the structure factor, which governs intensities and systematic absences. Bragg peak positions remain at the reciprocal-lattice vectors $\\mathbf{G}_{hkl} = \\tfrac{2\\pi}{a}(h,k,l)$ of the simple cubic reciprocal lattice; there is no uniform shift to $(h/2,k/2,l/2)$. Verdict: Incorrect.\n\nOption E. Substituting $f_A = -\\,f_B$ into $F_{hkl} = f_A + f_B(-1)^{h+k+l}$ gives $F_{hkl} = f_A\\left[1 - (-1)^{h+k+l}\\right]$, which vanishes when $h+k+l$ is even and is nonzero when $h+k+l$ is odd. Verdict: Correct.", "answer": "$$\\boxed{ACE}$$", "id": "2767908"}, {"introduction": "The properties of nanomaterials are often dominated by their surfaces and interfaces. This exercise moves from the study of single crystals to the complex and technologically vital problem of joining two different crystal lattices. You will first derive the fundamental algebraic condition for the formation of a commensurate, or geometrically matched, interface and then implement a computational algorithm to search for these ideal low-energy configurations [@problem_id:2767838]. This practice bridges crystallographic theory with computational methods, reflecting a key approach in modern surface and interface science.", "problem": "Consider two two-dimensional Bravais lattices embedded in the same plane, described by basis matrices $A_1 \\in \\mathbb{R}^{2 \\times 2}$ and $A_2 \\in \\mathbb{R}^{2 \\times 2}$ whose columns are the primitive basis vectors expressed in nanometers. Let $R(\\theta) \\in \\mathbb{R}^{2 \\times 2}$ denote a passive in-plane rotation matrix through angle $\\theta$ in radians. A supercell matrix $M \\in \\mathbb{Z}^{2 \\times 2}$ with $\\det M \\in \\mathbb{Z}_{gt;0}$ maps the primitive cell of a lattice to a supercell of index $\\det M$ and scales its area by the same factor.\n\nStarting from the following fundamental base:\n- A lattice generated by $A$ is the set $\\Lambda(A) = \\{A \\mathbf{n} \\mid \\mathbf{n} \\in \\mathbb{Z}^2\\}$.\n- A matrix $S \\in \\mathbb{Z}^{2 \\times 2}$ with $\\det S \\in \\mathbb{Z}_{gt;0}$ defines a supercell lattice $\\Lambda(A S) \\subseteq \\Lambda(A)$ of index $\\det S$ and area $|\\det(A S)| = |\\det A| \\cdot \\det S$.\n- The rotation matrix is $R(\\theta) = \\begin{bmatrix}\\cos \\theta amp; -\\sin \\theta \\\\ \\sin \\theta amp; \\cos \\theta \\end{bmatrix}$.\n\nTask:\n1) Derive necessary and sufficient conditions, expressed purely in linear algebra over the integers, on a supercell matrix $M$ to produce a commensurate interface between $\\Lambda(A_1)$ and the rotated lattice $R(\\theta)\\Lambda(A_2)$. Your derivation must start from the base above and may only use integer-lattice concepts and properties of the determinant.\n\n2) Implement an algorithm that, given $A_1$, $A_2$, $\\theta$ (in radians), a maximum allowed determinant $D_{\\max} \\in \\mathbb{Z}_{\\ge 1}$, a maximum absolute entry bound $E_{\\max} \\in \\mathbb{Z}_{\\ge 1}$ for supercell matrices, and a numerical tolerance $\\varepsilon$ in nanometers, searches for integer matrices $S_1,S_2 \\in \\mathbb{Z}^{2 \\times 2}$ with $0 lt; \\det S_i \\le D_{\\max}$ and all entries bounded in absolute value by $E_{\\max}$ such that\n$$\nA_1 S_1 = R(\\theta) A_2 S_2\n$$\nholds to within the given tolerance $\\varepsilon$ in the Frobenius norm. If such a pair exists, report the smallest common supercell area\n$$\n\\mathcal{A}_{\\min} = |\\det(A_1)| \\, \\det(S_1) = |\\det(R(\\theta) A_2)| \\, \\det(S_2) = |\\det(A_2)| \\, \\det(S_2)\n$$\nin square nanometers, and the corresponding determinants $\\det(S_1)$ and $\\det(S_2)$. If no such pair is found within the bounds, report that the interface is not commensurate under the search constraints.\n\nAlgorithmic constraints:\n- Angles must be treated in radians.\n- Areas must be expressed in square nanometers and rounded to $6$ decimal places.\n- Use the equivalence that $A_1 S_1 = R(\\theta) A_2 S_2$ if and only if $S_1 = A_1^{-1} R(\\theta) A_2 S_2$ is an integer matrix, to design an efficient search that avoids a double enumeration when possible.\n\nTest suite:\nImplement your program to solve the following independent test cases, each specified by a tuple $(A_1, A_2, \\theta, D_{\\max}, E_{\\max}, \\varepsilon)$, where $A_1$ and $A_2$ are given by their column vectors in nanometers.\n\n- Case $1$ (square lattices with a known commensurate twist):\n  - $A_1 = \\begin{bmatrix} 0.3 amp; 0 \\\\ 0 amp; 0.3 \\end{bmatrix}$, $A_2 = \\begin{bmatrix} 0.3 amp; 0 \\\\ 0 amp; 0.3 \\end{bmatrix}$,\n  - $\\theta = 0.927295218$ radians,\n  - $D_{\\max} = 10$, $E_{\\max} = 3$, $\\varepsilon = 1\\times 10^{-8}$ nanometers.\n\n- Case $2$ (axis-aligned rectangular lattices, zero misorientation, rational metric ratio):\n  - $A_1 = \\begin{bmatrix} 0.2 amp; 0 \\\\ 0 amp; 0.3 \\end{bmatrix}$, $A_2 = \\begin{bmatrix} 0.1 amp; 0 \\\\ 0 amp; 0.15 \\end{bmatrix}$,\n  - $\\theta = 0.0$ radians,\n  - $D_{\\max} = 5$, $E_{\\max} = 3$, $\\varepsilon = 1\\times 10^{-8}$ nanometers.\n\n- Case $3$ (square lattices with an incommensurate twist under the given bounds):\n  - $A_1 = \\begin{bmatrix} 0.3 amp; 0 \\\\ 0 amp; 0.3 \\end{bmatrix}$, $A_2 = \\begin{bmatrix} 0.3 amp; 0 \\\\ 0 amp; 0.3 \\end{bmatrix}$,\n  - $\\theta = 0.5$ radians,\n  - $D_{\\max} = 6$, $E_{\\max} = 3$, $\\varepsilon = 1\\times 10^{-8}$ nanometers.\n\nRequired program output format:\n- For each case, output a list $[\\text{is\\_commensurate}, \\det(S_1), \\det(S_2), \\mathcal{A}_{\\min}]$, where $\\text{is\\_commensurate}$ is a boolean, $\\det(S_1)$ and $\\det(S_2)$ are integers, and $\\mathcal{A}_{\\min}$ is a float in square nanometers rounded to $6$ decimal places. If no commensurate pair is found within the bounds, output $[\\text{False}, 0, 0, 0.0]$ for that case.\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets, for example, $[[\\cdots],[\\cdots],[\\cdots]]$.", "solution": "The problem requires a derivation of the condition for commensurability between two lattices and an algorithm to find the smallest common supercell under given constraints. I will address each part in sequence.\n\nFirst, let us validate the problem statement. The problem is well-defined, scientifically grounded in the theory of crystalline interfaces (specifically, the Coincidence Site Lattice model), and all parameters and constraints are provided. The problem is valid.\n\n**Part 1: Derivation of Commensurability Condition**\n\nThe task is to derive necessary and sufficient conditions for a commensurate interface between two two-dimensional Bravais lattices, $\\Lambda_1$ and $\\Lambda_2$. The lattice $\\Lambda_1$ is generated by the basis matrix $A_1 \\in \\mathbb{R}^{2 \\times 2}$, and the second lattice, $\\Lambda_2'$, is generated by rotating the basis of $\\Lambda_2$ by an angle $\\theta$. The basis matrix for $\\Lambda_2'$ is thus $R(\\theta) A_2$.\n\n$1$. **Definition of Commensurability**: Two lattices $\\Lambda(B_1)$ and $\\Lambda(B_2)$ are defined as commensurate if their intersection, $\\Lambda(B_1) \\cap \\Lambda(B_2)$, is itself a lattice. This intersection lattice is known as the Coincidence Site Lattice (CSL). For our problem, the lattices are $\\Lambda_1 = \\Lambda(A_1)$ and $\\Lambda_2' = \\Lambda(R(\\theta)A_2)$.\n\n$2$. **The CSL as a Superlattice**: If the CSL, let's call it $\\Lambda_C$, exists, then any lattice vector in $\\Lambda_C$ must be a vector in both $\\Lambda_1$ and $\\Lambda_2'$. This implies that $\\Lambda_C$ is a sublattice of both parent lattices: $\\Lambda_C \\subseteq \\Lambda_1$ and $\\Lambda_C \\subseteq \\Lambda_2'$. From the problem definition, a sublattice can be described by a supercell of the parent lattice.\n\n$3$. **Mathematical Formulation**: This means there must exist integer matrices $S_1 \\in \\mathbb{Z}^{2 \\times 2}$ and $S_2 \\in \\mathbb{Z}^{2 \\times 2}$, both with positive determinants, that define the common superlattice $\\Lambda_C$. The basis matrix for $\\Lambda_C$ can be written as $C = A_1 S_1$ and also as $C' = R(\\theta) A_2 S_2$.\n\n$4$. **Basis Vector Relation**: For the matrices $A_1 S_1$ and $R(\\theta) A_2 S_2$ to generate the same lattice $\\Lambda_C$, their basis vectors must be mutually expressible as integer linear combinations of each other. This is equivalent to them being related by a unimodular integer matrix $U \\in \\mathbb{Z}^{2 \\times 2}$, where $\\det(U) = \\pm 1$. The matrix $U$ represents a change of basis for the integer vectors defining the CSL.\n$$\nA_1 S_1 = (R(\\theta) A_2 S_2) U\n$$\n\n$5$. **Simplification**: The search for a commensurate structure can be simplified. A new supercell matrix for the second lattice can be defined as $S_2' = S_2 U$. Since $S_2$ and $U$ are integer matrices, $S_2'$ is also an integer matrix. We require $\\det(S_2')  0$. We have $\\det(S_2') = \\det(S_2)\\det(U)$. If $\\det(U)=-1$, we can always flip the sign of one column of $S_2'$ to make its determinant positive, which corresponds to choosing a different but valid basis for the same superlattice. Thus, without loss of generality, we can absorb $U$ into $S_2$ and seek solutions to the simpler equation:\n$$\nA_1 S_1 = R(\\theta) A_2 S_2\n$$\n\n$6$. **Derivation of the Algebraic Condition**: The basis matrices $A_1$ and $A_2$ must be invertible, as their columns are linearly independent basis vectors. We can therefore left-multiply the equation by $A_1^{-1}$:\n$$\nS_1 = A_1^{-1} R(\\theta) A_2 S_2\n$$\nLet us define the transformation matrix $T \\in \\mathbb{R}^{2 \\times 2}$ as $T = A_1^{-1} R(\\theta) A_2$. The condition becomes:\n$$\nS_1 = T S_2\n$$\n\n$7$. **Necessary and Sufficient Condition**: This equation provides the necessary and sufficient condition for commensurability. A commensurate interface exists if and only if there are integer matrices $S_1, S_2 \\in \\mathbb{Z}^{2 \\times 2}$ with positive determinants that satisfy this relationship. This means there must exist an integer matrix $S_2$ (with $\\det S_2  0$) such that the product $T S_2$ results in a matrix $S_1$ whose entries are all integers and whose determinant, $\\det S_1$, is also positive.\n\nFrom this relationship, we can also relate the determinants of the supercell matrices. Using the property $\\det(AB) = \\det(A)\\det(B)$:\n$$\n\\det(S_1) = \\det(T) \\det(S_2) = \\det(A_1^{-1} R(\\theta) A_2) \\det(S_2)\n$$\nSince $\\det(R(\\theta)) = \\cos^2\\theta - (-\\sin\\theta)(\\sin\\theta) = 1$, this simplifies to:\n$$\n\\det(S_1) = \\frac{\\det(A_2)}{\\det(A_1)} \\det(S_2)\n$$\nThe area of the common supercell, $\\mathcal{A}$, is given by $\\mathcal{A} = |\\det(A_1 S_1)| = |\\det(A_1)| \\det(S_1)$. Substituting the relation for $\\det(S_1)$, we verify consistency:\n$$\n\\mathcal{A} = |\\det(A_1)| \\frac{|\\det(A_2)|}{|\\det(A_1)|} \\det(S_2) = |\\det(A_2)| \\det(S_2)\n$$\nThis confirms that the areas calculated from either lattice basis are identical.\n\n**Part 2: Algorithmic Implementation**\n\nThe task is to implement an algorithm to find the integer matrices $S_1$ and $S_2$ that satisfy the commensurability condition within specified bounds and yield the minimum supercell area.\n\n$1$. **Strategy**: Based on the derived condition $S_1 = T S_2$, an efficient search strategy is to iterate through all possible integer matrices $S_2$ that satisfy the given constraints, calculate the corresponding candidate matrix for $S_1$, and check if it also satisfies its constraints. This avoids a computationally expensive double enumeration over all possible pairs of $(S_1, S_2)$.\n\n$2$. **Search Space**: The search is performed over all $2 \\times 2$ integer matrices $S_2 = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ where the entries $a,b,c,d$ are bounded by $|entry| \\le E_{\\max}$.\n\n$3$. **Algorithm Steps**:\n   a. For a given test case $(A_1, A_2, \\theta, D_{\\max}, E_{\\max}, \\varepsilon)$, first compute the constant matrices: the rotation matrix $R(\\theta) = \\begin{bmatrix}\\cos \\theta  -\\sin \\theta \\\\ \\sin \\theta  \\cos \\theta \\end{bmatrix}$ and the transformation matrix $T = A_1^{-1} R(\\theta) A_2$.\n   b. Initialize an empty list to store all valid solutions found. A solution is a tuple containing the supercell area and the determinants of $S_1$ and $S_2$.\n   c. Iterate through all integers $a, b, c, d$ in the range $[-E_{\\max}, E_{\\max}]$. For each combination, form the matrix $S_2$.\n   d. For each $S_2$, check if its determinant, $\\det(S_2) = ad-bc$, is within the allowed range $0  \\det(S_2) \\le D_{\\max}$.\n   e. If $S_2$ is a valid candidate, calculate the corresponding real-valued matrix $S_{1,cand} = T S_2$.\n   f. Round the entries of $S_{1,cand}$ to the nearest integers to obtain the integer matrix candidate $S_1$.\n   g. Check if this $S_1$ matrix is a valid candidate by verifying its own constraints: its entries must be bounded, $|(S_1)_{ij}| \\le E_{\\max}$, and its determinant must be in the range $0  \\det(S_1) \\le D_{\\max}$.\n   h. If both $S_1$ and $S_2$ are valid candidates, check if they form a commensurate pair to within the specified numerical tolerance $\\varepsilon$. This is done by computing the Frobenius norm of the residual matrix: $\\|A_1 S_1 - R(\\theta) A_2 S_2\\|_F \\le \\varepsilon$.\n   i. If the pair $(S_1, S_2)$ satisfies all conditions, calculate the common supercell area $\\mathcal{A} = |\\det(A_1)| \\det(S_1)$ and add the tuple $(\\mathcal{A}, \\det(S_1), \\det(S_2))$ to the list of solutions.\n   j. After exhausting the search space for $S_2$, check if any solutions were found. If the list of solutions is empty, no commensurate interface exists under the given constraints.\n   k. If solutions were found, sort them by area in ascending order and select the first one, which corresponds to the minimum area $\\mathcal{A}_{\\min}$. Report the results as specified.\n\nBy a brute-force search over the finite space of allowed $S_2$ matrices and collecting all valid solutions, we can reliably find the one with the minimal area. This method is robust and directly implements the derived conditions.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the given test cases for commensurate interfaces.\n    \"\"\"\n\n    def solve_case(A1, A2, theta, D_max, E_max, epsilon):\n        \"\"\"\n        Solves a single test case for finding a commensurate supercell.\n\n        Args:\n            A1 (list): Basis matrix for the first lattice.\n            A2 (list): Basis matrix for the second lattice.\n            theta (float): Rotation angle in radians.\n            D_max (int): Maximum determinant for supercell matrices.\n            E_max (int): Maximum absolute value for entries of supercell matrices.\n            epsilon (float): Numerical tolerance for the Frobenius norm.\n\n        Returns:\n            list: A list representing the result for the case.\n                  [is_commensurate, det(S1), det(S2), min_area]\n        \"\"\"\n        # Convert inputs to numpy arrays\n        A1_np = np.array(A1, dtype=float)\n        A2_np = np.array(A2, dtype=float)\n\n        # 1. Pre-computation\n        # Rotation matrix\n        c, s = np.cos(theta), np.sin(theta)\n        R = np.array([[c, -s], [s, c]])\n\n        # Transformation matrix T = A1_inv * R * A2\n        try:\n            A1_inv = np.linalg.inv(A1_np)\n        except np.linalg.LinAlgError:\n            # A1 is singular and does not define a lattice.\n            return [False, 0, 0, 0.0]\n        \n        T = A1_inv @ R @ A2_np\n        detA1_abs = np.abs(np.linalg.det(A1_np))\n\n        # 2. Collect all valid solutions\n        solutions = []\n        s_entries = range(-E_max, E_max + 1)\n\n        # Generate and test all candidate matrices S2\n        for a in s_entries:\n            for b in s_entries:\n                for c_val in s_entries:\n                    for d in s_entries:\n                        S2 = np.array([[a, b], [c_val, d]], dtype=int)\n                        detS2 = a * d - b * c_val\n\n                        # Check determinant constraint for S2\n                        if not (0  detS2 = D_max):\n                            continue\n\n                        # Calculate candidate S1 and round to nearest integer matrix\n                        S1_cand = T @ S2\n                        S1 = np.round(S1_cand).astype(int)\n\n                        # Check entry-wise bound for S1\n                        if not np.all(np.abs(S1) = E_max):\n                            continue\n                            \n                        detS1 = S1[0, 0] * S1[1, 1] - S1[0, 1] * S1[1, 0]\n\n                        # Check determinant constraint for S1\n                        if not (0  detS1 = D_max):\n                            continue\n\n                        # Check commensurability condition with tolerance\n                        error = np.linalg.norm(A1_np @ S1 - R @ A2_np @ S2, 'fro')\n                        \n                        if error = epsilon:\n                            area = detA1_abs * detS1\n                            solutions.append((area, int(detS1), int(detS2)))\n\n        # 3. Find the best solution (minimum area)\n        if not solutions:\n            return [False, 0, 0, 0.0]\n        \n        # Sort solutions by area (first element of tuple)\n        solutions.sort(key=lambda x: x[0])\n        \n        best_area, best_detS1, best_detS2 = solutions[0]\n        \n        return [True, best_detS1, best_detS2, round(best_area, 6)]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {\n            \"A1\": [[0.3, 0.0], [0.0, 0.3]],\n            \"A2\": [[0.3, 0.0], [0.0, 0.3]],\n            \"theta\": 0.927295218,\n            \"D_max\": 10,\n            \"E_max\": 3,\n            \"epsilon\": 1e-8,\n        },\n        # Case 2\n        {\n            \"A1\": [[0.2, 0.0], [0.0, 0.3]],\n            \"A2\": [[0.1, 0.0], [0.0, 0.15]],\n            \"theta\": 0.0,\n            \"D_max\": 5,\n            \"E_max\": 3,\n            \"epsilon\": 1e-8,\n        },\n        # Case 3\n        {\n            \"A1\": [[0.3, 0.0], [0.0, 0.3]],\n            \"A2\": [[0.3, 0.0], [0.0, 0.3]],\n            \"theta\": 0.5,\n            \"D_max\": 6,\n            \"E_max\": 3,\n            \"epsilon\": 1e-8,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(\n            case[\"A1\"], case[\"A2\"], case[\"theta\"],\n            case[\"D_max\"], case[\"E_max\"], case[\"epsilon\"]\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2767838"}]}