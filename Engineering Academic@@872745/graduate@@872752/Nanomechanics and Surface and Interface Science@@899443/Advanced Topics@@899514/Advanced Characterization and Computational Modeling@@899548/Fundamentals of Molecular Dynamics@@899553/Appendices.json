{"hands_on_practices": [{"introduction": "Mastering molecular dynamics begins with verifying the stability and correctness of your simulation engine. The microcanonical ($NVE$) ensemble, where the number of particles ($N$), volume ($V$), and total energy ($E$) are conserved, serves as the ultimate testbed for the core integration algorithm. This exercise challenges you to diagnose a common and critical artifact—energy drift—which points to a fundamental error in the numerical integration parameters and is the first check any practitioner should perform. [@problem_id:2059342]", "problem": "An undergraduate researcher is setting up their first molecular dynamics (MD) simulation to study the folding of a small peptide in a vacuum. To ensure that the fundamental laws of physics are respected, they choose to run the simulation in the microcanonical (NVE) ensemble, where the number of particles (N), the system volume (V), and the total energy (E) should be conserved. After launching the simulation, they monitor the system's properties. They plot the total energy of the peptide as a function of time and observe a slow but persistent upward drift over the entire simulation run. This indicates that energy is not being conserved, which is an unphysical artifact.\n\nBased on the principles of MD simulations, which of the following is the most likely numerical issue causing this systematic increase in total energy?\n\nA. The simulation box size was chosen to be too large.\n\nB. The initial velocities assigned to the atoms correspond to a temperature much higher than the desired target.\n\nC. The integration timestep for propagating the atoms' positions and velocities is too large.\n\nD. The force field being used inaccurately describes the bond-stretching potentials.\n\nE. The frequency of writing coordinates to the output file is too low.", "solution": "The core of the problem lies in understanding the artifacts that can arise in a molecular dynamics simulation, specifically within the context of the microcanonical (NVE) ensemble. By definition, the NVE ensemble must conserve the total energy of the system, which is the sum of the kinetic energy ($K$) and the potential energy ($U$). If the total energy ($E = K + U$) is observed to drift, it points to a flaw in the numerical implementation of the simulation, as the underlying physics (Newton's laws of motion) is perfectly energy-conserving.\n\nLet's analyze the options provided:\n\nA. A simulation box size that is too large would mean the peptide is simulated in a vast vacuum. This is computationally inefficient but does not violate any physical laws or introduce numerical instability that would cause energy not to be conserved. It would simply mean the peptide rarely interacts with its periodic images (or not at all if periodic boundary conditions are disabled). Therefore, this is an incorrect choice.\n\nB. Starting the simulation with initial velocities corresponding to a very high temperature simply means the system begins with a high total energy. In a correctly-functioning NVE simulation, the total energy should then remain constant (with small fluctuations) around this high initial value. It does not explain a persistent, systematic *increase* in energy over time. Therefore, this is an incorrect choice.\n\nC. The integration timestep is a critical parameter in MD simulations. Newton's equations of motion, $F=ma$, are continuous differential equations. A simulation solves them numerically by discretizing time into small steps, $\\Delta t$. Algorithms like the Verlet or Leapfrog integrators assume that the forces acting on the atoms are constant over this small timestep. However, forces change as atoms move. If $\\Delta t$ is too large, atoms can move a significant distance in a single step, entering regions of much higher potential energy (e.g., steric clashes). The numerical integrator, based on the forces from the *beginning* of the step, can fail to accurately capture the true trajectory. This inaccuracy often leads to a systematic overestimation of particle velocities in the next step, causing a net increase in kinetic energy that is not compensated by a corresponding decrease in potential energy. This is a well-known numerical artifact that breaks the energy conservation of the NVE ensemble, leading to a characteristic upward drift in total energy. This is the most probable cause.\n\nD. An inaccurate force field, such as one with poor parameters for bond stretching, means that the potential energy landscape of the simulated molecule does not match the real molecule. While this will lead to physically incorrect dynamics, it does not inherently violate the principle of energy conservation for the *model* system being simulated. The simulation would still conserve the total energy of this flawed model, provided the numerical integration is stable. Therefore, this is an incorrect choice.\n\nE. The frequency of writing coordinates to an output file is purely a data-logging parameter. It determines how many \"snapshots\" of the simulation are saved for later analysis. Saving data less frequently has no effect on the underlying physics or the integration algorithm that is running at every single timestep. The simulation continues to evolve according to the integrator, irrespective of how often its state is recorded. Therefore, this choice is incorrect.\n\nConclusion: The most common and direct cause of a systematic upward drift in total energy during an NVE simulation is choosing an integration timestep that is too large for the system's fastest motions (typically bond vibrations), leading to numerical instability in the integration algorithm.", "answer": "$$\\boxed{C}$$", "id": "2059342"}, {"introduction": "Practical MD simulations must balance physical accuracy with computational feasibility, a trade-off that often involves truncating intermolecular potentials at a finite cutoff distance $r_c$. This compromise, however, introduces systematic errors in calculated thermodynamic properties like energy and pressure. This practice guides you through a first-principles derivation of the 'tail corrections,' an essential technique used to analytically account for the neglected long-range interactions and bridge the gap between the truncated simulation and the full physical system. [@problem_id:2771807]", "problem": "Consider a homogeneous, isotropic fluid of number density $\\rho$ whose atoms interact via the Lennard–Jones pair potential $u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$. In a Molecular Dynamics (MD) simulation, suppose the potential is truncated (but not shifted) at a finite cutoff $r_{c}$, that is, interactions for $rr_{c}$ are neglected. Assume that for separations beyond the cutoff the radial distribution function satisfies $g(r)=1$ for $r\\ge r_{c}$. \n\nStarting from first principles appropriate to classical statistical mechanics and nanomechanics—namely, (i) the definition of the configurational potential energy as a sum over pair interactions and its continuum representation for a homogeneous fluid, and (ii) the mechanical (Clausius) virial expression for the pressure—derive closed-form expressions for the long-range tail corrections that must be added to the truncated system to estimate the full, untruncated values:\n- the missing configurational potential energy per particle $\\Delta U/N$ due to neglecting $rr_{c}$,\n- the missing configurational (virial) contribution to the pressure $\\Delta p$ due to neglecting $rr_{c}$.\n\nExpress your final answers symbolically in terms of $\\rho$, $\\epsilon$, $\\sigma$, and $r_{c}$ only. Provide both results as a single row vector $\\left[\\Delta U/N,\\ \\Delta p\\right]$. Do not include units in your final boxed answer.", "solution": "The derivation proceeds from the fundamental principles of classical statistical mechanics as requested.\n\nFirst, we derive the tail correction for the configurational potential energy per particle, $\\Delta U/N$.\nThe total configurational potential energy $U$ for a system of $N$ particles in a volume $V$ with number density $\\rho = N/V$ can be expressed as an integral over the pair potential $u(r)$ weighted by the radial distribution function $g(r)$:\n$$U = \\frac{N}{2} \\int_{V} \\rho g(r) u(r) d\\mathbf{r} = \\frac{N\\rho}{2} \\int_0^\\infty u(r) g(r) 4\\pi r^2 dr$$\nThe potential energy per particle is therefore:\n$$\\frac{U}{N} = 2\\pi\\rho \\int_0^\\infty u(r) g(r) r^2 dr$$\nIn a simulation with a potential cutoff at $r_c$, the calculated energy $U_{trunc}$ only includes interactions for $r \\le r_c$. The tail correction, $\\Delta U$, is the contribution from interactions for $r  r_c$:\n$$\\frac{\\Delta U}{N} = 2\\pi\\rho \\int_{r_c}^\\infty u(r) g(r) r^2 dr$$\nUsing the provided assumption that $g(r)=1$ for $r \\ge r_c$, this simplifies to:\n$$\\frac{\\Delta U}{N} = 2\\pi\\rho \\int_{r_c}^\\infty u(r) r^2 dr$$\nWe now substitute the Lennard-Jones potential, $u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$:\n$$\\frac{\\Delta U}{N} = 2\\pi\\rho \\int_{r_c}^\\infty 4\\epsilon\\left[\\sigma^{12}r^{-12} - \\sigma^6 r^{-6}\\right] r^2 dr$$\n$$\\frac{\\Delta U}{N} = 8\\pi\\rho\\epsilon \\int_{r_c}^\\infty \\left( \\sigma^{12}r^{-10} - \\sigma^6 r^{-4} \\right) dr$$\nPerforming the integration:\n$$\\frac{\\Delta U}{N} = 8\\pi\\rho\\epsilon \\left[ \\sigma^{12}\\frac{r^{-9}}{-9} - \\sigma^6 \\frac{r^{-3}}{-3} \\right]_{r_c}^\\infty$$\n$$\\frac{\\Delta U}{N} = 8\\pi\\rho\\epsilon \\left[ \\left( \\lim_{r\\to\\infty} \\left( -\\frac{\\sigma^{12}}{9r^9} + \\frac{\\sigma^6}{3r^3} \\right) \\right) - \\left( -\\frac{\\sigma^{12}}{9r_c^9} + \\frac{\\sigma^6}{3r_c^3} \\right) \\right]$$\n$$\\frac{\\Delta U}{N} = 8\\pi\\rho\\epsilon \\left[ 0 - \\left( -\\frac{\\sigma^{12}}{9r_c^9} + \\frac{\\sigma^6}{3r_c^3} \\right) \\right]$$\n$$\\frac{\\Delta U}{N} = 8\\pi\\rho\\epsilon \\left( \\frac{\\sigma^{12}}{9r_c^9} - \\frac{\\sigma^6}{3r_c^3} \\right)$$\nFor clarity, we can factor this expression:\n$$\\frac{\\Delta U}{N} = \\frac{8\\pi\\rho\\epsilon\\sigma^3}{3} \\left[ \\frac{1}{3}\\left(\\frac{\\sigma}{r_c}\\right)^9 - \\left(\\frac{\\sigma}{r_c}\\right)^3 \\right]$$\n\nSecond, we derive the tail correction for the pressure, $\\Delta p$.\nThe pressure $p$ is given by the virial theorem: $p = \\rho k_B T + p_{conf}$, where $k_B T$ is the kinetic contribution and $p_{conf}$ is the configurational contribution from intermolecular forces. The configurational term is derived from the Clausius virial, $W = -\\frac{1}{2} \\sum_{i \\neq j} r_{ij} \\frac{du(r_{ij})}{dr_{ij}}$:\n$$p_{conf} = \\frac{\\langle W \\rangle}{3V} = -\\frac{1}{6V} \\left\\langle \\sum_{i \\neq j} r_{ij} \\frac{du(r_{ij})}{dr_{ij}} \\right\\rangle$$\nIn the continuum limit for a homogeneous fluid, this becomes:\n$$p_{conf} = -\\frac{\\rho^2}{6} \\int_0^\\infty r \\frac{du(r)}{dr} g(r) 4\\pi r^2 dr = -\\frac{2\\pi\\rho^2}{3} \\int_0^\\infty r^3 \\frac{du(r)}{dr} g(r) dr$$\nThe tail correction $\\Delta p$ is the contribution to this integral from distances $r  r_c$. Using again the assumption $g(r)=1$ for $r \\ge r_c$:\n$$\\Delta p = -\\frac{2\\pi\\rho^2}{3} \\int_{r_c}^\\infty r^3 \\frac{du(r)}{dr} dr$$\nWe must first find the derivative of the Lennard-Jones potential:\n$$\\frac{du(r)}{dr} = 4\\epsilon \\frac{d}{dr} \\left( \\sigma^{12}r^{-12} - \\sigma^6 r^{-6} \\right) = 4\\epsilon \\left( -12\\sigma^{12}r^{-13} + 6\\sigma^6 r^{-7} \\right)$$\nSubstituting this into the integral for $\\Delta p$:\n$$\\Delta p = -\\frac{2\\pi\\rho^2}{3} \\int_{r_c}^\\infty r^3 \\cdot 4\\epsilon \\left( -12\\sigma^{12}r^{-13} + 6\\sigma^6 r^{-7} \\right) dr$$\n$$\\Delta p = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\int_{r_c}^\\infty \\left( -12\\sigma^{12}r^{-10} + 6\\sigma^6 r^{-4} \\right) dr$$\nWe perform the integration:\n$$\\Delta p = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ -12\\sigma^{12}\\frac{r^{-9}}{-9} + 6\\sigma^6 \\frac{r^{-3}}{-3} \\right]_{r_c}^\\infty$$\n$$\\Delta p = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ \\frac{4}{3}\\sigma^{12}r^{-9} - 2\\sigma^6 r^{-3} \\right]_{r_c}^\\infty$$\n$$\\Delta p = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ \\left( \\lim_{r\\to\\infty} \\left( \\frac{4\\sigma^{12}}{3r^9} - \\frac{2\\sigma^6}{r^3} \\right) \\right) - \\left( \\frac{4\\sigma^{12}}{3r_c^9} - \\frac{2\\sigma^6}{r_c^3} \\right) \\right]$$\n$$\\Delta p = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ 0 - \\left( \\frac{4\\sigma^{12}}{3r_c^9} - \\frac{2\\sigma^6}{r_c^3} \\right) \\right]$$\n$$\\Delta p = \\frac{8\\pi\\rho^2\\epsilon}{3} \\left( \\frac{4\\sigma^{12}}{3r_c^9} - \\frac{2\\sigma^6}{r_c^3} \\right)$$\nFactoring the expression for clarity:\n$$\\Delta p = \\frac{16\\pi\\rho^2\\epsilon\\sigma^3}{3} \\left[ \\frac{2}{3}\\left(\\frac{\\sigma}{r_c}\\right)^9 - \\left(\\frac{\\sigma}{r_c}\\right)^3 \\right]$$\nThe derived expressions for $\\Delta U/N$ and $\\Delta p$ are the required closed-form tail corrections.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{8\\pi\\rho\\epsilon\\sigma^3}{3} \\left[ \\frac{1}{3}\\left(\\frac{\\sigma}{r_c}\\right)^9 - \\left(\\frac{\\sigma}{r_c}\\right)^3 \\right]  \\frac{16\\pi\\rho^2\\epsilon\\sigma^3}{3} \\left[ \\frac{2}{3}\\left(\\frac{\\sigma}{r_c}\\right)^9 - \\left(\\frac{\\sigma}{r_c}\\right)^3 \\right]\n\\end{pmatrix}\n}\n$$", "id": "2771807"}, {"introduction": "To simulate complex molecules efficiently, it is common to treat them as rigid bodies using holonomic constraints, which 'freezes' high-frequency internal vibrations and permits a larger integration timestep. This powerful technique fundamentally alters the system's dynamics by removing degrees of freedom. This exercise demonstrates the crucial and practical consequence of this choice: the standard formula for kinetic temperature is no longer valid, and one must correctly apply the equipartition theorem to the reduced number of accessible degrees of freedom to obtain a physically meaningful measurement. [@problem_id:2771930]", "problem": "A classical Molecular Dynamics (MD) simulation is performed for a fluid of rigid triatomic molecules confined in a cubic simulation cell with periodic boundary conditions. The system evolves under Newton’s equations subject to holonomic constraints that rigidify each molecule, enforced via Lagrange multipliers. The kinetic temperature is monitored using a kinetic-energy-based instantaneous estimator. Starting from the fundamental definitions of kinetic energy, holonomic constraints, and the equilibrium equipartition theorem, explain how constraints reduce the number of independent quadratic velocity modes that contribute to the kinetic temperature. Then, derive a general expression for the instantaneous kinetic temperature estimator $T$ in terms of the instantaneous total kinetic energy $K$, the Boltzmann constant $k_{B}$, and the number of dynamically accessible independent velocity degrees of freedom after accounting for all constraints and any removed integrals of motion.\n\nNext, apply your result to the following physically realistic case relevant to nanomechanics and surface and interface science: there are $N_{\\mathrm{mol}} = 512$ rigid triatomic molecules (each with $3$ atoms) modeled with three independent holonomic constraints per molecule to enforce rigidity. The total linear momentum of the entire system is constrained to zero. At a particular instant, the total kinetic energy computed from the atomistic velocities is $K = 3.800 \\times 10^{-18}$ J. Use $k_{B} = 1.380649 \\times 10^{-23}$ J/K. Compute the instantaneous kinetic temperature $T$ that correctly accounts for the removed degrees of freedom due to both molecular rigidity and the zero–total–linear–momentum condition. Round your answer to four significant figures and express it in Kelvin.", "solution": "The problem requires an explanation of how constraints affect the calculation of kinetic temperature, a derivation of the general temperature estimator, and its application to a specific system.\n\nFirst, we address the conceptual foundation. The total instantaneous kinetic energy $K$ of a system composed of $N$ atoms, each with mass $m_i$ and velocity $\\mathbf{v}_i$, is defined as the sum of the kinetic energies of all atoms:\n$$K = \\sum_{i=1}^{N} \\frac{1}{2} m_i |\\mathbf{v}_i|^2 = \\sum_{i=1}^{N} \\sum_{\\alpha \\in \\{x,y,z\\}} \\frac{1}{2} m_i v_{i\\alpha}^2$$\nThis expression is a sum over $3N$ quadratic terms in the Cartesian velocity components. In the absence of constraints, these $3N$ velocity components would be independent.\n\nHolonomic constraints are equations that restrict the spatial coordinates of the particles, of the form $f_k(\\mathbf{r}_1, \\mathbf{r}_2, \\ldots, \\mathbf{r}_N) = 0$. For these constraints to be maintained throughout the dynamics, their time derivatives must be zero. For time-independent constraints, as is the case for molecular rigidity, this implies:\n$$\\frac{df_k}{dt} = \\sum_{i=1}^{N} \\frac{\\partial f_k}{\\partial \\mathbf{r}_i} \\cdot \\mathbf{v}_i = 0$$\nEach such equation imposes a linear dependency among the atomic velocities, meaning they are no longer independent. Each independent holonomic constraint effectively removes one degree of freedom from the system. The number of independent coordinates needed to specify the system's configuration is thus reduced.\n\nThe equipartition theorem of classical statistical mechanics states that, for a system in thermal equilibrium at an absolute temperature $T$, the average energy associated with each independent quadratic term in the Hamiltonian is equal to $\\frac{1}{2} k_B T$, where $k_B$ is the Boltzmann constant. The kinetic energy is composed of such terms. Because constraints reduce the number of independent velocity components, they also reduce the number of independent quadratic terms that contribute to the total kinetic energy. The total number of these independent kinetic degrees of freedom, denoted $N_{dof}$, is the count of all possible velocity components minus the number of independent constraints acting on them.\n\nThe average total kinetic energy $\\langle K \\rangle$ is therefore related to the temperature by:\n$$\\langle K \\rangle = \\frac{1}{2} N_{dof} k_B T$$\nIn molecular dynamics simulations, an instantaneous kinetic temperature is defined by assuming this relationship holds for the instantaneous kinetic energy $K$:\n$$K = \\frac{1}{2} N_{dof} k_B T$$\nRearranging this equation provides the general expression for the instantaneous kinetic temperature estimator $T$ in terms of the total kinetic energy $K$, the Boltzmann constant $k_B$, and the number of dynamically accessible independent velocity degrees of freedom, $N_{dof}$:\n$$T = \\frac{2K}{N_{dof} k_B}$$\nThe critical step is to correctly determine $N_{dof}$ by accounting for all constraints.\n\nNow, we apply this formula to the specified case. The system consists of $N_{\\mathrm{mol}} = 512$ rigid triatomic molecules.\nThe total number of atoms in the system is $N = N_{\\mathrm{mol}} \\times 3 = 512 \\times 3 = 1536$.\nWithout any constraints, the system would have $3N = 3 \\times 1536 = 4608$ total degrees of freedom, corresponding to the $3$ Cartesian coordinates of each atom.\n\nWe must subtract the degrees of freedom removed by constraints.\n$1$. **Molecular Rigidity Constraints:** Each triatomic molecule is made rigid by $3$ holonomic constraints. A single non-linear triatomic molecule possesses $3$ translational and $3$ rotational degrees of freedom, for a total of $6$. The unconstrained system of $3$ atoms has $3 \\times 3 = 9$ degrees of freedom. Thus, enforcing rigidity removes $9 - 6 = 3$ internal vibrational degrees of freedom per molecule. This matches the problem statement. The total number of degrees of freedom removed by these rigidity constraints is $N_{c, \\text{rigid}} = N_{\\mathrm{mol}} \\times 3 = 512 \\times 3 = 1536$.\n\n$2$. **Total Linear Momentum Constraint:** The total linear momentum of the system is constrained to be zero: $\\mathbf{P} = \\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$. This single vector equation corresponds to three independent scalar constraints, one for each Cartesian direction ($P_x=0$, $P_y=0$, $P_z=0$). These constraints remove the $3$ degrees of freedom associated with the translational motion of the entire system's center of mass. So, $N_{c, \\text{momentum}} = 3$.\n\nThe total number of independent velocity degrees of freedom, $N_{dof}$, is calculated by subtracting all constrained degrees of freedom from the initial total:\n$$N_{dof} = 3N - N_{c, \\text{rigid}} - N_{c, \\text{momentum}} = 4608 - 1536 - 3 = 3069$$\n\nNow, we can compute the instantaneous temperature using the given values:\nTotal kinetic energy $K = 3.800 \\times 10^{-18} \\, \\text{J}$.\nBoltzmann constant $k_{B} = 1.380649 \\times 10^{-23} \\, \\text{J/K}$.\n\n$$T = \\frac{2K}{N_{dof} k_B} = \\frac{2 \\times (3.800 \\times 10^{-18})}{(3069) \\times (1.380649 \\times 10^{-23})}$$\n$$T = \\frac{7.600 \\times 10^{-18}}{4.237303181 \\times 10^{-20}} \\, \\text{K}$$\n$$T \\approx 179.3616 \\, \\text{K}$$\nRounding the result to four significant figures as requested gives $T = 179.4 \\, \\text{K}$.", "answer": "$$\\boxed{179.4}$$", "id": "2771930"}]}