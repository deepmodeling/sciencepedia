{"hands_on_practices": [{"introduction": "This first exercise is a foundational rite of passage into the B-bar method. You will compute the constant-averaged volumetric strain-displacement operator, $\\bar{\\boldsymbol{B}}_{\\text{vol}}$, for a simple case: a square, four-node quadrilateral (Q4) element. This direct calculation demystifies the \"averaging\" process by connecting the abstract definition to a concrete, verifiable result derived from first principles.", "problem": "Consider a four-node bilinear quadrilateral (Q4) finite element in two-dimensional plane strain. Let the physical element occupy the unit square with vertices at $(0,0)$, $(1,0)$, $(1,1)$, $(0,1)$ in the physical coordinates $(x,y)$. The isoparametric parent coordinates are $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$, and the mapping to the physical element is affine, given by $x=\\tfrac{1}{2}(1+\\xi)$ and $y=\\tfrac{1}{2}(1+\\eta)$. The nodal displacement vector for the element is ordered as\n$$\n\\boldsymbol{d}_e=\\begin{bmatrix}u_{1x} & u_{1y} & u_{2x} & u_{2y} & u_{3x} & u_{3y} & u_{4x} & u_{4y}\\end{bmatrix}^{\\mathsf{T}}.\n$$\nIn plane strain, the volumetric strain at a point is defined as the trace of the infinitesimal strain tensor, $ \\epsilon_v=\\epsilon_{xx}+\\epsilon_{yy}$. The associated volumetric strain-displacement operator row is $ \\boldsymbol{B}_{\\text{vol}}(x,y)$ such that $ \\epsilon_v(x,y)=\\boldsymbol{B}_{\\text{vol}}(x,y)\\,\\boldsymbol{d}_e$. For a Q4 element,\n$$\n\\boldsymbol{B}_{\\text{vol}}(x,y)=\\begin{bmatrix}N_{1,x} & N_{1,y} & N_{2,x} & N_{2,y} & N_{3,x} & N_{3,y} & N_{4,x} & N_{4,y}\\end{bmatrix},\n$$\nwhere $N_i(\\xi,\\eta)$ are the standard bilinear shape functions and subscripts $x,y$ denote partial derivatives with respect to the physical coordinates. The $B$-bar method replaces $\\boldsymbol{B}_{\\text{vol}}(x,y)$ by its element-wise average\n$$\n\\bar{\\boldsymbol{B}}_{\\text{vol}}=\\frac{1}{A_e}\\int_{\\Omega_e}\\boldsymbol{B}_{\\text{vol}}(x,y)\\,\\mathrm{d}\\Omega,\n$$\nwhere $A_e$ is the element area and $\\Omega_e$ its domain.\n\nStarting from these definitions and using only the mapping, the standard bilinear shape functions on $[-1,1]^2$, and the change of variables formula for integrals, derive a closed-form expression for the averaged volumetric operator row $\\bar{\\boldsymbol{B}}_{\\text{vol}}$ for this unit-square element. Show explicitly from your derivation why the result is constant over the element. Express your final result as a $1\\times 8$ row matrix in exact rational numbers, ordered as $\\begin{bmatrix}N_{1,x} & N_{1,y} & N_{2,x} & N_{2,y} & N_{3,x} & N_{3,y} & N_{4,x} & N_{4,y}\\end{bmatrix}$. No rounding is required and no physical units are needed.", "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It constitutes a standard exercise in the theory of the finite element method. All provided information is consistent and sufficient for deriving a unique, verifiable solution. We shall therefore proceed with the derivation.\n\nThe objective is to compute the averaged volumetric strain-displacement operator, $\\bar{\\boldsymbol{B}}_{\\text{vol}}$, for a specific four-node bilinear quadrilateral (Q$4$) element. This operator is defined as the element-wise average of the local operator $\\boldsymbol{B}_{\\text{vol}}(x,y)$:\n$$\n\\bar{\\boldsymbol{B}}_{\\text{vol}} = \\frac{1}{A_e}\\int_{\\Omega_e}\\boldsymbol{B}_{\\text{vol}}(x,y)\\,\\mathrm{d}\\Omega\n$$\nwhere $A_e$ is the area of the element $\\Omega_e$. The local operator is given as:\n$$\n\\boldsymbol{B}_{\\text{vol}}(x,y) = \\begin{bmatrix} N_{1,x} & N_{1,y} & N_{2,x} & N_{2,y} & N_{3,x} & N_{3,y} & N_{4,x} & N_{4,y} \\end{bmatrix}\n$$\nThe derivation proceeds by first expressing the derivatives of the shape functions with respect to physical coordinates $(x,y)$ in terms of derivatives with respect to parent coordinates $(\\xi,\\eta)$, and then performing the integration over the element domain.\n\nFirst, we define the standard bilinear shape functions $N_i(\\xi, \\eta)$ on the parent domain $[-1,1] \\times [-1,1]$. The node numbering $1,2,3,4$ corresponds to the vertices $(0,0), (1,0), (1,1), (0,1)$ in physical space, which in turn correspond to vertices $(-1,-1), (1,-1), (1,1), (-1,1)$ in parent space. The shape functions are:\n$$\n\\begin{aligned}\nN_1(\\xi, \\eta) &= \\frac{1}{4}(1-\\xi)(1-\\eta) \\\\\nN_2(\\xi, \\eta) &= \\frac{1}{4}(1+\\xi)(1-\\eta) \\\\\nN_3(\\xi, \\eta) &= \\frac{1}{4}(1+\\xi)(1+\\eta) \\\\\nN_4(\\xi, \\eta) &= \\frac{1}{4}(1-\\xi)(1+\\eta)\n\\end{aligned}\n$$\nNext, we compute the derivatives of these shape functions with respect to the parent coordinates $\\xi$ and $\\eta$.\n$$\n\\begin{array}{ll}\nN_{1,\\xi} = -\\frac{1}{4}(1-\\eta), & N_{1,\\eta} = -\\frac{1}{4}(1-\\xi) \\\\\nN_{2,\\xi} = \\frac{1}{4}(1-\\eta), & N_{2,\\eta} = -\\frac{1}{4}(1+\\xi) \\\\\nN_{3,\\xi} = \\frac{1}{4}(1+\\eta), & N_{3,\\eta} = \\frac{1}{4}(1+\\xi) \\\\\nN_{4,\\xi} = -\\frac{1}{4}(1+\\eta), & N_{4,\\eta} = \\frac{1}{4}(1-\\xi)\n\\end{array}\n$$\nTo transform these derivatives into physical coordinates, we require the Jacobian matrix $\\boldsymbol{J}$ of the given mapping: $x=\\frac{1}{2}(1+\\xi)$ and $y=\\frac{1}{2}(1+\\eta)$.\n$$\n\\boldsymbol{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{2} \\end{bmatrix}\n$$\nThe determinant of the Jacobian is $\\det(\\boldsymbol{J}) = (\\frac{1}{2})(\\frac{1}{2}) - (0)(0) = \\frac{1}{4}$. The inverse of the Jacobian is:\n$$\n\\boldsymbol{J}^{-1} = \\frac{1}{\\det(\\boldsymbol{J})} \\begin{bmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{2} \\end{bmatrix} = 4 \\begin{bmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{2} \\end{bmatrix} = \\begin{bmatrix} 2 & 0 \\\\ 0 & 2 \\end{bmatrix}\n$$\nSince the mapping is affine, both $\\boldsymbol{J}$ and $\\boldsymbol{J}^{-1}$ are constant matrices. The chain rule for derivatives states:\n$$\n\\begin{Bmatrix} N_{i,x} \\\\ N_{i,y} \\end{Bmatrix} = \\boldsymbol{J}^{-1} \\begin{Bmatrix} N_{i,\\xi} \\\\ N_{i,\\eta} \\end{Bmatrix} = \\begin{bmatrix} 2 & 0 \\\\ 0 & 2 \\end{bmatrix} \\begin{Bmatrix} N_{i,\\xi} \\\\ N_{i,\\eta} \\end{Bmatrix} = \\begin{Bmatrix} 2 N_{i,\\xi} \\\\ 2 N_{i,\\eta} \\end{Bmatrix}\n$$\nThus, we find the components of $\\boldsymbol{B}_{\\text{vol}}$ as functions of $(\\xi,\\eta)$:\n$$\n\\begin{array}{ll}\nN_{1,x} = 2 N_{1,\\xi} = -\\frac{1}{2}(1-\\eta), & N_{1,y} = 2 N_{1,\\eta} = -\\frac{1}{2}(1-\\xi) \\\\\nN_{2,x} = 2 N_{2,\\xi} = \\frac{1}{2}(1-\\eta), & N_{2,y} = 2 N_{2,\\eta} = -\\frac{1}{2}(1+\\xi) \\\\\nN_{3,x} = 2 N_{3,\\xi} = \\frac{1}{2}(1+\\eta), & N_{3,y} = 2 N_{3,\\eta} = \\frac{1}{2}(1+\\xi) \\\\\nN_{4,x} = 2 N_{4,\\xi} = -\\frac{1}{2}(1+\\eta), & N_{4,y} = 2 N_{4,\\eta} = \\frac{1}{2}(1-\\xi) \\\\\n\\end{array}\n$$\nThe physical element is a unit square, so its area is $A_e = 1$. The integral for $\\bar{\\boldsymbol{B}}_{\\text{vol}}$ is transformed to the parent domain:\n$$\n\\bar{\\boldsymbol{B}}_{\\text{vol}} = \\frac{1}{A_e} \\int_{\\Omega_e} \\boldsymbol{B}_{\\text{vol}} \\, \\mathrm{d}\\Omega = \\frac{1}{1} \\int_{-1}^1 \\int_{-1}^1 \\boldsymbol{B}_{\\text{vol}}(\\xi,\\eta) \\det(\\boldsymbol{J}) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 \\boldsymbol{B}_{\\text{vol}}(\\xi,\\eta) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\nWe evaluate this integral for each component of the operator. For any linear function $f(\\xi,\\eta) = c_0 + c_1\\xi + c_2\\eta$, its integral over the parent domain is:\n$$\n\\int_{-1}^1 \\int_{-1}^1 (c_0 + c_1\\xi + c_2\\eta) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta = 4c_0\n$$\nsince the integrals of the terms linear in $\\xi$ or $\\eta$ are zero. Thus, for each component which is a linear function of $\\xi$ and $\\eta$, we only need its constant term.\n\n- For $N_{1,x} = -\\frac{1}{2}(1-\\eta) = -\\frac{1}{2}+\\frac{1}{2}\\eta$, the constant term is $-\\frac{1}{2}$. The integral is $4(-\\frac{1}{2}) = -2$.\n- For $N_{1,y} = -\\frac{1}{2}(1-\\xi) = -\\frac{1}{2}+\\frac{1}{2}\\xi$, the integral is $4(-\\frac{1}{2}) = -2$.\n- For $N_{2,x} = \\frac{1}{2}(1-\\eta) = \\frac{1}{2}-\\frac{1}{2}\\eta$, the integral is $4(\\frac{1}{2}) = 2$.\n- For $N_{2,y} = -\\frac{1}{2}(1+\\xi) = -\\frac{1}{2}-\\frac{1}{2}\\xi$, the integral is $4(-\\frac{1}{2}) = -2$.\n- For $N_{3,x} = \\frac{1}{2}(1+\\eta) = \\frac{1}{2}+\\frac{1}{2}\\eta$, the integral is $4(\\frac{1}{2}) = 2$.\n- For $N_{3,y} = \\frac{1}{2}(1+\\xi) = \\frac{1}{2}+\\frac{1}{2}\\xi$, the integral is $4(\\frac{1}{2}) = 2$.\n- For $N_{4,x} = -\\frac{1}{2}(1+\\eta) = -\\frac{1}{2}-\\frac{1}{2}\\eta$, the integral is $4(-\\frac{1}{2}) = -2$.\n- For $N_{4,y} = \\frac{1}{2}(1-\\xi) = \\frac{1}{2}-\\frac{1}{2}\\xi$, the integral is $4(\\frac{1}{2}) = 2$.\n\nThe vector of integrated components is $\\begin{bmatrix} -2 & -2 & 2 & -2 & 2 & 2 & -2 & 2 \\end{bmatrix}$. Now we apply the pre-factor $\\frac{1}{4}$:\n$$\n\\bar{\\boldsymbol{B}}_{\\text{vol}} = \\frac{1}{4} \\begin{bmatrix} -2 & -2 & 2 & -2 & 2 & 2 & -2 & 2 \\end{bmatrix}\n$$\nThis yields the final expression for the constant averaged operator row:\n$$\n\\bar{\\boldsymbol{B}}_{\\text{vol}} = \\begin{bmatrix} -\\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} \\end{bmatrix}\n$$\nThe result is constant because $\\bar{\\boldsymbol{B}}_{\\text{vol}}$ is defined as the average value of the spatially varying function $\\boldsymbol{B}_{\\text{vol}}(x,y)$ over the element domain $\\Omega_e$. A definite integral over a fixed domain results in a single value, not a function of the integration variables. The derivation above explicitly calculates this constant vector by performing the definite integration, thereby demonstrating why the result is independent of position within the element.", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{2} & \\frac{1}{2} \\end{pmatrix}}\n$$", "id": "2542562"}, {"introduction": "Having calculated the operator, we now explore one of its most important consequences. This practice examines the infamous \"hourglass\" deformation, a non-physical mode that can plague under-integrated elements. You will demonstrate how a standard formulation can incorrectly assign volumetric strain energy to this mode, and how the B-bar method correctly identifies it as having zero average volume change, thus preventing the spurious stiffening that contributes to locking [@problem_id:2542562].", "problem": "Consider a two-dimensional (2D) isoparametric four-node bilinear quadrilateral (Q4) finite element in plane strain with side length $L$ and constant thickness $t$. The material is isotropic with bulk modulus $\\kappa$, and the volumetric-deviatoric split of the strain energy is assumed. The volumetric strain is $\\,\\operatorname{tr}(\\varepsilon)=\\partial u/\\partial x+\\partial v/\\partial y\\,$, and the volumetric energy density is $\\,w_{\\text{vol}}=(\\kappa/2)\\left(\\operatorname{tr}(\\varepsilon)\\right)^{2}\\,$. Let the element’s nodal degrees of freedom be ordered as $\\{u_{1},v_{1},u_{2},v_{2},u_{3},v_{3},u_{4},v_{4}\\}^{T}$ with the standard counterclockwise node ordering and the isoparametric mapping $x=(L/2)\\,\\xi$, $y=(L/2)\\,\\eta$, where $(\\xi,\\eta)\\in[-1,1]^{2}$. \n\nStarting from the volumetric energy functional and the definition of the volumetric strain, perform the following steps:\n- Derive the original volumetric stiffness contribution $K_{\\text{vol}}$ of the element, expressed in terms of the volumetric strain-displacement operator $B_{\\text{vol}}$.\n- Using the idea of an elementwise $L^{2}$-projection of $\\operatorname{tr}(\\varepsilon)$ onto the space of constants (the essence of the B-bar method for volumetric locking mitigation), derive the B-bar volumetric contribution $\\bar{K}_{\\text{vol}}$ and the corresponding projected operator $\\bar{B}_{\\text{vol}}$.\n- For the specific nodal displacement pattern defined by $u$-components $[u_{1},u_{2},u_{3},u_{4}]=[\\gamma,-\\gamma,\\gamma,-\\gamma]$ and $v$-components $[v_{1},v_{2},v_{3},v_{4}]=[0,0,0,0]$, show that the interpolated displacement field is $u(\\xi,\\eta)=\\gamma\\,\\xi\\,\\eta$ and $v(\\xi,\\eta)=0$. Then evaluate the scalar quantities $v^{T}K_{\\text{vol}}v$ and $v^{T}\\bar{K}_{\\text{vol}}v$ in terms of $\\kappa$, $t$, $L$, and $\\gamma$.\n\nDefine the normalized difference\n$$\\Delta R=\\frac{v^{T}K_{\\text{vol}}v-v^{T}\\bar{K}_{\\text{vol}}v}{\\kappa\\,t\\,\\gamma^{2}}.$$\nCompute $\\Delta R$ in closed form. Give your final answer as a single simplified analytic value. Do not include units in your final answer. No rounding is required.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It presents a standard exercise in the field of computational solid mechanics, specifically the finite element method. No inconsistencies or fallacies are detected. The problem is valid, and I will proceed with its solution.\n\nThe analysis concerns a $2$D, four-node isoparametric quadrilateral element under plane strain conditions. The element geometry is a square of side length $L$, mapped from a canonical parent element in the $(\\xi, \\eta)$ coordinate system where $\\xi, \\eta \\in [-1, 1]$. The mapping is given by $x=(L/2)\\xi$ and $y=(L/2)\\eta$.\n\nThe Jacobian matrix of this transformation is\n$$ \\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} L/2 & 0 \\\\ 0 & L/2 \\end{pmatrix} $$\nThe determinant of the Jacobian is $\\det(\\mathbf{J}) = L^2/4$. The differential area element is $dA = \\det(\\mathbf{J}) d\\xi d\\eta = (L^2/4) d\\xi d\\eta$.\n\nThe displacement field $(u, v)$ is interpolated from nodal displacements using the bilinear shape functions $N_i(\\xi, \\eta) = \\frac{1}{4}(1+\\xi_i\\xi)(1+\\eta_i\\eta)$, where $(\\xi_i, \\eta_i)$ are the coordinates of node $i$. Let the vector of nodal degrees of freedom be $\\mathbf{d} = \\{u_{1},v_{1},u_{2},v_{2},u_{3},v_{3},u_{4},v_{4}\\}^{T}$. The problem statement uses the symbol $v$ for this vector; to avoid confusion with the $y$-component of displacement, we shall use $\\mathbf{d}$ in the derivation.\n\nThe volumetric strain is $\\operatorname{tr}(\\varepsilon) = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$. The relationship between physical and parent element derivatives is $\\left\\{\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\right\\}^T = \\mathbf{J}^{-1} \\left\\{\\frac{\\partial}{\\partial \\xi}, \\frac{\\partial}{\\partial \\eta}\\right\\}^T = \\frac{2}{L}\\mathbf{I} \\left\\{\\frac{\\partial}{\\partial \\xi}, \\frac{\\partial}{\\partial \\eta}\\right\\}^T$.\nThe volumetric strain can be expressed as $\\operatorname{tr}(\\varepsilon) = B_{\\text{vol}} \\mathbf{d}$, where $B_{\\text{vol}}$ is a $1 \\times 8$ row vector given by:\n$$ B_{\\text{vol}} = \\left[ \\frac{\\partial N_1}{\\partial x}, \\frac{\\partial N_1}{\\partial y}, \\dots, \\frac{\\partial N_4}{\\partial x}, \\frac{\\partial N_4}{\\partial y} \\right] $$\nwhere $\\frac{\\partial N_i}{\\partial x} = \\frac{2}{L}\\frac{\\partial N_i}{\\partial \\xi}$ and $\\frac{\\partial N_i}{\\partial y} = \\frac{2}{L}\\frac{\\partial N_i}{\\partial \\eta}$.\n\nThe volumetric strain energy functional is $W_{\\text{vol}} = \\frac{1}{2}\\int_{V} \\kappa (\\operatorname{tr}(\\varepsilon))^2 dV$. For an element of constant thickness $t$, this becomes $W_{\\text{vol}} = \\frac{1}{2} \\mathbf{d}^T K_{\\text{vol}} \\mathbf{d}$, where the volumetric stiffness matrix $K_{\\text{vol}}$ is:\n$$ K_{\\text{vol}} = \\int_A t B_{\\text{vol}}^T \\kappa B_{\\text{vol}} dA = \\kappa t \\int_{-1}^1 \\int_{-1}^1 B_{\\text{vol}}^T(\\xi,\\eta) B_{\\text{vol}}(\\xi,\\eta) \\det(\\mathbf{J}) d\\xi d\\eta $$\n\nThe B-bar method aims to mitigate volumetric locking by replacing the local volumetric strain $\\operatorname{tr}(\\varepsilon)$ with its average over the element volume, $\\overline{\\operatorname{tr}(\\varepsilon)}$. This is equivalent to an $L^2$-projection of the strain onto the space of constant functions over the element.\n$$ \\overline{\\operatorname{tr}(\\varepsilon)} = \\frac{1}{V_{el}} \\int_{V_{el}} \\operatorname{tr}(\\varepsilon) dV = \\frac{1}{A_{el}} \\int_{A_{el}} \\operatorname{tr}(\\varepsilon) dA $$\nwhere $A_{el} = L^2$.\nSubstituting $\\operatorname{tr}(\\varepsilon) = B_{\\text{vol}} \\mathbf{d}$, we get $\\overline{\\operatorname{tr}(\\varepsilon)} = \\bar{B}_{\\text{vol}} \\mathbf{d}$, where the modified strain-displacement operator $\\bar{B}_{\\text{vol}}$ is constant over the element:\n$$ \\bar{B}_{\\text{vol}} = \\frac{1}{A_{el}} \\int_{A_{el}} B_{\\text{vol}} dA = \\frac{1}{L^2} \\int_{-1}^1 \\int_{-1}^1 B_{\\text{vol}}(\\xi, \\eta) \\frac{L^2}{4} d\\xi d\\eta = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 B_{\\text{vol}}(\\xi, \\eta) d\\xi d\\eta $$\nThe modified volumetric stiffness matrix, $\\bar{K}_{\\text{vol}}$, is derived using this constant operator:\n$$ \\bar{K}_{\\text{vol}} = \\int_A t \\bar{B}_{\\text{vol}}^T \\kappa \\bar{B}_{\\text{vol}} dA = \\kappa t \\bar{B}_{\\text{vol}}^T \\bar{B}_{\\text{vol}} \\int_A dA = \\kappa t A_{el} \\bar{B}_{\\text{vol}}^T \\bar{B}_{\\text{vol}} $$\nThe corresponding strain energy is $\\frac{1}{2} \\mathbf{d}^T \\bar{K}_{\\text{vol}} \\mathbf{d} = \\frac{1}{2} \\kappa t A_{el} (\\overline{\\operatorname{tr}(\\varepsilon)})^2$.\n\nWe now analyze the specific nodal displacement vector $\\mathbf{v}$ (here denoted $\\mathbf{d}$ for clarity) with components $u_1=\\gamma, u_2=-\\gamma, u_3=\\gamma, u_4=-\\gamma$ and $v_1=v_2=v_3=v_4=0$.\nThe interpolated displacement field is $u(\\xi, \\eta) = \\sum_{i=1}^4 N_i u_i$ and $v(\\xi, \\eta) = \\sum_{i=1}^4 N_i v_i$.\n$$ v(\\xi, \\eta) = N_1(0) + N_2(0) + N_3(0) + N_4(0) = 0 $$\n$$ u(\\xi, \\eta) = \\gamma(N_1 - N_2 + N_3 - N_4) $$\nUsing the definitions $N_i = \\frac{1}{4}(1+\\xi_i\\xi)(1+\\eta_i\\eta)$ with $(\\xi_1, \\eta_1)=(-1,-1)$, $(\\xi_2, \\eta_2)=(1,-1)$, $(\\xi_3, \\eta_3)=(1,1)$, $(\\xi_4, \\eta_4)=(-1,1)$:\n$$ N_1 - N_2 = \\frac{1}{4}(1-\\eta)(1-\\xi - (1+\\xi)) = -\\frac{1}{2}\\xi(1-\\eta) $$\n$$ N_3 - N_4 = \\frac{1}{4}(1+\\eta)(1+\\xi - (1-\\xi)) = \\frac{1}{2}\\xi(1+\\eta) $$\n$$ u(\\xi, \\eta) = \\gamma \\left( -\\frac{1}{2}\\xi(1-\\eta) + \\frac{1}{2}\\xi(1+\\eta) \\right) = \\gamma \\left( -\\frac{1}{2}\\xi + \\frac{1}{2}\\xi\\eta + \\frac{1}{2}\\xi + \\frac{1}{2}\\xi\\eta \\right) = \\gamma \\xi \\eta $$\nThe displacement field is indeed $u(\\xi, \\eta) = \\gamma\\xi\\eta$ and $v(\\xi, \\eta)=0$. This is the well-known hourglass mode.\n\nNext, we evaluate the resulting volumetric strain:\n$$ \\operatorname{tr}(\\varepsilon) = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = \\frac{2}{L}\\frac{\\partial u}{\\partial \\xi} + \\frac{2}{L}\\frac{\\partial v}{\\partial \\eta} = \\frac{2}{L}\\frac{\\partial}{\\partial \\xi}(\\gamma\\xi\\eta) + \\frac{2}{L}\\frac{\\partial}{\\partial \\eta}(0) = \\frac{2\\gamma\\eta}{L} $$\nThe strain energy for the standard formulation is $\\frac{1}{2} \\mathbf{v}^T K_{\\text{vol}} \\mathbf{v}$. Thus, the quadratic form $\\mathbf{v}^T K_{\\text{vol}} \\mathbf{v}$ is:\n$$ \\mathbf{v}^T K_{\\text{vol}} \\mathbf{v} = \\kappa t \\int_A (\\operatorname{tr}(\\varepsilon))^2 dA = \\kappa t \\int_{-1}^1 \\int_{-1}^1 \\left(\\frac{2\\gamma\\eta}{L}\\right)^2 \\frac{L^2}{4} d\\xi d\\eta $$\n$$ \\mathbf{v}^T K_{\\text{vol}} \\mathbf{v} = \\kappa t \\frac{4\\gamma^2}{L^2} \\frac{L^2}{4} \\int_{-1}^1 \\int_{-1}^1 \\eta^2 d\\xi d\\eta = \\kappa t \\gamma^2 \\left( \\int_{-1}^1 d\\xi \\right) \\left( \\int_{-1}^1 \\eta^2 d\\eta \\right) $$\nThe integrals evaluate to $\\int_{-1}^1 d\\xi = 2$ and $\\int_{-1}^1 \\eta^2 d\\eta = [\\eta^3/3]_{-1}^1 = 2/3$.\n$$ \\mathbf{v}^T K_{\\text{vol}} \\mathbf{v} = \\kappa t \\gamma^2 (2) \\left(\\frac{2}{3}\\right) = \\frac{4}{3} \\kappa t \\gamma^2 $$\nThis non-zero energy is spurious, as the hourglass mode should ideally be a pure shear deformation with zero volumetric change.\n\nFor the B-bar formulation, we first compute the averaged volumetric strain:\n$$ \\overline{\\operatorname{tr}(\\varepsilon)} = \\frac{1}{A_{el}} \\int_A \\operatorname{tr}(\\varepsilon) dA = \\frac{1}{L^2} \\int_{-1}^1 \\int_{-1}^1 \\left(\\frac{2\\gamma\\eta}{L}\\right) \\frac{L^2}{4} d\\xi d\\eta $$\n$$ \\overline{\\operatorname{tr}(\\varepsilon)} = \\frac{\\gamma}{2L} \\int_{-1}^1 \\int_{-1}^1 \\eta d\\xi d\\eta = \\frac{\\gamma}{2L} \\left( \\int_{-1}^1 d\\xi \\right) \\left( \\int_{-1}^1 \\eta d\\eta \\right) $$\nThe integral $\\int_{-1}^1 \\eta d\\eta = [\\eta^2/2]_{-1}^1 = 0$. Therefore, $\\overline{\\operatorname{tr}(\\varepsilon)} = 0$.\nThe strain energy for the B-bar formulation is:\n$$ \\mathbf{v}^T \\bar{K}_{\\text{vol}} \\mathbf{v} = \\kappa t A_{el} (\\overline{\\operatorname{tr}(\\varepsilon)})^2 = \\kappa t L^2 (0)^2 = 0 $$\nThe B-bar method correctly assigns zero volumetric energy to this mode.\n\nFinally, we compute the normalized difference $\\Delta R$:\n$$ \\Delta R = \\frac{\\mathbf{v}^T K_{\\text{vol}} \\mathbf{v} - \\mathbf{v}^T \\bar{K}_{\\text{vol}} \\mathbf{v}}{\\kappa t \\gamma^2} = \\frac{\\frac{4}{3} \\kappa t \\gamma^2 - 0}{\\kappa t \\gamma^2} $$\n$$ \\Delta R = \\frac{4}{3} $$\nThe result is a dimensionless constant.", "answer": "$$\\boxed{\\frac{4}{3}}$$", "id": "2542578"}, {"introduction": "Theory is essential, but the true test of a numerical method is its performance in practice. This final exercise is a computational challenge where you will implement and compare the standard and B-bar formulations for a simple structure. By simulating its response to a load under both compressible and nearly incompressible conditions, you will quantify the dramatic stiffening caused by volumetric locking and witness firsthand how the B-bar method restores physical accuracy.", "problem": "A two-dimensional small-strain linear elasticity problem is to be solved using the Finite Element Method (FEM) with bilinear quadrilateral elements (Q4) over a rectangular domain of width $L=2\\,\\mathrm{m}$ and height $H=1\\,\\mathrm{m}$, under plane strain conditions. The mesh consists of two Q4 elements aligned side-by-side along the $x$-direction, with unit out-of-plane thickness. The global nodal coordinates are, in meters, $[(0,0),(1,0),(2,0),(0,1),(1,1),(2,1)]$ ordered as nodes $0$ through $5$. The two elements are defined by the node connectivity $[0,1,4,3]$ and $[1,2,5,4]$, in the local node ordering consistent with the usual Q4 shape functions $(\\xi,\\eta)\\in[-1,1]^2$: node $0$ at $(-1,-1)$, node $1$ at $(+1,-1)$, node $2$ at $(+1,+1)$, and node $3$ at $(-1,+1)$.\n\nMaterial behavior is linear elastic and isotropic with Young's modulus $E$ (in $\\mathrm{Pa}$) and Poisson's ratio $\\nu$ (dimensionless). Under plane strain, define the Lamé parameters $\\lambda = \\dfrac{E\\nu}{(1+\\nu)(1-2\\nu)}$ and $\\mu = \\dfrac{E}{2(1+\\nu)}$. The standard displacement-based formulation employs $2\\times 2$ Gauss integration per element to assemble the global stiffness matrix\n$$\n\\mathbf{K}_\\text{std} = \\sum_{e} \\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D}\\, \\mathbf{B}\\, \\mathrm{d}\\Omega,\n$$\nwhere $\\mathbf{B}$ is the usual strain-displacement matrix for Q4 in Voigt notation with engineering shear $\\gamma_{xy}$, and $\\mathbf{D}$ is the plane strain constitutive matrix. To isolate and quantify volumetric locking effects, decompose the constitutive response into deviatoric and volumetric parts using\n$$\n\\mathbf{D} = \\mathbf{D}_\\text{dev} + \\mathbf{D}_\\text{vol}, \\quad \\mathbf{D}_\\text{dev} = \\mathrm{diag}(2\\mu,2\\mu,\\mu), \\quad \\mathbf{D}_\\text{vol} = \\lambda \\begin{bmatrix} 1 & 1 & 0\\\\ 1 & 1 & 0\\\\ 0 & 0 & 0 \\end{bmatrix}.\n$$\nThe volumetric strain measure in two dimensions is taken as $\\varepsilon_v = \\varepsilon_x + \\varepsilon_y$, which can be written as $\\varepsilon_v = \\mathbf{B}_v \\mathbf{u}$ with $\\mathbf{B}_v = [1,\\,1,\\,0]\\mathbf{B}$ being a $1\\times n_\\text{dof}$ row operator on element nodal displacements $\\mathbf{u}$.\n\nTo mitigate volumetric locking, implement the $\\bar{B}$ (B-bar) method by replacing the pointwise volumetric strain in the volumetric energy with its elementwise average,\n$$\n\\bar{\\mathbf{B}}_v = \\frac{1}{|\\Omega_e|}\\int_{\\Omega_e} \\mathbf{B}_v\\, \\mathrm{d}\\Omega,\n$$\nwhile retaining the standard deviatoric contribution. The resulting element stiffness under the B-bar method is\n$$\n\\mathbf{K}_e^{\\bar{B}} = \\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D}_\\text{dev}\\, \\mathbf{B}\\, \\mathrm{d}\\Omega \\;+\\; \\lambda\\, |\\Omega_e|\\, \\bar{\\mathbf{B}}_v^\\top \\bar{\\mathbf{B}}_v.\n$$\n\nLoading: apply a uniform pressure of magnitude $p$ (in $\\mathrm{Pa}$) on the right boundary $x=L$, acting inward along the negative $x$-direction. This produces a traction vector $\\mathbf{t} = [-p,\\,0]^\\top$ on that boundary per unit thickness. Use a consistent boundary load vector obtained by integrating along the boundary edge with appropriate one-dimensional Gaussian quadrature. Boundary conditions: fully clamp the left edge by enforcing $\\mathbf{u}=(0,0)$ at nodes $0$ and $3$.\n\nLet the global vector of unknown nodal displacements be $\\mathbf{U} \\in \\mathbb{R}^{12}$ ordered as $[u_0,v_0,u_1,v_1,\\dots,u_5,v_5]^\\top$. Solve two linear systems,\n$$\n\\mathbf{K}_\\text{std}\\mathbf{U}_\\text{std} = \\mathbf{F},\\qquad \\mathbf{K}_{\\bar{B}}\\mathbf{U}_{\\bar{B}} = \\mathbf{F},\n$$\nwith identical boundary conditions and load vector $\\mathbf{F}$. Define the effective edge stiffness in the $x$-direction as\n$$\nk_\\text{eff} = \\frac{F_\\text{tot}}{\\bar{u}_R}, \\quad \\bar{u}_R = \\frac{u_2 + u_5}{2}, \\quad F_\\text{tot} = p\\,H,\n$$\nwhere $u_2$ and $u_5$ are the $x$-displacements at nodes $2$ and $5$, respectively, and $H=1\\,\\mathrm{m}$. Because of linearity, $k_\\text{eff}$ is independent of the load scale apart from numerical roundoff. Quantify the locking-induced stiffness inflation via the ratio\n$$\nr = \\frac{k_{\\text{eff},\\text{std}}}{k_{\\text{eff},\\bar{B}}}.\n$$\n\nImplement a program that assembles both $\\mathbf{K}_\\text{std}$ and $\\mathbf{K}_{\\bar{B}}$ for the described mesh and solves for the displacements for the following test suite of parameter values (all in International System of Units):\n- Test 1 (baseline compressible): $E=1.0\\times 10^6$, $\\nu=0.3$, $p=1.0\\times 10^3$.\n- Test 2 (nearly incompressible): $E=1.0\\times 10^6$, $\\nu=0.4999$, $p=1.0\\times 10^3$.\n- Test 3 (scaled load and stiffness near incompressibility): $E=2.0\\times 10^6$, $\\nu=0.4999$, $p=2.0\\times 10^3$.\n- Test 4 (no volumetric coupling): $E=1.0\\times 10^6$, $\\nu=0.0$, $p=1.0\\times 10^3$.\n\nFor each test case, compute the scalar ratio $r$ as defined above. Your program should produce a single line of output containing the four ratios, in order of the tests above, as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4]\"). The ratios are dimensionless real numbers and must be reported as decimal values without any unit symbols.", "solution": "We begin from small-strain linear elasticity, plane strain kinematics, and the principle of virtual work. The domain is discretized with bilinear quadrilateral (Q4) finite elements. The key objective is to compare the standard full integration displacement-based formulation with a $\\bar{B}$ (B-bar) modification that alleviates volumetric locking in the nearly incompressible regime.\n\n1. Kinematics and strain-displacement relation. For a Q4 element with nodal displacements stacked into $\\mathbf{u}_e \\in \\mathbb{R}^{8}$, the strain vector in Voigt notation with engineering shear is\n$$\n\\boldsymbol{\\varepsilon} = \\begin{bmatrix}\\varepsilon_x\\\\ \\varepsilon_y\\\\ \\gamma_{xy}\\end{bmatrix} = \\mathbf{B}(\\xi,\\eta)\\,\\mathbf{u}_e,\n$$\nwhere $\\mathbf{B}$ collects derivatives of the bilinear shape functions with respect to physical coordinates. Using standard isoparametric mapping with coordinates $(\\xi,\\eta)\\in[-1,1]^2$ and the Jacobian $\\mathbf{J}$, the derivatives with respect to $x,y$ are obtained by $\\begin{bmatrix}\\partial N_i/\\partial x\\\\ \\partial N_i/\\partial y \\end{bmatrix} = \\mathbf{J}^{-1}\\begin{bmatrix}\\partial N_i/\\partial \\xi\\\\ \\partial N_i/\\partial \\eta \\end{bmatrix}$.\n\n2. Constitutive law and volumetric-deviatoric split. Under plane strain and isotropic linear elasticity, the stress-strain law reads\n$$\n\\boldsymbol{\\sigma} = \\mathbf{D}\\,\\boldsymbol{\\varepsilon}, \\quad \\mathbf{D} = \\begin{bmatrix}\\lambda+2\\mu & \\lambda & 0\\\\ \\lambda & \\lambda+2\\mu & 0\\\\ 0 & 0 & \\mu\\end{bmatrix},\n$$\nwith Lamé parameters $\\lambda = \\dfrac{E\\nu}{(1+\\nu)(1-2\\nu)}$ and $\\mu = \\dfrac{E}{2(1+\\nu)}$. To analyze locking, we split the response into a deviatoric part and a volumetric part. In two dimensions, a convenient exact split is\n$$\n\\mathbf{D} = \\underbrace{\\mathrm{diag}(2\\mu,\\,2\\mu,\\,\\mu)}_{\\mathbf{D}_\\text{dev}} \\;+\\; \\underbrace{\\lambda\\begin{bmatrix} 1 & 1 & 0\\\\ 1 & 1 & 0\\\\ 0 & 0 & 0 \\end{bmatrix}}_{\\mathbf{D}_\\text{vol}}.\n$$\nThe volumetric strain measure we act upon is $\\varepsilon_v = \\varepsilon_x + \\varepsilon_y$, which can be extracted by a row operator $\\mathbf{P}_v = [1,\\,1,\\,0]$ acting on $\\boldsymbol{\\varepsilon}$. At the element level, $\\varepsilon_v = \\mathbf{B}_v \\mathbf{u}_e$ with $\\mathbf{B}_v = \\mathbf{P}_v \\mathbf{B}$.\n\n3. Principle of virtual work and standard stiffness. The weak form (principle of virtual work) yields the standard element stiffness\n$$\n\\mathbf{K}_e^\\text{std} = \\int_{\\Omega_e} \\mathbf{B}^\\top (\\mathbf{D}_\\text{dev} + \\mathbf{D}_\\text{vol})\\, \\mathbf{B}\\, \\mathrm{d}\\Omega \\;=\\; \\underbrace{\\int_{\\Omega_e} \\mathbf{B}^\\top \\mathbf{D}_\\text{dev} \\mathbf{B}\\,\\mathrm{d}\\Omega}_{\\mathbf{K}_{e,\\text{dev}}} \\;+\\; \\underbrace{\\int_{\\Omega_e} \\mathbf{B}_v^\\top \\lambda\\, \\mathbf{B}_v\\, \\mathrm{d}\\Omega}_{\\mathbf{K}_{e,\\text{vol}}}.\n$$\nNumerically, we evaluate the integral with $2\\times 2$ Gaussian quadrature at points $(\\xi,\\eta) = (\\pm\\frac{1}{\\sqrt{3}},\\pm\\frac{1}{\\sqrt{3}})$, each with weight $1$, multiplying by $\\det\\mathbf{J}$.\n\n4. B-bar modification. Volumetric locking stems from the inability of low-order displacement fields to represent incompressible modes when the bulk modulus (or $\\lambda$) is large. The B-bar technique regularizes the volumetric part by replacing the pointwise volumetric strain by its elementwise average. Define the averaged volumetric operator\n$$\n\\bar{\\mathbf{B}}_v = \\frac{1}{|\\Omega_e|} \\int_{\\Omega_e} \\mathbf{B}_v\\,\\mathrm{d}\\Omega,\n$$\nwhere $|\\Omega_e|$ is the element area (unit thickness implied). The B-bar volumetric stiffness is then\n$$\n\\mathbf{K}_{e,\\text{vol}}^{\\bar{B}} = \\int_{\\Omega_e} \\bar{\\mathbf{B}}_v^\\top \\lambda\\, \\bar{\\mathbf{B}}_v\\, \\mathrm{d}\\Omega = \\lambda\\, |\\Omega_e|\\, \\bar{\\mathbf{B}}_v^\\top \\bar{\\mathbf{B}}_v,\n$$\nsince $\\bar{\\mathbf{B}}_v$ is constant over the element. The deviatoric part remains unchanged and is integrated with full $2\\times 2$ quadrature. The B-bar element stiffness is\n$$\n\\mathbf{K}_e^{\\bar{B}} = \\mathbf{K}_{e,\\text{dev}} + \\mathbf{K}_{e,\\text{vol}}^{\\bar{B}}.\n$$\n\n5. Boundary conditions and loading. The left boundary is clamped by setting $u=v=0$ at nodes $0$ and $3$. On the right boundary $x=L$, apply the uniform pressure $p$ inward (negative $x$ direction), giving a traction $\\mathbf{t} = [-p,0]^\\top$. The consistent boundary load vector on the right edge of the right element is computed by one-dimensional Gauss quadrature along the edge parameter $\\eta\\in[-1,1]$ at $\\xi=+1$,\n$$\n\\mathbf{f}_e^\\text{edge} = \\int_{-1}^{1} \\mathbf{N}_\\text{edge}^\\top \\mathbf{t} \\, J_\\text{edge}\\, \\mathrm{d}\\eta,\n$$\nwhere $J_\\text{edge} = \\left\\|\\dfrac{\\partial \\mathbf{x}}{\\partial \\eta}\\right\\|$ is the edge Jacobian (half the physical edge length for linear edges), and $\\mathbf{N}_\\text{edge}$ contains the edge shape functions mapped to the parent edge. With unit thickness and $H=1\\,\\mathrm{m}$, the total applied force magnitude is $F_\\text{tot} = pH$.\n\n6. Solution and metric. Assemble global stiffness matrices $\\mathbf{K}_\\text{std}$ and $\\mathbf{K}_{\\bar{B}}$ and a single global load vector $\\mathbf{F}$. Enforce essential boundary conditions via row/column elimination or penalty replacement. Solve the linear systems for $\\mathbf{U}_\\text{std}$ and $\\mathbf{U}_{\\bar{B}}$. Extract the average right-edge horizontal displacement $\\bar{u}_R = (u_2 + u_5)/2$. Define effective edge stiffnesses\n$$\nk_{\\text{eff},\\text{std}} = \\frac{F_\\text{tot}}{\\bar{u}_{R,\\text{std}}}, \\qquad k_{\\text{eff},\\bar{B}} = \\frac{F_\\text{tot}}{\\bar{u}_{R,\\bar{B}}},\n$$\nand compute the locking-inflation ratio $r = k_{\\text{eff},\\text{std}}/k_{\\text{eff},\\bar{B}}$. For a well-resolved, compressible material (e.g., $\\nu=0.3$), we anticipate $r \\approx 1$. For the nearly incompressible case (e.g., $\\nu=0.4999$), the standard formulation exhibits volumetric locking, so $r>1$, quantifying the stiffness overestimation mitigated by B-bar. For $\\nu=0$, volumetric and deviatoric parts decouple with $\\lambda=0$, so the methods coincide and $r=1$.\n\n7. Algorithmic steps for the program.\n- Define mesh geometry, connectivity, and degrees of freedom mapping.\n- For each element:\n  - For each $2\\times 2$ Gauss point, compute $\\mathbf{B}$, $\\det\\mathbf{J}$, accumulate $\\mathbf{K}_{e,\\text{dev}}$ using $\\mathbf{D}_\\text{dev}$, accumulate $\\mathbf{K}_{e,\\text{vol}}$ using $\\lambda$ and $\\mathbf{B}_v$ for the standard method, and simultaneously accumulate $\\int \\mathbf{B}_v \\,\\mathrm{d}\\Omega$ and $|\\Omega_e|$ for B-bar.\n  - After quadrature, form $\\mathbf{K}_{e,\\text{vol}}^{\\bar{B}} = \\lambda |\\Omega_e|\\, \\bar{\\mathbf{B}}_v^\\top \\bar{\\mathbf{B}}_v$ and add to $\\mathbf{K}_{e,\\text{dev}}$ for the B-bar element stiffness.\n- Assemble global stiffness matrices by summing element contributions at the appropriate global degrees of freedom.\n- Assemble the global load vector by consistent edge integration on the right boundary of the right element at $\\xi=+1$ with one-dimensional Gauss quadrature, applying $\\mathbf{t}=[-p,0]^\\top$.\n- Apply essential boundary conditions at nodes $0$ and $3$ ($u=v=0$).\n- Solve the two linear systems and compute $r$ for each test.\n\n8. Test suite and output. Run the procedure for the four specified test cases:\n- Test 1: $E=1.0\\times 10^6\\,\\mathrm{Pa}$, $\\nu=0.3$, $p=1.0\\times 10^3\\,\\mathrm{Pa}$.\n- Test 2: $E=1.0\\times 10^6\\,\\mathrm{Pa}$, $\\nu=0.4999$, $p=1.0\\times 10^3\\,\\mathrm{Pa}$.\n- Test 3: $E=2.0\\times 10^6\\,\\mathrm{Pa}$, $\\nu=0.4999$, $p=2.0\\times 10^3\\,\\mathrm{Pa}$.\n- Test 4: $E=1.0\\times 10^6\\,\\mathrm{Pa}$, $\\nu=0.0$, $p=1.0\\times 10^3\\,\\mathrm{Pa}$.\n\nBecause of linearity, Tests 2 and 3 should produce nearly identical $r$ up to numerical roundoff. The final output is a single line containing $[r_1,r_2,r_3,r_4]$ with each $r_i$ being a dimensionless decimal number.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef q4_shape_functions(xi, eta):\n    # Shape functions and derivatives w.r.t. xi, eta for Q4\n    N = np.array([\n        0.25*(1 - xi)*(1 - eta),  # N1\n        0.25*(1 + xi)*(1 - eta),  # N2\n        0.25*(1 + xi)*(1 + eta),  # N3\n        0.25*(1 - xi)*(1 + eta)   # N4\n    ])\n    dN_dxi = np.array([\n        -0.25*(1 - eta),\n         0.25*(1 - eta),\n         0.25*(1 + eta),\n        -0.25*(1 + eta)\n    ])\n    dN_deta = np.array([\n        -0.25*(1 - xi),\n        -0.25*(1 + xi),\n         0.25*(1 + xi),\n         0.25*(1 - xi)\n    ])\n    return N, dN_dxi, dN_deta\n\ndef b_matrix_for_element(coords, xi, eta):\n    # coords: (4,2) array of nodal coordinates [ [x1,y1],..., [x4,y4] ] in local order\n    N, dN_dxi, dN_deta = q4_shape_functions(xi, eta)\n    J = np.zeros((2,2))\n    # Assemble Jacobian J = [[dx/dxi, dx/deta],[dy/dxi, dy/deta]]\n    J[0,0] = np.dot(dN_dxi, coords[:,0])\n    J[0,1] = np.dot(dN_deta, coords[:,0])\n    J[1,0] = np.dot(dN_dxi, coords[:,1])\n    J[1,1] = np.dot(dN_deta, coords[:,1])\n    detJ = np.linalg.det(J)\n    invJ = np.linalg.inv(J)\n    # Gradients in physical coordinates\n    dN = np.zeros((4,2))\n    for i in range(4):\n        grad = invJ @ np.array([dN_dxi[i], dN_deta[i]])\n        dN[i,0] = grad[0]\n        dN[i,1] = grad[1]\n    # Build B matrix (3x8)\n    B = np.zeros((3, 8))\n    for i in range(4):\n        ix = 2*i\n        iy = ix + 1\n        B[0, ix] = dN[i,0]   # dNi/dx\n        B[1, iy] = dN[i,1]   # dNi/dy\n        B[2, ix] = dN[i,1]   # dNi/dy\n        B[2, iy] = dN[i,0]   # dNi/dx\n    return B, detJ\n\ndef element_stiffness_standard(coords, lam, mu):\n    # Standard full integration stiffness for one Q4 element with plane strain split D = D_dev + D_vol\n    # D_dev = diag(2mu, 2mu, mu), volumetric handled via Bv and lambda\n    D_dev = np.diag([2*mu, 2*mu, mu])\n    # 2x2 Gauss points\n    gp = 1.0/np.sqrt(3.0)\n    xis = [-gp, gp]\n    etas = [-gp, gp]\n    Ke = np.zeros((8,8))\n    for xi in xis:\n        for eta in etas:\n            B, detJ = b_matrix_for_element(coords, xi, eta)\n            w = 1.0\n            # Deviatoric contribution\n            Ke += B.T @ D_dev @ B * (w * detJ)\n            # Volumetric contribution via Bv = [1 1 0] B\n            Bv = np.array([1.0, 1.0, 0.0]) @ B  # shape (8,)\n            Ke += np.outer(Bv, Bv) * lam * (w * detJ)\n    return Ke\n\ndef element_stiffness_bbar(coords, lam, mu):\n    # B-bar element stiffness: deviatoric as standard; volumetric uses averaged Bv\n    D_dev = np.diag([2*mu, 2*mu, mu])\n    gp = 1.0/np.sqrt(3.0)\n    xis = [-gp, gp]\n    etas = [-gp, gp]\n    Ke_dev = np.zeros((8,8))\n    # Accumulate integral of Bv and area\n    int_Bv = np.zeros(8)\n    area = 0.0\n    for xi in xis:\n        for eta in etas:\n            B, detJ = b_matrix_for_element(coords, xi, eta)\n            w = 1.0\n            Ke_dev += B.T @ D_dev @ B * (w * detJ)\n            Bv = np.array([1.0, 1.0, 0.0]) @ B\n            int_Bv += Bv * (w * detJ)\n            area += (w * detJ)\n    Bv_bar = int_Bv / area\n    Ke_vol_bbar = lam * area * np.outer(Bv_bar, Bv_bar)\n    Ke = Ke_dev + Ke_vol_bbar\n    return Ke\n\ndef assemble_global_stiffness(nodes, elements, lam, mu, use_bbar=False):\n    ndof = 2 * len(nodes)\n    K = np.zeros((ndof, ndof))\n    for el_nodes in elements:\n        coords = np.array([nodes[i] for i in el_nodes])\n        if use_bbar:\n            Ke = element_stiffness_bbar(coords, lam, mu)\n        else:\n            Ke = element_stiffness_standard(coords, lam, mu)\n        # DOF mapping\n        edofs = []\n        for i in el_nodes:\n            edofs.extend([2*i, 2*i+1])\n        edofs = np.array(edofs, dtype=int)\n        # Assembly\n        for a in range(8):\n            A = edofs[a]\n            for b in range(8):\n                B = edofs[b]\n                K[A, B] += Ke[a, b]\n    return K\n\ndef apply_boundary_conditions(K, F, fixed_dofs):\n    # Modify K and F in place to enforce u=0 at fixed_dofs\n    for dof in fixed_dofs:\n        K[dof, :] = 0.0\n        K[:, dof] = 0.0\n        K[dof, dof] = 1.0\n        F[dof] = 0.0\n\ndef assemble_load_vector(nodes, elements, p):\n    # Assemble consistent nodal loads due to uniform pressure -p in x on right boundary of the right element\n    # Right boundary is the right edge of the second element (elements[1]) between local nodes 1->2 (global nodes 2 and 5)\n    ndof = 2 * len(nodes)\n    F = np.zeros(ndof)\n    # Edge integration on the right edge of the second element at xi=+1\n    right_el = elements[1]\n    el_coords = np.array([nodes[i] for i in right_el])\n    # Local node ordering: [n0, n1, n2, n3] corresponds to [(-1,-1),(+1,-1),(+1,+1),(-1,+1)]\n    # Right edge connects local node 1 (xi=+1, eta=-1) to local node 2 (xi=+1, eta=+1)\n    edge_local_nodes = [1, 2]\n    # 1D Gauss points for edge\n    gp = 1.0/np.sqrt(3.0)\n    etas = [-gp, gp]\n    # Traction vector (inward on right boundary)\n    tx, ty = -p, 0.0\n    for eta in etas:\n        xi = 1.0\n        N, dN_dxi, dN_deta = q4_shape_functions(xi, eta)\n        # Tangent vector along eta: x_eta = sum dN/deta * x_i, y_eta analogous\n        x_eta = np.dot(dN_deta, el_coords[:,0])\n        y_eta = np.dot(dN_deta, el_coords[:,1])\n        J_edge = np.sqrt(x_eta**2 + y_eta**2)\n        # Assemble nodal contributions: only nodes of this element get edge loads\n        for a_local, aN in enumerate(N):\n            # Only nodes on the edge receive non-zero contribution effectively (others have N=0 on this edge)\n            fa_x = aN * tx * J_edge\n            fa_y = aN * ty * J_edge\n            a_global_node = right_el[a_local]\n            F[2*a_global_node] += fa_x\n            F[2*a_global_node+1] += fa_y\n    return F\n\ndef solve_case(E, nu, p):\n    # Geometry and mesh\n    nodes = [\n        (0.0, 0.0),  # 0\n        (1.0, 0.0),  # 1\n        (2.0, 0.0),  # 2\n        (0.0, 1.0),  # 3\n        (1.0, 1.0),  # 4\n        (2.0, 1.0),  # 5\n    ]\n    elements = [\n        [0, 1, 4, 3],\n        [1, 2, 5, 4],\n    ]\n    lam = E*nu/((1+nu)*(1-2*nu)) if (1-2*nu) != 0 else 1e30  # guard against exact incompressibility\n    mu = E/(2*(1+nu))\n    ndof = 2*len(nodes)\n\n    # Assemble load\n    F = assemble_load_vector(nodes, elements, p)\n\n    # Assemble stiffness standard and bbar\n    K_std = assemble_global_stiffness(nodes, elements, lam, mu, use_bbar=False)\n    K_bbar = assemble_global_stiffness(nodes, elements, lam, mu, use_bbar=True)\n\n    # Apply boundary conditions: clamp nodes 0 and 3 (both u and v)\n    fixed_dofs = [0, 1, 6, 7]  # node 0: dofs 0,1; node 3: dofs 6,7\n    K_std_bc = K_std.copy()\n    K_bbar_bc = K_bbar.copy()\n    F_std = F.copy()\n    F_bbar = F.copy()\n    apply_boundary_conditions(K_std_bc, F_std, fixed_dofs)\n    apply_boundary_conditions(K_bbar_bc, F_bbar, fixed_dofs)\n\n    # Solve\n    U_std = np.linalg.solve(K_std_bc, F_std)\n    U_bbar = np.linalg.solve(K_bbar_bc, F_bbar)\n\n    # Compute average right-edge displacement in x at nodes 2 and 5\n    u_right_std = 0.5*(U_std[2*2] + U_std[2*5])\n    u_right_bbar = 0.5*(U_bbar[2*2] + U_bbar[2*5])\n\n    # Effective stiffnesses (use absolute values to avoid sign ambiguity)\n    H = 1.0\n    F_tot = p*H\n    k_eff_std = abs(F_tot)/max(abs(u_right_std), 1e-30)\n    k_eff_bbar = abs(F_tot)/max(abs(u_right_bbar), 1e-30)\n\n    r = k_eff_std / k_eff_bbar\n    return r\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (E [Pa], nu, p [Pa])\n    test_cases = [\n        (1.0e6, 0.3, 1.0e3),      # Test 1: baseline compressible\n        (1.0e6, 0.4999, 1.0e3),   # Test 2: nearly incompressible\n        (2.0e6, 0.4999, 2.0e3),   # Test 3: scaled load and stiffness\n        (1.0e6, 0.0, 1.0e3),      # Test 4: no volumetric coupling\n    ]\n\n    results = []\n    for E, nu, p in test_cases:\n        r = solve_case(E, nu, p)\n        results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2542550"}]}