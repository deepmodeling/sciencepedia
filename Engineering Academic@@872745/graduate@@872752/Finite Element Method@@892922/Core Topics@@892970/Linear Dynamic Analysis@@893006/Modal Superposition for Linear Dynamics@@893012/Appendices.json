{"hands_on_practices": [{"introduction": "To truly grasp modal superposition, we must first understand its building blocks: natural frequencies and mode shapes. These are not just mathematical abstractions; they are the intrinsic vibration patterns that a structure naturally prefers. This exercise will guide you through the foundational process of deriving these properties from first principles for a simple two-degree-of-freedom system. By solving this problem, you will develop a concrete intuition for how the mass and stiffness matrices dictate a system's in-phase and out-of-phase motions, which are the cornerstone of all linear dynamic analysis [@problem_id:2578908].", "problem": "Consider a linear, undamped, two-degree-of-freedom (DOF) mechanical system modeled within the finite element method (FEM) framework. Let the generalized coordinates be the nodal displacements $q_{1}(t)$ and $q_{2}(t)$, collected in the vector $\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$. The equations of motion follow from Newton’s second law applied in generalized coordinates. The symmetric, positive-definite mass and stiffness matrices are given by\n$$\nM = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}, \n\\qquad\nK = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}.\n$$\nStarting from first principles, formulate the governing equations for free vibration of this system and derive the associated generalized eigenvalue problem that determines the undamped natural circular frequencies and their mode shapes. Then, explicitly solve that eigenvalue problem for this $2$-DOF system to obtain both natural frequencies and their corresponding mass-normalized mode shapes. Provide a physical interpretation of the deformation patterns, identifying which mode is predominantly in-phase and which is out-of-phase, and explain how the coupling terms influence these patterns.\n\nAnswer specification: Report as your final answer only the lower natural circular frequency. Express it in radians per second and round your answer to four significant figures.", "solution": "The user has presented a problem in linear structural dynamics. The first mandatory step is a critical validation of the problem statement.\n\n### Step 1: Extract Givens\nThe problem statement provides the following information verbatim:\n- System type: linear, undamped, two-degree-of-freedom ($2$-DOF).\n- Modeling framework: finite element method (FEM).\n- Generalized coordinates vector: $\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$.\n- Mass matrix: $M = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}$. It is stated to be symmetric and positive-definite.\n- Stiffness matrix: $K = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}$. It is stated to be symmetric.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the required criteria.\n1.  **Scientific Grounding**: The problem is rooted in classical mechanics, specifically the theory of small oscillations of a conservative system, a fundamental topic in physics and engineering. The governing equation $M\\ddot{\\mathbf{q}} + K\\mathbf{q} = \\mathbf{0}$ is a standard representation. The matrices must be checked for the stated properties.\n    - The mass matrix $M$ is symmetric. Its principal minors are $\\det(3) = 3 > 0$ and $\\det(M) = (3)(2) - (1)(1) = 5 > 0$. Therefore, $M$ is positive-definite.\n    - The stiffness matrix $K$ is symmetric. Its principal minors are $\\det(5000) = 5000 > 0$ and $\\det(K) = (5000)(2500) - (-1500)^2 = 12,500,000 - 2,250,000 = 10,250,000 > 0$. Therefore, $K$ is also positive-definite.\n    The properties of the matrices are consistent with physical reality for a stable, passive mechanical system. The problem is scientifically sound.\n2.  **Well-Posedness**: For a system with symmetric, positive-definite mass ($M$) and stiffness ($K$) matrices, the theory of linear algebra and mechanical vibrations guarantees the existence of a set of real, positive natural frequencies and a corresponding set of M-orthogonal mode shapes. A unique solution exists. The problem is well-posed.\n3.  **Objectivity**: The problem is stated using precise, standard terminology from mechanical engineering. It is free of ambiguity and subjective claims.\n4.  **Completeness and Consistency**: All necessary data ($M$ and $K$ matrices) for determining the natural frequencies and mode shapes are provided. The units are physically consistent. The problem is self-contained.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It is a standard, valid problem in structural dynamics. A solution will be provided.\n\n---\n\nThe governing equation for free, undamped vibration of a linear system is given by Lagrange's equations, which for this context take the form of Newton's second law in matrix form:\n$$\nM\\ddot{\\mathbf{q}}(t) + K\\mathbf{q}(t) = \\mathbf{0}\n$$\nwhere $M$ is the mass matrix, $K$ is the stiffness matrix, and $\\mathbf{q}(t)$ is the vector of generalized displacements.\n\nTo find the natural frequencies and mode shapes, we assume a synchronous harmonic motion of the form:\n$$\n\\mathbf{q}(t) = \\mathbf{\\phi} e^{i\\omega t}\n$$\nwhere $\\mathbf{\\phi}$ is the time-independent mode shape vector (amplitude vector), $\\omega$ is the natural circular frequency, and $i = \\sqrt{-1}$. Differentiating this assumed solution with respect to time twice gives:\n$$\n\\ddot{\\mathbf{q}}(t) = -\\omega^2 \\mathbf{\\phi} e^{i\\omega t}\n$$\nSubstituting the assumed solution and its second derivative into the equation of motion yields:\n$$\n-M\\omega^2 \\mathbf{\\phi} e^{i\\omega t} + K \\mathbf{\\phi} e^{i\\omega t} = \\mathbf{0}\n$$\nSince the term $e^{i\\omega t}$ is never zero, we can divide the equation by it, which leads to the generalized eigenvalue problem:\n$$\n(K - \\omega^2 M) \\mathbf{\\phi} = \\mathbf{0}\n$$\nFor a non-trivial solution where the mode shape $\\mathbf{\\phi}$ is not the zero vector, the determinant of the coefficient matrix must be zero:\n$$\n\\det(K - \\omega^2 M) = 0\n$$\nLet $\\lambda = \\omega^2$. The equation becomes the characteristic equation in terms of $\\lambda$:\n$$\n\\det(K - \\lambda M) = 0\n$$\nSubstituting the given matrices $M$ and $K$:\n$$\n\\det\\left(\\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} - \\lambda \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix}\\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} 5000 - 3\\lambda & -1500 - \\lambda \\\\ -1500 - \\lambda & 2500 - 2\\lambda \\end{pmatrix} = 0\n$$\nEvaluating the determinant gives the characteristic polynomial:\n$$\n(5000 - 3\\lambda)(2500 - 2\\lambda) - (-1500 - \\lambda)^2 = 0\n$$\n$$\n(12,500,000 - 10,000\\lambda - 7,500\\lambda + 6\\lambda^2) - (2,250,000 + 3,000\\lambda + \\lambda^2) = 0\n$$\n$$\n6\\lambda^2 - 17,500\\lambda + 12,500,000 - \\lambda^2 - 3,000\\lambda - 2,250,000 = 0\n$$\nCombining like terms results in a quadratic equation for $\\lambda$:\n$$\n5\\lambda^2 - 20,500\\lambda + 10,250,000 = 0\n$$\nDividing by $5$ simplifies the equation:\n$$\n\\lambda^2 - 4100\\lambda + 2,050,000 = 0\n$$\nWe solve this quadratic equation for the eigenvalues $\\lambda_1$ and $\\lambda_2$ using the quadratic formula, $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{(-4100)^2 - 4(1)(2,050,000)}}{2} = \\frac{4100 \\pm \\sqrt{16,810,000 - 8,200,000}}{2}\n$$\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{8,610,000}}{2}\n$$\nThe two eigenvalues are:\n$$\n\\lambda_1 = \\frac{4100 - \\sqrt{8,610,000}}{2} \\approx \\frac{4100 - 2934.28}{2} \\approx 582.86 \\, (\\text{rad/s})^2\n$$\n$$\n\\lambda_2 = \\frac{4100 + \\sqrt{8,610,000}}{2} \\approx \\frac{4100 + 2934.28}{2} \\approx 3517.14 \\, (\\text{rad/s})^2\n$$\nThe natural circular frequencies are the square roots of the eigenvalues, $\\omega = \\sqrt{\\lambda}$.\nThe lower natural frequency is:\n$$\n\\omega_1 = \\sqrt{\\lambda_1} = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.142 \\, \\text{rad/s}\n$$\nThe higher natural frequency is:\n$$\n\\omega_2 = \\sqrt{\\lambda_2} = \\sqrt{\\frac{4100 + \\sqrt{8,610,000}}{2}} \\approx 59.305 \\, \\text{rad/s}\n$$\nNext, we find the corresponding eigenvectors (mode shapes) $\\mathbf{\\phi}_i$ by solving $(K - \\lambda_i M)\\mathbf{\\phi}_i = \\mathbf{0}$ for each eigenvalue.\nFor $\\lambda_1 \\approx 582.86$, the system is:\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_1) & -1500 - \\lambda_1 \\\\ -1500 - \\lambda_1 & 2500 - 2(\\lambda_1) \\end{pmatrix} \\begin{pmatrix} \\phi_{11} \\\\ \\phi_{21} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nUsing the first row: $(5000 - 3(582.86))\\phi_{11} - (1500 + 582.86)\\phi_{21} = 0$, which simplifies to $3251.42\\phi_{11} - 2082.86\\phi_{21} = 0$. The ratio of the components is $\\frac{\\phi_{21}}{\\phi_{11}} = \\frac{3251.42}{2082.86} \\approx 1.561$. The first mode shape is $\\mathbf{\\phi}_1 \\propto \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$.\n\nFor $\\lambda_2 \\approx 3517.14$, the system is:\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_2) & -1500 - \\lambda_2 \\\\ -1500 - \\lambda_2 & 2500 - 2(\\lambda_2) \\end{pmatrix} \\begin{pmatrix} \\phi_{12} \\\\ \\phi_{22} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nUsing the first row: $(5000 - 3(3517.14))\\phi_{12} - (1500 + 3517.14)\\phi_{22} = 0$, which gives $-5551.42\\phi_{12} - 5017.14\\phi_{22} = 0$. The ratio is $\\frac{\\phi_{22}}{\\phi_{12}} = -\\frac{5551.42}{5017.14} \\approx -1.106$. The second mode shape is $\\mathbf{\\phi}_2 \\propto \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$.\n\nTo obtain the mass-normalized mode shapes, $\\mathbf{\\hat{\\phi}}_i$, we enforce the condition $\\mathbf{\\hat{\\phi}}_i^T M \\mathbf{\\hat{\\phi}}_i = 1$. Let $\\mathbf{\\hat{\\phi}}_i = c_i \\mathbf{\\phi}_i$. Then $c_i = (\\mathbf{\\phi}_i^T M \\mathbf{\\phi}_i)^{-1/2}$.\nFor $\\mathbf{\\phi}_1 = \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$: $c_1 = (3(1)^2 + 2(1)(1)(1.561) + 2(1.561)^2)^{-1/2} \\approx 0.3016$.\n$\\mathbf{\\hat{\\phi}}_1 \\approx \\begin{pmatrix} 0.3016 \\\\ 0.4708 \\end{pmatrix}$.\nFor $\\mathbf{\\phi}_2 = \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$: $c_2 = (3(1)^2 + 2(1)(1)(-1.106) + 2(-1.106)^2)^{-1/2} \\approx 0.5560$.\n$\\mathbf{\\hat{\\phi}}_2 \\approx \\begin{pmatrix} 0.5560 \\\\ -0.6150 \\end{pmatrix}$.\n\n**Physical Interpretation:**\n1.  **First Mode (Lower Frequency, $\\omega_1 \\approx 24.14$ rad/s):** The mode shape $\\mathbf{\\hat{\\phi}}_1$ has components with the same sign. This means both degrees of freedom $q_1$ and $q_2$ move in the same direction at all times. This is the **in-phase** mode. The ratio of amplitudes shows that the second coordinate moves approximately $1.561$ times as much as the first. This mode represents a collective, lower-energy motion.\n2.  **Second Mode (Higher Frequency, $\\omega_2 \\approx 59.31$ rad/s):** The mode shape $\\mathbf{\\hat{\\phi}}_2$ has components with opposite signs. This means $q_1$ and $q_2$ move in opposite directions at all times. This is the **out-of-phase** mode. It represents a higher-energy, differential motion where components move against each other.\n\n**Influence of Coupling:** The off-diagonal terms $m_{12}=1$ and $k_{12}=-1500$ represent inertial and elastic coupling, respectively. Without these terms, the system would decouple into two independent $1$-DOF oscillators. The coupling serves two main functions:\n- It mixes the motions, ensuring that neither mode involves the movement of only one coordinate. The modes are combinations of the \"pure\" single-coordinate motions.\n- It \"splits\" the natural frequencies. An uncoupled system would have frequencies of $\\sqrt{k_{11}/m_{11}} \\approx 40.8$ rad/s and $\\sqrt{k_{22}/m_{22}} \\approx 35.4$ rad/s. The coupling forces one frequency lower (the in-phase mode, $\\omega_1$) and the other higher (the out-of-phase mode, $\\omega_2$) than the uncoupled frequencies. This is a general phenomenon in coupled oscillator systems.\n\nThe problem asks for the lower natural circular frequency, $\\omega_1$, rounded to four significant figures.\n$$\n\\omega_1 = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.14249 \\, \\text{rad/s}\n$$\nRounding to $4$ significant figures gives $24.14$.", "answer": "$$\n\\boxed{24.14}\n$$", "id": "2578908"}, {"introduction": "With a foundational understanding of modes, we can now apply them as a powerful computational tool. The primary advantage of modal superposition is its ability to approximate the behavior of a complex, many-degree-of-freedom system using only a small subset of its modes. In this practice, you will implement both a full \"ground truth\" simulation using direct integration and an approximate solution using a truncated modal basis. This computational exercise is designed to provide a tangible sense of the trade-off between accuracy and efficiency that defines practical modal analysis, demonstrating how a few well-chosen modes can often capture the dominant dynamic response of a structure [@problem_id:2578825].", "problem": "Consider the semi-discrete linear dynamics obtained from the Finite Element Method (FEM) for a one-dimensional chain with $5$ translational degrees of freedom. The governing initial value problem is the system of second-order ordinary differential equations\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{f}(t),\n$$\nwith initial conditions\n$$\n\\mathbf{u}(0) = \\mathbf{0}, \\quad \\dot{\\mathbf{u}}(0) = \\mathbf{0}.\n$$\nAll quantities must be expressed in the International System of Units (SI): mass in kilograms (kg), stiffness in newtons per meter (N/m), time in seconds (s), force in newtons (N), and damping in newton-seconds per meter (N·s/m). Any angle that appears in a trigonometric function must be in radians.\n\nLet the mass matrix be diagonal with identical lumped masses,\n$$\n\\mathbf{M} = m\\,\\mathbf{I}_5,\\quad m = 1.0,\n$$\nand let the stiffness matrix be the symmetric tridiagonal matrix corresponding to a nearest-neighbor chain with both ends attached to walls,\n$$\n\\mathbf{K} = k\\,\\mathrm{tridiag}([-1,2,-1]) \\in \\mathbb{R}^{5 \\times 5},\\quad k = 1000.0,\n$$\nmeaning that the diagonal entries are $2k$, the first sub- and super-diagonals are $-k$, and all other entries are zero. Let the viscous damping matrix be of Rayleigh form,\n$$\n\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K},\n$$\nwith coefficients $\\alpha$ and $\\beta$ specified in each test case. The external load is a concentrated transient half-sine pulse of amplitude $F_0$ applied at a single degree of freedom,\n$$\n\\mathbf{f}(t) = \n\\begin{cases}\nF_0 \\,\\sin\\!\\left(\\dfrac{\\pi t}{T}\\right)\\,\\mathbf{e}_j, & 0 \\le t \\le T, \\\\\n\\mathbf{0}, & t > T,\n\\end{cases}\n$$\nwhere $F_0 = 1.0$, the unit vector $\\mathbf{e}_j \\in \\mathbb{R}^5$ has a $1$ at index $j$ and zeros elsewhere, and $T$ is the pulse duration. Angles in $\\sin(\\cdot)$ are in radians.\n\nTask A (direct integration). Starting from Newton’s second law and standard time discretization principles, numerically integrate the coupled system for the displacement history $\\mathbf{u}(t)$ over a uniform grid $t_n = n\\,\\Delta t$ from $t_0 = 0$ to $t_{N} = t_{\\mathrm{end}}$, using a consistent, unconditionally stable, second-order accurate method for linear systems. The initial acceleration must be computed from the equation of motion at $t = 0$.\n\nTask B (modal superposition). Starting from the generalized eigenvalue problem for undamped free vibration,\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_i = \\omega_i^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_i,\n$$\ncompute the first three modes $\\{\\omega_i,\\boldsymbol{\\phi}_i\\}$, $i \\in \\{1,2,3\\}$, and scale the eigenvectors to be mass-normalized so that $\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{M}\\,\\boldsymbol{\\Phi} = \\mathbf{I}$, where $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1\\,\\boldsymbol{\\phi}_2\\,\\boldsymbol{\\phi}_3]$. Using only these three modes, form the decoupled scalar modal equations for modal coordinates $q_i(t)$, derive the effective scalar damping consistent with the given Rayleigh damping, and numerically integrate the scalar equations over the same time grid as in Task A. Reconstruct the approximate physical response by modal superposition using the first three modes,\n$$\n\\mathbf{u}_{\\mathrm{modal}}(t) = \\sum_{i=1}^{3} \\boldsymbol{\\phi}_i\\,q_i(t).\n$$\n\nTask C (comparison metric). For each test case, compute the dimensionless discrepancy\n$$\nr = \\frac{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}_{\\mathrm{modal}}(t_n) - \\mathbf{u}(t_n) \\right\\rVert_\\infty}{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}(t_n) \\right\\rVert_\\infty},\n$$\nwhere $\\lVert \\cdot \\rVert_\\infty$ is the maximum absolute component norm. If the denominator is zero, define $r=0$.\n\nTest suite. Use the following three cases, each with its own pulse duration $T$, end time $t_{\\mathrm{end}}$, load index $j$ (one-based indexing), Rayleigh coefficients $(\\alpha,\\beta)$, and time step $\\Delta t$:\n\n- Case $1$: $T = 1.0$ s, $t_{\\mathrm{end}} = 3.0$ s, $j = 3$, $\\alpha = 0.02$ s$^{-1}$, $\\beta = 0.0002$ s, $\\Delta t = 0.001$ s.\n- Case $2$: $T = 0.05$ s, $t_{\\mathrm{end}} = 0.5$ s, $j = 1$, $\\alpha = 0.0$ s$^{-1}$, $\\beta = 0.0$ s, $\\Delta t = 0.0001$ s.\n- Case $3$: $T = 0.05$ s, $t_{\\mathrm{end}} = 0.5$ s, $j = 5$, $\\alpha = 0.5$ s$^{-1}$, $\\beta = 0.002$ s, $\\Delta t = 0.0001$ s.\n\nRequirements for the final program output. Your program must:\n- Implement the direct time integration and the modal superposition approach restricted to the first three modes as described above.\n- Use radians for any trigonometric function arguments.\n- Produce a single line of output containing the three discrepancy values for the three cases as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3]$, with each $r_i$ printed as a decimal number rounded to exactly six digits after the decimal point.", "solution": "The problem requires the analysis of a $5$-degree-of-freedom ($DOF$) linear dynamic system, which is a standard model in structural mechanics derived from the finite element method. We are asked to compute the system's response to a transient load using two distinct methods—direct time integration and modal superposition—and then to quantify the discrepancy between the two resulting solutions.\n\nThe governing equation of motion for the system is given by the matrix differential equation:\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}}(t) = \\mathbf{f}(t)\n$$\nwith quiescent initial conditions $\\mathbf{u}(0) = \\mathbf{0}$ and $\\dot{\\mathbf{u}}(0) = \\mathbf{0}$. The matrices $\\mathbf{M}$, $\\mathbf{C}$, and $\\mathbf{K}$ represent the mass, damping, and stiffness properties of the system, respectively. $\\mathbf{u}(t)$ is the vector of time-dependent displacements, and $\\mathbf{f}(t)$ is the vector of external forces.\n\nThe system matrices are specified as:\n- Mass matrix: $\\mathbf{M} = m\\,\\mathbf{I}_5$, with $m=1.0\\,\\mathrm{kg}$. This is a diagonal (lumped) mass matrix.\n- Stiffness matrix: $\\mathbf{K} = k\\,\\mathrm{tridiag}([-1,2,-1])$ with $k=1000.0\\,\\mathrm{N/m}$. This represents a chain of masses connected by springs, with both ends fixed.\n- Damping matrix: $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$, known as Rayleigh damping. The coefficients $\\alpha$ and $\\beta$ are provided for each test case.\n\nThe validation of the problem statement confirms that it is scientifically sound, well-posed, and all necessary data are provided. We may proceed with the solution.\n\nTask A: Direct Time Integration of the Full System\n\nTo numerically integrate the coupled system of equations, we must employ a time-stepping algorithm. The problem specifies the use of a consistent, unconditionally stable, and second-order accurate method for linear systems. The Newmark-$\\beta$ method with parameters $\\gamma = 1/2$ and $\\beta = 1/4$ (commonly known as the Average Acceleration Method or trapezoidal rule) satisfies these criteria.\n\nThe Newmark method relations are:\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t\\, \\dot{\\mathbf{u}}_n + \\frac{(\\Delta t)^2}{2} \\left[ (1-2\\beta) \\ddot{\\mathbf{u}}_n + 2\\beta \\ddot{\\mathbf{u}}_{n+1} \\right]\n$$\n$$\n\\dot{\\mathbf{u}}_{n+1} = \\dot{\\mathbf{u}}_n + \\Delta t \\left[ (1-\\gamma) \\ddot{\\mathbf{u}}_n + \\gamma \\ddot{\\mathbf{u}}_{n+1} \\right]\n$$\nwhere the subscript $n$ denotes the value at time $t_n = n\\,\\Delta t$. For $\\gamma = 1/2$ and $\\beta = 1/4$, these simplify. We can rearrange these relations to express $\\dot{\\mathbf{u}}_{n+1}$ and $\\ddot{\\mathbf{u}}_{n+1}$ in terms of the unknown displacement $\\mathbf{u}_{n+1}$ and known quantities at step $n$:\n$$\n\\ddot{\\mathbf{u}}_{n+1} = \\frac{4}{(\\Delta t)^2}(\\mathbf{u}_{n+1} - \\mathbf{u}_n) - \\frac{4}{\\Delta t}\\dot{\\mathbf{u}}_n - \\ddot{\\mathbf{u}}_n\n$$\n$$\n\\dot{\\mathbf{u}}_{n+1} = \\frac{2}{\\Delta t}(\\mathbf{u}_{n+1} - \\mathbf{u}_n) - \\dot{\\mathbf{u}}_n\n$$\nSubstituting these expressions into the equation of motion at time $t_{n+1}$, $\\mathbf{M}\\,\\ddot{\\mathbf{u}}_{n+1} + \\mathbf{C}\\,\\dot{\\mathbf{u}}_{n+1} + \\mathbf{K}\\,\\mathbf{u}_{n+1} = \\mathbf{f}_{n+1}$, and rearranging terms yields a linear system for $\\mathbf{u}_{n+1}$:\n$$\n\\hat{\\mathbf{K}}\\,\\mathbf{u}_{n+1} = \\hat{\\mathbf{f}}_{n+1}\n$$\nwhere the effective stiffness matrix $\\hat{\\mathbf{K}}$ is given by:\n$$\n\\hat{\\mathbf{K}} = \\left( \\frac{4}{(\\Delta t)^2}\\mathbf{M} + \\frac{2}{\\Delta t}\\mathbf{C} + \\mathbf{K} \\right)\n$$\nand the effective force vector $\\hat{\\mathbf{f}}_{n+1}$ is:\n$$\n\\hat{\\mathbf{f}}_{n+1} = \\mathbf{f}_{n+1} + \\left(\\frac{4}{(\\Delta t)^2}\\mathbf{M} + \\frac{2}{\\Delta t}\\mathbf{C}\\right) \\mathbf{u}_n + \\left(\\frac{4}{\\Delta t}\\mathbf{M} + \\mathbf{C}\\right) \\dot{\\mathbf{u}}_n + \\mathbf{M}\\, \\ddot{\\mathbf{u}}_n\n$$\nSince $\\hat{\\mathbf{K}}$ is constant for a given time step $\\Delta t$, it can be computed and factorized once. At each time step, we compute $\\hat{\\mathbf{f}}_{n+1}$, solve for $\\mathbf{u}_{n+1}$, and then update the velocity $\\dot{\\mathbf{u}}_{n+1}$ and acceleration $\\ddot{\\mathbf{u}}_{n+1}$.\nThe initial acceleration $\\ddot{\\mathbf{u}}(0)$ is found from the equation of motion at $t=0$: $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(0) + \\mathbf{C}\\,\\dot{\\mathbf{u}}(0) + \\mathbf{K}\\,\\mathbf{u}}(0) = \\mathbf{f}(0)$. Given $\\mathbf{u}(0)=\\mathbf{0}$, $\\dot{\\mathbf{u}}(0)=\\mathbf{0}$, and $\\mathbf{f}(0) = \\mathbf{0}$ (since $\\sin(0)=0$), we get $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(0) = \\mathbf{0}$. As $\\mathbf{M}$ is invertible, $\\ddot{\\mathbf{u}}(0) = \\mathbf{0}$.\n\nTask B: Modal Superposition\n\nThis method relies on transforming the coupled physical coordinates $\\mathbf{u}(t)$ into a set of uncoupled modal coordinates $q_i(t)$. This is achieved by using the eigenvectors (modes) of the undamped free vibration system.\nFirst, we solve the generalized eigenvalue problem:\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_i = \\omega_i^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_i\n$$\nThis yields a set of natural frequencies $\\omega_i$ and corresponding mode shape vectors $\\boldsymbol{\\phi}_i$. We are instructed to use only the first three modes ($i \\in \\{1,2,3\\}$). The eigenvectors must be mass-normalized such that $\\boldsymbol{\\phi}_i^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\phi}_j = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta. Let $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1, \\boldsymbol{\\phi}_2, \\boldsymbol{\\phi}_3]$ be the matrix of the first three normalized mode shapes.\n\nThe physical displacement is approximated as a linear combination of these modes:\n$$\n\\mathbf{u}_{\\mathrm{modal}}(t) = \\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\sum_{i=1}^{3} \\boldsymbol{\\phi}_i\\, q_i(t)\n$$\nSubstituting this into the original equation of motion and pre-multiplying by $\\boldsymbol{\\Phi}^\\mathsf{T}$ yields the system in modal coordinates:\n$$\n(\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\Phi})\\,\\ddot{\\mathbf{q}}(t) + (\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{C} \\boldsymbol{\\Phi})\\,\\dot{\\mathbf{q}}(t) + (\\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{K} \\boldsymbol{\\Phi})\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{f}(t)\n$$\nDue to the orthogonality properties of the eigenvectors, the modal mass and stiffness matrices are diagonal:\n$$\n\\mathbf{M}^* = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{M} \\boldsymbol{\\Phi} = \\mathbf{I} \\quad \\text{(by normalization)}\n$$\n$$\n\\mathbf{K}^* = \\boldsymbol{\\Phi}^\\mathsf{T} \\mathbf{K} \\boldsymbol{\\Phi} = \\mathrm{diag}(\\omega_1^2, \\omega_2^2, \\omega_3^2)\n$$\nFor Rayleigh damping, the modal damping matrix is also diagonal:\n$$\n\\mathbf{C}^* = \\boldsymbol{\\Phi}^\\mathsf{T} (\\alpha\\mathbf{M} + \\beta\\mathbf{K}) \\boldsymbol{\\Phi} = \\alpha(\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{M}\\boldsymbol{\\Phi}) + \\beta(\\boldsymbol{\\Phi}^\\mathsf{T}\\mathbf{K}\\boldsymbol{\\Phi}) = \\alpha\\mathbf{I} + \\beta\\mathbf{K}^* = \\mathrm{diag}(\\alpha+\\beta\\omega_1^2, \\alpha+\\beta\\omega_2^2, \\alpha+\\beta\\omega_3^2)\n$$\nThis results in a set of three independent scalar equations, one for each mode $i \\in \\{1,2,3\\}$:\n$$\n\\ddot{q}_i(t) + (2\\zeta_i\\omega_i)\\,\\dot{q}_i(t) + \\omega_i^2\\, q_i(t) = p_i(t)\n$$\nwhere the modal damping term is $2\\zeta_i\\omega_i = \\alpha + \\beta\\omega_i^2$, and the modal force is $p_i(t) = \\boldsymbol{\\phi}_i^\\mathsf{T}\\mathbf{f}(t)$. The initial conditions for the modal coordinates are $q_i(0)=0$ and $\\dot{q}_i(0)=0$.\nEach of these scalar second-order ODEs is integrated using the same Newmark-$\\beta$ scheme as in Task A. The resulting modal displacement histories $q_i(t_n)$ are then used to reconstruct the approximate physical displacement $\\mathbf{u}_{\\mathrm{modal}}(t_n)$.\n\nTask C: Comparison Metric\n\nThe discrepancy between the \"exact\" numerical solution from direct integration $\\mathbf{u}(t_n)$ and the approximate solution from modal superposition $\\mathbf{u}_{\\mathrm{modal}}(t_n)$ is measured by the dimensionless ratio $r$:\n$$\nr = \\frac{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}_{\\mathrm{modal}}(t_n) - \\mathbf{u}(t_n) \\right\\rVert_\\infty}{\\max_{0 \\le n \\le N} \\left\\lVert \\mathbf{u}(t_n) \\right\\rVert_\\infty}\n$$\nwhere $\\lVert\\mathbf{v}\\rVert_\\infty = \\max_j |v_j|$ is the maximum absolute component of a vector $\\mathbf{v}$. This metric quantifies the maximum error of the modal solution relative to the maximum response of the system, providing a measure of the accuracy of the three-mode approximation for the given loading and system parameters.\n\nThe computational procedure involves implementing both integration schemes for each test case, storing the full time history of the displacement vectors $\\mathbf{u}(t_n)$ and $\\mathbf{u}_{\\mathrm{modal}}(t_n)$, and finally computing the ratio $r$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Solves the structural dynamics problem using direct integration and modal superposition,\n    then computes the discrepancy between the two methods for three test cases.\n    \"\"\"\n    \n    # Define physical constants\n    M_val = 1.0  # kg\n    K_val = 1000.0  # N/m\n    F0 = 1.0  # N\n    dof = 5\n\n    # Define system matrices\n    M = M_val * np.identity(dof)\n    K = np.zeros((dof, dof))\n    for i in range(dof):\n        K[i, i] = 2.0 * K_val\n        if i > 0:\n            K[i, i-1] = -1.0 * K_val\n        if i  dof - 1:\n            K[i, i+1] = -1.0 * K_val\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (T, t_end, j_one_based, alpha, beta, dt)\n        (1.0, 3.0, 3, 0.02, 0.0002, 0.001),\n        (0.05, 0.5, 1, 0.0, 0.0, 0.0001),\n        (0.05, 0.5, 5, 0.5, 0.002, 0.0001),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T, t_end, j_one_based, alpha, beta, dt = case\n        \n        # Convert 1-based index to 0-based\n        j_idx = j_one_based - 1\n        \n        # Damping matrix for the current case\n        C = alpha * M + beta * K\n        \n        # Time steps\n        time_steps = np.arange(0, t_end + dt, dt)\n        num_steps = len(time_steps)\n\n        # Force vector definition\n        e_j = np.zeros(dof)\n        e_j[j_idx] = 1.0\n\n        def get_force(t):\n            if 0 = t = T:\n                return F0 * np.sin(np.pi * t / T) * e_j\n            return np.zeros(dof)\n\n        # --- Task A: Direct Integration (Newmark-beta method) ---\n        gamma = 0.5\n        beta_nm = 0.25\n        \n        u = np.zeros(dof)\n        u_dot = np.zeros(dof)\n        # Initial acceleration from EOM at t=0\n        # M*u_ddot(0) + C*u_dot(0) + K*u(0) = f(0)\n        # Since u(0)=0, u_dot(0)=0, f(0)=0, then M*u_ddot(0)=0 => u_ddot(0)=0\n        u_ddot = np.zeros(dof)\n\n        u_history = np.zeros((num_steps, dof))\n        \n        K_hat = (1 / (beta_nm * dt**2)) * M + (gamma / (beta_nm * dt)) * C + K\n\n        for i in range(num_steps - 1):\n            t_next = time_steps[i+1]\n            f_next = get_force(t_next)\n            \n            f_hat = f_next + M @ ( (1/(beta_nm*dt**2))*u + (1/(beta_nm*dt))*u_dot + (1/(2*beta_nm) - 1)*u_ddot ) \\\n                         + C @ ( (gamma/(beta_nm*dt))*u + (gamma/beta_nm - 1)*u_dot + dt/2*(gamma/beta_nm - 2)*u_ddot )\n            \n            u_next = np.linalg.solve(K_hat, f_hat)\n            u_ddot_next = (1/(beta_nm*dt**2)) * (u_next - u - dt*u_dot) - (1/(2*beta_nm) - 1)*u_ddot\n            u_dot_next = u_dot + dt*((1-gamma)*u_ddot + gamma*u_ddot_next)\n\n            u, u_dot, u_ddot = u_next, u_dot_next, u_ddot_next\n            u_history[i+1, :] = u\n\n        # --- Task B: Modal Superposition ---\n        num_modes = 3\n        \n        # Solve generalized eigenvalue problem: K*phi = omega^2*M*phi\n        eigvals, eigvecs = eigh(K, M)\n        \n        omega_sq = eigvals[:num_modes]\n        omega = np.sqrt(omega_sq)\n        \n        # Mass normalize eigenvectors\n        phi_raw = eigvecs[:, :num_modes]\n        modal_masses = np.einsum('ji,jk,ki->i', phi_raw, M, phi_raw)\n        phi = phi_raw / np.sqrt(modal_masses)\n\n        # Modal damping\n        c_modal = alpha + beta * omega_sq\n        \n        q = np.zeros(num_modes)\n        q_dot = np.zeros(num_modes)\n        q_ddot = np.zeros(num_modes) # Initial modal acceleration is zero\n        \n        u_modal_history = np.zeros((num_steps, dof))\n        \n        k_hat_modal = (1 / (beta_nm * dt**2)) + (gamma / (beta_nm * dt)) * c_modal + omega_sq\n\n        for i in range(num_steps - 1):\n            t_next = time_steps[i+1]\n            f_next = get_force(t_next)\n            p_next = phi.T @ f_next\n            \n            p_hat = p_next + (1/(beta_nm*dt**2))*q + (1/(beta_nm*dt))*q_dot + (1/(2*beta_nm) - 1)*q_ddot \\\n                         + c_modal * ( (gamma/(beta_nm*dt))*q + (gamma/beta_nm-1)*q_dot + dt/2*(gamma/beta_nm - 2)*q_ddot )\n            \n            q_next = p_hat / k_hat_modal\n            q_ddot_next = (1/(beta_nm*dt**2))*(q_next - q - dt*q_dot) - (1/(2*beta_nm) - 1)*q_ddot\n            q_dot_next = q_dot + dt*((1-gamma)*q_ddot + gamma*q_ddot_next)\n            \n            q, q_dot, q_ddot = q_next, q_dot_next, q_ddot_next\n            u_modal_history[i+1, :] = phi @ q\n\n        # --- Task C: Comparison Metric ---\n        diff_history = u_modal_history - u_history\n        \n        # Infinity norm at each time step\n        inf_norm_diff = np.max(np.abs(diff_history), axis=1)\n        inf_norm_u = np.max(np.abs(u_history), axis=1)\n        \n        numerator = np.max(inf_norm_diff)\n        denominator = np.max(inf_norm_u)\n\n        if denominator == 0.0:\n            r = 0.0\n        else:\n            r = numerator / denominator\n            \n        results.append(r)\n        \n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2578825"}, {"introduction": "Truncating the modal series is efficient, but it introduces errors because the contributions of higher-frequency modes are neglected. While this may be acceptable for calculating displacements, it can lead to significant inaccuracies in quantities that are sensitive to local deformations, such as stresses and reaction forces. This exercise introduces the Mode Acceleration Method (MAM) as a powerful enhancement to the standard Mode Displacement Method (MDM). By implementing and comparing both methods, you will discover how a simple static correction can dramatically improve the accuracy of your results, allowing you to create highly accurate reduced-order models that correctly capture both dynamic and static effects [@problem_id:2578761].", "problem": "You are given a linear, time-invariant second-order system obtained from the Finite Element Method (FEM) semi-discretization of structural dynamics, governed by the matrix ordinary differential equation\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}}(t) = \\mathbf{f}(t),\n$$\nwith initial conditions\n$$\n\\mathbf{x}(0) = \\mathbf{0},\\quad \\dot{\\mathbf{x}}(0) = \\mathbf{0}.\n$$\nHere, $\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ is the symmetric positive-definite mass matrix, $\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ is the symmetric positive-definite stiffness matrix, $\\mathbf{C}\\in\\mathbb{R}^{n\\times n}$ is the damping matrix assumed to be Rayleigh of the form $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$, and $\\mathbf{f}(t)$ is a step load $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$, where $H(t)$ is the Heaviside step function, $\\mathbf{f}_0\\in\\mathbb{R}^{n}$ is a constant load vector, and $t$ is time in seconds.\n\nThe task is to compare two modal superposition truncation strategies for predicting the physical displacement response and a support reaction under a step load:\n- Mode Displacement Method (MDM): retain $r$ modes and reconstruct the physical displacement only from the retained modal displacements.\n- Mode Acceleration Method (MAM): retain $r$ modes for the modal dynamics but augment the physical displacement reconstruction by enforcing equilibrium of the residual loads through a static correction that uses the stiffness matrix.\n\nYou must:\n1. Start from the fundamental governing equation above and the definition of Rayleigh damping and derive the modal equations by solving the generalized eigenvalue problem\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j,\\quad j=1,\\dots,n,\n$$\nwith mass normalization $\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij}$. Denote $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1,\\dots,\\boldsymbol{\\phi}_n]$, $\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2,\\dots,\\omega_n^2)$, and write the decoupled modal equations for the generalized coordinates $\\mathbf{q}(t)$ under the step load.\n2. Define precisely the MDM and MAM physical displacement reconstructions using only the first $r$ modes, ensuring that the MAM correction is obtained by enforcing static equilibrium of the residual loads in the physical coordinates at every time $t$. Do not assume any special structure of the load beyond being a step; derive the expressions from first principles.\n3. For a three-degree-of-freedom chain with translational degrees of freedom $\\mathbf{x}(t) = [x_1(t), x_2(t), x_3(t)]^\\top$ measured in meters, adopt the following stiffness topology: a spring with stiffness $k_1$ connects $x_1$ to ground, a spring with stiffness $k_2$ connects $x_1$ and $x_2$, and a spring with stiffness $k_3$ connects $x_2$ and $x_3$. The corresponding stiffness matrix is\n$$\n\\mathbf{K} = \\begin{bmatrix}\nk_1 + k_2  -k_2  0\\\\\n-k_2  k_2 + k_3  -k_3\\\\\n0  -k_3  k_3\n\\end{bmatrix}.\n$$\nThe base reaction is defined as the elastic force in the ground spring, i.e., $R_\\text{base}(t) = k_1\\,x_1(t)$, measured in newtons.\n4. Calibrate the Rayleigh damping coefficients $\\alpha$ and $\\beta$ by enforcing target modal damping ratios $\\zeta(\\omega_a)=\\zeta_a$ and $\\zeta(\\omega_b)=\\zeta_b$ at two chosen circular frequencies $\\omega_a$ and $\\omega_b$, using the identity for mass-normalized modes\n$$\n\\zeta_j \\equiv \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{C}\\,\\boldsymbol{\\phi}_j}{2\\,\\omega_j} = \\frac{\\alpha}{2\\,\\omega_j} + \\frac{\\beta\\,\\omega_j}{2}.\n$$\nFor each test case below, use $\\omega_a=\\omega_1$, $\\omega_b=\\omega_3$, and the specified targets $\\zeta_a$ and $\\zeta_b$.\n5. Use a modal-space time integration scheme that is unconditionally stable and second-order accurate for linear systems (e.g., the Newmark average-acceleration method) to compute the time histories of the retained generalized coordinates for both the MDM and the MAM reconstructions, as well as the reference solution that uses all $n$ modes. The modal mass must be $1$ due to mass normalization. Time is in seconds, forces in newtons, masses in kilograms, and stiffnesses in newtons per meter. For all cases, initial conditions are zero. The Heaviside step is applied at $t=0^+$.\n6. For each test case, compute:\n   - The peak absolute displacement at the top degree of freedom $x_3(t)$ in meters.\n   - The peak absolute base reaction $R_\\text{base}(t)$ in newtons.\n   For both quantities, compute the absolute relative error of MDM and MAM with respect to the full-modal reference solution using all $n$ modes:\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|.\n$$\nExpress these errors as decimals (not percentages), rounded to six decimal places.\n\nImplement a program that performs the above for the following test suite. In each case, specify the mass matrix $\\mathbf{M}$ (diagonal), stiffness parameters $(k_1,k_2,k_3)$, step load vector $\\mathbf{f}_0$, the number of retained modes $r$, the Rayleigh damping targets $(\\zeta_a,\\zeta_b)$ at $(\\omega_1,\\omega_3)$, the final time $T_\\text{end}$ in seconds, and the uniform time step $\\Delta t$ in seconds.\n\nTest Suite:\n- Case A (baseline, lightly damped, first-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (2.0\\times 10^6, 1.5\\times 10^6, 1.0\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [0, 0, 10000]^\\top$ in newtons.\n  - $r = 1$.\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$.\n  - $T_\\text{end} = 1.2$ seconds, $\\Delta t = 5.0\\times 10^{-4}$ seconds.\n- Case B (stiffer system, first-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (5.0\\times 10^6, 5.0\\times 10^6, 5.0\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [5000, 0, 0]^\\top$ in newtons.\n  - $r = 1$.\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$.\n  - $T_\\text{end} = 0.6$ seconds, $\\Delta t = 2.0\\times 10^{-4}$ seconds.\n- Case C (undamped, two-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (2.5\\times 10^6, 1.8\\times 10^6, 1.2\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [0, 8000, 0]^\\top$ in newtons.\n  - $r = 2$.\n  - $(\\zeta_a, \\zeta_b) = (0.0, 0.0)$, i.e., $\\alpha=\\beta=0$.\n  - $T_\\text{end} = 1.0$ seconds, $\\Delta t = 4.0\\times 10^{-4}$ seconds.\n\nYour program must:\n- For each case, assemble $\\mathbf{M}$ and $\\mathbf{K}$, compute the full set of mass-normalized modes, determine $\\alpha$ and $\\beta$ for Rayleigh damping (except Case C where $\\alpha=\\beta=0$), assemble $\\mathbf{C}$, and integrate the decoupled modal equations for the retained set and the full set using a consistent Newmark average-acceleration scheme for the given $\\Delta t$ and $T_\\text{end}$.\n- Reconstruct the physical displacement time histories for MDM and MAM using the retained modes only, and compute the reference physical displacement using all modes.\n- Compute the peak absolute $x_3(t)$ (in meters) and the peak absolute $R_\\text{base}(t)=k_1 x_1(t)$ (in newtons) for each of MDM, MAM, and the reference, and then compute the absolute relative errors as specified, rounded to six decimal places.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, for each case A, B, C: the MDM displacement error at $x_3$, the MAM displacement error at $x_3$, the MDM base reaction error, the MAM base reaction error. All values must be decimals rounded to six decimal places. For example, the output format must be\n$$\n[\\varepsilon^\\text{A}_\\text{MDM,disp},\\varepsilon^\\text{A}_\\text{MAM,disp},\\varepsilon^\\text{A}_\\text{MDM,rxn},\\varepsilon^\\text{A}_\\text{MAM,rxn},\\varepsilon^\\text{B}_\\text{MDM,disp},\\dots,\\varepsilon^\\text{C}_\\text{MAM,rxn}]\n$$\nwith exactly $12$ entries and no extra text.", "solution": "The problem presented is a standard, well-posed problem in the field of structural dynamics, specifically addressing modal analysis and model order reduction techniques. All provided data, equations, and conditions are scientifically sound, consistent, and sufficient for a unique solution. The problem is valid.\n\nThe task is to analyze a linear time-invariant structural system and compare two modal truncation methods: the Mode Displacement Method (MDM) and the Mode Acceleration Method (MAM). The system is governed by the second-order matrix ordinary differential equation:\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}}(t) = \\mathbf{f}(t)\n$$\nwith zero initial conditions $\\mathbf{x}(0) = \\mathbf{0}$ and $\\dot{\\mathbf{x}}(0) = \\mathbf{0}$. The matrices $\\mathbf{M}$ and $\\mathbf{K}$ are the symmetric positive-definite mass and stiffness matrices, respectively. The damping matrix $\\mathbf{C}$ is assumed to be of the Rayleigh form, $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$. The external load is a step function $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$.\n\n**1. Derivation of Decoupled Modal Equations**\n\nThe core of modal analysis is to transform the system of coupled physical coordinates $\\mathbf{x}(t)$ into a set of uncoupled generalized (or modal) coordinates $\\mathbf{q}(t)$. This is achieved by solving the undamped free-vibration generalized eigenvalue problem:\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j, \\quad j=1,\\dots,n\n$$\nwhere $\\omega_j$ are the natural circular frequencies and $\\boldsymbol{\\phi}_j$ are the corresponding mode shapes. The mode shapes are orthogonal with respect to both $\\mathbf{M}$ and $\\mathbf{K}$. We enforce mass-normalization, such that:\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij} \\quad (\\text{modal masses are unity})\n$$\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2 \\delta_{ij} \\quad (\\text{modal stiffnesses are } \\omega_j^2)\n$$\nLet $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_n]$ be the modal matrix and $\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2, \\dots, \\omega_n^2)$ be the diagonal matrix of squared frequencies. The coordinate transformation is defined as $\\mathbf{x}(t) = \\boldsymbol{\\Phi}\\,\\mathbf{q}(t)$. Substituting this into the governing equation:\n$$\n\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\mathbf{f}(t)\n$$\nPre-multiplying by $\\boldsymbol{\\Phi}^{\\top}$ and applying the orthogonality properties yields:\n$$\n\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\n$$\n\\mathbf{I}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{\\hat{C}}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Omega}^2\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\nwhere $\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}$ is the modal damping matrix. For Rayleigh damping, $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$, the modal damping matrix becomes diagonal:\n$$\n\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}(\\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K})\\boldsymbol{\\Phi} = \\alpha\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi} + \\beta\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi} = \\alpha\\,\\mathbf{I} + \\beta\\,\\boldsymbol{\\Omega}^2\n$$\nThis results in a set of $n$ uncoupled single-degree-of-freedom (SDOF) equations. For the $j$-th mode, the equation is:\n$$\n\\ddot{q}_j(t) + (\\alpha + \\beta\\,\\omega_j^2)\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)\n$$\nThe term $(\\alpha + \\beta\\,\\omega_j^2)$ is equivalent to $2\\zeta_j\\omega_j$, where $\\zeta_j$ is the modal damping ratio for mode $j$. Thus, $\\zeta_j = \\frac{\\alpha}{2\\omega_j} + \\frac{\\beta\\omega_j}{2}$. For the specified step load, the equation for each modal coordinate becomes:\n$$\n\\ddot{q}_j(t) + 2\\zeta_j\\omega_j\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0, \\quad \\text{for } t  0\n$$\nThe initial conditions transform to $\\mathbf{q}(0) = \\boldsymbol{\\Phi}^{-1}\\mathbf{x}(0) = \\mathbf{0}$ and $\\dot{\\mathbf{q}}(0) = \\boldsymbol{\\Phi}^{-1}\\dot{\\mathbf{x}}(0) = \\mathbf{0}$.\n\n**2. Mode Displacement Method (MDM) vs. Mode Acceleration Method (MAM)**\n\nWhen using a reduced set of $r  n$ modes (typically the ones with the lowest frequencies), we seek an approximation for $\\mathbf{x}(t)$.\n\n**Mode Displacement Method (MDM):** This method directly truncates the modal series expansion for displacement. The approximate physical displacement is reconstructed solely from the $r$ retained modal coordinates:\n$$\n\\mathbf{x}_\\text{MDM}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) = \\boldsymbol{\\Phi}_r \\mathbf{q}_r(t)\n$$\nwhere $\\boldsymbol{\\Phi}_r = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_r]$ and $\\mathbf{q}_r(t) = [q_1(t), \\dots, q_r(t)]^\\top$. The modal coordinates $q_j(t)$ for $j=1, \\dots, r$ are obtained by integrating their respective SDOF equations.\n\n**Mode Acceleration Method (MAM):** This method provides an improved approximation by including a static correction for the contribution of the truncated higher modes. We start by recasting the governing equation to express displacement statically:\n$$\n\\mathbf{x}(t) = \\mathbf{K}^{-1}[\\mathbf{f}(t) - \\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) - \\mathbf{C}\\,\\dot{\\mathbf{x}}(t)]\n$$\nThe term $\\mathbf{K}^{-1}\\mathbf{f}(t)$ is the pseudo-static response. The other terms represent the dynamic correction from inertia and damping forces. The key insight of MAM is to approximate these dynamic forces using only the retained $r$ modes.\n$$\n\\ddot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\ddot{q}_j(t), \\quad \\dot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\dot{q}_j(t)\n$$\nSubstituting these approximations and the modal equations of motion, $\\ddot{q}_j = p_j(t) - c_j\\dot{q}_j - k_j q_j$ where $p_j(t) = \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$, $c_j=2\\zeta_j\\omega_j$, $k_j=\\omega_j^2$, we can derive a more convenient form. A clearer derivation is to observe that the full displacement is $\\mathbf{x}(t) = \\sum_{j=1}^n \\boldsymbol{\\phi}_j q_j(t)$. We split this into retained and truncated parts:\n$$\n\\mathbf{x}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j q_j(t)\n$$\nMAM approximates the contribution of the high-frequency truncated modes ($j  r$) by their static response. From the modal equation, neglecting inertial and damping terms for high-frequency modes gives $\\omega_j^2 q_j(t) \\approx \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$, so $q_j(t) \\approx \\frac{\\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)}{\\omega_j^2}$. The MAM displacement is thus:\n$$\n\\mathbf{x}_\\text{MAM}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\nThe second term is the static response of the truncated modes. This can be expressed as the difference between the total static response and the static response of the retained modes:\n$$\n\\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2} = \\mathbf{K}^{-1}\\mathbf{f}(t) - \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\nSubstituting this back, we obtain the final expression for the MAM displacement for a step load $\\mathbf{f}(t) = \\mathbf{f}_0 H(t)$:\n$$\n\\mathbf{x}_\\text{MAM}(t) = \\mathbf{K}^{-1}\\mathbf{f}_0 + \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\left( q_j(t) - \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0}{\\omega_j^2} \\right)\n$$\nHere, $q_j(t)$ is the full dynamic solution for the $j$-th modal coordinate, and the term subtracted is its static component. This formulation replaces the dynamic response of higher modes with their static response, which is often a significant improvement, especially for recovering internal forces and reactions.\n\n**3. Numerical Integration**\n\nThe SDOF modal equations are integrated numerically using the Newmark average-acceleration method. For this method, the parameters are $\\gamma = 1/2$ and $\\beta_{NM} = 1/4$. It is unconditionally stable for linear systems and second-order accurate. At each time step $t_{i+1} = t_i + \\Delta t$, for each mode $j$, given $(q_{j,i}, \\dot{q}_{j,i}, \\ddot{q}_{j,i})$, we solve for $(q_{j,i+1}, \\dot{q}_{j,i+1}, \\ddot{q}_{j,i+1})$. With initial conditions $q_j(0)=0, \\dot{q}_j(0)=0$, the initial acceleration is $\\ddot{q}_j(0) = \\boldsymbol{\\phi}_j^\\top\\mathbf{f}_0$. The update proceeds for each time step until $T_\\text{end}$.\n\n**4. Quantities of Interest and Error Metric**\n\nFor each reconstruction method (MDM, MAM) and the full-modal reference solution, we compute the time history of the physical displacements $\\mathbf{x}(t)$. From this, we extract two quantities:\n- The displacement at the top degree of freedom, $x_3(t)$.\n- The base reaction force, $R_\\text{base}(t) = k_1 x_1(t)$.\n\nFor each quantity, we find its peak absolute value over the time history. The absolute relative error $\\varepsilon$ of an approximate method (MDM or MAM) is then computed with respect to the reference solution (using all $n$ modes) as:\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|\n$$\nThe following program implements this procedure for the specified test suite.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for MDM vs. MAM comparison.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.0e6, 1.5e6, 1.0e6),\n            \"f0\": np.array([0.0, 0.0, 10000.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 1.2,\n            \"dt\": 5.0e-4,\n        },\n        {\n            \"name\": \"Case B\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (5.0e6, 5.0e6, 5.0e6),\n            \"f0\": np.array([5000.0, 0.0, 0.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 0.6,\n            \"dt\": 2.0e-4,\n        },\n        {\n            \"name\": \"Case C\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.5e6, 1.8e6, 1.2e6),\n            \"f0\": np.array([0.0, 8000.0, 0.0]),\n            \"r\": 2,\n            \"zetas\": (0.0, 0.0),\n            \"Tend\": 1.0,\n            \"dt\": 4.0e-4,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = _solve_case(**case)\n        all_results.extend(results)\n\n    # Format the final output as specified.\n    print(f\"[{','.join([f'{r:.6f}' for r in all_results])}]\")\n\n\ndef _solve_case(name, M_diag, k_vals, f0, r, zetas, Tend, dt):\n    \"\"\"\n    Solves a single test case for the modal analysis comparison.\n    \"\"\"\n    n = len(M_diag)\n    M = np.diag(M_diag)\n    k1, k2, k3 = k_vals\n    K = np.array([\n        [k1 + k2, -k2, 0],\n        [-k2, k2 + k3, -k3],\n        [0, -k3, k3]\n    ])\n\n    # 1. Solve the generalized eigenvalue problem K*phi = omega^2*M*phi\n    eigvals, eigvecs = eigh(K, M)\n    omega = np.sqrt(eigvals)\n    \n    # 2. Mass-normalize the eigenvectors\n    Phi = np.zeros_like(eigvecs)\n    for j in range(n):\n        phi_j_un = eigvecs[:, j]\n        norm_factor = np.sqrt(phi_j_un.T @ M @ phi_j_un)\n        Phi[:, j] = phi_j_un / norm_factor\n\n    # 3. Determine Rayleigh damping coefficients alpha and beta\n    zeta_a, zeta_b = zetas\n    if zeta_a == 0.0 and zeta_b == 0.0:\n        alpha, beta = 0.0, 0.0\n    else:\n        # Calibrate using modes 1 and 3 (indices 0 and 2)\n        omega_a, omega_b = omega[0], omega[2]\n        A = np.array([[1, omega_a**2], [1, omega_b**2]])\n        b_vec = np.array([2 * zeta_a * omega_a, 2 * zeta_b * omega_b])\n        alpha, beta = np.linalg.solve(A, b_vec)\n    \n    # 4. Calculate modal damping ratios and modal forces\n    modal_zeta = (alpha / (2 * omega)) + (beta * omega / 2)\n    modal_forces = Phi.T @ f0\n\n    # 5. Time integration using Newmark's average-acceleration method\n    time_steps = np.arange(0, Tend + dt/2, dt)\n    num_steps = len(time_steps)\n    \n    q = np.zeros((n, num_steps))\n    q_dot = np.zeros((n, num_steps))\n    q_ddot = np.zeros((n, num_steps))\n\n    # Initial conditions: q(0) = 0, q_dot(0) = 0\n    # From EOM at t=0: M*q_ddot + C*q_dot + K*q = F => 1*q_ddot(0) = p\n    q_ddot[:, 0] = modal_forces\n\n    gamma_nm, beta_nm = 0.5, 0.25\n\n    for j in range(n):\n        c_j = 2 * modal_zeta[j] * omega[j]\n        k_j = omega[j]**2\n        p_j = modal_forces[j]\n        \n        # Pre-calculate constant denominator for acceleration update\n        denom = 1 + c_j * gamma_nm * dt + k_j * beta_nm * dt**2\n        \n        for i in range(num_steps - 1):\n            # Predictors (for average acceleration method)\n            q_pred = q[j, i] + dt * q_dot[j, i] + (dt**2 / 4) * q_ddot[j, i]\n            q_dot_pred = q_dot[j, i] + (dt / 2) * q_ddot[j, i]\n            \n            # Solve for acceleration at t_{i+1}\n            q_ddot[j, i+1] = (p_j - c_j * q_dot_pred - k_j * q_pred) / denom\n            \n            # Correctors\n            q_dot[j, i+1] = q_dot_pred + gamma_nm * dt * q_ddot[j, i+1]\n            q[j, i+1] = q_pred + beta_nm * dt**2 * q_ddot[j, i+1]\n\n    # 6. Reconstruct physical responses\n    # Reference solution (all modes)\n    x_ref = Phi @ q\n\n    # MDM solution (r modes)\n    Phi_r = Phi[:, :r]\n    q_r = q[:r, :]\n    x_mdm = Phi_r @ q_r\n\n    # MAM solution (r modes)\n    K_inv_f0 = np.linalg.solve(K, f0).reshape(-1, 1)\n    mam_dynamic_part = np.zeros((n, num_steps))\n    for j in range(r):\n        q_j_static = modal_forces[j] / omega[j]**2\n        mam_dynamic_part += Phi[:, j:j+1] @ (q_r[j:j+1, :] - q_j_static)\n    x_mam = K_inv_f0 + mam_dynamic_part\n\n    # 7. Calculate peak values and relative errors\n    # Peak displacement at x3 (DOF 3, index 2)\n    peak_x3_ref = np.max(np.abs(x_ref[2, :]))\n    peak_x3_mdm = np.max(np.abs(x_mdm[2, :]))\n    peak_x3_mam = np.max(np.abs(x_mam[2, :]))\n\n    err_disp_mdm = abs(peak_x3_mdm / peak_x3_ref - 1)\n    err_disp_mam = abs(peak_x3_mam / peak_x3_ref - 1)\n\n    # Peak base reaction R_base = k1 * x1 (DOF 1, index 0)\n    R_ref = k1 * x_ref[0, :]\n    R_mdm = k1 * x_mdm[0, :]\n    R_mam = k1 * x_mam[0, :]\n\n    peak_R_ref = np.max(np.abs(R_ref))\n    peak_R_mdm = np.max(np.abs(R_mdm))\n    peak_R_mam = np.max(np.abs(R_mam))\n\n    err_rxn_mdm = abs(peak_R_mdm / peak_R_ref - 1)\n    err_rxn_mam = abs(peak_R_mam / peak_R_ref - 1)\n\n    return [err_disp_mdm, err_disp_mam, err_rxn_mdm, err_rxn_mam]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2578761"}]}