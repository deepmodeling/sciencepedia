{"hands_on_practices": [{"introduction": "Understanding the Courant-Friedrichs-Lewy (CFL) condition is fundamental to using explicit time integration methods. This first practice guides you through a first-principles derivation of the maximum stable time step, $\\Delta t_{\\max}$, for the 1D wave equation discretized with linear finite elements [@problem_id:2557114]. By performing a modal analysis on the semi-discrete system, you will directly connect the stability limit to the physical properties of the system—element size $h$ and wave speed $c$—revealing the core principle that information cannot travel more than one element per time step.", "problem": "A straight, homogeneous elastic bar of length $L$ and constant cross-sectional area $A$ is modeled in one spatial dimension by linear elasticity in small strains. Let $E$ denote Young’s modulus and $\\rho$ the mass density. The governing partial differential equation for the axial displacement $u(x,t)$ is the linear wave equation derived from Newton’s second law and Hooke’s law, with wave speed $c=\\sqrt{E/\\rho}$. Consider a finite element semi-discretization of the bar using $N$ uniform two-node linear elements of size $h=L/N$, with mass lumping (row-sum diagonalization of the consistent mass) on a uniform mesh and periodic boundary conditions to eliminate boundary artifacts. The semi-discrete equations have the form $M \\ddot{\\mathbf{u}}(t) + K \\mathbf{u}(t) = \\mathbf{0}$, where $M$ is diagonal.\n\nTime integration is performed by the explicit central difference scheme (also known as the leap-frog method). The stability of this explicit scheme is controlled by the Courant–Friedrichs–Lewy (CFL) condition, which depends on the largest natural frequency of the semi-discrete system and hence on the spatial discretization.\n\nStarting from first principles (Newton’s second law and the finite element semi-discrete model) and a modal (Fourier) analysis of the resulting uniform lattice, derive the expression for the largest stable time step $\\Delta t_{\\max}$ for the explicit central difference method in terms of $h$, $E$, and $\\rho$. Then, using the derived expression, compute the numerical value of $\\Delta t_{\\max}$ for the data\n- $E = 210 \\times 10^{9}$,\n- $\\rho = 7800$,\n- $L = 1$,\n- $N = 100$,\nand express your final numerical answer in seconds. Round your answer to four significant figures.", "solution": "The problem requires the derivation of the stability limit for the explicit central difference time integration scheme applied to a finite element semi-discretization of a one-dimensional elastic bar. This represents a classic problem in computational wave propagation. The validation of the problem statement has been performed and it is found to be scientifically grounded, well-posed, and objective. There are no flaws. We proceed with a formal derivation.\n\nThe governing equation for the axial displacement $u(x,t)$ is the wave equation:\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwhere the wave speed $c$ is given by $c = \\sqrt{E/\\rho}$, with $E$ being Young's modulus and $\\rho$ the mass density.\n\nThe spatial domain is discretized using $N$ uniform linear two-node finite elements of length $h = L/N$. The semi-discrete system of ordinary differential equations has the form $M \\ddot{\\mathbf{u}}(t) + K \\mathbf{u}(t) = \\mathbf{0}$. We must first construct the mass matrix $M$ and stiffness matrix $K$ for a representative node in the uniform mesh with periodic boundary conditions.\n\nFor a single linear bar element of length $h$, the element stiffness matrix $k^e$ and consistent mass matrix are given by:\n$$\nk^e = \\frac{AE}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}, \\quad m^e_{\\text{consistent}} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\nThe problem specifies mass lumping via row-sum diagonalization. The lumped element mass matrix $m^e$ is therefore:\n$$\nm^e = \\frac{\\rho A h}{6} \\begin{pmatrix} 2+1 & 0 \\\\ 0 & 1+2 \\end{pmatrix} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\nConsider a generic node $j$. It connects two elements: element $(j-1, j)$ and element $(j, j+1)$. Due to the periodic boundary conditions, all nodes are topologically equivalent. The equation of motion for the displacement $u_j$ of node $j$ is assembled from the contributions of these two elements.\n\nThe mass associated with node $j$, $M_{jj}$, is the sum of contributions from the two adjacent elements:\n$$\nM_{jj} = \\frac{\\rho A h}{2} + \\frac{\\rho A h}{2} = \\rho A h\n$$\nSince the lumped mass matrix $M$ is diagonal, the mass term in the equation for node $j$ is simply $M_{jj} \\ddot{u}_j = (\\rho A h) \\ddot{u}_j$.\n\nThe stiffness term for node $j$, $(K\\mathbf{u})_j$, is assembled from the element stiffness matrices. The force on node $j$ depends on its own displacement $u_j$ and the displacements of its neighbors, $u_{j-1}$ and $u_{j+1}$.\n$$\n(K\\mathbf{u})_j = \\left(\\frac{AE}{h}\\right) [u_j - u_{j+1}] + \\left(\\frac{AE}{h}\\right) [u_j - u_{j-1}] = \\frac{AE}{h} (-u_{j-1} + 2u_j - u_{j+1})\n$$\nCombining these terms, the equation of motion for node $j$ becomes:\n$$\n(\\rho A h) \\ddot{u}_j + \\frac{AE}{h} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\nDividing by $\\rho A h$ gives:\n$$\n\\ddot{u}_j + \\frac{E}{\\rho h^2} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\nSubstituting $c^2 = E/\\rho$, we get the discrete lattice equation:\n$$\n\\ddot{u}_j + \\frac{c^2}{h^2} (-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\nThis is a finite difference approximation of the original partial differential equation.\n\nTo find the natural frequencies of this semi-discrete system, we perform a modal analysis by positing a discrete wave solution (a Fourier mode) of the form:\n$$\nu_j(t) = \\hat{u} \\exp(i(\\omega t - k x_j)) = \\hat{u} \\exp(i(\\omega t - k j h))\n$$\nwhere $\\omega$ is the angular frequency, $k$ is the wave number, $x_j=jh$ is the position of node $j$, and $\\hat{u}$ is the amplitude. The temporal derivatives are $\\dot{u}_j = i\\omega u_j$ and $\\ddot{u}_j = -\\omega^2 u_j$. The spatial relationships are $u_{j-1} = u_j \\exp(ikh)$ and $u_{j+1} = u_j \\exp(-ikh)$.\n\nSubstituting these into the lattice equation yields the dispersion relation:\n$$\n-\\omega^2 u_j + \\frac{c^2}{h^2} (-u_j \\exp(ikh) + 2u_j - u_j \\exp(-ikh)) = 0\n$$\nDividing by $u_j$ (which is non-zero):\n$$\n-\\omega^2 + \\frac{c^2}{h^2} (2 - (\\exp(ikh) + \\exp(-ikh))) = 0\n$$\nUsing Euler's identity, $2\\cos(kh) = \\exp(ikh) + \\exp(-ikh)$, we find:\n$$\n\\omega^2 = \\frac{2c^2}{h^2} (1 - \\cos(kh))\n$$\nApplying the half-angle trigonometric identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\n\\omega^2(k) = \\frac{4c^2}{h^2} \\sin^2\\left(\\frac{kh}{2}\\right)\n$$\nThe angular frequency is thus a function of the wave number $k$:\n$$\n\\omega(k) = \\frac{2c}{h} \\left| \\sin\\left(\\frac{kh}{2}\\right) \\right|\n$$\nThe stability of the explicit central difference scheme is governed by the highest natural frequency of the discrete system, $\\omega_{\\max}$. This maximum frequency occurs when the term $|\\sin(kh/2)|$ reaches its maximum value of $1$. This corresponds to the shortest wavelength that the discrete mesh can resolve, $\\lambda_{\\min} = 2h$, for which the wave number is $k_{\\max} = \\pi/h$. For this value, the argument of the sine function is $k_{\\max}h/2 = \\pi/2$.\n\nThus, the maximum natural frequency is:\n$$\n\\omega_{\\max} = \\frac{2c}{h} \\left| \\sin\\left(\\frac{\\pi}{2}\\right) \\right| = \\frac{2c}{h}\n$$\nThe stability condition for the central difference (leap-frog) method applied to a system of harmonic oscillators is $\\Delta t \\le 2/\\omega_{\\max}$. Therefore, the maximum stable time step $\\Delta t_{\\max}$ is:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\omega_{\\max}} = \\frac{2}{2c/h} = \\frac{h}{c}\n$$\nSubstituting $c = \\sqrt{E/\\rho}$, we obtain the final expression for the maximum stable time step in terms of the required parameters:\n$$\n\\Delta t_{\\max} = \\frac{h}{\\sqrt{E/\\rho}} = h \\sqrt{\\frac{\\rho}{E}}\n$$\nThis is the Courant–Friedrichs–Lewy (CFL) condition for this specific numerical scheme.\n\nWe now compute the numerical value using the provided data:\n$E = 210 \\times 10^{9} \\, \\text{Pa}$\n$\\rho = 7800 \\, \\text{kg}/\\text{m}^3$\n$L = 1 \\, \\text{m}$\n$N = 100$\n\nFirst, we calculate the element size $h$ and the wave speed $c$.\n$$\nh = \\frac{L}{N} = \\frac{1}{100} = 0.01 \\, \\text{m}\n$$\n$$\nc = \\sqrt{\\frac{E}{\\rho}} = \\sqrt{\\frac{210 \\times 10^{9}}{7800}} \\approx 5188.745 \\, \\text{m/s}\n$$\nNow, we calculate the maximum stable time step $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{h}{c} = \\frac{0.01}{\\sqrt{\\frac{210 \\times 10^{9}}{7800}}} \\approx \\frac{0.01}{5188.745} \\approx 1.92725 \\times 10^{-6} \\, \\text{s}\n$$\nRounding the result to four significant figures as required:\n$$\n\\Delta t_{\\max} \\approx 1.927 \\times 10^{-6} \\, \\text{s}\n$$\nThis completes the derivation and calculation.", "answer": "$$\\boxed{1.927 \\times 10^{-6}}$$", "id": "2557114"}, {"introduction": "While theoretical derivations are essential, verifying them through numerical experiment provides invaluable intuition and confidence. This practice challenges you to implement a simulation to witness the CFL stability boundary firsthand [@problem_id:2557116]. By running tests with time steps slightly below, at, and above the critical limit, you will observe the dramatic difference between a stable, bounded solution and an unstable, exponentially growing one, solidifying your understanding of conditional stability.", "problem": "Consider the one-dimensional linear elastic wave equation on the interval $\\left(0,L\\right)$ with homogeneous Dirichlet boundary conditions at both ends and no external forcing. Let $u\\left(x,t\\right)$ denote the axial displacement, $\\rho$ the mass density, $E$ the Young’s modulus, and $A$ the cross-sectional area. The strong form is\n$$\n\\rho A\\,\\frac{\\partial^2 u}{\\partial t^2} - \\frac{\\partial}{\\partial x}\\left(EA\\,\\frac{\\partial u}{\\partial x}\\right) = 0,\\quad x\\in\\left(0,L\\right),\\ t>0,\\quad u\\left(0,t\\right)=u\\left(L,t\\right)=0.\n$$\nLet the wave speed be $c=\\sqrt{E/\\rho}$.\n\nUsing the standard Galerkin finite element method with uniform meshes of $N_e$ two-node linear elements and a mass-lumped approximation, the semi-discrete system has the form\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\nwhere $\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ is diagonal positive definite after eliminating the boundary degrees of freedom, $\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ is symmetric positive definite, and $n=N_e-1$ is the number of interior degrees of freedom. Consider the explicit central difference time integration defined on a uniform time grid with time step $\\Delta t$ by\n$$\n\\mathbf{u}^{k+1} = 2\\mathbf{u}^k - \\mathbf{u}^{k-1} - \\Delta t^2\\,\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^k,\\quad k\\geq 1,\n$$\nwith the first step computed via\n$$\n\\mathbf{u}^1 = \\mathbf{u}^0 + \\Delta t\\,\\dot{\\mathbf{u}}^0 + \\frac{\\Delta t^2}{2}\\,\\ddot{\\mathbf{u}}^0,\\quad \\ddot{\\mathbf{u}}^0 = -\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^0.\n$$\n\nYour task is to verify the Courant–Friedrichs–Lewy (CFL) stability bound for the explicit central difference scheme using canonical problems constructed from the above one-dimensional model. Start from the fundamental definitions of the semi-discrete system and the explicit scheme and determine the maximum stable time step implied by the spectral properties of the undamped, unforced discrete system. Then, for each test case, compute:\n- the critical time step $\\Delta t_{\\text{crit}}$ in seconds,\n- the ratio $r=\\Delta t/\\Delta t_{\\text{crit}}$ (dimensionless),\n- a predicted stability flag $\\in\\{0,1\\}$ obtained solely from the theoretical stability condition,\n- an observed stability flag $\\in\\{0,1\\}$ obtained from a direct simulation using the explicit central difference scheme.\n\nFor the observed stability, use the following canonical initial condition to create a worst-case scenario: set the initial displacement $\\mathbf{u}^0$ proportional to the discrete eigenvector associated with the largest generalized eigenvalue of the pair $\\left(\\mathbf{K},\\mathbf{M}\\right)$ (i.e., the highest discrete frequency mode), normalized to unit $\\mathbf{M}$-norm, and set the initial velocity $\\dot{\\mathbf{u}}^0=\\mathbf{0}$. Evolve the scheme for a specified number of time steps and declare the run “observed stable” if the maximum $\\mathbf{M}$-norm of the displacement over the simulated time does not exceed a prescribed threshold multiple of the initial $\\mathbf{M}$-norm. Use a threshold factor equal to $20$ (dimensionless). All physical quantities must be expressed in the International System of Units: meters for $L$, seconds for time, and meters per second for $c$. Report $\\Delta t_{\\text{crit}}$ in seconds.\n\nImplement the following test suite. In all cases, take $A=1$ (square meter), $E=1$ (Pascal), and choose $\\rho=E/c^2$ so that the wave speed is exactly $c$. Apply homogeneous Dirichlet boundary conditions at $x=0$ and $x=L$. For each case, construct the uniform mesh, assemble $\\mathbf{K}$ and the lumped $\\mathbf{M}$, compute the discrete spectrum to determine the critical time step, choose $\\Delta t$ as instructed, and simulate for the prescribed number of steps.\n\n- Case $\\left(1\\right)$: $L=1$ (meter), $N_e=80$, $c=200$ (meter per second), choose $\\Delta t=0.8\\,\\Delta t_{\\text{crit}}$, and simulate for $4000$ time steps.\n- Case $\\left(2\\right)$: $L=1$ (meter), $N_e=80$, $c=200$ (meter per second), choose $\\Delta t=1.0\\,\\Delta t_{\\text{crit}}$, and simulate for $2000$ time steps.\n- Case $\\left(3\\right)$: $L=1$ (meter), $N_e=80$, $c=200$ (meter per second), choose $\\Delta t=1.05\\,\\Delta t_{\\text{crit}}$, and simulate for $800$ time steps.\n- Case $\\left(4\\right)$: $L=1$ (meter), $N_e=160$, $c=200$ (meter per second), choose $\\Delta t=0.8\\,\\Delta t_{\\text{crit}}$, and simulate for $4000$ time steps.\n\nYour program must:\n- assemble $\\mathbf{K}$ and $\\mathbf{M}$ for a uniform mesh of two-node linear elements,\n- apply the Dirichlet boundary conditions by eliminating the boundary degrees of freedom,\n- compute the largest generalized eigenvalue of $\\left(\\mathbf{K},\\mathbf{M}\\right)$ and hence the corresponding highest discrete angular frequency,\n- determine the theoretical critical time step and the predicted stability flag,\n- construct the highest-frequency eigenvector and normalize it to unit $\\mathbf{M}$-norm,\n- run the explicit central difference scheme for the specified number of steps with initial velocity equal to zero,\n- compute the maximum displacement $\\mathbf{M}$-norm during the run and determine the observed stability flag using the threshold factor equal to $20$.\n\nNumerical outputs to be produced for each case must be:\n- $\\Delta t_{\\text{crit}}$ in seconds (as a floating-point number),\n- $r=\\Delta t/\\Delta t_{\\text{crit}}$ (as a floating-point number),\n- predicted stability flag, with value $1$ if theoretically stable and $0$ otherwise,\n- observed stability flag, with value $1$ if the simulation is observed stable and $0$ otherwise.\n\nFinal output format: Your program should produce a single line of output containing a Python-style list of four lists (one per test case), where each inner list is of the form $\\left[\\Delta t_{\\text{crit}}, r, \\text{predicted}, \\text{observed}\\right]$. For example, the output should look like\n$$\n\\left[\\left[d_1,r_1,p_1,o_1\\right],\\left[d_2,r_2,p_2,o_2\\right],\\left[d_3,r_3,p_3,o_3\\right],\\left[d_4,r_4,p_4,o_4\\right]\\right],\n$$\nwith each $d_i$ in seconds and each $r_i$, $p_i$, $o_i$ dimensionless. The program must be entirely self-contained and must not read any input.", "solution": "The problem requires the verification of the Courant–Friedrichs–Lewy (CFL) stability condition for the explicit central difference time integration scheme applied to a one-dimensional wave equation discretized by the finite element method. The solution is developed through a systematic, principle-based approach.\n\nFirst, we establish the theoretical stability criterion. The semi-discrete system is given by the undamped, unforced system of ordinary differential equations $\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$. The explicit central difference scheme for this system is\n$$\n\\mathbf{u}^{k+1} = 2\\mathbf{u}^k - \\mathbf{u}^{k-1} - \\Delta t^2\\,\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^k.\n$$\nTo analyze the stability of this scheme, we consider a single mode of oscillation, where the displacement vector is of the form $\\mathbf{u}(t) = \\mathbf{v}\\,e^{i\\omega t}$. Substituting this into the semi-discrete equation yields the generalized eigenvalue problem $\\mathbf{K}\\mathbf{v} = \\omega^2\\mathbf{M}\\mathbf{v}$, where $\\omega$ is a natural angular frequency of the discrete system and $\\mathbf{v}$ is the corresponding mode shape. Let $\\lambda = \\omega^2$ be an eigenvalue. We seek a numerical solution of the form $\\mathbf{u}^k = g^k\\mathbf{v}$, where $g$ is a complex amplification factor. Substituting this into the difference equation leads to a characteristic quadratic equation for $g$:\n$$\ng^2 - (2 - \\Delta t^2 \\lambda)g + 1 = 0.\n$$\nFor the scheme to be stable, the magnitude of the roots of this equation must not exceed one, i.e., $|g| \\le 1$. This condition is met if the roots are complex conjugates, which requires the discriminant of the quadratic equation to be non-positive:\n$$\n(2 - \\Delta t^2 \\lambda)^2 - 4 \\le 0.\n$$\nThis inequality simplifies to $-2 \\le 2 - \\Delta t^2 \\lambda \\le 2$, which in turn gives $0 \\le \\Delta t^2 \\lambda \\le 4$, or $\\Delta t \\sqrt{\\lambda} \\le 2$. Since this must hold for all modes of the system, the stability is governed by the mode with the highest frequency, $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$. The stability condition, also known as the CFL condition for this scheme, is therefore:\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}} = \\frac{2}{\\sqrt{\\lambda_{\\max}}}.\n$$\nThe critical time step is the maximum permissible time step, $\\Delta t_{\\text{crit}} = 2/\\omega_{\\max}$. A time step $\\Delta t > \\Delta t_{\\text{crit}}$ will lead to exponential growth of the numerical solution for the highest frequency mode, resulting in instability. The theoretically predicted stability flag is $1$ if the ratio $r = \\Delta t/\\Delta t_{\\text{crit}} \\le 1$ and $0$ otherwise.\n\nNext, we construct the system matrices $\\mathbf{M}$ and $\\mathbf{K}$ using the finite element method. The domain of length $L$ is discretized into $N_e$ uniform two-node linear elements, each of length $h = L/N_e$. For an element with Young's modulus $E$, cross-sectional area $A$, and mass density $\\rho$, the element stiffness matrix $\\mathbf{k}^e$ and lumped mass matrix $\\mathbf{m}^e$ are:\n$$\n\\mathbf{k}^e = \\frac{EA}{h}\n\\begin{pmatrix}\n1 & -1 \\\\\n-1 & 1\n\\end{pmatrix}, \\quad\n\\mathbf{m}^e = \\frac{\\rho A h}{2}\n\\begin{pmatrix}\n1 & 0 \\\\\n0 & 1\n\\end{pmatrix}.\n$$\nThe global matrices for the entire mesh are assembled by summing the contributions from each element. The homogeneous Dirichlet boundary conditions, $u(0,t)=u(L,t)=0$, are enforced by eliminating the rows and columns corresponding to the boundary nodes (node $0$ and node $N_e$). This results in reduced system matrices $\\mathbf{K}$ and $\\mathbf{M}$ of size $n \\times n$, where $n = N_e-1$ is the number of interior, free degrees of freedom. The resulting mass matrix $\\mathbf{M}$ is diagonal with entries $M_{ii} = \\rho A h$, and the stiffness matrix $\\mathbf{K}$ is symmetric and tridiagonal.\n\nThe core of the numerical task is to find the largest eigenvalue $\\lambda_{\\max}$ of the generalized eigenvalue problem $\\mathbf{K}\\mathbf{v} = \\lambda\\mathbf{M}\\mathbf{v}$. This is accomplished using a numerical eigenvalue solver. With $\\lambda_{\\max}$ known, we compute $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}}$ and $\\Delta t_{\\text{crit}} = 2/\\omega_{\\max}$.\n\nFinally, to observe the stability empirically, we perform a direct time integration. To create a worst-case scenario that maximally excites the potentially unstable mode, the initial displacement $\\mathbf{u}^0$ is set to the eigenvector $\\mathbf{v}_{\\max}$ corresponding to $\\lambda_{\\max}$. This eigenvector is scaled to have a unit $\\mathbf{M}$-norm, i.e., $\\|\\mathbf{u}^0\\|_{\\mathbf{M}} = \\sqrt{(\\mathbf{u}^0)^T\\mathbf{M}\\mathbf{u}^0} = 1$. The initial velocity is set to zero, $\\dot{\\mathbf{u}}^0 = \\mathbf{0}$. The time evolution is computed using the central difference scheme, starting with the special first step:\n$$\n\\mathbf{u}^1 = \\mathbf{u}^0 - \\frac{\\Delta t^2}{2}\\mathbf{M}^{-1}\\mathbf{K}\\,\\mathbf{u}^0.\n$$\nDuring the simulation over a specified number of steps, we monitor the $\\mathbf{M}$-norm of the displacement, $\\|\\mathbf{u}^k\\|_{\\mathbf{M}}$. The simulation is declared \"observed stable\" (flag $1$) if the maximum observed norm does not exceed a given threshold multiple of the initial norm (here, a factor of $20$). If the norm exceeds this threshold, the simulation is declared unstable (flag $0$). This generous threshold easily distinguishes between the bounded response of a stable run and the exponential growth of an unstable one. This procedure is repeated for each test case specified in the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for CFL stability verification.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, Ne, c, r_target, num_steps)\n        (1.0, 80, 200.0, 0.8, 4000),\n        (1.0, 80, 200.0, 1.0, 2000),\n        (1.0, 80, 200.0, 1.05, 800),\n        (1.0, 160, 200.0, 0.8, 4000),\n    ]\n\n    stability_threshold_factor = 20.0\n    results = []\n\n    for case in test_cases:\n        L, Ne, c, r_target, num_steps = case\n        \n        # Setup physical and mesh parameters\n        E = 1.0\n        A = 1.0\n        rho = E / c**2\n        h = L / Ne\n        n_dof = Ne - 1\n\n        # Assemble stiffness (K) and lumped mass (M) matrices for interior DOFs\n        \n        # M is a diagonal matrix, stored as a 1D array of its diagonal entries\n        # M_ii = rho * A * h for each of the n_dof interior nodes\n        M_diag = np.full(n_dof, rho * A * h)\n        \n        # K is a tridiagonal matrix\n        # Diagonal entries: 2*E*A/h\n        # Off-diagonal entries: -E*A/h\n        main_diag_K = np.full(n_dof, 2 * E * A / h)\n        off_diag_K = np.full(n_dof - 1, -E * A / h)\n        K = np.diag(main_diag_K) + np.diag(off_diag_K, k=1) + np.diag(off_diag_K, k=-1)\n\n        # Solve the generalized eigenvalue problem: K v = lambda M v\n        # Using scipy.linalg.eigh for symmetric matrices. We pass M as a full diagonal matrix.\n        eigenvalues, eigenvectors = eigh(K, np.diag(M_diag))\n        \n        # The largest eigenvalue determines the stability limit\n        lambda_max = eigenvalues[-1]\n        \n        # The highest discrete angular frequency\n        omega_max = np.sqrt(lambda_max)\n        \n        # Compute the theoretical critical time step\n        dt_crit = 2.0 / omega_max\n\n        # --- Predicted Stability ---\n        # The chosen time step for the simulation\n        dt = r_target * dt_crit\n        # Predicted stability flag is 1 if dt = dt_crit (i.e., r_target = 1.0)\n        predicted_stability = 1 if r_target = 1.0 else 0\n        \n        # --- Observed Stability Simulation ---\n        # Set initial conditions based on the highest frequency mode\n        # The eigenvector corresponding to lambda_max\n        v_max = eigenvectors[:, -1]\n        \n        # Normalize the initial displacement vector u0 to have unit M-norm\n        m_norm_v_max_sq = v_max.T @ (M_diag * v_max)  # M is diagonal\n        u0 = v_max / np.sqrt(m_norm_v_max_sq)\n        \n        # Initial velocity is zero\n        udot0 = np.zeros(n_dof)\n\n        # Pre-calculate matrix for the update step to save computation\n        # Since M is diagonal, its inverse is simple\n        inv_M_diag = 1.0 / M_diag\n        C = dt**2 * (inv_M_diag[:, np.newaxis] * K) # Efficient since inv_M is diagonal\n\n        # First step of central difference scheme (special formula)\n        ddot0 = -(inv_M_diag * (K @ u0))\n        u1 = u0 + dt * udot0 + (dt**2 / 2.0) * ddot0\n        \n        u_prev = u0\n        u_curr = u1\n        \n        # Initial M-norm is 1 by normalization\n        max_m_norm_u = 1.0\n\n        # Main time-stepping loop\n        for k in range(1, num_steps):\n            # Central difference update\n            u_next = 2 * u_curr - u_prev - C @ u_curr\n            \n            u_prev, u_curr = u_curr, u_next\n            \n            # Calculate M-norm of the current displacement\n            current_m_norm_u = np.sqrt(u_curr.T @ (M_diag * u_curr))\n            \n            if current_m_norm_u > max_m_norm_u:\n                max_m_norm_u = current_m_norm_u\n            \n            # Early exit if solution has clearly blown up to avoid overflow/wasted computation\n            if not np.isfinite(max_m_norm_u) or max_m_norm_u > stability_threshold_factor * 10:\n                break\n        \n        # Determine observed stability based on the specified threshold\n        observed_stability = 1 if max_m_norm_u = stability_threshold_factor else 0\n        \n        # Store results for this case\n        results.append([dt_crit, r_target, predicted_stability, observed_stability])\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```", "id": "2557116"}, {"introduction": "In many real-world engineering applications, material behavior is nonlinear, meaning the stiffness and thus the wave propagation speed are not constant. This advanced exercise extends the CFL concept to such scenarios, requiring you to implement an adaptive time-stepping scheme for a bar with a nonlinear stress-strain law [@problem_id:2557122]. This practice demonstrates how to maintain stability in a dynamic environment where the critical time step must be re-evaluated continuously, a key technique in modern explicit dynamics codes.", "problem": "Consider the one-dimensional small-strain elastodynamic initial boundary value problem on a uniform bar of length $L$ and constant cross-sectional area $A$, with mass density $\\rho$. The unknown displacement field $u(x,t)$ satisfies the balance of linear momentum in one spatial dimension with no body forces, together with a nonlinear constitutive relation between stress $\\sigma$ and strain $\\varepsilon=\\partial u/\\partial x$. Specifically, let the constitutive law be $\\sigma(\\varepsilon)=E\\,\\varepsilon+\\alpha\\,\\varepsilon^{3}$, where $E$ is a constant reference modulus and $\\alpha$ is a constant coefficient controlling the nonlinearity. Assume the tangent modulus $E_{\\mathrm{t}}(\\varepsilon)=\\mathrm{d}\\sigma/\\mathrm{d}\\varepsilon=E+3\\alpha\\,\\varepsilon^{2}$ remains strictly positive for all strains encountered so that the problem stays hyperbolic. The bar has homogeneous Dirichlet boundary conditions $u(0,t)=0$ and $u(L,t)=0$, and initial conditions $u(x,0)=u_{\\mathrm{amp}}\\sin(\\pi x/L)$ and $\\dot{u}(x,0)=0$, for a given amplitude $u_{\\mathrm{amp}}$.\n\nDiscretize the bar with $N$ uniform linear finite elements and adopt a lumped mass approximation. Use an explicit central difference time integration scheme to advance the semi-discrete system from time $t_{n}$ to $t_{n+1}$, and control stability via the Courant–Friedrichs–Lewy (CFL) condition (define the acronym on first use). The instantaneous time step $\\Delta t_{n}$ must be chosen as a fixed safety factor $s$ (with $0s1$) times the smallest element signal travel time computed from the linearization of the nonlinear material at the current state. Enforce the Dirichlet boundary conditions strongly at all times. No external forces are applied.\n\nYour task is to:\n\n- Start from the one-dimensional balance law $\\rho\\,\\ddot{u}=\\partial\\sigma/\\partial x$ and the given constitutive law, construct the standard linear finite element semi-discrete equations with lumped mass and the corresponding internal force vector assembled from element contributions at the current displacement $u_{n}$. The only nonlinearity enters through the stress evaluation at the current element strain.\n- Implement the explicit central difference update in a form that is valid with a variable time step $\\Delta t_{n}$ at each step, and is second-order accurate in time for smooth solutions.\n- At each step, determine the instantaneous elementwise linear wave speed from the current state via the slope of the stress–strain curve and choose $\\Delta t_{n}$ as described above to satisfy the Courant–Friedrichs–Lewy (CFL) stability restriction with safety factor $s$. Use this $\\Delta t_{n}$ to update velocities and displacements.\n- Track, over the entire simulation horizon $[0,T]$, the minimum encountered critical time step defined as the infimum over time of the smallest element signal travel time (without the safety factor $s$). Report this minimum critical time step in seconds.\n\nUse the following test suite, where all quantities are to be interpreted in the International System of Units (SI). For each case, simulate up to the specified final time $T$ with the given safety factor $s$, and output the minimum encountered critical time step (without the safety factor) in seconds:\n\n- Case $1$ (linear steel-like response, moderately fine mesh): $E=2.10\\times 10^{11}$, $\\alpha=0$, $\\rho=7.80\\times 10^{3}$, $L=1$, $A=1$, $N=50$, $T=2.0\\times 10^{-4}$, $u_{\\mathrm{amp}}=1.0\\times 10^{-6}$, $s=0.9$.\n- Case $2$ (nonlinear stiffening, finer mesh): $E=1.0\\times 10^{7}$, $\\alpha=1.0\\times 10^{12}$, $\\rho=1.0\\times 10^{3}$, $L=1$, $A=1$, $N=100$, $T=2.0\\times 10^{-3}$, $u_{\\mathrm{amp}}=5.0\\times 10^{-3}$, $s=0.9$.\n- Case $3$ (nonlinear softening, still positive tangent, intermediate mesh): $E=1.0\\times 10^{7}$, $\\alpha=-5.0\\times 10^{10}$, $\\rho=1.0\\times 10^{3}$, $L=1$, $A=1$, $N=80$, $T=1.0\\times 10^{-3}$, $u_{\\mathrm{amp}}=1.0\\times 10^{-3}$, $s=0.9$.\n- Case $4$ (coarse mesh, linear): $E=1.0\\times 10^{9}$, $\\alpha=0$, $\\rho=2.0\\times 10^{3}$, $L=1$, $A=1$, $N=2$, $T=1.0\\times 10^{-3}$, $u_{\\mathrm{amp}}=1.0\\times 10^{-4}$, $s=0.9$.\n\nYour program must produce a single line of output containing the four results as a comma-separated Python list of floats in seconds, in the order of the cases above, for example, $[\\mathrm{result}_{1},\\mathrm{result}_{2},\\mathrm{result}_{3},\\mathrm{result}_{4}]$.", "solution": "The problem statement is a well-posed initial boundary value problem in one-dimensional nonlinear elastodynamics. It is scientifically grounded, internally consistent, and contains all necessary information to construct a numerical solution. The physical parameters are plausible, and the specified numerical methods—finite element spatial discretization with lumped mass and explicit central difference time integration—are standard for this class of problem. The problem is therefore deemed valid and a solution will be provided.\n\nThe task is to simulate the dynamic response of a bar with a nonlinear stress-strain relationship and to find the minimum critical time step encountered during the simulation, governed by the Courant–Friedrichs–Lewy (CFL) stability condition.\n\nThe governing equation is the balance of linear momentum:\n$$\n\\rho \\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial \\sigma}{\\partial x}\n$$\nwhere $\\rho$ is the mass density, $u(x,t)$ is the axial displacement, and $\\sigma$ is the axial stress. The constitutive law is given as nonlinear:\n$$\n\\sigma(\\varepsilon) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^3\n$$\nwith strain $\\varepsilon = \\partial u / \\partial x$.\n\nTo derive the semi-discrete equations of motion using the Finite Element Method (FEM), we first establish the weak form. We multiply the governing equation by a test function $v(x)$ that satisfies the homogeneous Dirichlet boundary conditions (i.e., $v(0)=v(L)=0$) and integrate over the domain $[0, L]$:\n$$\n\\int_0^L v \\left( \\rho \\frac{\\partial^2 u}{\\partial t^2} \\right) A \\,dx = \\int_0^L v \\left( \\frac{\\partial \\sigma}{\\partial x} \\right) A \\,dx\n$$\nApplying integration by parts to the right-hand side yields:\n$$\n\\int_0^L v \\rho A \\ddot{u} \\,dx = [v A \\sigma]_0^L - \\int_0^L \\frac{\\partial v}{\\partial x} A \\sigma \\,dx\n$$\nThe boundary term $[v A \\sigma]_0^L$ vanishes because $v(0) = v(L) = 0$. The weak form is thus:\n$$\n\\int_0^L v \\rho A \\ddot{u} \\,dx + \\int_0^L \\frac{\\partial v}{\\partial x} A \\sigma\\left(\\frac{\\partial u}{\\partial x}\\right) \\,dx = 0\n$$\n\nWe discretize the domain into $N$ uniform linear finite elements of length $h=L/N$. The displacement field is approximated as $u(x,t) \\approx \\sum_{i=0}^N N_i(x) d_i(t)$, where $N_i(x)$ are the linear \"hat\" basis functions and $d_i(t)$ are the nodal displacements. Substituting this approximation into the weak form leads to the semi-discrete system of equations:\n$$\n\\mathbf{M}\\ddot{\\mathbf{d}}(t) + \\mathbf{f}_{\\text{int}}(\\mathbf{d}(t)) = \\mathbf{0}\n$$\nwhere $\\mathbf{d}$ is the vector of nodal displacements, $\\mathbf{M}$ is the mass matrix, and $\\mathbf{f}_{\\text{int}}$ is the vector of internal forces.\n\nThe problem specifies a lumped mass approximation. For a uniform mesh, the mass of an interior node $i$ is the sum of half the mass of the two adjacent elements, resulting in $m_i = \\rho A h$ for $i=1, \\dots, N-1$. The boundary nodes receive half this mass, $m_0=m_N=\\rho A h/2$. The mass matrix $\\mathbf{M}$ is diagonal with these values.\n\nThe internal force vector $\\mathbf{f}_{\\text{int}}$ is assembled from element contributions. For a linear element $e$ connecting nodes $i$ and $i+1$, the strain $\\varepsilon^{(e)}$ is constant:\n$$\n\\varepsilon^{(e)} = \\frac{d_{i+1} - d_i}{h}\n$$\nThe stress $\\sigma^{(e)}$ is also constant within the element:\n$$\n\\sigma^{(e)} = E\\varepsilon^{(e)} + \\alpha(\\varepsilon^{(e)})^3\n$$\nThe internal force contribution from this element to nodes $i$ and $i+1$ is $\\begin{bmatrix} -A\\sigma^{(e)} \\\\ A\\sigma^{(e)} \\end{bmatrix}$. The global internal force at an interior node $i$ is the sum of forces from the element to its left (element $i-1$) and the element to its right (element $i$):\n$$\nf_{\\text{int}, i} = A\\sigma^{(i-1)} - A\\sigma^{(i)}\n$$\nwhere $\\sigma^{(i-1)}$ is the stress in the element between nodes $i-1$ and $i$, and $\\sigma^{(i)}$ is the stress in the element between nodes $i$ and $i+1$.\n\nFor time integration, we use an explicit central difference scheme, specifically the leapfrog variant, which is second-order accurate and suitable for variable time steps. Let $\\mathbf{d}_n$, $\\mathbf{v}_n$, and $\\mathbf{a}_n$ be the displacement, velocity, and acceleration vectors at time $t_n$. Velocities are evaluated at half-time steps $t_{n \\pm 1/2}$. The update proceeds as:\n1.  Update velocity: $\\mathbf{v}_{n+1/2} = \\mathbf{v}_{n-1/2} + \\mathbf{a}_n \\Delta t_n$\n2.  Update displacement: $\\mathbf{d}_{n+1} = \\mathbf{d}_n + \\mathbf{v}_{n+1/2} \\Delta t_n$\nwhere $\\mathbf{a}_n = -\\mathbf{M}^{-1}\\mathbf{f}_{\\text{int}}(\\mathbf{d}_n)$. The scheme requires a \"kick-start\" procedure for the first step, as we are given $\\mathbf{d}_0$ and $\\mathbf{v}_0$. We first compute $\\mathbf{a}_0$ from $\\mathbf{d}_0$ and determine the initial time step $\\Delta t_0$. Then the velocity at the first half-step is found by a backward step: $\\mathbf{v}_{-1/2} = \\mathbf{v}_0 - \\mathbf{a}_0 \\Delta t_0/2$.\n\nThe stability of this explicit scheme is governed by the Courant–Friedrichs–Lewy (CFL) condition, which dictates that the numerical domain of dependence must contain the physical domain of dependence. For the 1D wave equation, this means that information cannot travel further than one element length $h$ in a single time step $\\Delta t$:\n$$\n\\Delta t \\le \\frac{h}{c}\n$$\nwhere $c$ is the wave propagation speed. In our nonlinear material, the wave speed depends on the tangent modulus $E_t = d\\sigma/d\\varepsilon$:\n$$\nc(\\varepsilon) = \\sqrt{\\frac{E_t(\\varepsilon)}{\\rho}} = \\sqrt{\\frac{E + 3\\alpha\\varepsilon^2}{\\rho}}\n$$\nSince the strain $\\varepsilon$ varies from element to element and changes with time, the wave speed is also spatially and temporally variable. To ensure stability for the entire system, the time step $\\Delta t_n$ must be chosen based on the maximum wave speed present in any element at time $t_n$:\n$$\nc_{\\max, n} = \\max_{e \\in \\{1,\\dots,N\\}} \\left\\{ c^{(e)}(\\varepsilon_n^{(e)}) \\right\\}\n$$\nThe critical time step at time $t_n$ is $\\Delta t_{\\text{crit}, n} = h / c_{\\max, n}$. The actual time step is taken as $\\Delta t_n = s \\cdot \\Delta t_{\\text{crit}, n}$, where $s$ is a safety factor ($0  s  1$).\n\nThe overall algorithm is as follows:\n1.  Initialize nodal positions, lumped masses $\\mathbf{m}$, initial displacements $\\mathbf{d}_0$, and initial velocities $\\mathbf{v}_0$.\n2.  Compute initial accelerations $\\mathbf{a}_0 = -\\mathbf{M}^{-1}\\mathbf{f}_{\\text{int}}(\\mathbf{d}_0)$.\n3.  Compute the initial critical time step $\\Delta t_{\\text{crit}, 0}$ from strains in $\\mathbf{d}_0$. Let $\\Delta t_0 = s \\cdot \\Delta t_{\\text{crit}, 0}$.\n4.  Perform the kick-start: $\\mathbf{v}_{-1/2} = \\mathbf{v}_0 - \\mathbf{a}_0 \\Delta t_0/2$.\n5.  Initialize a list to store all encountered critical time steps, starting with $\\Delta t_{\\text{crit}, 0}$.\n6.  Loop over time steps $n=0, 1, 2, \\dots$ until the total time $t$ reaches the final time $T$:\n    a. Determine the current maximum wave speed $c_{\\max, n}$ based on strains from $\\mathbf{d}_n$.\n    b. Calculate the critical time step $\\Delta t_{\\text{crit}, n} = h / c_{\\max, n}$ and record it.\n    c. Set the time step $\\Delta t_n = s \\cdot \\Delta t_{\\text{crit}, n}$, adjusting if necessary to land exactly on $T$.\n    d. Update velocities to the next half-step: $\\mathbf{v}_{n+1/2} = \\mathbf{v}_{n-1/2} + \\mathbf{a}_n \\Delta t_n$.\n    e. Update displacements to the next full step: $\\mathbf{d}_{n+1} = \\mathbf{d}_n + \\mathbf{v}_{n+1/2} \\Delta t_n$.\n    f. Enforce Dirichlet boundary conditions: $d_{0, n+1} = 0$, $d_{N, n+1} = 0$.\n    g. Compute new internal forces $\\mathbf{f}_{\\text{int}}(\\mathbf{d}_{n+1})$ and accelerations $\\mathbf{a}_{n+1}$. Enforce $a_{0, n+1}=a_{N, n+1}=0$.\n    h. Advance time $t_{n+1} = t_n + \\Delta t_n$.\n7.  After the simulation, report the minimum value from the list of recorded critical time steps.\nThis procedure will be implemented for each of the four test cases.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(E, alpha, rho, L, A, N, T, u_amp, s):\n    \"\"\"\n    Solves the 1D nonlinear elastodynamics problem for one set of parameters.\n\n    Args:\n        E (float): Reference modulus.\n        alpha (float): Nonlinearity coefficient.\n        rho (float): Mass density.\n        L (float): Bar length.\n        A (float): Cross-sectional area.\n        N (int): Number of finite elements.\n        T (float): Final simulation time.\n        u_amp (float): Amplitude of initial displacement.\n        s (float): CFL safety factor.\n\n    Returns:\n        float: The minimum encountered critical time step.\n    \"\"\"\n    \n    # 1. Discretization and Material Properties\n    h = L / N\n    num_nodes = N + 1\n    x_nodes = np.linspace(0, L, num_nodes)\n\n    # Lumped mass vector\n    m_lumped = np.full(num_nodes, rho * A * h)\n    m_lumped[0] = rho * A * h / 2.0\n    m_lumped[-1] = rho * A * h / 2.0\n    \n    # Pre-calculate inverse of mass for acceleration computation\n    m_inv = 1.0 / m_lumped\n    m_inv[0] = 0.0  # Boundary nodes have prescribed motion (zero acceleration)\n    m_inv[-1] = 0.0\n\n    # Helper functions for acceleration and wave speed\n    def compute_acceleration(d_vec):\n        strains = (d_vec[1:] - d_vec[:-1]) / h\n        stresses = E * strains + alpha * strains**3\n        \n        f_int = np.zeros(num_nodes)\n        # Internal forces on interior nodes\n        f_int[1:-1] = A * (stresses[:-1] - stresses[1:])\n        \n        return -f_int * m_inv\n\n    def compute_max_wavespeed(d_vec):\n        strains = (d_vec[1:] - d_vec[:-1]) / h\n        # Tangent modulus E_t = E + 3*alpha*epsilon^2\n        tangent_moduli = E + 3.0 * alpha * strains**2\n        \n        if np.any(tangent_moduli = 0):\n            # This check is for robustness; problem statement assumes E_t > 0\n            raise ValueError(\"Non-positive tangent modulus encountered. Problem is no longer hyperbolic.\")\n            \n        wave_speeds_sq = tangent_moduli / rho\n        return np.sqrt(np.max(wave_speeds_sq))\n\n    # 2. Initial Conditions\n    d = u_amp * np.sin(np.pi * x_nodes / L)\n    v = np.zeros(num_nodes)\n    \n    d[0], d[-1] = 0.0, 0.0 # B.C.\n\n    # 3. Kick-start the central difference scheme\n    a = compute_acceleration(d)\n    \n    c_max_initial = compute_max_wavespeed(d)\n    dt_crit_initial = h / c_max_initial\n    dt = s * dt_crit_initial\n\n    # v at step -1/2 for the leapfrog integrator\n    v_half = v - a * dt / 2.0\n    \n    # 4. Time-stepping loop\n    t = 0.0\n    critical_dt_history = [dt_crit_initial]\n    \n    a_curr = a\n\n    while t  T:\n        # Determine current time step\n        c_max = compute_max_wavespeed(d)\n        dt_crit = h / c_max\n        critical_dt_history.append(dt_crit)\n        \n        dt = s * dt_crit\n        if t + dt > T:\n            dt = T - t\n\n        # Leapfrog integration step\n        v_half = v_half + a_curr * dt\n        d = d + v_half * dt\n        \n        # Enforce boundary conditions strongly\n        d[0], d[-1] = 0.0, 0.0\n\n        a_curr = compute_acceleration(d)\n        t += dt\n\n    return min(critical_dt_history)\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # (E, alpha, rho, L, A, N, T, u_amp, s)\n    test_cases = [\n        (2.10e11, 0.0, 7.80e3, 1.0, 1.0, 50, 2.0e-4, 1.0e-6, 0.9),\n        (1.0e7, 1.0e12, 1.0e3, 1.0, 1.0, 100, 2.0e-3, 5.0e-3, 0.9),\n        (1.0e7, -5.0e10, 1.0e3, 1.0, 1.0, 80, 1.0e-3, 1.0e-3, 0.9),\n        (1.0e9, 0.0, 2.0e3, 1.0, 1.0, 2, 1.0e-3, 1.0e-4, 0.9),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2557122"}]}