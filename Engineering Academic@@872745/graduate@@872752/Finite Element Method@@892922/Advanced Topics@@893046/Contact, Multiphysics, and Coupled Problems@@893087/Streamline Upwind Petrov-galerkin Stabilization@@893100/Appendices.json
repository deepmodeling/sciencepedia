{"hands_on_practices": [{"introduction": "To master the Streamline Upwind Petrov-Galerkin (SUPG) method, we must first grasp its mathematical foundation. This practice focuses on the core concept: rewriting the governing equation's residual in terms of a derivative along the advection direction, known as the streamline derivative. This exercise [@problem_id:2602075] will show you that this is not just an algebraic trick but the key insight that motivates the entire stabilization strategy.", "problem": "Consider the steady, non-dimensional linear advection–diffusion–reaction model problem posed on a smooth, simply connected domain $\\Omega \\subset \\mathbb{R}^{2}$ with homogeneous Dirichlet boundary conditions. The strong form is\n$$\n-\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f \\quad \\text{in } \\Omega,\n$$\nwhere $\\epsilon0$ is the (constant) diffusivity, $\\boldsymbol{\\beta}\\in\\mathbb{R}^{2}$ is a constant advection field, $\\sigma\\ge 0$ is a (constant) reaction coefficient, and $f$ is a given source. The strong residual associated with a sufficiently smooth function $u$ is defined by\n$$\nr(u) \\coloneqq -\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u - f.\n$$\nIn the Streamline Upwind/Petrov–Galerkin (SUPG) stabilization, the streamline direction is taken along the flow $\\boldsymbol{\\beta}$, and the streamline derivative is defined by\n$$\n\\partial_{\\boldsymbol{t}} u \\coloneqq \\boldsymbol{t}\\cdot\\nabla u, \\quad \\boldsymbol{t} \\coloneqq \\frac{\\boldsymbol{\\beta}}{\\lVert\\boldsymbol{\\beta}\\rVert}.\n$$\nLet the advection field be constant, $\\boldsymbol{\\beta}=(2,1)$, and let the candidate solution be $u(x,y)=\\exp(x+2y)$. Assume $f(x,y)=0$.\n\nStarting from the definitions above and only basic vector calculus identities, derive $\\partial_{\\boldsymbol{t}} u$ and use it to rewrite the residual in the form\n$$\nr(u)= -\\epsilon\\,\\Delta u + \\lVert\\boldsymbol{\\beta}\\rVert\\,\\partial_{\\boldsymbol{t}} u + \\sigma\\,u - f,\n$$\nthen evaluate $r(u)(x,y)$ for the given $u$, $\\boldsymbol{\\beta}$, and $f$. Provide your final answer as a single closed-form analytic expression in terms of $x$, $y$, $\\epsilon$, and $\\sigma$. Do not include units. No numerical rounding is required.", "solution": "The problem statement is subjected to validation.\n\nStep 1: Extract Givens.\n- The strong form of the steady, non-dimensional linear advection–diffusion–reaction equation: $-\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f$ in $\\Omega \\subset \\mathbb{R}^{2}$.\n- Diffusivity: $\\epsilon  0$, constant.\n- Advection field: $\\boldsymbol{\\beta} \\in \\mathbb{R}^{2}$, constant.\n- Reaction coefficient: $\\sigma \\ge 0$, constant.\n- Source term: $f$.\n- Definition of the strong residual: $r(u) \\coloneqq -\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u - f$.\n- Definition of the streamline direction: $\\boldsymbol{t} \\coloneqq \\frac{\\boldsymbol{\\beta}}{\\lVert\\boldsymbol{\\beta}\\rVert}$.\n- Definition of the streamline derivative: $\\partial_{\\boldsymbol{t}} u \\coloneqq \\boldsymbol{t}\\cdot\\nabla u$.\n- Specific advection field: $\\boldsymbol{\\beta}=(2,1)$.\n- Specific candidate solution: $u(x,y)=\\exp(x+2y)$.\n- Specific source term: $f(x,y)=0$.\n\nStep 2: Validate Using Extracted Givens.\n- **Scientifically Grounded:** The problem is based on the advection-diffusion-reaction partial differential equation, a fundamental model in transport phenomena. The Streamline Upwind/Petrov-Galerkin (SUPG) method is a standard and well-established stabilization technique in computational fluid dynamics and the finite element method. All definitions are standard and mathematically correct.\n- **Well-Posed:** The problem requires the derivation of an identity and the evaluation of a resulting expression. This is a direct calculation with a unique, well-defined result.\n- **Objective:** The problem is stated in precise, mathematical language, free from subjectivity.\n- **Completeness and Consistency:** All necessary functions ($u$, $\\boldsymbol{\\beta}$, $f$) and definitions ($r(u)$, $\\partial_{\\boldsymbol{t}} u$) are provided to perform the required calculations. There are no contradictions.\n\nStep 3: Verdict and Action.\nThe problem is valid. It is a standard exercise in vector calculus and the analysis of partial differential equations. The solution process may proceed.\n\nThe task is twofold: first, to rewrite the residual $r(u)$ in terms of the streamline derivative $\\partial_{\\boldsymbol{t}} u$, and second, to evaluate this residual for the given functions.\n\nPart 1: Derivation of the residual in terms of the streamline derivative.\n\nThe strong residual is defined as:\n$$\nr(u) = -\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u - f\n$$\nThe streamline direction $\\boldsymbol{t}$ is defined as the unit vector in the direction of the advection field $\\boldsymbol{\\beta}$:\n$$\n\\boldsymbol{t} = \\frac{\\boldsymbol{\\beta}}{\\lVert\\boldsymbol{\\beta}\\rVert}\n$$\nFrom this definition, it follows directly that the advection field can be expressed as:\n$$\n\\boldsymbol{\\beta} = \\lVert\\boldsymbol{\\beta}\\rVert\\,\\boldsymbol{t}\n$$\nThe streamline derivative $\\partial_{\\boldsymbol{t}} u$ is defined as the directional derivative of $u$ in the direction of $\\boldsymbol{t}$:\n$$\n\\partial_{\\boldsymbol{t}} u = \\boldsymbol{t}\\cdot\\nabla u\n$$\nNow, consider the advection term $\\boldsymbol{\\beta}\\cdot\\nabla u$ in the residual. Substitute the expression for $\\boldsymbol{\\beta}$ in terms of $\\boldsymbol{t}$:\n$$\n\\boldsymbol{\\beta}\\cdot\\nabla u = (\\lVert\\boldsymbol{\\beta}\\rVert\\,\\boldsymbol{t})\\cdot\\nabla u\n$$\nUsing the scalar-vector product property, we can write:\n$$\n\\boldsymbol{\\beta}\\cdot\\nabla u = \\lVert\\boldsymbol{\\beta}\\rVert\\,(\\boldsymbol{t}\\cdot\\nabla u)\n$$\nSubstituting the definition of the streamline derivative $\\partial_{\\boldsymbol{t}} u$ into this expression gives:\n$$\n\\boldsymbol{\\beta}\\cdot\\nabla u = \\lVert\\boldsymbol{\\beta}\\rVert\\,\\partial_{\\boldsymbol{t}} u\n$$\nFinally, we substitute this result back into the original definition of the residual $r(u)$:\n$$\nr(u) = -\\epsilon\\,\\Delta u + \\lVert\\boldsymbol{\\beta}\\rVert\\,\\partial_{\\boldsymbol{t}} u + \\sigma\\,u - f\n$$\nThis completes the first part of the task, demonstrating the required relationship.\n\nPart 2: Evaluation of the residual $r(u)(x,y)$.\n\nWe are given the candidate solution $u(x,y) = \\exp(x+2y)$, the advection field $\\boldsymbol{\\beta} = (2,1)$, and the source term $f(x,y)=0$. To evaluate $r(u)$, we must compute the necessary derivatives of $u$.\n\nFirst, we compute the gradient of $u$, $\\nabla u$:\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\exp(x+2y) = \\exp(x+2y)\n$$\n$$\n\\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial y} \\exp(x+2y) = 2\\exp(x+2y)\n$$\nSo, the gradient is:\n$$\n\\nabla u = \\begin{pmatrix} \\exp(x+2y) \\\\ 2\\exp(x+2y) \\end{pmatrix}\n$$\nNext, we compute the Laplacian of $u$, $\\Delta u = \\nabla \\cdot \\nabla u$. We need the second-order partial derivatives:\n$$\n\\frac{\\partial^2 u}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left(\\exp(x+2y)\\right) = \\exp(x+2y)\n$$\n$$\n\\frac{\\partial^2 u}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left(2\\exp(x+2y)\\right) = 4\\exp(x+2y)\n$$\nThe Laplacian is the sum of these pure second derivatives:\n$$\n\\Delta u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} = \\exp(x+2y) + 4\\exp(x+2y) = 5\\exp(x+2y)\n$$\nNow, we can evaluate each term in the original residual expression $r(u) = -\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u - f$.\nThe diffusion term is:\n$$\n-\\epsilon\\,\\Delta u = -\\epsilon(5\\exp(x+2y)) = -5\\epsilon\\exp(x+2y)\n$$\nThe advection term is:\n$$\n\\boldsymbol{\\beta}\\cdot\\nabla u = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} \\cdot \\begin{pmatrix} \\exp(x+2y) \\\\ 2\\exp(x+2y) \\end{pmatrix} = 2\\exp(x+2y) + 1 \\cdot 2\\exp(x+2y) = 4\\exp(x+2y)\n$$\nThe reaction term is:\n$$\n\\sigma\\,u = \\sigma\\exp(x+2y)\n$$\nThe source term is given as $f=0$.\n\nWe assemble the residual by summing these terms:\n$$\nr(u)(x,y) = -5\\epsilon\\exp(x+2y) + 4\\exp(x+2y) + \\sigma\\exp(x+2y) - 0\n$$\nFactoring out the common term $\\exp(x+2y)$ gives the final expression for the residual:\n$$\nr(u)(x,y) = (4 + \\sigma - 5\\epsilon)\\exp(x+2y)\n$$\nThis is the required closed-form analytic expression for the residual.", "answer": "$$\n\\boxed{(4 + \\sigma - 5\\epsilon)\\exp(x+2y)}\n$$", "id": "2602075"}, {"introduction": "After understanding the conceptual basis of SUPG, a critical practical question arises: how much stabilization should be added? This exercise [@problem_id:2602150] guides you through the calculation of the stabilization parameter, $\\tau$, for a two-dimensional triangular element. You will discover how $\\tau$ is intelligently defined based on the local element size, the flow velocity, and the physical diffusivity, providing a robust bridge from abstract theory to concrete implementation.", "problem": "Consider the steady, dimensionless advection–diffusion–reaction boundary value problem in two spatial dimensions,\n$$-\\,\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f \\quad \\text{in a polygonal domain},$$\nwith constant coefficients. Focus on a single affine, linear triangular finite element with vertices at\n$$\\boldsymbol{x}_1=(0,0),\\quad \\boldsymbol{x}_2=(0.04,0),\\quad \\boldsymbol{x}_3=(0,0.03),$$\nand associated linear Lagrange nodal shape functions $N_i$ that satisfy the partition of unity and linear completeness. Let the advection velocity be $\\boldsymbol{\\beta}=(10,0.5)$, the diffusivity be $\\epsilon=10^{-4}$, and the reaction coefficient be $\\sigma=0$.\n\n(a) Starting only from (i) the one-dimensional identity for a linear two-node element that the sum of the absolute values of the shape function derivatives equals $2/h$ (where $h$ is the element length), and (ii) the affine mapping and directional derivative concept for a triangle, derive a formula for the directional element length $h_{\\boldsymbol{t}}$ in the streamline direction $\\boldsymbol{t}=\\boldsymbol{\\beta}/\\|\\boldsymbol{\\beta}\\|$ expressed in terms of the constant gradients $\\nabla N_i$ and $\\boldsymbol{t}$. Then evaluate $h_{\\boldsymbol{t}}$ for the given triangle and $\\boldsymbol{\\beta}$.\n\n(b) Using the one-dimensional constant-coefficient analysis that yields the optimal Streamline Upwind/Petrov–Galerkin (SUPG) stabilization parameter along the streamline direction, derive the expression of the stabilization parameter $\\tau$ in terms of $h_{\\boldsymbol{t}}$, $\\|\\boldsymbol{\\beta}\\|$, $\\epsilon$, and the element Péclet number. Then evaluate $\\tau$ for the given data.\n\nProvide your final numerical values for $h_{\\boldsymbol{t}}$ and $\\tau$. Round both to six significant figures. Express your final answer as the ordered pair $(h_{\\boldsymbol{t}},\\ \\tau)$ with no units.", "solution": "The problem statement is validated and found to be well-posed, scientifically grounded, and self-contained. It presents a standard, albeit non-trivial, exercise in the finite element analysis of advection-dominated problems. We proceed with the solution.\n\nThe problem is partitioned into two parts. We address each in sequence.\n\n(a) Derivation and evaluation of the directional element length $h_{\\boldsymbol{t}}$.\n\nFor a linear triangular element, the Lagrange nodal shape functions $N_i(\\boldsymbol{x})$ are linear functions of the spatial coordinates $\\boldsymbol{x}=(x,y)$. Consequently, their gradients, $\\nabla N_i$, are constant vectors over the element. These gradients are determined by the element geometry. Given the vertices $\\boldsymbol{x}_1=(0,0)$, $\\boldsymbol{x}_2=(0.04,0)$, and $\\boldsymbol{x}_3=(0,0.03)$, the area of the triangle is $A = \\frac{1}{2}(0.04)(0.03) = 0.0006$. The gradients are computed as:\n$$\n\\nabla N_i = \\frac{1}{2A} \\begin{pmatrix} y_j - y_k \\\\ x_k - x_j \\end{pmatrix}\n$$\nwhere $(i,j,k)$ is a cyclic permutation of $(1,2,3)$. For the given vertices:\n$$\n\\nabla N_1 = \\frac{1}{0.0012} \\begin{pmatrix} 0 - 0.03 \\\\ 0 - 0.04 \\end{pmatrix} = \\begin{pmatrix} -25 \\\\ -100/3 \\end{pmatrix}\n$$\n$$\n\\nabla N_2 = \\frac{1}{0.0012} \\begin{pmatrix} 0.03 - 0 \\\\ 0 - 0 \\end{pmatrix} = \\begin{pmatrix} 25 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\nabla N_3 = \\frac{1}{0.0012} \\begin{pmatrix} 0 - 0 \\\\ 0.04 - 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 100/3 \\end{pmatrix}\n$$\nThe condition of linear completeness, $\\sum_{i=1}^3 \\nabla N_i = \\boldsymbol{0}$, is satisfied.\n\nThe problem instructs to start from the one-dimensional identity for a linear two-node element of length $h$, which is $\\sum_{i=1}^2 |N_i'| = \\frac{2}{h}$. This identity can be rearranged to define the element length as $h = 2 / (\\sum_{i=1}^2 |N_i'|)$.\n\nWe generalize this concept to multiple dimensions. The role of the derivative $N_i'$ along the single spatial coordinate is replaced by the directional derivative of $N_i$ along a specified streamline direction, given by the unit vector $\\boldsymbol{t}$. The directional derivative is $\\nabla N_i \\cdot \\boldsymbol{t}$. The sum is taken over all nodes of the element, in this case $i=1, 2, 3$. This yields the definition for the directional element length $h_{\\boldsymbol{t}}$:\n$$\nh_{\\boldsymbol{t}} = \\frac{2}{\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{t}|}\n$$\nThe streamline direction is aligned with the advection velocity $\\boldsymbol{\\beta}=(10, 0.5)$. The unit vector is $\\boldsymbol{t} = \\boldsymbol{\\beta} / \\|\\boldsymbol{\\beta}\\|$.\nFirst, we compute the dot products $\\nabla N_i \\cdot \\boldsymbol{\\beta}$:\n$$\n\\nabla N_1 \\cdot \\boldsymbol{\\beta} = (-25)(10) + (-\\frac{100}{3})(0.5) = -250 - \\frac{50}{3} = -\\frac{800}{3}\n$$\n$$\n\\nabla N_2 \\cdot \\boldsymbol{\\beta} = (25)(10) + (0)(0.5) = 250\n$$\n$$\n\\nabla N_3 \\cdot \\boldsymbol{\\beta} = (0)(10) + (\\frac{100}{3})(0.5) = \\frac{50}{3}\n$$\nThe sum of their absolute values is:\n$$\n\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{\\beta}| = |-\\frac{800}{3}| + |250| + |\\frac{50}{3}| = \\frac{800}{3} + \\frac{750}{3} + \\frac{50}{3} = \\frac{1600}{3}\n$$\nThe magnitude of the advection velocity is $\\|\\boldsymbol{\\beta}\\| = \\sqrt{10^2 + 0.5^2} = \\sqrt{100.25}$.\nWe can now write the sum of the absolute values of the directional derivatives:\n$$\n\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{t}| = \\sum_{i=1}^3 \\left|\\nabla N_i \\cdot \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|}\\right| = \\frac{1}{\\|\\boldsymbol{\\beta}\\|} \\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{\\beta}| = \\frac{1600/3}{\\sqrt{100.25}}\n$$\nSubstituting this into the formula for $h_{\\boldsymbol{t}}$:\n$$\nh_{\\boldsymbol{t}} = \\frac{2}{\\frac{1600/3}{\\sqrt{100.25}}} = \\frac{6 \\sqrt{100.25}}{1600} = \\frac{3 \\sqrt{100.25}}{800}\n$$\nNumerically evaluating this expression, we find:\n$$\nh_{\\boldsymbol{t}} \\approx \\frac{3 \\times 10.0124922}{800} \\approx 0.03754684575\n$$\nRounding to six significant figures, $h_{\\boldsymbol{t}} = 0.0375468$.\n\n(b) Derivation and evaluation of the SUPG stabilization parameter $\\tau$.\n\nThe optimal SUPG stabilization parameter for the one-dimensional, constant-coefficient advection-diffusion equation on a linear element of length $h$ is given by:\n$$\n\\tau_{\\text{1D}} = \\frac{h}{2\\beta} \\left( \\coth(Pe_{\\text{1D}}) - \\frac{1}{Pe_{\\text{1D}}} \\right)\n$$\nwhere the one-dimensional Péclet number is $Pe_{\\text{1D}} = \\frac{\\beta h}{2\\epsilon}$.\n\nTo derive the expression for the multidimensional case, we generalize this formula by consistently replacing the one-dimensional quantities with their multidimensional counterparts. The element length $h$ is replaced by the directional element length $h_{\\boldsymbol{t}}$ along the streamline. The scalar velocity $\\beta$ is replaced by its magnitude $\\|\\boldsymbol{\\beta}\\|$. This yields the expression for the stabilization parameter $\\tau$ as:\n$$\n\\tau = \\frac{h_{\\boldsymbol{t}}}{2\\|\\boldsymbol{\\beta}\\|} \\left( \\coth(Pe) - \\frac{1}{Pe} \\right)\n$$\nwhere the element Péclet number is now defined as:\n$$\nPe = \\frac{\\|\\boldsymbol{\\beta}\\| h_{\\boldsymbol{t}}}{2\\epsilon}\n$$\nThis constitutes the required derivation. We now evaluate this for the given data. First, we compute the element Péclet number $Pe$:\n$$\nPe = \\frac{\\|\\boldsymbol{\\beta}\\| h_{\\boldsymbol{t}}}{2\\epsilon} = \\frac{\\sqrt{100.25}}{2 \\times 10^{-4}} \\left( \\frac{3 \\sqrt{100.25}}{800} \\right) = \\frac{3 (100.25)}{1600 \\times 10^{-4}} = \\frac{300.75}{0.16} = 1879.6875\n$$\nThe value of the Péclet number is very large, signifying a strongly advection-dominated regime. For large arguments $x$, the hyperbolic cotangent function $\\coth(x)$ rapidly approaches $1$. For $Pe = 1879.6875$, the value of $\\coth(Pe)$ is computationally indistinguishable from $1$. Therefore, we can use the high-Péclet number asymptotic form.\nSubstituting the expressions for $h_{\\boldsymbol{t}}$ and $Pe$ into the formula for $\\tau$:\n$$\n\\tau = \\frac{1}{2\\|\\boldsymbol{\\beta}\\|} \\left(\\frac{3 \\|\\boldsymbol{\\beta}\\|}{800}\\right) \\left( \\coth(Pe) - \\frac{1}{Pe} \\right) = \\frac{3}{1600} \\left( \\coth(Pe) - \\frac{1}{Pe} \\right)\n$$\nUsing the value of $Pe$ and the approximation $\\coth(Pe) \\approx 1$:\n$$\n\\tau \\approx \\frac{3}{1600} \\left( 1 - \\frac{1}{1879.6875} \\right)\n$$\n$$\n\\tau \\approx 0.001875 \\left( 1 - 0.0005320053... \\right) \\approx 0.001875 \\times 0.99946799... \\approx 0.00187400249\n$$\nRounding to six significant figures, $\\tau = 0.00187400$.", "answer": "$$\\boxed{\\begin{pmatrix} 0.0375468  0.00187400 \\end{pmatrix}}$$", "id": "2602150"}, {"introduction": "With the conceptual framework and the method for computing $\\tau$ in hand, the final step is to integrate the SUPG stabilization into the finite element assembly process. This problem [@problem_id:2602122] presents a detailed, step-by-step algorithm for computing and adding the SUPG contributions to the element stiffness matrix and load vector. Working through this algorithmic logic solidifies your understanding of how the theoretical formulation translates into a practical and effective computational procedure.", "problem": "Consider the steady advection–diffusion–reaction model posed on a polygonal domain $\\Omega \\subset \\mathbb{R}^2$ with appropriate essential and natural boundary conditions: find $u:\\Omega \\to \\mathbb{R}$ such that\n$$\n-\\nabla\\cdot\\left(\\kappa\\,\\nabla u\\right) + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f \\quad \\text{in }\\Omega,\n$$\nwhere $\\kappa0$ is the diffusivity, $\\boldsymbol{\\beta}\\in\\mathbb{R}^2$ is the advective velocity, $\\sigma\\ge 0$ is a reaction coefficient, and $f$ is a given source. Let $V_h$ be the space of continuous, piecewise linear functions over a conforming triangulation $\\mathcal{T}_h$ of $\\Omega$. On each triangle $K\\in\\mathcal{T}_h$, let $\\{N_i\\}_{i=1}^3$ denote the local linear shape functions, and let $\\nabla N_i$ be their constant gradients on $K$. Assume elementwise constant coefficients $\\kappa|_K$, $\\boldsymbol{\\beta}|_K$, and $\\sigma|_K$.\n\nThe classical Galerkin method seeks $u_h\\in V_h$ such that for all $w_h\\in V_h$,\n$$\n\\sum_{K\\in\\mathcal{T}_h}\\int_K \\left(\\kappa\\,\\nabla u_h\\cdot\\nabla w_h + (\\boldsymbol{\\beta}\\cdot\\nabla u_h)\\,w_h + \\sigma\\,u_h\\,w_h\\right)\\,dx = \\sum_{K\\in\\mathcal{T}_h}\\int_K f\\,w_h\\,dx + \\text{boundary contributions}.\n$$\nTo improve stability in advection-dominated regimes, the Streamline Upwind/Petrov–Galerkin (SUPG) method enriches the test functions with the streamline-direction term $w_h^{\\text{SUPG}} = w_h + \\tau_K\\,\\boldsymbol{\\beta}\\cdot\\nabla w_h$, where $\\tau_K0$ is an elementwise stabilization parameter. The SUPG contribution on each element $K$ is built from the strong residual\n$$\nr(u_h) := -\\nabla\\cdot\\left(\\kappa\\,\\nabla u_h\\right) + \\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h - f,\n$$\nand modifies the weak form by adding the elementwise terms $\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla w_h)\\,r(u_h)\\,dx$.\n\nLet $\\{\\hat{\\boldsymbol{\\xi}}_q, \\hat{\\omega}_q\\}_{q=1}^{N_q}$ be a quadrature rule on the reference triangle $\\hat{K}$ that is exact for polynomials of degree at least $1$. Let $F_K:\\hat{K}\\to K$ be the affine element map with Jacobian matrix $\\mathbf{J}_K$ and determinant $J_K = \\det(\\mathbf{J}_K)  0$. Denote physical quadrature points by $\\boldsymbol{x}_q = F_K(\\hat{\\boldsymbol{\\xi}}_q)$ and physical weights by $\\omega_q = \\hat{\\omega}_q\\,J_K$.\n\nWhich option below gives a correct element-level algorithm to assemble only the SUPG stabilization contributions on a linear triangular element $K$, i.e., the element matrices and vectors $K^{\\text{SUPG}}_e$ and $b^{\\text{SUPG}}_e$ such that the global system receives the additional terms\n$$\n\\sum_{K\\in\\mathcal{T}_h}\\left(K^{\\text{SUPG}}_e\\,\\boldsymbol{u}_e\\right) \\quad \\text{on the left-hand side and} \\quad \\sum_{K\\in\\mathcal{T}_h} b^{\\text{SUPG}}_e \\quad \\text{on the right-hand side},\n$$\nwhere $\\boldsymbol{u}_e$ collects the element nodal values, and the algorithm explicitly uses the evaluation of $r(u_h)$ and $\\boldsymbol{\\beta}\\cdot\\nabla w_h$ at quadrature points?\n\nA. Elementwise constant-coefficient, residual-consistent SUPG assembly:\n- Step $1$: Extract $\\kappa|_K$, $\\boldsymbol{\\beta}|_K$, $\\sigma|_K$, and choose $\\tau_K0$. Compute $\\nabla N_i$ for $i\\in\\{1,2,3\\}$, and precompute $\\boldsymbol{\\beta}\\cdot\\nabla N_i$ (constant on $K$). Initialize $K^{\\text{SUPG}}_e\\in\\mathbb{R}^{3\\times 3}$ and $b^{\\text{SUPG}}_e\\in\\mathbb{R}^3$ to zero.\n- Step $2$: For each quadrature point $q\\in\\{1,\\dots,N_q\\}$ at $\\boldsymbol{x}_q$ with weight $\\omega_q$:\n  - Evaluate $N_j(\\boldsymbol{x}_q)$ for $j\\in\\{1,2,3\\}$; compute $u_h(\\boldsymbol{x}_q) = \\sum_{j=1}^3 N_j(\\boldsymbol{x}_q)\\,u_j$ and $\\nabla u_h = \\sum_{j=1}^3 \\nabla N_j\\,u_j$.\n  - Compute the strong residual $r_q := -\\nabla\\cdot(\\kappa\\,\\nabla u_h) + \\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h(\\boldsymbol{x}_q) - f(\\boldsymbol{x}_q)$. For linear triangles with elementwise constant $\\kappa$, note $\\nabla\\cdot(\\kappa\\,\\nabla u_h)=0$ in $K$.\n  - For each test index $i\\in\\{1,2,3\\}$ and trial index $j\\in\\{1,2,3\\}$, accumulate\n    $$\n    K^{\\text{SUPG}}_{e,ij}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,\\Big(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j(\\boldsymbol{x}_q)\\Big).\n    $$\n  - For each test index $i\\in\\{1,2,3\\}$, accumulate the right-hand side\n    $$\n    b^{\\text{SUPG}}_{e,i}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,f(\\boldsymbol{x}_q).\n    $$\n- Step $3$: Add $K^{\\text{SUPG}}_e$ to the global stiffness and $b^{\\text{SUPG}}_e$ to the global load. This realizes $\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla w_h)\\,\\big(\\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h - f\\big)\\,dx$ exactly for elementwise constants, while correctly acknowledging that $-\\nabla\\cdot(\\kappa\\,\\nabla u_h)=0$ in $K$ for linear $u_h$ and constant $\\kappa$.\n\nB. Load-only residual injection:\n- Step $1$: Choose $\\tau_K0$, compute $\\nabla N_i$ and $\\boldsymbol{\\beta}\\cdot\\nabla N_i$ on $K$; set $K^{\\text{SUPG}}_e=\\boldsymbol{0}$.\n- Step $2$: For each quadrature point $q$, evaluate $u_h(\\boldsymbol{x}_q)$ and $\\nabla u_h$; form $r_q$ as above and assemble only\n  $$\n  b^{\\text{SUPG}}_{e,i}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,r_q\n  $$\n  for $i\\in\\{1,2,3\\}$. Do not add any SUPG contribution to the stiffness matrix.\n\nC. Advective mass-like SUPG with lumped streamline test:\n- Step $1$: Compute $\\nabla N_i$ and $N_i(\\boldsymbol{x}_q)$; choose $\\tau_K0$.\n- Step $2$: For each quadrature point $q$, assemble\n  $$\n  K^{\\text{SUPG}}_{e,ij}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left|\\boldsymbol{\\beta}\\right|\\,N_i(\\boldsymbol{x}_q)\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_j\\right),\n  $$\n  and set $b^{\\text{SUPG}}_e=\\boldsymbol{0}$. This replaces $\\boldsymbol{\\beta}\\cdot\\nabla w_h$ by $\\left|\\boldsymbol{\\beta}\\right|\\,w_h$ to simplify computation.\n\nD. Diffusion-enhanced SUPG with recovery of $-\\nabla\\cdot(\\kappa\\nabla u_h)$ inside $K$:\n- Step $1$: Compute $\\nabla N_i$, $\\boldsymbol{\\beta}\\cdot\\nabla N_i$, and a discrete Laplacian approximation $\\Delta u_h|_{K} \\approx \\sum_{j=1}^3 u_j\\,\\Delta N_j$; choose $\\tau_K0$.\n- Step $2$: For each $q$, set\n  $$\n  K^{\\text{SUPG}}_{e,ij}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,\\Big(-\\kappa\\,\\Delta N_j + \\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j(\\boldsymbol{x}_q)\\Big),\n  $$\n  and\n  $$\n  b^{\\text{SUPG}}_{e,i}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,f(\\boldsymbol{x}_q).\n  $$\n\nE. SUPG with reversed source sign:\n- Step $1$: Compute $\\nabla N_i$ and $\\boldsymbol{\\beta}\\cdot\\nabla N_i$; choose $\\tau_K0$.\n- Step $2$: For each $q$, assemble\n  $$\n  K^{\\text{SUPG}}_{e,ij}\\;{+}{=}\\;\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,\\Big(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j(\\boldsymbol{x}_q)\\Big)\n  $$\n  and\n  $$\n  b^{\\text{SUPG}}_{e,i}\\;{+}{=}\\;-\\omega_q\\,\\tau_K\\,\\left(\\boldsymbol{\\beta}\\cdot\\nabla N_i\\right)\\,f(\\boldsymbol{x}_q),\n  $$\n  so that the source contribution enters the left-hand side with a negative sign.\n\nSelect the correct option(s).", "solution": "We begin from the governing equation\n$$\n-\\nabla\\cdot(\\kappa\\,\\nabla u) + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f \\quad \\text{in }\\Omega,\n$$\nwith $\\kappa0$, $\\boldsymbol{\\beta}\\in\\mathbb{R}^2$, $\\sigma\\ge 0$. On a mesh of triangles and with continuous, piecewise linear trial and test spaces, the classical Galerkin weak form augments the diffusion, advection, and reaction bilinear forms and a source linear form. The Streamline Upwind/Petrov–Galerkin (SUPG) modification enriches the test function by $w_h^{\\text{SUPG}} = w_h + \\tau_K\\,\\boldsymbol{\\beta}\\cdot\\nabla w_h$. The additional SUPG term over each element $K$ is\n$$\n\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla w_h)\\,r(u_h)\\,dx,\n$$\nwhere the strong residual is\n$$\nr(u_h) = -\\nabla\\cdot(\\kappa\\,\\nabla u_h) + \\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h - f.\n$$\nFor linear triangles with elementwise constant $\\kappa$, we have $\\nabla u_h$ constant on $K$, hence $\\nabla\\cdot(\\kappa\\,\\nabla u_h) = \\kappa\\,\\nabla\\cdot(\\nabla u_h) = \\kappa\\,\\Delta u_h = 0$ in the interior of $K$. Therefore, on such elements,\n$$\nr(u_h) = \\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h - f \\quad \\text{pointwise in }K.\n$$\nLet $\\{N_i\\}_{i=1}^3$ be the local basis functions on $K$ and note $\\nabla N_i$ are constants on $K$. The SUPG contribution to the discrete equations, when expressed in terms of the nodal unknowns $\\{u_j\\}_{j=1}^3$, takes the form\n$$\n\\sum_{i=1}^3 \\sum_{j=1}^3 \\left[\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,\\big(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j\\big)\\,dx\\right] u_j\n=\n\\sum_{i=1}^3 \\left[\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,f\\,dx\\right],\n$$\nwhich identifies the element-level matrix and vector entries as\n$$\nK^{\\text{SUPG}}_{e,ij} = \\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,\\big(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j\\big)\\,dx,\n\\qquad\nb^{\\text{SUPG}}_{e,i} = \\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,f\\,dx.\n$$\nThese integrals are evaluated by quadrature. Using a rule $\\{\\hat{\\boldsymbol{\\xi}}_q,\\hat{\\omega}_q\\}_{q=1}^{N_q}$ on the reference triangle $\\hat{K}$ with the affine map $F_K$ and Jacobian determinant $J_K$, define $\\boldsymbol{x}_q=F_K(\\hat{\\boldsymbol{\\xi}}_q)$ and $\\omega_q=\\hat{\\omega}_q\\,J_K$. For linear elements with elementwise constants, the integrands are at most linear in space, so a quadrature exact to degree at least $1$ suffices. The element assembly proceeds by:\n- Precomputing $\\nabla N_i$ and $\\boldsymbol{\\beta}\\cdot\\nabla N_i$ (constant over $K$) and choosing $\\tau_K$.\n- For each quadrature point $q$, computing $N_j(\\boldsymbol{x}_q)$, $u_h(\\boldsymbol{x}_q)=\\sum_j N_j(\\boldsymbol{x}_q)\\,u_j$, $\\nabla u_h=\\sum_j \\nabla N_j\\,u_j$, and then $r_q = \\boldsymbol{\\beta}\\cdot\\nabla u_h + \\sigma\\,u_h(\\boldsymbol{x}_q) - f(\\boldsymbol{x}_q)$.\n- Accumulating the matrix entries via $\\omega_q\\,\\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j(\\boldsymbol{x}_q))$ and the right-hand side via $\\omega_q\\,\\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,f(\\boldsymbol{x}_q)$.\n\nThis procedure is consistent with the principle that, for a linear problem, the SUPG term contributes both to the left-hand side (through the parts of $r(u_h)$ that depend on $u_h$) and to the right-hand side (through the source $f$). With this in mind, we analyze each option.\n\nOption A: This option adheres to the Petrov–Galerkin definition. It:\n- Uses $w_h^{\\text{SUPG}}-w_h=\\tau_K\\,\\boldsymbol{\\beta}\\cdot\\nabla w_h$ in the element integral.\n- Forms the strong residual pointwise and correctly recognizes that $-\\nabla\\cdot(\\kappa\\nabla u_h)=0$ inside $K$ for piecewise linear $u_h$ and elementwise constant $\\kappa$.\n- Splits the SUPG term into a bilinear contribution $\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_j + \\sigma\\,N_j)\\,dx$ and a linear contribution $\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,f\\,dx$, matching the derivation above.\n- Evaluates $\\boldsymbol{\\beta}\\cdot\\nabla w_h$ through $\\boldsymbol{\\beta}\\cdot\\nabla N_i$, which are constant on $K$, and uses quadrature for the $N_j$ and $f$ dependence.\nTherefore, Option A is Correct.\n\nOption B: This option assembles only a right-hand side vector by inserting the current discrete residual $r_q$ and sets $K^{\\text{SUPG}}_e=\\boldsymbol{0}$. For a linear problem, this produces an inconsistent discretization because the SUPG term is linear in $u_h$ and must contribute to the left-hand side through the parts of $r(u_h)$ that depend on $u_h$. Treating the entire SUPG term as a load makes the method dependent on a nonlinear iteration even though the underlying operator is linear, and, without forming the corresponding tangent, leads to either no stabilization in the matrix or a fixed-point linearization that is not equivalent to the SUPG bilinear form. Hence, Option B is Incorrect.\n\nOption C: This option replaces the streamline-weighted test function derivative $\\boldsymbol{\\beta}\\cdot\\nabla w_h$ by $\\left|\\boldsymbol{\\beta}\\right|\\,w_h$. This violates the Petrov–Galerkin definition because the stabilization must act in the streamline direction via derivatives of $w_h$, not via $w_h$ itself scaled by $\\left|\\boldsymbol{\\beta}\\right|$. The resulting $K^{\\text{SUPG}}_e$ is not consistent with the SUPG term and introduces an artificial mass-like term rather than streamline diffusion, and it omits the reaction and source contributions as required by the strong residual. Therefore, Option C is Incorrect.\n\nOption D: This option attempts to incorporate diffusion inside the SUPG residual via $-\\kappa\\,\\Delta N_j$. For linear shape functions on an affine triangle, we have $\\Delta N_j=0$ in $K$, so the $-\\kappa\\,\\Delta N_j$ term vanishes and should not appear. Including a nonzero approximation of this term contradicts the exact residual structure for elementwise constant $\\kappa$. Consequently, this option either adds spurious diffusion or relies on an inconsistent second-derivative recovery. Thus, Option D is Incorrect.\n\nOption E: This option has the correct left-hand side bilinear form but introduces the source term with a negative sign in the right-hand side, i.e., $b^{\\text{SUPG}}_{e,i} = -\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla N_i)\\,f\\,dx$. From the definition $r(u_h)= (\\text{operator on }u_h) - f$, the SUPG term in the weak form is $\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla w_h)\\,\\big[(\\text{operator on }u_h) - f\\big]\\,dx$. The contributions involving $u_h$ belong on the left-hand side, while the term with $-f$ moves to the right-hand side as $+\\int_K \\tau_K\\,(\\boldsymbol{\\beta}\\cdot\\nabla w_h)\\,f\\,dx$. Hence the correct sign for the source contribution in $b^{\\text{SUPG}}_e$ is positive, not negative. Therefore, Option E is Incorrect.\n\nIn summary, only Option A matches the SUPG formulation, the strong residual structure for linear triangles with elementwise constant coefficients, and the required quadrature-based assembly that evaluates $r(u_h)$ and $\\boldsymbol{\\beta}\\cdot\\nabla w_h$ at quadrature points.", "answer": "$$\\boxed{A}$$", "id": "2602122"}]}