{"hands_on_practices": [{"introduction": "To build a strong foundation, we begin with a direct, hands-on comparison of the penalty and elimination methods. This exercise ([@problem_id:2555746]) uses a simple two-element model, which makes the underlying algebra transparent. By solving the system symbolically, you will derive the exact form of the penalized solution and see precisely how it converges to the solution obtained by direct elimination as the penalty parameter $\\alpha$ tends to infinity.", "problem": "Consider the one-dimensional model problem on the domain $\\Omega=[0,1]$: find a scalar field $u$ satisfying the strong form $-\\dfrac{d^{2}u}{dx^{2}}=0$ on $(0,1)$ with essential boundary conditions $u(0)=0$ and $u(1)=1$. Use a conforming finite element discretization with continuous, piecewise-linear trial and test spaces over a uniform mesh with nodes at $x_{1}=0$, $x_{2}=\\tfrac{1}{2}$, and $x_{3}=1$ (i.e., $2$ linear elements of equal length). Assume no body force and no natural boundary conditions, and take the diffusion coefficient to be $1$.\n\nRather than imposing the essential boundary conditions directly, enforce them via the penalty method at the boundary nodes $x=0$ and $x=1$ with a penalty parameter $\\alpha>0$, added at the algebraic level to the assembled system. Specifically, assemble the discrete bilinear form induced by the weak form and add the penalty contributions at the first and last global degrees of freedom to obtain a modified linear system depending on $\\alpha$. Solve the penalized system to obtain the global nodal solution vector $u(\\alpha)=[u_{1}(\\alpha),u_{2}(\\alpha),u_{3}(\\alpha)]$, then compute the limit of $u(\\alpha)$ as $\\alpha\\to\\infty$ and compare it to the solution obtained by the elimination method, which exactly enforces $u_{1}=0$ and $u_{3}=1$ and solves only for the interior node.\n\nAll quantities are nondimensional. Provide, as your final answer, the vector limit $\\lim_{\\alpha\\to\\infty}u(\\alpha)$ as a single row vector. Express the final answer in exact form (no rounding).", "solution": "The problem statement is subjected to validation before any attempt at a solution is made.\n\n**Step 1: Extract Givens**\n-   Differential Equation (Strong Form): $-\\dfrac{d^{2}u}{dx^{2}}=0$ on the interval $(0,1)$.\n-   Domain: $\\Omega=[0,1]$.\n-   Essential Boundary Conditions: $u(0)=0$ and $u(1)=1$.\n-   Finite Element Discretization: A conforming mesh with three nodes at $x_{1}=0$, $x_{2}=\\tfrac{1}{2}$, and $x_{3}=1$. This corresponds to two linear elements of equal length $h=\\tfrac{1}{2}$. The trial and test spaces are continuous and piecewise-linear.\n-   Model Parameters: Diffusion coefficient is $1$. Body force is zero. No natural boundary conditions are specified on the boundaries where essential conditions are applied.\n-   Task: Enforce the essential boundary conditions using the penalty method with a parameter $\\alpha > 0$. Solve the resulting algebraic system for the nodal solution vector $u(\\alpha)=[u_{1}(\\alpha), u_{2}(\\alpha), u_{3}(\\alpha)]$. Compute the limit $\\lim_{\\alpha\\to\\infty}u(\\alpha)$ and compare it to the solution obtained via the elimination method.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded**: The problem is a standard one-dimensional Poisson equation, a fundamental model in physics and engineering. The Finite Element Method (FEM), penalty method, and elimination method are all standard, well-established numerical techniques. The problem is scientifically sound.\n-   **Well-Posed**: The boundary value problem is well-posed and has a unique analytical solution. The corresponding FEM problem is also well-posed.\n-   **Objective**: The problem is stated using precise, objective mathematical language.\n-   **Completeness**: All necessary information (governing equation, domain, boundary conditions, discretization details) is provided. The problem is self-contained.\n-   **Consistency**: There are no contradictions in the provided data or requirements.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A complete, reasoned solution will be provided.\n\n**Derivation of the Weak Form**\nThe strong form of the problem is given by $-\\dfrac{d^{2}u}{dx^{2}} = 0$ for $x \\in (0,1)$.\nTo derive the weak form, we multiply the equation by a test function $v(x)$ from an appropriate test space and integrate over the domain $\\Omega=[0,1]$:\n$$-\\int_{0}^{1} \\frac{d^{2}u}{dx^{2}} v(x) dx = 0$$\nApplying integration by parts to the left-hand side yields:\n$$\\int_{0}^{1} \\frac{du}{dx} \\frac{dv}{dx} dx - \\left[ \\frac{du}{dx} v(x) \\right]_{0}^{1} = 0$$\nThe boundary term $\\left[ \\frac{du}{dx} v(x) \\right]_{0}^{1}$ is zero because we will eventually enforce essential boundary conditions at $x=0$ and $x=1$.\nThe weak form is to find $u \\in V$ such that for all $v \\in V$:\n$$a(u,v) = \\int_{0}^{1} \\frac{du}{dx} \\frac{dv}{dx} dx = 0$$\nHere, since the body force is zero, the right-hand-side linear functional is zero.\n\n**Finite Element Discretization**\nWe discretize the domain into two linear elements of length $h=\\frac{1}{2}$. The unknown field $u(x)$ is approximated as $u_h(x) = \\sum_{j=1}^{3} u_j N_j(x)$, where $u_j$ are the nodal values $u(x_j)$ and $N_j(x)$ are the piecewise-linear (hat) basis functions. This leads to the algebraic system $\\mathbf{K}\\mathbf{u} = \\mathbf{F}$.\n\nThe stiffness matrix for a single linear element of length $h_e$ with a unit diffusion coefficient is:\n$$\\mathbf{k}^e = \\frac{1}{h_e} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$$\nFor our problem, $h_e = \\frac{1}{2}$, so the element stiffness matrices for element 1 (nodes 1, 2) and element 2 (nodes 2, 3) are identical:\n$$\\mathbf{k}^{(1)} = \\mathbf{k}^{(2)} = \\frac{1}{1/2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} = \\begin{pmatrix} 2 & -2 \\\\ -2 & 2 \\end{pmatrix}$$\nAssembling these into the $3 \\times 3$ global stiffness matrix $\\mathbf{K}$ yields:\n$$\\mathbf{K} = \\begin{pmatrix} 2 & -2 & 0 \\\\ -2 & 2+2 & -2 \\\\ 0 & -2 & 2 \\end{pmatrix} = \\begin{pmatrix} 2 & -2 & 0 \\\\ -2 & 4 & -2 \\\\ 0 & -2 & 2 \\end{pmatrix}$$\nSince there are no body forces or natural boundary conditions, the global force vector $\\mathbf{F}$ is the zero vector, $\\mathbf{F}=[0, 0, 0]^T$. The unconstrained system is $\\mathbf{K}\\mathbf{u}=\\mathbf{0}$.\n\n**Penalty Method**\nWe enforce the essential boundary conditions $u_1=0$ and $u_3=1$ using the penalty method. This involves modifying the diagonal entries of the stiffness matrix and the corresponding entries of the force vector.\nFor the condition $u_1 = 0$, we modify the first equation: $K_{11}$ becomes $K_{11}+\\alpha$ and $F_1$ becomes $F_1 + \\alpha \\cdot 0$.\nFor the condition $u_3 = 1$, we modify the third equation: $K_{33}$ becomes $K_{33}+\\alpha$ and $F_3$ becomes $F_3 + \\alpha \\cdot 1$.\n\nThe penalized system of equations, $\\mathbf{K}_\\alpha \\mathbf{u}(\\alpha) = \\mathbf{F}_\\alpha$, is:\n$$\\begin{pmatrix} 2+\\alpha & -2 & 0 \\\\ -2 & 4 & -2 \\\\ 0 & -2 & 2+\\alpha \\end{pmatrix} \\begin{pmatrix} u_1(\\alpha) \\\\ u_2(\\alpha) \\\\ u_3(\\alpha) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ \\alpha \\end{pmatrix}$$\nTo solve for the vector $\\mathbf{u}(\\alpha)$, we find the inverse of $\\mathbf{K}_\\alpha$. The determinant is:\n$$\\det(\\mathbf{K}_\\alpha) = (2+\\alpha)[4(2+\\alpha)-4] - (-2)[-2(2+\\alpha)] = (2+\\alpha)(4\\alpha+4) - 4(2+\\alpha) = (2+\\alpha)(4\\alpha) = 4\\alpha(\\alpha+2)$$\nThe solution is $\\mathbf{u}(\\alpha) = \\mathbf{K}_\\alpha^{-1} \\mathbf{F}_\\alpha = \\frac{1}{\\det(\\mathbf{K}_\\alpha)} \\text{adj}(\\mathbf{K}_\\alpha) \\mathbf{F}_\\alpha$. The adjugate matrix is:\n$$\\text{adj}(\\mathbf{K}_\\alpha) = \\begin{pmatrix} 4\\alpha+4 & 2\\alpha+4 & 4 \\\\ 2\\alpha+4 & (2+\\alpha)^2 & 2\\alpha+4 \\\\ 4 & 2\\alpha+4 & 4\\alpha+4 \\end{pmatrix}$$\nMultiplying by the force vector $\\mathbf{F}_\\alpha$:\n$$\\mathbf{u}(\\alpha) = \\frac{1}{4\\alpha(\\alpha+2)} \\begin{pmatrix} 4\\alpha+4 & 2\\alpha+4 & 4 \\\\ 2\\alpha+4 & \\alpha^2+4\\alpha+4 & 2\\alpha+4 \\\\ 4 & 2\\alpha+4 & 4\\alpha+4 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ \\alpha \\end{pmatrix} = \\frac{1}{4\\alpha(\\alpha+2)} \\begin{pmatrix} 4\\alpha \\\\ \\alpha(2\\alpha+4) \\\\ \\alpha(4\\alpha+4) \\end{pmatrix}$$\nSimplifying the expression for each component:\n$$u_1(\\alpha) = \\frac{4\\alpha}{4\\alpha(\\alpha+2)} = \\frac{1}{\\alpha+2}$$\n$$u_2(\\alpha) = \\frac{\\alpha(2\\alpha+4)}{4\\alpha(\\alpha+2)} = \\frac{2\\alpha(\\alpha+2)}{4\\alpha(\\alpha+2)} = \\frac{1}{2}$$\n$$u_3(\\alpha) = \\frac{\\alpha(4\\alpha+4)}{4\\alpha(\\alpha+2)} = \\frac{4\\alpha(\\alpha+1)}{4\\alpha(\\alpha+2)} = \\frac{\\alpha+1}{\\alpha+2}$$\nThe solution vector as a function of $\\alpha$ is $\\mathbf{u}(\\alpha) = \\begin{pmatrix} \\frac{1}{\\alpha+2} & \\frac{1}{2} & \\frac{\\alpha+1}{\\alpha+2} \\end{pmatrix}^T$.\n\n**Limit as $\\alpha \\to \\infty$**\nWe now compute the limit of the solution as the penalty parameter $\\alpha$ approaches infinity:\n$$\\lim_{\\alpha\\to\\infty} u_1(\\alpha) = \\lim_{\\alpha\\to\\infty} \\frac{1}{\\alpha+2} = 0$$\n$$\\lim_{\\alpha\\to\\infty} u_2(\\alpha) = \\lim_{\\alpha\\to\\infty} \\frac{1}{2} = \\frac{1}{2}$$\n$$\\lim_{\\alpha\\to\\infty} u_3(\\alpha) = \\lim_{\\alpha\\to\\infty} \\frac{\\alpha+1}{\\alpha+2} = \\lim_{\\alpha\\to\\infty} \\frac{1+1/\\alpha}{1+2/\\alpha} = 1$$\nThe limiting solution vector is $\\lim_{\\alpha\\to\\infty} \\mathbf{u}(\\alpha) = \\begin{pmatrix} 0 & \\frac{1}{2} & 1 \\end{pmatrix}^T$.\n\n**Comparison with Elimination Method**\nThe elimination method enforces the boundary conditions exactly. We start with the unconstrained system $\\mathbf{K}\\mathbf{u}=\\mathbf{F}$:\n$$\\begin{pmatrix} 2 & -2 & 0 \\\\ -2 & 4 & -2 \\\\ 0 & -2 & 2 \\end{pmatrix} \\begin{pmatrix} u_1 \\\\ u_2 \\\\ u_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\nThe boundary conditions are $u_1=0$ and $u_3=1$. The second equation of the system involves the only unknown, $u_2$:\n$$-2u_1 + 4u_2 - 2u_3 = 0$$\nSubstituting the known values of $u_1$ and $u_3$:\n$$-2(0) + 4u_2 - 2(1) = 0$$\n$$4u_2 - 2 = 0$$\n$$4u_2 = 2 \\implies u_2 = \\frac{1}{2}$$\nThe solution obtained via elimination is $\\mathbf{u} = \\begin{pmatrix} 0 & \\frac{1}{2} & 1 \\end{pmatrix}^T$. This result is identical to the limit of the penalty method solution. This is expected, as the penalty method is theoretically consistent and converges to the exact solution of the constrained system as $\\alpha \\to \\infty$. The analytical solution to the differential equation is $u(x)=x$, which gives $u(\\frac{1}{2}) = \\frac{1}{2}$, confirming the exactness of the nodal solution.\nThe final answer is the row vector representing the limit of the penalty solution.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{1}{2} & 1\n\\end{pmatrix}\n}\n$$", "id": "2555746"}, {"introduction": "With a conceptual understanding of the methods, we now shift our focus to the practicalities of implementation. This practice ([@problem_id:2555792]) delves into the algorithmic logic of the elimination method, a common technique in commercial and open-source finite element codes. You will evaluate different pseudocode options to learn how to correctly and efficiently modify a global system to enforce Dirichlet conditions, paying close attention to the preservation of matrix symmetry.", "problem": "Consider a linear system $K u = f$ arising from the Galerkin discretization of a self-adjoint scalar Partial Differential Equation (PDE) with essential (Dirichlet) boundary conditions in the Finite Element Method (FEM). Assume $K \\in \\mathbb{R}^{n \\times n}$ is symmetric, $u \\in \\mathbb{R}^{n}$ is the vector of nodal unknowns, and $f \\in \\mathbb{R}^{n}$ is the load vector. Let the index set of prescribed (Dirichlet) degrees of freedom be $D \\subset \\{1,\\dots,n\\}$ with nonzero prescribed values $u_D = g \\in \\mathbb{R}^{|D|}$, and the complementary set of free degrees of freedom be $I = \\{1,\\dots,n\\} \\setminus D$. The elimination approach seeks to enforce the Dirichlet data exactly by algebraic manipulation of $K$ and $f$ such that symmetry is preserved in the system to be solved.\n\nStarting from the block-partitioned form\n$$\n\\begin{bmatrix}\nK_{I I} & K_{I D} \\\\\nK_{D I} & K_{D D}\n\\end{bmatrix}\n\\begin{bmatrix}\nu_I \\\\ u_D\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nf_I \\\\ f_D\n\\end{bmatrix},\n$$\nand the fact that $u_D = g$ is known, derive a symmetry-preserving elimination procedure from first principles. Then, select all pseudocode options below that correctly and completely implement algebraic elimination that:\n- uses the eliminated columns of $K$ to modify the right-hand side (load vector),\n- enforces $u_D = g$ exactly,\n- and preserves symmetry of the matrix in the system actually solved (either by reducing to the $I \\times I$ subsystem or by producing a full-size symmetric modified system).\n\nAssume sparse linear algebra and that assignments of the form $x := y$ overwrite $x$ with $y$, and operations like $K(:,D)$ and $K(D,:)$ denote the submatrix of columns or rows indexed by $D$, respectively. All vectors are column vectors. Choose all that apply.\n\nA. Pseudocode:\n- Input: $K$, $f$, $D$, $g$, with $I = \\{1,\\dots,n\\} \\setminus D$.\n- Compute $t := K(:,D)\\, g$.\n- Set $f := f - t$.\n- For each $d \\in D$: zero the $d$-th row and $d$-th column of $K$; set $K_{d d} := 1$ and $f_d := g_d$.\n- Solve $K u = f$.\n\nB. Pseudocode:\n- Input: $K$, $f$, $D$, $g$, with $I = \\{1,\\dots,n\\} \\setminus D$.\n- Compute $t := K(:,D)\\, g$.\n- Set $f := f - t$.\n- For each $d \\in D$: zero only the $d$-th row of $K$; set $K_{d d} := 1$ and $f_d := g_d$.\n- Solve $K u = f$.\n\nC. Pseudocode (penalty):\n- Input: $K$, $f$, $D$, $g$, with $I = \\{1,\\dots,n\\} \\setminus D$, and a large penalty parameter $\\alpha \\gg 0$.\n- Let $P$ be the diagonal selector with $P_{d d} = 1$ for $d \\in D$ and $P_{i i} = 0$ for $i \\in I$.\n- Set $K := K + \\alpha P$ and $f := f + \\alpha P g$.\n- Solve $K u = f$.\n\nD. Pseudocode:\n- Input: $K$, $f$, $D$, $g$, with $I = \\{1,\\dots,n\\} \\setminus D$.\n- Compute $t := K(:,D)\\, g$.\n- Set $f := f - t$.\n- For each $d \\in D$: zero only the $d$-th column of $K$; set $K_{d d} := 1$ and $f_d := g_d$.\n- Solve $K u = f$.\n\nE. Pseudocode (reduced system):\n- Input: $K$, $f$, $D$, $g$, with $I = \\{1,\\dots,n\\} \\setminus D$.\n- Form $K_{I I} := K(I,I)$ and $K_{I D} := K(I,D)$ and $f_I := f(I)$.\n- Compute $\\widehat{f}_I := f_I - K_{I D}\\, g$.\n- Solve $K_{I I}\\, u_I = \\widehat{f}_I$ for $u_I$.\n- Set $u_D := g$ and return $u$ assembled from $u_I$ and $u_D$.\n\nSelect all correct options.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- The system is a linear system of equations $K u = f$.\n- $K \\in \\mathbb{R}^{n \\times n}$ is a symmetric matrix.\n- $u \\in \\mathbb{R}^{n}$ is the vector of unknowns.\n- $f \\in \\mathbb{R}^{n}$ is the load vector.\n- The system originates from a Galerkin Finite Element Method discretization of a self-adjoint scalar PDE.\n- $D$ is the index set of degrees of freedom with prescribed essential (Dirichlet) boundary conditions.\n- The prescribed values are $u_D = g$, where $g$ is a vector of nonzero values.\n- $I = \\{1,\\dots,n\\} \\setminus D$ is the index set of free degrees of freedom.\n- The system is partitioned as:\n$$\n\\begin{bmatrix}\nK_{I I} & K_{I D} \\\\\nK_{D I} & K_{D D}\n\\end{bmatrix}\n\\begin{bmatrix}\nu_I \\\\\nu_D\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nf_I \\\\\nf_D\n\\end{bmatrix}\n$$\n- The task is to derive and identify correct pseudocode implementations for a symmetry-preserving algebraic elimination procedure that enforces $u_D = g$ exactly.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, describing a canonical procedure in computational mechanics and the finite element method. It is well-posed, as it asks for the derivation and verification of standard, well-defined algorithms. The language is objective and precise. The provided information is complete and consistent for the task. The problem is a standard exercise in numerical linear algebra as applied to engineering and is neither trivial nor ill-posed.\n\n**Step 3: Verdict and Action**\nThe problem statement is **valid**. A solution will be derived from first principles, followed by an evaluation of each option.\n\n---\n\n**Derivation from First Principles**\n\nThe starting point is the partitioned linear system:\n$$\n\\begin{align*}\nK_{I I} u_I + K_{I D} u_D &= f_I \\quad &(1) \\\\\nK_{D I} u_I + K_{D D} u_D &= f_D \\quad &(2)\n\\end{align*}\n$$\nThe essential boundary condition is $u_D = g$, where $g$ is a known vector. We substitute this into equation $(1)$:\n$$\nK_{I I} u_I + K_{I D} g = f_I\n$$\nThis equation involves only the unknown degrees of freedom $u_I$. We can rearrange it to form a system to be solved for $u_I$:\n$$\nK_{I I} u_I = f_I - K_{I D} g\n$$\nThis is a reduced system of equations of size $|I| \\times |I|$. Since the original matrix $K$ is symmetric, its principal submatrix $K_{I I}$ is also symmetric. For a well-posed PDE problem, $K$ is also positive definite, which implies $K_{I I}$ is also positive definite and thus invertible. A unique solution for $u_I$ exists. After solving for $u_I$, the complete solution vector $u$ is assembled from the computed $u_I$ and the known $u_D = g$. This constitutes the **reduced system approach**.\n\nAn alternative is to modify the full $n \\times n$ system $K u = f$ into a new system $K' u = f'$ that has the correct solution and where $K'$ is symmetric. The solution must satisfy $u_D = g$ and $K_{I I} u_I = f_I - K_{I D} g$.\n\nTo enforce $u_D = g$, we can modify the rows of the system corresponding to the index set $D$. For each $d \\in D$, we desire the equation to become $1 \\cdot u_d = g_d$. This is achieved by setting the $d$-th row of the modified matrix $K'$ to be all zeros except for a $1$ at the diagonal position $(d,d)$, and setting the $d$-th element of the right-hand side vector $f'$ to $g_d$.\nIn block form, this means:\n- $K'_{D I} = 0$\n- $K'_{D D} = I$ (the identity matrix)\n- $f'_D = g$\n\nTo preserve the symmetry of the matrix, we must also zero out the corresponding columns. That is, for each $d \\in D$, the $d$-th column must be zeroed, except for the diagonal element which is already set to $1$. This implies:\n- $K'_{I D} = 0$\n\nThe modified matrix $K'$ therefore has the block structure:\n$$\nK' = \\begin{bmatrix} K_{I I} & 0 \\\\ 0 & I \\end{bmatrix}\n$$\nThis matrix is symmetric, as required.\n\nNow, we must determine the modified right-hand side $f'$. The upper block of the system $K'u = f'$ reads:\n$$\nK'_{I I} u_I + K'_{I D} u_D = f'_I\n$$\nWith our modifications, this becomes $K_{I I} u_I = f'_I$. For this to yield the correct solution for $u_I$, we must have $f'_I = f_I - K_{I D} g$.\n\nPutting this together, the final modified system, which is symmetric and gives the correct solution, is:\n$$\n\\begin{bmatrix} K_{I I} & 0 \\\\ 0 & I \\end{bmatrix} \\begin{bmatrix} u_I \\\\ u_D \\end{bmatrix} = \\begin{bmatrix} f_I - K_{I D} g \\\\ g \\end{bmatrix}\n$$\nAn algorithm to achieve this modification on the full matrix $K$ and vector $f$ is as follows:\n1.  Compute the contribution of the prescribed displacements to the forces: $t = K(:,D) g$.\n2.  Subtract this from the original force vector: $f \\leftarrow f - t$. Now, the partition $f_I$ has the correct value $f_I - K_{I D} g$.\n3.  For each $d \\in D$, enforce the condition $u_d=g_d$ by:\n    a. Zeroing out row $d$ and column $d$ of $K$.\n    b. Setting $K_{dd} = 1$.\n    c. Setting $f_d = g_d$. This step overwrites the temporary value of $f_d$ from step $2$ with the prescribed displacement value.\n\nThis constitutes the **full-system modification approach**.\n\n**Option-by-Option Analysis**\n\n**A. Pseudocode:**\n- `Compute t := K(:,D) g`: Correctly computes the vector whose $i$-th component is $\\sum_{j \\in D} K_{ij} g_j$.\n- `Set f := f - t`: Correctly updates the right-hand side. The free partition becomes $f_I \\leftarrow f_I - K_{I D} g$.\n- `For each d in D: zero the d-th row and d-th column of K; set K_dd := 1 and f_d := g_d`: This implements the matrix modification and RHS finalization for the constrained degrees of freedom. Crucially, zeroing both the row and column preserves the symmetry of the matrix. Setting $K_{dd}=1$ and $f_d=g_d$ correctly forms the equation $1 \\cdot u_d = g_d$.\n- `Solve K u = f`: Solves the correctly formulated, symmetric system.\nThis algorithm perfectly matches the derived full-system modification approach. It satisfies all problem requirements.\nVerdict: **Correct**.\n\n**B. Pseudocode:**\n- The first two steps are identical to A.\n- `For each d in D: zero only the d-th row of K; set K_dd := 1 and f_d := g_d`: This is the point of failure. By zeroing only the row and not the corresponding column for $d \\in D$, the modified matrix $K'$ is no longer symmetric, since $K'_{d,i} = 0$ for $i \\ne d$ but $K'_{i,d} = K_{i,d}$ for $i \\in I$. This violates a key requirement of the problem. Further, this asymmetry leads to an incorrect solution for $u_I$, as the top block of the system becomes $K_{II} u_I + K_{ID} u_D = f_I - K_{ID} g$. Substituting $u_D=g$ (which is correctly enforced by the lower block) gives $K_{II} u_I = f_I - 2 K_{ID} g$, which is incorrect.\nVerdict: **Incorrect**.\n\n**C. Pseudocode (penalty):**\nThis describes the penalty method. The problem explicitly asks for an \"algebraic elimination\" procedure. The penalty method is an alternative approach based on approximation. It modifies the system to $(K + \\alpha P) u = f + \\alpha P g$. This method does not enforce the condition $u_D = g$ exactly; rather, it yields a solution where $u_D \\approx g$, with the accuracy dependent on the magnitude of the penalty parameter $\\alpha$. The problem demands exact enforcement. Thus, this option is incorrect on two fundamental grounds: it is not the elimination method, and it is not exact.\nVerdict: **Incorrect**.\n\n**D. Pseudocode:**\n- The first two steps are identical to A.\n- `For each d in D: zero only the d-th column of K; set K_dd := 1 and f_d := g_d`: This is analogous to option B's flaw. By zeroing only the column and not the corresponding row, the resulting matrix is not symmetric. The requirement for symmetry is violated. Furthermore, this leads to an incorrect enforcement of the boundary condition. The top block correctly yields $K_{II} u_I = f_I - K_{ID} g$, so $u_I$ is found correctly. However, the bottom block becomes $K_{DI} u_I + I u_D = g$, which means $u_D = g - K_{DI} u_I$. This is not equal to $g$ unless $K_{DI} u_I = 0$, which is not true in general. The condition $u_D = g$ is not enforced.\nVerdict: **Incorrect**.\n\n**E. Pseudocode (reduced system):**\n- `Form K_II := K(I,I) and K_ID := K(I,D) and f_I := f(I)`: Correctly extracts the sub-blocks needed for the reduced system.\n- `Compute \\hat{f}_I := f_I - K_ID g`: Correctly computes the modified right-hand side for the free degrees of freedom, as derived from first principles.\n- `Solve K_II u_I = \\hat{f}_I for u_I`: Solves the correct, reduced system. The matrix $K_{II}$ is a principal submatrix of the symmetric matrix $K$ and is therefore itself symmetric. So, the system being solved has a symmetric matrix.\n- `Set u_D := g and return u assembled from u_I and u_D`: Correctly assembles the final solution vector, enforcing the Dirichlet condition exactly.\nThis algorithm perfectly matches the derived reduced system approach. It satisfies all problem requirements.\nVerdict: **Correct**.", "answer": "$$\\boxed{AE}$$", "id": "2555792"}, {"introduction": "The final step in robust computational work is verification: ensuring your code produces the correct results. This exercise ([@problem_id:2555769]) challenges you to design effective unit tests for boundary condition enforcement. You will connect the theoretical error characteristics of both the elimination and penalty methods—specifically the $\\mathcal{O}(\\alpha^{-1})$ convergence of the boundary error for the latter—to the design of practical, automated tests that confirm your implementation is behaving as expected.", "problem": "Consider the scalar model problem of the Poisson equation on the interval $\\Omega = [0,1]$ with prescribed Dirichlet boundary data: find $u$ such that $-u'' = f$ in $\\Omega$ with $u = g$ on $\\partial \\Omega$. Let $u_h$ be the conforming piecewise-linear finite element approximation obtained by the Finite Element Method (FEM), and let $g_h$ denote the nodal interpolant of $g$ at the constrained nodes indexed by $\\mathcal{I}_c$. Two standard strategies are used to enforce the essential boundary condition $u = g$:\n\n(1) Elimination: Partition the degrees of freedom into free and constrained sets indexed by $\\mathcal{I}_f$ and $\\mathcal{I}_c$, respectively. Set $(u_h)_i = (g_h)_i$ for all $i \\in \\mathcal{I}_c$, and eliminate these unknowns from the linear system by modifying the right-hand side and, if desired, the stiffness matrix.\n\n(2) Penalty: Leave all degrees of freedom in the system, and enforce $u = g$ weakly by augmenting the bilinear form with a symmetric penalty term proportional to a positive parameter $\\alpha$, resulting in a linear system of the form\n$$\n(K + \\alpha B^\\top B) \\, u_h = f_h + \\alpha B^\\top g_h,\n$$\nwhere $K$ is the standard stiffness matrix assembled on the full space without elimination, $B$ is a Boolean selector mapping the global vector to the constrained components, and $f_h$ is the load vector. Assume $K$ is Symmetric Positive Definite (SPD) on the free subspace and $\\alpha > 0$.\n\nA robust unit test suite should verify, at minimum, that boundary enforcement is correct to machine precision under elimination and that, under the penalty approach, the boundary mismatch decreases at the theoretically expected rate with respect to $\\alpha$. Let $\\epsilon_{\\text{mach}}$ denote machine precision, and define the boundary mismatch metric\n$$\ne_{\\infty}^{\\text{bc}}(\\alpha) \\coloneqq \\max_{i \\in \\mathcal{I}_c} \\left| (u_h)_i - (g_h)_i \\right|.\n$$\n\nWhich of the following test designs are mathematically justified and well-scaled for implementation-level unit tests that are stable under mesh refinement and independent of problem-specific units?\n\nA. Elimination: After solving with elimination, assert\n$$\ne_{\\infty}^{\\text{bc}} \\le c \\, \\epsilon_{\\text{mach}} \\, \\max \\!\\left( 1, \\|g_h\\|_{\\infty} \\right),\n$$\nwith a modest constant $c$ (for example $c = 10^3$) to allow for accumulated roundoff, where $\\|g_h\\|_{\\infty} \\coloneqq \\max_{i \\in \\mathcal{I}_c} |(g_h)_i|$. Penalty: For a fixed mesh, solve for three increasing penalty parameters $\\alpha \\in \\{10^2, 10^4, 10^6\\}$, compute $e_{\\infty}^{\\text{bc}}(\\alpha)$, and assert both monotonicity\n$$\ne_{\\infty}^{\\text{bc}}(10^6) \\le e_{\\infty}^{\\text{bc}}(10^4) \\le e_{\\infty}^{\\text{bc}}(10^2),\n$$\nand $\\mathcal{O}(\\alpha^{-1})$ scaling by requiring the scaled products to be approximately constant within a fixed factor $q$ (for example $q = 5$):\n$$\n\\frac{\\max_{\\alpha \\in \\{10^2,10^4,10^6\\}} \\alpha \\, e_{\\infty}^{\\text{bc}}(\\alpha)}{\\min_{\\alpha \\in \\{10^2,10^4,10^6\\}} \\alpha \\, e_{\\infty}^{\\text{bc}}(\\alpha)} \\le q.\n$$\n\nB. Penalty: Accept the solution as correct if $e_{\\infty}^{\\text{bc}}(\\alpha) \\le c$ with a fixed tolerance $c$ independent of $\\alpha$ and the mesh size, without comparing different $\\alpha$ values.\n\nC. Elimination: Because discretization error is present, allow a boundary mismatch tolerance $e_{\\infty}^{\\text{bc}} \\le C h$ proportional to the mesh size $h$ (with some constant $C$), instead of a machine-precision-scaled tolerance.\n\nD. Penalty: Because increasing $\\alpha$ penalizes deviations more strongly, require a tolerance that grows proportionally with $\\alpha$, i.e., $e_{\\infty}^{\\text{bc}}(\\alpha) \\le C \\alpha$, and do not check behavior across multiple $\\alpha$ values.\n\nSelect all options that are correct. Justify your choice from first principles, beginning with the algebraic structure of the discretized systems for elimination and for the penalty method, and derive the expected boundary mismatch scaling in each case to support or refute each proposed unit test. Assume standard floating-point arithmetic and that any norms and constants are computed in a dimensionally consistent way.", "solution": "The user has provided a problem statement concerning the design of unit tests for enforcing essential (Dirichlet) boundary conditions in the Finite Element Method (FEM). This requires a critical validation of the problem statement before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **Problem:** Scalar Poisson equation, $-u'' = f$, on the domain $\\Omega = [0,1]$.\n- **Boundary Conditions:** Dirichlet type, $u = g$ on $\\partial \\Omega$.\n- **Approximation:** $u_h$ is a conforming piecewise-linear finite element approximation.\n- **Discrete Boundary Data:** $g_h$ is the nodal interpolant of $g$ at constrained nodes.\n- **Index Sets:** $\\mathcal{I}_f$ for free degrees of freedom (DOFs), $\\mathcal{I}_c$ for constrained DOFs.\n- **Method 1 (Elimination):** Set $(u_h)_i = (g_h)_i$ for all $i \\in \\mathcal{I}_c$ and solve for the remaining DOFs.\n- **Method 2 (Penalty):** Solve the augmented system $(K + \\alpha B^\\top B) \\, u_h = f_h + \\alpha B^\\top g_h$.\n- **Assumptions:** $K$ is the standard stiffness matrix. $K$ is Symmetric Positive Definite (SPD) on the free subspace. $\\alpha > 0$ is the penalty parameter. $B$ is a Boolean selector for constrained components. $f_h$ is the load vector.\n- **Metric:** The boundary mismatch is defined as $e_{\\infty}^{\\text{bc}}(\\alpha) \\coloneqq \\max_{i \\in \\mathcal{I}_c} \\left| (u_h)_i - (g_h)_i \\right|$.\n- **Machine Precision:** $\\epsilon_{\\text{mach}}$.\n- **Question:** Evaluate which of the four proposed test designs (A, B, C, D) are mathematically justified and well-scaled for robust unit testing.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is examined for validity.\n1.  **Scientific or Factual Unsoundness:** The problem describes a standard model problem (1D Poisson equation) and two canonical, widely-used methods for enforcing Dirichlet boundary conditions in FEM: elimination and penalty. The algebraic representation of the penalty method is correct. The concepts of machine precision, roundoff error, and convergence rate testing are fundamental to numerical analysis and scientific computing. The problem is scientifically sound.\n2.  **Non-Formalizable or Irrelevant:** The problem is highly formal and directly relevant to the topic of numerical implementation and verification of finite element methods.\n3.  **Incomplete or Contradictory Setup:** The problem is self-contained. It provides all necessary definitions and context to analyze the proposed test designs. There are no contradictions.\n4.  **Unrealistic or Infeasible:** The setup is a classic, realistic scenario in computational engineering and science.\n5.  **Ill-Posed or Poorly Structured:** The question is precise and admits a definite answer based on the mathematical properties of the described numerical methods.\n6.  **Pseudo-Profound, Trivial, Tautological:** The problem is not trivial. It requires a correct understanding of the algebraic structure of the resulting linear systems and the expected behavior of numerical error (both roundoff and method-inherent error) for both the elimination and penalty approaches.\n7.  **Outside Scientific Verifiability:** The claims can be rigorously verified through mathematical derivation.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. A rigorous derivation of the solution and evaluation of the options may proceed.\n\n### Derivation and Option-by-Option Analysis\n\nThe core of the problem is to determine the expected behavior of the boundary mismatch metric, $e_{\\infty}^{\\text{bc}}$, for both the elimination and penalty methods.\n\n**Analysis of the Elimination Method**\n\nIn the elimination method, the solution vector $u_h$ is partitioned into free components $(u_h)_f$ and constrained components $(u_h)_c$, corresponding to indices in $\\mathcal{I}_f$ and $\\mathcal{I}_c$. The global linear system $K u_h = f_h$ is algebraically manipulated. The values of the constrained components are set by definition: $(u_h)_c = (g_h)_c$. In a computer implementation, this corresponds to a direct assignment.\n$$\n(u_h)_i \\leftarrow (g_h)_i \\quad \\forall i \\in \\mathcal{I}_c\n$$\nThe system is then solved for the free components $(u_h)_f$:\n$$\nK_{ff} (u_h)_f = (f_h)_f - K_{fc} (g_h)_c\n$$\nwhere $K$ has been partitioned into blocks corresponding to free and constrained DOFs. After solving for $(u_h)_f$, the full vector $u_h$ is assembled. By the very definition of the method, the equality $(u_h)_i = (g_h)_i$ holds for all $i \\in \\mathcal{I}_c$ in exact arithmetic. Therefore, $e_{\\infty}^{\\text{bc}} = 0$.\n\nIn finite-precision floating-point arithmetic, the computed value of $(u_h)_i$ after assignment should be identical to the stored value of $(g_h)_i$. The calculated difference $|(u_h)_i - (g_h)_i|$ should be exactly $0$. However, a robust unit test accounts for potential roundoff errors accumulated during the computation of $(g_h)_c$ or in other parts of the code that might (incorrectly) alter the boundary values. A standard practice for comparing floating-point numbers $a$ and $b$ for equality is to use a mixed relative-absolute tolerance, such as $|a-b| \\le \\text{tol}_{\\text{abs}} + \\text{tol}_{\\text{rel}} |b|$. The test proposed in option A, $e_{\\infty}^{\\text{bc}} \\le c \\, \\epsilon_{\\text{mach}} \\, \\max(1, \\|g_h\\|_{\\infty})$, is a form of this check, where the tolerance is scaled by machine precision and the magnitude of the data. This is a mathematically sound and practical approach for a unit test.\n\n**Analysis of the Penalty Method**\n\nThe penalty method enforces the boundary condition weakly through the augmented system:\n$$\n(K + \\alpha B^\\top B) u_h = f_h + \\alpha B^\\top g_h\n$$\nLet's partition the system into free and constrained blocks. The matrix $B^\\top B$ is a diagonal matrix with ones at entries corresponding to indices in $\\mathcal{I}_c$ and zeros elsewhere. Let's denote this matrix by $D_c$. The system is:\n$$\n\\begin{pmatrix} K_{ff} & K_{fc} \\\\ K_{cf} & K_{cc} + \\alpha I \\end{pmatrix}\n\\begin{pmatrix} (u_h)_f \\\\ (u_h)_c \\end{pmatrix}\n=\n\\begin{pmatrix} (f_h)_f \\\\ (f_h)_c + \\alpha (g_h)_c \\end{pmatrix}\n$$\nFrom the second block of equations, we have:\n$$\nK_{cf} (u_h)_f + (K_{cc} + \\alpha I) (u_h)_c = (f_h)_c + \\alpha (g_h)_c\n$$\nRearranging to isolate the boundary mismatch term, $(u_h)_c - (g_h)_c$:\n$$\n\\alpha \\left( (u_h)_c - (g_h)_c \\right) = (f_h)_c - K_{cf} (u_h)_f - K_{cc} (u_h)_c\n$$\n$$\n(u_h)_c - (g_h)_c = \\frac{1}{\\alpha} \\left( (f_h)_c - K_{cf} (u_h)_f - K_{cc} (u_h)_c \\right)\n$$\nFor large $\\alpha$, the solution $u_h$ of the penalty system converges to the solution $u_h^*$ obtained via the elimination method. Thus, $(u_h)_f \\to (u_h^*)_f$ and $(u_h)_c \\to (g_h)_c$. The term in the parenthesis on the right-hand side approaches a finite value dependent on the problem data and mesh, but not on $\\alpha$:\n$$\nR_c = (f_h)_c - K_{cf} (u_h^*)_f - K_{cc} (g_h)_c\n$$\nThis vector $R_c$ represents the residual forces at the boundary nodes required for equilibrium.\nTherefore, for large $\\alpha$, the boundary mismatch scales as:\n$$\n(u_h)_c - (g_h)_c \\approx \\frac{1}{\\alpha} R_c\n$$\nTaking the infinity norm, we find the theoretically expected rate of convergence for the boundary mismatch:\n$$\ne_{\\infty}^{\\text{bc}}(\\alpha) = \\max_{i \\in \\mathcal{I}_c} |(u_h)_i - (g_h)_i| = \\mathcal{O}(\\alpha^{-1})\n$$\nA robust unit test for the penalty method should verify this specific scaling behavior.\n\nNow we evaluate each option.\n\n**A. Elimination: After solving with elimination, assert $e_{\\infty}^{\\text{bc}} \\le c \\, \\epsilon_{\\text{mach}} \\, \\max \\!\\left( 1, \\|g_h\\|_{\\infty} \\right)$, ... Penalty: For a fixed mesh, solve for three increasing penalty parameters $\\alpha \\in \\{10^2, 10^4, 10^6\\}$, compute $e_{\\infty}^{\\text{bc}}(\\alpha)$, and assert both monotonicity ... and $\\mathcal{O}(\\alpha^{-1})$ scaling...**\n\n- *Elimination Test:* As derived, the boundary mismatch should be at the level of machine precision. The proposed relational tolerance is a standard, robust way to check for floating-point equality, accounting for potential roundoff and scaling with the magnitude of the boundary data. This test design is correct.\n- *Penalty Test:* This test design verifies the two key consequences of the $\\mathcal{O}(\\alpha^{-1})$ scaling. First, it checks for monotonicity: the error must decrease as $\\alpha$ increases. Second, it checks the rate of convergence by asserting that the scaled product $\\alpha \\, e_{\\infty}^{\\text{bc}}(\\alpha)$ is approximately constant over a range of $\\alpha$ values. The ratio test is a scale-independent and dimensionless way to quantify this, making it a well-scaled and robust test. This test design is also correct.\n\nVerdict for A: **Correct**.\n\n**B. Penalty: Accept the solution as correct if $e_{\\infty}^{\\text{bc}}(\\alpha) \\le c$ with a fixed tolerance $c$ independent of $\\alpha$ and the mesh size, without comparing different $\\alpha$ values.**\n\nThis test is flawed. The boundary mismatch $e_{\\infty}^{\\text{bc}}(\\alpha)$ is a function of $\\alpha$. A fixed tolerance $c$ would be arbitrary; for a small $\\alpha$, the test may fail even if the implementation is correct, while for a large $\\alpha$, the test may be too loose to catch errors. Furthermore, the constant of proportionality in $e_{\\infty}^{\\text{bc}}(\\alpha) \\approx C/\\alpha$ depends on the mesh and problem data, so a fixed tolerance $c$ is not robust under mesh refinement. Most importantly, this test fails to verify the *rate* of convergence, a crucial theoretical property of the penalty method.\n\nVerdict for B: **Incorrect**.\n\n**C. Elimination: Because discretization error is present, allow a boundary mismatch tolerance $e_{\\infty}^{\\text{bc}} \\le C h$ proportional to the mesh size $h$ (with some constant $C$), instead of a machine-precision-scaled tolerance.**\n\nThis confuses two different types of error. The discretization error, such as $\\|u_h - u\\|_{L^2}$, measures how well the FEM solution approximates the true continuous solution and typically depends on the mesh size $h$. In contrast, the boundary mismatch $e_{\\infty}^{\\text{bc}} = \\max_i |(u_h)_i - (g_h)_i|$ measures how well the discrete boundary conditions are satisfied algebraically. As shown in the analysis of the elimination method, this mismatch is a matter of floating-point representation and should be near zero, independent of $h$. Allowing a tolerance proportional to $h$ is incorrect and would potentially mask serious implementation bugs.\n\nVerdict for C: **Incorrect**.\n\n**D. Penalty: Because increasing $\\alpha$ penalizes deviations more strongly, require a tolerance that grows proportionally with $\\alpha$, i.e., $e_{\\infty}^{\\text{bc}}(\\alpha) \\le C \\alpha$, and do not check behavior across multiple $\\alpha$ values.**\n\nThis statement contains a fundamentally flawed premise. The boundary mismatch $e_{\\infty}^{\\text{bc}}(\\alpha)$ is proportional to $\\alpha^{-1}$, meaning it *decreases* as $\\alpha$ increases. Proposing a tolerance that grows with $\\alpha$ is the opposite of the correct behavior. Such a test would be meaningless.\n\nVerdict for D: **Incorrect**.\n\nBased on the analysis, only option A describes a set of unit tests that are mathematically justified, well-scaled, and robust for verifying the implementation of both elimination and penalty methods.", "answer": "$$\\boxed{A}$$", "id": "2555769"}]}