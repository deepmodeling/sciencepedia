{"hands_on_practices": [{"introduction": "To build a solid foundation in clock domain crossing, we must first appreciate the fundamental problem of data loss. This exercise provides a quantitative look at what happens when a slow system tries to sample a fast one without a proper handshaking mechanism. By calculating the minimum number of data values lost, you will develop a concrete understanding of why direct sampling between asynchronous domains is inherently unreliable [@problem_id:1920375].", "problem": "In digital systems, interfacing components that operate on different clock signals requires careful analysis, a problem known as Clock Domain Crossing (CDC).\n\nConsider a scenario involving a high-speed digital sensor connected to a slower microcontroller (MCU). The sensor produces a new, unique data value on every rising edge of its clock, `clk_sensor`. The MCU samples this data on every rising edge of its own clock, `clk_mcu`.\n\nThe frequency of `clk_sensor` is exactly three times the frequency of `clk_mcu`. The phase relationship between `clk_sensor` and `clk_mcu` is arbitrary and may not be constant. Assume that the sampling process is ideal and instantaneous, occurring precisely at the clock edge. A data value is defined as \"lost\" if it is produced by the sensor but is never the value captured at a rising edge of `clk_mcu`.\n\nDetermine the minimum number of data values that are lost between any two consecutive sampling events by the MCU.", "solution": "Let the MCU clock period be $T_{\\text{m}}$ and the sensor clock period be $T_{\\text{s}}$. Given $f_{\\text{sensor}}=3 f_{\\text{mcu}}$, we have\n$$T_{\\text{m}}=3T_{\\text{s}}.$$\nConsider two consecutive MCU sampling instants at $t=0$ and $t=T_{\\text{m}}$. Let the sensor rising edges (data updates) occur at times\n$$t=t_{0}+kT_{\\text{s}}, \\quad k \\in \\mathbb{Z},$$\nfor some phase offset $t_{0} \\in [0, T_{\\text{s}})$.\n\nCount the number of sensor updates strictly in the open interval $(0, T_{\\text{m}})$:\n- If $t_{0}=0$ (sensor and MCU edges coincide at $t=0$), then sensor edges in $[0, T_{\\text{m}}]$ are at $0, T_{\\text{s}}, 2T_{\\text{s}}, 3T_{\\text{s}}$, so the open interval $(0, T_{\\text{m}})$ contains exactly $2$ updates (at $T_{\\text{s}}$ and $2T_{\\text{s}}$).\n- If $t_{0} \\in (0, T_{\\text{s}})$ (no coincidence at the endpoints), then the updates in $(0, T_{\\text{m}})$ are at $t_{0}, t_{0}+T_{\\text{s}}, t_{0}+2T_{\\text{s}}$, hence exactly $3$ updates.\n\nAt $t=T_{\\text{m}}$, the MCU captures the sensor value present at that instant, which is the value generated at\n$$t^{\\ast}=\\max\\{t \\leq T_{\\text{m}}: t=t_{0}+kT_{\\text{s}}\\}.$$\n- If there is no sensor edge at $t=T_{\\text{m}}$ (non-coincidence), then $t^{\\ast} \\in (0, T_{\\text{m}})$, so exactly one of the interior updates is captured and the remaining interior updates are lost. With $3$ interior updates, the number lost is $3-1=2$.\n- If there is a sensor edge at $t=T_{\\text{m}}$ (coincidence), then $t^{\\ast}=T_{\\text{m}}$, which is not in $(0, T_{\\text{m}})$. Thus none of the interior updates is captured; with $2$ interior updates, the number lost is $2$.\n\nTherefore, between any two consecutive MCU sampling events, the number of sensor data values that are lost is always $2$, and hence the minimum is $2$.", "answer": "$$\\boxed{2}$$", "id": "1920375"}, {"introduction": "A critical rule in safe CDC design is to only pass registered signals across domain boundaries, never the direct output of combinational logic. This practice explores the dangerous phenomenon of logic glitches, which can arise from unequal path delays even in circuits that are logically sound. By analyzing how a seemingly simple Boolean expression can produce a transient, erroneous pulse, you will see precisely why this design rule is so important to prevent rare but catastrophic system failures [@problem_id:1920408].", "problem": "In a digital system, a component operating in a clock domain driven by `CLK_A` communicates with another component in an asynchronous clock domain driven by `CLK_B`. A single-bit signal `S`, which is the output of a register clocked by `CLK_A`, is used to generate a control signal `Y`. This signal `Y` is then passed to the `CLK_B` domain, where it serves as the input to a synchronizing D-type Flip-Flop (DFF).\n\nThe combinational logic that generates `Y` from `S` is defined by the Boolean expression `Y = S AND (NOT S)`. Physically, this is implemented with one standard NOT gate and one standard 2-input AND gate. The propagation delay of the NOT gate is `t_NOT = 2.0 ns`, and the propagation delay of the AND gate is `t_AND = 3.5 ns`. For this analysis, assume that wire delays and the DFF's clock-to-Q delay are negligible.\n\nInitially, the signal `S` is stable at logic `0`. At time `t = 0`, a rising edge of `CLK_A` causes the signal `S` to transition from `0` to `1`. The logically expected steady-state value of `Y` is always `0`. However, the differing propagation delays in the physical gates can create transient behavior.\n\nGiven this scenario, what is the primary and most direct risk associated with this design choice of feeding the combinational output `Y` across the clock domain boundary?\n\nA. The circuit will consume excessive static power because the output `Y` will be stuck at a logic `1` state.\n\nB. A short-lived glitch pulse on `Y` may be sampled by the `CLK_B` domain's synchronizer, causing an erroneous value to be captured.\n\nC. The logic `S AND (NOT S)` is logically redundant, and a synthesis tool would optimize it to a constant `0`, preventing the circuit from being physically realized.\n\nD. The output `Y` will oscillate continuously between `0` and `1` after the transition of `S`, making synchronization impossible.\n\nE. The transition of signal `S` will create a temporary electrical short-circuit within the AND gate, potentially damaging the device.", "solution": "Define the combinational function as $Y=S \\land \\neg S$. In Boolean algebra, this simplifies to $Y \\equiv 0$ for all stable $S$.\n\nHowever, with physical gates and unequal propagation delays, the time-domain behavior must be examined. Let the inverter have propagation delay $t_{\\text{NOT}}$ and the AND gate have propagation delay $t_{\\text{AND}}$. Assume wire delays and clock-to-$Q$ delay are negligible, and $S$ transitions from $0$ to $1$ at $t=0$.\n\n1) For $t<0$, $S=0$ and $\\neg S=1$. The inputs to the AND gate are $(0,1)$, so (after any settled delays) $Y=0$.\n\n2) At $t=0^{+}$, $S$ changes to $1$ immediately at the AND input, while the inverter output remains at $1$ until $t=t_{\\text{NOT}}$. Therefore, for the interval $0 \\le t < t_{\\text{NOT}}$, the AND inputs are $(1,1)$.\n\n3) Considering the AND gate propagation delay $t_{\\text{AND}}$, the AND output will reflect the $(1,1)$ input combination after a delay. Thus, under a transport-delay view, a potential high pulse at $Y$ would occur from $t=t_{\\text{AND}}$ (rise) to $t=t_{\\text{NOT}}+t_{\\text{AND}}$ (fall), yielding a pulse width of $t_{\\text{NOT}}$:\n$$\n\\Delta t_{\\text{glitch}} = t_{\\text{NOT}}.\n$$\nUnder an inertial-delay model, a pulse narrower than $t_{\\text{AND}}$ could be filtered, but process-voltage-temperature variation and differing paths can still produce a nonzero pulse at $Y$ in practice. Hence, a short-lived glitch on $Y$ is a realistic hazard.\n\n4) Because $Y$ is being transferred into an asynchronous clock domain driven by $\\mathrm{CLK}_{B}$ and enters a synchronizing DFF, any such short glitch may coincide with a sampling edge of $\\mathrm{CLK}_{B}$, causing the synchronizer to capture an erroneous logic $1$ (despite the intended steady-state of $Y \\equiv 0$). This is the primary and most direct risk of sending combinational logic across a clock domain boundary.\n\nTherefore, the correct choice is that a short-lived glitch on $Y$ may be sampled by the $\\mathrm{CLK}_{B}$ domain's synchronizer, causing an erroneous captured value.", "answer": "$$\\boxed{B}$$", "id": "1920408"}, {"introduction": "While a two-flop synchronizer is the default tool for asynchronous crossings, it's crucial to distinguish between truly asynchronous and merely multi-rate synchronous systems. This problem presents a scenario with two different but phase-aligned, synchronous clocks, challenging the impulse to automatically insert a synchronizer. By applying fundamental synchronous timing analysis, you will learn to identify cases where a simpler, more direct connection is not only safe but also more efficient [@problem_id:1920380].", "problem": "In a digital system, a `Producer` module operates in a clock domain governed by `clk_A`, which has a frequency of 10 MHz. A `Consumer` module operates in a clock domain governed by `clk_B`, which has a frequency of 20 MHz. The clock generation circuitry ensures that `clk_B` is perfectly phase-aligned and frequency-doubled with respect to `clk_A`, such that every rising edge of `clk_A` coincides exactly with a rising edge of `clk_B`.\n\nThe `Producer` module generates a single-bit signal, `data_out`, which is the output of a D-type flip-flop (DFF) clocked by `clk_A`. The `Consumer` module attempts to capture this `data_out` signal using a single DFF clocked by `clk_B`. Assume that the clock-to-Q delay of the producer's flip-flop and the setup and hold times of the consumer's flip-flop are non-zero but are small enough such that their sum is less than 50 ns.\n\nIs this single-DFF approach a \"safe\" method for transferring the `data_out` signal from the `clk_A` domain to the `clk_B` domain, meaning it will correctly capture the data value without introducing metastability?\n\nSelect the best explanation from the choices below.\n\nA. No, because any time data crosses between domains with different clock frequencies, a two-flop synchronizer is required to prevent metastability.\n\nB. Yes, because the clocks are synchronous. The data from the 10 MHz domain changes shortly after a rising edge of `clk_A`, and it will be stable long before the next rising edge of the 20 MHz clock, which occurs 50 ns later, thus satisfying setup and hold time requirements.\n\nC. No, because the 20 MHz clock is too fast and will inevitably sample the `data_out` signal while it is transitioning, causing a metastable state.\n\nD. Yes, because the 10 MHz `data_out` signal is held constant for a full 100 ns, which is longer than the 50 ns period of `clk_B`, guaranteeing a safe capture.", "solution": "Let the producer clock be $f_{A}=10\\,\\text{MHz}$ with period $T_{A}=1/f_{A}=100\\,\\text{ns}$ and the consumer clock be $f_{B}=20\\,\\text{MHz}$ with period $T_{B}=1/f_{B}=50\\,\\text{ns}$. By construction, the clocks are synchronous and perfectly phase-aligned, so every rising edge of $clk\\_{A}$ at $t=nT_{A}$ coincides with a rising edge of $clk\\_{B}$ at $t=mT_{B}$ with $m=2n$, and there is an additional $clk\\_{B}$ rising edge at $t=nT_{A}+T_{B}$ between consecutive $clk\\_{A}$ edges.\n\nThe producer’s DFF launches a new value on $clk\\_{A}$ rising edges. Denote the producer clock-to-Q delay by $t\\_{cq,A}>0$. Then the output $data\\_out$ transitions at times $t=nT_{A}+t\\_{cq,A}$ and is otherwise constant.\n\nThe consumer’s DFF samples $data\\_out$ on $clk\\_{B}$ rising edges at $t=mT_{B}$. Consider the two successive relevant sampling instants around a launch at $t=nT_{A}$:\n1. Sampling at the coincident edge $t=nT_{A}$: at this instant, $data\\_out$ has not yet changed, since the change occurs at $t=nT_{A}+t\\_{cq,A}$. For this sampling to be safe with no metastability, the consumer hold-time constraint must be satisfied:\n$$\nt\\_{cq,A} \\ge t\\_{hold,B}.\n$$\nBecause the change occurs strictly after the sampling edge by $t\\_{cq,A}>0$, and practical $t\\_{hold,B}$ is small, this condition is naturally satisfied in typical synchronous designs; there is no data transition within the consumer’s aperture around $t=nT_{A}$, so the consumer captures the old value safely.\n\n2. Sampling at the next $clk\\_{B}$ edge $t=nT_{A}+T_{B}$: for the consumer to capture the newly launched value safely (without metastability), the setup-time constraint must be satisfied:\n$$\nt\\_{cq,A} + t\\_{path} + t\\_{setup,B} \\le T_{B}.\n$$\nHere $t\\_{path}$ is the propagation from the producer’s Q to the consumer’s D, which is minimal since $data\\_out$ is directly from a DFF. The problem states that the clock-to-Q of the producer and the setup and hold times of the consumer are non-zero but small enough such that their sum is less than $50\\,\\text{ns}=T_{B}$. Thus\n$$\nt\\_{cq,A} + t\\_{setup,B} < T_{B}\n$$\nholds, ensuring the new value is stable well before $t=nT_{A}+T_{B}$, so setup is met and no metastability is induced at this edge.\n\nBecause the clocks are synchronous with fixed phase alignment, and the timing inequalities above are satisfied by the given assumption (in particular, $t\\_{cq,A}+t\\_{setup,B}<T_{B}$, and the change occurs after the coincident edge so the hold window is not violated), a single consumer DFF clocked by $clk\\_{B}$ will capture $data\\_out$ safely: it will sample the old value at $t=nT_{A}$ and the new value at $t=nT_{A}+T_{B}$ without introducing metastability. Therefore, a two-flop synchronizer is not required in this synchronous, phase-aligned case. Among the options, the explanation that matches this reasoning is that the clocks are synchronous and the value is stable long before the next $clk\\_{B}$ edge, satisfying setup and hold.\n\nHence, the best choice is B.", "answer": "$$\\boxed{B}$$", "id": "1920380"}]}