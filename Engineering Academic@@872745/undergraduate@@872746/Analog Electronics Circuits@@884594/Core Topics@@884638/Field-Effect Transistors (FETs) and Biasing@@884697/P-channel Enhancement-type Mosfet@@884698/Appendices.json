{"hands_on_practices": [{"introduction": "The source follower, or common-drain amplifier, is a fundamental building block prized for its high input impedance and low output impedance, making it an excellent voltage buffer. This exercise explores a practical application of a PMOS source follower as a DC level shifter, a circuit that shifts the DC voltage level of a signal without altering its AC characteristics. By analyzing this circuit, you will practice small-signal modeling and appreciate the impact of the body effect, a crucial secondary effect in integrated circuits. [@problem_id:1323366]", "problem": "Consider a level shifter circuit built using a single p-channel enhancement-type Metal-Oxide-Semiconductor Field-Effect Transistor (PMOS), denoted as $M_1$. The drain of $M_1$ is connected to ground (0 V). The source of $M_1$ is connected to a resistor $R_S$, whose other terminal is connected to a negative DC supply voltage. The body (substrate) of the transistor is also connected to ground. The input, a small-signal AC voltage $v_{in}$, is applied to the gate of $M_1$. The output, $v_{out}$, is taken at the source of $M_1$.\n\nFor small-signal analysis, the transistor is characterized by its transconductance $g_m$, its intrinsic output resistance $r_o$, and its body-effect transconductance $g_{mb}$, which accounts for the influence of the source-to-body voltage.\n\nDetermine the input impedance $Z_{in}$ of the circuit and its small-signal voltage gain $A_v = v_{out}/v_{in}$. Present your answer for the pair $(Z_{in}, A_v)$ as a single symbolic expression in the form of a $1 \\times 2$ row matrix in terms of the given parameters.", "solution": "Let the small-signal gate, source, drain, and body voltages be denoted by $v_{g}$, $v_{s}$, $v_{d}$, and $v_{b}$, respectively. In AC small-signal, the DC supplies are AC ground, so $v_{d}=0$ (drain to ground), the negative supply is AC ground (the lower end of $R_{S}$ is at AC ground), and $v_{b}=0$ (body to ground). The input is $v_{in}=v_{g}$ and the output is $v_{out}=v_{s}$.\n\nUse the hybrid-$\\pi$ small-signal model with:\n- A resistor $r_{o}$ between drain and source.\n- A dependent current source from drain to source of value $i_{d}=g_{m}v_{gs}+g_{mb}v_{bs}$, where $v_{gs}=v_{g}-v_{s}$ and $v_{bs}=v_{b}-v_{s}$.\n\nInput impedance. The MOS gate draws no DC or low-frequency small-signal current in this model (no gate leakage or capacitances are included), so $i_{in}=0$ and therefore\n$$\nZ_{in}=\\frac{v_{in}}{i_{in}}=\\infty.\n$$\n\nVoltage gain. Write KCL at the source node. Currents from the source node to AC ground are through $R_{S}$ and $r_{o}$, equal to $v_{s}/R_{S}$ and $v_{s}/r_{o}$, respectively. The dependent current source injects $i_{d}$ from drain (ground) into the source node, with\n$$\ni_{d}=g_{m}v_{gs}+g_{mb}v_{bs}=g_{m}(v_{g}-v_{s})+g_{mb}(0-v_{s})=g_{m}v_{g}-(g_{m}+g_{mb})v_{s}.\n$$\nKCL at the source node gives\n$$\n\\frac{v_{s}}{R_{S}}+\\frac{v_{s}}{r_{o}}=i_{d}=g_{m}v_{g}-(g_{m}+g_{mb})v_{s}.\n$$\nRearrange to collect $v_{s}$ terms:\n$$\n\\left(\\frac{1}{R_{S}}+\\frac{1}{r_{o}}+g_{m}+g_{mb}\\right)v_{s}=g_{m}v_{g}.\n$$\nHence the small-signal gain is\n$$\nA_{v}=\\frac{v_{out}}{v_{in}}=\\frac{v_{s}}{v_{g}}=\\frac{g_{m}}{g_{m}+g_{mb}+\\frac{1}{R_{S}}+\\frac{1}{r_{o}}}.\n$$\nTherefore, the requested pair is\n$$\n\\left(Z_{in},\\,A_{v}\\right)=\\left(\\infty,\\,\\frac{g_{m}}{g_{m}+g_{mb}+\\frac{1}{R_{S}}+\\frac{1}{r_{o}}}\\right).\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\infty  \\dfrac{g_{m}}{g_{m}+g_{mb}+\\dfrac{1}{R_{S}}+\\dfrac{1}{r_{o}}}\\end{pmatrix}}$$", "id": "1323366"}, {"introduction": "While source followers are buffers, the common-source amplifier is the workhorse for achieving high voltage gain. This problem challenges you to analyze a high-performance amplifier where a PMOS common-source stage is paired with an NMOS cascode active load, a sophisticated technique used to dramatically increase the output resistance and, consequently, the overall voltage gain. This practice will deepen your understanding of how to analyze multi-transistor circuits and the design principles behind modern high-gain amplifiers. [@problem_id:1323378]", "problem": "Consider an amplifier stage built using Metal-Oxide-Semiconductor Field-Effect Transistors (MOSFETs). This stage is designed to achieve a high voltage gain.\n\nThe primary amplifying device is a p-channel enhancement-type MOSFET, denoted as $M_1$. Its source terminal is connected to the positive power supply voltage, $V_{DD}$. Its gate terminal serves as the input port for the small-signal voltage $v_{in}$, superimposed on a DC bias. Its drain terminal is the amplifier's output port, providing the signal $v_{out}$.\n\nThe active load for this amplifier is implemented as a cascode current source, which provides a high dynamic output resistance. This load is constructed from two n-channel enhancement-type MOSFETs, denoted as $M_2$ and $M_3$. The drain of transistor $M_2$ is connected to the output node (i.e., the drain of $M_1$). The gate of $M_2$ is connected to a stable DC bias voltage $V_{B1}$. The source of $M_2$ is connected to the drain of $M_3$. Transistor $M_3$ has its source terminal connected to ground, and its gate is connected to a second stable DC bias voltage $V_{B2}$. The bulk terminal of all n-channel transistors is connected to ground.\n\nAssume that all transistors are biased to operate in the saturation region. The relevant small-signal parameters for each transistor $M_i$ (where $i=1, 2, 3$) are its transconductance, $g_{mi}$, and its finite output resistance, $r_{oi}$. Because the source of transistor $M_2$ is not connected to its bulk, it is subject to the body effect, which introduces a body-effect transconductance, $g_{mb2}$.\n\nYour task is to derive a single, closed-form analytic expression for the overall small-signal voltage gain, $A_v = v_{out} / v_{in}$, of this amplifier stage. Your final expression should be in terms of the given small-signal parameters: $g_{m1}, r_{o1}, g_{m2}, r_{o2}, g_{m3}, r_{o3}$, and $g_{mb2}$.", "solution": "Treat all DC bias sources, including $V_{DD}$, $V_{B1}$, and $V_{B2}$, as AC grounds. Use small-signal hybrid-$\\pi$ models with parameters $g_{mi}$ and $r_{oi}$ for $M_{i}$, and include $g_{mb2}$ for $M_{2}$ due to body effect. Let the output node be $v_{x} \\equiv v_{out}$ and the internal node between $M_{2}$ and $M_{3}$ be $v_{y}$. The gates of $M_{2}$ and $M_{3}$ are at AC ground.\n\nFor the p-channel device $M_{1}$ with source at AC ground, the dependent source from source to drain is $g_{m1} v_{sg1}$; thus the current leaving node $v_{x}$ due to $M_{1}$’s transconductance is $-g_{m1} v_{sg1} = g_{m1} v_{in}$ because $v_{sg1} = -v_{in}$. The current through $r_{o1}$ leaving node $v_{x}$ is $v_{x}/r_{o1}$.\n\nFor $M_{2}$ (nMOS), with $v_{gs2} = -v_{y}$, $v_{bs2} = -v_{y}$, and $v_{ds2} = v_{x} - v_{y}$, the current from drain to source (leaving node $v_{x}$) is\n$$\ni_{d2} = g_{m2} v_{gs2} + g_{mb2} v_{bs2} + \\frac{v_{ds2}}{r_{o2}} = -(g_{m2} + g_{mb2}) v_{y} + \\frac{v_{x} - v_{y}}{r_{o2}}.\n$$\nFor $M_{3}$ (nMOS), with $v_{gs3} = 0$ and $v_{ds3} = v_{y}$, the current leaving node $v_{y}$ is $v_{y}/r_{o3}$.\n\nWrite KCL at node $v_{x}$ (sum of currents leaving equals zero):\n$$\ng_{m1} v_{in} + \\frac{v_{x}}{r_{o1}} - (g_{m2} + g_{mb2}) v_{y} + \\frac{v_{x} - v_{y}}{r_{o2}} = 0,\n$$\nwhich rearranges to\n$$\n\\left( \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} \\right) v_{x} + \\left( -\\frac{1}{r_{o2}} - g_{m2} - g_{mb2} \\right) v_{y} + g_{m1} v_{in} = 0.\n$$\nWrite KCL at node $v_{y}$ (sum of currents leaving equals zero). The current leaving via $M_{2}$ from source to drain is the negative of $i_{d2}$:\n$$\n(g_{m2} + g_{mb2}) v_{y} - \\frac{v_{x} - v_{y}}{r_{o2}} + \\frac{v_{y}}{r_{o3}} = 0,\n$$\nwhich simplifies to\n$$\n-\\frac{1}{r_{o2}} v_{x} + \\left( g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} \\right) v_{y} = 0.\n$$\nSolve for $v_{y}$ in terms of $v_{x}$:\n$$\nv_{y} = \\frac{ \\frac{1}{r_{o2}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } \\, v_{x}.\n$$\nSubstitute this into the $v_{x}$-KCL equation:\n$$\n\\left( \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} \\right) v_{x} - \\left( \\frac{1}{r_{o2}} + g_{m2} + g_{mb2} \\right) \\frac{ \\frac{1}{r_{o2}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } v_{x} + g_{m1} v_{in} = 0.\n$$\nDefine $A \\equiv g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}}$. The coefficient of $v_{x}$ simplifies as\n$$\n\\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} - \\left( \\frac{1}{r_{o2}} + g_{m2} + g_{mb2} \\right) \\frac{ \\frac{1}{r_{o2}} }{ A }\n= \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ A }.\n$$\nHence\n$$\n\\left[ \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } \\right] v_{x} + g_{m1} v_{in} = 0,\n$$\nso\n$$\n\\frac{v_{out}}{v_{in}} = \\frac{v_{x}}{v_{in}} = - \\frac{ g_{m1} }{ \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } }.\n$$\nRecognizing that the load network’s output resistance is\n$$\nR_{\\text{load}} = \\frac{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} }{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} } = r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3},\n$$\nthe overall gain can be written in a single closed form without parallel-notation as\n$$\nA_{v} = - g_{m1} \\frac{ r_{o1} \\left[ r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3} \\right] }{ r_{o1} + r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3} }.\n$$\nThis expression is exact under the stated small-signal model and includes the body-effect contribution $g_{mb2}$.", "answer": "$$\\boxed{-g_{m1}\\frac{r_{o1}\\left[r_{o2}+r_{o3}+\\left(g_{m2}+g_{mb2}\\right)r_{o2}r_{o3}\\right]}{r_{o1}+r_{o2}+r_{o3}+\\left(g_{m2}+g_{mb2}\\right)r_{o2}r_{o3}}}$$", "id": "1323378"}, {"introduction": "Beyond amplification, transistor stages can be used to generate signals. This exercise introduces the ring oscillator, a simple yet powerful circuit that creates a clock signal by connecting an odd number of inverting amplifiers in a feedback loop. By applying the Barkhausen criterion for oscillation, you will determine the necessary gain and the resulting frequency, providing insight into the relationship between amplifier characteristics, phase shift, and the principles of feedback systems. [@problem_id:1323372]", "problem": "An integrated circuit designer is creating a simple on-chip clock using a ring oscillator. The oscillator is constructed from $N$ identical inverting amplifier stages connected in a feedback loop, where $N$ is an odd integer greater than or equal to 3. Due to process constraints, each inverter must be built using only p-channel enhancement-type Metal-Oxide-Semiconductor Field-Effect Transistors (PMOS).\n\nEach inverter stage consists of a driver transistor, $M_D$, and an active load transistor, $M_L$. The driver $M_D$ is in a common-source configuration, with its source connected to the supply voltage $V_{DD}$ and its drain providing the stage's output voltage. The input to the stage is applied to the gate of $M_D$. The load transistor $M_L$ has its source connected to the output node, its drain connected to ground, and its gate held at a constant bias voltage $V_{BIAS}$ to make it behave as a current source.\n\nFor a small-signal analysis around the unstable DC operating point of the oscillator, the following parameters are defined for each stage:\n- The transconductance of the driver transistor is $g_{md}$.\n- The transconductance of the load transistor is $g_{ml}$.\n- The total effective capacitance at the output node of each stage, which determines its frequency response, is $C_{node}$.\n\nAssume that the intrinsic output resistances ($r_o$) of both transistors are infinitely large and that the body effect is negligible. The oscillator operates at the threshold condition for sustained oscillations.\n\nDetermine the following two quantities:\n1.  The required small-signal voltage gain magnitude of a single stage, $|A_v|$.\n2.  The resulting angular frequency of oscillation, $\\omega_{osc}$.\n\nExpress your answers in terms of $N$, $g_{md}$, $g_{ml}$, and $C_{node}$ as required. The final answer should be a set of two expressions.", "solution": "The problem asks for the single-stage gain magnitude $|A_v|$ and the angular frequency of oscillation $\\omega_{osc}$ for a PMOS-only ring oscillator at the threshold of oscillation.\n\nFirst, we determine the small-signal model of a single inverter stage. The stage consists of a driver PMOS ($M_D$) and a load PMOS ($M_L$).\n\nThe small-signal voltage gain of the common-source driver is given by $A_v = -g_{md} R_{out}$, where $R_{out}$ is the total small-signal resistance at the output node. This resistance is the parallel combination of the output resistance of the driver, $r_{od}$, and the resistance of the active load, $R_L$.\n\nThe problem states that the intrinsic output resistance $r_o$ of the transistors can be considered infinite. So, $r_{od} \\to \\infty$.\n\nThe active load is the PMOS transistor $M_L$ with its source connected to the output node $v_{out}$, its drain to ground, and its gate to a DC bias voltage (AC ground). We need to find the resistance $R_L$ looking into the source of $M_L$. A small-signal voltage $v_x$ applied to the source of $M_L$ will result in a current $i_x$. The resistance is $R_L = v_x/i_x$. The gate-source voltage is $v_{gs,L} = v_g - v_s = 0 - v_x = -v_x$. The drain is at AC ground. The body is typically tied to the source for a PMOS in an n-well process or is at $V_{DD}$, but the problem states to neglect the body effect, so the body-transconductance $g_{mb}$ is zero. The small-signal model of $M_L$ consists of a current source $g_{ml} v_{sg,L} = g_{ml} (-v_{gs,L}) = g_{ml} v_x$ flowing from source to drain, in parallel with its output resistance $r_{ol}$. Since $r_{ol} \\to \\infty$, the current flowing out of the source terminal is simply $i_x = g_{ml} v_x$. Therefore, the resistance of the load is $R_L = v_x/i_x = 1/g_{ml}$.\n\nThe total output resistance is $R_{out} = r_{od} || R_L$. With $r_{od} \\to \\infty$, we have $R_{out} = R_L = 1/g_{ml}$.\n\nThe small-signal voltage gain of a single stage is thus:\n$$A_v = -g_{md} R_{out} = -\\frac{g_{md}}{g_{ml}}$$\nThe gain magnitude is $|A_v| = g_{md}/g_{ml}$.\n\nNext, we model the frequency response. Each stage has an output resistance $R_{out}$ and a total capacitance $C_{node}$. This forms a single-pole low-pass filter with a time constant $\\tau = R_{out} C_{node} = C_{node}/g_{ml}$. The transfer function of a single inverting stage is:\n$$H(s) = \\frac{A_v}{1+s\\tau} = \\frac{-|A_v|}{1+s\\tau}$$\nA ring oscillator is formed by connecting $N$ such stages in a loop. The total loop gain transfer function is $L(s) = [H(s)]^N$. For oscillations to occur, the Barkhausen criterion must be met, which for this configuration is $L(j\\omega) = 1$.\n$$L(j\\omega) = \\left( \\frac{-|A_v|}{1+j\\omega\\tau} \\right)^N = 1$$\nSince $N$ is a given odd integer, $(-1)^N = -1$.\n$$- \\frac{|A_v|^N}{(1+j\\omega\\tau)^N} = 1$$\n$$(1+j\\omega\\tau)^N = -|A_v|^N = |A_v|^N e^{j(2k+1)\\pi}$$\nwhere $k$ is an integer. Taking the $N$-th root of both sides gives:\n$$1+j\\omega\\tau = |A_v| e^{j\\frac{(2k+1)\\pi}{N}}$$\nWe can separate the real and imaginary parts of this equation using Euler's formula, $e^{j\\theta} = \\cos\\theta + j\\sin\\theta$:\n$$1 = |A_v| \\cos\\left(\\frac{(2k+1)\\pi}{N}\\right)$$\n$$\\omega\\tau = |A_v| \\sin\\left(\\frac{(2k+1)\\pi}{N}\\right)$$\nTo find the oscillation frequency $\\omega_{osc}$, we can divide the second equation by the first:\n$$\\omega_{osc}\\tau = \\tan\\left(\\frac{(2k+1)\\pi}{N}\\right)$$\nFor a physical oscillation, we require $\\omega_{osc} > 0$. This means we must choose an integer $k$ such that $\\tan(\\frac{(2k+1)\\pi}{N}) > 0$. The fundamental (lowest) frequency of oscillation corresponds to the smallest positive argument of the tangent function that lies in the first or third quadrants. We choose the principal branch, so the argument is in $(0, \\pi/2)$. For $k=0$, the argument is $\\pi/N$. Since $N \\ge 3$, $\\pi/N$ is in the range $(0, \\pi/3]$, which is in the first quadrant. This gives the lowest oscillation frequency.\nThus, we set $k=0$:\n$$\\omega_{osc}\\tau = \\tan\\left(\\frac{\\pi}{N}\\right)$$\nSubstituting $\\tau = C_{node}/g_{ml}$, we get the angular frequency of oscillation:\n$$\\omega_{osc} = \\frac{1}{\\tau}\\tan\\left(\\frac{\\pi}{N}\\right) = \\frac{g_{ml}}{C_{node}}\\tan\\left(\\frac{\\pi}{N}\\right)$$\nNow we find the required gain magnitude, $|A_v|$. Using the equation for the real part with $k=0$:\n$$1 = |A_v| \\cos\\left(\\frac{\\pi}{N}\\right)$$\nThis gives the condition on the gain magnitude at the threshold of oscillation:\n$$|A_v| = \\frac{1}{\\cos(\\pi/N)} = \\sec\\left(\\frac{\\pi}{N}\\right)$$\nThis is the minimum gain magnitude required for each stage to sustain oscillation.\n\nSo, the two required quantities are:\n1. The gain magnitude: $|A_v| = \\sec(\\pi/N)$.\n2. The angular oscillation frequency: $\\omega_{osc} = \\frac{g_{ml}}{C_{node}}\\tan(\\frac{\\pi}{N})$.", "answer": "$$\\boxed{\\begin{pmatrix} \\sec\\left(\\frac{\\pi}{N}\\right)  \\frac{g_{ml}}{C_{node}}\\tan\\left(\\frac{\\pi}{N}\\right) \\end{pmatrix}}$$", "id": "1323372"}]}