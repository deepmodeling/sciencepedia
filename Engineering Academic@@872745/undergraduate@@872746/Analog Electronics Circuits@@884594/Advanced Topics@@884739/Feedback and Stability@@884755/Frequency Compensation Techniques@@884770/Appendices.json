{"hands_on_practices": [{"introduction": "Multi-stage amplifiers are essential for achieving high gain, but their multiple poles can lead to instability when feedback is applied. This exercise [@problem_id:1305751] introduces Miller compensation, a foundational technique where a small capacitor is strategically placed to create a dominant low-frequency pole. By mastering this practice, you will understand how to use the Miller effect to intentionally separate the pole frequencies, a critical first step in ensuring amplifier stability.", "problem": "An engineer is designing a two-stage amplifier for an audio application. To ensure its stability when placed in a feedback loop, the open-loop frequency response must be tailored. The amplifier can be modeled as two cascaded voltage-amplifying stages.\n\nThe first stage has a transconductance $g_{m1} = 1.5 \\, \\text{mA/V}$ and an output resistance $R_1 = 200 \\, \\text{k}\\Omega$. The total inherent parasitic capacitance at the output node of the first stage is $C_1 = 0.5 \\, \\text{pF}$.\n\nThe second stage has a transconductance $g_{m2} = 10 \\, \\text{mA/V}$ and an output resistance $R_2 = 50 \\, \\text{k}\\Omega$. The input of the second stage is connected to the output of the first stage.\n\nTo control the amplifier's frequency response, a single compensation capacitor, $C_c$, is connected between the input and the output of the second stage. This technique is intended to create a single dominant pole in the amplifier's open-loop transfer function at a frequency $f_{pd} = 100 \\, \\text{Hz}$.\n\nAssuming the gain of the second stage is large, calculate the necessary value of the compensation capacitor $C_c$. Express your answer in picofarads (pF), rounded to three significant figures.", "solution": "The compensation capacitor is connected between the input and output of the second stage, creating a Miller-multiplied capacitance at the first-stage output (which is the input of the second stage). Let the second-stage small-signal voltage gain be denoted by $A_{2}$. With a large second-stage gain and high input resistance at the second-stage input, the Miller effect makes the effective capacitance at the first-stage output\n$$\nC_{\\text{eff}} = C_{1} + C_{c}(1 + A_{2}).\n$$\nThe dominant pole is set by the first-stage output resistance $R_{1}$ and the total capacitance at that node. The pole frequency is\n$$\nf_{pd} = \\frac{1}{2\\pi R_{1} C_{\\text{eff}}} = \\frac{1}{2\\pi R_{1}\\left(C_{1} + C_{c}(1 + A_{2})\\right)}.\n$$\nSolving for $C_{c}$ gives\n$$\nC_{c} = \\frac{\\frac{1}{2\\pi R_{1} f_{pd}} - C_{1}}{1 + A_{2}}.\n$$\nFor the given second stage, the (magnitude of) its voltage gain is approximated by\n$$\nA_{2} \\approx g_{m2} R_{2}.\n$$\nSubstituting the numerical values,\n$$\nA_{2} = (10\\times 10^{-3})\\,(50\\times 10^{3}) = 500,\n$$\n$$\n\\frac{1}{2\\pi R_{1} f_{pd}} = \\frac{1}{2\\pi \\cdot (200\\times 10^{3}) \\cdot 100} = \\frac{1}{4\\pi \\times 10^{7}} \\approx 7.9577471546\\times 10^{-9}\\ \\text{F},\n$$\nso\n$$\nC_{c} = \\frac{7.9577471546\\times 10^{-9} - 0.5\\times 10^{-12}}{1 + 500}\\ \\text{F}\n= \\frac{7.9572471546\\times 10^{-9}}{501}\\ \\text{F}\n\\approx 1.588272885\\times 10^{-11}\\ \\text{F}.\n$$\nConverting to picofarads,\n$$\nC_{c} \\approx 15.88272885\\ \\text{pF}.\n$$\nRounded to three significant figures,\n$$\nC_{c} \\approx 15.9\\ \\text{pF}.\n$$", "answer": "$$\\boxed{15.9}$$", "id": "1305751"}, {"introduction": "Simply creating a dominant pole is often not enough; a robust design requires a predictable amount of stability. This next practice [@problem_id:1305749] advances the concept by tasking you with achieving a specific phase margin, a key metric for quantifying stability and predicting transient response. This calculation reveals the trade-offs in compensation design, including the subtle but important effects of secondary poles and the unintended right-half-plane (RHP) zero that arises from the Miller capacitor itself.", "problem": "Consider a simplified model of a two-stage Operational Transconductance Amplifier (OTA) designed to function as a unity-gain buffer for a capacitive sensor. The first stage of the OTA has a transconductance $g_{m1}$ and an output resistance $R_{o1}$. The second stage has a transconductance $g_{m2}$ and an output resistance $R_{o2}$. To ensure stable operation, a compensation capacitor, $C_c$, is connected from the output of the first stage to the output of the second stage. The amplifier is driving a total load capacitance $C_L$, which includes the sensor capacitance.\n\nGiven the following device and load parameters:\n- First-stage transconductance, $g_{m1} = 1.20 \\, \\text{mA/V}$\n- Second-stage transconductance, $g_{m2} = 15.0 \\, \\text{mA/V}$\n- First-stage output resistance, $R_{o1} = 250 \\, \\text{k}\\Omega$\n- Second-stage output resistance, $R_{o2} = 50.0 \\, \\text{k}\\Omega$\n- Load capacitance, $C_L = 12.0 \\, \\text{pF}$\n\nCalculate the value of the compensation capacitor $C_c$ required to achieve a phase margin of exactly 60 degrees. For your analysis, assume that the effects of pole splitting are dominant and that all other parasitic capacitances within the circuit are negligible. Express your answer in picofarads (pF), rounded to three significant figures.", "solution": "The problem asks for the value of the Miller compensation capacitor $C_c$ that results in a phase margin (PM) of 60 degrees for a two-stage OTA in a unity-gain feedback configuration.\n\nFirst, we identify the key frequency-dependent characteristics of the compensated two-stage OTA. The open-loop transfer function $A(s)$ has a dominant pole $\\omega_{p1}$, a non-dominant pole $\\omega_{p2}$, and a right-half-plane (RHP) zero $\\omega_z$.\n\nThe unity-gain frequency, $\\omega_t$, of the compensated amplifier is determined by the transconductance of the first stage, $g_{m1}$, and the compensation capacitor, $C_c$.\n$$ \\omega_t = \\frac{g_{m1}}{C_c} $$\n\nThe non-dominant pole, $\\omega_{p2}$, is primarily determined by the second stage's transconductance, $g_{m2}$, and the load capacitance, $C_L$. Under the standard pole-splitting approximation, and assuming $C_c$ is not much smaller than $C_L$, its location is approximated as:\n$$ \\omega_{p2} \\approx \\frac{g_{m2}}{C_L} $$\n\nThe compensation capacitor $C_c$ creates a feedforward path from the input to the output of the second stage, which introduces a RHP zero, $\\omega_z$, given by:\n$$ \\omega_z = \\frac{g_{m2}}{C_c} $$\n\nThe phase margin is defined at the unity-gain frequency $\\omega_t$. It is given by $PM = 180^\\circ + \\angle A(j\\omega_t)$, where $\\angle A(j\\omega_t)$ is the phase of the open-loop transfer function at $\\omega = \\omega_t$. The phase is the sum of contributions from the poles and the zero:\n$$ \\angle A(j\\omega_t) = -\\arctan\\left(\\frac{\\omega_t}{\\omega_{p1}}\\right) - \\arctan\\left(\\frac{\\omega_t}{\\omega_{p2}}\\right) - \\arctan\\left(\\frac{\\omega_t}{\\omega_z}\\right) $$\nNote the negative sign for the RHP zero's phase contribution. In a properly compensated op-amp, the dominant pole $\\omega_{p1}$ is placed at a much lower frequency than $\\omega_t$, so $\\omega_t \\gg \\omega_{p1}$. This means the phase contribution from the dominant pole at $\\omega_t$ is approximately $-90^\\circ$.\n$$ \\arctan\\left(\\frac{\\omega_t}{\\omega_{p1}}\\right) \\approx 90^\\circ $$\nSubstituting this into the phase margin equation:\n$$ PM \\approx 180^\\circ - 90^\\circ - \\arctan\\left(\\frac{\\omega_t}{\\omega_{p2}}\\right) - \\arctan\\left(\\frac{\\omega_t}{\\omega_z}\\right) $$\n$$ PM \\approx 90^\\circ - \\arctan\\left(\\frac{\\omega_t}{\\omega_{p2}}\\right) - \\arctan\\left(\\frac{\\omega_t}{\\omega_z}\\right) $$\nWe are given that the desired phase margin is $60^\\circ$.\n$$ 60^\\circ = 90^\\circ - \\arctan\\left(\\frac{\\omega_t}{\\omega_{p2}}\\right) - \\arctan\\left(\\frac{\\omega_t}{\\omega_z}\\right) $$\n$$ \\arctan\\left(\\frac{\\omega_t}{\\omega_{p2}}\\right) + \\arctan\\left(\\frac{\\omega_t}{\\omega_z}\\right) = 30^\\circ $$\nNow we express the ratios $\\omega_t/\\omega_{p2}$ and $\\omega_t/\\omega_z$ in terms of the circuit parameters.\n$$ \\frac{\\omega_t}{\\omega_{p2}} = \\frac{g_{m1}/C_c}{g_{m2}/C_L} = \\frac{g_{m1}C_L}{g_{m2}C_c} $$\n$$ \\frac{\\omega_t}{\\omega_z} = \\frac{g_{m1}/C_c}{g_{m2}/C_c} = \\frac{g_{m1}}{g_{m2}} $$\nSubstituting these into our phase equation:\n$$ \\arctan\\left(\\frac{g_{m1}C_L}{g_{m2}C_c}\\right) + \\arctan\\left(\\frac{g_{m1}}{g_{m2}}\\right) = 30^\\circ $$\nWe can now plug in the given numerical values. First, let's calculate the term involving only the transconductances.\n$$ \\frac{g_{m1}}{g_{m2}} = \\frac{1.20 \\text{ mA/V}}{15.0 \\text{ mA/V}} = 0.0800 $$\nThe phase contribution from the RHP zero is:\n$$ \\arctan(0.0800) \\approx 4.5739^\\circ $$\nNow substitute this back into the phase equation:\n$$ \\arctan\\left(\\frac{g_{m1}C_L}{g_{m2}C_c}\\right) + 4.5739^\\circ = 30^\\circ $$\n$$ \\arctan\\left(\\frac{g_{m1}C_L}{g_{m2}C_c}\\right) = 30^\\circ - 4.5739^\\circ = 25.4261^\\circ $$\nNow we can solve for the argument of the arctan function:\n$$ \\frac{g_{m1}C_L}{g_{m2}C_c} = \\tan(25.4261^\\circ) \\approx 0.47543 $$\nFinally, we solve for $C_c$:\n$$ C_c = \\frac{g_{m1}C_L}{g_{m2} \\times 0.47543} = \\left(\\frac{g_{m1}}{g_{m2}}\\right) \\frac{C_L}{0.47543} $$\nSubstitute the known values:\n$$ C_c = (0.0800) \\frac{12.0 \\text{ pF}}{0.47543} \\approx 2.01935 \\text{ pF} $$\nThe problem asks for the answer to be rounded to three significant figures.\n$$ C_c \\approx 2.02 \\text{ pF} $$\nThe values for $R_{o1}$ and $R_{o2}$ were not needed for this calculation, as they primarily determine the DC gain and the exact location of the dominant pole, which are not directly required when using the relationship between $\\omega_t$, $\\omega_{p2}$, $\\omega_z$ and the phase margin.", "answer": "$$\\boxed{2.02}$$", "id": "1305749"}, {"introduction": "The RHP zero introduced by basic Miller compensation is a significant limitation, as it reduces the phase margin and can compromise stability. This final exercise [@problem_id:1305737] demonstrates an elegant refinement to the technique: adding a nulling resistor in series with the compensation capacitor. You will calculate the precise resistor value needed to move the problematic zero to infinity, effectively eliminating its negative impact and significantly improving the amplifier's high-frequency performance.", "problem": "An engineer is designing a two-stage CMOS operational amplifier. The second stage of the amplifier is modeled as a transconductance stage with a transconductance of $g_{m2}$ and an output resistance of $R_{o2}$. To ensure stability across a wide range of loads, a Miller compensation capacitor, $C_C$, is connected between the input and output nodes of this second stage. A known side-effect of this compensation method is the creation of a zero in the Right-Half Plane (RHP) of the amplifier's transfer function, which can degrade the phase margin.\n\nTo address this, a nulling resistor, $R_z$, is placed in series with the compensation capacitor $C_C$. The value of this resistor can be chosen to alter the position of the zero. Your task is to find the specific value of $R_z$ that moves the RHP zero to an infinite frequency, thereby eliminating its effect on the amplifier's performance.\n\nThe parameters for the second stage are as follows:\n- Transconductance, $g_{m2} = 400 \\, \\mu\\text{A/V}$\n- Output Resistance, $R_{o2} = 150 \\, \\text{k}\\Omega$\n- Compensation Capacitor, $C_C = 3 \\, \\text{pF}$\n\nCalculate the required value of the nulling resistor $R_z$. Express your answer in kilo-ohms (k$\\Omega$).", "solution": "The problem asks for the value of a nulling resistor $R_z$ that eliminates the Right-Half Plane (RHP) zero in a two-stage amplifier by moving it to infinity. The zero is introduced by the feedforward path through the Miller compensation network.\n\nLet's analyze the small-signal model of the second stage. Let $v_x$ be the input voltage to the second stage and $v_{out}$ be the output voltage. The second stage consists of a voltage-controlled current source with transconductance $g_{m2}$ and an output resistance $R_{o2}$. The compensation network, comprising capacitor $C_C$ in series with resistor $R_z$, is connected between nodes $v_x$ and $v_{out}$.\n\nThe impedance of the series compensation network in the s-domain is given by:\n$$ Z_C(s) = R_z + \\frac{1}{sC_C} $$\n\nThe transfer function zeros are the frequencies at which the output voltage $v_{out}$ becomes zero for a finite input voltage $v_x$. To find these zeros, we can analyze the currents at the output node. The total current at the output node is the sum of the current from the controlled source ($I_{gm2}$) and the current flowing through the compensation network ($I_C$), plus any current flowing through the output resistance $R_{o2}$ and the load.\nBy applying Kirchhoff's Current Law (KCL) at the output node $v_{out}$, we have:\n$$ g_{m2}v_x + \\frac{v_{out}}{R_{o2}} + I_{load} + \\frac{v_{out} - v_x}{Z_C(s)} = 0 $$\nwhere $I_{load}$ is the current into the load connected to the output.\n\nTo find the zeros of the transfer function $A_v(s) = v_{out}(s)/v_x(s)$, we look for the values of $s$ (denoted $s_z$) for which $v_{out}(s_z) = 0$ while $v_x(s_z) \\neq 0$. Setting $v_{out} = 0$ in the KCL equation simplifies it significantly. Note that when $v_{out}=0$, the current through $R_{o2}$ and the load also becomes zero.\nThe KCL equation becomes:\n$$ g_{m2}v_x + \\frac{0 - v_x}{Z_C(s)} = 0 $$\nSince we are looking for a solution where $v_x \\neq 0$, we can divide the equation by $v_x$:\n$$ g_{m2} - \\frac{1}{Z_C(s)} = 0 $$\nThis equation defines the frequency $s = s_z$ of the zero.\n$$ g_{m2} = \\frac{1}{Z_C(s_z)} $$\nNow, we substitute the expression for $Z_C(s)$:\n$$ g_{m2} = \\frac{1}{R_z + \\frac{1}{s_z C_C}} $$\nWe can now solve for the zero, $s_z$:\n$$ R_z + \\frac{1}{s_z C_C} = \\frac{1}{g_{m2}} $$\n$$ \\frac{1}{s_z C_C} = \\frac{1}{g_{m2}} - R_z $$\n$$ \\frac{1}{s_z C_C} = \\frac{1 - g_{m2}R_z}{g_{m2}} $$\n$$ s_z = \\frac{g_{m2}}{C_C(1 - g_{m2}R_z)} $$\nThis expression gives the location of the zero in the s-plane. The problem requires us to find the value of $R_z$ that moves this zero to an infinite frequency ($s_z \\to \\infty$). For the expression of $s_z$ to approach infinity, its denominator must approach zero.\n$$ 1 - g_{m2}R_z = 0 $$\nSolving for $R_z$ gives the value of the nulling resistor:\n$$ R_z = \\frac{1}{g_{m2}} $$\nNotice that this value depends only on the transconductance of the second stage, $g_{m2}$, and not on $C_C$, $R_{o2}$, or the load.\n\nNow, we can substitute the given numerical value for $g_{m2}$:\n$$ g_{m2} = 400 \\, \\mu\\text{A/V} = 400 \\times 10^{-6} \\, \\text{S} $$\n$$ R_z = \\frac{1}{400 \\times 10^{-6} \\, \\text{S}} = \\frac{1}{0.0004} \\, \\Omega = 2500 \\, \\Omega $$\nThe problem asks for the answer in kilo-ohms (k$\\Omega$).\n$$ R_z = 2500 \\, \\Omega = 2.5 \\, \\text{k}\\Omega $$", "answer": "$$\\boxed{2.5}$$", "id": "1305737"}]}