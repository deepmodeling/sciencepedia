{"hands_on_practices": [{"introduction": "The $g_m/I_D$ methodology provides a systematic way to translate circuit specifications into transistor dimensions. This first exercise grounds the theory in a practical, fundamental task: calculating the required width ($W$) of a transistor for a specified transconductance efficiency and bias current. By working through this problem [@problem_id:1308221], you will solidify your understanding of the direct link between this key design parameter and the physical implementation of a device.", "problem": "An analog circuit designer is tasked with creating a common-source amplifier using an NMOS transistor. The transistor is fabricated in a specialized low-power process technology. For this process, extensive characterization has shown that for a transistor operating in the saturation region, the relationship between its transconductance efficiency ($g_m/I_D$) and the normalized current density, defined as $I_{\\text{norm}} = I_D / (W/L)$, is accurately modeled by the following equation:\n$$\n\\left(\\frac{g_m}{I_D}\\right)^2 = \\frac{2 k'_n}{I_{\\text{norm}}}\n$$\nwhere $k'_n$ is the process transconductance parameter, $W$ is the transistor channel width, and $L$ is the channel length.\n\nThe design specifications for the amplifier stage are as follows:\n- The required transconductance must be $g_m = 1.25 \\text{ mS}$.\n- The quiescent drain current is set by the power budget to be $I_D = 250.0 \\text{ µA}$.\n- The process transconductance parameter is $k'_n = 320.0 \\text{ µA/V}^2$.\n- The transistor must be fabricated with a channel length of $L = 500 \\text{ nm}$ to achieve a desirable output resistance.\n\nYour task is to calculate the required physical channel width $W$ for the NMOS transistor that satisfies all the given design constraints. Express your final answer in micrometers (µm), rounded to three significant figures.", "solution": "The given relation between transconductance efficiency and normalized current density is\n$$\n\\left(\\frac{g_m}{I_D}\\right)^2 = \\frac{2k'_n}{I_{\\text{norm}}} = \\frac{2k'_n}{I_D/(W/L)} = \\frac{2k'_n}{I_D}\\frac{W}{L}.\n$$\nSolving for $W$ gives\n$$\nW = \\left(\\frac{g_m}{I_D}\\right)^2 \\frac{I_D L}{2k'_n} = \\frac{g_m^2 L}{2k'_n I_D}.\n$$\nSubstitute the specified values using consistent SI units: $g_m = 1.25 \\times 10^{-3}\\,\\text{S}$, $I_D = 2.50 \\times 10^{-4}\\,\\text{A}$, $k'_n = 3.20 \\times 10^{-4}\\,\\text{A/V}^2$, and $L = 5.00 \\times 10^{-7}\\,\\text{m}$. Then\n$$\nW = \\frac{(1.25 \\times 10^{-3})^2 \\times (5.00 \\times 10^{-7})}{2 \\times (3.20 \\times 10^{-4}) \\times (2.50 \\times 10^{-4})} = \\frac{1.5625 \\times 10^{-6} \\times 5.00 \\times 10^{-7}}{1.60 \\times 10^{-7}} = \\frac{7.8125 \\times 10^{-13}}{1.60 \\times 10^{-7}} = 4.8828125 \\times 10^{-6}\\,\\text{m}.\n$$\nConverting to micrometers gives $W=4.8828125\\,\\text{µm}$, which to three significant figures is $4.88\\,\\text{µm}$.", "answer": "$$\\boxed{4.88}$$", "id": "1308221"}, {"introduction": "A designer's choice of $g_m/I_D$ has profound implications for circuit performance beyond just gain and bandwidth. This practice explores the critical relationship between $g_m/I_D$ and the input offset voltage of a differential pair, a key metric for precision circuits. By deriving the expression for offset voltage arising from transistor mismatch [@problem_id:1308200], you will learn how biasing a transistor more towards weak inversion (high $g_m/I_D$) can help mitigate certain fabrication variations, a crucial trade-off in analog design.", "problem": "An analog circuit designer is developing the input stage for a high-precision instrumentation amplifier. The input stage consists of an NMOS differential pair operating in saturation. To minimize the input-referred offset voltage ($V_{OS}$), which is a critical performance metric, the designer must carefully consider the statistical mismatches between the two transistors in the pair.\n\nThe primary sources of random offset are mismatches in the threshold voltage ($V_{th}$) and the current factor ($\\beta = \\mu_n C_{ox} W/L$), where $\\mu_n$ is the electron mobility, $C_{ox}$ is the gate oxide capacitance per unit area, and $W$ and $L$ are the transistor's channel width and length, respectively. These statistical variations are described by the Pelgrom mismatch model. The standard deviation of the difference in threshold voltage between the two transistors is given by $\\sigma_{\\Delta V_{th}} = \\frac{A_{V_{th}}}{\\sqrt{A}}$, and the standard deviation of their relative current factor mismatch is given by $\\sigma_{\\Delta\\beta/\\beta} = \\frac{A_{\\beta}}{\\sqrt{A}}$. Here, $A = WL$ is the gate area of each transistor, and $A_{V_{th}}$ and $A_{\\beta}$ are process-dependent mismatch technology constants.\n\nAssume the differential pair is operating with a bias current $I_D$ in each transistor, and the load is ideal and perfectly matched. The transistors follow the square-law model for drain current in saturation. The designer uses the transconductance-over-current ($g_m/I_D$) design methodology to set the operating point.\n\nDerive an expression for the total input-referred offset voltage standard deviation, $\\sigma_{V_{OS}}$, which accounts for both mismatch sources. Your final expression should be in terms of the transistor gate area $A$, the chosen transconductance efficiency ratio $g_m/I_D$, and the technology constants $A_{V_{th}}$ and $A_{\\beta}$.", "solution": "The problem asks for the standard deviation of the total input-referred offset voltage, $\\sigma_{V_{OS}}$, of a differential pair, considering mismatches in both threshold voltage ($V_{th}$) and the current factor ($\\beta$).\n\nFirst, we express the total input offset voltage $V_{OS}$ as the linear superposition of the offsets caused by each mismatch source. This is a valid approximation for small mismatches.\n$$V_{OS} = V_{OS, V_{th}} + V_{OS, \\beta}$$\nwhere $V_{OS, V_{th}}$ is the offset due to $\\Delta V_{th}$ and $V_{OS, \\beta}$ is the offset due to $\\Delta \\beta$.\n\n1.  **Offset due to Threshold Voltage Mismatch ($\\Delta V_{th}$):**\n    The drain currents for the two transistors, M1 and M2, are given by the square-law model:\n    $$I_{D1} = \\frac{1}{2}\\beta_1(V_{GS1} - V_{th1})^2$$\n    $$I_{D2} = \\frac{1}{2}\\beta_2(V_{GS2} - V_{th2})^2$$\n    For this part, we consider only $V_{th}$ mismatch, so $\\beta_1 = \\beta_2 = \\beta$. Let $V_{th1}$ and $V_{th2}$ be the mismatched threshold voltages. The offset voltage $V_{OS}$ is the differential input voltage $V_{in1} - V_{in2}$ required to make the drain currents equal, i.e., $I_{D1} = I_{D2}$. This also means $V_{GS1} - V_{th1} = V_{GS2} - V_{th2}$.\n    Since $V_{GS1} - V_{GS2} = (V_{in1} - V_S) - (V_{in2} - V_S) = V_{in1} - V_{in2} = V_{OS}$, we have:\n    $$V_{OS} = V_{th1} - V_{th2} = \\Delta V_{th}$$\n    So, the offset contribution from threshold voltage mismatch is simply the mismatch itself: $V_{OS, V_{th}} = \\Delta V_{th}$.\n\n2.  **Offset due to Current Factor Mismatch ($\\Delta \\beta$):**\n    Now we consider only $\\beta$ mismatch, so $V_{th1} = V_{th2} = V_{th}$. The mismatched current factors are $\\beta_1$ and $\\beta_2$.\n    At a common input voltage ($V_{in1}=V_{in2}=V_{in,cm}$), the gate-source voltages are equal, $V_{GS1}=V_{GS2}=V_{GS}$. The mismatch in $\\beta$ will cause a mismatch in the drain currents. Let the nominal parameters be $\\beta$ and $I_D$, and the mismatches be $\\Delta \\beta = \\beta_1 - \\beta_2$. The differential output current caused by this mismatch is:\n    $$\\Delta I_{D, mismatch} = I_{D1} - I_{D2} = \\frac{1}{2}\\beta_1(V_{GS} - V_{th})^2 - \\frac{1}{2}\\beta_2(V_{GS} - V_{th})^2 = \\frac{1}{2}(\\beta_1 - \\beta_2)(V_{GS} - V_{th})^2$$\n    Recognizing that the nominal drain current is $I_D = \\frac{1}{2}\\beta(V_{GS} - V_{th})^2$, we can write:\n    $$\\Delta I_{D, mismatch} = \\frac{\\Delta \\beta}{\\beta} I_D$$\n    The input-referred offset voltage $V_{OS, \\beta}$ is the voltage that must be applied to the input to generate a counteracting differential current equal to $\\Delta I_{D,mismatch}$. The differential output current generated by an input $V_{OS}$ is $g_m V_{OS}$. Therefore:\n    $$g_m V_{OS, \\beta} = \\Delta I_{D, mismatch} = \\frac{\\Delta \\beta}{\\beta} I_D$$\n    Solving for $V_{OS, \\beta}$:\n    $$V_{OS, \\beta} = \\frac{I_D}{g_m} \\frac{\\Delta \\beta}{\\beta} = \\frac{1}{g_m/I_D} \\frac{\\Delta \\beta}{\\beta}$$\n\n3.  **Total Offset Voltage and its Standard Deviation:**\n    The total input offset voltage is the sum of the two contributions (the relative sign does not affect the variance calculation):\n    $$V_{OS} = \\Delta V_{th} + \\frac{1}{g_m/I_D} \\frac{\\Delta \\beta}{\\beta}$$\n    The standard deviation of $V_{OS}$, denoted $\\sigma_{V_{OS}}$, is found by calculating the variance, $\\sigma_{V_{OS}}^2 = \\text{Var}(V_{OS})$. Assuming that the physical causes of threshold voltage mismatch and current factor mismatch are independent, their random variations $\\Delta V_{th}$ and $\\Delta \\beta/\\beta$ are uncorrelated. Therefore, the variance of the sum is the sum of the variances:\n    $$\\sigma_{V_{OS}}^2 = \\text{Var}\\left(\\Delta V_{th}\\right) + \\text{Var}\\left(\\frac{1}{g_m/I_D} \\frac{\\Delta \\beta}{\\beta}\\right)$$\n    Since $g_m/I_D$ is a deterministic design parameter, it can be treated as a constant:\n    $$\\sigma_{V_{OS}}^2 = \\sigma_{\\Delta V_{th}}^2 + \\left(\\frac{1}{g_m/I_D}\\right)^2 \\sigma_{\\Delta\\beta/\\beta}^2$$\n\n4.  **Substituting the Pelgrom Model:**\n    Now, we substitute the given expressions for the standard deviations from the Pelgrom model:\n    $$\\sigma_{\\Delta V_{th}} = \\frac{A_{V_{th}}}{\\sqrt{A}}$$\n    $$\\sigma_{\\Delta\\beta/\\beta} = \\frac{A_{\\beta}}{\\sqrt{A}}$$\n    Plugging these into the variance equation:\n    $$\\sigma_{V_{OS}}^2 = \\left(\\frac{A_{V_{th}}}{\\sqrt{A}}\\right)^2 + \\frac{1}{(g_m/I_D)^2} \\left(\\frac{A_{\\beta}}{\\sqrt{A}}\\right)^2$$\n    $$\\sigma_{V_{OS}}^2 = \\frac{A_{V_{th}}^2}{A} + \\frac{A_{\\beta}^2}{A(g_m/I_D)^2}$$\n    We can factor out the term $1/A$:\n    $$\\sigma_{V_{OS}}^2 = \\frac{1}{A} \\left( A_{V_{th}}^2 + \\frac{A_{\\beta}^2}{(g_m/I_D)^2} \\right)$$\n    Finally, we take the square root to find the standard deviation $\\sigma_{V_{OS}}$:\n    $$\\sigma_{V_{OS}} = \\sqrt{\\frac{1}{A} \\left( A_{V_{th}}^2 + \\frac{A_{\\beta}^2}{(g_m/I_D)^2} \\right)} = \\frac{1}{\\sqrt{A}} \\sqrt{A_{V_{th}}^2 + \\frac{A_{\\beta}^2}{(g_m/I_D)^2}}$$\n    This is the final expression for the total input offset voltage standard deviation in terms of the specified parameters.", "answer": "$$\\boxed{\\frac{1}{\\sqrt{A}} \\sqrt{A_{V_{th}}^{2} + \\frac{A_{\\beta}^{2}}{\\left(\\frac{g_m}{I_D}\\right)^{2}}}}$$", "id": "1308200"}, {"introduction": "Real-world design often involves balancing competing specifications, and the cascode amplifier is a classic example. This problem challenges you to apply the $g_m/I_D$ methodology to a multi-transistor circuit where different operating points may be optimal for different devices [@problem_id:1308234]. You will analyze how the $g_m/I_D$ choices for the input and cascode transistors create a trade-off between voltage gain and output voltage swing, developing the critical skill of navigating design compromises to meet system-level targets.", "problem": "An analog circuit designer is tasked with creating a high-performance NMOS cascode amplifier. The amplifier is constructed with two identical NMOS transistors, an input transistor $M_1$ and a cascode transistor $M_2$. The design must be implemented using a technology with the following parameters: electron mobility times oxide capacitance $\\mu_n C_{ox} = 200\\,\\mu\\text{A/V}^2$, threshold voltage $V_{THn} = 0.4 \\text{ V}$, and channel-length modulation parameter $\\lambda_n = 0.2 \\text{ V}^{-1}$ for both transistors.\n\nThe amplifier operates from a supply voltage of $V_{DD} = 1.8 \\text{ V}$ and is biased with a drain current of $I_D = 100\\,\\mu\\text{A}$. The gate of the cascode transistor $M_2$ is connected to a stable DC bias voltage of $V_{bias} = 1.2 \\text{ V}$.\n\nThe design must satisfy two critical performance requirements:\n1.  The small-signal DC voltage gain, $|A_v|$, must be at least $650 \\text{ V/V}$.\n2.  The output voltage swing, defined as the voltage range at the output for which both $M_1$ and $M_2$ remain in the saturation region, must be at least $1.0 \\text{ V}$.\n\nThe designer is considering four possible design choices based on the transconductance efficiency ($g_m/I_D$) for the input transistor $M_1$ and the cascode transistor $M_2$. The choices for the pair $((g_m/I_D)_1, (g_m/I_D)_2)$ are listed below.\n\n- A: $(5.0 \\text{ V}^{-1}, 5.0 \\text{ V}^{-1})$\n\n- B: $(10.0 \\text{ V}^{-1}, 3.34 \\text{ V}^{-1})$\n\n- C: $(3.34 \\text{ V}^{-1}, 10.0 \\text{ V}^{-1})$\n\n- D: $(2.0 \\text{ V}^{-1}, 15.0 \\text{ V}^{-1})$\n\nFrom the following design choices, select the one that satisfies all specifications. If multiple options are valid, select the one that results in a higher transconductance $g_{m1}$ for the input transistor $M_1$.", "solution": "The problem asks us to evaluate four design choices for a cascode amplifier and select the one that meets all specifications, with a tie-breaking rule based on the input transistor's transconductance, $g_{m1}$. Let's denote $(g_m/I_D)_1$ as $x$ and $(g_m/I_D)_2$ as $y$. We need to derive the constraints on $x$ and $y$ based on the given requirements.\n\n**1. Gain Constraint**\n\nThe small-signal DC voltage gain of a cascode amplifier is given by $A_v = -g_{m1} R_{out}$, where $R_{out}$ is the output resistance of the cascode stage. The output resistance is approximately $R_{out} \\approx g_{m2}r_{o2}r_{o1}$, where $g_m$ is the transconductance and $r_o$ is the intrinsic output resistance of a transistor.\n\nFirst, calculate the intrinsic output resistance $r_o$:\n$r_o = \\frac{1}{\\lambda_n I_D}$. Since $\\lambda_n = 0.2 \\text{ V}^{-1}$ and $I_D = 100\\,\\mu\\text{A} = 10^{-4} \\text{ A}$ for both transistors, $r_{o1} = r_{o2} = r_o$.\n$r_o = \\frac{1}{0.2 \\text{ V}^{-1} \\times 10^{-4} \\text{ A}} = 50 \\times 10^3\\,\\Omega = 50\\,\\text{k}\\Omega$.\n\nThe magnitude of the gain is $|A_v| \\approx g_{m1} g_{m2} r_{o1} r_{o2}$. The requirement is $|A_v| \\ge 650$.\n$g_{m1} g_{m2} (50 \\times 10^3\\,\\Omega)^2 \\ge 650$\n$g_{m1} g_{m2} (2.5 \\times 10^9\\,\\Omega^2) \\ge 650$\n$g_{m1} g_{m2} \\ge \\frac{650}{2.5 \\times 10^9} = 2.6 \\times 10^{-7} \\text{ (A/V)}^2$.\n\nWe can express $g_m$ in terms of $g_m/I_D$: $g_m = (g_m/I_D) \\times I_D$.\n$g_{m1} = x \\cdot I_D = x \\cdot 10^{-4} \\text{ A}$\n$g_{m2} = y \\cdot I_D = y \\cdot 10^{-4} \\text{ A}$\n\nSubstituting these into the gain inequality:\n$(x \\cdot 10^{-4})(y \\cdot 10^{-4}) \\ge 2.6 \\times 10^{-7}$\n$xy \\cdot 10^{-8} \\ge 2.6 \\times 10^{-7}$\n$xy \\ge 26$. This is our first constraint.\n\n**2. Swing and Biasing Constraints**\n\nThe output voltage swing is limited by the conditions needed to keep both transistors in saturation.\nThe minimum output voltage, $V_{out,min}$, is determined by the sum of the overdrive voltages of the two transistors. For both to be in saturation, the voltage at the drain of $M_1$ must be at least $V_{OV1}$, and the drain-source voltage of $M_2$ must be at least $V_{OV2}$. This leads to:\n$V_{out,min} = V_{OV1} + V_{OV2}$.\n\nThe maximum output voltage, $V_{out,max}$, when loaded by an ideal current source, is $V_{DD}$.\nThe output voltage swing is $V_{swing} = V_{out,max} - V_{out,min} = V_{DD} - (V_{OV1} + V_{OV2})$.\nThe requirement is $V_{swing} \\ge 1.0 \\text{ V}$.\n$1.8 \\text{ V} - (V_{OV1} + V_{OV2}) \\ge 1.0 \\text{ V}$\n$V_{OV1} + V_{OV2} \\le 0.8 \\text{ V}$.\n\nThe overdrive voltage $V_{OV}$ is related to $g_m/I_D$ by $V_{OV} = \\frac{2}{g_m/I_D}$.\nSo, $\\frac{2}{x} + \\frac{2}{y} \\le 0.8 \\text{ V}$, which simplifies to $\\frac{1}{x} + \\frac{1}{y} \\le 0.4$. This is our second constraint.\n\nThere is another biasing constraint. For the cascode arrangement to work, the intermediate node voltage $V_X$ (drain of $M_1$, source of $M_2$) must be in a valid range. $M_1$ must be in saturation, so its drain voltage must be greater than its source-gate voltage difference minus threshold, i.e., $V_{DS1} > V_{GS1} - V_{THn} = V_{OV1}$. So, $V_X \\ge V_{OV1}$. Also, $M_2$ must have a gate-source voltage sufficient to turn it on, $V_{GS2} > V_{THn}$.\n$V_{GS2} = V_{bias} - V_X$. So, $V_{bias} - V_X > V_{THn}$, which implies $V_X  V_{bias} - V_{THn}$.\nCombining these, we need $V_{OV1} \\le V_X  V_{bias} - V_{THn}$. A necessary condition for a valid bias point to exist is $V_{OV1}  V_{bias} - V_{THn}$.\n$V_{bias} - V_{THn} = 1.2 \\text{ V} - 0.4 \\text{ V} = 0.8 \\text{ V}$.\nSo, $V_{OV1}  0.8 \\text{ V}$, which means $\\frac{2}{x}  0.8 \\implies x > \\frac{2}{0.8} = 2.5$. This is our third constraint.\n\nSummary of constraints for $((g_m/I_D)_1, (g_m/I_D)_2) = (x, y)$:\n1.  $xy \\ge 26$\n2.  $\\frac{1}{x} + \\frac{1}{y} \\le 0.4$\n3.  $x > 2.5$\n\n**3. Evaluating the Options**\n\nLet's check each option against these three constraints.\n\n- **A: $(x, y) = (5.0, 5.0)$**\n  1. Gain: $xy = 5.0 \\times 5.0 = 25$. This is less than 26. **Fails.**\n- **B: $(x, y) = (10.0, 3.34)$**\n  1. Gain: $xy = 10.0 \\times 3.34 = 33.4$. This is greater than 26. **Pass.**\n  2. Swing/Bias: $\\frac{1}{10.0} + \\frac{1}{3.34} = 0.1 + 0.2994... = 0.3994...$. This is less than or equal to 0.4. **Pass.**\n  3. M1 Bias: $x = 10.0$. This is greater than 2.5. **Pass.**\nThis option is a valid design.\n- **C: $(x, y) = (3.34, 10.0)$**\n  1. Gain: $xy = 3.34 \\times 10.0 = 33.4$. This is greater than 26. **Pass.**\n  2. Swing/Bias: $\\frac{1}{3.34} + \\frac{1}{10.0} = 0.2994... + 0.1 = 0.3994...$. This is less than or equal to 0.4. **Pass.**\n  3. M1 Bias: $x = 3.34$. This is greater than 2.5. **Pass.**\nThis option is also a valid design.\n- **D: $(x, y) = (2.0, 15.0)$**\n  1. Gain: $xy = 2.0 \\times 15.0 = 30$. This is greater than 26. Pass.\n  2. Swing/Bias: $\\frac{1}{2.0} + \\frac{1}{15.0} = 0.5 + 0.066... = 0.566...$. This is greater than 0.4. **Fails.**\n  3. M1 Bias: $x = 2.0$. This is not greater than 2.5. **Fails.**\nThis option fails on two counts.\n\n**4. Tie-Breaker**\n\nBoth options B and C satisfy the primary specifications. We must now apply the tie-breaker rule: \"select the one that results in a higher transconductance $g_{m1}$ for the input transistor.\"\nSince $g_{m1} = (g_m/I_D)_1 \\times I_D = x \\cdot I_D$, a higher $g_{m1}$ corresponds to a higher value of $x$.\n- For option B, $x = (g_m/I_D)_1 = 10.0 \\text{ V}^{-1}$.\n- For option C, $x = (g_m/I_D)_1 = 3.34 \\text{ V}^{-1}$.\n\nComparing the two, option B provides a significantly higher transconductance for the input transistor $M_1$. Therefore, according to the problem's criteria, option B is the correct choice.", "answer": "$$\\boxed{B}$$", "id": "1308234"}]}