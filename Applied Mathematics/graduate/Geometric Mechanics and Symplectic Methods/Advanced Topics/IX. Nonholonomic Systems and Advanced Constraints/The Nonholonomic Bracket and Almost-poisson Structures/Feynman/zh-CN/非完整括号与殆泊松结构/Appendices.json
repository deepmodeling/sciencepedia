{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握非完整系统的几何力学，最基本的一步是能够从第一性原理出发，显式地计算非完整括号。本练习  提供了一个绝佳的起点。它将引导你为一个具有线性速度约束的简单力学系统，通过将其相空间上的典范辛形式限制在约束子流形上，一步步推导出非完整括号的具体表达式。这个过程不仅能加深你对约束分布、限制辛形式等几何概念的理解，也是后续更复杂分析的基础。",
            "id": "3780341",
            "problem": "考虑一个力学系统，其位形流形为 $Q=\\mathbb{R}^{3}$，笛卡尔坐标为 $(x,y,z)$。拉格朗日量为动能 $L=\\tfrac{1}{2} m \\left(\\dot{x}^{2}+\\dot{y}^{2}+\\dot{z}^{2}\\right)$。施加一个由1-形式 $\\omega=\\mathrm{d}z - x\\,\\mathrm{d}y$ 给出的线性非完整速度约束，即容许速度满足 $\\dot{z}-x\\,\\dot{y}=0$。令 $\\tau:T^{*}Q\\to Q$ 为典范投影，并为 $T^{*}Q$ 配备典范坐标 $(x,y,z,p_{x},p_{y},p_{z})$ 下的典范辛2-形式 $\\Omega = \\mathrm{d}x\\wedge \\mathrm{d}p_{x} + \\mathrm{d}y\\wedge \\mathrm{d}p_{y} + \\mathrm{d}z\\wedge \\mathrm{d}p_{z}$。利用由动能度量诱导的勒让德变换，确定约束子流形 $M\\subset T^{*}Q$ 和由 $C=\\{v\\in T(T^{*}Q)|_{M}\\mid T\\tau(v)\\in D\\}$ 定义的约束分布 $C\\subset T(T^{*}Q)|_{M}$，其中 $D=\\ker\\omega\\subset TQ$。用 $\\Omega_{C}$ 表示 $\\Omega$ 在 $C$ 上的限制。对于任意光滑函数 $f\\in C^{\\infty}(M)$，令 $Y_{f}\\in\\Gamma(C)$ 为满足非完整近泊松结构定义关系的唯一截面，即\n$$\n\\iota_{Y_{f}}\\,\\Omega_{C}= \\mathrm{d}f\\big|_{C}.\n$$\n在 $C^{\\infty}(M)$ 上定义非完整括号为\n$$\n\\{f,g\\}_{\\mathrm{nh}} := \\Omega_{C}(Y_{g}, Y_{f}).\n$$\n仅从这些定义出发，计算非完整括号 $\\{z, p_{y}\\}_{\\mathrm{nh}}$ 作为 $M$ 上的函数的显式解析表达式，并用典范坐标表示。以最简闭式形式给出您的最终表达式。无需四舍五入。",
            "solution": "该问题要求计算一个定义在位形流形 $Q=\\mathbb{R}^{3}$ 上且带有一个特定非完整约束的系统的非完整括号 $\\{z, p_y\\}_{\\mathrm{nh}}$。计算过程首先是刻画所涉及的几何结构，即约束子流形和约束分布，然后应用给定的非完整向量场和括号本身的定义。\n\n首先，我们确定约束子流形 $M \\subset T^{*}Q$。拉格朗日量由动能 $L=\\tfrac{1}{2} m \\left(\\dot{x}^{2}+\\dot{y}^{2}+\\dot{z}^{2}\\right)$ 给出。勒让德变换通过关系 $p_i = \\frac{\\partial L}{\\partial \\dot{q}^i}$ 将速度 $(\\dot{x}, \\dot{y}, \\dot{z}) \\in TQ$ 映射到动量 $(p_x, p_y, p_z) \\in T^*Q$。\n$$\np_x = m\\dot{x}, \\quad p_y = m\\dot{y}, \\quad p_z = m\\dot{z}\n$$\n非完整约束在速度上给出为 $\\dot{z} - x\\dot{y} = 0$。我们将其转化为动量上的一个条件：\n$$\n\\frac{p_z}{m} - x \\frac{p_y}{m} = 0 \\implies p_z - xp_y = 0\n$$\n该方程定义了约束子流形 $M \\subset T^*Q$。令 $\\phi(x,y,z,p_x,p_y,p_z) = p_z - xp_y$。则 $M = \\{ (q,p) \\in T^*Q \\mid \\phi(q,p) = 0 \\}$。\n\n接下来，我们刻画约束分布 $C \\subset T(T^*Q)|_{M}$。在点 $p \\in M$ 处的一个向量 $V \\in T_p(T^*Q)$ 属于子空间 $C_p$ 如果它满足两个条件。令 $V$ 在局部坐标下表示为：\n$$\nV = v_x \\frac{\\partial}{\\partial x} + v_y \\frac{\\partial}{\\partial y} + v_z \\frac{\\partial}{\\partial z} + \\dot{p}_x \\frac{\\partial}{\\partial p_x} + \\dot{p}_y \\frac{\\partial}{\\partial p_y} + \\dot{p}_z \\frac{\\partial}{\\partial p_z}\n$$\n第一个条件是它到 $TQ$ 的投影位于分布 $D = \\ker\\omega$ 中，其中 $\\omega = \\mathrm{d}z - x\\,\\mathrm{d}y$。该投影为 $T\\tau(V) = v_x \\frac{\\partial}{\\partial x} + v_y \\frac{\\partial}{\\partial y} + v_z \\frac{\\partial}{\\partial z}$。条件 $T\\tau(V) \\in D$ 意味着 $\\omega(T\\tau(V)) = 0$，这给出：\n$$\n(\\mathrm{d}z - x\\,\\mathrm{d}y)\\left(v_x \\frac{\\partial}{\\partial x} + v_y \\frac{\\partial}{\\partial y} + v_z \\frac{\\partial}{\\partial z}\\right) = v_z - xv_y = 0 \\quad (1)\n$$\n第二个条件是 $V$ 必须与流形 $M$ 相切。这意味着 $V$ 必须零化 $M$ 的定义函数，即 $V(\\phi) = 0$。\n$$\nV(\\phi) = V(p_z - xp_y) = \\dot{p}_z - \\left(v_x p_y + x \\dot{p}_y\\right) = 0 \\implies \\dot{p}_z - x\\dot{p}_y - v_x p_y = 0 \\quad (2)\n$$\n因此，$C_p$ 是 $T_p(T^*Q)$ 的子空间，其向量分量满足方程 $(1)$ 和 $(2)$。\n\n非完整括号定义为 $\\{f, g\\}_{\\mathrm{nh}} := \\Omega_C(Y_g, Y_f)$，其中对于任意函数 $h \\in C^\\infty(M)$，向量场 $Y_h \\in \\Gamma(C)$ 由关系 $\\iota_{Y_h} \\Omega_C = \\mathrm{d}h|_C$ 定义。这意味着对于任意向量场 $W \\in \\Gamma(C)$，我们有 $\\Omega(Y_h, W) = \\mathrm{d}h(W)$。\n我们希望计算 $\\{z, p_y\\}_{\\mathrm{nh}}$。令 $f=z$ 和 $g=p_y$。\n$$\n\\{z, p_y\\}_{\\mathrm{nh}} = \\Omega_C(Y_{p_y}, Y_z)\n$$\n使用 $Y_{p_y}$ 的定义，我们有 $\\Omega_C(Y_{p_y}, Y_z) = \\mathrm{d}p_y(Y_z)$。我们的任务简化为找到向量场 $Y_z$，然后将1-形式 $\\mathrm{d}p_y$ 应用于它。\n\n令 $Y_z$ 为 $\\Gamma(C)$ 中的一个向量场：\n$$\nY_z = A_x \\frac{\\partial}{\\partial x} + A_y \\frac{\\partial}{\\partial y} + A_z \\frac{\\partial}{\\partial z} + B_x \\frac{\\partial}{\\partial p_x} + B_y \\frac{\\partial}{\\partial p_y} + B_z \\frac{\\partial}{\\partial p_z}\n$$\n由于 $Y_z \\in \\Gamma(C)$，其分量必须满足约束方程 $(1)$ 和 $(2)$：\n$$\nA_z - xA_y = 0 \\quad (A)\n$$\n$$\nB_z - xB_y - A_x p_y = 0 \\quad (B)\n$$\n$Y_z$ 的定义关系是 $\\Omega(Y_z, W) = \\mathrm{d}z(W)$，对于任意 $W \\in \\Gamma(C)$ 均成立。令 $W$ 为 $C_p$ 中具有分量 $(w_x, w_y, w_z, \\dot{p}_x, \\dot{p}_y, \\dot{p}_z)$ 的任意向量。\n左边是 $\\Omega(Y_z, W) = (A_x\\dot{p}_x - B_x w_x) + (A_y\\dot{p}_y - B_y w_y) + (A_z\\dot{p}_z - B_z w_z)$。\n右边是 $\\mathrm{d}z(W) = w_z$。\n使用 $W$ 上的约束方程 $w_z = xw_y$ 和 $\\dot{p}_z = x\\dot{p}_y + w_x p_y$，我们可以将它们代入 $\\Omega(Y_z, W)$ 的展开形式中：\n$$\n(A_x\\dot{p}_x - B_x w_x) + (A_y\\dot{p}_y - B_y w_y) + (A_z(x\\dot{p}_y + w_x p_y) - B_z(xw_y)) = xw_y\n$$\n我们根据 $W$ 的独立分量（可以选择为 $w_x, w_y, \\dot{p}_x, \\dot{p}_y$）来收集项：\n$$\nw_x(-B_x + A_z p_y) + w_y(-B_y - xB_z - x) + \\dot{p}_x(A_x) + \\dot{p}_y(A_y + xA_z) = 0\n$$\n由于这对 $w_x, w_y, \\dot{p}_x, \\dot{p}_y$ 的任意选择都必须成立，所以系数必须为零：\n$$\n\\begin{cases}\n-B_x + A_z p_y = 0  (i) \\\\\n-B_y - xB_z - x = 0  (ii) \\\\\nA_x = 0  (iii) \\\\\nA_y + xA_z = 0  (iv)\n\\end{cases}\n$$\n我们现在求解这个线性系统以及方程 $(A)$ 和 $(B)$。\n从 $(iii)$，我们得到 $A_x=0$。\n将 $A_x=0$ 代入 $(B)$ 得到 $B_z - xB_y = 0$，所以 $B_z = xB_y$。\n将此代入 $(ii)$ 得到 $-B_y - x(xB_y) - x = 0$，化简为 $-B_y(1+x^2) = x$，所以 $B_y = -\\frac{x}{1+x^2}$。\n那么 $B_z = xB_y = -\\frac{x^2}{1+x^2}$。\n从 $(iv)$，我们得到 $A_y = -xA_z$。\n将此代入 $(A)$ 得到 $A_z - x(-xA_z) = 0$，即 $A_z(1+x^2)=0$。由于 $1+x^2 \\neq 0$，我们必须有 $A_z=0$。\n那么 $A_y = -xA_z = 0$。\n最后，从 $(i)$， $B_x = A_z p_y = 0 \\cdot p_y = 0$。\n\n$Y_z$ 的分量是：\n$A_x=0$, $A_y=0$, $A_z=0$\n$B_x=0$, $B_y=-\\frac{x}{1+x^2}$, $B_z=-\\frac{x^2}{1+x^2}$\n所以向量场 $Y_z$ 是：\n$$\nY_z = -\\frac{x}{1+x^2} \\frac{\\partial}{\\partial p_y} - \\frac{x^2}{1+x^2} \\frac{\\partial}{\\partial p_z}\n$$\n现在我们可以计算非完整括号：\n$$\n\\{z, p_y\\}_{\\mathrm{nh}} = \\mathrm{d}p_y(Y_z) = \\mathrm{d}p_y \\left( -\\frac{x}{1+x^2} \\frac{\\partial}{\\partial p_y} - \\frac{x^2}{1+x^2} \\frac{\\partial}{\\partial p_z} \\right)\n$$\n将1-形式 $\\mathrm{d}p_y$ 应用于向量场 $Y_z$ 会提取出 $\\frac{\\partial}{\\partial p_y}$ 分量的系数。\n$$\n\\{z, p_y\\}_{\\mathrm{nh}} = -\\frac{x}{1+x^2}\n$$\n这就是非完整括号作为 $M$ 上的函数（具体来说，是坐标 $x$ 的函数）的显式解析表达式。",
            "answer": "$$\\boxed{-\\frac{x}{1+x^{2}}}$$"
        },
        {
            "introduction": "计算出非完整括号后，下一个关键问题是：它具有哪些代数性质？与哈密顿力学中的标准泊松括号相比，它有何不同？本练习  直接切入这一核心问题，要求你计算一个给定近泊松结构的雅可比子（Jacobiator）。雅可比子是检验雅可比恒等式是否成立的直接判据，而它的非零结果恰恰揭示了非完整系统的内在几何“曲率”，并从根本上解释了为什么这种结构被称为“近泊松”而非真正的泊松结构。",
            "id": "3780342",
            "problem": "考虑一个力学系统，其位形流形为 $Q = \\mathbb{R}^{3}$，全局坐标为 $(x,y,z)$。假设非完整约束在约化后，在 $C^{\\infty}(Q)$ 上产生一个几乎泊松括号，该括号由一个双向量场 $\\Pi$ 决定，其坐标形式如下：\n$$\n\\Pi(x,y,z) \\;=\\; x\\,\\partial_{x}\\wedge\\partial_{y} \\;+\\; y\\,\\partial_{y}\\wedge\\partial_{z} \\;+\\; z\\,\\partial_{z}\\wedge\\partial_{x}.\n$$\n根据定义，光滑函数 $f,g \\in C^{\\infty}(Q)$ 的相关括号为\n$$\n\\{f,g\\}(x,y,z) \\;=\\; \\Pi(df,dg) \\;=\\; x\\left(\\frac{\\partial f}{\\partial x}\\frac{\\partial g}{\\partial y} - \\frac{\\partial f}{\\partial y}\\frac{\\partial g}{\\partial x}\\right) \\;+\\; y\\left(\\frac{\\partial f}{\\partial y}\\frac{\\partial g}{\\partial z} - \\frac{\\partial f}{\\partial z}\\frac{\\partial g}{\\partial y}\\right) \\;+\\; z\\left(\\frac{\\partial f}{\\partial z}\\frac{\\partial g}{\\partial x} - \\frac{\\partial f}{\\partial x}\\frac{\\partial g}{\\partial z}\\right).\n$$\n此括号的雅可比子 $J$ 是定义在 $C^{\\infty}(Q)$ 上的三线性映射，定义为\n$$\nJ(f,g,h) \\;=\\; \\{f,\\{g,h\\}\\} \\;+\\; \\{g,\\{h,f\\}\\} \\;+\\; \\{h,\\{f,g\\}\\}.\n$$\n仅从这些定义出发，使用坐标技巧和计算验证，计算雅可比子 $J(x,y,z)$ 在点 $(x,y,z)=(1,1,1)$ 处的值。将最终答案表示为一个实数。无需四舍五入。",
            "solution": "问题要求计算特定函数 $f=x$，$g=y$ 和 $h=z$ 的雅可比子 $J(f,g,h)$，并在点 $(x,y,z) = (1,1,1)$ 处求值。雅可比子定义为：\n$$\nJ(f,g,h) \\;=\\; \\{f,\\{g,h\\}\\} \\;+\\; \\{g,\\{h,f\\}\\} \\;+\\; \\{h,\\{f,g\\}\\}\n$$\n几乎泊松括号由以下公式给出：\n$$\n\\{f,g\\} \\;=\\; x\\left(\\frac{\\partial f}{\\partial x}\\frac{\\partial g}{\\partial y} - \\frac{\\partial f}{\\partial y}\\frac{\\partial g}{\\partial x}\\right) \\;+\\; y\\left(\\frac{\\partial f}{\\partial y}\\frac{\\partial g}{\\partial z} - \\frac{\\partial f}{\\partial z}\\frac{\\partial g}{\\partial y}\\right) \\;+\\; z\\left(\\frac{\\partial f}{\\partial z}\\frac{\\partial g}{\\partial x} - \\frac{\\partial f}{\\partial x}\\frac{\\partial g}{\\partial z}\\right)\n$$\n我们被要求计算 $J(x,y,z)$，这是 $J(f=x, g=y, h=z)$ 的简写。需要求值的表达式是：\n$$\nJ(x,y,z) \\;=\\; \\{x, \\{y,z\\}\\} \\;+\\; \\{y, \\{z,x\\}\\} \\;+\\; \\{z, \\{x,y\\}\\}\n$$\n计算分两个阶段进行。首先，我们计算内层括号 $\\{y,z\\}$、$\\{z,x\\}$ 和 $\\{x,y\\}$。\n\n步骤 1：计算内层括号。\n\n1a. 计算 $\\{y,z\\}$：\n设 $f = y$ 和 $g = z$。偏导数为：\n$$\n\\frac{\\partial f}{\\partial x} = 0, \\quad \\frac{\\partial f}{\\partial y} = 1, \\quad \\frac{\\partial f}{\\partial z} = 0\n$$\n$$\n\\frac{\\partial g}{\\partial x} = 0, \\quad \\frac{\\partial g}{\\partial y} = 0, \\quad \\frac{\\partial g}{\\partial z} = 1\n$$\n将这些代入括号公式中：\n$$\n\\{y,z\\} = x\\left((0)(0) - (1)(0)\\right) + y\\left((1)(1) - (0)(0)\\right) + z\\left((0)(0) - (0)(1)\\right)\n$$\n$$\n\\{y,z\\} = x(0) + y(1) + z(0) = y\n$$\n\n1b. 计算 $\\{z,x\\}$：\n设 $f = z$ 和 $g = x$。偏导数为：\n$$\n\\frac{\\partial f}{\\partial x} = 0, \\quad \\frac{\\partial f}{\\partial y} = 0, \\quad \\frac{\\partial f}{\\partial z} = 1\n$$\n$$\n\\frac{\\partial g}{\\partial x} = 1, \\quad \\frac{\\partial g}{\\partial y} = 0, \\quad \\frac{\\partial g}{\\partial z} = 0\n$$\n将这些代入括号公式中：\n$$\n\\{z,x\\} = x\\left((0)(0) - (0)(1)\\right) + y\\left((0)(0) - (1)(0)\\right) + z\\left((1)(1) - (0)(0)\\right)\n$$\n$$\n\\{z,x\\} = x(0) + y(0) + z(1) = z\n$$\n\n1c. 计算 $\\{x,y\\}$：\n设 $f = x$ 和 $g = y$。偏导数为：\n$$\n\\frac{\\partial f}{\\partial x} = 1, \\quad \\frac{\\partial f}{\\partial y} = 0, \\quad \\frac{\\partial f}{\\partial z} = 0\n$$\n$$\n\\frac{\\partial g}{\\partial x} = 0, \\quad \\frac{\\partial g}{\\partial y} = 1, \\quad \\frac{\\partial g}{\\partial z} = 0\n$$\n将这些代入括号公式中：\n$$\n\\{x,y\\} = x\\left((1)(1) - (0)(0)\\right) + y\\left((0)(0) - (0)(1)\\right) + z\\left((0)(0) - (1)(0)\\right)\n$$\n$$\n\\{x,y\\} = x(1) + y(0) + z(0) = x\n$$\n总结步骤 1 的结果：\n$$\n\\{y,z\\} = y, \\quad \\{z,x\\} = z, \\quad \\{x,y\\} = x\n$$\n\n步骤 2：计算外层括号并求和。\n现在我们将步骤 1 的结果代入雅可比子的表达式中：\n$$\nJ(x,y,z) = \\{x, \\{y,z\\}\\} + \\{y, \\{z,x\\}\\} + \\{z, \\{x,y\\}\\}\n$$\n$$\nJ(x,y,z) = \\{x, y\\} + \\{y, z\\} + \\{z, x\\}\n$$\n我们已经在步骤 1 中计算了这些括号。我们再次代入它们的值：\n$$\nJ(x,y,z) = x + y + z\n$$\n这是雅可比子 $J(x,y,z)$ 的一般表达式。\n\n步骤 3：在给定点处计算雅可比子的值。\n问题要求雅可比子在点 $(x,y,z)=(1,1,1)$ 处的值。\n$$\nJ(1,1,1) = 1 + 1 + 1 = 3\n$$\n雅可比子 $J(x,y,z)$ 在点 $(1,1,1)$ 处的值为 $3$。非零的结果证实了给定的双向量 $\\Pi$ 定义了一个几乎泊松结构，但它不是一个真正的泊松结构，因为对于坐标函数，雅可比恒等式不成立。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "理论的生命力在于其在真实物理世界中的应用。本练习  将带你从抽象的数学定义走向具体的物理模型——经典的滚动的圆盘。你将通过编程实现一个离散化的非完整括号，并用数值方法检验雅可比恒等式的残差。这个实践不仅能让你亲手构建一个非完整动力学系统，还能通过计算结果直观地“看到”雅可比恒等式的破缺，从而在理论和计算的交汇处获得更深刻的洞察。",
            "id": "3746599",
            "problem": "考虑一个位形流形 $Q = \\mathbb{R}^2 \\times S^1 \\times S^1$，其坐标为 $q = (x,y,\\theta,\\varphi)$，模拟一个半径为 $R$ 的圆盘在水平面上无滑滚动。相应的相空间是余切丛 $T^*Q$，其坐标为 $z = (x,y,\\theta,\\varphi,p_x,p_y,p_\\theta,p_\\varphi) \\in \\mathbb{R}^8$。非完整滚动约束对速度是线性的，由下式给出\n$$\n\\dot{x} - R \\dot{\\varphi} \\cos\\theta = 0, \\qquad \\dot{y} - R \\dot{\\varphi} \\sin\\theta = 0,\n$$\n这定义了一个约束分布 $D \\subset TQ$，由 $A(q)\\dot{q} = 0$ 给出，其中\n$$\nA(q) = \\begin{bmatrix} 1  0  0  -R \\cos\\theta \\\\ 0  1  0  -R \\sin\\theta \\end{bmatrix}.\n$$\n假设 $TQ$ 上的动能度量由对角矩阵 $G = \\mathrm{diag}(m,m,I_\\theta,I_\\varphi)$ 定义，其中 $m$ 为质量，$I_\\theta$、$I_\\varphi$ 分别是关于 $\\theta$ 和 $\\varphi$ 角的转动惯量，均为严格正值。到约束分布 $D$ 上的正交投影（相对于由 $G$ 导出的内积）是\n$$\nP(q) = I_4 - G^{-1} A(q)^\\top \\left(A(q) G^{-1} A(q)^\\top\\right)^{-1} A(q),\n$$\n其中 $I_4$ 是 $4\\times 4$ 单位矩阵，$G^{-1} = \\mathrm{diag}\\left(\\frac{1}{m},\\frac{1}{m},\\frac{1}{I_\\theta},\\frac{1}{I_\\varphi}\\right)$。函数 $f,g : T^*Q \\to \\mathbb{R}$ 上的离散非完整括号通过一个依赖于状态的斜对称矩阵定义\n$$\nJ_d(z) = \\begin{bmatrix} 0_{4\\times 4}  P(q) \\\\ -P(q)^\\top  0_{4\\times 4} \\end{bmatrix},\n$$\n由公式\n$$\n\\{f,g\\}_d(z) = \\nabla f(z)^\\top J_d(z)\\, \\nabla g(z),\n$$\n给出，其中 $\\nabla f(z)$ 表示 $f$ 关于 $z$ 的梯度。为进行数值计算，使用中心有限差分格式（步长 $\\delta > 0$）独立应用于 $z$ 的每个坐标来近似 $\\nabla f(z)$ 和 $\\nabla g(z)$，并将 $J_d(z)$ 视为通过 $q=(x,y,\\theta,\\varphi)$ 依赖于状态。三个函数 $f,g,h$ 的离散雅可比恒等式是条件\n$$\n\\mathcal{J}(f,g,h)(z) := \\{f,\\{g,h\\}_d\\}_d(z) + \\{g,\\{h,f\\}_d\\}_d(z) + \\{h,\\{f,g\\}_d\\}_d(z) = 0,\n$$\n由于 $J_d(z)$ 随状态变化，该恒等式对于非完整括号通常不成立。\n\n从 Lagrange-d'Alembert 力学中约束的基本定律和核心定义出发，如上所述构造离散非完整括号 $\\{\\,\\cdot\\,,\\,\\cdot\\,\\}_d$，使用从约束矩阵 $A(q)$ 和动能度量 $G$ 导出的投影 $P(q)$。通过计算给定函数和参数下的标量 $\\mathcal{J}(f,g,h)(z)$，实现一个对离散雅可比恒等式的数值检验。\n\n使用以下标量测试函数：\n- $f(z) = x p_x + y p_\\varphi + \\theta \\varphi$,\n- $g(z) = y p_y + \\theta p_\\theta + \\varphi p_x$,\n- $h(z) = x y + \\theta \\varphi + p_x p_y + p_\\theta p_\\varphi$.\n\n所有角度均使用弧度。所有给定的物理参数均采用国际单位制（SI）。最终输出为无量纲浮点数。\n\n实现程序，使用中心差分步长 $\\delta = 10^{-6}$，在以下参数集和状态的测试套件中计算离散雅可比恒等式残差的绝对值 $|\\mathcal{J}(f,g,h)(z)|$：\n\n- 测试用例1（标准情况）：\n  - $R = 1.0$ $\\mathrm{m}$，$m = 2.0$ $\\mathrm{kg}$，$I_\\theta = 0.5$ $\\mathrm{kg}\\,\\mathrm{m}^2$，$I_\\varphi = 0.25$ $\\mathrm{kg}\\,\\mathrm{m}^2$，\n  - $z = (x,y,\\theta,\\varphi,p_x,p_y,p_\\theta,p_\\varphi) = (0.5,-0.3,0.7,-0.4,0.2,-0.1,0.05,-0.02)$。\n- 测试用例2（边界角度）：\n  - $R = 0.3$ $\\mathrm{m}$，$m = 1.0$ $\\mathrm{kg}$，$I_\\theta = 0.2$ $\\mathrm{kg}\\,\\mathrm{m}^2$，$I_\\varphi = 0.1$ $\\mathrm{kg}\\,\\mathrm{m}^2$，\n  - $z = (-1.2,0.8,1.5707963267948966,0.3,0.0,0.1,-0.03,0.04)$。\n- 测试用例3（零航向角）：\n  - $R = 2.0$ $\\mathrm{m}$，$m = 3.0$ $\\mathrm{kg}$，$I_\\theta = 1.5$ $\\mathrm{kg}\\,\\mathrm{m}^2$，$I_\\varphi = 0.5$ $\\mathrm{kg}\\,\\mathrm{m}^2$，\n  - $z = (0.0,0.0,0.0,1.0,1.0,-1.0,0.2,-0.2)$。\n- 测试用例4（小惯量边缘情况）：\n  - $R = 0.8$ $\\mathrm{m}$，$m = 0.5$ $\\mathrm{kg}$，$I_\\theta = 0.05$ $\\mathrm{kg}\\,\\mathrm{m}^2$，$I_\\varphi = 0.04$ $\\mathrm{kg}\\,\\mathrm{m}^2$，\n  - $z = (2.0,-2.0,2.5,-1.2,-0.5,0.3,-0.1,0.07)$。\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，例如 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是对应测试用例计算出的浮点数 $|\\mathcal{J}(f,g,h)(z)|$。",
            "solution": "该问题要求对定义在滚动圆盘相空间上的非完整括号的雅可比恒等式进行数值评估。雅可比恒等式是哈密顿力学中泊松括号的一个基本性质，它的不成立是非完整系统的一个标志。评估将在给定物理参数下，于相空间中的特定点进行。\n\n解决方案是根据几何力学原理导出的一系列步骤构建的。\n\n**步骤1：系统与约束定义**\n\n该系统是一个滚动圆盘，其状态由位形流形 $Q = \\mathbb{R}^2 \\times S^1 \\times S^1$ 上的坐标描述。坐标为 $q = (x, y, \\theta, \\varphi)$，其中 $(x, y)$ 是圆盘在平面上的接触点，$\\theta$ 是航向角，$\\varphi$ 是滚动角。相空间是余切丛 $T^*Q$，其坐标为 $z = (q, p) = (x, y, \\theta, \\varphi, p_x, p_y, p_\\theta, p_\\varphi) \\in \\mathbb{R}^8$。\n\n圆盘无滑滚动，对速度 $\\dot{q}$ 施加了两个非完整约束：\n$$\n\\dot{x} - R \\dot{\\varphi} \\cos\\theta = 0 \\\\\n\\dot{y} - R \\dot{\\varphi} \\sin\\theta = 0\n$$\n这些约束可以写成矩阵形式 $A(q)\\dot{q} = 0$，其中约束矩阵 $A(q)$ 是一个 $2 \\times 4$ 的矩阵，由下式给出：\n$$\nA(q) = \\begin{bmatrix} 1  0  0  -R \\cos\\theta \\\\ 0  1  0  -R \\sin\\theta \\end{bmatrix}\n$$\n\n**步骤2：动能度量与投影算子**\n\n系统的动能定义了位形流形 $Q$ 上的一个黎曼度量，由一个 $4 \\times 4$ 矩阵 $G$ 表示。对于此问题，$G$ 被给定为一个对角矩阵：\n$$\nG = \\mathrm{diag}(m, m, I_\\theta, I_\\varphi)\n$$\n其中 $m$ 是质量，$I_\\theta, I_\\varphi$ 是转动惯量。逆度量 $G^{-1}$ 定义了余切空间上的内积，其形式为：\n$$\nG^{-1} = \\mathrm{diag}\\left(\\frac{1}{m}, \\frac{1}{m}, \\frac{1}{I_\\theta}, \\frac{1}{I_\\varphi}\\right)\n$$\n约束定义了一个分布 $D_q = \\ker(A(q)) \\subset T_qQ$。非完整动力学被投影到这个分布上。构造了将动量矢量投影到约束分布的零化子 $D_q^o$ 上的正交投影算子 $P(q): T_q^*Q \\to T_q^*Q$。问题陈述定义了速度空间上的一个投影 $P(q)$，然后用它来构造相空间上的括号结构。给定的公式是投影到约束允许方向上的标准形式：\n$$\nP(q) = I_4 - G^{-1} A(q)^\\top \\left(A(q) G^{-1} A(q)^\\top\\right)^{-1} A(q)\n$$\n$2 \\times 2$ 矩阵 $M(q) = A(q) G^{-1} A(q)^\\top$ 计算如下：\n$$\nM(q) = \\begin{bmatrix}\n\\frac{1}{m} + \\frac{R^2 \\cos^2\\theta}{I_\\varphi}  \\frac{R^2 \\cos\\theta \\sin\\theta}{I_\\varphi} \\\\\n\\frac{R^2 \\cos\\theta \\sin\\theta}{I_\\varphi}  \\frac{1}{m} + \\frac{R^2 \\sin^2\\theta}{I_\\varphi}\n\\end{bmatrix}\n$$\n其行列式为 $\\det(M(q)) = \\frac{1}{m^2} + \\frac{R^2}{mI_\\varphi}$，对于给定的物理参数（$m, R, I_\\varphi > 0$），该值恒为正，确保 $M(q)$ 始终可逆。\n\n**步骤3：离散非完整括号**\n\n在相空间上的标量函数 $f, g: T^*Q \\to \\mathbb{R}$ 上定义了一个括号结构。它由以下公式给出：\n$$\n\\{f, g\\}_d(z) = \\nabla f(z)^\\top J_d(z) \\nabla g(z)\n$$\n其中 $\\nabla f(z)$ 是 $f$ 关于相空间坐标 $z$ 的梯度，而 $J_d(z)$ 是一个 $8 \\times 8$ 的斜对称矩阵：\n$$\nJ_d(z) = \\begin{bmatrix} 0_{4\\times 4}  P(q) \\\\ -P(q)^\\top  0_{4\\times 4} \\end{bmatrix}\n$$\n注意 $J_d(z)$ 对状态 $z$ 的依赖仅通过位形坐标 $q$。\n\n**步骤4：数值梯度计算**\n\n标量函数的梯度使用具有小步长 $\\delta$ 的中心有限差分格式进行数值近似。对于函数 $F(z)$，其梯度的第 $i$ 个分量是：\n$$\n(\\nabla F(z))_i = \\frac{\\partial F}{\\partial z_i}(z) \\approx \\frac{F(z + \\delta e_i) - F(z - \\delta e_i)}{2\\delta}\n$$\n其中 $e_i$ 是在第 $i$ 个位置为1，其余位置为0的标准基向量。\n\n**步骤5：雅可比恒等式残差**\n\n对于括号 $\\{\\cdot, \\cdot\\}$ 和三个函数 $f,g,h$，雅可比恒等式是条件 $\\mathcal{J}(f,g,h) = 0$，其中：\n$$\n\\mathcal{J}(f,g,h) = \\{f, \\{g,h\\}\\} + \\{g, \\{h,f\\}\\} + \\{h, \\{f,g\\}\\}\n$$\n问题要求计算给定非完整括号 $\\{ \\cdot, \\cdot \\}_d$ 的这个量。由于矩阵 $J_d(z)$ 依赖于状态 $z$，此括号不是一个真正的泊松括号，雅可比恒等式通常不被满足。$\\mathcal{J}(f,g,h)(z)$ 的计算需要括号的嵌套应用。例如，为了计算第一项 $\\{f, \\{g,h\\}_d\\}_d(z)$，我们首先在相空间上定义一个新的标量函数 $K_{gh}(z) := \\{g,h\\}_d(z)$。然后我们计算：\n$$\n\\{f, K_{gh}\\}_d(z) = \\nabla f(z)^\\top J_d(z) \\nabla K_{gh}(z)\n$$\n梯度 $\\nabla f(z)$ 是通过对 $f$ 应用有限差分公式计算的。关键的是，梯度 $\\nabla K_{gh}(z)$ 也必须使用有限差分计算，这涉及到在邻近点 $z \\pm \\delta e_i$ 处计算函数 $K_{gh}(z)$ 的值。每次对 $K_{gh}$ 的求值都需要对 $g$ 和 $h$ 进行其自身的梯度计算。这导致了一个嵌套的计算结构。总的雅可比子残差是三个循环置换项的和。\n\n**步骤6：算法实现**\n\n数值解是使用 `numpy` 库在 Python 中实现的。\n1.  测试函数 $f(z) = x p_x + y p_\\varphi + \\theta \\varphi$、$g(z) = y p_y + \\theta p_\\theta + \\varphi p_x$ 和 $h(z) = x y + \\theta \\varphi + p_x p_y + p_\\theta p_\\varphi$ 被定义为作用于8元状态向量 $z$ 的 Python 函数。\n2.  创建辅助函数来为给定的状态和物理参数集计算 $P(q)$ 矩阵和 $J_d(z)$ 矩阵。\n3.  一个通用的 `gradient` 函数实现了中心有限差分公式。\n4.  一个 `bracket` 函数接受两个任意函数 `F` 和 `G`、一个状态向量 `z`、参数和一个步长 `delta`。它使用 `gradient` 函数计算它们的梯度，然后计算 $\\{F,G\\}_d(z)$。\n5.  为了计算雅可比子，我们定义中间函数，例如，对于内层括号，定义 `K_gh = lambda z_vec: bracket(g, h, z_vec, ...)`。然后将这些函数传递给 `bracket` 函数来计算外层项，如 `bracket(f, K_gh, z, ...)`。\n6.  主循环遍历所提供的测试用例，计算三个雅可比子项的和，并存储此和的绝对值。最终结果按要求格式化。",
            "answer": "```python\nimport numpy as np\n\ndef f_func(z):\n    \"\"\"\n    Computes the value of the test function f(z).\n    z = (x, y, theta, phi, p_x, p_y, p_theta, p_phi)\n    f(z) = x*p_x + y*p_phi + theta*phi\n    \"\"\"\n    return z[0] * z[4] + z[1] * z[7] + z[2] * z[3]\n\ndef g_func(z):\n    \"\"\"\n    Computes the value of the test function g(z).\n    g(z) = y*p_y + theta*p_theta + phi*p_x\n    \"\"\"\n    return z[1] * z[5] + z[2] * z[6] + z[3] * z[4]\n\ndef h_func(z):\n    \"\"\"\n    Computes the value of the test function h(z).\n    h(z) = x*y + theta*phi + p_x*p_y + p_theta*p_phi\n    \"\"\"\n    return z[0] * z[1] + z[2] * z[3] + z[4] * z[5] + z[6] * z[7]\n\ndef get_P_matrix(q, params):\n    \"\"\"\n    Computes the projection matrix P(q).\n    \"\"\"\n    R = params['R']\n    m = params['m']\n    I_theta = params['I_theta']\n    I_phi = params['I_phi']\n    theta = q[2]\n    \n    G_inv = np.diag([1/m, 1/m, 1/I_theta, 1/I_phi])\n    A = np.array([\n        [1, 0, 0, -R * np.cos(theta)],\n        [0, 1, 0, -R * np.sin(theta)]\n    ])\n    \n    M = A @ G_inv @ A.T\n    M_inv = np.linalg.inv(M)\n    \n    P = np.identity(4) - G_inv @ A.T @ M_inv @ A\n    return P\n\ndef get_Jd_matrix(z, params):\n    \"\"\"\n    Computes the skew-symmetric matrix J_d(z).\n    \"\"\"\n    q = z[:4]\n    P = get_P_matrix(q, params)\n    Jd = np.zeros((8, 8))\n    Jd[0:4, 4:8] = P\n    Jd[4:8, 0:4] = -P.T\n    return Jd\n\ndef gradient(func, z, delta):\n    \"\"\"\n    Computes the gradient of a function using central finite differences.\n    \"\"\"\n    n = len(z)\n    grad = np.zeros(n)\n    for i in range(n):\n        z_plus = z.copy()\n        z_minus = z.copy()\n        z_plus[i] += delta\n        z_minus[i] -= delta\n        grad[i] = (func(z_plus) - func(z_minus)) / (2 * delta)\n    return grad\n\ndef bracket(F, G, z, params, delta):\n    \"\"\"\n    Computes the discrete nonholonomic bracket {F, G}_d(z).\n    \"\"\"\n    # J_d depends on the point z at which the bracket is evaluated.\n    Jd = get_Jd_matrix(z, params)\n    \n    # Gradients are also evaluated at z.\n    grad_F = gradient(F, z, delta)\n    grad_G = gradient(G, z, delta)\n    \n    return grad_F.T @ Jd @ grad_G\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute Jacobi identity residuals.\n    \"\"\"\n    test_cases = [\n        # (R, m, I_theta, I_phi, z_tuple)\n        (1.0, 2.0, 0.5, 0.25, (0.5, -0.3, 0.7, -0.4, 0.2, -0.1, 0.05, -0.02)),\n        (0.3, 1.0, 0.2, 0.1, (-1.2, 0.8, 1.5707963267948966, 0.3, 0.0, 0.1, -0.03, 0.04)),\n        (2.0, 3.0, 1.5, 0.5, (0.0, 0.0, 0.0, 1.0, 1.0, -1.0, 0.2, -0.2)),\n        (0.8, 0.5, 0.05, 0.04, (2.0, -2.0, 2.5, -1.2, -0.5, 0.3, -0.1, 0.07)),\n    ]\n    delta = 1e-6\n    \n    results = []\n    \n    for case in test_cases:\n        R, m, I_theta, I_phi, z_tuple = case\n        params = {'R': R, 'm': m, 'I_theta': I_theta, 'I_phi': I_phi}\n        z = np.array(z_tuple, dtype=float)\n\n        # Define the inner bracket functions. These capture params and delta.\n        def K_gh(z_vec):\n            return bracket(g_func, h_func, z_vec, params, delta)\n\n        def K_hf(z_vec):\n            return bracket(h_func, f_func, z_vec, params, delta)\n\n        def K_fg(z_vec):\n            return bracket(f_func, g_func, z_vec, params, delta)\n\n        # Compute the three terms of the Jacobiator at the specific point z\n        term1 = bracket(f_func, K_gh, z, params, delta)\n        term2 = bracket(g_func, K_hf, z, params, delta)\n        term3 = bracket(h_func, K_fg, z, params, delta)\n        \n        residual = abs(term1 + term2 + term3)\n        results.append(residual)\n\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}