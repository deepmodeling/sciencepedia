{
    "hands_on_practices": [
        {
            "introduction": "The first step in analyzing a constrained mechanical system is to understand the nature of the constraints themselves. A crucial distinction exists between holonomic (integrable) and nonholonomic (non-integrable) constraints, as they lead to fundamentally different dynamics. This exercise guides you through the derivation of the Frobenius integrability condition, a powerful geometric test that uses the language of differential forms to determine if a set of velocity constraints can be integrated to position-level constraints . Mastering this test is essential for correctly classifying a system and choosing the appropriate analytical framework.",
            "id": "3734932",
            "problem": "Consider a mechanical system whose configuration manifold is $Q$ and whose Pfaffian velocity constraints are specified by $m$ independent one-forms $\\omega^{\\alpha}$ on $Q$, with $\\alpha=1,\\dots,m$, so that admissible velocities satisfy $\\omega^{\\alpha}(q)\\cdot \\dot{q}=0$ for all $\\alpha$. Let $\\mathcal{D}\\subset TQ$ denote the constraint distribution defined by $\\mathcal{D}(q)=\\{v\\in T_{q}Q\\mid \\omega^{\\alpha}(q)(v)=0\\ \\text{for all}\\ \\alpha\\}$. Using only fundamental definitions of the exterior derivative, wedge product, Lie bracket of vector fields, and the Frobenius theorem characterization of integrability (involutivity) of distributions, derive a necessary and sufficient integrability condition for $\\mathcal{D}$ expressed entirely in terms of the exterior derivatives $d\\omega^{\\alpha}$ and the differential ideal generated by the one-forms $\\omega^{\\alpha}$. Then, specialize your derivation to the single-constraint case $m=1$ and obtain the corresponding Pfaffian integrability criterion in terms of a wedge product involving $\\omega^{1}$ and $d\\omega^{1}$.\n\nFinally, on $Q=\\mathbb{R}^{2}$ with global coordinates $(x,y)$, let the single constraint one-form be $\\omega^{1}=dy-x\\,dx$. Compute the wedge product $\\omega^{1}\\wedge d\\omega^{1}$ explicitly. Your final answer must be the exact value of this wedge product, expressed as a single closed-form analytic expression with no units and no rounding.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n-   Configuration manifold: $Q$.\n-   Constraints: A set of $m$ independent Pfaffian velocity constraints specified by one-forms $\\omega^{\\alpha}$ on $Q$, for $\\alpha=1,\\dots,m$.\n-   Constraint condition: Admissible velocities $\\dot{q}$ satisfy $\\omega^{\\alpha}(q)\\cdot \\dot{q}=0$ for all $\\alpha$.\n-   Constraint distribution: $\\mathcal{D}\\subset TQ$ defined by $\\mathcal{D}(q)=\\{v\\in T_{q}Q\\mid \\omega^{\\alpha}(q)(v)=0\\ \\text{for all}\\ \\alpha\\}$.\n-   Task 1: Derive the necessary and sufficient integrability condition for $\\mathcal{D}$ in terms of the exterior derivatives $d\\omega^{\\alpha}$ and the differential ideal generated by $\\{\\omega^{\\alpha}\\}$.\n-   Task 2: Specialize the derivation to the single-constraint case $m=1$ to obtain the Pfaffian integrability criterion.\n-   Task 3: For $Q=\\mathbb{R}^{2}$ with coordinates $(x,y)$ and $\\omega^{1}=dy-x\\,dx$, compute the wedge product $\\omega^{1}\\wedge d\\omega^{1}$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is set in the context of geometric mechanics, specifically dealing with Pfaffian constraints and their integrability. This is a standard and fundamental topic in Lagrangian and Hamiltonian mechanics. The concepts used (manifolds, one-forms, exterior derivative, Lie brackets, Frobenius theorem) are all central to differential geometry and its application to physics. The problem is scientifically and mathematically sound.\n-   **Well-Posed**: The problem is clearly stated. It asks for a standard derivation followed by a specific calculation. The given information is sufficient and unambiguous. A unique, meaningful solution exists.\n-   **Objective**: The language is precise, formal, and free from any subjectivity or opinion.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. It is a well-posed, scientifically grounded problem from the field of geometric mechanics. The solution process may proceed.\n\nWe begin by deriving the general integrability condition. The Frobenius theorem states that a smooth distribution $\\mathcal{D}$ on a manifold $Q$ is integrable if and only if it is involutive. A distribution $\\mathcal{D}$ is involutive if, for any two vector fields $X$ and $Y$ that take values in $\\mathcal{D}$ (i.e., $X(q) \\in \\mathcal{D}(q)$ and $Y(q) \\in \\mathcal{D}(q)$ for all $q \\in Q$), their Lie bracket $[X, Y]$ also takes values in $\\mathcal{D}$.\n\nThe constraint distribution $\\mathcal{D}$ is defined as the set of vectors that are annihilated by all the constraint one-forms $\\omega^{\\alpha}$. Thus, a vector field $X$ is in $\\mathcal{D}$ if and only if $\\omega^{\\alpha}(X) = 0$ for all $\\alpha = 1, \\dots, m$. The involutivity condition, which is equivalent to integrability, therefore requires that for any two vector fields $X, Y$ satisfying $\\omega^{\\alpha}(X)=0$ and $\\omega^{\\alpha}(Y)=0$ for all $\\alpha$, their Lie bracket must also satisfy $\\omega^{\\alpha}([X, Y]) = 0$ for all $\\alpha$.\n\nTo relate this condition to the exterior derivatives of the constraint forms, we use Cartan's formula for the exterior derivative of a one-form $\\omega$ acting on two vector fields $X, Y$:\n$$d\\omega(X, Y) = X(\\omega(Y)) - Y(\\omega(X)) - \\omega([X, Y])$$\nApplying this formula to each constraint form $\\omega^{\\alpha}$ and vector fields $X, Y$ from the distribution $\\mathcal{D}$, we have:\n$$d\\omega^{\\alpha}(X, Y) = X(\\omega^{\\alpha}(Y)) - Y(\\omega^{\\alpha}(X)) - \\omega^{\\alpha}([X, Y])$$\nSince $X$ and $Y$ are in $\\mathcal{D}$, we have $\\omega^{\\alpha}(X) = 0$ and $\\omega^{\\alpha}(Y) = 0$ for all $\\alpha$. These are scalar functions on $Q$ which are identically zero. The directional derivatives of the zero function are also zero, so $X(\\omega^{\\alpha}(Y)) = X(0) = 0$ and $Y(\\omega^{\\alpha}(X)) = Y(0) = 0$.\nCartan's formula thus simplifies to:\n$$d\\omega^{\\alpha}(X, Y) = - \\omega^{\\alpha}([X, Y])$$\nThe involutivity condition $\\omega^{\\alpha}([X, Y]) = 0$ is therefore equivalent to the condition $d\\omega^{\\alpha}(X, Y) = 0$ for all vector fields $X, Y$ in the distribution $\\mathcal{D}$. This means that each two-form $d\\omega^{\\alpha}$ must vanish when restricted to the distribution $\\mathcal{D}$.\n\nA fundamental result in the theory of differential forms states that a $k$-form vanishes on a distribution $\\mathcal{D}$ defined by the annihilating one-forms $\\{\\omega^{\\alpha}\\}$ if and only if that $k$-form belongs to the differential ideal $\\mathcal{I}$ generated by $\\{\\omega^{\\alpha}\\}$. For the two-forms $d\\omega^{\\alpha}$, this means that for each $\\alpha \\in \\{1, \\dots, m\\}$, $d\\omega^{\\alpha}$ must be expressible as a linear combination of the $\\omega^{\\beta}$ with one-form coefficients. That is, there must exist one-forms $\\eta^{\\alpha}_{\\beta}$ such that:\n$$d\\omega^{\\alpha} = \\sum_{\\beta=1}^{m} \\eta^{\\alpha}_{\\beta} \\wedge \\omega^{\\beta}$$\nThis is the necessary and sufficient condition for the integrability of the distribution $\\mathcal{D}$, expressed in terms of the exterior derivatives and the ideal generated by the constraint forms.\n\nNext, we specialize this result to the case of a single constraint, $m=1$. The set of constraint forms consists of a single one-form $\\omega^{1}$. The general integrability condition reduces to:\n$$d\\omega^{1} = \\eta \\wedge \\omega^{1}$$\nfor some one-form $\\eta$. This equation states that the two-form $d\\omega^{1}$ must be in the ideal generated by $\\omega^{1}$.\n\nTo derive the criterion involving the wedge product $\\omega^{1} \\wedge d\\omega^{1}$, we take the wedge product of the above integrability condition with $\\omega^{1}$:\n$$\\omega^{1} \\wedge d\\omega^{1} = \\omega^{1} \\wedge (\\eta \\wedge \\omega^{1})$$\nUsing the associativity of the wedge product, we have:\n$$\\omega^{1} \\wedge (\\eta \\wedge \\omega^{1}) = (\\omega^{1} \\wedge \\eta) \\wedge \\omega^{1}$$\nThe wedge product of one-forms is anticommutative, so $\\omega^{1} \\wedge \\eta = -(\\eta \\wedge \\omega^{1})$. Substituting this gives:\n$$-(\\eta \\wedge \\omega^{1}) \\wedge \\omega^{1} = -\\eta \\wedge (\\omega^{1} \\wedge \\omega^{1})$$\nThe wedge product of any differential form with itself is zero, so $\\omega^{1} \\wedge \\omega^{1} = 0$. Therefore, if the distribution is integrable, it is necessary that:\n$$\\omega^{1} \\wedge d\\omega^{1} = 0$$\nThis condition is also sufficient. If $\\omega^{1} \\wedge d\\omega^{1} = 0$ holds, then at any point where $\\omega^{1}$ is non-zero, we can choose a local basis of one-forms $\\{\\theta^{1}, \\dots, \\theta^{n}\\}$ such that $\\theta^{1} = \\omega^{1}$. The two-form $d\\omega^{1}$ can be written as $d\\omega^{1} = \\sum_{1 < j} c_{1j} \\theta^{1} \\wedge \\theta^{j} + \\sum_{1 < i < j} c_{ij} \\theta^{i} \\wedge \\theta^{j}$. The condition $\\omega^{1} \\wedge d\\omega^{1} = \\theta^{1} \\wedge d\\omega^{1} = 0$ implies that all coefficients $c_{ij}$ for $i, j > 1$ must be zero, leaving $d\\omega^{1} = \\sum_{1 < j} c_{1j} \\theta^{1} \\wedge \\theta^{j} = \\theta^{1} \\wedge (\\sum_{1 < j} c_{1j} \\theta^{j})$. This is of the form $\\omega^{1} \\wedge (-\\eta)$, which is equivalent to $\\eta' \\wedge \\omega^{1}$. Hence, the condition $\\omega^{1} \\wedge d\\omega^{1} = 0$ is a necessary and sufficient criterion for the integrability of a single Pfaffian constraint.\n\nFinally, we apply this to the specific case on $Q=\\mathbb{R}^{2}$ with coordinates $(x,y)$ and the constraint form $\\omega^{1} = dy - x\\,dx$. First, we must compute the exterior derivative, $d\\omega^{1}$.\n$$d\\omega^{1} = d(dy - x\\,dx) = d(dy) - d(x\\,dx)$$\nThe exterior derivative of an exact form is zero, so $d(dy) = d(d(y)) = 0$. For the second term, we use the product rule for exterior derivatives ($d(\\alpha \\wedge \\beta) = d\\alpha \\wedge \\beta + (-1)^{p} \\alpha \\wedge d\\beta$, where $\\alpha$ is a $p$-form). Here $x$ is a 0-form and $dx$ is a 1-form.\n$$d(x\\,dx) = d(x) \\wedge dx + x \\wedge d(dx)$$\nWe have $d(x) = dx$ and $d(dx)=d(d(x))=0$. So,\n$$d(x\\,dx) = dx \\wedge dx = 0$$\nThus, the exterior derivative of the constraint form is:\n$$d\\omega^{1} = 0 - 0 = 0$$\nAlternatively, for a one-form $\\omega = P(x,y)dx + Q(x,y)dy$ in $\\mathbb{R}^{2}$, its exterior derivative is $d\\omega = (\\frac{\\partial Q}{\\partial x} - \\frac{\\partial P}{\\partial y})dx \\wedge dy$. For $\\omega^{1} = (-x)dx + (1)dy$, we have $P(x,y) = -x$ and $Q(x,y) = 1$. The partial derivatives are $\\frac{\\partial Q}{\\partial x} = 0$ and $\\frac{\\partial P}{\\partial y} = 0$.\nThis gives $d\\omega^{1} = (0 - 0)dx \\wedge dy = 0$.\n\nNow, we compute the required wedge product:\n$$\\omega^{1} \\wedge d\\omega^{1} = (dy - x\\,dx) \\wedge 0$$\nThe wedge product of any form with the zero form is zero.\n$$\\omega^{1} \\wedge d\\omega^{1} = 0$$\nThe Pfaffian integrability condition is satisfied, which is consistent with the fact that the constraint $\\omega^{1}=0$, corresponding to the ordinary differential equation $\\frac{dy}{dx} = x$, can be integrated to yield $y = \\frac{1}{2}x^{2} + C$.\nThe value of the expression $\\omega^{1}\\wedge d\\omega^{1}$ is $0$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Once a system is determined to have nonholonomic constraints, the next step is to derive the equations of motion. The Lagrange-d'Alembert principle provides the foundation for this, stating that constraint forces do no virtual work. This practice challenges you to apply this principle to a canonical nonholonomic system, deriving not only the explicit equations of motion but also the geometric projection operator onto the allowable velocity space . This is a core calculation that connects the abstract geometry of constraint distributions directly to the observable dynamics of the system.",
            "id": "3734953",
            "problem": "Consider a mechanical system whose configuration space is $Q=\\mathbb{R}^{2}$ with coordinates $(x,y)$, endowed with the Euclidean kinetic-energy metric defined by the identity mass matrix $M=I$ and with zero potential energy $V=0$. The system is subject to a single nonholonomic velocity constraint given by the Pfaffian one-form $\\omega(q)\\cdot \\dot{q}=0$ where $\\omega(q)=\\mathrm{d}y-x\\,\\mathrm{d}x$, equivalently,\n$$\n\\dot{y}-x\\,\\dot{x}=0.\n$$\nLet $\\mathcal{D}(q)=\\ker \\omega(q)\\subset T_{q}Q$ denote the constraint distribution. An external force $F(q,\\dot{q},t)\\in T_{q}^{*}Q\\simeq \\mathbb{R}^{2}$ acts on the system. Starting from first principles of the Lagrange-d'Alembert variational principle for nonholonomic systems and Newton's second law in generalized coordinates, derive the orthogonal projection $P_{\\mathcal{D}}(q)$ onto $\\mathcal{D}(q)$ with respect to the kinetic-energy inner product, and obtain the explicit constrained equations of motion for the acceleration $(\\ddot{x},\\ddot{y})$ under the external force $F=(F_{x},F_{y})$.\n\nYour final answer must be a single analytical expression consisting of a row vector with six entries in the following order:\n$$\n\\big(P_{11}(q),\\,P_{12}(q),\\,P_{21}(q),\\,P_{22}(q),\\,\\ddot{x},\\,\\ddot{y}\\big),\n$$\nwhere $P_{ij}(q)$ are the components of the matrix $P_{\\mathcal{D}}(q)$. No numerical approximation is required.",
            "solution": "The user wants me to solve this problem.\nI will first perform the validation of the problem statement.\n\n### Step 1: Extract Givens\n- Configuration space: $Q=\\mathbb{R}^{2}$ with coordinates $(x,y)$.\n- Kinetic-energy metric: Defined by the identity mass matrix $M=I$.\n- Potential energy: $V=0$.\n- Nonholonomic velocity constraint: $\\omega(q)\\cdot \\dot{q}=0$ where $\\omega(q)=\\mathrm{d}y-x\\,\\mathrm{d}x$.\n- Equivalent constraint equation: $\\dot{y}-x\\,\\dot{x}=0$.\n- Constraint distribution: $\\mathcal{D}(q)=\\ker \\omega(q)\\subset T_{q}Q$.\n- External force: $F(q,\\dot{q},t)\\in T_{q}^{*}Q\\simeq \\mathbb{R}^{2}$ with components $F=(F_{x},F_{y})$.\n- Task: Derive the orthogonal projection $P_{\\mathcal{D}}(q)$ and the constrained equations of motion for $(\\ddot{x},\\ddot{y})$.\n- Required output format: A row vector $(P_{11}(q),\\,P_{12}(q),\\,P_{21}(q),\\,P_{22}(q),\\,\\ddot{x},\\,\\ddot{y})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined within the standard framework of geometric mechanics and nonholonomic dynamics.\n- **Scientifically Grounded**: The problem uses standard concepts such as configuration space, kinetic-energy metric, Pfaffian constraints, and the Lagrange-d'Alembert principle. The given constraint is a classic example of a nonholonomic system (the \"rolling coin\" without slipping is related, but this is a simplified version often called the \"nonholonomic particle\"). The problem is mathematically and physically sound.\n- **Well-Posed**: The problem is specified with all necessary information. The configuration space, metric, constraint, and forces are clearly defined. The task is to derive specific, uniquely determinable mathematical objects (a projection matrix and equations of motion).\n- **Objective**: The language is precise, formal, and objective, using standard terminology from differential geometry and mechanics. There is no ambiguity or subjective content.\n- **Completeness and Consistency**: The problem is self-contained. The provided data are consistent and sufficient for a full derivation.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed with a full derivation.\n\n### Derivation\n\nThe system is described by the coordinates $q=(x,y) \\in \\mathbb{R}^2$. The Lagrangian is given by the kinetic energy $T$ minus the potential energy $V$. With the mass matrix $M=I$ and potential energy $V=0$, the Lagrangian is:\n$$\nL(q, \\dot{q}) = T = \\frac{1}{2} \\dot{q}^T M \\dot{q} = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2)\n$$\nThe system is subject to the nonholonomic constraint $\\dot{y} - x\\dot{x} = 0$. This constraint can be written as $a(q) \\cdot \\dot{q} = 0$, where $a(q) = (-x, 1)$ is a row vector representing the constraint one-form $\\omega = -x\\,\\mathrm{d}x + \\mathrm{d}y$, and $\\dot{q} = (\\dot{x}, \\dot{y})^T$.\n\nThe constraint distribution $\\mathcal{D}(q)$ is the set of admissible velocities at configuration $q$:\n$$\n\\mathcal{D}(q) = \\{ v \\in T_q Q \\mid \\dot{y} - x\\dot{x} = 0 \\}\n$$\nThis is a one-dimensional subspace of the tangent space $T_q Q \\cong \\mathbb{R}^2$.\n\n**Part 1: Derivation of the Orthogonal Projection $P_{\\mathcal{D}}(q)$**\n\nThe projection is orthogonal with respect to the kinetic-energy inner product, which is given by the mass matrix $M=I$. For two vectors $u,v \\in T_q Q$, the inner product is $\\langle u,v \\rangle_M = u^T M v = u^T v$, the standard Euclidean inner product.\n\nThe orthogonal complement of the constraint distribution, $\\mathcal{D}^{\\perp}(q)$, is spanned by a vector normal to $\\mathcal{D}(q)$. The constraint equation $a(q)\\cdot\\dot{q}=0$ can be written as $\\langle n(q), \\dot{q} \\rangle_M = 0$, where $n(q) = M^{-1} a(q)^T$. Since $M=I$, the normal vector is simply $n(q) = a(q)^T = (-x, 1)^T$.\n$$\nn(q) = \\begin{pmatrix} -x \\\\ 1 \\end{pmatrix}\n$$\nThe projection operator onto the orthogonal complement $\\mathcal{D}^{\\perp}(q)$ is given by the formula:\n$$\nP_{\\mathcal{D}^{\\perp}}(q) = \\frac{n(q) n(q)^T M}{n(q)^T M n(q)}\n$$\nWith $M=I$, this simplifies to:\n$$\nP_{\\mathcal{D}^{\\perp}}(q) = \\frac{n(q) n(q)^T}{n(q)^T n(q)}\n$$\nWe calculate the components:\n$$\nn(q) n(q)^T = \\begin{pmatrix} -x \\\\ 1 \\end{pmatrix} \\begin{pmatrix} -x & 1 \\end{pmatrix} = \\begin{pmatrix} x^2 & -x \\\\ -x & 1 \\end{pmatrix}\n$$\n$$\nn(q)^T n(q) = \\begin{pmatrix} -x & 1 \\end{pmatrix} \\begin{pmatrix} -x \\\\ 1 \\end{pmatrix} = x^2 + 1\n$$\nThus, the projector onto the orthogonal complement is:\n$$\nP_{\\mathcal{D}^{\\perp}}(q) = \\frac{1}{x^2+1} \\begin{pmatrix} x^2 & -x \\\\ -x & 1 \\end{pmatrix}\n$$\nThe projection operator onto the constraint distribution $\\mathcal{D}(q)$ is $P_{\\mathcal{D}}(q) = I - P_{\\mathcal{D}^{\\perp}}(q)$, where $I$ is the $2 \\times 2$ identity matrix.\n$$\nP_{\\mathcal{D}}(q) = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} - \\frac{1}{x^2+1} \\begin{pmatrix} x^2 & -x \\\\ -x & 1 \\end{pmatrix} = \\frac{1}{x^2+1} \\left[ \\begin{pmatrix} x^2+1 & 0 \\\\ 0 & x^2+1 \\end{pmatrix} - \\begin{pmatrix} x^2 & -x \\\\ -x & 1 \\end{pmatrix} \\right]\n$$\n$$\nP_{\\mathcal{D}}(q) = \\frac{1}{x^2+1} \\begin{pmatrix} 1 & x \\\\ x & x^2 \\end{pmatrix}\n$$\nThe components of this projection matrix are:\n$P_{11}(q) = \\frac{1}{x^2+1}$, $P_{12}(q) = \\frac{x}{x^2+1}$, $P_{21}(q) = \\frac{x}{x^2+1}$, $P_{22}(q) = \\frac{x^2}{x^2+1}$.\n\n**Part 2: Derivation of the Constrained Equations of Motion**\n\nAccording to the Lagrange-d'Alembert principle, the equations of motion for a nonholonomic system with external forces $F$ are given by the Euler-Lagrange equations modified by a constraint force $F_c$:\n$$\nM \\ddot{q} = F_{EL} + F + F_c\n$$\nwhere $F_{EL} = \\frac{\\partial L}{\\partial q} - \\frac{d}{dt}\\frac{\\partial L}{\\partial \\dot{q}}$. For our Lagrangian $L = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2)$, the Euler-Lagrange term is $(\\frac{\\partial L}{\\partial q} - \\frac{d}{dt}\\frac{\\partial L}{\\partial \\dot{q}})^T = (0 - \\ddot{x}, 0 - \\ddot{y})^T = -M\\ddot{q}$. The equation becomes:\n$$\nM\\ddot{q} = F + F_c\n$$\nThe constraint force $F_c$ is orthogonal to the constraint distribution $\\mathcal{D}(q)$, so it must be parallel to the normal vector $n(q)$. We can write it as $F_c = \\lambda n(q)$ for some Lagrange multiplier $\\lambda$.\n$$\n\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} \\ddot{x} \\\\ \\ddot{y} \\end{pmatrix} = \\begin{pmatrix} F_x \\\\ F_y \\end{pmatrix} + \\lambda \\begin{pmatrix} -x \\\\ 1 \\end{pmatrix}\n$$\nThis gives the component equations:\n$$\n\\ddot{x} = F_x - \\lambda x\n$$\n$$\n\\ddot{y} = F_y + \\lambda\n$$\nTo determine the multiplier $\\lambda$, we enforce the condition that the acceleration must be compatible with the constraint. We differentiate the velocity constraint $\\dot{y} - x\\dot{x} = 0$ with respect to time:\n$$\n\\frac{d}{dt} (\\dot{y} - x\\dot{x}) = 0 \\implies \\ddot{y} - \\dot{x}\\dot{x} - x\\ddot{x} = 0 \\implies \\ddot{y} - x\\ddot{x} = \\dot{x}^2\n$$\nThis is the acceleration-level constraint. Substituting the expressions for $\\ddot{x}$ and $\\ddot{y}$:\n$$\n(F_y + \\lambda) - x(F_x - \\lambda x) = \\dot{x}^2\n$$\n$$\nF_y + \\lambda - xF_x + \\lambda x^2 = \\dot{x}^2\n$$\nNow, we solve for $\\lambda$:\n$$\n\\lambda(1 + x^2) = \\dot{x}^2 + xF_x - F_y\n$$\n$$\n\\lambda = \\frac{\\dot{x}^2 + xF_x - F_y}{1+x^2}\n$$\nFinally, we substitute this expression for $\\lambda$ back into the equations for $\\ddot{x}$ and $\\ddot{y}$:\nFor $\\ddot{x}$:\n$$\n\\ddot{x} = F_x - x \\left( \\frac{\\dot{x}^2 + xF_x - F_y}{1+x^2} \\right) = \\frac{F_x(1+x^2) - x(\\dot{x}^2 + xF_x - F_y)}{1+x^2}\n$$\n$$\n\\ddot{x} = \\frac{F_x + x^2F_x - x\\dot{x}^2 - x^2F_x + xF_y}{1+x^2} = \\frac{F_x - x\\dot{x}^2 + xF_y}{1+x^2}\n$$\nFor $\\ddot{y}$:\n$$\n\\ddot{y} = F_y + \\frac{\\dot{x}^2 + xF_x - F_y}{1+x^2} = \\frac{F_y(1+x^2) + \\dot{x}^2 + xF_x - F_y}{1+x^2}\n$$\n$$\n\\ddot{y} = \\frac{F_y + x^2F_y + \\dot{x}^2 + xF_x - F_y}{1+x^2} = \\frac{x^2F_y + xF_x + \\dot{x}^2}{1+x^2}\n$$\n\nThe final results are:\n$P_{11}(q) = \\frac{1}{1+x^2}$\n$P_{12}(q) = \\frac{x}{1+x^2}$\n$P_{21}(q) = \\frac{x}{1+x^2}$\n$P_{22}(q) = \\frac{x^2}{1+x^2}$\n$\\ddot{x} = \\frac{F_x + xF_y - x\\dot{x}^2}{1+x^2}$\n$\\ddot{y} = \\frac{xF_x + x^2F_y + \\dot{x}^2}{1+x^2}$\n\nThese six expressions constitute the final answer.\nIt is useful to rewrite the acceleration terms to make the structure more apparent:\n$\\ddot{y} = \\frac{x(xF_y + F_x) + \\dot{x}^2}{1+x^2} = x \\frac{F_x + xF_y}{1+x^2} + \\frac{\\dot{x}^2}{1+x^2} = x \\left(\\frac{F_x + xF_y - x\\dot{x}^2}{1+x^2}\\right) + \\frac{x^2\\dot{x}^2}{1+x^2} + \\frac{\\dot{x}^2}{1+x^2} = x\\ddot{x} + \\dot{x}^2$. This confirms consistency with the differentiated constraint. The formulation is correct.\nThe expression for $\\ddot{y}$ can also be written as:\n$\\ddot{y} = \\frac{x(F_x+xF_y) + \\dot{x}^2}{1+x^2}$.\nMy calculation was $\\frac{x^2F_y + xF_x + \\dot{x}^2}{1+x^2}$ which is the same.\nThe expression for $\\ddot{x}$ was $\\frac{F_x + xF_y - x\\dot{x}^2}{1+x^2}$.\nThe results are consistent and derived from first principles as required.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{1+x^{2}} & \\frac{x}{1+x^{2}} & \\frac{x}{1+x^{2}} & \\frac{x^{2}}{1+x^{2}} & \\frac{F_{x} + x F_{y} - x \\dot{x}^{2}}{1+x^{2}} & \\frac{x F_{x} + x^{2} F_{y} + \\dot{x}^{2}}{1+x^{2}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Bridging the gap between analytical theory and practical application is a vital skill in mechanics. While textbook examples often feature simple, constant mass matrices, realistic systems involve complex, position-dependent metrics and intricate constraint structures. This exercise transitions from pen-and-paper derivation to computational implementation, asking you to write a numerical procedure to compute the orthogonal projection operators for a system with a non-trivial metric . By testing your code in generic, degenerate, and near-degenerate cases, you will develop a deeper understanding of the robustness required for computational dynamics algorithms.",
            "id": "3734905",
            "problem": "Consider a configuration space with local coordinates $q \\in \\mathbb{R}^3$, and a kinetic energy metric defined by a smooth, symmetric positive-definite mass matrix $M(q) \\in \\mathbb{R}^{3 \\times 3}$. Let a set of Pfaffian nonholonomic constraints be given by a smooth matrix $A(q) \\in \\mathbb{R}^{2 \\times 3}$, so that admissible velocities $v \\in \\mathbb{R}^3$ satisfy $A(q)\\,v = 0$. The constraint distribution is $\\mathcal{D}(q) = \\ker A(q) \\subset \\mathbb{R}^3$, and its $M(q)$-orthogonal complement is the subspace $\\mathcal{D}(q)^{\\perp_M} = \\{w \\in \\mathbb{R}^3 \\mid u^\\top M(q)\\,w = 0 \\text{ for all } u \\in \\mathcal{D}(q)\\}$. The $M(q)$-inner product is defined by $\\langle u, v \\rangle_{M(q)} = u^\\top M(q)\\,v$.\n\nStarting from fundamental definitions and principles of geometric mechanics and linear algebra, derive the expressions for the $M(q)$-orthogonal projectors $P_{\\mathcal{D}}(q) \\in \\mathbb{R}^{3 \\times 3}$ onto $\\mathcal{D}(q)$ and $P_{\\perp}(q) \\in \\mathbb{R}^{3 \\times 3}$ onto $\\mathcal{D}(q)^{\\perp_M}$, and then implement a numerical procedure to evaluate these projectors at specific coordinate values. Your derivation must be principled and should not assume any pre-quoted projector formula without justification. In particular, you must formulate the projection as an optimization or variational principle consistent with the $M(q)$-inner product and solve it using standard linear algebra.\n\nFor this problem, use the following smooth, scientifically consistent definitions:\n- Define $S(q) \\in \\mathbb{R}^{3 \\times 3}$ by\n$$\nS(q) = \\begin{bmatrix}\n1 + q_1^2 & \\sin(q_2) & 0.1 \\\\\n0 & 2 + \\cos(q_2) & q_1 q_3 \\\\\n0 & 0 & 1 + q_3^2\n\\end{bmatrix},\n$$\nand set\n$$\nM(q) = S(q)^\\top S(q).\n$$\nThis guarantees that $M(q)$ is symmetric positive-definite for all $q \\in \\mathbb{R}^3$.\n\n- Define the constraint matrix $A(q) \\in \\mathbb{R}^{2 \\times 3}$ by\n$$\ng(q) = q_1 q_2, \\quad\nA(q) = g(q)\n\\begin{bmatrix}\n1 & q_1 + q_2 & \\sin(q_3) \\\\\nq_2 - q_3 & 1 & \\cos(q_1)\n\\end{bmatrix}.\n$$\nNote that $A(q)$ can lose rank when $g(q) = 0$, which represents a boundary case when the constraints lose independence.\n\nAngles appearing in $\\sin(\\cdot)$ and $\\cos(\\cdot)$ must be interpreted in radians. All quantities are dimensionless.\n\nYour program must, for each specified test case $q$, compute $P_{\\mathcal{D}}(q)$ and $P_{\\perp}(q)$ numerically using only the given $M(q)$ and $A(q)$, and verify the following properties with respect to the metric $M(q)$:\n1. Idempotence of projectors: $P_{\\mathcal{D}}(q)^2 = P_{\\mathcal{D}}(q)$ and $P_{\\perp}(q)^2 = P_{\\perp}(q)$.\n2. $M(q)$-orthogonality of the images: $P_{\\mathcal{D}}(q)^\\top M(q) P_{\\perp}(q) = 0$.\n\nAll matrix equalities must be verified numerically within a tolerance of $\\varepsilon = 10^{-9}$ using the Frobenius norm. That is, check whether $\\|P_{\\mathcal{D}}^2 - P_{\\mathcal{D}}\\|_F \\le \\varepsilon$, $\\|P_{\\perp}^2 - P_{\\perp}\\|_F \\le \\varepsilon$, and $\\|P_{\\mathcal{D}}^\\top M P_{\\perp}\\|_F \\le \\varepsilon$.\n\nTest suite (angles in radians):\n- Case $1$: $q = [0.5, -0.3, 1.2]$ (generic case with independent constraints).\n- Case $2$: $q = [0.0, 1.0, 0.5]$ (boundary case where $g(q) = 0$ and constraints vanish).\n- Case $3$: $q = [10^{-6}, 10^{-6}, -0.2]$ (near-degenerate case with very small $g(q)$ to assess numerical stability).\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a boolean that is $\\texttt{True}$ if all three verifications pass within the tolerance $\\varepsilon$, and $\\texttt{False}$ otherwise. The final output must be of the form $\\,[\\texttt{b1},\\texttt{b2},\\texttt{b3}]\\,\\,$ corresponding to the three cases in the given order.",
            "solution": "The problem requires the derivation and implementation of projection operators onto a constraint distribution and its metric-orthogonal complement. The derivation must originate from a first-principles variational formulation.\n\nLet the configuration space be locally represented by coordinates $q \\in \\mathbb{R}^3$. The kinetic energy is defined by a symmetric positive-definite mass matrix $M(q) \\in \\mathbb{R}^{3 \\times 3}$, which induces an inner product on the tangent space $T_q\\mathbb{R}^3 \\cong \\mathbb{R}^3$ given by $\\langle u, v \\rangle_{M(q)} = u^\\top M(q) v$. The associated norm is $\\|v\\|_{M(q)} = \\sqrt{v^\\top M(q) v}$.\n\nThe Pfaffian constraints are given by $A(q)v = 0$, where $v$ is a velocity vector and $A(q) \\in \\mathbb{R}^{2 \\times 3}$ is a smooth matrix. The set of all admissible velocities at $q$ forms the constraint distribution $\\mathcal{D}(q) = \\ker A(q)$, which is a linear subspace of $\\mathbb{R}^3$. The $M(q)$-orthogonal complement to this subspace is $\\mathcal{D}(q)^{\\perp_M} = \\{w \\in \\mathbb{R}^3 \\mid u^\\top M(q) w = 0 \\text{ for all } u \\in \\mathcal{D}(q)\\}$.\n\nAny vector $v \\in \\mathbb{R}^3$ can be uniquely decomposed as $v = v_{\\mathcal{D}} + v_{\\perp}$, where $v_{\\mathcal{D}} \\in \\mathcal{D}(q)$ and $v_{\\perp} \\in \\mathcal{D}(q)^{\\perp_M}$. The operators that perform this decomposition are the orthogonal projectors $P_{\\mathcal{D}}(q)$ and $P_{\\perp}(q)$, such that $v_{\\mathcal{D}} = P_{\\mathcal{D}}(q)v$ and $v_{\\perp} = P_{\\perp}(q)v$.\n\nTo derive the projector $P_{\\mathcal{D}}(q)$, we use a variational principle. The projection $v_{\\mathcal{D}}$ of a vector $v$ onto the subspace $\\mathcal{D}(q)$ is the unique vector in $\\mathcal{D}(q)$ that is closest to $v$ with respect to the distance induced by the $M(q)$-norm. This is equivalent to solving the following constrained optimization problem:\n$$\n\\min_{u \\in \\mathbb{R}^3} \\frac{1}{2} \\|v - u\\|_{M(q)}^2 \\quad \\text{subject to} \\quad A(q)u = 0\n$$\nThe Lagrangian for this problem is:\n$$\n\\mathcal{L}(u, \\lambda) = \\frac{1}{2} (v - u)^\\top M(q) (v - u) + \\lambda^\\top A(q) u\n$$\nwhere $\\lambda \\in \\mathbb{R}^2$ is a vector of Lagrange multipliers. The optimality conditions are found by setting the partial derivatives of $\\mathcal{L}$ with respect to $u$ and $\\lambda$ to zero.\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial u} = -M(q)(v - u) + A(q)^\\top \\lambda = 0\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = A(q) u = 0\n$$\nFrom the first equation, we solve for the optimal vector $u^*$, which is the desired projection $v_{\\mathcal{D}}$:\n$$\nM(q)(v - u^*) = A(q)^\\top \\lambda \\implies v - u^* = M(q)^{-1} A(q)^\\top \\lambda\n$$\n$$\nu^* = v - M(q)^{-1} A(q)^\\top \\lambda\n$$\nTo find $\\lambda$, we substitute this expression for $u^*$ into the constraint equation $A(q)u^*=0$:\n$$\nA(q) (v - M(q)^{-1} A(q)^\\top \\lambda) = 0\n$$\n$$\nA(q)v - A(q) M(q)^{-1} A(q)^\\top \\lambda = 0\n$$\nLet's define the Gram-like matrix $G(q) = A(q) M(q)^{-1} A(q)^\\top$. This is a $2 \\times 2$ matrix. The equation becomes:\n$$\nG(q) \\lambda = A(q)v\n$$\nIf $G(q)$ is invertible (which is true if $A(q)$ has full row rank), we can solve for $\\lambda$:\n$$\n\\lambda = G(q)^{-1} A(q)v = (A(q) M(q)^{-1} A(q)^\\top)^{-1} A(q)v\n$$\nSubstituting this back into the expression for $u^*$:\n$$\nu^* = v - M(q)^{-1} A(q)^\\top (A(q) M(q)^{-1} A(q)^\\top)^{-1} A(q)v\n$$\nSince $v_{\\mathcal{D}} = u^* = P_{\\mathcal{D}}(q)v$, we can identify the projection matrix $P_{\\mathcal{D}}(q)$ as:\n$$\nP_{\\mathcal{D}}(q) = I - M(q)^{-1} A(q)^\\top (A(q) M(q)^{-1} A(q)^\\top)^{-1} A(q)\n$$\nwhere $I$ is the $3 \\times 3$ identity matrix.\n\nThe projector onto the orthogonal complement, $P_{\\perp}(q)$, is given by the relation $P_{\\mathcal{D}}(q) + P_{\\perp}(q) = I$. Thus:\n$$\nP_{\\perp}(q) = I - P_{\\mathcal{D}}(q) = M(q)^{-1} A(q)^\\top (A(q) M(q)^{-1} A(q)^\\top)^{-1} A(q)\n$$\nThe derivation above assumes that the matrix $G(q) = A(q) M(q)^{-1} A(q)^\\top$ is invertible. This is guaranteed if and only if $A(q)$ has full row rank (rank $2$). In the problem, $A(q)$ is defined as $A(q) = g(q) A_{base}(q)$ where $g(q) = q_1 q_2$. If $g(q)=0$, then $A(q)$ becomes the zero matrix, which is rank-deficient. In this case, $\\mathcal{D}(q) = \\ker(0) = \\mathbb{R}^3$, so $P_{\\mathcal{D}}(q)$ should be the identity matrix $I$, and $\\mathcal{D}(q)^{\\perp_M} = \\{0\\}$, so $P_{\\perp}(q)$ should be the zero matrix. The derived formula for the projectors involves $G(q)^{-1}$, which is undefined if $G(q)$ is singular.\n\nTo handle both the non-degenerate and degenerate cases with a single, numerically robust formula, we replace the inverse $G(q)^{-1}$ with the Moore-Penrose pseudo-inverse, denoted by $G(q)^\\dagger$. The Moore-Penrose pseudo-inverse is a generalization of the matrix inverse that is defined for any matrix. If the matrix is invertible, its pseudo-inverse is equal to its inverse. If the matrix is a zero matrix, its pseudo-inverse is a zero matrix of the transposed shape.\n\nUsing the pseudo-inverse, the projector formulas become:\n$$\nP_{\\perp}(q) = M(q)^{-1} A(q)^\\top (A(q) M(q)^{-1} A(q)^\\top)^{\\dagger} A(q)\n$$\n$$\nP_{\\mathcal{D}}(q) = I - P_{\\perp}(q)\n$$\nIf $A(q) = 0$, then $G(q) = 0$, and $G(q)^\\dagger = 0$. This gives $P_{\\perp}(q) = 0$ and $P_{\\mathcal{D}}(q) = I$, which is the correct result for the degenerate case. This unified formula is suitable for numerical implementation across all test cases, including the generic, degenerate, and near-degenerate scenarios.\n\nThe numerical procedure will thus be:\n1. For a given $q$, construct the matrices $S(q)$, $M(q) = S(q)^\\top S(q)$, and $A(q)$.\n2. Compute $M(q)^{-1}$.\n3. Compute $G(q) = A(q) M(q)^{-1} A(q)^\\top$.\n4. Compute the Moore-Penrose pseudo-inverse $G(q)^\\dagger$.\n5. Compute $P_{\\perp}(q)$ and $P_{\\mathcal{D}}(q)$ using the derived formulas.\n6. Verify the properties $\\|P_{\\mathcal{D}}^2 - P_{\\mathcal{D}}\\|_F \\le \\varepsilon$, $\\|P_{\\perp}^2 - P_{\\perp}\\|_F \\le \\varepsilon$, and $\\|P_{\\mathcal{D}}^\\top M P_{\\perp}\\|_F \\le \\varepsilon$ for the specified tolerance $\\varepsilon = 10^{-9}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by deriving and verifying properties of M-orthogonal\n    projectors for given nonholonomic constraints.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        [0.5, -0.3, 1.2],   # Case 1: generic\n        [0.0, 1.0, 0.5],    # Case 2: degenerate (g(q)=0)\n        [1e-6, 1e-6, -0.2]  # Case 3: near-degenerate\n    ]\n\n    results = []\n    epsilon = 1e-9\n\n    for q_vals in test_cases:\n        q = np.array(q_vals)\n        q1, q2, q3 = q[0], q[1], q[2]\n\n        # 1. Construct matrices S(q), M(q), and A(q)\n        # Construct S(q)\n        S_q = np.array([\n            [1 + q1**2, np.sin(q2), 0.1],\n            [0, 2 + np.cos(q2), q1 * q3],\n            [0, 0, 1 + q3**2]\n        ])\n\n        # Construct M(q) = S(q)^T S(q)\n        # This construction guarantees M is symmetric positive-definite.\n        M_q = S_q.T @ S_q\n\n        # Construct A(q)\n        g_q = q1 * q2\n        A_base_q = np.array([\n            [1, q1 + q2, np.sin(q3)],\n            [q2 - q3, 1, np.cos(q1)]\n        ])\n        A_q = g_q * A_base_q\n\n        # 2. Compute the projectors using the derived formulas\n        # The M matrix is invertible because S is invertible (upper triangular\n        # with positive diagonal entries).\n        M_inv = np.linalg.inv(M_q)\n\n        # Compute G(q) = A(q) M(q)^-1 A(q)^T\n        G_q = A_q @ M_inv @ A_q.T\n\n        # Use the Moore-Penrose pseudo-inverse for numerical stability and to\n        # handle the rank-deficient case (when g(q)=0).\n        G_pinv = np.linalg.pinv(G_q)\n\n        # Projector onto the orthogonal complement D_orth\n        P_perp = M_inv @ A_q.T @ G_pinv @ A_q\n\n        # Projector onto the constraint distribution D\n        I = np.eye(3)\n        P_D = I - P_perp\n\n        # 3. Verify the required properties\n        # a) Idempotence of P_D: P_D^2 = P_D\n        idempotence_D_err = np.linalg.norm(P_D @ P_D - P_D, 'fro')\n        check1 = idempotence_D_err <= epsilon\n\n        # b) Idempotence of P_perp: P_perp^2 = P_perp\n        idempotence_perp_err = np.linalg.norm(P_perp @ P_perp - P_perp, 'fro')\n        check2 = idempotence_perp_err <= epsilon\n\n        # c) M-orthogonality of images: P_D^T M P_perp = 0\n        orthogonality_err = np.linalg.norm(P_D.T @ M_q @ P_perp, 'fro')\n        check3 = orthogonality_err <= epsilon\n\n        # The result for the case is True if all checks pass\n        case_result = check1 and check2 and check3\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # The map converts boolean True/False to string \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}