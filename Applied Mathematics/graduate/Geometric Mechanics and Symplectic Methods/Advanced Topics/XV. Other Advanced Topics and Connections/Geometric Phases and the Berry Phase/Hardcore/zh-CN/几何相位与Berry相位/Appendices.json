{
    "hands_on_practices": [
        {
            "introduction": "最简单的非平凡量子系统是两能级系统，电子自旋便是一个典型例子。本练习旨在探讨当一个自旋态绝热地跟随一个旋进的磁场时，它所获得的贝里相位。通过求解这个问题，您将遵循迈克尔·贝里的原始表述，将抽象的相位与由参数路径所张立体角的具体几何概念直接联系起来，从而对几何相位如何在基本量子系统中显现建立起一个坚实的理解 。",
            "id": "1990141",
            "problem": "一个电子被限制在一个量子器件中，并受到一个空间均匀的磁场 $\\vec{B}(t)$ 的作用，该磁场的大小 $B_0$ 为常数。该磁场的方向由单位矢量 $\\hat{n}(t) = \\vec{B}(t)/B_0$ 表示，在一个时间间隔 $T$ 内绝热地变化，从而描绘出一个闭合回路。电子最初被制备并保持在对应于瞬时磁场方向的较高能量自旋本征态上。\n\n矢量 $\\hat{n}(t)$ 的尖端在单位球面上描绘的路径是一个恒定纬度的圆，该纬度由相对于固定的z轴的极角 $\\theta_0$ 定义，此时方位角扫过一个完整的 $2\\pi$ 周期。在一个周期结束时，测得电子波函数累积的几何相位（也称为贝里相位）为 $\\gamma_g = -\\frac{3\\pi}{4}$。\n\n控制自旋动力学的哈密顿量由 $H(t) = \\frac{g_e \\mu_B}{\\hbar} \\vec{S} \\cdot \\vec{B}(t)$ 给出，其中 $\\vec{S}$ 是电子自旋算符，$\\mu_B$ 是玻尔磁子，$g_e$ 是电子g因子（一个约等于2的正数），$\\hbar$ 是约化普朗克常数。\n\n确定极角 $\\theta_0$ 的值。请用弧度表示的闭合解析表达式作答。",
            "solution": "哈密顿量为 $H(t) = \\frac{g_{e}\\mu_{B}}{\\hbar}\\,\\vec{S}\\cdot\\vec{B}(t)$，其中 $\\vec{B}(t)=B_{0}\\hat{n}(t)$。对于在绝热变化的磁场中的自旋-1/2粒子，绝热定理确保其状态保持在由相对于方向 $\\hat{n}(t)$ 的磁量子数 $m=\\pm \\frac{1}{2}$ 标记的瞬时本征态上。在一个闭合回路上累积的贝里相位由标准结果给出：\n$$\n\\gamma_{g}=-m\\,\\Omega,\n$$\n其中 $\\Omega$ 是单位球面上由 $\\hat{n}(t)$ 的闭合路径所张的有符号立体角。\n\n因为 $g_{e}>0$，较高能量的本征态对应于 $m=+\\frac{1}{2}$（自旋与 $\\vec{B}$ 平行），因为 $H$ 的本征值为 $E_{m}=g_{e}\\mu_{B}mB_{0}$。因此，对于实验中所跟踪的状态，\n$$\n\\gamma_{g}=-\\frac{1}{2}\\,\\Omega.\n$$\n路径是一个固定极角 $\\theta_{0}$ 的圆，其方位角扫过 $2\\pi$。这个纬度圈所包围的立体角是：\n$$\n\\Omega=2\\pi\\left(1-\\cos\\theta_{0}\\right),\n$$\n对于方位角从 $0$ 增加到 $2\\pi$ 的标准方向，其符号为正。测得的几何相位为 $\\gamma_{g}=-\\frac{3\\pi}{4}$，所以令等式成立，\n$$\n-\\frac{1}{2}\\,\\Omega=-\\frac{3\\pi}{4}\\quad\\Longrightarrow\\quad \\Omega=\\frac{3\\pi}{2}.\n$$\n代入 $\\Omega=2\\pi\\left(1-\\cos\\theta_{0}\\right)$ 可得：\n$$\n2\\pi\\left(1-\\cos\\theta_{0}\\right)=\\frac{3\\pi}{2}\n\\quad\\Longrightarrow\\quad\n1-\\cos\\theta_{0}=\\frac{3}{4}\n\\quad\\Longrightarrow\\quad\n\\cos\\theta_{0}=\\frac{1}{4}.\n$$\n因此，\n$$\n\\theta_{0}=\\arccos\\!\\left(\\frac{1}{4}\\right).\n$$",
            "answer": "$$\\boxed{\\arccos\\!\\left(\\frac{1}{4}\\right)}$$"
        },
        {
            "introduction": "在分子物理学中，锥形交叉是电子态之间的简并点，深刻影响着化学动力学过程。本练习使用一个简化的哈密顿量来模拟锥形交叉。您将被要求使用两种不同的方法计算贝里相位：直接对贝里联络进行线积分，以及将立体角公式应用于一个抽象的矢量空间。这个练习将加深您对这两种观点在数学上的等价性的理解，并使您更深入地认识到简并点附近贝里相位的拓扑起源 。",
            "id": "2642988",
            "problem": "一个在原点处表现出锥形交叉的两态电子哈密顿量，在非绝热基和核位移的一阶近似下，可以表示为有效绝热哈密顿量\n$$\n\\hat{H}(\\mathbf{Q}) \\;=\\; \\mathbf{d}(\\mathbf{Q}) \\cdot \\boldsymbol{\\sigma},\n$$\n其中 $\\mathbf{Q} = (Q_x,Q_y,Q_z)$ 是三个实数控制参数（两个对称性允许的核模式和一个消除简并的调节参数），$\\boldsymbol{\\sigma} = (\\sigma_x,\\sigma_y,\\sigma_z)$ 是泡利矩阵，$\\mathbf{d}(\\mathbf{Q}) = \\big(\\kappa Q_x,\\;\\kappa Q_y,\\;\\lambda Q_z\\big)$，其中 $\\kappa>0$ 和 $\\lambda>0$ 是常数。锥形交叉发生在 $\\mathbf{Q}=\\mathbf{0}$ 处，此时 $\\mathbf{d}=\\mathbf{0}$。\n\n考虑在玻恩-奥本海默近似和绝热近似下，当核坐标沿闭合回路\n$$\n\\mathcal{C}:\\quad Q_x(\\phi) = \\rho \\cos\\phi,\\quad Q_y(\\phi) = \\rho \\sin\\phi,\\quad Q_z(\\phi) = 0,\\quad \\phi\\in[0,2\\pi],\n$$\n运动时，低能电子本征态 $\\lvert u_{-}(\\mathbf{Q})\\rangle$ 的绝热演化。该回路的半径 $\\rho>0$ 为固定有限值。这个回路在 $Q_z=0$ 平面内环绕锥形交叉一次。\n\n1) 从绝热几何相位（贝里相位）的定义出发，\n$$\n\\gamma_{-}[\\mathcal{C}] \\;=\\; \\oint_{\\mathcal{C}} \\mathbf{A}_{-}(\\mathbf{Q}) \\cdot d\\mathbf{Q},\\qquad \\mathbf{A}_{-}(\\mathbf{Q}) \\;=\\; i\\,\\langle u_{-}(\\mathbf{Q}) \\vert \\boldsymbol{\\nabla}_{\\mathbf{Q}} u_{-}(\\mathbf{Q}) \\rangle,\n$$\n通过用 $\\phi$ 参数化 $\\mathcal{C}$ 并对 $\\hat{H}(\\mathbf{Q})$ 的低能绝热本征态计算线积分，显式计算 $\\gamma_{-}[\\mathcal{C}]$。\n\n2) 独立地，将 $\\mathbf{d}(\\mathbf{Q})$ 视为从 $\\mathbf{Q}$ 空间到辅助三参数空间的映射，并考虑单位矢量 $\\hat{\\mathbf{d}}(\\phi) = \\mathbf{d}(\\mathbf{Q}(\\phi))/\\lvert \\mathbf{d}(\\mathbf{Q}(\\phi))\\rvert$。计算在单位球面上由闭合曲线 $\\hat{\\mathbf{d}}(\\phi)$ 对原点所张的立体角 $\\Omega[\\mathcal{C}]$，并验证您在第 (1) 部分得到的结果与两能级系统的立体角观点的一致性。\n\n将您最终的累积几何相位答案表示为一个以弧度为单位的精确数值。不要进行近似或四舍五入。",
            "solution": "本题要求计算一个由哈密顿量 $\\hat{H}(\\mathbf{Q}) = \\mathbf{d}(\\mathbf{Q}) \\cdot \\boldsymbol{\\sigma}$（其中 $\\mathbf{d}(\\mathbf{Q}) = (\\kappa Q_x, \\kappa Q_y, \\lambda Q_z)$）描述的两态电子系统，当核坐标 $\\mathbf{Q}$ 沿一个环绕 $\\mathbf{Q} = \\mathbf{0}$ 处锥形交叉的特定闭合回路 $\\mathcal{C}$ 运动时，所产生的绝热几何相位（贝里相位）。\n\n首先，我们必须确定哈密顿量的本征值和本征态。该哈密顿量由下式给出\n$$\n\\hat{H}(\\mathbf{Q}) = d_x \\sigma_x + d_y \\sigma_y + d_z \\sigma_z = \\begin{pmatrix} d_z & d_x - i d_y \\\\ d_x + i d_y & -d_z \\end{pmatrix},\n$$\n其中 $d_x = \\kappa Q_x$，$d_y = \\kappa Q_y$，$d_z = \\lambda Q_z$。通过求解特征方程可以找到本征值，得到 $E_{\\pm} = \\pm \\sqrt{d_x^2 + d_y^2 + d_z^2} = \\pm |\\mathbf{d}(\\mathbf{Q})|$。本题关注的是低能本征态，它对应于本征值 $E_{-} = -|\\mathbf{d}(\\mathbf{Q})|$。\n\n$\\hat{H}(\\mathbf{Q})$ 的本征态是沿矢量 $\\mathbf{d}(\\mathbf{Q})$ 方向的自旋向上和自旋向下态。设 $\\mathbf{d}$ 的方向由球坐标角 $(\\theta, \\varphi)$ 指定，其中 $d_x = |\\mathbf{d}| \\sin\\theta \\cos\\varphi$，$d_y = |\\mathbf{d}| \\sin\\theta \\sin\\varphi$，$d_z = |\\mathbf{d}| \\cos\\theta$。对应于沿 $\\mathbf{d}$ 方向自旋投影为 $-1/2$ 的低能本征态 $\\lvert u_{-}(\\mathbf{Q}) \\rangle$ 可以写为\n$$\n\\lvert u_{-}(\\theta, \\varphi) \\rangle = \\begin{pmatrix} -\\sin(\\theta/2) e^{-i\\varphi} \\\\ \\cos(\\theta/2) \\end{pmatrix}.\n$$\n只要 $\\theta \\neq \\pi$，这个形式就是良定义的。\n\n题目指定了参数空间 $\\mathbf{Q}$ 中的一个闭合回路 $\\mathcal{C}$：\n$$\nQ_x(\\phi) = \\rho \\cos\\phi, \\quad Q_y(\\phi) = \\rho \\sin\\phi, \\quad Q_z(\\phi) = 0, \\quad \\phi \\in [0, 2\\pi].\n$$\n沿着这条路径，矢量 $\\mathbf{d}$ 的分量为：\n$$\nd_x(\\phi) = \\kappa \\rho \\cos\\phi, \\quad d_y(\\phi) = \\kappa \\rho \\sin\\phi, \\quad d_z(\\phi) = 0.\n$$\n沿此回路 $\\mathbf{d}$ 的模长是恒定的：$|\\mathbf{d}(\\phi)| = \\sqrt{(\\kappa \\rho \\cos\\phi)^2 + (\\kappa \\rho \\sin\\phi)^2} = \\kappa \\rho$。由于 $d_z = 0$，矢量 $\\mathbf{d}$ 的极角 $\\theta$ 固定为 $\\theta = \\pi/2$。方位角 $\\varphi$ 等于回路参数 $\\phi$。因此，$\\mathbf{Q}$ 空间中的回路 $\\mathcal{C}$ 映射到本征矢量的参数空间中的一个回路，其中 $\\theta = \\pi/2$ 且 $\\varphi$ 从 $0$ 变化到 $2\\pi$。由于 $\\theta = \\pi/2 \\neq \\pi$，我们选择的本征矢量在整个路径上都是良定义的。\n\n将 $\\theta=\\pi/2$ 和 $\\varphi=\\phi$ 代入 $\\lvert u_{-} \\rangle$ 的表达式，我们得到沿路径 $\\mathcal{C}$ 的本征态：\n$$\n\\lvert u_{-}(\\phi) \\rangle = \\begin{pmatrix} -\\sin(\\pi/4) e^{-i\\phi} \\\\ \\cos(\\pi/4) \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{-i\\phi} \\\\ 1 \\end{pmatrix}.\n$$\n\n第 1 部分：几何相位由线积分 $\\gamma_{-}[\\mathcal{C}] = \\oint_{\\mathcal{C}} \\mathbf{A}_{-}(\\mathbf{Q}) \\cdot d\\mathbf{Q}$ 给出。通过用 $\\phi$ 参数化路径，该积分变为\n$$\n\\gamma_{-}[\\mathcal{C}] = \\int_0^{2\\pi} \\mathbf{A}_{-}(\\mathbf{Q}(\\phi)) \\cdot \\frac{d\\mathbf{Q}}{d\\phi} d\\phi.\n$$\n被积函数是贝里联络沿路径的分量，可以计算为 $i \\langle u_{-}(\\phi) | \\frac{d}{d\\phi} u_{-}(\\phi) \\rangle$。我们来计算这一项。首先，我们求态矢量关于 $\\phi$ 的导数：\n$$\n\\frac{d}{d\\phi} \\lvert u_{-}(\\phi) \\rangle = \\frac{d}{d\\phi} \\left[ \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{-i\\phi} \\\\ 1 \\end{pmatrix} \\right] = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -(-i)e^{-i\\phi} \\\\ 0 \\end{pmatrix} = \\frac{i}{\\sqrt{2}} \\begin{pmatrix} e^{-i\\phi} \\\\ 0 \\end{pmatrix}.\n$$\n左矢为 $\\langle u_{-}(\\phi) | = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi} & 1 \\end{pmatrix}$。\n现在我们计算内积：\n$$\ni \\langle u_{-}(\\phi) | \\frac{d}{d\\phi} u_{-}(\\phi) \\rangle = i \\left[ \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi} & 1 \\end{pmatrix} \\right] \\left[ \\frac{i}{\\sqrt{2}} \\begin{pmatrix} e^{-i\\phi} \\\\ 0 \\end{pmatrix} \\right] = i \\left( \\frac{i}{2} \\right) (-e^{i\\phi})(e^{-i\\phi}) = -\\frac{1}{2} (-1) = \\frac{1}{2}.\n$$\n几何相位是对这个常数值在区间 $[0, 2\\pi]$ 上的积分：\n$$\n\\gamma_{-}[\\mathcal{C}] = \\int_0^{2\\pi} \\frac{1}{2} d\\phi = \\frac{1}{2} [\\phi]_0^{2\\pi} = \\frac{1}{2} (2\\pi - 0) = \\pi.\n$$\n\n第 2 部分：我们现在使用立体角观点来验证这个结果。矢量 $\\mathbf{d}(\\phi)$ 在一个三维辅助空间中描绘出一条路径。我们考虑其对应的单位矢量 $\\hat{\\mathbf{d}}(\\phi) = \\mathbf{d}(\\phi) / |\\mathbf{d}(\\phi)|$ 所描绘的路径。\n沿着回路 $\\mathcal{C}$，我们有 $\\mathbf{d}(\\phi) = (\\kappa\\rho\\cos\\phi, \\kappa\\rho\\sin\\phi, 0)$ 和 $|\\mathbf{d}(\\phi)| = \\kappa\\rho$。\n因此，单位矢量为\n$$\n\\hat{\\mathbf{d}}(\\phi) = (\\cos\\phi, \\sin\\phi, 0).\n$$\n当 $\\phi$ 从 $0$ 变化到 $2\\pi$ 时，这个矢量在 $\\mathbf{d}$ 空间的单位球面上描绘出赤道。这个闭合回路对原点所张的立体角 $\\Omega[\\mathcal{C}]$ 是该回路所包围的球冠面积。对于逆时针方向遍历赤道，所包围的区域是北半球的面积。单位球面的表面积是 $4\\pi$，所以一个半球的面积是 $2\\pi$。\n$$\n\\Omega[\\mathcal{C}] = 2\\pi \\text{ steradians}.\n$$\n对于一个两能级系统（一个自旋-1/2 系统），几何相位 $\\gamma$ 与立体角 $\\Omega$ 的关系由公式 $\\gamma = -m_s \\Omega$ 给出，其中 $m_s$ 是沿 $\\mathbf{d}$ 方向的自旋投影量子数。低能态 $\\lvert u_{-} \\rangle$ 对应于相对于 $\\mathbf{d}$ 矢量的自旋向下态，所以其自旋投影为 $m_s = -1/2$。\n使用这个公式，我们可以计算几何相位：\n$$\n\\gamma_{-} = - \\left(-\\frac{1}{2}\\right) \\Omega[\\mathcal{C}] = \\frac{1}{2} (2\\pi) = \\pi.\n$$\n这个结果与第 1 部分通过直接积分贝里联络得到的值完全一致。这证实了计算的一致性。累积的几何相位是 $\\pi$ 弧度。",
            "answer": "$$\\boxed{\\pi}$$"
        },
        {
            "introduction": "从解析理论到实际研究，往往需要稳健的数值方法。本练习将指导您编写一个程序来计算一个通用两能级模型的贝里相位。您将使用规范不变的潘查拉特南联络（Pancharatnam connection），它依赖于沿路径相邻本征矢量的交叠，并实现一个自适应算法来保证数值精度。完成这个练习将使您掌握在实际模型中数值研究几何相位效应的基本技能，从而架起理论概念与计算实践之间的桥梁 。",
            "id": "2642948",
            "problem": "设计并实现一个程序，该程序计算一个二能级模型哈密顿量的绝热本征态沿二维核坐标空间中的闭合回路累积的几何相位（贝里相位），并能自适应地控制离散化，以确保提取相位的数值不确定性低于预设容差。背景是物理化学中锥形交叉点附近的几何相位效应。\n\n考虑由核坐标$x$和$y$参数化的以下二能级绝热模型哈密顿量：\n$$\n\\hat{H}(x,y) \\;=\\; \\begin{pmatrix}\n\\alpha\\,(x-x_c) & \\beta\\,(y-y_c) \\\\\n\\beta\\,(y-y_c) & -\\alpha\\,(x-x_c)\n\\end{pmatrix},\n$$\n其中$(x_c,y_c)$是锥形交叉点的位置，$\\alpha$和$\\beta$是实常数。假设$\\alpha=\\beta=1$。对于任何不在锥形交叉点处的点$(x,y)$，该哈密顿量有两个非简并的绝热本征态。对于沿$(x,y)$平面中的闭合回路$\\mathcal{C}$绝热输运的低能绝热态，其几何相位（贝里相位）$\\gamma$由贝里联络的线积分定义，这是回路和绝热本征丛的内禀属性。\n\n您的任务是：\n\n- 从绝热演化的几何相位的定义以及它是射影希尔伯特空间的一个属性这一事实出发，实现一个与连续定义一致的规范不变离散化方法，该方法使用沿闭合回路的相邻归一化绝热本征向量的内积（交叠）。不要假设任何特殊的规范；仅依赖于在本征向量的局域U(1)相位变换下不变的量。沿着回路参数（以弧度为单位的角度）使用$N$个等距采样点。\n- 实现一个自适应方案来选择$N$，以确保计算出的几何相位的数值不确定性小于目标容差$\\delta_{\\mathrm{target}} = 0.05\\pi$（弧度）。从$N_0=16$开始，并通过将$N$加倍进行细化，直到以下两个条件同时满足：\n  1. 沿回路的相邻态交叠的最小模值至少为一个阈值$\\tau$，即$\\min_k \\left|\\langle u_k \\mid u_{k+1}\\rangle\\right| \\ge \\tau$，其中$\\tau=0.995$。\n  2. 后验不确定性估计，取为用$N$个点和$2N$个点计算的几何相位之间的绝对差（将相位缠绕到主分支），小于或等于$\\delta_{\\mathrm{target}}$。\n- 如果在给定的$N$下任一条件不满足，则将$N$加倍并重复，直到最大值$N_{\\max}=16384$。如果在$N_{\\max}$时条件仍未满足，则报告最后的估计值并标记未达到容差。\n- 角度必须以弧度表示。在主分支$[-\\pi,\\pi)$上报告几何相位。\n\n回路参数化：\n- 中心为$(x_0,y_0)$、半径为$r$的圆形回路由$(x(\\theta), y(\\theta)) = (x_0 + r\\cos\\theta,\\, y_0 + r\\sin\\theta)$给出，其中$\\theta \\in [0,2\\pi)$。\n- 中心为$(x_0,y_0)$、半轴为$a$和$b$的椭圆形回路由$(x(\\theta), y(\\theta)) = (x_0 + a\\cos\\theta,\\, y_0 + b\\sin\\theta)$给出，其中$\\theta \\in [0,2\\pi)$。\n\n测试套件：\n为以下五个测试用例实现并运行您的算法，每个用例由$(x_c,y_c)$、回路类型和参数定义。在所有情况下，均使用$\\alpha=\\beta=1$。\n\n- 测试 $1$（包围锥形交叉点，圆形）：$(x_c,y_c)=(0,0)$，回路类型：圆形，中心$(x_0,y_0)=(0,0)$，半径$r=1$。\n- 测试 $2$（不包围，圆形）：$(x_c,y_c)=(0,0)$，回路类型：圆形，中心$(x_0,y_0)=(2,0)$，半径$r=0.5$。\n- 测试 $3$（包围锥形交叉点，椭圆）：$(x_c,y_c)=(0,0)$，回路类型：椭圆，中心$(x_0,y_0)=(0,0)$，半轴$a=1.5$，$b=0.5$。\n- 测试 $4$（近距离错过，圆形）：$(x_c,y_c)=(0,0)$，回路类型：圆形，中心$(x_0,y_0)=(0.55,0)$，半径$r=0.5$。\n- 测试 $5$（平移的锥形交叉点，包围，圆形）：$(x_c,y_c)=(0.3,-0.2)$，回路类型：圆形，中心$(x_0,y_0)=(0.3,-0.2)$，半径$r=0.25$。\n\n对于每个测试用例，您的程序必须生成一个包含三个条目的列表结果：\n- 估计的几何相位$\\gamma$（弧度，在$[-\\pi,\\pi)$上），四舍五入到$6$位小数，\n- 估计的不确定性$\\Delta\\gamma$（弧度），四舍五入到$6$位小数，\n- 一个布尔值，指示$\\Delta\\gamma \\le 0.05\\pi$是否成立。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含结果，格式为由逗号分隔的各测试用例列表的列表，并用方括号括起来。例如，一个有效的输出结构是\n$[$$[\\gamma_1,\\Delta\\gamma_1,\\mathrm{ok}_1]$, $[\\gamma_2,\\Delta\\gamma_2,\\mathrm{ok}_2]$, $\\dots$$]$，\n所有角度均以弧度为单位。不应打印任何额外文本。",
            "solution": "用户提供了一个计算物理化学领域中有效且定义明确的问题。任务是设计并实现一个程序，用于计算由模型哈密顿量描述的二能级量子系统的几何相位（贝里相位），并采用自适应数值方案以确保达到目标精度。\n\n该问题具有科学依据，基于量子力学中关于绝热演化和锥形交叉点附近几何相位的既定原理。数学和数值规范是完整且内部一致的，可以得到唯一且可验证的解。\n\n程序将按照下文概述的、有原则的、分步的方法进行开发。\n\n**1. 模型哈密顿量及其本征态**\n\n系统由一个由核坐标$(x,y)$参数化的二能级模型哈密顿量描述：\n$$\n\\hat{H}(x,y) \\;=\\; \\begin{pmatrix}\n\\alpha\\,(x-x_c) & \\beta\\,(y-y_c) \\\\\n\\beta\\,(y-y_c) & -\\alpha\\,(x-x_c)\n\\end{pmatrix}\n$$\n在此，$(x_c,y_c)$是锥形交叉点的位置，在该点两个能级发生简并。给定常数为$\\alpha=1$和$\\beta=1$。让我们定义平移坐标$q_x = x-x_c$和$q_y = y-y_c$。哈密顿量简化为：\n$$\n\\hat{H}(q_x,q_y) \\;=\\; \\begin{pmatrix}\nq_x & q_y \\\\\nq_y & -q_x\n\\end{pmatrix}\n$$\n本征值$E$通过求解特征方程$\\det(\\hat{H} - E\\hat{I})=0$得到，得出$E^2 = q_x^2 + q_y^2$。两个绝热能级为：\n$$\nE_\\pm(q_x,q_y) \\;=\\; \\pm\\sqrt{q_x^2 + q_y^2}\n$$\n这些能级仅在锥形交叉点处简并，即$q_x=q_y=0$。问题要求我们考虑低能绝热态，对应于本征值$E_-(q_x,q_y)$。在给定回路上的每个点$(x,y)$，我们通过数值对角化哈密顿矩阵$\\hat{H}(x,y)$来找到相应的归一化本征向量$|u_-\\rangle$。\n\n**2. 几何相位的数值计算**\n\n一个本征态沿闭合回路$\\mathcal{C}$绝热输运所累积的几何相位$\\gamma$可以用一种规范不变的方式来表述，以适用于数值计算。路径$\\mathcal{C}$被离散化为$N$个有序点，$\\{R_1, R_2, \\dots, R_N\\}$。在每个点$R_k$，我们计算归一化的低能本征向量$|u_k\\rangle$。总几何相位是沿回路的相邻本征向量的复内积（交叠）之积的辐角：\n$$\n\\gamma_N = \\mathrm{arg}\\left( \\langle u_1|u_2\\rangle \\langle u_2|u_3\\rangle \\cdots \\langle u_{N-1}|u_N\\rangle \\langle u_N|u_1\\rangle \\right) = \\mathrm{arg}\\left(\\prod_{k=1}^N \\langle u_k|u_{k+1}\\rangle\\right)\n$$\n其中索引是循环的，即$|u_{N+1}\\rangle \\equiv |u_1\\rangle$。这个表达式，被称为潘查拉特南联络（Pancharatnam connection），在本征向量$|u_k\\rangle \\to e^{i\\phi_k}|u_k\\rangle$的独立局域相位变换下是不变的，这使其在数值实现中具有鲁棒性，因为标准对角化程序产生的本征向量相位不保证是平滑的。相位将在主分支$[-\\pi, \\pi)$上报告。\n\n**3. 自适应离散化算法**\n\n为确保数值结果的准确性，实现了一个自适应方案来选择离散化点数$N$。算法从初始值$N=N_0=16$开始，并通过将$N$加倍来迭代地细化网格，直到满足收敛标准，最大可达$N_{\\max}=16384$。\n\n在每次使用给定离散化$N$的迭代中，必须同时满足两个收敛条件：\n1.  **足够的状态交叠**：离散化必须足够精细，以使相邻的本征向量近似平行。这通过要求相邻交叠的最小模值高于阈值$\\tau=0.995$来量化：\n    $$\n    \\min_{k \\in \\{1,\\dots,N\\}} \\left|\\langle u_k | u_{k+1}\\rangle\\right| \\ge \\tau\n    $$\n2.  **不确定性容差**：数值不确定性的后验估计，取为用$N$个点和$2N$个点计算的相位之间的绝对差，必须低于目标容差$\\delta_{\\mathrm{target}} = 0.05\\pi$：\n    $$\n    \\Delta\\gamma_N = |\\mathrm{wrap}(\\gamma_N - \\gamma_{2N})| \\le \\delta_{\\mathrm{target}}\n    $$\n    `wrap`函数在取绝对值之前将相位差映射到主分支$[-\\pi, \\pi)$，正确处理相位缠绕问题。\n\n自适应循环过程如下：对于$N = 16, 32, 64, \\dots, 16384$：\n- 计算$N$个点时的$\\gamma_N$和最小交叠。\n- 计算$\\gamma_{2N}$用于不确定性估计。\n- 检查是否两个收敛标准都已满足。\n- 如果满足，算法终止。最终报告的相位是更精确的$\\gamma_{2N}$，不确定性是$\\Delta\\gamma_N$。\n- 如果标准未满足，则将$N$加倍并重复该过程。\n- 如果达到$N=N_{\\max}$且标准仍未满足，算法终止并标记未达到容差，报告最后计算的相位和不确定性值。\n\n此过程确保计算出的几何相位是可靠的并满足规定的精度，能根据每个测试用例的特定难度（例如，靠近锥形交叉点的回路需要更精细的网格）自适应地调整计算量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases\n    and prints the final result in the specified format.\n    \"\"\"\n\n    # Define global constants as specified in the problem statement\n    ALPHA = 1.0\n    BETA = 1.0\n    DELTA_TARGET = 0.05 * np.pi\n    TAU = 0.995\n    N0 = 16\n    N_MAX = 16384\n\n    def wrap_phase(p):\n        \"\"\"Wraps a phase to the principal branch [-pi, pi).\"\"\"\n        return (p + np.pi) % (2 * np.pi) - np.pi\n\n    def get_loop_points(loop_params, N):\n        \"\"\"Generates N points on the specified loop.\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        points = np.zeros((N, 2))\n        x0, y0 = loop_params['center']\n        if loop_params['type'] == 'circle':\n            r = loop_params['r']\n            points[:, 0] = x0 + r * np.cos(thetas)\n            points[:, 1] = y0 + r * np.sin(thetas)\n        elif loop_params['type'] == 'ellipse':\n            a = loop_params['a']\n            b = loop_params['b']\n            points[:, 0] = x0 + a * np.cos(thetas)\n            points[:, 1] = y0 + b * np.sin(thetas)\n        return points\n\n    def compute_gamma_and_overlap(loop_params, N):\n        \"\"\"\n        Computes the geometric phase and minimum adjacent overlap for a given loop\n        and discretization N.\n        \"\"\"\n        if N == 0:\n            return 0.0, 1.0\n\n        points = get_loop_points(loop_params, N)\n        \n        evecs = []\n        xc, yc = loop_params['ci_pos']\n        for x, y in points:\n            qx = ALPHA * (x - xc)\n            qy = BETA * (y - yc)\n            H = np.array([[qx, qy], [qy, -qx]], dtype=np.float64)\n            # Use eigh for real symmetric matrices. Eigenvalues are sorted.\n            # The first eigenvector corresponds to the lower energy state.\n            _eigvals, eigvecs_matrix = np.linalg.eigh(H)\n            evecs.append(eigvecs_matrix[:, 0])\n\n        total_overlap_product = 1.0 + 0.0j\n        min_abs_overlap = 1.0\n        for k in range(N):\n            u_k = evecs[k]\n            u_k_plus_1 = evecs[(k + 1) % N]  # Ensures loop closure u_{N} -> u_{0}\n            overlap = np.vdot(u_k, u_k_plus_1) # Conjugate dot product\n            total_overlap_product *= overlap\n            min_abs_overlap = min(min_abs_overlap, abs(overlap))\n\n        # The geometric phase is the argument of the total product\n        gamma = np.angle(total_overlap_product)\n        \n        return gamma, min_abs_overlap\n\n    def adaptive_gamma_calculation(loop_params):\n        \"\"\"\n        Implements the adaptive scheme to compute the geometric phase by iteratively\n        refining the grid discretization until convergence criteria are met.\n        \"\"\"\n        N = N0\n        \n        while N <= N_MAX:\n            # Compute gamma and min_overlap for the current discretization N\n            gamma_N, min_overlap_N = compute_gamma_and_overlap(loop_params, N)\n\n            # Compute gamma with a finer grid (2N) for the uncertainty estimate\n            gamma_2N, _ = compute_gamma_and_overlap(loop_params, 2 * N)\n            \n            # Uncertainty is the absolute value of the wrapped phase difference\n            delta_gamma = abs(wrap_phase(gamma_N - gamma_2N))\n            \n            # Check convergence criteria for discretization N\n            converged_overlap = min_overlap_N >= TAU\n            converged_delta = delta_gamma <= DELTA_TARGET\n\n            # If both conditions are met, convergence is achieved.\n            # The result is the more accurate phase from the 2N calculation.\n            if converged_overlap and converged_delta:\n                final_gamma = wrap_phase(gamma_2N)\n                return [round(final_gamma, 6), round(delta_gamma, 6), True]\n\n            # If at the max number of iterations and not converged, report failure.\n            if N == N_MAX:\n                final_gamma = wrap_phase(gamma_2N)\n                return [round(final_gamma, 6), round(delta_gamma, 6), False]\n\n            # If not converged, double N for the next iteration.\n            N *= 2\n            \n        # This part should be unreachable given the loop condition.\n        return [0.0, 0.0, False]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1 (enclosing conical intersection, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (0.0, 0.0), 'r': 1.0},\n        # Test 2 (not enclosing, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (2.0, 0.0), 'r': 0.5},\n        # Test 3 (enclosing conical intersection, ellipse)\n        {'ci_pos': (0.0, 0.0), 'type': 'ellipse', 'center': (0.0, 0.0), 'a': 1.5, 'b': 0.5},\n        # Test 4 (near miss, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (0.55, 0.0), 'r': 0.5},\n        # Test 5 (shifted conical intersection, enclosing, circle)\n        {'ci_pos': (0.3, -0.2), 'type': 'circle', 'center': (0.3, -0.2), 'r': 0.25},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = adaptive_gamma_calculation(case)\n        results.append(result)\n\n    # Format the final output string exactly as required by the problem.\n    formatted_results = []\n    for r in results:\n        # Convert boolean to lowercase string 'true' or 'false'\n        r_str = f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\"\n        formatted_results.append(r_str)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}