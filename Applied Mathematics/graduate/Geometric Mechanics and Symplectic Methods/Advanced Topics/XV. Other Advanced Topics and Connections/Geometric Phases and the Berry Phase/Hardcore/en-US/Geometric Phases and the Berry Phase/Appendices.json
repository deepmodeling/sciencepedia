{
    "hands_on_practices": [
        {
            "introduction": "This practice explores the canonical example used to introduce the concept of the geometric phase. By analyzing a spin-1/2 particle in a slowly precessing magnetic field, you will perform a concrete calculation of the phase accumulated during adiabatic evolution. This exercise is invaluable for building intuition, as it solidifies the fundamental connection between the Berry phase $\\gamma_g$ and the solid angle $\\Omega$ subtended by the path of the system's parameters. ",
            "id": "1990141",
            "problem": "A single electron is confined in a quantum device and subjected to a spatially uniform magnetic field $\\vec{B}(t)$ of constant magnitude $B_0$. The direction of this field, represented by the unit vector $\\hat{n}(t) = \\vec{B}(t)/B_0$, is varied adiabatically over a time interval $T$, causing it to trace out a closed loop. The electron is initially prepared and remains in the higher-energy spin eigenstate corresponding to the instantaneous magnetic field direction.\n\nThe path traced by the tip of the vector $\\hat{n}(t)$ on a unit sphere is a circle of constant latitude, defined by a polar angle $\\theta_0$ with respect to a fixed z-axis, as the azimuthal angle sweeps through a full $2\\pi$ cycle. At the end of one cycle, the geometric phase (also known as the Berry phase) accumulated by the electron's wavefunction is measured to be $\\gamma_g = -\\frac{3\\pi}{4}$.\n\nThe Hamiltonian governing the spin dynamics is given by $H(t) = \\frac{g_e \\mu_B}{\\hbar} \\vec{S} \\cdot \\vec{B}(t)$, where $\\vec{S}$ is the electron spin operator, $\\mu_B$ is the Bohr magneton, $g_e$ is the electron g-factor (a positive constant approximately equal to 2), and $\\hbar$ is the reduced Planck constant.\n\nDetermine the value of the polar angle $\\theta_0$. Express your answer as a closed-form analytic expression in radians.",
            "solution": "The Hamiltonian is $H(t) = \\frac{g_{e}\\mu_{B}}{\\hbar}\\,\\vec{S}\\cdot\\vec{B}(t)$, with $\\vec{B}(t)=B_{0}\\hat{n}(t)$. For a spin-$\\frac{1}{2}$ in an adiabatically varying magnetic field, the adiabatic theorem ensures the state remains in an instantaneous eigenstate labeled by the magnetic quantum number $m=\\pm \\frac{1}{2}$ with respect to the direction $\\hat{n}(t)$. The Berry phase accumulated over a closed loop is given by the standard result\n$$\n\\gamma_{g}=-m\\,\\Omega,\n$$\nwhere $\\Omega$ is the signed solid angle subtended by the closed path of $\\hat{n}(t)$ on the unit sphere.\n\nSince $g_{e}>0$, the higher-energy eigenstate corresponds to $m=+\\frac{1}{2}$ (spin aligned with $\\vec{B}$), because the eigenvalues of $H$ are $E_{m}=g_{e}\\mu_{B}mB_{0}$. Therefore, for the state that is followed experimentally,\n$$\n\\gamma_{g}=-\\frac{1}{2}\\,\\Omega.\n$$\nThe path is a circle at fixed polar angle $\\theta_{0}$ with the azimuthal angle sweeping by $2\\pi$. The solid angle enclosed by such a latitude circle is\n$$\n\\Omega=2\\pi\\left(1-\\cos\\theta_{0}\\right),\n$$\nwith positive sign for the standard orientation where the azimuth increases from $0$ to $2\\pi$. The measured geometric phase is $\\gamma_{g}=-\\frac{3\\pi}{4}$, so equating,\n$$\n-\\frac{1}{2}\\,\\Omega=-\\frac{3\\pi}{4}\\quad\\Longrightarrow\\quad \\Omega=\\frac{3\\pi}{2}.\n$$\nSubstituting $\\Omega=2\\pi\\left(1-\\cos\\theta_{0}\\right)$ gives\n$$\n2\\pi\\left(1-\\cos\\theta_{0}\\right)=\\frac{3\\pi}{2}\n\\quad\\Longrightarrow\\quad\n1-\\cos\\theta_{0}=\\frac{3}{4}\n\\quad\\Longrightarrow\\quad\n\\cos\\theta_{0}=\\frac{1}{4}.\n$$\nTherefore,\n$$\n\\theta_{0}=\\arccos\\!\\left(\\frac{1}{4}\\right).\n$$",
            "answer": "$$\\boxed{\\arccos\\!\\left(\\frac{1}{4}\\right)}$$"
        },
        {
            "introduction": "Moving from external fields to internal molecular coordinates, this problem delves into the crucial role of geometric phases at conical intersections. You will work with a standard model Hamiltonian and compute the Berry phase in two ways: first, by directly evaluating the line integral of the Berry connection, and second, by leveraging the solid angle formalism. This dual approach provides a rigorous workout in the underlying mathematics and demonstrates the versatile nature of the geometric phase concept. ",
            "id": "2642988",
            "problem": "A two-state electronic Hamiltonian that exhibits a conical intersection at the origin can be represented, in a diabatic basis and to linear order in nuclear displacements, by the effective adiabatic Hamiltonian\n$$\n\\hat{H}(\\mathbf{Q}) \\;=\\; \\mathbf{d}(\\mathbf{Q}) \\cdot \\boldsymbol{\\sigma},\n$$\nwhere $\\mathbf{Q} = (Q_x,Q_y,Q_z)$ are three real control parameters (two symmetry-allowed nuclear modes and one tuning parameter that lifts the degeneracy), $\\boldsymbol{\\sigma} = (\\sigma_x,\\sigma_y,\\sigma_z)$ are the Pauli matrices, and $\\mathbf{d}(\\mathbf{Q}) = \\big(\\kappa Q_x,\\;\\kappa Q_y,\\;\\lambda Q_z\\big)$ with $\\kappa>0$ and $\\lambda>0$ constants. The conical intersection occurs at $\\mathbf{Q}=\\mathbf{0}$, where $\\mathbf{d}=\\mathbf{0}$.\n\nConsider the adiabatic evolution of the lower-energy electronic eigenstate $\\lvert u_{-}(\\mathbf{Q})\\rangle$ under the Bornâ€“Oppenheimer and adiabatic approximations as the nuclear coordinates traverse the closed loop\n$$\n\\mathcal{C}:\\quad Q_x(\\phi) = \\rho \\cos\\phi,\\quad Q_y(\\phi) = \\rho \\sin\\phi,\\quad Q_z(\\phi) = 0,\\quad \\phi\\in[0,2\\pi],\n$$\nwith fixed finite radius $\\rho>0$. This loop encircles the conical intersection once in the plane $Q_z=0$.\n\n1) Starting from the definition of the adiabatic geometric phase (Berry phase),\n$$\n\\gamma_{-}[\\mathcal{C}] \\;=\\; \\oint_{\\mathcal{C}} \\mathbf{A}_{-}(\\mathbf{Q}) \\cdot d\\mathbf{Q},\\qquad \\mathbf{A}_{-}(\\mathbf{Q}) \\;=\\; i\\,\\langle u_{-}(\\mathbf{Q}) \\vert \\boldsymbol{\\nabla}_{\\mathbf{Q}} u_{-}(\\mathbf{Q}) \\rangle,\n$$\ncompute $\\gamma_{-}[\\mathcal{C}]$ explicitly by parameterizing $\\mathcal{C}$ with $\\phi$ and evaluating the line integral for the lower adiabatic eigenstate of $\\hat{H}(\\mathbf{Q})$.\n\n2) Independently, view $\\mathbf{d}(\\mathbf{Q})$ as a map from $\\mathbf{Q}$-space to an auxiliary three-parameter space and consider the unit vector $\\hat{\\mathbf{d}}(\\phi) = \\mathbf{d}(\\mathbf{Q}(\\phi))/\\lvert \\mathbf{d}(\\mathbf{Q}(\\phi))\\rvert$. Compute the solid angle $\\Omega[\\mathcal{C}]$ at the origin subtended by the closed curve $\\hat{\\mathbf{d}}(\\phi)$ on the unit sphere, and verify the consistency of your result in part (1) with the solid-angle viewpoint for a two-level system.\n\nExpress your final answer for the accumulated geometric phase as a single exact number in radians. Do not approximate or round.",
            "solution": "The problem asks for the calculation of the adiabatic geometric phase (Berry phase) for a two-state electronic system described by the Hamiltonian $\\hat{H}(\\mathbf{Q}) = \\mathbf{d}(\\mathbf{Q}) \\cdot \\boldsymbol{\\sigma}$, where $\\mathbf{d}(\\mathbf{Q}) = (\\kappa Q_x, \\kappa Q_y, \\lambda Q_z)$, as the nuclear coordinates $\\mathbf{Q}$ traverse a specific closed loop $\\mathcal{C}$ around a conical intersection at $\\mathbf{Q} = \\mathbf{0}$.\n\nFirst, we must determine the eigenvalues and eigenstates of the Hamiltonian. The Hamiltonian is given by\n$$\n\\hat{H}(\\mathbf{Q}) = d_x \\sigma_x + d_y \\sigma_y + d_z \\sigma_z = \\begin{pmatrix} d_z & d_x - i d_y \\\\ d_x + i d_y & -d_z \\end{pmatrix},\n$$\nwhere $d_x = \\kappa Q_x$, $d_y = \\kappa Q_y$, and $d_z = \\lambda Q_z$. The eigenvalues are found by solving the characteristic equation, which yields $E_{\\pm} = \\pm \\sqrt{d_x^2 + d_y^2 + d_z^2} = \\pm |\\mathbf{d}(\\mathbf{Q})|$. The problem concerns the lower-energy eigenstate, which corresponds to the eigenvalue $E_{-} = -|\\mathbf{d}(\\mathbf{Q})|$.\n\nThe eigenstates of $\\hat{H}(\\mathbf{Q})$ are the spin-up and spin-down states along the direction of the vector $\\mathbf{d}(\\mathbf{Q})$. Let the direction of $\\mathbf{d}$ be specified by the spherical angles $(\\theta, \\varphi)$, where $d_x = |\\mathbf{d}| \\sin\\theta \\cos\\varphi$, $d_y = |\\mathbf{d}| \\sin\\theta \\sin\\varphi$, and $d_z = |\\mathbf{d}| \\cos\\theta$. The lower-energy eigenstate $\\lvert u_{-}(\\mathbf{Q}) \\rangle$, corresponding to the spin projection $-1/2$ along $\\mathbf{d}$, can be written as\n$$\n\\lvert u_{-}(\\theta, \\varphi) \\rangle = \\begin{pmatrix} -\\sin(\\theta/2) e^{-i\\varphi} \\\\ \\cos(\\theta/2) \\end{pmatrix}.\n$$\nThis form is well-defined as long as $\\theta \\neq \\pi$.\n\nThe problem specifies a closed loop $\\mathcal{C}$ in the parameter space $\\mathbf{Q}$:\n$$\nQ_x(\\phi) = \\rho \\cos\\phi, \\quad Q_y(\\phi) = \\rho \\sin\\phi, \\quad Q_z(\\phi) = 0, \\quad \\phi \\in [0, 2\\pi].\n$$\nAlong this path, the components of the vector $\\mathbf{d}$ are:\n$$\nd_x(\\phi) = \\kappa \\rho \\cos\\phi, \\quad d_y(\\phi) = \\kappa \\rho \\sin\\phi, \\quad d_z(\\phi) = 0.\n$$\nThe magnitude of $\\mathbf{d}$ is constant along the loop: $|\\mathbf{d}(\\phi)| = \\sqrt{(\\kappa \\rho \\cos\\phi)^2 + (\\kappa \\rho \\sin\\phi)^2} = \\kappa \\rho$. Since $d_z = 0$, the polar angle $\\theta$ for the vector $\\mathbf{d}$ is fixed at $\\theta = \\pi/2$. The azimuthal angle $\\varphi$ is equal to the loop parameter $\\phi$. Thus, the loop $\\mathcal{C}$ in $\\mathbf{Q}$-space maps to a loop in the parameter space of the eigenvector where $\\theta = \\pi/2$ and $\\varphi$ varies from $0$ to $2\\pi$. Since $\\theta = \\pi/2 \\neq \\pi$, our choice of eigenvector is well-defined along the entire path.\n\nSubstituting $\\theta=\\pi/2$ and $\\varphi=\\phi$ into the expression for $\\lvert u_{-} \\rangle$, we get the eigenstate along the path $\\mathcal{C}$:\n$$\n\\lvert u_{-}(\\phi) \\rangle = \\begin{pmatrix} -\\sin(\\pi/4) e^{-i\\phi} \\\\ \\cos(\\pi/4) \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{-i\\phi} \\\\ 1 \\end{pmatrix}.\n$$\n\nPart 1: The geometric phase is given by the line integral $\\gamma_{-}[\\mathcal{C}] = \\oint_{\\mathcal{C}} \\mathbf{A}_{-}(\\mathbf{Q}) \\cdot d\\mathbf{Q}$. By parameterizing the path with $\\phi$, this integral becomes\n$$\n\\gamma_{-}[\\mathcal{C}] = \\int_0^{2\\pi} \\mathbf{A}_{-}(\\mathbf{Q}(\\phi)) \\cdot \\frac{d\\mathbf{Q}}{d\\phi} d\\phi.\n$$\nThe integrand is the component of the Berry connection along the path, which can be computed as $i \\langle u_{-}(\\phi) | \\frac{d}{d\\phi} u_{-}(\\phi) \\rangle$. Let's calculate this term. First, we find the derivative of the state vector with respect to $\\phi$:\n$$\n\\frac{d}{d\\phi} \\lvert u_{-}(\\phi) \\rangle = \\frac{d}{d\\phi} \\left[ \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{-i\\phi} \\\\ 1 \\end{pmatrix} \\right] = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -(-i)e^{-i\\phi} \\\\ 0 \\end{pmatrix} = \\frac{i}{\\sqrt{2}} \\begin{pmatrix} e^{-i\\phi} \\\\ 0 \\end{pmatrix}.\n$$\nThe bra vector is $\\langle u_{-}(\\phi) | = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi} & 1 \\end{pmatrix}$.\nNow we compute the inner product:\n$$\ni \\langle u_{-}(\\phi) | \\frac{d}{d\\phi} u_{-}(\\phi) \\rangle = i \\left[ \\frac{1}{\\sqrt{2}} \\begin{pmatrix} -e^{i\\phi} & 1 \\end{pmatrix} \\right] \\left[ \\frac{i}{\\sqrt{2}} \\begin{pmatrix} e^{-i\\phi} \\\\ 0 \\end{pmatrix} \\right] = i \\left( \\frac{i}{2} \\right) (-e^{i\\phi})(e^{-i\\phi}) = -\\frac{1}{2} (-1) = \\frac{1}{2}.\n$$\nThe geometric phase is the integral of this constant value over the interval $[0, 2\\pi]$:\n$$\n\\gamma_{-}[\\mathcal{C}] = \\int_0^{2\\pi} \\frac{1}{2} d\\phi = \\frac{1}{2} [\\phi]_0^{2\\pi} = \\frac{1}{2} (2\\pi - 0) = \\pi.\n$$\n\nPart 2: We now verify this result using the solid angle viewpoint. The vector $\\mathbf{d}(\\phi)$ traces a path in a three-dimensional auxiliary space. We consider the path traced by the corresponding unit vector $\\hat{\\mathbf{d}}(\\phi) = \\mathbf{d}(\\phi) / |\\mathbf{d}(\\phi)|$.\nAlong the loop $\\mathcal{C}$, we have $\\mathbf{d}(\\phi) = (\\kappa\\rho\\cos\\phi, \\kappa\\rho\\sin\\phi, 0)$ and $|\\mathbf{d}(\\phi)| = \\kappa\\rho$.\nThe unit vector is therefore\n$$\n\\hat{\\mathbf{d}}(\\phi) = (\\cos\\phi, \\sin\\phi, 0).\n$$\nAs $\\phi$ varies from $0$ to $2\\pi$, this vector traces out the equator on the unit sphere in the $\\mathbf{d}$-space. The solid angle $\\Omega[\\mathcal{C}]$ subtended by this closed loop at the origin is the area of the spherical cap enclosed by the loop. For a counter-clockwise traversal of the equator, the enclosed area is that of the northern hemisphere. The surface area of a unit sphere is $4\\pi$, so the area of a hemisphere is $2\\pi$.\n$$\n\\Omega[\\mathcal{C}] = 2\\pi \\text{ steradians}.\n$$\nFor a two-level system (a spin-$1/2$ system), the geometric phase $\\gamma$ is related to the solid angle $\\Omega$ by the formula $\\gamma = -m_s \\Omega$, where $m_s$ is the spin projection quantum number along the direction of $\\mathbf{d}$. The lower-energy state $\\lvert u_{-} \\rangle$ corresponds to the spin-down state with respect to the $\\mathbf{d}$ vector, so its spin projection is $m_s = -1/2$.\nUsing this formula, we can calculate the geometric phase:\n$$\n\\gamma_{-} = - \\left(-\\frac{1}{2}\\right) \\Omega[\\mathcal{C}] = \\frac{1}{2} (2\\pi) = \\pi.\n$$\nThis result is in perfect agreement with the value obtained in Part 1 by direct integration of the Berry connection. This confirms the consistency of the calculation. The accumulated geometric phase is $\\pi$ radians.",
            "answer": "$$\\boxed{\\pi}$$"
        },
        {
            "introduction": "While analytical calculations provide deep insight, many research scenarios demand numerical solutions. This final practice challenges you to bridge the gap between theory and computation by implementing a modern, gauge-invariant algorithm to calculate the Berry phase numerically. You will develop an adaptive scheme to ensure accuracy, a critical skill in computational physics and chemistry, and test it on loops that probe the topological singularity of a conical intersection. ",
            "id": "2642948",
            "problem": "Design and implement a program that computes the geometric phase (Berry phase) accumulated by an adiabatic eigenstate of a two-level model Hamiltonian along a closed loop in a two-dimensional nuclear coordinate space, and that adaptively controls discretization to ensure that the numerical uncertainty in the extracted phase is below a prescribed tolerance. The context is geometric phase effects near a conical intersection in physical chemistry.\n\nConsider the following two-level adiabatic model Hamiltonian parameterized by nuclear coordinates $x$ and $y$,\n$$\n\\hat{H}(x,y) \\;=\\; \\begin{pmatrix}\n\\alpha\\,(x-x_c) & \\beta\\,(y-y_c) \\\\\n\\beta\\,(y-y_c) & -\\alpha\\,(x-x_c)\n\\end{pmatrix},\n$$\nwhere $(x_c,y_c)$ is the location of the conical intersection, and $\\alpha$ and $\\beta$ are real constants. Assume $\\alpha=\\beta=1$. For any point $(x,y)$ not at the conical intersection, this Hamiltonian has two nondegenerate adiabatic eigenstates. The geometric phase (Berry phase) $\\gamma$ for the lower-energy adiabatic state transported adiabatically along a closed loop $\\mathcal{C}$ in the $(x,y)$-plane is defined by the line integral of the Berry connection, which is a property intrinsic to the loop and the adiabatic eigenbundle.\n\nYour tasks are:\n\n- Starting from the definition of the geometric phase for adiabatic evolution and the fact that it is a property of the projective Hilbert space, implement a gauge-invariant discretization consistent with the continuum definition that uses inner products (overlaps) of adjacent normalized adiabatic eigenvectors along a closed loop. Do not assume any special gauge; rely only on quantities that are invariant under local U(1) phase changes of the eigenvectors. Use $N$ equally spaced sampling points along the loop parameter (angle in radians).\n- Implement an adaptive scheme to choose $N$ that ensures the numerical uncertainty in the computed geometric phase is less than a target tolerance $\\delta_{\\mathrm{target}} = 0.05\\pi$ (radians). Begin from $N_0=16$ and refine by doubling $N$ until both of the following hold simultaneously:\n  1. The minimum magnitude of the adjacent-state overlaps along the loop is at least a threshold $\\tau$, i.e., $\\min_k \\left|\\langle u_k \\mid u_{k+1}\\rangle\\right| \\ge \\tau$, with $\\tau=0.995$.\n  2. The a posteriori uncertainty estimate, taken as the absolute difference between the geometric phases computed with $N$ and $2N$ points (with the phase wrapped to the principal branch), is less than or equal to $\\delta_{\\mathrm{target}}$.\n- If either condition fails at a given $N$, double $N$ and repeat, up to a maximum $N_{\\max}=16384$. If the conditions are not met at $N_{\\max}$, report the last estimate and flag that the tolerance was not met.\n- Angles must be expressed in radians. Report the geometric phase on the principal branch $[-\\pi,\\pi)$.\n\nParameterization of loops:\n- A circular loop with center $(x_0,y_0)$ and radius $r$ is given by $(x(\\theta), y(\\theta)) = (x_0 + r\\cos\\theta,\\, y_0 + r\\sin\\theta)$ for $\\theta \\in [0,2\\pi)$.\n- An elliptical loop with center $(x_0,y_0)$ and semiaxes $a$ and $b$ is given by $(x(\\theta), y(\\theta)) = (x_0 + a\\cos\\theta,\\, y_0 + b\\sin\\theta)$ for $\\theta \\in [0,2\\pi)$.\n\nTest suite:\nImplement and run your algorithm for the following five test cases, each defined by $(x_c,y_c)$, the loop type and parameters. In all cases, use $\\alpha=\\beta=1$.\n\n- Test $1$ (enclosing conical intersection, circle): $(x_c,y_c)=(0,0)$, loop type: circle, center $(x_0,y_0)=(0,0)$, radius $r=1$.\n- Test $2$ (not enclosing, circle): $(x_c,y_c)=(0,0)$, loop type: circle, center $(x_0,y_0)=(2,0)$, radius $r=0.5$.\n- Test $3$ (enclosing conical intersection, ellipse): $(x_c,y_c)=(0,0)$, loop type: ellipse, center $(x_0,y_0)=(0,0)$, semiaxes $a=1.5$, $b=0.5$.\n- Test $4$ (near miss, circle): $(x_c,y_c)=(0,0)$, loop type: circle, center $(x_0,y_0)=(0.55,0)$, radius $r=0.5$.\n- Test $5$ (shifted conical intersection, enclosing, circle): $(x_c,y_c)=(0.3,-0.2)$, loop type: circle, center $(x_0,y_0)=(0.3,-0.2)$, radius $r=0.25$.\n\nFor each test case, your program must produce a result consisting of a list with three entries:\n- the estimated geometric phase $\\gamma$ in radians on $[-\\pi,\\pi)$, rounded to $6$ decimal places,\n- the estimated uncertainty $\\Delta\\gamma$ in radians, rounded to $6$ decimal places,\n- a boolean indicating whether $\\Delta\\gamma \\le 0.05\\pi$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of the per-test-case lists, enclosed in square brackets. For example, a valid output structure is\n$[$$[\\gamma_1,\\Delta\\gamma_1,\\mathrm{ok}_1]$, $[\\gamma_2,\\Delta\\gamma_2,\\mathrm{ok}_2]$, $\\dots$$]$,\nwith all angles in radians. No additional text should be printed.",
            "solution": "The user has provided a valid, well-posed problem in computational physical chemistry. The task is to design and implement a program to compute the geometric phase (Berry phase) for a two-level quantum system described by a model Hamiltonian, with an adaptive numerical scheme to ensure a target accuracy.\n\nThe problem is scientifically grounded, based on the established principles of quantum mechanics concerning adiabatic evolution and geometric phases near conical intersections. The mathematical and numerical specifications are complete and internally consistent, allowing for a unique and verifiable solution.\n\nThe program will be developed following a principled, step-by-step approach as outlined below.\n\n**1. The Model Hamiltonian and its Eigenstates**\n\nThe system is described by a two-level model Hamiltonian parameterized by nuclear coordinates $(x,y)$:\n$$\n\\hat{H}(x,y) \\;=\\; \\begin{pmatrix}\n\\alpha\\,(x-x_c) & \\beta\\,(y-y_c) \\\\\n\\beta\\,(y-y_c) & -\\alpha\\,(x-x_c)\n\\end{pmatrix}\n$$\nHere, $(x_c,y_c)$ is the location of the conical intersection, where the two energy levels become degenerate. The constants are given as $\\alpha=1$ and $\\beta=1$. Let us define shifted coordinates $q_x = x-x_c$ and $q_y = y-y_c$. The Hamiltonian simplifies to:\n$$\n\\hat{H}(q_x,q_y) \\;=\\; \\begin{pmatrix}\nq_x & q_y \\\\\nq_y & -q_x\n\\end{pmatrix}\n$$\nThe eigenvalues $E$ are found by solving the characteristic equation $\\det(\\hat{H} - E\\hat{I})=0$, which yields $E^2 = q_x^2 + q_y^2$. The two adiabatic energy levels are:\n$$\nE_\\pm(q_x,q_y) \\;=\\; \\pm\\sqrt{q_x^2 + q_y^2}\n$$\nThese levels are degenerate only at the conical intersection, where $q_x=q_y=0$. The problem requires us to consider the lower-energy adiabatic state, corresponding to the eigenvalue $E_-(q_x,q_y)$. At each point $(x,y)$ on a given loop, we find the corresponding normalized eigenvector $|u_-\\rangle$ by numerically diagonalizing the Hamiltonian matrix $\\hat{H}(x,y)$.\n\n**2. Numerical Computation of the Geometric Phase**\n\nThe geometric phase $\\gamma$ accumulated by an eigenstate transported adiabatically along a closed loop $\\mathcal{C}$ can be formulated in a gauge-invariant manner suitable for numerical computation. The path $\\mathcal{C}$ is discretized into $N$ ordered points, $\\{R_1, R_2, \\dots, R_N\\}$. At each point $R_k$, we compute the normalized lower-energy eigenvector $|u_k\\rangle$. The total geometric phase is the argument of the product of the complex inner products (overlaps) of adjacent eigenvectors along the loop:\n$$\n\\gamma_N = \\mathrm{arg}\\left( \\langle u_1|u_2\\rangle \\langle u_2|u_3\\rangle \\cdots \\langle u_{N-1}|u_N\\rangle \\langle u_N|u_1\\rangle \\right) = \\mathrm{arg}\\left(\\prod_{k=1}^N \\langle u_k|u_{k+1}\\rangle\\right)\n$$\nwhere the index is cyclic, i.e., $|u_{N+1}\\rangle \\equiv |u_1\\rangle$. This expression, known as the Pancharatnam connection, is invariant under independent local phase transformations of the eigenvectors $|u_k\\rangle \\to e^{i\\phi_k}|u_k\\rangle$, making it robust for numerical implementation where eigenvector phases from standard diagonalization routines are not guaranteed to be smooth. The phase will be reported on the principal branch $[-\\pi, \\pi)$.\n\n**3. Adaptive Discretization Algorithm**\n\nTo ensure the numerical result is accurate, an adaptive scheme is implemented to choose the number of discretization points $N$. The algorithm starts with an initial value $N=N_0=16$ and iteratively refines the grid by doubling $N$ until convergence criteria are met, up to a maximum of $N_{\\max}=16384$.\n\nAt each iteration with a given discretization $N$, two conditions must be satisfied simultaneously for convergence:\n1.  **Sufficient State Overlap**: The discretization must be fine enough that adjacent eigenvectors are nearly parallel. This is quantified by requiring the minimum magnitude of adjacent overlaps to be above a threshold $\\tau=0.995$:\n    $$\n    \\min_{k \\in \\{1,\\dots,N\\}} \\left|\\langle u_k | u_{k+1}\\rangle\\right| \\ge \\tau\n    $$\n2.  **Uncertainty Tolerance**: The a posteriori estimate of the numerical uncertainty, taken as the absolute difference between the phases computed with $N$ and $2N$ points, must be below a target tolerance $\\delta_{\\mathrm{target}} = 0.05\\pi$:\n    $$\n    \\Delta\\gamma_N = |\\mathrm{wrap}(\\gamma_N - \\gamma_{2N})| \\le \\delta_{\\mathrm{target}}\n    $$\n    The `wrap` function maps the phase difference to the principal branch $[-\\pi, \\pi)$ before taking the absolute value, correctly handling phase wrapping.\n\nThe adaptive loop proceeds as follows: for $N = 16, 32, 64, \\dots, 16384$:\n- Compute $\\gamma_N$ and the minimum overlap for $N$ points.\n- Compute $\\gamma_{2N}$ for the uncertainty estimation.\n- Check if both convergence criteria are met.\n- If they are met, the algorithm terminates. The final reported phase is the more accurate $\\gamma_{2N}$, and the uncertainty is $\\Delta\\gamma_N$.\n- If the criteria are not met, $N$ is doubled and the process repeats.\n- If $N=N_{\\max}$ is reached and the criteria are still not met, the algorithm terminates and flags that the tolerance was not achieved, reporting the last computed values for the phase and uncertainty.\n\nThis procedure ensures that the calculated geometric phase is reliable and meets the prescribed accuracy, adapting the computational effort to the specific difficulty of each test case (e.g., loops passing close to the conical intersection require a finer grid).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases\n    and prints the final result in the specified format.\n    \"\"\"\n\n    # Define global constants as specified in the problem statement\n    ALPHA = 1.0\n    BETA = 1.0\n    DELTA_TARGET = 0.05 * np.pi\n    TAU = 0.995\n    N0 = 16\n    N_MAX = 16384\n\n    def wrap_phase(p):\n        \"\"\"Wraps a phase to the principal branch [-pi, pi).\"\"\"\n        return (p + np.pi) % (2 * np.pi) - np.pi\n\n    def get_loop_points(loop_params, N):\n        \"\"\"Generates N points on the specified loop.\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        points = np.zeros((N, 2))\n        x0, y0 = loop_params['center']\n        if loop_params['type'] == 'circle':\n            r = loop_params['r']\n            points[:, 0] = x0 + r * np.cos(thetas)\n            points[:, 1] = y0 + r * np.sin(thetas)\n        elif loop_params['type'] == 'ellipse':\n            a = loop_params['a']\n            b = loop_params['b']\n            points[:, 0] = x0 + a * np.cos(thetas)\n            points[:, 1] = y0 + b * np.sin(thetas)\n        return points\n\n    def compute_gamma_and_overlap(loop_params, N):\n        \"\"\"\n        Computes the geometric phase and minimum adjacent overlap for a given loop\n        and discretization N.\n        \"\"\"\n        if N == 0:\n            return 0.0, 1.0\n\n        points = get_loop_points(loop_params, N)\n        \n        evecs = []\n        xc, yc = loop_params['ci_pos']\n        for x, y in points:\n            qx = ALPHA * (x - xc)\n            qy = BETA * (y - yc)\n            H = np.array([[qx, qy], [qy, -qx]], dtype=np.float64)\n            # Use eigh for real symmetric matrices. Eigenvalues are sorted.\n            # The first eigenvector corresponds to the lower energy state.\n            _eigvals, eigvecs_matrix = np.linalg.eigh(H)\n            evecs.append(eigvecs_matrix[:, 0])\n\n        total_overlap_product = 1.0 + 0.0j\n        min_abs_overlap = 1.0\n        for k in range(N):\n            u_k = evecs[k]\n            u_k_plus_1 = evecs[(k + 1) % N]  # Ensures loop closure u_{N} -> u_{0}\n            overlap = np.vdot(u_k, u_k_plus_1) # Conjugate dot product\n            total_overlap_product *= overlap\n            min_abs_overlap = min(min_abs_overlap, abs(overlap))\n\n        # The geometric phase is the argument of the total product\n        gamma = np.angle(total_overlap_product)\n        \n        return gamma, min_abs_overlap\n\n    def adaptive_gamma_calculation(loop_params):\n        \"\"\"\n        Implements the adaptive scheme to compute the geometric phase by iteratively\n        refining the grid discretization until convergence criteria are met.\n        \"\"\"\n        N = N0\n        \n        while N <= N_MAX:\n            # Compute gamma and min_overlap for the current discretization N\n            gamma_N, min_overlap_N = compute_gamma_and_overlap(loop_params, N)\n\n            # Compute gamma with a finer grid (2N) for the uncertainty estimate\n            gamma_2N, _ = compute_gamma_and_overlap(loop_params, 2 * N)\n            \n            # Uncertainty is the absolute value of the wrapped phase difference\n            delta_gamma = abs(wrap_phase(gamma_N - gamma_2N))\n            \n            # Check convergence criteria for discretization N\n            converged_overlap = min_overlap_N >= TAU\n            converged_delta = delta_gamma <= DELTA_TARGET\n\n            # If both conditions are met, convergence is achieved.\n            # The result is the more accurate phase from the 2N calculation.\n            if converged_overlap and converged_delta:\n                final_gamma = wrap_phase(gamma_2N)\n                return [round(final_gamma, 6), round(delta_gamma, 6), True]\n\n            # If at the max number of iterations and not converged, report failure.\n            if N == N_MAX:\n                final_gamma = wrap_phase(gamma_2N)\n                return [round(final_gamma, 6), round(delta_gamma, 6), False]\n\n            # If not converged, double N for the next iteration.\n            N *= 2\n            \n        # This part should be unreachable given the loop condition.\n        return [0.0, 0.0, False]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1 (enclosing conical intersection, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (0.0, 0.0), 'r': 1.0},\n        # Test 2 (not enclosing, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (2.0, 0.0), 'r': 0.5},\n        # Test 3 (enclosing conical intersection, ellipse)\n        {'ci_pos': (0.0, 0.0), 'type': 'ellipse', 'center': (0.0, 0.0), 'a': 1.5, 'b': 0.5},\n        # Test 4 (near miss, circle)\n        {'ci_pos': (0.0, 0.0), 'type': 'circle', 'center': (0.55, 0.0), 'r': 0.5},\n        # Test 5 (shifted conical intersection, enclosing, circle)\n        {'ci_pos': (0.3, -0.2), 'type': 'circle', 'center': (0.3, -0.2), 'r': 0.25},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = adaptive_gamma_calculation(case)\n        results.append(result)\n\n    # Format the final output string exactly as required by the problem.\n    formatted_results = []\n    for r in results:\n        # Convert boolean to lowercase string 'true' or 'false'\n        r_str = f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\"\n        formatted_results.append(r_str)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}