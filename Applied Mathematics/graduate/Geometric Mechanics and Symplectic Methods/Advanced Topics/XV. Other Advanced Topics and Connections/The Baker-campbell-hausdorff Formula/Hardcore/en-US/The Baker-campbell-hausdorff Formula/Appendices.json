{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a concrete entry point into the Baker-Campbell-Hausdorff formula by grounding it in the familiar context of matrix Lie algebras. You will explore a special case involving nilpotent matrices, which simplifies the exponential and logarithm maps to finite polynomials, making the composition of flows directly computable. This practice illuminates the fundamental principle that when Lie algebra elements commute, the BCH formula reduces to simple addition, providing a crucial baseline for understanding more complex, non-commuting scenarios .",
            "id": "3773113",
            "problem": "Consider the canonical symplectic vector space with coordinates $(q,p) \\in \\mathbb{R}^{2}$ and canonical symplectic form $\\omega = dq \\wedge dp$. A linear Hamiltonian system on this phase space is generated by a quadratic Hamiltonian $H(q,p) = \\frac{1}{2} (q,p) S (q,p)^\\top$, where $S$ is a real symmetric $2 \\times 2$ matrix, and its phase flow is represented by the matrix exponential $\\exp(t X)$ where $X = J S$ with $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$. Suppose $S_{X} = \\begin{pmatrix} 0  0 \\\\ 0  a \\end{pmatrix}$ and $S_{Y} = \\begin{pmatrix} 0  0 \\\\ 0  b \\end{pmatrix}$ with real parameters $a$ and $b$, so that the corresponding Hamiltonian matrices are $X = J S_{X}$ and $Y = J S_{Y}$, which are $2 \\times 2$ upper triangular nilpotent matrices. \n\nStarting from the definitions of the matrix exponential $\\exp(A) = \\sum_{k=0}^{\\infty} \\frac{1}{k!} A^{k}$, the matrix logarithm $\\log(I + B) = \\sum_{k=1}^{\\infty} \\frac{(-1)^{k+1}}{k} B^{k}$ when $\\|B\\|$ is sufficiently small, and the Lie bracket $[A,B] = AB - BA$, and using only the algebraic properties of nilpotent matrices and the Lie algebra of Hamiltonian matrices, do the following:\n\n1. Compute the product $\\exp(X) \\exp(Y)$ explicitly and then compute $Z = \\log(\\exp(X) \\exp(Y))$ in closed form.\n2. Explain, in the setting of this Lie algebra generated by $2 \\times 2$ upper triangular nilpotent matrices, why the Baker-Campbell-Hausdorff series has no terms beyond degree two in nested commutators, and identify the associated quadratic Hamiltonian matrix $S_{Z}$ such that $Z = J S_{Z}$.\n3. Provide the final expression for the $2 \\times 2$ matrix $Z$ as a single analytic expression in terms of $a$ and $b$.\n\nYour final answer must be a single closed-form expression. No numerical approximation or rounding is required.",
            "solution": "The problem statement has been validated as scientifically grounded, well-posed, and objective. It is based on standard definitions from Hamiltonian mechanics and Lie algebra theory. All necessary data and definitions are provided, and there are no internal contradictions. The problem is a specific, solvable case study of the Baker-Campbell-Hausdorff (BCH) formula for a simple Lie algebra.\n\nThe problem requires us to perform computations and provide explanations related to the composition of flows for linear Hamiltonian systems. We are given two Hamiltonian matrices, $X$ and $Y$, defined via symmetric matrices $S_X$ and $S_Y$ and the standard symplectic matrix $J$.\n\nFirst, we explicitly compute the matrices $X$ and $Y$.\nThe matrix $J$ is given as $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$.\nThe symmetric matrices are $S_{X} = \\begin{pmatrix} 0  0 \\\\ 0  a \\end{pmatrix}$ and $S_{Y} = \\begin{pmatrix} 0  0 \\\\ 0  b \\end{pmatrix}$.\nThe corresponding Hamiltonian matrices are $X = J S_{X}$ and $Y = J S_{Y}$.\n\n$X = J S_{X} = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 0  a \\end{pmatrix} = \\begin{pmatrix} 0 \\cdot 0 + 1 \\cdot 0  0 \\cdot 0 + 1 \\cdot a \\\\ -1 \\cdot 0 + 0 \\cdot 0  -1 \\cdot 0 + 0 \\cdot a \\end{pmatrix} = \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix}$.\n\n$Y = J S_{Y} = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 0  b \\end{pmatrix} = \\begin{pmatrix} 0 \\cdot 0 + 1 \\cdot 0  0 \\cdot 0 + 1 \\cdot b \\\\ -1 \\cdot 0 + 0 \\cdot 0  -1 \\cdot 0 + 0 \\cdot b \\end{pmatrix} = \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix}$.\n\nAs stated in the problem, these are indeed $2 \\times 2$ upper triangular nilpotent matrices. We can verify their nilpotency:\n$X^2 = \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\n$Y^2 = \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\nSince $X^2$ and $Y^2$ (and all higher powers) are the zero matrix, the infinite series for the matrix exponential terminates.\n\n1. We compute $\\exp(X)$, $\\exp(Y)$, their product, and its logarithm.\nUsing the definition $\\exp(A) = \\sum_{k=0}^{\\infty} \\frac{1}{k!} A^{k} = I + A + \\frac{1}{2!}A^2 + \\dots$:\n$\\exp(X) = I + X + \\frac{1}{2!}X^2 + \\dots = I + X = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  a \\\\ 0  1 \\end{pmatrix}$.\n$\\exp(Y) = I + Y = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 1  b \\\\ 0  1 \\end{pmatrix}$.\n\nNext, we compute the product $P = \\exp(X) \\exp(Y)$:\n$P = \\begin{pmatrix} 1  a \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  b \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 1 \\cdot 1 + a \\cdot 0  1 \\cdot b + a \\cdot 1 \\\\ 0 \\cdot 1 + 1 \\cdot 0  0 \\cdot b + 1 \\cdot 1 \\end{pmatrix} = \\begin{pmatrix} 1  a+b \\\\ 0  1 \\end{pmatrix}$.\n\nNow, we compute $Z = \\log(\\exp(X) \\exp(Y)) = \\log(P)$. We use the definition $\\log(I + B) = \\sum_{k=1}^{\\infty} \\frac{(-1)^{k+1}}{k} B^{k}$.\nLet $B = P - I = \\begin{pmatrix} 1  a+b \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix}$.\nThe matrix $B$ is also nilpotent: $B^2 = \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\nTherefore, the series for the logarithm terminates:\n$Z = \\log(I+B) = B - \\frac{1}{2}B^2 + \\frac{1}{3}B^3 - \\dots = B$.\nSo, $Z = \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix}$.\n\n2. We explain the behavior of the Baker-Campbell-Hausdorff series and find $S_Z$.\nThe general BCH formula is $Z = \\log(\\exp(X)\\exp(Y)) = X + Y + \\frac{1}{2}[X,Y] + \\frac{1}{12}([X,[X,Y]] - [Y,[X,Y]]) + \\dots$.\nThe Lie algebra in question consists of matrices of the form $\\begin{pmatrix} 0  c \\\\ 0  0 \\end{pmatrix}$ for $c \\in \\mathbb{R}$. Both $X$ and $Y$ belong to this algebra. Let's compute their Lie bracket $[X,Y] = XY - YX$:\n$XY = \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\n$YX = \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\nThus, $[X,Y] = 0$. The Lie algebra is abelian.\n\nSince the first-order commutator $[X,Y]$ is the zero matrix, all higher-order nested commutators, which are constructed from $[X,Y]$, must also be zero. For example, $[X,[X,Y]] = [X,0] = 0$.\nConsequently, every term in the BCH series of degree two and higher vanishes. The series truncates to its first-degree terms:\n$Z = X + Y$.\nThis provides the explanation for why there are no terms beyond degree two (and, more precisely, no terms beyond degree one). The simplified formula is consistent with our direct calculation:\n$X+Y = \\begin{pmatrix} 0  a \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} 0  b \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix} = Z$.\n\nNow we identify the associated symmetric matrix $S_Z$ such that $Z = J S_Z$. We need to solve for $S_Z$:\n$S_Z = J^{-1} Z$.\nThe inverse of $J$ is $J^{-1} = \\begin{pmatrix} 0  -1 \\\\ 1  0 \\end{pmatrix} = -J$.\n$S_Z = -J Z = - \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix} = - \\begin{pmatrix} 0  0 \\\\ 0  -(a+b) \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  a+b \\end{pmatrix}$.\nThe resulting matrix $S_Z$ is indeed symmetric and has the same form as $S_X$ and $S_Y$. The associated Hamiltonian is $H_Z = \\frac{1}{2} (a+b) p^2$, which is the sum of the Hamiltonians $H_X = \\frac{1}{2} a p^2$ and $H_Y = \\frac{1}{2} b p^2$. This is expected, as the flows commute.\n\n3. The final expression for the $2 \\times 2$ matrix $Z$ is the result of our calculation in the first part.\n$Z = \\begin{pmatrix} 0  a+b \\\\ 0  0 \\end{pmatrix}$.\nThis is a single closed-form expression for the matrix $Z$ in terms of the parameters $a$ and $b$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  a+b \\\\\n0  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Building on the commuting case, this exercise delves into the heart of the Baker-Campbell-Hausdorff formula's complexity: the non-commuting scenario. By manually expanding the exponential and logarithm series, you will derive the famous degree-three correction terms, including the ubiquitous coefficients $\\frac{1}{12}$ and $-\\frac{1}{12}$. This foundational calculation is a rite of passage, offering deep insight into how the non-commutativity of the Lie algebra generates the higher-order structure of the composed flow .",
            "id": "3773135",
            "problem": "Consider a connected Lie group of symplectomorphisms generated by Hamiltonian vector fields on a symplectic manifold, and let $X$ and $Y$ denote two elements in the Lie algebra of smooth vector fields that preserve the symplectic form. The exponential map $\\exp$ is defined by the formal power series in the universal enveloping algebra, and $\\ln$ denotes its formal inverse. Let $Z$ be the unique Lie element such that\n$$\n\\exp(X)\\exp(Y)=\\exp(Z).\n$$\nWorking formally in the completed free associative algebra on $\\{X,Y\\}$ with its induced Lie bracket $[A,B]=AB-BA$, and using only the fundamental properties of the exponential and logarithm power series together with linearity and bilinearity of the Lie bracket, determine the real numbers $b$ and $c$ such that the degree-$3$ part of $Z$ is\n$$\nb\\,[X,[X,Y]]+c\\,[Y,[X,Y]],\n$$\nwhen $Z$ is written as a Lie series up to and including all terms of total degree $3$ in $\\{X,Y\\}$.\n\nYour derivation must proceed by expanding both sides of $\\exp(X)\\exp(Y)=\\exp(Z)$ as formal series, matching coefficients of all noncommutative words of length at most $3$, and using only combinatorial identities that follow from the binomial expansion of $(X+Y)^{n}$ and the definition of the commutator bracket. Do not assume any closed-form of the Baker-Campbell-Hausdorff series.\n\nProvide your final answer as the ordered pair $(b,c)$. No rounding is required, and no units are involved. The final answer must be a single analytic expression.",
            "solution": "The problem requires the determination of the coefficients $b$ and $c$ in the degree-$3$ part of the Baker-Campbell-Hausdorff (BCH) series. The BCH formula provides the solution $Z$ to the equation $\\exp(X)\\exp(Y) = \\exp(Z)$ for non-commuting $X$ and $Y$. The solution $Z$ can be expressed as a formal series in $X$ and $Y$ involving nested commutators. We can write $Z = \\ln(\\exp(X)\\exp(Y))$.\n\nThe derivation will proceed by expanding the exponential and logarithm functions as formal power series in the free associative algebra generated by $X$ and $Y$. The exponential and logarithm series are given by:\n$$ \\exp(A) = \\sum_{n=0}^{\\infty} \\frac{1}{n!}A^n = 1 + A + \\frac{1}{2}A^2 + \\frac{1}{6}A^3 + \\dots $$\n$$ \\ln(1+U) = \\sum_{n=1}^{\\infty} \\frac{(-1)^{n-1}}{n}U^n = U - \\frac{1}{2}U^2 + \\frac{1}{3}U^3 - \\dots $$\nwhere the algebra is non-commutative.\n\nLet $U = \\exp(X)\\exp(Y) - 1$. We expand $\\exp(X)$ and $\\exp(Y)$ up to terms of total degree $3$:\n$$ \\exp(X) = 1 + X + \\frac{1}{2}X^2 + \\frac{1}{6}X^3 + \\mathcal{O}(4) $$\n$$ \\exp(Y) = 1 + Y + \\frac{1}{2}Y^2 + \\frac{1}{6}Y^3 + \\mathcal{O}(4) $$\nTheir product is:\n$$ \\exp(X)\\exp(Y) = \\left(1 + X + \\frac{1}{2}X^2 + \\frac{1}{6}X^3\\right) \\left(1 + Y + \\frac{1}{2}Y^2 + \\frac{1}{6}Y^3\\right) + \\mathcal{O}(4) $$\nExpanding this product and retaining terms up to degree $3$:\n$$ \\exp(X)\\exp(Y) = 1 + (X+Y) + \\left(\\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2\\right) + \\left(\\frac{1}{6}X^3 + \\frac{1}{2}X^2Y + \\frac{1}{2}XY^2 + \\frac{1}{6}Y^3\\right) + \\mathcal{O}(4) $$\nFrom this, we define $U$ and its homogeneous components $U_k$ of degree $k$:\n$$ U = U_1 + U_2 + U_3 + \\mathcal{O}(4) $$\nwhere\n$$ U_1 = X+Y $$\n$$ U_2 = \\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2 $$\n$$ U_3 = \\frac{1}{6}X^3 + \\frac{1}{2}X^2Y + \\frac{1}{2}XY^2 + \\frac{1}{6}Y^3 $$\n\nNow, we compute $Z = \\ln(1+U)$ up to degree $3$. Let $Z=Z_1+Z_2+Z_3+\\mathcal{O}(4)$, where $Z_k$ is the homogeneous part of degree $k$. The expansion of the logarithm gives:\n$$ Z = (U_1+U_2+U_3+\\dots) - \\frac{1}{2}(U_1+U_2+\\dots)^2 + \\frac{1}{3}(U_1+\\dots)^3 - \\dots $$\nWe collect terms by degree:\nDegree $1$:\n$$ Z_1 = U_1 = X+Y $$\nDegree $2$:\n$$ Z_2 = U_2 - \\frac{1}{2}U_1^2 $$\nSubstituting $U_1$ and $U_2$:\n$$ Z_2 = \\left(\\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2\\right) - \\frac{1}{2}(X+Y)^2 $$\n$$ Z_2 = \\left(\\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2\\right) - \\frac{1}{2}(X^2 + XY + YX + Y^2) $$\n$$ Z_2 = \\frac{1}{2}XY - \\frac{1}{2}YX = \\frac{1}{2}[X,Y] $$\nDegree $3$:\n$$ Z_3 = U_3 - \\frac{1}{2}(U_1U_2 + U_2U_1) + \\frac{1}{3}U_1^3 $$\nTo compute $Z_3$, we need the products $U_1U_2$, $U_2U_1$, and $U_1^3$:\n$$ U_1U_2 = (X+Y)\\left(\\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2\\right) = \\frac{1}{2}X^3 + X^2Y + \\frac{1}{2}XY^2 + \\frac{1}{2}YX^2 + YXY + \\frac{1}{2}Y^3 $$\n$$ U_2U_1 = \\left(\\frac{1}{2}X^2 + XY + \\frac{1}{2}Y^2\\right)(X+Y) = \\frac{1}{2}X^3 + \\frac{1}{2}X^2Y + XYX + XY^2 + \\frac{1}{2}Y^2X + \\frac{1}{2}Y^3 $$\n$$ U_1^3 = (X+Y)^3 = (X^2+XY+YX+Y^2)(X+Y) = X^3+X^2Y+XYX+XY^2+YX^2+YXY+Y^2X+Y^3 $$\nNow we substitute these into the expression for $Z_3$. We proceed by finding the coefficient of each non-commutative monomial of degree $3$:\n- For $X^3$: $c(X^3) = \\frac{1}{6} - \\frac{1}{2}(\\frac{1}{2}+\\frac{1}{2}) + \\frac{1}{3}(1) = \\frac{1}{6} - \\frac{1}{2} + \\frac{1}{3} = 0$.\n- For $Y^3$: $c(Y^3) = \\frac{1}{6} - \\frac{1}{2}(\\frac{1}{2}+\\frac{1}{2}) + \\frac{1}{3}(1) = \\frac{1}{6} - \\frac{1}{2} + \\frac{1}{3} = 0$.\n- For $X^2Y$: $c(X^2Y) = \\frac{1}{2} - \\frac{1}{2}(1+\\frac{1}{2}) + \\frac{1}{3}(1) = \\frac{1}{2} - \\frac{3}{4} + \\frac{1}{3} = \\frac{6-9+4}{12} = \\frac{1}{12}$.\n- For $XYX$: $c(XYX) = 0 - \\frac{1}{2}(0+1) + \\frac{1}{3}(1) = -\\frac{1}{2} + \\frac{1}{3} = -\\frac{1}{6}$.\n- For $YX^2$: $c(YX^2) = 0 - \\frac{1}{2}(\\frac{1}{2}+0) + \\frac{1}{3}(1) = -\\frac{1}{4} + \\frac{1}{3} = \\frac{1}{12}$.\n- For $XY^2$: $c(XY^2) = \\frac{1}{2} - \\frac{1}{2}(\\frac{1}{2}+1) + \\frac{1}{3}(1) = \\frac{1}{2} - \\frac{3}{4} + \\frac{1}{3} = \\frac{1}{12}$.\n- For $YXY$: $c(YXY) = 0 - \\frac{1}{2}(1+0) + \\frac{1}{3}(1) = -\\frac{1}{2} + \\frac{1}{3} = -\\frac{1}{6}$.\n- For $Y^2X$: $c(Y^2X) = 0 - \\frac{1}{2}(0+\\frac{1}{2}) + \\frac{1}{3}(1) = -\\frac{1}{4} + \\frac{1}{3} = \\frac{1}{12}$.\n\nCombining these coefficients, we get the expression for $Z_3$:\n$$ Z_3 = \\frac{1}{12}X^2Y - \\frac{1}{6}XYX + \\frac{1}{12}YX^2 + \\frac{1}{12}XY^2 - \\frac{1}{6}YXY + \\frac{1}{12}Y^2X $$\nThe problem states that this can be written as a linear combination of the basis elements for degree-$3$ Lie polynomials, $[X,[X,Y]]$ and $[Y,[X,Y]]$. Let's express these basis elements in the associative algebra:\n$$ [X,[X,Y]] = X(XY-YX) - (XY-YX)X = X^2Y - XYX - XYX + YX^2 = X^2Y - 2XYX + YX^2 $$\n$$ [Y,[X,Y]] = Y(XY-YX) - (XY-YX)Y = YXY - Y^2X - XY^2 + YXY = -XY^2 + 2YXY - Y^2X $$\nWe are looking for coefficients $b$ and $c$ such that:\n$$ Z_3 = b\\,[X,[X,Y]] + c\\,[Y,[X,Y]] $$\n$$ Z_3 = b(X^2Y - 2XYX + YX^2) + c(-XY^2 + 2YXY - Y^2X) $$\n$$ Z_3 = b\\,X^2Y - c\\,XY^2 + b\\,YX^2 - c\\,Y^2X - 2b\\,XYX + 2c\\,YXY $$\nComparing the coefficients of this expression with our calculated expression for $Z_3$:\n$$ Z_3 = \\frac{1}{12}X^2Y + \\frac{1}{12}XY^2 + \\frac{1}{12}YX^2 + \\frac{1}{12}Y^2X - \\frac{1}{6}XYX - \\frac{1}{6}YXY $$\nwe can set up a system of equations by matching the coefficients of corresponding monomials:\n- $X^2Y$: $b = \\frac{1}{12}$\n- $XY^2$: $-c = \\frac{1}{12} \\implies c = -\\frac{1}{12}$\n- $YX^2$: $b = \\frac{1}{12}$\n- $Y^2X$: $-c = \\frac{1}{12} \\implies c = -\\frac{1}{12}$\n- $XYX$: $-2b = -\\frac{1}{6} \\implies b = \\frac{1}{12}$\n- $YXY$: $2c = -\\frac{1}{6} \\implies c = -\\frac{1}{12}$\n\nAll equations consistently yield the same values for $b$ and $c$. Therefore, the coefficients are $b = \\frac{1}{12}$ and $c = -\\frac{1}{12}$. The ordered pair $(b,c)$ is $(\\frac{1}{12}, -\\frac{1}{12})$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1}{12}  -\\frac{1}{12} \\end{pmatrix}}$$"
        },
        {
            "introduction": "This final practice transitions from manual calculation to a powerful, systematic approach for constructing the BCH series to any desired order. You will design and implement an algorithm that leverages the elegant combinatorial structure of the free Lie algebra, using concepts like Lyndon words and the Hall basis. This computational exercise demonstrates how the abstract theory of Lie series can be transformed into a practical tool for high-precision calculations, essential for applications like the backward error analysis of symplectic integrators .",
            "id": "3773139",
            "problem": "Consider the free Lie algebra generated by two symbols $X$ and $Y$ over the field of rational numbers. Let the underlying free associative algebra be the noncommutative polynomial algebra in $X$ and $Y$, and define the commutator of two elements $A$ and $B$ by $[A,B] = AB - BA$. The Baker-Campbell-Hausdorff (BCH) series $Z = \\log(\\exp(X)\\exp(Y))$ arises in geometric mechanics and symplectic methods when composing flows of Hamiltonian vector fields; it is the Lie series that encodes the generator of the composed flow.\n\nYour task is to design and implement an algorithm to compute the BCH coefficients up to a prescribed truncation degree $N$, expressed in the Hall basis constructed from Lyndon words on the ordered alphabet $\\{X,Y\\}$ with $X \\lt Y$. The algorithm must start from the following fundamental definitions:\n\n- The free associative algebra on generators $X$ and $Y$, with concatenation as multiplication.\n- The exponential of $X$ in the associative algebra, truncated at total degree $N$, is $\\exp(X) = \\sum_{k=0}^{N} \\frac{X^k}{k!}$, and similarly $\\exp(Y) = \\sum_{k=0}^{N} \\frac{Y^k}{k!}$.\n- The logarithm of an associative element $S$ close to the identity is given by the formal series $\\log(S) = \\sum_{m=1}^{N} \\frac{(-1)^{m+1}}{m} (S - I)^m$, truncated at total degree $N$, where $I$ is the multiplicative identity (the empty word).\n- A Lyndon word $w$ is defined by the property that $w$ is strictly smaller in lexicographic order than any of its nontrivial proper suffixes. The Lyndon-Hall basis uses the standard bracketing on Lyndon words: for a Lyndon word $w$ with its standard factorization $w = uv$ where $v$ is the longest proper Lyndon suffix, define the bracket recursively by $[w] = [[u],[v]]$, with $[X] = X$ and $[Y] = Y$.\n\nYou must:\n1. Construct all Lyndon words up to degree $N$ over $\\{X,Y\\}$ using the order $X \\lt Y$.\n2. Compute the truncated associative series $S_N = \\exp(X)\\exp(Y)$ up to total degree $N$.\n3. Compute $Z_N = \\log(S_N)$ as a truncated associative series of words of length at most $N$.\n4. Implement the recursive nested commutator expansion of $[w]$ for each Lyndon word $w$ using the standard factorization to obtain its associative expansion in terms of words.\n5. Use the triangular structure of the Lyndon-Hall basis with respect to lexicographic order to solve for the BCH coefficients $c_w$ in the expansion $Z_N = \\sum_{w \\in \\mathcal{L}_N} c_w [w]$, where $\\mathcal{L}_N$ is the set of Lyndon words of length at most $N$.\n\nYour program must output, for each prescribed $N$, the list of BCH coefficients $c_w$ ordered by the lexicographic order of the corresponding Lyndon words in $\\mathcal{L}_N$, rounded to $10$ decimal places as decimal floats. The list for each test case should include all coefficients for Lyndon words of degree at most $N$.\n\nTest Suite:\n- Case A (happy path): $N = 2$.\n- Case B (higher-order structure): $N = 3$.\n- Case C (increased complexity): $N = 4$.\n- Case D (boundary condition): $N = 1$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of decimal floats in the prescribed order. For example, the format must be like $[\\,[\\dots],\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$. No physical units, angle units, or percentages are involved; all outputs are dimensionless numbers.\n\nThe solution must be derived from the above core definitions without invoking any pre-stated BCH coefficients or shortcut formulas. The algorithm must be logically and mathematically consistent with the definitions of the free associative algebra, the logarithm and exponential series, and the Lyndon-Hall basis construction via recursive nested commutators.",
            "solution": "The problem statement is a well-posed and scientifically sound task in computational Lie theory. It asks for the implementation of an algorithm to compute the coefficients of the Baker-Campbell-Hausdorff (BCH) series, $Z = \\log(\\exp(X)\\exp(Y))$, in the Lyndon-Hall basis up to a specified truncation degree $N$. All components of the problem—the free associative algebra, the formal exponential and logarithm series, Lyndon words, and the Hall basis—are standard, rigorously defined concepts in mathematics. The problem is self-contained, providing all necessary definitions to construct a solution from first principles. It is objective, complete, and poses a non-trivial but solvable computational challenge. Therefore, the problem is valid.\n\nThe solution is derived by directly implementing the algebraic constructions provided. The core idea is to compute the associative series for $Z$ and then project it onto the Lyndon-Hall basis. Elements of the free associative algebra are represented as dictionaries mapping words (represented as strings) to their corresponding rational coefficients.\n\nThe algorithm proceeds in four main steps:\n\n**1. Generation of the Lyndon-Hall Basis**\n\nThe basis for our expansion is the Hall basis constructed from Lyndon words. First, we must generate all Lyndon words over the alphabet $\\{X, Y\\}$ with the specified order $XY$, for all lengths from $1$ to the truncation degree $N$. A word $w$ is a Lyndon word if it is strictly lexicographically smaller than all of its non-trivial proper suffixes. We can generate all words of a given length and filter them using this definition. For the required calculations and final output, this list of Lyndon words, denoted $\\mathcal{L}_N$, is sorted in lexicographical order. Let this ordered list be $\\{w_1, w_2, \\dots, w_k\\}$.\n\n**2. Computation of the Associative Series $Z_N$**\n\nThe BCH series $Z$ is defined as $Z = \\log(\\exp(X)\\exp(Y))$. We compute its truncation $Z_N$ by performing arithmetic with truncated formal power series.\n- First, we compute the series for $\\exp(X)$ and $\\exp(Y)$ up to degree $N$:\n$$ \\exp(X)_N = \\sum_{k=0}^{N} \\frac{1}{k!} X^k \\quad \\text{and} \\quad \\exp(Y)_N = \\sum_{k=0}^{N} \\frac{1}{k!} Y^k $$\n- Next, we multiply these two series, a process equivalent to polynomial multiplication where variables are non-commuting words. The product $S_N = \\exp(X)_N \\exp(Y)_N$ is truncated by discarding all terms with words of length greater than $N$:\n$$ S_N = \\left( \\sum_{i=0}^{N} \\frac{X^i}{i!} \\right) \\left( \\sum_{j=0}^{N} \\frac{Y^j}{j!} \\right) \\pmod{\\text{deg } N+1} $$\n- Finally, we compute the logarithm of $S_N$. Since $S_N$ has a constant term of $1$ (from $X^0 Y^0$), we can write $S_N = I + T_N$, where $T_N$ has no constant term. The logarithm series is then applied:\n$$ Z_N = \\log(S_N) = \\log(I+T_N) = \\sum_{m=1}^{N} \\frac{(-1)^{m+1}}{m} T_N^m \\pmod{\\text{deg } N+1} $$\nThis involves computing the powers $T_N^2, T_N^3, \\dots, T_N^N$ with truncation at each step, and summing the results with the appropriate coefficients. The resulting series $Z_N$ is a linear combination of words of length $1$ to $N$.\n\n**3. Expansion of Hall Basis Elements**\n\nTo express $Z_N$ in the Hall basis, we need the associative expansion of each basis element $[w]$ for $w \\in \\mathcal{L}_N$. These are defined recursively. The base cases are $[X] = X$ and $[Y] = Y$. For a composite Lyndon word $w$ (length $1$), we find its *standard factorization* $w = uv$, where $v$ is the longest proper suffix of $w$ that is also a Lyndon word. The basis element is then defined by the nested commutator:\n$$ [w] = [[u], [v]] = [u][v] - [v][u] $$\nWe compute the associative expansion for each $[w]$ recursively. For example, for $w=XYY$, the longest proper Lyndon suffix is $Y$. The factorization is $(XY)Y$. Since $XY$ is also a Lyndon word, we have $[XYY] = [[XY], [Y]]$. The expansion of $[XY]$ is $[X,Y] = XY-YX$. Thus, $[XYY] = (XY-YX)Y - Y(XY-YX) = XY^2 - YXY - YXY + Y^2X = XY^2 - 2YXY + Y^2X$. This process is performed for every Lyndon word in $\\mathcal{L}_N$, and the results are cached to avoid recomputation.\n\n**4. Solving for the BCH Coefficients**\n\nWe seek coefficients $c_w$ such that $Z_N = \\sum_{w \\in \\mathcal{L}_N} c_w [w]$. A crucial property of the Lyndon-Hall basis is that when expanded in the basis of words and ordered lexicographically, the transformation is triangular. Specifically, the expansion of a basis element $[w_i]$ is:\n$$ [w_i] = w_i + \\sum_{j  i} \\alpha_j w_j $$\nThis means $[w_i]$ is given by the word $w_i$ plus a linear combination of words that are lexicographically *greater* than $w_i$. This structure allows for a direct, iterative solution for the coefficients $c_{w_i}$.\n\nWe proceed in order of the lexicographically sorted Lyndon words $\\{w_1, w_2, \\dots, w_k\\}$. Let $R_0 = Z_N$ be the initial series.\n- For the first Lyndon word $w_1$ (which is $X$): The coefficient $c_{w_1}$ must be the coefficient of the word $w_1$ in $Z_N$, because no other basis element $[w_j]$ with $j1$ contains the word $w_1$.\n- We determine $c_{w_1}$ and subtract the contribution of its term from the series: $R_1 = R_0 - c_{w_1}[w_1]$.\n- For the second Lyndon word $w_2$: The coefficient of the word $w_2$ in the new remainder $R_1$ must be $c_{w_2}$, for the same reason.\n- We determine $c_{w_2}$ and update the remainder: $R_2 = R_1 - c_{w_2}[w_2]$.\n\nThis iterative \"peeling\" process continues for all $w_i \\in \\mathcal{L}_N$. For each $i=1, \\dots, k$:\n1. Let $w_i$ be the $i$-th Lyndon word in lexicographical order.\n2. The coefficient $c_{w_i}$ is the coefficient of the word $w_i$ in the current remainder series $R_{i-1}$.\n3. Update the remainder: $R_i = R_{i-1} - c_{w_i} [w_i]$.\n\nAfter iterating through all Lyndon words, we will have determined all coefficients $c_{w_i}$. These coefficients, ordered according to the lexicographical sorting of the Lyndon words, constitute the solution for a given $N$. This procedure is then repeated for each value of $N$ specified in the test suite.",
            "answer": "```python\nimport math\nfrom collections import defaultdict\n\n# --- Series Arithmetic Helpers ---\n\ndef add_series(s1, s2):\n    \"\"\"Adds two series (dictionaries).\"\"\"\n    res = s1.copy()\n    for w, c in s2.items():\n        new_coeff = res.get(w, 0) + c\n        if abs(new_coeff)  1e-15:\n            if w in res:\n                del res[w]\n        else:\n            res[w] = new_coeff\n    return res\n\ndef subtract_series(s1, s2):\n    \"\"\"Subtracts series s2 from s1.\"\"\"\n    res = s1.copy()\n    for w, c in s2.items():\n        new_coeff = res.get(w, 0) - c\n        if abs(new_coeff)  1e-15:\n            if w in res:\n                del res[w]\n        else:\n            res[w] = new_coeff\n    return res\n\ndef scale_series(s, scalar):\n    \"\"\"Multiplies a series by a scalar.\"\"\"\n    if abs(scalar)  1e-15:\n        return {}\n    return {w: c * scalar for w, c in s.items()}\n\ndef multiply_series(s1, s2, max_degree):\n    \"\"\"Multiplies two series, truncating at max_degree.\"\"\"\n    res = defaultdict(float)\n    for w1, c1 in s1.items():\n        for w2, c2 in s2.items():\n            w = w1 + w2\n            if len(w) = max_degree:\n                res[w] += c1 * c2\n    return {w: c for w, c in res.items() if abs(c)  1e-15}\n\n# --- Lyndon Words and Hall Basis ---\n\ndef is_lyndon(w):\n    \"\"\"Checks if a word is a Lyndon word.\"\"\"\n    if not w:\n        return False\n    n = len(w)\n    for i in range(1, n):\n        if w = w[i:]:\n            return False\n    return True\n\ndef generate_lyndon_words(max_degree):\n    \"\"\"Generates all Lyndon words up to a given degree.\"\"\"\n    words = []\n    for length in range(1, max_degree + 1):\n        # Generate all binary strings of `length`, map to 'X' and 'Y'\n        for i in range(2**length):\n            word = bin(i)[2:].zfill(length).replace('0', 'X').replace('1', 'Y')\n            if is_lyndon(word):\n                words.append(word)\n    return sorted(words)\n\ndef standard_factorization(w, lyndon_word_set):\n    \"\"\"Finds the standard factorization w = uv.\"\"\"\n    if len(w) = 1:\n        return None, None\n    # v is the longest proper suffix of w that is also a Lyndon word.\n    for i in range(len(w) - 1, 0, -1):\n        suffix = w[i:]\n        if suffix in lyndon_word_set:\n            prefix = w[:i]\n            return prefix, suffix\n    return None, None  # Should not be reached for Lyndon words  length 1\n\nhall_basis_expansion_cache = {}\n\ndef get_hall_basis_expansion(w, max_degree, lyndon_word_set):\n    \"\"\"Computes the associative expansion of a Hall basis element [w].\"\"\"\n    if w in hall_basis_expansion_cache:\n        return hall_basis_expansion_cache[w]\n\n    if len(w) == 1:\n        expansion = {w: 1.0}\n        hall_basis_expansion_cache[w] = expansion\n        return expansion\n\n    u, v = standard_factorization(w, lyndon_word_set)\n    if u is None:\n        raise ValueError(f\"Standard factorization failed for Lyndon word: {w}\")\n\n    u_exp = get_hall_basis_expansion(u, max_degree, lyndon_word_set)\n    v_exp = get_hall_basis_expansion(v, max_degree, lyndon_word_set)\n\n    # Commutator: [u_exp, v_exp] = u_exp * v_exp - v_exp * u_exp\n    uv_prod = multiply_series(u_exp, v_exp, max_degree)\n    vu_prod = multiply_series(v_exp, u_exp, max_degree)\n    \n    expansion = subtract_series(uv_prod, vu_prod)\n    hall_basis_expansion_cache[w] = expansion\n    return expansion\n\ndef compute_bch_coeffs(N):\n    \"\"\"Main logic to compute BCH coefficients up to degree N.\"\"\"\n    hall_basis_expansion_cache.clear()\n\n    # 1. Generate and order the basis\n    lyndon_words = generate_lyndon_words(N)\n    lyndon_word_set = set(lyndon_words)\n\n    # 2. Compute Z_N = log(exp(X)exp(Y))\n    # exp(X)\n    exp_x = {'': 1.0}\n    for k in range(1, N + 1):\n        exp_x['X' * k] = 1.0 / math.factorial(k)\n    # exp(Y)\n    exp_y = {'': 1.0}\n    for k in range(1, N + 1):\n        exp_y['Y' * k] = 1.0 / math.factorial(k)\n    \n    S_N = multiply_series(exp_x, exp_y, N)\n    \n    # T = S_N - I\n    T = S_N.copy()\n    if '' in T:\n        del T['']\n    \n    # Z_N = log(1+T) = T - T^2/2 + T^3/3 - ...\n    Z_N = {}\n    T_power = T.copy()\n    for m in range(1, N + 1):\n        term = scale_series(T_power, ((-1)**(m + 1)) / m)\n        Z_N = add_series(Z_N, term)\n        if m  N:\n            T_power = multiply_series(T_power, T, N)\n\n    # 3. Solve for coefficients by iterative substitution\n    remainder = Z_N.copy()\n    coeffs = []\n    \n    for w in lyndon_words:\n        # Get coefficient c_w from the remainder\n        c_w = remainder.get(w, 0.0)\n        coeffs.append(round(c_w, 10))\n        \n        if abs(c_w)  1e-15:\n            # Update remainder: R_new = R_old - c_w * [w]\n            hall_expansion = get_hall_basis_expansion(w, N, lyndon_word_set)\n            term_to_subtract = scale_series(hall_expansion, c_w)\n            remainder = subtract_series(remainder, term_to_subtract)\n            \n    return coeffs\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases and prints the result.\n    \"\"\"\n    test_cases = [2, 3, 4, 1]\n    all_results = []\n    \n    for N in test_cases:\n        coeffs = compute_bch_coeffs(N)\n        # Format the list of floats into a string like \"[1.0,0.5,...]\"\n        formatted_list = f\"[{','.join(f'{c:.10f}' for c in coeffs)}]\"\n        all_results.append(formatted_list)\n        \n    # Final output must be a single line in the format [[...],[...],...]\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}