{
    "hands_on_practices": [
        {
            "introduction": "要掌握无坐标形式，首先必须将其与我们熟悉的概念联系起来。本练习旨在将切丛结构 $J$ 和刘维尔向量场 $\\Delta$ 的抽象定义与它们在标准笛卡尔坐标下的具体表达式联系起来。通过为一个简单的牛顿系统验证基本条件 $J(X)=\\Delta$，我们将巩固对几何上如何定义一个二阶系统的理解。",
            "id": "3765498",
            "problem": "考虑位形流形 $Q=\\mathbb{R}^{n}$ 及其标准光滑结构和切丛 $TQ\\cong \\mathbb{R}^{n}\\times \\mathbb{R}^{n}$。令 $\\tau:TQ\\to Q$ 表示典范投影。切丛 $TQ$ 带有几何力学中使用的两种典范几何结构：切结构（也称为垂直自同态）$J$ 和刘维（也称为伸缩或欧拉）向量场 $\\Delta$。\n\n从以下无坐标的基本定义出发：\n- 垂直子丛 $V(TQ)\\subset TTQ$ 是 $T\\tau:TTQ\\to TQ$ 的核。切结构 $J:TTQ\\to TTQ$ 是一个 $(1,1)$-张量，对于在点 $(q,v)\\in TQ$ 处的每个 $Y\\in TTQ$，它返回唯一的垂直向量 $J(Y)\\in V(TQ)$，在典范认同 $V_{(q,v)}(TQ)\\cong T_{q}Q$ 下，其纤维分量与 $T\\tau(Y)\\in T_{q}Q$ 一致。\n- $TQ$ 上的刘维向量场 $\\Delta$ 是纤维上的标量乘法流 $s\\cdot:TQ\\to TQ$ 的无穷小生成元，该流由 $s\\cdot(q,v)=(q,sv)$ 给出；也就是说，对于每个 $(q,v)\\in TQ$，\n$$\n\\Delta_{(q,v)}=\\left.\\frac{d}{ds}\\right|_{s=1}(q,sv).\n$$\n\n在 $Q=\\mathbb{R}^{n}$ 上的全局笛卡尔坐标 $(q^{1},\\dots,q^{n})$ 和 $TQ$ 上的诱导丛坐标 $(q^{1},\\dots,q^{n},v^{1},\\dots,v^{n})$ 中进行计算。\n1. 推导切结构 $J$ 作为 $TQ$ 上的 $(1,1)$-张量的显式坐标表达式，用 $TTQ$ 的局部基 $\\left\\{\\frac{\\partial}{\\partial q^{i}},\\frac{\\partial}{\\partial v^{i}}\\right\\}$ 和 $T^{*}TQ$ 的局部基 $\\{dq^{i},dv^{i}\\}$ 表示。\n2. 推导刘维向量场 $\\Delta$ 在 $TQ$ 上的显式坐标表达式。\n3. 在具有标准欧几里得度量的 $Q=\\mathbb{R}^{n}$ 上的牛顿力学背景下，设 $X$ 是 $TQ$ 上的二阶微分方程（SODE）向量场，它编码了光滑势 $V:Q\\to\\mathbb{R}$ 的牛顿定律。仅使用SODE的定义性质以及上述 $J$ 和 $\\Delta$ 的无坐标定义，验证 $J(X)=\\Delta$ 成立。\n\n将你的最终答案以有序对 $(J,\\Delta)$ 的形式提供，写成坐标形式的行矩阵，使用 $\\pmatrix{\\,\\cdot\\,\\,\\cdot\\,}$ 格式。不需要数值近似。",
            "solution": "问题陈述经验证具有科学依据、良定、客观且内部一致。它展示了在切丛上的几何力学背景下的一个标准推导。所有定义和条件都是标准的，并为唯一且有意义的解提供了一个自洽的设置。我们按要求进行推导。\n\n位形空间为 $Q = \\mathbb{R}^{n}$，其全局笛卡尔坐标为 $(q^{i})$，$i=1, \\dots, n$。切丛 $TQ$ 具有诱导的全局坐标 $(q^{i}, v^{i})$，其中点 $(q, v) \\in TQ$ 对应于坐标 $(q^{1}, \\dots, q^{n}, v^{1}, \\dots, v^{n})$。在点 $(q,v)$ 处 $TQ$ 的切空间，记为 $T_{(q,v)}TQ$，是一个 $2n$ 维实向量空间，其自然基为 $\\left\\{\\left.\\frac{\\partial}{\\partial q^{i}}\\right|_{(q,v)}, \\left.\\frac{\\partial}{\\partial v^{i}}\\right|_{(q,v)}\\right\\}_{i=1,\\dots,n}$。\n\n**1. 切结构 $J$ 的坐标表达式**\n\n切结构 $J$ 是 $TQ$ 上的一个 $(1,1)$-张量。我们确定它在 $TTQ$ 的基向量上的作用。设 $Y \\in T_{(q,v)}TQ$ 为任意切向量，其坐标可以表示为\n$$\nY = Y^{i} \\frac{\\partial}{\\partial q^{i}} + \\tilde{Y}^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\n这里默认为对从 $1$ 到 $n$ 的重复指标求和。\n\n典范投影为 $\\tau: TQ \\to Q$，在坐标中由 $\\tau(q,v) = q$ 给出。其切映射 $T\\tau: TTQ \\to TQ$ 对基向量的作用如下。对于 $Q$ 上的一个坐标卡，比如 $\\phi: U \\subset Q \\to \\mathbb{R}^n$，坐标为 $q^i$，投影映射为 $\\tau^j(q,v) = q^j$。\n$T\\tau$ 对 $T_{(q,v)}TQ$ 的基向量的作用是：\n$$\nT\\tau \\left( \\frac{\\partial}{\\partial q^{i}} \\right) = \\frac{\\partial \\tau^{j}}{\\partial q^{i}} \\frac{\\partial}{\\partial q^{j}} = \\delta_{i}^{j} \\frac{\\partial}{\\partial q^{j}} = \\frac{\\partial}{\\partial q^{i}} \\in T_{q}Q\n$$\n$$\nT\\tau \\left( \\frac{\\partial}{\\partial v^{i}} \\right) = \\frac{\\partial \\tau^{j}}{\\partial v^{i}} \\frac{\\partial}{\\partial q^{j}} = 0 \\cdot \\frac{\\partial}{\\partial q^{j}} = 0 \\in T_{q}Q\n$$\n将 $T\\tau$ 应用于一般向量 $Y$ 得出：\n$$\nT\\tau(Y) = Y^{i} T\\tau\\left(\\frac{\\partial}{\\partial q^{i}}\\right) + \\tilde{Y}^{i} T\\tau\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = Y^{i} \\frac{\\partial}{\\partial q^{i}}\n$$\n$T\\tau(Y) \\in T_qQ$ 在基 $\\{\\frac{\\partial}{\\partial q^i}\\}$ 中的分量是 $(Y^1, \\dots, Y^n)$。\n\n垂直子丛 $V(TQ)$ 是 $T\\tau$ 的核。如果 $T\\tau(Y) = 0$，则向量 $Y$ 属于 $V_{(q,v)}(TQ)$，这意味着对所有 $i$ 都有 $Y^i=0$。因此，在 $(q,v)$ 处的垂直子丛由 $\\left\\{\\frac{\\partial}{\\partial v^{i}}\\right\\}$ 张成，即 $V_{(q,v)}(TQ) = \\text{span}\\left\\{\\frac{\\partial}{\\partial v^{i}}\\right\\}_{i=1,\\dots,n}$。\n\n典范认同 $V_{(q,v)}(TQ) \\cong T_{q}Q$ 将基向量 $\\frac{\\partial}{\\partial v^{i}}$ 映射到 $\\frac{\\partial}{\\partial q^{i}}$。\n根据定义，对于任何 $Y \\in TTQ$，$J(Y)$ 是一个垂直向量。因此，它必须具有形式 $J(Y) = C^{i} \\frac{\\partial}{\\partial v^{i}}$，其中 $C^i$ 是某些系数。定义进一步指出，在典范认同下，$J(Y)$ 的纤维分量等于 $T\\tau(Y)$。$J(Y)$ 的纤维分量是向量 $C^{i} \\frac{\\partial}{\\partial q^{i}} \\in T_{q}Q$。\n将其与我们对 $T\\tau(Y)$ 的表达式相等：\n$$\nC^{i} \\frac{\\partial}{\\partial q^{i}} = Y^{i} \\frac{\\partial}{\\partial q^{i}} \\implies C^{i} = Y^{i}\n$$\n所以，对于 $Y = Y^{i} \\frac{\\partial}{\\partial q^{i}} + \\tilde{Y}^{i} \\frac{\\partial}{\\partial v^{i}}$，我们有 $J(Y) = Y^{i} \\frac{\\partial}{\\partial v^{i}}$。\n\n我们现在可以找到 $J$ 对基向量的作用：\n对于 $Y = \\frac{\\partial}{\\partial q^{j}}$，我们有 $Y^{i} = \\delta_{j}^{i}$ 和 $\\tilde{Y}^{i} = 0$。因此，$J\\left(\\frac{\\partial}{\\partial q^{j}}\\right) = \\delta_{j}^{i} \\frac{\\partial}{\\partial v^{i}} = \\frac{\\partial}{\\partial v^{j}}$。\n对于 $Y = \\frac{\\partial}{\\partial v^{j}}$，我们有 $Y^{i} = 0$ 和 $\\tilde{Y}^{i} = \\delta_{j}^{i}$。因此，$J\\left(\\frac{\\partial}{\\partial v^{j}}\\right) = 0 \\cdot \\frac{\\partial}{\\partial v^{i}} = 0$。\n\n一个一般的 $(1,1)$-张量可以写成 $T = T_{\\beta}^{\\alpha} \\, \\partial_{\\alpha} \\otimes dx^{\\beta}$。在我们的例子中，$J$ 对任意向量场 $Y$ 的作用是 $J(Y) = Y^i \\frac{\\partial}{\\partial v^i}$。由于 $Y^i = dq^i(Y)$，我们可以写成 $J(Y) = dq^i(Y) \\frac{\\partial}{\\partial v^i}$。这意味着张量 $J$ 的坐标表示为：\n$$\nJ = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial v^{i}} \\otimes dq^{i}\n$$\n\n**2. 刘维向量场 $\\Delta$ 的坐标表达式**\n\n刘维向量场 $\\Delta$ 被定义为纤维上的标量乘法流 $\\Phi_s(q,v) = (q, sv)$ 的无穷小生成元。根据定义，\n$$\n\\Delta_{(q,v)} = \\left.\\frac{d}{ds}\\right|_{s=1} \\Phi_s(q,v) = \\left.\\frac{d}{ds}\\right|_{s=1} (q, sv)\n$$\n设 $TQ$ 中的一条曲线由 $\\gamma(s) = (q^{1}, \\dots, q^{n}, s v^{1}, \\dots, s v^{n})$ 给出。该曲线的切向量通过对其分量关于 $s$ 求导计算得出：\n$$\n\\frac{d\\gamma(s)}{ds} = \\left( \\frac{dq^{1}}{ds}, \\dots, \\frac{dq^{n}}{ds}, \\frac{d(sv^{1})}{ds}, \\dots, \\frac{d(sv^{n})}{ds} \\right) = (0, \\dots, 0, v^{1}, \\dots, v^{n})\n$$\n通过将这些分量乘以基向量，就构成了切向量场。导数与 $s$ 无关，因此在 $s=1$ 处求值得到 $\\Delta$ 在 $(q,v)$ 处的分量：\n$$\n\\Delta_{(q,v)} = 0 \\cdot \\frac{\\partial}{\\partial q^{i}} + v^{i} \\frac{\\partial}{\\partial v^{i}} = v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\n这定义了在 $TQ$ 每一点上的向量场 $\\Delta$。其坐标表达式为：\n$$\n\\Delta = \\sum_{i=1}^{n} v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\n\n**3. 验证牛顿SODE的 $J(X) = \\Delta$**\n\n$TQ$ 上的一个二阶微分方程（SODE）向量场是一个向量场 $X$，其积分曲线 $t \\mapsto c(t) = (q(t), v(t))$ 表示 $Q$ 上一个二阶常微分方程组的解。这要求条件 $v(t) = \\frac{dq}{dt}(t)$ 沿着任何积分曲线都成立。\n\n设 $TQ$ 上的向量场的一般形式为 $X = X^{i}(q,v) \\frac{\\partial}{\\partial q^{i}} + \\tilde{X}^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}$。$X$ 的积分曲线 $(q^{i}(t), v^{i}(t))$ 满足以下方程组：\n$$\n\\frac{dq^{i}}{dt} = X^{i}(q(t), v(t))\n$$\n$$\n\\frac{dv^{i}}{dt} = \\tilde{X}^{i}(q(t), v(t))\n$$\n条件 $v^{i}(t) = \\frac{dq^{i}}{dt}(t)$ 意味着向量场的分量必须满足 $X^{i}(q,v) = v^{i}$。因此，$TQ$ 上的任何SODE向量场 $X$ 都必须具有以下一般形式：\n$$\nX = v^{i} \\frac{\\partial}{\\partial q^{i}} + a^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}\n$$\n其中 $a^{i}(q,v) = \\tilde{X}^{i}(q,v)$ 是加速度分量。\n\n对于一个在 $Q=\\mathbb{R}^{n}$ 上、具有标准欧几里得度量和势 $V(q)$ 的牛顿系统，动能为 $T = \\frac{1}{2}\\sum_{i=1}^n m_i (v^i)^2$（如果质量是均匀的，则为 $\\frac{1}{2}m|v|^2$），力为 $F_i = -\\frac{\\partial V}{\\partial q^i}$。牛顿第二定律是 $m_i \\ddot{q}^i = F_i$，所以 $\\ddot{q}^i = \\frac{F_i}{m_i}$。加速度分量是 $a^i(q) = -\\frac{1}{m_i}\\frac{\\partial V}{\\partial q^i}$。因此，该系统的特定SODE向量场为：\n$$\nX = v^{i} \\frac{\\partial}{\\partial q^{i}} - \\left(\\frac{1}{m_i}\\frac{\\partial V}{\\partial q^i}\\right) \\frac{\\partial}{\\partial v^{i}}\n$$\n我们被要求验证 $J(X)=\\Delta$ 成立。我们将张量 $J$ 应用于SODE向量场 $X$ 的一般形式。利用 $J$ 的线性和在第1部分中推导出的其对基向量的作用：\n$$\nJ(X) = J\\left(v^{i} \\frac{\\partial}{\\partial q^{i}} + a^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}\\right)\n$$\n$$\nJ(X) = v^{i} J\\left(\\frac{\\partial}{\\partial q^{i}}\\right) + a^{i}(q,v) J\\left(\\frac{\\partial}{\\partial v^{i}}\\right)\n$$\n代入 $J\\left(\\frac{\\partial}{\\partial q^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ 和 $J\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$：\n$$\nJ(X) = v^{i} \\left(\\frac{\\partial}{\\partial v^{i}}\\right) + a^{i}(q,v) \\cdot 0 = v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\n结果 $v^{i} \\frac{\\partial}{\\partial v^{i}}$ 正是第2部分中推导出的刘维向量场 $\\Delta$ 的坐标表达式。\n$$\nJ(X) = \\Delta\n$$\n这个验证对任何SODE向量场都成立，因为结果只依赖于分量 $X^i=v^i$，并且与被 $J$ 湮没的加速度项 $a^i(q,v)$ 无关。因此，对于具有势 $V(q)$ 的牛顿系统的特定情况，它也是正确的。这证实了定义SODE向量场的基本几何性质。\n\n最终答案提供了有序对 $(J, \\Delta)$ 的坐标表达式。",
            "answer": "$$\n\\boxed{\\pmatrix{ \\sum_{i=1}^{n} \\frac{\\partial}{\\partial v^i} \\otimes dq^i & \\sum_{i=1}^{n} v^i \\frac{\\partial}{\\partial v^i} }}\n$$"
        },
        {
            "introduction": "在建立了基础之后，我们将从简单的力学系统转向更普适的几何背景。这个实践要求我们将SODE框架应用于描述具有非平凡仿射联络的流形上的测地运动。我们将直接从克氏符号出发构造测地喷射，然后验证该喷射确实是一个有效的SODE向量场，从而展示该框架统一不同类型二阶动力学系统的能力。",
            "id": "3765526",
            "problem": "考虑光滑流形 $Q = \\mathbb{R}^{2}$，其全局坐标为 $(x,y)$，其切丛 $TQ$ 的诱导坐标为 $(x,y; v^{x}, v^{y})$。设 $\\nabla$ 是 $Q$ 上的一个无挠仿射联络，其 Christoffel 符号（关于坐标标架 $\\left\\{\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\right\\}$）由以下光滑函数定义：\n- $\\Gamma^{x}_{xy}(x,y) = \\Gamma^{x}_{yx}(x,y) = x$，\n- $\\Gamma^{y}_{xx}(x,y) = y$，\n- 所有其他的 $\\Gamma^{i}_{jk}(x,y)$ 均为零。\n\n$TQ$ 上的一个二阶微分方程（SODE）向量场是一个光滑向量场 $X \\in \\mathfrak{X}(TQ)$，它满足内蕴 SODE 条件 $J(X) = \\Delta$，其中 $J$ 是 $TQ$ 上的典范垂直自同态，$\\Delta$ 是 $TQ$ 上的 Liouville（伸缩）向量场。与 $\\nabla$ 相关联的测地喷射是唯一的 SODE，其积分曲线投影为 $\\nabla$ 的测地线。\n\n从以下基本几何事实出发：\n- $Q$ 上的仿射联络 $\\nabla$ 通过条件 $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$ 确定了测地线 $\\gamma(t)$ 的概念，其速度 $(\\gamma(t), \\dot{\\gamma}(t)) \\in TQ$ 定义了 $TQ$ 中的曲线。\n- 典范投影 $\\pi : TQ \\to Q$ 和典范垂直自同态 $J : TTQ \\to TTQ$ 在局部坐标下满足 $J\\!\\left(\\frac{\\partial}{\\partial x^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ 和 $J\\!\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$，并且 Liouville 向量场为 $\\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}}$。\n- $TQ$ 上的向量场 $X$ 是一个 SODE，当且仅当 $T\\pi \\circ X = \\mathrm{id}_{TQ}$，等价于 $J(X) = \\Delta$。\n\n在诱导坐标 $(x,y; v^{x}, v^{y})$下，显式地构造由给定仿射联络 $\\nabla$ 诱导的 $TQ$ 上的测地喷射 $X$。然后，对你构造的 $X$ 验证 SODE 条件 $J(X) = \\Delta$，使用 $J$ 和 $\\Delta$ 的无坐标刻画。将你的最终答案表示为向量场 $X$ 的单个解析表达式。\n\n不需要进行数值计算或取整。最终答案必须是单个封闭形式的表达式。",
            "solution": "首先对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **流形和坐标**：光滑流形 $Q = \\mathbb{R}^{2}$，其全局坐标为 $(x,y)$。切丛 $TQ$ 的诱导坐标为 $(x,y; v^{x}, v^{y})$。\n-   **仿射联络**：$Q$ 上的一个无挠仿射联络 $\\nabla$。\n-   **Christoffel 符号**：关于坐标标架 $\\{\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\}$，非零的 Christoffel 符号由以下光滑函数给出：\n    -   $\\Gamma^{x}_{xy}(x,y) = \\Gamma^{x}_{yx}(x,y) = x$\n    -   $\\Gamma^{y}_{xx}(x,y) = y$\n    -   所有其他的 $\\Gamma^{i}_{jk}(x,y)$ 均为零。\n-   **SODE 定义**：一个二阶微分方程（SODE）向量场 $X \\in \\mathfrak{X}(TQ)$ 满足 $J(X) = \\Delta$。\n-   **几何对象**：\n    -   $J$：$TQ$ 上的典范垂直自同态。\n    -   $\\Delta$：$TQ$ 上的 Liouville（伸缩）向量场。\n-   **测地线定义**：$\\nabla$ 的测地喷射是唯一的 SODE，其积分曲线投影为 $\\nabla$ 的测地线，其中测地线 $\\gamma(t)$ 是满足 $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$ 的曲线。\n-   **局部坐标规则**：\n    -   $J\\!\\left(\\frac{\\partial}{\\partial x^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ 和 $J\\!\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$。\n    -   $\\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是良定的、有科学依据且客观的。这是微分几何和几何力学中的一个标准练习。\n1.  **科学依据**：流形、切丛、仿射联络、Christoffel 符号和测地喷射等概念是微分几何的基础。所提供的 $J$ 和 $\\Delta$ 的定义是标准的。\n2.  **一致性**：联络被说明是无挠的，这意味着 $\\Gamma^{i}_{jk} = \\Gamma^{i}_{kj}$。给定的符号满足这一点：$\\Gamma^{x}_{xy} = \\Gamma^{x}_{yx} = x$。\n3.  **完备性**：所有必要信息，特别是非零的 Christoffel 符号，都已提供，以唯一确定测地喷射。\n\n### 步骤 3：结论与行动\n问题是有效的。将构造解答。\n\n### 解答构造\n\n目标是找到测地喷射 $X$，它是切丛 $TQ$ 上的一个向量场。$X$ 的积分曲线是从 $Q$ 到 $TQ$ 的测地线的提升。\n\n设流形 $Q$ 上的一条曲线记为 $\\gamma(t) = (x^{1}(t), x^{2}(t)) = (x(t), y(t))$。其速度向量为 $\\dot{\\gamma}(t)$，分量为 $\\frac{dx^{i}}{dt}$。在 $TQ$ 的诱导坐标中，速度分量记为 $v^{i}$，因此我们有 $v^{x} = \\frac{dx}{dt}$ 和 $v^{y} = \\frac{dy}{dt}$。\n\n测地线方程 $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$ 可以使用 Christoffel 符号在局部坐标中表示为：\n$$ \\frac{d^{2}x^{k}}{dt^{2}} + \\sum_{i,j=1}^{2} \\Gamma^{k}_{ij}(x(t)) \\frac{dx^{i}}{dt} \\frac{dx^{j}}{dt} = 0 $$\n对每个坐标 $k \\in \\{1, 2\\}$。\n\n让我们为我们的坐标 $x^{1}=x$ 和 $x^{2}=y$ 显式地写出这个方程组。\n\n对于 $k=1$（$x$-坐标）：\n$$ \\frac{d^{2}x}{dt^{2}} + \\Gamma^{x}_{xx} \\left(\\frac{dx}{dt}\\right)^{2} + \\Gamma^{x}_{xy} \\frac{dx}{dt} \\frac{dy}{dt} + \\Gamma^{x}_{yx} \\frac{dy}{dt} \\frac{dx}{dt} + \\Gamma^{x}_{yy} \\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n代入给定的 Christoffel 符号：$\\Gamma^{x}_{xx}=0$, $\\Gamma^{x}_{xy}=x$, $\\Gamma^{x}_{yx}=x$ 及 $\\Gamma^{x}_{yy}=0$。\n$$ \\frac{d^{2}x}{dt^{2}} + (0)\\left(\\frac{dx}{dt}\\right)^{2} + (x) \\frac{dx}{dt} \\frac{dy}{dt} + (x) \\frac{dy}{dt} \\frac{dx}{dt} + (0)\\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n$$ \\frac{d^{2}x}{dt^{2}} + 2x \\frac{dx}{dt} \\frac{dy}{dt} = 0 $$\n\n对于 $k=2$（$y$-坐标）：\n$$ \\frac{d^{2}y}{dt^{2}} + \\Gamma^{y}_{xx} \\left(\\frac{dx}{dt}\\right)^{2} + \\Gamma^{y}_{xy} \\frac{dx}{dt} \\frac{dy}{dt} + \\Gamma^{y}_{yx} \\frac{dy}{dt} \\frac{dx}{dt} + \\Gamma^{y}_{yy} \\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n代入给定的 Christoffel 符号：$\\Gamma^{y}_{xx}=y$, $\\Gamma^{y}_{xy}=0$, $\\Gamma^{y}_{yx}=0$ 及 $\\Gamma^{y}_{yy}=0$。\n$$ \\frac{d^{2}y}{dt^{2}} + (y)\\left(\\frac{dx}{dt}\\right)^{2} + (0)\\frac{dx}{dt} \\frac{dy}{dt} + (0) \\frac{dy}{dt} \\frac{dx}{dt} + (0)\\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n$$ \\frac{d^{2}y}{dt^{2}} + y \\left(\\frac{dx}{dt}\\right)^{2} = 0 $$\n\n测地喷射 $X$ 是 $TQ$ 上的一个向量场，其分量对应于坐标 $(x, y, v^{x}, v^{y})$ 的时间演化。$X$ 的积分曲线 $c(t) = (x(t), y(t), v^{x}(t), v^{y}(t))$ 必须满足 $\\frac{dc}{dt} = X(c(t))$。这意味着：\n$\\dot{x} = v^{x}$\n$\\dot{y} = v^{y}$\n$\\dot{v}^{x} = \\frac{d^{2}x}{dt^{2}} = -2x \\frac{dx}{dt} \\frac{dy}{dt} = -2x v^{x} v^{y}$\n$\\dot{v}^{y} = \\frac{d^{2}y}{dt^{2}} = -y \\left(\\frac{dx}{dt}\\right)^{2} = -y (v^{x})^{2}$\n\n因此向量场 $X$ 可以写成：\n$$ X = \\dot{x} \\frac{\\partial}{\\partial x} + \\dot{y} \\frac{\\partial}{\\partial y} + \\dot{v}^{x} \\frac{\\partial}{\\partial v^{x}} + \\dot{v}^{y} \\frac{\\partial}{\\partial v^{y}} $$\n代入这些导数的表达式：\n$$ X = v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}} $$\n这就是测地喷射的显式表达式。\n\n### SODE 条件的验证\n\n我们现在必须验证这个向量场 $X$ 满足 SODE 条件 $J(X) = \\Delta$。我们将垂直自同态 $J$ 应用于我们构造的向量场 $X$。$J$ 线性作用于向量场。\n$$ J(X) = J\\left(v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}}\\right) $$\n$$ J(X) = v^{x} J\\left(\\frac{\\partial}{\\partial x}\\right) + v^{y} J\\left(\\frac{\\partial}{\\partial y}\\right) - 2x v^{x} v^{y} J\\left(\\frac{\\partial}{\\partial v^{x}}\\right) - y (v^{x})^{2} J\\left(\\frac{\\partial}{\\partial v^{y}}\\right) $$\n使用所提供的关于 $J$ 作用的坐标规则：\n- $J\\left(\\frac{\\partial}{\\partial x}\\right) = \\frac{\\partial}{\\partial v^{x}}$\n- $J\\left(\\frac{\\partial}{\\partial y}\\right) = \\frac{\\partial}{\\partial v^{y}}$\n- $J\\left(\\frac{\\partial}{\\partial v^{x}}\\right) = 0$\n- $J\\left(\\frac{\\partial}{\\partial v^{y}}\\right) = 0$\n\n将这些代入 $J(X)$ 的表达式中：\n$$ J(X) = v^{x} \\left(\\frac{\\partial}{\\partial v^{x}}\\right) + v^{y} \\left(\\frac{\\partial}{\\partial v^{y}}\\right) - 2x v^{x} v^{y} (0) - y (v^{x})^{2} (0) $$\n$$ J(X) = v^{x} \\frac{\\partial}{\\partial v^{x}} + v^{y} \\frac{\\partial}{\\partial v^{y}} $$\n现在，我们考察 Liouville 向量场 $\\Delta$ 的定义。在我们的坐标下，它是：\n$$ \\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}} = v^{x} \\frac{\\partial}{\\partial v^{x}} + v^{y} \\frac{\\partial}{\\partial v^{y}} $$\n比较这两个结果，我们看到 $J(X) = \\Delta$。验证完成。所构造的向量场 $X$ 确实是正确的测地喷射，并且满足 SODE 条件。\n向量场 $X$ 的最终表达式即为所求答案。",
            "answer": "$$\n\\boxed{v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}}}\n$$"
        },
        {
            "introduction": "最后，我们来探讨几何观点的实际意义，特别是在数值计算中的应用。本练习突出了几何力学的核心优势：发展保结构算法。通过实现变分积分器并将其与标准的龙格-库塔方法进行比较，我们将亲眼见证尊重系统的几何（辛）结构如何带来卓越的长期能量守恒和稳定性。",
            "id": "3765527",
            "problem": "考虑一个有限维黎曼流形，其模型为欧氏空间 $Q = \\mathbb{R}^{2}$，并配备一个与位置相关的对角黎曼度量 $\\mathbf{g}_{q}$，定义如下\n$$\n\\mathbf{g}_{q}(\\mathbf{u},\\mathbf{v}) = A(x)\\,u_{x} v_{x} + B(y)\\,u_{y} v_{y}, \\quad \\text{其中 } q=(x,y)\\in \\mathbb{R}^{2},\\ \\mathbf{u}=(u_{x},u_{y}),\\ \\mathbf{v}=(v_{x},v_{y}),\n$$\n且\n$$\nA(x) = 1 + a\\,x^{2}, \\quad B(y) = 1 + b\\,y^{2},\n$$\n其中参数 $a>0$ 且 $b>0$。无坐标的拉格朗日量为\n$$\nL(q,v) = \\tfrac{1}{2}\\,\\mathbf{g}_{q}(v,v).\n$$\n测地流的二阶欧拉-拉格朗日动力学由作用于曲线 $q(t)$ 的哈密顿原理定义，并通过勒让德变换由余切丛 $T^{*}Q$ 上的典范辛形式生成。典范动量为 $p=\\partial L/\\partial v$，典范哈密顿量 $H(q,p)$ 通过 $L$ 的勒让德变换获得。\n\n您的任务是：\n- 根据上述无坐标的定义，推导该度量的典范动量 $p$ 和典范哈密顿量 $H(q,p)$。推导在 $(q,p)\\in T^{*}Q$ 上生成测地流的一阶哈密顿系统。\n- 通过选择一个使用中点近似来近似一个时间步长上的作用量的离散拉格朗日量，为这些二阶欧拉-拉格朗日动力学构建一个几何变分积分器 (VI)。使用离散欧拉-拉格朗日方程获得一个将 $(q_{k},p_{k})$ 映射到 $(q_{k+1},p_{k+1})$ 的隐式单步法。您的构建应基于离散变分原理；不要引入任何额外的约束或非典范变量。\n- 构建一个对比用的非几何方法：经典的显式四阶龙格-库塔 (RK) 方法。将其应用于您推导的一阶典范哈密顿系统。\n\n长期定性行为应以纯数学术语进行评估。具体来说：\n- 定义能量 $H(q(t),p(t))$，并将在最终时刻 $T$ 的能量漂移测量为绝对差 $|H(q(T),p(T)) - H(q(0),p(0))|$。\n- 定义单步法 $F:\\mathbb{R}^{4}\\to\\mathbb{R}^{4}$ 在相点 $z=(q,p)$ 处的辛性缺陷为\n$$\n\\Delta(F;z) = J(z)^{\\top}\\,\\Omega\\,J(z) - \\Omega,\n$$\n的弗罗贝尼乌斯范数，其中 $J(z)$ 是 $F$ 在 $z$ 处的雅可比矩阵，而\n$$\n\\Omega = \\begin{pmatrix}\n0 & I_{2} \\\\\n- I_{2} & 0\n\\end{pmatrix},\n$$\n$I_{2}$ 是 $2\\times 2$ 单位矩阵。对于每种方法，通过在数值计算的轨迹上进行有限次采样并对 $\\|\\Delta(F;z_{k})\\|_{F}$ 求平均值，来估计平均辛性缺陷。\n\n您必须实现这两种方法，并使用下面的测试套件比较它们在长时间内的能量行为和辛性。所有量纲均为无量纲；不需要物理单位。\n\n- 测试用例1（一般弯曲度量，正常路径）：\n    - 参数：$a=0.5$，$b=0.25$，步长 $h=0.05$，最终时刻 $T=50.0$。\n    - 初始条件：$q(0)=(0.5,-0.2)$，$p(0)=(1.0,0.8)$。\n- 测试用例2（平坦度量边界情况）：\n    - 参数：$a=0.0$，$b=0.0$，步长 $h=0.05$，最终时刻 $T=50.0$。\n    - 初始条件：$q(0)=(0.5,-0.2)$，$p(0)=(1.0,0.8)$。\n- 测试用例3（刚性弯曲度量，边缘情况）：\n    - 参数：$a=2.0$，$b=4.0$，步长 $h=0.02$，最终时刻 $T=40.0$。\n    - 初始条件：$q(0)=(0.5,-0.2)$，$p(0)=(1.0,0.8)$。\n\n您的程序应：\n- 对于每个测试用例，同时使用变分积分器和应用于典范哈密顿系统的显式四阶龙格-库塔方法，对从 $t=0$ 到 $t=T$ 的动力学进行积分。\n- 对于每个测试用例中的每种方法，计算：\n    - 能量漂移 $|H(q(T),p(T)) - H(q(0),p(0))|$。\n    - 平均辛性缺陷，定义为沿轨迹上一组固定的均匀间隔样本上 $\\|\\Delta(F;z_{k})\\|_{F}$ 的平均值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。对于每个测试用例，按顺序\n$$\n[\\text{E\\_VI}, \\text{E\\_RK}, \\text{S\\_VI}, \\text{S\\_RK}],\n$$\n输出四个浮点数，其中 $\\text{E\\_VI}$ 是变分积分器的能量漂移，$\\text{E\\_RK}$ 是龙格-库塔方法的能量漂移，$\\text{S\\_VI}$ 是变分积分器的平均辛性缺陷，$\\text{S\\_RK}$ 是龙格-库塔方法的平均辛性缺陷。将所有三个测试用例的结果按测试用例1、测试用例2和测试用例3的顺序聚合到一个单一的扁平列表中，最终得到包含十二个浮点数的单行输出：\n$$\n[\\text{E\\_VI}^{(1)},\\text{E\\_RK}^{(1)},\\text{S\\_VI}^{(1)},\\text{S\\_RK}^{(1)},\\text{E\\_VI}^{(2)},\\text{E\\_RK}^{(2)},\\text{S\\_VI}^{(2)},\\text{S\\_RK}^{(2)},\\text{E\\_VI}^{(3)},\\text{E\\_RK}^{(3)},\\text{S\\_VI}^{(3)},\\text{S\\_RK}^{(3)}].\n$$",
            "solution": "用户提供的问题是几何力学和数值分析领域一个有效的练习。它具有科学依据、适定且客观。它要求从给定的拉格朗日量推导哈密顿系统，构建两种不同的数值积分器（一种几何的，一种经典的），并定量比较它们在能量守恒和辛性方面的长期行为。该问题是自包含的，提供了所有必要的定义、参数和初始条件。\n\n### 1. 典范哈密顿系统的推导\n\n位形空间是 $Q = \\mathbb{R}^{2}$，坐标为 $q=(x,y)$。速度为 $v=(\\dot{x},\\dot{y})$。拉格朗日量由 $L(q,v) = \\frac{1}{2}\\,\\mathbf{g}_{q}(v,v)$ 给出，其中 $\\mathbf{g}_q$ 是一个黎曼度量。在给定坐标下，其表达式为：\n$$\nL(x,y,\\dot{x},\\dot{y}) = \\frac{1}{2} \\left( A(x)\\,\\dot{x}^{2} + B(y)\\,\\dot{y}^{2} \\right)\n$$\n其中 $A(x) = 1 + a\\,x^{2}$ 且 $B(y) = 1 + b\\,y^{2}$。\n\n**典范动量：**\n典范动量 $p=(p_x, p_y)$ 由拉格朗日量的纤维导数定义，$p = \\frac{\\partial L}{\\partial v}$：\n$$\np_x = \\frac{\\partial L}{\\partial \\dot{x}} = A(x)\\,\\dot{x} = (1 + a\\,x^{2})\\,\\dot{x}\n$$\n$$\np_y = \\frac{\\partial L}{\\partial \\dot{y}} = B(y)\\,\\dot{y} = (1 + b\\,y^{2})\\,\\dot{y}\n$$\n\n**典范哈密顿量：**\n哈密顿量 $H(q,p)$ 是拉格朗日量的勒让德变换：\n$$\nH(q,p) = p \\cdot v - L(q,v) = p_x \\dot{x} + p_y \\dot{y} - L(x, y, \\dot{x}, \\dot{y})\n$$\n首先，我们用动量表示速度：\n$$\n\\dot{x} = \\frac{p_x}{A(x)} = \\frac{p_x}{1 + a\\,x^{2}} \\quad \\text{和} \\quad \\dot{y} = \\frac{p_y}{B(y)} = \\frac{p_y}{1 + b\\,y^{2}}\n$$\n将这些代入 $H$ 的表达式中：\n$$\nH(q,p) = p_x \\left(\\frac{p_x}{A(x)}\\right) + p_y \\left(\\frac{p_y}{B(y)}\\right) - \\frac{1}{2} \\left( A(x)\\left(\\frac{p_x}{A(x)}\\right)^2 + B(y)\\left(\\frac{p_y}{B(y)}\\right)^2 \\right)\n$$\n$$\nH(q,p) = \\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)} - \\frac{1}{2} \\left(\\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)}\\right) = \\frac{1}{2} \\left(\\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)}\\right)\n$$\n明确写出，哈密顿量为：\n$$\nH(x,y,p_x,p_y) = \\frac{1}{2} \\left( \\frac{p_x^2}{1 + a\\,x^{2}} + \\frac{p_y^2}{1 + b\\,y^{2}} \\right)\n$$\n\n**哈密顿运动方程：**\n动力学由余切丛 $T^*Q \\cong \\mathbb{R}^4$ 上的哈密顿方程控制：\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p}, \\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}\n$$\n计算偏导数：\n$$\n\\dot{x} = \\frac{\\partial H}{\\partial p_x} = \\frac{p_x}{1 + a\\,x^{2}}\n$$\n$$\n\\dot{y} = \\frac{\\partial H}{\\partial p_y} = \\frac{p_y}{1 + b\\,y^{2}}\n$$\n$$\n\\dot{p}_x = -\\frac{\\partial H}{\\partial x} = -\\frac{1}{2} p_x^2 \\frac{\\partial}{\\partial x}(1 + a\\,x^{2})^{-1} = -\\frac{1}{2} p_x^2 (-1)(1 + a\\,x^{2})^{-2}(2ax) = \\frac{a\\,x\\,p_x^2}{(1 + a\\,x^{2})^2}\n$$\n$$\n\\dot{p}_y = -\\frac{\\partial H}{\\partial y} = -\\frac{1}{2} p_y^2 \\frac{\\partial}{\\partial y}(1 + b\\,y^{2})^{-1} = -\\frac{1}{2} p_y^2 (-1)(1 + b\\,y^{2})^{-2}(2by) = \\frac{b\\,y\\,p_y^2}{(1 + b\\,y^{2})^2}\n$$\n这个由四个一阶常微分方程组成的系统定义了测地流，并将使用 RK4 方法进行积分。\n\n### 2. 数值方法构建\n\n**A. 变分积分器 (VI)**\n变分积分器从离散拉格朗日量 $L_d(q_k, q_{k+1})$ 推导而来，该拉格朗日量近似了在一个时间步长 $h = t_{k+1}-t_k$ 上的作用量积分。我们使用指定的中点近似：\n$$\nL_d(q_k, q_{k+1}) \\approx h L\\left( \\frac{q_k + q_{k+1}}{2}, \\frac{q_{k+1} - q_k}{h} \\right)\n$$\n代入我们的拉格朗日量 $L$：\n$$\nL_d(q_k, q_{k+1}) = \\frac{h}{2} \\left[ A\\left(\\frac{x_k+x_{k+1}}{2}\\right) \\left(\\frac{x_{k+1}-x_k}{h}\\right)^2 + B\\left(\\frac{y_k+y_{k+1}}{2}\\right) \\left(\\frac{y_{k+1}-y_k}{h}\\right)^2 \\right]\n$$\n单步映射 $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ 由离散变分原理中的离散动量定义给出：\n$$\np_k = -D_1 L_d(q_k, q_{k+1}) \\quad \\text{和} \\quad p_{k+1} = D_2 L_d(q_k, q_{k+1})\n$$\n其中 $D_1$ 和 $D_2$ 分别表示对 $L_d$ 的第一个和第二个参数的导数。第一个方程 $p_k = -D_1 L_d(q_k, q_{k+1})$ 给出了一个关于 $q_{k+1}$ 的隐式关系，在每个时间步都必须求解。一旦求得 $q_{k+1}$，就可以用第二个方程显式计算 $p_{k+1}$。此方法定义了一个隐式的、保辛的单步映射。\n\n**B. 四阶龙格-库塔 (RK4) 方法**\n经典的 RK4 方法是一种用于形如 $\\dot{z} = f(t, z)$ 的常微分方程的通用非几何积分器。对于我们的自治系统，$z_{k+1} = F_{RK4}(z_k)$，其中 $z = (x,y,p_x,p_y)$，由以下公式给出：\n$$\nz_{k+1} = z_k + \\frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\n其中\n$$\nk_1 = f(z_k), \\quad k_2 = f(z_k + \\frac{h}{2}k_1), \\quad k_3 = f(z_k + \\frac{h}{2}k_2), \\quad k_4 = f(z_k + h k_3)\n$$\n此处，$f(z) = (\\dot{x}, \\dot{y}, \\dot{p}_x, \\dot{p}_y)^T$ 是在第1节中推导的哈密顿向量场。\n\n### 3. 用于比较的观测量\n\n**能量漂移：** 系统的总能量由哈密顿量 $H(q,p)$ 给出。对于哈密顿方程的精确解，能量是守恒的，即 $H(q(t), p(t)) = \\text{const}$。数值轨迹的能量漂移是在最终时刻 $T=N h$ 测量的绝对差 $|H(q_N, p_N) - H(q_0, p_0)|$。\n\n**辛性缺陷：** 哈密顿流的单步映射 $F$ 是辛的，这意味着其雅可比矩阵 $J(z)$ 满足 $J(z)^{\\top}\\Omega J(z) = \\Omega$，其中 $\\Omega = \\begin{pmatrix} 0 & I_2 \\\\ -I_2 & 0 \\end{pmatrix}$。数值映射 $F$ 在点 $z$ 的辛性缺陷由 $\\Delta(F;z) = J(z)^{\\top}\\Omega J(z) - \\Omega$ 的弗罗贝尼乌斯范数来测量。通过沿数值轨迹采样点来计算平均缺陷。数值映射 $F_{VI}$ 和 $F_{RK4}$ 的雅可比矩阵将使用二阶有限差分格式进行估计。一个完美的辛方法（理论上如 VI）其缺陷应在机器精度范围内为零。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print results.\n    \"\"\"\n\n    def hamiltonian(z, a, b):\n        \"\"\"Computes the Hamiltonian H(q,p).\"\"\"\n        x, y, px, py = z\n        term_x = px**2 / (1 + a * x**2) if (1 + a * x**2) != 0 else np.inf\n        term_y = py**2 / (1 + b * y**2) if (1 + b * y**2) != 0 else np.inf\n        return 0.5 * (term_x + term_y)\n\n    def hamiltonian_rhs(z, a, b):\n        \"\"\"Computes the right-hand side of Hamilton's equations, f(z).\"\"\"\n        x, y, px, py = z\n        ax2_1 = 1 + a * x**2\n        by2_1 = 1 + b * y**2\n        \n        x_dot = px / ax2_1\n        y_dot = py / by2_1\n        px_dot = (a * x * px**2) / (ax2_1**2)\n        py_dot = (b * y * py**2) / (by2_1**2)\n        \n        return np.array([x_dot, y_dot, px_dot, py_dot])\n\n    def rk4_step(z, h, a, b):\n        \"\"\"Performs one step of the classical RK4 method.\"\"\"\n        k1 = hamiltonian_rhs(z, a, b)\n        k2 = hamiltonian_rhs(z + 0.5 * h * k1, a, b)\n        k3 = hamiltonian_rhs(z + 0.5 * h * k2, a, b)\n        k4 = hamiltonian_rhs(z + h * k3, a, b)\n        return z + (h / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n\n    def vi_step(z, h, a, b):\n        \"\"\"Performs one step of the variational integrator.\"\"\"\n        x, y, px, py = z\n        \n        # Update x\n        if a * x == 0:\n            if a == 0: # Flat case\n                x_next = x + h * px\n            else: # x=0, curved case\n                x_next = h * px\n        else:\n            discriminant_x = (1 + a * x**2)**2 + 2 * a * h * x * px\n            if discriminant_x  0: # Should not happen for valid physics\n                discriminant_x = 0\n            x_next = (-1 + np.sqrt(discriminant_x)) / (a * x)\n            \n        # Update y\n        if b * y == 0:\n            if b == 0: # Flat case\n                y_next = y + h * py\n            else: # y=0, curved case\n                y_next = h * py\n        else:\n            discriminant_y = (1 + b * y**2)**2 + 2 * b * h * y * py\n            if discriminant_y  0:\n                discriminant_y = 0\n            y_next = (-1 + np.sqrt(discriminant_y)) / (b * y)\n\n        # Update momenta\n        if h == 0:\n            px_next = px\n            py_next = py\n        else:\n            px_next = px + a * (x + x_next) / 2.0 * (x_next - x)**2 / h\n            py_next = py + b * (y + y_next) / 2.0 * (y_next - y)**2 / h\n\n        return np.array([x_next, y_next, px_next, py_next])\n\n    def get_jacobian(map_func, z, h, a, b, eps=1e-8):\n        \"\"\"Estimates the Jacobian of a map F using central differences.\"\"\"\n        n = len(z)\n        J = np.zeros((n, n))\n        for j in range(n):\n            d_z = np.zeros(n)\n            d_z[j] = eps\n            z_plus = z + d_z\n            z_minus = z - d_z\n            \n            F_plus = map_func(z_plus, h, a, b)\n            F_minus = map_func(z_minus, h, a, b)\n            \n            J[:, j] = (F_plus - F_minus) / (2 * eps)\n        return J\n\n    def solve_one_case(a, b, h, T, q0, p0):\n        \"\"\"Integrates and analyzes one test case for both methods.\"\"\"\n        z0 = np.array([q0[0], q0[1], p0[0], p0[1]])\n        num_steps = int(round(T / h))\n        \n        # Define symplectic matrix Omega\n        Omega = np.array([[0, 0, 1, 0], [0, 0, 0, 1], [-1, 0, 0, 0], [0, -1, 0, 0]])\n        \n        methods = {\n            'VI': {'step_func': vi_step, 'traj': [z0]},\n            'RK': {'step_func': rk4_step, 'traj': [z0]}\n        }\n        \n        for name, method in methods.items():\n            z_current = z0\n            for _ in range(num_steps):\n                z_current = method['step_func'](z_current, h, a, b)\n                method['traj'].append(z_current)\n\n        # Analyze results\n        results = {}\n        H0 = hamiltonian(z0, a, b)\n        \n        # Sampling for symplecticity defect\n        num_samples = 100\n        sample_indices = np.linspace(0, num_steps, num_samples, dtype=int)\n\n        for name, method in methods.items():\n            # Energy drift\n            H_final = hamiltonian(method['traj'][-1], a, b)\n            results[f'E_{name}'] = np.abs(H_final - H0)\n            \n            # Symplecticity defect\n            defects = []\n            for k in sample_indices:\n                z_k = method['traj'][k]\n                J_k = get_jacobian(method['step_func'], z_k, h, a, b)\n                Delta_k = J_k.T @ Omega @ J_k - Omega\n                defects.append(np.linalg.norm(Delta_k, 'fro'))\n            results[f'S_{name}'] = np.mean(defects)\n\n        return results['E_VI'], results['E_RK'], results['S_VI'], results['S_RK']\n\n    test_cases = [\n        # TC1: a=0.5, b=0.25, h=0.05, T=50.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (0.5, 0.25, 0.05, 50.0, [0.5, -0.2], [1.0, 0.8]),\n        # TC2: a=0.0, b=0.0, h=0.05, T=50.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (0.0, 0.0, 0.05, 50.0, [0.5, -0.2], [1.0, 0.8]),\n        # TC3: a=2.0, b=4.0, h=0.02, T=40.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (2.0, 4.0, 0.02, 40.0, [0.5, -0.2], [1.0, 0.8]),\n    ]\n    \n    all_results = []\n    for params in test_cases:\n        e_vi, e_rk, s_vi, s_rk = solve_one_case(*params)\n        all_results.extend([e_vi, e_rk, s_vi, s_rk])\n        \n    print(f\"[{','.join(f'{r:.8e}' for r in all_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}