{
    "hands_on_practices": [
        {
            "introduction": "对一个理论的真正理解源于应用。第一个练习将提供一个机会，直接从欧拉方程的几何形式推导开尔文环量定理，并计算在一个二维环面上特定流动的环量。这个练习将巩固抽象的微分几何工具与具体物理量之间的联系。",
            "id": "3750840",
            "problem": "考虑一个在二维平坦环面 $ \\mathbb{T}^{2} = \\mathbb{R}^{2}/(2\\pi \\mathbb{Z})^{2} $ 上的理想、无粘性、正压流体，其角坐标为 $ (x,y) \\in [0,2\\pi) \\times [0,2\\pi) $，并采用标准欧几里得度量。设 $ v(t,\\cdot) $ 为流体速度矢量场，并令 $ \\alpha(t,\\cdot) = v(t,\\cdot)^{\\flat} $ 表示其度量对偶1-形式。假设运动由几何形式的正压欧拉方程控制\n$$\n\\partial_{t} \\alpha + \\mathcal{L}_{v} \\alpha = - \\mathrm{d} h(t,x,y),\n$$\n其中 $ h $ 是比焓，$ \\mathcal{L}_{v} $ 表示沿 $ v $ 的李导数。设 $ \\varphi_{t} $ 是 $ v $ 的流，并定义物质环路 $ \\gamma_{t} = \\varphi_{t} \\circ \\gamma_{0} $，其中初始环路是在高度 $ y_{0} \\in [0,2\\pi) $ 处的基本 $ x $-圈，\n$$\n\\gamma_{0}(s) = (s, y_{0}), \\quad s \\in [0,2\\pi].\n$$\n定义沿物质环路的环量为\n$$\n\\Gamma(t) = \\oint_{\\gamma_{t}} \\alpha(t).\n$$\n\n从给定的 $ \\alpha $ 的演化定律以及拉回和李导数的标准微分几何定义出发，推导 $ \\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) $ 的表达式，并用它来根据初始数据 $ \\alpha(0,\\cdot) = \\alpha_{0} $ 确定 $ \\Gamma(T) $。然后，对于特定的初始条件\n$$\n\\alpha_{0}(x,y) = U \\,\\mathrm{d}x + \\mathrm{d}\\psi(x,y),\n$$\n其中 $ U $ 是一个常数，$ \\psi $ 是一个关于每个自变量都光滑、均值为零的 $ 2\\pi $-周期函数，计算在任意 $ T \\ge 0 $ 时 $ \\Gamma(T) $ 的结果值。所有坐标和参数都是无量纲的，因此不需要物理单位。请用一个以 $ U $ 表示的闭式表达式来表达你的最终答案，无需四舍五入。最终答案必须是单个解析表达式。",
            "solution": "该问题被认为是有效的，因为它在科学上基于几何力学和流体动力学的原理，是适定的、客观的，并包含获得唯一解所需的所有必要信息。\n\n我们的目标是确定在任意时间 $T \\ge 0$ 的环量 $\\Gamma(T)$。我们首先分析环量 $\\Gamma(t)$ 的时间演化，它被定义为速度1-形式 $\\alpha(t)$ 沿物质环路 $\\gamma_t$ 的线积分：\n$$\n\\Gamma(t) = \\oint_{\\gamma_{t}} \\alpha(t)\n$$\n物质环路 $\\gamma_t$ 随流体流动而演化，即 $\\gamma_t = \\varphi_t \\circ \\gamma_0$，其中 $\\varphi_t$ 是速度场 $v(t)$ 的流映射，$\\gamma_0$ 是 $t=0$ 时的环路。为了处理依赖于时间的积分路径，我们进行变量替换，将积分拉回到固定的初始环路 $\\gamma_0$ 上。利用拉回 $\\varphi_t^*$ 的定义，环量可以表示为：\n$$\n\\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* \\alpha(t)\n$$\n我们现在对 $\\Gamma(t)$ 关于时间 $t$ 求导。由于积分域 $\\gamma_0$ 现在是固定的，我们可以将时间导数移到积分号内：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\frac{\\mathrm{d}}{\\mathrm{d} t} \\oint_{\\gamma_0} \\varphi_t^* \\alpha(t) = \\oint_{\\gamma_0} \\frac{\\mathrm{d}}{\\mathrm{d} t} \\left(\\varphi_t^* \\alpha(t)\\right)\n$$\n一个被拉回的、依赖时间的微分形式的时间导数由输运定理（或李导数的一个性质）给出：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\left(\\varphi_t^* \\alpha(t)\\right) = \\varphi_t^* \\left(\\partial_t \\alpha(t) + \\mathcal{L}_{v(t)} \\alpha(t)\\right)\n$$\n其中 $\\mathcal{L}_{v(t)}$ 是关于速度场 $v(t)$ 的李导数。将此代入环量时间导数的表达式中，得到：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* \\left(\\partial_t \\alpha(t) + \\mathcal{L}_{v(t)} \\alpha(t)\\right)\n$$\n问题给出了流体运动的控制方程，即几何形式的欧拉方程：\n$$\n\\partial_t \\alpha + \\mathcal{L}_v \\alpha = -\\mathrm{d}h\n$$\n其中 $h$ 是比焓，一个在流体域上的单值函数。将此代入我们关于 $\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t)$ 的方程中：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* (-\\mathrm{d}h) = - \\oint_{\\gamma_0} \\varphi_t^* (\\mathrm{d}h)\n$$\n拉回算子与外导数可交换，即 $\\varphi_t^* (\\mathrm{d}h) = \\mathrm{d}(\\varphi_t^* h)$。因此，\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = - \\oint_{\\gamma_0} \\mathrm{d}(\\varphi_t^* h)\n$$\n通过进行变量替换回到物质环路 $\\gamma_t$，我们得到：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = - \\oint_{\\gamma_t} \\mathrm{d}h\n$$\n根据线积分的微积分基本定理（斯托克斯定理的一个特例），恰当形式 $\\mathrm{d}h$ 在一条路径上的积分仅取决于函数 $h$ 在路径端点的值。初始环路 $\\gamma_0(s) = (s, y_0)$ 对于 $s \\in [0, 2\\pi]$ 是环面 $\\mathbb{T}^2$ 上的一个闭环路，因为其端点 $\\gamma_0(0)=(0,y_0)$ 和 $\\gamma_0(2\\pi)=(2\\pi,y_0)$ 是等同的。由于流映射 $\\varphi_t$ 是环面的一个微分同胚，它将闭环路映射到闭环路。因此，对所有 $t$，$\\gamma_t$ 都是一个闭环路。一个恰当微分在任何闭环路上的积分都为零。\n$$\n\\oint_{\\gamma_t} \\mathrm{d}h = 0\n$$\n这意味着环量的时间导数为零：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = 0\n$$\n这就是正压流体的开尔文环量定理。它表明环量 $\\Gamma(t)$ 随时间守恒。因此，它在任何时间 $T$ 的值都等于它在 $t=0$ 时的初始值：\n$$\n\\Gamma(T) = \\Gamma(0)\n$$\n我们现在使用给定的初始1-形式 $\\alpha_0(x,y) = U\\,\\mathrm{d}x + \\mathrm{d}\\psi(x,y)$ 和初始环路 $\\gamma_0(s) = (s, y_0)$（对于 $s \\in [0, 2\\pi]$）来计算初始环量 $\\Gamma(0)$。\n$$\n\\Gamma(0) = \\oint_{\\gamma_0} \\alpha_0 = \\oint_{\\gamma_0} \\left( U\\,\\mathrm{d}x + \\mathrm{d}\\psi \\right) = \\oint_{\\gamma_0} U\\,\\mathrm{d}x + \\oint_{\\gamma_0} \\mathrm{d}\\psi\n$$\n我们分别计算每个积分。对于第一个积分，我们用 $s \\in [0, 2\\pi]$ 参数化环路，其中 $x=s$ 且 $y=y_0$。则 $\\mathrm{d}x = \\mathrm{d}s$。\n$$\n\\oint_{\\gamma_0} U\\,\\mathrm{d}x = \\int_0^{2\\pi} U\\,\\mathrm{d}s = U [s]_0^{2\\pi} = U(2\\pi - 0) = 2\\pi U\n$$\n对于第二个积分，我们再次使用微积分基本定理：\n$$\n\\oint_{\\gamma_0} \\mathrm{d}\\psi = \\psi(\\gamma_0(2\\pi)) - \\psi(\\gamma_0(0)) = \\psi(2\\pi, y_0) - \\psi(0, y_0)\n$$\n问题陈述 $\\psi$ 是一个关于每个自变量都光滑的 $2\\pi$-周期函数。这意味着 $\\psi(x+2\\pi, y) = \\psi(x,y)$。因此，$\\psi(2\\pi, y_0) = \\psi(0, y_0)$，该积分为零：\n$$\n\\oint_{\\gamma_0} \\mathrm{d}\\psi = 0\n$$\n结合这些结果，初始环量为：\n$$\n\\Gamma(0) = 2\\pi U + 0 = 2\\pi U\n$$\n由于环量守恒，对于任何 $T \\ge 0$，$\\Gamma(T) = \\Gamma(0)$。\n因此，在时间 $T$ 的环量是 $2\\pi U$。",
            "answer": "$$\n\\boxed{2\\pi U}\n$$"
        },
        {
            "introduction": "在基本情况之上，这个练习将探索一个更复杂的场景，其中包含一个外部规范势，类似于磁流体动力学中的磁场。你将研究几何框架如何优雅地将这些场整合到一个广义的环量定理中。这个练习还通过考察一个非单连通空间上的流动，揭示了区域拓扑结构的关键作用，展现了几何、拓扑和守恒量之间深刻的相互作用。",
            "id": "3750841",
            "problem": "考虑一个定义在三维流形 $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$ 上的理想无粘正压流体，该流形具有标准欧几里得度规。设 $\\flat$ 表示由该度规诱导的从矢量场到1-形式的音乐同构。设 $u(x,t)$ 为流体速度场，动量1-形式由一个与时间无关的规范势1-形式 $A$ 增广，定义为 $m := u^{\\flat} + A$。假设单位质量的体积力是保守的（即一个标量势的梯度），且流动是正压的。\n\n在 $M$ 上的柱坐标系 $(r,\\theta,z)$ 中，考虑规范势1-形式 $A = \\lambda\\, d\\theta$，其中 $\\lambda$ 是一个实常数，$\\theta$ 是极角坐标。你可以使用流形上外微分的基本事实：外导数 $d$、内积 $\\iota_{u}$ 和李导数 $\\mathcal{L}_{u}$，以及对于任意微分形式 $\\alpha$ 的 Cartan 恒等式 $\\mathcal{L}_{u}\\alpha = d(\\iota_{u}\\alpha) + \\iota_{u}(d\\alpha)$。你也可以使用理想正压流体的经典 Euler 方程及其推导出的1-形式几何表述，以及对于任意含时1-形式 $\\alpha$ 的物质环路输运恒等式 $\\frac{d}{dt}\\oint_{C_{t}}\\alpha = \\oint_{C_{t}}(\\partial_{t}\\alpha + \\mathcal{L}_{u}\\alpha)$，其中 $C_{t}$ 是一个被流平流的闭合环路。\n\n任务：\n1. 计算 $dA$ 并判断 $A$ 在 $M$ 上是否闭合。使用适用于 $M$ 的恰当性检验，判断 $A$ 在 $M$ 上是否恰当。\n2. 从具有保守体积力的正压流的 Euler 方程的几何1-形式表述出发，并使用1-形式的输运恒等式，推导 $\\frac{d}{dt}\\oint_{C_{t}} m$ 的表达式，并证明它是一个恰当微分的环路积分。由此推断其对任意物质环路 $C_{t}$ 上环量的影响。\n3. 考虑特殊情况 $u(x,t) \\equiv 0$ (对所有 $t$ 成立)，并设 $C_{0}$ 为 $z=0$ 平面上的单位圆，在 $r=1$ 处由 $\\theta \\in [0,2\\pi)$ 参数化。计算守恒环量 $\\Gamma := \\oint_{C_{t}} m$，并用 $\\lambda$ 将你的最终答案表示为单个闭式解析表达式。\n\n将最终答案表示为解析表达式。不需要四舍五入，也不需要报告物理单位。",
            "solution": "该问题要求在几何力学框架内，对存在类磁规范势的流体运动进行三部分分析。\n\n### 第1部分：规范势1-形式 $A$ 的分析\n\n规范势以1-形式 $A = \\lambda\\, d\\theta$ 给出，定义在流形 $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$ 上，其中 $\\lambda$ 是一个实常数，$(r, \\theta, z)$ 是柱坐标。\n\n首先，我们计算 $A$ 的外导数，以确定它是否为闭形式。如果 $d\\alpha = 0$，则形式 $\\alpha$ 是闭合的。\n$$\ndA = d(\\lambda\\, d\\theta)\n$$\n由于 $\\lambda$ 是一个常数，它可以从外导数算子中提出。外导数算子 $d$ 具有这样的性质：对于任何0-形式（标量函数）$f$，$d(df) = d^2f = 0$。在我们的例子中，$\\theta$ 是一个坐标函数，它是一个0-形式，因此 $d\\theta$ 是一个1-形式。\n$$\ndA = \\lambda\\, d(d\\theta) = \\lambda\\, d^{2}\\theta = 0\n$$\n由于 $dA=0$ 在 $M$ 上处处成立，所以1-形式 $A$ 是闭合的。\n\n接下来，我们判断 $A$ 在 $M$ 上是否为恰当形式。如果存在一个标量函数 $f$（一个0-形式）使得 $\\alpha = df$，则1-形式 $\\alpha$ 是恰当的。根据 Poincaré 引理，在星形（或更一般地，可收缩）区域上的闭形式总是恰当的。然而，流形 $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$ 是不可收缩的；它与圆 $S^1$ 同伦等价，并具有一个非平凡的第一 de Rham 上同调群 $H_{dR}^1(M) \\cong \\mathbb{R}$。\n\n为了检验其恰当性，我们可以沿一条在 $M$ 内不能收缩为一个点的闭合环路对 $A$ 进行积分。如果 $A$ 是恰当的（$A=df$），那么根据 Stokes 定理（或更基本地，根据恰当形式沿闭合路径积分的定义），该积分必须为零：$\\oint_C A = \\oint_C df = 0$。\n我们选择环路 $C$ 为 $z=0$ 平面内以原点为中心的单位圆。该环路由 $r=1$，$z=0$，以及从 $0$ 到 $2\\pi$ 变化的 $\\theta$ 参数化。\n$A$ 沿 $C$ 的积分为：\n$$\n\\oint_{C} A = \\oint_{C} \\lambda\\, d\\theta = \\lambda \\int_{0}^{2\\pi} d\\theta\n$$\n$$\n\\oint_{C} A = \\lambda [\\theta]_{0}^{2\\pi} = \\lambda(2\\pi - 0) = 2\\pi\\lambda\n$$\n要使此积分为零，必须有 $\\lambda=0$。如果 $\\lambda \\neq 0$，则积分不为零。存在一个闭合环路， $A$ 在其上的积分不为零，这证明了当 $\\lambda \\neq 0$ 时，$A$ 在 $M$ 上不是一个恰当形式。\n\n总结：1-形式 $A = \\lambda \\, d\\theta$ 在 $M$ 上是闭合的，但除非 $\\lambda=0$，否则在 $M$ 上不是恰当的。\n\n### 第2部分：广义环量定理的推导\n\n我们希望找到广义环量 $\\Gamma_m = \\oint_{C_t} m$ 对时间的导数表达式，其中 $m = u^\\flat + A$，$C_t$ 是被流体流 $u$ 平流的物质环路。我们使用给定的物质环路输运恒等式：\n$$\n\\frac{d}{dt}\\oint_{C_{t}}\\alpha = \\oint_{C_{t}}(\\partial_{t}\\alpha + \\mathcal{L}_{u}\\alpha)\n$$\n我们令 $\\alpha = m = u^\\flat + A$。根据算子的线性性，被积函数变为：\n$$\n\\partial_{t}m + \\mathcal{L}_{u}m = \\partial_{t}(u^\\flat + A) + \\mathcal{L}_{u}(u^\\flat + A) = (\\partial_{t}u^\\flat + \\mathcal{L}_{u}u^\\flat) + (\\partial_{t}A + \\mathcal{L}_{u}A)\n$$\n我们逐项分析：\n1.  问题提到了具有保守体积力的理想正压流体的 Euler 方程的几何1-形式表述。该方程由下式给出：\n    $$\n    \\partial_{t}u^\\flat + \\mathcal{L}_{u}u^\\flat = -dB\n    $$\n    其中 $B$ 是标量 Bernoulli 函数，通常形式为 $B = \\frac{1}{2}|u|^2 + h + P$，其中 $h$ 是比焓，$P$ 是体积力的势。关键特征是右侧是一个恰当1-形式。\n\n2.  规范势 $A$ 是不含时的，所以 $\\partial_{t}A = 0$。\n\n3.  为了分析 $\\mathcal{L}_{u}A$ 项，我们使用 Cartan 恒等式：$\\mathcal{L}_{u}A = d(\\iota_{u}A) + \\iota_{u}(dA)$。在第1部分中，我们已证明 $A$ 是一个闭形式，因此 $dA = 0$。这将李导数简化为：\n    $$\n    \\mathcal{L}_{u}A = d(\\iota_{u}A)\n    $$\n    这表明 $\\mathcal{L}_{u}A$ 也是一个恰当1-形式，其中 $\\iota_{u}A$ 是矢量场 $u$ 与1-形式 $A$ 的内积所产生的标量函数。\n\n将这些结果代回被积函数中：\n$$\n\\partial_{t}m + \\mathcal{L}_{u}m = -dB + d(\\iota_{u}A) = d(\\iota_{u}A - B)\n$$\n整个被积函数是一个恰当1-形式。现在，我们可以计算环量的时间导数：\n$$\n\\frac{d}{dt}\\oint_{C_{t}} m = \\oint_{C_{t}} d(\\iota_{u}A - B)\n$$\n一个恰当微分形式在任何闭合环路（如 $C_t$）上的积分恒为零。\n$$\n\\frac{d}{dt}\\oint_{C_{t}} m = 0\n$$\n这个结果是该系统的广义 Kelvin 环量定理。它意味着广义环量 $\\Gamma_m = \\oint_{C_t} m$ 是一个守恒量；当物质环路 $C_t$ 被流平流时，其值不发生改变。\n\n### 第3部分：守恒环量的计算\n\n我们被要求计算守恒环量 $\\Gamma = \\oint_{C_t} m$ 的值，针对流体速度恒为零的特殊情况，即对所有时间 $t$ 都有 $u(x,t) = 0$。初始环路 $C_0$ 是 $z=0$ 平面上的单位圆，由 $r=1$，$z=0$，以及 $\\theta \\in [0, 2\\pi)$ 参数化。\n\n由于环量是守恒的，它的值对所有时间都是常数，且等于其在 $t=0$ 时的值：\n$$\n\\Gamma = \\oint_{C_t} m = \\oint_{C_0} m_0\n$$\n其中 $m_0$ 是 $t=0$ 时的增广动量1-形式。\n增广动量为 $m = u^\\flat + A$。\n由于 $u=0$，相应的动量1-形式 $u^\\flat$ 也是零1-形式。\n因此，$m = 0 + A = A$。\n需要计算的环量是：\n$$\n\\Gamma = \\oint_{C_0} A\n$$\n这与我们在第1部分中为证明 $A$ 不是恰当形式而计算的积分相同。\n$$\n\\Gamma = \\oint_{C_0} \\lambda\\, d\\theta = \\lambda \\int_0^{2\\pi} d\\theta\n$$\n$$\n\\Gamma = \\lambda(2\\pi - 0) = 2\\pi\\lambda\n$$\n这是在零流体速度条件下，对于任何初始为 $z=0$ 平面单位圆的环路的守恒环量值。由于 $u=0$，环路 $C_t$ 保持静止，因此对所有 $t$ 都有 $C_t = C_0$。",
            "answer": "$$\\boxed{2\\pi\\lambda}$$"
        },
        {
            "introduction": "最后的练习旨在连接连续理论与计算科学。你将实现一个变分积分器——一种旨在保持系统几何结构的现代数值方法——来模拟一个哈密顿流体流动。通过数值验证离散版本环量的近似守恒，这个练习展示了该几何方法在开发稳健且物理上忠实的模拟中的深远实用价值。",
            "id": "3750838",
            "problem": "考虑一个边长为 $2\\pi$ 且具有周期性边界条件的方形区域上的二维不可压缩流，该流被建模为 $\\mathbb{R}^2$ 上的一个哈密顿系统，其典范辛形式为 $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$。设哈密顿量为 $H(x,y) = \\sin(x) + \\sin(y)$，流体速度场为哈密顿向量场 $\\mathbf{V}(x,y) = J \\nabla H(x,y)$，其中 $J$ 是典范辛矩阵 $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$，$\\nabla H$ 是 $H$ 的梯度。角度应以弧度为单位。\n\n从基本原理和核心定义出发，您将需要：\n\n1. 使用哈密顿向量场的定义性质 $\\iota_{\\mathbf{X}_H} \\omega = \\mathrm{d}H$ 以及典范辛形式与面积保持的等同关系，推导出连续时间哈密顿流 $\\dot{\\mathbf{q}} = J \\nabla H(\\mathbf{q})$，其中 $\\mathbf{q} = (x,y)^\\top$。\n\n2. 利用适用于保守体力作用下无粘性正压流的 Kelvin 环量定理的几何表述，将沿物质环路的环量解释为动量1-形式在该环路上的积分，并解释为何对于所选的不依赖时间的哈密顿量和不可压缩速度场，围绕物质环路的连续环量不随时间变化。\n\n3. 通过基于中点取值的合适离散拉格朗日量构造离散作用量，为上述哈密顿系统构建一个离散变分积分器。推导 $\\mathbf{q}_{k+1}$ 关于 $\\mathbf{q}_k$ 和哈密顿向量场的相应隐式更新法则，并论证为何该方法是辛的，并且作为粒子重标记对称性和离散版本的 Noether 定理的结果，表现出离散 Kelvin 性质（近似保持一个离散化的环量）。\n\n4. 在一个闭合多边形环路 $\\gamma = \\{\\mathbf{q}_0,\\mathbf{q}_1,\\ldots,\\mathbf{q}_{N-1}\\}$ (其中下标对 $N$ 取模) 上定义一个离散环量泛函：\n$$\n\\Gamma(\\gamma) \\approx \\sum_{i=0}^{N-1} \\mathbf{V}\\!\\left(\\frac{\\mathbf{q}_i + \\mathbf{q}_{i+1}}{2}\\right) \\cdot (\\mathbf{q}_{i+1} - \\mathbf{q}_i),\n$$\n该泛函是曲线积分 $\\oint_{\\gamma} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$ 的一个中点求积近似。此处 $\\cdot$ 表示欧几里得内积，$\\mathbf{V}$ 使用 $\\partial H/\\partial y$ 和 $-\\partial H/\\partial x$ 按分量进行计算。\n\n5. 实现一个程序，该程序：\n   - 生成中心位于 $(\\pi,\\pi)$ 的指定形状的初始闭合多边形环路：\n     - 圆形：由 $\\mathbf{q}(\\theta) = (\\pi + r \\cos\\theta,\\, \\pi + r \\sin\\theta)$ 参数化，其中 $\\theta$ 在 $[0,2\\pi)$ 内均匀采样。\n     - 正方形：一个轴对齐多边形，其顶点均匀分布在中心位于 $(\\pi,\\pi)$、半边长为 $a$ 的正方形周长上；点应在所有四条边上均匀间隔分布，以形成一个闭合多边形。\n     - 8字形：由 $\\mathbf{q}(\\theta) = (\\pi + r \\sin\\theta,\\, \\pi + r \\sin(2\\theta))$ 参数化，其中 $\\theta$ 在 $[0,2\\pi)$ 内均匀采样。\n   - 使用第 (3) 部分推导的隐式中点变分积分器，以固定步长 $h$ 将环路的每个顶点随时间推进 $N$ 步，得到一个平流输运后的环路。\n   - 计算初始环路和输运后环路的离散环量 $\\Gamma$，并报告绝对环量漂移 $|\\Delta \\Gamma| = |\\Gamma_{\\text{final}} - \\Gamma_{\\text{initial}}|$。\n\n所有角度计算必须以弧度为单位。不涉及物理单位；所有输出均为无量纲浮点数。\n\n测试套件：\n为以下五个测试用例提供绝对环量漂移值（浮点数），每个用例由形状类型、多边形点数 $N_p$、形状参数（半径 $r$ 或半边长 $a$）、时间步长 $h$ 和步数 $N$ 定义：\n- 用例 1 (一般情况，中等分辨率和步长): 圆形, $N_p = 64$, $r = 0.5$, $h = 0.05$, $N = 20$。\n- 用例 2 (较大步长的边界情况): 圆形, $N_p = 64$, $r = 0.5$, $h = 0.2$, $N = 5$。\n- 用例 3 (粗糙多边形，测试求积效应): 正方形, $N_p = 8$, $a = 0.5$, $h = 0.05$, $N = 20$。\n- 用例 4 (复杂环路几何): 8字形, $N_p = 128$, $r = 0.5$, $h = 0.05$, $N = 20$。\n- 用例 5 (边界情况，零时间演化): 圆形, $N_p = 64$, $r = 0.5$, $h = 0.05$, $N = 0$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4,result5]”），每个结果对应上面列出的每个用例的绝对环量漂移。每个结果必须是浮点数。",
            "solution": "该问题要求在几何力学的框架内，针对 Kelvin 环量定理进行多部分的理论推导和最终的数值实现。我们将按顺序处理五个指定任务中的每一个。\n\n### 第 1 部分：连续时间哈密顿流的推导\n\n我们给定一个在 $\\mathbb{R}^2$ 上的系统，其坐标为 $\\mathbf{q} = (x, y)^\\top$。其动力学由一个哈密顿量 $H(x, y)$ 和一个典范辛形式 $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$ 控制。系统的时间演化由哈密顿向量场（记为 $\\mathbf{X}_H$）的流来描述，该向量场由哈密顿力学的基本关系隐式定义：\n$$\n\\iota_{\\mathbf{X}_H} \\omega = \\mathrm{d}H\n$$\n此处，$\\iota_{\\mathbf{X}_H} \\omega$ 表示向量场 $\\mathbf{X}_H$ 与 2-形式 $\\omega$ 的内积，结果是一个 1-形式。项 $\\mathrm{d}H$ 是标量函数 $H$ 的外微分，它也是一个 1-形式。\n\n让我们将向量场用分量表示为 $\\mathbf{X}_H = (v_x, v_y)^\\top$。哈密顿量 $H(x, y)$ 的外微分是：\n$$\n\\mathrm{d}H = \\frac{\\partial H}{\\partial x} \\mathrm{d}x + \\frac{\\partial H}{\\partial y} \\mathrm{d}y\n$$\n内积可以在坐标中计算。对于一般向量场 $\\mathbf{V} = (V_x, V_y)^\\top$ 和典范 2-形式 $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$，内积为：\n$$\n\\iota_{\\mathbf{V}} \\omega = V_x (\\iota_{\\partial/\\partial x} (\\mathrm{d}x \\wedge \\mathrm{d}y)) + V_y (\\iota_{\\partial/\\partial y} (\\mathrm{d}x \\wedge \\mathrm{d}y))\n$$\n使用性质 $\\iota_{\\mathbf{u}}(\\alpha \\wedge \\beta) = (\\iota_{\\mathbf{u}}\\alpha)\\wedge\\beta - \\alpha\\wedge(\\iota_{\\mathbf{u}}\\beta)$ 以及 $\\iota_{\\partial/\\partial x}\\mathrm{d}x = 1$、$\\iota_{\\partial/\\partial x}\\mathrm{d}y = 0$ 等，我们发现：\n$$\n\\iota_{\\partial/\\partial x} (\\mathrm{d}x \\wedge \\mathrm{d}y) = \\mathrm{d}y\n$$\n$$\n\\iota_{\\partial/\\partial y} (\\mathrm{d}x \\wedge \\mathrm{d}y) = -\\mathrm{d}x\n$$\n将这些代入 $\\iota_{\\mathbf{V}} \\omega$ 的表达式中，得到：\n$$\n\\iota_{\\mathbf{V}} \\omega = V_x \\mathrm{d}y - V_y \\mathrm{d}x\n$$\n将此应用于我们的哈密顿向量场 $\\mathbf{X}_H = (v_x, v_y)^\\top$，我们得到：\n$$\n\\iota_{\\mathbf{X}_H} \\omega = v_x \\mathrm{d}y - v_y \\mathrm{d}x\n$$\n现在，我们令两个 1-形式 $\\iota_{\\mathbf{X}_H} \\omega$ 和 $\\mathrm{d}H$ 相等：\n$$\nv_x \\mathrm{d}y - v_y \\mathrm{d}x = \\frac{\\partial H}{\\partial x} \\mathrm{d}x + \\frac{\\partial H}{\\partial y} \\mathrm{d}y\n$$\n通过比较基 1-形式 $\\mathrm{d}x$ 和 $\\mathrm{d}y$ 的系数，我们得到哈密顿向量场的分量：\n$$\nv_x = \\frac{\\partial H}{\\partial y}\n$$\n$$\n-v_y = \\frac{\\partial H}{\\partial x} \\implies v_y = -\\frac{\\partial H}{\\partial x}\n$$\n连续时间流由 $\\dot{\\mathbf{q}} = \\mathbf{X}_H(\\mathbf{q})$ 给出。其矩阵形式为：\n$$\n\\dot{\\mathbf{q}} = \\begin{pmatrix} \\dot{x} \\\\ \\dot{y} \\end{pmatrix} = \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} \\partial H / \\partial y \\\\ -\\partial H / \\partial x \\end{pmatrix}\n$$\n这可以用典范辛矩阵 $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$ 和哈密顿量的梯度 $\\nabla H = (\\partial H / \\partial x, \\partial H / \\partial y)^\\top$ 表示：\n$$\n\\dot{\\mathbf{q}} = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} \\partial H / \\partial x \\\\ \\partial H / \\partial y \\end{pmatrix} = J \\nabla H(\\mathbf{q})\n$$\n这个推导证实了给定的运动方程。由哈密顿向量场生成的流保持辛形式 $\\omega$ 不变。由于 $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$ 是典范面积形式，它在流作用下的保持性意味着流是保面积的。在流体动力学的背景下，其中哈密顿量 $H$ 被解释为流函数，二维中的保面积流等价于不可压缩流，因为速度场 $\\mathbf{V} = \\mathbf{X}_H$ 的散度为 $\\nabla \\cdot \\mathbf{V} = \\frac{\\partial}{\\partial x}(\\frac{\\partial H}{\\partial y}) - \\frac{\\partial}{\\partial y}(\\frac{\\partial H}{\\partial x}) = 0$。\n\n### 第 2 部分：连续环量的守恒\n\nKelvin 环量定理适用于保守体力作用下的理想（无粘性、正压）流体。它指出，围绕一个闭合物质环路 $\\gamma(t)$（一个随流体移动的环路）的环量 $\\Gamma = \\oint_{\\gamma(t)} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$ 不随时间变化，即 $\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = 0$。\n\n让我们验证给定系统的条件：\n1.  **无粘性**：系统由哈密顿力学描述，其本质上是保守且非耗散的。没有粘性项。\n2.  **正压性**：流是不可压缩的，这意味着密度恒定。这是正压流体的一个特例，其中密度仅是压力的函数（这里是常数函数）。\n3.  **保守力**：速度场 $\\mathbf{V}$ 由一个不依赖于时间的哈密顿量 $H$ 导出。这表明控制动力学的基本力是保守的。\n\n环量是 1-形式 $\\alpha = V_x \\mathrm{d}x + V_y \\mathrm{d}y$ 沿环路 $\\gamma$ 的积分。沿物质环路的环量变化率由 $\\alpha$ 相对于平流输运向量场 $\\mathbf{V}$ 的李导数的积分给出：\n$$\n\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = \\oint_{\\gamma(t)} L_{\\mathbf{V}} \\alpha\n$$\n使用 Cartan 魔术公式，李导数为 $L_{\\mathbf{V}}\\alpha = \\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) + \\mathrm{d}(\\iota_{\\mathbf{V}}\\alpha)$。\n我们来计算各项：\n-   $\\iota_{\\mathbf{V}}\\alpha = \\mathbf{V} \\cdot \\mathbf{V} = |\\mathbf{V}|^2$，速度大小的平方。\n-   $\\mathrm{d}\\alpha$ 是速度 1-形式的外微分，对应于涡量。\n    $$\n    \\mathrm{d}\\alpha = \\mathrm{d}(V_x \\mathrm{d}x + V_y \\mathrm{d}y) = \\left(\\frac{\\partial V_y}{\\partial x} - \\frac{\\partial V_x}{\\partial y}\\right) \\mathrm{d}x \\wedge \\mathrm{d}y\n    $$\n    给定 $V_x = \\frac{\\partial H}{\\partial y} = \\cos(y)$ 和 $V_y = -\\frac{\\partial H}{\\partial x} = -\\cos(x)$:\n    $$\n    \\frac{\\partial V_y}{\\partial x} = \\sin(x), \\quad \\frac{\\partial V_x}{\\partial y} = -\\sin(y)\n    $$\n    涡量标量为 $\\zeta = \\sin(x) + \\sin(y)$。\n    注意到 $\\zeta = H(x,y)$。所以，涡量 2-形式为 $\\mathrm{d}\\alpha = H \\cdot (\\mathrm{d}x \\wedge \\mathrm{d}y) = H \\omega$。\n-   现在我们计算 $\\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) = \\iota_{\\mathbf{V}}(H \\omega)$。因为 $H$ 是一个标量函数，所以 $\\iota_{\\mathbf{V}}(H \\omega) = H (\\iota_{\\mathbf{V}}\\omega)$。从第 1 部分，我们知道 $\\iota_{\\mathbf{V}}\\omega = \\mathrm{d}H$。\n    因此，$\\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) = H \\mathrm{d}H = \\mathrm{d}\\left(\\frac{1}{2} H^2\\right)$。\n\n将这些代回 Cartan 公式：\n$$\nL_{\\mathbf{V}}\\alpha = \\mathrm{d}\\left(\\frac{1}{2} H^2\\right) + \\mathrm{d}(|\\mathbf{V}|^2) = \\mathrm{d}\\left(\\frac{1}{2} H^2 + |\\mathbf{V}|^2\\right)\n$$\n李导数是一个恰当 1-形式。根据 Stokes 定理，一个恰当形式在闭合环路上的积分为零：\n$$\n\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = \\oint_{\\gamma(t)} L_{\\mathbf{V}} \\alpha = \\oint_{\\gamma(t)} \\mathrm{d}\\left(\\frac{1}{2} H^2 + |\\mathbf{V}|^2\\right) = 0\n$$\n因此，环量 $\\Gamma$ 是连续流的一个守恒量，与 Kelvin 定理完全一致。\n\n### 第 3 部分：离散变分积分器\n\n变分积分器将驻定作用量原理离散化。对于一个哈密顿系统，一类特别有效的变分积分器可以从一个为近似时间步长 $h$ 上的作用量积分而构造的离散拉格朗日量中推导出来。隐式中点格式是一个可以从此类原理推导出来的著名辛积分器。对于一般常微分方程 $\\dot{\\mathbf{q}} = f(\\mathbf{q})$，隐式中点格式为：\n$$\n\\frac{\\mathbf{q}_{k+1} - \\mathbf{q}_k}{h} = f\\left(\\frac{\\mathbf{q}_k + \\mathbf{q}_{k+1}}{2}\\right)\n$$\n对于我们的哈密顿系统，$f(\\mathbf{q}) = J \\nabla H(\\mathbf{q})$。因此，更新法则是：\n$$\n\\mathbf{q}_{k+1} - \\mathbf{q}_k = h J \\nabla H\\left(\\frac{\\mathbf{q}_k + \\mathbf{q}_{k+1}}{2}\\right)\n$$\n这是一个给定 $\\mathbf{q}_k$ 时关于 $\\mathbf{q}_{k+1}$ 的隐式方程。\n\n**辛性质**：隐式中点格式是 Gauss-Legendre 族 Runge-Kutta 方法的一员，这些方法都是辛的。一个数值映射是辛的，如果它保持辛 2-形式 $\\omega$ 不变。这个性质的原因是深刻的：该方法可以从使用离散拉格朗日量 $L_d(\\mathbf{q}_k, \\mathbf{q}_{k+1})$ 的 Hamilton 原理的离散版本推导出来，该离散拉格朗日量近似了作用量积分 $\\int_{t_k}^{t_{k+1}} L(\\mathbf{q}, \\dot{\\mathbf{q}})\\mathrm{d}t$。任何从离散变分原理（离散 Euler-Lagrange 方程）推导出的积分器都会自动保持一个辛形式的离散类比物，并且在极限 $h \\to 0$ 下，这对应于保持连续辛形式 $\\omega$。因此，隐式中点法是辛的。\n\n**离散 Kelvin 性质**：在连续情况下，Kelvin 环量定理是 Noether 定理应用于流体拉格朗日量的粒子重标记对称性的直接结果。该对称性本质上表明，物理定律不依赖于分配给流体粒子的特定身份标签。一个构造良好的离散拉格朗日量，例如基于像中点格式这样的对称求积格式的拉格朗日量，会继承这种粒子重标记对称性。根据 Noether 定理的离散版本，离散作用量中的这种对称性意味着某个量（称为离散环量）的精确守恒。虽然问题中定义的特定量 $\\Gamma(\\gamma)$ 可能不是这个精确守恒的量，但它是一个很好的近似。因为辛积分器提供了一个流映射，它是真实（保持环量的）哈密顿流的一个非常精确的近似，所以 $\\Gamma(\\gamma)$ 的数值演化将表现出优异的长期行为，其误差有界，而不会出现长期漂移。这种对离散环量泛函的近似保持就是离散 Kelvin 性质。\n\n### 第 4 部分：离散环量泛函\n\n问题将离散环量泛函定义为曲线积分 $\\oint_{\\gamma} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$ 的一个中点求积近似。对于一个顶点为 $\\{\\mathbf{q}_0, \\mathbf{q}_1, \\ldots, \\mathbf{q}_{N-1}\\}$ 的闭合多边形环路 $\\gamma$，该泛函为：\n$$\n\\Gamma(\\gamma) = \\sum_{i=0}^{N-1} \\mathbf{V}\\!\\left(\\frac{\\mathbf{q}_i + \\mathbf{q}_{i+1}}{2}\\right) \\cdot (\\mathbf{q}_{i+1} - \\mathbf{q}_i)\n$$\n其中下标对 $N$ 取模（即 $\\mathbf{q}_N = \\mathbf{q}_0$），$\\cdot$ 是欧几里得点积。向量场 $\\mathbf{V}(x,y)$ 在每个线段 $[\\mathbf{q}_i, \\mathbf{q}_{i+1}]$ 的中点处进行计算。对于我们的系统，$\\mathbf{V}(x,y) = (\\cos(y), -\\cos(x))$。对于足够光滑的曲线，此公式提供了对连续环量积分的二阶精确近似。\n\n### 第 5 部分：实现计划\n\n实现将遵循一个结构化的方法：\n1.  **辅助函数**：定义哈密顿梯度 $\\nabla H(\\mathbf{q}) = (\\cos(x), \\cos(y))^\\top$ 和速度场 $\\mathbf{V}(\\mathbf{q}) = J \\nabla H(\\mathbf{q}) = (\\cos(y), -\\cos(x))^\\top$ 的 Python 函数。\n2.  **环路生成**：创建函数以根据指定的参数化和点数生成圆形、正方形和 8 字形形状的初始顶点。对于正方形，点将根据沿周长的弧长进行分布，以确保它们是均匀间隔的。\n3.  **隐式求解器**：实现一个函数来求解隐式中点方程以得到 $\\mathbf{q}_{k+1}$。由于对于给定的步长，隐式映射具有收缩性（如在思考过程中分析的那样），将使用一个简单的定点迭代，即 $\\mathbf{z}_{j+1} = \\mathbf{q}_k + h J \\nabla H((\\mathbf{q}_k + \\mathbf{z}_j)/2)$。它将被迭代固定次数或直到满足严格的收敛容差。\n4.  **环量计算**：实现第 4 部分中定义的离散环量泛函 $\\Gamma(\\gamma)$。\n5.  **主模拟循环**：对于五个测试用例中的每一个：\n    a. 生成初始点环路。\n    b. 计算初始环量 $\\Gamma_{\\text{initial}}$。\n    c. 使用隐式中点求解器将环路的每个顶点推进 $N$ 个时间步。\n    d. 计算输运后环路的最终环量 $\\Gamma_{\\text{final}}$。\n    e. 计算并存储绝对环量漂移 $|\\Delta \\Gamma| = |\\Gamma_{\\text{final}} - \\Gamma_{\\text{initial}}|$。$N=0$ 的情况作为基线，应产生零漂移。\n6.  **输出**：最终结果将被格式化为指定的字符串 `\"[result1,result2,result3,result4,result5]\"`。\n\n这种结构化的方法将基于所推导的理论得出所需的数值结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    # Canonical symplectic matrix J\n    J = np.array([[0, 1], [-1, 0]])\n\n    def grad_H(q):\n        \"\"\"Computes the gradient of the Hamiltonian H(x,y) = sin(x) + sin(y).\"\"\"\n        x, y = q\n        return np.array([np.cos(x), np.cos(y)])\n\n    def velocity_field(q):\n        \"\"\"Computes the Hamiltonian vector field V = J * grad(H).\"\"\"\n        x, y = q\n        return np.array([np.cos(y), -np.cos(x)])\n\n    def implicit_midpoint_step(q_k, h):\n        \"\"\"\n        Advances a single point q_k by one time step h using the implicit midpoint rule.\n        The implicit equation is solved using a fixed-point iteration.\n        \"\"\"\n        # Initial guess for q_{k+1} using an explicit Euler step\n        z = q_k + h * (J @ grad_H(q_k))\n        \n        # Fixed point iteration for 10 steps (more than sufficient for convergence)\n        for _ in range(10):\n            q_mid = (q_k + z) / 2.0\n            z = q_k + h * (J @ grad_H(q_mid))\n        \n        return z\n\n    def generate_circle(Np, r):\n        \"\"\"Generates a circle centered at (pi, pi) with radius r.\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n        center = np.array([np.pi, np.pi])\n        points = center + r * np.array([np.cos(thetas), np.sin(thetas)]).T\n        return points\n\n    def generate_square(Np, a):\n        \"\"\"Generates a square centered at (pi, pi) with half-side a.\"\"\"\n        center = np.pi\n        perimeter = 8 * a\n        arc_lengths = np.linspace(0, perimeter, Np, endpoint=False)\n        points = np.zeros((Np, 2))\n        \n        for i, s in enumerate(arc_lengths):\n            if s  2 * a:\n                # Bottom edge\n                points[i, :] = [center - a + s, center - a]\n            elif s  4 * a:\n                # Right edge\n                points[i, :] = [center + a, center - a + (s - 2 * a)]\n            elif s  6 * a:\n                # Top edge\n                points[i, :] = [center + a - (s - 4 * a), center + a]\n            else:\n                # Left edge\n                points[i, :] = [center - a, center + a - (s - 6 * a)]\n        return points\n\n    def generate_figure_eight(Np, r):\n        \"\"\"Generates a figure-eight curve centered at (pi, pi).\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n        center = np.array([np.pi, np.pi])\n        points = center + r * np.array([np.sin(thetas), np.sin(2 * thetas)]).T\n        return points\n\n    def calculate_circulation(loop_points):\n        \"\"\"\n        Calculates the discrete circulation for a closed polygonal loop.\n        \"\"\"\n        gamma = 0.0\n        num_points = len(loop_points)\n        for i in range(num_points):\n            q_i = loop_points[i]\n            q_i_plus_1 = loop_points[(i + 1) % num_points]\n            \n            mid_point = (q_i + q_i_plus_1) / 2.0\n            segment_vector = q_i_plus_1 - q_i\n            \n            v_mid = velocity_field(mid_point)\n            \n            gamma += np.dot(v_mid, segment_vector)\n            \n        return gamma\n\n    test_cases = [\n        # (shape_type, Np, shape_param, h, N_steps)\n        ('circle', 64, 0.5, 0.05, 20),\n        ('circle', 64, 0.5, 0.2, 5),\n        ('square', 8, 0.5, 0.05, 20),\n        ('figure-eight', 128, 0.5, 0.05, 20),\n        ('circle', 64, 0.5, 0.05, 0),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        shape_type, Np, shape_param, h, N_steps = case\n\n        # 1. Generate initial loop\n        if shape_type == 'circle':\n            initial_loop = generate_circle(Np, shape_param)\n        elif shape_type == 'square':\n            initial_loop = generate_square(Np, shape_param)\n        elif shape_type == 'figure-eight':\n            initial_loop = generate_figure_eight(Np, shape_param)\n        else:\n            raise ValueError(f\"Unknown shape type: {shape_type}\")\n\n        # 2. Compute initial circulation\n        circ_initial = calculate_circulation(initial_loop)\n\n        # 3. Advect the loop in time\n        current_loop = initial_loop\n        if N_steps > 0:\n            for _ in range(N_steps):\n                next_loop = np.array([implicit_midpoint_step(q, h) for q in current_loop])\n                current_loop = next_loop\n        \n        final_loop = current_loop\n\n        # 4. Compute final circulation\n        circ_final = calculate_circulation(final_loop)\n\n        # 5. Calculate absolute circulation drift and store result\n        abs_drift = abs(circ_final - circ_initial)\n        results.append(abs_drift)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}