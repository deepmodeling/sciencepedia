{
    "hands_on_practices": [
        {
            "introduction": "To build a solid foundation, we begin with a direct application of the core principles on a familiar manifold. This practice asks you to prove Kelvin's circulation theorem for an ideal barotropic fluid on a two-dimensional torus, starting from the geometric form of the Euler equations . By explicitly calculating the time-derivative of the circulation and showing it vanishes, you will gain hands-on experience with fundamental tools like the Lie derivative, the transport theorem, and Stokes' theorem, cementing your understanding of how these concepts work together in a concrete calculation.",
            "id": "3750840",
            "problem": "Consider an ideal, inviscid, barotropic fluid on the two-dimensional flat torus $ \\mathbb{T}^{2} = \\mathbb{R}^{2}/(2\\pi \\mathbb{Z})^{2} $ with angular coordinates $ (x,y) \\in [0,2\\pi) \\times [0,2\\pi) $ and the standard Euclidean metric. Let $ v(t,\\cdot) $ be the fluid velocity vector field and let $ \\alpha(t,\\cdot) = v(t,\\cdot)^{\\flat} $ denote its metric-dual one-form. Assume the motion is governed by the barotropic Euler equations in geometric form\n$$\n\\partial_{t} \\alpha + \\mathcal{L}_{v} \\alpha = - \\mathrm{d} h(t,x,y),\n$$\nwhere $ h $ is the specific enthalpy and $ \\mathcal{L}_{v} $ denotes the Lie derivative along $ v $. Let $ \\varphi_{t} $ be the flow of $ v $, and define the material loop $ \\gamma_{t} = \\varphi_{t} \\circ \\gamma_{0} $, where the initial loop is the fundamental $ x $-cycle at height $ y_{0} \\in [0,2\\pi) $,\n$$\n\\gamma_{0}(s) = (s, y_{0}), \\quad s \\in [0,2\\pi].\n$$\nDefine the circulation along the material loop by\n$$\n\\Gamma(t) = \\oint_{\\gamma_{t}} \\alpha(t).\n$$\n\nStarting from the given evolution law for $ \\alpha $ and standard differential geometric definitions of pullback and Lie derivative, derive an expression for $ \\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) $ and use it to determine $ \\Gamma(T) $ in terms of the initial data $ \\alpha(0,\\cdot) = \\alpha_{0} $. Then, for the specific initial condition\n$$\n\\alpha_{0}(x,y) = U \\,\\mathrm{d}x + \\mathrm{d}\\psi(x,y),\n$$\nwhere $ U $ is a constant and $ \\psi $ is a smooth $ 2\\pi $-periodic function in each argument with zero mean, compute the resulting value of $ \\Gamma(T) $ for arbitrary $ T \\ge 0 $. All coordinates and parameters are dimensionless, so no physical units are required. Express your final answer as a closed-form expression in terms of $ U $, with no rounding. The final answer must be a single analytic expression.",
            "solution": "The problem is found to be valid as it is scientifically grounded in the principles of geometric mechanics and fluid dynamics, is well-posed, objective, and contains all necessary information for a unique solution.\n\nOur objective is to determine the circulation $\\Gamma(T)$ at an arbitrary time $T \\ge 0$. We begin by analyzing the time evolution of the circulation $\\Gamma(t)$, which is defined as the line integral of the velocity one-form $\\alpha(t)$ along a material loop $\\gamma_t$:\n$$\n\\Gamma(t) = \\oint_{\\gamma_{t}} \\alpha(t)\n$$\nThe material loop $\\gamma_t$ evolves with the fluid flow, meaning $\\gamma_t = \\varphi_t \\circ \\gamma_0$, where $\\varphi_t$ is the flow map of the velocity field $v(t)$, and $\\gamma_0$ is the loop at $t=0$. To handle the time-dependent integration path, we perform a change of variables, pulling the integral back to the fixed initial loop $\\gamma_0$. Using the definition of the pullback $\\varphi_t^*$, the circulation can be expressed as:\n$$\n\\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* \\alpha(t)\n$$\nWe now differentiate $\\Gamma(t)$ with respect to time $t$. Since the integration domain $\\gamma_0$ is now fixed, we can move the time derivative inside the integral:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\frac{\\mathrm{d}}{\\mathrm{d} t} \\oint_{\\gamma_0} \\varphi_t^* \\alpha(t) = \\oint_{\\gamma_0} \\frac{\\mathrm{d}}{\\mathrm{d} t} \\left(\\varphi_t^* \\alpha(t)\\right)\n$$\nThe time derivative of a pulled-back, time-dependent differential form is given by the transport theorem (or a property of the Lie derivative):\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\left(\\varphi_t^* \\alpha(t)\\right) = \\varphi_t^* \\left(\\partial_t \\alpha(t) + \\mathcal{L}_{v(t)} \\alpha(t)\\right)\n$$\nwhere $\\mathcal{L}_{v(t)}$ is the Lie derivative with respect to the velocity field $v(t)$. Substituting this into our expression for the time derivative of circulation gives:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* \\left(\\partial_t \\alpha(t) + \\mathcal{L}_{v(t)} \\alpha(t)\\right)\n$$\nThe problem provides the governing equation for the fluid motion, which is the Euler equation in geometric form:\n$$\n\\partial_t \\alpha + \\mathcal{L}_v \\alpha = -\\mathrm{d}h\n$$\nwhere $h$ is the specific enthalpy, a single-valued function on the fluid domain. Substituting this into our equation for $\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t)$:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = \\oint_{\\gamma_0} \\varphi_t^* (-\\mathrm{d}h) = - \\oint_{\\gamma_0} \\varphi_t^* (\\mathrm{d}h)\n$$\nThe pullback operator commutes with the exterior derivative, i.e., $\\varphi_t^* (\\mathrm{d}h) = \\mathrm{d}(\\varphi_t^* h)$. Thus,\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = - \\oint_{\\gamma_0} \\mathrm{d}(\\varphi_t^* h)\n$$\nBy performing a change of variables back to the material loop $\\gamma_t$, we get:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = - \\oint_{\\gamma_t} \\mathrm{d}h\n$$\nAccording to the Fundamental Theorem of Calculus for line integrals (a special case of Stokes' theorem), the integral of an exact form $\\mathrm{d}h$ over a path depends only on the values of the function $h$ at the endpoints of the path. The initial loop $\\gamma_0(s) = (s, y_0)$ for $s \\in [0, 2\\pi]$ is a closed loop on the torus $\\mathbb{T}^2$ because its endpoints $\\gamma_0(0)=(0,y_0)$ and $\\gamma_0(2\\pi)=(2\\pi,y_0)$ are identified. Since the flow map $\\varphi_t$ is a diffeomorphism of the torus, it maps closed loops to closed loops. Therefore, $\\gamma_t$ is a closed loop for all $t$. The integral of an exact differential over any closed loop is zero.\n$$\n\\oint_{\\gamma_t} \\mathrm{d}h = 0\n$$\nThis implies that the time derivative of the circulation is zero:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\Gamma(t) = 0\n$$\nThis is Kelvin's circulation theorem for a barotropic fluid. It shows that the circulation $\\Gamma(t)$ is conserved over time. Therefore, its value at any time $T$ is equal to its initial value at $t=0$:\n$$\n\\Gamma(T) = \\Gamma(0)\n$$\nWe now compute the initial circulation $\\Gamma(0)$ using the given initial one-form $\\alpha_0(x,y) = U\\,\\mathrm{d}x + \\mathrm{d}\\psi(x,y)$ and the initial loop $\\gamma_0(s) = (s, y_0)$ for $s \\in [0, 2\\pi]$.\n$$\n\\Gamma(0) = \\oint_{\\gamma_0} \\alpha_0 = \\oint_{\\gamma_0} \\left( U\\,\\mathrm{d}x + \\mathrm{d}\\psi \\right) = \\oint_{\\gamma_0} U\\,\\mathrm{d}x + \\oint_{\\gamma_0} \\mathrm{d}\\psi\n$$\nWe evaluate each integral separately. For the first integral, we parametrize the loop with $s \\in [0, 2\\pi]$, where $x=s$ and $y=y_0$. Then $\\mathrm{d}x = \\mathrm{d}s$.\n$$\n\\oint_{\\gamma_0} U\\,\\mathrm{d}x = \\int_0^{2\\pi} U\\,\\mathrm{d}s = U [s]_0^{2\\pi} = U(2\\pi - 0) = 2\\pi U\n$$\nFor the second integral, we again use the Fundamental Theorem of Calculus:\n$$\n\\oint_{\\gamma_0} \\mathrm{d}\\psi = \\psi(\\gamma_0(2\\pi)) - \\psi(\\gamma_0(0)) = \\psi(2\\pi, y_0) - \\psi(0, y_0)\n$$\nThe problem states that $\\psi$ is a smooth $2\\pi$-periodic function in each argument. This implies $\\psi(x+2\\pi, y) = \\psi(x,y)$. Therefore, $\\psi(2\\pi, y_0) = \\psi(0, y_0)$, and the integral is zero:\n$$\n\\oint_{\\gamma_0} \\mathrm{d}\\psi = 0\n$$\nCombining these results, the initial circulation is:\n$$\n\\Gamma(0) = 2\\pi U + 0 = 2\\pi U\n$$\nSince circulation is conserved, $\\Gamma(T) = \\Gamma(0)$ for any $T \\ge 0$.\nThus, the circulation at time $T$ is $2\\pi U$.",
            "answer": "$$\n\\boxed{2\\pi U}\n$$"
        },
        {
            "introduction": "Building on the foundational proof, this exercise explores how the theorem generalizes to more complex physical systems involving background fields, akin to the role of a vector potential in electromagnetism . You will analyze a momentum one-form augmented by a gauge potential on a topologically non-trivial manifold, specifically $\\mathbb{R}^{3}$ with the $z$-axis removed. This practice illuminates the crucial distinction between closed and exact differential forms and demonstrates how the topology of the domain can lead to conserved quantities that are not present in simpler, contractible spaces.",
            "id": "3750841",
            "problem": "Consider an ideal inviscid barotropic fluid on the three-dimensional manifold $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$ with the standard Euclidean metric, and let $\\flat$ denote the musical isomorphism from vector fields to one-forms induced by the metric. Let $u(x,t)$ be the fluid velocity field, and let the momentum one-form be augmented by a time-independent gauge potential one-form $A$, defining $m := u^{\\flat} + A$. Assume the body force per unit mass is conservative (i.e., a gradient of a scalar potential) and the flow is barotropic.\n\nIn cylindrical coordinates $(r,\\theta,z)$ on $M$, consider the gauge potential one-form $A = \\lambda\\, d\\theta$, where $\\lambda$ is a real constant and $\\theta$ is the polar angle coordinate. You may use fundamental facts about exterior calculus on manifolds: the exterior derivative $d$, the interior product $\\iota_{u}$, and the Lie derivative $\\mathcal{L}_{u}$, together with Cartan’s identity $\\mathcal{L}_{u}\\alpha = d(\\iota_{u}\\alpha) + \\iota_{u}(d\\alpha)$ for any differential form $\\alpha$. You may also use the classical Euler equation for an ideal barotropic fluid and its one-form geometric formulation derived from it, together with the material loop transport identity $\\frac{d}{dt}\\oint_{C_{t}}\\alpha = \\oint_{C_{t}}(\\partial_{t}\\alpha + \\mathcal{L}_{u}\\alpha)$ for any time-dependent one-form $\\alpha$, where $C_{t}$ is a closed loop advected by the flow.\n\nTasks:\n1. Compute $dA$ and determine whether $A$ is closed on $M$. Using an exactness test appropriate for $M$, decide whether $A$ is exact on $M$.\n2. Starting from the geometric one-form formulation of the Euler equation for barotropic flows with conservative body forces and using the transport identity for one-forms, derive the expression for $\\frac{d}{dt}\\oint_{C_{t}} m$ and show that it is the loop integral of an exact differential. Conclude the implication for the circulation along any material loop $C_{t}$.\n3. Specialize to the case $u(x,t) \\equiv 0$ for all $t$ and let $C_{0}$ be the unit circle in the plane $z=0$, parameterized by $\\theta \\in [0,2\\pi)$ at $r=1$. Compute the conserved circulation $\\Gamma := \\oint_{C_{t}} m$ and express your final answer as a single closed-form analytic expression in terms of $\\lambda$.\n\nExpress the final answer as an analytic expression. No rounding is required and no physical units are to be reported.",
            "solution": "The problem asks for a three-part analysis of fluid motion in the presence of a magnetic-like gauge potential, within the framework of geometric mechanics.\n\n### Part 1: Analysis of the Gauge Potential One-Form $A$\n\nThe gauge potential is given as the one-form $A = \\lambda\\, d\\theta$ on the manifold $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$, where $\\lambda$ is a real constant and $(r, \\theta, z)$ are cylindrical coordinates.\n\nFirst, we compute the exterior derivative of $A$ to determine if it is a closed form. A form $\\alpha$ is closed if $d\\alpha = 0$.\n$$\ndA = d(\\lambda\\, d\\theta)\n$$\nSince $\\lambda$ is a constant, it can be pulled out of the exterior derivative operator. The exterior derivative operator $d$ has the property that for any $0$-form (scalar function) $f$, $d(df) = d^2f = 0$. In our case, $\\theta$ is a coordinate function, which is a $0$-form, so $d\\theta$ is a $1$-form.\n$$\ndA = \\lambda\\, d(d\\theta) = \\lambda\\, d^{2}\\theta = 0\n$$\nSince $dA = 0$ everywhere on $M$, the one-form $A$ is closed.\n\nNext, we determine if $A$ is an exact form on $M$. A one-form $\\alpha$ is exact if there exists a scalar function $f$ (a $0$-form) such that $\\alpha = df$. According to the Poincaré lemma, a closed form on a star-shaped (or more generally, contractible) domain is always exact. However, the manifold $M = \\mathbb{R}^{3} \\setminus \\{z\\text{-axis}\\}$ is not contractible; it is homotopy equivalent to a circle $S^1$ and has a non-trivial first de Rham cohomology group $H_{dR}^1(M) \\cong \\mathbb{R}$.\n\nTo test for exactness, we can integrate $A$ over a closed loop that is not contractible to a point within $M$. If $A$ were exact ($A=df$), then by Stokes' theorem (or more fundamentally, the definition of an integral of an exact form over a closed path), the integral must be zero: $\\oint_C A = \\oint_C df = 0$.\nLet us choose the loop $C$ to be the unit circle in the $z=0$ plane, centered at the origin. This loop is parameterized by $r=1$, $z=0$, and $\\theta$ varying from $0$ to $2\\pi$.\nThe integral of $A$ along $C$ is:\n$$\n\\oint_{C} A = \\oint_{C} \\lambda\\, d\\theta = \\lambda \\int_{0}^{2\\pi} d\\theta\n$$\n$$\n\\oint_{C} A = \\lambda [\\theta]_{0}^{2\\pi} = \\lambda(2\\pi - 0) = 2\\pi\\lambda\n$$\nFor this integral to be zero, we must have $\\lambda=0$. If $\\lambda \\neq 0$, the integral is non-zero. The existence of a closed loop over which the integral of $A$ is non-zero proves that $A$ is not an exact form on $M$ for $\\lambda \\neq 0$.\n\nIn summary: The one-form $A = \\lambda \\, d\\theta$ is closed on $M$, but it is not exact on $M$ unless $\\lambda=0$.\n\n### Part 2: Derivation of the Generalized Circulation Theorem\n\nWe wish to find an expression for the time derivative of the generalized circulation, $\\Gamma_m = \\oint_{C_t} m$, where $m = u^\\flat + A$ and $C_t$ is a material loop advected by the fluid flow $u$. We use the given material loop transport identity:\n$$\n\\frac{d}{dt}\\oint_{C_{t}}\\alpha = \\oint_{C_{t}}(\\partial_{t}\\alpha + \\mathcal{L}_{u}\\alpha)\n$$\nWe set $\\alpha = m = u^\\flat + A$. By the linearity of the operators, the integrand becomes:\n$$\n\\partial_{t}m + \\mathcal{L}_{u}m = \\partial_{t}(u^\\flat + A) + \\mathcal{L}_{u}(u^\\flat + A) = (\\partial_{t}u^\\flat + \\mathcal{L}_{u}u^\\flat) + (\\partial_{t}A + \\mathcal{L}_{u}A)\n$$\nWe analyze each term:\n1.  The problem refers to the geometric one-form formulation of the Euler equation for an ideal barotropic fluid with a conservative body force. This equation is given by:\n    $$\n    \\partial_{t}u^\\flat + \\mathcal{L}_{u}u^\\flat = -dB\n    $$\n    where $B$ is the scalar Bernoulli function, typically of the form $B = \\frac{1}{2}|u|^2 + h + P$, with $h$ being the specific enthalpy and $P$ the potential for the body force. The crucial feature is that the right-hand side is an exact one-form.\n\n2.  The gauge potential $A$ is given as time-independent, so $\\partial_{t}A = 0$.\n\n3.  To analyze the term $\\mathcal{L}_{u}A$, we use Cartan's identity: $\\mathcal{L}_{u}A = d(\\iota_{u}A) + \\iota_{u}(dA)$. From Part 1, we established that $A$ is a closed form, so $dA = 0$. This simplifies the Lie derivative to:\n    $$\n    \\mathcal{L}_{u}A = d(\\iota_{u}A)\n    $$\n    This shows that $\\mathcal{L}_{u}A$ is also an exact one-form, where $\\iota_{u}A$ is the scalar function resulting from the interior product of the vector field $u$ with the one-form $A$.\n\nSubstituting these results back into the integrand:\n$$\n\\partial_{t}m + \\mathcal{L}_{u}m = -dB + d(\\iota_{u}A) = d(\\iota_{u}A - B)\n$$\nThe entire integrand is an exact one-form. Now, we can evaluate the time derivative of the circulation:\n$$\n\\frac{d}{dt}\\oint_{C_{t}} m = \\oint_{C_{t}} d(\\iota_{u}A - B)\n$$\nThe integral of an exact differential form over any closed loop (like $C_t$) is identically zero.\n$$\n\\frac{d}{dt}\\oint_{C_{t}} m = 0\n$$\nThis result is the generalized Kelvin's circulation theorem for this system. It implies that the generalized circulation, $\\Gamma_m = \\oint_{C_t} m$, is a conserved quantity; its value does not change as the material loop $C_t$ is advected by the flow.\n\n### Part 3: Computation of the Conserved Circulation\n\nWe are asked to compute the value of the conserved circulation $\\Gamma = \\oint_{C_t} m$ for the specific case where the fluid velocity is identically zero, $u(x,t) = 0$ for all time $t$. The initial loop $C_0$ is the unit circle in the $z=0$ plane, parameterized by $r=1$, $z=0$, with $\\theta \\in [0, 2\\pi)$.\n\nSince the circulation is conserved, its value is constant for all time and is equal to its value at $t=0$:\n$$\n\\Gamma = \\oint_{C_t} m = \\oint_{C_0} m_0\n$$\nwhere $m_0$ is the augmented momentum one-form at $t=0$.\nThe augmented momentum is $m = u^\\flat + A$.\nSince $u=0$, the corresponding momentum one-form $u^\\flat$ is also the zero one-form.\nTherefore, $m = 0 + A = A$.\nThe circulation to be computed is:\n$$\n\\Gamma = \\oint_{C_0} A\n$$\nThis is the same integral we evaluated in Part 1 to demonstrate that $A$ is not an exact form.\n$$\n\\Gamma = \\oint_{C_0} \\lambda\\, d\\theta = \\lambda \\int_0^{2\\pi} d\\theta\n$$\n$$\n\\Gamma = \\lambda(2\\pi - 0) = 2\\pi\\lambda\n$$\nThis is the value of the conserved circulation for any loop that is initially the unit circle in the $z=0$ plane, under the condition of zero fluid velocity. Since $u=0$, the loop $C_t$ remains stationary, so $C_t = C_0$ for all $t$.",
            "answer": "$$\\boxed{2\\pi\\lambda}$$"
        },
        {
            "introduction": "The final practice bridges the gap between continuous theory and computational physics, exploring how the conservation properties of Kelvin's theorem manifest in the discrete world of numerical simulation . You will work with a Hamiltonian system that models a 2D incompressible flow and derive a special type of numerical method known as a symplectic or variational integrator. This exercise demonstrates that while generic numerical schemes often fail to preserve geometric invariants, structure-preserving integrators give rise to a \"discrete Kelvin's theorem,\" ensuring that a discrete version of circulation is nearly conserved over long-time simulations.",
            "id": "3750838",
            "problem": "Consider a two-dimensional incompressible flow on the square domain with side length $2\\pi$ and periodic boundary conditions, modeled as a Hamiltonian system on $\\mathbb{R}^2$ with canonical symplectic form $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$. Let the Hamiltonian be $H(x,y) = \\sin(x) + \\sin(y)$, and let the fluid velocity field be the Hamiltonian vector field $\\mathbf{V}(x,y) = J \\nabla H(x,y)$, where $J$ is the canonical symplectic matrix $J = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$ and $\\nabla H$ is the gradient of $H$. Angles are to be treated in radians.\n\nStarting from fundamental principles and core definitions, you will:\n\n1. Derive the continuous-time Hamiltonian flow $\\dot{\\mathbf{q}} = J \\nabla H(\\mathbf{q})$, where $\\mathbf{q} = (x,y)^\\top$, using the defining property of Hamiltonian vector fields $\\iota_{\\mathbf{X}_H} \\omega = \\mathrm{d}H$ and the identification of the canonical symplectic form with area preservation.\n\n2. Using the geometric formulation of Kelvin's circulation theorem for inviscid barotropic flows under conservative body forces, interpret the circulation along a material loop as the integral of the momentum one-form along that loop, and explain why, for the chosen time-independent Hamiltonian and incompressible velocity field, the continuous circulation around a material loop is constant in time.\n\n3. Construct a discrete variational integrator for the above Hamiltonian system by forming a discrete action from a suitable discrete Lagrangian based on midpoint evaluation. Derive the corresponding implicit update for $\\mathbf{q}_{k+1}$ in terms of $\\mathbf{q}_k$ and the Hamiltonian vector field, and argue why this method is symplectic and exhibits a discrete Kelvin property (near preservation of a discretized circulation) as a consequence of particle relabeling symmetry and a discrete version of Noether's theorem.\n\n4. Define a discrete circulation functional on a closed polygonal loop $\\gamma = \\{\\mathbf{q}_0,\\mathbf{q}_1,\\ldots,\\mathbf{q}_{N-1}\\}$, where indices are taken modulo $N$, by\n$$\n\\Gamma(\\gamma) \\approx \\sum_{i=0}^{N-1} \\mathbf{V}\\!\\left(\\frac{\\mathbf{q}_i + \\mathbf{q}_{i+1}}{2}\\right) \\cdot (\\mathbf{q}_{i+1} - \\mathbf{q}_i),\n$$\nwhich is a midpoint quadrature approximation of the line integral $\\oint_{\\gamma} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$. Here $\\cdot$ denotes the Euclidean inner product, and $\\mathbf{V}$ is evaluated componentwise using $\\partial H/\\partial y$ and $-\\partial H/\\partial x$.\n\n5. Implement a program that:\n   - Generates initial closed polygonal loops of specified shapes centered at $(\\pi,\\pi)$:\n     - Circle: parameterized by $\\mathbf{q}(\\theta) = (\\pi + r \\cos\\theta,\\, \\pi + r \\sin\\theta)$ with $\\theta$ uniformly sampled in $[0,2\\pi)$.\n     - Square: axis-aligned polygon with vertices evenly distributed along the perimeter of the square centered at $(\\pi,\\pi)$ with half-side length $a$; points should be uniformly spaced along all four edges to produce a closed polygon.\n     - Figure-eight: parameterized by $\\mathbf{q}(\\theta) = (\\pi + r \\sin\\theta,\\, \\pi + r \\sin(2\\theta))$ with $\\theta$ uniformly sampled in $[0,2\\pi)$.\n   - Advances each vertex of the loop in time using the implicit midpoint variational integrator derived in part (3), with a fixed step size $h$ for $N$ steps, producing an advected loop.\n   - Computes the discrete circulation $\\Gamma$ of the initial loop and the advected loop, and reports the absolute circulation drift $|\\Delta \\Gamma| = |\\Gamma_{\\text{final}} - \\Gamma_{\\text{initial}}|$.\n\nAll angle computations must be in radians. No physical units are involved; all outputs are dimensionless floats.\n\nTest Suite:\nProvide the absolute circulation drift values (floats) for the following five test cases, each defined by a shape type, number of polygon points $N_p$, shape parameter (radius $r$ or half-side $a$), time step $h$, and number of steps $N$:\n- Case 1 (general case, moderate resolution and step size): Circle, $N_p = 64$, $r = 0.5$, $h = 0.05$, $N = 20$.\n- Case 2 (edge case with larger step size): Circle, $N_p = 64$, $r = 0.5$, $h = 0.2$, $N = 5$.\n- Case 3 (coarse polygon, testing quadrature effects): Square, $N_p = 8$, $a = 0.5$, $h = 0.05$, $N = 20$.\n- Case 4 (complex loop geometry): Figure-eight, $N_p = 128$, $r = 0.5$, $h = 0.05$, $N = 20$.\n- Case 5 (boundary case, zero-time evolution): Circle, $N_p = 64$, $r = 0.5$, $h = 0.05$, $N = 0$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), where each result corresponds to the absolute circulation drift for each case in the order listed above. Each result must be a float.",
            "solution": "The problem requires a multi-part theoretical derivation and a final numerical implementation concerning Kelvin's circulation theorem within the framework of geometric mechanics. We shall proceed by addressing each of the five specified tasks in sequential order.\n\n### Part 1: Derivation of the Continuous-Time Hamiltonian Flow\n\nWe are given a system on $\\mathbb{R}^2$ with coordinates $\\mathbf{q} = (x, y)^\\top$. The dynamics are governed by a Hamiltonian $H(x, y)$ and a canonical symplectic form $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$. The time evolution of the system is described by the flow of the Hamiltonian vector field, denoted $\\mathbf{X}_H$, which is implicitly defined by the fundamental relation of Hamiltonian mechanics:\n$$\n\\iota_{\\mathbf{X}_H} \\omega = \\mathrm{d}H\n$$\nHere, $\\iota_{\\mathbf{X}_H} \\omega$ represents the interior product of the vector field $\\mathbf{X}_H$ with the two-form $\\omega$, resulting in a one-form. The term $\\mathrm{d}H$ is the exterior derivative of the scalar function $H$, which is also a one-form.\n\nLet us express the vector field in components as $\\mathbf{X}_H = (v_x, v_y)^\\top$. The exterior derivative of the Hamiltonian $H(x, y)$ is:\n$$\n\\mathrm{d}H = \\frac{\\partial H}{\\partial x} \\mathrm{d}x + \\frac{\\partial H}{\\partial y} \\mathrm{d}y\n$$\nThe interior product can be computed in coordinates. For a general vector field $\\mathbf{V} = (V_x, V_y)^\\top$ and the canonical two-form $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$, the interior product is:\n$$\n\\iota_{\\mathbf{V}} \\omega = V_x (\\iota_{\\partial/\\partial x} (\\mathrm{d}x \\wedge \\mathrm{d}y)) + V_y (\\iota_{\\partial/\\partial y} (\\mathrm{d}x \\wedge \\mathrm{d}y))\n$$\nUsing the property $\\iota_{\\mathbf{u}}(\\alpha \\wedge \\beta) = (\\iota_{\\mathbf{u}}\\alpha)\\wedge\\beta - \\alpha\\wedge(\\iota_{\\mathbf{u}}\\beta)$ and $\\iota_{\\partial/\\partial x}\\mathrm{d}x = 1$, $\\iota_{\\partial/\\partial x}\\mathrm{d}y = 0$, etc., we find:\n$$\n\\iota_{\\partial/\\partial x} (\\mathrm{d}x \\wedge \\mathrm{d}y) = \\mathrm{d}y\n$$\n$$\n\\iota_{\\partial/\\partial y} (\\mathrm{d}x \\wedge \\mathrm{d}y) = -\\mathrm{d}x\n$$\nSubstituting these into the expression for $\\iota_{\\mathbf{V}} \\omega$ gives:\n$$\n\\iota_{\\mathbf{V}} \\omega = V_x \\mathrm{d}y - V_y \\mathrm{d}x\n$$\nApplying this to our Hamiltonian vector field $\\mathbf{X}_H = (v_x, v_y)^\\top$, we get:\n$$\n\\iota_{\\mathbf{X}_H} \\omega = v_x \\mathrm{d}y - v_y \\mathrm{d}x\n$$\nNow, we equate the two one-forms, $\\iota_{\\mathbf{X}_H} \\omega$ and $\\mathrm{d}H$:\n$$\nv_x \\mathrm{d}y - v_y \\mathrm{d}x = \\frac{\\partial H}{\\partial x} \\mathrm{d}x + \\frac{\\partial H}{\\partial y} \\mathrm{d}y\n$$\nBy comparing the coefficients of the basis one-forms $\\mathrm{d}x$ and $\\mathrm{d}y$, we obtain the components of the Hamiltonian vector field:\n$$\nv_x = \\frac{\\partial H}{\\partial y}\n$$\n$$\n-v_y = \\frac{\\partial H}{\\partial x} \\implies v_y = -\\frac{\\partial H}{\\partial x}\n$$\nThe continuous-time flow is given by $\\dot{\\mathbf{q}} = \\mathbf{X}_H(\\mathbf{q})$. In matrix form, this is:\n$$\n\\dot{\\mathbf{q}} = \\begin{pmatrix} \\dot{x} \\\\ \\dot{y} \\end{pmatrix} = \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix} = \\begin{pmatrix} \\partial H / \\partial y \\\\ -\\partial H / \\partial x \\end{pmatrix}\n$$\nThis can be expressed using the canonical symplectic matrix $J = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$ and the gradient of the Hamiltonian $\\nabla H = (\\partial H / \\partial x, \\partial H / \\partial y)^\\top$:\n$$\n\\dot{\\mathbf{q}} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\begin{pmatrix} \\partial H / \\partial x \\\\ \\partial H / \\partial y \\end{pmatrix} = J \\nabla H(\\mathbf{q})\n$$\nThis derivation confirms the given equation of motion. The flow generated by a Hamiltonian vector field preserves the symplectic form $\\omega$. Since $\\omega = \\mathrm{d}x \\wedge \\mathrm{d}y$ is the canonical area form, its preservation under the flow means the flow is area-preserving. In the context of fluid dynamics, where the Hamiltonian $H$ is interpreted as the stream function, an area-preserving flow in two dimensions is equivalent to an incompressible flow, as the divergence of the velocity field $\\mathbf{V} = \\mathbf{X}_H$ is $\\nabla \\cdot \\mathbf{V} = \\frac{\\partial}{\\partial x}(\\frac{\\partial H}{\\partial y}) - \\frac{\\partial}{\\partial y}(\\frac{\\partial H}{\\partial x}) = 0$.\n\n### Part 2: Conservation of Continuous Circulation\n\nKelvin's circulation theorem applies to an ideal (inviscid, barotropic) fluid under conservative body forces. It states that the circulation $\\Gamma = \\oint_{\\gamma(t)} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$ around a closed material loop $\\gamma(t)$ (a loop that moves with the fluid) is constant in time, i.e., $\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = 0$.\n\nLet us verify the conditions for the given system:\n1.  **Inviscid**: The system is described by Hamiltonian mechanics, which is inherently conservative and non-dissipative. There are no viscosity terms.\n2.  **Barotropic**: The flow is incompressible, which implies constant density. This is a special case of a barotropic fluid, where density is a function only of pressure (here, a constant function).\n3.  **Conservative Forces**: The velocity field $\\mathbf{V}$ is derived from a time-independent Hamiltonian $H$. This indicates that the underlying forces governing the dynamics are conservative.\n\nThe circulation is the integral of the one-form $\\alpha = V_x \\mathrm{d}x + V_y \\mathrm{d}y$ along the loop $\\gamma$. The rate of change of circulation along a material loop is given by the integral of the Lie derivative of $\\alpha$ with respect to the advecting vector field $\\mathbf{V}$:\n$$\n\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = \\oint_{\\gamma(t)} L_{\\mathbf{V}} \\alpha\n$$\nUsing Cartan's magic formula, the Lie derivative is $L_{\\mathbf{V}}\\alpha = \\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) + \\mathrm{d}(\\iota_{\\mathbf{V}}\\alpha)$.\nLet's compute the terms:\n-   $\\iota_{\\mathbf{V}}\\alpha = \\mathbf{V} \\cdot \\mathbf{V} = |\\mathbf{V}|^2$, the squared magnitude of the velocity.\n-   $\\mathrm{d}\\alpha$ is the exterior derivative of the velocity one-form, which corresponds to the vorticity.\n    $$\n    \\mathrm{d}\\alpha = \\mathrm{d}(V_x \\mathrm{d}x + V_y \\mathrm{d}y) = \\left(\\frac{\\partial V_y}{\\partial x} - \\frac{\\partial V_x}{\\partial y}\\right) \\mathrm{d}x \\wedge \\mathrm{d}y\n    $$\n    Given $V_x = \\frac{\\partial H}{\\partial y} = \\cos(y)$ and $V_y = -\\frac{\\partial H}{\\partial x} = -\\cos(x)$:\n    $$\n    \\frac{\\partial V_y}{\\partial x} = \\sin(x), \\quad \\frac{\\partial V_x}{\\partial y} = -\\sin(y)\n    $$\n    The vorticity scalar is $\\zeta = \\sin(x) + \\sin(y)$.\n    Notice that $\\zeta = H(x,y)$. So, the vorticity two-form is $\\mathrm{d}\\alpha = H \\cdot (\\mathrm{d}x \\wedge \\mathrm{d}y) = H \\omega$.\n-   Now we compute $\\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) = \\iota_{\\mathbf{V}}(H \\omega)$. Since $H$ is a scalar function, $\\iota_{\\mathbf{V}}(H \\omega) = H (\\iota_{\\mathbf{V}}\\omega)$. From Part 1, we know $\\iota_{\\mathbf{V}}\\omega = \\mathrm{d}H$.\n    Therefore, $\\iota_{\\mathbf{V}}(\\mathrm{d}\\alpha) = H \\mathrm{d}H = \\mathrm{d}\\left(\\frac{1}{2} H^2\\right)$.\n\nSubstituting these back into Cartan's formula:\n$$\nL_{\\mathbf{V}}\\alpha = \\mathrm{d}\\left(\\frac{1}{2} H^2\\right) + \\mathrm{d}(|\\mathbf{V}|^2) = \\mathrm{d}\\left(\\frac{1}{2} H^2 + |\\mathbf{V}|^2\\right)\n$$\nThe Lie derivative is an exact one-form. By Stokes' theorem, the integral of an exact form over a closed loop is zero:\n$$\n\\frac{\\mathrm{d}\\Gamma}{\\mathrm{d}t} = \\oint_{\\gamma(t)} L_{\\mathbf{V}} \\alpha = \\oint_{\\gamma(t)} \\mathrm{d}\\left(\\frac{1}{2} H^2 + |\\mathbf{V}|^2\\right) = 0\n$$\nThus, the circulation $\\Gamma$ is a conserved quantity for the continuous flow, perfectly consistent with Kelvin's theorem.\n\n### Part 3: Discrete Variational Integrator\n\nA variational integrator discretizes the principle of stationary action. For a Hamiltonian system, a particularly effective class of variational integrators can be derived from a discrete Lagrangian constructed to approximate the action integral over a time step $h$. The implicit midpoint rule is a well-known symplectic integrator that can be derived from such a principle. For a general ODE $\\dot{\\mathbf{q}} = f(\\mathbf{q})$, the implicit midpoint rule is:\n$$\n\\frac{\\mathbf{q}_{k+1} - \\mathbf{q}_k}{h} = f\\left(\\frac{\\mathbf{q}_k + \\mathbf{q}_{k+1}}{2}\\right)\n$$\nFor our Hamiltonian system, $f(\\mathbf{q}) = J \\nabla H(\\mathbf{q})$. The update rule is therefore:\n$$\n\\mathbf{q}_{k+1} - \\mathbf{q}_k = h J \\nabla H\\left(\\frac{\\mathbf{q}_k + \\mathbf{q}_{k+1}}{2}\\right)\n$$\nThis is an implicit equation for $\\mathbf{q}_{k+1}$ given $\\mathbf{q}_k$.\n\n**Symplectic Property**: The implicit midpoint rule is a member of the Gauss-Legendre family of Runge-Kutta methods, all of which are symplectic. A numerical map is symplectic if it preserves the symplectic two-form $\\omega$. The reason for this property is profound: the method can be derived from a discrete version of Hamilton's principle using a discrete Lagrangian $L_d(\\mathbf{q}_k, \\mathbf{q}_{k+1})$ that approximates the action integral $\\int_{t_k}^{t_{k+1}} L(\\mathbf{q}, \\dot{\\mathbf{q}})\\mathrm{d}t$. Any integrator derived from a discrete variational principle (the discrete Euler-Lagrange equations) automatically preserves a discrete analogue of the symplectic form, and in the limit $h \\to 0$ this corresponds to preserving the continuous symplectic form $\\omega$. Therefore, the implicit midpoint method is symplectic.\n\n**Discrete Kelvin Property**: In the continuous setting, Kelvin's circulation theorem is a direct consequence of Noether's theorem applied to the particle relabeling symmetry of the fluid Lagrangian. This symmetry essentially states that the laws of physics do not depend on the specific identity labels assigned to fluid particles. A well-constructed discrete Lagrangian, such as one based on a symmetric quadrature rule like the midpoint rule, inherits this particle relabeling symmetry. By a discrete version of Noether's theorem, this symmetry in the discrete action implies the exact conservation of a certain quantity, known as the discrete circulation. While the specific quantity defined in the problem, $\\Gamma(\\gamma)$, may not be this exactly conserved quantity, it is a close approximation. Because the symplectic integrator provides a flow map that is a very accurate approximation of the true (circulation-preserving) Hamiltonian flow, the numerical evolution of $\\Gamma(\\gamma)$ will exhibit excellent long-term behavior with bounded error, rather than secular drift. This near-preservation of the discrete circulation functional is the discrete Kelvin property.\n\n### Part 4: Discrete Circulation Functional\n\nThe problem defines a discrete circulation functional as a midpoint quadrature approximation of the line integral $\\oint_{\\gamma} \\mathbf{V} \\cdot \\mathrm{d}\\mathbf{q}$. For a closed polygonal loop $\\gamma$ with vertices $\\{\\mathbf{q}_0, \\mathbf{q}_1, \\ldots, \\mathbf{q}_{N-1}\\}$, the functional is:\n$$\n\\Gamma(\\gamma) = \\sum_{i=0}^{N-1} \\mathbf{V}\\!\\left(\\frac{\\mathbf{q}_i + \\mathbf{q}_{i+1}}{2}\\right) \\cdot (\\mathbf{q}_{i+1} - \\mathbf{q}_i)\n$$\nwhere indices are taken modulo $N$ (i.e., $\\mathbf{q}_N = \\mathbf{q}_0$), and $\\cdot$ is the Euclidean dot product. The vector field $\\mathbf{V}(x,y)$ is evaluated at the midpoint of each line segment $[\\mathbf{q}_i, \\mathbf{q}_{i+1}]$. For our system, $\\mathbf{V}(x,y) = (\\cos(y), -\\cos(x))$. This formula provides a second-order accurate approximation of the continuous circulation integral for a sufficiently smooth curve.\n\n### Part 5: Implementation Plan\n\nThe implementation will follow a structured approach:\n1.  **Helper Functions**: Define Python functions for the Hamiltonian gradient $\\nabla H(\\mathbf{q}) = (\\cos(x), \\cos(y))^\\top$ and the velocity field $\\mathbf{V}(\\mathbf{q}) = J \\nabla H(\\mathbf{q}) = (\\cos(y), -\\cos(x))^\\top$.\n2.  **Loop Generation**: Create functions to generate the initial vertices for the circle, square, and figure-eight shapes according to their specified parameterizations and number of points. For the square, points will be distributed based on arc length along the perimeter to ensure they are evenly spaced.\n3.  **Implicit Solver**: Implement a function to solve the implicit midpoint equation for $\\mathbf{q}_{k+1}$. Due to the contractive nature of the implicit map for the given step sizes (as analyzed in the thought process), a simple fixed-point iteration, $\\mathbf{z}_{j+1} = \\mathbf{q}_k + h J \\nabla H((\\mathbf{q}_k + \\mathbf{z}_j)/2)$, will be used. It will be iterated a fixed number of times or until a tight convergence tolerance is met.\n4.  **Circulation Calculation**: Implement the discrete circulation functional $\\Gamma(\\gamma)$ as defined in Part 4.\n5.  **Main Simulation Loop**: For each of the five test cases:\n    a. Generate the initial loop of points.\n    b. Calculate the initial circulation $\\Gamma_{\\text{initial}}$.\n    c. Advect each vertex of the loop for $N$ time steps using the implicit midpoint solver.\n    d. Calculate the final circulation $\\Gamma_{\\text{final}}$ of the advected loop.\n    e. Compute and store the absolute circulation drift $|\\Delta \\Gamma| = |\\Gamma_{\\text{final}} - \\Gamma_{\\text{initial}}|$. The case with $N=0$ serves as a baseline and should yield zero drift.\n6.  **Output**: The final results will be formatted into the specified string `\"[result1,result2,result3,result4,result5]\"`.\n\nThis structured approach will lead to the required numerical results based on the derived theory.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    # Canonical symplectic matrix J\n    J = np.array([[0, 1], [-1, 0]])\n\n    def grad_H(q):\n        \"\"\"Computes the gradient of the Hamiltonian H(x,y) = sin(x) + sin(y).\"\"\"\n        x, y = q\n        return np.array([np.cos(x), np.cos(y)])\n\n    def velocity_field(q):\n        \"\"\"Computes the Hamiltonian vector field V = J * grad(H).\"\"\"\n        x, y = q\n        return np.array([np.cos(y), -np.cos(x)])\n\n    def implicit_midpoint_step(q_k, h):\n        \"\"\"\n        Advances a single point q_k by one time step h using the implicit midpoint rule.\n        The implicit equation is solved using a fixed-point iteration.\n        \"\"\"\n        # Initial guess for q_{k+1} using an explicit Euler step\n        z = q_k + h * (J @ grad_H(q_k))\n        \n        # Fixed point iteration for 10 steps (more than sufficient for convergence)\n        for _ in range(10):\n            q_mid = (q_k + z) / 2.0\n            z = q_k + h * (J @ grad_H(q_mid))\n        \n        return z\n\n    def generate_circle(Np, r):\n        \"\"\"Generates a circle centered at (pi, pi) with radius r.\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n        center = np.array([np.pi, np.pi])\n        points = center + r * np.array([np.cos(thetas), np.sin(thetas)]).T\n        return points\n\n    def generate_square(Np, a):\n        \"\"\"Generates a square centered at (pi, pi) with half-side a.\"\"\"\n        center = np.pi\n        perimeter = 8 * a\n        arc_lengths = np.linspace(0, perimeter, Np, endpoint=False)\n        points = np.zeros((Np, 2))\n        \n        for i, s in enumerate(arc_lengths):\n            if s < 2 * a:\n                # Bottom edge\n                points[i, :] = [center - a + s, center - a]\n            elif s < 4 * a:\n                # Right edge\n                points[i, :] = [center + a, center - a + (s - 2 * a)]\n            elif s < 6 * a:\n                # Top edge\n                points[i, :] = [center + a - (s - 4 * a), center + a]\n            else:\n                # Left edge\n                points[i, :] = [center - a, center + a - (s - 6 * a)]\n        return points\n\n    def generate_figure_eight(Np, r):\n        \"\"\"Generates a figure-eight curve centered at (pi, pi).\"\"\"\n        thetas = np.linspace(0, 2 * np.pi, Np, endpoint=False)\n        center = np.array([np.pi, np.pi])\n        points = center + r * np.array([np.sin(thetas), np.sin(2 * thetas)]).T\n        return points\n\n    def calculate_circulation(loop_points):\n        \"\"\"\n        Calculates the discrete circulation for a closed polygonal loop.\n        \"\"\"\n        gamma = 0.0\n        num_points = len(loop_points)\n        for i in range(num_points):\n            q_i = loop_points[i]\n            q_i_plus_1 = loop_points[(i + 1) % num_points]\n            \n            mid_point = (q_i + q_i_plus_1) / 2.0\n            segment_vector = q_i_plus_1 - q_i\n            \n            v_mid = velocity_field(mid_point)\n            \n            gamma += np.dot(v_mid, segment_vector)\n            \n        return gamma\n\n    test_cases = [\n        # (shape_type, Np, shape_param, h, N_steps)\n        ('circle', 64, 0.5, 0.05, 20),\n        ('circle', 64, 0.5, 0.2, 5),\n        ('square', 8, 0.5, 0.05, 20),\n        ('figure-eight', 128, 0.5, 0.05, 20),\n        ('circle', 64, 0.5, 0.05, 0),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        shape_type, Np, shape_param, h, N_steps = case\n\n        # 1. Generate initial loop\n        if shape_type == 'circle':\n            initial_loop = generate_circle(Np, shape_param)\n        elif shape_type == 'square':\n            initial_loop = generate_square(Np, shape_param)\n        elif shape_type == 'figure-eight':\n            initial_loop = generate_figure_eight(Np, shape_param)\n        else:\n            raise ValueError(f\"Unknown shape type: {shape_type}\")\n\n        # 2. Compute initial circulation\n        circ_initial = calculate_circulation(initial_loop)\n\n        # 3. Advect the loop in time\n        current_loop = initial_loop\n        if N_steps > 0:\n            for _ in range(N_steps):\n                next_loop = np.array([implicit_midpoint_step(q, h) for q in current_loop])\n                current_loop = next_loop\n        \n        final_loop = current_loop\n\n        # 4. Compute final circulation\n        circ_final = calculate_circulation(final_loop)\n\n        # 5. Calculate absolute circulation drift and store result\n        abs_drift = abs(circ_final - circ_initial)\n        results.append(abs_drift)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}