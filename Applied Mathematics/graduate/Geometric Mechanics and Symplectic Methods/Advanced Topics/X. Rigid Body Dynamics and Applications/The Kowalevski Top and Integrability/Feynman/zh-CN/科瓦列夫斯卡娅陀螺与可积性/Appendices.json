{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的动力学之前，我们必须熟练掌握几何力学的运动学语言。本练习旨在巩固角速度（$\\mathfrak{so}(3)$中的运动学量）和角动量（$\\mathfrak{so}(3)^*$中的动力学量）之间通过惯性张量建立的基本关系。这个计算是在刚体背景下，由动能导出的勒让德变换的一个直接应用。",
            "id": "3777953",
            "problem": "考虑一个有定点的刚体，其位形空间为特殊正交群 $SO(3)$。使用左平凡化 $TSO(3) \\cong SO(3) \\times \\mathfrak{so}(3)$，体角速度由向量 $\\omega \\in \\mathfrak{so}(3) \\cong \\mathbb{R}^{3}$ 表示。在体坐标系中，惯性算子由一个对称正定的惯性张量 $I = \\mathrm{diag}(I_{1}, I_{2}, I_{3})$ 表示。动能由二次型 $T(\\omega) = \\frac{1}{2}\\langle \\omega, I \\omega \\rangle$ 定义，其中 $\\langle \\cdot, \\cdot \\rangle$ 是 $\\mathbb{R}^{3}$ 上的标准欧几里得内积，体角动量 $M \\in \\mathfrak{so}(3)^{*} \\cong \\mathbb{R}^{3}$ 通过由 $T$ 诱导的勒让德变换获得。\n\n从几何力学中的这些基本定义出发，计算用体角速度 $\\omega$ 表示的体角动量 $M$，然后明确地用体角动量 $M$ 和惯性张量分量 $I_{1}$、$I_{2}$、$I_{3}$ 表示体角速度 $\\omega$。你的最终答案应该是一个单一的解析表达式，给出用 $M$ 和 $I_{j}$ 表示的 $\\omega$。除了对称性和正定性之外，不要假设 $I_{1}$、$I_{2}$、$I_{3}$ 之间有任何特殊关系。",
            "solution": "问题陈述是几何力学框架下描述的带定点刚体运动学和动力学的标准表述。该问题具有科学依据、适定、客观且完整。因此，它是有效的，我们可以继续进行求解。\n\n问题将刚体的动能定义为体角速度 $\\omega \\in \\mathfrak{so}(3) \\cong \\mathbb{R}^{3}$ 的函数，并在体坐标系中表示。该函数由以下二次型给出：\n$$\nT(\\omega) = \\frac{1}{2}\\langle \\omega, I \\omega \\rangle\n$$\n此处，$\\langle \\cdot, \\cdot \\rangle$ 表示 $\\mathbb{R}^{3}$ 上的标准欧几里得内积，$I$ 是惯性张量。在刚体的主轴坐标系中，惯性张量是一个对角矩阵：\n$$\nI = \\mathrm{diag}(I_{1}, I_{2}, I_{3}) = \\begin{pmatrix} I_{1} & 0 & 0 \\\\ 0 & I_{2} & 0 \\\\ 0 & 0 & I_{3} \\end{pmatrix}\n$$\n角速度向量的分量为 $\\omega = (\\omega_{1}, \\omega_{2}, \\omega_{3})$。我们可以用这些分量明确地写出动能：\n$$\nT(\\omega_{1}, \\omega_{2}, \\omega_{3}) = \\frac{1}{2} \\begin{pmatrix} \\omega_{1} & \\omega_{2} & \\omega_{3} \\end{pmatrix} \\begin{pmatrix} I_{1} & 0 & 0 \\\\ 0 & I_{2} & 0 \\\\ 0 & 0 & I_{3} \\end{pmatrix} \\begin{pmatrix} \\omega_{1} \\\\ \\omega_{2} \\\\ \\omega_{3} \\end{pmatrix} = \\frac{1}{2} (I_{1}\\omega_{1}^{2} + I_{2}\\omega_{2}^{2} + I_{3}\\omega_{3}^{2})\n$$\n问题指出，体角动量 $M \\in \\mathfrak{so}(3)^{*} \\cong \\mathbb{R}^{3}$ 是通过动能 $T$ 诱导的勒让德变换得到的。在李群力学的背景下，拉格朗日量是切丛 $TSO(3)$ 上的一个函数。通过左平凡化，我们将拉格朗日量视为 $SO(3) \\times \\mathfrak{so}(3)$ 上的函数。对于没有势能的刚体，拉格朗日量 $L$ 仅依赖于角速度 $\\omega \\in \\mathfrak{so}(3)$，且等于动能，即 $L(\\omega) = T(\\omega)$。\n\n将速度映射到动量的勒让德变换是拉格朗日量的纤维导数。在这个体固表示中，它是一个从李代数 $\\mathfrak{so}(3)$ 到其对偶 $\\mathfrak{so}(3)^{*}$ 的映射。角动量向量 $M = (M_{1}, M_{2}, M_{3})$ 的分量定义为拉格朗日量（此处为 $T$）对角速度分量的偏导数：\n$$\nM_{i} = \\frac{\\partial T}{\\partial \\omega_{i}}\n$$\n我们计算这些分量：\n对于 $i=1$：\n$$\nM_{1} = \\frac{\\partial}{\\partial \\omega_{1}} \\left( \\frac{1}{2} (I_{1}\\omega_{1}^{2} + I_{2}\\omega_{2}^{2} + I_{3}\\omega_{3}^{2}) \\right) = \\frac{1}{2} (2 I_{1}\\omega_{1}) = I_{1}\\omega_{1}\n$$\n对于 $i=2$：\n$$\nM_{2} = \\frac{\\partial}{\\partial \\omega_{2}} \\left( \\frac{1}{2} (I_{1}\\omega_{1}^{2} + I_{2}\\omega_{2}^{2} + I_{3}\\omega_{3}^{2}) \\right) = \\frac{1}{2} (2 I_{2}\\omega_{2}) = I_{2}\\omega_{2}\n$$\n对于 $i=3$：\n$$\nM_{3} = \\frac{\\partial}{\\partial \\omega_{3}} \\left( \\frac{1}{2} (I_{1}\\omega_{1}^{2} + I_{2}\\omega_{2}^{2} + I_{3}\\omega_{3}^{2}) \\right) = \\frac{1}{2} (2 I_{3}\\omega_{3}) = I_{3}\\omega_{3}\n$$\n将这些分量组合成向量形式，我们得到体角动量 $M$ 和体角速度 $\\omega$ 之间的关系：\n$$\nM = I \\omega\n$$\n这是所需计算的第一部分。\n\n任务的第二部分是用体角动量 $M$ 和惯性张量 $I$ 表示体角速度 $\\omega$。为此，我们必须求解关于 $\\omega$ 的线性方程 $M = I \\omega$。这需要求出惯性张量 $I$ 的逆矩阵 $I^{-1}$。\n由于问题指出 $I$ 是正定的，它的特征值——主转动惯量 $I_{1}$、$I_{2}$ 和 $I_{3}$——必须都是严格的正实数。\n$$\nI_{1} > 0, \\quad I_{2} > 0, \\quad I_{3} > 0\n$$\n因此，惯性张量 $I$ 是可逆的。对于一个对角矩阵，其逆矩阵是其对角元素倒数构成的对角矩阵：\n$$\nI^{-1} = \\mathrm{diag}(I_{1}^{-1}, I_{2}^{-1}, I_{3}^{-1}) = \\begin{pmatrix} \\frac{1}{I_{1}} & 0 & 0 \\\\ 0 & \\frac{1}{I_{2}} & 0 \\\\ 0 & 0 & \\frac{1}{I_{3}} \\end{pmatrix}\n$$\n现在我们可以通过在方程 $M = I \\omega$ 两边同时左乘 $I^{-1}$ 来求解 $\\omega$：\n$$\nI^{-1}M = I^{-1}(I \\omega) = (I^{-1}I)\\omega = \\mathbb{1}\\omega = \\omega\n$$\n其中 $\\mathbb{1}$ 是 $3 \\times 3$ 的单位矩阵。因此，我们有：\n$$\n\\omega = I^{-1}M\n$$\n为了得到最终的显式表达式，我们将此关系用 $\\omega$ 和 $M$ 的分量表示出来：\n$$\n\\begin{pmatrix} \\omega_{1} \\\\ \\omega_{2} \\\\ \\omega_{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{I_{1}} & 0 & 0 \\\\ 0 & \\frac{1}{I_{2}} & 0 \\\\ 0 & 0 & \\frac{1}{I_{3}} \\end{pmatrix} \\begin{pmatrix} M_{1} \\\\ M_{2} \\\\ M_{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{M_{1}}{I_{1}} \\\\ \\frac{M_{2}}{I_{2}} \\\\ \\frac{M_{3}}{I_{3}} \\end{pmatrix}\n$$\n这就明确地用体角动量向量 $M$ 的分量和主转动惯量 $I_{1}$、$I_{2}$、$I_{3}$ 表示了体角速度向量 $\\omega$。",
            "answer": "$$\n\\boxed{\\omega = \\begin{pmatrix} M_1/I_1 \\\\ M_2/I_2 \\\\ M_3/I_3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Kowalevski陀螺的著名之处在于其可积性，这意味着存在足够多的守恒量（首次积分）来将其复杂的运动约束在相空间的环面上。这个练习将引导你通过计算一个关键的雅可比矩阵的秩，来直接验证这些积分——哈密顿量、面积积分和Kowalevski积分——在函数上是独立的，这是证明刘维尔可积性的核心步骤。",
            "id": "3777970",
            "problem": "考虑在三维特殊欧几里得李代数的对偶空间 $ \\mathfrak{e}(3)^{\\ast} $ 上表述的 Kowalevski 陀螺，其正则坐标为 $ (M,\\gamma) = (M_{1},M_{2},M_{3},\\gamma_{1},\\gamma_{2},\\gamma_{3}) \\in \\mathbb{R}^{6} $。在 Kowalevski 情况下，主转动惯量满足 $ I_{1} = I_{2} = 2 I_{3} $。我们采用无量纲选择 $ I_{3} = 1 $（因此 $ I_{1} = I_{2} = 2 $）和一个引力参数 $ c > 0 $。哈密顿量 $ H $、面积积分 $ J $ 和 Kowalevski 积分 $ K $ 定义如下\n$$\nH(M,\\gamma) = \\frac{1}{2}\\left( \\frac{M_{1}^{2}}{I_{1}} + \\frac{M_{2}^{2}}{I_{2}} + \\frac{M_{3}^{2}}{I_{3}} \\right) + c\\,\\gamma_{1} = \\frac{1}{4}\\left(M_{1}^{2} + M_{2}^{2}\\right) + \\frac{1}{2} M_{3}^{2} + c\\,\\gamma_{1},\n$$\n$$\nJ(M,\\gamma) = M_{1}\\gamma_{1} + M_{2}\\gamma_{2} + M_{3}\\gamma_{3},\n$$\n$$\nK(M,\\gamma) = \\left(M_{1}^{2} - M_{2}^{2} - 2 c\\,\\gamma_{1}\\right)^{2} + \\left(2 M_{1} M_{2} - 2 c\\,\\gamma_{2}\\right)^{2}.\n$$\n在某一点上，$ H $、$ J $ 和 $ K $ 的函数无关性意味着映射 $ (H,J,K): \\mathbb{R}^{6} \\to \\mathbb{R}^{3} $ 的雅可比矩阵在该点的秩为 $ 3 $。\n\n仅使用上述定义和光滑函数 $ F $ 的微分 $ dF $ 的定义，计算微分 $ d(H,J,K) $ 在点\n$$\n(M,\\gamma) = \\left(1,\\,2,\\,3,\\,\\frac{1}{\\sqrt{3}},\\,\\frac{1}{\\sqrt{3}},\\,\\frac{1}{\\sqrt{3}}\\right)\n$$\n处（其中 $ c = 1 $）的秩。根据您的计算，推断出该特定点的秩是多少。您的最终答案必须是秩的单个整数值。无需四舍五入，也无需单位。",
            "solution": "我们回顾微分的定义：对于光滑函数 $ F: \\mathbb{R}^{6} \\to \\mathbb{R} $，在某一点的微分 $ dF $ 由关于坐标 $ (M_{1},M_{2},M_{3},\\gamma_{1},\\gamma_{2},\\gamma_{3}) $ 的偏导数组成的梯度行向量表示。$ (H,J,K) $ 的雅可比矩阵是一个 $ 3 \\times 6 $ 矩阵，其行是 $ H $、$ J $ 和 $ K $ 的梯度。秩是这些梯度线性张成的空间的维数。\n\n首先，以符号方式计算梯度。\n\n1. 对于 $ H(M,\\gamma) = \\frac{1}{4}(M_{1}^{2}+M_{2}^{2}) + \\frac{1}{2} M_{3}^{2} + c\\,\\gamma_{1} $,\n$$\n\\frac{\\partial H}{\\partial M_{1}} = \\frac{M_{1}}{2}, \\quad \\frac{\\partial H}{\\partial M_{2}} = \\frac{M_{2}}{2}, \\quad \\frac{\\partial H}{\\partial M_{3}} = M_{3}, \\quad \\frac{\\partial H}{\\partial \\gamma_{1}} = c, \\quad \\frac{\\partial H}{\\partial \\gamma_{2}} = 0, \\quad \\frac{\\partial H}{\\partial \\gamma_{3}} = 0.\n$$\n因此\n$$\n\\nabla H = \\left(\\frac{M_{1}}{2},\\,\\frac{M_{2}}{2},\\,M_{3},\\,c,\\,0,\\,0\\right).\n$$\n\n2. 对于 $ J(M,\\gamma) = M_{1}\\gamma_{1} + M_{2}\\gamma_{2} + M_{3}\\gamma_{3} $,\n$$\n\\frac{\\partial J}{\\partial M_{1}} = \\gamma_{1}, \\quad \\frac{\\partial J}{\\partial M_{2}} = \\gamma_{2}, \\quad \\frac{\\partial J}{\\partial M_{3}} = \\gamma_{3}, \\quad \\frac{\\partial J}{\\partial \\gamma_{1}} = M_{1}, \\quad \\frac{\\partial J}{\\partial \\gamma_{2}} = M_{2}, \\quad \\frac{\\partial J}{\\partial \\gamma_{3}} = M_{3}.\n$$\n因此\n$$\n\\nabla J = \\left(\\gamma_{1},\\,\\gamma_{2},\\,\\gamma_{3},\\,M_{1},\\,M_{2},\\,M_{3}\\right).\n$$\n\n3. 对于 $ K(M,\\gamma) = A^{2} + B^{2} $，其中\n$$\nA = M_{1}^{2} - M_{2}^{2} - 2 c\\,\\gamma_{1}, \\qquad B = 2 M_{1} M_{2} - 2 c\\,\\gamma_{2},\n$$\n应用链式法则：\n$$\n\\frac{\\partial K}{\\partial M_{1}} = 2 A \\frac{\\partial A}{\\partial M_{1}} + 2 B \\frac{\\partial B}{\\partial M_{1}} = 2 A (2 M_{1}) + 2 B (2 M_{2}) = 4 M_{1} A + 4 M_{2} B,\n$$\n$$\n\\frac{\\partial K}{\\partial M_{2}} = 2 A \\frac{\\partial A}{\\partial M_{2}} + 2 B \\frac{\\partial B}{\\partial M_{2}} = 2 A (-2 M_{2}) + 2 B (2 M_{1}) = -4 M_{2} A + 4 M_{1} B,\n$$\n$$\n\\frac{\\partial K}{\\partial M_{3}} = 0,\n$$\n$$\n\\frac{\\partial K}{\\partial \\gamma_{1}} = 2 A \\frac{\\partial A}{\\partial \\gamma_{1}} + 2 B \\frac{\\partial B}{\\partial \\gamma_{1}} = 2 A (-2 c) + 0 = -4 c A,\n$$\n$$\n\\frac{\\partial K}{\\partial \\gamma_{2}} = 0 + 2 B \\frac{\\partial B}{\\partial \\gamma_{2}} = 2 B (-2 c) = -4 c B,\n$$\n$$\n\\frac{\\partial K}{\\partial \\gamma_{3}} = 0.\n$$\n因此\n$$\n\\nabla K = \\left(4 M_{1} A + 4 M_{2} B,\\,-4 M_{2} A + 4 M_{1} B,\\,0,\\,-4 c A,\\,-4 c B,\\,0\\right).\n$$\n\n现在，在指定点处，当 $ c = 1 $ 且\n$$\n(M,\\gamma) = \\left(1,\\,2,\\,3,\\,\\frac{1}{\\sqrt{3}},\\,\\frac{1}{\\sqrt{3}},\\,\\frac{1}{\\sqrt{3}}\\right)\n$$\n时进行求值。\n令 $ s = \\frac{1}{\\sqrt{3}} $。则\n$$\nA = M_{1}^{2} - M_{2}^{2} - 2 c\\,\\gamma_{1} = 1 - 4 - 2 s = -3 - 2 s,\n$$\n$$\nB = 2 M_{1} M_{2} - 2 c\\,\\gamma_{2} = 4 - 2 s.\n$$\n代入得：\n$$\n\\nabla H\\big|_{P} = \\left(\\frac{1}{2},\\,1,\\,3,\\,1,\\,0,\\,0\\right),\n$$\n$$\n\\nabla J\\big|_{P} = \\left(s,\\,s,\\,s,\\,1,\\,2,\\,3\\right),\n$$\n$$\n\\nabla K\\big|_{P} = \\left(4\\cdot 1\\cdot A + 4\\cdot 2\\cdot B,\\,-4\\cdot 2\\cdot A + 4\\cdot 1\\cdot B,\\,0,\\,-4 A,\\,-4 B,\\,0\\right) = \\left(20 - 24 s,\\,40 + 8 s,\\,0,\\,12 + 8 s,\\,-16 + 8 s,\\,0\\right).\n$$\n\n为了确定秩，只需找到一个行列式不为零的 $ 3 \\times 3 $ 子式。考虑对应于 $ (M_{1}, M_{2}, \\gamma_{1}) $ 的列，即第 $ 1 $、$ 2 $ 和 $ 4 $ 列。得到的 $ 3 \\times 3 $ 矩阵为\n$$\n\\begin{pmatrix}\n\\frac{1}{2} & 1 & 1 \\\\\ns & s & 1 \\\\\n20 - 24 s & 40 + 8 s & 12 + 8 s\n\\end{pmatrix}.\n$$\n计算其行列式。记 $ a = 20 - 24 s $，$ b = 40 + 8 s $，以及 $ c = 12 + 8 s $。通过展开，\n$$\n\\det = \\frac{1}{2}(s c - b) - (s c - a) + (s b - s a) = -\\frac{1}{2} s c + a + s b - s a - \\frac{1}{2} b.\n$$\n当 $ s = \\frac{1}{\\sqrt{3}} $ 时，计算\n$$\ns c = s(12 + 8 s) = \\frac{12}{\\sqrt{3}} + \\frac{8}{3}, \\quad s b = \\frac{40}{\\sqrt{3}} + \\frac{8}{3}, \\quad s a = \\frac{20}{\\sqrt{3}} - 8,\n$$\n因此\n$$\n\\det = \\left(-\\frac{6}{\\sqrt{3}} - \\frac{4}{3}\\right) + \\left(20 - \\frac{24}{\\sqrt{3}}\\right) + \\left(\\frac{40}{\\sqrt{3}} + \\frac{8}{3}\\right) + \\left(-\\frac{20}{\\sqrt{3}} + 8\\right) + \\left(-20 - \\frac{4}{\\sqrt{3}}\\right).\n$$\n合并同类项得到\n$$\n\\det = \\frac{28}{3} - \\frac{14}{\\sqrt{3}} = 14\\left(\\frac{2}{3} - \\frac{1}{\\sqrt{3}}\\right).\n$$\n由于 $ \\frac{2}{3} - \\frac{1}{\\sqrt{3}} > 0 $，此行列式不为零。因此，这三个梯度在指定点是线性无关的，并且 $ (H,J,K) $ 的雅可比矩阵在该点的秩为 $ 3 $。\n\n因为雅可比矩阵的元素是关于 $ (M,\\gamma) $ 的多项式（因此是解析）函数，在某一点处一个 $ 3 \\times 3 $ 子式不为零意味着所有这些子式都为零的集合是一个真代数子集。因此，在 $ \\mathbb{R}^{6} $ 的一个开稠密子集上，秩为 $ 3 $。在给定点，计算出的秩等于 $ 3 $。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "理论分析揭示了Kowalevski陀螺的美妙结构，但要可视化其复杂的运动，我们通常必须依赖数值模拟。这个实践练习将带你进入几何积分的世界，通过实现一个标准的数值积分器并应用投影方法，让你亲身体验在模拟过程中保持系统固有几何结构（如卡西米尔不变量）的至关重要性。",
            "id": "3777955",
            "problem": "考虑柯瓦列夫斯基陀螺，这是一个具有一个不动点的重刚体，在具有标准李-泊松结构的特殊欧几里得李代数的对偶空间 $e^{\\ast}(3)$ 上演化。状态由在体坐标系中表示的物体角动量 $M \\in \\mathbb{R}^{3}$ 和重力单位方向 $\\gamma \\in \\mathbb{R}^{3}$ 组成。其动力学由欧拉-泊松方程给出\n$$\n\\dot{M} \\;=\\; M \\times \\Omega \\;+\\; g\\,\\gamma \\times a,\n\\qquad\n\\dot{\\gamma} \\;=\\; \\gamma \\times \\Omega,\n\\qquad\n\\Omega \\;=\\; I^{-1} M,\n$$\n其中 $I$ 是对角惯性张量，$g$ 是（无量纲的）引力参数，$a \\in \\mathbb{R}^{3}$ 是从不动点指向质心的体固矢量。柯瓦列夫斯基条件为 $I_{1} = I_{2} = 2 I_{3}$ 且质心位于赤道平面内，我们通过取以下值来强制满足该条件\n$$\nI \\;=\\; \\mathrm{diag}(1,\\,1,\\,\\tfrac{1}{2}), \\quad a \\;=\\; (1,\\,0,\\,0)^{\\top}, \\quad g \\;=\\; 1.\n$$\n该李-泊松系统有两个卡西米尔不变量\n$$\nC_{1}(M,\\gamma) \\;=\\; \\|\\gamma\\|^{2}, \n\\qquad \nC_{2}(M,\\gamma) \\;=\\; M \\cdot \\gamma,\n$$\n以及哈密顿量（总能量）\n$$\nH(M,\\gamma) \\;=\\; \\tfrac{1}{2}\\,M \\cdot I^{-1} M \\;-\\; g\\,\\gamma \\cdot a.\n$$\n您将实现一个基于经典四阶龙格-库塔方法的数值时间积分器，并在每个时间步后，可选地执行一个投影操作，以精确强制满足卡西米尔约束 $C_{1}=1$ 和 $C_{2}=\\text{const}$。具体来说，给定一个步后状态 $(M,\\gamma)$ 和从初始条件中获取的目标卡西米尔值 $c_{2}^{\\ast}$，实现以下投影：\n1. 通过 $\\gamma \\leftarrow \\gamma / \\|\\gamma\\|$ 归一化 $\\gamma$ 以强制满足 $C_{1}=1$。\n2. 通过 $M \\leftarrow M + \\big(c_{2}^{\\ast} - M \\cdot \\gamma\\big)\\,\\gamma$ 调整 $M$ 以强制满足 $C_{2}=c_{2}^{\\ast}$。\n\n使用以下初始条件和终止时间：\n- 初始状态 $(M_{0},\\gamma_{0})$ 为\n$$\nM_{0} \\;=\\; (0.3,\\,-0.5,\\,0.4)^{\\top}, \n\\qquad\n\\gamma_{0} \\;=\\; \\frac{(0.2,\\,0.3,\\,0.93)^{\\top}}{\\|(0.2,\\,0.3,\\,0.93)\\|}.\n$$\n- 终止时间 $T \\;=\\; 10$（无量纲单位）。\n\n按照上述说明实现矢量场和显式四阶龙格-库塔方法，使用固定时间步长 $\\Delta t$，从时间 $t=0$ 推进到 $t=T$，共计 $N = T/\\Delta t$ 步。根据测试用例，上述投影步骤必须在每个龙格-库塔步之后可选地应用。\n\n为评估结构保持性和准确性，在每次运行的终止时间计算以下标量诊断值：\n- 卡西米尔不变量偏差：\n$$\nE_{C1} \\;=\\; \\big|\\|\\gamma(T)\\|^{2} - 1\\big|, \n\\qquad\nE_{C2} \\;=\\; \\big|M(T)\\cdot\\gamma(T) - c_{2}^{\\ast}\\big|.\n$$\n- 相对能量误差：\n$$\nE_{H} \\;=\\; \\frac{\\big|H\\big(M(T),\\gamma(T)\\big) - H\\big(M_{0},\\gamma_{0}\\big)\\big|}{\\big|H\\big(M_{0},\\gamma_{0}\\big)\\big|}.\n$$\n- 与高精度参考解的终态偏差：\n$$\nE_{\\mathrm{ref}} \\;=\\; \\left\\| \n\\begin{bmatrix}M(T)\\\\ \\gamma(T)\\end{bmatrix} \n- \n\\begin{bmatrix}M_{\\mathrm{ref}}(T)\\\\ \\gamma_{\\mathrm{ref}}(T)\\end{bmatrix}\n\\right\\|_{2},\n$$\n其中 $\\big(M_{\\mathrm{ref}}(T),\\gamma_{\\mathrm{ref}}(T)\\big)$ 是通过使用一个自适应、高精度的常微分方程求解器，并采用严格的容差，对同个初值问题进行积分得到的。\n\n您的程序必须运行以下测试套件，每个测试由一对 $(\\Delta t, \\text{use\\_projection})$ 指定，其中 $\\Delta t$ 是时间步长，$\\text{use\\_projection} \\in \\{0,1\\}$ 表示是否在每步之后应用投影：\n- 测试 $1$: $(\\Delta t=\\;0.05,\\;\\text{use\\_projection}=\\;0)$\n- 测试 $2$: $(\\Delta t=\\;0.05,\\;\\text{use\\_projection}=\\;1)$\n- 测试 $3$: $(\\Delta t=\\;0.02,\\;\\text{use\\_projection}=\\;0)$\n- 测试 $4$: $(\\Delta t=\\;0.02,\\;\\text{use\\_projection}=\\;1)$\n- 测试 $5$: $(\\Delta t=\\;0.01,\\;\\text{use\\_projection}=\\;0)$\n- 测试 $6$: $(\\Delta t=\\;0.01,\\;\\text{use\\_projection}=\\;1)$\n- 测试 $7$: $(\\Delta t=\\;0.005,\\;\\text{use\\_projection}=\\;0)$\n- 测试 $8$: $(\\Delta t=\\;0.005,\\;\\text{use\\_projection}=\\;1)$\n\n全程使用无量纲单位，因此不需要进行显式的物理单位转换。\n\n对于高精度参考解，使用一个自适应积分器，其绝对和相对容差均设置为 $10^{-12}$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应上述顺序的一个测试用例，并且本身是一个包含四个十进制数 $[E_{C1},E_{C2},E_{H},E_{\\mathrm{ref}}]$ 的列表。例如，输出格式必须如下所示：\n$$\n\\big[\\,[e_{11},e_{12},e_{13},e_{14}],\\,[e_{21},e_{22},e_{23},e_{24}],\\,\\ldots,\\,[e_{81},e_{82},e_{83},e_{84}]\\,\\big]\n$$\n其中每个 $e_{ij}$ 是一个用十进制表示的浮点数。",
            "solution": "用户提供的问题是几何力学领域一个有效的数值练习。我们的任务是为一个经典的可积系统——柯瓦列夫斯基陀螺——积分其欧拉-泊松方程。解决方案的开发将首先建立数学框架，然后概述数值方法，最后详细说明计算所需诊断指标的实现。\n\n### 1. 数学公式化\n柯瓦列夫斯基陀螺的状态由一对 $(M, \\gamma)$ 给出，其中 $M \\in \\mathbb{R}^{3}$ 是角动量矢量，$\\gamma \\in \\mathbb{R}^{3}$ 是表示重力方向的单位矢量，两者都在体固坐标系中表示。组合状态可以由一个矢量 $y \\in \\mathbb{R}^{6}$ 表示，其中 $y = [M^{\\top}, \\gamma^{\\top}]^{\\top}$。\n\n动力学由欧拉-泊松方程控制：\n$$\n\\dot{M} = M \\times \\Omega + g\\,\\gamma \\times a\n$$\n$$\n\\dot{\\gamma} = \\gamma \\times \\Omega\n$$\n其中 $\\Omega = I^{-1}M$ 是角速度，$I$ 是惯性张量，$a$ 是质心矢量，$g$ 是引力参数。对于特定的柯瓦列夫斯基情况，参数为：\n$$\nI = \\mathrm{diag}(1, 1, \\tfrac{1}{2}), \\quad I^{-1} = \\mathrm{diag}(1, 1, 2), \\quad a = (1, 0, 0)^{\\top}, \\quad g = 1\n$$\n这定义了一个形式为 $\\dot{y} = f(y)$ 的初值问题（IVP），其矢量场 $f(y)$ 由下式给出：\n$$\nf(y) = f(M, \\gamma) = \\begin{bmatrix} M \\times (I^{-1}M) + \\gamma \\times a \\\\ \\gamma \\times (I^{-1}M) \\end{bmatrix}\n$$\n问题提供了在时间 $t=0$ 时的初始条件 $(M_0, \\gamma_0)$：\n$$\nM_{0} = (0.3, -0.5, 0.4)^{\\top}, \\qquad \\gamma_{0} = \\frac{(0.2, 0.3, 0.93)^{\\top}}{\\|(0.2, 0.3, 0.93)\\|}\n$$\n我们要将此初值问题积分到最终时间 $T=10$。\n\n### 2. 数值积分与结构保持\n该连续系统拥有几个守恒量（首次积分）：\n1.  卡西米尔不变量 $C_1(M, \\gamma) = \\|\\gamma\\|^2$，它应保持等于其初始值 $1$。\n2.  卡西米尔不变量 $C_2(M, \\gamma) = M \\cdot \\gamma$，它应保持等于其初始值 $c_2^* = M_0 \\cdot \\gamma_0$。\n3.  哈密顿量（总能量）$H(M, \\gamma) = \\frac{1}{2} M \\cdot I^{-1}M - g\\,\\gamma \\cdot a$，它应保持等于其初始值 $H_0 = H(M_0, \\gamma_0)$。\n\n标准的数值积分器，例如问题中指定的经典四阶龙格-库塔（RK4）方法，是为通用精度而设计的，但通常不保持这些几何不变量。在长时间积分中，这可能导致计算出的不变量发生漂移，从而导致定性上不正确的模拟。\n\nRK4 方法通过以下公式将解从时间 $t_n$ 的 $y_n$ 推进到时间 $t_{n+1} = t_n + \\Delta t$ 的 $y_{n+1}$：\n$$\ny_{n+1} = y_n + \\frac{\\Delta t}{6} (k_1 + 2k_2 + 2k_3 + k_4)\n$$\n其中\n$$\nk_1 = f(y_n), \\quad k_2 = f(y_n + \\frac{\\Delta t}{2}k_1), \\quad k_3 = f(y_n + \\frac{\\Delta t}{2}k_2), \\quad k_4 = f(y_n + \\Delta t k_3)\n$$\n这是一个四阶的显式方法。为了减轻不变量的漂移，一个简单的方法是在每个时间步后将数值解投影回约束流形上。问题指定了这样一种投影方法来强制执行两个卡西米尔约束。给定由 RK4 步骤计算出的状态 $(M, \\gamma)$，投影操作如下：\n1.  **强制 $C_1=1$**：对 $\\gamma$ 矢量进行归一化。设步后状态为 $(\\tilde{M}, \\tilde{\\gamma})$。我们计算 $\\gamma' = \\tilde{\\gamma} / \\|\\tilde{\\gamma}\\|$。\n2.  **强制 $C_2=c_2^*$**：调整 $M$ 矢量。我们寻找一个新矢量 $M' = \\tilde{M} + \\lambda \\gamma'$，使得 $M' \\cdot \\gamma' = c_2^*$。这导致 $(\\tilde{M} + \\lambda \\gamma') \\cdot \\gamma' = c_2^*$，简化为 $\\tilde{M} \\cdot \\gamma' + \\lambda = c_2^*$，从而得到 $\\lambda = c_2^* - \\tilde{M} \\cdot \\gamma'$。因此，投影后的状态为 $(M', \\gamma')$，其中：\n    $$\n    \\gamma' = \\frac{\\tilde{\\gamma}}{\\|\\tilde{\\gamma}\\|}, \\qquad M' = \\tilde{M} + (c_2^* - \\tilde{M} \\cdot \\gamma')\\gamma'\n    $$\n这个投影不强制能量 $H$ 的守恒。\n\n### 3. 诊断与参考解\n为了评估普通 RK4 积分器与投影 RK4 积分器的性能，我们将在最终时间 $T=10$ 计算四个诊断指标：\n-   $E_{C1} = |\\|\\gamma(T)\\|^2 - 1|$：衡量对 $\\gamma$ 的几何约束的违反程度。\n-   $E_{C2} = |M(T) \\cdot \\gamma(T) - c_2^*|$：衡量对第二个卡西米尔不变量的违反程度。\n-   $E_{H} = \\frac{|H(T) - H_0|}{|H_0|}$：衡量总能量的相对误差。\n-   $E_{\\mathrm{ref}} = \\| y(T) - y_{\\mathrm{ref}}(T) \\|_2$：衡量与高精度参考解之间的误差。该度量评估了方法逼近真实轨迹的能力。\n\n参考解 $y_{\\mathrm{ref}}(T)$ 是通过使用一个高阶自适应步长求解器（例如 `scipy.integrate.solve_ivp` 的 'DOP853' 方法），并采用非常严格的误差容差（$10^{-12}$）对同个初值问题进行积分得到的。这提供了一个基准，对于本数值实验而言，它实际上就是“精确”解。\n\n### 4. 实现计划\n该解决方案将使用 Python 实现，利用 `numpy` 库进行矢量运算，并使用 `scipy.integrate.solve_ivp` 获取参考解。\n\n1.  **初始化**：定义所有常量（$I^{-1}, a, g$）、最终时间 $T$ 和初始状态 $(M_0, \\gamma_0)$。计算不变量 $c_2^*$ 和 $H_0$ 的初始值。\n2.  **矢量场**：一个函数 `vector_field(t, y)` 将实现常微分方程组 $\\dot{y} = f(y)$。\n3.  **积分器与投影**：将按照上述描述实现 RK4 步和投影的函数。\n4.  **主循环**：\n    a. 一次性计算参考终态 $y_{\\mathrm{ref}}(T)$。\n    b. 遍历八个指定的测试用例 $(\\Delta t, \\text{use\\_projection})$。\n    c. 对每个用例，使用指定的固定时间步长 $\\Delta t$ 和 RK4 方法，从 $t=0$ 到 $T$ 运行一次模拟，并根据条件应用投影。\n    d. 在每次模拟结束时，计算四个诊断指标（$E_{C1}, E_{C2}, E_{H}, E_{\\mathrm{ref}}$）。\n    e. 收集所有测试用例的结果。\n5.  **输出**：将收集到的结果格式化为指定的字符串格式 `[[...],[...],...]` 并打印到标准输出。\n\n这个过程将允许对非投影和投影的 RK4 方法进行定量比较，突显在不同步长下准确性与结构保持性之间的权衡。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the Kowalevski top problem as specified, running a series of\n    numerical integrations and computing diagnostics.\n    \"\"\"\n    # --- Constants and System Definition ---\n    I_inv = np.array([1.0, 1.0, 2.0])\n    a = np.array([1.0, 0.0, 0.0])\n    g = 1.0\n    T_final = 10.0\n\n    # --- Initial Conditions ---\n    M0 = np.array([0.3, -0.5, 0.4])\n    gamma0_unnormalized = np.array([0.2, 0.3, 0.93])\n    gamma0 = gamma0_unnormalized / np.linalg.norm(gamma0_unnormalized)\n    y0 = np.concatenate((M0, gamma0))\n\n    # --- Invariants from Initial Conditions ---\n    c2_star = np.dot(M0, gamma0)\n\n    def hamiltonian(M, gamma):\n        \"\"\"Computes the Hamiltonian (total energy).\"\"\"\n        return 0.5 * np.dot(M, I_inv * M) - g * np.dot(gamma, a)\n\n    H0 = hamiltonian(M0, gamma0)\n\n    # --- Vector Field of the Euler-Poisson Equations ---\n    def vector_field(t, y):\n        \"\"\"\n        Computes the time derivative dy/dt for the Kowalevski top.\n        y is a 6D state vector [M, gamma].\n        \"\"\"\n        M = y[:3]\n        gamma = y[3:]\n        \n        Omega = I_inv * M\n        \n        dM_dt = np.cross(M, Omega) + g * np.cross(gamma, a)\n        dgamma_dt = np.cross(gamma, Omega)\n        \n        return np.concatenate((dM_dt, dgamma_dt))\n\n    # --- Numerical Method Implementations ---\n    def rk4_step(f, t, y, dt):\n        \"\"\"Performs a single classical Runge-Kutta 4th order step.\"\"\"\n        k1 = f(t, y)\n        k2 = f(t + 0.5 * dt, y + 0.5 * dt * k1)\n        k3 = f(t + 0.5 * dt, y + 0.5 * dt * k2)\n        k4 = f(t + dt, y + dt * k3)\n        return y + (dt / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\n    def project(y, c2_val):\n        \"\"\"Projects the state y onto the Casimir constraint manifold.\"\"\"\n        M = y[:3]\n        gamma = y[3:]\n        \n        # 1. Normalize gamma to enforce C1 = 1\n        gamma_proj = gamma / np.linalg.norm(gamma)\n        \n        # 2. Adjust M to enforce C2 = c2_star\n        M_proj = M + (c2_val - np.dot(M, gamma_proj)) * gamma_proj\n        \n        return np.concatenate((M_proj, gamma_proj))\n\n    # --- Generate High-Accuracy Reference Solution ---\n    ref_sol = solve_ivp(\n        vector_field, \n        (0.0, T_final), \n        y0, \n        method='DOP853', \n        t_eval=[T_final], \n        rtol=1e-12, \n        atol=1e-12\n    )\n    y_ref_final = ref_sol.y[:, -1]\n\n    # --- Test Suite Definition ---\n    test_cases = [\n        (0.05, 0),\n        (0.05, 1),\n        (0.02, 0),\n        (0.02, 1),\n        (0.01, 0),\n        (0.01, 1),\n        (0.005, 0),\n        (0.005, 1),\n    ]\n\n    all_results = []\n\n    for dt, use_projection in test_cases:\n        # --- Run Simulation for the current test case ---\n        y = np.copy(y0)\n        t = 0.0\n        num_steps = int(round(T_final / dt))\n\n        for _ in range(num_steps):\n            y = rk4_step(vector_field, t, y, dt)\n            if use_projection:\n                y = project(y, c2_star)\n            t += dt\n            \n        M_final = y[:3]\n        gamma_final = y[3:]\n\n        # --- Calculate Diagnostics ---\n        E_C1 = abs(np.linalg.norm(gamma_final)**2 - 1.0)\n        E_C2 = abs(np.dot(M_final, gamma_final) - c2_star)\n        \n        H_final = hamiltonian(M_final, gamma_final)\n        # Avoid division by zero if H0 is zero, though it is not for this problem.\n        E_H = abs(H_final - H0) / abs(H0) if H0 != 0.0 else abs(H_final)\n\n        E_ref = np.linalg.norm(y - y_ref_final)\n        \n        all_results.append([E_C1, E_C2, E_H, E_ref])\n\n    # --- Format and Print Output ---\n    # Construct the output string exactly as specified: [[e1,e2,...],[...],...]\n    list_of_strings = []\n    for res_list in all_results:\n        s = \"[\" + \",\".join(map(str, res_list)) + \"]\"\n        list_of_strings.append(s)\n    \n    final_output = \"[\" + \",\".join(list_of_strings) + \"]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}