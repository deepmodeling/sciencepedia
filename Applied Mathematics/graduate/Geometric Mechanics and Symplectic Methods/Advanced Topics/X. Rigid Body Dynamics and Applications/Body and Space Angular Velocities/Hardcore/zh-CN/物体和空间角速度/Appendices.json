{
    "hands_on_practices": [
        {
            "introduction": "从固定（空间）参考系和运动（刚体）参考系观察旋转是刚体力学的核心区别。本练习旨在通过推导空间角速度矢量和刚体角速度矢量之间的精确数学关系来巩固这一概念。完成这一推导是掌握旋转运动学至关重要的一步，它将揭示李群的伴随表示（Adjoint representation）在联系这两个描述中的基本作用。",
            "id": "3731342",
            "problem": "考虑特殊正交群 $\\mathrm{SO}(3)$ 和一条连续可微的曲线 $R(t) \\in \\mathrm{SO}(3)$。左平凡化（空间坐标系）角速度 $\\omega_{s}(t) \\in \\mathbb{R}^{3}$ 和右平凡化（物体坐标系）角速度 $\\omega_{b}(t) \\in \\mathbb{R}^{3}$ 是通过 $\\mathbb{R}^{3}$ 与李代数 $\\mathfrak{so}(3)$ 之间的同构来定义的，该同构由帽映射 $\\widehat{(\\cdot)} : \\mathbb{R}^{3} \\to \\mathfrak{so}(3)$ 实现，其定义为对于所有 $v,w \\in \\mathbb{R}^{3}$，有 $\\widehat{v} w = v \\times w$。具体来说，角速度由以下恒等式定义：$\\widehat{\\omega_{s}}(t) = \\dot{R}(t) R(t)^{\\top}$ 和 $\\widehat{\\omega_{b}}(t) = R(t)^{\\top} \\dot{R}(t)$。回顾一下，对于矩阵李群，其伴随表示 $\\operatorname{Ad}_{g} : \\mathfrak{g} \\to \\mathfrak{g}$ 定义为 $\\operatorname{Ad}_{g} X = g X g^{-1}$，其中 $g \\in G$ 且 $X \\in \\mathfrak{g}$，并且它与共轭映射在单位元处的微分是一致的。仅从这些定义以及矩阵乘积的微分法则出发，利用李群上左平凡化速度和右平凡化速度之间的关系，推导出 $\\omega_{s}(t)$ 关于 $R(t)$ 和 $\\omega_{b}(t)$ 的闭式表达式。请以一个关于 $R(t)$ 和 $\\omega_{b}(t)$ 的单一解析表达式的形式，给出 $\\omega_{s}(t)$ 的最终答案。角度以弧度为单位。不需要进行数值计算或四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它包含了几何力学和李群理论中的标准定义，并要求推导两个明确定义的量之间的基本关系。不存在不一致、模糊不清或事实错误之处。\n\n我们的任务是根据物体坐标系角速度 $\\omega_{b}(t)$ 和方向矩阵 $R(t)$，推导出空间坐标系角速度 $\\omega_{s}(t)$ 的闭式表达式。推导将从所给定的定义出发。\n\n给定的空间坐标系和物体坐标系角速度的帽映射形式的定义如下：\n$$\n\\widehat{\\omega_{s}}(t) = \\dot{R}(t) R(t)^{\\top} \\quad (1)\n$$\n$$\n\\widehat{\\omega_{b}}(t) = R(t)^{\\top} \\dot{R}(t) \\quad (2)\n$$\n这里，$R(t)$ 是特殊正交群 $\\mathrm{SO}(3)$ 中的一个元素，这意味着 $R(t)$ 是一个行列式为 1 的 $3 \\times 3$ 正交矩阵。任何正交矩阵的一个关键性质是其逆矩阵等于其转置矩阵，即 $R(t)^{-1} = R(t)^{\\top}$。因此，$R(t)R(t)^{\\top} = R(t)^{\\top}R(t) = I$，其中 $I$ 是 $3 \\times 3$ 单位矩阵。\n\n我们的目标是建立 $\\omega_s(t)$ 和 $\\omega_b(t)$ 之间的关系。我们可以通过首先建立它们对应的帽映射形式 $\\widehat{\\omega_{s}}(t)$ 和 $\\widehat{\\omega_{b}}(t)$ 之间的关系来实现这一目标。让我们从方程 $(2)$ 开始，求解旋转矩阵的时间导数 $\\dot{R}(t)$。通过在方程 $(2)$ 两边同时左乘 $R(t)$，我们得到：\n$$\nR(t) \\widehat{\\omega_{b}}(t) = R(t) \\left( R(t)^{\\top} \\dot{R}(t) \\right)\n$$\n利用矩阵乘法的结合律以及 $R(t)R(t)^{\\top} = I$ 的性质，该表达式可简化为：\n$$\nR(t) \\widehat{\\omega_{b}}(t) = \\left( R(t) R(t)^{\\top} \\right) \\dot{R}(t) = I \\dot{R}(t) = \\dot{R}(t)\n$$\n这就得到了一个用 $R(t)$ 和 $\\widehat{\\omega_{b}}(t)$ 表示 $\\dot{R}(t)$ 的表达式：\n$$\n\\dot{R}(t) = R(t) \\widehat{\\omega_{b}}(t) \\quad (3)\n$$\n这个关系被称为右平凡化切向量，或物体速度形式。\n\n现在，我们将这个关于 $\\dot{R}(t)$ 的表达式代入方程 $(1)$ 中 $\\widehat{\\omega_{s}}(t)$ 的定义：\n$$\n\\widehat{\\omega_{s}}(t) = \\left( R(t) \\widehat{\\omega_{b}}(t) \\right) R(t)^{\\top}\n$$\n这可以写成：\n$$\n\\widehat{\\omega_{s}}(t) = R(t) \\widehat{\\omega_{b}}(t) R(t)^{\\top} \\quad (4)\n$$\n由于 $R(t) \\in \\mathrm{SO}(3)$，其逆矩阵为 $R(t)^{-1} = R(t)^{\\top}$。因此，我们可以将方程 $(4)$ 写为：\n$$\n\\widehat{\\omega_{s}}(t) = R(t) \\widehat{\\omega_{b}}(t) R(t)^{-1}\n$$\n这正是李群 $\\mathrm{SO}(3)$ 在其李代数 $\\mathfrak{so}(3)$ 上的伴随表示的定义。具体来说，对于 $g = R(t) \\in \\mathrm{SO}(3)$ 和 $X = \\widehat{\\omega_{b}}(t) \\in \\mathfrak{so}(3)$，我们有 $\\widehat{\\omega_{s}}(t) = \\operatorname{Ad}_{R(t)}(\\widehat{\\omega_{b}}(t))$。\n\n为了从李代数元素过渡到 $\\mathbb{R}^3$ 中的向量，我们使用一个与 $\\mathrm{SO}(3)$ 相关的帽映射的基本恒等式。对于任意旋转矩阵 $A \\in \\mathrm{SO}(3)$ 和任意向量 $v \\in \\mathbb{R}^3$，以下关系成立：\n$$\n\\widehat{Av} = A \\widehat{v} A^{\\top}\n$$\n这个恒等式将群在其代数上的伴随作用与群在向量空间 $\\mathbb{R}^3$ 上的标准作用联系起来。将此恒等式应用于方程 $(4)$，令 $A = R(t)$ 和 $v = \\omega_{b}(t)$，我们得到：\n$$\nR(t) \\widehat{\\omega_{b}}(t) R(t)^{\\top} = \\widehat{R(t) \\omega_{b}(t)}\n$$\n将此结果代回方程 $(4)$ 得到：\n$$\n\\widehat{\\omega_{s}}(t) = \\widehat{R(t) \\omega_{b}(t)}\n$$\n帽映射 $\\widehat{(\\cdot)}: \\mathbb{R}^3 \\to \\mathfrak{so}(3)$ 是一个线性同构。这意味着它是一个一一映射。因此，如果两个向量在帽映射下的像是相等的，那么这两个向量本身也必须相等。通过对上式两边应用帽映射的逆映射，我们得出结论：\n$$\n\\omega_s(t) = R(t) \\omega_b(t)\n$$\n这就是所求的空间坐标系角速度 $\\omega_{s}(t)$ 关于旋转矩阵 $R(t)$ 和物体坐标系角速度 $\\omega_{b}(t)$ 的闭式表达式。",
            "answer": "$$\\boxed{\\omega_s(t) = R(t) \\omega_b(t)}$$"
        },
        {
            "introduction": "除了描述运动，力学的一个关键目标是分析其稳定性。本练习将几何力学中的精巧工具——能量-卡西米尔方法（energy-Casimir method），应用于自由旋转刚体这一经典问题。通过解决这个问题，你将看到抽象的几何结构，如李-泊松系统（Lie-Poisson system）及其卡西米尔不变量（Casimir invariants），如何为物理系统的定性行为提供深刻的见解。",
            "id": "3731339",
            "problem": "考虑一个自由刚体，其位形由旋转矩阵 $R(t) \\in \\mathrm{SO}(3)$（特殊正交群 SO(3)）表示。设物体角速度为向量 $\\omega_{b}(t) \\in \\mathbb{R}^{3}$（物体坐标系中的角速度分量），空间角速度为 $\\Omega_{s}(t) = R(t)\\,\\omega_{b}(t)$。物体坐标系中的惯性张量是对角的，$I = \\mathrm{diag}(I_{1}, I_{2}, I_{3})$，其主转动惯量严格有序 $0  I_{1}  I_{2}  I_{3}$。物体角动量为 $M = I\\,\\omega_{b}$，并根据具有哈密顿量\n$$\nH(M) = \\frac{1}{2}\\,M \\cdot I^{-1} M,\n$$\n和李-泊松括号\n$$\n\\{F,G\\}(M) = -\\,M \\cdot \\big(\\nabla F(M) \\times \\nabla G(M)\\big),\n$$\n的李-泊松哈密顿系统在李代数 $\\mathfrak{so}(3)$ 的对偶空间 $\\mathfrak{so}(3)^{*}$ 上演化，其中 $F$ 和 $G$ 是 $\\mathfrak{so}(3)^{*} \\cong \\mathbb{R}^{3}$ 上的光滑函数。该系统具有卡西米尔函数\n$$\nC(M) = \\frac{1}{2}\\,|M|^{2}.\n$$\n考虑绕第三主轴的稳定转动，其定义为恒定的物体角速度 $\\omega_{b,0} = \\omega_{0}\\,e_{3}$（其中 $\\omega_{0} \\neq 0$），$e_{3}$ 是沿第三主轴的单位向量。相应的平衡角动量为 $M_{0} = I\\,\\omega_{b,0} = I_{3}\\,\\omega_{0}\\,e_{3}$。\n\n使用能量-卡西米尔方法，即考虑增广函数\n$$\nF(M) = H(M) + \\lambda\\,C(M),\n$$\n选择 $\\lambda$ 使得 $M_{0}$ 是 $F$ 的一个临界点。然后计算 $F$ 在 $M_{0}$ 处的二次变分限制在通过 $M_{0}$ 的余伴随轨道的切平面（即与 $M_{0}$ 正交的平面）上的最小非零特征值。将最终答案表示为关于 $I_{1}$、$I_{2}$ 和 $I_{3}$ 的闭式解析表达式。不需要数值近似，最终表达式中不包含单位。",
            "solution": "问题要求使用能量-卡西米尔方法，分析刚体绕其第三主轴转动的稳定性，并求出增广哈密顿量二次变分的最小非零特征值。\n\n第一步是验证问题陈述。\n提取并审阅所有已知条件：\n位形由 $R(t) \\in \\mathrm{SO}(3)$ 给出。\n物体角速度和空间角速度分别为 $\\omega_{b}(t)$ 和 $\\Omega_{s}(t) = R(t)\\,\\omega_{b}(t)$。\n物体坐标系中的惯性张量为 $I = \\mathrm{diag}(I_{1}, I_{2}, I_{3})$，主转动惯量满足 $0  I_{1}  I_{2}  I_{3}$。\n物体角动量为 $M = I\\,\\omega_{b}$。\n哈密顿量为 $H(M) = \\frac{1}{2}\\,M \\cdot I^{-1} M$。\n李-泊松括号为 $\\{F,G\\}(M) = -\\,M \\cdot \\big(\\nabla F(M) \\times \\nabla G(M)\\big)$。\n卡西米尔函数为 $C(M) = \\frac{1}{2}\\,|M|^{2}$。\n所考虑的平衡对应于绕第三主轴的稳定转动，其物体角速度恒定为 $\\omega_{b,0} = \\omega_{0}\\,e_{3}$（其中 $\\omega_{0} \\neq 0$）。相应的平衡角动量为 $M_{0} = I\\,\\omega_{b,0} = I_{3}\\,\\omega_{0}\\,e_{3}$。\n将要使用的方法是能量-卡西米尔方法，增广函数为 $F(M) = H(M) + \\lambda\\,C(M)$。\n任务是：\n1. 找到拉格朗日乘子 $\\lambda$，使得 $M_{0}$ 是 $F(M)$ 的一个临界点。\n2. 计算 $F$ 在 $M_{0}$ 处的二次变分，并将其限制在通过 $M_{0}$ 的余伴随轨道的切平面上。\n3. 找到这个受限二次变分的最小非零特征值。\n\n该问题在科学上基于经典力学和几何力学的原理，特别是刚体运动理论和李群上的哈密顿动力学。问题是适定的，提供了所有必要信息且目标明确。语言精确客观。因此，该问题被视为有效，并将构建解答。\n\n首先，我们用动量向量 $M = (M_{1}, M_{2}, M_{3})$ 的分量来表示增广函数 $F(M)$。\n哈密顿量 $H(M)$ 由下式给出：\n$$\nH(M) = \\frac{1}{2} M \\cdot (I^{-1} M) = \\frac{1}{2} \\left( \\frac{M_{1}^{2}}{I_{1}} + \\frac{M_{2}^{2}}{I_{2}} + \\frac{M_{3}^{2}}{I_{3}} \\right)\n$$\n卡西米尔函数 $C(M)$ 为：\n$$\nC(M) = \\frac{1}{2} |M|^{2} = \\frac{1}{2} (M_{1}^{2} + M_{2}^{2} + M_{3}^{2})\n$$\n因此，增广函数 $F(M) = H(M) + \\lambda C(M)$ 为：\n$$\nF(M) = \\frac{1}{2} \\left[ \\left(\\frac{1}{I_{1}} + \\lambda\\right)M_{1}^{2} + \\left(\\frac{1}{I_{2}} + \\lambda\\right)M_{2}^{2} + \\left(\\frac{1}{I_{3}} + \\lambda\\right)M_{3}^{2} \\right]\n$$\n为使 $M_{0}$ 成为 $F(M)$ 的临界点，$F$ 的梯度必须在 $M_{0}$ 处为零，即 $\\nabla F(M_{0}) = 0$。$F$ 的梯度是：\n$$\n\\nabla F(M) = \\left( \\frac{\\partial F}{\\partial M_{1}}, \\frac{\\partial F}{\\partial M_{2}}, \\frac{\\partial F}{\\partial M_{3}} \\right) = \\left( \\left(\\frac{1}{I_{1}} + \\lambda\\right)M_{1}, \\left(\\frac{1}{I_{2}} + \\lambda\\right)M_{2}, \\left(\\frac{1}{I_{3}} + \\lambda\\right)M_{3} \\right)\n$$\n平衡动量为 $M_{0} = I_{3}\\,\\omega_{0}\\,e_{3} = (0, 0, I_{3}\\,\\omega_{0})$。计算在 $M_{0}$ 处的梯度：\n$$\n\\nabla F(M_{0}) = \\left( 0, 0, \\left(\\frac{1}{I_{3}} + \\lambda\\right)I_{3}\\,\\omega_{0} \\right)\n$$\n为使该向量为零向量，其第三个分量必须等于零。由于给定 $\\omega_{0} \\neq 0$ 且 $I_{3} > 0$，项 $I_{3}\\,\\omega_{0}$ 非零。因此，我们必须有：\n$$\n\\frac{1}{I_{3}} + \\lambda = 0 \\implies \\lambda = -\\frac{1}{I_{3}}\n$$\n这就确定了 $\\lambda$ 的值。\n\n接下来，我们计算 $F$ 在 $M_{0}$ 处的二次变分，它由海森矩阵 $\\delta^{2}F(M_{0}) = \\nabla^{2}F(M_{0})$ 给出。$F(M)$ 的海森矩阵是一个对角矩阵，其元素为：\n$$\n\\nabla^{2}F(M) = \\mathrm{diag}\\left(\\frac{\\partial^{2} F}{\\partial M_{1}^{2}}, \\frac{\\partial^{2} F}{\\partial M_{2}^{2}}, \\frac{\\partial^{2} F}{\\partial M_{3}^{2}}\\right) = \\mathrm{diag}\\left(\\frac{1}{I_{1}} + \\lambda, \\frac{1}{I_{2}} + \\lambda, \\frac{1}{I_{3}} + \\lambda\\right)\n$$\n代入 $\\lambda = -1/I_{3}$，在平衡点 $M_{0}$ 处的海森矩阵为：\n$$\n\\delta^{2}F(M_{0}) = \\mathrm{diag}\\left(\\frac{1}{I_{1}} - \\frac{1}{I_{3}}, \\frac{1}{I_{2}} - \\frac{1}{I_{3}}, \\frac{1}{I_{3}} - \\frac{1}{I_{3}}\\right)\n$$\n$$\n\\delta^{2}F(M_{0}) = \\mathrm{diag}\\left(\\frac{I_{3} - I_{1}}{I_{1}I_{3}}, \\frac{I_{3} - I_{2}}{I_{2}I_{3}}, 0\\right)\n$$\n问题要求我们考虑此二次变分限制在通过 $M_{0}$ 的余伴随轨道的切平面上。余伴随轨道是卡西米尔函数 $C(M)$ 的水平集，即以原点为中心的球面。在 $M_{0}$ 处轨道的切空间由所有与该点卡西米尔函数梯度正交的向量 $\\delta M$ 组成。\n$C(M)$ 的梯度是 $\\nabla C(M) = M$。在 $M_{0}$ 处，该梯度为 $\\nabla C(M_{0}) = M_{0}$。\n因此，切平面是所有满足 $\\delta M \\cdot M_{0} = 0$ 的向量 $\\delta M = (\\delta M_{1}, \\delta M_{2}, \\delta M_{3})$ 的集合。\n由于 $M_{0} = (0, 0, I_{3}\\,\\omega_{0})$，该条件变为：\n$$\n(\\delta M_{1}, \\delta M_{2}, \\delta M_{3}) \\cdot (0, 0, I_{3}\\,\\omega_{0}) = \\delta M_{3} (I_{3}\\,\\omega_{0}) = 0\n$$\n由于 $I_{3}\\,\\omega_{0} \\neq 0$，我们必须有 $\\delta M_{3} = 0$。切平面是 $M_{1}$-$M_{2}$ 平面，由基向量 $e_{1} = (1, 0, 0)$ 和 $e_{2} = (0, 1, 0)$ 张成。\n\n为了找到限制在该平面上的二次变分的特征值，我们考虑海森矩阵对该平面中向量的作用。切平面中的任何向量都具有形式 $v = (v_{1}, v_{2}, 0)$。海森矩阵对 $v$ 的作用是：\n$$\n(\\delta^{2}F(M_{0})) v = \\begin{pmatrix} \\frac{I_{3} - I_{1}}{I_{1}I_{3}}  0  0 \\\\ 0  \\frac{I_{3} - I_{2}}{I_{2}I_{3}}  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} v_{1} \\\\ v_{2} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{I_{3} - I_{1}}{I_{1}I_{3}} v_{1} \\\\ \\frac{I_{3} - I_{2}}{I_{2}I_{3}} v_{2} \\\\ 0 \\end{pmatrix}\n$$\n该平面中的特征向量是 $e_{1}$ 和 $e_{2}$，受限算子对应的特征值为：\n$$\n\\mu_{1} = \\frac{I_{3} - I_{1}}{I_{1}I_{3}}\n$$\n$$\n\\mu_{2} = \\frac{I_{3} - I_{2}}{I_{2}I_{3}}\n$$\n问题要求的是最小的非零特征值。我们已知主转动惯量的顺序为：$0  I_{1}  I_{2}  I_{3}$。\n这意味着 $I_{3} - I_{1} > 0$ 且 $I_{3} - I_{2} > 0$。由于所有转动惯量均为正，分母 $I_{1}I_{3}$ 和 $I_{2}I_{3}$ 也都是正的。因此，两个特征值 $\\mu_{1}$ 和 $\\mu_{2}$ 均为正，从而非零。\n（这些特征值的正性表明绕最大转动惯量轴的转动是稳定的，正如预期的那样）。\n\n为了找出两者中较小的一个，我们对它们进行比较。比较形式 $\\mu_{1} = \\frac{1}{I_{1}} - \\frac{1}{I_{3}}$ 和 $\\mu_{2} = \\frac{1}{I_{2}} - \\frac{1}{I_{3}}$ 会更容易。\n从 $I_{1}  I_{2}$，取倒数可得 $\\frac{1}{I_{1}} > \\frac{1}{I_{2}}$。\n从两边减去常数项 $\\frac{1}{I_{3}}$ 保持不等式不变：\n$$\n\\frac{1}{I_{1}} - \\frac{1}{I_{3}} > \\frac{1}{I_{2}} - \\frac{1}{I_{3}}\n$$\n这表明 $\\mu_{1} > \\mu_{2}$。最小的非零特征值是 $\\mu_{2}$。\n最终结果是：\n$$\n\\mu_{2} = \\frac{I_{3} - I_{2}}{I_{2}I_{3}}\n$$\n这个表达式是所要求的用 $I_{1}$、$I_{2}$ 和 $I_{3}$ 表示的闭式解析答案。",
            "answer": "$$\\boxed{\\frac{I_{3} - I_{2}}{I_{2} I_{3}}}$$"
        },
        {
            "introduction": "将理论动力学转化为实际仿真是工程和物理学中的一项至关重要的技能。这个问题挑战你实现一个几何数值积分器，这是一种能够在李群 $SO(3)$ 上正确演化刚体姿态的现代算法。这个动手编程练习展示了如何在计算中保持问题的几何结构，利用指数映射（exponential map）等工具，从而避免传统积分方案中常见的数值误差，如正交性的丧失。",
            "id": "3731349",
            "problem": "考虑三维空间中保持方向的旋转构成的特殊正交群 $SO(3)$。令 $R(t) \\in SO(3)$ 表示刚体在时间 $t$ 的位形（旋转矩阵），并令体角速度 $\\omega(t) \\in \\mathbb{R}^3$ 由运动学关系 $\\widehat{\\omega}(t) = R(t)^\\top \\dot{R}(t)$ 定义，其中帽映射 $\\widehat{\\cdot} : \\mathbb{R}^3 \\to \\mathfrak{so}(3)$ 将一个向量映射到其对应的斜对称矩阵。空间角速度 $\\Omega(t) \\in \\mathbb{R}^3$ 由 $\\widehat{\\Omega}(t) = \\dot{R}(t) R(t)^\\top$ 定义。它们满足关系 $\\Omega(t) = R(t)\\,\\omega(t)$。\n\n几何数值积分问题是，在每一步中使用与时间平均的体角速度相关联的 Lie 代数元素，通过保结构更新来沿着 Lie 群推进，从而在 $SO(3)$ 中演化 $R(t)$。您的推导和实现必须从基本运动学关系 $\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)$ 以及从 $\\mathfrak{so}(3)$ 到 $SO(3)$ 的指数映射的定义出发，不得调用快捷公式。\n\n实现一个程序，该程序：\n- 推导一个一阶精确、保群的离散更新，该更新使用中点体角速度 $\\omega(t_k + h/2)$，将在时间 $t_k$ 的 $R_k \\in SO(3)$ 映射到时间 $t_{k+1} = t_k + h$ 的 $R_{k+1} \\in SO(3)$。\n- 在每一步上使用 $SO(3)$ 上的矩阵对数通过以下方式定义离散空间角速度：\n$$\\widehat{\\Omega}_k^{\\mathrm{disc}} = \\frac{1}{h}\\,\\log\\!\\big(R_{k+1} R_k^\\top\\big),$$\n并将其与映射后的中点体角速度 $R_k\\,\\omega(t_k + h/2)$ 进行比较。\n\n对于每个时间步 $k$，计算以下诊断量：\n- 正交性误差\n$$\\epsilon_{\\mathrm{ortho}}(k) = \\big\\|R_k^\\top R_k - I_3\\big\\|_F,$$\n其中 $\\|\\cdot\\|_F$ 表示 Frobenius 范数。\n- 行列式误差\n$$\\epsilon_{\\mathrm{det}}(k) = \\big|\\det(R_k) - 1\\big|.$$\n- 运动学一致性误差\n$$\\epsilon_{\\mathrm{kin}}(k) = \\big\\|\\Omega_k^{\\mathrm{disc}} - R_k\\,\\omega(t_k + h/2)\\big\\|_2,$$\n其中 $\\Omega_k^{\\mathrm{disc}} \\in \\mathbb{R}^3$ 是通过对 $\\widehat{\\Omega}_k^{\\mathrm{disc}}$ 应用逆帽（vee）映射得到的向量。\n\n经过 $N$ 步后，计算最终旋转角\n$$\\theta_{\\mathrm{final}} = \\arccos\\!\\left(\\frac{\\operatorname{trace}(R_N) - 1}{2}\\right),$$\n以弧度表示。\n\n所有角速度单位必须为弧度/秒（rad/s），所有角度单位必须为弧度。所有时间单位必须为秒（s）。初始条件为 $R_0 = I_3$。\n\n测试套件：\n针对以下四个测试用例实现上述算法，每个用例都有自己的体角速度函数 $\\omega(t)$、最终时间 $T$ 和步长 $h$：\n- 用例 1（平滑、低频）：$T = 1.0\\,\\mathrm{s}$，$h = 0.01\\,\\mathrm{s}$，以及\n$$\\omega(t) = \\begin{bmatrix} 0.3 \\sin(0.7 t) \\\\ 0.2 \\cos(0.5 t) \\\\ 0.1 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- 用例 2（零运动）：$T = 1.0\\,\\mathrm{s}$，$h = 0.02\\,\\mathrm{s}$，以及\n$$\\omega(t) = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- 用例 3（单次大步长，恒定体自旋）：$T = 1.2\\,\\mathrm{s}$，$h = 1.2\\,\\mathrm{s}$，以及\n$$\\omega(t) = \\begin{bmatrix} 0 \\\\ 0 \\\\ 2.0 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- 用例 4（高频分量，中等步长）：$T = 0.4\\,\\mathrm{s}$，$h = 0.05\\,\\mathrm{s}$，以及\n$$\\omega(t) = \\begin{bmatrix} 2.0 \\sin(8 t) \\\\ -1.5 \\sin(9 t) \\\\ 1.0 \\cos(7 t) \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n\n对于每个用例，报告以下包含四个浮点数的列表：\n$$\\Big[\\max_k \\epsilon_{\\mathrm{ortho}}(k),\\ \\max_k \\epsilon_{\\mathrm{det}}(k),\\ \\max_k \\epsilon_{\\mathrm{kin}}(k),\\ \\theta_{\\mathrm{final}}\\Big].$$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是如上所述的包含四个浮点数的列表（例如，$\\big[[a,b,c,d],[e,f,g,h]\\big]$）。输出不得包含任何空格。",
            "solution": "该问题要求推导并实现一个用于特殊正交群 $SO(3)$ 上刚体动力学的几何数值积分器。核心任务是根据运动学方程 $\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)$ 来演化姿态矩阵 $R(t) \\in SO(3)$，其中 $\\omega(t) \\in \\mathbb{R}^3$ 是体固角速度，$\\widehat{\\cdot}$ 是从 $\\mathbb{R}^3$ 到斜对称矩阵 Lie 代数 $\\mathfrak{so}(3)$ 的帽映射。\n\n问题指定了一个使用中点体角速度的一阶精确、保结构的更新规则。我们将首先推导这个积分器，然后分析要计算的诊断量。\n\n**几何积分器的推导**\n\n基本运动学常微分方程 (ODE) 为：\n$$\n\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)\n$$\n为获得从时间 $t_k$ 到 $t_{k+1} = t_k + h$ 的离散更新，我们考虑此区间上的 ODE。问题要求使用中点体角速度，这意味着用区间 $[t_k, t_{k+1}]$ 上的一个常量值来近似可能随时间变化的 $\\omega(t)$，具体来说，就是其在中点 $t_{k+1/2} = t_k + h/2$ 处的值。令 $\\omega_{k+1/2} = \\omega(t_{k+1/2})$。因此，该 ODE 可近似为：\n$$\n\\dot{R}(t) \\approx R(t)\\,\\widehat{\\omega}_{k+1/2}\n$$\n这是一个线性时不变矩阵 ODE。为求解它，我们右乘 $R(t)^{-1}$ 并引入一个变量 $u(t) = R_k^{-1} R(t)$，其中 $R_k = R(t_k)$。对 $u(t)$ 求导得到 $\\dot{u}(t) = R_k^{-1} \\dot{R}(t) = R_k^{-1} R(t) \\widehat{\\omega}_{k+1/2} = u(t) \\widehat{\\omega}_{k+1/2}$。初始条件为 $u(t_k) = R_k^{-1} R_k = I_3$，其中 $I_3$ 是 $3 \\times 3$ 的单位矩阵。\n\n初值问题 $\\dot{u}(\\tau) = u(\\tau) A$ 且 $u(0)=I$ 的解为 $u(\\tau) = \\exp(\\tau A)$。在我们的例子中，$A = \\widehat{\\omega}_{k+1/2}$，我们在时长为 $h$ 的区间上积分。因此，$u(t)$ 在 $t=t_{k+1}$ 时的解为 $u(t_{k+1}) = \\exp(h\\,\\widehat{\\omega}_{k+1/2})$。将 $u(t_{k+1}) = R_k^{-1} R_{k+1}$ 代回，我们得到：\n$$\nR_k^{-1} R_{k+1} = \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n$$\n左乘 $R_k$ 得到最终的更新规则：\n$$\nR_{k+1} = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n$$\n这是一个 Lie 群积分器，被称为指数中点规则（或 Lie-Euler 方法的一个变体）。它是保结构的：如果 $R_k \\in SO(3)$，那么 $R_{k+1}$ 也属于 $SO(3)$。这是因为 $\\widehat{\\omega}_{k+1/2} \\in \\mathfrak{so}(3)$，并且矩阵指数将 Lie 代数 $\\mathfrak{so}(3)$ 映射到 Lie 群 $SO(3)$。两个 $SO(3)$ 中矩阵的乘积仍在 $SO(3)$ 中。\n\n**诊断量的分析**\n\n1.  **正交性和行列式误差**：\n    正交性误差是 $\\epsilon_{\\mathrm{ortho}}(k) = \\big\\|R_k^\\top R_k - I_3\\big\\|_F$，行列式误差是 $\\epsilon_{\\mathrm{det}}(k) = \\big|\\det(R_k) - 1\\big|$。由于更新规则保证了如果 $R_k \\in SO(3)$，则 $R_{k+1} \\in SO(3)$，因此从 $R_0 = I_3$ 开始，对于所有 $k$ 都必然有 $R_k^\\top R_k = I_3$ 和 $\\det(R_k) = 1$。矩阵指数的性质保证了这一点：对于任何斜对称矩阵 $A \\in \\mathfrak{so}(3)$，$\\exp(A)$ 是一个正交矩阵，且 $\\det(\\exp(A)) = \\exp(\\operatorname{trace}(A)) = \\exp(0) = 1$。因此，这些误差预计仅由浮点表示和矩阵指数数值算法的有限精度引起，否则应为零。\n\n2.  **运动学一致性误差**：\n    运动学一致性误差定义为 $\\epsilon_{\\mathrm{kin}}(k) = \\big\\|\\Omega_k^{\\mathrm{disc}} - R_k\\,\\omega_{k+1/2}\\big\\|_2$，其中离散空间角速度 $\\Omega_k^{\\mathrm{disc}}$ 从 $\\widehat{\\Omega}_k^{\\mathrm{disc}} = \\frac{1}{h}\\,\\log\\!\\big(R_{k+1} R_k^\\top\\big)$ 得到。我们可以证明，对于我们特定的积分器和此定义，该误差理论上为零。\n    从我们的更新规则开始：\n    $$\n    R_{k+1} = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n    $$\n    后乘 $R_k^\\top$（由于 $R_k \\in SO(3)$, 它等于 $R_k^{-1}$）：\n    $$\n    R_{k+1} R_k^\\top = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2}) R_k^\\top\n    $$\n    使用矩阵指数和相似变换的恒等式 $\\exp(P A P^{-1}) = P \\exp(A) P^{-1}$，我们得到：\n    $$\n    R_{k+1} R_k^\\top = \\exp(R_k (h\\,\\widehat{\\omega}_{k+1/2}) R_k^\\top)\n    $$\n    此外，对于任何旋转矩阵 $R \\in SO(3)$ 和向量 $v \\in \\mathbb{R}^3$，帽映射满足恒等式 $\\widehat{Rv} = R \\widehat{v} R^\\top$。应用此恒等式：\n    $$\n    R_{k+1} R_k^\\top = \\exp(h\\,\\widehat{R_k \\omega_{k+1/2}})\n    $$\n    现在，对两边取矩阵对数：\n    $$\n    \\log(R_{k+1} R_k^\\top) = h\\,\\widehat{R_k \\omega_{k+1/2}}\n    $$\n    除以步长 $h$：\n    $$\n    \\frac{1}{h} \\log(R_{k+1} R_k^\\top) = \\widehat{R_k \\omega_{k+1/2}}\n    $$\n    左边的表达式是 $\\widehat{\\Omega}_k^{\\mathrm{disc}}$ 的定义。因此：\n    $$\n    \\widehat{\\Omega}_k^{\\mathrm{disc}} = \\widehat{R_k \\omega_{k+1/2}}\n    $$\n    对两边应用逆帽映射（vee 映射, $\\vee$），它从其斜对称矩阵表示中提取向量，得到：\n    $$\n    \\Omega_k^{\\mathrm{disc}} = R_k \\omega_{k+1/2}\n    $$\n    这表明运动学一致性误差中比较的两个量是相同的。因此，计算出的误差 $\\epsilon_{\\mathrm{kin}}(k)$ 将仅由矩阵对数（`logm`）、矩阵指数（`expm`）和浮点运算的数值精度引起，否则应为零。\n\n3.  **最终旋转角**：\n    经过 $N$ 步后，最终旋转角 $\\theta_{\\mathrm{final}}$ 由最终旋转矩阵 $R_N$ 的迹计算得出。公式 $\\theta = \\arccos\\left(\\frac{\\operatorname{trace}(R) - 1}{2}\\right)$ 是对于任何旋转矩阵 $R \\in SO(3)$ 的一个标准结果。\n\n**实现策略**\n\n解决方案通过创建一个函数来实现，该函数接收仿真参数（$T$、$h$ 和函数 $\\omega(t)$）并执行积分。在一个包含 $N = T/h$ 步的循环中，算法计算中点速度，构造 Lie 代数元素，计算矩阵指数以找到增量旋转，并更新姿态矩阵 $R_k$。在此循环内，每一步都会计算并存储指定的诊断误差。循环结束后，将每个误差序列的最大值和最终旋转角汇编到给定测试用例的结果列表中。对所有四个提供的测试用例重复此过程。为了清晰性和可重用性，定义了用于`hat`和`vee`映射的辅助函数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, logm\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n\n    def hat(v):\n        \"\"\"Maps a vector in R^3 to its corresponding skew-symmetric matrix in so(3).\"\"\"\n        return np.array([\n            [0, -v[2], v[1]],\n            [v[2], 0, -v[0]],\n            [-v[1], v[0], 0]\n        ])\n\n    def vee(S):\n        \"\"\"Maps a skew-symmetric matrix in so(3) to its corresponding vector in R^3.\"\"\"\n        # Using a robust formula to handle potential numerical inaccuracies\n        return np.array([\n            (S[2, 1] - S[1, 2]) / 2.0,\n            (S[0, 2] - S[2, 0]) / 2.0,\n            (S[1, 0] - S[0, 1]) / 2.0\n        ])\n\n    def solve_case(T, h, omega_func):\n        \"\"\"\n        Solves one case of the rigid body integration problem.\n\n        Args:\n            T (float): Total simulation time.\n            h (float): Time step size.\n            omega_func (callable): Function omega(t) that returns the body angular velocity.\n\n        Returns:\n            list: A list of four floats: [max_ortho_error, max_det_error, max_kin_error, theta_final].\n        \"\"\"\n        num_steps = int(round(T / h))\n        R = np.eye(3)\n        \n        ortho_errors = []\n        det_errors = []\n        kin_errors = []\n\n        # Diagnostics for initial state R_0\n        ortho_errors.append(np.linalg.norm(R.T @ R - np.eye(3), 'fro'))\n        det_errors.append(abs(np.linalg.det(R) - 1.0))\n\n        for k in range(num_steps):\n            t_k = k * h\n            R_k = R\n\n            # Calculate midpoint angular velocity\n            t_mid = t_k + h / 2.0\n            w_mid = omega_func(t_mid)\n\n            # Lie algebra element\n            w_hat = hat(w_mid)\n\n            # Update rotation matrix using matrix exponential\n            delta_R = expm(h * w_hat)\n            R_next = R_k @ delta_R\n            R = R_next\n\n            # Orthogonality and determinant errors for R_{k+1}\n            ortho_errors.append(np.linalg.norm(R.T @ R - np.eye(3), 'fro'))\n            det_errors.append(abs(np.linalg.det(R) - 1.0))\n\n            # Kinematic consistency error for step k\n            rel_rot = R_next @ R_k.T\n            log_rel_rot = logm(rel_rot)\n            Omega_disc_hat = log_rel_rot / h\n            Omega_disc = vee(Omega_disc_hat)\n            \n            Omega_ref = R_k @ w_mid\n            \n            kin_errors.append(np.linalg.norm(Omega_disc - Omega_ref))\n\n        R_N = R\n        # Final rotation angle\n        trace_R_N = np.trace(R_N)\n        # Clip argument for arccos to handle potential floating point errors\n        arg = np.clip((trace_R_N - 1.0) / 2.0, -1.0, 1.0)\n        theta_final = np.arccos(arg)\n\n        # Collect final results for the case\n        max_ortho_error = np.max(ortho_errors)\n        max_det_error = np.max(det_errors)\n        max_kin_error = 0.0 if not kin_errors else np.max(kin_errors) # Handle N=0 case\n\n        return [max_ortho_error, max_det_error, max_kin_error, theta_final]\n\n    # Define the angular velocity functions for each test case\n    def omega1(t):\n        return np.array([0.3 * np.sin(0.7 * t), 0.2 * np.cos(0.5 * t), 0.1])\n\n    def omega2(t):\n        return np.array([0.0, 0.0, 0.0])\n\n    def omega3(t):\n        return np.array([0.0, 0.0, 2.0])\n\n    def omega4(t):\n        return np.array([2.0 * np.sin(8 * t), -1.5 * np.sin(9 * t), 1.0 * np.cos(7 * t)])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, omega1),\n        (1.0, 0.02, omega2),\n        (1.2, 1.2, omega3),\n        (0.4, 0.05, omega4),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        T, h, omega_func = case\n        result = solve_case(T, h, omega_func)\n        all_results.append(result)\n\n    # Format the final output string to exactly match requirements (no spaces).\n    results_str = ','.join([repr(res).replace(' ', '') for res in all_results])\n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        }
    ]
}