{
    "hands_on_practices": [
        {
            "introduction": "理解刚体运动需要一种能将抽象群论与物理直观联系起来的数学语言。此练习的核心是揭示李代数 $\\mathfrak{so}(3)$ 上的矩阵换位子与三维向量空间 $\\mathbb{R}^3$ 上的矢量叉乘之间的同构关系。通过完成这个基础性的推导 ，您将把抽象的伴随作用概念转化为熟悉的矢量叉乘运算，为在体坐标系中推导运动方程奠定坚实基础。",
            "id": "3782390",
            "problem": "考虑一个自由刚体，其位形空间为特殊正交群 (SO(3))。相关的李代数是实反对称矩阵的集合，记作 $\\mathfrak{so}(3)$，并配有李括号 $[\\Omega,\\eta]=\\Omega\\,\\eta-\\eta\\,\\Omega$。三维实向量空间 $\\mathbb{R}^{3}$ 与 $\\mathfrak{so}(3)$ 之间的典范等同（“帽映射”）定义为：为每个向量 $\\omega \\in \\mathbb{R}^{3}$ 指定一个反对称矩阵 $\\widehat{\\omega} \\in \\mathfrak{so}(3)$，使得对于所有 $x\\in\\mathbb{R}^{3}$，都有 $\\widehat{\\omega}\\,x=\\omega\\times x$，其中 $\\times$ 表示向量叉积。设 $\\Omega=\\widehat{\\omega}$ 和 $\\eta=\\widehat{\\eta}$ 是 $\\mathfrak{so}(3)$ 中的两个元素，分别对应于向量 $\\omega,\\eta\\in\\mathbb{R}^{3}$。从 $\\mathfrak{so}(3)$ 上李括号的基本定义和帽映射的定义性质出发，计算伴随算子 $\\mathrm{ad}_{\\Omega}(\\eta)=[\\Omega,\\eta]$，并将其在逆帽等同下的像表示为 $\\mathbb{R}^{3}$ 中的一个单向量。将你的最终答案表示为关于 $\\omega$ 和 $\\eta$ 的单个闭式解析表达式（不需要单位，也不需要数值近似）。",
            "solution": "我们从刚体运动学位形空间，即特殊正交群 (SO(3)) 开始，其李代数 $\\mathfrak{so}(3)$ 由 $3\\times 3$ 的实反对称矩阵构成。$\\mathfrak{so}(3)$ 上的李括号由交换子定义：\n$$\n[\\Omega,\\eta]=\\Omega\\,\\eta-\\eta\\,\\Omega.\n$$\n帽映射是典范线性同构 $\\widehat{\\cdot}:\\mathbb{R}^{3}\\to\\mathfrak{so}(3)$，根据定义，它满足：\n$$\n\\widehat{\\omega}\\,x=\\omega\\times x,\\quad \\text{对所有 }x\\in\\mathbb{R}^{3}.\n$$\n设 $\\Omega=\\widehat{\\omega}$ 和 $\\eta=\\widehat{\\eta}$，其中 $\\omega,\\eta\\in\\mathbb{R}^{3}$。我们的目标是计算 $[\\Omega,\\eta]$ 的矩阵形式，然后使用逆帽映射将结果映射回 $\\mathbb{R}^{3}$，以获得伴随作用的向量形式。\n\n为了进行分量计算，我们使用 Levi-Civita 符号来表示反对称矩阵。对于任意 $\\omega\\in\\mathbb{R}^{3}$，$\\widehat{\\omega}$ 的分量为\n$$\n(\\widehat{\\omega})_{ij}=-\\epsilon_{ijk}\\,\\omega_{k},\n$$\n类似地，$(\\widehat{\\eta})_{ij}=-\\epsilon_{ijk}\\,\\eta_{k}$，其中 $\\epsilon_{ijk}$ 是 Levi-Civita 符号，且我们对重复指标使用爱因斯坦求和约定。\n\n计算乘积 $\\widehat{\\omega}\\,\\widehat{\\eta}$：\n$$\n(\\widehat{\\omega}\\,\\widehat{\\eta})_{ij}=(\\widehat{\\omega})_{i\\ell}\\,(\\widehat{\\eta})_{\\ell j}\n=(-\\epsilon_{i\\ell p}\\,\\omega_{p})\\,(-\\epsilon_{\\ell j q}\\,\\eta_{q})\n=\\epsilon_{i\\ell p}\\,\\epsilon_{\\ell j q}\\,\\omega_{p}\\,\\eta_{q}.\n$$\n使用恒等式\n$$\n\\epsilon_{i\\ell p}\\,\\epsilon_{\\ell j q}=\\delta_{ij}\\,\\delta_{pq}-\\delta_{iq}\\,\\delta_{pj},\n$$\n我们得到\n$$\n(\\widehat{\\omega}\\,\\widehat{\\eta})_{ij}=\\delta_{ij}\\,\\omega_{p}\\,\\eta_{p}-\\omega_{j}\\,\\eta_{i}\n=\\delta_{ij}\\,(\\omega\\cdot\\eta)-\\omega_{j}\\,\\eta_{i}.\n$$\n类似地，交换 $\\omega$ 和 $\\eta$ 的位置可得\n$$\n(\\widehat{\\eta}\\,\\widehat{\\omega})_{ij}=\\delta_{ij}\\,(\\eta\\cdot\\omega)-\\eta_{j}\\,\\omega_{i}\n=\\delta_{ij}\\,(\\omega\\cdot\\eta)-\\eta_{j}\\,\\omega_{i}.\n$$\n因此，交换子为\n$$\n[\\widehat{\\omega},\\widehat{\\eta}]_{ij}\n=(\\widehat{\\omega}\\,\\widehat{\\eta}-\\widehat{\\eta}\\,\\widehat{\\omega})_{ij}\n=\\big(\\delta_{ij}\\,(\\omega\\cdot\\eta)-\\omega_{j}\\,\\eta_{i}\\big)\n-\\big(\\delta_{ij}\\,(\\omega\\cdot\\eta)-\\eta_{j}\\,\\omega_{i}\\big)\n=\\eta_{j}\\,\\omega_{i}-\\omega_{j}\\,\\eta_{i}.\n$$\n现在我们将其与叉积的帽映射联系起来。考虑 $(\\omega\\times\\eta)_{k}=\\epsilon_{kmn}\\,\\omega_{m}\\,\\eta_{n}$。$\\widehat{\\omega\\times\\eta}$ 的分量是\n$$\n(\\widehat{\\omega\\times\\eta})_{ij}=-\\epsilon_{ijk}\\,(\\omega\\times\\eta)_{k}\n=-\\epsilon_{ijk}\\,\\epsilon_{kmn}\\,\\omega_{m}\\,\\eta_{n}.\n$$\n使用恒等式\n$$\n\\epsilon_{ijk}\\,\\epsilon_{kmn}=\\delta_{im}\\,\\delta_{jn}-\\delta_{in}\\,\\delta_{jm},\n$$\n我们发现\n$$\n(\\widehat{\\omega\\times\\eta})_{ij}\n=-(\\delta_{im}\\,\\delta_{jn}-\\delta_{in}\\,\\delta_{jm})\\,\\omega_{m}\\,\\eta_{n}\n=-(\\omega_{i}\\,\\eta_{j}-\\omega_{j}\\,\\eta_{i})\n=\\eta_{j}\\,\\omega_{i}-\\omega_{j}\\,\\eta_{i}.\n$$\n将此结果与交换子的分量进行比较，我们得出结论\n$$\n[\\widehat{\\omega},\\widehat{\\eta}]=\\widehat{\\omega\\times\\eta}.\n$$\n对等式两边应用逆帽映射，得到 $\\mathbb{R}^{3}$ 上伴随作用的向量形式：\n$$\n\\mathrm{ad}_{\\Omega}(\\eta)=\\mathrm{ad}_{\\widehat{\\omega}}(\\widehat{\\eta})\n=[\\widehat{\\omega},\\widehat{\\eta}]\n\\quad\\longleftrightarrow\\quad\n\\omega\\times\\eta.\n$$\n因此，在帽等同 $\\mathbb{R}^{3}\\cong\\mathfrak{so}(3)$ 下，伴随算子对应于 $\\mathbb{R}^{3}$ 中的向量叉积，所求的表达式就是单个向量 $\\omega\\times\\eta$。",
            "answer": "$$\\boxed{\\omega\\times\\eta}$$"
        },
        {
            "introduction": "在建立了代数基础之后，我们需要用具体的方法来描述刚体的姿态，而欧拉角是一种常见且直观的选择。此练习旨在探索欧拉角的变化率与刚体角速度之间的关系，这一关系由左平凡化雅可比矩阵描述。通过推导这个雅可比矩阵并找出其奇异点 ，您将从第一性原理的层面深刻理解“万向节死锁”现象，揭示欧拉角表示法的关键局限性。",
            "id": "3782402",
            "problem": "令特殊正交群 (SO(3)) 由 $Z\\!Y\\!Z$ 欧拉角映射 $\\Phi : \\mathbb{R}^{3} \\to SO(3)$ 参数化，其形式为\n$$\nR(\\phi,\\theta,\\psi) \\;=\\; R_{z}(\\phi)\\,R_{y}(\\theta)\\,R_{z}(\\psi),\n$$\n其中 $R_{z}(\\alpha)$ 是绕 z 轴旋转角度 $\\alpha$ 的旋转，$R_{y}(\\beta)$ 是绕 y 轴旋转角度 $\\beta$ 的旋转。假设所有角度均以弧度为单位。仅使用以下基本定义和事实：\n- $SO(3) = \\{ R \\in \\mathbb{R}^{3 \\times 3} \\mid R^{\\top}R = I,\\ \\det R = 1 \\}$，\n- 满足 $\\widehat{\\omega}\\,x = \\omega \\times x$ 的帽映射 $\\widehat{(\\cdot)} : \\mathbb{R}^{3} \\to \\mathfrak{so}(3)$，\n- 由 $\\widehat{\\omega} = R^{\\top}\\dot{R}$ 定义的体角速度 $\\omega \\in \\mathbb{R}^{3}$，\n\n推导左平凡化雅可比矩阵 $J(\\phi,\\theta,\\psi) \\in \\mathbb{R}^{3 \\times 3}$，该矩阵通过 $\\omega = J(\\phi,\\theta,\\psi)\\,(\\dot{\\phi},\\dot{\\theta},\\dot{\\psi})^{\\top}$ 将欧拉角速率 $(\\dot{\\phi},\\dot{\\theta},\\dot{\\psi})$ 映射到体角速度 $\\omega$。然后计算行列式 $\\det J(\\phi,\\theta,\\psi)$，并确定雅可比矩阵降秩的奇点集合。\n\n作为最终答案，仅提供用 $\\phi,\\theta,\\psi$ 表示的 $\\det J(\\phi,\\theta,\\psi)$ 的精确解析表达式（无单位，不进行四舍五入）。角度必须以弧度处理。",
            "solution": "我们的目标是推导左平凡化雅可比矩阵 $J(\\phi, \\theta, \\psi)$，它通过线性映射 $\\omega = J(\\phi, \\theta, \\psi) (\\dot{\\phi}, \\dot{\\theta}, \\dot{\\psi})^{\\top}$ 将欧拉角的时间导数 $(\\dot{\\phi}, \\dot{\\theta}, \\dot{\\psi})$ 与体坐标系中的角速度 $\\omega$ 联系起来。\n\n刚体的总角速度 $\\omega$ 是由三个独立的欧拉角速率引起的角速度的矢量和。ZYZ序列的旋转过程如下：\n1.  绕空间坐标系的 z 轴旋转 $\\phi$。角速度为 $\\dot{\\phi} \\mathbf{k}$，其中 $\\mathbf{k}$ 是空间z轴的单位向量。\n2.  绕新的（一次旋转后的）y 轴旋转 $\\theta$。该轴在空间坐标系中的方向为 $R_z(\\phi) \\mathbf{j}$。角速度为 $\\dot{\\theta} (R_z(\\phi) \\mathbf{j})$。\n3.  绕最终的（两次旋转后的）z 轴旋转 $\\psi$。该轴就是物体自身的 z 轴。在空间坐标系中，该轴的方向为 $R_z(\\phi) R_y(\\theta) \\mathbf{k}$。角速度为 $\\dot{\\psi} (R_z(\\phi) R_y(\\theta) \\mathbf{k})$。\n\n在空间坐标系中，总角速度是这三者之和：\n$$ \\boldsymbol{\\omega}_{\\text{space}} = \\dot{\\phi} \\mathbf{k} + \\dot{\\theta} (R_z(\\phi) \\mathbf{j}) + \\dot{\\psi} (R_z(\\phi) R_y(\\theta) \\mathbf{k}) $$\n为了得到体坐标系中的角速度 $\\omega$，我们需要将空间坐标系中的这些矢量通过旋转矩阵 $R^{-1}$ 转换到体坐标系。其中 $R = R_z(\\phi) R_y(\\theta) R_z(\\psi)$。\n$$ \\omega = R^{-1} \\boldsymbol{\\omega}_{\\text{space}} = R^{-1}(\\dot{\\phi} \\mathbf{k}) + R^{-1}(\\dot{\\theta} R_z(\\phi) \\mathbf{j}) + R^{-1}(\\dot{\\psi} R_z(\\phi) R_y(\\theta) \\mathbf{k}) $$\n让我们逐项计算（令 $e_1, e_2, e_3$ 为体坐标系基向量）：\n-   第三项：$R^{-1}(R_z(\\phi) R_y(\\theta) \\mathbf{k}) = (R_z(\\psi))^{-1} (R_y(\\theta))^{-1} (R_z(\\phi))^{-1} (R_z(\\phi) R_y(\\theta) \\mathbf{k}) = (R_z(\\psi))^{-1} \\mathbf{k} = \\mathbf{k}$，因为 $R_z(\\psi)$ 绕z轴旋转。该项贡献为 $\\dot{\\psi} e_3$。\n-   第二项：$R^{-1} (R_z(\\phi) \\mathbf{j}) = (R_z(\\psi))^{-1} (R_y(\\theta))^{-1} (R_z(\\phi))^{-1} (R_z(\\phi) \\mathbf{j}) = (R_z(\\psi))^{-1} (R_y(\\theta))^{-1} \\mathbf{j}$。由于 $R_y(\\theta)$ 绕y轴旋转，$(R_y(\\theta))^{-1} \\mathbf{j} = \\mathbf{j}$。所以该项变为 $(R_z(\\psi))^{-1} \\mathbf{j} = R_z(-\\psi) e_2 = (\\sin\\psi, \\cos\\psi, 0)^\\top$。该项贡献为 $\\dot{\\theta} (\\sin\\psi, \\cos\\psi, 0)^\\top$。\n-   第一项：$R^{-1} \\mathbf{k} = (R_z(\\psi))^{-1} (R_y(\\theta))^{-1} (R_z(\\phi))^{-1} \\mathbf{k}$。由于 $(R_z(\\phi))^{-1} \\mathbf{k} = \\mathbf{k}$，该项变为 $(R_z(\\psi))^{-1} (R_y(\\theta))^{-1} \\mathbf{k}$。$(R_y(\\theta))^{-1} \\mathbf{k} = R_y(-\\theta) e_3 = (-\\sin\\theta, 0, \\cos\\theta)^\\top$。然后，$R_z(-\\psi) (-\\sin\\theta, 0, \\cos\\theta)^\\top = (-\\sin\\theta\\cos\\psi, \\sin\\theta\\sin\\psi, \\cos\\theta)^\\top$。该项贡献为 $\\dot{\\phi} (-\\sin\\theta\\cos\\psi, \\sin\\theta\\sin\\psi, \\cos\\theta)^\\top$。\n\n将三项贡献相加，得到体角速度 $\\omega$：\n$$ \\omega = \\dot{\\phi} \\begin{pmatrix} -\\sin\\theta\\cos\\psi \\\\ \\sin\\theta\\sin\\psi \\\\ \\cos\\theta \\end{pmatrix} + \\dot{\\theta} \\begin{pmatrix} \\sin\\psi \\\\ \\cos\\psi \\\\ 0 \\end{pmatrix} + \\dot{\\psi} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\n将上式写成矩阵形式 $\\omega = J (\\dot{\\phi}, \\dot{\\theta}, \\dot{\\psi})^{\\top}$，雅可比矩阵 $J$ 为：\n$$\nJ(\\phi, \\theta, \\psi) = \\begin{pmatrix}\n-\\sin\\theta\\cos\\psi & \\sin\\psi & 0 \\\\\n\\sin\\theta\\sin\\psi & \\cos\\psi & 0 \\\\\n\\cos\\theta & 0 & 1\n\\end{pmatrix}\n$$\n注意到该雅可比矩阵与第一个角 $\\phi$ 无关。\n\n接下来，我们计算 $J$ 的行列式。沿第三列进行余子式展开：\n$$\n\\det J = (1) \\cdot \\det \\begin{pmatrix} -\\sin\\theta\\cos\\psi & \\sin\\psi \\\\ \\sin\\theta\\sin\\psi & \\cos\\psi \\end{pmatrix}\n$$\n$$\n\\det J = (-\\sin\\theta\\cos\\psi)(\\cos\\psi) - (\\sin\\psi)(\\sin\\theta\\sin\\psi)\n$$\n$$\n\\det J = -\\sin\\theta\\cos^2\\psi - \\sin\\theta\\sin^2\\psi\n$$\n$$\n\\det J = -\\sin\\theta(\\cos^2\\psi + \\sin^2\\psi) = -\\sin\\theta\n$$\n雅可比矩阵降秩的奇点发生在 $\\det J = 0$，即 $-\\sin\\theta = 0$。这对应于 $\\theta = k\\pi$，其中 $k$ 是任意整数。在这些点上会发生万向节死锁。",
            "answer": "$$\\boxed{-\\sin(\\theta)}$$"
        },
        {
            "introduction": "理论学习的最终目的是应用于实践，例如模拟刚体随时间的运动。然而，一个朴素的数值积分方法可能导致非物理性的结果，使得计算出的姿态矩阵不再代表一个有效的旋转。此练习  将一个简单的欧拉积分器与两种保结构技术——投影法和基于矩阵指数的精确李群积分器——进行对比。通过实现和比较这些方法，您将亲眼见证几何数值积分的重要性，并学会如何确保数值模拟能尊重构型空间 $SO(3)$ 的基本几何性质，从而防止漂移并保证物理真实性。",
            "id": "3782405",
            "problem": "考虑由特殊正交群 $SO(3)$ 定义的刚体位形空间，即所有满足 $R^\\top R = I$ 和 $\\det(R) = 1$ 的实 $3 \\times 3$ 矩阵 $R$ 的集合。刚体运动学由一阶常微分方程 $\\dot{R} = R \\widehat{\\omega}$ 控制，其中 $\\omega \\in \\mathbb{R}^3$ 是体角速度，$\\widehat{\\omega} \\in \\mathfrak{so}(3)$ 是其对应的斜对称矩阵表示，定义为对任意 $v \\in \\mathbb{R}^3$ 都有 $\\widehat{\\omega} v = \\omega \\times v$。全文中的角度单位必须是弧度。\n\n从这些基本定义出发，您必须：\n\n1. 推导并实现一种到 $SO(3)$ 上的正交投影方法，该方法给定一个由单步显式欧拉法 $\\widetilde{R} = R + h R \\widehat{\\omega}$ 产生的数值更新后矩阵 $\\widetilde{R}$，返回一个矩阵 $R_{\\text{proj}} \\in SO(3)$。该投影必须通过求解在约束集 $SO(3)$ 上最小化与 $\\widetilde{R}$ 的弗罗贝尼乌斯范数距离的最小二乘问题来获得。您必须用极分解或数学上等价的构造来表达您的推导过程，但不得在没有论证的情况下假设或引用任何现成的公式。\n\n2. 实现一个基于 $SO(3)$ 上指数映射的李群更新 $R_{\\text{lie}}$，使用从初始 $R$ 开始的 $\\dot{R} = R \\widehat{\\omega}$ 的时间-$h$ 流。对于具有恒定 $\\omega$ 的运动学方程，此更新必须是精确的，即 $R_{\\text{lie}} = R \\exp(h \\widehat{\\omega})$。\n\n3. 对三个矩阵 $R_{\\text{naive}} = \\widetilde{R}$、$R_{\\text{proj}}$ 和 $R_{\\text{lie}}$，定量比较以下结构保持性和漂移度量：\n   - 正交性误差，通过弗罗贝尼乌斯范数 $e_{\\text{orth}}(R) = \\lVert R^\\top R - I \\rVert_F$ 衡量。\n   - 特殊性误差，通过 $e_{\\det}(R) = \\lvert \\det(R) - 1 \\rvert$ 衡量。\n   - 成员布尔值 $b_{\\text{SO3}}(R)$，当且仅当对于给定的容差 $\\varepsilon$，满足 $e_{\\text{orth}}(R) \\le \\varepsilon$、$e_{\\det}(R) \\le \\varepsilon$ 且 $\\det(R) > 0$ 时为真。\n   - 相对于李群方法的漂移，通过弗罗贝尼乌斯距离 $d_F(R, R_{\\text{lie}}) = \\lVert R - R_{\\text{lie}} \\rVert_F$ 衡量。\n   - 相对于李群方法的漂移，通过测地角 $d_\\theta(R, R_{\\text{lie}})$ 衡量，其中 $d_\\theta$ 是 $R^\\top R_{\\text{lie}} \\in SO(3)$ 的旋转角，使用恒等式 $\\theta = \\arccos\\!\\left(\\frac{\\operatorname{tr}(R^\\top R_{\\text{lie}}) - 1}{2}\\right)$ 从其迹计算得出，$\\arccos$ 的参数被限制在区间 $[-1, 1]$ 内以确保数值稳定性。\n\n使用以下初始条件、角速度和时间步长的测试套件。在所有情况下，初始旋转矩阵 $R_0$ 必须使用标准的轴-角到$SO(3)$映射，由轴-角对 $(u, \\alpha)$ 构建；所有角度均以弧度为单位，时间步长 $h$ 以秒为单位：\n\n- 测试用例1：$R_0 = I$, $\\omega = [0.3, -0.2, 0.5]$, $h = 0.05$。\n- 测试用例2：$R_0$ 是绕 $x$ 轴旋转角度 $\\alpha = 1.0$ 的旋转，即轴 $u = [1, 0, 0]$, $\\omega = [0.7, 1.2, -0.4]$, $h = 0.2$。\n- 测试用例3：$R_0 = I$, $\\omega = [0.0, 0.0, 0.0]$, $h = 1.0$。\n- 测试用例4：$R_0$ 是绕轴 $u = \\frac{1}{\\sqrt{3}}[1, 1, 1]$ 旋转角度 $\\alpha = \\pi - 0.001$ 的旋转, $\\omega = [10.0, -8.0, 6.0]$, $h = 0.001$。\n\n对于每个测试用例，执行一个显式欧拉运动学步骤以获得 $\\widetilde{R}$，然后通过您推导的投影方法计算 $R_{\\text{proj}}$，并通过指数映射李群更新计算 $R_{\\text{lie}}$。使用容差 $\\varepsilon = 10^{-12}$，为每个测试用例生成列表\n$[e_{\\text{orth}}(R_{\\text{naive}}), e_{\\det}(R_{\\text{naive}}), b_{\\text{SO3}}(R_{\\text{naive}}), e_{\\text{orth}}(R_{\\text{proj}}), e_{\\det}(R_{\\text{proj}}), b_{\\text{SO3}}(R_{\\text{proj}}), e_{\\text{orth}}(R_{\\text{lie}}), e_{\\det}(R_{\\text{lie}}), b_{\\text{SO3}}(R_{\\text{lie}}), d_F(R_{\\text{naive}}, R_{\\text{lie}}), d_\\theta(R_{\\text{naive}}, R_{\\text{lie}}), d_F(R_{\\text{proj}}, R_{\\text{lie}}), d_\\theta(R_{\\text{proj}}, R_{\\text{lie}})]$，其中所有浮点数条目必须四舍五入到12位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身就是上面描述的列表（例如，$[[\\dots],[\\dots],[\\dots],[\\dots]]$）。不允许外部输入，所有计算都必须使用上述规范执行。",
            "solution": "该问题要求对特殊正交群 $SO(3)$ 上的刚体运动学的三种数值更新方案进行比较分析。该运动学由常微分方程 $\\dot{R} = R \\widehat{\\omega}$ 描述，其中 $R(t) \\in SO(3)$ 是姿态矩阵，$\\omega \\in \\mathbb{R}^3$ 是恒定的体固角速度。我们将分析从初始姿态 $R_0$ 开始的单个大小为 $h$ 的时间步。要比较的方法是朴素的显式欧拉步、欧拉步在 $SO(3)$ 上的投影，以及基于指数映射的精确李群积分器。\n\n首先，我们建立数学框架。位形空间是李群 $SO(3) = \\{ R \\in \\mathbb{R}^{3 \\times 3} \\mid R^\\top R = I, \\det(R) = 1 \\}$。相应的李代数是 $\\mathfrak{so}(3)$，即 $3 \\times 3$ 斜对称矩阵的空间。帽子映射 $\\widehat{\\cdot}: \\mathbb{R}^3 \\to \\mathfrak{so}(3)$ 提供了 $\\mathbb{R}^3$ 中向量与斜对称矩阵之间的同构，使得对于 $\\omega = [\\omega_x, \\omega_y, \\omega_z]^\\top$，我们有：\n$$ \\widehat{\\omega} = \\begin{pmatrix} 0 & -\\omega_z & \\omega_y \\\\ \\omega_z & 0 & -\\omega_x \\\\ -\\omega_y & \\omega_x & 0 \\end{pmatrix} $$\n\n比较的基础将是一个朴素的欧拉更新 $R_{\\text{naive}}$ 和两个保结构更新 $R_{\\text{proj}}$ 与 $R_{\\text{lie}}$。\n\n**1. 正交投影法 ($R_{\\text{proj}}$)**\n\n显式欧拉法将姿态更新为 $R_{k+1} = R_k + h \\dot{R}_k$。对于我们的系统，这会产生一个更新后的矩阵 $\\widetilde{R} = R_0 + h R_0 \\widehat{\\omega}$。这个我们记为 $R_{\\text{naive}}$ 的矩阵 $\\widetilde{R}$ 通常不属于 $SO(3)$，即它不会是完全正交的，其行列式也不会恰好为 $1$。\n\n任务是找到一个在弗罗贝尼乌斯范数下最接近 $\\widetilde{R}$ 的矩阵 $R_{\\text{proj}} \\in SO(3)$。这等价于求解约束优化问题：\n$$ R_{\\text{proj}} = \\arg\\min_{R \\in SO(3)} \\lVert \\widetilde{R} - R \\rVert_F $$\n弗罗贝尼乌斯范数的平方是 $\\lVert A \\rVert_F^2 = \\operatorname{tr}(A^\\top A)$。最小化范数等价于最小化其平方：\n$$ \\min_{R \\in SO(3)} \\operatorname{tr}\\left( (\\widetilde{R} - R)^\\top (\\widetilde{R} - R) \\right) $$\n展开迹，我们得到：\n$$ \\operatorname{tr}(\\widetilde{R}^\\top \\widetilde{R} - \\widetilde{R}^\\top R - R^\\top \\widetilde{R} + R^\\top R) = \\operatorname{tr}(\\widetilde{R}^\\top \\widetilde{R}) - 2\\operatorname{tr}(\\widetilde{R}^\\top R) + \\operatorname{tr}(R^\\top R) $$\n给定 $R \\in SO(3)$，我们知道 $R^\\top R = I$，所以 $\\operatorname{tr}(R^\\top R) = \\operatorname{tr}(I) = 3$。项 $\\operatorname{tr}(\\widetilde{R}^\\top \\widetilde{R})$ 相对于优化变量 $R$ 是一个常数。因此，最小化问题等价于最大化项 $\\operatorname{tr}(\\widetilde{R}^\\top R)$。\n\n为了解决这个最大化问题，我们使用 $\\widetilde{R}$ 的奇异值分解（SVD），即 $\\widetilde{R} = U S V^\\top$，其中 $U, V \\in O(3)$ 是正交矩阵，$S$ 是一个对角矩阵，其对角线上的奇异值为非负数。\n我们希望最大化 $\\operatorname{tr}(R^\\top U S V^\\top)$。利用迹的循环性质，这等于 $\\operatorname{tr}(V^\\top R^\\top U S)$。令 $Q = V^\\top R^\\top U$。由于 $V、R、U$ 都是正交矩阵，$Q$ 也是一个正交矩阵。目标变成最大化 $\\operatorname{tr}(Q S)$。\n$$ \\operatorname{tr}(Q S) = \\sum_{i=1}^3 (QS)_{ii} = \\sum_{i=1}^3 Q_{ii} \\sigma_i $$\n由于 $Q$ 是正交的，其对角元素满足 $|Q_{ii}| \\le 1$。因为奇异值 $\\sigma_i \\ge 0$，当 $Q_{ii}$ 尽可能大时，这个和达到最大值。\n\n约束 $R \\in SO(3)$ 意味着 $\\det(R)=1$。我们有 $\\det(Q) = \\det(V^\\top)\\det(R^\\top)\\det(U) = \\det(V)\\det(R)\\det(U)$。由于欧拉步 $\\widetilde{R} = R_0(I+h\\widehat{\\omega})$ 确保对于足够小的 $h$，$\\det(\\widetilde{R}) > 0$，因此可以推断出 $\\det(U)\\det(V) = 1$。所以 $\\det(Q)=\\det(R)=1$。在 $\\det(Q)=1$ 的条件下，能够最大化 $\\sum Q_{ii}\\sigma_i$ 的正交矩阵 $Q \\in SO(3)$ 是 $Q=I$。\n设置 $Q=I$ 得到 $V^\\top R^\\top U = I$，这意味着 $R^\\top = V U^\\top$，因此 $R = U V^\\top$。\n这个选择 $R_{\\text{proj}} = U V^\\top$ 属于 $SO(3)$，因为 $\\det(R_{\\text{proj}}) = \\det(U)\\det(V^\\top) = \\det(U)\\det(V)=1$。这提供了所需的投影方法。对于一般情况，若 $\\det(\\widetilde{R})$ 可能为负，最优选择是 $R=U\\operatorname{diag}(1,1,\\det(UV^\\top))V^\\top$。\n\n**2. 李群积分器 ($R_{\\text{lie}}$)**\n\n对于恒定的角速度 $\\omega$，运动学方程 $\\dot{R} = R \\widehat{\\omega}$ 有一个精确的解析解，该解由从李代数 $\\mathfrak{so}(3)$到李群 $SO(3)$ 的指数映射给出。在时间 $t$ 的解是 $R(t) = R(0) \\exp(t\\widehat{\\omega})$。\n因此，对于大小为 $h$ 的单个时间步，精确的更新为：\n$$ R_{\\textlie} = R_0 \\exp(h \\widehat{\\omega}) $$\n对于斜对称矩阵 $A = h\\widehat{\\omega}$，其矩阵指数 $\\exp(A)$ 可以使用罗德里格斯旋转公式高效计算。令 $\\theta = h \\lVert \\omega \\rVert$ 为总旋转角，$\\mathbf{u} = \\omega / \\lVert \\omega \\rVert$ 为单位旋转轴（对于 $\\omega \\neq 0$）。那么：\n$$ \\exp(h \\widehat{\\omega}) = I + (\\sin \\theta) \\widehat{\\mathbf{u}} + (1 - \\cos \\theta) \\widehat{\\mathbf{u}}^2 $$\n这个公式是精确的，并且根据其构造，它会产生一个 $SO(3)$ 中的矩阵。在计算上，使用鲁棒的矩阵指数库函数（如 `scipy.linalg.expm`）来处理 $\\lVert\\omega\\rVert$ 接近于零的情况，从而避免数值不稳定性。\n\n**3. 定量度量**\n\n这三个矩阵 $R_{\\text{naive}}$、$R_{\\text{proj}}$ 和 $R_{\\text{lie}}$ 使用几个度量标准进行评估：\n- $e_{\\text{orth}}(R) = \\lVert R^\\top R - I \\rVert_F$：这衡量了与正交性的偏差。对于 $R \\in SO(3)$，此误差为 $0$。\n- $e_{\\det}(R) = |\\det(R) - 1|$：这衡量了与行列式为 $1$ 的“特殊”属性的偏差。对于 $R \\in SO(3)$，此误差为 $0$。\n- $b_{\\text{SO3}}(R)$：这是一个布尔指标，如果矩阵在满足 $SO(3)$ 属性的小容差 $\\varepsilon$ 范围内，则为真。\n- $d_F(R, R_{\\text{lie}}) = \\lVert R - R_{\\text{lie}} \\rVert_F$：这衡量了在环境欧几里得空间 $\\mathbb{R}^{3 \\times 3}$ 中，给定更新方案与精确李群解的漂移。\n- $d_\\theta(R, R_{\\text{lie}}) = \\arccos\\left(\\frac{\\operatorname{tr}(R^\\top R_{\\text{lie}}) - 1}{2}\\right)$：这衡量了在流形 $SO(3)$ 上，近似解 $R$ 与精确解 $R_{\\text{lie}}$ 之间的测地距离。它表示将 $R$ 与 $R_{\\text{lie}}$对齐的相对旋转 $R^\\top R_{\\text{lie}}$ 的角度。\n\n通过将这些方法和度量应用于指定的测试用例，我们可以定量评估每种积分方案的性能。朴素欧拉法预计会累积误差并偏离 $SO(3)$ 流形。投影法将在每一步强制执行流形约束，但可能无法精确地遵循真实轨迹。李群方法对此问题是精确的，可作为基准真相，并预期其正交性和特殊性误差在机器精度范围内为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the rigid body kinematics problem by comparing three update methods:\n    naive Euler, projection onto SO(3), and a Lie group integrator.\n    \"\"\"\n\n    def hat(v):\n        \"\"\"Maps a 3D vector to its corresponding skew-symmetric matrix.\"\"\"\n        return np.array([\n            [0, -v[2], v[1]],\n            [v[2], 0, -v[0]],\n            [-v[1], v[0], 0]\n        ])\n\n    def axis_angle_to_R(u, alpha):\n        \"\"\"Constructs a rotation matrix from an axis-angle representation.\"\"\"\n        if np.linalg.norm(u) == 0:\n            return np.identity(3)\n        u_norm = u / np.linalg.norm(u)\n        u_hat = hat(u_norm)\n        return np.identity(3) + np.sin(alpha) * u_hat + (1 - np.cos(alpha)) * (u_hat @ u_hat)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'R0': np.identity(3), 'omega': np.array([0.3, -0.2, 0.5]), 'h': 0.05},\n        {'R0': axis_angle_to_R(np.array([1., 0., 0.]), 1.0), 'omega': np.array([0.7, 1.2, -0.4]), 'h': 0.2},\n        {'R0': np.identity(3), 'omega': np.array([0.0, 0.0, 0.0]), 'h': 1.0},\n        {'R0': axis_angle_to_R(np.array([1., 1., 1.]), np.pi - 0.001), 'omega': np.array([10.0, -8.0, 6.0]), 'h': 0.001},\n    ]\n\n    all_results = []\n    TOL = 1e-12\n\n    for case in test_cases:\n        R0 = case['R0']\n        omega = case['omega']\n        h = case['h']\n        \n        omega_hat = hat(omega)\n\n        # 1. Naive explicit Euler update\n        R_naive = R0 + h * (R0 @ omega_hat)\n\n        # 2. Lie group update (exact solution for constant omega)\n        R_lie = R0 @ expm(h * omega_hat)\n        \n        # 3. Orthogonal projection of R_naive onto SO(3)\n        U, _, Vt = np.linalg.svd(R_naive)\n        # For this problem, det(R_naive) is expected to be positive, so det(U @ Vt) = 1.\n        # The general projection handles det(UVt) = -1.\n        D = np.identity(3)\n        D[2, 2] = np.linalg.det(U @ Vt)\n        R_proj = U @ D @ Vt\n\n        matrices = {'naive': R_naive, 'proj': R_proj, 'lie': R_lie}\n        results = []\n\n        # Calculate metrics for each matrix\n        metrics_per_matrix = {}\n        for name, R in matrices.items():\n            e_orth = np.linalg.norm(R.T @ R - np.identity(3), 'fro')\n            det_R = np.linalg.det(R)\n            e_det = np.abs(det_R - 1)\n            b_so3 = (e_orth = TOL) and (e_det = TOL) and (det_R > 0)\n            metrics_per_matrix[name] = [round(e_orth, 12), round(e_det, 12), b_so3]\n\n        # Append metrics in the specified order\n        results.extend(metrics_per_matrix['naive'])\n        results.extend(metrics_per_matrix['proj'])\n        results.extend(metrics_per_matrix['lie'])\n\n        # Calculate drift metrics relative to R_lie\n        for R_test in [R_naive, R_proj]:\n            # Frobenius distance\n            d_F = np.linalg.norm(R_test - R_lie, 'fro')\n            \n            # Geodesic angle\n            R_rel = R_test.T @ R_lie\n            trace_R_rel = np.trace(R_rel)\n            # Clamp argument to arccos to handle potential floating point inaccuracies\n            arg = np.clip((trace_R_rel - 1.0) / 2.0, -1.0, 1.0)\n            d_theta = np.arccos(arg)\n            \n            results.append(round(d_F, 12))\n            results.append(round(d_theta, 12))\n        \n        all_results.append(results)\n\n    # Final print statement in the exact required format.\n    # Convert list of lists to string representation.\n    output_str = str(all_results).replace(\" \", \"\").replace(\"True\", \"true\").replace(\"False\", \"false\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}