{
    "hands_on_practices": [
        {
            "introduction": "欧拉方程允许对应于绕主惯性轴旋转的稳态解，这是一项基本的动手技能，可以确定这些解的稳定性。本练习将引导你对动力学进行线性化，以揭示为何绕最大和最小惯性轴的旋转是稳定的，而绕中间轴的旋转是不稳定的，从而将抽象的方程与刚体的实际翻滚运动联系起来。",
            "id": "3748189",
            "problem": "考虑一个自由刚体（欧拉陀螺），其主转动惯量为 $I_1$、$I_2$ 和 $I_3$，惯量张量为 $I = \\operatorname{diag}(I_1, I_2, I_3)$。在几何力学中，刚体角动量 $M \\in \\mathbb{R}^3 \\simeq \\mathfrak{so}(3)^{\\ast}$ 在特殊正交群的李代数 $\\mathfrak{so}(3)$ 的对偶空间上演化，其服从李-泊松括号 $\\{F,G\\}(M) = - M \\cdot \\left(\\nabla F(M) \\times \\nabla G(M)\\right)$，哈密顿量为 $H(M) = \\tfrac{1}{2} M \\cdot I^{-1} M$。刚体角速度 $\\omega$ 由 $M = I \\omega$ 定义，因此 $\\omega = I^{-1} M$。\n\n从这些几何和哈密顿结构出发（除已给出的公式外，不假定任何简化公式），推导其运动方程，将绕主轴的稳态转动识别为平衡点，并在线性化一个绕主轴 $e_k$（其中 $k \\in \\{1,2,3\\}$）以恒定角速度 $\\Omega \\neq 0$ 进行稳态转动的动力学。设 $j$ 和 $l$ 表示 $\\{1,2,3\\} \\setminus \\{k\\}$ 中的另外两个指标。\n\n计算限制在由 $e_j$ 和 $e_l$ 张成的二维子空间上的线性化系统的非零特征值对，并将你的最终结果表示为关于 $I_1$、$I_2$、$I_3$ 和 $\\Omega$ 的特征值平方 $\\lambda^2$ 的单一解析表达式，该表达式对任意选择的转动轴 $k$ 均有效。你的最终答案必须是 $\\lambda^2$ 的单一表达式（无需单位）。",
            "solution": "该问题要求推导自由刚体（欧拉陀螺）在绕主轴的稳态转动附近的线性化动力学的特征值平方。推导过程必须从所给的几何哈密顿表述开始。\n\n首先，我们验证问题陈述的有效性。\n问题给出了以下已知条件：\n- 一个自由刚体，其主转动惯量为 $I_1$、$I_2$、$I_3$。\n- 在刚体坐标系中的惯量张量为 $I = \\operatorname{diag}(I_1, I_2, I_3)$。\n- 状态是刚体角动量 $M \\in \\mathbb{R}^3 \\simeq \\mathfrak{so}(3)^{\\ast}$。\n- 动力学由李-泊松括号 $\\{F,G\\}(M) = - M \\cdot \\left(\\nabla F(M) \\times \\nabla G(M)\\right)$ 控制。\n- 哈密顿量为 $H(M) = \\frac{1}{2} M \\cdot I^{-1} M$。\n- 刚体角速度为 $\\omega = I^{-1} M$。\n问题是要求推导运动方程，将稳态转动识别为平衡点，并在一个绕主轴 $e_k$ 以速度 $\\Omega \\neq 0$ 进行的稳态转动附近对动力学进行线性化，以求出横向动力学的特征值平方 $\\lambda^2$。\n\n该问题具有科学依据、是适定的且客观的。它是几何力学和刚体动力学中的一个标准问题。未发现任何缺陷。我们可以开始求解。\n\n步骤1：推导运动方程。\n任何可观测量 $F(M)$ 的时间演化由 $\\frac{dF}{dt} = \\{F, H\\}$ 给出。我们通过令 $F = M_i$（对于 $i=1, 2, 3$）来求角动量矢量 $M = (M_1, M_2, M_3)$ 各分量的方程。\n\n哈密顿量为 $H(M) = \\frac{1}{2} \\sum_{i=1}^3 \\frac{M_i^2}{I_i}$。\n哈密顿量关于 $M$ 的梯度是：\n$$ \\nabla H(M) = \\left( \\frac{\\partial H}{\\partial M_1}, \\frac{\\partial H}{\\partial M_2}, \\frac{\\partial H}{\\partial M_3} \\right) = \\left( \\frac{M_1}{I_1}, \\frac{M_2}{I_2}, \\frac{M_3}{I_3} \\right) = I^{-1} M = \\omega $$\n分量函数 $F = M_i$ 的梯度是标准基向量 $\\nabla M_i = e_i$。\n\n$M_i$ 的运动方程是：\n$$ \\frac{dM_i}{dt} = \\{M_i, H\\}(M) = - M \\cdot \\left(\\nabla M_i \\times \\nabla H(M)\\right) = - M \\cdot (e_i \\times \\omega) $$\n使用向量三重积恒等式 $A \\cdot (B \\times C) = C \\cdot (A \\times B)$，我们有：\n$$ \\frac{dM_i}{dt} = - \\omega \\cdot (M \\times e_i) = (M \\times \\omega)_i $$\n写成矢量形式，这就是著名的角动量欧拉方程：\n$$ \\frac{dM}{dt} = M \\times \\omega = M \\times (I^{-1}M) $$\n按分量写出：\n$$ \\dot{M}_1 = M_2 \\omega_3 - M_3 \\omega_2 = M_2 \\frac{M_3}{I_3} - M_3 \\frac{M_2}{I_2} = M_2 M_3 \\left(\\frac{1}{I_3} - \\frac{1}{I_2}\\right) $$\n$$ \\dot{M}_2 = M_3 \\omega_1 - M_1 \\omega_3 = M_3 \\frac{M_1}{I_1} - M_1 \\frac{M_3}{I_3} = M_1 M_3 \\left(\\frac{1}{I_1} - \\frac{1}{I_3}\\right) $$\n$$ \\dot{M}_3 = M_1 \\omega_2 - M_2 \\omega_1 = M_1 \\frac{M_2}{I_2} - M_2 \\frac{M_1}{I_1} = M_1 M_2 \\left(\\frac{1}{I_2} - \\frac{1}{I_1}\\right) $$\n\n步骤2：确定平衡点。\n平衡点或稳态转动是满足 $\\frac{dM}{dt} = 0$ 的点 $M_e$。假设主转动惯量互不相等（即 $I_1 \\neq I_2 \\neq I_3$），则上述方程成立的充要条件是 $M$ 的至少两个分量为零。这对应于纯粹绕某个主轴的转动。\n我们考虑一个绕第 $k$ 个主轴 $e_k$ 以恒定角速度 $\\Omega \\neq 0$ 的稳态转动。角速度为 $\\omega_e = \\Omega e_k$。相应的平衡角动量为 $M_e = I \\omega_e = I (\\Omega e_k) = I_k \\Omega e_k$。\n因此，平衡点是 $M_{e,i} = \\delta_{ik} I_k \\Omega$，其中 $\\delta_{ik}$ 是克罗内克δ。\n\n步骤3：线性化动力学。\n我们在平衡点 $M_e$ 附近对运动方程进行线性化。设 $M(t) = M_e + \\delta M(t)$，其中 $\\delta M$ 是一个小扰动。\n方程的通用形式为 $\\dot{M}_i = \\sum_{p,q} \\varepsilon_{ipq} \\frac{M_p M_q}{I_q}$，其中 $\\varepsilon_{ipq}$ 是列维-奇维塔符号。\n\n我们来分析扰动分量 $\\delta M_k$、$\\delta M_j$ 和 $\\delta M_l$ 的动力学，其中 $k, j, l$ 是来自 $\\{1, 2, 3\\}$ 的不同指标。\n对于沿转动轴的分量 $\\delta M_k$：\n$$ \\dot{M}_k = \\sum_{p,q} \\varepsilon_{kpq} \\frac{M_p M_q}{I_q} = \\varepsilon_{kjl} \\left(\\frac{1}{I_l} - \\frac{1}{I_j}\\right) M_j M_l $$\n代入 $M_j = \\delta M_j$ 和 $M_l = \\delta M_l$：\n$$ \\dot{\\delta M}_k = \\varepsilon_{kjl} \\left(\\frac{1}{I_l} - \\frac{1}{I_j}\\right) \\delta M_j \\delta M_l $$\n由于这是扰动的二阶项，在线性化系统中 $\\dot{\\delta M}_k=0$。这表明，在一阶近似下，动力学被限制在垂直于转动轴的平面内，即由 $e_j$ 和 $e_l$ 张成的子空间。\n\n现在，我们来求 $\\delta M_j$ 和 $\\delta M_l$ 的线性化方程。\n对于 $\\delta M_j$：\n$$ \\dot{M}_j = \\varepsilon_{jkl} \\left(\\frac{1}{I_l} - \\frac{1}{I_k}\\right) M_k M_l $$\n代入 $M_k = M_{e,k} + \\delta M_k = I_k \\Omega + \\delta M_k$ 和 $M_l = \\delta M_l$。\n$$ \\dot{\\delta M}_j = \\varepsilon_{jkl} \\left(\\frac{1}{I_l} - \\frac{1}{I_k}\\right) (I_k \\Omega + \\delta M_k) \\delta M_l $$\n只保留一阶项：\n$$ \\dot{\\delta M}_j \\approx \\varepsilon_{jkl} \\Omega \\left(\\frac{I_k}{I_l} - 1\\right) \\delta M_l $$\n类似地，对于 $\\delta M_l$：\n$$ \\dot{M}_l = \\varepsilon_{lkj} \\left(\\frac{1}{I_j} - \\frac{1}{I_k}\\right) M_k M_j $$\n代入 $M_k = I_k \\Omega + \\delta M_k$ 和 $M_j = \\delta M_j$。\n$$ \\dot{\\delta M}_l \\approx \\varepsilon_{lkj} \\Omega \\left(\\frac{I_k}{I_j} - 1\\right) \\delta M_j $$\n\n横向动力学的线性化系统为：\n$$ \\frac{d}{dt} \\begin{pmatrix} \\delta M_j \\\\ \\delta M_l \\end{pmatrix} = \\begin{pmatrix} 0 & \\varepsilon_{jkl} \\Omega \\left(\\frac{I_k}{I_l} - 1\\right) \\\\ \\varepsilon_{lkj} \\Omega \\left(\\frac{I_k}{I_j} - 1\\right) & 0 \\end{pmatrix} \\begin{pmatrix} \\delta M_j \\\\ \\delta M_l \\end{pmatrix} $$\n\n步骤4：计算特征值。\n设线性化矩阵为 $A$。特征值 $\\lambda$ 可由特征方程 $\\det(A - \\lambda I_{2\\times2}) = 0$ 求得。\n$$ \\det \\begin{pmatrix} -\\lambda & \\varepsilon_{jkl} \\Omega \\left(\\frac{I_k}{I_l} - 1\\right) \\\\ \\varepsilon_{lkj} \\Omega \\left(\\frac{I_k}{I_j} - 1\\right) & -\\lambda \\end{pmatrix} = 0 $$\n$$ \\lambda^2 - \\left[ \\varepsilon_{jkl} \\Omega \\left(\\frac{I_k}{I_l} - 1\\right) \\right] \\left[ \\varepsilon_{lkj} \\Omega \\left(\\frac{I_k}{I_j} - 1\\right) \\right] = 0 $$\n利用性质 $\\varepsilon_{lkj} = -\\varepsilon_{jkl}$：\n$$ \\lambda^2 + (\\varepsilon_{jkl})^2 \\Omega^2 \\left(\\frac{I_k}{I_l} - 1\\right) \\left(\\frac{I_k}{I_j} - 1\\right) = 0 $$\n因为 $k, j, l$ 互不相同，所以 $(\\varepsilon_{jkl})^2=1$。\n$$ \\lambda^2 = - \\Omega^2 \\left(\\frac{I_k - I_l}{I_l}\\right) \\left(\\frac{I_k - I_j}{I_j}\\right) $$\n该表达式可以重写为：\n$$ \\lambda^2 = - \\Omega^2 \\frac{(I_k - I_j)(I_k - I_l)}{I_j I_l} $$\n这个最终表达式关于指标 $j$ 和 $l$ 的交换是对称的，正如所要求的，因为它们的顺序未被指定。它给出了垂直于转动轴 $e_k$ 的平面内的动力学的特征值平方。\n这个结果正确地恢复了欧拉陀螺的稳定性性质：如果 $I_k$ 是最大或最小的转动惯量，则 $(I_k - I_j)(I_k - I_l)$ 项为正，使得 $\\lambda^2 < 0$，这意味着虚数特征值和稳定振荡。如果 $I_k$ 是中间的转动惯量，则该项为负，使得 $\\lambda^2 > 0$，这意味着实数特征值和不稳定的鞍点平衡。",
            "answer": "$$\n\\boxed{- \\Omega^2 \\frac{(I_k - I_j)(I_k - I_l)}{I_j I_l}}\n$$"
        },
        {
            "introduction": "在稳定性分析的基础上，本练习将探索解的更深层次解析结构。虽然一般解涉及复杂的椭圆函数，但在特殊的退化情况下，它们会简化为初等函数。本练习将研究其中两种情况：对称陀螺和在分离线上运动的陀螺，从而将惯性张量的几何特性和系统的能量与解的数学形式联系起来，进一步阐明可积性的概念。",
            "id": "3748186",
            "problem": "考虑一个自由刚体（欧拉陀螺），其主转动惯量为 $I_1 < I_2 < I_3$，体坐标系角动量分量为 $M_1, M_2, M_3$。其运动由欧拉方程描述，并拥有两个独立的运动积分：能量 $E = \\frac{1}{2}\\left(\\frac{M_1^2}{I_1}+\\frac{M_2^2}{I_2}+\\frac{M_3^2}{I_3}\\right)$ 和角动量平方 $L^2 = M_1^2+M_2^2+M_3^2$。一般情况下，解涉及雅可比椭圆函数。然而，在某些退化情况下，解会简化为初等函数。\n\n请考虑以下关于这些退化情况的陈述，并选择所有正确的陈述。\n\nA. 在对称陀螺（例如，$I_1 = I_2$）的情况下，角动量分量 $M_3$ 是一个运动常数，导致解可以用三角函数表示。\n\nB. 在对称陀螺（例如，$I_1 = I_2$）的情况下，角动量分量 $M_1$ 是一个运动常数。\n\nC. 当运动恰好发生在分隔能级 $E=L^2/(2I_2)$ 的分界线上时，运动周期变为无限长，解由双曲函数（如 $\\tanh$ 和 $\\operatorname{sech}$）描述。\n\nD. 对于对称陀螺（例如，$I_1 = I_2$），角动量矢量在 $(M_1, M_2)$ 平面上的投影描绘出一个圆形轨迹。\n\nE. 当运动发生在分界线上时，其解仍然是周期性的，并由标准的三角函数描述。",
            "solution": "该问题要求分析欧拉陀螺在两种退化情况下的解的性质：几何退化（对称陀螺）和动力学退化（分界线运动）。\n\n**情况 1: 几何退化（对称陀螺）**\n\n我们考虑 $I_1 = I_2$ 的情况。欧拉方程为：\n1.  $\\dot{M}_1 = \\left(\\frac{1}{I_3} - \\frac{1}{I_1}\\right) M_2 M_3$\n2.  $\\dot{M}_2 = \\left(\\frac{1}{I_1} - \\frac{1}{I_3}\\right) M_3 M_1$\n3.  $\\dot{M}_3 = \\left(\\frac{1}{I_1} - \\frac{1}{I_2}\\right) M_1 M_2$\n\n*   **分析选项 A 和 B:**\n    从方程3中，由于 $I_1 = I_2$，我们得到 $\\dot{M}_3 = 0$。这意味着 $M_3$ 是一个运动常数。因此，**陈述 B 是错误的**，而**陈述 A 的第一部分是正确的**。\n    现在，让我们定义一个常数 $\\omega_p = M_3 \\left(\\frac{1}{I_1} - \\frac{1}{I_3}\\right)$。方程1和2可以重写为：\n    $\\dot{M}_1 = -\\omega_p M_2$\n    $\\dot{M}_2 = \\omega_p M_1$\n    这是一个标准的简谐振动系统。其解是三角函数形式，例如 $M_1(t) = A \\cos(\\omega_p t + \\phi)$ 和 $M_2(t) = A \\sin(\\omega_p t + \\phi)$。因此，**陈述 A 的第二部分也是正确的**。\n\n*   **分析选项 D:**\n    从上面的简谐振动解，我们可以计算 $M_1^2 + M_2^2$：\n    $M_1(t)^2 + M_2(t)^2 = A^2 \\cos^2(\\omega_p t + \\phi) + A^2 \\sin^2(\\omega_p t + \\phi) = A^2$\n    这个结果是恒定的。这意味着角动量矢量在 $(M_1, M_2)$ 平面上的投影的模长是固定的。因此，该投影描绘出一个圆形轨迹。**陈述 D 是正确的**。\n\n**情况 2: 动力学退化（分界线运动）**\n\n分界线是相空间中分隔不同类型运动（围绕 $e_1$ 轴的循环和围绕 $e_3$ 轴的循环）的特殊轨迹。它对应于一个特定的能量值 $E = L^2 / (2I_2)$，对于给定的角动量模长 $L$。这条轨迹穿过了与中间转动惯量轴 $I_2$ 相关的鞍点（不稳定平衡点）。\n\n*   **分析选项 C 和 E:**\n    从物理上讲，起始于分界线上的轨迹会渐近地接近不稳定的鞍点平衡。它需要无限长的时间才能到达该点。因此，运动的周期是无限的。这种渐近行为的数学描述不是周期性的三角函数，而是双曲函数，如双曲正切 ($\\tanh$) 和双曲正割 ($\\operatorname{sech}$)。\n    因此，**陈述 C 是正确的**，而**陈述 E 是错误的**。\n\n**结论**\n\n基于以上分析，正确的陈述是 A、C 和 D。",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "理论分析通常需要数值模拟来补充，本练习旨在解决数值求解欧拉方程的挑战，特别是在前面练习中确定的不稳定分离线附近。通过比较标准方法（RK4）和几何积分方法（隐式中点法），你将亲眼见证算法选择如何影响系统基本不变量（能量和角动量）的保持，这是计算几何力学中的一个基石概念。",
            "id": "3748272",
            "problem": "考虑一个无力矩刚体（Euler 陀螺），其在特殊正交群的对偶空间 $\\mathfrak{so}(3)^{\\ast}$ 上演化，具有体角动量 $M \\in \\mathbb{R}^{3}$ 和对角惯性张量 $I = \\operatorname{diag}(I_{1}, I_{2}, I_{3})$，其中 $0 < I_{1} < I_{2} < I_{3}$。其哈密顿量为 $H(M) = \\tfrac{1}{2} M \\cdot \\Omega$，其中 $\\Omega = I^{-1} M$。在体坐标系中的运动方程为 Euler 方程 $\\dot{M} = M \\times \\Omega = M \\times (I^{-1} M)$。这是一个 Lie-Poisson 系统，其 Casimir 不变量为 $C(M) = \\tfrac{1}{2} \\lVert M \\rVert^{2}$，该系统因能量 $H$ 和 Casimir 不变量 $C$ 而经典可积。分界线划分了性质不同的运动，并穿过对应于绕中间主轴 $e_{2}$ 旋转的鞍点平衡。对于固定的 $C$，分界线的能级为 $H = C / I_{2}$。\n\n基于这些基本原理，您必须：\n- 推导数值积分 Euler 方程的算法步骤，使用：\n  1) 经典四阶 Runge–Kutta 方法 (RK4)，以及\n  2) 隐式中点法，该方法通过每一步的 Newton 迭代，在 $\\mathfrak{so}(3)^{\\ast}$ 上被视为一个 Poisson 积分子。\n- 通过测量不变量漂移来量化分界线附近的数值敏感性。具体而言，对于给定的初始条件 $M(0)$、时间步长 $h$ 和最终时间 $T$，计算：\n  - 两种积分子的最大相对能量漂移 $\\max_{0 \\le t \\le T} \\left| H(M(t)) - H(M(0)) \\right| / \\left| H(M(0)) \\right|$，\n  - 以及最大相对 Casimir 不变量漂移 $\\max_{0 \\le t \\le T} \\left| C(M(t)) - C(M(0)) \\right| / \\left| C(M(0)) \\right|$。\n- 分析与分界线（绕 $e_{2}$ 旋转）的接近程度如何影响数值误差的增长，以及可积性如何限制漂移，从而为步长控制提供信息。\n\n使用以下科学上合理且自洽的参数化：\n- 惯性参数：$I_{1} = 1$，$I_{2} = 2$，$I_{3} = 3$（无量纲）。\n- 初始角动量大小：$\\lVert M(0) \\rVert = 1$，因此 $C(M(0)) = \\tfrac{1}{2}$。\n- 角度必须以弧度为单位指定和解释。\n- 定义两族初始条件：\n  - 在 $(e_{1}, e_{2})$ 平面内靠近分界线：$M(0) = (\\sin \\varepsilon, \\cos \\varepsilon, 0)$，其中 $\\varepsilon$ 很小。\n  - 远离分界线，靠近稳定轴 $e_{3}$：$M(0) = (0, \\sin \\varepsilon, \\cos \\varepsilon)$，其中 $\\varepsilon$ 为中等大小。\n- 时间范围：$T = 5$（无量纲）。\n\n使用固定时间步长实现两种积分子，并对以下每个测试用例（角度以弧度为单位）评估漂移：\n1) 靠近分界线，$\\varepsilon = 10^{-1}$，$h = 10^{-2}$。\n2) 靠近分界线，$\\varepsilon = 10^{-3}$，$h = 10^{-2}$。\n3) 靠近分界线，$\\varepsilon = 10^{-6}$，$h = 10^{-2}$。\n4) 远离分界线，靠近 $e_{3}$，$\\varepsilon = 10^{-1}$，$h = 2 \\cdot 10^{-2}$。\n5) 靠近分界线，$\\varepsilon = 10^{-3}$，$h = 5 \\cdot 10^{-2}$。\n\n对于每个测试用例，按以下顺序计算并记录四个浮点数：\n- RK4 的最大相对能量漂移。\n- RK4 的最大相对 Casimir 不变量漂移。\n- 隐式中点法的最大相对能量漂移。\n- 隐式中点法的最大相对 Casimir 不变量漂移。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3,...]”），该序列按上述顺序串联了所有五个测试用例的四个浮点数结果。由于所有量均为无量纲，因此不需要物理单位，并且所有角度必须按弧度处理。",
            "solution": "该问题要求对用于描述 Euler 方程所刻画的无力矩刚体运动的两种数值积分方案进行比较分析。这是几何力学中的一个基本问题，分析的重点将是每种方法在多大程度上保持了系统的不变量：哈密顿量 $H$（能量）和 Casimir 函数 $C$（角动量大小的平方）。\n\n系统的状态由体坐标系中的角动量矢量 $M = (M_1, M_2, M_3) \\in \\mathbb{R}^3$ 给出。主转动惯量由对角张量 $I = \\operatorname{diag}(I_1, I_2, I_3)$ 给出，其给定值为 $I_1=1$, $I_2=2$, 和 $I_3=3$。运动方程为 Euler 方程：\n$$\n\\dot{M} = M \\times \\Omega = M \\times (I^{-1}M)\n$$\n这定义了常微分方程系统的矢量场，$f(M) = M \\times (I^{-1}M)$。对于精确解，这些方程拥有两个守恒量：\n\n$1$. 哈密顿量，或动能，$H(M)$：\n$$\nH(M) = \\frac{1}{2} M \\cdot \\Omega = \\frac{1}{2} M \\cdot (I^{-1}M) = \\frac{1}{2} \\left( \\frac{M_1^2}{I_1} + \\frac{M_2^2}{I_2} + \\frac{M_3^2}{I_3} \\right)\n$$\n\n$2$. Casimir 函数，即角动量欧几里得范数平方的一半，$C(M)$：\n$$\nC(M) = \\frac{1}{2} \\lVert M \\rVert^2 = \\frac{1}{2} (M_1^2 + M_2^2 + M_3^2)\n$$\n对于任何精确解轨道 $M(t)$， $H(M(t))$ 和 $C(M(t))$ 都必须保持不变。然而，数值积分子是近似方法，可能无法保持这些不变量，从而导致非物理的漂移。我们将实现并比较两种方法：经典四阶 Runge-Kutta 方法和隐式中点法。\n\n**第一种积分子：四阶 Runge-Kutta (RK4)**\n\nRK4 方法是一种广泛使用的、显式的、通用的常微分方程 $\\dot{y} = f(y)$ 求解器。对于从状态 $M_n$ 到 $M_{n+1}$ 的大小为 $h$ 的单步，算法如下：\n$$\n\\begin{aligned}\nk_1 &= f(M_n) \\\\\nk_2 &= f(M_n + \\frac{h}{2} k_1) \\\\\nk_3 &= f(M_n + \\frac{h}{2} k_2) \\\\\nk_4 &= f(M_n + h k_3) \\\\\nM_{n+1} &= M_n + \\frac{h}{6} (k_1 + 2k_2 + 2k_3 + k_4)\n\\end{aligned}\n$$\nRK4 以其在给定步长下的高精度而闻名（局部误差为 $O(h^5)$），但它不是几何积分子。它不尊重 Euler 方程底层的 Lie-Poisson 结构。因此，我们预计哈密顿量 $H$ 和 Casimir 不变量 $C$ 都会随时间表现出长期漂移，意味着误差会系统性地累积。\n\n**第二种积分子：隐式中点法**\n\n隐式中点法是一种单级隐式 Runge-Kutta 方法。单步由以下非线性方程定义：\n$$\nM_{n+1} = M_n + h f\\left(\\frac{M_n + M_{n+1}}{2}\\right)\n$$\n该方法是隐式的，因为未知数 $M_{n+1}$ 出现在方程两边。为了实现它，我们必须在每个时间步求解该方程以得到 $M_{n+1}$。我们可以使用 Newton 法。设 $X = M_{n+1}$ 为待求解的变量。该方程可以写成寻找残差函数 $G(X)$ 的根：\n$$\nG(X) = X - M_n - h f\\left(\\frac{M_n + X}{2}\\right) = 0\n$$\nNewton 法通过更新规则 $X^{(k+1)} = X^{(k)} + \\Delta X^{(k)}$ 迭代地改进初始猜测 $X^{(0)}$（例如，$X^{(0)}=M_n$），其中校正量 $\\Delta X^{(k)}$ 通过求解线性系统得到：\n$$\nJ_G(X^{(k)}) \\Delta X^{(k)} = -G(X^{(k)})\n$$\n这里，$J_G(X)$ 是 $G(X)$ 关于 $X$ 的 Jacobian 矩阵。该 Jacobian 矩阵由下式给出：\n$$\nJ_G(X) = \\mathbb{I} - \\frac{h}{2} J_f\\left(\\frac{M_n + X}{2}\\right)\n$$\n其中 $\\mathbb{I}$ 是 $3 \\times 3$ 单位矩阵，$J_f$ 是矢量场 $f(M) = M \\times (I^{-1}M)$ 的 Jacobian 矩阵。该 Jacobian 矩阵可以使用表示与向量 $v$ 的叉积的斜对称矩阵 $[v]_\\times$ 优雅地表示为：\n$$\nJ_f(M) = [M]_\\times I^{-1} - [I^{-1}M]_\\times\n$$\n隐式中点法的关键特性是它是一个几何积分子。对于这个 Lie-Poisson 系统，它是一个 Poisson 积分子，这意味着它能精确地保持所有的 Casimir 函数。为了验证它对 $C(M)$ 的保持性，我们将中点法规则与 $(M_{n+1} + M_n)$ 进行点积：\n$$\n(M_{n+1} - M_n) \\cdot (M_{n+1} + M_n) = h f\\left(\\frac{M_n + M_{n+1}}{2}\\right) \\cdot (M_n + M_{n+1})\n$$\n设 $M_{mid} = \\frac{M_n + M_{n+1}}{2}$。方程变为：\n$$\n\\lVert M_{n+1} \\rVert^2 - \\lVert M_n \\rVert^2 = 2h (M_{mid} \\times (I^{-1}M_{mid})) \\cdot M_{mid}\n$$\n右侧为零，因为两个向量的叉积与这两个向量都正交。因此，$\\lVert M_{n+1} \\rVert^2 = \\lVert M_n \\rVert^2$，这意味着 $C(M_{n+1}) = C(M_n)$。对于此方法，观测到的任何 Casimir 不变量的数值漂移都将归因于 Newton 求解器的有限公差和浮点精度限制，而非方法本身。虽然哈密顿量 $H$ 没有被精确保持，但已知其误差在非常长的积分时间内是有界的，表现为振荡而非长期漂移。\n\n**数值评估**\n\n我们将实现两种积分子，并在五个不同的测试用例中，通过改变初始条件 $M(0)$ 和步长 $h$，将系统从 $t=0$ 演化到 $T=5$。选择的初始条件要么靠近分界线（对应于绕中间轴 $e_2$ 的不稳定旋转），要么远离分界线（靠近稳定轴 $e_3$）。我们测量两个不变量 $H$ 和 $C$ 的最大相对漂移，定义为：\n$$\n\\Delta_H = \\max_{0 \\le t \\le T} \\frac{\\left| H(M(t)) - H(M(0)) \\right|}{\\left| H(M(0)) \\right|}, \\quad \\Delta_C = \\max_{0 \\le t \\le T} \\frac{\\left| C(M(t)) - C(M(0)) \\right|}{\\left| C(M(0)) \\right|}\n$$\n所提供的 Python 代码执行了这些步骤。它定义了系统动力学，实现了 RK4 和隐式中点求解器（带有一个 Newton-Raphson 求根器），遍历指定的测试用例，为每个用例计算四种漂移度量，并按要求格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Euler top problem by integrating the equations of motion\n    using RK4 and Implicit Midpoint methods, then calculates and prints\n    the drift of the Hamiltonian and Casimir invariants for a set of test cases.\n    \"\"\"\n\n    # --- System Definition ---\n    I = np.array([1.0, 2.0, 3.0])\n    I_inv = 1.0 / I\n\n    def euler_rhs(M):\n        \"\"\"Computes the right-hand side of the Euler equations: M x (I^-1 * M).\"\"\"\n        M = np.asarray(M)\n        Omega = I_inv * M\n        return np.cross(M, Omega)\n\n    def hamiltonian(M):\n        \"\"\"Computes the Hamiltonian H = 1/2 * M . (I^-1 * M).\"\"\"\n        M = np.asarray(M)\n        return 0.5 * np.dot(M, I_inv * M)\n\n    def casimir(M):\n        \"\"\"Computes the Casimir C = 1/2 * ||M||^2.\"\"\"\n        M = np.asarray(M)\n        return 0.5 * np.dot(M, M)\n\n    # --- Integrator Implementations ---\n\n    def rk4_step(M_n, h):\n        \"\"\"Performs a single step of the 4th-order Runge-Kutta method.\"\"\"\n        k1 = euler_rhs(M_n)\n        k2 = euler_rhs(M_n + h / 2.0 * k1)\n        k3 = euler_rhs(M_n + h / 2.0 * k2)\n        k4 = euler_rhs(M_n + h * k3)\n        return M_n + h / 6.0 * (k1 + 2 * k2 + 2 * k3 + k4)\n\n    def midpoint_step(M_n, h):\n        \"\"\"Performs a single step of the implicit midpoint method using Newton's method.\"\"\"\n        X = M_n.copy()  # Initial guess M_{n+1}^{(0)} = M_n\n        max_iter = 10\n        tol = 1e-14\n\n        for _ in range(max_iter):\n            M_mid = (M_n + X) / 2.0\n            f_mid = euler_rhs(M_mid)\n            \n            G = X - M_n - h * f_mid\n            if np.linalg.norm(G)  tol:\n                break\n\n            # Jacobian of G w.r.t. X\n            Omega_mid = I_inv * M_mid\n            \n            M_mid_skew = np.array([[0, -M_mid[2], M_mid[1]],\n                                   [M_mid[2], 0, -M_mid[0]],\n                                   [-M_mid[1], M_mid[0], 0]])\n            \n            Omega_mid_skew = np.array([[0, -Omega_mid[2], Omega_mid[1]],\n                                       [Omega_mid[2], 0, -Omega_mid[0]],\n                                       [-Omega_mid[1], Omega_mid[0], 0]])\n            \n            # J_f(M) = [M]_x @ I^-1 - [I^-1 M]_x\n            J_f_mid = M_mid_skew @ np.diag(I_inv) - Omega_mid_skew\n            \n            # J_G(X) = I - (h/2) * J_f(M_mid)\n            J_G = np.eye(3) - (h / 2.0) * J_f_mid\n            \n            delta_X = np.linalg.solve(J_G, -G)\n            X += delta_X\n        \n        return X\n\n    # --- Test Cases and Simulation ---\n    test_cases = [\n        # (is_near_separatrix, epsilon, h)\n        (True, 1e-1, 1e-2),\n        (True, 1e-3, 1e-2),\n        (True, 1e-6, 1e-2),\n        (False, 1e-1, 2e-2),\n        (True, 1e-3, 5e-2),\n    ]\n\n    all_results = []\n    T_final = 5.0\n\n    for is_near_sep, eps, h in test_cases:\n        num_steps = int(round(T_final / h))\n\n        # Initial conditions\n        if is_near_sep:\n            M0 = np.array([np.sin(eps), np.cos(eps), 0.0])\n        else:\n            M0 = np.array([0.0, np.sin(eps), np.cos(eps)])\n        \n        # Normalize to ensure ||M(0)|| = 1 precisely\n        M0 /= np.linalg.norm(M0)\n\n        H0 = hamiltonian(M0)\n        C0 = casimir(M0)\n\n        # --- RK4 Integration ---\n        M_rk4_hist = np.zeros((num_steps + 1, 3))\n        M_rk4_hist[0] = M0\n        M_current_rk4 = M0.copy()\n        for i in range(num_steps):\n            M_current_rk4 = rk4_step(M_current_rk4, h)\n            M_rk4_hist[i+1] = M_current_rk4\n\n        # --- Implicit Midpoint Integration ---\n        M_mid_hist = np.zeros((num_steps + 1, 3))\n        M_mid_hist[0] = M0\n        M_current_mid = M0.copy()\n        for i in range(num_steps):\n            M_current_mid = midpoint_step(M_current_mid, h)\n            M_mid_hist[i+1] = M_current_mid\n\n        # --- Drift Calculation ---\n        H_rk4_vals = np.array([hamiltonian(m) for m in M_rk4_hist])\n        C_rk4_vals = np.array([casimir(m) for m in M_rk4_hist])\n        \n        H_mid_vals = np.array([hamiltonian(m) for m in M_mid_hist])\n        C_mid_vals = np.array([casimir(m) for m in M_mid_hist])\n\n        drift_H_rk4 = np.max(np.abs(H_rk4_vals - H0)) / np.abs(H0)\n        drift_C_rk4 = np.max(np.abs(C_rk4_vals - C0)) / np.abs(C0)\n        \n        drift_H_mid = np.max(np.abs(H_mid_vals - H0)) / np.abs(H0)\n        drift_C_mid = np.max(np.abs(C_mid_vals - C0)) / np.abs(C0)\n        \n        all_results.extend([drift_H_rk4, drift_C_rk4, drift_H_mid, drift_C_mid])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6e}' for r in all_results)}]\")\n\nsolve()\n```"
        }
    ]
}