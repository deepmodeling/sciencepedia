{
    "hands_on_practices": [
        {
            "introduction": "The first step in mastering Routh reduction is to apply it to a canonical system. This practice focuses on the classic problem of a particle in a central potential, a cornerstone of mechanics that benefits greatly from symmetry reduction . By identifying the cyclic angular coordinate and its conserved momentum, you will derive the one-dimensional effective Routhian, revealing how the conserved angular momentum manifests as an effective potential barrier in the radial dynamics.",
            "id": "3768232",
            "problem": "Consider a planar particle with configuration space modeled in polar coordinates by $(r,\\theta)$, where $r \\in (0,\\infty)$ and $\\theta \\in S^{1}$. The system is invariant under the action of the Special Orthogonal group in two dimensions (SO(2)) acting by rotations on $\\theta$. The Lagrangian is\n$$\nL(r,\\theta,\\dot{r},\\dot{\\theta})=\\frac{m}{2}\\left(\\dot{r}^{2}+r^{2}\\dot{\\theta}^{2}\\right)-V(r),\n$$\nwhere $m>0$ is the mass and $V(r)$ is a smooth central potential.\n\nStarting from the fundamental definitions of Lagrangian mechanics, the conjugate momentum, and the concept of symmetry-induced cyclic coordinates, perform Routh reduction at a fixed value of the conserved angular momentum $\\mu \\in \\mathbb{R}$. Derive the reduced (effective) radial Routhian $R(r,\\dot{r};\\mu)$ that depends only on $r$, $\\dot{r}$, and the parameter $\\mu$. Provide your final result as a single, simplified, closed-form analytic expression. Do not substitute any numerical values, and do not include units in your final expression.",
            "solution": "The given Lagrangian is\n$$\nL(r,\\theta,\\dot{r},\\dot{\\theta})=\\frac{m}{2}\\left(\\dot{r}^{2}+r^{2}\\dot{\\theta}^{2}\\right)-V(r).\n$$\nBecause $L$ does not depend explicitly on $\\theta$ (it depends only on $\\dot{\\theta}$), the coordinate $\\theta$ is cyclic. By the standard definition of conjugate momentum, the momentum associated with $\\theta$ is\n$$\np_{\\theta}=\\frac{\\partial L}{\\partial \\dot{\\theta}}=m r^{2}\\dot{\\theta}.\n$$\nSince $\\theta$ is cyclic, Noether’s theorem implies that $p_{\\theta}$ is conserved along solutions, so $p_{\\theta}=\\mu$ for some constant $\\mu \\in \\mathbb{R}$ determined by initial conditions. Solving for $\\dot{\\theta}$ at fixed $p_{\\theta}=\\mu$ gives\n$$\n\\dot{\\theta}=\\frac{\\mu}{m r^{2}}.\n$$\n\nRouth reduction proceeds by performing a partial Legendre transform with respect to the cyclic variable $\\theta$. The Routhian is defined by\n$$\nR(r,\\dot{r};\\mu)=L(r,\\theta,\\dot{r},\\dot{\\theta})-p_{\\theta}\\dot{\\theta}\\bigg|_{\\ \\dot{\\theta}=\\mu/(m r^{2})}.\n$$\nSubstituting the expressions for $L$ and $p_{\\theta}$ and then enforcing $\\dot{\\theta}=\\mu/(m r^{2})$, we obtain\n\n$$\n\\begin{aligned}\nR(r,\\dot{r};\\mu)\n&=\\left[\\frac{m}{2}\\left(\\dot{r}^{2}+r^{2}\\dot{\\theta}^{2}\\right)-V(r)\\right]-\\mu\\,\\dot{\\theta}\\bigg|_{\\ \\dot{\\theta}=\\mu/(m r^{2})}\\\\\n&=\\frac{m}{2}\\dot{r}^{2}+\\frac{m}{2}r^{2}\\left(\\frac{\\mu}{m r^{2}}\\right)^{2}-V(r)-\\mu\\left(\\frac{\\mu}{m r^{2}}\\right)\\\\\n&=\\frac{m}{2}\\dot{r}^{2}+\\frac{m}{2}\\cdot\\frac{\\mu^{2}}{m^{2} r^{2}}-V(r)-\\frac{\\mu^{2}}{m r^{2}}\\\\\n&=\\frac{m}{2}\\dot{r}^{2}-\\frac{\\mu^{2}}{2 m r^{2}}-V(r).\n\\end{aligned}\n$$\n\nThis is the reduced (effective) radial Routhian. It can be interpreted as the radial kinetic term minus an effective potential, where the effective potential acquires the additional centrifugal contribution $\\frac{\\mu^{2}}{2 m r^{2}}$ due to the fixed angular momentum.\n\nTo verify consistency, we can check that the Euler–Lagrange equation derived from $R$ reproduces the radial dynamics of the original system at fixed $\\mu$. Compute\n\n$$\n\\frac{\\partial R}{\\partial \\dot{r}}=m \\dot{r}, \\quad \\frac{d}{dt}\\left(\\frac{\\partial R}{\\partial \\dot{r}}\\right)=m \\ddot{r},\n$$\n\nand\n\n$$\n\\frac{\\partial R}{\\partial r}=\\frac{\\partial}{\\partial r}\\left(-\\frac{\\mu^{2}}{2 m r^{2}}-V(r)\\right)=\\frac{\\mu^{2}}{m r^{3}}-V'(r).\n$$\n\nThe Euler–Lagrange equation $ \\frac{d}{dt}\\left(\\frac{\\partial R}{\\partial \\dot{r}}\\right)-\\frac{\\partial R}{\\partial r}=0 $ becomes\n\n$$\nm\\ddot{r}-\\left(\\frac{\\mu^{2}}{m r^{3}}-V'(r)\\right)=0 \\quad \\Longleftrightarrow \\quad m\\ddot{r}-\\frac{\\mu^{2}}{m r^{3}}+V'(r)=0,\n$$\n\nwhich agrees with the radial equation obtained from the original Lagrangian after substituting $\\dot{\\theta}=\\mu/(m r^{2})$ into $m(\\ddot{r}-r\\dot{\\theta}^{2})+V'(r)=0$. This confirms that the reduced Routhian correctly captures the radial dynamics at fixed angular momentum.\n\nThus, the effective radial Routhian is\n$$\nR(r,\\dot{r};\\mu)=\\frac{m}{2}\\dot{r}^{2}-\\frac{\\mu^{2}}{2 m r^{2}}-V(r).\n$$",
            "answer": "$$\\boxed{\\frac{m}{2}\\dot{r}^{2}-\\frac{\\mu^{2}}{2 m r^{2}}-V(r)}$$"
        },
        {
            "introduction": "Routh reduction not only simplifies a system but can also unveil hidden structures, such as gyroscopic forces analogous to magnetism. This problem explores a Kaluza-Klein type Lagrangian where the reduction process generates velocity-dependent forces in the effective equations of motion . You will derive these reduced dynamics and then transition from theory to practice by implementing numerical integrators to see how well they preserve the system's conserved energy, a crucial skill in computational mechanics.",
            "id": "3765208",
            "problem": "Consider a mechanical system on the configuration manifold $Q = \\mathbb{R}^2 \\times S^1$ with coordinates $(x,y,\\phi)$, where $\\phi$ is an angle measured in radians. The system has a Kaluza–Klein type Lagrangian\n$$\nL(x,y,\\phi;\\dot{x},\\dot{y},\\dot{\\phi}) = \\tfrac{1}{2}\\left(\\dot{x}^2 + \\dot{y}^2 + \\left(\\dot{\\phi} + A_x(x,y)\\,\\dot{x} + A_y(x,y)\\,\\dot{y}\\right)^2\\right) - V(x,y),\n$$\nwith a coupling one-form $A = A_x(x,y)\\,dx + A_y(x,y)\\,dy$ on $\\mathbb{R}^2$ and a potential $V(x,y) = \\tfrac{1}{2}\\,\\omega^2\\,(x^2+y^2)$, where $\\omega > 0$ is a constant frequency. The parameter $\\alpha > 0$ controls the strength of the curvature-induced coupling via\n$$\nA_x(x,y) = -\\frac{\\alpha\\,y}{1+x^2+y^2},\\quad A_y(x,y) = \\frac{\\alpha\\,x}{1+x^2+y^2}.\n$$\nThe coordinate $\\phi$ is cyclic; the conjugate momentum $p = \\partial L/\\partial \\dot{\\phi}$ is conserved. Perform Routh reduction at fixed $p$ to obtain the reduced dynamics on $(x,y)$, and identify the curvature-induced gyroscopic forces arising from the connection curvature two-form $F = dA$. Use this reduced dynamics to assess how the numerical step size impacts preservation of the reduced energy along simulated trajectories.\n\nStarting from fundamental principles of Routh reduction for systems with cyclic coordinates and the Euler–Lagrange equations, derive the reduced equations of motion on $\\mathbb{R}^2$ for fixed $p$. Define the reduced energy and explain why it is exactly conserved in the continuous reduced dynamics. Design and implement two numerical time-stepping methods: the explicit fourth-order Runge–Kutta method (Runge–Kutta (RK) of order $4$, abbreviated as RK4) and the implicit midpoint method, applied to the first-order form of the reduced equations. Quantify, for a set of prescribed parameter values, how the choice of step size affects the maximum deviation of the reduced energy over a fixed simulation interval.\n\nYour program must:\n- Implement the reduced dynamics on $\\mathbb{R}^2$ obtained by Routh reduction at fixed $p$.\n- Simulate trajectories for the specified test suite using both RK4 and the implicit midpoint method.\n- Compute, for each test case, the maximum absolute deviation of the reduced energy with respect to its initial value over the simulation interval, reported as a float.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3]$, where each $r_i$ is a float.\n\nAll quantities are dimensionless except angles, which must be in radians. The reduced energy must be reported as a dimensionless quantity. The test suite is:\n\n- Test case $1$ (curvature significant, small step, RK4): $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, time step $h = 0.01$, total time $T = 10.0$, numerical method = RK4, initial condition $(x(0),y(0),\\dot{x}(0),\\dot{y}(0)) = (0.3,0.0,0.0,1.0)$.\n- Test case $2$ (curvature significant, medium step, RK4): $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.05$, $T = 10.0$, method = RK4, same initial condition.\n- Test case $3$ (curvature significant, large step, RK4): $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.10$, $T = 10.0$, method = RK4, same initial condition.\n- Test case $4$ (curvature significant, medium step, implicit midpoint): $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.05$, $T = 10.0$, method = implicit midpoint, same initial condition.\n- Test case $5$ (boundary case, zero curvature, large step, RK4): $\\alpha = 0.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.10$, $T = 10.0$, method = RK4, same initial condition.\n\nYour program should produce a single line of output containing the maximum absolute reduced energy deviations for the five test cases as a comma-separated list enclosed in square brackets, in the order of the test cases listed above, for example, $[e_1,e_2,e_3,e_4,e_5]$.",
            "solution": "The problem statement is subjected to a rigorous validation process before any attempt at a solution.\n\n### Step 1: Extract Givens\n- **Configuration Manifold**: $Q = \\mathbb{R}^2 \\times S^1$ with coordinates $(x,y,\\phi)$.\n- **Lagrangian**: $L(x,y,\\phi;\\dot{x},\\dot{y},\\dot{\\phi}) = \\tfrac{1}{2}\\left(\\dot{x}^2 + \\dot{y}^2 + \\left(\\dot{\\phi} + A_x(x,y)\\,\\dot{x} + A_y(x,y)\\,\\dot{y}\\right)^2\\right) - V(x,y)$.\n- **Coupling 1-form**: $A = A_x(x,y)\\,dx + A_y(x,y)\\,dy$.\n- **Components of A**: $A_x(x,y) = -\\frac{\\alpha\\,y}{1+x^2+y^2}$, $A_y(x,y) = \\frac{\\alpha\\,x}{1+x^2+y^2}$.\n- **Potential Energy**: $V(x,y) = \\tfrac{1}{2}\\,\\omega^2\\,(x^2+y^2)$.\n- **Parameters**: $\\omega > 0$, $\\alpha > 0$.\n- **Cyclic Coordinate**: The coordinate $\\phi$ is cyclic.\n- **Conserved Momentum**: The conjugate momentum $p = \\partial L/\\partial \\dot{\\phi}$ is conserved.\n- **Task**: Perform Routh reduction, derive reduced dynamics and energy, implement RK4 and implicit midpoint methods, and compute the maximum deviation of reduced energy for a set of test cases.\n- **Test Suite**:\n    1.  $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.01$, $T = 10.0$, method = RK4, IC: $(x(0),y(0),\\dot{x}(0),\\dot{y}(0)) = (0.3,0.0,0.0,1.0)$.\n    2.  $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.05$, $T = 10.0$, method = RK4, same IC.\n    3.  $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.10$, $T = 10.0$, method = RK4, same IC.\n    4.  $\\alpha = 2.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.05$, $T = 10.0$, method = implicit midpoint, same IC.\n    5.  $\\alpha = 0.0$, $p = 1.5$, $\\omega = 0.7$, $h = 0.10$, $T = 10.0$, method = RK4, same IC.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, rooted in the principles of classical and geometric mechanics (Lagrangian mechanics, Routh reduction, Kaluza-Klein mechanism). It is well-posed, with all necessary data and conditions provided for a unique numerical solution. The language is objective and precise. The tasks are computationally tractable and relevant to the study of numerical methods for differential equations. The test cases are well-chosen to explore the effects of step size, numerical method, and the presence of coupling ($\\alpha \\neq 0$ vs. $\\alpha = 0$). No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Theoretical Derivation\nThe system is described by the Lagrangian on the configuration manifold $Q = \\mathbb{R}^2 \\times S^1$ with coordinates $q^i = (x, y, \\phi)$:\n$$\nL(x,y,\\phi,\\dot{x},\\dot{y},\\dot{\\phi}) = \\frac{1}{2}\\left(\\dot{x}^2 + \\dot{y}^2 + \\left(\\dot{\\phi} + A_x\\dot{x} + A_y\\dot{y}\\right)^2\\right) - V(x,y)\n$$\nThe Lagrangian is independent of $\\phi$ (i.e., $\\partial L / \\partial \\phi = 0$), hence $\\phi$ is a cyclic coordinate. By Noether's theorem, the conjugate momentum $p_\\phi$ is a conserved quantity.\n$$\np \\equiv p_\\phi = \\frac{\\partial L}{\\partial \\dot{\\phi}} = \\dot{\\phi} + A_x(x,y)\\dot{x} + A_y(x,y)\\dot{y}\n$$\nThe value of $p$ is a constant of motion, fixed by the initial conditions of the system.\n\n**Routh Reduction**\nWe eliminate the cyclic coordinate by performing a partial Legendre transformation with respect to $\\dot{\\phi}$. The Routhian, $R_p$, is defined as:\n$$\nR_p(x,y,\\dot{x},\\dot{y}) = L - p\\dot{\\phi}\n$$\nFirst, we solve the momentum definition for $\\dot{\\phi}$:\n$$\n\\dot{\\phi} = p - (A_x\\dot{x} + A_y\\dot{y})\n$$\nSubstituting this and the definition of $L$ into the Routhian expression:\n$$\nR_p = \\frac{1}{2}\\left(\\dot{x}^2 + \\dot{y}^2 + p^2\\right) - V(x,y) - p \\left( p - (A_x\\dot{x} + A_y\\dot{y}) \\right)\n$$\nSimplifying the expression yields the Routhian, which acts as the Lagrangian for the reduced system on $\\mathbb{R}^2$:\n$$\nR_p(x,y,\\dot{x},\\dot{y}) = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2) + p(A_x\\dot{x} + A_y\\dot{y}) - \\left(V(x,y) + \\frac{1}{2}p^2\\right)\n$$\nThe dynamics of the $(x,y)$ variables are governed by the Euler-Lagrange equations for $R_p$:\n$$\n\\frac{d}{dt}\\frac{\\partial R_p}{\\partial \\dot{q}^i} - \\frac{\\partial R_p}{\\partial q^i} = 0, \\quad q^i \\in \\{x,y\\}\n$$\nWe compute the necessary derivatives:\n$$\n\\frac{\\partial R_p}{\\partial \\dot{x}} = \\dot{x} + p A_x \\quad , \\quad \\frac{\\partial R_p}{\\partial \\dot{y}} = \\dot{y} + p A_y\n$$\n$$\n\\frac{\\partial R_p}{\\partial x} = p \\left(\\frac{\\partial A_x}{\\partial x}\\dot{x} + \\frac{\\partial A_y}{\\partial x}\\dot{y}\\right) - \\frac{\\partial V}{\\partial x}\n$$\n$$\n\\frac{\\partial R_p}{\\partial y} = p \\left(\\frac{\\partial A_x}{\\partial y}\\dot{x} + \\frac{\\partial A_y}{\\partial y}\\dot{y}\\right) - \\frac{\\partial V}{\\partial y}\n$$\nTaking the total time derivative of the momentum-like terms:\n$$\n\\frac{d}{dt}\\frac{\\partial R_p}{\\partial \\dot{x}} = \\ddot{x} + p\\left(\\frac{\\partial A_x}{\\partial x}\\dot{x} + \\frac{\\partial A_x}{\\partial y}\\dot{y}\\right)\n$$\n$$\n\\frac{d}{dt}\\frac{\\partial R_p}{\\partial \\dot{y}} = \\ddot{y} + p\\left(\\frac{\\partial A_y}{\\partial x}\\dot{x} + \\frac{\\partial A_y}{\\partial y}\\dot{y}\\right)\n$$\nSubstituting these into the Euler-Lagrange equations and simplifying, we obtain for the $x$-equation:\n$$\n\\ddot{x} + p\\left(\\frac{\\partial A_x}{\\partial x}\\dot{x} + \\frac{\\partial A_x}{\\partial y}\\dot{y}\\right) - \\left[ p \\left(\\frac{\\partial A_x}{\\partial x}\\dot{x} + \\frac{\\partial A_y}{\\partial x}\\dot{y}\\right) - \\frac{\\partial V}{\\partial x} \\right] = 0\n$$\n$$\n\\ddot{x} = -\\frac{\\partial V}{\\partial x} + p\\left(\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\\right)\\dot{y}\n$$\nSimilarly, for the $y$-equation:\n$$\n\\ddot{y} = -\\frac{\\partial V}{\\partial y} - p\\left(\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\\right)\\dot{x}\n$$\nThese equations describe the motion on the reduced configuration space. The term multiplying the velocity is a gyroscopic force, arising from the curvature of the connection one-form $A$. The curvature is the two-form $F = dA$. Its only non-zero component is:\n$$\nF_{xy} = \\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\n$$\nFor the given $A_x = -\\frac{\\alpha y}{1+x^2+y^2}$ and $A_y = \\frac{\\alpha x}{1+x^2+y^2}$:\n$$\n\\frac{\\partial A_y}{\\partial x} = \\alpha \\frac{(1+x^2+y^2)\\cdot 1 - x(2x)}{(1+x^2+y^2)^2} = \\alpha \\frac{1-x^2+y^2}{(1+x^2+y^2)^2}\n$$\n$$\n\\frac{\\partial A_x}{\\partial y} = -\\alpha \\frac{(1+x^2+y^2)\\cdot 1 - y(2y)}{(1+x^2+y^2)^2} = -\\alpha \\frac{1+x^2-y^2}{(1+x^2+y^2)^2}\n$$\nThus, the curvature is:\n$$\nF_{xy} = \\alpha \\frac{1-x^2+y^2}{(1+x^2+y^2)^2} - \\left(-\\alpha \\frac{1+x^2-y^2}{(1+x^2+y^2)^2}\\right) = \\frac{2\\alpha}{(1+x^2+y^2)^2}\n$$\nThe potential is $V(x,y) = \\frac{1}{2}\\omega^2(x^2+y^2)$, so $\\frac{\\partial V}{\\partial x} = \\omega^2 x$ and $\\frac{\\partial V}{\\partial y} = \\omega^2 y$. The final reduced equations of motion are:\n$$\n\\ddot{x} = -\\omega^2 x + \\frac{2\\alpha p}{(1+x^2+y^2)^2} \\dot{y}\n$$\n$$\n\\ddot{y} = -\\omega^2 y - \\frac{2\\alpha p}{(1+x^2+y^2)^2} \\dot{x}\n$$\n\n**Reduced Energy Conservation**\nThe Routhian $R_p$ is autonomous (time-independent), so its corresponding energy is conserved. The reduced energy $E_p$ is the Hamiltonian of the reduced system, obtained by a Legendre transformation of $R_p$:\n$$\nE_p = \\frac{\\partial R_p}{\\partial \\dot{x}}\\dot{x} + \\frac{\\partial R_p}{\\partial \\dot{y}}\\dot{y} - R_p\n$$\n$$\nE_p = (\\dot{x} + pA_x)\\dot{x} + (\\dot{y} + pA_y)\\dot{y} - \\left[\\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2) + p(A_x\\dot{x} + A_y\\dot{y}) - \\left(V + \\frac{1}{2}p^2\\right)\\right]\n$$\nAfter cancellation, this simplifies to:\n$$\nE_p = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2) + V(x,y) + \\frac{1}{2}p^2\n$$\nSubstituting the potential $V(x,y)$, the conserved reduced energy is:\n$$\nE_p = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2) + \\frac{1}{2}\\omega^2(x^2+y^2) + \\frac{1}{2}p^2\n$$\nThis quantity is exactly conserved along any exact solution trajectory of the reduced dynamics. Numerical methods will typically fail to conserve $E_p$ exactly, and the magnitude of the deviation is a key measure of a method's quality.\n\n### Numerical Methods and Implementation\nTo solve the system numerically, we convert the two second-order ODEs into a system of four first-order ODEs. Let the state vector be $Z = [x, y, v_x, v_y]^T$, where $v_x = \\dot{x}$ and $v_y = \\dot{y}$. The system is $\\dot{Z} = f(Z)$:\n$$\n\\dot{Z} = \\begin{pmatrix} v_x \\\\ v_y \\\\ -\\omega^2 x + F_{xy}(x,y) \\cdot p \\cdot v_y \\\\ -\\omega^2 y - F_{xy}(x,y) \\cdot p \\cdot v_x \\end{pmatrix}\n$$\nwhere $F_{xy}(x,y) = \\frac{2\\alpha}{(1+x^2+y^2)^2}$.\n\n**Runge-Kutta 4th Order (RK4)**: This is an explicit, single-step method. For $\\dot{Z}=f(t,Z)$, one step from $Z_n$ to $Z_{n+1}$ over a time interval $h$ is given by:\n$$\nZ_{n+1} = Z_n + \\frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\nwhere\n$k_1 = f(t_n, Z_n)$,\n$k_2 = f(t_n + h/2, Z_n + h/2 \\cdot k_1)$,\n$k_3 = f(t_n + h/2, Z_n + h/2 \\cdot k_2)$,\n$k_4 = f(t_n + h, Z_n + h \\cdot k_3)$.\nRK4 is known for its accuracy (global error $O(h^4)$) for smooth problems, but it is not a geometric integrator and does not conserve energy-like quantities, typically exhibiting energy drift over long simulations.\n\n**Implicit Midpoint Method**: This is an implicit, single-step method defined by:\n$$\nZ_{n+1} = Z_n + h f\\left(t_n + \\frac{h}{2}, \\frac{Z_n + Z_{n+1}}{2}\\right)\n$$\nThis method is a simplectic integrator, which is highly desirable for Hamiltonian systems. While it does not conserve the energy $E_p$ exactly (unless the Hamiltonian is quadratic, which is not the case here due to the $F_{xy}$ term), it conserves a nearby \"shadow\" Hamiltonian. This results in excellent long-term energy stability, where the numerical energy oscillates around its true initial value with no systematic drift. Solving the implicit equation for $Z_{n+1}$ at each step requires a numerical root-finding algorithm.\n\nThe program will implement these two methods to simulate the dynamics and calculate the maximum absolute deviation of the reduced energy $E_p$ from its initial value.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem as per the specification.\n    It simulates trajectories for a mechanical system with gyroscopic forces\n    using RK4 and Implicit Midpoint methods, and computes the maximum\n    deviation in the reduced energy.\n    \"\"\"\n\n    test_cases = [\n        {'alpha': 2.0, 'p': 1.5, 'omega': 0.7, 'h': 0.01, 'T': 10.0, 'method': 'RK4', \n         'ic': np.array([0.3, 0.0, 0.0, 1.0])},\n        {'alpha': 2.0, 'p': 1.5, 'omega': 0.7, 'h': 0.05, 'T': 10.0, 'method': 'RK4',\n         'ic': np.array([0.3, 0.0, 0.0, 1.0])},\n        {'alpha': 2.0, 'p': 1.5, 'omega': 0.7, 'h': 0.10, 'T': 10.0, 'method': 'RK4',\n         'ic': np.array([0.3, 0.0, 0.0, 1.0])},\n        {'alpha': 2.0, 'p': 1.5, 'omega': 0.7, 'h': 0.05, 'T': 10.0, 'method': 'implicit_midpoint',\n         'ic': np.array([0.3, 0.0, 0.0, 1.0])},\n        {'alpha': 0.0, 'p': 1.5, 'omega': 0.7, 'h': 0.10, 'T': 10.0, 'method': 'RK4',\n         'ic': np.array([0.3, 0.0, 0.0, 1.0])},\n    ]\n\n    def reduced_energy(state, p, omega):\n        \"\"\"Calculates the conserved reduced energy Ep.\"\"\"\n        x, y, vx, vy = state\n        kinetic_energy = 0.5 * (vx**2 + vy**2)\n        potential_energy = 0.5 * omega**2 * (x**2 + y**2)\n        momentum_energy = 0.5 * p**2\n        return kinetic_energy + potential_energy + momentum_energy\n\n    def derivatives(t, state, alpha, p, omega):\n        \"\"\"\n        Computes the time derivative of the state vector Z = [x, y, vx, vy].\n        This is the function f(Z) for the ODE system dZ/dt = f(Z).\n        \"\"\"\n        x, y, vx, vy = state\n        \n        r2 = x**2 + y**2\n        # Curvature term F_xy multiplied by momentum p\n        if alpha == 0:\n            F_term = 0.0\n        else:\n            F_term = 2.0 * alpha * p / (1.0 + r2)**2\n\n        ax = -omega**2 * x + F_term * vy\n        ay = -omega**2 * y - F_term * vx\n        \n        return np.array([vx, vy, ax, ay])\n\n    def rk4_step(f, t, z, h, **f_args):\n        \"\"\"Performs a single step of the 4th-order Runge-Kutta method.\"\"\"\n        k1 = f(t, z, **f_args)\n        k2 = f(t + 0.5 * h, z + 0.5 * h * k1, **f_args)\n        k3 = f(t + 0.5 * h, z + 0.5 * h * k2, **f_args)\n        k4 = f(t + h, z + h * k3, **f_args)\n        return z + (h / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\n    def implicit_midpoint_step(f, t, z_n, h, **f_args):\n        \"\"\"Performs a single step of the implicit midpoint method using a root finder.\"\"\"\n        \n        def residual(z_np1):\n            \"\"\"The implicit equation to be solved for z_np1.\"\"\"\n            return z_np1 - z_n - h * f(t + 0.5 * h, 0.5 * (z_n + z_np1), **f_args)\n\n        # Use an explicit Euler step as an initial guess for the root finder.\n        z_guess = z_n + h * f(t, z_n, **f_args)\n        sol = root(residual, z_guess, method='hybr')\n        \n        if not sol.success:\n            # Fallback or error handling\n            # For this problem, 'hybr' is robust enough. We can raise an error if needed.\n            raise RuntimeError(f\"Implicit midpoint solver failed to converge at t={t}\")\n\n        return sol.x\n    \n    results = []\n\n    for case in test_cases:\n        alpha = case['alpha']\n        p = case['p']\n        omega = case['omega']\n        h = case['h']\n        T = case['T']\n        method = case['method']\n        z = case['ic'].copy()\n\n        f_args = {'alpha': alpha, 'p': p, 'omega': omega}\n\n        if method == 'RK4':\n            step_func = rk4_step\n        elif method == 'implicit_midpoint':\n            step_func = implicit_midpoint_step\n        else:\n            raise ValueError(f\"Unknown method: {method}\")\n        \n        num_steps = int(T / h)\n        \n        initial_energy = reduced_energy(z, p, omega)\n        energies = [initial_energy]\n        \n        time = 0.0\n        for _ in range(num_steps):\n            z = step_func(derivatives, time, z, h, **f_args)\n            time += h\n            current_energy = reduced_energy(z, p, omega)\n            energies.append(current_energy)\n\n        energy_array = np.array(energies)\n        max_deviation = np.max(np.abs(energy_array - initial_energy))\n        results.append(max_deviation)\n\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "One of the most profound insights from geometric mechanics is the concept of holonomy, or geometric phase, where the history of a system's evolution matters. This exercise demonstrates this phenomenon by having you reconstruct the full dynamics from a periodic motion in the reduced space . You will discover that even when the reduced system returns to its starting point, the eliminated cyclic coordinate can accumulate a net shift, a direct consequence of the configuration space's underlying geometry.",
            "id": "3765214",
            "problem": "Consider the configuration manifold $Q = S^{3}$ described by Hopf coordinates $(\\theta,\\phi,\\psi)$ with $0 \\leq \\theta \\leq \\pi$, $0 \\leq \\phi < 2\\pi$, and $0 \\leq \\psi < 2\\pi$. Let $S^{3} \\to S^{2}$ be the Hopf fibration with fiber $S^{1}$ coordinated by $\\psi$ and base $S^{2}$ coordinated by $(\\theta,\\phi)$. Consider the Kaluza–Klein type Lagrangian\n$$\nL(\\theta,\\phi,\\psi;\\dot{\\theta},\\dot{\\phi},\\dot{\\psi}) \\;=\\; \\frac{1}{2} m R^{2}\\big(\\dot{\\theta}^{2} + \\sin^{2}\\theta\\,\\dot{\\phi}^{2}\\big) \\;+\\; \\frac{1}{2} I\\big(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}\\big)^{2} \\;-\\; V(\\theta),\n$$\nwhere $m$, $R$, and $I$ are positive constants and the potential is axisymmetric\n$$\nV(\\theta) \\;=\\; \\frac{1}{2} m R^{2}\\,\\omega^{2}\\,\\sin^{2}\\theta,\n$$\nwith $\\omega>0$ constant. The coordinate $\\psi$ is cyclic, so the associated momentum\n$$\np_{\\psi} \\;=\\; \\frac{\\partial L}{\\partial \\dot{\\psi}} \\;=\\; I\\big(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}\\big)\n$$\nis conserved.\n\nPerform Routh reduction at momentum level $\\mu=0$ and determine a periodic reduced motion on $S^{2}$ corresponding to a latitude circle with constant polar angle $\\theta(t)\\equiv\\theta_{0}$ and uniform azimuthal rate $\\dot{\\phi}(t)\\equiv\\omega$. Then reconstruct the full motion on $Q$ and compute the net change in the fiber angle $\\psi$ over one period of the reduced motion, denoted by $\\Delta\\psi$.\n\nYour final answer must be a single closed-form analytic expression in terms of $\\theta_{0}$, expressed in radians. No rounding is required. Explain each step starting from the Lagrange equations and the conservation of momentum associated with the cyclic coordinate, and derive the reconstruction relation for $\\psi$ from first principles. Do not use shortcut formulas.",
            "solution": "The user-provided problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **Configuration Manifold**: $Q = S^{3}$ described by Hopf coordinates $(\\theta, \\phi, \\psi)$.\n- **Coordinate Ranges**: $0 \\leq \\theta \\leq \\pi$, $0 \\leq \\phi < 2\\pi$, $0 \\leq \\psi < 2\\pi$.\n- **Fibration**: Hopf fibration $S^{3} \\to S^{2}$ with fiber $S^{1}$ (coordinate $\\psi$) and base $S^{2}$ (coordinates $(\\theta, \\phi)$).\n- **Lagrangian**: $L(\\theta,\\phi,\\psi;\\dot{\\theta},\\dot{\\phi},\\dot{\\psi}) = \\frac{1}{2} m R^{2}\\big(\\dot{\\theta}^{2} + \\sin^{2}\\theta\\,\\dot{\\phi}^{2}\\big) + \\frac{1}{2} I\\big(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}\\big)^{2} - V(\\theta)$.\n- **Constants**: $m, R, I$ are positive constants. $\\omega > 0$ is a constant.\n- **Potential**: $V(\\theta) = \\frac{1}{2} m R^{2}\\,\\omega^{2}\\,\\sin^{2}\\theta$.\n- **Conserved Momentum**: The coordinate $\\psi$ is cyclic, with associated momentum $p_{\\psi} = \\frac{\\partial L}{\\partial \\dot{\\psi}} = I(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi})$ being conserved.\n- **Task**:\n    1. Perform Routh reduction at momentum level $\\mu=p_{\\psi}=0$.\n    2. Consider a specific periodic reduced motion on $S^2$ given by $\\theta(t) \\equiv \\theta_{0}$ and $\\dot{\\phi}(t) \\equiv \\omega$.\n    3. Reconstruct the full motion on $Q$.\n    4. Compute the net change in the fiber angle, $\\Delta\\psi$, over one period of the reduced motion.\n    5. The final answer must be a closed-form expression in terms of $\\theta_0$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard example in geometric mechanics and theoretical physics. The Lagrangian is of the Kaluza-Klein type, which describes the coupling of mechanical systems and is a well-established concept. The use of Hopf coordinates for $S^3$ and the concept of Routh reduction are fundamental in this field. The entire setup is scientifically and mathematically sound.\n- **Well-Posed**: The problem is clearly stated. It provides a specific Lagrangian, a specific potential, a specific momentum value for reduction ($\\mu=0$), and a specific trajectory on the reduced space. The objective, to calculate $\\Delta\\psi$, is unambiguous. A unique, stable, and meaningful solution is expected.\n- **Objective**: The problem is stated in precise mathematical language, free from any subjective or biased content.\n- **Completeness and Consistency**: The problem is self-contained. All necessary functions ($L, V$) and constants ($m, R, I, \\omega$) are defined. The definition provided for $p_\\psi$ is consistent with the given Lagrangian via partial differentiation. There are no missing or contradictory conditions.\n- **No Other Flaws**: The problem does not exhibit any other flaws such as being unrealistic, ill-posed, trivial, or unverifiable. It is a substantive problem requiring application of standard, but non-trivial, techniques in advanced classical mechanics.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. Proceed with the solution.\n\nThe problem asks for the net change in the fiber coordinate $\\psi$ for a specific reconstructed motion. The solution proceeds by first principles, beginning with the implications of the Euler-Lagrange equations.\n\nThe provided Lagrangian is:\n$$\nL = \\frac{1}{2} m R^{2}\\big(\\dot{\\theta}^{2} + \\sin^{2}\\theta\\,\\dot{\\phi}^{2}\\big) + \\frac{1}{2} I\\big(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}\\big)^{2} - \\frac{1}{2} m R^{2}\\,\\omega^{2}\\,\\sin^{2}\\theta\n$$\nThe coordinate $\\psi$ is cyclic, meaning it does not appear explicitly in the Lagrangian, i.e., $\\frac{\\partial L}{\\partial \\psi} = 0$. The Euler-Lagrange equation for the coordinate $\\psi$ is given by:\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{\\psi}}\\right) - \\frac{\\partial L}{\\partial \\psi} = 0\n$$\nGiven that $\\frac{\\partial L}{\\partial \\psi} = 0$, this equation simplifies to $\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{\\psi}}\\right) = 0$. This implies that the quantity $\\frac{\\partial L}{\\partial \\dot{\\psi}}$, which is the generalized momentum conjugate to $\\psi$, is a constant of the motion. Let us denote this conserved momentum by $p_{\\psi}$.\n$$\np_{\\psi} = \\frac{\\partial L}{\\partial \\dot{\\psi}} = \\frac{\\partial}{\\partial \\dot{\\psi}} \\left[ \\frac{1}{2} m R^{2}\\big(\\dot{\\theta}^{2} + \\sin^{2}\\theta\\,\\dot{\\phi}^{2}\\big) + \\frac{1}{2} I\\big(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}\\big)^{2} - V(\\theta) \\right]\n$$\nCarrying out the differentiation, we find:\n$$\np_{\\psi} = I(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi})\n$$\nThe problem specifies that we must perform the analysis at the momentum level $\\mu=0$. We therefore set the conserved quantity $p_{\\psi}$ to zero.\n$$\np_{\\psi} = I(\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi}) = 0\n$$\nSince $I$ is a positive constant, this implies a constraint on the velocities:\n$$\n\\dot{\\psi} + \\cos\\theta\\,\\dot{\\phi} = 0\n$$\nSolving for $\\dot{\\psi}$ gives the reconstruction relation, which expresses the velocity of the fiber coordinate $\\psi$ in terms of the coordinates and velocities on the base space $S^{2}$.\n$$\n\\dot{\\psi}(t) = -\\cos(\\theta(t))\\,\\dot{\\phi}(t)\n$$\nThis relation is derived from first principles, as requested. It is the central equation for reconstructing the motion of $\\psi$ from a known motion on the base space.\n\nThe problem provides the specific trajectory on the reduced space (the base space $S^2$). This motion is a periodic trajectory along a circle of latitude, characterized by:\n1. A constant polar angle: $\\theta(t) \\equiv \\theta_{0}$.\n2. A uniform azimuthal rate: $\\dot{\\phi}(t) \\equiv \\omega$.\n\nThis describes a circular motion on the sphere $S^2$. The period $T$ of this reduced motion is the time required for the azimuthal angle $\\phi$ to complete a full circle, i.e., to change by $2\\pi$. Since $\\dot{\\phi} = \\omega$ is constant and positive, the period is:\n$$\nT = \\frac{2\\pi}{\\dot{\\phi}} = \\frac{2\\pi}{\\omega}\n$$\nNow, we substitute the given reduced motion into the reconstruction relation for $\\dot{\\psi}$:\n$$\n\\dot{\\psi}(t) = -\\cos(\\theta_{0}) \\cdot \\omega\n$$\nSince $\\theta_0$ and $\\omega$ are constants, the velocity $\\dot{\\psi}$ is also constant throughout the motion.\n\nThe net change in the fiber angle, $\\Delta\\psi$, over one period $T$ of the reduced motion is found by integrating $\\dot{\\psi}(t)$ from $t=0$ to $t=T$.\n$$\n\\Delta\\psi = \\int_{0}^{T} \\dot{\\psi}(t) \\, dt\n$$\nSubstituting the constant value of $\\dot{\\psi}(t)$:\n$$\n\\Delta\\psi = \\int_{0}^{T} (-\\omega \\cos\\theta_{0}) \\, dt\n$$\nSince the integrand is constant, the integral is simply the integrand multiplied by the integration interval $T$.\n$$\n\\Delta\\psi = (-\\omega \\cos\\theta_{0}) \\cdot T\n$$\nFinally, we substitute the expression for the period $T = \\frac{2\\pi}{\\omega}$:\n$$\n\\Delta\\psi = (-\\omega \\cos\\theta_{0}) \\left(\\frac{2\\pi}{\\omega}\\right)\n$$\nThe constant $\\omega$ cancels out, yielding the final result for the net change in $\\psi$.\n$$\n\\Delta\\psi = -2\\pi \\cos\\theta_{0}\n$$\nThis quantity is a geometric phase, also known as a holonomy, which depends only on the geometry of the path traced on the base space and a connection form (here, $A = \\cos\\theta d\\phi$), but not on the speed at which the path is traversed. The result is expressed in terms of $\\theta_0$, as required.",
            "answer": "$$\n\\boxed{-2\\pi\\cos(\\theta_{0})}\n$$"
        }
    ]
}