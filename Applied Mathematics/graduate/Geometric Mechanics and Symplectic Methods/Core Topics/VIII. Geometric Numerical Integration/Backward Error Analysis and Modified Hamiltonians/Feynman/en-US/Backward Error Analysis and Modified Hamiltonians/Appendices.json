{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of Hamiltonian mechanics is Liouville's theorem, which states that the phase-space volume is preserved by the flow, a consequence of the Hamiltonian vector field being divergence-free. This practice explores the consequences of violating this principle with a simple numerical method, the explicit Euler integrator. By calculating the divergence of the modified vector field that exactly represents the integrator's steps, you will uncover the mathematical origin of the method's well-known systematic energy drift .",
            "id": "3730726",
            "problem": "Consider the canonical Hamiltonian system on phase space with canonical coordinates $z = (q,p) \\in \\mathbb{R}^{2}$ and standard symplectic matrix\n$$\nJ \\;=\\; \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}.\n$$\nLet the Hamiltonian be\n$$\nH(q,p) \\;=\\; \\tfrac{1}{2}\\,p^{2} \\;+\\; \\tfrac{1}{2}\\,\\omega^{2}\\,q^{2},\n$$\nwith $\\omega \\in \\mathbb{R}$ constant. The associated Hamiltonian vector field is $X_{H}(z) \\,=\\, J \\nabla H(z)$, i.e.,\n$$\n\\dot{q} \\,=\\, p, \n\\qquad\n\\dot{p} \\,=\\,-\\,\\omega^{2}\\,q.\n$$\nApply the explicit Euler method with step size $h>0$ to this system:\n$$\n\\begin{pmatrix} q_{n+1} \\\\[4pt] p_{n+1} \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} q_{n} \\\\[4pt] p_{n} \\end{pmatrix}\n\\;+\\; h \\, X_{H}\\!\\left(\\begin{pmatrix} q_{n} \\\\[4pt] p_{n} \\end{pmatrix}\\right).\n$$\nBackward error analysis seeks a smooth, time-independent modified vector field $\\tilde{X}_{h}(z)$ whose time-$h$ flow agrees exactly with the one-step map of the explicit Euler method. For this linear system, the modified vector field is linear, $\\tilde{X}_{h}(z) \\,=\\, \\tilde{A}_{h}\\, z$ for some matrix $\\tilde{A}_{h}\\in\\mathbb{R}^{2\\times 2}$.\n\nStarting from first principles (canonical Hamiltonian structure, phase-space divergence, linear flow maps, and the matrix exponential/logarithm as the exact time-$h$ flow of linear systems), determine the divergence of the modified vector field, $\\operatorname{div}(\\tilde{X}_{h})$, as an explicit closed-form analytic function of $h$ and $\\omega$.\n\nYou must justify why the modified vector field exists and is linear for this problem, and why its divergence can be computed from the matrix trace, then compute the exact expression. Conclude in your reasoning why a nonzero divergence implies the modified vector field is non-Hamiltonian and corresponds to systematic energy growth or dissipation for this integrator. However, the final reported answer must be only the analytic expression for $\\operatorname{div}(\\tilde{X}_{h})$.\n\nExpress your final answer as a single analytic expression in terms of $h$ and $\\omega$. No units are required. Do not round.",
            "solution": "The problem statement is first subjected to validation.\n\n**Step 1: Extracted Givens**\n- **System**: Canonical Hamiltonian system on phase space with coordinates $z = (q,p) \\in \\mathbb{R}^{2}$.\n- **Symplectic Matrix**: $J = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$.\n- **Hamiltonian**: $H(q,p) = \\frac{1}{2}p^{2} + \\frac{1}{2}\\omega^{2}q^{2}$, with $\\omega \\in \\mathbb{R}$ constant.\n- **Hamiltonian Vector Field**: $X_{H}(z) = J \\nabla H(z)$.\n- **Equations of Motion**: $\\dot{q} = p$, $\\dot{p} = -\\omega^{2}q$.\n- **Numerical Method**: Explicit Euler method with step size $h>0$.\n- **Explicit Euler Map**: $\\begin{pmatrix} q_{n+1} \\\\ p_{n+1} \\end{pmatrix} = \\begin{pmatrix} q_{n} \\\\ p_{n} \\end{pmatrix} + h \\, X_{H}\\!\\left(\\begin{pmatrix} q_{n} \\\\ p_{n} \\end{pmatrix}\\right)$.\n- **Backward Error Analysis**: A time-independent modified vector field $\\tilde{X}_{h}(z)$ is sought whose time-$h$ flow equals the one-step map of the explicit Euler method.\n- **Form of Modified Vector Field**: $\\tilde{X}_{h}(z) = \\tilde{A}_{h} z$ for a matrix $\\tilde{A}_{h}\\in\\mathbb{R}^{2\\times 2}$.\n- **Objective**: Determine the divergence of the modified vector field, $\\operatorname{div}(\\tilde{X}_{h})$, as a closed-form analytic function of $h$ and $\\omega$, with full justification.\n\n**Step 2: Validation Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It is a standard problem in the field of geometric numerical integration and backward error analysis. The system described (the simple harmonic oscillator) is a fundamental model in physics and mathematics. The explicit Euler method is a well-defined numerical scheme. The concept of a modified vector field is central to the theory of numerical integrators. All provided information is consistent, complete, and mathematically sound. No flaws listed in the validation criteria are present.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A detailed solution will be provided.\n\nThe Hamiltonian equations of motion can be written in matrix form. The gradient of the Hamiltonian $H(z)$ is\n$$\n\\nabla H(z) = \\begin{pmatrix} \\frac{\\partial H}{\\partial q} \\\\ \\frac{\\partial H}{\\partial p} \\end{pmatrix} = \\begin{pmatrix} \\omega^{2}q \\\\ p \\end{pmatrix}.\n$$\nThe Hamiltonian vector field $X_H(z) = J \\nabla H(z)$ is then\n$$\nX_H(z) = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\begin{pmatrix} \\omega^{2}q \\\\ p \\end{pmatrix} = \\begin{pmatrix} p \\\\ -\\omega^{2}q \\end{pmatrix}.\n$$\nThis allows us to express the dynamics $\\dot{z} = X_H(z)$ as a linear system $\\dot{z} = A z$, where $z = \\begin{pmatrix} q \\\\ p \\end{pmatrix}$ and the matrix $A$ is\n$$\nA = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix}.\n$$\nThe explicit Euler method with step size $h>0$ advances the system from a state $z_n$ to $z_{n+1}$ according to the rule $z_{n+1} = z_n + h X_H(z_n)$. Substituting the linear form of the vector field, we obtain\n$$\nz_{n+1} = z_n + h A z_n = (I + hA)z_n,\n$$\nwhere $I$ is the $2 \\times 2$ identity matrix. The one-step map of the explicit Euler method is thus a linear transformation represented by the matrix $M_h = I + hA$:\n$$\nM_h = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} + h \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix} = \\begin{pmatrix} 1 & h \\\\ -h\\omega^{2} & 1 \\end{pmatrix}.\n$$\nBackward error analysis asserts the existence of a modified differential equation $\\dot{\\tilde{z}} = \\tilde{X}_h(\\tilde{z})$ whose exact time-$h$ flow map, denoted $\\tilde{\\Phi}_h$, coincides with the one-step numerical map. Since the numerical map $z \\mapsto M_h z$ is linear, the modified vector field $\\tilde{X}_h(z)$ that generates it must also be linear. This justifies the given form $\\tilde{X}_h(z) = \\tilde{A}_h z$ for some matrix $\\tilde{A}_h \\in \\mathbb{R}^{2 \\times 2}$. The existence of such a field is guaranteed as long as the map $M_h$ is sufficiently close to the identity, which is true for small $h$. For a linear system $\\dot{\\tilde{z}} = \\tilde{A}_h \\tilde{z}$, the exact flow at time $h$ is given by the matrix exponential, $\\tilde{\\Phi}_h(z) = \\exp(h\\tilde{A}_h)z$.\nEquating the numerical map and the modified flow gives the fundamental relation:\n$$\nM_h = \\exp(h\\tilde{A}_h).\n$$\nTo find the matrix $\\tilde{A}_h$, we apply the matrix logarithm:\n$$\nh\\tilde{A}_h = \\ln(M_h) \\quad \\implies \\quad \\tilde{A}_h = \\frac{1}{h} \\ln(M_h).\n$$\nThe divergence of a linear vector field $\\tilde{X}_h(z) = \\tilde{A}_h z$ is given by the trace of its defining matrix. Let $\\tilde{X}_h = (\\tilde{X}_q, \\tilde{X}_p)^T$. Then $\\tilde{X}_q = (\\tilde{A}_h)_{11}q + (\\tilde{A}_h)_{12}p$ and $\\tilde{X}_p = (\\tilde{A}_h)_{21}q + (\\tilde{A}_h)_{22}p$. The divergence is:\n$$\n\\operatorname{div}(\\tilde{X}_h) = \\frac{\\partial \\tilde{X}_q}{\\partial q} + \\frac{\\partial \\tilde{X}_p}{\\partial p} = (\\tilde{A}_h)_{11} + (\\tilde{A}_h)_{22} = \\operatorname{tr}(\\tilde{A}_h).\n$$\nOur task reduces to computing the trace of $\\tilde{A}_h$.\n$$\n\\operatorname{div}(\\tilde{X}_h) = \\operatorname{tr}(\\tilde{A}_h) = \\operatorname{tr}\\left(\\frac{1}{h} \\ln(M_h)\\right) = \\frac{1}{h}\\operatorname{tr}(\\ln(M_h)).\n$$\nA fundamental property relating the trace of a matrix logarithm to the determinant is $\\operatorname{tr}(\\ln(B)) = \\ln(\\det(B))$ for any invertible matrix $B$ for which the logarithm is well-defined. We can apply this identity here. First, we compute the determinant of $M_h$:\n$$\n\\det(M_h) = \\det\\begin{pmatrix} 1 & h \\\\ -h\\omega^{2} & 1 \\end{pmatrix} = (1)(1) - (h)(-h\\omega^{2}) = 1 + h^{2}\\omega^{2}.\n$$\nThe eigenvalues of $M_h$ are $1 \\pm i h \\omega$, which lie in the right half complex plane, ensuring the principal branch of the matrix logarithm is well-defined.\nUsing the trace-determinant identity, we find:\n$$\n\\operatorname{tr}(\\ln(M_h)) = \\ln(\\det(M_h)) = \\ln(1 + h^{2}\\omega^{2}).\n$$\nSubstituting this back into the expression for the divergence yields the final result:\n$$\n\\operatorname{div}(\\tilde{X}_h) = \\frac{1}{h}\\ln(1 + h^{2}\\omega^{2}).\n$$\nA vector field $X$ on $\\mathbb{R}^2$ is Hamiltonian if and only if it is divergence-free. This is because if $X$ is Hamiltonian, there exists a function $\\tilde{H}$ such that $X = J \\nabla \\tilde{H} = (\\partial_p \\tilde{H}, -\\partial_q \\tilde{H})^T$. The divergence is $\\operatorname{div}(X) = \\partial_q(\\partial_p \\tilde{H}) + \\partial_p(-\\partial_q \\tilde{H}) = \\frac{\\partial^2 \\tilde{H}}{\\partial q \\partial p} - \\frac{\\partial^2 \\tilde{H}}{\\partial p \\partial q} = 0$, by the equality of mixed partial derivatives.\nFor the modified vector field $\\tilde{X}_h$, we found $\\operatorname{div}(\\tilde{X}_h) = \\frac{1}{h}\\ln(1 + h^{2}\\omega^{2})$. Since $h>0$, the term $h^2\\omega^2$ is non-negative. If $\\omega \\neq 0$, then $h^2\\omega^2 > 0$, which implies $1+h^2\\omega^2 > 1$, and therefore $\\ln(1+h^2\\omega^2) > 0$. Thus, for any non-trivial oscillator ($\\omega \\neq 0$), the divergence is strictly positive. As $\\operatorname{div}(\\tilde{X}_h) \\neq 0$, the modified vector field $\\tilde{X}_h$ is non-Hamiltonian.\nIn the context of phase space dynamics, the divergence of a vector field measures the rate of local volume expansion or contraction. Liouville's theorem states that Hamiltonian flows preserve phase space volume, which is a consequence of the vector field being divergence-free. A positive divergence, as found here, implies that the flow of the modified system continuously expands phase space volume. For the harmonic oscillator, whose energy level sets are ellipses enclosing a certain area (volume in 2D), this volume expansion means that trajectories must spiral outwards, continually crossing to higher energy levels. This corresponds to the well-known systematic energy growth observed when applying the explicit Euler method to an undamped oscillatory system.",
            "answer": "$$\\boxed{\\frac{1}{h}\\ln(1 + h^{2}\\omega^{2})}$$"
        },
        {
            "introduction": "Having seen how non-symplectic methods systematically distort phase-space volume, we now investigate the remarkable properties of symmetric (or time-reversible) integrators. This theoretical exercise reveals the profound structural advantage conferred by symmetry in the context of backward error analysis. You will prove from first principles that for any such method, the modified Hamiltonian contains only even powers of the step size $h$, explaining their excellent long-term energy behavior .",
            "id": "3730760",
            "problem": "Consider an autonomous separable Hamiltonian system with Hamiltonian $H(q,p) = T(p) + V(q)$ on a symplectic manifold, and denote by $L_T$ and $L_V$ the associated Lie derivative operators generating the exact flows of $T$ and $V$, respectively. Define a one-step symplectic splitting integrator with constant step size $h$ by a composition of exact partial flows\n$$\nS_h \\;=\\; \\exp(h a_1 L_T)\\,\\exp(h b_1 L_V)\\,\\exp(h a_2 L_T)\\,\\exp(h b_2 L_V)\\,\\cdots\\,\\exp(h b_s L_V)\\,\\exp(h a_s L_T),\n$$\nwhere $s \\in \\mathbb{N}$ and the real coefficients $a_i$ and $b_i$ are chosen so that the method is palindromic, meaning $a_i = a_{s+1-i}$ and $b_i = b_{s+1-i}$ for all $i = 1,\\dots,s$. Assume further that the composition is consistent with the original system in the sense that the leading-order drift and kick over one step reproduce the exact first-order advance.\n\nBackward error analysis associates to $S_h$ a modified Hamiltonian $\\tilde{H}(h)$, defined as a formal power series in $h$,\n$$\n\\tilde{H}(h) \\;=\\; H \\;+\\; h H_1 \\;+\\; h^2 H_2 \\;+\\; h^3 H_3 \\;+\\; \\cdots,\n$$\nsuch that the numerical map $S_h$ equals the exact time-$h$ flow of $\\tilde{H}(h)$, i.e., $S_h = \\exp\\!\\big(h L_{\\tilde{H}(h)}\\big)$ in the sense of formal Lie series. The Baker–Campbell–Hausdorff (BCH) formula (which expresses the logarithm of a product of exponentials of Lie operators as a Lie series involving nested commutators) provides a fundamental expansion framework to identify the coefficients $H_k$.\n\nLet $r \\in \\mathbb{N}$ be fixed, and focus on the truncated “odd” part of the modified Hamiltonian up to order $h^{2r-1}$,\n$$\n\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h) \\;=\\; \\sum_{j=0}^{r-1} h^{2j+1} H_{2j+1}.\n$$\nStarting from core definitions of Lie flows, the palindromic composition, and the Baker–Campbell–Hausdorff formula, derive from first principles the symmetry constraints on $S_h$ that ensure the self-adjointness property $S_h^{-1} = S_{-h}$. Use these constraints to show that the truncated odd part $\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h)$ must identically vanish. Your response must culminate in the evaluation of the analytic expression for $\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h)$ implied by these conditions.\n\nAnswer format requirement: Provide the single closed-form expression for $\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h)$ as your final answer. No rounding is required and no units are involved. Angles, if any appear, are to be interpreted in radians.",
            "solution": "The problem requires the derivation of an expression for the truncated odd part of the modified Hamiltonian, $\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h)$, for a palindromic symplectic splitting integrator. The derivation will proceed from first principles, establishing the necessary symmetry relations and their consequences for the formal power series defining the modified Hamiltonian.\n\nFirst, let us formalize the structure of the numerical integrator $S_h$. The integrator is given as a composition of exact flows corresponding to the kinetic part $T(p)$ and the potential part $V(q)$ of the Hamiltonian $H = T+V$. Let the Lie derivative operators associated with $T$ and $V$ be denoted by $L_T$ and $L_V$, respectively. A generic splitting method can be written as a composition of elementary flow maps.\n$$\nS_h = \\Psi_m(h) \\circ \\Psi_{m-1}(h) \\circ \\cdots \\circ \\Psi_1(h)\n$$\nwhere each $\\Psi_k(h)$ is an operator of the form $\\exp(h c_k L_A)$, with $A$ being either $T$ or $V$. The problem statement specifies a palindromic method, characterized by coefficient symmetries $a_i = a_{s+1-i}$ and $b_i = b_{s+1-i}$. This implies that the sequence of elementary operators is itself palindromic. That is, if the sequence of operators is $(\\Psi_1, \\Psi_2, \\dots, \\Psi_m)$, then $\\Psi_k = \\Psi_{m+1-k}$ for all $k=1, \\dots, m$. For instance, a method of the form $\\exp(h a_1 L_T)\\exp(h b_1 L_V)\\exp(h a_2 L_T)$ is palindromic if $a_1 = a_2$. The property does not depend on the specific, and somewhat ambiguous, structure given in the prompt, but on this fundamental symmetry. This symmetry is also known as time-reversal symmetry or self-adjointness of the method.\n\nOur first step is to prove that this palindromic property implies the operator identity $S_h^{-1} = S_{-h}$.\nThe inverse of the map $S_h$ is given by the composition of the inverses of its constituent operators in reverse order:\n$$\nS_h^{-1} = (\\Psi_m(h) \\circ \\cdots \\circ \\Psi_1(h))^{-1} = \\Psi_1(h)^{-1} \\circ \\cdots \\circ \\Psi_m(h)^{-1}\n$$\nSince each elementary map is the exponential of a Lie derivative, its inverse is obtained by negating the argument: $\\Psi_k(h)^{-1} = (\\exp(h c_k L_A))^{-1} = \\exp(-h c_k L_A) = \\Psi_k(-h)$. Thus,\n$$\nS_h^{-1} = \\Psi_1(-h) \\circ \\Psi_2(-h) \\circ \\cdots \\circ \\Psi_m(-h)\n$$\nNext, we evaluate the map $S_h$ at step size $-h$:\n$$\nS_{-h} = \\Psi_m(-h) \\circ \\Psi_{m-1}(-h) \\circ \\cdots \\circ \\Psi_1(-h)\n$$\nWe now use the palindromic property, $\\Psi_k = \\Psi_{m+1-k}$. This allows us to re-index the expression for $S_{-h}$. Let $j = m+1-k$. As $k$ runs from $1$ to $m$, $j$ runs from $m$ to $1$.\n$$\nS_{-h} = \\Psi_{m+1-1}(-h) \\circ \\Psi_{m+1-2}(-h) \\circ \\cdots \\circ \\Psi_{m+1-m}(-h) = \\Psi_1(-h) \\circ \\Psi_2(-h) \\circ \\cdots \\circ \\Psi_m(-h)\n$$\nComparing the expressions for $S_h^{-1}$ and $S_{-h}$, we establish the crucial identity for a palindromic method:\n$$\nS_h^{-1} = S_{-h}\n$$\n\nThe second step is to relate this operator identity to the properties of the modified Hamiltonian $\\tilde{H}(h)$. The existence of such a Hamiltonian as a formal power series in $h$ is guaranteed by the Baker–Campbell–Hausdorff (BCH) formula. By definition, the numerical map $S_h$ is the exact time-$h$ flow of $\\tilde{H}(h)$:\n$$\nS_h = \\exp(h L_{\\tilde{H}(h)})\n$$\nWe can express $S_h^{-1}$ and $S_{-h}$ using this definition.\nThe inverse is:\n$$\nS_h^{-1} = \\left( \\exp(h L_{\\tilde{H}(h)}) \\right)^{-1} = \\exp(-h L_{\\tilde{H}(h)})\n$$\nThe map at step size $-h$ is:\n$$\nS_{-h} = \\exp(-h L_{\\tilde{H}(-h)})\n$$\nEquating the two expressions based on our derived symmetry, $S_h^{-1} = S_{-h}$, yields:\n$$\n\\exp(-h L_{\\tilde{H}(h)}) = \\exp(-h L_{\\tilde{H}(-h)})\n$$\nFor formal power series, taking the logarithm is a well-defined operation. Applying it to both sides gives:\n$$\n-h L_{\\tilde{H}(h)} = -h L_{\\tilde{H}(-h)}\n$$\nDividing by $-h$ (for $h \\neq 0$) and using the linearity of the Lie derivative operator ($L_{\\alpha F + \\beta G} = \\alpha L_F + \\beta L_G$), we get:\n$$\nL_{\\tilde{H}(h)} = L_{\\tilde{H}(-h)} \\implies L_{\\tilde{H}(h) - \\tilde{H}(-h)} = 0\n$$\nThis means that the function $\\tilde{H}(h) - \\tilde{H}(-h)$ is a Casimir function of the underlying Poisson structure. For a standard non-degenerate symplectic manifold such as $\\mathbb{R}^{2n}$, the only Casimir functions are constants. Therefore, $\\tilde{H}(h) - \\tilde{H}(-h) = C(h)$ where $C(h)$ is a constant with respect to the phase space variables $(q,p)$. Since adding a constant to a Hamiltonian does not alter the equations of motion, we can set $C(h)=0$ without loss of generality. This leads to the conclusion that the modified Hamiltonian must be an even function of the step size $h$:\n$$\n\\tilde{H}(h) = \\tilde{H}(-h)\n$$\n\nThe third step is to analyze the consequence of this symmetry for the coefficients of the power series expansion of $\\tilde{H}(h)$. The modified Hamiltonian is defined as:\n$$\n\\tilde{H}(h) = \\sum_{k=0}^{\\infty} h^k H_k = H_0 + h H_1 + h^2 H_2 + h^3 H_3 + \\cdots\n$$\nwhere $H_0 = H = T+V$. Replacing $h$ with $-h$ gives:\n$$\n\\tilde{H}(-h) = \\sum_{k=0}^{\\infty} (-h)^k H_k = \\sum_{k=0}^{\\infty} (-1)^k h^k H_k = H_0 - h H_1 + h^2 H_2 - h^3 H_3 + \\cdots\n$$\nThe condition $\\tilde{H}(h) = \\tilde{H}(-h)$ implies:\n$$\n\\sum_{k=0}^{\\infty} h^k H_k = \\sum_{k=0}^{\\infty} (-1)^k h^k H_k\n$$\nBy comparing the coefficients for each power of $h^k$, we must have:\n$$\nH_k = (-1)^k H_k \\quad \\text{for all } k \\ge 0\n$$\nFor even $k=2j$, this equation becomes $H_{2j} = (-1)^{2j} H_{2j} = H_{2j}$, which is always true and places no restriction on the even-order terms.\nFor odd $k=2j+1$, the equation becomes $H_{2j+1} = (-1)^{2j+1} H_{2j+1} = -H_{2j+1}$. This implies $2H_{2j+1} = 0$, and thus:\n$$\nH_{2j+1} = 0 \\quad \\text{for all } j \\ge 0\n$$\nThis demonstrates that for any palindromic splitting method, all odd-order terms in the expansion of its modified Hamiltonian vanish.\n\nFinally, we can evaluate the expression for the truncated odd part of the modified Hamiltonian, $\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h)$. This quantity is defined as:\n$$\n\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h) = \\sum_{j=0}^{r-1} h^{2j+1} H_{2j+1}\n$$\nSince we have rigorously shown that $H_{2j+1} = 0$ for all integers $j \\ge 0$, every term in this finite sum is identically zero.\n$$\n\\tilde{H}_{\\mathrm{odd}}^{(2r-1)}(h) = \\sum_{j=0}^{r-1} h^{2j+1} (0) = 0\n$$\nTherefore, the truncated odd part of the modified Hamiltonian for any palindromic symplectic splitting integrator is identically zero for any choice of $r \\in \\mathbb{N}$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "This final practice provides a capstone experience, bridging the abstract derivation of a modified Hamiltonian with its concrete numerical verification. You will first derive the modified Hamiltonian for the widely-used velocity Verlet algorithm applied to the harmonic oscillator, and then write code to demonstrate its superior conservation properties along a numerical trajectory . This exercise showcases how backward error analysis serves not only as a tool for theoretical understanding but also as a powerful method for practical code validation.",
            "id": "3730728",
            "problem": "You are asked to formalize and implement a protocol for validating a claimed symplectic integrator using backward error analysis. Consider a one-dimensional separable Hamiltonian system in canonical coordinates $(q,p)$ with Hamiltonian $H(q,p) = T(p) + V(q)$, where $T(p)$ and $V(q)$ are smooth functions. For the specific case of the harmonic oscillator, let $T(p) = \\frac{p^2}{2m}$ and $V(q) = \\frac{k q^2}{2}$, where $m$ and $k$ are positive constants. The claimed symplectic integrator is a symmetric second-order splitting (often known as velocity Verlet) obtained by composing half-step potential and full-step kinetic flows. Your tasks are:\n\n1. Starting from foundational principles of geometric mechanics and symplectic methods:\n   - Use the definition of the Hamiltonian vector field, Hamilton’s equations, the Poisson bracket, and the Lie-derivative viewpoint to model the flow generated by $H(q,p)$.\n   - Use the Baker–Campbell–Hausdorff (BCH) expansion of composed Lie flows to derive the modified Hamiltonian $H_{\\text{mod}}(q,p;h)$ for the symmetric second-order splitting up to and including terms of order $O(h^4)$, where $h$ is the timestep of the integrator. Your derivation should reduce to explicit functions of $q$, $p$, $m$, $k$, and $h$ for the harmonic oscillator case.\n   - Explain how the exact flow of $H_{\\text{mod}}(q,p;h)$ to time $h$ approximates the one-step map of the claimed integrator to error $O(h^5)$, and why this implies near-conservation of $H_{\\text{mod}}$ along the discrete trajectory.\n\n2. Implement a program that:\n   - Constructs the explicit expression for $H_{\\text{mod}}(q,p;h)$ for the harmonic oscillator up to $O(h^4)$ as derived in task 1.\n   - Evolves $(q,p)$ using the claimed integrator for $N$ steps, starting from $(q_0,p_0)$.\n   - Evaluates the near-conservation of $H_{\\text{mod}}$ by computing the maximum relative deviation over the discrete trajectory,\n     $$\\Delta_{\\max} = \\max_{0 \\le n \\le N} \\left| \\frac{ H_{\\text{mod}}(q_n,p_n;h) - H_{\\text{mod}}(q_0,p_0;h) }{ H_{\\text{mod}}(q_0,p_0;h) } \\right|,$$\n     and returning a boolean indicating validation success if $\\Delta_{\\max} \\le C h^6$ for a fixed constant $C$ specified below.\n   - For contrast, also evaluate the same criterion when evolving $(q,p)$ using the explicit Euler method applied to Hamilton’s equations to illustrate failure of near-conservation for a non-symplectic scheme.\n\n3. Use the following test suite. Each test case is a tuple $(m,k,h,N,q_0,p_0,\\text{method})$ where $\\text{method} \\in \\{\\text{\"sv\"},\\text{\"euler\"}\\}$ indicates the evolution scheme (symmetric splitting for \"sv\", explicit Euler for \"euler\"). For all test cases, set the constant $C = 100$ in the near-conservation criterion above. No physical units are required for answers; treat all quantities as dimensionless.\n\n   - Test Case 1 (happy path): $(1.0, 1.0, 0.1, 2000, 1.0, 0.0, \\text{\"sv\"})$.\n   - Test Case 2 (different stiffness): $(1.0, 4.0, 0.2, 1500, 1.0, 0.0, \\text{\"sv\"})$.\n   - Test Case 3 (non-symplectic contrast): $(1.0, 1.0, 0.1, 2000, 1.0, 0.0, \\text{\"euler\"})$.\n   - Test Case 4 (different mass and stiffness): $(2.0, 0.5, 0.5, 800, 1.0, 0.0, \\text{\"sv\"})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each result is a boolean corresponding to the validation outcome for the respective test case.",
            "solution": "The supplied problem is assessed for validity before proceeding to a solution.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n\n-   **System**: A one-dimensional separable Hamiltonian system with coordinates $(q,p)$ and Hamiltonian $H(q,p) = T(p) + V(q)$.\n-   **Specific Case (Harmonic Oscillator)**: $T(p) = \\frac{p^2}{2m}$ and $V(q) = \\frac{k q^2}{2}$, where $m$ and $k$ are positive constants.\n-   **Integrator**: A symmetric second-order splitting (velocity Verlet) formed by composing half-step potential and full-step kinetic flows.\n-   **Task 1**: Derive the modified Hamiltonian $H_{\\text{mod}}(q,p;h)$ up to and including terms of order $O(h^4)$ for the harmonic oscillator using the Baker–Campbell–Hausdorff (BCH) expansion. Explain the connection between the exact flow of $H_{\\text{mod}}$ and the integrator's one-step map.\n-   **Task 2**: Implement a program to:\n    -   Construct the explicit $H_{\\text{mod}}(q,p;h)$ up to $O(h^4)$.\n    -   Evolve the system for $N$ steps from $(q_0,p_0)$ using the specified integrator (\"sv\") and the explicit Euler method (\"euler\").\n    -   Compute the maximum relative deviation: $\\Delta_{\\max} = \\max_{0 \\le n \\le N} \\left| \\frac{ H_{\\text{mod}}(q_n,p_n;h) - H_{\\text{mod}}(q_0,p_0;h) }{ H_{\\text{mod}}(q_0,p_0;h) } \\right|$.\n    -   Validate success if $\\Delta_{\\max} \\le C h^6$, where the constant $C$ is specified.\n-   **Task 3 (Test Suite)**:\n    -   Constant: $C = 100$.\n    -   Test Case 1: $(m=1.0, k=1.0, h=0.1, N=2000, q_0=1.0, p_0=0.0, \\text{method}=\\text{\"sv\"})$.\n    -   Test Case 2: $(m=1.0, k=4.0, h=0.2, N=1500, q_0=1.0, p_0=0.0, \\text{method}=\\text{\"sv\"})$.\n    -   Test Case 3: $(m=1.0, k=1.0, h=0.1, N=2000, q_0=1.0, p_0=0.0, \\text{method}=\\text{\"euler\"})$.\n    -   Test Case 4: $(m=2.0, k=0.5, h=0.5, N=800, q_0=1.0, p_0=0.0, \\text{method}=\\text{\"sv\"})$.\n-   **Output Format**: A single line containing a comma-separated list of boolean results enclosed in square brackets.\n\n#### Step 2: Validate Using Extracted Givens\n\n-   **Scientifically Grounded**: The problem is fundamentally based on established principles of geometric mechanics, specifically the theory of symplectic integrators and backward error analysis. The concepts used—Hamiltonian dynamics, Poisson brackets, Lie derivatives, the BCH formula, and splitting methods—are standard and rigorous within mathematics and theoretical physics. The use of the harmonic oscillator as a model system is canonical.\n-   **Well-Posed**: The problem is clearly defined and mathematically tractable. It requests a specific derivation, the implementation of a precise algorithm, and verification against unambiguous test cases with a sharp validation criterion. The existence of a unique and meaningful solution is guaranteed by the structure of the problem. The validation criterion $\\Delta_{\\max} \\le C h^6$ is theoretically justified by the principles of backward error analysis for symmetric integrators.\n-   **Objective**: The problem is stated in precise, technical language, free from any subjectivity, ambiguity, or opinion.\n-   **Completeness**: All necessary information, including physical parameters ($m, k$), numerical parameters ($h, N$), initial conditions ($q_0, p_0$), the constant $C$, and the methods to be tested, is provided. The problem is self-contained.\n-   **Other Flaws**: The problem is free of contradictions, unrealistic assumptions, or any other identifiable flaws listed in the validation checklist. It constitutes a standard, albeit advanced, exercise in computational physics and numerical analysis.\n\n#### Step 3: Verdict and Action\n\nThe problem is **valid**. A full solution will be provided.\n\n### Solution\n\nThe solution is presented in three parts: first, the theoretical derivation of the modified Hamiltonian; second, the principle of its near-conservation; and third, the algorithmic design for its numerical validation.\n\n#### 1. Theoretical Framework and Integrator Definition\n\nA Hamiltonian system evolves according to Hamilton's equations: $\\dot{q} = \\frac{\\partial H}{\\partial p}$ and $\\dot{p} = -\\frac{\\partial H}{\\partial q}$. The evolution of any observable $F(q,p)$ is given by the Lie-derivative formalism: $\\frac{dF}{dt} = \\{F, H\\}$, where $\\{F, G\\} = \\frac{\\partial F}{\\partial q}\\frac{\\partial G}{\\partial p} - \\frac{\\partial F}{\\partial p}\\frac{\\partial G}{\\partial q}$ is the Poisson bracket. The formal solution for the state vector $z=(q,p)$ over a time $t$ is $z(t) = \\exp(t L_H) z(0)$, where $L_G(\\cdot) = \\{\\cdot, G\\}$ is the Lie operator associated with a Hamiltonian $G$.\n\nFor a separable Hamiltonian $H(q,p) = T(p) + V(q)$, the total flow $\\exp(h L_H)$ is intractable. Splitting methods approximate it by composing the exactly solvable flows for $T$ and $V$. The flows are:\n-   $\\phi_t^T = \\exp(t L_T)$: Flow under the kinetic Hamiltonian $T(p)$. Hamilton's equations are $\\dot{q} = T'(p)$ and $\\dot{p}=0$. This yields $(q(t), p(t)) = (q_0 + t T'(p_0), p_0)$.\n-   $\\phi_t^V = \\exp(t L_V)$: Flow under the potential Hamiltonian $V(q)$. Hamilton's equations are $\\dot{q} = 0$ and $\\dot{p}=-V'(q)$. This yields $(q(t), p(t)) = (q_0, p_0 - t V'(q_0))$.\n\nThe specified symmetric second-order splitting integrator (velocity Verlet) is a composition of these exact flows:\n$$ \\Psi_h = \\phi_{h/2}^V \\circ \\phi_h^T \\circ \\phi_{h/2}^V $$\nIn operator form, this corresponds to the map $\\exp(\\frac{h}{2} L_V) \\exp(h L_T) \\exp(\\frac{h}{2} L_V)$. This map advances the system by one timestep $h$.\n\n#### 2. Derivation of the Modified Hamiltonian $H_{\\text{mod}}$\n\nBackward error analysis posits that the numerical map $\\Psi_h$ is the exact time-$h$ flow of a *modified* Hamiltonian, $H_{\\text{mod}}$. We find $H_{\\text{mod}}$ by using the symmetric Baker–Campbell–Hausdorff (BCH) formula, which provides the generator of a composed exponential map. For a composition $\\exp(\\frac{t}{2}X)\\exp(tY)\\exp(\\frac{t}{2}X) = \\exp(Z)$, the generator $Z$ is given by the series:\n$$ Z = t(X+Y) + \\frac{t^3}{24}(2[Y,[Y,X]] - [X,[Y,X]]) + O(t^5) $$\nHere, the operators are $X = L_V$, $Y = L_T$, and the timestep is $t=h$. The commutator of Lie operators corresponds to the Lie operator of their Poisson bracket: $[L_A, L_B] = L_{\\{A,B\\}}$. Substituting this into the BCH formula gives the generator for the integrator's one-step map, $h L_{H_{\\text{mod}}}$:\n$$ h L_{H_{\\text{mod}}} = h(L_V+L_T) + \\frac{h^3}{24}(2L_{\\{T,\\{T,V\\}\\}} - L_{\\{V,\\{T,V\\}\\}}) + O(h^5) $$\nDividing by $h$ and identifying terms, we find the modified Hamiltonian $H_{\\text{mod}} = H + h^2 H_3 + h^4 H_5 + \\dots$, where $H=T+V$. The first correction term is:\n$$ H_3 = \\frac{1}{12}\\{T,\\{T,V\\}\\} + \\frac{1}{24}\\{V,\\{V,T\\}\\} = \\frac{1}{12}\\{T,\\{T,V\\}\\} - \\frac{1}{24}\\{V,\\{T,V\\}\\} $$\nFor the harmonic oscillator, $T(p) = \\frac{p^2}{2m}$ and $V(q) = \\frac{k q^2}{2}$. We compute the required derivatives and Poisson brackets:\n-   $T_p = \\frac{p}{m}$, $T_{pp} = \\frac{1}{m}$, higher derivatives are zero.\n-   $V_q = kq$, $V_{qq} = k$, higher derivatives are zero.\n-   $\\{T,V\\} = -T_p V_q = -(\\frac{p}{m})(kq) = -\\frac{k}{m}pq$.\n-   $\\{T,\\{T,V\\}\\} = \\{T, -\\frac{k}{m}pq\\} = T_p \\frac{\\partial}{\\partial q}(\\frac{k}{m}pq) = (\\frac{p}{m})(\\frac{k}{m}p) = \\frac{k p^2}{m^2}$.\n-   $\\{V,\\{T,V\\}\\} = \\{V, -\\frac{k}{m}pq\\} = -\\frac{\\partial V}{\\partial q}\\frac{\\partial}{\\partial p}(-\\frac{k}{m}pq) = -(kq)(-\\frac{k}{m}q) = \\frac{k^2 q^2}{m}$.\n\nSubstituting these into the expression for $H_3$:\n$$ h^2 H_3 = h^2 \\left( \\frac{1}{12}\\frac{k p^2}{m^2} - \\frac{1}{24}\\frac{k^2 q^2}{m} \\right) $$\nThe derivation of the next term, $h^4 H_5$, is considerably more involved. We state the known result for this splitting method (see, e.g., Hairer, Lubich, Wanner, \"Geometric Numerical Integration\", 2nd ed., p. 81):\n$$ H_{mod} = H + h^2 H_3 + h^4 H_5 + O(h^6) $$\nwhere $H_3$ is as above and\n$$ h^4 H_5 = h^4 \\left( \\frac{1}{360}V_{qqqq}T_p^4 - \\frac{1}{120}V_{qqq}V_q T_p^2 T_{pp} + \\frac{1}{120}V_{qq}^2 T_p^2 T_{pp} + \\frac{1}{240}V_{qq}V_q^2 T_{ppp}T_p - \\frac{1}{576}V_q^4 T_{pppp} \\right) $$\nFor the harmonic oscillator, all terms with $V_{qqq}$, $V_{qqqq}$, $T_{ppp}$, or $T_{pppp}$ vanish. Only the third term survives:\n$$ h^4 H_5 = h^4 \\left( \\frac{1}{120}V_{qq}^2 T_p^2 T_{pp} \\right) = h^4 \\left( \\frac{1}{120}(k)^2 (\\frac{p}{m})^2 (\\frac{1}{m}) \\right) = \\frac{h^4 k^2 p^2}{120 m^3} $$\nThus, the modified Hamiltonian for the harmonic oscillator, truncated at order $O(h^4)$, is:\n$$ H_{\\text{mod}}(q,p;h) = \\left(\\frac{p^2}{2m} + \\frac{kq^2}{2}\\right) + h^2\\left(\\frac{k p^2}{12 m^2} - \\frac{k^2 q^2}{24 m}\\right) + h^4\\left(\\frac{k^2 p^2}{120 m^3}\\right) $$\n\n#### 3. The Principle of Near-Conservation\n\nThe theory of backward error analysis establishes that the numerical trajectory $\\{ (q_n, p_n) \\}_{n \\ge 0}$ generated by a symplectic integrator is a sequence of points lying exactly on the true trajectory of the modified Hamiltonian $H_{\\text{mod}}$. Therefore, $H_{\\text{mod}}$ is an exact invariant of the discrete dynamics: $H_{\\text{mod}}(q_n, p_n)$ is constant for all $n$.\n\nHowever, the full $H_{\\text{mod}}$ is an infinite series in powers of $h$. In practice, we evaluate a *truncated* modified Hamiltonian, $\\tilde{H}_{\\text{mod}}$, such as the one derived above up to $O(h^4)$. This truncated $\\tilde{H}_{\\text{mod}}$ is not exactly conserved by the numerical map $\\Psi_h$. The deviation of $\\tilde{H}_{\\text{mod}}$ is governed by the first term omitted from the series.\nThe numerical map $\\Psi_h$ is the exact flow of $H_{\\text{mod}} = \\tilde{H}_{\\text{mod}} + h^6 H_7 + O(h^8)$. The change in $\\tilde{H}_{\\text{mod}}$ over one step is given by its Lie derivative with respect to the full $H_{\\text{mod}}$:\n$$ \\tilde{H}_{\\text{mod}}(q_{n+1}, p_{n+1}) - \\tilde{H}_{\\text{mod}}(q_n, p_n) \\approx h \\{ \\tilde{H}_{\\text{mod}}, H_{\\text{mod}} \\} \\rvert_{(q_n, p_n)} $$\n$$ \\{ \\tilde{H}_{\\text{mod}}, H_{\\text{mod}} \\} = \\{ \\tilde{H}_{\\text{mod}}, \\tilde{H}_{\\text{mod}} + h^6 H_7 + \\dots \\} = \\{ \\tilde{H}_{\\text{mod}}, h^6 H_7 \\} + O(h^8) = h^6 \\{H, H_7\\} + O(h^8) $$\nThe one-step change is of order $O(h^7)$. Over long times, these small changes accumulate as bounded oscillations. The magnitude of these oscillations is dictated by the size of the first neglected term in the Hamiltonian series, which is $h^6 H_7$. Therefore, the maximum deviation of $\\tilde{H}_{\\text{mod}}$ from its initial value, $\\Delta_{\\max}$, is expected to be of order $O(h^6)$. The validation criterion $\\Delta_{\\max} \\le C h^6$ is a direct numerical test of this fundamental property. Non-symplectic methods like explicit Euler do not possess a nearby conserved modified Hamiltonian, and thus will fail this test decisively.\n\n#### 4. Algorithmic Design\n\nThe program will implement the validation protocol as follows:\n1.  **Modified Hamiltonian Function**: A function `h_mod(q, p, m, k, h)` is defined to compute the value of the derived $H_{\\text{mod}}$ up to order $O(h^4)$.\n2.  **Trajectory Generation**:\n    -   For `method = \"sv\"` (symmetric Verlet), the trajectory is generated iteratively:\n        -   $p_{n+1/2} = p_n - \\frac{h}{2} k q_n$\n        -   $q_{n+1} = q_n + h \\frac{p_{n+1/2}}{m}$\n        -   $p_{n+1} = p_{n+1/2} - \\frac{h}{2} k q_{n+1}$\n    -   For `method = \"euler\"` (explicit Euler), the trajectory is generated as:\n        -   $q_{n+1} = q_n + h \\frac{p_n}{m}$\n        -   $p_{n+1} = p_n - h k q_n$\n3.  **Validation Check**:\n    -   The initial value $H_{\\text{mod}}(q_0,p_0;h)$ is computed.\n    -   The values of $H_{\\text{mod}}(q_n,p_n;h)$ are computed for the entire trajectory.\n    -   The maximum relative deviation, $\\Delta_{\\max}$, is found by taking the maximum of $|\\frac{H_{\\text{mod}}(q_n,p_n;h) - H_{\\text{mod}}(q_0,p_0;h)}{H_{\\text{mod}}(q_0,p_0;h)}|$ over all steps $n = 0, \\dots, N$.\n    -   The result is a boolean value indicating whether $\\Delta_{\\max} \\le 100 h^6$.\n4.  **Main Loop**: The main function iterates through the provided test cases, calls the validation routine for each, and formats the boolean results into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_validation(m, k, h, N, q0, p0, method):\n    \"\"\"\n    Performs backward error analysis validation for a given integrator and parameters.\n\n    Args:\n        m (float): Mass.\n        k (float): Spring constant.\n        h (float): Timestep.\n        N (int): Number of steps.\n        q0 (float): Initial position.\n        p0 (float): Initial momentum.\n        method (str): Integrator type, either \"sv\" (symmetric Verlet) or \"euler\".\n\n    Returns:\n        bool: True if the validation condition is met, False otherwise.\n    \"\"\"\n\n    def h_mod_func(q, p, m_val, k_val, h_val):\n        \"\"\"\n        Computes the modified Hamiltonian for the harmonic oscillator up to O(h^4).\n        H_mod = H + h^2*H_3 + h^4*H_5\n        \"\"\"\n        # H_0 = p^2/(2m) + k*q^2/2\n        term0 = (p**2 / (2 * m_val)) + (k_val * q**2 / 2)\n        \n        # h^2 * H_3 = h^2 * (k*p^2/(12*m^2) - k^2*q^2/(24*m))\n        term2 = h_val**2 * (\n            (k_val * p**2) / (12 * m_val**2) - (k_val**2 * q**2) / (24 * m_val)\n        )\n        \n        # h^4 * H_5 = h^4 * (k^2*p^2/(120*m^3))\n        term4 = h_val**4 * ((k_val**2 * p**2) / (120 * m_val**3))\n        \n        return term0 + term2 + term4\n\n    # Allocate arrays for the trajectory\n    q_traj = np.zeros(N + 1)\n    p_traj = np.zeros(N + 1)\n    q_traj[0], p_traj[0] = q0, p0\n\n    # Generate the trajectory using the specified method\n    if method == \"sv\":\n        # Symmetric splitting (velocity Verlet) integrator\n        for n in range(N):\n            q, p = q_traj[n], p_traj[n]\n            # Half-step update for momentum (V)\n            p_half = p - (h / 2.0) * k * q\n            # Full-step update for position (T)\n            q_next = q + h * p_half / m\n            # Final half-step update for momentum (V)\n            p_next = p_half - (h / 2.0) * k * q_next\n            q_traj[n + 1], p_traj[n + 1] = q_next, p_next\n    elif method == \"euler\":\n        # Explicit Euler integrator\n        for n in range(N):\n            q, p = q_traj[n], p_traj[n]\n            # Update q and p using values from step n\n            q_next = q + h * p / m\n            p_next = p - h * k * q\n            q_traj[n + 1], p_traj[n + 1] = q_next, p_next\n\n    # Evaluate the near-conservation of the modified Hamiltonian\n    h_mod_initial = h_mod_func(q0, p0, m, k, h)\n\n    # Check for division by zero, although not expected with given test cases.\n    if h_mod_initial == 0:\n        h_mod_values = h_mod_func(q_traj, p_traj, m, k, h)\n        # If all values are zero, it's conserved. If any are non-zero, deviation is infinite.\n        return np.all(h_mod_values == 0)\n\n    # Calculate all H_mod values along the trajectory\n    h_mod_values = h_mod_func(q_traj, p_traj, m, k, h)\n    \n    # Compute maximum relative deviation\n    rel_deviations = np.abs((h_mod_values - h_mod_initial) / h_mod_initial)\n    max_rel_dev = np.max(rel_deviations)\n    \n    # Define the validation criterion\n    C = 100.0\n    threshold = C * h**6\n    \n    return max_rel_dev = threshold\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (m, k, h, N, q0, p0, method)\n        (1.0, 1.0, 0.1, 2000, 1.0, 0.0, \"sv\"),\n        (1.0, 4.0, 0.2, 1500, 1.0, 0.0, \"sv\"),\n        (1.0, 1.0, 0.1, 2000, 1.0, 0.0, \"euler\"),\n        (2.0, 0.5, 0.5, 800, 1.0, 0.0, \"sv\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        validation_passes = run_validation(*case)\n        results.append(validation_passes)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}