{
    "hands_on_practices": [
        {
            "introduction": "为了精确模拟受约束的力学系统，数值积分的每一步都必须严格满足系统的几何约束。本练习将引导你探索 SHAKE 算法的核心思想，这是一种经典的投影方法，能将违反约束的预测位置精确地校正回约束流形上。通过为平面单摆这一简单模型推导校正项 ()，你将掌握强制施加完整约束（holonomic constraints）的基本数值技巧。",
            "id": "3767134",
            "problem": "考虑一个质量为 $m$ 的刚性平面单摆，其运动被约束在以原点为中心、半径为 $\\ell$ 的圆上。其笛卡尔位形为 $q=(x,y)$，完整约束为 $g(q)=x^{2}+y^{2}-\\ell^{2}=0$。系统的动力学由拉格朗日量 $L(q,\\dot{q})=\\tfrac{1}{2}m\\,\\dot{q}^{\\mathsf{T}}\\dot{q}-V(q)$ 导出，约束力通过拉格朗日乘子 $\\lambda(t)$引入，使得 $m\\,\\ddot{q}=-\\nabla V(q)+\\lambda(t)\\,\\nabla g(q)$，其中 $g(q)=0$。设 $h>0$ 为一个固定的时间步长，并用 $q_{k}=(x_{k},y_{k})$ 和 $v_{k}=(\\dot{x}_{k},\\dot{y}_{k})$ 表示在时间 $t_{k}$ 时的位置和速度。定义无约束的Störmer–Verlet预测子（也称为速度-Verlet位置预测）\n$$\ns \\equiv q_{k} + h\\,v_{k} + \\frac{h^{2}}{2}\\,a(q_{k}),\n$$\n其中 $a(q)=\\frac{1}{m}\\big(-\\nabla V(q)\\big)$ 是物理加速度场。在SHAKE方法（一种用于完整约束的投影方法）的第一个位置修正阶段，我们寻求一个修正量 $\\Delta q_{k+1}$，使得 $q_{k+1}=s+\\Delta q_{k+1}$ 精确地位于约束流形上，即 $g(q_{k+1})=0$，并且该修正量沿着质量加权的约束梯度方向。对于给定的各向同性质量矩阵和圆形约束，这意味着修正量与预测位置 $s$ 共线。\n\n从第一性原理出发，推导SHAKE位置修正量 $\\Delta q_{k+1}$ 的闭式解析表达式，该表达式确保 $g(q_{k+1})=0$ 精确成立，并直接用 $q_{k}$、$v_{k}$、$h$、$a(q_{k})$ 和 $\\ell$ 表示。你的最终答案必须是 $\\Delta q_{k+1}=\\big(\\Delta x_{k+1},\\Delta y_{k+1}\\big)$ 的显式双分量表达式，形式为一个单行矩阵。不需要进行数值计算，也不需要四舍五入。仅使用上面定义的符号量来表示你的答案，不带单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**第1步：提取已知条件**\n- **系统**：一个刚性平面单摆。\n- **质量**：$m$。\n- **位形**：$q=(x,y)$。\n- **拉格朗日量**：$L(q,\\dot{q})=\\tfrac{1}{2}m\\,\\dot{q}^{\\mathsf{T}}\\dot{q}-V(q)$。\n- **完整约束**：质量被约束在以原点为中心、半径为 $\\ell$ 的圆上运动。约束函数为 $g(q)=x^{2}+y^{2}-\\ell^{2}=0$。\n- **运动方程**：$m\\,\\ddot{q}=-\\nabla V(q)+\\lambda(t)\\,\\nabla g(q)$，其中 $\\lambda(t)$ 是一个拉格朗日乘子。\n- **离散化**：时间步长 $h>0$。在时间 $t_k$ 的状态由位置 $q_{k}=(x_{k},y_{k})$ 和速度 $v_{k}=(\\dot{x}_{k},\\dot{y}_{k})$ 给出。\n- **加速度场**：物理加速度为 $a(q)=\\frac{1}{m}\\big(-\\nabla V(q)\\big)$。\n- **预测步骤**：无约束的预测位置为 $s \\equiv q_{k} + h\\,v_{k} + \\frac{h^{2}}{2}\\,a(q_{k})$。\n- **修正步骤**：修正后的位置为 $q_{k+1}=s+\\Delta q_{k+1}$。\n- **修正条件**：\n    1. 修正后的位置必须满足约束：$g(q_{k+1})=0$。\n    2. 修正向量 $\\Delta q_{k+1}$ 与预测位置向量 $s$ 共线。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据**：该问题设置在几何力学和数值分析的背景下，特别涉及约束系统的保结构积分器（SHAKE算法）。所有概念、方程和定义在计算物理和数学中都是标准的和公认的。\n- **适定性**：该问题提供了一个明确的目标（推导 $\\Delta q_{k+1}$ 的表达式）和一套完整的条件来唯一确定解。修正量与预测位置 $s$ 共线的先验假设是问题陈述的明确部分，对应于SHAKE算法的一个特定变体。\n- **客观性**：该问题使用精确的数学语言表述，没有歧义或主观内容。\n\n**第3步：结论与行动**\n该问题被认为是**有效的**，因为它具有科学依据、适定性、客观性和自包含性。因此，将推导一个完整的解。\n\n### 解题推导\n\n目标是根据所给条件，找到在SHAKE算法中使用的位置修正向量 $\\Delta q_{k+1}$ 的闭式表达式。\n\n在不考虑约束的情况下，时间 $t_{k+1}$ 的预测位置由Störmer-Verlet预测子给出：\n$$\ns = q_{k} + h\\,v_{k} + \\frac{h^{2}}{2}\\,a(q_{k})\n$$\n修正后的位置 $q_{k+1}$ 是通过将修正项 $\\Delta q_{k+1}$ 加到预测子 $s$ 上得到的：\n$$\nq_{k+1} = s + \\Delta q_{k+1}\n$$\n问题陈述了必须满足的两个条件。\n首先，修正向量 $\\Delta q_{k+1}$ 与预测位置向量 $s$ 共线。这可以用数学方式表示为：\n$$\n\\Delta q_{k+1} = \\mu s\n$$\n其中 $\\mu$ 是一个需要确定的标量参数。\n\n将这种形式的修正代入 $q_{k+1}$ 的方程中，得到：\n$$\nq_{k+1} = s + \\mu s = (1+\\mu)s\n$$\n这个关系表明，修正后的位置向量 $q_{k+1}$ 只是预测位置向量 $s$ 的一个缩放版本。\n\n其次，修正后的位置 $q_{k+1}$ 必须位于约束流形上，即半径为 $\\ell$ 的圆。这由约束方程 $g(q_{k+1}) = 0$ 表示。对于给定的圆形约束，这意味着位置向量的范数的平方必须等于 $\\ell^2$：\n$$\n\\|q_{k+1}\\|^2 = \\ell^2\n$$\n将用 $s$ 表示的 $q_{k+1}$ 的表达式代入约束方程：\n$$\n\\|(1+\\mu)s\\|^2 = \\ell^2\n$$\n使用范数的性质 $\\|c\\mathbf{v}\\| = |c|\\|\\mathbf{v}\\|$（其中 $c$ 是标量，$\\mathbf{v}$ 是向量）：\n$$\n(1+\\mu)^2 \\|s\\|^2 = \\ell^2\n$$\n求解 $(1+\\mu)$：\n$$\n(1+\\mu)^2 = \\frac{\\ell^2}{\\|s\\|^2} \\implies 1+\\mu = \\pm \\frac{\\ell}{\\|s\\|}\n$$\nSHAKE修正意在做一个小的调整。对于小的时间步长 $h$，预测位置 $s$ 应该接近约束流形，意味着其范数 $\\|s\\|$ 应该接近 $\\ell$。因此，修正后的位置 $q_{k+1}$ 应该在 $s$ 附近。这意味着缩放因子 $(1+\\mu)$ 应该接近于1且为正。因此，我们选择正根：\n$$\n1+\\mu = \\frac{\\ell}{\\|s\\|}\n$$\n由此，我们可以解出标量参数 $\\mu$：\n$$\n\\mu = \\frac{\\ell}{\\|s\\|} - 1\n$$\n现在我们可以写出修正向量 $\\Delta q_{k+1}$ 的最终表达式：\n$$\n\\Delta q_{k+1} = \\mu s = \\left( \\frac{\\ell}{\\|s\\|} - 1 \\right) s\n$$\n问题要求用初始状态 $(q_k, v_k)$、时间步长 $h$、加速度 $a(q_k)$ 和半径 $\\ell$ 来表示 $\\Delta q_{k+1} = (\\Delta x_{k+1}, \\Delta y_{k+1})$ 的显式双分量表达式。我们定义向量的分量：$q_k = (x_k, y_k)$，$v_k = (\\dot{x}_k, \\dot{y}_k)$，以及 $a(q_k)=(a_x(q_k), a_y(q_k))$。预测向量 $s=(s_x,s_y)$ 的分量是：\n$$\ns_x = x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\n$$\n$$\ns_y = y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\n$$\n$s$ 的范数是 $\\|s\\| = \\sqrt{s_x^2 + s_y^2}$。因此，修正向量 $\\Delta q_{k+1}$ 的分量是：\n$$\n\\Delta x_{k+1} = \\left( \\frac{\\ell}{\\sqrt{s_x^2 + s_y^2}} - 1 \\right) s_x\n$$\n$$\n\\Delta y_{k+1} = \\left( \\frac{\\ell}{\\sqrt{s_x^2 + s_y^2}} - 1 \\right) s_y\n$$\n代入 $s_x$ 和 $s_y$ 的表达式，我们得到修正向量各分量的最终解析表达式。\n第一个分量是：\n$$\n\\Delta x_{k+1} = \\left( \\frac{\\ell}{\\sqrt{\\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)^2 + \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)^2}} - 1 \\right) \\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)\n$$\n第二个分量是：\n$$\n\\Delta y_{k+1} = \\left( \\frac{\\ell}{\\sqrt{\\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)^2 + \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)^2}} - 1 \\right) \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)\n$$\n这些就是SHAKE位置修正的显式双分量表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\left( \\frac{\\ell}{\\sqrt{\\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)^2 + \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)^2}} - 1 \\right) \\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)  \\left( \\frac{\\ell}{\\sqrt{\\left(x_k + h \\dot{x}_k + \\frac{h^2}{2} a_x(q_k)\\right)^2 + \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)^2}} - 1 \\right) \\left(y_k + h \\dot{y}_k + \\frac{h^2}{2} a_y(q_k)\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一个优秀的结构保持积分器，不仅要满足位置约束，还必须精确地处理由其衍生出的速度约束，以保持系统的几何完整性。本练习将从 SHAKE 算法延伸至更完整的 RATTLE 算法，后者在速度 Verlet 格式的框架内，优雅地同时解决了位置与速度的约束问题。通过对一个刚性双原子分子模型执行完整的单步积分 ()，你将深入理解如何同步地保持系统的几何与运动学条件。",
            "id": "3767145",
            "problem": "考虑一个刚性二聚体，它被建模为两个质点，其位置为 $r_1 \\in \\mathbb{R}^2$ 和 $r_2 \\in \\mathbb{R}^2$，动量为 $p_1 \\in \\mathbb{R}^2$ 和 $p_2 \\in \\mathbb{R}^2$。哈密顿量是可分离的，$H(q,p) = T(p) + V(q)$，其中动能为 $T(p) = \\frac{1}{2 m} \\left( |p_1|^2 + |p_2|^2 \\right)$，势能为零 $V(q) = 0$，且质量相等 $m = 1$。该二聚体受单个完整约束\n$$\ng(q) = |r_2 - r_1|^2 - L^2 = 0,\n$$\n其键长固定为 $L = 1$。设时间步长为 $h = \\frac{1}{2}$，使用带约束的可逆积分器（RATTLE算法，一种速度Verlet算法的保约束变体）将状态从时间 $t_k$ 推进一个完整步长至 $t_{k+1} = t_k + h$，同时施加位置约束 $g(q_{k+1}) = 0$ 和速度（隐藏）约束 $\\dot{g}(q_{k+1},p_{k+1}) = 0$。\n\n在无量纲单位下进行计算，其中 $m$、$L$ 和 $h$ 如上所述，因此位置和动量不带物理单位。在时间 $t_k$ 的初始状态为\n$$\nr_1^k = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\quad r_2^k = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad p_1^k = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}, \\quad p_2^k = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}.\n$$\n\n从哈密顿方程和完整约束定义出发，推导此自由刚性二聚体的单步RATTLE更新过程。具体地：\n- 执行无约束的半步动量更新和无约束的位置更新。\n- 通过求解一个标量校正来应用位置校正（SHAKE阶段），该校正施加 $g(q_{k+1}) = 0$ 的约束，同时在质量相等的情况下保持质心位置不变。\n- 通过计算并沿约束方向应用动量校正（冲量）来在 $t_{k+1}$ 施加速度约束，使得 $(r_2^{k+1} - r_1^{k+1}) \\cdot \\left( \\frac{p_2^{k+1}}{m} - \\frac{p_1^{k+1}}{m} \\right) = 0$。\n\n计算 $r_1^{k+1}$、$r_2^{k+1}$、$p_1^{k+1}$ 和 $p_2^{k+1}$ 的精确分量，并将最终答案表示为一个包含八个条目的单行矩阵\n$$\nx_1^{k+1}, \\ y_1^{k+1}, \\ x_2^{k+1}, \\ y_2^{k+1}, \\ p_{1x}^{k+1}, \\ p_{1y}^{k+1}, \\ p_{2x}^{k+1}, \\ p_{2y}^{k+1}.\n$$\n不要四舍五入；以指定单位提供精确解析值。",
            "solution": "用户希望使用RATTLE算法求出刚性二聚体在一个时间步长后的状态。\n\n### 步骤1：提取已知条件\n- **系统**：一个由两个质点组成的刚性二聚体。\n- **位置**：$r_1 \\in \\mathbb{R}^2$，$r_2 \\in \\mathbb{R}^2$。令 $q=(r_1, r_2)$。\n- **动量**：$p_1 \\in \\mathbb{R}^2$，$p_2 \\in \\mathbb{R}^2$。令 $p=(p_1, p_2)$。\n- **质量**：$m_1 = m_2 = m = 1$。\n- **哈密顿量**：$H(q,p) = T(p) + V(q)$。\n- **动能**：$T(p) = \\frac{1}{2 m} \\left( |p_1|^2 + |p_2|^2 \\right)$。\n- **势能**：$V(q) = 0$。\n- **完整约束**：$g(q) = |r_2 - r_1|^2 - L^2 = 0$。\n- **键长**：$L = 1$。\n- **时间步长**：$h = \\frac{1}{2}$。\n- **时间 $t_k$ 时的初始状态**：\n    -   $r_1^k = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\n    -   $r_2^k = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$\n    -   $p_1^k = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$\n    -   $p_2^k = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$\n- **任务**：计算在时间 $t_{k+1}=t_k+h$ 时的状态 $(r_1^{k+1}, r_2^{k+1}, p_1^{k+1}, p_2^{k+1})$。\n- **算法**：RATTLE（带约束的可逆积分器）。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题是RATTLE算法的标准应用，RATTLE算法是几何力学和分子动力学领域中一种成熟的保结构数值积分器。使用哈密顿框架和完整约束是经典力学的基础。该设置在科学上是合理的。\n2.  **良态性**：该问题为确定性算法提供了一套完整的初始条件。算法的步骤定义明确。预期将得到一个关于下一时间步状态的唯一、稳定且有意义的解。\n3.  **客观性**：该问题是用精确的数学语言表述的，没有任何主观或模棱两可的术语。\n4.  **完整性**：所有必要的参数（$m, L, h$）和初始条件都已提供。势能为零是对自由二聚体的有效简化。我们可以验证初始状态满足约束条件：\n    - 位置约束：$g(q_k) = |r_2^k - r_1^k|^2 - L^2 = |\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}|^2 - 1^2 = 1 - 1 = 0$。满足。\n    - 速度（隐藏）约束：$\\dot{g}(q,p) = \\frac{d}{dt}g(q) = \\nabla_q g(q) \\cdot \\dot{q} = \\nabla_q g(q) \\cdot (M^{-1} p) = 0$。约束的梯度为 $\\nabla_q g(q) = (\\nabla_{r_1} g, \\nabla_{r_2} g) = (-2(r_2-r_1), 2(r_2-r_1))$。在 $t_k$ 时，$r_2^k - r_1^k = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。所以 $\\nabla_q g(q_k) = ( \\begin{pmatrix} -2 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix})$。在 $t_k$ 时的速度约束为 $\\begin{pmatrix} -2 \\\\ 0 \\end{pmatrix} \\cdot \\frac{p_1^k}{m} + \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix} \\cdot \\frac{p_2^k}{m} = \\begin{pmatrix} -2 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = 0 + 0 = 0$。满足。\n5.  **结论**：该问题是有效的。\n\n### 步骤3：判断与行动\n该问题有效。我们继续求解。\n\n### 求解\n\nRATTLE算法是速度Verlet算法的一种变体，适用于完整约束。对于一个具有哈密顿量 $H = T(p) + V(q)$ 和约束 $g(q)=0$ 的系统，从 $t_k$ 到 $t_{k+1}$ 的一个步长按如下方式进行：\n\n1.  **第一个动量半步**：\n    $p_{k+1/2} = p_k - \\frac{h}{2} \\nabla_q V(q_k)$\n    由于势能 $V(q) = 0$，其梯度 $\\nabla_q V(q_k)$ 为零。\n    $p_{k+1/2} = p_k$。\n    因此，$p_{1, k+1/2} = p_1^k = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$ 且 $p_{2, k+1/2} = p_2^k = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n\n2.  **无约束的位置全步**：\n    我们计算在没有约束力的情况下会达到的位置 $q_{k+1}^* = (r_{1,k+1}^*, r_{2,k+1}^*)$。\n    $r_{1, k+1}^* = r_1^k + h \\frac{p_{1, k+1/2}}{m} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\frac{1}{2} \\cdot \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1/2 \\end{pmatrix}$。\n    $r_{2, k+1}^* = r_2^k + h \\frac{p_{2, k+1/2}}{m} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\frac{1}{2} \\cdot \\frac{1}{1} \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1/2 \\end{pmatrix}$。\n\n3.  **位置约束校正 (SHAKE)**：\n    我们校正位置以满足 $g(q_{k+1}) = 0$。由于更新必须保持质心不变（对于相等质量），我们可以使用相对坐标 $\\Delta r = r_2 - r_1$。无约束的相对位置是：\n    $\\Delta r_{k+1}^* = r_{2, k+1}^* - r_{1, k+1}^* = \\begin{pmatrix} 1 \\\\ -1/2 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 1/2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n    该向量的长度是 $|\\Delta r_{k+1}^*| = \\sqrt{1^2 + (-1)^2} = \\sqrt{2}$。\n    校正后的相对位置向量 $\\Delta r_{k+1}$ 必须长度为 $L=1$，并且应该是约束流形上最接近 $\\Delta r_{k+1}^*$ 的向量。这通过缩放实现：\n    $\\Delta r_{k+1} = \\frac{L}{|\\Delta r_{k+1}^*|} \\Delta r_{k+1}^* = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix}$。\n    质心必须保持不变。无约束的质心是：\n    $R_{CM}^* = \\frac{m_1 r_{1,k+1}^* + m_2 r_{2,k+1}^*}{m_1+m_2} = \\frac{1}{2}\\left( \\begin{pmatrix} 0 \\\\ 1/2 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ -1/2 \\end{pmatrix} \\right) = \\begin{pmatrix} 1/2 \\\\ 0 \\end{pmatrix}$。\n    最终位置通过将相对向量 $\\Delta r_{k+1}$ 分布在质心 $R_{CM}^*$ 周围来找到：\n    $r_{1, k+1} = R_{CM}^* - \\frac{1}{2}\\Delta r_{k+1} = \\begin{pmatrix} 1/2 \\\\ 0 \\end{pmatrix} - \\frac{1}{2}\\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} - \\frac{\\sqrt{2}}{4} \\\\ \\frac{\\sqrt{2}}{4} \\end{pmatrix}$。\n    $r_{2, k+1} = R_{CM}^* + \\frac{1}{2}\\Delta r_{k+1} = \\begin{pmatrix} 1/2 \\\\ 0 \\end{pmatrix} + \\frac{1}{2}\\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2} + \\frac{\\sqrt{2}}{4} \\\\ -\\frac{\\sqrt{2}}{4} \\end{pmatrix}$。\n\n4.  **动量更新和速度约束**：\n    动量的第二个半步是 $p_{k+1}^* = p_{k+1/2} - \\frac{h}{2}\\nabla_q V(q_{k+1})$。同样，由于 $V=0$，我们有 $p_{k+1}^* = p_{k+1/2} = p_k$。\n    所以，$p_{1,k+1}^* = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$ 且 $p_{2,k+1}^* = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n    接下来，我们施加一个冲量来强制执行速度约束 $\\dot{g}(q_{k+1}, p_{k+1}) = 0$。最终动量由 $p_{k+1} = p_{k+1}^* - \\mu \\nabla_q g(q_{k+1})$ 给出，其中 $\\mu$ 是某个拉格朗日乘子。速度约束为 $\\nabla_q g(q_{k+1}) \\cdot (M^{-1} p_{k+1}) = 0$。\n    代入 $p_{k+1}$ 的表达式，我们求解 $\\mu$：\n    $\\mu = \\frac{\\nabla_q g(q_{k+1}) \\cdot (M^{-1} p_{k+1}^*)}{\\nabla_q g(q_{k+1}) \\cdot (M^{-1} \\nabla_q g(q_{k+1}))}$。\n    让我们计算各项：\n    _梯度_：$\\nabla_q g(q_{k+1}) = (-2\\Delta r_{k+1}, 2\\Delta r_{k+1})$。\n    $\\Delta r_{k+1} = \\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix}$。\n    $\\nabla_{r_1} g = -2 \\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix} = \\begin{pmatrix} -\\sqrt{2} \\\\ \\sqrt{2} \\end{pmatrix}$。\n    $\\nabla_{r_2} g = 2 \\begin{pmatrix} \\frac{\\sqrt{2}}{2} \\\\ -\\frac{\\sqrt{2}}{2} \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2} \\\\ -\\sqrt{2} \\end{pmatrix}$。\n    _分子_：$\\nabla_q g \\cdot (M^{-1} p^*) = \\frac{1}{m}(\\nabla_{r_1} g \\cdot p_{1,k+1}^* + \\nabla_{r_2} g \\cdot p_{2,k+1}^*)$。当 $m=1$时：\n    $\\begin{pmatrix} -\\sqrt{2} \\\\ \\sqrt{2} \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} \\sqrt{2} \\\\ -\\sqrt{2} \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\sqrt{2} + \\sqrt{2} = 2\\sqrt{2}$。\n    _分母_：$\\nabla_q g \\cdot (M^{-1} \\nabla_q g) = \\frac{1}{m}(|\\nabla_{r_1} g|^2 + |\\nabla_{r_2} g|^2)$。当 $m=1$时：\n    $|\\begin{pmatrix} -\\sqrt{2} \\\\ \\sqrt{2} \\end{pmatrix}|^2 + |\\begin{pmatrix} \\sqrt{2} \\\\ -\\sqrt{2} \\end{pmatrix}|^2 = (2+2) + (2+2) = 8$。\n    _乘子_：$\\mu = \\frac{2\\sqrt{2}}{8} = \\frac{\\sqrt{2}}{4}$。\n    现在我们求最终动量：\n    $p_{1, k+1} = p_{1, k+1}^* - \\mu \\nabla_{r_1} g = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} - \\frac{\\sqrt{2}}{4} \\begin{pmatrix} -\\sqrt{2} \\\\ \\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} - \\begin{pmatrix} -2/4 \\\\ 2/4 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} - \\begin{pmatrix} -1/2 \\\\ 1/2 \\end{pmatrix} = \\begin{pmatrix} 1/2 \\\\ 1/2 \\end{pmatrix}$。\n    $p_{2, k+1} = p_{2, k+1}^* - \\mu \\nabla_{r_2} g = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} - \\frac{\\sqrt{2}}{4} \\begin{pmatrix} \\sqrt{2} \\\\ -\\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} - \\begin{pmatrix} 2/4 \\\\ -2/4 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} - \\begin{pmatrix} 1/2 \\\\ -1/2 \\end{pmatrix} = \\begin{pmatrix} -1/2 \\\\ -1/2 \\end{pmatrix}$。\n\n### 最终状态\n在时间 $t_{k+1}$ 的状态是：\n$r_1^{k+1} = \\begin{pmatrix} \\frac{1}{2} - \\frac{\\sqrt{2}}{4} \\\\ \\frac{\\sqrt{2}}{4} \\end{pmatrix}$\n$r_2^{k+1} = \\begin{pmatrix} \\frac{1}{2} + \\frac{\\sqrt{2}}{4} \\\\ -\\frac{\\sqrt{2}}{4} \\end{pmatrix}$\n$p_1^{k+1} = \\begin{pmatrix} 1/2 \\\\ 1/2 \\end{pmatrix}$\n$p_2^{k+1} = \\begin{pmatrix} -1/2 \\\\ -1/2 \\end{pmatrix}$\n\n最终答案的分量是：\n$x_1^{k+1} = \\frac{1}{2} - \\frac{\\sqrt{2}}{4}$\n$y_1^{k+1} = \\frac{\\sqrt{2}}{4}$\n$x_2^{k+1} = \\frac{1}{2} + \\frac{\\sqrt{2}}{4}$\n$y_2^{k+1} = -\\frac{\\sqrt{2}}{4}$\n$p_{1x}^{k+1} = \\frac{1}{2}$\n$p_{1y}^{k+1} = \\frac{1}{2}$\n$p_{2x}^{k+1} = -\\frac{1}{2}$\n$p_{2y}^{k+1} = -\\frac{1}{2}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2} - \\frac{\\sqrt{2}}{4}  \\frac{\\sqrt{2}}{4}  \\frac{1}{2} + \\frac{\\sqrt{2}}{4}  -\\frac{\\sqrt{2}}{4}  \\frac{1}{2}  \\frac{1}{2}  -\\frac{1}{2}  -\\frac{1}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在约束动力学中，拉格朗日乘子并非纯粹的数学工具，它蕴含着深刻的物理意义——即维持约束所需的力。本练习将深入剖析这一概念，要求你为一个同时受内力（弹簧）与运动学效应影响的系统推导瞬时拉格朗日乘子 ()。通过将其分解，你将学会辨析约束力中用于平衡内力的部分和用于提供向心加速度的部分，从而搭建起抽象算法与具体物理现实之间的桥梁。",
            "id": "3767149",
            "problem": "考虑两个质量均为 $m$ 的相同质点，在平面内运动，其构型为 $q = (r_{1}, r_{2}) \\in \\mathbb{R}^{2} \\times \\mathbb{R}^{2}$，由一个刚度系数为 $k$、静止长度为 $\\ell_{0}$ 的线性弹簧连接。施加完整距离约束，使它们的间距固定为 $L$，即约束函数为 $\\phi(q) = |r_{1} - r_{2}|^{2} - L^{2} = 0$。拉格朗日量为 $T - V$，其中动能为 $T = \\tfrac{1}{2} m \\left(|\\dot{r}_{1}|^{2} + |\\dot{r}_{2}|^{2}\\right)$，势能为 $V = \\tfrac{1}{2} k \\left(|r_{1} - r_{2}| - \\ell_{0}\\right)^{2}$。约束动力学由 Lagrange-d’Alembert 方程给出，其中标量拉格朗日乘子 $\\lambda$ 强制执行 $\\phi(q)=0$，因此广义约束力为 $G(q)^{\\top} \\lambda$，其中 $G(q) = \\nabla_{q} \\phi(q)$。\n\n在某一瞬间 $t_{0}$，假设构型满足 $|r_{1}(t_{0}) - r_{2}(t_{0})| = L$，且相对速度 $v = \\dot{r}_{1}(t_{0}) - \\dot{r}_{2}(t_{0})$ 非零且纯切向于约束圆，即 $(r_{1}(t_{0}) - r_{2}(t_{0})) \\cdot v = 0$。你可以假设一个惯性系，在该惯性系中，$t_{0}$ 时刻的质心速度为零，因此 $v$ 完全描述了那一瞬间的相对运动。\n\n仅使用完整约束的拉格朗日乘子原理以及对时间微分的约束条件，以 $m$、$k$、$L$、$\\ell_{0}$ 和 $|v|$ 为变量，用闭合形式推导拉格朗日乘子 $\\lambda(t_{0})$ 的瞬时值。然后，从拉伸与压缩约束反力的角度以及切向速度的贡献，简要解释你结果的符号和大小。将你的最终答案以一个单一闭合形式的解析表达式提供，使用符号 $m$、$k$、$L$、$\\ell_{0}$ 和 $|v|$。不要在最终答案框中包含单位。",
            "solution": "首先根据指定标准对问题进行验证。\n\n**步骤1：提取已知条件**\n- **系统**：两个相同的质点，质量均为 $m$。\n- **构型**：$q = (r_{1}, r_{2}) \\in \\mathbb{R}^{2} \\times \\mathbb{R}^{2}$。\n- **动能**：$T = \\tfrac{1}{2} m \\left(|\\dot{r}_{1}|^{2} + |\\dot{r}_{2}|^{2}\\right)$。\n- **势能**：$V = \\tfrac{1}{2} k \\left(|r_{1} - r_{2}| - \\ell_{0}\\right)^{2}$，其中弹簧刚度系数为 $k$，静止长度为 $\\ell_{0}$。\n- **完整约束**：$\\phi(q) = |r_{1} - r_{2}|^{2} - L^{2} = 0$。\n- **运动方程**：Lagrange-d’Alembert 方程，其中 $\\lambda$ 为拉格朗日乘子，广义约束力为 $G(q)^{\\top} \\lambda$，且 $G(q) = \\nabla_{q} \\phi(q)$。\n- **$t_{0}$ 时刻的条件**：\n    - 约束被满足：$|r_{1}(t_{0}) - r_{2}(t_{0})| = L$。\n    - 相对速度为 $v = \\dot{r}_{1}(t_{0}) - \\dot{r}_{2}(t_{0})$。\n    - 相对速度非零且为切向：$v \\neq 0$ 且 $(r_{1}(t_{0}) - r_{2}(t_{0})) \\cdot v = 0$。\n    - $t_{0}$ 时刻质心速度为零。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据、提法恰当且客观。它描述了经典约束动力学中的一个标准问题，使用了拉格朗日力学的基本原理。所有术语都有正式定义，所提供的数据自洽且足以确定所求量，语言精确。该问题是分析力学中的一个有效练习。\n\n**步骤3：结论与行动**\n问题有效。将提供完整解答。\n\n**拉格朗日乘子的推导**\n\n约束系统的动力学由 Lagrange-d’Alembert 方程决定：\n$$ \\frac{d}{dt}\\frac{\\partial (T-V)}{\\partial \\dot{q}_i} - \\frac{\\partial (T-V)}{\\partial q_i} = F_{c,i} $$\n其中 $F_c = G(q)^{\\top} \\lambda$ 是广义约束力。对于坐标 $r_1$ 和 $r_2$，运动方程为：\n$$ m \\ddot{r}_1 = -\\nabla_{r_1} V + (\\nabla_{r_1} \\phi) \\lambda $$\n$$ m \\ddot{r}_2 = -\\nabla_{r_2} V + (\\nabla_{r_2} \\phi) \\lambda $$\n\n令相对位置向量为 $\\Delta r = r_1 - r_2$。势能 $V$ 仅依赖于 $|\\Delta r|$。$V$ 对 $r_1$ 的梯度为：\n$$ \\nabla_{r_1} V = \\frac{\\partial V}{\\partial |\\Delta r|} \\frac{\\partial |\\Delta r|}{\\partial r_1} = k(|\\Delta r| - \\ell_{0}) \\frac{\\Delta r}{|\\Delta r|} $$\n类似地，$\\nabla_{r_2} V = -\\nabla_{r_1} V$。\n\n约束函数为 $\\phi(q) = |\\Delta r|^2 - L^2 = \\Delta r \\cdot \\Delta r - L^2$。其梯度为：\n$$ \\nabla_{r_1} \\phi = 2(r_1 - r_2) = 2 \\Delta r $$\n$$ \\nabla_{r_2} \\phi = 2(r_2 - r_1) = -2 \\Delta r $$\n系统上的总约束力为 $G(q)^\\top \\lambda$，这对应于作用在质量 1 上的力 $2\\lambda \\Delta r$ 和作用在质量 2 上的力 $-2\\lambda \\Delta r$。\n\n将这些代入运动方程：\n$$ m \\ddot{r}_1 = -k(|\\Delta r| - \\ell_{0}) \\frac{\\Delta r}{|\\Delta r|} + 2 \\lambda \\Delta r $$\n$$ m \\ddot{r}_2 = +k(|\\Delta r| - \\ell_{0}) \\frac{\\Delta r}{|\\Delta r|} - 2 \\lambda \\Delta r $$\n\n为了找到拉格朗日乘子 $\\lambda$ 的方程，我们构建一个关于相对加速度 $\\ddot{v}_{rel} = \\ddot{r}_1 - \\ddot{r}_2$ 的方程。将第二个方程从第一个方程中减去，得到：\n$$ m(\\ddot{r}_1 - \\ddot{r}_2) = -2k(|\\Delta r| - \\ell_{0}) \\frac{\\Delta r}{|\\Delta r|} + 4 \\lambda \\Delta r $$\n$$ m \\ddot{v}_{rel} = \\left( 4\\lambda - \\frac{2k(|\\Delta r| - \\ell_{0})}{|\\Delta r|} \\right) \\Delta r $$\n\n$\\lambda$ 的值是通过确保运动在任何时候都满足约束来确定的。这通过要求约束方程的二阶时间导数为零来实现。约束为 $\\phi(q) = |\\Delta r|^2 - L^2 = 0$。\n一阶时间导数给出了速度层级的约束：\n$$ \\dot{\\phi} = \\frac{d}{dt} \\left( \\Delta r \\cdot \\Delta r - L^2 \\right) = 2 \\Delta r \\cdot \\dot{\\Delta r} = 2 \\Delta r \\cdot v = 0 $$\n问题陈述确认了此条件在 $t=t_0$ 时成立。\n二阶时间导数给出了加速度层级的约束：\n$$ \\ddot{\\phi} = \\frac{d}{dt} (2 \\Delta r \\cdot v) = 2 (\\dot{\\Delta r} \\cdot v + \\Delta r \\cdot \\dot{v}) = 0 $$\n$$ \\ddot{\\phi} = 2 (v \\cdot v + \\Delta r \\cdot \\ddot{v}_{rel}) = 2 ( |v|^2 + \\Delta r \\cdot \\ddot{v}_{rel} ) = 0 $$\n这意味着动力学必须满足一个关键关系：\n$$ \\Delta r \\cdot \\ddot{v}_{rel} = -|v|^2 $$\n该方程表明，相对加速度在分离向量上的投影必须为相对切向运动提供必要的向心加速度。\n\n现在我们可以通过将相对运动方程与 $\\Delta r$ 做点积来求得 $\\lambda$：\n$$ m (\\Delta r \\cdot \\ddot{v}_{rel}) = \\left( 4\\lambda - \\frac{2k(|\\Delta r| - \\ell_{0})}{|\\Delta r|} \\right) (\\Delta r \\cdot \\Delta r) $$\n$$ m (\\Delta r \\cdot \\ddot{v}_{rel}) = \\left( 4\\lambda - \\frac{2k(|\\Delta r| - \\ell_{0})}{|\\Delta r|} \\right) |\\Delta r|^2 $$\n\n现在，我们使用已知条件 $|r_1(t_0) - r_2(t_0)| = |\\Delta r(t_0)| = L$ 和 $\\Delta r(t_0) \\cdot \\ddot{v}_{rel}(t_0) = -|v|^2$ 来计算在 $t_0$ 时刻此表达式的值。\n$$ m(-|v|^2) = \\left( 4\\lambda(t_0) - \\frac{2k(L - \\ell_{0})}{L} \\right) L^2 $$\n求解 $\\lambda(t_0)$：\n$$ -\\frac{m|v|^2}{L^2} = 4\\lambda(t_0) - \\frac{2k(L - \\ell_{0})}{L} $$\n$$ 4\\lambda(t_0) = \\frac{2k(L - \\ell_{0})}{L} - \\frac{m|v|^2}{L^2} $$\n$$ \\lambda(t_0) = \\frac{k(L - \\ell_{0})}{2L} - \\frac{m|v|^2}{4L^2} $$\n\n**结果的解释**\n\n拉格朗日乘子 $\\lambda$ 决定了约束力的大小和性质。作用在质量 1 上的约束力为 $F_{c,1} = 2\\lambda \\Delta r$。\n- 如果 $\\lambda  0$，力 $F_{c,1}$ 沿 $\\Delta r = r_1 - r_2$ 向外。约束将两个质点推开，表示一个**压缩**反力。\n- 如果 $\\lambda  0$，力 $F_{c,1}$ 向内，与 $\\Delta r$ 方向相反。约束将两个质点拉近，表示一个**拉伸**反力。\n\n推导出的 $\\lambda(t_0)$ 表达式包含两个具有不同物理来源的项：\n1.  $\\lambda_{spring} = \\frac{k(L - \\ell_{0})}{2L}$：此项源于内部弹簧力。\n    - 如果 $L  \\ell_{0}$，弹簧被拉伸并试图将质点拉近。为保持距离 $L$，约束必须将它们推开，导致一个压缩反力（$\\lambda_{spring}  0$）。\n    - 如果 $L  \\ell_{0}$，弹簧被压缩并试图将质点推开。约束必须将它们拉近，导致一个拉伸反力（$\\lambda_{spring}  0$）。\n2.  $\\lambda_{kinetic} = -\\frac{m|v|^2}{4L^2}$：此项源于相对切向速度 $|v|$。它总是不为正。切向运动产生一种试图将质点拉开的“离心”效应。约束必须提供一个相反的拉伸力，以为相对圆周运动提供必要的向心加速度。这个拉伸贡献的大小随质量 $m$ 和相对速率的平方 $|v|^2$ 的增加而增加。\n\n$\\lambda$ 的总符号和大小取决于弹簧状态（拉伸/压缩）和切向运动的动力学效应之间的平衡。拉伸的弹簧有助于产生压缩力，而相对运动总是会产生拉伸力。",
            "answer": "$$ \\boxed{\\frac{k(L - \\ell_{0})}{2L} - \\frac{m |v|^2}{4L^2}} $$"
        }
    ]
}