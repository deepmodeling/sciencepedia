{
    "hands_on_practices": [
        {
            "introduction": "This first exercise is designed to build the theory of variational integrators from the ground up. By starting with a simple one-dimensional system, you will practice the essential steps of discretizing a continuous Lagrangian and deriving the discrete equations of motion. This practice culminates in a formal proof of symplecticity, revealing the fundamental structure-preserving nature of this approach .",
            "id": "3758398",
            "problem": "Consider a mechanical system with configuration manifold $Q = \\mathbb{R}$, mass parameter $m > 0$, and smooth potential function $V: \\mathbb{R} \\rightarrow \\mathbb{R}$. The continuous Lagrangian is $L(q,\\dot{q}) = \\tfrac{1}{2} m \\dot{q}^{2} - V(q)$. Let $t_{k}$ denote discrete times with fixed step $h > 0$ and sample values $q_{k} \\in \\mathbb{R}$. Starting from the principle of stationary action and the standard definition of a discrete action sum, construct a discrete Lagrangian $L_{d}(q_{k}, q_{k+1}, h)$ by approximating the action on $[t_{k}, t_{k+1}]$ under the following modeling assumptions:\n- Assume $q(t)$ is the unique linear interpolant joining $(t_{k}, q_{k})$ and $(t_{k+1}, q_{k+1})$.\n- Approximate the integral of the potential energy on $[t_{k}, t_{k+1}]$ using the trapezoidal rule.\nDefine the discrete action $S_{d} = \\sum_{k=0}^{N-1} L_{d}(q_{k}, q_{k+1}, h)$ and derive the Discrete Euler-Lagrange (DEL) equations by requiring stationarity of $S_{d}$ with respect to variations of $\\{q_{k}\\}_{k=1}^{N-1}$ with fixed endpoints. Then, introduce the discrete Legendre transforms $p_{k}^{-} := - D_{1} L_{d}(q_{k}, q_{k+1}, h)$ and $p_{k}^{+} := D_{2} L_{d}(q_{k-1}, q_{k}, h)$, and enforce the momentum matching $p_{k}^{-} = p_{k}^{+}$ to obtain the one-step update map $(q_{k}, p_{k}) \\mapsto (q_{k+1}, p_{k+1})$. Prove that this map is symplectic in the sense that it preserves the canonical symplectic form on $T^{*}\\mathbb{R}$.\n\nFinally, specialize to the harmonic oscillator with $V(q) = \\tfrac{1}{2} k q^{2}$, where $k > 0$, and write the resulting one-step map explicitly as closed-form expressions for $q_{k+1}$ and $p_{k+1}$ in terms of $q_{k}$, $p_{k}$, $m$, $k$, and $h$. Your final answer must be a single analytical expression consisting of the two update formulas concatenated as a row matrix. No rounding is required and no units should be included in the final answer.",
            "solution": "The problem statement is a valid exercise in the field of geometric mechanics, specifically concerning the construction of variational integrators. It is scientifically grounded in the principles of stationary action from analytical mechanics and uses standard numerical approximation techniques. The problem is well-posed, with a clear and unambiguous set of instructions that lead to a unique solution. All terms are formally defined, and the task proceeds logically from general principles to a specific application. Therefore, we proceed with the solution.\n\nThe solution is structured in four parts as requested by the problem statement:\n1.  Construction of the discrete Lagrangian $L_d$.\n2.  Derivation of the Discrete Euler-Lagrange (DEL) equations.\n3.  Definition of the one-step map and proof of its symplecticity.\n4.  Specialization to the harmonic oscillator to find the explicit map.\n\n_Part 1: Construction of the Discrete Lagrangian_\n\nThe continuous action on the time interval $[t_k, t_{k+1}]$ is given by the integral of the Lagrangian:\n$$S_{k, k+1} = \\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) dt = \\int_{t_k}^{t_{k+1}} \\left( \\frac{1}{2} m \\dot{q}(t)^2 - V(q(t)) \\right) dt$$\nThe discrete Lagrangian $L_d(q_k, q_{k+1}, h)$ is an approximation of this integral. Let $h = t_{k+1} - t_k$.\n\nFirst, we address the kinetic energy term. The problem assumes that $q(t)$ is a linear interpolant between $(t_k, q_k)$ and $(t_{k+1}, q_{k+1})$. On the interval $[t_k, t_{k+1}]$, the velocity $\\dot{q}(t)$ is therefore constant:\n$$\\dot{q}(t) = \\frac{q_{k+1} - q_k}{t_{k+1} - t_k} = \\frac{q_{k+1} - q_k}{h}$$\nThe integral of the kinetic energy is then exact:\n$$\\int_{t_k}^{t_{k+1}} \\frac{1}{2} m \\dot{q}^2 dt = \\frac{1}{2} m \\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 \\int_{t_k}^{t_{k+1}} dt = \\frac{m}{2h^2} (q_{k+1} - q_k)^2 \\cdot h = \\frac{m}{2h} (q_{k+1} - q_k)^2$$\n\nNext, we address the potential energy term. The integral is approximated using the trapezoidal rule as specified:\n$$\\int_{t_k}^{t_{k+1}} V(q(t)) dt \\approx \\frac{h}{2} (V(q(t_k)) + V(q(t_{k+1}))) = \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\nCombining these two results, the discrete Lagrangian $L_d(q_k, q_{k+1}, h)$ is constructed as:\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\n_Part 2: Derivation of the Discrete Euler-Lagrange (DEL) Equations_\n\nThe discrete action $S_d$ is the sum of the discrete Lagrangians over a sequence of points $\\{q_k\\}_{k=0}^N$:\n$$S_d = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}, h)$$\nThe principle of stationary action requires that the variation of $S_d$ with respect to an interior point $q_j$ (for $j \\in \\{1, \\dots, N-1\\}$) is zero, holding the endpoints $q_0$ and $q_N$ fixed. The point $q_j$ appears in two terms of the sum: $L_d(q_{j-1}, q_j, h)$ and $L_d(q_j, q_{j+1}, h)$.\nThe stationarity condition is $\\frac{\\partial S_d}{\\partial q_j} = 0$:\n$$\\frac{\\partial S_d}{\\partial q_j} = \\frac{\\partial}{\\partial q_j} \\left[ L_d(q_{j-1}, q_j, h) + L_d(q_j, q_{j+1}, h) \\right] = 0$$\nUsing $D_1$ and $D_2$ to denote partial derivatives with respect to the first and second arguments of $L_d$ respectively, this becomes:\n$$D_2 L_d(q_{j-1}, q_j, h) + D_1 L_d(q_j, q_{j+1}, h) = 0$$\nThis is the general form of the Discrete Euler-Lagrange (DEL) equation.\n\n_Part 3: Symplectic One-Step Map_\n\nThe discrete Legendre transforms are defined as:\n$$p_k^- := -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_k^+ := D_2 L_d(q_{k-1}, q_k, h)$$\nWith these definitions, the DEL equation, $D_2 L_d(q_{k-1}, q_k, h) + D_1 L_d(q_k, q_{k+1}, h) = 0$, is equivalent to the momentum matching condition $p_k^+ = p_k^-$.\n\nThe one-step update map $\\Phi_h: (q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ is defined by identifying the momentum $p_k$ with $p_k^-$ and then defining $p_{k+1}$ as $p_{k+1}^+$. This leads to the following system of equations that defines the map implicitly:\n$$p_k = -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_{k+1} = D_2 L_d(q_k, q_{k+1}, h)$$\nTo prove that this map is symplectic, we must show that it preserves the canonical symplectic $2$-form $\\omega = dq \\wedge dp$. In our discrete context, this means we must show that $dq_{k+1} \\wedge dp_{k+1} = dq_k \\wedge dp_k$.\n\nWe view $p_k$ and $p_{k+1}$ as functions of the independent coordinates $q_k$ and $q_{k+1}$. Taking the exterior derivative of the two defining equations gives:\n$$dp_k = -\\frac{\\partial}{\\partial q_k}(D_1 L_d) dq_k - \\frac{\\partial}{\\partial q_{k+1}}(D_1 L_d) dq_{k+1} = -D_{11} L_d dq_k - D_{12} L_d dq_{k+1}$$\n$$dp_{k+1} = \\frac{\\partial}{\\partial q_k}(D_2 L_d) dq_k + \\frac{\\partial}{\\partial q_{k+1}}(D_2 L_d) dq_{k+1} = D_{21} L_d dq_k + D_{22} L_d dq_{k+1}$$\nNow we compute the wedge products:\n$$dq_k \\wedge dp_k = dq_k \\wedge (-D_{11} L_d dq_k - D_{12} L_d dq_{k+1}) = -D_{12} L_d (dq_k \\wedge dq_{k+1})$$\n$$dq_{k+1} \\wedge dp_{k+1} = dq_{k+1} \\wedge (D_{21} L_d dq_k + D_{22} L_d dq_{k+1}) = D_{21} L_d (dq_{k+1} \\wedge dq_k) = -D_{21} L_d (dq_k \\wedge dq_{k+1})$$\nSince $V$ is smooth, $L_d$ is at least a $C^2$ function of its arguments. By Clairaut's theorem on the equality of mixed partials, $D_{12} L_d = D_{21} L_d$. Therefore, we have proven that:\n$$dq_k \\wedge dp_k = dq_{k+1} \\wedge dp_{k+1}$$\nThis confirms that the one-step map derived from any non-degenerate discrete Lagrangian of this form is symplectic. The non-degeneracy condition $D_{12}L_d \\neq 0$ is required to ensure the map is well-defined. For our $L_d$, $D_1 L_d(q_k, q_{k+1}, h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{h}{2}V'(q_k)$, so $D_{12}L_d = -\\frac{m}{h}$, which is non-zero as $m > 0$ and $h > 0$.\n\n_Part 4: Specialization to the Harmonic Oscillator_\n\nFor the simple harmonic oscillator, the potential is $V(q) = \\frac{1}{2} k q^2$, where $k > 0$. The derivative is $V'(q) = kq$.\nThe specific discrete Lagrangian is:\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} \\left(\\frac{1}{2}k q_k^2 + \\frac{1}{2}k q_{k+1}^2\\right) = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{4}(q_k^2 + q_{k+1}^2)$$\nWe compute the partial derivatives $D_1L_d$ and $D_2L_d$:\n$$D_1 L_d = \\frac{m}{h}(q_k - q_{k+1}) - \\frac{kh}{2}q_k$$\n$$D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\nThe one-step map is defined by the system:\n$$p_k = -D_1 L_d = \\frac{m}{h}(q_{k+1} - q_k) + \\frac{kh}{2}q_k$$\n$$p_{k+1} = D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\nWe must solve this linear system for $q_{k+1}$ and $p_{k+1}$ as functions of $q_k$ and $p_k$.\nFrom the first equation, we solve for $q_{k+1}$:\n$$p_k - q_k\\left(\\frac{kh}{2} - \\frac{m}{h}\\right) = \\frac{m}{h}q_{k+1}$$\n$$q_{k+1} = \\frac{h}{m} p_k - q_k\\left(\\frac{kh^2}{2m} - 1\\right) = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k$$\nThis is the update rule for the position $q_{k+1}$.\nTo find $p_{k+1}$, we can subtract the second equation from the first:\n$$p_k - p_{k+1} = \\left(\\frac{kh}{2}q_k\\right) - \\left(-\\frac{kh}{2}q_{k+1}\\right) = \\frac{kh}{2}(q_k + q_{k+1})$$\n$$p_{k+1} = p_k - \\frac{kh}{2}(q_k + q_{k+1})$$\nNow, we substitute the expression found for $q_{k+1}$:\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k + \\left(q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right)\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(1 + 1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(2 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - q_k kh\\left(1 - \\frac{kh^2}{4m}\\right) - p_k \\frac{kh^2}{2m}$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\nThis is the update rule for the momentum $p_{k+1}$.\n\nThe resulting one-step map is given by the two expressions:\n$$q_{k+1} = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\nThese are the closed-form expressions for the update map.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nq_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k & p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Having constructed a variational integrator, the next step is to understand how the specific choice of discretization affects its behavior. This practice guides you through a comparative stability analysis of two different discrete Lagrangians for the simple harmonic oscillator. You will see firsthand how different quadrature rules lead to integrators with vastly different long-term stability properties, a critical consideration in numerical simulation .",
            "id": "3739172",
            "problem": "Consider a one-degree-of-freedom linear oscillator with generalized coordinate $q \\in \\mathbb{R}$, mass $m > 0$ in kilograms, and stiffness $k > 0$ in newtons per meter. Its continuous Lagrangian is defined by $L(q,\\dot{q}) = T(q,\\dot{q}) - V(q)$ with $T(q,\\dot{q}) = \\frac{m}{2}\\dot{q}^{2}$ and $V(q) = \\frac{k}{2}q^{2}$. Let $\\omega = \\sqrt{k/m}$ denote the natural angular frequency in radians per second. A discrete Lagrangian $L_{d}(q_{k},q_{k+1};h)$ approximates the action integral over a time step of duration $h$ seconds and yields discrete dynamics by stationarity of the discrete action sum.\n\nUse the Discrete Euler-Lagrange (DEL) equations as the fundamental base: for a sequence $\\{q_{k}\\}_{k=0}^{N}$ and a fixed time step $h > 0$, critical points of the discrete action sum $\\sum_{k=0}^{N-1} L_{d}(q_{k},q_{k+1};h)$ satisfy the DEL equations\n$$\nD_{2}L_{d}(q_{k-1},q_{k};h) + D_{1}L_{d}(q_{k},q_{k+1};h) = 0 \\quad \\text{for all } k = 1,\\dots,N-1,\n$$\nwhere $D_{1}$ and $D_{2}$ denote the partial derivatives of $L_{d}$ with respect to its first and second arguments, respectively.\n\nIn this problem, analyze stability via linearization of the DEL update for two choices of discrete Lagrangian constructed from standard quadrature rules applied to the action integrand $L(q,\\dot{q})$, using the following definitions:\n\n1. Midpoint discrete Lagrangian:\n$$\nL_{d}^{\\mathrm{mid}}(q_{k},q_{k+1};h) \\equiv h\\,L\\!\\left(\\frac{q_{k}+q_{k+1}}{2},\\,\\frac{q_{k+1}-q_{k}}{h}\\right).\n$$\n\n2. Trapezoidal discrete Lagrangian:\n$$\nL_{d}^{\\mathrm{trap}}(q_{k},q_{k+1};h) \\equiv \\frac{h}{2}\\left[L\\!\\left(q_{k},\\,\\frac{q_{k+1}-q_{k}}{h}\\right) + L\\!\\left(q_{k+1},\\,\\frac{q_{k+1}-q_{k}}{h}\\right)\\right].\n$$\n\nTasks:\n\n- Starting from the DEL equations and the given $L(q,\\dot{q})$, derive for each choice of discrete Lagrangian a homogeneous linear, two-step recurrence of the form\n$$\nq_{k+1} = a\\,q_{k} + b\\,q_{k-1},\n$$\nwhose coefficients $a$ and $b$ depend on $m$, $k$, and $h$.\n\n- Rewrite each recurrence as a first-order linear update on the two-dimensional state vector $(q_{k},q_{k-1})^{\\top}$:\n$$\n\\begin{pmatrix} q_{k+1} \\\\ q_{k} \\end{pmatrix} = A \\begin{pmatrix} q_{k} \\\\ q_{k-1} \\end{pmatrix},\n$$\nand obtain the corresponding $2\\times 2$ update matrix $A$ for each discrete Lagrangian.\n\n- For each update matrix $A$, compute the eigenvalues and the spectral radius $\\rho(A)$, defined as the maximum of the absolute values of the eigenvalues. The spectral radius is dimensionless.\n\n- Define a binary classification of linear stability as follows. Declare the update to be linearly stable if and only if both conditions hold:\n  1. The spectral radius satisfies $\\rho(A) \\le 1$.\n  2. If the eigenvalues are repeated (algebraic multiplicity greater than one), the update matrix is a scalar multiple of the identity (which ensures diagonalizability). Equivalently, repeated eigenvalues with a nontrivial Jordan block are classified as not linearly stable.\n\nImplement a program that, for each test case specified below, computes:\n- The spectral radius for the midpoint discrete Lagrangian update.\n- The spectral radius for the trapezoidal discrete Lagrangian update.\n- The boolean linear stability classification for the midpoint update.\n- The boolean linear stability classification for the trapezoidal update.\n\nUse the following test suite, with parameters expressed in International System of Units (SI units): mass $m$ in kilograms (kg), stiffness $k$ in newtons per meter (N/m), and time step $h$ in seconds (s). The spectral radius is dimensionless. For all computations, assume real arithmetic with sufficient precision to distinguish stability classifications consistently.\n\nTest cases:\n- Case 1: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,0.2\\,\\mathrm{s})$.\n- Case 2: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.0\\,\\mathrm{s})$.\n- Case 3: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.1\\,\\mathrm{s})$.\n- Case 4: $(m,k,h) = (3.0\\,\\mathrm{kg},\\,3.0\\,\\mathrm{N/m},\\,1.8\\,\\mathrm{s})$.\n- Case 5: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,1.0\\,\\mathrm{N/m},\\,1.0\\times 10^{-6}\\,\\mathrm{s})$.\n- Case 6: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,100.0\\,\\mathrm{N/m},\\,0.19\\,\\mathrm{s})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each case, output the four values in the order: midpoint spectral radius, trapezoidal spectral radius, midpoint stability boolean, trapezoidal stability boolean. Express all spectral radii as decimal floats rounded to six decimal places. The final output therefore aggregates twenty-four entries, corresponding to the six test cases, in the single-line format:\n$$\n[\\rho_{\\mathrm{mid},1},\\rho_{\\mathrm{trap},1},s_{\\mathrm{mid},1},s_{\\mathrm{trap},1},\\dots,\\rho_{\\mathrm{mid},6},\\rho_{\\mathrm{trap},6},s_{\\mathrm{mid},6},s_{\\mathrm{trap},6}],\n$$\nwhere each $\\rho_{\\cdot}$ is a float with six digits after the decimal point (dimensionless) and each $s_{\\cdot}$ is a boolean.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the field of geometric numerical integration, specifically concerning variational integrators for Hamiltonian systems. The problem is well-posed, with all necessary definitions, constants, and conditions provided for a unique solution. The language is objective and precise. The tasks are mathematically formalizable and directly relevant to the topic of discrete Lagrangians. There are no contradictions, ambiguities, or factual inaccuracies.\n\nThe solution proceeds by first analyzing the midpoint rule and then the trapezoidal rule. For each rule, we derive the discrete Euler-Lagrange equations, obtain the linear recurrence relation, form the state-space update matrix, and analyze its spectral properties to determine the spectral radius and linear stability.\n\nThe continuous Lagrangian for the one-degree-of-freedom linear oscillator is given by\n$$\nL(q, \\dot{q}) = T(\\dot{q}) - V(q) = \\frac{1}{2}m\\dot{q}^2 - \\frac{1}{2}kq^2\n$$\nwhere $m > 0$ is the mass and $k > 0$ is the stiffness. The natural angular frequency is $\\omega = \\sqrt{k/m}$. The dynamics of a discrete system $\\{q_k\\}_{k=0}^N$ are governed by the discrete Euler-Lagrange (DEL) equations:\n$$\nD_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0\n$$\nwhere $D_i$ is the partial derivative with respect to the $i$-th argument.\n\n### Midpoint Discrete Lagrangian Analysis\n\nThe midpoint discrete Lagrangian is defined as\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) \\equiv h L\\left(\\frac{q_k + q_{k+1}}{2}, \\frac{q_{k+1} - q_k}{h}\\right)\n$$\nSubstituting the continuous Lagrangian $L$ gives\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = h \\left[ \\frac{m}{2}\\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 - \\frac{k}{2}\\left(\\frac{q_k + q_{k+1}}{2}\\right)^2 \\right] = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{8}(q_k + q_{k+1})^2\n$$\nTo form the DEL equations, we compute the partial derivatives:\n$$\nD_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}}{\\partial q_k} = \\frac{m}{h}(q_{k+1} - q_k)(-1) - \\frac{kh}{8} \\cdot 2(q_k + q_{k+1}) = -\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\n$$\n$$\nD_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h)}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{8} \\cdot 2(q_{k-1} + q_k) = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\n$$\nSubstituting these into the DEL equation $D_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) + D_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = 0$:\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\\right) = 0\n$$\nGrouping terms by $q_{k+1}$, $q_k$, and $q_{k-1}$:\n$$\nq_{k+1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) + q_k\\left(\\frac{2m}{h} - \\frac{kh}{2}\\right) + q_{k-1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) = 0\n$$\nMultiplying by $-1$ and substituting $\\omega^2 = k/m$:\n$$\nq_{k+1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) - q_k\\left(\\frac{2m}{h} - \\frac{m\\omega^2 h}{2}\\right) + q_{k-1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) = 0\n$$\nDividing by $m/h$:\n$$\nq_{k+1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) - q_k\\left(2 - \\frac{\\omega^2 h^2}{2}\\right) + q_{k-1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) = 0\n$$\nThe recurrence relation is $q_{k+1} = a_{\\mathrm{mid}} q_k + b_{\\mathrm{mid}} q_{k-1}$, where\n$$\na_{\\mathrm{mid}} = \\frac{2 - \\frac{1}{2}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{8 - 2\\omega^2 h^2}{4 + \\omega^2 h^2}, \\quad b_{\\mathrm{mid}} = -1\n$$\nThe update matrix $A_{\\mathrm{mid}}$ for the state vector $(q_k, q_{k-1})^\\top$ is\n$$\nA_{\\mathrm{mid}} = \\begin{pmatrix} a_{\\mathrm{mid}} & -1 \\\\ 1 & 0 \\end{pmatrix}\n$$\nThe characteristic equation is $\\det(A_{\\mathrm{mid}} - \\lambda I) = \\lambda^2 - a_{\\mathrm{mid}}\\lambda + 1 = 0$. The product of the eigenvalues is $1$. The eigenvalues are complex conjugates if the discriminant $a_{\\mathrm{mid}}^2 - 4 < 0$, which is equivalent to $|a_{\\mathrm{mid}}| < 2$. Let $x = \\omega^2 h^2 > 0$. Then $a_{\\mathrm{mid}} = (8-2x)/(4+x)$. The condition $|a_{\\mathrm{mid}}| < 2$ becomes $|\\frac{8-2x}{4+x}| < 2$, which simplifies to $-2(4+x) < 8-2x < 2(4+x)$. The left inequality $-8-2x < 8-2x$ implies $-8 < 8$, always true. The right inequality $8-2x < 8+2x$ implies $0 < 4x$, which is true for $x > 0$. Thus, $|a_{\\mathrm{mid}}| < 2$ for all physical parameters $m,k,h > 0$.\nThe eigenvalues are therefore distinct, complex conjugates on the unit circle. This means the spectral radius is $\\rho(A_{\\mathrm{mid}}) = 1$. Since $\\rho(A_{\\mathrm{mid}}) \\le 1$ and the eigenvalues are never repeated, both stability conditions are met. The midpoint method is unconditionally linearly stable.\n\n### Trapezoidal Discrete Lagrangian Analysis\n\nThe trapezoidal discrete Lagrangian is defined as\n$$\nL_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) \\equiv \\frac{h}{2}\\left[L\\left(q_k, \\frac{q_{k+1}-q_k}{h}\\right) + L\\left(q_{k+1}, \\frac{q_{k+1}-q_k}{h}\\right)\\right]\n$$\nSubstituting the continuous Lagrangian $L$ gives\n$$\nL_d^{\\mathrm{trap}} = \\frac{h}{2}\\left[\\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_k^2\\right) + \\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_{k+1}^2\\right)\\right] = \\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{4}(q_k^2+q_{k+1}^2)\n$$\nThe partial derivatives for the DEL equations are:\n$$\nD_1 L_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{2}q_k\n$$\n$$\nD_2 L_{d}^{\\mathrm{trap}}(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k-q_{k-1}) - \\frac{kh}{2}q_k\n$$\nSubstituting into the DEL equation:\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{2}q_k\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_k\\right) = 0\n$$\nGrouping terms:\n$$\n-\\frac{m}{h}q_{k+1} + \\left(\\frac{2m}{h} - kh\\right)q_k - \\frac{m}{h}q_{k-1} = 0\n$$\nMultiplying by $-h/m$ and substituting $\\omega^2=k/m$:\n$$\nq_{k+1} - (2 - \\omega^2 h^2)q_k + q_{k-1} = 0\n$$\nThe recurrence relation is $q_{k+1} = a_{\\mathrm{trap}} q_k + b_{\\mathrm{trap}} q_{k-1}$, where\n$$\na_{\\mathrm{trap}} = 2 - \\omega^2 h^2, \\quad b_{\\mathrm{trap}} = -1\n$$\nThe update matrix $A_{\\mathrm{trap}}$ is\n$$\nA_{\\mathrm{trap}} = \\begin{pmatrix} a_{\\mathrm{trap}} & -1 \\\\ 1 & 0 \\end{pmatrix}\n$$\nThe characteristic equation is $\\lambda^2 - a_{\\mathrm{trap}}\\lambda + 1 = 0$. The spectral radius $\\rho(A_{\\mathrm{trap}}) > 1$ if and only if the eigenvalues are real and non-unity, which occurs when $|a_{\\mathrm{trap}}| > 2$.\nLet $x = \\omega h$. The condition becomes $|2-x^2| > 2$. This holds if $2-x^2 > 2 \\implies -x^2 > 0$ (impossible for real $x$), or if $2-x^2 < -2 \\implies 4 < x^2 \\implies x > 2$ (since $x>0$).\nSo, the system is unstable with $\\rho(A_{\\mathrm{trap}}) > 1$ if $\\omega h > 2$.\nIf $\\omega h < 2$, then $|a_{\\mathrm{trap}}| < 2$, the eigenvalues are on the unit circle, and $\\rho(A_{\\mathrm{trap}}) = 1$. The method is linearly stable.\nIf $\\omega h = 2$, then $a_{\\mathrm{trap}} = 2 - 2^2 = -2$. The characteristic equation becomes $\\lambda^2 + 2\\lambda + 1 = (\\lambda+1)^2 = 0$, giving a repeated eigenvalue $\\lambda = -1$. The spectral radius is $\\rho(A_{\\mathrm{trap}}) = 1$. The update matrix is $A_{\\mathrm{trap}} = \\begin{pmatrix} -2 & -1 \\\\ 1 & 0 \\end{pmatrix}$. This is not a scalar multiple of the identity matrix. Thus, by the problem's second stability condition, the method is not linearly stable at $\\omega h = 2$.\n\nSummary of results for implementation:\n- **Midpoint method**: $\\rho_{\\mathrm{mid}} = 1$ and stable for all $m, k, h > 0$.\n- **Trapezoidal method**: Let $x = \\omega h = h\\sqrt{k/m}$.\n  - If $x < 2$: $\\rho_{\\mathrm{trap}} = 1$ and the method is stable.\n  - If $x = 2$: $\\rho_{\\mathrm{trap}} = 1$ but the method is unstable.\n  - If $x > 2$: $\\rho_{\\mathrm{trap}} = \\frac{|2-x^2| + \\sqrt{(2-x^2)^2-4}}{2} > 1$ and the method is unstable.\n\nThese formulae will now be applied to the test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spectral radius and stability for midpoint and trapezoidal\n    discrete Lagrangian methods for a linear oscillator.\n    \"\"\"\n    test_cases = [\n        # Case 1: (m, k, h) = (1.0 kg, 4.0 N/m, 0.2 s)\n        (1.0, 4.0, 0.2),\n        # Case 2: (m, k, h) = (1.0 kg, 4.0 N/m, 1.0 s)\n        (1.0, 4.0, 1.0),\n        # Case 3: (m, k, h) = (1.0 kg, 4.0 N/m, 1.1 s)\n        (1.0, 4.0, 1.1),\n        # Case 4: (m, k, h) = (3.0 kg, 3.0 N/m, 1.8 s)\n        (3.0, 3.0, 1.8),\n        # Case 5: (m, k, h) = (1.0 kg, 1.0 N/m, 1.0e-6 s)\n        (1.0, 1.0, 1.0e-6),\n        # Case 6: (m, k, h) = (1.0 kg, 100.0 N/m, 0.19 s)\n        (1.0, 100.0, 0.19)\n    ]\n\n    results = []\n    \n    # Use a small tolerance for floating point comparisons\n    TOL = 1e-9\n\n    for m, k, h in test_cases:\n        # --- Midpoint Method Analysis ---\n        # The spectral radius for the midpoint method is always 1,\n        # and it is unconditionally stable for m, k, h > 0.\n        rho_mid = 1.0\n        stable_mid = True\n\n        # --- Trapezoidal Method Analysis ---\n        omega = np.sqrt(k / m)\n        x = omega * h\n        \n        rho_trap = 0.0\n        stable_trap = False\n\n        if x  2.0 - TOL:\n            # Conditionally stable region\n            rho_trap = 1.0\n            stable_trap = True\n        elif abs(x - 2.0) = TOL:\n            # Boundary of stability: repeated eigenvalues, non-diagonalizable matrix\n            rho_trap = 1.0\n            stable_trap = False\n        else: # x > 2.0 + TOL\n            # Unstable region\n            a_trap = 2.0 - x**2\n            # a_trap will be  -2\n            # rho = (|a| + sqrt(a^2 - 4)) / 2\n            rho_trap = (abs(a_trap) + np.sqrt(a_trap**2 - 4.0)) / 2.0\n            stable_trap = False\n\n        results.extend([\n            f\"{rho_mid:.6f}\",\n            f\"{rho_trap:.6f}\",\n            str(stable_mid).lower(),\n            str(stable_trap).lower()\n        ])\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice applies the principles of discrete variational mechanics to a more advanced and geometrically rich problem: finding geodesics on a sphere. You will translate the abstract principle of minimizing a discrete action into a concrete computational task involving constrained optimization. This exercise bridges theory and practice, demonstrating the power of variational methods to solve complex problems on manifolds .",
            "id": "3739622",
            "problem": "Consider a Riemannian manifold specified as the unit two-sphere embedded in three-dimensional Euclidean space, $\\mathbb{S}^2 \\subset \\mathbb{R}^3$, endowed with the metric induced by the ambient Euclidean metric. Let the kinetic-energy Lagrangian be $L(q,\\dot{q})=\\tfrac{1}{2}\\|\\dot{q}\\|^2$, where $q \\in \\mathbb{S}^2$ and $\\dot{q}$ is tangent to $\\mathbb{S}^2$ at $q$. The discrete variational principle seeks a sequence of points $\\{q_0,q_1,\\dots,q_N\\} \\subset \\mathbb{S}^2$ with fixed endpoints $q_0$ and $q_N$ that minimizes the discrete action associated with a discrete Lagrangian $L_d$ approximating the action integral of $L$ on each time step. You will construct discrete geodesics by minimizing a discrete action under the holonomic constraint $\\|q_k\\|^2=1$ for all $k$, using a variational integrator perspective.\n\nStarting from the definitions above and the concept of a discrete action, implement a program that, for each test case specified below, computes a discrete geodesic sequence $\\{q_k\\}_{k=0}^N$ connecting the given endpoints by minimizing the discrete action\n$$\nS_d(\\{q_k\\}) \\equiv \\sum_{k=0}^{N-1} L_d(q_k,q_{k+1};h),\n$$\nwith a discrete Lagrangian chosen as\n$$\nL_d(q_k,q_{k+1};h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2,\n$$\nwhere $h0$ is the uniform time step. Enforce the sphere constraint $\\|q_k\\|^2=1$ at all interior nodes by introducing a constraint handling strategy consistent with the variational integrator methodology. Use an algorithmic approach that is principled from the discrete variational viewpoint, and numerically solves the two-point boundary value problem to connect $q_0$ to $q_N$ by minimizing the discrete action subject to the holonomic constraint on $\\mathbb{S}^2$. Angles must be treated in radians.\n\nYour program must, for each test case, construct the discrete geodesic and then compute one scalar diagnostic as specified for that case. The final program output must be a single line containing a comma-separated list of these diagnostics enclosed in square brackets, in the exact order of the test suite below.\n\nUse the following test suite:\n- Test case 1 (general case): $q_0=(0,0,1)$, $q_N=(\\sin\\theta,0,\\cos\\theta)$ with $\\theta=0.6$ radians, $N=20$. Let $h=\\tfrac{1}{N}$. Compute the total spherical arc length along the discrete path,\n$$\n\\ell_{\\mathrm{disc}} \\equiv \\sum_{k=0}^{N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\nand return the absolute difference from the true shortest spherical distance $\\ell_{\\mathrm{true}}=\\arccos(q_0\\cdot q_N)=\\theta$, i.e., output the float $|\\ell_{\\mathrm{disc}}-\\ell_{\\mathrm{true}}|$.\n- Test case 2 (boundary condition case): $q_0=(0,0,1)$, $q_N=(0,0,1)$, $N=10$. Let $h=\\tfrac{1}{N}$. Compute the maximum spherical arc length between consecutive nodes along the discrete path,\n$$\n\\max_{0\\le k \\le N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\nand return this float.\n- Test case 3 (near-antipodal edge case): $q_0=(0,0,1)$, $q_N=(\\sin\\phi,0,\\cos\\phi)$ with $\\phi=\\pi-0.01$ radians, $N=50$. Let $h=\\tfrac{1}{N}$. Fit the best plane through the origin to the computed discrete path by finding a unit normal vector $n\\in\\mathbb{R}^3$ that minimizes the sum of squared deviations $\\sum_{k=0}^N (n\\cdot q_k)^2$. Compute the root-mean-square planarity deviation\n$$\n\\sqrt{\\frac{1}{N+1}\\sum_{k=0}^N (n\\cdot q_k)^2},\n$$\nand return this float.\n\nAll angles must be in radians. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). The results for each test case must be floats. The method you implement must be grounded in the discrete variational mechanics framework described above, starting from the kinetic-energy Lagrangian and a consistent discrete action, and must ensure scientific realism and numerical plausibility by enforcing the sphere constraint throughout the path construction.",
            "solution": "The problem requires the computation of discrete geodesics on a unit two-sphere, $\\mathbb{S}^2$, by minimizing a discrete action. This task is rooted in the principles of discrete variational mechanics, a subfield of geometric mechanics that aims to preserve the geometric and structural properties of mechanical systems in numerical simulations.\n\nThe theoretical foundation is the principle of least action. For a continuous system with configuration $q(t)$ and Lagrangian $L(q, \\dot{q})$, the trajectory connecting points $q_a$ and $q_b$ in a time interval $[t_a, t_b]$ is one that extremizes the action integral $S = \\int_{t_a}^{t_b} L(q(t), \\dot{q}(t)) dt$. For a free particle on a Riemannian manifold, geodesics are the curves that minimize this action, with a kinetic-energy Lagrangian $L(q, \\dot{q}) = \\frac{1}{2} m \\|\\dot{q}\\|^2$. Here, we consider unit mass $m=1$ on the sphere $\\mathbb{S}^2$, so $L(q, \\dot{q}) = \\frac{1}{2}\\|\\dot{q}\\|^2$, where the norm is induced by the ambient Euclidean metric of $\\mathbb{R}^3$.\n\nDiscrete variational mechanics replaces the continuous path $q(t)$ with a discrete sequence of points $\\{q_k\\}_{k=0}^N$ where $q_k \\approx q(t_k)$ and $t_k = kh$ for a fixed time step $h$. The action integral $S$ is approximated by a discrete sum, the discrete action $S_d$:\n$$\nS[q(t)] = \\int_0^{Nh} L(q(t), \\dot{q}(t)) dt \\approx S_d(\\{q_k\\}) = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}; h)\n$$\nHere, $L_d(q_k, q_{k+1}; h)$ is a discrete Lagrangian, which approximates the integral of the continuous Lagrangian over a single time step, i.e., $L_d(q_k, q_{k+1}; h) \\approx \\int_{kh}^{(k+1)h} L dt$. A simple and common choice, as given in the problem, is based on a finite difference approximation of $\\dot{q}$:\n$$\nL_d(q_k, q_{k+1}; h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2\n$$\nThis is proportional to $h \\cdot L\\left(q, (q_{k+1}-q_k)/h\\right)$, which is a valid first-order approximation.\n\nThe discrete geodesic is the sequence $\\{q_k\\}$ that extremizes $S_d$ subject to the given constraints. The endpoints $q_0$ and $q_N$ are fixed. The interior points $\\{q_k\\}_{k=1}^{N-1}$ must lie on the sphere, imposing the holonomic constraints:\n$$\ng_k(q_k) = \\|q_k\\|^2 - 1 = 0 \\quad \\text{for } k=1, \\dots, N-1\n$$\nThe problem is thus transformed into a constrained optimization problem:\n$$\n\\min_{q_1, \\dots, q_{N-1}} S_d(\\{q_k\\}) \\quad \\text{subject to} \\quad \\|q_k\\|^2 = 1 \\text{ for } k=1, \\dots, N-1\n$$\nLet us analyze the objective function. We wish to minimize $S_d = \\sum_{k=0}^{N-1} \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2$. Since $h$ is a positive constant, this is equivalent to minimizing $\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2$. Expanding the norm and applying the constraint $\\|q_k\\|^2=1$ for all $k$ (including the endpoints, which are given on the sphere) yields:\n$$\n\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2 = \\sum_{k=0}^{N-1} (q_{k+1} - q_k) \\cdot (q_{k+1} - q_k) = \\sum_{k=0}^{N-1} (\\|q_{k+1}\\|^2 - 2 q_k \\cdot q_{k+1} + \\|q_k\\|^2)\n$$\n$$\n= \\sum_{k=0}^{N-1} (1 - 2 q_k \\cdot q_{k+1} + 1) = \\sum_{k=0}^{N-1} (2 - 2 q_k \\cdot q_{k+1}) = 2N - 2 \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}\n$$\nMinimizing this expression is equivalent to maximizing the sum of dot products, $\\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$. This has a clear geometric interpretation: the path is straightened as much as possible, as $q_k \\cdot q_{k+1} = \\cos(\\alpha_k)$, where $\\alpha_k$ is the angle between successive vectors. Maximizing this sum minimizes the angular changes along the path.\n\nThe problem is thus formulated for a numerical solver as:\n- **Variables**: A single vector $x \\in \\mathbb{R}^{3(N-1)}$ representing the flattened coordinates of the interior points $\\{q_1, \\dots, q_{N-1}\\}$.\n- **Objective Function**: Minimize $f(x) = - \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$.\n- **Constraints**: A set of $N-1$ equality constraints, $g_k(x) = \\|q_k\\|^2 - 1 = 0$, where $q_k$ is reconstructed from the corresponding segment of $x$.\n\nThis is a standard nonlinear programming problem, which is solved using the Sequential Least Squares Programming (SLSQP) method, available in `scipy.optimize.minimize`. An appropriate initial guess for the path is required for the iterative solver to converge efficiently. A spherical linear interpolation (slerp) would be ideal, but a simpler and effective alternative is to perform linear interpolation between $q_0$ and $q_N$ and then project each intermediate point onto the unit sphere.\n\nThe diagnostic calculations are performed on the optimized discrete path $\\{q_k\\}_{k=0}^N$:\n1.  **Total spherical arc length**: $\\ell_{\\mathrm{disc}} = \\sum_{k=0}^{N-1} \\arccos(q_k \\cdot q_{k+1})$. The value is compared to the true shortest distance $\\ell_{\\mathrm{true}}=\\arccos(q_0 \\cdot q_N)$. To prevent numerical errors with `arccos`, its argument is clipped to the interval $[-1, 1]$.\n2.  **Maximum segment length**: $\\max_{k} \\arccos(q_k \\cdot q_{k+1})$, which measures the largest single step along the path. For the case $q_0=q_N$, the minimal action path is trivial ($q_k=q_0$ for all $k$), and this diagnostic is expected to be $0$.\n3.  **RMS planarity deviation**: A true geodesic on $\\mathbb{S}^2$ is a great circle, lying in a plane through the origin. The planarity of the discrete path is assessed by finding the unit normal vector $n$ of the plane that best fits the points $\\{q_k\\}$. This is done by minimizing the sum of squared projections $\\sum_{k=0}^N (n \\cdot q_k)^2$ subject to $\\|n\\|^2 = 1$. This is a classic problem from linear algebra: the minimal sum is the smallest eigenvalue, $\\lambda_{\\min}$, of the second moment matrix $M = \\sum_{k=0}^N q_k q_k^T$. The RMS deviation is then $\\sqrt{\\lambda_{\\min}/(N+1)}$.\n\nThe implementation encapsulates this logic in a function that, for each test case, sets up and solves the optimization problem to find the discrete geodesic, and then computes the specified diagnostic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n\n    def solve_case(q0, qN, N):\n        \"\"\"\n        Solves for the discrete geodesic for a single test case.\n\n        Args:\n            q0 (np.ndarray): Starting point on the sphere.\n            qN (np.ndarray): Ending point on the sphere.\n            N (int): Number of segments in the path.\n\n        Returns:\n            np.ndarray: The optimized path as a sequence of (N+1) points.\n        \"\"\"\n        # 1. Initial guess for the interior points {q_1, ..., q_{N-1}}\n        # Linear interpolation between endpoints, then project to the sphere.\n        if np.allclose(q0, qN):\n            q_init = np.tile(q0, (N - 1, 1))\n        else:\n            q_init = np.array([q0 + (k / N) * (qN - q0) for k in range(1, N)])\n            norms = np.linalg.norm(q_init, axis=1, keepdims=True)\n            # Avoid division by zero if an interpolated point is the origin\n            # (not expected for the given test cases).\n            q_init /= np.where(norms > 1e-12, norms, 1.0)\n        \n        x0 = q_init.flatten()\n\n        # 2. Objective function to be minimized\n        # We minimize -sum(q_k . q_{k+1}), which is equivalent to maximizing the sum\n        # of dot products, and thus minimizing the original discrete action.\n        def objective_func(x, q0_v=q0, qN_v=qN, num_segs=N):\n            path = np.vstack([q0_v, x.reshape(num_segs - 1, 3), qN_v])\n            # Element-wise product and sum over axes gives dot products\n            dots = np.sum(path[:-1] * path[1:], axis=1)\n            return -np.sum(dots)\n\n        # 3. Constraints: ||q_k||^2 - 1 = 0 for k = 1, ..., N-1\n        constraints = []\n        for k in range(N - 1):\n            def constraint_factory(k_idx):\n                def constraint_func(x):\n                    q_k = x[3 * k_idx : 3 * (k_idx + 1)]\n                    return np.dot(q_k, q_k) - 1.0\n                return constraint_func\n            constraints.append({'type': 'eq', 'fun': constraint_factory(k)})\n\n        # 4. Optimization\n        res = minimize(\n            objective_func,\n            x0,\n            method='SLSQP',\n            constraints=constraints,\n            options={'maxiter': 1000, 'ftol': 1e-10}\n        )\n\n        if not res.success:\n            # Fallback or error, though not expected for this problem.\n            # For robustness, could return the initial guess path.\n            print(f\"Warning: Optimization failed for case N={N}. Message: {res.message}\")\n            x_opt = x0\n        else:\n            x_opt = res.x\n\n        # 5. Reconstruct the full optimized path {q_0, ..., q_N}\n        optimized_path = np.vstack([q0, x_opt.reshape(N - 1, 3), qN])\n        return optimized_path\n\n    results = []\n\n    # === Test Case 1 ===\n    theta_1 = 0.6\n    q0_1 = np.array([0.0, 0.0, 1.0])\n    qN_1 = np.array([np.sin(theta_1), 0.0, np.cos(theta_1)])\n    N_1 = 20\n    path_1 = solve_case(q0_1, qN_1, N_1)\n    dots_1 = np.sum(path_1[:-1] * path_1[1:], axis=1)\n    dots_1 = np.clip(dots_1, -1.0, 1.0) # For numerical stability of arccos\n    l_disc_1 = np.sum(np.arccos(dots_1))\n    l_true_1 = theta_1 # Since arccos(q0 . qN) = theta\n    res_1 = np.abs(l_disc_1 - l_true_1)\n    results.append(res_1)\n\n    # === Test Case 2 ===\n    q0_2 = np.array([0.0, 0.0, 1.0])\n    qN_2 = np.array([0.0, 0.0, 1.0])\n    N_2 = 10\n    path_2 = solve_case(q0_2, qN_2, N_2)\n    dots_2 = np.sum(path_2[:-1] * path_2[1:], axis=1)\n    dots_2 = np.clip(dots_2, -1.0, 1.0)\n    res_2 = np.max(np.arccos(dots_2))\n    results.append(res_2)\n\n    # === Test Case 3 ===\n    phi_3 = np.pi - 0.01\n    q0_3 = np.array([0.0, 0.0, 1.0])\n    qN_3 = np.array([np.sin(phi_3), 0.0, np.cos(phi_3)])\n    N_3 = 50\n    path_3 = solve_case(q0_3, qN_3, N_3)\n    # Fit best plane by finding the normal n that minimizes sum((n.q_k)^2).\n    # This n is the eigenvector of the moment matrix M = sum(q_k * q_k.T)\n    # corresponding to the smallest eigenvalue.\n    M = path_3.T @ path_3 # M_ij = sum_k q_k[i] * q_k[j]\n    # np.linalg.eigh is for Hermitian (symmetric) matrices and returns sorted eigenvalues.\n    eigenvalues, _ = np.linalg.eigh(M)\n    lambda_min = eigenvalues[0] # The smallest eigenvalue\n    # The minimum sum of squares is lambda_min.\n    # The RMS deviation is sqrt( (sum of squares) / (number of points) )\n    res_3 = np.sqrt(lambda_min / (N_3 + 1))\n    results.append(res_3)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}