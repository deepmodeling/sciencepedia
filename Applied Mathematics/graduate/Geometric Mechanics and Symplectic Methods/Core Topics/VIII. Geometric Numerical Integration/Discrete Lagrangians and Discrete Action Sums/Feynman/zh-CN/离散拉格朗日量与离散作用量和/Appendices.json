{
    "hands_on_practices": [
        {
            "introduction": "几何积分的核心思想是对作用量原理本身进行离散化，而非直接对运动方程进行离散。本练习将引导你完整地体验这一基本过程。我们将从一个简单的连续拉格朗日系统出发，通过标准的数值求积方法构造离散拉格朗日量，并运用离散变分原理推导出系统的更新方程，最终证明由此产生的数值映射保持了相空间的辛结构——这是变分积分器的标志性特征。",
            "id": "3758398",
            "problem": "考虑一个力学系统，其位形流形为 $Q = \\mathbb{R}$，质量参数 $m > 0$，以及光滑势函数 $V: \\mathbb{R} \\rightarrow \\mathbb{R}$。连续拉格朗日量为 $L(q,\\dot{q}) = \\tfrac{1}{2} m \\dot{q}^{2} - V(q)$。设 $t_{k}$ 为具有固定步长 $h > 0$ 的离散时间点，采样值为 $q_{k} \\in \\mathbb{R}$。从平稳作用量原理和离散作用量求和的标准定义出发，通过在以下建模假设下近似在 $[t_{k}, t_{k+1}]$ 上的作用量，构建一个离散拉格朗日量 $L_{d}(q_{k}, q_{k+1}, h)$：\n- 假设 $q(t)$ 是连接 $(t_{k}, q_{k})$ 和 $(t_{k+1}, q_{k+1})$ 的唯一线性插值。\n- 使用梯形法则近似势能在 $[t_{k}, t_{k+1}]$ 上的积分。\n定义离散作用量 $S_{d} = \\sum_{k=0}^{N-1} L_{d}(q_{k}, q_{k+1}, h)$，并通过要求 $S_{d}$ 对于固定端点的 $\\{q_{k}\\}_{k=1}^{N-1}$ 的变分是平稳的，来推导离散 Euler-Lagrange (DEL) 方程。然后，引入离散 Legendre 变换 $p_{k}^{-} := - D_{1} L_{d}(q_{k}, q_{k+1}, h)$ 和 $p_{k}^{+} := D_{2} L_{d}(q_{k-1}, q_{k}, h)$，并强制动量匹配 $p_{k}^{-} = p_{k}^{+}$ 以获得单步更新映射 $(q_{k}, p_{k}) \\mapsto (q_{k+1}, p_{k+1})$。证明此映射是辛的，即它保持了 $T^{*}\\mathbb{R}$ 上的典范辛形式。\n\n最后，将此方法特化到谐振子情况，其中 $V(q) = \\tfrac{1}{2} k q^{2}$ 且 $k > 0$，并将得到的单步映射明确地写成关于 $q_{k}$、$p_{k}$、$m$、$k$ 和 $h$ 的 $q_{k+1}$ 和 $p_{k+1}$ 的闭式表达式。你的最终答案必须是一个由两个更新公式连接成的行矩阵的单一解析表达式。不需要四舍五入，最终答案中也不应包含单位。",
            "solution": "该问题是几何力学领域中关于变分积分子构建的一个有效练习。其科学基础是分析力学中的平稳作用量原理，并使用了标准的数值近似技术。该问题是适定的，具有清晰明确的指令，可以导出一个唯一解。所有术语都有正式定义，任务从一般原理到具体应用逻辑地进行。因此，我们开始求解。\n\n根据问题陈述的要求，解题过程分为四个部分：\n1.  构建离散拉格朗日量 $L_d$。\n2.  推导离散 Euler-Lagrange (DEL) 方程。\n3.  定义单步映射并证明其辛性。\n4.  特化到谐振子以求得显式映射。\n\n_第一部分：构建离散拉格朗日量_\n\n在时间区间 $[t_k, t_{k+1}]$ 上的连续作用量由拉格朗日量的积分给出：\n$$S_{k, k+1} = \\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) dt = \\int_{t_k}^{t_{k+1}} \\left( \\frac{1}{2} m \\dot{q}(t)^2 - V(q(t)) \\right) dt$$\n离散拉格朗日量 $L_d(q_k, q_{k+1}, h)$ 是该积分的一个近似。设 $h = t_{k+1} - t_k$。\n\n首先，我们处理动能项。问题假设 $q(t)$ 是 $(t_k, q_k)$ 和 $(t_{k+1}, q_{k+1})$ 之间的线性插值。在区间 $[t_k, t_{k+1}]$ 上，速度 $\\dot{q}(t)$ 因此是恒定的：\n$$\\dot{q}(t) = \\frac{q_{k+1} - q_k}{t_{k+1} - t_k} = \\frac{q_{k+1} - q_k}{h}$$\n动能的积分是精确的：\n$$\\int_{t_k}^{t_{k+1}} \\frac{1}{2} m \\dot{q}^2 dt = \\frac{1}{2} m \\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 \\int_{t_k}^{t_{k+1}} dt = \\frac{m}{2h^2} (q_{k+1} - q_k)^2 \\cdot h = \\frac{m}{2h} (q_{k+1} - q_k)^2$$\n\n接下来，我们处理势能项。根据规定，使用梯形法则对积分进行近似：\n$$\\int_{t_k}^{t_{k+1}} V(q(t)) dt \\approx \\frac{h}{2} (V(q(t_k)) + V(q(t_{k+1}))) = \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\n结合这两个结果，构建离散拉格朗日量 $L_d(q_k, q_{k+1}, h)$ 如下：\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\n_第二部分：推导离散 Euler-Lagrange (DEL) 方程_\n\n离散作用量 $S_d$ 是离散拉格朗日量在一个点序列 $\\{q_k\\}_{k=0}^N$ 上的总和：\n$$S_d = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}, h)$$\n平稳作用量原理要求 $S_d$ 相对于一个内部点 $q_j$（其中 $j \\in \\{1, \\dots, N-1\\}$）的变分为零，同时保持端点 $q_0$ 和 $q_N$ 固定。点 $q_j$ 出现在求和中的两项：$L_d(q_{j-1}, q_j, h)$ 和 $L_d(q_j, q_{j+1}, h)$。\n平稳性条件为 $\\frac{\\partial S_d}{\\partial q_j} = 0$：\n$$\\frac{\\partial S_d}{\\partial q_j} = \\frac{\\partial}{\\partial q_j} \\left[ L_d(q_{j-1}, q_j, h) + L_d(q_j, q_{j+1}, h) \\right] = 0$$\n使用 $D_1$ 和 $D_2$ 分别表示对 $L_d$ 的第一个和第二个参数的偏导数，上式变为：\n$$D_2 L_d(q_{j-1}, q_j, h) + D_1 L_d(q_j, q_{j+1}, h) = 0$$\n这是离散 Euler-Lagrange (DEL) 方程的一般形式。\n\n_第三部分：辛单步映射_\n\n离散 Legendre 变换定义为：\n$$p_k^- := -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_k^+ := D_2 L_d(q_{k-1}, q_k, h)$$\n根据这些定义，DEL 方程 $D_2 L_d(q_{k-1}, q_k, h) + D_1 L_d(q_k, q_{k+1}, h) = 0$ 等价于动量匹配条件 $p_k^+ = p_k^-$。\n\n单步更新映射 $\\Phi_h: (q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ 是通过将动量 $p_k$ 等同于 $p_k^-$，然后将 $p_{k+1}$ 定义为 $p_{k+1}^+$ 来定义的。这导出了以下隐式定义该映射的方程组：\n$$p_k = -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_{k+1} = D_2 L_d(q_k, q_{k+1}, h)$$\n为了证明此映射是辛的，我们必须证明它保持了典范辛2-形式 $\\omega = dq \\wedge dp$。在我们的离散背景下，这意味着我们必须证明 $dq_{k+1} \\wedge dp_{k+1} = dq_k \\wedge dp_k$。\n\n我们将 $p_k$ 和 $p_{k+1}$ 视为独立坐标 $q_k$ 和 $q_{k+1}$ 的函数。对这两个定义方程取外微分得到：\n$$dp_k = -\\frac{\\partial}{\\partial q_k}(D_1 L_d) dq_k - \\frac{\\partial}{\\partial q_{k+1}}(D_1 L_d) dq_{k+1} = -D_{11} L_d dq_k - D_{12} L_d dq_{k+1}$$\n$$dp_{k+1} = \\frac{\\partial}{\\partial q_k}(D_2 L_d) dq_k + \\frac{\\partial}{\\partial q_{k+1}}(D_2 L_d) dq_{k+1} = D_{21} L_d dq_k + D_{22} L_d dq_{k+1}$$\n现在我们计算楔积：\n$$dq_k \\wedge dp_k = dq_k \\wedge (-D_{11} L_d dq_k - D_{12} L_d dq_{k+1}) = -D_{12} L_d (dq_k \\wedge dq_{k+1})$$\n$$dq_{k+1} \\wedge dp_{k+1} = dq_{k+1} \\wedge (D_{21} L_d dq_k + D_{22} L_d dq_{k+1}) = D_{21} L_d (dq_{k+1} \\wedge dq_k) = -D_{21} L_d (dq_k \\wedge dq_{k+1})$$\n由于 $V$ 是光滑的，$L_d$ 至少是其参数的 $C^2$ 函数。根据 Clairaut 关于混合偏导数相等的定理，$D_{12} L_d = D_{21} L_d$。因此，我们证明了：\n$$dq_k \\wedge dp_k = dq_{k+1} \\wedge dp_{k+1}$$\n这证实了从任何这种形式的非退化离散拉格朗日量导出的单步映射都是辛的。非退化条件 $D_{12}L_d \\neq 0$ 是确保映射良定义的必要条件。对于我们的 $L_d$，$D_1 L_d(q_k, q_{k+1}, h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{h}{2}V'(q_k)$，所以 $D_{12}L_d = -\\frac{m}{h}$，由于 $m > 0$ 和 $h > 0$，它非零。\n\n_第四部分：特化到谐振子_\n\n对于简谐振子，势为 $V(q) = \\frac{1}{2} k q^2$，其中 $k > 0$。其导数为 $V'(q) = kq$。\n具体的离散拉格朗日量是：\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} \\left(\\frac{1}{2}k q_k^2 + \\frac{1}{2}k q_{k+1}^2\\right) = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{4}(q_k^2 + q_{k+1}^2)$$\n我们计算偏导数 $D_1L_d$ 和 $D_2L_d$：\n$$D_1 L_d = \\frac{m}{h}(q_k - q_{k+1}) - \\frac{kh}{2}q_k$$\n$$D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\n单步映射由以下方程组定义：\n$$p_k = -D_1 L_d = \\frac{m}{h}(q_{k+1} - q_k) + \\frac{kh}{2}q_k$$\n$$p_{k+1} = D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\n我们必须求解这个线性方程组，将 $q_{k+1}$ 和 $p_{k+1}$ 表示为 $q_k$ 和 $p_k$ 的函数。\n从第一个方程，我们解出 $q_{k+1}$：\n$$p_k - q_k\\left(\\frac{kh}{2} - \\frac{m}{h}\\right) = \\frac{m}{h}q_{k+1}$$\n$$q_{k+1} = \\frac{h}{m} p_k - q_k\\left(\\frac{kh^2}{2m} - 1\\right) = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k$$\n这是位置 $q_{k+1}$ 的更新规则。\n为了求得 $p_{k+1}$，我们可以将第二个方程从第一个方程中减去：\n$$p_k - p_{k+1} = \\left(\\frac{kh}{2}q_k\\right) - \\left(-\\frac{kh}{2}q_{k+1}\\right) = \\frac{kh}{2}(q_k + q_{k+1})$$\n$$p_{k+1} = p_k - \\frac{kh}{2}(q_k + q_{k+1})$$\n现在，我们代入求得的 $q_{k+1}$ 的表达式：\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k + \\left(q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right)\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(1 + 1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(2 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - q_k kh\\left(1 - \\frac{kh^2}{4m}\\right) - p_k \\frac{kh^2}{2m}$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\n这是动量 $p_{k+1}$ 的更新规则。\n\n最终的单步映射由以下两个表达式给出：\n$$q_{k+1} = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\n这些是更新映射的闭式表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nq_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k, & p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "我们构造离散拉格朗日量时所选择的近似方法至关重要，不同的选择会产生具有不同数值特性的积分器。本练习旨在深入探讨其中最关键的特性之一：数值稳定性。我们将以谐振子为例，比较由中点法则和梯形法则生成的两种不同积分器，通过分析它们各自更新矩阵的特征值来判断其稳定性，并理解为何某些方法是无条件稳定的，而另一些则仅为有条件稳定。",
            "id": "3739172",
            "problem": "考虑一个具有广义坐标 $q \\in \\mathbb{R}$、质量 $m > 0$（单位：千克）和刚度 $k > 0$（单位：牛顿/米）的单自由度线性振子。其连续拉格朗日量定义为 $L(q,\\dot{q}) = T(q,\\dot{q}) - V(q)$，其中动能 $T(q,\\dot{q}) = \\frac{m}{2}\\dot{q}^{2}$，势能 $V(q) = \\frac{k}{2}q^{2}$。令 $\\omega = \\sqrt{k/m}$ 表示固有角频率，单位为弧度/秒。离散拉格朗日量 $L_{d}(q_{k},q_{k+1};h)$ 近似了时长为 $h$ 秒的时间步长上的作用量积分，并通过离散作用量求和的驻值性得到离散动力学。\n\n使用离散欧拉-拉格朗日 (DEL) 方程作为基本依据：对于一个序列 $\\{q_{k}\\}_{k=0}^{N}$ 和一个固定的时间步长 $h > 0$，离散作用量求和 $\\sum_{k=0}^{N-1} L_{d}(q_{k},q_{k+1};h)$ 的临界点满足 DEL 方程\n$$\nD_{2}L_{d}(q_{k-1},q_{k};h) + D_{1}L_{d}(q_{k},q_{k+1};h) = 0 \\quad \\text{for all } k = 1,\\dots,N-1,\n$$\n其中 $D_{1}$ 和 $D_{2}$ 分别表示 $L_{d}$ 对其第一个和第二个参数的偏导数。\n\n在本问题中，通过对 DEL 更新进行线性化来分析稳定性。我们考虑两种由标准求积法则应用于作用量被积函数 $L(q,\\dot{q})$ 构建的离散拉格朗日量，具体定义如下：\n\n1. 中点离散拉格朗日量：\n$$\nL_{d}^{\\mathrm{mid}}(q_{k},q_{k+1};h) \\equiv h\\,L\\!\\left(\\frac{q_{k}+q_{k+1}}{2},\\,\\frac{q_{k+1}-q_{k}}{h}\\right).\n$$\n\n2. 梯形离散拉格朗日量：\n$$\nL_{d}^{\\mathrm{trap}}(q_{k},q_{k+1};h) \\equiv \\frac{h}{2}\\left[L\\!\\left(q_{k},\\,\\frac{q_{k+1}-q_{k}}{h}\\right) + L\\!\\left(q_{k+1},\\,\\frac{q_{k+1}-q_{k}}{h}\\right)\\right].\n$$\n\n任务：\n\n- 从 DEL 方程和给定的 $L(q,\\dot{q})$ 出发，为每种离散拉格朗日量推导一个形如下式的齐次线性两步递推关系\n$$\nq_{k+1} = a\\,q_{k} + b\\,q_{k-1},\n$$\n其系数 $a$ 和 $b$ 依赖于 $m$、$k$ 和 $h$。\n\n- 将每个递推关系重写为二维状态向量 $(q_{k},q_{k-1})^{\\top}$ 上的一阶线性更新：\n$$\n\\begin{pmatrix} q_{k+1} \\\\ q_{k} \\end{pmatrix} = A \\begin{pmatrix} q_{k} \\\\ q_{k-1} \\end{pmatrix},\n$$\n并为每个离散拉格朗日量求出相应的 $2\\times 2$ 更新矩阵 $A$。\n\n- 对每个更新矩阵 $A$，计算其特征值和谱半径 $\\rho(A)$，谱半径定义为特征值绝对值的最大值。谱半径是无量纲的。\n\n- 按如下方式定义线性稳定性的二元分类。当且仅当以下两个条件同时成立时，声明该更新是线性稳定的：\n  1. 谱半径满足 $\\rho(A) \\le 1$。\n  2. 如果存在重根（代数重数大于一），则更新矩阵是单位矩阵的标量倍（这确保了可对角化）。等价地，具有非平凡若尔当块的重根被分类为非线性稳定。\n\n实现一个程序，对下述每个测试用例计算：\n- 中点离散拉格朗日更新的谱半径。\n- 梯形离散拉格朗日更新的谱半径。\n- 中点更新的布尔线性稳定性分类。\n- 梯形更新的布尔线性稳定性分类。\n\n使用以下测试套件，参数以国际单位制（SI单位）表示：质量 $m$ 单位为千克 (kg)，刚度 $k$ 单位为牛顿/米 (N/m)，时间步长 $h$ 单位为秒 (s)。谱半径是无量纲的。对于所有计算，假定使用具有足够精度的实数算术，以一致地区分稳定性分类。\n\n测试用例：\n- 用例 1: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,0.2\\,\\mathrm{s})$。\n- 用例 2: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.0\\,\\mathrm{s})$。\n- 用例 3: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.1\\,\\mathrm{s})$。\n- 用例 4: $(m,k,h) = (3.0\\,\\mathrm{kg},\\,3.0\\,\\mathrm{N/m},\\,1.8\\,\\mathrm{s})$。\n- 用例 5: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,1.0\\,\\mathrm{N/m},\\,1.0\\times 10^{-6}\\,\\mathrm{s})$。\n- 用例 6: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,100.0\\,\\mathrm{N/m},\\,0.19\\,\\mathrm{s})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表。对于每个用例，按以下顺序输出四个值：中点谱半径、梯形谱半径、中点稳定性布尔值、梯形稳定性布尔值。所有谱半径表示为保留六位小数的十进制浮点数。因此，最终输出聚合了二十四个条目，对应六个测试用例，格式为单行：\n$$\n[\\rho_{\\mathrm{mid},1},\\rho_{\\mathrm{trap},1},s_{\\mathrm{mid},1},s_{\\mathrm{trap},1},\\dots,\\rho_{\\mathrm{mid},6},\\rho_{\\mathrm{trap},6},s_{\\mathrm{mid},6},s_{\\mathrm{trap},6}],\n$$\n其中每个 $\\rho_{\\cdot}$ 是一个小数点后有六位数字的浮点数（无量纲），每个 $s_{\\cdot}$ 是一个布尔值。",
            "solution": "问题陈述被评估为有效。它在几何数值积分领域具有科学依据，特别是关于哈密顿系统的变分积分子。该问题是适定的，为获得唯一解提供了所有必要的定义、常数和条件。语言客观而精确。任务是可数学形式化的，并与离散拉格朗日量的主题直接相关。没有矛盾、歧义或事实错误。\n\n求解过程首先分析中点法则，然后分析梯形法则。对于每种法则，我们推导离散欧拉-拉格朗日方程，获得线性递推关系，构建状态空间更新矩阵，并分析其谱特性以确定谱半径和线性稳定性。\n\n单自由度线性振子的连续拉格朗日量由下式给出\n$$\nL(q, \\dot{q}) = T(\\dot{q}) - V(q) = \\frac{1}{2}m\\dot{q}^2 - \\frac{1}{2}kq^2\n$$\n其中 $m > 0$ 是质量，$k > 0$ 是刚度。固有角频率为 $\\omega = \\sqrt{k/m}$。离散系统 $\\{q_k\\}_{k=0}^N$ 的动力学由离散欧拉-拉格朗日 (DEL) 方程控制：\n$$\nD_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0\n$$\n其中 $D_i$ 是对第 $i$ 个参数的偏导数。\n\n### 中点离散拉格朗日量分析\n\n中点离散拉格朗日量定义为\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) \\equiv h L\\left(\\frac{q_k + q_{k+1}}{2}, \\frac{q_{k+1} - q_k}{h}\\right)\n$$\n代入连续拉格朗日量 $L$ 可得\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = h \\left[ \\frac{m}{2}\\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 - \\frac{k}{2}\\left(\\frac{q_k + q_{k+1}}{2}\\right)^2 \\right] = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{8}(q_k + q_{k+1})^2\n$$\n为了构建 DEL 方程，我们计算偏导数：\n$$\nD_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}}{\\partial q_k} = \\frac{m}{h}(q_{k+1} - q_k)(-1) - \\frac{kh}{8} \\cdot 2(q_k + q_{k+1}) = -\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\n$$\n$$\nD_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h)}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{8} \\cdot 2(q_{k-1} + q_k) = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\n$$\n将这些代入 DEL 方程 $D_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) + D_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = 0$：\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\\right) = 0\n$$\n按 $q_{k+1}$、$q_k$ 和 $q_{k-1}$ 对项进行分组：\n$$\nq_{k+1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) + q_k\\left(\\frac{2m}{h} - \\frac{kh}{2}\\right) + q_{k-1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) = 0\n$$\n乘以 $-1$ 并代入 $\\omega^2 = k/m$：\n$$\nq_{k+1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) - q_k\\left(\\frac{2m}{h} - \\frac{m\\omega^2 h}{2}\\right) + q_{k-1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) = 0\n$$\n除以 $m/h$：\n$$\nq_{k+1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) - q_k\\left(2 - \\frac{\\omega^2 h^2}{2}\\right) + q_{k-1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) = 0\n$$\n递推关系为 $q_{k+1} = a_{\\mathrm{mid}} q_k + b_{\\mathrm{mid}} q_{k-1}$，其中\n$$\na_{\\mathrm{mid}} = \\frac{2 - \\frac{1}{2}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{8 - 2\\omega^2 h^2}{4 + \\omega^2 h^2}, \\quad b_{\\mathrm{mid}} = -1\n$$\n状态向量 $(q_k, q_{k-1})^\\top$ 的更新矩阵 $A_{\\mathrm{mid}}$ 为\n$$\nA_{\\mathrm{mid}} = \\begin{pmatrix} a_{\\mathrm{mid}} & -1 \\\\ 1 & 0 \\end{pmatrix}\n$$\n特征方程为 $\\det(A_{\\mathrm{mid}} - \\lambda I) = \\lambda^2 - a_{\\mathrm{mid}}\\lambda + 1 = 0$。特征值的乘积为 $1$。如果判别式 $a_{\\mathrm{mid}}^2 - 4  0$，即等价于 $|a_{\\mathrm{mid}}|  2$，则特征值为共轭复数。令 $x = \\omega^2 h^2  0$。则 $a_{\\mathrm{mid}} = (8-2x)/(4+x)$。条件 $|a_{\\mathrm{mid}}|  2$ 变为 $|\\frac{8-2x}{4+x}|  2$，可化简为 $-2(4+x)  8-2x  2(4+x)$。左边不等式 $-8-2x  8-2x$ 意味着 $-8  8$，恒成立。右边不等式 $8-2x  8+2x$ 意味着 $0  4x$，对于 $x  0$ 成立。因此，对于所有物理参数 $m,k,h  0$，都有 $|a_{\\mathrm{mid}}|  2$。\n因此，特征值是单位圆上不同的共轭复数。这意味着谱半径为 $\\rho(A_{\\mathrm{mid}}) = 1$。由于 $\\rho(A_{\\mathrm{mid}}) \\le 1$ 且特征值永不重复，两个稳定性条件均满足。中点法是无条件线性稳定的。\n\n### 梯形离散拉格朗日量分析\n\n梯形离散拉格朗日量定义为\n$$\nL_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) \\equiv \\frac{h}{2}\\left[L\\left(q_k, \\frac{q_{k+1}-q_k}{h}\\right) + L\\left(q_{k+1}, \\frac{q_{k+1}-q_k}{h}\\right)\\right]\n$$\n代入连续拉格朗日量 $L$ 可得\n$$\nL_d^{\\mathrm{trap}} = \\frac{h}{2}\\left[\\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_k^2\\right) + \\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_{k+1}^2\\right)\\right] = \\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{4}(q_k^2+q_{k+1}^2)\n$$\n用于 DEL 方程的偏导数为：\n$$\nD_1 L_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{2}q_k\n$$\n$$\nD_2 L_{d}^{\\mathrm{trap}}(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k-q_{k-1}) - \\frac{kh}{2}q_k\n$$\n代入 DEL 方程：\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{2}q_k\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_k\\right) = 0\n$$\n分组各项：\n$$\n-\\frac{m}{h}q_{k+1} + \\left(\\frac{2m}{h} - kh\\right)q_k - \\frac{m}{h}q_{k-1} = 0\n$$\n乘以 $-h/m$ 并代入 $\\omega^2=k/m$：\n$$\nq_{k+1} - (2 - \\omega^2 h^2)q_k + q_{k-1} = 0\n$$\n递推关系为 $q_{k+1} = a_{\\mathrm{trap}} q_k + b_{\\mathrm{trap}} q_{k-1}$，其中\n$$\na_{\\mathrm{trap}} = 2 - \\omega^2 h^2, \\quad b_{\\mathrm{trap}} = -1\n$$\n更新矩阵 $A_{\\mathrm{trap}}$ 为\n$$\nA_{\\mathrm{trap}} = \\begin{pmatrix} a_{\\mathrm{trap}}  -1 \\\\ 1  0 \\end{pmatrix}\n$$\n特征方程为 $\\lambda^2 - a_{\\mathrm{trap}}\\lambda + 1 = 0$。当且仅当特征值为实数且非单位值时，谱半径 $\\rho(A_{\\mathrm{trap}})  1$，这发生在 $|a_{\\mathrm{trap}}|  2$ 的情况下。\n令 $x = \\omega h$。该条件变为 $|2-x^2|  2$。这在 $2-x^2  2 \\implies -x^2  0$（对于实数 $x$ 不可能）或 $2-x^2  -2 \\implies 4  x^2 \\implies x  2$（因为 $x0$）时成立。\n所以，如果 $\\omega h  2$，系统不稳定，且 $\\rho(A_{\\mathrm{trap}})  1$。\n如果 $\\omega h \\le 2$，则 $|a_{\\mathrm{trap}}| \\le 2$，特征值位于单位圆上，且 $\\rho(A_{\\mathrm{trap}}) = 1$。该方法是线性稳定的。\n如果 $\\omega h = 2$，则 $a_{\\mathrm{trap}} = 2 - 2^2 = -2$。特征方程变为 $\\lambda^2 + 2\\lambda + 1 = (\\lambda+1)^2 = 0$，得到一个重根 $\\lambda = -1$。谱半径为 $\\rho(A_{\\mathrm{trap}}) = 1$。更新矩阵是 $A_{\\mathrm{trap}} = \\begin{pmatrix} -2  -1 \\\\ 1  0 \\end{pmatrix}$。这不是单位矩阵的标量倍。因此，根据问题的第二个稳定性条件，该方法在 $\\omega h = 2$ 时不是线性稳定的。\n\n用于实现的结果摘要：\n- **中点法**：对于所有 $m, k, h  0$，$\\rho_{\\mathrm{mid}} = 1$ 且稳定。\n- **梯形法**：令 $x = \\omega h = h\\sqrt{k/m}$。\n  - 如果 $x  2$：$\\rho_{\\mathrm{trap}} = 1$ 且方法稳定。\n  - 如果 $x = 2$：$\\rho_{\\mathrm{trap}} = 1$ 但方法不稳定。\n  - 如果 $x  2$：$\\rho_{\\mathrm{trap}} = \\frac{|2-x^2| + \\sqrt{(2-x^2)^2-4}}{2}  1$ 且方法不稳定。\n\n现在将这些公式应用于测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spectral radius and stability for midpoint and trapezoidal\n    discrete Lagrangian methods for a linear oscillator.\n    \"\"\"\n    test_cases = [\n        # Case 1: (m, k, h) = (1.0 kg, 4.0 N/m, 0.2 s)\n        (1.0, 4.0, 0.2),\n        # Case 2: (m, k, h) = (1.0 kg, 4.0 N/m, 1.0 s)\n        (1.0, 4.0, 1.0),\n        # Case 3: (m, k, h) = (1.0 kg, 4.0 N/m, 1.1 s)\n        (1.0, 4.0, 1.1),\n        # Case 4: (m, k, h) = (3.0 kg, 3.0 N/m, 1.8 s)\n        (3.0, 3.0, 1.8),\n        # Case 5: (m, k, h) = (1.0 kg, 1.0 N/m, 1.0e-6 s)\n        (1.0, 1.0, 1.0e-6),\n        # Case 6: (m, k, h) = (1.0 kg, 100.0 N/m, 0.19 s)\n        (1.0, 100.0, 0.19)\n    ]\n\n    results = []\n    \n    # Use a small tolerance for floating point comparisons\n    TOL = 1e-9\n\n    for m, k, h in test_cases:\n        # --- Midpoint Method Analysis ---\n        # The spectral radius for the midpoint method is always 1,\n        # and it is unconditionally stable for m, k, h  0.\n        rho_mid = 1.0\n        stable_mid = True\n\n        # --- Trapezoidal Method Analysis ---\n        omega = np.sqrt(k / m)\n        x = omega * h\n        \n        rho_trap = 0.0\n        stable_trap = False\n\n        if x  2.0 - TOL:\n            # Conditionally stable region\n            rho_trap = 1.0\n            stable_trap = True\n        elif abs(x - 2.0) = TOL:\n            # Boundary of stability: repeated eigenvalues, non-diagonalizable matrix\n            rho_trap = 1.0\n            stable_trap = False\n        else: # x  2.0 + TOL\n            # Unstable region\n            a_trap = 2.0 - x**2\n            # a_trap will be  -2\n            # rho = (|a| + sqrt(a^2 - 4)) / 2\n            rho_trap = (abs(a_trap) + np.sqrt(a_trap**2 - 4.0)) / 2.0\n            stable_trap = False\n\n        results.extend([\n            f\"{rho_mid:.6f}\",\n            f\"{rho_trap:.6f}\",\n            str(stable_mid),\n            str(stable_trap)\n        ])\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "变分原理的威力远不止于简单的力学系统，它同样适用于解决复杂的几何问题。本练习将演示如何通过最小化离散作用量来寻找曲面（球面）上的最短路径，即测地线。我们将把在球面 $\\mathbb{S}^2$ 上寻找离散测地线的问题，表述为一个源于离散动能拉格朗日量的约束优化问题，这个编程实践将帮助你跨越理论与实际数值计算之间的鸿沟，展示如何求解离散变分原理导出的边界值问题。",
            "id": "3739622",
            "problem": "考虑一个黎曼流形，具体为嵌入在三维欧几里得空间 $\\mathbb{R}^3$ 中的单位二维球面 $\\mathbb{S}^2$，并赋予由环境欧几里得度量诱导的度量。设动能拉格朗日量为 $L(q,\\dot{q})=\\tfrac{1}{2}\\|\\dot{q}\\|^2$，其中 $q \\in \\mathbb{S}^2$ 且 $\\dot{q}$ 在点 $q$ 处与 $\\mathbb{S}^2$ 相切。离散变分原理旨在寻找一个点序列 $\\{q_0,q_1,\\dots,q_N\\} \\subset \\mathbb{S}^2$，其端点 $q_0$ 和 $q_N$ 固定，并使得与离散拉格朗日量 $L_d$ 相关联的离散作用量最小化。该离散拉格朗日量 $L_d$ 在每个时间步长上近似了 $L$ 的作用量积分。您将从变分积分器的视角出发，在完整约束 $\\|q_k\\|^2=1$（对所有 $k$ 成立）下，通过最小化离散作用量来构造离散测地线。\n\n从上述定义和离散作用量的概念出发，实现一个程序。对于下面指定的每个测试用例，该程序通过最小化离散作用量来计算连接给定端点的离散测地线序列 $\\{q_k\\}_{k=0}^N$\n$$\nS_d(\\{q_k\\}) \\equiv \\sum_{k=0}^{N-1} L_d(q_k,q_{k+1};h),\n$$\n其中离散拉格朗日量选择为\n$$\nL_d(q_k,q_{k+1};h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2,\n$$\n$h0$ 是均匀时间步长。通过引入一种与变分积分器方法论一致的约束处理策略，在所有内部节点上施加球面约束 $\\|q_k\\|^2=1$。使用一种从离散变分观点来看有理论依据的算法方法，通过在 $\\mathbb{S}^2$ 上的完整约束条件下最小化离散作用量，数值求解连接 $q_0$ 到 $q_N$ 的两点边值问题。角度必须以弧度为单位处理。\n\n您的程序必须为每个测试用例构造离散测地线，然后计算该用例指定的一个标量诊断值。最终的程序输出必须是单行文本，其中包含一个用方括号括起来的逗号分隔列表，列表内容为这些诊断值，并严格按照下面测试套件的顺序排列。\n\n使用以下测试套件：\n- 测试用例 1 (一般情况): $q_0=(0,0,1)$, $q_N=(\\sin\\theta,0,\\cos\\theta)$ 其中 $\\theta=0.6$ 弧度, $N=20$。令 $h=\\tfrac{1}{N}$。计算沿离散路径的总球面弧长，\n$$\n\\ell_{\\mathrm{disc}} \\equiv \\sum_{k=0}^{N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\n并返回其与真实最短球面距离 $\\ell_{\\mathrm{true}}=\\arccos(q_0\\cdot q_N)=\\theta$ 的绝对差，即输出浮点数 $|\\ell_{\\mathrm{disc}}-\\ell_{\\mathrm{true}}|$。\n- 测试用例 2 (边界条件情况): $q_0=(0,0,1)$, $q_N=(0,0,1)$, $N=10$。令 $h=\\tfrac{1}{N}$。计算沿离散路径的相邻节点之间的最大球面弧长，\n$$\n\\max_{0\\le k \\le N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\n并返回此浮点数。\n- 测试用例 3 (近对跖点边缘情况): $q_0=(0,0,1)$, $q_N=(\\sin\\phi,0,\\cos\\phi)$ 其中 $\\phi=\\pi-0.01$ 弧度, $N=50$。令 $h=\\tfrac{1}{N}$。通过寻找一个单位法向量 $n\\in\\mathbb{R}^3$ 来使离差平方和 $\\sum_{k=0}^N (n\\cdot q_k)^2$ 最小化，从而为计算出的离散路径拟合一个通过原点的最佳平面。计算均方根平面度偏差\n$$\n\\sqrt{\\frac{1}{N+1}\\sum_{k=0}^N (n\\cdot q_k)^2},\n$$\n并返回此浮点数。\n\n所有角度都必须是弧度。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3]”）。每个测试用例的结果必须是浮点数。您实现的方法必须基于上述离散变分力学框架，从动能拉格朗日量和一致的离散作用量出发，并且必须通过在整个路径构造过程中施加球面约束来确保科学真实性和数值合理性。",
            "solution": "该问题要求通过最小化离散作用量来计算单位二维球面 $\\mathbb{S}^2$ 上的离散测地线。这项任务根植于离散变分力学的原理，这是几何力学的一个子领域，旨在在数值模拟中保持力学系统的几何和结构特性。\n\n其理论基础是最小作用量原理。对于一个位形为 $q(t)$、拉格朗日量为 $L(q, \\dot{q})$ 的连续系统，在时间区间 $[t_a, t_b]$ 内连接点 $q_a$ 和 $q_b$ 的轨迹是使作用量积分 $S = \\int_{t_a}^{t_b} L(q(t), \\dot{q}(t)) dt$ 取极值的路径。对于黎曼流形上的一个自由粒子，测地线是使该作用量最小化的曲线，其动能拉格朗日量为 $L(q, \\dot{q}) = \\frac{1}{2} m \\|\\dot{q}\\|^2$。这里，我们考虑单位质量 $m=1$ 的粒子在球面 $\\mathbb{S}^2$ 上运动，因此 $L(q, \\dot{q}) = \\frac{1}{2}\\|\\dot{q}\\|^2$，其中范数是由 $\\mathbb{R}^3$ 的环境欧几里得度量诱导的。\n\n离散变分力学用离散点序列 $\\{q_k\\}_{k=0}^N$ 替代连续路径 $q(t)$，其中对于固定的时间步长 $h$，$q_k \\approx q(t_k)$ 且 $t_k = kh$。作用量积分 $S$ 由一个离散和，即离散作用量 $S_d$ 来近似：\n$$\nS[q(t)] = \\int_0^{Nh} L(q(t), \\dot{q}(t)) dt \\approx S_d(\\{q_k\\}) = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}; h)\n$$\n此处，$L_d(q_k, q_{k+1}; h)$ 是一个离散拉格朗日量，它近似了连续拉格朗日量在单个时间步长上的积分，即 $L_d(q_k, q_{k+1}; h) \\approx \\int_{kh}^{(k+1)h} L dt$。问题中给出的一个简单而常见的选择是基于 $\\dot{q}$ 的有限差分近似：\n$$\nL_d(q_k, q_{k+1}; h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2\n$$\n这与 $h \\cdot L\\left(q, (q_{k+1}-q_k)/h\\right)$ 成正比，是一个有效的一阶近似。\n\n离散测地线是使 $S_d$ 在给定约束条件下取极值的序列 $\\{q_k\\}$。端点 $q_0$ 和 $q_N$ 是固定的。内部点 $\\{q_k\\}_{k=1}^{N-1}$ 必须位于球面上，这施加了完整约束：\n$$\ng_k(q_k) = \\|q_k\\|^2 - 1 = 0 \\quad \\text{for } k=1, \\dots, N-1\n$$\n因此，问题被转化为一个约束优化问题：\n$$\n\\min_{q_1, \\dots, q_{N-1}} S_d(\\{q_k\\}) \\quad \\text{subject to} \\quad \\|q_k\\|^2 = 1 \\text{ for } k=1, \\dots, N-1\n$$\n让我们来分析目标函数。我们希望最小化 $S_d = \\sum_{k=0}^{N-1} \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2$。由于 $h$ 是一个正常数，这等价于最小化 $\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2$。展开范数并应用约束 $\\|q_k\\|^2=1$（对所有 $k$ 成立，包括给定在球面上的端点），可得：\n$$\n\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2 = \\sum_{k=0}^{N-1} (q_{k+1} - q_k) \\cdot (q_{k+1} - q_k) = \\sum_{k=0}^{N-1} (\\|q_{k+1}\\|^2 - 2 q_k \\cdot q_{k+1} + \\|q_k\\|^2)\n$$\n$$\n= \\sum_{k=0}^{N-1} (1 - 2 q_k \\cdot q_{k+1} + 1) = \\sum_{k=0}^{N-1} (2 - 2 q_k \\cdot q_{k+1}) = 2N - 2 \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}\n$$\n最小化此表达式等价于最大化点积之和 $\\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$。这有一个清晰的几何解释：路径被尽可能地拉直，因为 $q_k \\cdot q_{k+1} = \\cos(\\alpha_k)$，其中 $\\alpha_k$ 是相继向量之间的夹角。最大化此和即是最小化沿路径的角度变化。\n\n该问题因此可为数值求解器构建如下：\n- **变量**：一个向量 $x \\in \\mathbb{R}^{3(N-1)}$，表示内部点 $\\{q_1, \\dots, q_{N-1}\\}$ 的展平坐标。\n- **目标函数**：最小化 $f(x) = - \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$。\n- **约束**：$N-1$ 个等式约束的集合，$g_k(x) = \\|q_k\\|^2 - 1 = 0$，其中 $q_k$ 从 $x$ 的相应分段重构。\n\n这是一个标准的非线性规划问题，可以使用 `scipy.optimize.minimize` 中的序列最小二乘规划（SLSQP）方法求解。迭代求解器需要一个合适的路径初始猜测值才能高效收敛。球面线性插值（slerp）是理想选择，但一个更简单有效的替代方法是在 $q_0$ 和 $q_N$ 之间进行线性插值，然后将每个中间点投影到单位球面上。\n\n诊断计算在优化后的离散路径 $\\{q_k\\}_{k=0}^N$ 上执行：\n1.  **总球面弧长**：$\\ell_{\\mathrm{disc}} = \\sum_{k=0}^{N-1} \\arccos(q_k \\cdot q_{k+1})$。该值与真实最短距离 $\\ell_{\\mathrm{true}}=\\arccos(q_0 \\cdot q_N)$ 进行比较。为防止 `arccos` 出现数值错误，其参数被裁剪到区间 $[-1, 1]$ 内。\n2.  **最大分段长度**：$\\max_{k} \\arccos(q_k \\cdot q_{k+1})$，它测量沿路径的最大单步长度。对于 $q_0=q_N$ 的情况，最小作用量路径是平凡的（对所有 $k$ 都有 $q_k=q_0$），因此该诊断值应为 $0$。\n3.  **均方根平面度偏差**：$\\mathbb{S}^2$ 上的真正测地线是一个大圆，位于一个穿过原点的平面内。离散路径的平面度通过找到最佳拟合点集 $\\{q_k\\}$ 的平面的单位法向量 $n$ 来评估。这是通过在 $\\|n\\|^2 = 1$ 的约束下最小化投影平方和 $\\sum_{k=0}^N (n \\cdot q_k)^2$ 来完成的。这是一个经典的线性代数问题：最小和是二阶矩矩阵 $M = \\sum_{k=0}^N q_k q_k^T$ 的最小特征值 $\\lambda_{\\min}$。均方根偏差即为 $\\sqrt{\\lambda_{\\min}/(N+1)}$。\n\n实现将此逻辑封装在一个函数中，该函数为每个测试用例设置并求解优化问题以找到离散测地线，然后计算指定的诊断值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n\n    def solve_case(q0, qN, N):\n        \"\"\"\n        Solves for the discrete geodesic for a single test case.\n\n        Args:\n            q0 (np.ndarray): Starting point on the sphere.\n            qN (np.ndarray): Ending point on the sphere.\n            N (int): Number of segments in the path.\n\n        Returns:\n            np.ndarray: The optimized path as a sequence of (N+1) points.\n        \"\"\"\n        # 1. Initial guess for the interior points {q_1, ..., q_{N-1}}\n        # Linear interpolation between endpoints, then project to the sphere.\n        if np.allclose(q0, qN):\n            q_init = np.tile(q0, (N - 1, 1))\n        else:\n            q_init = np.array([q0 + (k / N) * (qN - q0) for k in range(1, N)])\n            norms = np.linalg.norm(q_init, axis=1, keepdims=True)\n            # Avoid division by zero if an interpolated point is the origin\n            # (not expected for the given test cases).\n            q_init /= np.where(norms  1e-12, norms, 1.0)\n        \n        x0 = q_init.flatten()\n\n        # 2. Objective function to be minimized\n        # We minimize -sum(q_k . q_{k+1}), which is equivalent to maximizing the sum\n        # of dot products, and thus minimizing the original discrete action.\n        def objective_func(x, q0_v=q0, qN_v=qN, num_segs=N):\n            path = np.vstack([q0_v, x.reshape(num_segs - 1, 3), qN_v])\n            # Element-wise product and sum over axes gives dot products\n            dots = np.sum(path[:-1] * path[1:], axis=1)\n            return -np.sum(dots)\n\n        # 3. Constraints: ||q_k||^2 - 1 = 0 for k = 1, ..., N-1\n        constraints = []\n        for k in range(N - 1):\n            def constraint_factory(k_idx):\n                def constraint_func(x):\n                    q_k = x[3 * k_idx : 3 * (k_idx + 1)]\n                    return np.dot(q_k, q_k) - 1.0\n                return constraint_func\n            constraints.append({'type': 'eq', 'fun': constraint_factory(k)})\n\n        # 4. Optimization\n        res = minimize(\n            objective_func,\n            x0,\n            method='SLSQP',\n            constraints=constraints,\n            options={'maxiter': 1000, 'ftol': 1e-10}\n        )\n\n        if not res.success:\n            # Fallback or error, though not expected for this problem.\n            # For robustness, could return the initial guess path.\n            print(f\"Warning: Optimization failed for case N={N}. Message: {res.message}\")\n            x_opt = x0\n        else:\n            x_opt = res.x\n\n        # 5. Reconstruct the full optimized path {q_0, ..., q_N}\n        optimized_path = np.vstack([q0, x_opt.reshape(N - 1, 3), qN])\n        return optimized_path\n\n    results = []\n\n    # === Test Case 1 ===\n    theta_1 = 0.6\n    q0_1 = np.array([0.0, 0.0, 1.0])\n    qN_1 = np.array([np.sin(theta_1), 0.0, np.cos(theta_1)])\n    N_1 = 20\n    path_1 = solve_case(q0_1, qN_1, N_1)\n    dots_1 = np.sum(path_1[:-1] * path_1[1:], axis=1)\n    dots_1 = np.clip(dots_1, -1.0, 1.0) # For numerical stability of arccos\n    l_disc_1 = np.sum(np.arccos(dots_1))\n    l_true_1 = theta_1 # Since arccos(q0 . qN) = theta\n    res_1 = np.abs(l_disc_1 - l_true_1)\n    results.append(res_1)\n\n    # === Test Case 2 ===\n    q0_2 = np.array([0.0, 0.0, 1.0])\n    qN_2 = np.array([0.0, 0.0, 1.0])\n    N_2 = 10\n    path_2 = solve_case(q0_2, qN_2, N_2)\n    dots_2 = np.sum(path_2[:-1] * path_2[1:], axis=1)\n    dots_2 = np.clip(dots_2, -1.0, 1.0)\n    res_2 = np.max(np.arccos(dots_2))\n    results.append(res_2)\n\n    # === Test Case 3 ===\n    phi_3 = np.pi - 0.01\n    q0_3 = np.array([0.0, 0.0, 1.0])\n    qN_3 = np.array([np.sin(phi_3), 0.0, np.cos(phi_3)])\n    N_3 = 50\n    path_3 = solve_case(q0_3, qN_3, N_3)\n    # Fit best plane by finding the normal n that minimizes sum((n.q_k)^2).\n    # This n is the eigenvector of the moment matrix M = sum(q_k * q_k.T)\n    # corresponding to the smallest eigenvalue.\n    M = path_3.T @ path_3 # M_ij = sum_k q_k[i] * q_k[j]\n    # np.linalg.eigh is for Hermitian (symmetric) matrices and returns sorted eigenvalues.\n    eigenvalues, _ = np.linalg.eigh(M)\n    lambda_min = eigenvalues[0] # The smallest eigenvalue\n    # The minimum sum of squares is lambda_min.\n    # The RMS deviation is sqrt( (sum of squares) / (number of points) )\n    res_3 = np.sqrt(lambda_min / (N_3 + 1))\n    results.append(res_3)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}