{
    "hands_on_practices": [
        {
            "introduction": "几何积分的一个强大技术是从简单的低阶对称方法构建高阶方法。本练习将指导您推导著名的“三重跳跃”（triple jump）组合的系数，这是构建四阶格式的基石。通过这个过程，您将深入理解如何通过消除低阶误差项来提升积分器的精度。",
            "id": "3767698",
            "problem": "考虑一个辛流形上的可分哈密顿系统，其哈密顿量为 $H(q,p)=T(p)+V(q)$，其精确时间-$h$流为 $\\exp(h L_{H})$，其中 $L_{H}$ 是生成哈密顿流的李算子。令 $A=L_{T}$ 和 $B=L_{V}$ 分别表示动能和势能部分的李算子，因此 $L_{H}=A+B$。Strang 分裂 $S(h)=\\exp\\!\\left(\\frac{h}{2}A\\right)\\exp(h B)\\exp\\!\\left(\\frac{h}{2}A\\right)$ 是一种对称二阶方法。更一般地，假设 $S(h)$ 是用于 $\\exp(h(A+B))$ 的任意对称二阶单参数方法，其修正生成子具有以下形式展开：\n$$\n\\log S(h)=h L+h^{3}E_{3}+h^{5}E_{5}+\\cdots,\n$$\n其中 $L=A+B$，而 $E_{3},E_{5},\\dots$ 是 $A$ 和 $B$ 中与 $h$ 无关的李多项式。\n\n遵循高阶对称组合的思想（由 Masuo Suzuki、Haruo Yoshida 和 Robert McLachlan 发展），定义回文三重组合\n$$\nC(h)=S(a h)\\,S(b h)\\,S(a h),\n$$\n其中 $a$ 和 $b$ 为实系数。仅利用对称积分子的基本性质、Baker–Campbell–Hausdorff (BCH) 级数的结构，以及时间可逆对称方法的修正生成子仅包含 $h$ 的奇次幂这一事实，推导为使 $C(h)$ 成为四阶方法，$a$ 和 $b$ 必须满足的阶条件，并求解这些条件以得到满足 $a>0$ 的实数 $a$ 和 $b$。\n\n你的最终答案必须是关于数对 $(a,b)$ 的单一闭式解析表达式，并精确写出（不得取整）。如果存在多个值，请将它们写成一个 $1\\times 2$ 矩阵的单行。",
            "solution": "该问题要求推导将一个二阶对称数值积分子通过对称三重组合提升至四阶精度所需的阶条件。给定一个基础对称方法 $S(h)$，其修正生成子 $\\tilde{L}(h) = \\log S(h)$ 具有关于步长 $h$ 的奇次幂展开：\n$$\n\\tilde{L}(h) = \\log S(h) = h L + h^{3}E_{3} + h^{5}E_{5} + \\cdots\n$$\n这里，$L = A+B$ 是精确系统的李算子，$E_{k}$ 是 $A$ 和 $B$ 中的李多项式，代表了该方法的误差项。由于 $S(h)$ 是一个二阶方法，其主误差项 $E_{3}$ 的系数非零。\n\n组合方法定义为回文三重组合：\n$$\nC(h) = S(a h)\\,S(b h)\\,S(a h)\n$$\n其中 $a$ 和 $b$ 是实系数。我们旨在找到使 $C(h)$ 成为四阶方法的关于 $a$ 和 $b$ 的条件。如果一个方法的修正生成子与精确生成子 $hL$ 匹配到 $O(h^{p+1})$ 阶，则该方法是 $p$ 阶的。对于一个四阶方法，其修正生成子的形式必须是 $hL + O(h^{5})$。\n\n组合方法 $C(h)$ 可以用指数映射和 $S(h)$ 的修正生成子表示：\n$$\nC(h) = \\exp(\\tilde{L}(ah)) \\exp(\\tilde{L}(bh)) \\exp(\\tilde{L}(ah))\n$$\n该组合方法的修正生成子 $\\hat{L}(h) = \\log C(h)$ 可通过应用 Baker-Campbell-Hausdorff (BCH) 公式得到。给定组合的一个关键性质是其对称性。由于 $S(h)$ 是对称的，即 $S(-h) = S(h)^{-1}$，所以组合 $C(h)$ 也是对称的：\n$$\nC(-h) = S(-ah)S(-bh)S(-ah) = S(ah)^{-1}S(bh)^{-1}S(ah)^{-1} = (S(ah)S(bh)S(ah))^{-1} = C(h)^{-1}\n$$\n几何积分理论中的一个基本结论是，任何对称方法的修正生成子只包含步长 $h$ 的奇次幂。因此，$\\hat{L}(h)$ 的展开式必须具有以下形式：\n$$\n\\hat{L}(h) = c_{1}hL + c_{3}h^{3}E_{3} + c_{5}h^{5}E_{5} + \\cdots + (\\text{新误差项})\n$$\n新误差项源于 $\\tilde{L}(h)$ 展开式中各项的对易子。\n\n系数 $c_{k}$ 可以通过形式上应用 BCH 公式来确定。指数上算子的和为：\n$$\n\\hat{L}(h) = \\tilde{L}(ah) \\oplus \\tilde{L}(bh) \\oplus \\tilde{L}(ah)\n$$\n其中 $\\oplus$ 表示由 BCH 公式给出的和。BCH 级数的首项是其各项的简单加和。高阶项是嵌套的对易子。将 $\\tau = ah$ 和 $\\tau = bh$ 的展开式 $\\tilde{L}(\\tau) = \\tau L + \\tau^{3}E_{3} + \\dots$ 代入，我们得到 $\\hat{L}(h)$ 的级数：\n$$\n\\hat{L}(h) = (ahL + a^{3}h^{3}E_{3} + \\dots) + (bhL + b^{3}h^{3}E_{3} + \\dots) + (ahL + a^{3}h^{3}E_{3} + \\dots) + O(\\text{对易子})\n$$\n按 $h$ 的幂次和李多项式的类型收集各项，得到：\n$$\n\\hat{L}(h) = (2a+b)hL + (2a^{3}+b^{3})h^{3}E_{3} + \\cdots\n$$\n涉及对易子（如 $[L, E_{3}]$）的项出现在 $h^{5}$ 阶及更高阶。例如，来自 BCH 公式的第一个对易子项 $\\frac{1}{2}[\\tilde{L}(ah), \\tilde{L}(bh)]$ 将以 $h^{4}$ 阶项开始，但由于组合的对称性，$\\hat{L}(h)$ 的最终修正生成子中所有偶次幂项都必须消失。因此，原始误差项 $E_k$ 的系数就是组合中每个阶段系数的总和。\n\n为了使 $C(h)$ 成为一个四阶方法，其修正生成子 $\\hat{L}(h)$ 必须等于 $hL + O(h^{5})$。这对系数 $a$ 和 $b$ 施加了两个条件：\n\n1.  $hL$ 的系数必须为 $1$。这确保了该方法在正确的时间跨度上近似流。\n    $$2a+b = 1$$\n\n2.  $h^{3}E_{3}$ 的系数必须为 $0$。这消除了基础方法的主误差项，将精度阶从 $2$ 提升到至少 $4$。由于 $E_{3} \\neq 0$，其系数必须为零。\n    $$2a^{3}+b^{3} = 0$$\n\n我们现在求解这个由两个非线性方程组成的方程组，以求得实数 $a$ 和 $b$，并附加约束条件 $a>0$。\n从第一个方程，我们用 $a$ 表示 $b$：\n$$b = 1 - 2a$$\n将此代入第二个方程：\n$$2a^{3} + (1 - 2a)^{3} = 0$$\n这可以改写为：\n$$2a^{3} = -(1 - 2a)^{3} = (2a - 1)^{3}$$\n为了求出 $a$ 的实数解，我们对两边取实立方根：\n$$ \\sqrt[3]{2} a = 2a - 1 $$\n重新整理各项以求解 $a$：\n$$ 1 = 2a - \\sqrt[3]{2} a $$\n$$ 1 = a(2 - \\sqrt[3]{2}) $$\n$$ a = \\frac{1}{2 - 2^{1/3}} $$\n由于 $2^{1/3} \\approx 1.26  2$，分母为正，因此 $a > 0$，符合要求。$a$ 的另外两个根是复数，因此被舍弃。\n\n现在我们求出 $b$ 的相应值：\n$$ b = 1 - 2a = 1 - 2\\left(\\frac{1}{2 - 2^{1/3}}\\right) = 1 - \\frac{2}{2 - 2^{1/3}} $$\n$$ b = \\frac{(2 - 2^{1/3}) - 2}{2 - 2^{1/3}} = \\frac{-2^{1/3}}{2 - 2^{1/3}} $$\n将二阶对称方法提升到四阶的系数对 $(a,b)$ 为：\n$$ (a,b) = \\left( \\frac{1}{2 - 2^{1/3}}, \\frac{-2^{1/3}}{2 - 2^{1/3}} \\right) $$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2 - 2^{1/3}}  \\frac{-2^{1/3}}{2 - 2^{1/3}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "推导系数只是第一步；真正的理解来自于实践。本练习要求您为之前推导的四阶方法  编写代码，并将其应用于基本模型系统——谐振子。您将通过数值实验验证该方法的关键特性：其精度阶数、时间可逆性以及出色的长期能量保持特性。",
            "id": "3767700",
            "problem": "考虑一个可分哈密顿系统，其相空间坐标为 $q \\in \\mathbb{R}$ 和 $p \\in \\mathbb{R}$，哈密顿量为 $H(q,p) = T(p) + V(q)$，且其正则辛形式在哈密顿方程的流作用下保持不变。该系统根据哈密顿方程 $dq/dt = \\partial T/\\partial p$ 和 $dp/dt = -\\partial V/\\partial q$ 演化。对于 $T(p) = \\tfrac{1}{2} p^2$ 和 $V(q) = \\tfrac{1}{2} \\omega^2 q^2$ 的特定情况，其中角频率 $\\omega  0$ 为常数，其精确解由相空间中的线性旋转给出：\n$$\nq(t) = q_0 \\cos(\\omega t) + \\frac{p_0}{\\omega} \\sin(\\omega t), \\quad p(t) = p_0 \\cos(\\omega t) - \\omega q_0 \\sin(\\omega t).\n$$\n定义分裂的向量场 $A$ 和 $B$，$A$ 生成 $T$ 的流，$B$ 生成 $V$ 的流。$A$ 和 $B$ 在时间步长 $h$ 内的精确流为：\n$$\n\\phi_A^h(q,p) = (q + h p, \\, p), \\qquad \\phi_B^h(q,p) = (q, \\, p - h \\omega^2 q).\n$$\n一个对称二阶方法是 Strang 分裂 $\\mathsf{S}_h = \\phi_B^{h/2} \\circ \\phi_A^h \\circ \\phi_B^{h/2}$，该方法是自伴和保辛的。可以通过将此二阶方法与缩放的时间步长进行组合，来构造一个无对易子 (CF) 的对称四阶组合方法：\n$$\n\\Psi_h = \\mathsf{S}_{\\gamma_1 h} \\circ \\mathsf{S}_{\\gamma_2 h} \\circ \\mathsf{S}_{\\gamma_1 h},\n$$\n其中 $\\gamma_1$ 和 $\\gamma_2$ 是待定的实系数，它们需要根据对称性和从 Baker–Campbell–Hausdorff (BCH) 展开以及 $\\mathsf{S}_h$ 的自伴性推导出的四阶条件来确定。该构造必须是无对易子的，这意味着其实现仅使用精确流 $\\phi_A^h$ 和 $\\phi_B^h$ 的组合，而无需显式计算 $A$ 和 $B$ 的任何对易子。从哈密顿流的定义和对称组合方法可以通过适当系数达到四阶这一经过充分检验的事实出发，推导出 $\\gamma_1$ 和 $\\gamma_2$ 所需的方程，该推导基于一致性和主导误差项的抵消，并求出 $\\gamma_1$ 和 $\\gamma_2$ 的显式值。\n\n实现方法 $\\Psi_h$ 并将其应用于由 $T(p) = \\tfrac{1}{2} p^2$ 和 $V(q) = \\tfrac{1}{2} \\omega^2 q^2$ 定义的谐振子。你的程序必须计算以下五个测试用例；当要求计算误差时，计算相空间中的欧几里得范数误差，即 $\\sqrt{(q - q_{\\mathrm{exact}})^2 + (p - p_{\\mathrm{exact}})^2}$。角度和三角函数必须使用弧度。\n\n- 测试用例 1 (通用精度检查): 参数 $(q_0, p_0, \\omega, h, N) = (1.0, 0.3, 1.7, 0.1, 100)$，总积分时间 $T = N h$。以浮点数形式输出相空间误差。\n\n- 测试用例 2 (边界条件恒等性): 参数 $(q_0, p_0, \\omega, h, N) = (0.5, -0.8, 2.0, 0.1, 0)$，总积分时间 $T = 0$。以浮点数形式输出相空间误差。\n\n- 测试用例 3 (时间反演对称性): 参数 $(q_0, p_0, \\omega, h) = (0.9, -0.4, 1.3, 0.2)$。从 $(q_0, p_0)$ 开始，应用一个正向步长 $\\Psi_h$ 和一个反向步长 $\\Psi_{-h}$，并输出一个布尔值，指示返回状态是否在 $q$ 和 $p$ 上的绝对容差 $10^{-12}$ 内与初始状态相等。\n\n- 测试用例 4 (长时间能量行为): 参数 $(q_0, p_0, \\omega, h, N) = (1.0, 0.1, 3.0, 0.01, 1000)$，总积分时间 $T = N h$。使用 $H(q,p) = \\tfrac{1}{2} p^2 + \\tfrac{1}{2} \\omega^2 q^2$ 计算绝对能量差 $|H(q_N,p_N) - H(q_0,p_0)|$。以浮点数形式输出此能量变化。\n\n- 测试用例 5 (固定最终时间的观测阶): 参数 $(q_0, p_0, \\omega, T, h_1, h_2) = (0.7, -0.2, 2.2, 2.0, 0.2, 0.1)$，其中 $N_1 = T/h_1$ 和 $N_2 = T/h_2$ 为整数。在固定的时间 $T$ 内，计算步长为 $h_1$ 和 $h_2$ 时的相空间误差 $E_1$ 和 $E_2$，并以浮点数形式输出观测阶 $p_{\\mathrm{obs}} = \\log_2(E_1/E_2)$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，`[result1,result2,result3,result4,result5]`）。除了三角函数求值隐式使用弧度外，不涉及任何单位，所有输出必须是指定的无量纲数字或布尔值。实现必须是自包含的，不得读取任何输入或访问外部资源。数值方法必须严格使用所描述的无对易子对称组合，并且系数必须在你的解决方案中从第一性原理推导出来。",
            "solution": "该问题是有效的。其科学基础在于哈密顿力学和几何数值积分的原理，特别是对称组合方法的理论。该问题是适定的，提供了所有必要的定义、方程和参数，以推导所需的系数并执行指定的数值测试。所有术语都得到了正式且无歧义的定义，目标是客观且可验证的。\n\n任务是推导四阶对称组合方法的系数，并将其应用于谐振子。该方法记为 $\\Psi_h$，是通过将一个二阶对称方法，即 Strang 分裂 $\\mathsf{S}_h$，与缩放的时间步长进行组合而构造的：\n$$\n\\Psi_h = \\mathsf{S}_{\\gamma_1 h} \\circ \\mathsf{S}_{\\gamma_2 h} \\circ \\mathsf{S}_{\\gamma_1 h}\n$$\n方法 $\\mathsf{S}_h$ 是一个阶为 $p=2$ 的对称积分器。形式为 $\\Psi_h = \\mathsf{S}_{\\alpha_1 h} \\circ \\dots \\circ \\mathsf{S}_{\\alpha_m h}$ 的一个 $2p$ 阶对称方法的组合本身也是一个对称方法。为了确定其阶数，我们参考修正方程理论和 Baker-Campbell-Hausdorff (BCH) 公式。\n\n像 Strang 分裂这样的对称二阶方法的流可以表示为一个修正李算子级数的指数，由于对称性，该级数只包含步长 $h$ 的偶数次幂：\n$$\n\\mathsf{S}_h \\leftrightarrow \\exp\\left(h(L_A+L_B) + c_3 h^3 L_{\\text{err},3} + c_5 h^5 L_{\\text{err},5} + \\dots \\right)\n$$\n其中 $L_A$ 和 $L_B$ 分别是与向量场 $T(p)$ 和 $V(q)$ 相关联的李导数，而 $L_{\\text{err},k}$ 是对应于由 $L_A$ 和 $L_B$ 的嵌套对易子组成的更高阶误差项的李算子。\n\n组合方法 $\\Psi_h$ 对应于这些指数映射的复合。得到的李算子可通过应用 BCH 公式找到。对于一个对称方法的对称组合，使其结果达到某一特定阶数的条件是已经确立的。\n\n首先，为了使方法保持一致性，时间步长的总和必须等于总时间步长 $h$。我们组合中的步长是 $\\gamma_1 h$、$\\gamma_2 h$ 和 $\\gamma_1 h$。因此，我们必须有：\n$$\n(\\gamma_1 h) + (\\gamma_2 h) + (\\gamma_1 h) = h\n$$\n这给出了我们的第一个方程，它确保了该方法至少是一阶的（并因对称性而是二阶的）：\n$$\n2\\gamma_1 + \\gamma_2 = 1 \\quad (1)\n$$\n\n其次，要将一个阶为 $2p$ 的对称方法的组合阶数提高到 $2p+2$，系数的 $(2p+1)$ 次幂之和必须为零。对于 Strang 分裂，其阶为 $2p=2$，因此 $p=1$。为达到四阶精度（$2p+2=4$），我们必须消除阶为 $h^{2p+1} = h^3$ 的主导误差项。条件是：\n$$\n\\sum_{i=1}^3 \\gamma_i^{2p+1} = \\sum_{i=1}^3 \\gamma_i^3 = 0\n$$\n将此应用于我们的系数序列 $(\\gamma_1, \\gamma_2, \\gamma_1)$，我们得到第二个方程：\n$$\n\\gamma_1^3 + \\gamma_2^3 + \\gamma_1^3 = 0\n$$\n$$\n2\\gamma_1^3 + \\gamma_2^3 = 0 \\quad (2)\n$$\n\n我们现在得到了一个关于两个未知数 $\\gamma_1$ 和 $\\gamma_2$ 的代数方程组：\n1. $2\\gamma_1 + \\gamma_2 = 1$\n2. $2\\gamma_1^3 + \\gamma_2^3 = 0$\n\n从方程 (2)，我们可以写出 $\\gamma_2^3 = -2\\gamma_1^3$。对两边取实数立方根，得到：\n$$\n\\gamma_2 = -(2)^{1/3} \\gamma_1\n$$\n现在，我们将这个关于 $\\gamma_2$ 的表达式代入方程 (1)：\n$$\n2\\gamma_1 + (-(2)^{1/3} \\gamma_1) = 1\n$$\n提取 $\\gamma_1$：\n$$\n\\gamma_1 (2 - 2^{1/3}) = 1\n$$\n这得出了 $\\gamma_1$ 的显式值：\n$$\n\\gamma_1 = \\frac{1}{2 - 2^{1/3}}\n$$\n然后我们可以求出 $\\gamma_2 = 1 - 2\\gamma_1$：\n$$\n\\gamma_2 = 1 - 2\\left(\\frac{1}{2 - 2^{1/3}}\\right) = \\frac{(2 - 2^{1/3}) - 2}{2 - 2^{1/3}} = \\frac{-2^{1/3}}{2 - 2^{1/3}}\n$$\n这些就是四阶无对易子对称组合方法所需的系数。\n\n实现过程将首先为基本流 $\\phi_A^h$ 和 $\\phi_B^h$ 定义 Python 函数，然后将它们组合成 Strang 分裂 $\\mathsf{S}_h = \\phi_B^{h/2} \\circ \\phi_A^h \\circ \\phi_B^{h/2}$，最后用推导出的系数 $\\gamma_1$ 和 $\\gamma_2$ 组合 $\\mathsf{S}_h$ 以构成四阶方法 $\\Psi_h = \\mathsf{S}_{\\gamma_1 h} \\circ \\mathsf{S}_{\\gamma_2 h} \\circ \\mathsf{S}_{\\gamma_1 h}$ 的一个步骤。一个循环将应用 $\\Psi_h$ 所需的步数 $N$ 来获得最终状态。测试用例将基于此实现进行评估。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives coefficients for a 4th-order symmetric integrator,\n    implements it, and runs a series of test cases for the harmonic oscillator.\n    \"\"\"\n    \n    # 1. DERIVE COEFFICIENTS for the symmetric composition\n    # Psi_h = S_{gamma1*h} o S_{gamma2*h} o S_{gamma1*h}\n    # where S is a 2nd-order symmetric method.\n    # Conditions for 4th order are:\n    # 1) 2*gamma1 + gamma2 = 1\n    # 2) 2*gamma1^3 + gamma2^3 = 0\n    # From (2), gamma2 = -cbrt(2)*gamma1.\n    # Substitute into (1): 2*gamma1 - cbrt(2)*gamma1 = 1\n    # = gamma1 * (2 - cbrt(2)) = 1\n    cbrt2 = 2**(1/3)\n    gamma1 = 1.0 / (2.0 - cbrt2)\n    gamma2 = 1.0 - 2.0 * gamma1\n\n    # 2. DEFINE THE NUMERICAL METHOD COMPONENTS\n    \n    def phi_A(q, p, h):\n        \"\"\"Exact flow for T(p) = p^2/2.\"\"\"\n        return q + h * p, p\n\n    def phi_B(q, p, h, omega_sq):\n        \"\"\"Exact flow for V(q) = omega^2*q^2/2.\"\"\"\n        return q, p - h * omega_sq * q\n\n    def strang_splitting(q, p, h, omega_sq):\n        \"\"\"Second-order Strang splitting S_h.\"\"\"\n        q1, p1 = phi_B(q, p, h / 2.0, omega_sq)\n        q2, p2 = phi_A(q1, p1, h)\n        q_new, p_new = phi_B(q2, p2, h / 2.0, omega_sq)\n        return q_new, p_new\n\n    def psi_step(q, p, h, omega_sq):\n        \"\"\"One step of the 4th-order symmetric composition method Psi_h.\"\"\"\n        q1, p1 = strang_splitting(q, p, gamma1 * h, omega_sq)\n        q2, p2 = strang_splitting(q1, p1, gamma2 * h, omega_sq)\n        q_new, p_new = strang_splitting(q2, p2, gamma1 * h, omega_sq)\n        return q_new, p_new\n\n    def integrate(q0, p0, omega, h, N):\n        \"\"\"Integrate the system for N steps.\"\"\"\n        q, p = q0, p0\n        omega_sq = omega**2\n        for _ in range(N):\n            q, p = psi_step(q, p, h, omega_sq)\n        return q, p\n\n    # 3. DEFINE UTILITY FUNCTIONS FOR TESTS\n    \n    def exact_solution(q0, p0, omega, t):\n        \"\"\"Exact solution of the harmonic oscillator.\"\"\"\n        if omega == 0:\n            return q0 + p0*t, p0\n        cos_wt = np.cos(omega * t)\n        sin_wt = np.sin(omega * t)\n        q_exact = q0 * cos_wt + (p0 / omega) * sin_wt\n        p_exact = p0 * cos_wt - omega * q0 * sin_wt\n        return q_exact, p_exact\n\n    def hamiltonian(q, p, omega):\n        \"\"\"Hamiltonian of the harmonic oscillator.\"\"\"\n        return 0.5 * p**2 + 0.5 * omega**2 * q**2\n\n    # 4. RUN TEST CASES\n    \n    test_cases = [\n        # TC1: (q0, p0, omega, h, N) = (1.0, 0.3, 1.7, 0.1, 100)\n        (1.0, 0.3, 1.7, 0.1, 100),\n        # TC2: (q0, p0, omega, h, N) = (0.5, -0.8, 2.0, 0.1, 0)\n        (0.5, -0.8, 2.0, 0.1, 0),\n        # TC3: (q0, p0, omega, h) = (0.9, -0.4, 1.3, 0.2)\n        (0.9, -0.4, 1.3, 0.2), # Special handling by index\n        # TC4: (q0, p0, omega, h, N) = (1.0, 0.1, 3.0, 0.01, 1000)\n        (1.0, 0.1, 3.0, 0.01, 1000),\n        # TC5: (q0, p0, omega, T, h1, h2) = (0.7, -0.2, 2.2, 2.0, 0.2, 0.1)\n        (0.7, -0.2, 2.2, 2.0, 0.2, 0.1) # Special handling by index\n    ]\n    \n    results = []\n    \n    # Test Case 1\n    q0, p0, omega, h, N = test_cases[0]\n    T = N * h\n    q_num, p_num = integrate(q0, p0, omega, h, N)\n    q_ex, p_ex = exact_solution(q0, p0, omega, T)\n    error1 = np.sqrt((q_num - q_ex)**2 + (p_num - p_ex)**2)\n    results.append(error1)\n\n    # Test Case 2\n    q0, p0, omega, h, N = test_cases[1]\n    T = N * h\n    q_num, p_num = integrate(q0, p0, omega, h, N)\n    q_ex, p_ex = exact_solution(q0, p0, omega, T)\n    error2 = np.sqrt((q_num - q_ex)**2 + (p_num - p_ex)**2)\n    results.append(error2)\n    \n    # Test Case 3\n    q0, p0, omega, h = test_cases[2]\n    omega_sq = omega**2\n    q_f, p_f = psi_step(q0, p0, h, omega_sq)\n    q_rev, p_rev = psi_step(q_f, p_f, -h, omega_sq)\n    is_reversible = np.allclose([q0, p0], [q_rev, p_rev], atol=1e-12, rtol=0)\n    results.append(is_reversible)\n\n    # Test Case 4\n    q0, p0, omega, h, N = test_cases[3]\n    H0 = hamiltonian(q0, p0, omega)\n    q_N, p_N = integrate(q0, p0, omega, h, N)\n    HN = hamiltonian(q_N, p_N, omega)\n    energy_diff = np.abs(HN - H0)\n    results.append(energy_diff)\n\n    # Test Case 5\n    q0, p0, omega, T, h1, h2 = test_cases[4]\n    N1 = int(round(T / h1))\n    N2 = int(round(T / h2))\n    q_ex, p_ex = exact_solution(q0, p0, omega, T)\n    \n    q_n1, p_n1 = integrate(q0, p0, omega, h1, N1)\n    E1 = np.sqrt((q_n1 - q_ex)**2 + (p_n1 - p_ex)**2)\n    \n    q_n2, p_n2 = integrate(q0, p0, omega, h2, N2)\n    E2 = np.sqrt((q_n2 - q_ex)**2 + (p_n2 - p_ex)**2)\n    \n    p_obs = np.log2(E1 / E2)\n    results.append(p_obs)\n\n    # Convert boolean to lowercase string for required output format\n    results = [str(r).lower() if isinstance(r, bool) else r for r in results]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个数值方法的实用性不仅取决于其精度，还取决于其稳定性。最后的这个练习探讨了基本Strang分裂方法和我们构建的四阶组合方法  的稳定性。通过分析谐振子，您将确定最大稳定时间步长，从而深入了解数值积分的实际限制和数值共振等潜在陷阱。",
            "id": "3767690",
            "problem": "考虑一个可分哈密顿系统，其哈密顿量为 $H(q,p) = T(p) + V(q)$，其中 $T(p) = \\frac{1}{2} p^{2}$，$V(q) = \\frac{1}{2} \\omega^{2} q^{2}$，频率 $\\omega  0$ 为一固定值。$T$ 和 $V$ 的精确流由哈密顿方程的解给出：$T$-流 $\\varphi_{T}^{t}$ 将 $q$ 和 $p$ 更新为 $q \\mapsto q + t \\, \\partial T / \\partial p = q + t p$ 和 $p \\mapsto p$；而 $V$-流 $\\varphi_{V}^{t}$ 将 $q$ 和 $p$ 更新为 $q \\mapsto q$ 和 $p \\mapsto p - t \\, \\partial V / \\partial q = p - t \\, \\omega^{2} q$。考虑对称二阶 Strang 分裂单步映射 $S(h) = \\varphi_{V}^{h/2} \\circ \\varphi_{T}^{h} \\circ \\varphi_{V}^{h/2}$，以及对称四阶三级跳跃组合 $\\Psi(h) = S(\\alpha h) \\circ S(\\beta h) \\circ S(\\alpha h)$，其中系数 $\\alpha$ 和 $\\beta$ 为实数。\n\n从以上定义出发，仅使用辛映射的基本性质，推导 $S(h)$ 对谐振子的线性稳定性特征，然后基于对称组合的 Baker-Campbell-Hausdorff (BCH) 级数，确定三级跳跃组合中 $\\alpha$ 和 $\\beta$ 的四阶条件。将线性稳定性定义为单步映射的特征值位于复平面的单位圆上这一性质，并将离散线性共振定义为特征值等于 $-1$ 的边界情况。\n\n假设满足充分稳定性要求，即对于所有组合系数 $\\gamma \\in \\{\\alpha,\\beta\\}$，每个内部 Strang 子步 $S(\\gamma h)$ 都是线性稳定且非共振的（即其特征值位于单位圆上且不等于 $-1$），计算保证 $\\Psi(h)$ 保持线性稳定且无阶段共振的最大时间步长 $h$（仅用 $\\omega$ 表示）。你的最终答案必须是单一的闭式解析表达式。不需要进行数值舍入。",
            "solution": "该问题要求推导应用于谐振子的 Strang 分裂积分器的四阶对称组合的稳定性极限。该过程包括三个主要部分：分析基础积分器 $S(h)$ 的线性稳定性，确定四阶组合的系数，最后将指定的稳定性约束应用于复合方法。\n\n首先，我们分析二阶 Strang 分裂映射 $S(h) = \\varphi_{V}^{h/2} \\circ \\varphi_{T}^{h} \\circ \\varphi_{V}^{h/2}$ 的线性稳定性。该系统是一个谐振子，其哈密顿量为 $H(q,p) = T(p) + V(q) = \\frac{1}{2} p^{2} + \\frac{1}{2} \\omega^{2} q^{2}$。状态由向量 $z = (q, p)^T$ 表示。\n\n对应于动能部分的流 $\\varphi_{T}^{t}$ 是一个线性剪切变换：\n$$ z \\mapsto \\begin{pmatrix} 1  t \\\\ 0  1 \\end{pmatrix} z $$\n对应于势能部分的流 $\\varphi_{V}^{t}$ 也是一个线性剪切变换：\n$$ z \\mapsto \\begin{pmatrix} 1  0 \\\\ -t\\omega^2  1 \\end{pmatrix} z $$\n单步映射 $S(h)$ 可以由一个作用于状态向量 $z$ 的矩阵 $M_S(h)$ 表示。该矩阵是各个流的矩阵的乘积：\n$$ M_S(h) = M_V(h/2) M_T(h) M_V(h/2) $$\n代入具有相应时间步长的矩阵形式：\n$$ M_S(h) = \\begin{pmatrix} 1  0 \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} \\begin{pmatrix} 1  h \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} $$\n我们进行矩阵乘法。首先，我们将最右边的两个矩阵相乘：\n$$ M_T(h) M_V(h/2) = \\begin{pmatrix} 1  h \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{h^2\\omega^2}{2}  h \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} $$\n现在我们完成乘法：\n$$ M_S(h) = \\begin{pmatrix} 1  0 \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} \\begin{pmatrix} 1 - \\frac{h^2\\omega^2}{2}  h \\\\ -\\frac{h\\omega^2}{2}  1 \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{h^2\\omega^2}{2}  h \\\\ -\\frac{h\\omega^2}{2}(1 - \\frac{h^2\\omega^2}{2}) - \\frac{h\\omega^2}{2}  1 - \\frac{h^2\\omega^2}{2} \\end{pmatrix} $$\n化简第二行第一列的元素：\n$$ -\\frac{h\\omega^2}{2} + \\frac{h^3\\omega^4}{4} - \\frac{h\\omega^2}{2} = -h\\omega^2 + \\frac{h^3\\omega^4}{4} = -h\\omega^2 \\left(1 - \\frac{h^2\\omega^2}{4}\\right) $$\n所以单步矩阵是：\n$$ M_S(h) = \\begin{pmatrix} 1 - \\frac{h^2\\omega^2}{2}  h \\\\ -h\\omega^2 \\left(1 - \\frac{h^2\\omega^2}{4}\\right)  1 - \\frac{h^2\\omega^2}{2} \\end{pmatrix} $$\n由于该映射是辛映射，其行列式必须为 $1$，这一点可以验证。对于一个 $2 \\times 2$ 的辛矩阵，线性稳定性（特征值在单位圆上）的条件是其迹的绝对值小于或等于 $2$。$M_S(h)$ 的迹为：\n$$ \\text{Tr}(M_S(h)) = \\left(1 - \\frac{h^2\\omega^2}{2}\\right) + \\left(1 - \\frac{h^2\\omega^2}{2}\\right) = 2 - h^2\\omega^2 $$\n稳定性条件为 $|\\text{Tr}(M_S(h))| \\le 2$，这给出：\n$$ |2 - h^2\\omega^2| \\le 2 $$\n该不等式等价于 $-2 \\le 2 - h^2\\omega^2 \\le 2$。右侧不等式给出 $-h^2\\omega^2 \\le 0$，该式恒成立。左侧不等式给出 $-4 \\le -h^2\\omega^2$，即 $h^2\\omega^2 \\le 4$。由于 $h>0$ 且 $\\omega>0$，这意味着 $h\\omega \\le 2$。离散线性共振的情况发生在稳定性的边界，此时特征值等于 $-1$。这对应于 $\\text{Tr}(M_S(h)) = -2$，给出 $2 - h^2\\omega^2 = -2$，即 $h\\omega = 2$。因此，无共振的稳定性条件是严格不等式 $h\\omega  2$。\n\n接下来，我们确定四阶组合方法 $\\Psi(h) = S(\\alpha h) \\circ S(\\beta h) \\circ S(\\alpha h)$ 的系数 $\\alpha$ 和 $\\beta$。Strang 分裂 $S(h)$ 是一个对称二阶方法 ($p=2$)。一个对称二阶方法的对称组合是四阶的 ($p+2=4$)，前提是关于系数的两个条件得到满足。对于组合 $\\sum_i S(c_i h)$，这些条件是：\n1. $h$阶相容性条件：$\\sum_i c_i = 1$。\n2. 主导误差项（$h^{p+1}=h^3$阶）的消除：$\\sum_i c_i^{p+1} = \\sum_i c_i^3 = 0$。\n\n对于三级跳跃组合，系数为 $c_1=\\alpha$，$c_2=\\beta$，$c_3=\\alpha$。条件变为：\n1. $2\\alpha + \\beta = 1$\n2. $2\\alpha^3 + \\beta^3 = 0$\n\n从第二个方程，我们有 $(\\sqrt[3]{2}\\alpha)^3 + \\beta^3 = 0$，这意味着 $\\beta = -\\sqrt[3]{2}\\alpha$。我们将其代入第一个方程：\n$$ 2\\alpha + (-\\sqrt[3]{2}\\alpha) = 1 \\implies \\alpha(2 - \\sqrt[3]{2}) = 1 $$\n这给出了 $\\alpha$ 的值：\n$$ \\alpha = \\frac{1}{2 - 2^{1/3}} $$\n使用 $\\beta = 1 - 2\\alpha$，我们找到 $\\beta$：\n$$ \\beta = 1 - \\frac{2}{2 - 2^{1/3}} = \\frac{2 - 2^{1/3} - 2}{2 - 2^{1/3}} = \\frac{-2^{1/3}}{2 - 2^{1/3}} $$\n由于 $2^{1/3} \\approx 1.26$，我们可以看到 $2-2^{1/3} > 0$，因此 $\\alpha$ 是正的，$\\beta$ 是负的。\n\n最后，我们根据问题的充分条件计算保证稳定性的最大时间步长 $h$。该条件要求每个内部子步 $S(\\alpha h)$ 和 $S(\\beta h)$ 都必须是线性稳定且非共振的。将先前推导的稳定性判据（对于步长为 $S(k)$，有 $|k\\omega|  2$）应用于每个子步：\n1. 对于 $S(\\alpha h)$：$|\\alpha h \\omega|  2 \\implies h  \\frac{2}{|\\alpha|\\omega}$\n2. 对于 $S(\\beta h)$：$|\\beta h \\omega|  2 \\implies h  \\frac{2}{|\\beta|\\omega}$\n\n为了同时满足这两个条件，$h$ 必须小于这两个界限的最小值：\n$$ h  \\min\\left(\\frac{2}{|\\alpha|\\omega}, \\frac{2}{|\\beta|\\omega}\\right) = \\frac{2}{\\omega \\max(|\\alpha|, |\\beta|)} $$\n我们需要比较 $|\\alpha|$ 和 $|\\beta|$：\n$$ |\\alpha| = \\frac{1}{2 - 2^{1/3}} $$\n$$ |\\beta| = \\left|\\frac{-2^{1/3}}{2 - 2^{1/3}}\\right| = \\frac{2^{1/3}}{2 - 2^{1/3}} $$\n由于 $2^{1/3} > 1$，显然 $|\\beta| > |\\alpha|$。因此，最严格的条件是涉及 $\\beta$ 的那个。最大允许时间步长 $h$ 由以下极限给出：\n$$ h_{max} = \\frac{2}{|\\beta|\\omega} = \\frac{2}{\\omega} \\frac{2 - 2^{1/3}}{2^{1/3}} $$\n我们可以化简这个表达式：\n$$ h_{max} = \\frac{2}{\\omega} \\left(\\frac{2}{2^{1/3}} - \\frac{2^{1/3}}{2^{1/3}}\\right) = \\frac{2}{\\omega} (2^{1-1/3} - 1) = \\frac{2}{\\omega} (2^{2/3} - 1) $$\n该表达式表示在给定的充分条件下，保证复合方法 $\\Psi(h)$ 稳定且无阶段共振的最大时间步长 $h$。",
            "answer": "$$\\boxed{\\frac{2}{\\omega}(2^{2/3}-1)}$$"
        }
    ]
}