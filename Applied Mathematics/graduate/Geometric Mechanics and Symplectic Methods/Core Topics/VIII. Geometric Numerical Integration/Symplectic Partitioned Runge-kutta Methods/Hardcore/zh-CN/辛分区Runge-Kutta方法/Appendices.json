{
    "hands_on_practices": [
        {
            "introduction": "为了评估任何数值积分方法的性能，我们首先需要一个清晰的基准。简谐振子是哈密顿力学中最典型的模型系统，其精确解和守恒量是众所周知的。这个练习将指导您从第一性原理出发，推导简谐振子的精确时间演化（即流），并识别其在相空间中保持不变的基本几何与动力学不变量。通过将精确流的性质与一个简单的一阶辛分区Runge-Kutta (SPRK) 方法进行比较，我们将揭示这些为哈密顿系统量身定制的数值方法所具有的非凡结构保持能力 。",
            "id": "3769897",
            "problem": "考虑具有哈密顿量 $H(q,p)=\\frac{1}{2}\\left(\\omega^{2} q^{2}+p^{2}\\right)$ 的典则单自由度哈密顿系统，其中 $\\omega>0$ 是一个固定参数。典则运动方程由哈密顿方程给出，精确流由这些方程的时间-$h$ 映射作用于初始条件 $(q(0),p(0))=(q_{0},p_{0})$ 来定义。请从几何力学和辛方法的第一性原理出发，完成以下任务：\n\n1. 从哈密顿方程和典则辛结构出发，推导精确的时间-$h$ 解 $(q(h),p(h))$，用 $(q_{0},p_{0},\\omega,h)$ 表示，且不使用任何现成的解公式。您的推导必须明确利用向量场的线性结构和相空间的辛几何。\n\n2. 使用辛微分同胚和典则辛二形式的定义，识别并证明该系统精确流所保持的辛不变量。您的识别过程必须从哈密顿流的基本性质推导得出，并且必须同时论述一个几何不变量和一个动力学不变量。\n\n3. 现在考虑对此可分哈密顿量应用一阶辛分拆Runge-Kutta (SPRK) 方法，分拆由 $T(p)=\\frac{1}{2}p^{2}$ 和 $V(q)=\\frac{1}{2}\\omega^{2}q^{2}$ 给出。该方法在 $p$-更新和 $q$-更新中具有相等的步长权重 $a=\\frac{1}{2}$ 和 $b=\\frac{1}{2}$（这是分拆形式的隐式中点法）。请从分拆Runge-Kutta方法的定义方程出发，推导从 $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$ 的线性单步映射，并解释为何它是辛的。然后，识别此离散映射所保持的一个二次不变量，并证明为何它对此系统是保持的。\n\n请从上述基本定义出发，提供完整的推理过程，不得走捷径。将最终答案表示为时间-$h$ 映射 $(q(h),p(h))$ 关于 $(q_{0},p_{0},\\omega,h)$ 的精确解析表达式，并写成行矩阵的形式。不需要进行数值近似。",
            "solution": "所述问题具有科学依据、是良定的、客观且内部一致的。它基于经典哈密顿力学、辛几何和几何数值积分的基本原理。所有必要的数据和定义均已提供。因此，该问题被认为是有效的，并将提供解答。\n\n解答按照问题陈述的要求分为三个部分。\n\n### 第一部分：精确时间-$h$ 解的推导\n\n系统由哈密顿量 $H(q,p) = \\frac{1}{2}(\\omega^2 q^2 + p^2)$ 描述。哈密顿典则运动方程为：\n$$\n\\begin{align*}\n\\dot{q} &= \\frac{\\partial H}{\\partial p} \\\\\n\\dot{p} &= -\\frac{\\partial H}{\\partial q}\n\\end{align*}\n$$\n对于给定的哈密顿量，其偏导数为：\n$$\n\\frac{\\partial H}{\\partial p} = p \\\\\n\\frac{\\partial H}{\\partial q} = \\omega^2 q\n$$\n将这些偏导数代入哈密顿方程，得到以下线性常微分方程组：\n$$\n\\begin{align*}\n\\dot{q} &= p \\\\\n\\dot{p} &= -\\omega^2 q\n\\end{align*}\n$$\n令状态向量为 $\\mathbf{z}(t) = \\begin{pmatrix} q(t) \\\\ p(t) \\end{pmatrix}$。该方程组可以写成矩阵形式 $\\dot{\\mathbf{z}} = \\mathbf{A}\\mathbf{z}$，其中矩阵 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^2 & 0 \\end{pmatrix}\n$$\n这个矩阵代表哈密顿向量场 $X_H = \\mathbf{J}\\nabla H$，其中 $\\mathbf{J} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$ 是典则辛矩阵，$\\nabla H = \\begin{pmatrix} \\partial H/\\partial q \\\\ \\partial H/\\partial p \\end{pmatrix}$。\n\n该线性系统在初始条件 $\\mathbf{z}(0) = \\mathbf{z}_0 = \\begin{pmatrix} q_0 \\\\ p_0 \\end{pmatrix}$ 下的解由矩阵指数的作用给出：\n$$\n\\mathbf{z}(h) = \\exp(h\\mathbf{A})\\mathbf{z}_0\n$$\n为计算矩阵指数 $\\exp(h\\mathbf{A})$，我们首先计算 $\\mathbf{A}$ 的幂：\n$$\n\\mathbf{A}^2 = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^2 & 0 \\end{pmatrix} \\begin{pmatrix} 0 & 1 \\\\ -\\omega^2 & 0 \\end{pmatrix} = \\begin{pmatrix} -\\omega^2 & 0 \\\\ 0 & -\\omega^2 \\end{pmatrix} = -\\omega^2 \\mathbf{I}\n$$\n其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。由此可得 $\\mathbf{A}^3 = -\\omega^2\\mathbf{A}$，$\\mathbf{A}^4 = \\omega^4\\mathbf{I}$，依此类推。\n\n使用矩阵指数的泰勒级数定义：\n$$\n\\exp(h\\mathbf{A}) = \\sum_{k=0}^{\\infty} \\frac{(h\\mathbf{A})^k}{k!} = \\mathbf{I} + h\\mathbf{A} + \\frac{h^2\\mathbf{A}^2}{2!} + \\frac{h^3\\mathbf{A}^3}{3!} + \\dots\n$$\n我们可以将包含 $\\mathbf{I}$ 和 $\\mathbf{A}$ 的项分组：\n$$\n\\exp(h\\mathbf{A}) = \\left(\\mathbf{I} - \\frac{h^2\\omega^2}{2!}\\mathbf{I} + \\frac{h^4\\omega^4}{4!}\\mathbf{I} - \\dots \\right) + \\left(h\\mathbf{A} - \\frac{h^3\\omega^2}{3!}\\mathbf{A} + \\frac{h^5\\omega^4}{5!}\\mathbf{A} - \\dots \\right)\n$$\n提出矩阵并整理各项：\n$$\n\\exp(h\\mathbf{A}) = \\left(1 - \\frac{(\\omega h)^2}{2!} + \\frac{(\\omega h)^4}{4!} - \\dots \\right)\\mathbf{I} + \\frac{1}{\\omega}\\left(\\omega h - \\frac{(\\omega h)^3}{3!} + \\frac{(\\omega h)^5}{5!} - \\dots \\right)\\mathbf{A}\n$$\n识别出 $\\cos(\\omega h)$ 和 $\\sin(\\omega h)$ 的泰勒级数：\n$$\n\\exp(h\\mathbf{A}) = \\cos(\\omega h)\\mathbf{I} + \\frac{\\sin(\\omega h)}{\\omega}\\mathbf{A}\n$$\n代入矩阵 $\\mathbf{I}$ 和 $\\mathbf{A}$：\n$$\n\\exp(h\\mathbf{A}) = \\cos(\\omega h)\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} + \\frac{\\sin(\\omega h)}{\\omega}\\begin{pmatrix} 0 & 1 \\\\ -\\omega^2 & 0 \\end{pmatrix} = \\begin{pmatrix} \\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\\\ -\\omega\\sin(\\omega h) & \\cos(\\omega h) \\end{pmatrix}\n$$\n因此，时间-$h$ 映射是由此矩阵表示的一个线性变换。将其应用于初始条件 $(q_0, p_0)$：\n$$\n\\begin{pmatrix} q(h) \\\\ p(h) \\end{pmatrix} = \\begin{pmatrix} \\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\\\ -\\omega\\sin(\\omega h) & \\cos(\\omega h) \\end{pmatrix} \\begin{pmatrix} q_0 \\\\ p_0 \\end{pmatrix}\n$$\n这给出了显式解：\n$$\n\\begin{align*}\nq(h) &= q_0 \\cos(\\omega h) + \\frac{p_0}{\\omega} \\sin(\\omega h) \\\\\np(h) &= -q_0 \\omega \\sin(\\omega h) + p_0 \\cos(\\omega h)\n\\end{align*}\n$$\n\n### 第二部分：精确流的不变量\n\n由哈密顿向量场生成的流 $\\Phi_t$ 的一个基本性质是它是一个**辛同胚**族。相空间上的一个映射 $\\Phi$ 如果保持辛二形式 $\\Omega$，则它是一个辛同胚。对于典则单自由度系统，辛形式为 $\\Omega = dq \\wedge dp$。保持意味着该形式在该映射下的拉回是其自身，即 $\\Phi_h^* \\Omega = \\Omega$。\n\n1.  **几何不变量**：几何不变量是辛二形式 $\\Omega = dq \\wedge dp$ 本身。在矩阵力学中，这种保持性表现为流映射的雅可比矩阵 $\\mathbf{M} = D\\Phi_h$ 必须是一个辛矩阵。一个矩阵 $\\mathbf{M}$ 是辛的，如果它满足 $\\mathbf{M}^T \\mathbf{J} \\mathbf{M} = \\mathbf{J}$，其中 $\\mathbf{J} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$。由于我们的流映射是线性的，其雅可比矩阵就是在第一部分中推导出的矩阵 $\\exp(h\\mathbf{A})$。我们来验证它是辛的：\n    $$\n    \\mathbf{M} = \\begin{pmatrix} \\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\\\ -\\omega\\sin(\\omega h) & \\cos(\\omega h) \\end{pmatrix}\n    $$\n    $$\n    \\mathbf{M}^T\\mathbf{J}\\mathbf{M} = \\begin{pmatrix} \\cos(\\omega h) & -\\omega\\sin(\\omega h) \\\\ \\frac{\\sin(\\omega h)}{\\omega} & \\cos(\\omega h) \\end{pmatrix} \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\begin{pmatrix} \\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\\\ -\\omega\\sin(\\omega h) & \\cos(\\omega h) \\end{pmatrix}\n    $$\n    $$\n    = \\begin{pmatrix} \\omega\\sin(\\omega h) & \\cos(\\omega h) \\\\ -\\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\end{pmatrix} \\begin{pmatrix} \\cos(\\omega h) & \\frac{\\sin(\\omega h)}{\\omega} \\\\ -\\omega\\sin(\\omega h) & \\cos(\\omega h) \\end{pmatrix}\n    $$\n    $$\n    = \\begin{pmatrix} \\omega\\sin(\\omega h)\\cos(\\omega h) - \\omega\\cos(\\omega h)\\sin(\\omega h) & \\sin^2(\\omega h) + \\cos^2(\\omega h) \\\\ -\\cos^2(\\omega h) - \\sin^2(\\omega h) & -\\sin(\\omega h)\\cos(\\omega h) + \\sin(\\omega h)\\cos(\\omega h) \\end{pmatrix}\n    = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} = \\mathbf{J}\n    $$\n    条件满足。根据斯托克斯定理，$dq \\wedge dp$ 的保持性意味着相空间中有向面积的保持（刘维尔定理）。\n\n2.  **动力学不变量**：对于任何自治哈密顿系统，哈密顿函数 $H$ 本身是一个运动常数，或称为动力学不变量。这可以从第一性原理出发，通过计算 $H$ 沿轨迹 $(q(t), p(t))$ 的全时间导数来证明：\n    $$\n    \\frac{dH}{dt} = \\frac{\\partial H}{\\partial q}\\dot{q} + \\frac{\\partial H}{\\partial p}\\dot{p}\n    $$\n    代入哈密顿方程 $\\dot{q} = \\partial H / \\partial p$ 和 $\\dot{p} = -\\partial H / \\partial q$：\n    $$\n    \\frac{dH}{dt} = \\frac{\\partial H}{\\partial q}\\left(\\frac{\\partial H}{\\partial p}\\right) + \\frac{\\partial H}{\\partial p}\\left(-\\frac{\\partial H}{\\partial q}\\right) = \\frac{\\partial H}{\\partial q}\\frac{\\partial H}{\\partial p} - \\frac{\\partial H}{\\partial p}\\frac{\\partial H}{\\partial q} = 0\n    $$\n    由于其时间导数为零，$H(q(t),p(t))$ 在任何解轨迹上都是常数。对于此系统，动力学不变量是能量 $H(q,p) = \\frac{1}{2}(\\omega^2 q^2 + p^2)$。\n\n### 第三部分：SPRK方法的分析\n\n问题描述了一个针对可分哈密顿量 $H(q,p) = T(p) + V(q)$ 的分拆方法，其中 $T(p) = \\frac{1}{2}p^2$ 且 $V(q)=\\frac{1}{2}\\omega^2 q^2$。该方法被确定为分拆形式的隐式中点法。此方法定义如下：\n$$\n\\begin{align*}\nq_{n+1} &= q_n + h \\frac{\\partial T}{\\partial p}\\left(\\frac{p_n+p_{n+1}}{2}\\right) \\\\\np_{n+1} &= p_n - h \\frac{\\partial V}{\\partial q}\\left(\\frac{q_n+q_{n+1}}{2}\\right)\n\\end{align*}\n$$\n代入 $T(p)$ 和 $V(q)$ 的具体形式：\n$$\n\\begin{align*}\nq_{n+1} &= q_n + h \\left(\\frac{p_n+p_{n+1}}{2}\\right) \\\\\np_{n+1} &= p_n - h \\omega^2 \\left(\\frac{q_n+q_{n+1}}{2}\\right)\n\\end{align*}\n$$\n这是关于 $(q_{n+1}, p_{n+1})$ 的一个线性方程组。我们重新整理它以求出单步映射矩阵。\n$$\n\\begin{align*}\nq_{n+1} - \\frac{h}{2} p_{n+1} &= q_n + \\frac{h}{2} p_n \\\\\n\\frac{h\\omega^2}{2} q_{n+1} + p_{n+1} &= p_n - \\frac{h\\omega^2}{2} q_n\n\\end{align*}\n$$\n写成矩阵形式，即为 $\\mathbf{L}\\mathbf{z}_{n+1} = \\mathbf{R}\\mathbf{z}_n$，其中 $\\mathbf{z}_k = \\begin{pmatrix} q_k \\\\ p_k \\end{pmatrix}$：\n$$\n\\begin{pmatrix} 1 & -\\frac{h}{2} \\\\ \\frac{h\\omega^2}{2} & 1 \\end{pmatrix} \\begin{pmatrix} q_{n+1} \\\\ p_{n+1} \\end{pmatrix} = \\begin{pmatrix} 1 & \\frac{h}{2} \\\\ -\\frac{h\\omega^2}{2} & 1 \\end{pmatrix} \\begin{pmatrix} q_n \\\\ p_n \\end{pmatrix}\n$$\n单步映射由矩阵 $\\mathbf{M}_{num} = \\mathbf{L}^{-1}\\mathbf{R}$ 给出。$\\mathbf{L}$ 的行列式为 $\\det(\\mathbf{L}) = (1)(1) - (-\\frac{h}{2})(\\frac{h\\omega^2}{2}) = 1 + \\frac{h^2\\omega^2}{4}$。\n$$\n\\mathbf{L}^{-1} = \\frac{1}{1 + \\frac{h^2\\omega^2}{4}} \\begin{pmatrix} 1 & \\frac{h}{2} \\\\ -\\frac{h\\omega^2}{2} & 1 \\end{pmatrix}\n$$\n因此，单步映射为：\n$$\n\\mathbf{M}_{num} = \\frac{1}{1 + \\frac{h^2\\omega^2}{4}} \\begin{pmatrix} 1 & \\frac{h}{2} \\\\ -\\frac{h\\omega^2}{2} & 1 \\end{pmatrix} \\begin{pmatrix} 1 & \\frac{h}{2} \\\\ -\\frac{h\\omega^2}{2} & 1 \\end{pmatrix} = \\frac{1}{1 + \\frac{h^2\\omega^2}{4}} \\begin{pmatrix} 1 - \\frac{h^2\\omega^2}{4} & h \\\\ -h\\omega^2 & 1 - \\frac{h^2\\omega^2}{4} \\end{pmatrix}\n$$\n这就是该方法的线性单步映射。\n\n这个映射是辛的，因为它是由一个辛积分器生成的。与精确流类似，我们可以通过检验 $\\mathbf{M}_{num}^T \\mathbf{J} \\mathbf{M}_{num} = \\mathbf{J}$ 是否成立来验证这一点。Gauss配置方法的一个普遍性质是它们都是辛的，而隐式中点法则是其最简单的二阶例子。在第二部分中，我们对一个具有相同一般形式的矩阵进行了直接验证，确认了其辛性质。对 $\\mathbf{M}_{num}$ 的计算在代数上是完全相同的。\n\n为了识别一个二次不变量，我们检验该离散映射是否保持原始哈密顿量 $H(q,p)$。我们考察差值 $H(q_{n+1}, p_{n+1}) - H(q_n, p_n)$：\n$$\nH(q_{n+1}, p_{n+1}) - H(q_n, p_n) = \\frac{1}{2}\\left(\\omega^2 q_{n+1}^2 + p_{n+1}^2\\right) - \\frac{1}{2}\\left(\\omega^2 q_n^2 + p_n^2\\right)\n$$\n$$\n= \\frac{1}{2}\\left[ \\omega^2(q_{n+1}^2 - q_n^2) + (p_{n+1}^2 - p_n^2) \\right]\n$$\n使用平方差分解公式 $a^2-b^2 = (a-b)(a+b)$：\n$$\n= \\frac{1}{2}\\left[ \\omega^2(q_{n+1}-q_n)(q_{n+1}+q_n) + (p_{n+1}-p_n)(p_{n+1}+p_n) \\right]\n$$\n根据该方法的定义方程：\n$$\nq_{n+1}-q_n = h \\left(\\frac{p_n+p_{n+1}}{2}\\right) \\quad \\text{和} \\quad p_{n+1}-p_n = -h \\omega^2 \\left(\\frac{q_n+q_{n+1}}{2}\\right)\n$$\n将这些代入 $H$ 的变化量表达式中：\n$$\n= \\frac{1}{2}\\left[ \\omega^2 \\left(h \\frac{p_n+p_{n+1}}{2}\\right)(q_{n+1}+q_n) + \\left(-h \\omega^2 \\frac{q_n+q_{n+1}}{2}\\right)(p_{n+1}+p_n) \\right]\n$$\n$$\n= \\frac{h\\omega^2}{4}\\left[ (p_n+p_{n+1})(q_{n+1}+q_n) - (q_n+q_{n+1})(p_{n+1}+p_n) \\right] = 0\n$$\n由于 $H(q_{n+1}, p_{n+1}) - H(q_n, p_n) = 0$，我们有 $H(q_{n+1}, p_{n+1}) = H(q_n, p_n)$。\n因此，对于这个系统，被离散映射精确保持的二次不变量就是哈密顿量本身，$H(q,p) = \\frac{1}{2}(\\omega^2 q^2 + p^2)$。这是一个特殊性质，当隐式中点法则应用于任何具有二次哈密顿量的系统时，该性质都成立。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} q_{0} \\cos(\\omega h) + \\frac{p_{0}}{\\omega} \\sin(\\omega h) & p_{0} \\cos(\\omega h) - q_{0} \\omega \\sin(\\omega h) \\end{pmatrix} } $$"
        },
        {
            "introduction": "在掌握了辛积分方法的基本性质之后，一个自然而然的进阶问题是如何系统地构建更高阶、更精确的算法。这个练习介绍了一种强大而优雅的技术——对称组合法，它允许我们通过组合一个已知的低阶对称方法来构造出更高阶的辛方法。您将通过运用Baker-Campbell-Hausdorff (BCH) 展开的初步思想，推导将一个二阶方法提升至四阶所需的代数条件，从而亲身体验几何数值积分方法设计的核心思想 。这一过程不仅展示了理论的威力，也为创造更高效的长时间模拟工具提供了实践基础。",
            "id": "3769900",
            "problem": "考虑一个在具有典范辛形式的余切丛上的可分哈密顿系统，其哈密顿量为 $H(q,p) = T(p) + V(q)$。令 $\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 分别表示由 $A := T$ 和 $B := V$ 生成的精确哈密顿流。对于时间步长 $h$，一个标准的对称二阶辛分裂（通常称为 Stoermer–Verlet 或 Strang 步）是复合 $\\Phi_{A}^{h/2} \\circ \\Phi_{B}^{h} \\circ \\Phi_{A}^{h/2}$。对这种二阶步使用缩放时间步长 $w_{1} h$、$w_{0} h$、$w_{1} h$ 进行三阶段对称复合，得到一个方法\n$$\n\\mathcal{S}_{4}(h) \\;=\\; \\mathcal{S}_{2}(w_{1} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{0} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{1} h),\n$$\n其中 $\\mathcal{S}_{2}(x h) := \\Phi_{A}^{x h/2} \\circ \\Phi_{B}^{x h} \\circ \\Phi_{A}^{x h/2}$。将此方法解释为可分系统的辛分块龙格–库塔 (SPRK) 方法，可得到一个具有对称系数的漂移–踢–漂移结构。\n\n从以下基本事实出发：(i) 每个部分流 $\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 都是辛的，(ii) 辛映射的复合是辛的，以及 (iii) 用于复合指数的贝克尔–坎贝尔–豪斯多夫 (Baker–Campbell–Hausdorff) 展开决定了分裂格式的局部误差结构，完成以下任务：\n\n1. 推导 $w_{1}$ 和 $w_{0}$ 必须满足的相容性条件，以使 $\\mathcal{S}_{4}(h)$ 与精确流 $\\exp(h(L_{A}+L_{B}))$ 是一阶相容的，其中 $L_{A}$ 和 $L_{B}$ 是 $A$ 和 $B$ 的李导数。\n2. 利用复合的对称性和来自贝克尔–坎贝尔–豪斯多夫展开的局部误差的主阶结构，推导出消除三阶误差项所需的附加阶条件，从而使该方法达到经典 4 阶。\n3. 求解这些条件，得到 $w_{1}$ 的闭式表达式。\n4. 从辛几何的第一性原理以及通过精确部分流的复合构造出发，论证所得到的三阶段格式作为一种辛分块龙格–库塔方法是辛的。\n\n以最简形式给出 $w_{1}$ 的精确代数表达式作为最终答案。不要提供中间系数；仅报告 $w_{1}$ 作为最终答案。",
            "solution": "该问题需要进行验证。\n\n### 步骤1：提取已知条件\n- **哈密顿量：** $H(q,p) = T(p) + V(q)$，这是一个可分哈密顿量。令 $A := T(p)$ 且 $B := V(q)$。\n- **部分流：** $\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 分别是由 $A$ 和 $B$ 生成的精确哈密顿流。\n- **二阶方法：** $\\mathcal{S}_{2}(h) := \\Phi_{A}^{h/2} \\circ \\Phi_{B}^{h} \\circ \\Phi_{A}^{h/2}$。这是一个对称二阶分裂方法（Strang 分裂）。\n- **四阶方法：** $\\mathcal{S}_{4}(h) \\;=\\; \\mathcal{S}_{2}(w_{1} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{0} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{1} h)$，这是一个三阶段对称复合。\n- **缩放因子：** $w_{1}$ 和 $w_{0}$ 是实系数。\n- **时间步长：** $h$。\n- **基本原理：** (i) $\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 是辛的，(ii) 辛映射的复合是辛的，(iii) 贝克尔–坎贝尔–豪斯多夫 (BCH) 展开决定了局部误差结构。\n- **李导数：** $L_A$ 和 $L_B$是与 $A$ 和 $B$ 相关的李导数。精确流为 $\\exp(h(L_A + L_B))$。\n- **任务：**\n  1. 推导 $w_{1}$ 和 $w_{0}$ 的一阶相容性条件。\n  2. 推导消除三阶误差项的条件。\n  3. 求解这些条件得到 $w_{1}$。\n  4. 论证该方法是辛的。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题定义明确，并且在哈密顿系统的几何数值积分领域有坚实的科学基础。\n- **科学基础（关键）：** 该问题涉及标准的、已确立的概念：可分哈密顿量、辛分裂方法、李导数以及贝克尔-坎贝尔-豪斯多夫公式。通过复合低阶对称步来构造高阶方法是一种被称为 Yoshida 方法的基本技术。该问题在事实上是可靠的。\n- **适定性：** 该问题提供了一套清晰完整的定义，并要求推导方法系数须满足的特定的、可解的代数条件。众所周知，系数存在唯一且有意义的解。\n- **客观性（关键）：** 该问题以精确、形式化的语言陈述，没有任何主观性或歧义。\n- **完整性/一致性：** 提供了所有必要的信息。定义是自洽的。\n- **其他标准：** 该问题并非不切实际、不适定、无足轻重或无法验证。它是几何积分器分析中一个标准且重要的练习。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供完整解答。\n\n### 解答\n解答的结构是为了解决问题陈述中提出的四个任务。我们使用李算子的语言，其中哈密顿量 $G$ 的流由指数映射 $\\exp(t L_G)$ 表示，而 $L_G = \\{ \\cdot, G \\}$ 是李导数（泊松括号算子）。\n\n#### 1. 一阶相容性条件\n在一个时间步长 $h$ 上，总哈密顿量 $H=A+B$ 的精确流由 $\\exp(h(L_A+L_B))$ 给出。如果一个数值方法的算子展开与精确流算子匹配至 $\\mathcal{O}(h)$ 阶，则该方法是一阶相容的。\n\n方法 $\\mathcal{S}_{4}(h)$ 是三个步 $\\mathcal{S}_{2}(w_{1} h)$、$\\mathcal{S}_{2}(w_{0} h)$ 和 $\\mathcal{S}_{2}(w_{1} h)$ 的复合。每一步 $\\mathcal{S}_{2}(x h)$ 近似于时长为 $x h$ 的精确流。算子 $\\mathcal{S}_{2}(x h)$ 展开式中的最低阶项就是 $\\exp(x h(L_A+L_B))$。\n\n为了找到复合方法 $\\mathcal{S}_{4}(h)$ 的最低阶项，我们复合其组成部分的最低阶项：\n$$\n\\exp(w_{1} h (L_A+L_B)) \\circ \\exp(w_{0} h (L_A+L_B)) \\circ \\exp(w_{1} h (L_A+L_B))\n$$\n由于算子 $(L_A+L_B)$ 与自身对易，指数的复合简化为参数之和的指数：\n$$\n\\exp\\left((w_{1} h + w_{0} h + w_{1} h)(L_A+L_B)\\right) = \\exp\\left((2w_{1} + w_{0})h(L_A+L_B)\\right)\n$$\n为满足一阶相容性，这必须与精确流算子 $\\exp(h(L_A+L_B))$ 至少在 $h$ 的一阶上匹配。这要求总有效时间步长等于 $h$：\n$$\n(2w_{1} + w_{0})h = h\n$$\n因此，相容性条件是：\n$$\n2w_{1} + w_{0} = 1\n$$\n\n#### 2. 四阶条件（消除三阶误差）\n方法 $\\mathcal{S}_{2}(h)$ 是对称的。对于一个经典阶为 $p$ 的对称方法，其生成的流对应于一个修正哈密顿量的精确流，并且其李算子级数在主项之外只包含 $h$ 的奇数次幂：$L_{\\text{method}} = (L_A+L_B) + h^{p} C_{p+1} + h^{p+2} C_{p+3} + \\dots$。\n方法 $\\mathcal{S}_{2}(h)$ 是二阶的，所以 $p=2$。其李算子展开式为：\n$$\nL_{\\mathcal{S}_2(h)} = (L_A+L_B) + h^2 E_3 + h^4 E_5 + \\dots\n$$\n这意味着 $\\mathcal{S}_2(h)$ 的流可以写为 $\\exp(h(L_A+L_B) + h^3 E_3 + h^5 E_5 + \\dots)$，其中 $E_k$ 是涉及 $L_A$ 和 $L_B$ 的嵌套李括号的算子。\n\n因此，一个组成步 $\\mathcal{S}_{2}(x h)$ 的流是：\n$$\n\\exp(x h(L_A+L_B) + (x h)^3 E_3 + \\mathcal{O}(h^5))\n$$\n当我们复合对称方法时，复合方法的主误差项就是组成方法主误差项之和。方法 $\\mathcal{S}_4(h)$ 是对称方法的对称复合，因此其自身的误差展开也只包含 $h$ 的奇数次幂。$\\mathcal{S}_4(h)$ 的主误差项是各阶段 $h^3$ 误差项之和：\n- 来自第一阶段 $\\mathcal{S}_{2}(w_{1} h)$：$(w_{1} h)^3 E_3$\n- 来自第二阶段 $\\mathcal{S}_{2}(w_{0} h)$：$(w_{0} h)^3 E_3$\n- 来自第三阶段 $\\mathcal{S}_{2}(w_{1} h)$：$(w_{1} h)^3 E_3$\n\n$\\mathcal{S}_4(h)$ 的 $h^3 E_3$ 误差项的总系数是这些贡献的总和：\n$$\n(w_{1}^3 + w_{0}^3 + w_{1}^3) h^3 E_3 = (2w_{1}^3 + w_{0}^3) h^3 E_3\n$$\n为了使方法的精度阶高于 2，我们必须消除这个主误差项。由于 $E_3$ 通常非零，其系数必须为零。这给出了第二个条件：\n$$\n2w_{1}^3 + w_{0}^3 = 0\n$$\n当这个条件满足时，$O(h^3)$ 的误差项消失。因为整个方法是对称的，$O(h^4)$ 的误差项也保证为零，从而将方法的经典阶提升至 4。\n\n#### 3. 求解 $w_1$\n我们现在求解关于 $w_1$ 和 $w_0$ 的两个代数方程组：\n1. $2w_{1} + w_{0} = 1$\n2. $2w_{1}^3 + w_{0}^3 = 0$\n\n从方程（2）出发，对两边取实数立方根，得到：\n$$\nw_{0}^3 = -2w_{1}^3 \\implies w_{0} = -2^{1/3} w_{1}\n$$\n现在，将 $w_0$ 的这个表达式代入方程（1）：\n$$\n2w_{1} + (-2^{1/3} w_{1}) = 1\n$$\n提取 $w_1$：\n$$\nw_{1} (2 - 2^{1/3}) = 1\n$$\n求解 $w_1$ 得到闭式表达式：\n$$\nw_{1} = \\frac{1}{2 - 2^{1/3}}\n$$\n\n#### 4. 关于辛性的论证\n方法 $\\mathcal{S}_4(h)$ 的辛性论证基于问题中陈述的几何力学的两个基本原理。\n1.  **哈密顿流是辛映射。** 部分流 $\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 根据定义分别是哈密顿量 $A=T(p)$ 和 $B=V(q)$ 的精确流。因此，对于任何时间 $t$，$\\Phi_{A}^{t}$ 和 $\\Phi_{B}^{t}$ 都是辛映射。辛映射是一种保持典范辛二形式 $\\omega = \\sum_i dp_i \\wedge dq_i$ 不变的变换。\n2.  **辛映射的复合是辛映射。** 在给定相空间上，所有辛映射的集合在映射复合运算下构成一个群。这意味着如果 $\\Psi_1$ 和 $\\Psi_2$ 是辛的，那么它们的复合 $\\Psi_1 \\circ \\Psi_2$ 也是辛的。\n\n$\\mathcal{S}_4(h)$ 的构造是一个多层复合：\n- 首先，基本步 $\\mathcal{S}_{2}(x h) = \\Phi_{A}^{x h/2} \\circ \\Phi_{B}^{x h} \\circ \\Phi_{A}^{x h/2}$ 是三个映射的复合：$\\Phi_{A}^{x h/2}$、$\\Phi_{B}^{x h}$ 和 $\\Phi_{A}^{x h/2}$。由于这些都是哈密顿流，所以每个都是辛映射。根据原理（2），它们的复合 $\\mathcal{S}_{2}(x h)$ 对于任何实数 $x$ 和 $h$ 也是一个辛映射。\n- 其次，完整的方法 $\\mathcal{S}_{4}(h) = \\mathcal{S}_{2}(w_{1} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{0} h)\\,\\circ\\,\\mathcal{S}_{2}(w_{1} h)$ 是三个映射的复合：$\\mathcal{S}_{2}(w_{1} h)$、$\\mathcal{S}_{2}(w_{0} h)$ 和 $\\mathcal{S}_{2}(w_{1} h)$。正如前一点所证，这些 $\\mathcal{S}_2$ 映射中的每一个都是辛的。\n- 因此，通过再次应用原理（2），最终的映射 $\\mathcal{S}_{4}(h)$ 是辛映射的复合，其本身也是辛的。\n\n这个性质对任何实数值的 $w_0$ 和 $w_1$ 都成立。第 1-3 部分推导出的条件确保了方法具有高精度阶，但辛性是通过精确哈密顿流复合构造的内在结构性质。辛分块龙格-库塔 (SPRK) 方法是指其布卓 (Butcher) 表系数满足一组代数辛性条件的方法。由于 $\\mathcal{S}_{4}(h)$ 是通过构造得到的辛方法，它的 SPRK 系数保证满足这些条件。",
            "answer": "$$\\boxed{\\frac{1}{2 - 2^{1/3}}}$$"
        },
        {
            "introduction": "理论的优美最终需要通过实践来检验。辛积分方法的核心特征是其保持相空间中的辛结构，这在二维情况下直观地表现为面积守恒。本练习是一个计算实践，旨在将这一抽象理论转化为具体的、可测量的结果。您将通过编写代码，追踪一个初始闭合环路在辛积分方法（Störmer-Verlet法）和非辛积分方法（显式欧拉法）单步演化下的面积变化 。通过直接比较两种方法的结果，您将获得关于“结构保持”算法实际优势的直观理解，并验证为何辛性是长期动力学模拟的关键性质。",
            "id": "3769881",
            "problem": "考虑一个单自由度可分哈密顿系统，其广义坐标为 $q$，共轭动量为 $p$，由哈密顿量 $H(q,p)=T(p)+V(q)$ 控制。精确的哈密顿流保持正则辛2-形式 $\\omega=\\mathrm{d}q\\wedge\\mathrm{d}p$ 不变，这意味着相平面 $(q,p)$ 中的有向面积是守恒的。一个数值单步法会导出一个离散映射 $(q,p)\\mapsto(\\tilde{q},\\tilde{p})$。保持 $\\omega$ 不变的映射称为辛映射，对于此类映射，$(q,p)$ 平面中任何闭合平面环路的面积在该映射下是不变的。辛分区Runge-Kutta（SPRK）方法是一类为可分哈密顿量设计的保结构积分器。\n\n您的任务是设计并实现一个数值实验，通过追踪由SPRK格式产生的单步映射下闭合相空间环路的面积，来衡量其近辛性，并解释面积的偏差。该实验必须遵循以下规范。\n\n1. 理论基础：\n   - 从可分哈密顿量的哈密顿方程 $\\dot{q}=\\partial T/\\partial p$ 和 $\\dot{p}=-\\partial V/\\partial q$ 出发。\n   - 利用辛映射保持辛2-形式 $\\omega$ 不变，因此也保持 $(q,p)$ 中任何闭合环路有向面积不变的事实。\n   - 将相空间中的初始闭合环路参数化为一条离散曲线 $\\gamma(\\theta)=(q(\\theta),p(\\theta))$，其中 $q(\\theta)=R\\cos\\theta$ 和 $p(\\theta)=R\\sin\\theta$，$\\theta\\in[0,2\\pi)$ 以弧度为单位。通过在 $M$ 个点上均匀采样 $\\theta$ 来离散化该环路。\n\n2. 使用的数值积分器：\n   - 实现一个适用于可分哈密顿量的二阶辛分区Runge-Kutta格式（Störmer-Verlet方法）。该格式是辛的，理想情况下，在单步映射下应保持离散环路的面积不变（在数值效应的误差范围内）。\n   - 为相同的可分哈密顿量实现一个一阶分区显式欧拉方法（非辛），作为基准，预计该方法在单步映射下会表现出面积变化。\n\n3. 哈密顿量的选择和单位：\n   - 使用谐振子哈密顿量 $H(q,p)=\\frac{1}{2}p^{2}+\\frac{1}{2}q^{2}$，因此 $\\partial T/\\partial p=p$ 且 $\\partial V/\\partial q=q$。\n   - 所有角度 $\\theta$ 必须以弧度表示。\n\n4. 面积测量：\n   - 使用应用于离散点 $\\{(q_{k},p_{k})\\}_{k=0}^{M-1}$ 的鞋带公式计算多边形面积，来近似闭合环路的面积，其中索引对 $M$ 取模以闭合环路。\n   - 将近辛性诊断定义为单步映射下的相对面积变化：\n     $$\\varepsilon=\\frac{A_{\\text{after}}-A_{\\text{before}}}{A_{\\text{before}}},$$\n     其中 $A_{\\text{before}}$ 是初始环路的多边形面积，而 $A_{\\text{after}}$ 是由映射后的点构成的环路的多边形面积。将 $\\varepsilon$ 报告为浮点数。\n\n5. 测试套件：\n   - 对以下四种情况评估该诊断，每种情况由一个元组 $(\\text{method},h,R,M)$ 指定：\n     - 情况1：$(\\text{SV},\\,0.3,\\,1.0,\\,64)$，其中 $\\text{SV}$ 表示 Störmer-Verlet 方法，步长 $h=0.3$，半径 $R=1.0$，点数 $M=64$。\n     - 情况2：$(\\text{SV},\\,1.9,\\,1.0,\\,12)$，步长 $h=1.9$，半径 $R=1.0$，点数 $M=12$，以探究粗糙离散化和较大稳定步长的情况。\n     - 情况3：$(\\text{EE},\\,0.3,\\,1.0,\\,64)$，其中 $\\text{EE}$ 表示显式欧拉分区方法，步长 $h=0.3$，半径 $R=1.0$，点数 $M=64$。\n     - 情况4：$(\\text{EE},\\,0.01,\\,2.0,\\,128)$，步长 $h=0.01$，半径 $R=2.0$，点数 $M=128$，以探究小步长情况和更大的环路。\n\n6. 输出规格：\n   - 您的程序必须产生单行输出，其中包含上述案例的四个诊断值 $\\varepsilon$，以逗号分隔的列表形式并用方括号括起来，顺序为测试案例1到4（例如，$[\\varepsilon_{1},\\varepsilon_{2},\\varepsilon_{3},\\varepsilon_{4}]$）。\n   - 每个 $\\varepsilon$ 都必须是一个浮点数。\n\n您的实现必须是自包含的，不需要任何输入，并能运行至完成。程序必须使用双精度浮点运算。该数值实验必须在科学上是合理的：方法、哈密顿量和诊断必须与上述理论基础一致，并且角度单位必须按规定使用弧度。",
            "solution": "该问题要求实现一个数值实验，通过观察相空间中闭合环路面积的变化来衡量两种数值积分器的近辛性。所考虑的系统是单自由度谐振子，由可分哈密顿量 $H(q,p) = T(p) + V(q) = \\frac{1}{2}p^2 + \\frac{1}{2}q^2$ 描述。\n\n该系统的动力学由哈密顿方程决定：\n$$ \n\\begin{align*}\n\\dot{q} &= \\frac{\\partial H}{\\partial p} = \\frac{\\partial T(p)}{\\partial p} = p \\\\\n\\dot{p} &= -\\frac{\\partial H}{\\partial q} = -\\frac{\\partial V(q)}{\\partial q} = -q \n\\end{align*}\n$$\n这是一个线性常微分方程组。我们可以将其写成矩阵形式：\n$$ \\frac{d}{dt} \\begin{pmatrix} q \\\\ p \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\begin{pmatrix} q \\\\ p \\end{pmatrix} $$\n对于初始条件 $(q_0, p_0)$，该系统的精确解在 $(q,p)$ 相平面中描述了一个圆形轨迹，这显然是保面积的。\n\n一个固定步长为 $h$ 的单步数值积分器可以近似精确流。对于此线性系统，该积分器可以由一个常数矩阵 $M$ 表示，使得第 $n+1$ 步的状态 $(q_{n+1}, p_{n+1})$ 通过矩阵乘法从第 $n$ 步的状态 $(q_n, p_n)$ 获得：\n$$ \\begin{pmatrix} q_{n+1} \\\\ p_{n+1} \\end{pmatrix} = M \\begin{pmatrix} q_n \\\\ p_n \\end{pmatrix} $$\n一个映射被称为辛映射，如果它保持正则辛2-形式 $\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$ 不变。对于二维线性映射，这等价于其矩阵表示的行列式等于 $1$ 的条件。\n\n问题指出，保面积性是辛性的一个推论。由矩阵 $M$ 表示的线性映射将一个面积为 $A$ 的区域变换为一个面积为 $|\\det(M)| \\cdot A$ 的区域。该实验使用一个多边形环路作为连续区域的代理。由顶点 $\\{(q_k, p_k)\\}$ 构成的多边形面积遵循相同的变换规则：$A_{\\text{after}} = |\\det(M)| \\cdot A_{\\text{before}}$。近辛性的诊断量 $\\varepsilon$ 定义为相对面积变化：\n$$ \\varepsilon = \\frac{A_{\\text{after}} - A_{\\text{before}}}{A_{\\text{before}}} = \\frac{|\\det(M)| \\cdot A_{\\text{before}} - A_{\\text{before}}}{A_{\\text{before}}} = |\\det(M)| - 1 $$\n这一理论结果表明，对于任何线性积分器，$\\varepsilon$ 仅依赖于矩阵 $M$（从而依赖于方法和步长 $h$），而不依赖于初始环路的具体选择（即其半径 $R$ 或离散点数 $M$）。多边形面积通过鞋带公式计算：$A = \\frac{1}{2} |\\sum_{k=0}^{M-1} (q_k p_{k+1} - q_{k+1} p_k)|$。\n\n我们现在推导两种指定积分器的矩阵 $M$。\n\n1.  **Störmer-Verlet (SV) 方法**：\n    这是一个二阶辛分区Runge-Kutta（SPRK）方法。对于给定的可分哈密顿量，积分器的一个步骤定义如下：\n    1.  $p_{n+1/2} = p_n - \\frac{h}{2} \\frac{\\partial V}{\\partial q}(q_n) = p_n - \\frac{h}{2} q_n$\n    2.  $q_{n+1} = q_n + h \\frac{\\partial T}{\\partial p}(p_{n+1/2}) = q_n + h p_{n+1/2}$\n    3.  $p_{n+1} = p_{n+1/2} - \\frac{h}{2} \\frac{\\partial V}{\\partial q}(q_{n+1}) = p_{n+1/2} - \\frac{h}{2} q_{n+1}$\n\n    通过代入这些关系，我们可以将 $(q_{n+1}, p_{n+1})$ 表示为 $(q_n, p_n)$ 的线性变换。首先代入 $p_{n+1/2}$：\n    $$ q_{n+1} = q_n + h p_{n+1/2} = q_n + h(p_n - \\frac{h}{2} q_n) = (1 - \\frac{h^2}{2})q_n + h p_n $$\n    然后代入 $p_{n+1/2}$ 和 $q_{n+1}$：\n    $$ p_{n+1} = p_{n+1/2} - \\frac{h}{2} q_{n+1} = (p_n - \\frac{h}{2} q_n) - \\frac{h}{2} \\left( (1 - \\frac{h^2}{2})q_n + h p_n \\right) $$\n    $$ p_{n+1} = \\left(1 - \\frac{h^2}{2}\\right) p_n - \\left(\\frac{h}{2} + \\frac{h}{2}(1 - \\frac{h^2}{2})\\right) q_n = \\left(1 - \\frac{h^2}{2}\\right) p_n - \\left(h - \\frac{h^3}{4}\\right) q_n $$\n    因此，Störmer-Verlet步的矩阵表示为：\n    $$ M_{SV} = \\begin{pmatrix} 1 - \\frac{h^2}{2} & h \\\\ -h(1-\\frac{h^2}{4}) & 1 - \\frac{h^2}{2} \\end{pmatrix} $$\n    该矩阵的行列式为 $\\det(M_{SV}) = (1 - \\frac{h^2}{2})^2 + h^2(1-\\frac{h^2}{4}) = 1 - h^2 + \\frac{h^4}{4} + h^2 - \\frac{h^4}{4} = 1$。\n    正如对辛方法所预期的，行列式恰好为 $1$。因此，诊断的理论值为 $\\varepsilon_{SV} = \\det(M_{SV}) - 1 = 0$。数值实现中任何非零结果都将归因于浮点算术误差。\n\n2.  **分区显式欧拉（EE）方法**：\n    问题将此指定为非辛方法。这对应于应用于该常微分方程组的标准前向欧拉格式：\n    $q_{n+1} = q_n + h \\dot{q}_n = q_n + h p_n$\n    $p_{n+1} = p_n + h \\dot{p}_n = p_n - h q_n$\n    显式欧拉步的矩阵表示为：\n    $$ M_{EE} = \\begin{pmatrix} 1 & h \\\\ -h & 1 \\end{pmatrix} $$\n    该矩阵的行列式为 $\\det(M_{EE}) = (1)(1) - (h)(-h) = 1 + h^2$。\n    对于任何非零步长 $h$，行列式都大于 $1$，这表明该方法非辛，并将系统地增加相空间面积。理论诊断值为 $\\varepsilon_{EE} = \\det(M_{EE}) - 1 = (1+h^2) - 1 = h^2$。\n\n基于此分析，我们可以预测测试案例的结果：\n- 情况1：$(\\text{SV}, h=0.3)$。我们期望 $\\varepsilon_1 \\approx 0$。\n- 情况2：$(\\text{SV}, h=1.9)$。我们期望 $\\varepsilon_2 \\approx 0$。\n- 情况3：$(\\text{EE}, h=0.3)$。我们期望 $\\varepsilon_3 = 0.3^2 = 0.09$。\n- 情况4：$(\\text{EE}, h=0.01)$。我们期望 $\\varepsilon_4 = 0.01^2 = 0.0001$。\n\n以下Python代码实现了这个实验。它生成一个初始的圆形点环路，对每个点应用指定积分器的一个单步，使用鞋带公式计算初始和最终多边形的面积，并计算相对面积变化 $\\varepsilon$。为提高效率，使用NumPy进行了向量化计算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a numerical experiment to measure the near-symplecticity\n    of Störmer-Verlet and Explicit Euler methods for the harmonic oscillator.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (method, h, R, M)\n        (\"SV\", 0.3, 1.0, 64),\n        (\"SV\", 1.9, 1.0, 12),\n        (\"EE\", 0.3, 1.0, 64),\n        (\"EE\", 0.01, 2.0, 128),\n    ]\n\n    results = []\n\n    def calculate_area(points):\n        \"\"\"\n        Calculates the area of a polygon using the shoelace formula.\n        The input points is an (M, 2) numpy array of (q, p) coordinates.\n        \"\"\"\n        q = points[:, 0]\n        p = points[:, 1]\n        # Vectorized shoelace formula: 0.5 * |(x0y1 + x1y2 + ... ) - (y0x1 + y1x2 + ...)|\n        # Roll provides the periodic boundary condition for the polygon.\n        return 0.5 * np.abs(np.dot(q, np.roll(p, -1)) - np.dot(p, np.roll(q, -1)))\n\n    def step_sv(q, p, h):\n        \"\"\"\n        Performs a single Störmer-Verlet step for the harmonic oscillator.\n        H = p^2/2 + q^2/2, so T_p = p, V_q = q.\n        This is a vectorized function.\n        \"\"\"\n        # 1. Half kick\n        p_half = p - 0.5 * h * q\n        # 2. Full drift\n        q_new = q + h * p_half\n        # 3. Half kick\n        p_new = p_half - 0.5 * h * q_new\n        return q_new, p_new\n\n    def step_ee(q, p, h):\n        \"\"\"\n        Performs a single Explicit Euler step for the harmonic oscillator.\n        System is dq/dt = p, dp/dt = -q.\n        This is a vectorized function.\n        \"\"\"\n        q_new = q + h * p\n        p_new = p - h * q\n        return q_new, p_new\n\n    for case in test_cases:\n        method, h, R, M = case\n\n        # 1. Generate the initial closed loop (a discretized circle).\n        # Angles must be in radians. np.linspace is appropriate.\n        theta = np.linspace(0.0, 2.0 * np.pi, M, endpoint=False)\n        q_initial = R * np.cos(theta)\n        p_initial = R * np.sin(theta)\n        initial_points = np.stack((q_initial, p_initial), axis=1)\n\n        # 2. Calculate the area of the initial polygon.\n        area_before = calculate_area(initial_points)\n\n        # 3. Apply one step of the integrator to all points on the loop.\n        if method == \"SV\":\n            q_final, p_final = step_sv(q_initial, p_initial, h)\n        elif method == \"EE\":\n            q_final, p_final = step_ee(q_initial, p_initial, h)\n        else:\n            raise ValueError(f\"Unknown method: {method}\")\n            \n        final_points = np.stack((q_final, p_final), axis=1)\n        \n        # 4. Calculate the area of the mapped polygon.\n        area_after = calculate_area(final_points)\n\n        # 5. Compute the relative area change diagnostic.\n        # Check for area_before == 0 to prevent division by zero, though unlikely.\n        if area_before == 0.0:\n            epsilon = 0.0 if area_after == 0.0 else np.inf\n        else:\n            epsilon = (area_after - area_before) / area_before\n        \n        results.append(epsilon)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) ensures standard float representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}