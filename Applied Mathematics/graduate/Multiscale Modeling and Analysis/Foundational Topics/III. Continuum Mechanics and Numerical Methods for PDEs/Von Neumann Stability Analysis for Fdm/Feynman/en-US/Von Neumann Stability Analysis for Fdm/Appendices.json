{
    "hands_on_practices": [
        {
            "introduction": "Understanding the stability of a numerical scheme is the first step toward trusting its results. This practice provides a foundational exercise in von Neumann stability analysis, focusing on the widely used first-order upwind scheme for the advection equation. By deriving the amplification factor $G(\\theta)$ and applying the stability criterion $|G(\\theta)| \\le 1$, you will determine the famous Courant–Friedrichs–Lewy (CFL) condition, a cornerstone of numerical methods for hyperbolic PDEs. ",
            "id": "3832003",
            "problem": "Consider the one-dimensional linear advection equation $u_{t} + c\\,u_{x} = 0$ with constant advection speed $c0$. On a uniform spatial grid with spacing $\\Delta x$ and time step $\\Delta t$, define the Courant number $\\lambda = c\\,\\Delta t/\\Delta x$. The first-order upwind finite difference method (FDM) for $c0$ is\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\lambda\\left(u_{j}^{n} - u_{j-1}^{n}\\right).\n$$\nUsing von Neumann (Fourier) stability analysis, assume a discrete Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\,\\exp\\!\\left(i\\,j\\,\\theta\\right)$ with phase $\\theta \\in [-\\pi,\\pi]$ measured in radians. Starting from the scheme and this ansatz, derive the discrete amplification factor $G(\\theta)$ defined by $G(\\theta) = \\hat{u}^{n+1}/\\hat{u}^{n}$ as a function of $\\theta$ and $\\lambda$, and then use the von Neumann stability criterion $\\sup_{\\theta \\in [-\\pi,\\pi]} |G(\\theta)| \\leq 1$ to determine the largest admissible Courant–Friedrichs–Lewy (CFL) number $\\lambda_{\\max}$ that guarantees stability for all Fourier modes.\n\nProvide your final reported answer as the exact value of $\\lambda_{\\max}$ (dimensionless).",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard exercise in the stability analysis of finite difference methods, a core topic in numerical analysis for partial differential equations. All necessary information is provided, and the terminology is precise and unambiguous. We may therefore proceed with the solution.\n\nThe problem requires a von Neumann stability analysis of the first-order upwind scheme for the linear advection equation. The scheme is given by\n$$u_{j}^{n+1} = u_{j}^{n} - \\lambda\\left(u_{j}^{n} - u_{j-1}^{n}\\right)$$\nwhere $\\lambda = c\\,\\Delta t/\\Delta x$ is the Courant number, with $c  0$.\n\nWe perform a Fourier analysis by substituting the ansatz for a single Fourier mode, $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$, into the finite difference scheme. The phase angle $\\theta$ is defined as $k\\,\\Delta x$, where $k$ is the wavenumber. The terms in the scheme become:\n$$u_{j}^{n+1} = \\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j-1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,(j-1)\\,\\theta) = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)$$\nSubstituting these expressions into the scheme yields:\n$$\\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta) = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta) - \\lambda\\left(\\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta) - \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)\\right)$$\nTo find the amplification factor $G(\\theta) = \\hat{u}^{n+1}/\\hat{u}^{n}$, we divide the entire equation by the non-zero term $\\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$:\n$$G(\\theta) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}} = 1 - \\lambda\\left(1 - \\exp(-i\\,\\theta)\\right)$$\nThis is the expression for the discrete amplification factor as a function of $\\theta$ and $\\lambda$. To analyze its stability, we must evaluate its magnitude, $|G(\\theta)|$. It is often more convenient to work with the magnitude squared, $|G(\\theta)|^2$. Using Euler's formula, $\\exp(-i\\,\\theta) = \\cos(\\theta) - i\\,\\sin(\\theta)$, we can express $G(\\theta)$ in terms of its real and imaginary parts:\n$$G(\\theta) = 1 - \\lambda\\left(1 - (\\cos(\\theta) - i\\,\\sin(\\theta))\\right)$$\n$$G(\\theta) = 1 - \\lambda + \\lambda\\,\\cos(\\theta) + i\\,\\lambda\\,\\sin(\\theta)$$\nThe real and imaginary parts of $G(\\theta)$ are:\n$$\\text{Re}(G(\\theta)) = 1 - \\lambda + \\lambda\\,\\cos(\\theta)$$\n$$\\text{Im}(G(\\theta)) = \\lambda\\,\\sin(\\theta)$$\nThe magnitude squared is therefore:\n$$|G(\\theta)|^2 = (\\text{Re}(G(\\theta)))^2 + (\\text{Im}(G(\\theta)))^2$$\n$$|G(\\theta)|^2 = (1 - \\lambda + \\lambda\\,\\cos(\\theta))^2 + (\\lambda\\,\\sin(\\theta))^2$$\nExpanding the squared terms:\n$$|G(\\theta)|^2 = (1 - \\lambda)^2 + 2\\lambda(1-\\lambda)\\cos(\\theta) + \\lambda^2\\cos^2(\\theta) + \\lambda^2\\sin^2(\\theta)$$\nUsing the trigonometric identity $\\cos^2(\\theta) + \\sin^2(\\theta) = 1$:\n$$|G(\\theta)|^2 = (1 - \\lambda)^2 + 2\\lambda(1-\\lambda)\\cos(\\theta) + \\lambda^2$$\n$$|G(\\theta)|^2 = (1 - 2\\lambda + \\lambda^2) + (2\\lambda - 2\\lambda^2)\\cos(\\theta) + \\lambda^2$$\n$$|G(\\theta)|^2 = 1 - 2\\lambda + 2\\lambda^2 + (2\\lambda - 2\\lambda^2)\\cos(\\theta)$$\nFactoring terms to simplify the expression:\n$$|G(\\theta)|^2 = 1 + (2\\lambda^2 - 2\\lambda) - (2\\lambda^2 - 2\\lambda)\\cos(\\theta)$$\n$$|G(\\theta)|^2 = 1 + (2\\lambda^2 - 2\\lambda)(1 - \\cos(\\theta))$$\n$$|G(\\theta)|^2 = 1 + 2\\lambda(\\lambda - 1)(1 - \\cos(\\theta))$$\nThe von Neumann stability criterion requires that $\\sup_{\\theta \\in [-\\pi,\\pi]} |G(\\theta)| \\le 1$, which is equivalent to $|G(\\theta)|^2 \\le 1$ for all $\\theta \\in [-\\pi, \\pi]$. Applying this criterion to our expression for $|G(\\theta)|^2$:\n$$1 + 2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 1$$\nSubtracting $1$ from both sides gives:\n$$2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 0$$\nTo determine the condition on $\\lambda$, we analyze the signs of the factors in this inequality.\n1. The Courant number $\\lambda = c\\,\\Delta t/\\Delta x$ is a product of positive physical quantities ($c0$, $\\Delta t0$, $\\Delta x0$), so we must have $\\lambda \\ge 0$. (The case $\\lambda = 0$ corresponds to $\\Delta t = 0$, where the solution does not evolve and is trivially stable.)\n2. The term $(1 - \\cos(\\theta))$ is always non-negative for any real $\\theta$, since the range of $\\cos(\\theta)$ is $[-1, 1]$. Specifically, $(1 - \\cos(\\theta)) \\ge 0$. This term is zero only when $\\theta = 2\\pi k$ for integer $k$, and is strictly positive otherwise.\n\nFor the inequality $2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 0$ to hold for all $\\theta \\in [-\\pi, \\pi]$, we must examine the term $\\lambda(\\lambda - 1)$. As $\\lambda \\ge 0$ and $(1 - \\cos(\\theta)) \\ge 0$, the inequality is satisfied for all $\\theta$ if and only if the term $(\\lambda - 1)$ is non-positive.\n$$\\lambda - 1 \\le 0$$\nThis implies:\n$$\\lambda \\le 1$$\nCombining this with the physical constraint $\\lambda \\ge 0$, the stability condition for the first-order upwind scheme is $0 \\le \\lambda \\le 1$.\n\nThe problem asks for the largest admissible Courant number, $\\lambda_{\\max}$, that guarantees stability. Based on the derived stability range $0 \\le \\lambda \\le 1$, the maximum value is $1$.\nTherefore, the largest admissible Courant–Friedrichs–Lewy (CFL) number is $\\lambda_{\\max} = 1$.",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "Analytical results gain power when they are confirmed by experiment. This hands-on coding exercise takes the abstract concept of the amplification factor, $G(\\theta)$, and makes it tangible by designing a numerical experiment to measure it directly. You will initialize a solution with a single Fourier mode and track its amplitude after one time step, providing a direct, empirical verification of the von Neumann analysis for the diffusion equation. ",
            "id": "3831988",
            "problem": "Consider the one-dimensional diffusion equation in dimensionless form, $\\partial_t u(x,t) = \\alpha\\,\\partial_{xx} u(x,t)$, posed on a periodic domain discretized by a uniform grid with $N$ points, index $j \\in \\{0,1,\\dots,N-1\\}$, grid spacing $\\Delta x$, and time step $\\Delta t$. Let the numerical scheme be the forward Euler method in time combined with the second-order centered finite difference in space, applied with periodic boundary conditions. Define the nondimensional parameter $\\mu = \\alpha\\,\\Delta t / \\Delta x^2$. Initialize the discrete solution at time step $n=0$ by a single Fourier mode $u_j^0 = \\exp(i\\,\\theta\\,j)$, where the discrete angle $\\theta$ must satisfy periodicity and is given by $\\theta = 2\\pi m / N$ for an integer mode index $m$. Angles must be expressed in radians.\n\nYour task is to design a numerical experiment that measures the growth of this single Fourier mode under one time step of the numerical scheme, to empirically estimate the magnitude of the amplification factor $|G(\\theta)|$, and to compare it with the analytical prediction you derive from first principles for this scheme. Specifically:\n- Compute one time step of the scheme from $u_j^0$ to $u_j^1$ with periodic boundary conditions.\n- Estimate the complex amplitude coefficient $A^n$ of the Fourier mode at step $n$ by the discrete Fourier projection $A^n = \\frac{1}{N}\\sum_{j=0}^{N-1} u_j^n \\exp(-i\\,\\theta\\,j)$, and define the empirical magnitude of the amplification factor by $|G_{\\mathrm{emp}}(\\theta)| = |A^1| / |A^0|$.\n- Compare $|G_{\\mathrm{emp}}(\\theta)|$ to the analytical magnitude $|G_{\\mathrm{ana}}(\\theta)|$ that you obtain through a von Neumann stability analysis of the given finite difference scheme.\n\nDesign the program to evaluate the following test suite. For each test case, the parameters are $(N,m,\\mu)$, and the angle is $\\theta = 2\\pi m / N$ in radians:\n1. $N=64$, $m=8$, $\\mu=0.25$.\n2. $N=64$, $m=32$, $\\mu=0.50$.\n3. $N=64$, $m=32$, $\\mu=0.60$.\n4. $N=128$, $m=16$, $\\mu=0.25$.\n5. $N=64$, $m=0$, $\\mu=0.25$.\n\nFor each of the five test cases, compute the absolute error $E_k = ||G_{\\mathrm{emp}}(\\theta_k)| - |G_{\\mathrm{ana}}(\\theta_k)||$ as a floating-point number. In addition, compute a cross-scale consistency diagnostic $D$ defined as the absolute difference between the empirical magnitudes for tests 1 and 4, $D = ||G_{\\mathrm{emp}}(\\theta_1)| - |G_{\\mathrm{emp}}(\\theta_4)||$, which isolates identical discrete angle $\\theta$ realized on two different grids, thereby testing scale invariance of the amplification factor.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[E_1,E_2,E_3,E_4,E_5,D]$. All angles must be in radians. No physical units beyond these dimensionless quantities are required. The outputs must be floating-point numbers.",
            "solution": "We begin from the one-dimensional diffusion equation $\\partial_t u(x,t) = \\alpha\\,\\partial_{xx} u(x,t)$ on a periodic domain and apply a linear, translation-invariant finite difference method: forward Euler in time and second-order centered difference in space. On a uniform grid with index $j \\in \\{0,1,\\dots,N-1\\}$, spacing $\\Delta x$, and time step $\\Delta t$, define the nondimensional time step parameter $\\mu = \\alpha\\,\\Delta t/\\Delta x^2$. The periodic boundary conditions imply $u_{j+N}^n = u_j^n$ for all integers $j$ and time steps $n$.\n\nThe discrete scheme reads\n$$\nu_j^{n+1} = u_j^n + \\mu\\left(u_{j+1}^n - 2u_j^n + u_{j-1}^n\\right),\n$$\nwhere the second-order centered finite difference approximates $\\partial_{xx} u$ and forward Euler advances in time. Because the operator is linear and shift-invariant with constant coefficients, discrete Fourier modes are eigenfunctions. Consider the discrete Fourier ansatz\n$$\nu_j^n = A^n \\exp(i\\,\\theta\\,j),\n$$\nwhere the discrete angle $\\theta$ satisfies the periodicity constraint $\\theta = 2\\pi m / N$ for an integer mode index $m$. Substituting the ansatz into the scheme yields\n$$\nA^{n+1}\\exp(i\\,\\theta\\,j) = A^n\\exp(i\\,\\theta\\,j) + \\mu\\left[ A^n\\exp\\big(i\\,\\theta\\,(j+1)\\big) - 2A^n\\exp(i\\,\\theta\\,j) + A^n\\exp\\big(i\\,\\theta\\,(j-1)\\big)\\right].\n$$\nDivide both sides by $\\exp(i\\,\\theta\\,j)$ and $A^n$ to obtain the amplification factor\n$$\nG(\\theta) = \\frac{A^{n+1}}{A^n} = 1 + \\mu\\left(e^{i\\theta} - 2 + e^{-i\\theta}\\right).\n$$\nUse the identity $e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$ to simplify\n$$\nG(\\theta) = 1 + \\mu\\left(2\\cos\\theta - 2\\right) = 1 - 2\\mu(1 - \\cos\\theta).\n$$\nFurther, employ the trigonometric half-angle identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$ to obtain\n$$\nG(\\theta) = 1 - 4\\mu\\,\\sin^2\\!\\left(\\frac{\\theta}{2}\\right).\n$$\nFor this real diffusion scheme, $G(\\theta)$ is real-valued, and the magnitude is\n$$\n|G(\\theta)| = \\left| 1 - 4\\mu\\,\\sin^2\\!\\left(\\frac{\\theta}{2}\\right)\\right|.\n$$\nThe classical von Neumann (Fourier) stability condition arises from the requirement $|G(\\theta)| \\le 1$ for all $\\theta$, which leads to $\\mu \\le \\frac{1}{2}$, with equality yielding $|G(\\pi)| = 1$ and sign inversion at the Nyquist frequency.\n\nPrinciple-based algorithmic design for the numerical experiment:\n1. Choose $N$, $m$, and $\\mu$, and compute the discrete angle $\\theta = 2\\pi m / N$ in radians.\n2. Initialize the discrete solution at time step $n=0$ by the single Fourier mode $u_j^0 = \\exp(i\\,\\theta\\,j)$ for $j=0,\\dots,N-1$.\n3. Apply one time step of the scheme with periodic boundary conditions:\n   $$\n   u_j^{1} = u_j^0 + \\mu\\left(u_{j+1}^0 - 2u_j^0 + u_{j-1}^0\\right),\n   $$\n   using index wrap-around so that $u_{-1}^0 = u_{N-1}^0$ and $u_{N}^0 = u_0^0$.\n4. Estimate the amplitude coefficient at steps $n=0$ and $n=1$ by discrete Fourier projection onto the mode $\\exp(i\\,\\theta\\,j)$:\n   $$\n   A^n = \\frac{1}{N}\\sum_{j=0}^{N-1} u_j^n \\exp(-i\\,\\theta\\,j).\n   $$\n   Because the initialization is a pure mode and the operator is diagonal in the Fourier basis, $A^0 = 1$ up to round-off, and $A^1 = G(\\theta)$ up to round-off.\n5. Define the empirical magnitude $|G_{\\mathrm{emp}}(\\theta)| = |A^1| / |A^0|$ and the analytical magnitude $|G_{\\mathrm{ana}}(\\theta)| = \\left| 1 - 4\\mu\\,\\sin^2(\\theta/2)\\right|$.\n6. Compute the absolute error per test case $E_k = ||G_{\\mathrm{emp}}(\\theta_k)| - |G_{\\mathrm{ana}}(\\theta_k)||$.\n7. To test cross-scale invariance, use two grids that realize the same discrete angle $\\theta$ (e.g., $N=64,m=8$ and $N=128,m=16$ both yield $\\theta = \\pi/4$). Compute $D = ||G_{\\mathrm{emp}}(\\theta_1)| - |G_{\\mathrm{emp}}(\\theta_4)||$.\n\nTest suite coverage rationale:\n- Case 1 ($N=64$, $m=8$, $\\mu=0.25$): a low-to-intermediate wavenumber in the stable regime ($\\mu  1/2$), verifying typical decay.\n- Case 2 ($N=64$, $m=32$, $\\mu=0.50$): the Nyquist frequency at the stability boundary ($\\mu = 1/2$), yielding neutral magnitude $|G| = 1$ with sign inversion.\n- Case 3 ($N=64$, $m=32$, $\\mu=0.60$): the same Nyquist frequency in the unstable regime ($\\mu  1/2$), verifying growth with $|G| > 1$.\n- Case 4 ($N=128$, $m=16$, $\\mu=0.25$): same discrete angle as Case 1 on a finer grid, testing multiscale consistency (grid refinement does not change amplification at fixed $\\theta$).\n- Case 5 ($N=64$, $m=0$, $\\mu=0.25$): the zero mode, which is preserved exactly in magnitude by diffusion, providing a boundary check ($\\theta=0$ implies $|G| = 1$).\n\nThe program implements the scheme using vectorized operations and periodic shifts, projects onto the initialized Fourier mode to estimate amplitudes, evaluates analytical predictions from the derived formula, and reports the absolute errors and the cross-scale diagnostic in the specified single-line output format.",
            "answer": "```python\nimport numpy as np\n\ndef empirical_G_magnitude(N, m, mu):\n    \"\"\"\n    Compute the empirical magnitude of the amplification factor |G_emp(theta)|\n    for one forward Euler + centered-difference diffusion step on a periodic grid.\n\n    Parameters:\n        N (int): number of grid points\n        m (int): discrete Fourier mode index\n        mu (float): nondimensional time step parameter alpha*dt/dx^2\n\n    Returns:\n        float: empirical |G(theta)|\n        float: analytical |G(theta)|\n    \"\"\"\n    # Discrete angle in radians\n    theta = 2.0 * np.pi * m / N\n\n    # Grid indices j = 0,...,N-1\n    j = np.arange(N, dtype=np.float64)\n\n    # Initialize single Fourier mode u_j^0 = exp(i * theta * j)\n    u0 = np.exp(1j * theta * j)\n\n    # One time step: u^{1} = u^{0} + mu (u_{j+1}^0 - 2 u_j^0 + u_{j-1}^0)\n    u_plus = np.roll(u0, -1)   # u_{j+1}^0 with periodic wrap\n    u_minus = np.roll(u0, 1)   # u_{j-1}^0 with periodic wrap\n    u1 = u0 + mu * (u_plus - 2.0 * u0 + u_minus)\n\n    # Discrete Fourier projection to estimate amplitudes\n    # A^n = (1/N) sum_j u_j^n * exp(-i * theta * j)\n    phase = np.exp(-1j * theta * j)\n    A0 = (u0 * phase).sum() / N\n    A1 = (u1 * phase).sum() / N\n\n    # Empirical magnitude of amplification factor\n    G_emp_mag = np.abs(A1) / np.abs(A0)\n\n    # Analytical magnitude from von Neumann analysis: |1 - 4 mu sin^2(theta/2)|\n    G_ana_mag = np.abs(1.0 - 4.0 * mu * (np.sin(theta / 2.0) ** 2))\n\n    return float(G_emp_mag), float(G_ana_mag)\n\ndef solve():\n    # Define the test cases (N, m, mu)\n    test_cases = [\n        (64, 8, 0.25),   # Case 1\n        (64, 32, 0.50),  # Case 2 (Nyquist at stability boundary)\n        (64, 32, 0.60),  # Case 3 (Nyquist in unstable regime)\n        (128, 16, 0.25), # Case 4 (same theta as Case 1 on finer grid)\n        (64, 0, 0.25),   # Case 5 (zero mode)\n    ]\n\n    empirical_mags = []\n    errors = []\n\n    for N, m, mu in test_cases:\n        G_emp_mag, G_ana_mag = empirical_G_magnitude(N, m, mu)\n        empirical_mags.append(G_emp_mag)\n        errors.append(abs(G_emp_mag - G_ana_mag))\n\n    # Cross-scale consistency diagnostic: difference between empirical magnitudes for Cases 1 and 4\n    D = abs(empirical_mags[0] - empirical_mags[3])\n\n    # Prepare final results: [E1,E2,E3,E4,E5,D]\n    results = errors + [D]\n\n    # Print single-line output in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The power of a theory is defined by its limits. Standard von Neumann analysis assumes constant coefficients, a condition often unmet in multiscale systems with heterogeneous materials. This practice challenges you to explore what happens when this assumption breaks down, using a variable-coefficient diffusion problem as a case study. You will computationally demonstrate that a naive \"frozen-coefficient\" stability bound can fail dramatically and discover how advanced spectral and multiscale methods provide a more rigorous path to ensuring numerical stability. ",
            "id": "3831873",
            "problem": "Consider the one-dimensional parabolic partial differential equation with variable diffusion coefficient,\n$$\n\\frac{\\partial u}{\\partial t} = a(x)\\,\\frac{\\partial^2 u}{\\partial x^2},\n$$\nposed on a periodic domain of length $L$ with $x \\in [0,L]$, where $a(x)  0$ is bounded and measurable. A standard explicit time-stepping method with central spatial differences updates $u_i^n \\approx u(x_i,t_n)$ on a uniform grid $x_i = i\\,\\Delta x$, $i=0,1,\\dots,N-1$, $\\Delta x = L/N$, via\n$$\nu_i^{n+1} = u_i^n + \\Delta t\\, a_i \\frac{u_{i+1}^n - 2 u_i^n + u_{i-1}^n}{\\Delta x^2},\n$$\nwith periodic indexing $u_{-1}^n \\equiv u_{N-1}^n$ and $u_{N}^n \\equiv u_0^n$, and $a_i = a(x_i)$. In matrix form, this update can be written as\n$$\n\\boldsymbol{u}^{n+1} = \\left(\\boldsymbol{I} + \\Delta t\\,\\boldsymbol{A}\\right)\\,\\boldsymbol{u}^n,\n$$\nwhere $\\boldsymbol{I}$ is the identity and\n$$\n\\boldsymbol{A} = \\frac{1}{\\Delta x^2}\\,\\operatorname{diag}(a_0,a_1,\\dots,a_{N-1})\\,\\boldsymbol{L}_0,\n$$\nwith $\\boldsymbol{L}_0$ the standard second-difference matrix with periodic boundary conditions, defined by $(\\boldsymbol{L}_0 \\boldsymbol{u})_i = u_{i+1} - 2 u_i + u_{i-1}$. For constant $a(x) \\equiv a_0$, classical von Neumann (Fourier) analysis yields the maximum stable time step for forward Euler,\n$$\n\\Delta t_{\\text{const}} = \\frac{\\Delta x^2}{2 a_0}.\n$$\nA naive \"frozen-coefficient\" stability bound for variable $a(x)$ replaces $a_0$ by $\\max_i a_i$ and asserts\n$$\n\\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2 \\max_i a_i}.\n$$\nHowever, when $a(x)$ varies rapidly on the grid scale, the amplification matrix $\\boldsymbol{I} + \\Delta t\\,\\boldsymbol{A}$ couples Fourier modes and the naive bound can be invalid. The forward Euler stability region is the closed disk of radius $1$ centered at $-1$ in the complex plane, so stability requires that for every eigenvalue $\\lambda$ of $\\boldsymbol{A}$,\n$$\n\\Delta t\\,\\lambda \\in \\{ z \\in \\mathbb{C} : |z+1| \\le 1 \\}.\n$$\nEquivalently, the maximum admissible time step is\n$$\n\\Delta t_{\\text{actual}} = \\min_{\\lambda \\in \\sigma(\\boldsymbol{A}),\\,\\Re(\\lambda)  0} \\frac{-2\\,\\Re(\\lambda)}{|\\lambda|^2},\n$$\nwhere $\\sigma(\\boldsymbol{A})$ is the spectrum of $\\boldsymbol{A}$.\n\nIn multiscale settings, a principled alternative to naive freezing is a local Fourier (Bloch-Floquet) analysis adapted to the coefficient’s microscale. For a period-$p$ coefficient pattern, one seeks plane-wave solutions with $p$-component amplitudes and derives a $p \\times p$ symbol whose eigenvalues approximate the spectrum. For the period-$2$ alternating pattern $a_i = H$ for even $i$ and $a_i = L$ for odd $i$, define the discrete wavenumber $\\theta \\in [-\\pi,\\pi]$ (in radians) and the block amplitudes $v_{\\text{e}}$ and $v_{\\text{o}}$ for even and odd grid points, respectively. The associated $2 \\times 2$ symbol for $\\boldsymbol{A}$ is\n$$\n\\boldsymbol{M}(\\theta) = \\frac{1}{\\Delta x^2}\n\\begin{bmatrix}\n-2H  2H\\cos(\\theta) \\\\\n2L\\cos(\\theta)  -2L\n\\end{bmatrix},\n$$\nwhose eigenvalues $\\mu(\\theta)$ provide a multiscale local Fourier estimate of $\\sigma(\\boldsymbol{A})$ and thus of the stability bound,\n$$\n\\Delta t_{\\text{LFA}} = \\min_{\\theta \\in [-\\pi,\\pi],\\,\\mu(\\theta)} \\frac{-2\\,\\Re(\\mu(\\theta))}{|\\mu(\\theta)|^2}.\n$$\n\nYour task is to write a complete, runnable program that:\n- Constructs $\\boldsymbol{A}$ for the given $a_i$ on a periodic grid and computes $\\Delta t_{\\text{actual}}$ using the spectral criterion above.\n- Computes $\\Delta t_{\\text{naive}}$.\n- For the period-$2$ alternating pattern, computes $\\Delta t_{\\text{LFA}}$ by minimizing over $\\theta \\in [-\\pi,\\pi]$ the forward Euler bound induced by $\\boldsymbol{M}(\\theta)$.\n- Aggregates the results for the specified test suite.\n\nUse the following test suite:\n- Test $1$ (baseline constant coefficient): $N = 128$, $L = 1$, $a_i \\equiv a_0 = 1$. Output the relative error $\\delta_1 = \\left|\\Delta t_{\\text{actual}} - \\Delta t_{\\text{naive}}\\right|/\\Delta t_{\\text{actual}}$ as a float.\n- Test $2$ (slowly varying coefficient): $N = 128$, $L = 1$, $a_i = 1 + 0.1\\sin(2\\pi x_i)$ with $x_i = i \\Delta x$. Output the boolean $v_2$ indicating whether the naive bound is valid, defined as $v_2 = \\left(\\Delta t_{\\text{naive}} \\le \\Delta t_{\\text{actual}}\\right)$.\n- Test $3$ (rapidly oscillatory counterexample): $N = 128$, $L = 1$, $a_i = H$ for even $i$ and $a_i = L$ for odd $i$, with $H = 10$ and $L = 0.1$. Output the boolean $v_3$ indicating invalidation of the naive bound, defined as $v_3 = \\left(\\Delta t_{\\text{naive}}  \\Delta t_{\\text{actual}}\\right)$.\n- Test $4$ (multiscale local Fourier analysis for period-$2$): use the same parameters as Test $3$. Compute $\\Delta t_{\\text{LFA}}$ via the symbol $\\boldsymbol{M}(\\theta)$ and output the list $[\\rho_{\\text{naive}}, \\rho_{\\text{LFA}}]$, where\n$$\n\\rho_{\\text{naive}} = \\frac{\\left|\\Delta t_{\\text{naive}} - \\Delta t_{\\text{actual}}\\right|}{\\Delta t_{\\text{actual}}}, \\quad\n\\rho_{\\text{LFA}} = \\frac{\\left|\\Delta t_{\\text{LFA}} - \\Delta t_{\\text{actual}}\\right|}{\\Delta t_{\\text{actual}}}.\n$$\n\nAngle quantities $\\theta$ must be treated in radians. All quantities are dimensionless. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the four test case outputs ordered consecutively, namely $[\\delta_1, v_2, v_3, [\\rho_{\\text{naive}}, \\rho_{\\text{LFA}}]]$.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be valid. It is scientifically grounded in the principles of numerical analysis for partial differential equations, specifically concerning the stability of explicit finite difference methods. The problem is well-posed, with all necessary parameters, definitions, and conditions provided to arrive at a unique, verifiable solution. The language is objective and the tasks are formalizable.\n\nThe core of the problem is to compare different estimates for the maximum stable time step $\\Delta t$ for the forward Euler discretization of the one-dimensional heat equation with a variable diffusion coefficient $a(x)$. The scheme is\n$$\nu_i^{n+1} = u_i^n + \\frac{\\Delta t \\cdot a_i}{\\Delta x^2} (u_{i+1}^n - 2 u_i^n + u_{i-1}^n).\n$$\nIn matrix form, this is $\\boldsymbol{u}^{n+1} = (\\boldsymbol{I} + \\Delta t \\boldsymbol{A}) \\boldsymbol{u}^n$, where the matrix $\\boldsymbol{A}$ encapsulates the spatial discretization. Stability requires that the spectral radius of the amplification matrix $\\boldsymbol{G} = \\boldsymbol{I} + \\Delta t \\boldsymbol{A}$ is no greater than $1$. For the forward Euler method, this is guaranteed if, for every eigenvalue $\\lambda$ of $\\boldsymbol{A}$, the value $\\Delta t \\lambda$ lies within the stability region $\\{ z \\in \\mathbb{C} : |z+1| \\le 1 \\}$. This leads to the formula for the maximum stable time step:\n$$\n\\Delta t_{\\text{actual}} = \\min_{\\lambda \\in \\sigma(\\boldsymbol{A}),\\,\\Re(\\lambda)  0} \\frac{-2\\,\\Re(\\lambda)}{|\\lambda|^2}.\n$$\n\nThe procedure to solve the problem involves three main calculations: $\\Delta t_{\\text{actual}}$, $\\Delta t_{\\text{naive}}$, and $\\Delta t_{\\text{LFA}}$.\n\n**1. Actual Time Step ($\\Delta t_{\\text{actual}}$)**\n\nThis requires the full spectrum of the matrix $\\boldsymbol{A}$. The matrix $\\boldsymbol{A}$ is defined as\n$$\n\\boldsymbol{A} = \\frac{1}{\\Delta x^2} \\boldsymbol{D}_a \\boldsymbol{L}_0,\n$$\nwhere $\\boldsymbol{D}_a = \\operatorname{diag}(a_0, a_1, \\dots, a_{N-1})$ is the diagonal matrix of diffusion coefficients at grid points, and $\\boldsymbol{L}_0$ is the $N \\times N$ second-difference matrix for a periodic domain. $\\boldsymbol{L}_0$ is a circulant matrix with $-2$ on the main diagonal, $1$ on the first super- and sub-diagonals, and $1$ at the top-right and bottom-left corners to enforce periodicity. Specifically, its elements are $(\\boldsymbol{L}_0)_{ij} = \\delta_{i,j+1} - 2\\delta_{i,j} + \\delta_{i,j-1}$ with indices taken modulo $N$.\nTo compute $\\Delta t_{\\text{actual}}$, we construct the $N \\times N$ matrix $\\boldsymbol{A}$ for the given coefficient function $a(x)$, compute its eigenvalues $\\lambda_j$ numerically, filter out any eigenvalues with non-negative real parts (such as the zero eigenvalue associated with the constant mode), and apply the given formula to find the minimum bound over all relevant eigenvalues.\n\n**2. Naive Time Step ($\\Delta t_{\\text{naive}}$)**\n\nThis bound is derived from a \"frozen-coefficient\" analysis, where the stability limit for a constant coefficient $a_0$, which is $\\frac{\\Delta x^2}{2a_0}$, is adapted by inserting the maximum value of $a(x)$ over the grid.\n$$\n\\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2 \\max_i a_i}.\n$$\nThis bound is simple to compute but can be inaccurate, especially when $a(x)$ varies on a scale comparable to the grid spacing $\\Delta x$.\n\n**3. Local Fourier Analysis Time Step ($\\Delta t_{\\text{LFA}}$)**\n\nFor the specific case of a period-$2$ coefficient profile, $a_i = H$ for even $i$ and $a_i = L$ for odd $i$, a more sophisticated estimate can be derived using local Fourier analysis (also known as Bloch-Floquet theory). The problem provides the $2 \\times 2$ symbol matrix $\\boldsymbol{M}(\\theta)$:\n$$\n\\boldsymbol{M}(\\theta) = \\frac{1}{\\Delta x^2}\n\\begin{bmatrix}\n-2H  2H\\cos(\\theta) \\\\\n2L\\cos(\\theta)  -2L\n\\end{bmatrix}.\n$$\nThe eigenvalues $\\mu(\\theta)$ of this matrix approximate the spectrum of $\\boldsymbol{A}$. To find $\\Delta t_{\\text{LFA}}$, we must find the most restrictive stability constraint imposed by these eigenvalues. The eigenvalues of $\\boldsymbol{M}(\\theta)$ are found by solving the characteristic equation $\\det(\\boldsymbol{M}(\\theta) - \\mu\\boldsymbol{I}) = 0$. Let $\\tilde{\\mu} = \\mu \\Delta x^2$. The equation becomes $\\tilde{\\mu}^2 + 2(H+L)\\tilde{\\mu} + 4HL\\sin^2(\\theta) = 0$.\nThe solutions are\n$$\n\\tilde{\\mu}_{\\pm}(\\theta) = -(H+L) \\pm \\sqrt{(H+L)^2 - 4HL\\sin^2(\\theta)} = -(H+L) \\pm \\sqrt{(H-L)^2 + 4HL\\cos^2(\\theta)}.\n$$\nSince $H, L  0$, the term under the square root is always non-negative, so the eigenvalues $\\mu(\\theta) = \\tilde{\\mu}(\\theta) / \\Delta x^2$ are always real and non-positive. For a real, negative eigenvalue $\\mu$, the stability limit is $\\Delta t \\le -2/\\mu$. To find the overall time step limit, we must find the minimum of this value over all eigenvalues and all $\\theta \\in [-\\pi, \\pi]$. This is equivalent to finding the eigenvalue $\\mu$ that is most negative (i.e., has the largest magnitude).\nWe seek $\\mu_{\\min} = \\min_{\\theta} \\mu_{-}(\\theta)$, where $\\mu_{-}(\\theta)$ is the branch with the minus sign. This expression is minimized when the square root term is maximized, which occurs at $\\cos^2(\\theta)=1$, i.e., $\\theta = 0$ or $\\theta = \\pi$. At these values:\n$$\n\\tilde{\\mu}_{\\min} = -(H+L) - \\sqrt{(H-L)^2 + 4HL} = -(H+L) - (H+L) = -2(H+L).\n$$\nThe most restrictive eigenvalue from the LFA is $\\mu_{\\min} = -2(H+L)/\\Delta x^2$. The corresponding stability bound is\n$$\n\\Delta t_{\\text{LFA}} = \\frac{-2}{\\mu_{\\min}} = \\frac{-2}{-2(H+L)/\\Delta x^2} = \\frac{\\Delta x^2}{H+L}.\n$$\n\nThe solution proceeds by applying these calculations to the specific test cases.\n\n- **Test $1$ (Constant coefficient):** $a_i \\equiv 1$. Here, the matrix $\\boldsymbol{A}$ is a scalar multiple of $\\boldsymbol{L}_0$ and is normal. Theory predicts $\\Delta t_{\\text{actual}} = \\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2}$. Thus, the relative error $\\delta_1$ should be zero (or numerically very close to it).\n\n- **Test $2$ (Slowly varying coefficient):** $a(x) = 1 + 0.1\\sin(2\\pi x)$. The variation is smooth and on the scale of the domain length $L$, which is much larger than the grid scale $\\Delta x$. In this regime, the naive frozen-coefficient bound is known to be a good and conservative estimate. We expect $\\Delta t_{\\text{naive}} \\le \\Delta t_{\\text{actual}}$, making $v_2$ true.\n\n- **Test $3$ (Rapidly oscillatory coefficient):** A period-$2$ pattern with high contrast ($H=10, L=0.1$). This is a well-known counterexample where the naive bound fails dramatically. The high-frequency oscillations in the coefficient couple with high-wavenumber modes of the solution to produce a much stricter stability limit than predicted by $\\max_i a_i$. We expect $\\Delta t_{\\text{naive}}  \\Delta t_{\\text{actual}}$, making $v_3$ true.\n\n- **Test $4$ (LFA for period-$2$):** For the same parameters as Test $3$, we compare the accuracy of $\\Delta t_{\\text{naive}}$ and $\\Delta t_{\\text{LFA}}$ by computing their relative errors against $\\Delta t_{\\text{actual}}$. The LFA method is designed to capture the multiscale interactions, so we expect $\\Delta t_{\\text{LFA}}$ to be a much better approximation of $\\Delta t_{\\text{actual}}$ than $\\Delta t_{\\text{naive}}$. This implies $\\rho_{\\text{LFA}} \\ll \\rho_{\\text{naive}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem and print the results according to the specification.\n    \"\"\"\n\n    def calculate_dt_actual(N, L, a_coeffs):\n        \"\"\"\n        Calculates the exact maximum stable time step by spectral analysis of the matrix A.\n        \"\"\"\n        dx = L / N\n\n        # Construct the periodic second-difference matrix L0\n        c = np.zeros(N)\n        c[0] = -2\n        c[1] = 1\n        c[N - 1] = 1\n        L0 = linalg.circulant(c)\n\n        # Construct the matrix A\n        D_a = np.diag(a_coeffs)\n        A = (1 / dx**2) * D_a @ L0\n\n        # Calculate eigenvalues of A\n        eigenvalues = np.linalg.eigvals(A)\n\n        # Filter for eigenvalues with negative real part, excluding the zero eigenvalue\n        # A small tolerance is used for floating point comparisons.\n        relevant_eigenvalues = eigenvalues[np.real(eigenvalues)  -1e-9]\n\n        # Calculate the stability bound from each relevant eigenvalue\n        bounds = -2 * np.real(relevant_eigenvalues) / (np.abs(relevant_eigenvalues)**2)\n        \n        # The maximum stable time step is the minimum of these bounds\n        return np.min(bounds)\n\n    results = []\n\n    # --- Test 1: Constant coefficient ---\n    N1, L1 = 128, 1.0\n    a0 = 1.0\n    dx1 = L1 / N1\n    a_coeffs1 = np.full(N1, a0)\n    \n    dt_actual1 = calculate_dt_actual(N1, L1, a_coeffs1)\n    dt_naive1 = (dx1**2) / (2 * np.max(a_coeffs1))\n    \n    delta_1 = np.abs(dt_actual1 - dt_naive1) / dt_actual1 if dt_actual1 != 0 else 0.0\n    results.append(delta_1)\n\n    # --- Test 2: Slowly varying coefficient ---\n    N2, L2 = 128, 1.0\n    dx2 = L2 / N2\n    x_grid2 = np.linspace(0, L2, N2, endpoint=False)\n    a_coeffs2 = 1.0 + 0.1 * np.sin(2 * np.pi * x_grid2)\n\n    dt_actual2 = calculate_dt_actual(N2, L2, a_coeffs2)\n    dt_naive2 = (dx2**2) / (2 * np.max(a_coeffs2))\n\n    v_2 = dt_naive2 = dt_actual2\n    results.append(v_2)\n\n    # --- Test 3  4: Rapidly oscillatory coefficient ---\n    N3, L3 = 128, 1.0\n    H, L_val = 10.0, 0.1\n    dx3 = L3 / N3\n    \n    a_coeffs3 = np.full(N3, L_val)\n    a_coeffs3[::2] = H  # Even indices get H\n\n    dt_actual3 = calculate_dt_actual(N3, L3, a_coeffs3)\n    dt_naive3 = (dx3**2) / (2 * np.max(a_coeffs3))\n\n    # Test 3 result\n    v_3 = dt_naive3  dt_actual3\n    results.append(v_3)\n\n    # Test 4 calculations\n    dt_lfa = (dx3**2) / (H + L_val)\n    \n    rho_naive = np.abs(dt_naive3 - dt_actual3) / dt_actual3\n    rho_lfa = np.abs(dt_lfa - dt_actual3) / dt_actual3\n    results.append([rho_naive, rho_lfa])\n\n    # Format the final output string as specified\n    final_output_string = f\"[{results[0]},{results[1]},{results[2]},[{results[3][0]},{results[3][1]}]]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}