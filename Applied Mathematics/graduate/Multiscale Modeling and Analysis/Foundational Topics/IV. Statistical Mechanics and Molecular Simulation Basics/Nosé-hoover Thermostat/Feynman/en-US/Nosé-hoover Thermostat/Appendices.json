{
    "hands_on_practices": [
        {
            "introduction": "A thermostat's primary job is to maintain a target temperature, but a rigorous thermostat must also generate the correct statistical fluctuations characteristic of the desired ensemble. This exercise delves into the heart of this connection for the Nosé-Hoover thermostat. By deriving both the expected variance of kinetic energy in the canonical ensemble and the thermostat's intrinsic frequency of response, you will build a foundational link between statistical mechanics and the thermostat's equations of motion. ",
            "id": "3788475",
            "problem": "Consider a classical system with $f$ independent quadratic degrees of freedom in contact with a Nosé–Hoover thermostat at temperature $T$. Let $K$ denote the instantaneous kinetic energy. Assume canonical sampling is achieved at equilibrium. Starting from first principles of the canonical ensemble and the Maxwell–Boltzmann distribution, derive a closed-form expression for the variance $\\mathrm{Var}(K)$ in terms of $f$, the Boltzmann constant $k_{B}$, and $T$. Next, consider the standard Nosé–Hoover equations of motion for a system with coordinates $q_{i}$, momenta $p_{i}$, masses $m_{i}$, forces $F_{i}$, and thermostat friction variable $\\xi$ with thermostat mass parameter $Q$:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}},\\qquad\n\\dot{p}_{i}=F_{i}-\\xi\\,p_{i},\\qquad\n\\dot{\\xi}=\\frac{1}{Q}\\left(2K-f\\,k_{B}T\\right).\n$$\nLinearize these equations about thermal equilibrium, where $K=\\langle K\\rangle$ and $\\xi=0$, to obtain the characteristic angular frequency $\\omega_{Q}$ that governs small-amplitude exchanges of kinetic energy between the system and the thermostat. Treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as rapidly fluctuating and averaging to zero on the thermostat timescale so that the leading-order coupling of $K$ to $\\xi$ dominates the slow envelope dynamics. Express $\\omega_{Q}$ in terms of $f$, $k_{B}$, $T$, and $Q$. Briefly interpret how $Q$ filters kinetic energy fluctuations in a multiscale sense by setting the exchange timescale.\n\nExpress your final answer as a two-entry row matrix $\\big[\\mathrm{Var}(K),\\ \\omega_{Q}\\big]$. Report $\\mathrm{Var}(K)$ in squared energy and $\\omega_{Q}$ in radians per unit time. Do not include units in the boxed answer. No numerical substitution is required; provide exact symbolic expressions only.",
            "solution": "The problem consists of two parts. First, we derive the variance of the kinetic energy, $\\mathrm{Var}(K)$, for a system in the canonical ensemble. Second, we linearize the Nosé-Hoover equations of motion to find the characteristic frequency of energy exchange, $\\omega_{Q}$.\n\nPart 1: Derivation of the Variance of Kinetic Energy, $\\mathrm{Var}(K)$\n\nWe begin from the principles of the canonical ensemble. For a classical system with $f$ independent quadratic degrees of freedom, the total kinetic energy is given by $K = \\sum_{j=1}^{f} \\epsilon_j$, where each $\\epsilon_j$ is the kinetic energy associated with one degree of freedom (e.g., $\\frac{p_x^2}{2m}$).\n\nIn the canonical ensemble at temperature $T$, the probability distribution of momentum for a single degree of freedom is given by the Maxwell-Boltzmann distribution, which is a Gaussian distribution. The corresponding kinetic energy $\\epsilon$ for that degree of freedom has a probability distribution that can be derived from it. This distribution is a Gamma distribution, $\\Gamma(k, \\theta)$, with shape parameter $k = 1/2$ and scale parameter $\\theta = k_B T$. The probability density function for $\\epsilon$ is:\n$$\nP(\\epsilon) = \\frac{1}{\\Gamma(1/2)(k_B T)^{1/2}} \\epsilon^{1/2 - 1} \\exp\\left(-\\frac{\\epsilon}{k_B T}\\right)\n$$\nwhere $\\Gamma(1/2) = \\sqrt{\\pi}$.\n\nThe total kinetic energy $K$ is the sum of $f$ such independent and identically distributed random variables. A key property of the Gamma distribution is that the sum of independent Gamma-distributed variables with the same scale parameter $\\theta$ is also a Gamma-distributed variable. The new shape parameter is the sum of the individual shape parameters. Therefore, $K$ follows a Gamma distribution with shape parameter $k_K = \\sum_{j=1}^{f} (1/2) = f/2$ and scale parameter $\\theta_K = k_B T$. The probability density function for $K$ is:\n$$\nP(K) = \\frac{1}{\\Gamma(f/2)(k_B T)^{f/2}} K^{f/2 - 1} \\exp\\left(-\\frac{K}{k_B T}\\right)\n$$\nFor a Gamma distribution $\\Gamma(k, \\theta)$, the mean is $\\langle X \\rangle = k\\theta$ and the variance is $\\mathrm{Var}(X) = k\\theta^2$. Applying this to the distribution of $K$, we find the mean kinetic energy:\n$$\n\\langle K \\rangle = k_K \\theta_K = \\left(\\frac{f}{2}\\right)(k_B T) = \\frac{f}{2}k_B T\n$$\nThis result is the well-known equipartition theorem. The variance of the kinetic energy is:\n$$\n\\mathrm{Var}(K) = k_K \\theta_K^2 = \\left(\\frac{f}{2}\\right)(k_B T)^2 = \\frac{f}{2}k_B^2 T^2\n$$\nThis expression gives the variance of the kinetic energy in terms of the number of degrees of freedom $f$, the Boltzmann constant $k_B$, and the temperature $T$.\n\nPart 2: Derivation of the Characteristic Frequency, $\\omega_{Q}$\n\nWe are given the standard Nosé-Hoover equations of motion:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}}, \\qquad \\dot{p}_{i}=F_{i}-\\xi p_{i}, \\qquad \\dot{\\xi}=\\frac{1}{Q}\\left(2K-f k_{B}T\\right)\n$$\nWe need to find the equation of motion for the kinetic energy $K = \\sum_{i} \\frac{p_{i}^2}{2m_{i}}$. Taking the time derivative of $K$:\n$$\n\\dot{K} = \\sum_{i} \\frac{p_{i}}{m_{i}} \\dot{p}_{i} = \\sum_{i} v_{i} \\dot{p}_{i}\n$$\nSubstituting the expression for $\\dot{p}_{i}$:\n$$\n\\dot{K} = \\sum_{i} v_{i} (F_{i} - \\xi p_{i}) = \\sum_{i} v_{i}F_{i} - \\xi \\sum_{i} v_{i}p_{i}\n$$\nRecognizing that $v_{i} = p_{i}/m_{i}$, the second term becomes $\\xi \\sum_{i} p_{i}^2/m_{i} = 2\\xi \\sum_{i} p_{i}^2/(2m_{i}) = 2\\xi K$. Thus, the dynamics of $K$ and $\\xi$ are described by the coupled system:\n$$\n\\dot{K} = \\sum_{i} v_{i}F_{i} - 2\\xi K\n$$\n$$\n\\dot{\\xi} = \\frac{1}{Q}(2K - f k_B T)\n$$\nWe linearize this system around the thermal equilibrium fixed point, which is characterized by $\\langle \\xi \\rangle = 0$ and $\\langle K \\rangle = \\frac{f}{2}k_B T$. Let the fluctuations around this point be $\\delta\\xi = \\xi - \\langle \\xi \\rangle = \\xi$ and $\\delta K = K - \\langle K \\rangle$.\nThe equations for the fluctuations are:\n$$\n\\dot{(\\delta K)} = \\dot{K} = \\sum_{i} v_{i}F_{i} - 2(\\delta\\xi)(\\delta K + \\langle K \\rangle)\n$$\n$$\n\\dot{(\\delta\\xi)} = \\dot{\\xi} = \\frac{1}{Q}(2(\\delta K + \\langle K \\rangle) - f k_B T) = \\frac{1}{Q}(2\\delta K + 2\\langle K \\rangle - f k_B T)\n$$\nSubstituting $\\langle K \\rangle = \\frac{f}{2}k_B T$ into the second equation simplifies it:\n$$\n\\dot{(\\delta\\xi)} = \\frac{1}{Q}(2\\delta K + f k_B T - f k_B T) = \\frac{2}{Q}\\delta K\n$$\nThis is the first linearized equation. For the $\\dot{(\\delta K)}$ equation, we linearize by neglecting second-order terms in the fluctuations, i.e., the term $-2(\\delta\\xi)(\\delta K)$. The problem also states to treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as a fast fluctuating term that can be neglected when analyzing the slow dynamics of the thermostat. This yields:\n$$\n\\dot{(\\delta K)} \\approx -2\\langle K \\rangle \\delta\\xi\n$$\nSubstituting the value of $\\langle K \\rangle$:\n$$\n\\dot{(\\delta K)} = -2\\left(\\frac{f}{2}k_B T\\right)\\delta\\xi = -f k_B T \\delta\\xi\n$$\nWe now have a system of two coupled linear ordinary differential equations:\n$$\n(1) \\qquad \\dot{(\\delta K)} = -f k_B T \\delta\\xi\n$$\n$$\n(2) \\qquad \\dot{(\\delta \\xi)} = \\frac{2}{Q} \\delta K\n$$\nTo find the characteristic frequency, we combine them into a single second-order equation. Differentiating equation (2) with respect to time gives:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q} \\dot{(\\delta K)}\n$$\nSubstituting equation (1) into this expression:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q}(-f k_B T \\delta\\xi) = -\\left(\\frac{2f k_B T}{Q}\\right)\\delta\\xi\n$$\nThis is the standard form of the simple harmonic oscillator equation, $\\ddot{x} = -\\omega^2 x$. By comparison, the square of the characteristic angular frequency is:\n$$\n\\omega_{Q}^2 = \\frac{2f k_B T}{Q}\n$$\nTherefore, the characteristic angular frequency is:\n$$\n\\omega_{Q} = \\sqrt{\\frac{2f k_B T}{Q}}\n$$\nThe parameter $Q$, often called the thermostat \"mass,\" controls the timescale of energy exchange. A large value of $Q$ results in a small $\\omega_{Q}$ and a long period of oscillation, meaning the energy exchange between the system and the thermostat is slow. The thermostat is \"heavy\" and does not closely follow rapid fluctuations in the system's kinetic energy. Conversely, a small $Q$ leads to a large $\\omega_{Q}$ and a fast response, tightly coupling the system to the thermostat. In a multiscale simulation, $Q$ is chosen to set the thermostat's response timescale $\\tau_Q \\sim 1/\\omega_Q$ to be slower than the fastest physical motions in the system but faster than the timescale of the phenomena under investigation, effectively filtering the kinetic energy fluctuations at a desired frequency.\n\nCombining the two results into the requested matrix form provides the final answer.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f}{2}k_{B}^{2}T^{2} & \\sqrt{\\frac{2f k_{B} T}{Q}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Effective thermostatting requires careful parameter selection to avoid unphysical resonances with the system's intrinsic dynamics. This hands-on coding challenge guides you through a complete workflow for setting the thermostat mass, $Q$, based on spectral analysis of the system's velocity data. You will implement signal processing techniques to find the dominant physical frequency and use it to ensure the thermostat operates on an appropriate, non-interfering timescale, a vital skill for robust multiscale simulation. ",
            "id": "3827445",
            "problem": "Consider a model system in multiscale materials simulation coupled to a Nosé-Hoover thermostat (NHT). The NHT introduces a thermostat variable that exchanges energy with the physical degrees of freedom. From first principles of mechanics and thermodynamics, the NHT can be understood to impose a characteristic energy-exchange timescale and corresponding angular frequency. In order to avoid resonant interference with the system's intrinsic vibrational modes, one commonly designs the NHT so that its natural angular frequency is a fixed fraction of the dominant physical angular frequency extracted from the system's velocity signal through spectral analysis.\n\nYour task is to write a complete, runnable program that, for each test case below, performs the following steps in a scientifically sound and numerically self-consistent manner:\n\n- Generate a synthetic single-degree-of-freedom velocity time series $v(t)$ as a sum of sinusoidal components with specified amplitudes and frequencies, sampled uniformly in time with step size $\\Delta t$ over $N$ samples. Use no noise and zero mean.\n- Compute the dominant physical angular frequency $\\omega_{\\mathrm{dom}}$ by estimating the power spectral density via a discrete Fourier transform, applying a suitable window to mitigate spectral leakage, and extracting the strongest peak frequency in hertz. Convert the peak to angular frequency using $\\omega = 2\\pi f$. Exclude any zero-frequency (direct current) contribution.\n- Choose the NHT parameter $Q$ (the thermostat \"mass\") such that the thermostat's natural angular frequency $\\omega_{\\mathrm{NH}}$ is a specified fraction $\\rho$ of the dominant physical angular frequency, that is $\\omega_{\\mathrm{NH}} = \\rho \\,\\omega_{\\mathrm{dom}}$. Here $Q$ must be derived from first principles; the final value must be expressed in International System of Units (SI) joule-seconds-squared, that is $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n- Use the Boltzmann constant $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}$ in SI units of joules per kelvin and treat the number of thermostat-coupled degrees of freedom $N_{\\mathrm{f}}$ and the absolute temperature $T$ (in kelvin) as given.\n\nAll numerical outputs must be in SI units. Frequencies must be in hertz when computed from the discrete Fourier transform, angles and angular frequencies must be in radians and radians per second respectively. The final $Q$ must be output in $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n\nImplement careful numerical handling:\n- Use a window function to reduce leakage when computing the spectrum.\n- Exclude the zero-frequency bin when searching for the dominant peak.\n- Refine the peak location via a locally quadratic (parabolic) interpolation using the peak bin and its immediate neighbors to improve the frequency estimate.\n- Convert the refined frequency to an angular frequency and compute $Q$ accordingly from first principles.\n\nTest Suite:\nFor each case, synthesize $v(t) = \\sum_i A_i \\sin(2\\pi f_i t)$ with the parameters below. Here $A_i$ are amplitudes in $\\mathrm{m/s}$, $f_i$ are frequencies in $\\mathrm{Hz}$, $\\Delta t$ is the sample spacing in $\\mathrm{s}$, $N$ is the number of samples, $N_{\\mathrm{f}}$ is the number of coupled degrees of freedom (dimensionless), $T$ is the temperature in $\\mathrm{K}$, and $\\rho$ is the dimensionless ratio relating $\\omega_{\\mathrm{NH}}$ to $\\omega_{\\mathrm{dom}}$.\n\n- Case $1$ (happy path):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 1.0\\ \\mathrm{m/s}$ at $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$; $A_2 = 0.5\\ \\mathrm{m/s}$ at $f_2 = 3.0\\times 10^{12}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 12$, $T = 300$, $\\rho = 0.2$.\n- Case $2$ (close peaks coverage):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 0.9\\ \\mathrm{m/s}$ at $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$; $A_2 = 1.0\\ \\mathrm{m/s}$ at $f_2 = 1.2\\times 10^{12}\\ \\mathrm{Hz}$; $A_3 = 0.4\\ \\mathrm{m/s}$ at $f_3 = 4.0\\times 10^{12}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 6$, $T = 100$, $\\rho = 0.5$.\n- Case $3$ (edge case with widely separated scales):\n  - $\\Delta t = 5.0\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 0.8\\ \\mathrm{m/s}$ at $f_1 = 5.0\\times 10^{10}\\ \\mathrm{Hz}$; $A_2 = 0.3\\ \\mathrm{m/s}$ at $f_2 = 1.0\\times 10^{13}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 24$, $T = 1000$, $\\rho = 0.1$.\n\nYour program should produce a single line of output containing the three $Q$ values as a comma-separated list enclosed in square brackets, in the order of the cases above, for example $[q_1,q_2,q_3]$, where each $q_i$ is a floating-point number in $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n\nNo external input is allowed; all parameters must be encoded in the program. The algorithm must be general and not hard-coded to the expected peak bins. The dominant angular frequency must be extracted from the synthetic signals by spectral analysis as described above, and $Q$ must be computed from first principles, not by using any pre-specified shortcut formula in the problem statement.",
            "solution": "The objective is to compute the thermostat mass parameter, $Q$, for a Nosé-Hoover thermostat (NHT) such that its natural frequency is a specified fraction of the dominant vibrational frequency of the physical system. This requires a two-part process: first, the derivation of the formula for $Q$ from the principles of statistical mechanics governing the NHT; and second, the numerical determination of the system's dominant frequency, $\\omega_{\\mathrm{dom}}$, from a synthetic velocity time series.\n\n### Step 1: Theoretical Derivation of the Thermostat Mass $Q$\n\nThe Nosé-Hoover thermostat couples a physical system to a thermal reservoir by introducing an extended phase-space variable, $\\zeta$, which can be interpreted as a friction coefficient. The dynamics of this thermostat variable are governed by the following equation of motion:\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( \\sum_{i=1}^{N_{particles}} \\frac{\\mathbf{p}_i^2}{m_i} - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\nwhere $Q$ is the thermostat mass, $\\mathbf{p}_i$ and $m_i$ are the momenta and masses of the system's particles, $k_{\\mathrm{B}}$ is the Boltzmann constant, $T$ is the target absolute temperature, and $N_{\\mathrm{f}}$ is the number of thermostatted degrees of freedom. The sum represents the instantaneous kinetic energy of the system, which can be written as $K(t)$. The target average kinetic energy is $\\langle K \\rangle = \\frac{1}{2} N_{\\mathrm{f}} k_{\\mathrm{B}} T$. The equation is more commonly written with the factor of $2$ as:\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( 2K(t) - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\nThis equation ensures that if the kinetic energy is higher than its target value, $\\zeta$ increases, applying a stronger drag force on the particles to cool them down, and vice versa. The parameter $Q$ controls the timescale of this response. A large $Q$ corresponds to a slow, weakly coupled thermostat, while a small $Q$ corresponds to a fast, strongly coupled thermostat.\n\nThe \"natural angular frequency\" of the thermostat, $\\omega_{\\mathrm{NH}}$, characterizes the oscillatory response of the thermostat variable around its equilibrium state. This frequency can be derived by performing a linear stability analysis of the coupled system dynamics around thermal equilibrium. This analysis yields the following fundamental relationship between the thermostat's parameters:\n$$ \\omega_{\\mathrm{NH}}^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\nThis equation relates the thermostat's intrinsic frequency to its mass $Q$ and the properties of the system it thermostats ($N_{\\mathrm{f}}$ and $T$).\n\nThe problem requires us to set this natural frequency to a fixed fraction, $\\rho$, of the system's dominant physical frequency, $\\omega_{\\mathrm{dom}}$. This is a standard practice to avoid resonant coupling between the thermostat and the system's own vibrational modes, which could lead to numerical instability or unphysical energy exchange. The constraint is:\n$$ \\omega_{\\mathrm{NH}} = \\rho \\, \\omega_{\\mathrm{dom}} $$\nBy substituting this into the previous equation, we can solve for $Q$:\n$$ (\\rho \\, \\omega_{\\mathrm{dom}})^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\n$$ Q = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{(\\rho \\, \\omega_{\\mathrm{dom}})^2} $$\nThis is the final expression used for the calculation. All quantities on the right-hand side are given, except for $\\omega_{\\mathrm{dom}}$, which must be determined numerically.\n\n### Step 2: Numerical Determination of the Dominant Frequency $\\omega_{\\mathrm{dom}}$\n\nThe dominant physical angular frequency, $\\omega_{\\mathrm{dom}}$, is extracted from the system's velocity time series, $v(t)$, through spectral analysis.\n\n**Signal Generation:**\nA discrete velocity time series, $v_k$, is synthesized at uniformly-spaced time points $t_k = k \\Delta t$ for $k = 0, 1, \\dots, N-1$. The signal is a superposition of sinusoidal modes:\n$$ v(t_k) = \\sum_i A_i \\sin(2\\pi f_i t_k) $$\nwhere $A_i$ and $f_i$ are the given amplitudes and frequencies of the modes, $\\Delta t$ is the time step, and $N$ is the total number of samples.\n\n**Spectral Analysis via DFT:**\nThe power spectrum of the signal is estimated using the Discrete Fourier Transform (DFT), which is implemented efficiently via the Fast Fourier Transform (FFT) algorithm.\n1.  **Windowing:** To mitigate spectral leakage, which arises from the implicit assumption of periodicity in the DFT of a finite-length signal, the time series $v_k$ is first multiplied by a window function, $w_k$. A Hann window is a suitable and common choice:\n    $$ w_k = 0.5 \\left(1 - \\cos\\left(\\frac{2\\pi k}{N-1}\\right)\\right) \\quad \\text{for } k=0, \\dots, N-1 $$\n    The windowed signal is $v'_k = v_k w_k$.\n\n2.  **FFT and Power Spectrum:** The DFT of the real-valued windowed signal, $v'_k$, is computed. The one-sided power spectrum, $P_j$, is then calculated as the squared magnitude of the complex-valued DFT coefficients, $V'_j$:\n    $$ P_j \\propto |V'_j|^2 $$\n    The frequencies corresponding to the DFT coefficients are $f_j = j \\cdot \\frac{1}{N \\Delta t}$ for $j=0, 1, \\dots, N/2$.\n\n3.  **Peak Identification:** The dominant frequency corresponds to the highest peak in the power spectrum. The zero-frequency (DC) component, $P_0$, is excluded from this search. The index $j_{\\text{peak}}$ of the bin with the maximum power is identified.\n\n**Peak Refinement using Parabolic Interpolation:**\nThe DFT provides a spectrum at discrete frequency bins. The true peak of a spectral component generally lies between these bins. To improve accuracy, we refine the peak's location using parabolic interpolation on the peak bin and its two immediate neighbors. Given the power values $y_{m} = P_{j_{\\text{peak}}-1}$, $y_{p} = P_{j_{\\text{peak}}}$, and $y_{p1} = P_{j_{\\text{peak}}+1}$, we fit a parabola to the three points. The vertex of this parabola gives a more precise location for the peak. The offset $\\delta_j$ from the integer index $j_{\\text{peak}}$ is given by:\n$$ \\delta_j = \\frac{1}{2} \\frac{y_{m} - y_{p1}}{y_{m} - 2y_{p} + y_{p1}} $$\nThe refined frequency index is $j_{\\text{refined}} = j_{\\text{peak}} + \\delta_j$. The refined dominant frequency $f_{\\mathrm{dom}}$ is then:\n$$ f_{\\mathrm{dom}} = j_{\\text{refined}} \\cdot \\frac{1}{N \\Delta t} $$\n\n**Final Calculation:**\nThe refined dominant frequency in hertz, $f_{\\mathrm{dom}}$, is converted to an angular frequency:\n$$ \\omega_{\\mathrm{dom}} = 2 \\pi f_{\\mathrm{dom}} $$\nThis value is then substituted into the derived formula for $Q$ to obtain the final result in SI units of $\\mathrm{J}\\cdot\\mathrm{s}^2$. This entire procedure is applied to each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Nosé-Hoover thermostat mass Q for several test cases.\n    \"\"\"\n    # The Boltzmann constant in SI units (J/K).\n    KB = 1.380649e-23\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 1.0, \"f\": 1.0e12}, {\"A\": 0.5, \"f\": 3.0e12}],\n            \"Nf\": 12,\n            \"T\": 300,\n            \"rho\": 0.2,\n        },\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [\n                {\"A\": 0.9, \"f\": 1.0e12},\n                {\"A\": 1.0, \"f\": 1.2e12},\n                {\"A\": 0.4, \"f\": 4.0e12},\n            ],\n            \"Nf\": 6,\n            \"T\": 100,\n            \"rho\": 0.5,\n        },\n        {\n            \"dt\": 5.0e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 0.8, \"f\": 5.0e10}, {\"A\": 0.3, \"f\": 1.0e13}],\n            \"Nf\": 24,\n            \"T\": 1000,\n            \"rho\": 0.1,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        modes = case[\"modes\"]\n        Nf = case[\"Nf\"]\n        T = case[\"T\"]\n        rho = case[\"rho\"]\n\n        # Step 1: Generate the synthetic velocity time series v(t)\n        t = np.arange(N) * dt\n        v = np.zeros(N)\n        for mode in modes:\n            v += mode[\"A\"] * np.sin(2 * np.pi * mode[\"f\"] * t)\n\n        # Step 2: Compute the dominant physical angular frequency omega_dom\n        \n        # Apply a Hann window to mitigate spectral leakage\n        window = np.hanning(N)\n        v_windowed = v * window\n\n        # Compute the one-sided power spectral density (PSD) via real FFT\n        # rfft is used for real-valued input, which is more efficient.\n        y_fft = np.fft.rfft(v_windowed)\n        power_spectrum = np.abs(y_fft) ** 2\n        \n        # Get the frequency bins corresponding to the rfft output\n        # The frequencies are from 0 up to the Nyquist frequency.\n        freqs = np.fft.rfftfreq(N, dt)\n        \n        # Exclude the zero-frequency (DC) component and find the peak\n        # The +1 accounts for slicing from index 1 onwards.\n        peak_idx = np.argmax(power_spectrum[1:]) + 1\n        \n        # Refine the peak location via quadratic (parabolic) interpolation\n        # This uses the peak and its two immediate neighbors.\n        # This is safe as long as the peak is not at the first or last index.\n        # With N=16384, this is highly unlikely for the given signals.\n        p_minus_1 = power_spectrum[peak_idx - 1]\n        p_peak = power_spectrum[peak_idx]\n        p_plus_1 = power_spectrum[peak_idx + 1]\n        \n        # Formula for the offset of a parabolic peak from the center sample\n        delta_j = 0.5 * (p_minus_1 - p_plus_1) / (p_minus_1 - 2 * p_peak + p_plus_1)\n        \n        refined_idx = peak_idx + delta_j\n        \n        # The frequency resolution df = 1 / (N * dt)\n        # So, f_dom = refined_idx * df\n        f_dom = refined_idx / (N * dt)\n        \n        # Convert the dominant frequency to angular frequency\n        omega_dom = 2 * np.pi * f_dom\n        \n        # Step 3: Choose the NHT parameter Q\n        # The formula derived from first principles is:\n        # Q = (2 * Nf * kB * T) / (rho * omega_dom)^2\n        q_value = (2 * Nf * KB * T) / (rho * omega_dom) ** 2\n        results.append(q_value)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{q:.10e}' for q in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The continuous equations of motion for a thermostatted system must be translated into a discrete algorithm for computer simulation. This advanced exercise walks you through the formal derivation of a robust numerical integrator using the Liouville operator formalism and symmetric Trotter splitting. By decomposing the full dynamics into a sequence of exactly solvable steps, you will construct a time-reversible, second-order accurate algorithm, revealing the theoretical foundation of integrators used in state-of-the-art simulation software. ",
            "id": "3788516",
            "problem": "Consider a system of $N$ particles with positions $\\mathbf{r}_i$, momenta $\\mathbf{p}_i$, masses $m_i$, and a smooth, time-independent potential energy $U(\\mathbf{r}_1,\\dots,\\mathbf{r}_N)$. The forces are $\\mathbf{F}_i(\\mathbf{r}) = -\\nabla_{\\mathbf{r}_i} U(\\mathbf{r})$. The system is coupled to a single Nosé-Hoover thermostat with variables $\\eta$ and $\\xi$ and thermostat mass $Q$, targeting temperature $T$. Let $g$ denote the number of kinetic degrees of freedom and $k_B$ the Boltzmann constant. The extended phase space dynamics is given by\n$$\n\\frac{d \\mathbf{r}_i}{dt} = \\frac{\\mathbf{p}_i}{m_i}, \\quad\n\\frac{d \\mathbf{p}_i}{dt} = \\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i, \\quad\n\\frac{d \\eta}{dt} = \\xi, \\quad\n\\frac{d \\xi}{dt} = \\frac{1}{Q}\\left( \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i \\cdot \\mathbf{p}_i}{m_i} - g k_B T \\right).\n$$\nLet $\\mathcal{L}$ be the Liouville operator generating this flow on observables $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$, defined by the chain rule applied to the above equations. In Molecular Dynamics (MD), second-order accurate and reversible integrators are often constructed by symmetric Trotter (Strang) splitting of $\\mathcal{L}$ into sub-operators whose flows can be integrated exactly.\n\nStarting from first principles and the above dynamical system:\n- Define a decomposition $\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$ into physically meaningful sub-operators associated with position drift, conservative force kicks, and thermostat coupling.\n- Further decompose $\\mathcal{L}_C$ into two exactly solvable sub-operators $\\mathcal{L}_{C1}$ and $\\mathcal{L}_{C2}$ that isolate, respectively, the multiplicative momentum scaling due to $\\xi$ and the $(\\eta,\\xi)$ evolution with momenta held fixed.\n- Using the symmetric Trotter (Strang) composition theorem, derive a reversible, second-order accurate propagator over a timestep $\\Delta t$ as an ordered product of exponentials of the sub-operators. Then, explicitly write the corresponding sequence of updates for $(\\mathbf{r}_i,\\mathbf{p}_i,\\eta,\\xi)$ over one timestep $\\Delta t$, ensuring that each sub-flow is integrated exactly.\n\nProvide in your final answer the single closed-form analytical expression for the symmetric Trotter propagator in terms of $\\exp(\\cdot)$ of the sub-operators. No numerical evaluation is required; your final answer must be an analytic expression only.",
            "solution": "The evolution of any observable $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$ is governed by the Liouville equation, $\\frac{dA}{dt} = \\mathcal{L}A$, where $\\mathcal{L}$ is the Liouville operator. Applying the chain rule and substituting the given equations of motion, we have:\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{d\\mathbf{r}_i}{dt} + \\nabla_{\\mathbf{p}_i} A \\cdot \\frac{d\\mathbf{p}_i}{dt} \\right) + \\frac{\\partial A}{\\partial \\eta} \\frac{d\\eta}{dt} + \\frac{\\partial A}{\\partial \\xi} \\frac{d\\xi}{dt}\n$$\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{\\mathbf{p}_i}{m_i} + \\nabla_{\\mathbf{p}_i} A \\cdot (\\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i) \\right) + \\frac{\\partial A}{\\partial \\eta} \\xi + \\frac{\\partial A}{\\partial \\xi} \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)\n$$\nFrom this, we can identify the Liouville operator $\\mathcal{L}$ as:\n$$\n\\mathcal{L} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i} + \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i} - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}\n$$\nThe formal solution to the Liouville equation over a timestep $\\Delta t$ is given by the action of the propagator, $\\exp(\\Delta t \\mathcal{L})$. Since the full operator $\\mathcal{L}$ is complex, we decompose it into simpler sub-operators whose flows can be calculated analytically.\n\nFollowing the problem's directive, we define the decomposition $\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$:\n-   $\\mathcal{L}_A = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i}$, which corresponds to the free drift of particle positions.\n-   $\\mathcal{L}_B = \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i}$, which corresponds to the update of momenta due to the conservative forces (a \"kick\").\n-   $\\mathcal{L}_C = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}$, which encapsulates all terms related to the thermostat coupling.\n\nNext, we decompose the thermostat operator $\\mathcal{L}_C$ into two parts, $\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$:\n-   $\\mathcal{L}_{C1} = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i}$, which corresponds to the multiplicative scaling (damping/heating) of momenta by the thermostat variable $\\xi$.\n-   $\\mathcal{L}_{C2} = \\xi \\frac{\\partial}{\\partial \\eta} + G(\\mathbf{p}) \\frac{\\partial}{\\partial \\xi}$, where $G(\\mathbf{p}) = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right)$, corresponding to the evolution of the thermostat's own variables $(\\eta, \\xi)$.\n\nThe sub-operators $\\mathcal{L}_A$, $\\mathcal{L}_B$, $\\mathcal{L}_{C1}$, and $\\mathcal{L}_{C2}$ do not commute with each other. Therefore, $\\exp(\\Delta t \\mathcal{L}) \\neq \\exp(\\Delta t \\mathcal{L}_A) \\exp(\\Delta t \\mathcal{L}_B) \\exp(\\Delta t \\mathcal{L}_{C1}) \\exp(\\Delta t \\mathcal{L}_{C2})$. To construct a second-order accurate and reversible integrator, we employ the symmetric Trotter (or Strang) splitting theorem, which states that for operators $\\mathcal{X}$ and $\\mathcal{Y}$, $\\exp(\\tau (\\mathcal{X}+\\mathcal{Y})) = \\exp(\\frac{\\tau}{2}\\mathcal{X}) \\exp(\\tau \\mathcal{Y}) \\exp(\\frac{\\tau}{2}\\mathcal{X}) + \\mathcal{O}(\\tau^3)$.\n\nWe apply this theorem recursively. First, we split the full Liouvillian $\\mathcal{L} = (\\mathcal{L}_A + \\mathcal{L}_B) + \\mathcal{L}_C$. A common symmetric arrangement, analogous to the velocity Verlet algorithm, is to place the force/thermostat updates between two position half-steps. This suggests a primary split of the form $\\mathcal{L} = \\mathcal{L}_A + (\\mathcal{L}_B + \\mathcal{L}_C)$. Applying Strang splitting yields:\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\nWe further split the central term $\\exp(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C))$. A symmetric split separates the thermostat part from the conservative force part:\n$$\n\\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp(\\Delta t \\mathcal{L}_C) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right)\n$$\nFinally, we split the thermostat operator $\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$ as requested:\n$$\n\\exp(\\Delta t \\mathcal{L}_C) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right)\n$$\nCombining these results gives the final expression for the second-order accurate, reversible propagator:\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\left[ \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\right] \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\nThe sequence of updates for the phase-space coordinates over one timestep $\\Delta t$ is obtained by applying these operators from right to left. Let the state at time $t$ be $(\\{\\mathbf{r}_i(t)\\}, \\{\\mathbf{p}_i(t)\\}, \\eta(t), \\xi(t))$. Each sub-flow is integrated exactly as follows:\n\n1.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**: This evolves the system under $d\\mathbf{r}_i/dt' = \\mathbf{p}_i/m_i$ for a duration $\\Delta t/2$.\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i(t) + \\frac{\\mathbf{p}_i(t)}{m_i} \\frac{\\Delta t}{2}$.\n\n2.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**: This evolves momenta under $d\\mathbf{p}_i/dt' = \\mathbf{F}_i(\\mathbf{r})$ for $\\Delta t/2$.\n    First, compute forces $\\mathbf{F}_i$ at the new positions.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i(t) + \\mathbf{F}_i \\frac{\\Delta t}{2}$.\n\n3.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**: This evolves momenta under $d\\mathbf{p}_i/dt' = -\\xi \\mathbf{p}_i$ for $\\Delta t/2$. The exact solution is an exponential scaling.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi(t) \\frac{\\Delta t}{2}\\right)$.\n\n4.  **Apply $\\exp(\\Delta t \\mathcal{L}_{C2})$**: This evolves the thermostat variables $(\\eta, \\xi)$ for a full timestep $\\Delta t$, with particle momenta held constant. The equations are $d\\eta/dt' = \\xi$ and $d\\xi/dt' = G(\\mathbf{p})$, where $G(\\mathbf{p})$ is constant during this substep.\n    First, compute the thermostat \"force\": $G = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)$, using the current momenta.\n    Store the current value $\\xi_{old} = \\xi$.\n    Update $\\xi$: $\\xi \\leftarrow \\xi_{old} + G \\Delta t$. Let this be $\\xi_{new}$.\n    Update $\\eta$: $\\eta \\leftarrow \\eta(t) + \\frac{1}{2}(\\xi_{old} + \\xi_{new}) \\Delta t = \\eta(t) + \\xi_{old} \\Delta t + \\frac{1}{2} G (\\Delta t)^2$.\n\n5.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**: This is the second half-step of the momentum scaling, now using the updated value of $\\xi$.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi \\frac{\\Delta t}{2}\\right)$.\n\n6.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**: This is the second half-step of the force kick. The forces $\\mathbf{F}_i$ are the same as in step 2, as positions have not changed since.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i + \\mathbf{F}_i \\frac{\\Delta t}{2}$.\n\n7.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**: This is the final half-step of the position drift, using the fully updated momenta.\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i + \\frac{\\mathbf{p}_i}{m_i} \\frac{\\Delta t}{2}$.\n\nThis sequence completes the update for a single timestep $\\Delta t$. The resulting state $(\\{\\mathbf{r}_i(t+\\Delta t)\\}, \\{\\mathbf{p}_i(t+\\Delta t)\\}, \\eta(t+\\Delta t), \\xi(t+\\Delta t))$ is a second-order accurate approximation of the true dynamics, and the integrator is, by its symmetric construction, time-reversible.\nThe final answer is the symbolic representation of this propagator.",
            "answer": "$$\n\\boxed{\\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)}\n$$"
        }
    ]
}