{
    "hands_on_practices": [
        {
            "introduction": "一个性能优良的恒温器不仅需要维持系统的平均温度，还必须能正确地再现目标系综的统计涨落。本练习旨在巩固这一核心概念，通过从第一性原理出发，推导在正则系综下系统动能的理论方差，并确定Nosé-Hoover恒温器自身的响应频率 。这项实践将统计力学目标（即正确的能量涨落）与恒温器的动力学参数（即响应频率 $ω_Q$）直接联系起来，为理解恒温器的工作原理和参数化选择奠定了坚实的理论基础。",
            "id": "3788475",
            "problem": "考虑一个具有 $f$ 个独立二次自由度的经典系统，该系统与温度为 $T$ 的 Nosé–Hoover 恒温器接触。令 $K$ 表示瞬时动能。假设在平衡状态下实现了正则采样。从正则系综和 Maxwell–Boltzmann 分布的第一性原理出发，推导方差 $\\mathrm{Var}(K)$ 关于 $f$、玻尔兹曼常数 $k_{B}$ 和 $T$ 的闭式表达式。接下来，考虑一个系统的标准 Nosé–Hoover 运动方程，该系统具有坐标 $q_{i}$、动量 $p_{i}$、质量 $m_{i}$、力 $F_{i}$，以及恒温器摩擦变量 $\\xi$ 和恒温器质量参数 $Q$：\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}},\\qquad\n\\dot{p}_{i}=F_{i}-\\xi\\,p_{i},\\qquad\n\\dot{\\xi}=\\frac{1}{Q}\\left(2K-f\\,k_{B}T\\right).\n$$\n将这些方程在热平衡点（$K=\\langle K\\rangle$ 且 $\\xi=0$）附近进行线性化，以获得控制系统与恒温器之间动能小振幅交换的特征角频率 $\\omega_{Q}$。将可逆维里项 $\\sum_{i} v_{i}F_{i}$ 视为在恒温器时间尺度上快速涨落且平均值为零，从而使 $K$ 与 $\\xi$ 的主导阶耦合主导缓慢的包络动力学。用 $f$、$k_{B}$、$T$ 和 $Q$ 表示 $\\omega_{Q}$。简要解释 $Q$ 如何通过设定交换时间尺度，在多尺度意义上过滤动能涨落。\n\n将您的最终答案表示为一个二元行矩阵 $\\big[\\mathrm{Var}(K),\\ \\omega_{Q}\\big]$。以能量的平方为单位报告 $\\mathrm{Var}(K)$，以弧度每单位时间为单位报告 $\\omega_{Q}$。在方框答案中不要包含单位。不需要进行数值代入；仅提供精确的符号表达式。",
            "solution": "问题包括两个部分。首先，我们推导正则系综中系统的动能方差 $\\mathrm{Var}(K)$。其次，我们线性化 Nosé-Hoover 运动方程，以找到能量交换的特征频率 $\\omega_{Q}$。\n\n第 1 部分：动能方差 $\\mathrm{Var}(K)$ 的推导\n\n我们从正则系综的原理开始。对于一个具有 $f$ 个独立二次自由度的经典系统，其总动能由 $K = \\sum_{j=1}^{f} \\epsilon_j$ 给出，其中每个 $\\epsilon_j$ 是与单个自由度相关的动能（例如 $\\frac{p_x^2}{2m}$）。\n\n在温度为 $T$ 的正则系综中，单个自由度的动量概率分布由 Maxwell-Boltzmann 分布给出，这是一种高斯分布。该自由度对应的动能 $\\epsilon$ 的概率分布可以由此推导出来。该分布是伽马分布 $\\Gamma(k, \\theta)$，其形状参数为 $k = 1/2$，尺度参数为 $\\theta = k_B T$。$\\epsilon$ 的概率密度函数为：\n$$\nP(\\epsilon) = \\frac{1}{\\Gamma(1/2)(k_B T)^{1/2}} \\epsilon^{1/2 - 1} \\exp\\left(-\\frac{\\epsilon}{k_B T}\\right)\n$$\n其中 $\\Gamma(1/2) = \\sqrt{\\pi}$。\n\n总动能 $K$ 是 $f$ 个此类独立同分布随机变量之和。伽马分布的一个关键性质是，具有相同尺度参数 $\\theta$ 的独立伽马分布变量之和也是一个伽马分布变量。新的形状参数是各个形状参数之和。因此，$K$ 服从伽马分布，其形状参数为 $k_K = \\sum_{j=1}^{f} (1/2) = f/2$，尺度参数为 $\\theta_K = k_B T$。$K$ 的概率密度函数为：\n$$\nP(K) = \\frac{1}{\\Gamma(f/2)(k_B T)^{f/2}} K^{f/2 - 1} \\exp\\left(-\\frac{K}{k_B T}\\right)\n$$\n对于伽马分布 $\\Gamma(k, \\theta)$，其均值为 $\\langle X \\rangle = k\\theta$，方差为 $\\mathrm{Var}(X) = k\\theta^2$。将此应用于 $K$ 的分布，我们得到平均动能：\n$$\n\\langle K \\rangle = k_K \\theta_K = \\left(\\frac{f}{2}\\right)(k_B T) = \\frac{f}{2}k_B T\n$$\n这个结果就是著名的能量均分定理。动能的方差为：\n$$\n\\mathrm{Var}(K) = k_K \\theta_K^2 = \\left(\\frac{f}{2}\\right)(k_B T)^2 = \\frac{f}{2}k_B^2 T^2\n$$\n该表达式给出了动能方差与自由度数 $f$、玻尔兹曼常数 $k_B$ 和温度 $T$ 的关系。\n\n第 2 部分：特征频率 $\\omega_{Q}$ 的推导\n\n给定标准的 Nosé-Hoover 运动方程：\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}}, \\qquad \\dot{p}_{i}=F_{i}-\\xi p_{i}, \\qquad \\dot{\\xi}=\\frac{1}{Q}\\left(2K-f k_{B}T\\right)\n$$\n我们需要找到动能 $K = \\sum_{i} \\frac{p_{i}^2}{2m_{i}}$ 的运动方程。对 $K$ 求时间导数：\n$$\n\\dot{K} = \\sum_{i} \\frac{p_{i}}{m_{i}} \\dot{p}_{i} = \\sum_{i} v_{i} \\dot{p}_{i}\n$$\n代入 $\\dot{p}_{i}$ 的表达式：\n$$\n\\dot{K} = \\sum_{i} v_{i} (F_{i} - \\xi p_{i}) = \\sum_{i} v_{i}F_{i} - \\xi \\sum_{i} v_{i}p_{i}\n$$\n认识到 $v_{i} = p_{i}/m_{i}$，第二项变为 $\\xi \\sum_{i} p_{i}^2/m_{i} = 2\\xi \\sum_{i} p_{i}^2/(2m_{i}) = 2\\xi K$。因此，$K$ 和 $\\xi$ 的动力学由以下耦合系统描述：\n$$\n\\dot{K} = \\sum_{i} v_{i}F_{i} - 2\\xi K\n$$\n$$\n\\dot{\\xi} = \\frac{1}{Q}(2K - f k_B T)\n$$\n我们围绕热平衡不动点对此系统进行线性化，该不动点的特征是 $\\langle \\xi \\rangle = 0$ 和 $\\langle K \\rangle = \\frac{f}{2}k_B T$。设围绕该点的涨落为 $\\delta\\xi = \\xi - \\langle \\xi \\rangle = \\xi$ 和 $\\delta K = K - \\langle K \\rangle$。\n涨落的方程为：\n$$\n\\dot{(\\delta K)} = \\dot{K} = \\sum_{i} v_{i}F_{i} - 2(\\delta\\xi)(\\delta K + \\langle K \\rangle)\n$$\n$$\n\\dot{(\\delta\\xi)} = \\dot{\\xi} = \\frac{1}{Q}(2(\\delta K + \\langle K \\rangle) - f k_B T) = \\frac{1}{Q}(2\\delta K + 2\\langle K \\rangle - f k_B T)\n$$\n将 $\\langle K \\rangle = \\frac{f}{2}k_B T$ 代入第二个方程，可简化为：\n$$\n\\dot{(\\delta\\xi)} = \\frac{1}{Q}(2\\delta K + f k_B T - f k_B T) = \\frac{2}{Q}\\delta K\n$$\n这是第一个线性化方程。对于 $\\dot{(\\delta K)}$ 方程，我们通过忽略涨落中的二阶项（即 $-2(\\delta\\xi)(\\delta K)$ 项）来进行线性化。题目还指出，在分析恒温器的慢动力学时，可将可逆维里项 $\\sum_{i} v_{i}F_{i}$ 视为一个可以忽略的快速涨落项。由此得到：\n$$\n\\dot{(\\delta K)} \\approx -2\\langle K \\rangle \\delta\\xi\n$$\n代入 $\\langle K \\rangle$ 的值：\n$$\n\\dot{(\\delta K)} = -2\\left(\\frac{f}{2}k_B T\\right)\\delta\\xi = -f k_B T \\delta\\xi\n$$\n现在我们得到了一个由两个耦合的线性常微分方程组成的系统：\n$$\n(1) \\qquad \\dot{(\\delta K)} = -f k_B T \\delta\\xi\n$$\n$$\n(2) \\qquad \\dot{(\\delta \\xi)} = \\frac{2}{Q} \\delta K\n$$\n为了求出特征频率，我们将它们合并成一个二阶方程。对 方程 (2) 对时间求导，得到：\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q} \\dot{(\\delta K)}\n$$\n将方程 (1) 代入此表达式：\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q}(-f k_B T \\delta\\xi) = -\\left(\\frac{2f k_B T}{Q}\\right)\\delta\\xi\n$$\n这是简谐振子方程的标准形式 $\\ddot{x} = -\\omega^2 x$。通过比较，特征角频率的平方为：\n$$\n\\omega_{Q}^2 = \\frac{2f k_B T}{Q}\n$$\n因此，特征角频率为：\n$$\n\\omega_{Q} = \\sqrt{\\frac{2f k_B T}{Q}}\n$$\n参数 $Q$（常被称为恒温器“质量”）控制着能量交换的时间尺度。较大的 $Q$ 值会导致较小的 $\\omega_{Q}$ 和较长的振荡周期，这意味着系统与恒温器之间的能量交换较慢。恒温器“很重”，不会紧密跟随系统动能的快速涨落。相反，较小的 $Q$ 值会导致较大的 $\\omega_{Q}$ 和快速的响应，从而将系统与恒温器紧密耦合。在多尺度模拟中，选择 $Q$ 以设定恒温器的响应时间尺度 $\\tau_Q \\sim 1/\\omega_Q$，使其慢于系统中最快的物理运动，但快于所研究现象的时间尺度，从而有效地在所需频率上过滤动能涨落。\n\n将这两个结果组合成所要求的矩阵形式，即可得到最终答案。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f}{2}k_{B}^{2}T^{2}  \\sqrt{\\frac{2f k_{B} T}{Q}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在分子动力学模拟中，如何选择Nosé-Hoover恒温器的“质量”参数 $Q$ 是一个常见的挑战。不恰当的 $Q$ 值可能导致恒温器的响应频率 $ω_{NH}$ 与系统内在的振动模式发生共振，从而引发非物理的能量交换和模拟失稳。本练习提供了一个结合理论与实践的编码任务 ，指导您完成一个在实际研究中至关重要的工作流程：通过对系统速度自相关函数的谱分析确定其主导振动频率 $ω_{dom}$，并据此选择合适的 $Q$ 值以避免共振伪影。",
            "id": "3827445",
            "problem": "考虑一个多尺度材料模拟中的模型系统，该系统与一个诺斯-胡佛恒温器 (NHT) 耦合。NHT 引入了一个恒温器变量，该变量与物理自由度交换能量。从力学和热力学的第一性原理出发，可以理解为 NHT 施加了一个特征能量交换时间尺度及相应的角频率。为了避免与系统的内在振动模式发生共振干涉，通常将 NHT 设计成其自然角频率是系统主导物理角频率的一个固定分数，该主导物理角频率通过频谱分析从系统的速度信号中提取。\n\n您的任务是编写一个完整的、可运行的程序，该程序对下面的每个测试用例，以科学上合理且数值上自洽的方式执行以下步骤：\n\n- 生成一个合成的单自由度速度时间序列 $v(t)$，它是一系列具有指定振幅和频率的正弦分量之和，在 $N$ 个样本上以步长 $\\Delta t$ 进行均匀时间采样。不使用噪声且均值为零。\n- 通过离散傅里叶变换估计功率谱密度，应用合适的窗函数以减轻频谱泄漏，并提取以赫兹为单位的最强峰值频率，从而计算主导物理角频率 $\\omega_{\\mathrm{dom}}$。使用 $\\omega = 2\\pi f$ 将峰值频率转换为角频率。排除任何零频（直流）分量。\n- 选择 NHT 参数 $Q$（恒温器“质量”），使得恒温器的自然角频率 $\\omega_{\\mathrm{NH}}$ 是主导物理角频率的指定分数 $\\rho$，即 $\\omega_{\\mathrm{NH}} = \\rho \\,\\omega_{\\mathrm{dom}}$。此处的 $Q$ 必须从第一性原理推导得出；最终值必须以国际单位制 (SI) 的焦耳·秒平方（即 $\\mathrm{J}\\cdot\\mathrm{s}^2$）表示。\n- 使用玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}$（SI 单位：焦耳/开尔文），并将与恒温器耦合的自由度数 $N_{\\mathrm{f}}$ 和绝对温度 $T$（单位：开尔文）视为给定值。\n\n所有数值输出必须使用国际单位制 (SI)。通过离散傅里叶变换计算出的频率必须以赫兹为单位，角度和角频率必须分别以弧度和弧度/秒为单位。最终的 $Q$ 值必须以 $\\mathrm{J}\\cdot\\mathrm{s}^2$ 为单位输出。\n\n实施仔细的数值处理：\n- 在计算频谱时使用窗函数以减少泄漏。\n- 在搜索主导峰值时排除零频仓。\n- 通过使用峰值仓及其直接相邻点进行局部二次（抛物线）插值来优化峰值位置，以提高频率估计的准确性。\n- 将优化后的频率转换为角频率，并相应地从第一性原理计算 $Q$。\n\n测试套件：\n对于每种情况，使用以下参数合成 $v(t) = \\sum_i A_i \\sin(2\\pi f_i t)$。其中，$A_i$ 是振幅（单位：$\\mathrm{m/s}$），$f_i$ 是频率（单位：$\\mathrm{Hz}$），$\\Delta t$ 是采样间隔（单位：$\\mathrm{s}$），$N$ 是样本数，$N_{\\mathrm{f}}$ 是耦合的自由度数（无量纲），$T$ 是温度（单位：$\\mathrm{K}$），$\\rho$ 是关联 $\\omega_{\\mathrm{NH}}$ 与 $\\omega_{\\mathrm{dom}}$ 的无量纲比率。\n\n- 情况 1 (理想情况):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$，$N = 16384$，\n  - 模式: $A_1 = 1.0\\ \\mathrm{m/s}$ 在 $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$；$A_2 = 0.5\\ \\mathrm{m/s}$ 在 $f_2 = 3.0\\times 10^{12}\\ \\mathrm{Hz}$，\n  - $N_{\\mathrm{f}} = 12$，$T = 300$，$\\rho = 0.2$。\n- 情况 2 (覆盖近峰):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$，$N = 16384$，\n  - 模式: $A_1 = 0.9\\ \\mathrm{m/s}$ 在 $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$；$A_2 = 1.0\\ \\mathrm{m/s}$ 在 $f_2 = 1.2\\times 10^{12}\\ \\mathrm{Hz}$；$A_3 = 0.4\\ \\mathrm{m/s}$ 在 $f_3 = 4.0\\times 10^{12}\\ \\mathrm{Hz}$，\n  - $N_{\\mathrm{f}} = 6$，$T = 100$，$\\rho = 0.5$。\n- 情况 3 (具有广泛分离尺度的边缘情况):\n  - $\\Delta t = 5.0\\times 10^{-16}\\ \\mathrm{s}$，$N = 16384$，\n  - 模式: $A_1 = 0.8\\ \\mathrm{m/s}$ 在 $f_1 = 5.0\\times 10^{10}\\ \\mathrm{Hz}$；$A_2 = 0.3\\ \\mathrm{m/s}$ 在 $f_2 = 1.0\\times 10^{13}\\ \\mathrm{Hz}$，\n  - $N_{\\mathrm{f}} = 24$，$T = 1000$，$\\rho = 0.1$。\n\n您的程序应生成单行输出，其中包含三个 $Q$ 值，按上述情况的顺序以逗号分隔的列表形式，并用方括号括起来，例如 $[q_1,q_2,q_3]$，其中每个 $q_i$ 是一个以 $\\mathrm{J}\\cdot\\mathrm{s}^2$ 为单位的浮点数。\n\n不允许外部输入；所有参数必须在程序中编码。算法必须是通用的，不能硬编码为预期的峰值仓。主导角频率必须如上所述通过频谱分析从合成信号中提取，并且 $Q$ 必须从第一性原理计算，而不是使用问题陈述中任何预先指定的快捷公式。",
            "solution": "目标是计算诺斯-胡佛恒温器 (NHT) 的恒温器质量参数 $Q$，使得其自然频率是物理系统主导振动频率的指定分数。这需要一个两步过程：首先，从控制 NHT 的统计力学原理推导 $Q$ 的公式；其次，从合成的速度时间序列中数值确定系统的主导频率 $\\omega_{\\mathrm{dom}}$。\n\n### 步骤 1：恒温器质量 $Q$ 的理论推导\n\n诺斯-胡佛恒温器通过引入一个可被解释为摩擦系数的扩展相空间变量 $\\zeta$，将物理系统与热库耦合。该恒温器变量的动力学由以下运动方程控制：\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( \\sum_{i=1}^{N_{particles}} \\frac{\\mathbf{p}_i^2}{m_i} - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\n其中 $Q$ 是恒温器质量，$\\mathbf{p}_i$ 和 $m_i$ 是系统粒子的动量和质量，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是目标绝对温度，$N_{\\mathrm{f}}$ 是被恒温的自由度数。求和项代表系统的瞬时动能，可写为 $K(t)$。目标平均动能是 $\\langle K \\rangle = \\frac{1}{2} N_{\\mathrm{f}} k_{\\mathrm{B}} T$。该方程更常见的写法是包含因子 2：\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( 2K(t) - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\n该方程确保如果动能高于其目标值，$\\zeta$ 会增加，从而对粒子施加更强的拖曳力使其冷却，反之亦然。参数 $Q$ 控制此响应的时间尺度。大的 $Q$ 对应于缓慢、弱耦合的恒温器，而小的 $Q$ 对应于快速、强耦合的恒温器。\n\n恒温器的“自然角频率” $\\omega_{\\mathrm{NH}}$ 表征了恒温器变量围绕其平衡态的振荡响应。此频率可通过对耦合系统动力学在热平衡点附近进行线性稳定性分析来推导。该分析得出以下恒温器参数之间的基本关系：\n$$ \\omega_{\\mathrm{NH}}^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\n此方程将恒温器的内在频率与其质量 $Q$ 以及其所恒温的系统属性（$N_{\\mathrm{f}}$ 和 $T$）联系起来。\n\n问题要求我们将此自然频率设置为系统主导物理频率 $\\omega_{\\mathrm{dom}}$ 的一个固定分数 $\\rho$。这是一种标准做法，用以避免恒温器与系统自身的振动模式之间发生共振耦合，这种耦合可能导致数值不稳定性或非物理的能量交换。约束条件是：\n$$ \\omega_{\\mathrm{NH}} = \\rho \\, \\omega_{\\mathrm{dom}} $$\n将此代入前一个方程，我们可以解出 $Q$：\n$$ (\\rho \\, \\omega_{\\mathrm{dom}})^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\n$$ Q = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{(\\rho \\, \\omega_{\\mathrm{dom}})^2} $$\n这是用于计算的最终表达式。右侧的所有量都是给定的，除了必须通过数值方法确定的 $\\omega_{\\mathrm{dom}}$。\n\n### 步骤 2：主导频率 $\\omega_{\\mathrm{dom}}$ 的数值确定\n\n主导物理角频率 $\\omega_{\\mathrm{dom}}$ 是通过频谱分析从系统的速度时间序列 $v(t)$ 中提取的。\n\n**信号生成：**\n在均匀间隔的时间点 $t_k = k \\Delta t$（对于 $k = 0, 1, \\dots, N-1$）上合成一个离散的速度时间序列 $v_k$。该信号是正弦模式的叠加：\n$$ v(t_k) = \\sum_i A_i \\sin(2\\pi f_i t_k) $$\n其中 $A_i$ 和 $f_i$ 是模式的给定振幅和频率，$\\Delta t$ 是时间步长，$N$ 是总样本数。\n\n**通过 DFT 进行频谱分析：**\n信号的功率谱是使用离散傅里叶变换 (DFT) 估算的，DFT 通过快速傅里叶变换 (FFT) 算法高效实现。\n1.  **加窗：** 为了减轻频谱泄漏（其产生于有限长度信号的 DFT 中隐含的周期性假设），首先将时间序列 $v_k$ 乘以一个窗函数 $w_k$。汉宁窗是一个合适且常见的选择：\n    $$ w_k = 0.5 \\left(1 - \\cos\\left(\\frac{2\\pi k}{N-1}\\right)\\right) \\quad \\text{for } k=0, \\dots, N-1 $$\n    加窗后的信号是 $v'_k = v_k w_k$。\n\n2.  **FFT 和功率谱：** 计算实值加窗信号 $v'_k$ 的 DFT。然后，单边功率谱 $P_j$ 被计算为复数值 DFT 系数 $V'_j$ 的幅值平方：\n    $$ P_j \\propto |V'_j|^2 $$\n    与 DFT 系数对应的频率为 $f_j = j \\cdot \\frac{1}{N \\Delta t}$，其中 $j=0, 1, \\dots, N/2$。\n\n3.  **峰值识别：** 主导频率对应于功率谱中的最高峰。零频（直流）分量 $P_0$ 在此搜索中被排除。识别出具有最大功率的仓的索引 $j_{\\text{peak}}$。\n\n**使用抛物线插值进行峰值优化：**\nDFT 在离散的频率仓上提供频谱。频谱分量的真实峰值通常位于这些仓之间。为提高准确性，我们使用对峰值仓及其两个直接相邻点进行的抛物线插值来优化峰值的位置。给定功率值 $y_{m} = P_{j_{\\text{peak}}-1}$、$y_{p} = P_{j_{\\text{peak}}}$ 和 $y_{p1} = P_{j_{\\text{peak}}+1}$，我们对这三个点拟合一个抛物线。该抛物线的顶点给出了更精确的峰值位置。与整数索引 $j_{\\text{peak}}$ 的偏移量 $\\delta_j$ 由下式给出：\n$$ \\delta_j = \\frac{1}{2} \\frac{y_{m} - y_{p1}}{y_{m} - 2y_{p} + y_{p1}} $$\n优化后的频率索引是 $j_{\\text{refined}} = j_{\\text{peak}} + \\delta_j$。那么，优化后的主导频率 $f_{\\mathrm{dom}}$ 是：\n$$ f_{\\mathrm{dom}} = j_{\\text{refined}} \\cdot \\frac{1}{N \\Delta t} $$\n\n**最终计算：**\n以赫兹为单位的优化后主导频率 $f_{\\mathrm{dom}}$ 被转换为角频率：\n$$ \\omega_{\\mathrm{dom}} = 2 \\pi f_{\\mathrm{dom}} $$\n然后将此值代入推导出的 $Q$ 公式中，以获得以 SI 单位 $\\mathrm{J}\\cdot\\mathrm{s}^2$ 表示的最终结果。此完整过程将应用于每个测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Nosé-Hoover thermostat mass Q for several test cases.\n    \"\"\"\n    # The Boltzmann constant in SI units (J/K).\n    KB = 1.380649e-23\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 1.0, \"f\": 1.0e12}, {\"A\": 0.5, \"f\": 3.0e12}],\n            \"Nf\": 12,\n            \"T\": 300,\n            \"rho\": 0.2,\n        },\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [\n                {\"A\": 0.9, \"f\": 1.0e12},\n                {\"A\": 1.0, \"f\": 1.2e12},\n                {\"A\": 0.4, \"f\": 4.0e12},\n            ],\n            \"Nf\": 6,\n            \"T\": 100,\n            \"rho\": 0.5,\n        },\n        {\n            \"dt\": 5.0e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 0.8, \"f\": 5.0e10}, {\"A\": 0.3, \"f\": 1.0e13}],\n            \"Nf\": 24,\n            \"T\": 1000,\n            \"rho\": 0.1,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        modes = case[\"modes\"]\n        Nf = case[\"Nf\"]\n        T = case[\"T\"]\n        rho = case[\"rho\"]\n\n        # Step 1: Generate the synthetic velocity time series v(t)\n        t = np.arange(N) * dt\n        v = np.zeros(N)\n        for mode in modes:\n            v += mode[\"A\"] * np.sin(2 * np.pi * mode[\"f\"] * t)\n\n        # Step 2: Compute the dominant physical angular frequency omega_dom\n        \n        # Apply a Hann window to mitigate spectral leakage\n        window = np.hanning(N)\n        v_windowed = v * window\n\n        # Compute the one-sided power spectral density (PSD) via real FFT\n        # rfft is used for real-valued input, which is more efficient.\n        y_fft = np.fft.rfft(v_windowed)\n        power_spectrum = np.abs(y_fft) ** 2\n        \n        # Get the frequency bins corresponding to the rfft output\n        # The frequencies are from 0 up to the Nyquist frequency.\n        freqs = np.fft.rfftfreq(N, dt)\n        \n        # Exclude the zero-frequency (DC) component and find the peak\n        # The +1 accounts for slicing from index 1 onwards.\n        peak_idx = np.argmax(power_spectrum[1:]) + 1\n        \n        # Refine the peak location via quadratic (parabolic) interpolation\n        # This uses the peak and its two immediate neighbors.\n        # This is safe as long as the peak is not at the first or last index.\n        # With N=16384, this is highly unlikely for the given signals.\n        p_minus_1 = power_spectrum[peak_idx - 1]\n        p_peak = power_spectrum[peak_idx]\n        p_plus_1 = power_spectrum[peak_idx + 1]\n        \n        # Formula for the offset of a parabolic peak from the center sample\n        delta_j = 0.5 * (p_minus_1 - p_plus_1) / (p_minus_1 - 2 * p_peak + p_plus_1)\n        \n        refined_idx = peak_idx + delta_j\n        \n        # The frequency resolution df = 1 / (N * dt)\n        # So, f_dom = refined_idx * df\n        f_dom = refined_idx / (N * dt)\n        \n        # Convert the dominant frequency to angular frequency\n        omega_dom = 2 * np.pi * f_dom\n        \n        # Step 3: Choose the NHT parameter Q\n        # The formula derived from first principles is:\n        # Q = (2 * Nf * kB * T) / (rho * omega_dom)^2\n        q_value = (2 * Nf * KB * T) / (rho * omega_dom) ** 2\n        results.append(q_value)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{q:.10e}' for q in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "要将Nosé-Hoover动力学方程应用于实际模拟，仅写出其运动方程是远远不够的；我们还需要一个稳定且精确的数值积分算法，以确保在长时间模拟中能够保持系统的关键物理特性。本练习将带您深入分子动力学模拟的“引擎盖下”，探索如何通过对称的Trotter分解方法来构建这样一个算法 。通过将复杂的Liouville算符 $\\mathcal{L}$ 分解为多个可精确求解的子部分，您将推导出一个时间可逆且二阶精确的积分器，这是计算物理学中一项基石性的技术。",
            "id": "3788516",
            "problem": "考虑一个包含 $N$ 个粒子的体系，其位置为 $\\mathbf{r}_i$，动量为 $\\mathbf{p}_i$，质量为 $m_i$，具有光滑且不随时变的势能 $U(\\mathbf{r}_1,\\dots,\\mathbf{r}_N)$。力为 $\\mathbf{F}_i(\\mathbf{r}) = -\\nabla_{\\mathbf{r}_i} U(\\mathbf{r})$。该体系与一个 Nosé-Hoover 恒温器耦合，恒温器变量为 $\\eta$ 和 $\\xi$，恒温器质量为 $Q$，目标温度为 $T$。令 $g$ 表示动能自由度数，$k_B$ 表示玻尔兹曼常数。扩展相空间的动力学由以下方程组给出：\n$$\n\\frac{d \\mathbf{r}_i}{dt} = \\frac{\\mathbf{p}_i}{m_i}, \\quad\n\\frac{d \\mathbf{p}_i}{dt} = \\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i, \\quad\n\\frac{d \\eta}{dt} = \\xi, \\quad\n\\frac{d \\xi}{dt} = \\frac{1}{Q}\\left( \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i \\cdot \\mathbf{p}_i}{m_i} - g k_B T \\right).\n$$\n令 $\\mathcal{L}$ 为刘维尔算符，它通过对上述方程应用链式法则作用于可观测量 $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$ 来生成此流动。在分子动力学 (MD) 中，通常通过将 $\\mathcal{L}$ 对称 Trotter (Strang) 分裂为若干子算符来构建二阶精度且可逆的积分器，这些子算符的流可以被精确积分。\n\n从第一性原理和上述动力学系统出发：\n- 将 $\\mathcal{L}$ 分解为 $\\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$，使其成为与位置漂移、保守力“踢”以及恒温器耦合相关的具有物理意义的子算符。\n- 将 $\\mathcal{L}_C$ 进一步分解为两个可精确求解的子算符 $\\mathcal{L}_{C1}$ 和 $\\mathcal{L}_{C2}$，它们分别独立地处理由 $\\xi$ 引起的动量乘性标度变换以及在动量保持不变时 $(\\eta,\\xi)$ 的演化。\n- 使用对称 Trotter (Strang) 组合定理，推导出一个在一个时间步长 $\\Delta t$ 内的可逆、二阶精度的传播子，形式为子算符指数的有序乘积。然后，明确写出在一个时间步长 $\\Delta t$ 内对 $(\\mathbf{r}_i,\\mathbf{p}_i,\\eta,\\xi)$ 进行更新的相应序列，确保每个子流都得到精确积分。\n\n在最终答案中，请提供对称 Trotter 传播子的单一闭合形式解析表达式，用子算符的 $\\exp(\\cdot)$ 表示。不需要进行数值计算；你的最终答案必须仅为一个解析表达式。",
            "solution": "此问题被验证为科学上成立、适定且客观。它描述了计算统计物理学中的一个标准且重要的任务：推导 Nosé-Hoover 恒温器动力学的可逆数值积分器。所提供的运动方程是正确的，所要求的分解以及 Trotter-Strang 分裂的应用是实现此目的的标准方法。\n\n任何可观测量 $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$ 的演化都由刘维尔方程 $\\frac{dA}{dt} = \\mathcal{L}A$ 控制，其中 $\\mathcal{L}$ 是刘维尔算符。应用链式法则并代入给定的运动方程，我们得到：\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{d\\mathbf{r}_i}{dt} + \\nabla_{\\mathbf{p}_i} A \\cdot \\frac{d\\mathbf{p}_i}{dt} \\right) + \\frac{\\partial A}{\\partial \\eta} \\frac{d\\eta}{dt} + \\frac{\\partial A}{\\partial \\xi} \\frac{d\\xi}{dt}\n$$\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{\\mathbf{p}_i}{m_i} + \\nabla_{\\mathbf{p}_i} A \\cdot (\\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i) \\right) + \\frac{\\partial A}{\\partial \\eta} \\xi + \\frac{\\partial A}{\\partial \\xi} \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)\n$$\n由此，我们可以确定刘维尔算符 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i} + \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i} - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}\n$$\n在一个时间步长 $\\Delta t$ 内，刘维尔方程的形式解由传播子 $\\exp(\\Delta t \\mathcal{L})$ 的作用给出。由于完整的算符 $\\mathcal{L}$ 很复杂，我们将其分解为更简单的子算符，这些子算符的流可以解析计算。\n\n遵循问题的指示，我们定义分解 $\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$：\n-   $\\mathcal{L}_A = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i}$，对应于粒子位置的自由漂移。\n-   $\\mathcal{L}_B = \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i}$，对应于由保守力引起的动量更新（一个“踢”）。\n-   $\\mathcal{L}_C = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}$，它包含了与恒温器耦合相关的所有项。\n\n接下来，我们将恒温器算符 $\\mathcal{L}_C$ 分解为两部分，$\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$：\n-   $\\mathcal{L}_{C1} = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i}$，对应于恒温器变量 $\\xi$ 对动量的乘性标度变换（阻尼/加热）。\n-   $\\mathcal{L}_{C2} = \\xi \\frac{\\partial}{\\partial \\eta} + G(\\mathbf{p}) \\frac{\\partial}{\\partial \\xi}$，其中 $G(\\mathbf{p}) = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right)$，对应于恒温器自身变量 $(\\eta, \\xi)$ 的演化。\n\n子算符 $\\mathcal{L}_A$、$\\mathcal{L}_B$、$\\mathcal{L}_{C1}$ 和 $\\mathcal{L}_{C2}$ 彼此不对易。因此，$\\exp(\\Delta t \\mathcal{L}) \\neq \\exp(\\Delta t \\mathcal{L}_A) \\exp(\\Delta t \\mathcal{L}_B) \\exp(\\Delta t \\mathcal{L}_{C1}) \\exp(\\Delta t \\mathcal{L}_{C2})$。为了构建一个二阶精度且可逆的积分器，我们采用对称 Trotter（或 Strang）分裂定理，该定理指出，对于算符 $\\mathcal{X}$ 和 $\\mathcal{Y}$，有 $\\exp(\\tau (\\mathcal{X}+\\mathcal{Y})) = \\exp(\\frac{\\tau}{2}\\mathcal{X}) \\exp(\\tau \\mathcal{Y}) \\exp(\\frac{\\tau}{2}\\mathcal{X}) + \\mathcal{O}(\\tau^3)$。\n\n我们递归地应用这个定理。首先，我们分裂完整的刘维尔算符 $\\mathcal{L} = (\\mathcal{L}_A + \\mathcal{L}_B) + \\mathcal{L}_C$。一种常见的对称排列，类似于速度 Verlet 算法，是将力/恒温器的更新置于两个位置半步之间。这表明一个主要的分裂形式为 $\\mathcal{L} = \\mathcal{L}_A + (\\mathcal{L}_B + \\mathcal{L}_C)$。应用 Strang 分裂得到：\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\n我们进一步分裂中心项 $\\exp(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C))$。一个对称的分裂将恒温器部分与保守力部分分开：\n$$\n\\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp(\\Delta t \\mathcal{L}_C) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right)\n$$\n最后，我们按照要求分裂恒温器算符 $\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$：\n$$\n\\exp(\\Delta t \\mathcal{L}_C) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right)\n$$\n结合这些结果，我们得到二阶精度、可逆传播子的最终表达式：\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\left[ \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\right] \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\n通过从右到左应用这些算符，可以获得在一个时间步长 $\\Delta t$ 内对相空间坐标的更新序列。设时间 $t$ 的状态为 $(\\{\\mathbf{r}_i(t)\\}, \\{\\mathbf{p}_i(t)\\}, \\eta(t), \\xi(t))$。每个子流按如下方式精确积分：\n\n1.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**：这会在 $d\\mathbf{r}_i/dt' = \\mathbf{p}_i/m_i$ 的作用下演化系统，持续时间为 $\\Delta t/2$。\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i(t) + \\frac{\\mathbf{p}_i(t)}{m_i} \\frac{\\Delta t}{2}$。\n\n2.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**：这会在 $d\\mathbf{p}_i/dt' = \\mathbf{F}_i(\\mathbf{r})$ 的作用下演化动量，持续时间为 $\\Delta t/2$。首先，计算在新位置上的力 $\\mathbf{F}_i$。\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i(t) + \\mathbf{F}_i \\frac{\\Delta t}{2}$。\n\n3.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**：这会在 $d\\mathbf{p}_i/dt' = -\\xi \\mathbf{p}_i$ 的作用下演化动量，持续时间为 $\\Delta t/2$。精确解是一个指数标度变换。\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi(t) \\frac{\\Delta t}{2}\\right)$。\n\n4.  **应用 $\\exp(\\Delta t \\mathcal{L}_{C2})$**：这会演化恒温器变量 $(\\eta, \\xi)$，持续一个完整的时间步长 $\\Delta t$，期间粒子动量保持不变。方程为 $d\\eta/dt' = \\xi$ 和 $d\\xi/dt' = G(\\mathbf{p})$，其中 $G(\\mathbf{p})$ 在此子步骤中为常数。\n    首先，使用当前动量计算恒温器“力”：$G = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)$。\n    存储当前值 $\\xi_{old} = \\xi$。\n    更新 $\\xi$：$\\xi \\leftarrow \\xi_{old} + G \\Delta t$。令此值为 $\\xi_{new}$。\n    更新 $\\eta$：$\\eta \\leftarrow \\eta(t) + \\frac{1}{2}(\\xi_{old} + \\xi_{new}) \\Delta t = \\eta(t) + \\xi_{old} \\Delta t + \\frac{1}{2} G (\\Delta t)^2$。\n\n5.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**：这是动量标度变换的第二个半步，现在使用更新后的 $\\xi$ 值。\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi \\frac{\\Delta t}{2}\\right)$。\n\n6.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**：这是力“踢”的第二个半步。由于位置此后没有改变，力 $\\mathbf{F}_i$ 与步骤2中相同。\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i + \\mathbf{F}_i \\frac{\\Delta t}{2}$。\n\n7.  **应用 $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**：这是位置漂移的最后半步，使用完全更新后的动量。\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i + \\frac{\\mathbf{p}_i}{m_i} \\frac{\\Delta t}{2}$。\n\n此序列完成了一个时间步长 $\\Delta t$ 的更新。最终状态 $(\\{\\mathbf{r}_i(t+\\Delta t)\\}, \\{\\mathbf{p}_i(t+\\Delta t)\\}, \\eta(t+\\Delta t), \\xi(t+\\Delta t))$ 是真实动力学的二阶精度近似，并且由于其对称构造，该积分器是时间可逆的。\n最终答案是此传播子的符号表示。",
            "answer": "$$\n\\boxed{\\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)}\n$$"
        }
    ]
}