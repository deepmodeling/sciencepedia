{
    "hands_on_practices": [
        {
            "introduction": "The absolute upper bound on the time step $\\Delta t$ in a molecular dynamics simulation is dictated by the need to numerically resolve the fastest motion within the system. This exercise provides a direct, quantitative link between the highest vibrational frequency, $\\omega$, and the maximum permissible time step. By performing this fundamental calculation, you will solidify your understanding of the primary numerical stability constraint that governs the choice of $\\Delta t$ .",
            "id": "3742725",
            "problem": "A multiscale molecular dynamics simulation couples a coarse-grained region with an ab initio reactive region. In the reactive region, the stiffest bond near equilibrium can be modeled as a one-dimensional harmonic oscillator governed by Newton’s second law, $m\\,\\ddot{q}(t) + k\\,q(t) = 0$, where $m$ is the atomic reduced mass, $k$ is the effective curvature of the potential near equilibrium, and $q(t)$ is the bond coordinate. The oscillator’s angular frequency is $\\omega = \\sqrt{k/m}$. You integrate the equations of motion using an explicit symplectic scheme (the Störmer–Verlet, also known as velocity Verlet), and you wish to select a micro time step $\\Delta t$ that is conservative with respect to stability and long-time energy behavior for the highest vibrational mode present.\n\nStarting from the harmonic oscillator model and the discrete-time update structure of explicit second-order schemes, reason about the necessity to resolve the fastest oscillation with a small dimensionless integration parameter $\\eta \\equiv \\Delta t\\,\\omega$. Adopting a conservative upper bound on $\\eta$ to mitigate phase error and energy drift, take $\\eta \\le 0.2$ for the stiffest mode. The reactive bond’s estimated near-equilibrium angular frequency is $\\omega = 5 \\times 10^{14}\\ \\text{rad/s}$.\n\nDerive the maximum allowable micro time step $\\Delta t_{\\max}$ consistent with the bound on $\\eta$ and compute its value. Express your final answer in femtoseconds (fs) and round your answer to three significant figures.",
            "solution": "The core task is to determine the maximum allowable time step, $\\Delta t_{\\max}$, for numerically integrating the equations of motion of the stiffest vibrational mode in a system, modeled as a one-dimensional harmonic oscillator. The integration must satisfy a given constraint on accuracy and stability.\n\nThe equation of motion for the harmonic oscillator is given as:\n$$m\\,\\ddot{q}(t) + k\\,q(t) = 0$$\nwhere $m$ is the reduced mass and $k$ is the force constant. The natural angular frequency of this oscillator is $\\omega = \\sqrt{k/m}$.\n\nNumerical integration of this second-order ordinary differential equation is performed using a time step $\\Delta t$. The stability and accuracy of explicit integration schemes, such as the Störmer-Verlet algorithm, depend critically on the product of the time step and the highest frequency present in the system. This relationship is captured by the dimensionless parameter $\\eta$, defined as:\n$$\\eta \\equiv \\Delta t\\,\\omega$$\n\nThe problem states that for long-time energy conservation and mitigation of phase errors, this parameter must be bounded. A conservative upper bound is specified:\n$$\\eta \\le 0.2$$\n\nThis condition ensures that the time step is small enough to resolve the fastest oscillation period, $T = 2\\pi/\\omega$, with sufficient resolution. The condition $\\Delta t\\,\\omega \\le 0.2$ is equivalent to $\\Delta t \\le 0.2/\\omega$. Since the period is $T = 2\\pi/\\omega$, this can be rewritten as $\\Delta t \\le 0.2 \\frac{T}{2\\pi} \\approx 0.032\\,T$. This means the time step must be roughly $1/30$th of the oscillation period, which is a common rule of thumb in molecular dynamics for ensuring accuracy.\n\nThe problem asks for the maximum allowable time step, $\\Delta t_{\\max}$. This maximum value corresponds to the equality case in the given constraint:\n$$\\eta_{\\max} = \\Delta t_{\\max}\\,\\omega = 0.2$$\n\nWe can solve this equation for $\\Delta t_{\\max}$:\n$$\\Delta t_{\\max} = \\frac{0.2}{\\omega}$$\n\nThe problem provides the value for the highest angular frequency in the system:\n$$\\omega = 5 \\times 10^{14}\\ \\text{rad/s}$$\n\nSubstituting this value into the expression for $\\Delta t_{\\max}$:\n$$\\Delta t_{\\max} = \\frac{0.2}{5 \\times 10^{14}\\ \\text{s}^{-1}}$$\n\nPerforming the calculation:\n$$\\Delta t_{\\max} = \\frac{2 \\times 10^{-1}}{5 \\times 10^{14}}\\ \\text{s} = 0.4 \\times 10^{-15}\\ \\text{s}$$\n\nThe final answer must be expressed in femtoseconds (fs). The conversion is $1\\ \\text{fs} = 10^{-15}\\ \\text{s}$. Therefore:\n$$\\Delta t_{\\max} = 0.4\\ \\text{fs}$$\n\nFinally, the problem requires the answer to be rounded to three significant figures. To express $0.4$ with three significant figures, we write it as $0.400$.\n\nThus, the maximum allowable micro time step is $0.400\\ \\text{fs}$.",
            "answer": "$$\\boxed{0.400}$$"
        },
        {
            "introduction": "While the stability limit provides a hard ceiling, the practical choice of $\\Delta t$ is also deeply intertwined with the thermostat used to control temperature. This practice explores the crucial concepts of numerical resonance and stochastic damping, comparing how different thermostats interact with the integrator for stiff modes. This conceptual exercise will help you understand why a Langevin thermostat can often permit a larger stable time step than a Nosé-Hoover thermostat, a vital piece of practical knowledge for accurate simulations .",
            "id": "3742726",
            "problem": "A single stiff vibrational mode in a molecular system can be modeled as a one-dimensional harmonic oscillator with mass $m$, stiffness $k$, and angular frequency $\\omega_s = \\sqrt{k/m}$. The canonical (constant number of particles, volume, and temperature) distribution at temperature $T$ assigns probability density $p(q,v) \\propto \\exp\\!\\left(-\\frac{m v^2/2 + k q^2/2}{k_B T}\\right)$ to configuration $q$ and velocity $v$, where $k_B$ is the Boltzmann constant. Two commonly used thermostats in molecular dynamics are the deterministic Nosé–Hoover thermostat and the stochastic Langevin thermostat. The Nosé–Hoover thermostat augments the system with a thermostat variable $\\zeta$ and inertia $Q$ via the extended dynamics $m \\ddot{q} = -k q - \\zeta m \\dot{q}$ and $\\dot{\\zeta} = \\frac{1}{Q}\\left(m \\dot{q}^2 - k_B T\\right)$, while the Langevin thermostat modifies the physical dynamics to $m \\ddot{q} = -k q - \\gamma m \\dot{q} + \\sqrt{2 \\gamma m k_B T}\\,\\xi(t)$, where $\\gamma$ is a friction coefficient and $\\xi(t)$ is Gaussian white noise with zero mean and unit covariance. In practice, both thermostats are integrated by splitting methods that use a second-order update for the Hamiltonian part (e.g., a velocity Verlet step) combined with appropriate thermostat substeps.\n\nAssume both thermostated dynamics are integrated with a fixed time step $\\Delta t$. Consider the discrete-time map for the Hamiltonian part (i.e., the update under $m \\ddot{q} = -k q$), which under a velocity Verlet update yields the linear recurrence\n$$\nq_{n+1} - 2\\left(1 - \\tfrac{1}{2}\\omega_s^2 \\Delta t^2\\right) q_n + q_{n-1} = 0,\n$$\nwith complementary update for $v_n$. The homogeneous solution can be written as $q_n = A \\cos(n \\theta) + B \\sin(n \\theta)$, where $\\theta$ satisfies $\\cos \\theta = 1 - \\tfrac{1}{2} \\omega_s^2 \\Delta t^2$, implying linear stability of the Hamiltonian map if and only if $\\omega_s \\Delta t \\leq 2$. For the full thermostated integrators, assume that the thermostat substeps are second-order accurate and consistent with the above Hamiltonian update, and that the Langevin substep rescales the velocity by a factor $\\alpha = e^{-\\gamma \\Delta t}$ in the deterministic part (ignoring stochastic kicks for momentary linear stability analysis).\n\nUsing these bases:\n- Newton’s second law for the harmonic oscillator $m \\ddot{q} = -k q$ and its velocity Verlet discretization,\n- the canonical distribution $p(q,v) \\propto \\exp\\!\\left(-\\frac{m v^2/2 + k q^2/2}{k_B T}\\right)$,\n- the Nosé–Hoover and Langevin continuous-time equations given above,\n- and the fact that the Langevin process is ergodic for any $\\gamma > 0$ while the Nosé–Hoover dynamics is deterministic and can exhibit non-ergodicity for stiff modes,\n\nanswer the following question:\n\nAs $\\Delta t$ is increased for a fixed stiff mode with large $\\omega_s$, which thermostat is less sensitive to the increase in $\\Delta t$ in terms of maintaining accurate sampling of the canonical distribution for $q$ (e.g., keeping $\\langle q^2 \\rangle$ close to $k_B T/k$) and avoiding numerical resonance or instability, and which therefore allows a larger practically stable $\\Delta t$ for that stiff mode under standard second-order splitting schemes?\n\nChoose the best statement:\n\nA. The Langevin thermostat is less sensitive to increasing $\\Delta t$ for stiff modes and allows a larger practically stable $\\Delta t$ because dissipative damping (factor $e^{-\\gamma \\Delta t}$) and stochastic mixing suppress parametric resonances and maintain near-canonical configurational sampling up to the base stability limit $\\omega_s \\Delta t \\lesssim 2$.\n\nB. The Nosé–Hoover thermostat is less sensitive to increasing $\\Delta t$ and allows a larger practically stable $\\Delta t$ because its deterministic extended dynamics preserves a modified Hamiltonian, ensuring unbiased canonical sampling even when $\\Delta t$ approaches or exceeds the linear stability bound.\n\nC. Both thermostats have identical sensitivity to increasing $\\Delta t$ because the only relevant constraint is the Hamiltonian stability condition $\\omega_s \\Delta t \\leq 2$, independent of thermostat type or parameters.\n\nD. The Langevin thermostat allows a larger $\\Delta t$ only when $\\gamma \\to 0$, since any finite friction $\\gamma > 0$ makes the discrete map more restrictive than Nosé–Hoover for stiff modes and degrades configurational sampling more severely as $\\Delta t$ increases.",
            "solution": "The problem statement is scientifically sound, well-posed, and provides sufficient information to compare the performance of Nosé-Hoover and Langevin thermostats when integrated with a large time step for a stiff harmonic mode. The core of the problem lies in the interaction between the numerical integration scheme and the continuous dynamics of the thermostat.\n\nThe goal is to maintain accurate sampling of the canonical distribution, which for the harmonic oscillator implies that the moments of position $q$ and velocity $v$ should be $\\langle q^2 \\rangle = k_B T/k$ and $\\langle m v^2/2 \\rangle = k_B T/2$. The problem focuses on practical stability, which refers not only to the avoidance of exponential growth of the solution but also to the ability to generate meaningful statistical averages.\n\nFirst, consider the unthermostated Hamiltonian dynamics, $m \\ddot{q} = -k q$. The problem correctly states its velocity Verlet discretization is stable if and only if the product of the highest frequency and the time step, $\\omega_s \\Delta t$, is less than or equal to $2$. The numerical frequency of the oscillator, $\\omega_{\\text{num}} = \\theta/\\Delta t$, where $\\cos(\\theta) = 1 - \\frac{1}{2}(\\omega_s \\Delta t)^2$, deviates from the true frequency $\\omega_s$ as $\\Delta t$ increases. As $\\omega_s \\Delta t \\to 2$, $\\cos(\\theta) \\to -1$, so $\\theta \\to \\pi$. The numerical period $T_{\\text{num}} = 2\\pi/\\omega_{\\text{num}}$ approaches $2\\Delta t$. This means the oscillator's position nearly flips its sign every two steps, which is a significant distortion of the true dynamics.\n\nNow, let's analyze the thermostated systems.\n\n**Nosé–Hoover Thermostat:**\nThe Nosé-Hoover thermostat is deterministic and aims to generate canonical dynamics by coupling the system to an additional degree of freedom, $\\zeta$. For a system like a single harmonic oscillator, the combined dynamics can be non-ergodic, as stated in the problem. The numerical integration of these dynamics using a splitting method (like velocity Verlet for the Hamiltonian part) introduces a crucial issue: **numerical resonance**.\n\nThe thermostat variable $\\zeta$ itself has oscillatory dynamics. When the numerical frequency of the stiff mode, $\\omega_{\\text{num}}$, or one of its harmonics, becomes commensurate with the frequency of the thermostat variable, a resonance can occur. This leads to a systematic and pathological transfer of energy between the stiff mode and the thermostat. The system fails to sample the canonical ensemble correctly. The kinetic and potential energies of the stiff mode can deviate substantially from their equipartition values, so $\\langle q^2 \\rangle$ will not be close to $k_B T / k$.\n\nThis resonance is particularly severe as $\\omega_s \\Delta t \\to 2$, where the numerical period is $2 \\Delta t$. The discrete dynamics of the oscillator and thermostat can lock into a periodic, non-physical pattern. Because the Nosé-Hoover dynamics are deterministic and time-reversible (when integrated with a symmetric splitting scheme), there is no inherent mechanism to disrupt this resonance. The system has no way to \"escape\" this pathological region of phase space. Consequently, the practical time step for a Nosé-Hoover thermostat must be chosen to be much smaller than the stability limit, e.g., $\\omega_s \\Delta t \\ll 2$, to avoid these resonance regions. This makes it highly sensitive to increasing $\\Delta t$ for stiff modes.\n\n**Langevin Thermostat:**\nThe Langevin thermostat models the effect of a solvent through a friction term, $-\\gamma m \\dot{q}$, and a stochastic fluctuating force, $\\sqrt{2 \\gamma m k_B T}\\,\\xi(t)$. These terms are related by the fluctuation-dissipation theorem, which guarantees ergodicity and sampling of the canonical distribution for any $\\gamma > 0$ if integrated exactly.\n\nWhen integrated numerically with a splitting scheme, the Langevin thermostat exhibits fundamentally different behavior from Nosé-Hoover, for two reasons:\n1.  **Damping:** The friction term provides physical damping. In the discrete integrator, this is reflected by a velocity scaling factor like $\\alpha = e^{-\\gamma \\Delta t}$ per step. This damping actively removes energy from the system, counteracting any spurious energy increase caused by numerical resonance.\n2.  **Stochasticity:** The random force term introduces stochastic \"kicks\" to the velocity at each time step. This randomizes the phase of the oscillator.\n\nTogether, the damping and the stochastic phase randomization effectively destroy the coherence required for the numerical resonances that plague the Nosé-Hoover integrator. The pathological, long-lasting energy exchange between the oscillator and the thermostat cannot be established. As a result, even when $\\Delta t$ is large and approaches the Verlet stability limit $\\omega_s \\Delta t = 2$, the Langevin integrator maintains much more accurate configurational sampling. While accuracy still degrades as $\\Delta t$ increases, the failure is graceful, not catastrophic as in the resonance-driven failure of Nosé-Hoover. Therefore, a Langevin thermostat is less sensitive to increasing $\\Delta t$ and allows for a larger practically stable time step, often close to the fundamental limit of $\\omega_s \\Delta t \\le 2$.\n\n**Evaluation of Options:**\n\n**A. The Langevin thermostat is less sensitive to increasing $\\Delta t$ for stiff modes and allows a larger practically stable $\\Delta t$ because dissipative damping (factor $e^{-\\gamma \\Delta t}$) and stochastic mixing suppress parametric resonances and maintain near-canonical configurational sampling up to the base stability limit $\\omega_s \\Delta t \\lesssim 2$.**\nThis statement accurately summarizes the analysis. The Langevin thermostat's robustness stems from its inherent dissipative and stochastic nature, which suppresses the numerical resonances that affect deterministic thermostats. This allows for larger time steps that approach the fundamental stability boundary of the underlying Hamiltonian integrator.\n**Verdict: Correct.**\n\n**B. The Nosé–Hoover thermostat is less sensitive to increasing $\\Delta t$ and allows a larger practically stable $\\Delta t$ because its deterministic extended dynamics preserves a modified Hamiltonian, ensuring unbiased canonical sampling even when $\\Delta t$ approaches or exceeds the linear stability bound.**\nThis statement is incorrect on several points. The Nosé-Hoover thermostat is *more* sensitive to $\\Delta t$ due to resonances. The preservation of a modified (shadow) Hamiltonian is a property of good geometric integrators, but it does not prevent resonance or guarantee accurate sampling for large $\\Delta t$. Furthermore, no stable integration is possible beyond the linear stability bound ($\\omega_s \\Delta t > 2$), where the Verlet part of the algorithm becomes exponentially unstable.\n**Verdict: Incorrect.**\n\n**C. Both thermostats have identical sensitivity to increasing $\\Delta t$ because the only relevant constraint is the Hamiltonian stability condition $\\omega_s \\Delta t \\leq 2$, independent of thermostat type or parameters.**\nThis is incorrect. The analysis shows that the coupling of the thermostat dynamics to the numerical integrator leads to profoundly different behaviors. The Hamiltonian stability limit is a necessary but not sufficient condition for accurate sampling, and the practical stability limit is very different for the two thermostats due to the resonance issue in the Nosé-Hoover case.\n**Verdict: Incorrect.**\n\n**D. The Langevin thermostat allows a larger $\\Delta t$ only when $\\gamma \\to 0$, since any finite friction $\\gamma > 0$ makes the discrete map more restrictive than Nosé–Hoover for stiff modes and degrades configurational sampling more severely as $\\Delta t$ increases.**\nThis is the opposite of the truth. The benefits of the Langevin thermostat in this context arise precisely from a finite friction coefficient $\\gamma > 0$. The limit $\\gamma \\to 0$ recovers Hamiltonian dynamics (without its conserved energy property if integrated naively) and loses the damping that suppresses resonance. A finite friction term generally expands, not restricts, the region of stable integration for the full system. It improves, not degrades, configurational sampling compared to Nosé-Hoover at large $\\Delta t$.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Selecting an optimal time step is a multi-objective balancing act, weighing computational efficiency against the accuracy of key physical properties. This final practice moves from single principles to a holistic, operational procedure, tasking you with designing an algorithm to find the largest possible $\\Delta t$ that simultaneously respects stability, energy conservation, and geometric constraint satisfaction. By navigating these trade-offs, you will learn to implement a robust, principled protocol for setting up a high-quality simulation .",
            "id": "3742765",
            "problem": "You are tasked with formalizing and implementing a principled, physics-informed procedure to select the molecular dynamics time step $\\Delta t$ for a simulation of liquid water at temperature $T=300\\,\\mathrm{K}$, grounded in multiscale modeling considerations. The procedure must start from fundamental principles and be operationalized as an algorithm that outputs recommended $\\Delta t$ in femtoseconds $\\mathrm{(fs)}$, using specified acceptance criteria based on energy drift and holonomic constraint deviation, while respecting stability conditions associated with the fastest vibrational mode.\n\nBegin from Newton's second law of motion and the standard discretization of Hamiltonian dynamics used in Molecular Dynamics (MD). Assume the discretization is carried out using a time-reversible, symplectic scheme, and that constraints are enforced (if present) by an iterative solver. Your selection of $\\Delta t$ must be justified by multiscale reasoning: the fastest vibrational modes impose a stability limit, while slow collective motions motivate as large a $\\Delta t$ as possible without violating accuracy criteria.\n\nDesign and implement an algorithm that, for each parameter set in the provided test suite, computes the largest $\\Delta t \\in [0.1,6.0]\\,\\mathrm{fs}$, rounded to two decimals, that simultaneously satisfies all three of the following conditions:\n- The explicit stability bound derived from the linearization of the fastest mode is respected: $\\Delta t  \\dfrac{2}{\\omega_{\\max}}$, where $\\omega_{\\max}$ is the maximum angular frequency in $\\mathrm{rad/fs}$ inferred from a provided vibrational wavenumber $\\tilde{\\nu}$ in $\\mathrm{cm^{-1}}$ and an optional hydrogen mass repartitioning factor $s \\ge 1$ (dimensionless). Use the physically correct conversion $\\omega_{\\max} = \\dfrac{2\\pi c \\tilde{\\nu}}{\\sqrt{s}}\\times 10^{-15}$ with speed of light $c=2.99792458\\times 10^{10}\\,\\mathrm{cm/s}$.\n- The energy drift per nanosecond does not exceed the threshold: $D_E^{\\mathrm{ns}}(\\Delta t) \\le E_{\\mathrm{thr}}^{\\mathrm{ns}}$, with $E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$ and $D_E^{\\mathrm{ns}}(\\Delta t)$ modeled as a calibratable surrogate that scales with $\\Delta t$ according to a provided coefficient $a_E$ (in $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$) and exponent $p$ (dimensionless). Treat $D_E^{\\mathrm{ps}}(\\Delta t) = a_E\\left(\\dfrac{\\Delta t}{\\mathrm{fs}}\\right)^p$ as the drift rate in $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, and convert to nanoseconds via $D_E^{\\mathrm{ns}}(\\Delta t)=1000\\,D_E^{\\mathrm{ps}}(\\Delta t)$ before thresholding.\n- The Root-Mean-Square (RMS) holonomic constraint deviation per time step does not exceed $R_{\\mathrm{thr}} = 1\\times 10^{-4}\\,\\mathrm{nm}$, modeled as $R(\\Delta t) = a_C\\left(\\dfrac{\\Delta t}{\\mathrm{fs}}\\right)^r$, with provided coefficient $a_C$ (in $\\mathrm{nm}$) and exponent $r$ (dimensionless). If constraints are absent, set $a_C=0$.\n\nThe algorithm must perform a discrete search over candidate time steps with granularity $0.01\\,\\mathrm{fs}$ across the interval $[0.1,6.0]\\,\\mathrm{fs}$, and return the largest candidate satisfying all three criteria. If no candidate satisfies all criteria, return $\\Delta t=0.00\\,\\mathrm{fs}$.\n\nAll outputs must be expressed in $\\mathrm{fs}$, rounded to two decimals. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\Delta t_1,\\Delta t_2,\\ldots]$), where each $\\Delta t_i$ is a float rounded to two decimals.\n\nTest suite:\nFor each case, you are given $(\\tilde{\\nu}, s, a_E, a_C, p, r)$ as described above. The temperature is $T=300\\,\\mathrm{K}$, but it is implicit in the calibration of $a_E$.\n\n- Case $1$ (Unconstrained flexible water): $\\tilde{\\nu}=3600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-4}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=0\\,\\mathrm{nm}$, $p=2$, $r=2$.\n- Case $2$ (Constrained O–H bonds, good constraints): $\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-4}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=2\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$.\n- Case $3$ (Hydrogen Mass Repartitioning (HMR) with constraints): $\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=3$, $a_E=5\\times 10^{-5}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=1\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$.\n- Case $4$ (Constrained, poor solver tolerance): $\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=7\\times 10^{-5}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=5\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$.\n- Case $5$ (Extreme energy drift scenario): $\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-1}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=1\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$.\n\nYour program must implement the above procedure and output a single line with the recommended $\\Delta t$ for each case in $\\mathrm{fs}$, rounded to two decimals, as $[\\Delta t_1,\\Delta t_2,\\Delta t_3,\\Delta t_4,\\Delta t_5]$.",
            "solution": "The problem requires the formulation and implementation of a procedure to select the optimal time step, $\\Delta t$, for a molecular dynamics (MD) simulation of liquid water. The selection must be grounded in physical principles, balancing the competing demands of numerical stability, which favors a small $\\Delta t$, and computational efficiency, which favors a large $\\Delta t$. The procedure involves satisfying three distinct criteria simultaneously: a stability bound related to the fastest vibrational frequency, an accuracy bound on total energy conservation, and an accuracy bound on the satisfaction of holonomic constraints.\n\nThe fundamental equation of motion in classical MD is Newton's second law for a system of $N$ particles:\n$$ m_i \\dfrac{d^2\\mathbf{r}_i}{dt^2} = \\mathbf{F}_i(\\mathbf{r}_1, \\dots, \\mathbf{r}_N) $$\nwhere $m_i$, $\\mathbf{r}_i$, and $\\mathbf{F}_i$ are the mass, position, and force for particle $i$, respectively. Numerical integration schemes, such as the Verlet algorithm, are used to discretize these equations and propagate the system in time. The choice of the time step $\\Delta t$ is paramount for the quality of the simulation. We will establish the criteria for selecting the optimal $\\Delta t$ from a discrete search space.\n\nThe algorithm must find the largest $\\Delta t$ within the interval $[0.1, 6.0]\\,\\mathrm{fs}$ with a granularity of $0.01\\,\\mathrm{fs}$ that satisfies all three of the following conditions.\n\n**Condition 1: Numerical Stability**\n\nThe stability of common time-reversible symplectic integrators, like the Velocity Verlet algorithm, is limited by the highest frequency present in the system, $\\omega_{\\max}$. The dynamics of the fastest mode can be approximated by a simple harmonic oscillator. For such an oscillator, the Verlet scheme becomes unstable if the time step is too large. The stability condition is $\\omega_{\\max} \\Delta t \\le 2$. The problem specifies a strict inequality, which we will adhere to:\n$$ \\Delta t  \\dfrac{2}{\\omega_{\\max}} $$\nThe maximum angular frequency, $\\omega_{\\max}$, is determined by the fastest vibrational mode, characterized by its wavenumber $\\tilde{\\nu}$ (in $\\mathrm{cm^{-1}}$). The conversion from wavenumber to angular frequency is $\\omega = 2\\pi c \\tilde{\\nu}$, where $c$ is the speed of light. The units must be consistent. Given $c$ in $\\mathrm{cm/s}$, the frequency $\\omega$ is in $\\mathrm{rad/s}$. To express $\\omega$ in $\\mathrm{rad/fs}$, we use the conversion $1\\,\\mathrm{s} = 10^{15}\\,\\mathrm{fs}$:\n$$ \\omega_{\\max} \\, [\\mathrm{rad/fs}] = (2\\pi c \\tilde{\\nu}) \\times 10^{-15} $$\nThe problem also introduces Hydrogen Mass Repartitioning (HMR), a technique to slow down the fastest vibrations by artificially increasing the mass of hydrogen atoms by a factor $s \\ge 1$. Since the frequency of a harmonic oscillator is proportional to $1/\\sqrt{m}$, where $m$ is mass, increasing the relevant mass by a factor $s$ decreases the frequency by a factor $\\sqrt{s}$. The formula for $\\omega_{\\max}$ is thus:\n$$ \\omega_{\\max} = \\dfrac{2\\pi c \\tilde{\\nu}}{\\sqrt{s}} \\times 10^{-15} $$\nSubstituting this into the stability inequality gives the first constraint on $\\Delta t$.\n\n**Condition 2: Energy Conservation Accuracy**\n\nFor an isolated system (a microcanonical NVE ensemble), the total energy should be conserved. Numerical integrators introduce discretization errors, leading to a drift in the total energy over time. This energy drift rate serves as a crucial metric for simulation accuracy. The problem provides a surrogate model for the drift rate per picosecond ($D_E^{\\mathrm{ps}}$) as a function of the time step:\n$$ D_E^{\\mathrm{ps}}(\\Delta t) = a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p $$\nwhere $a_E$ is a calibrated coefficient in $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, and $p$ is a dimensionless exponent (typically $p=2$ for second-order integrators). The acceptance criterion is based on the energy drift per nanosecond, $D_E^{\\mathrm{ns}}(\\Delta t)$, which is simply $1000$ times the drift per picosecond:\n$$ D_E^{\\mathrm{ns}}(\\Delta t) = 1000 \\cdot D_E^{\\mathrm{ps}}(\\Delta t) = 1000 \\cdot a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p $$\nThis drift must not exceed a specified threshold, $E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$. The second condition is therefore:\n$$ 1000 \\cdot a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p \\le E_{\\mathrm{thr}}^{\\mathrm{ns}} $$\n\n**Condition 3: Holonomic Constraint Accuracy**\n\nTo eliminate the fastest vibrational motions (e.g., O-H bond stretching) and enable a larger $\\Delta t$, holonomic constraints are often applied. Algorithms like SHAKE or RATTLE enforce these constraints iteratively at each time step. These solvers have a finite tolerance, resulting in small deviations from the ideal constraint geometry. The Root-Mean-Square (RMS) deviation is a measure of this error. The problem models this deviation, $R(\\Delta t)$, with a power law:\n$$ R(\\Delta t) = a_C \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^r $$\nwhere $a_C$ is a calibrated coefficient in $\\mathrm{nm}$ and $r$ is a dimensionless exponent. This deviation must not exceed a threshold $R_{\\mathrm{thr}} = 1 \\times 10^{-4}\\,\\mathrm{nm}$. This gives the third condition:\n$$ a_C \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^r \\le R_{\\mathrm{thr}} $$\nIf constraints are not used, $a_C=0$, and this condition is trivially satisfied as $0 \\le R_{\\mathrm{thr}}$.\n\n**Algorithmic Procedure**\n\nThe final algorithm synthesizes these three conditions. To find the largest permissible $\\Delta t$, we perform a discrete search over the interval $[0.1, 6.0]\\,\\mathrm{fs}$ with a step of $0.01\\,\\mathrm{fs}$. The search proceeds from the largest value, $\\Delta t = 6.00\\,\\mathrm{fs}$, downwards. For each candidate $\\Delta t$, we check if all three inequalities are satisfied. The first candidate $\\Delta t$ that meets all conditions is the desired result, as it will be the largest one. If the search completes without finding any valid $\\Delta t$ in the specified range, the result is taken to be $0.00\\,\\mathrm{fs}$.\n\nFor a given set of parameters $(\\tilde{\\nu}, s, a_E, a_C, p, r)$, the procedure is:\n1. Define constants: $c=2.99792458\\times 10^{10}\\,\\mathrm{cm/s}$, $E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$, $R_{\\mathrm{thr}} = 1\\times 10^{-4}\\,\\mathrm{nm}$.\n2. Pre-calculate the stability limit: $\\Delta t_{\\mathrm{stable}}^{\\max} = \\dfrac{2 \\sqrt{s}}{2\\pi c \\tilde{\\nu} \\times 10^{-15}}$.\n3. Iterate $\\Delta t$ from $6.00\\,\\mathrm{fs}$ down to $0.10\\,\\mathrm{fs}$ in steps of $0.01\\,\\mathrm{fs}$.\n4. For each $\\Delta t$:\n    a. Check stability: Is $\\Delta t  \\Delta t_{\\mathrm{stable}}^{\\max}$?\n    b. Check energy drift: Is $1000 \\cdot a_E (\\Delta t)^p \\le E_{\\mathrm{thr}}^{\\mathrm{ns}}$? (Here $\\Delta t$ is the numerical value in fs).\n    c. Check constraint deviation: Is $a_C (\\Delta t)^r \\le R_{\\mathrm{thr}}$?\n5. If all three checks pass, this $\\Delta t$ is the solution. Record it and move to the next test case.\n6. If the loop finishes, no valid $\\Delta t$ was found. The solution is $0.00\\,\\mathrm{fs}$.\nThis procedure is then applied to each of the five test cases provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the largest valid molecular dynamics time step based on stability,\n    energy drift, and constraint deviation criteria.\n    \"\"\"\n\n    # Physical and simulation constants\n    C_LIGHT = 2.99792458e10  # Speed of light in cm/s\n    E_THR_NS = 0.5  # Energy drift threshold in kJ/mol/ns\n    R_THR = 1.0e-4  # Constraint deviation threshold in nm\n\n    # Test suite: (nu_tilde, s, a_E, a_C, p, r)\n    test_cases = [\n        # Case 1: Unconstrained flexible water\n        (3600, 1, 1e-4, 0, 2, 2),\n        # Case 2: Constrained O-H bonds, good constraints\n        (1600, 1, 1e-4, 2e-5, 2, 2),\n        # Case 3: Hydrogen Mass Repartitioning (HMR) with constraints\n        (1600, 3, 5e-5, 1e-5, 2, 2),\n        # Case 4: Constrained, poor solver tolerance\n        (1600, 1, 7e-5, 5e-5, 2, 2),\n        # Case 5: Extreme energy drift scenario\n        (1600, 1, 1e-1, 1e-5, 2, 2),\n    ]\n\n    results = []\n    \n    # Define the search space for delta_t in femtoseconds\n    # Search from largest to smallest to find the max valid dt first\n    dt_candidates = np.arange(6.00, 0.09, -0.01)\n\n    for case in test_cases:\n        nu_tilde, s, a_E, a_C, p, r = case\n        \n        found_dt = 0.00\n\n        # Condition 1: Stability\n        # omega_max is in rad/fs\n        omega_max = (2 * np.pi * C_LIGHT * nu_tilde / np.sqrt(s)) * 1e-15\n        dt_stability_limit = 2.0 / omega_max\n\n        for dt in dt_candidates:\n            # Check condition 1\n            cond1 = (dt  dt_stability_limit)\n\n            # Check condition 2: Energy drift\n            # dt is already in fs, as required by the formula's implicit unit\n            energy_drift_ns = 1000.0 * a_E * (dt ** p)\n            cond2 = (energy_drift_ns = E_THR_NS)\n\n            # Check condition 3: Constraint deviation\n            constraint_dev = a_C * (dt ** r)\n            cond3 = (constraint_dev = R_THR)\n\n            if cond1 and cond2 and cond3:\n                # Found the largest valid dt, as we are iterating downwards.\n                # Round to two decimal places as per problem spec\n                found_dt = np.round(dt, 2)\n                break\n        \n        results.append(found_dt)\n\n    # Format the final output string exactly as required.\n    # Use \"{:.2f}\".format() to ensure two decimal places are always shown (e.g., 0.00)\n    formatted_results = [f\"{res:.2f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}