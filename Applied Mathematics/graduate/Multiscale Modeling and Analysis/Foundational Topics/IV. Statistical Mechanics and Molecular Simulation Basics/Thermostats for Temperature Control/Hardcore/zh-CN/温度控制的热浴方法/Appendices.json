{
    "hands_on_practices": [
        {
            "introduction": "Berendsen 恒温器因其简洁和直观而常被用作温度控制的入门方法。本练习将引导你从第一性原理出发，通过连接连续的弛豫模型和离散的数值实现，来推导其核心的速度标度因子 。这项实践有助于建立对弱耦合恒温器工作机制的基础理解。",
            "id": "5274833",
            "problem": "考虑一个具有 $N_f$ 个经典自由度的生物分子体系的定数、定容分子动力学（MD）模拟，其中温度由 Berendsen 型的速度标度弱耦合恒温器控制。瞬时动能温度 $T_{\\mathrm{inst}}$ 根据能量均分定理定义为 $T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$，其中 $K$ 是总动能，$k_B$ 是玻尔兹曼常数。在每个 MD 时间步，所有速度都乘以一个共同因子 $\\alpha$，位置则根据牛顿运动方程进行更新。\n\n假设目标温度为 $T_0$，并且恒温器对动能温度施加一阶弛豫，该过程由常微分方程 $\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$ 描述，其中 $\\tau_T$ 是恒温器时间常数。请确保离散的速度标度 $v_i \\mapsto \\alpha v_i$ 与关于 $T$ 的弛豫方程在时长为 $\\Delta t$ 的一个 MD 时间步内的一阶前向欧拉积分保持一致。\n\n从基于能量均分定理的 $T_{\\mathrm{inst}}$ 定义以及速度标度对动能的影响出发，推导 $\\alpha$ 的表达式，该表达式能确保 $T_{\\mathrm{inst}}$ 的单步离散更新与弛豫方程的前向欧拉离散化相匹配。然后，对于单个标度步骤，当 $\\tau_T = 0.1\\,\\mathrm{ps}$，$\\Delta t = 2\\,\\mathrm{fs}$，初始 $T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$，目标 $T_0 = 300\\,\\mathrm{K}$ 时，计算 $\\alpha$ 并预测标度后新的瞬时温度。\n\n将您的数值结果四舍五入到四位有效数字。以 $\\mathrm{K}$ 为单位表示最终温度。以包含 $\\alpha$ 和一步更新后的 $T_{\\mathrm{inst}}$ 的行矩阵形式提供最终答案。",
            "solution": "用户提供了一个来自计算统计力学领域的明确问题，具体涉及在分子动力学（MD）模拟中使用 Berendsen 恒温器进行温度控制。\n\n### 第1步：提取已知条件\n- 体系描述：具有 $N_f$ 个经典自由度的定数、定容 MD 模拟。\n- 温度控制方法：Berendsen 型速度标度弱耦合恒温器。\n- 瞬时温度定义：$T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$，其中 $K$ 是总动能，$k_B$ 是玻尔兹曼常数。\n- 速度更新：在每个时间步，所有速度 $v_i$ 都乘以一个因子 $\\alpha$，使得新速度为 $v_i' = \\alpha v_i$。\n- 目标温度：$T_0$。\n- 弛豫动力学：恒温器根据常微分方程（ODE）$\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$ 对动能温度 $T$ 施加一阶弛豫，其中 $\\tau_T$ 是恒温器时间常数。\n- 时间步长：$\\Delta t$。\n- 一致性要求：离散速度标度必须与温度弛豫 ODE 在一个时间步 $\\Delta t$ 内的一阶前向欧拉积分保持一致。\n- 用于计算的数值：\n  - 时间常数 $\\tau_T = 0.1\\,\\mathrm{ps}$\n  - 时间步 $\\Delta t = 2\\,\\mathrm{fs}$\n  - 初始瞬时温度 $T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$\n  - 目标温度 $T_0 = 300\\,\\mathrm{K}$\n- 要求输出：\n  1. 标度因子 $\\alpha$ 的解析表达式。\n  2. $\\alpha$ 的数值以及经过一步标度后的新瞬时温度，结果四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了 Berendsen 恒温器的标准实现，这是分子模拟中的一种常用算法。其基本原理——能量均分定理和一阶动力学——是公认的。问题是适定的，提供了推导唯一解所需的所有定义、方程和参数。语言客观、精确。所有提供的数值对于生物分子模拟而言都是物理上现实的。因此，该问题被认为是 **有效的**。\n\n### 第3步：推导与计算\n\n#### 第1部分：标度因子 $\\alpha$ 的推导\n\n我们的任务是将一个 MD 时间步 $\\Delta t$ 内温度变化的两种不同观点联系起来。\n\n首先，考虑速度标度对瞬时温度的影响。设 $T$ 为时间步开始时的瞬时温度。根据定义，$T = \\frac{2K}{N_f k_B}$，其中 $K$ 是体系的总动能。动能由 $K = \\sum_i \\frac{1}{2} m_i v_i^2$ 给出。\n\n速度被一个因子 $\\alpha$ 重新标度，因此新速度为 $v_i' = \\alpha v_i$。新的动能 $K'$ 为：\n$$K' = \\sum_i \\frac{1}{2} m_i (v_i')^2 = \\sum_i \\frac{1}{2} m_i (\\alpha v_i)^2 = \\alpha^2 \\left( \\sum_i \\frac{1}{2} m_i v_i^2 \\right) = \\alpha^2 K$$\n新的瞬时温度 $T'$ 与新的动能 $K'$ 相关：\n$$T' = \\frac{2K'}{N_f k_B} = \\frac{2(\\alpha^2 K)}{N_f k_B} = \\alpha^2 \\left( \\frac{2K}{N_f k_B} \\right)$$\n因此，由速度标度引起的温度变化是：\n$$T' = \\alpha^2 T$$\n\n其次，考虑由弛豫方程 $\\frac{dT}{dt} = \\frac{1}{\\tau_T}(T_0 - T)$ 决定的温度变化。我们使用一阶前向欧拉格式在时间间隔 $\\Delta t$ 上将此 ODE 离散化。导数 $\\frac{dT}{dt}$ 近似为 $\\frac{T' - T}{\\Delta t}$，其中 $T'$ 是时间步结束时的温度。\n$$\\frac{T' - T}{\\Delta t} \\approx \\frac{1}{\\tau_T}(T_0 - T)$$\n求解新温度 $T'$ 可得：\n$$T' \\approx T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n\n为确保一致性，我们令新温度 $T'$ 的两个表达式相等：\n$$\\alpha^2 T = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n为了求解 $\\alpha$，我们除以 $T$（假设 $T \\neq 0$，这对于有限温度下的系统是一个有效的物理假设）：\n$$\\alpha^2 = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0 - T}{T}\\right) = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)$$\n取正平方根（因为 $\\alpha$ 是一个标度因子，通常取正值以保持速度方向）得到 $\\alpha$ 的最终表达式：\n$$\\alpha = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)}$$\n推导完成。\n\n#### 第2部分：数值计算\n\n给定以下数值：\n- $\\tau_T = 0.1\\,\\mathrm{ps} = 0.1 \\times 10^{-12}\\,\\mathrm{s}$\n- $\\Delta t = 2\\,\\mathrm{fs} = 2 \\times 10^{-15}\\,\\mathrm{s}$\n- 初始温度, $T = T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$\n- 目标温度, $T_0 = 300\\,\\mathrm{K}$\n\n首先，我们计算无量纲比率 $\\frac{\\Delta t}{\\tau_T}$：\n$$\\frac{\\Delta t}{\\tau_T} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{0.1 \\times 10^{-12}\\,\\mathrm{s}} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{1 \\times 10^{-13}\\,\\mathrm{s}} = 2 \\times 10^{-2} = 0.02$$\n现在，将此值和温度代入 $\\alpha^2$ 的表达式中：\n$$\\alpha^2 = 1 + 0.02 \\left(\\frac{300\\,\\mathrm{K}}{320\\,\\mathrm{K}} - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02 \\left(0.9375 - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02(-0.0625)$$\n$$\\alpha^2 = 1 - 0.00125$$\n$$\\alpha^2 = 0.99875$$\n现在我们通过取平方根来计算 $\\alpha$：\n$$\\alpha = \\sqrt{0.99875} \\approx 0.999374811...$$\n四舍五入到四位有效数字，我们得到：\n$$\\alpha \\approx 0.9994$$\n\n接下来，我们预测重新标度后瞬间的新瞬时温度 $T'$。我们可以使用前向欧拉表达式进行此计算，以避免我们计算出的 $\\alpha$ 值的舍入误差传播。\n$$T' = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n$$T' = 320\\,\\mathrm{K} + 0.02(300\\,\\mathrm{K} - 320\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} + 0.02(-20\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} - 0.4\\,\\mathrm{K}$$\n$$T' = 319.6\\,\\mathrm{K}$$\n这个结果已经有四位有效数字。\n\n要求的两个值是标度因子 $\\alpha$ 和新的瞬时温度 $T'$。\n$\\alpha \\approx 0.9994$\n$T' = 319.6\\,\\mathrm{K}$\n\n我们按照要求将这些结果以行矩阵的形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.9994   319.6 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了基础恒温器后，我们转向更严谨的方法。本练习深入对比了两种主流的恒温器：随机的 Langevin 恒温器和确定性的 Nosé-Hoover 恒温器 。通过这项实践，你将探索不变测度、遍历性以及动力学保真度等深层概念，从而理解为何不同的恒温器即使能得到正确的平均温度，却可能在其他关键方面（如涨落和遍历性）表现迥异。",
            "id": "3823583",
            "problem": "考虑一个$d$维谐振系统，其质量均为$m$，角频率均为$\\omega$，位形坐标为 $q \\in \\mathbb{R}^{d}$，速度为 $v \\in \\mathbb{R}^{d}$。其物理哈密顿量为 $H(q,v) = \\frac{m}{2} \\|v\\|^{2} + \\frac{m \\omega^{2}}{2} \\|q\\|^{2}$。目标平衡态是温度为$T$时的正则（玻尔兹曼）测度，其逆温度为 $\\beta = \\frac{1}{k_{B} T}$，其中 $k_{B}$ 是玻尔兹曼常数。\n\n采用两种恒温策略进行温度控制：\n\n- 朗之万恒温器由以下随机微分方程（强制满足涨落-耗散定理（FDT））定义：$\\dot{q} = v$ 和 $m \\dot{v} = - m \\omega^{2} q - \\gamma m v + \\sqrt{2 \\gamma m k_{B} T} \\, \\eta(t)$，其中 $\\gamma > 0$ 是一个标量摩擦系数，$\\eta(t)$ 是一个标准高斯白噪声，其均值为零，协方差为 $\\langle \\eta_{i}(t) \\eta_{j}(t') \\rangle = \\delta_{ij} \\delta(t-t')$，适用于所有索引 $i,j \\in \\{1,\\dots,d\\}$。\n- 确定性的 Nosé–Hoover（NH）恒温器用一个标量恒温器变量 $\\xi$ 和一个质量参数 $Q > 0$ 来扩展动力学，其方程为 $\\dot{q} = v$，$m \\dot{v} = - m \\omega^{2} q - \\xi m v$ 和 $\\dot{\\xi} = \\frac{1}{Q} \\left( m \\|v\\|^{2} - d k_{B} T \\right)$。\n\nA部分：从朗之万动力学的福克-普朗克方程和 Nosé–Hoover 扩展确定性动力学的刘维尔方程出发，推导不变相空间密度，并证明两种恒温器的 $(q,v)$-边缘不变测度均为与 $\\exp\\!\\left(-\\beta H(q,v)\\right)$ 成正比的正则高斯测度。\n\nB部分：使用关于动力学生成元的第一性原理进行推理，对比这两种恒温器对此$d$维谐振系统的遍历性性质。论证朗之万恒温器是遍历的条件，以及单变量 Nosé–Hoover 恒温器对于谐振系统为何不具有遍历性。\n\nC部分：定义归一化的单模速度自相关函数 $C^{\\mathrm{norm}}(t) = \\frac{\\langle v_{1}(t) v_{1}(0) \\rangle}{\\langle v_{1}^{2}(0) \\rangle}$，其中 $v_{1}$ 表示$d$个速度分量中的任意一个（根据对称性，所有模式都是相同的）。考虑朗之万动力学的欠阻尼区 $\\gamma  2 \\omega$，以及 Nosé–Hoover 恒温器的弱耦合极限 $Q \\to \\infty$，在此极限下，恒温器变量的演化时间尺度远慢于物理振子。在此极限中，Nosé–Hoover 恒温器的 $C^{\\mathrm{norm}}(t)$ 与未恒温的谐振子的哈密顿自相关函数一致。\n\n定义动力学保真度泛函\n$$F(\\alpha,\\gamma,\\omega) = \\int_{0}^{\\infty} \\exp(-\\alpha t) \\left[ C^{\\mathrm{norm}}_{\\mathrm{Langevin}}(t) - C^{\\mathrm{norm}}_{\\mathrm{NH}}(t) \\right] \\, dt,$$\n其中 $\\alpha > 0$ 是一个收敛速率参数。从基本运动方程出发，不借助任何快捷公式，推导出一个在指定区域内关于 $F(\\alpha,\\gamma,\\omega)$ 的闭式解析表达式。最终答案必须是单一的闭式表达式。不需要四舍五入，最终表达式中也不应包含单位。",
            "solution": "该问题被评估为有效，因为它具有科学依据、问题明确且客观。它提出了一个计算统计力学中标准但高级的问题，要求分析和比较两种常见的恒温算法。所有给出的方程和参数都是标准的，并与现有文献一致。\n\n按照题目要求，解答分为三个部分。\n\n### A部分：不变相空间密度\n\n目标是推导朗之万和 Nosé–Hoover 动力学的稳态概率密度，并证明它们在物理相空间 $(q,v)$ 上的边缘分布对应于正则玻尔兹曼分布 $\\rho(q,v) \\propto \\exp(-\\beta H(q,v))$。\n\n**朗之万恒温器**\n\n系统的动力学由一组随机微分方程描述。概率密度函数 $\\rho(q,v,t)$ 的时间演化由福克-普朗克方程控制。对于状态矢量 $\\mathbf{x} = (q,v)$，福克-普朗克方程的一般形式为 $\\frac{\\partial \\rho}{\\partial t} = -\\nabla \\cdot (\\mathbf{A} \\rho) + \\nabla \\cdot (\\mathbf{D} \\nabla \\rho)$，其中 $\\mathbf{A}$ 是漂移矢量，$\\mathbf{D}$ 是扩散矩阵。\n\n对于给定的朗之万动力学，状态矢量为 $(q_1, \\dots, q_d, v_1, \\dots, v_d)$。\n漂移分量为 $\\dot{q}_i = v_i$ 和 $\\dot{v}_i = -\\omega^2 q_i - \\gamma v_i$。\n噪声项只存在于 $\\dot{v}$ 方程中。随机力是 $F_{\\text{stoch}} = \\frac{1}{m} \\sqrt{2\\gamma m k_B T} \\eta(t)$。扩散矩阵 $\\mathbf{D}$ 与噪声的协方差有关。在这里，它仅在速度-速度块中非零：\n$D_{v_i v_j} = \\frac{1}{2} \\cdot \\frac{1}{m^2} \\cdot (2\\gamma m k_B T) \\delta_{ij} = \\frac{\\gamma k_B T}{m}\\delta_{ij}$。使用 $\\beta = \\frac{1}{k_B T}$，可得 $D_{v_i v_j} = \\frac{\\gamma}{m\\beta}\\delta_{ij}$。\n\n福克-普朗克方程为：\n$$ \\frac{\\partial \\rho}{\\partial t} = - \\sum_{i=1}^d \\frac{\\partial}{\\partial q_i}(v_i \\rho) - \\sum_{i=1}^d \\frac{\\partial}{\\partial v_i} \\left( (-\\omega^2 q_i - \\gamma v_i) \\rho \\right) + \\sum_{i=1}^d \\frac{\\gamma}{m\\beta} \\frac{\\partial^2 \\rho}{\\partial v_i^2} $$\n我们寻求一个稳态解 $\\rho_s(q,v)$，其中 $\\frac{\\partial \\rho_s}{\\partial t} = 0$。我们来检验正则分布 $\\rho_s(q,v) = Z^{-1} \\exp(-\\beta H(q,v))$，其中 $H(q,v) = \\frac{m}{2}\\|v\\|^2 + \\frac{m\\omega^2}{2}\\|q\\|^2$。\n$\\rho_s$的梯度为：\n$$ \\nabla_q \\rho_s = -\\beta m \\omega^2 q \\rho_s $$\n$$ \\nabla_v \\rho_s = -\\beta m v \\rho_s $$\n将这些代入稳态福克-普朗克方程：\n$$ 0 = - \\nabla_q \\cdot (v \\rho_s) - \\nabla_v \\cdot ((-\\omega^2 q - \\gamma v) \\rho_s) + \\frac{\\gamma}{m\\beta} \\nabla_v^2 \\rho_s $$\n让我们逐项计算：\n1.  $- \\nabla_q \\cdot (v \\rho_s) = -v \\cdot \\nabla_q \\rho_s = -v \\cdot (-\\beta m \\omega^2 q \\rho_s) = \\beta m \\omega^2 (v \\cdot q) \\rho_s$。\n2.  $- \\nabla_v \\cdot ((-\\omega^2 q - \\gamma v) \\rho_s) = -(-\\omega^2 q - \\gamma v) \\cdot \\nabla_v \\rho_s - \\rho_s (\\nabla_v \\cdot (-\\omega^2 q - \\gamma v)) = -(-\\omega^2 q - \\gamma v) \\cdot (-\\beta m v \\rho_s) - \\rho_s (-d\\gamma) = -(\\beta m \\omega^2 (q \\cdot v) + \\beta m \\gamma \\|v\\|^2)\\rho_s + d\\gamma \\rho_s$。\n3.  $\\frac{\\gamma}{m\\beta} \\nabla_v^2 \\rho_s = \\frac{\\gamma}{m\\beta} \\nabla_v \\cdot (\\nabla_v \\rho_s) = \\frac{\\gamma}{m\\beta} \\nabla_v \\cdot (-\\beta m v \\rho_s) = -\\gamma \\nabla_v \\cdot (v\\rho_s) = -\\gamma(d\\rho_s + v \\cdot \\nabla_v \\rho_s) = -\\gamma(d\\rho_s + v \\cdot (-\\beta m v \\rho_s)) = (-d\\gamma + \\beta m \\gamma \\|v\\|^2)\\rho_s$。\n\n将各项相加：\n$$ \\left( \\beta m \\omega^2 (v \\cdot q) \\right) + \\left( -\\beta m \\omega^2 (q \\cdot v) - \\beta m \\gamma \\|v\\|^2 + d\\gamma \\right) + \\left( -d\\gamma + \\beta m \\gamma \\|v\\|^2 \\right) = 0 $$\n所有项都抵消了。因此，$\\rho_s(q,v) \\propto \\exp(-\\beta H(q,v))$ 确实是不变密度。在 $(q,v)$ 上的边缘分布就是这个分布本身。\n\n**Nosé–Hoover 恒温器**\n\nNosé–Hoover 动力学在扩展相空间 $(q,v,\\xi)$ 中是确定性的。概率密度 $\\rho(q,v,\\xi,t)$ 的时间演化由非哈密顿系统的刘维尔方程控制：\n$$ \\frac{\\partial \\rho}{\\partial t} + \\nabla_{\\mathbf{x}} \\cdot (\\rho \\dot{\\mathbf{x}}) = 0 $$\n其中 $\\mathbf{x} = (q,v,\\xi)$。对于一个稳态解 $\\rho_s$，我们有 $\\nabla_{\\mathbf{x}} \\cdot (\\rho_s \\dot{\\mathbf{x}}) = 0$，可以写成 $\\dot{\\mathbf{x}} \\cdot \\nabla_{\\mathbf{x}}\\rho_s + \\rho_s (\\nabla_{\\mathbf{x}} \\cdot \\dot{\\mathbf{x}}) = 0$。\n\n首先，我们计算流场的散度 $\\nabla_{\\mathbf{x}} \\cdot \\dot{\\mathbf{x}}$：\n$$ \\nabla_{\\mathbf{x}} \\cdot \\dot{\\mathbf{x}} = \\nabla_q \\cdot \\dot{q} + \\nabla_v \\cdot \\dot{v} + \\frac{\\partial \\dot{\\xi}}{\\partial \\xi} $$\n使用运动方程 $\\dot{q}=v$，$\\dot{v} = -\\omega^2 q - \\xi v$，$\\dot{\\xi} = \\frac{1}{Q}(m\\|v\\|^2 - dk_B T)$：\n- $\\nabla_q \\cdot v = 0$\n- $\\nabla_v \\cdot (-\\omega^2 q - \\xi v) = \\sum_{i=1}^d \\frac{\\partial}{\\partial v_i}(-\\xi v_i) = -d\\xi$\n- $\\frac{\\partial}{\\partial \\xi} \\left( \\frac{1}{Q}(m\\|v\\|^2 - dk_B T) \\right) = 0$\n所以，$\\nabla_{\\mathbf{x}} \\cdot \\dot{\\mathbf{x}} = -d\\xi$。稳态刘维尔方程变为：\n$$ \\dot{\\mathbf{x}} \\cdot \\nabla_{\\mathbf{x}}\\rho_s - d\\xi \\rho_s = 0 $$\n我们检验所提出的不变密度 $\\rho_s(q,v,\\xi) \\propto \\exp(-\\beta H'_{\\mathrm{NH}})$，其中 $H'_{\\mathrm{NH}} = H(q,v) + \\frac{Q}{2}\\xi^2$。$\\rho_s$的梯度是：\n$$ \\nabla_q \\rho_s = -\\beta m \\omega^2 q \\rho_s, \\quad \\nabla_v \\rho_s = -\\beta m v \\rho_s, \\quad \\frac{\\partial \\rho_s}{\\partial \\xi} = -\\beta Q \\xi \\rho_s $$\n代入稳态刘维尔方程并除以 $\\rho_s$：\n$$ \\dot{q} \\cdot(-\\beta m \\omega^2 q) + \\dot{v} \\cdot(-\\beta m v) + \\dot{\\xi} \\cdot(-\\beta Q \\xi) - d\\xi = 0 $$\n$$ v \\cdot(-\\beta m \\omega^2 q) + (-\\omega^2 q - \\xi v) \\cdot(-\\beta m v) + \\frac{1}{Q}(m\\|v\\|^2 - dk_B T) \\cdot(-\\beta Q \\xi) - d\\xi = 0 $$\n$$ -\\beta m \\omega^2 (v \\cdot q) + \\beta m \\omega^2 (q \\cdot v) + \\beta m \\xi \\|v\\|^2 - \\beta \\xi (m\\|v\\|^2 - dk_B T) - d\\xi = 0 $$\n前两项抵消。第三项与第四项的第一部分抵消：\n$$ \\beta \\xi dk_B T - d\\xi = 0 $$\n使用 $\\beta = 1/(k_B T)$，我们得到 $\\frac{1}{k_B T}\\xi d k_B T - d\\xi = d\\xi - d\\xi = 0$。此式成立。\n因此，$\\rho_s(q,v,\\xi) \\propto \\exp(-\\beta(H(q,v) + \\frac{Q}{2}\\xi^2))$ 是扩展相空间中的不变密度。\n\n为了求出物理变量 $(q,v)$ 的边缘分布，我们对恒温器变量 $\\xi$ 进行积分：\n$$ \\rho_m(q,v) = \\int_{-\\infty}^{\\infty} \\rho_s(q,v,\\xi)d\\xi \\propto \\exp(-\\beta H(q,v)) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta Q}{2}\\xi^2\\right) d\\xi $$\n关于 $\\xi$ 的积分是一个高斯积分，其值为一个常数 $\\sqrt{2\\pi/(\\beta Q)}$。因此，边缘分布为：\n$$ \\rho_m(q,v) \\propto \\exp(-\\beta H(q,v)) $$\n这证实了两种恒温器都为系统的物理部分生成了正确的正则分布。\n\n### B部分：遍历性性质\n\n遍历性要求系统的单条长时间轨迹能够探索与守恒量一致的整个可及相空间，从而使得时间平均等于系综平均。\n\n**朗之万恒温器**\n朗之万动力学的生成元是福克-普朗克算子。该动力学既包含耗散项 ($-\\gamma m v$) 也包含随机涨落项 ($\\sqrt{2 \\gamma m k_{B} T} \\, \\eta(t)$)。随机项是高斯白噪声，对所有速度分量起到随机驱动力的作用。这种持续的随机“踢动”防止系统被困在相空间的任何低维子流形中。耗散和涨落的结合将系统驱动到一个唯一的稳态（正则分布），并确保所有具有非零概率密度的相空间区域都会随着时间的推移而被访问到。因此，对于任何摩擦系数 $\\gamma > 0$，谐振系统的朗之万动力学相对于正则测度是遍历的。\n\n**Nosé–Hoover 恒温器**\nNosé–Hoover 动力学的生成元是确定性流的刘维尔算子。系统守恒扩展能量 $H'_{\\mathrm{NH}} = H(q,v) + \\frac{Q}{2}\\xi^2$。为了使系统具有遍历性，一条典型的轨迹必须密集地填充由 $H'_{\\mathrm{NH}} = E$ 定义的恒能面。\n\n然而，对于谐振系统，Nosé–Hoover 恒温器不具有遍历性。动力学可以分解为简正模。在这个问题中，所有模式都具有相同的频率 $\\omega$。每个模式 $(q_i, v_i)$ 的运动方程为 $\\ddot{q}_i + \\xi(t)\\dot{q}_i + \\omega^2 q_i = 0$。单个恒温器变量 $\\xi$ 与总动能耦合。这种耦合不足以引发混沌行为并促进模式间的混合。运动保持高度规则和准周期性。轨迹并非探索整个恒能面，而是被限制在该曲面内的低维不变环面上。这是单变量 Nosé–Hoover 恒温器应用于具有规则、非混沌底层动力学（如谐振子）的系统时一个众所周知的失败案例。因此，时间平均值将依赖于初始条件，并且不等于用A部分中推导出的不变测度计算出的系综平均值。\n\n总而言之，朗之万动力学的随机性保证了遍历性，而 Nosé–Hoover 动力学作用于谐振系统上的确定性但过于规则的性质导致了遍历性的失效。\n\n### C部分：保真度泛函 $F(\\alpha,\\gamma,\\omega)$ 的推导\n\n该泛函定义为两个归一化速度自相关函数 (VAF) 之差的拉普拉斯变换：\n$$ F(\\alpha,\\gamma,\\omega) = \\int_{0}^{\\infty} \\exp(-\\alpha t) \\left[ C^{\\mathrm{norm}}_{\\mathrm{Langevin}}(t) - C^{\\mathrm{norm}}_{\\mathrm{NH}}(t) \\right] \\, dt = \\mathcal{L}[C^{\\mathrm{norm}}_{\\mathrm{Langevin}}](\\alpha) - \\mathcal{L}[C^{\\mathrm{norm}}_{\\mathrm{NH}}](\\alpha) $$\n归一化的 VAF 是 $C^{\\mathrm{norm}}(t) = \\frac{\\langle v_{1}(t) v_{1}(0) \\rangle}{\\langle v_{1}^{2}(0) \\rangle}$。分母是平衡态下的均方速度。根据能量均分定理，$\\frac{1}{2}m\\langle v_1^2 \\rangle = \\frac{1}{2}k_B T$，所以 $\\langle v_1^2 \\rangle = \\frac{k_B T}{m}$。\n\n**1. Nosé–Hoover VAF**\n在弱耦合极限 ($Q \\to \\infty$) 下，题目指出 NH VAF 收敛于未恒温的哈密顿系统的 VAF。一个模式的哈密顿运动方程为 $\\dot{q}_1 = v_1$ 和 $\\dot{v}_1 = -\\omega^2 q_1$。$v_1(t)$ 的解是 $v_1(t) = v_1(0)\\cos(\\omega t) - q_1(0)\\omega\\sin(\\omega t)$。\nVAF 是 $\\langle v_1(t) v_1(0) \\rangle = \\langle (v_1(0)\\cos(\\omega t) - q_1(0)\\omega\\sin(\\omega t))v_1(0) \\rangle$。\n在热平衡状态下，初始位置和速度是不相关的，$\\langle q_1(0) v_1(0) \\rangle = 0$。\n因此，$\\langle v_1(t) v_1(0) \\rangle_{\\mathrm{NH}} = \\langle v_1^2(0) \\rangle \\cos(\\omega t)$。\n归一化的 VAF 是 $C^{\\mathrm{norm}}_{\\mathrm{NH}}(t) = \\cos(\\omega t)$。\n其拉普拉斯变换为 $\\mathcal{L}[C^{\\mathrm{norm}}_{\\mathrm{NH}}](\\alpha) = \\mathcal{L}[\\cos(\\omega t)](\\alpha) = \\frac{\\alpha}{\\alpha^2 + \\omega^2}$。\n\n**2. 朗之万 VAF**\n单个模式的运动方程为 $\\dot{q}_1 = v_1$ 和 $\\dot{v}_1 = -\\omega^2 q_1 - \\gamma v_1 + \\frac{1}{m}\\sqrt{2\\gamma m k_B T}\\eta_1(t)$。对于状态矢量 $\\mathbf{x} = (q_1, v_1)^T$，这些可以写成矩阵形式：$\\dot{\\mathbf{x}} = \\mathbf{A}\\mathbf{x} + \\mathbf{f}(t)$，其中\n$$ \\mathbf{A} = \\begin{pmatrix} 0   1 \\\\ -\\omega^2   -\\gamma \\end{pmatrix}, \\quad \\mathbf{f}(t) = \\begin{pmatrix} 0 \\\\ \\sqrt{\\frac{2\\gamma k_B T}{m}}\\eta_1(t) \\end{pmatrix} $$\n解是 $\\mathbf{x}(t) = e^{\\mathbf{A}t}\\mathbf{x}(0) + \\int_0^t e^{\\mathbf{A}(t-s)}\\mathbf{f}(s)ds$。\n速度是 $v_1(t) = [e^{\\mathbf{A}t}\\mathbf{x}(0)]_2 + \\dots$。\nVAF 是 $\\langle v_1(t) v_1(0) \\rangle = \\langle ([e^{\\mathbf{A}t}\\mathbf{x}(0)]_2) v_1(0) \\rangle$。噪声项没有贡献，因为它与初始条件不相关。\n$\\langle v_1(t) v_1(0) \\rangle = \\langle ( (e^{\\mathbf{A}t})_{21} q_1(0) + (e^{\\mathbf{A}t})_{22} v_1(0) ) v_1(0) \\rangle$。\n使用 $\\langle q_1(0)v_1(0) \\rangle = 0$，我们得到 $\\langle v_1(t) v_1(0) \\rangle_{\\mathrm{Langevin}} = (e^{\\mathbf{A}t})_{22} \\langle v_1^2(0) \\rangle$。\n所以，$C^{\\mathrm{norm}}_{\\mathrm{Langevin}}(t) = (e^{\\mathbf{A}t})_{22}$。\n\n为了求这个函数的拉普拉斯变换，我们可以直接对矩阵指数进行变换：$\\mathcal{L}[e^{\\mathbf{A}t}](s) = (s\\mathbf{I}-\\mathbf{A})^{-1}$。\n$$ (s\\mathbf{I}-\\mathbf{A})^{-1} = \\begin{pmatrix} s   -1 \\\\ \\omega^2   s+\\gamma \\end{pmatrix}^{-1} = \\frac{1}{s(s+\\gamma)+\\omega^2} \\begin{pmatrix} s+\\gamma   1 \\\\ -\\omega^2   s \\end{pmatrix} = \\frac{1}{s^2+\\gamma s+\\omega^2} \\begin{pmatrix} s+\\gamma   1 \\\\ -\\omega^2   s \\end{pmatrix} $$\n$C^{\\mathrm{norm}}_{\\mathrm{Langevin}}(t)$ 的拉普拉斯变换是该矩阵的 (2,2) 元素：\n$$ \\mathcal{L}[C^{\\mathrm{norm}}_{\\mathrm{Langevin}}](s) = \\frac{s}{s^2+\\gamma s+\\omega^2} $$\n在 $s=\\alpha$ 处求值，我们有 $\\mathcal{L}[C^{\\mathrm{norm}}_{\\mathrm{Langevin}}](\\alpha) = \\frac{\\alpha}{\\alpha^2+\\gamma\\alpha+\\omega^2}$。\n\n**3. 最终计算**\n现在我们组合出 $F(\\alpha,\\gamma,\\omega)$ 的表达式：\n$$ F(\\alpha,\\gamma,\\omega) = \\frac{\\alpha}{\\alpha^2+\\gamma\\alpha+\\omega^2} - \\frac{\\alpha}{\\alpha^2+\\omega^2} $$\n为了得到单一的闭式表达式，我们合并分数：\n$$ F(\\alpha,\\gamma,\\omega) = \\frac{\\alpha(\\alpha^2+\\omega^2) - \\alpha(\\alpha^2+\\gamma\\alpha+\\omega^2)}{(\\alpha^2+\\gamma\\alpha+\\omega^2)(\\alpha^2+\\omega^2)} $$\n$$ F(\\alpha,\\gamma,\\omega) = \\frac{\\alpha^3+\\alpha\\omega^2 - \\alpha^3 - \\gamma\\alpha^2 - \\alpha\\omega^2}{(\\alpha^2+\\gamma\\alpha+\\omega^2)(\\alpha^2+\\omega^2)} $$\n$$ F(\\alpha,\\gamma,\\omega) = \\frac{-\\gamma\\alpha^2}{(\\alpha^2+\\gamma\\alpha+\\omega^2)(\\alpha^2+\\omega^2)} $$\n这就是动力学保真度泛函的最终闭式表达式。",
            "answer": "$$\\boxed{\\frac{-\\gamma \\alpha^{2}}{(\\alpha^{2} + \\gamma \\alpha + \\omega^{2})(\\alpha^{2} + \\omega^{2})}}$$"
        },
        {
            "introduction": "理论和实现之后，关键的一步是验证。无论使用何种恒温器，我们都必须确认它是否能正确地生成正则系综。本练习提供了一个动手编程任务，要求你实现一个统计检验（Kolmogorov-Smirnov 检验），以判断模拟的动能分布是否符合统计力学所预测的理论 $\\chi^2$ 分布 。",
            "id": "5274872",
            "problem": "您的任务是设计并实现一种统计分析，以验证生物分子动力学（MD）中通过恒温器进行的温度控制。在正则系综下的基本预期是，总动能的分布应与速度的麦克斯韦-玻尔兹曼分布一致，这意味着动能具有一个特定的分布。您的程序必须从第一性原理出发构建验证过程，并为每个测试用例生成最终决策，判断恒温器是否与理论预期的分布一致。\n\n从以下基本依据开始：\n- 温度为 $T$ 的正则系综意味着每个笛卡尔速度分量 $v_i$ 都独立地服从均值为零、方差由能量均分原理设定的高斯分布。\n- 对于一个具有 $f$ 个二次自由度的系统，总动能 $K$ 是所有独立二次模式的总和。\n\n为每个测试用例按如下方式定义测量的动能值：\n- 设 $f$ 为自由度数，$T$ 为恒温器设定温度（单位：开尔文），$k_{\\mathrm{B}}$ 为玻尔兹曼常数（单位：$\\mathrm{J/K}$），$n$ 为样本数量，$s$ 为一个无量纲的缩放因子，代表动能的测量或恒温器校准因子。为保证可复现性，通过以下步骤构建一个确定性的合成“测量”数据集 $\\{K_i\\}_{i=1}^n$：首先，在累积概率 $p_i = \\frac{i - 0.5}{n}$ 处，构建一个自由度为 $f$ 的卡方分布的无量纲分位数集 $\\{Q_i\\}_{i=1}^n$；然后，通过 $K_i = \\frac{1}{2} k_{\\mathrm{B}} T \\, s \\, Q_i$ 将它们映射为动能。所有的 $K_i$ 必须以焦耳为单位表示。\n\n为验证恒温器：\n- 通过 $X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$ 将每个 $K_i$ 归一化为无量纲变量 $X_i$。\n- 在正则系综所暗示的原假设下，$X_i$ 的分布应与自由度为 $f$ 的理论卡方分布相匹配。\n- 执行单样本柯尔莫哥洛夫-斯米尔诺夫（KS）检验，比较 $\\{X_i\\}$ 的经验分布与自由度为 $f$ 的理论卡方累积分布函数。设检验的显著性水平为 $\\alpha = 0.01$（以小数形式表示）。如果p值 $p \\ge \\alpha$，则判定为“通过”（pass），否则判定为“失败”（fail）。\n\n使用精确值 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$。确保任何以物理单位表示的量都与这些单位保持一致处理。本问题不使用角度。百分比（如有）必须表示为小数。\n\n实现您的解决方案，为以下参数集的测试套件生成结果：\n- 案例 A（理想情况，大 $f$）：$f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.0$。\n- 案例 B（温控器校准不准，大 $f$）：$f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.1$。\n- 案例 C（边界情况，小 $f$）：$f = 2$, $T = 300\\,\\mathrm{K}$, $n = 200$, $s = 1.0$。\n- 案例 D（边缘案例，带偏差的小样本）：$f = 60$, $T = 300\\,\\mathrm{K}$, $n = 50$, $s = 1.2$。\n\n您的程序应生成单行输出，其中包含按顺序排列的测试套件的布尔通过/失败结果，格式为方括号内以逗号分隔的列表，例如：“[True,False,True,False]”。",
            "solution": "该问题要求设计并实现一个用于生物分子模拟中温度控制的统计验证程序。该验证基于正则系综中系统的统计力学基本原理。解决方案涉及生成合成的动能数据，然后使用单样本柯尔莫哥洛夫-斯米尔诺夫（KS）检验来评估其与理论分布的一致性。\n\n**理论基础**\n\n在统计力学中，一个与恒定绝对温度 $T$ 的热浴处于热平衡的系统由正则系综描述。该系综的一个关键预测是粒子速度的分布，由麦克斯韦-玻尔兹曼分布所支配。对于一个经典系统，每个二次自由度（例如，动能项 $\\frac{1}{2}mv_x^2$ 或势能项 $\\frac{1}{2}kx^2$）的平均能量为 $\\frac{1}{2}k_{\\mathrm{B}}T$，这个结果被称为能量均分定理，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n一个具有 $f$ 个独立二次自由度的系统的总动能 $K$ 是这些模式能量的总和。每个模式的能量，当按 $\\frac{1}{k_{\\mathrm{B}}T}$ 进行缩放时，其贡献项是一个标准正态变量的平方。代表单个模式贡献的变量（我们称之为 $Z$）服从自由度为1的卡方分布，即 $\\chi^2(1)$。\n\n因此，定义为变量 $X = \\frac{2K}{k_{\\mathrm{B}}T}$ 的无量纲总动能是 $f$ 个独立的 $\\chi^2(1)$ 变量之和。根据卡方分布的定义，这个和服从自由度为 $f$ 的卡方分布，记为 $\\chi^2(f)$。\n\n这一理论结果构成了我们统计检验的原假设 ($H_0$)：\n$H_0$：观测到的、归一化的动能数据 $\\{X_i\\}$ 的分布是自由度为 $f$ 的卡方分布。\n\n**数据生成与检验程序**\n\n问题指定了一种确定性方法，用于为具有 $f$ 个自由度、温度为 $T$ 的系统生成包含 $n$ 个样本的合成数据集 $\\{K_i\\}_{i=1}^n$。该方法使用一个无量纲缩放因子 $s$ 来模拟一个完美校准的恒温器 ($s=1.0$) 或一个校准不准的恒温器 ($s \\neq 1.0$)。\n\n1.  **分位数生成**：首先使用公式 $p_i = \\frac{i - 0.5}{n}$（其中 $i=1, 2, \\dots, n$）生成一组 $n$ 个累积概率 $\\{p_i\\}$。这种概率选择方式可以对称地对分布的分位数进行抽样。\n\n2.  **卡方分位数**：对于每个概率 $p_i$，计算理论 $\\chi^2(f)$ 分布对应的分位数 $Q_i$。分位数 $Q_i$ 是这样一个值，使得 $\\chi^2(f)$ 分布在 $Q_i$ 处的累积分布函数（CDF）等于 $p_i$。\n\n3.  **动能合成**：“测量”的动能 $\\{K_i\\}$ 接着通过以下关系合成：\n    $$K_i = \\frac{1}{2} k_{\\mathrm{B}} T s Q_i$$\n    在这里，$s$ 充当校准因子。如果 $s=1.0$，则期望动能与温度之间的关系被完美满足。如果 $s > 1.0$ 或 $s  1.0$，则分别意味着对温度的系统性高估或低估。\n\n4.  **归一化**：为了执行统计检验，每个合成的动能值 $K_i$ 根据我们的理论预期进行归一化：\n    $$X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$$\n    将上一步中 $K_i$ 的表达式代入，我们发现检验样本与理论分位数之间的直接关系：\n    $$X_i = \\frac{2}{k_{\\mathrm{B}} T} \\left( \\frac{1}{2} k_{\\mathrm{B}} T s Q_i \\right) = s Q_i$$\n    这揭示了待检验的样本 $\\{X_i\\}$ 只是由因子 $s$ 缩放后的一组理论分位数 $\\{Q_i\\}$。\n\n5.  **柯尔莫哥洛夫-斯米尔诺夫检验**：对生成的样本 $\\{X_i\\}$ 应用单样本 KS 检验。此检验比较样本的经验累积分布函数（ECDF）$\\hat{F}_n(x)$ 与 $\\chi^2(f)$ 分布的理论 CDF $F_{\\chi^2(f)}(x)$。检验统计量是这两个函数在 $x$ 的整个范围内的最大绝对差。根据该统计量计算出一个 p 值，它代表在原假设为真的前提下，观测到至少与测量到的偏差一样大的偏差的概率。\n\n6.  **决策**：如果计算出的 p 值 $p$ 大于或等于指定的显著性水平 $\\alpha = 0.01$，则认为恒温器与正则系综一致（“通过”）。否则，为“失败”。高 p 值 ($p \\ge \\alpha$) 表明观测数据与原假设一致，而低 p 值 ($p  \\alpha$) 则提供了拒绝原假设的证据。\n\n对于 $s=1.0$ 的情况，样本 $\\{X_i\\}$ 与 $\\{Q_i\\}$ 相同，根据构造，它应紧密遵循 $\\chi^2(f)$ 分布，从而导致较大的 p 值和“通过”的决策。对于 $s \\neq 1.0$ 的情况，样本分布是理论分布的缩放版本，KS 检验预期会检测到这种差异，从而导致较低的 p 值和“失败”的决策，特别是当样本量 $n$ 足够大时。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Validates thermostat performance in biomolecular simulations by testing\n    if synthetic kinetic energy data conforms to the theoretical chi-square\n    distribution, as predicted by the canonical ensemble.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (f, T, n, s)\n    # f: degrees of freedom\n    # T: temperature (K)\n    # n: sample count\n    # s: dimensionless scaling factor\n    test_cases = [\n        (300, 310.0, 1000, 1.0),  # Case A: happy path, large f\n        (300, 310.0, 1000, 1.1),  # Case B: miscalibrated temperature, large f\n        (2, 300.0, 200, 1.0),    # Case C: boundary, small f\n        (60, 300.0, 50, 1.2),     # Case D: edge case, small sample with deviation\n    ]\n\n    # Physical and statistical constants\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    alpha = 0.01        # Significance level for the KS test\n\n    results = []\n    for f, T, n, s in test_cases:\n        # Step 1: Generate synthetic \"measured\" data\n        # Create a set of n cumulative probabilities\n        probabilities = (np.arange(1, n + 1) - 0.5) / n\n\n        # Generate the corresponding quantiles of the chi-square distribution\n        # with f degrees of freedom. These are the Q_i values.\n        # ppf is the Percent Point Function (inverse of CDF).\n        q_i = stats.chi2.ppf(probabilities, df=f)\n\n        # According to the problem statement, K_i = 0.5 * k_B * T * s * q_i.\n        # The validation requires normalizing K_i to X_i = 2 * K_i / (k_B * T).\n        # Substituting K_i, we get X_i = s * q_i.\n        # This is more numerically stable than calculating K_i explicitly.\n        x_samples = s * q_i\n        \n        # Step 2: Perform the one-sample Kolmogorov-Smirnov test\n        # We test the sample `x_samples` against the theoretical chi-square\n        # distribution with `f` degrees of freedom.\n        # `stats.chi2.cdf` is the cumulative distribution function for chi-square.\n        # `args=(f,)` passes the degrees of freedom to the cdf.\n        ks_result = stats.ks_1samp(x_samples, stats.chi2.cdf, args=(f,))\n        \n        p_value = ks_result.pvalue\n\n        # Step 3: Make a decision based on the p-value\n        # \"pass\" if p-value is greater than or equal to the significance level.\n        # Python's boolean True/False corresponds to pass/fail.\n        decision = (p_value >= alpha)\n        results.append(decision)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts boolean True/False to \"True\"/\"False\" strings.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}