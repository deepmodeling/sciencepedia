{
    "hands_on_practices": [
        {
            "introduction": "One of the simplest and most intuitive methods for temperature control in molecular dynamics is the Berendsen thermostat, which guides the system's temperature towards a target value. It operates by rescaling particle velocities based on a first-order relaxation principle, mimicking a weak coupling to an external heat bath. This first exercise  is a fundamental practice in deriving the thermostat's velocity scaling factor from its underlying differential equation and applying it to a realistic simulation scenario, providing a concrete understanding of its implementation.",
            "id": "5274833",
            "problem": "Consider a constant-number, constant-volume Molecular Dynamics (MD) simulation of a biomolecular system with $N_f$ classical degrees of freedom, where temperature is controlled by a velocity-rescaling weak-coupling thermostat of the Berendsen type. The instantaneous kinetic temperature $T_{\\mathrm{inst}}$ is defined via equipartition as $T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$, where $K$ is the total kinetic energy and $k_B$ is the Boltzmann constant ($k_B$). At each MD time step, all velocities are scaled by a common factor $\\alpha$, and positions are advanced according to Newton’s equations of motion.\n\nAssume that the target temperature is $T_0$ and that the thermostat imposes a first-order relaxation of the kinetic temperature governed by the ordinary differential equation $\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$, where $\\tau_T$ is the thermostat time constant. Enforce consistency between the discrete velocity rescaling $v_i \\mapsto \\alpha v_i$ and a first-order forward-Euler integration of the relaxation equation for $T$ over one MD time step of duration $\\Delta t$.\n\nStarting from the equipartition-based definition of $T_{\\mathrm{inst}}$ and the effect of velocity rescaling on kinetic energy, derive the expression for $\\alpha$ that ensures the one-step discrete update of $T_{\\mathrm{inst}}$ matches the forward-Euler discretization of the relaxation equation. Then, for a single rescaling step with $\\tau_T = 0.1\\,\\mathrm{ps}$, $\\Delta t = 2\\,\\mathrm{fs}$, initial $T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$, and target $T_0 = 300\\,\\mathrm{K}$, compute $\\alpha$ and predict the new instantaneous temperature immediately after rescaling.\n\nRound your numerical results to four significant figures. Express the final temperature in $\\mathrm{K}$. Provide your final answer as a row matrix containing $\\alpha$ and the updated $T_{\\mathrm{inst}}$ after one step.",
            "solution": "The user has provided a well-defined problem from the field of computational statistical mechanics, specifically regarding temperature control in Molecular Dynamics (MD) simulations using a Berendsen thermostat.\n\n### Step 1: Extract Givens\n- System description: Constant-number, constant-volume MD simulation with $N_f$ classical degrees of freedom.\n- Temperature control method: Berendsen-type velocity-rescaling weak-coupling thermostat.\n- Definition of instantaneous temperature: $T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$, where $K$ is the total kinetic energy and $k_B$ is the Boltzmann constant.\n- Velocity update: At each time step, all velocities $v_i$ are scaled by a factor $\\alpha$, such that the new velocity is $v_i' = \\alpha v_i$.\n- Target temperature: $T_0$.\n- Relaxation dynamics: The thermostat imposes a first-order relaxation of the kinetic temperature $T$ according to the ordinary differential equation (ODE) $\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$, where $\\tau_T$ is the thermostat time constant.\n- Time step duration: $\\Delta t$.\n- Consistency requirement: The discrete velocity rescaling must be consistent with a first-order forward-Euler integration of the temperature relaxation ODE over one time step $\\Delta t$.\n- Numerical values for calculation:\n  - Time constant, $\\tau_T = 0.1\\,\\mathrm{ps}$.\n  - Time step, $\\Delta t = 2\\,\\mathrm{fs}$.\n  - Initial instantaneous temperature, $T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$.\n  - Target temperature, $T_0 = 300\\,\\mathrm{K}$.\n- Required output:\n  1. An analytical expression for the scaling factor $\\alpha$.\n  2. The numerical value of $\\alpha$ and the new instantaneous temperature after one rescaling step, with results rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing the standard implementation of the Berendsen thermostat, a common algorithm in molecular simulations. The underlying principles—the equipartition theorem and first-order kinetics—are well-established. The problem is well-posed, providing all necessary definitions, equations, and parameters to derive a unique solution. The language is objective and precise. All provided numerical values are physically realistic for a biomolecular simulation. The problem is therefore deemed **valid**.\n\n### Step 3: Derivation and Calculation\n\n#### Part 1: Derivation of the Scaling Factor $\\alpha$\n\nWe are tasked with relating two different views of the temperature change over a single MD time step, $\\Delta t$.\n\nFirst, consider the effect of velocity rescaling on the instantaneous temperature. Let $T$ be the instantaneous temperature at the beginning of the time step. By definition, $T = \\frac{2K}{N_f k_B}$, where $K$ is the total kinetic energy of the system. The kinetic energy is given by $K = \\sum_i \\frac{1}{2} m_i v_i^2$.\n\nThe velocities are rescaled by a factor $\\alpha$, so the new velocities are $v_i' = \\alpha v_i$. The new kinetic energy, $K'$, is:\n$$K' = \\sum_i \\frac{1}{2} m_i (v_i')^2 = \\sum_i \\frac{1}{2} m_i (\\alpha v_i)^2 = \\alpha^2 \\left( \\sum_i \\frac{1}{2} m_i v_i^2 \\right) = \\alpha^2 K$$\nThe new instantaneous temperature, $T'$, is related to the new kinetic energy $K'$:\n$$T' = \\frac{2K'}{N_f k_B} = \\frac{2(\\alpha^2 K)}{N_f k_B} = \\alpha^2 \\left( \\frac{2K}{N_f k_B} \\right)$$\nThus, the temperature change due to velocity rescaling is:\n$$T' = \\alpha^2 T$$\n\nSecond, consider the change in temperature dictated by the relaxation equation, $\\frac{dT}{dt} = \\frac{1}{\\tau_T}(T_0 - T)$. We discretize this ODE using a first-order forward-Euler scheme over a time interval $\\Delta t$. The derivative $\\frac{dT}{dt}$ is approximated as $\\frac{T' - T}{\\Delta t}$, where $T'$ is the temperature at the end of the time step.\n$$\\frac{T' - T}{\\Delta t} \\approx \\frac{1}{\\tau_T}(T_0 - T)$$\nSolving for the new temperature $T'$ gives:\n$$T' \\approx T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n\nTo ensure consistency, we equate the two expressions for the new temperature $T'$:\n$$\\alpha^2 T = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\nTo solve for $\\alpha$, we divide by $T$ (assuming $T \\neq 0$, which is a valid physical assumption for a system at finite temperature):\n$$\\alpha^2 = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0 - T}{T}\\right) = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)$$\nTaking the positive square root (as $\\alpha$ is a scaling factor, typically positive to preserve the direction of velocities) yields the final expression for $\\alpha$:\n$$\\alpha = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)}$$\nThis completes the derivation.\n\n#### Part 2: Numerical Calculation\n\nWe are given the following values:\n- $\\tau_T = 0.1\\,\\mathrm{ps} = 0.1 \\times 10^{-12}\\,\\mathrm{s}$\n- $\\Delta t = 2\\,\\mathrm{fs} = 2 \\times 10^{-15}\\,\\mathrm{s}$\n- Initial temperature, $T = T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$\n- Target temperature, $T_0 = 300\\,\\mathrm{K}$\n\nFirst, we compute the dimensionless ratio $\\frac{\\Delta t}{\\tau_T}$:\n$$\\frac{\\Delta t}{\\tau_T} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{0.1 \\times 10^{-12}\\,\\mathrm{s}} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{1 \\times 10^{-13}\\,\\mathrm{s}} = 2 \\times 10^{-2} = 0.02$$\nNow, substitute this and the temperatures into the expression for $\\alpha^2$:\n$$\\alpha^2 = 1 + 0.02 \\left(\\frac{300\\,\\mathrm{K}}{320\\,\\mathrm{K}} - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02 \\left(0.9375 - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02(-0.0625)$$\n$$\\alpha^2 = 1 - 0.00125$$\n$$\\alpha^2 = 0.99875$$\nNow we calculate $\\alpha$ by taking the square root:\n$$\\alpha = \\sqrt{0.99875} \\approx 0.999374811...$$\nRounding to four significant figures, we get:\n$$\\alpha \\approx 0.9994$$\n\nNext, we predict the new instantaneous temperature, $T'$, immediately after rescaling. We can use the forward-Euler expression for this calculation to avoid propagating rounding error from our calculated $\\alpha$.\n$$T' = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n$$T' = 320\\,\\mathrm{K} + 0.02(300\\,\\mathrm{K} - 320\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} + 0.02(-20\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} - 0.4\\,\\mathrm{K}$$\n$$T' = 319.6\\,\\mathrm{K}$$\nThis result already has four significant figures.\n\nThe two requested values are the scaling factor $\\alpha$ and the new instantaneous temperature $T'$.\n$\\alpha \\approx 0.9994$\n$T' = 319.6\\,\\mathrm{K}$\n\nWe present these results as a row matrix as requested.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.9994 & 319.6 \\end{pmatrix}}$$"
        },
        {
            "introduction": "While simple thermostats are useful, a more physically rigorous approach is the Langevin thermostat, which explicitly models the effects of a solvent or heat bath through stochastic friction and random forces. This method is built upon the fluctuation-dissipation theorem, ensuring a proper balance between energy dissipation and thermal fluctuations. This practice  challenges you to analyze the dynamics of a particle under this thermostat by deriving its velocity autocorrelation function, a key theoretical tool for connecting microscopic motions to transport properties.",
            "id": "3823602",
            "problem": "Consider a single point particle of mass $m$ in one spatial dimension, subject to a harmonic potential $U(x) = \\tfrac{1}{2} m \\omega_{0}^{2} x^{2}$ and coupled to a thermal bath through a Langevin thermostat. The particle obeys Newton’s second law with linear viscous damping and a random thermal force. Specifically, its dynamics are governed by\n$$\nm \\,\\ddot{x}(t) + m \\,\\gamma \\,\\dot{x}(t) + m \\,\\omega_{0}^{2} x(t) = \\eta(t),\n$$\nwhere $\\gamma > 0$ is the friction coefficient and $\\eta(t)$ is a stationary Gaussian white-noise force with zero mean and covariance\n$$\n\\langle \\eta(t) \\eta(t') \\rangle = 2 m \\gamma k_{B} T \\,\\delta(t-t'),\n$$\nwith $k_{B}$ the Boltzmann constant and $T$ the absolute temperature. Assume the underdamped regime $0 < \\gamma < 2 \\omega_{0}$, and that the initial conditions are sampled from the canonical equilibrium at temperature $T$, so that the stationary velocity variance satisfies equipartition, $\\langle v^{2} \\rangle = k_{B} T / m$, and $\\langle x \\, v \\rangle = 0$ at equilibrium.\n\nStarting from these fundamental laws and definitions, derive the velocity autocorrelation function $C_{vv}(t) = \\langle v(t) v(0) \\rangle$ for $t \\ge 0$. Then, using the Green–Kubo relation for the self-diffusion coefficient,\n$$\nD = \\int_{0}^{\\infty} \\langle v(t) v(0) \\rangle \\, dt,\n$$\nverify the fluctuation–dissipation theorem (FDT) by showing that $D$ is consistent with the bounded dynamics in the harmonic potential. Express your final answer as a single closed-form analytic expression for $C_{vv}(t)$ in terms of $m$, $\\gamma$, $\\omega_{0}$, $k_{B}$, $T$, and $t$. No numerical evaluation or rounding is required, and no units need to be attached to the final boxed expression.",
            "solution": "The dynamics are governed by the second-order linear stochastic differential equation\n$$\nm \\,\\ddot{x}(t) + m \\,\\gamma \\,\\dot{x}(t) + m \\,\\omega_{0}^{2} x(t) = \\eta(t),\n$$\nwith $\\langle \\eta(t) \\rangle = 0$ and $\\langle \\eta(t) \\eta(t') \\rangle = 2 m \\gamma k_{B} T \\,\\delta(t-t')$. Define $\\omega_{0} > 0$ and assume $0 < \\gamma < 2 \\omega_{0}$ so the oscillator is underdamped. Introduce the velocity $v(t) = \\dot{x}(t)$. The homogeneous (noise-free) equation is\n$$\n\\ddot{x}(t) + \\gamma \\,\\dot{x}(t) + \\omega_{0}^{2} x(t) = 0.\n$$\nThe characteristic polynomial is $r^{2} + \\gamma r + \\omega_{0}^{2} = 0$, with roots $r_{\\pm} = -\\tfrac{\\gamma}{2} \\pm i \\Omega$, where\n$$\n\\Omega \\equiv \\sqrt{\\omega_{0}^{2} - \\frac{\\gamma^{2}}{4}}.\n$$\nThe homogeneous solution is\n$$\nx_{\\mathrm{h}}(t) = \\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ A \\cos(\\Omega t) + B \\sin(\\Omega t) \\right].\n$$\nImposing $x_{\\mathrm{h}}(0) = x(0)$ and $\\dot{x}_{\\mathrm{h}}(0) = v(0)$ gives $A = x(0)$ and $B = \\dfrac{v(0) + \\tfrac{\\gamma}{2} x(0)}{\\Omega}$. Therefore,\n$$\nx_{\\mathrm{h}}(t) = \\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ x(0) \\cos(\\Omega t) + \\frac{v(0)}{\\Omega} \\sin(\\Omega t) + \\frac{\\gamma}{2 \\Omega} x(0) \\sin(\\Omega t) \\right].\n$$\nDifferentiating with respect to time yields the homogeneous velocity,\n\\begin{align*}\nv_{\\mathrm{h}}(t) &= \\dot{x}_{\\mathrm{h}}(t) \\\\\n&= \\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ v(0) \\left( \\cos(\\Omega t) - \\frac{\\gamma}{2 \\Omega} \\sin(\\Omega t) \\right) - x(0) \\frac{\\omega_{0}^{2}}{\\Omega} \\sin(\\Omega t) \\right].\n\\end{align*}\nThe full (stochastic) solution for $v(t)$ can be written as the homogeneous part plus a particular part driven by the noise,\n$$\nv(t) = v_{\\mathrm{h}}(t) + v_{\\eta}(t),\n$$\nwhere $v_{\\eta}(t)$ is a linear functional of $\\eta(s)$ for $0 \\le s \\le t$. Since the noise $\\eta(s)$ for $s > 0$ is independent of the initial conditions $(x(0), v(0))$ drawn from equilibrium, it follows that $\\langle v_{\\eta}(t) v(0) \\rangle = 0$.\n\nTherefore, the velocity autocorrelation function is determined solely by the homogeneous part,\n\\begin{align*}\nC_{vv}(t) &= \\langle v(t) v(0) \\rangle = \\langle v_{\\mathrm{h}}(t) v(0) \\rangle \\\\\n&= \\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left\\langle \\left[ v(0) \\left( \\cos(\\Omega t) - \\frac{\\gamma}{2 \\Omega} \\sin(\\Omega t) \\right) - x(0) \\frac{\\omega_{0}^{2}}{\\Omega} \\sin(\\Omega t) \\right] v(0) \\right\\rangle.\n\\end{align*}\nUsing equilibrium averages for a harmonic oscillator with a Langevin thermostat at temperature $T$, we have $\\langle v(0)^{2} \\rangle = k_{B} T / m$ (from equipartition of energy) and $\\langle x(0) v(0) \\rangle = 0$ (no cross-correlation between position and velocity in the canonical ensemble). Hence,\n$$\nC_{vv}(t) = \\frac{k_{B} T}{m} \\,\\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ \\cos(\\Omega t) - \\frac{\\gamma}{2 \\Omega} \\sin(\\Omega t) \\right].\n$$\n\nTo verify the fluctuation–dissipation theorem via the Green–Kubo relation for the self-diffusion coefficient, compute\n\\begin{align*}\nD &= \\int_{0}^{\\infty} C_{vv}(t) \\, dt \\\\\n&= \\frac{k_{B} T}{m} \\int_{0}^{\\infty} \\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ \\cos(\\Omega t) - \\frac{\\gamma}{2 \\Omega} \\sin(\\Omega t) \\right] dt.\n\\end{align*}\nDefine $\\alpha \\equiv \\gamma / 2$ and $\\beta \\equiv \\Omega$. The standard integrals for $\\alpha > 0$ are\n$$\n\\int_{0}^{\\infty} \\exp(-\\alpha t) \\cos(\\beta t) \\, dt = \\frac{\\alpha}{\\alpha^{2} + \\beta^{2}}, \\quad\n\\int_{0}^{\\infty} \\exp(-\\alpha t) \\sin(\\beta t) \\, dt = \\frac{\\beta}{\\alpha^{2} + \\beta^{2}}.\n$$\nApplying these,\n\\begin{align*}\nD &= \\frac{k_{B} T}{m} \\left[ \\frac{\\alpha}{\\alpha^{2} + \\beta^{2}} - \\frac{\\gamma}{2 \\Omega} \\cdot \\frac{\\beta}{\\alpha^{2} + \\beta^{2}} \\right] \\\\\n&= \\frac{k_{B} T}{m} \\cdot \\frac{1}{\\alpha^{2} + \\beta^{2}} \\left[ \\alpha - \\frac{\\gamma}{2 \\Omega} \\beta \\right].\n\\end{align*}\nSubstituting $\\alpha = \\gamma / 2$ and $\\beta = \\Omega$ shows the bracket is exactly zero:\n$$\n\\alpha - \\frac{\\gamma}{2 \\Omega} \\beta = \\frac{\\gamma}{2} - \\frac{\\gamma}{2 \\Omega} \\Omega = 0,\n$$\nso\n$$\nD = 0.\n$$\nThis result is physically consistent with the bounded dynamics in a harmonic potential: the particle does not undergo unbounded diffusion, and the Green–Kubo relation recovers zero self-diffusion. The fluctuation–dissipation theorem is built into the Langevin thermostat through the noise covariance $\\langle \\eta(t) \\eta(t') \\rangle = 2 m \\gamma k_{B} T \\,\\delta(t-t')$, which ensures the correct equilibrium variance $\\langle v^{2} \\rangle = k_{B} T / m$ and yields the above $C_{vv}(t)$ that integrates to zero, as required for a confined system.\n\nTherefore, the closed-form velocity autocorrelation function in the underdamped regime is\n$$\nC_{vv}(t) = \\frac{k_{B} T}{m} \\,\\exp\\!\\left(-\\frac{\\gamma t}{2}\\right) \\left[ \\cos\\!\\left(\\sqrt{\\omega_{0}^{2} - \\frac{\\gamma^{2}}{4}}\\, t\\right) - \\frac{\\gamma}{2 \\sqrt{\\omega_{0}^{2} - \\frac{\\gamma^{2}}{4}}} \\,\\sin\\!\\left(\\sqrt{\\omega_{0}^{2} - \\frac{\\gamma^{2}}{4}}\\, t\\right) \\right].\n$$",
            "answer": "$$\\boxed{\\frac{k_{B} T}{m}\\,\\exp\\!\\left(-\\frac{\\gamma t}{2}\\right)\\left[\\cos\\!\\left(\\sqrt{\\omega_{0}^{2}-\\frac{\\gamma^{2}}{4}}\\,t\\right)-\\frac{\\gamma}{2\\sqrt{\\omega_{0}^{2}-\\frac{\\gamma^{2}}{4}}}\\,\\sin\\!\\left(\\sqrt{\\omega_{0}^{2}-\\frac{\\gamma^{2}}{4}}\\,t\\right)\\right]}$$"
        },
        {
            "introduction": "A crucial step in any simulation is to validate that the chosen algorithms are performing correctly. For a thermostat, this means verifying that it generates the proper statistical ensemble, specifically the canonical (NVT) ensemble. This practice  moves from implementation to validation, guiding you to design a statistical test based on first principles. You will confirm whether simulated kinetic energy data follows the theoretically predicted chi-square distribution, a critical quality control check in computational research.",
            "id": "5274872",
            "problem": "You are tasked with designing and implementing a statistical analysis to validate temperature control via thermostats in biomolecular Molecular Dynamics (MD). The fundamental expectation under the canonical ensemble is that the distribution of total kinetic energy should be consistent with the Maxwell–Boltzmann distribution of velocities, which implies a specific distribution for kinetic energy. Your program must construct the validation from first principles and produce a final decision for each test case on whether the thermostat is consistent with the theoretically expected distribution.\n\nBegin from the following fundamental bases:\n- The canonical ensemble at temperature $T$ implies that each Cartesian velocity component $v_i$ is independently distributed as a Gaussian with zero mean and variance set by the equipartition principle.\n- For a system with $f$ quadratic degrees of freedom, the total kinetic energy $K$ is the sum over all independent quadratic modes.\n\nDefine the measured kinetic energy values as follows for each test case:\n- Let $f$ be the number of degrees of freedom, $T$ be the thermostat set temperature in Kelvin, $k_{\\mathrm{B}}$ be the Boltzmann constant in $\\mathrm{J/K}$, $n$ be the sample count, and $s$ be a dimensionless scaling factor that represents a measurement or thermostat calibration factor for the kinetic energy. For reproducibility, construct a deterministic synthetic \"measured\" set $\\{K_i\\}_{i=1}^n$ by first forming a set of dimensionless quantiles $\\{Q_i\\}_{i=1}^n$ of the chi-square distribution with $f$ degrees of freedom at cumulative probabilities $p_i = \\frac{i - 0.5}{n}$, then map them to kinetic energies by $K_i = \\frac{1}{2} k_{\\mathrm{B}} T \\, s \\, Q_i$. All $K_i$ must be expressed in Joules.\n\nTo validate the thermostat:\n- Normalize each $K_i$ to the dimensionless variable $X_i$ via $X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$.\n- Under the null hypothesis implied by the canonical ensemble, the distribution of $X_i$ should match the theoretical chi-square distribution with $f$ degrees of freedom.\n- Perform a one-sample Kolmogorov–Smirnov (KS) test comparing the empirical distribution of $\\{X_i\\}$ to the theoretical chi-square cumulative distribution function with $f$ degrees of freedom. Let the test significance level be $\\alpha = 0.01$ (expressed as a decimal). Decide \"pass\" if the p-value $p \\ge \\alpha$ and \"fail\" otherwise.\n\nUse the exact value $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$. Ensure that any quantity expressed in physical units is handled consistently with these units. Angles are not used in this problem. Percentages (if any) must be expressed as decimals.\n\nImplement your solution to produce results for the following test suite of parameter sets:\n- Case A (happy path, large $f$): $f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.0$.\n- Case B (miscalibrated temperature, large $f$): $f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.1$.\n- Case C (boundary, small $f$): $f = 2$, $T = 300\\,\\mathrm{K}$, $n = 200$, $s = 1.0$.\n- Case D (edge case, small sample with deviation): $f = 60$, $T = 300\\,\\mathrm{K}$, $n = 50$, $s = 1.2$.\n\nYour program should produce a single line of output containing the boolean pass/fail results for the test suite in order, as a comma-separated list enclosed in square brackets, for example: \"[True,False,True,False]\".",
            "solution": "The problem requires the design and implementation of a statistical validation procedure for temperature control in biomolecular simulations. The validation is based on the fundamental principles of statistical mechanics for a system in the canonical ensemble. The solution involves generating synthetic kinetic energy data and then using the one-sample Kolmogorov-Smirnov (KS) test to assess its consistency with the theoretical distribution.\n\n**Theoretical Foundation**\n\nIn statistical mechanics, a system in thermal equilibrium with a heat bath at a constant absolute temperature $T$ is described by the canonical ensemble. A key prediction of this ensemble is the distribution of particle velocities, governed by the Maxwell-Boltzmann distribution. For a classical system, each quadratic degree of freedom (e.g., kinetic energy term $\\frac{1}{2}mv_x^2$ or potential energy term $\\frac{1}{2}kx^2$) has an average energy of $\\frac{1}{2}k_{\\mathrm{B}}T$, a result known as the equipartition theorem, where $k_{\\mathrm{B}}$ is the Boltzmann constant.\n\nThe total kinetic energy $K$ of a system with $f$ independent quadratic degrees of freedom is the sum of the energies from these modes. Each mode's energy, when scaled by $\\frac{1}{k_{\\mathrm{B}}T}$, contributes a term that is the square of a standard normal variable. The variable representing the contribution from a single mode, let's call it $Z$, is distributed as a chi-square distribution with one degree of freedom, $\\chi^2(1)$.\n\nThus, the dimensionless total kinetic energy, defined as the variable $X = \\frac{2K}{k_{\\mathrm{B}}T}$, is the sum of $f$ independent $\\chi^2(1)$ variables. By the definition of the chi-square distribution, this sum follows a chi-square distribution with $f$ degrees of freedom, denoted as $\\chi^2(f)$.\n\nThis theoretical result forms the null hypothesis ($H_0$) for our statistical test:\n$H_0$: The distribution of the observed, normalized kinetic energy data, $\\{X_i\\}$, is the chi-square distribution with $f$ degrees of freedom.\n\n**Data Generation and Test Procedure**\n\nThe problem specifies a deterministic method to generate a synthetic dataset $\\{K_i\\}_{i=1}^n$ for a system with $f$ degrees of freedom at temperature $T$, with $n$ samples. This method uses a dimensionless scaling factor $s$ to simulate either a perfectly calibrated thermostat ($s=1.0$) or a miscalibrated one ($s \\neq 1.0$).\n\n1.  **Quantile Generation**: A set of $n$ cumulative probabilities $\\{p_i\\}$ is first generated using the formula $p_i = \\frac{i - 0.5}{n}$ for $i=1, 2, \\dots, n$. This choice of probabilities symmetrically samples the distribution's quantiles.\n\n2.  **Chi-Square Quantiles**: For each probability $p_i$, the corresponding quantile $Q_i$ of the theoretical $\\chi^2(f)$ distribution is calculated. The quantile $Q_i$ is the value such that the cumulative distribution function (CDF) of the $\\chi^2(f)$ distribution at $Q_i$ is equal to $p_i$.\n\n3.  **Kinetic Energy Synthesis**: The \"measured\" kinetic energies $\\{K_i\\}$ are then synthesized using the relation:\n    $$K_i = \\frac{1}{2} k_{\\mathrm{B}} T s Q_i$$\n    Here, $s$ acts as a calibration factor. If $s=1.0$, the relationship between the expected kinetic energy and temperature is perfectly met. If $s > 1.0$ or $s < 1.0$, it implies a systematic over- or under-estimation of temperature, respectively.\n\n4.  **Normalization**: To perform the statistical test, each synthetic kinetic energy value $K_i$ is normalized according to our theoretical expectation:\n    $$X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$$\n    Substituting the expression for $K_i$ from the previous step, we find the direct relationship between the test sample and the theoretical quantiles:\n    $$X_i = \\frac{2}{k_{\\mathrm{B}} T} \\left( \\frac{1}{2} k_{\\mathrm{B}} T s Q_i \\right) = s Q_i$$\n    This reveals that the sample $\\{X_i\\}$ to be tested is simply the set of theoretical quantiles $\\{Q_i\\}$ scaled by the factor $s$.\n\n5.  **Kolmogorov-Smirnov Test**: The one-sample KS test is applied to the generated sample $\\{X_i\\}$. This test compares the empirical cumulative distribution function (ECDF) of the sample, $\\hat{F}_n(x)$, with the theoretical CDF of the $\\chi^2(f)$ distribution, $F_{\\chi^2(f)}(x)$. The test statistic is the maximum absolute difference between these two functions over the entire range of $x$. A p-value is computed from this statistic, which represents the probability of observing a deviation at least as large as the one measured, assuming the null hypothesis is true.\n\n6.  **Decision**: The thermostat is deemed consistent with the canonical ensemble (\"pass\") if the computed p-value $p$ is greater than or equal to the specified significance level $\\alpha = 0.01$. Otherwise, it is a \"fail\". A high p-value ($p \\ge \\alpha$) suggests that the observed data is consistent with the null hypothesis, while a low p-value ($p < \\alpha$) provides evidence to reject it.\n\nFor cases where $s=1.0$, the sample $\\{X_i\\}$ is identical to $\\{Q_i\\}$, which by construction should closely follow the $\\chi^2(f)$ distribution, leading to a large p-value and a \"pass\" decision. For cases where $s \\neq 1.0$, the sample distribution is a scaled version of the theoretical one, and the KS test is expected to detect this discrepancy, resulting in a low p-value and a \"fail\" decision, especially for a sufficiently large sample size $n$.",
            "answer": "[True,False,True,False]"
        }
    ]
}