{
    "hands_on_practices": [
        {
            "introduction": "经典系统的多数正则系综蒙特卡洛模拟通过只在构型空间（位置）进行采样，而忽略了动量，从而简化了问题。这种做法基于一个关于系统哈密顿量的关键假设。本练习旨在挑战您严格辨别这种简化在何种条件下是精确的，以及在何种条件下会失效，这是正确应用蒙特卡洛方法的基石。",
            "id": "3782936",
            "problem": "一个包含 $N$ 个点状粒子、固定体积为 $V$、温度为 $T$ 的经典多粒子系统在正则系综（粒子数 $N$、体积 $V$、温度 $T$，通常简写为 NVT）中建模。该系统由位置 $\\mathbf{r} \\in \\mathbb{R}^{3N}$ 和动量 $\\mathbf{p} \\in \\mathbb{R}^{3N}$ 描述，其哈密顿量为 $H(\\mathbf{r},\\mathbf{p})$。正则概率密度为 $\\rho(\\mathbf{r},\\mathbf{p}) \\propto \\exp\\!\\left(-\\beta H(\\mathbf{r},\\mathbf{p})\\right)$，其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数。考虑一个只依赖于位置的可观测量 $A(\\mathbf{r})$。在实践中，正则系综中的蒙特卡洛（MC）采样通常只提议和接受/拒绝 $\\mathbf{r}$ 空间中的移动，而不对 $\\mathbf{p}$ 进行采样。\n\n从第一性原理出发，分析仅对位置进行采样何时能为 $A(\\mathbf{r})$ 得出正确的正则系综平均值，以及何时会失败。选择下面所有正确的陈述。\n\nA. 如果哈密顿量在具有恒定粒子质量的笛卡尔坐标系中是可分的，形式为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，且 $K(\\mathbf{p})$ 不依赖于 $\\mathbf{r}$，那么关于位置的边际分布满足 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，因此使用玻尔兹曼权重 $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ 的仅位置MC采样可以为任何 $A(\\mathbf{r})$ 得出精确的正则系综平均值。\n\nB. 当施加完整约束 $C(\\mathbf{r}) = \\mathbf{0}$（该约束定义了一个嵌入在笛卡尔空间中的低维构型流形）时，正确的位置边际分布仍然是在该流形上受限的 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，没有额外的测度因子；因此，仅基于 $\\Delta U(\\mathbf{r})$ 进行接受的朴素仅位置MC采样可以在受约束的流形上为任何 $A(\\mathbf{r})$ 得出精确的平均值。\n\nC. 在广义（曲线）坐标 $\\mathbf{q}$ 及其共轭动量 $\\mathbf{p}_q$ 中，动能通常呈二次型 $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{M}(\\mathbf{q})$ 是一个与位置相关的质量度规张量。动量积分在位置边际分布中产生一个与 $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ 成正比的因子。因此，使用权重 $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ 的朴素仅位置MC采样对于 $A(\\mathbf{q})$ 通常是有偏的，除非包含了正确的测度修正。\n\nD. 在经典哈密顿量中，通过最小耦合引入由矢量势 $\\mathbf{A}(\\mathbf{r})$ 表示的静态磁场，动能为 $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$。此时，对动量的高斯积分与 $\\mathbf{r}$ 无关，因为它只是 $\\mathbf{p}$ 的一个平移；因此，位置边际分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，并且仅位置MC采样可以为任何 $A(\\mathbf{r})$ 得出精确的平均值。\n\nE. 在低温下，量子效应会保留正则系综中位置和动量之间的经典可分离性，因此即使经典假设失效，仅位置MC采样对于任何 $A(\\mathbf{r})$ 仍然是精确的。\n\nF. 在多尺度粗粒化中，当用一个简化变量 $\\boldsymbol{\\xi}(\\mathbf{r})$ 替代完整坐标 $\\mathbf{r}$ 时，要通过仅位置MC采样对 $\\boldsymbol{\\xi}$ 的正则边际分布进行精确采样，要求有效势是与 $\\boldsymbol{\\xi}$ 相关的平均力势；仅仅用一个朴素的 $U_{\\text{CG}}(\\boldsymbol{\\xi})$ 替换 $U(\\mathbf{r})$ 而不考虑底层的测度，通常会导致对依赖于 $\\boldsymbol{\\xi}$ 的可观测量的平均值产生偏差。\n\n选择所有适用项。",
            "solution": "问题的核心是确定在何种条件下，一个仅依赖于位置的可观测量 $A(\\mathbf{r})$ 的正则系综平均值，可以通过一个只采样构型空间（位置 $\\mathbf{r}$）而不采样动量空间（$\\mathbf{p}$）的蒙特卡洛（MC）模拟来正确计算。\n\n从第一性原理出发，可观测量 $A(\\mathbf{r})$ 的正则系综平均值由完整的相空间积分给出：\n$$ \\langle A \\rangle = \\frac{\\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}}{\\iint \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}} $$\n其中 $\\beta = 1/(k_B T)$，积分遍及所有 $3N$ 个位置坐标和 $3N$ 个动量坐标。\n\n由于可观测量 $A$ 只依赖于 $\\mathbf{r}$，我们可以将分子重新排列为：\n$$ \\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p} = \\int A(\\mathbf{r}) \\left( \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} \\right) d\\mathbf{r} $$\n让我们通过对所有动量积分完整的相空间概率密度来定义位置的边际概率密度 $\\rho(\\mathbf{r})$：\n$$ \\rho(\\mathbf{r}) = C \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} $$\n其中 $C$ 是一个归一化常数。然后，系综平均值可以表示为仅对位置的积分：\n$$ \\langle A \\rangle = \\frac{\\int A(\\mathbf{r}) \\rho(\\mathbf{r}) \\, d\\mathbf{r}}{\\int \\rho(\\mathbf{r}) \\, d\\mathbf{r}} $$\n仅对位置进行MC模拟是有效的，前提是其平稳分布与这个正确的边际密度 $\\rho(\\mathbf{r})$ 成正比。一个“朴素”的仅位置MC模拟通常假设哈密顿量是可分的，形式为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，并使用 $\\exp(-\\beta U(\\mathbf{r}))$ 作为采样权重。这种方法的有效性取决于 $\\rho(\\mathbf{r})$ 是否确实与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比。这要求动量积分 $\\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p}$ 要么是一个常数，要么可以以保持与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比的方式被因子化。\n\n让我们基于这一原理来评估每个陈述。\n\n**A. 如果哈密顿量在具有恒定粒子质量的笛卡尔坐标系中是可分的，形式为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，且 $K(\\mathbf{p})$ 不依赖于 $\\mathbf{r}$，那么关于位置的边际分布满足 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，因此使用玻尔兹曼权重 $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ 的仅位置MC采样可以为任何 $A(\\mathbf{r})$ 得出精确的正则系综平均值。**\n\n在笛卡尔坐标系中，对于 $N$ 个质量为 $m_i$ 的粒子，动能为 $K(\\mathbf{p}) = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m_i}$。该项与位置 $\\mathbf{r}$ 无关。哈密顿量为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$。\n边际密度 $\\rho(\\mathbf{r})$ 为：\n$$ \\rho(\\mathbf{r}) \\propto \\int \\exp(-\\beta [U(\\mathbf{r}) + K(\\mathbf{p})]) \\, d\\mathbf{p} $$\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p} $$\n积分 $\\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p}$ 是一个关于动量的 $3N$ 维高斯积分。由于 $K(\\mathbf{p})$ 不依赖于 $\\mathbf{r}$，该积分的值是一个不依赖于 $\\mathbf{r}$ 的常数。\n$$ \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{p_{ix}^2+p_{iy}^2+p_{iz}^2}{2m_i}\\right) d\\mathbf{p} = \\prod_{i=1}^{N} \\left( \\int_{-\\infty}^{\\infty} e^{-\\beta p^2/(2m_i)} dp \\right)^3 = \\prod_{i=1}^{N} \\left( \\frac{2\\pi m_i}{\\beta} \\right)^{3/2} $$\n这个结果是一个常数。因此，$\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$。一个以与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比的概率采样状态的仅位置MC模拟，将正确地采样位置边际分布，并为任何 $A(\\mathbf{r})$ 得出精确的正则系综平均值。\n结论：**正确**。\n\n**B. 当施加完整约束 $C(\\mathbf{r}) = \\mathbf{0}$（该约束定义了一个嵌入在笛卡尔空间中的低维构型流形）时，正确的位置边际分布仍然是在该流形上受限的 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，没有额外的测度因子；因此，仅基于 $\\Delta U(\\mathbf{r})$ 进行接受的朴素仅位置MC采样可以在受约束的流形上为任何 $A(\\mathbf{r})$ 得出精确的平均值。**\n\n完整约束降低了构型空间的维度。设 $d$ 维流形由广义坐标 $\\mathbf{q} = (q_1, \\dots, q_d)$ 参数化。笛卡尔位置是这些坐标的函数，$\\mathbf{r} = \\mathbf{r}(\\mathbf{q})$。动能变为 $K = \\frac{1}{2} \\sum_k m_k \\dot{\\mathbf{r}}_k^2 = \\frac{1}{2} \\sum_{i,j} M_{ij}(\\mathbf{q}) \\dot{q}_i \\dot{q}_j$，其中 $\\mathbf{M}(\\mathbf{q})$ 是质量度规张量，其元素为 $M_{ij}(\\mathbf{q}) = \\sum_k m_k \\frac{\\partial \\mathbf{r}_k}{\\partial q_i} \\cdot \\frac{\\partial \\mathbf{r}_k}{\\partial q_j}$。通常，$\\mathbf{M}(\\mathbf{q})$ 是坐标 $\\mathbf{q}$ 的函数。在这些广义坐标下的哈密顿量是 $H(\\mathbf{q}, \\mathbf{p}_q) = U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{p}_q$ 是共轭动量。\n为了找到边际分布 $\\rho(\\mathbf{q})$，我们对 $\\mathbf{p}_q$ 积分：\n$$ \\rho(\\mathbf{q}) \\propto \\int \\exp(-\\beta [U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q]) \\, d\\mathbf{p}_q $$\n$$ \\rho(\\mathbf{q}) \\propto \\exp(-\\beta U(\\mathbf{q})) \\int \\exp(-\\frac{\\beta}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q) \\, d\\mathbf{p}_q $$\n该积分是关于 $\\mathbf{p}_q$ 的高斯积分。其值与 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 成正比。因此，正确的边际分布是：\n$$ \\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q})) $$\n项 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 是一个与位置相关的测度因子，源于约束流形的曲率。由于该因子通常不是常数，仅基于 $\\exp(-\\beta U(\\mathbf{q}))$ 的朴素MC采样将是不正确的。该陈述声称“没有额外的测度因子”，这是错误的。\n结论：**不正确**。\n\n**C. 在广义（曲线）坐标 $\\mathbf{q}$ 及其共轭动量 $\\mathbf{p}_q$ 中，动能通常呈二次型 $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{M}(\\mathbf{q})$ 是一个与位置相关的质量度规张量。动量积分在位置边际分布中产生一个与 $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ 成正比的因子。因此，使用权重 $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ 的朴素仅位置MC采样对于 $A(\\mathbf{q})$ 通常是有偏的，除非包含了正确的测度修正。**\n\n这个陈述准确地描述了为选项B所分析的情况。如上所述，当动能依赖于一个与位置相关的质量度规张量 $\\mathbf{M}(\\mathbf{q})$ 时，对动量 $\\mathbf{p}_q$ 的积分会产生一个与 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 成正比的因子。\n边际密度是 $\\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q}))$。MC模拟必须从此分布中采样。仅使用 $\\exp(-\\beta U(\\mathbf{q}))$ 作为权重会忽略几何因子 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$，并导致有偏采样，除非 $\\det(\\mathbf{M}(\\mathbf{q}))$ 恰好是常数，但这并非普遍情况。\n结论：**正确**。\n\n**D. 在经典哈密顿量中，通过最小耦合引入由矢量势 $\\mathbf{A}(\\mathbf{r})$ 表示的静态磁场，动能为 $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$。此时，对动量的高斯积分与 $\\mathbf{r}$ 无关，因为它只是 $\\mathbf{p}$ 的一个平移；因此，位置边际分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，并且仅位置MC采样可以为任何 $A(\\mathbf{r})$ 得出精确的平均值。**\n\n哈密顿量为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}$。位置边际密度为：\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}\\right) d\\mathbf{p} $$\n让我们分析动量积分。它可以分解为每个粒子 $i$ 的积分乘积。对于单个粒子，积分是关于其动量 $\\mathbf{p}_i$ 的：\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2\\right) d\\mathbf{p}_i $$\n我们进行变量替换 $\\mathbf{p}'_i = \\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i)$。微分体积元 $d\\mathbf{p}_i$ 变为 $d\\mathbf{p}'_i$，因为这个线性平移的雅可比行列式是 $1$。每个 $\\mathbf{p}_i$ 分量的积分限 $(-\\infty, \\infty)$ 对于 $\\mathbf{p}'_i$ 仍然是 $(-\\infty, \\infty)$。\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}'_i)^2\\right) d\\mathbf{p}'_i $$\n这是一个标准高斯积分，其值 $(2\\pi m_i/\\beta)^{3/2}$ 是一个不依赖于 $\\mathbf{r}_i$ 的常数，因此也不依赖于 $\\mathbf{A}(\\mathbf{r}_i)$。原本存在于高斯函数中心位移中的位置依赖性已被积分掉。完整的动量积分是这些常数的乘积，其本身也是一个不依赖于 $\\mathbf{r}$ 的常数。因此，$\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$。这是 Bohr-van Leeuwen 定理的一个体现，该定理指出经典统计力学无法解释抗磁性或顺磁性。仅位置MC采样仍然是精确的。\n结论：**正确**。\n\n**E. 在低温下，量子效应会保留正则系综中位置和动量之间的经典可分离性，因此即使经典假设失效，仅位置MC采样对于任何 $A(\\mathbf{r})$ 仍然是精确的。**\n\n在量子力学中，位置 $\\hat{\\mathbf{r}}$ 和动量 $\\hat{\\mathbf{p}}$ 是不对易的算符：$[\\hat{x}_j, \\hat{p}_k] = i\\hbar\\delta_{jk}$。哈密顿量是一个算符 $\\hat{H} = \\hat{K}(\\hat{\\mathbf{p}}) + \\hat{U}(\\hat{\\mathbf{r}})$。因为 $\\hat{K}$ 和 $\\hat{U}$ 不对易，玻尔兹曼算符不能分解：$\\exp(-\\beta\\hat{H}) = \\exp(-\\beta(\\hat{K}+\\hat{U})) \\neq \\exp(-\\beta\\hat{K})\\exp(-\\beta\\hat{U})$。这种不对易性从根本上使位置和动量自由度纠缠在一起。在位置表象中，密度矩阵的对角元 $\\langle \\mathbf{r} | \\exp(-\\beta \\hat{H}) | \\mathbf{r} \\rangle$ 给出位置概率分布，它不能被简化为与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比的项。需要像路径积分蒙特卡洛（PIMC）这样的方法，它将量子系统映射到一个具有更复杂势的经典环状聚合物上，这表明简单的可分离性已经丧失。因此，该陈述是不正确的。\n结论：**不正确**。\n\n**F. 在多尺度粗粒化中，当用一个简化变量 $\\boldsymbol{\\xi}(\\mathbf{r})$ 替代完整坐标 $\\mathbf{r}$ 时，要通过仅位置MC采样对 $\\boldsymbol{\\xi}$ 的正则边际分布进行精确采样，要求有效势是与 $\\boldsymbol{\\xi}$ 相关的平均力势；仅仅用一个朴素的 $U_{\\text{CG}}(\\boldsymbol{\\xi})$ 替换 $U(\\mathbf{r})$ 而不考虑底层的测度，通常会导致对依赖于 $\\boldsymbol{\\xi}$ 的可观测量的平均值产生偏差。**\n\n给定一组微观坐标 $\\mathbf{r}$ 和一个粗粒化变量 $\\boldsymbol{\\xi} = \\boldsymbol{\\xi}(\\mathbf{r})$，$\\boldsymbol{\\xi}$ 的平衡概率分布是通过对所有与给定 $\\boldsymbol{\\xi}$ 值一致的微观状态的完整概率分布进行积分得到的。假设底层的微观状态分布是 $\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$，找到系统处于 $\\boldsymbol{\\xi}(\\mathbf{r}) = \\boldsymbol{\\xi}_0$ 的概率为：\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\int \\exp(-\\beta U(\\mathbf{r})) \\delta(\\boldsymbol{\\xi}(\\mathbf{r}) - \\boldsymbol{\\xi}_0) \\, d\\mathbf{r} $$\n这个分布可以用一个有效的自由能或势来表示，称为平均力势（PMF），$W(\\boldsymbol{\\xi})$：\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\exp(-\\beta W(\\boldsymbol{\\xi}_0)) $$\n根据定义，$W(\\boldsymbol{\\xi}_0) = -k_B T \\ln P(\\boldsymbol{\\xi}_0)$。PMF $W(\\boldsymbol{\\xi}_0)$ 不仅包含势能的变化，还包含了因积分掉与粗粒化变量 $\\boldsymbol{\\xi}$ 正交的微观自由度而产生的熵贡献。陈述中的“测度”一词指的是对应于 $\\boldsymbol{\\xi}(\\mathbf{r})=\\boldsymbol{\\xi}_0$ 的构型空间体积。简单地通过（例如）在某个代表性构型上评估 $U(\\mathbf{r})$ 来创建一个朴素的粗粒化势 $U_{\\text{CG}}(\\boldsymbol{\\xi})$，忽略了封装在PMF中的这些关键熵贡献。因此，使用基于这种朴素势的权重进行采样通常是不正确的。要获得精确的平均值，必须使用真实的PMF $W(\\boldsymbol{\\xi})$ 进行采样。\n结论：**正确**。",
            "answer": "$$\\boxed{ACDF}$$"
        },
        {
            "introduction": "在理论基础之上，我们常常需要模拟带有约束的系统，例如分子中固定的键长。本练习探讨一种看似直接的方法——通过拒绝无效移动来施加约束。它引导您分析该方法对模拟有效性（遍历性）和效率的深远影响，特别是对于硬约束与“软”的刚性约束，这是一个关键的实践考量。",
            "id": "3782885",
            "problem": "考虑一个系统，其微观态为 $\\mathbf{x} \\in \\mathbb{R}^{n}$，势能为 $U(\\mathbf{x})$。在温度 $T$ 下，无约束的正则系综目标密度为 $\\pi_{\\mathrm{unconst}}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，$k_{\\mathrm{B}}$ 为玻尔兹曼常数。假设可行集受约束网络限制，定义为 $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^{n} : g_{i}(\\mathbf{x}) \\le 0 \\text{ for } i=1,\\dots,r, \\text{ and } h_{j}(\\mathbf{x})=0 \\text{ for } j=1,\\dots,s\\}$，其中每个 $h_{j}$ 都是光滑的，并且当等式存在时，它们定义了一个低维子流形。我们希望对受约束的正则系综 $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\,\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$ 进行采样，其中 $\\mathbb{I}$ 表示指示函数。\n\n提出一种马尔可夫链蒙特卡洛（MCMC）方法，在该方法中，通过拒绝任何违反 $\\Omega$ 的提议移动来强制执行约束。考虑一个 Metropolis–Hastings 提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$，在 $\\mathbf{x}$ 的一个邻域内 $q(\\mathbf{x}' \\mid \\mathbf{x})  0$，并假设约束网络可以是“刚性但软性”的（通过附加惩罚项 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ 建模，其中刚度 $\\kappa \\gg 1$ 且 $\\mathbf{h}=(h_{1},\\dots,h_{s})$），也可以是无惩罚的精确完整等式约束 $h_{j}(\\mathbf{x})=0$。分析这种基于拒绝的强制执行方法对细致平衡、遍历性以及在刚性方向上的采样效率的影响。\n\n选择所有正确的陈述。\n\nA. 对于满足 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 的对称提议，通过拒绝任何 $\\mathbf{x}' \\notin \\Omega$ 的移动来强制执行约束，并使用接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，所产生的马尔可夫链满足关于 $\\pi(\\mathbf{x})$ 的细致平衡。\n\nB. 如果约束包含定义了一个光滑低维子流形的完整等式约束 $h_{j}(\\mathbf{x})=0$，并且 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 相对于 $\\mathbb{R}^{n}$ 上的勒贝格测度是绝对连续的，那么一个朴素的提议恰好落在约束流形上的概率为零。因此，在基于拒绝的强制执行下，接受概率几乎必然为零，从而破坏了遍历性。\n\nC. 在“刚性但软性”的情况下，即 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$，且在约束方向上使用一个不适应于 $\\kappa$ 的尺度为 $\\sigma$ 的高斯随机游走提议，那么沿这些方向的平均接受概率大约以 $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$ 的形式衰减（对于某个 $c0$）。这意味着积分自相关时间会随着 $\\kappa$ 的增加而发散，除非 $\\sigma$ 被减小到 $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$ 的量级。\n\nD. 基于拒绝的方案保证了在 $\\Omega$ 的不连通分量之间的混合，因为偶尔违反 $\\Omega$ 的提议会以很小的概率被接受，从而允许链穿越约束障碍。\n\nE. 对于非对称提议，通过使用与提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 无关的 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，可以维持对受约束目标的细致平衡。",
            "solution": "从状态 $\\mathbf{x}$ 到 $\\mathbf{x}'$ 的马尔可夫链的转移核为 $T(\\mathbf{x} \\to \\mathbf{x}') = q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}')$（对于 $\\mathbf{x} \\neq \\mathbf{x}'$），其中 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 是接受概率。平稳分布是受约束的正则密度 $\\pi(\\mathbf{x}) = Z^{-1} \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$，其中 $Z$ 是归一化常数。链收敛到 $\\pi(\\mathbf{x})$ 的一个充分条件是它满足细致平衡条件：\n$$ \\pi(\\mathbf{x}) T(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') T(\\mathbf{x}' \\to \\mathbf{x}) $$\n对所有 $\\mathbf{x}, \\mathbf{x}' \\in \\mathbb{R}^n$ 成立。\n\n**A. 对于满足 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 的对称提议，通过拒绝任何 $\\mathbf{x}' \\notin \\Omega$ 的移动来强制执行约束，并使用接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，所产生的马尔可夫链满足关于 $\\pi(\\mathbf{x})$ 的细致平衡。**\n\n让我们用给定的接受概率来检验细致平衡条件。\n$$ \\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}') \\alpha(\\mathbf{x}' \\to \\mathbf{x}) $$\n代入 $\\pi(\\mathbf{x})$ 和 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 的定义：\n左边 (LHS)： $(Z^{-1} e^{-\\beta U(\\mathbf{x})} \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}) \\cdot q(\\mathbf{x}' \\mid \\mathbf{x}) \\cdot (\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x}')-U(\\mathbf{x}))}\\})$\n右边 (RHS)： $(Z^{-1} e^{-\\beta U(\\mathbf{x}')} \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}) \\cdot q(\\mathbf{x} \\mid \\mathbf{x}') \\cdot (\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x})-U(\\mathbf{x}'))}\\})$\n\n如果 $\\mathbf{x} \\notin \\Omega$ 或 $\\mathbf{x}' \\notin \\Omega$，则两边的一个或多个指示函数将为零，使得左边和右边都等于零。因此，细致平衡成立。\n现在，考虑 $\\mathbf{x} \\in \\Omega$ 和 $\\mathbf{x}' \\in \\Omega$ 的情况。所有指示函数都为 $1$。条件变为：\n$e^{-\\beta U(\\mathbf{x})} q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{1, e^{-\\beta U(\\mathbf{x}')}/e^{-\\beta U(\\mathbf{x})}\\} = e^{-\\beta U(\\mathbf{x}')} q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{1, e^{-\\beta U(\\mathbf{x})}/e^{-\\beta U(\\mathbf{x}')}\\}$\n使用恒等式 $A \\min\\{1, B/A\\} = \\min\\{A, B\\}$，上式简化为：\n$ q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{e^{-\\beta U(\\mathbf{x})}, e^{-\\beta U(\\mathbf{x}')}\\} = q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{e^{-\\beta U(\\mathbf{x}')}, e^{-\\beta U(\\mathbf{x})}\\} $\n由于提议是对称的，即 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$，所以这个方程是一个恒等式。细致平衡条件对所有状态对都满足。给定的接受概率是针对受约束目标分布和对称提议的正确 Metropolis-Hastings 接受概率。\n\n结论：**正确**。\n\n**B. 如果约束包含定义了一个光滑低维子流形的完整等式约束 $h_{j}(\\mathbf{x})=0$，并且 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 相对于 $\\mathbb{R}^{n}$ 上的勒贝格测度是绝对连续的，那么一个朴素的提议恰好落在约束流形上的概率为零。因此，在基于拒绝的强制执行下，接受概率几乎必然为零，从而破坏了遍历性。**\n\n这组完整等式约束定义了一个流形 $\\mathcal{M} = \\{\\mathbf{x} \\in \\mathbb{R}^n \\mid h_j(\\mathbf{x})=0, j=1,\\dots,s\\}$。由于 $s \\ge 1$ 且约束是非平凡的，$\\mathcal{M}$ 是 $\\mathbb{R}^n$ 的一个子流形，其维度严格小于 $n$。在 $\\mathbb{R}^n$ 中，任何维度小于 $n$ 的集合的勒贝格测度都为零。\n提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 被指定为相对于 $\\mathbb{R}^n$ 上的勒贝格测度是绝对连续的。这意味着对于任何勒贝格测度为零的集合 $A \\subset \\mathbb{R}^n$，从 $A$ 中抽取样本的概率为零。即 $P(\\mathbf{x}' \\in A) = \\int_A q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$。\n可行集 $\\Omega$ 是 $\\mathcal{M}$ 的一个子集（即 $\\Omega$ 中的任何点都必须满足等式约束）。接受一个移动要求提议的状态 $\\mathbf{x}'$ 位于 $\\Omega$ 中，这意味着 $\\mathbf{x}' \\in \\mathcal{M}$。\n提议一个位于流形 $\\mathcal{M}$ 上的状态 $\\mathbf{x}'$ 的概率是 $P(\\mathbf{x}' \\in \\mathcal{M}) = \\int_{\\mathcal{M}} q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$，因为 $\\mathcal{M}$ 的勒贝格测度为零。\n因此，任何提议的状态 $\\mathbf{x}'$ 几乎必然会落在可行集 $\\Omega$ 之外。接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 将包含因子 $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$，该因子几乎必然为零。如果移动到任何不同状态的接受概率都为零，那么链将永远不会离开其初始位置：对所有 $k$ 都有 $\\mathbf{x}_{k+1} = \\mathbf{x}_k$。这样的链无法探索状态空间，因此不是遍历的。\n\n结论：**正确**。\n\n**C. 在“刚性但软性”的情况下，即 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$，且在约束方向上使用一个不适应于 $\\kappa$ 的尺度为 $\\sigma$ 的高斯随机游走提议，那么沿这些方向的平均接受概率大约以 $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$ 的形式衰减（对于某个 $c0$）。这意味着积分自相关时间会随着 $\\kappa$ 的增加而发散，除非 $\\sigma$ 被减小到 $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$ 的量级。**\n\n在“刚性但软性”的情况下，总势能为 $U_{total}(\\mathbf{x}) = U(\\mathbf{x}) + U_{\\mathrm{pen}}(\\mathbf{x})$。对于大的 $\\kappa$，在偏离流形 $\\mathbf{h}(\\mathbf{x}) = \\mathbf{0}$ 的方向上，势能由惩罚项 $U_{\\mathrm{pen}}(\\mathbf{x})$ 主导。分布 $\\pi(\\mathbf{x})$ 近似为一个以该流形为中心的高斯分布，其方差量级为 $1/(\\beta\\kappa)$。\n设当前状态 $\\mathbf{x}$ 接近最小值处，即 $\\mathbf{h}(\\mathbf{x}) \\approx \\mathbf{0}$。一个提议移动为 $\\mathbf{x}' = \\mathbf{x} + \\boldsymbol{\\delta}$，其中 $\\boldsymbol{\\delta}$ 从一个方差为 $\\sigma^2$ 的高斯分布中抽取。势能的变化为 $\\Delta U_{total} = U_{total}(\\mathbf{x}') - U_{total}(\\mathbf{x})$。主要贡献来自惩罚项：\n$\\Delta U_{\\mathrm{pen}} = \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2 - \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^2 \\approx \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2$.\n通过泰勒展开，$\\mathbf{h}(\\mathbf{x}') \\approx \\mathbf{h}(\\mathbf{x}) + J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta} \\approx J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta}$，其中 $J_{\\mathbf{h}}$ 是 $\\mathbf{h}$ 的雅可比矩阵。$\\boldsymbol{\\delta}$ 分量的典型量级是 $\\sigma$。因此 $\\mathbf{h}(\\mathbf{x}')$ 的模平方量级为 $\\sigma^2$。所以，$\\Delta U_{\\mathrm{pen}}$ 的量级为 $\\kappa \\sigma^2$。\nMetropolis 接受概率近似为 $\\alpha \\approx \\exp(-\\beta \\Delta U_{total}) \\approx \\exp(-\\beta \\cdot O(\\kappa \\sigma^2))$。这可以写成 $\\exp(-c\\beta\\kappa\\sigma^2)$，其中某个常数 $c0$ 与约束的几何形状有关。当 $\\sigma$ 固定时，随着 $\\kappa \\to \\infty$，这个接受概率会指数级衰减到零。\n接近零的接受概率意味着链很少移动，导致连续状态之间具有非常高的相关性。积分自相关时间 $\\tau_{int}$ 衡量生成一个独立样本所需的步数，它与接受率成反比。因此，当 $\\kappa \\to \\infty$ 时，$\\tau_{int}$ 发散。\n为了保持一个恒定的接受概率（例如，使指数的量级为 $1$），我们需要 $\\beta\\kappa\\sigma^2 = O(1)$，这意味着 $\\sigma^2 \\propto 1/(\\beta\\kappa)$。这意味着提议尺度必须减小为 $\\sigma \\propto \\sqrt{1/(\\beta\\kappa)} = \\sqrt{k_{\\mathrm{B}} T / \\kappa}$。该选项中提出的分析是对刚性势采样效率的标准且正确的评估。\n\n结论：**正确**。\n\n**D. 基于拒绝的方案保证了在 $\\Omega$ 的不连通分量之间的混合，因为偶尔违反 $\\Omega$ 的提议会以很小的概率被接受，从而允许链穿越约束障碍。**\n\n基于拒绝的强制执行方案的核心是，任何落在可行集 $\\Omega$ 之外的提议状态 $\\mathbf{x}'$ 都会以概率 $1$ 被拒绝。如选项 A 的分析所示，接受概率公式包含项 $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$，如果 $\\mathbf{x}' \\notin \\Omega$，该项严格为零。因此，链不可能“以很小的概率接受”一个进入禁止区域的移动。链永远不能通过移动进入约束障碍来“穿越”它。\n如果可行集 $\\Omega$ 由两个或多个不连通的分量组成，例如 $\\Omega_1$ 和 $\\Omega_2$，那么从 $\\Omega_1$ 开始的链只有在提议分布 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 有非零概率从 $\\Omega_1$ 中的一个状态提议一个在 $\\Omega_2$ 中的状态时，才能移动到 $\\Omega_2$。对于局部提议分布（例如，小步长随机游走），如果分量之间被有限距离隔开，这种跳跃的概率通常为零或指数级小。MCMC方案不*保证*混合；事实上，对于不连通的域，遍历性常常被破坏。该选项中提供的理由在事实上是不正确的。\n\n结论：**不正确**。\n\n**E. 对于非对称提议，通过使用与提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 无关的 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，可以维持对受约束目标的细致平衡。**\n\n这个陈述提议在提议非对称（$q(\\mathbf{x}' \\mid \\mathbf{x}) \\neq q(\\mathbf{x} \\mid \\mathbf{x}')$）的情况下，使用 Metropolis 接受概率（该概率对对称提议 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 有效）。\n对于一般提议分布，正确的接受概率由 Metropolis-Hastings 公式给出：\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\min\\left\\{1, \\frac{\\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}')}{\\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\n对于我们的受约束分布 $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$，这变为（对于 $\\mathbf{x} \\in \\Omega$）：\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\left\\{1, \\frac{e^{-\\beta U(\\mathbf{x}')}}{e^{-\\beta U(\\mathbf{x})}} \\frac{q(\\mathbf{x} \\mid \\mathbf{x}')}{q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\n这个公式明确地依赖于提议密度的比率 $q(\\mathbf{x} \\mid \\mathbf{x}')/q(\\mathbf{x}' \\mid \\mathbf{x})$。如果这个比率不等于 $1$，在计算接受概率时省略它，通常会违反细致平衡。该选项中提议的接受规则与 $q$ 无关，这正是它对于非对称提议不正确的原因。\n\n结论：**不正确**。",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "即使是正确实现的模拟，如果它“卡在”状态空间的某个部分，也无法产生有意义的结果，这个问题被称为非遍历性。最后的这个练习呈现了一个真实的分子模拟陷入陷阱的场景。它要求您扮演模拟诊断专家的角色，选择一种有原则的方法来检测问题，并设计一种先进的“补救”措施，即使用集体移动来恢复遍历性，同时严格保持正则系综的物理定律。",
            "id": "3782926",
            "problem": "考虑一个分子系统，其允许的构型构成一个光滑约束流形 $\\mathcal{M} \\subset \\mathbb{R}^{3N}$，该流形由完整约束 $C(\\boldsymbol{x}) = \\boldsymbol{0}$ 描述，其中 $\\boldsymbol{x} \\in \\mathbb{R}^{3N}$ 包含了所有的笛卡尔坐标。该系统通过蒙特卡洛（MC; Monte Carlo）方法在正则系综中进行模拟，逆温度为 $\\beta = 1/(k_{\\mathrm{B}} T)$，目标平稳分布为 $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$，该分布在流形 $\\mathcal{M}$ 上有支撑，并相对于诱导的曲面测度 $d\\sigma(\\boldsymbol{x})$。当前的 MC 实现提出了保持约束的局部单二面角旋转，但似乎被限制在一个由一组环二面角的符号模式定义的构象盆地中，这暗示了可能存在的非遍历性问题。\n\n你的任务是从以下选项中选择唯一最佳的设计，该设计需同时满足：(i) 指定一个有统计学原理支持的诊断方法，能够在这种带有约束二面角的正则系综 MC 模拟中检测出非遍历性；(ii) 推荐能够修正问题的集体移动方法，该方法在 $\\mathcal{M}$ 上保持细致平衡，并且能够在不改变目标正则分布的情况下恢复遍历性。\n\n你可以使用的定义和基本原理：\n- 正则系综：在允许的构型空间上，分布为 $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$，测度为 $d\\sigma(\\boldsymbol{x})$。\n- 对于建议密度为 $q(\\boldsymbol{x} \\to \\boldsymbol{y})$ 且接受率为 $a(\\boldsymbol{x} \\to \\boldsymbol{y})$ 的马尔可夫链，其细致平衡条件为：$\\pi(\\boldsymbol{x}) q(\\boldsymbol{x} \\to \\boldsymbol{y}) a(\\boldsymbol{x} \\to \\boldsymbol{y}) = \\pi(\\boldsymbol{y}) q(\\boldsymbol{y} \\to \\boldsymbol{x}) a(\\boldsymbol{y} \\to \\boldsymbol{x})$。\n- 遍历性：不可约性和非周期性意味着时间平均会收敛到系综平均；如果在所用移动集下状态空间分解为不连通的盆地，则遍历性被违背。\n\n选项：\nA. 诊断方法：运行两个独立的副本，分别在由序参量 $s(\\boldsymbol{x})$ 识别的不同盆地 $B_1$ 和 $B_2$ 中进行初始化。该序参量用于区分盆地归属（例如，一个二面角符号向量，或其标量投影）。对于每个长度为 $L$ 的副本，构建经验分布 $p_i^{(L)}(s)$，$i \\in \\{1,2\\}$，并监控 Jensen–Shannon 散度 $D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$。如果当 $L \\to \\infty$ 时，$D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$ 不趋向于 $0$，则断定为非遍历。修正方法：引入协同旋转移动，通过使用从内坐标到 $\\mathcal{M}$ 的可逆映射 $\\boldsymbol{x} = \\boldsymbol{x}(\\boldsymbol{\\theta})$，更新沿环的一组最小耦合二面角 $\\boldsymbol{\\theta} \\in \\mathbb{R}^{m}$，以精确保持约束。从可行集上支持的对称密度 $q_\\theta(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_\\theta(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$ 中提出新的 $\\boldsymbol{\\theta}'$，并以如下概率接受：\n$$\na(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\},\n$$\n其中 $\\left|J(\\boldsymbol{\\theta})\\right|$ 是与从坐标 $\\boldsymbol{\\theta}$ 到流形 $\\mathcal{M}$ 上曲面测度 $d\\sigma(\\boldsymbol{x})$ 的变量变换相关的行列式绝对值，这确保了相对于 $\\pi(\\boldsymbol{x})\\, d\\sigma(\\boldsymbol{x})$ 的细致平衡。\n\nB. 诊断方法：在单次长时运行中监控全局 Metropolis 接受率 $\\alpha$，如果 $\\alpha  0.01$，则断定为非遍历。修正方法：增大概率移动的步长并升高温度 $T$ 直到 $\\alpha  0.3$，然后使用相同的接受准则 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$ 在升高的温度下继续采样。\n\nC. 诊断方法：从单次长时运行中计算势能的积分自相关时间 $\\tau_{\\mathrm{int}}(U)$，当 $\\tau_{\\mathrm{int}}(U)$ 超过预设阈值时，宣布为非遍历。修正方法：增加具有小方差的单二面角高斯提议以改善局部移动性；并以 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$ 的概率接受。\n\nD. 诊断方法：对单个副本的 $s(\\boldsymbol{x})$ 时间序列进行分块平均，以验证分块均值是否稳定；如果均值达到平台期，则断定为遍历。修正方法：使用具有 $K$ 个温度 $\\beta_1 > \\dots > \\beta_K$ 的副本交换蒙特卡洛（Replica Exchange Monte Carlo，又称并行退火），在相邻副本之间提议交换，接受率为 $\\min\\{1, \\exp[(\\beta_i - \\beta_j)(U(\\boldsymbol{x}_j) - U(\\boldsymbol{x}_i))]\\}$，以促进盆地之间的跳跃。\n\n选择一个同时满足诊断要求和修正移动要求，并严格遵守约束流形上正则系综细致平衡条件的选项。",
            "solution": "问题的核心在于如何在流形 $\\mathcal{M}$ 上正确执行 Metropolis-Hastings 蒙特卡洛模拟，特别是当提议的移动是在不同于定义势能的坐标系（笛卡尔坐标 $\\boldsymbol{x}$）的另一个坐标系（内坐标 $\\boldsymbol{\\theta}$）中生成时。\n\n目标概率测度是相对于流形上的曲面测度定义的，$d\\mu(\\boldsymbol{x}) = \\pi(\\boldsymbol{x}) d\\sigma(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x})) d\\sigma(\\boldsymbol{x})$。如果我们通过映射 $\\boldsymbol{x}(\\boldsymbol{\\theta})$ 使用一组新坐标 $\\boldsymbol{\\theta}$ 来提议移动，我们必须考虑测度的变化。曲面元变换为 $d\\sigma(\\boldsymbol{x}) = |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$，其中 $|J(\\boldsymbol{\\theta})|$ 是由嵌入诱导的度量的体积元，通常不严格地称为雅可比行列式。因此，在 $\\boldsymbol{\\theta}$ 坐标系中的目标概率密度，我们称之为 $p(\\boldsymbol{\\theta})$，是：\n$$p(\\boldsymbol{\\theta})d\\boldsymbol{\\theta} \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$$\n$$p(\\boldsymbol{\\theta}) \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})|$$\n对于从 $\\boldsymbol{\\theta}$ 到 $\\boldsymbol{\\theta}'$ 且以密度 $q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')$ 提议的移动，其 Metropolis-Hastings 接受概率为：\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}') q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})}{p(\\boldsymbol{\\theta}) q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')}\\right\\}$$\n如果使用对称的提议密度，$q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$，则上式简化为：\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}')}{p(\\boldsymbol{\\theta})}\\right\\} = \\min\\left\\{1, \\frac{\\exp(-\\beta U(\\boldsymbol{x}')) |J(\\boldsymbol{\\theta}')|}{\\exp(-\\beta U(\\boldsymbol{x})) |J(\\boldsymbol{\\theta})|}\\right\\} = \\min\\left\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]) \\frac{|J(\\boldsymbol{\\theta}')|}{|J(\\boldsymbol{\\theta})|}\\right\\}$$\n这是正确的接受准则。任何涉及内坐标移动的修正方法都必须使用这种形式，以满足相对于预期目标分布的细致平衡。忽略雅可比行列式比率 $|J(\\boldsymbol{\\theta}')|/|J(\\boldsymbol{\\theta})|$ 是一个常见但关键的错误，它会导致从不正确的分布中进行采样。\n\n基于此，我们来评估各个选项。\n\n**选项 A 评估：**\n- **诊断方法：** 建议在由序参量 $s(\\boldsymbol{x})$ 表征的不同构象盆地中初始化两个或多个独立的模拟（副本）。使用 Jensen-Shannon 散度 $D_{\\mathrm{JS}}$（Kullback-Leibler 散度的对称版本）来量化从每个副本收集的 $s(\\boldsymbol{x})$ 经验分布之间的差异。如果模拟是遍历的，所有副本最终都会探索整个状态空间，导致它们的各自的分布收敛到真实的平衡分布。因此，在长模拟时间 $L \\to \\infty$ 的极限下，$D_{\\mathrm{JS}}$ 必须衰减到 $0$。持续不为零的 $D_{\\mathrm{JS}}$ 是非遍历性（即副本被困住）的一个强有力的、有统计学原理支持的指标。这是一种稳健且被广泛接受的诊断方法。\n- **修正方法：** 提出一个涉及环二面角 $\\boldsymbol{\\theta}$ 协同旋转的集体移动。这直接针对有问题的自由度。至关重要的是，提议的接受概率为 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\}$。如上所述，这正是在内坐标中进行 Metropolis-Hastings 移动的精确正确公式，它保持了相对于约束流形 $\\mathcal{M}$ 上正则分布的细致平衡。\n- **结论：** 诊断方法和修正方法都是严谨的、有统计学依据的，并且表述正确。**正确**。\n\n**选项 B 评估：**\n- **诊断方法：** 建议使用全局 Metropolis 接受率 $\\alpha$ 作为非遍历性的诊断指标。这是一个有缺陷的诊断方法。接受率是移动效率的度量，而不是遍历性的度量。一个模拟可以有很高的接受率（例如，通过非常小的步长），但仍然局限于单个盆地。相反，一个完全遍历的模拟也可能有很低的接受率，如果提议经常落在高能量区域。因此，$\\alpha$ 不是不可约性的可靠指标。\n- **修正方法：** 建议增加提议步长并升高温度 $T$。升高 $T$ 会改变逆温度 $\\beta$，这从根本上改变了目标分布，成为 $\\pi'(\\boldsymbol{x}) \\propto \\exp(-\\beta' U(\\boldsymbol{x}))$ 且 $\\beta'  \\beta$。该提议违反了一个关键约束。此外，它建议使用简单的 Metropolis 接受准则，这对于内坐标移动是不正确的，因为它省略了雅可比校正项。\n- **结论：** 诊断方法不可靠，修正方法在两方面存在缺陷：它改变了目标系综，并且使用了不正确的接受标准。**不正确**。\n\n**选项 C 评估：**\n- **诊断方法：** 建议使用势能的积分自相关时间 $\\tau_{\\mathrm{int}}(U)$ 作为诊断指标。一个大的 $\\tau_{\\mathrm{int}}(U)$ 表明能量的去相关很慢，这通常是采样不佳或陷入势阱的症状。然而，它不是非遍历性的直接或确定性测试。一个系统可以是遍历的，但表现出非常缓慢的动力学（即稀有但可能发生的跃迁），这也会导致一个大的 $\\tau_{\\mathrm{int}}$。它不能证明状态空间在移动集下是根本不连通的。\n- **修正方法：** 建议增加更多的“单二面角”移动。问题陈述表明这种移动已在使用，并且是问题的原因，因为它们不足以产生跨越环翻转能垒所需的集体运动。这个修正方法没有解决核心问题。此外，它提出了简单的 Metropolis 接受准则，如前所述，由于缺少雅可比项，这对于二面角移动是不正确的。\n- **结论：** 诊断方法薄弱且间接。修正方法对于所述问题不充分，并且采用了违反细致平衡的不正确接受规则。**不正确**。\n\n**选项 D 评估：**\n- **诊断方法：** 建议对单条轨迹使用分块平均。分块平均是一种通过观察连续数据块的均值的方差来估计平均值的统计误差的技术。如果模拟是非遍历的并且被困在一个盆地中，分块平均值将简单地收敛到该盆地的平均值，从而给出全局收敛的危险假象。这种诊断方法无法检测到其他未探索盆地的存在。它从根本上不适合诊断这种类型的非遍历性。\n- **修正方法：** 建议使用副本交换蒙特卡洛（REMC），也称为并行退火。REMC 是一种出色而强大的增强采样技术，用于克服能垒。它保持细致平衡，并且不会改变目标温度下的目标分布（它也会在其他温度下采样，但 $\\beta_1$ 副本正确地对目标系综进行采样）。交换的接受规则也是正确的。所以，修正方法本身是有效的方法。然而，问题要求的是唯一最佳的*设计*，这包括诊断方法。\n- **结论：** 修正方法是有效的，但诊断方法存在严重缺陷，会导致假阴性（即未能检测到非遍历性）。由于设计的诊断部分完全失败，整个选项是不可接受的。**不正确**。\n\n**最终结论**\n选项 A 是唯一一个既提出了统计上严谨的非遍历性诊断方法（比较独立副本），又提出了物理上合适的修正移动（协同旋转）的选项，并且其 Metropolis-Hastings 接受概率是正确的，包含了必要的雅可比因子以确保在约束流形上满足细致平衡。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}