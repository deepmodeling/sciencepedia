{
    "hands_on_practices": [
        {
            "introduction": "This practice explores a foundational assumption in many canonical Monte Carlo simulations: the focus on configuration space alone. By analyzing the conditions under which momentum degrees of freedom can be integrated out without affecting the averages of position-dependent observables, you will solidify your understanding of the link between the full phase-space description and the more common configuration-space sampling approach. This exercise is crucial for justifying the validity of position-only MC simulations and for identifying important physical scenarios where this simplification is not permissible.",
            "id": "3782936",
            "problem": "A classical many-particle system with $N$ point particles in a fixed volume $V$ at temperature $T$ is modeled in the canonical ensemble (number of particles $N$, volume $V$, temperature $T$, commonly abbreviated as NVT). The system is described by positions $\\mathbf{r} \\in \\mathbb{R}^{3N}$ and momenta $\\mathbf{p} \\in \\mathbb{R}^{3N}$ with a Hamiltonian $H(\\mathbf{r},\\mathbf{p})$. The canonical probability density is $\\rho(\\mathbf{r},\\mathbf{p}) \\propto \\exp\\!\\left(-\\beta H(\\mathbf{r},\\mathbf{p})\\right)$ with $\\beta = 1/(k_B T)$, where $k_B$ is the Boltzmann constant. Consider an observable $A(\\mathbf{r})$ that depends only on positions. In practice, Monte Carlo (MC) sampling in the canonical ensemble frequently proposes and accepts/rejects moves in $\\mathbf{r}$ only, without sampling $\\mathbf{p}$.\n\nFrom first principles, analyze when position-only sampling yields the correct canonical ensemble average for $A(\\mathbf{r})$, and when it fails. Select all statements below that are correct.\n\nA. If the Hamiltonian is separable as $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$ with $K(\\mathbf{p})$ independent of $\\mathbf{r}$ in Cartesian coordinates with constant particle masses, then the marginal over positions satisfies $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$, so position-only MC sampling using the Boltzmann weight $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ yields exact canonical averages for any $A(\\mathbf{r})$.\n\nB. When imposing holonomic constraints $C(\\mathbf{r}) = \\mathbf{0}$ that define a lower-dimensional configuration manifold embedded in Cartesian space, the correct marginal position distribution remains $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ restricted to the manifold, with no additional measure factor; therefore, naive position-only MC with acceptance based solely on $\\Delta U(\\mathbf{r})$ yields exact averages for any $A(\\mathbf{r})$ on the constrained manifold.\n\nC. In generalized (curvilinear) coordinates $\\mathbf{q}$ with conjugate momenta $\\mathbf{p}_q$, the kinetic energy often takes the quadratic form $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$ where $\\mathbf{M}(\\mathbf{q})$ is a position-dependent mass-metric tensor. The momentum integral produces a factor proportional to $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ in the marginal position distribution. Thus, naive position-only MC with weight $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ is generally biased for $A(\\mathbf{q})$ unless the correct measure correction is included.\n\nD. With a static magnetic field represented by a vector potential $\\mathbf{A}(\\mathbf{r})$ via minimal coupling in the classical Hamiltonian $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$, the Gaussian integral over momenta is independent of $\\mathbf{r}$ because it is a translation in $\\mathbf{p}$; consequently, the marginal position distribution remains $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$, and position-only MC yields exact averages for any $A(\\mathbf{r})$.\n\nE. Quantum effects at low temperature preserve the classical factorization between positions and momenta in the canonical ensemble, so position-only MC remains exact for any $A(\\mathbf{r})$ even when classical assumptions break down.\n\nF. In multiscale coarse-graining, when replacing the full coordinates $\\mathbf{r}$ by a reduced variable $\\boldsymbol{\\xi}(\\mathbf{r})$, exact sampling of the canonical marginal distribution of $\\boldsymbol{\\xi}$ by position-only MC requires the effective potential to be the potential of mean force associated with $\\boldsymbol{\\xi}$; merely substituting $U(\\mathbf{r})$ by a naive $U_{\\text{CG}}(\\boldsymbol{\\xi})$ without accounting for the underlying measure generally leads to biased averages for observables depending on $\\boldsymbol{\\xi}$.\n\nChoose all that apply.",
            "solution": "The core of the problem is to determine the conditions under which the canonical ensemble average of a position-dependent observable $A(\\mathbf{r})$ can be correctly computed using a Monte Carlo (MC) simulation that only samples the configuration space (positions $\\mathbf{r}$) and not the momentum space ($\\mathbf{p}$).\n\nFrom first principles, the canonical ensemble average of an observable $A(\\mathbf{r})$ is given by the full phase-space integral:\n$$ \\langle A \\rangle = \\frac{\\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}}{\\iint \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}} $$\nwhere $\\beta = 1/(k_B T)$ and the integrals are over all $3N$ position coordinates and $3N$ momentum coordinates.\n\nSince the observable $A$ depends only on $\\mathbf{r}$, we can rearrange the numerator as:\n$$ \\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p} = \\int A(\\mathbf{r}) \\left( \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} \\right) d\\mathbf{r} $$\nLet us define the marginal probability density for positions, $\\rho(\\mathbf{r})$, by integrating the full phase-space probability density over all momenta:\n$$ \\rho(\\mathbf{r}) = C \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} $$\nwhere $C$ is a normalization constant. The ensemble average can then be expressed as an integral over positions only:\n$$ \\langle A \\rangle = \\frac{\\int A(\\mathbf{r}) \\rho(\\mathbf{r}) \\, d\\mathbf{r}}{\\int \\rho(\\mathbf{r}) \\, d\\mathbf{r}} $$\nA position-only MC simulation is valid if its stationary distribution is proportional to this correct marginal density $\\rho(\\mathbf{r})$. A \"naive\" position-only MC simulation typically assumes a separable Hamiltonian of the form $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$ and uses a sampling weight of $\\exp(-\\beta U(\\mathbf{r}))$. The validity of this approach depends on whether $\\rho(\\mathbf{r})$ is indeed proportional to $\\exp(-\\beta U(\\mathbf{r}))$. This requires the momentum integral $\\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p}$ to be either constant or to factor out in a way that preserves proportionality to $\\exp(-\\beta U(\\mathbf{r}))$.\n\nLet's evaluate each statement based on this principle.\n\n**A. If the Hamiltonian is separable as $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$ with $K(\\mathbf{p})$ independent of $\\mathbf{r}$ in Cartesian coordinates with constant particle masses, then the marginal over positions satisfies $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$, so position-only MC sampling using the Boltzmann weight $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ yields exact canonical averages for any $A(\\mathbf{r})$.**\n\nIn Cartesian coordinates, for $N$ particles with masses $m_i$, the kinetic energy is $K(\\mathbf{p}) = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m_i}$. This term is independent of position $\\mathbf{r}$. The Hamiltonian is $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$.\nThe marginal density $\\rho(\\mathbf{r})$ is:\n$$ \\rho(\\mathbf{r}) \\propto \\int \\exp(-\\beta [U(\\mathbf{r}) + K(\\mathbf{p})]) \\, d\\mathbf{p} $$\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p} $$\nThe integral $\\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p}$ is a $3N$-dimensional Gaussian integral over momenta. Since $K(\\mathbf{p})$ does not depend on $\\mathbf{r}$, the value of this integral is a constant independent of $\\mathbf{r}$.\n$$ \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{p_{ix}^2+p_{iy}^2+p_{iz}^2}{2m_i}\\right) d\\mathbf{p} = \\prod_{i=1}^{N} \\left( \\int_{-\\infty}^{\\infty} e^{-\\beta p^2/(2m_i)} dp \\right)^3 = \\prod_{i=1}^{N} \\left( \\frac{2\\pi m_i}{\\beta} \\right)^{3/2} $$\nThis result is a constant. Therefore, $\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$. A position-only MC simulation that samples states with a probability proportional to $\\exp(-\\beta U(\\mathbf{r}))$ will correctly sample the marginal position distribution and yield exact canonical averages for any $A(\\mathbf{r})$.\nVerdict: **Correct**.\n\n**B. When imposing holonomic constraints $C(\\mathbf{r}) = \\mathbf{0}$ that define a lower-dimensional configuration manifold embedded in Cartesian space, the correct marginal position distribution remains $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ restricted to the manifold, with no additional measure factor; therefore, naive position-only MC with acceptance based solely on $\\Delta U(\\mathbf{r})$ yields exact averages for any $A(\\mathbf{r})$ on the constrained manifold.**\n\nHolonomic constraints reduce the dimensionality of the configuration space. Let the $d$-dimensional manifold be parametrized by generalized coordinates $\\mathbf{q} = (q_1, \\dots, q_d)$. The Cartesian positions are functions of these coordinates, $\\mathbf{r} = \\mathbf{r}(\\mathbf{q})$. The kinetic energy becomes $K = \\frac{1}{2} \\sum_k m_k \\dot{\\mathbf{r}}_k^2 = \\frac{1}{2} \\sum_{i,j} M_{ij}(\\mathbf{q}) \\dot{q}_i \\dot{q}_j$, where $\\mathbf{M}(\\mathbf{q})$ is the mass-metric tensor, whose elements are $M_{ij}(\\mathbf{q}) = \\sum_k m_k \\frac{\\partial \\mathbf{r}_k}{\\partial q_i} \\cdot \\frac{\\partial \\mathbf{r}_k}{\\partial q_j}$. In general, $\\mathbf{M}(\\mathbf{q})$ is a function of the coordinates $\\mathbf{q}$. The Hamiltonian in these generalized coordinates is $H(\\mathbf{q}, \\mathbf{p}_q) = U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$, where $\\mathbf{p}_q$ are the conjugate momenta.\nTo find the marginal distribution $\\rho(\\mathbf{q})$, we integrate over $\\mathbf{p}_q$:\n$$ \\rho(\\mathbf{q}) \\propto \\int \\exp(-\\beta [U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q]) \\, d\\mathbf{p}_q $$\n$$ \\rho(\\mathbf{q}) \\propto \\exp(-\\beta U(\\mathbf{q})) \\int \\exp(-\\frac{\\beta}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q) \\, d\\mathbf{p}_q $$\nThe integral is a Gaussian in $\\mathbf{p}_q$. Its value is proportional to $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$. Thus, the correct marginal distribution is:\n$$ \\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q})) $$\nThe term $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ is a position-dependent measure factor that arises from the curvature of the constraint manifold. Since this factor is generally not constant, a naive MC sampling based only on $\\exp(-\\beta U(\\mathbf{q}))$ will be incorrect. The statement claims there is \"no additional measure factor,\" which is false.\nVerdict: **Incorrect**.\n\n**C. In generalized (curvilinear) coordinates $\\mathbf{q}$ with conjugate momenta $\\mathbf{p}_q$, the kinetic energy often takes the quadratic form $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$ where $\\mathbf{M}(\\mathbf{q})$ is a position-dependent mass-metric tensor. The momentum integral produces a factor proportional to $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ in the marginal position distribution. Thus, naive position-only MC with weight $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ is generally biased for $A(\\mathbf{q})$ unless the correct measure correction is included.**\n\nThis statement accurately describes the situation analyzed for option B. As derived above, when the kinetic energy depends on a position-dependent mass-metric tensor $\\mathbf{M}(\\mathbf{q})$, the integration over momenta $\\mathbf{p}_q$ yields a factor proportional to $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$.\nThe marginal density is $\\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q}))$. An MC simulation must sample from this distribution. Using a weight of just $\\exp(-\\beta U(\\mathbf{q}))$ ignores the geometric factor $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ and will lead to biased sampling, unless $\\det(\\mathbf{M}(\\mathbf{q}))$ happens to be constant, which is not the general case.\nVerdict: **Correct**.\n\n**D. With a static magnetic field represented by a vector potential $\\mathbf{A}(\\mathbf{r})$ via minimal coupling in the classical Hamiltonian $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$, the Gaussian integral over momenta is independent of $\\mathbf{r}$ because it is a translation in $\\mathbf{p}$; consequently, the marginal position distribution remains $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$, and position-only MC yields exact averages for any $A(\\mathbf{r})$.**\n\nThe Hamiltonian is $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}$. The marginal position density is:\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}\\right) d\\mathbf{p} $$\nLet's analyze the integral over momenta. It factors into a product of integrals for each particle $i$. For a single particle, the integral is over its momentum $\\mathbf{p}_i$:\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2\\right) d\\mathbf{p}_i $$\nWe perform a change of variables $\\mathbf{p}'_i = \\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i)$. The differential volume element $d\\mathbf{p}_i$ becomes $d\\mathbf{p}'_i$ as the Jacobian of this linear translation is $1$. The integration limits $(-\\infty, \\infty)$ for each component of $\\mathbf{p}_i$ remain $(-\\infty, \\infty)$ for $\\mathbf{p}'_i$.\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}'_i)^2\\right) d\\mathbf{p}'_i $$\nThis is a standard Gaussian integral whose value, $(2\\pi m_i/\\beta)^{3/2}$, is a constant independent of $\\mathbf{r}_i$ and thus independent of $\\mathbf{A}(\\mathbf{r}_i)$. The position dependence, which was in the shift of the center of the Gaussian, has been integrated out. The full momentum integral is the product of these constants, which is itself a constant independent of $\\mathbf{r}$. Therefore, $\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$. This is a manifestation of the Bohr-van Leeuwen theorem, which states that classical statistical mechanics cannot account for diamagnetism or paramagnetism. Position-only MC sampling remains exact.\nVerdict: **Correct**.\n\n**E. Quantum effects at low temperature preserve the classical factorization between positions and momenta in the canonical ensemble, so position-only MC remains exact for any $A(\\mathbf{r})$ even when classical assumptions break down.**\n\nIn quantum mechanics, position $\\hat{\\mathbf{r}}$ and momentum $\\hat{\\mathbf{p}}$ are operators that do not commute: $[\\hat{x}_j, \\hat{p}_k] = i\\hbar\\delta_{jk}$. The Hamiltonian is an operator $\\hat{H} = \\hat{K}(\\hat{\\mathbf{p}}) + \\hat{U}(\\hat{\\mathbf{r}})$. Because $\\hat{K}$ and $\\hat{U}$ do not commute, the Boltzmann operator does not factorize: $\\exp(-\\beta\\hat{H}) = \\exp(-\\beta(\\hat{K}+\\hat{U})) \\neq \\exp(-\\beta\\hat{K})\\exp(-\\beta\\hat{U})$. This non-commutativity fundamentally entangles the position and momentum degrees of freedom. The diagonal elements of the density matrix in the position representation, $\\langle \\mathbf{r} | \\exp(-\\beta \\hat{H}) | \\mathbf{r} \\rangle$, which give the position probability distribution, cannot be simplified to a term proportional to $\\exp(-\\beta U(\\mathbf{r}))$. Methods like Path-Integral Monte Carlo (PIMC) are required, which map the quantum system onto a classical ring polymer with a more complex potential, demonstrating that the simple factorization is lost. The statement is therefore incorrect.\nVerdict: **Incorrect**.\n\n**F. In multiscale coarse-graining, when replacing the full coordinates $\\mathbf{r}$ by a reduced variable $\\boldsymbol{\\xi}(\\mathbf{r})$, exact sampling of the canonical marginal distribution of $\\boldsymbol{\\xi}$ by position-only MC requires the effective potential to be the potential of mean force associated with $\\boldsymbol{\\xi}$; merely substituting $U(\\mathbf{r})$ by a naive $U_{\\text{CG}}(\\boldsymbol{\\xi})$ without accounting for the underlying measure generally leads to biased averages for observables depending on $\\boldsymbol{\\xi}$.**\n\nGiven a set of microscopic coordinates $\\mathbf{r}$ and a coarse-grained variable $\\boldsymbol{\\xi} = \\boldsymbol{\\xi}(\\mathbf{r})$, the equilibrium probability distribution for $\\boldsymbol{\\xi}$ is obtained by integrating the full probability distribution over all microstates consistent with a given value of $\\boldsymbol{\\xi}$. Assuming the underlying microstate distribution is $\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$, the probability of finding the system with $\\boldsymbol{\\xi}(\\mathbf{r}) = \\boldsymbol{\\xi}_0$ is:\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\int \\exp(-\\beta U(\\mathbf{r})) \\delta(\\boldsymbol{\\xi}(\\mathbf{r}) - \\boldsymbol{\\xi}_0) \\, d\\mathbf{r} $$\nThis distribution can be expressed using an effective free energy or potential, known as the Potential of Mean Force (PMF), $W(\\boldsymbol{\\xi})$:\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\exp(-\\beta W(\\boldsymbol{\\xi}_0)) $$\nBy definition, $W(\\boldsymbol{\\xi}_0) = -k_B T \\ln P(\\boldsymbol{\\xi}_0)$. The PMF $W(\\boldsymbol{\\xi}_0)$ contains not only the potential energy changes but also the entropic contributions from integrating out the microscopic degrees of freedom orthogonal to the coarse-grained variable $\\boldsymbol{\\xi}$. The term \"measure\" in the statement refers to the volume of configuration space corresponding to $\\boldsymbol{\\xi}(\\mathbf{r})=\\boldsymbol{\\xi}_0$. Simply creating a naive coarse-grained potential $U_{\\text{CG}}(\\boldsymbol{\\xi})$ by, for example, evaluating $U(\\mathbf{r})$ at some representative configuration, ignores these crucial entropic contributions encapsulated in the PMF. Therefore, sampling using a weight based on such a naive potential will generally be incorrect. To get exact averages, one must sample using the true PMF, $W(\\boldsymbol{\\xi})$.\nVerdict: **Correct**.",
            "answer": "$$\\boxed{ACDF}$$"
        },
        {
            "introduction": "Real-world systems are often subject to constraints, from fixed bond lengths in molecules to defined boundaries in materials science. This exercise challenges you to think critically about a seemingly simple method for enforcing such constraints: rejecting any move that violates them. By analyzing the consequences for detailed balance, ergodicity, and sampling efficiency, you will uncover the subtle but severe pitfalls of this naive approach and appreciate the need for more sophisticated constraint-handling algorithms.",
            "id": "3782885",
            "problem": "Consider a system with microscopic state $\\mathbf{x} \\in \\mathbb{R}^{n}$ and a potential energy $U(\\mathbf{x})$. At temperature $T$, the canonical ensemble target density without constraints is $\\pi_{\\mathrm{unconst}}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$ with $\\beta = 1/(k_{\\mathrm{B}} T)$ and $k_{\\mathrm{B}}$ the Boltzmann constant. Suppose the feasible set is restricted by a constraint network, defining $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^{n} : g_{i}(\\mathbf{x}) \\le 0 \\text{ for } i=1,\\dots,r, \\text{ and } h_{j}(\\mathbf{x})=0 \\text{ for } j=1,\\dots,s\\}$, where each $h_{j}$ is smooth and the equalities define a lower-dimensional submanifold when present. We wish to sample the constrained canonical ensemble $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\,\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$, where $\\mathbb{I}$ denotes the indicator function.\n\nPropose a Markov Chain Monte Carlo (MCMC) method in which constraints are enforced by rejecting any proposed move that violates $\\Omega$. Consider a Metropolis–Hastings proposal density $q(\\mathbf{x}' \\mid \\mathbf{x})$ with $q(\\mathbf{x}' \\mid \\mathbf{x})  0$ in a neighborhood of $\\mathbf{x}$ and assume that the constraint network can be either stiff-but-soft, modeled by additional penalty terms $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ with large stiffness $\\kappa \\gg 1$ and $\\mathbf{h}=(h_{1},\\dots,h_{s})$, or exactly holonomic equalities $h_{j}(\\mathbf{x})=0$ without penalties. Analyze the impact of such rejection-based enforcement on detailed balance, ergodicity, and sampling efficiency in the stiff directions.\n\nSelect all statements that are correct.\n\nA. With symmetric proposals satisfying $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$, enforcing constraints by rejecting any $\\mathbf{x}' \\notin \\Omega$ and using the acceptance probability $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$ yields a Markov chain that satisfies detailed balance with respect to $\\pi(\\mathbf{x})$.\n\nB. If the constraints include holonomic equalities $h_{j}(\\mathbf{x})=0$ defining a smooth lower-dimensional manifold, and $q(\\mathbf{x}' \\mid \\mathbf{x})$ is absolutely continuous with respect to Lebesgue measure on $\\mathbb{R}^{n}$, then the probability that a naive proposal lands exactly on the constraint manifold is zero. Under rejection enforcement, the acceptance probability is therefore zero almost surely, breaking ergodicity.\n\nC. In the stiff-but-soft case with $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ and a Gaussian random-walk proposal of scale $\\sigma$ in the constrained directions that does not adapt to $\\kappa$, the mean acceptance probability along those directions decays roughly like $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$ for some $c0$, implying that the integrated autocorrelation time diverges with increasing $\\kappa$ unless $\\sigma$ is reduced on the order of $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$.\n\nD. The rejection-enforced scheme guarantees mixing across disconnected components of $\\Omega$ because occasional proposals that violate $\\Omega$ are accepted with small probability, allowing the chain to traverse constraint barriers.\n\nE. For non-symmetric proposals, detailed balance for the constrained target is maintained by using $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$, which is independent of the proposal density $q(\\mathbf{x}' \\mid \\mathbf{x})$.\n\nAnswer with the letters of all correct options.",
            "solution": "The problem statement describing a Monte Carlo simulation for a constrained canonical ensemble is first validated.\n\n### Step 1: Extract Givens\n- System state: $\\mathbf{x} \\in \\mathbb{R}^{n}$\n- Potential energy: $U(\\mathbf{x})$\n- Temperature: $T$\n- Inverse temperature: $\\beta = 1/(k_{\\mathrm{B}} T)$\n- Boltzmann constant: $k_{\\mathrm{B}}$\n- Unconstrained canonical density: $\\pi_{\\mathrm{unconst}}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$\n- Feasible set: $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^{n} : g_{i}(\\mathbf{x}) \\le 0 \\text{ for } i=1,\\dots,r, \\text{ and } h_{j}(\\mathbf{x})=0 \\text{ for } j=1,\\dots,s\\}$\n- Properties of constraints: each $h_{j}$ is smooth, and the equality constraints define a lower-dimensional submanifold.\n- Constrained canonical ensemble density: $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\,\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$, where $\\mathbb{I}$ is the indicator function.\n- Proposed MCMC method: Constraints are enforced by rejecting any proposed move that violates $\\Omega$.\n- Proposal density: $q(\\mathbf{x}' \\mid \\mathbf{x})$, with $q(\\mathbf{x}' \\mid \\mathbf{x})  0$ in a neighborhood of $\\mathbf{x}$.\n- Stiff-but-soft case model: An additional penalty potential $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ with stiffness $\\kappa \\gg 1$, where $\\mathbf{h}=(h_{1},\\dots,h_{s})$.\n- Exactly holonomic case model: $h_{j}(\\mathbf{x})=0$ without penalties.\n- Question: Analyze the impact of rejection-based enforcement on detailed balance, ergodicity, and sampling efficiency.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically grounded, well-posed, and objective. It outlines a standard and important problem in computational statistical mechanics and Bayesian statistics: sampling from a distribution restricted to a specific domain. All technical terms like \"canonical ensemble,\" \"Metropolis–Hastings,\" \"detailed balance,\" \"ergodicity,\" \"holonomic constraints,\" and \"stiff potential\" are used correctly within their established scientific contexts. The setup is self-contained and does not contain contradictions or scientifically unsound premises. The scenarios described (hard constraints, stiff penalty functions) are common in fields like molecular dynamics and constrained optimization. The problem is a valid and non-trivial conceptual question.\n\n### Step 3: Verdict and Action\nThe problem is valid. A detailed analysis of each option will be performed.\n\n---\n\nThe Markov chain's transition kernel from state $\\mathbf{x}$ to $\\mathbf{x}'$ is $T(\\mathbf{x} \\to \\mathbf{x}') = q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}')$ for $\\mathbf{x} \\neq \\mathbf{x}'$, where $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ is the acceptance probability. The stationary distribution is the constrained canonical density $\\pi(\\mathbf{x}) = Z^{-1} \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$, where $Z$ is the normalization constant. A sufficient condition for the chain to converge to $\\pi(\\mathbf{x})$ is that it satisfies the detailed balance condition:\n$$ \\pi(\\mathbf{x}) T(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') T(\\mathbf{x}' \\to \\mathbf{x}) $$\nfor all $\\mathbf{x}, \\mathbf{x}' \\in \\mathbb{R}^n$.\n\n### Option-by-Option Analysis\n\n**A. With symmetric proposals satisfying $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$, enforcing constraints by rejecting any $\\mathbf{x}' \\notin \\Omega$ and using the acceptance probability $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$ yields a Markov chain that satisfies detailed balance with respect to $\\pi(\\mathbf{x})$.**\n\nLet's check the detailed balance condition with the given acceptance probability.\n$$ \\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}') \\alpha(\\mathbf{x}' \\to \\mathbf{x}) $$\nSubstituting the definitions of $\\pi(\\mathbf{x})$ and $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$:\nLHS: $(Z^{-1} e^{-\\beta U(\\mathbf{x})} \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}) \\cdot q(\\mathbf{x}' \\mid \\mathbf{x}) \\cdot (\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x}')-U(\\mathbf{x}))}\\})$\nRHS: $(Z^{-1} e^{-\\beta U(\\mathbf{x}')} \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}) \\cdot q(\\mathbf{x} \\mid \\mathbf{x}') \\cdot (\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x})-U(\\mathbf{x}'))}\\})$\n\nIf either $\\mathbf{x} \\notin \\Omega$ or $\\mathbf{x}' \\notin \\Omega$, one or more indicator functions on each side will be zero, making both LHS and RHS equal to zero. Thus, detailed balance holds.\nNow, consider the case where both $\\mathbf{x} \\in \\Omega$ and $\\mathbf{x}' \\in \\Omega$. All indicator functions are $1$. The condition becomes:\n$e^{-\\beta U(\\mathbf{x})} q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{1, e^{-\\beta U(\\mathbf{x}')}/e^{-\\beta U(\\mathbf{x})}\\} = e^{-\\beta U(\\mathbf{x}')} q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{1, e^{-\\beta U(\\mathbf{x})}/e^{-\\beta U(\\mathbf{x}')}\\}$\nUsing the identity $A \\min\\{1, B/A\\} = \\min\\{A, B\\}$, this simplifies to:\n$ q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{e^{-\\beta U(\\mathbf{x})}, e^{-\\beta U(\\mathbf{x}')}\\} = q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{e^{-\\beta U(\\mathbf{x}')}, e^{-\\beta U(\\mathbf{x})}\\} $\nSince the proposal is symmetric, $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$, this equation is an identity. The detailed balance condition is satisfied for all pairs of states. The given acceptance probability is the correct Metropolis-Hastings acceptance for a constrained target distribution and a symmetric proposal.\n\nVerdict: **Correct**.\n\n**B. If the constraints include holonomic equalities $h_{j}(\\mathbf{x})=0$ defining a smooth lower-dimensional manifold, and $q(\\mathbf{x}' \\mid \\mathbf{x})$ is absolutely continuous with respect to Lebesgue measure on $\\mathbb{R}^{n}$, then the probability that a naive proposal lands exactly on the constraint manifold is zero. Under rejection enforcement, the acceptance probability is therefore zero almost surely, breaking ergodicity.**\n\nThe set of holonomic equality constraints defines a manifold $\\mathcal{M} = \\{\\mathbf{x} \\in \\mathbb{R}^n \\mid h_j(\\mathbf{x})=0, j=1,\\dots,s\\}$. Since $s \\ge 1$ and the constraints are non-trivial, $\\mathcal{M}$ is a submanifold of $\\mathbb{R}^n$ with dimension strictly less than $n$. Any set with dimension less than $n$ has a Lebesgue measure of zero in $\\mathbb{R}^n$.\nThe proposal density $q(\\mathbf{x}' \\mid \\mathbf{x})$ is specified to be absolutely continuous with respect to the Lebesgue measure on $\\mathbb{R}^n$. This means that for any set $A \\subset \\mathbb{R}^n$ with zero Lebesgue measure, the probability of drawing a sample from $A$ is zero. That is, $P(\\mathbf{x}' \\in A) = \\int_A q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$.\nThe feasible set $\\Omega$ is a subset of $\\mathcal{M}$ (in the sense that any point in $\\Omega$ must satisfy the equality constraints). The acceptance of a move requires the proposed state $\\mathbf{x}'$ to be in $\\Omega$, which implies $\\mathbf{x}' \\in \\mathcal{M}$.\nThe probability of proposing a state $\\mathbf{x}'$ that lies on the manifold $\\mathcal{M}$ is $P(\\mathbf{x}' \\in \\mathcal{M}) = \\int_{\\mathcal{M}} q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$, because the Lebesgue measure of $\\mathcal{M}$ is zero.\nTherefore, any proposed state $\\mathbf{x}'$ will almost surely lie outside the feasible set $\\Omega$. The acceptance probability $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ will contain a factor of $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$, which will be zero almost surely. If the acceptance probability for any move to a different state is zero, the chain will never move from its initial position: $\\mathbf{x}_{k+1} = \\mathbf{x}_k$ for all $k$. Such a chain cannot explore the state space and is therefore not ergodic.\n\nVerdict: **Correct**.\n\n**C. In the stiff-but-soft case with $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ and a Gaussian random-walk proposal of scale $\\sigma$ in the constrained directions that does not adapt to $\\kappa$, the mean acceptance probability along those directions decays roughly like $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$ for some $c0$, implying that the integrated autocorrelation time diverges with increasing $\\kappa$ unless $\\sigma$ is reduced on the order of $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$.**\n\nIn the stiff-but-soft case, the total potential is $U_{total}(\\mathbf{x}) = U(\\mathbf{x}) + U_{\\mathrm{pen}}(\\mathbf{x})$. For large $\\kappa$, the potential is dominated by the penalty term $U_{\\mathrm{pen}}(\\mathbf{x})$ in directions away from the manifold $\\mathbf{h}(\\mathbf{x}) = \\mathbf{0}$. The distribution $\\pi(\\mathbf{x})$ is approximately a Gaussian centered on this manifold with a variance of order $1/(\\beta\\kappa)$.\nLet the current state $\\mathbf{x}$ be near the minimum, where $\\mathbf{h}(\\mathbf{x}) \\approx \\mathbf{0}$. A proposal move is $\\mathbf{x}' = \\mathbf{x} + \\boldsymbol{\\delta}$, where $\\boldsymbol{\\delta}$ is drawn from a Gaussian with variance $\\sigma^2$. The change in potential energy is $\\Delta U_{total} = U_{total}(\\mathbf{x}') - U_{total}(\\mathbf{x})$. The dominant contribution comes from the penalty term:\n$\\Delta U_{\\mathrm{pen}} = \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2 - \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^2 \\approx \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2$.\nBy Taylor expansion, $\\mathbf{h}(\\mathbf{x}') \\approx \\mathbf{h}(\\mathbf{x}) + J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta} \\approx J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta}$, where $J_{\\mathbf{h}}$ is the Jacobian matrix of $\\mathbf{h}$. The typical magnitude of the components of $\\boldsymbol{\\delta}$ is $\\sigma$. The magnitude squared of $\\mathbf{h}(\\mathbf{x}')$ is thus of order $\\sigma^2$. So, $\\Delta U_{\\mathrm{pen}}$ is of order $\\kappa \\sigma^2$.\nThe Metropolis acceptance probability is approximately $\\alpha \\approx \\exp(-\\beta \\Delta U_{total}) \\approx \\exp(-\\beta \\cdot O(\\kappa \\sigma^2))$. This can be written as $\\exp(-c\\beta\\kappa\\sigma^2)$ for some constant $c0$ related to the geometry of the constraints. As $\\kappa \\to \\infty$ with $\\sigma$ fixed, this acceptance probability decays exponentially to zero.\nAn acceptance probability near zero means the chain rarely moves, leading to very high correlation between successive states. The integrated autocorrelation time, $\\tau_{int}$, which measures the number of steps to generate an independent sample, is inversely related to the acceptance rate. Therefore, $\\tau_{int}$ diverges as $\\kappa \\to \\infty$.\nTo maintain a constant acceptance probability (e.g., to keep the exponent of order $1$), we need $\\beta\\kappa\\sigma^2 = O(1)$, which implies $\\sigma^2 \\propto 1/(\\beta\\kappa)$. This means the proposal scale must be reduced as $\\sigma \\propto \\sqrt{1/(\\beta\\kappa)} = \\sqrt{k_{\\mathrm{B}} T / \\kappa}$. The analysis presented in this option is a standard and correct assessment of sampling efficiency for stiff potentials.\n\nVerdict: **Correct**.\n\n**D. The rejection-enforced scheme guarantees mixing across disconnected components of $\\Omega$ because occasional proposals that violate $\\Omega$ are accepted with small probability, allowing the chain to traverse constraint barriers.**\n\nThe core of the rejection-enforced scheme is that any proposed state $\\mathbf{x}'$ that falls outside the feasible set $\\Omega$ is rejected with probability $1$. The acceptance probability formula, as shown in the analysis of option A, contains the term $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$, which is strictly zero if $\\mathbf{x}' \\notin \\Omega$. Therefore, it is impossible for the chain to \"accept with small probability\" a move into the forbidden region. The chain can never \"traverse\" a constraint barrier by moving into it.\nIf the feasible set $\\Omega$ consists of two or more disconnected components, say $\\Omega_1$ and $\\Omega_2$, a chain started in $\\Omega_1$ can only move to $\\Omega_2$ if the proposal distribution $q(\\mathbf{x}' \\mid \\mathbf{x})$ has non-zero probability of proposing a state in $\\Omega_2$ from a state in $\\Omega_1$. For local proposal distributions (e.g., small-step random walks), if the components are separated by a finite distance, the probability of such a jump is often zero or exponentially small. The MCMC scheme does not *guarantee* mixing; in fact, for disconnected domains, ergodicity is often broken. The justification provided in the option is factually incorrect.\n\nVerdict: **Incorrect**.\n\n**E. For non-symmetric proposals, detailed balance for the constrained target is maintained by using $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$, which is independent of the proposal density $q(\\mathbf{x}' \\mid \\mathbf{x})$.**\n\nThis statement proposes using the Metropolis acceptance probability (which is valid for symmetric proposals, $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$) in a situation where the proposal is non-symmetric ($q(\\mathbf{x}' \\mid \\mathbf{x}) \\neq q(\\mathbf{x} \\mid \\mathbf{x}')$).\nThe correct acceptance probability for a general proposal distribution is given by the Metropolis-Hastings formula:\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\min\\left\\{1, \\frac{\\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}')}{\\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\nFor our constrained distribution $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$, this becomes (for $\\mathbf{x} \\in \\Omega$):\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\left\\{1, \\frac{e^{-\\beta U(\\mathbf{x}')}}{e^{-\\beta U(\\mathbf{x})}} \\frac{q(\\mathbf{x} \\mid \\mathbf{x}')}{q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\nThis formula explicitely depends on the ratio of the proposal densities, $q(\\mathbf{x} \\mid \\mathbf{x}')/q(\\mathbf{x}' \\mid \\mathbf{x})$. If this ratio is not equal to $1$, omitting it from the acceptance probability calculation will, in general, violate detailed balance. The acceptance rule proposed in the option is independent of $q$, which is precisely why it is incorrect for non-symmetric proposals.\n\nVerdict: **Incorrect**.",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "A common failure mode in simulations of complex systems is nonergodicity, where the system becomes trapped in a small region of its vast state space, unable to sample other important configurations. This practical exercise places you in the role of a computational scientist tasked with diagnosing and fixing such a problem in a molecular simulation. You will learn how to design a principled diagnostic test for nonergodicity and, more importantly, how to formulate a valid remedial move that restores ergodicity while rigorously preserving detailed balance for the target canonical ensemble.",
            "id": "3782926",
            "problem": "Consider a molecular system whose allowed configurations form a smooth constraint manifold $\\mathcal{M} \\subset \\mathbb{R}^{3N}$ described by holonomic constraints $C(\\boldsymbol{x}) = \\boldsymbol{0}$, where $\\boldsymbol{x} \\in \\mathbb{R}^{3N}$ collects all Cartesian coordinates. The system is simulated by Monte Carlo (MC; Monte Carlo) in the canonical ensemble at inverse temperature $\\beta = 1/(k_{\\mathrm{B}} T)$, targeting the stationary distribution $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$ supported on $\\mathcal{M}$ with respect to the induced surface measure $d\\sigma(\\boldsymbol{x})$. The current MC implementation proposes local single-dihedral rotations that preserve constraints but appears to remain confined to one conformational basin defined by the sign pattern of a set of ring dihedrals, suggesting possible nonergodicity.\n\nYour task is to choose, from the options below, the single best design that both (i) specifies a statistically principled diagnostic capable of detecting nonergodicity in such a canonical-ensemble MC simulation with constrained dihedrals and (ii) recommends remedial collective moves that preserve detailed balance on $\\mathcal{M}$ and can restore ergodicity without altering the target canonical distribution.\n\nDefinitions and foundational bases you may use:\n- Canonical ensemble: $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$ on the allowed configuration space with measure $d\\sigma(\\boldsymbol{x})$.\n- Detailed balance for a Markov chain with proposal density $q(\\boldsymbol{x} \\to \\boldsymbol{y})$ and acceptance $a(\\boldsymbol{x} \\to \\boldsymbol{y})$: $\\pi(\\boldsymbol{x}) q(\\boldsymbol{x} \\to \\boldsymbol{y}) a(\\boldsymbol{x} \\to \\boldsymbol{y}) = \\pi(\\boldsymbol{y}) q(\\boldsymbol{y} \\to \\boldsymbol{x}) a(\\boldsymbol{y} \\to \\boldsymbol{x})$.\n- Ergodicity: irreducibility and aperiodicity imply time averages converge to ensemble averages; if the state space decomposes into disconnected basins under the move set, violations occur.\n\nOptions:\nA. Diagnostic: Run two independent replicas initialized in distinct basins $B_1$ and $B_2$ identified by an order parameter $s(\\boldsymbol{x})$ that distinguishes basin membership (e.g., a vector of dihedral signs, or a scalar projection thereof). For each replica of length $L$, construct the empirical distribution $p_i^{(L)}(s)$, $i \\in \\{1,2\\}$, and monitor the Jensen–Shannon divergence $D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$. Conclude nonergodicity if $D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$ does not decay toward $0$ as $L \\to \\infty$. Remedy: Introduce concerted rotation moves that update a minimal set of coupled dihedrals $\\boldsymbol{\\theta} \\in \\mathbb{R}^{m}$ along the ring to maintain constraints exactly, using an invertible mapping $\\boldsymbol{x} = \\boldsymbol{x}(\\boldsymbol{\\theta})$ from internal coordinates to $\\mathcal{M}$. Propose $\\boldsymbol{\\theta}'$ from a symmetric density $q_\\theta(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_\\theta(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$ supported on the feasible set, and accept with\n$$\na(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\},\n$$\nwhere $\\left|J(\\boldsymbol{\\theta})\\right|$ is the absolute determinant associated with the change of variables from $\\boldsymbol{\\theta}$ to the surface measure $d\\sigma(\\boldsymbol{x})$ on $\\mathcal{M}$, ensuring detailed balance with respect to $\\pi(\\boldsymbol{x})\\, d\\sigma(\\boldsymbol{x})$.\n\nB. Diagnostic: Monitor the global Metropolis acceptance rate $\\alpha$ in a single long run and conclude nonergodicity if $\\alpha  0.01$. Remedy: Increase proposal step sizes and raise $T$ until $\\alpha  0.3$, then continue sampling at the elevated temperature using the same acceptance rule $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$.\n\nC. Diagnostic: Compute the integrated autocorrelation time of the potential energy $\\tau_{\\mathrm{int}}(U)$ from a single long run and declare nonergodicity when $\\tau_{\\mathrm{int}}(U)$ exceeds a preset threshold. Remedy: Add single-dihedral Gaussian proposals with small variance to improve local mobility; accept with $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$.\n\nD. Diagnostic: Perform block averaging of a single replica’s $s(\\boldsymbol{x})$ time series to verify that block means stabilize; if they plateau, conclude ergodicity. Remedy: Use Replica Exchange Monte Carlo (parallel tempering) with $K$ temperatures $\\beta_1  \\cdots  \\beta_K$, proposing swaps between neighboring replicas with acceptance $\\min\\{1, \\exp[(\\beta_i - \\beta_j)(U(\\boldsymbol{x}_j) - U(\\boldsymbol{x}_i))]\\}$ to promote basin hopping.\n\nSelect the option that satisfies both the diagnostic requirement and the remedial-move requirement, with rigorous compliance to canonical-ensemble detailed balance on the constrained manifold.",
            "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n- **System:** A molecular system whose configurations $\\boldsymbol{x} \\in \\mathbb{R}^{3N}$ are restricted to a smooth constraint manifold $\\mathcal{M} \\subset \\mathbb{R}^{3N}$.\n- **Constraints:** Holonomic, given by $C(\\boldsymbol{x}) = \\boldsymbol{0}$.\n- **Ensemble:** Canonical ensemble at inverse temperature $\\beta = 1/(k_{\\mathrm{B}} T)$.\n- **Target Distribution:** $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$ for $\\boldsymbol{x} \\in \\mathcal{M}$.\n- **Measure:** The target probability measure is $\\pi(\\boldsymbol{x}) d\\sigma(\\boldsymbol{x})$, where $d\\sigma(\\boldsymbol{x})$ is the induced surface measure on $\\mathcal{M}$.\n- **Simulation Method:** A Monte Carlo (MC) simulation is implemented.\n- **Existing Moves:** Local single-dihedral rotations that preserve the constraints $C(\\boldsymbol{x}) = \\boldsymbol{0}$.\n- **Observed Problem:** The simulation appears nonergodic, as it is confined to a single conformational basin defined by the sign pattern of ring dihedrals.\n- **Task:** Select the single best option that provides both (i) a statistically principled diagnostic for nonergodicity and (ii) a remedial set of collective moves that restore ergodicity while preserving detailed balance with respect to the target distribution on $\\mathcal{M}$.\n- **Provided Axioms:**\n    - Canonical distribution form: $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$ with measure $d\\sigma(\\boldsymbol{x})$.\n    - Detailed balance condition: $\\pi(\\boldsymbol{x}) q(\\boldsymbol{x} \\to \\boldsymbol{y}) a(\\boldsymbol{x} \\to \\boldsymbol{y}) = \\pi(\\boldsymbol{y}) q(\\boldsymbol{y} \\to \\boldsymbol{x}) a(\\boldsymbol{y} \\to \\boldsymbol{x})$.\n    - Ergodicity definition: Irreducibility and aperiodicity leading to the equivalence of time and ensemble averages.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding:** The problem is firmly grounded in computational statistical mechanics and molecular simulation. Simulating systems on constrained manifolds, targeting the canonical ensemble, and dealing with nonergodicity due to high energy barriers are all standard, well-established topics. The concepts presented are fundamental and correctly stated.\n- **Well-Posedness:** The problem is well-posed. It requests the identification of the single best design among a set of choices, based on clear criteria: a valid diagnostic and a valid remedy that adheres to the principles of statistical mechanics (specifically, detailed balance for the correct target measure).\n- **Objectivity:** The problem is described using precise, objective, and standard scientific terminology. There are no subjective or ambiguous statements.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. There are no identifiable flaws. The solution process will now proceed.\n\n### Derivation and Option Analysis\n\nThe core of the problem lies in correctly performing a Metropolis-Hastings Monte Carlo simulation on a manifold $\\mathcal{M}$, particularly when the proposed moves are generated in a different coordinate system (internal coordinates $\\boldsymbol{\\theta}$) than the one in which the potential energy is defined (Cartesian coordinates $\\boldsymbol{x}$).\n\nThe target probability measure is defined with respect to the surface measure on the manifold, $d\\mu(\\boldsymbol{x}) = \\pi(\\boldsymbol{x}) d\\sigma(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x})) d\\sigma(\\boldsymbol{x})$. If we propose moves using a new set of coordinates $\\boldsymbol{\\theta}$ via a mapping $\\boldsymbol{x}(\\boldsymbol{\\theta})$, we must account for the change of measure. The surface element transforms as $d\\sigma(\\boldsymbol{x}) = |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$, where $|J(\\boldsymbol{\\theta})|$ is the volume element of the metric induced by the embedding, often loosely called the Jacobian. The target probability density in the $\\boldsymbol{\\theta}$ coordinates, let's call it $p(\\boldsymbol{\\theta})$, is therefore:\n$$p(\\boldsymbol{\\theta})d\\boldsymbol{\\theta} \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$$\n$$p(\\boldsymbol{\\theta}) \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})|$$\nThe Metropolis-Hastings acceptance probability for a move from $\\boldsymbol{\\theta}$ to $\\boldsymbol{\\theta}'$ proposed with density $q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')$ is:\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}') q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})}{p(\\boldsymbol{\\theta}) q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')}\\right\\}$$\nIf a symmetric proposal density is used, $q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$, this simplifies to:\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}')}{p(\\boldsymbol{\\theta})}\\right\\} = \\min\\left\\{1, \\frac{\\exp(-\\beta U(\\boldsymbol{x}')) |J(\\boldsymbol{\\theta}')|}{\\exp(-\\beta U(\\boldsymbol{x})) |J(\\boldsymbol{\\theta})|}\\right\\} = \\min\\left\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]) \\frac{|J(\\boldsymbol{\\theta}')|}{|J(\\boldsymbol{\\theta})|}\\right\\}$$\nThis is the correct acceptance rule. Any remedy that involves internal coordinate moves must use this form to satisfy detailed balance with respect to the intended target distribution. Omitting the Jacobian ratio $|J(\\boldsymbol{\\theta}')|/|J(\\boldsymbol{\\theta})|$ is a common but critical error that leads to sampling from an incorrect distribution.\n\nWith this foundation, we evaluate the options.\n\n**Option A Evaluation:**\n- **Diagnostic:** Recommends initializing two or more independent simulations (replicas) in different conformational basins, characterized by an order parameter $s(\\boldsymbol{x})$. The Jensen-Shannon divergence, $D_{\\mathrm{JS}}$, a symmetrized version of the Kullback-Leibler divergence, is used to quantify the difference between the empirical distributions of $s(\\boldsymbol{x})$ gathered from each replica. If the simulation is ergodic, all replicas will eventually explore the full state space, causing their individual distributions to converge to the true equilibrium distribution. Consequently, $D_{\\mathrm{JS}}$ must decay to $0$ in the limit of long simulation time $L \\to \\infty$. A persistent non-zero $D_{\\mathrm{JS}}$ is a strong, statistically principled indicator of nonergodicity (i.e., the replicas are trapped). This is a robust and widely accepted diagnostic method.\n- **Remedy:** Proposes a collective move involving concerted rotation of ring dihedrals $\\boldsymbol{\\theta}$. This directly targets the problematic degrees of freedom. Crucially, the proposed acceptance probability is $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\}$. As derived above, this is the precisely correct formula for a Metropolis-Hastings move in internal coordinates that preserves detailed balance with respect to the canonical distribution on the constrained manifold $\\mathcal{M}$.\n- **Verdict:** Both the diagnostic and the remedy are rigorous, statistically sound, and correctly formulated. **Correct**.\n\n**Option B Evaluation:**\n- **Diagnostic:** Proposes using the global Metropolis acceptance rate $\\alpha$ as a diagnostic for nonergodicity. A low acceptance rate $(\\alpha  0.01)$ is suggested as the indicator. This is a flawed diagnostic. The acceptance rate is a measure of move efficiency, not ergodicity. A simulation can have a high acceptance rate (e.g., from taking very small steps) and still be confined to a single basin. Conversely, a simulation can be fully ergodic but have a low acceptance rate if proposals frequently land in high-energy regions. Therefore, $\\alpha$ is not a reliable indicator of irreducibility.\n- **Remedy:** Recommends increasing proposal step sizes and raising the temperature $T$. Raising $T$ alters the inverse temperature $\\beta$, which fundamentally changes the target distribution to $\\pi'(\\boldsymbol{x}) \\propto \\exp(-\\beta' U(\\boldsymbol{x}))$ with $\\beta'  \\beta$. The problem explicitly requires a remedy that does *not* alter the target canonical distribution. This proposal violates a key constraint. Furthermore, it proposes using the simple Metropolis acceptance rule, which is incorrect for internal coordinate moves as it omits the Jacobian correction term.\n- **Verdict:** The diagnostic is unreliable and the remedy is flawed on two counts: it changes the target ensemble and it uses an incorrect acceptance criterion. **Incorrect**.\n\n**Option C Evaluation:**\n- **Diagnostic:** Proposes using the integrated autocorrelation time of the potential energy, $\\tau_{\\mathrm{int}}(U)$, as a diagnostic. A large $\\tau_{\\mathrm{int}}(U)$ indicates slow decorrelation of the energy, which is often a symptom of poor sampling or getting trapped in a potential well. However, it is not a direct or definitive test for nonergodicity. A system can be ergodic but exhibit very slow dynamics (i.e., rare but possible transitions), which would also result in a large $\\tau_{\\mathrm{int}}$. It does not prove that the state space is fundamentally disconnected by the move set.\n- **Remedy:** Recommends adding more \"single-dihedral\" moves. The problem states that such moves are already in use and are the cause of the problem, as they are insufficient to produce the collective motion needed to cross the ring-puckering barrier. This remedy does not address the core issue. Moreover, it proposes the simple Metropolis acceptance rule, which, as established, is incorrect for dihedral angle moves due to the missing Jacobian term.\n- **Verdict:** The diagnostic is weak and indirect. The remedy is insufficient for the stated problem and employs an incorrect acceptance rule that violates detailed balance. **Incorrect**.\n\n**Option D Evaluation:**\n- **Diagnostic:** Recommends using block averaging on a single trajectory. Block averaging is a technique to estimate the statistical error of an average by observing the variance of means of successive blocks of data. If the block means stabilize, it indicates that the simulation has converged to a stationary state *within the region it is exploring*. However, if the simulation is nonergodic and trapped in one basin, the block averages will simply converge to the mean value for that basin, giving a dangerously false impression of global convergence. This diagnostic is incapable of detecting the existence of other, unexplored basins. It is fundamentally unsuitable for diagnosing this type of nonergodicity.\n- **Remedy:** Proposes Replica Exchange Monte Carlo (REMC), also known as parallel tempering. REMC is an excellent and powerful enhanced sampling technique for overcoming energy barriers. It maintains detailed balance and does not alter the target distribution at the temperature of interest (it samples other temperatures as well, but the $\\beta_1$ replica correctly samples the target ensemble). The acceptance rule for swaps is also correct. So, the remedy itself is a valid approach. However, the problem asks for the single best *design*, which includes the diagnostic.\n- **Verdict:** The remedy is valid, but the diagnostic is critically flawed and would lead to a false negative (i.e., failing to detect nonergodicity). Since the diagnostic part of the design fails completely, the option as a whole is unacceptable. **Incorrect**.\n\n### Conclusion\nOption A is the only option that presents both a statistically rigorous diagnostic for nonergodicity (comparison of independent replicas) and a physically appropriate remedial move (concerted rotation) with the correct Metropolis-Hastings acceptance probability that includes the necessary Jacobian factor to ensure detailed balance is satisfied on the constrained manifold.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}