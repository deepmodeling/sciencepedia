{
    "hands_on_practices": [
        {
            "introduction": "The Lattice Boltzmann Method elegantly breaks down fluid dynamics into two simple, repeated steps: a local 'collision' and a 'streaming' or propagation step. To build a solid understanding, this first practice exercise  requires you to manually perform a single time step for a given initial state. This problem highlights the crucial role of local mass and momentum conservation during the collision phase and reveals how these conserved quantities behave in a spatially uniform system, providing a surprisingly deep insight for a seemingly simple calculation.",
            "id": "3820128",
            "problem": "Consider a single-relaxation-time Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) on the standard two-dimensional nine-velocity lattice (D2Q9). The discrete velocities are\n$$\n\\mathbf{c}_0 = (0,0),\\quad\n\\mathbf{c}_1 = (1,0),\\quad\n\\mathbf{c}_2 = (0,1),\\quad\n\\mathbf{c}_3 = (-1,0),\\quad\n\\mathbf{c}_4 = (0,-1),\\quad\n\\mathbf{c}_5 = (1,1),\\quad\n\\mathbf{c}_6 = (-1,1),\\quad\n\\mathbf{c}_7 = (-1,-1),\\quad\n\\mathbf{c}_8 = (1,-1),\n$$\nwith weights\n$$\nw_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4=\\frac{1}{9},\\quad w_5=w_6=w_7=w_8=\\frac{1}{36}.\n$$\nAssume lattice units with $\\Delta x = \\Delta t = 1$, so the lattice speed is $c=1$ and the isothermal speed of sound satisfies $c_s^2 = \\frac{1}{3}$. The discrete Boltzmann equation with the BGK collision operator is\n$$\nf_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) - f_i(\\mathbf{x},t) = -\\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})\\right],\n$$\nwhere $\\tau$ is the relaxation time and $f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})$ is the second-order equilibrium distribution given by\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u}) = w_i\\,\\rho\\left[1 + \\frac{\\mathbf{c}_i\\cdot\\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i\\cdot\\mathbf{u})^2}{2\\,c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2\\,c_s^2}\\right].\n$$\nThe macroscopic density and velocity are defined by the zeroth and first moments,\n$$\n\\rho(\\mathbf{x},t) = \\sum_{i=0}^{8} f_i(\\mathbf{x},t),\\qquad \\rho(\\mathbf{x},t)\\,\\mathbf{u}(\\mathbf{x},t) = \\sum_{i=0}^{8} f_i(\\mathbf{x},t)\\,\\mathbf{c}_i.\n$$\nLet the relaxation time be $\\tau = 1$ so that $\\omega := \\Delta t/\\tau = 1$. Consider a spatially uniform initial condition across the lattice at time $t_0$, so the following distribution values apply at every lattice node:\n$$\n\\begin{aligned}\n(\\mathbf{x},t_0) = 0.4415778,\\quad f_1(\\mathbf{x},t_0) = 0.1490944,\\quad f_2(\\mathbf{x},t_0) = 0.0920111,\\\\\n(\\mathbf{x},t_0) = 0.0790944,\\quad f_4(\\mathbf{x},t_0) = 0.1306778,\\quad f_5(\\mathbf{x},t_0) = 0.0334528,\\\\\n(\\mathbf{x},t_0) = 0.0116528,\\quad f_7(\\mathbf{x},t_0) = 0.0241194,\\quad f_8(\\mathbf{x},t_0) = 0.0383194.\n\\end{aligned}\n$$\nPerform one full collide–stream time step to obtain $f_i(\\mathbf{x},t_0+\\Delta t)$ at a node. Then update the macroscopic fields $\\rho(\\mathbf{x},t_0+\\Delta t)$ and $\\mathbf{u}(\\mathbf{x},t_0+\\Delta t)$ at that node. Express the final answer as a row matrix containing $\\rho, u_x, u_y$ in lattice units, and round your entries to six significant figures.",
            "solution": "The objective is to determine the macroscopic density $\\rho$ and velocity $\\mathbf{u} = (u_x, u_y)$ at a lattice node at time $t_0+\\Delta t$, after performing one full time step of the Lattice Boltzmann Method (LBM), starting from a given initial state at time $t_0$.\n\nThe LBM algorithm for a single time step consists of two sequential processes: collision and streaming. The evolution of the discrete distribution functions $f_i(\\mathbf{x},t)$ is described by the discrete Boltzmann equation with the BGK collision operator:\n$$ f_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) = f_i(\\mathbf{x},t) - \\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})\\right] $$\nThis equation can be conceptually split. First, a local collision step at each node $\\mathbf{x}$ calculates the post-collision state, denoted $f_i^*(\\mathbf{x}, t)$:\n$$ f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x},t) - \\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x},t),\\mathbf{u}(\\mathbf{x},t))\\right] $$\nSecond, a streaming (or propagation) step follows, where the post-collision populations move to adjacent nodes according to their discrete velocities:\n$$ f_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) = f_i^*(\\mathbf{x}, t) $$\nTo find the populations $f_i$ at a node $\\mathbf{x}$ at the new time $t_0+\\Delta t$, we must gather the post-collision populations from the neighboring nodes at the previous time $t_0$. This can be expressed as:\n$$ f_i(\\mathbf{x}, t_0+\\Delta t) = f_i^*(\\mathbf{x}-\\mathbf{c}_i\\Delta t, t_0) $$\nThe problem states that the initial condition at time $t_0$ is spatially uniform. This means that the initial distribution functions $f_i(\\mathbf{x}, t_0)$ have the same values at every lattice node $\\mathbf{x}$. Let us denote these uniform initial values as $f_i(t_0)$.\n\nAs a direct consequence of this uniformity, the initial macroscopic fields, density $\\rho(t_0)$ and velocity $\\mathbf{u}(t_0)$, are also constant across the entire lattice. They are calculated from the moments of the initial distributions:\n$$ \\rho(t_0) = \\sum_{i=0}^{8} f_i(t_0) $$\n$$ \\rho(t_0)\\mathbf{u}(t_0) = \\sum_{i=0}^{8} f_i(t_0)\\mathbf{c}_i $$\nSince the collision step is purely local, and the inputs to it ($f_i(t_0)$, $\\rho(t_0)$, and $\\mathbf{u}(t_0)$) are uniform, the post-collision populations $f_i^*(t_0)$ must also be spatially uniform.\n\nWith $f_i^*(t_0)$ being uniform, the streaming step simplifies significantly. The value of $f_i^*(\\mathbf{x}-\\mathbf{c}_i\\Delta t, t_0)$ is the same regardless of the position $\\mathbf{x}-\\mathbf{c}_i\\Delta t$, and is equal to the constant value $f_i^*(t_0)$. Therefore, the populations at any node $\\mathbf{x}$ at the next time step are:\n$$ f_i(\\mathbf{x}, t_0+\\Delta t) = f_i^*(t_0) $$\nThe new macroscopic fields at time $t_0+\\Delta t$ are the moments of these new populations:\n$$ \\rho(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i^*(t_0) $$\n$$ \\rho(\\mathbf{x}, t_0+\\Delta t)\\mathbf{u}(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t_0+\\Delta t)\\mathbf{c}_i = \\sum_{i=0}^{8} f_i^*(t_0)\\mathbf{c}_i $$\nA fundamental property of the BGK collision operator is that it conserves mass and momentum locally. This means the zeroth and first moments of the post-collision distributions are identical to those of the pre-collision distributions:\n$$ \\sum_{i=0}^{8} f_i^*(t_0) = \\sum_{i=0}^{8} f_i(t_0) = \\rho(t_0) $$\n$$ \\sum_{i=0}^{8} f_i^*(t_0)\\mathbf{c}_i = \\sum_{i=0}^{8} f_i(t_0)\\mathbf{c}_i = \\rho(t_0)\\mathbf{u}(t_0) $$\nThis conservation property holds for any value of the relaxation time $\\tau$.\n\nCombining these facts, we find that the macroscopic fields at time $t_0+\\Delta t$ are identical to those at time $t_0$:\n$$ \\rho(t_0+\\Delta t) = \\rho(t_0) $$\n$$ \\rho(t_0+\\Delta t)\\mathbf{u}(t_0+\\Delta t) = \\rho(t_0)\\mathbf{u}(t_0) $$\nSince the density is non-zero, this implies $\\mathbf{u}(t_0+\\Delta t) = \\mathbf{u}(t_0)$.\nTherefore, for a spatially uniform system, the macroscopic fields are stationary. The problem reduces to calculating the macroscopic fields from the given initial distributions $f_i(t_0)$.\n\nThe initial distributions are:\n$f_0(t_0) = 0.4415778$, $f_1(t_0) = 0.1490944$, $f_2(t_0) = 0.0920111$, $f_3(t_0) = 0.0790944$, $f_4(t_0) = 0.1306778$, $f_5(t_0) = 0.0334528$, $f_6(t_0) = 0.0116528$, $f_7(t_0) = 0.0241194$, $f_8(t_0) = 0.0383194$.\n\nFirst, we calculate the initial density $\\rho(t_0)$:\n$$ \\rho(t_0) = \\sum_{i=0}^{8} f_i(t_0) = 0.4415778 + 0.1490944 + 0.0920111 + 0.0790944 + 0.1306778 + 0.0334528 + 0.0116528 + 0.0241194 + 0.0383194 $$\n$$ \\rho(t_0) = 0.9999999 $$\nNext, we calculate the initial momentum $\\rho(t_0)\\mathbf{u}(t_0) = (\\rho u_x, \\rho u_y)$:\nThe $x$-component of the momentum is:\n$$ \\rho u_x(t_0) = \\sum_{i=0}^{8} f_i(t_0)c_{ix} = f_1 - f_3 + f_5 - f_6 - f_7 + f_8 $$\n$$ \\rho u_x(t_0) = 0.1490944 - 0.0790944 + 0.0334528 - 0.0116528 - 0.0241194 + 0.0383194 $$\n$$ \\rho u_x(t_0) = 0.1060000 $$\nThe $y$-component of the momentum is:\n$$ \\rho u_y(t_0) = \\sum_{i=0}^{8} f_i(t_0)c_{iy} = f_2 - f_4 + f_5 + f_6 - f_7 - f_8 $$\n$$ \\rho u_y(t_0) = 0.0920111 - 0.1306778 + 0.0334528 + 0.0116528 - 0.0241194 - 0.0383194 $$\n$$ \\rho u_y(t_0) = -0.0559999 $$\nFrom these values, we determine the initial macroscopic fields. As $\\rho(t_0) = 0.9999999 \\approx 1.0$, we have:\n$$ u_x(t_0) = \\frac{0.1060000}{0.9999999} \\approx 0.1060000 $$\n$$ u_y(t_0) = \\frac{-0.0559999}{0.9999999} \\approx -0.0559999 $$\nAs established, these macroscopic values are unchanged after one time step. The problem requires the answer to be rounded to six significant figures.\n$\\rho(t_0+\\Delta t) = 0.9999999 \\approx 1.00000$\n$u_x(t_0+\\Delta t) = 0.1060000 \\approx 0.106000$\n$u_y(t_0+\\Delta t) = -0.0559999 \\approx -0.0560000$\n\nThe requested result is the row matrix containing $(\\rho, u_x, u_y)$ at time $t_0+\\Delta t$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1.00000  0.106000  -0.0560000 \\end{pmatrix} } $$"
        },
        {
            "introduction": "A powerful simulation tool is only useful if its parameters can be mapped to measurable physical properties. For the LBM, the relaxation time $\\tau$ governs the rate at which the fluid relaxes to equilibrium, which is directly related to its viscosity. This exercise  guides you through the foundational Chapman-Enskog expansion to derive the analytical relationship between $\\tau$ and the physical kinematic viscosity $\\nu_{phys}$, a critical step in setting up any LBM simulation to model a real-world fluid.",
            "id": "3971752",
            "problem": "Consider the single-relaxation-time Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) applied to incompressible flow on the three-dimensional, nineteen-velocity discrete set $D3Q19$ used in aerospace Computational Fluid Dynamics (CFD). The discrete velocities are constructed so that streaming advances populations by one lattice spacing per time step along each discrete direction, and the second-order isotropy of the equilibrium ensures a lattice sound speed squared $c_{s}^{2}$ consistent with the $D3Q19$ quadrature. You are given a physical kinematic viscosity $ \\nu_{phys} $ (with units of $L^{2}/T$), a lattice spacing $ \\Delta x $ (with units of $L$), and a time step $ \\Delta t $ (with units of $T$). \n\nStarting from the kinetic transport equation with a BGK collision operator, the definition of macroscopic moments, and the Newtonian constitutive relation for viscous stress, perform a Chapman–Enskog expansion to recover the Navier–Stokes equations in the hydrodynamic limit for the $D3Q19$ lattice. From this derivation, obtain the analytic expression for the relaxation time $ \\tau $ required for the discrete model to reproduce the target physical viscosity $ \\nu_{phys} $ on the given lattice characterized by $ \\Delta x $ and $ \\Delta t $. Use the $D3Q19$ value $ c_{s}^{2} = 1/3 $. Present your final answer as a single closed-form expression for $ \\tau $.\n\nAdditionally, based on the same derivation, identify the leading numerical constraints on $ \\tau $, $ \\Delta x $, and $ \\Delta t $ that ensure the method remains dissipative and accurate in the low-Mach-number limit. Your commentary on constraints must be supported by the scaling that emerges from the hydrodynamic limit, but the final reported answer must remain the single expression for $ \\tau $. No numerical substitution is required. Express the final answer without units.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a standard, non-trivial derivation in the field of computational fluid dynamics, specifically concerning the Lattice Boltzmann Method (LBM). All premises are factually correct and all required information is provided.\n\nThe objective is to derive the relationship between the single relaxation time $\\tau$ of the Bhatnagar–Gross–Krook (BGK) model and the physical kinematic viscosity $\\nu_{phys}$ for a $D3Q19$ lattice. This is achieved by recovering the macroscopic Navier–Stokes equations from the discrete lattice Boltzmann equation via a Chapman–Enskog expansion.\n\nWe begin with the discrete lattice Boltzmann equation (LBE) with the BGK collision operator. For clarity, we will first perform the derivation in lattice units, where the lattice spacing $\\Delta x = 1$ and the time step $\\Delta t = 1$. The discrete particle velocities are then denoted by $\\mathbf{e}_i$, and the speed of light on the lattice is $c=1$. The LBE is:\n$$ f_i(\\mathbf{x} + \\mathbf{e}_i, t+1) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)] $$\nwhere $f_i$ is the particle distribution function along the $i$-th direction, $\\mathbf{x}$ and $t$ are lattice coordinates and time, and $\\tau$ is the dimensionless relaxation time. The equilibrium distribution function, $f_i^{eq}$, for low-Mach-number flows is a second-order expansion in the macroscopic velocity $\\mathbf{u}$:\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u}^2}{2c_s^2} \\right) $$\nHere, $w_i$ are the $D3Q19$ lattice weights, $\\rho$ is the macroscopic density, and $c_s$ is the lattice speed of sound, given as $c_s^2 = 1/3$. The macroscopic density and momentum are moments of the distribution functions:\n$$ \\rho = \\sum_i f_i = \\sum_i f_i^{eq} $$\n$$ \\rho \\mathbf{u} = \\sum_i f_i \\mathbf{e}_i = \\sum_i f_i^{eq} $$\nThe BGK collision operator conserves mass and momentum, which implies $\\sum_i (f_i - f_i^{eq}) = 0$ and $\\sum_i \\mathbf{e}_i (f_i - f_i^{eq}) = 0$.\n\nTo recover the macroscopic equations, we perform a Chapman–Enskog expansion. We introduce a small parameter $\\epsilon$ (proportional to the Knudsen and Mach numbers) and assume that the distribution function and the time and space derivatives can be expanded in multiple scales:\n- $f_i = f_i^{(0)} + \\epsilon f_i^{(1)} + \\epsilon^2 f_i^{(2)} + \\mathcal{O}(\\epsilon^3)$\n- $\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}$\n- $\\nabla = \\epsilon \\nabla_1$\n\nWe first Taylor-expand the discrete LBE in the time step (which is $1$ in lattice units):\n$$ (\\partial_t + \\mathbf{e}_i \\cdot \\nabla)f_i + \\frac{1}{2}(\\partial_t + \\mathbf{e}_i \\cdot \\nabla)^2 f_i + \\mathcal{O}(\\Delta t^3) = -\\frac{1}{\\tau}(f_i - f_i^{eq}) $$\nBy convention of the Chapman-Enskog procedure, we enforce that the macroscopic variables are fully captured by the equilibrium distribution, meaning $f_i^{(0)} = f_i^{eq}$ and the non-equilibrium parts have zero contribution to mass and momentum: $\\sum_i f_i^{(k)}=0$ and $\\sum_i \\mathbf{e}_i f_i^{(k)}=0$ for $k \\ge 1$.\n\nSubstituting the multi-scale expansions into the Taylor-expanded LBE and collecting terms by powers of $\\epsilon$:\n\nOrder $\\epsilon^1$:\n$$ (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(1)} $$\nThis gives an expression for the first-order non-equilibrium distribution:\n$$ f_i^{(1)} = -\\tau (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha}) f_i^{(0)} $$\n\nOrder $\\epsilon^2$:\n$$ \\partial_{t_2} f_i^{(0)} + (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(1)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nSubstituting the expression for $f_i^{(1)}$ into the second term:\n$$ \\partial_{t_2} f_i^{(0)} - \\tau (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nThis simplifies to:\n$$ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nNow, we take moments of these scaled equations to find the macroscopic governing equations. Taking moments of the $\\mathcal{O}(\\epsilon^1)$ equation yields the compressible Euler equations (mass and momentum conservation at the first time scale). The momentum equation at this scale is:\n$$ \\partial_{t_1}(\\rho u_\\beta) + \\partial_{1\\alpha} \\Pi_{\\alpha\\beta}^{(0)} = 0 $$\nwhere $\\Pi_{\\alpha\\beta}^{(0)} = \\sum_i e_{i\\alpha}e_{i\\beta} f_i^{(0)} = \\rho u_\\alpha u_\\beta + p \\delta_{\\alpha\\beta}$ is the equilibrium momentum flux tensor, and pressure $p = \\rho c_s^2$.\n\nTo find the viscous term, we take the first moment (multiply by $e_{i\\beta}$ and sum over $i$) of the $\\mathcal{O}(\\epsilon^2)$ equation. The term $\\sum_i e_{i\\beta} f_i^{(2)}$ on the right-hand side is zero due to the conservation constraint.\n$$ \\sum_i e_{i\\beta} \\left[ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} \\right] = 0 $$\n$$ \\partial_{t_2}(\\rho u_\\beta) - \\left(\\tau - \\frac{1}{2}\\right) \\sum_i e_{i\\beta} (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = 0 $$\nThe second term contains the viscous contribution. In the low-Mach-number limit, time derivatives are of higher order in Mach number than spatial derivatives, so we approximate $(\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 \\approx (e_{i\\alpha} \\partial_{1\\alpha})^2$. The term becomes:\n$$ \\partial_{1\\gamma} \\partial_{1\\delta} \\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} $$\nThis is a derivative of the third-order moment of the equilibrium distribution. For low Mach numbers, $\\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} \\approx \\rho c_s^2 (u_\\beta \\delta_{\\gamma\\delta} + u_\\gamma \\delta_{\\beta\\delta} + u_\\delta \\delta_{\\beta\\gamma})$.\nApplying the derivatives and assuming an incompressible fluid ($\\nabla \\cdot \\mathbf{u} = 0$), this term evaluates to $\\rho c_s^2 \\nabla_1^2 u_\\beta$. The momentum equation at the $\\mathcal{O}(\\epsilon^2)$ scale is then:\n$$ \\partial_{t_2}(\\rho u_\\beta) = \\left(\\tau - \\frac{1}{2}\\right) \\rho c_s^2 \\nabla_1^2 u_\\beta $$\nCombining the momentum equations from scales $\\epsilon^1$ and $\\epsilon^2$ and reverting to physical-scale derivatives ($\\partial_t, \\nabla$):\n$$ \\partial_t(\\rho u_\\beta) + \\partial_\\alpha(\\rho u_\\alpha u_\\beta) = -\\partial_\\beta p + \\rho c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\nabla^2 u_\\beta $$\nThis is the incompressible Navier–Stokes equation:\n$$ \\rho(\\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta) = -\\partial_\\beta p + \\mu \\nabla^2 u_\\beta $$\nwhere $\\mu$ is the dynamic viscosity. Dividing by $\\rho$ gives the equation in terms of kinematic viscosity $\\nu = \\mu/\\rho$:\n$$ \\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta = -\\frac{1}{\\rho}\\partial_\\beta p + \\nu \\nabla^2 u_\\beta $$\nBy comparing the viscous terms, we identify the kinematic viscosity in lattice units:\n$$ \\nu_{latt} = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) $$\nThis expression relates the dimensionless parameters of the lattice simulation. To find the physical viscosity $\\nu_{phys}$, we must introduce the physical lattice spacing $\\Delta x$ and time step $\\Delta t$. Kinematic viscosity has units of $[L^2/T]$. The conversion factor from lattice units to physical units is:\n$$ \\nu_{phys} = \\nu_{latt} \\frac{\\Delta x^2}{\\Delta t} $$\nSubstituting the expression for $\\nu_{latt}$ and the given value $c_s^2 = 1/3$:\n$$ \\nu_{phys} = \\frac{1}{3} \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t} $$\nSolving this equation for the relaxation time $\\tau$ yields the desired expression:\n$$ 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\tau - \\frac{1}{2} $$\n$$ \\tau = 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2} $$\n\nBased on this derivation, we can identify two critical constraints.\nFirst, for the method to be physically dissipative and numerically stable, the lattice viscosity must be positive, $\\nu_{latt} > 0$. Since $c_s^2 > 0$, this implies a fundamental constraint on the relaxation time:\n$$ \\tau > \\frac{1}{2} $$\nSecond, the Chapman-Enskog expansion is valid only in the hydrodynamic limit, where the mean free path is much smaller than characteristic flow lengths. In LBM, the mean free path is proportional to $\\nu_{latt} \\propto (\\tau - 1/2)$. A large value of $\\tau$ implies a departure from this limit, leading to inaccuracies. Therefore, $\\tau$ must be kept on the order of unity, e.g., $\\tau  2$. This imposes a constraint on the choice of grid parameters:\n$$ \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\frac{1}{3}\\left(\\tau - \\frac{1}{2}\\right) = \\mathcal{O}(1) $$\nThis is the diffusive scaling of LBM, which requires that as the grid is refined ($\\Delta x \\to 0$), the time step must be decreased quadratically ($\\Delta t \\propto \\Delta x^2$) to maintain a constant $\\tau$. This must be balanced with the advective scaling constraint, $\\Delta t \\propto \\Delta x$, required to keep the Mach number low and control compressibility errors.",
            "answer": "$$\\boxed{3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2}}$$"
        },
        {
            "introduction": "The continuum Navier-Stokes equations are Galilean invariant, meaning the physics of a flow are independent of the constant velocity of the observer's reference frame. While the LBM recovers these equations in the hydrodynamic limit, its discrete nature introduces subtle errors that can break this fundamental symmetry. This final practice  moves from theory to a full numerical experiment, tasking you with simulating a Couette flow with a superimposed velocity to directly measure and quantify the LBM's Galilean invariance error, providing valuable experience in designing and critically analyzing a CFD simulation.",
            "id": "3971766",
            "problem": "You are to evaluate Galilean invariance error in a two-dimensional Couette flow using the Lattice Boltzmann Method (LBM) within Computational Fluid Dynamics (CFD). The goal is to quantify how the computed shear stress deviates when a uniform background translation velocity is superposed on the Couette flow. The derivation and implementation must be based on first principles of the discrete Boltzmann equation and a single-relaxation-time Bhatnagar–Gross–Krook (BGK) collision operator.\n\nStart from the following fundamental base: the discrete-velocity Boltzmann equation in the Lattice Boltzmann Method (LBM) with BGK relaxation, where populations $f_i$ evolve on a uniform Cartesian lattice with discrete velocities $\\mathbf{c}_i$ and quadrature weights $w_i$. Use the standard two-dimensional nine-velocity model (D2Q9), where the discrete velocities are $\\mathbf{c}_0=(0,0)$, $\\mathbf{c}_1=(1,0)$, $\\mathbf{c}_2=(0,1)$, $\\mathbf{c}_3=(-1,0)$, $\\mathbf{c}_4=(0,-1)$, $\\mathbf{c}_5=(1,1)$, $\\mathbf{c}_6=(-1,1)$, $\\mathbf{c}_7=(-1,-1)$, $\\mathbf{c}_8=(1,-1)$ and weights $w_0=\\frac{4}{9}$, $w_{1,2,3,4}=\\frac{1}{9}$, $w_{5,6,7,8}=\\frac{1}{36}$. The isothermal lattice speed of sound is $c_s^2=\\frac{1}{3}$. The equilibrium distribution $f_i^{\\mathrm{eq}}$ is the second-order Hermite expansion consistent with the discretization, and the relaxation time $\\tau$ relates to the kinematic viscosity through $\\nu=c_s^2(\\tau-\\frac{1}{2})$. Macroscopic density $\\rho$ and velocity $\\mathbf{u}$ are recovered by zeroth and first moments of $f_i$, respectively.\n\nSet up a two-dimensional channel of height $N_y$ nodes and length $N_x$ nodes, with periodic boundary conditions in the streamwise direction and velocity boundary conditions at the two horizontal walls ($y=0$ and $y=N_y-1$). Implement standard Zou–He velocity boundary conditions to impose wall velocities. Configure a Couette flow where the bottom wall moves with velocity $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$ and the top wall moves with velocity $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$, where $U_0$ is a uniform background translation and $U_\\mathrm{rel}$ is the relative plate velocity generating shear. Initialize the fluid uniformly with density $\\rho_0=1$ and velocity $\\mathbf{u}=(U_0,0)$.\n\nBy Galilean invariance in the continuum Navier–Stokes equations, for a Newtonian fluid in Couette flow, the shear stress should depend only on the relative velocity $U_\\mathrm{rel}$ and the channel height, and should not change when a uniform background velocity $U_0$ is superposed. In lattice Boltzmann, discretization and truncation errors can introduce Galilean invariance violations that manifest as deviations in the computed shear stress when $U_0\\neq 0$. After the simulation reaches steady state, estimate the shear stress $\\tau_{xy}$ as $\\tau_{xy}=\\bar{\\rho}\\,\\nu\\,\\frac{du_x}{dy}$, where $\\bar{\\rho}$ is the domain-average density, $\\nu$ is the kinematic viscosity, and $\\frac{du_x}{dy}$ is the slope of the mean streamwise velocity profile across the channel. Compute $\\frac{du_x}{dy}$ by a least-squares linear fit of the streamwise velocity averaged in the periodic direction, using interior nodes to avoid direct boundary effects.\n\nImplement the full simulation in lattice units with $\\Delta x=1$ and $\\Delta t=1$, using the D2Q9 model and single-relaxation-time BGK collision, periodic boundary conditions in $x$, and Zou–He velocity boundary conditions at $y=0$ and $y=N_y-1$. Use $N_x=64$, $N_y=17$, $\\tau=0.8$, $U_\\mathrm{rel}=0.1$, and run for $T=1500$ time steps. Express all quantities in dimensionless lattice units; no physical unit conversion is required.\n\nDesign a test suite of four cases with background velocities $U_0\\in\\{0.0, 0.1, -0.1, 0.3\\}$. For each case, run the simulation and compute the steady-state shear stress $\\tau_{xy}(U_0)$. Use the baseline case at $U_0=0.0$ to define a normalized absolute deviation as $\\epsilon(U_0)=\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|/\\left|\\tau_{xy}(0.0)\\right|$, which is a dimensionless decimal fraction. The expected result type for each test case is a float.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). The sequence must correspond to $U_0=0.0$, $U_0=0.1$, $U_0=-0.1$, and $U_0=0.3$ in that order. No additional text should be printed.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the well-established principles of the Lattice Boltzmann Method (LBM) for computational fluid dynamics, specifically using the Bhatnagar–Gross–Krook (BGK) approximation. The setup describes a standard numerical experiment to investigate a known, non-trivial artifact of the LBM—the lack of perfect Galilean invariance. The problem is well-posed, providing all necessary parameters, initial conditions, boundary conditions, and a clear, objective procedure for computing the desired quantities. The parameters chosen are reasonable for a stable and meaningful numerical simulation.\n\nThe objective is to quantify the Galilean invariance error in a two-dimensional LBM simulation of Couette flow. In continuum mechanics, the Navier-Stokes equations are Galilean invariant, meaning the physics of the flow, including shear stress, are independent of the constant velocity of the reference frame. Superposing a uniform translational velocity $\\mathbf{U}_0$ onto a flow should not alter the internal stresses. However, the discrete nature of the LBM introduces truncation errors that break this invariance, particularly at non-negligible Mach numbers. This error manifests as a dependency of computed quantities, such as shear stress, on the background velocity $U_0$.\n\nWe will simulate a two-dimensional Couette flow in a channel of height $N_y$ and length $N_x$. The fluid is confined between two parallel plates. The bottom plate at $y=0$ moves with velocity $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$, and the top plate at $y=N_y-1$ moves with velocity $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$. All quantities are expressed in dimensionless lattice units, where the lattice spacing $\\Delta x = 1$ and the time step $\\Delta t = 1$.\n\nThe simulation is governed by the discrete-velocity Boltzmann equation with the single-relaxation-time BGK collision operator:\n$$\nf_i(\\mathbf{x}+\\mathbf{c}_i \\Delta t, t+\\Delta t) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right)\n$$\nwhere $f_i(\\mathbf{x}, t)$ is the particle distribution function for the discrete velocity $\\mathbf{c}_i$ at lattice site $\\mathbf{x}$ and time $t$. $\\tau$ is the relaxation time, which controls the fluid's viscosity. The LBM algorithm proceeds in two main steps:\n\n1.  **Collision Step**: At each lattice node, the distribution functions $f_i$ relax towards a local equilibrium distribution $f_i^{\\mathrm{eq}}$.\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) \\right)\n    $$\n    where $f_i^*$ are the post-collision distribution functions. The macroscopic density $\\rho$ and velocity $\\mathbf{u}$ are computed from the moments of the distribution functions:\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i \\quad \\text{and} \\quad \\rho\\mathbf{u} = \\sum_{i=0}^{8} f_i \\mathbf{c}_i\n    $$\n\n2.  **Streaming Step**: The post-collision populations $f_i^*$ move to adjacent lattice nodes according to their discrete velocities:\n    $$\n    f_i(\\mathbf{x}+\\mathbf{c}_i, t+1) = f_i^*(\\mathbf{x}, t)\n    $$\n    (with $\\Delta x=1, \\Delta t=1$).\n\nThe simulation uses the standard D2Q9 lattice model, for which the discrete velocities $\\mathbf{c}_i$ and weights $w_i$ are given. The equilibrium distribution function $f_i^{\\mathrm{eq}}$ is a second-order polynomial expansion of the Maxwell-Boltzmann distribution in velocity, given by:\n$$\nf_i^{\\mathrm{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n$$\nwhere $c_s=1/\\sqrt{3}$ is the lattice speed of sound. The kinematic viscosity $\\nu$ is related to the relaxation time by $\\nu = c_s^2(\\tau - 0.5)$.\n\nThe simulation domain is a grid of size $N_x=64$ by $N_y=17$. Boundary conditions are periodic in the streamwise ($x$) direction. In the transverse ($y$) direction, Zou-He velocity boundary conditions are applied at the walls ($y=0$ and $y=N_y-1$). For a wall node with a specified velocity $\\mathbf{u}_w=(u_{wx}, u_{wy}=0)$, the unknown incoming populations are reconstructed after the streaming step. For the bottom wall ($y=0$), the unknowns are $f_2, f_5, f_6$. They are determined as follows:\nFirst, the wall density $\\rho_w$ is calculated from the known, post-stream populations at the wall node:\n$$\n\\rho_w = f_0 + f_1 + f_3 + 2(f_4 + f_7 + f_8)\n$$\nThen, the unknown populations are computed using $\\rho_w$ and the known wall velocity $u_{wx}$:\n$$\nf_2 = f_4\n$$\n$$\nf_5 = f_7 - \\frac{1}{2}(f_1-f_3) + \\frac{1}{2}\\rho_w u_{wx}\n$$\n$$\nf_6 = f_8 + \\frac{1}{2}(f_1-f_3) - \\frac{1}{2}\\rho_w u_{wx}\n$$\nA symmetric set of relations is used for the top wall ($y=N_y-1$).\n\nThe simulation is initialized with a uniform density $\\rho_0=1$ and velocity $\\mathbf{u}_{init}=(U_0, 0)$. It is run for $T=1500$ time steps to allow the flow to reach a steady state.\n\nAfter reaching steady state, the shear stress $\\tau_{xy}$ is computed. First, the streamwise velocity $u_x$ is averaged along the periodic $x$-direction to obtain a mean velocity profile $\\bar{u}_x(y)$. A linear least-squares regression is performed on this profile over the interior nodes ($y \\in [1, N_y-2]$) to find the velocity gradient $du_x/dy$. The shear stress is then calculated using the domain-averaged density $\\bar{\\rho}$ and the kinematic viscosity $\\nu$:\n$$\n\\tau_{xy} = \\bar{\\rho} \\, \\nu \\, \\frac{du_x}{dy}\n$$\nThis procedure is repeated for each background velocity $U_0 \\in \\{0.0, 0.1, -0.1, 0.3\\}$. The case $U_0=0.0$ serves as the baseline, providing the reference shear stress $\\tau_{xy}(0.0)$. The Galilean invariance error is quantified as the normalized absolute deviation:\n$$\n\\epsilon(U_0)=\\frac{\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|}{\\left|\\tau_{xy}(0.0)\\right|}\n$$\nThe value of $\\epsilon(U_0)$ will be calculated for each of the four specified values of $U_0$. By definition, $\\epsilon(0.0) = 0$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Simulates 2D Couette flow using LBM to evaluate Galilean invariance error.\n    \"\"\"\n    \n    # Simulation Parameters\n    NX = 64\n    NY = 17\n    TAU = 0.8\n    U_REL = 0.1\n    T_STEPS = 1500\n    RHO0 = 1.0\n    \n    # D2Q9 model parameters\n    C = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]])\n    W = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    CS2 = 1/3\n    NU = CS2 * (TAU - 0.5)\n\n    test_cases_U0 = [0.0, 0.1, -0.1, 0.3]\n    tau_xy_results = {}\n\n    def equilibrium_dist(rho, ux, uy):\n        \"\"\"Calculates the equilibrium distribution function.\"\"\"\n        feq = np.zeros((NY, NX, 9))\n        u_dot_u = ux**2 + uy**2\n        for i in range(9):\n            c_dot_u = C[i, 0] * ux + C[i, 1] * uy\n            term1 = c_dot_u / CS2\n            term2 = (c_dot_u**2) / (2 * CS2**2)\n            term3 = u_dot_u / (2 * CS2)\n            feq[:, :, i] = W[i] * rho * (1 + term1 + term2 - term3)\n        return feq\n\n    for u0 in test_cases_U0:\n        # Flow Parameters for the current case\n        u_bottom = u0\n        u_top = u0 + U_REL\n        \n        # Initialization\n        ux_init = np.full((NY, NX), u0)\n        uy_init = np.zeros((NY, NX))\n        rho_init = np.full((NY, NX), RHO0)\n        f = equilibrium_dist(rho_init, ux_init, uy_init)\n\n        # Main simulation loop\n        for t in range(T_STEPS):\n            # Collision\n            rho = np.sum(f, axis=2)\n            ux = np.einsum('ijk,k-ij', f, C[:, 0]) / rho\n            uy = np.einsum('ijk,k-ij', f, C[:, 1]) / rho\n            \n            feq = equilibrium_dist(rho, ux, uy)\n            f = f - (1/TAU) * (f - feq)\n\n            # Streaming\n            for i in range(9):\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 0], axis=1)\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 1], axis=0)\n\n            # Boundary Conditions (Zou-He)\n            # Bottom wall (y=0)\n            rho_w_bottom = f[0, :, 0] + f[0, :, 1] + f[0, :, 3] + 2 * (f[0, :, 4] + f[0, :, 7] + f[0, :, 8])\n            f[0, :, 2] = f[0, :, 4]  # Since u_y = 0\n            f[0, :, 5] = f[0, :, 7] - 0.5 * (f[0, :, 1] - f[0, :, 3]) + 0.5 * rho_w_bottom * u_bottom\n            f[0, :, 6] = f[0, :, 8] + 0.5 * (f[0, :, 1] - f[0, :, 3]) - 0.5 * rho_w_bottom * u_bottom\n\n            # Top wall (y=NY-1)\n            rho_w_top = f[-1, :, 0] + f[-1, :, 1] + f[-1, :, 3] + 2 * (f[-1, :, 2] + f[-1, :, 5] + f[-1, :, 6])\n            f[-1, :, 4] = f[-1, :, 2]  # Since u_y = 0\n            f[-1, :, 7] = f[-1, :, 5] + 0.5 * (f[-1, :, 1] - f[-1, :, 3]) - 0.5 * rho_w_top * u_top\n            f[-1, :, 8] = f[-1, :, 6] - 0.5 * (f[-1, :, 1] - f[-1, :, 3]) + 0.5 * rho_w_top * u_top\n\n        # Post-processing to calculate shear stress\n        rho_final = np.sum(f, axis=2)\n        ux_final = np.einsum('ijk,k-ij', f, C[:, 0]) / rho_final\n        \n        rho_avg = np.mean(rho_final)\n        ux_profile = np.mean(ux_final, axis=1)\n\n        # Linear fit on interior nodes\n        y_interior = np.arange(1, NY - 1)\n        ux_interior = ux_profile[1:-1]\n        \n        # scipy.stats.linregress(x, y)\n        lin_fit = linregress(y_interior, ux_interior)\n        du_dy = lin_fit.slope\n        \n        tau_xy = rho_avg * NU * du_dy\n        tau_xy_results[u0] = tau_xy\n\n    # Calculate normalized deviation\n    tau_xy_base = tau_xy_results[0.0]\n    deviations = []\n    for u0 in test_cases_U0:\n        current_tau_xy = tau_xy_results[u0]\n        if tau_xy_base == 0:\n            deviation = 0.0 if current_tau_xy == 0.0 else float('inf')\n        else:\n            deviation = abs(current_tau_xy - tau_xy_base) / abs(tau_xy_base)\n        deviations.append(deviation)\n    \n    print(f\"[{','.join(map(str, deviations))}]\")\n\nsolve()\n\n```"
        }
    ]
}