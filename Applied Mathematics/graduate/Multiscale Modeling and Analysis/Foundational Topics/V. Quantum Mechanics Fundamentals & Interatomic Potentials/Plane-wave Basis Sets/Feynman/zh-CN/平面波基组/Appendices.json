{
    "hands_on_practices": [
        {
            "introduction": "任何平面波计算的基础都是构建基组本身。这一过程涉及生成一组倒易晶格矢量 $\\mathbf{G}$，其对应的动能低于指定的能量截断值 $E_{\\text{cut}}$。该实践提供了将能量截断这一理论概念转化为一组具体基矢量的直接动手经验，这是设置任何平面波计算的第一步。",
            "id": "3833123",
            "problem": "考虑一个边长为 $(L_x,L_y,L_z)$ 的正交周期性模拟晶胞，其中平面波基由倒格矢 $\\mathbf{G} = \\left(G_x,G_y,G_z\\right)$ 索引，这些倒格矢通过倒易空间定义 $G_i = \\frac{2\\pi n_i}{L_i}$ 与整数三元组 $(n_x,n_y,n_z)\\in\\mathbb{Z}^3$ 相关联，其中 $i\\in\\{x,y,z\\}$ 为每个笛卡尔方向。在 Born–von Karman 周期性边界条件下，平面波 $\\exp\\left(i\\,\\mathbf{G}\\cdot \\mathbf{r}\\right)$ 是质量为 $m$ 的自由电子的动能算符 $-\\frac{\\hbar^2}{2m}\\nabla^2$ 的本征函数，其本征值取决于 $|\\mathbf{G}|^2$，其中 $\\hbar$ 是约化普朗克常数。动能随 $|\\mathbf{G}|^2$ 单调增加，并由此定义了基函数按动能递增的自然排序。\n\n任务：对于每个指定的测试用例，生成所有整数三元组 $(n_x,n_y,n_z)$ 的完整集合，使得在 $\\Gamma$ 点（即晶体波矢 $\\mathbf{k}=\\mathbf{0}$）对应的平面波动能不超过给定的能量截断值 $E_{\\mathrm{cut}}$。然后按动能递增的顺序对这些三元组进行排序；对于动能完全相等的三元组，则按 $(n_x,n_y,n_z)$ 的升序字典序来打破平局。计算满足截断条件的三元组数量，并按指定顺序列出它们。\n\n推导和实现的基本依据包括以下经过充分检验的事实：\n- 倒格矢分量满足 $G_i=\\frac{2\\pi n_i}{L_i}$，其中 $i\\in\\{x,y,z\\}$ 且 $(n_x,n_y,n_z)\\in\\mathbb{Z}^3$。\n- 自由电子的动能算符为 $-\\frac{\\hbar^2}{2m}\\nabla^2$。\n- 平面波是拉普拉斯算符的本征函数，其动能取决于 $|\\mathbf{G}|^2$。\n- 按动能递增排序等价于按 $|\\mathbf{G}|^2$ 递增排序。\n\n单位与常数：\n- 使用国际单位制（SI）。晶胞长度单位必须是米（m），能量截断单位是焦耳（J）。\n- 使用电子静止质量 $m = 9.1093837015\\times 10^{-31}$ kg 和约化普朗克常数 $\\hbar = 1.054571817\\times 10^{-34}$ J·s。\n\n数值包容性与鲁棒性：\n- 如果一个平面波计算出的动能小于或等于 $E_{\\mathrm{cut}}$，则将其包含在内。为避免在相等情况下因浮点数问题导致漏选，应将比较实现为 $E \\le E_{\\mathrm{cut}}\\,(1+\\delta_{\\mathrm{rel}}) + \\delta_{\\mathrm{abs}}$，其中 $\\delta_{\\mathrm{rel}}=10^{-12}$ 且 $\\delta_{\\mathrm{abs}}=10^{-32}$ J。\n\n对于每个测试用例，您的程序必须返回：\n- 所包含三元组的整数数量。\n- 所有包含的三元组的有序列表，形式为列表的列表 $[n_x,n_y,n_z]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果格式为 $[\\,\\text{count},\\,\\text{ordered\\_triplets}\\,]$。\n\n测试套件（每个元组为 $(L_x,L_y,L_z,E_{\\mathrm{cut}})$，其中 $L$ 的单位为米，$E_{\\mathrm{cut}}$ 的单位为焦耳）：\n- 情况 A（一般各向同性晶胞）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,3.0\\times 10^{-19}\\right)$。\n- 情况 B（零边界截断）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,0\\right)$。\n- 情况 C（各向异性晶胞）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,2.0\\times 10^{-9},\\,3.0\\times 10^{-9},\\,1.0\\times 10^{-19}\\right)$。\n- 情况 D（相等情况下的简并壳层包含）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,4.820\\times 10^{-19}\\right)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，例如：$[[\\text{count}_A,\\text{list}_A],[\\text{count}_B,\\text{list}_B],[\\text{count}_C,\\text{list}_C],[\\text{count}_D,\\text{list}_D]]$。",
            "solution": "该问题是有效的。它在科学上植根于应用于周期性体系的量子力学原理，这是计算材料科学的基石。该问题是适定的，提供了所有必要的物理常数、数学定义和数值公差，以确定一个唯一的、可验证的解。语言客观，要求明确。\n\n主要目标是识别由整数三元组 $(n_x, n_y, n_z)$ 索引的平面波基函数集合，这些基函数满足给定的动能截断值 $E_{\\mathrm{cut}}$。基函数是在布里渊区的 $\\Gamma$ 点上考虑的，对应于晶体波矢 $\\mathbf{k}=\\mathbf{0}$。\n\n首先，我们建立平面波的动能与其对应的整数三元组之间的关系。质量为 $m$ 的自由电子的不含时薛定谔方程由动能算符 $\\hat{T} = -\\frac{\\hbar^2}{2m}\\nabla^2$ 控制。以 $\\psi_{\\mathbf{G}}(\\mathbf{r}) \\propto \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r})$ 形式给出的平面波是该算符的本征函数。这里，$\\mathbf{G}$ 是一个倒格矢。应用该算符可得：\n$$\n\\hat{T} \\psi_{\\mathbf{G}}(\\mathbf{r}) = -\\frac{\\hbar^2}{2m}\\nabla^2 \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r}) = -\\frac{\\hbar^2}{2m}(i\\mathbf{G})\\cdot(i\\mathbf{G}) \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r}) = \\frac{\\hbar^2|\\mathbf{G}|^2}{2m} \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r})\n$$\n因此，动能本征值 $E_{\\mathbf{G}}$ 为：\n$$\nE_{\\mathbf{G}} = \\frac{\\hbar^2|\\mathbf{G}|^2}{2m}\n$$\n对于边长为 $(L_x, L_y, L_z)$ 的正交模拟晶胞，倒格矢 $\\mathbf{G} = (G_x, G_y, G_z)$ 的分量由整数三元组 $(n_x, n_y, n_z) \\in \\mathbb{Z}^3$ 定义为 $G_i = \\frac{2\\pi n_i}{L_i}$，其中 $i \\in \\{x, y, z\\}$。其模长的平方 $|\\mathbf{G}|^2$ 为：\n$$\n|\\mathbf{G}|^2 = G_x^2 + G_y^2 + G_z^2 = \\left(\\frac{2\\pi n_x}{L_x}\\right)^2 + \\left(\\frac{2\\pi n_y}{L_y}\\right)^2 + \\left(\\frac{2\\pi n_z}{L_z}\\right)^2 = 4\\pi^2 \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right)\n$$\n将此代入能量本征值表达式，得到特定三元组的动能 $E_{n_x,n_y,n_z}$：\n$$\nE_{n_x,n_y,n_z} = \\frac{\\hbar^2}{2m} \\left[ 4\\pi^2 \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right) \\right] = \\frac{2\\pi^2\\hbar^2}{m} \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right)\n$$\n任务是找到所有满足 $E_{n_x,n_y,n_z} \\le E_{\\mathrm{cut}}$ 的整数三元组 $(n_x, n_y, n_z)$。为处理边界上的浮点精度问题，该条件使用一个容差来实现：\n$$\nE_{n_x,n_y,n_z} \\le E_{\\mathrm{cut,eff}} \\quad \\text{其中} \\quad E_{\\mathrm{cut,eff}} = E_{\\mathrm{cut}}(1 + \\delta_{\\mathrm{rel}}) + \\delta_{\\mathrm{abs}}\n$$\n其中 $\\delta_{\\mathrm{rel}}=10^{-12}$ 且 $\\delta_{\\mathrm{abs}}=10^{-32}$ J。\n\n解决每个测试用例的算法流程如下：\n$1$. **初始化**：对于一个给定的测试用例 $(L_x, L_y, L_z, E_{\\mathrm{cut}})$，计算有效能量截断值 $E_{\\mathrm{cut,eff}}$。同时计算常数前置因子 $C_{\\text{factor}} = \\frac{2\\pi^2\\hbar^2}{m}$。包含一个三元组的条件变为：\n$$\n\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2} \\le \\frac{E_{\\mathrm{cut,eff}}}{C_{\\text{factor}}}\n$$\n这个不等式在 $(n_x, n_y, n_z)$ 空间中描述了一个椭球，它界定了有效整数三元组的搜索范围。\n\n$2$. **椭球搜索**：通过迭代嵌套循环进行高效搜索，循环的边界由椭球条件动态约束。这样可以避免搜索一个更大的矩形体积。\n- $|n_x|$ 的最大可能值通过设置 $n_y=0$ 和 $n_z=0$ 找到：$n_{x,\\max} = \\lfloor L_x \\sqrt{E_{\\mathrm{cut,eff}} / C_{\\text{factor}}} \\rfloor$。我们从 $-n_{x,\\max}$ 到 $n_{x,\\max}$ 迭代 $n_x$。\n- 对于每个 $n_x$，通过设置 $n_z=0$ 找到 $|n_y|$ 的最大可能值：$n_{y,\\max}(n_x) = \\lfloor L_y \\sqrt{E_{\\mathrm{cut,eff}}/C_{\\text{factor}} - n_x^2/L_x^2} \\rfloor$。我们从 $-n_{y,\\max}(n_x)$ 到 $n_{y,\\max}(n_x)$ 迭代 $n_y$。\n- 对于每个 $(n_x, n_y)$ 对，$|n_z|$ 的最大可能值为：$n_{z,\\max}(n_x, n_y) = \\lfloor L_z \\sqrt{E_{\\mathrm{cut,eff}}/C_{\\text{factor}} - n_x^2/L_x^2 - n_y^2/L_y^2} \\rfloor$。我们从 $-n_{z,\\max}(n_x, n_y)$ 到 $n_{z,\\max}(n_x, n_y)$ 迭代 $n_z$。\n通过此过程生成的每个三元组 $(n_x, n_y, n_z)$ 都保证满足能量截断条件。收集这些有效的三元组。\n\n$3$. **排序**：收集到的三元组必须按照指定的标准进行排序。\n- **主键**：精确的动能 $E_{n_x,n_y,n_z}$（不使用容差因子计算），按升序排列。\n- **次键**：对于具有简并（相同）能量的三元组，通过按 $(n_x, n_y, n_z)$ 的升序字典序排序来打破平局。\n这可以通过为每个有效三元组创建一个形式为 $(E_{n_x,n_y,n_z}, n_x, n_y, n_z)$ 的元组列表，然后对该列表执行标准排序来实现。\n\n$4$. **最终化**：排序后，提取有序的三元组列表。测试用例的最终结果包括有效三元组的总数和这些三元组的有序列表。对所有提供的测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the plane-wave basis set problem for a suite of test cases.\n    For each case, it finds all integer triplets (nx, ny, nz) whose\n    corresponding kinetic energy is below a cutoff, then sorts them\n    by energy and lexicographically.\n    \"\"\"\n\n    # --- Constants and Tolerances ---\n    # Electron rest mass in kg\n    m_e = 9.1093837015e-31\n    # Reduced Planck constant in J·s\n    hbar = 1.054571817e-34\n    # Relative and absolute tolerances for energy comparison\n    delta_rel = 1e-12\n    delta_abs = 1e-32\n\n    # --- Test Suite ---\n    # Each tuple is (Lx, Ly, Lz, E_cut) in SI units (m, J)\n    test_cases = [\n        # Case A (general isotropic cell)\n        (1.0e-9, 1.0e-9, 1.0e-9, 3.0e-19),\n        # Case B (boundary cutoff at zero)\n        (1.0e-9, 1.0e-9, 1.0e-9, 0.0),\n        # Case C (anisotropic cell)\n        (1.0e-9, 2.0e-9, 3.0e-9, 1.0e-19),\n        # Case D (degenerate shell inclusion at equality)\n        (1.0e-9, 1.0e-9, 1.0e-9, 4.820e-19),\n    ]\n\n    # List to store final results for all test cases\n    all_results = []\n\n    # --- Main Logic ---\n    # Pre-calculate the constant factor in the energy equation\n    C_factor = (2 * (np.pi**2) * (hbar**2)) / m_e\n\n    for case in test_cases:\n        Lx, Ly, Lz, E_cut = case\n\n        # Apply numerical tolerance to the energy cutoff\n        E_cut_eff = E_cut * (1 + delta_rel) + delta_abs\n        \n        # A list to store tuples of (energy, nx, ny, nz) for sorting\n        found_triplets_with_energy = []\n        \n        # Handle the E_cut  0 case explicitly to avoid sqrt of negative\n        if E_cut_eff  0:\n            all_results.append([0, []])\n            continue\n            \n        # Determine the search range for nx (outermost loop)\n        # We use a try-except block for sqrt(negative) arising from float precision\n        try:\n            nx_max = int(np.floor(Lx * np.sqrt(E_cut_eff / C_factor)))\n        except (ValueError, RuntimeWarning):\n            nx_max = 0\n\n        # Efficiently search the ellipsoid of valid (nx, ny, nz) triplets\n        for nx in range(-nx_max, nx_max + 1):\n            E_rem_y = E_cut_eff - C_factor * ((nx / Lx)**2)\n            if E_rem_y  0:\n                continue\n            \n            try:\n                ny_max = int(np.floor(Ly * np.sqrt(E_rem_y / C_factor)))\n            except (ValueError, RuntimeWarning):\n                ny_max = 0\n\n            for ny in range(-ny_max, ny_max + 1):\n                E_rem_z = E_cut_eff - C_factor * (((nx / Lx)**2) + ((ny / Ly)**2))\n                if E_rem_z  0:\n                    continue\n\n                try:\n                    nz_max = int(np.floor(Lz * np.sqrt(E_rem_z / C_factor)))\n                except (ValueError, RuntimeWarning):\n                    nz_max = 0\n                \n                for nz in range(-nz_max, nz_max + 1):\n                    # For a valid triplet, calculate its precise energy for sorting\n                    energy = C_factor * (((nx / Lx)**2) + ((ny / Ly)**2) + ((nz / Lz)**2))\n                    # The search guarantees energy = E_cut_eff. No re-check needed.\n                    found_triplets_with_energy.append((energy, nx, ny, nz))\n        \n        # Sort the results: primary key is energy, secondary is lexicographical (nx,ny,nz)\n        found_triplets_with_energy.sort(key=lambda item: (item[0], item[1], item[2], item[3]))\n        \n        # Extract the sorted triplets, discarding the energy values\n        sorted_triplets = [[t[1], t[2], t[3]] for t in found_triplets_with_energy]\n        \n        # Get the count of found triplets\n        count = len(sorted_triplets)\n        \n        # Append the result for the current case to the main results list\n        all_results.append([count, sorted_triplets])\n\n    # Format the final output string exactly as required, removing all spaces from the string representation\n    # of the list of lists.\n    final_output = str(all_results).replace(\" \", \"\")\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "在定义了波函数基组之后，一个常见的任务是计算电子密度 $\\rho(\\mathbf{r}) = |\\psi(\\mathbf{r})|^2$。此操作通过使用快速傅里叶变换 (FFT) 将波函数变换到实空间网格上最为高效。这个练习揭示了平面波代码中一个关键且微妙的技术细节，即电荷密度为何需要比波函数更精细的网格，并提供了一种确定最小网格尺寸的定量方法，从而防止了计算错误的常见来源。",
            "id": "3833072",
            "problem": "考虑一个正交周期性模拟晶胞，其在实空间的边长分别为 $L_x$、$L_y$ 和 $L_z$。电子波函数使用平面波基组展开，并在动能截断值 $E_{\\mathrm{cut}}$（以哈特里原子单位计）处截断。电荷密度由波函数的乘积构成，并在一个维度为 $(N_x,N_y,N_z)$ 的三维快速傅里叶变换 (FFT) 网格上进行计算。仅使用傅里叶变换的基本定义、奈奎斯特-香农采样定理以及平面波在原子单位制下的动能表达式，判断在形成电荷密度时是否会发生混叠（环绕）误差，并计算在每个笛卡尔坐标轴上避免此类误差所需的最小整数网格维度。\n\n假设如下：\n- 在哈特里原子单位制中，波矢为 $\\mathbf{G}$ 的平面波的动能为 $E_{\\mathrm{kin}}(\\mathbf{G}) = \\frac{1}{2}|\\mathbf{G}|^{2}$。\n- 波函数的平面波基组包含所有由 $E_{\\mathrm{cut}}$ 所决定的、满足 $|\\mathbf{G}| \\leq G_{\\mathrm{cut}}$ 的波矢 $\\mathbf{G}$。\n- 正交晶胞的边长为 $L_x = 8$ 玻尔，$L_y = 10$ 玻尔，$L_z = 12$ 玻尔。\n- FFT 网格的维度为 $(N_x,N_y,N_z) = (36,48,64)$。\n\n你的任务：\n1. 从第一性原理出发，推导一个保证在 FFT 网格上对电荷密度进行采样时不会出现混叠的判据，该判据应表示为关联 $(N_x,N_y,N_z)$、$(L_x,L_y,L_z)$ 和 $E_{\\mathrm{cut}}$ 的一个条件。\n2. 使用 $E_{\\mathrm{cut}} = 30$ 哈特里，评估在给定的 $(N_x,N_y,N_z)$ 条件下是否会发生混叠。\n3. 计算在这些条件下，沿每个轴避免混叠所需的最小整数三元组 $(N_x',N_y',N_z')$。\n\n将你的最终答案表示为一个包含三元组 $(N_x',N_y',N_z')$ 的单行矩阵。除了选择满足所推导判据的最小整数外，不需要其他舍入指令。最终答案中不要包含任何单位。",
            "solution": "所陈述的问题具有科学依据、问题明确、客观，并包含了获得唯一解所需的所有必要信息。这是计算材料科学中的一个标准问题。因此，该问题被认为是有效的，可以构建一个完整的解答。\n\n按照要求，解答分为三个部分：首先，推导避免混叠的一般判据；其次，根据此判据评估给定的设置；第三，计算所需的最小网格维度。\n\n### 1. 混叠判据的推导\n\n设正交模拟晶胞由沿笛卡尔坐标轴的实空间晶格矢量定义，其长度分别为 $L_x$、$L_y$ 和 $L_z$。相应的倒格子基矢为 $\\mathbf{b}_1 = (2\\pi/L_x, 0, 0)$、$\\mathbf{b}_2 = (0, 2\\pi/L_y, 0)$ 和 $\\mathbf{b}_3 = (0, 0, 2\\pi/L_z)$。任何倒格矢 $\\mathbf{G}$ 都是这些基矢的整数线性组合：$\\mathbf{G} = n_x \\mathbf{b}_1 + n_y \\mathbf{b}_2 + n_z \\mathbf{b}_3$，其中 $n_x, n_y, n_z$ 是整数。\n\n晶胞内的电子波函数 $\\psi(\\mathbf{r})$ 在平面波基组中展开为：\n$$ \\psi(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}} $$\n该基组通过动能截断值 $E_{\\mathrm{cut}}$ 进行截断，使得只有动能小于或等于 $E_{\\mathrm{cut}}$ 的平面波被包括在内。在哈特里原子单位制中，波矢为 $\\mathbf{G}$ 的平面波的动能为 $E_{\\mathrm{kin}}(\\mathbf{G}) = \\frac{1}{2}|\\mathbf{G}|^2$。这对所包含的波矢的大小施加了一个条件：\n$$ \\frac{1}{2}|\\mathbf{G}|^2 \\leq E_{\\mathrm{cut}} \\implies |\\mathbf{G}| \\leq \\sqrt{2E_{\\mathrm{cut}}} \\equiv G_{\\mathrm{cut}} $$\n因此，波函数的求和被限制在倒易空间中半径为 $G_{\\mathrm{cut}}$ 的球内的所有 $\\mathbf{G}$ 矢。\n\n电荷密度 $\\rho(\\mathbf{r})$ 由波函数的乘积构成。对于单个轨道，其密度为 $\\rho_{\\psi}(\\mathbf{r}) = \\psi^*(\\mathbf{r})\\psi(\\mathbf{r})$。\n$$ \\rho(\\mathbf{r}) = \\left( \\sum_{\\mathbf{G'}} c_{\\mathbf{G'}}^{*} e^{-i\\mathbf{G'}\\cdot\\mathbf{r}} \\right) \\left( \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}} \\right) = \\sum_{\\mathbf{G}, \\mathbf{G'}} c_{\\mathbf{G}} c_{\\mathbf{G'}}^{*} e^{i(\\mathbf{G}-\\mathbf{G'})\\cdot\\mathbf{r}} $$\n该表达式是电荷密度的傅里叶级数。令 $\\mathbf{K} = \\mathbf{G} - \\mathbf{G'}$。密度可以写成：\n$$ \\rho(\\mathbf{r}) = \\sum_{\\mathbf{K}} \\rho_{\\mathbf{K}} e^{i\\mathbf{K}\\cdot\\mathbf{r}} $$\n其中 $\\rho_{\\mathbf{K}}$ 是密度的傅里叶系数。只有当 $\\mathbf{K}$ 可以表示为 $\\mathbf{G} - \\mathbf{G'}$ 的差，且 $|\\mathbf{G}| \\leq G_{\\mathrm{cut}}$ 和 $|\\mathbf{G'}| \\leq G_{\\mathrm{cut}}$ 同时成立时，傅里叶系数 $\\rho_{\\mathbf{K}}$ 才不为零。\n\n使用三角不等式，我们可以找到密度展开中波矢 $\\mathbf{K}$ 的最大模长：\n$$ |\\mathbf{K}| = |\\mathbf{G} - \\mathbf{G'}| \\leq |\\mathbf{G}| + |-\\mathbf{G'}| = |\\mathbf{G}| + |\\mathbf{G'}| \\leq G_{\\mathrm{cut}} + G_{\\mathrm{cut}} = 2G_{\\mathrm{cut}} $$\n这意味着电荷密度的所有傅里叶分量都包含在倒易空间中一个半径为 $2G_{\\mathrm{cut}}$ 的球内。\n\n电荷密度在一个维度为 $(N_x, N_y, N_z)$ 的离散快速傅里叶变换 (FFT) 网格上进行计算。对于 $x$ 维度，该网格由 $N_x$ 个点组成，间距为 $\\Delta x = L_x/N_x$。根据奈奎斯特-香non采样定理，要无混叠（环绕误差）地表示一个信号，采样频率必须至少是信号中最高频率的两倍。用波矢来表示，最高波矢分量的模长必须小于或等于网格的奈奎斯特波矢。\n\n对于一个间距为 $\\Delta x = L_x/N_x$ 的实空间网格，其在倒易空间中对应的 FFT 可以表示的最大波矢分量（奈奎斯特极限）为：\n$$ k_{x, \\mathrm{Nyquist}} = \\frac{\\pi}{\\Delta x} = \\frac{\\pi N_x}{L_x} $$\n为避免混叠，密度的最大波矢分量 $K_{x, \\mathrm{max}}$ 必须满足 $|K_{x, \\mathrm{max}}| \\leq k_{x, \\mathrm{Nyquist}}$。在球 $|\\mathbf{K}| \\leq 2G_{\\mathrm{cut}}$ 内，矢量 $\\mathbf{K}$ 的最大可能 $x$ 分量是 $2G_{\\mathrm{cut}}$。因此，防止沿 $x$ 轴发生混叠的条件是：\n$$ 2G_{\\mathrm{cut}} \\leq \\frac{\\pi N_x}{L_x} $$\n对 $N_x$ 重新整理并代入 $G_{\\mathrm{cut}} = \\sqrt{2E_{\\mathrm{cut}}}$，我们得到每个笛卡尔轴 $i \\in \\{x, y, z\\}$ 的一般判据：\n$$ N_i \\ge \\frac{2L_i G_{\\mathrm{cut}}}{\\pi} = \\frac{2L_i \\sqrt{2E_{\\mathrm{cut}}}}{\\pi} $$\n这个条件保证了 FFT 网格足够精细，可以无混叠误差地表示电荷密度。\n\n### 2. 对给定参数的混叠评估\n\n我们已知：\n- $E_{\\mathrm{cut}} = 30$ 哈特里\n- $L_x = 8$ 玻尔, $L_y = 10$ 玻尔, $L_z = 12$ 玻尔\n- FFT 网格 $(N_x, N_y, N_z) = (36, 48, 64)$\n\n首先，我们计算截断波矢 $G_{\\mathrm{cut}}$：\n$$ G_{\\mathrm{cut}} = \\sqrt{2E_{\\mathrm{cut}}} = \\sqrt{2 \\times 30} = \\sqrt{60} \\text{ bohr}^{-1} $$\n现在，我们使用推导出的判据计算每个轴所需的最小网格点数（$N'_{i}$），并检查给定的 $N_i$ 是否足够。\n$x$ 轴的最小值：\n$$ N_x' = \\frac{2 L_x \\sqrt{60}}{\\pi} = \\frac{2 \\times 8 \\times \\sqrt{60}}{\\pi} = \\frac{16\\sqrt{60}}{\\pi} \\approx 39.45 $$\n给定网格的 $N_x = 36$。由于 $36  39.45$，网格不充分，沿 $x$ 轴会发生混叠。\n\n$y$ 轴的最小值：\n$$ N_y' = \\frac{2 L_y \\sqrt{60}}{\\pi} = \\frac{2 \\times 10 \\times \\sqrt{60}}{\\pi} = \\frac{20\\sqrt{60}}{\\pi} \\approx 49.31 $$\n给定网格的 $N_y = 48$。由于 $48  49.31$，网格不充分，沿 $y$ 轴也会发生混叠。\n\n$z$ 轴的最小值：\n$$ N_z' = \\frac{2 L_z \\sqrt{60}}{\\pi} = \\frac{2 \\times 12 \\times \\sqrt{60}}{\\pi} = \\frac{24\\sqrt{60}}{\\pi} \\approx 59.17 $$\n给定网格的 $N_z = 64$。由于 $64 > 59.17$，网格沿 $z$ 轴是充分的。\n\n因为 FFT 网格维度在 $x$ 和 $y$ 轴上不充分，混叠误差将污染电荷密度的计算。\n\n### 3. 最小网格维度的计算\n\n为避免混叠，沿每个轴的网格点数必须是大于或等于上面计算出的最小值的整数。我们通过对每个所需值向上取整来找到最小整数维度 $(N_x', N_y', N_z')$。\n\n最小 $N_x'$：\n$$ N_x' = \\lceil \\frac{16\\sqrt{60}}{\\pi} \\rceil = \\lceil 39.45 \\rceil = 40 $$\n最小 $N_y'$：\n$$ N_y' = \\lceil \\frac{20\\sqrt{60}}{\\pi} \\rceil = \\lceil 49.31 \\rceil = 50 $$\n最小 $N_z'$：\n$$ N_z' = \\lceil \\frac{24\\sqrt{60}}{\\pi} \\rceil = \\lceil 59.17 \\rceil = 60 $$\n因此，在给定条件下避免混叠误差的最小整数网格维度是 $(40, 50, 60)$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 40  50  60 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在理解了如何构建基组以及如何使用它进行密度计算等操作后，我们现在可以分析其计算成本。在用于求解 Kohn-Sham 方程的迭代方法中，最频繁的操作是将哈密顿算符应用于波函数。该实践对于理解平面波代码的性能特征至关重要，通过推导计算复杂度，您将学会识别性能瓶颈，并理解计算成本如何随系统尺寸而变化。",
            "id": "3796257",
            "problem": "考虑一个使用平面波基组处理的周期性体系，该基组由能量截断 $E_{\\text{cut}}$ 截断，并采用密度泛函理论 (DFT) 的科恩-沈 (KS) 方程进行计算。在晶体动量为 $k$ 时，每个 KS 轨道由 $N_{\\text{pw}}$ 个复系数表示，这些系数对应于满足 $\\frac{|\\mathbf{G}+\\mathbf{k}|^{2}}{2} \\le E_{\\text{cut}}$ 的倒格矢 $G$。一个包含 $N_{x} \\times N_{y} \\times N_{z}$ 个点的均匀实空间网格用于快速傅里叶变换 (FFT)，其中 $N_{g} = N_{x} N_{y} N_{z}$ 且 $N_{g} \\geq \\alpha N_{\\text{pw}}$，$\\alpha \\geq 1$ 为某个过采样因子。假设使用一个迭代本征求解器，在每次迭代中，将动能算符 $\\hat{T} = -\\nabla^{2}/2$ 和局域势算符 $\\hat{V}_{\\text{loc}}(\\mathbf{r})$ 应用于所有 $N_{b}$ 条能带和 $N_{k}$ 个 k 点上的 KS 轨道。\n\n使用以下基本事实和定义：\n- 动能算符在倒易空间中是对角的，因此将 $\\hat{T}$ 应用于一个在 $G$ 空间中表示的轨道，需要将 $N_{\\text{pw}}$ 个系数中的每一个与 $\\frac{|\\mathbf{G}+\\mathbf{k}|^{2}}{2}$ 进行逐点相乘。\n- 局域势在实空间中是对角的，因此将 $\\hat{V}_{\\text{loc}}$ 应用于一个轨道需要通过逆 FFT 将轨道从倒易空间变换到实空间，在实空间网格上与 $V_{\\text{loc}}(\\mathbf{r})$ 进行逐点相乘，然后通过正 FFT 变换回倒易空间。\n- 对于成本模型，将一次复数逐点乘法的成本定义为一个单位功。将在 $N_{x} \\times N_{y} \\times N_{z}$ 网格上的三维 FFT 的每次变换成本模型化为 $C_{\\text{FFT}} N_{g} \\log_{2}(N_{g})$ 单位功，其中 $C_{\\text{FFT}}$ 是一个与 $N_{g}$ 无关的正常数，并将与 $V_{\\text{loc}}(\\mathbf{r})$ 的实空间乘法模型化为 $N_{g}$ 单位功。\n\n根据第一性原理和上述定义，推导将 $\\hat{T}$ 和 $\\hat{V}_{\\text{loc}}$ 应用于所有 $N_{b}$ 条能带和 $N_{k}$ 个 k 点上的所有轨道所需的每次迭代的总主导阶次的功。将你的最终答案表示为一个单一的闭式解析表达式，用 $N_{b}$、$N_{k}$、$N_{\\text{pw}}$、$N_{g}$ 和 $C_{\\text{FFT}}$ 表示，该表达式计算功的单位。然后，使用在固定 $E_{\\text{cut}}$ 和固定粒子密度下的物理实际标度关系 $N_{\\text{pw}} \\propto N_{g} \\propto V$ 和 $N_{b} \\propto N_{e} \\propto V$（其中 $V$ 是模拟晶胞体积，$N_{e}$ 是电子数），用文字简要解释随着体系尺寸的增长，哪个算符的应用会成为瓶颈，以及原因。\n\n你的最终答案必须是每次迭代总功的单一解析表达式（以功为单位）；最终的方框答案中不应包含任何解释性文字或等号。无需四舍五入。",
            "solution": "该问题要求在平面波科恩-沈密度泛函理论 (KS-DFT) 计算中，推导应用动能算符 $\\hat{T}$ 和局域势算符 $\\hat{V}_{\\text{loc}}$ 时每次迭代的总计算功。总功 $W_{\\text{total}}$ 是在所有 $N_{k}$ 个 k 点上对所有 $N_{b}$ 条能带所做功的总和。\n\n我们首先确定将算符应用于单个 k 点上的单个 KS 轨道所需的功，记为 $W_{1}$。这可以分解为动能部分的功 $W_{\\hat{T}, 1}$ 和局域势部分的功 $W_{\\hat{V}_{\\text{loc}}, 1}$。\n\n$W_{1} = W_{\\hat{T}, 1} + W_{\\hat{V}_{\\text{loc}}, 1}$\n\n**1. 动能算符 ($\\hat{T}$) 的功**\n\n动能算符 $\\hat{T} = -\\frac{1}{2}\\nabla^{2}$ 在倒易空间基中是对角的。将其应用于一个 KS 轨道 $\\psi_{n,k}(\\mathbf{r})$（该轨道以平面波展开为 $\\psi_{n,k}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{n,k}(\\mathbf{G}) e^{i(\\mathbf{G}+\\mathbf{k})\\cdot\\mathbf{r}}$），相当于将其 $N_{\\text{pw}}$ 个复系数 $c_{n,k}(\\mathbf{G})$ 中的每一个乘以实值动能项 $\\frac{1}{2}|\\mathbf{G}+\\mathbf{k}|^{2}$。\n\n根据问题的成本模型，一个单位功即为一次复数逐点乘法。$\\hat{T}$ 的应用涉及 $N_{\\text{pw}}$ 次这样的乘法（一个复系数乘以一个实标量）。因此，将 $\\hat{T}$ 应用于一个轨道的功为：\n$$W_{\\hat{T}, 1} = N_{\\text{pw}}$$\n\n**2. 局域势算符 ($\\hat{V}_{\\text{loc}}$) 的功**\n\n局域势算符 $\\hat{V}_{\\text{loc}}(\\mathbf{r})$ 在实空间中是对角的。其应用需要一个三步过程，涉及倒易空间和实空间之间的变换：\n\na. **逆快速傅里叶变换 (FFT)：** 将轨道的 $N_{\\text{pw}}$ 个倒易空间系数变换到 $N_{g} = N_{x}N_{y}N_{z}$ 个点的网格上的实空间表示。这次逆 FFT 的成本为：\n$$W_{\\text{FFT, inv}} = C_{\\text{FFT}} N_{g} \\log_{2}(N_{g})$$\n\nb. **实空间乘法：** 在实空间中，网格上的复值轨道与实值局域势 $V_{\\text{loc}}(\\mathbf{r})$ 进行逐点相乘。这涉及 $N_{g}$ 次复数与实数的乘法。其成本为：\n$$W_{\\text{mult}} = N_{g}$$\n\nc. **正快速傅里叶变换 (FFT)：** 将得到的乘积变换回倒易空间以获得更新后的系数。这次正 FFT 的成本与逆 FFT 相同：\n$$W_{\\text{FFT, fwd}} = C_{\\text{FFT}} N_{g} \\log_{2}(N_{g})$$\n\n将 $\\hat{V}_{\\text{loc}}$ 应用于一个轨道的总功是这三个步骤成本的总和：\n$$W_{\\hat{V}_{\\text{loc}}, 1} = W_{\\text{FFT, inv}} + W_{\\text{mult}} + W_{\\text{FFT, fwd}} = C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}) + N_{g} + C_{\\text{FFT}} N_{g} \\log_{2}(N_{g})$$\n$$W_{\\hat{V}_{\\text{loc}}, 1} = 2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}) + N_{g}$$\n\n**3. 每次迭代的总功**\n\n在单个 k 点上对单个轨道的总功是动能和势能贡献的总和：\n$$W_{1} = W_{\\hat{T}, 1} + W_{\\hat{V}_{\\text{loc}}, 1} = N_{\\text{pw}} + 2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}) + N_{g}$$\n\n为了求出每次迭代的总功 $W_{\\text{total}}$，我们必须将此成本乘以能带数 $N_{b}$ 和 k 点数 $N_{k}$，因为该操作是独立地对每个轨道执行的。\n$$W_{\\text{total}} = N_{b} N_{k} W_{1}$$\n代入 $W_{1}$ 的表达式，我们得到总功的最终解析表达式：\n$$W_{\\text{total}} = N_{b} N_{k} (N_{\\text{pw}} + N_{g} + 2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}))$$\n\n**4. 渐近标度和瓶颈分析**\n\n为了确定大型体系的计算瓶颈，我们分析总功相对于体系体积 $V$ 的标度关系。问题给出了在固定粒子密度和能量截断 $E_{\\text{cut}}$ 下计算的以下标度关系：\n$N_{b} \\propto V$\n$N_{\\text{pw}} \\propto V$\n$N_{g} \\propto V$\n\n对于体材料体系，当实空间晶胞体积 $V$ 增加时，保持布里渊区内 k 点采样密度不变意味着 k 点数 $N_{k}$ 的标度关系为 $N_{k} \\propto V^{-1}$。\n\n我们来分析每个算符贡献的功的标度关系：\n- 总动能功：$W_{\\hat{T}, \\text{total}} = N_{b} N_{k} N_{\\text{pw}}$。其标度关系为 $W_{\\hat{T}, \\text{total}} \\propto (V)(V^{-1})(V) = V$。因此，动能应用的计算成本随体系尺寸线性增长，为 $O(V)$。\n\n- 总局域势功：$W_{\\hat{V}_{\\text{loc}}, \\text{total}} = N_{b} N_{k} (N_{g} + 2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}))$。当 $V \\to \\infty$ 时，$N_{g} \\to \\infty$，括号中的项 $2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g})$ 占主导地位。因此，标度关系由该项决定：\n$W_{\\hat{V}_{\\text{loc}}, \\text{total}} \\propto (V)(V^{-1})(V \\log_{2}(V)) = V \\log_{2}(V)$。局域势应用的计算成本标度关系为 $O(V \\log V)$。\n\n比较两种标度关系，势算符的 $O(V \\log V)$ 和动能算符的 $O(V)$， $V \\log V$ 项比 $V$ 项增长得更快。因此，随着体系尺寸的增长，局域势算符 $\\hat{V}_{\\text{loc}}$ 的应用成为计算瓶颈。这是因为其成本主要由 FFT 主导，FFT 的成本随网格点数 $N_g$ 呈超线性标度关系 $O(N_g \\log N_g)$，而动能算符的应用是在倒易空间中的简单线性操作，成本为 $O(N_{pw})$。",
            "answer": "$$\n\\boxed{N_{b} N_{k} (N_{\\text{pw}} + N_{g} + 2 C_{\\text{FFT}} N_{g} \\log_{2}(N_{g}))}\n$$"
        }
    ]
}