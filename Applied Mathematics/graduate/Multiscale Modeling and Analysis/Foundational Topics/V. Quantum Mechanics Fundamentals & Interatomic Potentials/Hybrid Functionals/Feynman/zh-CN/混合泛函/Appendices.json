{
    "hands_on_practices": [
        {
            "introduction": "我们从密度泛函理论 (DFT) 的一个基本挑战开始：对化学键断裂的描述，这是一个典型的强静态相关案例。静态相关误差是导致许多标准泛函在描述解离极限、磁耦合和某些催化反应时失效的主要原因。本练习使用双中心哈伯德模型作为一个简化但功能强大的氢分子 ($\\text{H}_2$) 代理模型 。通过构建和比较不同泛函代理（PBE、PBE0、LC-ωPBE）的能量曲线，您将具体理解为何半局域泛函会失效，以及杂化方法如何提供系统性的改进。",
            "id": "3768339",
            "problem": "你的任务是为氢分子（记作 $\\text{H}_2$）的解离能曲线设计并分析一个数学上一致的代理模型。目标是使用Kohn–Sham密度泛函理论(DFT)中三种常用的交换相关近似来计算解离能曲线的误差：Perdew–Burke–Ernzerhof (PBE)半局域泛函、全局杂化泛函PBE0，以及长程修正杂化泛函LC-$\\omega$PBE。分析必须从第一性原理出发，使用双位点Hubbard二聚体作为$\\text{H}_2$在最小基组下的一个物理上合理的粗粒化模型，并且推导出的可检验公式必须在一个能产生数值结果的程序中实现。\n\n基本基底和模型定义：\n- 设两个电子的双位点Hubbard哈密顿量为基础模型，\n  $$\\hat{H} = -t(R)\\sum_{\\sigma}\\left(\\hat{c}_{1\\sigma}^\\dagger \\hat{c}_{2\\sigma} + \\hat{c}_{2\\sigma}^\\dagger \\hat{c}_{1\\sigma}\\right) + U(R)\\sum_{i=1}^2 \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow},$$\n  其中 $R$ 是核间距（两个位点之间的距离），$t(R)$ 是跳跃积分，$U(R)$ 是在位库仑排斥，$\\hat{c}_{i\\sigma}^\\dagger$ 和 $\\hat{c}_{i\\sigma}$ 分别是位点 $i$ 上自旋为 $\\sigma$ 的电子的产生和湮灭算符，而 $\\hat{n}_{i\\sigma}=\\hat{c}_{i\\sigma}^\\dagger\\hat{c}_{i\\sigma}$。\n- 使用以下具有物理动机的形式：\n  $$t(R) = t_0\\, e^{-\\alpha_t R}, \\quad U(R) = U_\\infty - \\kappa\\, e^{-\\lambda R},$$\n  其中 $t_0$、$\\alpha_t$、$U_\\infty$、$\\kappa$ 和 $\\lambda$ 是原子单位制下的正常数。这些形式捕捉了位点间耦合随距离的预期指数衰减，以及局域排斥在较大 $R$ 时趋向于 $U_\\infty$ 的弱 $R$ 依赖性。\n- 半满Hubbard二聚体（单重态部分）的精确基态能量是\n  $$E_{\\text{exact}}(R) = \\frac{U(R)}{2} - \\sqrt{\\left(\\frac{U(R)}{2}\\right)^2 + 4\\,t(R)^2},$$\n  它将作为所有误差计算的参考“真值”。\n- 限制性平均场（类Hartree–Fock）基线能量，代表具有对称空间轨道占据和双重占据 $D=\\tfrac{1}{2}$ 的单行列式，其表达式为\n  $$E_{\\text{RHF}}(R) = -2\\,t(R) + \\frac{U(R)}{2}。$$\n- 单重态基态的主导阶强耦合关联修正（$t/U$ 的二阶微扰理论）是\n  $$E_{\\text{corr}}^{(2)}(R) = -\\frac{4\\,t(R)^2}{U(R)},$$\n  这捕捉了大$U$区域中的超交换稳定化。\n- 构建以下三个近似能量曲线：\n  1. PBE（半局域代理）：通过用一个常数 $c_{\\text{PBE}}\\in(0,1)$ 缩放强耦合修正来模拟半局域关联的恢复，\n     $$E_{\\text{PBE}}(R) = E_{\\text{RHF}}(R) + c_{\\text{PBE}}\\, E_{\\text{corr}}^{(2)}(R)。$$\n  2. PBE0（全局杂化代理）：用一个常数比例 $\\alpha\\in[0,1]$ 混合半局域能量和平均场能量，\n     $$E_{\\text{PBE0}}(R;\\alpha) = (1-\\alpha)\\,E_{\\text{PBE}}(R) + \\alpha\\,E_{\\text{UHF}}(R),$$\n     其中 $E_{\\text{UHF}}(R)$ 是一个自旋对称性破缺的平均场代理，用于捕捉大$U$区域的部分静态关联，其形式为\n     $$E_{\\text{UHF}}(R) = -\\frac{2\\,t(R)^2}{U(R)}。$$\n  3. LC-$\\omega$PBE（范围分离杂化代理）：通过一个依赖于距离的比例 $\\alpha_{\\text{lr}}(R;\\omega)$ 来加权长程类精确交换的贡献，\n     $$\\alpha_{\\text{lr}}(R;\\omega) = \\operatorname{erf}(\\omega R), \\qquad E_{\\text{LC-}\\omega\\text{PBE}}(R;\\omega) = \\bigl(1-\\alpha_{\\text{lr}}(R;\\omega)\\bigr)E_{\\text{PBE}}(R) + \\alpha_{\\text{lr}}(R;\\omega)\\,E_{\\text{UHF}}(R)。$$\n  这些构造是代理模型，它们以数学上一致的方式编码了自相互作用减小和静态关联恢复的趋势，而无需调用黑箱量子化学软件包。\n\n待计算量：\n- 对于每种方法 $M\\in\\{\\text{PBE},\\text{PBE0},\\text{LC-}\\omega\\text{PBE}\\}$，定义在间距 $R$ 处的逐点误差为\n  $$\\Delta_M(R) = E_M(R) - E_{\\text{exact}}(R)。$$\n- 在给定的间距集合 $\\{R_k\\}$ 上，计算以Hartree为单位的均方根误差(RMSE)，\n  $$\\text{RMSE}_M = \\sqrt{\\frac{1}{K}\\sum_{k=1}^{K} \\bigl(\\Delta_M(R_k)\\bigr)^2}。$$\n\n单位和参数：\n- 距离 $R$ 必须以玻尔半径（原子单位）为单位，能量必须以Hartree为单位。\n- 模型使用以下固定常数：\n  $$t_0 = 0.5\\,\\text{Hartree},\\quad \\alpha_t = 0.6\\,\\text{Bohr}^{-1},\\quad U_\\infty = 1.5\\,\\text{Hartree},\\quad \\kappa = 0.4\\,\\text{Hartree},\\quad \\lambda = 1.2\\,\\text{Bohr}^{-1},\\quad c_{\\text{PBE}} = 0.6。$$\n\n测试套件：\n- 使用间距集合\n  $$\\{R_k\\} = \\{1.0,\\,1.4,\\,2.0,\\,3.0,\\,5.0,\\,8.0\\}\\,\\text{Bohr}。$$\n- 评估三种参数情景以探究不同区域：\n  1. 情景A（理想路径）：PBE0使用$\\alpha=0.25$，LC-$\\omega$PBE使用$\\omega=0.5\\,\\text{Bohr}^{-1}$。\n  2. 情景B（边界半局域极限）：PBE0使用$\\alpha=0$，LC-$\\omega$PBE使用$\\omega=0$，两者都简化为半局域代理行为。\n  3. 情景C（边界长程/类精确交换极限）：PBE0使用$\\alpha=1$，LC-$\\omega$PBE使用$\\omega=2\\,\\text{Bohr}^{-1}$，在除极短程外的所有范围内都接近自旋对称性破缺的平均场代理。\n\n输出规格：\n- 你的程序必须计算情景A、B和C中每种情况下的$\\text{RMSE}_{\\text{PBE}}$、$\\text{RMSE}_{\\text{PBE0}}$和$\\text{RMSE}_{\\text{LC-}\\omega\\text{PBE}}$（单位为Hartree）。\n- 最终输出必须是单行，包含九个用逗号分隔的浮点数，并用方括号括起来。这些数字必须按以下顺序排列\n  $$\\bigl[\\text{RMSE}_{\\text{PBE}}^{\\text{A}},\\,\\text{RMSE}_{\\text{PBE0}}^{\\text{A}},\\,\\text{RMSE}_{\\text{LC-}\\omega\\text{PBE}}^{\\text{A}},\\,\\text{RMSE}_{\\text{PBE}}^{\\text{B}},\\,\\text{RMSE}_{\\text{PBE0}}^{\\text{B}},\\,\\text{RMSE}_{\\text{LC-}\\omega\\text{PBE}}^{\\text{B}},\\,\\text{RMSE}_{\\text{PBE}}^{\\text{C}},\\,\\text{RMSE}_{\\text{PBE0}}^{\\text{C}},\\,\\text{RMSE}_{\\text{LC-}\\omega\\text{PBE}}^{\\text{C}}\\bigr],$$\n  每个数字以Hartree为单位打印到六位小数。例如，输出格式必须如下所示\n  $$\\bigl[0.123456,0.234567,0.345678,0.456789,0.567890,0.678901,0.789012,0.890123,0.901234\\bigr]。$$",
            "solution": "我们使用双位点Hubbard二聚体，在一个最小化描述中为$\\text{H}_2$的解离构建了一个多尺度一致的代理模型，该模型捕捉了电子跳跃和在位排斥的关键物理。基本基础由Hubbard哈密顿量以及来自平均场理论和强耦合微扰理论的受控近似组成。\n\n1. 模型与精确能量：\n   哈密顿量\n   $$\\hat{H} = -t(R)\\sum_{\\sigma}\\left(\\hat{c}_{1\\sigma}^\\dagger \\hat{c}_{2\\sigma} + \\hat{c}_{2\\sigma}^\\dagger \\hat{c}_{1\\sigma}\\right) + U(R)\\sum_{i=1}^2 \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow}$$\n   是两个电子半满情况下的经典双位点模型。物理上，$t(R)$ 随 $R$ 减小，因为轨道重叠衰减；$U(R)$ 是一个局域排斥，在大间距时趋向于一个常数 $U_\\infty$。我们选择\n   $$t(R) = t_0\\, e^{-\\alpha_t R}, \\qquad U(R) = U_\\infty - \\kappa\\, e^{-\\lambda R},$$\n   其中固定常数采用原子单位制以确保科学真实性。对称二聚体（无位点能量偏移）的精确单重态基态能量是解析已知的：\n   $$E_{\\text{exact}}(R) = \\frac{U(R)}{2} - \\sqrt{\\left(\\frac{U(R)}{2}\\right)^2 + 4\\,t(R)^2}。$$\n   这恢复了正确的分离原子极限 $E_{\\text{exact}}(R\\to\\infty)\\to 0$ 和在有限 $t(R)$ 时的超交换稳定化 $E_{\\text{exact}}  0$。\n\n2. 平均场基线和来自微扰理论的关联：\n   一个限制性单行列式（类RHF）拟设用两个自旋占据成键分子轨道。动能贡献为 $-2t(R)$，而一个位点上的双重占据为 $D=\\tfrac{1}{2}$，得到 $U(R)D=U(R)/2$。因此，\n   $$E_{\\text{RHF}}(R) = -2\\,t(R) + \\frac{U(R)}{2}。$$\n   在大 $R$ 处，当 $t(R)\\ll U(R)$ 时，由于静态关联误差（源于强制双重占据的过高估计），该方法无法正确定位解离。对单重态基态的强耦合微扰理论（$t/U$ 的二阶）产生一个关联能\n   $$E_{\\text{corr}}^{(2)}(R) = -\\frac{4\\,t(R)^2}{U(R)},$$\n   这是一个经过充分检验的结果，代表了超交换稳定化。当 $t(R)/U(R)$ 很小时，这给出了主导阶行为 $E_{\\text{exact}}(R)\\approx E_{\\text{RHF}}(R) + E_{\\text{corr}}^{(2)}(R)$。\n\n3. PBE、PBE0和LC-$\\omega$PBE的代理模型：\n   - 半局域PBE代理：半局域泛函倾向于恢复部分关联，但仍然存在离域误差和自相互作用误差。我们通过用一个因子 $c_{\\text{PBE}}\\in(0,1)$ 缩放强耦合关联来编码这一点：\n     $$E_{\\text{PBE}}(R) = E_{\\text{RHF}}(R) + c_{\\text{PBE}}\\,E_{\\text{corr}}^{(2)}(R) = \\left(-2\\,t(R) + \\frac{U(R)}{2}\\right) - c_{\\text{PBE}}\\,\\frac{4\\,t(R)^2}{U(R)}。$$\n     当 $c_{\\text{PBE}}=0.6$ 时，这部分纠正了RHF的过高估计，但在解离附近留下了显著的静态关联误差。\n   - 全局杂化PBE0代理：杂化泛函将精确交换与半局域交换相关混合。在一个代理能量混合的图像中，我们令\n     $$E_{\\text{PBE0}}(R;\\alpha) = (1-\\alpha)\\,E_{\\text{PBE}}(R) + \\alpha\\,E_{\\text{UHF}}(R),$$\n     其中 $E_{\\text{UHF}}(R)$ 代表一个自旋对称性破缺的平均场能量，它通过避免双重占据并产生类超交换稳定化来捕捉一些静态关联。在大$U$区域，$E_{\\text{UHF}}(R)$ 的标度行为如\n     $$E_{\\text{UHF}}(R) = -\\frac{2\\,t(R)^2}{U(R)},$$\n     这在定性上是正确的，并且介于RHF和精确结果 $-\\frac{4\\,t(R)^2}{U(R)}$ 之间。混合比例 $\\alpha$ 是定义杂化泛函的参数；$\\alpha=0.25$ 是一个典型选择，而 $\\alpha=0$ 则简化为半局域代理，$\\alpha=1$ 则将能量推向对称性破缺的平均场代理。\n   - 长程修正LC-$\\omega$PBE代理：范围分离杂化泛函随距离增加精确交换的权重，从而减轻长程的自相互作用和离域误差。我们用一个平滑的分数来模拟这一点\n     $$\\alpha_{\\text{lr}}(R;\\omega) = \\operatorname{erf}(\\omega R),$$\n     满足 $\\alpha_{\\text{lr}}(0)=0$ 和 $\\alpha_{\\text{lr}}(\\infty)=1$。能量代理是\n     $$E_{\\text{LC-}\\omega\\text{PBE}}(R;\\omega) = \\bigl(1-\\alpha_{\\text{lr}}(R;\\omega)\\bigr)E_{\\text{PBE}}(R) + \\alpha_{\\text{lr}}(R;\\omega)\\,E_{\\text{UHF}}(R)。$$\n     这里 $\\omega$ 控制着长程交换的起始点。与PBE相比，这种构造在较长的 $R$ 处减少了自相互作用并改善了静态关联，但没有完全达到精确的强耦合能量。\n\n4. 误差度量和单位：\n   对于每种方法 $M\\in\\{\\text{PBE},\\text{PBE0},\\text{LC-}\\omega\\text{PBE}\\}$，定义在间距 $R$ 处的误差：\n   $$\\Delta_M(R) = E_M(R) - E_{\\text{exact}}(R),$$\n   并计算在一个集合 $\\{R_k\\}_{k=1}^{K}$ 上的均方根误差：\n   $$\\text{RMSE}_M = \\sqrt{\\frac{1}{K}\\sum_{k=1}^{K} \\bigl(\\Delta_M(R_k)\\bigr)^2}。$$\n   所有距离均以玻尔为单位，能量以Hartree为单位。常数是固定的：\n   $$t_0 = 0.5,\\ \\alpha_t = 0.6,\\ U_\\infty = 1.5,\\ \\kappa = 0.4,\\ \\lambda = 1.2,\\ c_{\\text{PBE}} = 0.6,$$\n   其隐含单位如前所述。\n\n5. 测试情景和预期的定性行为：\n   - 情景A：$\\alpha=0.25$，$\\omega=0.5$。通过减少自相互作用和增强长程交换，PBE0和LC-$\\omega$PBE相比PBE有所改进，尤其是在中等和较大 $R$ 处，但相对于精确的 $-\\frac{4t^2}{U}$ 极限，它们仍然未能完全恢复静态关联。\n   - 情景B：$\\alpha=0$，$\\omega=0$。两种杂化方法都简化为半局域代理；在此代理表示中，所有三种方法变得相同，表现出显著的残余静态关联误差和离域偏差。\n   - 情景C：$\\alpha=1$，$\\omega=2$。杂化方法接近对称性破缺的平均场代理，与PBE相比，它能更正确地解离并减少静态关联误差，但在强耦合极限下，其稳定作用比精确结果小约两倍。\n\n6. 算法步骤：\n   - 对集合 $\\{1.0,1.4,2.0,3.0,5.0,8.0\\}$ 中的每个 $R$，计算 $t(R)$ 和 $U(R)$。\n   - 计算 $E_{\\text{exact}}(R)$、$E_{\\text{RHF}}(R)$、$E_{\\text{corr}}^{(2)}(R)$、$E_{\\text{PBE}}(R)$、$E_{\\text{UHF}}(R)$。\n   - 对于特定情景的参数，计算 $E_{\\text{PBE0}}(R;\\alpha)$ 和 $E_{\\text{LC-}\\omega\\text{PBE}}(R;\\omega)$。\n   - 计算 $\\Delta_M(R)$ 并汇总成 $M\\in\\{\\text{PBE},\\ \\text{PBE0},\\ \\text{LC-}\\omega\\text{PBE}\\}$ 的 $\\text{RMSE}_M$。\n   - 生成最终的单行输出，其中包含九个以Hartree为单位的数字，按指定顺序排列，每个数字保留六位小数。\n\n该设计将多尺度建模的观点（分子解离的粗粒化Hubbard表示）、杂化泛函（全局和范围分离的交换混合）以及植根于第一性原理推导的 $E_{\\text{exact}}$、平均场能量和强耦合关联公式的误差分析（RMSE）联系起来。PBE、PBE0和LC-$\\omega$PBE之间的差异可归因于是否存在自相互作用减小和静态关联恢复机制，这两种机制都体现在上述的代理能量构造中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom math import erf, sqrt\n\n# Constants in atomic units (Hartree for energy, Bohr for length)\nt0 = 0.5        # Hartree\nalpha_t = 0.6   # Bohr^{-1}\nU_inf = 1.5     # Hartree\nkappa = 0.4     # Hartree\nlam = 1.2       # Bohr^{-1}\nc_pbe = 0.6     # dimensionless scaling for semilocal correlation proxy\n\ndef t_of_R(R):\n    \"\"\"Hopping integral t(R) in Hartree.\"\"\"\n    return t0 * np.exp(-alpha_t * R)\n\ndef U_of_R(R):\n    \"\"\"On-site repulsion U(R) in Hartree.\"\"\"\n    return U_inf - kappa * np.exp(-lam * R)\n\ndef E_exact(R):\n    \"\"\"Exact singlet ground-state energy of the half-filled Hubbard dimer in Hartree.\"\"\"\n    t = t_of_R(R)\n    U = U_of_R(R)\n    return 0.5 * U - sqrt((0.5 * U) ** 2 + 4.0 * t ** 2)\n\ndef E_RHF(R):\n    \"\"\"Restricted mean-field (symmetric single-determinant) energy in Hartree.\"\"\"\n    t = t_of_R(R)\n    U = U_of_R(R)\n    return -2.0 * t + 0.5 * U\n\ndef E_corr_strong(R):\n    \"\"\"Strong-coupling second-order correlation energy in Hartree: -4 t^2 / U.\"\"\"\n    t = t_of_R(R)\n    U = U_of_R(R)\n    return -4.0 * t ** 2 / U\n\ndef E_UHF(R):\n    \"\"\"Spin-symmetry-broken mean-field proxy energy in Hartree: -2 t^2 / U.\"\"\"\n    t = t_of_R(R)\n    U = U_of_R(R)\n    return -2.0 * t ** 2 / U\n\ndef E_PBE(R):\n    \"\"\"Semilocal PBE proxy energy in Hartree.\"\"\"\n    return E_RHF(R) + c_pbe * E_corr_strong(R)\n\ndef E_PBE0(R, alpha):\n    \"\"\"Global hybrid PBE0 proxy energy in Hartree with mixing fraction alpha.\"\"\"\n    return (1.0 - alpha) * E_PBE(R) + alpha * E_UHF(R)\n\ndef alpha_lr(R, omega):\n    \"\"\"Long-range mixing fraction alpha_lr(R; omega) = erf(omega R).\"\"\"\n    return erf(omega * R)\n\ndef E_LC_omega_PBE(R, omega):\n    \"\"\"Range-separated hybrid LC-omega-PBE proxy energy in Hartree.\"\"\"\n    a_lr = alpha_lr(R, omega)\n    return (1.0 - a_lr) * E_PBE(R) + a_lr * E_UHF(R)\n\ndef rmse_over_Rs(method_func, Rs, *params):\n    \"\"\"Compute RMSE in Hartree for a given method over separations Rs.\"\"\"\n    errors_sq = []\n    for R in Rs:\n        if params:\n            Em = method_func(R, *params)\n        else:\n            Em = method_func(R)\n        Ee = E_exact(R)\n        errors_sq.append((Em - Ee) ** 2)\n    return sqrt(np.mean(errors_sq))\n\ndef solve():\n    # Separation set in Bohr\n    Rs = [1.0, 1.4, 2.0, 3.0, 5.0, 8.0]\n\n    # Scenario definitions: (alpha for PBE0, omega for LC-omega-PBE)\n    scenarios = [\n        (\"A\", 0.25, 0.5),  # happy path\n        (\"B\", 0.0, 0.0),   # boundary semilocal limit\n        (\"C\", 1.0, 2.0),   # boundary long-range/exact-exchange-like limit\n    ]\n\n    results = []\n    for _, alpha, omega in scenarios:\n        # PBE RMSE (does not depend on alpha or omega)\n        rmse_pbe = rmse_over_Rs(E_PBE, Rs)\n        # PBE0 RMSE with given alpha\n        rmse_pbe0 = rmse_over_Rs(E_PBE0, Rs, alpha)\n        # LC-omega-PBE RMSE with given omega\n        rmse_lc = rmse_over_Rs(E_LC_omega_PBE, Rs, omega)\n        results.extend([rmse_pbe, rmse_pbe0, rmse_lc])\n\n    # Final print statement in the exact required format: nine floats, six decimals, in Hartree.\n    print(f\"[{','.join(f'{v:.6f}' for v in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从概念模型转向真实材料，本练习侧重于杂化泛函的一个关键应用：修正半导体的带隙，这是材料科学和电子学中的核心问题。您将建立一个模型，使用 PBE、PBE0 和 HSE 泛函来估算硅的带隙 。这个练习将阐明精确交换分数 ($a$) 和范围分离参数 ($\\mu$) 的不同作用，展示这些参数如何使杂化泛函能够比其半局域对应物更准确地调节电子性质。",
            "id": "3768362",
            "problem": "考虑一个受第一性原理启发的简化模型，在密度泛函理论 (DFT) 的 Kohn-Sham 框架内，使用杂化泛函来估算硅的带隙。目标是针对一组给定的计算参数，计算并比较 Perdew-Burke-Ernzerhof (PBE)、PBE0 和 Heyd-Scuseria-Ernzerhof (HSE) 泛函所预测的带隙。请基于以下基本原理和定义进行计算，不要使用任何简化公式。\n\n假设 Kohn-Sham 带隙是最低未占据和最高占据 Kohn-Sham 本征值之间的差值。杂化泛函将一部分非局域 Hartree-Fock 交换并入一个半局域交换相关泛函中。设非局域 Hartree-Fock 交换的比例由 $a$ 表示，其中对于 PBE，$a = 0$；对于 PBE0，$a = 0.25$；对于 HSE，$a = 0.25$。HSE 泛函使用短程库仑势来屏蔽非局域交换贡献。将此短程势建模为 $v_{\\mathrm{sr}}(r) = \\mathrm{erfc}(\\mu r)/r$，其中 $\\mu$ 是范围分离参数，单位为埃的倒数 ($\\mathrm{\\AA}^{-1}$)，$\\mathrm{erfc}(\\cdot)$ 是互补误差函数。未屏蔽的库仑势为 $v_{C}(r) = 1/r$。\n\n为将差异归因于屏蔽和非局域交换，假设由非局域交换引起的带隙增量与比例 $a$ 和一个屏蔽因子 $S(\\mu)$ 均成正比。该屏蔽因子 $S(\\mu)$ 用于量化在硅中典型的电子-空穴分离情况下，短程交换相对于未屏蔽交换的有效强度。将硅中的径向电子-空穴分离分布建模为各向同性的高斯分布，其宽度为 $\\sigma$（单位为埃），因此径向权重为 $p(r) \\propto r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right)$，其中 $r \\ge 0$。通过期望值之比定义屏蔽因子 $S(\\mu)$：\n$$\nS(\\mu) = \\frac{\\int_{0}^{\\infty} \\left[\\frac{\\mathrm{erfc}(\\mu r)}{r}\\right] r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r}{\\int_{0}^{\\infty} \\left[\\frac{1}{r}\\right] r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r},\n$$\n使得 $S(0) = 1$ 且当 $\\mu > 0$ 时 $0  S(\\mu)  1$。\n\n假设在完全收敛的计算极限下，硅的基准半局域 PBE 带隙为 $E_{\\mathrm{g}}^{\\mathrm{base}} = 0.62$ 电子伏特 (eV)，并且在收敛时能相对于基准完全打开带隙的未屏蔽非局域交换贡献的幅值为 $\\Delta_{\\infty} = 2.50$ eV。在杂化泛函带隙在收敛极限下相对于 $E_{\\mathrm{g}}^{\\mathrm{base}}$ 的增加量与 $a$ 和 $S(\\mu)$ 成比例的假设下，推导收敛极限带隙 $E_{\\mathrm{g}}^{\\infty}$ 关于 $a$、$\\mu$、$E_{\\mathrm{g}}^{\\mathrm{base}}$ 和 $\\Delta_{\\infty}$ 的数学上一致的表达式。\n\n为了捕捉有限计算参数的影响，将计算出的带隙中的残余数值误差建模为两项贡献之和：一项是布里渊区采样误差，其大小与k点网格线性维度的倒数成比例；另一项是平面波基组误差，其大小与平面波动能截断的平方根的倒数成比例。具体来说，使用\n$$\n\\delta E(N_{k}, E_{\\mathrm{cut}}) = c_{k} N_{k}^{-1/3} + c_{e} E_{\\mathrm{cut}}^{-1/2},\n$$\n其中 $N_{k}$ 是 k 点的总数，$E_{\\mathrm{cut}}$ 是以电子伏特 (eV) 为单位的平面波能量截断，$c_{k} = 0.12$ eV，以及 $c_{e} = 1.20$ $\\mathrm{eV}^{1/2}$。因此，在有限参数下计算得到的带隙是收敛极限带隙减去 $\\delta E(N_{k}, E_{\\mathrm{cut}})$。所有带隙都应以电子伏特 (eV) 表示。\n\n使用特征分离宽度 $\\sigma = 2.35$ 埃 ($\\mathrm{\\AA}$)。对于 HSE，使用屏蔽参数 $\\mu = 0.20$ $\\mathrm{\\AA}^{-1}$。对于 PBE0，屏蔽参数为 $\\mu = 0$。对于 PBE，非局域交换的比例为 $a = 0$，因此屏蔽是无关紧要的。你的程序必须在以下每个指定了 $(N_{k}, E_{\\mathrm{cut}})$ 的测试用例下，计算这三种泛函的带隙：\n\n- 测试用例 1：$(N_{k}, E_{\\mathrm{cut}}) = (8, 150)$。\n- 测试用例 2：$(N_{k}, E_{\\mathrm{cut}}) = (64, 300)$。\n- 测试用例 3：$(N_{k}, E_{\\mathrm{cut}}) = (216, 600)$。\n\n对于每个测试用例，你的程序必须输出一个由三个浮点数组成的三元组，按 PBE、PBE0 和 HSE 的顺序，分别对应于它们预测的带隙，单位均为电子伏特 (eV)。你的程序应生成单行输出，其中包含用方括号括起来的三个三元组，以逗号分隔，例如 $[[x_{1}, x_{2}, x_{3}], [y_{1}, y_{2}, y_{3}], [z_{1}, z_{2}, z_{3}]]$，其中每个元素都是一个实数。\n\n通过遵循上述假设和原理，确保科学真实性和内部一致性。特别是，你的推导应基于 Kohn-Sham DFT 框架、杂化泛函作为非局域 Hartree-Fock 交换与半局域交换相关混合物的定义，以及物理上合理的数值误差标度关系。所有计算必须与指定的单位保持一致，并且如果出现任何隐式角度度量，仅使用弧度（本问题中未出现角度）。",
            "solution": "根据指定的协议评估问题的有效性。\n\n### 步骤 1：提取已知条件\n- **模型框架**：用于估算硅带隙的 Kohn-Sham 密度泛函理论 (DFT)。\n- **泛函**：Perdew-Burke-Ernzerhof (PBE)、PBE0、Heyd-Scuseria-Ernzerhof (HSE)。\n- **杂化泛函参数 ($a$)**：非局域 Hartree-Fock 交换的比例。\n  - 对于 PBE: $a = 0$。\n  - 对于 PBE0: $a = 0.25$。\n  - 对于 HSE: $a = 0.25$。\n- **库仑势**：\n  - 未屏蔽：$v_{C}(r) = 1/r$。\n  - 屏蔽的（短程）：$v_{\\mathrm{sr}}(r) = \\mathrm{erfc}(\\mu r)/r$。\n- **范围分离参数 ($\\mu$)**：\n  - 对于 HSE：$\\mu = 0.20 \\, \\mathrm{\\AA}^{-1}$。\n  - 对于 PBE0：$\\mu = 0 \\, \\mathrm{\\AA}^{-1}$（未屏蔽的非局域交换）。\n  - 对于 PBE：$a=0$，因此 $\\mu$ 无关紧要。\n- **电子-空穴分离分布**：径向权重 $p(r) \\propto r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right)$，特征分离宽度 $\\sigma = 2.35 \\, \\mathrm{\\AA}$。\n- **屏蔽因子 ($S(\\mu)$)**：\n  $$ S(\\mu) = \\frac{\\int_{0}^{\\infty} \\left[\\frac{\\mathrm{erfc}(\\mu r)}{r}\\right] r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r}{\\int_{0}^{\\infty} \\left[\\frac{1}{r}\\right] r^{2} \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r} $$\n- **带隙模型（收敛极限）**：带隙 $E_{\\mathrm{g}}^{\\infty}$ 从基准 PBE 带隙 $E_{\\mathrm{g}}^{\\mathrm{base}}$ 开始，按与 $a$ 和 $S(\\mu)$ 成正比的方式增加。\n  - 基准 PBE 带隙：$E_{\\mathrm{g}}^{\\mathrm{base}} = 0.62 \\, \\mathrm{eV}$。\n  - 未屏蔽的非局域交换幅值：$\\Delta_{\\infty} = 2.50 \\, \\mathrm{eV}$。\n- **数值误差模型**：计算出的带隙减少了 $\\delta E(N_{k}, E_{\\mathrm{cut}})$。\n  - 误差函数：$\\delta E(N_{k}, E_{\\mathrm{cut}}) = c_{k} N_{k}^{-1/3} + c_{e} E_{\\mathrm{cut}}^{-1/2}$。\n  - $N_k$：k 点总数。\n  - $E_{\\mathrm{cut}}$：平面波能量截断，单位为 $\\mathrm{eV}$。\n  - 误差系数：$c_{k} = 0.12 \\, \\mathrm{eV}$, $c_{e} = 1.20 \\, \\mathrm{eV}^{1/2}$。\n- **$(N_{k}, E_{\\mathrm{cut}})$ 的测试用例**：\n  1. $(8, 150)$\n  2. $(64, 300)$\n  3. $(216, 600)$\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据**：该问题使用了一个简化但合理的模型，该模型植根于 DFT、杂化泛函 (PBE, PBE0, HSE)、Kohn-Sham 本征值和带隙修正等既定概念。对数值误差（k点采样、基组截断）的建模反映了平面波 DFT 计算中的标准收敛行为。使用 $\\mathrm{erfc}$ 进行屏蔽是 HSE 泛函的核心。该问题是计算材料物理建模方面一个结构良好的练习。\n- **良态问题**：所有必要的参数、常数和函数形式都已明确给出。任务是根据这些已知条件推导公式并应用它，这是一个定义明确的、可得出唯一解的数学过程。\n- **客观性**：问题使用精确、定量的语言和既定的科学术语进行陈述。它不含主观断言。\n- **缺陷清单**：该问题没有违反任何指定的缺陷。它在科学上是合理的（在模型的背景下），是完整的、一致的且结构良好。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供分步解决方案。\n\n### 解题推导\n\n解题过程分为四个阶段：\n1.  推导收敛极限带隙 $E_{\\mathrm{g}}^{\\infty}$ 的表达式。\n2.  简化屏蔽因子 $S(\\mu)$ 的表达式。\n3.  结合这些以获得计算带隙 $E_{\\mathrm{g}}$ 的最终表达式。\n4.  将最终公式应用于指定的泛函和测试用例。\n\n**1. 收敛极限带隙, $E_{\\mathrm{g}}^{\\infty}$**\n\n问题陈述，对于一个杂化泛函，其带隙 $E_{\\mathrm{g}}^{\\infty}$ 由基准 PBE 带隙 $E_{\\mathrm{g}}^{\\mathrm{base}}$ 加上一个与 Hartree-Fock 交换比例 $a$、总交换幅值 $\\Delta_{\\infty}$ 和屏蔽因子 $S(\\mu)$ 成正比的增量给出。这得出了以下表达式：\n$$ E_{\\mathrm{g}}^{\\infty}(a, \\mu) = E_{\\mathrm{g}}^{\\mathrm{base}} + a \\cdot \\Delta_{\\infty} \\cdot S(\\mu) $$\n\n**2. 屏蔽因子, $S(\\mu)$**\n\n屏蔽因子定义为两个积分之比：\n$$ S(\\mu) = \\frac{I_{\\text{num}}(\\mu)}{I_{\\text{den}}} $$\n其中\n$$ I_{\\text{num}}(\\mu) = \\int_{0}^{\\infty} r \\cdot \\mathrm{erfc}(\\mu r) \\cdot \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r $$\n$$ I_{\\text{den}} = \\int_{0}^{\\infty} r \\cdot \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\, \\mathrm{d}r $$\n\n首先，我们计算分母积分 $I_{\\text{den}}$。令 $u = r^2 / (2\\sigma^2)$，这意味着 $du = r/\\sigma^2 \\, dr$。\n$$ I_{\\text{den}} = \\sigma^2 \\int_{0}^{\\infty} \\exp(-u) \\, du = \\sigma^2 \\left[ -\\exp(-u) \\right]_{0}^{\\infty} = \\sigma^2 (0 - (-1)) = \\sigma^2 $$\n\n接下来，我们计算分子积分 $I_{\\text{num}}(\\mu)$。该积分是一个已知的形式，但其正确性可以使用莱布尼兹积分法则（在积分符号下求导）来验证。让我们对 $I_{\\text{num}}(\\mu)$ 关于 $\\mu$ 求导：\n$$ \\frac{d}{d\\mu} I_{\\text{num}}(\\mu) = \\int_{0}^{\\infty} r \\cdot \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\cdot \\frac{\\partial}{\\partial\\mu} \\left(\\mathrm{erfc}(\\mu r)\\right) \\, \\mathrm{d}r $$\n使用导数 $\\frac{d}{dx}\\mathrm{erfc}(x) = -\\frac{2}{\\sqrt{\\pi}}e^{-x^2}$，我们有 $\\frac{\\partial}{\\partial\\mu}\\mathrm{erfc}(\\mu r) = -\\frac{2r}{\\sqrt{\\pi}}e^{-(\\mu r)^2}$。\n$$ \\frac{d}{d\\mu} I_{\\text{num}}(\\mu) = \\int_{0}^{\\infty} r \\cdot \\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right) \\left(-\\frac{2r}{\\sqrt{\\pi}}e^{-\\mu^2 r^2}\\right) \\, \\mathrm{d}r = -\\frac{2}{\\sqrt{\\pi}} \\int_{0}^{\\infty} r^2 \\cdot \\exp\\left(-\\left(\\frac{1}{2\\sigma^{2}}+\\mu^2\\right)r^2\\right) \\, \\mathrm{d}r $$\n这是一个标准的高斯积分，形式为 $\\int_{0}^{\\infty} x^2 e^{-A x^2} dx = \\frac{\\sqrt{\\pi}}{4 A^{3/2}}$。令 $A = \\frac{1}{2\\sigma^2} + \\mu^2 = \\frac{1+2\\mu^2\\sigma^2}{2\\sigma^2}$。\n$$ \\frac{d}{d\\mu} I_{\\text{num}}(\\mu) = -\\frac{2}{\\sqrt{\\pi}} \\cdot \\frac{\\sqrt{\\pi}}{4 A^{3/2}} = -\\frac{1}{2A^{3/2}} = -\\frac{1}{2} \\left(\\frac{1+2\\mu^2\\sigma^2}{2\\sigma^2}\\right)^{-3/2} = -\\frac{\\sqrt{2}\\sigma^3}{(1+2\\mu^2\\sigma^2)^{3/2}} $$\n通过对该表达式关于 $\\mu$ 进行积分，并使用边界条件 $I_{\\text{num}}(0) = I_{\\text{den}} = \\sigma^2$，可以得到闭合形式的解：\n$$ I_{\\text{num}}(\\mu) = \\sigma^2 \\left(1 - \\frac{\\sqrt{2} \\mu\\sigma}{\\sqrt{1+2\\mu^2\\sigma^2}}\\right) $$\n因此，屏蔽因子简化为：\n$$ S(\\mu) = \\frac{I_{\\text{num}}(\\mu)}{I_{\\text{den}}} = \\frac{\\sigma^2 \\left(1 - \\frac{\\sqrt{2} \\mu\\sigma}{\\sqrt{1+2\\mu^2\\sigma^2}}\\right)}{\\sigma^2} = 1 - \\frac{\\sqrt{2} \\mu\\sigma}{\\sqrt{1+2\\mu^2\\sigma^2}} $$\n该表达式正确地给出 $S(0) = 1$ 和 $S(\\mu \\to \\infty) = 1-\\frac{\\sqrt{2}\\mu\\sigma}{\\sqrt{2\\mu^2\\sigma^2}} = 0$。\n\n**3. 计算带隙的最终表达式, $E_{\\mathrm{g}}$**\n\n在有限参数 $(N_k, E_{\\mathrm{cut}})$ 下计算的带隙是收敛极限带隙减去数值误差 $\\delta E$：\n$$ E_{\\mathrm{g}}(a, \\mu, N_k, E_{\\mathrm{cut}}) = E_{\\mathrm{g}}^{\\infty}(a, \\mu) - \\delta E(N_k, E_{\\mathrm{cut}}) $$\n代入推导出的表达式：\n$$ E_{\\mathrm{g}} = E_{\\mathrm{g}}^{\\mathrm{base}} + a \\cdot \\Delta_{\\infty} \\cdot \\left(1 - \\frac{\\sqrt{2} \\mu\\sigma}{\\sqrt{1+2\\mu^2\\sigma^2}}\\right) - \\left( c_{k} N_{k}^{-1/3} + c_{e} E_{\\mathrm{cut}}^{-1/2} \\right) $$\n\n**4. 应用于泛函和测试用例**\n\n首先，我们计算每种泛函的常数项。\n- **给定常数**：$E_{\\mathrm{g}}^{\\mathrm{base}} = 0.62$, $\\Delta_{\\infty} = 2.50$, $c_k = 0.12$, $c_e = 1.20$, $\\sigma = 2.35$。\n- **对于 PBE**：$a=0$。收敛带隙就是 $E_{\\mathrm{g}}^{\\infty, \\mathrm{PBE}} = E_{\\mathrm{g}}^{\\mathrm{base}} = 0.62 \\, \\mathrm{eV}$。\n- **对于 PBE0**：$a=0.25$, $\\mu=0$。屏蔽因子为 $S(0) = 1$。\n  $E_{\\mathrm{g}}^{\\infty, \\mathrm{PBE0}} = 0.62 + 0.25 \\cdot 2.50 \\cdot 1 = 0.62 + 0.625 = 1.245 \\, \\mathrm{eV}$。\n- **对于 HSE**：$a=0.25$, $\\mu=0.20$。\n  首先，计算 $S(0.20)$：\n  $\\mu\\sigma = 0.20 \\cdot 2.35 = 0.47$。\n  $1+2\\mu^2\\sigma^2 = 1 + 2 \\cdot (0.47)^2 = 1 + 2 \\cdot 0.2209 = 1.4418$。\n  $S(0.20) = 1 - \\frac{\\sqrt{2} \\cdot 0.47}{\\sqrt{1.4418}} = 1 - \\frac{0.66468037...}{1.20074978...} \\approx 1 - 0.5535261 = 0.4464739$。\n  $E_{\\mathrm{g}}^{\\infty, \\mathrm{HSE}} = 0.62 + 0.25 \\cdot 2.50 \\cdot S(0.20) = 0.62 + 0.625 \\cdot 0.4464739 \\approx 0.62 + 0.2790462 = 0.8990462 \\, \\mathrm{eV}$。\n\n现在，我们为每个测试用例计算数值误差 $\\delta E$，并将其从收敛极限带隙中减去。\n\n**测试用例 1：$(N_k, E_{\\mathrm{cut}}) = (8, 150)$**\n$\\delta E_1 = 0.12 \\cdot 8^{-1/3} + 1.20 \\cdot 150^{-1/2} = 0.12 \\cdot 0.5 + 1.20 \\cdot 0.0816496... = 0.06 + 0.097979... = 0.157980 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},1}^{\\mathrm{PBE}} = 0.62 - 0.157980 = 0.462020 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},1}^{\\mathrm{PBE0}} = 1.245 - 0.157980 = 1.087020 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},1}^{\\mathrm{HSE}} = 0.899046 - 0.157980 = 0.741066 \\, \\mathrm{eV}$。\n结果 1：$[0.462020, 1.087020, 0.741066]$\n\n**测试用例 2：$(N_k, E_{\\mathrm{cut}}) = (64, 300)$**\n$\\delta E_2 = 0.12 \\cdot 64^{-1/3} + 1.20 \\cdot 300^{-1/2} = 0.12 \\cdot 0.25 + 1.20 \\cdot 0.057735... = 0.03 + 0.069282... = 0.099282 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},2}^{\\mathrm{PBE}} = 0.62 - 0.099282 = 0.520718 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},2}^{\\mathrm{PBE0}} = 1.245 - 0.099282 = 1.145718 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},2}^{\\mathrm{HSE}} = 0.899046 - 0.099282 = 0.799764 \\, \\mathrm{eV}$。\n结果 2：$[0.520718, 1.145718, 0.799764]$\n\n**测试用例 3：$(N_k, E_{\\mathrm{cut}}) = (216, 600)$**\n$\\delta E_3 = 0.12 \\cdot 216^{-1/3} + 1.20 \\cdot 600^{-1/2} = 0.12 \\cdot (1/6) + 1.20 \\cdot 0.0408248... = 0.02 + 0.048990... = 0.068990 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},3}^{\\mathrm{PBE}} = 0.62 - 0.068990 = 0.551010 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},3}^{\\mathrm{PBE0}} = 1.245 - 0.068990 = 1.176010 \\, \\mathrm{eV}$。\n$E_{\\mathrm{g},3}^{\\mathrm{HSE}} = 0.899046 - 0.068990 = 0.830056 \\, \\mathrm{eV}$。\n结果 3：$[0.551010, 1.176010, 0.830056]$\n\n这些数值结果将在提供的 Python 代码中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the band gap of silicon for PBE, PBE0, and HSE functionals\n    based on a simplified first-principles model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (8, 150),   # (N_k, E_cut) for Test Case 1\n        (64, 300),  # (N_k, E_cut) for Test Case 2\n        (216, 600)  # (N_k, E_cut) for Test Case 3\n    ]\n\n    # Constants from the problem statement\n    E_g_base = 0.62   # eV\n    Delta_inf = 2.50  # eV\n    c_k = 0.12        # eV\n    c_e = 1.20        # eV^(1/2)\n    sigma = 2.35      # angstroms\n\n    # Parameters for each functional\n    functionals = {\n        'PBE':  {'a': 0.0, 'mu': np.nan},  # mu is irrelevant for PBE\n        'PBE0': {'a': 0.25, 'mu': 0.0},\n        'HSE':  {'a': 0.25, 'mu': 0.20}   # mu in angstrom^-1\n    }\n\n    # Pre-calculate converged-limit band gaps for each functional\n    E_g_inf = {}\n\n    for name, params in functionals.items():\n        a = params['a']\n        mu = params['mu']\n        \n        if a == 0:\n            S_mu = np.nan # Not needed\n        elif mu == 0:\n            # For PBE0, mu=0, so the screening factor S(mu) is 1.\n            S_mu = 1.0\n        else:\n            # For HSE, calculate the screening factor S(mu).\n            # S(mu) = 1 - (sqrt(2) * mu * sigma) / sqrt(1 + 2 * (mu * sigma)^2)\n            mu_sigma = mu * sigma\n            numerator = np.sqrt(2) * mu_sigma\n            denominator = np.sqrt(1 + 2 * mu_sigma**2)\n            S_mu = 1.0 - numerator / denominator\n        \n        # Converged-limit band gap: E_g_inf = E_g_base + a * Delta_inf * S_mu\n        if a > 0:\n            E_g_inf[name] = E_g_base + a * Delta_inf * S_mu\n        else:\n            E_g_inf[name] = E_g_base\n\n    results = []\n    for case in test_cases:\n        N_k, E_cut = case\n        \n        # Calculate numerical error term\n        # delta_E = c_k * N_k^(-1/3) + c_e * E_cut^(-1/2)\n        delta_E = c_k * (N_k**(-1/3)) + c_e * (E_cut**(-0.5))\n        \n        # Calculate finite-parameter band gaps for each functional\n        gap_pbe = E_g_inf['PBE'] - delta_E\n        gap_pbe0 = E_g_inf['PBE0'] - delta_E\n        gap_hse = E_g_inf['HSE'] - delta_E\n        \n        results.append([gap_pbe, gap_pbe0, gap_hse])\n\n    # Format the final output string\n    # e.g., [[x1, x2, x3], [y1, y2, y3], [z1, z2, z3]]\n    result_str_list = []\n    for res_triple in results:\n        result_str_list.append(f\"[{','.join(map(str, res_triple))}]\")\n    \n    final_output = f\"[{','.join(result_str_list)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "对于周期性固体，任何 DFT 计算的准确性都严重依赖于布里渊区上的数值积分。最后一个练习探讨了杂化交换能相对于 $k$ 点网格密度的收敛性 。通过实施一个数值实验并将误差拟合到标度律，您将掌握一项至关重要的实践技能，并对固态杂化泛函计算中涉及的计算成本与准确性之间的权衡获得直观的理解。",
            "id": "3768320",
            "problem": "您需要推导并实现一个数值实验，以评估简化的混合交换能对于三维立方半导体的$k$点网格密度的收敛性，并确定积分误差与总$k$点数之间的经验标度律。目标是测试布里渊区 (BZ) 的离散化如何影响计算出的混合交换能，并估计误差的渐近衰减率。\n\n从以下符合上下文的基本基础开始：\n- 晶格常数为 $a$ 的立方晶格的布里渊区 (BZ) 是倒易空间中的一个立方体，边长为 $L = \\dfrac{2\\pi}{a}$，因此 BZ 区域是笛卡尔积 $[-\\tfrac{\\pi}{a}, \\tfrac{\\pi}{a}]^3$。\n- 在混合泛函中，一部分 Hartree-Fock (HF) 交换通过一个混合参数与密度泛函近似混合。设 $\\alpha_{mix}$ 表示混合泛函中混合的 HF 交换的比例。\n- 在范围分离的混合泛函（如 Heyd-Scuseria-Ernzerhof (HSE) 泛函）中使用的屏蔽库仑核，可以在倒易空间中用一个随 $\\|\\mathbf{q}\\|$ 衰减的因子来表示，以对 $\\mathbf{q} = \\mathbf{0}$ 处的奇点进行正则化。\n- BZ 上的数值积分可以通过一个均匀的 $M \\times M \\times M$ 中点 $k$ 点网格进行，网格间距为 $h = \\dfrac{2\\pi}{a M}$。对于足够光滑的被积函数，每个维度中的矩形中点法则的误差标度为 $\\mathcal{O}(h^2)$，这意味着总误差按 $M$ 的幂次衰减。\n\n为了在保持物理合理性和数学可处理性的同时，分离出 $k$ 点采样的影响，请使用以下屏蔽混合交换能模型：\n1. 将倒易空间中的屏蔽库仑核定义为 $V_{scr}(\\mathbf{q}) = \\dfrac{4\\pi}{\\|\\mathbf{q}\\|^2} \\exp\\!\\left(-\\dfrac{\\|\\mathbf{q}\\|^2}{4\\mu^2}\\right)$，其中 $\\mu$ 是一个具有倒易长度单位的正屏蔽参数。\n2. 将对密度因子建模为 $P(\\mathbf{q}) = \\|\\mathbf{q}\\|^2 \\exp\\!\\left(-\\dfrac{\\|\\mathbf{q}\\|^2}{2 k_0^2}\\right)$，其中 $k_0$ 是一个具有倒易长度单位的正重叠标度。\n3. 乘积 $V_{scr}(\\mathbf{q}) P(\\mathbf{q})$ 消除了在 $\\mathbf{q}=\\mathbf{0}$ 处的奇点，并在 BZ 上产生了一个光滑的径向高斯被积函数：\n$$\nf(\\mathbf{q}) = 4\\pi \\exp\\!\\left(-\\gamma \\|\\mathbf{q}\\|^2\\right), \\quad \\gamma = \\dfrac{1}{4\\mu^2} + \\dfrac{1}{2 k_0^2}.\n$$\n4. 混合交换能由此定义为\n$$\nE_x^{hyb}(M) = \\alpha_{mix} E_0 \\int_{BZ} f(\\mathbf{q}) \\, d^3\\mathbf{q} \\approx \\alpha_{mix} E_0 \\sum_{i=1}^{M^3} f(\\mathbf{q}_i) \\, h^3,\n$$\n其中 $\\mathbf{q}_i$ 是均匀网格上的中点采样点，$h = \\dfrac{2\\pi}{a M}$，$E_0$ 是一个常数能量标度。为反映交换能的常规符号，取 $E_0 = -1$ 原子单位 (a.u.)，因此能量以原子单位报告。\n\n您的任务：\n- 对于每个提供的测试用例，使用一个精细的均匀网格（$M_{ref} = 64$，即总点数为 $N_k^{ref} = 64^3$）、中点法则以及上述定义，计算参考值 $E_{ref}$。\n- 对于每个测试用例中给出的一组较粗的网格 $M \\in \\{M_1, M_2, \\dots\\}$，计算 $E_x^{hyb}(M)$ 和绝对误差 $err(M) = |E_x^{hyb}(M) - E_{ref}|$。\n- 拟合一个形式为\n$$\nerr(N_k) \\approx C \\, N_k^{-p},\n$$\n的经验标度律，其中 $N_k = M^3$ 是 $k$ 点的总数，$C$ 和 $p$ 是通过对数域中的最小二乘法确定的正常数。具体来说，对所有满足 $err(M)  0$ 的给定 $M$ 值，使用线性回归拟合 $\\log(err) = \\log(C) - p \\log(N_k)$。\n- 对于每个测试用例，报告结果元组 $[E_{ref}, E_{M_{max}}, p, C]$，其中 $E_{M_{max}}$ 是在该测试用例集合中最大网格尺寸下计算的混合交换能。\n\n所有能量必须以原子单位 (a.u.) 表示。此问题中不出现角度或百分比。\n\n测试套件：\n使用以下参数集来检验不同的平滑度和晶格标度：\n- 测试用例 1：$a = 5.43$, $\\mu = 0.2$, $k_0 = 0.5$, $\\alpha_{mix} = 0.25$, $M \\in \\{6, 8, 10, 12, 16, 20\\}$, $M_{ref} = 64$。\n- 测试用例 2：$a = 3.57$, $\\mu = 0.4$, $k_0 = 1.0$, $\\alpha_{mix} = 0.25$, $M \\in \\{4, 6, 8, 12, 18, 24\\}$, $M_{ref} = 64$。\n- 测试用例 3：$a = 6.46$, $\\mu = 0.1$, $k_0 = 0.3$, $\\alpha_{mix} = 0.30$, $M \\in \\{6, 10, 14, 20, 28\\}$, $M_{ref} = 64$。\n- 测试用例 4：$a = 4.00$, $\\mu = 0.8$, $k_0 = 2.0$, $\\alpha_{mix} = 0.25$, $M \\in \\{4, 6, 8, 10, 12, 14\\}$, $M_{ref} = 64$。\n\n算法细节：\n- 对均匀网格的每个维度使用中点采样：对于每个坐标，在 $q_j = -\\dfrac{\\pi}{a} + \\left(j + \\dfrac{1}{2}\\right) h$ 处采样，其中 $j = 0, 1, \\dots, M-1$，$h = \\dfrac{2\\pi}{a M}$。\n- 计算 $\\|\\mathbf{q}\\|^2 = q_x^2 + q_y^2 + q_z^2$ 并逐点计算 $f(\\mathbf{q})$，然后求和并乘以 $h^3$。\n- 对 $(\\log(N_k), \\log(err))$ 使用线性最小二乘法得到 $p$ 和 $C$。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个以逗号分隔的各测试用例结果列表。每个测试用例的结果本身是一个按 $[E_{ref}, E_{M_{max}}, p, C]$ 顺序排列的四元素列表。所有四个值都必须打印为小数点后保留六位的小数十进制浮点数。例如，单个测试用例将显示为 $[[E_{ref}, E_{M_{max}}, p, C]]$，多个测试用例应聚合为 $[[E_{ref,1}, E_{M_{max,1}}, p_1, C_1],[E_{ref,2}, E_{M_{max,2}}, p_2, C_2],\\dots]$。",
            "solution": "问题陈述被评估为有效。它在科学上基于凝聚态物理和计算材料科学的原理，特别是与密度泛函理论 (DFT) 和布里渊区积分的数值计算相关。混合交换能的简化模型是一种物理上合理且数学上易于处理的表示，用于研究 $k$ 点采样的收敛性质，这是电子结构计算的一个基本方面。问题提法得当，提供了执行所需计算和分析的所有必要定义、常数和参数。任务是客观且明确陈述的，会导出一个唯一的数值解。没有矛盾、歧义或事实错误。\n\n该问题需要一个数值实验来研究模型混合交换能相对于用于离散化布里渊区 (BZ) 的 $k$ 点网格密度的收敛性。这涉及为各种网格尺寸计算能量，确定相对于高密度参考计算的误差，并将误差拟合到经验幂律标度模型。\n\n混合交换能由模型被积函数 $f(\\mathbf{q})$ 在立方晶格的 BZ 上的积分定义。BZ 是倒易空间中的一个立方体，其区域为 $[-\\frac{\\pi}{a}, \\frac{\\pi}{a}]^3$，其中 $a$ 是晶格常数。BZ 的总体积为 $V_{BZ} = (\\frac{2\\pi}{a})^3$。\n\n模型被积函数由下式给出：\n$$\nf(\\mathbf{q}) = 4\\pi \\exp(-\\gamma \\|\\mathbf{q}\\|^2)\n$$\n其中 $\\|\\mathbf{q}\\|^2 = q_x^2 + q_y^2 + q_z^2$，参数 $\\gamma$ 由屏蔽参数 $\\mu$ 和重叠标度 $k_0$ 决定：\n$$\n\\gamma = \\frac{1}{4\\mu^2} + \\frac{1}{2 k_0^2}\n$$\n总混合交换能，包括混合分数 $\\alpha_{mix}$ 和能量标度 $E_0 = -1 \\, \\text{a.u.}$，为：\n$$\nE_x^{hyb} = \\alpha_{mix} E_0 \\int_{BZ} f(\\mathbf{q}) \\, d^3\\mathbf{q}\n$$\n这个积分使用一个均匀的 $M \\times M \\times M$ $k$ 点网格进行数值近似。求积采用中点法则。BZ 被划分为 $M^3$ 个小立方体，每个体积为 $h^3$，其中 $h = \\frac{2\\pi}{aM}$ 是每个维度上的网格间距。积分通过对每个小立方体中心的被积函数值求和来近似。采样点 $\\mathbf{q}_i = (q_x, q_y, q_z)$ 的坐标由下式给出：\n$$\nq_k = -\\frac{\\pi}{a} + \\left(j_k + \\frac{1}{2}\\right)h, \\quad \\text{对于 } j_k = 0, 1, \\dots, M-1 \\text{ 和 } k \\in \\{x, y, z\\}\n$$\n给定网格尺寸 $M$ 的数值近似能量为：\n$$\nE_x^{hyb}(M) = \\alpha_{mix} E_0 \\sum_{i=1}^{M^3} f(\\mathbf{q}_i) h^3\n$$\n任务的核心是分析这种数值近似的收敛性。对于给定的 $M$，近似的误差定义为相对于一个用非常精细的网格 $M_{ref} = 64$ 计算出的高精度参考值 $E_{ref}$ 的差值。\n$$\nerr(M) = |E_x^{hyb}(M) - E_{ref}|\n$$\n我们预计随着 $k$ 点数量 $N_k = M^3$ 的增加，这个误差会减小。问题假设误差存在一个幂律标度关系：\n$$\nerr(N_k) \\approx C N_k^{-p}\n$$\n其中 $C$ 和 $p$ 是待确定的常数。指数 $p$ 表征收敛速率。这个幂律关系可以通过对两边取对数来线性化：\n$$\n\\log(err(N_k)) \\approx \\log(C) - p \\log(N_k)\n$$\n这是一个形如 $y = m x + c$ 的线性方程，其中 $y = \\log(err)$，$x = \\log(N_k)$，斜率 $m = -p$，截距 $c = \\log(C)$。因此，常数 $p$ 和 $C$ 可以通过对为指定 $M$ 值集合计算出的 $(\\log(N_k), \\log(err))$ 对进行线性最小二乘拟合来确定。从拟合直线的斜率和截距，我们得到 $p = -m$ 和 $C = \\exp(c)$。\n\n对于一维中点法则，应用于一个区间上足够光滑（例如，$C^2$）的非周期函数，其理论误差标度为 $\\mathcal{O}(h^2)$。对于我们的三维立方网格问题，总误差也预期与网格间距的二次方成比例，即 $err \\propto h^2$。鉴于 $h = \\frac{2\\pi}{aM}$ 且总点数为 $N_k = M^3$，我们可以将 $h$ 与 $N_k$ 联系起来：$M = N_k^{1/3}$，所以 $h \\propto N_k^{-1/3}$。将此代入误差标度关系得：\n$$\nerr(N_k) \\propto (N_k^{-1/3})^2 = N_k^{-2/3}\n$$\n因此，我们理论上预期收敛指数为 $p \\approx 2/3 \\approx 0.667$。数值实验将验证此标度关系，并确定不同物理参数下的经验值 $p$。\n\n每个测试用例的算法流程如下：\n1.  根据给定的 $\\mu$ 和 $k_0$ 计算常数 $\\gamma$。\n2.  实现一个函数，该函数能为任何给定的 $M$ 计算 $E_x^{hyb}(M)$。该函数将生成 $\\mathbf{q}_i$ 点的三维网格，计算 $\\|\\mathbf{q}_i\\|^2$，计算被积函数 $f(\\mathbf{q}_i)$，对结果求和，并乘以适当的前置因子和体积元 $h^3$。\n3.  通过调用此函数并使用 $M_{ref} = 64$ 来计算参考能量 $E_{ref}$。\n4.  对于测试用例指定的集合中的每个 $M$，计算 $E_x^{hyb}(M)$ 和相应的误差 $err(M)$。将集合中最大的 $M$（即 $M_{max}$）所对应的 $E_x^{hyb}(M)$ 值存储为 $E_{M_{max}}$。\n5.  收集所有满足 $err(M)  0$ 的 $M$ 所对应的对 $(N_k, err(M))$，其中 $N_k=M^3$。\n6.  对 $(\\log(N_k), \\log(err))$ 进行线性最小二乘回归，以找到斜率和截距。\n7.  从斜率和截距计算标度参数 $p$ 和 $C$。\n8.  组合并报告最终结果 $[E_{ref}, E_{M_{max}}, p, C]$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements a numerical experiment to assess the convergence\n    of a simplified hybrid exchange energy with respect to k-point mesh density.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"a\": 5.43, \"mu\": 0.2, \"k0\": 0.5, \"alpha_mix\": 0.25,\n            \"M_vals\": [6, 8, 10, 12, 16, 20], \"M_ref\": 64\n        },\n        {\n            \"a\": 3.57, \"mu\": 0.4, \"k0\": 1.0, \"alpha_mix\": 0.25,\n            \"M_vals\": [4, 6, 8, 12, 18, 24], \"M_ref\": 64\n        },\n        {\n            \"a\": 6.46, \"mu\": 0.1, \"k0\": 0.3, \"alpha_mix\": 0.30,\n            \"M_vals\": [6, 10, 14, 20, 28], \"M_ref\": 64\n        },\n        {\n            \"a\": 4.00, \"mu\": 0.8, \"k0\": 2.0, \"alpha_mix\": 0.25,\n            \"M_vals\": [4, 6, 8, 10, 12, 14], \"M_ref\": 64\n        },\n    ]\n\n    def compute_energy(params, M):\n        \"\"\"\n        Computes the hybrid exchange energy for a given mesh size M.\n        \"\"\"\n        a = params[\"a\"]\n        mu = params[\"mu\"]\n        k0 = params[\"k0\"]\n        alpha_mix = params[\"alpha_mix\"]\n        E0 = -1.0\n\n        # Calculate derived constants\n        gamma = 1.0 / (4.0 * mu**2) + 1.0 / (2.0 * k0**2)\n        h = (2.0 * np.pi) / (a * M)\n\n        # Generate 1D midpoint coordinates\n        q_1d = -np.pi / a + (np.arange(M) + 0.5) * h\n        \n        # Create 3D grid of q-vectors\n        qx, qy, qz = np.meshgrid(q_1d, q_1d, q_1d, indexing='ij')\n\n        # Calculate squared magnitude of q for all points on the grid\n        q_squared = qx**2 + qy**2 + qz**2\n\n        # Evaluate the integrand at all grid points\n        integrand_values = 4.0 * np.pi * np.exp(-gamma * q_squared)\n\n        # Approximate the integral using the midpoint sum\n        integral_sum = np.sum(integrand_values)\n        \n        # Calculate the final energy\n        energy = alpha_mix * E0 * integral_sum * (h**3)\n        \n        return energy\n\n    all_results = []\n    for case in test_cases:\n        # Compute reference energy with a fine mesh\n        E_ref = compute_energy(case, case[\"M_ref\"])\n\n        N_k_vals = []\n        err_vals = []\n        E_M_max = 0.0\n        M_max = max(case[\"M_vals\"])\n\n        for M in sorted(case[\"M_vals\"]):\n            E_M = compute_energy(case, M)\n            \n            if M == M_max:\n                E_M_max = E_M\n\n            err = abs(E_M - E_ref)\n            \n            # Only consider non-zero errors for the log-log fit\n            if err > 1e-15: # Use a small threshold to avoid log(0)\n                N_k_vals.append(M**3)\n                err_vals.append(err)\n        \n        # Perform linear regression in the logarithmic domain\n        log_Nk = np.log(np.array(N_k_vals))\n        log_err = np.log(np.array(err_vals))\n\n        # polyfit returns [slope, intercept] for a 1st-degree polynomial\n        slope, intercept = np.polyfit(log_Nk, log_err, 1)\n\n        # Extract p and C from the fit parameters\n        # log(err) = log(C) - p * log(Nk)\n        # slope = -p, intercept = log(C)\n        p = -slope\n        C = np.exp(intercept)\n        \n        case_results = [E_ref, E_M_max, p, C]\n        all_results.append(case_results)\n\n    # Format the final output string\n    output_parts = []\n    for res in all_results:\n        formatted_res = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{res[3]:.6f}]\"\n        output_parts.append(formatted_res)\n\n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n```"
        }
    ]
}