{
    "hands_on_practices": [
        {
            "introduction": "在多尺度有限元方法（MsFEM）中，过采样是缓解局部计算域边界误差的关键技术。当粗网格单元的边界与材料属性的剧烈变化之处重合或邻近时，在最小的粗单元上施加人工边界条件，会在计算出的基函数中产生一个非物理的“边界层”。本练习通过一个简单的一维情景，清晰地量化了这一现象，让您能够解析地推导出这些伪效应引入的误差()，从而为理解为何需要过采样建立起基本直觉。",
            "id": "3790695",
            "problem": "考虑一个在一维空间中带有不连续系数的标量、二阶、线性椭圆模型问题。令物理域为 $D=(0,1)$，感兴趣的单元为 $K=\\left(0,\\frac{1}{2}\\right)$。对于给定的过采样宽度 $\\delta \\in \\left(0,\\frac{1}{2}\\right)$，定义过采样区域 $U_{K}=\\left(0,\\frac{1}{2}+\\delta\\right)$。令系数 $A(x)$ 是不连续的分段常数，由下式给出\n$$\nA(x)=\\begin{cases}\n1,  x \\in \\left(0,\\frac{1}{2}\\right),\\\\\n\\varepsilon,  x \\in \\left(\\frac{1}{2},\\frac{1}{2}+\\delta\\right),\n\\end{cases}\n$$\n其中 $\\varepsilon \\in (0,1)$ 是一个固定的对比度参数。在多尺度有限元方法 (MsFEM) 中，考虑定义在 $U_{K}$ 上的局部基函数，它由朴素的狄利克雷边界条件定义\n$$\n-(A(x)\\,\\psi^{\\mathrm{os}\\,'}(x))' = 0 \\text{ on } U_{K}, \\quad \\psi^{\\mathrm{os}}(0)=1, \\quad \\psi^{\\mathrm{os}}\\!\\left(\\tfrac{1}{2}+\\delta\\right)=0,\n$$\n并将其在 $K$ 上的限制定义为 $\\psi^{\\mathrm{os}}|_{K}$。同时，定义在 $K$ 上的理想、非过采样的局部基函数，\n$$\n-(A(x)\\,\\psi^{\\mathrm{id}\\,'}(x))' = 0 \\text{ on } K, \\quad \\psi^{\\mathrm{id}}(0)=1, \\quad \\psi^{\\mathrm{id}}\\!\\left(\\tfrac{1}{2}\\right)=0,\n$$\n其中在 $K$ 上 $A(x)\\equiv 1$。在一维情况下，刚度贡献与 $K$ 上常数梯度的平方成比例，并且限制过程直接使用 $\\psi^{\\mathrm{os}}|_{K}$。\n\n仅使用一维椭圆算子的基本性质以及在 $A$ 为常数的每个子区间内通量为常数的性质，计算比率的闭式表达式\n$$\nE(\\varepsilon,\\delta)\\equiv \\frac{\\psi^{\\mathrm{os}\\,'}(x)}{\\psi^{\\mathrm{id}\\,'}(x)} \\quad \\text{for any } x \\in K,\n$$\n该比率量化了未被限制操作移除的伪边界层影响。将您的最终答案表示为关于 $\\varepsilon$ 和 $\\delta$ 的简化解析表达式。不需要进行数值计算，也不涉及单位。",
            "solution": "我们对用户提供的问题进行了严格审查，并确认其有效。该问题在科学上基于椭圆偏微分方程理论及其通过多尺度方法的数值逼近。这是一个适定问题，对于一维二阶常微分方程，指定的边界条件保证了唯一解的存在。所有数据和定义都已提供，不存在内部矛盾、歧义或不切实际的假设。因此，我们可以着手求解。\n\n目标是计算当 $x \\in K = \\left(0,\\frac{1}{2}\\right)$ 时比率 $E(\\varepsilon,\\delta)\\equiv \\frac{\\psi^{\\mathrm{os}\\,'}(x)}{\\psi^{\\mathrm{id}\\,'}(x)}$。这需要求出在区间 $K$ 上梯度 $\\psi^{\\mathrm{id}\\,'}(x)$ 和 $\\psi^{\\mathrm{os}\\,'}(x)$ 的表达式。\n\n首先，我们求解在域 $K = \\left(0,\\frac{1}{2}\\right)$ 上的理想基函数 $\\psi^{\\mathrm{id}}(x)$。\n控制方程为\n$$\n-(A(x)\\,\\psi^{\\mathrm{id}\\,'}(x))' = 0 \\quad \\text{on } K.\n$$\n在区间 $K$ 上，系数被指定为 $A(x)=1$。因此，方程简化为\n$$\n-\\psi^{\\mathrm{id}\\,''}(x) = 0.\n$$\n该方程的通解是 $x$ 的线性函数：\n$$\n\\psi^{\\mathrm{id}}(x) = c_1 x + c_2,\n$$\n其中 $c_1$ 和 $c_2$ 是积分常数。我们使用给定的边界条件 $\\psi^{\\mathrm{id}}(0)=1$ 和 $\\psi^{\\mathrm{id}}\\!\\left(\\frac{1}{2}\\right)=0$ 来确定这些常数。\n在 $x=0$ 处应用第一个边界条件：\n$$\n\\psi^{\\mathrm{id}}(0) = c_1(0) + c_2 = 1 \\implies c_2 = 1.\n$$\n在 $x=\\frac{1}{2}$ 处应用第二个边界条件：\n$$\n\\psi^{\\mathrm{id}}\\!\\left(\\frac{1}{2}\\right) = c_1\\left(\\frac{1}{2}\\right) + 1 = 0 \\implies \\frac{c_1}{2} = -1 \\implies c_1 = -2.\n$$\n因此，在 $K$ 上的理想基函数是 $\\psi^{\\mathrm{id}}(x) = -2x + 1$。梯度在该区间上是常数：\n$$\n\\psi^{\\mathrm{id}\\,'}(x) = -2 \\quad \\text{for } x \\in K.\n$$\n\n接下来，我们求解在过采样区域 $U_K = \\left(0, \\frac{1}{2}+\\delta\\right)$ 上的过采样基函数 $\\psi^{\\mathrm{os}}(x)$。\n控制方程为\n$$\n-(A(x)\\,\\psi^{\\mathrm{os}\\,'}(x))' = 0 \\quad \\text{on } U_K.\n$$\n该方程意味着通量 $J(x) = -A(x)\\,\\psi^{\\mathrm{os}\\,'}(x)$ 在整个域 $U_K$ 上是恒定的。我们用 $J_0$ 表示这个常数通量。\n$$\n-A(x)\\,\\psi^{\\mathrm{os}\\,'}(x) = J_0.\n$$\n这给出了梯度的表达式：\n$$\n\\psi^{\\mathrm{os}\\,'}(x) = -\\frac{J_0}{A(x)}.\n$$\n函数 $\\psi^{\\mathrm{os}}(x)$ 可以通过将其梯度从 $0$ 积分到 $x$ 并使用边界条件 $\\psi^{\\mathrm{os}}(0)=1$ 来找到：\n$$\n\\psi^{\\mathrm{os}}(x) = \\psi^{\\mathrm{os}}(0) + \\int_0^x \\psi^{\\mathrm{os}\\,'}(s)\\,ds = 1 - \\int_0^x \\frac{J_0}{A(s)}\\,ds.\n$$\n为了求出常数 $J_0$，我们应用第二个边界条件 $\\psi^{\\mathrm{os}}\\!\\left(\\frac{1}{2}+\\delta\\right)=0$：\n$$\n\\psi^{\\mathrm{os}}\\!\\left(\\frac{1}{2}+\\delta\\right) = 1 - J_0 \\int_0^{\\frac{1}{2}+\\delta} \\frac{1}{A(s)}\\,ds = 0.\n$$\n由此可见，$J_0$ 是该域总阻力的倒数：\n$$\nJ_0 = \\left( \\int_0^{\\frac{1}{2}+\\delta} \\frac{1}{A(s)}\\,ds \\right)^{-1}.\n$$\n我们通过在不连续点 $x=\\frac{1}{2}$ 处拆分积分来计算它：\n$$\n\\int_0^{\\frac{1}{2}+\\delta} \\frac{1}{A(s)}\\,ds = \\int_0^{\\frac{1}{2}} \\frac{1}{A(s)}\\,ds + \\int_{\\frac{1}{2}}^{\\frac{1}{2}+\\delta} \\frac{1}{A(s)}\\,ds.\n$$\n使用 $A(x)$ 的分段定义：当 $x \\in (0, \\frac{1}{2})$ 时 $A(x)=1$，当 $x \\in (\\frac{1}{2}, \\frac{1}{2}+\\delta)$ 时 $A(x)=\\varepsilon$：\n$$\n\\int_0^{\\frac{1}{2}+\\delta} \\frac{1}{A(s)}\\,ds = \\int_0^{\\frac{1}{2}} \\frac{1}{1}\\,ds + \\int_{\\frac{1}{2}}^{\\frac{1}{2}+\\delta} \\frac{1}{\\varepsilon}\\,ds = \\left[s\\right]_0^{\\frac{1}{2}} + \\frac{1}{\\varepsilon}\\left[s\\right]_{\\frac{1}{2}}^{\\frac{1}{2}+\\delta} = \\frac{1}{2} + \\frac{1}{\\varepsilon}\\left(\\left(\\frac{1}{2}+\\delta\\right)-\\frac{1}{2}\\right) = \\frac{1}{2} + \\frac{\\delta}{\\varepsilon}.\n$$\n合并各项得到总阻力：$\\frac{\\varepsilon + 2\\delta}{2\\varepsilon}$。\n现在我们可以求出 $J_0$：\n$$\nJ_0 = \\left(\\frac{\\varepsilon + 2\\delta}{2\\varepsilon}\\right)^{-1} = \\frac{2\\varepsilon}{\\varepsilon + 2\\delta}.\n$$\n问题要求的是当 $x \\in K=\\left(0,\\frac{1}{2}\\right)$ 时的梯度 $\\psi^{\\mathrm{os}\\,'}(x)$。在此区间内，$A(x)=1$。因此，梯度为：\n$$\n\\psi^{\\mathrm{os}\\,'}(x) = -\\frac{J_0}{A(x)} = -\\frac{J_0}{1} = -J_0 = -\\frac{2\\varepsilon}{\\varepsilon + 2\\delta}.\n$$\n\n最后，我们计算比率 $E(\\varepsilon, \\delta)$：\n$$\nE(\\varepsilon, \\delta) = \\frac{\\psi^{\\mathrm{os}\\,'}(x)}{\\psi^{\\mathrm{id}\\,'}(x)} \\quad \\text{for } x \\in K.\n$$\n由于两个梯度在 $K$ 上都是常数，我们可以代入它们推导出的值：\n$$\nE(\\varepsilon, \\delta) = \\frac{-\\frac{2\\varepsilon}{\\varepsilon + 2\\delta}}{-2} = \\frac{1}{2} \\cdot \\frac{2\\varepsilon}{\\varepsilon + 2\\delta} = \\frac{\\varepsilon}{\\varepsilon + 2\\delta}.\n$$\n为了保持标准的代数形式，我们将分母写为 $2\\delta + \\varepsilon$。\n$$\nE(\\varepsilon, \\delta) = \\frac{\\varepsilon}{2\\delta + \\varepsilon}.\n$$\n该表达式量化了由于在 $x=1/2$ 处的材料不连续性引起的边界层效应，导致多尺度基函数在单元 $K$ 上的梯度误差，而这种误差未被朴素的过采样和限制过程完全捕捉和移除。",
            "answer": "$$\\boxed{\\frac{\\varepsilon}{2\\delta + \\varepsilon}}$$"
        },
        {
            "introduction": "了解了边界层如何引入误差后，我们现在转向一个实践性的计算演示，展示过采样如何在混合多尺度有限元方法（Mixed MsFEM）框架中有效解决这个问题。此练习模拟流体通过层状介质的流动，这是一个经典的多尺度问题，您将实现一个简化的混合MsFEM，其中有效传导率在局部区域上计算。通过比较最小区域（无过采样）和扩大的过采样区域的结果，您将亲身体验过采样方法的实现，并直接观察其强大的稳定效果()。",
            "id": "3790689",
            "problem": "您的任务是在多尺度有限元方法（MsFEM）的背景下，特别是其混合公式（Mixed MsFEM），构建并分析一个一维分层介质，以展示过采样如何减少跨层压力近似中的伪振荡。物理设置为坐标 $x \\in [0,1]$ 的无量纲一维域。稳定达西流的控制方程是本构关系 $u(x) = -k(x) \\,\\dfrac{dp}{dx}$ 和质量守恒 $\\dfrac{d u}{dx} = f(x)$，其中 $u(x)$ 是体积通量，$k(x)$ 是非均质渗透率，$p(x)$ 是压力，$f(x)$ 是源项。在本问题中，取 $f(x) = 0$ 并施加无量纲的狄利克雷边界条件 $p(0) = 1$ 和 $p(1) = 0$。\n\n从这些基本定律和混合 MsFEM 过采样的定义（该方法在扩大的片区上构建多尺度速度基函数，以减轻粗网格划分与细尺度非均质性之间的共振）出发，设计一个可计算的代理模型，该模型保留了一维情况下基于片区的升尺度原理。具体来说，将域离散为 $N_f$ 个长度均匀的细网格单元 $\\Delta x_f = \\dfrac{1}{N_f}$，并将其粗划分为 $N_c$ 个长度均匀的粗网格单元 $H = \\dfrac{1}{N_c}$。通过交替排列渗透率为 $k_{\\mathrm{low}}$ 和 $k_{\\mathrm{high}}$ 的细网格单元块来定义分层介质，每个块的宽度为 $n_{\\mathrm{per}}$ 个细网格单元。交替持续进行，直到填满 $N_f$ 个细网格单元。\n\n为在一维中模拟混合过采样，将每个粗网格界面（粗网格单元 $i$ 和 $i+1$ 之间）与一个过采样片区关联，该片区由粗网格索引区间 $[a,b]$ 组成，其中 $a = \\max(0,i-m)$ 且 $b = \\min(N_c-1,i+1+m)$，过采样大小为 $m \\in \\mathbb{N}$。在该片区上，通过从达西定律和通量守恒推导出的串联电阻定律来定义有效渗透率：\n$$\nk_{\\mathrm{eff}}(i+\\tfrac{1}{2};m) \\;=\\; \\frac{L_{\\mathrm{patch}}}{\\sum_{j \\in \\mathcal{J}(a,b)} \\frac{\\Delta x_f}{k_j}},\n$$\n其中 $L_{\\mathrm{patch}} = (b-a+1)\\,H$ 是片区的物理长度，$\\mathcal{J}(a,b)$ 是该片区覆盖的细网格单元索引集合，$k_j$ 是细网格单元 $j$ 上的渗透率。界面处的粗网格传导率则定义为\n$$\nT_{i+\\tfrac{1}{2}}(m) \\;=\\; \\frac{k_{\\mathrm{eff}}(i+\\tfrac{1}{2};m)}{H}.\n$$\n对于非过采样情况，设置 $m = 0$。对于过采样情况，将 $m$ 设置为指定的正整数。为粗网格单元中心的压力未知数 $\\{p_i\\}_{i=0}^{N_c-1}$ 组装粗网格两点通量系统，其中 $p_0 = 1$ 且 $p_{N_c-1} = 0$，并且对于 $i = 1,\\dots,N_c-2$，\n$$\nT_{i+\\tfrac{1}{2}}(m) \\big( p_i - p_{i+1} \\big) + T_{i-\\tfrac{1}{2}}(m) \\big( p_i - p_{i-1} \\big) \\;=\\; 0.\n$$\n求解该系统两次：一次使用 $m=0$（无过采样）以获得 $p^{(0)}$，另一次使用指定的过采样大小 $m$ 以获得 $p^{(m)}$。\n\n为了量化粗网格压力中的伪振荡，使用离散二阶差分半范数\n$$\n\\mathcal{O}(p) \\;=\\; \\sum_{i=1}^{N_c-2} \\left| p_{i+1} - 2p_i + p_{i-1} \\right|.\n$$\n由于完全线性的粗网格解会产生 $\\mathcal{O}(p) = 0$，因此引入一个小的正则化常数 $\\delta = 10^{-12}$ 以避免在形成减小因子时出现退化情况。定义振荡减小因子\n$$\nR \\;=\\; \\frac{\\mathcal{O}\\!\\left(p^{(0)}\\right) + \\delta}{\\mathcal{O}\\!\\left(p^{(m)}\\right) + \\delta}.\n$$\n您的程序必须实现此构造并为下面套件中的每个测试用例计算 $R$。在此无量纲公式中没有物理单位，所有答案都必须以无量纲浮点数的形式报告。\n\n实现分层介质并为以下每个测试用例求解减小因子 $R$，这些测试用例旨在覆盖一般情况、对齐层边界情况和极端对比度边缘情况：\n\n- 测试用例 1（一般未对齐分层）：$N_f=120$, $N_c=12$, $n_{\\mathrm{per}}=9$, $k_{\\mathrm{low}}=1$, $k_{\\mathrm{high}}=100$, $m=2$。\n- 测试用例 2（与粗网格对齐的分层）：$N_f=120$, $N_c=12$, $n_{\\mathrm{per}}=10$, $k_{\\mathrm{low}}=1$, $k_{\\mathrm{high}}=100$, $m=2$。\n- 测试用例 3（极端对比度，未对齐分层）：$N_f=140$, $N_c=14$, $n_{\\mathrm{per}}=7$, $k_{\\mathrm{low}}=1$, $k_{\\mathrm{high}}=10^6$, $m=3$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的减小因子列表，例如 $[r_1,r_2,r_3]$，其中每个 $r_i$ 是对应测试用例计算出的浮点数。",
            "solution": "该问题基于一维零源稳定达西流，其控制关系为 $u(x) = -k(x) \\dfrac{dp}{dx}$ 和 $\\dfrac{d u}{dx} = 0$，在任何具有适定边界条件的连通区间上，这会导致通量恒定。在非均质分层介质中，精确的细尺度解具有分段线性的压力，其斜率由局部渗透率和恒定通量决定。对于串联的一系列层，一维经典均匀化给出了区间 $I$ 上的有效渗透率：\n$$\nk_{\\mathrm{eff}}(I) \\;=\\; \\frac{|I|}{\\int_I \\dfrac{1}{k(x)} \\, dx},\n$$\n这是连续形式下的调和平均值。这个结果源于串联电阻定律：对于在长度为 $\\Delta x_f$ 的细网格单元上为分段常数的 $k(x)$，单元 $j$ 的电阻为 $R_j = \\dfrac{\\Delta x_f}{k_j}$，因此在 $I$ 上的总电阻为 $R_I = \\sum_j R_j$，单位压降下的通量由 $q = \\dfrac{1}{R_I}$ 给出，因此 $k_{\\mathrm{eff}} = \\dfrac{|I|}{R_I}$。\n\n混合多尺度有限元方法（Mixed MsFEM）构建了满足 $u = -k \\nabla p$ 和 $\\nabla \\cdot u = 0$ 的多尺度速度基函数，并将它们与粗网格压力空间（通常是分段常数或低阶多项式）耦合。一个核心问题是共振误差：当粗网格单元与细尺度非均质性未对齐时，在最小局部单元上计算的基函数会印上局部求解中使用的人为边界条件，从而向粗网格压力解中注入伪振荡。混合过采样通过在扩大的片区上求解局部基问题来缓解此问题，使得人为边界效应在过采样内部区域内衰减，然后将基函数限制在该区域内。\n\n在一维中，我们可以通过一个基于第一性原理推导的、以传导率为基础的代理模型来捕捉混合过采样的精髓。对于单元 $i$ 和 $i+1$ 之间的粗网格界面，我们定义一个由粗网格单元组成的过采样片区 $[a,b]$，其中 $a = \\max(0,i-m)$ 且 $b = \\min(N_c-1,i+1+m)$。在该片区上，我们应用串联定律来计算 $k_{\\mathrm{eff}}(i+\\tfrac{1}{2};m) = \\dfrac{L_{\\mathrm{patch}}}{\\sum_{j \\in \\mathcal{J}(a,b)} \\frac{\\Delta x_f}{k_j}}$，其中 $L_{\\mathrm{patch}} = (b-a+1)H$ 且 $\\mathcal{J}(a,b)$ 是属于粗网格单元 $a$ 到 $b$ 并集的细网格单元索引集合。界面处的传导率，它将通量与该界面上的压降联系起来，然后设置为\n$$\nT_{i+\\tfrac{1}{2}}(m) \\;=\\; \\frac{k_{\\mathrm{eff}}(i+\\tfrac{1}{2};m)}{H}.\n$$\n这种缩放与一维中的两点通量离散化是一致的：如果一个长度为 $H$ 的段具有有效渗透率 $\\kappa$，那么在跨越 $H$ 的压降 $\\Delta p$ 下，通量为 $q = \\kappa \\dfrac{\\Delta p}{H}$，从而得到 $T = \\dfrac{\\kappa}{H}$。\n\n定义了 $T_{i+\\tfrac{1}{2}}(m)$ 后，内部单元的粗网格压力方程为\n$$\nT_{i+\\tfrac{1}{2}}(m)\\,(p_i - p_{i+1}) + T_{i-\\tfrac{1}{2}}(m)\\,(p_i - p_{i-1}) \\;=\\; 0,\\quad i = 1,\\dots,N_c-2,\n$$\n边界条件为狄利克雷边界 $p_0 = 1$ 和 $p_{N_c-1} = 0$。这是一个三对角线性系统。当 $m=0$ 时求解得到 $p^{(0)}$，当 $m$ 为指定值时求解得到 $p^{(m)}$。\n\n为了测量伪振荡，我们使用离散二阶差分半范数\n$$\n\\mathcal{O}(p) \\;=\\; \\sum_{i=1}^{N_c-2} \\left| p_{i+1} - 2p_i + p_{i-1} \\right|.\n$$\n对于完全线性的压力序列，二阶差分为零，因此 $\\mathcal{O}(p) = 0$。在实践中，粗网格界面与细尺度层之间的未对齐会在局部传导率中产生交替变化，导致 $p$ 偏离线性，且 $\\mathcal{O}(p)$ 严格为正。为了在过采样实现近乎完美线性的情况下避免除以零，我们引入一个小的正则化常数 $\\delta = 10^{-12}$ 并将减小因子定义为\n$$\nR \\;=\\; \\frac{\\mathcal{O}\\!\\left(p^{(0)}\\right) + \\delta}{\\mathcal{O}\\!\\left(p^{(m)}\\right) + \\delta}.\n$$\n当 $R > 1$ 时，表明相对于非过采样情况，过采样减少了振荡。测试套件中分层介质和粗/细网格的选择旨在展示三种行为：一般的未对齐情景（存在共振且过采样有帮助），对齐的情景（共振被最小化且过采样几乎没有改善），以及极端对比度、未对齐的情景（过采样产生显著的减小效果）。\n\n实现基于原理推导的算法步骤：\n- 定义 $N_f$、$N_c$、$n_{\\mathrm{per}}$、$k_{\\mathrm{low}}$、$k_{\\mathrm{high}}$ 和 $m$。\n- 通过交替排列长度为 $n_{\\mathrm{per}}$、值为 $k_{\\mathrm{low}}$ 和 $k_{\\mathrm{high}}$ 的块来构建细尺度渗透率数组 $\\{k_j\\}_{j=0}^{N_f-1}$，直到填满 $N_f$ 个单元。\n- 对于 $m=0$ 和给定的 $m$，通过过采样片区公式计算传导率 $\\{T_{i+\\tfrac{1}{2}}(m)\\}_{i=0}^{N_c-2}$。\n- 在 $p_0 = 1$ 和 $p_{N_c-1} = 0$ 的条件下，为 $p^{(0)}$ 和 $p^{(m)}$ 组装并求解三对角粗网格系统。\n- 计算 $\\mathcal{O}\\!\\left(p^{(0)}\\right)$ 和 $\\mathcal{O}\\!\\left(p^{(m)}\\right)$，然后使用正则化比率计算 $R$。\n- 对每个测试用例重复以上步骤，并输出列表 $[R_1, R_2, R_3]$。\n\n该方法遵循达西流和质量守恒的基本定律，对串联介质使用经过充分检验的调和平均法，并通过扩大计算局部有效属性的片区来捕捉一维混合过采样的精髓。扩大的片区抑制了人为边界效应，否则这些效应会导致振荡的传导率系数，进而导致振荡的粗网格压力，从而证明了过采样能够减少伪振荡。",
            "answer": "```python\n# Python 3.12 code using numpy 1.23.5, no external files or input.\nimport numpy as np\n\ndef build_layered_k(Nf, n_per, k_low, k_high):\n    \"\"\"\n    Build a fine-scale permeability array of length Nf by alternating blocks:\n    n_per cells of k_low, then n_per cells of k_high, repeating until filled.\n    \"\"\"\n    k = np.empty(Nf, dtype=float)\n    vals = [k_low] * n_per + [k_high] * n_per\n    idx = 0\n    vlen = len(vals)\n    for j in range(Nf):\n        k[j] = vals[idx]\n        idx += 1\n        if idx == vlen:\n            idx = 0\n    return k\n\ndef transmissibilities(k, Nf, Nc, m):\n    \"\"\"\n    Compute coarse-edge transmissibilities T_{i+1/2}(m) for i=0..Nc-2\n    using oversampled patches defined on coarse cells.\n\n    - Fine cell length: dx_f = 1.0 / Nf\n    - Coarse cell length: H = 1.0 / Nc\n    - Each coarse cell contains F = Nf // Nc fine cells (assumed integer).\n    \"\"\"\n    F = Nf // Nc\n    dx_f = 1.0 / Nf\n    H = 1.0 / Nc\n    T = np.empty(Nc - 1, dtype=float)\n\n    # Precompute cumulative sums of (dx_f / k_j) for fast patch resistance queries.\n    resist = dx_f / k\n    cumR = np.zeros(Nf + 1, dtype=float)\n    cumR[1:] = np.cumsum(resist)\n\n    for i in range(Nc - 1):\n        a = max(0, i - m)\n        b = min(Nc - 1, i + 1 + m)\n        # Fine index range for coarse cells [a..b]: j in [a*F .. (b+1)*F - 1]\n        j_start = a * F\n        j_end = (b + 1) * F  # exclusive\n        # Patch length\n        L_patch = (b - a + 1) * H\n        # Patch resistance: sum_{j=j_start}^{j_end-1} dx_f / k_j\n        R_patch = cumR[j_end] - cumR[j_start]\n        k_eff_patch = L_patch / R_patch\n        T[i] = k_eff_patch / H\n    return T\n\ndef solve_coarse_pressure(T, Nc):\n    \"\"\"\n    Solve the coarse pressure system with Dirichlet boundary conditions:\n    p0 = 1.0, p_{Nc-1} = 0.0\n\n    Interior equations for i=1..Nc-2:\n        T_{i+1/2}(p_i - p_{i+1}) + T_{i-1/2}(p_i - p_{i-1}) = 0\n    \"\"\"\n    n = Nc - 2\n    if n == 0:\n        # Trivial case with only boundaries\n        return np.array([1.0] + [0.0]*(Nc-1), dtype=float)\n\n    A = np.zeros((n, n), dtype=float)\n    b = np.zeros(n, dtype=float)\n    # Indices:\n    # Interior unknowns are p[1]..p[Nc-2], map to rows 0..n-1\n    for row in range(n):\n        i = row + 1  # actual coarse index\n        T_left = T[i - 1]        # T_{i-1/2}\n        T_right = T[i] if i  Nc - 1 else 0.0  # T_{i+1/2}, valid for i=Nc-2\n\n        # Diagonal\n        A[row, row] = T_left + T_right\n\n        # Left neighbor (i-1): could be boundary at i=1\n        if i - 1 == 0:\n            b[row] += T_left * 1.0  # p0 = 1.0\n        else:\n            A[row, row - 1] = -T_left\n\n        # Right neighbor (i+1): could be boundary at i=Nc-2\n        if i + 1 == Nc - 1:\n            # p_{Nc-1} = 0.0, contributes nothing to b\n            pass\n        else:\n            A[row, row + 1] = -T_right\n\n    p_interior = np.linalg.solve(A, b)\n    p = np.zeros(Nc, dtype=float)\n    p[0] = 1.0\n    p[-1] = 0.0\n    p[1:Nc-1] = p_interior\n    return p\n\ndef oscillation_metric(p):\n    \"\"\"\n    Compute discrete second-difference seminorm:\n        O(p) = sum_{i=1}^{Nc-2} |p_{i+1} - 2 p_i + p_{i-1}|\n    \"\"\"\n    # Requires Nc >= 3\n    if p.size  3:\n        return 0.0\n    second_diff = p[2:] - 2.0 * p[1:-1] + p[:-2]\n    return np.sum(np.abs(second_diff))\n\ndef run_case(Nf, Nc, n_per, k_low, k_high, m):\n    k = build_layered_k(Nf, n_per, k_low, k_high)\n    # No oversampling\n    T0 = transmissibilities(k, Nf, Nc, m=0)\n    p0 = solve_coarse_pressure(T0, Nc)\n    O0 = oscillation_metric(p0)\n    # Oversampling\n    Tm = transmissibilities(k, Nf, Nc, m=m)\n    pm = solve_coarse_pressure(Tm, Nc)\n    Om = oscillation_metric(pm)\n    delta = 1e-12\n    R = (O0 + delta) / (Om + delta)\n    return R\n\ndef solve():\n    test_cases = [\n        # Test case 1: Nf=120, Nc=12, n_per=9, k_low=1, k_high=100, m=2\n        (120, 12, 9, 1.0, 100.0, 2),\n        # Test case 2: Nf=120, Nc=12, n_per=10, k_low=1, k_high=100, m=2\n        (120, 12, 10, 1.0, 100.0, 2),\n        # Test case 3: Nf=140, Nc=14, n_per=7, k_low=1, k_high=1e6, m=3\n        (140, 14, 7, 1.0, 1e6, 3),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nf, Nc, n_per, k_low, k_high, m = case\n        result = run_case(Nf, Nc, n_per, k_low, k_high, m)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "我们已经证实了过采样的有效性，但它也带来了计算成本。因此，一个自然的问题是如何优化选择过采样的大小。本练习旨在探讨过采样过程的计算成本与模型误差减少之间的根本权衡。您将使用公认的渐近标度律，这些定律描述了成本如何随过采样半径 $\\delta$ 增加，而误差如何呈指数级衰减。通过推导在给定目标精度下最小化计算量的最优过采样半径 $\\delta(H)$，您将参与到支撑高效多尺度方法实际应用与设计的核心理论分析中()。",
            "id": "3790708",
            "problem": "考虑一个在有界 Lipschitz 域 $\\Omega \\subset \\mathbb{R}^{d}$（其中 $d \\in \\{2,3\\}$）上定义的标量、二阶、线性椭圆边值问题，\n$$\n-\\nabla \\cdot \\big(a\\big(\\tfrac{x}{\\varepsilon}\\big)\\nabla u(x)\\big) = f(x)\\quad \\text{in }\\Omega,\\qquad u=0\\quad \\text{on }\\partial\\Omega,\n$$\n其中 $\\varepsilon  0$ 是一个小的微尺度参数，$a(y)$ 是一个一致椭圆、有界、可测的张量，对于某些常数 $0  \\lambda \\le \\Lambda  \\infty$ 以及所有 $\\xi\\in\\mathbb{R}^{d}$ 和 $y\\in\\mathbb{R}^{d}$，满足 $\\lambda |\\xi|^{2} \\le \\xi^{\\top} a(y)\\,\\xi \\le \\Lambda |\\xi|^{2}$。在多尺度有限元方法 (MsFEM) 中，令 $H0$ 表示粗网格尺寸，$\\delta \\ge H$ 表示用于在扩大的片区上构建局部基函数的过采样半径。在 MsFEM 过采样文献中，一个经过充分检验的事实是：\n- 构建所有局部过采样基函数的计算成本的标度关系为 $O\\big(H^{-d}(\\delta/H)^{d}\\big)$。\n- 全局能量范数离散误差可以被界定为 $O\\big(H+\\exp(-c\\,\\delta/\\varepsilon)\\big)$，其中常数 $c0$ 与 $H$、$\\delta$ 和 $\\varepsilon$ 无关。\n\n假设您的目标是达到一个由粗网格贡献渐近主导的总体精度，因此要求边界层项不超过粗网格误差的一个固定比例，即 $\\exp(-c\\,\\delta/\\varepsilon)\\le K\\,H$，其中固定常数 $K\\in(0,1]$ 与 $H$、$\\delta$ 和 $\\varepsilon$ 无关。在所有满足此渐近精度要求的函数 $\\delta(H)$ 中，请利用成本关于 $\\delta$ 的单调性，提出一个能够渐近最小化所述计算成本标度关系的 $\\delta(H)$ 选择。请用 $H$、$\\varepsilon$、$c$ 和 $K$ 给出一个 $\\delta(H)$ 的闭式解析表达式作为您的最终答案。不需要进行数值计算，答案中也不涉及单位。",
            "solution": "出发点是在尺度 $\\varepsilon$ 上具有快速振荡系数的强制椭圆模型问题。在多尺度有限元方法 (MsFEM) 中，过采样在比粗单元更大的片区上构建局部基函数，以减轻边界效应。两个被广泛接受且经过充分检验的标度关系决定了设计上的权衡：\n1. 在整个域上组装所有局部过采样基函数的计算成本，其标度关系如下：\n$$\n\\mathcal{C}(H,\\delta)\\sim H^{-d}\\left(\\frac{\\delta}{H}\\right)^{d},\n$$\n因为存在 $O(H^{-d})$ 个粗单元，并且每个在过采样片区内的局部求解，其体积相对于单元体积 $O(H^{d})$ 的标度关系为 $O(\\delta^{d})$。\n2. 能量范数误差（或等价地，一个 $H^{1}$半范数界）的标度关系如下：\n$$\n\\mathcal{E}(H,\\delta)\\sim H+\\exp\\!\\left(-c\\,\\frac{\\delta}{\\varepsilon}\\right),\n$$\n其中第一项 $H$ 是粗网格离散误差，第二项反映了由过采样引起的边界层不匹配的指数衰减。\n\n设计目标是实现由粗网格贡献渐近主导的精度，这由以下要求陈述：\n$$\n\\exp\\!\\left(-c\\,\\frac{\\delta}{\\varepsilon}\\right)\\le K\\,H,\n$$\n对于一个固定的 $K\\in(0,1]$。此约束确保了由过采样引起的边界层项不超过粗网格误差的一个固定比例，从而使得当 $H\\to 0$ 时有 $\\mathcal{E}(H,\\delta)\\sim H$。\n\n考虑到对于固定的 $H$，计算成本 $\\mathcal{C}(H,\\delta)$ 关于 $\\delta$ 是严格递增的（因为 $\\delta/H\\ge 1$ 且指数 $d0$），在该不等式约束下，成本最小化的选择在满足约束的最小 $\\delta$ 处达到，即通过强制该约束取等号：\n$$\n\\exp\\!\\left(-c\\,\\frac{\\delta}{\\varepsilon}\\right)=K\\,H.\n$$\n求解 $\\delta$ 可得\n$$\n-c\\,\\frac{\\delta}{\\varepsilon}=\\ln(K\\,H)\\quad\\Longrightarrow\\quad \\delta(H)=\\frac{\\varepsilon}{c}\\,\\ln\\!\\left(\\frac{1}{K\\,H}\\right).\n$$\n对于所有足够小的 $H$，此表达式为正，因为 $K\\,H\\in(0,1]$，因此 $\\ln\\!\\big(\\frac{1}{K\\,H}\\big)\\ge 0$。只要 $H$ 相对于 $\\varepsilon/c$ 不是指数级小，它对于小的 $H$ 也渐近地满足 $\\delta(H)\\ge H$；更准确地说，如果需要，可以逐案检查 $\\delta(H)\\ge H$ 的要求，但过采样文献通常允许选择 $\\delta$ 为 $H$ 的倍数或更大，并且推导出的 $\\delta(H)$ 随着 $H\\to 0$ 呈对数增长。\n\n将此选择代回误差标度关系可得\n$$\n\\mathcal{E}\\big(H,\\delta(H)\\big)\\sim H+\\exp\\!\\left(-c\\,\\frac{(\\varepsilon/c)\\ln(1/(K\\,H))}{\\varepsilon}\\right)=H+\\exp\\!\\big(-\\ln(1/(K\\,H))\\big)=H+K\\,H\\sim H,\n$$\n这显示了预期的平衡。产生的计算成本标度关系为\n$$\n\\mathcal{C}\\big(H,\\delta(H)\\big)\\sim H^{-d}\\left(\\frac{\\delta(H)}{H}\\right)^{d}\n=H^{-d}\\left(\\frac{1}{H}\\cdot\\frac{\\varepsilon}{c}\\,\\ln\\!\\left(\\frac{1}{K\\,H}\\right)\\right)^{d}\n\\sim \\left(\\frac{\\varepsilon}{c}\\right)^{d} H^{-2d}\\left[\\ln\\!\\left(\\frac{1}{K\\,H}\\right)\\right]^{d},\n$$\n这明确了其中的权衡：实现一个 $\\sim H$ 的误差会产生一个计算成本，该成本的增长速度类似于 $H^{-2d}$，最多相差一个关于 $H$ 的对数因子。因为任何更大的 $\\delta$ 都会严格增加 $\\mathcal{C}(H,\\delta)$，同时误差仍由 $H$ 主导，所以所提出的 $\\delta(H)$ 是最优的（在最小化所述精度约束下的成本的意义上）。\n\n因此，作为 $H$ 的函数，能够最小化成本的过采样半径是\n$$\n\\delta(H)=\\frac{\\varepsilon}{c}\\,\\ln\\!\\left(\\frac{1}{K\\,H}\\right).\n$$",
            "answer": "$$\\boxed{\\frac{\\varepsilon}{c}\\,\\ln\\!\\left(\\frac{1}{K\\,H}\\right)}$$"
        }
    ]
}