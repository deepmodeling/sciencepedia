{
    "hands_on_practices": [
        {
            "introduction": "这项基础练习旨在揭示多尺度有限元方法（MsFEM）的核心思想。通过直接计算和比较标准有限元（FEM）基函数与多尺度基函数产生的刚度矩阵项，我们可以量化升尺度（upscaling）效应。这个练习将清晰地展示多尺度基函数如何将介质的微观非均匀性信息编码到宏观粗网格的有效刚度中 ()。",
            "id": "3746099",
            "problem": "考虑区域 $\\Omega=(0,2)$ 上的一个一维扩散问题，其粗网格包含两个单元，粗网格节点为 $x_0=0$、$x_1=1$ 和 $x_2=2$。设扩散系数 $\\kappa(x)$ 为分段常数，定义为当 $x\\in(0,\\frac{1}{2})\\cup(\\frac{3}{2},2)$ 时 $\\kappa(x)=1$，当 $x\\in(\\frac{1}{2},1)\\cup(1,\\frac{3}{2})$ 时 $\\kappa(x)=100$。假设所有量均为无量纲。\n\n在粗网格上，使用分段线性“帽”状基函数 $\\{\\phi_0,\\phi_1,\\phi_2\\}$ 定义标准有限元法 (FEM)。定义多尺度有限元法 (MsFEM) 如下：在每个粗单元 $\\Omega_e=(x_{e-1},x_e)$ 上，通过求解局部齐次方程 $-(\\kappa(x)\\,\\psi'(x))'=0$ 来构造局部基函数，该方程需满足插值粗网格节点值的狄利克雷边界条件。然后，通过协调方法的标准方式拼接这些局部解，以组装成全局多尺度基函数 $\\{\\Phi_0,\\Phi_1,\\Phi_2\\}$。\n\n对于每种方法，全局刚度矩阵的元素为 $K_{ij}=\\int_{\\Omega}\\kappa(x)\\,\\psi_i'(x)\\,\\psi_j'(x)\\,dx$，其中 $\\{\\psi_i\\}$ 代表相应的全局基 $\\{\\phi_i\\}$ 或 $\\{\\Phi_i\\}$。计算两种方法的组装矩阵，并通过计算比率 $R=\\dfrac{K_{11}^{\\mathrm{MsFEM}}}{K_{11}^{\\mathrm{FEM}}}$ 来量化升尺度效应，其中 $K_{11}$ 是与内部节点 $x_1=1$ 相关的中间对角元素。\n\n请以简化的精确表达式形式给出单个标量比率 $R$。如果选择近似计算，请将答案四舍五入至四位有效数字。",
            "solution": "用户要求计算一个一维扩散问题中，标准有限元法 (FEM) 和多尺度有限元法 (MsFEM) 的刚度矩阵元素之比。\n\n首先，对问题进行验证。\n**第 1 步：提取已知条件**\n- 区域：$\\Omega=(0,2)$。\n- 粗网格节点：$x_0=0$, $x_1=1$, $x_2=2$。\n- 粗单元：$\\Omega_1=(0,1)$, $\\Omega_2=(1,2)$。\n- 扩散系数：当 $x\\in(0,\\frac{1}{2})\\cup(\\frac{3}{2},2)$ 时 $\\kappa(x)=1$，当 $x\\in(\\frac{1}{2},1)\\cup(1,\\frac{3}{2})$ 时 $\\kappa(x)=100$。\n- 标准 FEM 基：粗网格上的分段线性“帽”状函数 $\\{\\phi_0, \\phi_1, \\phi_2\\}$。\n- MsFEM 基的构造：局部基函数是在每个粗单元 $\\Omega_e$ 上求解 $-(\\kappa(x)\\,\\psi'(x))'=0$ 的解，并满足插值粗网格节点值的狄利克雷边界条件。\n- 刚度矩阵定义：$K_{ij}=\\int_{\\Omega}\\kappa(x)\\,\\psi_i'(x)\\,\\psi_j'(x)\\,dx$。\n- 目标量：比率 $R=\\dfrac{K_{11}^{\\mathrm{MsFEM}}}{K_{11}^{\\mathrm{FEM}}}$。\n\n**第 2 步：使用提取的已知条件进行验证**\n- 该问题具有**科学依据**，因为它涉及偏微分方程的数值分析，特别是使用 FEM 和 MsFEM 等成熟方法的扩散方程。\n- 该问题是**适定的**。所有必要信息（区域、网格、系数、基函数定义）都已提供，可以唯一确定刚度矩阵及其比率。\n- 该问题是**客观的**，使用精确的数学定义进行陈述，没有歧义或主观论断。\n- 该问题不违反任何无效标准。它是一个用于说明多尺度方法原理的典型示例。\n\n**第 3 步：结论与行动**\n问题有效。将提供完整解答。\n\n**第 1 部分：标准 FEM 刚度矩阵元素 $K_{11}^{\\mathrm{FEM}}$**\n与内部节点 $x_1=1$ 相关的基函数是标准的分段线性“帽”状函数 $\\phi_1(x)$，定义如下：\n$$\n\\phi_1(x) =\n\\begin{cases}\nx  \\text{, for } x \\in [0, 1] \\\\\n2-x  \\text{, for } x \\in [1, 2] \\\\\n0  \\text{, otherwise}\n\\end{cases}\n$$\n$\\phi_1(x)$ 的导数为：\n$$\n\\phi_1'(x) =\n\\begin{cases}\n1  \\text{, for } x \\in (0, 1) \\\\\n-1  \\text{, for } x \\in (1, 2)\n\\end{cases}\n$$\n刚度矩阵元素 $K_{11}^{\\mathrm{FEM}}$ 定义为 $K_{11}^{\\mathrm{FEM}} = \\int_{\\Omega} \\kappa(x) (\\phi_1'(x))^2 \\, dx$。由于在导数有定义的所有 $x \\in (0, 2)$ 上，都有 $(\\phi_1'(x))^2 = 1$，因此积分变为：\n$$\nK_{11}^{\\mathrm{FEM}} = \\int_{0}^{2} \\kappa(x) \\, dx\n$$\n我们根据 $\\kappa(x)$ 的分段定义，通过分段计算该积分：\n$$\nK_{11}^{\\mathrm{FEM}} = \\int_{0}^{1/2} 1 \\, dx + \\int_{1/2}^{1} 100 \\, dx + \\int_{1}^{3/2} 100 \\, dx + \\int_{3/2}^{2} 1 \\, dx\n$$\n$$\nK_{11}^{\\mathrm{FEM}} = 1 \\cdot \\left(\\frac{1}{2} - 0\\right) + 100 \\cdot \\left(1 - \\frac{1}{2}\\right) + 100 \\cdot \\left(\\frac{3}{2} - 1\\right) + 1 \\cdot \\left(2 - \\frac{3}{2}\\right)\n$$\n$$\nK_{11}^{\\mathrm{FEM}} = \\frac{1}{2} + 100 \\cdot \\frac{1}{2} + 100 \\cdot \\frac{1}{2} + \\frac{1}{2} = \\frac{1}{2} + 50 + 50 + \\frac{1}{2} = 101\n$$\n\n**第 2 部分：MsFEM 基函数 $\\Phi_1(x)$ 和刚度元素 $K_{11}^{\\mathrm{MsFEM}}$**\n多尺度基函数 $\\Phi_1(x)$ 是通过将每个粗单元上的局部解拼接而成的。它必须满足节点值 $\\Phi_1(0)=0$, $\\Phi_1(1)=1$ 和 $\\Phi_1(2)=0$。\n\n在第一个粗单元 $\\Omega_1 = (0, 1)$ 上，局部函数 $\\psi_1(x)$ 求解 $-(\\kappa(x)\\psi_1'(x))'=0$，边界条件为 $\\psi_1(0)=0$ 和 $\\psi_1(1)=1$。\n将微分方程积分一次，得到 $\\kappa(x)\\psi_1'(x) = C_1$，其中 $C_1$ 为某个常数。因此，$\\psi_1'(x) = \\frac{C_1}{\\kappa(x)}$。\n再次从 $0$ 到 $x$ 积分：$\\psi_1(x) - \\psi_1(0) = \\int_0^x \\frac{C_1}{\\kappa(\\xi)} d\\xi$。\n使用 $\\psi_1(0)=0$，我们得到 $\\psi_1(x) = C_1 \\int_0^x \\frac{1}{\\kappa(\\xi)} d\\xi$。\n应用另一个边界条件 $\\psi_1(1)=1$：\n$$\n1 = C_1 \\int_0^1 \\frac{1}{\\kappa(x)} dx\n$$\n积分为：$\\int_0^1 \\frac{1}{\\kappa(x)} dx = \\int_0^{1/2} \\frac{1}{1} dx + \\int_{1/2}^1 \\frac{1}{100} dx = \\frac{1}{2} + \\frac{1}{200} = \\frac{101}{200}$。\n所以，$1 = C_1 \\frac{101}{200}$，这意味着 $C_1 = \\frac{200}{101}$。\n在 $\\Omega_1$ 上的导数为 $\\Phi_1'(x) = \\psi_1'(x) = \\frac{200}{101 \\kappa(x)}$，其中 $x \\in (0, 1)$。\n\n在第二个粗单元 $\\Omega_2 = (1, 2)$ 上，局部函数 $\\psi_2(x)$ 求解 $-(\\kappa(x)\\psi_2'(x))'=0$，边界条件为 $\\psi_2(1)=1$ 和 $\\psi_2(2)=0$。\n类似地，$\\kappa(x)\\psi_2'(x) = C_2$，所以 $\\psi_2'(x) = \\frac{C_2}{\\kappa(x)}$。\n从 $1$ 到 $x$ 积分：$\\psi_2(x) - \\psi_2(1) = \\int_1^x \\frac{C_2}{\\kappa(\\xi)} d\\xi$。\n使用 $\\psi_2(1)=1$，我们得到 $\\psi_2(x) = 1 + C_2 \\int_1^x \\frac{1}{\\kappa(\\xi)} d\\xi$。\n应用 $\\psi_2(2)=0$：$0 = 1 + C_2 \\int_1^2 \\frac{1}{\\kappa(x)} dx$。\n积分为 $\\int_1^2 \\frac{1}{\\kappa(x)} dx = \\int_1^{3/2} \\frac{1}{100} dx + \\int_{3/2}^2 \\frac{1}{1} dx = \\frac{1}{200} + \\frac{1}{2} = \\frac{101}{200}$。\n所以，$0 = 1 + C_2 \\frac{101}{200}$，这意味着 $C_2 = -\\frac{200}{101}$。\n在 $\\Omega_2$ 上的导数为 $\\Phi_1'(x) = \\psi_2'(x) = -\\frac{200}{101 \\kappa(x)}$，其中 $x \\in (1, 2)$。\n\n现在我们计算刚度元素 $K_{11}^{\\mathrm{MsFEM}}$：\n$$\nK_{11}^{\\mathrm{MsFEM}} = \\int_{0}^{2} \\kappa(x) (\\Phi_1'(x))^2 \\, dx = \\int_{0}^{1} \\kappa(x) (\\Phi_1'(x))^2 \\, dx + \\int_{1}^{2} \\kappa(x) (\\Phi_1'(x))^2 \\, dx\n$$\n对于 $\\Omega_1$ 上的第一个积分：\n$$\n\\int_{0}^{1} \\kappa(x) \\left(\\frac{200}{101 \\kappa(x)}\\right)^2 dx = \\left(\\frac{200}{101}\\right)^2 \\int_{0}^{1} \\frac{1}{\\kappa(x)} dx = \\left(\\frac{200}{101}\\right)^2 \\left(\\frac{101}{200}\\right) = \\frac{200}{101}\n$$\n对于 $\\Omega_2$ 上的第二个积分：\n$$\n\\int_{1}^{2} \\kappa(x) \\left(-\\frac{200}{101 \\kappa(x)}\\right)^2 dx = \\left(\\frac{200}{101}\\right)^2 \\int_{1}^{2} \\frac{1}{\\kappa(x)} dx = \\left(\\frac{200}{101}\\right)^2 \\left(\\frac{101}{200}\\right) = \\frac{200}{101}\n$$\n将两部分的贡献相加：\n$$\nK_{11}^{\\mathrm{MsFEM}} = \\frac{200}{101} + \\frac{200}{101} = \\frac{400}{101}\n$$\n\n**第 3 部分：比率 R**\n最后，我们计算比率 $R$：\n$$\nR = \\frac{K_{11}^{\\mathrm{MsFEM}}}{K_{11}^{\\mathrm{FEM}}} = \\frac{400/101}{101} = \\frac{400}{101^2}\n$$\n计算 $101^2$：\n$$\n101^2 = (100 + 1)^2 = 100^2 + 2 \\cdot 100 \\cdot 1 + 1^2 = 10000 + 200 + 1 = 10201\n$$\n所以，精确比率为：\n$$\nR = \\frac{400}{10201}\n$$\n该分数为不可约分数，因为 $400 = 2^4 \\cdot 5^2$ 且 $101$ 是一个素数。",
            "answer": "$$\\boxed{\\frac{400}{10201}}$$"
        },
        {
            "introduction": "在理解了多尺度方法如何改变有效刚度之后，本练习将量化这种改变带来的实际优势。我们将通过计算一个高对比度问题的精确解，并将其与标准有限元和多尺度有限元得到的数值解进行比较，来评估两种方法的能量范数误差。这个对比将有力地证明，当粗网格无法分辨介质的细微变化时，为何多尺度基函数能够提供远超标准方法的计算精度 ()。",
            "id": "3746076",
            "problem": "考虑一维二阶线性椭圆边值问题\n$$\n-(\\kappa(x)\\,u'(x))' = f(x), \\quad x \\in (0,1), \\quad u(0)=0, \\quad u(1)=0,\n$$\n其中系数是具有高对比度分界面的分段常数，\n$$\n\\kappa(x)=\\begin{cases}\n1,  x\\in(0,1/2),\\\\\n\\epsilon,  x\\in(1/2,1),\n\\end{cases}\n$$\n且源项为常数，$f(x)=1$。目标是在一个与分界面不对齐的固定粗网格上，量化两种粗尺度近似的误差：\n- 标准的分段线性有限元法（FEM）基函数，以及\n- 通过局部单元求解构建的多尺度有限元法（MsFEM）谐波基函数。\n\n使用粗网格节点 $x_0=0$，$x_1=0.6$ 和 $x_2=1$，因此粗单元为 $(0,0.6)$ 和 $(0.6,1)$，而系数分界面位于第一个粗单元内的 $x_i=0.5$ 处。设唯一的内部粗自由度与节点 $x_1=0.6$ 相关联。\n\n通过在每个粗单元上进行线性插值，定义与 $x_1$ 相关联的标准有限元法（FEM）帽子基函数 $\\varphi(x)$：\n$$\n\\varphi(x)=\\begin{cases}\n\\frac{x-0}{0.6-0},  x\\in[0,0.6],\\\\\n\\frac{1-x}{1-0.6},  x\\in[0.6,1],\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\n使得 $\\varphi(0)=0$，$\\varphi(0.6)=1$ 和 $\\varphi(1)=0$。\n\n通过在每个粗单元 $K$ 上求解以下方程来定义与 $x_1$ 相关联的多尺度有限元法（MsFEM）谐波基函数 $\\psi(x)$，\n$$\n-(\\kappa(x)\\,\\psi_K'(x))'=0\\quad \\text{for }x\\in K,\n$$\n其狄利克雷（Dirichlet）边界条件等于 $K$ 端点处的粗网格节点值。具体来说：\n- 在 $(0,0.6)$ 上，施加 $\\psi(0)=0$ 和 $\\psi(0.6)=1$，同时在 $x=0.5$ 处强制 $\\psi$ 和通量 $\\kappa(x)\\psi'(x)$ 的连续性。\n- 在 $(0.6,1)$ 上，施加 $\\psi(0.6)=1$ 和 $\\psi(1)=0$。\n\n对于每个基 $\\phi\\in\\{\\varphi,\\psi\\}$，构建由 $\\phi$ 张成的一维伽辽金（Galerkin）近似空间，因此粗尺度解的形式为 $u_h(x)=c\\,\\phi(x)$，其中 $c$ 由单自由度伽辽金方程确定\n$$\na\\,c=b,\\quad a=\\int_0^1 \\kappa(x)\\,(\\phi'(x))^2\\,dx,\\quad b=\\int_0^1 f(x)\\,\\phi(x)\\,dx.\n$$\n\n通过求解在 $(0,1/2)$ 和 $(1/2,1)$ 上的分段常微分方程，并在 $x=1/2$ 处满足 $u$ 和通量 $\\kappa(x)u'(x)$ 的连续性，来计算精确解 $u(x)$：\n- 在 $(0,1/2)$ 上，当 $\\kappa(x)=1$ 时，求解 $-u''(x)=1$。\n- 在 $(1/2,1)$ 上，当 $\\kappa(x)=\\epsilon$ 时，求解 $-\\epsilon\\,u''(x)=1$。\n应用边界条件 $u(0)=0$，$u(1)=0$，并施加 $u(1/2^-)=u(1/2^+)$ 以及 $\\kappa(1/2^-)\\,u'(1/2^-)=\\kappa(1/2^+)\\,u'(1/2^+)$ 来确定积分常数。\n\n测量每种近似的能量范数误差，\n$$\n\\mathcal{E}(\\phi;\\epsilon)=\\int_0^1 \\kappa(x)\\,\\big(u'(x)-u_h'(x)\\big)^2\\,dx,\n$$\n其中 $u_h'(x)=c\\,\\phi'(x)$。\n\n实现上述构造，并为以下对比度参数测试集计算能量范数误差：\n- $\\epsilon=1.0$（无对比度），\n- $\\epsilon=10^{-2}$（中等对比度），\n- $\\epsilon=10^{-6}$（高对比度）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下\n$$\n[\\mathcal{E}(\\varphi;1.0),\\ \\mathcal{E}(\\psi;1.0),\\ \\mathcal{E}(\\varphi;10^{-2}),\\ \\mathcal{E}(\\psi;10^{-2}),\\ \\mathcal{E}(\\varphi;10^{-6}),\\ \\mathcal{E}(\\psi;10^{-6})].\n$$\n所有量均为无量纲；不涉及物理单位。不出现角度。所有数值输出均表示为普通十进制浮点数。",
            "solution": "用户提供了一个来自偏微分方程数值分析领域的适定问题。任务是比较标准有限元法（FEM）和多尺度有限元法（MsFEM）对于一个具有高对比度系数的一维椭圆问题的准确性。对问题陈述的验证证实了其科学合理性、一致性和完整性。\n\n求解过程分为四个主要步骤：\n1.  推导精确解 $u(x)$ 的解析形式。\n2.  推导标准有限元法基函数 $\\varphi(x)$ 和多尺度有限元法谐波基函数 $\\psi(x)$ 的解析形式。\n3.  计算两种基函数的伽辽金方法和能量误差公式所需的项。\n4.  对每个基函数和每个指定的对比度参数 $\\epsilon$ 值，计算能量误差的数值。\n\n### 步骤 1：精确解 $u(x)$\n问题是在 $(0,1)$ 上 $-(\\kappa(x)u'(x))' = 1$，且满足 $u(0)=u(1)=0$。\n系数在 $x \\in (0, 1/2)$ 上为 $\\kappa(x)=1$，在 $x \\in (1/2, 1)$ 上为 $\\kappa(x)=\\epsilon$。\n\n在 $(0, 1/2)$ 上，方程为 $-u_1''(x)=1$。通解为 $u_1(x) = -\\frac{1}{2}x^2 + A_1 x + B_1$。边界条件 $u(0)=0$ 意味着 $B_1=0$，因此 $u_1(x) = -\\frac{1}{2}x^2 + A_1 x$。\n\n在 $(1/2, 1)$ 上，方程为 $-\\epsilon u_2''(x)=1$，即 $u_2''(x)=-1/\\epsilon$。通解为 $u_2(x) = -\\frac{1}{2\\epsilon}x^2 + A_2 x + B_2$。边界条件 $u(1)=0$ 意味着 $-\\frac{1}{2\\epsilon} + A_2 + B_2 = 0$，因此 $B_2 = \\frac{1}{2\\epsilon} - A_2$。\n\n在分界面 $x=1/2$ 处，我们强制解的连续性，$u_1(1/2)=u_2(1/2)$，以及通量的连续性，$\\kappa(1/2^-)u_1'(1/2) = \\kappa(1/2^+)u_2'(1/2)$。\n-   $u_1'(x) = -x + A_1$ 且 $u_2'(x) = -x/\\epsilon + A_2$。\n-   $u$ 的连续性：$-\\frac{1}{8} + \\frac{A_1}{2} = -\\frac{1}{8\\epsilon} + \\frac{A_2}{2} + (\\frac{1}{2\\epsilon} - A_2) = \\frac{3}{8\\epsilon} - \\frac{A_2}{2}$。这可以简化为 $A_1+A_2 = \\frac{1}{4} + \\frac{3}{4\\epsilon}$。\n-   通量连续性：$1 \\cdot (-1/2 + A_1) = \\epsilon \\cdot (-1/(2\\epsilon) + A_2)$，这得到 $-1/2 + A_1 = -1/2 + \\epsilon A_2$，因此 $A_1 = \\epsilon A_2$。\n\n求解 $A_1$ 和 $A_2$ 的方程组：\n$(\\epsilon A_2) + A_2 = \\frac{1}{4} + \\frac{3}{4\\epsilon} \\implies A_2(1+\\epsilon) = \\frac{\\epsilon+3}{4\\epsilon}$。\n这给出 $A_2 = \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)}$ 和 $A_1 = \\epsilon A_2 = \\frac{3+\\epsilon}{4(1+\\epsilon)}$。\n\n精确解为：\n$$\nu(x) = \\begin{cases}\n-\\frac{1}{2}x^2 + \\frac{3+\\epsilon}{4(1+\\epsilon)} x,  x \\in [0, 1/2] \\\\\n-\\frac{x^2-1}{2\\epsilon} + \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)}(x-1),  x \\in (1/2, 1]\n\\end{cases}\n$$\n其导数为：\n$$\nu'(x) = \\begin{cases}\n-x + \\frac{3+\\epsilon}{4(1+\\epsilon)},  x \\in (0, 1/2) \\\\\n-\\frac{x}{\\epsilon} + \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)},  x \\in (1/2, 1)\n\\end{cases}\n$$\n\n### 步骤 2：基函数 $\\varphi(x)$ 和 $\\psi(x)$\n给出了标准线性基函数 $\\varphi(x)$。其导数是分段常数：\n$$\n\\varphi'(x) = \\begin{cases}\n1/0.6 = 5/3,  x \\in (0, 0.6) \\\\\n-1/0.4 = -5/2,  x \\in (0.6, 1)\n\\end{cases}\n$$\n\n通过在粗单元 $K_1=(0,0.6)$ 和 $K_2=(0.6,1)$ 上求解 $-(\\kappa \\psi')'=0$ 来找到多尺度有限元法基函数 $\\psi(x)$。\n在 $K_1=(0,0.6)$ 上，满足 $\\psi(0)=0, \\psi(0.6)=1$：\n-   解是分段线性的。设在 $(0,0.5)$ 上 $\\psi(x) = C_1 x + D_1$，在 $(0.5,0.6)$ 上 $\\psi(x) = C_2 x + D_2$。\n-   $\\psi(0)=0 \\implies D_1=0$。\n-   $\\psi(0.6)=1 \\implies 0.6 C_2 + D_2 = 1$。\n-   在 $x=0.5$ 处的连续性：$\\psi(0.5^-)=\\psi(0.5^+) \\implies 0.5 C_1 = 0.5 C_2 + D_2$。\n-   在 $x=0.5$ 处的通量连续性：$1 \\cdot C_1 = \\epsilon \\cdot C_2$。\n-   求解这个线性系统得到 $C_1 = \\frac{10\\epsilon}{1+5\\epsilon}$，$C_2 = \\frac{10}{1+5\\epsilon}$ 和 $D_2 = \\frac{5\\epsilon-5}{1+5\\epsilon}$。\n\n在 $K_2=(0.6,1)$ 上，$\\kappa(x)=\\epsilon$ 是常数。谐波函数只是一个线性插值函数：$\\psi(x) = \\frac{1-x}{1-0.6} = 2.5(1-x)$。\n\n导数 $\\psi'(x)$ 是分段常数：\n$$\n\\psi'(x) = \\begin{cases}\nC_1 = \\frac{10\\epsilon}{1+5\\epsilon},  x \\in (0, 0.5) \\\\\nC_2 = \\frac{10}{1+5\\epsilon},  x \\in (0.5, 0.6) \\\\\nC_3 = -2.5,  x \\in (0.6, 1)\n\\end{cases}\n$$\n\n### 步骤 3：能量误差计算\n能量范数误差由 $\\mathcal{E}(\\phi;\\epsilon) = \\int_0^1 \\kappa(x) (u'(x)-u_h'(x))^2 dx$ 给出。\n对于伽辽金方法，其中 $u_h = c\\,\\phi = (b/a)\\phi$，这可以简化为“最佳逼近”公式：\n$$\n\\mathcal{E}(\\phi;\\epsilon) = \\underbrace{\\int_0^1 \\kappa(x) (u'(x))^2 dx}_{\\text{精确解的能量}} - \\underbrace{\\frac{\\left(\\int_0^1 \\phi(x) dx\\right)^2}{\\int_0^1 \\kappa(x) (\\phi'(x))^2 dx}}_{\\text{近似解的能量}} = a(u,u) - \\frac{b^2}{a}\n$$\n第一项，即精确解的能量，可以计算为 $a(u,u) = \\int_0^1 f(x)u(x)dx = \\int_0^1 u(x)dx$。\n$$\nE_{\\text{exact}} = \\int_0^1 u(x)dx = \\frac{\\epsilon^2+14\\epsilon+1}{96\\epsilon(1+\\epsilon)}\n$$\n我们现在为每个基计算刚度项 $a$ 和载荷项 $b$。\n\n**对于 $\\phi = \\varphi$ (标准有限元法):**\n-   刚度 $a_{\\text{fem}}$：\n    $a_{\\text{fem}} = \\int_0^{0.5} 1 \\cdot (5/3)^2 dx + \\int_{0.5}^{0.6} \\epsilon \\cdot (5/3)^2 dx + \\int_{0.6}^1 \\epsilon \\cdot (-5/2)^2 dx$\n    $a_{\\text{fem}} = \\frac{25}{9}(0.5) + \\epsilon \\frac{25}{9}(0.1) + \\epsilon \\frac{25}{4}(0.4) = \\frac{12.5}{9} + \\frac{2.5\\epsilon}{9} + 2.5\\epsilon = \\frac{25}{18}(1+2\\epsilon)$。\n-   载荷 $b_{\\text{fem}}$：\n    $b_{\\text{fem}} = \\int_0^1 \\varphi(x) dx = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2} \\times (1-0) \\times 1 = 0.5$。\n\n**对于 $\\phi = \\psi$ (多尺度有限元法):**\n-   刚度 $a_{\\text{ms}}$：\n    $a_{\\text{ms}} = \\int_0^{0.5} 1 \\cdot (\\psi')^2 dx + \\int_{0.5}^{0.6} \\epsilon \\cdot (\\psi')^2 dx + \\int_{0.6}^1 \\epsilon \\cdot (\\psi')^2 dx$\n    $a_{\\text{ms}} = 1 \\cdot C_1^2 \\cdot (0.5) + \\epsilon \\cdot C_2^2 \\cdot (0.1) + \\epsilon \\cdot C_3^2 \\cdot (0.4)$\n    $a_{ms} = \\frac{1}{2} (\\frac{10\\epsilon}{1+5\\epsilon})^2 + \\frac{\\epsilon}{10} (\\frac{10}{1+5\\epsilon})^2 + \\frac{2\\epsilon}{5} (-2.5)^2 = \\frac{50\\epsilon^2 + 10\\epsilon}{(1+5\\epsilon)^2} + 2.5\\epsilon = \\frac{10\\epsilon(1+5\\epsilon)}{(1+5\\epsilon)^2} + 2.5\\epsilon = \\frac{10\\epsilon}{1+5\\epsilon} + 2.5\\epsilon$。\n-   载荷 $b_{\\text{ms}}$：\n    $b_{\\text{ms}} = \\int_0^{0.5} \\psi(x)dx + \\int_{0.5}^{0.6} \\psi(x)dx + \\int_{0.6}^1 \\psi(x)dx$\n    对分段线性函数积分后：\n    $b_{\\text{ms}} = \\frac{1.75\\epsilon+0.05}{1+5\\epsilon} + 0.2 = \\frac{2.75\\epsilon+0.25}{1+5\\epsilon}$。\n\n### 步骤 4：数值计算\n对于每个 $\\epsilon \\in \\{1.0, 10^{-2}, 10^{-6}\\}$，我们计算 $\\mathcal{E}(\\varphi;\\epsilon) = E_{\\text{exact}} - b_{\\text{fem}}^2/a_{\\text{fem}}$ 和 $\\mathcal{E}(\\psi;\\epsilon) = E_{\\text{exact}} - b_{\\text{ms}}^2/a_{\\text{ms}}$。下面的实现将执行这些最终计算。当 $\\epsilon=1$ 时，处处 $\\kappa(x)=1$，谐波基 $\\psi(x)$ 与线性基 $\\varphi(x)$ 相同，因此误差也相同。随着 $\\epsilon$ 减小（对比度增加），多尺度有限元法基能更好地捕捉界面附近的解行为，与标准有限元法相比，其误差显著减小。",
            "answer": "[0.0003472222222222194,0.0003472222222222194,0.01072973719183181,0.00010839801968846176,0.011311545138888888,0.00000002083333333333333]"
        },
        {
            "introduction": "构建多尺度基函数时，在局部问题上施加的人为边界条件可能会引入“共振误差”，从而影响解的精度。本练习将探讨一种关键的改进技术——过采样（oversampling），它通过在更大的区域上求解局部问题来有效减轻这种误差。通过这个数值实验，您将量化过采样对基函数能量（以 $H^1$-半范数衡量）的影响，并理解其在提升多尺度方法鲁棒性方面的重要性 ()。",
            "id": "3746089",
            "problem": "考虑带周期性非均匀电导率系数的一维标量椭圆算子。设全局计算域为 $[0,1]$，并固定一个粗元 $K = [x_L,x_R] \\subset [0,1]$。多尺度有限元法 (MsFEM) 的局部多尺度节点基函数定义如下。在 $K$ 上的非过采样左基函数 $\\phi^L$ 求解齐次局部问题\n$$\n-\\frac{d}{dx}\\left(\\kappa(x)\\frac{d\\phi^L}{dx}(x)\\right) = 0 \\quad \\text{in } K,\n$$\n其狄利克雷边界条件为\n$$\n\\phi^L(x_L) = 1, \\quad \\phi^L(x_R) = 0.\n$$\n相应的过采样左基函数 $\\phi_{\\text{os}}^L$ 通过在扩展区间 $K^+ = [x_L - \\delta, x_R + \\delta] \\cap [0,1]$ 上求解相同的齐次局部问题来定义，其狄利克雷边界条件为\n$$\n\\phi_{\\text{os}}^L(x_L - \\delta) = 1, \\quad \\phi_{\\text{os}}^L(x_R + \\delta) = 0,\n$$\n然后将 $\\phi_{\\text{os}}^L$ 限制在 $K$ 上。$K$ 上的 $H^1$-半范数为\n$$\n\\left|\\phi\\right|_{H^1(K)} = \\left(\\int_{x_L}^{x_R}\\left|\\frac{d\\phi}{dx}(x)\\right|^2\\,dx\\right)^{1/2}.\n$$\n您将设计一个使用周期性 $\\kappa(x)$ 的数值实验，以比较 $\\left|\\phi^L\\right|_{H^1(K)}$ 和 $\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}$，并量化它们在 $K$ 上的差异。假设以下基本事实：(i) 局部基满足给定的边值问题；(ii) $\\kappa(x)$ 在 $[0,1]$ 上是严格正且周期性的；(iii) 可以使用数值积分（例如，复合梯形法则）在均匀网格上逼近定积分。\n\n对于每个测试用例，您的程序必须在具有 $N$ 个区间的均匀细网格（网格尺寸 $h=1/N$）上构建相关量，对于给定的整数 $m \\ge 0$ 设置 $\\delta = m h$，并计算差值\n$$\n\\Delta = \\left|\\phi^L\\right|_{H^1(K)} - \\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}\n$$\n仅针对左基函数。本问题不涉及任何物理单位。\n\n使用以下四个测试用例，它们共同构成测试套件，并且必须完全按照规定进行评估：\n\n- 测试用例1（正弦系数，中等对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗元：$K = [0.4,\\,0.6]$\n  - 细网格：$N = 5000$（因此 $h = 1/5000$）\n  - 过采样单元数：$m = 100$（因此 $\\delta = 100 h$）\n  - 周期和参数：$\\epsilon = 0.02$, $k_0 = 2.0$, $k_1 = 1.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例2（正弦系数，与测试用例1相同，但过采样为零）：\n  - 全局域：$[0,1]$\n  - 粗元：$K = [0.4,\\,0.6]$\n  - 细网格：$N = 5000$\n  - 过采样单元数：$m = 0$（因此 $\\delta = 0$）\n  - 周期和参数：$\\epsilon = 0.02$, $k_0 = 2.0$, $k_1 = 1.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例3（正弦系数，高对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗元：$K = [0.25,\\,0.35]$\n  - 细网格：$N = 10000$\n  - 过采样单元数：$m = 50$\n  - 周期和参数：$\\epsilon = 0.01$, $k_0 = 10.0$, $k_1 = 9.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例4（分段常数周期系数，强对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗元：$K = [0.45,\\,0.55]$\n  - 细网格：$N = 6000$\n  - 过采样单元数：$m = 60$\n  - 周期和参数：$\\epsilon = 0.05$, $k_{\\text{high}} = 10.0$, $k_{\\text{low}} = 1.0$\n  - 电导率：当 $x/\\epsilon$ 的小数部分位于 $[0,\\,0.5)$ 时，$\\kappa(x) = k_{\\text{high}}$，否则 $\\kappa(x) = k_{\\text{low}}$，在 $[0,1]$ 上周期性重复\n\n对于每个测试用例，计算 $\\Delta$ 作为一个浮点数。您的程序应生成一行输出，其中包含所有测试用例的结果，格式为方括号内以逗号分隔的列表，并按测试用例1到4的顺序排列（例如，$\\left[\\Delta_1,\\Delta_2,\\Delta_3,\\Delta_4\\right]$）。最终输出必须是实数。程序不应打印任何其他文本。多尺度有限元法（MsFEM）的缩写在此首次出现时已明确定义。",
            "solution": "该问题是有效的。它提出了一个基于多尺度有限元法 (MsFEM) 的既定理论、适定的数学任务。所有必需的数据和定义均已提供，不存在科学或逻辑上的矛盾。我们将进行完整的求解。\n\n问题的核心是求解一个一维、二阶、齐次常微分方程 (ODE)，以找到 MsFEM 基函数，然后计算它们在指定粗元 $K = [x_L, x_R]$ 上的各自的 $H^1$-半范数。\n\n首先，我们求出局部问题的解析解：\n$$\n-\\frac{d}{dx}\\left(\\kappa(x)\\frac{d\\phi}{dx}(x)\\right) = 0\n$$\n其中 $\\kappa(x)$ 是一个严格正的非均匀电导率系数。将此方程对 $x$ 积分一次，得到：\n$$\n\\kappa(x)\\frac{d\\phi}{dx}(x) = -C_1\n$$\n其中 $C_1$ 是一个积分常数。由于 $\\kappa(x) > 0$，我们可以重新整理并求解 $\\phi$ 的导数：\n$$\n\\frac{d\\phi}{dx}(x) = -\\frac{C_1}{\\kappa(x)}\n$$\n从起点 $x_a$ 到变量点 $x$ 再次积分，得到 $\\phi(x)$ 的通解：\n$$\n\\phi(x) - \\phi(x_a) = \\int_{x_a}^{x} \\left(-\\frac{C_1}{\\kappa(t)}\\right) dt = -C_1 \\int_{x_a}^{x} \\frac{dt}{\\kappa(t)}\n$$\n常数 $C_1$ 通过应用狄利克雷边界条件来确定，这些条件在区间 $[x_a, x_b]$ 上指定为 $\\phi(x_a) = y_a$ 和 $\\phi(x_b) = y_b$。设 $x=x_b$，我们得到：\n$$\n\\phi(x_b) - \\phi(x_a) = y_b - y_a = -C_1 \\int_{x_a}^{x_b} \\frac{dt}{\\kappa(t)}\n$$\n求解 $C_1$：\n$$\nC_1 = \\frac{y_a - y_b}{\\int_{x_a}^{x_b} \\frac{dt}{\\kappa(t)}}\n$$\n\n现在，我们将此通用框架应用于所需的两个特定基函数。\n\n**1. 非过采样左基函数, $\\phi^L(x)$**\n此函数定义在粗元 $K=[x_L, x_R]$ 上，边界条件为 $\\phi^L(x_L) = 1$ 和 $\\phi^L(x_R) = 0$。此处，$x_a=x_L, y_a=1$ 以及 $x_b=x_R, y_b=0$。常数 $C_1^L$ 是：\n$$\nC_1^L = \\frac{1 - 0}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} = \\frac{1}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n因此，$\\phi^L(x)$ 的导数为：\n$$\n\\frac{d\\phi^L}{dx}(x) = -\\frac{C_1^L}{\\kappa(x)} = - \\frac{1}{\\kappa(x) \\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n\n**2. 过采样左基函数, $\\phi_{\\text{os}}^L(x)$**\n此函数定义在过采样域 $K^+ = [x_L - \\delta, x_R + \\delta] \\cap [0,1]$ 上。设该有效域的边界为 $x_L' = \\max(x_L - \\delta, 0)$ 和 $x_R' = \\min(x_R + \\delta, 1)$。边界条件为 $\\phi_{\\text{os}}^L(x_L') = 1$ 和 $\\phi_{\\text{os}}^L(x_R') = 0$。\n相应的常数 $C_1^{\\text{os}}$ 是：\n$$\nC_1^{\\text{os}} = \\frac{1 - 0}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} = \\frac{1}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n$\\phi_{\\text{os}}^L(x)$ 在其定义域 $K^+$ 上的导数为：\n$$\n\\frac{d\\phi_{\\text{os}}^L}{dx}(x) = -\\frac{C_1^{\\text{os}}}{\\kappa(x)} = - \\frac{1}{\\kappa(x) \\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n在计算中，我们将此函数及其导数限制在原始粗元 $K=[x_L, x_R]$ 上。\n\n**$H^1$-半范数及其差值 $\\Delta$ 的计算**\n$K$ 上的 $H^1$-半范数由 $|\\phi|_{H^1(K)} = \\left(\\int_{x_L}^{x_R}\\left|\\frac{d\\phi}{dx}(x)\\right|^2\\,dx\\right)^{1/2}$ 给出。\n\n对于非过采样情况，我们将导数平方并在 $K$ 上积分：\n$$\n\\left|\\phi^L\\right|_{H^1(K)}^2 = \\int_{x_L}^{x_R} \\left( - \\frac{1}{\\kappa(x) \\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} \\right)^2 dx = \\frac{\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}}{\\left(\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}\\right)^2}\n$$\n取平方根得到：\n$$\n\\left|\\phi^L\\right|_{H^1(K)} = \\frac{\\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n对于过采样情况，过程是相同的，但导数是使用较大域 $K^+$ 上的积分定义的。半范数仍然在 $K$ 上计算：\n$$\n\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}^2 = \\int_{x_L}^{x_R} \\left( - \\frac{1}{\\kappa(x) \\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} \\right)^2 dx = \\frac{\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}}{\\left(\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}\\right)^2}\n$$\n取平方根得到：\n$$\n\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)} = \\frac{\\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n我们观察到分子项，我们称之为 $J = \\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}$，在两个表达式中是共有的。那么所求的差值 $\\Delta$ 是：\n$$\n\\Delta = \\left|\\phi^L\\right|_{H^1(K)} - \\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)} = J \\left[ \\frac{1}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} - \\frac{1}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} \\right]\n$$\n对于测试用例2，我们有 $m=0$，这意味着 $\\delta=0$。因此，$x_L'=x_L$ 且 $x_R'=x_R$，导致方括号中的两项相同。因此，在这种情况下 $\\Delta=0$，这是符合预期的。\n\n**数值实现策略**\n该问题需要数值求解。策略如下：\n1. 对于每个测试用例，定义参数 $N, m, x_L, x_R$ 以及 $\\kappa(x)$ 的参数。\n2. 为域 $[0,1]$ 构建一个具有 $N+1$ 个点的均匀细网格：$x_i = i h$，其中 $i=0, \\dots, N$ 且 $h=1/N$。\n3. 在每个网格点 $x_i$ 上计算指定的 $\\kappa(x)$，以生成电导率值的数组。\n4. 计算过采样量 $\\delta = m h$ 并确定过采样区间的边界，$x_L' = \\max(x_L - \\delta, 0)$ 和 $x_R' = \\min(x_R + \\delta, 1)$。\n5. 确定与区间边界 $x_L, x_R, x_L'$ 和 $x_R'$ 对应的网格索引。\n6. 使用复合梯形法则（例如由 `numpy.trapz` 实现）计算必要的定积分：$\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}$，$\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}$ 和 $\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}$。\n7. 将这些数值代入 $\\Delta$ 的导出公式以获得最终结果。\n将对所有四个测试用例重复此过程。",
            "answer": "[0.05370216298516086,0.0,0.1444005995806456,0.08990141973030302]"
        }
    ]
}