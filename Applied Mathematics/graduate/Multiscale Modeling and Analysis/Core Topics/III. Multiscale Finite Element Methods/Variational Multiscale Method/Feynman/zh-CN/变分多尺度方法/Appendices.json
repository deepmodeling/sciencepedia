{
    "hands_on_practices": [
        {
            "introduction": "这个练习是变分多尺度方法（VMS）的基石。我们将通过一个简单的一维扩散问题，在一个单元内部将解显式地分解为粗尺度和细尺度分量。通过解析求解细尺度分量，我们可以精确地看到它如何捕捉粗尺度线性元无法表示的那部分解，为理解稳定化机制奠定基础。",
            "id": "3830100",
            "problem": "考虑区间 $[0,L]$ 上的稳态一维扩散问题，其强形式为\n$$-a \\frac{d^{2}u}{dx^{2}} = q,$$\n其中 $a>0$ 为常数扩散系数，$q$ 为常数源项。在变分多尺度方法 (VMS) 中，将解分解为 $u = u_{H} + u^{\\prime}$，其中 $u_{H}$ 属于节点为 $\\{x_{j}\\}$ 的网格上的标准连续分片线性有限元空间，而 $u^{\\prime}$ 是一个在所有网格节点上都为零的细尺度分量。关注长度为 $h = x_{i+1} - x_{i}$ 的单个单元 $e = [x_{i}, x_{i+1}]$。\n\n在单元 $e$ 内部，粗尺度场 $u_{H}(x)$ 由帽函数表示为\n$$u_{H}(x) = N_{i}(x)\\,U_{i} + N_{i+1}(x)\\,U_{i+1},$$\n其中节点值为 $U_{i}$ 和 $U_{i+1}$，单元帽函数为\n$$N_{i}(x) = \\frac{x_{i+1} - x}{h}, \\qquad N_{i+1}(x) = \\frac{x - x_{i}}{h}.$$\n假设细尺度分量 $u^{\\prime}(x)$ 在单元端点处满足齐次狄利克雷条件，\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\n从控制方程和 VMS 分解 $u = u_{H} + u^{\\prime}$ 出发，推导单元 $e$ 内部的局部细尺度方程，并在上述端点条件下精确求解，以获得关于 $x$, $x_{i}$, $x_{i+1}$, $a$ 和 $q$ 的显式细尺度解 $u^{\\prime}(x)$。然后，将单元 $e$ 内部的完整分解解 $u(x) = u_{H}(x) + u^{\\prime}(x)$ 写成一个包含 $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$ 和 $q$ 的单一闭式表达式。\n\n您的最终答案必须是 $u(x)$ 在 $[x_{i},x_{i+1}]$ 上的单一解析表达式。无需四舍五入。答案中不带单位。",
            "solution": "该问题由稳态一维扩散方程控制\n$$-a \\frac{d^{2}u}{dx^{2}} = q,$$\n其中 $a>0$ 为常数，$q$ 为常数。变分多尺度方法 (VMS) 假设将解分解为粗尺度和细尺度，\n$$u = u_{H} + u^{\\prime},$$\n其中 $u_{H}$ 位于标准连续分片线性有限元空间中，而 $u^{\\prime}$ 位于在网格节点上为零的互补细尺度空间中。在一个长度为 $h = x_{i+1}-x_{i}$ 的给定单元 $e=[x_{i},x_{i+1}]$ 上，粗尺度场为\n$$u_{H}(x) = N_{i}(x)\\,U_{i} + N_{i+1}(x)\\,U_{i+1},$$\n帽函数为\n$$N_{i}(x) = \\frac{x_{i+1} - x}{h}, \\qquad N_{i+1}(x) = \\frac{x - x_{i}}{h}.$$\n根据分片线性基函数的构造，在单元内部，$u_{H}(x)$ 的单元二阶导数为零，\n$$\\frac{d^{2}u_{H}}{dx^{2}} = 0 \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\n\n将 VMS 分解代入强形式：\n$$-a \\frac{d^{2}}{dx^{2}}(u_{H} + u^{\\prime}) = q.$$\n这得到\n$$-a \\frac{d^{2}u^{\\prime}}{dx^{2}} = q + a \\frac{d^{2}u_{H}}{dx^{2}}.$$\n在单元内部使用 $\\frac{d^{2}u_{H}}{dx^{2}} = 0$ ，单元 $e$ 内部的细尺度方程简化为常系数常微分方程\n$$-a \\frac{d^{2}u^{\\prime}}{dx^{2}} = q \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\n细尺度在单元端点处满足齐次狄利克雷条件，\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\n求解细尺度常微分方程。将其重写为\n$$\\frac{d^{2}u^{\\prime}}{dx^{2}} = -\\frac{q}{a}.$$\n积分两次：\n$$u^{\\prime}(x) = -\\frac{q}{2a} x^{2} + C_{1} x + C_{2}.$$\n施加 $u^{\\prime}(x_{i})=0$：\n$$0 = -\\frac{q}{2a} x_{i}^{2} + C_{1} x_{i} + C_{2},$$\n以及 $u^{\\prime}(x_{i+1})=0$：\n$$0 = -\\frac{q}{2a} x_{i+1}^{2} + C_{1} x_{i+1} + C_{2}.$$\n后式减前式：\n$$0 = -\\frac{q}{2a}(x_{i+1}^{2} - x_{i}^{2}) + C_{1}(x_{i+1} - x_{i}).$$\n由于 $x_{i+1}^{2}-x_{i}^{2} = (x_{i+1}-x_{i})(x_{i+1}+x_{i})$ 且 $h = x_{i+1} - x_{i}$，\n$$0 = -\\frac{q}{2a} h (x_{i+1} + x_{i}) + C_{1} h,$$\n因此\n$$C_{1} = \\frac{q}{2a} (x_{i+1} + x_{i}).$$\n使用 $u^{\\prime}(x_{i})=0$ 来求 $C_{2}$：\n$$0 = -\\frac{q}{2a} x_{i}^{2} + \\frac{q}{2a} (x_{i+1}+x_{i}) x_{i} + C_{2} \\quad \\Rightarrow \\quad C_{2} = \\frac{q}{2a} \\left[x_{i}^{2} - (x_{i+1}+x_{i}) x_{i}\\right] = -\\frac{q}{2a} x_{i} x_{i+1}.$$\n因此，\n$$u^{\\prime}(x) = -\\frac{q}{2a} x^{2} + \\frac{q}{2a} (x_{i+1}+x_{i}) x - \\frac{q}{2a} x_{i} x_{i+1}.$$\n将其整理成乘积形式：\n$$u^{\\prime}(x) = \\frac{q}{2a} \\left[ -x^{2} + (x_{i+1}+x_{i}) x - x_{i} x_{i+1} \\right] = \\frac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\n因此，单元内部的细尺度解是二次气泡函数\n$$u^{\\prime}(x) = \\frac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\n\n单元内部的粗尺度场为\n$$u_{H}(x) = U_{i} \\frac{x_{i+1}-x}{h} + U_{i+1} \\frac{x - x_{i}}{h}.$$\n结合粗尺度和细尺度，得到单元内部的完整分解解：\n$$u(x) = U_{i} \\frac{x_{i+1}-x}{h} + U_{i+1} \\frac{x - x_{i}}{h} + \\frac{q}{2a} (x - x_{i})(x_{i+1} - x), \\qquad h = x_{i+1} - x_{i}.$$\n\n这就是所要求的，一个关于 $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$ 和 $q$ 的单一闭式解析表达式。",
            "answer": "$$\\boxed{U_{i}\\,\\frac{x_{i+1}-x}{x_{i+1}-x_{i}} \\;+\\; U_{i+1}\\,\\frac{x-x_{i}}{x_{i+1}-x_{i}} \\;+\\; \\frac{q}{2a}\\,(x-x_{i})\\,(x_{i+1}-x)}$$"
        },
        {
            "introduction": "在尺度分离概念的基础上，本练习探讨了VMS与稳定化有限元方法之间的联系。对于标准方法可能失效的一维对流扩散问题，我们将使用一个简单的“气泡”函数来模拟细尺度。通过在这个细尺度模型上施加控制方程，我们将推导出一个稳定化参数 $\\tau_{K}$ 的封闭表达式，从而展示VMS如何为设计稳定化项提供坚实的理论基础。",
            "id": "3830072",
            "problem": "考虑单元 $K=(0,h)$ 上的具有常系数的一维稳态对流扩散模型：\n$$\nL u := -\\epsilon \\frac{d^{2}u}{dx^{2}} + \\beta \\frac{du}{dx}, \\quad \\epsilon>0,\\; \\beta \\in \\mathbb{R}.\n$$\n在基于残差的变分多尺度方法 (VMS) 中，将解分解为 $u = u_{h} + u'$，其中 $u_{h}$ 属于连续分片线性有限元空间，细尺度分量 $u'$ 在单元边界上为零。在单元 $K$ 上使用单气泡细尺度模型，即假设 $u'(x) = c\\, b(x)$，其中 $b(x)$ 为标准气泡函数：\n$$\nb(x) = 4\\frac{x}{h}\\left(1 - \\frac{x}{h}\\right), \\quad x \\in (0,h).\n$$\n将单元残差定义为 $R(u_{h}) := L u_{h} - f$。取 $f \\equiv 0$，因此 $R(u_{h}) = L u_{h}$。在伽辽金意义下，使用气泡试探函数在 $K$ 上求解细尺度方程，即选择 $c \\in \\mathbb{R}$ 使得：\n$$\n\\big(L(c\\,b),\\, b\\big)_{K} = \\big(R(u_{h}),\\, b\\big)_{K},\n$$\n其中 $(\\cdot,\\cdot)_{K}$ 表示 $L^{2}(K)$ 内积。在 $K$ 上的粗尺度弱形式中，引入的稳定化项为：\n$$\nS_{K}(w_{h},u_{h}) := \\big(L^{*} w_{h},\\, u'\\big)_{K},\n$$\n其中 $w_{h}$ 是任意粗尺度试探函数（在 $K$ 上是分片线性的），$L^{*}$ 是 $L$ 的 $L^{2}$-伴随算子。因为对于分片线性的 $u_{h}$，在 $K$ 上有 $w_{h}''=0$ 且 $R(u_{h})$ 为常数，所以该项可以写成流线迎风形式：\n$$\nS_{K}(w_{h},u_{h}) \\;=\\; -\\int_{K} \\tau_{K}\\, \\beta \\frac{dw_{h}}{dx}\\, R(u_{h}) \\, dx,\n$$\n其中 $\\tau_{K}$ 是一个标量稳定化参数，在上述单气泡模型下仅依赖于 $h$ 和 $\\epsilon$。\n\n仅从这些定义和假设出发，推导单元级稳定化参数 $\\tau_{K}$ 作为 $h$ 和 $\\epsilon$ 的函数的闭式表达式。你的最终答案必须是 $\\tau_{K}$ 的一个单一解析表达式。",
            "solution": "推导过程分为三个主要阶段：首先，我们求出定义细尺度解 $u'$ 的常数 $c$；其次，我们将此 $u'$ 代入稳定化项 $S_K$ 的定义中；最后，我们将得到的 $S_K$ 表达式与给定的目标形式进行比较，以确定 $\\tau_K$。\n\n**1. 确定细尺度系数 $c$**\n细尺度方程为 $\\big(L(c\\,b),\\, b\\big)_{K} = \\big(R(u_{h}),\\, b\\big)_{K}$。由于 $c$ 是一个常数，该式可简化为 $c \\big(L(b),\\, b\\big)_{K} = \\big(R(u_{h}),\\, b\\big)_{K}$。因此，\n$$\nc = \\frac{\\big(R(u_{h}),\\, b\\big)_{K}}{\\big(L(b),\\, b\\big)_{K}}\n$$\n我们必须计算这两个内积。\n由于 $u_h$ 在单元 $K=(0,h)$ 上是分片线性的，其二阶导数 $\\frac{d^2u_h}{dx^2}$ 为零，其一阶导数 $\\frac{du_h}{dx}$ 为常数。因此，残差 $R(u_h) = L u_h = -\\epsilon \\frac{d^2u_h}{dx^2} + \\beta \\frac{du_h}{dx} = \\beta \\frac{du_h}{dx}$ 在单元 $K$ 上为常数。我们将这个常数值记为 $R_K$。\n\n分子是 $\\big(R(u_{h}),\\, b\\big)_{K} = \\int_0^h R_K b(x) dx = R_K \\int_0^h b(x) dx$。我们计算气泡函数的积分：\n$$\n\\int_0^h b(x) dx = \\int_0^h 4\\left(\\frac{x}{h} - \\frac{x^2}{h^2}\\right) dx = 4 \\left[\\frac{x^2}{2h} - \\frac{x^3}{3h^2}\\right]_0^h = 4 \\left(\\frac{h^2}{2h} - \\frac{h^3}{3h^2}\\right) = 4\\left(\\frac{h}{2} - \\frac{h}{3}\\right) = \\frac{2h}{3}\n$$\n所以，分子是 $\\big(R(u_{h}),\\, b\\big)_{K} = R_K \\frac{2h}{3}$。\n\n分母是 $\\big(L(b),\\, b\\big)_{K} = \\int_0^h \\left(-\\epsilon \\frac{d^2b}{dx^2} + \\beta \\frac{db}{dx}\\right) b(x) dx$。我们逐项计算。对于扩散部分，我们使用分部积分以及 $b(0)=b(h)=0$ 的事实：\n$$\n\\int_0^h -\\epsilon \\frac{d^2b}{dx^2} b(x) dx = -\\epsilon \\left[ \\frac{db}{dx} b(x) \\right]_0^h + \\epsilon \\int_0^h \\left(\\frac{db}{dx}\\right)^2 dx = \\epsilon \\int_0^h \\left(\\frac{db}{dx}\\right)^2 dx\n$$\n我们计算 $b(x)$ 的导数：$\\frac{db}{dx} = \\frac{d}{dx} \\left(\\frac{4x}{h} - \\frac{4x^2}{h^2}\\right) = \\frac{4}{h} - \\frac{8x}{h^2}$。\n$$\n\\int_0^h \\left(\\frac{db}{dx}\\right)^2 dx = \\int_0^h \\left(\\frac{4}{h} - \\frac{8x}{h^2}\\right)^2 dx = \\int_0^h \\left(\\frac{16}{h^2} - \\frac{64x}{h^3} + \\frac{64x^2}{h^4}\\right) dx = \\left[\\frac{16x}{h^2} - \\frac{32x^2}{h^3} + \\frac{64x^3}{3h^4}\\right]_0^h = \\frac{16h}{h^2} - \\frac{32h^2}{h^3} + \\frac{64h^3}{3h^4} = \\frac{16}{h} - \\frac{32}{h} + \\frac{64}{3h} = \\frac{1}{h}\\left(16-32+\\frac{64}{3}\\right) = \\frac{1}{h}\\left(-16+\\frac{64}{3}\\right) = \\frac{16}{3h}\n$$\n所以，分母的扩散部分是 $\\epsilon \\frac{16}{3h}$。\n\n对于分母的对流部分：\n$$\n\\int_0^h \\beta \\frac{db}{dx} b(x) dx = \\beta \\int_0^h \\frac{1}{2} \\frac{d}{dx}(b(x)^2) dx = \\frac{\\beta}{2} [b(x)^2]_0^h = \\frac{\\beta}{2}(0^2 - 0^2) = 0\n$$\n这一项为零。因此，分母是 $\\big(L(b),\\, b\\big)_{K} = \\frac{16\\epsilon}{3h}$。\n\n现在我们可以求出 $c$：\n$$\nc = \\frac{R_K \\frac{2h}{3}}{\\frac{16\\epsilon}{3h}} = R_K \\frac{2h}{3} \\frac{3h}{16\\epsilon} = \\frac{R_K h^2}{8\\epsilon}\n$$\n细尺度解为 $u'(x) = c b(x) = \\frac{R_K h^2}{8\\epsilon} b(x)$。\n\n**2. 计算稳定化项 $S_K$**\n稳定化项定义为 $S_{K}(w_{h},u_{h}) = \\big(L^{*} w_{h},\\, u'\\big)_{K}$。$L = -\\epsilon\\frac{d^2}{dx^2} + \\beta\\frac{d}{dx}$ 的形式伴随算子是 $L^{*} = -\\epsilon\\frac{d^2}{dx^2} - \\beta\\frac{d}{dx}$。\n由于试探函数 $w_h$ 在 $K$ 上是分片线性的，其二阶导数 $\\frac{d^2w_h}{dx^2}$ 为零。因此，$L^* w_h = -\\beta \\frac{dw_h}{dx}$。注意 $\\frac{dw_h}{dx}$ 在 $K$ 上是常数。我们称之为 $w'_K$。\n所以，$S_K = \\int_0^h \\left(-\\beta w'_K\\right) u'(x) dx = -\\beta w'_K \\int_0^h u'(x) dx$。\n我们代入 $u'(x)$ 的表达式：\n$$\n\\int_0^h u'(x) dx = \\int_0^h \\frac{R_K h^2}{8\\epsilon} b(x) dx = \\frac{R_K h^2}{8\\epsilon} \\int_0^h b(x) dx\n$$\n我们已经计算过 $\\int_0^h b(x) dx = \\frac{2h}{3}$。\n$$\n\\int_0^h u'(x) dx = \\frac{R_K h^2}{8\\epsilon} \\frac{2h}{3} = \\frac{R_K h^3}{12\\epsilon}\n$$\n将此结果代回 $S_K$ 的表达式：\n$$\nS_K = -\\beta w'_K \\left(\\frac{R_K h^3}{12\\epsilon}\\right) = -\\beta \\frac{dw_h}{dx} R(u_h) \\frac{h^3}{12\\epsilon}\n$$\n\n**3. 确定稳定化参数 $\\tau_K$**\n问题陈述 $S_K$ 可以写成形式 $S_K = -\\int_{K} \\tau_{K}\\, \\beta \\frac{dw_{h}}{dx}\\, R(u_{h}) \\, dx$。\n由于 $\\tau_K$、$\\beta$、$\\frac{dw_h}{dx}$ 和 $R(u_h)$ 在单元 $K$ 上都是常数，我们可以将它们从积分中提出来：\n$$\nS_K = - \\tau_K \\beta \\frac{dw_h}{dx} R(u_h) \\int_0^h dx = - \\tau_K \\beta \\frac{dw_h}{dx} R(u_h) h\n$$\n通过令两个导出的 $S_K$ 表达式相等：\n$$\n- \\tau_K \\beta \\frac{dw_h}{dx} R(u_h) h = -\\beta \\frac{dw_h}{dx} R(u_h) \\frac{h^3}{12\\epsilon}\n$$\n假设 $\\beta, \\frac{dw_h}{dx}, R(u_h)$ 不恒为零，我们可以从两边消去这些项：\n$$\n\\tau_K h = \\frac{h^3}{12\\epsilon}\n$$\n解出 $\\tau_K$ 得到稳定化参数的最终表达式：\n$$\n\\tau_K = \\frac{h^2}{12\\epsilon}\n$$\n这个结果仅依赖于单元尺寸 $h$ 和扩散系数 $\\epsilon$，正如问题陈述所要求的。",
            "answer": "$$\\boxed{\\frac{h^{2}}{12\\epsilon}}$$"
        },
        {
            "introduction": "最后一个练习弥合了VMS理论与在有限元软件中实际应用之间的鸿沟。我们将看到如何通过一个称为静态凝聚的过程，在组装全局系统之前，从单元级方程中代数地消除细尺度“气泡”自由度。这个练习要求推导并实现修正后的（凝聚的）粗尺度刚度矩阵和载荷向量的公式，让我们直接了解细尺度效应是如何被整合到粗尺度计算中的。",
            "id": "3805260",
            "problem": "考虑区间 $[0,1]$ 上具有常数系数和常数源项的一维稳态对流-扩散边界值问题，其控制微分算子为 $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$，其中 $\\nu > 0$ 为扩散系数，$a \\in \\mathbb{R}$ 为对流速度，$f \\in \\mathbb{R}$ 为常数源项。使用一个双单元网格对域进行离散，节点位于 $x = 0$、$x = 0.5$ 和 $x = 1$，得到两个尺寸分别为 $h_1 = 0.5$ 和 $h_2 = 0.5$ 的单元。在每个单元上，用一个内部气泡函数增强通常的线性 Lagrange 试探空间，并使用包含粗尺度和气泡（细尺度）试探函数与权函数的 Galerkin 公式。具体来说，在每个单元的局部仿射坐标 $\\xi \\in [0,1]$ 中，定义线性形函数 $N_1(\\xi) = 1 - \\xi$、$N_2(\\xi) = \\xi$ 和气泡函数 $N_b(\\xi) = 4 \\xi (1 - \\xi)$，其映射关系为 $x(\\xi)$，使得 $dx = h \\, d\\xi$。对于这个增强的单元空间，写出与双线性形式 $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$ 相关联的局部单元刚度矩阵 $K_e$，以及与线性形式 $\\int_e w \\, f \\, dx$ 相关联的局部单元载荷向量 $F_e$，其中 $'$ 表示对 $x$ 的微分，$w$ 和 $u$ 是在 $\\{N_1, N_2, N_b\\}$ 中展开的检验函数和试探函数。\n\n对每个单元执行静态凝聚以消除气泡自由度。根据 $\\{N_1, N_2, N_b\\}$ 的排序，将单元刚度和载荷显式地划分为粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块。然后推导由 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$ 给出的凝聚粗尺度刚度矩阵和载荷向量，其中 $F_{cc}$ 表示限制在 $\\{N_1, N_2\\}$ 上的载荷的粗尺度部分，$F_b$ 是载荷的气泡分量。确保所有积分都得到精确计算，并且所有中间符号运算都与仿射映射保持一致。\n\n遵循变分多尺度方法 (Variational Multiscale Method, VMS) 的尺度分离原理，其中富含气泡的细尺度被代数消除，其影响被投影到粗尺度上。仅从形函数、双线性形式和线性形式以及静态凝聚规则的定义出发，推导以 $a$、$\\nu$、$h$ 和 $f$ 表示的显式凝聚粗尺度刚度和载荷表达式。然后实现一个程序，对于给定的双单元网格（$h_1 = 0.5$ 和 $h_2 = 0.5$），为每个单元计算：\n- 凝聚的 $2 \\times 2$ 刚度矩阵 $K_{e}^{\\text{cond}}$（以行主序展平形式 $[K_{11}, K_{12}, K_{21}, K_{22}]$），以及\n- 凝聚的 $2 \\times 1$ 载荷向量 $F_{e}^{\\text{cond}}$（以展平形式 $[F_1, F_2]$）。\n\n您的程序必须对以下参数集 $(a, \\nu, f)$ 的测试套件精确评估这些量：\n- 测试用例 1 (正常情况): $(a, \\nu, f) = (1.0, 0.01, 1.0)$。\n- 测试用例 2 (扩散主导边界条件情况): $(a, \\nu, f) = (0.1, 1.0, 2.0)$。\n- 测试用例 3 (对流主导边界情况): $(a, \\nu, f) = (2.5, 0.001, -0.5)$。\n\n对于此纯数学公式，所有量都是无量纲的；不需要物理单位。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，格式如下：\n- 对于每个测试用例，输出一个包含四个子列表的列表，分别对应于单元 1 的凝聚刚度（展平）、单元 1 的凝聚载荷（展平）、单元 2 的凝聚刚度（展平）和单元 2 的凝聚载荷（展平）。\n- 总输出是包含三个测试用例列表的列表，因此最终输出的形式为 $[[\\ldots],[\\ldots],[\\ldots]]$，其中每个内部列表都按指定顺序包含恰好四个子列表。\n\n在您的推导中，不允许使用任何捷径或预先提供的公式；计算必须遵循上面给出的基本定义和静态凝聚操作。",
            "solution": "求解过程首先为增强空间推导单元刚度矩阵和载荷向量，然后执行静态凝聚以获得粗尺度算子。\n\n一维稳态对流-扩散方程由下式给出：\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\n其中 $\\nu > 0$、$a \\in \\mathbb{R}$ 和 $f \\in \\mathbb{R}$ 是常数。\n\n在尺寸为 $h$ 的单个单元 $e$ 上的弱形式是，找到 $u \\in V_h$，使得对于所有 $w \\in V_h$：\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\n单元上的空间 $V_h$ 由基函数 $\\{N_1, N_2, N_b\\}$ 张成。在局部坐标 $\\xi \\in [0, 1]$ 中，它们是：\n- 线性形函数：$N_1(\\xi) = 1 - \\xi$，$N_2(\\xi) = \\xi$\n- 气泡形函数：$N_b(\\xi) = 4\\xi(1 - \\xi)$\n\n全局坐标 $x$ 和局部坐标 $\\xi$ 之间的关系由仿射映射 $x(\\xi) = x_1 + h\\xi$ 给出，其中 $x_1$ 是单元的起始坐标。这给出了微分关系 $dx = h \\, d\\xi$ 和 $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$。用 $'$ 表示对 $x$ 的微分，用点表示对 $\\xi$ 的微分，我们有 $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$。\n\n基函数关于 $\\xi$ 的导数是：\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\n$3 \\times 3$ 的单元刚度矩阵 $K_e$ 和 $3 \\times 1$ 的载荷向量 $F_e$ 的项由下式给出：\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\n变换到局部坐标：\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\n我们计算所需的积分：\n**与扩散相关的积分 ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\n刚度矩阵的扩散部分是 $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1  -1  0 \\\\ -1  1  0 \\\\ 0  0  16/3 \\end{pmatrix}$。\n\n**与对流相关的积分 ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\n刚度矩阵的对流部分是 $K^{a} = a \\begin{pmatrix} -1/2  1/2  2/3 \\\\ -1/2  1/2  -2/3 \\\\ -2/3  2/3  0 \\end{pmatrix}$。\n\n**与载荷相关的积分 ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\n完整的载荷向量是 $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$。\n\n总单元矩阵 $K_e = K^\\nu + K^a$ 是：\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2}  -\\frac{\\nu}{h} + \\frac{a}{2}  \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2}  \\frac{\\nu}{h} + \\frac{a}{2}  -\\frac{2a}{3} \\\\\n-\\frac{2a}{3}  \\frac{2a}{3}  \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\n总单元向量 $F_e$ 是：\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\n为了进行静态凝聚，我们根据基的排序 $\\{N_1, N_2, N_b\\}$ 将它们划分为粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块：\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2}  -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2}  \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3  2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\n凝聚算子为 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$。\n首先，$K_{bb}^{-1} = \\frac{3h}{16\\nu}$。\n\n刚度修正项为 $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$：\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3}  \\frac{2a}{3} \\end{pmatrix} = \\frac{3ha^2}{16\\nu} \\begin{pmatrix} -4/9  4/9 \\\\ 4/9  -4/9 \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} -1  1 \\\\ 1  -1 \\end{pmatrix}\n$$\n凝聚刚度矩阵为 $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$：\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu}  -\\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu}  \\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\n载荷修正项为 $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$：\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{12afh^2}{144\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\n凝聚载荷向量为 $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$：\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\n这些推导出的公式在以下代码中实现。对于两个单元，$h=0.5$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2.0\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        # delta_K_term = (h * a^2) / (12 * nu)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        # delta_F_term = (a * f * h^2) / (12 * nu)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    # The required output format is a custom string representation of a list of lists,\n    # where the sub-list __str__ representations are joined by commas.\n    # The provided skeleton code `print(f\"[{','.join(map(str, results))}]\")`\n    # produces a representation where spaces after commas within sub-lists are\n    # preserved, but commas between the main list items have no trailing space.\n    # To match typical compact JSON/Python list representation, we would remove all spaces.\n    # However, to be perfectly compliant with the skeleton, we will use it.\n    # A cleaner alternative would be `str(results).replace(\" \", \"\")`, but the\n    # skeleton's logic is followed here.\n    \n    # Custom string formatting to avoid spaces between list elements\n    # and to match the desired compact output. This is a bit more manual \n    # than the skeleton, but ensures no spaces at all.\n    def format_list_compactly(l):\n        return f\"[{','.join(str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[[{format_case_result(results[0])[1:-1]}],[{format_case_result(results[1])[1:-1]}],[{format_case_result(results[2])[1:-1]}]]\"\n\n    # The final output format must be [[...],[...],[...]]. The format_case_result creates one [...].\n    # So we need to join them.\n    final_output_string = f\"[{','.join([format_case_result(res) for res in results])}]\"\n    print(final_output_string)\n\n\nsolve()\n```"
        }
    ]
}