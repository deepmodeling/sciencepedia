{
    "hands_on_practices": [
        {
            "introduction": "This first exercise is foundational, designed to build intuition for the core concept of scale separation. Before we can analyze the interaction between scales, we must first become comfortable with the idea of separating a function into its coarse and fine components. This practice guides you through constructing these distinct function spaces, $V_h$ and $V'$, using hierarchical basis functions on a simple one-dimensional element and demonstrates how to find the unique representation of a function within this new basis.",
            "id": "3805281",
            "problem": "Consider the Variational Multiscale Method (VMS), which decomposes a function space into resolved scales and fine scales through a projector that acts on a suitable finite-dimensional subspace. Let the reference one-dimensional element be $K=[-1,1]$ and consider the following hierarchical bases.\n\nDefine the resolved-scale space $V_h$ as the span of the linear Lagrange functions associated with the endpoints:\n$$\n\\phi_1(x) = \\frac{1-x}{2}, \\qquad \\phi_2(x) = \\frac{1+x}{2}.\n$$\nDefine the fine-scale space $V'$ as the span of a bubble function that vanishes at the endpoints:\n$$\n\\psi(x) = 1 - x^2.\n$$\nAssume the projector onto $V_h$ is the nodal interpolation operator at $x=-1$ and $x=1$, so that for any sufficiently smooth $u$, the resolved-scale component $u_h \\in V_h$ satisfies $u_h(-1) = u(-1)$ and $u_h(1)=u(1)$, and the fine-scale component is $u' = u - u_h \\in V'$.\n\nTasks:\n- Using first principles (definitions of finite-dimensional subspaces, interpolation operators, and the properties of hierarchical basis functions), construct explicit bases for $V_h$ and $V'$, and verify that $V_h \\cap V' = \\{0\\}$ so that $V_h \\oplus V'$ is a direct sum on the element $K$.\n- Given the nodal samples $u(-1)=2$, $u(0)=1$, and $u(1)=3$, compute the decomposition coefficients $a_1$, $a_2$, and $b$ in the hierarchical representation\n$$\nu(x) \\approx a_1 \\,\\phi_1(x) + a_2 \\,\\phi_2(x) + b \\,\\psi(x),\n$$\nconsistent with the VMS scale separation and the stated interpolation conditions. Provide your final answer as a row matrix containing the three coefficients. No rounding is required, and no physical units are involved.",
            "solution": "The problem is first validated to ensure it is self-contained, scientifically grounded, and well-posed. The given information includes the domain $K=[-1,1]$, definitions for the resolved-scale space $V_h$ and the fine-scale space $V'$, a definition for the projector onto $V_h$, and specific nodal values of a function $u$. The tasks are to verify the direct sum property of the spaces and to compute the coefficients of a hierarchical expansion. All elements are standard in the theory of finite element and variational multiscale methods, rendering the problem valid.\n\nWe proceed with the solution, which consists of two parts as requested.\n\nPart 1: Analysis of the vector spaces $V_h$ and $V'$.\n\nThe resolved-scale space $V_h$ is defined as the span of the functions $\\phi_1(x) = \\frac{1-x}{2}$ and $\\phi_2(x) = \\frac{1+x}{2}$. These are linearly independent polynomials (one is of degree $1$, the other is of degree $1$; they are not scalar multiples of each other), so an explicit basis for the two-dimensional space $V_h$ is $\\{\\phi_1(x), \\phi_2(x)\\}$.\n\nThe fine-scale space $V'$ is defined as the span of the function $\\psi(x) = 1 - x^2$. An explicit basis for the one-dimensional space $V'$ is $\\{\\psi(x)\\}$.\n\nTo verify that $V_h \\cap V' = \\{0\\}$, we must show that the only function belonging to both spaces is the zero function. Let $v(x)$ be an arbitrary function in the intersection, $v(x) \\in V_h \\cap V'$.\n\nSince $v(x) \\in V_h$, it can be expressed as a linear combination of the basis functions of $V_h$:\n$$\nv(x) = c_1 \\phi_1(x) + c_2 \\phi_2(x)\n$$\nfor some scalar coefficients $c_1, c_2 \\in \\mathbb{R}$.\n\nSince $v(x) \\in V'$, it can be expressed as a scalar multiple of the basis function of $V'$:\n$$\nv(x) = b \\, \\psi(x)\n$$\nfor some scalar coefficient $b \\in \\mathbb{R}$.\n\nThe basis functions for $V_h$ are the standard linear Lagrange polynomials associated with the nodes $x_1 = -1$ and $x_2 = 1$. They have the nodal property $\\phi_i(x_j) = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta. Specifically:\n$\\phi_1(-1) = 1$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(1) = 1$.\n\nThe basis function for $V'$ is a bubble function, designed to vanish at the endpoints of the element $K$:\n$\\psi(-1) = 1 - (-1)^2 = 1 - 1 = 0$.\n$\\psi(1) = 1 - (1)^2 = 1 - 1 = 0$.\n\nIf $v(x) = b \\, \\psi(x)$, then it must hold that $v(-1) = b \\, \\psi(-1) = 0$ and $v(1) = b \\, \\psi(1) = 0$.\n\nNow, we evaluate the expression for $v(x)$ from $V_h$ at the endpoints:\nAt $x=-1$: $v(-1) = c_1 \\phi_1(-1) + c_2 \\phi_2(-1) = c_1(1) + c_2(0) = c_1$.\nAt $x=1$: $v(1) = c_1 \\phi_1(1) + c_2 \\phi_2(1) = c_1(0) + c_2(1) = c_2$.\n\nEquating the results, we must have $c_1 = 0$ and $c_2 = 0$. Substituting these coefficients back into the expression for $v(x)$ from $V_h$ gives:\n$$\nv(x) = 0 \\cdot \\phi_1(x) + 0 \\cdot \\phi_2(x) = 0\n$$\nfor all $x \\in K$. Thus, the only function in the intersection $V_h \\cap V'$ is the zero function. This confirms that the sum of the spaces is a direct sum, denoted $V = V_h \\oplus V'$.\n\nPart 2: Computation of the decomposition coefficients.\n\nWe are asked to find the coefficients $a_1, a_2, b$ for the hierarchical representation $u_{V}(x)$ that approximates a function $u(x)$ consistent with the given nodal values:\n$$\nu_{V}(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x) + b \\psi(x)\n$$\nThe problem provides three sample values of $u(x)$: $u(-1)=2$, $u(0)=1$, and $u(1)=3$. We enforce that the approximation $u_V(x)$ matches these values at the corresponding nodes:\n$u_V(-1) = 2$\n$u_V(0) = 1$\n$u_V(1) = 3$\n\nThis yields a system of three linear equations for the three unknown coefficients $a_1, a_2, b$. To build this system, we evaluate the basis functions at the nodes $x \\in \\{-1, 0, 1\\}$:\n$\\phi_1(-1) = 1$, $\\phi_1(0) = \\frac{1-0}{2} = \\frac{1}{2}$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(0) = \\frac{1+0}{2} = \\frac{1}{2}$, $\\phi_2(1) = 1$.\n$\\psi(-1) = 0$, $\\psi(0) = 1 - 0^2 = 1$, $\\psi(1) = 0$.\n\nSubstituting these values into the approximation equation at each node:\n\n1.  At $x = -1$:\n    $u_V(-1) = a_1 \\phi_1(-1) + a_2 \\phi_2(-1) + b \\psi(-1) = a_1(1) + a_2(0) + b(0) = a_1$.\n    Given $u(-1)=2$, we have $a_1 = 2$.\n\n2.  At $x = 1$:\n    $u_V(1) = a_1 \\phi_1(1) + a_2 \\phi_2(1) + b \\psi(1) = a_1(0) + a_2(1) + b(0) = a_2$.\n    Given $u(1)=3$, we have $a_2 = 3$.\n\nThese results are consistent with the VMS framework described, where the resolved-scale component $u_h(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x)$ is determined by the projection operator, which is nodal interpolation at the endpoints. Thus, $u_h(-1)=u(-1)=2$ implies $a_1=2$, and $u_h(1)=u(1)=3$ implies $a_2=3$.\n\n3.  At $x = 0$:\n    $u_V(0) = a_1 \\phi_1(0) + a_2 \\phi_2(0) + b \\psi(0) = a_1(\\frac{1}{2}) + a_2(\\frac{1}{2}) + b(1)$.\n    Given $u(0)=1$, we have the equation:\n    $$\n    \\frac{1}{2} a_1 + \\frac{1}{2} a_2 + b = 1\n    $$\n    We substitute the known values of $a_1=2$ and $a_2=3$ into this equation to solve for $b$:\n    $$\n    \\frac{1}{2}(2) + \\frac{1}{2}(3) + b = 1\n    $$\n    $$\n    1 + \\frac{3}{2} + b = 1\n    $$\n    $$\n    \\frac{5}{2} + b = 1\n    $$\n    $$\n    b = 1 - \\frac{5}{2} = \\frac{2}{2} - \\frac{5}{2} = -\\frac{3}{2}\n    $$\nThe decomposition coefficients are therefore $a_1=2$, $a_2=3$, and $b = -\\frac{3}{2}$. The fine-scale component is $u'(x) = u_V(x) - u_h(x) = -\\frac{3}{2}\\psi(x)$.\nThe final answer is the set of coefficients $(a_1, a_2, b)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 & 3 & -\\frac{3}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A primary achievement of the VMS framework is the systematic development of stabilized numerical methods, particularly for transport-dominated problems. This practice reveals the engine behind this process: a procedure known as static condensation. By algebraically eliminating the fine-scale (or \"bubble\") degrees of freedom at the element level, we can derive modified coarse-scale equations that naturally contain the necessary stabilization terms, linking VMS theory to practical application.",
            "id": "3805260",
            "problem": "Consider the one-dimensional steady advection-diffusion boundary value problem on the interval $[0,1]$ with constant coefficients and a constant source, governed by the differential operator $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$, where $\\nu > 0$ is the diffusion coefficient, $a \\in \\mathbb{R}$ is the advection velocity, and $f \\in \\mathbb{R}$ is a constant source. Discretize the domain using a two-element mesh with nodes at $x = 0$, $x = 0.5$, and $x = 1$, yielding two elements with sizes $h_1 = 0.5$ and $h_2 = 0.5$. On each element, augment the usual linear Lagrange trial space with a single interior bubble function, and use the Galerkin formulation that includes both coarse and bubble (fine-scale) trial and weighting functions. Specifically, on each element in the local affine coordinate $\\xi \\in [0,1]$, define the linear shape functions $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$, and the bubble function $N_b(\\xi) = 4 \\xi (1 - \\xi)$, with the mapping $x(\\xi)$ such that $dx = h \\, d\\xi$. For this augmented element space, write the local element stiffness matrix $K_e$ associated with the bilinear form $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$, and the local element load vector $F_e$ associated with the linear form $\\int_e w \\, f \\, dx$, where $'$ denotes differentiation with respect to $x$, and $w$ and $u$ are test and trial functions expanded in $\\{N_1, N_2, N_b\\}$.\n\nPerform static condensation to eliminate the bubble degree of freedom on each element. Explicitly partition the element stiffness and load into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks consistent with the ordering $\\{N_1, N_2, N_b\\}$. Then derive the condensed coarse-scale stiffness matrix and load vector given by $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$, where $F_{cc}$ denotes the coarse-scale part of the load restricted to $\\{N_1, N_2\\}$, and $F_b$ is the bubble component of the load. Ensure that all integrals are evaluated exactly and that all intermediate symbolic operations are done consistently with the affine mapping.\n\nFollow the scale separation principle of the Variational Multiscale Method (VMS), where the bubble-enriched fine scale is algebraically eliminated and its effect is projected onto the coarse scale. Starting only from the definitions of the shape functions, the bilinear and linear forms, and the static condensation rule, derive the explicit condensed coarse-scale stiffness and load expressions in terms of $a$, $\\nu$, $h$, and $f$. Then implement a program that, for the given two-element mesh with $h_1 = 0.5$ and $h_2 = 0.5$, computes for each element:\n- the condensed $2 \\times 2$ stiffness matrix $K_{e}^{\\text{cond}}$ in row-major flattened form $[K_{11}, K_{12}, K_{21}, K_{22}]$, and\n- the condensed $2 \\times 1$ load vector $F_{e}^{\\text{cond}}$ in flattened form $[F_1, F_2]$.\n\nYour program must evaluate these quantities exactly for the following test suite of parameter sets $(a, \\nu, f)$:\n- Test case 1 (happy path): $(a, \\nu, f) = (1.0, 0.01, 1.0)$.\n- Test case 2 (diffusion-dominant boundary condition case): $(a, \\nu, f) = (0.1, 1.0, 2.0)$.\n- Test case 3 (advection-dominant edge case): $(a, \\nu, f) = (2.5, 0.001, -0.5)$.\n\nAll quantities are dimensionless for this purely mathematical formulation; no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format:\n- For each test case, output a list containing four sublists, corresponding to element $1$ condensed stiffness (flattened), element $1$ condensed load (flattened), element $2$ condensed stiffness (flattened), and element $2$ condensed load (flattened).\n- The overall output is a list of the three per-test-case lists, so the final output has the form $[[\\ldots],[\\ldots],[\\ldots]]$ where each inner list has exactly four sublists in the specified order.\n\nNo shortcuts or pre-supplied formulas are permitted in your derivation; the computation must follow from the fundamental definitions given above and the static condensation operation.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics and the Finite Element Method (FEM), specifically the Variational Multiscale (VMS) approach. The problem is well-posed, objective, self-contained, and requires a non-trivial derivation and implementation based on fundamental principles, making it a suitable task.\n\nThe solution proceeds by first deriving the element stiffness matrix and load vector for an augmented space, and then performing static condensation to obtain the coarse-scale operators.\n\nThe one-dimensional steady advection-diffusion equation is given by:\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\nwhere $\\nu > 0$, $a \\in \\mathbb{R}$, and $f \\in \\mathbb{R}$ are constants.\n\nThe weak form over a single element $e$ of size $h$ is to find $u \\in V_h$ such that for all $w \\in V_h$:\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\nThe space $V_h$ on the element is spanned by the basis functions $\\{N_1, N_2, N_b\\}$. In the local coordinate $\\xi \\in [0, 1]$, these are:\n- Linear shape functions: $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- Bubble shape function: $N_b(\\xi) = 4\\xi(1 - \\xi)$\n\nThe relationship between the global coordinate $x$ and local coordinate $\\xi$ is given by the affine mapping $x(\\xi) = x_1 + h\\xi$, where $x_1$ is the start coordinate of the element. This gives the differential relationships $dx = h \\, d\\xi$ and $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$. Denoting differentiation with respect to $x$ by $'$ and with respect to $\\xi$ by a dot, we have $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$.\n\nThe derivatives of the basis functions with respect to $\\xi$ are:\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\nThe $3 \\times 3$ element stiffness matrix $K_e$ and $3 \\times 1$ load vector $F_e$ have entries given by:\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\nChanging to local coordinates:\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\nWe compute the required integrals:\n**Diffusion-related integrals ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\nThe diffusion part of the stiffness matrix is $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 16/3 \\end{pmatrix}$.\n\n**Advection-related integrals ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\nThe advection part of the stiffness matrix is $K^{a} = a \\begin{pmatrix} -1/2 & 1/2 & 2/3 \\\\ -1/2 & 1/2 & -2/3 \\\\ -2/3 & 2/3 & 0 \\end{pmatrix}$.\n\n**Load-related integrals ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\nThe complete load vector is $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$.\n\nThe total element matrix $K_e = K^\\nu + K^a$ is:\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} & \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} & -\\frac{2a}{3} \\\\\n-\\frac{2a}{3} & \\frac{2a}{3} & \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\nThe total element vector $F_e$ is:\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\nFor static condensation, we partition these into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks, corresponding to the basis ordering $\\{N_1, N_2, N_b\\}$:\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3 & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\nThe condensed operators are $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$.\nFirst, $K_{bb}^{-1} = \\frac{3h}{16\\nu}$.\n\nThe stiffness modification is $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$:\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3} & \\frac{2a}{3} \\end{pmatrix} = \\frac{3ha^2}{16\\nu} \\begin{pmatrix} -4/9 & 4/9 \\\\ 4/9 & -4/9 \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\nThe condensed stiffness matrix is $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$:\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu} & -\\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu} & \\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\nThe load modification is $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$:\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{12afh^2}{144\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\nThe condensed load vector is $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$:\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\nThese derived formulas are implemented in the following code. For both elements, $h=0.5$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2.0\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        # delta_K_term = (h * a^2) / (12 * nu)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        # delta_F_term = (a * f * h^2) / (12 * nu)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    # The required output format is a custom string representation of a list of lists,\n    # where the sub-list __str__ representations are joined by commas.\n    # The provided skeleton code `print(f\"[{','.join(map(str, results))}]\")`\n    # produces a representation where spaces after commas within sub-lists are\n    # preserved, but commas between the main list items have no trailing space.\n    # To match typical compact JSON/Python list representation, we would remove all spaces.\n    # However, to be perfectly compliant with the skeleton, we will use it.\n    # A cleaner alternative would be `str(results).replace(\" \", \"\")`, but the\n    # skeleton's logic is followed here.\n    \n    # Custom string formatting to avoid spaces between list elements\n    # and to match the desired compact output. This is a bit more manual \n    # than the skeleton, but ensures no spaces at all.\n    def format_list_compactly(l):\n        return f\"[{','.join(str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\"\n\n    print(final_output_string)\n\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice elevates the VMS concept to a more general principle while also addressing the practical challenge of non-homogeneous boundary conditions. It frames the fine scales as a response to the shortcomings of the coarse-scale solution, where these shortcomings are precisely measured by the residual of the governing equation, $f - L(u_H)$. You will explore how this residual, which must also account for boundary data, acts as the fundamental driving force for the fine-scale solution.",
            "id": "3805324",
            "problem": "Consider the stationary one-dimensional advection–diffusion–reaction boundary-value problem on the unit interval $\\Omega = (0,1)$:\n$$\n-\\nu\\,u''(x) + a\\,u'(x) + \\sigma\\,u(x) = f(x)\\quad\\text{in }\\Omega,\n$$\nwith non-homogeneous Dirichlet boundary conditions $u(0)=g_0$ and $u(1)=g_1$, where $\\nu>0$, $a\\in\\mathbb{R}$, and $\\sigma\\ge 0$ are constants. Let $L u := -\\nu\\,u'' + a\\,u' + \\sigma\\,u$ denote the differential operator. Introduce a lifting function $\\ell\\in H^1(\\Omega)$ such that $\\ell(0)=g_0$ and $\\ell(1)=g_1$, and define the homogeneous variable $v := u - \\ell \\in H_0^1(\\Omega)$. Starting from the strong form and the standard Galerkin weak statement, perform the Variational Multiscale Method (VMS) split $v = v_H + v'$ with $v_H$ in a finite-dimensional resolved space $V_H \\subset H_0^1(\\Omega)$ and $v'$ in the complementary fine-scale space $V'$, and derive the fine-scale variational equation that identifies the modified residual forcing produced by the non-homogeneous boundary data via the lifting $\\ell$.\n\nUnder the common element-bubble closure where the fine-scale right-hand side is taken as the element-average of the modified residual, specialize to the single element $K=\\Omega$ and the data\n$$\n\\nu = 1,\\quad a = 2,\\quad \\sigma = 3,\\quad f(x)=\\exp(x),\\quad g_0=1,\\quad g_1=2,\\quad \\ell(x)=g_0(1-x)+g_1 x,\\quad v_H(x)=5\\,x(1-x).\n$$\nCompute the element-average of the modified residual forcing\n$$\nR_K \\;:=\\; \\frac{1}{|K|}\\int_{K}\\Big(f(x) - L\\big(\\ell(x)+v_H(x)\\big)\\Big)\\,dx,\n$$\nwhere $|K|=1$ for $K=\\Omega=(0,1)$. Express your final result as a single closed-form analytic expression. No rounding is required.",
            "solution": "The user has provided a problem from the field of numerical analysis, specifically concerning the Variational Multiscale Method (VMS) for a one-dimensional boundary-value problem. A full validation of the problem statement is required before proceeding to a solution.\n\n### Step 1: Extract Givens\nThe givens are extracted verbatim from the problem statement:\n- **Differential Equation:** $-\\nu\\,u''(x) + a\\,u'(x) + \\sigma\\,u(x) = f(x)$ on the domain $\\Omega = (0,1)$.\n- **Boundary Conditions:** $u(0)=g_0$ and $u(1)=g_1$.\n- **Constants:** $\\nu>0$, $a\\in\\mathbb{R}$, $\\sigma\\ge 0$.\n- **Differential Operator:** $L u := -\\nu\\,u'' + a\\,u' + \\sigma\\,u$.\n- **Homogenization:** A lifting function $\\ell\\in H^1(\\Omega)$ with $\\ell(0)=g_0$ and $\\ell(1)=g_1$ is used to define $v := u - \\ell \\in H_0^1(\\Omega)$.\n- **VMS Decomposition:** $v = v_H + v'$, where $v_H \\in V_H \\subset H_0^1(\\Omega)$ and $v' \\in V'$.\n- **Specific Data for Calculation:**\n  - $\\nu = 1$\n  - $a = 2$\n  - $\\sigma = 3$\n  - $f(x)=\\exp(x)$\n  - $g_0=1$, $g_1=2$\n  - $\\ell(x)=g_0(1-x)+g_1 x$\n  - $v_H(x)=5\\,x(1-x)$\n- **Target Quantity:** The element-average of the modified residual forcing, defined as $R_K \\;:=\\; \\frac{1}{|K|}\\int_{K}\\Big(f(x) - L\\big(\\ell(x)+v_H(x)\\big)\\Big)\\,dx$ for the single element $K=\\Omega=(0,1)$, where $|K|=1$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is validated against the specified criteria.\n\n- **Scientifically Grounded:** The problem is a standard application of the Variational Multiscale Method to a linear advection-diffusion-reaction equation. This is a well-established topic in computational mechanics and numerical analysis. The VMS framework, the use of lifting functions for non-homogeneous Dirichlet conditions, and the concept of a residual are all standard and mathematically sound. The problem is scientifically valid.\n- **Well-Posed:** All necessary functions, parameters, and boundary conditions are explicitly defined. The task is to perform a specific derivation and calculation, not to find the unknown function $u(x)$, but the information provided is sufficient for the requested task. The problem is well-posed.\n- **Objective:** The problem is stated in precise mathematical language, free from subjective or ambiguous terminology.\n- **Completeness and Consistency:** The provided data are self-contained and consistent. For instance, the specified lifting function $\\ell(x)$ correctly satisfies the boundary conditions: $\\ell(0)=g_0(1-0)+g_1(0) = g_0=1$ and $\\ell(1)=g_0(1-1)+g_1(1)=g_1=2$. The specified coarse-scale function $v_H(x)=5x(1-x)$ correctly satisfies the homogeneous boundary conditions $v_H(0)=0$ and $v_H(1)=0$, as required for a member of $V_H \\subset H_0^1(\\Omega)$.\n- **No Other Flaws:** The problem is not unrealistic, ill-posed, trivial, or unverifiable. It is a standard, formal exercise.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\nThe objective is to compute the average of the modified residual forcing over the domain $\\Omega=(0,1)$. First, we outline the derivation of this residual term within the VMS framework.\n\nThe strong form of the boundary value problem is:\n$$\nL u = f \\quad \\text{in } \\Omega=(0,1)\n$$\nwith $u(0)=g_0$ and $u(1)=g_1$.\n\nTo handle the non-homogeneous Dirichlet boundary conditions, we decompose the solution $u$ into a lifting function $\\ell$ that satisfies the boundary conditions and a new unknown $v$ that has homogeneous boundary conditions:\n$$\nu(x) = v(x) + \\ell(x)\n$$\nHere, $v \\in H_0^1(\\Omega)$, meaning $v(0)=v(1)=0$, and $\\ell \\in H^1(\\Omega)$ satisfies $\\ell(0)=g_0$ and $\\ell(1)=g_1$. Substituting this decomposition into the differential equation and using the linearity of the operator $L$, we get:\n$$\nL(v + \\ell) = L v + L \\ell = f\n$$\nThis results in a problem for $v$ with a modified right-hand side and homogeneous boundary conditions:\n$$\nL v = f - L \\ell \\quad \\text{in } \\Omega=(0,1), \\quad v(0)=v(1)=0\n$$\nThe standard weak form is found by multiplying by a test function $w \\in H_0^1(\\Omega)$ and integrating over $\\Omega$: Find $v \\in H_0^1(\\Omega)$ such that\n$$\nB(w, v) = \\int_0^1 w(x)(f(x)-L\\ell(x))\\,dx \\quad \\forall w \\in H_0^1(\\Omega)\n$$\nwhere $B(w,v) = \\int_0^1 (-\\nu w v'' + a w v' + \\sigma w v) dx$. Integrating the second-derivative term by parts gives the standard bilinear form: $B(w,v) = \\int_0^1 (\\nu w'v' + a w v' + \\sigma w v) dx$.\n\nIn the VMS method, the solution space $H_0^1(\\Omega)$ is split into a coarse-scale (resolved) subspace $V_H$ and a fine-scale (unresolved) subspace $V'$. The solution $v$ is accordingly decomposed as $v=v_H + v'$, with $v_H \\in V_H$ and $v' \\in V'$. Substituting this into the weak form for $v$ gives:\n$$\nB(w, v_H + v') = \\int_0^1 w(x)(f(x)-L\\ell(x))\\,dx\n$$\nThis equation is then projected onto the coarse and fine spaces. The fine-scale equation is obtained by choosing the test function $w$ from the fine-scale space, i.e., $w=w' \\in V'$:\n$$\nB(w', v_H + v') = \\int_0^1 w'(x)(f(x)-L\\ell(x))\\,dx \\quad \\forall w' \\in V'\n$$\nRearranging to isolate the terms involving the unknown fine-scale component $v'$ on the left-hand side yields:\n$$\nB(w', v') = \\int_0^1 w'(x)(f(x)-L\\ell(x))\\,dx - B(w', v_H)\n$$\nAssuming sufficient regularity on $v_H$, we can integrate by parts on the term $B(w', v_H)$ to recover the strong operator $L$. Since $w' \\in H_0^1(\\Omega)$, the boundary terms from integration by parts vanish, and we have $B(w', v_H) = \\int_0^1 w'(x) L(v_H(x)) dx$. Substituting this back gives:\n$$\nB(w', v') = \\int_0^1 w'(x)(f(x) - L\\ell(x) - L v_H(x))\\,dx\n$$\nUsing the linearity of $L$ again, we combine the terms:\n$$\nB(w', v') = \\int_0^1 w'(x) \\Big( f(x) - L\\big(\\ell(x) + v_H(x)\\big) \\Big)\\,dx\n$$\nThe term $f(x) - L(\\ell(x) + v_H(x))$ is the residual of the original differential equation with respect to the known resolved-scale part of the solution, $\\ell(x)+v_H(x)$. This residual acts as the source term that drives the fine-scale solution $v'$. The problem asks for the spatial average of this term over the element $K=\\Omega$.\n\n### Calculation\nWe are given the following data:\n- Operator $L u = -u'' + 2u' + 3u$, since $\\nu=1, a=2, \\sigma=3$.\n- Forcing term $f(x) = \\exp(x)$.\n- Boundary data $g_0=1$, $g_1=2$.\n- Lifting function $\\ell(x) = 1(1-x) + 2x = 1+x$.\n- Coarse-scale solution component $v_H(x) = 5x(1-x) = 5x - 5x^2$.\n\nLet's compute the total resolved-scale function, $u_H(x) = \\ell(x) + v_H(x)$:\n$$\nu_H(x) = (1+x) + (5x - 5x^2) = -5x^2 + 6x + 1\n$$\nNext, we apply the operator $L$ to $u_H(x)$. We need its first and second derivatives:\n$$\nu_H'(x) = \\frac{d}{dx}(-5x^2 + 6x + 1) = -10x + 6\n$$\n$$\nu_H''(x) = \\frac{d}{dx}(-10x + 6) = -10\n$$\nNow, we compute $L(u_H(x))$:\n$$\nL(u_H(x)) = -u_H''(x) + 2u_H'(x) + 3u_H(x)\n$$\n$$\nL(u_H(x)) = -(-10) + 2(-10x + 6) + 3(-5x^2 + 6x + 1)\n$$\n$$\nL(u_H(x)) = 10 - 20x + 12 - 15x^2 + 18x + 3\n$$\n$$\nL(u_H(x)) = -15x^2 - 2x + 25\n$$\nThe modified residual forcing is $f(x) - L(u_H(x))$:\n$$\nf(x) - L(u_H(x)) = \\exp(x) - (-15x^2 - 2x + 25) = \\exp(x) + 15x^2 + 2x - 25\n$$\nFinally, we compute the element-average of this residual, $R_K$, over the element $K=\\Omega=(0,1)$. Since $|K|=1$, this is simply the integral of the residual over the domain.\n$$\nR_K = \\frac{1}{1} \\int_0^1 \\Big(\\exp(x) + 15x^2 + 2x - 25\\Big)\\,dx\n$$\nWe integrate term by term:\n$$\nR_K = \\left[ \\exp(x) + 15\\frac{x^3}{3} + 2\\frac{x^2}{2} - 25x \\right]_0^1\n$$\n$$\nR_K = \\left[ \\exp(x) + 5x^3 + x^2 - 25x \\right]_0^1\n$$\nEvaluating at the upper and lower limits:\n$$\nR_K = \\Big(\\exp(1) + 5(1)^3 + (1)^2 - 25(1)\\Big) - \\Big(\\exp(0) + 5(0)^3 + (0)^2 - 25(0)\\Big)\n$$\n$$\nR_K = (e + 5 + 1 - 25) - (1 + 0 + 0 - 0)\n$$\n$$\nR_K = (e - 19) - 1\n$$\n$$\nR_K = e - 20\n$$\nThe element-average of the modified residual forcing is $e - 20$.",
            "answer": "$$\\boxed{e - 20}$$"
        }
    ]
}