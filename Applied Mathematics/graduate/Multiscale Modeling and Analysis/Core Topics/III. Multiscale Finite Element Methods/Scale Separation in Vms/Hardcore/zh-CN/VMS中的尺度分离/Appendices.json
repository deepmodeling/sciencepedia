{
    "hands_on_practices": [
        {
            "introduction": "变分多尺度方法（VMS）的核心思想在于对解空间进行分解。第一个练习将通过引导您在一个单元上使用分层基函数，手动构建粗尺度空间 $V_h$ 和细尺度空间 $V'$，从而为您打下坚实的基础。通过计算一个给定函数的分解系数，您将对尺度分离在最基本层面是如何定义和执行的，获得一个具体而切实的理解。",
            "id": "3805281",
            "problem": "考虑变分多尺度方法（VMS），该方法通过作用于一个合适的有限维子空间上的投影算子，将函数空间分解为解析尺度和精细尺度。设参考一维单元为 $K=[-1,1]$，并考虑以下分层基。\n\n定义解析尺度空间 $V_h$ 为与端点相关的线性拉格朗日函数所生成的空间：\n$$\n\\phi_1(x) = \\frac{1-x}{2}, \\qquad \\phi_2(x) = \\frac{1+x}{2}.\n$$\n定义精细尺度空间 $V'$ 为一个在端点处为零的泡状函数所生成的空间：\n$$\n\\psi(x) = 1 - x^2.\n$$\n假设到 $V_h$ 上的投影算子是在 $x=-1$ 和 $x=1$ 处的节点插值算子，因此对于任何足够光滑的函数 $u$，其解析尺度分量 $u_h \\in V_h$ 满足 $u_h(-1) = u(-1)$ 和 $u_h(1)=u(1)$，且精细尺度分量为 $u' = u - u_h \\in V'$。\n\n任务：\n- 使用基本原理（有限维子空间的定义、插值算子和分层基函数的性质），为 $V_h$ 和 $V'$ 构造显式基，并验证 $V_h \\cap V' = \\{0\\}$，从而证明 $V_h \\oplus V'$ 是单元 $K$ 上的一个直和。\n- 给定节点采样值 $u(-1)=2$、$u(0)=1$ 和 $u(1)=3$，在分层表示\n$$\nu(x) \\approx a_1 \\,\\phi_1(x) + a_2 \\,\\phi_2(x) + b \\,\\psi(x),\n$$\n中计算分解系数 $a_1$、$a_2$ 和 $b$，使其与 VMS 尺度分离和给定的插值条件一致。请将你的最终答案以包含三个系数的行矩阵形式给出。无需四舍五入，也不涉及物理单位。",
            "solution": "首先验证该问题，以确保其自洽、有科学依据且适定。给定的信息包括域 $K=[-1,1]$、解析尺度空间 $V_h$ 和精细尺度空间 $V'$ 的定义、到 $V_h$ 的投影算子的定义，以及函数 $u$ 的特定节点值。任务是验证空间的直和性质并计算分层展开的系数。所有元素在有限元和变分多尺度方法的理论中都是标准的，因此该问题是有效的。\n\n我们按要求分两部分进行求解。\n\n第一部分：向量空间 $V_h$ 和 $V'$ 的分析。\n\n解析尺度空间 $V_h$ 定义为函数 $\\phi_1(x) = \\frac{1-x}{2}$ 和 $\\phi_2(x) = \\frac{1+x}{2}$ 所生成的空间。它们是线性无关的多项式（一个是一次，另一个也是一次；它们不是彼此的标量倍数），因此二维空间 $V_h$ 的一个显式基是 $\\{\\phi_1(x), \\phi_2(x)\\}$。\n\n精细尺度空间 $V'$ 定义为函数 $\\psi(x) = 1 - x^2$ 所生成的空间。一维空间 $V'$ 的一个显式基是 $\\{\\psi(x)\\}$。\n\n为了验证 $V_h \\cap V' = \\{0\\}$，我们必须证明同时属于这两个空间的唯一函数是零函数。设 $v(x)$ 是交集中的任意函数，即 $v(x) \\in V_h \\cap V'$。\n\n由于 $v(x) \\in V_h$，它可以表示为 $V_h$ 基函数的线性组合：\n$$\nv(x) = c_1 \\phi_1(x) + c_2 \\phi_2(x)\n$$\n其中 $c_1, c_2 \\in \\mathbb{R}$ 为某些标量系数。\n\n由于 $v(x) \\in V'$，它可以表示为 $V'$ 基函数的标量倍数：\n$$\nv(x) = b \\, \\psi(x)\n$$\n其中 $b \\in \\mathbb{R}$ 为某个标量系数。\n\n$V_h$ 的基函数是与节点 $x_1 = -1$ 和 $x_2 = 1$ 相关联的标准线性拉格朗日多项式。它们具有节点性质 $\\phi_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克（Kronecker）δ函数。具体来说：\n$\\phi_1(-1) = 1$，$\\phi_1(1) = 0$。\n$\\phi_2(-1) = 0$，$\\phi_2(1) = 1$。\n\n$V'$ 的基函数是一个泡状函数，其设计使其在单元 $K$ 的端点处为零：\n$\\psi(-1) = 1 - (-1)^2 = 1 - 1 = 0$。\n$\\psi(1) = 1 - (1)^2 = 1 - 1 = 0$。\n\n如果 $v(x) = b \\, \\psi(x)$，则必有 $v(-1) = b \\, \\psi(-1) = 0$ 和 $v(1) = b \\, \\psi(1) = 0$。\n\n现在，我们在端点处计算来自 $V_h$ 的 $v(x)$ 的表达式：\n在 $x=-1$ 处：$v(-1) = c_1 \\phi_1(-1) + c_2 \\phi_2(-1) = c_1(1) + c_2(0) = c_1$。\n在 $x=1$ 处：$v(1) = c_1 \\phi_1(1) + c_2 \\phi_2(1) = c_1(0) + c_2(1) = c_2$。\n\n将结果等同，我们必须有 $c_1 = 0$ 和 $c_2 = 0$。将这些系数代回到来自 $V_h$ 的 $v(x)$ 表达式中，得到：\n$$\nv(x) = 0 \\cdot \\phi_1(x) + 0 \\cdot \\phi_2(x) = 0\n$$\n对于所有 $x \\in K$。因此，交集 $V_h \\cap V'$ 中的唯一函数是零函数。这证实了这两个空间的和是直和，记为 $V = V_h \\oplus V'$。\n\n第二部分：分解系数的计算。\n\n我们需要找到分层表示 $u_{V}(x)$ 的系数 $a_1, a_2, b$，该表示逼近一个与给定节点值一致的函数 $u(x)$：\n$$\nu_{V}(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x) + b \\psi(x)\n$$\n题目给出了 $u(x)$ 的三个采样值：$u(-1)=2$，$u(0)=1$ 和 $u(1)=3$。我们要求近似值 $u_V(x)$ 在相应节点处与这些值匹配：\n$u_V(-1) = 2$\n$u_V(0) = 1$\n$u_V(1) = 3$\n\n这就产生了一个关于三个未知系数 $a_1, a_2, b$ 的三元线性方程组。为了建立这个系统，我们在节点 $x \\in \\{-1, 0, 1\\}$ 处计算基函数的值：\n$\\phi_1(-1) = 1$，$\\phi_1(0) = \\frac{1-0}{2} = \\frac{1}{2}$，$\\phi_1(1) = 0$。\n$\\phi_2(-1) = 0$，$\\phi_2(0) = \\frac{1+0}{2} = \\frac{1}{2}$，$\\phi_2(1) = 1$。\n$\\psi(-1) = 0$，$\\psi(0) = 1 - 0^2 = 1$，$\\psi(1) = 0$。\n\n将这些值代入每个节点处的近似方程中：\n\n1.  在 $x = -1$ 处：\n    $u_V(-1) = a_1 \\phi_1(-1) + a_2 \\phi_2(-1) + b \\psi(-1) = a_1(1) + a_2(0) + b(0) = a_1$。\n    由于给定 $u(-1)=2$，我们有 $a_1 = 2$。\n\n2.  在 $x = 1$ 处：\n    $u_V(1) = a_1 \\phi_1(1) + a_2 \\phi_2(1) + b \\psi(1) = a_1(0) + a_2(1) + b(0) = a_2$。\n    由于给定 $u(1)=3$，我们有 $a_2 = 3$。\n\n这些结果与所描述的 VMS 框架是一致的，其中解析尺度分量 $u_h(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x)$ 由投影算子确定，而该投影算子是端点处的节点插值。因此，$u_h(-1)=u(-1)=2$ 意味着 $a_1=2$，而 $u_h(1)=u(1)=3$ 意味着 $a_2=3$。\n\n3.  在 $x = 0$ 处：\n    $u_V(0) = a_1 \\phi_1(0) + a_2 \\phi_2(0) + b \\psi(0) = a_1(\\frac{1}{2}) + a_2(\\frac{1}{2}) + b(1)$。\n    由于给定 $u(0)=1$，我们得到方程：\n    $$\n    \\frac{1}{2} a_1 + \\frac{1}{2} a_2 + b = 1\n    $$\n    我们将已知的 $a_1=2$ 和 $a_2=3$ 的值代入此方程以求解 $b$：\n    $$\n    \\frac{1}{2}(2) + \\frac{1}{2}(3) + b = 1\n    $$\n    $$\n    1 + \\frac{3}{2} + b = 1\n    $$\n    $$\n    \\frac{5}{2} + b = 1\n    $$\n    $$\n    b = 1 - \\frac{5}{2} = \\frac{2}{2} - \\frac{5}{2} = -\\frac{3}{2}\n    $$\n因此，分解系数为 $a_1=2$，$a_2=3$ 和 $b = -\\frac{3}{2}$。精细尺度分量是 $u'(x) = u_V(x) - u_h(x) = -\\frac{3}{2}\\psi(x)$。\n最终答案是系数集合 $(a_1, a_2, b)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 & 3 & -\\frac{3}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "尺度分离之后，下一个关键步骤是理解细尺度如何影响粗尺度。本练习将演示一个关键的VMS技术：使用气泡函数作为局部细尺度，并通过静态凝聚（static condensation）将其消除。该过程将明确推导出粗尺度方程中经过修正的“稳定化”刚度矩阵和载荷向量，揭示了细尺度效应是如何被系统地整合回已解尺度问题中的。",
            "id": "3805260",
            "problem": "考虑区间 $[0,1]$ 上的一个一维稳态对流-扩散边界值问题，该问题具有常系数和常数源项，由微分算子 $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$ 控制，其中 $\\nu > 0$ 是扩散系数，$a \\in \\mathbb{R}$ 是对流速度，$f \\in \\mathbb{R}$ 是一个常数源项。使用一个在 $x = 0$、$x = 0.5$ 和 $x = 1$ 处有节点的双单元网格来离散化该域，得到两个尺寸分别为 $h_1 = 0.5$ 和 $h_2 = 0.5$ 的单元。在每个单元上，使用单个内部气泡函数来扩充常规的线性 Lagrange 试探空间，并使用包含粗尺度和气泡（细尺度）试探函数及权函数的 Galerkin 公式。具体来说，在局部仿射坐标 $\\xi \\in [0,1]$ 中的每个单元上，定义线性形函数 $N_1(\\xi) = 1 - \\xi$、$N_2(\\xi) = \\xi$ 和气泡函数 $N_b(\\xi) = 4 \\xi (1 - \\xi)$，其映射为 $x(\\xi)$ 使得 $dx = h \\, d\\xi$。对于这个扩充单元空间，写出与双线性形式 $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$ 相关联的局部单元刚度矩阵 $K_e$，以及与线性形式 $\\int_e w \\, f \\, dx$ 相关联的局部单元载荷向量 $F_e$，其中 $'$ 表示关于 $x$ 的微分，$w$ 和 $u$ 是在 $\\{N_1, N_2, N_b\\}$ 中展开的检验函数和试探函数。\n\n执行静态凝聚以消除每个单元上的气泡自由度。将单元刚度矩阵和载荷向量显式地划分为与排序 $\\{N_1, N_2, N_b\\}$ 一致的粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块。然后推导由 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$ 给出的凝聚后粗尺度刚度矩阵和载荷向量，其中 $F_{cc}$ 表示限制在 $\\{N_1, N_2\\}$ 上的载荷的粗尺度部分，$F_b$ 是载荷的气泡分量。确保所有积分都得到精确计算，并且所有中间符号运算都与仿射映射保持一致。\n\n遵循变分多尺度方法 (Variational Multiscale Method, VMS) 的尺度分离原理，其中富含气泡的细尺度被代数消去，其影响被投影到粗尺度上。仅从形函数、双线性形式和线性形式以及静态凝聚法则的定义出发，推导出以 $a$、$\\nu$、$h$ 和 $f$ 表示的凝聚后粗尺度刚度和载荷的显式表达式。然后实现一个程序，对于给定的具有 $h_1 = 0.5$ 和 $h_2 = 0.5$ 的双单元网格，为每个单元计算：\n- 凝聚后的 $2 \\times 2$ 刚度矩阵 $K_{e}^{\\text{cond}}$，以行主序展平形式 $[K_{11}, K_{12}, K_{21}, K_{22}]$ 表示，和\n- 凝聚后的 $2 \\times 1$ 载荷向量 $F_{e}^{\\text{cond}}$，以展平形式 $[F_1, F_2]$ 表示。\n\n您的程序必须为以下参数集 $(a, \\nu, f)$ 测试套件精确计算这些量：\n- 测试用例 1 (happy path): $(a, \\nu, f) = (1.0, 0.01, 1.0)$。\n- 测试用例 2 (diffusion-dominant boundary condition case): $(a, \\nu, f) = (0.1, 1.0, 2.0)$。\n- 测试用例 3 (advection-dominant edge case): $(a, \\nu, f) = (2.5, 0.001, -0.5)$。\n\n对于此纯数学公式，所有量都是无量纲的；不需要物理单位。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，格式如下：\n- 对于每个测试用例，输出一个包含四个子列表的列表，分别对应单元 1 的凝聚刚度（展平）、单元 1 的凝聚载荷（展平）、单元 2 的凝聚刚度（展平）和单元 2 的凝聚载荷（展平）。\n- 总体输出是三个每个测试用例列表的列表，因此最终输出的形式为 $[[\\ldots],[\\ldots],[\\ldots]]$，其中每个内部列表严格按照指定顺序包含四个子列表。\n\n推导中不允许使用任何捷径或预先提供的公式；计算必须遵循上述基本定义和静态凝聚操作。",
            "solution": "该问题是有效的，因为它科学地基于计算流体动力学和有限元法（Finite Element Method, FEM）的原理，特别是变分多尺度（Variational Multiscale, VMS）方法。该问题是适定的、客观的、自洽的，并且需要基于基本原理进行非平凡的推导和实现，因此是一项合适的任务。\n\n求解过程首先为扩充空间推导单元刚度矩阵和载荷向量，然后执行静态凝聚以获得粗尺度算子。\n\n一维稳态对流-扩散方程由下式给出：\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\n其中 $\\nu > 0$，$a \\in \\mathbb{R}$ 和 $f \\in \\mathbb{R}$ 是常数。\n\n在尺寸为 $h$ 的单个单元 $e$ 上的弱形式是找到 $u \\in V_h$，使得对于所有 $w \\in V_h$：\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\n单元上的空间 $V_h$ 由基函数 $\\{N_1, N_2, N_b\\}$ 张成。在局部坐标 $\\xi \\in [0, 1]$ 中，它们是：\n- 线性形函数：$N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- 气泡形函数：$N_b(\\xi) = 4\\xi(1 - \\xi)$\n\n全局坐标 $x$ 和局部坐标 $\\xi$ 之间的关系由仿射映射 $x(\\xi) = x_1 + h\\xi$ 给出，其中 $x_1$ 是单元的起始坐标。这给出了微分关系 $dx = h \\, d\\xi$ 和 $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$。用 $'$ 表示关于 $x$ 的微分，用点号表示关于 $\\xi$ 的微分，我们有 $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$。\n\n基函数关于 $\\xi$ 的导数为：\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\n$3 \\times 3$ 单元刚度矩阵 $K_e$ 和 $3 \\times 1$ 载荷向量 $F_e$ 的项由下式给出：\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\n变换到局部坐标：\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\n我们计算所需的积分：\n**与扩散相关的积分 ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\n刚度矩阵的扩散部分是 $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 16/3 \\end{pmatrix}$。\n\n**与对流相关的积分 ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\n刚度矩阵的对流部分是 $K^{a} = a \\begin{pmatrix} -1/2 & 1/2 & 2/3 \\\\ -1/2 & 1/2 & -2/3 \\\\ -2/3 & 2/3 & 0 \\end{pmatrix}$。\n\n**与载荷相关的积分 ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\n完整的载荷向量是 $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$。\n\n总单元矩阵 $K_e = K^\\nu + K^a$ 是：\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} & \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} & -\\frac{2a}{3} \\\\\n-\\frac{2a}{3} & \\frac{2a}{3} & \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\n总单元向量 $F_e$ 是：\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\n对于静态凝聚，我们根据基的排序 $\\{N_1, N_2, N_b\\}$ 将它们划分为粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块：\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3 & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\n凝聚后的算子是 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$。\n首先，$K_{bb}^{-1} = \\frac{3h}{16\\nu}$。\n\n刚度修正项为 $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$：\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3} & \\frac{2a}{3} \\end{pmatrix} = \\frac{3ha^2}{16\\nu} \\begin{pmatrix} -4/9 & 4/9 \\\\ 4/9 & -4/9 \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\n凝聚后的刚度矩阵是 $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$：\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu} & -\\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu} & \\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\n载荷修正项为 $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$：\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{12afh^2}{144\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\n凝聚后的载荷向量是 $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$：\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\n这些推导出的公式在以下代码中实现。对于两个单元，$h=0.5$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        # delta_K_term = (h * a^2) / (12 * nu)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        # delta_F_term = (a * f * h^2) / (12 * nu)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    # The required output format is a custom string representation of a list of lists,\n    # where the sub-list __str__ representations are joined by commas.\n    # The provided skeleton code `print(f\"[{','.join(map(str, results))}]\")`\n    # produces a representation where spaces after commas within sub-lists are\n    # preserved, but commas between the main list items have no trailing space.\n    # To match typical compact JSON/Python list representation, we would remove all spaces.\n    # However, to be perfectly compliant with the skeleton, we will use it.\n    # A cleaner alternative would be `str(results).replace(\" \", \"\")`, but the\n    # skeleton's logic is followed here.\n    \n    # Custom string formatting to avoid spaces between list elements\n    # and to match the desired compact output. This is a bit more manual \n    # than the skeleton, but ensures no spaces at all.\n    def format_list_compactly(l):\n        return f\"[{','.join(str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\"\n\n    print(final_output_string)\n\n\nsolve()\n```"
        },
        {
            "introduction": "在许多VMS公式中，细尺度解被建模为与控制方程的残差成正比。本练习旨在加深您对这一概念的理解，它将展示如何为一个带有非齐次边界条件的问题构建完整的残差。您将学习如何使用提升函数（lifting function），并看到驱动细尺度的残差实际上是由源项、粗尺度解以及提升函数本身共同构成的。",
            "id": "3805324",
            "problem": "考虑单位区间 $\\Omega = (0,1)$ 上的稳态一维对流-扩散-反应边值问题：\n$$\n-\\nu\\,u''(x) + a\\,u'(x) + \\sigma\\,u(x) = f(x)\\quad\\text{在 }\\Omega\\text{ 内},\n$$\n其非齐次 Dirichlet 边界条件为 $u(0)=g_0$ 和 $u(1)=g_1$，其中 $\\nu>0$, $a\\in\\mathbb{R}$, 且 $\\sigma\\ge 0$ 为常数。令 $L u := -\\nu\\,u'' + a\\,u' + \\sigma\\,u$ 表示该微分算子。引入一个提升函数 $\\ell\\in H^1(\\Omega)$，使得 $\\ell(0)=g_0$ 和 $\\ell(1)=g_1$，并定义齐次变量 $v := u - \\ell \\in H_0^1(\\Omega)$。从强形式和标准的 Galerkin 弱形式出发，执行变分多尺度方法 (Variational Multiscale Method, VMS) 分解 $v = v_H + v'$，其中 $v_H$ 位于有限维已解空间 $V_H \\subset H_0^1(\\Omega)$ 中，而 $v'$ 位于互补的细尺度空间 $V'$ 中，并推导细尺度变分方程，该方程通过提升函数 $\\ell$ 识别由非齐次边界数据产生的修正残差驱动力。\n\n在通常的单元-气泡闭合假设下，其中细尺度右端项取为修正残差的单元平均值，将问题具体化到单个单元 $K=\\Omega$ 和以下数据：\n$$\n\\nu = 1,\\quad a = 2,\\quad \\sigma = 3,\\quad f(x)=\\exp(x),\\quad g_0=1,\\quad g_1=2,\\quad \\ell(x)=g_0(1-x)+g_1 x,\\quad v_H(x)=5\\,x(1-x).\n$$\n计算修正残差驱动力的单元平均值\n$$\nR_K \\;:=\\; \\frac{1}{|K|}\\int_{K}\\Big(f(x) - L\\big(\\ell(x)+v_H(x)\\big)\\Big)\\,dx,\n$$\n其中对于 $K=\\Omega=(0,1)$ 有 $|K|=1$。请将您的最终结果表示为单个封闭形式的解析表达式。无需四舍五入。",
            "solution": "用户提供了一个来自数值分析领域的问题，具体涉及一维边值问题的变分多尺度方法 (VMS)。在进行求解之前，需要对问题陈述进行全面验证。\n\n### 步骤1：提取已知条件\n从问题陈述中逐字提取已知条件：\n- **微分方程：** 在域 $\\Omega = (0,1)$ 上为 $-\\nu\\,u''(x) + a\\,u'(x) + \\sigma\\,u(x) = f(x)$。\n- **边界条件：** $u(0)=g_0$ 和 $u(1)=g_1$。\n- **常数：** $\\nu>0$, $a\\in\\mathbb{R}$, $\\sigma\\ge 0$。\n- **微分算子：** $L u := -\\nu\\,u'' + a\\,u' + \\sigma\\,u$。\n- **齐次化：** 使用一个提升函数 $\\ell\\in H^1(\\Omega)$（满足 $\\ell(0)=g_0$ 和 $\\ell(1)=g_1$）来定义 $v := u - \\ell \\in H_0^1(\\Omega)$。\n- **VMS 分解：** $v = v_H + v'$，其中 $v_H \\in V_H \\subset H_0^1(\\Omega)$ 且 $v' \\in V'$。\n- **用于计算的具体数据：**\n  - $\\nu = 1$\n  - $a = 2$\n  - $\\sigma = 3$\n  - $f(x)=\\exp(x)$\n  - $g_0=1$, $g_1=2$\n  - $\\ell(x)=g_0(1-x)+g_1 x$\n  - $v_H(x)=5\\,x(1-x)$\n- **目标量：** 修正残差驱动力的单元平均值，对于单个单元 $K=\\Omega=(0,1)$ 定义为 $R_K \\;:=\\; \\frac{1}{|K|}\\int_{K}\\Big(f(x) - L\\big(\\ell(x)+v_H(x)\\big)\\Big)\\,dx$，其中 $|K|=1$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据指定标准对问题进行验证。\n\n- **科学性：** 该问题是变分多尺度方法在线性对流-扩散-反应方程上的标准应用。这是计算力学和数值分析中一个成熟的课题。VMS 框架、使用提升函数处理非齐次 Dirichlet 条件以及残差的概念都是标准的、数学上合理的。该问题在科学上是有效的。\n- **适定性：** 所有必要的函数、参数和边界条件都已明确定义。任务是执行特定的推导和计算，而不是找到未知函数 $u(x)$，但所提供的信息对于要求的任务是充分的。该问题是适定的。\n- **客观性：** 问题以精确的数学语言陈述，没有主观或模糊的术语。\n- **完整性和一致性：** 所提供的数据是自洽且一致的。例如，指定的提升函数 $\\ell(x)$ 正确满足边界条件：$\\ell(0)=g_0(1-0)+g_1(0) = g_0=1$ 和 $\\ell(1)=g_0(1-1)+g_1(1)=g_1=2$。指定的粗尺度函数 $v_H(x)=5x(1-x)$ 正确满足齐次边界条件 $v_H(0)=0$ 和 $v_H(1)=0$，这符合 $V_H \\subset H_0^1(\\Omega)$ 成员的要求。\n- **无其他缺陷：** 该问题并非不切实际、不适定、微不足道或无法验证。这是一个标准的、形式化的练习题。\n\n### 步骤3：结论与行动\n问题是**有效的**。将提供解答。\n\n### 解答推导\n目标是计算修正残差驱动力在域 $\\Omega=(0,1)$ 上的平均值。首先，我们概述在 VMS 框架内此残差项的推导过程。\n\n该边值问题的强形式为：\n$$\nL u = f \\quad \\text{在 } \\Omega=(0,1) \\text{ 内}\n$$\n其中 $u(0)=g_0$ 且 $u(1)=g_1$。\n\n为了处理非齐次 Dirichlet 边界条件，我们将解 $u$ 分解为一个满足边界条件的提升函数 $\\ell$ 和一个具有齐次边界条件的新未知量 $v$：\n$$\nu(x) = v(x) + \\ell(x)\n$$\n这里，$v \\in H_0^1(\\Omega)$，意味着 $v(0)=v(1)=0$，而 $\\ell \\in H^1(\\Omega)$ 满足 $\\ell(0)=g_0$ 和 $\\ell(1)=g_1$。将此分解代入微分方程，并利用算子 $L$ 的线性性质，我们得到：\n$$\nL(v + \\ell) = L v + L \\ell = f\n$$\n这得到了一个关于 $v$ 的问题，其右端项被修正，且边界条件为齐次：\n$$\nL v = f - L \\ell \\quad \\text{在 } \\Omega=(0,1) \\text{ 内}, \\quad v(0)=v(1)=0\n$$\n标准的弱形式是通过乘以一个测试函数 $w \\in H_0^1(\\Omega)$ 并在 $\\Omega$ 上积分得到的：求 $v \\in H_0^1(\\Omega)$ 使得\n$$\nB(w, v) = \\int_0^1 w(x)(f(x)-L\\ell(x))\\,dx \\quad \\forall w \\in H_0^1(\\Omega)\n$$\n其中 $B(w,v) = \\int_0^1 (-\\nu w v'' + a w v' + \\sigma w v) dx$。对二阶导数项进行分部积分，得到标准的双线性形式：$B(w,v) = \\int_0^1 (\\nu w'v' + a w v' + \\sigma w v) dx$。\n\n在 VMS 方法中，解空间 $H_0^1(\\Omega)$ 被分解为一个粗尺度（已解）子空间 $V_H$ 和一个细尺度（未解）子空间 $V'$。解 $v$ 也相应地分解为 $v=v_H + v'$，其中 $v_H \\in V_H$ 且 $v' \\in V'$。将此代入 $v$ 的弱形式，得到：\n$$\nB(w, v_H + v') = \\int_0^1 w(x)(f(x)-L\\ell(x))\\,dx\n$$\n然后将此方程投影到粗尺度和细尺度空间上。通过从细尺度空间中选择测试函数 $w$，即 $w=w' \\in V'$，可以得到细尺度方程：\n$$\nB(w', v_H + v') = \\int_0^1 w'(x)(f(x)-L\\ell(x))\\,dx \\quad \\forall w' \\in V'\n$$\n重新整理，将包含未知细尺度分量 $v'$ 的项分离到左侧，得到：\n$$\nB(w', v') = \\int_0^1 w'(x)(f(x)-L\\ell(x))\\,dx - B(w', v_H)\n$$\n假设 $v_H$ 具有足够的光滑性，我们可以对 $B(w', v_H)$ 项进行分部积分以恢复强算子 $L$。由于 $w' \\in H_0^1(\\Omega)$，分部积分产生的边界项为零，我们有 $B(w', v_H) = \\int_0^1 w'(x) L(v_H(x)) dx$。将其代回得到：\n$$\nB(w', v') = \\int_0^1 w'(x)(f(x) - L\\ell(x) - L v_H(x))\\,dx\n$$\n再次利用 $L$ 的线性性质，我们合并这些项：\n$$\nB(w', v') = \\int_0^1 w'(x) \\Big( f(x) - L\\big(\\ell(x) + v_H(x)\\big) \\Big)\\,dx\n$$\n项 $f(x) - L(\\ell(x) + v_H(x))$ 是原始微分方程相对于解的已知已解尺度部分 $\\ell(x)+v_H(x)$ 的残差。该残差作为驱动细尺度解 $v'$ 的源项。问题要求计算此项在单元 $K=\\Omega$ 上的空间平均值。\n\n### 计算\n我们已知以下数据：\n- 算子 $L u = -u'' + 2u' + 3u$，因为 $\\nu=1, a=2, \\sigma=3$。\n- 驱动项 $f(x) = \\exp(x)$。\n- 边界数据 $g_0=1$, $g_1=2$。\n- 提升函数 $\\ell(x) = 1(1-x) + 2x = 1+x$。\n- 粗尺度解分量 $v_H(x) = 5x(1-x) = 5x - 5x^2$。\n\n我们来计算总的已解尺度函数 $u_H(x) = \\ell(x) + v_H(x)$：\n$$\nu_H(x) = (1+x) + (5x - 5x^2) = -5x^2 + 6x + 1\n$$\n接下来，我们将算子 $L$ 应用于 $u_H(x)$。我们需要它的一阶和二阶导数：\n$$\nu_H'(x) = \\frac{d}{dx}(-5x^2 + 6x + 1) = -10x + 6\n$$\n$$\nu_H''(x) = \\frac{d}{dx}(-10x + 6) = -10\n$$\n现在，我们计算 $L(u_H(x))$：\n$$\nL(u_H(x)) = -u_H''(x) + 2u_H'(x) + 3u_H(x)\n$$\n$$\nL(u_H(x)) = -(-10) + 2(-10x + 6) + 3(-5x^2 + 6x + 1)\n$$\n$$\nL(u_H(x)) = 10 - 20x + 12 - 15x^2 + 18x + 3\n$$\n$$\nL(u_H(x)) = -15x^2 - 2x + 25\n$$\n修正的残差驱动力为 $f(x) - L(u_H(x))$：\n$$\nf(x) - L(u_H(x)) = \\exp(x) - (-15x^2 - 2x + 25) = \\exp(x) + 15x^2 + 2x - 25\n$$\n最后，我们计算该残差在单元 $K=\\Omega=(0,1)$ 上的单元平均值 $R_K$。由于 $|K|=1$，这即为该残差在域上的积分。\n$$\nR_K = \\frac{1}{1} \\int_0^1 \\Big(\\exp(x) + 15x^2 + 2x - 25\\Big)\\,dx\n$$\n我们逐项积分：\n$$\nR_K = \\left[ \\exp(x) + 15\\frac{x^3}{3} + 2\\frac{x^2}{2} - 25x \\right]_0^1\n$$\n$$\nR_K = \\left[ \\exp(x) + 5x^3 + x^2 - 25x \\right]_0^1\n$$\n代入上下限求值：\n$$\nR_K = \\Big(\\exp(1) + 5(1)^3 + (1)^2 - 25(1)\\Big) - \\Big(\\exp(0) + 5(0)^3 + (0)^2 - 25(0)\\Big)\n$$\n$$\nR_K = (e + 5 + 1 - 25) - (1 + 0 + 0 - 0)\n$$\n$$\nR_K = (e - 19) - 1\n$$\n$$\nR_K = e - 20\n$$\n修正残差驱动力的单元平均值为 $e - 20$。",
            "answer": "$$\\boxed{e - 20}$$"
        }
    ]
}