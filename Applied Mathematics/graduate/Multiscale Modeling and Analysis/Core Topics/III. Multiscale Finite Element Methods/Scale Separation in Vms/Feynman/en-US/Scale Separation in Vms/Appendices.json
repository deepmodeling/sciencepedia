{
    "hands_on_practices": [
        {
            "introduction": "The core idea of the Variational Multiscale method is the formal decomposition of a solution space into resolved (coarse) and unresolved (fine) scales. This exercise  provides a foundational, hands-on opportunity to work directly with this concept. By using a simple hierarchical basis on a one-dimensional element, you will verify the properties of this decomposition and compute the explicit components of a sample function, making the abstract theory of scale separation tangible.",
            "id": "3805281",
            "problem": "Consider the Variational Multiscale Method (VMS), which decomposes a function space into resolved scales and fine scales through a projector that acts on a suitable finite-dimensional subspace. Let the reference one-dimensional element be $K=[-1,1]$ and consider the following hierarchical bases.\n\nDefine the resolved-scale space $V_h$ as the span of the linear Lagrange functions associated with the endpoints:\n$$\n\\phi_1(x) = \\frac{1-x}{2}, \\qquad \\phi_2(x) = \\frac{1+x}{2}.\n$$\nDefine the fine-scale space $V'$ as the span of a bubble function that vanishes at the endpoints:\n$$\n\\psi(x) = 1 - x^2.\n$$\nAssume the projector onto $V_h$ is the nodal interpolation operator at $x=-1$ and $x=1$, so that for any sufficiently smooth $u$, the resolved-scale component $u_h \\in V_h$ satisfies $u_h(-1) = u(-1)$ and $u_h(1)=u(1)$, and the fine-scale component is $u' = u - u_h \\in V'$.\n\nTasks:\n- Using first principles (definitions of finite-dimensional subspaces, interpolation operators, and the properties of hierarchical basis functions), construct explicit bases for $V_h$ and $V'$, and verify that $V_h \\cap V' = \\{0\\}$ so that $V_h \\oplus V'$ is a direct sum on the element $K$.\n- Given the nodal samples $u(-1)=2$, $u(0)=1$, and $u(1)=3$, compute the decomposition coefficients $a_1$, $a_2$, and $b$ in the hierarchical representation\n$$\nu(x) \\approx a_1 \\,\\phi_1(x) + a_2 \\,\\phi_2(x) + b \\,\\psi(x),\n$$\nconsistent with the VMS scale separation and the stated interpolation conditions. Provide your final answer as a row matrix containing the three coefficients. No rounding is required, and no physical units are involved.",
            "solution": "The problem is first validated to ensure it is self-contained, scientifically grounded, and well-posed. The given information includes the domain $K=[-1,1]$, definitions for the resolved-scale space $V_h$ and the fine-scale space $V'$, a definition for the projector onto $V_h$, and specific nodal values of a function $u$. The tasks are to verify the direct sum property of the spaces and to compute the coefficients of a hierarchical expansion. All elements are standard in the theory of finite element and variational multiscale methods, rendering the problem valid.\n\nWe proceed with the solution, which consists of two parts as requested.\n\nPart 1: Analysis of the vector spaces $V_h$ and $V'$.\n\nThe resolved-scale space $V_h$ is defined as the span of the functions $\\phi_1(x) = \\frac{1-x}{2}$ and $\\phi_2(x) = \\frac{1+x}{2}$. These are linearly independent polynomials (one is of degree $1$, the other is of degree $1$; they are not scalar multiples of each other), so an explicit basis for the two-dimensional space $V_h$ is $\\{\\phi_1(x), \\phi_2(x)\\}$.\n\nThe fine-scale space $V'$ is defined as the span of the function $\\psi(x) = 1 - x^2$. An explicit basis for the one-dimensional space $V'$ is $\\{\\psi(x)\\}$.\n\nTo verify that $V_h \\cap V' = \\{0\\}$, we must show that the only function belonging to both spaces is the zero function. Let $v(x)$ be an arbitrary function in the intersection, $v(x) \\in V_h \\cap V'$.\n\nSince $v(x) \\in V_h$, it can be expressed as a linear combination of the basis functions of $V_h$:\n$$\nv(x) = c_1 \\phi_1(x) + c_2 \\phi_2(x)\n$$\nfor some scalar coefficients $c_1, c_2 \\in \\mathbb{R}$.\n\nSince $v(x) \\in V'$, it can be expressed as a scalar multiple of the basis function of $V'$:\n$$\nv(x) = b \\, \\psi(x)\n$$\nfor some scalar coefficient $b \\in \\mathbb{R}$.\n\nThe basis functions for $V_h$ are the standard linear Lagrange polynomials associated with the nodes $x_1 = -1$ and $x_2 = 1$. They have the nodal property $\\phi_i(x_j) = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta. Specifically:\n$\\phi_1(-1) = 1$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(1) = 1$.\n\nThe basis function for $V'$ is a bubble function, designed to vanish at the endpoints of the element $K$:\n$\\psi(-1) = 1 - (-1)^2 = 1 - 1 = 0$.\n$\\psi(1) = 1 - (1)^2 = 1 - 1 = 0$.\n\nIf $v(x) = b \\, \\psi(x)$, then it must hold that $v(-1) = b \\, \\psi(-1) = 0$ and $v(1) = b \\, \\psi(1) = 0$.\n\nNow, we evaluate the expression for $v(x)$ from $V_h$ at the endpoints:\nAt $x=-1$: $v(-1) = c_1 \\phi_1(-1) + c_2 \\phi_2(-1) = c_1(1) + c_2(0) = c_1$.\nAt $x=1$: $v(1) = c_1 \\phi_1(1) + c_2 \\phi_2(1) = c_1(0) + c_2(1) = c_2$.\n\nEquating the results, we must have $c_1 = 0$ and $c_2 = 0$. Substituting these coefficients back into the expression for $v(x)$ from $V_h$ gives:\n$$\nv(x) = 0 \\cdot \\phi_1(x) + 0 \\cdot \\phi_2(x) = 0\n$$\nfor all $x \\in K$. Thus, the only function in the intersection $V_h \\cap V'$ is the zero function. This confirms that the sum of the spaces is a direct sum, denoted $V = V_h \\oplus V'$.\n\nPart 2: Computation of the decomposition coefficients.\n\nWe are asked to find the coefficients $a_1, a_2, b$ for the hierarchical representation $u_{V}(x)$ that approximates a function $u(x)$ consistent with the given nodal values:\n$$\nu_{V}(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x) + b \\psi(x)\n$$\nThe problem provides three sample values of $u(x)$: $u(-1)=2$, $u(0)=1$, and $u(1)=3$. We enforce that the approximation $u_V(x)$ matches these values at the corresponding nodes:\n$u_V(-1) = 2$\n$u_V(0) = 1$\n$u_V(1) = 3$\n\nThis yields a system of three linear equations for the three unknown coefficients $a_1, a_2, b$. To build this system, we evaluate the basis functions at the nodes $x \\in \\{-1, 0, 1\\}$:\n$\\phi_1(-1) = 1$, $\\phi_1(0) = \\frac{1-0}{2} = \\frac{1}{2}$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(0) = \\frac{1+0}{2} = \\frac{1}{2}$, $\\phi_2(1) = 1$.\n$\\psi(-1) = 0$, $\\psi(0) = 1 - 0^2 = 1$, $\\psi(1) = 0$.\n\nSubstituting these values into the approximation equation at each node:\n\n1.  At $x = -1$:\n    $u_V(-1) = a_1 \\phi_1(-1) + a_2 \\phi_2(-1) + b \\psi(-1) = a_1(1) + a_2(0) + b(0) = a_1$.\n    Given $u(-1)=2$, we have $a_1 = 2$.\n\n2.  At $x = 1$:\n    $u_V(1) = a_1 \\phi_1(1) + a_2 \\phi_2(1) + b \\psi(1) = a_1(0) + a_2(1) + b(0) = a_2$.\n    Given $u(1)=3$, we have $a_2 = 3$.\n\nThese results are consistent with the VMS framework described, where the resolved-scale component $u_h(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x)$ is determined by the projection operator, which is nodal interpolation at the endpoints. Thus, $u_h(-1)=u(-1)=2$ implies $a_1=2$, and $u_h(1)=u(1)=3$ implies $a_2=3$.\n\n3.  At $x = 0$:\n    $u_V(0) = a_1 \\phi_1(0) + a_2 \\phi_2(0) + b \\psi(0) = a_1(\\frac{1}{2}) + a_2(\\frac{1}{2}) + b(1)$.\n    Given $u(0)=1$, we have the equation:\n    $$\n    \\frac{1}{2} a_1 + \\frac{1}{2} a_2 + b = 1\n    $$\n    We substitute the known values of $a_1=2$ and $a_2=3$ into this equation to solve for $b$:\n    $$\n    \\frac{1}{2}(2) + \\frac{1}{2}(3) + b = 1\n    $$\n    $$\n    1 + \\frac{3}{2} + b = 1\n    $$\n    $$\n    \\frac{5}{2} + b = 1\n    $$\n    $$\n    b = 1 - \\frac{5}{2} = \\frac{2}{2} - \\frac{5}{2} = -\\frac{3}{2}\n    $$\nThe decomposition coefficients are therefore $a_1=2$, $a_2=3$, and $b = -\\frac{3}{2}$. The fine-scale component is $u'(x) = u_V(x) - u_h(x) = -\\frac{3}{2}\\psi(x)$.\nThe final answer is the set of coefficients $(a_1, a_2, b)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 & 3 & -\\frac{3}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The power of scale separation becomes evident when applied to solving differential equations, where it leads to more accurate and stable numerical models. This practice  demonstrates this by guiding you through the formal elimination of fine scales for a 1D diffusion problem. By deriving the modified coarse-scale equation, you will identify how the fine scales consistently alter the problem's right-hand side, a fundamental mechanism behind VMS-based stabilization.",
            "id": "3805319",
            "problem": "Consider the one-dimensional diffusion problem with constant diffusivity $\\nu > 0$ on the domain $(0,L)$ with homogeneous Dirichlet boundary conditions. The strong form is $-(\\nu u')' = f$ in $(0,L)$ with $u(0) = 0$ and $u(L) = 0$. Let $L = 2$, and let the computational mesh consist of two uniform elements with nodes at $x_0 = 0$, $x_1 = 1$, and $x_2 = 2$. Let $\\mathcal{V}_h$ be the space of continuous, piecewise-linear functions subordinate to this mesh that vanish at $x_0$ and $x_2$, and let $\\mathcal{V}'$ be the space of functions that are supported element-wise and vanish on each element boundary (bubble-type fine scales). Adopt the Variational Multiscale (VMS) decomposition with $u = u_h + u'$ and $w = w_h + w'$, where $u_h, w_h \\in \\mathcal{V}_h$ and $u', w' \\in \\mathcal{V}'$.\n\nStarting from the weak form $\\int_{0}^{L} \\nu u' w' \\, dx = \\int_{0}^{L} f w \\, dx$ for all $w \\in H_0^1(0,L)$ and using the VMS split along with the choice of $\\mathcal{V}'$ that enforces zero traces of $u'$ and $w'$ on element boundaries, derive the coarse-scale equation obtained after eliminating the fine scales $u'$ locally at the element level. Identify explicitly the term in the coarse-scale equation that represents the consistent modification of the coarse-scale right-hand side (load functional) caused by the eliminated fine scales.\n\nThen, for the specific data $\\nu = 1$ and $f(x) \\equiv 1$ on $(0,2)$, compute the modified coarse-scale load vector entry associated with the interior node at $x_1 = 1$. Use the standard nodal test function in $\\mathcal{V}_h$ associated with $x_1$ to define this entry. Provide the final answer as a single exact number without units.",
            "solution": "The user wants me to solve a problem in the context of the Variational Multiscale (VMS) method. I will begin by validating the problem statement.\n\n### Step 1: Extract Givens\n-   **Equation:** One-dimensional diffusion problem, $-(\\nu u')' = f$, on the domain $(0, L)$.\n-   **Parameters:** Constant diffusivity $\\nu > 0$, domain length $L = 2$.\n-   **Boundary Conditions:** Homogeneous Dirichlet, $u(0) = 0$ and $u(L) = 0$.\n-   **Mesh:** Two uniform elements with nodes at $x_0 = 0$, $x_1 = 1$, and $x_2 = 2$. The elements are $K_1 = (0,1)$ and $K_2 = (1,2)$.\n-   **Coarse-scale Space $\\mathcal{V}_h$:** Continuous, piecewise-linear functions subordinate to the mesh, vanishing at $x_0$ and $x_2$.\n-   **Fine-scale Space $\\mathcal{V}'$:** Functions supported element-wise that vanish on each element boundary.\n-   **VMS Decomposition:** $u = u_h + u'$ and $w = w_h + w'$, with $u_h, w_h \\in \\mathcal{V}_h$ and $u', w' \\in \\mathcal{V}'$.\n-   **Weak Form:** $\\int_{0}^{L} \\nu u' w' \\, dx = \\int_{0}^{L} f w \\, dx$ for all $w \\in H_0^1(0,L)$.\n-   **Task 1:** Derive the coarse-scale equation after eliminating the fine scales $u'$.\n-   **Task 2:** Identify the modification to the coarse-scale right-hand side (load functional).\n-   **Task 3:** For $\\nu = 1$ and $f(x) \\equiv 1$, compute the modified coarse-scale load vector entry for the interior node at $x_1 = 1$, using the standard nodal basis function as the test function.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, rooted in the theory of finite element methods and multiscale modeling, specifically the Variational Multiscale method. It is well-posed, providing a clear differential equation, domain, boundary conditions, and definitions of the function spaces required for the VMS decomposition. All necessary data ($\\nu=1$, $f(x)=1$, mesh definition) for the final calculation are provided. The language is objective and mathematically precise. The problem is not trivial, as it requires a step-by-step application of the VMS framework to a concrete example. The problem is self-contained and internally consistent.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with the solution.\n\n### Derivation of the VMS Equations\n\nThe weak form of the problem is to find $u \\in H_0^1(0,L)$ such that for all $w \\in H_0^1(0,L)$:\n$$B(u, w) = (f, w)$$\nwhere the bilinear form is $B(u, w) = \\int_0^L \\nu u' w' dx$ and the linear functional is $(f, w) = \\int_0^L f w dx$.\n\nWe introduce the VMS decomposition for the solution $u = u_h + u'$ and the test function $w = w_h + w'$ into the weak form:\n$$B(u_h + u', w_h + w') = (f, w_h + w')$$\nUsing the bilinearity of $B(\\cdot, \\cdot)$ and linearity of $(\\cdot, \\cdot)$, we expand the equation:\n$$B(u_h, w_h) + B(u_h, w') + B(u', w_h) + B(u', w') = (f, w_h) + (f, w')$$\nThis single equation is equivalent to a system of two equations by choosing the test functions from the coarse and fine spaces independently.\n\n1.  **Coarse-scale equation** (set $w' = 0$, so $w = w_h \\in \\mathcal{V}_h$):\n    $$B(u_h, w_h) + B(u', w_h) = (f, w_h) \\quad \\forall w_h \\in \\mathcal{V}_h$$\n\n2.  **Fine-scale equation** (set $w_h = 0$, so $w = w' \\in \\mathcal{V}'$):\n    $$B(u_h, w') + B(u', w') = (f, w') \\quad \\forall w' \\in \\mathcal{V}'$$\n\nThe space $\\mathcal{V}'$ consists of functions supported on single elements $K_e$ and vanishing at element boundaries. The coarse space $\\mathcal{V}_h$ consists of continuous piecewise-linear functions. On any element $K_e$, the derivative of a coarse-scale function $(u_h)'$ is a constant. The derivative of a fine-scale test function $(w')'$ is an $L^2(K_e)$ function. The integral of $(w')'$ over $K_e$ is $[w']_{\\partial K_e}$, which is zero by definition of $\\mathcal{V}'$. Therefore, the term $B(u_h, w')$ simplifies:\n$$B(u_h, w') = \\sum_e \\int_{K_e} \\nu (u_h)' (w')' dx = \\sum_e \\nu (u_h)'|_{K_e} \\int_{K_e} (w')' dx = \\sum_e \\nu (u_h)'|_{K_e} [w']_{\\partial K_e} = 0$$\nThis property, a form of Galerkin orthogonality between the coarse-scale gradient and the fine-scale gradient, is a key feature of this specific VMS formulation.\n\nWith $B(u_h, w') = 0$, the fine-scale equation is decoupled from the coarse scales and becomes:\n$$B(u', w') = (f, w') \\quad \\forall w' \\in \\mathcal{V}'$$\nSince functions in $\\mathcal{V}'$ have disjoint support element-wise, this problem can be solved locally on each element $K_e$ for the fine-scale component $u'_e$:\n$$B_e(u'_e, w'_e) = (f, w'_e)_e \\quad \\forall w'_e \\in \\mathcal{V}'_e$$\nwhere $B_e(\\cdot, \\cdot)$ and $(\\cdot, \\cdot)_e$ denote the forms restricted to element $K_e$. The strong form of this local problem is $-(\\nu u'_e)' = f$ on $K_e$ with homogeneous Dirichlet conditions $u'_e(\\partial K_e)=0$.\n\nThe fine scales $u' = \\sum_e u'_e$ are now determined solely by the source term $f$. We substitute this back into the coarse-scale equation:\n$$B(u_h, w_h) = (f, w_h) - B(u', w_h)$$\nThis is the final coarse-scale equation. The right-hand side represents the modified load functional. The term $-B(u', w_h)$ is the modification caused by the eliminated fine scales. The problem requires computing the value of this modified right-hand side for a specific test function.\n\n### Computation for the Specific Case\n\nWe are given $L = 2$, $\\nu=1$, and $f(x)=1$. The mesh has two elements, $K_1 = (0,1)$ and $K_2 = (1,2)$. The only interior node is $x_1=1$. The coarse space $\\mathcal{V}_h$ is a one-dimensional space spanned by the nodal basis function (hat function) $\\phi_1(x)$ associated with the node $x_1=1$:\n$$\n\\phi_1(x) =\n\\begin{cases}\n    x, & x \\in [0,1] \\\\\n    2-x, & x \\in [1,2] \\\\\n    0, & \\text{otherwise}\n\\end{cases}\n$$\nThe derivative of this function is:\n$$\n\\phi_1'(x) =\n\\begin{cases}\n    1, & x \\in (0,1) \\\\\n    -1, & x \\in (1,2)\n\\end{cases}\n$$\nWe need to compute the modified load vector entry corresponding to the test function $w_h = \\phi_1(x)$. This entry is given by:\n$$F_{mod}(\\phi_1) = (f, \\phi_1) - B(u', \\phi_1) = \\int_0^2 f(x) \\phi_1(x) dx - \\int_0^2 \\nu (u')'(\\phi_1)' dx$$\n\nFirst, we solve for the fine-scale functions $u'_e$ on each element.\n**On element $K_1 = (0,1)$:** We solve $-\\nu(u_1')'' = f \\implies -1 \\cdot (u_1')'' = 1$, with $u_1'(0) = 0$ and $u_1'(1) = 0$.\nIntegrating twice: $(u_1')' = -x + C_1$ and $u_1'(x) = -\\frac{x^2}{2} + C_1 x + C_2$.\nApplying boundary conditions:\n$u_1'(0) = C_2 = 0$.\n$u_1'(1) = -\\frac{1}{2} + C_1 = 0 \\implies C_1 = \\frac{1}{2}$.\nThus, $u_1'(x) = \\frac{1}{2}x(1-x)$ and its derivative is $(u_1')'(x) = -x + \\frac{1}{2}$.\n\n**On element $K_2 = (1,2)$:** We solve $-1 \\cdot (u_2')'' = 1$, with $u_2'(1) = 0$ and $u_2'(2) = 0$.\nUsing a local coordinate $\\xi = x-1 \\in (0,1)$, the problem is identical to the one on $K_1$. The solution is $u_2'(\\xi) = \\frac{1}{2}\\xi(1-\\xi)$.\nIn the global coordinate $x$, this is $u_2'(x) = \\frac{1}{2}(x-1)(1-(x-1)) = \\frac{1}{2}(x-1)(2-x)$.\nThe derivative is $(u_2')'(x) = \\frac{1}{2}((2-x) - (x-1)) = \\frac{1}{2}(3-2x) = -x + \\frac{3}{2}$.\n\nNow we compute the two terms in $F_{mod}(\\phi_1)$.\n\n1.  **Standard load term $(f, \\phi_1)$**:\n    $$(f, \\phi_1) = \\int_0^2 1 \\cdot \\phi_1(x) dx = \\int_0^1 x \\, dx + \\int_1^2 (2-x) \\, dx$$\n    $$\\int_0^1 x \\, dx = \\left[\\frac{x^2}{2}\\right]_0^1 = \\frac{1}{2}$$\n    $$\\int_1^2 (2-x) \\, dx = \\left[2x - \\frac{x^2}{2}\\right]_1^2 = \\left(4 - \\frac{4}{2}\\right) - \\left(2 - \\frac{1}{2}\\right) = 2 - \\frac{3}{2} = \\frac{1}{2}$$\n    So, $(f, \\phi_1) = \\frac{1}{2} + \\frac{1}{2} = 1$.\n\n2.  **Fine-scale modification term $-B(u', \\phi_1)$**:\n    First, we compute $B(u', \\phi_1) = \\int_0^2 \\nu (u')' (\\phi_1)' dx$ with $\\nu=1$.\n    $$B(u', \\phi_1) = \\int_0^1 (u_1')'(x) (\\phi_1)'(x) dx + \\int_1^2 (u_2')'(x) (\\phi_1)'(x) dx$$\n    $$B(u', \\phi_1) = \\int_0^1 \\left(-x + \\frac{1}{2}\\right)(1) dx + \\int_1^2 \\left(-x + \\frac{3}{2}\\right)(-1) dx$$\n    $$\\int_0^1 \\left(-x + \\frac{1}{2}\\right) dx = \\left[-\\frac{x^2}{2} + \\frac{x}{2}\\right]_0^1 = \\left(-\\frac{1}{2} + \\frac{1}{2}\\right) - 0 = 0$$\n    $$\\int_1^2 \\left(x - \\frac{3}{2}\\right) dx = \\left[\\frac{x^2}{2} - \\frac{3x}{2}\\right]_1^2 = \\left(\\frac{4}{2} - \\frac{6}{2}\\right) - \\left(\\frac{1}{2} - \\frac{3}{2}\\right) = -1 - (-1) = 0$$\n    So, $B(u', \\phi_1) = 0 + 0 = 0$.\n\nThe modification to the load vector entry from the fine scales is zero in this specific case. This occurs because the forcing term $f(x)$ is constant on each element, which results in a fine-scale solution $u'_e$ whose derivative $(u'_e)'$ has a zero average over the element.\n\nFinally, the modified coarse-scale load vector entry is:\n$$F_{mod}(\\phi_1) = (f, \\phi_1) - B(u', \\phi_1) = 1 - 0 = 1$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "To apply VMS in a finite element code, the abstract concept of fine-scale elimination must be translated into a concrete algebraic procedure. This practice  bridges theory and computation by focusing on static condensation, the key technique for handling bubble-based fine scales. You will derive the modified coarse-scale stiffness matrix and load vector for an advection-diffusion problem and then implement these formulas, gaining direct experience in how VMS stabilization is realized in practice.",
            "id": "3805260",
            "problem": "Consider the one-dimensional steady advection-diffusion boundary value problem on the interval $[0,1]$ with constant coefficients and a constant source, governed by the differential operator $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$, where $\\nu > 0$ is the diffusion coefficient, $a \\in \\mathbb{R}$ is the advection velocity, and $f \\in \\mathbb{R}$ is a constant source. Discretize the domain using a two-element mesh with nodes at $x = 0$, $x = 0.5$, and $x = 1$, yielding two elements with sizes $h_1 = 0.5$ and $h_2 = 0.5$. On each element, augment the usual linear Lagrange trial space with a single interior bubble function, and use the Galerkin formulation that includes both coarse and bubble (fine-scale) trial and weighting functions. Specifically, on each element in the local affine coordinate $\\xi \\in [0,1]$, define the linear shape functions $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$, and the bubble function $N_b(\\xi) = 4 \\xi (1 - \\xi)$, with the mapping $x(\\xi)$ such that $dx = h \\, d\\xi$. For this augmented element space, write the local element stiffness matrix $K_e$ associated with the bilinear form $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$, and the local element load vector $F_e$ associated with the linear form $\\int_e w \\, f \\, dx$, where $'$ denotes differentiation with respect to $x$, and $w$ and $u$ are test and trial functions expanded in $\\{N_1, N_2, N_b\\}$.\n\nPerform static condensation to eliminate the bubble degree of freedom on each element. Explicitly partition the element stiffness and load into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks consistent with the ordering $\\{N_1, N_2, N_b\\}$. Then derive the condensed coarse-scale stiffness matrix and load vector given by $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$, where $F_{cc}$ denotes the coarse-scale part of the load restricted to $\\{N_1, N_2\\}$, and $F_b$ is the bubble component of the load. Ensure that all integrals are evaluated exactly and that all intermediate symbolic operations are done consistently with the affine mapping.\n\nFollow the scale separation principle of the Variational Multiscale Method (VMS), where the bubble-enriched fine scale is algebraically eliminated and its effect is projected onto the coarse scale. Starting only from the definitions of the shape functions, the bilinear and linear forms, and the static condensation rule, derive the explicit condensed coarse-scale stiffness and load expressions in terms of $a$, $\\nu$, $h$, and $f$. Then implement a program that, for the given two-element mesh with $h_1 = 0.5$ and $h_2 = 0.5$, computes for each element:\n- the condensed $2 \\times 2$ stiffness matrix $K_{e}^{\\text{cond}}$ in row-major flattened form $[K_{11}, K_{12}, K_{21}, K_{22}]$, and\n- the condensed $2 \\times 1$ load vector $F_{e}^{\\text{cond}}$ in flattened form $[F_1, F_2]$.\n\nYour program must evaluate these quantities exactly for the following test suite of parameter sets $(a, \\nu, f)$:\n- Test case 1 (happy path): $(a, \\nu, f) = (1.0, 0.01, 1.0)$.\n- Test case 2 (diffusion-dominant boundary condition case): $(a, \\nu, f) = (0.1, 1.0, 2.0)$.\n- Test case 3 (advection-dominant edge case): $(a, \\nu, f) = (2.5, 0.001, -0.5)$.\n\nAll quantities are dimensionless for this purely mathematical formulation; no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format:\n- For each test case, output a list containing four sublists, corresponding to element $1$ condensed stiffness (flattened), element $1$ condensed load (flattened), element $2$ condensed stiffness (flattened), and element $2$ condensed load (flattened).\n- The overall output is a list of the three per-test-case lists, so the final output has the form $[[\\ldots],[\\ldots],[\\ldots]]$ where each inner list has exactly four sublists in the specified order.\n\nNo shortcuts or pre-supplied formulas are permitted in your derivation; the computation must follow from the fundamental definitions given above and the static condensation operation.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics and the Finite Element Method (FEM), specifically the Variational Multiscale (VMS) approach. The problem is well-posed, objective, self-contained, and requires a non-trivial derivation and implementation based on fundamental principles, making it a suitable task.\n\nThe solution proceeds by first deriving the element stiffness matrix and load vector for an augmented space, and then performing static condensation to obtain the coarse-scale operators.\n\nThe one-dimensional steady advection-diffusion equation is given by:\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\nwhere $\\nu > 0$, $a \\in \\mathbb{R}$, and $f \\in \\mathbb{R}$ are constants.\n\nThe weak form over a single element $e$ of size $h$ is to find $u \\in V_h$ such that for all $w \\in V_h$:\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\nThe space $V_h$ on the element is spanned by the basis functions $\\{N_1, N_2, N_b\\}$. In the local coordinate $\\xi \\in [0, 1]$, these are:\n- Linear shape functions: $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- Bubble shape function: $N_b(\\xi) = 4\\xi(1 - \\xi)$\n\nThe relationship between the global coordinate $x$ and local coordinate $\\xi$ is given by the affine mapping $x(\\xi) = x_1 + h\\xi$, where $x_1$ is the start coordinate of the element. This gives the differential relationships $dx = h \\, d\\xi$ and $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$. Denoting differentiation with respect to $x$ by $'$ and with respect to $\\xi$ by a dot, we have $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$.\n\nThe derivatives of the basis functions with respect to $\\xi$ are:\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\nThe $3 \\times 3$ element stiffness matrix $K_e$ and $3 \\times 1$ load vector $F_e$ have entries given by:\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\nChanging to local coordinates:\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\nWe compute the required integrals:\n**Diffusion-related integrals ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\nThe diffusion part of the stiffness matrix is $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 16/3 \\end{pmatrix}$.\n\n**Advection-related integrals ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\nThe advection part of the stiffness matrix is $K^{a} = a \\begin{pmatrix} -1/2 & 1/2 & 2/3 \\\\ -1/2 & 1/2 & -2/3 \\\\ -2/3 & 2/3 & 0 \\end{pmatrix}$.\n\n**Load-related integrals ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\nThe complete load vector is $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$.\n\nThe total element matrix $K_e = K^\\nu + K^a$ is:\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} & \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} & -\\frac{2a}{3} \\\\\n-\\frac{2a}{3} & \\frac{2a}{3} & \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\nThe total element vector $F_e$ is:\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\nFor static condensation, we partition these into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks, corresponding to the basis ordering $\\{N_1, N_2, N_b\\}$:\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3 & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\nThe condensed operators are $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$.\nFirst, $K_{bb}^{-1} = \\frac{3h}{16\\nu}$.\n\nThe stiffness modification is $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$:\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3} & \\frac{2a}{3} \\end{pmatrix} = \\frac{3h}{16\\nu} \\frac{4a^2}{9} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\nThe condensed stiffness matrix is $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$:\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu} & -\\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu} & \\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\nThe load modification is $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$:\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{12afh^2}{144\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\nThe condensed load vector is $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$:\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\nThese derived formulas are implemented in the following code. For both elements, $h=0.5$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2.0\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        # delta_K_term = (h * a^2) / (12 * nu)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        # delta_F_term = (a * f * h^2) / (12 * nu)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    # The required output format is a custom string representation of a list of lists,\n    # where the sub-list __str__ representations are joined by commas.\n    # The provided skeleton code `print(f\"[{','.join(map(str, results))}]\")`\n    # produces a representation where spaces after commas within sub-lists are\n    # preserved, but commas between the main list items have no trailing space.\n    # To match typical compact JSON/Python list representation, we would remove all spaces.\n    # However, to be perfectly compliant with the skeleton, we will use it.\n    # A cleaner alternative would be `str(results).replace(\" \", \"\")`, but the\n    # skeleton's logic is followed here.\n    \n    # Custom string formatting to avoid spaces between list elements\n    # and to match the desired compact output. This is a bit more manual \n    # than the skeleton, but ensures no spaces at all.\n    def format_list_compactly(l):\n        return f\"[{','.join(str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\"\n\n    print(final_output_string)\n\n\nsolve()\n```"
        }
    ]
}