{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a foundational look into the origin of ghost forces. You will derive the equilibrium equations for a simple one-dimensional atomistic-continuum model from its energy functional. By applying a uniform deformation, you will analytically compute the non-zero residual force—the ghost force—that arises at the interface, revealing how an inconsistent energy formulation violates mechanical equilibrium. This practice is crucial for understanding that ghost forces are not numerical errors, but artifacts inherent to the model's construction .",
            "id": "3765543",
            "problem": "Consider a $1$-dimensional harmonic chain of atoms indexed by $i \\in \\{-N_{\\mathrm{a}},\\ldots,-1,0,1,\\ldots,M\\}$ with reference lattice spacing $a>0$. Let the deformed positions be $y_i \\in \\mathbb{R}$, and assume nearest-neighbor interactions with quadratic bond energy $\\frac{k}{2}\\big((y_{i+1}-y_i)-a\\big)^2$, where $k>0$ is the spring stiffness. The chain is partitioned into an atomistic subregion on the left, $\\mathcal{A}=\\{-N_{\\mathrm{a}},\\ldots,0\\}$, and a continuum subregion on the right, $\\mathcal{C}=\\{1,\\ldots,M\\}$, which is coarsened to a single finite element with nodes at atoms $i=1$ and $i=M$. The continuum energy is modeled by the Cauchy–Born rule: the strain energy density per unit reference length is $W(F)=\\frac{k a}{2}(F-1)^2$, where $F$ is the $1$-dimensional deformation gradient. The atomistic–continuum coupling is defined by the energy-based Quasicontinuum Energy-based (QCE) functional\n$$\n\\mathcal{E}_{\\mathrm{QCE}}(y) \\;=\\; \\sum_{i=-N_{\\mathrm{a}}}^{-1} \\frac{k}{2}\\big((y_{i+1}-y_i)-a\\big)^2 \\;+\\; \\int_{X=a}^{X=M a} W(F)\\,\\mathrm{d}X,\n$$\nwith the continuum element strain $F$ taken piecewise constant over $\\mathcal{C}$ via linear interpolation between the continuum nodes, that is,\n$$\nF \\;=\\; \\frac{y_M - y_1}{(M-1)a}.\n$$\nIn this coupling, the cross-interface bond $(0,1)$ is not included in the atomistic energy, and there is no special interface correction.\n\n(a) Starting from fundamental principles of energy minimization and static equilibrium (zero external body forces), derive the stationarity (equilibrium) equations for the QCE model by computing the first variation of $\\mathcal{E}_{\\mathrm{QCE}}(y)$ with respect to the atomistic degrees of freedom $y_i$ for $i\\in\\{-N_{\\mathrm{a}}+1,\\ldots,0\\}$ and the continuum nodal degrees of freedom $y_1$ and $y_M$.\n\n(b) Consider the homogeneous deformation $y_i=(1+\\epsilon)\\, i\\, a$ with constant strain $\\epsilon \\in \\mathbb{R}$, imposed by Dirichlet boundary conditions at the outermost atoms $y_{-N_{\\mathrm{a}}}=-(1+\\epsilon)N_{\\mathrm{a}}a$ and $y_M=(1+\\epsilon) M a$ and no external forces. Using the QCE equilibrium equations derived in part (a), analytically compute the residual internal force (the ghost force) at the first continuum node $i=1$ under this uniform strain state. Express your final answer for the ghost force in Newtons (N). No rounding is required; provide the exact closed-form expression in terms of $k$, $a$, and $\\epsilon$.",
            "solution": "The solution is presented in two parts as requested.\n\n(a) Derivation of the Stationarity (Equilibrium) Equations\n\nThe Quasicontinuum Energy-based (QCE) functional is given by\n$$\n\\mathcal{E}_{\\mathrm{QCE}}(y) \\;=\\; \\sum_{i=-N_{\\mathrm{a}}}^{-1} \\frac{k}{2}\\big((y_{i+1}-y_i)-a\\big)^2 \\;+\\; \\int_{X=a}^{X=M a} W(F)\\,\\mathrm{d}X\n$$\nwhere $y$ is the vector of all atomic positions $y_i$, the strain energy density is $W(F)=\\frac{k a}{2}(F-1)^2$, and the deformation gradient $F$ is constant over the continuum element, $F = \\frac{y_M - y_1}{(M-1)a}$. The integral can be evaluated directly, as the integrand is constant over the domain of integration $[a, Ma]$ of length $(M-1)a$:\n$$\n\\int_{X=a}^{X=M a} W(F)\\,\\mathrm{d}X = (M-1)a \\cdot W(F) = (M-1)a \\cdot \\frac{k a}{2}(F-1)^2 = \\frac{ka^2(M-1)}{2} \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right)^2.\n$$\nSo the full energy functional can be written as:\n$$\n\\mathcal{E}_{\\mathrm{QCE}}(y) = \\sum_{i=-N_{\\mathrm{a}}}^{-1} \\frac{k}{2}(y_{i+1}-y_i-a)^2 + \\frac{ka^2(M-1)}{2} \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right)^2.\n$$\nThe static equilibrium equations are obtained by requiring the first variation of the energy to be zero, which for a discrete system corresponds to setting the partial derivative of the energy with respect to each unconstrained degree of freedom to zero. The force on atom $j$ is $f_j = -\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_j}$. In equilibrium with no external forces, $f_j=0$, so $\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_j} = 0$.\n\nWe compute these derivatives for the specified nodes.\n\nFor an internal atomistic node $j \\in \\{-N_{\\mathrm{a}}+1, \\ldots, -1\\}$:\nThe position $y_j$ appears in two terms of the atomistic sum: the bond $(j-1, j)$ and the bond $(j, j+1)$.\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_j} = \\frac{\\partial}{\\partial y_j} \\left[ \\frac{k}{2}(y_j-y_{j-1}-a)^2 + \\frac{k}{2}(y_{j+1}-y_j-a)^2 \\right]\n$$\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_j} = k(y_j-y_{j-1}-a)(1) + k(y_{j+1}-y_j-a)(-1) = k(y_j-y_{j-1}-a) - k(y_{j+1}-y_j-a).\n$$\nThe equilibrium equation is: $k(y_j-y_{j-1}-a) - k(y_{j+1}-y_j-a) = 0$.\n\nFor the atomistic interface node $j=0$:\nThe position $y_0$ only appears in the bond $(-1,0)$ within the atomistic sum, as the summation index $i$ goes up to $-1$. The continuum energy does not depend on $y_0$.\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_0} = \\frac{\\partial}{\\partial y_0} \\left[ \\frac{k}{2}(y_0-y_{-1}-a)^2 \\right] = k(y_0-y_{-1}-a).\n$$\nThe equilibrium equation is: $k(y_0-y_{-1}-a) = 0$.\n\nFor the continuum interface node $j=1$:\nThe position $y_1$ only appears in the continuum energy term.\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_1} = \\frac{\\partial}{\\partial y_1} \\left[ \\frac{ka^2(M-1)}{2} \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right)^2 \\right]\n$$\nUsing the chain rule:\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_1} = \\frac{ka^2(M-1)}{2} \\cdot 2 \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) \\cdot \\frac{\\partial}{\\partial y_1}\\left( \\frac{y_M-y_1}{(M-1)a} \\right)\n$$\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_1} = ka^2(M-1) \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) \\left( \\frac{-1}{(M-1)a} \\right) = -ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right).\n$$\nThe equilibrium equation is: $-ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) = 0$.\n\nFor the continuum boundary node $j=M$:\nThe position $y_M$ also only appears in the continuum energy term.\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_M} = \\frac{\\partial}{\\partial y_M} \\left[ \\frac{ka^2(M-1)}{2} \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right)^2 \\right]\n$$\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_M} = ka^2(M-1) \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) \\left( \\frac{1}{(M-1)a} \\right) = ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right).\n$$\nThe equilibrium equation is: $ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) = 0$.\n\n(b) Calculation of the Ghost Force at Node $i=1$\n\nThe residual internal force, or ghost force, at a node $j$ is the net force on that node, $f_j = -\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_j}$, when the system is subjected to a state of uniform deformation that should correspond to a natural equilibrium state. We evaluate this force at node $j=1$ for the homogeneous deformation $y_i=(1+\\epsilon)ia$.\n\nFrom part (a), the partial derivative of the energy with respect to $y_1$ is:\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_1} = -ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right).\n$$\nThe ghost force at node $1$ is therefore:\n$$\nf_{\\text{ghost},1} = - \\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial y_1} \\Bigg|_{y_i=(1+\\epsilon)ia} = ka \\left( \\frac{y_M-y_1}{(M-1)a} - 1 \\right) \\Bigg|_{y_i=(1+\\epsilon)ia}.\n$$\nWe substitute the positions for the homogeneous deformation into this expression. The relevant nodal positions are:\n$$\ny_1 = (1+\\epsilon)(1)a = (1+\\epsilon)a\n$$\n$$\ny_M = (1+\\epsilon)Ma\n$$\nSubstituting these into the expression for the ghost force:\n$$\nf_{\\text{ghost},1} = ka \\left( \\frac{(1+\\epsilon)Ma - (1+\\epsilon)a}{(M-1)a} - 1 \\right)\n$$\nFactor out the common terms in the numerator:\n$$\nf_{\\text{ghost},1} = ka \\left( \\frac{(1+\\epsilon)(M-1)a}{(M-1)a} - 1 \\right)\n$$\nCancel the $(M-1)a$ term:\n$$\nf_{\\text{ghost},1} = ka \\left( (1+\\epsilon) - 1 \\right)\n$$\nThis simplifies to:\n$$\nf_{\\text{ghost},1} = ka\\epsilon.\n$$\nThis non-zero force for $\\epsilon \\neq 0$ is the ghost force at the first continuum node. It signifies that the homogeneous deformation is not an equilibrium state of the QCE model, due to the inconsistent force balance at the interface. The force arises because the interaction between atoms $0$ and $1$ is not represented by a discrete atomistic bond in the energy functional, but is instead implicitly and inconsistently accounted for by the continuum model. The units of the expression are stiffness ($k$, force/length) times length ($a$), which correctly yields units of force, compatible with the request for the answer in Newtons (N).",
            "answer": "$$\\boxed{ka\\epsilon}$$"
        },
        {
            "introduction": "Having seen how inconsistent energy coupling creates ghost forces, this practice explores a direct method for their removal. We will examine a model with longer-range interactions, where the potential for inconsistency is greater. You will analyze a \"Geometrically Consistent Reconstruction\" (GCR) scheme, which is designed to restore force balance across the interface, and analytically prove that it passes the patch test by demonstrating that the interfacial residual force is identically zero under uniform deformation . This exercise highlights the principle of restoring physical consistency to create a robust multiscale method.",
            "id": "3765601",
            "problem": "Consider a one-dimensional crystalline chain with atoms indexed by $i \\in \\mathbb{Z}$, reference lattice spacing $a>0$, and deformation mapping $y_i \\in \\mathbb{R}$. The atomistic interaction energy includes nearest-neighbor and next-nearest-neighbor pair interactions via a smooth pair potential $\\phi \\in C^{1}((0,\\infty))$. In the purely atomistic model, the total energy can be written in a bond-based form as a sum over bonds,\n$$\nE_{\\mathrm{atom}}(y) \\;=\\; \\sum_{i \\in \\mathbb{Z}} \\phi\\!\\left(|y_{i+1}-y_i|\\right) \\;+\\; \\sum_{i \\in \\mathbb{Z}} \\phi\\!\\left(|y_{i+2}-y_i|\\right).\n$$\nIn an atomistic-to-continuum coupling, an interface separates an atomistic subdomain from a continuum subdomain. Place the interface between sites $i=0$ and $i=1$, with the atomistic region on the left ($i \\leq 0$) and the continuum region on the right ($i \\geq 1$). To remove ghost forces, a geometrically consistent reconstruction (GCR) is used for next-nearest-neighbor bonds that cross the interface: the stretch of a next-nearest-neighbor bond is reconstructed as the sum of adjacent nearest-neighbor stretches. Specifically, define the modified interfacial energy that collects all bond contributions involving $y_0$ as\n$$\nE_{\\mathrm{int}}(y) \\;=\\; \\phi\\!\\left(|y_{0}-y_{-1}|\\right) \\;+\\; \\phi\\!\\left(|y_{1}-y_{0}|\\right) \\;+\\; \\phi\\!\\left(|y_{0}-y_{-2}|\\right) \\;+\\; \\phi\\!\\left(\\left|(y_{1}-y_{0})+(y_{0}-y_{-1})\\right|\\right) \\;+\\; \\phi\\!\\left(\\left|(y_{2}-y_{1})+(y_{1}-y_{0})\\right|\\right).\n$$\nThis corresponds to the two nearest-neighbor bonds incident to $i=0$, the left next-nearest-neighbor bond $(i=-2,i=0)$, and the two reconstructed next-nearest-neighbor bonds that cross the interface on either side, namely $(i=-1,i=1)$ and $(i=0,i=2)$, written as sums of nearest-neighbor differences. The remainder of the energy in the continuum region uses the Cauchy–Born rule, but does not affect the interfacial residual at $i=0$ under the uniform deformation considered below.\n\nConsider the homogeneous deformation (patch test) $y_i = F \\, a \\, i$ with a constant deformation gradient $F>0$. Starting from the principle that equilibrium configurations are stationary points of the total energy, the discrete Euler–Lagrange residual at site $i=0$ associated with $E_{\\mathrm{int}}$ is\n$$\nR_0(F) \\;=\\; \\left.\\frac{\\partial E_{\\mathrm{int}}(y)}{\\partial y_0}\\right|_{y_i=F a i}.\n$$\nCompute the reconstructed bond stretches that appear in $E_{\\mathrm{int}}(y)$ under the uniform deformation $y_i = F a i$, and then compute $R_0(F)$ explicitly. Express your final answer as a single real number. No units are required.",
            "solution": "The problem requires the computation of the Euler-Lagrange residual $R_0(F)$ at the interface site $i=0$ for a one-dimensional atomistic-to-continuum model under a homogeneous deformation $y_i = F a i$. The residual is defined as the partial derivative of a specified interfacial energy $E_{\\mathrm{int}}(y)$ with respect to the atomic position $y_0$, evaluated for the given deformation.\n\nThe interfacial energy $E_{\\mathrm{int}}(y)$ is given by:\n$$\nE_{\\mathrm{int}}(y) \\;=\\; \\phi\\!\\left(|y_{0}-y_{-1}|\\right) \\;+\\; \\phi\\!\\left(|y_{1}-y_{0}|\\right) \\;+\\; \\phi\\!\\left(|y_{0}-y_{-2}|\\right) \\;+\\; \\phi\\!\\left(\\left|(y_{1}-y_{0})+(y_{0}-y_{-1})\\right|\\right) \\;+\\; \\phi\\!\\left(\\left|(y_{2}-y_{1})+(y_{1}-y_{0})\\right|\\right)\n$$\nwhere $\\phi \\in C^1((0, \\infty))$ is the pair interaction potential. The residual at site $i=0$ is:\n$$\nR_0(F) \\;=\\; \\left.\\frac{\\partial E_{\\mathrm{int}}(y)}{\\partial y_0}\\right|_{y_i=F a i}\n$$\n\nFirst, we compute the bond stretches (the arguments of $\\phi$) under the homogeneous deformation $y_i = F a i$. Given that $F>0$ and $a>0$, all stretches will be positive.\nThe nearest-neighbor bond stretches are:\n\\begin{itemize}\n    \\item $d_{\\text{nn},1} = |y_0 - y_{-1}| = |F a (0) - F a (-1)| = |F a| = F a$.\n    \\item $d_{\\text{nn},2} = |y_1 - y_0| = |F a (1) - F a (0)| = |F a| = F a$.\n\\end{itemize}\nThe next-nearest-neighbor bond stretches are:\n\\begin{itemize}\n    \\item The non-reconstructed bond stretch: $d_{\\text{nnn},1} = |y_0 - y_{-2}| = |F a (0) - F a (-2)| = |2 F a| = 2 F a$.\n    \\item The first reconstructed bond stretch, corresponding to the bond $(i=-1, i=1)$:\n    $$\n    d_{\\text{nnn},2}^{\\text{recon}} = \\left|(y_{1}-y_{0})+(y_{0}-y_{-1})\\right| = |(F a (1) - F a (0)) + (F a (0) - F a (-1))| = |F a + F a| = 2 F a.\n    $$\n    Note that this matches the true stretch $|y_1 - y_{-1}| = |Fa(1) - Fa(-1)| = |2Fa| = 2Fa$.\n    \\item The second reconstructed bond stretch, corresponding to the bond $(i=0, i=2)$:\n    $$\n    d_{\\text{nnn},3}^{\\text{recon}} = \\left|(y_{2}-y_{1})+(y_{1}-y_{0})\\right| = |(F a (2) - F a (1)) + (F a (1) - F a (0))| = |Fa + Fa| = 2 F a.\n    $$\n    This also matches the true stretch $|y_2 - y_0| = |Fa(2) - Fa(0)| = |2Fa| = 2Fa$.\n\\end{itemize}\nSo, the two reconstructed bond stretches are both $2Fa$.\n\nNext, we compute the residual $R_0(F)$ by differentiating $E_{\\mathrm{int}}(y)$ with respect to $y_0$. Let $\\phi'(r)$ denote the derivative of $\\phi$ with respect to its argument $r$. Using the chain rule for a term of the form $\\phi(|u(y)|)$, we have $\\frac{\\partial}{\\partial y_0}\\phi(|u|) = \\phi'(|u|) \\cdot \\text{sgn}(u) \\cdot \\frac{\\partial u}{\\partial y_0}$.\nUnder the specified deformation, all bond vectors $y_j - y_k$ for $j>k$ are positive, so the sign function $\\text{sgn}(u)$ evaluates to $1$ for all terms.\n\nLet's compute the derivative for each of the five terms in $E_{\\mathrm{int}}(y)$:\n\n1.  Term 1: $\\phi(|y_0 - y_{-1}|)$. Let $u_1(y) = y_0 - y_{-1}$.\n    $\\frac{\\partial u_1}{\\partial y_0} = 1$. Under the deformation, $u_1 = F a > 0$.\n    The contribution to the residual from this term is $\\phi'(|Fa|) \\cdot \\text{sgn}(Fa) \\cdot 1 = \\phi'(Fa)$.\n\n2.  Term 2: $\\phi(|y_1 - y_0|)$. Let $u_2(y) = y_1 - y_0$.\n    $\\frac{\\partial u_2}{\\partial y_0} = -1$. Under the deformation, $u_2 = F a > 0$.\n    The contribution is $\\phi'(|Fa|) \\cdot \\text{sgn}(Fa) \\cdot (-1) = -\\phi'(Fa)$.\n\n3.  Term 3: $\\phi(|y_0 - y_{-2}|)$. Let $u_3(y) = y_0 - y_{-2}$.\n    $\\frac{\\partial u_3}{\\partial y_0} = 1$. Under the deformation, $u_3 = 2Fa > 0$.\n    The contribution is $\\phi'(|2Fa|) \\cdot \\text{sgn}(2Fa) \\cdot 1 = \\phi'(2Fa)$.\n\n4.  Term 4: $\\phi(|(y_1 - y_0) + (y_0 - y_{-1})|)$.\n    This term simplifies to $\\phi(|y_1 - y_{-1}|)$. Since its argument does not depend on $y_0$, its partial derivative with respect to $y_0$ is zero. Let's verify this without simplifying first. Let $u_4(y) = (y_1 - y_0) + (y_0 - y_{-1}) = y_1 - y_{-1}$.\n    $\\frac{\\partial u_4}{\\partial y_0} = -1 + 1 = 0$.\n    The contribution is thus $\\phi'(|u_4|) \\cdot \\text{sgn}(u_4) \\cdot 0 = 0$.\n\n5.  Term 5: $\\phi(|(y_2 - y_1) + (y_1 - y_0)|)$. Let $u_5(y) = (y_2 - y_1) + (y_1 - y_0) = y_2 - y_0$.\n    $\\frac{\\partial u_5}{\\partial y_0} = -1$. Under the deformation, $u_5 = 2Fa > 0$.\n    The contribution is $\\phi'(|2Fa|) \\cdot \\text{sgn}(2Fa) \\cdot (-1) = -\\phi'(2Fa)$.\n\nFinally, we sum all five contributions to find the total residual $R_0(F)$:\n$$\nR_0(F) = \\phi'(Fa) - \\phi'(Fa) + \\phi'(2Fa) + 0 - \\phi'(2Fa)\n$$\nThe terms cancel out pair-wise:\n$$\nR_0(F) = (\\phi'(Fa) - \\phi'(Fa)) + (\\phi'(2Fa) - \\phi'(2Fa)) = 0 + 0 = 0\n$$\nThe residual force on the interface atom $i=0$ under a homogeneous deformation is zero. This result, known as passing the patch test, is a fundamental consistency requirement for an atomistic-to-continuum coupling method. The specific geometrically consistent reconstruction (GCR) scheme described in the problem satisfies this test. The result is independent of the deformation gradient $F$, the lattice spacing $a$, and the specific form of the potential $\\phi$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "This final practice transitions from analytical derivations to a practical computational experiment, illustrating the tangible consequences of ghost forces in a two-dimensional fracture mechanics simulation. You will compare results from a naive Quasicontinuum (QCE) coupling with those from a ghost-force-free Quasi-Nonlocal (QNL) method. By quantifying the error in the calculated Mode III stress intensity factor ($K$), a critical parameter for predicting material failure, you will directly observe how spurious ghost forces can pollute the stress field and compromise the physical accuracy of a simulation .",
            "id": "3765607",
            "problem": "Consider a two-dimensional anti-plane shear lattice model on a square grid that represents a crystalline solid with a semi-infinite crack. The displacement is a scalar field $w$ out of plane. The lattice nodes are indexed by integer coordinates $(x,y)$ with $x,y \\in \\{-L,-L+1,\\dots,L-1,L\\}$ and lattice spacing equal to $1$. Two nearest-neighbor bonds (horizontal and vertical) with identical linear springs of stiffness $k$ connect adjacent nodes. The total atomistic energy for an intact lattice (no crack) is\n$$\n\\mathcal{E}_{\\mathrm{A}}(w) \\;=\\; \\frac{1}{2} k \\sum_{\\langle i,j\\rangle} \\left(w_j - w_i\\right)^2,\n$$\nwhere the sum is over all intact nearest-neighbor bonds $\\langle i,j\\rangle$. Equilibrium displacements minimize $\\mathcal{E}_{\\mathrm{A}}(w)$ subject to boundary conditions, equivalently satisfying the discrete Euler–Lagrange equations given by the balance of linear spring forces. In the continuum limit, the Cauchy–Born rule identifies the energy density\n$$\nW(\\nabla w) \\;=\\; \\frac{\\mu}{2} \\left( \\left(\\frac{\\partial w}{\\partial x}\\right)^2 + \\left(\\frac{\\partial w}{\\partial y}\\right)^2 \\right),\n$$\nwith shear modulus $\\mu = k$, and the corresponding anti-plane equilibrium is $-\\mu \\Delta w = 0$ away from defects.\n\nA crack is introduced by removing all vertical bonds that cross the line $y=0$ for $x \\le -1$, i.e., bonds connecting $(x,0)$ to $(x,-1)$ for all integer $x \\le -1$. The crack tip is thus located at the origin. The specimen is loaded by prescribing a uniform anti-plane shear displacement on the outer boundary $\\partial\\Omega$,\n$$\nw(x,y)\\big|_{\\partial\\Omega} \\;=\\; \\gamma \\, y,\n$$\nfor a given shear parameter $\\gamma > 0$.\n\nWe compare two multiscale coupling methods between an atomistic region $\\mathcal{A}$ and a continuum region $\\mathcal{C}$ for this setting:\n\n- Quasicontinuum Energy-based (QCE): Define the atomistic region $\\mathcal{A} := \\{(x,y): x^2 + y^2 \\le R_{\\mathrm{A}}^2\\}$ and its complement in the computational domain $\\mathcal{C} := \\Omega \\setminus \\mathcal{A}$. The QCE energy is defined as the sum of atomistic bond energies for bonds with both endpoints in $\\mathcal{A}$ plus a continuum Cauchy–Born contribution for bonds with both endpoints in $\\mathcal{C}$. Bonds that cross between $\\mathcal{A}$ and $\\mathcal{C}$ are omitted in the QCE energy. This omission produces nonzero residual forces under uniform strain, known as ghost forces.\n\n- Quasi-Nonlocal (QNL): The QNL energy equals the atomistic bond energy for all bonds that are either entirely inside $\\mathcal{A}$ or crossing between $\\mathcal{A}$ and $\\mathcal{C}$, and uses the continuum Cauchy–Born contribution only for bonds entirely inside $\\mathcal{C}$. With nearest-neighbor linear springs and $\\mu = k$, the QNL energy equals the full atomistic energy for all bonds except those entirely within $\\mathcal{C}$, where the Cauchy–Born contribution coincides with the atomistic one. Therefore, QNL is patch-test consistent and removes ghost forces for uniform strains.\n\nLet the discrete set of intact bonds be $\\mathcal{B}$ after removing crack bonds as described above. For any bond $\\langle i,j\\rangle \\in \\mathcal{B}$, the contribution to the global stiffness has the standard $2\\times 2$ form $k \\begin{bmatrix} 1 & -1 \\\\ -1 & 1\\end{bmatrix}$ in the degrees of freedom corresponding to $i$ and $j$. Let $\\mathcal{B}_{\\mathcal{A}\\mathcal{A}} := \\{\\langle i,j\\rangle \\in \\mathcal{B} : i \\in \\mathcal{A}, j \\in \\mathcal{A}\\}$, $\\mathcal{B}_{\\mathcal{C}\\mathcal{C}} := \\{\\langle i,j\\rangle \\in \\mathcal{B} : i \\in \\mathcal{C}, j \\in \\mathcal{C}\\}$, and $\\mathcal{B}_{\\times} := \\{\\langle i,j\\rangle \\in \\mathcal{B} : i \\in \\mathcal{A}, j \\in \\mathcal{C} \\text{ or } i \\in \\mathcal{C}, j \\in \\mathcal{A}\\}$. Then:\n\n- The QCE stiffness uses $\\mathcal{B}_{\\mathcal{A}\\mathcal{A}} \\cup \\mathcal{B}_{\\mathcal{C}\\mathcal{C}}$.\n\n- The QNL stiffness uses $\\mathcal{B}_{\\mathcal{A}\\mathcal{A}} \\cup \\mathcal{B}_{\\mathcal{C}\\mathcal{C}} \\cup \\mathcal{B}_{\\times}$, i.e., all bonds in $\\mathcal{B}$.\n\nDefine the discrete shear stress magnitude at a cell center $(x+\\tfrac{1}{2}, y+\\tfrac{1}{2})$ by the discrete gradient magnitude\n$$\n\\left|\\nabla_h w\\right|(x+\\tfrac{1}{2}, y+\\tfrac{1}{2}) \\;=\\; \\sqrt{\\left(\\frac{w(x+1,y)+w(x+1,y+1)-w(x,y)-w(x,y+1)}{2}\\right)^2 + \\left(\\frac{w(x,y+1)+w(x+1,y+1)-w(x,y)-w(x+1,y)}{2}\\right)^2},\n$$\nand the corresponding shear stress magnitude $|\\boldsymbol{\\tau}| = \\mu \\left|\\nabla_h w\\right|$.\n\nIn the continuum anti-plane model, the Mode III stress intensity factor $K$ characterizes the near-tip singularity\n$$\n|\\boldsymbol{\\tau}|(r,\\theta) \\;\\approx\\; \\frac{K}{\\sqrt{2\\pi r}} \\quad \\text{as } r \\to 0^+,\n$$\nwhere $(r,\\theta)$ are polar coordinates centered at the crack tip. We estimate $K$ numerically from the discrete solution by sampling ahead of the crack tip in the upper half-plane near the line $\\theta = 0^+$, using\n$$\nK_{\\mathrm{est}} \\;=\\; \\operatorname{mean}_{j \\in \\mathcal{S}} \\left\\{ \\mu \\, \\left|\\nabla_h w\\right|(x_j+\\tfrac{1}{2}, \\tfrac{1}{2}) \\, \\sqrt{2\\pi \\, r_j} \\right\\},\n$$\nwhere $\\mathcal{S}$ is a chosen set of sampling indices ahead of the tip with $x_j \\in \\{1,2,\\dots\\}$ and $r_j = \\sqrt{(x_j+\\tfrac{1}{2})^2 + (\\tfrac{1}{2})^2}$.\n\nGhost forces are quantified under a uniform shear field in an intact lattice (no crack). Let $w^{\\mathrm{uni}}(x,y) = \\gamma y$ be the uniform anti-plane shear field. For QCE on an intact lattice, evaluate the residual force at each interior node\n$$\nf_i^{\\mathrm{QCE}} \\;=\\; -\\left.\\frac{\\partial \\mathcal{E}_{\\mathrm{QCE}}}{\\partial w_i}\\right|_{w = w^{\\mathrm{uni}}},\n$$\nwhich is nonzero only near the atomistic–continuum interface. Define the maximum ghost-force-induced stress scale by\n$$\nG_{\\max} \\;=\\; \\frac{\\max_{i \\,\\mathrm{interior}} |f_i^{\\mathrm{QCE}}|}{\\mu \\, \\gamma}.\n$$\n\nTask: For each test case below, assemble and solve the linear systems corresponding to QCE and QNL for the cracked lattice with the same boundary loading $w = \\gamma y$, and compute:\n\n- The displacement field $w^{\\mathrm{QCE}}$ and $w^{\\mathrm{QNL}}$ on the full grid.\n\n- The Mode III stress intensity factor estimates $K_{\\mathrm{QCE}}$ and $K_{\\mathrm{QNL}}$ by the sampling estimator defined above, with sampling set $\\mathcal{S} = \\{1,2,\\dots,R_{\\mathrm{fit}}\\}$ where $R_{\\mathrm{fit}} = \\min(6, L-2)$.\n\n- The relative error in $K$ for QCE with QNL taken as the reference:\n$$\n\\mathrm{err}_K \\;=\\; \\frac{|K_{\\mathrm{QCE}} - K_{\\mathrm{QNL}}|}{|K_{\\mathrm{QNL}}|}.\n$$\n\n- The maximum ghost-force-induced stress scale $G_{\\max}$ for the same partition but on the intact lattice (no crack), under the uniform field $w^{\\mathrm{uni}} = \\gamma y$.\n\nUse $k = 1$ so that $\\mu = 1$. All quantities are dimensionless. Angles are not directly used. Implement the computations exactly on the discrete grid as described, using linear algebra to impose the Dirichlet boundary conditions on the outer boundary.\n\nTest Suite:\n\n- Test $1$: $L = 15$, $R_{\\mathrm{A}} = 4$, $\\gamma = 0.01$.\n\n- Test $2$: $L = 15$, $R_{\\mathrm{A}} = 2$, $\\gamma = 0.01$.\n\n- Test $3$: $L = 22$, $R_{\\mathrm{A}} = 5$, $\\gamma = 0.02$.\n\nRequired final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be a list of two floats $[\\mathrm{err}_K, G_{\\max}]$ in this order. The overall output must therefore be a list of three such lists, e.g., $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$, with no additional text. All numerical answers are dimensionless floats. Round nothing; print full precision as produced by default string conversion of Python floats.",
            "solution": "### **Methodology and Algorithmic Design**\n\nThe core of the problem is to solve a system of linear equations of the form $\\mathbf{K}\\mathbf{w} = \\mathbf{f}$ for the unknown displacements $\\mathbf{w}$ of the interior lattice nodes. The global stiffness matrix $\\mathbf{K}$ and force vector $\\mathbf{f}$ are constructed based on the principles of the finite element method applied to a discrete lattice.\n\n1.  **Grid and Discretization**:\n    A square grid of $(2L+1) \\times (2L+1)$ nodes is established. A mapping scheme is used to convert two-dimensional coordinates $(x,y)$ to a one-dimensional array index $p$, from $0$ to $(2L+1)^2-1$. Nodes are classified as either *interior* (degrees of freedom to be solved for) or *boundary* (displacements are prescribed). Further, each node is classified as belonging to the atomistic region $\\mathcal{A}$ or the continuum region $\\mathcal{C}$.\n\n2.  **Stiffness Matrix Assembly**:\n    We solve for the displacements of interior nodes. Let the set of interior node indices be $I$ and boundary indices be $B$. The full system of equilibrium equations $\\mathbf{K}_{\\mathrm{full}}\\mathbf{w}_{\\mathrm{full}} = \\mathbf{f}_{\\mathrm{ext}}$ can be partitioned as:\n    $$\n    \\begin{pmatrix} \\mathbf{K}_{II} & \\mathbf{K}_{IB} \\\\ \\mathbf{K}_{BI} & \\mathbf{K}_{BB} \\end{pmatrix} \\begin{pmatrix} \\mathbf{w}_I \\\\ \\mathbf{w}_B \\end{pmatrix} = \\begin{pmatrix} \\mathbf{f}_I \\\\ \\mathbf{f}_B \\end{pmatrix}\n    $$\n    Assuming no external forces on the interior nodes ($\\mathbf{f}_I=0$), the system to solve for the interior displacements $\\mathbf{w}_I$ becomes:\n    $$\n    \\mathbf{K}_{II} \\mathbf{w}_I = -\\mathbf{K}_{IB} \\mathbf{w}_B\n    $$\n    The stiffness matrix $\\mathbf{K}_{II}$ and the right-hand side vector $\\mathbf{b} = -\\mathbf{K}_{IB} \\mathbf{w}_B$ are assembled by iterating over all valid bonds in the model. A bond between nodes $i$ and $j$ contributes $+k$ to the diagonal elements $K_{ii}$ and $K_{jj}$, and $-k$ to the off-diagonal elements $K_{ij}$ and $K_{ji}$. If node $j$ is a boundary node, its displacement $w_j = \\gamma y_j$ is known. The term $-k w_j$ is moved to the right-hand side, contributing $+k w_j$ to the force vector component for node $i$.\n\n    This assembly process is performed twice:\n    -   **QCE**: Includes only bonds in $\\mathcal{B}_{\\mathcal{A}\\mathcal{A}} \\cup \\mathcal{B}_{\\mathcal{C}\\mathcal{C}}$ (i.e., those not crossing the $\\mathcal{A}-\\mathcal{C}$ interface).\n    -   **QNL**: Includes all intact bonds in the cracked lattice.\n\n    The resulting sparse linear systems are solved for the displacement fields.\n\n3.  **Calculation of Stress Intensity Factor ($K_{\\mathrm{QCE}}, K_{\\mathrm{QNL}}$)**:\n    Once the displacement fields $w^{\\mathrm{QCE}}$ and $w^{\\mathrm{QNL}}$ are obtained, the discrete gradient magnitude $|\\nabla_h w|$ is computed for cells just ahead of the crack tip $(x_j > 0, y=0)$. The specified formula is used, which is a centered difference approximation on a unit cell.\n    $$\n    (\\partial_x w)_h = \\frac{w(x+1,y)+w(x+1,y+1)-w(x,y)-w(x,y+1)}{2}, \\quad (\\partial_y w)_h = \\frac{w(x,y+1)+w(x+1,y+1)-w(x,y)-w(x+1,y)}{2}\n    $$\n    The SIF is then estimated by averaging the quantity $\\mu |\\nabla_h w| \\sqrt{2\\pi r}$ over the sampling points specified.\n\n4.  **Calculation of Relative Error ($\\mathrm{err}_K$)**:\n    The relative error is computed directly from the two SIF estimates: $\\mathrm{err}_K = |K_{\\mathrm{QCE}} - K_{\\mathrm{QNL}}| / |K_{\\mathrm{QNL}}|$.\n\n5.  **Calculation of Ghost Force Metric ($G_{\\max}$)**:\n    This metric is calculated on an intact lattice (no crack) under a uniform displacement field $w^{\\mathrm{uni}}(x,y)=\\gamma y$. The residual force on an interior node $i$ for the QCE model is:\n    $$\n    f_i^{\\mathrm{QCE}} = \\sum_{j \\in N_i^{\\mathrm{QCE}}} k(w_j^{\\mathrm{uni}} - w_i^{\\mathrm{uni}}) = k\\gamma \\sum_{j \\in N_i^{\\mathrm{QCE}}} (y_j - y_i)\n    $$\n    where $N_i^{\\mathrm{QCE}}$ are the neighbors of $i$ such that the bond $\\langle i,j \\rangle$ is included in the QCE model (i.e., $j$ is in the same region, $\\mathcal{A}$ or $\\mathcal{C}$, as $i$). The metric $G_{\\max}$ is then:\n    $$\n    G_{\\max} = \\frac{\\max_i |f_i^{\\mathrm{QCE}}|}{\\mu\\gamma} = \\max_i \\left| \\sum_{j \\in N_i^{\\mathrm{QCE}}} (y_j - y_i) \\right|\n    $$\n    This value is computed by iterating through all interior nodes, calculating the sum for each, and finding the maximum of their absolute values. For a nearest-neighbor square lattice, this sum evaluates to an integer. Non-zero values arise only for nodes adjacent to the $\\mathcal{A}-\\mathcal{C}$ interface.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the solving process for all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        {'L': 15, 'R_A': 4, 'gamma': 0.01},\n        {'L': 15, 'R_A': 2, 'gamma': 0.01},\n        {'L': 22, 'R_A': 5, 'gamma': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(**case)\n        results.append(result)\n\n    # Format the final output string as a list of lists of floats.\n    # e.g., [[err_K1,G_max1],[err_K2,G_max2],[err_K3,G_max3]]\n    output_str = '[' + ','.join([f'[{r[0]},{r[1]}]' for r in results]) + ']'\n    print(output_str)\n\ndef solve_case(L, R_A, gamma):\n    \"\"\"\n    Solves the problem for a single specified test case. It computes the relative\n    error in the stress intensity factor (err_K) and the maximum ghost-force\n    induced stress scale (G_max).\n    \"\"\"\n    k = 1.0\n    mu = 1.0\n    side = 2 * L + 1\n    n_nodes = side * side\n    R_A_sq = R_A**2\n\n    # Helper functions for mapping between 2D coordinates and 1D indices\n    def coord_to_idx(x, y):\n        ix, iy = int(round(x)) + L, int(round(y)) + L\n        return iy * side + ix\n\n    def idx_to_coord(idx):\n        iy = idx // side\n        ix = idx % side\n        return float(ix - L), float(iy - L)\n\n    # Pre-compute node properties: interior, in atomistic region A, and mappings\n    is_interior = np.ones(n_nodes, dtype=bool)\n    is_in_A = np.zeros(n_nodes, dtype=bool)\n    interior_indices = []\n    global_to_interior = -np.ones(n_nodes, dtype=int)\n    interior_counter = 0\n\n    for i in range(n_nodes):\n        x, y = idx_to_coord(i)\n        if abs(x) == L or abs(y) == L:\n            is_interior[i] = False\n        else:\n            global_to_interior[i] = interior_counter\n            interior_indices.append(i)\n            interior_counter += 1\n        \n        if x**2 + y**2 <= R_A_sq:\n            is_in_A[i] = True\n    \n    n_interior = len(interior_indices)\n\n    def build_and_solve(use_qce_rule):\n        \"\"\"Builds and solves the linear system for the cracked lattice.\"\"\"\n        K_II = lil_matrix((n_interior, n_interior), dtype=float)\n        b_I = np.zeros(n_interior, dtype=float)\n        \n        for i in interior_indices:\n            i_int_idx = global_to_interior[i]\n            xi, yi = idx_to_coord(i)\n            \n            neighbors_coords = [(xi, yi + 1), (xi, yi - 1), (xi + 1, yi), (xi - 1, yi)]\n            \n            for xj, yj in neighbors_coords:\n                if not (abs(xj) <= L and abs(yj) <= L):\n                    continue\n                j = coord_to_idx(xj, yj)\n\n                is_crack_bond = (xi == xj and xi <= -1 and \n                                 ((yi == 0 and yj == -1) or (yi == -1 and yj == 0)))\n                if is_crack_bond:\n                    continue\n                \n                include_bond = True\n                if use_qce_rule and (is_in_A[i] != is_in_A[j]):\n                    include_bond = False\n\n                if include_bond:\n                    K_II[i_int_idx, i_int_idx] += k\n                    if is_interior[j]:\n                        j_int_idx = global_to_interior[j]\n                        K_II[i_int_idx, j_int_idx] -= k\n                    else:\n                        b_I[i_int_idx] += k * (gamma * yj)\n\n        w_I = spsolve(K_II.tocsr(), b_I)\n        \n        w_full = np.zeros(n_nodes, dtype=float)\n        for i in range(n_nodes):\n            if is_interior[i]:\n                w_full[i] = w_I[global_to_interior[i]]\n            else:\n                x, y = idx_to_coord(i)\n                w_full[i] = gamma * y\n        return w_full\n\n    w_qce = build_and_solve(use_qce_rule=True)\n    w_qnl = build_and_solve(use_qce_rule=False)\n\n    def compute_K_est(w):\n        \"\"\"Estimates the Stress Intensity Factor, K.\"\"\"\n        R_fit = min(6, L - 2)\n        K_samples = []\n        for xj_int in range(1, R_fit + 1):\n            x, y = float(xj_int), 0.0\n            \n            w00 = w[coord_to_idx(x, y)]\n            w10 = w[coord_to_idx(x + 1, y)]\n            w01 = w[coord_to_idx(x, y + 1)]\n            w11 = w[coord_to_idx(x + 1, y + 1)]\n            \n            dw_dx_h = (w10 + w11 - w00 - w01) / 2.0\n            dw_dy_h = (w01 + w11 - w00 - w10) / 2.0\n            grad_w_mag = np.sqrt(dw_dx_h**2 + dw_dy_h**2)\n            \n            rx, ry = x + 0.5, 0.5\n            r_j = np.sqrt(rx**2 + ry**2)\n            \n            K_sample = mu * grad_w_mag * np.sqrt(2 * np.pi * r_j)\n            K_samples.append(K_sample)\n        \n        return np.mean(K_samples) if K_samples else 0.0\n    \n    K_qce = compute_K_est(w_qce)\n    K_qnl = compute_K_est(w_qnl)\n\n    err_K = abs(K_qce - K_qnl) / abs(K_qnl) if abs(K_qnl) > 1e-15 else 0.0\n\n    max_force_term = 0.0\n    for i in interior_indices:\n        xi, yi = idx_to_coord(i)\n        neighbors_coords = [(xi, yi + 1), (xi, yi - 1), (xi + 1, yi), (xi - 1, yi)]\n        force_term = 0.0\n        for xj, yj in neighbors_coords:\n            if not (abs(xj) <= L and abs(yj) <= L):\n                continue\n            j = coord_to_idx(xj, yj)\n            if is_in_A[i] == is_in_A[j]:\n                force_term += (yj - yi)\n        max_force_term = max(max_force_term, abs(force_term))\n    \n    G_max = max_force_term\n\n    return [err_K, G_max]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}