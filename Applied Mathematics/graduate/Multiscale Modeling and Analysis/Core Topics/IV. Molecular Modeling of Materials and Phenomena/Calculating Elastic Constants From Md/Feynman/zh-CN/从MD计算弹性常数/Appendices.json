{
    "hands_on_practices": [
        {
            "introduction": "理论是基础，但真正的理解来自于实践。本节将指导您通过一系列动手实践，将抽象的弹性理论应用于具体问题。我们从最简单但也是最基础的情形——各向同性材料——开始。 该练习旨在从原始的应力-应变张量数据中，利用胡克定律的张量形式，提取出描述材料行为的两个独立弹性参数，并计算体积模量（$K$）、剪切模量（$G$）和泊松比（$\\nu$）等物理上更直观的量。",
            "id": "3739199",
            "problem": "给定一组模拟分子动力学（MD）模拟输出的合成但科学上一致的数据，该数据用于一个承受微小均匀变形的各向同性固体。对于每个指定的微小对称应变张量 $\\boldsymbol{\\varepsilon}^{(s)}$（无量纲），MD模拟返回以吉帕斯卡（GPa）表示的时间平均柯西应力张量 $\\boldsymbol{\\sigma}^{(s)}$。您可以假设小应变线弹性和材料各向同性。从基本定义出发，推导一种策略，从应力-应变数据中估计各向同性线弹性固体的两个独立弹性参数，然后计算体积模量、剪切模量和泊松比。\n\n仅使用以下基础依据：\n- 小应变张量定义为位移梯度的对称部分，柯西应力张量 $\\boldsymbol{\\sigma}$ 作为 $\\boldsymbol{\\varepsilon}$ 的功共轭。\n- 各向同性固体的线弹性，即存在一个四阶刚度张量 $\\mathsf{C}$，使得 $\\boldsymbol{\\sigma} = \\mathsf{C} : \\boldsymbol{\\varepsilon}$。\n- 各向同性假设意味着刚度张量完全由两个独立的标量表征，通常称为拉梅参数。\n- 体积模量的定义为在微小均匀变形下，静水压力与体积应变之间的比例关系。\n- 剪切模量的定义为在纯剪切条件下，剪切应力与剪切应变之间的比例关系。\n- 泊松比在单轴加载和小应变条件下的定义。\n\n您的程序必须实现一个线性估计器，该估计器使用给定的 $(\\boldsymbol{\\varepsilon}^{(s)}, \\boldsymbol{\\sigma}^{(s)})$ 对来推断各向同性固体的两个独立弹性参数，然后计算：\n- 体积模量 $K$，\n- 剪切模量 $G$，\n- 泊松比 $\\nu$。\n\n所有应力单位为吉帕斯卡（GPa），所有应变均为无量纲。您必须以GPa表示 $K$ 和 $G$，并将 $\\nu$ 表示为无量纲小数。每个测试用例的三个输出均需四舍五入到恰好六位小数。\n\n测试套件。对于每个测试用例 $i \\in \\{1,2,3,4\\}$，给定一组采样应变-应力对 $\\{(\\boldsymbol{\\varepsilon}^{(s)}, \\boldsymbol{\\sigma}^{(s)})\\}_{s=1}^{S_i}$：\n\n- 测试用例 1（良态，中等可压缩）：\n  - 样本 1：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.005  0  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 1.1  0  0 \\\\ 0  0.3  0 \\\\ 0  0  0.3 \\end{bmatrix}$。\n  - 样本 2：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.003  0 \\\\ 0.003  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0  0.48  0 \\\\ 0.48  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n  - 样本 3：$\\boldsymbol{\\varepsilon} = 0.002\\,\\mathbf{I} = \\begin{bmatrix} 0.002  0  0 \\\\ 0  0.002  0 \\\\ 0  0  0.002 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = 0.68\\,\\mathbf{I} = \\begin{bmatrix} 0.68  0  0 \\\\ 0  0.68  0 \\\\ 0  0  0.68 \\end{bmatrix}$。\n  - 样本 4：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.004  0  0 \\\\ 0  0.004  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 1.12  0  0 \\\\ 0  1.12  0 \\\\ 0  0  0.48 \\end{bmatrix}$。\n\n- 测试用例 2（近乎不可压缩，数值上具有挑战性）：\n  - 样本 1：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.005  0  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0.51  0  0 \\\\ 0  0.5  0 \\\\ 0  0  0.5 \\end{bmatrix}$。\n  - 样本 2：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.004  0 \\\\ 0.004  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0  0.008  0 \\\\ 0.008  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n  - 样本 3：$\\boldsymbol{\\varepsilon} = 0.002\\,\\mathbf{I}$，$\\boldsymbol{\\sigma} = 0.604\\,\\mathbf{I}$。\n  - 样本 4：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.004  0  0 \\\\ 0  0.004  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0.808  0  0 \\\\ 0  0.808  0 \\\\ 0  0  0.8 \\end{bmatrix}$。\n\n- 测试用例 3（拉胀响应，负泊松比）：\n  - 样本 1：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.005  0  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0.2571428571428571  0  0 \\\\ 0  -0.04285714285714286  0 \\\\ 0  0  -0.04285714285714286 \\end{bmatrix}$。\n  - 样本 2：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0.003  0 \\\\ 0.003  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0  0.18  0 \\\\ 0.18  0  0 \\\\ 0  0  0 \\end{bmatrix}$。\n  - 样本 3：$\\boldsymbol{\\varepsilon} = 0.002\\,\\mathbf{I}$，$\\boldsymbol{\\sigma} = 0.06857142857142858\\,\\mathbf{I}$。\n  - 样本 4：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.004  0  0 \\\\ 0  0.004  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0.17142857142857143  0  0 \\\\ 0  0.17142857142857143  0 \\\\ 0  0  -0.06857142857142858 \\end{bmatrix}$。\n\n- 测试用例 4（最小独立集，精确确定）：\n  - 样本 1：$\\boldsymbol{\\varepsilon} = 0.003\\,\\mathbf{I}$，$\\boldsymbol{\\sigma} = 0.75\\,\\mathbf{I}$。\n  - 样本 2：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0  0  0 \\\\ 0  0  0.006 \\\\ 0  0.006  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0  0  0 \\\\ 0  0  0.6 \\\\ 0  0.6  0 \\end{bmatrix}$。\n  - 样本 3：$\\boldsymbol{\\varepsilon} = \\begin{bmatrix} 0.004  0  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}$，$\\boldsymbol{\\sigma} = \\begin{bmatrix} 0.6  0  0 \\\\ 0  0.2  0 \\\\ 0  0  0.2 \\end{bmatrix}$。\n\n您的程序必须：\n- 从给定的 $\\{(\\boldsymbol{\\varepsilon}^{(s)}, \\boldsymbol{\\sigma}^{(s)})\\}$ 对构建一个线性系统，以估计与各向同性一致的两个独立弹性参数。\n- 根据估计的参数，计算 $K$、$G$ 和 $\\nu$。\n\n最终输出格式：\n- 生成一行输出，包含一个长度为 $4$ 的列表，其中每个元素是测试用例 $i \\in \\{1,2,3,4\\}$ 的列表 $[K_i,G_i,\\nu_i]$。\n- $K_i$ 和 $G_i$ 必须以吉帕斯卡（GPa）为单位，$\\nu_i$ 必须是无量纲的。将每个值四舍五入到恰好六位小数。\n- 该行必须具有确切的格式，如 $[[K_1,G_1,\\nu_1],[K_2,G_2,\\nu_2],[K_3,G_3,\\nu_3],[K_4,G_4,\\nu_4]]$，条目之间用逗号分隔，没有多余的空格或文本。",
            "solution": "该问题要求确定各向同性线弹性固体的体积模量 $K$、剪切模量 $G$ 和泊松比 $\\nu$，给定一组相应的柯西应力张量 $\\boldsymbol{\\sigma}^{(s)}$ 和小应变张量 $\\boldsymbol{\\varepsilon}^{(s)}$。任务的核心是首先从所提供的数据中估计表征此类材料的两个独立弹性参数。\n\n在线弹性中，应力与应变之间的基本关系由胡克定律给出，即 $\\boldsymbol{\\sigma} = \\mathsf{C} : \\boldsymbol{\\varepsilon}$，其中 $\\mathsf{C}$ 是四阶刚度张量。对于各向同性材料，刚度张量完全由两个独立的标量参数定义。这些参数的一个方便的选择是拉梅参数 $\\lambda$ 和 $\\mu$。本构关系可以写成以下显式形式：\n$$\n\\boldsymbol{\\sigma} = \\lambda \\, \\text{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} + 2\\mu \\, \\boldsymbol{\\varepsilon}\n$$\n其中 $\\boldsymbol{\\sigma}$ 是二阶柯西应力张量，$\\boldsymbol{\\varepsilon}$ 是二阶小应变张量，$\\text{tr}(\\boldsymbol{\\varepsilon})$ 是应变张量的迹（表示体积应变），$\\mathbf{I}$ 是二阶单位张量。拉梅参数 $\\mu$ 与剪切模量 $G$ 相同，因此我们接下来将使用 $G$：\n$$\n\\boldsymbol{\\sigma} = \\lambda \\, \\text{tr}(\\boldsymbol{\\varepsilon}) \\, \\mathbf{I} + 2G \\, \\boldsymbol{\\varepsilon}\n$$\n我们的主要目标是从给定的离散数据集 $\\{(\\boldsymbol{\\varepsilon}^{(s)}, \\boldsymbol{\\sigma}^{(s)})\\}|_{s=1}^{S}$ 中估计 $\\lambda$ 和 $G$ 的值。\n\n这个张量方程代表了一个关于未知参数 $\\lambda$ 和 $G$ 的线性方程组。为了使其明确，我们可以在笛卡尔坐标系中用其分量来写出该方程，使用索引 $i, j \\in \\{1, 2, 3\\}$。其分量形式为：\n$$\n\\sigma_{ij} = \\lambda \\, (\\sum_{k=1}^3 \\varepsilon_{kk}) \\, \\delta_{ij} + 2G \\, \\varepsilon_{ij}\n$$\n其中 $\\delta_{ij}$ 是克罗内克δ。\n\n对于每个数据样本 $s$，我们有一个应力张量 $\\boldsymbol{\\sigma}^{(s)}$ 和一个应变张量 $\\boldsymbol{\\varepsilon}^{(s)}$。由于这些张量是对称的，它们各自有 $6$ 个独立分量。这为每个数据样本提供了多达 $6$ 个标量方程。将所有 $S$ 个样本的所有方程聚合起来，就得到了一个包含 $6S$ 个线性方程的方程组，用于求解两个未知数 $\\lambda$ 和 $G$。该系统通常是超定的，这很有利，因为它允许对潜在的数值噪声进行平均（尽管提供的数据是一致的）并找到最佳拟合解。\n\n我们可以将此系统构建成标准矩阵形式 $A\\mathbf{x} = \\mathbf{b}$，其中 $\\mathbf{x}$ 是未知数向量， $A$ 是系数矩阵，$\\mathbf{b}$ 是观测值向量。\n设未知数向量为 $\\mathbf{x} = \\begin{pmatrix} \\lambda \\\\ G \\end{pmatrix}$。\n对于每个数据样本 $s$ 和 $6$ 个独立张量分量中的每一个（例如，由 $(1,1), (2,2), (3,3), (1,2), (1,3), (2,3)$ 索引），我们可以写出系统的一行。对于样本 $s$ 的分量 $(i,j)$，方程为：\n$$\n\\sigma_{ij}^{(s)} = (\\text{tr}(\\boldsymbol{\\varepsilon}^{(s)}) \\delta_{ij}) \\cdot \\lambda + (2\\varepsilon_{ij}^{(s)}) \\cdot G\n$$\n这直接给出了矩阵 $A$ 的行和向量 $\\mathbf{b}$ 的结构。对于每个样本 $s$ 和每对 $(i, j)$，我们构建 $A$ 的一行为 $[\\text{tr}(\\boldsymbol{\\varepsilon}^{(s)})\\delta_{ij}, 2\\varepsilon_{ij}^{(s)}]$，以及 $\\mathbf{b}$ 中对应的元素为 $\\sigma_{ij}^{(s)}$。为所有样本和所有分量堆叠这些行，即可得到完整的系统。\n\n由于系统 $A\\mathbf{x}=\\mathbf{b}$ 是超定的，我们寻求一个解 $\\mathbf{x}$，使残差的欧几里得范数的平方 $\\|A\\mathbf{x} - \\mathbf{b}\\|_2^2$ 最小化。这是标准的线性最小二乘问题。解由正规方程给出：\n$$\nA^T A \\mathbf{x} = A^T \\mathbf{b}\n$$\n假设 $A^T A$ 是可逆的（这要求所提供的应变状态足够多样，以独立地激发体积响应和偏响应），则唯一解为：\n$$\n\\mathbf{x} = (A^T A)^{-1} A^T \\mathbf{b}\n$$\n在数值上，使用诸如QR分解或奇异值分解（SVD）等方法直接求解最小二乘问题更为稳定，这些方法在标准科学计算库中都有实现。\n\n一旦估计出 $\\lambda$ 和 $G$ 的最优值，就可以使用它们在拉梅参数方面的标准定义来计算其余的弹性常数。\n\\begin{itemize}\n    \\item **剪切模量**，$G$，直接从解向量 $\\mathbf{x}$ 的第二个分量获得。为了物理稳定性，我们必须有 $G > 0$。\n    \\item **体积模量**，$K$，关联静水压力与体积应变。它定义为 $K = \\lambda + \\frac{2}{3}G$。为了物理稳定性，我们必须有 $K > 0$。\n    \\item **泊松比**，$\\nu$，表征对轴向应变的横向应变响应。它由 $\\nu = \\frac{\\lambda}{2(\\lambda + G)}$ 给出。对于稳定的各向同性材料，$\\nu$ 的范围通常在 $[-1, 0.5]$ 内。\n\\end{itemize}\n\n每个测试用例的算法流程如下：\n1. 初始化空列表以构建全局矩阵 $A$ 和向量 $\\mathbf{b}$。\n2. 遍历每个提供的应变-应力对 $(\\boldsymbol{\\varepsilon}^{(s)}, \\boldsymbol{\\sigma}^{(s)})$。\n3. 对每一对，遍历 $6$ 个独立分量 $(i,j)$。这些可以取为 $(1,1), (2,2), (3,3), (1,2), (1,3), (2,3)$。对每个分量：\n    a. 计算应变张量的迹，$v^{(s)} = \\text{tr}(\\boldsymbol{\\varepsilon}^{(s)})$。\n    b. 为矩阵 $A$ 构建一行。对于对角分量 $(i,i)$，行为 $[v^{(s)}, 2\\varepsilon_{ii}^{(s)}]$。对于非对角分量 $(i,j)$ 其中 $i \\neq j$，行为 $[0, 2\\varepsilon_{ij}^{(s)}]$。\n    c. 将此行附加到 $A$。\n    d. 将相应的应力分量 $\\sigma_{ij}^{(s)}$ 附加到 $\\mathbf{b}$。\n4. 求解线性最小二乘问题 $A\\mathbf{x} = \\mathbf{b}$ 以找到向量 $\\mathbf{x} = [\\lambda, G]^T$。\n5. 从解 $\\mathbf{x}$ 中提取 $\\lambda$ 和 $G$。\n6. 计算 $K = \\lambda + \\frac{2}{3}G$ 和 $\\nu = \\frac{\\lambda}{2(\\lambda + G)}$。\n7. 将 $K$、$G$ 和 $\\nu$ 的最终值四舍五入到所需的精度。\n\n该流程提供了一种从提供的模拟数据中稳健地确定弹性常数的方法。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes elastic constants from synthetic molecular dynamics data\n    using a linear least-squares estimator.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1\n        [\n            (np.array([[0.005, 0, 0], [0, 0, 0], [0, 0, 0]]),\n             np.array([[1.1, 0, 0], [0, 0.3, 0], [0, 0, 0.3]])),\n            (np.array([[0, 0.003, 0], [0.003, 0, 0], [0, 0, 0]]),\n             np.array([[0, 0.48, 0], [0.48, 0, 0], [0, 0, 0]])),\n            (np.array([[0.002, 0, 0], [0, 0.002, 0], [0, 0, 0.002]]),\n             np.array([[0.68, 0, 0], [0, 0.68, 0], [0, 0, 0.68]])),\n            (np.array([[0.004, 0, 0], [0, 0.004, 0], [0, 0, 0]]),\n             np.array([[1.12, 0, 0], [0, 1.12, 0], [0, 0, 0.48]]))\n        ],\n        # Test case 2\n        [\n            (np.array([[0.005, 0, 0], [0, 0, 0], [0, 0, 0]]),\n             np.array([[0.51, 0, 0], [0, 0.5, 0], [0, 0, 0.5]])),\n            (np.array([[0, 0.004, 0], [0.004, 0, 0], [0, 0, 0]]),\n             np.array([[0, 0.008, 0], [0.008, 0, 0], [0, 0, 0]])),\n            (np.array([[0.002, 0, 0], [0, 0.002, 0], [0, 0, 0.002]]),\n             np.array([[0.604, 0, 0], [0, 0.604, 0], [0, 0, 0.604]])),\n            (np.array([[0.004, 0, 0], [0, 0.004, 0], [0, 0, 0]]),\n             np.array([[0.808, 0, 0], [0, 0.808, 0], [0, 0, 0.8]]))\n        ],\n        # Test case 3\n        [\n            (np.array([[0.005, 0, 0], [0, 0, 0], [0, 0, 0]]),\n             np.array([[0.2571428571428571, 0, 0], [0, -0.04285714285714286, 0], [0, 0, -0.04285714285714286]])),\n            (np.array([[0, 0.003, 0], [0.003, 0, 0], [0, 0, 0]]),\n             np.array([[0, 0.18, 0], [0.18, 0, 0], [0, 0, 0]])),\n            (np.array([[0.002, 0, 0], [0, 0.002, 0], [0, 0, 0.002]]),\n             np.array([[0.06857142857142858, 0, 0], [0, 0.06857142857142858, 0], [0, 0, 0.06857142857142858]])),\n            (np.array([[0.004, 0, 0], [0, 0.004, 0], [0, 0, 0]]),\n             np.array([[0.17142857142857143, 0, 0], [0, 0.17142857142857143, 0], [0, 0, -0.06857142857142858]]))\n        ],\n        # Test case 4\n        [\n            (np.array([[0.003, 0, 0], [0, 0.003, 0], [0, 0, 0.003]]),\n             np.array([[0.75, 0, 0], [0, 0.75, 0], [0, 0, 0.75]])),\n            (np.array([[0, 0, 0], [0, 0, 0.006], [0, 0.006, 0]]),\n             np.array([[0, 0, 0], [0, 0, 0.6], [0, 0.6, 0]])),\n            (np.array([[0.004, 0, 0], [0, 0, 0], [0, 0, 0]]),\n             np.array([[0.6, 0, 0], [0, 0.2, 0], [0, 0, 0.2]]))\n        ]\n    ]\n\n    all_results = []\n    \n    # Indices for the 6 independent components of a symmetric 3x3 tensor\n    comp_indices = [(0, 0), (1, 1), (2, 2), (0, 1), (0, 2), (1, 2)]\n\n    for case_data in test_cases:\n        A_rows = []\n        b_vals = []\n\n        for epsilon, sigma in case_data:\n            tr_epsilon = np.trace(epsilon)\n            \n            for i, j in comp_indices:\n                sigma_ij = sigma[i, j]\n                epsilon_ij = epsilon[i, j]\n                \n                if i == j: # Diagonal components\n                    # sigma_ii = tr(eps) * lambda + 2 * eps_ii * G\n                    A_row = [tr_epsilon, 2 * epsilon_ij]\n                else: # Off-diagonal components\n                    # sigma_ij = 2 * eps_ij * G\n                    A_row = [0, 2 * epsilon_ij]\n                \n                A_rows.append(A_row)\n                b_vals.append(sigma_ij)\n\n        A = np.array(A_rows)\n        b = np.array(b_vals)\n\n        # Solve the linear least-squares problem Ax = b for x = [lambda, G]\n        x, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n        \n        lame_lambda = x[0]\n        G = x[1]  # Shear modulus\n\n        # Calculate Bulk modulus K and Poisson's ratio nu\n        K = lame_lambda + (2.0 / 3.0) * G\n        \n        # Handle potential division by zero if (lambda + G) is zero, though unlikely\n        if abs(lame_lambda + G)  1e-12:\n            nu = 0.0 # Or handle as an error, here we just set to a neutral value\n        else:\n            nu = lame_lambda / (2.0 * (lame_lambda + G))\n\n        # Round results to 6 decimal places\n        K_rounded = round(K, 6)\n        G_rounded = round(G, 6)\n        nu_rounded = round(nu, 6)\n        \n        all_results.append([K_rounded, G_rounded, nu_rounded])\n\n    # Format the final output string\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n\n```"
        },
        {
            "introduction": "完美的晶体只是理想化的模型，许多现实材料（如玻璃和聚合物）是无序的。在这些材料中，原子在外力作用下的响应并不仅仅是跟随宏观应变（仿射形变），还会发生局部位置的重新调整以最小化能量，这一过程被称为“非仿射弛豫”。这个高级练习将引导您超越简单的Born近似，通过明确地计算这些内部弛豫的贡献，来求解一个更精确的“弛豫”弹性常数，这是理解非晶固体力学行为的一个核心概念。",
            "id": "3739194",
            "problem": "你的任务是实现一个完整、可运行的程序，该程序在分子动力学（MD）框架下，通过显式地考虑非仿射弛豫来计算无序材料的弹性常数，并将其表述为零温小应变分析。该评估必须基于第一性原理和标准定义，从牛顿定律和势能的二次展开开始。\n\n考虑一种材料，其在参考构型下由一组内部坐标（汇集于向量 $u$ 中）、一个宏观标量应变 $\\gamma$ 以及在 $\\gamma$ 和 $u$ 的小扰动下展开至二阶的势能 $U(\\gamma, u)$ 来描述。推导的基本依据如下：\n- 牛顿第二定律，在零温和准静态极限下简化为力学平衡，表示为总力为零：$\\frac{\\partial U}{\\partial u} = 0$。\n- 内部坐标 $u$ 对施加的无穷小应变 $\\gamma$ 的线性响应，这与 $U(\\gamma, u)$ 在稳定参考态附近的二次展开一致。\n- 弹性常数的定义，即弛豫能量密度对所施加应变的二阶导数，在 $\\gamma = 0$ 处求值。\n\n你必须使用以下精确的数学和计算要求：\n- 参考态附近的势能通过一个对称的 Hessian 矩阵 $H$（单位：电子伏特/平方纳米，$\\mathrm{eV}/\\mathrm{nm}^2$）和一个耦合向量 $\\Xi$（单位：电子伏特/纳米，$\\mathrm{eV}/\\mathrm{nm}$）进行二次展开，其中 $\\Xi$ 代表力对应变的仿射部分响应。假设存在一个标量仿射刚度 $C_{\\mathrm{affine}}$（单位：电子伏特/立方纳米，$\\mathrm{eV}/\\mathrm{nm}^3$）和系统体积 $V$（单位：立方纳米，$\\mathrm{nm}^3$）。\n- 施加应变下的力学平衡要求确定使能量最小化的弛豫内部坐标 $u(\\gamma)$。弛豫刚度 $C$ 必须通过弛豫能量密度中 $\\gamma^2$ 的系数除以体积 $V$ 来获得，并与上述基本依据保持一致。\n- 在数值实现中，如果 $H$ 是病态或不可逆的，应使用 Moore–Penrose 伪逆，并设置相对截断值 $r_{\\mathrm{cond}} = 10^{-12}$ 来处理小的奇异值，以确保数值稳定性。\n- 使用精确转换公式 $1\\ \\mathrm{eV}/\\mathrm{nm}^3 = 0.16021766208\\ \\mathrm{GPa}$ 将最终刚度转换为吉帕斯卡（GPa）。程序的输出必须以 GPa 为单位，并保留六位小数。\n\n你的程序必须处理以下测试用例集，每个用例由 $(H, \\Xi, V, C_{\\mathrm{affine}})$ 定义：\n- 测试用例 1（正常路径）：\n  - $H = \\mathrm{diag}([10.0, 9.0, 8.0, 7.0])$，单位为 $\\mathrm{eV}/\\mathrm{nm}^2$。\n  - $\\Xi = [2.0, -1.0, 0.5, 1.5]$，单位为 $\\mathrm{eV}/\\mathrm{nm}$。\n  - $V = 50.0$，单位为 $\\mathrm{nm}^3$。\n  - $C_{\\mathrm{affine}} = 3.0$，单位为 $\\mathrm{eV}/\\mathrm{nm}^3$。\n- 测试用例 2（边界情况：无非仿射耦合）：\n  - $H = \\mathrm{diag}([6.0, 6.0, 6.0, 6.0])$，单位为 $\\mathrm{eV}/\\mathrm{nm}^2$。\n  - $\\Xi = [0.0, 0.0, 0.0, 0.0]$，单位为 $\\mathrm{eV}/\\mathrm{nm}$。\n  - $V = 100.0$，单位为 $\\mathrm{nm}^3$。\n  - $C_{\\mathrm{affine}} = 2.5$，单位为 $\\mathrm{eV}/\\mathrm{nm}^3$。\n- 测试用例 3（边缘情况：接近奇异的刚度矩阵）：\n  - $H = \\mathrm{diag}([1.0\\times 10^{-3}, 5.0, 4.5])$，单位为 $\\mathrm{eV}/\\mathrm{nm}^2$。\n  - $\\Xi = [0.2, 1.0, -0.5]$，单位为 $\\mathrm{eV}/\\mathrm{nm}$。\n  - $V = 30.0$，单位为 $\\mathrm{nm}^3$。\n  - $C_{\\mathrm{affine}} = 4.0$，单位为 $\\mathrm{eV}/\\mathrm{nm}^3$。\n- 测试用例 4（显著的非仿射弛豫导致不稳定性）：\n  - $H = \\mathrm{diag}([5.0, 5.0, 5.0, 5.0])$，单位为 $\\mathrm{eV}/\\mathrm{nm}^2$。\n  - $\\Xi = [10.0, 10.0, 10.0, 10.0]$，单位为 $\\mathrm{eV}/\\mathrm{nm}$。\n  - $V = 10.0$，单位为 $\\mathrm{nm}^3$。\n  - $C_{\\mathrm{affine}} = 2.0$，单位为 $\\mathrm{eV}/\\mathrm{nm}^3$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如：$[x_1, x_2, x_3, x_4]$，其中每个 $x_i$ 是对应于测试用例 1 到 4 的计算所得弛豫刚度（单位为 GPa），四舍五入至六位小数。\n\n不允许使用外部输入、文件或网络访问。程序必须是自包含的，并能在指定环境中运行。",
            "solution": "经评估，此问题有效。其科学基础植根于固态物理和计算材料科学的原理，参数完整且一致，问题提法恰当，并且表述客观。\n\n弛豫弹性常数的推导始于一个在小宏观应变 $\\gamma$ 下且具有内部坐标位移 $u$ 的系统所对应的势能 $U$ 的二次展开。参考态位于 $\\gamma=0$ 和 $u=0$ 处，该状态被假设为一个力学稳定构型（内部作用力和应力均为零）。能量的二阶展开式如下：\n$$\nU(\\gamma, u) = U(0, u=0) + \\frac{1}{2} \\left( \\frac{\\partial^2 U}{\\partial \\gamma^2} \\right)_0 \\gamma^2 + \\gamma \\left( \\frac{\\partial^2 U}{\\partial \\gamma \\partial u} \\right)_0 u + \\frac{1}{2} u^T \\left( \\frac{\\partial^2 U}{\\partial u^2} \\right)_0 u\n$$\n由于参考态是平衡态，线性项为零。在不失一般性的前提下，我们可以将参考能量 $U(0, u=0)$ 设为零。根据问题陈述中提供的定义，我们可以识别每一项。纯内能项由 Hessian 矩阵 $H = (\\partial^2 U / \\partial u^2)_0$ 决定。仿射刚度 $C_{\\mathrm{affine}}$ 对应于纯应变项，因此 $(\\partial^2 U / \\partial \\gamma^2)_0 = V C_{\\mathrm{affine}}$，其中 $V$ 是系统体积。耦合向量 $\\Xi$ 与混合导数有关，代表仿射应变在内部坐标上诱导的力。统计力学中的常规形式定义为 $\\Xi_i = -(\\partial^2 U / \\partial \\gamma \\partial u_i)_0$。这导出了势能的以下表达式：\n$$\nU(\\gamma, u) = \\frac{1}{2} V C_{\\mathrm{affine}} \\gamma^2 - \\Xi^T u \\gamma + \\frac{1}{2} u^T H u\n$$\n在零温和准静态极限下，对于任何施加的应变 $\\gamma$，系统通过将其内部坐标 $u$ 弛豫到使势能最小化的构型来达到力学平衡。此条件通过将 $U$ 对 $u$ 的导数设为零来表示：\n$$\n\\frac{\\partial U}{\\partial u} = - \\Xi \\gamma + H u = 0\n$$\n求解这个关于弛豫内部坐标 $u(\\gamma)$ 的线性系统，得到：\n$$\nu(\\gamma) = H^{-1} \\Xi \\gamma\n$$\n这里，$H^{-1}$ 是 Hessian 矩阵的逆矩阵。问题指明，如果 $H$ 是病态或奇异的，应使用记为 $H^{\\dagger}$ 的 Moore-Penrose 伪逆以确保数值稳定性。因此，我们写作 $u(\\gamma) = H^{\\dagger} \\Xi \\gamma$。\n\n将此 $u(\\gamma)$ 的表达式代回势能函数，即可求得弛豫势能 $U_{\\mathrm{relaxed}}(\\gamma)$：\n$$\nU_{\\mathrm{relaxed}}(\\gamma) = U(\\gamma, u(\\gamma)) = \\frac{1}{2} V C_{\\mathrm{affine}} \\gamma^2 - \\Xi^T (H^{\\dagger} \\Xi \\gamma) \\gamma + \\frac{1}{2} (H^{\\dagger} \\Xi \\gamma)^T H (H^{\\dagger} \\Xi \\gamma)\n$$\n鉴于 $H$ 是对称的，其伪逆 $H^{\\dagger}$ 也是对称的。通过合并关于 $\\gamma$ 的二次项，表达式得以简化：\n$$\nU_{\\mathrm{relaxed}}(\\gamma) = \\frac{1}{2} V C_{\\mathrm{affine}} \\gamma^2 - (\\Xi^T H^{\\dagger} \\Xi) \\gamma^2 + \\frac{1}{2} \\gamma^2 (\\Xi^T H^{\\dagger} H H^{\\dagger} \\Xi)\n$$\n利用伪逆的性质 $H^{\\dagger} H H^{\\dagger} = H^{\\dagger}$，最后一项变为 $\\frac{1}{2} (\\Xi^T H^{\\dagger} \\Xi) \\gamma^2$。合并弛豫项后得到：\n$$\nU_{\\mathrm{relaxed}}(\\gamma) = \\left( \\frac{1}{2} V C_{\\mathrm{affine}} - \\frac{1}{2} \\Xi^T H^{\\dagger} \\Xi \\right) \\gamma^2\n$$\n弛豫弹性常数 $C$ 是通过弛豫能量密度 $U_{\\mathrm{relaxed}}(\\gamma)/V = \\frac{1}{2} C \\gamma^2$ 定义的。将此定义与我们推导出的 $U_{\\mathrm{relaxed}}(\\gamma)$ 表达式进行比较，我们发现：\n$$\n\\frac{1}{2} C \\gamma^2 = \\frac{1}{V} \\left( \\frac{1}{2} V C_{\\mathrm{affine}} - \\frac{1}{2} \\Xi^T H^{\\dagger} \\Xi \\right) \\gamma^2\n$$\n这就得出了弛豫弹性常数的最终公式：\n$$\nC = C_{\\mathrm{affine}} - \\frac{1}{V} \\left( \\Xi^T H^{\\dagger} \\Xi \\right)\n$$\n第一项 $C_{\\mathrm{affine}}$ 通常被称为 Born 项，代表当所有原子随宏观应变发生纯仿射变形时材料的刚度。第二项 $-\\frac{1}{V} \\Xi^T H^{\\dagger} \\Xi$ 是非仿射修正项，它量化了由内部结构弛豫导致的材料软化。对于一个半正定 Hessian 矩阵 $H$，此修正项为非正值。\n\n数值实现将为每个测试用例计算该量。Hessian 矩阵 $H$ 将根据给定的列表构建为对角矩阵。向量 $\\Xi$ 表示为 NumPy 数组。伪逆 $H^{\\dagger}$ 使用 `numpy.linalg.pinv` 计算，并指定相对截断值 $r_{\\mathrm{cond}} = 10^{-12}$。最终结果使用提供的转换因子 $1\\ \\mathrm{eV}/\\mathrm{nm}^3 = 0.16021766208\\ \\mathrm{GPa}$ 从 $\\mathrm{eV}/\\mathrm{nm}^3$ 转换为 $\\mathrm{GPa}$，并四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relaxed elastic constant for a series of test cases based on a\n    quadratic energy expansion and nonaffine relaxation theory.\n    \"\"\"\n\n    # Conversion factor from eV/nm^3 to GPa.\n    EV_PER_NM3_TO_GPA = 0.16021766208\n\n    # Relative cutoff for Moore-Penrose pseudoinverse calculation.\n    RCOND = 1e-12\n\n    def calculate_relaxed_stiffness(H_diag, Xi_list, V, C_affine):\n        \"\"\"\n        Calculates the relaxed elastic constant C for a single case.\n\n        Args:\n            H_diag (list): Diagonal elements of the Hessian matrix H in eV/nm^2.\n            Xi_list (list): Elements of the coupling vector Xi in eV/nm.\n            V (float): System volume in nm^3.\n            C_affine (float): Affine stiffness in eV/nm^3.\n\n        Returns:\n            float: The relaxed stiffness C in GPa.\n        \"\"\"\n        # Construct the Hessian matrix H from its diagonal elements.\n        H = np.diag(H_diag)\n\n        # Represent the coupling vector Xi as a NumPy column vector.\n        Xi = np.array(Xi_list).reshape(-1, 1)\n\n        # Calculate the Moore-Penrose pseudoinverse of H.\n        H_pinv = np.linalg.pinv(H, rcond=RCOND)\n\n        # Calculate the scalar term Xi^T * H_pinv * Xi, representing the energy\n        # scale of the relaxation. The result is a 1x1 matrix.\n        relaxation_energy_term = (Xi.T @ H_pinv @ Xi)[0, 0]\n\n        # Calculate the total relaxed stiffness C in eV/nm^3 using the derived formula:\n        # C = C_affine - (1/V) * (Xi^T * H_pinv * Xi)\n        C_ev_per_nm3 = C_affine - (1.0 / V) * relaxation_energy_term\n\n        # Convert the stiffness from eV/nm^3 to GPa.\n        C_gpa = C_ev_per_nm3 * EV_PER_NM3_TO_GPA\n\n        return C_gpa\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (H_diag, Xi, V, C_affine)\n    test_cases = [\n        # Test Case 1 (happy path)\n        ([10.0, 9.0, 8.0, 7.0], [2.0, -1.0, 0.5, 1.5], 50.0, 3.0),\n        # Test Case 2 (boundary case: no nonaffine coupling)\n        ([6.0, 6.0, 6.0, 6.0], [0.0, 0.0, 0.0, 0.0], 100.0, 2.5),\n        # Test Case 3 (edge case: near-singular stiffness matrix)\n        ([1.0e-3, 5.0, 4.5], [0.2, 1.0, -0.5], 30.0, 4.0),\n        # Test Case 4 (significant nonaffine relaxation causing instability)\n        ([5.0, 5.0, 5.0, 5.0], [10.0, 10.0, 10.0, 10.0], 10.0, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        H_diag, Xi_list, V, C_affine = case\n        \n        # Calculate the result for the current test case.\n        result_gpa = calculate_relaxed_stiffness(H_diag, Xi_list, V, C_affine)\n        \n        # Format the result to six decimal places, as required.\n        results.append(f\"{result_gpa:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the main solver function.\nsolve()\n```"
        }
    ]
}