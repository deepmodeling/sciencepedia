{
    "hands_on_practices": [
        {
            "introduction": "We begin with the foundational technique for extracting thermal conductivity from an equilibrium molecular dynamics (MD) simulation: the Green-Kubo formalism. This practice challenges you to translate the formal expression relating the heat flux autocorrelation function (HFACF) to the thermal conductivity, $\\kappa$, into a concrete numerical algorithm . By processing a raw heat current time series, you will develop the essential skills of calculating an autocorrelation function and performing its numerical integration, which are cornerstones of transport coefficient calculation.",
            "id": "3749267",
            "problem": "You are given discrete, uniformly sampled time series of the three Cartesian components of a molecular dynamics heat current vector for an isotropic material. From first principles of equilibrium statistical mechanics and linear response theory, the scalar thermal conductivity for an isotropic material can be determined by constructing the heat flux autocorrelation function from these samples and integrating it over time up to a prescribed cutoff time. Your task is to write a complete, runnable program that, for each specified test case, constructs the heat flux autocorrelation function from the provided discrete samples, integrates it using the trapezoidal rule up to the cutoff time, and converts the result into a scalar thermal conductivity expressed in $\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$. All necessary physical constants and parameters are specified below.\n\nThe input assumptions and definitions you must follow are:\n- The heat current vector samples are the Cartesian components $(J_x(t_n), J_y(t_n), J_z(t_n))$, where $t_n = n\\,\\Delta t$ with uniform time step $\\Delta t$ for $n=0,1,\\dots,N-1$. Each component time series must be treated by first subtracting its sample mean to ensure stationarity.\n- The heat current vector here is the extensive quantity commonly output by molecular dynamics packages, equal to volume times the microscopic heat flux density, and thus has units of $\\mathrm{W}\\cdot\\mathrm{m}$.\n- For an isotropic material, the scalar heat flux autocorrelation function at discrete lag $k$ is defined as the equal-weight average of the three component autocorrelations of the mean-removed series. Use an unbiased discrete-time estimator for each component autocorrelation at lag $k$, meaning you must divide the lag-$k$ correlation sum by $(N-k)$.\n- The trapezoidal integration must be carried out over the discrete times $t_k = k\\,\\Delta t$ from $t_0=0$ up to $t_{K^\\ast} = \\min\\{t_c,\\,(N-1)\\,\\Delta t\\}$, where $t_c$ is the chosen cutoff time for the test case. If $t_c < \\Delta t$, the integral should reduce to the value over a zero-length interval (i.e., zero). If $t_c$ lies strictly between grid points, use only grid points up to the largest $t_k \\le t_c$ for the trapezoidal rule.\n- Use the Boltzmann constant $k_\\mathrm{B} = 1.380649\\times 10^{-23}\\ \\mathrm{J}/\\mathrm{K}$.\n\nFor each test case, the volume $V$ (in $\\mathrm{m}^3$), the absolute temperature $T$ (in $\\mathrm{K}$), the time step $\\Delta t$ (in $\\mathrm{s}$), the number of samples $N$, the cutoff $t_c$ (in $\\mathrm{s}$), and the generative formulae for $(J_x,J_y,J_z)$ (in $\\mathrm{W}\\cdot\\mathrm{m}$) are specified. You must generate the time series from these definitions, construct the unbiased discrete-time scalar heat flux autocorrelation function as described, perform the trapezoidal integration up to $t_c$, and convert this integrated correlation into the scalar thermal conductivity in $\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$ using the appropriate scaling implied by equilibrium fluctuation-dissipation relations for isotropic media.\n\nPhysical units and numerical conventions:\n- Express the final conductivities in $\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$.\n- Any angular frequency $\\omega$ is in radians per second, and any angle used implicitly in trigonometric definitions is in radians.\n- All floating-point outputs must be formatted in scientific notation with exactly six significant digits.\n\nTest suite of parameter sets:\n- Case A (nominal exponential relaxation):\n  - $V = (4.0\\times 10^{-9})^3\\ \\mathrm{m}^3$,\n  - $T = 300\\ \\mathrm{K}$,\n  - $\\Delta t = 5.0\\times 10^{-15}\\ \\mathrm{s}$,\n  - $N = 4096$,\n  - $t_c = 5.0\\times 10^{-12}\\ \\mathrm{s}$.\n  - Define $A = 3.0\\times 10^{-15}\\ \\mathrm{W}\\cdot\\mathrm{m}$ and $\\tau = 1.0\\times 10^{-12}\\ \\mathrm{s}$. For $n=0,1,\\dots,N-1$ and $t_n = n\\,\\Delta t$, set\n    - $J_x(t_n) = A\\,\\exp(-t_n/\\tau)$,\n    - $J_y(t_n) = A\\,\\exp(-t_n/\\tau)$,\n    - $J_z(t_n) = A\\,\\exp(-t_n/\\tau)$.\n- Case B (damped oscillatory relaxation):\n  - $V = (5.0\\times 10^{-9})^3\\ \\mathrm{m}^3$,\n  - $T = 300\\ \\mathrm{K}$,\n  - $\\Delta t = 2.0\\times 10^{-15}\\ \\mathrm{s}$,\n  - $N = 4096$,\n  - $t_c = 2.0\\times 10^{-12}\\ \\mathrm{s}$.\n  - Define $A = 2.0\\times 10^{-15}\\ \\mathrm{W}\\cdot\\mathrm{m}$, $\\tau = 5.0\\times 10^{-13}\\ \\mathrm{s}$, and $\\omega = 2\\pi\\times 1.0\\times 10^{12}\\ \\mathrm{rad}/\\mathrm{s}$. For $n=0,1,\\dots,N-1$ and $t_n = n\\,\\Delta t$, set\n    - $J_x(t_n) = A\\,\\cos(\\omega t_n)\\,\\exp(-t_n/\\tau)$,\n    - $J_y(t_n) = A\\,\\sin(\\omega t_n)\\,\\exp(-t_n/\\tau)$,\n    - $J_z(t_n) = 0$.\n- Case C (impulse-like initial current with minimal window):\n  - $V = 1.0\\times 10^{-27}\\ \\mathrm{m}^3$,\n  - $T = 500\\ \\mathrm{K}$,\n  - $\\Delta t = 1.0\\times 10^{-14}\\ \\mathrm{s}$,\n  - $N = 8$,\n  - $t_c = 1.0\\times 10^{-14}\\ \\mathrm{s}$.\n  - Define $A = 1.0\\times 10^{-14}\\ \\mathrm{W}\\cdot\\mathrm{m}$. For $n=0,1,\\dots,N-1$ set\n    - $J_x(t_0) = A$ and $J_x(t_n) = 0$ for $n\\ge 1$,\n    - $J_y(t_n) = 0$ for all $n$,\n    - $J_z(t_n) = 0$ for all $n$.\n- Case D (short correlation within long cutoff; cutoff beyond available window should be clipped automatically):\n  - $V = 5.0\\times 10^{-27}\\ \\mathrm{m}^3$,\n  - $T = 1000\\ \\mathrm{K}$,\n  - $\\Delta t = 1.0\\times 10^{-14}\\ \\mathrm{s}$,\n  - $N = 100$,\n  - $t_c = 1.0\\times 10^{-11}\\ \\mathrm{s}$.\n  - Define $A = 1.5\\times 10^{-14}\\ \\mathrm{W}\\cdot\\mathrm{m}$ and $\\tau = 2.0\\times 10^{-13}\\ \\mathrm{s}$. For $n=0,1,\\dots,N-1$ and $t_n = n\\,\\Delta t$, set\n    - $J_x(t_n) = A\\,\\exp(-t_n/\\tau)$,\n    - $J_y(t_n) = A\\,\\exp(-t_n/\\tau)$,\n    - $J_z(t_n) = A\\,\\exp(-t_n/\\tau)$.\n\nFinal output requirement:\n- Your program should produce a single line of output containing the scalar thermal conductivities for the four cases, in the order A, B, C, D, formatted as a comma-separated list enclosed in square brackets, with each value in scientific notation with exactly six significant digits, for example, $[1.234560\\mathrm{e}{-02},3.456780\\mathrm{e}{+00},\\dots]$.",
            "solution": "The problem requires the calculation of the scalar thermal conductivity, $\\kappa$, for an isotropic material from discrete time series data of the heat current vector, $\\mathbf{J}(t)$, obtained from a molecular dynamics simulation. The theoretical foundation for this calculation is the Green-Kubo relation, a result from linear response theory in equilibrium statistical mechanics.\n\nThe Green-Kubo formula relates a macroscopic transport coefficient to the time integral of an equilibrium time-autocorrelation function of the corresponding microscopic flux. For thermal conductivity, the relevant flux is the heat current. The thermal conductivity tensor, $\\kappa_{\\alpha\\beta}$, is given by:\n$$ \\kappa_{\\alpha\\beta} = \\frac{1}{V k_\\mathrm{B} T^2} \\int_0^\\infty \\langle J_\\alpha(0) J_\\beta(t) \\rangle dt $$\nwhere $V$ is the system volume, $k_\\mathrm{B}$ is the Boltzmann constant, $T$ is the absolute temperature, and $\\langle J_\\alpha(0) J_\\beta(t) \\rangle$ is the ensemble-averaged time-autocorrelation function of the components of the extensive heat current vector $\\mathbf{J}$. The units of $\\mathbf{J}$ are given as $\\mathrm{W}\\cdot\\mathrm{m}$.\n\nFor an isotropic material, the thermal conductivity tensor is diagonal and its diagonal elements are equal: $\\kappa_{\\alpha\\beta} = \\kappa \\delta_{\\alpha\\beta}$. The scalar thermal conductivity $\\kappa$ can be expressed as the average of the diagonal components:\n$$ \\kappa = \\frac{1}{3} \\sum_{\\alpha=x,y,z} \\kappa_{\\alpha\\alpha} = \\frac{1}{3V k_\\mathrm{B} T^2} \\int_0^\\infty \\langle \\mathbf{J}(0) \\cdot \\mathbf{J}(t) \\rangle dt $$\nThe problem defines the scalar heat flux autocorrelation function (HFACF) as the average of the component autocorrelations, which is consistent with the above:\n$$ C(t) = \\frac{1}{3} \\sum_{\\alpha=x,y,z} \\langle J_\\alpha(0) J_\\alpha(t) \\rangle = \\frac{1}{3} \\langle \\mathbf{J}(0) \\cdot \\mathbf{J}(t) \\rangle $$\nSubstituting this definition into the expression for $\\kappa$ yields the primary equation for this task:\n$$ \\kappa = \\frac{1}{V k_\\mathrm{B} T^2} \\int_0^\\infty C(t) dt $$\nThe solution involves numerically evaluating this expression based on the provided discrete time series data and parameters. The procedure is as follows:\n\n1.  **Data Preparation**: For each Cartesian component of the heat current, $J_\\alpha(t_n)$, where $t_n = n\\,\\Delta t$ for $n=0, 1, \\dots, N-1$, the sample mean is subtracted to obtain a zero-mean series, $J'_\\alpha(t_n)$. This step is crucial for analyzing fluctuations around the equilibrium average, which is assumed to be zero.\n    $$ \\bar{J}_\\alpha = \\frac{1}{N} \\sum_{n=0}^{N-1} J_\\alpha(t_n) $$\n    $$ J'_\\alpha(t_n) = J_\\alpha(t_n) - \\bar{J}_\\alpha $$\n\n2.  **Discrete Autocorrelation Calculation**: The ensemble average $\\langle \\cdot \\rangle$ in the definition of $C(t)$ is replaced by a time average, invoking the ergodic hypothesis. The continuous autocorrelation $C_{\\alpha\\alpha}(t)$ for each component is estimated at discrete lag times $t_k = k\\,\\Delta t$ using the specified unbiased estimator:\n    $$ C_{\\alpha\\alpha}(t_k) = \\frac{1}{N-k} \\sum_{n=0}^{N-1-k} J'_\\alpha(t_n) J'_\\alpha(t_{n+k}) $$\n    The division by $N-k$, the number of products in the sum, corrects for the bias that would arise from dividing by $N$.\n\n3.  **Scalar HFACF Construction**: The scalar HFACF, $C(t_k)$, is computed by averaging the three component autocorrelations, as prescribed for an isotropic material:\n    $$ C(t_k) = \\frac{1}{3} \\left[ C_{xx}(t_k) + C_{yy}(t_k) + C_{zz}(t_k) \\right] $$\n\n4.  **Numerical Integration**: The integral of the HFACF is approximated numerically. The integration is performed from $t=0$ up to an effective cutoff time, $t_{K^\\ast} = \\min\\{t_c, (N-1)\\Delta t\\}$, where $t_c$ is a given cutoff and $(N-1)\\Delta t$ is the maximum possible lag time from a series of length $N$. The number of lag steps for the integration is $K_{max} = \\lfloor t_{K^\\ast} / \\Delta t \\rfloor$. The integral, $I$, is calculated using the trapezoidal rule over the discrete points $(t_k, C(t_k))$ from $k=0$ to $k=K_{max}$:\n    $$ I = \\int_0^{t_{K_{max}}} C(t) dt \\approx \\sum_{k=0}^{K_{max}-1} \\frac{C(t_k) + C(t_{k+1})}{2} \\Delta t $$\n    If $t_c < \\Delta t$, then $K_{max}=0$, the integration interval contains only the point $t_0=0$, and the integral evaluates to $0$.\n\n5.  **Final Conductivity Calculation**: Finally, the scalar thermal conductivity $\\kappa$ is computed by applying the prefactor from the Green-Kubo formula:\n    $$ \\kappa = \\frac{I}{V k_\\mathrm{B} T^2} $$\n    The units of the resulting $\\kappa$ are $\\mathrm{W}/(\\mathrm{m}\\cdot\\mathrm{K})$, as derived from the SI units of all quantities involved: $I$ in $(\\mathrm{W}\\cdot\\mathrm{m})^2 \\cdot \\mathrm{s}$, $V$ in $\\mathrm{m}^3$, $k_\\mathrm{B}$ in $\\mathrm{J}/\\mathrm{K}$, and $T$ in $\\mathrm{K}$.\n\nThis systematic, principle-based procedure is implemented for each test case to determine its thermal conductivity.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates thermal conductivity from molecular dynamics heat current data\n    using the Green-Kubo relations.\n    \"\"\"\n    # Physical constant\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n\n    # Test suite of parameter sets\n    test_cases = [\n        # Case A: Nominal exponential relaxation\n        {\n            'V': (4.0e-9)**3,\n            'T': 300.0,\n            'dt': 5.0e-15,\n            'N': 4096,\n            'tc': 5.0e-12,\n            'J_func': lambda t, p: (\n                p['A'] * np.exp(-t / p['tau']),\n                p['A'] * np.exp(-t / p['tau']),\n                p['A'] * np.exp(-t / p['tau'])\n            ),\n            'J_params': {'A': 3.0e-15, 'tau': 1.0e-12}\n        },\n        # Case B: Damped oscillatory relaxation\n        {\n            'V': (5.0e-9)**3,\n            'T': 300.0,\n            'dt': 2.0e-15,\n            'N': 4096,\n            'tc': 2.0e-12,\n            'J_func': lambda t, p: (\n                p['A'] * np.cos(p['w'] * t) * np.exp(-t / p['tau']),\n                p['A'] * np.sin(p['w'] * t) * np.exp(-t / p['tau']),\n                np.zeros_like(t)\n            ),\n            'J_params': {'A': 2.0e-15, 'tau': 5.0e-13, 'w': 2 * np.pi * 1.0e12}\n        },\n        # Case C: Impulse-like initial current\n        {\n            'V': 1.0e-27,\n            'T': 500.0,\n            'dt': 1.0e-14,\n            'N': 8,\n            'tc': 1.0e-14,\n            'J_func': lambda t, p: (\n                np.array([p['A']] + [0.0] * (len(t) - 1)),\n                np.zeros_like(t),\n                np.zeros_like(t)\n            ),\n            'J_params': {'A': 1.0e-14}\n        },\n        # Case D: Short correlation, long cutoff\n        {\n            'V': 5.0e-27,\n            'T': 1000.0,\n            'dt': 1.0e-14,\n            'N': 100,\n            'tc': 1.0e-11,\n            'J_func': lambda t, p: (\n                p['A'] * np.exp(-t / p['tau']),\n                p['A'] * np.exp(-t / p['tau']),\n                p['A'] * np.exp(-t / p['tau'])\n            ),\n            'J_params': {'A': 1.5e-14, 'tau': 2.0e-13}\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        V = case['V']\n        T = case['T']\n        dt = case['dt']\n        N = case['N']\n        tc = case['tc']\n        J_func = case['J_func']\n        J_params = case['J_params']\n\n        # 1. Generate time series for heat current components\n        t_series = np.arange(N) * dt\n        Jx, Jy, Jz = J_func(t_series, J_params)\n\n        # 2. Subtract sample mean from each component\n        Jx_prime = Jx - np.mean(Jx)\n        Jy_prime = Jy - np.mean(Jy)\n        Jz_prime = Jz - np.mean(Jz)\n        \n        # 3. Determine integration range based on cutoff time and data length\n        t_max_data = (N - 1) * dt\n        t_integration_limit = min(tc, t_max_data)\n        \n        # Determine max lag index K_max for correlation and integration\n        if t_integration_limit  dt:\n            K_max = 0\n        else:\n            K_max = int(np.floor(t_integration_limit / dt))\n\n        # 4. Calculate the scalar Heat Flux Autocorrelation Function (HFACF)\n        hfacf_values = np.zeros(K_max + 1)\n        \n        for k in range(K_max + 1):\n            # Unbiased estimator requires division by N-k\n            # If N-k is 0 or negative, this loop structure avoids it.\n            if N > k:\n                # Calculate component autocorrelations C_xx, C_yy, C_zz at lag k\n                # using dot product on sliced arrays for efficiency\n                C_xx_k = np.dot(Jx_prime[:N - k], Jx_prime[k:]) / (N - k)\n                C_yy_k = np.dot(Jy_prime[:N - k], Jy_prime[k:]) / (N - k)\n                C_zz_k = np.dot(Jz_prime[:N - k], Jz_prime[k:]) / (N - k)\n                \n                # Average for isotropic scalar HFACF\n                hfacf_values[k] = (C_xx_k + C_yy_k + C_zz_k) / 3.0\n\n        # 5. Integrate the HFACF using the trapezoidal rule\n        # The times corresponding to the HFACF values\n        hfacf_times = np.arange(K_max + 1) * dt\n        integral = np.trapz(hfacf_values, x=hfacf_times)\n        \n        # 6. Calculate the final thermal conductivity\n        prefactor = 1.0 / (V * k_B * T**2)\n        kappa = prefactor * integral\n        \n        results.append(f\"{kappa:.6e}\")\n\n    # Print results in the specified format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A result from a single MD simulation is not the final answer for a bulk material property, as it is inherently influenced by the finite size of the simulation cell. This exercise tackles this critical issue by exploring the systematic scaling of thermal conductivity with system size, $L$, based on predictions from hydrodynamic theory . You will learn how to perform a series of calculations on systems of varying sizes and use the resulting data to extrapolate to the thermodynamic limit ($L \\to \\infty$), a mandatory step for any rigorous conductivity study.",
            "id": "3749285",
            "problem": "You are given a task grounded in Linear Response Theory and Continuum Hydrodynamics to determine the thermodynamic-limit thermal conductivity from Molecular Dynamics (MD) data using the Green-Kubo (GK) formulation. Start from the following foundational base: the GK conductivity is the time integral of the properly normalized heat current autocorrelation function, and in a finite periodic cell of linear size $L$ the hydrodynamic long-time tail of the integrand is truncated by the lowest allowed hydrodynamic mode at a cutoff time $t_c(L)$. In three spatial dimensions, the long-time tail of the GK integrand behaves as a power law originating from mode-coupling to diffusive shear modes. The cutoff time obeys $t_c(L) = L^2 / \\left(4 \\pi^2 D\\right)$, where $D$ is a positive transport coefficient with units of $\\mathrm{nm}^2/\\mathrm{ps}$. Use only these bases and the provided parametric forms; do not assume any additional formula that directly gives the final finite-size scaling relationship.\n\nYour program must, for each provided test case, compute the finite-size Green-Kubo conductivity by integrating the specified integrand model, perform a regression in the inverse cell size to extrapolate the thermodynamic-limit conductivity, and compare the fitted finite-size scaling with the hydrodynamic expectation computed from the same parameters.\n\nModel for the GK integrand:\n- Let the GK integrand be $K(t) = K_{\\mathrm{fast}}(t) + K_{\\mathrm{tail}}(t)$, with\n  - $K_{\\mathrm{fast}}(t) = a \\, e^{-t/t_1} + b \\, e^{-t/t_2}$ for $t \\ge 0$,\n  - $K_{\\mathrm{tail}}(t) = C \\, t^{-3/2}$ for $t \\ge t_0$, and $K_{\\mathrm{tail}}(t) = 0$ for $0 \\le t  t_0$.\n- The finite-size cutoff time obeys $t_c(L) = L^2/\\left(4 \\pi^2 D\\right)$. For times $t  t_c(L)$, the contribution of the tail is suppressed by hydrodynamic mode quantization and may be taken as negligible.\n\nMathematical tasks for each test case:\n1. Compute the fast contribution to the conductivity as the time integral $\\int_0^\\infty K_{\\mathrm{fast}}(t) \\, dt$, which yields a finite, positive value with units of $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$.\n2. Compute the tail contribution for the infinite system as the time integral $\\int_{t_0}^\\infty C \\, t^{-3/2} \\, dt$.\n3. For a finite cell of size $L$, compute the tail contribution as $\\int_{t_0}^{t_c(L)} C \\, t^{-3/2} \\, dt$ if $t_c(L) \\ge t_0$, otherwise the tail contributes zero. The total finite-size conductivity is then the sum of the fast contribution and the finite-size tail integral. All conductivities must be expressed in $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$, rounded to six decimal places when reported.\n4. Assemble data pairs $\\left(x_i, y_i\\right)$ with $x_i = 1/L_i$ in $\\mathrm{nm}^{-1}$ and $y_i = \\kappa(L_i)$ in $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$ for the provided sizes $L_i$. Perform an unconstrained linear least-squares fit of the form $y = \\alpha + \\beta x$. Report the fitted thermodynamic-limit conductivity as $\\alpha$ and the fitted finite-size coefficient as $s_{\\mathrm{fit}} = -\\beta$ (so that $\\kappa(L) \\approx \\alpha - s_{\\mathrm{fit}}/L$).\n5. Using only the given parametric model and the hydrodynamic cutoff relation, compute the hydrodynamic prediction for the thermodynamic-limit conductivity and the leading finite-size coefficient from the same parameters. Express both in $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$, rounded to six decimals.\n\nTest suite:\n- Case A:\n  - Parameters: $a = 0.25$, $b = 0.10$, $t_1 = 1.5 \\, \\mathrm{ps}$, $t_2 = 6.0 \\, \\mathrm{ps}$, $C = 0.50$, $t_0 = 2.0 \\, \\mathrm{ps}$, $D = 0.08 \\, \\mathrm{nm}^2/\\mathrm{ps}$.\n  - Sizes: $L \\in \\{5, 8, 12, 20\\} \\, \\mathrm{nm}$.\n- Case B:\n  - Parameters: $a = 0.35$, $b = 0.05$, $t_1 = 1.0 \\, \\mathrm{ps}$, $t_2 = 8.0 \\, \\mathrm{ps}$, $C = 0.40$, $t_0 = 5.0 \\, \\mathrm{ps}$, $D = 0.05 \\, \\mathrm{nm}^2/\\mathrm{ps}$.\n  - Sizes: $L \\in \\{3, 4, 6, 10\\} \\, \\mathrm{nm}$.\n- Case C:\n  - Parameters: $a = 0.20$, $b = 0.15$, $t_1 = 2.0 \\, \\mathrm{ps}$, $t_2 = 3.0 \\, \\mathrm{ps}$, $C = 0.30$, $t_0 = 1.0 \\, \\mathrm{ps}$, $D = 0.20 \\, \\mathrm{nm}^2/\\mathrm{ps}$.\n  - Sizes: $L \\in \\{6, 9, 15, 30\\} \\, \\mathrm{nm}$.\n\nUnits and required outputs:\n- All conductivities and coefficients must be reported in $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$.\n- For each case, output a list of four floats: $\\left[\\kappa_{\\infty,\\mathrm{fit}}, \\kappa_{\\infty,\\mathrm{hydro}}, s_{\\mathrm{fit}}, s_{\\mathrm{hydro}}\\right]$, each rounded to six decimals, where $\\kappa_{\\infty,\\mathrm{fit}}$ and $s_{\\mathrm{fit}}$ come from the regression, and $\\kappa_{\\infty,\\mathrm{hydro}}$ and $s_{\\mathrm{hydro}}$ come from direct computation using the parametric model and the hydrodynamic cutoff relation.\n- Your program should produce a single line of output containing the results for all three cases as a comma-separated list of lists enclosed in square brackets, for example: $\\left[\\left[r_{1}, r_{2}, r_{3}, r_{4}\\right], \\left[\\dots\\right], \\left[\\dots\\right]\\right]$.\n\nNotes:\n- Treat $\\pi$ as the mathematical constant with its usual meaning.\n- Angles are not used in this problem.",
            "solution": "The problem requires the determination of the thermodynamic-limit thermal conductivity, $\\kappa_{\\infty}$, from a model of molecular dynamics (MD) data for finite-sized systems. This is a quintessential problem in computational statistical mechanics, involving the Green-Kubo (GK) relations and the theory of finite-size effects in transport coefficients. The solution will proceed by first deriving the analytical expressions for the quantities of interest from the provided model, and then implementing a numerical procedure to compute these quantities and perform a linear regression for the given test cases.\n\nThe foundation of the problem is the GK formula for thermal conductivity, $\\kappa$, which expresses it as the time integral of the equilibrium heat current autocorrelation function (HCACF). The problem provides a parametric model for the GK integrand, which we denote as $K(t)$:\n$$\nK(t) = K_{\\mathrm{fast}}(t) + K_{\\mathrm{tail}}(t)\n$$\nwhere\n$$\nK_{\\mathrm{fast}}(t) = a \\, e^{-t/t_1} + b \\, e^{-t/t_2} \\quad \\text{for } t \\ge 0\n$$\n$$\nK_{\\mathrm{tail}}(t) = \\begin{cases} C \\, t^{-3/2}  \\text{for } t \\ge t_0 \\\\ 0  \\text{for } 0 \\le t  t_0 \\end{cases}\n$$\nThe parameters $a$, $b$, $t_1$, $t_2$, $C$, and $t_0$ are given for each test case. The units of $a$, $b$, and $C$ are implicitly $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1} \\cdot \\mathrm{ps}^{-1}$, such that upon integration over time in $\\mathrm{ps}$, the result is a conductivity in $\\mathrm{W} \\, \\mathrm{m}^{-1} \\, \\mathrm{K}^{-1}$.\n\nFirst, we determine the \"hydrodynamic prediction\" for the thermal conductivity in the thermodynamic limit ($L \\to \\infty$) and the leading finite-size correction coefficient. In an infinite system, the conductivity $\\kappa_{\\infty,\\mathrm{hydro}}$ is obtained by integrating $K(t)$ over all time from $0$ to $\\infty$.\n\nThe contribution from the fast part is:\n$$\n\\kappa_{\\mathrm{fast}} = \\int_0^\\infty K_{\\mathrm{fast}}(t) \\, dt = \\int_0^\\infty (a \\, e^{-t/t_1} + b \\, e^{-t/t_2}) \\, dt\n$$\n$$\n\\kappa_{\\mathrm{fast}} = \\left[ -a t_1 e^{-t/t_1} - b t_2 e^{-t/t_2} \\right]_0^{\\infty} = (0 - (-a t_1 - b t_2)) = a t_1 + b t_2\n$$\n\nThe contribution from the tail part in an infinite system is:\n$$\n\\kappa_{\\mathrm{tail},\\infty} = \\int_{t_0}^\\infty K_{\\mathrm{tail}}(t) \\, dt = \\int_{t_0}^\\infty C t^{-3/2} \\, dt\n$$\n$$\n\\kappa_{\\mathrm{tail},\\infty} = C \\left[ -2 t^{-1/2} \\right]_{t_0}^{\\infty} = C (0 - (-2 t_0^{-1/2})) = \\frac{2C}{\\sqrt{t_0}}\n$$\n\nThe total thermodynamic-limit conductivity, from the hydrodynamic model, is the sum of these two contributions:\n$$\n\\kappa_{\\infty,\\mathrm{hydro}} = \\kappa_{\\mathrm{fast}} + \\kappa_{\\mathrm{tail},\\infty} = a t_1 + b t_2 + \\frac{2C}{\\sqrt{t_0}}\n$$\n\nFor a finite system of size $L$, hydrodynamic theory dictates that the long-time behavior of correlation functions is truncated. The long-wavelength modes that give rise to the $t^{-3/2}$ tail are quantized in a periodic box. The slowest mode corresponds to a wavelength of $L$, leading to a cutoff in the time integral at $t_c(L) = L^2 / (4 \\pi^2 D)$, where $D$ is a relevant transport coefficient. The finite-size conductivity, $\\kappa(L)$, is thus obtained by integrating the tail only up to this cutoff time:\n$$\n\\kappa(L) = \\kappa_{\\mathrm{fast}} + \\int_{t_0}^{t_c(L)} C t^{-3/2} \\, dt\n$$\nThis is valid under the condition that $t_c(L) \\ge t_0$. If $t_c(L)  t_0$, the tail part does not contribute, and $\\kappa(L) = \\kappa_{\\mathrm{fast}}$.\nAssuming $t_c(L) \\ge t_0$, the integral evaluates to:\n$$\n\\int_{t_0}^{t_c(L)} C t^{-3/2} \\, dt = C \\left[ -2 t^{-1/2} \\right]_{t_0}^{t_c(L)} = 2C \\left( t_0^{-1/2} - t_c(L)^{-1/2} \\right)\n$$\nSubstituting this into the expression for $\\kappa(L)$:\n$$\n\\kappa(L) = (a t_1 + b t_2) + 2C \\left( \\frac{1}{\\sqrt{t_0}} - \\frac{1}{\\sqrt{t_c(L)}} \\right)\n$$\nWe can recognize the first two terms as $\\kappa_{\\infty,\\mathrm{hydro}}$. Substituting the expression for $t_c(L)$:\n$$\n\\kappa(L) = \\kappa_{\\infty,\\mathrm{hydro}} - \\frac{2C}{\\sqrt{L^2 / (4 \\pi^2 D)}} = \\kappa_{\\infty,\\mathrm{hydro}} - \\frac{2C}{(L / (2 \\pi \\sqrt{D}))}\n$$\n$$\n\\kappa(L) = \\kappa_{\\infty,\\mathrm{hydro}} - \\left( 4 \\pi C \\sqrt{D} \\right) \\frac{1}{L}\n$$\nThis equation is of the form $\\kappa(L) \\approx \\alpha - s/L$. This provides the analytical or \"hydrodynamic\" prediction for the leading finite-size coefficient:\n$$\ns_{\\mathrm{hydro}} = 4 \\pi C \\sqrt{D}\n$$\n\nThe numerical task is to calculate $\\kappa(L_i)$ for a set of system sizes $\\{L_i\\}$ and then perform a linear least-squares fit to the data pairs $(x_i, y_i) = (1/L_i, \\kappa(L_i))$ using the model $y = \\alpha + \\beta x$. The fitted parameters are identified as:\n- $\\kappa_{\\infty,\\mathrm{fit}} = \\alpha$ (the y-intercept, which corresponds to $1/L \\to 0$, i.e., $L \\to \\infty$).\n- $s_{\\mathrm{fit}} = -\\beta$ (the negative of the slope).\n\nFor each test case, we follow these steps:\n1.  Calculate the analytical values $\\kappa_{\\infty,\\mathrm{hydro}}$ and $s_{\\mathrm{hydro}}$ using the derived formulas.\n2.  For each given size $L_i$:\n    a. Calculate $t_c(L_i) = L_i^2 / (4 \\pi^2 D)$.\n    b. Calculate $\\kappa_{\\mathrm{fast}} = a t_1 + b t_2$.\n    c. If $t_c(L_i) \\ge t_0$, calculate $\\kappa_{\\mathrm{tail}}(L_i) = 2C(t_0^{-1/2} - t_c(L_i)^{-1/2})$. The total conductivity is $\\kappa(L_i) = \\kappa_{\\mathrm{fast}} + \\kappa_{\\mathrm{tail}}(L_i)$.\n    d. If $t_c(L_i)  t_0$, $\\kappa(L_i) = \\kappa_{\\mathrm{fast}}$.\n    e. Store the pair $(1/L_i, \\kappa(L_i))$.\n3.  Perform a linear regression on the collected data pairs to find the slope $\\beta$ and intercept $\\alpha$. This can be done by solving the normal equations for the least-squares problem or using a library function like `numpy.linalg.lstsq`.\n4.  Determine the fitted parameters $\\kappa_{\\infty,\\mathrm{fit}} = \\alpha$ and $s_{\\mathrm{fit}} = -\\beta$.\n5.  Report the four values: $\\kappa_{\\infty,\\mathrm{fit}}$, $\\kappa_{\\infty,\\mathrm{hydro}}$, $s_{\\mathrm{fit}}$, and $s_{\\mathrm{hydro}}$, rounded to six decimal places.\n\nIf all data points $(1/L_i, \\kappa(L_i))$ satisfy the condition $t_c(L_i) \\ge t_0$, they will lie perfectly on a straight line. In this scenario, the regression will exactly recover the analytical parameters, i.e., $\\kappa_{\\infty,\\mathrm{fit}} = \\kappa_{\\infty,\\mathrm{hydro}}$ and $s_{\\mathrm{fit}} = s_{\\mathrm{hydro}}$. However, if for some smaller sizes $L_i$, the condition $t_c(L_i)  t_0$ is met, those data points will not lie on the same asymptotic line as the others. This introduces curvature into the plot of $\\kappa$ vs. $1/L$, and a linear fit to all points will yield fitted parameters that deviate from the true hydrodynamic asymptotic values. This situation models a realistic data analysis scenario where data from small systems may not be in the asymptotic scaling regime.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Green-Kubo finite-size scaling problem for the provided test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"params\": {\"a\": 0.25, \"b\": 0.10, \"t1\": 1.5, \"t2\": 6.0, \"C\": 0.50, \"t0\": 2.0, \"D\": 0.08},\n            \"sizes\": [5, 8, 12, 20]\n        },\n        {\n            \"params\": {\"a\": 0.35, \"b\": 0.05, \"t1\": 1.0, \"t2\": 8.0, \"C\": 0.40, \"t0\": 5.0, \"D\": 0.05},\n            \"sizes\": [3, 4, 6, 10]\n        },\n        {\n            \"params\": {\"a\": 0.20, \"b\": 0.15, \"t1\": 2.0, \"t2\": 3.0, \"C\": 0.30, \"t0\": 1.0, \"D\": 0.20},\n            \"sizes\": [6, 9, 15, 30]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        p = case[\"params\"]\n        sizes = case[\"sizes\"]\n        \n        a, b, t1, t2, C, t0, D = p[\"a\"], p[\"b\"], p[\"t1\"], p[\"t2\"], p[\"C\"], p[\"t0\"], p[\"D\"]\n        \n        # 1. Compute hydrodynamic predictions (analytical)\n        kappa_fast = a * t1 + b * t2\n        kappa_tail_inf = 2 * C / np.sqrt(t0)\n        kappa_inf_hydro = kappa_fast + kappa_tail_inf\n        s_hydro = 4 * np.pi * C * np.sqrt(D)\n\n        # 2. Generate finite-size conductivity data for regression\n        x_vals = []\n        y_vals = []\n        \n        for L in sizes:\n            tc = L**2 / (4 * np.pi**2 * D)\n            \n            if tc >= t0:\n                kappa_tail_L = 2 * C * (1/np.sqrt(t0) - 1/np.sqrt(tc))\n                kappa_L = kappa_fast + kappa_tail_L\n            else:\n                kappa_L = kappa_fast\n\n            x_vals.append(1/L)\n            y_vals.append(kappa_L)\n            \n        x = np.array(x_vals)\n        y = np.array(y_vals)\n        \n        # 3. Perform unconstrained linear least-squares fit: y = alpha + beta*x\n        # The design matrix A has a column of ones (for intercept) and a column of x values.\n        A = np.vstack([np.ones(len(x)), x]).T\n        \n        # Solve the linear system A*p = y for the coefficients p = [alpha, beta]\n        p_fit, _, _, _ = np.linalg.lstsq(A, y, rcond=None)\n        alpha, beta = p_fit[0], p_fit[1]\n        \n        # 4. Extract fitted parameters\n        kappa_inf_fit = alpha\n        s_fit = -beta\n        \n        # 5. Store results, rounded to six decimal places\n        result_tuple = (\n            round(kappa_inf_fit, 6),\n            round(kappa_inf_hydro, 6),\n            round(s_fit, 6),\n            round(s_hydro, 6)\n        )\n        all_results.append(result_tuple)\n\n    # Final print statement in the exact required format.\n    # Eg: [[v1,v2,v3,v4],[v1,v2,v3,v4],...]\n    formatted_results = [f\"[{','.join(f'{v:.6f}' for v in res)}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having mastered the macroscopic calculation of $\\kappa$, we now delve into its microscopic origins within a crystalline solid. This practice connects the phenomenological Green-Kubo formula to the fundamental picture of heat transport by vibrational modes, or phonons . You will derive and apply the mode-resolved conductivity expression, learning how to quantify the contribution of each individual phonon mode based on its heat capacity, group velocity, and lifetime, thereby bridging the gap between atomistic dynamics and bulk transport.",
            "id": "3749312",
            "problem": "You are asked to formalize and implement a mode-resolved computation of thermal conductivity along one Cartesian direction for a harmonic crystalline solid, using normal mode analysis and linear response theory. The core objective is to connect the projection of the heat flux onto phonon normal modes to the Green–Kubo (GK) formula, and then compute the mode-resolved contributions to the conductivity from parameters that characterize each mode. Your final deliverable must be a complete, runnable program that evaluates a specified test suite.\n\nThe foundational starting points you must use are:\n- Newton’s second law and the harmonic lattice Hamiltonian. For a crystal with atomic displacements $\\{u_i\\}$ and masses $\\{m_i\\}$, the harmonic Hamiltonian is $H = \\sum_i \\frac{p_i^2}{2 m_i} + \\frac{1}{2} \\sum_{i,j} u_i K_{ij} u_j$, where $K$ is the force-constant (Hessian) matrix, and $p_i$ are the momenta.\n- The orthonormality and completeness of the mass-weighted normal modes. Let the eigenvalue problem on the mass-weighted Hessian be $\\tilde{K} \\mathbf{e}_s = \\omega_s^2 \\mathbf{e}_s$ with $\\tilde{K} = M^{-1/2} K M^{-1/2}$, eigenvectors $\\mathbf{e}_s$, and angular frequencies $\\omega_s$. Normal coordinates $Q_s$ and conjugate momenta $P_s$ describe the independent harmonic modes.\n- Thermal equilibrium in the classical limit and the fluctuation–dissipation relation for energy fluctuations. If $E_s$ is the energy of mode $s$ and $C_s$ is its heat capacity at constant volume, then the variance of equilibrium energy fluctuations is $\\langle \\delta E_s^2 \\rangle = k_{\\mathrm{B}} T^2 C_s$, where $k_{\\mathrm{B}}$ is the Boltzmann constant and $T$ is the absolute temperature.\n- The Green–Kubo (GK) formula for thermal conductivity along $x$: $k_{xx} = \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\langle J_x(0) J_x(t) \\rangle \\, dt$, where $V$ is the system volume and $J_x$ is the $x$-component of the microscopic heat flux.\n\nYour tasks:\n1) Starting from the harmonic Hamiltonian and the normal mode representation, use energy continuity and the definition of group velocity to show how the microscopic heat flux along $x$ can be decomposed into contributions carried by independent normal modes. Express the $x$-directed modal heat flux in terms of the mode energy $E_s$, the $x$-component of the group velocity $v_{s,x}$, and the system volume $V$.\n2) Assume weak scattering or weak Langevin damping produces a finite relaxation time $\\tau_s$ for each mode $s$, and that different modes are statistically independent so that cross-correlations of modal heat flux vanish. Model the equilibrium autocorrelation of the mode energy fluctuations as an exponential decay with time constant $\\tau_s$. Derive the modal heat flux autocorrelation $\\langle J_{s,x}(0) J_{s,x}(t) \\rangle$ in closed form in terms of $k_{\\mathrm{B}}$, $T$, $V$, $C_s$, $v_{s,x}$, and $\\tau_s$.\n3) Using the Green–Kubo formula and your modal decomposition, derive an expression for the mode-resolved contribution to $k_{xx}$ and the total $k_{xx}$ as a sum over modes. Your derivation must start from the above foundational laws and proceed by logical steps, without assuming any target formula.\n4) Numerical implementation. For a set of modes with given parameters $\\{C_s\\}$, $\\{v_{s,x}\\}$, and $\\{\\tau_s\\}$, define a synthetic total heat flux autocorrelation function along $x$ by summing the modal autocorrelations you derived. Approximate the Green–Kubo time integral using the trapezoidal rule for a time grid $t_n = n \\Delta t$ for $n=0,1,\\dots, N$ where $N \\Delta t = t_{\\max}$. Compute two quantities for each test case:\n   - The analytically derived mode-sum conductivity using your closed-form expression based on mode parameters. Call this $k_{xx}^{\\mathrm{exact}}$.\n   - The numerically integrated conductivity $k_{xx}^{\\mathrm{GK}}$ obtained by trapezoidal integration of the synthetic autocorrelation truncated at $t_{\\max}$.\n   Then report the relative error as a decimal number: $\\varepsilon = \\frac{k_{xx}^{\\mathrm{GK}} - k_{xx}^{\\mathrm{exact}}}{k_{xx}^{\\mathrm{exact}}}$.\n\nPhysical and numerical details:\n- Use the Boltzmann constant $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ in $\\mathrm{J/K}$.\n- All heat capacities $C_s$ are given in $\\mathrm{J/K}$, all group velocities $v_{s,x}$ in $\\mathrm{m/s}$, all relaxation times $\\tau_s$ in $\\mathrm{s}$, volume $V$ in $\\mathrm{m}^3$, temperature $T$ in $\\mathrm{K}$, and the resulting thermal conductivities in $\\mathrm{W/(m\\cdot K)}$.\n- Implement the trapezoidal rule on $[0,t_{\\max}]$ with uniform time step $\\Delta t$.\n\nTest suite:\nProvide a single program that evaluates the following three test cases and outputs all results in one line.\n\n- Test case $1$ (happy path):\n  - $V = 1.0 \\times 10^{-27}\\ \\mathrm{m}^3$, $T = 300\\ \\mathrm{K}$,\n  - $C_s = [1.380649 \\times 10^{-23},\\ 1.380649 \\times 10^{-23}]\\ \\mathrm{J/K}$,\n  - $v_{s,x} = [2000.0,\\ 1000.0]\\ \\mathrm{m/s}$,\n  - $\\tau_s = [5.0 \\times 10^{-12},\\ 2.0 \\times 10^{-12}]\\ \\mathrm{s}$,\n  - $\\Delta t = 5.0 \\times 10^{-14}\\ \\mathrm{s}$, $t_{\\max} = 5.0 \\times 10^{-11}\\ \\mathrm{s}$.\n- Test case $2$ (includes a mode with zero group velocity):\n  - $V = 1.0 \\times 10^{-27}\\ \\mathrm{m}^3$, $T = 300\\ \\mathrm{K}$,\n  - $C_s = [1.380649 \\times 10^{-23},\\ 1.380649 \\times 10^{-23},\\ 1.380649 \\times 10^{-23}]\\ \\mathrm{J/K}$,\n  - $v_{s,x} = [3000.0,\\ 0.0,\\ 1500.0]\\ \\mathrm{m/s}$,\n  - $\\tau_s = [1.0 \\times 10^{-12},\\ 1.0 \\times 10^{-11},\\ 5.0 \\times 10^{-12}]\\ \\mathrm{s}$,\n  - $\\Delta t = 5.0 \\times 10^{-14}\\ \\mathrm{s}$, $t_{\\max} = 2.0 \\times 10^{-11}\\ \\mathrm{s}$.\n- Test case $3$ (long relaxation time with finite integration window):\n  - $V = 1.0 \\times 10^{-27}\\ \\mathrm{m}^3$, $T = 300\\ \\mathrm{K}$,\n  - $C_s = [1.380649 \\times 10^{-23}]\\ \\mathrm{J/K}$,\n  - $v_{s,x} = [2000.0]\\ \\mathrm{m/s}$,\n  - $\\tau_s = [1.0 \\times 10^{-9}]\\ \\mathrm{s}$,\n  - $\\Delta t = 1.0 \\times 10^{-13}\\ \\mathrm{s}$, $t_{\\max} = 1.0 \\times 10^{-10}\\ \\mathrm{s}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- For each test case, append three floating-point numbers in this order: $k_{xx}^{\\mathrm{exact}}$ in $\\mathrm{W/(m\\cdot K)}$, $k_{xx}^{\\mathrm{GK}}$ in $\\mathrm{W/(m\\cdot K)}$, and $\\varepsilon$ as a decimal.\n- The final line should therefore contain $9$ numbers corresponding to the $3$ test cases in sequence, for example: [$k_{1}^{\\mathrm{exact}},k_{1}^{\\mathrm{GK}},\\varepsilon_1,k_{2}^{\\mathrm{exact}},k_{2}^{\\mathrm{GK}},\\varepsilon_2,k_{3}^{\\mathrm{exact}},k_{3}^{\\mathrm{GK}},\\varepsilon_3$].\n- Express all $9$ numbers in scientific notation with six significant digits (for example, $1.234560\\mathrm{e}{-3}$). All conductivities must be in $\\mathrm{W/(m\\cdot K)}$ and all errors must be decimals without a percentage sign.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be valid. It is scientifically sound, well-posed, and objective, presenting a standard problem in theoretical condensed matter physics. All necessary principles, parameters, and constraints are provided, allowing for a rigorous derivation and subsequent numerical implementation.\n\n### Theoretical Derivation\n\nThe derivation proceeds in three stages as delineated by the problem's tasks.\n\n**1. Modal Decomposition of the Heat Flux**\n\nThe starting point is the concept of energy conservation. For a continuous medium, the local conservation of energy is expressed by the continuity equation:\n$$\n\\frac{\\partial \\mathcal{E}(\\mathbf{r}, t)}{\\partial t} + \\nabla \\cdot \\mathbf{J}(\\mathbf{r}, t) = 0\n$$\nwhere $\\mathcal{E}(\\mathbf{r}, t)$ is the energy density and $\\mathbf{J}(\\mathbf{r}, t)$ is the energy flux density, or heat flux.\n\nIn a harmonic crystal, the total energy is distributed among independent normal modes, indexed by $s$. Each mode represents a collective, wave-like oscillation of the atoms. The energy of a mode, $E_s$, is contained within the volume $V$ of the solid, giving an average energy density for that mode of $\\mathcal{E}_s = E_s / V$.\n\nA fundamental property of a wave packet is that it transports its energy at the group velocity, $\\mathbf{v}_s$. The group velocity for a phonon mode $s$ with frequency $\\omega_s$ and wavevector $\\mathbf{q}_s$ is given by $\\mathbf{v}_s = \\nabla_{\\mathbf{q}} \\omega_s$. The energy flux carried by this single mode is the product of its energy density and its transport velocity:\n$$\n\\mathbf{J}_s = \\mathcal{E}_s \\mathbf{v}_s = \\frac{E_s}{V} \\mathbf{v}_s\n$$\nSince the normal modes are independent in the harmonic approximation, the total heat flux $\\mathbf{J}$ is the vector sum of the contributions from all modes:\n$$\n\\mathbf{J} = \\sum_s \\mathbf{J}_s = \\frac{1}{V} \\sum_s E_s \\mathbf{v}_s\n$$\nThe component of the heat flux along the Cartesian direction $x$ is therefore:\n$$\nJ_x = \\frac{1}{V} \\sum_s E_s v_{s,x}\n$$\nwhere $v_{s,x}$ is the $x$-component of the group velocity of mode $s$. At thermal equilibrium, the net heat flux is zero, meaning $\\langle J_x \\rangle = 0$. This implies that the heat flux $J_x$ represents fluctuations around a zero mean. The fluctuating quantity in the above expression is the modal energy $E_s(t)$, as the group velocity $v_{s,x}$ is a static property of the crystal's dispersion relation. The relevant expression for the fluctuating heat flux is thus $J_x(t) = \\frac{1}{V} \\sum_s \\delta E_s(t) v_{s,x}$, where $\\delta E_s(t) = E_s(t) - \\langle E_s \\rangle$ is the fluctuation in the energy of mode $s$. The contribution of mode $s$ to the total fluctuating heat flux is $J_{s,x}(t) = \\frac{\\delta E_s(t) v_{s,x}}{V}$.\n\n**2. Modal Heat Flux Autocorrelation**\n\nThe next task is to derive the equilibrium time-autocorrelation function of the modal heat flux, $\\langle J_{s,x}(0) J_{s,x}(t) \\rangle$. Using the expression derived above:\n$$\n\\langle J_{s,x}(0) J_{s,x}(t) \\rangle = \\left\\langle \\frac{\\delta E_s(0) v_{s,x}}{V} \\cdot \\frac{\\delta E_s(t) v_{s,x}}{V} \\right\\rangle\n$$\nSince $v_{s,x}$ and $V$ are constants for a given mode and system, they can be taken outside the ensemble average:\n$$\n\\langle J_{s,x}(0) J_{s,x}(t) \\rangle = \\frac{v_{s,x}^2}{V^2} \\langle \\delta E_s(0) \\delta E_s(t) \\rangle\n$$\nThe problem provides two key pieces of information to evaluate the energy fluctuation autocorrelation. First, the fluctuation-dissipation relation, which connects the variance of energy fluctuations to the heat capacity $C_s$ of the mode:\n$$\n\\langle \\delta E_s^2 \\rangle = \\langle \\delta E_s(0) \\delta E_s(0) \\rangle = k_{\\mathrm{B}} T^2 C_s\n$$\nwhere $k_{\\mathrm{B}}$ is the Boltzmann constant and $T$ is the temperature. In the classical limit for a harmonic oscillator, the average energy is $\\langle E_s \\rangle = k_{\\mathrm{B}} T$, so its heat capacity is $C_s = \\frac{\\partial \\langle E_s \\rangle}{\\partial T} = k_{\\mathrm{B}}$, which is consistent with the values provided in the test suite.\n\nSecond, we are instructed to model the time-dependence of the energy fluctuation autocorrelation as an exponential decay, characteristic of a relaxation process with a single time constant $\\tau_s$:\n$$\n\\langle \\delta E_s(0) \\delta E_s(t) \\rangle = \\langle \\delta E_s^2 \\rangle e^{-|t|/\\tau_s}\n$$\nSubstituting the fluctuation-dissipation relation into this expression gives:\n$$\n\\langle \\delta E_s(0) \\delta E_s(t) \\rangle = k_{\\mathrm{B}} T^2 C_s e^{-|t|/\\tau_s}\n$$\nFinally, substituting this result back into the expression for the modal heat flux autocorrelation yields the desired closed form:\n$$\n\\langle J_{s,x}(0) J_{s,x}(t) \\rangle = \\frac{k_{\\mathrm{B}} T^2 C_s v_{s,x}^2}{V^2} e^{-|t|/\\tau_s}\n$$\n\n**3. Mode-Resolved and Total Thermal Conductivity**\n\nThe Green-Kubo (GK) formula relates the thermal conductivity tensor component $k_{xx}$ to the time integral of the total heat flux autocorrelation function (HFACF):\n$$\nk_{xx} = \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\langle J_x(0) J_x(t) \\rangle \\, dt\n$$\nThe total HFACF, $\\langle J_x(0) J_x(t) \\rangle$, can be expanded in terms of the modal contributions:\n$$\n\\langle J_x(0) J_x(t) \\rangle = \\left\\langle \\left(\\sum_s J_{s,x}(0)\\right) \\left(\\sum_{s'} J_{s',x}(t)\\right) \\right\\rangle = \\sum_s \\sum_{s'} \\langle J_{s,x}(0) J_{s',x}(t) \\rangle\n$$\nAs stated in the problem, we assume the dynamics of different modes are statistically independent. This implies that the cross-correlation terms vanish, i.e., $\\langle J_{s,x}(0) J_{s',x}(t) \\rangle = 0$ for $s \\neq s'$. The total HFACF simplifies to a sum of the individual modal autocorrelations:\n$$\n\\langle J_x(0) J_x(t) \\rangle = \\sum_s \\langle J_{s,x}(0) J_{s,x}(t) \\rangle\n$$\nSubstituting this decomposition into the GK formula and exploiting the linearity of the integral and summation operators, we can interchange their order:\n$$\nk_{xx} = \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\left( \\sum_s \\langle J_{s,x}(0) J_{s,x}(t) \\rangle \\right) dt = \\sum_s \\left( \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\langle J_{s,x}(0) J_{s,x}(t) \\rangle \\, dt \\right)\n$$\nThis shows that the total thermal conductivity is a sum of mode-resolved contributions, $k_{xx} = \\sum_s k_{s,xx}$, where each contribution $k_{s,xx}$ is given by:\n$$\nk_{s,xx} = \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\langle J_{s,x}(0) J_{s,x}(t) \\rangle \\, dt\n$$\nNow, we substitute the expression for $\\langle J_{s,x}(0) J_{s,x}(t) \\rangle$ from the previous step:\n$$\nk_{s,xx} = \\frac{V}{k_{\\mathrm{B}} T^2} \\int_0^{\\infty} \\left( \\frac{k_{\\mathrm{B}} T^2 C_s v_{s,x}^2}{V^2} e^{-t/\\tau_s} \\right) dt\n$$\nThe prefactors $\\frac{V}{k_{\\mathrm{B}} T^2}$ and $k_{\\mathrm{B}} T^2 / V^2$ largely cancel, simplifying the expression to:\n$$\nk_{s,xx} = \\frac{C_s v_{s,x}^2}{V} \\int_0^{\\infty} e^{-t/\\tau_s} \\, dt\n$$\nThe definite integral evaluates to the relaxation time $\\tau_s$:\n$$\n\\int_0^{\\infty} e^{-t/\\tau_s} \\, dt = [-\\tau_s e^{-t/\\tau_s}]_0^{\\infty} = 0 - (-\\tau_s) = \\tau_s\n$$\nThis yields the final analytical expression for the contribution of mode $s$ to the thermal conductivity:\n$$\nk_{s,xx} = \\frac{C_s v_{s,x}^2 \\tau_s}{V}\n$$\nThe total thermal conductivity, which we will call $k_{xx}^{\\mathrm{exact}}$, is the sum over all modes:\n$$\nk_{xx}^{\\mathrm{exact}} = \\sum_s k_{s,xx} = \\frac{1}{V} \\sum_s C_s v_{s,x}^2 \\tau_s\n$$\nThis is a well-known result analogous to the kinetic theory expression for conductivity.\n\n**4. Numerical Implementation Plan**\n\nThe numerical task is to compare the analytical result with a numerical evaluation of the GK integral.\n\n- **Analytical Calculation, $k_{xx}^{\\mathrm{exact}}$:** This is computed directly using the final formula derived above: $k_{xx}^{\\mathrm{exact}} = \\frac{1}{V} \\sum_s C_s v_{s,x}^2 \\tau_s$.\n\n- **Numerical Calculation, $k_{xx}^{\\mathrm{GK}}$:** This involves numerically integrating the synthetic total HFACF.\n  - The synthetic total HFACF is $C_{JJ}(t) = \\langle J_x(0) J_x(t) \\rangle = \\sum_s \\frac{k_{\\mathrm{B}} T^2 C_s v_{s,x}^2}{V^2} e^{-t/\\tau_s}$.\n  - The GK integral is numerically approximated up to a finite cutoff time $t_{\\max}$: $I = \\int_0^{t_{\\max}} C_{JJ}(t) \\, dt$. This integral will be computed using the trapezoidal rule on a uniform time grid $t_n = n \\Delta t$.\n  - The numerically computed conductivity is then $k_{xx}^{\\mathrm{GK}} = \\frac{V}{k_{\\mathrm{B}} T^2} I$.\n  - The relative error is calculated as $\\varepsilon = (k_{xx}^{\\mathrm{GK}} - k_{xx}^{\\mathrm{exact}}) / k_{xx}^{\\mathrm{exact}}$. The primary source of this error will be the truncation of the integral at $t_{\\max}$ rather than $\\infty$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates mode-resolved thermal conductivity using both an analytical formula\n    and a numerical Green-Kubo integration for a set of test cases.\n    \"\"\"\n    # Define the Boltzmann constant\n    k_B = 1.380649e-23  # J/K\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (happy path)\n        {\n            \"V\": 1.0e-27, \"T\": 300.0,\n            \"C_s\": np.array([1.380649e-23, 1.380649e-23]),\n            \"v_sx\": np.array([2000.0, 1000.0]),\n            \"tau_s\": np.array([5.0e-12, 2.0e-12]),\n            \"dt\": 5.0e-14, \"t_max\": 5.0e-11\n        },\n        # Test case 2 (includes a mode with zero group velocity)\n        {\n            \"V\": 1.0e-27, \"T\": 300.0,\n            \"C_s\": np.array([1.380649e-23, 1.380649e-23, 1.380649e-23]),\n            \"v_sx\": np.array([3000.0, 0.0, 1500.0]),\n            \"tau_s\": np.array([1.0e-12, 1.0e-11, 5.0e-12]),\n            \"dt\": 5.0e-14, \"t_max\": 2.0e-11\n        },\n        # Test case 3 (long relaxation time with finite integration window)\n        {\n            \"V\": 1.0e-27, \"T\": 300.0,\n            \"C_s\": np.array([1.380649e-23]),\n            \"v_sx\": np.array([2000.0]),\n            \"tau_s\": np.array([1.0e-9]),\n            \"dt\": 1.0e-13, \"t_max\": 1.0e-10\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        V = case[\"V\"]\n        T = case[\"T\"]\n        C_s = case[\"C_s\"]\n        v_sx = case[\"v_sx\"]\n        tau_s = case[\"tau_s\"]\n        dt = case[\"dt\"]\n        t_max = case[\"t_max\"]\n\n        # 1. Calculate the analytical conductivity, k_xx_exact\n        # k_xx_exact = (1/V) * sum_s(C_s * v_sx^2 * tau_s)\n        k_xx_exact = (1.0 / V) * np.sum(C_s * v_sx**2 * tau_s)\n\n        # 2. Calculate the numerically integrated conductivity, k_xx_GK\n        \n        # Define the synthetic total heat flux autocorrelation function (HFACF)\n        # C_JJ(t) = sum_s { (k_B * T^2 * C_s * v_sx^2 / V^2) * exp(-t/tau_s) }\n        def C_JJ(t_grid):\n            # Ensure t_grid is a NumPy array for broadcasting\n            t_grid_np = np.asarray(t_grid)\n\n            # Use broadcasting for an efficient calculation over all time points and modes.\n            # t_grid_np shape: (num_times,) -> (num_times, 1)\n            # tau_s shape: (num_modes,) -> (1, num_modes)\n            # This results in a (num_times, num_modes) matrix for the exponential term.\n            t_reshaped = t_grid_np.reshape(-1, 1)\n            tau_s_reshaped = tau_s.reshape(1, -1)\n            \n            # This term has shape (num_modes,)\n            modal_amplitudes = C_s * v_sx**2\n            \n            # This calculates exp(-t/tau) for all combinations of t and tau\n            exp_terms = np.exp(-t_reshaped / tau_s_reshaped)\n            \n            # Sum over modes (axis=1) after multiplying by amplitudes\n            sum_over_modes = np.sum(modal_amplitudes * exp_terms, axis=1)\n\n            # Final scaling factor for C_JJ(t)\n            prefactor_CJJ = (k_B * T**2) / (V**2)\n            \n            return prefactor_CJJ * sum_over_modes\n\n        # Set up the time grid for numerical integration\n        num_points = int(round(t_max / dt)) + 1\n        time_grid = np.linspace(0.0, t_max, num_points)\n        \n        # Calculate HFACF values on the grid\n        hfacf_values = C_JJ(time_grid)\n        \n        # Integrate the HFACF using the trapezoidal rule (np.trapz is ideal)\n        integral_hfacf = np.trapz(hfacf_values, x=time_grid)\n        \n        # Calculate k_xx_GK from the Green-Kubo formula\n        prefactor_GK = V / (k_B * T**2)\n        k_xx_GK = prefactor_GK * integral_hfacf\n\n        # 3. Calculate the relative error\n        if k_xx_exact == 0.0:\n            # Avoid division by zero if exact conductivity is zero\n            rel_error = 0.0 if k_xx_GK == 0.0 else np.inf\n        else:\n            rel_error = (k_xx_GK - k_xx_exact) / k_xx_exact\n        \n        results.extend([k_xx_exact, k_xx_GK, rel_error])\n\n    # Final print statement in the exact required format.\n    # Format all numbers in scientific notation with six significant digits.\n    # The format specifier {:.6e} produces one digit before the decimal point\n    # and six digits after, which fulfills the requirement.\n    formatted_results = [f\"{val:.6e}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}