{
    "hands_on_practices": [
        {
            "introduction": "Before applying the Jarzynski equality as a black box, it is essential to understand its origins from first principles. This exercise guides you through a foundational derivation for two canonical models in statistical mechanics: a classical harmonic oscillator and a quantum two-level system. By working through these exactly solvable cases , you will build a concrete intuition for how the ensemble average of exponentiated work relates directly to the equilibrium partition functions and, consequently, the free energy difference.",
            "id": "3772099",
            "problem": "Consider two prototypical systems subjected to an instantaneous parameter quench at time $t=0$, each initially prepared in a canonical equilibrium ensemble at temperature $T$ with inverse temperature $\\beta = 1/(k_{B} T)$, where $k_{B}$ is the Boltzmann constant. In both cases, define the work $W$ performed on the system by the quench as the change in the Hamiltonian evaluated on the microstate at the instant of the quench, and define the dimensionless quantity $Q \\equiv -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$ where $\\langle \\cdot \\rangle$ denotes the appropriate ensemble average over initial conditions and measurement outcomes. Your task is to derive analytic expressions for $Q$ from first principles, starting from the canonical ensemble and the definitions of work and Helmholtz free energy, without invoking any shortcut formulas. Report the two results as a single row matrix as $[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}]$, where $Q_{\\mathrm{ho}}$ corresponds to the harmonic oscillator and $Q_{\\mathrm{tls}}$ to the two-level system. Express your final answers in terms of symbolic parameters only and do not include units in the final boxed answer.\n\nSystem A (classical harmonic oscillator): The Hamiltonian is $H(x,p;k)=\\frac{p^{2}}{2m} + \\frac{1}{2} k x^{2}$ for a particle of mass $m$, with spring constant $k$. The system is initially equilibrated with spring constant $k_{0}$ at temperature $T$. At $t=0$, the spring constant is suddenly quenched from $k_{0}$ to $k_{1}$, leaving the phase-space point $(x,p)$ unchanged at the instant of the quench. Using the canonical ensemble for the initial distribution and the instantaneous work definition, compute $Q_{\\mathrm{ho}}$.\n\nSystem B (quantum two-level system): The Hamiltonian $H(\\epsilon)$ has two energy eigenvalues $E_{0}(\\epsilon)=0$ and $E_{1}(\\epsilon)=\\epsilon$ with $\\epsilon \\ge 0$. The system is initially equilibrated at temperature $T$ with parameter $\\epsilon_{0}$. At $t=0$, $\\epsilon$ is suddenly quenched from $\\epsilon_{0}$ to $\\epsilon_{1}$. Adopt the standard projective energy measurement definition of work: measure the energy just before the quench, then immediately after the quench, with the instantaneous quench implying no change of the state during the quench. Under this protocol, the work takes the values $W=0$ if the system was in the ground state initially, and $W=\\epsilon_{1}-\\epsilon_{0}$ if it was initially in the excited state. Using the initial canonical distribution over energy eigenstates, compute $Q_{\\mathrm{tls}}$.\n\nAnswer specification:\n- Provide a single analytic expression for each $Q$ in terms of the parameters specified above.\n- Report your two answers together as a single row matrix $[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}]$.\n- The final answers must be dimensionless. Do not include units in the final boxed answer.",
            "solution": "The problem requires the calculation of the dimensionless quantity $Q \\equiv -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$ for two systems undergoing an instantaneous parameter quench. The initial state of each system is a canonical equilibrium ensemble at inverse temperature $\\beta = 1/(k_{B} T)$. The angle brackets $\\langle \\cdot \\rangle$ denote an average over the initial canonical distribution. We will perform the calculations from first principles for each system. The fundamental approach involves evaluating the ensemble average of the exponentiated work, $\\left\\langle \\exp(-\\beta W) \\right\\rangle$.\n\nFor a generic system with an initial Hamiltonian $H_0$ and a corresponding initial equilibrium probability distribution $\\rho_0$, the average of a quantity $A$ is given by $\\langle A \\rangle = \\int A \\rho_0 d\\Gamma$ in the classical case, or $\\langle A \\rangle = \\mathrm{Tr}(\\rho_0 A)$ in the quantum case, where $\\rho_0 = \\exp(-\\beta H_0)/Z_0$ and $Z_0$ is the initial partition function. The work $W$ is a function of the system's state during the non-equilibrium process.\n\nThe quantity to be calculated is $Q = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$. We can express the average as:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{1}{Z_0} \\int \\exp(-\\beta H_0) \\exp(-\\beta W) d\\Gamma \\quad \\text{(Classical case)}\n$$\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\mathrm{Tr}\\left( \\frac{\\exp(-\\beta H_0)}{Z_0} \\exp(-\\beta \\hat{W}) \\right) \\quad \\text{(Quantum case, with work as an operator)}\n$$\nWe proceed by analyzing each system separately.\n\nFirst, consider System A, the classical harmonic oscillator.\nThe initial Hamiltonian is $H_0(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} k_{0} x^{2}$. The system is initially in thermal equilibrium with this Hamiltonian.\nAt time $t=0$, the spring constant is quenched from $k_0$ to $k_1$. The final Hamiltonian is $H_1(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} k_{1} x^{2}$.\nThe work $W$ performed during this instantaneous quench is the change in the Hamiltonian evaluated at the phase-space point $(x,p)$, which remains unchanged during the quench:\n$$\nW(x,p) = H_1(x,p) - H_0(x,p) = \\left(\\frac{p^{2}}{2m} + \\frac{1}{2} k_{1} x^{2}\\right) - \\left(\\frac{p^{2}}{2m} + \\frac{1}{2} k_{0} x^{2}\\right) = \\frac{1}{2}(k_1 - k_0)x^2\n$$\nThe initial state is described by the canonical probability density $\\rho_0(x,p) = \\frac{1}{Z_0} \\exp(-\\beta H_0(x,p))$, where $Z_0$ is the initial partition function. We compute the ensemble average of $\\exp(-\\beta W)$:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\rho_0(x,p) \\exp(-\\beta W(x,p)) \\,dx\\,dp\n$$\n$$\n= \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp(-\\beta H_0(x,p)) \\exp(-\\beta [H_1(x,p) - H_0(x,p)]) \\,dx\\,dp\n$$\nThe terms involving $H_0$ in the exponent cancel:\n$$\n= \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp(-\\beta H_1(x,p)) \\,dx\\,dp\n$$\nThe integral is, by definition, the partition function $Z_1$ corresponding to the final Hamiltonian $H_1$. Thus, we have the relation $\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{Z_1}{Z_0}$.\nNow, we must calculate the partition functions $Z_0$ and $Z_1$. The classical partition function for a single particle in one dimension is given by the phase-space integral over the Boltzmann factor (we omit the Planck constant factor $1/h$ as it will cancel in the ratio):\n$$\nZ_k = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{p^2}{2m}\\right) dp \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2} k x^2\\right) dx\n$$\nThese are standard Gaussian integrals of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$.\nThe momentum integral is $\\sqrt{\\frac{2m\\pi}{\\beta}}$.\nThe position integral is $\\sqrt{\\frac{2\\pi}{\\beta k}}$.\nSo, the partition function for a given spring constant $k$ is:\n$$\nZ_k = \\sqrt{\\frac{2m\\pi}{\\beta}} \\sqrt{\\frac{2\\pi}{\\beta k}} = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k}}\n$$\nUsing this general form, we find $Z_0$ and $Z_1$:\n$$\nZ_0 = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k_0}} \\quad \\text{and} \\quad Z_1 = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k_1}}\n$$\nThe ratio is:\n$$\n\\frac{Z_1}{Z_0} = \\frac{2\\pi\\sqrt{m}/(\\beta\\sqrt{k_1})}{2\\pi\\sqrt{m}/(\\beta\\sqrt{k_0})} = \\frac{\\sqrt{k_0}}{\\sqrt{k_1}} = \\sqrt{\\frac{k_0}{k_1}}\n$$\nFinally, we compute $Q_{\\mathrm{ho}}$:\n$$\nQ_{\\mathrm{ho}} = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle = -\\ln\\left(\\frac{Z_1}{Z_0}\\right) = -\\ln\\left(\\sqrt{\\frac{k_0}{k_1}}\\right) = \\ln\\left(\\left(\\frac{k_0}{k_1}\\right)^{-1/2}\\right) = \\ln\\left(\\left(\\frac{k_1}{k_0}\\right)^{1/2}\\right) = \\frac{1}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)\n$$\nThis result can also be related to the Helmholtz free energy change, $\\Delta F = F_1 - F_0$. Since $F = -k_B T \\ln Z = - (1/\\beta) \\ln Z$ (up to constants), we have $\\beta \\Delta F = -\\ln(Z_1/Z_0) = Q_{\\mathrm{ho}}$, confirming the consistency of our calculation.\n\nNext, we consider System B, the quantum two-level system.\nThe initial Hamiltonian $H_0$ has energy eigenvalues $E_{0,0}=0$ and $E_{0,1}=\\epsilon_0$. The initial partition function is:\n$$\nZ_0 = \\sum_{n=0}^{1} \\exp(-\\beta E_{0,n}) = \\exp(0) + \\exp(-\\beta \\epsilon_0) = 1 + \\exp(-\\beta \\epsilon_0)\n$$\nThe system is initially in a thermal mixture of the two energy eigenstates. The probabilities of being in the ground state ($|\\psi_0\\rangle$) and excited state ($|\\psi_1\\rangle$) are given by the Boltzmann distribution:\n$$\nP_0 = \\frac{\\exp(-\\beta E_{0,0})}{Z_0} = \\frac{1}{Z_0} = \\frac{1}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\n$$\nP_1 = \\frac{\\exp(-\\beta E_{0,1})}{Z_0} = \\frac{\\exp(-\\beta \\epsilon_0)}{Z_0} = \\frac{\\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\nThe parameter $\\epsilon$ is quenched from $\\epsilon_0$ to $\\epsilon_1$. The work done, $W$, is provided for each initial state according to a two-measurement protocol. If the system is initially in the ground state, $W_0=0$. If the system is initially in the excited state, $W_1 = \\epsilon_1 - \\epsilon_0$. The ensemble average $\\left\\langle \\exp(-\\beta W) \\right\\rangle$ is an average over these measurement outcomes, weighted by the initial probabilities:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\sum_{i=0}^{1} P_i \\exp(-\\beta W_i) = P_0 \\exp(-\\beta W_0) + P_1 \\exp(-\\beta W_1)\n$$\nSubstituting the probabilities and work values:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\left(\\frac{1}{Z_0}\\right) \\exp(0) + \\left(\\frac{\\exp(-\\beta \\epsilon_0)}{Z_0}\\right) \\exp(-\\beta(\\epsilon_1 - \\epsilon_0))\n$$\n$$\n= \\frac{1}{Z_0} \\left[ 1 + \\exp(-\\beta \\epsilon_0) \\exp(-\\beta\\epsilon_1) \\exp(\\beta\\epsilon_0) \\right]\n$$\n$$\n= \\frac{1}{Z_0} [1 + \\exp(-\\beta \\epsilon_1)]\n$$\nThe final Hamiltonian $H_1$ has eigenvalues $E_{1,0}=0$ and $E_{1,1}=\\epsilon_1$. The corresponding partition function is $Z_1 = 1 + \\exp(-\\beta \\epsilon_1)$. Therefore, we again find the relation:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{Z_1}{Z_0} = \\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\nNow we can compute $Q_{\\mathrm{tls}}$:\n$$\nQ_{\\mathrm{tls}} = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle = -\\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\\right) = \\ln\\left(\\left(\\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\\right)^{-1}\\right)\n$$\n$$\nQ_{\\mathrm{tls}} = \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right)\n$$\nAs with the harmonic oscillator, this quantity is equal to $\\beta \\Delta F = \\beta(F_1 - F_0)$.\n\nThe two results for $Q_{\\mathrm{ho}}$ and $Q_{\\mathrm{tls}}$ are combined into a single row matrix as requested.\n$$[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}] = \\begin{pmatrix} \\frac{1}{2}\\ln\\left(\\frac{k_1}{k_0}\\right)  \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right) \\end{pmatrix}$$\nThese expressions are dimensionless and given in terms of the specified symbolic parameters only.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2}\\ln\\left(\\frac{k_1}{k_0}\\right)  \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In practical applications like steered molecular dynamics (SMD), a common observation is that the average work for a forward process does not equal the negative of the average work for the reverse process, resulting in a hysteresis loop. This practice  challenges you to connect this tangible simulation output to the underlying theory. By analyzing the causes and implications of hysteresis, you will deepen your understanding of irreversible dissipation and its relationship to both the Jarzynski equality and the Crooks fluctuation theorem.",
            "id": "2460746",
            "problem": "A solute is driven along a single reaction coordinate using Steered Molecular Dynamics (SMD) under a harmonic steering potential whose center is translated at a constant speed in both the forward and reverse directions. From repeated realizations at identical thermodynamic conditions, the average force versus coordinate curves for forward and reverse pulling do not coincide, forming a hysteresis loop. The task is to reason from first principles about the origin of this hysteresis and its implications for estimating the Potential of Mean Force (PMF) and its connection to Jarzynski’s equality.\n\nSelect all statements that are most consistent with fundamental statistical mechanics and non-equilibrium work relations.\n\nA. The hysteresis originates from irreversible dissipation because the system does not fully equilibrate in degrees of freedom orthogonal to the pulled coordinate at finite pulling speed; in the quasi-static limit the hysteresis vanishes. Jarzynski’s equality remains valid and, with sufficient ensemble averaging, recovers the equilibrium free energy difference from the exponential average of work.\n\nB. The presence of hysteresis implies that Jarzynski’s equality is violated; the difference between the forward and reverse average work directly equals the equilibrium free energy difference, so no ensemble averaging is required.\n\nC. Hysteresis is caused solely by choosing an overly weak steering spring; increasing the spring constant always removes hysteresis even if pulling speed and sampling are unchanged.\n\nD. The Crooks fluctuation theorem predicts that the forward and reverse work distributions intersect at the equilibrium free energy difference; larger hysteresis reflects larger dissipated work and broader work distributions, which degrades the statistical convergence of Jarzynski-based PMF estimators.\n\nE. In the limit of infinite pulling speed, hysteresis disappears because the system cannot respond and therefore follows the equilibrium PMF exactly.",
            "solution": "We analyze the scenario using fundamental definitions from equilibrium and non-equilibrium statistical mechanics. The Potential of Mean Force (PMF) along a coordinate is the equilibrium free energy profile, defined up to a constant by the equilibrium probability density along that coordinate. In SMD, one performs non-equilibrium transformations by imposing a time-dependent protocol, and the mechanical work performed, denoted by $W$, fluctuates across trajectories.\n\nJarzynski’s equality states that\n$$\n\\left\\langle e^{-\\beta W} \\right\\rangle \\;=\\; e^{-\\beta \\Delta F},\n$$\nwhere $\\beta \\equiv 1/(k_{\\mathrm{B}} T)$, $k_{\\mathrm{B}}$ is Boltzmann’s constant, $T$ is temperature, $W$ is the non-equilibrium work performed over the protocol, $\\Delta F$ is the equilibrium free energy difference between the initial and final equilibrium states defined by the control parameter, and the angled brackets denote an ensemble average over independent realizations of the protocol starting from equilibrium. From Jensen’s inequality applied to the convex exponential, one obtains\n$$\n-\\beta \\Delta F \\;=\\; \\ln \\left\\langle e^{-\\beta W} \\right\\rangle \\;\\ge\\; \\left\\langle -\\beta W \\right\\rangle,\n$$\nwhich implies\n$$\n\\langle W \\rangle \\;\\ge\\; \\Delta F.\n$$\nThe difference $W_{\\mathrm{diss}} \\equiv W - \\Delta F$ is the dissipated work, which vanishes in the quasi-static limit and is positive on average for irreversible protocols. For the time-reversed protocol, one similarly has $\\langle W_{\\mathrm{rev}} \\rangle \\ge -\\Delta F$. Combining these gives $\\langle W_{\\mathrm{fwd}} \\rangle - \\langle W_{\\mathrm{rev}} \\rangle \\ge 0$, reflecting hysteresis between forward and reverse mean work or mean force curves when integrated along the path.\n\nMicroscopically, finite pulling speed prevents complete relaxation of degrees of freedom orthogonal to the pulled coordinate, producing frictional lag and entropy production that manifest as dissipated work. In the limit of sufficiently slow pulling (quasi-static, reversible limit), the system remains arbitrarily close to equilibrium along the protocol, $W \\to \\Delta F$ for every realization, and the hysteresis loop collapses.\n\nThe Crooks fluctuation theorem relates the forward and reverse work distributions $P_{\\mathrm{F}}(W)$ and $P_{\\mathrm{R}}(W)$ via\n$$\n\\frac{P_{\\mathrm{F}}(W)}{P_{\\mathrm{R}}(-W)} \\;=\\; e^{\\beta \\left(W - \\Delta F\\right)}.\n$$\nThis implies that the crossing point of $P_{\\mathrm{F}}(W)$ and $P_{\\mathrm{R}}(-W)$ occurs at $W = \\Delta F$. As dissipation increases, the forward and reverse distributions separate and broaden, increasing the variance of $e^{-\\beta W}$ and slowing the convergence of Jarzynski estimators that reconstruct the PMF (for example, by stitching free energy differences across contiguous intervals of the coordinate).\n\nWe now evaluate each option.\n\nOption A: This statement correctly identifies the physical origin of hysteresis as non-equilibrium dissipation due to incomplete equilibration of orthogonal modes at finite pulling speed. It correctly states the quasi-static limit removes hysteresis and that Jarzynski’s equality remains valid and, with sufficient sampling, recovers the equilibrium free energy difference from the exponential average of work. Verdict — Correct.\n\nOption B: This claims that hysteresis implies violation of Jarzynski’s equality and that the difference between forward and reverse average work equals the equilibrium free energy difference. Jarzynski’s equality is not violated by hysteresis; rather, hysteresis reflects positive dissipated work. Furthermore, the difference of average works is generally not equal to the equilibrium free energy difference; instead, $\\langle W_{\\mathrm{fwd}} \\rangle \\ge \\Delta F$ and $\\langle W_{\\mathrm{rev}} \\rangle \\ge -\\Delta F$, with the gap reflecting dissipation, not $\\Delta F$ itself. Verdict — Incorrect.\n\nOption C: This attributes hysteresis solely to an overly weak spring and claims increasing the spring constant always removes hysteresis without changing speed or sampling. While the spring constant influences the degree of lag between the coordinate and the restraint center, hysteresis fundamentally arises from finite-rate driving and incomplete relaxation; increasing stiffness can even exacerbate high-frequency nonequilibrium responses if the speed is unchanged. Therefore, it is not solely a spring-constant issue, and increasing stiffness alone does not guarantee removal of hysteresis. Verdict — Incorrect.\n\nOption D: This states the Crooks fluctuation theorem’s intersection property and connects larger hysteresis with larger dissipated work and broader work distributions, which hinder the statistical convergence of Jarzynski estimators. This is consistent with $P_{\\mathrm{F}}(W)/P_{\\mathrm{R}}(-W) = e^{\\beta (W - \\Delta F)}$ and with the well-known effect that greater dissipation increases the variance of $e^{-\\beta W}$, requiring more trajectories to converge. Verdict — Correct.\n\nOption E: This claims hysteresis disappears at infinite pulling speed. The opposite is true: faster pulling generally increases dissipation and hysteresis, whereas hysteresis vanishes in the quasi-static (infinitely slow) limit. Verdict — Incorrect.\n\nTherefore, the correct statements are Options A and D.",
            "answer": "$$\\boxed{AD}$$"
        },
        {
            "introduction": "The ultimate power of the Jarzynski equality lies in its ability to extract equilibrium free energy differences, $\\Delta A$, from finite, non-equilibrium work measurements. This final practice  moves from theory to direct application by providing sets of work values from simulated pulling experiments. Your task is to implement the Jarzynski estimator, paying close attention to the crucial, real-world challenge of numerical stability to ensure your calculations are accurate and robust, a key skill for any computational scientist in this field.",
            "id": "2462968",
            "problem": "You are given independent realizations of non-equilibrium pulling work values for unfolding a small peptide, obtained from many repetitions of a time-dependent driving protocol in Molecular Dynamics (MD). Each realization starts from an initial state sampled from the canonical ensemble at absolute temperature $T$ and proceeds under deterministic, microreversible dynamics with a prescribed schedule of a control parameter. Under these conditions, there exists an exact relation that connects a canonical-ensemble average of a function of the irreversible work to the equilibrium Helmholtz free energy difference between the initial and final control-parameter values. Your task is to use this relation to recover the reversible Helmholtz free energy change from finite samples of pulling work.\n\nFundamental bases you may assume:\n- The system is initially in the canonical ensemble at temperature $T$, so the initial phase-space density is proportional to $\\exp(-\\beta H)$, where $\\beta = 1/(k_\\mathrm{B} T)$ and $H$ is the Hamiltonian.\n- Microscopic dynamics are deterministic and preserve phase-space volume.\n- The molar form of the inverse temperature is $\\beta = 1/(R T)$ when energies are reported per mole, where $R$ is the molar gas constant.\n\nDefinitions and requirements:\n- Let $R$ denote the molar gas constant in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$. Use $R = 8.314462618\\times 10^{-3}\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- For each test case, you are given a temperature $T$ in $\\mathrm{K}$ and a list of $N$ independent work values $\\{W_i\\}_{i=1}^N$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. Each $W_i$ is the total mechanical work performed on the system along one non-equilibrium trajectory of the driving protocol.\n- Using only the fundamental bases above, derive the appropriate estimator for the reversible Helmholtz free energy difference $\\Delta A$ from the set $\\{W_i\\}_{i=1}^N$ and $T$, then implement a numerically stable computation of this estimator that avoids floating-point overflow or underflow when evaluating exponentials. You must ensure numerical stability by transforming the computation so that very small or very large intermediate exponentials are not directly formed (for example, by shifting exponents before summation).\n- Report $\\Delta A$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, rounded to $3$ decimal places.\n\nTest suite:\nCompute $\\Delta A$ for the following five cases. All energies must be treated as molar quantities.\n- Case $1$: $T = 300.0\\ \\mathrm{K}$, $W = [12.0,\\ 13.5,\\ 11.2,\\ 14.1]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $2$: $T = 300.0\\ \\mathrm{K}$, $W = [5.0,\\ 5.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $3$: $T = 350.0\\ \\mathrm{K}$, $W = [20.0,\\ 30.0,\\ 15.0,\\ 25.0,\\ 40.0,\\ 10.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $4$: $T = 100.0\\ \\mathrm{K}$, $W = [2.0,\\ 3.0,\\ 4.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $5$: $T = 300.0\\ \\mathrm{K}$, $W = [18.0,\\ 19.0,\\ 17.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the five $\\Delta A$ values, in the order of Cases $1$ through $5$, each rounded to $3$ decimal places and expressed in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. For example, an output line matching the required format has the form $[\\Delta A_1,\\Delta A_2,\\Delta A_3,\\Delta A_4,\\Delta A_5]$, where each $\\Delta A_i$ is a floating-point number rounded to $3$ decimal places.",
            "solution": "The problem requires the derivation and implementation of an estimator for the equilibrium Helmholtz free energy difference, $\\Delta A$, from a finite set of non-equilibrium work measurements $\\{W_i\\}$. The provided physical basis—an initial canonical ensemble and deterministic, volume-preserving dynamics—is the precise foundation for the Jarzynski equality, which is the exact relation mentioned in the problem statement.\n\nWe begin by stating this fundamental relation. The Jarzynski equality connects the work, $W$, performed on a system during a non-equilibrium process to the free energy difference, $\\Delta A$, between the equilibrium states corresponding to the initial and final values of the control parameter. The equality is given by:\n$$\n\\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta A}\n$$\nHere, $\\beta$ is the inverse temperature. For molar energies, as specified, it is $\\beta = 1/(R T)$, where $R$ is the molar gas constant and $T$ is the absolute temperature. The angle brackets $\\langle \\dots \\rangle$ denote an average over an infinite ensemble of trajectories, where each trajectory starts from a configuration drawn from the canonical equilibrium distribution of the initial state.\n\nTo find $\\Delta A$, we take the natural logarithm of both sides of the Jarzynski equality:\n$$\n\\ln(\\langle e^{-\\beta W} \\rangle) = -\\beta \\Delta A\n$$\nSolving for $\\Delta A$ yields:\n$$\n\\Delta A = -\\frac{1}{\\beta} \\ln(\\langle e^{-\\beta W} \\rangle)\n$$\nIn any practical application, such as a computational experiment, we have access to only a finite sample of $N$ independent work values, $\\{W_i\\}_{i=1}^N$. The ensemble average $\\langle e^{-\\beta W} \\rangle$ must therefore be estimated by a sample mean:\n$$\n\\langle e^{-\\beta W} \\rangle \\approx \\frac{1}{N} \\sum_{i=1}^N e^{-\\beta W_i}\n$$\nSubstituting this sample average into the expression for $\\Delta A$ gives the practical estimator for the free energy difference from a finite data set:\n$$\n\\Delta A \\approx -\\frac{1}{\\beta} \\ln\\left(\\frac{1}{N} \\sum_{i=1}^N e^{-\\beta W_i}\\right)\n$$\nUsing $\\beta = 1/(R T)$, the final expression for the estimator in terms of the given quantities is:\n$$\n\\Delta A = -R T \\ln\\left(\\frac{1}{N} \\sum_{i=1}^N e^{-W_i / (R T)}\\right)\n$$\n\nThe next critical task is to ensure the numerical stability of this computation. The calculation involves a sum of exponentials, $\\sum_i e^{-W_i / (R T)}$. If the arguments $-W_i / (R T)$ are large and positive, their exponentiation can result in floating-point overflow. Conversely, large negative arguments lead to underflow, which is less catastrophic but can still lead to loss of precision. To prevent this, we employ a standard algebraic manipulation often called the log-sum-exp trick.\n\nLet $x_i = -W_i / (R T)$. We wish to compute $\\ln\\left(\\sum_i e^{x_i}\\right)$ robustly. Let $x_{\\max} = \\max_i\\{x_i\\}$. We can factor out $e^{x_{\\max}}$ from the sum:\n$$\n\\sum_{i=1}^N e^{x_i} = \\sum_{i=1}^N e^{x_i - x_{\\max} + x_{\\max}} = e^{x_{\\max}} \\sum_{i=1}^N e^{x_i - x_{\\max}}\n$$\nThe logarithm of the sum then becomes:\n$$\n\\ln\\left(\\sum_{i=1}^N e^{x_i}\\right) = \\ln\\left(e^{x_{\\max}} \\sum_{i=1}^N e^{x_i - x_{\\max}}\\right) = x_{\\max} + \\ln\\left(\\sum_{i=1}^N e^{x_i - x_{\\max}}\\right)\n$$\nIn our context, $x_{\\max} = \\max_i\\{-W_i / (R T)\\} = -(\\min_i\\{W_i\\}) / (R T) = -W_{\\min} / (R T)$, where $W_{\\min}$ is the minimum work value in the sample. The exponents in the new sum are $(x_i - x_{\\max}) = -(W_i - W_{\\min})/(R T)$. Since $W_i \\ge W_{\\min}$ for all $i$, these exponents are all non-positive. The largest value in the sum is $e^0 = 1$, which completely avoids overflow.\n\nSubstituting this stabilized form into our estimator for $\\Delta A$:\n$$\n\\Delta A = -R T \\left[ \\ln\\left(\\frac{1}{N}\\right) + \\ln\\left(\\sum_{i=1}^N e^{-W_i / (R T)}\\right) \\right]\n$$\n$$\n\\Delta A = -R T \\left[ -\\ln(N) + \\left( -\\frac{W_{\\min}}{R T} + \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right) \\right) \\right]\n$$\nSimplifying this expression gives the final, numerically stable formula for implementation:\n$$\n\\Delta A = R T \\ln(N) + W_{\\min} - R T \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right)\n$$\nOr, more compactly:\n$$\n\\Delta A = W_{\\min} - R T \\left[ \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right) - \\ln(N) \\right]\n$$\nThis is the algorithm to be implemented. For each test case, we will compute the inverse molar thermal energy $1/(RT)$, find the number of samples $N$ and the minimum work $W_{\\min}$, calculate the sum of shifted exponentials, and combine these terms as shown above to find $\\Delta A$. The result must be reported in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ rounded to $3$ decimal places.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Helmholtz free energy difference Delta A from non-equilibrium\n    work measurements using the Jarzynski equality, with numerical stabilization.\n    \"\"\"\n    \n    # Define the molar gas constant in kJ mol^-1 K^-1\n    R = 8.314462618e-3\n\n    test_cases = [\n        {'T': 300.0, 'W': [12.0, 13.5, 11.2, 14.1]},\n        {'T': 300.0, 'W': [5.0, 5.0, 5.0]},\n        {'T': 350.0, 'W': [20.0, 30.0, 15.0, 25.0, 40.0, 10.0]},\n        {'T': 100.0, 'W': [2.0, 3.0, 4.0, 5.0]},\n        {'T': 300.0, 'W': [18.0, 19.0, 17.0, 5.0]}\n    ]\n\n    def calculate_delta_a(T, W_values, R_const):\n        \"\"\"\n        Computes Delta A for a single test case using a numerically stable formula.\n\n        Args:\n            T (float): Absolute temperature in Kelvin.\n            W_values (list of float): List of work values in kJ/mol.\n            R_const (float): Molar gas constant in kJ mol^-1 K^-1.\n\n        Returns:\n            float: The calculated Helmholtz free energy difference Delta A.\n        \"\"\"\n        N = len(W_values)\n        if N == 0:\n            return 0.0 # Or handle as an error case\n\n        # Convert to numpy array for efficient operations\n        W = np.array(W_values)\n        \n        RT = R_const * T\n        \n        # If all work values are identical, Delta A is simply that work value.\n        # This also avoids potential log(0) if N=1.\n        if np.all(W == W[0]):\n            return W[0]\n\n        # Find the minimum work value for the shifting factor\n        W_min = np.min(W)\n        \n        # Calculate shifted, unitless exponents: -(W_i - W_min) / (RT)\n        # The exponents are guaranteed to be = 0, preventing overflow.\n        shifted_exponents = -(W - W_min) / RT\n        \n        # Calculate the sum of exponentials\n        sum_of_exponentials = np.sum(np.exp(shifted_exponents))\n        \n        # Calculate Delta A using the numerically stable formula:\n        # Delta_A = W_min - RT * [ln(sum(exp(-(W_i-W_min)/RT))) - ln(N)]\n        log_term = np.log(sum_of_exponentials) - np.log(N)\n        delta_A = W_min - RT * log_term\n        \n        return delta_A\n\n    results = []\n    for case in test_cases:\n        T = case['T']\n        W = case['W']\n        delta_A = calculate_delta_a(T, W, R)\n        results.append(delta_A)\n    \n    # Format results to 3 decimal places and create the final output string\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}