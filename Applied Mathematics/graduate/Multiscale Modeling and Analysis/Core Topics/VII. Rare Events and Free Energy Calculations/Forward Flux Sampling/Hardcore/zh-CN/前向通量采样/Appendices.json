{
    "hands_on_practices": [
        {
            "introduction": "前向通量采样（FFS）的速率计算公式 $k_{AB} = \\Phi_A \\prod p_i$ 以初始通量 $\\Phi_A$ 为起点。这项练习 () 要求您为一个简单的离散系统计算此通量，从而巩固通量作为从初始区域进入第一个界面区域的稳态穿越速率的基本定义。此练习将抽象的通量概念与系统稳态分布和转移概率等具体属性联系起来。",
            "id": "3761068",
            "problem": "考虑一个用于对稀有事件过程进行粗粒化以便进行前向通量采样 (FFS) 的离散时间马尔可夫链。该链的状态空间为 $\\{a_{1}, a_{2}, 0, i_{1}, i_{2}\\}$，其中集合 $A = \\{a_{1}, a_{2}\\}$ 表示一个亚稳盆，集合 $\\lambda_{0} = \\{0\\}$ 表示与序参量水平 $\\lambda = 0$ 相关联的边界界面。其一步转移概率由以下矩阵给出\n$$\nP \\;=\\;\n\\begin{pmatrix}\n0.2  0.3  0.25  0.15  0.1 \\\\\n0.3  0.2  0.2  0.1  0.2 \\\\\n0.25  0.2  0.2  0.2  0.15 \\\\\n0.15  0.1  0.2  0.2  0.35 \\\\\n0.1  0.2  0.15  0.35  0.2\n\\end{pmatrix},\n$$\n其行和列均按照 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$ 的顺序书写。假设该链是不可约且非周期的，并令 $\\pi$ 表示其平稳测度，即满足 $ \\pi P = \\pi $ 和 $\\sum_{s} \\pi_{s} = 1$ 的行向量。\n\n在 FFS 框架中，通过界面 $\\lambda_{0}$ 的前向通量 $\\Phi_{A}$ 定义为每单位时间步从 $A$ 到 $\\lambda_{0}$ 的跨越边界转移的稳态期望数。仅从离散时间马尔可夫链的平稳测度定义以及通量作为跨越事件稳态期望的操作性含义出发，推导出一个用 $\\pi$ 和 $P$ 中的转移概率表示 $\\Phi_{A}$ 的表达式，然后针对给定的 $P$、$A$ 和 $\\lambda_{0}$ 计算 $\\Phi_{A}$ 的值。\n\n请以单个实数形式提供最终答案。无需四舍五入。",
            "solution": "首先对问题进行验证。\n\n### 第 1 步：提取已知条件\n-   **状态空间**：一个离散时间马尔可夫链，其状态空间为 $S = \\{a_{1}, a_{2}, 0, i_{1}, i_{2}\\}$。\n-   **状态集**：\n    -   亚稳盆：$A = \\{a_{1}, a_{2}\\}$。\n    -   边界界面：$\\lambda_{0} = \\{0\\}$。\n-   **转移矩阵**：一步转移概率矩阵，其行和列按 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$ 顺序排列，为：\n    $$\n    P \\;=\\;\n    \\begin{pmatrix}\n    0.2  0.3  0.25  0.15  0.1 \\\\\n    0.3  0.2  0.2  0.1  0.2 \\\\\n    0.25  0.2  0.2  0.2  0.15 \\\\\n    0.15  0.1  0.2  0.2  0.35 \\\\\n    0.1  0.2  0.15  0.35  0.2\n    \\end{pmatrix}\n    $$\n-   **性质**：该链被说明是不可约且非周期的。\n-   **平稳测度**：$\\pi$ 是平稳测度，一个满足 $\\pi P = \\pi$ 和 $\\sum_{s \\in S} \\pi_{s} = 1$ 的行向量。\n-   **通量定义**：通过界面 $\\lambda_{0}$ 的前向通量 $\\Phi_{A}$ 定义为“每单位时间步从 $A$ 到 $\\lambda_{0}$ 的跨越边界转移的稳态期望数”。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学依据**：该问题基于离散时间马尔可夫链的标准数学框架及其在稀有事件模拟（特别是前向通量采样）中的应用，这是计算物理和计算化学领域一个成熟的课题。所有定义均为标准定义。\n-   **适定性**：该问题是适定的。它提供了系统的完整定义（状态空间、转移矩阵），并要求基于给定的定义计算一个明确定义的特定量（$\\Phi_{A}$）。对于有限状态空间，所述的不可约性和非周期性保证了平稳测度 $\\pi$ 的存在性和唯一性。\n-   **客观性**：该问题以精确、客观的数学语言表述。\n-   **完整性**：提供了所有必要信息。该转移矩阵是一个有效的随机矩阵，因为每行之和为 $1$。\n    -   第 1 行：$0.2 + 0.3 + 0.25 + 0.15 + 0.1 = 1.0$\n    -   第 2 行：$0.3 + 0.2 + 0.2 + 0.1 + 0.2 = 1.0$\n    -   第 3 行：$0.25 + 0.2 + 0.2 + 0.2 + 0.15 = 1.0$\n    -   第 4 行：$0.15 + 0.1 + 0.2 + 0.2 + 0.35 = 1.0$\n    -   第 5 行：$0.1 + 0.2 + 0.15 + 0.35 + 0.2 = 1.0$\n\n该问题没有任何科学、逻辑或结构上的缺陷。\n\n### 第 3 步：结论与行动\n该问题有效。将提供完整解答。\n\n### 解答推导\n\n前向通量 $\\Phi_{A}$ 定义为每单位时间步从状态集 $A$ 到状态集 $\\lambda_{0}$ 的跨越边界转移的稳态期望数。令 $X_t$ 表示马尔可夫链在时间 $t$ 的状态。如果 $X_t \\in A$ 且 $X_{t+1} \\in \\lambda_{0}$，则发生一次从 $A$ 到 $\\lambda_{0}$ 的转移。\n\n在稳态下，系统处于特定状态 $s$ 的概率由稳态概率 $\\pi_s = P(X_t = s)$ 给出。在一个时间步内从状态 $s$ 转移到状态 $s'$ 的概率由转移概率 $P_{s,s'}$ 给出。在时间 $t$ 处于状态 $s$ 且在时间 $t+1$ 处于状态 $s'$ 的联合概率为：\n$$\nP(X_t = s, X_{t+1} = s') = P(X_{t+1} = s' | X_t = s) P(X_t = s) = \\pi_s P_{s,s'}\n$$\n在一个时间步内从 $A$ 跨越到 $\\lambda_0$ 的总概率是所有此类特定转移概率的总和。这个概率是每单位时间内此类事件期望数的直接度量，也就是通量 $\\Phi_A$ 的定义。\n$$\n\\Phi_{A} = P(X_t \\in A, X_{t+1} \\in \\lambda_{0}) = \\sum_{s \\in A} \\sum_{s' \\in \\lambda_{0}} P(X_t = s, X_{t+1} = s') = \\sum_{s \\in A} \\sum_{s' \\in \\lambda_{0}} \\pi_s P_{s,s'}\n$$\n在此特定问题中，集合 $A = \\{a_{1}, a_{2}\\}$，界面 $\\lambda_{0} = \\{0\\}$。我们用索引 $1, 2, 3, 4, 5$ 来表示与给定顺序 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$ 对应的状态。因此，$a_1$ 是状态 $1$，$a_2$ 是状态 $2$，$0$ 是状态 $3$。通量的表达式变为：\n$$\n\\Phi_{A} = \\sum_{s \\in \\{a_1, a_2\\}} \\sum_{s' \\in \\{0\\}} \\pi_s P_{s,s'} = \\pi_{a_1} P_{a_1, 0} + \\pi_{a_2} P_{a_2, 0}\n$$\n为了计算 $\\Phi_A$，我们首先需要确定平稳测度 $\\pi = (\\pi_{a_1}, \\pi_{a_2}, \\pi_0, \\pi_{i_1}, \\pi_{i_2})$。向量 $\\pi$ 是方程组 $\\pi P = \\pi$ 在约束条件 $\\sum_s \\pi_s = 1$ 下的解。\n\n我们观察到给定的转移矩阵 $P$ 是对称的，即对于所有状态 $s, s'$ 都有 $P_{s,s'} = P_{s',s}$。一个同时是对称的随机矩阵（行和为 $1$）被称为双随机矩阵（列和也为 $1$）。对于一个有限状态、不可约的马尔可夫链（这是给定的），如果转移矩阵是双随机的，那么唯一的平稳分布是状态空间上的均匀分布。\n状态空间 $S$ 有 $5$ 个状态。因此，对于任何状态 $s \\in S$ 的稳态概率是：\n$$\n\\pi_s = \\frac{1}{5} = 0.2\n$$\n所以，我们有 $\\pi_{a_1} = 0.2$ 和 $\\pi_{a_2} = 0.2$。\n\n接下来，我们从矩阵 $P$ 中找出所需的转移概率。\n从 $a_1$ 转移到 $0$ 的概率是 $P$ 矩阵中第一行第三列的元素：\n$$\nP_{a_1, 0} = P_{1,3} = 0.25\n$$\n从 $a_2$ 转移到 $0$ 的概率是 $P$ 矩阵中第二行第三列的元素：\n$$\nP_{a_2, 0} = P_{2,3} = 0.2\n$$\n现在，我们可以将这些值代入通量 $\\Phi_A$ 的表达式中：\n$$\n\\Phi_{A} = \\pi_{a_1} P_{a_1, 0} + \\pi_{a_2} P_{a_2, 0}\n$$\n$$\n\\Phi_{A} = (0.2)(0.25) + (0.2)(0.2)\n$$\n$$\n\\Phi_{A} = 0.05 + 0.04\n$$\n$$\n\\Phi_{A} = 0.09\n$$\n因此，从盆 $A$ 通过界面 $\\lambda_{0}$ 的前向通量是每单位时间步 $0.09$ 个事件。",
            "answer": "$$\\boxed{0.09}$$"
        },
        {
            "introduction": "穿越第一个界面后，FFS方法依赖于估计穿越后续每个界面的条件概率 $p_i$。这项练习 () 深入探讨了此估计过程的统计核心。通过将模拟试验建模为伯努利实验，您将推导出 $p_i$ 的无偏估计量及其方差，这对于量化最终速率常数的统计误差至关重要。",
            "id": "2645588",
            "problem": "考虑一个随机反应网络中的稀有跃迁，该过程由一个序参量 $\\lambda$ 和一系列界面 $\\lambda_0 \\equiv \\lambda_A  \\lambda_1  \\cdots  \\lambda_n \\equiv \\lambda_B$ 监控，正如在前向通量采样（Forward Flux Sampling, FFS）方法中所使用的那样。在界面 $\\lambda_i$ 处，将 $p_i \\equiv P(\\lambda_{i+1} \\mid \\lambda_i)$ 定义为一条从 $\\lambda_i$ 处的首次穿越点系综出发的轨道在返回到盆 $A$ 之前到达 $\\lambda_{i+1}$ 的概率。您从 $\\lambda_i$ 出发，进行 $M_i$ 次独立同分布的短试探轨道模拟，每次模拟的结果要么是到达 $\\lambda_{i+1}$（一次“成功”），要么是返回到 $A$（一次“失败”）。请仅使用条件概率、指示随机变量以及独立伯努利试验的性质，为 $p_i$ 推导出一个无偏估计量 $\\hat{p}_i$，并计算该估计量在所述采样协议下的方差。\n\n您的最终答案应为方差 $\\mathrm{Var}(\\hat{p}_i)$ 的闭合形式表达式，用 $p_i$ 和 $M_i$ 表示。不需要数值，也没有单位。您的最终答案必须是单个解析表达式。",
            "solution": "所提出的问题是统计估计理论中的一个标准练习，应用于计算统计物理学中使用的前向通量采样（Forward Flux Sampling, FFS）方法的背景。我们将验证其前提，如果前提有效，则进行严格的推导。\n\n首先，我们提取并分析给定的条件。\n问题定义了：\n1. 一个由序参量 $\\lambda$ 监控的随机过程。\n2. 一系列界面 $\\lambda_0  \\lambda_1  \\dots  \\lambda_n$。\n3. 条件概率 $p_i \\equiv P(\\lambda_{i+1} \\mid \\lambda_i)$，表示从界面 $\\lambda_i$ 开始的轨道在返回到盆 $A$（由 $\\lambda  \\lambda_0$ 定义）之前到达 $\\lambda_{i+1}$ 的概率。\n4. 一个采样过程，包括从界面 $\\lambda_i$ 发起的 $M_i$ 次独立同分布的试验。\n5. 每次试验都是一个二元结果：成功（到达 $\\lambda_{i+1}$）或失败（返回到 $A$）。\n\n该问题具有科学依据、提法恰当且客观。它描述了一个伯努利抽样方案，这是概率论和统计学中的一个基本概念，并将其正确定位在 FFS 算法的框架内。其语言精确，设定自洽。没有矛盾、歧义或事实错误。问题是有效的。我们开始求解。\n\n任务是推导出 $p_i$ 的一个无偏估计量并计算其方差。让我们对采样过程进行数学建模。$M_i$ 次试验中的每一次都是一个独立的随机实验。我们可以为第 $j$ 次试验的结果关联一个指示随机变量，记为 $X_j$，其中 $j = 1, 2, \\dots, M_i$。\n\n根据定义，指示变量 $X_j$ 定义如下：\n$$\nX_j = \\begin{cases}\n    1  \\text{如果第 } j\\text{ 条轨道到达 } \\lambda_{i+1} \\text{ (成功)} \\\\\n    0  \\text{如果第 } j\\text{ 条轨道返回到 } A \\text{ (失败)}\n\\end{cases}\n$$\n成功的概率为 $p_i$。因此，$X_j$ 的概率质量函数是：\n$$\nP(X_j = 1) = p_i\n$$\n$$\nP(X_j = 0) = 1 - p_i\n$$\n这是参数为 $p_i$ 的伯努利分布的定义。由于试验是“同分布制备的”，所有的 $X_j$ 都服从相同的分布。\n\n概率参数 $p_i$ 的自然且标准的估计量是结果的样本均值，即成功试验的比例。我们将估计量 $\\hat{p}_i$ 定义为：\n$$\n\\hat{p}_i = \\frac{1}{M_i} \\sum_{j=1}^{M_i} X_j\n$$\n为了验证该估计量是无偏的，我们必须证明其期望值 $E[\\hat{p}_i]$ 等于真实参数 $p_i$。我们使用期望算子的线性性质：\n$$\nE[\\hat{p}_i] = E\\left[ \\frac{1}{M_i} \\sum_{j=1}^{M_i} X_j \\right] = \\frac{1}{M_i} \\sum_{j=1}^{M_i} E[X_j]\n$$\n单个伯努利随机变量 $X_j$ 的期望是：\n$$\nE[X_j] = 1 \\cdot P(X_j = 1) + 0 \\cdot P(X_j = 0) = 1 \\cdot p_i + 0 \\cdot (1 - p_i) = p_i\n$$\n将此结果代入 $E[\\hat{p}_i]$ 的表达式中：\n$$\nE[\\hat{p}_i] = \\frac{1}{M_i} \\sum_{j=1}^{M_i} p_i = \\frac{1}{M_i} (M_i \\cdot p_i) = p_i\n$$\n因此，$E[\\hat{p}_i] = p_i$，证明了该估计量是无偏的。\n\n接下来，我们计算该估计量的方差 $\\mathrm{Var}(\\hat{p}_i)$。我们使用方差的性质，即对于常数 $c$ 和随机变量 $Y$，有 $\\mathrm{Var}(cY) = c^2 \\mathrm{Var}(Y)$。\n$$\n\\mathrm{Var}(\\hat{p}_i) = \\mathrm{Var}\\left(\\frac{1}{M_i} \\sum_{j=1}^{M_i} X_j\\right) = \\left(\\frac{1}{M_i}\\right)^2 \\mathrm{Var}\\left(\\sum_{j=1}^{M_i} X_j\\right)\n$$\n问题陈述指明 $M_i$ 次试验是“独立的”。对于独立随机变量之和，其方差等于方差之和。因此：\n$$\n\\mathrm{Var}\\left(\\sum_{j=1}^{M_i} X_j\\right) = \\sum_{j=1}^{M_i} \\mathrm{Var}(X_j)\n$$\n现在，我们必须求出单个伯努利变量 $X_j$ 的方差。方差定义为 $\\mathrm{Var}(X_j) = E[X_j^2] - (E[X_j])^2$。我们已经知道 $E[X_j] = p_i$。为了求 $E[X_j^2]$，我们注意到对于指示变量，$X_j^2 = X_j$，因为 $1^2 = 1$ 且 $0^2 = 0$。因此：\n$$\nE[X_j^2] = E[X_j] = p_i\n$$\n因此，$X_j$ 的方差是：\n$$\n\\mathrm{Var}(X_j) = E[X_j^2] - (E[X_j])^2 = p_i - (p_i)^2 = p_i(1 - p_i)\n$$\n由于试验是同分布制备的，所以对于所有的 $j$，方差都相同。现在我们可以将此结果代回 $\\mathrm{Var}(\\hat{p}_i)$ 的表达式中：\n$$\n\\mathrm{Var}(\\hat{p}_i) = \\frac{1}{M_i^2} \\sum_{j=1}^{M_i} p_i(1 - p_i)\n$$\n该和式包含 $M_i$ 个相同的项：\n$$\n\\mathrm{Var}(\\hat{p}_i) = \\frac{1}{M_i^2} \\left[ M_i \\cdot p_i(1 - p_i) \\right]\n$$\n通过消去一个因子 $M_i$ 来简化表达式，得到估计量 $\\hat{p}_i$ 方差的最终结果：\n$$\n\\mathrm{Var}(\\hat{p}_i) = \\frac{p_i(1 - p_i)}{M_i}\n$$\n这个结果是基础性的。它表明样本比例的方差与试验次数成反比，这是统计推断的基石。",
            "answer": "$$\\boxed{\\frac{p_i(1 - p_i)}{M_i}}$$"
        },
        {
            "introduction": "在计算预算有限的情况下，高效地运行FFS模拟至关重要。这项高级练习 () 直接基于前一个问题的统计洞见来解决资源分配问题。您将构建并解决一个优化问题，以确定在每个界面上应运行的理想试验次数，从而在固定的总成本下最小化最终速率常数的总体不确定性。",
            "id": "3761014",
            "problem": "考虑一个从势阱 $A$ 到势阱 $B$ 的稀有事件转变，该过程通过前向通量采样 (FFS) 进行模拟。FFS 使用一系列分隔 $A$ 和 $B$ 的界面 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_n$。速率常数 $k_{AB}$ 的 FFS 估计量构造为 $\\hat{k}_{AB} = \\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}$，其中 $\\hat{\\Phi}_{A}$ 是离开势阱 $A$ 并到达第一个界面 $\\lambda_{0}$ 的轨迹的估计通量，而 $\\hat{p}_{i}$ 是从界面 $\\lambda_{i}$ 出发的轨迹在返回 $A$ 之前到达下一个界面 $\\lambda_{i+1}$ 的估计条件概率。\n\n给定对于每个界面 $i$，成功概率 $p_{i}$ 严格介于 $0$ 和 $1$ 之间，并且 $\\hat{p}_{i}$ 是通过 $M_{i}$ 次独立的伯努利试验得到的，其成功概率为 $p_{i}$，计算公式为 $\\hat{p}_{i} = S_{i}/M_{i}$，其中 $S_{i}$ 是成功的次数。假设 $\\hat{\\Phi}_{A}$ 对 $\\log \\hat{k}_{AB}$ 方差的贡献与来自 $\\hat{p}_{i}$ 因子的贡献相比可以忽略不计，并且在优化过程中可被视为常数。进一步假设 $\\hat{p}_{i}$ 在不同界面之间是统计独立的（通过 FFS 中的独立采样和条件化实现），并且对于大的 $M_{i}$，中心极限定理 (CLT) 和 delta 方法适用。\n\n在界面 $i$ 的每次试验都有一个已知的平均计算成本 $c_{i}  0$（以一致的计算工作单位衡量），因此在界面 $i$ 分配 $M_{i}$ 次试验会产生总成本 $c_{i} M_{i}$。给定一个固定的总计算预算 $B  0$，该预算必须完全分配到所有界面上，满足 $\\sum_{i=0}^{n-1} c_{i} M_{i} = B$。\n\n从二项估计的基本定义出发，并使用 CLT 和 delta 方法获得在大 $M_{i}$ 条件下 $\\log \\hat{k}_{AB}$ 的主导阶方差，完成以下任务：\n\n- 在所述假设下，推导 $\\operatorname{Var}[\\log \\hat{k}_{AB}]$ 关于 $\\{p_{i}\\}$ 和 $\\{M_{i}\\}$ 的主导阶表达式。\n- 构建一个连续优化问题，以在固定预算约束下最小化此主导阶方差。\n- 求解此优化问题，以获得最优分配 $\\{M_{i}^{\\ast}\\}$ 作为 $\\{p_{i}\\}$、$\\{c_{i}\\}$ 和 $B$ 的函数的闭式表达式。\n\n将你的最终答案表示为最优分配向量 $\\{M_{i}^{\\ast}\\}_{i=0}^{n-1}$ 的单个闭式解析表达式。不需要四舍五入。",
            "solution": "用户的要求是推导在前向通量采样 (FFS) 模拟中计算工作的最优分配，以在固定总预算的约束下，最小化估计速率常数的方差。该问题具有科学依据、提法明确、客观，并包含足够的信息以获得唯一解。因此，该问题被认为是有效的。\n\n解决过程包括三个主要部分：\n1.  推导 $\\log \\hat{k}_{AB}$ 方差的主导阶表达式。\n2.  构建约束优化问题。\n3.  求解优化问题以找到最优分配 $\\{M_{i}^{\\ast}\\}$。\n\n### 第 1 部分：$\\log \\hat{k}_{AB}$ 方差的推导\n\n速率常数 $k_{AB}$ 的 FFS 估计量由下式给出：\n$$\n\\hat{k}_{AB} = \\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}\n$$\n我们关心其对数 $\\log \\hat{k}_{AB}$ 的方差。对表达式取自然对数可得：\n$$\n\\log \\hat{k}_{AB} = \\log\\left(\\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}\\right) = \\log \\hat{\\Phi}_{A} + \\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\n$$\n此量的方差为：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] = \\operatorname{Var}\\left[\\log \\hat{\\Phi}_{A} + \\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\\right]\n$$\n问题陈述中指出 $\\hat{\\Phi}_{A}$ 对该方差的贡献可以忽略不计，因此我们将 $\\log \\hat{\\Phi}_{A}$ 视为一个常数。此外，不同界面的估计量 $\\hat{p}_{i}$ 是统计独立的。因此，和的方差等于方差的和：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] = \\operatorname{Var}\\left[\\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\\right] = \\sum_{i=0}^{n-1} \\operatorname{Var}[\\log \\hat{p}_{i}]\n$$\n为了求出 $\\operatorname{Var}[\\log \\hat{p}_{i}]$，我们使用 delta 方法。估计量 $\\hat{p}_{i} = S_{i}/M_{i}$，其中 $S_{i}$ 是 $M_{i}$ 次独立伯努利试验中的成功次数，它服从一个缩放的二项分布。真实的成功概率是 $p_i$。成功次数 $S_i$ 服从二项分布 $S_i \\sim \\text{Binomial}(M_i, p_i)$。\n\n估计量 $\\hat{p}_{i}$ 的期望值和方差为：\n$$\nE[\\hat{p}_{i}] = E\\left[\\frac{S_{i}}{M_{i}}\\right] = \\frac{1}{M_{i}} E[S_{i}] = \\frac{M_{i} p_{i}}{M_{i}} = p_{i}\n$$\n$$\n\\operatorname{Var}[\\hat{p}_{i}] = \\operatorname{Var}\\left[\\frac{S_{i}}{M_{i}}\\right] = \\frac{1}{M_{i}^{2}} \\operatorname{Var}[S_{i}] = \\frac{M_{i} p_{i} (1 - p_{i})}{M_{i}^{2}} = \\frac{p_{i}(1 - p_{i})}{M_{i}}\n$$\ndelta 方法为随机变量函数的方差提供了一个近似。对于函数 $g(X)$，近似值为 $\\operatorname{Var}[g(X)] \\approx (g'(E[X]))^{2} \\operatorname{Var}[X]$。这里，我们的随机变量是 $\\hat{p}_{i}$，函数是 $g(x) = \\log(x)$。其导数为 $g'(x) = 1/x$。\n\n应用 delta 方法，其中 $E[\\hat{p}_{i}]=p_i$：\n$$\n\\operatorname{Var}[\\log \\hat{p}_{i}] \\approx (g'(p_{i}))^{2} \\operatorname{Var}[\\hat{p}_{i}] = \\left(\\frac{1}{p_{i}}\\right)^{2} \\left(\\frac{p_{i}(1 - p_{i})}{M_{i}}\\right) = \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n根据中心极限定理，这是在大 $M_i$ 极限下方差的主导阶项。\n\n将此结果代回到总方差的表达式中，我们得到要最小化的目标函数：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] \\approx \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n\n### 第 2 部分：优化问题的构建\n\n我们的目标是在固定的总计算预算约束下，最小化推导出的方差。令 $V(\\{M_i\\})$ 表示该近似方差。问题构建如下：\n\n最小化：\n$$\nV(\\{M_i\\}) = \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n约束条件为：\n$$\n\\sum_{i=0}^{n-1} c_{i} M_{i} = B\n$$\n其中对于所有 $i \\in \\{0, 1, \\dots, n-1\\}$，都有 $M_{i}  0$。\n\n### 第 3 部分：求解优化问题\n\n这是一个约束优化问题，可以使用拉格朗日乘子法求解。我们定义拉格朗日函数 $\\mathcal{L}$：\n$$\n\\mathcal{L}(\\{M_i\\}, \\lambda) = \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}} + \\lambda \\left( \\left( \\sum_{i=0}^{n-1} c_{i} M_{i} \\right) - B \\right)\n$$\n为了找到最优值 $\\{M_{i}^{\\ast}\\}$，我们将 $\\mathcal{L}$ 对每个 $M_k$（对于 $k \\in \\{0, \\dots, n-1\\}$）的偏导数设为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial M_k} = \\frac{\\partial}{\\partial M_k} \\left( \\frac{1 - p_k}{p_k M_k} \\right) + \\lambda \\frac{\\partial}{\\partial M_k} (c_k M_k) = 0\n$$\n$$\n-\\frac{1 - p_k}{p_k M_k^2} + \\lambda c_k = 0\n$$\n求解 $M_k$：\n$$\n\\lambda c_k = \\frac{1 - p_k}{p_k M_k^2} \\implies M_k^2 = \\frac{1 - p_k}{\\lambda c_k p_k}\n$$\n由于 $M_k$ 必须为正，我们取正根：\n$$\nM_k = \\sqrt{\\frac{1 - p_k}{\\lambda c_k p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{1 - p_k}{c_k p_k}}\n$$\n现在，我们使用预算约束来确定拉格朗日乘子 $\\lambda$。我们将 $M_k$ 的表达式代入约束方程：\n$$\n\\sum_{k=0}^{n-1} c_k M_k = \\sum_{k=0}^{n-1} c_k \\left( \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{1 - p_k}{c_k p_k}} \\right) = B\n$$\n将含有 $\\lambda$ 的项因子分解出来：\n$$\n\\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} c_k \\frac{\\sqrt{1 - p_k}}{\\sqrt{c_k p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} \\sqrt{c_k} \\sqrt{\\frac{1-p_k}{p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} \\sqrt{\\frac{c_k(1-p_k)}{p_k}} = B\n$$\n求解 $1/\\sqrt{\\lambda}$：\n$$\n\\frac{1}{\\sqrt{\\lambda}} = \\frac{B}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1 - p_j)}{p_j}}}\n$$\n最后，我们将 $1/\\sqrt{\\lambda}$ 的这个表达式代回到 $M_k$ 的方程中，以找到最优分配 $M_k^{\\ast}$：\n$$\nM_k^{\\ast} = \\left( \\frac{B}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1 - p_j)}{p_j}}} \\right) \\sqrt{\\frac{1 - p_k}{c_k p_k}}\n$$\n按照问题陈述的要求，将索引 $k$ 替换为 $i$，我们得到最优分配向量 $\\{M_i^{\\ast}\\}_{i=0}^{n-1}$ 的最终表达式。每个分量 $M_i^{\\ast}$ 由下式给出：\n$$\nM_{i}^{\\ast} = B \\frac{\\sqrt{\\frac{1-p_i}{c_i p_i}}}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1-p_j)}{p_j}}}\n$$",
            "answer": "$$\n\\boxed{M_{i}^{\\ast} = B \\frac{\\sqrt{\\frac{1-p_{i}}{c_{i}p_{i}}}}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_{j}(1-p_{j})}{p_{j}}}}}\n$$"
        }
    ]
}