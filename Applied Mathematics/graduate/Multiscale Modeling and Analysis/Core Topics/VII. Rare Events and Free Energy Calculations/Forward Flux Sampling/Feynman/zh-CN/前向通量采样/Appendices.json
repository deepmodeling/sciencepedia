{
    "hands_on_practices": [
        {
            "introduction": "前向通量采样（FFS）方法的核心在于将稀有事件的速率分解为初始通量和一系列条件概率的乘积。本练习将带你从最基础的部分入手：计算初始通量 $\\Phi_A$。通过一个离散时间的马尔可夫链模型，你将亲手实践如何利用系统的稳态性质来确定离开初始状态的轨迹通量，从而为整个FFS计算打下坚实的理论和计算基础。",
            "id": "3761068",
            "problem": "考虑一个用于前向通量采样（FFS）中对稀有事件过程进行粗粒化的离散时间马尔可夫链。该链的状态空间为 $\\{a_{1}, a_{2}, 0, i_{1}, i_{2}\\}$，其中集合 $A = \\{a_{1}, a_{2}\\}$ 表示一个亚稳盆，集合 $\\lambda_{0} = \\{0\\}$ 表示与序参量水平 $\\lambda = 0$ 相关的边界界面。其一步转移概率由矩阵\n$$\nP \\;=\\;\n\\begin{pmatrix}\n0.2  0.3  0.25  0.15  0.1 \\\\\n0.3  0.2  0.2  0.1  0.2 \\\\\n0.25  0.2  0.2  0.2  0.15 \\\\\n0.15  0.1  0.2  0.2  0.35 \\\\\n0.1  0.2  0.15  0.35  0.2\n\\end{pmatrix},\n$$\n给出，其行和列均按 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$ 的顺序列出。假设该链是不可约且非周期的，并令 $\\pi$ 表示其平稳测度，即满足 $ \\pi P = \\pi $ 和 $\\sum_{s} \\pi_{s} = 1$ 的行向量。\n\n在 FFS 框架中，通过界面 $\\lambda_{0}$ 的前向通量 $\\Phi_{A}$ 定义为单位时间步长内从 $A$ 到 $\\lambda_{0}$ 的跨界转移的稳态期望数量。仅从离散时间马尔可夫链的平稳测度定义以及通量作为跨界事件稳态期望的操作性含义出发，推导一个用 $\\pi$ 和 $P$ 中的转移概率表示 $\\Phi_{A}$ 的表达式，然后对给定的 $P$、$A$ 和 $\\lambda_{0}$ 计算 $\\Phi_{A}$ 的值。\n\n请以单个实数形式提供最终答案。无需四舍五入。",
            "solution": "首先对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   **状态空间**：一个离散时间马尔可夫链，其状态空间为 $S = \\{a_{1}, a_{2}, 0, i_{1}, i_{2}\\}$。\n-   **状态集**：\n    -   亚稳盆：$A = \\{a_{1}, a_{2}\\}$。\n    -   边界界面：$\\lambda_{0} = \\{0\\}$。\n-   **转移矩阵**：一步转移概率矩阵，其行和列按 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$ 顺序排列，为：\n    $$\n    P \\;=\\;\n    \\begin{pmatrix}\n    0.2  0.3  0.25  0.15  0.1 \\\\\n    0.3  0.2  0.2  0.1  0.2 \\\\\n    0.25  0.2  0.2  0.2  0.15 \\\\\n    0.15  0.1  0.2  0.2  0.35 \\\\\n    0.1  0.2  0.15  0.35  0.2\n    \\end{pmatrix}\n    $$\n-   **性质**：该链被说明为不可约且非周期的。\n-   **平稳测度**：$\\pi$ 是平稳测度，一个满足 $\\pi P = \\pi$ 和 $\\sum_{s \\in S} \\pi_{s} = 1$ 的行向量。\n-   **通量定义**：通过界面 $\\lambda_{0}$ 的前向通量 $\\Phi_{A}$ 定义为“单位时间步长内从 $A$ 到 $\\lambda_{0}$ 的跨界转移的稳态期望数量”。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学依据**：该问题基于离散时间马尔可夫链的标准数学框架及其在稀有事件模拟（特别是前向通量采样）中的应用，这是计算物理和化学领域一个成熟的课题。所有定义都是标准的。\n-   **良态性**：该问题是良态的。它提供了系统的完整定义（状态空间、转移矩阵），并要求根据给定的定义计算一个明确定义的量（$\\Phi_{A}$）。对于有限状态空间，所述的不可约性和非周期性保证了平稳测度 $\\pi$ 的存在性和唯一性。\n-   **客观性**：问题以精确、客观的数学语言表述。\n-   **完整性**：提供了所有必要的信息。给定的转移矩阵是一个有效的随机矩阵，因为每行之和为 $1$。\n    -   第 1 行：$0.2 + 0.3 + 0.25 + 0.15 + 0.1 = 1.0$\n    -   第 2 行：$0.3 + 0.2 + 0.2 + 0.1 + 0.2 = 1.0$\n    -   第 3 行：$0.25 + 0.2 + 0.2 + 0.2 + 0.15 = 1.0$\n    -   第 4 行：$0.15 + 0.1 + 0.2 + 0.2 + 0.35 = 1.0$\n    -   第 5 行：$0.1 + 0.2 + 0.15 + 0.35 + 0.2 = 1.0$\n\n该问题没有任何科学、逻辑或结构上的缺陷。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n前向通量 $\\Phi_{A}$ 定义为单位时间步长内从状态集 $A$ 到状态集 $\\lambda_{0}$ 的跨界转移的稳态期望数量。令 $X_t$ 表示马尔可夫链在时间 $t$ 的状态。如果 $X_t \\in A$ 且 $X_{t+1} \\in \\lambda_{0}$，则发生一次从 $A$ 到 $\\lambda_{0}$ 的转移。\n\n在稳态下，系统处于特定状态 $s$ 的概率由平稳概率 $\\pi_s = P(X_t = s)$ 给出。在一个时间步长内从状态 $s$ 转移到状态 $s'$ 的概率由转移概率 $P_{s,s'}$ 给出。在时间 $t$ 处于状态 $s$ 且在时间 $t+1$ 处于状态 $s'$ 的联合概率为：\n$$\nP(X_t = s, X_{t+1} = s') = P(X_{t+1} = s' | X_t = s) P(X_t = s) = \\pi_s P_{s,s'}\n$$\n在单个时间步长内从 $A$ 穿过到 $\\lambda_0$ 的总概率是所有此类特定转移概率的总和。此概率直接衡量了单位时间内此类事件的期望数量，这正是通量 $\\Phi_A$ 的定义。\n$$\n\\Phi_{A} = P(X_t \\in A, X_{t+1} \\in \\lambda_{0}) = \\sum_{s \\in A} \\sum_{s' \\in \\lambda_{0}} P(X_t = s, X_{t+1} = s') = \\sum_{s \\in A} \\sum_{s' \\in \\lambda_{0}} \\pi_s P_{s,s'}\n$$\n在这个具体问题中，集合 $A = \\{a_{1}, a_{2}\\}$，界面 $\\lambda_{0} = \\{0\\}$。我们用索引 $1, 2, 3, 4, 5$ 来表示给定的顺序 $(a_{1}, a_{2}, 0, i_{1}, i_{2})$。因此，$a_1$ 是状态 1，$a_2$ 是状态 2，$0$ 是状态 3。通量的表达式变为：\n$$\n\\Phi_{A} = \\sum_{s \\in \\{a_1, a_2\\}} \\sum_{s' \\in \\{0\\}} \\pi_s P_{s,s'} = \\pi_{a_1} P_{a_1, 0} + \\pi_{a_2} P_{a_2, 0}\n$$\n为了计算 $\\Phi_A$，我们首先需要确定平稳测度 $\\pi = (\\pi_{a_1}, \\pi_{a_2}, \\pi_0, \\pi_{i_1}, \\pi_{i_2})$。向量 $\\pi$ 是方程组 $\\pi P = \\pi$ 在约束 $\\sum_s \\pi_s = 1$ 下的解。\n\n我们观察到给定的转移矩阵 $P$ 是对称的，即对于所有状态 $s, s'$ 都有 $P_{s,s'} = P_{s',s}$。一个既是随机矩阵（行和为 1）又是对称矩阵的矩阵被称为双随机矩阵（列和也为 1）。对于一个有限状态、不可约的马尔可夫链（这是给定的），如果转移矩阵是双随机的，那么唯一的平稳分布是状态空间上的均匀分布。\n状态空间 $S$ 有 5 个状态。因此，任何状态 $s \\in S$ 的平稳概率为：\n$$\n\\pi_s = \\frac{1}{5} = 0.2\n$$\n所以，我们有 $\\pi_{a_1} = 0.2$ 和 $\\pi_{a_2} = 0.2$。\n\n接下来，我们从矩阵 $P$ 中找出所需的转移概率。\n从 $a_1$ 转移到 $0$ 的概率是 $P$ 矩阵的第一行第三列的元素：\n$$\nP_{a_1, 0} = P_{1,3} = 0.25\n$$\n从 $a_2$ 转移到 $0$ 的概率是 $P$ 矩阵的第二行第三列的元素：\n$$\nP_{a_2, 0} = P_{2,3} = 0.2\n$$\n现在，我们可以将这些值代入通量 $\\Phi_A$ 的表达式中：\n$$\n\\Phi_{A} = \\pi_{a_1} P_{a_1, 0} + \\pi_{a_2} P_{a_2, 0}\n$$\n$$\n\\Phi_{A} = (0.2)(0.25) + (0.2)(0.2)\n$$\n$$\n\\Phi_{A} = 0.05 + 0.04\n$$\n$$\n\\Phi_{A} = 0.09\n$$\n因此，从盆 $A$ 通过界面 $\\lambda_{0}$ 的前向通量为每个单位时间步长 0.09 个事件。",
            "answer": "$$\\boxed{0.09}$$"
        },
        {
            "introduction": "理论是理想的，但实际的计算模拟充满了挑战。在使用离散时间步长进行FFS模拟时，一个常见的问题是轨迹可能一步“跳过”多个界面，即“过冲”现象。如何处理这些事件直接关系到计算结果的准确性。本练习迫使你思考不同处理策略的后果，从而深刻理解保证FFS估算无偏性和路径系综一致性的重要性。",
            "id": "2645632",
            "problem": "考虑一个使用正向通量取样（FFS）方法计算随机反应网络稀有事件速率的问题，该网络具有一个序参量 $\\lambda(\\mathbf{x})$。定义了两个亚稳态集 $A=\\{\\mathbf{x} | \\lambda(\\mathbf{x})  \\lambda_0\\}$ 和 $B=\\{\\mathbf{x} | \\lambda(\\mathbf{x}) > \\lambda_n\\}$，以及一组嵌套的、不相交的界面 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_n$。在 FFS 的第 $i$ 阶段（$0\\le i\\le n-1$），轨迹从等值面 $\\lambda(\\mathbf{x})=\\lambda_i$ 上的构型开始，并使用与从 $A$ 生成稳态通量时相同的动力学进行演化。设 $p_i$ 表示这样一条轨迹在返回 $A$ 之前到达任何 $\\lambda(\\mathbf{x})>\\lambda_{i+1}$ 状态的概率；在具有连续序参量的理想化连续时间极限下，这与在返回 $A$ 之前到达下一个界面 $\\lambda_{i+1}$ 的概率一致。\n\n在实际的离散时间积分器中，或当使用跳跃性或粗粒度分箱的序参量时，可能会发生单步将轨迹从 $\\lambda_i$ 推进到 $\\lambda(\\mathbf{x})\\lambda_{i+k}$（对于某个整数 $k\\ge 1$）的构型，而没有记录到对中间界面的访问。这被称为“过冲”（overshoot）。您必须决定在估计 $p_i$ 以及将构型传递给后续 FFS 阶段时如何处理这种过冲，其前提是动力学是马尔可夫的，并且界面定义了首次命中事件的停止时间这一标准假设。\n\n下列哪条规则能够产生无偏的 FFS 估计量和一致的路径系综构建？\n\nA. 将任何首次命中事件发生在某个界面索引 $ji$ 的轨迹计为阶段 $i$ 的一次成功。将首次命中界面解析为 $j=\\min\\{mi:\\text{ 轨迹穿过 }\\lambda_m\\}$，必要时使用时间插值；增加 $i$ 的成功计数，将落点归于界面 $j$，并在后续取样中使用在 $\\lambda_j$ 上的首次命中时间的构型。不要将该事件拆分到多个界面上。\n\nB. 丢弃任何过冲超过 $\\lambda_{i+1}$ 的轨迹，认为其无效，因为跳过 $\\lambda_{i+1}$ 违反了顺序穿越的要求；只保留那些精确记录到命中 $\\lambda_{i+1}$ 的轨迹，以避免高估 $p_i$。\n\nC. 将从 $\\lambda_i$ 到 $\\lambda_{i+k}$ 的单次过冲视为 $k$ 次连续成功（在 $\\lambda_i,\\lambda_{i+1},\\dots,\\lambda_{i+k-1}$），并在没有额外模拟的情况下增加所有这些阶段的成功计数器，因为该轨迹必然已经穿过了所有中间界面。\n\nD. 将过冲计为阶段 $i$ 的一次失败，除非已知 $\\lambda(\\mathbf{x})$ 在所有反应轨迹上是严格单调的，在这种情况下计为成功；无论哪种情况，都从超过 $\\lambda_{i+k}}$ 的构型继续后续取样。",
            "solution": "在尝试解答之前，必须首先验证问题陈述的科学合理性、自洽性和清晰度。\n\n### 第1步：提取已知条件\n-   **系统**：一个随机反应网络。\n-   **方法**：用于稀有事件速率计算的正向通量取样（FFS）。\n-   **序参量**：$\\lambda(\\mathbf{x})$。\n-   **亚稳态**：状态 $A$ 定义为 $\\{\\mathbf{x} | \\lambda(\\mathbf{x})  \\lambda_0\\}$，状态 $B$ 定义为 $\\{\\mathbf{x} | \\lambda(\\mathbf{x}) > \\lambda_n\\}$。\n-   **界面**：一组由 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_n$ 定义的嵌套、不相交的界面。\n-   **FFS 阶段 $i$**：对于 $0\\le i\\le n-1$，轨迹从等值面 $\\lambda(\\mathbf{x})=\\lambda_i$ 上的构型开始。\n-   **概率 $p_i$**：从 $\\lambda_i$ 开始的轨迹在返回状态 $A$ 之前到达任何 $\\lambda(\\mathbf{x})>\\lambda_{i+1}$ 状态的概率。\n-   **问题背景**：在离散时间积分中，单步可以将轨迹从 $\\lambda_i$ 推进到 $\\lambda(\\mathbf{x})\\lambda_{i+k}$（对于某个整数 $k\\ge 1$）的构型。这被称为“过冲”（overshoot）。\n-   **假设**：系统动力学是马尔可夫的，并且界面定义了首次命中事件的停止时间。\n-   **目标**：确定处理过冲的规则，以产生无偏的 FFS 估计量和一致的路径系综构建。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行评估。\n\n-   **科学性**：该问题牢固地植根于计算统计物理和化学动力学。正向通量取样是一种成熟且广泛使用的稀有事件模拟技术。“过冲”或“长跳跃”问题是 FFS 实现中的一个已知且关键的实践细节，特别是对于离散时间模拟或具有大的离散变化的系统（例如，跳跃过程）。马尔可夫动力学和界面作为停止时间的假设是 FFS 理论基础的标准。该问题在科学上是有效的。\n-   **适定性**：该问题是适定的。它要求在一组选项中选择正确的算法规则，以确保 FFS 方法的两个特定期望属性：无偏估计量和一致的路径系综。基于 FFS 的原理，预期会有一个唯一的正确答案。\n-   **客观性**：语言技术性强、精确且客观。诸如“无偏估计量”和“马尔可夫的”等术语在此上下文中具有严格的定义。\n-   **其他缺陷**：问题设置没有违反任何基本原则，不是不完整的，并且在计算方法的应用中提出了一个现实的挑战。术语在该领域内是标准的。\n\n### 第3步：结论与行动\n问题陈述是**有效的**。这是一个关于正向通量取样算法正确实现的合法且非平凡的问题。我将继续进行解答。\n\n### 解答推导\n正向通量取样的目标是计算从状态 $A$ 到状态 $B$ 的转变的速率常数 $k_{AB}$。该速率由离开 $A$ 的轨迹通量 $\\Phi_A$ 乘以一条离开 $A$ 的轨迹在返回 $A$ 之前到达 $B$ 的概率 $P(B|A)$ 给出。\n$$k_{AB} = \\Phi_A P(B|A)$$\nFFS 通过使用一系列界面 $\\lambda_i$ 将 $P(B|A)$ 分解为条件概率的乘积来计算它：\n$$P(B|A) = P(\\lambda_1|A) \\times P(\\lambda_2|\\lambda_1) \\times \\dots \\times P(B|\\lambda_{n-1})$$\n在问题的符号体系中，$p_i$ 是条件概率 $P(\\lambda_{i+1}|\\lambda_i)$ 的估计量，该概率定义为从界面 $\\lambda_i$ 开始的轨迹在返回状态 $A$ 之前到达界面 $\\lambda_{i+1}$ 的概率。更准确地说，如问题中所述，$p_i$ 是从 $\\lambda_i$ 出发的轨迹“在返回 $A$ 之前到达任何 $\\lambda(\\mathbf{x})\\lambda_{i+1}$ 状态”的概率。总速率则估计为：\n$$k_{AB} \\approx \\Phi_A \\prod_{i=0}^{n-1} \\hat{p}_i$$\n其中 $\\hat{p}_i$ 是 $p_i$ 的数值估计。该估计通过从界面 $\\lambda_i$ 上的构型运行 $N_i$ 次试验，并计算到达 $\\lambda_{i+1}$ 的成功试验次数 $N_{i+1}$ 来获得。因此，$\\hat{p}_i = N_{i+1}/N_i$。\n\n问题的核心是如何对“过冲”事件进行分类——即轨迹在单个离散步骤中从界面 $\\lambda_i$ 跳转到 $\\lambda(\\mathbf{x})  \\lambda_{i+k}$（$k \\ge 1$）的状态。根据阶段 $i$ 的成功定义，如果轨迹在返回 $A$ 之前到达*任何* $\\lambda(\\mathbf{x})  \\lambda_{i+1}$ 的状态，则试验成功。一条过冲到 $\\lambda_{i+k}$（其中 $k \\ge 1$）的轨迹，根据定义，已经到达了一个 $\\lambda(\\mathbf{x})  \\lambda_{i+1}$ 的状态。因此，这无疑是阶段 $i$ 的一个成功事件。任何将此事件分类为失败或丢弃它的规则都是根本上不正确的，并将通过少计数成功路径而引入系统性偏差。\n\n基于此原则，我们评估每个选项。\n\n### 逐项分析\n\n**A. 这条规则与 FFS 的基本原则一致。1. 它正确地将过冲计为阶段 $i$ 的一次成功，因为轨迹已到达 $\\lambda  \\lambda_{i+1}$ 的区域。这确保了估计量 $\\hat{p}_i$ 是无偏的。2. 它正确地识别了为后续阶段生成有效构型的需求。通过找到第一个穿过的界面 $\\lambda_j$，并使用该点的构型，它为界面 $\\lambda_j$ 上的状态系综生成了一个有效的点。这个构型随后可用于启动从 $\\lambda_j$ 到 $\\lambda_{j+1}$ 转变的试验。这维持了马尔可夫属性；从 $\\lambda_j$ 开始的未来演化仅取决于在 $\\lambda_j$ 的构型，而与它是通过过冲到达那里的事实无关。3. “不要将该事件拆分到多个界面上”这一短语正确地避免了选项 C 中描述的统计谬误。此程序确保了每个 $p_i$ 的估计量都得到正确构建，并且后续阶段的路径系综都由统计上有效的构型填充。这是标准的、正确的程序，通常被称为“直接 FFS”（Direct FFS）。**\n\n**结论：正确。**\n\n**B. 这条规则不正确。如前所述，过冲是阶段 $i$ 的一个有效的成功事件。丢弃这些轨迹意味着我们系统地扔掉了真实的、成功的路径。这将导致估计量 $\\hat{p}_i = N_{i+1}/N_i$ 中的分子 $N_{i+1}$ 被人为地降低，从而导致对 $p_i$ 的系统性低估，并因此低估总速率 $k_{AB}$。选项中提供的理由（“以避免高估 $p_i$”）与实际效果相反；该规则导致低估。**\n\n**结论：不正确。**\n\n**C. 这条规则在统计上是有缺陷的。从 $\\lambda_i$ 到 $\\lambda_{i+k}$ 的单次轨迹实现是一个单一事件。虽然它意味着从 $\\lambda_i$ 到达 $\\lambda_{i+k}$ 的无条件概率非零，但它不能被视为对中间条件概率 $p_i, p_{i+1}, \\dots, p_{i+k-1}$ 的 $k$ 次独立成功试验。FFS 方法依赖于通过从 $\\lambda_j$ 上的一个构型系综运行大量统计显著的试验来估计每个 $p_j$。此规则绕过了这些中间系综的生成，实际上是假设沿着这一条路径从一个界面穿越到下一个界面的条件概率为 $1$。这是一种伪复制或“重复计数”的形式，它将使不同阶段的估计量相关联，并导致对总速率常数的显著高估。路径系综的构建也变得不一致，因为它将缺少在界面 $\\lambda_{i+1}, \\dots, \\lambda_{i+k-1}$ 上的构型。**\n\n**结论：不正确。**\n\n**D. 这条规则不正确，因为它对一般情况的主要指令是错误的。无论序参量是否单调，过冲都必须被计为阶段 $i$ 的一次成功。将其归类为失败会引入对速率的系统性低估。对单调 $\\lambda(\\mathbf{x})$ 的特殊情况并不能挽救该规则，因为一般情况存在缺陷。问题要求的是一个在所述的一般假设下都有效的规则，而不仅仅是针对一个特殊的、简化的案例。因此，整个规则是无效的。**\n\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "前向通量采样模拟的计算成本可能非常高昂，因此如何高效利用有限的计算资源至关重要。本练习将引导你解决一个核心的优化问题：如何在FFS的各个界面之间分配计算预算，以最小化最终速率常数估算值的统计误差。通过运用优化理论，你将推导出最优的资源分配策略，这标志着你从仅仅会使用FFS，迈向了能够高效设计和优化FFS模拟的更高层次。",
            "id": "3761014",
            "problem": "考虑一个从盆 $A$ 到盆 $B$ 的稀有事件跃迁，该过程通过前向通量采样（Forward Flux Sampling, FFS）方法进行模拟。该方法使用一系列分隔 $A$ 和 $B$ 的界面 $\\lambda_{0}  \\lambda_{1}  \\cdots  \\lambda_{n}$。速率常数 $k_{AB}$ 的FFS估计量构造为 $\\hat{k}_{AB} = \\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}$，其中 $\\hat{\\Phi}_{A}$ 是离开盆 $A$ 并到达第一个界面 $\\lambda_{0}$ 的轨迹通量的估计值，而 $\\hat{p}_{i}$ 是从界面 $\\lambda_{i}$ 出发的轨迹在返回到 $A$ 之前到达下一个界面 $\\lambda_{i+1}$ 的条件概率的估计值。\n\n给定对于每个界面 $i$，成功概率 $p_{i}$ 严格介于 $0$ 和 $1$ 之间，并且 $\\hat{p}_{i}$ 是通过 $M_{i}$ 次独立的伯努利试验得到的，其成功概率为 $p_{i}$，计算公式为 $\\hat{p}_{i} = S_{i}/M_{i}$，其中 $S_{i}$ 是成功的次数。假设 $\\hat{\\Phi}_{A}$ 对 $\\log \\hat{k}_{AB}$ 方差的贡献与来自 $\\hat{p}_{i}$ 因子的贡献相比可以忽略不计，并且为了优化的目的，可以将其视为常数。进一步假设，不同界面间的 $\\hat{p}_{i}$ 在统计上是独立的（通过FFS中的独立采样和条件化实现），并且对于较大的 $M_{i}$，中心极限定理（CLT）和delta方法适用。\n\n在界面 $i$ 的每次试验都有一个已知的平均计算成本 $c_{i}  0$（以一致的计算工作单位衡量），因此在界面 $i$ 分配 $M_{i}$ 次试验会产生总成本 $c_{i} M_{i}$。给定一个固定的总计算预算 $B  0$，该预算必须完全分配给所有界面，满足 $\\sum_{i=0}^{n-1} c_{i} M_{i} = B$。\n\n从二项估计的基本定义出发，并使用CLT和delta方法，在大的$M_{i}$区间内获得 $\\log \\hat{k}_{AB}$ 方差的主导阶，请完成以下任务：\n\n- 在所述假设下，推导 $\\operatorname{Var}[\\log \\hat{k}_{AB}]$ 关于 $\\{p_{i}\\}$ 和 $\\{M_{i}\\}$ 的主导阶表达式。\n- 建立在固定预算约束下最小化此主导阶方差的连续优化问题。\n- 求解此优化问题，以获得最优分配 $\\{M_{i}^{\\ast}\\}$ 作为 $\\{p_{i}\\}$、$\\{c_{i}\\}$ 和 $B$ 的函数的闭式表达式。\n\n将您的最终答案表示为最优分配向量 $\\{M_{i}^{\\ast}\\}_{i=0}^{n-1}$ 的单个闭式解析表达式。无需四舍五入。",
            "solution": "用户的要求是，在前向通量采样（FFS）模拟中，推导计算工作的最优分配，以在固定的总预算下最小化估计速率常数的方差。该问题具有科学依据、提法恰当、客观，并包含足够信息以获得唯一解。因此，该问题被认为是有效的。\n\n解决过程包括三个主要部分：\n1.  推导 $\\log \\hat{k}_{AB}$ 方差的主导阶表达式。\n2.  建立约束优化问题。\n3.  求解优化问题以找到最优分配 $\\{M_{i}^{\\ast}\\}$。\n\n### 第一部分：$\\log \\hat{k}_{AB}$ 方差的推导\n\n速率常数 $k_{AB}$ 的FFS估计量由下式给出：\n$$\n\\hat{k}_{AB} = \\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}\n$$\n我们关心其对数 $\\log \\hat{k}_{AB}$ 的方差。对该表达式取自然对数可得：\n$$\n\\log \\hat{k}_{AB} = \\log\\left(\\hat{\\Phi}_{A} \\prod_{i=0}^{n-1} \\hat{p}_{i}\\right) = \\log \\hat{\\Phi}_{A} + \\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\n$$\n此量的方差为：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] = \\operatorname{Var}\\left[\\log \\hat{\\Phi}_{A} + \\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\\right]\n$$\n问题陈述中提到，$\\hat{\\Phi}_{A}$ 对总方差的贡献可以忽略不计，因此我们将 $\\log \\hat{\\Phi}_{A}$ 视为常数。此外，不同界面的估计量 $\\hat{p}_{i}$ 在统计上是独立的。因此，和的方差等于方差的和：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] = \\operatorname{Var}\\left[\\sum_{i=0}^{n-1} \\log \\hat{p}_{i}\\right] = \\sum_{i=0}^{n-1} \\operatorname{Var}[\\log \\hat{p}_{i}]\n$$\n为了求出 $\\operatorname{Var}[\\log \\hat{p}_{i}]$，我们使用delta方法。估计量 $\\hat{p}_{i} = S_{i}/M_{i}$，其中 $S_{i}$ 是 $M_{i}$ 次独立伯努利试验中的成功次数，它服从一个缩放的二项分布。真实的成功概率是 $p_i$。成功次数 $S_i$ 服从二项分布 $S_i \\sim \\text{Binomial}(M_i, p_i)$。\n\n估计量 $\\hat{p}_{i}$ 的期望值和方差为：\n$$\nE[\\hat{p}_{i}] = E\\left[\\frac{S_{i}}{M_{i}}\\right] = \\frac{1}{M_{i}} E[S_{i}] = \\frac{M_{i} p_{i}}{M_{i}} = p_{i}\n$$\n$$\n\\operatorname{Var}[\\hat{p}_{i}] = \\operatorname{Var}\\left[\\frac{S_{i}}{M_{i}}\\right] = \\frac{1}{M_{i}^{2}} \\operatorname{Var}[S_{i}] = \\frac{M_{i} p_{i} (1 - p_{i})}{M_{i}^{2}} = \\frac{p_{i}(1 - p_{i})}{M_{i}}\n$$\ndelta方法为随机变量函数的方差提供了一个近似值。对于函数 $g(X)$，近似值为 $\\operatorname{Var}[g(X)] \\approx (g'(E[X]))^{2} \\operatorname{Var}[X]$。在这里，我们的随机变量是 $\\hat{p}_{i}$，函数是 $g(x) = \\log(x)$。其导数为 $g'(x) = 1/x$。\n\n应用delta方法，其中 $E[\\hat{p}_{i}]=p_i$：\n$$\n\\operatorname{Var}[\\log \\hat{p}_{i}] \\approx (g'(p_{i}))^{2} \\operatorname{Var}[\\hat{p}_{i}] = \\left(\\frac{1}{p_{i}}\\right)^{2} \\left(\\frac{p_{i}(1 - p_{i})}{M_{i}}\\right) = \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n这是由中心极限定理证明的，在大的 $M_i$ 极限下，方差的主导阶项。\n\n将此结果代回到总方差的表达式中，我们得到需要最小化的目标函数：\n$$\n\\operatorname{Var}[\\log \\hat{k}_{AB}] \\approx \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n\n### 第二部分：优化问题的建立\n\n我们的目标是在固定的总计算预算下，最小化推导出的方差。令 $V(\\{M_i\\})$ 表示近似方差。该问题可建立为：\n\n最小化：\n$$\nV(\\{M_i\\}) = \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}}\n$$\n约束条件为：\n$$\n\\sum_{i=0}^{n-1} c_{i} M_{i} = B\n$$\n其中对于所有 $i \\in \\{0, 1, \\dots, n-1\\}$，$M_{i}  0$。\n\n### 第三部分：求解优化问题\n\n这是一个约束优化问题，可以使用拉格朗日乘子法求解。我们定义拉格朗日量 $\\mathcal{L}$：\n$$\n\\mathcal{L}(\\{M_i\\}, \\lambda) = \\sum_{i=0}^{n-1} \\frac{1 - p_{i}}{p_{i} M_{i}} + \\lambda \\left( \\left( \\sum_{i=0}^{n-1} c_{i} M_{i} \\right) - B \\right)\n$$\n为了找到最优值 $\\{M_{i}^{\\ast}\\}$，我们将 $\\mathcal{L}$ 对每个 $M_k$（对于 $k \\in \\{0, \\dots, n-1\\}$）的偏导数设为零：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial M_k} = \\frac{\\partial}{\\partial M_k} \\left( \\frac{1 - p_k}{p_k M_k} \\right) + \\lambda \\frac{\\partial}{\\partial M_k} (c_k M_k) = 0\n$$\n$$\n-\\frac{1 - p_k}{p_k M_k^2} + \\lambda c_k = 0\n$$\n求解 $M_k$：\n$$\n\\lambda c_k = \\frac{1 - p_k}{p_k M_k^2} \\implies M_k^2 = \\frac{1 - p_k}{\\lambda c_k p_k}\n$$\n因为 $M_k$ 必须为正，我们取正根：\n$$\nM_k = \\sqrt{\\frac{1 - p_k}{\\lambda c_k p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{1 - p_k}{c_k p_k}}\n$$\n现在，我们使用预算约束来确定拉格朗日乘子 $\\lambda$。我们将 $M_k$ 的表达式代入约束方程中：\n$$\n\\sum_{k=0}^{n-1} c_k M_k = \\sum_{k=0}^{n-1} c_k \\left( \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{1 - p_k}{c_k p_k}} \\right) = B\n$$\n提取包含 $\\lambda$ 的项：\n$$\n\\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} c_k \\frac{\\sqrt{1 - p_k}}{\\sqrt{c_k p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} \\sqrt{c_k} \\sqrt{\\frac{1-p_k}{p_k}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{k=0}^{n-1} \\sqrt{\\frac{c_k(1-p_k)}{p_k}} = B\n$$\n求解 $1/\\sqrt{\\lambda}$：\n$$\n\\frac{1}{\\sqrt{\\lambda}} = \\frac{B}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1 - p_j)}{p_j}}}\n$$\n最后，我们将 $1/\\sqrt{\\lambda}$ 的这个表达式代回到 $M_k$ 的方程中，以找到最优分配 $M_k^{\\ast}$：\n$$\nM_k^{\\ast} = \\left( \\frac{B}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1 - p_j)}{p_j}}} \\right) \\sqrt{\\frac{1 - p_k}{c_k p_k}}\n$$\n按照问题陈述的要求，将索引 $k$ 替换为 $i$，我们得到最优分配向量 $\\{M_i^{\\ast}\\}_{i=0}^{n-1}$ 的最终表达式。每个分量 $M_i^{\\ast}$ 由下式给出：\n$$\nM_{i}^{\\ast} = B \\frac{\\sqrt{\\frac{1-p_i}{c_i p_i}}}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_j(1-p_j)}{p_j}}}\n$$",
            "answer": "$$\n\\boxed{M_{i}^{\\ast} = B \\frac{\\sqrt{\\frac{1-p_{i}}{c_{i}p_{i}}}}{\\sum_{j=0}^{n-1} \\sqrt{\\frac{c_{j}(1-p_{j})}{p_{j}}}}}\n$$"
        }
    ]
}