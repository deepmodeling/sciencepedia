{
    "hands_on_practices": [
        {
            "introduction": "This first practice grounds your understanding of why specialized methods like Transition Path Sampling are essential. By modeling rare reactive events as a Poisson process, a common and powerful assumption in chemical kinetics, you will quantify the challenge of observing such transitions in a standard simulation . This exercise highlights the fundamental \"sampling problem\" that arises when the simulation timescale is much shorter than the average waiting time for the event of interest.",
            "id": "3826181",
            "problem": "Consider an equilibrium molecular system exhibiting rare barrier crossings between two metastable basins $A$ and $B$ in configuration space. Coarse-graining the microscopic dynamics to the basin label yields a two-state kinetic description under time scale separation, where transitions $A \\to B$ occur as a renewal process with a constant hazard (rate) $k_{AB}$. Assume the system is stationary and the crossing events are well described by a homogeneous Poisson process of intensity $k_{AB}$. A long equilibrium trajectory is sampled, and a segment of duration $T$ is chosen uniformly at random in time. In the context of Transition Path Sampling (TPS), reactive events $A \\to B$ are viewed as points in time generated by the aforementioned Poisson process.\n\nStarting from the definition of a homogeneous Poisson process and its associated exponential waiting time distribution, derive the probability that the chosen trajectory segment of duration $T$ contains at least one $A \\to B$ transition. Express your final answer as a closed-form analytical expression in terms of $k_{AB}$ and $T$. Do not introduce any numerical values. No rounding is required, and no units are to be included in the final expression.",
            "solution": "### Solution Derivation\n\nThe problem asks for the probability of observing at least one $A \\to B$ transition within a time interval of duration $T$. The occurrence of these transitions is modeled as a homogeneous Poisson process with a constant rate, denoted by the intensity $k_{AB}$.\n\nLet $N(t)$ be the random variable representing the number of transitions that have occurred in the time interval $[0, t]$. The problem asks for the probability $P(N(T) \\ge 1)$. It is often simpler to calculate the complementary probability, which is the probability of observing exactly zero transitions, $P(N(T) = 0)$. The desired probability is then given by:\n$$ P(N(T) \\ge 1) = 1 - P(N(T) = 0) $$\n\nThe problem specifies to start from the properties of a homogeneous Poisson process and its associated exponential waiting time distribution. A defining characteristic of a homogeneous Poisson process with rate $\\lambda$ (here, $\\lambda = k_{AB}$) is that the waiting times between consecutive events are independent and identically distributed (i.i.d.) random variables following an exponential distribution.\n\nLet $\\tau$ be the waiting time for the first $A \\to B$ transition to occur, starting from an arbitrary point in time. The probability density function (PDF) of this waiting time is given by the exponential distribution:\n$$ f(\\tau; k_{AB}) = k_{AB} \\exp(-k_{AB} \\tau) \\quad \\text{for } \\tau \\ge 0 $$\nThe event that \"zero transitions occur in the interval $[0, T]$\" is equivalent to the event that \"the waiting time for the first transition is greater than $T$\". We can express this as:\n$$ P(N(T) = 0) = P(\\tau > T) $$\nThe probability $P(\\tau > T)$ is also known as the survival function, $S(T)$. It can be calculated by integrating the PDF from $T$ to infinity, or more simply, by using the cumulative distribution function (CDF). The CDF, $F(T) = P(\\tau \\le T)$, gives the probability that the first event has occurred by time $T$. The CDF is calculated as:\n$$ F(T) = P(\\tau \\le T) = \\int_{0}^{T} f(t; k_{AB}) dt = \\int_{0}^{T} k_{AB} \\exp(-k_{AB} t) dt $$\nEvaluating the integral:\n$$ F(T) = \\left[ -\\exp(-k_{AB} t) \\right]_{0}^{T} = (-\\exp(-k_{AB} T)) - (-\\exp(-k_{AB} \\cdot 0)) = 1 - \\exp(-k_{AB} T) $$\nThe probability of having no events in $[0, T]$ is the complement of the CDF:\n$$ P(N(T) = 0) = P(\\tau > T) = 1 - P(\\tau \\le T) = 1 - F(T) $$\nSubstituting the expression for $F(T)$:\n$$ P(N(T) = 0) = 1 - (1 - \\exp(-k_{AB} T)) = \\exp(-k_{AB} T) $$\nThis expression represents the probability that the chosen trajectory segment of duration $T$ contains zero transitions.\n\nFinally, the probability that the segment contains at least one transition is:\n$$ P(N(T) \\ge 1) = 1 - P(N(T) = 0) = 1 - \\exp(-k_{AB} T) $$\nThis is the closed-form analytical expression for the desired probability in terms of the rate $k_{AB}$ and the duration $T$.",
            "answer": "$$\n\\boxed{1 - \\exp(-k_{AB} T)}\n$$"
        },
        {
            "introduction": "At the heart of Transition Path Sampling is the \"shooting move,\" a clever Monte Carlo procedure performed in the space of possible trajectories. This exercise challenges you to derive the acceptance probability for this move directly from the fundamental principle of detailed balance . In doing so, you will discover how this single, elegant criterion correctly governs sampling in both energy-conserving (microcanonical) and constant-temperature (canonical) systems.",
            "id": "3826162",
            "problem": "Consider a system of $N$ particles with Hamiltonian $H(\\mathbf{q},\\mathbf{p}) = K(\\mathbf{p}) + U(\\mathbf{q})$, where $K(\\mathbf{p}) = \\sum_{i=1}^{N} \\frac{|\\mathbf{p}_{i}|^{2}}{2 m_{i}}$ is the kinetic energy and $U(\\mathbf{q})$ is a smooth potential energy. In transition path sampling, a shooting move is constructed by selecting a shooting time $t^{\\star}$ and phase point $x^{\\star} = (\\mathbf{q}^{\\star}, \\mathbf{p}^{\\star})$, then proposing new momenta via a symmetric Gaussian perturbation\n$$\n\\mathbf{p}^{\\text{prop}} = \\mathbf{p}^{\\star} + \\boldsymbol{\\eta}, \\quad \\boldsymbol{\\eta} \\sim \\mathcal{N}\\big( \\mathbf{0}, \\sigma^{2} \\mathbf{M} \\big),\n$$\nwhere $\\mathbf{M}$ is a diagonal mass matrix with entries $m_{i}$ and $\\sigma > 0$. For microcanonical (constant-energy, Newtonian) dynamics (denoted NVE), a scalar velocity rescaling $c$ is applied so that the post-perturbation state satisfies $H(\\mathbf{q}^{\\star}, c \\mathbf{p}^{\\text{prop}}) = E_{0}$, where $E_{0}$ is the target energy. Assume deterministic, time-reversible, measure-preserving dynamics and that the shooting proposal distribution is symmetric.\n\nStarting from the requirement of detailed balance for the path ensemble and using only the core definitions of the microcanonical and canonical distributions, derive the acceptance ratio for this shooting move. Express your result as a single closed-form analytic expression that can be evaluated under both scenarios:\n- For the microcanonical ensemble (NVE) with the energy-conserving rescaling,\n- For a canonical ensemble (isothermal, denoted NVT) when thermostatting is applied at inverse temperature $\\beta$.\n\nDefine the energy change at the shooting point by $\\Delta E = H(\\mathbf{q}^{\\star}, \\mathbf{p}^{\\text{new}}) - H(\\mathbf{q}^{\\star}, \\mathbf{p}^{\\star})$, where $\\mathbf{p}^{\\text{new}}$ is the momentum entering forward and backward integration after the proposal step (with or without rescaling, consistent with the ensemble). Your final answer must be a single analytic expression in terms of $\\beta$ and $\\Delta E$, dimensionless, and must not contain inequalities or equations. Do not round; no numerical evaluation is required.",
            "solution": "We derive the acceptance ratio for a shooting move in transition path sampling using first principles: detailed balance, symmetry of the proposal, and the equilibrium phase-space weights of the ensemble.\n\nThe path ensemble weight is proportional to the equilibrium weight of the shooting point and the characteristic functions that enforce boundary conditions (membership in reactant and product basins). Under deterministic, time-reversible, measure-preserving dynamics, and with a symmetric proposal for the shooting perturbation, the Metropolis-Hastings acceptance ratio reduces to the ratio of equilibrium weights evaluated at the shooting point before and after the perturbation. This follows from the detailed balance condition applied to paths, but because the forward and backward integrations are deterministic and the proposal kernel is symmetric, the Jacobian determinant for mapping phase points to paths is unity, and the proposal probabilities cancel in the acceptance ratio.\n\nLet $x^{\\star} = (\\mathbf{q}^{\\star}, \\mathbf{p}^{\\star})$ be the original shooting point and $x' = (\\mathbf{q}^{\\star}, \\mathbf{p}^{\\text{new}})$ be the perturbed shooting point that seeds the new path (after possible rescaling). The acceptance ratio $R$ can be written in terms of the equilibrium weights $\\rho$ as\n$$\nR = \\frac{\\rho(x')}{\\rho(x^{\\star})}.\n$$\n\nWe now consider the ensemble weights:\n\n1. Microcanonical ensemble (NVE). The microcanonical density is\n$$\n\\rho_{\\text{micro}}(x) \\propto \\delta\\big(H(x) - E_{0}\\big),\n$$\nwhere $\\delta$ is the Dirac delta distribution and $E_{0}$ is the fixed energy of the ensemble. By construction of the shooting move in NVE, we rescale the proposed momenta by a scalar $c$ to enforce\n$$\nH(\\mathbf{q}^{\\star}, c \\mathbf{p}^{\\text{prop}}) = E_{0}.\n$$\nThus, the post-perturbation state $x'$ satisfies $H(x') = E_{0}$, exactly as the original state $x^{\\star}$ does. Therefore, both $\\rho_{\\text{micro}}(x')$ and $\\rho_{\\text{micro}}(x^{\\star})$ are supported at the same energy shell, and their ratio is equal to one:\n$$\nR_{\\text{micro}} = \\frac{\\rho_{\\text{micro}}(x')}{\\rho_{\\text{micro}}(x^{\\star})} = 1.\n$$\nThis result is independent of the details of the symmetric Gaussian perturbation because the proposal symmetry and the rescaling ensure both points lie on the same microcanonical manifold.\n\n2. Canonical ensemble (NVT). When thermostatting is applied and the system is sampled from the canonical distribution at inverse temperature $\\beta$, the equilibrium weight is\n$$\n\\rho_{\\text{can}}(x) \\propto \\exp\\big(-\\beta H(x)\\big).\n$$\nFor a symmetric proposal, the acceptance ratio becomes\n$$\nR_{\\text{can}} = \\frac{\\exp\\big(-\\beta H(x')\\big)}{\\exp\\big(-\\beta H(x^{\\star})\\big)} = \\exp\\big(-\\beta\\big[H(x') - H(x^{\\star})\\big]\\big).\n$$\nDefining the energy change at the shooting point by\n$$\n\\Delta E = H(\\mathbf{q}^{\\star}, \\mathbf{p}^{\\text{new}}) - H(\\mathbf{q}^{\\star}, \\mathbf{p}^{\\star}),\n$$\nwe obtain\n$$\nR_{\\text{can}} = \\exp(-\\beta \\Delta E).\n$$\n\nWe seek a single analytic expression that is valid in both settings. In the microcanonical case, the energy change enforced by rescaling is $\\Delta E = 0$, which gives\n$$\nR_{\\text{micro}} = \\exp(-\\beta \\cdot 0) = 1.\n$$\nIn the canonical case, $\\Delta E$ is the actual energy change induced by the shooting perturbation, so\n$$\nR_{\\text{can}} = \\exp(-\\beta \\Delta E).\n$$\n\nThus, the acceptance ratio for the shooting move can be uniformly expressed in terms of $\\beta$ and $\\Delta E$ as\n$$\nR = \\exp(-\\beta \\Delta E),\n$$\nwhich correctly reduces to unity in the microcanonical case because $\\Delta E = 0$ under the energy-conserving rescaling, and yields the canonical weight ratio when thermostatting is applied.\n\nNo additional factors appear because the proposal is symmetric (Gaussian with zero mean and equal covariance in forward and reverse moves), the deterministic dynamics are measure-preserving, and the mapping from the shooting point to the path has unit Jacobian, ensuring that the acceptance ratio is determined solely by the ratio of equilibrium weights at the shooting point. The final expression is dimensionless and depends only on the inverse temperature $\\beta$ and the energy change $\\Delta E$.",
            "answer": "$$\\boxed{\\exp(-\\beta \\Delta E)}$$"
        },
        {
            "introduction": "An effective TPS simulation requires not just generating new paths, but doing so efficiently. This advanced problem delves into the connection between the physical properties of the transition and the performance of the algorithm . By analyzing the committor probability—the likelihood of a trajectory reaching the product state—you will quantify how an intelligent, physically-motivated choice of shooting points can dramatically improve the sampling efficiency.",
            "id": "3826190",
            "problem": "Consider Transition Path Sampling (TPS) for a symmetric one-dimensional double-well system with potential $U(x) = \\frac{1}{4}\\left(x^{2} - 1\\right)^{2}$, minima near $x=-1$ and $x=1$, and a barrier at $x=0$. Let $A$ and $B$ denote disjoint sets corresponding to the left and right wells, respectively, and suppose the dynamics is ergodic, Markovian, and time-reversible with detailed balance with respect to the Boltzmann weight proportional to $\\exp(-\\beta U(x))$ at inverse temperature $\\beta$. Define the forward committor $q^{+}(x)$ as the probability that a trajectory initiated at $x$ reaches $B$ before $A$, and the backward committor $q^{-}(x)$ as the probability that the trajectory came from $A$ rather than $B$ when traced backward in time.\n\nIn TPS shooting, a new path is proposed by selecting a shooting point on the current reactive path and regenerating both the backward and forward segments using a symmetric perturbation consistent with time-reversibility. Assume that the acceptance of a proposed shooting move requires that the backward segment reaches $A$ and the forward segment reaches $B$, and that, given a shooting point, these outcomes follow the Markov property.\n\nTwo shooting point selection strategies are considered:\n\n- Scheme U (uniform in committor): select shooting points with a probability density that is uniform in the forward committor $q^{+}$, i.e., treat $q^{+}$ as a reaction-coordinate-like parametrization and choose shooting points with equal probability per unit increment of $q^{+}\\in[0,1]$.\n\n- Scheme LV (low-variance bias): select shooting points only when the forward committor lies in the sets $q^{+}\\in[0,\\delta]\\cup[1-\\delta,1]$ for a fixed $0<\\delta<\\frac{1}{2}$, with uniform probability density within these sets, motivated by the low Bernoulli variance $q^{+}(1-q^{+})$ for estimates of the committor near $0$ or $1$.\n\nStarting from the fundamental definitions of the forward and backward committors and the detailed-balance property of the reversible dynamics, derive the expression for the expected acceptance probability under each scheme. Then, compute the expected acceptance change, defined as the expected acceptance under Scheme LV minus that under Scheme U, as a closed-form analytic expression in terms of $\\delta$. Express your final answer without units. No rounding is required.",
            "solution": "The problem asks for the expected acceptance change between two shooting point selection schemes in Transition Path Sampling (TPS). We begin by establishing the fundamental expression for the acceptance probability of a shooting move.\n\nA proposed new path is generated by selecting a point $x$ on an existing reactive path and regenerating the forward and backward segments of the trajectory from this point. The move is accepted if the new forward-propagated segment reaches state $B$ before state $A$, and the new backward-propagated segment reaches state $A$ before state $B$. The problem states that, given the shooting point $x$, these two outcomes are independent due to the Markov property of the dynamics.\n\nThe probability that a trajectory initiated at $x$ reaches $B$ before $A$ is given by the forward committor, $q^{+}(x)$. The probability that a trajectory traced backward in time from $x$ came from $A$ rather than $B$ is given by the backward committor, $q^{-}(x)$. Therefore, the acceptance probability for a shooting move initiated at point $x$, denoted $P_{\\text{acc}}(x)$, is the product of these two probabilities:\n$$P_{\\text{acc}}(x) = q^{+}(x) q^{-}(x)$$\n\nThe problem specifies that the system dynamics are governed by a symmetric potential $U(x) = \\frac{1}{4}\\left(x^{2} - 1\\right)^{2}$, which satisfies $U(x) = U(-x)$. The states $A$ and $B$ correspond to the wells near $x=-1$ and $x=1$, respectively, forming a symmetric arrangement. Furthermore, the dynamics are ergodic, Markovian, and exhibit time-reversibility with respect to the Boltzmann weight.\n\nFor such a time-reversible system, there is a direct relationship between the forward and backward committors. The backward committor $q^{-}(x)$ is the probability that the trajectory, traced backward in time from $x$, came from $A$. Due to time-reversibility, this is equivalent to the probability that a time-reversed trajectory initiated at $x$ will reach state $A$ before state $B$. The probability of reaching $B$ before $A$ is $q^{+}(x)$, and since these are the only two possible outcomes for a trajectory starting outside of $A$ and $B$, their probabilities must sum to $1$. Thus, the probability of reaching $A$ before $B$ from $x$ is $1 - q^{+}(x)$. This leads to the crucial identity:\n$$q^{-}(x) = 1 - q^{+}(x)$$\nSubstituting this into the expression for the acceptance probability, we find that $P_{\\text{acc}}$ depends only on the forward committor value:\n$$P_{\\text{acc}}(q^{+}(x)) = q^{+}(x) \\left(1 - q^{+}(x)\\right)$$\nTo simplify notation, let $q_p$ represent a value of the forward committor, $q_p \\in [0, 1]$. The acceptance probability for a point with committor value $q_p$ is $P_{\\text{acc}}(q_p) = q_p(1-q_p)$.\n\nWe now compute the expected acceptance probability for each selection scheme by integrating $P_{\\text{acc}}(q_p)$ over the probability density of selecting a shooting point with committor value $q_p$.\n\n**Scheme U (uniform in committor):**\nThe shooting points are selected with a probability density $p_U(q_p)$ that is uniform in the forward committor $q_p \\in [0,1]$. For the density to be normalized, $\\int_0^1 p_U(q_p) dq_p = 1$, we must have $p_U(q_p) = 1$ for $q_p \\in [0,1]$ and $0$ otherwise.\nThe expected acceptance probability, $\\langle P_{\\text{acc}} \\rangle_U$, is:\n$$\\langle P_{\\text{acc}} \\rangle_U = \\int_{0}^{1} P_{\\text{acc}}(q_p) p_U(q_p) dq_p = \\int_{0}^{1} q_p(1-q_p) \\cdot 1 \\, dq_p$$\n$$\\langle P_{\\text{acc}} \\rangle_U = \\int_{0}^{1} (q_p - q_p^2) dq_p = \\left[ \\frac{q_p^2}{2} - \\frac{q_p^3}{3} \\right]_0^1 = \\frac{1^2}{2} - \\frac{1^3}{3} = \\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}$$\n\n**Scheme LV (low-variance bias):**\nThe shooting points are selected with a uniform probability density $p_{LV}(q_p)$ only within the sets where $q_p \\in [0, \\delta] \\cup [1-\\delta, 1]$, for a fixed $0 < \\delta < \\frac{1}{2}$. The total width of this support in committor space is $\\delta + (1 - (1-\\delta)) = 2\\delta$. Normalizing the probability density over this support gives:\n$$p_{LV}(q_p) = \\begin{cases} \\frac{1}{2\\delta} & \\text{if } q_p \\in [0, \\delta] \\cup [1-\\delta, 1] \\\\ 0 & \\text{otherwise} \\end{cases}$$\nThe expected acceptance probability, $\\langle P_{\\text{acc}} \\rangle_{LV}$, is:\n$$\\langle P_{\\text{acc}} \\rangle_{LV} = \\int_{0}^{1} P_{\\text{acc}}(q_p) p_{LV}(q_p) dq_p = \\frac{1}{2\\delta} \\left( \\int_{0}^{\\delta} q_p(1-q_p) dq_p + \\int_{1-\\delta}^{1} q_p(1-q_p) dq_p \\right)$$\nThe integrand $f(q_p) = q_p(1-q_p)$ is symmetric about $q_p = \\frac{1}{2}$. Therefore, the integral over $[0, \\delta]$ is equal to the integral over $[1-\\delta, 1]$. We can write:\n$$\\langle P_{\\text{acc}} \\rangle_{LV} = \\frac{1}{2\\delta} \\cdot 2 \\int_{0}^{\\delta} q_p(1-q_p) dq_p = \\frac{1}{\\delta} \\int_{0}^{\\delta} (q_p - q_p^2) dq_p$$\n$$\\langle P_{\\text{acc}} \\rangle_{LV} = \\frac{1}{\\delta} \\left[ \\frac{q_p^2}{2} - \\frac{q_p^3}{3} \\right]_0^\\delta = \\frac{1}{\\delta} \\left( \\frac{\\delta^2}{2} - \\frac{\\delta^3}{3} \\right) = \\frac{\\delta}{2} - \\frac{\\delta^2}{3}$$\n\n**Expected Acceptance Change:**\nFinally, we compute the expected acceptance change, defined as the expected acceptance under Scheme LV minus that under Scheme U.\n$$\\Delta \\langle P_{\\text{acc}} \\rangle = \\langle P_{\\text{acc}} \\rangle_{LV} - \\langle P_{\\text{acc}} \\rangle_U$$\n$$\\Delta \\langle P_{\\text{acc}} \\rangle = \\left(\\frac{\\delta}{2} - \\frac{\\delta^2}{3}\\right) - \\frac{1}{6}$$\nTo present this as a single expression, we find a common denominator:\n$$\\Delta \\langle P_{\\text{acc}} \\rangle = \\frac{3\\delta}{6} - \\frac{2\\delta^2}{6} - \\frac{1}{6} = \\frac{3\\delta - 2\\delta^2 - 1}{6}$$\nThis is the final closed-form analytic expression for the expected acceptance change in terms of $\\delta$.",
            "answer": "$$ \\boxed{\\frac{3\\delta - 2\\delta^2 - 1}{6}} $$"
        }
    ]
}