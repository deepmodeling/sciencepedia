{
    "hands_on_practices": [
        {
            "introduction": "在进行基于实空间网格的含时密度泛函理论（TDDFT）计算时，我们首先遇到的实践问题是如何设定数值参数以确保结果的准确性。本练习将指导您推导并确定两个最关键的参数：网格间距 $h$ 和模拟盒子半径 $R$ 。通过将量子力学的基本原理——例如与最高动能相关的德布罗意波长和束缚态波函数的渐近衰减行为——与计算设置直接联系起来，您将学会如何为可靠的光吸收谱模拟选择合理的参数。",
            "id": "2682991",
            "problem": "你需要为一个中性钠原子的实空间、有限差分含时密度泛函理论 (TDDFT) 模拟设计数值参数，以将线性光吸收谱收敛至一个目标光子能量。你的任务是推导、论证并实现两个关键参数的公式：均匀网格间距和最小球形模拟盒子半径，以确保边界效应和离散化误差在达到目标能量尺度之前不会污染光谱。\n\n你的推导必须仅基于物理化学中适用于含时密度泛函理论的基本定律和核心定义，包括非相对论性不含时 Schrödinger 方程、自由粒子色散、de Broglie 波长、采样定理，以及在有效势垒之外的束缚态轨道的渐近指数衰减，并结合广为接受的物理常数。不得假定任何专用代码或预先推导的“黑箱”公式。你必须从第一性原理出发，论证以下建模选择：\n- 空间分辨率要求：对于线性响应直至目标光子能量所需解析的最高动能，要求其关联的空间振荡（de Broglie 波长）内至少包含最小数量的网格点。\n- 有限模拟域要求：要求模拟域边界处的渐近束缚态价轨道振幅受用户指定的容差限制，并使用电离势来设定衰减尺度。\n\n假设所有计算均在原子单位下进行，但输入的目标能量以电子伏特为单位给出。使用以下常数：\n- 钠的电离势：$I_{\\mathrm{p}} = 5.139\\ \\mathrm{eV}$。\n- 一哈特里（hartree）等于的电子伏特数：$1\\ \\mathrm{Ha} = 27.211386245988\\ \\mathrm{eV}$。\n\n你必须使用的定义和建模假设：\n- 对于高达目标光子能量 $E_{\\max}$ 的线性光吸收，必须表示的最高动能由与 $E_{\\max}$ 对应的自由电子动能给出，以哈特里（hartree）为单位表示。\n- 必须使用动能与波数之间的自由粒子关系以及采样定理来设置网格间距，以确保在由 $E_{\\max}$ 隐含的最高波数处，每个 de Broglie 波长至少有 $N_{\\mathrm{p}}$ 个网格点。\n- 中性原子的最高占据 Kohn–Sham 轨道的渐近振幅按由电离势决定的指数形式衰减；使用此渐近形式选择一个最小球形半径 $R$，使得边界处的振幅不大于用户指定的无量纲容差 $\\varepsilon$。\n\n程序要求：\n- 对于每个测试用例，你的程序必须计算一个数对 $[h_{\\mathrm{bohr}}, R_{\\mathrm{bohr}}]$，其中 $h_{\\mathrm{bohr}}$ 是以玻尔（bohr）为单位的均匀网格间距，$R_{\\mathrm{bohr}}$ 是以玻尔（bohr）为单位的最小球形模拟盒子半径。\n- 所有长度必须以玻尔（bohr）表示，并四舍五入到六位小数。\n- 如果推导中出现任何角度，必须以弧度为单位。\n- 你的程序不得读取任何输入，并且必须生成单行输出，其中包含所有测试用例的有序结果列表，格式为单个列表的列表，无空格，例如：$[[h_1,R_1],[h_2,R_2],\\dots]$。\n\n测试套件：\n每个测试用例是一个三元组 $(E_{\\max}^{(\\mathrm{eV})}, N_{\\mathrm{p}}, \\varepsilon)$。\n1. $(10.0, 10, 1\\times 10^{-6})$\n2. $(10.0, 12, 1\\times 10^{-8})$\n3. $(10.0, 2, 1\\times 10^{-3})$\n4. $(8.0, 10, 1\\times 10^{-6})$\n5. $(12.0, 10, 1\\times 10^{-6})$\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，其中每个元素是对应测试用例的数对 $[h_{\\mathrm{bohr}}, R_{\\mathrm{bohr}}]$，例如：$[[h_1,R_1],[h_2,R_2],[h_3,R_3],[h_4,R_4],[h_5,R_5]]$。",
            "solution": "所提出的问题陈述已经过验证，并被认定为有效。它具有科学依据，是良置的、客观的且内部一致的。它提出了一个计算物理化学中的标准、可解问题，涉及基于基本原理建立数值模拟。我们现在将继续推导所需参数。\n\n所有推导和计算都将在原子单位（a.u.）下进行，其中约化普朗克常数 $\\hbar$、电子质量 $m_e$ 和基本电荷 $e$ 均等于 $1$。在该单位体系中，能量以哈特里（Hartree, $Ha$）计量，距离以玻尔（Bohr, $a_0$）计量。所提供的以其他单位给出的输入参数必须进行相应转换。电子伏特（$eV$）和哈特里（$Ha$）之间的转换因子为 $1\\ \\mathrm{Ha} = C_{\\mathrm{Ha/eV}} \\ \\mathrm{eV}$，其中 $C_{\\mathrm{Ha/eV}} = 27.211386245988$。\n\n首先，我们推导均匀网格间距 $h$ 的公式。\n问题要求数值网格必须足够精细，以表示吸收了最高能量为 $E_{\\max}$ 的光子的电子动力学。问题明确指出，必须精确表示的最高动能 $T_{\\max}$ 等于此最大光子能量。设 $E_{\\max}^{(\\mathrm{eV})}$ 是以电子伏特为单位的输入能量。我们首先将其转换为哈特里：\n$$ E_{\\max}^{(\\mathrm{Ha})} = \\frac{E_{\\max}^{(\\mathrm{eV})}}{C_{\\mathrm{Ha/eV}}} $$\n因此，我们将需要解析的最大动能设置为：\n$$ T_{\\max} = E_{\\max}^{(\\mathrm{Ha})} $$\n在原子单位中，自由粒子的动能 $T$ 与波数 $k$ 之间的关系由色散关系给出：\n$$ T = \\frac{k^2}{2} $$\n由此，我们可以找到对应于 $T_{\\max}$ 的最大波数 $k_{\\max}$：\n$$ k_{\\max} = \\sqrt{2 T_{\\max}} = \\sqrt{2 E_{\\max}^{(\\mathrm{Ha})}} $$\nde Broglie 波长 $\\lambda$ 与波数 $k$ 的关系为 $\\lambda = 2\\pi/k$。因此，需要解析的最小波长 $\\lambda_{\\min}$ 对应于 $k_{\\max}$：\n$$ \\lambda_{\\min} = \\frac{2\\pi}{k_{\\max}} = \\frac{2\\pi}{\\sqrt{2 E_{\\max}^{(\\mathrm{Ha})}}} $$\n采样定理规定，要在离散网格上表示波长为 $\\lambda_{\\min}$ 的波，需要的网格间距 $h$ 应为 $\\lambda_{\\min}$ 的一部分。问题指定的分辨率标准是每个波长至少有 $N_{\\mathrm{p}}$ 个网格点。为了找到满足此条件的最大允许网格间距，我们设定：\n$$ h = \\frac{\\lambda_{\\min}}{N_{\\mathrm{p}}} $$\n代入 $\\lambda_{\\min}$ 的表达式，我们得到以玻尔（Bohr）为单位的网格间距 $h_{\\mathrm{bohr}}$ 的最终公式：\n$$ h_{\\mathrm{bohr}} = \\frac{2\\pi}{N_{\\mathrm{p}} \\sqrt{2 E_{\\max}^{(\\mathrm{Ha})}}} = \\frac{2\\pi}{N_{\\mathrm{p}} \\sqrt{2 \\frac{E_{\\max}^{(\\mathrm{eV})}}{C_{\\mathrm{Ha/eV}}}}} $$\n\n接下来，我们推导最小球形模拟盒子半径 $R$ 的公式。\n模拟盒子必须足够大，以便能够包含束缚态的电子密度，且截断误差可以忽略不计。问题指示我们以最高占据 Kohn-Sham 轨道的渐近衰减为基础。对于能量为 $E = -I_{\\mathrm{p}}$（其中 $I_{\\mathrm{p}}$ 是电离势）的束缚态，在远离原子核（势能消失处）的不含时 Schrödinger 方程的解呈指数衰减。波函数 $\\psi(r)$ 在大径向距离 $r$ 处的行为如下：\n$$ \\psi(r) \\sim e^{-\\alpha r} $$\n衰减常数 $\\alpha$ 由结合能确定。在势能 $V(r) \\approx 0$ 的区域中，能量为 $E$ 的状态的 Schrödinger 方程的径向部分近似为 $\\frac{d^2\\psi}{dr^2} \\approx 2E\\psi$。当 $E=-I_{\\mathrm{p}}$ 时，这给出 $\\alpha^2 = 2 I_{\\mathrm{p}}^{(\\mathrm{Ha})}$，其中 $I_{\\mathrm{p}}^{(\\mathrm{Ha})}$ 是以哈特里为单位的电离势。因此，衰减常数为：\n$$ \\alpha = \\sqrt{2 I_{\\mathrm{p}}^{(\\mathrm{Ha})}} $$\n钠的电离势给定为 $I_{\\mathrm{p}}^{(\\mathrm{eV})} = 5.139\\ \\mathrm{eV}$。我们将其转换为哈特里：\n$$ I_{\\mathrm{p}}^{(\\mathrm{Ha})} = \\frac{I_{\\mathrm{p}}^{(\\mathrm{eV})}}{C_{\\mathrm{Ha/eV}}} = \\frac{5.139}{27.211386245988} $$\n问题要求在模拟盒子边界 $r = R$ 处的轨道振幅受无量纲容差 $\\varepsilon$ 的限制。我们通过将指数衰减因子本身设为等于 $\\varepsilon$ 来将其形式化：\n$$ e^{-\\alpha R} = \\varepsilon $$\n这是一个标准判据，其假设任何指前因子均为 1 的数量级。为求解最小半径 $R$，我们对等式两边取自然对数：\n$$ -\\alpha R = \\ln(\\varepsilon) $$\n$$ R = -\\frac{\\ln(\\varepsilon)}{\\alpha} $$\n由于容差 $\\varepsilon$ 是一个小于 1 的小数，其对数为负，从而确保 $R$ 是一个正值。代入 $\\alpha$ 的表达式，我们得到以玻尔（Bohr）为单位的盒子半径 $R_{\\mathrm{bohr}}$ 的最终公式：\n$$ R_{\\mathrm{bohr}} = -\\frac{\\ln(\\varepsilon)}{\\sqrt{2 I_{\\mathrm{p}}^{(\\mathrm{Ha})}}} = -\\frac{\\ln(\\varepsilon)}{\\sqrt{2 \\frac{I_{\\mathrm{p}}^{(\\mathrm{eV})}}{C_{\\mathrm{Ha/eV}}}}} $$\n\n这些推导出的 $h_{\\mathrm{bohr}}$ 和 $R_{\\mathrm{bohr}}$ 公式在提供的程序中实现，用于计算给定测试用例所需的模拟参数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and calculates simulation parameters for TDDFT based on first principles.\n    \"\"\"\n    \n    # Constants provided in the problem statement.\n    # Ionization potential of Sodium in eV.\n    IP_NA_EV = 5.139\n    # Conversion factor from Hartree to eV.\n    HARTREE_TO_EV = 27.211386245988\n    \n    # Convert Sodium a.u.\n    ip_na_ha = IP_NA_EV / HARTREE_TO_EV\n\n    # Test suite from the problem statement.\n    # Each case is a tuple: (E_max_eV, N_p, epsilon)\n    test_cases = [\n        (10.0, 10, 1e-6),\n        (10.0, 12, 1e-8),\n        (10.0, 2, 1e-3),\n        (8.0, 10, 1e-6),\n        (12.0, 10, 1e-6),\n    ]\n\n    results = []\n    for case in test_cases:\n        e_max_ev, n_p, epsilon = case\n\n        # 1. Calculate the uniform grid spacing, h (in Bohr).\n        # Convert max energy from eV to Hartree.\n        e_max_ha = e_max_ev / HARTREE_TO_EV\n        # Derivation: h = (2*pi) / (N_p * k_max) where k_max = sqrt(2 * T_max)\n        # T_max is assumed to be e_max_ha.\n        # h = (2*pi) / (N_p * sqrt(2 * e_max_ha))\n        h_bohr = (2 * np.pi) / (n_p * np.sqrt(2 * e_max_ha))\n\n        # 2. Calculate the minimal spherical simulation box radius, R (in Bohr).\n        # Derivation: R = -ln(epsilon) / alpha where alpha = sqrt(2 * I_p)\n        # R = -ln(epsilon) / sqrt(2 * ip_na_ha)\n        r_bohr = -np.log(epsilon) / np.sqrt(2 * ip_na_ha)\n\n        # Format results to six decimal places, as required.\n        h_formatted = f\"{h_bohr:.6f}\"\n        r_formatted = f\"{r_bohr:.6f}\"\n        \n        results.append(f\"[{h_formatted},{r_formatted}]\")\n\n    # Final print statement in the exact required format: [[h1,R1],[h2,R2],...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然TDDFT在许多方面都非常成功，但它也有一些著名的局限性，从业者必须对此保持警惕。本练习聚焦于其中最典型的一个问题：使用标准半局域泛函（如GGA）对长程电荷转移（CT）激发的灾难性低估 。您将通过第一性原理推导，构建一个简约但物理意义明确的模型，从而定量地揭示传统TDDFT方法为何会在此类重要激发上失效，并理解其背后的根本原因——交换相关核的局域性。",
            "id": "2466214",
            "problem": "要求您编写一个完整的、可运行的程序，在一个最小但有科学依据的模型中，演示含时密度泛函理论（TD-DFT）如何在使用标准广义梯度近似（GGA）泛函时，错误地预测空间分离的给体-受体对的虚假低能荷移激发。您的程序必须从第一性原理出发实现以下逻辑。\n\n从密度泛函理论（DFT）中电离势和电子亲和能的基本定义，以及分离电荷的静电相互作用出发。使用这些原理推导大间距下最低的给体到受体荷移激发能的表达式。然后，利用线性响应TD-DFT以及对于空间上不重叠的轨道，绝热半局域Hartree-交换-相关核产生可忽略的耦合这一事实，推导由半局域GGA泛函做出的相应预测。最后，通过引入导数不连续性，将Kohn–Sham轨道能量差与基本带隙联系起来。在您的推导中，请勿使用或引用任何现有的简化公式；相反，仅根据以下基本依据进行推理：\n- 基本定义：通过总能量差定义的电离势 $I$ 和电子亲和能 $A$，以及相距为 $R$ 的两个单位电荷之间的静电相互作用能。\n- 线性响应理论核心思想：激发能源于一个由无相互作用的跃迁能量和一个耦合项决定的响应极点，并且对于轨道重叠可忽略的空间分离片段之间的电荷转移，局域和绝热的核提供可忽略的长程耦合。\n- 经过充分检验的概念性事实：多体基本带隙通过导数不连续性与Kohn–Sham带隙相关联。\n\n实现一个最小的双片段模型，每个测试用例具有以下参数：\n- 给体的电离势 $I_D$，单位为Hartree。\n- 受体的电子亲和能 $A_A$，单位为Hartree。\n- 中心间距 $R$，单位为bohr。\n- 一个有效的正导数不连续性参数 $\\Delta_{\\mathrm{xc}}$，单位为Hartree，该参数捕捉了半局域GGA泛函典型的带隙低估特征。\n\n对于每个测试用例，计算：\n1. 基于上述原理的、有物理动机的大间距荷移激发能，以Hartree表示，此处记为 $E_{\\mathrm{true}}$。\n2. 绝热半局域GGA TD-DFT对相同荷移激发的预测值，以Hartree表示，此处记为 $E_{\\mathrm{GGA}}$。\n3. 带符号误差 $\\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}}$，单位为Hartree。\n4. 一个布尔标志，当且仅当GGA预测值是虚假的低值时为真，定义为严格不等式 $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$。\n\n您的程序必须使用以下固定的参数元组 $(I_D,A_A,R,\\Delta_{\\mathrm{xc}})$ 测试套件，单位为原子单位（能量为Hartree，距离为bohr）：\n- 测试 1（一般分离对）：$(0.30, 0.08, 30.0, 0.12)$。\n- 测试 2（极大间距）：$(0.30, 0.08, 200.0, 0.12)$。\n- 测试 3（小基本带隙导致接近零的GGA激发）：$(0.20, 0.08, 25.0, 0.12)$。\n- 测试 4（数值平衡点，在该 $R$ 值下低估量等于缺失的静电作用）：$(0.25, 0.05, 8.\\overline{3}, 0.12)$，其中 $8.\\overline{3}$ 表示 $25/3$ bohr。\n\n所有能量必须以Hartree表示，并四舍五入到六位小数。对于每个测试用例，您的程序必须按顺序输出 $E_{\\mathrm{true}}$、$E_{\\mathrm{GGA}}$、$\\Delta E$ 和布尔标志这四个值。将所有测试用例的结果聚合到一个单一的扁平列表中。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3,...]”）。\n\n不涉及角度单位。不允许外部输入；程序必须完全自包含，并在执行时产生所需的单行输出。",
            "solution": "问题陈述具有科学依据，提法恰当，并包含了推导唯一解所需的所有信息。它描述了常见密度泛函近似的一种众所周知的问题模式。因此，该问题被认为是有效的，并将基于所提供的第一性原理构建一个解决方案。\n\n我们首先推导在大间距下物理正确的荷移（$CT$）激发能的表达式，记为 $E_{\\mathrm{true}}$。一个 $CT$ 激发过程涉及将一个电子从给体分子 $D$ 移动到受体分子 $A$，两者相距为 $R$。这个过程可以表示为 $D^0A^0 \\rightarrow D^+A^-$。该激发的能量 $\\omega_{CT}$ 是最终态和初始态总能量之差：\n$$ \\omega_{CT} = E(D^+A^-) - E(D^0A^0) $$\n在大间距 $R$ 的极限下，组合体系的能量可以近似为其无相互作用的组分片段的能量之和，再加上它们的经典静电相互作用能。对于初始中性态，其能量为：\n$$ E(D^0A^0) \\approx E(D^0) + E(A^0) $$\n对于最终的离子态，能量包括新形成的离子之间的静电引力：\n$$ E(D^+A^-) \\approx E(D^+) + E(A^-) + E_{\\mathrm{int}} $$\n这里，$E(X)$ 表示物种 $X$ 的总能量。相互作用能 $E_{\\mathrm{int}}$ 是 $D^+$ 上的 $+1e$ 点电荷与 $A^-$ 上的 $-1e$ 点电荷之间的相互作用能，由库仑定律给出。在原子单位制中，能量单位为Hartree，距离单位为bohr，该能量为：\n$$ E_{\\mathrm{int}} = -\\frac{1}{R} $$\n将这些表达式代入 $\\omega_{CT}$ 的方程，我们得到：\n$$ \\omega_{CT} \\approx \\left( E(D^+) + E(A^-) - \\frac{1}{R} \\right) - \\left( E(D^0) + E(A^0) \\right) $$\n重新整理各项，按物种分组，得到：\n$$ \\omega_{CT} \\approx \\left( E(D^+) - E(D^0) \\right) + \\left( E(A^-) - E(A^0) \\right) - \\frac{1}{R} $$\n括号中的项对应于基本定义。给体的电离势 $I_D$ 是移去一个电子所需的能量：\n$$ I_D = E(D^+) - E(D^0) $$\n受体的电子亲和能 $A_A$ 是捕获一个电子时释放的能量，定义为：\n$$ A_A = E(A^0) - E(A^-) $$\n根据这个定义，可以得出 $E(A^-) - E(A^0) = -A_A$。将 $I_D$ 和 $A_A$ 的这些定义代入，我们便得到真正的大间距荷移激发能的表达式：\n$$ E_{\\mathrm{true}} = I_D - A_A - \\frac{1}{R} $$\n\n接下来，我们推导绝热半局域含时密度泛函理论（$TD-DFT$）的相应预测值，记为 $E_{\\mathrm{GGA}}$。在线性响应$TD-DFT$框架内，激发能 $\\omega$ 是通过一个矩阵方程的本征值得到的。对于从一个占据的Kohn-Sham（$KS$）轨道 $\\phi_i$ 到一个空的$KS$轨道 $\\phi_a$ 的单重激发，在绝热近似下，激发能由下式给出：\n$$ \\omega_{ia} = \\varepsilon_a - \\varepsilon_i + K_{ia,ia} $$\n其中 $\\varepsilon_i$ 和 $\\varepsilon_a$ 是 $KS$ 轨道的能量，$K_{ia,ia}$ 是耦合矩阵元。该矩阵元依赖于Hartree-交换-相关（$HXC$）核 $f_{HXC}$：\n$$ K_{ia,ia} = \\iint \\phi_i^*(\\mathbf{r})\\phi_a(\\mathbf{r}) f_{HXC}(\\mathbf{r}, \\mathbf{r}') \\phi_a^*(\\mathbf{r}')\\phi_i(\\mathbf{r}') d\\mathbf{r} d\\mathbf{r}' $$\n对于我们所考虑的 $CT$ 激发，占据轨道 $\\phi_i$ 是给体的最高占据分子轨道（$HOMO_D$），而空轨道 $\\phi_a$ 是受体的最低未占分子轨道（$LUMO_A$）。在大间距 $R$ 下，这些轨道在空间上是孤立的，它们的重叠乘积 $\\phi_i(\\mathbf{r})\\phi_a(\\mathbf{r})$ 对于所有 $\\mathbf{r}$ 都可以忽略不计。\n对于一个半局域泛函，例如广义梯度近似（$GGA$），其核 $f_{HXC}^{GGA}(\\mathbf{r}, \\mathbf{r}')$ 是有效局域的，意味着它随着距离 $|\\mathbf{r} - \\mathbf{r}'|$ 的增加而迅速衰减为零。局域核和可忽略的轨道重叠的结合，导致耦合积分 $K_{ia,ia}$ 变为零：\n$$ K_{ia,ia}^{GGA} \\approx 0 $$\n因此，$TD-GGA$ 激发能虚假地简化为所涉及的 $KS$ 轨道能量的简单差值：\n$$ E_{\\mathrm{GGA}} = \\omega_{CT}^{GGA} \\approx \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D} $$\n为了使此表达式有用，我们必须将此 $KS$ 轨道能隙与物理量 $I_D$ 和 $A_A$ 联系起来。组合的 $D-A$ 体系的基本多体带隙为 $E_{gap} = I_D - A_A$。相应的 $KS$ 带隙为 $\\varepsilon_{gap}^{KS} = \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}$。对于一个精确的泛函，这些量通过交换相关势的导数不连续性 $\\Delta_{xc}$ 相关联：\n$$ E_{gap} = \\varepsilon_{gap}^{KS} + \\Delta_{xc} \\implies I_D - A_A = (\\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}) + \\Delta_{xc} $$\n像 $GGA$ 这样的近似泛函存在已知的系统误差，该误差实际上对应于缺失的导数不连续性。本问题提供了一个有效参数 $\\Delta_{\\mathrm{xc}} > 0$ 来模拟此缺陷。在 $GGA$ 框架内，重新整理 $KS$ 带隙的方程可得：\n$$ \\varepsilon_{LUMO,A}^{GGA} - \\varepsilon_{HOMO,D}^{GGA} = (I_D - A_A) - \\Delta_{\\mathrm{xc}} $$\n这就给出了 $TD-GGA$ 荷移激发能的最终表达式：\n$$ E_{\\mathrm{GGA}} = I_D - A_A - \\Delta_{\\mathrm{xc}} $$\n这个结果错误地显示了激发能在大的 $R$ 值下趋于一个常数值，完全没有体现出正确的 $-1/R$ 渐进行为。\n\n最后，我们计算带符号误差 $\\Delta E$，并建立虚假低预测的条件。误差是 $GGA$ 值与真实值之差：\n$$ \\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}} = (I_D - A_A - \\Delta_{\\mathrm{xc}}) - \\left(I_D - A_A - \\frac{1}{R}\\right) $$\n$$ \\Delta E = \\frac{1}{R} - \\Delta_{\\mathrm{xc}} $$\n$GGA$ 预测值为虚假低值，当且仅当 $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$，这意味着 $\\Delta E  0$。这给出了条件：\n$$ \\frac{1}{R} - \\Delta_{\\mathrm{xc}}  0 \\implies \\frac{1}{R}  \\Delta_{\\mathrm{xc}} $$\n随着间距 $R$ 的增加，$1/R$ 减小。对于任何具有非零带隙低估误差（$\\Delta_{\\mathrm{xc}} > 0$）的体系，都存在一个间距，超过该间距此不等式便成立，这证明了绝热半局域泛函在描述长程荷移方面的根本性失败。以下程序实现了这些推导出的公式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the true and TD-GGA charge-transfer excitation energies for a\n    series of donor-acceptor pairs to demonstrate the failure of semilocal DFT.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (I_D, A_A, R, delta_xc) in atomic units.\n    test_cases = [\n        # Test 1: General separated pair\n        (0.30, 0.08, 30.0, 0.12),\n        # Test 2: Very large separation\n        (0.30, 0.08, 200.0, 0.12),\n        # Test 3: Small fundamental gap\n        (0.20, 0.08, 25.0, 0.12),\n        # Test 4: Numerical balance point\n        (0.25, 0.05, 25.0/3.0, 0.12),\n    ]\n\n    results = []\n    for case in test_cases:\n        I_D, A_A, R, delta_xc = case\n        \n        # 1. Calculate the physically motivated charge-transfer energy, E_true.\n        # This is derived from E_true = I_D - A_A - 1/R.\n        E_true = I_D - A_A - 1.0/R\n        \n        # 2. Calculate the adiabatic semilocal GGA TD-DFT prediction, E_GGA.\n        # This is derived from E_GGA = I_D - A_A - delta_xc.\n        E_gga = I_D - A_A - delta_xc\n        \n        # 3. Calculate the signed error, delta_E.\n        # This is delta_E = E_GGA - E_true, which simplifies to 1/R - delta_xc.\n        delta_E = 1.0/R - delta_xc\n\n        # 4. Determine if the GGA prediction is spuriously low.\n        # This is true if E_GGA  E_true.\n        is_spurious = E_gga  E_true\n\n        # Append the four required results for this test case.\n        # Energies are rounded to six decimal places.\n        results.append(np.round(E_true, 6))\n        results.append(np.round(E_gga, 6))\n        results.append(np.round(delta_E, 6))\n        results.append(is_spurious)\n        \n    # Final print statement in the exact required format.\n    # The boolean `True`/`False` is converted to string \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "除了电荷转移问题外，标准绝热TDDFT的另一个主要挑战是描述具有显著双激发特征的电子态。这些状态在光化学和光物理中扮演着重要角色，但由于理论的单激发构建基础而常常被忽略 。本练习以丁二烯的 $2^1A_g$ 暗态为经典案例，利用简化的Hückel模型来阐明为何绝热TDDFT无法正确描述这类激发，从而帮助您理解该理论的适用边界。",
            "id": "2466175",
            "problem": "考虑一个线性丁二烯分子，在 Hückel 紧束缚近似下，它被建模为一个由 4 个共轭碳原子 $p_z$ 轨道组成的链。设在位能为零，最近邻耦合沿链交替。具体来说，将链上的位点标记为 1–4，并将 Hückel 哈密顿量 $H \\in \\mathbb{R}^{4 \\times 4}$（单位为电子伏特 eV）定义为\n$$\nH = \\begin{pmatrix}\n0  \\beta_1  0  0 \\\\\n\\beta_1  0  \\beta_2  0 \\\\\n0  \\beta_2  0  \\beta_1 \\\\\n0  0  \\beta_1  0\n\\end{pmatrix},\n$$\n其中 $\\beta_1 = \\beta(1+\\delta)$ 且 $\\beta_2 = \\beta(1-\\delta)$，$\\beta \\lt 0$ 是基本耦合，$\\delta \\in [0,1)$ 是一个键交替参数。假设有 4 个 $\\pi$ 电子，因此在零温下，能量最低的两个分子轨道是双占据的，而能量最高的两个是空的。\n\n在含时密度泛函理论 (TD-DFT) 的绝热 Tamm–Dancoff 近似 (TDA) 中，忽略电子-空穴相互作用核（独立粒子极限），单重态激发能等于所有轨道能量差的集合 $\\{\\varepsilon_a - \\varepsilon_i\\}$，其中 $i$ 遍历 2 个占据轨道，$a$ 遍历 2 个虚拟轨道。我们感兴趣的低能双激发，即丁二烯中的 $2^1A_g$ 态，主要由将两个电子从最高占据分子轨道 (HOMO) 提升到最低未占分子轨道 (LUMO) 贡献。在同样的独立粒子图像中，其能量的粗略估计为 $2(\\varepsilon_{\\mathrm{LUMO}} - \\varepsilon_{\\mathrm{HOMO}})$。\n\n你的任务是编写一个程序，对下面测试套件中给出的每个参数集 $(\\beta,\\delta,\\tau)$，完全在电子伏特 (eV) 单位下执行以下操作：\n\n1. 根据 $\\beta$ 和 $\\delta$ 构建 $H$，并确定所有四个轨道能量 $\\varepsilon_1 \\le \\varepsilon_2 \\le \\varepsilon_3 \\le \\varepsilon_4$。\n2. 将能量最低的两个轨道确定为占据轨道，能量最高的两个轨道确定为虚拟轨道。\n3. 构建所有独立粒子（绝热 TDA）单重态激发能的集合 $\\{\\varepsilon_a - \\varepsilon_i\\}$，其中 $i \\in \\{1,2\\}$ 且 $a \\in \\{3,4\\}$，并确定其中的最低激发能。\n4. 计算双激发的粗略估计值 $E_{\\mathrm{double}} = 2(\\varepsilon_3 - \\varepsilon_2)$。\n5. 判断绝热 TDA 仅单激发谱中是否存在任何激发能，其与 $E_{\\mathrm{double}}$ 的差在容差 $\\tau$ 之内，即判断是否满足 $\\min_{E \\in \\{\\varepsilon_a - \\varepsilon_i\\}} |E - E_{\\mathrm{double}}| \\le \\tau$。\n\n测试套件（每个元组为 $(\\beta,\\delta,\\tau)$，单位为 eV）：\n- 案例 1：$(\\beta,\\delta,\\tau) = (-2.5,\\,0.2,\\,0.05)$。\n- 案例 2：$(\\beta,\\delta,\\tau) = (-2.0,\\,0.0,\\,0.05)$。\n- 案例 3：$(\\beta,\\delta,\\tau) = (-3.0,\\,0.4,\\,0.10)$。\n- 案例 4：$(\\beta,\\delta,\\tau) = (-2.5,\\,0.8,\\,0.10)$。\n\n输出规格：\n- 对于每个案例，生成一个包含三个条目的列表：$[E_{\\min}, E_{\\mathrm{double}}, \\mathrm{found}]$，其中 $E_{\\min}$ 是最低的独立粒子单重态激发能（单位 eV），$E_{\\mathrm{double}}$ 是双激发的粗略估计值（单位 eV），$\\mathrm{found}$ 是一个布尔值，当且仅当存在一个独立粒子单重态激发能与 $E_{\\mathrm{double}}$ 的差在 $\\tau$ 范围内时为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n- 将 $E_{\\min}$ 和 $E_{\\mathrm{double}}$ 以 eV 表示，均四舍五入到三位小数。\n- 你的程序应生成单行输出，其中包含所有四个测试案例的结果，格式为一个用方括号括起来的逗号分隔列表。每个案例的三元组本身也必须用方括号括起来。例如：\"[[x1,y1,True],[x2,y2,False],[x3,y3,False],[x4,y4,True]]\"，其中 $x_k$ 和 $y_k$ 是四舍五入到三位小数的十进制数。\n\n所有能量均以电子伏特 (eV) 作答，并按要求四舍五入到三位小数。不涉及角度。任何地方都不要使用百分比；如果需要，请使用小数。最终输出必须是遵循上述格式的单行文本。",
            "solution": "所提出的问题是计算量子化学领域一个有效且明确定义的问题。它要求在 Hückel 紧束缚框架内，使用含时密度泛函理论 (TD-DFT) 在独立粒子极限下的概念，对线性丁二烯模型的电子激发能进行分析。\n\n其基本的科学任务是通过求解给定体系的不含时薛定谔方程来确定分子轨道能量，该方程在原子轨道基组下呈现为矩阵本征值问题的形式：\n$$ H \\mathbf{c}_k = \\varepsilon_k \\mathbf{c}_k $$\n此处，$H$ 是 Hückel 哈密顿矩阵，$\\varepsilon_k$ 是分子轨道能量，$\\mathbf{c}_k$ 是相应的分子轨道系数。问题给出了一个四位点链的 $4 \\times 4$ 哈密顿矩阵的显式形式，其在位能（对角元素）设为零，最近邻耦合（非对角元素）$\\beta_1$ 和 $\\beta_2$ 交替出现：\n$$ H = \\begin{pmatrix} 0  \\beta_1  0  0 \\\\ \\beta_1  0  \\beta_2  0 \\\\ 0  \\beta_2  0  \\beta_1 \\\\ 0  0  \\beta_1  0 \\end{pmatrix} $$\n耦合由一个基本耦合 $\\beta  0$ 和一个键交替参数 $\\delta \\in [0,1)$ 定义：\n$$ \\beta_1 = \\beta(1+\\delta) $$\n$$ \\beta_2 = \\beta(1-\\delta) $$\n由于 $H$ 是一个实对称矩阵，其四个本征值 $\\varepsilon_1 \\le \\varepsilon_2 \\le \\varepsilon_3 \\le \\varepsilon_4$ 均为实数。这些本征值代表了四个 $\\pi$ 分子轨道的能量。\n\n该体系包含 4 个 $\\pi$ 电子。根据构造原理，在零温下，这些电子占据可用的最低能量轨道。每个轨道可以容纳两个自旋相反的电子。因此，能量最低的两个分子轨道（能量为 $\\varepsilon_1$ 和 $\\varepsilon_2$）是双占据的。它们构成了占据轨道集。能量较高的两个轨道（能量为 $\\varepsilon_3$ 和 $\\varepsilon_4$）是未占据的，被称为虚拟轨道。最高占据分子轨道 (HOMO) 的能量为 $\\varepsilon_{\\mathrm{HOMO}} = \\varepsilon_2$，最低未占分子轨道 (LUMO) 的能量为 $\\varepsilon_{\\mathrm{LUMO}} = \\varepsilon_3$。\n\n问题接着要求在 TD-DFT 的绝热 Tamm-Dancoff 近似 (TDA) 内考虑电子激发，并忽略相互作用核。在这种独立粒子图像中，单重态激发能就是虚拟轨道和占据轨道之间的能量差。所有此类单粒子激发能的集合 $E_{\\text{single}}$ 由下式给出：\n$$ \\{ \\varepsilon_a - \\varepsilon_i \\mid i \\in \\{1, 2\\}, a \\in \\{3, 4\\} \\} $$\n这给出了四种可能的激发能：$\\varepsilon_3 - \\varepsilon_1$、$\\varepsilon_3 - \\varepsilon_2$、$\\varepsilon_4 - \\varepsilon_1$ 和 $\\varepsilon_4 - \\varepsilon_2$。其中最低的是 HOMO-LUMO 能隙，$E_{\\min} = \\varepsilon_3 - \\varepsilon_2$。\n\n将两个电子从 HOMO 提升到 LUMO 的双激发能量的粗略估计值由下式给出：\n$$ E_{\\mathrm{double}} = 2(\\varepsilon_{\\mathrm{LUMO}} - \\varepsilon_{\\mathrm{HOMO}}) = 2(\\varepsilon_3 - \\varepsilon_2) $$\n核心任务是确定这个双激发能是否与任何一个单激发能“偶然”简并。这可以通过检查 $E_{\\mathrm{double}}$ 与四个单激发能中任意一个的绝对差是否小于或等于给定的容差 $\\tau$ 来检验。也就是说，我们必须检查以下条件是否成立：\n$$ \\min_{E \\in \\{\\varepsilon_a - \\varepsilon_i\\}} |E - E_{\\mathrm{double}}| \\le \\tau $$\n\n对于每个测试案例 $(\\beta, \\delta, \\tau)$ 的算法流程如下：\n1.  使用给定的 $\\beta$ 和 $\\delta$ 构建矩阵 $H$。\n2.  数值计算 $H$ 的四个本征值。我们按非递减顺序将它们标记为：$\\varepsilon_1, \\varepsilon_2, \\varepsilon_3, \\varepsilon_4$。\n3.  计算四个单激发能：$E_{1 \\to 3} = \\varepsilon_3 - \\varepsilon_1$、$E_{2 \\to 3} = \\varepsilon_3 - \\varepsilon_2$、$E_{1 \\to 4} = \\varepsilon_4 - \\varepsilon_1$ 和 $E_{2 \\to 4} = \\varepsilon_4 - \\varepsilon_2$。\n4.  确定最低单激发能，$E_{\\min} = E_{2 \\to 3} = \\varepsilon_3 - \\varepsilon_2$。\n5.  计算双激发能的粗略估计值，$E_{\\mathrm{double}} = 2 \\cdot E_{\\min}$。\n6.  计算 $E_{\\mathrm{double}}$ 与四个单激发能中每一个的绝对差的最小值。\n7.  将此最小差值与容差 $\\tau$ 进行比较，以确定布尔值 `found`。\n8.  将所需的输出值 $E_{\\min}$ 和 $E_{\\mathrm{double}}$ 格式化，四舍五入到三位小数。\n这个流程在提供的 Python 代码中实现，利用 `numpy` 库进行高效和精确的矩阵对角化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the butadiene excitation energy problem for a given test suite.\n\n    The function iterates through a set of parameters (beta, delta, tau),\n    constructs the Hückel Hamiltonian for a 4-site linear polyene with\n    alternating bond couplings, and calculates its eigenvalues (orbital energies).\n    It then determines single and double excitation energies as defined in the\n    problem statement and checks for their near-degeneracy within a given\n    tolerance.\n    \"\"\"\n    # Test suite: tuples of (beta, delta, tau) in eV\n    test_cases = [\n        (-2.5, 0.2, 0.05),\n        (-2.0, 0.0, 0.05),\n        (-3.0, 0.4, 0.10),\n        (-2.5, 0.8, 0.10),\n    ]\n\n    # This list will hold the string representation of each case's result list\n    all_results_str = []\n\n    for beta, delta, tau in test_cases:\n        # Step 1: Construct the Hückel Hamiltonian matrix H\n        beta1 = beta * (1 + delta)\n        beta2 = beta * (1 - delta)\n        \n        H = np.array([\n            [0.0,   beta1, 0.0,   0.0  ],\n            [beta1, 0.0,   beta2, 0.0  ],\n            [0.0,   beta2, 0.0,   beta1],\n            [0.0,   0.0,   beta1, 0.0  ]\n        ], dtype=float)\n\n        # Step 1 (cont.): Determine all four orbital energies (eigenvalues of H)\n        # np.linalg.eigh returns sorted eigenvalues for a symmetric matrix, which is appropriate here.\n        orbital_energies = np.linalg.eigh(H)[0]\n        \n        eps1, eps2, eps3, eps4 = orbital_energies\n        \n        # Step 2: Identify occupied and virtual orbitals based on energy ordering.\n        # Occupied orbitals correspond to the two lowest energies: eps1, eps2.\n        # Virtual orbitals correspond to the two highest energies: eps3, eps4.\n        # HOMO energy is eps2, LUMO energy is eps3.\n        eps_homo = eps2\n        eps_lumo = eps3\n\n        # Step 3: Form the set of independent-particle singlet excitation energies.\n        # These are {eps_a - eps_i} for i in {1,2} and a in {3,4}.\n        single_excitations = [\n            eps3 - eps1,\n            eps3 - eps2,  # This is the HOMO-LUMO gap\n            eps4 - eps1,\n            eps4 - eps2\n        ]\n        \n        # The lowest singlet excitation energy is the HOMO-LUMO gap.\n        E_min = eps_lumo - eps_homo\n\n        # Step 4: Compute the naive double-excitation estimate.\n        E_double = 2 * (eps_lumo - eps_homo)\n\n        # Step 5: Decide whether any single excitation energy is within tau of E_double.\n        min_abs_diff = min([abs(E - E_double) for E in single_excitations])\n        found = min_abs_diff = tau\n\n        # Store the formatted result string for the current case.\n        # The f-string formatting `{value:.3f}` ensures rounding to three decimal places.\n        case_result_str = f\"[{E_min:.3f},{E_double:.3f},{found}]\"\n        all_results_str.append(case_result_str)\n\n    # Print the final output as a single line, following the specified format.\n    # The format is a list of lists, represented as a string.\n    print(f\"[{','.join(all_results_str)}]\")\n\n# Execute the solver function.\nsolve()\n\n```"
        }
    ]
}