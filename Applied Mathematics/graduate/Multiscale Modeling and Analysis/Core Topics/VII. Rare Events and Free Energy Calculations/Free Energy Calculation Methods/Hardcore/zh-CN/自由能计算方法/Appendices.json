{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基本的“纸笔”练习开始。通过将自由能微扰 (Free Energy Perturbation, FEP) 公式应用于一个简谐振子——一个其自由能可以被精确计算的系统——我们可以验证该方法的正确性，并直观地理解它如何将统计系综的平均与热力学变化联系起来。在处理更复杂的场景之前，这个练习  将巩固我们对核心理论的理解。",
            "id": "3762113",
            "problem": "考虑一个经典的一维（$1$D）粗粒化自由度 $x$，其在介观尺度上通过谐波势 $U(x;K) = \\frac{1}{2} K x^{2}$ 进行建模。在多尺度建模中，当一个细粒度子系统被一个其刚度取决于参数化的有效谐波模式所代表时，就会出现这种情况，从而产生弹簧常数为 $K_{\\mathrm{A}}$ 的状态 $\\mathrm{A}$ 和弹簧常数为 $K_{\\mathrm{B}}$ 的状态 $\\mathrm{B}$。假设在温度 $T$ 下存在一个正则系综，并令 $k_{\\mathrm{B}}$ 表示玻尔兹曼常数。亥姆霍兹自由能定义为 $F = - k_{\\mathrm{B}} T \\ln Z$，其中 $Z$ 是正则配分函数。由于在状态 $\\mathrm{A}$ 和 $\\mathrm{B}$ 之间仅有势能的刚度发生变化，而动能的贡献在两个状态中是相同的，因此我们关注构型配分函数。\n\n从正则系综和上述定义出发：\n- 推导势能 $U(x;K) = \\frac{1}{2} K x^{2}$ 的构型配分函数 $Z_{\\text{conf}}(K)$。\n- 利用此结果推导亥姆霍兹自由能差 $\\Delta F = F_{\\mathrm{B}} - F_{\\mathrm{A}}$，以 $K_{\\mathrm{A}}$、$K_{\\mathrm{B}}$、$k_{\\mathrm{B}}$ 和 $T$ 表示的解析表达式。\n- 接下来，从正则系综平均的定义出发，推导 $\\Delta F$ 的自由能微扰（FEP）估计量，该估计量通过对状态 $\\mathrm{A}$ 的系综平均来表示 $\\Delta F$，并针对从 $K_{\\mathrm{A}}$ 到 $K_{\\mathrm{B}}$ 的谐波势变化，解析地评估此估计量。\n- 给出 $\\Delta F$ 的最终闭式表达式。\n\n你的最终答案必须是单一的闭式解析表达式。不要提供数值近似。如果引入逆热能，请将其定义为 $\\beta = 1/(k_{\\mathrm{B}} T)$，并确保每个数学符号都用 LaTeX 书写。",
            "solution": "问题陈述经验证，具有科学依据、问题明确且客观。它提出了一个统计力学中的标准问题，没有任何事实错误、歧义或信息缺失。其前提和定义与经典统计力学和多尺度建模的基本原理一致。因此，我们可以进行求解。\n\n令逆热能定义为 $\\beta = \\frac{1}{k_{\\mathrm{B}} T}$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度。该问题考虑一个具有谐波势能函数 $U(x;K) = \\frac{1}{2} K x^{2}$ 的一维自由度 $x$，其中 $K$ 是弹簧常数。我们被要求执行三个任务，以得到由弹簧常数 $K_\\mathrm{A}$ 和 $K_\\mathrm{B}$ 表征的两个状态 $\\mathrm{A}$ 和 $\\mathrm{B}$ 之间的亥姆霍兹自由能差 $\\Delta F$ 的最终表达式。\n\n首先，我们推导对于一个通用弹簧常数 $K$ 的构型配分函数 $Z_{\\text{conf}}(K)$。一维系统的构型配分函数由玻尔兹曼因子对坐标 $x$ 的所有可能构型积分得到：\n$$\nZ_{\\text{conf}}(K) = \\int_{-\\infty}^{+\\infty} \\exp(-\\beta U(x;K)) dx\n$$\n代入给定的势能表达式，我们得到：\n$$\nZ_{\\text{conf}}(K) = \\int_{-\\infty}^{+\\infty} \\exp\\left(-\\beta \\frac{1}{2} K x^{2}\\right) dx\n$$\n这是一个形式为 $\\int_{-\\infty}^{+\\infty} \\exp(-ax^{2}) dx = \\sqrt{\\frac{\\pi}{a}}$ 的标准高斯积分。在我们的例子中，常数 $a$ 是 $\\frac{\\beta K}{2}$。因此，该积分的计算结果为：\n$$\nZ_{\\text{conf}}(K) = \\sqrt{\\frac{\\pi}{\\frac{\\beta K}{2}}} = \\sqrt{\\frac{2\\pi}{\\beta K}}\n$$\n这就是弹簧常数为 $K$ 的谐振子的构型配分函数的表达式。\n\n其次，我们利用此结果来推导亥姆霍兹自由能差 $\\Delta F = F_\\mathrm{B} - F_\\mathrm{A}$。亥姆霍兹自由能 $F$ 与配分函数 $Z$ 的关系为 $F = -k_{\\mathrmB}}T \\ln Z = -\\frac{1}{\\beta} \\ln Z$。关注构型贡献，对于一个弹簧常数为 $K$ 的状态，其自由能为：\n$$\nF(K) = -\\frac{1}{\\beta} \\ln(Z_{\\text{conf}}(K))\n$$\n代入我们得到的 $Z_{\\text{conf}}(K)$ 表达式：\n$$\nF(K) = -\\frac{1}{\\beta} \\ln\\left(\\sqrt{\\frac{2\\pi}{\\beta K}}\\right) = -\\frac{1}{2\\beta} \\ln\\left(\\frac{2\\pi}{\\beta K}\\right) = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta K}{2\\pi}\\right)\n$$\n现在，我们可以写出状态 $\\mathrm{A}$ ($K=K_\\mathrm{A}$) 和状态 $\\mathrm{B}$ ($K=K_\\mathrm{B}$) 的自由能：\n$$\nF_\\mathrm{A} = F(K_\\mathrm{A}) = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta K_\\mathrm{A}}{2\\pi}\\right)\n$$\n$$\nF_\\mathrm{B} = F(K_\\mathrm{B}) = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta K_\\mathrm{B}}{2\\pi}\\right)\n$$\n那么，自由能差 $\\Delta F$ 为：\n$$\n\\Delta F = F_\\mathrm{B} - F_\\mathrm{A} = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta K_\\mathrm{B}}{2\\pi}\\right) - \\frac{1}{2\\beta} \\ln\\left(\\frac{\\beta K_\\mathrm{A}}{2\\pi}\\right)\n$$\n使用对数性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$：\n$$\n\\Delta F = \\frac{1}{2\\beta} \\left[ \\ln\\left(\\frac{\\beta K_\\mathrm{B}}{2\\pi}\\right) - \\ln\\left(\\frac{\\beta K_\\mathrm{A}}{2\\pi}\\right) \\right] = \\frac{1}{2\\beta} \\ln\\left(\\frac{\\frac{\\beta K_\\mathrm{B}}{2\\pi}}{\\frac{\\beta K_\\mathrm{A}}{2\\pi}}\\right) = \\frac{1}{2\\beta} \\ln\\left(\\frac{K_\\mathrm{B}}{K_\\mathrm{A}}\\right)\n$$\n代入 $\\beta = 1/(k_{\\mathrm{B}} T)$，我们得到自由能差的精确解析表达式：\n$$\n\\Delta F = \\frac{1}{2} k_{\\mathrm{B}} T \\ln\\left(\\frac{K_\\mathrm{B}}{K_\\mathrm{A}}\\right)\n$$\n\n第三，我们使用自由能微扰（FEP）形式体系推导相同的结果。FEP 公式将自由能差表示为对其中一个状态（此处为状态 $\\mathrm{A}$）的系综平均：\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln \\langle \\exp(-\\beta \\Delta U) \\rangle_\\mathrm{A}\n$$\n其中 $\\Delta U = U_\\mathrm{B}(x) - U_\\mathrm{A}(x)$ 是两个状态之间的势能差，$\\langle \\dots \\rangle_\\mathrm{A}$ 表示对状态 $\\mathrm{A}$ 的构型进行的正则系综平均。势能分别为 $U_\\mathrm{A}(x) = \\frac{1}{2} K_\\mathrm{A} x^2$ 和 $U_\\mathrm{B}(x) = \\frac{1}{2} K_\\mathrm{B} x^2$，所以其差值为：\n$$\n\\Delta U(x) = \\frac{1}{2} K_\\mathrm{B} x^2 - \\frac{1}{2} K_\\mathrm{A} x^2 = \\frac{1}{2}(K_\\mathrm{B} - K_\\mathrm{A})x^2\n$$\n系综平均定义为：\n$$\n\\langle \\exp(-\\beta \\Delta U) \\rangle_\\mathrm{A} = \\frac{\\int_{-\\infty}^{+\\infty} \\exp(-\\beta \\Delta U(x)) \\exp(-\\beta U_\\mathrm{A}(x)) dx}{\\int_{-\\infty}^{+\\infty} \\exp(-\\beta U_\\mathrm{A}(x)) dx}\n$$\n分母就是状态 $\\mathrm{A}$ 的配分函数 $Z_{\\text{conf}}(K_\\mathrm{A})$。分子是：\n$$\n\\int_{-\\infty}^{+\\infty} \\exp\\left(-\\beta \\frac{1}{2}(K_\\mathrm{B} - K_\\mathrm{A})x^2\\right) \\exp\\left(-\\beta \\frac{1}{2}K_\\mathrm{A}x^2\\right) dx = \\int_{-\\infty}^{+\\infty} \\exp\\left(-\\beta \\frac{1}{2}[(K_\\mathrm{B} - K_\\mathrm{A}) + K_\\mathrm{A}] x^2\\right) dx\n$$\n这可以简化为：\n$$\n\\int_{-\\infty}^{+\\infty} \\exp\\left(-\\beta \\frac{1}{2} K_\\mathrm{B} x^2\\right) dx = Z_{\\text{conf}}(K_\\mathrm{B})\n$$\n因此，系综平均是两个配分函数的比值：\n$$\n\\langle \\exp(-\\beta \\Delta U) \\rangle_\\mathrm{A} = \\frac{Z_{\\text{conf}}(K_\\mathrm{B})}{Z_{\\text{conf}}(K_\\mathrm{A})}\n$$\n使用我们先前推导的 $Z_{\\text{conf}}(K)$ 表达式：\n$$\n\\langle \\exp(-\\beta \\Delta U) \\rangle_\\mathrm{A} = \\frac{\\sqrt{\\frac{2\\pi}{\\beta K_\\mathrm{B}}}}{\\sqrt{\\frac{2\\pi}{\\beta K_\\mathrm{A}}}} = \\sqrt{\\frac{K_\\mathrm{A}}{K_\\mathrm{B}}} = \\left(\\frac{K_\\mathrm{A}}{K_\\mathrm{B}}\\right)^{1/2}\n$$\n最后，我们将此结果代回 $\\Delta F$ 的 FEP 公式中：\n$$\n\\Delta F = -\\frac{1}{\\beta} \\ln\\left[ \\left(\\frac{K_\\mathrm{A}}{K_\\mathrm{B}}\\right)^{1/2} \\right] = -\\frac{1}{2\\beta} \\ln\\left(\\frac{K_\\mathrm{A}}{K_\\mathrm{B}}\\right) = \\frac{1}{2\\beta} \\ln\\left(\\left(\\frac{K_\\mathrm{A}}{K_\\mathrm{B}}\\right)^{-1}\\right) = \\frac{1}{2\\beta} \\ln\\left(\\frac{K_\\mathrm{B}}{K_\\mathrm{A}}\\right)\n$$\n再次代入 $\\beta = 1/(k_{\\mathrm{B}} T)$ 可得：\n$$\n\\Delta F = \\frac{1}{2} k_{\\mathrm{B}} T \\ln\\left(\\frac{K_\\mathrm{B}}{K_\\mathrm{A}}\\right)\n$$\n两种方法都得出了相同的解析结果，证实了统计力学框架的一致性。这就是所要求的最终闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{1}{2} k_{\\mathrm{B}} T \\ln\\left(\\frac{K_{\\mathrm{B}}}{K_{\\mathrm{A}}}\\right)}\n$$"
        },
        {
            "introduction": "从精确的理论转向数值实践，我们将面对模拟中一个常见的挑战：不完全收敛。这个编程练习  模拟了热力学积分 (Thermodynamic Integration, TI) 的过程，并要求您量化正向和反向炼金路径之间的“滞后”效应。这种滞后是衡量模拟收敛性的一个重要指标，也是诊断采样不足的关键工具。",
            "id": "5252756",
            "problem": "你需要实现一个数值演示，展示在一个简单的溶质去耦合模型中，热力学积分（TI）的路径依赖滞后现象。在 TI 中，沿着耦合参数 $\\lambda \\in [0,1]$ 的亥姆霍兹自由能差，是通过对势能相对于 $\\lambda$ 的导数的系综平均进行积分得到的。在实践中，由于不完全平衡，正向采样（增加 $\\lambda$）和反向采样（减小 $\\lambda$）可能会产生不同的被积函数，从而导致滞后现象。你将通过计算由正向和反向被积函数得到的累积自由能曲线之间的面积来量化这种滞后现象。\n\n从正则系综中自由能的基本定义出发，亥姆霍兹自由能 $F(\\lambda)$ 为 $F(\\lambda) = -k_{\\mathrm{B}} T \\ln Z(\\lambda)$，其中构型配分函数为 $Z(\\lambda) = \\int \\exp\\left(-\\beta U(x;\\lambda)\\right) \\,\\mathrm{d}x$，$U(x;\\lambda)$ 是势能，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，且 $\\beta = 1/(k_{\\mathrm{B}} T)$。一个经过充分检验的关系将自由能的导数与势能导数的系综平均联系起来：$\\frac{\\mathrm{d}F}{\\mathrm{d}\\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$。对于一个简单的溶质去耦合路径，通过一个平滑的基线函数 $f(\\lambda)$ 来模拟系综平均 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$，该基线函数由路径特定的偏置项修改，以模拟不完全平衡。\n\n你的程序必须：\n- 对于每个测试用例，在指定的 $\\lambda$ 网格上构建正向和反向被积函数数组，使用复合梯形法则计算正向累积自由能曲线 $G_{\\mathrm{f}}(\\lambda)$ 和反向累积自由能曲线 $G_{\\mathrm{b}}(\\lambda)$，然后使用相同的复合梯形法则在所提供的网格上计算滞后环面积 $\\mathcal{A}$，其定义为 $\\mathcal{A} = \\int_{0}^{1} \\left| G_{\\mathrm{f}}(\\lambda) - G_{\\mathrm{b}}(\\lambda) \\right| \\,\\mathrm{d}\\lambda$。\n- 将 $\\mathcal{A}$ 以千焦/摩尔 ($\\mathrm{kJ/mol}$) 为单位表示，并四舍五入到 $6$ 位小数。\n- 生成单行输出，其中包含所有测试用例的结果，形式为用方括号括起来的逗号分隔列表（例如 $\\left[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3\\right]$）。\n\n定义和约束：\n- 热力学积分 (TI) 由关系式 $\\Delta G = \\int_{0}^{1} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,\\mathrm{d}\\lambda$ 定义。\n- 滞后环面积 $\\mathcal{A}$ 必须在累积自由能曲线 $G_{\\mathrm{f}}(\\lambda) = \\int_{0}^{\\lambda} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda'}^{\\mathrm{forward}} \\,\\mathrm{d}\\lambda'$ 和 $G_{\\mathrm{b}}(\\lambda) = \\int_{0}^{\\lambda} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda'}^{\\mathrm{backward}} \\,\\mathrm{d}\\lambda'$ 之间计算，为了可比性，两者都在相同的 $\\lambda$ 网格上从 $\\lambda = 0$ 积分到 $\\lambda$。\n\n数值方法：\n- 对所有积分使用复合梯形法则。对于一个非均匀网格 $\\{\\lambda_i\\}_{i=0}^{N}$，其中 $\\lambda_0 = 0$ 且 $\\lambda_N = 1$，以及函数样本 $\\{y_i\\}_{i=0}^{N}$，在网格索引 $j$ 处的累积积分为 $I_j = \\sum_{i=0}^{j-1} \\frac{1}{2} (\\lambda_{i+1}-\\lambda_i) (y_{i+1}+y_i)$，在 $\\left[0,1\\right]$ 上的积分为 $I = \\sum_{i=0}^{N-1} \\frac{1}{2} (\\lambda_{i+1}-\\lambda_i) (y_{i+1}+y_i)$。\n\n测试套件：\n实现以下 $4$ 个测试用例。对于每个用例，正向和反向被积函数由一个共享的基线 $f(\\lambda)$ 加上路径特定的偏置构成，单位为 $\\mathrm{kJ/mol}$。\n\n- 测试用例 $1$（均匀网格，对称偏置；理想情况）：\n  - 网格：$\\lambda_i = i/20$，对于 $i \\in \\{0,1,\\ldots,20\\}$（即从 $0$ 到 $1$ 的 $21$ 个点）。\n  - 基线：$f(\\lambda) = 20 (1-\\lambda)^2$。\n  - 正向偏置：$b_{\\mathrm{f}}(\\lambda) = 0.5 \\lambda$。\n  - 反向偏置：$b_{\\mathrm{b}}(\\lambda) = -0.5 \\lambda$。\n  - 正向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}} = f(\\lambda) + b_{\\mathrm{f}}(\\lambda)$。\n  - 反向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}} = f(\\lambda) + b_{\\mathrm{b}}(\\lambda)$。\n\n- 测试用例 $2$（非均匀网格，非对称偏置；强调非均匀间距）：\n  - 网格：$\\lambda \\in \\{0, 0.01, 0.05, 0.1, 0.2, 0.35, 0.5, 0.7, 0.85, 0.95, 1.0\\}$。\n  - 基线：$f(\\lambda) = \\frac{15}{1 + 5 \\lambda}$。\n  - 正向偏置：$b_{\\mathrm{f}}(\\lambda) = 0.8 \\lambda (1-\\lambda)$。\n  - 反向偏置：$b_{\\mathrm{b}}(\\lambda) = -0.8 \\lambda (1-\\lambda) + 0.3 \\lambda$。\n  - 正向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}} = f(\\lambda) + b_{\\mathrm{f}}(\\lambda)$。\n  - 反向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}} = f(\\lambda) + b_{\\mathrm{b}}(\\lambda)$。\n\n- 测试用例 $3$（均匀网格，无偏置；完全可逆性的边界条件）：\n  - 网格：$\\lambda_i = i/50$，对于 $i \\in \\{0,1,\\ldots,50\\}$（即从 $0$ 到 $1$ 的 $51$ 个点）。\n  - 基线：$f(\\lambda) = 10 e^{-\\lambda}$。\n  - 正向偏置：$b_{\\mathrm{f}}(\\lambda) = 0$。\n  - 反向偏置：$b_{\\mathrm{b}}(\\lambda) = 0$。\n  - 正向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}} = f(\\lambda)$。\n  - 反向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}} = f(\\lambda)$。\n\n- 测试用例 $4$（非线性基线，近端点奇点正则化；边缘情况）：\n  - 网格：$\\lambda_i = i/40$，对于 $i \\in \\{0,1,\\ldots,40\\}$（即从 $0$ 到 $1$ 的 $41$ 个点）。\n  - 基线：$f(\\lambda) = \\frac{5}{\\sqrt{\\lambda + 10^{-6}}}$。\n  - 正向偏置：$b_{\\mathrm{f}}(\\lambda) = \\frac{0.2}{1 + 10 \\lambda}$。\n  - 反向偏置：$b_{\\mathrm{b}}(\\lambda) = -\\frac{0.2}{1 + 10 \\lambda} + 0.1 \\lambda$。\n  - 正向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}} = f(\\lambda) + b_{\\mathrm{f}}(\\lambda)$。\n  - 反向被积函数：$\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}} = f(\\lambda) + b_{\\mathrm{b}}(\\lambda)$。\n\n最终输出要求：\n- 使用上述定义为每个测试用例计算 $\\mathcal{A}$。\n- 返回 $4$ 个滞后环面积的列表，单位为 $\\mathrm{kJ/mol}$，四舍五入到 $6$ 位小数。\n- 你的程序应生成单行输出，其中包含结果，形式为用方括号括起来的逗号分隔列表，例如 $\\left[\\mathrm{a}_1,\\mathrm{a}_2,\\mathrm{a}_3,\\mathrm{a}_4\\right]$。",
            "solution": "问题陈述已经过验证，被认为是合理的。它基于统计力学和热力学积分（TI）的原理，这是计算化学中的一种标准技术。该问题是良构的，提供了所有必需的数学函数、参数，以及明确定义的数值方法和目标。使用简化的解析函数来模拟势能导数的系综平均 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$，并引入路径依赖的偏置，是演示实际自由能计算中由于非遍历性或不完全平衡而引起的滞后概念的一种有效且富有启发性的方法。该问题是客观、自洽且计算上可行的。\n\n核心任务是量化正向和反向自由能计算之间的滞后现象。由耦合参数 $\\lambda$ 表征的两个状态（此处为 $\\lambda=0$ 和 $\\lambda=1$）之间的自由能差 $\\Delta F$ 由 TI 公式给出：\n$$ \\Delta F = \\int_{0}^{1} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\mathrm{d}\\lambda $$\n其中 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$ 是势能 $U$ 对 $\\lambda$ 的导数在特定 $\\lambda$ 值下评估的系综平均。在理想的可逆过程中，被积函数 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$ 是唯一的。然而，在有限时间的模拟中，采样可能不完全，导致计算出的平均值依赖于模拟的历史。这导致当 $\\lambda$ 从 $0$ 增加到 $1$（正向路径）与当它从 $1$ 减小到 $0$（反向路径）时，会得到不同的被积函数曲线。\n\n问题为这些路径依赖的被积函数定义了模型，表示为 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}}$ 和 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}}$。为了量化这种差异，我们首先计算两条路径上作为 $\\lambda$ 函数的累积自由能变化。对于正向路径，其为：\n$$ G_{\\mathrm{f}}(\\lambda) = \\int_{0}^{\\lambda} \\left\\langle \\frac{\\partial U}{\\partial \\lambda'} \\right\\rangle_{\\lambda'}^{\\mathrm{forward}} \\mathrm{d}\\lambda' $$\n而对于反向路径，为了一致性比较，相应的量被定义为从 $\\lambda=0$ 开始对反向被积函数进行积分：\n$$ G_{\\mathrm{b}}(\\lambda) = \\int_{0}^{\\lambda} \\left\\langle \\frac{\\partial U}{\\partial \\lambda'} \\right\\rangle_{\\lambda'}^{\\mathrm{backward}} \\mathrm{d}\\lambda' $$\n总滞后 $\\mathcal{A}$ 则被定义为这两条累积曲线在区间 $\\lambda \\in [0, 1]$ 上所包围的面积：\n$$ \\mathcal{A} = \\int_{0}^{1} \\left| G_{\\mathrm{f}}(\\lambda) - G_{\\mathrm{b}}(\\lambda) \\right| \\,\\mathrm{d}\\lambda $$\n所有计算都将使用复合梯形法则在 $\\lambda$ 值的离散网格上进行数值计算。\n\n算法如下：\n1.  对于每个测试用例，定义 $\\lambda$ 网格 $\\{\\lambda_i\\}_{i=0}^{N}$，其中 $\\lambda_0=0$ 且 $\\lambda_N=1$。\n2.  在每个网格点 $\\lambda_i$ 处，评估正向被积函数 $y_i^{\\mathrm{f}} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{forward}}_{\\lambda=\\lambda_i}$ 和反向被积函数 $y_i^{\\mathrm{b}} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle^{\\mathrm{backward}}_{\\lambda=\\lambda_i}$。\n3.  在每个网格点 $\\lambda_j$ 计算累积自由能曲线 $G_{\\mathrm{f}}$ 和 $G_{\\mathrm{b}}$。这是通过累积应用复合梯形法则来完成的。对于一个通用被积函数 $y$，其累积积分 $I(\\lambda_j)$ 为：\n    $$ I(\\lambda_j) = \\sum_{i=0}^{j-1} \\frac{1}{2} (\\lambda_{i+1} - \\lambda_i) (y_{i+1} + y_i) \\quad \\text{for } j > 0, \\text{ and } I(\\lambda_0) = 0 $$\n    这将产生两个值数组，$\\{G_{\\mathrm{f}}(\\lambda_i)\\}_{i=0}^{N}$ 和 $\\{G_{\\mathrm{b}}(\\lambda_i)\\}_{i=0}^{N}$。\n4.  计算累积曲线之间的逐点绝对差：$\\Delta G_i = |G_{\\mathrm{f}}(\\lambda_i) - G_{\\mathrm{b}}(\\lambda_i)|$。\n5.  使用复合梯形法则，通过对 $\\lambda$ 网格上的绝对差数组 $\\{\\Delta G_i\\}_{i=0}^{N}$ 进行积分，来计算最终的滞后面积 $\\mathcal{A}$：\n    $$ \\mathcal{A} = \\sum_{i=0}^{N-1} \\frac{1}{2} (\\lambda_{i+1} - \\lambda_i) (\\Delta G_{i+1} + \\Delta G_i) $$\n6.  每个测试用例的最终结果四舍五入到 $6$ 位小数，并以 $\\mathrm{kJ/mol}$ 为单位报告。\n\n此过程将系统地应用于所提供的四个测试用例。对于测试用例 3，其中正向和反向偏置均为零，被积函数是相同的。因此，对于所有 $\\lambda$，$G_{\\mathrm{f}}(\\lambda) = G_{\\mathrm{b}}(\\lambda)$，从而预期的滞后面积 $\\mathcal{A}$ 恰好为 $0.0$。这可作为对实现方案的对照测试。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Solves the thermodynamic integration hysteresis problem for all test cases.\n    \"\"\"\n\n    def calculate_hysteresis_area(grid, baseline_func, fwd_bias_func, bwd_bias_func):\n        \"\"\"\n        Calculates the hysteresis loop area for a given set of functions and grid.\n\n        Args:\n            grid (np.ndarray): The array of lambda values.\n            baseline_func (callable): The baseline integrand function f(lambda).\n            fwd_bias_func (callable): The forward bias function b_f(lambda).\n            bwd_bias_func (callable): The backward bias function b_b(lambda).\n\n        Returns:\n            float: The calculated hysteresis loop area, A.\n        \"\"\"\n        # Step 1: Evaluate integrands on the grid\n        # Forward integrand\n        integrand_fwd = baseline_func(grid) + fwd_bias_func(grid)\n        # Backward integrand\n        integrand_bwd = baseline_func(grid) + bwd_bias_func(grid)\n\n        # Step 2: Compute cumulative free energy curves using composite trapezoidal rule\n        # The 'initial=0' argument ensures the output array has the same length\n        # as the input grid, with the integral at the first point being 0.\n        G_f = cumulative_trapezoid(integrand_fwd, grid, initial=0)\n        G_b = cumulative_trapezoid(integrand_bwd, grid, initial=0)\n\n        # Step 3: Calculate the absolute difference of the cumulative curves\n        abs_diff_G = np.abs(G_f - G_b)\n\n        # Step 4: Compute the hysteresis area by integrating the absolute difference\n        # using the composite trapezoidal rule (np.trapz).\n        hysteresis_area = np.trapz(abs_diff_G, grid)\n\n        return hysteresis_area\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        {\n            \"name\": \"Test case 1\",\n            \"grid\": np.linspace(0, 1, 21),\n            \"baseline\": lambda l: 20 * (1 - l)**2,\n            \"fwd_bias\": lambda l: 0.5 * l,\n            \"bwd_bias\": lambda l: -0.5 * l,\n        },\n        {\n            \"name\": \"Test case 2\",\n            \"grid\": np.array([0, 0.01, 0.05, 0.1, 0.2, 0.35, 0.5, 0.7, 0.85, 0.95, 1.0]),\n            \"baseline\": lambda l: 15 / (1 + 5 * l),\n            \"fwd_bias\": lambda l: 0.8 * l * (1 - l),\n            \"bwd_bias\": lambda l: -0.8 * l * (1 - l) + 0.3 * l,\n        },\n        {\n            \"name\": \"Test case 3\",\n            \"grid\": np.linspace(0, 1, 51),\n            \"baseline\": lambda l: 10 * np.exp(-l),\n            \"fwd_bias\": lambda l: 0.0,\n            \"bwd_bias\": lambda l: 0.0,\n        },\n        {\n            \"name\": \"Test case 4\",\n            \"grid\": np.linspace(0, 1, 41),\n            \"baseline\": lambda l: 5 / np.sqrt(l + 1e-6),\n            \"fwd_bias\": lambda l: 0.2 / (1 + 10 * l),\n            \"bwd_bias\": lambda l: -0.2 / (1 + 10 * l) + 0.1 * l,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        area = calculate_hysteresis_area(\n            case[\"grid\"],\n            case[\"baseline\"],\n            case[\"fwd_bias\"],\n            case[\"bwd_bias\"]\n        )\n        # Round the result to 6 decimal places as required\n        results.append(round(area, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何自由能计算，若无严谨的误差分析，都非完备。模拟数据点在时间上并非独立，而是存在关联。本练习  将引导您推导“统计无效性”($g$)，以确定真实的有效样本数量。这是为自由能估算获得可靠不确定性的关键步骤。",
            "id": "3762077",
            "problem": "考虑分子模拟中的一个单一热力学态，其时间序列可观测量 $x_{i}$（例如，对像多态贝内特接受比（MBAR）这样的自由能估计量有贡献的约化功或能量）在离散时间 $t_{i} = i \\Delta t$（$i = 1, 2, \\dots, N$）进行采样。假设 $x_{i}$ 是一个弱平稳随机过程，其均值为 $\\mu = \\langle x_{i} \\rangle$，方差为 $\\sigma^{2} = \\langle (x_{i} - \\mu)^{2} \\rangle$，以及归一化自相关函数 $\\rho(t)$，其定义为 $\\rho(t) = \\langle (x_{i} - \\mu)(x_{i+t} - \\mu) \\rangle / \\sigma^{2}$，对于整数延迟 $t \\geq 0$。从协方差的定义和样本均值的方差 $\\operatorname{Var}(\\bar{x}) = \\operatorname{Var} \\left( \\frac{1}{N} \\sum_{i=1}^{N} x_{i} \\right)$ 出发，推导统计不等效性 $g$ 作为归一化自相关函数 $\\rho(t)$ 的函数，并解释它如何重新标度相关数据的样本均值方差。使用这个 $g$，定义有效样本量 $N_{\\mathrm{eff}}$，该样本量适用于依赖于相关样本平均值的自由能估计量的渐近不确定性标度。\n\n现在，专门考虑归一化自相关随延迟呈指数衰减的情况，即 $\\rho(t) = \\exp\\!\\left(- t \\Delta t / \\tau_{c} \\right)$，其中整数 $t \\geq 1$，$\\Delta t$ 是采样间隔，$\\tau_{c}$ 是相关时间。考虑一个模拟，它在采样间隔 $\\Delta t = 2\\,\\mathrm{fs}$ 和相关时间 $\\tau_{c} = 50\\,\\mathrm{fs}$ 的条件下，产生了 $N = 2.50 \\times 10^{5}$ 个样本。使用你推导出的 $g$，计算该数据集的有效样本量 $N_{\\mathrm{eff}}$。\n\n将最终数值答案四舍五入到四位有效数字。最终答案以无单位的纯数表示。",
            "solution": "本问题要求推导统计不等效性 $g$，其在标度样本均值方差中的作用，有效样本量 $N_{\\mathrm{eff}}$ 的定义，以及在自相关呈指数衰减的特定情况下计算 $N_{\\mathrm{eff}}$。\n\n出发点是样本均值 $\\bar{x} = \\frac{1}{N} \\sum_{i=1}^{N} x_i$ 的方差定义。\n$$\n\\operatorname{Var}(\\bar{x}) = \\operatorname{Var}\\left(\\frac{1}{N} \\sum_{i=1}^{N} x_i\\right)\n$$\n利用方差的性质 $\\operatorname{Var}(cY) = c^2 \\operatorname{Var}(Y)$（其中 $c$ 为常数），我们得到：\n$$\n\\operatorname{Var}(\\bar{x}) = \\frac{1}{N^2} \\operatorname{Var}\\left(\\sum_{i=1}^{N} x_i\\right)\n$$\n随机变量之和的方差是其协方差矩阵中所有元素的总和：$\\operatorname{Var}\\left(\\sum_i Y_i\\right) = \\sum_i \\sum_j \\operatorname{Cov}(Y_i, Y_j)$。应用此公式可得：\n$$\n\\operatorname{Var}(\\bar{x}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\operatorname{Cov}(x_i, x_j)\n$$\n对于弱平稳过程，协方差 $\\operatorname{Cov}(x_i, x_j) = \\langle (x_i - \\mu)(x_j - \\mu) \\rangle$ 仅取决于样本之间的时间延迟 $t = |i-j|$。它可以用方差 $\\sigma^2$ 和归一化自相关函数 $\\rho(t)$ 表示为：\n$$\n\\operatorname{Cov}(x_i, x_j) = \\sigma^2 \\rho(|i-j|)\n$$\n将此代入 $\\operatorname{Var}(\\bar{x})$ 的表达式中：\n$$\n\\operatorname{Var}(\\bar{x}) = \\frac{\\sigma^2}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\rho(|i-j|)\n$$\n该双重求和可以通过将具有相同延迟 $t = |i-j|$ 的项分组来计算。延迟 $t$ 的范围从 $0$ 到 $N-1$。对于给定的延迟 $t  0$，求和中有 $2(N-t)$ 对索引 $(i, j)$ 满足 $|i-j|=t$。对于延迟 $t=0$，有 $N$ 对索引满足 $i=j$。因此，求和可以重写为：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} \\rho(|i-j|) = N\\rho(0) + \\sum_{t=1}^{N-1} 2(N-t)\\rho(t)\n$$\n根据定义，$\\rho(0)=1$。因此：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} \\rho(|i-j|) = N + 2 \\sum_{t=1}^{N-1} (N-t)\\rho(t)\n$$\n将此代回均值方差的方程中：\n$$\n\\operatorname{Var}(\\bar{x}) = \\frac{\\sigma^2}{N^2} \\left[ N + 2 \\sum_{t=1}^{N-1} (N-t)\\rho(t) \\right] = \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{t=1}^{N-1} \\left(1-\\frac{t}{N}\\right)\\rho(t) \\right]\n$$\n这是对于有限样本数 $N$ 的精确表达式。在渐近极限下，当样本数 $N$ 远大于过程的相关时间（即，对于远小于 $N$ 的 $t$，$\\rho(t) \\approx 0$），我们可以做两个近似。首先，对于 $\\rho(t)$ 不可忽略的延迟 $t$，有 $t/N \\ll 1$，因此 $(1-t/N) \\approx 1$。其次，由于 $\\rho(t)$ 衰减到零，求和的上限可以从 $N-1$ 扩展到 $\\infty$。这就得到了渐近公式：\n$$\n\\operatorname{Var}(\\bar{x}) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t) \\right]\n$$\n统计不等效性 $g$ 是一个因子，表示相关数据的样本均值方差比不相关（独立）数据的样本均值方差大多少。对于 $N$ 个独立样本，均值的方差为 $\\sigma^2/N$。我们定义 $g$，使得对于相关数据有：\n$$\n\\operatorname{Var}(\\bar{x}) = g \\frac{\\sigma^2}{N}\n$$\n通过将此定义与推导出的渐近表达式进行比较，我们确定统计不等效性为：\n$$\ng = 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t)\n$$\n这个表达式说明了 $g$ 如何重新标度方差。对于不相关数据，当 $t \\ge 1$ 时 $\\rho(t)=0$，因此 $g=1$。对于具有正相关的数据，$\\rho(t)0$，求和为正，因此 $g1$，这表明估计均值的方差增加（即统计不确定性更高）。\n\n有效样本量 $N_{\\mathrm{eff}}$ 定义为能够产生与 $N$ 个相关样本相同均值方差的独立样本数量。$N_{\\mathrm{eff}}$ 个独立样本的方差为 $\\sigma^2/N_{\\mathrm{eff}}$。将其与相关样本的方差相等：\n$$\n\\frac{\\sigma^2}{N_{\\mathrm{eff}}} = g \\frac{\\sigma^2}{N}\n$$\n求解 $N_{\\mathrm{eff}}$ 可得：\n$$\nN_{\\mathrm{eff}} = \\frac{N}{g}\n$$\n\n现在，我们专门研究自相关呈指数形式的情况：$\\rho(t) = \\exp(- t \\Delta t / \\tau_c)$，其中 $t \\ge 1$。我们使用这个模型计算 $g$：\n$$\ng = 1 + 2 \\sum_{t=1}^{\\infty} \\exp\\left(-\\frac{t \\Delta t}{\\tau_c}\\right)\n$$\n该求和是一个几何级数，其首项和公比均为 $r = \\exp(-\\Delta t / \\tau_c)$。该级数的和为 $\\sum_{t=1}^{\\infty} r^t = \\frac{r}{1-r}$。\n将此代入 $g$ 的表达式中：\n$$\ng = 1 + 2 \\frac{r}{1-r} = \\frac{(1-r) + 2r}{1-r} = \\frac{1+r}{1-r}\n$$\n将 $r = \\exp(-\\Delta t / \\tau_c)$ 代回，得到 $g$ 的公式：\n$$\ng = \\frac{1 + \\exp(-\\Delta t / \\tau_c)}{1 - \\exp(-\\Delta t / \\tau_c)}\n$$\n给定以下值：$N = 2.50 \\times 10^5$，$\\Delta t = 2\\,\\mathrm{fs}$，以及 $\\tau_c = 50\\,\\mathrm{fs}$。首先，我们计算指数中的比率：\n$$\n\\frac{\\Delta t}{\\tau_c} = \\frac{2\\,\\mathrm{fs}}{50\\,\\mathrm{fs}} = 0.04\n$$\n现在，我们可以计算 $g$ 的数值：\n$$\ng = \\frac{1 + \\exp(-0.04)}{1 - \\exp(-0.04)} \\approx \\frac{1 + 0.96078944}{1 - 0.96078944} = \\frac{1.96078944}{0.03921056} \\approx 50.006665\n$$\n最后，我们计算有效样本量 $N_{\\mathrm{eff}}$：\n$$\nN_{\\mathrm{eff}} = \\frac{N}{g} = \\frac{2.50 \\times 10^5}{50.006665} \\approx 4999.3335\n$$\n按要求将结果四舍五入到四位有效数字，得到 $4999$。",
            "answer": "$$\\boxed{4999}$$"
        }
    ]
}