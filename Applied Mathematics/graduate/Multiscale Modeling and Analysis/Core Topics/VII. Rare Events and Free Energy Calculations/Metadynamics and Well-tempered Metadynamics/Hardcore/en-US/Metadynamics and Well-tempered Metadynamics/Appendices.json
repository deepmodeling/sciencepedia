{
    "hands_on_practices": [
        {
            "introduction": "The ultimate goal of a metadynamics simulation is to reconstruct the underlying free energy surface, $F(s)$. However, the converged bias potential, $V_b(s)$, is not the free energy itself. This exercise establishes the fundamental relationship between these two quantities in the context of well-tempered metadynamics. By starting from the first principles of biased statistical ensembles, you will derive the crucial scaling factor that connects $V_b(s)$ to $F(s)$, providing a direct look into how the bias factor $\\gamma$ controls the simulation outcome .",
            "id": "4244349",
            "problem": "In a constant-potential molecular dynamics study of a proton-coupled electron transfer at an electrified interface, you wish to reconstruct the free energy surface $F(s)$ along a collective variable $s$ (for example, a charge-transfer coordinate) using Well-Tempered Metadynamics (WTMetaD). The system is thermostatted at temperature $T$ and the WTMetaD bias $V_b(s,t)$ is built by depositing Gaussian hills with an instantaneous rate that is modulated according to the WTMetaD prescription. Assume the following foundational facts:\n\n- Statistical mechanics of biased ensembles implies that the stationary distribution of the collective variable under the applied bias is $P_b(s) \\propto \\exp\\!\\left(-\\beta\\,[F(s) + V_b(s)]\\right)$, where $\\beta = 1/(k_B T)$, $k_B$ is the Boltzmann constant, and $T$ is the physical temperature.\n- In Well-Tempered Metadynamics (WTMetaD), the instantaneous bias deposition rate at a given $s$ is proportional to $\\exp\\!\\left(-V_b(s,t)/(k_B \\Delta T)\\right)$, where $\\Delta T$ is the bias temperature. In the infinite-time quasi-stationary regime, the expected rate of bias accumulation is uniform across $s$, which implies $P_b(s)\\,\\exp\\!\\left(-V_b(s)/(k_B \\Delta T)\\right)$ is independent of $s$.\n- The WTMetaD bias factor $\\gamma$ is defined by $\\gamma = (T + \\Delta T)/T$.\n\nUsing only these facts, derive the infinite-time relation that connects $V_b(s)$ and $F(s)$ and determine the scaling factor $c$ such that $F(s) = c\\,V_b(s)$ up to an additive constant. Then, for a simulation conducted at $T = 300\\ \\mathrm{K}$ with bias factor $\\gamma = 10$, compute the bias temperature $\\Delta T$ (express your answer in $\\mathrm{K}$) and the dimensionless scaling factor $c$ in the infinite-time limit. Provide your final answer as a row matrix $\\begin{pmatrix}\\Delta T & c\\end{pmatrix}$. Do not round your answer.",
            "solution": "The problem requires the derivation of the relationship between the free energy surface $F(s)$ and the converged Well-Tempered Metadynamics (WTMetaD) bias potential $V_b(s)$, and the calculation of specific parameters for a given system. The derivation will be based on the foundational principles of biased statistical mechanical ensembles and WTMetaD, as provided in the problem statement.\n\nThe first principle states that the stationary probability distribution of the collective variable $s$ under the influence of both the intrinsic free energy $F(s)$ and the applied bias $V_b(s)$ is given by:\n$$P_b(s) \\propto \\exp\\left(-\\beta[F(s) + V_b(s)]\\right)$$\nwhere $\\beta = 1/(k_B T)$, $k_B$ is the Boltzmann constant, and $T$ is the temperature of the system. We can write this with an explicit normalization constant $C_1$:\n$$P_b(s) = C_1 \\exp\\left(-\\beta F(s) - \\beta V_b(s)\\right)$$\n\nThe second principle describes the condition for the quasi-stationary state in WTMetaD, achieved in the infinite-time limit. It states that the effective sampling rate is uniform across the space of the collective variable $s$. This is mathematically expressed as the product of the biased probability $P_b(s)$ and a tempering factor being constant:\n$$P_b(s) \\exp\\left(-\\frac{V_b(s)}{k_B \\Delta T}\\right) = C_2$$\nwhere $\\Delta T$ is the bias temperature and $C_2$ is a constant. From this expression, we can isolate $P_b(s)$:\n$$P_b(s) = C_2 \\exp\\left(\\frac{V_b(s)}{k_B \\Delta T}\\right)$$\n\nWe now have two expressions for the same stationary distribution $P_b(s)$. Equating them yields:\n$$C_1 \\exp\\left(-\\beta F(s) - \\beta V_b(s)\\right) = C_2 \\exp\\left(\\frac{V_b(s)}{k_B \\Delta T}\\right)$$\nTo solve for $F(s)$, we take the natural logarithm of both sides:\n$$\\ln(C_1) - \\beta F(s) - \\beta V_b(s) = \\ln(C_2) + \\frac{V_b(s)}{k_B \\Delta T}$$\nNext, we rearrange the terms to isolate $\\beta F(s)$:\n$$-\\beta F(s) = \\beta V_b(s) + \\frac{V_b(s)}{k_B \\Delta T} + \\ln(C_2) - \\ln(C_1)$$\nWe can factor out $V_b(s)$ from the first two terms on the right-hand side and combine the logarithmic terms into a single constant, $C' = \\ln(C_2) - \\ln(C_1)$:\n$$-\\beta F(s) = V_b(s)\\left(\\beta + \\frac{1}{k_B \\Delta T}\\right) + C'$$\nSolving for $F(s)$ by dividing by $-\\beta$:\n$$F(s) = -\\frac{1}{\\beta} V_b(s)\\left(\\beta + \\frac{1}{k_B \\Delta T}\\right) - \\frac{C'}{\\beta}$$\nLetting $C_{add} = -C'/\\beta$ be the new additive constant, we simplify the term in the parenthesis:\n$$F(s) = -V_b(s)\\left(1 + \\frac{1}{\\beta k_B \\Delta T}\\right) + C_{add}$$\nSubstituting the definition $\\beta = 1/(k_B T)$:\n$$F(s) = -V_b(s)\\left(1 + \\frac{k_B T}{k_B \\Delta T}\\right) + C_{add} = -V_b(s)\\left(1 + \\frac{T}{\\Delta T}\\right) + C_{add}$$\nThis is the sought-after relationship between $F(s)$ and $V_b(s)$. The problem asks for this relationship to be expressed in terms of the bias factor $\\gamma$, defined as $\\gamma = (T + \\Delta T)/T$. Let us manipulate the scaling term:\n$$1 + \\frac{T}{\\Delta T} = \\frac{\\Delta T + T}{\\Delta T}$$\nFrom the definition of $\\gamma$, we have $T + \\Delta T = \\gamma T$ and $\\Delta T = \\gamma T - T = T(\\gamma-1)$. Substituting these into the scaling term gives:\n$$\\frac{\\Delta T + T}{\\Delta T} = \\frac{\\gamma T}{T(\\gamma-1)} = \\frac{\\gamma}{\\gamma-1}$$\nThus, the final relation between the free energy and the converged bias potential is:\n$$F(s) = -\\frac{\\gamma}{\\gamma-1}V_b(s) + C_{add}$$\nThis equation shows that the free energy surface $F(s)$ is linearly proportional to the converged WTMetaD bias potential $V_b(s)$, up to an additive constant.\n\nThe problem defines a scaling factor $c$ such that $F(s) = c\\,V_b(s)$ up to an additive constant. By direct comparison with our derived relation, we find:\n$$c = -\\frac{\\gamma}{\\gamma-1}$$\n\nNow, we proceed to the numerical calculation part of the problem. We are given the system temperature $T = 300\\ \\mathrm{K}$ and the bias factor $\\gamma = 10$.\n\nFirst, we calculate the bias temperature $\\Delta T$. Using the rearranged definition of $\\gamma$:\n$$\\Delta T = T(\\gamma - 1)$$\nSubstituting the given values:\n$$\\Delta T = 300 \\cdot (10 - 1) = 300 \\cdot 9 = 2700\\ \\mathrm{K}$$\n\nSecond, we calculate the dimensionless scaling factor $c$:\n$$c = -\\frac{\\gamma}{\\gamma-1}$$\nSubstituting the value of $\\gamma$:\n$$c = -\\frac{10}{10-1} = -\\frac{10}{9}$$\n\nThe final answer is required as a row matrix $\\begin{pmatrix}\\Delta T & c\\end{pmatrix}$. The values are $\\Delta T = 2700$ and $c = -10/9$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2700 & -\\frac{10}{9}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Why do we use well-tempered metadynamics instead of standard molecular dynamics for exploring complex energy landscapes? This practice provides a direct, quantitative answer by exploring the concept of sampling enhancement. You will derive an expression for how much more frequently a WTMetaD simulation visits high-energy transition states compared to an unbiased simulation . This exercise makes the abstract benefit of accelerated sampling tangible, demonstrating the power of the method in overcoming kinetic barriers.",
            "id": "4244390",
            "problem": "Consider a single collective variable (CV) $s$ that captures the progress of a cation desolvation event at a metal electrode interface in a constant-temperature molecular dynamics simulation of an electrochemical system. The unbiased stationary probability density along $s$ is governed by Boltzmann statistics, so that for free energy $F(s)$ at temperature $T$ the probability density is proportional to $\\exp(-\\beta F(s))$, where $\\beta = 1/(k_{B} T)$ and $k_{B}$ is the Boltzmann constant. In Well-Tempered Metadynamics (WTMetaD), characterized by the bias factor $\\gamma$, the long-time stationary probability density along $s$ is proportional to the unbiased density raised to the power $1/\\gamma$. Consider a barrier region at the transition state $s^{\\ddagger}$ and a nearby reactant basin $s_{\\mathrm{b}}$, with a free energy difference $\\Delta F = F(s^{\\ddagger}) - F(s_{\\mathrm{b}})$. Define the barrier sampling probability relative to the basin as the ratio $P(s^{\\ddagger})/P(s_{\\mathrm{b}})$. Derive from first principles the enhancement factor $E(\\Delta F, \\gamma)$, defined as\n$$\nE(\\Delta F, \\gamma) = \\frac{\\left[P_{\\gamma}(s^{\\ddagger})/P_{\\gamma}(s_{\\mathrm{b}})\\right]}{\\left[P_{0}(s^{\\ddagger})/P_{0}(s_{\\mathrm{b}})\\right]},\n$$\nwhere $P_{0}$ denotes the unbiased stationary probability density and $P_{\\gamma}$ denotes the WTMetaD stationary probability density. Then evaluate $E$ for $\\gamma = 8$ and $\\Delta F = 10 k_{B} T$. Express your final answer as a dimensionless factor and round to three significant figures.",
            "solution": "The problem requires the derivation of the enhancement factor $E(\\Delta F, \\gamma)$ in Well-Tempered Metadynamics (WTMetaD) and its subsequent evaluation for a specific set of parameters. The derivation will proceed from the fundamental definitions provided for the stationary probability distributions.\n\nThe unbiased stationary probability density along the collective variable $s$, denoted as $P_0(s)$, is governed by the Boltzmann distribution. It is proportional to the exponential of the negative free energy $F(s)$ scaled by the thermal energy $k_B T$. Let $\\beta = 1/(k_B T)$, where $k_B$ is the Boltzmann constant and $T$ is the absolute temperature.\nThe probability density can be written as:\n$$\nP_0(s) = C_0 \\exp(-\\beta F(s))\n$$\nwhere $C_0$ is a normalization constant. The problem defines the barrier sampling probability relative to the basin as the ratio of probability densities at the transition state, $s^{\\ddagger}$, and the reactant basin, $s_{\\mathrm{b}}$. For the unbiased case, this ratio is:\n$$\n\\frac{P_0(s^{\\ddagger})}{P_0(s_{\\mathrm{b}})} = \\frac{C_0 \\exp(-\\beta F(s^{\\ddagger}))}{C_0 \\exp(-\\beta F(s_{\\mathrm{b}}))}\n$$\nThe normalization constant $C_0$ cancels. Using the properties of exponential functions, this simplifies to:\n$$\n\\frac{P_0(s^{\\ddagger})}{P_0(s_{\\mathrm{b}})} = \\exp\\left(-\\beta [F(s^{\\ddagger}) - F(s_{\\mathrm{b}})]\\right)\n$$\nGiven the definition of the free energy barrier $\\Delta F = F(s^{\\ddagger}) - F(s_{\\mathrm{b}})$, the unbiased probability ratio becomes:\n$$\n\\frac{P_0(s^{\\ddagger})}{P_0(s_{\\mathrm{b}})} = \\exp(-\\beta \\Delta F)\n$$\nThis quantity represents the denominator in the definition of the enhancement factor $E$.\n\nNext, we consider the stationary probability density in WTMetaD, $P_{\\gamma}(s)$, which is characterized by the bias factor $\\gamma$. The problem states that this density is proportional to the unbiased density raised to the power of $1/\\gamma$:\n$$\nP_{\\gamma}(s) \\propto [P_0(s)]^{1/\\gamma}\n$$\nIntroducing a new normalization constant $C_{\\gamma}$, we can write:\n$$\nP_{\\gamma}(s) = C_{\\gamma} [P_0(s)]^{1/\\gamma} = C_{\\gamma} [C_0 \\exp(-\\beta F(s))]^{1/\\gamma} = C_{\\gamma} C_0^{1/\\gamma} \\exp\\left(-\\frac{\\beta F(s)}{\\gamma}\\right)\n$$\nLet $C'_{\\gamma} = C_{\\gamma} C_0^{1/\\gamma}$ be the combined normalization constant for the WTMetaD distribution. Then,\n$$\nP_{\\gamma}(s) = C'_{\\gamma} \\exp\\left(-\\frac{\\beta F(s)}{\\gamma}\\right)\n$$\nThe ratio of probabilities at the transition state and the basin for the WTMetaD case is:\n$$\n\\frac{P_{\\gamma}(s^{\\ddagger})}{P_{\\gamma}(s_{\\mathrm{b}})} = \\frac{C'_{\\gamma} \\exp\\left(-\\frac{\\beta F(s^{\\ddagger})}{\\gamma}\\right)}{C'_{\\gamma} \\exp\\left(-\\frac{\\beta F(s_{\\mathrm{b}})}{\\gamma}\\right)}\n$$\nThe constant $C'_{\\gamma}$ cancels, and we obtain:\n$$\n\\frac{P_{\\gamma}(s^{\\ddagger})}{P_{\\gamma}(s_{\\mathrm{b}})} = \\exp\\left(-\\frac{\\beta}{\\gamma} [F(s^{\\ddagger}) - F(s_{\\mathrm{b}})]\\right) = \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)\n$$\nThis quantity is the numerator in the definition of the enhancement factor $E$.\n\nNow we can derive the expression for the enhancement factor $E(\\Delta F, \\gamma)$ by substituting the derived ratios into its definition:\n$$\nE(\\Delta F, \\gamma) = \\frac{\\left[P_{\\gamma}(s^{\\ddagger})/P_{\\gamma}(s_{\\mathrm{b}})\\right]}{\\left[P_{0}(s^{\\ddagger})/P_{0}(s_{\\mathrm{b}})\\right]} = \\frac{\\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)}{\\exp(-\\beta \\Delta F)}\n$$\nUsing the identity $\\exp(a)/\\exp(b) = \\exp(a-b)$, the expression simplifies to:\n$$\nE(\\Delta F, \\gamma) = \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma} - (-\\beta \\Delta F)\\right) = \\exp\\left(\\beta \\Delta F - \\frac{\\beta \\Delta F}{\\gamma}\\right)\n$$\nFactoring out the term $\\beta \\Delta F$, we arrive at the final analytical expression for the enhancement factor:\n$$\nE(\\Delta F, \\gamma) = \\exp\\left(\\beta \\Delta F \\left(1 - \\frac{1}{\\gamma}\\right)\\right) = \\exp\\left(\\frac{\\Delta F}{k_B T} \\left(\\frac{\\gamma - 1}{\\gamma}\\right)\\right)\n$$\nThis expression shows that for $\\gamma > 1$, the exponent is positive, leading to an enhancement factor $E > 1$, which confirms that WTMetaD increases the relative sampling probability of the barrier region.\n\nThe final step is to evaluate this expression for the given parameters: $\\gamma = 8$ and $\\Delta F = 10 k_B T$.\nSubstituting these values, we first note that the term $\\Delta F / (k_B T)$ becomes:\n$$\n\\frac{\\Delta F}{k_B T} = \\frac{10 k_B T}{k_B T} = 10\n$$\nNow we substitute this and $\\gamma=8$ into the expression for $E$:\n$$\nE = \\exp\\left(10 \\left(1 - \\frac{1}{8}\\right)\\right) = \\exp\\left(10 \\left(\\frac{7}{8}\\right)\\right) = \\exp(8.75)\n$$\nCalculating the numerical value:\n$$\nE \\approx 6309.5734...\n$$\nThe problem requires the answer to be rounded to three significant figures. This gives $6310$. In standard scientific notation, this is written as $6.31 \\times 10^3$.",
            "answer": "$$\\boxed{6.31 \\times 10^{3}}$$"
        },
        {
            "introduction": "Moving from theory to practice often involves handling physical constraints. In many systems, collective variables like bond distances or coordination numbers are naturally confined within a specific range. This exercise addresses the practical challenge of implementing metadynamics for such bounded CVs . You will derive the total generalized force acting on the system by combining the time-dependent force from the metadynamics bias with the static forces from confining 'wall' potentials, a crucial step in ensuring a stable and physically meaningful simulation.",
            "id": "3778848",
            "problem": "Consider a many-particle system evolving under classical dynamics in reduced, dimensionless units so that all energies and forces are dimensionless. Let $s = s(\\mathbf{x})$ be a differentiable collective variable (CV) with a physically meaningful hard domain $s \\in [s_{\\min}, s_{\\max}]$. To enhance sampling along $s$, you apply well-tempered metadynamics, in which a time-dependent bias potential $V_{\\mathrm{bias}}(s,t)$ is constructed by depositing Gaussian kernels centered at the CV values $\\{s_i\\}_{i=1}^{N(t)}$ recorded at deposit times $\\{t_i\\}_{i=1}^{N(t)}$, with a base height $w$, a width $\\sigma$, the Boltzmann constant $k_B$, and a tempering parameter $\\Delta T > 0$. The deposited $i$-th kernel has height scaled by $\\exp\\!\\left(- V_{\\mathrm{bias}}(s_i,t_i)/(k_B \\Delta T)\\right)$, where $V_{\\mathrm{bias}}(s_i,t_i)$ denotes the accumulated bias just before the $i$-th deposition at location $s_i$. Thus, the bias takes the form\n$$\nV_{\\mathrm{bias}}(s,t) \\;=\\; \\sum_{i=1}^{N(t)} w \\,\\exp\\!\\left(- \\frac{V_{\\mathrm{bias}}(s_i,t_i)}{k_B \\Delta T}\\right)\\, \\exp\\!\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right).\n$$\nTo enforce the hard limits on $s$, you add soft half-harmonic wall potentials at the boundaries:\n$$\nV_{\\mathrm{L}}(s) \\;=\\; \\frac{1}{2}\\,k_{\\mathrm{L}}\\,\\big[\\,\\max(0,\\, s_{\\min} - s)\\,\\big]^2,\\qquad\nV_{\\mathrm{R}}(s) \\;=\\; \\frac{1}{2}\\,k_{\\mathrm{R}}\\,\\big[\\,\\max(0,\\, s - s_{\\max})\\,\\big]^2,\n$$\nwith stiffnesses $k_{\\mathrm{L}} > 0$ and $k_{\\mathrm{R}} > 0$. The total added potential acting along the CV is $V_{\\mathrm{tot}}(s,t) = V_{\\mathrm{bias}}(s,t) + V_{\\mathrm{L}}(s) + V_{\\mathrm{R}}(s)$.\n\nStarting only from the principles that potentials are additive and that the generalized force conjugate to $s$ is $- \\partial V_{\\mathrm{tot}}(s,t)/\\partial s$, derive a closed-form analytic expression for the total generalized force along the CV,\n$$\nF_s(s,t) \\;=\\; -\\frac{\\partial}{\\partial s}\\,V_{\\mathrm{tot}}(s,t),\n$$\nexpressed explicitly as a function of $s$, the deposition history $\\{s_i,t_i\\}_{i=1}^{N(t)}$, and the parameters $w$, $\\sigma$, $k_B$, $\\Delta T$, $k_{\\mathrm{L}}$, $k_{\\mathrm{R}}$, $s_{\\min}$, and $s_{\\max}$. You may use the positive-part operator $[x]_+ \\equiv \\max(0,x)$ if desired. Work in reduced, dimensionless units. Your final answer must be a single closed-form analytic expression for $F_s(s,t)$.",
            "solution": "The total generalized force $F_s(s,t)$ is the negative partial derivative of the total potential $V_{\\mathrm{tot}}(s,t)$ with respect to the collective variable $s$.\n$$\nF_s(s,t) = -\\frac{\\partial V_{\\mathrm{tot}}(s,t)}{\\partial s}\n$$\nGiven that the total potential is a sum of three independent components, $V_{\\mathrm{tot}}(s,t) = V_{\\mathrm{bias}}(s,t) + V_{\\mathrm{L}}(s) + V_{\\mathrm{R}}(s)$, the linearity of the derivative operator allows us to compute the force from each component separately and sum the results:\n$$\nF_s(s,t) = \\left(-\\frac{\\partial V_{\\mathrm{bias}}(s,t)}{\\partial s}\\right) + \\left(-\\frac{\\partial V_{\\mathrm{L}}(s)}{\\partial s}\\right) + \\left(-\\frac{\\partial V_{\\mathrm{R}}(s)}{\\partial s}\\right)\n$$\nWe derive each term below.\n\n**1. Force from the Metadynamics Bias Potential ($V_{\\mathrm{bias}}$):**\nThe bias potential is a sum of Gaussian kernels. For clarity, let's denote the time-dependent height of the $i$-th kernel as $w_i = w \\exp\\left(- V_{\\mathrm{bias}}(s_i,t_i)/(k_B \\Delta T)\\right)$. Since $w_i$ does not depend on the current CV value $s$, the derivative is straightforward:\n$$\n\\begin{aligned}\n-\\frac{\\partial V_{\\mathrm{bias}}(s,t)}{\\partial s} = -\\frac{\\partial}{\\partial s} \\left[ \\sum_{i=1}^{N(t)} w_i \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right) \\right] \\\\\n= - \\sum_{i=1}^{N(t)} w_i \\frac{\\partial}{\\partial s} \\left[ \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right) \\right] \\\\\n= - \\sum_{i=1}^{N(t)} w_i \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right) \\cdot \\left( -\\frac{2(s - s_i)}{2 \\sigma^2} \\right) \\\\\n= \\sum_{i=1}^{N(t)} w_i \\frac{s - s_i}{\\sigma^2} \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right)\n\\end{aligned}\n$$\nSubstituting the full expression for $w_i$ back in gives the first term of the force:\n$$\nF_{s, \\text{bias}}(s,t) = \\frac{w}{\\sigma^2} \\sum_{i=1}^{N(t)} (s - s_i) \\exp\\left(- \\frac{V_{\\mathrm{bias}}(s_i,t_i)}{k_B \\Delta T}\\right) \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right)\n$$\n\n**2. Force from the Left Wall Potential ($V_{\\mathrm{L}}$):**\nThe left wall potential is $V_{\\mathrm{L}}(s) = \\frac{1}{2}k_{\\mathrm{L}}[\\max(0, s_{\\min} - s)]^2$. We analyze its derivative piecewise:\n- If $s \\ge s_{\\min}$, then $s_{\\min} - s \\le 0$, so $V_{\\mathrm{L}}(s) = 0$. The derivative is $\\frac{\\partial V_{\\mathrm{L}}}{\\partial s} = 0$.\n- If $s  s_{\\min}$, then $s_{\\min} - s > 0$, so $V_{\\mathrm{L}}(s) = \\frac{1}{2}k_{\\mathrm{L}}(s_{\\min} - s)^2$. Using the chain rule, the derivative is $\\frac{\\partial V_{\\mathrm{L}}}{\\partial s} = \\frac{1}{2}k_{\\mathrm{L}} \\cdot 2(s_{\\min} - s) \\cdot (-1) = -k_{\\mathrm{L}}(s_{\\min} - s)$.\nBoth cases can be compactly written using the positive-part operator $[x]_+ = \\max(0,x)$: $\\frac{\\partial V_{\\mathrm{L}}}{\\partial s} = -k_{\\mathrm{L}}[s_{\\min} - s]_+$. The force is the negative of this derivative:\n$$\nF_{s, \\text{L}}(s) = -\\frac{\\partial V_{\\mathrm{L}}}{\\partial s} = k_{\\mathrm{L}}[s_{\\min} - s]_+\n$$\n\n**3. Force from the Right Wall Potential ($V_{\\mathrm{R}}$):**\nThe right wall potential is $V_{\\mathrm{R}}(s) = \\frac{1}{2}k_{\\mathrm{R}}[\\max(0, s - s_{\\max})]^2$. We analyze its derivative piecewise:\n- If $s \\le s_{\\max}$, then $s - s_{\\max} \\le 0$, so $V_{\\mathrm{R}}(s) = 0$. The derivative is $\\frac{\\partial V_{\\mathrm{R}}}{\\partial s} = 0$.\n- If $s > s_{\\max}$, then $s - s_{\\max} > 0$, so $V_{\\mathrm{R}}(s) = \\frac{1}{2}k_{\\mathrm{R}}(s - s_{\\max})^2$. Using the chain rule, the derivative is $\\frac{\\partial V_{\\mathrm{R}}}{\\partial s} = \\frac{1}{2}k_{\\mathrm{R}} \\cdot 2(s - s_{\\max}) \\cdot (1) = k_{\\mathrm{R}}(s - s_{\\max})$.\nBoth cases can be compactly written as $\\frac{\\partial V_{\\mathrm{R}}}{\\partial s} = k_{\\mathrm{R}}[s - s_{\\max}]_+$. The force is the negative of this derivative:\n$$\nF_{s, \\text{R}}(s) = -\\frac{\\partial V_{\\mathrm{R}}}{\\partial s} = -k_{\\mathrm{R}}[s - s_{\\max}]_+\n$$\n\n**4. Total Generalized Force:**\nSumming the three force components gives the final expression for the total generalized force along the CV:\n$$\nF_s(s,t) = \\frac{w}{\\sigma^2} \\sum_{i=1}^{N(t)} (s - s_i) \\exp\\left(- \\frac{V_{\\mathrm{bias}}(s_i,t_i)}{k_B \\Delta T}\\right) \\exp\\left(- \\frac{(s - s_i)^2}{2 \\sigma^2}\\right) + k_{\\mathrm{L}} [s_{\\min} - s]_+ - k_{\\mathrm{R}} [s - s_{\\max}]_+\n$$\nThis expression is the closed-form solution requested.",
            "answer": "$$ \\boxed{ \\frac{w}{\\sigma^2} \\sum_{i=1}^{N(t)} (s - s_i) \\exp\\left(-\\frac{V_{\\mathrm{bias}}(s_i,t_i)}{k_B \\Delta T}\\right) \\exp\\left(-\\frac{(s - s_i)^2}{2 \\sigma^2}\\right) + k_{\\mathrm{L}} [s_{\\min} - s]_+ - k_{\\mathrm{R}} [s - s_{\\max}]_+ } $$"
        }
    ]
}