{
    "hands_on_practices": [
        {
            "introduction": "理解一个复杂方法的最好方式，往往是将其应用于一个简单且可解的模型上。本练习采用物理学中的基础系统——一维谐振子，来阐明热力学积分的核心机制。通过分析求解这个问题，你将能够完整地、无需任何数值近似地体验整个计算流程，从而建立起坚实的理论直觉 。",
            "id": "2465950",
            "problem": "质量为 $m$ 的单个经典粒子在一维空间中运动，并被置于谐波势中。在状态 $A$ 中，势为 $U_{A}(x) = \\frac{1}{2} k_{A} x^{2}$，在状态 $B$ 中，势为 $U_{B}(x) = \\frac{1}{2} k_{B} x^{2}$，其中 $k_{A} > 0$ 和 $k_{B} > 0$ 是力常数。系统处于绝对温度 $T$ 的正则系综中。定义一个炼金耦合参数 $\\lambda \\in [0,1]$ 和一个势路径 $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$。使用热力学积分 (TI)，确定亥姆霍兹自由能差 $\\Delta F_{A \\to B} = F_{B} - F_{A}$ 的精确解析表达式。假设经典统计，并注意状态 $A$ 和 $B$ 中的动能贡献是相同的，因此在自由能差中相互抵消。将您的最终答案以 $k_{A}$、$k_{B}$、玻尔兹曼常数 $k_{\\mathrm{B}}$ 和 $T$ 的形式表示为一个单一的封闭形式表达式。",
            "solution": "系统是经典的，并处于温度 $T$ 的正则系综中。亥姆霍兹自由能定义为 $F = - k_{\\mathrm{B}} T \\ln Z$，其中 $Z$ 是配分函数。在热力学积分 (TI) 中，引入一个耦合参数 $\\lambda \\in [0,1]$，它通过 $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$ 将势从 $U_{A}$ 连续地变换到 $U_{B}$。正则系综中的基本 TI 关系是\n$$\n\\Delta F_{A \\to B} \\equiv F_{B} - F_{A} = \\int_{0}^{1} \\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\n其中 $\\langle \\cdot \\rangle_{\\lambda}$ 表示相对于与 $U_{\\lambda}$ 对应的正则分布的系综平均。\n\n对于给定的路径，\n$$\nU_{\\lambda}(x) = \\frac{1}{2}\\left[(1-\\lambda)k_{A} + \\lambda k_{B}\\right] x^{2} \\equiv \\frac{1}{2} k(\\lambda) x^{2},\n$$\n其中 $k(\\lambda) = (1-\\lambda)k_{A} + \\lambda k_{B}$。将 $U_{\\lambda}$ 对 $\\lambda$ 求导得出\n$$\n\\frac{\\partial U_{\\lambda}}{\\partial \\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) x^{2}.\n$$\n因此，TI 的被积函数是\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\langle x^{2} \\rangle_{\\lambda}.\n$$\n\n我们现在计算力常数为 $k(\\lambda)$ 的一维谐波势的 $\\langle x^{2} \\rangle_{\\lambda}$。在正则系综中，\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{\\int_{-\\infty}^{\\infty} x^{2} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx}{\\int_{-\\infty}^{\\infty} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx},\n$$\n其中 $\\beta = \\frac{1}{k_{\\mathrm{B}} T}$。分子和分母都是高斯积分。使用此类矩的标准结果，可以得到\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{1}{\\beta k(\\lambda)} = \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\n因此，\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\n\n代入 TI 积分，得到\n$$\n\\Delta F_{A \\to B} = \\int_{0}^{1} \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{(1-\\lambda)k_{A} + \\lambda k_{B}} \\, d\\lambda.\n$$\n这个积分是初等的。令 $a = k_{A}$ 且 $b = k_{B}$。则\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T (b - a) \\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)}.\n$$\n计算该积分，\n$$\n\\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)} = \\frac{1}{b - a} \\left[ \\ln\\!\\left(a + \\lambda (b - a)\\right) \\right]_{0}^{1} = \\frac{1}{b - a} \\left( \\ln b - \\ln a \\right).\n$$\n因此，\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T \\left( \\ln b - \\ln a \\right) = \\frac{1}{2} k_{\\mathrm{B}} T \\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right).\n$$\n\n此表达式是沿指定线性耦合路径的两个一维谐波状态之间的精确经典构型自由能差，并且与直接的配分函数计算结果一致，注意动能贡献在差值中被抵消。",
            "answer": "$$\\boxed{\\frac{1}{2}\\,k_{\\mathrm{B}}\\,T\\,\\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right)}$$"
        },
        {
            "introduction": "在掌握了分析基础之后，下一步是处理热力学积分在实践中的应用方式。真实的计算机模拟不会产生连续的函数，而是离散的数据点。本练习模拟了这一情景，提供了一组预先计算好的系综平均值，并要求你使用数值积分方法来计算自由能差，这是该领域任何实践者都必须具备的核心技能 。",
            "id": "3867550",
            "problem": "在一项与计算化学生物学相关的炼金术自由能计算中，一个配体在恒定温度 $T$ 下通过与一个参数 $\\lambda \\in [0,1]$ 耦合，被转化为一个参考态。该系统在正则系综中进行模拟。在每个离散的 $\\lambda$ 值处，广义力 $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ 的系综平均值通过足够长的平衡分子动力学模拟进行估计，其中 $U(\\mathbf{x};\\lambda)$ 是在耦合参数为 $\\lambda$ 时构型 $\\mathbf{x}$ 的势能。在一个均匀间隔的网格上获得了以下数值（为本练习之目的，假设这些值在统计上是收敛的）：\n- $\\lambda = 0.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.000\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.1$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.229\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.2$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.512\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.3$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.843\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.4$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.216\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.5$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.625\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.6$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.064\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.7$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.527\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.8$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.008\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.9$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.501\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 1.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 5.000\\ \\mathrm{kJ\\,mol^{-1}}$\n\n仅使用平衡统计力学的基本定义和数值积分方法，推导连接亥姆霍兹自由能差 $\\Delta F$ 与所提供的广义力数据的表达式，然后使用适用于均匀间隔网格的复合 Newton–Cotes 法则计算 $\\lambda \\in [0,1]$ 范围内的 $\\Delta F$ 近似值。在您的计算中，请展示您使用的明确积分权重。最后，简要地定性讨论对于您选择的积分方法，离散化误差如何随网格间距变化，以及 $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ 潜在的 $\\lambda$ 依赖关系的哪些特征控制着这个误差。\n\n以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示 $\\Delta F$ 的最终数值，并将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导基本的热力学积分（TI）公式，使用数值积分方法将其应用于给定的数据集，并讨论数值误差。\n\n首先，我们验证问题陈述的有效性。\n已知条件：\n- 一个系统在恒定温度 $T$ 下于正则系综中进行模拟。\n- 耦合参数 $\\lambda$ 从 $0$ 变化到 $1$。\n- 提供了在 $\\lambda = 0.0, 0.1, \\dots, 1.0$ 时广义力系综平均值 $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ 的一组共 11 个均匀间隔的数据点。这些值的单位是 $\\mathrm{kJ\\,mol^{-1}}$。\n- 任务是推导亥姆霍兹自由能差 $\\Delta F$ 的表达式，计算其值，并分析所选数值方法的误差。\n\n验证：\n该问题具有科学依据，因为热力学积分是计算统计力学中用于自由能计算的基石方法。问题设置是适定的，为数值积分提供了所有必要的数据。语言是客观的，数据是一致的。这是一个应用基本理论和数值方法的标准练习。因此，该问题是有效的。\n\n现在我们开始解答。\n\n**1. 热力学积分公式的推导**\n\n亥姆霍兹自由能 $F$ 由正则配分函数 $Z$ 定义：\n$$F(\\lambda) = -k_B T \\ln Z(\\lambda)$$\n其中 $k_B$ 是玻尔兹曼常数，$T$ 是温度，$\\lambda$ 是耦合参数。对于一个由 $N$ 个全同粒子组成的系统，其正则配分函数 $Z$ 由对所有可能的相空间坐标（位置 $\\mathbf{x}$ 和动量 $\\mathbf{p}$）的积分给出：\n$$Z(\\lambda) = \\frac{1}{N!h^{3N}} \\int \\int \\exp(-\\beta H(\\mathbf{x}, \\mathbf{p}; \\lambda)) \\,d\\mathbf{x}\\,d\\mathbf{p}$$\n在这里，$\\beta = (k_B T)^{-1}$，$h$ 是普朗克常数，$H(\\mathbf{x}, \\mathbf{p}; \\lambda)$ 是系统的哈密顿量。哈密顿量是动能 $K(\\mathbf{p})$ 和势能 $U(\\mathbf{x}; \\lambda)$ 的和：$H(\\mathbf{x}, \\mathbf{p}; \\lambda) = K(\\mathbf{p}) + U(\\mathbf{x}; \\lambda)$。由于动能与 $\\lambda$ 无关，对动量的积分可以被因子化提出。这导出了一个依赖于构型配分函数 $Q(\\lambda)$ 的自由能简化表达式：\n$$F(\\lambda) = -k_B T \\ln Q(\\lambda) + C$$\n其中 $C$ 是一个与 $\\lambda$ 无关的常数，$Q(\\lambda)$ 由下式给出：\n$$Q(\\lambda) = \\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\n为了找到 $F$ 与给定数据之间的关系，我们将 $F(\\lambda)$ 对 $\\lambda$ 求导：\n$$\\frac{\\partial F}{\\partial \\lambda} = -k_B T \\frac{1}{Q(\\lambda)} \\frac{\\partial Q(\\lambda)}{\\partial \\lambda}$$\n构型配分函数的导数是：\n$$\\frac{\\partial Q(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x} = \\int \\left(-\\beta \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda}\\right) \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\n将此代入 $\\partial F / \\partial \\lambda$ 的表达式中：\n$$\\frac{\\partial F}{\\partial \\lambda} = -k_B T \\frac{1}{Q(\\lambda)} \\int \\left(-\\beta \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda}\\right) \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\n使用 $\\beta = (k_B T)^{-1}$，上式简化为：\n$$\\frac{\\partial F}{\\partial \\lambda} = \\frac{\\int \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda} \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}}{\\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}}$$\n根据定义，右侧是在固定 $\\lambda$ 值时，正则系综中物理量 $\\partial U / \\partial \\lambda$ 的系综平均值。这被记为 $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$。因此，我们得到了核心关系式：\n$$\\frac{\\partial F}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$$\n为了求得总自由能差 $\\Delta F = F(\\lambda=1) - F(\\lambda=0)$，我们沿从 $\\lambda=0$ 到 $\\lambda=1$ 的路径对该表达式进行积分：\n$$\\int_0^1 \\frac{\\partial F}{\\partial \\lambda} \\,d\\lambda = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda$$\n根据微积分基本定理，左侧为 $F(1) - F(0) = \\Delta F$。因此，最终的表达式是：\n$$\\Delta F = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda$$\n这就是所要求的表达式。\n\n**2. $\\Delta F$ 的数值计算**\n\n该问题提供了被积函数 $g(\\lambda) = \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ 在一个包含 11 个点的均匀间隔网格上的数据，这对应于 $n=10$ 个区间。由于 $n$ 是偶数，复合 Simpson 法则是一种合适且高精度的 Newton-Cotes 方法。对于 $n$ 个（$n$ 为偶数）宽度为 $h$ 的区间的复合 Simpson 法则公式为：\n$$\\int_a^b g(\\lambda) \\,d\\lambda \\approx \\frac{h}{3} \\left[ g(\\lambda_0) + 4g(\\lambda_1) + 2g(\\lambda_2) + \\dots + 2g(\\lambda_{n-2}) + 4g(\\lambda_{n-1}) + g(\\lambda_n) \\right]$$\n在本例中，积分区间为 $[0, 1]$，所以 $a=0$ 且 $b=1$。区间数量为 $n=10$，因此网格间距为 $h = (1-0)/10 = 0.1$。令 $g_i = \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda_i}$，其中 $\\lambda_i = i \\times h$。\n数据点如下：\n$g_0 = 1.000$；$g_1 = 1.229$；$g_2 = 1.512$；$g_3 = 1.843$；$g_4 = 2.216$；$g_5 = 2.625$；$g_6 = 3.064$；$g_7 = 3.527$；$g_8 = 4.008$；$g_9 = 4.501$；$g_{10} = 5.000$。（所有单位均为 $\\mathrm{kJ\\,mol^{-1}}$）。\n\n每个数据点 $g_i$ 的积分权重由 $w_i$ 给出。积分为 $\\sum_{i=0}^{10} w_i g_i$。对于 Simpson 法则，权重为：\n$w_0 = \\frac{h}{3}(1) = \\frac{0.1}{3}$；$w_1 = \\frac{h}{3}(4) = \\frac{0.4}{3}$；$w_2 = \\frac{h}{3}(2) = \\frac{0.2}{3}$；$w_3 = \\frac{h}{3}(4) = \\frac{0.4}{3}$；$w_4 = \\frac{h}{3}(2) = \\frac{0.2}{3}$；$w_5 = \\frac{h}{3}(4) = \\frac{0.4}{3}$；$w_6 = \\frac{h}{3}(2) = \\frac{0.2}{3}$；$w_7 = \\frac{h}{3}(4) = \\frac{0.4}{3}$；$w_8 = \\frac{h}{3}(2) = \\frac{0.2}{3}$；$w_9 = \\frac{h}{3}(4) = \\frac{0.4}{3}$；$w_{10} = \\frac{h}{3}(1) = \\frac{0.1}{3}$。\n\n应用该法则：\n$\\Delta F \\approx \\frac{0.1}{3} [g_0 + 4g_1 + 2g_2 + 4g_3 + 2g_4 + 4g_5 + 2g_6 + 4g_7 + 2g_8 + 4g_9 + g_{10}]$\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4(1.229) + 2(1.512) + 4(1.843) + 2(2.216) + 4(2.625) + 2(3.064) + 4(3.527) + 2(4.008) + 4(4.501) + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4.916 + 3.024 + 7.372 + 4.432 + 10.500 + 6.128 + 14.108 + 8.016 + 18.004 + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [82.500]$\n$\\Delta F \\approx \\frac{8.250}{3} = 2.750 \\, \\mathrm{kJ\\,mol^{-1}}$\n\n**3. 离散化误差的讨论**\n\n对于使用网格间距 $h = (b-a)/n$ 在区间 $[a,b]$ 上对函数 $g(\\lambda)$ 进行积分的复合 Simpson 法则，其离散化误差 $E$ 由下式给出：\n$$E = -\\frac{(b-a)h^4}{180} g^{(4)}(\\xi)$$\n对于某个 $\\xi \\in (a, b)$，其中 $g^{(4)}(\\lambda)$ 是被积函数的四阶导数。\n\n从这个公式中，我们可以得出两个关键的观察结果：\n1.  **随网格间距的变化关系**：误差随网格间距的四次方变化，即 $E \\propto h^4$。这是一个高阶精度。如果网格间距 $h$ 减半，误差预计将减少 $2^4 = 16$ 倍。\n2.  **控制误差的特征**：误差的大小与被积函数 $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ 的四阶导数的大小成正比。如果这个函数平滑且能被低阶多项式很好地近似，则误差很小。如果函数表现出高频振荡或急剧变化的曲率，这对应于一个大的四阶导数，那么误差就会很大。\n\n在这个具体问题中，可以验证所提供的数据点完全拟合三次多项式 $g(\\lambda) = -\\lambda^3 + 3\\lambda^2 + 2\\lambda + 1$。对于一个3次或更低次的多项式，其四阶导数恒等于零：\n$$g^{(4)}(\\lambda) = \\frac{d^4}{d\\lambda^4}(-\\lambda^3 + 3\\lambda^2 + 2\\lambda + 1) = 0$$\n因此，对于这个特定的数据集，复合 Simpson 法则的截断误差为零。计算出的值 $2.750 \\, \\mathrm{kJ\\,mol^{-1}}$ 不是一个近似值，而是生成这些数据点的潜在函数积分的精确值。最终结果应按要求报告为四位有效数字。\n\n计算值为 $\\Delta F = 2.750 \\, \\mathrm{kJ\\,mol^{-1}}$。",
            "answer": "$$\\boxed{2.750}$$"
        },
        {
            "introduction": "除了处理数据，计算科学家的一项关键技能是设计高效而准确的模拟方案。这最后一个练习将我们带入该高级领域，要求你为一个现实问题——计算配体的水合自由能——设计一个完整的炼金术路径。你需要考虑分阶段计算、设置模拟窗口以及分配计算时间的最佳策略，从而将物理原理与实际计算约束相结合，以获得最可靠的结果 。",
            "id": "3867509",
            "problem": "您正在使用热力学积分（TI）通过炼金术路径计算一个小的中性极性配体在液态水中的绝对水合自由能。您将分两个概念部分进行解耦：首先通过缩放电荷来移除静电相互作用（去电荷），然后移除范德华（非键合 Lennard–Jones）相互作用（范德华解耦）。该系统是一个溶剂化的配体，置于一个立方体水盒子中，在 $300\\,\\text{K}$ 和 $1\\,\\text{bar}$ 的等温等压条件下，使用粒子网格 Ewald（PME）方法处理长程静电相互作用，并采用标准的分子动力学积分器。目标是为每个部分设计一个分阶段的耦合参数 $\\lambda$ 方案，并论证如何在整个方案中分配采样精力，以在固定的总模拟时间内最小化 TI 积分的统计不确定性。\n\n作为符合上下文的基本依据，回想一下两个具有势能函数 $U(\\lambda)$ 的状态之间的 TI 自由能差的定义，\n$$\n\\Delta G \\;=\\; \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_\\lambda \\, d\\lambda,\n$$\n其中 $\\langle \\cdot \\rangle_\\lambda$ 表示在固定 $\\lambda$ 下的平衡系综平均。在实践中，您将把 $\\lambda$ 离散化为多个窗口 $\\{\\lambda_i\\}$，通过采样估计每个窗口处的 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda}\\right\\rangle_{\\lambda_i}$，并应用求积法则来近似该积分。每个窗口的采样不确定性取决于 $\\frac{\\partial U}{\\partial \\lambda}$ 的方差以及分配给该窗口的模拟时间量。根据经验和理论可知，对于水中的小极性溶质，通过缩放电荷来移除静电相互作用，其被积函数相对于 $\\lambda$ 趋于近线性（线性响应区域）；而移除范德华相互作用会产生显著的曲率和大的涨落，除非使用软核（soft-core）处理来正则化短程排斥作用；若不使用软核，当原子在解耦时发生重叠，可能会出现端点灾难。\n\n下面哪个选项提出了一个科学合理的、分阶段的 $\\lambda$ 方案和跨阶段的采样精力分配，且该方案与上述基本原理以及去电荷与范德华解耦的 TI 被积函数的已知行为一致？\n\nA. 采用两个阶段，顺序为：先去电荷，然后进行范德华解耦。对于去电荷，将配体部分电荷按 $q(\\lambda_{\\mathrm{C}}) = (1-\\lambda_{\\mathrm{C}}) q_0$ 进行缩放，其中 $\\lambda_{\\mathrm{C}} \\in \\{0.00, 0.05, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, 0.95, 0.975, 1.00\\}$；在 $\\lambda_{\\mathrm{C}} \\approx 0$ 和 $\\lambda_{\\mathrm{C}} \\approx 1$ 附近分配更多窗口以捕捉轻微的端点曲率。对于范德华部分，使用带有标准柔度参数 $\\alpha$ 和指数选择的软核 Lennard–Jones 势以避免端点奇点，并采用一个非均匀的 $\\lambda_{\\mathrm{V}}$ 方案 $\\{0.00, 0.05, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.75, 0.80, 0.85, 0.90, 0.925, 0.95, 0.975, 1.00\\}$，该方案在曲率和方差通常最大的较大 $\\lambda_{\\mathrm{V}}$ 处更密集。将总时间的更大部分（例如 $70\\%$）分配给范德华阶段，并在每个阶段的窗口间按比例分配时间，该比例正比于对每个窗口 $\\frac{\\partial U}{\\partial \\lambda}$ 标准差的初步估计值乘以求积权重，从而使方差更大、曲率更高的窗口获得更多采样。\n\nB. 使用单一阶段，同时对电荷和 Lennard–Jones 参数进行线性缩放，即 $U(\\lambda)=(1-\\lambda)U_{\\text{full}}+\\lambda U_{\\text{decoupled}}$，从 $\\lambda=0$ 到 $\\lambda=1$，不使用软核。采用 $11$ 个均匀间隔的窗口，$\\lambda \\in \\{0.0, 0.1, \\dots, 1.0\\}$，并为每个窗口分配相等的模拟时间，因为均匀间隔能确保积分的平衡性。\n\nC. 采用两个阶段，顺序为：先进行范德华解耦，然后去电荷。对于范德华部分，使用标准的（非软核）Lennard–Jones 势，$\\lambda_{\\mathrm{V}} \\in \\{0.00, 0.10, 0.20, \\dots, 1.00\\}$ 均匀间隔，并将大部分总时间（例如 $70\\%$）分配给去电荷阶段，因为水的重取向在移除静电作用中占主导。对于去电荷，将电荷随 $\\lambda_{\\mathrm{C}}$ 线性缩放，并使用均匀间隔和每个窗口相等的时间。\n\nD. 采用两个阶段，顺序正确（先去电荷，后范德华），并对范德华阶段使用软核。对于范德华阶段，将大部分 $\\lambda_{\\mathrm{V}}$ 窗口置于 $\\lambda_{\\mathrm{V}} \\approx 0$ 附近，因为那是耦合状态，因此在物理上最重要，并为每个窗口分配相等的时间以避免非均匀采样带来的偏差。对于去电荷阶段，使用一个粗略的方案 $\\lambda_{\\mathrm{C}} \\in \\{0.0, 0.5, 1.0\\}$，因为被积函数接近线性，并投入最少的时间，因为静电相互作用平滑衰减。\n\n选择最佳选项，并根据 TI 定义、离散化和求积考虑、基于方差的采样分配以及被积函数在每个阶段的物理行为进行推理来证明您的选择。在给定条件下，只有一个选项是最合适的。",
            "solution": "用户要求对一个关于热力学积分（TI）的问题陈述进行严格验证，并随后从提供的选项中推导出正确答案。\n\n### 第1步：提取已知条件\n- **任务**：计算一个小的中性极性配体在液态水中的绝对水合自由能。\n- **方法**：使用热力学积分（TI）的炼金术路径。\n- **系综/条件**：等温等压（$NPT$），$300\\,\\text{K}$ 和 $1\\,\\text{bar}$。\n- **长程静电相互作用**：粒子网格 Ewald (PME)。\n- **路径**：两部分解耦：1) 去电荷（移除静电相互作用）和 2) 范德华（vdW）解耦。\n- **目标**：为耦合参数 $\\lambda$ 设计一个分阶段的方案，并论证采样精力的分配方式，以在固定的总模拟时间内最小化最终 TI 积分的统计不确定性。\n- **TI 方程**：$\\Delta G = \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_\\lambda \\, d\\lambda$。\n- **实践考虑**：积分被离散化为多个窗口 $\\{\\lambda_i\\}$，不确定性取决于 $\\frac{\\partial U}{\\partial \\lambda}$ 的方差和每个窗口的模拟时间。\n- **给定的物理/经验知识**：\n    1. 在水中对小极性溶质进行去电荷，其被积函数 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda}\\right\\rangle$ 相对于 $\\lambda$ 趋于近线性。\n    2. 范德华解耦可能表现出显著的曲率和大的涨落。\n    3. 如果不使用软核势，范德华解耦可能会因非键合原子重叠而遭受“端点灾难”（奇点）。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准评估问题陈述。\n\n- **科学依据**：该问题牢固地植根于统计力学和计算化学的原理。所描述的概念——热力学积分、炼金术自由能计算、PME、去电荷和 vdW 解耦路径、软核势以及方差减小——都是该领域的标准核心概念。所提供的 TI 公式是正确的。关于被积函数行为的经验陈述是自由能模拟科学文献中公认的事实。\n- **定义明确**：问题定义明确。它要求根据明确的目标（最小化统计不确定性）和明确的物理与计算背景，从一系列选项中确定一个方法学上合理的策略。通过应用既定原则可以确定唯一的最佳选项。\n- **客观性**：语言技术性强、精确，且没有主观论断。它提出了一个计算科学中的标准问题。\n- **完整性和一致性**：问题陈述是自洽的。它提供了所有必要的概念信息，以便在不需要超出所述基本原理的外部知识的情况下，对最优策略进行推理。没有矛盾之处。\n- **现实性**：所描述的场景是该领域研究人员常规执行的自由能计算的典型例子。它完全符合现实。\n\n### 第3步：结论和行动\n问题陈述是**有效的**。它科学合理、定义明确且客观。我将继续推导解决方案并评估各个选项。\n\n### 解决方案推导\n\n目标是在固定的总计算成本（总模拟时间 $T_{\\text{total}}$）下，最小化计算出的自由能 $\\Delta G$ 的总统计不确定性。\n\n自由能变化是势能对耦合参数 $\\lambda$ 的偏导数的系综平均值的积分：\n$$ \\Delta G = \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_\\lambda \\, d\\lambda $$\n在实践中，这是通过在一组离散的 $\\lambda$ 窗口 $\\{\\lambda_0, \\lambda_1, \\ldots, \\lambda_N\\}$ 上使用数值求积来计算的：\n$$ \\Delta G \\approx \\sum_{i=0}^{N-1} w_i \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda_i} $$\n其中 $w_i$ 是求积权重（例如，对于梯形法则，内部点的 $w_i \\approx \\frac{1}{2}(\\lambda_{i+1}-\\lambda_{i-1})$）。估计的 $\\Delta G$ 的方差约等于每个窗口方差的总和，由求积权重的平方加权：\n$$ \\text{Var}(\\Delta G) \\approx \\sum_i w_i^2 \\text{Var}\\left(\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda_i}\\right) $$\n在窗口 $\\lambda_i$ 处，从长度为 $t_i$ 的模拟中估计出的平均值的方差与 $t_i$ 成反比，与被平均量的内禀方差 $\\sigma_i^2 = \\text{Var}\\left(\\frac{\\partial U}{\\partial \\lambda}\\right)_{\\lambda_i}$ 成正比：\n$$ \\text{Var}\\left(\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda_i}\\right) \\propto \\frac{\\sigma_i^2}{t_i} $$\n为了在约束条件 $\\sum_i t_i = T_{\\text{total}}$ 下最小化 $\\text{Var}(\\Delta G)$，分配给每个窗口的时间 $t_i$ 的最优分配由下式给出：\n$$ t_i \\propto w_i \\sigma_i $$\n这意味着应该将更多的模拟时间分配给被积函数表现出高方差（$\\sigma_i$）的窗口，和/或求积区间较宽（导致较大的 $w_i$）的窗口。此外，为了最小化求积误差（用和近似积分的误差），在被积函数 $\\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_\\lambda$ 曲率高的区域需要更多的 $\\lambda$ 点。\n\n将这些原则应用于具体问题：\n\n1.  **阶段顺序**：标准且最稳定的方案是**先去电荷，然后解耦范德华相互作用**。如果先解耦 vdW 相互作用，会从一个仍然带电的分子中移除排斥性的 Lennard-Jones 核心。这将允许溶剂水分子过分靠近配体的原子点电荷，导致不切实际的巨大静电力和数值不稳定性。相反的顺序通过先中和配体，然后移除得到的电中性、非极性物体的空间位阻效应，从而避免了这个问题。\n\n2.  **去电荷阶段（静电）**：问题陈述指出，对于小极性溶质，此阶段会产生一个*近线性*的被积函数。\n    -   **$\\lambda$ 方案**：一个近线性的函数可以用相对较少、均匀间隔的点来精确积分。然而，轻微的非线性可能存在，特别是在端点（$\\lambda=0$ 和 $\\lambda=1$）附近，因此在这些地方增加一些额外的点是提高准确性的良好实践。\n    -   **采样/时间**：一个平滑、近线性的被积函数通常具有低且相对恒定的方差。因此，与更具挑战性的 vdW 阶段相比，此阶段将需要总模拟时间中较小的一部分。\n\n3.  **范德华（vdW）解耦阶段**：问题陈述指出，此阶段具有*显著的曲率*和*大的涨落*。\n    -   **软核势**：当 vdW 相互作用被关闭时（$\\lambda_{\\mathrm{V}} \\to 1$），配体变成一个可以被溶剂原子占据的“幽灵”。Lennard-Jones 势的 $r^{-12}$ 排斥项将会发散，导致无穷大的力并使模拟崩溃。这就是“端点灾难”。使用**软核势**是防止这种情况的强制性要求。软核势修改了 LJ 势，使其在 $r=0$ 时为有限值。\n    -   **$\\lambda$ 方案**：众所周知，显著的曲率和大的方差发生在 vdW 解耦路径的末端，即当 $\\lambda_{\\mathrm{V}}$ 接近 $1$ 时。为了准确地对该区域进行积分并捕捉函数的行为，$\\lambda$ 窗口在此处必须更密集地分布。\n    -   **采样/时间**：根据最优时间分配原则（$t_i \\propto w_i \\sigma_i$），并且鉴于方差 $\\sigma_i^2$ 在 $\\lambda_{\\mathrm{V}} \\to 1$ 时最大，必须将更多的模拟时间分配给这些高 $\\lambda_{\\mathrm{V}}$ 的窗口。总体而言，由于此阶段的特点是更高的方差和曲率，必须将大部分总模拟时间分配给它。\n\n### 逐项分析选项\n\n**A. 采用两个阶段，顺序为：先去电荷，然后进行范德华解耦。对于去电荷，将配体部分电荷按 $q(\\lambda_{\\mathrm{C}}) = (1-\\lambda_{\\mathrm{C}}) q_0$ 进行缩放...在 $\\lambda_{\\mathrm{C}} \\approx 0$ 和 $\\lambda_{\\mathrm{C}} \\approx 1$ 附近分配更多窗口以捕捉轻微的端点曲率。对于范德华部分，使用软核 Lennard–Jones 势...并采用一个非均匀的 $\\lambda_{\\mathrm{V}}$ 方案...该方案在曲率和方差通常最大的较大 $\\lambda_{\\mathrm{V}}$ 处更密集。将总时间的更大部分（例如 $70\\%$）分配给范德华阶段，并在每个阶段的窗口间按比例分配时间，该比例正比于对每个窗口 $\\frac{\\partial U}{\\partial \\lambda}$ 标准差的初步估计值乘以求积权重...**\n- **评估**：此选项正确指定了阶段顺序。它正确地为去电荷提出了一个非均匀的 $\\lambda_{\\mathrm{C}}$ 方案，在两端更密集。至关重要的是，它强制要求为 vdW 阶段使用软核势。它正确地将更多的 $\\lambda_{\\mathrm{V}}$ 窗口放在高 $\\lambda_{\\mathrm{V}}$ 区域。它正确地将更多总时间分配给更困难的 vdW 阶段。最后，它描述了在*每个阶段内部*分配时间的、可证明为最优的策略（$t_i \\propto w_i \\sigma_i$）。此选项的每个元素都与已建立的最佳实践和理论原则一致。\n- **结论**：**正确**。\n\n**B. 使用单一阶段，同时对电荷和 Lennard–Jones 参数进行线性缩放...不使用软核。采用 $11$ 个均匀间隔的窗口...并为每个窗口分配相等的模拟时间，因为均匀间隔能确保积分的平衡性。**\n- **评估**：此选项存在严重缺陷。(1) 它提出了一个同时进行的路径，这通常比两步法更不稳定且更难优化。(2) 关键是，它忽略了软核势，这将导致端点奇点和模拟失败。(3) 它使用均匀的 $\\lambda$ 方案和相等的时间分配，这对于一个已知在某些区域具有高方差和曲率的被积函数来说是次优策略。其关于相等时间的理由也是不正确的。\n- **结论**：**不正确**。\n\n**C. 采用两个阶段，顺序为：先进行范德华解耦，然后去电荷。对于范德华部分，使用标准的（非软核）Lennard–Jones 势，$\\lambda_{\\mathrm{V}}$...均匀间隔，并将大部分总时间（例如 $70\\%$）分配给去电荷阶段...**\n- **评估**：此选项包含多个关键错误。(1) 阶段顺序不正确，并且从数值稳定性的角度来看是危险的。(2) 它忽略了 vdW 阶段强制要求的软核势。(3) 它基于有缺陷的推理，将大部分模拟时间错误地分配给了较容易的去电荷阶段。(4) 它为 vdW 阶段使用了次优的均匀间隔。\n- **结论**：**不正确**。\n\n**D. 采用两个阶段，顺序正确（先去电荷，后范德华），并对范德华阶段使用软核。对于范德华阶段，将大部分 $\\lambda_{\\mathrm{V}}$ 窗口置于 $\\lambda_{\\mathrm{V}} \\approx 0$ 附近...并为每个窗口分配相等的时间以避免非均匀采样带来的偏差。对于去电荷阶段，使用一个粗略的方案 $\\lambda_{\\mathrm{C}} \\in \\{0.0, 0.5, 1.0\\}$...**\n- **评估**：虽然此选项正确地确定了顺序和需要软核势，但其后续的规定是错误的。(1) 它错误地建议将大多数 $\\lambda_{\\mathrm{V}}$ 窗口放在 $\\lambda_{\\mathrm{V}} \\approx 0$ 附近，而困难区域在 $\\lambda_{\\mathrm{V}} \\approx 1$ 附近。(2) 关于相等时间分配的理由（“以避免偏差”）是一个谬论；基于方差的非均匀分配是一种无偏的方差减小技术。(3) 提议的仅有3个点的去电荷方案可能过于稀疏，容易产生大的求积误差，即使对于近线性的函数也是如此。\n- **结论**：**不正确**。\n\n基于全面的分析，选项A是唯一一个为所述问题提供了完整、科学合理且最优策略的选项。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}